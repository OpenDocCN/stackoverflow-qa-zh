# StackOverflow 问答 000454000-000454999

# sql-server - 验证 Windows Mobile 6 设备

> ID：454019
> 
> 赞同：2
> 
> 时间：2009-01-17T20:51:17.073
> 
> 标签：sql-server, sql-server-2005, windows-mobile, iis-6, replication

我有一个在 Windows Mobile 6 Professional PDA 设备上运行的应用程序。通过从设备浏览 url 并下载出租车来安装应用程序。

用户在应用程序中捕获信息，然后使用合并复制和 IIS v6 将其复制回 SQL 2005 服务器。

尽管用户需要在设备上登录应用程序，但任何知道 url 的人都可以下载和安装。此外，如果您知道用户密码，任何拥有设备的人都可以更新该用户信息。

我想以某种方式在安装或复制阶段（或两者）对设备进行身份验证。

是否可以根据序列号或 IMEI（手机 ID）号码对设备进行身份验证？有没有办法将证书加载到设备上，以便只允许经过认证的设备连接？

我想要一个不太难实现和支持的系统。用户必须能够更新自己的设备，并且他们不太擅长记住复杂的程序或密码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-17T21:00:34.560

一种可能的解决方案是发送唯一设备 ID 作为身份验证的一部分。[Windows Mobile 团队博客](http://blogs.msdn.com/windowsmobile/archive/2006/01/09/510997.aspx)`GetDeviceUniqueID`上有一篇关于使用的帖子。

您可以在用户首次连接到服务器时存储此唯一 ID，并在每次合并之前对其进行验证。

这种方法有助于确保用户登录是通过他们自己的手机进行的。它解决了远程入侵者将您的程序下载到他们自己的手机并登录到合法用户帐户的问题。当然，如果这样的入侵者可以访问您的用户电话和密码，那么所有的赌注都将被取消。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T14:36:08.240

您有相互冲突的要求：

> 用户必须能够更新自己的设备，并且他们不太擅长记住复杂的程序或密码。

和：

> 此外，如果您知道用户密码，任何拥有设备的人都可以更新该用户信息。

如果您的用户只能（几乎）使用密码，那么您不能指望在任何情况下都能够保护拥有密码的任何其他人。

没有“神奇”身份验证可以告诉您特定用户或设备在您提供的范围之外是合法的。

您可以对下载进行密码保护，您可以加载证书，您可以获得 PDA 信息（甚至是蜂窝信息），但除非您添加另一种身份验证机制，否则您最终得到的只是一个密码。

密码是您最薄弱的环节，您似乎在表明您无法提供更严格的访问权限，但您不知何故需要它？

如果您有另一个身份验证通道（电话、电子邮件、短信），那么您可以提供更强大、更有意义的身份验证。

例如，您可以使您的程序操作依赖于“public.key”文件，该文件具有您的服务器需要使用的每个用户的公钥。一旦用户登录到您的网站，让他们给您他们的电话号码（所以现在您有了电话号码和密码）并发送带有链接的短信，其中包含指向临时下载密钥的链接。为每个用户制作一个新密钥，将他们的私钥保存在服务器上，并使用该密钥对加密（或至少验证）设备和服务器之间的每笔交易。

现在，如果其他人想假装他们是他们的用户，他们必须通过以下三种方式之一获取该文件：

*   他们直接将其从 PDA 中取出（他们还需要密码，因为公钥应受用户密码保护）
*   他们让用户请求一个新的 SMS 链接，并以某种方式在没有电话的情况下获取链接
*   他们更改电话号码并请求新的短信链接

无论如何，您不仅要验证密码，还要验证关联的电话号码。您可以让用户难以更改电话号码（当他们请求更改电话号码、让他们打电话等时，也可以根据他们的电子邮件进行验证）。

当然你也可以对其他的通讯方式做同样的事情，但是用户越来越习惯短信认证和下载，所以并没有太多的麻烦。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T10:51:07.787

您可以为每次下载生成略有不同的 cab 文件。唯一的区别是您的应用程序将用作用户/密码模拟的安全令牌。那应该是真正安全的公钥。

每次他们访问您的应用程序时，您都可以向他们发送带有代码的 SMS。

# apache-flex - 浏览器中缺少 flex 应用程序和标题

> ID：454044
> 
> 赞同：0
> 
> 时间：2009-01-17T21:04:35.207
> 
> 标签：apache-flex

有谁知道当我嵌入 flex 对象时为什么我的标题没有显示在浏览器中？当页面加载时它会显示标题，但是当它完全加载时它会再次出现

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T15:58:29.327

罪魁祸首可能是[`IBrowserManager`](http://livedocs.adobe.com/flex/3/langref/mx/managers/IBrowserManager.html). 你在用吗？如果你是，当你的应用程序初始化时，你是否使用参数[`init()`](http://livedocs.adobe.com/flex/3/langref/mx/managers/IBrowserManager.html#init())为空值来调用它的方法？`title`

# encryption - 非对称加密中的加密和签名有什么区别？

> ID：454048
> 
> 赞同：375
> 
> 时间：2009-01-17T21:07:43.467
> 
> 标签：encryption, rsa, signing, license-key

加密某些数据与签署某些数据（使用 RSA）有什么区别？

它只是简单地颠倒了公钥-私钥的角色吗？

例如，我想使用我的私钥生成消息，所以只有我可能是发件人。我希望我的公钥用于阅读消息，我不在乎谁阅读了它们。我希望能够加密某些信息并将其用作我的软件的产品密钥。我只关心我是唯一可以生成这些的人。我想在我的软件中包含我的公钥来解密/读取密钥的签名。我不在乎谁可以读取密钥中的数据，我只关心我是唯一可以生成它们的可验证的人。

在这种情况下签名有用吗？

* * *

## 回答 #1

> 赞同：556
> 
> 时间：2009-01-17T21:20:06.920

加密时，您使用**他们的公钥**编写消息，而他们使用**他们的私钥**读取消息。

签名时，您使用**您的私钥**编写消息的签名，他们使用**您的公钥**检查它是否真的是您的。

> 我想使用我的私钥生成消息，所以只有我可能是发件人。
> 
> 我希望我的公钥用于阅读消息，我不在乎谁阅读了它们

这是*签名*，它是用你的私钥完成的。

> 我希望能够加密某些信息并将其用作我的软件的产品密钥。
> 
> 我只关心我是唯一可以生成这些的人。

如果您只需要自己了解它，则不需要弄乱钥匙来做到这一点。您可能只是生成随机数据并将其保存在数据库中。

但是，如果您想让人们知道密钥确实是您的，您需要生成随机数据，在其中保存一个数据库并使用您的密钥对其进行签名。

> 我想在我的软件中包含我的公钥来解密/读取密钥的签名。

您可能需要从 Verisign 或 Thawte 等商业提供商处为您的公钥购买证书，以便人们可以检查没有人伪造您的软件并用他们的公钥替换您的公钥。

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2009-01-17T21:38:15.323

在 RSA 加密中，当您生成密钥对时，您完全可以随意选择哪个作为公钥，哪个是私钥。如果你用一个加密，你可以用另一个解密——它可以双向工作。

因此，很容易了解如何使用*接收者的公钥*加密消息，以便接收者可以使用他们的*私钥*对其进行解密。

签名是签名者拥有与某个公钥匹配的私钥的证明。为此，使用该发件人的*私钥*对消息进行加密就足够了，并将加密版本与明文版本一起包括在内。要验证发件人，请解密加密版本，并检查它是否与明文相同。

当然，这意味着您的信息不是秘密。任何人都可以解密它，因为公钥是众所周知的。但是当他们这样做时，他们已经证明密文的创建者拥有相应的私钥。

但是，这意味着将传输的大小加倍 - 明文和密文一起（假设您希望对验证签名不感兴趣的人阅读消息）。因此，通常通过创建明文的*哈希来创建签名。*不能创建假散列很重要，因此使用了 SHA-2 等加密散列算法。

所以：

*   要生成签名，请从明文中生成哈希，使用您的私钥对其进行加密，并将其与明文一起包含。
*   要验证签名，请从明文中生成散列，使用发送者的公钥解密签名，检查两个散列是否相同。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2018-01-12T21:31:03.360

建立安全通信有两个不同但密切相关的问题

1.  加密数据，以便只有授权人员才能解密和读取它。
2.  验证发件人的身份/身份验证。

这两个问题都可以使用公钥密码术优雅地解决。

**一、数据的加解密**

Alice 想向 Bob 发送一条任何人都无法阅读的消息。

*   Alice 使用 Bob 的公钥加密消息并将其发送过去。
*   Bob 收到消息并使用他的私钥对其进行解密。

> 请注意，如果 A 想向 B 发送消息，A 需要使用 B 的公钥（任何人都可以公开使用），并且 A 的公钥和私钥都不会出现在这里。

因此，如果您想向我发送消息，您应该知道并使用我提供给您的公钥，并且只有我才能解密该消息，因为我是唯一可以访问相应私钥的人。

二、**验证发件人的身份（身份验证）**

Alice 想再次向 Bob 发送消息。使用上述方法解决了加密数据的问题。

但是，如果我坐在 Alice 和 Bob 之间，向 Bob 介绍自己为“Alice”并将我自己的消息发送给 Bob，而不是转发 Alice 发送的消息，该怎么办。即使我无法解密和阅读 Alice 发送的原始消息（需要访问 Bob 的私钥），我也在劫持他们之间的整个对话。

Bob 有没有办法确认他收到的消息实际上是由 Alice 发送的？

*   Alice 用她的私钥对消息进行签名并将其发送过去。（实际上，签名的是消息的哈希，例如 SHA-256 或 SHA-512。）
*   Bob 收到它并使用 Alice 的公钥验证它。由于 Alice 的公钥成功验证了该消息，Bob 可以得出该消息已被 Alice 签名的结论。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-01-17T21:19:15.910

是的，可以将签名数据视为给它自己的蜡印，其他人没有。这样做是为了实现**完整性和不可否认性**。加密使其他人无法看到数据。这样做是为了实现**保密**。参见维基百科[http://en.wikipedia.org/wiki/Information_security#Key_concepts](http://en.wikipedia.org/wiki/Information_security#Key_concepts)

签名是使用您的私钥签名的消息的哈希值。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-01-17T21:11:03.523

签名是用你的私钥产生一个“哈希”，可以用你的公钥来验证。文本以明文形式发送。

加密使用接收者的公钥对数据进行加密；解码是用他们的私钥完成的。

因此，密钥的使用不会被逆转（否则您的私钥将不再​​是私有的！）。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-17T21:20:26.563

您正在准确描述在公钥加密中使用签名的方式和原因。请注意，对他人提供的任意消息进行签名（或加密）是非常危险的——这允许对可能危及您的密钥的算法进行攻击。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-17T21:16:06.743

在功能上，您使用公钥/私钥加密来确保只有接收者可以阅读您的消息。消息使用接收者的公钥*加密*，并使用接收者的私钥*解密。*

您可以使用签名让接收者知道您创建了消息并且在传输过程中它没有更改。消息签名是使用您自己的私钥完成的。接收者可以使用你的公钥来检查消息是否被篡改。

至于使用的算法：涉及单向函数[，请参见例如 wikipedia](https://en.wikipedia.org/wiki/Public-key_cryptography)。此类算法中的第一个使用大素数，但此后发明了更多的单向函数。

搜索“Bob”、“Alice”和“Mallory”以查找互联网上的介绍文章。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-17T23:08:38.480

签名表明您确实是签名对象的来源或担保人。但是，每个人都可以阅读该对象。

加密意味着只有拥有相应私钥的人才能读取它，但没有签名就不能保证你在加密对象的背后。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2019-03-16T14:55:38.213

> 加密某些数据与签署某些数据（使用 RSA）有什么区别？

加密保留了消息（“某些数据”）的机密性，而签名提供了不可否认性：即只有签署它的实体才能签署它。也存在功能差异；继续阅读。

> 它只是简单地颠倒了公钥-私钥的角色吗？

绝对不。不赞成使用相同的私钥进行签名和*解密*（或者同样地，使用相同的公钥进行验证和*加密*），因为您不应该混合使用目的。这不是一个数学问题（RSA 应该仍然是安全的），而是一个*密钥管理*问题，例如，签名密钥的寿命应该更短，并且在使用之前包含更多保护。

对于同一条消息，您应该使用发送方私钥进行签名，使用接收方信任的公钥进行加密。通常使用签名然后加密，否则对手可以用他自己的签名替换。同样，您应该使用接收方的私钥进行解密，使用发送方的*可信*公钥进行验证。

此外，您应该了解签名生成不使用“使用私钥加密”。尽管所有 RSA 操作都基于模幂运算，但填充方案对于签名生成是完全不同的。此外，在 RSA 的所有实际应用中，公钥具有与 RSA 私钥完全不同的属性。

> 例如，我想使用我的私钥生成消息，所以只有我可能是发件人。

那是不可否认性，可以通过签名来实现。

> 我希望我的公钥用于阅读消息，我不在乎谁阅读了它们。

公钥应该被认为是众所周知的。如果您希望每个人都阅读这些消息，那么您根本不加密它们。

签名通常不会影响消息的内容。消息被认为与签名分开。正式地，此类签名被称为“带有附件的签名”，其中附件是消息。这是一个有点奇怪的名字，因为消息被认为比签名更重要，但是是的。只有少数签名提供（部分）消息恢复；它们不再使用太多，通常被认为已弃用。

请注意，诸如 CMS 之类的签名协议可能会部署包含消息和签名的*容器格式*。在这种情况下，您首先需要从容器中取出 - 仍未加密的 - 消息，就像从普通的 .zip 存档中解压缩文件一样。因此，消息可能会被隐藏起来，并且在这种情况下不能直接使用。

> 我希望能够加密某些信息并将其用作我的软件的产品密钥。我只关心我是唯一可以生成这些的人。

加密用于实现机密性。过去 RSA 签名生成通常被认为是“用私钥加密”。但是，操作与上面解释的完全不同，后来的标准拼命尝试将加密和签名生成分开。

> 我想在我的软件中包含我的公钥来解密/读取密钥的签名。我不在乎谁可以读取密钥中的数据，我只关心我是唯一可以生成它们的可验证的人。

是的，这称为建立对公钥的*信任。*但是，保护您的程序代码与保护消息有很大不同。您可以执行*代码签名*，但是您需要一些东西来检查*代码之外*的签名。有提供此功能的操作系统。

例如，有 Microsoft Authenticode。像 iStore 和 Android 应用程序商店这样的应用程序商店可能会也可能不会使用代码签名，但它们提供了一些保证，即您的应用程序不会被克隆或至少不会在商店中被克隆。毕竟，密码学并不总是解决方案。

*完全*防止您的代码被克隆/更改要困难得多，如果您这样做，您将坚定地处于 DRM 领域。

> 在这种情况下签名有用吗？

是的，一点没错。如果对公钥有信任，它当然可以帮助确保消息仅由您签名。它是否有助于验证您的*应用程序代码/集成公钥*完全取决于您希望在其中运行代码的环境。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-01-17T22:13:34.537

在您的场景中，您没有按照非对称加密的含义进行加密；我宁愿称它为“编码”。

所以你将你的数据编码成一些二进制表示，然后你用你的私钥签名。如果您无法通过公钥验证签名，则您知道签名数据不是使用您的私钥生成的。（“验证”表示无符号数据没有意义）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-03-10T11:38:59.640

在提问者意图使用软件许可解决方案的内容中回答这个问题，要求是：

1.  没有第 3 方可以通过反编译应用程序生成许可证密钥
2.  软件密钥的内容不需要是安全的
3.  软件密钥不是人类可读的

数字签名将解决这个问题，因为可以使用私钥对生成密钥的原始数据进行签名，这使得它不可读，但如果逆向工程则可以解码。但是私钥是安全的，这意味着没有人能够为您的软件制作许可证（这就是重点）。

请记住，您无法阻止技术人员移除您产品上的软件锁。因此，如果他们必须破解每个发布的版本。但是您真的不希望他们能够为您的产品生成可以为所有版本共享的新密钥。

Python PyNaCl 文档有一个“数字签名”示例，可以满足此目的。[http://pynacl.readthedocs.org/en/latest/signing/](http://pynacl.readthedocs.org/en/latest/signing/)

并导致 NaCl 项目到 C 示例

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-25T17:55:09.243

> 加密某些数据与签署某些数据（使用 RSA）有什么区别？

RSA 仅仅是唯一一个天真地支持公钥加密和数字签名的公钥密码系统。

这通常会使初学者感到困惑，因为各种消息来源/讲师说

*   RSA解密是RSA签名。
    *   **不它不是！**

困惑来自教科书 RSA

*   教科书 RSA 加密；

    消息`m`并计算`c = m^e mod n`加密和`m = c^d mod n`解密。

*   教科书 RSA 签名；

    消息`m`并计算`sg = m^d mod n`验证和`m == sg^e mod n`签名验证。

**两者都不安全**，**也没有在现实生活中使用！**

> 它只是简单地颠倒了公钥-私钥的角色吗？

**不它不是！**

## 加密

对于 RSA 加密，必须使用 [RSASSA-PKCS1-v1_5](https://www.rfc-editor.org/rfc/rfc8017) 填充或[Optimal Asymmetric Encryption Padding (OAEP)](https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding)。这些填充对消息有开销。例如，PKCS1-v1_5 定义为

它有这样的`EM`结构

```
EM = 0x00 || 0x02 || PS || 0x00 || M. 
```

那么它们是什么？

*   PS 至少为 8 `FF`s 块
*   M 是消息
*   第一个`0x00`保证 EM 小于模数。
*   块大小等其他细节`FF`可以在[rfc 8017 第 7.2.1 节中找到](https://www.rfc-editor.org/rfc/rfc8017#section-7.2.1)

所以它有一个特殊的消息结构来保证安全，最近（2018 年）[被证明是安全的。](https://eprint.iacr.org/2018/855.pdf)填充至少有 11 字节的开销。

## 签名

签名的正确术语是签名和验证。对于安全签名，RSA 需要 RSA-PSS（[概率签名方案](https://en.wikipedia.org/wiki/Probabilistic_signature_scheme)）。结构有点复杂，一张图说明大部分

[![在此处输入图像描述](https://i.stack.imgur.com/N9uL6.pngs&cd=vfe&ved=0CAIQjRxqFwoTCMD7gsax5fACFQAAAAAdAAAAABAD)](https://i.stack.imgur.com/N9uL6.pngs&cd=vfe&ved=0CAIQjRxqFwoTCMD7gsax5fACFQAAAAAdAAAAABAD)

一旦您对消息进行哈希处理并正确填充，您就可以使用您的私钥签署您的填充消息！

对于验证，使用签名消息上的公钥并使用填充规则进行验证。

更喜欢 OAEP，因为 RSASSA-PKCS1-v1_5 难以正确实施，并且这些不正确的实施在一年中引起了许多攻击，尽管这已被证明是安全的。

* * *

让我们以康奈尔大学页面结束所有内容；

*   [RSA 签名不是 RSA 解密](https://www.cs.cornell.edu/courses/cs5430/2015sp/notes/rsa_sign_vs_dec.php)

# facebook - Facebook 编程的好资源

> ID：454051
> 
> 赞同：16
> 
> 时间：2009-01-17T21:11:33.180
> 
> 标签：facebook

我是 Facebook 程序员新手。有人可以为初学者推荐好的资源吗？我相信它与PHP有关。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-09T23:12:24.877

我编写了以下内容来帮助人们快速开始 Facebook 应用程序开发。

[如何使用 Facebook Developer Toolkit 2.0](http://devtacular.com/articles/bkonrad/how-to-use-the-facebook-developer-toolkit-20)
[如何为 Facebook 之类的应用程序设置样式](http://devtacular.com/articles/bkonrad/how-to-style-an-application-like-facebook)
[如何集成 Facebook Connect](http://devtacular.com/articles/bkonrad/how-to-integrate-with-facebook-connect/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-17T21:14:26.527

实际上，您可以用大多数语言编写 Facebook 应用程序。[Facebook 开发者网站](https://developers.facebook.com/)是一个很好的起点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-17T21:19:48.857

有一本书名为：《[Facebook Cookbook：构建应用程序来发展你的 Facebook 帝国](https://rads.stackoverflow.com/amzn/click/com/059651817X)》，我很喜欢

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-28T18:20:37.980

如果您已经添加了[facebook 开发者](http://developers.facebook.com/)应用程序，则有一个到[开发者论坛](http://forum.developers.facebook.com/)的链接。当然，[stackoverflow](https://stackoverflow.com/)似乎也是解决此类问题的好地方。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-13T09:58:05.297

在这里您可以找到一些有趣的材料：[Facebook 应用程序开发人员的 50 种资源](http://blog.kissmetrics.com/50-resources-for-facebook-application-developers/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-13T09:52:14.897

您可以尝试Jesse Stay 和[Facebook Application Development (Programmer to Programmer)的](https://rads.stackoverflow.com/amzn/click/com/0470246669)[FBML Essentials](https://rads.stackoverflow.com/amzn/click/com/0596519184)。

# c# - SQL 检索特定日期时间的历史传感器值

> ID：454053
> 
> 赞同：1
> 
> 时间：2009-01-17T21:12:15.533
> 
> 标签：c#, sql, sql-server

我有一个数据库，它的容器压力每 30 秒变化一次。我希望能够检索过去几天中特定时间的录音。我无法将其作为存储过程或视图基于服务器——我只有读取权限。我创建了一个过去 17 天的例程，但我希望它能够提供几个月的数据。我猜想只是从 c# 应用程序重复调用，但这似乎比我现在使用的方法效率低。有没有人有任何建议。

布拉德

```
declare @DeadBand DateTime
declare @EndDate DateTime
declare @End varchar(50)
declare @Start varchar(50)
declare @Temp varchar(50)
declare @NumberDays int
declare @dec int

declare @InnerSqlQry as varchar(8000)
declare @SqlQry as varchar(8000)
SET @NumberDays = 5
SET @dec = @NumberDays
SET @Start = CONVERT(Varchar(30),dateadd(dd,-@NumberDays,GetDate()))
SET @End = CONVERT(Varchar(30),GetDate())
SET @DeadBand= + CONVERT(Varchar(30),dateadd(ss,90,@Start))

   SET @Width = + CONVERT(Varchar(30),dateadd(ss,90,@Start))
WHILE (@dec >= 1)
    BEGIN

                set @InnerSqlQry = ' Select DateTime,ACMKWHYTD_1 From WideHistory        Where  Datetime >='''+convert(varchar(30), @Start ,120) +''' AND Datetime <= '''+convert(varchar(30),@DeadBand,120) +''' and wwResolution =60000 and wwRetrievalMode = "cyclic" '

            if(@dec = 1)
                    begin
                            set @SqlQry = @SqlQry+ N' Select top 1 * from openquery(INSQL,''' + REPLACE(@InnerSqlQry, '''', '''''') + ''' )'
                    end

            if((@dec > 1) and (@dec < @NumberDays))
                    begin
                            set @SqlQry = @SqlQry+ N' Select top 1 * from openquery(INSQL,''' + REPLACE(@InnerSqlQry, '''', '''''') + ''' ) union '
                    end

            if(@dec = @NumberDays)
                    begin
                            set @SqlQry = N' Select top 1 * from openquery(INSQL,''' + REPLACE(@InnerSqlQry, '''', '''''') + ''' ) union '
                    end

            set @dec = @dec - 1

            SET @Start = CONVERT(Varchar(30),dateadd(dd,-@dec,GetDate()))
            SET @DeadBand= + CONVERT(Varchar(30),dateadd(ss,90,@Start))

    END
    print(@sqlQry)
    exec(@sqlQry) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T21:52:38.243

不要使用循环......我认为你也没有。你看过 DatePart 吗？

例如，此查询将获取在 12:30 发生的开始日期和停止日期之间的每条记录。

```
Select DateTime,ACMKWHYTD_1 From WideHistory  
WHERE DateTime BETWEEN @Start AND @DeadEnd
AND DATEPART(hh,datetime) =12 AND DatePart(mi,datetime)=30 
```

或者，您可以将日期归零，然后使用 datediff 函数来比较目标时间与您所寻找的时间之间的分钟数。

其中 ABS(datediff(mi,convert(nvarchar(10),getdate(),8),'10:00PM'))=60 这将为您提供在晚上 10:00 的 60 分钟内发生的所有记录，因此从 9 到 11下午

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T21:42:41.603

您不能通过将日期时间转换为 unixtime 数字并对其进行修改以提供一天中的时间来更有效地做到这一点。

where 子句将根据您想要的日期范围对其进行过滤，然后 mod 技巧将丢弃所有不在您想要的时间的记录。

然后您可以查询一次，而不是每天查询一次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:13:33.030

我已经看到了很多将 DATETIME 转换为“只是时间”的技巧。事实上，我在那里工作的地方花费了相当长的时间来寻找最快的。人们似乎忘记了“最短代码”并不总是最快的，而且通常包括隐藏的隐式类型转换。我们想出的最快的是...

DATEADD(天, DATEDIFF(分钟, 0, ), 0)

我提到它的原因是，一旦你有了时间组件，一切都会变得更容易，并且可以更轻松地更改代码以满足细微的不同需求。

```
DECLARE
    @start_date    DATETIME,
    @end_date      DATETIME,
    @chosen_time   DATETIME
SELECT
    @start_date    = '2009 Jan 05 00:00',
    @end_date      = '2009 Jan 12 00:00',
    @chosen_time   = '1900 Jan 01 17:30'   -- '1900 Jan 01' is day 0

SELECT
    <whatever>
FROM
    WideHistory  
WHERE
        [WideHistory].DateTime >= @start_date
    AND [WideHistory].DateTime <  @end_date
    AND DATEADD(DAY, DATEDIFF(MINUTE, 0, [WideHistory].DateTime), 0) = @chosen_time 
```

一个人可以很容易地适应一天中的几个关键时间，或者一个时间范围，等等……

编辑：

正如对此答案的评论中所述，对数据库结构的更改也将在这里受益。具有 DATE 字段和 TIME 字段。通常是多余的，但在这种情况下可能是有益的。

# assembly - 从 MIPS 切换到 x86 程序集时我应该知道什么？

> ID：454071
> 
> 赞同：19
> 
> 时间：2009-01-17T21:20:30.710
> 
> 标签：assembly, x86, mips

在学校，我们用 MIPS 汇编语言编程已经有一段时间了。我有兴趣深入研究 x86 程序集，我听说这有点难（甚至我的 MIPS 教科书也这么说）。

作为一名 MIPS 程序员，在进入 x86 世界之前，我应该了解哪些核心信息？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-17T21:46:56.243

要记住的最重要的事情是：

*   很少有通用寄存器，而您所拥有的也不是纯 GP——许多指令要求您将某些寄存器用于特定目的。
*   x86 指令是两操作码形式而不是三操作码形式，这会使某些操作更加复杂。也就是说，不是添加 r0, r1, r2 (r0 = r1 + r2)，而是添加 eax, ebx (eax += ebx)。
*   处于保护模式的段（实际上是 DOS 之外的所有 32 位代码）使您的内存寻址方案非常不明显，当您刚开始时，这可能会让您大吃一惊。
*   您将一直查找由指令设置/清除的标志。学会爱上英特尔手册。
*   编辑，我忘记了一件事：子寄存器的使用（例如 ah 访问 eax 寄存器的低 16 位的高 8 位）可能会使对寄存器的跟踪操作变得非常困难。小心并自由地发表评论，直到你把事情搞定。

除此之外，x86 非常简单。当您学会滥用诸如“lea”和“test”之类的指令时，您就会学会喜欢它。另外，提示：英特尔将免费向您发送指令集手册的副本，甚至不必支付运费。在他们的网站上查看履行电子邮件并按 SKU 索取书籍。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-17T21:22:32.610

与大多数其他架构相比，x86 的可用寄存器集非常有限。这并没有真正使汇编语言更难学习，但有时会使在实践中实现代码变得更加困难。

此外，由于 x86 具有强大的向后兼容性的历史，指令集并不是非常对称（绝对是 RISC 之前的版本），并且可能存在许多规则例外情况和需要注意的极端情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T22:25:30.860

我一直在学习 x86 和 x86_64 自己编写汇编程序。如果您不打算自己编写汇编程序，那么我将讲述的一些内容几乎毫无用处。不过，我自己并不了解 MIPS。

x86 间接寻址是一件复杂的事情。在一条指令中，您可以执行以下操作：

```
mov reg, [reg+offset]
mov reg, [reg*scale+base register+offset] # in where scale can be 1, 2, 4 or 8. 
```

因此，它们的指令编码很复杂，但是对于以这种方式编码的每条指令来说都是一致的。您可能想从[sandpile.org](http://www.sandpile.org/)阅读此内容。如果您想了解有关编码的更多信息，可以随时向我询问。另一个指令编码相关的烦人细节是前缀。它们极大地改变了指令的含义。例如，前面的 0x66（如果我没记错的话）和一些指令变为 16 位 GPR 而不是 32 位 GPR。

32 位 GPR（按顺序）：eax、ecx、edx、ebx、esp、ebp、esi、edi

64 位 GPR：rax、rcx、rdx、rbx、rsp、rbp、rsi、rdi、r8、r9、r10、r11、r12、r13、r14、r15

注意通用寄存器有多么少，这将迫使大多数软件或多或少地以堆栈机器方式使用它。一个痛苦的细节。rsp 用于堆栈（pop、push 指令），而 rbp 也倾向于保留。x86_64 有更多的寄存器，但人们采用它需要时间，即使每个消费者都有一个能够支持它的处理器。

浮点运算有两种不同的指令集。XMM 是较新的。在 x86_64 中有 16 个 128 位寄存器可用，而在 x86 中只有 8 个。较旧的指令集将寄存器作为堆栈处理。你只是没有交换、咬合或腐烂，所以使用它是令人费解的。

在使用中，x86 趋向于简化为 RISC 机器。其中一些复杂的指令在较新的机器上没有好处，甚至速度更慢。根据您阅读或写作的内容，您将了解大约 30-150 条指令。您也可以完全忽略一些旧指令和 AL/HL -stuff。请记住，这一切都是 1978 年之后的混乱起源，令人惊讶的是，它并没有更糟，从那以后 31 年，距离 IA-32 首次引入还有 24 年。很多事情在那段时间改变了它们的相关性。

直接跳转和调用似乎与 x86 中的下一条指令相关。所以：

```
 jmp nowhere  # or call, jz, jg whatever...
nowhere:
    nop 
```

最终编码为“JMP imm:0, NOP”。确实执行绝对跳转的寄存器间接 jmp。注意到没有寄存器间接条件跳转也很好，它也困扰着我。

这不是你应该知道的所有可能的事情，而是你的问题让我想到的第一件事。但也许你现在可以和这些相处。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-17T21:51:25.330

x86 的指令比 MIPS 更复杂。因此，MIPS 中的常见序列可能只有一条指令（最值得注意的是内存寻址）。缺少大量寄存器当然是一个缺点，但在这两种架构中都有一些约定，几乎将您可以自由使用的数量限制在 4-5 个。在 x86 中更明显。x86 比 MIPS 有更多的寄存器使用例外，你必须记住，但没有什么值得不断抱怨的。

从经验来看，任何一种语言的学习难度都差不多，包括约定。考虑到丰富的在线资源及其受欢迎程度，也许 x86 更容易一些。

x86 的难点在于生成二进制文件，因为它具有可变长度的指令和多种寻址模式。大多数情况下，无论如何您都不需要这样做。

我当然可以推荐你学习比 MIPS 更复杂的指令架构。

而且，这很重要，不要参与 RISC 与 CISC 之间的宗教战争……

# apache-flex - 将 Flex Tree 控件绑定到存储在数据库中的树的最佳方法是什么？

> ID：454073
> 
> 赞同：2
> 
> 时间：2009-01-17T21:20:47.327
> 
> 标签：apache-flex, tree

我有一个本地 SQLite 数据库，其中包含一棵树（作为嵌套集）。在 AIR 应用程序中，我想在树控件中显示该树，并提供更改节点名称和复制、移动、添加或删除节点的方法。

现在，我有点想把代码放在哪里。显然，我有一个类将对数据库执行加载/更新/插入/删除等操作。这会将整个树加载到某个存储变量中，并将用户所做的更改保存回数据库。

此类应该是 dataProvider、dataDescriptor 还是 Tree 控件本身的扩展？当用户请求添加节点等操作时，应该更新dataProvider并让数据库处理程序对事件做出反应，还是应该调用数据库处理程序的方法然后更新dataProvider？我会说后者更好，因为如果 db 查询出现问题，不更新 Tree 的数据会更容易。

在 DefaultDataDescriptor 和 Tree 类中有添加和删除节点的方法（后者中的受保护方法），我应该使用/扩展它们还是忽略它们？

我对此感到困惑的原因是，根据文档，树控件使用存储在其“dataDescriptor”属性中的对象来解析和操作存储在其“dataProvider”属性中的实际数据。

这似乎是有道理的，直到您意识到除非您对它进行子类化，否则**操作数据的绝不是 Tree 控件（如果启用了拖放，则除外），也不是 dataDescriptor**。相反，在所有示例中，操作数据都是通过 dataProvider 对象直接发生的，这会触发 Tree 控件中的事件处理程序。

什么是我没有得到这里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T18:12:38.723

看看`mx.controls.treeClasses.HierarchicalCollectionView`。它不是公共 API 的一部分，但它的完整源代码可作为 Flex 的一部分获得。Tree 控制器在内部使用此类来处理各种数据源。

# c# - 如何在 Visual Studio 2008 中创建柱状报表 - Crystal Reports

> ID：454082
> 
> 赞同：0
> 
> 时间：2009-01-17T21:23:51.533
> 
> 标签：c#, visual-studio-2008, crystal-reports, crosstab

我正在尝试在水晶报告中总结数据。我想在水晶中创建数据的柱状视图，但不知道该怎么做。我想使用交叉表，但是当我尝试插入时，控件永远不会出现。我创建了一个交叉表报告，但完成后，它是一个空白报告。我希望它是这样的[，](http://img123.imageshack.us/my.php?image=61519307xx5.jpg)除了列是车辆类别，行是单独的费用

1 - 知道我做错了什么，2 - 有没有更好的方法来做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-31T20:01:59.753

好吧，我又要去拿死灵法师徽章了。:)

您应该能够打开 Cross-Tab 专家，并将车辆类别作为列，单独的行将是单独的费用，而汇总的字段将是您想要汇总的内容（即车辆类别的计数）。在自定义样式选项卡上，确保在确保显示数据之前不要隐藏总计。还要确保您正在隐藏或隐藏要放置交叉表的部分。

我相信你现在已经解决了这个问题，但我想我会为你提供一个答案，这样如果没有别的办法，我可以尝试换一个新的徽章。:)

# java - 使用 Camel 动态限制 ActiveMQ 消息队列

> ID：454084
> 
> 赞同：2
> 
> 时间：2009-01-17T21:24:36.850
> 
> 标签：java, jms, activemq, apache-camel

我是一个 ActiveMQ / Camel 菜鸟，有一个特定的场景，我首先想知道是否有可能，其次是否有人​​可以提供一点方向。

基本上我需要在队列之外执行动态限制。IE 能够**在运行时**设置从队列中消耗特定消息组的速率。

因此，例如，我可能会添加一组以每秒 10 次的速度消耗的消息，另一组应该以每秒 1 次的速度消耗，依此类推。

我知道在骆驼中设置路由和将消息分组到队列等的基础知识，但只是无法从文档中弄清楚这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-19T12:38:16.483

您可以只使用 Camel 现有的[节流器](http://activemq.apache.org/camel/throttler.html)，然后为需要配置不同节流率的每种类型的消息使用不同的队列吗？

例如

```
from("activemq:Queue1.Input").
    throttle(20).
    to("activemq:Queue1.Output");  
from("activemq:Queue2.Input").
    throttle(5).
    to("activemq:Queue2.Output"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T09:08:40.610

为什么不在 Apache Camel JIRA 中添加 RFE？

您确定给定消息组的速率的逻辑是什么？

如果不同的消息组通过同一个限制器，它可能会变得复杂。它有点需要鉴别器来确定它属于哪个组的任何消息，因此应该通过限制器的速率。

如果您花一些时间填写您的用例并记录 RFE，那么我相信 Camel 社区的开发人员可以提供帮助。

您可以尝试自己实现它。基本上任何东西都是处理器，所以你可以做一个 from("activemq:queue:foo").process(myOwnThrottler).to("bean:handleMessage");

您可以在 Camel 中扩展一些类： - DelegateProcessor - DelayProcessorSupport - Throttler

* * *

克劳斯易卜生阿帕奇骆驼提交者

开源集成： http: [//fusesource.com](http://fusesource.com) 博客：[http ://davsclaus.blogspot.com/](http://davsclaus.blogspot.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T05:25:24.243

是的，看起来您正在寻找代理端节流以避免消费者阻塞。

您是否在 ActiveMQ 用户/开发者论坛上提出过您的请求？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:24:45.500

好的，我将更详细地布置场景，并据我所知突出主要障碍。

我有 2 组消息（实际上规模要大得多），每组都有不同的限制要求 - 假设我在消息头中将其指定为 flowRate 和 flowTime。

*   第 1 组：FlowRate = 1；flowTime = 60（每分钟 1 个）
*   第 2 组：FlowRate = 1；flowTime = 1（每秒 1 个）

我按照[Claus](https://stackoverflow.com/users/56384/claus-ibsen)实现了一个处理器，它检查标题字段并将它们用作延迟器输入。

我添加了来自第 1 组的 20000 条消息和来自第 2 组的 20000 条消息

因为节流器是消费者端，所以第 1 组激活的延迟器将通过快速填充其输入缓冲区而使其变慢，然后第 2 组消息将卡住......即使我按照[James](https://stackoverflow.com/users/12235/james-strachan)使用多个队列也是如此。

我意识到我可以使用 JMXGroupID 标头对消息进行分组并实现多个消费者，但不认为这会扩展到容纳*n 个*组的要求。

基本上，我想知道的是，是否有任何方法可以做代理，而不是消费者端节流，或其他解决方案，消费者可以在不最终阻塞的情况下进行节流。

希望我已经清楚地解释了自己，并感谢到目前为止的建议。

# javascript - 使用原型隐藏/清除输入字段

> ID：454104
> 
> 赞同：0
> 
> 时间：2009-01-17T21:38:43.170
> 
> 标签：javascript, forms, label, prototypejs, hide

我有以下脚本：

```
if (Object.isUndefined(Axent)) { var Axent = { } }
 Axent.SelfLabeledInput = Class.create({
initialize: function() {
    var labelSelector = arguments[0] || 'label';
    $$(labelSelector).findAll(function(l) {return (l.readAttribute('for') !== null)}).each(function(l){
        l.hide();
        $(l.readAttribute('for'))._value = l.innerHTML;
        if ($(l.readAttribute('for')).value.empty()) {
            $(l.readAttribute('for')).value = $(l.readAttribute('for'))._value
        }
        $(l.readAttribute('for')).observe('blur',function(e){if(Event.element(e).value == '') Event.element(e).value = Event.element(e)._value;});
        $(l.readAttribute('for')).observe('focus',function(e){if(Event.element(e).value == Event.element(e)._value) Event.element(e).value = '';});
    });
}
}); 
```

和以下形式：

```
 <form name="comform" action="#" method="post" id="commentform">
    <div class="input"> 
<p>
<label for="comment">Type your comment here...</label>
<textarea name="comment" id="comment" rows="8" cols="10" class="" ></textarea>
</p>
</div>
    <div class="input">
<p>
<label for="author">Name (required)</label>        
<input type="text" name="author" id="author" size="22" class=""/>
</p>
</div>
    <div class="input">
<p>
<label for="email">Email (gravatar enabled) (required)</label>         
<input type="text" name="email" id="email" size="22" class=""/>
</p>
</div>
    <div class="input">
<p>
<label for="url">Website (optional)</label>        
<input type="text" name="url" id="url" size="22" />
</p>
</div>
    <div class="submit">
<input type="submit" name="submit" id="sub" value="Leave comment" /> 
<input type="hidden" name="comment_post_ID" id="hidden" value=""> 
</div>

</form> 
<script type="text/javascript">
//<![CDATA[
new Axent.SelfLabeledInput('#commentform label');
//]]>
</script> 
```

我想从这个脚本编写一个函数，这样当我在这个表单上按下提交，并且输入字段被聚焦时，它会隐藏/清除它，所以它不会被提交到数据库。

这适用于最新的原型库。我不知道任何 JavaScript，所以我需要你的帮助。我在我的 WordPress 评论区使用这个表格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T12:56:17.017

我终于让它工作了！如果其他人想要运行它，这是最终代码：

```
if (Object.isUndefined(Axent)) { var Axent = { } }
Axent.SelfLabeledInput = Class.create({
initialize: function() {
    var labelSelector = arguments[0] || 'label';
    $$(labelSelector).findAll(function(l) {return (l.readAttribute('for') !== null)}).each(function(l){
            l.hide();
            var el = $(l.readAttribute('for'));
            el._value = l.innerHTML;
            if (el.value.empty()) {
                    el.value = el._value
            }
            el.observe('blur',function(e){if(Event.element(e).value == '') Event.element(e).value = Event.element(e)._value;});
            el.observe('focus',function(e){if(Event.element(e).value == Event.element(e)._value) Event.element(e).value = '';});
    $(el.form).observe( 'submit', (function(thisel) { return function(e) {
            if( thisel.value == thisel._value ) { thisel.value = '' }
    }})(el));
    });
}}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T23:02:41.207

您不必担心，标签不会被提交。

此脚本将在提交时从 DOM 中删除标签。它必须在 DOM 加载后运行（好吧，至少是表单）**，如果您的表单元素在标签内，它们也会消失！**

```
document.getElementById( 'commentform' ).onsubmit = function() {
    var labels = this.getElementsByTagName( 'label' );
    while( labels[0] ) {
        labels[0].parentNode.removeChild( labels[0] );
    }
    return true;
} 
```

这不是原型脚本。这是**普通****的**老J **avascript**。

 ***** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:34:55.233

元素预先填充了标签文本。如果元素仍然为空，则默认文本会在焦点上消失并重新出现在模糊中。

你可以试试这个。我不使用原型，所以在某些地方是猜测。

```
if (Object.isUndefined(Axent)) { var Axent = { } }
Axent.SelfLabeledInput = Class.create({
initialize: function() {
    var labelSelector = arguments[0] || 'label';
    $$(labelSelector).findAll(function(l) {return (l.readAttribute('for') !== null)}).each(function(l){
        l.hide();
        var el = $(l.readAttribute('for'));
        el._value = l.innerHTML;
        if (el.value.empty()) {
            el.value = el._value
        }
        el.observe('blur',function(e){if(Event.element(e).value == '') Event.element(e).value = Event.element(e)._value;});
        el.observe('focus',function(e){if(Event.element(e).value == Event.element(e)._value) Event.element(e).value = '';});
        $(el.form).observe( 'submit', (function(thisel) { return function(e) {
            if( thisel.value == thisel._value ) { thisel.value = '' }
        }})(el));
    });
} 
```

# c# - 亚马逊网络服务的简单使用

> ID：454109
> 
> 赞同：0
> 
> 时间：2009-01-17T21:41:52.510
> 
> 标签：c#, amazon

我正在尝试使用 C# 中的 Amazon Web 服务，但我找不到任何资源来帮助我入门。我只想检索电影、书籍和电影的艺术作品，但我能找到的唯一指南是企业级应用程序和服务。有谁知道在哪里看？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T21:53:23.920

Coding4fun 有一篇很好的文章专门解释了书籍封面的下载：

[Coding4fun](http://blogs.msdn.com/coding4fun/archive/2006/10/31/912260.aspx)

亚马逊在围绕他们的服务建立社区方面做得很好：

[这是在 C# 中访问](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=891&categoryID=199)书籍详细信息的具体示例

我对亚马逊的主要抱怨是他们不断更改服务的名称，它访问书籍/CD/等它曾经是亚马逊电子商务服务，但现在似乎被称为亚马逊联合网络服务。

# c# - C# 多态性 - 如何不对类型进行硬编码

> ID：454113
> 
> 赞同：1
> 
> 时间：2009-01-17T21:44:32.083
> 
> 标签：c#, oop

我正在制作一个简单的面向对象的测试程序来尝试帮助我掌握 OOP。我有一个具有方法 Run(params object[] parameters) 的 ICommand 接口，并且我有各种使用该接口并实现自己的运行版本的类。每个类还有一个 name 属性，它说明命令是什么以及它的作用。

我想要一个可以创建命令的 GUI，这可能需要某种列表框来选择要创建的命令类型。问题是，我如何制作该列表框并使其工作而无需在 switch 语句中进行硬编码，并显式引用我创建的所有类。

我确信这是一个非常简单的问题，我应该知道答案，但我就是想不出！我相信有一个答案。

哦，我希望一些回复会说阅读设计模式书：图书馆中唯一的副本目前已出版，但我会尽快阅读！

**更新：我刚刚在**[这里](https://stackoverflow.com/questions/454163/c-polymorphism-load-classes-from-dll-files)发布了一个后续问题

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T21:52:23.987

将所有类存储在 ICommand 的通用列表中，使用命令名称覆盖 ToString() 并将列表的内容应用于列表框。

```
var commandlist = new List<ICommand>();
commandList.add(new Command("Run"));
commandList.add(new Command("Walk"));
commandList.add(new Command("Crawl")); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T21:53:05.903

使用策略模式（[链接到维基百科](http://en.wikipedia.org/wiki/Strategy_pattern)），您将通过调用或反射执行该方法。因为例子很多，这里就不一一列举了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T22:13:41.027

我不确定您是否真的需要避免显式调用构造函数。但是，您*可以*通过反射来做到这一点 - 如果您的类型的构造函数不需要任何参数：

```
 var commands = new List<object>();
 foreach (Assembly assembly in AppDomain.CurrentDomain.GetAssemblies())
 {
    foreach (Type type in assembly.GetTypes())
    {
       if (type.GetInterface(typeof(ICommand).FullName) != null)
       {
          commands.Add(Activator.CreateInstance(type));
       }
    }
 } 
```

此代码假定定义 ICommand 实现的程序集已加载并且不执行任何所需的错误处理。

另一种方法是读取配置文件，其中包含要实例化的类型名称（甚至可能是要加载的程序集）。

但是，在大多数情况下，不需要这样做。拥有一个只调用一堆构造函数的 CommandFactory 类通常是完全可以的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-17T21:55:30.203

您可以使用反射找到所有实现您感兴趣的接口的类；然后用它来填充你的列表

# comments - 注释代码的重要性

> ID：454134
> 
> 赞同：3
> 
> 时间：2009-01-17T21:56:18.627
> 
> 标签：comments

你如何解释你的队友对他们编写的代码进行注释的重要性？我知道有些程序员写的是情节评论，而另一些人则留下了很多期待，当你阅读评论时你会期待什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-17T22:02:38.990

有一些最低要求：

1.  所有函数和类都应该注释掉
2.  Try/Catch 和异常处理最好被注释掉
3.  代码中硬编码的常量绝对应该是
4.  dummy objects 和 dummy classes，以及 TO-DO 部分应该被注释掉
5.  当您从 URL 中获取代码时，应在评论中引用该地址以供进一步考虑和版权侵权问题
6.  对版本控制系统的提交也应该得到很好的评论

虽然注释应该保持在最低限度，当一个 for 循环定义很明显时不需要注释，我通常为我的程序员设置基本规则，当它定义良好时他们会坚持它

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-17T22:09:35.073

最好的评论总是简明扼要，几句话。它应该说明代码中不明显的内容。我看到很多人发表了明显且因此无用的评论，例如：

```
if x==0 //if x equals 0 then... 
```

真的吗？！这只会“污染”代码，因为除非您正在学习如何编程，否则它毫无用处。

即使代码只是你的，你也应该写注释，就好像你要与另一个完全不知道它的程序员分享它一样。这样你就可以确保你永远理解它，并且从长远来看，如果有人出现并拿起那个代码，那个人将能够理解它并扩展/使用它。

我将评论视为可重用性的提升。我希望像其他所有程序员一样，通过一个简单、简洁的注释来完全理解一段代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T22:02:41.390

在编写不直观的代码时写注释。确实没有理由评论仅迭代数组的方法，但是当您修复错误或必须一起破解某些东西以解决问题时，最好发表评论，以便您可以在 6 个月后快速理解该代码（并且不要意外撤消它）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-17T22:02:42.577

注释代码是什么意思？实际代码，还是函数头？

如果您实际上是在谈论代码，那将是一个失败的原因。您需要让他们编写可读的代码并将其分解成有意义的块。注释不好的代码并不能使它成为好的代码，它只会留下不一致的混乱。

至于标头文档，您必须让它们捕获重要的事情（例如，惊喜、指令）并就琐碎的事情妥协（列出所有参数，重复签名所做的事情）。人们讨厌记录函数，因为大部分精力都花在编写几乎侮辱您的智力的琐碎文本上（例如，在 getHandleToFile() 上，“这会获取文件的句柄”）。由于实际上存在的重要细节比人们预期的要少得多，因此他们会感到惊喜，并且更有可能在这些特定情况下投入精力。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-17T22:03:17.130

我认为，如果您正在编写其他人可能有一天必须遵循的代码，那么谨慎地对正在做的事情发表好的评论是明智的。如果您只是为自己写一些东西，那么倾向于留下最少或根本没有。话虽如此，我已经“不那么奢侈”了，不得不回到我 8 年前写的代码并且没有充分评论，用一种我不再使用的语言（ASP 类），我可以告诉你，我希望我留下更多评论！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-17T22:45:08.233

我尝试评论我的大多数公共方法和类，在这些评论中，您可以阅读该方法的作用、参数的含义以及（如果适用）输出将是什么。

我有时也会在我的方法中添加评论，但是，我不会评论我在做什么，而是**为什么**我要那样做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-17T21:58:24.207

如果您编写的语言不是人类可读的，我建议非常细化的方法和过程级别的注释。

如果您编写的语言是人类可读的（C#、VB 等），我建议您在方法级别使用稍微详细的注释，在过程级别使用最少的注释。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-17T22:03:09.143

*   包括对方法和类的文档生成的注释。
*   不要评论每一行。
*   如果您正在做一些预期的事情或代码中不明显的事情，请在评论中解释原因。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-17T22:03:36.287

评论中最重要的是说实话。我一直在调查一个错误的次数，只是为了找到一段“不太明显”的代码以及一条评论说它应该做的事情与它正在做的事情相反。谁赢？你决定...

在相关说明中，任何比其记录的部分更长的评论*通常*太长。

# javascript - Greasemonkey：XPath 不返回 .xhtml 页面的结果

> ID：454143
> 
> 赞同：2
> 
> 时间：2009-01-17T21:59:55.703
> 
> 标签：javascript, xhtml, xpath, greasemonkey

在 xhtml 页面上运行时，xpath 似乎没有返回任何结果。

```
var result = document.evaluate( "//a/img", document.body, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null ); 
```

例如返回一个空的结果集。这里有什么问题，我该如何解决？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-17T23:08:11.197

xhtml 元素不在 null 命名空间中，因此您必须将[命名空间解析器](https://developer.mozilla.org/en/Introduction_to_using_XPath_in_JavaScript#Implementing_a_User_Defined_Namespace_Resolver)传递给该方法：

```
function resolver(prefix) {
    return prefix === 'x' ? 'http://www.w3.org/1999/xhtml' : null;
}
var result = document.evaluate( "//x:a/x:img", document.body, resolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-12-20T09:12:50.397

可以使用此解决方案，但我现在在 xpathExpression 中使用前兄弟，我尝试使用：

```
function nsResolver(prefix){
    var ns = {
        'mathml' : 'http://www.w3.org/1998/Math/MathML', // for example's sake only
        'h' : 'http://www.w3.org/1999/xhtml'
    };
    return ns[prefix];
} 
```

进而 ：

```
document.evaluate('//h:' + node.tagName + '/preceding-sibling::' + node.tagName, node, nsResolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotLength 
```

使用 xhtml 总是返回 0。

# c# - 如何在 .NET 安装中提示用户重新启动？

> ID：454147
> 
> 赞同：0
> 
> 时间：2009-01-17T22:01:02.550
> 
> 标签：c#, .net, installation, windows-installer

我正在使用 Visual Studio 2008 编写安装程序，而且我对安装程序完全陌生。我创建了一个安装并使用 C# 程序集成功编写了一些自定义操作。一个操作设置了一个 RunOnce 注册表值，现在我需要在安装完成时提示用户重新启动，但我不知道如何。我已经阅读了 Installer 类文档，但我找不到任何关于重新启动的内容。

我假设我需要以某种方式开始能够调用 MsiSetProperty 并设置 REBOOT 属性，但我不知道如何从我的[.NET](http://en.wikipedia.org/wiki/.NET_Framework)安装程序项目中做到这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T22:01:44.897

谢谢。我最终使用构建后事件通过以下命令运行批处理文件。最困难的部分是跟踪 WiRunSQL.vbs，它位于[“Windows 安装程序开发人员的 Windows SDK 组件”](http://msdn.microsoft.com/en-us/library/aa370834(VS.85).aspx)下载中。

```
cscript "C:\Program Files\Microsoft SDKs\Windows\v6.0\Samples\SysMgmt\MSI\scripts\WiRunSQl.vbs" my.msi "INSERT INTO `Property`(`Property`, `Value`) VALUES ('REBOOT', 'F')" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T22:04:15.617

如果您使用[WiX](http://en.wikipedia.org/wiki/WiX)实现安装程序，则需要添加以下内容：

```
<ScheduleReboot After="InstallFinalize"/> 
```

[如果您在Visual Studio](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio)中使用缩减的“安装程序”项目，我不确定......但是这里的链接[建议](http://www.omgili.com/newsgroups/microsoft/public/windows/msi/3CCCF4FC-564D-43D7-ACFD-26444AA72126microsoftcom.html)了一个[CScript](http://en.wikipedia.org/wiki/Windows_Script_Host#Available_scripting_engines)命令，该命令似乎显示了如何将 MSI 属性注入安装程序项目，就像你想做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T09:37:32.423

只需在 MSI 中初始设置属性，而不是尝试在运行时更新它。

无论如何，Visual Studio 2008 都附带了 WiX，有关更多详细信息，请参阅*[Visual Studio 附带的 WiX 工具集](http://robmensching.com/blog/posts/2007/11/26/Visual-Studio-ships-the-WiX-toolset)*。也就是说，我不是 Visual Studio 2008 用户，所以我不知道这是对以前的 Visual Studio 安装项目的补充还是替代。

# c# - C# 多态性 - 从 DLL 文件加载类

> ID：454163
> 
> 赞同：3
> 
> 时间：2009-01-17T22:10:12.313
> 
> 标签：c#, oop, dll

我对[这个问题](https://stackoverflow.com/questions/454113/c-polymorphism-how-not-to-hardcode-types)的回答已经解决了我在那个问题中遇到的问题，但我想知道是否可以扩展一点。例如，如果我要让第三方向这个系统贡献命令，是否有办法扩展我之前问题的第一个答案，以允许它从文件夹中的所有 DLL 加载所有命令，然后列出它们在列表框中。

那可能吗？它是否能够使用 ICommand 列表（正如我对上一个问题的回答所建议的那样）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-17T22:27:55.787

是的。

```
 Assembly commandAssembly = Assembly.Load("some/path")
 var commands = new List<ICommand>();

 foreach (Type type in commandAssembly.GetTypes())
 {
    if (type.GetInterface(typeof(ICommand).FullName) != null)
    {
       commands.Add((ICommand)Activator.CreateInstance(type));
    }
 } 
```

但是，您可能会遇到有关程序集加载的一些限制。您不能只从任何地方加载程序集，否则您可以重新实现 COM DLL hell 之类的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T22:15:22.863

您可以将每个程序集加载到一个目录中，遍历程序集中的每个公开类，然后检查您的 ICommand 的实现。然后，您可以从那里通过创建这些对象的新实例将它们添加到您的内部系统。

一些错误检查的地方：

*   装配负载，确保它是 CLR。
*   构造：确保它不需要任何参数并且它具有公共构造函数。
*   构造：确保它不是抽象类。

# asp.net - 获取当前在线用户？

> ID：454165
> 
> 赞同：0
> 
> 时间：2009-01-17T22:10:56.383
> 
> 标签：asp.net, global-asax

谷歌搜索了一下后，我发现了一些关于如何使用 ASP.NET 获得在线用户的提示。但我正在使用我自己的课程作为会员资格。

我查到的资料是：

1.  用户登录时将用户 sessionId 记录到数据库
2.  当他们的会话超时时将他们注销

您对此有何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T23:44:19.750

我找到了这篇很棒的[文章](http://blog.sb2.fr/post/2008/12/01/HowTo-Get-Current-Online-Users-Count-and-Infos-with-ASPNET.aspx)

希望能帮助某人

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T22:31:17.183

我们在工作中使用这种方法，以便当用户在单独但并发的会话中将数据上传到 Web 服务时，我们可以捕获 90% 发生超时的情况，并在当场警告用户。

我们没有抓住每一个案例，因为：

*   global.asax 中的会话超时事件处理程序在到期发生时不可靠地调用 (IIRC)
*   同时，用户可能已经关闭了他们的浏览器窗口。

我知道的两种常见方法是：

*   任何用户操作都会导致更新用户表中的 LastActionTime。使用此值 + 20 分钟（或任何您的会话超时值）可以很好地指示谁已登录
*   每隔几秒更新一次的小型 AJAX 面板（与上一个选项相关联）。

# hardware - 暂存、测试和版本控制服务器规范建议

> ID：454166
> 
> 赞同：0
> 
> 时间：2009-01-17T22:11:47.003
> 
> 标签：hardware, windows-server-2008

我将与一些外部开发人员一起为一些 ASP.NET 项目工作，并希望为版本控制、测试和暂存客户端站点设置一个位于同一位置的服务器，直到它们准备好部署。

我已经有了 ISP，并且有一个 10 兆位的连接，可以突发到 100，所以我认为带宽不会成为问题。

我的问题是，服务器本身应该有什么规格？我正在考虑购买具有以下规格的戴尔服务器：

*   双核 Intel Pentium E2180，2.0GHz，1MB 高速缓存，800MHz FSB
*   4GB, DDR2, 800MHz, 4x1GB, 双排 DIMM
*   RAID 1 160GB 7.2K RPM SATA 3Gbps 硬盘
*   视窗服务器 2008

这足够了吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T22:33:24.417

如果项目不是太大，那看起来不错。我在大型项目中使用版本控制系统的经验是，内存往往是最大的瓶颈。如果项目很大，我会确保你可以升级到 8GB RAM。

# mysql - 如何清空mysql中所有表的所有行（在sql中）

> ID：454174
> 
> 赞同：36
> 
> 时间：2009-01-17T22:16:46.323
> 
> 标签：mysql

我正在编写一些 db 实用程序脚本，我需要做的任务之一是仅重建数据，但保持架构不变。使用 bash 和 mysql 工具（无 php 等）从命令行自动执行此操作的最简单方法是什么？

更新：我希望在一个命令中处理所有表的解决方案，如果可能，如果添加或删除表，则不需要更新。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-01-17T22:20:49.810

```
TRUNCATE tableName; 
```

这将清空表格的内容。

编辑以响应 Q 编辑：从我的快速测试看来，您必须至少执行 2 个查询，因为“显示表”似乎不能用作子查询，我不知道如何在bash 所以这是一个 PHP 示例，希望它会有所帮助。

```
<?php      
mysql_connect('localhost', 'user', 'password');
$dbName = "database";
mysql_select_db($dbName); /*added semi-colon*/
$result_t = mysql_query("SHOW TABLES");
while($row = mysql_fetch_assoc($result_t))
{
   mysql_query("TRUNCATE " . $row['Tables_in_' . $dbName]);
}
?> 
```

至少这需要一些错误处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-17T22:33:08.210

如果你在 unix/linux 上，你可以使用 shell 来运行：

```
mysqldump -u[USERNAME] -p[PASSWORD] --add-drop-table --no-data [DATABASE] | grep ^DROP | mysql -u[USERNAME] -p[PASSWORD] [DATABASE] 
```

或者 Rational Relational 有[一篇](http://blog.shlomoid.com/2008/06/how-to-truncate-all-or-some-of-tables.html)关于如何编写存储过程来执行此操作的博客文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T22:55:40.037

这是一个 BASH 单行程序，用于从数据库列表中截断所有表：

```
for j in database_name1 database_name2; \
do for i in `echo 'show tables ' |mysql $j \
|grep -v 'Tables_in'`; do mysql $j -e "truncate $i"; done; done 
```

请注意，截断将在没有任何提示的情况下从目标表中删除所有数据。也许首先将“truncate $i”更改为“describe $i”，以确保结果集中的表是要清空的表。

还有一件事：如果你想遍历所有 MySQL 数据库中的每个表（除了`information_schema`and `mysql`，我希望！），用下面的替换上面的“database_name1 database_name2”：

```
`echo 'show databases' | mysql | awk '$1 != "information_schema" && \
$1 != "mysql" {if (NR > 1) {print}}'` 
```

所以，这是一个破坏性较小的样本；它对每个 MySQL 数据库中的所有表执行 OPTIMIZE（如上所述的例外情况）：

```
for j in `echo 'show databases' | mysql | \
awk '$1 != "information_schema" && $1 != \
"mysql" {if (NR > 1) {print}}'`; do for i in \
`echo 'show tables ' |mysql $j |grep -v \
'Tables_in'`; do mysql -e "optimize table $j.$i"; \
done; done 
```

根据需要修改执行的“动作”，并且非常恐惧！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-07T08:52:50.287

对于想要通过 phpMyAdmin 执行此操作的人，请查看以下问题：

[如何在不删除数据库的情况下在 phpMyAdmin 中删除数据库中所有表的内容？](https://stackoverflow.com/questions/2529763/how-can-i-delete-the-contents-of-all-tables-in-my-database-in-phpmyadmin-without/5217579#5217579)

# javascript - 是否有任何不会弄乱代码的所见即所得 HTML 编辑器？

> ID：454175
> 
> 赞同：3
> 
> 时间：2009-01-17T22:16:47.400
> 
> 标签：javascript, html, css, wysiwyg

我尝试了各种编辑器，包括桌面应用程序和基于 Web 的 RTE，但没有找到任何效果很好的东西。他们经常弄乱代码，添加“标签汤”。即使是那些声称只生成有效代码的代码，也经常会产生一堆乱七八糟的跨度标签和样式属性。

以下是我正在寻找的一些功能：

*   主要用作“内容创建”，而不是创建整个页面或网站（我通常手动进行设计）
*   支持所有 HTML 标签（包括`<small>`、`<code>`、`<kbd>`等`<dl>`）
*   可以将类附加到当前元素 - 许多编辑器会插入 span 标签，从而导致混乱，例如：`<p><span style="...">...</span></p>`
*   不会更改我添加的代码（我让编辑器删除了隐藏的输入字段和其他内容）
*   不添加不推荐使用的属性，例如边框和单元格填充通常会添加到图像和表格上。
*   如果它可以选择我用于页面的样式表并明显应用我选择的样式，我会喜欢它
*   如果它是桌面应用程序，基于 Linux 将是一大优势

有人有什么建议吗？以下是我尝试过的一些：TinyMCE、FCKeditor 和网络上的其他各种；桌面上的 Dreamweaver（简要）、Expression Web 和 KompoZer。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T22:37:58.653

好吧，我不知道所有现有的所见即所得编辑器，但是您是否考虑过使用代码编辑器并手动创建 HTML 代码的替代方法？我知道第一手听起来可能很疯狂，但相信我，当你开始对它感到满意时，你会变得更有效率，代码更干净，当然，你会得到更多的灵活性。

我个人不喜欢dreamweaver，但它的代码编辑器非常好，因为智能感知可以帮助你记住标签和属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T22:23:48.323

我还没有尝试过，但请阅读：您可以尝试[Amaya](http://www.w3.org/Amaya/)网络编辑器（如果您对此编辑器有任何意见，我想阅读它们）。

我希望它主要符合标准（但是，不运行 javascript）。

# naming-conventions - 什么是可读代码？命名变量时要遵循的最佳实践是什么？

> ID：454178
> 
> 赞同：2
> 
> 时间：2009-01-17T22:20:07.487
> 
> 标签：naming-conventions, variables

你认为 x、y、z 是好的变量名吗？你将如何解释一个新程序员编写可读代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-17T22:29:22.930

如前所述，x、y 和 z 是 3D 坐标的好变量，但可能对其他任何东西都不好......

如果有人不相信名称很重要，只需在某些代码上使用代码混淆器，然后让他们调试它:-)。

（顺便说一句，这是代码混淆器有用的唯一情况恕我直言）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-17T23:07:07.453

可读代码意味着注释、变量和函数命名的某种组合，它允许我阅读代码一次并理解它。如果我必须不止一次地阅读它，或者花时间处理复杂的循环或函数，那么还有改进的余地。

文件和类顶部的良好摘要描述有助于为读者提供上下文和背景信息。

清晰的名称很重要。冗长的名称使编写可读代码更容易，注释更少。

编写可读代码是一项需要一些时间来学习的技能。我个人喜欢过于冗长的名称，因为它们会创建自我记录的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T22:55:08.070

每种编程语言的约定似乎略有不同；然而，这些天的共识是......

*   使用帕斯卡大小写
*   使名字有意义
*   以名词结尾

以下是对 Microsoft 作为 .NET 标准命名约定发布的内容的一个[不错的回顾](http://www.irritatedvowel.com/Programming/Standards.aspx)

python 的发明者发布了包含命名约定的[样式指南。](http://www.python.org/dev/peps/pep-0008/)

曾经有一段时间，Microsoft VC++ 开发人员（包括我自己）实际上围绕着所谓的匈牙利表示法（ [Hungarian Notation ）团结起来](http://msdn.microsoft.com/en-us/library/aa260976.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-17T22:22:42.833

当然，对此有多种思想流派，但我只会将这些用于计数器，并建议为任何其他变量提供更具描述性的名称。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T22:23:58.960

x、y 和 z 可以是非常好的变量名。例如，您可能正在编写参考 3D 笛卡尔坐标系引用它们的代码。这些名称通常用于此类系统中的三个轴，因此它们非常适合。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-17T22:25:46.820

我会给他们一些代码维护工作，这些代码带有名为 x、y、z 的变量，并让他们自己意识到可读性是至关重要的......

95% 的代码查看不是作者，而是大家都忘记的客户——下一个程序员。你有责任让她过上轻松的生活。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-17T22:25:56.600

好的变量名准确地描述了它们是什么，而不会过于复杂。我总是使用描述性名称，即使在循环中（例如，`index`而不是`i`）。它有助于跟踪正在发生的事情，尤其是当我正在重写一段特别复杂的代码时。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-17T22:26:03.747

那么给他们一大块糟糕的代码并要求他们调试它。
采取以下代码（简单示例）

```
<?php $a = fopen('/path/to/file.ext', 'w');$b = "NEW LINE\n";fwrite($a, $b);fclose($a);?> 
```

错误是：文件应该是日志时只包含 1 行问题：fopen 中的“w”应该是“a”

这显然是一个超级简单的例子，如果你想给他们一个更大更复杂的例子，给他们[WMD 源代码](https://blog.stackoverflow.com/2009/01/wmd-editor-reverse-engineered/)，并要求他们在 2 小时内给你可读的代码，它会让你明白你的意思。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-17T22:26:56.443

如果 x、y 和 z 表示 3d 坐标，或者如果它们用于迭代 2 或 3 维数组，则它们是可接受的变量名称。

就我而言，这段代码很好：

```
for(int x = 0; x < xsize ; x++)
{
  for(int y = 0; y < ysize ; y++)
  {
    for(int z = 0; z < zsize ; z++)
    {
      DoSomething(data[x][y][z]);
... 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-17T22:27:10.703

只要 x、y 和 z 是（3D）笛卡尔坐标，那么它们就是好名字。

类似地，i、j 和 k 对于循环变量也是可以的。

在所有情况下，变量名称都应与数据相关

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-17T22:38:44.593

这是一个简短的答案，但对我来说效果很好：

如果它*需要*一个代码注释来描述它，那么重新考虑变量名。

因此，如果很明显，为什么选择“x”，那么它们就是好名字。例如，“i”作为循环中的变量名（通常）非常明显。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-17T22:41:55.413

理想的变量名称既简短（使代码更紧凑）又具有描述性（有助于理解代码）。

对于两者中哪一个更重要，意见不一。就个人而言，我会说这取决于变量的范围。仅在 3 行循环内使用的变量可以避免成为单个字母。500 行类中的类字段最好是非常具有描述性的。[Spartan Programming](http://ssdl-wiki.cs.technion.ac.il/wiki/index.php/Spartan_programming)哲学说，所有代码单元都应该尽可能小，以便变量名可以非常短。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-17T22:50:53.667

可读的代码和好的命名约定不是一回事！

变量的好名称是允许您在不查看使用它的上下文的情况下理解（或合理猜测）变量的用途和类型的名称。因此，“x”、“y”和“z”表示坐标，因为这是一个合理的猜测。相反，一个坏名字会导致你做出错误的猜测。例如，如果“x”“y”和“z”代表人。

函数的好名称是传达您需要了解的有关它的所有信息，而无需查阅其文档。这并不总是可能的。

可读代码首先是其结构可以理解的代码，即使您混淆了所有变量和函数名称。如果您这样做并且无法轻松弄清楚控制结构，那么您就完蛋了。

一旦你有可读的代码和好的命名，那么也许你就会有真正可读的代码。

# java - 从 Java 调用 Python 模块

> ID：454182
> 
> 赞同：7
> 
> 时间：2009-01-17T22:22:30.227
> 
> 标签：java, python, ipc

我有一个用 C - igraph（库的名称）编写的图形库的 Python 接口。我的需要是从 Java 代码中调用与此图形库有关的 python 模块。就像这样，库的核心是在 c 中。该内核已导入 Python，并且内核中嵌入的函数的接口在 Python 中可用。我项目的其余代码是用 Java 编写的，因此我也想用 Java 调用图形函数。Jython - 允许您在 Java 中调用 python 模块是一个选项。我继续尝试 Jython 发现它在我的情况下不起作用，因为核心代码在 C 中，并且 Jython 不支持在 python 中作为 ac dll 导入的任何内容代码。我也想过选择直接在c中调用图形例程的方法。那是不通过 Python 代码。我假设一定有一些东西可以让你从 Java 调用 c 代码，但是我在 C 方面做得不好，所以我没有去。我最后的手段似乎是使用 Java 从命令行执行 Python 解释器。但那是一种肮脏和无耻的行为。此外，为了处理 Python 代码产生的结果，我必须将结果写入文件并用 java 读回。再次肮脏的方式。有什么可以建议我的吗？感谢每一位付出的时间。有什么可以建议我的吗？感谢每一位付出的时间。有什么可以建议我的吗？感谢每一位付出的时间。

* * *

感谢伊格尔的回答。我看过了。乍一看，它似乎只是在调用 python 脚本。

```
Jep jep = new Jep(false, SCRIPT_PATH, cl);
jep.set("query", query);
jep.runScript(SCRIPT_PATH + file);
jep.close(); 
```

如果从命令行通过 Java 代码调用 python 解释器，这不是很相似吗？

```
Runtime runtime = Runtime.getRuntime();
Process proc = runtime.exec("python test.py"); 
```

关心的是如何使用 Python 脚本生成的结果。天真的方法是将它们写入文件并用 Java 读回。我正在寻找一种更聪明的方法。无论如何，感谢您的建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-17T22:36:17.610

从未尝试过。但我最近[偶然发现](http://www.miketec.org/serendipity/index.php?/archives/9-Sure,-Change-Jobs!.html)了一个[名为 Jepp 的项目](http://jepp.sourceforge.net/)，你可能会感兴趣。

> Jepp 在 Java 中嵌入了 CPython。在多线程环境中使用是安全的，速度非常快，稳定性是主要功能和目标。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-25T00:54:15.133

如果你想从 Java 调用 C 函数，[JNA](https://github.com/twall/jna/)（Java Native Access）可能是要走的路。JNA 允许您调用本机库中的函数，而无需编写 C 胶水代码（就像使用 JNI 时必须那样），并自动在 Java 和 C 中的原始数据类型之间进行映射。一个简单的示例可能如下所示：

```
import com.sun.jna.Native;
import com.sun.jna.Library;

public class PrintfWrapper {
    public interface CLibrary extends Library {
        CLibrary INSTANCE = (CLibrary)Native.loadLibrary("c", CLibrary.class);
        void printf(String formatString, Object... args);
    }

    public static void main(String[] args) {
        CLibrary.INSTANCE.printf("Hello, world\n");
    }
} 
```

但是，使用 igraph 会使事情变得复杂，因为 igraph 使用许多无法直接映射到 Java 对应物的数据结构。有一个名为[JNAerator](http://jnaerator.googlecode.com/)的项目应该能够从 igraph 的头文件生成 JNA 源，但我从未尝试过它，结果可能仍需要一些手动调整。

另请注意，[igraph 的 Java 接口](https://code.launchpad.net/~ntamas/igraph/0.6-java)正在缓慢而稳定地开发，它可能会在几个月左右变得有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-28T21:37:21.970

您可以使用 jep.getValue() 从脚本的全局字典中检索值。

关于 Python 中的作用域级别有一些警告，因此大多数人发现将 Java 类传递给 Python 并在 Python 中设置该实例中的返回值更清楚。脚本完成后，Java 代码将获得结果。

例如：

==> 爪哇

```
class ReturnValueClass {
   public int scriptResult;
};
ReturnValueClass value = new ReturnValueClass();
jep.set("retval", value); 
```

==> 蟒蛇

```
# do something
pass
# write the return value
retval.scriptResult = some_python_value 
```

==> 爪哇

```
System.out.println(value.scriptResult); 
```

希望有帮助，

迈克（我写了 Jep）

# c# - 我可以在外部 DLL 中使用 ASP.NET Session[] 变量吗

> ID：454187
> 
> 赞同：5
> 
> 时间：2009-01-17T22:24:57.227
> 
> 标签：c#, asp.net, session-state, session-variables

我有两个项目，一个包含我所有的逻辑和数据访问内容的 DLL 项目，以及一个完成我的表单等的 ASP.NET 项目。

我有点困惑。我想如果我将 System.Web 命名空间引用添加到 DLL 项目中，我将能够引用 ASP.NET 页面的会话状态信息。

我可以使用每个页面来获取会话信息并将其传递给 DLL 进行处理，但我希望能够直接从 DLL 类处理事物。

这可能吗？

我已经摆弄了 System.Web 命名空间，并且似乎能够获得对 Session 变量的引用。

谢谢大家。

乔恩

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-17T22:27:09.720

只要将Assembly 加载到Session 的范围内，它就可以访问。

虽然这种类型的紧密耦合并不真正推荐。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-17T22:28:34.227

您应该能够使用 HttpContext.Current.Session

# 编辑

虽然是的，但我同意您不应该将您的业务逻辑 DAL 或其他程序集紧密耦合到 ASP.Net 会话。在 Web 项目之外访问 HTTP 上下文有很多有效的案例。

Web Controls 可能是最好的例子之一，可重用的 HTTP 模块等。

现在一个选项，如果你想让你的 DLL 从 Session 中提取东西，就是抽象出会话。所以你可以定义一个像 IStorage 这样的接口，你的库会知道如何使用它。然后，您可以拥有一个 SessionStorage 或 MemoryStorage 类，并使用 IoC 将适当的类注入到您的库类中。这使您可以自由地对其进行编码，而无需将代码绑定到 Session。哦，如果做得好，另一个好处可以用来不将您的代码绑定到网络上的会话。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T22:34:34.620

您始终可以在 DLL 中使用 HttpContext.Current.Session ，但这被认为是不好的做法。更好的方法是将存储在会话字典中的值传递给您的 DLL，而不是引用会话。您将获得的另一个好处是您的 DLL 中的代码不会与 ASP.NET 运行时耦合，这意味着它将更容易测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-17T22:50:11.920

正如其他人所说，您始终可以在您的 DLL 中使用 HttpContext.Current.Session，我假设它是您的 BAL，但您需要非常小心。如果您的 DLL 稍后被 Windows 服务或其他没有 HTTPContext 的应用程序使用怎么办？每当我这样做时，它总是在一个属性获取方法中，我将访问 HttpContext.Current.Session 的尝试包装在一个 try catch 块中，如果出现任何问题，我会从数据库中取出所需的数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-10T06:43:50.183

不要使用 HttpContext.Current.Session，因为您的 dll 不会始终与 Web 应用程序一起运行。它可以与 Windows、Console itc 等任何其他应用程序一起运行。

如果您使用的是 ASP.Net 应用程序，最好使用实际接受参数的方法，该参数将来自会话值，否则将不会有任何应用程序的依赖关系。如果您的 dll 项目已经开发并且您正在尝试修改现有的业务逻辑，那么不，不要修改您的现有方法，使用重载方法。

# cocoa - 如果他们开始使用自定义 URL 方案，您将如何调试您的应用程序？

> ID：454188
> 
> 赞同：16
> 
> 时间：2009-01-17T22:25:19.770
> 
> 标签：cocoa, cocoa-touch, xcode

我正在为 iPhone 开发一个应用程序，但我想这个问题在 Mac 上是一样的。在应用程序的 URL 方案启动后，您使用什么方法来调试应用程序的状态？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-04-24T12:00:25.363

当应用程序从外部 URL 启动时，有一种方法可以调试应用程序：

1.  在您想要的位置设置断点`application:handleOpenURL:`或`application:didFinishLaunchingWithOptions:`
2.  在 Xcode 中，编辑 Active Executable 的设置。在“调试”选项卡上，选中“等待下一次启动/推送通知”复选框。
3.  构建和调试。控制台会提示您“等待 [AppName] 启动...调试器将在下次启动时附加到 [AppName]”。
4.  通过调用自定义 URL 或向其发送推送通知来打开您的应用程序。调试器将在您的断点处停止。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-03-07T14:42:25.540

我在 Xcode 8.2.1 上，最快的方法是简单地转到 Product -> Edit Scheme 并选择“等待可执行文件启动”，如下图所示。调试开始时，它不会启动应用程序，而是“等待“应用程序”启动..”。当一个动作（点击推送通知）时，断点就会启动。

[![在此处输入图像描述](https://i.stack.imgur.com/tdqUc.png)](https://i.stack.imgur.com/tdqUc.png)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T23:30:44.740

实际上，我认为在 Mac 上与在 iPhone 上会有很大不同，因为您可以在 Mac 上打开应用程序并调用 URL 方案，而在 iPhone 上，您需要退出应用程序才能打开另一个应用程序来调用 URL方案。

您可以尝试在您的 UI 中添加一个调试按钮，该按钮允许您从正在运行的应用程序内部调用 URL 方案（在 NSWorkspace 上调用 -openURL:）。在发送 URL 方案时，无论您的应用程序是打开还是关闭，这在理论上应该是相同的。

# javascript - 创建具有自动调整大小的文本区域

> ID：454202
> 
> 赞同：446
> 
> 时间：2009-01-17T22:30:42.113
> 
> 标签：javascript, html, resize, height, textarea

关于这个还有[另一个线程](https://stackoverflow.com/questions/7477/autosizing-textarea)，我已经尝试过了。但是有一个问题：`textarea`如果您删除内容，则不会缩小。我找不到任何方法将其缩小到正确的大小 - 该`clientHeight`值返回为 的完整大小，而`textarea`不是其内容。

该页面的代码如下：

```
function FitToContent(id, maxHeight)
{
   var text = id && id.style ? id : document.getElementById(id);
   if ( !text )
      return;

   var adjustedHeight = text.clientHeight;
   if ( !maxHeight || maxHeight > adjustedHeight )
   {
      adjustedHeight = Math.max(text.scrollHeight, adjustedHeight);
      if ( maxHeight )
         adjustedHeight = Math.min(maxHeight, adjustedHeight);
      if ( adjustedHeight > text.clientHeight )
         text.style.height = adjustedHeight + "px";
   }
}

window.onload = function() {
    document.getElementById("ta").onkeyup = function() {
      FitToContent( this, 500 )
    };
} 
```

* * *

## 回答 #1

> 赞同：529
> 
> 时间：2014-09-02T10:31:56.000

# 完整而简单的解决方案

**2020-05-14** 更新*（改进了对手机和平板电脑的浏览器支持）*

以下代码将起作用：

*   关于按键输入。
*   粘贴文本*（右键单击和 ctrl+v）。*
*   带有剪切文本*（右键单击和 ctrl+x）。*
*   带有预加载的文本。
*   在站点范围内使用所有文本区域*（多行文本框） 。*
*   使用**Firefox** *（经过 v31-67 测试）。*
*   使用**Chrome** *（经过 v37-74 测试）。*
*   使用**IE** *（经过 v9-v11 测试）。*
*   使用**Edge** *（经过 v14-v18 测试）。*
*   与**IOS Safari**。
*   使用**安卓浏览器**。
*   使用 JavaScript**严格模式**。
*   是否经过**w3c**验证。
*   并且是精简和高效的。

* * *

## 选项 1 *（使用 jQuery）*

此选项需要[jQuery](https://jquery.com/)，并且已经过测试，可用于**1.7.2** - **3.6**

**简单** *（将此 jquery 代码添加到您的主脚本文件并忘记它。）*

```
$("textarea").each(function () {
  this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
}).on("input", function () {
  this.style.height = "auto";
  this.style.height = (this.scrollHeight) + "px";
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<textarea placeholder="Type, paste, cut text here...">PRELOADED TEXT.
This javascript should now add better support for IOS browsers and Android browsers.</textarea>
<textarea placeholder="Type, paste, cut text here..."></textarea>
```

`[Test on jsfiddle](http://jsfiddle.net/n9uuv0hd/54/)`

* * *

## 选项 2 *（纯 JavaScript）*

**简单** *（将此 JavaScript 添加到您的主脚本文件中，然后忘记它。）*

```
const tx = document.getElementsByTagName("textarea");
for (let i = 0; i < tx.length; i++) {
  tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
  tx[i].addEventListener("input", OnInput, false);
}

function OnInput() {
  this.style.height = "auto";
  this.style.height = (this.scrollHeight) + "px";
}
```

```
<textarea placeholder="Type, paste, cut text here...">PRELOADED TEXT. This JavaScript should now add better support for IOS browsers and Android browsers.</textarea>
<textarea placeholder="Type, paste, cut text here..."></textarea>
```

`[Test on jsfiddle](http://jsfiddle.net/n9uuv0hd/80/)`

* * *

## 选项 3 *（jQuery 扩展）*

如果您想对要自动调整大小的文本区域应用进一步的链接，这很有用。

```
jQuery.fn.extend({
  autoHeight: function () {
    function autoHeight_(element) {
      return jQuery(element)
        .css({ "height": "auto", "overflow-y": "hidden" })
        .height(element.scrollHeight);
    }
    return this.each(function() {
      autoHeight_(this).on("input", function() {
        autoHeight_(this);
      });
    });
  }
}); 
```

调用`$("textarea").autoHeight()`

* * *

## 通过 JAVASCRIPT 更新文本区域

通过 JavaScript 将内容注入文本区域时，附加以下代码以调用选项 1 中的函数。

```
$("textarea").trigger("input"); 
```

* * *

## 预设文本区域高度

要修复 textarea 的初始高度，您需要添加一个附加条件：

```
const txHeight = 16;
const tx = document.getElementsByTagName("textarea");

for (let i = 0; i < tx.length; i++) {
  if (tx[i].value == '') {
    tx[i].setAttribute("style", "height:" + txHeight + "px;overflow-y:hidden;");
  } else {
    tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
  }
  tx[i].addEventListener("input", OnInput, false);
}

function OnInput(e) {
  this.style.height = "auto";
  this.style.height = (this.scrollHeight) + "px";
}
```

```
<textarea placeholder="Type, paste, cut text here...">PRELOADED TEXT. This JavaScript should now add better support for IOS browsers and Android browsers.</textarea>
<textarea placeholder="Type, paste, cut text here..."></textarea>
```

* * *

## 回答 #2

> 赞同：270
> 
> 时间：2011-03-18T00:21:52.737

这对我有用（Firefox 3.6/4.0 和 Chrome 10/11）：

```
var observe;
if (window.attachEvent) {
    observe = function (element, event, handler) {
        element.attachEvent('on'+event, handler);
    };
}
else {
    observe = function (element, event, handler) {
        element.addEventListener(event, handler, false);
    };
}
function init () {
    var text = document.getElementById('text');
    function resize () {
        text.style.height = 'auto';
        text.style.height = text.scrollHeight+'px';
    }
    /* 0-timeout to get the already changed text */
    function delayedResize () {
        window.setTimeout(resize, 0);
    }
    observe(text, 'change',  resize);
    observe(text, 'cut',     delayedResize);
    observe(text, 'paste',   delayedResize);
    observe(text, 'drop',    delayedResize);
    observe(text, 'keydown', delayedResize);

    text.focus();
    text.select();
    resize();
}
```

```
textarea {
    border: 0 none white;
    overflow: hidden;
    padding: 0;
    outline: none;
    background-color: #D0D0D0;
}
```

```
<body onload="init();">
<textarea rows="1" style="height:1em;" id="text"></textarea>
</body>
```

*如果你想在[jsfiddle](http://jsfiddle.net/hmelenok/WM6Gq/)*上试试 它从一行开始，只增长必要的确切数量。单个 s 是可以的`textarea`，但我想写一些我会有很多很多这样`textarea`的 s 的东西（大约和一个通常在大文本文档中的行一样多）。在那种情况下，它真的很慢。（在 Firefox 中它非常慢。）所以我真的想要一种使用纯 CSS 的方法。这将是可能的`contenteditable`，但我希望它是纯文本的。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2011-12-15T15:14:41.223

jQuery 解决方案调整 css 以符合您的要求

css...

```
div#container textarea {
    min-width: 270px;
    width: 270px;
    height: 22px;
    line-height: 24px;
    min-height: 22px;
    overflow-y: hidden; /* fixes scrollbar flash - kudos to @brettjonesdev */
    padding-top: 1.1em; /* fixes text jump on Enter keypress */
} 
```

javascript...

```
// auto adjust the height of
$('#container').delegate( 'textarea', 'keydown', function (){
    $(this).height( 0 );
    $(this).height( this.scrollHeight );
});
$('#container').find( 'textarea' ).keydown(); 
```

或替代 jQuery 1.7+...

```
// auto adjust the height of
$('#container').on( 'keyup', 'textarea', function (){
    $(this).height( 0 );
    $(this).height( this.scrollHeight );
});
$('#container').find( 'textarea' ).keyup(); 
```

我已经创建了一个绝对最小样式的小提琴作为您实验的起点...... [http://jsfiddle.net/53eAy/951/](http://jsfiddle.net/53eAy/951/)

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2012-07-24T09:48:57.747

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Textarea autoresize</title>
    <style>
    textarea {
        overflow: hidden;
    }
    </style>
    <script>
    function resizeTextarea(ev) {
        this.style.height = '24px';
        this.style.height = this.scrollHeight + 12 + 'px';
    }

    var te = document.querySelector('textarea');
    te.addEventListener('input', resizeTextarea);
    </script>
</head>
<body>
    <textarea></textarea>
</body>
</html> 
```

已在 Firefox 14 和 Chromium 18 中测试。数字 24 和 12 是任意的，请测试以查看最适合您的。

您可以不使用样式和脚本标签，但恕我直言，它会变得有点混乱（这是旧样式的 HTML+JS，不鼓励使用）。

```
<textarea style="overflow: hidden" onkeyup="this.style.height='24px'; this.style.height = this.scrollHeight + 12 + 'px';"></textarea> 
```

编辑：现代化的代码。将 onkeyup 属性更改为 addEventListener。
编辑：keydown 比 keyup 更好
编辑：在使用之前声明函数
编辑：输入比 keydown 更好（thnx @WASD42 & @MA-Maddin）

[jsfiddle](http://jsfiddle.net/GijsjanB/ErWxU/)

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2015-12-29T14:49:51.607

对我来说最好的解决方案（有效且简短）是：

```
 $(document).on('input', 'textarea', function () {
        $(this).outerHeight(38).outerHeight(this.scrollHeight); // 38 or '1em' -min-height
    }); 
```

它就像一个魅力，没有任何粘贴（也有鼠标）闪烁，剪切，进入并缩小到合适的大小。

请看一下[jsFiddle](https://jsfiddle.net/vatavale/0r9e84cr/9/)。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-01-18T00:52:10.690

您正在使用当前 clientHeight 和内容 scrollHeight 的较高值。当您通过删除内容使 scrollHeight 变小时，计算区域不会变小，因为之前由 style.height 设置的 clientHeight 将其保持打开状态。您可以取而代之的是 max() 的 scrollHeight 和您预定义或从 textarea.rows 计算的最小高度值。

一般来说，您可能不应该真正依赖表单控件上的 scrollHeight 。除了 scrollHeight 传统上不如其他一些 IE 扩展得到广泛支持之外，HTML/CSS 没有说明表单控件是如何在内部实现的，并且不能保证 scrollHeight 会有意义。（传统上，一些浏览器使用 OS 小部件来完成任务，这使得 CSS 和 DOM 无法在其内部进行交互。）在尝试启用效果之前至少嗅探 scrollHeight/clientHeight 的存在。

如果重要的是更广泛地工作很重要，另一种可能的避免该问题的替代方法可能是使用隐藏的 div，其大小与 textarea 的宽度相同，并设置为相同的字体。在 keyup 上，您将文本从 textarea 复制到隐藏 div 中的文本节点（记住用换行符替换 '\n'，如果您使用的是 innerHTML，请正确转义 '<'/'&'）。然后简单地测量 div 的 offsetHeight 会给你你需要的高度。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2019-12-30T08:06:10.373

[从这里](https://stackoverflow.com/questions/2803880/is-there-a-way-to-get-a-textarea-to-stretch-to-fit-its-content-without-using-php)找到一个班轮；

```
<textarea name="text" oninput="this.style.height = ''; this.style.height = this.scrollHeight +'px'"></textarea> 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2014-07-25T14:27:49.997

如果您不需要支持 IE8，您可以使用该`input`事件：

```
var resizingTextareas = [].slice.call(document.querySelectorAll('textarea[autoresize]'));

resizingTextareas.forEach(function(textarea) {
  textarea.addEventListener('input', autoresize, false);
});

function autoresize() {
  this.style.height = 'auto';
  this.style.height = this.scrollHeight+'px';
  this.scrollTop = this.scrollHeight;
  window.scrollTo(window.scrollLeft,(this.scrollTop+this.scrollHeight));
} 
```

现在你只需要添加一些 CSS 就完成了：

```
textarea[autoresize] {
  display: block;
  overflow: hidden;
  resize: none;
} 
```

**用法：**

```
<textarea autoresize>Type here and I’ll resize.</textarea> 
```

**[你可以在我的博客文章](https://max.hn/thoughts/autoresizing-textareas)**中阅读更多关于它是如何工作的。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2014-08-29T10:57:54.033

**自动尺寸**

[https://github.com/jackmoore/autosize](https://github.com/jackmoore/autosize)

Just works，独立，很受欢迎（截至 2018 年 10 月 3.0k+ GitHub 星），在[cdnjs](https://cdnjs.com/libraries/autosize.js)上可用）和轻量级（~3.5k）。演示：

```
<textarea id="autosize" style="width:200px;">a
J   b
c</textarea>
<script src="https://cdnjs.cloudflare.com/ajax/libs/autosize.js/4.0.2/autosize.min.js"></script>
<script>autosize(document.querySelectorAll('#autosize'));</script>
```

顺便说一句，如果您使用的是 ACE 编辑器，请使用`maxLines: Infinity`：[自动调整高度以适应 Ace Cloud 9 编辑器中的内容](https://stackoverflow.com/questions/11584061/automatically-adjust-height-to-contents-in-ace-cloud9-editor)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-10-16T20:09:28.197

有没有人认为contenteditable？不要乱用滚动，我唯一喜欢它的 JS 是如果你打算将数据保存在模糊上......显然，它在所有流行的浏览器上都兼容：http: [//caniuse.com/#feat =内容可编辑](http://caniuse.com/#feat=contenteditable)

只需将其设置为看起来像一个文本框，然后它会自动调整大小......使其最小高度成为首选文本高度并拥有它。

这种方法的好处在于您可以在某些浏览器上保存和标记。

[http://jsfiddle.net/gbutiri/v31o8xfo/](http://jsfiddle.net/gbutiri/v31o8xfo/)

```
var _auto_value = '';
$(document).on('blur', '.autosave', function(e) {
  var $this = $(this);
  if ($this.text().trim() == '') {
    $this.html('');
  }

  // The text is here. Do whatever you want with it.
  $this.addClass('saving');

  if (_auto_value !== $this.html() || $this.hasClass('error')) {

    // below code is for example only.
    $.ajax({
      url: '/echo/json/?action=xyz_abc',
      data: 'data=' + $this.html(),
      type: 'post',
      datatype: 'json',
      success: function(d) {
        console.log(d);
        $this.removeClass('saving error').addClass('saved');
        var k = setTimeout(function() {
          $this.removeClass('saved error')
        }, 500);
      },
      error: function() {
        $this.removeClass('saving').addClass('error');
      }
    });
  } else {
    $this.removeClass('saving');
  }
}).on('focus mouseup', '.autosave', function() {
  var $this = $(this);
  if ($this.text().trim() == '') {
    $this.html('');
  }
  _auto_value = $this.html();
}).on('keyup', '.autosave', function(e) {
  var $this = $(this);
  if ($this.text().trim() == '') {
    $this.html('');
  }
});
```

```
body {
  background: #3A3E3F;
  font-family: Arial;
}

label {
  font-size: 11px;
  color: #ddd;
}

.autoheight {
  min-height: 16px;
  font-size: 16px;
  margin: 0;
  padding: 10px;
  font-family: Arial;
  line-height: 20px;
  box-sizing: border-box;
  -o-box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  overflow: hidden;
  display: block;
  resize: none;
  border: 0;
  outline: none;
  min-width: 200px;
  background: #ddd;
  max-height: 400px;
  overflow: auto;
}

.autoheight:hover {
  background: #eee;
}

.autoheight:focus {
  background: #fff;
}

.autosave {
  -webkit-transition: all .2s;
  -moz-transition: all .2s;
  transition: all .2s;
  position: relative;
  float: none;
}

.autoheight * {
  margin: 0;
  padding: 0;
}

.autosave.saving {
  background: #ff9;
}

.autosave.saved {
  background: #9f9;
}

.autosave.error {
  background: #f99;
}

.autosave:hover {
  background: #eee;
}

.autosave:focus {
  background: #fff;
}

[contenteditable=true]:empty:before {
  content: attr(placeholder);
  color: #999;
  position: relative;
  top: 0px;
  /*
    For IE only, do this:
    position: absolute;
    top: 10px;
    */
  cursor: text;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<label>Your Name</label>
<div class="autoheight autosave contenteditable" contenteditable="true" placeholder="Your Name"></div>
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2018-03-24T14:40:25.030

作为另一种方法，您可以使用 a`<span>`自动调整其大小。您需要通过添加属性使其可编辑，`contenteditable="true"`然后您就完成了：

```
div {
  width: 200px;
}

span {
  border: 1px solid #000;
  padding: 5px;
}
```

```
<div>
  <span contenteditable="true">This text can be edited by the user</span>
</div>
```

这种方法的唯一问题是，如果您想将值作为表单的一部分提交，您必须自己在 JavaScript 中完成。这样做相对容易。例如，您可以添加一个隐藏字段，并在`onsubmit`表单的情况下将值分配给`span`隐藏字段，然后该隐藏字段将与表单一起自动提交。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-07-17T14:45:33.107

有一种稍微不同的方法。

```
<div style="position: relative">
  <pre style="white-space: pre-wrap; word-wrap: break-word"></pre>
  <textarea style="position: absolute; top: 0; left: 0; width: 100%; height: 100%"></textarea>
</div> 
```

这个想法是将文本复制`textarea`到 中，`pre`并让 CSS 确保它们具有相同的大小。

好处是框架提供了简单的工具来移动文本而不接触任何事件。即，在 AngularJS 中，您将`ng-model="foo" ng-trim="false"`在`textarea`和`ng-bind="foo + '\n'"`中添加一个`pre`. 见[小提琴](http://jsfiddle.net/Un73w/)。

只要确保它`pre`的字体大小与`textarea`.

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2011-06-23T15:10:50.767

我将以下代码用于多个文本区域。在 Chrome 12、Firefox 5 和 IE 9 中运行良好，即使在 textareas 中执行删除、剪切和粘贴操作也是如此。

```
function attachAutoResizeEvents() {
  for (i = 1; i <= 4; i++) {
    var txtX = document.getElementById('txt' + i)
    var minH = txtX.style.height.substr(0, txtX.style.height.indexOf('px'))
    txtX.onchange = new Function("resize(this," + minH + ")")
    txtX.onkeyup = new Function("resize(this," + minH + ")")
    txtX.onchange(txtX, minH)
  }
}

function resize(txtX, minH) {
  txtX.style.height = 'auto' // required when delete, cut or paste is performed
  txtX.style.height = txtX.scrollHeight + 'px'
  if (txtX.scrollHeight <= minH)
    txtX.style.height = minH + 'px'
}
window.onload = attachAutoResizeEvents
```

```
textarea {
  border: 0 none;
  overflow: hidden;
  outline: none;
  background-color: #eee
}
```

```
<textarea style='height:100px;font-family:arial' id="txt1"></textarea>
<textarea style='height:125px;font-family:arial' id="txt2"></textarea>
<textarea style='height:150px;font-family:arial' id="txt3"></textarea>
<textarea style='height:175px;font-family:arial' id="txt4"></textarea>
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2017-05-01T03:01:27.787

以下适用于剪切，粘贴等，无论这些操作是否来自鼠标，键盘快捷键，从菜单栏中选择一个选项......几个答案采用类似的方法，但它们不考虑框 -调整大小，这就是他们错误地应用样式的原因`overflow: hidden`。

我执行以下操作，这也适用于最小`max-height`和`rows`最大高度。

```
function adjust() {
  var style = this.currentStyle || window.getComputedStyle(this);
  var boxSizing = style.boxSizing === 'border-box'
      ? parseInt(style.borderBottomWidth, 10) +
        parseInt(style.borderTopWidth, 10)
      : 0;
  this.style.height = '';
  this.style.height = (this.scrollHeight + boxSizing) + 'px';
};

var textarea = document.getElementById("ta");
if ('onpropertychange' in textarea) { // IE
  textarea.onpropertychange = adjust;
} else if ('oninput' in textarea) {
  textarea.oninput = adjust;
}
setTimeout(adjust.bind(textarea));
```

```
textarea {
  resize: none;
  max-height: 150px;
  border: 1px solid #999;
  outline: none;
  font: 18px sans-serif;
  color: #333;
  width: 100%;
  padding: 8px 14px;
  box-sizing: border-box;
}
```

```
<textarea rows="3" id="ta">
Try adding several lines to this.
</textarea>
```

为了绝对完整性，您应该`adjust`在更多情况下调用该函数：

1.  窗口调整大小事件，如果宽度`textarea`随着窗口调整大小而改变，或者其他改变文本区域宽度的事件
2.  当`textarea`的`display`样式属性发生变化时，例如当它从`none`（隐藏）变为`block`
3.  当 的值以`textarea`编程方式更改时

请注意，使用`window.getComputedStyle`或获取`currentStyle`在计算上可能会有些昂贵，因此您可能希望缓存结果。

适用于 IE6，所以我真的希望这是足够好的支持。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-06-19T12:14:03.347

一点修正。在 Opera 中完美运行

```
 $('textarea').bind('keyup keypress', function() {
      $(this).height('');
      var brCount = this.value.split('\n').length;
      this.rows = brCount+1; //++ To remove twitching
      var areaH = this.scrollHeight,
          lineHeight = $(this).css('line-height').replace('px',''),
          calcRows = Math.floor(areaH/lineHeight);
      this.rows = calcRows;
  }); 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-08-29T20:08:53.933

这是 panzi 答案的 angularjs 指令。

```
 module.directive('autoHeight', function() {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
                element = element[0];
                var resize = function(){
                    element.style.height = 'auto';
                    element.style.height = (element.scrollHeight)+'px';
                };
                element.addEventListener('change', resize, false);
                element.addEventListener('cut',    resize, false);
                element.addEventListener('paste',  resize, false);
                element.addEventListener('drop',   resize, false);
                element.addEventListener('keydown',resize, false);

                setTimeout(resize, 100);
            }
        };
    }); 
```

HTML：

```
<textarea ng-model="foo" auto-height></textarea> 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2012-05-24T08:46:12.153

我知道用 jquery 实现这一点的一种简短而正确的方法。不需要额外的隐藏 div 并且可以在大多数浏览器中使用

```
<script type="text/javascript">$(function(){
$("textarea").live("keyup keydown",function(){
var h=$(this);
h.height(60).height(h[0].scrollHeight);//where 60 is minimum height of textarea
});});

</script> 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2014-07-31T20:58:47.517

一个更简单、更干净的方法是：

```
// adjust height of textarea.auto-height
$(document).on( 'keyup', 'textarea.auto-height', function (e){
    $(this).css('height', 'auto' ); // you can have this here or declared in CSS instead
    $(this).height( this.scrollHeight );
}).keyup(); 
```

// 和 CSS

```
textarea.auto-height {
    resize: vertical;
    max-height: 600px; /* set as you need it */
    height: auto;      /* can be set here of in JS */
    overflow-y: auto;
    word-wrap:break-word
} 
```

所需要做的就是将`.auto-height`类添加到`textarea`您想要定位的任何对象。

在 FF、Chrome 和 Safari 中测试。让我知道这是否对您不起作用，出于任何原因。但是，这是我发现它工作的最干净和最简单的方法。而且效果很好！:D

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2014-11-11T12:48:45.453

我不知道是否有人提到这种方式，但在某些情况下，可以使用 rows 属性调整高度

```
textarea.setAttribute('rows',breaks); 
```

[演示](http://jsfiddle.net/rspr06pL/1/)

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2018-11-28T00:10:22.797

`textarea`您可以在键入时使用 JQuery 来扩展：

```
$(document).find('textarea').each(function () {
  var offset = this.offsetHeight - this.clientHeight;

  $(this).on('keyup input focus', function () {
    $(this).css('height', 'auto').css('height', this.scrollHeight + offset);
  });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div>
<textarea name="note"></textarea>
<div>
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2019-04-15T16:52:19.150

那些想在新版本的 Angular 中实现相同目标的人。

抓取 textArea elementRef。

```
@ViewChild('textArea', { read: ElementRef }) textArea: ElementRef;

public autoShrinkGrow() {
    textArea.style.overflow = 'hidden';
    textArea.style.height = '0px';
    textArea.style.height = textArea.scrollHeight + 'px';
}

<textarea (keyup)="autoGrow()" #textArea></textarea> 
```

我还添加了另一个用例，一些用户阅读线程可能会派上用场，当用户想要将文本区域的高度增加到一定高度然后`overflow:scroll`在上面时，可以扩展上述方法以实现上述用例。

```
 public autoGrowShrinkToCertainHeight() {
    const textArea = this.textArea.nativeElement;
    if (textArea.scrollHeight > 77) {
      textArea.style.overflow = 'auto';
      return;
    }
    else {
      textArea.style.overflow = 'hidden';
      textArea.style.height = '0px';
      textArea.style.height = textArea.scrollHeight + 'px';
    }
  } 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-06-01T12:51:00.000

这里的一些答案不考虑填充。

假设您有一个不想超过的 maxHeight ，这对我有用：

```
 // obviously requires jQuery

    // element is the textarea DOM node

    var $el = $(element);
    // inner height is height + padding
    // outerHeight includes border (and possibly margins too?)
    var padding = $el.innerHeight() - $el.height();
    var originalHeight = $el.height();

    // XXX: Don't leave this hardcoded
    var maxHeight = 300;

    var adjust = function() {
        // reset it to the original height so that scrollHeight makes sense
        $el.height(originalHeight);

        // this is the desired height (adjusted to content size)
        var height = element.scrollHeight - padding;

        // If you don't want a maxHeight, you can ignore this
        height = Math.min(height, maxHeight);

        // Set the height to the new adjusted height
        $el.height(height);
    }

    // The input event only works on modern browsers
    element.addEventListener('input', adjust); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-09-12T06:01:30.047

此代码也适用于粘贴和选择删除。

```
onKeyPressTextMessage = function(){
			var textArea = event.currentTarget;
    	textArea.style.height = 'auto';
    	textArea.style.height = textArea.scrollHeight + 'px';
};
```

```
<textarea onkeyup="onKeyPressTextMessage(event)" name="welcomeContentTmpl" id="welcomeContent" onblur="onblurWelcomeTitle(event)" rows="2" cols="40" maxlength="320"></textarea>
```

这是[JSFiddle](https://jsfiddle.net/Kurenaikunai/zx2cmdmb/)

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-03-01T08:59:10.937

[我推荐来自http://javierjulio.github.io/textarea-autosize](http://javierjulio.github.io/textarea-autosize)的 javascript 库。

根据评论，添加有关插件使用的示例代码块：

```
<textarea class="js-auto-size" rows="1"></textarea>

<script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
<script src="jquery.textarea_autosize.min.js"></script>
<script>
$('textarea.js-auto-size').textareaAutoSize();
</script> 
```

最低要求的 CSS：

```
textarea {
  box-sizing: border-box;
  max-height: 160px; // optional but recommended
  min-height: 38px;
  overflow-x: hidden; // for Firefox (issue #5)
} 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2018-05-23T08:45:12.567

似乎没有一个答案有效。但这对我有用： [https ://coderwall.com/p/imkqoq/resize-textarea-to-fit-content](https://coderwall.com/p/imkqoq/resize-textarea-to-fit-content)

```
$('#content').on( 'change keyup keydown paste cut', 'textarea', function (){
    $(this).height(0).height(this.scrollHeight);
}).find( 'textarea' ).change(); 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-06-19T18:01:48.073

使用 qQuery 的 MakeTextAreaResisable

```
function MakeTextAreaResisable(id) {
    var o = $(id);
    o.css("overflow-y", "hidden");

    function ResizeTextArea() {
        o.height('auto');
        o.height(o[0].scrollHeight);
    }

    o.on('change', function (e) {
        ResizeTextArea();
    });

    o.on('cut paste drop keydown', function (e) {
        window.setTimeout(ResizeTextArea, 0);
    });

    o.focus();
    o.select();
    ResizeTextArea();
} 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2019-05-09T15:55:52.747

我的实现非常简单，计算输入中的行数（最少 2 行以显示它是一个文本区域）：

```
textarea.rows = Math.max(2, textarea.value.split("\n").length) // # oninput 
```

带有刺激的完整工作示例：[https ://jsbin.com/kajosolini/1/edit?html,js,output](https://jsbin.com/kajosolini/1/edit?html,js,output)

（例如，这适用于浏览器的手动调整大小句柄）

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2020-03-05T13:46:21.627

接受的答案工作正常。但这对于这个简单的功能来说是很多代码。下面的代码可以解决问题。

```
 $(document).on("keypress", "textarea", function (e) {
    var height = $(this).css("height");
    var iScrollHeight = $(this).prop("scrollHeight");
    $(this).css('height',iScrollHeight);
    }); 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2010-10-01T23:34:18.743

如果可以信任 scrollHeight ，那么：

```
textarea.onkeyup=function() {
  this.style.height='';
  this.rows=this.value.split('\n').length;
  this.style.height=this.scrollHeight+'px';
} 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2013-09-11T13:38:19.977

这是我在使用 MVC HTML Helper for TextArea 时所做的。我有很多 textarea 元素，所以必须使用模型 ID 来区分它们。

```
 @Html.TextAreaFor(m => m.Text, 2, 1, new { id = "text" + Model.Id, onkeyup = "resizeTextBox(" + Model.Id + ");" }) 
```

并在脚本中添加了这个：

```
 function resizeTextBox(ID) {            
        var text = document.getElementById('text' + ID);
        text.style.height = 'auto';
        text.style.height = text.scrollHeight + 'px';            
    } 
```

我在 IE10 和 Firefox23 上测试过

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-06-29T04:51:34.800

对于那些希望 textarea 在宽度和高度上自动调整大小的人：

HTML：

```
<textarea class='textbox'></textarea>
<div>
  <span class='tmp_textbox'></span>
</div> 
```

CSS：

```
.textbox,
.tmp_textbox {
  font-family: 'Arial';
  font-size: 12px;
  resize: none;
  overflow:hidden;
}

.tmp_textbox {
  display: none;
} 
```

jQuery：

```
$(function(){
  //alert($('.textbox').css('padding'))
  $('.textbox').on('keyup change', checkSize)
  $('.textbox').trigger('keyup')

  function checkSize(){
    var str = $(this).val().replace(/\r?\n/g, '<br/>');
    $('.tmp_textbox').html( str )
    console.log($(this).val())

    var strArr = str.split('<br/>')
    var row = strArr.length
    $('.textbox').attr('rows', row)
    $('.textbox').width( $('.tmp_textbox').width() + parseInt($('.textbox').css('padding')) * 2 + 10 )
  }
}) 
```

**代码笔：**

[http://codepen.io/anon/pen/yNpvJJ](http://codepen.io/anon/pen/yNpvJJ)

干杯，

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-07-02T10:15:28.773

jQuery 解决方案是将 textarea 的高度设置为“auto”，检查 scrollHeight，然后在每次 textarea 更改（[JSFiddle](https://jsfiddle.net/99qvbdhs/)）时调整 textarea 的高度：

```
$('textarea').on( 'input', function(){
    $(this).height( 'auto' ).height( this.scrollHeight );
}); 
```

如果您正在动态添加文本区域（通过 AJAX 或其他方式），您可以在 $(document).ready 中添加它，以确保所有具有“autoheight”类的文本区域与其内容保持相同的高度：

```
$(document).on( 'input', 'textarea.autoheight', function() {
    $(this).height( 'auto' ).height( this.scrollHeight );
}); 
```

在 Chrome、Firefox、Opera 和 IE 中测试和工作。还支持剪切粘贴、长字等。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2016-09-30T07:42:01.643

只需`<pre> </pre>`与一些样式一起使用，例如：

```
 pre {
        font-family: Arial, Helvetica, sans-serif;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 12px;
        line-height: 16px;
    } 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2017-03-14T13:22:14.460

您可以使用这段代码来计算 textarea 需要的行数：

```
textarea.rows = 1;
    if (textarea.scrollHeight > textarea.clientHeight)
      textarea.rows = textarea.scrollHeight / textarea.clientHeight; 
```

计算它`input`和`window:resize`事件以获得自动调整大小的效果。Angular 中的示例：

模板代码：

```
<textarea rows="1" reAutoWrap></textarea> 
```

自动换行.directive.ts

```
import { Directive, ElementRef, HostListener } from '@angular/core';

@Directive({
  selector: 'textarea[reAutoWrap]',
})
export class AutoWrapDirective {

  private readonly textarea: HTMLTextAreaElement;

  constructor(el: ElementRef) {
    this.textarea = el.nativeElement;
  }

  @HostListener('input') onInput() {
    this.resize();
  }

  @HostListener('window:resize') onChange() {
    this.resize();
  }

  private resize() {
    this.textarea.rows = 1;
    if (this.textarea.scrollHeight > this.textarea.clientHeight)
      this.textarea.rows = this.textarea.scrollHeight / this.textarea.clientHeight;
  }

} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2017-11-18T05:49:56.627

本机 Javascript 解决方案在 Firefox 中没有闪烁，并且比使用clientHeight 的方法更快...

1）将`div.textarea`选择器添加到所有包含`textarea`. 不要忘记添加`box-sizing: border-box;`

2）包括这个脚本：

```
function resizeAll()
{
   var textarea=document.querySelectorAll('textarea');
   for(var i=textarea.length-1; i>=0; i--)
      resize(textarea[i]);
}

function resize(textarea)
{
   var div = document.createElement("div");
   div.setAttribute("class","textarea");
   div.innerText=textarea.value+"\r\n";
   div.setAttribute("style","width:"+textarea.offsetWidth+'px;display:block;height:auto;left:0px;top:0px;position:fixed;z-index:-200;visibility:hidden;word-wrap:break-word;overflow:hidden;');
   textarea.form.appendChild(div);
   var h=div.offsetHeight;
   div.parentNode.removeChild(div);
   textarea.style.height=h+'px';
}

function resizeOnInput(e)
{
   var textarea=document.querySelectorAll('textarea');
   for(var i=textarea.length-1; i>=0; i--)
      textarea[i].addEventListener("input",function(e){resize(e.target); return false;},false);
}

window.addEventListener("resize",function(){resizeAll();}, false);
window.addEventListener("load",function(){resizeAll();}, false);
resizeOnInput(); 
```

在 IE11、Firefox 和 Chrome 上测试。

此解决方案创建类似于您的文本区域的 div，包括内部文本和测量高度。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2019-01-17T17:47:24.973

我发现的最好方法：

```
$("textarea.auto-grow").each( function(){
    $(this).keyup(function(){
        $(this).height( $(this)[0].scrollHeight - Number( $(this).css("font-size").replace("px", "") ) );
    });
}); 
```

其他方式有一个字体大小错误。

这就是为什么这是最好的。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-11-15T12:03:17.850

我创建[了一个小的 (7kb) 自定义元素](https://www.npmjs.com/package/autoheight-textarea)，它为您处理所有这些调整大小的逻辑。

它适用于任何地方，因为它是作为自定义元素实现的。包括：虚拟 DOM（React、Elm 等）、服务器端渲染的东西，如 PHP 和简单无聊的 HTML 文件。

除了侦听输入事件，它还有一个每 100 毫秒触发一次的计时器，以确保在文本内容因其他方式发生变化时一切正常。

以下是它的工作原理：

```
// At the top of one of your Javascript files
import "autoheight-textarea"; 
```

或包含为脚本标签

```
<script src="//cdn.jsdelivr.net/npm/autoheight-textarea@1.0.1/dist/main.min.js"></script> 
```

然后像这样包装你的textarea元素

HTML 文件

```
<autoheight-textarea>
  <textarea rows="4" placeholder="Type something"></textarea>
<autoheight-textarea> 
```

React.js 组件

```
const MyComponent = () => {
  return (
    <autoheight-textarea>
      <textarea rows={4} placeholder="Type something..." />
    </autoheight-textarea>
  );
} 
```

这是 Codesandbox 的基本演示：[https ://codesandbox.io/s/unruffled-http-2vm4c](https://codesandbox.io/s/unruffled-http-2vm4c)

你可以在这里获取包：[https ://www.npmjs.com/package/autoheight-textarea](https://www.npmjs.com/package/autoheight-textarea)

如果你只是想看看调整大小的逻辑，你可以看看这个函数：[https ://github.com/Ahrengot/autoheight-textarea/blob/master/src/index.ts#L74-L85](https://github.com/Ahrengot/autoheight-textarea/blob/master/src/index.ts#L74-L85)

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2020-08-16T00:04:43.523

这是[Moussawi7](https://stackoverflow.com/users/2205515/moussawi7)[答案](https://stackoverflow.com/a/24676492/2374053)的jQuery 版本。

```
$(function() {
  $("textarea.auto-grow").on("input", function() {
    var element = $(this)[0];
    element.style.height = "5px";
    element.style.height = (element.scrollHeight) + "px";
  });
})
```

```
textarea {
  resize: none;
  overflow: auto;
  width: 100%;
  min-height: 50px;
  max-height: 150px;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<textarea class="auto-grow"></textarea>
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-09-25T18:05:56.213

我知道我参加这个聚会迟到了，但我遇到的最简单的解决方案是将文本区域内容拆分为换行符并更新 textarea 元素的行。

```
<textarea id="my-text-area"></textarea>

<script>
  $(function() {
    const txtArea = $('#my-text-area')
    const val = txtArea.val()
    const rowLength = val.split('\n')
    txtArea.attr('rows', rowLength)
  })
</script> 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-10-06T14:18:02.990

对于 Angular 2+，只需执行此操作

```
<textarea (keydown)="resize($event)"></textarea>

resize(e) {
    setTimeout(() => {
      e.target.style.height = 'auto';
      e.target.style.height = (e.target.scrollHeight)+'px';
    }, 0);
  }

textarea {
  resize: none;
  overflow: hidden;
} 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2021-07-13T05:59:39.760

这是一种基于行的方法，可让您设置最大行数，`textarea`之后`textarea`将显示滚动条。除了以属性的形式调整其高度外`rows`，这还将在键入或执行剪切和粘贴等操作时自动扩展其宽度。

如果`textarea`除了占位符之外没有任何内容，它将根据占位符文本调整其宽度和高度。

此版本的一个缺点是它将继续根据文本宽度无限增加其宽度。因此，您需要`max-width`为`textarea`. 一个简单`max-width: 100%;`的也可以解决问题。此宽度扩展功能主要基于`input`. `type="text"`您可以在此[答案](https://stackoverflow.com/a/68326447/15757382)中阅读更多相关信息。

```
const textarea = document.querySelector('textarea');

setTextareaWidthHeight(textarea);
textarea.addEventListener('input', setTextareaWidthHeight.bind(this, textarea));

function getInputWidth(element) {
    const text = element.value || element.placeholder;
    const elementStyle = window.getComputedStyle(element);
    const fontProperty = elementStyle.font;
    const horizontalBorder = parseFloat(elementStyle.borderLeftWidth) + parseFloat(elementStyle.borderRightWidth);
    const horizontalPadding = parseFloat(elementStyle.paddingLeft) + parseFloat(elementStyle.paddingRight);

    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    context.font = fontProperty;
    const textWidth = context.measureText(text).width;

    const totalWidth = horizontalBorder + horizontalPadding + textWidth + "px";
    return totalWidth;
}

function setTextareaWidthHeight(element) {
    // store minimum and maximum rows attribute value that should be imposed
    const minRows = 1;
    const maxRows = 5;

    // store initial inline overflow property value in a variable for later reverting to original condition
    const initialInlineOverflowY = element.style.overflowY;

    // change overflow-y property value to hidden to overcome inconsistent width differences caused by any scrollbar width
    element.style.overflowY = 'hidden';

    const totalWidth = getInputWidth(element);
    element.style.width = totalWidth;

    let rows = minRows;
    element.setAttribute("rows", rows);

    while (rows <= maxRows && element.scrollHeight !== element.clientHeight) {
        element.setAttribute("rows", rows);
        rows++;
    }

    // change overflow to its original condition
    if (initialInlineOverflowY) {
        element.style.overflowY = initialInlineOverflowY;
    } else {
        element.style.removeProperty("overflow-y");
    }
}
```

```
textarea {
    max-width: 100%;
}
```

```
<textarea placeholder="Lorem ipsum dolor sit amet"></textarea>
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2021-08-03T15:36:33.797

使用 React 的示例实现：

```
const {
  useLayoutEffect,
  useState,
  useRef
} = React;

const TextArea = () => {
  const ref = useRef();
  const [value, setValue] = useState('Some initial text that both wraps and uses\nnew\nlines');

  // This only tracks the auto-sized height so we can tell if the user has manually resized
  const autoHeight = useRef();

  useLayoutEffect(() => {
    if (!ref.current) {
      return;
    }

    if (
      autoHeight.current !== undefined &&
      ref.current.style.height !== autoHeight.current
    ) {
      // don't auto size if the user has manually changed the height
      return;
    }

    ref.current.style.height = "auto";
    ref.current.style.overflow = "hidden";
    const next = `${ref.current.scrollHeight}px`;
    ref.current.style.height = next;
    autoHeight.current = next;
    ref.current.style.overflow = "auto";
  }, [value, ref, autoHeight]);

  return (
    <textarea
      ref={ref}
      style={{
        resize: 'vertical',
        minHeight: '1em',
      }}
      value={value}
      onChange={event => setValue(event.target.value)}
    />
  );
}

ReactDOM.render(<TextArea />, document.getElementById('app'))
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.1/umd/react-dom.production.min.js"></script>
<div id="app"></div>
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2022-01-01T12:28:44.003

这里有一个明确的答案：

[退格键增加滚动高度的值](https://stackoverflow.com/questions/70543526/backspace-increases-value-of-scrollheight)

它使用现代 ES6 语法并解决了在添加或删除内容时准确调整大小的问题。它解决了围绕不断变化的滚动高度值的问题。

* * *

## 回答 #44

> 赞同：-1
> 
> 时间：2009-09-07T14:01:05.413

我在常用浏览器中测试过脚本，但在 Chrome 和 Safari 中都失败了。这是因为不断更新的 scrollHeight 变量。

我已经使用 jQuery 应用了 DisgruntledGoat 脚本并添加了 chrome 修复

```
function fitToContent(/* JQuery */text, /* Number */maxHeight) {
    var adjustedHeight = text.height();
    var relative_error = parseInt(text.attr('relative_error'));
    if (!maxHeight || maxHeight > adjustedHeight) {
        adjustedHeight = Math.max(text[0].scrollHeight, adjustedHeight);
        if (maxHeight)
            adjustedHeight = Math.min(maxHeight, adjustedHeight);
        if ((adjustedHeight - relative_error) > text.height()) {
            text.css('height', (adjustedHeight - relative_error) + "px");
            // chrome fix
            if (text[0].scrollHeight != adjustedHeight) {
                var relative = text[0].scrollHeight - adjustedHeight;
                if (relative_error != relative) {
                    text.attr('relative_error', relative + relative_error);
                }
            }
        }
    }
}

function autoResizeText(/* Number */maxHeight) {
    var resize = function() {
        fitToContent($(this), maxHeight);
    };
    $("textarea").attr('relative_error', 0);
    $("textarea").each(resize);
    $("textarea").keyup(resize).keydown(resize);
} 
```

* * *

## 回答 #45

> 赞同：-1
> 
> 时间：2011-02-17T10:14:52.190

```
$('textarea').bind('keyup change', function() {
    var $this = $(this), $offset = this.offsetHeight;
    $offset > $this.height() && $offset < 300 ?
        $this.css('height ', $offset)
            .attr('rows', $this.val().split('\n').length)
            .css({'height' : $this.attr('scrollHeight'),'overflow' : 'hidden'}) :
        $this.css('overflow','auto');
}); 
```

* * *

## 回答 #46

> 赞同：-1
> 
> 时间：2012-05-09T21:57:49.503

我可以使用以下 jQuery 函数在 IE9 和 Chrome 中设置 TextArea 大小。它从 $(document).ready() 函数中定义的选择器绑定到 textarea 对象。

```
function autoResize(obj, size) {
    obj.keyup(function () {
        if ($(this).val().length > size-1) {
            $(this).val( function() {
                $(this).height(function() {
                    return this.scrollHeight + 13;
                });
                alert('The maximum comment length is '+size+' characters.');
                return $(this).val().substring(0, size-1);
            });
        }
        $(this).height(function() {
            if  ($(this).val() == '') {
                return 15;
            } else {
                $(this).height(15);
                return ($(this).attr('scrollHeight')-2);
            }
        });
    }).keyup();
} 
```

在我的 $(document).ready() 函数中，我对此页面上的所有 textarea 调用都有以下调用。

```
$('textarea').each( function() {
        autoResize($(this), 250);
}); 
```

`250`我的文本区域的字符限制在哪里。这将与文本大小允许的一样大（基于您的字符数和字体大小）。当您从文本区域中删除字符或用户最初粘贴太多文本时，它也会适当地缩小您的文本区域。

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2015-06-08T15:03:49.470

您可以使用以下代码：

**咖啡稿：**

```
jQuery.fn.extend autoHeightTextarea: ->
  autoHeightTextarea_ = (element) ->
    jQuery(element).css(
      'height': 'auto'
      'overflow-y': 'hidden').height element.scrollHeight

  @each ->
    autoHeightTextarea_(@).on 'input', ->
      autoHeightTextarea_ @

$('textarea_class_or_id`').autoHeightTextarea() 
```

**Javascript**

```
jQuery.fn.extend({
  autoHeightTextarea: function() {
    var autoHeightTextarea_;
    autoHeightTextarea_ = function(element) {
      return jQuery(element).css({
        'height': 'auto',
        'overflow-y': 'hidden'
      }).height(element.scrollHeight);
    };
    return this.each(function() {
      return autoHeightTextarea_(this).on('input', function() {
        return autoHeightTextarea_(this);
      });
    });
  }
});

$('textarea_class_or_id`').autoHeightTextarea(); 
```

# asp.net - 网站未从一个位置加载

> ID：454204
> 
> 赞同：0
> 
> 时间：2009-01-17T22:32:20.800
> 
> 标签：asp.net, web, connectivity

我有一个托管在 webhost4life.com 的网站。当我从不同位置（家、咖啡店、图书馆等）加载网站时，它工作正常。但是**从我朋友家它不会加载**。看起来它只是坐在那里思考，网站可能会在这里和那里加载一些图像，但仅此而已。整个页面没有加载，大多数时候没有加载。

这是 ac#asp.net 网站。**我的问题是，我该如何进行故障排除以找出问题所在？**

现在我真的不知道从哪里开始。这些是我尝试过的事情：

*   静态页面 - 我上传了一个**静态 html 页面并且加载正常**！
*   fiddler - 我在 fiddler 中跟踪会话，但一无所获。但是当我尝试静态页面时，我得到了正常的结果，并且工作正常。
*   tracert www.mydomain.com - 这看起来不错，我得到与 www.yahoo.com 类似的结果
*   telnet www.mydomain.com 80 - 我这样做是为了 ping 网站的 80 端口。如果我输入“get”并按回车键，我会看到“Bad request”消息，但我看到其他网站的消息相同，它们从这里工作正常
*   ftp - ftp 工作速度快而且很好

所以在这一点上，我知道我的网站的 asp.net 部分**似乎不起作用，但只能从这个位置**。它在我尝试过的其他任何地方都可以正常工作。但是静态页面确实可以正常工作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T22:59:11.667

尝试执行 telnet 'get' 并实际请求有问题的页面。可能是您在应用程序中引用了您朋友的计算机无法连接的元素。如果您取回页面的所有标记，则它是页面引用的项目之一导致问题。如果页面呈现不完整，则您的网站可能有问题，或者可能是您朋友家和您的网站之间的网络问题。由于您的应用程序从其他位置加载，我怀疑您朋友的计算机或网络有问题，而不是您的站点。您的网站不应该关心请求来自哪里。

# c# - C# 中的私有内部类 - 为什么不经常使用它们？

> ID：454218
> 
> 赞同：78
> 
> 时间：2009-01-17T22:41:25.430
> 
> 标签：c#, scope, inner-classes

我对 C# 比较陌生，每次开始从事 C# 项目时（我只从事过 C# 中几乎成熟的项目），我想知道为什么没有内部类？

也许我不明白他们的目标。对我来说，内部类——至少是私有内部类——看起来很像 Pascal / Modula-2 / Ada 中的“内部过程”：它们允许将主类分解成更小的部分，以便于理解。

示例：这是大多数时候看到的内容：

```
public class ClassA
{
   public MethodA()
   {
      <some code>
      myObjectClassB.DoSomething(); // ClassB is only used by ClassA
      <some code>
   }
}

public class ClassB
{
   public DoSomething()
   {
   }
} 
```

由于 ClassB 将仅由 ClassA 使用（至少一段时间），我的猜测是这段代码会更好地表达如下：

```
 public class ClassA
   {
      public MethodA()
      {
         <some code>
         myObjectClassB.DoSomething(); // Class B is only usable by ClassA
         <some code>
      }

      private class ClassB
      {
         public DoSomething()
         {
         }
      }
   } 
```

我很高兴收到你关于这个问题的消息——我说得对吗？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-01-17T23:29:26.397

嵌套类（最好避免使用“内部”这个词，因为 C# 中的嵌套类与 Java 中的内部类有些不同）确实非常有用。

一种没有被提及的模式是“更好的枚举”模式——它甚至比 Java 中的更灵活：

```
public abstract class MyCleverEnum
{
    public static readonly MyCleverEnum First = new FirstCleverEnum();
    public static readonly MyCleverEnum Second = new SecondCleverEnum();

    // Can only be called by this type *and nested types*
    private MyCleverEnum()
    {
    }

    public abstract void SomeMethod();
    public abstract void AnotherMethod();

    private class FirstCleverEnum : MyCleverEnum
    {
        public override void SomeMethod()
        {
             // First-specific behaviour here
        }

        public override void AnotherMethod()
        {
             // First-specific behaviour here
        }
    }

    private class SecondCleverEnum : MyCleverEnum
    {
        public override void SomeMethod()
        {
             // Second-specific behaviour here
        }

        public override void AnotherMethod()
        {
             // Second-specific behaviour here
        }
    }
} 
```

我们可以通过一些语言支持来自动执行其中的一些操作——还有很多我没有在这里展示的选项，比如实际上不对所有值使用嵌套类，或者对多个值使用同一个嵌套类，但给他们不同的构造函数参数。但基本上，嵌套类可以调用私有构造函数这一事实提供了很大的力量。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-11-12T20:10:04.890

[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)有我迄今为止发现的使用嵌套类的最佳规则。

这是一个简短的摘要列表：

> 1.  当类型和嵌套类型之间的关系需要成员可访问性语义时，请使用嵌套类型。
>     
>     
> 2.  不要使用公共嵌套类型作为逻辑组*构造*
>     
>     
> 3.  避免使用公开的嵌套类型。
>     
>     
> 4.  *如果类型可能在包含类型之外被引用，则不要*使用嵌套类型。
>     
>     
> 5.  如果需要由客户端代码实例化，请勿使用*嵌套类型。*
>     
>     
> 6.  不要将*嵌套*类型定义为接口的成员。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-17T23:47:35.360

您应该限制每个类的职责，以使每个类都保持**简单、可测试和可重用**。私有内部类与此相反。它们增加了外部类的复杂性，它们不可测试且不可重用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-17T22:48:05.637

就我个人而言，如果我需要创建可能需要方法的对象的进程内集合，我只会创建私有内部类。

否则，可能会导致从事该项目的其他开发人员在实际找到这些类时感到困惑，因为他们不太清楚它们在哪里。

# python - 如何在 Turbogears 中创建可以从控制器内部调用或使用模板渲染的控制器方法

> ID：454223
> 
> 赞同：2
> 
> 时间：2009-01-17T22:43:53.837
> 
> 标签：python, json, turbogears

如果您有这样的控制器方法：

```
@expose("json")
def artists(self, action="view",artist_id=None):
    artists=session.query(model.Artist).all()
    return dict(artists=artists) 
```

如何从控制器类中调用该方法，并取回 python dict - 而不是 dict 的 json 编码字符串（这需要您将其从 json 解码回 python dict）。是否真的有必要编写一个函数来从模型中获取数据，并编写另一个函数来打包数据以供模板（KID、JSON）使用？为什么当您在同一个类中调用此方法时，例如：

```
artists = self.artists() 
```

你会得到一个 json 字符串，只有当该方法作为 HTML 请求的一部分调用时才合适。我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T00:28:06.277

我通常通过一个“worker”方法来解决这个问题，该方法查询数据库、转换结果等，以及一个单独的公开方法，以及所有必需的装饰器。例如：

```
# The _artists method can be used from any other method
def _artists(self, action, artist_id):
    artists = session.query(model.Artist).all()
    return dict(artists=artists)

@expose("json")
#@identity.require(identity.non_anonymous())
# error handlers, etc.
def artists(self, action="view", artist_id=None):
    return self._artists(action=action, artist_id=artist_id) 
```

# web-hosting - 足够的带宽来支持

> ID：454224
> 
> 赞同：2
> 
> 时间：2009-01-17T22:43:59.530
> 
> 标签：web-hosting, bandwidth

我有一个客户每月支付 1500 美元来托管 1 个网站（1 个域名，电子邮件托管在其他地方）。该网站的流量非常低。比如，每周有 100 位独立访客。唯一的问题（以及为什么如此昂贵）是他们的数据库是 15 GB，并且从托管公司复制到我的小公司办公室内部。

在办公室内，有一个桌面应用程序对内部数据库有很大影响。从网站上，一些数据被输入到那个版本的数据库中。复制以每 5 分钟一次的计划使两个数据库保持同步。

我的客户有一个 T1 可以进入他们的办公室。我想完全淘汰托管服务提供商，从他们已经拥有的服务器上托管他们的网站（超过能够处理该网站的能力），然后完全转储复制。这将为他们每月节省 1500 美元，对于一个 5 人的公司来说，这对他们来说真的很重要。

假设我已经制定了备份策略（每天将数据库副本移至异地的方式），这有什么问题？

支持？他们可以像托管服务提供商一样轻松地重新启动服务器。如果服务器永远停机怎么办？我可以在几个小时内提出一个副本，这就是他们真正需要的所有服务水平。

我在这里想念什么？我想给他们省钱，但我不想把他们搞砸……

编辑：一些答案和评论清楚地表明我自己并不清楚。我的客户（A 公司，不是托管服务提供商）向 B 公司付费以托管他们的网站。该网站有一个 15 GB 的数据库 (MS SQL Server 2000)。该 SQL Server 数据库正在被复制回@公司 A 的服务器。

B 公司每月向 A 公司收取 1500 美元的此项服务费用。

A 公司已经有一台 T1 用于连接到 Internet。它们位于磨坊商业园区内。

我建议取消任何外部托管，让 DNS 提供商将网站指向 A 公司的静态 IP，并将网站托管在 A 公司内部的服务器上。那么就根本不需要任何复制，他们不会每月向 B 公司支付 1500 美元。

我希望能解释它。我将重新阅读并评论所有当前的答案。

真的，非常感谢任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T23:36:42.200

在我看来，您将服务器内部移动的唯一风险是您的 T1 出现故障。如果您为此制定了备份策略，那就去做吧。

另一种选择是将您自己的服务器与您自己的 SQL Server 许可证放在一起。托管公司对托管 SQL Server 数据库收取高额费用，因为他们必须为此支付每个 CPU 的许可费用。因此，他们建立了一个强大的服务器来为大量客户的数据库提供服务，但是 SQL Server 无法进行使用会计，因此他们唯一可以根据数据库大小计费/拧紧你的方法。

听起来您的站点上的流量足够低，您可以以几千美元的一次性成本获得一台双核服务器、一个 SQL Server 的 1 个 CPU 许可证，然后您只需支付每月的 co-loc 价格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T22:52:45.643

托管服务提供商可以 24x7 全天候监控服务器。如果服务器在晚上 8 点崩溃怎么办？我小公司的人不是夜以继日地工作吗？

取决于此数据库提供的服务。对其正常运行时间有什么要求？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T22:53:25.190

数据库复制对带宽来说并不昂贵 - 好吧，假设您没有通过链接对整个数据库文件进行热拷贝。

查看日志传送，或任何将使用最小带宽复制数据库的受支持复制选项。（你从来没有说过数据库是什么，所以我不能在那里进一步评论）

我会移动到新服务器并继续复制。至少，如果您真的担心数据丢失，请在同一设施中获取另一台服务器并复制到该服务器 - 即使您每 5 分钟复制 15Gb，它也会使用不收费的带宽，甚至没有走出他们所连接的交换机。

# seo - 多版本 Web 应用的 URL 方案

> ID：454229
> 
> 赞同：0
> 
> 时间：2009-01-17T22:45:54.703
> 
> 标签：seo, internationalization, url-rewriting, friendly-url

我正在寻找用于具有多个版本的网络应用程序的最佳 URL 架构，即多种语言和手机使用的简化版本 - 这两个方面可以结合起来，所以有一个英语常规版本和一个移动版本，一个德语普通版和手机版等

目标（按重要性排序）：

*   用户友好性
*   搜索引擎友好度
*   易于开发

需要考虑的方面：

*   URL 应该是什么样子的？
*   用户应该如何在版本之间导航？
*   自动决定一个版本应该有多少逻辑？

我将在下面描述我的概念，也许你们中的一些人有更好的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T22:46:37.607

我目前的概念：

*   当新用户到达时，应用程序根据 cookie（见下文）决定 Accept-Language: 标头和用户代理字符串（用于标识移动浏览器）显示哪个版本，但不会在 URL 中反映这一点（没有重定向）
*   默认为非简体英文版
*   有突出显示的图标（旗帜，风格化的手机）以选择其他版本
*   当用户明确选择不同的版本时，这会反映在更改的 URL 和浏览器 cookie 中
*   URL 模式是 / 用于“自动”版本，/en/、/de/ 等用于语言版本，/mobile/ 用于简化版本，/normal/ 用于非简化版本，以及它们的组合，即 /移动/en/和/normal/de/
*   mod_rewrite 用于剥离这些 URL 前缀并将它们转换为 GET 参数以供应用程序解析
*   robots.txt 不允许 /mobile/ 和 /normal/

好处：

*   不同的语言版本都被搜索引擎单独索引
*   Cookie 有帮助，但不是必需的
*   人们很有可能会看到最适合他们的版本，而无需做出任何选择
*   用户总是可以明确地选择他想要的版本（这使得 /normal/ URL 是必要的）
*   每个版本都有一个 URL，当传递给其他版本时，该 URL 将准确显示该版本
*   /mobile/ 和 /normal/ 被搜索引擎忽略；它们只会是重复的内容。

缺点：

*   需要大量使用 mod_rewrite，我觉得这很神秘
*   用户可以将他们当前的 URL 发送给某人，而该人在访问它时最终可能会看到不同的版本，这可能会导致混淆
*   / 和 /en/ 之间仍然存在重复的内容 - 我不能在 robots.txt 中禁止 / - 我应该相信搜索引擎不会因为同一域上的完全相同的内容而惩罚我，还是禁止 /en/ 并接受访问/通过搜索引擎的人可能会看到与他们在搜索引擎中找到的不同的版本？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T09:56:44.563

我个人建议子域。

我根本不会包括移动设备——使用用户代理来确定这一点，并且可能使用 cookie 以防用户想在他们的移动设备上查看完整的网站（想想 Flickr 和 Google 是如何做到的）。但是对于语言，是的 - 主要语言位于[http://mydomain.com/](http://mydomain.com/)，次要语言位于[http://de.mydomain.com/](http://de.mydomain.com/)或[http://fr.mydomain.com/](http://fr.mydomain.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T23:40:20.353

我不清楚您为什么要在 URL 方案中包含任何类型的版本控制信息，例如接受语言或用户代理，具体指定。URL 方案应仅指示内容。服务器应调查各种请求标头以确定如何检索和/或格式化响应。

# windows-7 - Windows 7 MSDN 过期

> ID：454230
> 
> 赞同：0
> 
> 时间：2009-01-17T22:46:14.953
> 
> 标签：windows-7, development-environment, msdn

我读过 Windows 7 的公共测试版已过期，但 MSDN Premium 是否也在同一天过期？

如果是这样，您认为我们可能会在 MSDN 到期之前看到更新的版本吗？

仅就速度改进而言，我正在考虑将我的开发 PC 迁移到 Windows 7 而不是 Windows Vista，除了稳定性问题，无论如何我都是早期采用者，并且预计测试版操作系统会出现问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T23:21:03.060

正如我在 VStudio 10 CTP 中所做的那样，您可以在启动虚拟机时更改其时钟。就我而言，当我午餐 VS10 时，我将虚拟机的时钟设置为 2008 年 11 月 1 日 - 它仍在运行！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T16:00:25.543

我的 MSDN 版本的 Windows 7 说：

“评估副本。有效期为 2009 年 7 月 1 日下午 5:59”

我想到那时他们会发布另一个版本——如果我们真的很幸运的话，甚至可能是 RTM。

# sql-server - 从动态数据 Web 应用程序的添加条目页面中删除自动生成 GUID 列

> ID：454235
> 
> 赞同：3
> 
> 时间：2009-01-17T22:48:49.893
> 
> 标签：sql-server, entity-framework, guid, dynamic-data, newid

我有一个动态数据实体 Web 应用程序，它使用带有 GUID 的数据库作为表的主键。所有 GUID 字段的默认值都设置为 NEWID()，因此 SQL Server 将为任何记录生成新的 GUID。然而，在我的动态数据网站中，在插入新条目页面中，GUID 字段会显示，并且用户需要输入数据。如何防止显示该字段？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-17T23:45:58.763

根据[MSDN](http://msdn.microsoft.com/en-us/library/cc668215.aspx)：

“通过使用 Scaffold 属性并将其值设置为 false，您可以像执行任何其他列一样隐藏主键。由于无法识别自动生成的键，因此默认插入页面模板不适用于具有自动主键的表的 EDM除非您为实体创建部分类并应用值为 false 的 Scaffold 属性。”

另外，如果您使用 SQL Server 2005 或更高版本，最好使用“newsequentialid()”作为 Guid 的默认值，因为这样插入效率更高。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-10T16:46:12.593

不是正确答案..

在我这样做之后，您可以插入 1 条记录，该记录将获得一个全为零的 GUID。之后，您将根本不会收到任何错误消息，但由于 guid 上的唯一索引约束（当然这是主键），您将无法再插入任何记录。

要真正解决这个问题，您必须编辑 emdx 文件并添加

```
StoreGeneratedPattern="Identity" 
```

进入“SSDL 内容”注释下的 Guid 属性标签。例子：

```
 <Property Name="Guid" Type="uniqueidentifier" Nullable="false" StoreGeneratedPattern="Identity"/> 
```

如果您在 Visual Studio 中的设计器中执行此操作，它将在“CSDL 内容”注释下注释属性标签，这不起作用..

使用 Entity Framework 4.0 Visual Studio 10 和 .NET Framework 4.0

# emacs - 用于替换文本的交互式 Emacs Lisp 函数的帮助

> ID：454236
> 
> 赞同：4
> 
> 时间：2009-01-17T22:49:19.737
> 
> 标签：emacs, elisp

我已经使用 Emacs 几个月了，我想开始 elisp 编程。具体来说，我想编写自己的`interactive`函数。但是，我有点迷失了。`(interactive ...)`有很多选择，我不确定我想要哪一个。然后，我真的不知道我需要的函数的名称。如果有人能帮我把我的伪代码变成真正的代码，我将不胜感激！（和往常一样，任何指向信息丰富的地方的链接都会很好。现在我刚刚在读[这个。](http://www.rattlesnake.com/intro/index.html)）

这是我想做的伪代码：

```
(defun my-func (buffer) ; I think I need the buffer as an arg?
  "does some replacements"
  (interactive ???) ; ?
  (let (replacements (list
   '("a-regexp-string" . "a-replacement-string-with-backreferences")
   ...)) ; more of the above
    (while replacements
      (let (current (car replacements)) ; get a regexp-replacement pair
        (some-regexp-replace-func buffer (car current) (cdr current)) ; do the replacement
        (setq replacements (cdr replacements)))))) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T01:03:44.880

首先，从您的函数的外观来看，您可能会在当前缓冲区中执行此操作，所以不，您不需要“缓冲区”参数。如果这是一个错误的假设，我可以更改代码。接下来，在“让”中，如果要分配给变量，则需要在每对 var/value 周围使用另一组括号。最后，在遍历列表时，我更喜欢使用函数式编程的函数（mapcar、mapc 等）。我将尝试在此处内联一些评论：

```
(defun my-func ()
  "Do some replacements"
  (interactive)
  (let ((replacements (list '("foo" . "bar")
                            '("baz" . "quux"))))
    (save-excursion ; So point isn't moved after this function
      (mapc (lambda (x) ; Go through the list, with this 'inline' function
                        ; being called with each element as the variable 'x'
              (goto-char (point-min)) ; Start at the beginning of the buffer
              (while (re-search-forward (car x) nil t) ; Search for the car of the replacement
                (replace-match (cdr x)))) ; And replace it with the cdr
            replacements)))) ; The list we're mapc'ing through 
```

至于读什么，我推荐 Emacs 附带的 Elisp 手册。

# c# - C#：捕获数据，显示给用户，保存到磁盘，上传到数据库：最佳方法

> ID：454244
> 
> 赞同：1
> 
> 时间：2009-01-17T22:54:33.407
> 
> 标签：c#, xml, file-io

我有一个程序可以在设定的时间间隔内从硬件中捕获实时数据。数据以 XML 形式返回。我想对这些数据做几件事（按顺序）： - 将其显示给用户 - 将其保存到磁盘 - 最终，将其上传到数据库

我目前的方法是获取 XML，将其解析为哈希表，以便向用户显示正确的值。

接下来，我想将 XML 保存到磁盘上的文件中。对于每个数据捕获会话，我计划创建一个唯一的 XML 文件，并将所有数据转储到其中。

最后，我想重新解析 XML 并将其上传到 MySQL 数据库。数据不能立即上传到数据库。

这似乎解决这个问题的效率很低，我希望得到一些建议。

将数据保存为 XML 是否浪费高清空间？

必须重新解析 XML 才能将其写入数据库是不是太低效了？

谢谢！

* * *

澄清一下：典型的 XML 响应大约为 1kb，并且以每 15-60 秒大约 1 个响应的速率被捕获。

我想我确实想将 XML 作为 XML 存储在磁盘上，因为数据非常有价值并且很难重现（如果可能的话）。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T23:13:18.643

当您从源接收到新的 XML 文档时，直接保存到磁盘并解析它以显示给用户。

通过后台进程或用户启动，从磁盘读取 xml 文件并根据创建日期将它们发送到服务器（因此您只能检索最新的）以插入 MySql。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-17T23:05:23.230

这主要取决于您移动的数据量和速率。如果您很少需要上传到数据库并且只需要几秒钟，那么 XML 的灵活性肯定是不错的。如果您从不使用本地存储的数据，只是将其上传到数据库并且解析需要几分钟，您可能需要重新考虑该策略。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T23:21:45.303

也许应该有一个单独的线程用于数据获取和处理。

# nhibernate - 您是否会将 NHibernate 用于具有部分无法控制的遗留数据库的项目？

> ID：454249
> 
> 赞同：5
> 
> 时间：2009-01-17T22:57:22.920
> 
> 标签：nhibernate, orm, legacy, ibatis

对我来说，目前的答案是：不，我会使用 iBatis，因为当数据库模型和对象模型不同步时，NHibernate 很痛苦。如果我不能完全控制数据库，我最终会做很多工作。

我为什么要问？

好吧，首先：我从未使用过 NHibernate。我只是从表面上知道。我已经阅读过 iBatis 对遗留数据库的优势。

第二：最近我与使用 Hibernate 的人进行了讨论（jep，在 Hibernate 之前没有'N'）。他告诉我，ORM 框架现在非常先进，并且提倡 Hibernate。由于我对 NHibernate 不感兴趣，所以我没有跟踪最近的发展。

也许我是时候重新考虑我的答案了，或者不是？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-20T07:25:15.693

iBatis 很容易将对象映射到遗留数据库系统。

最近 NHibernate 1.2 和 2.0 有一个特性集，可能会让你重新思考 iBatis。

NHibernate 与复合键一起工作，这在旧数据库中经常出现，它们并不总是令人愉快的工作，但对此提供支持。

NHibernate 可以利用存储过程对实体以及数据库视图进行 CRUD 操作。

集合可以是自定义存储过程或 SQL 查询。当外键关系不直接映射到另一端的主键时，集合可以使用 property-ref 属性。

其中一些特性可能会影响 nhibernate 的性能/功能，即使用 property-ref 的延迟加载不起作用（根本？），但大多数情况下都有原因。

其他要点：（这与您的旧数据库并不真正相关，但仍然可以帮助决定技术选择）

Nhibernate 社区似乎比 iBatis 丰富得多。我在这两个列表上，与 iBatis 组相比，对 NHibernate 的支持量相当大。所以支持应该更容易。

Also there is a growing amount of contrib/3rd party tools for NHibernate. Things like The NHibernate Profiler, the Nhibernate Query Analyzer, NHibernate Contrib, Fluent NHibernate to name a few.

Perhaps you can expand on what advantages you believe iBatis currently has. NHibernate has certainly been quite active recently and has gained many new features, a lot of which do assist in legacy/hard to modify schemas.

And to answer the question, yes we do use NHibernate with legacy databases that have awful relationships, composite keys, broken relationships. We still also have a small amount of code based on iBatis. We no longer write any more iBatis code though.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T00:05:46.720

是的，考虑 NHibernate。这是黄金标准是有原因的。我听说 iBATIS 支持疯狂的映射可能性，但是使用 NHibernate 的 IUserType 你可以映射任何东西，甚至是非常奇怪的列。

@Ahmad，ORM 的全部目的是防止对象和模式之间的紧密耦合。如果你有这个问题，你做错了。

此外，使用 NHibernate 有很多用于自定义查询、公式属性和存储过程的选项。HQL 非常强大，Criteria 非常灵活。

我认为，如果您至少不使用 NHibernate，您将对您的客户造成伤害。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T23:16:17.937

我一直在现有应用程序中使用 nHibernate。我将它用于所有新的开发，我无意将现有的东西移植到那里只是没有令人信服的理由，但对于项目中的新东西来说它工作得很好。

如果您要移植代码，那么您应该能够更改数据库以更好地与您的域模型匹配，而不会产生太大影响（取决于您的数据库的泄漏程度，即谁访问它）。但是，更改域模型会影响应用程序。

# c# - 在 C# 中进行范围查找？

> ID：454250
> 
> 赞同：6
> 
> 时间：2009-01-17T22:58:14.790
> 
> 标签：c#

我有一个不重叠范围的列表（数字范围，例如 500-1000、1001-1200 .. 等），是否有一种优雅而快速的方法来通过仅传递一个数字来进行查找？我可以使用 List.BinarySearch() 或 Array.BinarySearch() 但我必须传递范围对象的类型 (Array.BinarySearch(T[], T))，我可以传递一个虚拟范围对象并完成工作（只与范围开始进行比较）但我想知道这是否可以通过只传递一个整数并获取范围对象以更简洁的方式完成，有没有办法实现这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-17T23:40:11.850

三个选项：

*   创建一个虚拟范围并将其吸收。呃。
*   仅针对这种情况手工制作二进制搜索。还不错。
*   在给定 IRangeComparer 的情况下，对任何 IList 和 TValue 进行二分搜索。我在这里对“TRange”这个名字并不感兴趣——我们不一定在谈论范围，而只是根据两种不同类型之间的比较来找到合适的位置。

第三个选项将*类似于*：

```
public interface IRangeComparer<TRange, TValue>
{
    /// <summary>
    /// Returns 0 if value is in the specified range;
    /// less than 0 if value is above the range;
    /// greater than 0 if value is below the range.
    /// </summary>
    int Compare(TRange range, TValue value);
}

/// <summary>
/// See contract for Array.BinarySearch
/// </summary>
public static int BinarySearch<TRange, TValue>(IList<TRange> ranges,
                                               TValue value,
                                               IRangeComparer<TRange, TValue> comparer)
{
    int min = 0;
    int max = ranges.Count-1;

    while (min <= max)
    {
        int mid = (min + max) / 2;
        int comparison = comparer.Compare(ranges[mid], value);
        if (comparison == 0)
        {
            return mid;
        }
        if (comparison < 0)
        {
            min = mid+1;
        }
        else if (comparison > 0)
        {
            max = mid-1;
        }
    }
    return ~min;
} 
```

抱歉，如果我有任何错误。我根本没有测试过它，但它至少可以编译:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T23:30:20.310

如果您有 .Net 3.5 或更高版本，请尝试

```
foundRange = yourList.Where(range =› range.BottomNumber ‹= searchInt && range.TopNumber ›= searchInt).FirstOrDefault(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T02:07:20.010

如果您有很多范围并且非常关心性能，您可以创建一个由范围（最小，最大）对组成的[AVL](http://msdn.microsoft.com/en-us/library/ms379573(vs.80).aspx) [类型的树](http://webpages.ull.es/users/jriera/Docencia/AVL/AVL%20tree%20applet.htm)，但在范围的最低部分进行排序。

但是，如果您没有很多范围可以将事物分类，那么这是一项几乎没有任何收获的工作。

# html - HTML 元标记刷新的最长时间

> ID：454252
> 
> 赞同：9
> 
> 时间：2009-01-17T23:02:11.537
> 
> 标签：html

在

```
<meta http-equiv="refresh" content="n"> 
```

n 有最大值吗？是否有足够大的数字让浏览器或任何倒计时的东西在 n 秒后无法刷新？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-17T23:19:44.527

[WebKit 用于`double`存储延迟。](http://trac.webkit.org/browser/trunk/WebCore/dom/Document.cpp#L1970)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-17T23:08:25.517

不，那里没有。至少不在合理的范围内……我确信 HTML 属性是有限制的，但是你可以适应该限制的数字数量会导致刷新时间过长，你可能会睡着了。:P

# ruby-on-rails - 这是使用 API 密钥进行 HTTP BASIC 身份验证的合理方法吗？

> ID：454258
> 
> 赞同：0
> 
> 时间：2009-01-17T23:04:26.087
> 
> 标签：ruby-on-rails, api, authentication

我刚刚开始在 Rails 应用程序上添加 REST API，因为我只想公开几个控制器/动作，所以我向 ApplicationController 添加了一个方法：

```
 def http_basic_authentication
    if request.format == Mime::XML
      authenticate_or_request_with_http_basic do |username, api_key|
        self.current_user = User.find(:first, :from => 'users, accounts', :conditions => ["accounts.id = users.account_id AND accounts.api_key = ?", api_key])
      end
    end
  end 
```

然后我可以在我想要公开的个人控制器/操作上使用 before_filter 。有没有人有任何反馈、代码审查或更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T00:05:42.547

可能这会更干净：

```
self.current_user = Account.find_by_api_key(api_key).user 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-12T19:39:45.087

您可能会发现这里详述的方法很有用[http://www.compulsivoco.com/2009/05/rails-api-authentication-using-restful-authentication/](http://www.compulsivoco.com/2009/05/rails-api-authentication-using-restful-authentication/)

这与常见的 restful_authentication 插件集成。

# emacs - 你对 Emacs 的包管理器有什么期望？

> ID：454259
> 
> 赞同：72
> 
> 时间：2009-01-17T23:04:44.307
> 
> 标签：emacs, packages, package-managers

尽管存在数千个 Emacs Lisp 库，但 GNU Emacs 直到 24.1 版都没有（内部）包管理器。

我想大多数用户都会同意，目前查找、安装和保持最新的 Emacs Lisp 库相当不方便。

**让生活更轻松的页面**

对于早于 24.1 的 Emacs 版本：

*   [Emacs Lisp 列表](http://www.damtp.cam.ac.uk/user/sje30/emacs/ell.html)- 问题：我看到死人（链接）。
*   [Emacswiki](http://www.emacswiki.org) - 问题：可能包含坚果的痕迹（恶意代码）。
*   [Emacsmirror](http://github.com/emacsmirror/p/wiki) - 我正在处理的包存储库。问题：还没有包管理器本身支持它。

**一些包管理器**

并不是没有人尝试过。（当被问到这个问题时，其中一些并不存在。）

*   **[自动安装](http://www.emacswiki.org/emacs/AutoInstall)**
*   **[borg.el](https://github.com/emacscollective/borg)** - 使用 Git 子模块同化 Emacs 包。
*   **[el-get.el](http://www.emacswiki.org/emacs/el-get.el)** - 支持许多来源。
*   [elinstall.el](http://repo.or.cz/w/elinstall.git)
*   **[epackage](http://github.com/jaalto/project--emacs-epackage)** aka DELPS - 应用于 Emacs Lisp 包的 Debian 打包概念。
*   [epkg.el](http://gitlab.com/tarsius/epkg) - 这现在只是一个浏览 Emacsmirror 的工具。
*   [安装.el](http://www.iro.umontreal.ca/~monnier/elisp/install.el)
*   [安装-elisp.el](http://www.emacswiki.org/emacs/install-elisp.el)
*   [jem-pkg.el](http://www.jemarch.net/jempkg.html)
*   **[package.el](http://tromey.com/elpa/)** - ELPA。似乎它将包含在 Emacs 24 中。

* * *

***更新——package.el 包含在 GNU Emacs 中，从 24.1 版开始***

* * *

*   [pases.el](https://launchpad.net/pases)
*   [pelm](http://github.com/eggcaker/pelm) - 命令行安装程序；使用 php。
*   [插件.el](http://gmarceau.qc.ca/plugin.el)
*   [Straight.el](https://github.com/raxod502/straight.el) - 最近和实验性的，尚未达到 1.0 版本。
*   [使用-package.el](http://www.emacswiki.org/emacs/UsePackage)
*   [XEmacs 包管理器](http://www.xemacs.org/Documentation/packageGuide.html)

软件包已包含在 Emacs 主干中。epkg 尚未准备好，目前也不可用。至少 install-elisp、plugin 和 use-package 似乎不再积极维护了。

我创建了一个 git[存储库](https://github.com/emacsmirror/all-package-managers)，其中包含所有这些包管理器作为子模块。

**一些可能有用的实用程序**

包管理器可以使用这些实用程序和/或它们可以用于维护包的镜像。

*   [date-calc.el](http://www.emacswiki.org/emacs/date-calc.el) - 日期计算和解析例程。
*   [ell.el](http://www.damtp.cam.ac.uk/user/sje30/emacs/ell.el) - 浏览 Emacs Lisp 列表。
*   [elm.el](http://github.com/tarsius/elm)、[elx.el](http://github.com/tarsius/elx)、[xpkg.el](http://github.com/tarsius/xpkg) - 用于维护[Emacsmirror](http://www.emacsmirror.org)。
*   [genauto.el](http://www.gnufans.net/~deego/emacspub/lisp-mine/genauto/) - 帮助为您的 elisp 包生成自动加载。
*   [inversion.el](http://www.emacswiki.org/emacs/InVersion) - 需要特定的包版本。
*   [loadhist.el、lib-requires.el、elisp-depend.el](http://www.emacswiki.org/emacs/LibraryDependencies) - 列出 Emacs Lisp 库依赖项的命令。
*   [project-root.el](http://www.shellarchive.co.uk/content/lisp/project-root.el) - 定义项目根并根据它采取行动。
*   [strptime.el](http://www.emacswiki.org/emacs/strptime.el) - POSIX 日期和时间解析的部分实现。
*   [wikirel.el](http://www.emacswiki.org/emacs-en/wikirel.el) - 访问 Emacs Wiki 上的相关页面。

**关于手头主题的讨论**

*   [emacs 开发 20080801](http://article.gmane.org/gmane.emacs.devel/101927)
*   [comp.emacs 20021121](http://groups.google.com/group/comp.emacs/browse_thread/thread/696d4ba8809ff258)
*   [RationalElispPackaging](http://www.emacswiki.org/emacs/RationalElispPackaging)

**问题（最后）**

所以 - 我想从你那里知道你认为在 Emacs 的包管理器中什么是重要的/不重要的/补充的等等。

***一些想法***

1.  许多包（[Emacsmirror](http://www.emacsmirror.org)提供了最大的可用包集合，但在任何包管理器中还没有明确的支持）。
2.  只有经过测试的包。
3.  支持多个包存档（因此人们可以在许多/经过测试的包之间进行选择）。
4.  仅基于所需功能计算的依赖关系。
5.  依赖项会考虑特定版本。
6.  仅使用已在上游发布的版本。
7.  如果可用，请使用版本控制系统中的版本。
8.  包是分类的。
9.  软件包不仅可以安装，还可以卸载和更新。
10.  支持创建上游版本包的分叉。
11.  支持发布这些分叉。
12.  支持选择分叉。
13.  安装包激活后。
14.  生成自动加载文件。
15.  与 Emacswiki 集成（参见 wikirel.el）。
16.  用户可以标记、评论等包并共享该信息。
17.  仅 FSF 分配/GPL/FOSS 软件或不关心许可证。
18.  包管理器应该与 Emacs 一起分发。
19.  支持轻松联系作者。
20.  大量元数据。
21.  在安装特定软件包之前建议替代方案。

***我希望得到这些答案***

*   指向更多实现、讨论等的指针。
*   对构成理想包管理器的一组功能的冗长描述。
*   一个特定的期望/不期望的特征的描述。随意从上面详细说明我的想法。
*   让我大吃一惊。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-17T23:50:50.237

我还在学习 Emacs，所以我还没有机会研究包管理器，但是一个很棒的功能是通知用户如果他们尝试使用包是可用的，但它不在他们的系统上。例如，我想在服务器上编辑一次 PHP 文件，我尝试过

```
M-x php-mode 
```

Emacs 就像

```
M-x php-mode [no match] 
```

什么时候应该像

```
php-mode available from ftp.gnu.org. install? (y/n) 
```

然后它会为我安装并加载 php-mode。那会让我的一天就在那里。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-18T01:23:23.997

**从版本控制自动发布**

我希望看到一个标准的、中央的、**单一**的Emacs 包管理器。现在，我会把钱放在[ELPA](http://tromey.com/elpa/)上，但还有很长的路要走。

对 Emacs 包管理器有帮助的最重要的事情就是让发布包变得非常简单。在我看来，我希望看到这种情况与**[GitHub](http://github.com/)****等中央托管平台**上的 git 等**版本控制系统**结合使用——这将使作者更容易发布他们的包，并使其他人更容易回馈。

类似于 GitHub（过去）如何使发布 RubyGems 变得容易，我希望在 Emacs 包管理器中看到类似的东西。例如，使用“vX.YZ”标记您的存储库，并让您的 elisp 优点自动提供给所有人。

使用像 GitHub 这样流行的后端的额外好处是，您会立即获得大量曝光，这将有助于推动其成功。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-18T02:23:22.067

我最期待的是*所有*有用的东西都在上面，并且运行良好。这要求你（或维护团队）积极地为它打包所有东西，并做任何涉及到的事情——给每个有用包的作者发电子邮件，等等。

例如，Debian（及其衍生产品：Ubuntu 等）之所以如此出色，是因为您可以愉快地使用您的系统，而无需在存储库之外安装任何东西，并且其上的所有内容都经过了彻底的测试。包管理器的实际功能很重要，但仅次于托管包本身。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-18T00:40:47.860

**轻松的配置同步**：我和许多人一样，在许多不同的计算机和服务器上使用 Emacs，其中一些是我自己的，一些不是。如果包管理器有某种文件可以从一台计算机传输到另一台计算机，那就太棒了；然后，在后一台计算机上，包管理器会将我的 Emacs 带入我喜欢的状态——所有已安装的包和设置的配置。结合能够轻松安装站点范围（如果有 root 权限）或作为单个用户安装的能力，我可以在任何地方同步所有 Emacsen。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-31T20:35:22.910

我几乎可以肯定，最好的解决方案包括向 ELPA 提交更多包并向 package.el 添加多源支持。Emacs 维护者表示他们会考虑在版本 24 中包含 package.el，只要它默认指向 FSF 存储库。

当然，提交也需要是一个自动化的过程；当前邮寄 ELPA 维护者的方法只适用于小规模。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-08-20T21:38:37.020

不管怎么做，在我看来，最重要的是，将包提交到存储库应该是微不足道的。同时，我们不希望这些软件包立即可用，以防止恶意代码（以及由于许可问题）。除非有基于加密签名的“信任”系统。

也很有用：

*   “元包”，一次安装多个包。
*   同理，我们应该可以安装一套elisp文件，为了可维护性
*   不应允许“损坏的”包破坏 Emacs 启动。这很简单，我在自己的 .emacs 中实现了它
*   能够安装脚本以外的文件。这经常被忽视，但非常有用。例如，您可以为图标、工具栏等发送图像。
*   版本控制：包 X 需要包 Y > 1.0
*   测试：执行基本的健全性检查，测试冲突（键绑定、函数重新定义、预期存在但不存在的函数等）。
*   **BUG 追踪**：我怎么强调这点的重要性都不为过。有一个集中的地方来报告包错误（并能够跟踪它们）对于确保包的质量非常重要。

某种压缩存档似乎是执行上述某些操作的最佳选择。

* * *

到目前为止，一个大大改进的 ELPA 似乎是要走的路。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-19T15:36:16.017

我曾经花一些时间为 Emacs 编写一个小型包管理器。

[http://gmarceau.qc.ca/plugin.el](http://gmarceau.qc.ca/plugin.el)

我写：

> Plugin 是我为 Emacs 创建包管理器的尝试。插件将自动下载 Emacs 扩展，将它们解压缩到一个目录中，将该目录添加到加载路径，生成自动加载注释，并修改您的 dot-emacs 文件。自动加载注解是 Emacs 鲜为人知的特性。一旦生成它们，Emacs 扩展就会快速且增量地加载，如果您安装了与我一样多的扩展，这真的很棒。

您将需要两个库文件来运行它，[loop-constructs.el](http://gmarceau.qc.ca/loop-constructs.el)和[record.el](http://gmarceau.qc.ca/record.el)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-21T15:23:54.557

我认为 iPhone 的黑客非常接近我想要的，Ubuntu 的“apt”也是如此。

我希望能够：

*   添加
*   删除（仅包）
*   删除用户设置
*   查看文档
*   升级（阅读更改日志后）
*   添加新存档（又名添加存储库）
*   查看依赖项
*   见版本
*   搜索名称、关键字
*   按（添加日期、修改日期、名称）浏览
*   保存所有已安装的软件包和设置
*   加载一组包和设置

我想要一组主要的东西，它们都能很好地工作，并且是推荐的做任何事情的方式。然后是一个全局集合，所有工作都在其中。然后任何人都可以托管自己的档案。

如果这一切都与 git/svn/whatever 相关联，这样您就可以安装旧版本，那就太好了。通过分叉等来制作自己的补丁等等......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-18T11:03:32.767

除了上面提到的之外，我还期待像 debian 和其他存储库这样的东西——一组稳定的、实验性的、未经测试的包。能够添加我自己的存储库 - 我直接使用 VCS 中的许多包，因此创建自己的包可能很有用

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-12-22T21:09:24.400

我认为包管理器应该从[Rubygems](http://docs.rubygems.org/)中获得很多灵感。我也认为它应该有一个像[Gemcutter](http://gemcutter.org/)这样的网站。

中央存储库也可以很好（例如[Emacsmirror](http://github.com/emacsmirror)）。但是，如果存在像 Gemcutter 这样收集所有包的站点，则可能不需要这样做。

我认为这些事情对于这个工作很重要。

*   收集所有包裹的某种中心位置
*   易于添加软件包
*   易于维护的软件包
*   易于为其他软件包做出贡献
*   易于安装、卸载和更新软件包
*   可以添加包依赖项
*   所有包的通用结构

因此，像 Rubygems 这样的包管理器具有像 Gemcutter 这样的站点和像 Emacsmirror 这样的中央存储库（最好在 Github 上，因为它是社交编码），这对 Emacs 来说非常有用。

总而言之，我认为应该从 Rails 以及 Rails 如何处理 Gems 中获得很多灵感。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-04-12T12:11:58.133

我不知道这个问题有多新鲜……
但我想看到的模型是 CPAN。我也不知道 Rubygems，但它听起来类似于 CPAN。

CPAN 是一个 perl 归档 + 图书馆管理系统。当我需要编写需要... FTP 或 SOAP 或 JSON 或 XML 或 ZIP 或...等的 perl 程序时，我可以运行 CPAN 包管理器，选择下载所需的包，查看并验证依赖关系，然后安装一切。CPAN 是镜像的 ..“无处不在”。

CPAN 非常适合我的目的，并且对于 emacs 来说类似的东西会很高兴。它还支持按需构建 C/C++ 代码。

这就是我希望在 emacs 中看到的。

一些关于要求的进一步评论。

*   显式下载软件包。没有自动安装。没有隐形下载。我想要求新的库或新功能。
*   我应该能够列出已安装软件包的名称/版本/时间戳。
*   如果我的朋友给我他的列表，我应该能够将他的 emacs 状态与我的进行比较。
*   检查更新功能。有哪些可用更新？他们修什么？
*   依赖检查、验证和下载。如果我安装 csharp-mode 并且它需要 v5.0.28 的 cc-mode，那么它应该与我确认，我还必须下载 cc-mode。
*   这些包应该有某种社区排名，比如在 isohunt 上对种子进行排名。我想看看一个包是否有 3 个赞成票或 3000 个。
*   “交易”行为。如果安装成功，它必须放松到最后已知的良好状态。
*   故障保险。如果我在 linum.el 中放置了自定义模块，它应该拒绝在我的更改上安装新版本，除非我明确允许它。它应该在开始之前警告我。在现有安装上使用校验和/md5 执行此操作。
*   可以选择从压缩档案中运行一些包，例如 zip 文件。所以我从不怀疑我没有更新任何嵌入式 elisp。
*   使用镜像主机进行软件包分发的能力。
*   所有这些功能都应该可以通过 Mx library-manageemnt 或其他方式访问。

最后，最好有一种方法来分离或组织函数库。分层命名空间。Emacs 的平面命名空间已经过时了。这有点独立，但对包管理的核心功能是互补的。我不是 lisp 大师，所以我不知道这有多难；也许已经有办法了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-12-11T13:24:53.160

包管理器不提供任何我看重的具有简单依赖关系的单文件 elisp 包：添加和删除`site-lisp`从未引起问题。它是依赖于外部程序的包（例如，ispell），多文件包（例如，auctex、org-mode）可能很棘手。暂时想不出任何具有非平凡依赖的单文件 elisp 包。

对于这些，缺少包管理器，我希望 emacs 的 elisp-packages 获得可以整体运行的测试套件，并在依赖项失败的情况下提供有用的信息。

# c# - C#什么是保存动态创建的控件的最佳方法

> ID：454270
> 
> 赞同：0
> 
> 时间：2009-01-17T23:12:27.100
> 
> 标签：c#, .net

我目前通过将每个属性保存为 xml 文档中的元素，将 .net ( c# ) 用户控件作为 XML 文件保存到磁盘。该文件用于以后在运行时重新创建控件。我想知道是否可以或更好地将控件保存为二进制文件。会有很多控件，所以我猜它必须有一个标题部分来描述每个保存的控件的位置和长度。想法？

布拉德

顺便说一句，这是一个 Windows 应用程序

编辑：

我目前拥有的是一个公共成员函数，它使用 propertyDescriptior 类遍历所有属性并从中创建一个 xml 文档。

```
 PropertyDescriptorCollection pdc = TypeDescriptor.GetProperties(this);

        for (int i = 0; i <= pdc.Count - 1; i++)
        {   pdc[i].Name
     pdc[i].PropertyType
    pdc[i].Category 
```

}

我将研究创建类 Serializable - 谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T00:18:52.753

Winforms 控件的序列化不是特别好，并且您可能很难让基类（即不是您的代码）发挥作用。`Color`例如，诸如 之类的东西经常提供令人惊讶的序列化麻烦。

Xml 将是一个显而易见的（如果可以预测的话）选择，但您通常需要提前指定子类。当然，基类不会被标记为可序列化。`BinaryFormatter`会避免其中的一些，但作为基于字段的序列化程序，您会遇到基类中的“句柄”等问题，这些是无意义的序列化。

我并不是说它不能完成——但它也不会是微不足道的。作为初学者，您需要查看`TypeConverter.GetProperties`，并使用`Converter`each 来获取作为不变字符串的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T04:28:42.563

我们必须为用户可以创建可持久视图的数据驱动应用程序执行此操作。我们开始使用 XML 版本，但后来转而使用 BinaryFormatter 和 ISerializable 接口，因为这使我们能够准确控制要持久化的内容以及要使用的构造函数。对于控件，我们实际上保留了设计器创建的 CodeCompileUnit，但这意味着您必须实际使用设计器来布置它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T05:36:26.047

只是有一个想法：也许您不需要序列化基类/子类。也许您可以编写另一个仅序列化类继承层次结构顶层的序列化器？只序列化你的类（你写的），也许存储你可能派生的基类的元数据（这样你就可以在反序列化时重新映射它）？？这也可能是天上掉馅饼。

# processing - 处理时的绝对鼠标位置

> ID：454271
> 
> 赞同：4
> 
> 时间：2009-01-17T23:12:44.307
> 
> 标签：processing, mouse-coordinates

这是我在处理论坛上发布的帖子的复制粘贴（到目前为止我还没有得到答案），我想我不妨在这里试试。

处理是一种非常酷的绘制东西的方式，特别是对于网页。只是作为参考[http://processing.org](http://processing.org)

嘿，我是处理新手，我正在用它来制作一个无闪光的网站，所以我几乎是在画布上画画。

我的鼠标位置有问题，虽然坐标在绘制时考虑左上角是位置 0,0；实际的鼠标坐标将 0,0 视为浏览器窗口的左上角。

所以我的问题是，画布在一个居中的网页上运行，每当浏览器改变大小时，画布中鼠标的坐标也是如此。

有什么办法可以使鼠标相对于画布的坐标？这样我就可以更改浏览器窗口的大小，并且鼠标坐标的左上角将始终为 0,0？

所以这就是问题所在，我不知道stackoverflow中有多少人对此有过经验，但我希望有人能帮助我:)

提前感谢堆栈溢出社区。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T13:10:02.250

我不熟悉处理，但不能只计算浏览器窗口左上角和画布左上角之间的差异吗？
即（使用jquery）

```
$(window).onresize = function() {
 //offset return position realive to the document.
 var offset = $('#canvas').offset();
 window.canvasLeft = offset.left;
 window.canvasTop = offset.top;
} 
```

然后您可以执行以下操作：

```
 relativeMouseLeftPosition = mouseLeftPosition() - window.canvasLeft; 
```

您应该将 #canvas 替换为画布区域的 css 选择器。

另请注意，window 是全局对象，我在这里使用它来处理可能的范围问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T13:31:12.533

处理真的不适合创建网页。它比网站的Flash*更糟糕*（处理草图是 Java 小程序 - Java 不太常见，资源密集型和加载速度慢..）

也就是说，有[processing.js](http://ejohn.org/blog/processingjs/)，一个处理的 Javascript 端口。

[蛇示例](http://ejohn.org/apps/processing.js/examples/custom/snake.html)访问鼠标。因为它是 Javascript，并且画布是 a `div`，所以坐标应该比 Java（它生活在它自己的 VM 世界中）更理智一点，但我可能是错的..

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-31T13:08:15.327

您可以要求用户在使用前校准系统。这不是问题的完全答案，而是问题的解决方案。

只需在屏幕中央、左上角和右下角画一个红点。要求用户点击它们，然后检索坐标。然后，您知道屏幕的角落在哪里。

# java - Android中的定时弹出

> ID：454274
> 
> 赞同：12
> 
> 时间：2009-01-17T23:14:44.880
> 
> 标签：java, android, popup, timer

我正在为 Android 创建一个匹配游戏，当用户获得匹配时，应该会弹出一个对话框，上面写着“匹配！” 我无法弄清楚如何做到这一点。如果我使用 Thread.currentthread().sleep，则对话框永远不会出现。

```
android.app.AlertDialog a = new android.app.AlertDialog.Builder(match.this).setTitle("Match!").show();
Thread.currentthread().sleep(1000);
a.dismiss(); 
```

什么都没有发生 - 程序只是挂起一秒钟。我希望它只弹出 1 秒钟，或者如果有另一种弹出类型的东西，那也很好。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-18T08:18:31.040

您想在屏幕上短时间在弹出窗口中显示一条短信？

对于这些类型的警报，祝酒词很棒：

```
Toast.makeText(this, "Match!", Toast.LENGTH_LONG).show(); 
```

那是你要找的吗？ [这是Java文档。](http://code.google.com/android/reference/android/widget/Toast.html#makeText(android.content.Context,%20java.lang.CharSequence,%20int))

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-29T17:58:47.973

该对话框显示在当前线程中，但您将线程置于睡眠状态，因此它永远不会出现。除了事件限制之外，在少数情况下，您希望在 UI 线程有相当大的延迟的情况下调用 sleep。

在这种情况下，使用 Toast 是最简单的，正如之前的海报所建议的那样。处理您希望在未来完成的工作的其他几种方法

*   Java 计时器。该操作将
    在不同的线程上发生，因此您必须小心您所做的 gui 调用
*   Views有一个postDelayed(Runnable action, long delayMillis)方法会导致Runnable在大致delayMillis后在UI线程上执行。

# asp.net - 如何在 Web.config 中为 SmtpClient 启用 SSL

> ID：454277
> 
> 赞同：29
> 
> 时间：2009-01-17T23:16:19.793
> 
> 标签：asp.net, .net, web-config, smtpclient

有没有办法从 web.config 设置 EnableSSL？

我可以在代码中设置此属性，但这不适用于简单邮件 Web 事件和其他使用默认 Smtp 服务器的类。有任何想法吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-25T19:32:30.290

对于 .NET 3 及更早版本：您不能。您必须手动管理它。

有关更多信息，您可以查看[https://blogs.msdn.microsoft.com/vikas/2008/04/29/bug-asp-net-2-0-passwordrecovery-web-control-cannot-send-emails-to- ssl-enabled-smtp-servers/](https://blogs.msdn.microsoft.com/vikas/2008/04/29/bug-asp-net-2-0-passwordrecovery-web-control-cannot-send-emails-to-ssl-enabled-smtp-servers/)。

对于 .NET 4：可以。

请参阅[http://theoldsewingfactory.com/2011/01/06/enable-ssl-in-web-config-for-smtpclient/](http://theoldsewingfactory.com/2011/01/06/enable-ssl-in-web-config-for-smtpclient/)

```
<configuration>
    <system.net>
        <mailSettings>
            <smtp deliveryMethod=”network”&gt;
                <network host="localhost"
                         port="25"
                         enableSsl="true"
                         defaultCredentials="true" />
            </smtp>
        </mailSettings>
    </system.net>
</configuration> 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-10-11T11:04:25.440

我有一个肮脏的解决方法（直到 .NET 4.0 出来）。它依赖于使用的端口来确定是否需要 SSL，而不是更改我的代码。

```
var client = new SmtpClient();
client.EnableSsl = client.Port == 587 || client.Port == 465;
// This could also work
//client.EnableSsl = client.Port != 25; 
```

我说这是一个肮脏的黑客，但它适用于我们遇到的不同配置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-02-11T20:42:22.947

这在.net 4中对我有用

web.config 中的 EG

```
network host="somesmtpserver" userName="do_not_reply@yourserver.com" 
password="whatever" port="25" enableSsl="true" 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-03-30T07:02:05.227

贾尔斯·罗伯茨 2012 年 1 月 18 日在 18:01 说

这在.net 4中对我有用

web.config 中的 EG

```
network host="somesmtpserver" userName="do_not_reply@yourserver.com" 
password="whatever" port="25" enableSsl="true" 
```

端口 25 不是 SSL 端口。端口 25 是默认的 SMTP 端口。此外，web.config 代码已部分填写。代码应该是

```
 <system.net>
         <mailSettings>
              <smtp deliveryMethod="Network" from="user@gmail.com">
                     <network host="smtp.gmail.com"
                     userName="user@gmail.com"
                     password="********"
                     port="587"
                     defaultCredentials="true"
                     enableSsl="true" />
             </smtp>
        </mailSettings>
   </system.net> 
```

上面的这个设置比原来的 web.config 代码更准确。我不知道女巫的方法更好。使用 web.config 或使用代码隐藏页面发送电子邮件。无论使用哪种方法，您都必须修改代码隐藏文件。我这样说是因为您必须连接 From、Subject 和 Body 文本框。我想当然地认为您想通过 aspx 网页发送消息的最终结果

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-01T20:21:32.067

啊，有一种方法可以解决 .net 登录控件中内置的“忘记密码”。

请参阅[http://blogs.msdn.com/vikas/archive/2008/04/29/bug-asp-net-2-0-passwordrecovery-web-control-cannot-send-emails-to-ssl-enabled-smtp -servers.aspx](http://blogs.msdn.com/vikas/archive/2008/04/29/bug-asp-net-2-0-passwordrecovery-web-control-cannot-send-emails-to-ssl-enabled-smtp-servers.aspx)

瑞安

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-01-15T04:03:03.183

这是我在 web.config 文件中使用的代码。[![在此处输入图像描述](https://i.stack.imgur.com/OhJuG.png)](https://i.stack.imgur.com/OhJuG.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T09:54:32.857

我几乎到处都在寻找这个。

但似乎我们无法在 web.config 中配置 EnableSsl 属性。

看看[这个](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=281277)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-24T08:07:55.283

我认为`MailSettingsSectionGroup`. 见下面的代码：

```
Configuration configurationFile = WebConfigurationManager.OpenWebConfiguration("~/web.config");
var mailSettings = configurationFile.GetSectionGroup("system.net/mailSettings") as MailSettingsSectionGroup;

_smtpClient.Host = mailSettings.Smtp.Network.Host;
_smtpClient.Port = mailSettings.Smtp.Network.Port;
_smtpClient.EnableSsl = mailSettings.Smtp.Network.**EnableSsl**;
_smtpClient.Credentials = new System.Net.NetworkCredential(mailSettings.Smtp.Network.UserName, mailSettings.Smtp.Network.Password);
_smtpClient.UseDefaultCredentials = false; 
```

似乎它`EnableSsl`不作为 Network 下的属性存在，因为当我运行和调试它时，我可以看到该值，但由于缺少 ExtensionMethod 无法编译代码。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-08-24T08:45:05.860

我似乎班级是密封的，所以我做了一个手动扩展。我想我会在这里为其他人提供它。希望它可以对其他人有用。

```
/// <summary>
/// OldSchool extension of SmtpNetWorkElement, since it's sealed.
/// </summary>
public class SmtpNetworkElementEx
{
    private readonly SmtpNetworkElement m_SmtpNetWorkElement;

    /// <summary>
    /// Initializes a new instance of the <see cref="SmtpNetworkElementEx"/> class.
    /// </summary>
    public SmtpNetworkElementEx()
    {
        Configuration configurationFile = WebConfigurationManager.OpenWebConfiguration("~/web.config");
        var mailSettings = configurationFile.GetSectionGroup("system.net/mailSettings") as MailSettingsSectionGroup;

        if (mailSettings == null)
            return;

        m_SmtpNetWorkElement = mailSettings.Smtp.Network;
    }

    public string Host { get { return m_SmtpNetWorkElement.Host; } }
    public bool DefaultCredentials { get { return m_SmtpNetWorkElement.DefaultCredentials; } }
    public string ClientDomain { get { return m_SmtpNetWorkElement.ClientDomain; } }
    public string TargetName { get { return m_SmtpNetWorkElement.TargetName; } }
    public int Port { get { return m_SmtpNetWorkElement.Port; } }
    public string UserName { get { return m_SmtpNetWorkElement.UserName; } }
    public string Password { get { return m_SmtpNetWorkElement.Password; } }
    public bool EnableSsl { get { return Convert.ToBoolean(m_SmtpNetWorkElement.ElementInformation.Properties["enableSsl"].Value); } }
} 
```

使用这种方式：

```
var smtpSettings = new SmtpNetworkElementEx();

_smtpClient.Host = smtpSettings.Host;
_smtpClient.Port = smtpSettings.Port;
_smtpClient.EnableSsl = smtpSettings.EnableSsl;
_smtpClient.Credentials = new System.Net.NetworkCredential(smtpSettings.UserName, smtpSettings.Password); 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-02-24T15:58:17.103

只需扩展类并设置 EnableSsl = true 并使用该类。

# flash - 为什么 XSPF Player 不能在 Mac 上运行？

> ID：454288
> 
> 赞同：0
> 
> 时间：2009-01-17T23:23:49.543
> 
> 标签：flash, macos, xspf

我在一个新网站上使用[XSPF Player](http://musicplayer.sourceforge.net/) (slim)。客户告诉我他们在 Mac 上的 Safari 中听不到任何音乐。播放器是可见的，但它只是说“正在加载播放列表......”并且永远不会超过那个点。我无法想象为什么它在我尝试过的所有基于 PC 的浏览器中都能正常工作。我没有Mac，所以很难确认这一点。我无法解决这个问题，并且想知道其他人是否曾经在 Mac 上遇到过播放器问题。该网站是：

[http://boernewineseller.com/](http://boernewineseller.com/)

也许 Mac 中有一个安全设置不允许它下载未知扩展？播放列表称为[playlist.xspf](http://boernewineseller.com/resources/flash/music/playlist.xspf)。

注意：我什至不想要网站上的音乐，他们坚持。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T01:21:03.143

首先恭喜您获得了有效的 XSPF 文件——很少有人能做到这一点。我想您可能会对播放器没有出现在我的 Windows 上的 Firefox 3.0.5 上感兴趣。我必须深入研究 HTML 代码才能找到播放器 URL。直接加载时效果很好。不过，由于我不在 Mac 上，因此无法提供进一步的帮助。祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T06:56:44.333

原来这只是一个 Flash 安全问题。客户端在 URL 前使用 www，我没有。如果没有设置跨域策略，Flash 将不会从主机加载某些内容。我已将 XSPF 文件的路径更改为相对路径，现在无论输入的域如何，它都可以正常工作。

在某个时候，我会加入 301。

# winapi - keystroke util，键盘回调问题

> ID：454291
> 
> 赞同：0
> 
> 时间：2009-01-17T23:25:20.833
> 
> 标签：winapi, keyboard, callback

很久以前，当我看到一个应用程序为游戏做这个时，我就有了这个想法。

我想捕捉某些击键。/s myCommand 之类的东西。我有 ppl msg 我并通过 msn 搞砸了我，所以我的第一个命令将类似于 killmsn。我在 msdn 上查找了资源并得到了这么多。这不起作用，为什么不起作用？是睡眠的 BC 吗？我应该怎么做，注意我没有窗口，我希望这是一个控制台应用程序。我的 KeyboardProc 永远不会被调用

```
#include <windows.h>
#include <stdio.h>

HHOOK hook;
LRESULT CALLBACK KeyboardProc(int code, WPARAM wParam, LPARAM lParam)
{
    printf("%c", wParam);
    return CallNextHookEx(hook, code, wParam, lParam);
}

int main()
{
    hook = SetWindowsHookEx(WH_KEYBOARD, KeyboardProc, GetModuleHandle(0), 0);
    Sleep(10000);
    UnhookWindowsHookEx(hook);
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T00:57:41.147

解决方案

```
//Sleep(10000);
MSG msg;
while(GetMessage(&msg, NULL, 0, 0) > 0)
{
    TranslateMessage(&msg);
    DispatchMessage(&msg);
}
UnhookWindowsHookEx(hook); 
```

# java - Prevayler 的同步策略是什么？

> ID：454294
> 
> 赞同：5
> 
> 时间：2009-01-17T23:27:37.430
> 
> 标签：java, concurrency, synchronization, persistence, prevayler

Prevayler 保证所有写入（通过其事务）都是同步的。但是阅读呢？

如果不使用显式同步（在用户代码中），脏读是可能的吗？

如果业务对象被解读为：

```
// get the 3rd account
Accont account = (Bank)prevayler.prevalentSystem().getAccounts().get(2); 
```

?

如果是这样，哪些同步策略对用户代码有好处？

（考虑一个业务对象 A 包含业务对象 Bs 的集合），

*   使用同步集合（A 内的 B），例如来自 java.util.concurrent 包？
*   同步集合读取外部事务与集合写入事务内部，例如在读写周围使用“同步（集合）”代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-26T08:00:53.707

推荐的方法是使用 JMatch Query 和 Prevayler.execute(Query)。直接或通过使用子类化。

返回的结果必须是原始值或不可变对象。如果您打算返回可变对象，则应将 JMatch Query 子类化以执行这些深层复制。这样，您将获得一个系统，该系统将每个明智的读取与其他（明智的）读取和写入锁定。这可以加快和简化开发，尤其是对于没有多线程编程经验的开发人员。

如果您在高并发负载下需要更高的性能，这应该是一种罕见的情况，您确实可以使用上述细粒度锁定 - 使用“同步”和 java.util.concurrent。

有关更多详细信息，请参阅[此讨论](http://sourceforge.net/mailarchive/forum.php?thread_name=9746cf8a0901250219g4ba5d6cpa98778569a51cd0%40mail.gmail.com&forum_name=prevayler-discussion)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-24T06:32:22.570

自从我看到 Prevayler 已经有很长时间了（大约 6 或 7 年前，我在 POC 项目中使用过它）。我很确定，如果通过 Prevayler 进行所有读取和写入，则不需要进一步的同步 - 当然我不需要这样做，并且有多个线程使用数据存储。

# variables - 为什么我们在循环中使用 i 作为计数器？

> ID：454303
> 
> 赞同：91
> 
> 时间：2009-01-17T23:35:08.507
> 
> 标签：variables, loops, naming

我们为什么使用

```
for (int i = 0 ; i < count ; i++){ } 
```

为什么`i`？

为什么不

```
for (int a = 0; a < count; a++){ } 
```

我做，你做，每个人都做，但为什么？

*编辑

我发现了一句关于 Fortran 的老话，它比正确更有趣，它说“上帝是真实的，上面的一切都是整数”。

“god”是一个变量名，用 a 表示，`g`所以它在真实域中，而上面的所有其他内容（出于笑话的目的不包括 h）都是整数。

似乎原来的说法实际上是：“上帝是真实的，除非声明为整数”。向所有在他们的博士论文中引用我的人道歉。

# .net - 为什么 .NET 开发人员提供 32 位/64 位版本的 .NET 程序集？

> ID：454306
> 
> 赞同：6
> 
> 时间：2009-01-17T23:36:59.923
> 
> 标签：.net, 64-bit, jit

Evey 时不时地看到 x86 和 x64 版本的 .NET 程序集。请考虑以下[用于 SharePoint 的 Web 部件](http://www.codeplex.com/smartpart/Release/ProjectReleases.aspx?ReleaseId=10706)。为什么开发人员不只提供一个版本并让 JIT 编译器整理其余部分？当我看到这些类型的产品时，是否只是开发人员决定使用像[ngen](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx)这样的工具来创建本机映像以避免 JIT？

有人请在这里帮助我，我觉得我错过了一些值得注意的东西。

**更新**

根据我在下面得到的信息，提供 x86 和 x64 版本是因为以下一个或多个原因：

1.  开发人员希望避免 JIT，并使用 ngen.exe 之类的工具针对给定架构创建了他的代码的本机映像。

2.  该程序集包含特定于平台的 COM 调用，因此将其构建为 AnyCPU 毫无意义。在这些情况下，针对不同平台的构建可能包含不同的代码。

3.  程序集可能包含使用 pinvoke 的 Win32 调用，它不会被 JIT 重新映射，因此构建应该以它绑定到的平台为目标。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-17T23:38:30.167

如果他们使用特定的非.Net API，那么可能有两个代码库，一个完美的例子是COM控件。

正如你所提到的，ngen 也是另一个很好的理由。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-18T02:40:50.940

当你编译一个 .net 应用程序时，你必须在 Build Settings 中选择一个 Platform Target。选择是 AnyCPU、x86 和 x64。

一个常见的错误是在包含为 x86 编译的本机 DLL 的项目中指定 AnyCPU。这将导致在 64 位机器上运行时出错，这是在 64 位机器上测试的一个很好的理由。

因此，为了支持那些被其他依赖项强制直接为 x86 或 x64 构建的人，该程序集同时提供了这两者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-03T02:27:28.750

COM 处理跨 32/64 位边界的编组和解组。但是，它不支持将替代类型的二进制加载到错误的单元指针宽度中。

许多程序集依赖于本机代码（例如，大多数 SQL 驱动程序是用 C 或 C++ 编写的）。这对于任何使用 p/invoke 的东西来说都是非常明显的；因此，编译和分发不同的指针宽度意味着 64 位版本的包很可能包含 64 位本机 DLL，而 32 位版本可能包含 32 位本机 DLL。即使 32 位和 64 位版本的程序集是从相同的代码编译的，情况也是如此。

如果您要求，csc 将生成本机（预 JITted）图像。

# android - 如何在 Android 中格式化日期和时间？

> ID：454315
> 
> 赞同：357
> 
> 时间：2009-01-17T23:41:37.150
> 
> 标签：android, date, time, formatting, format

有年月日时分时，如何根据设备配置日期和时间正确格式化？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-01-19T08:57:09.677

使用标准的 Java DateFormat 类。

例如，要显示当前日期和时间，请执行以下操作：

```
Date date = new Date(location.getTime());
DateFormat dateFormat = android.text.format.DateFormat.getDateFormat(getApplicationContext());
mTimeText.setText("Time: " + dateFormat.format(date)); 
```

您可以使用自己的值初始化 Date 对象，但是您应该知道构造函数已被弃用，您应该真正使用 Java Calendar 对象。

* * *

## 回答 #2

> 赞同：227
> 
> 时间：2010-10-14T04:34:50.373

在我看来，`android.text.format.DateFormat.getDateFormat(context)`这让我感到困惑，因为这个方法返回`java.text.DateFormat`而不是`android.text.format.DateFormat`- -”。

因此，我使用下面的片段代码以我的格式获取当前日期/时间。

```
android.text.format.DateFormat df = new android.text.format.DateFormat();
df.format("yyyy-MM-dd hh:mm:ss a", new java.util.Date());

or

android.text.format.DateFormat.format("yyyy-MM-dd hh:mm:ss a", new java.util.Date()); 
```

此外，您可以使用其他格式。按照*[日期格式](http://developer.android.com/reference/android/text/format/DateFormat.html)*。

* * *

## 回答 #3

> 赞同：197
> 
> 时间：2017-11-03T15:09:32.150

您可以使用`DateFormat`. 结果取决于手机的默认语言环境，但您也可以指定语言环境：

[https://developer.android.com/reference/java/text/DateFormat.html](https://developer.android.com/reference/java/text/DateFormat.html)

这是一个结果

```
DateFormat.getDateInstance().format(date) 
```

法国地区：11 月 3 日。2017

美国/英语语言环境：1952 年 1 月 12 日

* * *

```
DateFormat.getDateInstance(DateFormat.SHORT).format(date) 
```

法国地区：2017 年 3 月 11 日

美国/英语语言环境：12.13.52

* * *

```
DateFormat.getDateInstance(DateFormat.MEDIUM).format(date) 
```

法国地区：11 月 3 日。2017

美国/英语语言环境：1952 年 1 月 12 日

* * *

```
DateFormat.getDateInstance(DateFormat.LONG).format(date) 
```

法国地区：2017 年 11 月 3 日

美国/英语语言环境：1952 年 1 月 12 日

* * *

```
DateFormat.getDateInstance(DateFormat.FULL).format(date) 
```

法国地区：vendredi 2017 年 11 月 3 日

美国/英语语言环境：1952 年 4 月 12 日，星期二

* * *

```
DateFormat.getDateTimeInstance().format(date) 
```

法国地区：11 月 3 日。2017 16:04:58

* * *

```
DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT).format(date) 
```

法国地区 : 03/11/2017 16:04

* * *

```
DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.MEDIUM).format(date) 
```

法国地区 : 03/11/2017 16:04:58

* * *

```
DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.LONG).format(date) 
```

法国地区：03/11/2017 16:04:58 GMT+01:00

* * *

```
DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.FULL).format(date) 
```

法国地区：03/11/2017 16:04:58 heure normale d'Europe centrale

* * *

```
DateFormat.getTimeInstance().format(date) 
```

法国地区：16:04:58

* * *

```
DateFormat.getTimeInstance(DateFormat.SHORT).format(date) 
```

法国地区：16:04

* * *

```
DateFormat.getTimeInstance(DateFormat.MEDIUM).format(date) 
```

法国地区：16:04:58

* * *

```
DateFormat.getTimeInstance(DateFormat.LONG).format(date) 
```

法国地区：16:04:58 GMT+01:00

* * *

```
DateFormat.getTimeInstance(DateFormat.FULL).format(date) 
```

FR 地区：16:04:58 heure normale d'Europe centrale

* * *

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2015-06-10T11:24:33.507

日期到语言环境日期字符串：

```
Date date = new Date();
String stringDate = DateFormat.getDateTimeInstance().format(date); 
```

选项：

```
 DateFormat.getDateInstance() 
```

- > 1969 年 12 月 31 日

```
 DateFormat.getDateTimeInstance() 
```

-> 1969 年 12 月 31 日下午 4:00:00

```
 DateFormat.getTimeInstance() 
```

-> 下午 4:00:00

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2010-08-03T21:48:07.140

这将做到：

```
Date date = new Date();
java.text.DateFormat dateFormat = android.text.format.DateFormat.getDateFormat(getApplicationContext());
mTimeText.setText("Time: " + dateFormat.format(date)); 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2012-12-18T07:55:19.933

**使用 SimpleDateFormat**

像这样：

```
event.putExtra("starttime", "12/18/2012");

SimpleDateFormat format = new SimpleDateFormat("MM/dd/yyyy");
Date date = format.parse(bundle.getString("starttime")); 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2014-01-05T16:50:00.897

在此之后：http: [//developer.android.com/reference/android/text/format/Time.html](http://developer.android.com/reference/android/text/format/Time.html)

最好使用 Android 原生 Time 类：

```
Time now = new Time();
now.setToNow(); 
```

然后格式化：

```
Log.d("DEBUG", "Time "+now.format("%d.%m.%Y %H.%M.%S")); 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2020-07-28T13:33:16.210

**这是最简单的方法：**

```
 SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd hh:mm:ss a", Locale.US);

    String time = df.format(new Date()); 
```

如果您正在寻找**模式**，请查看此 [https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html](https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html)

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2012-06-23T05:44:02.630

使用这两个作为类变量：

```
 public java.text.DateFormat dateFormat = new SimpleDateFormat("dd/MM/yyyy");
 private Calendar mDate = null; 
```

并像这样使用它：

```
 mDate = Calendar.getInstance();
 mDate.set(year,months,day);                   
 dateFormat.format(mDate.getTime()); 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2020-12-19T07:47:06.370

## 日期时间格式说明

```
EEE : Day ( Mon )
MMMM : Full month name ( December ) // MMMM February   
MMM : Month in words ( Dec )
MM : Month ( 12 )
dd : Day in 2 chars ( 03 )
d: Day in 1 char (3)
HH : Hours ( 12 )
mm : Minutes ( 50 )
ss : Seconds ( 34 )
yyyy: Year ( 2020 ) //both yyyy and YYYY are same
YYYY: Year ( 2020 )
zzz : GMT+05:30
a : ( AM / PM )
aa : ( AM / PM )
aaa : ( AM / PM )
aaaa : ( AM / PM ) 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-04-11T17:54:27.620

这是我的方法，可以定义输入输出格式。

```
public static String formattedDateFromString(String inputFormat, String outputFormat, String inputDate){
    if(inputFormat.equals("")){ // if inputFormat = "", set a default input format.
        inputFormat = "yyyy-MM-dd hh:mm:ss";
    }
    if(outputFormat.equals("")){
        outputFormat = "EEEE d 'de' MMMM 'del' yyyy"; // if inputFormat = "", set a default output format.
    }
    Date parsed = null;
    String outputDate = "";

    SimpleDateFormat df_input = new SimpleDateFormat(inputFormat, java.util.Locale.getDefault());
    SimpleDateFormat df_output = new SimpleDateFormat(outputFormat, java.util.Locale.getDefault());

    // You can set a different Locale, This example set a locale of Country Mexico.
    //SimpleDateFormat df_input = new SimpleDateFormat(inputFormat, new Locale("es", "MX"));
    //SimpleDateFormat df_output = new SimpleDateFormat(outputFormat, new Locale("es", "MX"));

    try {
        parsed = df_input.parse(inputDate);
        outputDate = df_output.format(parsed);
    } catch (Exception e) { 
        Log.e("formattedDateFromString", "Exception in formateDateFromstring(): " + e.getMessage());
    }
    return outputDate;

} 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2015-01-13T10:55:46.197

# 简单日期格式

**我使用没有自定义模式**的SimpleDateFormat以**设备的预选**格式从系统获取实际日期和时间：

```
public static String getFormattedDate() {
    //SimpleDateFormat called without pattern
    return new SimpleDateFormat().format(Calendar.getInstance().getTime());
} 
```

**返回**：

*   13.01.15 11:45
*   2015 年 1 月 13 日上午 10:45
*   ...

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2013-01-16T13:10:03.737

在 Time 类中使用 build！

```
Time time = new Time();
time.set(0, 0, 17, 4, 5, 1999);
Log.i("DateTime", time.format("%d.%m.%Y %H:%M:%S")); 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-10-08T18:04:24.330

这段代码对我有用！

```
Date d = new Date();
    CharSequence s = android.text.format.DateFormat.format("MM-dd-yy hh-mm-ss",d.getTime());
    Toast.makeText(this,s.toString(),Toast.LENGTH_SHORT).show(); 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2019-03-29T09:11:31.370

最短路径：

```
// 2019-03-29 16:11
String.format("%1$tY-%<tm-%<td %<tR", Calendar.getInstance()) 
```

`%tR`的缩写`%tH:%tM`，`<`表示重用最后一个参数（`1$`）。

它相当于`String.format("%1$tY-%1$tm-%1$td %1$tH:%1$tM", Calendar.getInstance())`

[https://developer.android.com/reference/java/util/Formatter.html](https://developer.android.com/reference/java/util/Formatter.html)

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2019-11-17T14:37:33.190

日期格式类使用作弊码来制作日期。像

1.  M -> 7, MM -> 07, MMM -> 七月, MMMM -> 七月
2.  EEE -> 周二，EEEE -> 周二
3.  z -> EST , zzz -> EST , zzzz -> 东部标准时间

[你可以在这里](https://www.developerlibs.com/2016/08/date-formate.html)查看更多作弊。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-09-08T09:03:20.763

其他答案通常是正确的。我想贡献现代答案。这些 classes `Date`，`DateFormat`并`SimpleDateFormat`在大多数其他答案中使用，早已过时，多年来给许多程序员带来了麻烦。`java.time`今天，我们在AKA JSR-310，现代 Java 日期和时间 API方面有了更好的表现。你可以在Android上使用它吗？最肯定！在 ThreeTenABP 项目中，现代类已被反向移植到 Android。有关所有详细信息，请参阅[此问题：如何在 Android 项目中使用 ThreeTenABP](https://stackoverflow.com/questions/38922754/how-to-use-threetenabp-in-android-project)。

这个片段应该让你开始：

```
 int year = 2017, month = 9, day = 28, hour = 22, minute = 45;
    LocalDateTime dateTime = LocalDateTime.of(year, month, day, hour, minute);
    DateTimeFormatter formatter = DateTimeFormatter.ofLocalizedDateTime(FormatStyle.MEDIUM);
    System.out.println(dateTime.format(formatter)); 
```

当我将计算机的首选语言设置为美国英语或英国英语时，会打印：

```
Sep 28, 2017 10:45:00 PM 
```

相反，当我将其设置为丹麦语时，我得到：

```
28-09-2017 22:45:00 
```

所以它确实遵循配置。不过，我不确定它遵循您设备的日期和时间设置的具体细节，这可能因手机而异。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-07-27T10:39:17.353

此代码将返回当前日期和时间：

```
public String getCurrDate()
{
    String dt;
    Date cal = Calendar.getInstance().getTime();
    dt = cal.toLocaleString();
    return dt;
} 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2017-09-26T19:05:21.950

# 语言环境

要从毫秒获取区域设置格式的日期或时间，我使用了这个：

## 日期和时间

```
Date date = new Date(milliseconds);
DateFormat dateFormat = DateFormat.getDateTimeInstance(DateFormat.MEDIUM, DateFormat.SHORT, Locale.getDefault());
dateFormat.format(date); 
```

## 日期

```
Date date = new Date(milliseconds);
DateFormat dateFormat = DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.getDefault());
dateFormat.format(date); 
```

## 时间

```
Date date = new Date(milliseconds);
DateFormat dateFormat = DateFormat.getTimeInstance(DateFormat.SHORT, Locale.getDefault());
dateFormat.format(date); 
```

您可以使用其他日期样式和时间样式。有关样式的更多信息在[这里](https://developer.android.com/reference/android/icu/text/DateFormat.html)。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-11-06T22:15:35.667

我这样使用它：

```
public class DateUtils {
    static DateUtils instance;
    private final DateFormat dateFormat;
    private final DateFormat timeFormat;

    private DateUtils() {
        dateFormat = android.text.format.DateFormat.getDateFormat(MainApplication.context);
        timeFormat = android.text.format.DateFormat.getTimeFormat(MainApplication.context);
    }

    public static DateUtils getInstance() {
        if (instance == null) {
            instance = new DateUtils();
        }
        return instance;
    }

    public synchronized static String formatDateTime(long timestamp) {
        long milliseconds = timestamp * 1000;
        Date dateTime = new Date(milliseconds);
        String date = getInstance().dateFormat.format(dateTime);
        String time = getInstance().timeFormat.format(dateTime);
        return date + " " + time;
    }
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-03-26T06:46:30.063

尝试：

```
event.putExtra("startTime", "10/05/2012"); 
```

当您访问传递的变量时：

```
SimpleDateFormat formatter = new SimpleDateFormat("dd/MM/yyyy");
Date date = formatter.parse(bundle.getString("startTime")); 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-08-08T19:41:00.933

# 避免juDate

Java（和 Android）中的 Java.util.Date 和 .Calendar 和 SimpleDateFormat 是出了名的麻烦。避开他们。它们太糟糕了，以至于 Sun/Oracle 放弃了它们，用 Java 8 中的新 java.time 包取代了它们（截至 2014 年在 Android 中没有）。新[`java.time`](http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html)的灵感来自[Joda-Time](http://www.joda.org/joda-time/)图书馆。

# 乔达时间

[Joda-Time](http://www.joda.org/joda-time/)确实适用于 Android。

在 StackOverflow 中搜索“Joda”以找到许多示例和讨论。

使用 Joda-Time 2.4 的源代码花絮。

标准格式。

```
String output = DateTime.now().toString(); 
// Current date-time in user's default time zone with a String representation formatted to the ISO 8601 standard. 
```

本地化格式。

```
String output = DateTimeFormat.forStyle( "FF" ).print( DateTime.now() ); 
// Full (long) format localized for this user's language and culture. 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-11-28T17:51:27.107

回到2016年，当我想自定义格式时（不是根据设备配置，如你所问...）我通常使用字符串资源文件：

在strings.xml 中：

```
<string name="myDateFormat"><xliff:g id="myDateFormat">%1$td/%1$tm/%1$tY</xliff:g></string> 
```

在活动中：

```
Log.d(TAG, "my custom date format: "+getString(R.string.myDateFormat, new Date())); 
```

[这对于新的日期绑定库](https://developer.android.com/topic/libraries/data-binding/index.html)的发布也很有用。

所以我可以在布局文件中有这样的东西：

```
<TextView
    android:id="@+id/text_release_date"
    android:layout_width="wrap_content"
    android:layout_height="0dp"
    android:layout_weight="1"
    android:padding="2dp"
    android:text="@{@string/myDateFormat(vm.releaseDate)}"
    tools:text="0000"
    /> 
```

在java类中：

```
 MovieDetailViewModel vm = new MovieDetailViewModel();
    vm.setReleaseDate(new Date()); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-08-30T09:22:21.063

android Time 类提供了 3 种格式化方法[http://developer.android.com/reference/android/text/format/Time.html](http://developer.android.com/reference/android/text/format/Time.html)

我是这样做的：

```
/**
* This method will format the data from the android Time class (eg. myTime.setToNow())   into the format
* Date: dd.mm.yy Time: hh.mm.ss
*/
private String formatTime(String time)
{
    String fullTime= "";
    String[] sa = new String[2];

    if(time.length()>1)
    {
        Time t = new Time(Time.getCurrentTimezone());
        t.parse(time);
        // or t.setToNow();
        String formattedTime = t.format("%d.%m.%Y %H.%M.%S");
        int x = 0;

        for(String s : formattedTime.split("\\s",2))
        {   
            System.out.println("Value = " + s);
            sa[x] = s;
            x++;
        }
        fullTime = "Date: " + sa[0] + " Time: " + sa[1];
    }
    else{
        fullTime = "No time data";
    }
    return fullTime;
} 
```

我希望这会有所帮助:-)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-10-12T10:38:36.487

为时已晚，但可能对某人有所帮助

```
DateFormat.format(format, timeInMillis); 
```

这`format`是您需要的格式

例如：“HH:mm”返回 15:30

# c++ - COM 事件通知

> ID：454316
> 
> 赞同：1
> 
> 时间：2009-01-17T23:41:51.050
> 
> 标签：c++, com

没有：

*   ATL
*   MFC

**笔记：**

*   客户端在与服务器**不同**的线程中执行

**问题：**

*   从**COM 对象**（服务器） 接收到**事件通知**后，如何**控制**客户端的**行为？**
*****   如何从客户端实现事件接口？****

 ****下图：

```
hresult = pis8->QueryInterface(
                __uuidof(IConnectionPointContainer),
            (void **) &pContainer);

//result handling omitted

hresult = pContainer->FindConnectionPoint(
                      __uuidof(IS8SimulationEvents),
                      &pConnection);

//result handling omitted 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T00:40:54.457

客户端实现事件接口 ( `IS8SimulationEvents`) 这可以在单独的组件中，也可以在客户端组件本身上。当组件触发事件时调用实现。

之后`FindConnectionPoint`，客户端调用`pConnection->Advise`，传递`IS8SimulationEvents`并接收“cookie”。cookie 需要调用`Unadvise`，必须在清理期间调用才能断开连接。

如果客户端在与服务器不同的线程中运行，则客户端需要运行消息循环来接收调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T00:36:49.770

如果我正确理解了这个问题，似乎客户端需要运行一个等待循环，例如

```
while(!threadCancel)
{
    DWORD waitResult = WaitForMultipleObjects(actionCount, waitHandles, FALSE, 500);
    switch (waitResult)
    {
        case SERVER_COMMAND_1:
            HandleServerCommand1();
            break;
        ...etc...
        default:
           throw ...
     }
} 
```

客户端的事件接收器触发等待句柄，有效地允许服务器告诉客户端该做什么。

# language-agnostic - 如何为你的同事做一个包含大量代码的演示文稿？

> ID：454321
> 
> 赞同：11
> 
> 时间：2009-01-17T23:46:23.477
> 
> 标签：language-agnostic, slideshow, powerpoint, presentation

我应该就我评估过的 Web 框架为我的同事做一个演示。这些人是开发人员，讨厌冗长乏味的 PowerPoint 内容，所以我得到了很多小代码片段。我还整理了一个小型示例应用程序。我的问题是，我如何呈现代码以便人们可以遵循？

我想到的一些事情：

*   将代码放在 PowerPoint 幻灯片上，看起来很糟糕，除非它是图像，否则我无法让语法突出显示工作。将我的代码放在图像中很痛苦，并且不能很好地扩展到不同的分辨率。
*   我使用了 S5 XHTML 演示格式并集成了一个 JavaScript 语法高亮显示。这有点笨拙但可行（我会因为忽略公司的 CI 进行演示而感到悲伤，因为我不会使用他们的模板。甚至不要问......）
*   我可以在我的观众面前整理一个脚本（笔记）和“实时代码”。我不太喜欢这个，因为它让我很忙，以至于我在写作时很难给出一个好的解释。而且我也很有可能导致错误并让他们等待。
*   截屏？但那样我就不必在那里了……也许叙述一下？

那你会怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-17T23:52:04.930

> 我可以在我的观众面前编写一个脚本和“实时代码”。我不太喜欢这个，因为它让我很忙，以至于我在写作时很难给出一个好的解释。而且我也很有可能导致错误并让他们等待。

我喜欢这个选项，如果你能把你的演示精简到不妨碍观众的地步。当食谱花费的时间超过他们的时间时，您可以做电视厨师所做的事情；开始编码，然后跳到已完成 90% 或 100% 的代码。

如果你有一个同事，你可以跟上进度，你可以让他们在你说话的同时进行编码并指出他们在做什么。

您可以使用您的 IDE，它会突出显示语法并向您的听众展示如何编译、部署、测试等。不过，我建议您使用超大字体，仅用于会话，以便每个人都能看到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T23:51:35.510

您的 IDE 是否允许打开/关闭区域或代码段？在 Visual Studio 中，您可以创建可以展开或折叠的代码区域。如果您的 IDE 能够执行此操作，您可以将代码示例创建为区域，然后在您浏览演示文稿时打开/关闭它们。您可以在 IDE 中的演示文稿和代码示例之间来回切换，但不必即时编写代码。使用 open/close 可以让你隐藏你没有引用的代码，以减少混乱。

实际上，我在 Agile 2008 上看到了这一点，它似乎工作得很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T23:52:33.213

您只能在 PowerPoint 幻灯片上放置这么多信息，但这实际上是一件好事：人们只能查看一定数量的信息并从中获得有意义的信息。

因此，如果您无法将其放在 PowerPoint 幻灯片上，您需要重新考虑您的方法。

代码片段很好。它们不需要突出显示。只需将它们放入 Courier New（或其他一些固定宽度的字体），它就会作为代码出现。代码片段也不必完整。只需将它们归结为基本概念（使用注释或省略号表示缺少的代码）。

程序员作为程序员，他们可能会在涉及技术时提出问题，这很好。

此外，如果程序员熟悉类似的东西，请尝试将所有概念与他们所知道的联系起来。它使它更容易掌握。就像您在解释 Spring MVC 并且他们知道 Struts 一样，请解释 Struts 等价物。将这类东西放在表格中（甚至作为讲义）会很有用。

这正是我所做的（Struts 程序员的 Spring MVC 入门）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T00:01:59.480

如果您希望您的观众看到很多代码片段，尤其是冗长的代码片段，您可以将它们打印为讲义，或者以 PDF 或文本文件的形式提供它们（人们可以在他们的笔记本电脑上跟进）。

实际的演示幻灯片应包含传达您的想法所需的最少文本（包括代码）。如果从远处阅读很多内容，您的听众会在一段时间后感到疲倦，并且可能难以跟上。让人们在自己的笔记本电脑或讲义上阅读完整的代码部分，同时只关注演示幻灯片或脚本中的关键部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T23:59:04.637

如果他们不喜欢 Powerpoint，请不要使用它。我们使用 Camtasia 屏幕录制来录制“现场”演示以向客户演示（使用引号直播，因为它没有在演示过程中崩溃的缺点:-)。他们总是更喜欢看到它在行动，而不是他们认为是捏造的功能。

它像您的 Powerpoint 幻灯片一样可以暂停，并且具有语法着色的优势，因为您只需在您最喜欢的编辑器中记录您的想法。它也是动态的，比 Powerpoint 好得多（尽管我见过一些人用多张 Powerpoint 幻灯片制作粗略的动画，在实际中观看总是很有趣）。

这基本上与您的截屏想法相对应，但是，如果您想要一个在那里的理由，请制作大量的小截屏以显示穿插在您的真实演示文稿之间，如有必要，进行叙述（亲自，而不是在截屏上）。

就个人而言，我更愿意向目标受众发送一个完整叙述的 Camtasia，但那是因为我还没有完全摆脱我职业生涯早期的公开演讲恐惧症 :-)。

在紧要关头，你可以做一个真实的现场演示，因为你的观众（视频演示是否等同于视频演示？）是程序员，并且会理解你遇到的任何问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-18T00:00:56.207

我对我做了这件事，并认为这是最好的解决方案：

找另一个人来帮助你。在谈论代码时，让助手键入代码。这样，房间里的每个人都会一边看代码，一边听你解释。

这当然涉及找到可以提供帮助并像您一样理解代码的人。但结果可能很棒。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-18T00:21:25.637

如果您可以在截屏视频中完成所有操作并且您不必在场，那么请进行截屏视频并且不要在场。当会议被取消时，没有人会抱怨。只需分发视频，可能还附上带有注释或链接的报告，这样人们就可以阅读更多关于您演示的工具的信息。

稍后，当您的同事和经理与其他人交谈时，您会得到更多的赞誉：“嘿，您看到比巴克所做的演示了吗？没有？您应该；午饭后我会把地址发给您。”

如果您在演示文稿中演示代码，那么还可以考虑提供已完成的项目，以便人们可以自己尝试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-11T14:58:27.870

当我进行涉及 Visual Studio 的演示时，我将代码片段放在工具箱的常规选项卡上。在演示过程中，我将这些代码片段拖放到代码文件、标记页等中。

# applescript - 访问 iWork Numbers 中的单元格属性

> ID：454335
> 
> 赞同：1
> 
> 时间：2009-01-17T23:58:01.283
> 
> 标签：applescript, iwork

我正在尝试访问 Applescript 中单元格的完整参考。到目前为止，我已经设法使用如下脚本获取单元格引用和表引用：

```
tell application "Numbers"
tell document 1
repeat with i from 1 to count of sheets
tell sheet i
repeat with j from 1 to count of tables
tell table j
try
set currentCell to the first cell of the selection range
return name of currentCell
end try
end tell
end repeat
end tell
end repeat
end tell
end tell 
```

我似乎无法获得相同的结构来获取工作表或文档参考。我尝试访问单元格的属性，我得到类似：

```
{column:column "A" of table "Table 1" of sheet "Sheet 1" of document "Untitled" of
 application "Numbers", alignment:center, value:0.0, background color:{59111, 59111, 
59111}, text color:{0, 0, 0}, font size:10.0, vertical alignment:top, name:"A1",
 class:cell, font name:"HelveticaNeue", format:automatic, row:row "1" of table "Table
 1" of sheet "Sheet 1" of document "Untitled" of application "Numbers", text 
wrap:true} 
```

因此，单元格的 column 属性似乎包含完整的引用，但如果我直接通过 column 属性访问引用。谁能给我一些关于如何使用applescript获取工作表和文档的指导。

干杯

伊恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T10:17:21.550

找到了解决方案，只要代码顺序正确，就相当简单：

```
tell application "Numbers"
tell document 1
    repeat with i from 1 to count of sheets
        tell sheet i
            repeat with j from 1 to count of tables
                try
                    tell table j
                        set currentCell to the first cell of the selection range
                        set therow to row of currentCell
                        set sheetNumber to i
                    end tell
                end try
            end repeat
        end tell
    end repeat
    return name of sheet sheetNumber
end tell
end tell 
```

可以使用类似的代码来检查文件编号

# python - 游标在 Python 的 DB-API 中是如何工作的？

> ID：454337
> 
> 赞同：31
> 
> 时间：2009-01-17T23:58:21.203
> 
> 标签：python, performance, rdbms, cursors, psycopg2

我一直在使用带有 RDBMS（MySQL 和 PostgreSQL）的 python，我注意到我真的不明白如何使用游标。

通常，他的脚本通过客户端 DB-API（如 psycopg2 或 MySQLdb）连接到数据库：

```
connection = psycopg2.connect(host='otherhost', etc) 
```

然后创建一个游标：

```
cursor = connection.cursor() 
```

然后可以发出查询和命令：

```
cursor.execute("SELECT * FROM etc") 
```

现在查询的结果在哪里，我想知道？它在服务器上吗？还是在我的客户端上一点点在我的服务器上一点点？然后，如果我们需要访问一些结果，我们获取它们：

```
rows = cursor.fetchone() 
```

或者

```
rows = cursor.fetchmany() 
```

现在让我们说，我没有检索所有行，并决定执行另一个查询，以前的结果会发生什么？是他们的开销。

另外，我是否应该为每种形式的命令创建一个游标并以某种方式不断地将其重用于相同的命令？我负责 psycopg2 可以以某种方式优化执行多次但具有不同值的命令，它是如何以及值得的？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-09T00:57:50.203

是的，我知道它已经几个月大了：P

DB-API 的游标似乎与 SQL 游标非常相似。就 AFA 资源（行）管理而言，*DB-API 没有指定客户端是必须检索所有行还是声明一个实际的 SQL 游标*。只要 fetchXXX 接口做他们应该做的，DB-API 就很高兴。

关注 AFA psycopg2 游标（您可能很清楚），“未命名的 DB-API 游标”将获取整个结果集——由 libpq 缓冲在内存中的 AFAIK。“命名 DB-API 游标”（可能不可移植的 psycopg2 概念）将按需请求行（fetchXXX 方法）。

正如“未知”所引用的，executemany 可用于优化同一命令的多次运行。但是，它不能满足准备好的语句的需要；当具有不同参数集的语句的重复执行不是直接顺序时，executemany() 将与 execute() 一样执行。DB-API 确实“为”驱动程序作者提供了缓存执行语句的能力，但它的实现（语句的范围/生命周期是多少？）是未定义的，因此不可能跨 DB-API 实现设置期望。

如果您将大量数据加载到 PostgreSQL 中，我强烈建议您尝试找到一种使用 COPY 的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T00:09:48.157

假设您使用的是 PostgreSQL，游标可能只是使用数据库的本机游标 API 实现的。您可能想查看[pg8000](http://pybrary.net/pg8000/)的源代码，这是一个纯 Python PostgreSQL DB-API 模块，以了解它如何处理游标。您可能还想查看[PostgreSQL 文档以了解 cursors](http://www.postgresql.org/docs/current/static/sql-declare.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T08:38:08.363

当您在此处查看[mysqldb 文档](http://mysql-python.sourceforge.net/MySQLdb.html#cursor-objects)时，您可以看到它们为游标实现了不同的策略。所以一般的答案是：这取决于。

编辑：这是[mysqldb API 文档](http://mysql-python.sourceforge.net/MySQLdb-1.2.2/)。有一些关于每种游标类型如何表现的信息。标准游标将结果集存储在客户端中。因此，我假设如果您不检索所有结果行，则会产生开销，因为即使您不获取的行也必须传输到客户端（可能通过网络）。我的猜测是它与 postgresql 没有什么不同。

当您想要优化使用许多值重复调用的 SQL 语句时，您应该查看 cursor.executemany()。它准备了一条 SQL 语句，这样就不需要每次调用它时都对其进行解析：

```
cur.executemany('INSERT INTO mytable (col1, col2) VALUES (%s, %s)',
                [('val1', 1), ('val2', 2)]) 
```

# web-applications - 将 .ashx 设置为 Web 应用程序的起始“页面”

> ID：454343
> 
> 赞同：0
> 
> 时间：2009-01-18T00:05:03.000
> 
> 标签：web-applications, default, ihttphandler

是否可以将 .ashx 文件设置为 Web 应用程序的起始（或默认）页面？如果是这样，它是如何完成的？

**编辑**- 一些好的建议。我在网站上的 IIS 默认文档和“启用的默认文档”中添加了“Default.ashx”，但是，即使我禁用了目录浏览，它也只显示目录列表。

任何其他建议将不胜感激。（IIS 5.1 版）

**编辑**- 重新启动 IIS 并且它可以工作。

**问题**- 请问是否可以在 Visual Studio 2005 中将起始页设置为 .ashx？执行此操作后，我似乎无法从 Visual Studio 中进行调试。

**答案**- 在应用程序属性中，可以在“Web”选项卡下选择“开始操作”。事实上，它还允许选择使用哪个 Server/Port 和 Debugger。很酷。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T01:09:22.857

添加您的 ASHX 页面并确保将其移至列表顶部。

而在 IIS7 中，您可以在 web.config 中指定它：

```
<system.webServer>
    <defaultDocument>
        <files>
            <clear />
            <add value="my_default_page.ASHX" />
        </files>
    </defaultDocument>
</system.webServer> 
```

[此博客文章](http://www.dnknormark.net/post/Configuring-IIS-7-default-document-from-webconfig.aspx)中的更多信息

**编辑：**正如@waves 发现的那样，您可能需要在配置后重新启动 IIS。

* * *

要禁用目录浏览，请取消选中“目录浏览”复选框：

.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T00:39:08.017

只需在 IIS 等默认应用程序服务器上设置它，如果您的目的是为 ashx 创建一个处理程序，您可以执行以下操作：

因此，首先创建 rss.ashx

```
<!--WebHandler Language="C#" Class="KBMentor2.RSSHandler"--> 
```

现在让我们看一下处理程序类：

RSSHandler.cs

```
namespace KBMentor2
{
    using System;
    using System.IO;
    using System.Web;

    public class RSSHandler : IHttpHandler
    {
        public void ProcessRequest (HttpContext context)
        {   
            context.Response.ContentType = "text/xml";
            context.Response.ContentEncoding = System.Text.Encoding.UTF8;

            string sXml = BuildXMLString(); //not showing this function, 
            //but it creates the XML string

            context.Response.Cache.SetExpires(DateTime.Now.AddSeconds(600));
            context.Response.Cache.SetCacheability(HttpCacheability.Public);
            context.Response.Write( sXml );
        }

        public bool IsReusable
        {
            get { return true; }
        }

    }

} 
```

你有它。看起来很像我们创建的第一个代码，不是吗？至于缓存，您可以通过从代码中访问 Cache 对象来解决它，请参阅 context.Response.Cache 调用。

代码来源是：[aspcode.net](http://www.aspcode.net/Creating-an-ASHX-handler-in-ASPNET.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:41:22.040

您可能只需将 'page'.ashx 文件添加到 IIS 服务器设置中的默认文件列表中。您可能能够像部署任何其他 Web 应用程序一样部署它。

# silverlight - 在比屏幕大的画布中居中显示 Silverlight 模式弹出窗口

> ID：454345
> 
> 赞同：4
> 
> 时间：2009-01-18T00:05:28.553
> 
> 标签：silverlight

我目前有一个 Silverlight 画布，它超出了屏幕的可视区域（我让用户拖动可视区域进行导航）。我正在尝试显示一个始终显示在可视区域中间的模式弹出窗口，但我似乎找不到任何可以告诉我屏幕上当前内容的属性。基本上，如果用户向下平移到底部并单击导致模式弹出窗口出现的内容，它就会卡在屏幕的最顶部。

有什么想法吗？

谢谢~史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T18:59:19.350

我认为这是不可能的，因为能见度没有浮出水面。也许用一些有趣的 JavaScript 来找出平移的位置？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-04T19:38:48.840

Gabriel Guimarães 一个效果很好。

App.Current.Host.Content.ActualHeight(and ActualWidth) 确实将浏览器大小带入内部。适合计算位置。当然，您可以在主控件上使用 LayoutUpdated 来仔细检查大小并在需要时调整大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-26T15:38:54.437

很真实。我最终创建了一个固定画布，制作了全屏，并将其他所有内容作为子画布放入其中。模态弹出窗口现在出现在控制画布中。

# rest - REST 身份验证方案的安全性

> ID：454355
> 
> 赞同：233
> 
> 时间：2009-01-18T00:12:10.863
> 
> 标签：rest, authentication, oauth, amazon-s3, rest-security

背景：

我正在为 REST Web 服务设计身份验证方案。这并不“真的”需要安全（它更像是一个个人项目），但我想让它尽可能安全，就像锻炼/学习体验一样。我不想使用 SSL，因为我不想要麻烦，而且主要是设置它的费用。

这些 SO 问题对我开始特别有用：

*   [RESTful 身份验证](https://stackoverflow.com/questions/319530/restful-authentication)
*   [保护 REST API/Web 服务的最佳实践](https://stackoverflow.com/questions/7551/best-practices-for-securing-a-rest-api-web-service)
*   [最佳 SOAP/REST/RPC Web API 的示例？你为什么喜欢他们？他们有什么问题？](https://stackoverflow.com/questions/409338/examples-of-the-best-soap-rest-rpc-web-apis-and-why-do-you-like-them-and-whats)

我正在考虑使用简化版本的[Amazon S3 身份验证](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTAuthentication.html)（我喜欢[OAuth](http://oauth.net/)，但它似乎对我的需求来说太复杂了）。我将服务器提供的随机生成的[nonce](http://en.wikipedia.org/wiki/Cryptographic_nonce)添加到请求中，以防止重放攻击。

要解决这个问题：

S3 和 OAuth 都依赖于对请求 URL 以及一些选定的标头进行签名。他们都没有为 POST 或 PUT 请求**签署请求正文。**这是否容易受到中间人攻击，它保留 url 和 headers 并用攻击者想要的任何数据替换请求正文？

似乎我可以通过在签名的字符串中包含请求正文的哈希来防止这种情况。这安全吗？

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2012-05-11T19:47:08.407

先前的答案仅在数据传输的上下文中提到 SSL，实际上并未涵盖身份验证。

您确实在询问安全地验证 REST API 客户端。除非您使用 TLS 客户端身份验证，否则*单独*的 SSL 不是 REST API 的可行身份验证机制。没有客户端身份验证的 SSL 仅对*服务器*进行身份验证，这与大多数 REST API 无关，因为您确实想要对*客户端*进行身份验证。

如果您不使用 TLS 客户端身份验证，则需要使用基于摘要的身份验证方案（如 Amazon Web Service 的自定义方案）或 OAuth 1.0a 甚至 HTTP 基本身份验证（但仅通过 SSL）。

这些方案验证请求是由预期的人发送的。TLS (SSL)（无客户端身份验证）确保通过网络发送的数据不会被篡改。它们是独立但互补的关注点。

对于那些感兴趣的人，我已经扩展了关于[HTTP 身份验证方案及其工作原理](https://stackoverflow.com/questions/14043397/http-basic-authentication-instead-of-tls-client-certificaiton)的 SO 问题。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2009-01-28T20:57:33.903

REST 意味着使用网络标准，而网络上“安全”传输的标准是 SSL。其他任何东西都会有点时髦，需要为客户端进行额外的部署工作，这些客户端必须有可用的加密库。

一旦您承诺使用 SSL，原则上就不需要任何花哨的身份验证。您可以再次使用 Web 标准并使用 HTTP 基本身份验证（与每个请求一起发送的用户名和秘密令牌），因为它比复杂的签名协议简单得多，并且在安全连接的上下文中仍然有效。您只需要确保密码永远不会超过纯文本；因此，如果曾经通过纯文本连接接收到密码，您甚至可以禁用密码并邮寄给开发人员。您还应该确保凭据在收到时不会记录在任何地方，就像您不会记录常规密码一样。

HTTP Digest 是一种更安全的方法，因为它可以防止传递秘密令牌；相反，它是服务器可以在另一端验证的哈希值。尽管如果您采取了上述预防措施，对于不太敏感的应用程序可能会有点过分。毕竟，用户登录时的密码已经以纯文本形式传输（除非您在浏览器中进行了一些花哨的 JavaScript 加密），同样，他们在每个请求上的 cookie 也是如此。

请注意，对于 API，客户端最好传递令牌（随机生成的字符串）而不是开发人员登录网站时使用的密码。因此，开发人员应该能够登录您的站点并生成可用于 API 验证的新令牌。

使用令牌的主要原因是如果它被泄露，它可以被替换，而如果密码被泄露，所有者可以登录开发者的帐户并使用它做任何他们想做的事情。代币的另一个优势是您可以向同一个开发人员发行多个代币。也许是因为他们有多个应用程序，或者因为他们想要具有不同访问级别的令牌。

（已更新以涵盖仅建立 SSL 连接的含义。）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-28T13:52:06.710

或者您可以使用已知的解决方案来解决这个问题并使用 SSL。自签名证书是免费的，它是个人项目吗？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-28T06:37:07.480

如果您需要将正文的哈希作为 URL 中的参数之一，并且该 URL 是通过私钥签名的，那么中间人攻击只能将正文替换为会生成相同的哈希。至少现在很容易使用 MD5 哈希值，当 SHA-1 被破坏时，你就明白了。

为了保护正文不被篡改，您需要对正文进行签名，中间人攻击不太可能破坏该签名，因为他们不知道生成签名的私钥.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-10T06:52:52.567

事实上，原始的 S3 身份验证*确实*允许对内容进行签名，尽管 MD5 签名较弱。您可以简单地强制他们在 HMAC（要签名的字符串）中包含 Content-MD5 标头的可选做法。

[http://s3.amazonaws.com/doc/s3-developer-guide/RESTAuthentication.html](http://s3.amazonaws.com/doc/s3-developer-guide/RESTAuthentication.html)

他们新的 v4 身份验证方案更加安全。

[http://docs.aws.amazon.com/general/latest/gr/signature-version-4.html](http://docs.aws.amazon.com/general/latest/gr/signature-version-4.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-18T21:36:47.927

请记住，您的建议会使客户端难以与服务器通信。他们需要了解您的创新解决方案并相应地加密数据，这种模型对于公共 API 来说并不是那么好（除非您是 amazon\yahoo\google..）。

无论如何，如果您必须加密正文内容，我建议您查看现有的标准和解决方案，例如：

XML 加密（W3C 标准）

[XML 安全性](http://santuario.apache.org/)

# jquery - 如何让 jQuery 效果在 Firefox 和 Google Chrome 上运行？

> ID：454358
> 
> 赞同：1
> 
> 时间：2009-01-18T00:14:31.500
> 
> 标签：jquery, internet-explorer, firefox, google-chrome, effects

我正在研究 jQuery 和淡入淡出效果。我有以下代码要显示和隐藏带有消息的 div。

`

```
<script type="text/javascript">
    $(document).ready(function() {

        $("button").click(function() {
            $("#upd").fadeIn(3000);
            $("#upd").fadeOut(20000);
        });

    });
</script>

<style type="text/css">
    div
    {
        background: rgb(237, 243, 254);
        margin: 0px 0px 5px 0px;
        padding: 13px 30px 13px 30px;
        width: 300px;
    }
</style> 
```

`

它在 Internet Explorer 上完美运行，但它在 chrome 中没有做任何事情，我在 Firefox 中得到显示和隐藏行为。

这个库是否有一个特殊的步骤可以在所有浏览器中均匀或至少接近？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-18T00:19:41.210

[从fadeIn](http://docs.jquery.com/Effects/fadeIn#speedcallback)的回调中尝试[fadeOut](http://docs.jquery.com/Effects/fadeOut#speedcallback)。这将确保后一个效果在第一个效果完成后运行，而不是在：

```
$(document).ready(function(){
  $("button").click(function(){
    $("#upd").fadeIn(3000,function(){
      $(this).fadeOut(2500);
    });
  });
}); 
```

jQuery本身在所有浏览器中的工作方式*应该几乎相同。*如果你有奇怪的行为，你可能做错了什么——不是 jQuery :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T00:24:45.003

一，确保您使用的是最新的 jQuery，并且在您的所有浏览器中都启用了 Javascript。

其次，尝试将`fadeIn`and`fadeOut`调用链接在一起：

```
$("button").click(function() {
    $("#upd")
        .fadeIn(3000)
        .fadeOut(20000);
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-15T17:54:51.660

这是问题： $("button")

没有像按钮这样的元素，如果它是一个类，那么：$('.button')

...如果它是一个 id 然后： $('#button')

# linux - Linux中的击键动力学

> ID：454362
> 
> 赞同：3
> 
> 时间：2009-01-18T00:17:50.307
> 
> 标签：linux, authentication, biometrics

我正在考虑为 Linux 实现击键动态（根据他们的打字模式对人进行身份验证）应用程序。在我看来，我有两种选择：

1.  扩展 Linux 登录以支持击键动态
2.  创建一个桌面锁程序，它“锁定”屏幕并且只能由具有特定打字模式的打字员解锁

备选方案 1 可能吗？Windows 支持通过 msgina.dll 扩展登录过程，Linux 是否支持类似的东西？

对于altenative 2，是否可以禁用鼠标和键盘？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T00:27:54.390

libpam 具有插件功能。所以是的，完全有可能，就像（in）着名的 msgina :)

锁定屏幕是嗯，相当敏感 - 谁负责？窗口管理器，X 服务器，会话管理器，屏幕保护程序，？

恐怕不同的桌面环境（Gnome、KDE...）可能会有不同的意见。虽然这些天来，我很肯定他们都会共享某种 FreeDesktop dbus 接口来协调这种类型的功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T04:51:14.197

假设这不仅仅是一个玩具（换句话说，如果您打算分发），请务必考虑在出现问题时如何绕过打字模式分析。随着时间的推移，我的打字模式可能会发生相当大的变化，因为我的手腕问题时不时出现。当他们这样做时，我的打字可能会发生显着变化。即使我的打字从早到晚都有些变化，我也不会感到太惊讶，因为我或多或少地感到疲倦和/或含咖啡因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:21:01.267

嘿，Linux 是开源的，你可以做任何你想做的事情 :-)

您很可能不需要修改内核。例如，终端登录是由`login`程序控制的。更改源并重建它肯定会让你做你需要做的，尽管我不知道这有多困难:-)

图形登录由窗口管理器负责，因此要更改哪个程序取决于您使用的窗口管理器。

编辑：再想一想，我不确定是否`login`足够早地执行以捕捉击键动态。此外，这有点冒险，因为如果您的登录版本失败，可能会使登录和修复问题变得困难。您可能需要`getty`查看一下它是如何调用`login`. 如果您在图形界面中执行此操作，则可能会更容易，因为您始终可以回退到文本终端来解决任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T04:19:49.820

执行此操作的正确方法可能是通过 PAM 身份验证模块。在此处查看模块编写者指南：http: [//www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/Linux-PAM_MWG.html](http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/Linux-PAM_MWG.html)

基本上，您可以将您的模块添加到 PAM 堆栈，让它进行击键分析，然后将成功或失败传递给系统。这使您可以将其与控制台登录过程集成，如果在那里启用了 PAM，甚至可以与 SSH 集成。我不太确定它如何与 KDM 或 GDM 等图形登录一起工作。我知道您可以将 PAM 模块与这些模块一起使用，但当然交互是通过 GUI 文本框完成的。

# c# - dcomcnfg 功能以编程方式

> ID：454368
> 
> 赞同：7
> 
> 时间：2009-01-18T00:21:50.533
> 
> 标签：c#, .net, security, permissions, dcom

我可以找到各种关于如何为 DCOM 编程的东西，但几乎没有关于如何以编程方式设置/检查安全性的内容。

我不是要重新创建 dcomcnfg，但如果我知道如何在 C#（首选或 VB.net）中重现 dcomcnfg 的所有功能，那么我的目标就在眼前。

我似乎无法在这方面找到任何好的资源，没有开源 API，甚至没有关于如何执行每个步骤的快速示例。即使在这里 DCOM 或 dcomcnfg 返回的结果很少，也没有真正关于如何设置/验证/列出安全性。

如果有人有一些指向开放 API 或一些示例的指针，我将不胜感激。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2013-03-26T13:26:27.903

丹尼尔发布的答案非常有帮助。非常感谢，丹尼尔！

[Microsoft 文档](http://msdn.microsoft.com/en-us/library/windows/desktop/ms678417%28v=vs.85%29.aspx)的一个问题是它们表明注册表值包含二进制形式的 ACL。因此，例如，如果您尝试设置机器的默认访问权限（而不是每个进程），您将访问注册表项 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Ole\DefaultAccessPermission。但是，在我最初尝试使用 System.Security.AccessControl.RawACL 类访问此密钥时失败了。

正如 Daniel 的代码所示，该值实际上不是 ACL，而实际上是一个带有 ACL 的 SecurityDescriptor。

因此，即使我知道这篇文章已经过时，我仍将发布我的解决方案，用于检查和设置安全设置并为默认本地访问添加 NetworkService。当然，我敢肯定，你可以把它做得更好，但要开始，你只需要更改密钥和访问掩码。

```
static class ComACLRights{
    public const int COM_RIGHTS_EXECUTE= 1;
    public const int COM_RIGHTS_EXECUTE_LOCAL = 2;
    public const int COM_RIGHTS_EXECUTE_REMOTE = 4;
    public const int COM_RIGHTS_ACTIVATE_LOCAL = 8;
    public const int COM_RIGHTS_ACTIVATE_REMOTE = 16;
}
class Program
{
    static void Main(string[] args)
    {
        var value = Registry.GetValue("HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Ole", "DefaultAccessPermission", null);

        RawSecurityDescriptor sd;
        RawAcl acl;

        if (value == null)
        {
            System.Console.WriteLine("Default Access Permission key has not been created yet");
            sd = new RawSecurityDescriptor("");
        }else{
            sd = new RawSecurityDescriptor(value as byte[], 0);
        }
        acl = sd.DiscretionaryAcl;
        bool found = false;
        foreach (CommonAce ca in acl)
        {
            if (ca.SecurityIdentifier.IsWellKnown(WellKnownSidType.NetworkServiceSid))
            {
                //ensure local access is set
                ca.AccessMask |= ComACLRights.COM_RIGHTS_EXECUTE | ComACLRights.COM_RIGHTS_EXECUTE_LOCAL | ComACLRights.COM_RIGHTS_ACTIVATE_LOCAL;    //set local access.  Always set execute
                found = true;
                break;
            }
        }
        if(!found){
            //Network Service was not found.  Add it to the ACL
            SecurityIdentifier si = new SecurityIdentifier( 
                WellKnownSidType.NetworkServiceSid, null);
            CommonAce ca = new CommonAce(
                AceFlags.None, 
                AceQualifier.AccessAllowed, 
                ComACLRights.COM_RIGHTS_EXECUTE | ComACLRights.COM_RIGHTS_EXECUTE_LOCAL | ComACLRights.COM_RIGHTS_ACTIVATE_LOCAL, 
                si, 
                false, 
                null);
            acl.InsertAce(acl.Count, ca);
        }
        //re-set the ACL
        sd.DiscretionaryAcl = acl;

        byte[] binaryform = new byte[sd.BinaryLength];
        sd.GetBinaryForm(binaryform, 0);
        Registry.SetValue("HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Ole", "DefaultAccessPermission", binaryform, RegistryValueKind.Binary);
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-07-25T11:38:41.303

面对类似的情况（从 MSI 配置 DCOM 安全性），我设法通过更改 HKEY_CLASSES_ROOT\AppID{APP-GUID-GOES-HERE} 中的注册表项值创建了一个解决方案，可以满足我的要求。感谢 Arnout 的回答让我走上了正确的道路。

具体来说，我创建了一个方法来编辑 DCOM 对象的安全权限，这些对象存储在 LaunchPermission 和 AccessPermission 注册表项值中。这些是序列化的安全描述符，您可以通过传递二进制数据来访问它们`RawSecurityDescriptor`。这个类以一种美妙的 .NET-y 方式简化了许多细节，但是您仍然需要关注有关 Windows ACL 的所有逻辑细节，并且您必须确保使用 `RawSecurityDescriptor.GetBinaryForm`.

我创建的方法被称为`EditOrCreateACE`. 此方法将编辑帐户的现有 ACE，或插入新的 ACE，并确保访问掩码设置了传递的标志。我在这里附上它作为一个**例子**，这绝不是关于如何处理它的任何权威，因为我对 Windows ACL 的东西仍然知之甚少：

```
// These are constants for the access mask on LaunchPermission.
// I'm unsure of the exact constants for AccessPermission
private const int COM_RIGHTS_EXECUTE = 1;
private const int COM_RIGHTS_EXECUTE_LOCAL = 2;
private const int COM_RIGHTS_EXECUTE_REMOTE = 4;
private const int COM_RIGHTS_ACTIVATE_LOCAL = 8;
private const int COM_RIGHTS_ACTIVATE_REMOTE = 16;

void EditOrCreateACE(string keyname, string valuename,
                      string accountname, int mask)
{
    // Get security descriptor from registry
    byte[] keyval = (byte[]) Registry.GetValue(keyname, valuename,
                                               new byte[] { });
    RawSecurityDescriptor sd;
    if (keyval.Length > 0) {
        sd = new RawSecurityDescriptor(keyval, 0);
    } else {
        sd = InitializeEmptySecurityDescriptor();
    }
    RawAcl acl = sd.DiscretionaryAcl;

    CommonAce accountACE = null;

    // Look for the account in the ACL
    int i = 0;
    foreach (GenericAce ace in acl) {
        if (ace.AceType == AceType.AccessAllowed) {
            CommonAce c_ace = ace as CommonAce;
            NTAccount account = 
                c_ace.SecurityIdentifier.Translate(typeof(NTAccount))
                as NTAccount;
            if (account.Value.Contains(accountname)) {
                accountACE = c_ace;
            }
            i++;
        }
    }

    // If no ACE found for the given account, insert a new one at the end
    // of the ACL, otherwise just set the mask
    if (accountACE == null) {
        SecurityIdentifier ns_account = 
            (new NTAccount(accountname)).Translate(typeof(SecurityIdentifier))
            as SecurityIdentifier;
        CommonAce ns = new CommonAce(AceFlags.None, AceQualifier.AccessAllowed,
                                     mask, ns_account, false, null);
        acl.InsertAce(acl.Count, ns);
    } else {
        accountACE.AccessMask |= mask;
    }

    // Write security descriptor back to registry
    byte[] binarySd = new byte[sd.BinaryLength];
    sd.GetBinaryForm(binarySd, 0);
    Registry.SetValue(keyname, valuename, binarySd);
}

private static RawSecurityDescriptor InitializeEmptySecurityDescriptor()
{
    var localSystem = 
        new SecurityIdentifier(WellKnownSidType.LocalSystemSid, null);
    var new_sd =
        new RawSecurityDescriptor(ControlFlags.DiscretionaryAclPresent,
                                  localSystem, localSystem, null,
                                  new RawAcl(GenericAcl.AclRevision, 1));
    return new_sd;
} 
```

请注意，此代码绝不是完美的。如果注册表中缺少这些 ACL 的整个注册表项值，则合成的 ACL 将仅授予对传递的帐户的访问权限，而不会授予其他权限。我也确信有很多错误情况我没有正确处理，并且我已经掩盖了细节。同样，这是一个如何在 .NET 中处理 DCOM ACL的**示例。**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-18T21:16:03.100

我找不到任何 .NET 方式来执行此操作 - 您可以使用作为 SDK 一部分的MS 命令行实用程序[DCOMPerm](http://msdn.microsoft.com/en-us/library/aa242178.aspx)（也在[此处）。](https://www.microsoft.com/en-us/download/details.aspx?id=8279)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-18T21:42:25.327

此信息存储在`HKCR\AppID\{Your-AppID}\LaunchPermission`和中`AccessPermission`。这些是包含序列化安全描述符的 REG_BINARY 值。不知道是否有任何东西可以方便地访问 .NET 中的那些...

[有关MSDN](http://msdn.microsoft.com/en-us/library/ms682359(VS.85).aspx)的更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-03T08:22:39.150

我发现这个解决方案有效：

```
 public static void SetUp()
    {
        SetCOMSercurityAccess("DefaultAccessPermission");
        SetCOMSercurityAccess("DefaultLaunchPermission");
    }
    private static void SetCOMSercurityAccess(string regKey)
    {
        //This is the magic permission!
        byte[] binaryform = new string[]
        {
            "01","00","04","80","80","00","00","00","90","00","00","00","00","00","00","00","14","00","00","00","02","00","6c","00","04",
            "00","00","00","00","00","14","00","1f","00","00","00","01","01","00","00","00","00","00","05","12","00","00","00","00","00",
            "24","00","0b","00","00","00","01","05","00","00","00","00","00","05","15","00","00","00","a3","53","d8","c8","94","bd","63",
            "84","88","bf","fa","cf","a7","2b","00","00","00","00","18","00","1f","00","00","00","01","02","00","00","00","00","00","05",
            "20","00","00","00","20","02","00","00","00","00","14","00","1f","00","00","00","01","01","00","00","00","00","00","05","04",
            "00","00","00","01","02","00","00","00","00","00","05","20","00","00","00","20","02","00","00","01","02","00","00","00","00",
            "00","05","20","00","00","00","20","02","00","00"
        }.Select(o=> Convert.ToByte(o,16)).ToArray();
        Registry.SetValue("HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Ole", regKey, binaryform, RegistryValueKind.Binary);
    } 
```

万一它帮助别人...

# multithreading - 为多个交互计时器设计

> ID：454373
> 
> 赞同：0
> 
> 时间：2009-01-18T00:25:23.570
> 
> 标签：multithreading, timer

我正在设计一个在组件层次结构的所有级别都需要计时器的系统。多个计时器可能同时处于活动状态，但它们需要相互交互（停止组件的计时器会停止其后代的计时器，而启动组件的计时器会启动其祖先的计时器并停止其兄弟的计时器）。

每个计时器都有不同的限制，并将向侦听器发送滴答、开始、停止和过期事件。

这仍处于设计阶段的早期（实现语言仍未确定），但我想避免线程混乱。有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T00:42:25.500

很难根据您发布的内容提供建议。也许完全避免使用线程，并且只有一个计时器和事件数据库表。当计时器响起时，您选择所有比现在更早的事件并触发它们。然后选择现在减去事件表的最小时间戳并在该时间间隔内休眠。环形。

```
while (1) {
    SELECT * FROM EVENTS WHERE ev_time < now() order by ev_time;
    while (num_rows_selected > 0) {
        for (i = 0; i < num_rows_select; ++i) {
             fetch row
             process row
        }
        SELECT * FROM EVENTS WHERE ev_time < now() order by ev_time;
    }
    SELECT MIN(ev_time)-NOW() as Interval FROM EVENTS
    sleep(Interval);
} 
```

# jquery - jQuery UI 主题问题

> ID：454378
> 
> 赞同：0
> 
> 时间：2009-01-18T00:27:36.043
> 
> 标签：jquery

这不应该那么难，但我似乎无法让它发挥作用。只是试图使用一个对话框，但不能让它格式化主题。

```
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Demo</title> 
    <link rel="stylesheet" href="flora.all.css" type="text/css" media="screen" title="Flora (Default)" />
    <script type="text/javascript" src="js/jquery-1.3.min.js"></script>
    <script type="text/javascript" src="js/ui/jquery.ui.all.js"></script>

    <script type="text/javascript">
    <!--
    $(function () {
        $('#test').dialog();
    });
    //-->
    </script>
</head>
<body>
<div id="test"> This is a dialog. </div>
</body>
</html> 
```

我错过了什么？css 处于基础级别，我可以在 firebug 中看到它们，但对话框中的任何内容都没有像我在演示中看到的那样被格式化。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T00:36:07.337

在示例中，div 具有类“flora”——您是否尝试过将该类应用于您的 div 以查看是否有帮助？此外，您需要在准备好的文档上运行您的函数——现在，我认为它根本没有运行。

```
 $(document).ready( function() {
    $('#test').dialog();
 }); 
```

# architecture - 您在设计要编写的软件时遵循的工作流程是什么？

> ID：454382
> 
> 赞同：9
> 
> 时间：2009-01-18T00:29:09.973
> 
> 标签：architecture, projects-and-solutions

我已经开始研究一个相当复杂的软件。这是一个个人项目，但我仍然付出了很多努力。现在，我习惯于从事其他人的解决方案/设计或以非常可控的方式发展的项目。

这一次，我开始两次编写基础代码，但很快发现自己陷入了困境。所以我休息了一下，决定在编写一行代码之前写下完整的解决方案。我所做的（按顺序）是：

1.  以 CLI 命令的形式编写用例（这是一个命令行应用程序）
2.  写一些帮助
3.  设计类、数据文件的结构和各个部分的功能工作流程。

现在，我在这整个部分真的很慢。我已经建立了一个个人 wiki 并使用它来编写这些规范，但我清楚地感觉到我缺乏经验和清晰的方法论。

我知道软件设计是一个非常复杂的主题，并且已经写了很多关于它的书籍，但我希望您分享您的经验/建议/方法。

在从事个人中型项目时，在开始编码之前您会指定什么？如何？

提前致谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-18T00:40:30.887

有很多比我有更好经验的人可以在这里帮助您详细说明，但我有一点我认为始终值得牢记。

您不需要第一次就做到 100% 完美。事实上，如果你以此为目标，你可能永远都不会完成。现实情况是，在您构建系统一次之前，您不会完全理解设计。

刚开始，继续推进，掌握单元测试覆盖率，当你更好地理解系统及其复杂性，然后**逐步重构以改进它**。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-18T00:45:17.053

> 在从事个人中型项目时，在开始编码之前您会指定什么？

我指定了**功能**规范：

*   我担心如果我刚开始编码（这是“如何”），可能太容易忘记我想要编码的“为什么”和“什么”（对于“相当复杂”的软件，经过几个月或几年可能需要开发）。
*   我也想或多或少地了解我将要开发的“范围”：为了大致评估（到一个数量级）：
    *   会有多大
    *   能不能完成
    *   是否值得入手
    *   可以先开发它的哪个子集

为了**风险管理**，我要补充一点，我想要开发的一些东西意味着使用一些我不熟悉的软件；为了尽量减少与此相关的风险，我还做了一些一次性原型设计。

> 如何？

我用笔和纸概述了一个**功能规范**。我写的一些是高层次的（业务级别的“愿景”文档），还有一些是低层次的，更像是设计（一些 UI 细节）。有时我停下来想知道如何组织它，但接着又继续说，推理**每个页面**或多或少地与每个主题相关，我可以稍后再思考如何组织页面（很像你的维基，也许）。

我事先做了也没有指定**软件架构：**

*   我从一个基本架构（一些小组件）开始开发，然后添加代码；而且，当我添加代码时，如果任何组件变得太大和太复杂，那么我将它细分为几个更小的组件......这是一个进化过程......正如 Systemantics 中所说*，*一个**可以工作的复杂系统总是会进化来自一个有效的简单系统。**
*   我没有记录架构；或者更确切地说，体系结构的唯一文档是代码本身：例如，源代码被安排到源目录、命名空间和 DLL 中的方式。

我确实对现在的架构有理论依据，但我没有记录这些原因：

*   我是唯一的开发者
*   实际架构由代码记录
*   架构的原因在我的脑海中，并且可以通过诸如源代码中的命名约定以及各种组件的依赖关系之类的东西[重新]发现

如果（仅当）我不是唯一的开发人员，那么我可能认为值得记录架构及其基本原理。

我上面所说的关于软件架构的内容也适用于软件处理的**数据。**

至于**测试**，我写了一点代码，然后测试；或编写一个测试，然后编写将通过该测试的功能。我不是在做“大爆炸集成”，即几个月的写作没有任何测试。

我的流程中最大的弱点之一（或缺少的东西）是提前**估算工作量**，然后根据估算跟踪实施......这是这个“个人”项目流程与我的付费项目之间的区别之一d 在商业上为别人做。不过，我怀疑这是否好：如果估算是商业上的最佳实践，那么也许我“应该”在个人项目中也这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-18T01:00:37.537

基本上，屏幕。它们是用户和软件之间的接口。所以我尝试识别每个用例（用户将搜索我的产品 - 用户将产品添加到其球童 - 用户将检查其球童）并为每个用例创建一个屏幕链。

最良好的祝愿。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-18T01:08:08.600

我发现一张白纸和一支笔是最好的起点：

*   画一些粗略的图表
*   记下一些想法/笔记
*   写一些伪代码
*   考虑主要用例
*   考虑潜在的问题

不要在这上面花费超过半小时，也不要陷入过多的文档或前期设计中。一旦您对自己的工作方式有一个模糊的想法，就立即开始编码。随着您继续开发，您会感觉到代码是否足够好。如果你不开心，想想你不喜欢什么，然后记住这些教训重新开始。经常和尽快地重构，越早越好。如果某件事“感觉不对”，那可能不是。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T01:17:21.213

1.  像你一样编写用例。
2.  选择 1 个用例并完全实现它，其他什么都不实现。这包括单元测试、帮助和错误处理——一切。将此版本称为 1。
3.  实施下一个用例。这可能只是添加代码，或者可能需要完全重新设计。没关系，你知道你现在在做什么。制作一个新版本。
4.  重复步骤 3。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-18T04:30:29.487

1.  绘制屏幕
2.  绘制数据关系（rdbms 或内存中）
3.  开始编码
4.  起泡、冲洗、重复（或用程序员术语 GOTO 1）

我将从最小的实现开始，并在每次迭代中添加更多功能。

# visual-studio-2008 - 验证（）：属性“工厂”不是元素“服务主机”的有效属性

> ID：454388
> 
> 赞同：2
> 
> 时间：2009-01-18T00:34:22.910
> 
> 标签：visual-studio-2008, wcf, service, factory

我越来越

```
Validation (): Attribute 'Factory' is not a valid attribute of element 'ServiceHost'. 
```

在我将 Factory="System.ServiceModel.Activation.WebServiceHostFactory" 添加到 .svc 文件中的 @Service 指令后，从 VS2008 在一个空的 WCF 服务应用程序中开始。我在代码隐藏中添加了 System.ServiceModel.Web 引用。

根据我在 MSDN 上阅读的内容，我完全不知所措。有没有人遇到过这个？

**更新：**

Factory 甚至不会在 .svc 文件的标记中显示为智能感知中的可用属性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T20:12:29.983

我安装了 .NET 3.5，但没有为 Studio 2008 安装 SP1。呃。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T02:57:03.450

确保在后面的代码中有对 System.ServiceModel 的引用。除非您有明确的工厂对象，否则您不需要对它的引用。我在 IIS 托管服务中有一个主机，如下所示：

```
<%@ ServiceHost Service="Donaghe.ManualWCF.CalculatorService" %> 
```

这就是你真正需要的。确保进入服务属性的是服务类的全名。

让我知道这是否有帮助。

# ruby-on-rails - 如何使用 paypal / ruby on rails / 活跃商家创建安全的信用卡网关

> ID：454391
> 
> 赞同：6
> 
> 时间：2009-01-18T00:36:35.557
> 
> 标签：ruby-on-rails, security, https, paypal

我现在正在使用 Active Merchant 和 PayPal 沙盒创建商店。它似乎工作正常，但我认为它甚至不是远程安全的。我真的不太了解 HTTPS 以及如何实现安全连接。

我目前正在会话中传递信用卡和账单信息（可能不是最聪明的想法）。我当前的代码发布在下面。为了使它成为一个安全、可用的商店，我真的需要关于采取什么方向和步骤的帮助。

```
 def payment
session[:billing_address] = params[:billing_address] 
 end

 def summary
    @credit_card = params[:credit_card]
    session[:credit_card] = params[:credit_card]
    @billing_address = session[:billing_address]
    @cart = get_cart
    @purchases  = @cart.purchases
    @total = @cart.total
 end

 def finish
     @cart = get_cart
     @total = @cart.total

     credit_card = ActiveMerchant::Billing::CreditCard.new( session[:credit_card] )

     billing_address = session[:billing_address]

     flash[:notice] = credit_card.errors and return unless credit_card.valid?

     gateway = ActiveMerchant::Billing::PaypalGateway.new(:login=>$PAYPAL_LOGIN, :password=>$PAYPAL_PASSWORD)

     res = gateway.authorize(@total, credit_card, :ip=>request.remote_ip, :billing_address=>billing_address)

     if res.success?
        gateway.capture(@total, res.authorization)
        flash[:notice] = "Authorized" 
     else
        flash[:notice] = "Failure: " + res.message.to_s
     end    
  end 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-18T00:43:06.620

关于如何实现 ssl 有一个很好的 railscast。

[http://railscasts.com/episodes/143-paypal-security](http://railscasts.com/episodes/143-paypal-security)

# asp.net - ASP.NET MVC 网站论坛

> ID：454396
> 
> 赞同：2
> 
> 时间：2009-01-18T00:40:25.240
> 
> 标签：asp.net, asp.net-mvc

我正在为一个组织建立一个新网站。我正在使用 ASP.NET MVC。以前的站点是基于 PHP 的，并且有一个 PHPBB 论坛。这个论坛在 IFrame 中打开，所以没有集成。

我们想要一个集成了所有功能的网站。我想，我可能必须自己写一个论坛。但是，还有其他 ASP.NET 开源论坛，例如 phpbb。

有没有办法将第三方论坛干净地集成到我的网站中？还是我自己编码更好？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T00:44:38.413

检查我对这个问题的回答，对于基于 ASP .NET MVC 的论坛：

*   [谁知道一个好的免费 C# 开源论坛？](https://stackoverflow.com/questions/255591)

如果您想要一个 ASP .NET Webforms 论坛，我可以向您推荐[YetAnotherForum.NET](http://www.yetanotherforum.net/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-22T15:14:47.690

以下帖子有很多选项：[ASP.NET MVC 论坛软件？](https://stackoverflow.com/questions/739388/asp-net-mvc-forum-software)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:48:25.270

ASP.NET MVC 仍处于测试阶段，在 .NET 方面没有太多可用的免费选项。

如果您已经有编写 MVC 应用程序的经验，这实际上是一项非常容易的任务。

不包括那些没有发布稳定版本的，大多数免费选项（例如 YAF）被编写为在经典 ASP.NET Webforms 框架上作为独立应用程序运行，并且通常需要您使用某个固定的数据库平台，因此需要努力修补它们，以便它们与 MVC 框架很好地集成。

所以我建议你自己编码。特别是如果您只想要一个不需要像 phpbb 那么多功能的集成论坛。

或者更好的是，开始一个开源项目！

# c# - How can I find a string after a specific string/character using regex

> ID：454414
> 
> 赞同：3
> 
> 时间：2009-01-18T00:56:16.767
> 
> 标签：c#, regex

I am hopeless with regex (c#) so I would appreciate some help:

Basicaly I need to parse a text and I need to find the following information inside the text:

Sample text:

**KeywordB:***TextToFind* the rest is not relevant but **KeywordB:** *Text ToFindB* and then some more text.

I need to find the word(s) after a certain keyword which may end with a “:”.

**[UPDATE]**

Thanks Andrew and Alan: Sorry for reopening the question but there is quite an important thing missing in that regex. As I wrote in my last comment, Is it possible to have a variable (how many words to look for, depending on the keyword) as part of the regex?

Or: I could have a different regex for each keyword (will only be a hand full). But still don't know how to have the "words to look for" constant inside the regex

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T01:32:22.903

The basic regex is this:

```
var pattern = @"KeywordB:\s*(\w*)";
    \s* = any number of spaces
    \w* = 0 or more word characters (non-space, basically)
    ()  = make a group, so you can extract the part that matched

var pattern = @"KeywordB:\s*(\w*)";
var test = @"KeywordB: TextToFind";
var match = Regex.Match(test, pattern);
if (match.Success) {
    Console.Write("Value found = {0}", match.Groups[1]);
} 
```

If you have more than one of these on a line, you can use this:

```
var test = @"KeywordB: TextToFind KeyWordF: MoreText";
var matches = Regex.Matches(test, @"(?:\s*(?<key>\w*):\s?(?<value>\w*))");
foreach (Match f in matches ) {
    Console.WriteLine("Keyword '{0}' = '{1}'", f.Groups["key"], f.Groups["value"]);
} 
```

Also, check out the regex designer here: [http://www.radsoftware.com.au/](http://www.radsoftware.com.au/regexdesigner/). It is free, and I use it constantly. It works great to prototype expressions. You need to rearrange the UI for basic work, but after that it's easy.

*(fyi) The "@" before strings means that \ no longer means something special, so you can type @"c:\fun.txt" instead of "c:\fun.txt"*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-20T23:15:12.390

Let me know if I should delete the old post, but perhaps someone wants to read it.

The way to do a "words to look for" inside the regex is like this:

```
regex = @"(Key1|Key2|Key3|LastName|FirstName|Etc):" 
```

What you are doing probably isn't worth the effort in a regex, though it can *probably* be done the way you want (still not 100% clear on requirements, though). It involves looking ahead to the next match, and stopping at that point.

Here is a re-write as a regex + regular functional code that should do the trick. It doesn't care about spaces, so if you ask for "Key2" like below, it will separate it from the value.

```
string[] keys = {"Key1", "Key2", "Key3"};
string source = "Key1:Value1Key2: ValueAnd A: To Test Key3:   Something";
FindKeys(keys, source);

private void FindKeys(IEnumerable<string> keywords, string source) {
    var found = new Dictionary<string, string>(10);
    var keys = string.Join("|", keywords.ToArray());
    var matches = Regex.Matches(source, @"(?<key>" + keys + "):",
                          RegexOptions.IgnoreCase);            

    foreach (Match m in matches) {
        var key = m.Groups["key"].ToString();
        var start = m.Index + m.Length;
        var nx = m.NextMatch();
        var end = (nx.Success ? nx.Index : source.Length);
        found.Add(key, source.Substring(start, end - start));
    }

    foreach (var n in found) {
        Console.WriteLine("Key={0}, Value={1}", n.Key, n.Value);
    }                            
} 
```

And the output from this is:

```
Key=Key1, Value=Value1
Key=Key2, Value= ValueAnd A: To Test 
Key=Key3, Value=   Something 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T01:03:31.167

```
/KeywordB\: (\w)/ 
```

This matches any word that comes after your keyword. As you didn´t mentioned any terminator, I assumed that you wanted only the word next to the keyword.

# string - Bash中的字符串差异

> ID：454427
> 
> 赞同：129
> 
> 时间：2009-01-18T01:07:35.263
> 
> 标签：string, bash

我正在尝试找到一种方法来确定脚本中两个字符串之间的差异。我可以使用 diff 或 comm 轻松做到这一点，但我不处理文件，我不想将它们输出到文件，进行比较并读回它。

我看到 comm、diff、cmp 都允许传递两个文件或一个文件和标准输入 - 我想如果我不想输出两个文件那很好......但它仍然有点糟糕。

一直在思考我可以使用 grep 或正则表达式 - 但我想不是。

* * *

## 回答 #1

> 赞同：228
> 
> 时间：2009-01-18T02:50:56.770

使用`diff`or`com`或任何你想要的：

```
diff  <(echo "$string1" ) <(echo "$string2") 
```

Greg 的 Bash 常见问题解答：[流程替换](http://mywiki.wooledge.org/ProcessSubstitution)

或使用命名管道

```
mkfifo ./p
diff - p <<< "$string1" & echo "$string2" > p 
```

Greg 的 Bash 常见问题解答：[使用命名管道](http://mywiki.wooledge.org/BashFAQ/085)

命名管道也称为 FIFO。

其`-`本身用于标准输入。

`<<<`是一个“这里的字符串”。

`&`就像`;`但把它放在后台

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-18T01:54:23.840

让我想起了这个问题：[如何区分 Bash 中的两个管道？](https://stackoverflow.com/questions/345505)

如果您在 bash 会话中，您可以执行以下操作：

```
diff <cmd1 <cmd2
diff <(foo | bar) <(baz | quux) 
```

通过`<`创建匿名命名管道——由 bash 管理——因此它们是自动创建和销毁的，与临时文件不同。

因此，如果您设法将两个不同的字符串隔离为命令（grep、awk、sed...）的一部分，您可以执行 - 例如 - 类似的操作：

```
diff < grep string1 myFile < grep string2 myFile 
```

（如果您认为您的文件行中`string1=very_complicated_value`有 : 和`string2=another_long_and_complicated_value'`: 在不知道文件的内部格式的情况下，我不能推荐一个精确的命令）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-18T03:11:20.487

我更喜欢`cmp`bash 的 Process Substitution 功能：

```
$ cmp -bl <(echo -n abcda) <(echo -n aqcde)
  2 142 b    161 q
  5 141 a    145 e 
```

说到位置 2，ab 出现在第一个位置，而 aq 出现在第二个位置。在第 5 位，另一个不同之处正在发生。只需用变量替换这些字符串，就完成了。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-09-08T14:27:49.887

假设你有三个字符串

```
a="this is a line"
b="this is"
c="a line" 
```

从 a 中删除前缀 b

```
echo ${a#"$b"}  # a line 
```

从 a 中删除后缀 c

```
echo ${a%"$c"}  # this is 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-05-10T05:46:35.757

另一个例子：

```
before="184613 102050 83756 63054"
after="184613 102050 84192 83756 63054"

comm -23 <(tr ' ' $'\n' <<< $after | sort) <(tr ' ' $'\n' <<< $before | sort) 
```

输出

```
84192 
```

[原始答案在这里](https://stackoverflow.com/a/3223901/2202107)

# inno-setup - 如何使用 Inno Setup 安装 SQL Server 2008 Express？

> ID：454431
> 
> 赞同：2
> 
> 时间：2009-01-18T01:08:19.677
> 
> 标签：inno-setup, sql-server-2008-express

任何人都有脚本或程序来安装 SQL Server 2008 Express、为应用程序设置数据库并最终安装客户端 .NET WinForm 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-09T04:33:12.430

在这种我依赖第三方产品（SQL Server Express）的情况下，我倾向于使用命令行驱动的安装（直接在 cmd 文件中或从“适当的”安装工具中调用）。[该站点](http://msdn.microsoft.com/en-us/library/ms144259.aspx)向您展示了如何从命令行安装 Express，然后您可以使用[SQL Express 实用程序](http://www.microsoft.com/downloads/details.aspx?FamilyID=fa87e828-173f-472e-a85c-27ed01cf6b02&DisplayLang=en)来创建对象。这种方法受到微软的“祝福”。

有时最简单的解决方案是最好的，即使这意味着让我的产品用户在运行我的安装之前单独安装 SQL Express。好吧，无论如何，对我来说最好:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-11T07:11:09.573

以下脚本将检查 SQL Server 2008 R2 的完整版本。如果已安装完整版，则跳过安装 SQL Server。如果未安装完整版，则会检查 SQL Express 版本。如果已经安装，它将跳过安装。如果未安装，则会安装 SQL Express 2008 R2。

1.  创建一个新脚本。我们将其命名为**sql2008express.iss**，内容如下

    ```
    [CustomMessages]

    sql2008r2expressx86_title=Microsoft SQL Server 2008 R2 Express Edition x86 (Including Tools)
    sql2008r2expressx64_title=Microsoft SQL Server 2008 R2 Express Edition x64 (Including Tools)

    sql2008r2expressx86_size=235.5 MB
    sql2008r2expressx64_size=247.5 MB

    [Code]

    const
    sql2008r2expressx86_url='http://download.microsoft.com/download/5/5/8/558522E0-2150-47E2-8F52-FF4D9C3645DF/SQLEXPRWT_x86_ENU.exe';
    sql2008r2expressx64_url='http://download.microsoft.com/download/5/5/8/558522E0-2150-47E2-8F52-FF4D9C3645DF/SQLEXPRWT_x64_ENU.exe';

    procedure sql2008express();

    var
    version: string;

    begin
    // Check if the full version fo the SQL Server 2008 R2 is installed
    RegQueryStringValue(HKLM, 'SOFTWARE\Microsoft\Microsoft SQL Server\SQLSERVER\MSSQLServer\CurrentVersion', 'CurrentVersion', version);
    if (version < '10.5') or (version = '') then begin
    // If the full version is not found then check for the Express edition
    RegQueryStringValue(HKLM, 'SOFTWARE\Microsoft\Microsoft SQL Server\SQLEXPRESS\MSSQLServer\CurrentVersion', 'CurrentVersion', version);
    if (version < '10.5') (*or (version > '9.00') or (version = '') *) then begin
    if isX64() then
        AddProduct('SQLEXPRWT_x64_ENU.exe', '/QS /IACCEPTSQLSERVERLICENSETERMS /ACTION=Install /FEATURES=SQL,AS,RS,IS,Tools /INSTANCENAME=SQLEXPRESS /SQLSVCACCOUNT="NT AUTHORITY\Network Service" /SQLSYSADMINACCOUNTS="builtin\Administrators" /INDICATEPROGRESS /TCPENABLED=1 /BROWSERSVCSTARTUPTYPE=Automatic /ERRORREPORTING=0 /SQMREPORTING=0 /SECURITYMODE=SQL /SAPWD=1234', CustomMessage('sql2008r2expressx64_title'), CustomMessage('sql2008r2expressx64_size'), sql2008r2expressx64_url,false,false)
    else
    AddProduct('SQLEXPRWT_x86_ENU.exe', '/QS /IACCEPTSQLSERVERLICENSETERMS /ACTION=Install /FEATURES=SQL,AS,RS,IS,Tools /INSTANCENAME=SQLEXPRESS /SQLSVCACCOUNT="NT AUTHORITY\Network Service" /SQLSYSADMINACCOUNTS="builtin\Administrators" /INDICATEPROGRESS /TCPENABLED=1 /BROWSERSVCSTARTUPTYPE=Automatic /ERRORREPORTING=0 /SQMREPORTING=0 /SECURITYMODE=SQL /SAPWD=1234', CustomMessage('sql2008r2expressx86_title'), CustomMessage('sql2008r2expressx86_size'), sql2008r2expressx86_url,false,false);
            end;
        end;
    end; 
    ```

2.  在您的脚本中，只需将脚本包含在 [Run] 标记中，然后在 [Code] 标记中调用之前创建的脚本，如下所示：

    ```
    [Run]
    `#include "scripts\sql2008express.iss"
    [Code]
    sql2008express(); 
    ```

其他注意事项： - 如果 SQL 的安装工具包在同一个文件夹中，那么它将使用它们，如果没有，它们将从 Internet 下载。- 抱歉格式化，它不起作用。在文本编辑器中复制/粘贴并格式化。它已完成且正在运行。

我希望这对其他人也有帮助。:)

# django - 在 Django 中允许空值的唯一字段

> ID：454436
> 
> 赞同：158
> 
> 时间：2009-01-18T01:13:39.540
> 
> 标签：django, orm, django-models

我有具有字段栏的模型 Foo。bar 字段应该是唯一的，但允许其中包含空值，这意味着如果 bar 字段是 ，我希望允许多个记录`null`，但如果不是`null`，则值必须是唯一的。

这是我的模型：

```
class Foo(models.Model):
    name = models.CharField(max_length=40)
    bar = models.CharField(max_length=40, unique=True, blank=True, null=True, default=None) 
```

这是表的相应 SQL：

```
CREATE TABLE appl_foo
(
    id serial NOT NULL,
     "name" character varying(40) NOT NULL,
    bar character varying(40),
    CONSTRAINT appl_foo_pkey PRIMARY KEY (id),
    CONSTRAINT appl_foo_bar_key UNIQUE (bar)
) 
```

当使用管理界面创建超过 1 个 bar 为空的 foo 对象时，它给了我一个错误：“带有这个 Bar 的 Foo 已经存在。”

但是，当我插入数据库（PostgreSQL）时：

```
insert into appl_foo ("name", bar) values ('test1', null)
insert into appl_foo ("name", bar) values ('test2', null) 
```

这工作，很好，它允许我插入超过 1 条记录 bar 为空，所以数据库允许我做我想做的事，这只是 Django 模型有问题。有任何想法吗？

**编辑**

就 DB 而言，解决方案的可移植性不是问题，我们对 Postgres 很满意。我尝试为可调用设置唯一性，这是我的函数为*bar*的特定值返回 True/False ，它没有给出任何错误，但是缝合起来就像它根本没有效果一样。

到目前为止，我已经从*bar*属性中删除了 unique 说明符，并在应用程序中处理了*bar*的唯一性，但仍在寻找更优雅的解决方案。有什么建议吗？

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2009-09-09T14:26:02.297

自从票证 #9039 被修复以来，Django 并没有考虑 NULL 等于 NULL 来进行唯一性检查，请参阅：

[http://code.djangoproject.com/ticket/9039](http://code.djangoproject.com/ticket/9039)

这里的问题是表单 CharField 的规范化“空白”值是一个空字符串，而不是 None。因此，如果您将该字段留空，您会得到一个空字符串，而不是 NULL，存储在 DB 中。在 Django 和数据库规则下，空字符串等于用于唯一性检查的空字符串。

您可以强制管理界面为空字符串存储 NULL，方法是为 Foo 提供您自己的自定义模型表单，并使用 clean_bar 方法将空字符串转换为 None：

```
class FooForm(forms.ModelForm):
    class Meta:
        model = Foo
    def clean_bar(self):
        return self.cleaned_data['bar'] or None

class FooAdmin(admin.ModelAdmin):
    form = FooForm 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-12-20T03:40:23.593

** 2015 年**11 月 30 日编辑**：在 python 3 中，[不再支持](https://stackoverflow.com/questions/14078755/django-custom-model-fields-to-python-not-called)`__metaclass__`模块全局变量。另外，该类已被[弃用](https://docs.djangoproject.com/en/1.8/releases/1.8/#subfieldbase)：`Django 1.10``SubfieldBase`

> ### 来自[文档](https://docs.djangoproject.com/en/1.8/releases/1.8/#subfieldbase)：
> 
> `django.db.models.fields.subclassing.SubfieldBase`已被弃用并将在 Django 1.10 中删除。从历史上看，它用于处理从数据库加载时需要类型转换的字段，但它不用于`.values()`调用或聚合中。它已被替换为[`from_db_value()`](https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.Field.from_db_value)。 请注意，新**方法****不像`to_python()`**.`SubfieldBase`

因此，正如`from_db_value()` [文档](https://docs.djangoproject.com/en/1.8/ref/models/fields/#django.db.models.Field.from_db_value)和此[示例](https://docs.djangoproject.com/en/1.8/howto/custom-model-fields/#converting-values-to-python-objects)所建议的，此解决方案必须更改为：

```
class CharNullField(models.CharField):

    """
    Subclass of the CharField that allows empty strings to be stored as NULL.
    """

    description = "CharField that stores NULL but returns ''."

    def from_db_value(self, value, expression, connection, contex):
        """
        Gets value right out of the db and changes it if its ``None``.
        """
        if value is None:
            return ''
        else:
            return value

    def to_python(self, value):
        """
        Gets value right out of the db or an instance, and changes it if its ``None``.
        """
        if isinstance(value, models.CharField):
            # If an instance, just return the instance.
            return value
        if value is None:
            # If db has NULL, convert it to ''.
            return ''

        # Otherwise, just return the value.
        return value

    def get_prep_value(self, value):
        """
        Catches value right before sending to db.
        """
        if value == '':
            # If Django tries to save an empty string, send the db None (NULL).
            return None
        else:
            # Otherwise, just pass the value.
            return value 
```

* * *

我认为比在管理员中覆盖cleaned_data 更好的方法是对charfield 进行子类化——这样无论什么形式访问该字段，它都会“正常工作”。您可以`''`在它被发送到数据库之前捕获它，并在它从数据库中出来之后捕获 NULL，而 Django 的其余部分将不知道/关心。一个快速而肮脏的例子：

```
from django.db import models

class CharNullField(models.CharField):  # subclass the CharField
    description = "CharField that stores NULL but returns ''"
    __metaclass__ = models.SubfieldBase  # this ensures to_python will be called

    def to_python(self, value):
        # this is the value right out of the db, or an instance
        # if an instance, just return the instance
        if isinstance(value, models.CharField):
            return value 
        if value is None:  # if the db has a NULL (None in Python)
            return ''      # convert it into an empty string
        else:
            return value   # otherwise, just return the value

    def get_prep_value(self, value):  # catches value right before sending to db
        if value == '':   
            # if Django tries to save an empty string, send the db None (NULL)
            return None
        else:
            # otherwise, just pass the value
            return value 
```

对于我的项目，我将它转储到位于`extras.py`我网站根目录中的文件中，然后我可以`from mysite.extras import CharNullField`在我的应用程序`models.py`文件中。该字段的行为就像一个 CharField - 只记得`blank=True, null=True`在声明字段时设置，否则 Django 将抛出验证错误（需要字段）或创建一个不接受 NULL 的 db 列。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2012-08-09T11:52:37.253

因为我是stackoverflow的新手，所以我还不允许回复答案，但我想指出，从哲学的角度来看，我不能同意这个问题最流行的答案。（由凯伦特蕾西）

如果它有值，则 OP 要求他的 bar 字段是唯一的，否则为 null。那么一定是模型本身确保了这种情况。不能让外部代码检查这一点，因为这意味着它可以被绕过。（或者以后写新视图可以忘记勾选）

因此，要使您的代码真正保持 OOP，您必须使用 Foo 模型的内部方法。修改 save() 方法或字段是不错的选择，但使用表单来执行此操作肯定不是。

我个人更喜欢使用建议的 CharNullField，以便移植到我将来可能定义的模型。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-06-26T16:24:25.553

快速解决方法是：

```
def save(self, *args, **kwargs):

    if not self.bar:
        self.bar = None

    super(Foo, self).save(*args, **kwargs) 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2020-07-07T11:25:21.670

您可以在列表中添加`UniqueConstraint`条件`nullable_field=null`而不包括此字段`fields`。如果您还需要具有`nullable_field`极值 is not的约束`null`，您可以添加额外的一个。

注意：从 django 2.2 开始添加 UniqueConstraint

```
class Foo(models.Model):
    name = models.CharField(max_length=40)
    bar = models.CharField(max_length=40, unique=True, blank=True, null=True, default=None)

    class Meta:
        constraints = [
            # For bar == null only
            models.UniqueConstraint(fields=['name'], name='unique__name__when__bar__null',
                                    condition=Q(bar__isnull=True)),
            # For bar != null only
            models.UniqueConstraint(fields=['name', 'bar'], name='unique__name__when__bar__not_null')
        ] 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2020-05-28T11:48:25.473

现在解决了[https://code.djangoproject.com/ticket/4136](https://code.djangoproject.com/ticket/4136)的问题。在 Django 1.11+ 中，您`models.CharField(unique=True, null=True, blank=True)`无需手动将空白值转换为`None`.

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-07-07T08:10:33.523

另一种可能的解决方案

```
class Foo(models.Model):
    value = models.CharField(max_length=255, unique=True)

class Bar(models.Model):
    foo = models.OneToOneField(Foo, null=True) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-22T11:50:20.800

我最近有同样的要求。我没有对不同的字段进行子类化，而是选择覆盖我的模型（下面命名为“MyModel”）上的 save() 方法，如下所示：

```
def save(self):
        """overriding save method so that we can save Null to database, instead of empty string (project requirement)"""
        # get a list of all model fields (i.e. self._meta.fields)...
        emptystringfields = [ field for field in self._meta.fields \
                # ...that are of type CharField or Textfield...
                if ((type(field) == django.db.models.fields.CharField) or (type(field) == django.db.models.fields.TextField)) \
                # ...and that contain the empty string
                and (getattr(self, field.name) == "") ]
        # set each of these fields to None (which tells Django to save Null)
        for field in emptystringfields:
            setattr(self, field.name, None)
        # call the super.save() method
        super(MyModel, self).save() 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-04-06T11:56:46.830

如果您有一个模型 MyModel 并且希望 my_field 为 Null 或唯一，您可以覆盖模型的保存方法：

```
class MyModel(models.Model):
    my_field = models.TextField(unique=True, default=None, null=True, blank=True) 

    def save(self, **kwargs):
        self.my_field = self.my_field or None
        super().save(**kwargs) 
```

这样，该字段不能为空，只会是非空或空。空值与唯一性不矛盾

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-18T03:49:52.673

无论好坏，Django 认为`NULL`等同于`NULL`用于唯一性检查。除了编写自己的唯一性检查实现之外，真的没有办法解决它，`NULL`无论它在表中出现多少次，它都认为是唯一的。

（请记住，一些数据库解决方案对 . 有相同的看法`NULL`，因此依赖于一个数据库的想法的代码`NULL`可能无法移植给其他人）

# python - Django 开发是否提供了真正灵活的 3 层架构？

> ID：454443
> 
> 赞同：4
> 
> 时间：2009-01-18T01:20:33.940
> 
> 标签：python, django, model-view-controller, orm

几周前，我问了一个问题*“PHP、Python、PostgreSQL 设计是否适合非 Web 业务应用程序？”* [PHP、Python、PostgreSQL 设计是否适合业务应用程序？](https://stackoverflow.com/questions/439759/is-a-php-python-postgresql-design-suitable-for-a-business-application)

许多答案建议跳过**PHP**部分并使用**Django**构建应用程序。当我探索 Django 时，我开始质疑我的目标的一个特定方面，以及 Django 如何**在非 Web 业务应用程序**中发挥作用。

根据我的理解，Django 将管理视图和控制器部分，而**PostgreSQL**或**MySQL**将处理数据。但我的目标是清楚地分离各个层，以便数据库、域逻辑和表示可以在不显着影响其他的情况下进行更改。似乎我只是用 Django 解决方案将 M 与 VC 层分开。

那么，对我来说，使用**SQL Alchemy/Elixir ORM 工具在****Python**中构建域层，数据库层使用**PostgreSQL**，然后仍然使用**Django**或**PHP**作为表示层，会适得其反吗？这是可能的还是纯粹的精神错乱？

 ******基本上，我会看**Django/PHP > Python/SQLAlchemy > PostgreSQL/MySQL**的架构。

*编辑：在粉丝们因为我问一个关于 Django 的问题而生我的气之前，请意识到：这是一个问题，而不是指责。如果我知道答案或有自己的看法，我就不会问了！*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-18T02:41:38.193

您似乎在说选择 Django 会阻止您以后使用更异构的解决方案。事实并非如此。Django 在层之间提供了许多有趣的连接，将 Django 用于所有层可以让您利用这些连接。例如，使用 Django ORM 意味着您几乎可以免费获得出色的 Django 管理应用程序。

您可以选择在 Django 中使用不同的 ORM，只是不会同时获得管理应用程序（或通用视图）。因此，不同的 ORM 让您从完整的 Django 自上而下向后退了一步，但这并不是从其他异构解决方案的倒退，因为这些解决方案一开始并没有为您提供管理应用程序的层内优势.

不应批评 Django 没有提供灵活的架构：它与任何其他解决方案一样灵活，如果您选择换出一个层，您只需放弃 Django 的一些好处。

如果选择从 Django 入手，现在可以使用 Django ORM，以后如果需要切换，可以切换到 SQLalchemy。这不会比现在从 SQLalchemy 开始，然后再转向其他一些 ORM 解决方案更困难。

您还没有说明为什么您预计需要换出层。无论如何，这将是一个痛苦的过程，因为必然有很多代码依赖于您当前使用的任何工具集和库的行为。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-18T03:48:18.493

Django 很乐意让你使用你想要的任何库——你想要一个不同的 ORM，使用它，你想要一个不同的模板引擎，使用它等等——但它旨在提供一个许多可互操作的应用程序使用的通用默认堆栈。换句话说，如果您更换 ORM 或模板系统，您将失去与许多应用程序的兼容性，但利用大量应用程序的能力通常比这更重要。

然而，从更广泛的意义上讲，我建议您花更多时间阅读 Web 应用程序的架构模式，因为您似乎有一些重大的概念混淆正在发生。可以简单地说，例如，Rails 没有“视图”层，因为您可以使用不同的文件系统作为视图代码的存储位置（换句话说：能够更改数据的位置和方式由您的模型层存储并不意味着您没有*模型*层）。

（不言而喻，了解为什么“严格”或“纯”MVC 绝对不适合 Web 应用程序也很重要*；*纯 MVC 对于具有许多独立方式来启动交互的应用程序很有用，比如一个词具有大量工具栏和输入窗格的处理器，但是当您移动到 ​​Web 并且只有一种方式（HTTP 请求）与应用程序交互时，它的好处很快开始消失。这就是为什么没有“真正的”MVC Web 框架；它们都借用了某些关于关注点分离的想法，但没有一个严格实现该模式）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-18T23:06:07.527

您似乎将“单独的层”与“单独的语言/技术”混淆了。您没有理由不能在单一编程语言或适当的模块化框架（例如 Django）中适当地分离您的关注点。不必要地增加编程语言/框架只是增加了不必要的复杂性，这可能会大大减慢您的初始工作速度，以至于您的项目永远不会达到需要技术转换的地步。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-18T01:29:36.700

无论您使用 Django 的 ORM 还是 SQLAlchemy，您都有效地获得了 3 层架构，尽管如果您选择后者，您会放弃 Django 的一些好处。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-18T02:52:58.497

> 根据我的理解，Django 将管理视图和控制器部分，而 PostgreSQL 或 MySQL 将处理数据。

并非如此，Django 有自己的 ORM，因此它确实将数据与视图/控制器分开。

这是来自有关 MVC[的官方常见问题解答中](http://docs.djangoproject.com/en/dev/faq/general/#django-appears-to-be-a-mvc-framework-but-you-call-the-controller-the-view-and-the-view-the-template-how-come-you-don-t-use-the-standard-names)的一个条目：

> 那么，“控制器”在哪里？在 Django 的例子中，它可能是框架本身：根据 Django URL 配置向适当视图发送请求的机器。
> 
> 如果你渴望缩写词，你可能会说 Django 是一个“MTV”框架——即“模型”、“模板”和“视图”。这种崩溃更有意义。
> 
> 当然，归根结底，还是要把事情做好。而且，无论事物如何命名，Django 都会以对我们来说最合乎逻辑的方式完成工作。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-18T12:58:43.907

有变化，有变化。Django 将领域模型、业务规则和表示完全分开。您可以（几乎）更改几乎零破损的任何东西。我所说的变化是指有意义的以最终用户为中心的业务变化。

这个（和前一个）问题中的技术混合匹配并不是很有帮助。

谁——特别是——受益于用 PHP 替换 Django 模板。它没有更多的生产力。它更复杂，没有任何好处。谁从更改 ORM 中受益。用户不会也无法分辨。

# open-source - 你如何正确地信任开源项目？

> ID：454447
> 
> 赞同：15
> 
> 时间：2009-01-18T01:22:34.233
> 
> 标签：open-source, licensing

我是在生产代码中使用开源库的新手，所以当它说复制这个许可证或任何正确的方法是什么时？

使用桌面软件是否提供了足够好的自述文件？一个网站呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-18T01:26:59.637

IANAL 所以这些都不符合法律要求。个人许可证将决定这一点，您应该寻求专业建议。我的回答只涉及使用开源软件的道德规范。

主要原则是，如果您使用开源项目，您应该以一种可以看到但不会侵入您的网站或应用程序的方式来信任该项目。每个网页上的“Powered by Python”标志都是侵入性的。在帮助页面上带有项目 URL 链接的段落是完全可以接受的（恕我直言）。

**桌面应用程序：**在“帮助”菜单上放置一个“关于”链接，描述所使用的技术并给出适当的积分。恕我直言，没有人阅读自述文件。

**网站：**如果他们有菜单，你可以做同样的事情。或者，您可以将其作为问题放在您的常见问题解答中。如果没有菜单（或可能除此之外），您可以在页脚中放置指向该信息的链接（这是小型且非侵入性的）。Eitehr 作为单独的链接或在另一个相关链接上。

任何学分都应包含指向项目或公司主页的链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T01:48:35.897

仅供参考 一些开源项目是在“copyleft”许可下获得许可的，这意味着任何衍生作品**也必须是开源**的。

你应该小心这一点，特别是对于 GPL 代码，如果它们没有明确声明你可以使用 lesser-GPL 许可证并且你不小心修改了 GPL ed 代码（修复错误、一些小的增强等），你可能会麻烦了。

这是关于copyleft的好读物：[http ://www.gnu.org/copyleft/](http://www.gnu.org/copyleft/)

抛开法律问题不谈，就像@cletus 一样：把适当的学分放在适当的地方是个好主意。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-18T22:40:56.953

您可以做的最好的事情是完整阅读该库发布的许可证并解释其中的要求。只是没有替代品。从那里您可以查看使用相同库的其他项目（查看 sourceforge.net，您还可以在其中按许可证过滤项目）并查看它们的作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-08T09:24:44.640

这就是我们在我们正在开发的网站上所做的：http: [//www.cartell.ie/about-us/open-source-credits/](http://www.cartell.ie/about-us/open-source-credits/)

# python - 如何重新搜索或重新匹配整个文件而不将其全部读入内存？

> ID：454456
> 
> 赞同：37
> 
> 时间：2009-01-18T01:27:16.783
> 
> 标签：python, regex, performance, file

我希望能够在整个文件上运行正则表达式，但我希望不必一次将整个文件读入内存，因为我将来可能会处理相当大的文件。有没有办法做到这一点？谢谢！

**澄清：**我不能逐行阅读，因为它可以跨越多行。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-01-18T03:24:46.780

您可以使用 mmap 将文件映射到内存。然后可以像普通字符串一样访问文件内容：

```
import re, mmap

with open('/var/log/error.log', 'r+') as f:
  data = mmap.mmap(f.fileno(), 0)
  mo = re.search('error: (.*)', data)
  if mo:
    print "found error", mo.group(1) 
```

这也适用于大文件，文件内容根据需要从磁盘内部加载。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T01:42:26.737

这取决于文件和正则表达式。您可以做的最好的事情是逐行读取文件，但如果这对您的情况不起作用，那么可能会因为将整个文件拉入内存而陷入困境。

例如，假设这是您的文件：

```
Lorem ipsum dolor sit amet, consectetur
adipiscing elit. Ut fringilla pede blandit
eros sagittis viverra. Curabitur facilisis
urna ABC elementum lacus molestie aliquet.
Vestibulum lobortis semper risus. Etiam
sollicitudin. Vivamus posuere mauris eu
nulla. Nunc nisi. Curabitur fringilla fringilla
elit. Nullam feugiat, metus et suscipit
fermentum, mauris ipsum blandit purus,
non vehicula purus felis sit amet tortor.
Vestibulum odio. Mauris dapibus ultricies
metus. Cras XYZ eu lectus. Cras elit turpis,
ultrices nec, commodo eu, sodales non, erat.
Quisque accumsan, nunc nec porttitor vulputate,
erat dolor suscipit quam, a tristique justo
turpis at erat. 
```

这是你的正则表达式：

```
consectetur(?=\sadipiscing) 
```

现在，此正则表达式使用[正向前瞻](http://www.regular-expressions.info/lookaround.html)，并且仅在紧随其后的任何空白字符和“adipiscing”字符串之后才匹配“consectetur”字符串。

因此，在此示例中，您必须将整个文件读入内存，因为您的正则表达式取决于被解析为单个字符串的整个文件。这是要求您将整个字符串保存在内存中以使特定正则表达式工作的众多示例之一。

我想不幸的答案是这一切都取决于你的情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-18T02:39:06.527

如果这很重要并且值得付出一些努力，您可以将正则表达式转换为读取文件的有限状态机。FSM 可能具有 O(n) 复杂度，这意味着随着文件大小的增大，它会变得更快。

您将能够有效地匹配跨越因太大而无法放入内存的文件中的行的模式。

这里有两个地方描述了将正则表达式转换为 FSM 的算法：

*   [http://swtch.com/~rsc/regexp/regexp1.html](http://swtch.com/~rsc/regexp/regexp1.html)
*   [http://www.math.grin.edu/~rebelsky/Courses/CS362/98F/Outlines/outline.07.html](http://www.math.grin.edu/~rebelsky/Courses/CS362/98F/Outlines/outline.07.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-18T02:00:41.787

这是一种方式：

```
import re

REGEX = '\d+'

with open('/tmp/workfile', 'r') as f:
      for line in f:
          print re.match(REGEX,line) 
```

1.  python 2.5 中的 with 运算符会自动关闭文件。因此，您不必担心。
2.  文件对象上的迭代器是内存高效的。也就是说，它在给定时间不会读取超过一行的内存。
3.  但是这种方法的缺点是需要大量时间来处理大文件。

我想到的另一种方法是使用 read(size) 和 file.seek(offset) 方法，它将一次读取文件大小的一部分。

```
import re

REGEX = '\d+'

with open('/tmp/workfile', 'r') as f:
      filesize = f.size()
      part = filesize / 10 # a suitable size that you can determine ahead or in the prog.
      position = 0 
      while position <= filesize: 
          content = f.read(part)
          print re.match(REGEX,content)
          position = position + part
          f.seek(position) 
```

您还可以将这两者结合起来，您可以创建生成器，该生成器将在当时返回特定字节的内容并遍历该内容以检查您的正则表达式。这个 IMO 将是一个很好的方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-02-15T05:02:46.793

这是您使用 re 和 mmap 查找文件中的所有单词的选项，该文件不会构建列表或将整个文件加载到内存中。

```
import re
from contextlib import closing
from mmap import mmap, ACCESS_READ

with open('filepath.txt', 'r') as f:
    with closing(mmap(f.fileno(), 0, access=ACCESS_READ)) as d:
        print(sum(1 for _ in re.finditer(b'\w+', d))) 
```

基于@sth的[回答](https://stackoverflow.com/a/454589/225020)，但内存使用量较少

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-18T01:44:49.133

对于单行模式，您可以遍历文件的行，但对于多行模式，您必须将文件的全部（或部分，但很难跟踪）读入内存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-18T01:46:43.047

打开文件并遍历这些行。

```
fd = open('myfile')
for line in fd:
    if re.match(...,line)
        print line 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-01-18T13:56:39.570

```
f = open(filename,'r')
  for eachline in f:
    string=re.search("(<tr align=\"right\"><td>)([0-9]*)(</td><td>)([a-zA-Z]*)(</td><td>)([a-zA-Z]*)(</td>)",eachline)
    if string:
      for i in range (2,8,2):
        add = string.group(i)
        l.append(add) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-07T18:49:42.677

Python 3：要将文件作为一个大字符串加载，请使用 read() 和 decode() 方法

```
import re, mmap

def read_search_in_file(file):
    with open('/var/log/error.log', 'r+') as f:
        data = mmap.mmap(f.fileno(), 0).read().decode("utf-8")
        error = re.search(r'error: (.*)', data)
  if error:
    return error.group(1) 
```

# jquery - 使用 JQuery 的智能引号

> ID：454457
> 
> 赞同：1
> 
> 时间：2009-01-18T01:28:12.677
> 
> 标签：jquery, wysiwyg

使用 jQuery，如何在编辑文本框时启用[智能引号的实时插入？](http://en.wikipedia.org/wiki/Quotation_mark_glyphs)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-18T02:02:38.257

一种选择是使用鲜为人知的“q”元素。

```
foo bar<q>quoted area</q>foo bar 
```

然后用户代理将尽最大努力创建最佳样式引用。

*   [关于 a-list-apart 的文章](http://www.alistapart.com/articles/qtag)
*   [W3学校](http://www.w3schools.com/tags/tag_q.asp)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T13:50:08.057

假设您正在谈论尝试用智能引号自动替换 " 和 '：这不一定是一个好主意。为引号选择正确方式的算法很脆弱，很容易被愚弄。有一个通用的公式可以做查看引号前的字符，Office 等程序使用此字符。但它们经常出错，使文本比没有尝试过的情况更糟。有时，当然，您不希望在全部（尤其是在我们谈论代码的这样的网站上）。

如果是为了您自己的个人打字方便，您可以尝试安装一个键盘布局，允许直接和明确地输入智能引号。

也就是说，如果你必须，这里有一些代码开始......

```
<textarea id="foo" rows="6" cols="40"></textarea> 
```

...

```
function AutoReplacer(element) {
    // List of replacement rules. Note currently with this simplistic code
    // replacements should be the same length as the original text.
    //
    replacements= [
        [' "', ' \u201C'],
        ['("', ' \u201C'],
        ['"', '\u201D']
    ];

    // Only attempt to use replacer behaviour if we can retain the cursor
    // position. Setting value by default moves the cursor to the end of the
    // input, which is too irritating.
    //
    if (getInputSelection(element)!==null) {
        element.onkeyup= function() {
            value= element.value;
            for (var i= 0; i<replacements.length; i++) {
                value= value.split(replacements[i][0]).join(replacements[i][1]);
            }
            if (value!=element.value) {
                var s= getInputSelection(element);
                element.value= value;
                setInputSelection(element, s);
            }
        };
    }
}

// Cross-browser (as much as possible anyway) cursor positioning
//
function getInputSelection(element) {
    if (element.selectionStart!==window.undefined) {
        return [element.selectionStart, element.selectionEnd];
    } else if (document.selection) {
        var BIG= 1000000;
        var range= document.selection.createRange();
        if (range.moveStart===window.undefined)
            return [0, 0];
        var start= -range.moveStart('character', -BIG);
        var end= -range.moveEnd('character', -BIG);
        return [start-1, end-1];
    } else return null;
}
function setInputSelection(element, s) {
    if (element.selectionStart!==window.undefined) {
        element.selectionStart= s[0];
        element.selectionEnd= s[1];
    } else if (document.selection) {
        var range= element.createTextRange();
        range.collapse(true);
        range.moveEnd('character', s[1]);
        range.moveStart('character', s[0]);
        range.select();
    }
}

new AutoReplacer(document.getElementById('foo')); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-18T14:47:51.043

以 Kent 的回答为基础：您可以使用 q 标签，但是，大多数浏览器默认只使用直引号，而 IE 不显示任何引号。

这在 IE7+ 和其他浏览器中通过使用 CSS 得到了补救。这是我在样式表中添加的内容：

```
q:before {
    content: "\201c";
}
q:after {
    content: "\201d";
}
q q:before {
    content: "\2018";
}
q q:after {
    content: "\2019";
} 
```

第一批用于大弯双引号，第二批用于大弯单引号（用于嵌套 q 标签时）。

这在 IE6 中不起作用。我的正常解决方案是在 q 元素上设置颜色，以便它们脱颖而出。我对 IE6 的“去他妈的，这就够了”策略的一部分。

# php - 如何在magento电子商务中获取特定类别的产品

> ID：454462
> 
> 赞同：10
> 
> 时间：2009-01-18T01:31:46.883
> 
> 标签：php, magento, e-commerce

我想获得与当前产品相同类别的随机产品列表，以便在产品视图中显示 - 到目前为止，我所挖掘的只是

[Magento 产品按类别](https://stackoverflow.com/questions/272818/magento-products-by-categories)

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-06-12T11:31:49.350

您基本上加载了类别，获取产品集合，然后进行适当的过滤。

```
$products = Mage::getModel('catalog/category')->load($category_id)
 ->getProductCollection()
 ->addAttributeToSelect('*')
 ->addAttributeToFilter('status', 1)
 ->addAttributeToFilter('visibility', 4)
 ->addAttributeToFilter('special_price', array('neq' => ""))
 ->setOrder('price', 'ASC')
 ; 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-04-04T09:53:45.290

以下是从任何特定类别获取产品的代码：-

```
$productCollection = Mage::getResourceModel('catalog/product_collection')
                           ->addCategoryFilter($category); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-13T23:29:58.970

我最终做的是在 app/design/frontend/default/theme_name/template/catalog/product/list_random.phtml

做类似的事情：

```
<?php 
$_categories=$this->getCurrentChildCategories();

$_category = $this->getCurrentCategory();
$subs = $_category->getAllChildren(true);
$result = array();
foreach($subs as $cat_id) {
    $category = new Mage_Catalog_Model_Category();
    $category->load($cat_id);
    $collection = $category->getProductCollection();
    foreach ($collection as $product) {
        $result[] = $product->getId();
    }

}
shuffle($result);
?> 
```

这将为您提供一系列产品ID。您可以循环使用它们并动态创建产品：

```
<?php 
$i=0; 
foreach ($result as $_product_id){ 
    $i++;
    $_product = new Mage_Catalog_Model_Product();
    $_product->load($_product_id);
    //do something with the product here
}?> 
```

然后，在 cms 中创建一个包含以下内容的静态块

```
{{block type="catalog/navigation" template="catalog/product/list_random.phtml"}} 
```

最后，在目录->管理类别部分，选择类别，然后选择显示设置选项卡。将显示模式切换为“静态块和产品”，然后从下拉列表中选择您的块。

那应该这样做。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-05-14T05:22:43.987

```
$products = Mage::getModel('catalog/category')->load(category_id); //put your category id here
       $productslist = $products->getProductCollection()->addAttributeToSelect('*');
       foreach($productslist as $product)
       {
        echo 'price: ' . $product->getPrice() . '<br/>';
       } 
```

这是迄今为止获取特定类别产品详细信息的便捷代码。希望对您有所帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-12-08T15:56:00.297

在这种情况下，您应该通过调用来实例化模型，`Mage::getModel('catalog/product')`因为这样您将获得一个配置的对象实例，该实例由任何配置的模块扩展。

如果你这样做`new Mage_Catalog_Model_Product()`会忽略模块并绕过 Magento API。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-12T11:38:44.840

此代码将帮助您从**类别 id 2**中获取**产品**。并且这里还使用模板文件**list_home.phtml**用于产品列表。

 ****```
 echo $this->getLayout()->createBlock("catalog/product_list")
    ->setCategoryId(2)->setTemplate("catalog/product/list_home.phtml")->toHtml(); 
```

**list_home.phtml**

```
<?php
$this->getChild('toolbar')->setCurrentMode('list'); //uses list mode
$_productCollection = $this->getLoadedProductCollection();
$_helper = $this->helper('catalog/output');
    ?>

    <?php if (!$_productCollection->count()): ?>
        <p class="note-msg"><?php echo $this->__('There are no products matching the selection.') ?></p>
    <?php else: ?>

--use code for listing--- 
```

# java - Felix/OSGi：如何使用不是 OSGi 服务的 SCR 组件？

> ID：454464
> 
> 赞同：0
> 
> 时间：2009-01-18T01:33:38.017
> 
> 标签：java, dependency-injection, osgi, apache-felix

Apache Felix 的 SCR 允许声明（通过注释或 XML）组件，然后将其实例化、连接到它们的依赖项并注册为 OSGi 服务。

也可以跳过服务注册部分，只让 SCR 创建组件（通过指定*@scr.component*，但省略*@scr.service*）。我在想这可能仅对依赖注入（在包中）有用，但是如何使用组件？可以使用*scr.reference*注入服务，但这不适用于非服务（或者是否）？

直接访问 SCR API 是可行的，但直接与容器服务对话有点违背 DI 的目的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-19T14:24:50.420

我认为您只能注入 OSGI 服务。如果你想使用依赖注入，也许你应该检查 google Guice。不幸的是，我不知道它是否可以在 OSGI 容器中开箱即用。

关于 SCR 组件，如果一个组件提供了您想在另一个组件中使用的功能，我认为它应该使用服务公开。

# architecture - n 层对您意味着什么？

> ID：454475
> 
> 赞同：6
> 
> 时间：2009-01-18T01:48:15.507
> 
> 标签：architecture, n-tier-architecture

多年来，我注意到不同的开发人员对 n 层系统开发中的层构成有不同的标准，所以我很好奇 stackoverflow 的共识是什么。

单独的逻辑层是否足以将其称为单独的层，还是必须可部署在单独的服务器（物理或虚拟）上才能将其称为单独的层？

让我用不同的方式来表达这个问题。如果调用机制只能在进程中、线程本地或单元本地，那么根据类如何组织到库或包中，是否可以声称它是两个不同的层？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-18T01:53:55.823

一个单独的逻辑层足以让我称之为层。它不一定必须在单独的服务器上，但定义的与其他层的分离肯定使之成为可能。

作为一个例子，我们曾经有一个运行在单个服务器上的 3 层系统（db、dll、asp 页面）。根据某些定义，这是一个单层系统。我们现在让数据库在单独的服务器上运行，唯一需要更改的是连接字符串，但现在这将是一个两层解决方案？

这就是为什么我觉得层的概念更多的是关于在单独的机器上运行它们的能力，而不是实际上必须这样做。这对我来说似乎更一致。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T02:56:22.593

对我来说，物理层意味着系统的一部分，*旨在*运行在不同的物理机器上。是的，您可以随时将您的数据库连接字符串指向另一台服务器，但如果您的 DAL 太健谈，有 n+1 和无限记录集问题，那么网络延迟会很快杀死您。

另一方面，逻辑层支持关注点分离、内聚和耦合的优点。严格来说，它甚至不必在单独的程序集中——命名空间就可以了。只是不要调用你知道不应该调用的类，NDepend 会帮助你。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-18T01:54:47.443

> 层和层的概念经常互换使用。然而，一个相当普遍的观点是确实存在差异，层是构成软件解决方案的元素的逻辑结构机制，而层是系统基础设施的物理结构机制

[参考](http://en.wikipedia.org/wiki/N_tier)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-18T04:10:51.087

层是一种最小化耦合的机制；他们是合乎逻辑的。层级旨在最大限度地提高性能或消除安全风险；他们是物理的。它们真的不一样，我不确定为什么人们试图互换使用它们。

绝大多数 Web 应用程序默认为 3 层（浏览器、Web 服务器、数据库服务器）。大多数 Intranet 应用程序是 2 层（客户端、数据库服务器）。但无论哪种情况，我都会构建一个 UI 层、一个业务层和一个数据层。他们有关注点分离并帮助我构建我的代码以实现可维护性。同样在任何一种情况下，我通常最终都将它们全部部署在一个盒子上；Web 服务器或客户端工作站。所以层和层甚至不匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T01:53:54.577

我一直认为层是架构中的任何物理分离，也就是说，一台机器。我发现[这些](http://www.codeplex.com/AppArchGuide)人最近也有同样的想法，这是一本非常好的书。

但在阅读了其他回复后，我深思熟虑，我同意 Garry 的[观点](https://stackoverflow.com/questions/454475/what-does-n-tier-mean-to-you#454483)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-18T05:41:23.057

我同意 Garry Shutler 的观点，但补充说许多层也可能存在于单个进程/线程甚至同一个程序集中。比物理（硬件、可执行隔离或二进制隔离）分离更重要的是开发人员的代码布局（恕我直言）。与 aspnet 应用程序一样：同一个 dll 可以包含所有三层：数据访问、域和表示。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T05:31:14.570

我不得不说，定义需要敲定。我通常认为层是功能和责任的逻辑分离，层是物理分离的要求或能力。有些层可能有多个层，有些层可能跨越层。我通常使用一个服务层层，它能够在必要和/或需要时通过配置提供物理分离。

所以，跟进问题/评论。如果数据库中的存储过程中有一堆逻辑（业务或其他），是否也应该将其视为一个层？如果您正在使用 Microsoft SQL Server 的 Service Broker 等数据库引擎的功能怎么办？这可以被视为本身有两个层次。

此外，后台服务和/或守护程序，它们是单独的层和/或层还是属于现有的层？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-28T06:08:19.597

查看计算中“层”一词的历史。没有人说台式机/小型机/大型机上的 1 层计算。在客户端-服务器时代，没有人说 2 层计算。3 层成为客户端-服务器加上中间件（面向消息的中间件和事务代理）之间的架构名称。我认为 n 层是与另一个术语“EAI - 或企业架构集成”一起普及的。这与面向服务的架构完全相同，只是大多数供应商的实现要么是专有的、基于标准的但非常昂贵，要么两者兼而有之。在 XML-RPC、SOAP 和 REST 出现之后，他们将其称为“Web 服务”，然后应用其背后的 EAI 原则，提出了 SOA——面向服务的体系结构和企业服务总线。

我的观点是，这些术语都没有暗示任何物理分离……它总是关于功能的逻辑分离。碰巧的是，这些逻辑应用层中的许多都被设计为无状态的，因此它们可以在物理上分离以实现水平可扩展性。

# winapi - 如何使键盘钩子跨进程全局化

> ID：454477
> 
> 赞同：4
> 
> 时间：2009-01-18T01:49:06.490
> 
> 标签：winapi, api, keyboard

我正在尝试创建一个实用的按键应用程序，这样我就可以执行诸如终止预编程进程或启动某些操作之类的操作。我想我应该在任何应用程序中按住 cmd，然后输入一个 4 位命令键，这样我就可以在编程、调试观看视频等时快速启动或杀死任何东西。

我想出了如何获得键盘回调，但是无论出于何种原因，一旦我点击另一个应用程序，我的击键实用程序就不再接收任何键。即使我点击回到我的控制台窗口或 msvc，我也不会收到任何输入。这是除非它是全局的，那么我如何将钩子设置为全局的？

我的代码是

```
int main()
{
    hook = SetWindowsHookEx(WH_KEYBOARD, KeyboardProc, GetModuleHandle(0), 0);
    MSG msg;
    while(GetMessage(&msg, NULL, 0, 0) > 0)
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }
    UnhookWindowsHookEx(hook);
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-18T02:09:57.103

为了让所有进程都可以访问您的键盘挂钩，必须将它放在一个 DLL 中，然后将其加载到每个进程的地址空间中。需要记住的重要一点是，由于 DLL 的每个实例都在单独的进程中加载​​，因此每个实例都将拥有自己的 DLL 中任何全局变量的副本。如果需要在这些实例之间共享数据，最简单的方法是在 DLL 中创建一个共享数据段。以下代码来自我编写的一个 RSI 监控程序。

```
//
// some data will be shared across all
// instances of the DLL
//
#pragma comment(linker, "/SECTION:.SHARED,RWS")
#pragma data_seg(".SHARED")
int iKeyCount = 0;
HHOOK hKeyboardHook = 0;
HHOOK hMouseHook = 0;
#pragma data_seg()

//
// instance specific data
//
HMODULE hInstance = 0;

//
// DLL load/unload entry point
//
BOOL APIENTRY DllMain(HANDLE hModule, 
                      DWORD  dwReason, 
                      LPVOID lpReserved)
{
   switch (dwReason)
   {
   case DLL_PROCESS_ATTACH :
      hInstance = (HINSTANCE) hModule;
      break;

   case DLL_THREAD_ATTACH :
      break;

   case DLL_THREAD_DETACH :
      break;

   case DLL_PROCESS_DETACH :
      break;
   }
   return TRUE;
}

//
// keyboard hook
//
LRESULT CALLBACK KeyboardProc(int code,       // hook code
                              WPARAM wParam,  // virtual-key code
                              LPARAM lParam)  // keystroke-message information
{
   if ((lParam & 0x80000000) != 0)
   {
      ++iKeyCount;
   }
   return CallNextHookEx(hKeyboardHook, code, wParam, lParam);
}

//
// mouse hook
//
LRESULT CALLBACK MouseProc(int code,       // hook code
                           WPARAM wParam,  // message identifier
                           LPARAM lParam)  // mouse coordinates
{
   switch (wParam)
   {
   case WM_LBUTTONDOWN :
   case WM_MBUTTONDOWN :
   case WM_RBUTTONDOWN :
   case WM_LBUTTONDBLCLK :
   case WM_MBUTTONDBLCLK :
   case WM_RBUTTONDBLCLK :
      ++iKeyCount;
      break;
   }
   return CallNextHookEx(hMouseHook, code, wParam, lParam);
}

//
// install keyboard/mouse hooks
//
void KBM_API InstallHooks(void)
{
   hKeyboardHook = SetWindowsHookEx(WH_KEYBOARD, KeyboardProc, hInstance, 0);
   hMouseHook = SetWindowsHookEx(WH_MOUSE, MouseProc, hInstance, 0);
}

//
// remove keyboard/mouse hooks
//
void KBM_API RemoveHooks(void)
{
   UnhookWindowsHookEx(hKeyboardHook);
   UnhookWindowsHookEx(hMouseHook);
   hKeyboardHook = hMouseHook = 0;
}

//
// retrieve number of keystrokes
//
int KBM_API FetchKeyCount(bool bClear)
{
   int kc = iKeyCount;
   if (bClear)
      iKeyCount = 0;
   return kc;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T11:40:01.053

避免使用代码项目示例。（大量的错误，MSDN 的坏副本）

查看 MSDN 上关于 hooks 的大量完整示例（MSDN、SDK、KB 等）

而且您不需要任何 DLL，只需使用 LL 挂钩

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-02-24T01:38:27.043

对于仅用于热键的 Glopbal Keyboard Hook，然后 **注册热键**是最好的（由 Microsoft 完成）：

[https://msdn.microsoft.com/en-us/library/windows/desktop/ms646309(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms646309(v=vs.85).aspx)

下载示例 winform 应用程序并亲自查看：

[https://code.msdn.microsoft.com/CppRegisterHotkey-7bd897a8](https://code.msdn.microsoft.com/CppRegisterHotkey-7bd897a8) C++ [https://code.msdn.microsoft.com/CSRegisterHotkey-e3f5061e](https://code.msdn.microsoft.com/CSRegisterHotkey-e3f5061e) C# [https://code.msdn.microsoft.com/VBRegisterHotkey-50af3179](https://code.msdn.microsoft.com/VBRegisterHotkey-50af3179) VB.Net

**Winform 应用程序：**

```
/****************************** Module Header ******************************\
* Module Name:  MainForm.cs
* Project:      CSRegisterHotkey
* Copyright (c) Microsoft Corporation.
* 
* This is the main form of this application. It is used to initialize the UI 
* and handle the events.
* 
* This source is subject to the Microsoft Public License.
* See http://www.microsoft.com/opensource/licenses.mspx#Ms-PL.
* All other rights reserved.
* 
* THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, 
* EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED 
* WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
\***************************************************************************/

using System;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace CSRegisterHotkey
{
    public partial class MainForm : Form
    {
        HotKeyRegister hotKeyToRegister = null;
        Keys registerKey = Keys.None;
        KeyModifiers registerModifiers = KeyModifiers.None;

        public MainForm()
        {
            InitializeComponent();
        }

        /// <summary>
        /// Handle the KeyDown of tbHotKey. In this event handler, check the pressed keys.
        /// The keys that must be pressed in combination with the key Ctrl, Shift or Alt,
        /// like Ctrl+Alt+T. The method HotKeyRegister.GetModifiers could check whether 
        /// "T" is pressed.
        /// </summary>
        private void tbHotKey_KeyDown(object sender, KeyEventArgs e)
        {
            // The key event should not be sent to the underlying control.
            e.SuppressKeyPress = true;

            // Check whether the modifier keys are pressed.
            if (e.Modifiers != Keys.None)
            {
                Keys key = Keys.None;
                KeyModifiers modifiers = HotKeyRegister.GetModifiers(e.KeyData, out key);

                // If the pressed key is valid...
                if (key != Keys.None)
                {
                    this.registerKey = key;
                    this.registerModifiers = modifiers;

                    // Display the pressed key in the textbox.
                    tbHotKey.Text = string.Format("{0}+{1}",
                        this.registerModifiers, this.registerKey);

                    // Enable the button.
                    btnRegister.Enabled = true;
                }
            }
        }

        /// <summary>
        /// Handle the Click event of btnRegister.
        /// </summary>
        private void btnRegister_Click(object sender, EventArgs e)
        {
            try
            {
                // Register the hotkey.
                hotKeyToRegister = new HotKeyRegister(this.Handle, 100,
                    this.registerModifiers, this.registerKey);

                // Register the HotKeyPressed event.
                hotKeyToRegister.HotKeyPressed += new EventHandler(HotKeyPressed);

                // Update the UI.
                btnRegister.Enabled = false;
                tbHotKey.Enabled = false;
                btnUnregister.Enabled = true;
            }
            catch (ArgumentException argumentException)
            {
                MessageBox.Show(argumentException.Message);
            }
            catch (ApplicationException applicationException)
            {
                MessageBox.Show(applicationException.Message);
            }
        }

        /// <summary>
        /// Show a message box if the HotKeyPressed event is raised.
        /// </summary>
        void HotKeyPressed(object sender, EventArgs e)
        {
           //Here is the magic!!!!!!!!'

           //DO SOMETHING COOL!!! Or Just activate this winform

            if (this.WindowState == FormWindowState.Minimized)
            {
                this.WindowState = FormWindowState.Normal;
            }
            this.Activate();

        }

        /// <summary>
        /// Handle the Click event of btnUnregister.
        /// </summary>
        private void btnUnregister_Click(object sender, EventArgs e)
        {
            // Dispose the hotKeyToRegister.
            if (hotKeyToRegister != null)
            {
                hotKeyToRegister.Dispose();
                hotKeyToRegister = null;
            }

            // Update the UI.
            tbHotKey.Enabled = true;
            btnRegister.Enabled = true;
            btnUnregister.Enabled = false;
        }

        /// <summary>
        /// Dispose the hotKeyToRegister when the form is closed.
        /// </summary>
        protected override void OnClosed(EventArgs e)
        {
            if (hotKeyToRegister != null)
            {
                hotKeyToRegister.Dispose();
                hotKeyToRegister = null;
            }

            base.OnClosed(e);
        }
    }
} 
```

**热键寄存器.cs**

```
/****************************** Module Header ******************************\
* Module Name:  HotKeyRegister.cs
* Project:      CSRegisterHotkey
* Copyright (c) Microsoft Corporation.
* 
* This class imports the method RegisterHotKey and UnregisterHotKey in 
* user32.dll to define or free a system-wide hot key.
* 
* The method Application.AddMessageFilter is used to add a message filter to 
* monitor Windows messages as they are routed to their destinations. Before a 
* message is dispatched, the method PreFilterMessage could handle it. If a 
* WM_HOTKEY messages was generated by the hot key that was registered by this 
* HotKeyRegister object, then raise a HotKeyPressed event.
* 
* This class also supplies a static method GetModifiers to get the modifiers 
* and key from the KeyData property of KeyEventArgs.
* 
* This source is subject to the Microsoft Public License.
* See http://www.microsoft.com/opensource/licenses.mspx#Ms-PL.
* All other rights reserved.
* 
* THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, 
* EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED 
* WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
\***************************************************************************/

using System;
using System.Runtime.InteropServices;
using System.Windows.Forms;
using System.Security.Permissions;

namespace CSRegisterHotkey
{
    public class HotKeyRegister : IMessageFilter, IDisposable
    {
        /// <summary>
        /// Define a system-wide hot key.
        /// </summary>
        /// <param name="hWnd">
        /// A handle to the window that will receive WM_HOTKEY messages generated by the
        /// hot key. If this parameter is NULL, WM_HOTKEY messages are posted to the 
        /// message queue of the calling thread and must be processed in the message loop.
        /// </param>
        /// <param name="id">
        /// The identifier of the hot key. If the hWnd parameter is NULL, then the hot 
        /// key is associated with the current thread rather than with a particular 
        /// window. 
        /// </param>
        /// <param name="fsModifiers">
        /// The keys that must be pressed in combination with the key specified by the 
        /// uVirtKey parameter in order to generate the WM_HOTKEY message. The fsModifiers
        /// parameter can be a combination of the following values.
        /// MOD_ALT     0x0001
        /// MOD_CONTROL 0x0002
        /// MOD_SHIFT   0x0004
        /// MOD_WIN     0x0008
        /// </param>
        /// <param name="vk">The virtual-key code of the hot key.</param>
        [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern bool RegisterHotKey(IntPtr hWnd, int id, 
            KeyModifiers fsModifiers, Keys vk);

        /// <summary>
        /// Frees a hot key previously registered by the calling thread. 
        /// </summary>
        /// <param name="hWnd">
        /// A handle to the window associated with the hot key to be freed. This parameter
        /// should be NULL if the hot key is not associated with a window.
        /// </param>
        /// <param name="id">
        /// The identifier of the hot key to be freed. 
        /// </param>
        [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern bool UnregisterHotKey(IntPtr hWnd, int id);

        /// <summary>
        /// Get the modifiers and key from the KeyData property of KeyEventArgs.
        /// </summary>
        /// <param name="keydata">
        /// The KeyData property of KeyEventArgs. The KeyData is a key in combination
        /// with modifiers.
        /// </param>
        /// <param name="key">The pressed key.</param>
        public static KeyModifiers GetModifiers(Keys keydata, out Keys key)
        {
            key = keydata;
            KeyModifiers modifers = KeyModifiers.None;

            // Check whether the keydata contains the CTRL modifier key.
            // The value of Keys.Control is 131072.
            if ((keydata & Keys.Control) == Keys.Control)
            {
                modifers |= KeyModifiers.Control;

                key = keydata ^ Keys.Control;
            }

            // Check whether the keydata contains the SHIFT modifier key.
            // The value of Keys.Control is 65536.
            if ((keydata & Keys.Shift) == Keys.Shift)
            {
                modifers |= KeyModifiers.Shift;
                key = key ^ Keys.Shift;
            }

            // Check whether the keydata contains the ALT modifier key.
            // The value of Keys.Control is 262144.
            if ((keydata & Keys.Alt) == Keys.Alt)
            {
                modifers |= KeyModifiers.Alt;
                key = key ^ Keys.Alt;
            }

            // Check whether a key other than SHIFT, CTRL or ALT (Menu) is pressed.
            if (key == Keys.ShiftKey || key == Keys.ControlKey || key == Keys.Menu)
            {
                key = Keys.None;
            }

            return modifers;
        }

        /// <summary>
        /// Specify whether this object is disposed.
        /// </summary>
        bool disposed = false;

        /// <summary>
        /// This constant could be found in WinUser.h if you installed Windows SDK.
        /// Each windows message has an identifier, 0x0312 means that the mesage is 
        /// a WM_HOTKEY message.
        /// </summary>
        const int WM_HOTKEY = 0x0312;

        /// <summary>
        /// A handle to the window that will receive WM_HOTKEY messages generated by the
        /// hot key.
        /// </summary>
        public IntPtr Handle { get; private set; }

        /// <summary>
        /// A normal application can use any value between 0x0000 and 0xBFFF as the ID 
        /// but if you are writing a DLL, then you must use GlobalAddAtom to get a 
        /// unique identifier for your hot key. 
        /// </summary>
        public int ID { get; private set; }

        public KeyModifiers Modifiers { get; private set; }

        public Keys Key { get; private set; }

        /// <summary>
        /// Raise an event when the hotkey is pressed.
        /// </summary>
        public event EventHandler HotKeyPressed;

        public HotKeyRegister(IntPtr handle, int id, KeyModifiers modifiers, Keys key)
        {
            if (key == Keys.None || modifiers == KeyModifiers.None)
            {
                throw new ArgumentException("The key or modifiers could not be None.");
            }

            this.Handle = handle;
            this.ID = id;
            this.Modifiers = modifiers;
            this.Key = key;

            RegisterHotKey();

            // Adds a message filter to monitor Windows messages as they are routed to
            // their destinations.
            Application.AddMessageFilter(this);
        }

        /// <summary>
        /// Register the hotkey.
        /// </summary>
        private void RegisterHotKey()
        {
            bool isKeyRegisterd = RegisterHotKey(Handle, ID, Modifiers, Key);

            // If the operation failed, try to unregister the hotkey if the thread 
            // has registered it before.
            if (!isKeyRegisterd)
            {
                // IntPtr.Zero means the hotkey registered by the thread.
                UnregisterHotKey(IntPtr.Zero, ID);

                // Try to register the hotkey again.
                isKeyRegisterd = RegisterHotKey(Handle, ID, Modifiers, Key);

                // If the operation still failed, it means that the hotkey was already 
                // used in another thread or process.
                if (!isKeyRegisterd)
                {
                    throw new ApplicationException("The hotkey is in use");
                }
            }
        }

        /// <summary>
        /// Filters out a message before it is dispatched.
        /// </summary>
        [PermissionSetAttribute(SecurityAction.LinkDemand, Name = "FullTrust")]
        public bool PreFilterMessage(ref Message m)
        {
            // The property WParam of Message is typically used to store small pieces 
            // of information. In this scenario, it stores the ID.
            if (m.Msg == WM_HOTKEY
                && m.HWnd == this.Handle
                && m.WParam == (IntPtr)this.ID
                && HotKeyPressed != null)
            {
                // Raise the HotKeyPressed event if it is an WM_HOTKEY message.
                HotKeyPressed(this, EventArgs.Empty);

                // True to filter the message and stop it from being dispatched.
                return true;
            }

            // Return false to allow the message to continue to the next filter or 
            // control.
            return false;
        }

        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }

        /// <summary>
        /// Unregister the hotkey.
        /// </summary>
        protected virtual void Dispose(bool disposing)
        {
            // Protect from being called multiple times.
            if (disposed)
            {
                return;
            }

            if (disposing)
            {

                // Removes a message filter from the message pump of the application.
                Application.RemoveMessageFilter(this);

                UnregisterHotKey(Handle, ID);
            }

            disposed = true;
        }
    }
} 
```

**KeyModifiers.cs：**

```
/****************************** Module Header ******************************\
* Module Name:  KeyModifiers.cs
* Project:      CSRegisterHotkey
* Copyright (c) Microsoft Corporation.
* 
* This enum defines the modifiers to generate the WM_HOTKEY message. 
* See http://msdn.microsoft.com/en-us/library/ms646309(VS.85).aspx.
* 
* This source is subject to the Microsoft Public License.
* See http://www.microsoft.com/opensource/licenses.mspx#Ms-PL.
* All other rights reserved.
* 
* THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, 
* EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED 
* WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE.
\***************************************************************************/

using System;

namespace CSRegisterHotkey
{
    [Flags]
    public enum KeyModifiers
    {
        None = 0,
        Alt = 1,
        Control = 2,
        Shift = 4,

        // Either WINDOWS key was held down. These keys are labeled with the Windows logo.
        // Keyboard shortcuts that involve the WINDOWS key are reserved for use by the 
        // operating system.
        Windows = 8
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T02:03:01.797

重新阅读 Win32 指南中的钩子介绍。[（这里](http://msdn.microsoft.com/en-us/library/ms644959(VS.85).aspx)是一个很好的起点。）

具体来说，如果你想钩住其他进程中的事件，你需要将你的回调放在一个DLL中，该DLL由Win32[注入到其他进程中。](http://en.wikipedia.org/wiki/DLL_injection)从您提供的代码中，我无法判断 KeyboardProc 是在 DLL 中还是在主程序中。考虑到您要通过的 HIINSTANCE，它看起来不像。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T02:03:50.593

当我编写“画中画”之类的应用程序时，我不得不处理全局挂钩。这篇文章和示例代码极大地帮助了我：

[http://www.codeproject.com/KB/system/WilsonSystemGlobalHooks.aspx](http://www.codeproject.com/KB/system/WilsonSystemGlobalHooks.aspx)

# language-agnostic - 引用其他人的代码

> ID：454494
> 
> 赞同：9
> 
> 时间：2009-01-18T02:04:14.773
> 
> 标签：language-agnostic

我目前正在写我的学士学位论文。这涉及开发一个软件产品和一篇 12000 字的文章，主要涵盖研究、设计和开发。现在我在引用其他人的书面作品时，显然是在引用这个，但是代码呢？有很多次我一直在寻找一个我不确定的问题的解决方案，并找到了解决这个问题的人。大多数时候，我获取他们的代码，努力了解他们在做什么，然后在我的应用程序中编写我自己的版本，那么是否应该以某种方式引用它？

你们会怎么做，在引用原作者的代码中添加注释，在文章或我的参考书目中添加引用，或者什么都不做？如果使用了一段重要或有趣的代码，我可能会在我的文章中提及它，但是对于不保证这一点的解决方案，我正在尝试提出一个好的解决方案。

如果您是我使用过或受其启发的某些代码的作者，您会因为我没有抄袭您而感到高兴吗？

更进一步，这里有两件不同的事情。如果我去 MSDN 查找如何使用 .net 框架的特定部分，是应该引用的东西，还是该框架的合理使用。好像我使用了某人明确开发并投入大量时间的算法，这是我肯定会参考的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T02:14:44.033

这一切都取决于上下文。许多算法是如此众所周知，以至于它们通常被认为是公共领域，只要您引用该主题的知名来源，那么您就不必担心（排序，搜索）

在处理特定问题时，尤其是在其他人的代码中，您必须非常仔细地阅读。如果它已出版（书籍、期刊、网络等），那么您**必须始终**在您的论文中的某个时间点参考原件（从技术上讲，先写一次，然后在源中发表评论）

如果是其他人的工作，他们*应该得到应有*的*赞誉*。其他都是**抄袭**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T02:15:55.000

这有两个方面：

1.  您的学术机构的引用要求。你应该确保你遵守了这一点，因为如果你被发现剽窃了别人的作品，你可能会犯有学术不端行为，你不希望这样；和
2.  The ethics of using another's work. Barring "fair use" provisions (meaning there's only so much of someone's work you can reproduce before what you're doing is no longer "fair use") and the like, if you reproduce someone else's code, that you should credit. If you simply take the idea, that's possibly a bit different and is a judgement call. It depends on the significance of that idea and it's contribution to your work.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T02:16:29.757

在学术工作之外，如果我参考其他人来解决特定问题，我会养成在源代码中留下评论的习惯。这也是为了我的利益，几个月后我可能想回去再看看他们的代码，却忘记了我最初在哪里找到它。当然，当你引用某人的代码时，看看包含的许可证，应该很清楚你不能用它做什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T02:49:53.153

如果借用工作代码是工作的最佳工具，只要作者的许可条件允许，借用工作代码就没有什么可耻的——真正的程序员一直都在这样做。但是出于学术目的，如果您可能被认为对此完全保密或具有欺骗性，就会出现问题。为避免这种情况，我会在代码中用大而清晰的注释和报告中引用它。完全披露意味着您不能被指控做错任何事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T03:14:51.043

我的论文也有同样的问题：我选择引用而不过度。添加对被引用部分的引用，意味着您已经搜索、找到了一些东西、考虑使用它并接受了它，而一无所有意味着您编造了它。这增加了你的工作在学术背景下的价值（你基于以前的工作越多越好）。此外，您的主管将能够在引用的站点上跟踪许可证和算法问题。最后你不知道你的工作会到达哪里。假设在今天之后的 3 年里，有人试图使用它，却陷入了专利侵权？你怎么能帮助他-通过参考...

# null - 更新空值

> ID：454496
> 
> 赞同：1
> 
> 时间：2009-01-18T02:06:16.377
> 
> 标签：null, updating

我正在尝试生成数据层模板。当我进行选择、更新和插入时，我的想法是让模板与所有列一起使用，因为我不知道哪些列包含值。问题是我可能有一个更新状态，如 cmd.Parameters.AddWithValue("@Field", this.Field); 如果该值为空，则查询将不会执行。我怎样才能解决这个问题？

更新：

我试过了？？解决方案，但我收到错误 Operator ?? 不能应用于操作数 string（或 int）和 System.DBNull。它似乎仅在该字段实际上为空时才有效，但如果它有值则无效。然后我尝试将类型（对象）DBNull 放在 DBNull 前面，但仍然没有。

将（对象）添加到该字段有效！

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-18T02:15:22.223

```
cmd.Parameters.AddWithValue("@Field", this.Field ?? DBNull.Value); 
```

?? 是C#中的[合并运算符。](http://msdn.microsoft.com/en-us/library/ms173224.aspx)

# asp.net-mvc - IIS7、SQL 2008 和 ASP.NET MVC 安全性

> ID：454497
> 
> 赞同：17
> 
> 时间：2009-01-18T02:06:17.530
> 
> 标签：asp.net-mvc, security, sql-server-2008, iis-7

我有一个正在开发的 ASP.NET MVC 应用程序。我一直在使用 IIS6 和 SQL 2008 Express 在 Windows Server 2003 上开发它，一切都运行良好。我最近决定试用 Windows 7 测试版，所以现在我使用的是 IIS7，但在连接到我的数据库时遇到了我似乎无法弄清楚的问题。

我可以很好地运行/调试应用程序，但是每当我尝试访问需要访问数据库的页面时，我都会收到以下错误：

“无法打开登录请求的数据库“MyDatabaseName”。登录失败。用户“IIS APPPOOL\MyApplicationName”登录失败。”

我显然有一些安全配置设置不正确，但我似乎找不到任何关于*如何*正确设置的好的文档。我已经尝试在数据库上授予 NETWORK SERVICE 权限，但这似乎不起作用。任何人都知道我需要做些什么来给这个数据库“IIS APPPOOL\MyApplicationName”权限？我错过了一些明显的东西吗？

谢谢...

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-10-19T16:17:08.303

如果您不使用 Active Directory，请忽略此处提到的所有其他解决方案。混乱源于`ApplicationPoolIdentity`IIS 7.5+ 中的新设置默认值（MS 不断更改身份机制）

1.  打开**SQL Management Studio**，以管理员身份连接到本地计算机。
2.  展开**安全**分支。
3.  右键单击**登录**并选择**新登录**
4.  在**登录名字**段中，输入“ **IIS APPPOOL\MyApplicationName** ”。不要*点击*搜索按钮。用户配置文件实际上并不存在于本地计算机上，它是按需动态创建的。

在查看它时，不要忘记将用户添加到数据库或服务器角色。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-23T10:34:17.313

该错误意味着 Web 应用程序无权访问您的数据库。在 Windows 7 / IIS 7 上，默认情况下每个应用程序池都有自己的用户。似乎这个想法是通过限制 Web 应用程序可以做的事情来提高安全性（以防它被外部破坏和控制）。您可以更改应用程序池在哪个用户下运行，但这会破坏它自己的目的。一种更好的方法似乎是为池的用户提供所需的权限（而不是更多）。

在 SQL Management Studio 上，连接到您希望 Web 应用程序连接的服务器（使用 SQL Server 2008 测试）。去

```
Security -> Log ins 
```

右键单击，新建登录。在出现的表单中，除了用户名之外的所有内容都保留为默认值，您必须在其中键入 Web 应用程序尝试使用的任何用户名，在本例中为“IIS APPPOOL\MyApplicationName”。请注意，该对话框的搜索功能无法找到或检查该用户是否有效，但它仍然有效。

仍然在连接到服务器的 SQL Management Studio 上转到

```
Databases -> *YOUR-DATABASE* -> Security -> Users 
```

右键单击并新建用户。我不确定那里的用户名字段是否有任何影响，我只是将它设置为用户名的最后一部分，如 MyApplicationName。然后我将登录名设置为 IIS APPPOOL\MyApplicationName。您可以单击 ... 按钮并使用检查和搜索，这一次它可以工作。如果您不执行上一步，用户将不会出现在此处。然后给它任何你想要给这个用户的权限，比如 db_datareader。

就是这样，你已经给予了许可。如果缺少权限是您的问题，那么它应该被解决（或者至少，我刚刚以这种方式解决了它）。

**我在 IIS 方面总共有 2 小时的经验，在 SQL Server 方面有大约三周的经验，在 Microsoft 技术方面的经验还不到两个月，所以请接受我的建议，我可能完全错了**。（如果其他人可以确认这些是正确的步骤，请随时删除最后的警告）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T07:29:08.980

这是一篇解释为什么要使用 AppPoolIdentities 的文章；基本上，它是关于增强安全性：[http ://learn.iis.net/page.aspx/624/application-pool-identities/](http://learn.iis.net/page.aspx/624/application-pool-identities/)

（那篇文章声称我可以像使用任何常规帐户一样使用这些虚拟帐户，但在我的 Windows Server 2008 上这似乎是不可能的；添加例如 IIS AppPool\DefaultAppPool 只会产生错误：“以下对象不是来自列出的域在“选择位置”对话框中，因此无效。”）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-27T00:41:44.057

Erick Falsken 是对的，但是他缺少用户映射。因此，右键单击新的 IIS APPPOOL/DefaultAppPool，单击属性，然后选中以下复选框：1) 数据库 master 和 yourdatabase 2) db_owner 和 public

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-18T02:24:41.597

此错误通常意味着您的站点正在运行的用户（或更确切地说是应用程序池）没有使用数据库的权限。您可以在 IIS 中检查池在哪个用户下运行并授予他们权限，或者将您的 SQL 连接字符串更改为不使用受信任的身份验证并提供在连接字符串中具有权限的用户的凭据。

编辑：如果您右键单击池标识部分并转到属性，它应该会出现一个框，让您可以从 3 个内置系统帐户中进行选择，或者指定您自己的帐户。要么授予数据库的内置帐户权限之一，要么使用具有权限的帐户。或者保持原样并更改您的连接字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-18T04:51:08.947

好吧...更改 ApplicationPoolIdentity 属性并将其设置为 NETWORK SERVICE 似乎解决了我的问题。不确定这是否是“正确”的做事方式（例如，我不确定这是否是在 IIS7 中做事的推荐方式），但它似乎至少可以工作并且已经让我过去了这个挂断了。谢谢。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-18T17:17:07.513

第一步是验证您的网站在哪个帐户下运行。创建一个简单的 aspx 页面：

```
<%@ Page Language="C#" %>
<% Response.Write(System.Security.Principal.WindowsIdentity.GetCurrent().Name); %> 
```

如果您使用 Windows 身份验证，WindowsIdentity 帐户将需要在您的 SQL Server 中登录。在 Security -> Logins -> Login New 下，您需要添加 WindowsIdentity 显示的任何名称，并确保选择了 Windows 身份验证。

如果您碰巧将数据库移动到单独的计算机上，则必须创建域帐户并在 web.config 中使用模拟。谷歌`<identity impersonate="true">`了解更多信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-18T20:26:00.643

我熟悉授予应用程序在其下运行的用户权限的想法......我的问题是在 IIS7 中，“用户”似乎是虚拟的或类似的奇怪东西。在我将应用程序池属性的“身份”属性更改为网络服务之前，它被设置为“应用程序池身份”，我得到的错误是“IIS APPPOOL\MyApplicationName”没有访问数据库的权限。当我尝试将“IIS APPPOOL\MyApplicationName”*用户*添加到数据库时，它似乎不存在......无论如何我都找不到。

所以我的最终问题是不理解或无法找到关于 IIS7 安全模型如何工作的任何好的文档。当我创建应用程序时，它似乎为这个应用程序创建了一个同名的 AppPool。考虑到 AppPool 运行的用户似乎*实际上并不*存在，我不确切知道我需要进行哪些更改才能赋予应用程序和/或它在数据库特权下运行的用户。

正如我所提到的，将 AppPool 的 Identity 更改为 NETWORK SERVICE 目前似乎已经奏效，但我试图找出在 IIS7 下这种事情的最佳实践是什么。谢谢。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-19T08:41:19.987

把难题留给别人——

创建一个 sql 用户并使用 SQL Auth。:D

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-02T03:04:13.613

如果你听从费尔南德斯先生的建议，一切都会顺利进行。这是赋予站点最小权限的新方法。

所以不要做简单的、不太安全的事情（网络服务）。做正确的事。向上滚动。;)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-09-27T13:48:46.993

在 Windows 身份验证模式下使用可信连接：操作系统：windows 7 32 位 IIS 7，Sql Server 2008 R2 Express 连接字符串：cn.open "Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=test ;数据源=mycomputername\sqlexpress;" （如果实例名称是 sqlexpress 或您使用的任何实例名称）

如果您无法使用 Windows 模式身份验证连接到 sql server 2008 连接 sql server。

NT AUTHORITY\IUSR 帐户可能在 sql server 中没有权限授权与数据库的连接。

使用windows认证方式连接Sql server。展开安全节点。选择 NT AUTHORITY\IUSR（如果没有，则添加新的登录）在登录属性窗口的选择页面下单击“用户映射”。选择您尝试连接的数据库。从“数据库角色成员资格中选择以下权限：......” 1\. db_datareader '这允许打开连接 2\. db_datawriter '这允许从数据表中获取数据记录

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-31T23:28:05.090

如果您查看该字段的描述，它会指出在“网络服务”帐户下运行是推荐使用的帐户。不知道为什么在 Win7 中它默认为 ApplicationPoolIdentity 设置。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-25T18:02:51.570

我有完全相同的问题。我正在运行 Windows 7 RC。当我尝试使用 .mdf 文件（位于 App_Data 中）时，现在有办法让这件事发挥作用。我确实尝试为 LocalSystem 更改 AppPool 的标识，但它根本不起作用。

如果我使用“标准”数据库，那么如果我使用 LocalSystem，它将可以工作，但它不适用于著名的 'IIS APPPOOL\DefaultAppPool'。

我发现没有找到任何关于这件事的信息有点令人不安，如果您使用任何类型的数据库，“IIS APPPOOL\DefaultAppPool”用户似乎完全没用......

正如 ryexley 所说，我正在运行它，但我也对不了解安全模型感到有点沮丧。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-12-07T07:07:41.807

我在（安装在独立 Win-server2003 服务器上的 SQL2008）和（安装在独立 Win-server2003 服务器上的带有 ASP.NET3.5 的 IIS6）之间遇到了同样的问题。

其中，IIS 尝试使用域“域\用户名”中的某个用户访问 SQL2008。

我从连接字符串中删除了以下选项，现在一切正常。

```
Integrated Security=True; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-14T02:52:48.753

是的，应用程序池标识方法不像他们说的那样工作（无论如何都不是在 IIS7 中）。我认为 MS 的黑客故意使这种安全性变得复杂，因此您选择阻力最小的路径并使您的系统不那么安全（因此他们以后可以入侵它）。- 开个玩笑，但实际上，他们的安全模型是纯粹的疯狂，在 MSDN 上的任何地方都没有直接（逐步）的说明 - nada，zip！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-02-10T09:42:53.887

1.  打开**SQL Management Studio**，以管理员身份连接到本地计算机。
2.  展开**安全**分支。
3.  右键单击**登录**并选择**新登录**
4.  在**登录名字**段中，输入“ **IIS APPPOOL\MyApplicationName** ”。不要点击搜索按钮。用户配置文件实际上并不存在于本地计算机上，它是按需动态创建的。
5.  在**用户映射**中选择**数据库**
***   在**服务器角色**中选择**sysadmin****

 ****# java - 在图像中查找图像

> ID：454498
> 
> 赞同：6
> 
> 时间：2009-01-18T02:07:16.810
> 
> 标签：java, python, image

我正在寻找在另一个图像中检测图像的最佳方法。我有一张小图像，想找到它出现在更大图像中的位置 - 这实际上是屏幕截图。从概念上讲，它就像一个“沃尔多在哪里？” 在更大的图像中进行搜索。

有没有有效/快速的方法来实现这一点？速度比记忆更重要。

编辑：

“内部”图像可能并不总是具有相同的比例，但会具有相同的旋转。

假设图像将完美地包含在另一个像素中，这是不安全的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T02:40:21.393

维基百科有一篇关于[模板匹配](http://en.wikipedia.org/wiki/Template_matching)的文章，带有示例代码。

（虽然该页面不处理更改的比例，但它具有指向其他匹配样式的链接，例如[Scale invariant feature transform](http://en.wikipedia.org/wiki/Scale-invariant_feature_transform)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T02:50:12.340

如果还必须考虑旋转，则可以使用[广义霍夫变换。](http://homepages.inf.ed.ac.uk/rbf/HIPR2/hough.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T02:11:56.177

您可以将此视为子字符串问题，其中字母表中的字符是像素，您的字符串是图像。您还需要使用与换行符类似的特殊字符来表示图像边界。

您想要的算法在维基百科上：[http ://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm](http://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm)

**更新：**如果您不能假设图像完全包含在另一个像素中，那么这种方法将不起作用。

还有其他更复杂的算法基于与上述相同的动态规划概念，但除非必要，否则我不会深入探讨它们。

# javascript - 带有表格行的 Javascript Onclick

> ID：454517
> 
> 赞同：3
> 
> 时间：2009-01-18T02:19:27.847
> 
> 标签：javascript, onclick, dom-events

我的 JScript 代码有问题。我正在尝试遍历表中的所有行并添加一个`onclick`事件。我可以`onclick`添加事件，但有几个问题。

第一个问题是所有行最终都设置了错误的`onclick`事件参数。

第二个问题是它只适用于 IE。

这是代码摘录：

```
shanesObj.addTableEvents = function(){
table = document.getElementById("trackerTable");
for(i=1; i<table.getElementsByTagName("tr").length; i++){
    row = table.getElementsByTagName("tr")[i];
    orderID = row.getAttributeNode("id").value;
    alert("before onclick: " + orderID);
    row.onclick=function(){shanesObj.tableRowEvent(orderID);};
}}

shanesObj.tableRowEvent = function(orderID){
alert(orderID);} 
```

该表位于以下位置...

[http://www.blackcanyonsoftware.com/OrderTracker/testAJAX.html](http://www.blackcanyonsoftware.com/OrderTracker/testAJAX.html)

每一行的id依次是... 95, 96, 94...

出于某种原因，当`shanesObj.tableRowEvent`被调用时，`onclick`将为所有具有最后一个值 id 的行设置在循环 (94) 上经过迭代的所有行。

我在页面上添加了一些警报来说明问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T05:51:46.483

当在 javascript 中调用函数时，首先发生的事情是解释器将作用域链设置为定义函数时的状态。在您的情况下，范围链如下所示：

```
   全球的
     |
调用 addTableEvents
     |
CALL onclick

```

因此，当javascript 解释器偶然发现变量*orderID时，它会在范围链中搜索该变量。*您的*onclick*函数内没有定义*orderID*，因此下一个要查看的位置是*addTableEvents*内。你会认为*orderID*是在这里定义的，但由于你没有使用 var 关键字声明*orderID*，*orderID*变成了一个全局变量，所以在*addTableEvents*中找不到*orderID*。最后一个要查看的位置在 GLOBAL 内部，果然它在那里，它的值是它被分配的最后一个值，在这种情况下它的最后一个值********orderID = row.getAttributeNode("id").value;* 在 for 循环中。*******

 **要更清楚地看到这一点，请查看以下内容

```
shanesObj.addTableEvents = function(){
table = document.getElementById("trackerTable");
for(i=1; i<table.getElementsByTagName("tr").length; i++){
        row = table.getElementsByTagName("tr")[i];
        orderID = row.getAttributeNode("id").value;
        alert("before onclick: " + orderID);
        row.onclick=function(){var orderID = orderID; shanesObj.tableRowEvent(orderID);};
}
orderID = -1;
}

shanesObj.tableRowEvent = function(orderID){
alert(orderID);
} 
```

单击此处的结果将始终为-1。

所以，为了解决这个问题，我建议你删除所有额外的和不需要的代码，并使用类似下面的代码，

```
for(i=1; i<table.getElementsByTagName("tr").length; i++){
        row = table.getElementsByTagName("tr")[i];
        row.onclick=function(){shanesObj.tableRowEvent(this.id);};

} 
```

只需直接从被调用对象访问 id 属性即可。

PS 我不知道为什么你的代码在 IE 中不起作用（它在我的 IE7 中起作用）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T02:53:12.817

为什么不将事件处理程序附加到表并获取在单击处理程序内触发单击事件的单元格的行索引。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-03-21T10:11:17.977

你不能比这更简单！
显然可以与动态构建的行一起使用。
很多的爱，
某人。

```
<html>

<head>
<title></title>
<script language="JavaScript" type="text/javascript">
<!--
var TO,URL;
function Link(url){
 URL=url;
 TO=setTimeout('window.location=URL;',500);
}
//-->
</script>
</head>

<body>

<tr onclick="Link('anotherpage.html');">
<td>row1 cell1</td>
<td>row1 cell2</td>
</tr>

<tr onclick="Link('yetanotherpage.html');">
<td>row2 cell3</td>
<td>row2 cell4</td>
</tr>

</body>

</html> 
```

# c# - 实现 IDisposable 接口的目的是什么？

> ID：454521
> 
> 赞同：4
> 
> 时间：2009-01-18T02:25:01.423
> 
> 标签：c#, idisposable

实现 IDisposable 接口的目的是什么？我已经看到一些实现它的类，但我不明白为什么。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-18T02:27:20.640

如果您的类创建了非托管资源，那么您可以实现 IDisposable 以便在处理对象时正确清理这些资源。您覆盖 Dispose 并在那里释放它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T02:31:49.600

当你的类使用一些系统资源时，确保资源也被释放是类的责任。通过 .Net 设计，您应该在类的 Dispose 方法中执行此操作。IDisposable 接口标记您的类在不再使用时需要释放资源，并且 Dispose 方法可用，以便您的类的用户可以调用它来释放消耗的资源。

如果您希望自动清理正常工作并希望使用 using() 语句，则 IDisposable 方法也是必不可少的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-18T04:16:01.450

除了释放非托管资源外，对象在超出范围时还可以有效地执行某些操作。一个有用的示例可能是计时器对象：此类对象可以打印出自在 Dispose() 方法中构造它们以来经过的时间。然后可以使用这些对象记录一组操作所花费的大致时间：

```
using(Timer tmr=new Timer("blah"))
{
    // do whatever
} 
```

当然，这可以手动完成，但我的感觉是，应该尽可能利用编译器自动生成正确代码的能力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-18T02:36:15.690

这一切都与垃圾收集机制有关。[Chris Sells 描述了 .NET Rocks 第 10 集的](http://www.dotnetrocks.com/default.aspx?showNum=10)垃圾收集、终结器以及 Dispose 模式（和 IDisposable 接口）的原因！（开始大约 34 分钟）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-16T19:52:29.893

许多对象以如果不清理将导致问题的方式操纵其他实体。这些其他实体可能几乎是任何东西，它们可能几乎在任何地方。例如，一个 Socket 对象可能要求另一台机器打开一个 TCP 连接。另一台机器可能无法同时处理很多连接；事实上，它可能是一个网络设备，一次只能处理一个连接。如果一个程序要打开一个套接字然后忘记它，除非或直到套接字关闭（也许设备可能会在几分钟不活动后自行关闭套接字，但它在那之前是没用的）。

如果一个对象实现了 IDisposable，这意味着它具有执行必要的清理操作所需的知识和动力，并且需要在这些知识和动力丢失之前执行这些操作。调用 IDisposable.Dispose 将确保执行所有此类清理操作，从而可以安全地放弃对象。

Microsoft 允许对象通过注册一个名为 Finalize 的方法来请求保护以防止被遗弃。如果一个对象这样做了，如果系统检测到该对象已被放弃，则将调用 Finalize 方法。在 Finalize 方法有机会运行之前，不会从内存中删除该对象，也不会从内存中删除该对象及其直接或间接引用的任何对象。这提供了某种“后盾”，以防对象在没有首先被处置的情况下被放弃。然而，对于实现 Finalize 的对象有很多陷阱，因为无法保证何时调用它。不仅一个对象可能在 Finalize 被调用之前很长时间就被放弃了，而且如果一个人不小心，系统可能实际上在一个对象上调用 Finalize，而它的一部分仍在使用中。危险的东西。它'

# iphone - iPhone 配置文件问题

> ID：454525
> 
> 赞同：10
> 
> 时间：2009-01-18T02:31:22.970
> 
> 标签：iphone, deployment, certificate, provisioning

我的 iPhone 应用程序在模拟器中运行良好。我正在尝试将其部署到物理 iPhone 上。当我安装配置文件时，我的组织者说“在您的钥匙串中找不到与此配置文件匹配的签名身份。”

我无法解决这个问题。我该怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-18T04:31:29.280

A) 您是否在 iPhone 开发门户中创建了配置文件？

B) 如果是这样，info.plist 文件中的名称是否与您在门户中创建并用于创建该开发配置文件的 appID 匹配（即，如果您在info.plist 你会用“com.fredsgreatstuff”替换“com.mycompany”）

C）您是否在项目设置中为所有目标设置了 PRODUCT_NAME（类似于“mygreatapp”）

从错误的外观来看，您一定是开发证书错误，或者没有从上传开发人员签名请求后生成的门户下载证书。

门户在这一点上有很好的说明（以前不是这样），要非常小心地遵循每一步。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-09T18:08:24.297

这是一个非常好的网站，其中包含有关排除代码签名错误的清单：
[http ://www.drobnik.com/touch/2009/05/how-to-fix-code-signing-errors/](http://www.drobnik.com/touch/2009/05/how-to-fix-code-signing-errors/)

它的大部分内容都包含在上面的帖子中，但更容易完成。

FTR，我遇到了 Genericrich 指出的同样问题——我的开发配置文件没有私钥，但我的发行版有。作为一种解决方法，我刚刚将我的调试版本定义为也使用开发配置文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T08:36:05.490

确保您已从程序门户下载您的证书。双击它以在 Keychain Access 中创建一个私钥-公钥对。当您下载证书并双击它时，将创建私钥。

如果没有，您可能必须删除证书并创建一个新证书。确保在您创建的证书签名请求中，您的姓名与您在门户中提到的完全一致。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-07T06:52:04.227

可能是您安装证书的“钥匙串”当前未设置为“默认钥匙串”。当我的默认钥匙串以某种方式切换到不同的默认值时，我遇到了相同（或非常相似的问题）。

打开钥匙串访问（应用程序 -> 实用程序 -> 钥匙串访问）

在名为“钥匙串”的左上角列表框中，确保您安装开发者证书（通常是“登录”）的钥匙串仍然是粗体（即：设置为默认钥匙串）。

您可以通过右键（或控制）单击所需的钥匙串（例如“登录”）并选择“使钥匙串'xxx'默认”来设置默认钥匙串。

干杯。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-18T05:39:11.157

确保您在机器上安装了您的开发人员证书，并且您的私钥与它一起安装。您可以在 Utilities 文件夹中的 Keychain Access 工具中进行检查。证书应扩展为带有您姓名的私钥图标。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-13T08:20:34.620

我在 SL 上使用 Xcode 4.0 时遇到了同样的问题。

在管理器窗口中，对配置文件进行“拖放”总是会给出“未找到有效的签名身份”。

您必须使用 +（添加）图标并搜索您的配置文件以将其上传到您的设备上。它对我有用（无需重新安装所有东西）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-12-06T21:07:22.287

删除 Xcode 管理器中所有过期的配置文件对我有用。在此之后，我单击了管理器中的*刷新*按钮，并且配置文件已自动下载。

# mysql - 创建表语法错误

> ID：454533
> 
> 赞同：1
> 
> 时间：2009-01-18T02:37:37.327
> 
> 标签：mysql, database

我收到了 MySQL 数据转储，并试图将数据插入一组临时表中。第一个表的创建语句如下所示。当我运行它时，我收到错误：“ `You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''temp_books'( 'ID'int( 11 ) NOT NULL AUTO_INCREMENT, 'start'varchar( 20 ) ' at line 1`”。我已经检查了 MySQL 语法的文档，但我看不出问题出在哪里。

```
CREATE TABLE 'temp_books' (
  'ID' int(11) NOT NULL AUTO_INCREMENT,
  'start' varchar(20) NOT NULL,
  'customer_id' int(11) NOT NULL DEFAULT '0',
  'total_num' int(11) NOT NULL,
  'amount' double(5,2) NOT NULL DEFAULT '0.00',
  'changed' timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY ('ID'),
  UNIQUE KEY 'start' ('start')
) ENGINE=MyISAM AUTO_INCREMENT=4853 DEFAULT CHARSET=latin1; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-18T03:09:53.267

你不应该在你的标识符上加上单引号。如果您要引用它们，请使用“反勾号”字符（“`”）。您也可以使用双引号，但必须指定该模式：

```
SET sql_mode='ANSI_QUOTES'; 
```

[http://dev.mysql.com/doc/refman/5.0/en/identifiers.html](http://dev.mysql.com/doc/refman/5.0/en/identifiers.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T02:53:44.313

我总是遇到 CREATE TABLE 的问题。不知道为什么。需要一些反复试验。

试试这个：

```
CREATE TABLE temp_books (
  ID int(11) NOT NULL AUTO_INCREMENT,
  start varchar(20) NOT NULL,
  customer_id int(11) NOT NULL DEFAULT '0',
  total_num int(11) NOT NULL,
  amount double(5,2) NOT NULL DEFAULT '0.00',
  changed timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID),
  UNIQUE KEY start (start)
) ENGINE=MyISAM AUTO_INCREMENT=4853 DEFAULT CHARSET=latin1; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T03:06:47.750

我不得不删除引号、更改字段的默认值以及默认字符集。希望不会影响数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-04-18T10:43:16.583

这是另一种可能适用于某些人的编写方式：（为简洁起见，省略了大部分列）

```
create table temp_books
(
id int not null,
start varchar(255) null,
constraint six_cb_datasource_pk
    primary key (id)
); 
```

# javascript - 是否可以在页面上最后加载 javascript 广告以防止加载时间过慢？

> ID：454534
> 
> 赞同：13
> 
> 时间：2009-01-18T02:38:39.727
> 
> 标签：javascript

有没有办法在页面最后包含一个加载 javascript 的广告，但它是否位于内容中？主要目的是防止 javascript 广告减慢页面加载速度，因此如果有其他方法可以实现这一点，请分享。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-18T02:41:47.240

您可以将**[`defer`属性](http://www.websiteoptimization.com/speed/tweak/defer/)**放在脚本块上，以延迟其执行，直到页面完成加载。

```
<script src="myscript.js" type="text/javascript" defer>
// blah blah
</script> 
```

不过，我不确定有关使用此属性的一般建议。

**编辑：**正如@David 指出的，`defer="defer"`用于 XHTML

您可以随时将代码放入**`window.onload`**事件中，以便在页面加载*后执行：*

```
window.onload = function () {
    // ad codes here

}; 
```

但是后一种方法可能会带来一些问题，您可能需要先对其进行测试。

[有关编写著名javascript 打包程序](http://dean.edwards.name/packer/)的人 Dean Edwards 的[这篇博](http://dean.edwards.name/weblog/2005/09/busted/)文的更多信息。

* * *

**编辑：**如果广告代码本身的大小是问题，您始终可以通过将上述方法与脚本注入相结合来延迟加载`document.write`：

```
function loadScript(src) {
    document.write('<script src="' + src + '" type="text/javascript"></script>');
} 
```

所以生成的代码可能看起来像这样：

```
<script type="text/javascript" defer>

function loadScript(src) {
    document.write('<script src="' + src + '" type="text/javascript"></script>');
}

loadScript('http://ads.example.com/advertisements.js');

</script> 
```

但正如我所说，这也取决于您获得的特定广告代码。因为位置`document.write`会写东西可能不是你想要的位置。可能需要进行一些修改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T05:57:40.777

```
function addLoadEvent(func) {
      var oldonload = window.onload;
      if (typeof window.onload != 'function') {
        window.onload = func;
      } else {
        window.onload = function() {
          oldonload();
          func();
        }
      }
    } 
```

上面的代码是添加新的 onload 事件的好方法，它不会干扰您现有的 javascript。然后，您可以使用下面的代码添加一个新的加载事件来加载广告。

```
addLoadEvent(function() { // call to loadScript() here }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-04T08:50:42.837

我通常将标签放在正文标签结束之前加载脚本。所以它在页面末尾加载。这不会给出任何验证错误或任何错误。

# javascript - 在 jQuery 应用程序中存储模型数据的好方法是什么？

> ID：454555
> 
> 赞同：4
> 
> 时间：2009-01-18T02:55:12.033
> 
> 标签：javascript, jquery, model

我正在开发一个客户端很重的网络应用程序，这对我来说是第一次。我也是第一次使用 jQuery。我需要让我的客户端代码跟踪它通过 Ajax 调用获取的模型数据。

存储这些数据的好方法是什么？jQuery 是否提供了一个好的解决方案，还是有一个好的通用 Javascript 解决方案？我基本上想用Javascript编写模型类（但我不一定需要继承）。现在我的 jQuery 代码是一个控制器层，DOM 和 CSS 构成了我的视图层。其他人如何完成模型层？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-18T03:08:56.280

不久前，jQuery 开发人员[Adam Wulf 发布了一系列教程](http://welcome.totheinter.net/2008/08/05/mvc-pattern-for-the-web/)，涵盖了他在客户端上使用 jQuery 开发 MVC 模式。您可能会发现它们对您当前的项目非常有帮助。此外，JollyToad 在这方面也做了一些工作。[您也可以在线查看他们的结果](http://jollytoad.googlepages.com/mvcusingjquery)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T18:57:42.693

我还发现了一种称为 Concrete Javascript 的技术，其中 DOM 对象用作模型对象。Effen 听起来像是实现它的好方法：http: [//github.com/nkallen/effen/tree/master](http://github.com/nkallen/effen/tree/master)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T03:15:59.713

我通常使用服务器构建的 JSON 数据结构来保存我的客户端将用于交互式操作等的所有内容。没有特定于 jQuery 的内容......

# regex - RE -> FSM 生成器？

> ID：454557
> 
> 赞同：6
> 
> 时间：2009-01-18T02:56:30.720
> 
> 标签：regex, generator, fsm

给定一个正则表达式，我正在寻找一个包，它将为实现 RE 的有限状态机动态生成代码。

首选 C/C++ 和 Python，但其他语言也很有趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T05:34:38.843

[re2c](http://re2c.org/)生成 C 代码。我不确定你所说的“动态”是什么意思——如果你想在生成它的同一运行期间调用生成的代码，你必须编译和动态加载输出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-28T09:25:24.100

[Ragel](http://www.complang.org/ragel/)可能是您正在寻找的。

它为状态机生成 C/C++/D/Ruby/Java 代码。这些是使用正则表达式和运算符来描述的。

检查网站，它的首页非常明确。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T04:22:10.220

它可能不是您正在寻找的东西，但 Xerox 有限状态传感器支持正则表达式、构建机器，甚至可以使用 GraphViz 创建图形表示。

对于形态学之类的东西真的很漂亮，但除此之外，我建议主要是如果你正在寻找一些东西来探索有限状态机的理论方面。

两个警告：它使用自己的语法，因此不一定能轻松翻译成您选择的语言，而且我很确定您必须获得它的许可证。它附带了 Karttunnen 和 Beesley 的书“有限状态形态学”，这本书本身就非常有趣。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-02T09:11:13.290

[有限状态自动机实用程序](http://www.let.rug.nl/vannoord/Fsa/)支持从正则表达式生成 FSM。它还支持 FSM 的 C、C++ 和 Java 代码生成。它支持动态生成，但它是用 Prolog 编写的，从另一种语言调用可能会很麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T09:21:26.950

你要的是一个词法分析器......有很多它们可以用于过多的编程语言。首先，您可以在[这里查看](http://en.wikipedia.org/wiki/Lexical_analysis#Lexical_analyzer_generators)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-28T17:03:38.653

从正则表达式到有限状态机的转换器的一个好的 Python 实现是 [https://github.com/ferno/greenery](https://github.com/ferno/greenery)。它可以通过 'pip install greenery' 在 pypi 上获得。

Another python package uses greenery to implement iterative parsers: Communications Protocol Python Parser and Originator [https://github.com/pjkundert/cpppo](https://github.com/pjkundert/cpppo). It is also available via 'pip install cpppo'. Cpppo is unfortunately quite complex, in no small part due to an attempt to support both Python 2 and 3 in the same source, including full UTF-8 compatibility.

Anyway, cpppo should give you an idea of how to apply the excellent greenery Regex to FSM converter.

# delphi - delphi7中的皮肤

> ID：454558
> 
> 赞同：-1
> 
> 时间：2009-01-18T02:56:39.393
> 
> 标签：delphi, delphi-7, vcl, look-and-feel, skins

我希望对我的应用程序进行剥皮，并注意到似乎没有明显的方法可以做到这一点。

我习惯于为 java 蒙皮文件，并想知道是否有任何方法可以改变“标准”delphi7 应用程序的外观。

编辑：（标签）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T14:34:57.577

你看过 SpTBXLib 吗？ [http://www.silverpointdevelopment.com/sptbxlib/index.htm](http://www.silverpointdevelopment.com/sptbxlib/index.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T09:36:37.270

我使用[Developer Express Skins 库](http://www.devexpress.com/Products/VCL/ExSkins/)。这适用于标准组件以及它们自己的组件。您可以创建自定义皮肤，或使用他们的标准皮肤，包括设计精美的万圣节和冬季皮肤。他们还有一个功能区控件，可以使您的应用程序具有 Office 2007 的外观。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T04:13:52.437

我已经看到有关[AppFace](http://www.appface.com/)的正面评价，但我还没有尝试过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T04:15:38.643

看起来[这个论坛帖子中有一些相关链接](https://newsgroups.codegear.com/thread.jspa?threadID=9764&tstart=0)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T12:23:00.453

Appface 看起来很有前景，而且只需要 2 行代码。但是要使四个按钮和一个编辑框看起来不错，那是一大笔钱。linkrank 做同样的事情，但看起来不那么好，这次的成本甚至更高，大约 180。

同样，两者似乎都在吹嘘您只需要 2 行源代码和主题文件。除了这两个之外，到给定论坛的链接似乎没有产生任何结果。

即使我必须自己做更多的工作，也能找到免费版本。

编辑：“suipack”是同一工作的另一个工具

重新编辑：VCL 似乎是这里需要的基础 [http://www.vclcomponents.com/catalog/Delphi_Skin上列出的一些相关项](http://www.vclcomponents.com/catalog/Delphi_Skin)

Re-Edit-2：在此处找到免费软件版本

Re-Edit-3：添加了组件，但不仅没有帮助文件，而且似乎不完整，因为抛出了找不到“skins.pas”异常 [http://www.vclcomponents.com/Delphi/Form_Enhancement/VclSkin- info.html](http://www.vclcomponents.com/Delphi/Form_Enhancement/VclSkin-info.html) 对其进行评估并备份结果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-18T17:21:23.357

在花了几个小时安装它之后，根据情况，安装了 unicodecontroler 和toolbar2000，但是toolbar200 似乎与库路径有问题，在我修复它之后它不允许我重新安装，我不得不这样做由于未找到 tb2kdsgn_d7.dpk 的引用，因此无法安装 SpTBXLibDsgn_*.dpk。

这导致我去ARRRRRGGGHHHHHH并将我的头撞在墙上，在delphi7中免费创建皮肤的唯一方法是7手动安装（作为菜鸟这很难），然后当我发出嘘声时，它不会被卸载,,, 哎哟

好像没有适合我的款式....

编辑：如果有人想选择样式，我认真建议我在破坏我的 tbk2000 包之前没有看到的多安装程序:(

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T12:56:46.960

另一个为 Delphi 设置的皮肤组件是[AlmediaDev](http://www.almdev.com/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-20T13:20:22.530

AFAIK，有两个 Delphi 组件可用于在不需要任何代码的情况下为您的应用程序皮肤，但两者都不是免费的

[VCLSkin](http://www.link-rank.com/)

[SuiSkin](http://www.sunisoft.com/suiskin/)

# c# - 在 C# 中，如何从一个内存程序集中引用另一个内存程序集中的类型？

> ID：454561
> 
> 赞同：4
> 
> 时间：2009-01-18T03:00:30.713
> 
> 标签：c#, .net

下面的示例程序编译了两个内存中的程序集。第一次编译工作正常。第二个失败，因为它需要从第一个程序集中访问一个类并且该类型不可用。

具体来说： CompilerParameters 类的 ReferencedAssemblies 成员是一个字符串集合，它用于加载程序集的清单以获取它们的类型。似乎 C# 编译器严格从清单中获取类型，而不是通过使用反射（可能出于性能原因）。无论如何，当在内存中构造程序集时，没有文件也没有清单，因此第二个程序集构建失败并出现错误像这样：

编译器错误：找不到元数据文件“ax5lw0tl，版本=0.0.0.0，文化=中性，PublicKeyToken=null”

添加 AssemblyResolver 事件处理程序不起作用。我试过这个，看起来它从来没有被调用过。据我所知（我是.Net 的新手，所以请耐心等待）编译器只关心清单；此时它实际上并没有尝试加载程序集，因此 AssemblyResolver 不在图片中。

如果绝望，我可以在磁盘上构建我的程序集，这将解决当前的问题，即拥有一个物理 dll 和要读取的清单。我宁愿不这样做，因为它会导致必须管理磁盘上的大量临时程序集。

我很乐观.Net 可以做到这一点，作为一个新手，我只是想念它。

（我希望代码示例中的间距可以正常显示。它似乎在预览窗口中正确呈现了片刻，但是一旦语法高亮显示完成，它就会重新呈现并且间距不正确，尽管它仍然可读。）

```
using System;
using System.CodeDom.Compiler;
using System.Reflection;
using System.Collections.Generic;
using Microsoft.CSharp;  

namespace AsmCompileTest
  {
  class Program
    {
    static Assembly Compile( string code, Assembly referencedAssembly )
      {
      CompilerParameters cp = new CompilerParameters();
      cp.GenerateExecutable = false;
      cp.GenerateInMemory = true;

      if( null != referencedAssembly )
        {
        cp.ReferencedAssemblies.Add( referencedAssembly.FullName );
        }

      CodeDomProvider provider = new CSharpCodeProvider( new Dictionary<string,string> { { "CompilerVersion", "v3.5" } } );

      CompilerResults compilerResults = provider.CompileAssemblyFromSource( cp, code );

      if( compilerResults.Errors.HasErrors )
        {
        foreach( CompilerError error in compilerResults.Errors )
          {
          Console.WriteLine( "COMPILER ERROR: " + error.ErrorText );
          }
        }

      return compilerResults.CompiledAssembly;
      }

    static string Code1 = "using System;" +
                          "public class HelloClass" +
                          "  {" +
                          "  public HelloClass() { Console.WriteLine( \"Hello, World!\" ); }" +
                          "  }";

    static string Code2 = "using System;" +
                          "public class TestClass" +
                          "  {" +
                          "  public TestClass() { new HelloClass(); }" +
                          "  }";

    static void Main()
      {
      Assembly asm1 = Compile( Code1, null );
      Console.WriteLine( "Compiled: " + asm1.FullName );  

      asm1.GetType( "HelloClass" ).InvokeMember( String.Empty, BindingFlags.CreateInstance, null, null, null );  

      Assembly asm2 = Compile( Code2, asm1 );
      Console.WriteLine( "Compiled: " + asm2.FullName );  

      asm2.GetType( "TestClass" ).InvokeMember( String.Empty, BindingFlags.CreateInstance, null, null, null );
      }
    }
  } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T04:53:39.330

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.compilerparameters%28VS.80%29.aspx)上的文档和我查看的反射器中的代码（对于编译器类），不可能做你想做的事。原因是在下面，您使用的代码编译器类将外壳输出到实际的编译器。

此外，代码编译器类实际上是在下面生成临时文件，并且根据我在反射器中查看的代码，它们并没有清理文件。因此，基于此，我会说只是在磁盘上的临时位置生成文件，然后添加对它的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T03:36:56.397

在普通程序集中定义接口，并让每个生成的程序集中的类实现这些接口。生成的程序集将需要对包含接口的程序集的引用，而不是彼此的引用。

# python - 如何在 Python 中创建一个类似 (0,6,12, .. 144) 的列表？

> ID：454566
> 
> 赞同：4
> 
> 时间：2009-01-18T03:04:43.857
> 
> 标签：python, list

我不确定是否应该使用 for -loop。或许，像

```
for i in range(145): 
  by 6:    //mistake here?
  print i 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-18T03:11:14.000

```
for i in range(0,150,6):
     print i 
```

如果你正在步进一个常数

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-18T03:06:20.577

我会选择：

```
for i in xrange(25):    # from 0 to 24
    print 6*i 
```

*您可以使用名为list comprehension*的类似结构轻松构建包含相同数字的列表：

```
numbers = [6*i for i in xrange(25)]
print numbers 
```

如果您已经有一个（未知）数字列表，例如`someNumbers`，但您只想打印那些是 6 的倍数的数字：

```
for i in someNumbers:
    if i%6 == 0:
        print i 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-18T03:16:11.320

reqlist = [i for i in range(0,150,6)]

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2009-01-18T03:12:32.310

```
i = 1

while i * 6 < 144:
    i = i + 1
    print i * 6 
```

有很多方法可以做到这一点

# c# - 覆盖 Button_click 事件处理程序

> ID：454568
> 
> 赞同：0
> 
> 时间：2009-01-18T03:06:02.590
> 
> 标签：c#, winforms, event-handling

我正在使用 MVP 模式开发 WinForms 应用程序。我想将按钮单击的标记值传递给演示者。因为我想获得`button.Tag`属性，所以我需要 sender 参数是 type `Button`。如果不这样做，我怎么能做到这一点：

```
private void button0_Click(object sender, EventArgs e)
{
    if (sender is Button)
    {
        presenter.CheckLeadingZero(sender as Button);
    }
} 
```

我不得不将对象向下转换为方法参数中的按钮。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T04:06:05.620

`is`如果您只是要使用关键字，则使用关键字检查类型是没有意义的`as`，因为无论如何都会`as`进行检查，然后进行显式转换。`is`相反，您应该这样做：

```
Button button = sender as Button;
if (button != null)
{
  presenter.CheckLeadingZero(button);
} 
```

# mysql - 更新、外键约束和空值

> ID：454582
> 
> 赞同：0
> 
> 时间：2009-01-18T03:15:28.763
> 
> 标签：mysql, database, oracle, null, foreign-keys

我正在用 C# 生成一个数据模板。在这个精彩网站上的好人的帮助下，我已经设法处理了几乎所有问题。这应该是最后一个问题。因为它是我正在处理的模板，所以我想要表中的每个字段，包括空值。我在如何通过添加 (object)this.field 来更新空值方面得到了帮助？DBNull.Value 但我有一个外键字段，即使当我查看数据库时它显示为 null，但当我提取记录时，值变为 0。当我尝试更新此字段时，它说我违反了外键约束。我该如何解决这个问题？我认为空解决方案会起作用，但它不显示为空，它显示为 0。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T04:01:12.477

一般来说，允许 FK 为空并不是一个好主意。一些数据库（我知道 oracle 这样做）通过将 FK 绑定到主键而不是其他表中的列来强制执行此操作。您能否重构您的表以使该列不需要空值？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T05:20:58.137

0 是该列的可能有效值吗？如果没有，只需在遇到一个时将其类型转换为 null。如果它有效，您仍然可以这样做，方法是将其包装在首先检查外部行是否存在的条件中。

# perl - 我可以在没有 nph-preface 的 Apache 2.2.9 下运行未解析的头脚本吗？

> ID：454591
> 
> 赞同：1
> 
> 时间：2009-01-18T03:25:57.293
> 
> 标签：perl, apache

我在 Fedora 核心 8 下有一个基本的 Apache 2.2.9 设置。我想设置我自己的 HTTP 标头来显示（HTTP Forbidden / 403）。

如果我将文件命名为 nph-foo.pl，它就可以工作。如果我将文件命名为 foo.pl，它会失败并出现服务器错误，请键入 500。

根据我发现的所有网络参考资料，nph-filename 约定在 Apache 1.3 向前版本中不再有效。

我需要一个 header / apache 配置指令来完成这项工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T10:25:50.907

你确定你需要一个无解析头脚本吗？您是否尝试过打印“状态”CGI 标头？

```
print "Status: 403\n\n"; 
```

# c++ - 如何编写一个垂直的右侧 IE 浏览器栏

> ID：454600
> 
> 赞同：2
> 
> 时间：2009-01-18T03:40:43.423
> 
> 标签：c++, windows, internet-explorer, winapi, browser

我之前写过资源管理器栏（带​​对象），**AFAIK 垂直资源管理器栏只能在左侧**。然而，当我看到这个停靠在右侧的 HP 浏览器栏时，我感到很惊讶：

![右侧的垂直浏览器栏](https://farm4.static.flickr.com/3493/3204746881_58eb9706fc.jpg)

我在谷歌上搜索了一下，我找不到任何关于这方面的资源。有谁知道如何**建立一个垂直的右侧浏览器栏**？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-03T13:02:46.860

我一直在研究[Kutano](http://www.kutano.com/)的右侧栏是如何工作的，因为我想做同样的事情。这并不能直接帮助您解决问题，因为我还没有答案，但我知道的是：

Kutano 似乎不是一个普通的资源管理器栏，因为它没有条目`HKCR\Software\Microsoft\Internet Explorer\Explorer Bars`，也没有出现在`View|Explorer Bar`菜单中。

注册表中引用 Kutano 侧边栏 DLL 的以下条目：

```
HKCR\AppID\{6D6036C6-692F-4211-903B-943D94E1CCC3}
  kutano_ie_client

HKCR\CLSID\{18D81A5F-F8A5-4B78-A6CC-7E37DCAFC0BB}
  Kutano Add-on
  TypeLib {24DA2415-9F99-403F-801B-A74AE4101C27}

HKCR\CLSID\{2AE98FD7-4E58-4400-8113-B5018ED48676}
  Kutano Sidebar
  TypeLib {24DA2415-9F99-403F-801B-A74AE4101C27}

HKCR\CLSID\{2F698BD8-48CD-45B4-ACDF-67F92082EE7E}
  MenuItem
  TypeLib {24DA2415-9F99-403F-801B-A74AE4101C27}

HKCR\CLSID\{A5B02961-E212-4195-A77D-6E1346C2DE18}
  kutanoSidebarExtInterface Class
  TypeLib {24DA2415-9F99-403F-801B-A74AE4101C27}

HKCR\CLSID\{E163FD8B-2ADD-4F2E-86E8-7678D008ED43}
  KutanoToolbarBtn Class
  TypeLib {24DA2415-9F99-403F-801B-A74AE4101C27}

HKCR\TypeLib\{24DA2415-9F99-403F-801B-A74AE4101C27}
  kutano_ie_client 1.0 Type Library

HKLM\Software\Classes\AppID\kutano_ie_client.DLL
  AppID {6D6036C6-692F-4211-903B-943D94E1CCC3} 
```

其中一些在他们所做的事情上比其他人更明显。

研究 Spy++ 似乎在窗口层次结构中添加了一个额外的 Shell DocObject 视图：

```
TabWindowClass
  ATL:63CB39A0
    Kutano_SplitterWindow
      AtlAxWin90
        Shell Embedding
          Shell DocObject View
            Internet Explorer_Server 
```

它确实保留了原件并似乎继续使用它：

```
TabWindowClass
  Shell DocObject View
    Internet Explorer_Server 
```

这似乎与您的 HP 示例有些不同并且涉及更多，但希望它可以收集一些信息以达到同样的目的。我在 MSDN Internet Explorer Extension Development 论坛上有一个关于此的主题[。](http://social.msdn.microsoft.com/Forums/en-US/ieextensiondevelopment/thread/367731dd-faf1-47f0-b538-693cdac1ab9f)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T21:37:27.287

没有实际创建一个.. 我只能假设 HP 在调用 setsite 之后的某个时间查询 IDockingWindow 的食物链。这可能允许 IDockingWindow::RequestBorderSpaceDW 分配右侧停靠点。

```
IDeskBand 接口
   |
    --IDockingWindow
        |
        --IOleWindow
找到 IDockingWindowSite
或 IOleInPlaceUIWindow::SetBorderSpace
从浏览器窗口。**编辑**：来自浏览器文档。

```

--

迈克尔

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-06T03:52:00.100

我过去玩过探索栏，不能选择停靠在右侧。这样做的开发人员可能是强制执行的：将他们的 HWND 注入正确的位置，然后调整其他窗口的大小。

我想他们也有可能依赖于 Internet Explorer 的一些潜在功能，而这些功能从未暴露过......

我不知道为什么微软似乎不允许这种类型的资源管理器栏，但如果你想在右边停靠一些东西，看起来你必须破解它。

# c# - 如何使用 LINQ 计算列表中的重复项

> ID：454601
> 
> 赞同：82
> 
> 时间：2009-01-18T03:41:23.703
> 
> 标签：c#, linq

我有一个物品清单

*   约翰·艾德
*   马特 ID
*   约翰·艾德
*   斯科特身份证
*   马特 ID
*   约翰·艾德
*   卢卡斯身份证

我想将它们推回到这样的列表中，这也意味着我想按最多的重复项进行排序。

*   约翰 ID 3
*   马特 ID 2
*   斯科特 ID 1
*   卢卡斯 ID 1

让我知道如何使用 LINQ 和 C# 做到这一点。

谢谢大家

**编辑 2 显示代码：**

```
 List<game> inventory = new List<game>();
    drinkingforDataContext db = new drinkingforDataContext();
    foreach (string item in tbTitle.Text.Split(' '))
    {

        List<game> getItems = (from dfg in db.drinkingfor_Games
                               where dfg.game_Name.Contains(tbTitle.Text)
                               select new game
                               {
                                   gameName = dfg.game_Name,
                                   gameID = Boomers.Utilities.Guids.Encoder.EncodeURLs(dfg.uid)
                               }).ToList<game>();

        for (int i = 0; i < getItems.Count(); i++)
        {
            inventory.Add(getItems[i]);
        }
    }

    var items = (from xx in inventory
                 group xx by xx into g
                 let count = g.Count()
                 orderby count descending
                 select new
                    {
                        Count = count,
                        gameName = g.Key.gameName,
                        gameID = g.Key.gameID
                    });

    lvRelatedGames.DataSource = items;
    lvRelatedGames.DataBind(); 
```

此查询显示以下结果：

*   1 你好世界时报
*   1 你好世界时报
*   1 你好，世界。
*   1 你好世界时报
*   1 你好世界时报
*   1 你好世界时报
*   1 你好，世界。
*   1 你好世界时报

它给了我计数和名称，但它没有给我游戏的 ID....

它应该显示：

*   6 你好世界时报 234234
*   2 你好，世界。23432432

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2009-01-18T03:59:14.853

您可以使用“分组依据”+“排序依据”。有关详细信息，请参阅[LINQ 101](http://msdn.microsoft.com/en-us/vcsharp/aa336746.aspx)

```
var list = new List<string> {"a", "b", "a", "c", "a", "b"};
var q = from x in list
        group x by x into g
        let count = g.Count()
        orderby count descending
        select new {Value = g.Key, Count = count};
foreach (var x in q)
{
    Console.WriteLine("Value: " + x.Value + " Count: " + x.Count);
} 
```

**回应[这篇文章](https://stackoverflow.com/questions/454601/how-to-count-duplicates-in-list-with-linq#454652)（现已删除）：**

如果您有一些自定义对象的列表，那么您需要使用[自定义比较器](http://msdn.microsoft.com/en-us/vcsharp/aa336754.aspx#comparer)或按特定属性分组。

查询也无法显示结果。向我们展示完整的代码以获得更好的帮助。

**根据您的最新更新：**

你有这行代码：

```
group xx by xx into g 
```

由于 xx 是一个自定义对象系统不知道如何将一个项目与另一个项目进行比较。正如我已经写过的，您需要指导编译器并提供一些将在对象比较中使用的属性或提供自定义比较器。这是一个例子：

请注意，我使用**Foo.Name**作为键 - 即对象将根据**Name**属性的值进行分组。

有一个问题-您根据名称将 2 个对象视为重复对象，但是 Id 呢？在我的示例中，我只取组中第一个对象的 ID。如果您的对象具有不同的 ID，则可能会出现问题。

```
//Using extension methods
var q = list.GroupBy(x => x.Name)
            .Select(x => new {Count = x.Count(), 
                              Name = x.Key, 
                              ID = x.First().ID})
            .OrderByDescending(x => x.Count);

//Using LINQ
var q = from x in list
        group x by x.Name into g
        let count = g.Count()
        orderby count descending
        select new {Name = g.Key, Count = count, ID = g.First().ID};

foreach (var x in q)
{
    Console.WriteLine("Count: " + x.Count + " Name: " + x.Name + " ID: " + x.ID);
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-01-18T04:25:30.463

使用方法链稍短的版本：

```
var list = new List<string> {"a", "b", "a", "c", "a", "b"};
var q = list.GroupBy(x => x)
            .Select(g => new {Value = g.Key, Count = g.Count()})
            .OrderByDescending(x=>x.Count);

foreach (var x in q)
{
    Console.WriteLine("Value: " + x.Value + " Count: " + x.Count);
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2017-06-24T15:32:08.727

你也可以做字典：

```
 var list = new List<string> { "a", "b", "a", "c", "a", "b" };
 var result = list.GroupBy(x => x)
            .ToDictionary(y=>y.Key, y=>y.Count())
            .OrderByDescending(z => z.Value);

 foreach (var x in result)
        {
            Console.WriteLine("Value: " + x.Key + " Count: " + x.Value);
        } 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-07-09T16:22:16.093

其他解决方案使用`GroupBy`. `GroupBy`很慢（它包含内存中的所有元素）所以我编写了自己的方法`CountBy`：

```
public static Dictionary<TKey,int> CountBy<TSource,TKey>(this IEnumerable<TSource> source, Func<TSource,TKey> keySelector)
{
    var countsByKey = new Dictionary<TKey,int>();
    foreach(var x in source)
    {
        var key = keySelector(x);
        if (!countsByKey.ContainsKey(key))
            countsByKey[key] = 0;
        countsByKey[key] += 1;
    }
    return countsByKey;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-04-28T18:18:56.303

为什么不发布一个新的答案！如今，我认为你可以做类似的事情......
`var duplicatesCount = listVariable.Count(o => o.Equals(listElement));`
然后只需在新列表中添加带有重复计数的每个元素，并使用`!listVariable.Contains(elem)`重复阻止程序

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-30T16:57:36.547

**这是完整的程序请检查这个**

```
static void Main(string[] args)
{
    List<string> li = new List<string>();
    li.Add("Ram");
    li.Add("shyam");
    li.Add("Ram");
    li.Add("Kumar");
    li.Add("Kumar");

    var x = from obj in li group obj by obj into g select new { Name = g.Key, Duplicatecount = g.Count() };
    foreach(var m in x)
    {
        Console.WriteLine(m.Name + "--" + m.Duplicatecount);
    }
    Console.ReadLine();
} 
```

# ant - 在 Ant 中排除 .git 任务

> ID：454605
> 
> 赞同：5
> 
> 时间：2009-01-18T03:47:13.410
> 
> 标签：ant, build, tar

我正在使用 Ant 1.7.1 压缩包含 .git 子目录的目录的内容。我目前的任务是

```
<tar
    destfile="sali-src-${version}.tgz"
    basedir="${basedir}"
    compression="gzip"
    excludes=".git, .gitignore, *.ipr, *.iws, *.iml">
</tar> 
```

但生成的 tarball 包含 .git 子目录。谁能指出我如何防止它被包括在内？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T04:33:22.727

这有效：

```
<?xml version="1.0"?>
<project name="test" default="tar">
        <target name="tar">
            <tar
                destfile="sali-src-${version}.tgz"
                basedir="${basedir}"
                compression="gzip"
                excludes=".git/**, .gitignore/**, **/*.ipr, **/*.iws, **/*.iml">
            </tar>
        </target>
</project> 
```

您的模式是错误的，有关模式的更多信息，请阅读此处：[http ://ant.apache.org/manual/dirtasks.html#patterns](http://ant.apache.org/manual/dirtasks.html#patterns)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T18:33:17.110

Ant 具有[预先配置的默认排除项](http://ant.apache.org/manual/dirtasks.html#defaultexcludes)，可防止基于目录的任务处理 CVS、Subversion 和 VSS 的控制文件。不幸的是，这些默认值不包括任何其他版本控制系统。但是，您可以使用[<defaultexcludes> 任务](http://ant.apache.org/manual/Tasks/defaultexcludes.html)修改默认值：

```
<defaultexcludes add="**/.git/**,**/.gitignore"/> 
```

这将从任何后续处理中排除您的 Git 文件（因此每次后续使用 <tar>、<javac>、<jar> 或类似文件都会忽略控制文件）。

# math - 如何在 Sage 中进行回归分析？

> ID：454606
> 
> 赞同：5
> 
> 时间：2009-01-18T03:47:16.767
> 
> 标签：math, sage

我试过这个不成功：

```
find_fit(data, quadratic_residues) 
```

我正在尝试找到最适合有关水流量的数据：http: [//dl.getdropbox.com/u/175564/rate.png](http://dl.getdropbox.com/u/175564/rate.png)

---评论后编辑---

新代码：

```
var('x')
model(x) = x**2
find_fit((xlist, reqlist), model) 
```

错误信息：

```
Traceback (click to the left for traceback)
...
TypeError: data has to be a list of lists, a matrix, or a numpy array 
```

- -编辑

错误消息现在是：

```
Traceback (click to the left for traceback)
...
ValueError: each row of data needs 2 entries, only 5 entries given 
```

这里和图片一样： http: [//dl.getdropbox.com/u/175564/sage.png](http://dl.getdropbox.com/u/175564/sage.png)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-04T18:05:12.447

```
mydata = [[1,3],[2,7],[3,13],[4,24]]
var('a,b,c')
mymodel(x) = a*x^2 + b*x + c 
myfit = find_fit(mydata,mymodel,solution_dict=True)
points(mydata,color='purple') + plot(
  mymodel(
    a=myfit[a],
    b=myfit[b],
    c=myfit[c]
    ), 
    (x,0,4,),
    color='red'
  ) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T05:45:00.007

我认为你的问题是 quadratic_residues 可能并不意味着你认为它意味着什么。如果你试图拟合最好的二次模型，我想你想做类似的事情。

```
var('a, b, c, x')
model(x) = a*x*x + b*x + c
find_fit(data, model) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-01T17:00:12.440

尝试 Steven 他的例子我也遇到了错误：

```
ValueError: each row of data needs 5 entries, only 2 entries given 
```

这是一个更明确的示例，我已经测试过它可以在 sage 4.7 中工作。

```
sage: l=[4*i^2+7*i+134+random() for i in xrange(100)]
sage: var('a,b,c,x')
(a, b, c, x)
sage: model=a*x^2+b*x+c
sage: find_fit(zip(xrange(100),l),model,variables=[x])
[a == 4.0000723084513217, b == 6.9904742307159697, c == 134.74698715254667] 
```

显然，您需要 variables=[x] 来告诉 sage a、b、c 和 x 中的哪一个对应于模型中的变量。

# sql - 以相同的顺序获取记录而不使用 ORDER BY 子句

> ID：454613
> 
> 赞同：2
> 
> 时间：2009-01-18T03:53:47.860
> 
> 标签：sql, sql-server, tsql, sql-order-by

我是 T-SQL 的新手。有人可以告诉我如何在不使用 order by 子句的情况下以相同的顺序从 sql 表中获取记录吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-18T04:08:21.077

那是做不到的。有时你可能会很幸运，但你不能依赖它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-18T03:59:01.047

如果您使用的是 SQL Server（因为您提到了 T-SQL），您可能会通过在表上定义一个聚集索引来获得一些运气，这会强制对表中的行进行存储排序。但是，如果您不指定*order by*子句，则添加或删除连接或*where*子句条件可能会导致该顺序发生更改，因为优化器可能选择不使用该聚集索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T22:26:02.367

如果您定义了控制排序/顺序的聚集索引，则可以在选择中使用索引提示。

# ruby-on-rails - Ruby On Rails：ActiveResource 和文件上传

> ID：454614
> 
> 赞同：4
> 
> 时间：2009-01-18T03:54:43.803
> 
> 标签：ruby-on-rails, file-upload, activeresource

有没有人有 ActiveResource 和文件上传的经验？我有一个 Adob​​e Air 桌面应用程序，它与我的 Rails 驱动网站的 Web 服务进行通信。

我想将文件发布到服务器，但我不完全确定是否可以使用 ActiveResource 做到这一点。另外，我有一些担忧，因为我在某处读到 AR 无法处理多部分请求。不太有前途。

任何人都有想法如何做到这一点？也许是链接或博客文章？提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T12:39:46.513

底线是，activeresource 不处理多部分。

选项可能是使用： - Curb：Curl for ruby​​ - 编写您自己的处理程序 - 休息客户端（带有多部分流的 git fork） - 使用带有多部分帖子的 httpclient

这些链接会给你灵感：

*   [http://www.nabble.com/Rest-client-posting-multipart-to-rails-2-td20731160.html](http://www.nabble.com/Rest-client-posting-multipart-to-rails-2-td20731160.html)
*   [Ruby：如何通过 HTTP 将文件作为 multipart/form-data 发布？](https://stackoverflow.com/questions/184178/ruby-how-to-post-a-file-via-http-as-multipart-form-data/184303)
*   [http://github.com/technoweenie/rest-client/tree/multipart_streaming](http://github.com/technoweenie/rest-client/tree/multipart_streaming)
*   [http://github.com/adamwiggins/rest-client/tree/master](http://github.com/adamwiggins/rest-client/tree/master)
*   [http://snippets.aktagon.com/snippets/141-How-to-perform-a-file-upload-multipart-post-with-Ruby](http://snippets.aktagon.com/snippets/141-How-to-perform-a-file-upload-multipart-post-with-Ruby)
*   [http://dev.ctor.org/http-access2](http://dev.ctor.org/http-access2)

# mysql - MySQL 中插入期间的表级锁定锁定是什么？

> ID：454615
> 
> 赞同：2
> 
> 时间：2009-01-18T03:55:00.510
> 
> 标签：mysql, myisam

我读过很多次，MySQL 将在插入期间对 MyISAM 表执行表级锁定。如果该锁仅用于序列化插入/删除命令，我可以。无论如何，插入在我的网站上非常罕见。

但是，在插入命令完成之前，该锁是否也会阻止所有 Select 查询？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T06:30:07.910

写锁将阻止所有使用您锁定的表的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T04:19:02.207

要在 MySQL 服务器中完成隔离级别，您可以使用 SET SESSION 命令更改会话隔离模式。

```
SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ;
SELECT * FROM TABLE_NAME ;
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ ; 
```

上面的语句将像 WITH (nolock) 一样工作，即 READ UNCOMMITTED 数据。您还可以为所有连接全局设置隔离级别。

```
SET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED ; 
```

MySQL 服务器中有两个与隔离级别相关的系统变量。

```
SELECT @@global.tx_isolation;
SELECT @@tx_isolation; 
```

第一条语句将返回全局隔离级别，第二条语句仅返回当前会话。

在 SQL Server 中，您还可以像这样在事务级别设置隔离级别。

```
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ
GO 
```

阅读更多@：[带有 nolock 的 mysql](http://www.sqldba.org/articles/22-mysql-with-nolock.aspx)

# asp.net - asp.net cookie、身份验证和会话超时

> ID：454616
> 
> 赞同：35
> 
> 时间：2009-01-18T03:55:28.463
> 
> 标签：asp.net, authentication, cookies, session

我有一个使用表单身份验证的 asp.net 网站。我在会话中保留了一些内容，例如用户名、用户 ID、电子邮件等。

我允许用户通过在身份验证 cookie 上设置较长的过期日期来保持登录到网站。因此，会话在用户仍然通过身份验证时到期是很常见的。

我遇到的问题是有时用户的会话超时但他们仍然经过身份验证。因此，例如，我的一个用户页面（需要身份验证）在会话处于活动状态时会说“Welcome Mike”，但一旦过期，它会说“Welcome [blank]”，因为该信息不再在会话中，但他们仍然经过身份验证。

处理这个问题的最佳方法是什么？当信息不再存在时，我应该重新同步会话信息吗？或者我应该将用户信息（用户名、用户 ID、电子邮件）移动到 cookie 中，而不用担心会话超时？

我不想将会话长度设置为 60 分钟或更长。**我想要的是让我的用户能够登录一次，而不必担心在他们明确注销之前必须再次登录。**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-18T04:15:25.460

尽可能避免使用会话，如果你可以在没有看到的情况下逃脱，它会使多服务器部署变得更容易一些。可能，姓名和电子邮件很容易成为 cookie 的候选者。伪造 cookie 很容易，因此根据您的安全需求，用户 ID 可能不是一个好主意。

表单身份验证 cookie 已加密，您可以向这些 cookie 添加额外数据（请参阅下面的详细信息）。它可能是可破解的，但不像简单的 cookie 那样容易。

这是我过去使用的代码，稍作修改以删除一些项目特定的细节。在登录控件的 LoggedIn 事件中调用它。

```
void AddUserIDToAuthCookie(string userID)  
{  
  //There is no way to directly set the userdata portion of a FormAuthenticationTicket  
  //without re-writing the login portion of the Login control  
  //  
  //I find it easier to pull the cookie that the Login control inserted out  
  //and create a new cookie with the userdata set  

  HttpCookie authCookie = Response.Cookies[AUTH_COOKIE];
  if(authCookie == null)
  {
    return;
  }

  Response.Cookies.Remove(AUTH_COOKIE);

  FormsAuthenticationTicket oldTicket = FormsAuthentication.Decrypt(authCookie.Value);
  var newTicket =
    new FormsAuthenticationTicket(oldTicket.Version, oldTicket.Name, oldTicket.IssueDate, oldTicket.Expiration,
                                  oldTicket.IsPersistent, userID, oldTicket.CookiePath);

  authCookie.Value = FormsAuthentication.Encrypt(newTicket);

  Response.Cookies.Add(authCookie);
} 
```

仅供参考，我从一个旧项目中复制了它并在此处对其进行了编辑以删除一些项目特定的位，因此它可能无法编译，但它会非常接近。

要在您的网页中获取 ID...

```
FormsAuthenticationTicket ticket = ((FormsIdentity) Page.User.Identity).Ticket;
string id = ticket.UserData; 
```

我使用这种机制来存储不属于 aspnetdb 用户数据的 id。如果您的所有身份数据都由 aspnetdb 处理，您可能只需要访问 Page.User.Identity 对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T04:48:04.600

就个人而言，我会保留 20 分钟的默认设置，并为您的网站添加“保持活动”功能。制作一个简单的 javascript，每 5 分钟轮询一次，比如 heartbeat.aspx，以保持会话处于活动状态。这将扩展会话和身份验证，而不会保留疯狂的身份验证令牌。

有几个例子（我认为不好）如何做到这一点。我最终使用了基于[AjaxLines 的会话超时预防的](https://web.archive.org/web/20090227133807/http://www.ajaxlines.com/ajax/stuff/article/prevent_session_timeout_in_your_aspnet_ajax_application.php)东西。不过，我没有使用 ajax 库，而是直接使用了 xhtml 请求。`GET`除了在心跳页面上对a 进行定时 javascript 调用之外，没有什么比真正需要的了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T04:54:23.917

从技术上讲，由于 asp.net 会话超时，您的用户不应被注销。这应该/由表单身份验证 cookie 控制。

所有与用户身份验证相关的基本信息都应保存在表单身份验证票的 USERDATA 属性中。该值不应作为会话保留在会话中。

**仅将那些值保留在可重新创建的会话中。**

因此，当您创建表单身份验证 cookie 时，您可以将所有基本信息作为票证的一部分传递。

--

您可以做的最快的事情是保持会话和表单身份验证的超时相同。这将是一个很好的做法。

会话超时会随着对站点的每个请求而自动延长。

而表单身份验证仅在 50% 的时间过去后才会延长其时间。

这是有关此的详细信息： [Forms Authentication FAQ](http://support.microsoft.com/kb/910443)

最简单的做法是在自定义 HttpModule 或基本页面中延长 Forms 身份验证时间，无论您的设计是什么。

这样，您的超时将始终保持同步，尽管可能会有一些细微的差距。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T04:42:18.463

如果我自己没有实际尝试任何事情，我会检查一些事情。

*   使用允许您设置持久 cookie 的 FormsAuthentication 类的方法/重载。虽然，恕我直言，允许您的用户选择选中“记住我”框而不是强制他们持续登录是一种常见的礼貌。有许多方法可以让您根据您想要的行为来执行此操作 - SetAuthenticationCookie() 和 RedirectFromLoginPage() 是首先想到的。

*   查看 FormsAuthentication.GetAuthenticationCookie()。这将生成一个带有身份验证令牌的 HTTP cookie，但不会实际设置它，这*应该*允许您更改您想要的内容 - 尽管如果 FormsAuthentication 模块正在寻找一个特定的值，弄乱它可能会破坏身份验证。然后，您必须手动将 cookie 添加到响应中的 cookie 集合中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-10T06:29:45.337

我首选的方法是使用像缓存这样的会话。也就是说，尝试从会话中读取，如果该值存在则返回它，如果不是，则从持久性存储（数据库等）中读取它，将其放入会话中并返回它。

为了简化这一点，创建一个类，为会话中的每个变量添加一个属性，并在会话中存储该类的一个实例。然后创建一个静态方法来获取该类的一个实例。如果可以的话，我稍后会添加一个示例。

# php - PHP 应用程序更新

> ID：454622
> 
> 赞同：2
> 
> 时间：2009-01-18T03:59:57.300
> 
> 标签：php, updates

我正在用PHP编写一个Web应用程序，现在是时候构建一个更新系统了，其中一个要求是自动更新，我该怎么做？

我想在没有 cron 的情况下执行此操作，因此我将不得不在向系统发出请求时检查更新，我是否应该仅在具有重要权限的管理员登录时才执行此操作，我认为这正在发生成为最好的，但至少有 1 位客户表示他们不想要这个，因为他们只打算每隔几个月登录一次，而且他们仍然希望获得安全更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T05:24:17.553

也许您可以在您的站点上创建一个页面，该页面返回一个带有最新版本号的小型 XML 文件和一个下载 URL：

`<xml> <version>1.x.y</version> <url>http://example.com/current.tgz </url> </xml>`

然后，如果管理员选择执行和升级，您的应用程序将不需要知道除了 XML 文件的 URL 和当前版本号之外的任何内容。

当然，这是一个非常有限的例子，您可以在此基础上扩展您的内心满足感。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T10:35:42.930

当然使用版本控制！

我在我的大多数生产站点中都包含了这个“插件”：当然，您需要首先为此创建一个有限权限的机器人 svn 帐户，并且必须在服务器上安装 svn。

```
 <?php

    echo(' updating from svn<br>' );
    $username = Settings::Load()->Get('svn','username');
    $password = Settings::Load()->Get('svn','password');
    echo(" <pre>" );
    $repos = Settings::Load()->Get('svn' , 'repository');
    echo system ("svn export --username={$username} --password {$password} {$repos}includes/ ".dirname(__FILE__)."/../includes --force");
    echo system("svn export --username={$username} --password {$password} {$repos}plugins/ ".dirname(__FILE__)."/../plugins --force");

    die(); 
```

当然，请确保将其放在 .htpasswded 站点后面，并确保不要从 SVN 更新“生产设置”。等等，你用一个 HTTP 查询更新你的完整代码库到你的站点 :) SVN 自动覆盖文件，没有隐藏文件或文件夹留下，它很容易适应更新或恢复到特定版本。现在您的团队需要做的就是提交到他们的 SVN 存储库，在测试环境中运行这段代码，确保一切正常，然后在生产环境中运行它 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T05:32:35.413

谁将创建更新？如果是您，为什么不在更新完成时将更新推送到服务器？写入更新后，只需对其进行 rsync，服务器将立即更新。它胜过 cron，而且绝对胜过用户等待页面加载时的检查。

# oracle - 使用 oracle 11g 客户端和 10g 服务器可以吗？

> ID：454624
> 
> 赞同：16
> 
> 时间：2009-01-18T04:02:34.473
> 
> 标签：oracle, oracle10g, oracle11g, odp.net

我正在创建一个使用 odp.net 的 .NET 程序，特别是 11g 版本。我们的 oracle 服务器运行 10g。我在开发过程中为时已晚，无法做出改变。我要找麻烦了吗？您是否有针对 10g 服务器运行 11g 客户端的经验？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-18T04:10:32.193

是的，没关系。Oracle 建议客户端版本应该 >= 服务器版本。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-18T10:15:57.323

您可以将 odp.net 11 与 Oracle 服务器 9、10 和 11 一起使用。是的，我已经尝试了所有这些组合。

例如，您可以使用 odp.net 11 从 Oracle 服务器 9、10 和 11 检索地理信息 (datatype=mdsys.sdo_geometry)。我使用此示例是因为选择 mdsys.sdo_geometry 数据的可能性已添加到 odp.net 11.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T22:39:43.593

请参阅以下有关 Metalink 的文档。

这包含 ODP 驱动程序版本、支持的操作系统、SQL*Net、RDBMS、.NET Framework、Visual Studio 的矩阵

主题：Oracle Data Provider for .NET (ODP) Supported Configurations 文档 ID：726240.1

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-25T20:34:38.350

针对 10g 数据库使用 Oracle 11 客户端将起作用。我以前也针对 9i 数据库使用过 11g 客户端。

# php - $_SESSION 变量存储在哪里？

> ID：454635
> 
> 赞同：174
> 
> 时间：2009-01-18T04:10:54.707
> 
> 标签：php

变量是`$_SESSION`存储在客户端还是服务器上？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2009-01-18T04:32:48.950

变量存储的位置`$_SESSION`由 PHP 的`session.save_path`配置决定。通常这是`/tmp`在 Linux/Unix 系统上。如果不是 100% 确定，请使用该功能通过在您的域中`phpinfo()`创建包含此内容的文件来查看您的特定设置：`DocumentRoot`

```
<?php
    phpinfo();
?> 
```

以下是有关此配置设置的 PHP 文档的链接：

[http://php.net/manual/en/session.configuration.php#ini.session.save-path](http://php.net/manual/en/session.configuration.php#ini.session.save-path)

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2009-01-18T13:08:41.407

如前所述，内容存储在服务器上。但是，会话由会话 ID 标识，会话 ID 存储在客户端并随每个请求一起发送。通常会话 ID 存储在 cookie 中，但也可以附加到 url。（这是`PHPSESSID`您有时会看到的查询参数）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-01-18T04:34:44.953

它们通常存储在服务器上。它们的存储位置取决于您作为开发人员。您可以使用`session.save_handler`配置变量和[`session_set_save_handler`](http://us.php.net/manual/en/function.session-set-save-handler.php)控制会话如何保存在服务器上。默认保存方法是将会话保存到文件。他们保存的位置由`session.save_path`变量控制。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2012-08-08T17:11:35.957

一个补充：应该注意的是，如果“/tmp”是存储会话数据的目录（这似乎是默认值），则在该 Web 服务器重新启动后会话将不会持续存在，如“/tmp " 通常在重新启动期间被清除。客户端持久性的概念与服务器上存储的持久性有关——如果“/tmp”目录用于会话数据，这可能会失败。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-01-18T21:23:26.143

在 Debian 上（大多数 Linux 发行版不是这样吗？），它保存在 /var/lib/php5/ 中。如上所述，它是在您的 php.ini 中配置的。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-07-17T09:15:38.577

我正在使用 Ubuntu，我的会话存储在 /var/lib/php5 中。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-18T04:14:07.913

正如 Taylor 先生所指出的，这通常是在 php.ini 中设置的。通常它们作为文件存储在特定目录中。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-03-03T09:27:26.730

对于 ubuntu 16.10，会话保存在 /var/lib/php/session/...

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-03-19T11:43:42.520

在我的 Ubuntu 机器中，会话存储在

```
/var/lib/php/sessions 
```

你必须`sudo ls`在这个目录中只有`ls`它会抛出

> ls: 无法打开目录'.': 权限被拒绝

在我的 Windows Wamp 服务器上，php 会话存储在

```
C:\wamp64\tmp 
```

如果您在 Windows 上安装独立 php，则默认情况下没有设置值

```
session.save_path => no value => no value 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-07-15T07:45:14.910

它是如何工作的？它怎么知道是我？

大多数会话在用户计算机上设置一个用户密钥（称为 sessionid），如下所示：765487cf34ert8dede5a562e4f3a7e12。然后，当在另一个页面上打开会话时，它会扫描计算机以查找用户密钥并运行到服务器以获取您的变量。

如果您错误地清除了缓存，那么您的用户密钥也将被清除。由于您不知道自己的 ID，因此您将无法再从服务器获取变量。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-01-07T08:29:18.457

默认情况下，可通过全局变量访问的 PHP 会话作为文件`$_SESSION`存储在**服务器上。**对它的引用（称为`session_id`）也作为浏览器 cookie 存储在客户端。如果其中任何一个被删除，则会话将变为无效。

[您可以使用PHP Custom Session Handlers](https://www.php.net/manual/en/session.customhandler.php)将存储更改为 database/Redis/memcache 等。还有一些可用于不同存储的扩展，如 sqlite、memcache 和 memcached。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-10-15T12:42:40.563

上面的许多答案都是不透明的。在我看来，这个问题的作者只是想知道会话变量默认存储在哪里。据此：[https](https://canvas.seattlecentral.edu/courses/937693/pages/10-advanced-php-sessions) ://canvas.seattlecentral.edu/courses/937693/pages/10-advanced-php-sessions 默认情况下它们只是**存储在服务器上**。希望其他人会发现这种贡献是有意义的。

# python - Pythonic 宏语法

> ID：454648
> 
> 赞同：20
> 
> 时间：2009-01-18T04:22:27.333
> 
> 标签：python, syntax, macros

我一直在为 Python 开发一个替代编译器前端，其中所有语法都通过宏进行解析。我终于明白了它的发展，我可以开始研究 Python 语言的超集，其中宏是一个不可或缺的组件。

我的问题是我无法提出 pythonic 宏定义语法。我在下面的答案中以两种不同的语法发布了几个示例。谁能想出更好的语法？它不必以任何方式构建我提出的语法——我在这里完全开放。任何评论、建议等都会有所帮助，显示我发布的示例的替代语法也会有所帮助。

关于宏结构的注释，如我发布的示例所示： MultiLine/MLMacro 和 Partial/PartialMacro 的使用告诉解析器如何应用宏。如果是多行，宏会匹配多行列表；一般用于构造。如果它是部分的，宏将匹配列表中间的代码；一般用于操作员。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T13:48:47.700

几天前考虑了一下，没有什么值得发的东西，我现在回到它，想出了一些我比较喜欢的语法，因为它几乎看起来像 python：

```
macro PrintMacro:
  syntax:
    "print", OneOrMore(Var(), name='vars')

  return Printnl(vars, None) 
```

*   使所有宏“关键字”看起来像创建 python 对象（`Var()`而不是简单`Var`）
*   将元素的名称作为“关键字参数”传递给我们想要命名的项目。在解析器中找到所有名称应该仍然很容易，因为无论如何这个语法定义都需要以某种方式解释以填充宏类语法变量。

    需要转换以填充生成的宏类的语法变量。

内部语法表示也可能看起来相同：

```
class PrintMacro(Macro):
  syntax = 'print', OneOrMore(Var(), name='vars')
  ... 
```

内部语法类 like`OneOrMore`将遵循此模式以允许子项和可选名称：

```
class MacroSyntaxElement(object):
  def __init__(self, *p, name=None):
    self.subelements = p
    self.name = name 
```

当宏匹配时，您只需收集所有具有名称的项目并将它们作为关键字参数传递给处理函数：

```
class Macro():
   ...
   def parse(self, ...):
     syntaxtree = []
     nameditems = {}
     # parse, however this is done
     # store all elements that have a name as
     #   nameditems[name] = parsed_element
     self.handle(syntaxtree, **nameditems) 
```

然后处理函数将被定义如下：

```
class PrintMacro(Macro):
  ...
  def handle(self, syntaxtree, vars):
    return Printnl(vars, None) 
```

我将语法树添加为始终传递的第一个参数，因此如果您只想在语法树上执行非常基本的操作，则不需要任何命名项。

此外，如果您不喜欢装饰器，为什么不添加宏类型，如“基类”？`IfMacro`然后看起来像这样：

```
macro IfMacro(MultiLine):
  syntax:
    Group("if", Var(), ":", Var(), name='if_')
    ZeroOrMore("elif", Var(), ":", Var(), name='elifs')
    Optional("else", Var(name='elseBody'))

  return If(
      [(cond, Stmt(body)) for keyword, cond, colon, body in [if_] + elifs],
      None if elseBody is None else Stmt(elseBody)
    ) 
```

在内部表示中：

```
class IfMacro(MultiLineMacro):
  syntax = (
      Group("if", Var(), ":", Var(), name='if_'),
      ZeroOrMore("elif", Var(), ":", Var(), name='elifs'),
      Optional("else", Var(name='elseBody'))
    )

  def handle(self, syntaxtree, if_=None, elifs=None, elseBody=None):
    # Default parameters in case there is no such named item.
    # In this case this can only happen for 'elseBody'.
    return If(
        [(cond, Stmt(body)) for keyword, cond, body in [if_] + elifs],
        None if elseNody is None else Stmt(elseBody)
      ) 
```

我认为这将提供一个非常灵活的系统。主要优点：

*   易于学习（看起来像标准 python）
*   易于解析（像标准 python 一样解析）
*   可以轻松处理可选项目，因为您可以`None`在处理程序中有一个默认参数
*   灵活使用命名项目：
    *   如果你不想，你不需要命名任何项目，因为语法树总是被传入。
    *   您可以在大宏定义中命名任何子表达式，因此很容易挑选出您感兴趣的特定内容
*   如果您想向宏结构添加更多功能，则可以轻松扩展。例如`Several("abc", min=3, max=5, name="a")`. 我认为这也可以用于将默认值添加到可选元素，如`Optional("step", Var(), name="step", default=1)`.

我不确定带有“quote:”和“$”的引用/取消引用语法，但是需要一些语法，因为如果您不必手动编写语法树，它会使生活变得更容易。要求（或只是允许？）“$”的括号可能是个好主意，这样您就可以根据需要插入更复杂的语法部分。喜欢`$(Stmt(a, b, c))`。

ToMacro 看起来像这样：

```
# macro definition
macro ToMacro(Partial):
  syntax:
    Var(name='start'), "to", Var(name='end'), Optional("inclusive", name='inc'), Optional("step", Var(name='step'))

  if step == None:
    step = quote(1)
  if inclusive:
    return quote:
      xrange($(start), $(end)+1, $(step))
  else:
    return quote:
      xrange($(start), $(end), $(step))

# resulting macro class
class ToMacro(PartialMacro):
  syntax = Var(name='start'), "to", Var(name='end'), Optional("inclusive", name='inc'), Optional("step", Var(name='step'))

  def handle(syntaxtree, start=None, end=None, inc=None, step=None):
    if step is None:
      step = Number(1)
    if inclusive:
      return ['xrange', ['(', start, [end, '+', Number(1)], step, ')']]
    return ['xrange', ['(', start, end, step, ')']] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T04:55:21.500

您可能会考虑查看 Boo（一种基于 .NET 的语言，其语法很大程度上受 Python 启发）如何实现宏，如在[http://boo.codehaus.org/Syntactic+Macros](http://boo.codehaus.org/Syntactic+Macros)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T23:30:26.880

你应该看看[MetaPython](https://code.google.com/p/metapython/)看看它是否完成了你正在寻找的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T19:33:49.847

结合[BNF](http://en.wikipedia.org/wiki/Backus-Naur_form)

```
class IfMacro(Macro):
    syntax: "if" expression ":" suite ("elif" expression ":" suite )* ["else" ":" suite] 

    def handle(self, if_, elifs, elseBody):
        return If(
            [(expression, Stmt(suite)) for expression, suite in [if_] + elifs],
            elseBody != None and Stmt(elseBody) or None
            ) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-20T10:05:14.093

我正在发布一些浮动的想法，看看它是否能激发灵感。我不太了解python，而且我没有使用真正的python语法，但它什么都比不上：p

```
macro PrintMacro:
  syntax:  
          print $a
  rules:  
        a: list(String),  as vars
  handle:
       # do something with 'vars' 

macro IfMacro:
  syntax: 
      if $a :
          $b
      $c 
   rules: 
        a: 1 boolean  as if_cond 
        b: 1 coderef     as if_code 
        c: optional macro(ElseIf) as else_if_block 

    if( if_cond ):
          if_code();
    elsif( defined else_if_block ): 
          else_if_block(); 
```

更多想法：

实现 Perl 引用样式，但在 Python 中！（这是一个非常糟糕的实现，请注意：空格在规则中很重要）

```
macro stringQuote:
  syntax:  
          q$open$content$close
  rules:  
        open:  anyOf('[{(/_') or anyRange('a','z') or anyRange('0','9');
        content: string
        close:  anyOf(']})/_') or anyRange('a','z') or anyRange('0','9');
  detect: 
      return 1 if open == '[' and close == ']' 
      return 1 if open == '{' and close == '}'
      return 1 if open == '(' and close  == ')'
      return 1 if open == close 
      return 0
  handle: 
      return content; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-20T10:24:32.137

这是我根据 Kent Fredric 的想法提出的一种新的宏语法。就像解析代码一样，它将语法解析为列表。

打印宏：

```
macro PrintMacro:
    syntax:
      print $stmts

  if not isinstance(stmts, list):
    stmts = [stmts]
  return Printnl(stmts, None) 
```

如果是宏：

```
@MultiLine
macro IfMacro:
  syntax:
    @if_ = if $cond: $body
    @elifs = ZeroOrMore(elif $cond: $body)
    Optional(else: $elseBody)

  return If(
      [(cond, Stmt(body)) for cond, body in [if_] + elifs],
      elseBody != None and Stmt(elseBody) or None
    ) 
```

X 到 Y [含] [步骤 Z] 宏：

```
@Partial
macro ToMacro:
  syntax:
    $start to $end Optional(inclusive) Optional(step $step)

  if step == None:
    step = quote 1
  if inclusive:
    return quote:
      xrange($start, $end+1, $step)
  else:
    return quote:
      xrange($start, $end, $step) 
```

除了使用装饰器来识别宏类型的小问题之外，我唯一真正的问题是您可以命名组的方式，例如在 if 情况下。我正在使用@name = ...，但这只是 Perl 的味道。我不想只使用 name = ... 因为这可能与要匹配的宏模式冲突。有任何想法吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T04:18:19.360

如果您只是询问 Python 中宏的语法（而不是实现），那么我相信答案是显而易见的。语法应该与 Python 已有的语法非常匹配（即“ `def`”关键字）。

您是否将其实现为以下之一取决于您：

```
def macro largest(lst):
defmac largest(lst):
macro largest(lst): 
```

但我认为它应该与其他功能的正常功能完全相同，以便：

```
def twice_second(a,b):
    glob_i = glob_i + 1
    return b * 2
x = twice_second (1,7); 
```

和

```
defmac twice_second(a,b):
    glob_i = glob_i + 1
    return b * 2
x = twice_second (1,7); 
```

在功能上是等效的。

我实现这一点的方法是使用预处理器（a la C），它将：

*   用输入文件中的 defs 替换所有 defmac。
*   通过 Python 传递它以检查语法（偷偷摸摸的位，this）。
*   把defmac的放回去。
*   找到每个宏的所有用途并“内联”它们，使用您自己的保留变量，例如将本地 var 转换`a`为`__macro_second_local_a`.
*   返回值也应该是一个特殊变量（macro_second_retval）。
*   全局变量将保留其真实名称。
*   参数可以被赋予 _macro_second_param_XXX 名称。
*   完成所有内联后，完全删除 defmac 'functions'。
*   通过 Python 传递结果文件。

毫无疑问，会有一些琐事需要处理（比如元组或多个返回点），但在我看来，Python 足够强大来处理这些问题。

所以：

```
x = twice_second (1,7); 
```

变成：

```
# These lines are the input params.
__macro_second_param_a = 1
__macro_second_param_b = 7

# These lines are the inlined macro.
glob_i = glob_i + 1
__macro_second_retval = __macro_second_param_b * 2

# Modified call to macro.
x = __macro_second_retval 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-20T09:37:13.587

这是当前使用标准 Python 类定义语法的机制。

打印宏：

```
class PrintMacro(Macro):
  syntax = 'print', Var
  def handle(self, stmts):
    if not isinstance(stmts, list):
      stmts = [stmts]
    return Printnl(stmts, None) 
```

if/elif/else 宏类：

```
class IfMacro(MLMacro):
  syntax = (
      ('if', Var, Var),
      ZeroOrMore('elif', Var, Var),
      Optional('else', Var)
    )
  def handle(self, if_, elifs, elseBody):
    return If(
        [(cond, Stmt(body)) for cond, body in [if_] + elifs],
        elseBody != None and Stmt(elseBody) or None
      ) 
```

X到Y【含】【步骤Z】宏类：

```
class ToMacro(PartialMacro):
  syntax = Var, 'to', Var, Optional('inclusive'), Optional('step', Var)
  def handle(self, start, end, inclusive, step):
    if inclusive:
      end = ['(', end, '+', Number(1), ')']
    if step == None: step = Number(1)
    return ['xrange', ['(', start, end, step, ')']] 
```

我对这个设计的问题是事情非常冗长，至少感觉不到pythonic。此外，报价能力的缺乏使得复杂的宏变得困难。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-20T09:38:34.117

这是我为我的 Python 超集提出的宏语法。

打印宏：

```
macro PrintMacro:
    syntax:
        stmts = 'print', Var

  if not isinstance(stmts, list):
    stmts = [stmts]
  return Printnl(stmts, None) 
```

如果是宏：

```
@MultiLine
macro IfMacro:
  syntax:
    if_ = 'if', Var, Var
    elifs = ZeroOrMore('elif', Var, Var)
    else_ = Optional('else', Var)

  return If(
      [(cond, Stmt(body)) for cond, body in [if_] + elifs],
      elseBody != None and Stmt(elseBody) or None
    ) 
```

X 到 Y [含] [步骤 Z] 宏：

```
@Partial
macro ToMacro:
  syntax:
    start = Var
    'to'
    end = Var
    inclusive = Optional('inclusive')
    step = Optional('step', Var)

  if step == None:
    step = quote 1
  if inclusive:
    return quote:
      xrange($start, $end+1, $step)
  else:
    return quote:
      xrange($start, $end, $step) 
```

我的主要问题是语法块不清楚，尤其是最后一个示例中的“to”行。我也不喜欢使用装饰器来区分宏类型。

# api - API 设计：灵活性 Vs。便于使用

> ID：454649
> 
> 赞同：6
> 
> 时间：2009-01-18T04:24:09.077
> 
> 标签：api, frameworks

当编写一个库或模块的公共 API 时，将在各种用例中被许多其他代码使用，平衡灵活性和易用性的最佳方法是什么？我相信这两者经常发生冲突，你做的东西越灵活，就越难让它做好任何一件特定的事情。

例如，C++ STL 使用迭代器，恕我直言，迭代器级别非常低，使用起来很烦人，但作为交换，它们非常灵活，允许相同的代码在各种 STL 容器上运行。另一个例子是 Java 标准库的设计理念，它的小类非常具体，旨在实现最大的模块化和灵活性，而 Python 标准库则偏爱更扁平的类层次结构，这使得处理常见用例更简单. 这样的事情应该如何平衡？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T04:34:32.193

我认为您需要考虑该库的目标受众——如果您正在编写一个经验不足的开发人员可能会很好使用的库，您必须考虑如何帮助他们。在 C++ STL 的情况下，可能大多数使用它们的开发人员并不介意额外的机​​制，因为他们已经习惯了它们并且更看重灵活性。

您可能需要考虑通过 API 进行两层访问，一层是让事情变得简单，另一层是允许更多控制。但是您可能想先了解一下框架是如何发展的，然后再进行讨论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T23:40:07.543

如果您是一个标准机构的一员，可以强制其他人使用您的类，那么您可以使用灵活和复杂的方法（例如 stl）。

对于其他所有人，除非有一些真正令人信服的理由，否则易用性应该始终是您的首选。否则，很少有人会使用您的代码/API。如果使用别人的代码的学习曲线很高，那么大多数人会选择只重新实现他们需要的部分。这通常更快，问题更容易解决。

在我看来，在评价代码质量时，“易于理解”仅次于“它可以正常工作”。

所以底线是，如果增加灵活性是以牺牲易于学习和使用为代价的，那么在证明灵活性是必要的之前不要增加灵活性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T04:48:10.527

我喜欢 .NET 基类库 API。图书馆的设计大多遵循[这些准则。](http://msdn.microsoft.com/en-us/library/ms229042.aspx)

在阅读这些以及随附的书籍时，我掌握了几个关键知识：

1.  API 的设计考虑到现代编辑器具有智能感知功能。较长的名称是可以接受的，因为您可以使用制表符来完成类和方法名称。这与具有较短、混淆名称的 C 风格函数相反，例如`strnicmp()`

2.  创建、设置、调用模式的使用：总是有一个默认的、无参数的构造函数。提供可以按任意顺序设置的属性，然后允许调用方法。使用此模式允许对象在短时间内处于无效状态。（在调用构造函数之后，但在设置任何属性之前）但这没关系。您可以通过抛出异常来传达 API 滥用。这使得使用该类更加平易近人。

# c# - 如何启用或禁用一列文本框？

> ID：454658
> 
> 赞同：0
> 
> 时间：2009-01-18T04:32:23.740
> 
> 标签：c#

现在我想以最好的方式启用或禁用该列文本框，也许不使用数组或循环。我该怎么做？

```
// create a column of textboxes dynamically
   private void CreateControl(int ControlId)
{

            CheckBox control1 = new CheckBox();

            control1.Click += new EventHandler(chk_CheckedChanged);

            Point point = GetPoint(ControlId);
        control1.Location = point;
        this.Controls.Add(control1);

}

// a check box to enable or disable that column of textboxes
private void checkBox1_CheckedChanged(object sender, EventArgs e)
{
    Column column = new Column();
  CheckBox  chk = (CheckBox) sender;
  if (chk.Checked)
  {

      column.EnterName.Enabled = true;
// I want to enable or disable the entire column of textboxes

  }
}

Public Class Column 
{
  public TextBox EnterName {get;set;}
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T06:13:36.767

*   添加一个 GroupBox 或一个面板（如果你不创造那里什么都没有的错觉......没有边框）来容纳文本框列
*   根据需要切换 Groupbox 的 Enabled 属性。

我认为那行得通。

# c++ - Linux中的语音到文本转换

> ID：454664
> 
> 赞同：5
> 
> 时间：2009-01-18T04:35:08.743
> 
> 标签：c++, linux, interface, speech-recognition

我打算在 Linux 中启动一个将语音转换为文本的应用程序。是否有任何现有接口以便我可以扩展它们？或者Linux中是否有任何这样的现有应用程序？对此有任何意见吗？

编辑：我计划编写的应用程序应该能够将我们所说的每个单词转换为文本，而不仅仅是是/否。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-18T04:44:11.457

嗯，这是一项艰巨的任务，不用说你想使用什么技术，这里有一些链接：

*   维基百科上的[语音识别](http://en.wikipedia.org/wiki/Speech_recognition)
*   [Java 语音 API](http://java.sun.com/products/java-media/speech/)
*   [W3C 语音识别语法规范](http://www.w3.org/TR/speech-grammar/)
*   [Sphinx](http://cmusphinx.sourceforge.net/sphinx4/) - 用 Ja​​va 编写的开源识别引擎

祝你好运。有了更多的细节，我们或许能够提供更好的答案。例如，“是/否”呼叫中心式识别与部分自然语言理解之间存在很大差异。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T06:53:39.557

戴夫的建议是一个很好的开始。斯芬克斯非常漂亮。

我只想补充一点，你应该尽可能地概率。作为一名一次性语言学家，甚至更早的一次性音韵学爱好者，我可以自信地说不要被语言模型所困扰。让我们不要忘记经常被错误归因的“每次我解雇语言学家，我的准确性都会提高”。这实际上是关于模型及其解释噪音和变化的能力，而不是麻省理工学院文科专业必须说的任何东西。

一本好书是 Jurafsky 和 ​​Martin 的“语音和语言处理”。它对任务的计算模型有一些非常有用的应用。Harvey Sussman 对各种元音的 F2 斜率中的线性相关的研究（从谷仓猫头鹰开始，一直向人类发展）似乎在当今的模型中实现是一件好事。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-03T05:12:56.357

[Julius](http://julius.sourceforge.jp/en_index.php)也是 Linux 的不错选择

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T06:02:01.683

Sphinx 是您在 Linux 上的最佳选择。我已经尝试过 Sphinx II 和 Sphinx III。有一些可用的开源语言和声学模型可以与它们中的每一个一起使用。根本不是生产级别的性能，但足以用于原型设计或演示。对于生产，您需要开发自己的语言和声学模型。

# batch-file - 批量：从带有路径和文件名的变量中读取文件名

> ID：454670
> 
> 赞同：8
> 
> 时间：2009-01-18T04:46:40.157
> 
> 标签：batch-file, dos, filenames

我目前正在寻找一种方法来批量获取变量并且只解析出文件名。

例如，我从另一个应用程序传递我的批处理文件 -s 参数，该参数随后设置为我的源变量。源文件变量通常包含如下内容：C:\Program Files\myapp\Instance.1\Data\filetomove.ext。

我假设从变量的末尾读取直到第一个“\”并将结果设置为新的变量文件名，但我无法成功使用“for /f”命令。

任何帮助将非常感激！

更新：只有标准的 XP 或 Windows 2000/2003 可用...（不能假设已安装资源工具包）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-18T04:54:15.477

如果它作为脚本的参数出现，即 %1、%2 等，您可以只将文件名和扩展名提取到一个变量中，如下所示：

```
set FILENAME=%~nxN 
```

其中 N 是参数的索引。例如，此脚本将仅回显第一个参数的文件名：

```
@echo off
set FILENAME=%~nx1
echo %FILENAME% 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-27T23:33:53.550

略微改进的版本：

```
set FILENAME="%~nx1" 
```

额外的括号将确保在批处理执行期间不会干扰特殊字符，例如“&”。

# visual-c++ - 如何在 Visual C++ 中保持控制台窗口打开？

> ID：454681
> 
> 赞同：203
> 
> 时间：2009-01-18T05:00:22.623
> 
> 标签：visual-c++, console

我从 Visual C++ 开始，我想知道如何保留控制台窗口。

例如，这将是一个典型的“hello world”应用程序：

```
int _tmain(int argc, _TCHAR* argv[])
{
    cout << "Hello World";
    return 0;
} 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：403
> 
> 时间：2009-07-20T10:53:43.143

`Ctrl`使用+`F5`而不是仅启动项目`F5`。

`Press any key to continue . . .`程序退出后，控制台窗口现在将保持打开状态并显示消息。

请注意，这需要`Console (/SUBSYSTEM:CONSOLE)`链接器选项，您可以按如下方式启用该选项：

1.  打开您的项目，然后转到解决方案资源管理器。如果您在 K&R 中与我一起关注，您的“解决方案”将是“你好”，其下有 1 个项目，“你好”以粗体显示。
2.  右键单击“你好”（或任何您的项目名称。）
3.  从上下文菜单中选择“属性”。
4.  选择配置属性>链接器>系统。
5.  对于右侧窗格中的“子系统”属性，单击右侧列中的下拉框。
6.  选择“控制台 (/SUBSYSTEM:CONSOLE)”
7.  单击应用，等待它完成它所做的一切，然后单击确定。（如果“应用”是灰色的，选择其他子系统选项，单击应用，然后返回并应用控制台选项。我的经验是 OK 本身不起作用。）

CTRL-F5 和子系统提示一起工作；它们不是单独的选项。

[（由http://social.msdn.microsoft.com/Forums/en-US/vcprerelease/thread/21073093-516c-49d2-81c7-d960f6dc2ac6](http://social.msdn.microsoft.com/Forums/en-US/vcprerelease/thread/21073093-516c-49d2-81c7-d960f6dc2ac6)提供的 DJMorreTX 提供）

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-01-18T05:04:06.610

标准方法是`cin.get()`在您的退货声明之前。

```
int _tmain(int argc, _TCHAR* argv[])
{
    cout << "Hello World";
    cin.get();
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-07-20T10:57:11.060

在行上放一个断点`return`。

您正在调试器中运行它，对吗？

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-01-18T05:08:54.027

另一种选择是使用

```
#include <process.h>
system("pause"); 
```

虽然这不是很便携，因为它只能在 Windows 上运行，但它会自动打印

> 按任意键继续...

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-04-25T09:08:07.357

对于 makefile 项目，由于 Visual Studio 中的错误（至少在 2012 版本之前存在 - 我尚未测试 2013），因此接受的解决方案失败。[此处](https://connect.microsoft.com/VisualStudio/feedback/details/540969/missing-press-any-key-to-continue-when-lauching-with-ctrl-f5)详细介绍了此错误。

为了在 makefile 项目的程序终止后让控制台暂停，请执行以下步骤（对于 2010 - 2012 以外的版本，这可能会有所不同）：

~~1）传递`/SUBSYSTEM:CONSOLE`给链接器。~~-**编辑**：见下文。

2) 在文本编辑器中打开您的项目文件 (.vcxproj)。

3) 在根`<project>`标签内，插入以下内容：

> ```
> <ItemDefinitionGroup>
>   <Link>
>     <SubSystem>Console</SubSystem>
>   </Link>
> </ItemDefinitionGroup> 
> ```

4）在您的解决方案中重新加载项目。

5) 在不调试的情况下运行程序 (CTRL + F5)。

**编辑：**

根据我在下面的评论，设置链接器选项`/SUBSYSTEM:CONSOLE`实际上与 makefile 项目无关（如果您使用的是 MSVC 以外的编译器，甚至不一定可能）。重要的是按照上面的步骤 3 将设置添加到 .vcxproj 文件中。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-18T05:05:49.383

您可以在 return 语句之前使用`cin.get();`or来避免控制台窗口关闭。`cin.ignore();`

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-06-07T04:12:09.980

只需在 main 的最后一个大括号上放一个断点。

```
 int main () {
       //...your code...
       return 0;
    } //<- breakpoint here 
```

它对我有用，无需调试即可运行。它还在断点之前执行析构函数，因此您可以检查这些析构函数上打印的任何消息（如果有）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-03-25T16:44:15.867

只需在`_tmain`方法的右括号中添加一个断点。这是更简单的方法，而且您无需添加代码即可进行调试。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-04-12T07:25:56.343

```
int main()
{
    //...
    getchar();
    return 0;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-30T19:41:16.907

`cin.get()`, 或`system("PAUSE")`. 没听说可以用`return(0);`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-01-30T23:40:16.327

在 . 的结尾大括号上放置一个断点`main()`。`return`即使有多个语句，它也会被绊倒。唯一的缺点是调用`exit()`不会被捕获。

如果您没有调试，请按照 Zoidberg 的回答中的建议，并使用`Ctrl`+`F5`而不是. 来启动您的程序`F5`。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-18T16:14:11.660

我的 2 美分：

选择1：在末尾添加断点`main()`

`return 0;`选择 2：在:之前添加此代码

```
std::cout << "Press ENTER to continue..."; //So the User knows what to do
std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n'); 
```

你需要`<iomanip>`包括[`std::numeric_limits`](http://en.cppreference.com/w/cpp/types/numeric_limits)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-02-13T23:55:09.723

只需在代码末尾添加 system("pause") ，然后像这样返回 0

```
#include <stdlib.h>

int main()
{
    //some code goes here
    system("pause")
    return 0;
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-06-02T15:42:24.147

正如一些人已经指出的那样，Zoidbergs 解决方案不附加调试器，这是您通常不想要的。

imo 的最佳选择是相应地配置您的 VS（从 VS 2017 开始），方法是转到工具 > 选项 > 调试 > 常规。在那里你取消选中“调试停止时自动关闭控制台”（在最底部），这可能在你的情况下被选中。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-30T06:51:15.277

我包括`#include <conio.h>`，然后在行`getch();`前添加`return 0;`。反正我在学校就是这么学的。我看到的上面提到的方法完全不同。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-01-11T13:48:41.330

有同样的问题。我 `_getch()`在 return 语句之前使用。有用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-06-24T19:15:57.473

（有些选项可能叫不同的名字。我不使用英文版）

我遇到了同样的问题，当我使用“空项目”选项创建项目时，将项目创建为“Win32-console application”而不是“空项目”。在现在弹出的对话框中，您按“继续”，然后您可以选中“空项目”选项并按确认。之后 CTRL + F5 将打开一个不会自动关闭的控制台。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-07-25T14:29:03.113

我有同样的问题; 在我的应用程序中有多个 exit() 点，并且无法知道它到底在哪里退出，然后我发现了这一点：

```
atexit(system("pause")); 
```

或者

```
atexit(cin.get()); 
```

这样，无论我们在程序中的哪个位置退出，它都会停止。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-10-15T06:58:07.297

另外一个选项：

```
#ifdef _WIN32
#define MAINRET system("pause");return 0
#else
#define MAINRET return 0
#endif 
```

主要：

```
int main(int argc, char* argv[]) {
    MAINRET;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-02-27T02:55:47.610

实际上，真正的解决方案是项目模板本身的选择。您必须在旧版 VS 中选择 Win32 控制台应用程序，或者先填写项目名称，然后双击 Windows 桌面向导，然后选择 Win32 控制台应用程序。然后此时选择空项目。然后，这允许原始提问者真正想要的东西，而无需添加额外的停止点和保持代码。我也遇到了这个问题。答案也在 MSDN 网站上。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-03-05T16:38:55.703

这是一种在不修改任何代码的情况下保持命令窗口打开的方法，无论执行如何停止：

在 Visual Studio 中，打开**Project Property Pages** -> **Debugging**。

对于**命令**，输入`$(ComSpec)`

对于**命令参数**，输入`/k $(TargetPath)`。将任何参数附加到您自己的应用程序。

现在**F5**或**Ctrl-F5**在新窗口中执行**Windows/System32/cmd.exe ，** **/k**确保命令提示符在执行完成后保持打开状态。

缺点是执行不会在断点处停止。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2017-02-24T16:38:02.997

你可以把keep_window_open(); 这里的return之前是一个例子

```
int main()
{
    cout<<"hello world!\n";
    keep_window_open ();
    return 0;
} 
```

# spring - Spring - 基于注释的控制器 - 基于查询字符串的请求映射

> ID：454689
> 
> 赞同：55
> 
> 时间：2009-01-18T05:15:57.413
> 
> 标签：spring, annotations

在 Spring 基于注解的控制器中，是否可以将不同的查询字符串映射`@RequestMapping`到不同的方法？

例如

```
@RequestMapping("/test.html?day=monday")
public void writeMonday() {
}

@RequestMapping("/test.html?day=tuesday")
public void writeTuesday() {
} 
```

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-01-18T05:22:18.977

是的，您可以使用[params](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/web/bind/annotation/RequestMapping.html#params())元素：

```
@RequestMapping("/test.html", params = "day=monday")
public void writeMonday() {
}

@RequestMapping("/test.html", params = "day=tuesday")
public void writeTuesday() {
} 
```

您甚至可以根据参数的*存在*与否进行*映射*：

```
@RequestMapping("/test.html", params = "day")
public void writeSomeDay() {
}

@RequestMapping("/test.html", params = "!day")
public void writeNoDay() {
} 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-07-06T13:33:44.880

或者您可以执行以下操作：

```
@RequestMapping("/test.html")
public void writeSomeDay(@RequestParam String day) {
   // code to handle "day" comes here...
} 
```

# workflow - 在 Workflow 中需要监听多个事件

> ID：454690
> 
> 赞同：0
> 
> 时间：2009-01-18T05:16:46.727
> 
> 标签：workflow, workflow-foundation

我需要一个需要监听多个事件的工作流，任何事件都会进一步推动工作流。

一些动作 --> 调用外部方法 --> 这里有 3 个事件，任何一个都是响应。

我可以在那里使用什么样的活动，我可以拥有三个事件处理程序。任何事件都会进一步推动它。

想过使用状态机工作流程，但如果有什么我可以使用的呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T02:10:56.437

无论您使用顺序工作流还是状态机工作流活动作为根工作流类型，您仍然可以处理事件。状态机在处理事件和交换状态方面要好得多，因为它几乎迫使你同时做这两件事。在我看来，它比顺序工作流更强大，并提供所有相同的功能以及一些功能。就个人而言，我没有理由再次使用顺序工作流程。

但是，顺序工作流程确实有一个很好的优点。它们很简单。没有什么比从上到下的工作流程更容易理解的了，如果您实际上让设计器可供最终用户使用，那就太好了。在顺序工作流中，您可以使用 ListenActivity 以相同的方式侦听事件。删除 ListenActivity，右键单击并根据需要添加尽可能多的不同分支，每个要侦听的事件一个。最后，在每个中删除并配置 HandleEventActivity，将它们分配给您要订阅的事件。

[侦听顺序工作流中的事件](http://blogs.microsoft.co.il/blogs/bursteg/archive/2006/07/13/Event-Driven-Activities.aspx "工作流程中的事件驱动活动")

[在状态机工作流中监听事件](http://www.odetocode.com/Articles/460.aspx "Windows 工作流中的状态机")

# python - 将单独的python包放入同一个命名空间？

> ID：454691
> 
> 赞同：19
> 
> 时间：2009-01-18T05:17:19.203
> 
> 标签：python, namespaces, distribution, extend

我正在开发一个 python 框架，它将“插件”编写为单独的包。IE：

```
import myframework
from myframework.addons import foo, bar 
```

现在，我正在尝试安排这些插件可以与核心框架分开分发并注入`myframework.addons`命名空间。

目前我对此的最佳解决方案如下。将部署一个附加组件（很可能`{python_version}/site-packages/`像这样：

```
fooext/
fooext/__init__.py
fooext/myframework/
fooext/myframework/__init__.py
fooext/myframework/addons/
fooext/myframework/addons/__init__.py
fooext/myframework/addons/foo.py 
```

将`fooext/myframework/addons/__init__.py`具有 pkg​​util 路径扩展代码：

```
import pkgutil
__path__ = pkgutil.extend_path(__path__, __name__) 
```

问题是，要让它工作，PYTHONPATH 需要`fooext/`在其中，但是它唯一的东西是父安装目录（很可能是上面提到的`site-packages`）。

对此的解决方案是有额外的代码在`myframework/addons/__init__.py`其中遍历`sys.path`并查找带有 myframework 子包的任何模块，在这种情况下，它将它添加到`sys.path`并且一切正常。

我的另一个想法是直接将插件文件写入`myframework/addons/`安装位置，但这会使开发和部署的命名空间有所不同。

有没有更好的方法来实现这一点，或者完全可以用不同的方法来解决上述分布问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-11-12T02:27:51.733

查看命名空间包：

[http://www.python.org/dev/peps/pep-0382/](http://www.python.org/dev/peps/pep-0382/)

或在 setuptools 中：

[http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages](http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T15:01:30.703

> 有没有更好的方法来实现这一点，或者完全可以用不同的方法来解决上述分布问题？

可能。Python 的模块/包设置通常很难像这样动态地篡改，但它的对象/类系统是开放的，并且可以以明确定义的方式进行扩展。当模块和包不具备很好地封装项目所需的功能时，您可以使用类来代替。

例如，您可以在完全不同的包中拥有扩展功能，但允许它通过特定接口将类注入您的基本框架。例如。myframework/_​​_​init​_​​_.py 包含一个基本的应用程序包装：

```
class MyFramework(object):
    """A bare MyFramework, I only hold a person's name
    """
    _addons= {}
    @staticmethod
    def addAddon(name, addon):
        MyFramework._addons[name]= addon

    def __init__(self, person):
        self.person= person
        for name, addon in MyFramework._addons.items():
            setattr(self, name, addon(self)) 
```

然后你可以在 myexts/helloer.py 中拥有扩展功能，它保留对它的“所有者”或“外部”MyFramework 类实例的引用：

```
class Helloer(object):
    def __init__(self, owner):
        self.owner= owner
    def hello(self):
        print 'hello '+self.owner.person

import myframework
myframework.MyFramework.addAddon('helloer', Helloer) 
```

所以现在如果你只是“导入 myframework”，你只会得到基本的功能。但是，如果您还“导入 myexts.helloer”，您还可以调用 MyFramework.helloer.hello()。当然，您还可以为插件定义协议以与基本框架行为以及彼此交互。如果您需要这种复杂程度，您还可以执行诸如框架的子类可以覆盖的内部类之类的事情以进行自定义，而不必对可能影响其他应用程序的类进行猴子补丁。

封装这样的行为可能很有用，但调整您已经必须适合此模型的模块级代码通常是令人讨厌的工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T05:35:28.273

Setuptools 能够按名称查找包“入口点”（函数、对象等）。Trac 使用这种机制来[加载它的插件](http://trac.edgewall.org/browser/trunk/trac/loader.py#L33)，并且运行良好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-10-24T18:23:01.177

命名空间有一个全新的设置。看看[Packaging namespace packages](https://packaging.python.org/guides/packaging-namespace-packages/)。简而言之，您有三个选项，具体取决于您希望代码向后兼容的程度。还有一个相关的 PEP，它取代了其他答案中提到的那些：[PEP 420](https://www.python.org/dev/peps/pep-0420/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T12:06:18.770

听起来你所追求的可以通过导入钩子巧妙地完成。

这是一种编写自定义加载代码的方式，它可以与一个包（或者在你的情况下是一个框架）相关联，以执行所有子包和模块的加载，而不是使用 python 的默认加载机制。然后，您可以将加载程序作为基础包安装在站点包中或在您的框架下。

当发现一个包与加载器相关联时（如果需要，可以简单地将其硬编码到相对路径），然后它将始终使用加载器来加载所有附加组件。这样做的好处是不需要对 PYTHONPATH 进行任何摆弄，这通常值得保持尽可能短。

另一种方法是使用**init**文件将子模块的导入调用重定向到您希望它接收的那个，但这有点混乱。

可以在此处找到有关导入挂钩的更多信息：

[http://www.python.org/dev/peps/pep-0302/](http://www.python.org/dev/peps/pep-0302/)

# css - 将照片位置与 css 对齐

> ID：454701
> 
> 赞同：1
> 
> 时间：2009-01-18T05:28:25.610
> 
> 标签：css, image

我目前的项目是一个新闻门户。一些用户能够将新闻与一些与之相关的媒体，如图片。目前，CSS 将图片放在右下角，文本之后。我想把照片放在右上角的文字周围，就像这个[例子](http://www.omelete.com.br/musi/100017548/Casey_Affleck_vai_documentar_turne_de_rapper_de_Joaquin_Phoenix_.aspx)一样。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T05:34:14.490

[CSS float 属性](http://css.maxdesign.com.au/floatutorial/)是您正在寻找的：

```
<div style="float:right">
  <img src="yourimage.jpg" />
  <p>Caption goes here...</p>
</div>
<div>
   The rest of your text goes here and
   will wrap around the image as in
   the example link you provided.
</div> 
```

# macos - Mac OS X：是什么导致了旋转的沙滩球？

> ID：454703
> 
> 赞同：11
> 
> 时间：2009-01-18T05:31:23.590
> 
> 标签：macos, busy-cursor

OS X 什么时候决定给你的应用一个旋转的沙滩球？在编写应用程序时可以做些什么来避免这种情况？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-18T05:38:46.680

当最前面的应用程序或鼠标指针下有一个窗口的应用程序在某个时间窗口内没有响应来自窗口服务器的事件时，窗口服务器将显示旋转等待光标。

为了避免旋转等待光标，应用程序需要及时处理事件。没有办法绕过这种窗口服务器行为，并且有充分的理由：Mac OS X 上的应用程序不应该对用户无响应。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-18T06:54:24.173

原因是您的应用程序阻止了 UI。正如其他海报所说，窗口管理器可以注意到您有一段时间没有处理事件并放置此 UI。

您很可能正在 UI（默认）线程上同步执行一些 IO（例如读取或写入磁盘，或执行网络请求）。保持应用程序响应（从而避免沙滩球）的一个好的经验法则是永远不要在 UI 线程上执行同步 IO。您可以使用异步 IO（接受回调的 API，在后台线程上工作，然后在完成后在 UI 线程上通知您），或者您可以使用单独的后台线程来完成工作。

如果您不进行 IO，那么您可能处于 UI 线程上的某种长循环中，导致您无响应。在这种情况下，要么优化或删除循环，要么将其移至后台线程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-18T06:04:20.780

假设您的应用程序有足够的硬件资源（实际上并不总是如此），那么您的应用程序真的没有理由去抢滩。如果确实如此，请找出阻塞用户界面的代码部分（如果它不直观，Shark.app 会派上用场）并将其移至后台线程（或使用其他策略来消除暂停）。幸运的是 Cocoa 和 Objective-C 有很好的线程工具，请参阅 NSOperationQueue 开始。Apple 也有一些关于性能调整的好文档，请参阅[此问题](https://stackoverflow.com/questions/420478/performance-tuning-in-cocoa-application#420713)以获取相关链接。

# wpf - WPF - 使用用户控件并设置设计时的高度和宽度

> ID：454706
> 
> 赞同：4
> 
> 时间：2009-01-18T05:33:36.473
> 
> 标签：wpf, user-controls, autosize

也许有人对此有答案。

我正在设计要添加到其他容器的用户控件，它们要适合其容器的可用空间。

所以这意味着不设置用户控件的高度和宽度。

但是当我设计控件时，我希望看到它的宽度和高度。

所以我当然不必继续设置和删除控件的宽度和高度

这个怎么处理？？？

马尔科姆

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-09T10:49:39.360

用这个

```
<UserControl x:Class="MyApp.UserControl1"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
         mc:Ignorable="d" 
         d:DesignHeight="500" d:DesignWidth="600"> 
```

# java - LLVM 和 java 字节码有什么区别？

> ID：454720
> 
> 赞同：77
> 
> 时间：2009-01-18T05:49:48.467
> 
> 标签：java, comparison, jvm, llvm

我不明白 LLVM 和 java（字节码）之间的区别，它们是什么？

-edit-“它们是什么”我的意思是 LLVM 和 java（字节码）之间的区别，而不是 LLVM 和 java 之间的区别。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-01-18T07:50:06.620

假设您的意思是 JVM 而不是 Java：

LLVM 是一个*低级*的基于寄存器的虚拟机。它旨在抽象底层硬件并在编译器后端（机器代码生成）和前端（解析等）之间划清界限。

JVM 是一个更高级别的基于堆栈的虚拟机。JVM 提供垃圾收集，具有对象和虚拟方法调用等概念。因此，JVM 为语言互操作性提供了更高级别的基础设施（很像微软的 CLR）。

（可以在 LLVM 上构建这些抽象，就像可以在 C 之上构建它们一样。）

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-11-22T20:41:27.107

太糟糕了，这个问题走错了路。我来寻找更详细的比较。

JVM 字节码和 LLVM 位码之间的最大区别在于 JVM 指令是面向堆栈的，而 LLVM 位码不是。这意味着 JVM 字节码不是将值加载到寄存器中，而是将值加载到堆栈中并从那里计算值。我相信这样做的一个优点是编译器不必分配寄存器，但我不确定。

LLVM 位码更接近机器级代码，但不受特定架构的约束。例如，我认为 LLVM 位码可以使用任意数量的逻辑寄存器。也许更熟悉 LLVM 的人可以在这里发言？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-06-05T21:05:04.347

JVM 字节码和 LLVM 字节码有相同点和不同点。就相似性而言，这是两个中间程序表示。因此，它们可以表示用不同编程语言编写的程序。例如，有将 Java、Closure、Scala 等转换为 JVM 字节码的前端，也有将 C、C++、Swift、Julia、Rust 等转换为 LLVM 字节码的前端。

这就是说，JVM 字节码和 LLVM 字节码在用途和设计上大不相同。从历史上看，JVM 字节码被设计为通过网络（例如 Internet）分布，并通过虚拟机在本地计算机中进行解释。这就是它基于堆栈的原因之一：通常，基于堆栈的字节码更小。

也许，在一开始，LLVM 字节码也被认为是可以解释的，但如果它发生了，它的目的会随着时间而改变。因此，LLVM 字节码是一种用于分析和优化的程序表示。它以静态单一分配格式编码，这更像是程序的数学抽象，而不是实际的可执行程序集。因此，例如，LLVM IR 中的 phi 函数等指令在典型的计算机体系结构中没有直接等效的指令。因此，尽管可以解释 LLVM 字节码（有一个名为 lli 的工具，它是 LLVM 工具链的一部分，可以做到这一点），但这并不是使用 LLVM IR 的最重要方式。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-05-19T14:53:59.333

Java 是一种编程语言，它使用 JVM 作为“即时”（JIT）执行的手段，而 LLVM 是一种编译器构建工具包，旨在为现有语言开发新语言和前端。LLVM*确实*有一个 JIT 引擎，但如果您不需要它，则不需要使用它。您可以抛弃 LLVM 汇编器、字节码或平台特定的汇编器，而不是使用 JIT 执行。

# python - Python得到正确的行尾

> ID：454725
> 
> 赞同：90
> 
> 时间：2009-01-18T06:01:14.157
> 
> 标签：python, line-endings

有没有一种简单的方法来获取当前操作系统使用的行尾类型？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-01-18T08:21:16.447

如果您正在对以文本模式打开的文件进行操作，那么您是正确的，换行符都显示为“ `\n`”。否则，您正在寻找[`os.linesep`](http://docs.python.org/library/os.html).

从[http://docs.python.org/library/os.html](http://docs.python.org/library/os.html)：

> 操作系统。**线间隔**
> 
> 用于在当前平台上分隔（或者更确切地说是终止）行的字符串。这可以是单个字符，例如 POSIX 的“\n”，也可以是多个字符，例如 Windows 的“\r\n”。写入以文本模式打开的文件时，不要使用 os.linesep 作为行终止符（默认）；在所有平台上使用单个 '\n'。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-18T06:07:20.540

哦，我想通了。显然，[PEP-278](http://www.python.org/dev/peps/pep-0278/)声明如下：

> 任何以输入文件结尾的行在 Python 中都将被视为“\n”，因此几乎不需要更改其他代码来处理通用换行符。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-18T08:21:36.040

如果指定测试resp。打开文件时正确使用二进制文件，并使用通用换行符，大多数时候您不必担心不同的换行符。

但如果必须，请使用[os.linesep](http://docs.python.org/library/os.html#os.linesep)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-04-19T21:47:51.740

os.linesep 很重要，因为它依赖于（顾名思义:)）在 os 上。

例如，在 Windows 上，它不是“\n”而是“\r\n”。

但是如果你不关心多平台的东西，你可以使用'\n'。

# c# - 在 Unity App.Config 文件中包含一个泛型类

> ID：454726
> 
> 赞同：10
> 
> 时间：2009-01-18T06:01:41.517
> 
> 标签：c#, generics, app-config, unity-container

我有一类类型`ISimpleCache<IBrokeredDataObject>`，我想在 App.Config 文件中添加为类型别名（然后是类型）

线

```
<typeAlias alias="ISimpleCacheOfIBrokeredDataObject" type="MyApplication.ISimpleCache<IBrokeredDataObject>, MyApplication" /> 
```

由于 <> 显然是错误的，但是我不相信逃避它们；

```
<typeAlias alias="ISimpleCacheOfIBrokeredDataObject" type="MyApplication.ISimpleCache&lt;IBrokeredDataObject&gt;, MyApplication" /> 
```

也是正确的。

我目前正在拆分我的代码以使用 Unity，因此距离可编译的代码库太远，无法快速测试，并希望在这里得到一些确认。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-18T06:58:35.227

看看[这篇](http://blogs.microsoft.co.il/blogs/gilf/archive/2008/07/25/working-with-generic-types-in-unity-configuration-section.aspx)博文：

> 为了编写泛型类型，请使用```符号后跟接口/类接收的泛型类型的数量。

同一页面中的评论说：

> 为了在泛型中使用常量类型，您需要使用方括号 ( `[[ ]]`)。

所以我猜你的配置文件应该包含这样的内容：

```
<typeAlias alias="ISimpleCacheOfIBrokeredDataObject"
   type="MyApplication.ISimpleCache`1[[MyApplication.IBrokeredDataObject, MyApplication]], MyApplication" /> 
```

请注意使用“重音”或“反引号”字符 ( ```)，而不是普通的单引号 ( `'`)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-09-22T15:37:03.617

我宁愿对上面的答案发表评论，但我的分数还不够高。

此处记录了 Type.GetType 方法（字符串）的语法：http: [//msdn.microsoft.com/en-us/library/w3f99sx1.aspx](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)

有很多例子，我在下面粘贴了其中的一些。

**具有一个类型参数的泛型类型**

```
Type.GetType("MyGenericType`1[MyType]") 
```

**具有两个类型参数的泛型类型**

```
Type.GetType("MyGenericType`2[MyType,AnotherType]") 
```

**具有两个程序集限定类型参数的泛型类型**

```
Type.GetType("MyGenericType`2[[MyType,MyAssembly],[AnotherType,AnotherAssembly]]") 
```

**具有程序集限定类型参数的程序集限定泛型类型**

```
Type.GetType("MyGenericType`1[[MyType,MyAssembly]],MyGenericTypeAssembly") 
```

**泛型类型，其类型参数是具有两个类型参数的泛型类型**

```
Type.GetType("MyGenericType`1[AnotherGenericType`2[MyType,AnotherType]]") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-05T10:20:50.900

这就是您如何使用接收两种泛型类型的类型：

```
<section name="doubleFamilyConfig"
         type="ConfigTest.Configuration.FamilySection`2[
               [ConfigTest.Types.Child, ConfigTest],
               [ConfigTest.Types.Parent, ConfigTest]
               ],
               ConfigTest" /> 
```

如果您愿意，您可以在不同的行上使用每种类型，以便更容易理解。请注意，第一个括号必须紧跟在类型 ( FamilySection`2**[** ) 之后。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-29T17:32:52.080

这是作为泛型参数的强签名类型。

```
<typeAlias alias="IPublisherOfXElement" type="MyLib.IX.IPublisher`1[[System.Xml.Linq.XElement, System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]], MyLib.IX" /> 
```

# postgresql - XP下的PostgreSQL认证

> ID：454730
> 
> 赞同：1
> 
> 时间：2009-01-18T06:06:17.420
> 
> 标签：postgresql

我使用的是 Windows XP，并且已经安装了 PostgreSQL 8.3.5-2。我可以通过 pgAdmin 创建数据库，但不能通过 Powershell 创建数据库。当我尝试时，我收到以下错误：

```
createdb：无法连接到数据库 postgres：致命：用户“gvkv”的密码验证失败
```

其中 postgres 是服务器唯一的用户帐户，“gvkv”是我工作的帐户。我尝试为服务器创建一个单独的帐户并在该帐户下安装，但安装程序不断崩溃。

更根本的是，我想创建一些 Powershell 脚本来自动执行各种数据库创建和管理任务，但此时我什至无法创建数据存储！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T09:00:11.157

我认为这是因为您是通过计算机的 IP 而不是 localhost 进行连接的。大多数数据库在连接到本地 IP 地址（即使来自本地应用程序）和 localhost 之间有所不同：第一个是外部连接，必须启用，第二个是本地连接，是允许的。

因此，请尝试连接到 localhost 并查看是否可行。

# project-management - 你如何告诉客户他们的项目或其中一部分需要重写？

> ID：454732
> 
> 赞同：3
> 
> 时间：2009-01-18T06:10:18.567
> 
> 标签：project-management

我的项目大部分都需要重写，特别是其中一部分非常需要它，原因有很多：

*   它不再被用于它的原始目的
*   代码被黑客攻击得很厉害，很难使用
*   他们想要的改变会把它撕成碎片
*   最初的设计并不是最好的，因为我们正在尝试一种新技术

不幸的是，一段被黑客攻击得如此严重的代码每分钟都在运行，并且随着网站被使用得越多，它所花费的时间就越长。

您如何告诉您的客户您需要花时间仔细考虑并重写它？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T06:14:09.403

“技术债务”是这种情况的术语——大多数时候，当我解释它时，我的经理们都非常接受这样的想法，从长远来看，它会节省时间。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T06:42:57.130

只需向您的客户解释，由于您提到的原因，与从头开始重写某些部分以满足新需求相比，使现有代码执行他们想要的操作将需要更多的时间和金钱。当您可以提供明确的经济利益时，通常会更容易提出理由。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T06:17:27.960

我通常会准确地告诉他们。如果他们对我感到恼火，我通常会解释说我作为顾问的部分工作是帮助严格定义他们的业务流程。我不确定这是否完全正确，但这通常就是大多数小企业如何在其操作程序上的文档为零并且没有意识到他们多久在现场制作东西的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T08:11:39.243

在长期项目中，您需要事先安排与客户的定期会议，目的是讨论项目的状态。通过这些定期会议，您和您的客户将很乐意谈论这类主题。

# git - 如何在 Git 中更改旧提交的时间戳？

> ID：454734
> 
> 赞同：931
> 
> 时间：2009-01-18T06:13:46.923
> 
> 标签：git, timestamp, commit, git-rewrite-history

[如何修改现有的未推送提交](https://stackoverflow.com/questions/179123/how-do-i-edit-an-incorrect-commit-message-in-git)的答案？描述一种修改尚未推送到上游的先前提交消息的方法。新消息继承原始提交的时间戳。这似乎合乎逻辑，但有没有办法也重新设定时间？

* * *

## 回答 #1

> 赞同：968
> 
> 时间：2011-02-16T13:50:43.163

您可以进行交互式变基并选择`edit`要更改其日期的提交。当 rebase 过程停止以修改您输入的提交时，例如：

```
git commit --amend --date="Wed Feb 16 14:00 2011 +0100" --no-edit 
```

PS`--date=now`将使用当前时间。

之后，您继续您的交互式变基。

要更改提交日期而不是作者日期：

```
GIT_COMMITTER_DATE="Wed Feb 16 14:00 2011 +0100" git commit --amend --no-edit 
```

`GIT_COMMITTER_DATE`上面的行设置了一个用于修改提交的环境变量。

一切都在 Git Bash 中进行了测试。

* * *

## 回答 #2

> 赞同：615
> 
> 时间：2009-01-18T06:48:07.273

与设置和用于您要修复的提交的特定哈希的`git filter-branch`env 过滤器一起使用。`GIT_AUTHOR_DATE``GIT_COMMITTER_DATE`

这将使该哈希值和所有未来的哈希值无效。

**例子：**

如果你想改变commit的[日期](https://www.kernel.org/pub/software/scm/git/docs/git-commit.html#_date_formats)`119f9ecf58069b265ab22f1f97d2b648faf932e0`，你可以这样做：

```
git filter-branch --env-filter \
    'if [ $GIT_COMMIT = 119f9ecf58069b265ab22f1f97d2b648faf932e0 ]
     then
         export GIT_AUTHOR_DATE="Fri Jan 2 21:38:53 2009 -0800"
         export GIT_COMMITTER_DATE="Sat May 19 01:01:01 2007 -0700"
     fi' 
```

* * *

## 回答 #3

> 赞同：440
> 
> 时间：2012-03-14T11:32:31.370

在一个命令中处理所有这些建议的更好方法是

```
LC_ALL=C GIT_COMMITTER_DATE="$(date)" git commit --amend --no-edit --date "$(date)" 
```

这会将最后一次提交的提交和作者日期设置为“现在”。

* * *

## 回答 #4

> 赞同：277
> 
> 时间：2015-07-21T13:25:36.290

做吧`git commit --amend --reset-author --no-edit`。对于较旧的提交，您可以进行交互式变基并选择`edit`要修改其日期的提交。

```
git rebase -i <ref> 
```

然后修改提交`--reset-author`并将`--no-edit`作者日期更改为当前日期：

```
git commit --amend --reset-author --no-edit 
```

最后继续你的交互式变基：

```
git rebase --continue 
```

* * *

## 回答 #5

> 赞同：179
> 
> 时间：2016-10-17T20:24:34.147

我为此编写了一个脚本和 Homebrew 包。超级容易安装，你可以在 GitHub[`PotatoLabs/git-redate`](https://github.com/PotatoLabs/git-redate)页面上找到它。

句法：

```
git redate -c 3 
```

你只需要运行`git redate`，你就可以在 vim 中编辑最近 5 次提交的所有日期（还有一个`-c`选项可以让你返回多少次提交，它只是默认为 5）。如果您有任何问题、意见或建议，请告诉我！

[![在此处输入图像描述](https://i.stack.imgur.com/yE4cQ.gif)](https://i.stack.imgur.com/yE4cQ.gif)

* * *

## 回答 #6

> 赞同：151
> 
> 时间：2017-02-02T08:50:58.393

每个提交都与两个日期相关联，即提交者日期和作者日期。您可以通过以下方式查看这些日期：

```
git log --format=fuller 
```

如果您想更改最近 6 次提交的作者日期和提交者日期，您可以简单地使用交互式 rebase ：

```
git rebase -i HEAD~6 
```

.

```
pick c95a4b7 Modification 1
pick 1bc0b44 Modification 2
pick de19ad3 Modification 3
pick c110e7e Modification 4
pick 342256c Modification 5
pick 5108205 Modification 6

# Rebase eadedca..5108205 onto eadedca (6 commands)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit 
```

对于您想要更改日期的所有提交，替换`pick`为`edit`（或只是`e`），然后保存并退出您的编辑器。

[您现在可以通过以ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)格式指定作者日期和提交者日期来修改每个提交：

```
GIT_COMMITTER_DATE="2017-10-08T09:51:07" git commit --amend --date="2017-10-08T09:51:07" 
```

第一个日期是提交日期，第二个日期是作者日期。

然后转到下一个提交：

```
git rebase --continue 
```

重复该过程，直到您修改所有提交。检查您的进度`git status`。

* * *

## 回答 #7

> 赞同：111
> 
> 时间：2018-04-07T15:16:42.437

```
git commit --amend --date="now" 
```

* * *

## 回答 #8

> 赞同：78
> 
> 时间：2019-10-30T09:32:21.547

# 如何编辑多个提交日期

其他答案对于编辑多个提交日期不是很方便。几年后我回到这个问题来分享一种技术。

要更改最后 4 次提交的日期：

```
git rebase -i HEAD~4 
```

按如下方式编辑变基，插入`exec`行以根据需要修改日期：

```
pick 4ca564e Do something
exec git commit --amend --no-edit --date "1 Oct 2019 12:00:00 PDT"
pick 1670583 Add another thing
exec git commit --amend --no-edit --date "2 Oct 2019 12:00:00 PDT"
pick b54021c Add some tests
exec git commit --amend --no-edit --date "3 Oct 2019 12:00:00 PDT"
pick e8f6653 Fix the broken thing
exec git commit --amend --no-edit --date "4 Oct 2019 12:00:00 PDT" 
```

### 更新（2021 年 9 月）：

如果您想在变基指令列表（Git 2.6+）中查看原始提交日期：

```
git config --add rebase.instructionFormat "[%ai] %s" 
```

然后你会看到类似的东西

```
pick 4f5a371f [2021-09-08 02:56:50 -0700] Add npm events
pick 67937227 [2021-09-09 03:05:42 -0700] Fixup 
```

* * *

## 回答 #9

> 赞同：48
> 
> 时间：2014-07-05T09:29:07.470

基于[theosp](https://stackoverflow.com/users/299920/theosp)的[答案](https://stackoverflow.com/a/24105058/6309)，我编写了一个名为`git-cdc`（用于更改日期提交）的脚本，并将其放入我的`PATH`.

名称很重要：`git-xxx`您`PATH`可以在任何地方输入：

```
git xxx
# here
git cdc ... 
```

该脚本在 bash 中，即使在 Windows 上也是如此（因为 Git 将从其[msys 环境](https://stackoverflow.com/a/3144417/6309)中调用它）

```
#!/bin/bash
# commit
# date YYYY-mm-dd HH:MM:SS

commit="$1" datecal="$2"
temp_branch="temp-rebasing-branch"
current_branch="$(git rev-parse --abbrev-ref HEAD)"

date_timestamp=$(date -d "$datecal" +%s)
date_r=$(date -R -d "$datecal")

if [[ -z "$commit" ]]; then
    exit 0
fi

git checkout -b "$temp_branch" "$commit"
GIT_COMMITTER_DATE="$date_timestamp" GIT_AUTHOR_DATE="$date_timestamp" git commit --amend --no-edit --date "$date_r"
git checkout "$current_branch"
git rebase  --autostash --committer-date-is-author-date "$commit" --onto "$temp_branch"
git branch -d "$temp_branch" 
```

有了它，您可以输入：

```
git cdc @~ "2014-07-04 20:32:45" 
```

这会将 HEAD ( ) 之前提交的作者/提交日期重置`@~`为指定日期。

```
git cdc @~ "2 days ago" 
```

这会将 HEAD ( ) 之前提交的作者/提交日期重置`@~`为同一小时，但 2 天前。

* * *

[Ilya Semenov](https://stackoverflow.com/users/189806/ilya-semenov)[在评论](https://stackoverflow.com/questions/454734/how-can-one-change-the-timestamp-of-an-old-commit-in-git/24584976#comment55924424_24584976)中提到：

> 对于 OS X，您还可以安装 GNU `coreutils`( `brew install coreutils`)，将其添加到`PATH`( `PATH="/usr/local/opt/coreutils/libexec/gnubin:$PATH"`)，然后使用 " `2 days ago`" 语法。

* * *

## 回答 #10

> 赞同：30
> 
> 时间：2020-09-25T16:21:34.750

在阅读了所有答案后，我想出了一种更简洁、更方便的方式来一次编辑多个提交的日期，而无需交互地重新设置：

```
git rebase HEAD~4 --exec "git commit --amend --no-edit --date 'now'" 
```

它同时更改提交者和作者日期。

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2017-11-24T22:20:39.317

我创建了这个 npm 包来更改旧提交的日期。

[https://github.com/bitriddler/git-change-date](https://github.com/bitriddler/git-change-date)

样品用法：

```
npm install -g git-change-date
cd [your-directory]
git-change-date 
```

系统将提示您选择要修改的提交，然后输入新日期。

如果您想通过特定哈希更改提交，请运行此`git-change-date --hash=[hash]`

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2016-04-25T00:34:39.213

如果它是之前的最后一次提交。

```
git rebase  -i HEAD~2
git commit --amend --date=now 
```

如果您已经推送到原始并且可以强制使用：

```
git push --force 
```

如果你不能强制推送，如果它被推送，你不能改变提交！.

* * *

## 回答 #13

> 赞同：19
> 
> 时间：2014-05-16T05:41:40.997

这是一个方便的别名，它将上次提交的提交时间和作者时间都更改为接受的时间`date --date`：

```
[alias]
    cd = "!d=\"$(date -d \"$1\")\" && shift && GIT_COMMITTER_DATE=\"$d\" \
            git commit --amend --date \"$d\"" 
```

用法：`git cd <date_arg>`

例子：

```
git cd now  # update the last commit time to current time
git cd '1 hour ago'  # set time to 1 hour ago 
```

**编辑：** 这是一个更加自动化的版本，它检查索引是否干净（没有未提交的更改）并重用最后的提交消息，否则会失败（万无一失）：

```
[alias]
    cd = "!d=\"$(date -d \"$1\")\" && shift && \
        git diff-index --cached --quiet HEAD --ignore-submodules -- && \
        GIT_COMMITTER_DATE=\"$d\" git commit --amend -C HEAD --date \"$d\"" \
        || echo >&2 "error: date change failed: index not clean!" 
```

* * *

## 回答 #14

> 赞同：19
> 
> 时间：2014-06-08T10:10:09.563

以下 bash 函数将更改当前分支上任何提交的时间。

如果您已经推送了提交或者您在另一个分支中使用了提交，请注意不要使用。

```
# rewrite_commit_date(commit, date_timestamp)
#
# !! Commit has to be on the current branch, and only on the current branch !!
# 
# Usage example:
#
# 1\. Set commit 0c935403 date to now:
#
#   rewrite_commit_date 0c935403
#
# 2\. Set commit 0c935403 date to 1402221655:
#
#   rewrite_commit_date 0c935403 1402221655
#
rewrite_commit_date () {
    local commit="$1" date_timestamp="$2"
    local date temp_branch="temp-rebasing-branch"
    local current_branch="$(git rev-parse --abbrev-ref HEAD)"

    if [[ -z "$date_timestamp" ]]; then
        date="$(date -R)"
    else
        date="$(date -R --date "@$date_timestamp")"
    fi

    git checkout -b "$temp_branch" "$commit"
    GIT_COMMITTER_DATE="$date" git commit --amend --date "$date"
    git checkout "$current_branch"
    git rebase "$commit" --onto "$temp_branch"
    git branch -d "$temp_branch"
} 
```

* * *

## 回答 #15

> 赞同：19
> 
> 时间：2015-09-23T07:41:28.397

要同时更改作者日期和提交日期：

```
GIT_COMMITTER_DATE="Wed Sep 23 9:40 2015 +0200" git commit --amend --date "Wed Sep 23 9:40 2015 +0200" 
```

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2021-01-01T12:59:37.250

修改最后一次提交的日期和时间的最简单方法

```
git commit --amend --date="12/31/2021 @ 14:00" 
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2016-11-18T11:17:18.223

如果您想获得另一个提交的确切日期（假设您对一个提交进行了变基编辑并希望它具有原始预变基版本的日期）：

```
git commit --amend --date="$(git show -s --format=%ai a383243)" 
```

这将 HEAD 提交的日期更正为提交*a383243*的日期（如果有歧义，请包含更多数字）。它还会弹出一个编辑器窗口，以便您可以编辑提交消息。

这是您通常关心的作者日期 - 请参阅提交者日期的其他答案。

* * *

## 回答 #18

> 赞同：11
> 
> 时间：2019-03-25T11:08:49.077

如果提交尚未推送，那么我可以使用类似的东西：

```
git commit --amend --date=" Wed Mar 25 10:05:44 2020 +0300" 
```

之后 git bash 使用已应用的日期打开编辑器，因此您只需通过在 VI 编辑器命令模式下键入“：wq”来保存它，然后您可以推送它

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2016-02-05T08:58:48.893

如果要在标准 Windows 命令行中执行已接受的答案 ( [https://stackoverflow.com/a/454750/72809](https://stackoverflow.com/a/454750/72809) )，则需要以下命令：

```
git filter-branch -f --env-filter "if [ $GIT_COMMIT = 578e6a450ff5318981367fe1f6f2390ce60ee045 ]; then export GIT_AUTHOR_DATE='2009-10-16T16:00+03:00'; export GIT_COMMITTER_DATE=$GIT_AUTHOR_DATE; fi" 
```

笔记：

*   可以将命令拆分为多行（Windows 支持使用 carret 符号进行行拆分`^`），但我没有成功。
*   您可以编写 ISO 日期，从而节省大量时间来寻找正确的星期几，并减少对元素顺序的普遍挫败感。
*   如果您希望 Author 和 Committer 日期相同，您只需引用之前设置的变量即可。

非常感谢[Colin Svingen 的博客文章](http://swoogan.blogspot.com/2015/06/changing-date-on-series-of-git-commits.html)。尽管他的代码对我不起作用，但它帮助我找到了正确的解决方案。

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2020-01-23T23:31:32.567

对于那些使用 Powershell 的人

```
git rebase DESIRED_REF^ -i

$commitDateString = "2020-01-22T22:22:22"
$env:GIT_COMMITTER_DATE = $commitDateString
git commit --amend --date $commitDateString
$env:GIT_COMMITTER_DATE = ""

git rebase --continue 
```

归功于[https://mnaoumov.wordpress.com/2012/09/23/git-change-date-of-commit/](https://mnaoumov.wordpress.com/2012/09/23/git-change-date-of-commit/)

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2020-07-04T13:16:22.813

## 将最后一次提交的日期设置为当前日期

```
GIT_COMMITTER_DATE="$(date)" git commit --amend --no-edit --date "$(date)" 
```

## 将最后一次提交的日期设置为任意日期

```
GIT_COMMITTER_DATE="Mon 20 Aug 2018 20:19:19 BST" git commit --amend --no-edit --date "Mon 20 Aug 2018 20:19:19 BST" 
```

## 将任意提交的日期设置为任意日期或当前日期

变基到之前所说的提交并停止修改：

1.  `git rebase <commit-hash>^ -i`
2.  在该提交（第一个）的行上替换`pick`为`e`（编辑）
3.  退出编辑器（ESC 后跟`:wq`在 VIM 中）
4.  任何一个：

*   `GIT_COMMITTER_DATE="$(date)" git commit --amend --no-edit --date "$(date)"`
*   `GIT_COMMITTER_DATE="Mon 20 Aug 2018 20:19:19 BST" git commit --amend --no-edit --date "Mon 20 Aug 2018 20:19:19 BST"`

来源： [https ://codewithhugo.com/change-the-date-of-a-git-commit/](https://codewithhugo.com/change-the-date-of-a-git-commit/)

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2020-11-23T10:07:07.403

编辑最近 3 次提交的作者日期和提交日期：

```
git rebase -i HEAD~3 --committer-date-is-author-date --exec "git commit --amend --no-edit --date=now" 
```

该`--exec`命令附加在变基中的每一行之后，您可以使用 选择作者日期`--date=...`，提交者日期将与作者日期相同。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-12-31T14:45:29.183

我想确保在午夜准确地更新我的代码的版权注释，并且我不想冒着使用[at](https://linux.die.net/man/1/at)或[cron](https://linux.die.net/man/8/cron)的微小延迟的风险。所以，我提交了代码，然后：

```
GIT_COMMITTER_DATE="Fri Jan 1 00:00:00 2021 +1000" git commit --amend --no-edit --date="Fri Jan 1 00:00:00 2021 +1000" 
```

（或者甚至可能将 UTC 偏移量设置为 0？决定……）现在我可以推动了！

大家，新年快乐

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-09-14T10:24:20.523

已经有很多很好的答案，但是当我想在一天或一个月内更改多次提交的日期时，我找不到合适的答案。因此，我为此创建了一个新脚本并进行了解释，希望对某人有所帮助：

```
#!/bin/bash

# change GIT_AUTHOR_DATE for commit at Thu Sep 14 13:39:41 2017 +0800
# you can change the data_match to change all commits at any date, one day or one month
# you can also do the same for GIT_COMMITTER_DATE

git filter-branch --force --env-filter '

date_match="^Thu, 14 Sep 2017 13+"              

# GIT_AUTHOR_DATE will be @1505367581 +0800, Git internal format 
author_data=$GIT_AUTHOR_DATE;                   
author_data=${author_data#@}                  
author_data=${author_data% +0800}                # author_data is 1505367581     

oneday=$((24*60*60))

# author_data_str will be "Thu, 14 Sep 2017 13:39:41 +0800", RFC2822 format
author_data_str=`date -R -d @$author_data`      

if [[ $author_data_str =~ $date_match ]];
then
    # remove one day from author_data
    new_data_sec=$(($author_data-$oneday))
    # change to git internal format based on new_data_sec
    new_data="@$new_data_sec +0800"             
    export GIT_AUTHOR_DATE="$new_data"
fi
' --tag-name-filter cat -- --branches --tags 
```

日期将更改：

```
AuthorDate: Wed Sep 13 13:39:41 2017 +0800 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2022-01-11T08:57:38.533

用于将最后 5 次提交的日期更新为当前日期（此方法不允许更新初始提交）：

```
git rebase HEAD~5 --exec "git commit --amend --no-edit --date 'now'" 
```

对于提交 95f5074…15074db2*之后的所有提交：*

```
git rebase 95f5074…15074db2 --exec "git commit --amend --no-edit --date 'now'" 
```

对于所有提交（包括初始提交）：

```
git rebase --root --exec "git commit --amend --no-edit --date 'now'" 
```

为交互模式添加`-i`。

运行`git log --format=fuller --show-signature`以验证更改。

运行`git push -f`更新远程仓库（⚠️危险区）

有影响。例如：

*   提交 ID 会更改，因此您必须重新创建标签
*   您将丢失原始签名
*   这将使用您的`.gitconfig`，这意味着您的密钥将用于签署提交（如果 Git 配置为签署提交）

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-07-25T21:08:01.693

**TL;DR：**匹配日期 + 重新创建 GPG 签名

^(^(（如果您知道剥离以保留**原始**签名的解决方法，请评论/编辑。）))

* * *

我会碰到这个旧线程，因为已经引入了签名提交的功能，并且所有这些`git filter-branch`和喜欢基本上剥离了文档中指定的签名：

> ...如果标签附有签名，则签名将被剥离。根据定义，保留签名是不可能的。...（来源：[--tag-name-filter](https://git-scm.com/docs/git-filter-branch)）

但它也会破坏[`Verified`](https://docs.github.com/en/github/authenticating-to-github/managing-commit-signature-verification/about-commit-signature-verification)GitHub 提交（以及其他 Git 托管位置，如果以相同方式实现）的漂亮徽章，所以这也将解决这个问题。**部分。**

Afaik 不可能通过`git`命令破坏（GPG）签名，**它还**包含提交日期而不是[简单](https://security.stackexchange.com/a/153402/106776)的签名日期，因此即使创作和提交的日期被移动，它'仍将是当前日期，例如：

```
commit <hash>
gpg: Signature made Sun 25 Jul 2021 00:00:00 PM TZ
gpg:                using TYPE key KEY
gpg: Good signature from "Signer <email@domain.tld>"
Author:     Author <email@domain.tld>
AuthorDate: Sat Jan 1 00:00:00 2000 +0000
Commit:     Author <email@domain.tld>
CommitDate: Sat Jan 1 00:00:00 2000 +0000 
```

因此，假设您有一个要从某个提交签名的存储库（我会选择根提交；如果其他人在该存储库上工作，则不推荐）。的文档`git commit` [说它](https://git-scm.com/docs/git-commit#_commit_information)也从环境变量中提取数据（如果存在），因此我们有一个地方可以输入输入。

要检索数据（可以用 设置`git commit --date=...`），我们可以看一下[`git show --format=%ad`](https://git-scm.com/docs/git-show#Documentation/git-show.txt-emadem)，因此对于原始日期字符串，它将是：

```
git show --format=%ad --no-patch
# Sat Jan 1 00:00:00 2000 +0000 
```

所以我们有：

*   起点
*   每个提交的原始日期字符串
*   `GIT_COMMITTER_DATE`匹配日期（作者 -> 提交者）

对于变基，让我们这样做：

```
git rebase --root <branch-name> --keep-empty --interactive 
```

这将用于分支的根提交`<branch-name>`，保留任何创建的空提交`git commit -m "empty" --allow-empty`并询问您要修改哪些提交。在那里，您将所需的提交从 更改`pick`为`edit`（在我的情况下，将所有这些都标记为`edit`），然后您将被放入一个分离的`HEAD`提交中，从这里开始有趣。

```
# or "while :"
while true
do
    GIT_COMMITTER_DATE=$(git show --format=%ad --no-patch) \
        git commit --amend --gpg-sign --no-edit --allow-empty
    git rebase --continue
done 
```

^(（如果您没有`user.signingkey`指定，请使用`--gpg-sign=<fingerprint>`）)

这将遍历每个`edit`带有 -marked 的提交，设置提交者的日期以匹配作者的日期，保留任何空提交，不会触及整个补丁主体，并将添加带有命令执行日期的签名。

一旦您看到`fatal: No rebase in progress?`按下`Ctrl-C`停止循环并检查日志以确认日期匹配并且签名随处可见：

```
git log --pretty=fuller --show-signature 
```

如果日志中一切正常，只需发出即可`git push --force`。现在您应该看到`Verified`每个提交的徽章。

[具有真实历史树的示例](https://github.com/KeyWeeUsr/Butch/commits/300a2eeb71480682851e8f8ba6b4f13e0665542b)。GitHub 似乎并不关心签名的日期（任何地方都没有参考），但它仍然会出现在`git log`.

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2022-01-12T16:26:13.613

我最近需要这个并且使我自己的脚本看起来很像 git-redate

但是，我的脚本只进行了最少的修改，并且花费了更少的时间来重写（如果您需要更新）许多提交，因为它一次完成了所有提交

[change_git_history](https://github.com/erwanvivien/change_git_history)

实际上这也允许更改提交消息

# 解释：

脚本连接了一堆看起来像这样的 bash if 表达式

这是修改提交日期的那些

```
if [ "$GIT_COMMIT" = "$com_hash" ]; # com is commit
then
    export GIT_AUTHOR_DATE="$com_date";
    export GIT_COMMITTER_DATE="$com_date";
fi; 
```

以下是修改提交消息的内容：

```
if [ true = false ]; # impossible
then
    : # pass
elif [ "$GIT_COMMIT" = "$com_hash" ];
then
    sed 's/.*/$com_msg_esc/g'" # replace content with new content
else
    cat - # returns previous content
fi; 
```

我们使用

```
git filter-branch -f \
    --env-filter "$UPDATES" \
    --msg-filter "$MESSAGES" \
    -- "$REV" 
```

（文档在这里[filter-branch man](http://manpages.ubuntu.com/manpages/bionic/man1/git-filter-branch.1.html)）

# asp.net-mvc - 使用 asp.net mvc 对模型和 UI 输入进行良好而简单的验证时，我有哪些选择？

> ID：454736
> 
> 赞同：1
> 
> 时间：2009-01-18T06:15:11.380
> 
> 标签：asp.net-mvc

我正在寻找一个可以处理我的业务对象和 UI 输入验证的验证框架。最好不要过多地重复我的验证逻辑并尝试使用 DRY 原则。所以理想的地方是我的商务对象。

其他人用过什么？我也听说过 IDataErrorInfo，有人有我如何将它与 MVC 一起使用的示例吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T06:56:44.947

如果您正在寻找一个框架，那么 codeplex 上有一个名为 xVal [http://www.codeplex.com/xval](http://www.codeplex.com/xval)

Scott Guthrie 还发表了一篇关于使用内置验证功能的信息。 [http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T06:36:16.767

编写自己的 Html 扩展方法。像

```
Html.TextBoxWithValidator(...)
```

# struts2 - 谁能帮我在netbeans中做struts2 tiles2

> ID：454747
> 
> 赞同：0
> 
> 时间：2009-01-18T06:44:52.133
> 
> 标签：struts2

我是 struts2 瓷砖的新手。我只需要如何配置我的目录结构以及需要哪些配置文件。如果可能，请给出一些示例......

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T07:22:43.633

也许看看[文档中的适当位置](http://struts.apache.org/2.0.14/docs/tiles-plugin.html)会有所帮助？struts2 文档可能很难浏览。

# c# - 轮询数据库以获取来自 C# 应用程序的更新

> ID：454751
> 
> 赞同：0
> 
> 时间：2009-01-18T06:50:07.613
> 
> 标签：c#, jet, polling

我正在尝试创建我的第一个“真正的”C# 应用程序——一个小型宠物项目，以帮助安排工作中的同行评审。

由于在实施任何新事物时涉及大量的流程/官僚主义 - 以及我正在做这件事的事实远离管理层的眼睛，在我自己的时间，暂时 - 我将与一个~~MS Access~~ MS Jet Engine 后端（即一个访问 mdb 文件），因为限制了我如何将此应用程序部署给我的同事。

我的问题是：我如何间歇性地轮询数据库以从数据库中获取更新（新请求的评论、来自其他开发人员请求信息的消息等）？

我是否应该在需要信息的每个表单上放置一个计时器并在发生更新时刷新所有内容？

**编辑：**
我正在寻找专门关于如何实现计时器的建议。我无法在工作站上安装东西，我无法访问服务器（存储空间之外），并且由于公司的安全要求，我无法自己托管这个，因为我们的客户有荒谬的 DoD 限制。

我想我已经想通了，因为“表单上的计时器”解决方案工作得很好（当我说我想要 CLI 版本的辅助解决方案时，我不知道我在想什么，因为它显然不需要.. 太晚了）。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T07:20:04.260

您可以启动后台工作线程以在无限循环中进行刷新，并在每次循环迭代的结束（或开始）时休眠。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T07:09:36.437

将您的应用程序开发为 aspnet MVC 应用程序。这样，它就是一个网站，开发人员只需刷新页面即可获得最新结果。这将在很多方面为您提供帮助：无需轮询、无法访问、Web 界面（非常方便）、[太多不提]

从这里开始 - [http://www.asp.net/learn/mvc-videos/video-395.aspx](http://www.asp.net/learn/mvc-videos/video-395.aspx)
**编辑：更多链接：（**
这些是很棒的视频）
* [http://www.asp.net/learn/mvc-视频/video-396.aspx](http://www.asp.net/learn/mvc-videos/video-396.aspx)
* [http://www.asp.net/learn/mvc-videos/video-360.aspx](http://www.asp.net/learn/mvc-videos/video-360.aspx)
* [http://www.asp.net/learn/mvc-videos/video-361。 aspx](http://www.asp.net/learn/mvc-videos/video-361.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T05:04:14.670

orrite..我会崩溃的。

我最好的轮询访问数据存储的建议是使用 System.IO.FileSystemWatcher 来监视 mdb 文件所在的文件夹。通过这种方式，您可以制作代码以间隔进行轮询，但仅在 Changed 事件触发时进行。这应该会减少 CPU 和磁盘访问。

希望这可以帮助。:D

# php - 从 PHP Web 应用程序打印客户端报告

> ID：454759
> 
> 赞同：2
> 
> 时间：2009-01-18T07:01:20.103
> 
> 标签：php, flash, pdf, printing, reporting

我正在寻找一种解决方案，用于从基于 PHP Web 的应用程序中打印报告和预先格式化的表单。请注意，这些不是 HTML 页面的打印。相当好的对齐固定格式的收据、订单、分类帐等。

我有的东西。

使用 PDF：是否有一种简单的单击方式从客户端打印报告？在窗口中打开 PDF，然后选择 File -> Print 的明显选择似乎太麻烦了。

使用 Flash：我看到一些网站通过 Flash 提供单击打印。不知道什么在后台工作。关于这方面的任何见解都会有所帮助。

Active-X/Silverlight(?)：我不想只在 IE 上限制我的用户。但是这种一键打印的要求太严格了，如果它完成了任务，我宁愿切换到只有 MS 的平台。

请注意，单击即可弹出打印对话框，然后用户再次单击以进行打印。但任何比这更复杂的都是一个缺点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T09:11:57.827

如果格式太死板，您需要像 PDF 这样的格式。HTML/CSS 是如此多变，你永远不会在所有浏览器上得到相同的结果。插件网页没有真正的页面概念（尽管有一些支持，例如 CSS 打印媒体样式）。

也并非所有人都拥有一台打印机。试图强制打印某些东西确实是错误的方法，并且通常会使您的一些客户望而却步。

最小的解决方案是使用 emdia print CSS 创建一个收据页面，以使其在大多数情况下看起来是负责任的。

如果这还不够，你需要去PDF。不幸的是，这变得很难，因为[这个关于 HTML+CSS 到 PDF 转换的问题说明了](https://stackoverflow.com/questions/391005/convert-html-css-to-pdf-with-php#434391)。 [PrinceXML](http://www.princexml.com/)在这种转换方面做得非常出色，但它并不便宜。 [Html2PDF](http://www.tufat.com/s_html2ps_html2pdf.htm)是开源软件中最好的，但存在问题（有关详细信息，请参阅该答案）。我在 Java 领域也遇到过同样的问题，发票最终使用[Jasper Reports](http://jasperforge.org/plugins/project/project_home.php?group_id=102)。不过，我还没有真正看到 PHP 的等效报告解决方案。Python 有[reportlab](http://www.reportlab.org/rl_toolkit.html)，这似乎也是做这种工作的候选人。

也许您最好的选择是直接生成 PDF。这有点乏味，但它避免了 HTML 到 PDF 转换的许多陷阱。 [本教程](http://devzone.zend.com/article/1254-PDF-Generation-Using-Only-PHP---Part-1)（[第 2 部分](http://devzone.zend.com/article/1255-PDF-Generation-Using-Only-PHP---Part-2)）解释了如何。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T07:37:24.617

```
<a href = "#" onclick = "window.print(); return false;">Print!</a> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T07:55:35.733

在 Nelson LaQuet 之后，您可以将 window.print() 放在 body 标记的 onload 属性中，以便在页面加载时弹出打印对话框，

（或使用 jquery 的 document.ready() 来实现相同的目标，或任何其他 JS 框架提供的）

# c++ - 矢量或地图，使用哪一个？

> ID：454762
> 
> 赞同：78
> 
> 时间：2009-01-18T07:06:05.053
> 
> 标签：c++, performance, stl

我听过很多人说，如果容器中的预期元素数量相对较少，那么最好使用`std::vector`而不是`std::map`仅使用容器进行查找而不是迭代。

这背后的真正原因是什么？

显然，查找性能`std::map`不能比`std::vector`（尽管它可能以纳秒/微秒为单位不同）差，所以它与内存使用有关吗？

是否比分割虚拟地址空间`std::vector`更好/更差？`std::map`

我正在使用 Visual Studio 附带的 STL 库（即 Microsoft 的实现）。与其他实现相比，这有什么不同吗？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-01-18T07:45:21.217

我想你是在`map<A, B>`比较`vector<pair<A, B> >`。

首先，在一个非常小的向量中找到一个项目很容易比在地图中找到相同的项目更快，因为向量中的所有内存总是连续的（因此与计算机的缓存和类似的东西配合得更好），并且数量在向量中找到某些东西所需的比较可能与地图大致相同。在非常大的容器的限制下，在地图中查找元素需要较少的操作。

映射变得比向量快的点取决于实现、处理器、映射中的数据以及处理器缓存中的内存等微妙因素。通常，地图变得更快的点大约是 5-30 个元素。

另一种方法是使用散列容器。它们通常被命名为`hash_map`或`unordered_map`。命名的类`hash_map`不是官方标准的一部分（并且有一些变体）；`std::tr1::unordered_map`是。哈希映射通常比普通映射更快，无论其中有多少元素，但它是否真的更快取决于键是什么，它是如何散列的，你必须处理什么值，以及如何密钥在 std::map 中进行比较。它不会像 std::map 那样将事物保持在特定的顺序中，但是您已经说过您不在乎这一点。我推荐哈希映射，特别是如果键是整数或指针，因为这些哈希非常快。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-18T07:28:29.907

地图通常实现为二叉搜索树，并且遍历二叉树总是会带来一些开销（执行比较、遍历链接等）。向量基本上只是数组。对于非常少量的数据，可能是 8 或 12 个元素，有时对数组进行线性搜索比遍历二叉搜索树要快。

您可以自己运行一些计时来查看盈亏平衡点在哪里—— 对四个元素进行搜索，然后是八个，然后是十六个，依此类推，以找到适合您的特定 STL 实现的最佳点。

映射确实倾向于在整个堆中分配一堆小块，而向量是连续的，因此在从前到后迭代所有元素的情况下，向量的缓存命中率有时会好一些。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-01-18T11:39:48.637

“默认情况下，当你需要一个容器时使用向量”——Bjarne Stroustrup。

否则，我发现这个小流程图很有帮助（已**编辑**- 可能是一个有效的实时新链接）：

[https://ngoduyhoa.blogspot.com/2015/06/summary-of-different-containers.html](https://ngoduyhoa.blogspot.com/2015/06/summary-of-different-containers.html)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-18T07:46:19.810

如果您一次进行所有插入然后进行大量查找，则可以使用向量并在插入时对其进行排序；然后使用 lower_bound 进行快速查找。即使对于大量项目，它也可能比使用地图更快。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-18T11:31:42.817

我认为您应该首先使用适合数据的容器。std::vector 用于在 C 或前 STL C++ 中使用数组的情况：您需要一个连续的内存块来存储具有快速常数时间查找的值。std::map 应该用于将键映射到值。这里的主要重叠是向量与以 size_t 为键的映射。在这种情况下，有两个问题：索引是否连续？如果没有，您可能会用向量浪费内存。第二，你想要什么查找时间？向量具有恒定时间查找，而 std::map 通常实现为 RB 树，其查找时间为 O(log n)，甚至哈希映射（例如 TR1 unordered_map）通常具有更差的复杂度，因为索引（或其哈希）将映射到可以包含多个值的存储桶。

如果针对的是带有对的向量：您可以使用向量的元素并使用 find 来查找元素。但这是一个二分搜索，几乎和 std::map 一样快。

无论如何，尝试以明显的方式对数据进行建模。过早的优化通常没有多大帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-18T14:12:17.183

另一种看待这个问题的方式是，如果我们谈论的是小容器，那么任何一个都不会花费很长时间来查找。除非您在非常紧凑的循环中搜索此容器，否则时间差异可能可以忽略不计。

在这种情况下，我会寻找哪个容器更接近您想要做的事情。如果您正在寻找一个特定的值，map 的内置 find() 方法将比创建一个 for 循环和迭代一个向量要容易得多（并且使用起来也不那么复杂）。

你自己的时间可能比这里和那里的几纳秒更有价值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-13T03:53:06.417

基本上，地图用于查找。

但是，有时甚至`std::vector`可以用来代替`std::map`查找。

如果您的键值对中的元素非常少，那么您甚至可以使用 key in 进行迭代搜索`std::vector<std::pair<x,y>>`。

这是因为散列需要时间，尤其是散列字符串和 map 中的其他操作，例如将数据存储在堆中。

如果您有更多需要查找的元素，并且当您想要在您拥有的元素列表中进行频繁查找时，您只会在 std::map 中看到更好的区别。

# postgresql - 为什么我不能在我的 PostgreSQL 数据库中执行“upper()”？

> ID：454769
> 
> 赞同：2
> 
> 时间：2009-01-18T07:19:30.987
> 
> 标签：postgresql, postgis

我在 PostgreSQL 中使用“encoding = 'UTF8'”创建了一个数据库，并在其中加载了一些 UTF8 数据。选择工作正常，但是当我尝试在查询中执行“WHERE UPPER(name) = 'FOO'”时，出现错误

```
ERROR:  invalid multibyte character for locale 
```

我的研究似乎表明这是因为 PostgreSQL 安装是“initdb”，`LANG=en_US`而不是`LANG=en_US.UTF8`. 做一个“ `SHOW LC_COLLATE`”显示“ `en_US`”。我不想转储和重新创建我所有的数据库，因为其中有几个是 PostGIS，重新创建这些数据库非常痛苦。有没有一种解决方法，比如一种对 UTF8 有效的“UPPER”的等效方法？

**更新** 我最终完成了数据库的转储、reinitdb 和还原，它没有我想象的那么痛苦，除了因为 postgres 用户不知道数据应该去哪里有点问题t 设置 PGDATA 环境变量，我找不到任何配置文件或 shell 脚本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T08:50:03.877

我认为您想要的解决方法不可行，但是转储和恢复启用 PostGIS 的数据库应该可以正常工作。我定期使用 PostGIS 函数转储和恢复数据库以及使用 geom 对象的数据。

你有什么样的问题？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T13:23:30.643

您的诊断是对的，这是 PostgreSQL 中 Unicode 的常见问题。安装过程尝试变得智能并使用运行它的 shell 的语言环境进行 initdbed :-(

我建议，如果你不能转储和恢复你的数据库，你有一个比大写数据更严重和更紧迫的问题。恕我直言，您应该先解决这个问题，然后才能在发布新版本的 PostgreSQL 之后（或在硬盘故障之后）实际恢复数据。

# c# - 向 Silverlight 客户端公开数据库索引是否安全？

> ID：454771
> 
> 赞同：2
> 
> 时间：2009-01-18T07:21:35.430
> 
> 标签：c#, database, wcf, silverlight, security

我有一个 Silverlight 应用程序，它通过 WCF 与 ASP.NET 后端通信。我有一组我定义的 DataContract 对象（大部分）匹配我的 LINQ to SQL 生成的类型，我的 ASP.NET 后端可以使用这些类型。当我需要将数据传输到我的 Silverlight 客户端时，我的 WCF 代码会生成从 LINQ 到 SQL 生成器类型的 DataContract 对象的实例。

我的问题如下：通过我的 DataContract 对象公开索引（用作数据库中的主键）有什么安全隐患？

我的数据库中的示例表（位置）具有以下列：

*   PositionIndex : int (主键)
*   职位名称：字符串
*   位置类型：整数

相应的对象（或多或少）是这样的：

```
public class Position
{
    public int PositionIndex { get; set; }
    public string PositionName { get; set; }
    public int PositionTYpe { get; set; }
} 
```

我很担心，因为我知道通过反射对 Silverlight DLL 进行逆向工程是多么容易——任何潜在的坏人都会知道我正在向客户端提供数据库索引，并且由于他们可以对 Silverlight DLL 进行逆向工程，因此他们可以轻松获得我的 WCF 服务的 URL 并尝试破坏它们。现在，我很好，并听取了许多在我之前的人的建议，并且我在 ASP.NET 方面进行了许多检查，以验证我的 WCF 服务是否获得合法输入，但我仍然担心我在做坏事，给潜在的坏人一些，不多，但是一些，洞察我的系统后端是如何设计的，我已经有足够长的时间知道这对于一个有决心的人来说已经绰绰有余了从...开始。

你们有什么感想？如果我在我的 DataContracts 中使用索引做坏事，你能建议一个替代方案吗？我发现很难想出一个不提供该索引的设计，因为我需要 Silverlight 客户端来更新我的数据库中已经存在的行，而拥有索引是我能想到的最好的帮助方式ASP.NET 端确定它需要更新数据库中的哪一行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T07:33:31.177

有帮助的一件事是获得某种授权，以便您跟踪哪些客户“拥有”哪些密钥，以便他们无法更改他们不应该更改的记录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T07:34:20.973

[https://stackoverflow.com/questions/](https://stackoverflow.com/questions/) **454771** /is-it-safe-to-expose-database-indices-to-silverlight-clients

在 URL 等中使用主键是标准做法。您需要注意的是确保客户端在将资源发回之前被允许查看资源。

:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T09:42:15.427

无论您使用数据库 id 还是“自然密钥”，安全问题都是一样的：您需要一种唯一标识记录的方法，并且该知识可能会被滥用。

自然键的主要优点是，如果您需要存储与系统断开连接的中长期记录，或在并行系统之间传输记录（主键不再有用） - 但这并不似乎是这里的问题。

如果安全性是一个**主要**问题，您可以为仅存在于客户端会话的对象发出临时密钥（也许是 guid） - 将它们重新映射回服务器。然而，这在实践中会很痛苦。

当然，您可以使用 Guid**作为**主键 ( `uniqueidentifier`)：基于 guid 的键的另一个优点是（如果随机生成）它们不允许您使用“key+1，key+2”方法进行数据查询。

无论哪种方式，您都应该验证客户端是否被允许[根据需要创建/读取/更新/删除]他们试图操作的记录。

# php - 用用户友好的目录列表替换 Apache 的 mod_autoindex 的简单脚本

> ID：454776
> 
> 赞同：0
> 
> 时间：2009-01-18T07:32:56.623
> 
> 标签：php, perl, apache, directory-listing, mod-autoindex

Apache 模块[mod_autoindex](http://httpd.apache.org/docs/2.0/mod/mod_autoindex.html)生成“目录索引”，向用户显示目录中文件和目录的粗略超链接列表（当没有 index.html 或其他[DirectoryIndex](http://httpd.apache.org/docs/2.0/mod/mod_dir.html#directoryindex)文件时）。

我在 Apache 网络服务器上有一个目录，我想在其中提供一个自动目录列表，包括完整的文件名、最近修改的优先排序、显示文件大小、使用简单而有吸引力的演示文稿。我不能使用 mod_autoindex 或其他 Apache 功能。

因此，我正在寻找一个与 mod_autoindex 做很多相同事情的简单脚本。换句话说，我想要一个脚本，我可以将它放在一个目录中，该目录将 HTML 文档输出到 STDOUT，其中包含目录中文件的超链接列表。

该脚本应该以一种简单且有吸引力的方式呈现其输出（非技术人员将使用它），包含一个我可以根据需要编辑的文件，并且最好是独立于操作系统的（这样我以后可以再次使用它）。额外的功能会很棒，但易于安装是最重要的（尽管如果需要，我很乐意调整代码）。

我的首选是 perl 脚本（即 index.pl 文件），但 PHP 是可以接受的（index.php）。这些是服务器上唯一的 DirectoryIndex 选项。

**更新**

我决定使用[snif](http://www.bitfolge.de/snif-en.html)[代替 AutoIndex](http://autoindex.sourceforge.net/)来解决当前的问题，但我仍然有兴趣找到一个 perl 实现，所以如果你知道一个，请发布它。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T19:36:39.930

snif 很好，我认为可以满足您的所有需求。 [关联](http://www.bitfolge.de/index.php?option=com_content&view=article&id=66:snif-simple-and-nice-index-file&catid=38:eigene&Itemid=59)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T08:59:50.223

我想[AutoIndex](http://autoindex.sourceforge.net/)可以解决你的问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-09-24T20:54:28.913

在您的 httpd.conf 文件中或使用：

使用 Apache::Icon (); 使用 Apache::AutoIndex；

来自：cpansearch.perl.org/src/GOZER/Apache-AutoIndex-0.08/AutoIndex.pm

来自： [http ://www.google.com/search?num=20&q=perl+Apache%3A%3AAutoIndex](http://www.google.com/search?num=20&q=perl+Apache%3A%3AAutoIndex)

# windows - 如何使用 WshShell.RegRead 读取名称为文件路径的注册表值

> ID：454781
> 
> 赞同：0
> 
> 时间：2009-01-18T07:43:54.540
> 
> 标签：windows, scripting, registry, wsh

我正在编写一些由 Windows 脚本主机执行的 javascript，并且我需要能够从注册表中读取某些特定 DLL 的共享文件计数。注册表项和值如下所示：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SharedDlls]
"C:\\Program Files\\Common Files\\ACME Corp\\AcmeUtil.dll"=dword:00000002
"C:\\Program Files\\Common Files\\ACME Corp\\SuperEdit.ocx"=dword:00000001

```

我正在尝试使用[WshShell.RegRead](http://msdn.microsoft.com/en-us/library/x05fawxd(VS.85).aspx)方法来执行此操作，但它似乎不起作用。我认为问题在于这个方法只接受一个参数，它是要检索的值的连接键路径和值名称。由于本例中的值名称本身就是路径，因此该方法认为它是键的一部分。有没有办法让这个方法识别它的值名称？

这是演示问题的代码：

```
var shell = WScript.CreateObject("WScript.Shell");
var keyPath = "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\SharedDlls\\";
var valName = "C:\\Program Files\\Common Files\\ACME Corp\\AcmeUtil.dll";
WScript.Echo("count = " + shell.RegRead(keyPath + valName));

```

我看到的错误是：

```
WshShell.RegRead：注册表项“HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SharedDlls\C:\Program Files\Common Files\ACME Corp\AcmeUtil.dll”中的根无效

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T14:44:35.450

问题出在斜线中...
您可以使用 WMI 来阅读它，如下[所述](http://www.visualbasicscript.com/m_47759/tm.htm)：

```
Const HKEY_CURRENT_USER = &H80000001 
 Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\.\root\default:StdRegProv") 

 strKeyPath = "Software\ASoftware\ConfigList\MySettings" 
 strValueName = "xyz\abc" 
 oReg.GetStringValue HKEY_CURRENT_USER,strKeyPath,strValueName,strValue 
 wscript.echo strValue 
```

另外：[管理注册表的脚本](http://www.activexperts.com/activmonitor/windowsmanagement/adminscripts/registry/#ReadStringDword.htm)

# linq - 使用 Linq datacontext 将项目列表提交到数据库

> ID：454785
> 
> 赞同：0
> 
> 时间：2009-01-18T07:47:48.213
> 
> 标签：linq

我有一个循环遍历的值列表，确定每个项目是否存在于数据库表中，然后更新或创建新行。每次我使用 dataconext.submitchanges。我还需要提交更改后获得的新创建行的 ID。有没有比在每个周期都连接更好的方式来做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T08:36:39.973

不要为每条记录提交更改（循环的迭代）。最后从您的 datacontext 和 SubmitChanges 更改集合。LINQ 将处理初始查询和最后的提交。你的并发可能是一个问题，但现在忽略它。可能，除非您迭代 1000 条记录，否则这不是问题。

# php - 如何在网站上显示类似 youtube 的视频播放器？

> ID：454791
> 
> 赞同：8
> 
> 时间：2009-01-18T07:57:19.287
> 
> 标签：php, javascript, flash, video, video-streaming

我正在一个网站上工作，我希望在该网站上上传摄像机录制的视频，并且仅对登录用户可见（但不可下载）。我还想编辑视频，让某些图像出现在背景中，并可能记下他们上次停止观看视频的时间。（即如果他们在 30 分钟后停止观看，我想在他们下次观看时从 30:00 开始播放视频）。

我的问题是，

1) 有没有办法将选定的图像/动画动态添加为背景，将 .mp3 文件作为配乐添加到视频中，还是我必须使用视频编辑软件为每个视频手动执行此操作？（将有 100 多个视频）。视频上的任何建议。编辑软件也会很酷。

2) 我是否必须使用[ffmeg](http://ffmpeg.mplayerhq.hu/)将视频转换为 .flv ，或者有没有办法直接将它们作为 .mpegs/.wmv 文件播放？

3）显然我需要某种视频播放器（如 youtube），您可以在其中暂停/停止/跳过视频。有没有办法使用 Javascript/AJAX 构建它，或者我需要为此购买一个 flash 组件？（如果我必须购买一个，任何对此类视频播放器的推荐将不胜感激）

我正在使用 PHP 5、MySQL 和 Jquery (Javascript) 来构建这个项目。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-18T08:30:46.490

签出（[Flowplayer](http://flowplayer.org/)）。Flowplayer 是一个非常好的网络开源视频播放器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T08:26:11.553

如果您还想构建项目，您可能需要使用 actionscript 检查 Flash 编程。这是因为如果您想播放 mpeg/wmv 文件，那么浏览器需要有一个支持它的插件，而并非网络上的每个人都拥有它。另一方面，Flash 拥有大量的浏览受众。所以另一种方法是[在服务器上转换它](http://www.webdeveloper.com/forum/showthread.php?t=193252)。

EIDOS 在推出 Kane and Lynch 游戏之前制作了一个视频混音器（不幸的是，我再也无法在网上找到它了）。可以在时间线上将视频与音乐和声音剪辑一起编辑。

有几种方法可以让 php 与 flash 一起工作，例如使用[AMFPHP](http://www.amfphp.org/)。但是你仍然需要破解[actionscript](http://www.actionscript.org/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T20:52:36.113

如果访问者可以查看它，则访问者已经下载了它。这也是 youtube 的工作方式，你下载视频，否则你看不到它。计算机无法显示尚未下载的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T08:21:49.317

Flash 将是您所描述的一切，包括通过网络摄像头从用户计算机捕获视频。

我怀疑是否有一个预先构建的 Flash 文件，您可能必须从具有大量动作脚本经验的人那里签订合同。

# wpf - 确定窗口是否在 WPF 中实际可见的最佳方法是什么

> ID：454792
> 
> 赞同：12
> 
> 时间：2009-01-18T07:58:12.780
> 
> 标签：wpf, window, visible, z-order

我正在尝试根据单击系统托盘应用程序中的通知图标来切换小窗口的显示。这很容易实现，但是当显示小窗口并且另一个应用程序获得焦点并因此移动到它前面（z 顺序）时，我希望切换假设小窗口现在被隐藏，即使它的可见性是仍然设置为可见。否则，单击图标会将窗口可见性设置为隐藏，即使它已经隐藏在另一个之后。我已经尝试捕获/覆盖激活和停用方法以跟踪但单击通知图标将始终导致停用事件首先触发。使用焦点/失去焦点的类似方法没有 也不起作用，因为即使隐藏在另一个正在使用的应用程序窗口后面，窗口似乎也认为它仍然有焦点。最后，我不得不求助于本机代码和 WindowFromPoint 方法，如下所示：

```
using System.Windows.Interop;
using System.Runtime.InteropServices;
using System.Drawing;

[DllImport("user32.dll")]
public static extern IntPtr WindowFromPoint(Point lpPoint);

public static bool IsWindowVisible(System.Windows.Window window) {
    WindowInteropHelper win = new WindowInteropHelper(window);
    int x = (int)(window.Left + (window.Width / 2));
    int y = (int)(window.Top + (window.Height / 2));
    Point p = new Point(x, y);
    return (win.Handle == WindowFromPoint(p));
} 
```

这将检查在相关窗口中心坐标处返回的窗口是否与所述窗口匹配。即有问题的窗口的中心是可见的。

这似乎有点hacky，有没有更好的方法来实现相同的结果？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T09:02:35.630

您可能不想依赖窗口是否被遮挡，因为有许多因素可以改变窗口大小、位置等，并且所有这些都与可访问性功能相关，从而增加了更多的复杂性。

相反，您可能想要检查窗口是否具有焦点。这就是 MSN Messenger 知道是否在任务栏中闪烁橙色的方式；它会触发一个通知，如果它没有焦点，则任务栏会闪烁。

# c# - 《WCF入门》MSDN教程问题

> ID：454793
> 
> 赞同：0
> 
> 时间：2009-01-18T08:01:29.263
> 
> 标签：c#, .net, wcf

可能已经发现了原始问题（如下）的解决方案。我注释掉了

```
<identity> 
    ...
</identity> 
```

客户端的 app.config 文件中的标记。但是我不确定这是否会导致其他问题，如果确实如此，有人可以告诉我吗？

* * *

我一直在关注 MSDN for WCF 的[入门教程](http://msdn.microsoft.com/en-us/library/ms730144.aspx)。

我在 Vista x64 上使用 Visual Studio.net 2008。服务程序运行良好。但是，客户端有问题。

当我运行客户端时，我得到了这个异常：

> SecurityNegotiationException 是未处理的 SOAP 安全协商与目标“ [http://localhost:8000/ServiceModelSamples/Service/CalculatorService](http://localhost:8000/ServiceModelSamples/Service/CalculatorService) ”的目标“ [http://localhost:8000/ServiceModelSamples/Service/CalculatorService](http://localhost:8000/ServiceModelSamples/Service/CalculatorService) ”失败。有关更多详细信息，请参阅内部异常。

内部异常消息说：

> “安全支持提供程序接口 (SSPI) 协商失败。”

我的代码与示例的代码几乎完全相同。我从来没有真正用 Web 服务或 WCF 或类似的东西做过任何事情。任何人都知道我该如何解决这个问题？谢谢。

编辑 - 我忘了提到异常是在哪里引发的......在客户端的 Main 方法中：

```
CalculatorClient client = new CalculatorClient();

double value1 = 100.00;
double value2 = 15.99;
double result = client.Add(value1, value2); //This is the line that throws the error

//... 
```

我添加了 client.Open(); 在客户端初始化之后，因为我搜索了谷歌并且有人也遇到了问题，这对他有帮助，但是当我这样做时，同样的异常会被抛出新行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T08:07:00.673

SSPI 失败是与 Kerberos 相关的安全协商失败。您是否在域中，并且您现在可能无法与域控制器通信？还是有其他原因导致您目前无法进行身份验证？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-13T06:00:49.840

在您的服务合同属性中添加以下行

```
[ServiceContract(Namespace = "http://Microsoft.ServiceModel.Samples")] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-08T13:21:46.693

我也有这个错误。在我的情况下，它是由`<identity>`客户端上的 Web.config 文件中的部分引起的。`<userPrincipalName value="xxx@yyy.com" />`当我从 TFS 获取文件时，该部分中有一个条目已被其他人的 ID 值覆盖。此条目基本上可以识别您，因此如果您在网络上，它应该与您的网络登录 ID 匹配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-11T23:46:21.323

[我在遵循 Microsoft 的教程http://msdn.microsoft.com/en-us/library/ms734712.aspx](http://msdn.microsoft.com/en-us/library/ms734712.aspx)时也遇到了这个错误

我的笔记本电脑连接到目前不可用的域。根据我在这里找到的内容，我进入客户端 app.config 文件并通过删除 userPrincipleName 解决了问题。

这：

```
 <identity>
                <userPrincipalName value="user@contoso.com" />
            </identity> 
```

变成：

```
 <identity>
            </identity> 
```

然后我重新编译了客户端应用程序，一切正常。

# ssis - 什么是 SSIS 包，它有什么作用？

> ID：454802
> 
> 赞同：78
> 
> 时间：2009-01-18T08:12:38.103
> 
> 标签：ssis

有人可以告诉我 SSIS 包的全部内容吗？

我对数据仓库完全陌生，我对 SSIS、DTL、ETL 等术语很着迷。我正在寻找一张大图以及它如何适应整个 .NET/SQL Server 架构。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-18T10:51:16.737

有关 SSIS 的最新信息 > [https://docs.microsoft.com/en-us/sql/integration-services/sql-server-integration-services](https://docs.microsoft.com/en-us/sql/integration-services/sql-server-integration-services)

从上面引用的网站：

> Microsoft Integration Services 是一个用于构建企业级数据集成和数据转换解决方案的平台。使用集成服务通过复制或下载文件、加载数据仓库、清理和挖掘数据以及管理 SQL Server 对象和数据来解决复杂的业务问题。
> 
> Integration Services 可以从各种源（例如 XML 数据文件、平面文件和关系数据源）中提取和转换数据，然后将数据加载到一个或多个目标。
> 
> Integration Services 包括一组丰富的内置任务和转换、用于构建包的图形工具以及用于存储、运行和管理包的 Integration Services 目录数据库。
> 
> 您可以使用图形集成服务工具来创建解决方案，而无需编写任何代码。您还可以对广泛的集成服务对象模型进行编程，以编程方式创建包，并对自定义任务和其他包对象进行编码。

**SSIS 入门**- [http://msdn.microsoft.com/en-us/sqlserver/bb671393.aspx](http://msdn.microsoft.com/en-us/sqlserver/bb671393.aspx)

**如果您是集成服务信息工作者**- [http://msdn.microsoft.com/en-us/library/ms141667.aspx](http://msdn.microsoft.com/en-us/library/ms141667.aspx)

**如果您是集成服务管理员**- [http://msdn.microsoft.com/en-us/library/ms137815.aspx](http://msdn.microsoft.com/en-us/library/ms137815.aspx)

**如果您是集成服务开发人员**- [http://msdn.microsoft.com/en-us/library/ms137709.aspx](http://msdn.microsoft.com/en-us/library/ms137709.aspx)

**如果您是集成服务架构师**- [http://msdn.microsoft.com/en-us/library/ms142161.aspx](http://msdn.microsoft.com/en-us/library/ms142161.aspx)

**SSIS 概述**- [http://msdn.microsoft.com/en-us/library/ms141263.aspx](http://msdn.microsoft.com/en-us/library/ms141263.aspx)

**集成服务操作方法主题**- [http://msdn.microsoft.com/en-us/library/ms141767.aspx](http://msdn.microsoft.com/en-us/library/ms141767.aspx)

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-06-16T07:46:59.573

SSIS (SQL Server Integration Services) 是 DTS (Data Transformation Services) 的升级版本，是 SQL Server 之前版本的一个特性。SSIS 包可以在 BIDS（商业智能开发工作室）中创建。这些可用于将来自异构数据源的数据合并到 SQL Server 中。它们还可用于填充数据仓库、清理和标准化数据以及自动化管理任务。

SQL Server Integration Services (SSIS) 是 Microsoft SQL Server 2005 的一个组件。它取代了 Data Transformation Services，后者自 7.0 版以来一直是 SQL Server 的一项功能。与包含在所有版本中的 DTS 不同，SSIS 仅在“标准”和“企业”版本中可用。Integration Services 提供了一个平台来构建数据集成和工作流应用程序。SSIS 的主要用途是数据仓库，因为该产品具有用于数据提取、转换和加载 (ETL) 的快速灵活的工具。）。该工具还可用于自动维护 SQL Server 数据库、更新多维多维数据集数据以及执行其他功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-02-20T08:07:12.437

Microsoft SQL Server Integration Services (SSIS) 是一个用于构建高性能数据集成解决方案的平台，包括用于数据仓库的提取、转换和加载 (ETL) 包。SSIS 包括用于构建和调试包的图形工具和向导；用于执行工作流功能的任务，例如 FTP 操作、执行 SQL 语句和发送电子邮件消息；用于提取和加载数据的数据源和目的地；用于清理、聚合、合并和复制数据的转换；用于管理包执行和存储的管理数据库 SSISDB；以及用于对集成服务对象模型进行编程的应用程序编程接口 (API)。

按照微软的说法，SSIS 包的主要用途是：

• 从填充数据的异构数据存储中合并数据

• 仓库和数据集市清理和标准化数据构建

• 将商业智能融入数据转换过程自动化

• 管理功能和数据加载

对于开发人员：

SSIS 包可以与 VS 开发环境集成，用于构建商业智能解决方案。Business Intelligence Development Studio 是 Visual Studio 环境，具有特定于商业智能解决方案的增强功能。它仅适用于 32 位开发环境。

下载适用于 Visual Studio 的 SSDT 工具：

[http://www.microsoft.com/en-us/download/details.aspx?id=36843](http://www.microsoft.com/en-us/download/details.aspx?id=36843)

创建 SSIS ETL 包 - 基础：

[https://docs.microsoft.com/en-us/sql/integration-services/ssis-how-to-create-an-etl-package?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/integration-services/ssis-how-to-create-an-etl-package?view=sql-server-2017)

6 节课中的 SSIS 功能示例项目：

[https://docs.microsoft.com/en-us/sql/integration-services/ssis-how-to-create-an-etl-package?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/integration-services/ssis-how-to-create-an-etl-package?view=sql-server-2017)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-12-11T13:52:20.730

> **SQL Server Integration Services**，简称**SSIS**，是一个强大的 ETL 工具。SSIS ETL 工具用于从不同来源提取数据并根据用户要求转换该数据并将数据加载到各个目的地。请记住，SSIS 是执行提取、转换和加载 (ETL) 操作的第二大工具。
> 
> **SSIS ETL**工具有助于构建企业级数据转换和数据集成解决方案。此 SSIS ETL 工具有助于将数据从常规事务数据加载到数据仓库中。这样您就可以在 SSRS、Tableau 等的帮助下使用该数据创建报告。除了数据仓库应用程序之外，您还可以使用 **SSIS**处理典型的数据集成应用程序。

SSIS 中的步骤可能如下：

**源 -> 转换 -> 目标**

在不同场景下可能成功或失败的 SSIS 任务的简单界面： [![SSIS](https://i.stack.imgur.com/2WMeJ.png)](https://i.stack.imgur.com/2WMeJ.png)

有关详细信息，请访问[https://docs.microsoft.com/en-us/sql/integration-services/sql-server-integration-services?view=sql-server-ver15](https://docs.microsoft.com/en-us/sql/integration-services/sql-server-integration-services?view=sql-server-ver15)

# django - 在使用通用视图创建模型实例时如何设置它的属性？

> ID：454804
> 
> 赞同：0
> 
> 时间：2009-01-18T08:14:01.923
> 
> 标签：django

假设尝试使用 django.views.generic.create_update.create_object 来允许用户访问博客条目实例。在条目模型上，用户有一个必填字段，我不想在博客条目表单上显示为可编辑字段。所以，我会将它包含在 EntryForm.Meta.exclude 元组中。

我应该在生成的模型实例上在哪里设置用户属性的值？我是否必须停止使用 create_object 通用视图并自己编写？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T12:29:57.350

我认为您无法使用通用视图来完成此操作，它们没有太多后处理数据的方式。值得庆幸的是，编写自己的视图来做同样的事情并不难。

（改编自[http://www.djangobook.com/en/1.0/chapter07/](http://www.djangobook.com/en/1.0/chapter07/)）

```
from yourmodel.forms import EntryForm

def create_entry(request):
    if request.method == 'POST':
        form = EntryForm(request.POST)
        if form.is_valid():
            entry = form.save(commit = false)
            entry.author = request.user.username
            entry.save()
            return HttpResponseRedirect('/create_entry/thanks/')
    else:
        form = EntryForm()
    return render_to_response('/path/to/template.html', {'form' : form, ...}, ...) 
```

当然，您必须使用自己的名字等，但这就是逻辑。基本上，您正在检查是否已提交表单，如果已提交，则获取条目，添加用户名并照常保存。至于与通用 create_object 视图的差异，您无需在视图调用中指定诸如 post_redirect_url 之类的内容，而是直接给出它们。查看 render_to_response 和 HttpResponseRedirect 的文档以获取更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-24T23:29:05.403

我只需要解决这个问题，不想作弊。这并不难。检查以下。

请注意，这只是令人费解的，因为我选择坚持我对 MVC 分离的看法。用户群是特定于视图的（因为我们在 Edit 中没有特殊的初始用户）。处理是特定于模型的。

提取一个表单 mixin 并不难，它需要一个新的“passthrough”参数，并自动将排除与初始数据的转发合并。这也增加了知道没有人可以修改视图中这些字段的数据的安全性。

```
class TestForm(forms.ModelForm):

    class Meta:
        exclude = ('user')
        model = models.Test

    def save(self, commit=True):
        obj = super(CharmForm, self).save(commit=False)
        obj.user = self.initial['user']

        if commit:
            obj.save()

class TestView(CreateView):
    model = models.Test
    form_class = TestForm
    def get_initial(self,**kwargs):
        initial = super(CreateView,self).get_initial()

        c = RequestContext(self.request)

        initial = initial.copy()
        initial['user'] = c['user']
        return initial 
```

此外，不完全确定您是否尝试使用新的基于类的视图。我实际上是在为任何有这个问题的人回答这个问题（我不得不破解代码来找到答案，因为似乎没有其他人做过）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T22:51:00.850

sykora 的解决方案有一个小问题：如果表单无效，您将收到错误，因为不会设置表单（超出 if 语句的范围）。

这是一个稍微好一点的版本：

```
from yourmodel.forms import EntryForm

def create_entry(request):
    form = EntryForm()
    if request.method == 'POST':
        form = EntryForm(request.POST)
        if form.is_valid():
            entry = form.save(commit = false)
            entry.author = request.user.username
            entry.save()
            return HttpResponseRedirect('/create_entry/thanks/')
    return render_to_response('/path/to/template.html', {'form' : form, ...}, ...) 
```

# asp.net - 为什么要将我的网站发送到“云”？

> ID：454807
> 
> 赞同：2
> 
> 时间：2009-01-18T08:20:24.467
> 
> 标签：asp.net, cloud, web-farm

我开发了 asp.net 网站，并阅读了有关云计算、windows azure 等的信息。但最后，我看不到任何将我的服务更改/移动/等到“云”的实际理由。
有什么好处？
云计算是网络农场的某种“进化”？

谢谢，对不起，我的无知......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-18T08:36:04.983

为了解释这些好处，我将使用两个示例[Microsoft Azure](http://www.azure.com)和[Amazon EC2](http://aws.amazon.com)。

对于 Amazon EC2，您可以以每台机器每小时几美分的价格租用带有 Windows Server 2003 和 SQL Server 的虚拟映像。与其他托管公司一样，您不需要自己管理硬件；您的机器存储在 Amazon 的数据中心中，它们将确保服务器始终处于启动状态并备份数据等。您还会收到一个 API，以便您可以自动启动机器的新实例以应对需求波动。

Azure 更进一步 - 您无需管理您的系统。使用开发人员工具创建您的 ASP.NET 网站并提供一些元数据来指示您的应用程序如何拆分为前端和后端，然后您选择所需的实例数量并单击“部署到 Azure”。微软再次负责确保应用程序持续运行、地理分布等。事实上，您永远不知道您的应用程序在哪台计算机上，甚至不知道它分布在多少台计算机上。Microsoft 还提供了几个 Web API，您可以从 Azure 应用程序调用这些 API，以进行身份​​验证和存储等操作。

您可以在上面给出的网站上找到更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T08:23:25.630

我认为首要的原因是所提供的动态可扩展性水平。
然后我会说通常提供的冗余量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T08:27:01.880

因为您可以多使用一个流行语来打动您的客户。:)

老实说，如果你不知道它，你可能不需要它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T09:36:41.600

简短的回答是“云”是虚拟服务器服务的流行语。如果你需要使用它，那是因为你不想把钱花在可以做同样事情的 IT 员工和服务器上。

Azure 为 Microsoft 开发人员提供了一些额外的功能，您可以观看[PDC 2008 主题演讲](http://channel9.msdn.com/pdc2008/KYN01/)，他们在其中介绍了 Azure，对此进行了很多讨论。

# svn - SVN 中的标准差异格式

> ID：454808
> 
> 赞同：3
> 
> 时间：2009-01-18T08:20:25.200
> 
> 标签：svn, diff

SVN 中是否存在标准或普通差异格式或仅存在统一格式？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-11-22T19:56:36.960

svn diff --diff-cmd diff -x --normal

这没有副作用，不像 -b 会导致空白的变化被忽略。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T08:25:28.717

`svn help diff`揭示了这一点：

> --diff-cmd arg : 使用 ARG 作为 diff 命令

因此你应该可以`svn diff --diff-cmd diff`使用标准来使用`diff`。

# c++ - 从 Vis C++ 控制台应用程序打开 OpenDialog？

> ID：454811
> 
> 赞同：3
> 
> 时间：2009-01-18T08:21:44.510
> 
> 标签：c++, visual-studio-2008, visual-c++

我知道这是一个非常简单的问题，但我非常习惯使用 Borland 和包装器，所以这对我来说是一种新方法。有人可以简单地告诉我如何打开仅从 Visual Studio C++ 控制台应用程序获取 .obj 文件的 OpenDialog 吗？

非常感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T09:04:07.843

控制台应用程序和 GUI 应用程序之间实际上没有任何区别，除了入口点（“GUI”应用程序中的 WinMain），如果不是从控制台启动，控制台应用程序将在启动期间打开一个控制台窗口。

所有的 Win32 API 都可用，因此您需要使用[GetOpenFileName](http://msdn.microsoft.com/en-us/library/ms646927.aspx)调用，如下所示：

#define DEFAULT_EXTENSION L".obj"

```
OPENFILENAME    ofn;
wchar_t *FilterSpec =L"Object Files(*.obj)\0*.obj\0Text Files(*.txt)\0*.txt\0All Files(*.*)\0*.*\0";
wchar_t *Title =L"Open....";
wchar_t szFileName[MAX_PATH];
wchar_t szFileTitle[MAX_PATH];
int             Result;
wchar_t filePath[MAX_PATH]; // Selected file and path

*szFileName = 0;
*szFileTitle = 0;

/* fill in non-variant fields of OPENFILENAME struct. */
ofn.lStructSize       = sizeof(OPENFILENAME);
ofn.hwndOwner         = GetFocus();
ofn.lpstrFilter       = FilterSpec;
ofn.lpstrCustomFilter = NULL;
ofn.nMaxCustFilter    = 0;
ofn.nFilterIndex      = 0;
ofn.lpstrFile         = szFileName;
ofn.nMaxFile          = MAX_PATH;
ofn.lpstrInitialDir   = L"."; // Initial directory.
ofn.lpstrFileTitle    = szFileTitle;
ofn.nMaxFileTitle     = MAX_PATH;
ofn.lpstrTitle        = Title;
ofn.lpstrDefExt   =     DEFAULT_EXTENSION;

ofn.Flags             = OFN_FILEMUSTEXIST|OFN_HIDEREADONLY;

if (!GetOpenFileName ((LPOPENFILENAME)&ofn))
{
    return; // Failed or cancelled
}
else
{
    wcscpy_s(filePath,ofn.lpstrFile);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T10:55:19.037

是的，可以从 VC++ 控制台应用程序打开 OpenDialog。

步骤：创建一个新项目。-> 选择 Win32 控制台应用程序。在下一个对话框中，选择“支持 MFC 的应用程序”。您将获得以下代码：

#include "stdafx.h"
#include "test.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
＃万一

///////////////////////////////////////// ////////////////////////////////////// 唯一的应用程序对象

CWinApp theApp；

使用命名空间标准；

int _tmain(int argc, TCHAR* argv[], TCHAR* envp[]) { int nRetCode = 0;

```
// initialize MFC and print and error on failure
if (!AfxWinInit(::GetModuleHandle(NULL), NULL, ::GetCommandLine(), 0))
{
    // TODO: change error code to suit your needs
    cerr << _T("Fatal Error: MFC initialization failed") << endl;
    nRetCode = 1;
}
else
{
    // TODO: code your application's behavior here.
    CString strHello;
    strHello.LoadString(IDS_HELLO);
    cout << (LPCTSTR)strHello << endl;
}

return nRetCode; 
```

}

在“else”部分的开头添加以下代码

CFileDialog dlgOpen(TRUE,NULL,NULL,OFN_OVERWRITEPROMPT,"文本文件 ( *.txt)|* .txt||"); dlgOpen.DoModal();

运行应用程序。将自动打开一个打开的对话框。谷歌“CFileDialog”以获得进一步的帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T08:39:12.323

在 Visual Studio 中，通常依赖于[MFC 的 CFileDialog 类](http://msdn.microsoft.com/en-us/library/dk77e5e7(VS.80).aspx)。查看链接的 MSDN 文档页面以了解示例用法。这个页面也有[一些例子](http://funnotes.net/File-open-dialog-box-using-CFileDialog.php)。

如果您使用的是 Windows Vista 或 Windows 7，您可以尝试新的 COM 接口[IFileOpenDialog](http://msdn.microsoft.com/en-us/library/bb775834(VS.85).aspx)。Kenny Kerr 有一篇关于使用新 Vista 对话框的[好文章。](http://weblogs.asp.net/kennykerr/archive/2006/11/10/Windows-Vista-for-Developers-_1320_-Part-6-_1320_-The-New-File-Dialogs.aspx)

# php - 在 iframe 之间传递 cookie 数据

> ID：454813
> 
> 赞同：3
> 
> 时间：2009-01-18T08:22:09.813
> 
> 标签：php, javascript, apache, iframe, cookies

假设我有一个网站 www.example.com，其登录框位于 api.example.com 的 iframe 中。我的问题是：

1.  是否可以将 cookie 数据从内部 iframe（api.example.com）传递到网站，以便网站知道用户何时登录？
2.  是否可以在客户端执行此操作，而无需刷新整个页面？用户登录的事实如何传递到网站？

任何适用于 FF 和 IE 6/7 的解决方案都会很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-18T08:52:42.857

您不必在它们之间传递 cookie。不过，您需要将 cookie 写入正确的域。

```
Response.Cookies("COOKIENAME").Domain = ".example.com"
Response.Cookies("COOKIENAME").Value= "foo" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T08:50:25.967

通过让服务器将 cookie 域指定为 simple ，可以在两个域之间共享`api.example.com`cookie 。这使得 cookie 可用于两个子域。`www.example.com``example.com`

FF3 和 IE8 支持[postMessage](http://msdn.microsoft.com/en-us/library/cc197015(VS.85).aspx)标准，允许不同域中的窗口（框架）相互通信。但是对于 IE6/7，您需要对服务器进行 AJAX 调用以获取您需要的登录确认信息，但棘手的事情是知道如何触发这样的请求。

# javascript - 嵌套元素的事件

> ID：454824
> 
> 赞同：0
> 
> 时间：2009-01-18T08:37:40.237
> 
> 标签：javascript, jquery, dom

我正在使用 jQuery 的监听插件将事件绑定到动态创建的元素。

在我的场景中，我有一个 div 托管一个 span 元素。

我希望函数“spanClicked”在跨度点击时触发，函数“divClicked”在div点击时触发

当我单击 div 以触发函数“divClicked”时，由于跨度在其中，因此会触发函数“spanClicked”。

我想在双击跨度时触发“spanClicked”，在单击 div 时触发“divClicked”。

有办法吗？

```
 $('#container_div').listen('click','li,span',function(){
        // do something
    }); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T08:55:06.520

您应该阅读 JQuery 中的事件冒泡，以及事件发生的顺序，但一个简单的解决方案可能是添加：

```
return false 
```

到您的点击功能结束。这将防止他们的事件冒泡。

# c# - System.Net.Mail 和 =?utf-8?B?XXXXX.... 标头

> ID：454833
> 
> 赞同：24
> 
> 时间：2009-01-18T08:54:38.907
> 
> 标签：c#, .net, encoding, utf-8, system.net.mail

我正在尝试使用下面的代码通过以下代码发送消息，`System.Net.Mail`并且**有时会**收到`'=?utf-8?B?W3AxM25dIEZpbGV...'`（修剪）之类的主题。这是被调用的代码：

```
MailMessage message = new MailMessage()
{
    From = new MailAddress("someone@somewhere.com", "Service"),
    BodyEncoding = Encoding.UTF8,
    Body = body,
    IsBodyHtml = true,
    ReplyTo = new MailAddress("do.not.reply@somewhere.com"),
    SubjectEncoding = Encoding.UTF8
};

foreach (string emailAddress in addresses)
{
    message.To.Add(new MailAddress(emailAddress.Trim(), "Person"));
}

message.Subject = subject; 
```

我想强调的是，这种情况并不总是发生。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-18T09:08:27.757

当您的主题包含 ASCII 范围之外的字符时，邮件软件必须对它们进行编码（RFC2822 邮件不允许标题中包含非 ASCII 字符）。有两种方法可以做到这一点：

*   **引用可打印**（主题以 开头`"=?utf-8?Q"`）
*   **Base64**（主题以 开头`"=?utf-8?B"`）

该框架似乎已经发现 Base64 编码比引用可打印编码更有效（=更短）。当您的主题包含相对较多的 ASCII 范围之外的字符时，这是有道理的。

回答你的问题：你没有做错任何事。这就是带有非 ASCII 字符的 Internet 邮件的样子。当然，阅读此类邮件的软件应该检测和解码此类主题字段。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-07-31T20:25:58.270

我在调试相同问题时遇到了这篇文章，根据我的进一步调查，我可以为 Andreas 提供另一种解释：

问题可能是您的电子邮件客户端软件（在我的例子中是 Outlook 2003）错误地解码了主题行。换句话说，这是 Outlook 中的错误，而不是 .NET 或您的程序中的错误。

如果您使用这样的主题值（字母“c”重复 256 次），它在 Outlook 中显示正常：

```
subject = New String("c"c, 256) 
```

同样，如果您使用这样的主题（字母“c”重复 178 次，并附加了 Unicode 不间断空格字符），它也会在 Outlook 中按预期显示：

```
subject = New String("c"c, 178) + System.Text.Encoding.UTF8.GetChars(New Byte() {194, 160}) 
```

但是，以下主题在 Outlook 中显示为“=?utf-8?B”-前置垃圾：

```
subject = New String("c"c, 179) + System.Text.Encoding.UTF8.GetChars(New Byte() {194, 160}) 
```

不同之处在于第三个主题行在 UTF-8 编码时为 256 个字节。我假设 Outlook 必须在显示之前将主题行截断为 255 个字符......这很好，只是它通过将编码字符串截断为 255 个字节来执行此操作，这会切断编码终止符（“？=”） ，使其无法解码。

这是 Outlook 中的错误，而不是您的邮件提供商或 .NET；您可以通过右键单击邮件列表中的邮件并从上下文菜单中选择“选项...”，然后在“Internet 标题”框中向下滚动，直到在 Outlook 中看到完整的、未截断的 UTF-8 编码主题行您会看到以“主题：”开头的行。

与 Andreas 建议的情况相反，问题不仅在有很多非 ASCII 字符时出现，而且在有一个或多个非 ASCII 字符且主题行很长时会出现。解决方法可能是使用较短的主题行或删除主题中的所有非 ASCII 字符。

（这个错误对我来说特别棘手，因为如上所述，问题数据不包含明显的非 ASCII 字符——只有几个不间断的空格。当您将它们打印到控制台。此外，如果您在 Visual Studio 调试器中更改字符串变量的值，它会默默地将它们替换为常规空格。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T09:08:13.140

答案可能在修剪后的主题的其余部分——您提供的部分解码为“[p13n] 文件”，但您是否在其中有任何非 ASCII 字符，那么我希望它能够像它一样编码

# c# - 如何指定生成的代理中是否需要字段

> ID：454835
> 
> 赞同：1
> 
> 时间：2009-01-18T08:56:57.327
> 
> 标签：c#, wcf, web-services

将 DataContract 中的多个元素公开为 DataMember 的 WCF 服务

```
[DataMember(IsRequired = true, EmitDefaultValue = false)]
public string Source;

[DataMember(IsRequired = true, EmitDefaultValue = false)]
public string Target; 
```

在客户端生成的代理（通过在VS 2008中添加服务引用）中，客户端可以在Source或Target中传递null或空字符串。如何在客户端强制执行 Source 和 Target。即，如果Source 或Target 设置为null，在调用服务调用之前，客户端应该得到一个异常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T09:04:03.630

您无法在客户端执行任何操作。想一想，客户端可以由您自定义开发，甚至在 .Net 中（如 Java 等）都不能。 IsRequired = true 表示该类型必须通过线路序列化该成员，该值可能为空。

唯一的方法是如果值为 null 并使用正确的故障契约，则从您的服务器抛出异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T09:02:20.170

好吧，null (xsi:nil) 和空字符串*都是*值——它们不是你想要的值。

在反序列化期间（在客户端或服务器）：

您可以尝试在 setter 中放入一些代码来为无效值抛出异常？

或者（对于更复杂的情况），我相信数据合同支持反序列化回调，这应该允许您验证......

例如，您可以添加（在部分类中，如有必要，在客户端）：

```
[OnDeserialized]
internal void OnDeserialized(StreamingContext context)
{
    if (string.IsNullOrEmpty(Bar))
    {
        throw new InvalidOperationException("No Bar!");
    }
} 
```

对于预发送检查（在客户端），您必须添加一个额外的验证方法，或者可能（再次，在部分类中）：

```
[OnSerializing]
internal void OnSerializing(StreamingContext context)
{
    if (string.IsNullOrEmpty(Bar))
    {
        throw new InvalidOperationException("No Bar!");
    }
} 
```

但是，服务器还**必须**验证这一点——您不能假设是*您的*客户端代码发送了消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T09:02:30.607

IsRequired 属性是指对**到达**线路的数据进行的验证。如果您想在客户端完成验证，则需要在客户端为此添加代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T16:03:05.463

您还可以查看验证应用程序块以及它如何集成到 WCF 中：

[http://msdn.microsoft.com/en-us/library/cc309334.aspx](http://msdn.microsoft.com/en-us/library/cc309334.aspx)

# php - php中mysql的总和值

> ID：454836
> 
> 赞同：1
> 
> 时间：2009-01-18T08:59:38.850
> 
> 标签：php, mysql, sum

任何人都知道如何获得数字的总和？

例如我有 mysql 列名包。

```
Package
3
4
1
3
4 
```

如果是包裹 3，价值应该是 5 美元，如果是包裹 4，价值应该是 10 美元，如果是包裹 1，价值应该是 1 美元，以此类推。

所以上面的总值应该是 => 5 + 10 + 1 + 5 + 10 = 31

那么我如何在php中得到它的总和？

我试过array_sum ..但它给了我错误，我不是很擅长php ..请帮助我

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T09:05:15.127

获取数据库来完成这项工作：

```
select sum(CASE WHEN package = 3 THEN 5 ELSE 0 END)
       + sum(CASE WHEN package = 4 THEN 10 ELSE 0 END)
       + sum(CASE WHEN package = 1 THEN 1 ELSE 0 END) AS total
from table_name 
```

正确的做法是，如果您有多个值，请修改表格以包含金额字段，以便您可以执行以下操作：

```
select sum(amount) from table_name 
```

或者有另一个表包含值之间的关系（包，金额），然后执行

```
select sum(package_amount) 
from table_name, lookup_values
where table_name.package = lookup_values.package 
```

或者，如果您真的想在 PHP 中执行此操作：

```
$amount = array(3=>5, 4=>10, 1=>1);  // define the amount of each value
$result = mysql_query("SELECT id FROM table_name");
$sum = 0;

while ($row = mysql_fetch_assoc($result))
{
    $sum += $amount[ $row['id'] ];
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T09:15:14.873

您可以像 Richard 那样在纯 SQL 中执行此操作，PHP 版本将类似于：

```
$result = mysql_query("SELECT `number` FROM `packages`");

while ($row = mysql_fetch_assoc($result))
{
    $curr = $row['number'];
    if ($curr == 3) $sum += 3;
    if ($curr == 4) $sum += 10;
    if ($curr == 1) $sum++;
} 
```

这是假设您的数据库表名为“packages”并且具有不同包号的列称为“number”。在循环结束时，您将得到 $sum 变量中的总和。不确定这是否一定是在 PHP 中执行此操作的最有效方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T10:30:18.167

我认为在 PHP 中一个更简洁的方法是声明一个关联的权重数组，这将数据与算法分开：

```
$weight=array(
  1=>1,
  3=>3,
  4=>10
);

$result = mysql_query("SELECT `number` FROM `packages`");

$sum=0;
while ($row = mysql_fetch_assoc($result))
{
    $n = $row['number'];
    if (isset($weight[$n])) 
    {
         $sum+=$weight[$n];
    }
    else
    {
          #handle error somehow, maybe with a default weight
          die("Unexpected value $n");
     }
} 
```

一个更好的选择是让这个完全由数据驱动，并将你的权重放在一个表中

```
#create and populate the weights table
create table weight (number int, weight int, primary key(number));
insert into weight (number,weight) values (1,1),(3,3),(4,10);

#figure out total weight
select sum(weight) from package inner join weight using(number); 
```

使用数据库中的权重，您可以提供一个 UI 以允许您的应用程序的用户调整权重。

# python - 没有名为 MySQLdb 的模块

> ID：454854
> 
> 赞同：487
> 
> 时间：2009-01-18T09:13:38.290
> 
> 标签：python, django, python-2.x

我正在使用 Python 2.5.4 版并安装 MySQL 5.0 版和 Django。Django 在 Python 上运行良好，但在 MySQL 上运行良好。我在 Windows Vista 中使用它。

* * *

## 回答 #1

> 赞同：712
> 
> 时间：2011-05-03T17:23:47.353

您需要使用以下命令之一。哪一个取决于您拥有和使用的操作系统和软件。

1.  **easy_install mysql-python**（混合操作系统）
2.  **pip install mysql-python** (mix os/python 2)
3.  **pip install mysqlclient** (mix os/python 3)
4.  **apt-get install python-mysqldb** (Linux Ubuntu, ...)
5.  **cd /usr/ports/databases/py-MySQLdb && make install clean** (FreeBSD)
6.  **yum install MySQL-python** (Linux Fedora, CentOS ...)

对于 Windows，请参阅此答案：[安装 mysql-python (Windows)](https://stackoverflow.com/q/21440230/4646678)

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2014-08-24T20:11:47.797

...请记住**，python3.x 没有 MySQLdb**

（我知道问题是关于 python2.x 但谷歌对这篇文章的评价很高）

* * *

**编辑：**如评论中所述，有一个 MySQLdb 的分支添加了 Python 3 支持：[github.com/PyMySQL/mysqlclient-python](http://github.com/PyMySQL/mysqlclient-python)

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2016-07-11T15:31:02.330

如果你的 python 版本是`3.5`，做一个`pip install mysqlclient`，其他的东西对我不起作用

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2009-01-18T09:25:58.687

`mysqldb`是 Python 的一个模块，它没有预装或 Django。你可以`mysqldb` [在这里](http://sourceforge.net/projects/mysql-python)下载。

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2011-05-14T02:17:49.367

Ubuntu：

```
sudo apt-get install python-mysqldb 
```

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2016-03-23T16:08:57.893

### 请注意，这未针对 python 3.x 进行测试

在 CMD 中

```
pip install wheel
pip install pymysql 
```

在 settings.py

```
import pymysql
pymysql.install_as_MySQLdb() 
```

它对我有用

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2018-08-04T06:42:44.980

对于 Windows：

```
pip install mysqlclient pymysql 
```

然后：

```
import pymysql
pymysql.install_as_MySQLdb() 
```

对于 python 3 Ubuntu

```
sudo apt-get install -y python3-mysqldb 
```

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2020-03-21T13:13:04.413

我在ubuntu（linux），对我有用的是

```
sudo apt-get install python3-dev default-libmysqlclient-dev build-essential 
```

然后最后

```
pip install mysqlclient 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2017-02-16T21:42:09.750

```
pip install PyMySQL 
```

然后将这两行添加到您的 Project/Project/ **init** .py

```
import pymysql
pymysql.install_as_MySQLdb() 
```

适用于 WIN 和 python 3.3+

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2021-01-18T20:18:43.257

对于任何在尝试为 寻找解决方案时来到此页面的人`sqlalchemy`，您需要做的就是：

```
pip install PyMySQL 
```

并调整您的连接字符串以使用 PyMySQL，从`mysql://`到`mysql+pymysql://`.

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2015-06-28T21:01:10.017

尝试这个。

```
pip install MySQL-python 
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2017-12-25T14:30:37.833

如果 pip install mysqlclient 产生错误并且您使用的是 Ubuntu，请尝试：

```
sudo apt-get install -y python-dev libmysqlclient-dev && sudo pip install mysqlclient 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2016-12-03T08:40:34.257

我在windows下遇到了同样的情况，寻找解决办法。

看到这篇文章[Install mysql-python (Windows)](https://stackoverflow.com/q/21440230/2544762)。

它指出安装这样的 pip 环境很困难，需要许多其他依赖项。

但我终于知道，如果我们使用`mysqlclient`低至 的版本`1.3.4`，它就不再需要那个要求了，所以试试：

```
pip install mysqlclient==1.3.4 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2019-10-05T07:38:30.013

我个人建议使用`pymysql`而不是使用正版 MySQL 连接器，它为您提供了一个独立于平台的接口，并且可以通过`pip`.

您可以像这样编辑 SQLAlchemy URL 架构： `mysql+pymysql://username:passwd@host/database`

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2019-10-29T06:41:23.403

对于 Python 3.6+

```
sudo apt-get install libmysqlclient-dev
pip3 install mysqlclient 
```

成功了

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2019-05-22T20:53:20.520

```
pip install --user mysqlclient 
```

以上对我来说就像对我的魅力一样。我实际上是从 sqlalchemy 出错的。环境信息：

## Python：3.6，Ubuntu：16.04，conda 4.6.8

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2021-06-20T13:26:46.693

# 蟒蛇 3.8

```
sudo apt-get install libmysqlclient-dev
sudo apt-get install -y python3-mysqldb 
```

```
pip3 install pymysql 
```

## 设置.py

```
import pymysql
pymysql.install_as_MySQLdb() 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2015-02-02T13:36:45.730

*   使用 .转到您的项目目录`cd`。
*   source/bin/activate （如果之前没有激活你的环境）。
*   运行命令`easy_install MySQL-python`

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-01-18T12:18:07.327

如果您在 Vista 上运行，您可能需要查看[Bitnami Django 堆栈。](http://bitnami.org/stack/djangostack)它是 Apache、Python、MySQL 等的多合一堆栈，与[Bitrock](http://bitrock.com)跨平台安装程序打包在一起，使其非常容易上手。它可以在 Windows、Mac 和 Linux 上运行。哦，而且是完全免费的 :)

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2012-10-04T11:38:40.607

感谢 derevo，但我认为还有另一种好方法：

1.  下载并安装[ActivePython](http://www.activestate.com/activepython/downloads#)
2.  打开命令提示符
3.  类型`pypm install mysql-python`
4.  阅读此软件包的特定说明。

我认为`pypm`比`easy_install`.

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2021-04-19T10:01:34.560

**Python 3**

Make sure the import order:

```
#BAD
import MySQLdb             # <------ NOT here
import pymysql
pymysql.install_as_MySQLdb()

#GOOD
import pymysql
pymysql.install_as_MySQLdb()
import MySQLdb              # <------- HERE! 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2019-05-15T15:06:15.270

对于**Python 3+**版本

安装`mysql-connector`为：

```
pip3 install mysql-connector 
```

**示例 Python DB 连接代码：**

```
import mysql.connector
db_connection = mysql.connector.connect(
  host="localhost",
  user="root",
  passwd=""
)
print(db_connection) 
```

**输出：**

```
> <mysql.connector.connection.MySQLConnection object at > 0x000002338A4C6B00> 
```

这意味着，数据库已正确连接。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2020-02-21T21:27:44.667

在 Debian Buster 上，以下解决方案适用于 python 3.7：

```
sudo apt-get install libmysqlclient-dev
sudo apt-get install libssl-dev
pip install mysqlclient 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-01-06T18:59:54.823

在 OSX 上，这些命令对我有用

```
brew install mysql-connector-c 
pip install MySQL-python 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2016-04-18T14:57:53.587

我已经尝试了上面的方法，但仍然没有名为'MySQLdb'的模块，最后，我成功了

```
easy_install mysql-python 
```

我的环境是 unbuntu 14.04

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2017-04-24T06:16:01.800

如果您正在使用 SQLAlchemy 并且错误出现在`/site-packages/sqlalchemy/dialects/mysql/mysqldb.py`：

```
from ...connectors.mysqldb import (
                        MySQLDBExecutionContext,
                        MySQLDBCompiler,
                        MySQLDBIdentifierPreparer,
                        MySQLDBConnector
                    ) 
```

因此您可能错过了 mysqldb 连接器，`SQLAlchemy`解决方案是在安装模块后重新安装sqlalchemy `mysql-python`。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2019-11-12T19:09:12.847

在通过 docker 映像全新安装的 Ubuntu 18.04 上，以上方法均不适用于我。

以下为我解决了它：

`apt-get install holland python3-mysqldb`

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-12-18T00:07:11.833

在我运行 Catalina v10.15.2 的 Mac 上，我遇到了以下 MySQLdb 版本冲突：

```
ImportError: this is MySQLdb version (1, 2, 5, 'final', 1), but _mysql is version (1, 4, 6, 'final', 0) 
```

为了解决它，我做了以下事情：

```
pip uninstall MySQL-python
pip install MySQL-python 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2021-04-21T13:47:49.543

在 mac 上使用 mysql.connector.python 版本 8.0.24 遇到了这个问题（如果代码库相同，那么问题也应该发生在 Windows 中）。[第 51 行的这个文件](https://github.com/mysql/mysql-connector-python/blob/master/lib/mysql/connector/django/base.py)导入“从 django.db.backends.mysql.base 导入 DatabaseWrapper 作为 MySQLDatabaseWrapper”。[导入](https://github.com/django/django/blob/main/django/db/backends/mysql/base.py)的文件有以下代码 14-20（您收到的确切代码和错误是代码的一部分

```
try:
    import MySQLdb as Database
except ImportError as err:
    raise ImproperlyConfigured(
        'Error loading MySQLdb module.\n'
        'Did you install mysqlclient?'
    ) from err 
```

错误在这里形成。不知道为什么这个导入在不同版本的 mysql 连接器中不断返回，但 8.0.23 没有导入，所以我恢复到那个版本并且错误消失了......这是你希望继续使用 mysql.connector 的情况。Python

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-07-10T17:16:44.870

Win10 / Python27 这对我有用：

```
easy_install mysql-python 
```

所有其他“pip install ...”因依赖错误而失败

# css - 哪个更好：CSS hack 还是浏览器检测？

> ID：454863
> 
> 赞同：35
> 
> 时间：2009-01-18T09:18:00.607
> 
> 标签：css, css-hack, javascript, browser-detection

通常，当我浏览 Internet 时，我发现人们通常使用 CSS hack 来使他们的网站在所有浏览器中看起来都一样。就个人而言，我发现找到所有这些黑客并对其进行测试非常耗时；您所做的每个更改都必须在 4 个以上的浏览器中进行测试，以确保它不会破坏其他任何东西。

大约一年前，我在 Internet 上查看了其他主要站点（雅虎、谷歌、BBC 等）正在使用的内容，发现其中大多数都在进行某种形式的浏览器检测（JS、HTML if 语句、基于服务器）。我也开始这样做了。在我最近工作的几乎所有网站上，我都使用 jQuery，所以我使用内置的浏览器检测。

您是否有理由使用或不使用其中任何一种？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-18T09:28:36.310

还有第三种选择：

**最小化或消除对浏览器检测和 CSS hack 的需求。**

我尝试使用 jQuery 插件之类的东西来为您处理任何浏览器差异（对于小部件等）。这并不能解决所有问题，但它做了很多工作，并且已经将支持多个浏览器的工作委托给了已经花费并将花费比您能够负担或想要的更多精力的人。

之后，我遵循以下原则：

*   使用我所说**的最小 CSS**，这意味着只使用被广泛支持的特性；
*   如有必要，使用表格进行复杂布局。你可能不喜欢这样，但坦率地说，做并排布局之类的事情，表格将在十年前的浏览器上工作，并且比让 div 使用绝对定位、浮动等组合的工作要少得多；
*   [**通过添加 DOCTYPE 强制 IE6 进入严格模式而不是怪癖模式**](http://www.quirksmode.org/css/quirksmode.html)。我不能强调这会让你的生活变得多么容易，但奇怪的是很多人似乎还没有这样做；
*   通过使用正确的 DOCTYPE 或使用嵌套块元素而不是其他[盒模型技巧](http://css-discuss.incutio.com/?page=BoxModelHack)来最小化[盒模型](http://css.maxdesign.com.au/listamatic/about-boxmodel.htm)问题；和
*   如有必要，包括相关浏览器的额外 CSS 文件。我倾向于在服务器上而不是在生成页面的客户端上执行此操作（让我们面对现实，这是其中的大多数）。我从事的许多项目都有 IEfix.css 文件。

之后，我将浏览器分为几层：

第一层：

*   火狐3；
*   IE7。

我的网站**必须**在这些方面工作。

2级：

*   火狐2；
*   苹果浏览器;
*   歌剧;
*   铬合金。

我的网站**应该**在这些上工作。这可能会冒犯一些人，但坦率地说，这些浏览器的市场份额是如此之低，以至于它们根本不如 Firefox 3 或 IE7 重要。

第 3 层：

*   IE6;
*   其他。

除非是例如公司要求，否则将尽可能少地处理这些问题。IE6 是一场噩梦，但截至 12 月它的[市场份额](http://www.w3schools.com/browsers/browsers_stats.asp)为 20%，而且还在迅速下降。此外，还有一些有效的安全问题（例如在金融网站上）劝阻甚至禁止使用 IE6，因此像[Paypal 这样的网站已经阻止了 IE6](http://www.hyperborea.org/journal/archives/2008/04/21/blocking-ie6/)，而[谷歌告诉用户放弃 IE6](http://tech.slashdot.org/article.pl?sid=09%2F01%2F01%2F145231&from=rss)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-18T09:21:51.770

问题是你真的只对 css 进行了一次尝试（因为它在客户端几乎是静态内容）......你不能（轻松）调整它以适应客户端的运行 - 所以对于那些棘手的人不兼容的情况（而且它们太多了），遗憾的是，检测是最好的途径。我看不到这种变化很快。

使用 javascript，您通常可以通过（如您所说的）jQuery 之类的库来避免这种痛苦 - 并检查*功能*支持而不是识别特定的浏览器（大部分时间）。有些情况您需要准确了解（例如，盒子模型）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-18T10:20:24.677

> 您是否有理由使用或不使用其中任何一种？

是的。如果 JavaScript 被停用，客户端浏览器检测会中断，并且可能无法在未来的浏览器版本中正常工作。最后一个原因也适用于 CSS hack。如果用户明确尝试破坏服务器端浏览器检测，它就会中断，但它仍然可能是一个可行的替代方案。

我会推荐：

确保您的代码在符合标准的浏览器中工作 - 即在其中一个或两个中开发，然后检查[browsershots.org](http://browsershots.org)。很可能有可能使用一个样式表在所有这些中实现所需的结果。

然后是IE。如果只有几个问题，您可以使用 CSS hack。否则，使用条件注释。

**编辑：**

如果我还必须支持古代浏览器，我通常会采用优雅降级的方式：我会让它们显示带有基本样式表（字体大小、颜色等）的纯 html。所有花哨的东西都会被`@import`规则隐藏起来。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-18T10:35:29.000

我通常喜欢为 Firefox 和 Safari 等符合标准的浏览器提供样式表，然后使用[条件注释](http://msdn.microsoft.com/en-us/library/ms537512.aspx)来检测 Internet Explorer 并为其提供包含 IE 特定修复和覆盖的附加 CSS 文件。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-08-19T02:12:13.507

在以编写 HTML 和 CSS 为生的 6 年中，我的绝大多数 CSS 问题都来自 Internet Explorer。

正如在其他答案中指出的那样，您可以使用[条件注释](http://msdn.microsoft.com/en-us/library/ms537512%28VS.85%29.aspx)为 IE 提供额外的样式表（或向`<body>`或`<html>`` element, if you don’t like multiple stylesheets). Unlike CSS hacks, conditional comments are explicit and supported. Unlike trying to detect IE from the`用户代理字符串添加一个类，它们保证可以工作。

至于非 IE CSS 问题，我从未发现值得浏览器检测的问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-18T09:22:48.413

对浏览器来说，hack 更快，但如果你的结构正确，浏览器检测会在你的 CSS 中提供更好的可读性。如果您可以进行浏览器检测，同时可以在浏览器之间共享 CSS，并且仅在单独的文件或其他文件中具有不同的 CSS，那么我会使用浏览器检测 - 因为这是新手可以理解的东西，CSS hacks如果你不认识他们就很难理解

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-18T09:23:44.527

我更喜欢使用浏览器检测并将独立于浏览器的 CSS 放入自己的文件中。

然而，最好的解决方案是找到默认交叉兼容的 CSS 并直接使用它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-18T14:42:13.660

我尽量不使用。在很多情况下，可以通过稍微简化标记结构来避免 IE 的问题。

如果您使用像[Eric Meyer's](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/)这样的体面的 CSS 重置，它也会有所帮助。

作为原则，我也在缓慢但肯定地放弃对 IE6 的支持，特别是考虑到 IE6 和 IE7 的最新安全问题——如果我们继续支持糟糕的浏览器，我们不会改变人们的浏览习惯和浏览器偏好。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-05T03:27:03.953

仔细考虑以上所有内容，尤其是关于 doctype 的指针。如果你必须应用 CSS hack，对于特定的浏览器来说，hack 几乎总是可以避免的。特别是对于干燥的静态页面。

从开发这些东西的有限经验来看......我假设你想制作一个没有凌乱的 Adoobi 购买软件的流畅网页：

*   编写一个在这些浏览器上看起来合理的页面，所有这些都可以在一台机器上测试：

**Op3ra 9.6, S@fari 3, Chr0me 1, 1nternet Xpl0rer 6, 7 & 8, Firefux 1.5**

*   使用@import css 规则抛弃古代浏览器中的 css，让他们吃蛋糕。

*   结合使用对象检测和浏览器嗅探来查找和消除问题浏览器（低于上述目标的所有版本）。还要赶上你知道速度不快的古代浏览器（你可以测试并与已知值比较的 css 属性），以防它们通过嗅探器，也可以使用条件注释踢出 1E5 给它一些反 css让它平静下来，与 ie6 类似，但如果可能的话，请将其保存在 jQu3ry 中。

*   使用动态元素将 jQu3ry 库加载到允许的浏览器中（任何未通过仔细测试的浏览器）。即，当我们知道它不起作用时，我们甚至不导入库/我们让其他人进入。

*   使用 jQu3ry 解决您支持的浏览器中的任何问题，其中大部分问题只有在您的页面变为动态时才会显现出来。使用 jQu3ry 增强布局并添加到您的界面等...

*   通过媒体声明对此进行扩展，您可以测试这些设备独有的 css 值，现在您将拥有更多用于调整布局的知识（即销毁这些列并缩小这些图像）。关闭动画等等。

*   如果您必须使用华丽的菜单人先生，请始终使用文本标签和一些定位技巧使其消失，以使其易于访问……只是不要仅依靠图像或 Javascript 来浏览您的网站。

*   它很容易阻止任何低于 Netsc@pe 的内容 4\. 只为他们提供基本的 Web，这是最初的方式。即，甚至不为它们指定背景或颜色、字体或任何东西。浏览器的默认设置应该可以正常工作。该信息将是可访问的。

事实上，我将所有“可访问”浏览器的 ID 设为 4 美元，这样我们就可以轻松地将它们从动态演示中剔除，并避免让残障人士陷入困境。

唉，她是一艘好船，但即使是一艘用来吓唬 M$ 的好船也必须死。不要害怕，因为我们现在有一个更好的；）

* * *

只是我的2美分，谨慎申请。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-29T07:03:44.963

检测浏览器服务器端有什么问题？似乎非常有效且万无一失（除非用户更改其用户代理字符串）。您可以使用 PHP 为页面选择样式表或为每个请求动态生成它 - 不确定其他语言是否允许您直接输出到文件并让您手动设置标题，但我无法想象他们不会让您识别用户代理，因此这些选项之一可能适用于任何服务器端环境。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-29T07:36:37.500

hacks 总是会增加你的工作量，并且应该优化工作量

首先，您添加了 hack，然后开始担心它们在不同浏览器和不同机器上的行为。

相反，您可以依赖供应商特定的 css 扩展 [http://reference.sitepoint.com/css/vendorspecific](http://reference.sitepoint.com/css/vendorspecific)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-01T11:36:52.507

[我的做法][1] 使用一个PHP类来检测操作系统、浏览器和浏览器版本。

[1]：我使用 PHP 类检测操作系统、浏览器和浏览器版本的方法 [http://reinholdweber.com/css/css-hacks-browser-version-detection-a-new-approach/](http://reinholdweber.com/css/css-hacks-browser-version-detection-a-new-approach/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-18T14:27:00.773

> 就个人而言，我发现找到所有这些黑客并对其进行测试非常耗时；您所做的每个更改都必须在 4 个以上的浏览器中进行测试，以确保它不会破坏其他任何东西。

您不必在每个浏览器上测试“正确”的 CSS hack。

这个想法是您编写符合标准的代码，然后添加特定的黑客攻击以针对一个且只有一个出错的浏览器（或渲染引擎）。例如，编写“* html #myelement”以仅针对 IE6 的异常：没有其他浏览器会受到该 hack 的影响，因此无需对其进行详尽的测试。如果一些新的不起眼的浏览器出现并犯了与 IE6 完全相同的错误，那么它只会出错，这极不可能，不是你的错，而且你可以期望很快得到修复。

有些东西自称为 CSS hack，但使用了无效的结构，例如“_propertyname”hack。这可能会跨浏览器中断，因为当您使用无效代码时，每个浏览器可能会以不同的方式解释它。不要使用这些。

老实说，这无论如何都不是以前的问题了，主要是因为 IE5 已经死了。如果您使用标准模式文档类型并写入标准，它将主要在当前的浏览器中工作。唯一真正剩下的问题案例是 IE6，您可以使用“* html”定位它；您不太可能需要更多的 CSS hacks 方式。幸运的是，Box Model Hack 的时代已经结束。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-18T22:41:39.027

听你的代码！肯特贝克说。在 Wing-Tsun 中，他们说：就像弯曲的水一样！或者其他的东西。

看，这是一个让 IE5 理解 html5 的 CSS Hack：http: [//blog.whatwg.org/styling-ie-noscript](http://blog.whatwg.org/styling-ie-noscript)。

使用 JS 也是如此：http: [//blog.whatwg.org/supporting-new-elements-in-ie](http://blog.whatwg.org/supporting-new-elements-in-ie)。

将 5 页的 hack 解释与 5 行易于理解的代码进行比较。所以，使用 JS。

事物有其好处和坏处。你对事情的理解和实际代码的优雅引领了方向。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-06-29T06:54:05.467

CSS hacks 不可行，因为浏览器一直在更新，新的更新可能会破坏您的 hack，而通过 Javascript 浏览器检测，您可以准确地确认浏览器的功能。但是，另一种选择是使用最少的 CSS 来确保在所有情况下一切正常。用于 UI 的 JQuery 和其他 javascript 库对浏览器的功能具有内置检测功能，因此您应该检查一下。

# .net - 使用 MVVM 处理 WPF 中的对话框

> ID：454868
> 
> 赞同：247
> 
> 时间：2009-01-18T09:23:11.627
> 
> 标签：.net, wpf, design-patterns, mvvm, dialog

在 WPF 的 MVVM 模式中，处理对话框是更复杂的操作之一。由于您的视图模型对视图一无所知，因此对话通信可能很有趣。我可以公开一个`ICommand`，当视图调用它时，会出现一个对话框。

有谁知道处理对话结果的好方法？我说的是 Windows 对话框，例如`MessageBox`.

我们这样做的一种方法是在视图模型上设置一个事件，当需要对话框时视图将订阅该事件。

```
public event EventHandler<MyDeleteArgs> RequiresDeleteDialog; 
```

这没关系，但这意味着视图需要代码，这是我想远离的。

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2009-05-08T16:36:40.773

我建议放弃 1990 年代的模态对话框，而是将控件实现为覆盖（画布+绝对定位），其可见性与 VM 中的布尔值相关联。更接近 ajax 类型的控件。

这非常有用：

```
<BooleanToVisibilityConverter x:Key="booltoVis" /> 
```

如：

```
<my:ErrorControl Visibility="{Binding Path=ThereWasAnError, Mode=TwoWay, Converter={StaticResource booltoVis}, UpdateSourceTrigger=PropertyChanged}"/> 
```

这是我如何将一个实现为用户控件的方法。点击'x'会在usercontrol的代码后面的一行代码中关闭控件。（因为我的视图在 .exe 中，视图模型在 dll 中，所以我对操纵 UI 的代码并不感到难过。）

![Wpf 对话框](https://i.stack.imgur.com/VFHAA.png)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-04-17T10:06:28.567

编辑： 10 多年后，我可以说使用调解器或任何其他消息传递模式在很多层面上都是一个非常糟糕的主意。不要这样做，只需实现 Jeffrey 的答案或在您的视图模型中注入的 IDialogService 即可。

* * *

您应该为此使用调解器。Mediator 是一种常见的设计模式，在其某些实现中也称为*Messenger*。它是 Register/Notify 类型的范例，使您的 ViewModel 和 Views 能够通过低耦合消息传递机制进行通信。

您应该查看 google WPF Disciples 组，然后搜索 Mediator。你会很高兴得到答案...

但是，您可以从以下开始：

[http://joshsmithonwpf.wordpress.com/2009/04/06/a-mediator-prototype-for-wpf-apps/](http://joshsmithonwpf.wordpress.com/2009/04/06/a-mediator-prototype-for-wpf-apps/)

享受 ！

编辑：您可以在此处使用 MVVM Light Toolkit 看到此问题的答案：

[http://mvvmlight.codeplex.com/Thread/View.aspx?ThreadId=209338](http://mvvmlight.codeplex.com/Thread/View.aspx?ThreadId=209338)

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-04-18T16:41:19.110

一个好的 MVVM 对话框应该：

1.  仅使用 XAML 声明。
2.  从数据绑定中获取所有行为。

不幸的是，WPF 不提供这些功能。显示对话框需要对`ShowDialog()`. 支持对话框的 Window 类不能在 XAML 中声明，因此不能轻易将数据绑定到`DataContext`.

为了解决这个问题，我编写了一个 XAML 存根控件，它位于逻辑树中并将数据绑定中继到 a`Window`并处理显示和隐藏对话框。你可以在这里找到它：http: [//www.codeproject.com/KB/WPF/XAMLDialog.aspx](http://www.codeproject.com/KB/WPF/XAMLDialog.aspx)

它使用起来非常简单，不需要对您的 ViewModel 进行任何奇怪的更改，也不需要事件或消息。基本调用如下所示：

```
<dialog:Dialog Content="{Binding Path=DialogViewModel}" Showing="True" /> 
```

您可能想要添加一个设置`Showing`. 我在我的文章中解释它。我希望这可以帮助你。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2011-02-10T11:01:10.097

我将[这种](https://stackoverflow.com/questions/3801681/good-or-bad-practise-for-dialogs-in-wpf-with-mvvm)方法用于与 MVVM 的对话。

我现在要做的就是从我的视图模型中调用以下内容。

```
var result = this.uiDialogService.ShowDialog("Dialogwindow title goes here", dialogwindowVM); 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-01-21T21:14:17.257

我当前的解决方案解决了您提到的大多数问题，但它完全从特定于平台的事物中抽象出来并且可以重用。此外，我没有使用任何代码隐藏，仅与实现 ICommand 的 DelegateCommands 绑定。Dialog 基本上是一个 View - 一个单独的控件，它有自己的 ViewModel，它从主屏幕的 ViewModel 中显示，但通过 DelagateCommand 绑定从 UI 触发。

在此处查看完整的 Silverlight 4 解决方案[Modal dialogs with MVVM and Silverlight 4](http://blog.roboblob.com/2010/01/19/modal-dialogs-with-mvvm-and-silverlight-4/)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-03-04T00:28:28.493

在学习（仍在学习）MVVM 时，我真的为这个概念苦苦挣扎了一段时间。我决定的，以及我认为其他人已经决定但我不清楚的是：

我最初的想法是不应该允许 ViewModel 直接调用对话框，因为它没有决定对话框应该如何显示的业务。正因为如此，我开始思考如何像在 MVP 中那样传递消息（即 View.ShowSaveFileDialog()）。但是，我认为这是错误的做法。

ViewModel 可以直接调用对话框。但是，当您测试 ViewModel 时，这意味着对话框将在您的测试期间弹出，或者一起失败（从未真正尝试过）。

因此，需要发生的事情是在测试时使用对话的“测试”版本。这意味着对于您拥有的任何对话，您都需要创建一个接口并模拟对话响应或创建一个具有默认行为的测试模拟。

您应该已经在使用某种服务定位器或 IoC，您可以对其进行配置，以根据上下文为您提供正确的版本。

使用这种方法，您的 ViewModel 仍然是可测试的，并且根据您模拟对话框的方式，您可以控制行为。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-03-21T09:25:10.520

有两种很好的方法可以做到这一点，1）对话服务（简单，干净），2）视图辅助。视图辅助提供了一些简洁的功能，但通常不值得。

# 对话服务

a）一个对话服务接口，比如通过构造函数或一些依赖容器：

`interface IDialogService { Task ShowDialogAsync(DialogViewModel dlgVm); }`

b) 您的 IDialogService 实现应该打开一个窗口（或将一些控件注入活动窗口），创建一个与给定 dlgVm 类型名称对应的视图（使用容器注册或约定或具有类型关联 DataTemplates 的 ContentPresenter）。ShowDialogAsync 应该创建一个 TaskCompletionSource 并返回其 .Task 属性。DialogViewModel 类本身需要一个事件，您可以在要关闭时在派生类中调用，并在对话框视图中观察以实际关闭/隐藏对话框并完成 TaskCompletionSource。

b) 要使用，只需在您的某个 DialogViewModel 派生类的实例上调用 await this.DialogService.ShowDialog(myDlgVm)。在 await 返回后，查看您在对话 VM 上添加的属性以确定发生了什么；你甚至不需要回调。

# 查看辅助

这让您的视图监听视图模型上的事件。如果您愿意的话，这一切都可以包含在一个混合行为中，以避免代码落后和资源使用（FMI，将“行为”类子类化以查看类固醇上的一种可混合附加属性）。现在，我们将在每个视图上手动执行此操作：

a) 使用自定义负载（DialogViewModel 派生类）创建一个 OpenXXXXXDialogEvent。

b) 让视图在其 OnDataContextChanged 事件中订阅该事件。如果旧值 != null 并且在 Window 的 Unloaded 事件中，请务必隐藏并取消订阅。

c) 当事件触发时，让视图打开您的视图，该视图可能位于页面上的资源中，或者您可以按照惯例在其他地方找到它（例如在对话服务方法中）。

这种方法更灵活，但需要更多的工作才能使用。我用的不多。例如，一个很好的优势是能够将视图物理放置在选项卡中。我使用了一种算法将其放置在当前用户控件的边界中，或者如果不够大，则向上遍历可视化树，直到找到足够大的容器。

这允许对话框靠近它们实际使用的地方，只使应用程序中与当前活动相关的部分变暗，并让用户在应用程序内移动而无需手动将对话框推开，甚至有多个准模态对话框在不同的选项卡或子视图上打开。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-11-17T18:16:02.287

使用可冻结命令

```
<Grid>
        <Grid.DataContext>
            <WpfApplication1:ViewModel />
        </Grid.DataContext>

        <Button Content="Text">
            <Button.Command>
                <WpfApplication1:MessageBoxCommand YesCommand="{Binding MyViewModelCommand}" />
            </Button.Command>
        </Button>

</Grid> 
```

```
public class MessageBoxCommand : Freezable, ICommand
{
    public static readonly DependencyProperty YesCommandProperty = DependencyProperty.Register(
        "YesCommand",
        typeof (ICommand),
        typeof (MessageBoxCommand),
        new FrameworkPropertyMetadata(null)
        );

    public static readonly DependencyProperty OKCommandProperty = DependencyProperty.Register(
        "OKCommand",
        typeof (ICommand),
        typeof (MessageBoxCommand),
        new FrameworkPropertyMetadata(null)
        );

    public static readonly DependencyProperty CancelCommandProperty = DependencyProperty.Register(
        "CancelCommand",
        typeof (ICommand),
        typeof (MessageBoxCommand),
        new FrameworkPropertyMetadata(null)
        );

    public static readonly DependencyProperty NoCommandProperty = DependencyProperty.Register(
        "NoCommand",
        typeof (ICommand),
        typeof (MessageBoxCommand),
        new FrameworkPropertyMetadata(null)
        );

    public static readonly DependencyProperty MessageProperty = DependencyProperty.Register(
        "Message",
        typeof (string),
        typeof (MessageBoxCommand),
        new FrameworkPropertyMetadata("")
        );

    public static readonly DependencyProperty MessageBoxButtonsProperty = DependencyProperty.Register(
        "MessageBoxButtons",
        typeof(MessageBoxButton),
        typeof(MessageBoxCommand),
        new FrameworkPropertyMetadata(MessageBoxButton.OKCancel)
        );

    public ICommand YesCommand
    {
        get { return (ICommand) GetValue(YesCommandProperty); }
        set { SetValue(YesCommandProperty, value); }
    }

    public ICommand OKCommand
    {
        get { return (ICommand) GetValue(OKCommandProperty); }
        set { SetValue(OKCommandProperty, value); }
    }

    public ICommand CancelCommand
    {
        get { return (ICommand) GetValue(CancelCommandProperty); }
        set { SetValue(CancelCommandProperty, value); }
    }

    public ICommand NoCommand
    {
        get { return (ICommand) GetValue(NoCommandProperty); }
        set { SetValue(NoCommandProperty, value); }
    }

    public MessageBoxButton MessageBoxButtons
    {
        get { return (MessageBoxButton)GetValue(MessageBoxButtonsProperty); }
        set { SetValue(MessageBoxButtonsProperty, value); }
    }

    public string Message
    {
        get { return (string) GetValue(MessageProperty); }
        set { SetValue(MessageProperty, value); }
    }

    public void Execute(object parameter)
    {
        var messageBoxResult = MessageBox.Show(Message);
        switch (messageBoxResult)
        {
            case MessageBoxResult.OK:
                OKCommand.Execute(null);
                break;
            case MessageBoxResult.Yes:
                YesCommand.Execute(null);
                break;
            case MessageBoxResult.No:
                NoCommand.Execute(null);
                break;
            case MessageBoxResult.Cancel:
                if (CancelCommand != null) CancelCommand.Execute(null); //Cancel usually means do nothing ,so can be null
                break;

        }
    }

    public bool CanExecute(object parameter)
    {
        return true;
    }

    public event EventHandler CanExecuteChanged;

    protected override Freezable CreateInstanceCore()
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-18T09:36:34.407

我认为对话框的处理应该是视图的责任，视图需要有代码来支持它。

如果您更改 ViewModel - View 交互以处理对话框，则 ViewModel 依赖于该实现。处理这个问题最简单的方法是让 View 负责执行任务。如果这意味着显示一个对话框，那么很好，但也可能是状态栏中的状态消息等。

我的观点是，MVVM 模式的重点是将业务逻辑与 GUI 分离，因此您不应该在业务层（ViewModel）中混合 GUI 逻辑（以显示对话框）。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-03-21T14:25:17.007

一个有趣的替代方法是使用负责显示视图（对话框）的控制器。

**[WPF 应用程序框架 (WAF)](http://waf.codeplex.com)**展示了其工作原理。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-01-29T18:25:04.853

为什么不在 VM 中引发事件并订阅视图中的事件呢？这将使应用程序逻辑和视图保持分离，并且仍然允许您将子窗口用于对话框。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-02-06T17:23:16.810

我已经实现了一个监听来自 ViewModel 的消息的行为。它基于 Laurent Bugnion 解决方案，但由于它不使用后面的代码并且更可重用，我认为它更优雅。

[如何使 WPF 的行为就像开箱即用地支持 MVVM](http://www.codeproject.com/Articles/377094/How-to-make-WPF-behave-as-if-MVVM-is-supported-out)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-24T01:39:29.323

我认为视图可以有代码来处理来自视图模型的事件。

根据事件/场景，它还可以有一个订阅视图模型事件的事件触发器，以及一个或多个作为响应调用的操作。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-03-11T21:30:48.540

我有同样的情况，并将 MessageBox 包装成一个设计器不可见的控件。详情在我的博客

[http://geekswithblogs.net/mukapu/archive/2010/03/12/user-prompts-messagebox-with-mvvm.aspx](http://geekswithblogs.net/mukapu/archive/2010/03/12/user-prompts-messagebox-with-mvvm.aspx)

同样可以扩展到任何模式对话框、文件浏览控件等。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-06-28T07:20:02.970

## 标准方法

在 WPF 中处理这个问题多年后，我终于找到了在 WPF 中实现对话框的**标准**方法。以下是这种方法的优点：

1.  干净的
2.  不违反 MVVM 设计模式
3.  ViewModal 从不引用任何 UI 库（WindowBase、PresentationFramework 等）
4.  非常适合自动化测试
5.  对话框可以轻松更换。

那么关键是什么。它是**DI + IoC**。

下面是它的工作原理。我正在使用 MVVM Light，但这种方法也可以扩展到其他框架：

1.  将 WPF 应用程序项目添加到您的解决方案。称之为**应用程序**。
2.  添加一个 ViewModal 类库。称之为**VM**。
3.  应用引用 VM 项目。VM项目对App一无所知。
4.  将 NuGet 对 MVVM Light 的引用添加到**两个项目**中。这些天我正在使用**MVVM Light Standard**，但你也可以使用完整的框架版本。
5.  在 VM 项目中添加一个接口**IDialogService ：**

    ```
    public interface IDialogService
    {
      void ShowMessage(string msg, bool isError);
      bool AskBooleanQuestion(string msg);
      string AskStringQuestion(string msg, string default_value);

      string ShowOpen(string filter, string initDir = "", string title = "");
      string ShowSave(string filter, string initDir = "", string title = "", string fileName = "");
      string ShowFolder(string initDir = "");

      bool ShowSettings();
    } 
    ```

6.  `IDialogService`在您的 中公开一个类型的公共静态属性`ViewModelLocator`，但将注册部分留给 View 层执行。**这是关键**。：

    ```
    public static IDialogService DialogService => SimpleIoc.Default.GetInstance<IDialogService>(); 
    ```

7.  在 App 项目中添加此接口的实现。

    ```
    public class DialogPresenter : IDialogService
    {
        private static OpenFileDialog dlgOpen = new OpenFileDialog();
        private static SaveFileDialog dlgSave = new SaveFileDialog();
        private static FolderBrowserDialog dlgFolder = new FolderBrowserDialog();

        /// <summary>
        /// Displays a simple Information or Error message to the user.
        /// </summary>
        /// <param name="msg">String text that is to be displayed in the MessageBox</param>
        /// <param name="isError">If true, Error icon is displayed. If false, Information icon is displayed.</param>
        public void ShowMessage(string msg, bool isError)
        {
                if(isError)
                        System.Windows.MessageBox.Show(msg, "Your Project Title", MessageBoxButton.OK, MessageBoxImage.Error);
                else
                        System.Windows.MessageBox.Show(msg, "Your Project Title", MessageBoxButton.OK, MessageBoxImage.Information);
        }

        /// <summary>
        /// Displays a Yes/No MessageBox.Returns true if user clicks Yes, otherwise false.
        /// </summary>
        /// <param name="msg"></param>
        /// <returns></returns>
        public bool AskBooleanQuestion(string msg)
        {
                var Result = System.Windows.MessageBox.Show(msg, "Your Project Title", MessageBoxButton.YesNo, MessageBoxImage.Question) == MessageBoxResult.Yes;
                return Result;
        }

        /// <summary>
        /// Displays Save dialog. User can specify file filter, initial directory and dialog title. Returns full path of the selected file if
        /// user clicks Save button. Returns null if user clicks Cancel button.
        /// </summary>
        /// <param name="filter"></param>
        /// <param name="initDir"></param>
        /// <param name="title"></param>
        /// <param name="fileName"></param>
        /// <returns></returns>
        public string ShowSave(string filter, string initDir = "", string title = "", string fileName = "")
        {
                if (!string.IsNullOrEmpty(title))
                        dlgSave.Title = title;
                else
                        dlgSave.Title = "Save";

                if (!string.IsNullOrEmpty(fileName))
                        dlgSave.FileName = fileName;
                else
                        dlgSave.FileName = "";

                dlgSave.Filter = filter;
                if (!string.IsNullOrEmpty(initDir))
                        dlgSave.InitialDirectory = initDir;

                if (dlgSave.ShowDialog() == DialogResult.OK)
                        return dlgSave.FileName;
                else
                        return null;
        }

        public string ShowFolder(string initDir = "")
        {
                if (!string.IsNullOrEmpty(initDir))
                        dlgFolder.SelectedPath = initDir;

                if (dlgFolder.ShowDialog() == DialogResult.OK)
                        return dlgFolder.SelectedPath;
                else
                        return null;
        }

        /// <summary>
        /// Displays Open dialog. User can specify file filter, initial directory and dialog title. Returns full path of the selected file if
        /// user clicks Open button. Returns null if user clicks Cancel button.
        /// </summary>
        /// <param name="filter"></param>
        /// <param name="initDir"></param>
        /// <param name="title"></param>
        /// <returns></returns>
        public string ShowOpen(string filter, string initDir = "", string title = "")
        {
                if (!string.IsNullOrEmpty(title))
                        dlgOpen.Title = title;
                else
                        dlgOpen.Title = "Open";

                dlgOpen.Multiselect = false;
                dlgOpen.Filter = filter;
                if (!string.IsNullOrEmpty(initDir))
                        dlgOpen.InitialDirectory = initDir;

                if (dlgOpen.ShowDialog() == DialogResult.OK)
                        return dlgOpen.FileName;
                else
                        return null;
        }

        /// <summary>
        /// Shows Settings dialog.
        /// </summary>
        /// <returns>true if User clicks OK button, otherwise false.</returns>
        public bool ShowSettings()
        {
                var w = new SettingsWindow();
                MakeChild(w); //Show this dialog as child of Microsoft Word window.
                var Result = w.ShowDialog().Value;
                return Result;
        }

        /// <summary>
        /// Prompts user for a single value input. First parameter specifies the message to be displayed in the dialog 
        /// and the second string specifies the default value to be displayed in the input box.
        /// </summary>
        /// <param name="m"></param>
        public string AskStringQuestion(string msg, string default_value)
        {
                string Result = null;

                InputBox w = new InputBox();
                MakeChild(w);
                if (w.ShowDialog(msg, default_value).Value)
                        Result = w.Value;

                return Result;
        }

        /// <summary>
        /// Sets Word window as parent of the specified window.
        /// </summary>
        /// <param name="w"></param>
        private static void MakeChild(System.Windows.Window w)
        {
                IntPtr HWND = Process.GetCurrentProcess().MainWindowHandle;
                var helper = new WindowInteropHelper(w) { Owner = HWND };
        }
    } 
    ```

8.  虽然其中一些功能是通用的（`ShowMessage`等`AskBooleanQuestion`），但其他一些特定于该项目并使用 custom `Window`。您可以以相同的方式添加更多自定义窗口。**关键是将特定于 UI 的元素保留在 View 层中，并在 VM 层中使用 POCO 公开返回的数据**。
9.  使用此类在视图层中执行 IoC 注册您的界面。您可以在主视图的构造函数中执行此操作（`InitializeComponent()`调用后）：

    ```
    SimpleIoc.Default.Register<IDialogService, DialogPresenter>(); 
    ```

10.  你去吧。您现在可以在 VM 和 View 层访问所有对话功能。您的 VM 层可以像这样调用这些函数：

    ```
    var NoTrump = ViewModelLocator.DialogService.AskBooleanQuestion("Really stop the trade war???", ""); 
    ```

11.  这么干净，你看。VM 层不知道 UI 层将如何向用户呈现 Yes/No 问题，并且仍然可以成功地使用对话框返回的结果。

## 其他免费福利

1.  为了编写单元测试，您可以在您的测试项目中提供一个自定义实现，`IDialogService`并在您的测试类的构造函数中将该类注册到 IoC。
2.  您需要导入一些命名空间，例如`Microsoft.Win32`访问“打开”和“保存”对话框。我将它们排除在外是因为这些对话框还有一个 WinForms 版本可用，而且有人可能想要创建自己的版本。另请注意，其中使用的一些标识符`DialogPresenter`是我自己的窗口的名称（例如`SettingsWindow`）。您需要从界面和实现中删除它们，或者提供您自己的窗口。
3.  如果您的 VM 执行多线程，请`DispatcherHelper.Initialize()`在应用程序生命周期的早期调用 MVVM Light。
4.  除了`DialogPresenter`在 View 层中注入的，其他的 ViewModal 应该被注册，`ViewModelLocator`然后应该公开该类型的公共静态属性以供 View 层使用。像这样的东西：

    ```
    public static SettingsVM Settings => SimpleIoc.Default.GetInstance<SettingsVM>(); 
    ```

5.  在大多数情况下，你的对话框不应该有任何代码隐藏，比如绑定或设置 DataContext 等。你甚至不应该将东西作为构造函数参数传递。XAML 可以为您完成这一切，如下所示：

    ```
    <Window x:Class="YourViewNamespace.SettingsWindow"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:local="clr-namespace:YourViewProject"
      xmlns:vm="clr-namespace:YourVMProject;assembly=YourVMProject"
      DataContext="{x:Static vm:ViewModelLocator.Settings}"
      d:DataContext="{d:DesignInstance Type=vm:SettingsVM}" /> 
    ```

6.  以这种方式设置`DataContext`可为您提供各种设计时优势，例如智能感知和自动完成。

希望对大家有所帮助。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-04-28T01:33:09.200

我滚动了我自己的窗口加载器，在这个问题的答案中描述：

[在应用程序中管理多个 WPF 视图](https://stackoverflow.com/questions/1828043/managing-multiple-wpf-views-in-an-application/1828258#1828258)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-12-12T17:28:47.890

Karl Shifflett 创建了一个示例应用程序，用于使用服务方法和 Prism InteractionRequest 方法显示对话框。

我喜欢服务方法 - 它不太灵活，因此用户不太可能破坏某些东西:) 它也与我的应用程序的 WinForms 部分一致 (MessageBox.Show) 但是如果您打算显示很多不同的对话框，那么 InteractionRequest 是一个更好的方式去。

[http://karlshifflett.wordpress.com/2010/11/07/in-the-box-ndash-mvvm-training/](http://karlshifflett.wordpress.com/2010/11/07/in-the-box-ndash-mvvm-training/)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-10-19T15:30:28.017

我知道这是一个老问题，但是当我进行这个搜索时，我发现了很多相关的问题，但我没有找到一个非常明确的答案。所以我自己实现了一个对话框/消息框/popin，我分享它！
我认为它是“MVVM 证明”，我尽量让它简单和适当，但我是 WPF 新手，所以请随时发表评论，甚至提出拉取请求。

[https://github.com/Plasma-Paris/Plasma.WpfUtils](https://github.com/Plasma-Paris/Plasma.WpfUtils)

你可以像这样使用它：

```
public RelayCommand YesNoMessageBoxCommand { get; private set; }
async void YesNoMessageBox()
{
    var result = await _Service.ShowMessage("This is the content of the message box", "This is the title", System.Windows.MessageBoxButton.YesNo);
    if (result == System.Windows.MessageBoxResult.Yes)
        // [...]
} 
```

如果你想要更复杂的 popin ，或者像这样：

```
var result = await _Service.ShowCustomMessageBox(new MyMessageBoxViewModel { /* What you want */ }); 
```

它显示了这样的事情：

![2](https://github.com/Plasma-Paris/Plasma.WpfUtils/raw/master/ReadMeFiles/2.png)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-04-05T11:12:30.947

我已经写了一篇关于这个主题的相当全面的文章，并且还为 MVVM Dialogs 开发了一个弹出库。严格遵守 MVVM 不仅是可能的，而且在正确实施时非常干净，并且可以轻松扩展到本身不遵守它的第三方库：

[https://www.codeproject.com/Articles/820324/Implementing-Dialog-Boxes-in-MVVM](https://www.codeproject.com/Articles/820324/Implementing-Dialog-Boxes-in-MVVM)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-18T10:07:48.790

在询问[任务或对话框的视图模型应该是什么样子](https://stackoverflow.com/questions/295751/how-does-the-presentation-viewmodel-for-a-task-or-dialog-look-like)时，我正在思考一个类似的问题。

我目前的解决方案如下所示：

```
public class SelectionTaskModel<TChoosable> : ViewModel
    where TChoosable : ViewModel
{
    public SelectionTaskModel(ICollection<TChoosable> choices);
    public ReadOnlyCollection<TChoosable> Choices { get; }
    public void Choose(TChoosable choosen);
    public void Abort();
} 
```

当视图模型决定需要用户输入时，它会为用户提取一个`SelectionTaskModel`带有可能选择的实例。基础设施负责调出相应的视图，该视图会在适当的时候`Choose()`根据用户的选择调用函数。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-03-28T08:52:15.017

我在同样的问题上苦苦挣扎。我想出了一种在 View 和 ViewModel 之间进行交互的方法。您可以开始从 ViewModel 向 View 发送消息，告诉它显示一个消息框，它会报告结果。然后 ViewModel 可以响应 View 返回的结果。

[我在我的博客](https://web.archive.org/web/20100124103318/http://jacokarsten.wordpress.com/2009/03/27/mvvm-intercommunication-between-view-and-viewmodel)中展示了这一点：

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-05-07T17:33:49.937

抱歉，但我必须插话。在找到 Prism 项目中的 Prism.Wpf.Interactivity 命名空间之前，我已经通过了几个建议的解决方案。您可以使用交互请求和弹出窗口操作来滚动自定义窗口，或者为了更简单的需求，内置通知和确认弹出窗口。这些创建了真正的窗口并按此方式进行管理。您可以在对话框中传递具有您需要的任何依赖项的上下文对象。自从我找到这个解决方案后，我们就在我的工作中使用它。我们这里有许多高级开发人员，没有人想出更好的办法。我们之前的解决方案是将对话服务放入叠加层并使用演示者类来实现它，但是您必须为所有对话视图模型等提供工厂。

这不是微不足道的，但也不是超级复杂。它内置于 Prism 中，因此是最好的（或更好的）实践恕我直言。

我的2美分！

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2012-01-27T10:20:47.497

编辑：是的，我同意这不是一个正确的 MVVM 方法，我现在正在使用类似于blindmeis 建议的东西。

你可以做到这一点的方法之一是

在您的主视图模型中（您打开模式的地方）：

```
void OpenModal()
{
    ModalWindowViewModel mwvm = new ModalWindowViewModel();
    Window mw = new Window();
    mw.content = mwvm;
    mw.ShowDialog()
    if(mw.DialogResult == true)
    { 
        // Your Code, you can access property in mwvm if you need.
    }
} 
```

在您的模态窗口视图/视图模型中：

XAML：

```
<Button Name="okButton" Command="{Binding OkCommand}" CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}}">OK</Button>
<Button Margin="2" VerticalAlignment="Center" Name="cancelButton" IsCancel="True">Cancel</Button> 
```

视图模型：

```
public ICommand OkCommand
{
    get
    {
        if (_okCommand == null)
        {
            _okCommand = new ActionCommand<Window>(DoOk, CanDoOk);
        }
        return _okCommand ;
    }
}

void DoOk(Window win)
{
    <!--Your Code-->
    win.DialogResult = true;
    win.Close();
}

bool CanDoOk(Window win) { return true; } 
```

或类似于此处发布的[WPF MVVM：如何关闭窗口](https://stackoverflow.com/questions/4376475/wpf-mvvm-how-to-close-a-window/9004041#9004041)

# visual-studio-2008 - Visual Studio 9 解决方案中的项目数量是否会影响解决方案加载和构建时间？

> ID：454870
> 
> 赞同：8
> 
> 时间：2009-01-18T09:25:34.773
> 
> 标签：visual-studio-2008, projects-and-solutions, build-time

我对解决方案加载时间和构建时间特别感兴趣——更少的解决方案是否意味着更好的性能？

请注意，我指的*不是构建应用程序的性能。*

处理较少数量的项目时，加载时间和构建时间是否更有效？

作为指导，我们的 Visual Studio 解决方案中有 50-60 个项目。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-18T09:50:58.577

> （我对解决方案加载时间和构建时间特别感兴趣——更少的解决方案是否意味着更好的性能？）

[这是](http://codebetter.com/blogs/patricksmacchia/archive/2008/12/08/advices-on-partitioning-code-through-net-assemblies.aspx)Patrick Smacchia 的相关主题，描述了拥有少量程序集（此后是少量项目）的好处。他准确地谈到了装配数量如何影响构建时间和其他因素。

我鼓励你阅读 Patrick 的博客。他有很多关于代码组件化的文章。

[通过 .NET 程序集对代码进行分区的建议](http://codebetter.com/blogs/patricksmacchia/archive/2008/12/08/advices-on-partitioning-code-through-net-assemblies.aspx)

[从 NUnit 代码库中吸取的教训](http://codebetter.com/blogs/patricksmacchia/archive/2009/01/11/lessons-learned-from-the-nunit-code-base.aspx)

[关于如何组件化现有代码的提示。](http://codebetter.com/blogs/patricksmacchia/archive/2007/12/16/hints-on-how-to-componentize-existing-code.aspx)

根据我个人的经验，拥有几十个项目的解决方案是很痛苦的。IMO 拥有超过 10 个项目将导致明显的维护问题并影响您的生产力。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T09:35:42.927

我取决于你的项目，大部分时间我使用 10-15。项目越少，构建时间就越短。

我通常有的项目是：

*   具有异常和错误处理的基础项目
*   商业逻辑
*   数据访问层 - 存储库
*   WebForms 或 WinForms 或 WPF UI

其中一些我会分成 3-4 个其他项目。我也会有 NUnit 测试项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-18T09:32:18.317

50-60对我来说听起来很多。我发现有*很多*项目，打开 Visual Studio 可能需要很长时间。如果您更改许多其他项目所依赖的项目，构建时间可能会很糟糕，但我不知道 10 个项目（每个项目有 20 个类）和 100 个项目（每个项目有 2 个项目）之间有什么不同。（换句话说，我不确定构建中每个项目的开销。）即使你*不*更改任何东西，大概每个项目都必须检测它是否需要重建任何东西——我无法想象那是免费，但如果不使用您自己的代码进行尝试，就很难给出更明确的信息。

我曾在多家公司工作过，他们有很多项目，每个项目只有几个课程——这些课程可以很容易地合并到一个项目中。根据我的经验，这也具有维护/可管理性的好处。（当然，不要心甘情愿地这样做——要明智。）

如果您实际上有合理规模的项目，只是其中很多，请考虑在可能的情况下拆分解决方案。如果它们都是小型项目，请考虑合并其中的一些。如果您无论如何都没有发现自己在等待 Visual Studio（打开/构建），那么不要太担心。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-18T09:46:24.857

在您的解决方案中包含太多项目是一个坏主意。它会影响构建时间。请参阅[这篇文章](http://gamesfromwithin.com/?p=42)，该文章将构建时间与几种构建工具进行了比较。根据文章，Visual Studio 每个项目需要 2 秒，即使该项目不是构建的一部分。

这也符合我的经验，Visual Studio 是可用的最慢的构建工具之一。在 Visual Studio 6 和 2006 之间，对于一个相对简单的 C 项目，我的构建时间从 1 分钟变为 5 分钟。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-08-20T13:15:23.713

聚会迟到了，但到目前为止，没有一个答案提到构建配置。您的解决方案中可以有很多项目，而无需在每次运行时都构建它们。单击 Debug/Release 组合并创建一个新的构建配置 - 在那里您可以决定要构建或不构建哪些项目。

为什么要这样做？我这样做是为了让我可以随意“转到定义”，这样我就可以快速地将项目进出我的构建，而无需经历所有添加项目的痛苦。

另外，请注意，如果您有解决方案文件夹，您可以右键单击并在该文件夹上构建，这将构建该文件夹中的所有项目。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-18T10:36:32.650

当您创建很多小项目时，我看到的问题是：

1/**封装**：要在两个项目之间共享的类、方法或属性必须是公共的，因此在任何地方都可见。你拥有的项目越多，你就越有可能泄露一些秘密......

2/**程序集总数**：正如**Aku**所写，更少的项目意味着更少的程序集。由于每个项目都在本地复制他们使用的程序集，因此您的文件夹中最多可以有 (n * (n - 1)) / 2 个程序集（程序集 1 的 49 个副本、程序集 2 的 48 个副本，...）。对于 50 个项目，这是**1176**个文件！=> 好吧，你可能少了很多（200？），但仍然足以让一两个过时的副本在这里和那里......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-18T12:41:25.330

我在一个有大量项目的项目上工作，在 50-60 的范围内，我发现与开发人员懒惰/健忘相关的问题相比，较长的加载时间是可以接受的。

许多项目依赖于基础库，因此在基础库更改时需要重新构建。由于项目在任何给定时间都可能发生变化，因此让开发人员只处理一个子集意味着如果他们懒惰，当从 CM 工具接收到更新时，他们将不会重建整个应用程序。然后，他们可以花费大量时间来尝试修复问题，从而了解为什么会出现问题。如果 VS 知道整个依赖关系树，那么这一切都解决了，并且快速构建所有内容可以使其全部正常工作。

我意识到一个优秀的开发人员会知道这一点并默认这样做，但不是每个人都很棒，有时甚至伟大的人也会休息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-17T12:21:04.853

还有一些微软的话...

[http://tfsguide.codeplex.com/Wiki/View.aspx?title=Chapter%203%20-%20Structuring%20Projects%20and%20Solutions%20in%20Source%20Control](http://tfsguide.codeplex.com/Wiki/View.aspx?title=Chapter%203%20-%20Structuring%20Projects%20and%20Solutions%20in%20Source%20Control)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-18T09:28:51.647

在我看来，这只是个人组织和秩序的问题。如果您希望在同一个解决方案下有很多以某种方式相互连接的项目，您可以这样做。我认为你只需要考虑你是否真的需要它们。每个解决方案没有神奇的最大项目数

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-17T13:06:16.567

我尝试坚持的一般做法是每个解决方案 4-5 个项目。

*   商业逻辑
*   通信层（服务器相关）
*   用户界面
*   测试项目以利用/测试其他三个项目

这通常符合我们的风格以及我们如何实施它。如有必要，我们也可以在其中包含其他内容，但这些实例对我们来说并不像这四个一样常见。

# wpf - WPF 的语法荧光笔

> ID：454872
> 
> 赞同：9
> 
> 时间：2009-01-18T09:27:26.017
> 
> 标签：wpf, syntax, syntax-highlighting

我目前正在为 WPF 应用程序寻找语法荧光笔。一个文本框可供用户输入，希望能识别代码并相应地突出显示语法。

我想稍后支持 C# initialy 和其他语言。

问题[394751的重复](https://stackoverflow.com/questions/394751/anyone-know-a-code-editor-i-can-embed-in-a-wpf-window-or-windows-forms)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-18T09:37:54.560

我想这个问题有你的答案。

[有人知道我可以嵌入到 WPF 窗口或 Windows 窗体中的代码编辑器吗？](https://stackoverflow.com/questions/394751/anyone-know-a-code-editor-i-can-embed-in-a-wpf-window-or-windows-forms)

或者你可以自己写一个：http: [//blogs.microsoft.co.il/blogs/tamir/archive/2006/12/14/RichTextBox-syntax-highlighting.aspx](http://blogs.microsoft.co.il/blogs/tamir/archive/2006/12/14/RichTextBox-syntax-highlighting.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T09:38:25.167

前段时间我发现[这篇](http://blogs.microsoft.co.il/blogs/tamir/archive/2006/12/14/RichTextBox-syntax-highlighting.aspx)博客文章有一个关于如何从 RichTextBox 创建自定义语法高亮控件的教程。也许它对你也有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T11:05:31.530

如果您不介意没有任何文档，[AvalonEdit](http://wiki.sharpdevelop.net/Default.aspx?Page=AvalonEdit&AspxAutoDetectCookieSupport=1)是一个不错的选择。我目前正在用于一个项目，它是一个很棒的工具。即使在复杂的场景中，我也没有遇到过一个错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T09:39:11.377

我一直在寻找同样的东西但没有成功。我发现的唯一解决方案是 Actipro 的用于 WinForms 的[语法荧光笔](http://www.actiprosoftware.com/Products/DotNet/WindowsForms/SyntaxEditor/default.aspx)，它可以托管在 WPF 应用程序中。AFAIK Actipro 正在开发 WPF 版本，但我不知道它是否准备好

# jquery - 如何在不推荐使用 $.browser.msie 的情况下使用 jQuery 1.3 进行浏览器检测？

> ID：454875
> 
> 赞同：25
> 
> 时间：2009-01-18T09:29:10.913
> 
> 标签：jquery, css, browser-detection

既然 jQuery 1.3 已经被弃用（我假设在未来的版本中被删除）`$.browser.msie`和类似的，应该如何进行浏览器检测？

我经常使用它来确定我们在哪个浏览器中进行几乎所有浏览器的 CSS 修复，例如：

```
$.browser.opera
$.browser.safari
$.browser.mozilla 
```

...好吧，我认为这就是全部:)

在我使用它的地方，我不确定是什么浏览器问题导致了问题，因为很多时候我只是试图修复`1 px`浏览器中的差异。

**编辑：**使用新的 jQuery 功能，无法确定您使用的是 IE6 还是 IE7。现在应该如何确定这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-24T09:24:17.517

是的，浏览器检测已被弃用，但被弃用的属性可能不会很快从 jQuery 中删除。当它们被删除时，如果您仍然绝对需要进行浏览器检测，您可以使用一个小而简单的插件轻松添加相同的功能。

所以，我的回答是暂时不做任何事情:)

编辑：我什至会为您提供将来使用的插件（未经测试，从 jquery 源复制粘贴）：

```
(function($) {
    var userAgent = navigator.userAgent.toLowerCase();

    $.browser = {
        version: (userAgent.match( /.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/ ) || [0,'0'])[1],
        safari: /webkit/.test( userAgent ),
        opera: /opera/.test( userAgent ),
        msie: /msie/.test( userAgent ) && !/opera/.test( userAgent ),
        mozilla: /mozilla/.test( userAgent ) && !/(compatible|webkit)/.test( userAgent )
    };

})(jQuery); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-19T07:52:43.003

我遇到了类似的情况，没有 $.support.png (p.ej.)，所以我需要使用 $.browser.version，也许我们可以继续要求更多的 $.support.XXXX 属性，一样多如所须。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-18T09:32:59.860

.browser 已被弃用，取而代之的是 .support。更多信息在这里：[jquery.support](http://docs.jquery.com/Utilities/jQuery.support) 这本质上意味着，jquery 现在没有使用浏览器嗅探，而是支持检测，并允许对浏览器可以执行的操作进行更细粒度的控制。

从描述：

> 在 jQuery 1.3 中添加了一组属性，表示存在不同的浏览器功能或错误。
> 
> jQuery 附带了许多属性，您可以随意添加自己的属性。这些属性中的许多都是相当低级的，因此它们在一般的日常开发中是否有用值得怀疑，但主要由插件和核心开发人员使用。
> 
> 所有支持属性的值都是使用特征检测确定的（并且不使用任何形式的浏览器嗅探）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-04T17:19:18.110

功能支持听起来是个好主意，但只有在它支持所有可能的“错误”时才能按预期工作。像第一个评论者一样，没有 $support.png，或 $support.stepping，或 $support.peekaboo，或一个，哦，名单还在继续。这样做的问题是，使一个浏览器兼容的一些代码将不可避免地最终由不需要它的浏览器执行。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-11-19T07:07:45.970

浏览器检测在 jQuery*中不被弃用。*[jQuery.browser](http://docs.jquery.com/Utilities/jQuery.browser)的文档页面，其中指出：

**我们建议不要使用此属性，请尝试改用特征检测（请参阅 jQuery.support）。**

弃用的意思是“计划在未来删除”。这个关于嗅探功能而不是用户代理的建议只是很好的一般建议，而不是特定于 jQuery。他们所说的只是他们让做正确的事情变得更容易。

然而，总是需要用户代理嗅探。除非`jQuery.support`由大量开发人员每天更新，否则它无法跟上每个浏览器的每个次要版本中的每个错误和每个功能。

我认为对此的困惑源于这样一个事实，即在内部，jQuery 不再进行浏览器嗅探。但实用 API jQuery.browser 将继续存在。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-10-09T14:19:28.893

```
function browserLessThanIE7(){
   return (/MSIE ((5\\.5)|6)/.test(navigator.userAgent) && navigator.platform == "Win32");
} 
```

也可以正常工作...这个检查版本 5、5.5 和 6。

@Nate：将 (5\.5)|6 更改为 7 并检查版本 7。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-12T21:22:12.823

我说从 jQuery 1.2 的代码库对它进行逆向工程。

请参阅代码的这一部分：

```
jQuery.browser = {
    version: (userAgent.match( /.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/ ) || [])[1],
    safari: /webkit/.test( userAgent ),
   opera: /opera/.test( userAgent ),
  msie: /msie/.test( userAgent ) && !/opera/.test( userAgent ),
  mozilla: /mozilla/.test( userAgent ) && !/(compatible|webkit)/.test( userAgent )
}; 
```

尊重 GPL 和 MIT 许可并从代码中学习。不要复制和粘贴。

或者专门用于嗅出 IE6。你可以这样做：

```
function IsThisBrowserIE6() {
    return ((window.XMLHttpRequest == undefined) && (ActiveXObject != undefined))
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-04T02:01:24.523

特征检测听起来很不错，但是当我编写一些在某个浏览器中不起作用的代码时，最快的方法是浏览器检测。

使用自动边距将元素水平居中适用于除 IE 之外的所有浏览器。我要测试什么功能？我不知道。但我确实知道它在哪个浏览器中不起作用。

我可以看到为什么特征检测在某些情况下会很有用，例如。如果浏览器处于怪癖/严格模式。最好的折衷办法是同时使用这两种方法。

鉴于此“我们建议不要使用此属性，请尝试使用特征检测”，应该从 jQuery.browser 文档页面中删除。这是误导。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-04-21T00:09:16.120

为什么不能重写 jquery.browser 以在内部使用 jquery.support 来根据功能确定浏览器（可能在需要时补充来自 jquery.browser 的当前方法），以提供一种方便的方式来选择浏览器系列和版本, 虽然可能比今天的 jquery.browser 更可靠？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-18T09:32:48.487

[jQuery 1.3 已经取代了浏览器测试](http://www.ajax-blog.com/jquery-13-beta-sizzling-and-feature-testing.html)。

坦率地说，我很惊讶 Web 开发人员如此频繁地关心他们的站点在什么浏览器中运行。在 10 多年的 Web 开发中，我能想到一些我关心的案例，更不用说费心去做任何不同的事情了。最常见的原因是 Firefox 和 IE 之间的命名字体大小差异很大（`font-size: large`在 IE 中比在 FF 中大很多），所以我使用了 IEfix.css 文件来更正它。

也许你应该看看[什么更好：CSS hacks 还是浏览器检测？](https://stackoverflow.com/questions/454863/what-is-better-css-hacks-or-browser-detection#454873)以便就该主题进行更深入的讨论。

总而言之，您应该关心是否支持某个功能，而不是它是哪个浏览器。

如果不知道你为什么关心它是否是 IE，就很难再说什么，因为你可能会发现有一个更好的解决方案来做你正在做的事情。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-24T09:14:32.407

[在http://code.labor8.eu/geckoFix](http://code.labor8.eu/geckoFix)尝试 GeckoFix 脚本，它会检测低于 3.0 的 Firefox，因此您可以根据需要自定义它（即通过添加更多规则，例如检测 Firefox 2、Firefox 3、Opera 和苹果浏览器）。我认为这可能是您正在寻找的东西。要检查用户代理，只需在地址栏中输入 javascript:alert(navigator.userAgent) 并找到一些您需要输入脚本的特定字符。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-14T07:25:47.347

我有一段在 Mozilla 和 Webkit 浏览器以及 IE8 中运行良好的 Javascript。但是，在 6 和 7 中它会中断。这与 CSS 无关，也与糟糕的 Javascript 无关，而是 IE<8 的糟糕支持。

我可以看到人们从哪里来检查“功能”而不是浏览器嗅探，但是，嗅探可用于的功能与破坏代码无关，那么浏览器嗅探和功能嗅探之间有什么区别，直到$.support 对象中的所有功能都可用？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-02-23T04:15:14.200

这可能不是 IE 6 最干净的方式，但它确实有效且易于理解：

```
$(document).ready(function() {
    ie6catch = $.browser.msie + $.browser.version;
    if (ie6catch.indexOf("true6") == -1) {
        alert("This is not Internet Explorer 6");
    }
}); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-08-17T03:10:54.063

我想指出这`navigator.userAgent`不是很值得信赖，因为它很容易修改并且可能不代表查看页面的实际浏览器。这可能是`$.browser`最初被弃用的原因之一。

但是为了这个问题，让我们假设浏览器检测是*绝对需要*的。

我遇到[了 James Padolsey 的这个非常酷的片段](http://james.padolsey.com/javascript/detect-ie-in-js-using-conditional-comments/)，它实际上通过使用条件注释来区分 Internet Explorer。

我用上面的代码片段和一些来自[yepnope.js](https://github.com/SlexAxton/yepnope.js/blob/master/yepnope.js)的代码编译了一小段代码：

```
(function(window, doc) {
    window.detector = window.detector || (function() {
        var undef,
            docElement = doc.documentElement,       
            v = 3,
            div = document.createElement('div'),
            all = div.getElementsByTagName('i'),
            isGecko = ( 'MozAppearance' in docElement.style ),
            isGeckoLTE18 = isGecko && !! doc.createRange().compareNode,
            isOpera = !! ( window.opera && toString.call( window.opera ) == '[object Opera]' ),
            isWebkit = ( 'webkitAppearance' in docElement.style ),
            isNewerWebkit = isWebkit && 'async' in doc.createElement('script');

            while (
                div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',
                all[0]
            );

            return {
                isGecko: isGecko,
                isGeckoLTE18: isGeckoLTE18,
                isGeckoGT18: isGecko && ! isGeckoLTE18,
                isOpera: isOpera,
                isWebkit: isWebkit,
                isNewerWebkit: isWebkit && 'async' in doc.createElement('script'),
                isIE: ( v > 4 ),
                ieVersion: ( v > 4 ? v : undef )
            };
    }());
}(window, document)); 
```

这通过它们的功能来区分浏览器。

唯一的问题是，我目前无法区分 Safari 和 Chrome（都是 Webkit 浏览器），以及 Gecko、Webkit 和 Opera 浏览器本身的版本。

我知道它并不完美，但它比`navigator.userAgent`.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-03-30T05:42:18.877

一个好主意是将浏览器作为一个类添加到 css 的 body 标记中。不确定这是否有效，因为我不运行 Windows，而且我有一台 powerPC，但它应该为所有 Internet Explorer 6-9 放置一个 .ie6 类，不是很有帮助。其他一切使用[mooModernizr](http://www.aryweb.nl/voorbeelden/mooModernizr/)。

```
if (Browser.Engine.trident) {

    var IEbrowser = $('body');

    IEbrowser.addClass('ie');

}​ 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-05-07T01:48:36.340

```
var browser = {
        chrome: false,
        mozilla: false,
        opera: false,
        msie: false,
        safari: false
    };
    var sBrowser, sUsrAg = navigator.userAgent;
    if(sUsrAg.indexOf("Chrome") > -1) {
        browser.chrome = true;
    } else if (sUsrAg.indexOf("Safari") > -1) {
        browser.safari = true;
    } else if (sUsrAg.indexOf("Opera") > -1) {
        browser.opera = true;
    } else if (sUsrAg.indexOf("Firefox") > -1) {
        browser.mozilla = true;
    } else if (sUsrAg.indexOf("MSIE") > -1) {
        browser.msie = true;
    }
console.log(browser.msie); 
```

# jquery - 如何在 ajax 请求正在进行时禁止单击链接？

> ID：454880
> 
> 赞同：2
> 
> 时间：2009-01-18T09:34:44.800
> 
> 标签：jquery, ajax

我有“a”元素，它作为按钮服务器。它没有 href 属性。

我正在使用 jQuery 来实现非常简单的事情：点击启动 ajax 请求并防止进一步点击。ajax 完成后，启用点击。我不使用表单或输入按钮。

```
var contact= {
    send: function() {
        $.ajax({
            type: "POST",
            url: "ws/ContactService.asmx/SendEmail",
            data: '{"fromEmail":"' + $("#email").val() + '", "fromName":"' + $('#name').val() + '", "subject":"' + $('#subject').val() + '", "message":"' + $('#message').val() + '"}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",

            error: function() {

                alert("Error");

            },
            success: function(msg) {
                alert(msg.d);
            },
            complete: function() {
            $("#send").text("Send");

            }
        });
    }
};
$(document).ready(function() {
    $("#send").("click", function() {
        $("#send").text("Sending...");       
        contact.send();
    });
}
); 
```

这很好用，除了我可以根据需要多次点击发送，每次点击都会产生新的 ajax 请求。ajax请求正在进行时如何防止点击“a”元素？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T10:22:03.567

你可以使用这样的东西：

```
var contact = {
  inprogress: false,
  send: function() {
     if (contact.inprogress)
       return;

     contact.inprogress = true;
     $.ajax({
       ...
       complete: function() {
         $("#send").text("Send");
         contact.inprogress = false;
       }
     });
  }
}; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T09:51:46.357

使用[其中一种技术](http://www.designateonline.com/discussions/comments.php?DiscussionID=4681&page=1)，在 ajax 调用返回时设置链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-10T03:42:23.893

或者将 async 设置为 false，这将冻结页面直到请求完成

# c# - LINQ 性能影响

> ID：454891
> 
> 赞同：2
> 
> 时间：2009-01-18T09:49:09.983
> 
> 标签：c#, linq

我有一个简单的程序来去除 XML 中所有非法字符的字符串：

```
string SanitizeXml(string xml)
{
    return string.Concat
        (xml.ToCharArray().Where(c => IsLegalXmlChar(c)).ToArray());
} 
```

它很好而且简洁。但我担心它的表现。使用简单的 for 循环可以轻松完成相同的事情：

```
string SanitizeXml(string xml)
{
    var buffer = new StringBuilder();

    foreach(char c in xml)
    {
        if (IsLegalXmlChar(c))
        {
            buffer.Append(c);
        }
    }

    return buffer.ToString();
} 
```

令我印象深刻的是，在第二个示例中，xml 被转换为 char[]，而 Where() 的 IEnumerable<char> 被转换为 char[]。我似乎经常用 LINQ 做这件事——在数组和可枚举之间进行更改。

我应该担心这个吗？一般来说，当有一个可能更冗长的明确替代方法时，我会因为依赖 LINQ 扩展方法而获得什么样的性能影响。

也许这个问题太笼统了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T09:55:52.590

好吧，您不需要第一次调用以`ToCharArray()`-string implements 开头`IEnumerable<char>`。但是，我同意 StringBuilder 和循环在这种情况下可能更合适。

我不确定 string.Concat(char[]) 的作用，顺便说一句 - 你为什么不直接使用带有 char 数组的字符串构造函数？换句话说，在这些修改之后：

```
static string SanitizeXml(string xml)
{
    return new string (xml.Where(c => IsLegalXmlChar(c)).ToArray());
} 
```

我仍然更喜欢 StringBuilder 解决方案，但是对于常见情况（非法字符很少）可以通过提供适当的容量来改进：

```
string SanitizeXml(string xml)
{
    var buffer = new StringBuilder(xml.Length);

    foreach(char c in xml)
    {
        if (IsLegalXmlChar(c))
        {
                buffer.Append(c);
        }
    }

    return buffer.ToString();
} 
```

我之前没有想到的另一种选择可能是 StringBuilder 上的扩展方法：

```
// Can't just call it Append as otherwise StringBuilder.Append(object) would
// be used :(
public static StringBuilder AppendSequence(this StringBuilder builder,
                                           IEnumerable<char> sequence)
{
    foreach (char c in sequence)
    {
        builder.Append(c);
    }
    return builder;
} 
```

然后你可以像这样使用它：

```
xml = new StringBuilder(xml.Length)
            .AppendSequence(xml.Where(IsLegalXmlChar)
            .ToString(); 
```

（如果需要，您可以为 AppendSequence 设置其他重载以采用 IEnumerable 等。）

编辑：另一种选择可能是避免经常调用 Append ，而是使用[附加 substring 的重载](http://msdn.microsoft.com/en-us/library/kc12ydtf.aspx)。然后，您可以再次为 StringBuilder 构建一个扩展方法，例如（完全未经测试，恐怕 - 我什至没有尝试编译它）：

```
public static StringBuilder AppendWhere(this StringBuilder builder,
                                        string text,
                                        Func<char, bool> predicate)
{
    int start = 0;
    bool lastResult = false;
    for (int i=0; i < text.Length; i++)
    {
        if (predicate(text[i]))
        {
            if (!lastResult)
            {
                start = i;
                lastResult = true;
            }
        }
        else
        {
            if (lastResult)
            {
                builder.Append(text, start, i-start);
                lastResult = false;
            }
        }
    }
    if (lastResult)
    {
         builder.Append(text, start, text.Length-start);
    }
    return builder;
} 
```

示例用法：

```
xml = new StringBuilder(xml.Length).AppendWhere(xml, IsLegalXmlChar)
                                   .ToString(); 
```

另一种选择是将其更改为 String 的扩展方法，懒惰地创建 StringBuilder，如果您以 start=0 结束，则返回原始字符串。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T10:49:15.790

**对于一个简单的`foreach`循环，这两个版本本质上是相同的。**

想想为什么我们`IEnumerable`首先有类型，它是用于`foreach`循环的！如果您使用 foreach 循环，那么您的字符串会在后台转换为 IEnumerable，因此逻辑基本上与 LINQ 版本中的逻辑相同。

除非您进行一些优化，即使用 StringBuilder，否则性能不会有太大差异。

这是一个分析代码： http: [//pastebin.com/f125a9a46](http://pastebin.com/f125a9a46)

信用@Chris，@Marc_Garvell，@Jon_Skeet

这是我机器上的结果：

```
Simple LINQ version                      : 43270ms
For-each-loop version w/ StringBuilder   : 35875ms
For-each-loop version w/ List            : 37595ms
For-index loop w/ StringBuilder          : 37589ms
Jon Skeet's AppendWhere version          : 28980ms 
```

这是启用代码优化的结果：

```
Simple LINQ version                      : 27814ms
For-each-loop version w/ StringBuilder   : 23453ms
For-each-loop version w/ List            : 21374ms
For-index loop w/ StringBuilder          : 22308ms
Jon Skeet's AppendWhere version          : 10884ms 
```

LINQ 和 foreach 循环之间的 4.3 秒差异并不能真正证明 400,000,000 个字符是合理的，因为您还考虑到您使用了 StringBuilder 而 LINQ 有从 char 数组重建的开销。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T09:55:13.310

就个人而言，我不会在这种情况下使用 LINQ / 扩展方法；LINQ 是一个强大的工具，但它不应该用于所有问题。

根据定义，使用等的现有 LINQ 扩展方法会为您的场景增加一些`Ienumerable<T>`开销。`ToArray`问题是：它对你的场景重要吗？例如，如果您要对数据进行网络传输，那么这里的几皮秒就无关紧要了。但是如果你在一个紧密的循环中处理 xml，它可能会。

更好的解决方法是直接使用框架代码对其进行编码......我会看看我是否能找到最简单的选择......

`StringBuilder`注意：这里的另一个微优化是使用现有字符串的长度预先初始化。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-18T11:32:16.967

我会使用正则表达式来清理字符串。它看起来比正在讨论的选项要干净得多。有人可以用正则表达式运行性能测试并让我知道我做错了吗？

谢谢！

# image - 如何将平面原始磁盘映像转换为用于 virtualbox 或 vmplayer 的 vmdk？

> ID：454899
> 
> 赞同：70
> 
> 时间：2009-01-18T10:00:20.180
> 
> 标签：image, vmware, virtual-machine, virtualization, qemu

我有一些平面文件格式的旧 Linux 文件系统的旧图像。[Bochs](http://bochs.sourceforge.net/)可以使用它们，但我需要使用[Virtual Box](https://www.virtualbox.org/)来运行它们。Virtual Box 无法使用这种格式的图像，因此我需要将这些图像从平面文件转换为 .vmdk 文件格式。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-01-18T10:19:06.943

首先，安装 QEMU。在 Ubuntu 等基于 Debian 的发行版上，运行：

```
$ apt-get install qemu 
```

然后运行以下命令：

```
$ qemu-img convert -O vmdk imagefile.dd vmdkname.vmdk 
```

我假设平面磁盘映像是`dd`-style 映像。转换操作还处理许多其他格式。

有关该`qemu-img`命令的更多信息，请参阅

```
$ qemu-img -h 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2012-08-01T08:26:48.450

由于问题提到了VirtualBox，所以这个目前有效：

```
VBoxManage convertfromraw imagefile.dd vmdkname.vmdk --format VMDK 
```

不带参数运行它以获得一些有趣的细节（特别是`--variant`标志）：

```
VBoxManage convertfromraw 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-04-05T21:46:01.050

回答 TJJ：**但是是否也可以在不复制整个文件的情况下做到这一点？**所以，只是为了以某种方式创建一个额外的 vmdk-metafile，它引用原始 dd-image。

**是**的，这是可能的。以下是在 VirtualBox 中使用平面磁盘映像的方法：

首先，您以通常的方式使用 dd 创建图像：

```
dd bs=512 count=60000 if=/dev/zero of=usbdrv.img 
```

然后，您可以为 VirtualBox 创建一个引用此图像的文件：

```
VBoxManage internalcommands createrawvmdk -filename "usbdrv.vmdk" -rawdisk "usbdrv.img" 
```

您可以在 VirtualBox 中按原样使用此图像，但根据客户操作系统的不同，它可能不会立即可见。例如，我尝试在 Windows 客户操作系统上使用此方法，我必须执行以下操作才能为其提供驱动器号：

*   转到控制面板。
*   转到管理工具。
*   转到计算机管理。
*   转到左侧面板中的存储\磁盘管理。
*   您将在此处看到您的磁盘。在上面创建一个分区并格式化它。小卷使用 FAT，大卷使用 FAT32 或 NTFS。

您可能希望在 Linux 上访问您的文件。首先将其从来宾操作系统中卸载，以确保将其从虚拟机中删除。现在我们需要创建一个引用该分区的虚拟设备。

```
sfdisk -d usbdrv.img 
```

回复：

```
label: dos
label-id: 0xd367a714
device: usbdrv.img
unit: sectors

usbdrv.img1 : start=          63, size=       48132, type=4 
```

记下分区的起始位置：63。在下面的命令中，我使用了 loop4，因为在我的情况下，它是第一个可用的循环设备。

```
sudo losetup -o $((63*512)) loop4 usbdrv.img
mkdir usbdrv
sudo mount /dev/loop4 usbdrv
ls usbdrv -l 
```

回复：

```
total 0
-rwxr-xr-x. 1 root root 0 Apr  5 17:13 'Test file.txt' 
```

耶！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-07T23:22:24.203

在 Windows 上，使用[https://github.com/Zapotek/raw2vmdk](https://github.com/Zapotek/raw2vmdk)将 dd 或 winhex 创建的原始文件转换为 vmdk。raw2vmdk v0.1.3.2 有一个错误 - 创建 vmdk 文件后，编辑 vmdk 文件并修复原始文件的路径（在我的情况下，而不是 D:\Temp\flash_16gb.raw（由 winhex 创建）生成的路径是 D:Tempflash_16gb.raw)。然后，在 vmware 虚拟机 6.5-7 版本中打开它（5.1 拒绝附加 vmdk 硬盘）。哇！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-27T08:44:18.553

也许您应该尝试使用 Starwind V2V 转换器，您可以从这里获得它 - [http://www.starwindsoftware.com/converter](http://www.starwindsoftware.com/converter)。它还支持 IMG 磁盘格式，并在 IMG、VMDK 或 VHD 之间进行逐个扇区的转换，而无需对源映像进行任何更改。这个工具是免费的:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-19T09:07:50.413

krosenvold 的回答启发了以下脚本，该脚本执行以下操作：

*   通过 ssh 从远程服务器获取 dd 转储（作为 gz 文件）
*   解压缩转储
*   将其转换为 vmware

该脚本可重新启动并检查中间文件是否存在。它还使用 pv 和 qemu-img -p 来显示每个步骤的进度。

在我的环境 2 x Ubuntu 12.04 LTS 中，步骤如下：

*   3 小时获得 60 GB 分区的 47 GB 磁盘转储
*   20 分钟解压为 60 GByte dd 文件
*   45 分钟创建 vmware 文件

```
#!/bin/bash
# get a dd disk dump and convert it to vmware
#  see http://stackoverflow.com/questions/454899/how-to-convert-flat-raw-disk-image-to-vmdk-for-virtualbox-or-vmplayer
#  Author: wf  2014-10-1919

#
# get a dd dump from the given host's given disk and create a compressed
#   image at the given target 
#
#  1: host e.g. somehost.somedomain
#  2: disk e.g. sda
#  3: target e.g. image.gz
#
# http://unix.stackexchange.com/questions/132797/how-to-use-ssh-to-make-a-dd-copy-of-disk-a-from-host-b-and-save-on-disk-b
getdump() {
  local l_host="$1"
  local l_disk="$2"
  local l_target="$3"
  echo "getting disk dump of $l_disk from $l_host"
  ssh $l_host sudo fdisk -l  | egrep "^/dev/$l_disk"
  if [ $? -ne 0 ]
  then
    echo "device $l_disk does not exist on host $l_host" 1>&2
    exit 1
  else
    if [ ! -f $l_target ]
    then
      ssh $l_host "sudo dd if=/dev/$disk bs=1M | gzip -1 -" | pv | dd of=$l_target
    else
      echo "$l_target already exists"
    fi
  fi
}

#
# optionally install command from package if it is not available yet
# 1: command
# 2: package
#
opt_install() {
  l_command="$1"
  l_package="$2"
  echo "checking that $l_command from package $l_package  is installed ..."
  which $l_command
  if [ $? -ne 0 ]
  then
    echo "installing $l_package to make $l_command available ..."
    sudo apt-get install $l_package 
  fi
}

#
# convert the given image to vmware
#  1: the dd dump image
#  2: the vmware image file to convert to
#
vmware_convert() {
  local l_ddimage="$1"
  local l_vmwareimage="$2"
  echo "converting dd image $l_image to vmware $l_vmwareimage"
  #  convert to VMware disk format showing progess
  # see http://manpages.ubuntu.com/manpages/precise/man1/qemu-img.1.html
  qemu-img convert -p -O vmdk "$l_ddimage" "$l_vmwareimage"
}

#
# show usage
#
usage() {
  echo "usage: $0 host device"
  echo "      host: the host to get the disk dump from e.g. frodo.lotr.org"  
  echo "            you need ssh and sudo privileges on that host"
  echo "
  echo "    device: the disk to dump from e.g. sda"
  echo ""
  echo "  examples:
  echo "       $0 frodo.lotr.org sda"
  echo "       $0 gandalf.lotr.org sdb"
  echo ""
  echo "  the needed packages pv and qemu-utils will be installed if not available"
  echo "  you need local sudo rights for this to work"
  exit 1
}

# check arguments
if [ $# -lt 2 ]
then
  usage
fi

# get the command line parameters
host="$1"
disk="$2"

# calculate the names of the image files
ts=`date "+%Y-%m-%d"`
# prefix of all images
#   .gz the zipped dd
#   .dd the disk dump file
#   .vmware - the vmware disk file
image="${host}_${disk}_image_$ts"

echo "$0 $host/$disk ->  $image"

# first check/install necessary packages
opt_install qemu-img qemu-utils
opt_install pv pv

# check if dd files was already loaded
#  we don't want to start this tedious process twice if avoidable
if [ ! -f $image.gz ]
then
  getdump $host $disk $image.gz
else
  echo "$image.gz already downloaded"
fi

# check if the dd file was already uncompressed
# we don't want to start this tedious process twice if avoidable
if [ ! -f $image.dd ]
then
  echo "uncompressing $image.gz"
  zcat $image.gz | pv -cN zcat > $image.dd
else
  echo "image $image.dd already uncompressed"
fi
# check if the vmdk file was already converted
# we don't want to start this tedious process twice if avoidable
if [ ! -f $image.vmdk ]
then
  vmware_convert $image.dd $image.vmdk
else
  echo "vmware image $image.vmdk already converted"
fi 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-12-01T14:14:39.460

只是为您提供另一种选择，您也可以使用[https://sourceforge.net/projects/dd2vmdk/](https://sourceforge.net/projects/dd2vmdk/)。dd2vmdk 是一个基于 *nix 的程序，它允许您通过获取原始映像、分析主引导记录（物理扇区 0）并获取特定数据来挂载原始磁盘映像（由 dd、dcfldd、dc3dd、ftk 映像等创建）创建 vmdk 文件所需的信息。

就个人而言，imo Qemu 和 Zapotek 的 raw2vmdk 工具是将 dd 转换为 vmdks 的最佳整体选择。

披露：我是这个项目的作者。

# integration-testing - 为变更集寻找合适的测试

> ID：454906
> 
> 赞同：1
> 
> 时间：2009-01-18T10:10:21.250
> 
> 标签：integration-testing, code-coverage, changeset, automated-tests

我们使用[cobertura](http://cobertura.sourceforge.net/)作为代码覆盖工具。测试是使用 RFT-Rational Functional Tester 完成的（500 多个测试）。运行 RFT 需要很长时间。为了鼓励开发人员运行 RFT 测试，我们正在考虑能够列出涵盖“变更集”的测试的工具。

做法大致是：

1.  在集成服务器上运行每个 rft 测试，针对各个测试创建覆盖数据数据库（cobertura 的 .ser 文件）
2.  对于每个更改集，通过 .ser 文件查找测试
3.  再次运行测试时更新数据库。本质上，过去运行的数据库用于“猜测”当前更改集的最小测试。

首先，我们可以将更改集视为文件列表。但是，它可能是代码行更改。

任何意见？任何具有此功能的现有工具？刚刚知道 IntelliJ 8 具有此功能，用于在其中运行测试。（可能用于单元测试）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-09T04:44:37.127

当前实施的解决方案大致是（与问题相同）

1.  根据测试收集 ser 文件
2.  创建受影响的类和方法的数据库

对于给定的更改集，生成方法和类的列表。然后对照覆盖率数据库进行检查。这给出了一个近似解。

工作合理，而不是 100%。所以过滤只适用于小团队特定的更改。完整的测试套件每周在主分支上运行

# css - CSS 的浏览器检测：使用单独的 CSS 文件或内联 CSS 或...？

> ID：454907
> 
> 赞同：2
> 
> 时间：2009-01-18T10:13:05.520
> 
> 标签：css, browser-detection

我想知道哪个最适合速度：

选项 1：为每个浏览器加载单独的 CSS（通过 a 包含单独的 JS 文件`<script/>`）：

```
// for internet explorer 6 & 7
if ($.browser.msie) {
    document.write('<link rel="stylesheet" type="text/css" href="/css/styles-ie.css" />');
}

// for opera
if ($.browser.opera) {
    document.write('<link rel="stylesheet" type="text/css" href="/css/styles-opera.css" />');
} 
```

选项 2：内联 CSS（通过 a 包含的单独 JS 文件`<script/>`）：

```
// for internet explorer 6 & 7
if ($.browser.msie) {
    document.write('[some CSS styles]');
}

// for opera
if ($.browser.opera) {
    document.write('[some CSS styles]');
} 
```

选项3：或者还有其他更好的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-18T10:47:30.723

我最喜欢[条件注释](http://www.quirksmode.org/css/condcom.html)，虽然我没有真正测试它，但我希望它也是最快的选择，因为不涉及 DOM 操作。还有一篇[很棒的文章介绍了使用这种技术支持 IE 对话，但阅读有关一些](http://dev.opera.com/articles/view/supporting-ie-with-conditional-comments/)[陷阱](http://meiert.com/en/blog/20070201/why-conditional-comments-are-bad-repeat-bad/)的文章也可能会有所帮助。

根据我的经验，除了 IE 之外，没有必要对其他浏览器进行任何例外处理，但由于您的示例也列出了 Opera，我建议您使用一些 CSS hack 来对 Opera 进行（可能很小的）更改。如果你在网络上搜索 Opera 特定的 CSS，你可能会找到你喜欢的东西；）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T06:07:55.803

我使用[CSS Reset](http://developer.yahoo.com/yui/reset/)来平衡比赛场地。这通常会使所有浏览器对我应用的样式表现得相当可预测。当然，我遇到过一些情况，IE 呈现的内容与更多符合标准的浏览器不同。使用[条件注释](http://www.quirksmode.org/css/condcom.html)，我可以使用特定于 IE 的样式表来修复这些差异。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-27T05:34:08.890

您可以使用检测 IE 浏览器

*   IE 条件注释
*   CSS 规则特定
*   条件 HTML 类

这是展示所有规则的好[文章](http://techsloution4u.com/web-development/best-ways-to-detect-ie-browser.html)

# java - 用换行符分割 Java 字符串

> ID：454908
> 
> 赞同：435
> 
> 时间：2009-01-18T10:13:56.487
> 
> 标签：java, regex, split, newline

我正在尝试`JTextArea`使用正则表达式拆分字符串中的文本，`\n`但是，这不起作用，我也尝试了`\r\n|\r|n`许多其他正则表达式组合。代码：

```
public void insertUpdate(DocumentEvent e) {
    String split[], docStr = null;
    Document textAreaDoc = (Document)e.getDocument();

    try {
        docStr = textAreaDoc.getText(textAreaDoc.getStartPosition().getOffset(), textAreaDoc.getEndPosition().getOffset());
    } catch (BadLocationException e1) {
        // TODO Auto-generated catch block
        e1.printStackTrace();
    }

    split = docStr.split("\\n");
} 
```

* * *

## 回答 #1

> 赞同：825
> 
> 时间：2009-01-18T10:18:19.910

这应该涵盖您：

```
String lines[] = string.split("\\r?\\n"); 
```

您真正需要担心的只有两个换行符（UNIX 和 Windows）。

* * *

## 回答 #2

> 赞同：164
> 
> 时间：2015-06-25T20:25:29.167

[`String#split​(String regex)`](https://docs.oracle.com/javase/10/docs/api/java/lang/String.html#split(java.lang.String))方法是使用正则表达式（正则表达式）。由于 Java 8 正则表达式支持`\R`which 表示（来自[Pattern 类的文档](https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html)）：

> **换行匹配器**
> \R 任何 Unicode 换行序列，等价于 `\u000D\u000A|[\u000A\u000B\u000C\u000D\u0085\u2028\u2029]`

所以我们可以用它来匹配：

*   `\u000D\000A`->`\r\n`对
*   [\u000A](http://www.fileformat.info/info/unicode/char/000a/index.htm) -> 换行 ( `\n`)
*   [\u000B](http://www.fileformat.info/info/unicode/char/000b/index.htm) -> 行制表（不要与[字符制表`\t`混淆`\u0009`](http://www.fileformat.info/info/unicode/char/0009/index.htm)）
*   [\u000C](http://www.fileformat.info/info/unicode/char/000c/index.htm) -> 换页 ( `\f`)
*   [\u000D](http://www.fileformat.info/info/unicode/char/000d/index.htm) -> 回车 ( `\r`)
*   [\u0085](http://www.fileformat.info/info/unicode/char/0085/index.htm) -> 下一行 (NEL)
*   [\u2028](http://www.fileformat.info/info/unicode/char/2028/index.htm) -> 行分隔符
*   [\u2029](http://www.fileformat.info/info/unicode/char/2029/index.htm) -> 段落分隔符

如您所见`\r\n`，它放置在正则表达式的开头，确保正则表达式首先尝试匹配这*对*，并且只有当匹配失败时，它才会尝试匹配*单个字符*的行分隔符。

* * *

因此，如果要在行分隔符上拆分，请使用`split("\\R")`.

如果您[不想从结果数组中删除尾随空字符串`""`](https://stackoverflow.com/questions/14602062/java-string-split-removed-empty-values)，请使用`split(regex, limit)`负`limit`参数，例如`split("\\R", -1)`.

如果您想将一个或多个连续空行视为单个分隔符，请使用`split("\\R+")`.

* * *

## 回答 #3

> 赞同：139
> 
> 时间：2009-01-18T10:21:56.283

如果您不想要空行：

```
String.split("[\\r\\n]+") 
```

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2012-07-04T11:10:54.760

```
String.split(System.lineSeparator()); 
```

这应该是系统独立的

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2018-06-28T09:39:43.523

[java-11](/questions/tagged/java-11 "显示标记为“java-11”的问题")中的类`lines`引入了一个新方法，它返回`String``Stream<String>`

> 返回从该字符串中提取的子字符串流，该字符串由行终止符分区。
> 
> 可识别的换行符是换行符“\n”（U+000A）、回车符“\r”（U+000D）和回车符后紧跟换行符“\r\n”（U+000D U+000A） ）。

这里有一些例子：

```
jshell> "lorem \n ipusm \n sit".lines().forEach(System.out::println)
lorem
 ipusm
 sit

jshell> "lorem \n ipusm \r  sit".lines().forEach(System.out::println)
lorem
 ipusm
  sit

jshell> "lorem \n ipusm \r\n  sit".lines().forEach(System.out::println)
lorem
 ipusm
  sit 
```

[字符串#lines()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#lines())

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2018-11-30T23:30:25.177

在类中有一个`JDK11`方法：`String``lines()`

> 返回从该字符串中提取的行流，由行终止符分隔。

此外，[文档](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#lines())继续说：

> 行终止符是以下之一：换行符“\n”（U+000A）、回车符“\r”（U+000D）或回车后紧跟换行符“\r \n" (U+000D U+000A)。行是零个或多个字符后跟行终止符的序列，或者是一个或多个字符后跟字符串结尾的序列。行不包括行终止符。

有了这个可以简单地做到：

```
Stream<String> stream = str.lines(); 
```

那么如果你想要一个数组：

```
String[] array = str.lines().toArray(String[]::new); 
```

鉴于此方法返回一个 Stream 它为您提供了很多选项，因为它使您能够编写可能并行操作的*简洁*和声明性表达式。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2012-02-17T11:52:48.503

您不必在字符组中使用双重转义字符。

对于所有非空行，请使用：

```
String.split("[\r\n]+") 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-05-19T14:18:29.910

这里给出的所有答案实际上都不尊重 Java 对新行的定义，如 BufferedReader#readline 中给出的。Java 正在接受`\n`,`\r`并`\r\n`作为新行。一些答案匹配多个空行或格式错误的文件。例如。`<sometext>\n\r\n<someothertext>`使用时`[\r\n]+`会产生两行。

```
String lines[] = string.split("(\r\n|\r|\n)", -1); 
```

相比之下，上面的答案具有以下属性：

*   它符合 Java 对新行的定义，例如 BufferedReader 正在使用它
*   它不匹配多个新行
*   它不会删除尾随的空行

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2018-03-07T19:51:32.060

如果由于某种原因不想使用`String.split`（例如，因为[正则表达式](http://regex.info/blog/2006-09-15/247)）并且想在 Java 8 或更高版本上使用函数式编程：

```
List<String> lines = new BufferedReader(new StringReader(string))
        .lines()
        .collect(Collectors.toList()); 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-01-18T19:27:11.293

也许这会起作用：

从 split 方法的参数中删除双反斜杠：

```
split = docStr.split("\n"); 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-06-27T20:06:08.447

为了防止空行被压扁，请使用：

```
String lines[] = String.split("\\r?\\n", -1); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-06-19T16:24:08.730

由于[Pshemo](https://stackoverflow.com/a/25068483/10807406)响应在 Android 上对我有用，以上答案在 Android 上对我没有帮助。我将在这里留下一些[Pshemo 的答案](https://stackoverflow.com/a/25068483/10807406)：

```
split("\\\\n") 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-18T10:23:01.787

上面的代码实际上并没有做任何可见的事情——它只是计算然后转储计算。是您使用的代码，还是只是这个问题的一个例子？

尝试在最后做 textAreaDoc.insertString(int, String, AttributeSet) ？

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-06-06T16:30:59.123

`String lines[] =String.split( System.lineSeparator())`

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-04-11T16:23:35.680

在所有给定解决方案的基础上尝试失败后。我`\n`用一些特殊的词替换然后拆分。对我来说，以下是诀窍：

```
article = "Alice phoned\n bob.";
article = article.replace("\\n", " NEWLINE ");
String sen [] = article.split(" NEWLINE "); 
```

我无法复制问题中给出的示例。但是，我想这个逻辑可以应用。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-06-08T09:19:51.157

作为先前答案的替代方案，`Splitter`如果要将其他操作应用于结果行，例如修剪行或过滤空行，则可以使用 guava 的 API：

```
import com.google.common.base.Splitter;

Iterable<String> split = Splitter.onPattern("\r?\n").trimResults().omitEmptyStrings().split(docStr); 
```

请注意，结果是一个`Iterable`而不是一个数组。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-06-18T22:50:10.870

有三种不同的约定（可以说是*事实上的*标准）来设置和显示换行符：

*   `carriage return`+`line feed`
*   `line feed`
*   `carriage return`

在某些文本编辑器中，可以将一个替换为另一个：

![记事本++](https://i.imgur.com/PPU7jm0.png)

最简单的事情是标准化`line feed`，然后拆分。

```
final String[] lines = contents.replace("\r\n", "\n")
                               .replace("\r", "\n")
                               .split("\n", -1); 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-11-23T00:30:38.503

镇上有新男孩，因此您无需处理上述所有复杂问题。 **从 JDK 11 开始**，只需编写单行代码，它就会拆分行并返回字符串流。

```
public class MyClass {
public static void main(String args[]) {
   Stream<String> lines="foo \n bar \n baz".lines();
   //Do whatever you want to do with lines
}} 
```

一些参考资料。 [https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#lines()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/String.html#lines()) [https://www.azul.com/90-new -jdk-11 中的功能和 API/](https://www.azul.com/90-new-features-and-apis-in-jdk-11/)

我希望这对某人有帮助。快乐编码。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-08-20T15:14:50.130

遗憾的是，Java 缺乏一种既简单又有效的方法来将字符串拆分为固定字符串。两者`String::split`和流 API 都很复杂且相对较慢。此外，它们可以产生不同的结果。

`String::split`检查它的输入，然后`java.util.regex.Pattern`每次都编译（除非输入只包含一个安全的字符）。

但是，`Pattern`速度非常快，*一旦编译完成*。所以最好的解决方案是预编译模式：

```
private static final Pattern LINE_SEP_PATTERN = Pattern.compile("\\R"); 
```

然后像这样使用它：

```
String[] lines = LINE_SEP_PATTERN.split(input); 
```

从 Java 8 开始，`\R`匹配 Unicode 指定的任何换行符。在 Java 8 之前，您可以使用如下内容：

```
Pattern.compile(Pattern.quote(System.lineSeparator())) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-09-14T12:21:55.440

*   试试这个希望对你有帮助

* * *

```
 String split[], docStr = null;
Document textAreaDoc = (Document)e.getDocument();

try {
    docStr = textAreaDoc.getText(textAreaDoc.getStartPosition().getOffset(), textAreaDoc.getEndPosition().getOffset());
} catch (BadLocationException e1) {
    // TODO Auto-generated catch block
    e1.printStackTrace();
}

split = docStr.split("\n"); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2013-10-01T20:23:12.993

```
package in.javadomain;

public class JavaSplit {

    public static void main(String[] args) {
        String input = "chennai\nvellore\ncoimbatore\nbangalore\narcot";
        System.out.println("Before split:\n");
        System.out.println(input);

        String[] inputSplitNewLine = input.split("\\n");
        System.out.println("\n After split:\n");
        for(int i=0; i<inputSplitNewLine.length; i++){
            System.out.println(inputSplitNewLine[i]);
        }
    }

} 
```

# .net - 数组与列表的性能

> ID：454916
> 
> 赞同：226
> 
> 时间：2009-01-18T10:20:11.840
> 
> 标签：.net, performance, arrays, generics, list

假设您需要一个需要经常迭代的整数列表/数组，我的意思是非常频繁。原因可能会有所不同，但可以说它是大容量处理的最内部循环的核心。

一般来说，由于大小的灵活性，人们会选择使用列表（List）。最重要的是，msdn 文档声称列表在内部使用了一个数组，并且应该同样快速地执行（快速浏览一下 Reflector 就证实了这一点）。然而，这涉及到一些开销。

有人真的测量过这个吗？在列表中迭代 6M 次是否会与数组花费相同的时间？

* * *

## 回答 #1

> 赞同：250
> 
> 时间：2009-01-18T10:23:28.370

非常容易测量...

**在我知道长度是固定**的少数紧密循环处理代码中，我使用数组进行额外的微小优化；**如果**您使用索引器 / 用于表单，数组可能会**稍微**快一些 - 但 IIRC 认为这取决于数组中的数据类型。但是除非您**需要**进行微优化，否则请保持简单并使用等。****`List<T>`****

 ****当然，这只适用于读取所有数据的情况；对于基于键的查找，字典会更快。

这是我使用“int”的结果（第二个数字是校验和，以验证它们都做了相同的工作）：

**（已编辑以修复错误）**

```
List/for: 1971ms (589725196)
Array/for: 1864ms (589725196)
List/foreach: 3054ms (589725196)
Array/foreach: 1860ms (589725196) 
```

基于测试台：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
static class Program
{
    static void Main()
    {
        List<int> list = new List<int>(6000000);
        Random rand = new Random(12345);
        for (int i = 0; i < 6000000; i++)
        {
            list.Add(rand.Next(5000));
        }
        int[] arr = list.ToArray();

        int chk = 0;
        Stopwatch watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = list.Count;
            for (int i = 0; i < len; i++)
            {
                chk += list[i];
            }
        }
        watch.Stop();
        Console.WriteLine("List/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            for (int i = 0; i < arr.Length; i++)
            {
                chk += arr[i];
            }
        }
        watch.Stop();
        Console.WriteLine("Array/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in list)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("List/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in arr)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Array/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        Console.ReadLine();
    }
} 
```

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2017-03-12T21:28:45.347

## 简短的回答：

在 .Net中`List<T>`并`Array<T>`具有相同的速度/性能，因为在 .Net`List`中是 Array 的包装器。

再次：`List`是`Array`内！在 .Net`List<T>`中是`ArrayList<T>`来自其他语言的

* * *

**详细说明您需要在哪些情况下使用：**

*   数组需要使用：

    *   尽可能经常。它速度很快，并且对于相同数量的信息占用最小的 RAM 范围。
    *   如果您知道所需细胞的确切数量
    *   如果保存在数组中的数据 < 85000 b（整数数据为 85000/32 = 2656 个元素）
    *   如果需要高随机存取速度
*   清单需要使用：

    *   如果需要将单元格添加到列表末尾（经常）
    *   如果需要在列表的开头/中间添加单元格（不经常）
    *   如果保存在数组中的数据 < 85000 b（整数数据为 85000/32 = 2656 个元素）
    *   如果需要高随机存取速度
*   LinkedList 需要使用：

    *   如果需要在列表的开头/中间/结尾添加单元格（经常）

    *   如果需要仅顺序访问（向前/向后）

    *   如果您需要保存 LARGE 项目，但项目数量很少。

    *   最好不要用于大量项目，因为它会为链接使用额外的内存。

        > 如果您不确定是否需要 LinkedList - 您不需要它。

        > 只是不要使用它。

* * *

**更多细节：**

[![颜色含义](https://i.stack.imgur.com/DLYhn.png)](https://i.stack.imgur.com/DLYhn.png)

[![数组 vs 列表 vs 链表](https://i.stack.imgur.com/jiyUN.png)](https://i.stack.imgur.com/jiyUN.png)

# **更多细节：**

[https://stackoverflow.com/a/29263914/4423545](https://stackoverflow.com/a/29263914/4423545)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-01-18T10:32:29.770

我认为性能会非常相似。使用列表与数组时所涉及的开销是，恕我直言，当您将项目添加到列表时，以及当列表必须增加它在内部使用的数组的大小时，当达到数组的容量时。

假设您有一个容量为 10 的列表，那么一旦您要添加第 11 个元素，该列表将增加其容量。您可以通过将列表的容量初始化为它将容纳的项目数来降低对性能的影响。

但是，为了确定迭代 List 是否与迭代数组一样快，为什么不对其进行基准测试呢？

```
int numberOfElements = 6000000;

List<int> theList = new List<int> (numberOfElements);
int[] theArray = new int[numberOfElements];

for( int i = 0; i < numberOfElements; i++ )
{
    theList.Add (i);
    theArray[i] = i;
}

Stopwatch chrono = new Stopwatch ();

chrono.Start ();

int j;

 for( int i = 0; i < numberOfElements; i++ )
 {
     j = theList[i];
 }

 chrono.Stop ();
 Console.WriteLine (String.Format("iterating the List took {0} msec", chrono.ElapsedMilliseconds));

 chrono.Reset();

 chrono.Start();

 for( int i = 0; i < numberOfElements; i++ )
 {
     j = theArray[i];
 }

 chrono.Stop ();
 Console.WriteLine (String.Format("iterating the array took {0} msec", chrono.ElapsedMilliseconds));

 Console.ReadLine(); 
```

在我的系统上；遍历数组需要 33 毫秒；遍历列表需要 66 毫秒。

老实说，我没想到变化会这么大。所以，我把我的迭代放在一个循环中：现在，我执行了两次迭代 1000 次。结果是：

> 迭代列表耗时 67146 毫秒 迭代数组耗时 40821 毫秒

现在，变化不再那么大了，但仍然......

因此，我启动了.NET Reflector，List类的indexer的getter看起来是这样的：

```
public T get_Item(int index)
{
    if (index >= this._size)
    {
        ThrowHelper.ThrowArgumentOutOfRangeException();
    }
    return this._items[index];
} 
```

如您所见，当您使用 List 的索引器时，List 会检查您是否没有超出内部数组的范围。这种额外的检查是有代价的。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-01-21T13:11:13.390

如果您只是从任何一个中获取一个值（而不是在循环中），那么两者都进行边界检查（记住您在托管代码中）它只是列表执行了两次。请参阅后面的注释，了解为什么这可能不是什么大问题。

如果您使用自己的 for(int int i = 0; i < x.[Length/Count];i++) 那么关键区别如下：

*   大批：
    *   边界检查被移除
*   列表
    *   执行边界检查

如果您使用的是 foreach，那么主要区别如下：

*   大批：
    *   没有分配对象来管理迭代
    *   边界检查被移除
*   通过已知为 List 的变量列出。
    *   迭代管理变量是堆栈分配的
    *   执行边界检查
*   通过已知为 IList 的变量列出。
    *   迭代管理变量是堆分配的
    *   还执行边界检查列表值在 foreach 期间可能不会更改，而数组可以。

边界检查通常没什么大不了的（特别是如果你在一个具有深度管道和分支预测的 CPU 上——这几天的常态），但只有你自己的分析可以告诉你这是否是一个问题。如果您在避免堆分配的部分代码中（很好的例子是库或哈希码实现），那么确保将变量键入为 List 而不是 IList 将避免这种陷阱。与往常一样，如果重要的话。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-23T08:31:21.877

[*另见[这个问题](https://stackoverflow.com/questions/472191/c-for-vs-foreach)*]

我已经修改了 Marc 的答案以使用实际的随机数，并且在所有情况下实际上都做了同样的工作。

结果：

```
         对于 foreach
数组：1575ms 1575ms (+0%)
列表：1630ms 2627ms (+61%)
         (+3%) (+67%)

（校验和：-1000038876）

```

在 VS 2008 SP1 下编译为 Release。在 Q6600@2.40GHz、.NET 3.5 SP1 上运行而无需调试。

代码：

```
class Program
{
    static void Main(string[] args)
    {
        List<int> list = new List<int>(6000000);
        Random rand = new Random(1);
        for (int i = 0; i < 6000000; i++)
        {
            list.Add(rand.Next());
        }
        int[] arr = list.ToArray();

        int chk = 0;
        Stopwatch watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = list.Count;
            for (int i = 0; i < len; i++)
            {
                chk += list[i];
            }
        }
        watch.Stop();
        Console.WriteLine("List/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = arr.Length;
            for (int i = 0; i < len; i++)
            {
                chk += arr[i];
            }
        }
        watch.Stop();
        Console.WriteLine("Array/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in list)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("List/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in arr)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Array/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);
        Console.WriteLine();

        Console.ReadLine();
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-16T11:00:21.780

我担心其他答案中发布的基准仍然会给编译器留下优化、消除或合并循环的空间，所以我写了一个：

*   使用不可预测的输入（随机）
*   运行计算结果并打印到控制台
*   每次重复修改输入数据

结果是直接数组的性能比访问包装在 IList 中的数组的性能高 250%：

*   10 亿次阵列访问：4000 毫秒
*   10 亿个列表访问：10000 毫秒
*   1 亿次数组访问：350 毫秒
*   1亿列表访问：1000毫秒

这是代码：

```
static void Main(string[] args) {
  const int TestPointCount = 1000000;
  const int RepetitionCount = 1000;

  Stopwatch arrayTimer = new Stopwatch();
  Stopwatch listTimer = new Stopwatch();

  Point2[] points = new Point2[TestPointCount];
  var random = new Random();
  for (int index = 0; index < TestPointCount; ++index) {
    points[index].X = random.NextDouble();
    points[index].Y = random.NextDouble();
  }

  for (int repetition = 0; repetition <= RepetitionCount; ++repetition) {
    if (repetition > 0) { // first repetition is for cache warmup
      arrayTimer.Start();
    }
    doWorkOnArray(points);
    if (repetition > 0) { // first repetition is for cache warmup
      arrayTimer.Stop();
    }

    if (repetition > 0) { // first repetition is for cache warmup
      listTimer.Start();
    }
    doWorkOnList(points);
    if (repetition > 0) { // first repetition is for cache warmup
      listTimer.Stop();
    }
  }

  Console.WriteLine("Ignore this: " + points[0].X + points[0].Y);
  Console.WriteLine(
    string.Format(
      "{0} accesses on array took {1} ms",
      RepetitionCount * TestPointCount, arrayTimer.ElapsedMilliseconds
    )
  );
  Console.WriteLine(
    string.Format(
      "{0} accesses on list took {1} ms",
      RepetitionCount * TestPointCount, listTimer.ElapsedMilliseconds
    )
  );

}

private static void doWorkOnArray(Point2[] points) {
  var random = new Random();

  int pointCount = points.Length;

  Point2 accumulated = Point2.Zero;
  for (int index = 0; index < pointCount; ++index) {
    accumulated.X += points[index].X;
    accumulated.Y += points[index].Y;
  }

  accumulated /= pointCount;

  // make use of the result somewhere so the optimizer can't eliminate the loop
  // also modify the input collection so the optimizer can merge the repetition loop
  points[random.Next(0, pointCount)] = accumulated;
}

private static void doWorkOnList(IList<Point2> points) {
  var random = new Random();

  int pointCount = points.Count;

  Point2 accumulated = Point2.Zero;
  for (int index = 0; index < pointCount; ++index) {
    accumulated.X += points[index].X;
    accumulated.Y += points[index].Y;
  }

  accumulated /= pointCount;

  // make use of the result somewhere so the optimizer can't eliminate the loop
  // also modify the input collection so the optimizer can merge the repetition loop
  points[random.Next(0, pointCount)] = accumulated;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-18T11:41:20.553

测量结果很好，但你会得到明显不同的结果，具体取决于你在内部循环中所做的事情。衡量自己的情况。如果您使用的是多线程，那么仅此一项就很重要了。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-18T11:45:47.750

实际上，如果您在循环中执行一些复杂的计算，那么数组索引器与列表索引器的性能可能会非常小，最终，这并不重要。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-12-24T12:56:38.537

不要试图通过增加元素数量来增加容量。

**表现**

```
List For Add: 1ms
Array For Add: 2397ms 
```

* * *

```
 Stopwatch watch;
        #region --> List For Add <--

        List<int> intList = new List<int>();
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 60000; rpt++)
        {
            intList.Add(rand.Next());
        }
        watch.Stop();
        Console.WriteLine("List For Add: {0}ms", watch.ElapsedMilliseconds);
        #endregion

        #region --> Array For Add <--

        int[] intArray = new int[0];
        watch = Stopwatch.StartNew();
        int sira = 0;
        for (int rpt = 0; rpt < 60000; rpt++)
        {
            sira += 1;
            Array.Resize(ref intArray, intArray.Length + 1);
            intArray[rpt] = rand.Next();

        }
        watch.Stop();
        Console.WriteLine("Array For Add: {0}ms", watch.ElapsedMilliseconds);

        #endregion 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-01-29T20:34:31.350

这是使用字典 IEnumerable 的一个：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;

static class Program
{
    static void Main()
    {
        List<int> list = new List<int>(6000000);

        for (int i = 0; i < 6000000; i++)
        {
                list.Add(i);
        }
        Console.WriteLine("Count: {0}", list.Count);

        int[] arr = list.ToArray();
        IEnumerable<int> Ienumerable = list.ToArray();
        Dictionary<int, bool> dict = list.ToDictionary(x => x, y => true);

        int chk = 0;
        Stopwatch watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = list.Count;
            for (int i = 0; i < len; i++)
            {
                chk += list[i];
            }
        }
        watch.Stop();
        Console.WriteLine("List/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            for (int i = 0; i < arr.Length; i++)
            {
                chk += arr[i];
            }
        }
        watch.Stop();
        Console.WriteLine("Array/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in Ienumerable)
            {
                chk += i;
            }
        }

        Console.WriteLine("Ienumerable/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in dict.Keys)
            {
                chk += i;
            }
        }

        Console.WriteLine("Dict/for: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in list)
            {
                chk += i;
            }
        }

        watch.Stop();
        Console.WriteLine("List/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in arr)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Array/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in Ienumerable)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Ienumerable/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in dict.Keys)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Dict/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        Console.ReadLine();
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-04-11T10:10:41.443

在一些简短的测试中，我发现两者的组合在我称之为合理密集的数学中更好：

类型：`List<double[]>`

> 时间：00:00:05.1861300

类型：`List<List<double>>`

> 时间：00:00:05.7941351

类型：`double[rows * columns]`

> 时间：00:00:06.0547118

运行代码：

```
int rows = 10000;
int columns = 10000;

IMatrix Matrix = new IMatrix(rows, columns);

Stopwatch stopwatch = new Stopwatch();
stopwatch.Start();

for (int r = 0; r < Matrix.Rows; r++)
    for (int c = 0; c < Matrix.Columns; c++)
        Matrix[r, c] = Math.E;

for (int r = 0; r < Matrix.Rows; r++)
    for (int c = 0; c < Matrix.Columns; c++)
        Matrix[r, c] *= -Math.Log(Math.E);

stopwatch.Stop();
TimeSpan ts = stopwatch.Elapsed;

Console.WriteLine(ts.ToString()); 
```

我真希望我们有一些一流的硬件加速矩阵类，比如 .NET 团队已经完成了这个`System.Numerics.Vectors`类！

C# 可能是最好的 ML 语言，在这方面还有更多的工作！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-18T11:28:40.267

由于 List<> 内部使用数组，所以基本性能应该是一样的。两个原因，为什么 List 可能会稍微慢一些：

*   要在列表中查找元素，调用 List 的一个方法，该方法在底层数组中进行查找。所以你需要一个额外的方法调用。另一方面，编译器可能会认识到这一点并优化“不必要的”调用。
*   如果编译器知道数组的大小，它可能会做一些特殊的优化，而对于未知长度的列表它是做不到的。如果列表中只有几个元素，这可能会带来一些性能改进。

要检查它是否对您有任何影响，最好将发布的计时功能调整为您计划使用的大小列表，并查看您的特殊情况的结果如何。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-03-05T15:04:02.583

由于我有一个类似的问题，这让我快速入门。

我的问题更具体一点，“自反数组实现的最快方法是什么”

Marc Gravell 所做的测试显示了很多，但并不完全是访问时间。他的时间安排还包括遍历数组和列表。因为我还想出了我想测试的第三种方法，一个“字典”，只是为了比较，我扩展了 hist 测试代码。

首先，我使用常量进行测试，这给了我一定的时间，包括循环。这是一个“裸露的”时间，不包括实际访问。然后我通过访问主题结构进行测试，这给了我和“包括开销”的时间、循环和实际访问。

“裸”时间和“间接费用”时间之间的差异让我了解了“结构访问”时间。

但是这个时间有多准确呢？在测试期间，windows 会为舒尔做一些时间切片。我没有关于时间片的信息，但我认为它在测试期间均匀分布，大约为几十毫秒，这意味着时间的准确性应该在 +/- 100 毫秒左右。有点粗略的估计？无论如何，系统测量误差的来源。

此外，测试是在“调试”模式下完成的，没有进行优化。否则编译器可能会改变实际的测试代码。

所以，我得到两个结果，一个是常数，标记为“（c）”，另一个是访问标记为“（n）”，差异“dt”告诉我实际访问需要多长时间。

这是结果：

```
 Dictionary(c)/for: 1205ms (600000000)
          Dictionary(n)/for: 8046ms (589725196)
 dt = 6841

                List(c)/for: 1186ms (1189725196)
                List(n)/for: 2475ms (1779450392)
 dt = 1289

               Array(c)/for: 1019ms (600000000)
               Array(n)/for: 1266ms (589725196)
 dt = 247

 Dictionary[key](c)/foreach: 2738ms (600000000)
 Dictionary[key](n)/foreach: 10017ms (589725196)
 dt = 7279

            List(c)/foreach: 2480ms (600000000)
            List(n)/foreach: 2658ms (589725196)
 dt = 178

           Array(c)/foreach: 1300ms (600000000)
           Array(n)/foreach: 1592ms (589725196)
 dt = 292

 dt +/-.1 sec   for    foreach
 Dictionary     6.8       7.3
 List           1.3       0.2
 Array          0.2       0.3

 Same test, different system:
 dt +/- .1 sec  for    foreach
 Dictionary     14.4   12.0
       List      1.7    0.1
      Array      0.5    0.7 
```

随着对时序误差的更好估计（如何消除由于时间切片引起的系统测量误差？），可以对结果进行更多说明。

看起来 List/foreach 的访问速度最快，但开销正在扼杀它。

List/for 和 List/foreach 之间的区别是 stange。也许涉及一些兑现？

此外，对于访问数组，使用`for`循环还是`foreach`循环都没有关系。计时结果及其准确性使结果“具有可比性”。

到目前为止，使用字典是最慢的，我只考虑它是因为在左侧（索引器）我有一个稀疏的整数列表，而不是这个测试中使用的范围。

这是修改后的测试代码。

```
Dictionary<int, int> dict = new Dictionary<int, int>(6000000);
List<int> list = new List<int>(6000000);
Random rand = new Random(12345);
for (int i = 0; i < 6000000; i++)
{
    int n = rand.Next(5000);
    dict.Add(i, n);
    list.Add(n);
}
int[] arr = list.ToArray();

int chk = 0;
Stopwatch watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    int len = dict.Count;
    for (int i = 0; i < len; i++)
    {
        chk += 1; // dict[i];
    }
}
watch.Stop();
long c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("         Dictionary(c)/for: {0}ms ({1})", c_dt, chk);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    int len = dict.Count;
    for (int i = 0; i < len; i++)
    {
        chk += dict[i];
    }
}
watch.Stop();
long n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("         Dictionary(n)/for: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt);

watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    int len = list.Count;
    for (int i = 0; i < len; i++)
    {
        chk += 1; // list[i];
    }
}
watch.Stop();
c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("               List(c)/for: {0}ms ({1})", c_dt, chk);

watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    int len = list.Count;
    for (int i = 0; i < len; i++)
    {
        chk += list[i];
    }
}
watch.Stop();
n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("               List(n)/for: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    for (int i = 0; i < arr.Length; i++)
    {
        chk += 1; // arr[i];
    }
}
watch.Stop();
c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("              Array(c)/for: {0}ms ({1})", c_dt, chk);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    for (int i = 0; i < arr.Length; i++)
    {
        chk += arr[i];
    }
}
watch.Stop();
n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("Array(n)/for: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in dict.Keys)
    {
        chk += 1; // dict[i]; ;
    }
}
watch.Stop();
c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("Dictionary[key](c)/foreach: {0}ms ({1})", c_dt, chk);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in dict.Keys)
    {
        chk += dict[i]; ;
    }
}
watch.Stop();
n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("Dictionary[key](n)/foreach: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in list)
    {
        chk += 1; // i;
    }
}
watch.Stop();
c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("           List(c)/foreach: {0}ms ({1})", c_dt, chk);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in list)
    {
        chk += i;
    }
}
watch.Stop();
n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("           List(n)/foreach: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in arr)
    {
        chk += 1; // i;
    }
}
watch.Stop();
c_dt = watch.ElapsedMilliseconds;
Console.WriteLine("          Array(c)/foreach: {0}ms ({1})", c_dt, chk);

chk = 0;
watch = Stopwatch.StartNew();
for (int rpt = 0; rpt < 100; rpt++)
{
    foreach (int i in arr)
    {
        chk += i;
    }
}
watch.Stop();
n_dt = watch.ElapsedMilliseconds;
Console.WriteLine("Array(n)/foreach: {0}ms ({1})", n_dt, chk);
Console.WriteLine("dt = {0}", n_dt - c_dt); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-11-28T21:27:21.497

我有两个澄清要添加到@Marc Gravell 答案中。

测试是在 x64 版本的 .NET 6 中完成的。

测试代码在最后。

## 数组和列表未以相同方式测试

要在相同条件下测试数组和列表，也应该修改“for”。

```
for (int i = 0; i < arr.Length; i++) 
```

新版本 ：

```
int len = arr.Length;
for (int i = 0; i < len; i++) 
```

## 瓶颈列表/foreach：

可以修复 List（List/foreach 测试）的瓶颈。

将其更改为：

```
list.ForEach(x => chk += x); 
```

在配备 Core i7-10510U 的 Windows 10 pro 21H1 x64 笔记本电脑上测试运行

```
List/for Count out: 1495ms (589725196)
List/for Count in: 1706ms (589725196)
Array/for Count out: 945ms (589725196)
Array/for Count in: 1072ms (589725196)
List/foreach: 2114ms (589725196)
List/foreach fixed: 1210ms (589725196)
Array/foreach: 1179ms (589725196) 
```

## 结果解读

`Array/for`比原始测试更快。（少 12%）

`List/foreach fixed`比 快`List/for`。

`List/foreach fixed`接近`Array/foreach`。

我已经多次运行这个测试。结果会发生变化，但数量级保持不变。

这个测试的这些结果表明，你确实必须对性能有很大的需求才能被迫使用 Array。

根据用于操作 List 的方法，性能可以除以 2。

这个测试是部分的。没有随机访问、直接访问、写访问测试等。

我是不是弄错了某些部分，或者您有其他提高性能的想法吗？

## 测试代码：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
static class Program
{
    static void Main()
    {        List<int> list = new List<int>(6000000);
        Random rand = new Random(12345);
        for (int i = 0; i < 6000000; i++)
        {
            list.Add(rand.Next(5000));
        }
        int[] arr = list.ToArray();

        int chk = 0;
        Stopwatch watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = list.Count;
            for (int i = 0; i < len; i++)
            {
                chk += list[i];
            }
        }
        watch.Stop();
        Console.WriteLine("List/for Count out: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        Stopwatch watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            for (int i = 0; i < list.Count; i++)
            {
                chk += list[i];
            }
        }
        watch.Stop();
        Console.WriteLine("List/for Count in: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            int len = arr.Length;
            for (int i = 0; i < len; i++)
            {
                chk += arr[i];
            }
        }
        watch.Stop();
        Console.WriteLine("Array/for Count out: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            for (int i = 0; i < arr.Length; i++)
            {
                chk += arr[i];
            }
        }
        watch.Stop();
        Console.WriteLine("Array/for Count in: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in list)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("List/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            list.ForEach(i => chk += i);
        }
        watch.Stop();
        Console.WriteLine("List/foreach fixed: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        chk = 0;
        watch = Stopwatch.StartNew();
        for (int rpt = 0; rpt < 100; rpt++)
        {
            foreach (int i in arr)
            {
                chk += i;
            }
        }
        watch.Stop();
        Console.WriteLine("Array/foreach: {0}ms ({1})", watch.ElapsedMilliseconds, chk);

        Console.ReadLine();
    }
} 
```

# java - Java中“int[] myArray”和“int myArray[]”的区别

> ID：454921
> 
> 赞同：0
> 
> 时间：2009-01-18T10:22:52.177
> 
> 标签：java, arrays

> **可能重复：**
> [int[] 数组和 int 数组 [] 之间的区别](https://stackoverflow.com/questions/129178/difference-between-int-array-and-int-array)

我一直想知道以下是否有区别：

```
int[] myArray; 
```

和，

```
int myArray[]; 
```

# c++ - 在 Python 和 C++ 之间共享大量数据的最有效方法是什么

> ID：454931
> 
> 赞同：2
> 
> 时间：2009-01-18T10:30:46.747
> 
> 标签：c++, python, optimization

我正在编写一个允许在 C++ 应用程序中执行 python 脚本的系统。

python 脚本用于修改数据数组中的值（通常为 2048x2048x4 浮点数组）

我目前正在使用使用数组 API 创建并使用 Python 注册的 numpy 数组。

在 python 脚本中，我正在访问数组，例如

```
for all x in range(0,Width):
    for all y in range(0,Height)
        Array[x][y][0] = blah
        Array[x][y][1] = blah
        Array[x][y][2] = blah
        Array[x][y][3] = blah 
```

这似乎很慢。有没有更快的方法来设置它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T11:43:28.100

您可能想看看[Boost.Python](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/index.html)。它专注于使 C++ 代码在 Python 中可用，但它还提供了[exec 和 eval 函数](http://www.boost.org/doc/libs/1_37_0/libs/python/doc/v2/exec.html)，这些函数应该允许您有效地与 Python 代码交互。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T13:42:24.843

我想我会建议 numpy，但你已经在使用它了。恐怕这会使特定领域的更改做更少的工作。正如 John Montgomery 所提到的，您需要弄清楚 Python 代码中花费的时间，并确定是否可以避免其中的一些。

用 Python 完成的工作是否有模式？也许您可以提供可以从 Python 代码调用的特定于域的辅助函数（用 C 编写）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T11:29:14.650

您可能应该看看是否可以在一个步骤中而不是在四个（或更多）步骤中设置数组中的多个值。

我相信省略号语法在这里可能有用：

[如何在 Python 中使用省略号切片语法？](https://stackoverflow.com/questions/118370/how-do-you-use-the-ellipsis-slicing-syntax-in-python)

或者类似的东西：

`Array[x,y,:]=blah`

或者

`Array[x,y,:]=blah1,blah2,blah3,blah4`

如果每个元素都有不同的值。

这是假设您的代码中的瓶颈是由于您正在执行的分配数量。可能值得进行一些分析以确切了解什么是缓慢的。尝试相同的代码，但不实际存储结果以查看它是否更快。如果不是，那么它可能不是缓慢的任务......

# user-interface - 裸对象模式（和 UI 自动生成）的未来

> ID：454937
> 
> 赞同：15
> 
> 时间：2009-01-18T10:34:05.290
> 
> 标签：user-interface, metaprogramming

我问的是[模式](http://en.wikipedia.org/wiki/Naked_objects)，而不是[框架](http://nakedobjects.org)。[这是关于UI 自动生成](https://stackoverflow.com/questions/445899/is-there-a-library-that-generates-uis-based-on-metadata-declarations-like-this)的问题的一种后续。

1.  你相信从元数据自动生成 UI 的概念吗？

2.  这种方式可以解决什么样的问题？

当我创建了一个[小型库](http://cliche.sourceforge.net)来支持我的学生项目时，问题就出现了，它根据对象的元数据在运行时生成交互式 CLI。而且我认为它生成的 CLI 相当不错。

另一个极端是[Naked Objects Framework](http://nakedobjects.org)，它相当通用，但它生成的 UI 很糟糕，IMO。

很明显，每个问题都是特定的并且需要特定的 UI，但也许有几类问题可以接受自动生成？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-18T11:14:04.960

是的，我相信基于元数据的自动生成应用程序的概念非常合理——主要是因为它通过减少在数据库中表示每个域数据字段的大多数应用程序中的大量冗余，大大减少了开发时间并提高了代码质量，在模型中，在 UI 中，并且经常在各种映射层中多次。

我认为未来是自动生成的应用程序，可以在必要时进行修改。目前，这是 AFAIK 不太可能；例如，Rails 仅允许您在使用静态脚手架时完全自定义 UI，这基本上意味着代码生成，即领域模型中的许多进一步更改不会自动在 UI 中表示，因为在生成代码时发生了重复.

我相信第一个能够将完全自动生成与之后的完全可修改性结合起来的框架将成为事实上的开发标准，达到以前未知的程度。虽然我们很可能会以小步骤到达那里，这样就不会有这样一个单一的主导框架。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-18T11:52:17.690

看一下 JMatter，它是一个更好看的 Naked Objects 实现。

[http://www.jmatter.org](http://www.jmatter.org)

还有 Chris Muller 在 MAUI 上的工作，以及 Lukas Renggli 在 Magritte 上的工作（都是 Squeak /Smalltalk）

我们在应用程序的配置部分有很多生成的 UI。所有那些永远存在并被系统管理员更改一次的列表。

我发现从 OO 和 NO 的角度来看，大多数具有数据库后端的应用程序的设计往往很糟糕，正如 Pawson 和 Matthews 的 NO 一书所示。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-19T23:17:13.370

Re: qn #1 ... 你相信从元数据自动生成 UI 的概念吗？...我肯定会对你的第一个问题回答“是”，作为裸对象 (Java) 框架的提交者之一，并写一本关于 DDD + NO 的书。

问题提到了元数据。我认为这是 NO 能够成功的关键。在最新版本（将在 2 月进行测试版）中，元模型已经开放，因此它非常可扩展，这样您就可以按照自己的编程约定/注释编写域模型，或者可能让更复杂的查看器可以寻找自己的元数据以提供更复杂的视图。（例如，考虑如果一个对象实现了一个 Location 接口，那么它就会显示在谷歌地图中）。

关于 qn #2 ...可以通过这种方式解决什么样的问题...我们一直说 NO 更适合“主权应用程序”（组织内部使用的事务性、操作系统）到“瞬态应用程序” ”（比如机场信息亭）。NO GUI 确实要求用户熟悉域，否则他们将不知道他们在看什么。

当然，还缺少成熟的观众。你对 NO GUI 的看法是对的，它绝对是低保真度（尽管 .NET 版本是一个很大的改进，请参阅最近的 infoq.com 文章）。在 Java 方面，有一个名为 simpi.org 的姊妹项目，尽管它有很多希望......它免费提供基本的 Web GUI，但允许您根据需要和增量手工制作网页。我也在开发一个类似的 Eclipse RCP GUI。

不过要补充的另一件事是，即使您选择编写自定义 GUI 和/或表示层，NO 方法也有价值（我相信）。也就是说，您可以将其用作构建非常稳固的 pojo 域层的设计工具，然后根据需要对其进行蒙皮。问题是 NO 最初从未以这些术语出售，因此大多数人会将 NO 模式视为全有或全无的事情。

担

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-18T10:51:17.407

看待这个问题的一种方法是考虑从 Toad 或 MySQL 浏览器之类的用户界面中获得的用户界面之间的区别，其中用户界面是直接从表及其关联的元数据构建的，而熟练的设计师会使用的用户界面为实际应用而开发。如果没有太大的不同，那么对于自动生成框架来说，它应该是相当容易实现的目标。

正如您所说，有些问题可以很好地与这种自动生成一起工作，而有些则不能。在我看来，关键是您在用户界面中公开的实现模型（或其部分）与用户概念模型的映射程度。其次，应用程序的行为可以如何通过一组有限的用户界面组件来表达（假设这是一个通用的 UI 生成框架）。

这篇文章“[用户界面的通用模型](http://www.baxleydesign.com/pdfs/dux03_baxleyUIModel.pdf)”可能会引起您的兴趣。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-18T16:46:12.117

我认为自动生成 UI 的想法有很大的潜力，特别是对于您的普通表单和表格布局数据库用户界面。然而，即使有一个人也需要在循环中，有能力覆盖输出而不会被下一次再生覆盖。

我怀疑如果交互设计师更多地参与到生成算法的开发中，自动生成的 UI 在今天会更加成功。我的印象是，从历史上看，这些系统的创建者不知道要包含哪些与 UI 相关的元数据或如何使用它。为字段指定标签、值范围、格式和顺序是一个开始，但需要更多高级信息。尤其是缺乏对任务和用户角色的充分建模，以及一些基本的 UI 样式指南级原则。

例如，Oracle 的 Designer 2000 在模型中不仅包括实体和关系，而且还包括功能层次结构形式的任务，因此走上了正确的道路。然后他们通过误用此元数据（例如，假设深度总是比广度更受欢迎）并在生成 UI 时包含基本缺陷（例如，一次只能打开一个主窗口）来搞砸它。结果是 IU 甚至不符合 Oracle 自己的应用程序用户界面标准。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-30T23:53:02.057

我见过几个使用“裸对象”方法（不是框架，AFAIK）的失败项目（我被聘为一个相当昂贵的顾问来帮助构建替代品的案例）——所有这些项目都使用简单粗暴的 UI，并且工作正常在一个项目中替换了许多 UI，该项目在其最初的化身中具有类似的方法（整个应用程序是通过上下文菜单和属性表访问的对象树 - 这是大约 1998 年的 NetBeans 2.0 - IDE 作为一个巨大的分层 JavaBean ）。

底线是，你的用户并不关心你的架构，他们关心的是在你能想出的最容易理解的交互集合中完成他们需要做的事情。如果这恰好与您的架构相一致，那么您将度过幸运的一天——但这确实是偶然的。试图*强迫*用户关心（甚至知道）你的架构是没有人愿意使用的软件的秘诀。

代码通常需要围绕两个不总是兼容的目标进行设计：

1.  可维护性——不写代码的人也能看懂代码
2.  稳定性和性能——即代码要求计算机物理执行的活动都是可能的，并且可以在合理的时间范围内完成

为满足这两个目标而创建的抽象和代码结构非常非常罕见地映射到任何类型的用户界面元素。有时，如果您的听众是技术人员，您几乎可以侥幸逃脱。但即使在那里，您也可能会在对程序员和机器有意义的架构之上至少使用“表示层”适配器层来取悦更多用户。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-06-22T08:39:04.740

**快速**建立一个基本的用户界面，让客户试用系统并**创建测试数据**必须是有价值的。Naked Objects 框架可以帮助“<strong>bootstrapping”，即使您必须在发布之前将其替换为“手工制作”的 UI。

在我工作过的大多数系统中，都有很多简单的**家务表**。所有这些表格都需要一个 UI 来编辑和查看它们等。这些简单的编辑器保持一致也很有价值。在这里，一个裸对象框架可以节省大量时间，即使主要的“日常”UI 是“手工制作”的</p>

# php - 保护 adobe air 应用程序

> ID：454940
> 
> 赞同：7
> 
> 时间：2009-01-18T10:36:18.280
> 
> 标签：php, mysql, air, license-key

我即将向客户交付一个 Adob​​e AIR 应用程序。但这是我的第一次交付，即我没有任何许可等经验。

此应用程序的用户可能在线也可能不在线，因此不能指望这一点。事实上，99% 的人确定他们会离线。

我也不指望他们非常精通技术，他们会花足够的时间寻找“破解”它的方法。

那么，有没有一种很好的方式来保护这个应用程序。也就是说，我不希望人们简单地复制安装文件夹，将其带到另一台机器上并运行它。它应该比这稍微难一些。

哦，我也在使用 PHP 和 MySql，这个 AIR 应用程序与之通信。因此，非常欢迎你们可以帮助我的任何事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T20:12:20.903

保护 php api 而不是前端应用程序。有一个绑定到 IP 地址的许可证密钥，并验证来自正确 IP 的请求（包含密钥）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-25T07:02:02.570

如果您想保护您的 Flex 应用程序，您可以使用[irrObfuscator](http://www.ambiera.com/irrfuscator/index.html)。有 30 天的免费演示。

如果您想混淆您的 PHP 代码，我建议您[使用 ioncube](http://www.ioncube.com/)。有一个在线混淆器，您可以按点菜付费。很有用。你需要 ioncube 加载器，它是一组 PHP 扩展，你可以在产品部分找到。不确定，但我认为您可以在不使用 PHP 配置的情况下安装加载程序，因此它对共享主机友好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-25T07:35:27.183

当应用程序安装时，我会执行以下操作：

1.  在“app-storage”中创建一个基本上表明该应用程序已安装的文件。
2.  拨打服务电话并记录安装
3.  更改应用程序目录中的文件以指示该应用程序已安装

在后续启动时，只要 app 目录中的文件指示该应用已安装，请检查该文件是否存在。如果您看到客户一遍又一遍地安装他们的应用程序，这可能会在他们的帐户中被标记并采取适当的措施。如果您想花点心思，“app-storage”中的文件可以是来自应用程序目录中的文件（安装日期？）的一些信息的单向哈希，以及一些烘焙到 AIR 应用程序中的值。

总的来说，我认为这里的关键是信任你的用户，而不是假设他们试图窃取。你想让系统尽可能的轻松。当您将客户视为罪犯时，它不会与客户建立良好的关系，因此创建“铁定”方法可能甚至不是最好的主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T13:29:54.950

我认为几乎唯一的好方法是在安装后要求激活（在线激活，使用手机备份）。

根据您的说法，后端似乎是现场安装的，无法提供足够的复制保护。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-18T14:34:10.760

你不能保护任何基于 web 或 javascript 的东西，纯粹是因为有完整的源代码。

任何知道如何使用“右键单击”的人都可以复制您的文件。你可以混淆你的代码，但你不能保护它。如果您认为这是不可能的，请使用“真正的”编程语言编写桌面应用程序。

# sqlite - 取消删除Sqlite3中意外删除的记录

> ID：454942
> 
> 赞同：8
> 
> 时间：2009-01-18T10:37:39.637
> 
> 标签：sqlite

作为标题，可能吗？由于我在 FireFox 中丑陋的 html 界面，我不小心删除了另一条记录。不好的是这个记录删除是程序自动级联删除所有内容的根文件夹:(

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2017-07-01T20:15:20.313

看看[黑暗](http://www.pldaniels.com/undark/)。我已经用过了。如果记录没有被覆盖，它可以从 SQLite db 文件中导出行（删除或不删除）。最后一个版本[在这里](https://github.com/witwall/undark)。

[SQLite-Deleted-Records-Parser](https://github.com/mdegrazia/SQLite-Deleted-Records-Parser)不提供相同类型的输出，但可能很有用。

还有一些产品，如[SQLite Forensic Explorer](http://www.sqliteviewer.org/)、[SQLite Repair](https://www.stellarinfo.com/sqlite-repair.php)、[Sqlite Database Recovery](https://www.systoolsgroup.com/sqlite-database-recovery.html)和[SQLiteDoctor](http://www.sqlabs.com/sqlitedoctor.php)。

如果您是开发人员，您可以使用[litereplica](http://litereplica.io)避免再次遇到同样的问题。它将单主复制添加到 SQLite。

但是请记住启用时间点恢复，因为当事务被复制到副本时，一个意外命令`DROP TABLE`也会`DELETE FROM`被复制。使用 PITR，您将能够转到之前的时间点。

或者定期使用[备份 API 。](http://www.sqlite.org/backup.html)尽管它会在每个备份上传输整个数据库。

请记住：如果您在事务处于活动状态时复制 SQLite 文件或使用常规备份方法，则副本可能会[损坏](http://www.sqlite.org/howtocorrupt.html#_backup_or_restore_while_a_transaction_is_active)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T15:38:29.647

对不起——不。备份是我所知道的唯一选择。

将来，请考虑永远不要发出 DELETE 查询，尤其是从用户可访问的表单（如果有人的话，只让数据库管理员这样做）——只需在表中包含一个将记录标记为非活动的字段，然后将其考虑到您的WHERE 子句中的查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-23T22:54:25.333

有可能通过十六进制编辑器进入并查看数据。我能找到的唯一信息是元数据已经消失，因此记录不会回来，但数据本身可能仍然存在。这与数据的重要性有很大关系，我怀疑它还不够重要，您可以挖出一个十六进制编辑器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T14:41:58.497

不幸的是，我也不知道有什么办法。但是，在您对 SQLite 数据库文件执行 VACUUM 之前，通常不会从技术上删除已删除的数据。也许您仍然可以使用文件上的某种十六进制编辑器来恢复一些数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-01T11:35:43.557

数据并不总是立即从文件中删除。如果它有很多并且你很绝望，你可以`strings`在文件上使用 UNIX 命令。这可能会帮助您恢复人类可读数据的各种点点滴滴，但这将是一个艰难且不准确的过程。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-18T12:24:49.997

没门。如果没有有效的备份，您将无法恢复它。

# python - 关于 Python/Django 和消息队列的建议

> ID：454944
> 
> 赞同：44
> 
> 时间：2009-01-18T10:42:53.680
> 
> 标签：python, django, message-queue

我在 Django 中有一个应用程序，需要在各种用例中向用户发送大量电子邮件。出于显而易见的原因，我不想在应用程序中同步处理这个问题。

有没有人对与 Python 很好集成的消息队列服务器有任何建议，或者他们已经在 Django 项目中使用过？我的堆栈的其余部分是 Apache、mod_python、MySQL。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-19T05:16:07.623

在您的特定情况下，它只是一个电子邮件队列，我会采取简单的方法并使用[django-mailer](https://github.com/pinax/django-mailer)。作为一个不错的好处，还有其他可插入的项目足够聪明，可以在他们在堆栈中看到 django-mailer 时利用它。

至于更通用的队列解决方案，我还没有尝试过其中的任何一个，但这里列出了一些对我来说更有趣的解决方案：

1.  [pybeanstalk/beanstalkd](https://github.com/beanstalkd/pybeanstalk)
2.  [与 gearman 的 python 接口（现在随着](https://pythonhosted.org/gearman/)[gearman 的 C 版本](http://www.gearmanproject.org/doku.php)的发布可能更有趣）
3.  [内存缓存Q](http://memcachedb.org/memcacheq/)
4.  [跺脚](http://morethanseven.net/2008/09/14/using-python-and-stompserver-get-started-message-q/)
5.  [芹菜](http://docs.celeryproject.org/en/latest/getting-started/introduction.html)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-18T11:54:03.913

到目前为止，我还没有找到“好的”解决方案。我有一些更严格的软实时要求（从贴有标签的纸板箱中拍照）所以可能其中一种方法对您来说足够快。我假设电子邮件可以等待几分钟。

*   由 cron 作业处理的数据库中的“待办事项列表”。
*   数据库中的“待办事项列表”由守护程序轮询永久处理。
*   使用一个自定义的守护进程，它通过一个 UDP 数据包由网络服务器通知（今天在生产中）。基本上是我自己的队列系统，带有用于处理队列的 IP 堆栈。
*   [使用 ActiveMQ 作为消息代理](http://blogs.23.nu/c0re/2007/08/antville-15655/)- 由于稳定性问题，这没有成功。对我来说，Java 守护进程通常有点丰满
*   在 CouchDB 中使用更新触发器。不错，但更新触发器并不意味着要进行繁重的图像处理，所以不适合我的问题。

到目前为止，我还没有尝试过 RabbitMQ 和 XMPP/ejabebrd 来处理这个问题，但它们在我接下来要尝试的事情列表中。RabbitMQ 在 2008 年获得了不错的 Python 连接，并且有大量的 XMPP 库。

但也许您只需要在本地机器上正确配置邮件服务器。这可能允许您将邮件同步转储到本地邮件服务器，从而使您的整个软件堆栈更加简单。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-03T16:15:16.083

Stompserver 是一个不错的选择。它是轻量级的，易于安装且易于从 Django/python 使用。

我们有一个系统在生产中使用 stompserver 来异步发送电子邮件和处理其他工作。

Django 将电子邮件保存到数据库中，Django 中的 model.post_save 处理程序将事件发送到 stompserver 并且 stompserver 将事件传递给执行异步任务（发送电子邮件）的消费者进程。

它可以很好地扩展，因为您可以在运行时添加消费者进程——两个消费者可以发送两倍的电子邮件，消费者可以在不同的机器上。一个小麻烦是每个消费者都需要自己的命名队列，因此 Django 需要知道有多少消费者可用，并以循环方式向每个队列发送事件。（在同一个队列上监听的两个消费者都将得到每个消息 = 重复）。如果您只想要一个消费者进程，那么这不是问题。

我们以前的进程会不断地轮询数据库中的作业，但发现它给系统增加了很多负载，即使不需要处理任何东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-19T02:45:50.517

只需将电子邮件添加到数据库中，然后编写另一个由某些任务计划程序实用程序（想到 cron）运行的脚本来发送电子邮件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-18T06:48:39.070

您可能想看看[pymq](http://code.google.com/p/pymq/)。它是用 python 编写的，与它的客户端进行 HTTP 通信，并允许对队列进行大量监控和管理选项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-12T21:46:40.260

使用邮件基础设施解决这个问题有什么问题吗？就像，每个运行自己的邮件守护进程的应用服务器都会将任何本地提交的邮件排队，然后转发到可以处理邮件繁重的集中式邮件服务器？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-18T11:34:32.797

如果您已经安装了 MySQL，您可以创建一个表以用作各种“待办事项列表”。

线程同步地将作业添加到表中，批处理任务在作业完成后删除它们。

这样，就无需安装和学习更多软件，只要您不发送*大量*电子邮件（例如 >10/秒），它就可以作为持久的作业存储正常工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-25T00:08:09.207

这是一个懒惰但正确且充分的解决方案。使用以下数据库表作为队列。

```
drop table if exists mailqueue;
create table mailqueue (
    id bigint primary key,
    subject text not null,
    body mediumtext not null,
    from varchar(255) not null,
    to varchar(255) not null
); 
```

发件人应将新行插入此表的末尾。

Setup worker threads to pop mails one at a time from the other end (lowest id) and try to send them.

# sql - 在多行上执行表值函数？

> ID：454945
> 
> 赞同：33
> 
> 时间：2009-01-18T10:44:09.980
> 
> 标签：sql, sql-server-2005, tsql, user-defined-functions

给定一个表值函数，例如`dbo.Split()`来自["T-SQL: Opposite to string concatenation - how to split string into multiple records"](https://stackoverflow.com/questions/314824/t-sql-opposite-to-string-concatenation-how-to-split-string-into-multiple-recor)，我如何将多行作为参数传递？

这有效：

```
SELECT *
FROM dbo.Split
  (',', (SELECT myColumn FROM Stuff WHERE id = 22268))
WHERE ISNULL(s,'') <> '' 
```

它返回：

```
pn          s
----------- -----------
1           22351
2           22354
3           22356
4           22357
5           22360 
```

但这不会：

```
SELECT *
FROM dbo.Split
  (',', (SELECT myColumn FROM Stuff))
WHERE ISNULL(s,'') <> '' 
```

这也不是：

```
SELECT * FROM dbo.Split_temp(',', myColumn), Stuff 
```

[文档](http://msdn.microsoft.com/en-us/library/ms175562.aspx)说：

> 在子查询的 FROM 子句中调用返回表的用户定义函数时，函数参数不能引用外部查询中的任何列。

我正在寻找的那种结果集看起来像：

```
id          pn          s
----------- ----------- -----------
22268       1           22351
22268       2           22354
22268       3           22356
22268       4           22357
22268       5           22360
24104       1           22353
24104       2           22355
24104       3           22356
24104       4           22358
24104       5           22360
24104       6           22362
24104       7           22364
.
.
. 
```

有没有办法（当然，除了光标）来完成这个？

（编辑）

根据 MarlonRibunal 的要求，生成上述结果的示例表如下所示：

```
id          myColumn
----------- -------------------------------------------
22268       22351,22354,22356,22357,22360,
24104       22353,22355,22356,22358,22360,22362,22364, 
```

`id`是一个`int`；`myColumn`是一个`varchar(max)`。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-01-18T13:23:21.237

`OUTER APPLY`：

```
SELECT Stuff.id
    ,Results.pn
    ,Results.s
FROM stackoverflow_454945 AS Stuff
OUTER APPLY dbo.Split(',', Stuff.myColumn) AS Results
WHERE ISNULL(Results.s,'') <> '' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T11:17:55.670

您可以使用 COALESCE 连接行为

```
declare @split varchar(max) 
set @split = ''

select @split = @split + Coalesce(myColumn + ',' , ' ') 
from Stuff 
WHERE id = 22268

select * from dbo.Split(',', @Left(@split,len(@split) -1)) 
```

我不知道这会比使用游标更好。

# c# - c#MVC中的多个结果集

> ID：454948
> 
> 赞同：1
> 
> 时间：2009-01-18T10:47:08.010
> 
> 标签：c#, sql-server, asp.net-mvc, xml, stored-procedures

我使用 Asp.NET MVC 作为几个搜索引擎类型 asp/jquery 网站的基本 web 服务。数据库搜索很简单：

模型 - Sql Server FullText Sproc 返回 XML

查看 - 不适用

控制器 - 授权用户/解析输入返回内容 (Model.XML)

返回的 XML 包含四个结果集 - 项目列表、类别细分、相关/广告项目和分页号码。项目、类别和相关列表都包含几个元素和属性。

我现在正在寻找在 MVC 视图中显示相同信息的最佳方法 - 用于 jquery 的完整和部分信息 - 但我正在努力寻找最佳解决方案。到目前为止，我想出的唯一两个是使用 Linq 解析 XML（这应该在 View 还是 Controller 中完成？）或者有一个 SProc 返回结果集并使用 NextResult 方法来填充多个列表（不是我已经解决了怎么做呢....）

所有建议表示赞赏，谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-19T02:28:11.583

Decided to run with XDocument(Linq-to-XML); with the PasteXmlAsXLinq Visual Studio addin taking the pain out of it!

I'll leave the ORM until Asp.net mvc rtm. By then should have a better idea (Entity/ Linq & Viewengine) on most suitable route for full MVC 'conversion'.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-18T11:28:15.307

对于解析 xml - 如何使用`XmlSerializer`反序列化对象图？

是否需要返回xml？返回可以直接阅读的常规网格怎么样？例如，一种选择是使用 ORM，例如 LINQ-to-SQL `DataContext`- 然后您可以执行生成的方法，将数据作为对象提供给您。

或者 - 也许通过 xsl 转换呈现 xml？

# winforms - WinForms 数据绑定

> ID：454959
> 
> 赞同：13
> 
> 时间：2009-01-18T10:55:43.000
> 
> 标签：winforms, data-binding

我已经构建了一些业务对象，并且构建了一个“数据访问层”，它将读取、更新、删除等。现在我想将这些对象绑定到 WinForm 应用程序中的网格/文本框/组合等。

我可以做手动方法，如：

```
txtName.Text = employee.Name; 
```

然后在保存时执行类似的操作

```
employee.Name = txtName.Text; 
```

但我更愿意使用 VS 2008 的“RAD”功能。我已经进行了一些谷歌搜索，但我没有找到任何快速教程来展示我需要对我的业务对象执行哪些操作以允许它们成为“数据”边界”。任何人都可以帮忙吗？

# wpf - 从 ContextMenu 命令中找到 TabItem 的正确方法

> ID：454962
> 
> 赞同：1
> 
> 时间：2009-01-18T11:00:21.603
> 
> 标签：wpf, tabcontrol, contextmenu

我有我在其上设置 ContextMenu 的 TabControl。

所有 ContextMenu 元素都有命令集。

```
<ContextMenu x:Key="tabMenu">
  <MenuItem Command="{x:Static tabs:TabCommands.Close}" />
  <MenuItem Command="{x:Static tabs:TabCommands.CloseAllButThis}" />
  <MenuItem Command="{x:Static tabs:TabCommands.CloseAll}" />
</ContextMenu> 
```

所有命令都被路由，并且 CommandBindings 在 TabControl 之上定义了几个级别。

所以问题是：在 CommandBinding CanExecute/Execute 事件处理程序中，找出调用菜单的 TabItem 的正确方法是什么？正确的意思是，如果我更改 TabItem 模板之类的东西，它就不会损坏。

或者可能整个方法是错误的，我不应该为此使用路由命令？我最初将路由用于需要热键的“添加新选项卡”命令。

提前致谢。

**更新**：

Igor 的解决方案比架构 POV 更清晰（除了我会在 ViewModel 中删除 _），但我希望有一个独立于 TabControl 绑定的可重用关闭命令（因为所有类型的应用程序中都存在选项卡的关闭/关闭全部）并且没有在语义上链接到特定模型）。

此外，我不能使用自定义 DataTemplate，因为我已经有一个自定义模板，并且子类化它会使解决方案有点过于复杂。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T22:08:59.967

似乎我自己找到了答案，但是它非常不雅：

```
<Style TargetType="MenuItem">
  <Setter Property="CommandTarget">
    <Setter.Value>
      <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ContextMenu}}"
               Path="(ContextMenu.PlacementTarget)" />
    </Setter.Value>
  </Setter>
</Style>

<Style TargetType="TabItem">
  <Setter Property="ContextMenu" Value="{StaticResource tabMenu}" />
</Style> 
```

所以我将 ContextMenu 添加到 TabItem 而不是 TabControl，并将 CommandTarget 绑定到 TabItem。

有趣的是是否有更好的答案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T03:25:00.537

当然，还有更好的答案。您需要使用模型/视图模型，而不是视图。这是我的代码中的简化示例：

```
 <TabControl Margin="3" Grid.Column="1" Name="tbPages"
                    ItemsSource="{Binding DsmProject.Pages}" 
                    ItemTemplate="{DynamicResource TabItemTemplate}"
                    IsSynchronizedWithCurrentItem="True">
        </TabControl>
<DataTemplate x:Key="TabItemTemplate">
    <StackPanel Orientation="Horizontal" ContextMenu="{DynamicResource cmPages}">
        <ContentPresenter Content="{Binding Path=Name}"/>
    </StackPanel>
</DataTemplate>
<ContextMenu x:Key="cmPages">
    <MenuItem Header="Close" Command="cmd:DSM2100Commands.ClosePage" CommandParameter="{Binding}" />
</ContextMenu> 
```

这是处理此命令的代码。

```
 #Region "Close Page"

    Private Sub ClosePageCmd(ByVal sender As Object, ByVal e As ExecutedRoutedEventArgs)
        ViewModel_.History.TakeCommmand(New cmdRemovePage(ViewModel_, e.Parameter))
    End Sub

    Private Sub CanClosePageCmd(ByVal sender As Object, ByVal e As CanExecuteRoutedEventArgs)
        e.CanExecute = ViewModel_.DsmProject IsNot Nothing AndAlso ViewModel_.DsmProject.Pages.Count > 1
    End Sub

    #End Region 
```

As you can see, my code don't have need to know which TabItem was clicked, just need to know which data object was bound to this TabItem. In anyway, if you need to know TabItem, which was clicked you can find it by Data object bounded to it using ContainerGenerator object and your datatemplate.

With best wishes from Russia!

# javascript - 如何使整个浏览器窗口变灰并在中心显示一个表单？

> ID：454973
> 
> 赞同：9
> 
> 时间：2009-01-18T11:15:54.020
> 
> 标签：javascript, css

您是否遇到过那些使整个浏览器窗口变灰并向您显示通知或要求您填写调查表等的网站？这曾经发生在 myspace 中，如果您输入错误的电子邮件或密码，完整的浏览器窗口将变灰（虽然它是透明的，但您仍然可以通过它看到页面的内容），并且登录控件将显示在中心浏览器窗口上方有一条错误消息，告诉您您输入了错误的电子邮件或密码。不幸的是，他们从我的空间中删除了这个，我想要一个我正在开发的网站的相同代码，并试图避免重新发明轮子，你知道有什么来源可以找到这个代码而不是重新编写整个代码吗？我认为这主要是 CSS，Javascript 仅用于显示/隐藏，对吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-18T11:21:49.670

如果您正在考虑使用 JavaScript 框架，[jQuery](http://jquery.com/)有[Block UI 插件](http://www.malsup.com/jquery/block/#overview)。非常易于使用和配置。

[演示在这里](http://www.malsup.com/jquery/block/#demos)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-18T11:27:10.410

您也可以为此仅使用 CSS 和 Javascript：使用 CSS 和[Javascript](http://code.google.com/p/submodal/)和子[模式创建模态对话框](http://sitening.com/blog/create-a-modal-dialog-using-css-and-javascript/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T11:48:19.557

这些被称为“模态”窗口。为避免重新发明轮子，请使用 JQuery 等现有库。谷歌搜索 'jquery modal window' 会显示很多看起来正是您想要的结果。如果它完全符合您的要求，您可以选择其中之一，或者找到一个具有良好来源的解构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T11:26:14.687

如果您更喜欢prototype.js，可以使用Prototype Window Class，做您想做的事，请参阅[警报对话框示例](http://prototype-window.xilinus.com/samples.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-19T05:28:06.103

如果您在 asp.net 中工作并想要一个快速简便的工具，请获取 ajax 工具包。然后使用模态弹出控件。[这是 AJAX PAGE 上的示例](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ModalPopup/ModalPopup.aspx)

# linux - 为了能够为其编写设备驱动程序，设备的一些最低要求是什么？

> ID：454976
> 
> 赞同：0
> 
> 时间：2009-01-18T11:18:58.583
> 
> 标签：linux, kernel, device-driver

我最近开始阅读一些关于内核空间的文章，尤其是关于设备驱动程序的文章。所以我想知道是否对设备有一些最低要求，以便轻松为其编写设备驱动程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T11:41:13.470

可以从内核（PCI、USB 等）和文档与其进行通信。显然，一种硬件调试过程可以改善事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T11:56:49.210

（这不算“最小”，但它确实满足了您“轻松”的愿望。）

某种测试模式或设备模拟器，它允许您

(a) 查看发送给它的消息，以便您可以查看代码中何时出现错误。

(b) 激发导致通信发生的事件。

例如，如果您正在编写防盗警报驱动程序，这是一种触发设备从窗户传感器发送警报的方法，而无需实际将砖块扔进窗户。

# c++ - 接收 COM 事件

> ID：454984
> 
> 赞同：1
> 
> 时间：2009-01-18T11:29:50.577
> 
> 标签：c++, com, event-handling

没有：

*   ATL
*   MFC

笔记：

*   纯**C++**
*   **进程外**COM 对象/服务器
*   预定义的 TLB 文件

**问题：**

*   如何实现一个**传出接口**，以便 COM 对象可以通知接收**器**事件？
*   一旦收到，如何妥善处理事件？

下面是我想实现的事件函数 - 来自**TLB**文件：

```
inline HRESULT IS8SimulationEvents::S8SimulationEndRun ( ) {
    HRESULT _result = 0;
    _com_dispatch_method(this, 0x2, DISPATCH_METHOD, VT_ERROR, (void*)&_result, NULL);
    return _result;
} 
```

问候

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T11:44:06.163

在 COM Server 类中实现源接口。如果您不使用 ATL，则应该实现 IConnectionPointcontainer。

In the client class call the COM server as mentioned below. 1\. Call FindConnectionPointContainer 2\. Call FindConnectionPoint 3\. Call Advise on the interface pointer returned from step 2, we should provide IUnknown pointer of sink object. Advise returns a cookie, that we can use it while calling the unadvise.

To handle the events you can do it 2 ways one using the IDispatch's Invoke method to resolve the calls in Client side other is server itself calls the particular Sink method. Both the method uses the IUnknown pointer that it gets while advising.

# sql-server - 在 SQL Server 2005 中是否有一种快速报告数据库元数据的方法？

> ID：454986
> 
> 赞同：2
> 
> 时间：2009-01-18T11:31:31.553
> 
> 标签：sql-server, reporting, database-metadata

是否有任何系统存储过程来报告 SQL Server 2005 中数据库本身的统计信息和元数据？

我需要的是一种快速输出表列表、每个表的大小、每个表中的行数等的方法。单个表和元数据的存储过程也很有用。

建议表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-18T11:34:04.903

是的，数据字典表将允许您这样做。数据字典中的主要表是[sys.objects](http://msdn.microsoft.com/en-us/library/ms190324.aspx)、[sys.columns](http://msdn.microsoft.com/en-us/library/ms176106.aspx)、[sys.indexes](http://msdn.microsoft.com/en-us/library/ms173760.aspx)、[sys.foreign_keys](http://technet.microsoft.com/en-us/library/ms189807.aspx)和[sys.sql_modules](http://msdn.microsoft.com/en-us/library/ms175081.aspx)。有关使用系统数据字典将数据库反向工程为 SQL 脚本的各种查询的示例，请查看[此 stackoverflow 帖子。](https://stackoverflow.com/questions/181909/tool-for-scripting-table-data#181942)

从数据字典中获取空间使用情况有点复杂，但[sp_spaceused](http://msdn.microsoft.com/en-us/library/ms188776.aspx)将为单个表执行此操作。您可以用[sp_msforeachtable](http://www.databasejournal.com/features/mssql/article.php/1490661/spMSforeachtable.htm)包装它以遍历一组表并获取所有表的报告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T11:35:45.510

查看系统视图，尤其是 information_schema.tables。这些 procs 还将获得您正在寻找的大量数据。

```
sp_helpdb dbname
sp_help objectname
sp_spaceused tablename 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T11:50:54.683

您可以使用视图，而不是直接查询`sysobjects`etc... 表。`INFORMATION_SCHEMA`

实际上，`sysobjects`是 中的表`SQL SErver2000`，但在 中`SQL 2005`，它被实现为`view`，并且保留它以保持向后兼容性。

# algorithm - 我的算法需要一个问题。我需要像搜索引擎输入数据

> ID：454989
> 
> 赞同：-3
> 
> 时间：2009-01-18T11:31:49.823
> 
> 标签：algorithm, language-agnostic, sorting

想象一下，你有一些产品或物品，或者只是任何你想按重要性顺序查看的东西。就像您在搜索引擎中想要的那样。喜欢网站。而且你不知道如何对它们进行排序。但是您有一些标准可以为您提供线索。你有一袋标准，根据每一个，你可以找到一个排序，但你不能将它们聚合到一个偏好列表中。

嗯，我可以。这是我论文的一部分，我想展示它的实际用途。我会很感激关于在这里排序什么以及使用哪些标准的建议。

我想过这样的事情：一家 DVD 商店根据以下因素对 DVD 进行排序：媒体质量、与查询字符串的匹配、用户投票。

所以，我很乐意遇到包括数据在内的现实问题，用户会告诉我他们是否喜欢我的排序。在哪里我可以看到获得的排序是否有用。这就是重点：这是否比标准算法更好。

干杯，

尼可

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-18T11:52:48.190

您可以按日期、首选和不喜欢的标签、答案数量、投票等对编程问题进行排序，以找到最有趣的问题 :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T12:26:21.523

Netflix 大奖？见这里： http: [//www.netflixprize.com/](http://www.netflixprize.com/)也许它更多的是关于聚类而不是排序。

# c# - 返回包含 2 个子类的 IQueryable

> ID：454991
> 
> 赞同：4
> 
> 时间：2009-01-18T11:32:29.977
> 
> 标签：c#, linq-to-sql

你能返回由两个或多个不同子类组成的 IQueryable 吗？这是我试图表明我的意思的尝试。它抛出错误：

**System.NotSupportedException：Union 或 Concat 中的类型具有以不同顺序分配的成员..**

```
var a = from oi in db.OrderItems
        where oi.OrderID == ID
            && oi.ListingID != null
        select new OrderItemA {
            // etc
        } as OrderItem;

var b = from oi in db.OrderItems
        where oi.OrderID == ID
            && oi.AdID != null
        select new OrderItemB {
            //etc
        } as OrderItem;

return a.Concat<OrderItem>(b); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-21T21:33:50.173

尝试在 IEnumerable 而不是 IQueryable 上执行 concat：

```
return a.AsEnumerable().Concat(b.AsEnumerable()); 
```

如果你需要一个 IQueryable 结果，你可以这样做：

```
return a.AsEnumerable().Concat(b.AsEnumerable()).AsQueryable(); 
```

这样做**将**强制 concat 在内存中而不是在 SQL 中发生，并且任何其他操作也将在内存中发生（LINQ To Objects）。

但是，与 .ToList() 示例不同，执行仍应延迟（使您的数据延迟加载）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-18T11:47:30.133

我的猜测是，这是因为您在 LINQ-to-SQL 上下文中使用 LINQ。

因此，使用 Concat 意味着 LINQ2SQL 需要将这两个查询加入到 SQL UNION 查询中，该查询可能是其`System.NotSupportedException`来源。

你可以试试这个：

```
return a.ToList().Concat<OrderItem>(b.ToList()); 
```

看看有没有什么不同？

上面所做的是它执行两次查询，然后将它们连接到内存中而不是热关闭 SQL 以避免查询转换问题。

这可能不是理想的解决方案，但如果可行，我的假设可能是正确的，这是一个查询翻译问题：

有关将 Union 和 Concat 转换为 SQL 的更多信息：

*   [http://blog.benhall.me.uk/2007/08/linq-to-sql-difference-between-concat.html](http://blog.benhall.me.uk/2007/08/linq-to-sql-difference-between-concat.html)
*   [http://msdn.microsoft.com/en-us/library/bb399342.aspx](http://msdn.microsoft.com/en-us/library/bb399342.aspx)
*   [http://msdn.microsoft.com/en-us/library/bb386979.aspx](http://msdn.microsoft.com/en-us/library/bb386979.aspx)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-09T10:24:50.307

有趣的是，在阅读了您的帖子并进行了一些测试之后，我意识到您的实际操作对我来说似乎工作得很好，因为您在两个查询中显示为省略号的投影部分都匹配。您会看到，LINQ to SQL 似乎是根据属性赋值语句构造 SQL 选择命令的基础投影，而不是物化的实际类型，只要双方具有相同的编号、类型和顺序（不确定关于这一点）的成员分配 UNION 查询应该是有效的。

我一直在使用的解决方案是在我的 DataContext 类上创建一个属性，该属性的作用很像 SQL 视图，因为它允许我编写查询（在我的情况下是两个不同表之间的联合），然后使用该查询在编写只读选择语句时，就好像它本身就像一个表一样。

```
public partial class MyDataContext
{
    public IQueryable<MyView> MyView
    {
        get
        {
            var query1 = 
                from a in TableA
                let default_ColumnFromB = (string)null
                select new MyView()
                {
                    ColumnFromA = a.ColumnFromA,
                    ColumnFromB = default_ColumnFromB,
                    ColumnSharedByAAndB = a.ColumnSharedByAAndB,
                };

            var query2 = 
                from a in TableB
                let default_ColumnFromA = (decimal?)null
                select new MyView()
                {
                    ColumnFromA = default_ColumnFromA,
                    ColumnFromB = b.ColumnFromB,
                    ColumnSharedByAAndB = b.ColumnSharedByAAndB,
                };

            return query1.Union(query2);
        }
    }
}

public class MyView
{
    public decimal? ColumnFromA { get; set; }
    public string ColumnFromB { get; set; }
    public int ColumnSharedByAAndB { get; set; }
} 
```

注意两个关键点：

首先，由构成联合两半的查询形成的投影具有相同的列数、类型和顺序。现在 LINQ 可能要求顺序相同（对此不确定），但 SQL 确实适用于 UNION，我们可以确定 LINQ 至少需要相同类型和数量的列以及这些“列”由成员*分配*知道，而不是从您在投影中实例化的类型的属性中知道。

其次，LINQ 目前不允许在用于制定 Concat 或 Union 的查询的投影中使用多个常量，据我了解，这主要是因为这两个单独的查询在处理 Union 操作之前分别进行了优化。通常 LINQ to SQL 足够聪明，可以意识到如果您有一个仅在投影中使用的常量值，那么为什么将它发送到 SQL 只是为了让它以原来的方式返回，而不是作为一个帖子附加它原始数据从 SQL Server 返回后处理。不幸的是，这里的问题是，这是 LINQ to SQL 智能的一个例子，因为它在过程中过早地优化了每个单独的查询。我发现解决这个问题的方法是使用*let*关键字为投影中的每个值形成一个范围变量，该范围变量将通过从常量中获取它的值来实现。不知何故，这会欺骗 LINQ to SQL 将这些常量传递给实际的 SQL 命令，该命令将所有预期的列保留在结果 UNION 中。可以在[此处](https://stackoverflow.com/questions/650847/linq2sql-help-with-sqlexception-about-union-intersect-and-except/1171407#1171407)找到有关此技术的更多信息。

使用这种技术，我至少有一些可重用的东西，这样无论实际的 Union 可以得到多么复杂或丑陋，特别是对于范围变量，在您的最终查询中，您可以将查询写入这些伪视图，例如 MyView 并处理复杂性下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T12:54:38.063

你可以在concat*之后进行投影吗？*

```
// construct the query
var a = from oi in db.OrderItems
        where oi.OrderID == ID
            && oi.ListingID != null
        select new {
            type = "A"
            item = oi
        }

var b = from oi in db.OrderItems
        where oi.OrderID == ID
            && oi.AdID != null
        select new {
            type = "B"
            item = oi
        }

var temp = a.Concat<OrderItem>(b);

// create concrete types after concatenation
// to avoid inheritance issue

var result = from oi in temp
             select (oi.type == "A"
                 ? (new OrderItemA {
                         // OrderItemA projection

                     } as OrderItem)

                 : (new OrderItemB {
                         // OrderItemB projection

                     } as OrderItem)
             );

return result 
```

不确定在上述情况下三元运算符是否适用于 LINQ2SQL，但这可能有助于避免继承问题。

# java - 诺基亚 N73 中哪些接口是可编程的？

> ID：454992
> 
> 赞同：0
> 
> 时间：2009-01-18T11:32:44.330
> 
> 标签：java, nokia, hardware-interface, n73

我有一[台诺基亚 N73](http://www.s60.com/life/s60phones/displayDeviceOverview.do?deviceId=840)，我想将其编程为使用任何可用接口与外部硬件连接**。**（[POP 端口](http://pinouts.ru/CellularPhones-Nokia/nokia_pop_pinout.shtml)？）

使用任何[可用的平台：](http://www.forum.nokia.com/Resources_and_Information/Explore/Software_Platforms/S60/#flash)

*   [打开 C++](http://www.forum.nokia.com/openc)
*   [塞班 C++](http://www.forum.nokia.com/main/resources/technologies/symbian/documentation/getting_started.html)
*   [爪哇](http://www.forum.nokia.com/main/resources/technologies/java/documentation/getting_started.html)
*   [闪存精简版](http://www.forum.nokia.com/main/resources/technologies/flash/index.html)
*   [Python](http://www.forum.nokia.com/python)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T12:05:57.693

**成立：**

*   [Java ME 串行端口](http://www.forum.nokia.com/info/sw.nokia.com/id/2a2ec089-6f2e-47cb-a150-d11a94eb80ad/MIDP_Using_Cable_Connection_In_Nokia_Devices_v1_0.zip.html)，RS-232 CommConnection 使用 Java ME MIDP
*   [诺基亚手机上的有线接口](http://www.forum.nokia.com/Resources_and_Information/Explore/Mobile_Technologies/Connectivity_&_Interfaces/Wired_Interfaces/)，USB，POP，AV，2mm
*   [通过 USB 进行串行通信](http://wiki.forum.nokia.com/index.php/TSS000601_-_Serial_communication_over_USB_on_S60_3rd_Edition_devices)，使用 Symbian C++ 中的 RComm API
*   [红外串行通信](http://wiki.forum.nokia.com/index.php/Serial_communication)，使用 S60 Comms Server****************************