# StackOverflow 问答 000109000-000109999

# c - 如何模拟内存分配错误

> ID：109000
> 
> 赞同：22
> 
> 时间：2008-09-20T18:56:41.680
> 
> 标签：c, linux, unit-testing, gcc, memory-management

我的 C 应用程序使用第三个库，它们自己管理内存。为了变得健壮，我的应用程序有代码来处理由于缺少可用内存而导致的库函数故障。

我想测试这段代码，为此，我需要模拟由于内存不足而导致的失败。

为此推荐什么工具？我的环境是 Linux/gcc。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-20T19:01:34.507

您可以`ulimit`用来限制用户可以使用的资源量，包括内存。因此，您创建了一个测试用户，将他们的内存使用限制在足以启动您的程序的范围内，然后看着它死掉:)

例子：

```
ulimit -m 64 
```

将内存限制设置为 64kb。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T18:59:31.393

创建您自己的 malloc 包装器，它将随机返回 null 而不是有效指针。好吧，或者如果你想进行单元测试，它会一直失败。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-23T17:12:19.393

在过度使用内存的操作系统（例如，Linux 或 Windows）上，根本不可能处理内存不足错误。malloc 可能会返回一个有效的指针，稍后，当您尝试取消引用它时，您的操作系统可能会确定您内存不足并终止该进程。

[http://www.reddit.com/comments/60vys/how_not_to_write_a_shared_library/](http://www.reddit.com/comments/60vys/how_not_to_write_a_shared_library/)是一篇很好的文章。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-20T18:59:43.373

您可以编写自己的模拟库，使用与您的 3rd 方库相同的接口来代替它。您还可以使用 LD_PRELOAD 覆盖 3rd 方库的选定函数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T19:00:17.927

我可以给出一个 Linux（可能是 POSIX）特定版本：__malloc_hook、__realloc_hook、__free_hook。这些在 malloc.h 中声明。

编辑：稍微详细说明一下：这些是函数指针（有关确切声明，请参见 malloc.h 及其手册页），但请注意：这些并不完全是标准，只是 GNU 扩展。因此，如果可移植性是一个问题，请不要使用它。

与平台无关的解决方案可能是您声明了一个 malloc 宏。如果您正在测试，这将调用一个钩子和真正的 malloc。

内存挂钩.h：

```
#define malloc(s)    (my_malloc(s)) 
```

内存挂钩.c：

```
#include "memhook.h"
#undef malloc
#include <stdlib.h> 
```

等等

您可以使用它来检测泄漏、随机分配失败等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T19:08:37.300

此外，你应该使用[Valgrind](http://valgrind.org)来测试它并获得关于你的程序的内存行为的真正有用的报告

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-11-05T20:02:03.257

您可以在头文件中设置一个定义，以便在使用 malloc 时返回 NULL：

通常 malloc 将通过以下方式受到保护：

```
if ((int *x = malloc(sizeof(int))) == NULL)
{
   return NULL;
} 
```

因此，您使用定义来强制返回 NULL；伪代码示例：

```
# define malloc(X) NULL 
```

并检查您是否遇到段错误

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T19:02:36.067

您需要 bash 中的 ulimit 命令。尝试

```
帮助超限
```

在 bash shell 提示符下。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-19T02:18:43.970

您可能想查看一些面向恢复的计算站点，例如[Berkeley/Stanford ROC group](http://roc.cs.berkeley.edu/)。我以前听过其中一些人的谈话，他们使用代码在 C 运行时中随机注入错误。在他们的页面底部有一个指向他们的 FIT 工具的链接。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-22T17:05:02.947

（作为对之前一些答案的补充）

查看“Electric Fence”以获取可以与可执行文件一起使用的 malloc 拦截库的示例（例如，使用 LD_PRELOAD 技巧）。

一旦你拦截了 malloc，你可以使用任何你想触发失败的东西。随机触发的故障将是对系统各个部分的良好压力测试。您还可以根据请求的内存量修改故障概率。

顺便说一句，你的想法很有趣，显然我想对我的一些代码做一些事情......

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-26T06:34:17.947

看看[sqlite3 是如何做到这一点的](http://sqlite.org/testing.html#oomtesting)。他们执行广泛的单元测试，包括内存不足测试。

您可能还想查看[他们关于 malloc 的页面](http://sqlite.org/malloc.html)，尤其是[第 4.0 节](http://sqlite.org/malloc.html#nofrag)。

# algorithm - 如何计算 32 位整数中设置的位数？

> ID：109023
> 
> 赞同：950
> 
> 时间：2008-09-20T19:04:38.837
> 
> 标签：algorithm, binary, bit-manipulation, hammingweight, iec10967

代表数字 7 的 8 位如下所示：

```
00000111 
```

设置了三位。

确定 32 位整数中设置位数的算法是什么？

* * *

## 回答 #1

> 赞同：942
> 
> 时间：2008-09-20T19:05:22.550

这被称为“[汉明权重](https://en.wikipedia.org/wiki/Hamming_weight)”、“popcount”或“横向加法”。

一些 CPU 有一个内置指令来执行此操作，而另一些 CPU 具有作用于位向量的并行指令。像 x86 的指令[`popcnt`](https://www.felixcloutier.com/x86/popcnt)（在支持它的 CPU 上）几乎可以肯定对于单个整数来说是最快的。其他一些架构可能使用微编码循环实现的慢指令，每个循环测试一个位（*需要引用*- 如果硬件popcount存在的话，它通常很快。）。

“最佳”算法实际上取决于您使用的 CPU 以及您的使用模式。

您的编译器可能知道如何为您正在编译的特定 CPU 做一些有益的事情，例如[C++20`std::popcount()`](https://en.cppreference.com/w/cpp/numeric/popcount)或 C++ [`std::bitset<32>::count()`](https://en.cppreference.com/w/cpp/utility/bitset/count)，作为访问内置/内在函数的可移植方式（请参阅有关此问题的[另一个答案](https://stackoverflow.com/questions/109023/how-to-count-the-number-of-set-bits-in-a-32-bit-integer/109069#109069)）。但是您的编译器为没有硬件 popcnt 的目标 CPU 选择的后备可能不是您的用例的最佳选择。或者您的语言（例如 C）可能不会公开任何可以使用特定于 CPU 的 popcount 的可移植函数。

* * *

### 不需要（或受益于）任何硬件支持的可移植算法

如果您的 CPU 有一个大缓存并且您在一个紧密的循环中执行大量这些操作，那么预填充的表查找方法可能会非常快。然而，由于“缓存未命中”的代价，它可能会受到影响，其中 CPU 必须从主内存中获取一些表。（分别查找每个字节以保持表格较小。）如果您希望 popcount 用于连续范围的数字，则只有低字节会改变 256 个数字的组，[这非常好](https://stackoverflow.com/questions/66520106/count-integers-in-1-n-with-k-zero-bits-below-the-leading-1-popcount-for-a-c/66532113#66532113)。

如果您知道您的字节大部分为 0 或大部分为 1，那么对于这些​​场景有有效的算法，例如在循环中使用 bithack 清除最低集，直到它变为零。

我相信一个非常好的通用算法如下，称为“并行”或“可变精度 SWAR 算法”。我已经用类似 C 的伪语言表达了这一点，您可能需要对其进行调整以适用于特定语言（例如，在 C++ 中使用 uint32_t，在 Java 中使用 >>>）：

GCC10 和 clang 10.0 可以识别此模式/习语并将其编译为硬件 popcnt 或可用的等效指令，为您提供两全其美的体验。（[https://godbolt.org/z/qGdh1dvKK](https://godbolt.org/z/qGdh1dvKK)）

```
int numberOfSetBits(uint32_t i)
{
     // Java: use int, and use >>> instead of >>. Or use Integer.bitCount()
     // C or C++: use uint32_t
     i = i - ((i >> 1) & 0x55555555);        // add pairs of bits
     i = (i & 0x33333333) + ((i >> 2) & 0x33333333);  // quads
     i = (i + (i >> 4)) & 0x0F0F0F0F;        // groups of 8
     return (i * 0x01010101) >> 24;          // horizontal sum of bytes
} 
```

对于 JavaScript：[强制转换为整数](https://stackoverflow.com/questions/109023/how-to-count-the-number-of-set-bits-in-a-32-bit-integer/109025#comment103845611_109025)以`|0`提高性能：将第一行更改为`i = (i|0) - ((i >> 1) & 0x55555555);`

这具有所讨论的任何算法中最好的最坏情况行为，因此将有效地处理任何使用模式或您抛出的值。（它的性能不依赖于普通 CPU，其中所有整数运算（包括乘法）都是恒定时间的。“简单”输入并没有变得更快，但它仍然相当不错。）

参考：

*   [https://graphics.stanford.edu/~seander/bithacks.html](https://graphics.stanford.edu/%7Eseander/bithacks.html#CountBitsSetParallel)
*   [https://en.wikipedia.org/wiki/Hamming_weight](https://en.wikipedia.org/wiki/Hamming_weight)
*   [http://gurmeet.net/puzzles/fast-bit-counting-routines/](http://gurmeet.net/puzzles/fast-bit-counting-routines/)
*   [http://aggregate.ee.engr.uky.edu/MAGIC/#Population%20Count%20(Ones%20Count)](http://aggregate.ee.engr.uky.edu/MAGIC/#Population%20Count%20(Ones%20Count))

* * *

### 这个 SWAR bithack 是如何工作的：

```
i = i - ((i >> 1) & 0x55555555); 
```

第一步是屏蔽的优化版本，以隔离奇数/偶数位，将它们对齐并添加。这有效地在 2 位累加器中进行了 16 次单独的加法（[SWAR = SIMD Within A Register](https://en.wikipedia.org/wiki/SWAR)）。喜欢`(i & 0x55555555) + ((i>>1) & 0x55555555)`。

下一步取这些 16x 2 位累加器中的奇数/偶数 8 个并再次相加，产生 8x 4 位和。这次`i - ...`无法进行优化，因此它只是在移位之前/之后进行掩码。`0x33...`在为需要分别在寄存器中构造 32 位常量的 ISA 进行编译时，两次而不是在移位之前使用相同的常量`0xccc...`是一件好事。

最后的移位和加法步骤`(i + (i >> 4)) & 0x0F0F0F0F`扩展为 4 个 8 位累加器。*它在添加之后*而不是之前进行掩码，因为`4`如果设置了相应输入位的所有 4 位，则任何 4 位累加器中的最大值都是 。4+4 = 8 仍然适合 4 位，因此半字节元素之间的进位在`i + (i >> 4)`.

到目前为止，这只是使用 SWAR 技术和一些巧妙优化的相当普通的 SIMD。继续使用相同的模式再增加 2 个步骤可以扩大到 2x 16 位然后 1x 32 位计数。但是在具有快速硬件乘法的机器上，有一种更有效的方法：

一旦我们有足够少的“元素”，**一个带有魔法常数的乘法可以将所有元素相加到顶部元素**中。在这种情况下，字节元素。乘法是通过左移和加法完成的，所以**结果****的乘法是. `x * 0x01010101``x + (x<<8) + (x<<16) + (x<<24)`** 我们的 8 位元素足够宽（并且保持足够小的计数），这不会产生进位*到*前 8 位。

**64 位版本**可以使用 0x0101010101010101 乘法器在 64 位整数中处理 8x 8 位元素，并使用`>>56`. 所以它不需要任何额外的步骤，只是更广泛的常数。当硬件指令未启用时，这就是 GCC`__builtin_popcountll`在 x86 系统上的用途。`popcnt`如果您可以为此使用内置函数或内部函数，请这样做以使编译器有机会进行特定于目标的优化。

* * *

### 对更宽的向量使用完整的 SIMD（例如计算整个数组）

这种按位 SWAR 算法可以并行化以一次在多个向量元素中完成，而不是在单个整数寄存器中完成，以在具有 SIMD 但没有可用 popcount 指令的 CPU 上加速。（例如，必须在任何 CPU 上运行的 x86-64 代码，而不仅仅是 Nehalem 或更高版本。）

但是，对 popcount 使用向量指令的最佳方法通常是使用变量混洗对每个字节并行执行 4 位的表查找。（4 位索引保存在向量寄存器中的 16 项表）。

在 Intel CPU 上，硬件 64 位 popcnt 指令的性能可以比[SSSE3`PSHUFB`位并行实现](http://wm.ite.pl/articles/sse-popcount.html)高出大约 2 倍，但前提[是您的编译器可以做到恰到好处](http://danluu.com/assembly-intrinsics/)。否则 SSE 可能会明显领先。较新的编译器版本知道 Intel 上的[popcnt 错误依赖](https://stackoverflow.com/a/25089720/224132) [问题](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=62011)。

*   [https://github.com/WojciechMula/sse-popcount](https://github.com/WojciechMula/sse-popcount) SSSE3、AVX2、AVX512BW、AVX512VBMI 或 AVX512 VPOPCNT 的最新 x86 SIMD 弹出计数。跨向量使用 Harley-Seal 来延迟元素内的 popcount。（还有 ARM NEON）
*   [使用 AVX-512 或 AVX-2 对大数据计数 1 位（人口计数）](https://stackoverflow.com/questions/50081465/counting-1-bits-population-count-on-large-data-using-avx-512-or-avx-2)
*   相关：[https](https://github.com/mklarqvist/positional-popcount) ://github.com/mklarqvist/positional-popcount - 多个 8、16、32 或 64 位整数的每个位位置的单独计数。（同样，x86 SIMD 包括 AVX-512 非常擅长这一点，`vpternlogd`让 Harley-Seal*非常*好。）

* * *

## 回答 #2

> 赞同：240
> 
> 时间：2008-09-20T19:23:05.220

一些语言以一种*可以*使用有效硬件支持（如果可用）的方式可移植地公开操作，否则一些库后备希望是体面的。

例如（来自[按语言的表](https://en.wikichip.org/wiki/population_count#Software_support)）：

*   C++ 有`std::bitset<>::count()`, 或 [C++20`std::popcount(T x)`](https://en.cppreference.com/w/cpp/numeric/popcount)
*   Java 有`java.lang.Integer.bitCount()`（也适用于 Long 或 BigInteger）
*   C#有`System.Numerics.BitOperations.PopCount()`
*   Python 有`int.bit_count()`（从 3.10 开始）

但是，并不是所有的编译器/库都能够在硬件支持可用时真正设法使用它。（尤其是 MSVC，即使使用使 std::popcount 内联为 x86 popcnt 的选项，它的 std::bitset::count 仍然总是使用查找表。这有望在未来的版本中改变。）

当可移植语言没有这个基本的位操作时，还要考虑编译器的内置函数。例如在 GNU C 中：

```
int __builtin_popcount (unsigned int x);
int __builtin_popcountll (unsigned long long x); 
```

[在最坏的情况下（不支持单指令硬件），编译器将生成对函数的调用（在当前的 GCC 中，该函数使用类似于此答案](https://stackoverflow.com/questions/109023/how-to-count-the-number-of-set-bits-in-a-32-bit-integer/109025#109025)的移位/和位破解，至少对于 x86 而言）。在最好的情况下，编译器会发出一条 cpu 指令来完成这项工作。（就像`*`or`/`运算符 - 如果可用，GCC 将使用硬件乘法或除法指令，否则将调用 libgcc 辅助函数。）或者更好的是，如果操作数是内联后的编译时常量，它可以进行常量传播得到一个编译时常数 popcount 结果。

GCC 内置程序甚至可以跨多个平台工作。Popcount 几乎已成为 x86 架构中的主流，因此现在开​​始使用内置命令是有意义的，这样您就可以重新编译以使其在编译时内联硬件指令`-mpopcnt`或包含该指令的内容（例如[https://godbolt.org/ z/Ma5e5a](https://godbolt.org/z/Ma5e5a) )。其他架构已经流行多年，但在 x86 世界中，仍然有一些古老的 Core 2 和类似的老式 AMD CPU 在使用中。

* * *

在 x86 上，您可以告诉编译器它可以假设支持`popcnt`with 指令`-mpopcnt`（也由 暗示`-msse4.2`）。请参阅[GCC x86 选项](https://gcc.gnu.org/onlinedocs/gcc/x86-Options.html)。 `-march=nehalem -mtune=skylake`（或`-march=`您希望代码采用和调整的任何 CPU）可能是一个不错的选择。在较旧的 CPU 上运行生成的二进制文件将导致非法指令错误。

要使二进制文件针对您构建它们的机器进行优化，请**使用`-march=native`** （使用 gcc、clang 或 ICC）。

[MSVC 为 x86`popcnt`指令](https://stackoverflow.com/questions/3849337/msvc-equivalent-to-builtin-popcount)提供了一个内在函数，但与 gcc 不同，它实际上是硬件指令的内在函数，并且需要硬件支持。

* * *

## 使用`std::bitset<>::count()`而不是内置

理论上，任何知道如何为目标 CPU 有效地进行 popcount 的编译器都应该通过 ISO C++ 公开该功能[`std::bitset<>`](http://en.cppreference.com/w/cpp/utility/bitset/count)。在实践中，在某些情况下，对于某些目标 CPU，使用位破解 AND/shift/ADD 可能会更好。

对于硬件 popcount 是可选扩展的目标架构（如 x86），并非所有编译器都具有`std::bitset`在可用时利用它的功能。例如，MSVC 无法`popcnt`在编译时启用支持，并且它`std::bitset<>::count`始终使用[table lookup](https://stackoverflow.com/questions/12324081/how-does-this-implementation-of-bitsetcount-work)，即使使用`/Ox /arch:AVX`（这意味着 SSE4.2，这反过来又意味着 popcnt 功能。）（更新：见下文；*确实*得到了 MSVC C++20`std::popcount`使用 x86 `popcnt`，但仍然不是它的 bitset<>::count。MSVC 可以通过更新其标准库头文件以在可用时使用 std::popcount 来解决这个问题。）

但至少你得到了一些可移植的东西，可以在任何地方工作，并且使用 gcc/clang 和正确的目标选项，你可以获得支持它的架构的硬件 popcount。

```
#include <bitset>
#include <limits>
#include <type_traits>

template<typename T>
//static inline  // static if you want to compile with -mpopcnt in one compilation unit but not others
typename std::enable_if<std::is_integral<T>::value,  unsigned >::type 
popcount(T x)
{
    static_assert(std::numeric_limits<T>::radix == 2, "non-binary type");

    // sizeof(x)*CHAR_BIT
    constexpr int bitwidth = std::numeric_limits<T>::digits + std::numeric_limits<T>::is_signed;
    // std::bitset constructor was only unsigned long before C++11\.  Beware if porting to C++03
    static_assert(bitwidth <= std::numeric_limits<unsigned long long>::digits, "arg too wide for std::bitset() constructor");

    typedef typename std::make_unsigned<T>::type UT;        // probably not needed, bitset width chops after sign-extension

    std::bitset<bitwidth> bs( static_cast<UT>(x) );
    return bs.count();
} 
```

请参阅Godbolt 编译器资源管理器上[来自 gcc、clang、icc 和 MSVC的 asm。](https://gcc.godbolt.org/#z:OYLghAFBqd5TKALEBjA9gEwKYFFMCWALugE4A0BIEAViAIzkDO6ArqatiAOQCkATAGYCAO1QAbVjgDUvQQGEARsSbYic3LwAMAQQHCxkmXPniCAWxUbteoaIlTsshUQCeAB2wB9IqQCGVoKaugD0IdIAqqrSREhOSOieAGas4uKuALTA6FjSTESYICDKRKpERRisIkQQAJTSFu7i2ObY1X5EBOgi0klk0n6kJf6krg3V2MDYpDEe2Ew2YdI6AG7oBJhMeQTAIhnYAB5EbYQiwNu72Jizngu6i%2BEA8j3AqKgDItcSfmfk0tgAR1YBBWfma1Ri6GkXi8imB4k6Ii87kSlWqaTqD2kmHQAHcREwNlwBuJcX5XFtWKotgA2AAsGRK0kS0x%2BmAyhIAXk4IN1pPTGcRpPIAApRWpYgBiZE4W25pHQ%2ByObUJfJI/IZJQAdFidOIWHlxHjptJccQEqwiNIkINMGTSE4Ue40UQ/vNPKgCGD0qbzQMYn5FM0Mkb0ABrVjuaSh9w60JPHoHAAcNL%2BuLI0ViCtYwCQ7ktzJ6OgAsgARaQAIVS4hx8oyST8lh9sR%2B0kE/EFVqdqGquv1ULJ%2BXm/oASrgABrSdwOpIEA5xvS6Y7mJodbAmNyeESNpwAFWs8fyHQI71EZhETmkSyPnVPSWkrjYpp%2BVvVGBXBGavti0gyK9REKiIWTjvu4n7HnyVRCnCVoiOgVrwXEpB3Dom5tDueQFEU6FBt4BBJCY%2BSFCABBMF4ojHMA/jiCY%2B5BEUoKSNgfzSFUhKXNcGhFGhsi6N2bDVBAu7SAcEr3AA7BWNjaAAnDeJ5eH4TCqKQNREUUIisK0pAKWYlilLRXEgP4hAHM4pZyOW/B/AI/BwXsyjbqMNzrvw/ASoIUn3N5MnXgQ3LoEkECiQAVPIAASOgjl4FYAJL7j5GAEscBzTuMVolGamA/pZmHEZp2m6RYgTyHRuBFIQwAqLI/AVnlGladMRX6QsChlUUpFeOxF6YHIXmLr54TqcUKhqNISX5KQrCoCQMyDoWPpsTsPXRt05yKNgfQOsKAhSbV9D0Fq0iVtg9pOPhU5kIi5zqvIu27Vogg2Mdx3yaginKdMNSZRsOUKLlw0FU1716SVS0catZyQ8ARmVSoNluYMN05L6MhbfVI2lGodTjd0k3TbNtkef10laDJaE4PeaHbq0GPmH4YbeODPWGfRIA8REdF1S9PNLNO6CKIGPpwbB2BXFcfwlGUqM/qgCTuFsfhJMcMzdUqxwEl0Iik3JWGY2UJg/dlSAaNIihMBAmHHu9qBKeoCicxowX1MTOsOkQ7A9ObWoupinnSeJFneYuOjM1cMTzEQyKogJUdMAkqkQPHV0DPUvCSdI7ue5dzqxxAfjE7Igc2GH1zHPk0e51UUcURAFGp0XdVZ6QPT8dX%2BeF%2BnQc6GEpcRxXbfVF4pcQH3BeN5najZ4PNQF31Rfd335dRzP9IQEaUMb%2Bc4/p03U8tznvtz55C9YjhzTkfe%2BSJFssSkb0CrmLjH7nsj/o4qwuEZBofdJSs0yqm1vGJekdK7vQ/rhCAECvw7wzs3VuMd27Hzql3UmId659HQEnBOVo/B/C3tDM2adJJu33j0HWh8847x8rtSh7dFCu10C9PqAdu5oKWDCCi9B%2BBJgaFsLKJoWw9D7gQre0k7D3noDVGkAgaTYk2qIK4EAYQAGVYoAC1cCPElF4WKAA5Xc3CkwwjEj3cIsQnBvQ%2BipK018FYxCQPfJIj9n5gVftICA6pug%2BhdA4pwRpcTWjBEkUxvdNYQ2XmA2ORjlHkWqEYhuu9J4ewPjPDu89UHByWLuRxWwbSoDDKaMgYYth8leKgEI3wzggAGMpRqZtRpWnvmCMkFJejiA6NIVo5gyCuBAM9F6SxYrRk2q%2BXJzICyBT8RHFcHTjhm2wLbKk50iBgG4FsEWl1VJC3XD5MI%2BEk7%2BWwIFZ2zhcDbACkFERa1oa1DTns8IL1umoHcK4CAsjzYIxpAcP4XJjlBXNnclhwd9D2CME4EwqBJqiBhkEEu4SVr5LDFE6uMTOHxJ4YkkhPlhpSzUCYIxptzbpP9j5Z5rz3n8BpJ86ReCLn/IgICwuV5wj2hEDCmpGBXkwo%2BMyRQNBFkIXvPZDIvgQRenEC5DxZofww1qrtUxsl4FmyYD7POjC9DF3uEIE4%2BEbDcFqOQcQPAACs3ByAiB4Foc16AeB3XlbVPIbAOAQqEPQc15RuDWrueQMMIBBBJi1FoGk4lxL0BkgGmkSYkxaC0HSI1PA6TmvMCAcSWgtT0BpDSdsWhM3Zv4Lm1MlqvU2p4OapgIAtDkE9d68gcBYAoFAp%2BaYlBqBNuaKQEA7hnT0maMAbNVbZwIgAdQRQVrzXvlaNUZ46Rx3kEIA6GaIJ5hzootgY1JbDVmHNvAQ1iROh4x4BkAA6t6X8jxBC/iIpZXYrB7r7XdcwZ1nAGBbtNea4t1ryC2u4CKY0pARTyA1PyLUggg0ePwMQfo%2BhGDCnQC/E0MHagevHT6uIfgcCdrqAm7gSbyApv4DJLUSZBCCBDTJEjZHxIUYDRaudP7y2Vurahw1fqA1BpDWGiNKZo2xvjRuwQH76NluY5uutiB63IDQPBtxLaqAQHbdMNAHSzhkZ%2BUOlWFbGVzsnW0IgM6%2BklvnQQRdnR/4VqM2ujdtbt0VsgHu9wB6CRHuvYIUst770VgOlego27LLbtQJ538p60jnsvX%2BbsEI/yDDlpZG0TBcTrvEOW59XBGBkmnY52KIg%2Bg8HdW%2B7gZq6NGZ/cmGkGR6TjRU%2BcMDciICQdmjVQQsH5AyebTMfQghkOie9Ya9DmHqCsf9YGmSdIkwmpkuJJMdITUxqozhvDKbSPEfoLm3NMkZLcJNVNmSxWv0MeYExmtBrxPwAgI2trHbW0Kcu0p4AdJRvkA0yO2JXgtCDfIGOozunp0iFnUZhdgrl0Wa/VZudNAgTTEM2B/gGbzXgmALEBg5BpzYBWI8flgrqAwje9QLknJmj0BNcG4Nm2TV0jG4IagVRKaKMKOvSYJx4D0HEoINNu2q3cHy3crdbREcoEYKj9HmOZrY5hO92gABFVgUP2yrZI4RmSNJHoza0MTjbJr6DUEIEwVchmTv48J8T5XNIycU5I9Tz4CierUD7UzyALO2dk3IJz7nPqEdI/oDzo1BAd32e/Y5rWFmT1noyBenzvU3MeYdV5qREWAJWmixwE2bn4uJbSCl9gL6vc4aK5%2B0t3AysVbpNIcp0g6RaiIyX%2BrhBGswb%2BK1hDHWhAmu68d93ibk3%2BpNcRmkE2c1K7I3SAtJq9sF8Y1W9vp2G3Sab9dxTnaTyoBZ09z8mmxe4%2Bw19r9P39N/cM1%2BwHS7zOromNZ81EOZejB4DDuHRq%2Bee5Rw6YXArRevYl4b7AROSem6J%2Bbqno8Vus4NuDOUwnwzO4kBaq2Lu5AXOBq3uHuAuT%2BaOGOr%2B5Q7%2B1ANA0usu/A8u7YG2yuggqu6uMkmu2upEeuZahqn%2B3%2BJuZulOlutOIBdu4BDukBa2MBcBPOvOZwnuCBvudm2G%2B6QeR6IWkqYe4Wrm7mmknm3m8ezoUW9Myelk24Zm2AmeLqr6ueQmJWPARelWS%2B0gLOEGte0GbqDet2zeRBbeLG5A/WSm2GG6i2/q6a7YggSuE23CbO1GY%2B36ImFak%2BthbGYGY2fej0SYrO/AkBYaOGgmvhB2U%2Bkm52s%2BsmFA8mC%2Bym4aXg9Iq%2Bw6yEo6Om8GU6e%2B/2h%2BJmQOJ%2BlmZ%2BqGPufuQhgeh63AIQjwZkIQMWKAOgAAauOBodnuQBlvplljlj%2BvltofEXoSmMXsKAADJGEyTSBQHiTSAji7jHomFQZWEtaWFNbuQoabpDY8JagU7bbiQhruHTaQF94LY6H7b%2BFHa2Ebr8Bd6rZVr55%2BHcB7G9bkD/zIRawgB0hAA%3D)

x86-64`gcc -O3 -std=gnu++11 -mpopcnt`发出这个：

```
unsigned test_short(short a) { return popcount(a); }
    movzx   eax, di      # note zero-extension, not sign-extension
    popcnt  rax, rax
    ret

unsigned test_int(int a) { return popcount(a); }
    mov     eax, edi
    popcnt  rax, rax        # unnecessary 64-bit operand size
    ret

unsigned test_u64(unsigned long long a) { return popcount(a); }
    xor     eax, eax     # gcc avoids false dependencies for Intel CPUs
    popcnt  rax, rdi
    ret 
```

PowerPC64`gcc -O3 -std=gnu++11`发出（对于`int`arg 版本）：

```
 rldicl 3,3,0,32     # zero-extend from 32 to 64-bit
    popcntd 3,3         # popcount
    blr 
```

这个源代码根本不是 x86 特定或 GNU 特定的，但只能与 gcc/clang/icc 很好地编译，至少在针对 x86（包括 x86-64）时是这样。

另请注意，gcc 对于没有单指令 popcount 的体系结构的回退是一次一个字节的表查找。[例如，这对 ARM](https://stackoverflow.com/questions/15736602/fastest-way-to-count-number-of-1s-in-a-register-arm-assembly)来说并不好。

## [C++20 有`std::popcount(T)`](https://en.cppreference.com/w/cpp/numeric/popcount)

不幸的是，当前的 libstdc++ 头文件在开始时使用特殊情况定义了它，`if(x==0) return 0;`当为 x86 编译时，clang 不会优化：

```
#include <bit>
int bar(unsigned x) {
    return std::popcount(x);
} 
```

铿锵声 11.0.1 `-O3 -std=gnu++20 -march=nehalem` ( [https://godbolt.org/z/arMe5a](https://godbolt.org/z/arMe5a) )

```
# clang 11
    bar(unsigned int):                                # @bar(unsigned int)
        popcnt  eax, edi
        cmove   eax, edi         # redundant: if popcnt result is 0, return the original 0 instead of the popcnt-generated 0...
        ret 
```

但是 GCC 编译得很好：

```
# gcc 10
        xor     eax, eax         # break false dependency on Intel SnB-family before Ice Lake.
        popcnt  eax, edi
        ret 
```

甚至 MSVC 也能很好地使用它，只要您使用`-arch:AVX` 或更高版本（并使用 启用 C++20 `-std:c++latest`）。[https://godbolt.org/z/7K4Gef](https://godbolt.org/z/7K4Gef)

```
int bar(unsigned int) PROC                                 ; bar, COMDAT
        popcnt  eax, ecx
        ret     0
int bar(unsigned int) ENDP                                 ; bar 
```

* * *

## 回答 #3

> 赞同：205
> 
> 时间：2008-09-21T01:14:03.287

在我看来，“最佳”解决方案是另一个程序员（或两年后的原始程序员）可以阅读的解决方案，而无需大量评论。你可能想要一些已经提供的最快或最聪明的解决方案，但我更喜欢可读性而不是聪明。

```
unsigned int bitCount (unsigned int value) {
    unsigned int count = 0;
    while (value > 0) {           // until all bits are zero
        if ((value & 1) == 1)     // check lower bit
            count++;
        value >>= 1;              // shift bits, removing lower bit
    }
    return count;
} 
```

如果您想要更快的速度（并假设您记录它以帮助您的继任者），您可以使用表查找：

```
// Lookup table for fast calculation of bits set in 8-bit unsigned char.

static unsigned char oneBitsInUChar[] = {
//  0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F (<- n)
//  =====================================================
    0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4, // 0n
    1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5, // 1n
    : : :
    4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8, // Fn
};

// Function for fast calculation of bits set in 16-bit unsigned short.

unsigned char oneBitsInUShort (unsigned short x) {
    return oneBitsInUChar [x >>    8]
         + oneBitsInUChar [x &  0xff];
}

// Function for fast calculation of bits set in 32-bit unsigned int.

unsigned char oneBitsInUInt (unsigned int x) {
    return oneBitsInUShort (x >>     16)
         + oneBitsInUShort (x &  0xffff);
} 
```

尽管这些依赖于特定的数据类型大小，所以它们不是那么便携。但是，由于许多性能优化无论如何都不是可移植的，这可能不是问题。如果您想要可移植性，我会坚持使用可读的解决方案。

* * *

## 回答 #4

> 赞同：103
> 
> 时间：2008-09-20T19:38:00.427

[来自 Hacker's Delight，p。66、图5-2](http://books.google.com/books?id=iBNKMspIlqEC&pg=PA66)

```
int pop(unsigned x)
{
    x = x - ((x >> 1) & 0x55555555);
    x = (x & 0x33333333) + ((x >> 2) & 0x33333333);
    x = (x + (x >> 4)) & 0x0F0F0F0F;
    x = x + (x >> 8);
    x = x + (x >> 16);
    return x & 0x0000003F;
} 
```

在 ~20-ish 指令中执行（依赖于arch），没有分支。

[黑客的喜悦](http://books.google.com/books?id=iBNKMspIlqEC) *是*令人愉快的！强烈推荐。

* * *

## 回答 #5

> 赞同：81
> 
> 时间：2013-04-12T19:14:12.370

我认为最快的方法——不使用查找表和*popcount——*如下。它仅通过 12 次操作计算设置位。

```
int popcount(int v) {
    v = v - ((v >> 1) & 0x55555555);                // put count of each 2 bits into those 2 bits
    v = (v & 0x33333333) + ((v >> 2) & 0x33333333); // put count of each 4 bits into those 4 bits  
    return c = ((v + (v >> 4) & 0xF0F0F0F) * 0x1010101) >> 24;
} 
```

它之所以有效，是因为您可以通过分成两半来计算设置位的总数，计算两半中设置位的数量，然后将它们相加。也称为`Divide and Conquer`范式。让我们详细了解一下。。

```
v = v - ((v >> 1) & 0x55555555); 
```

两位中的位数可以是`0b00`，`0b01`或`0b10`。让我们尝试在 2 位上解决这个问题..

```
 ---------------------------------------------
 |   v    |   (v >> 1) & 0b0101   |  v - x   |
 ---------------------------------------------
   0b00           0b00               0b00   
   0b01           0b00               0b01     
   0b10           0b01               0b01
   0b11           0b01               0b10 
```

这是所需要的：最后一列显示每两位对中设置位的计数。如果这两位数字是`>= 2 (0b10)`然后`and`产生`0b01`，否则它产生`0b00`。

```
v = (v & 0x33333333) + ((v >> 2) & 0x33333333); 
```

这句话应该很容易理解。在第一次操作之后，我们得到了每两位中设置位的计数，现在我们将每 4 位中的计数相加。

```
v & 0b00110011         //masks out even two bits
(v >> 2) & 0b00110011  // masks out odd two bits 
```

然后我们总结上面的结果，给出 4 位中设置位的总数。最后一个陈述是最棘手的。

```
c = ((v + (v >> 4) & 0xF0F0F0F) * 0x1010101) >> 24; 
```

让我们进一步分解...

```
v + (v >> 4) 
```

它类似于第二个语句；我们改为以 4 个一组来计算设置的位。我们知道——由于我们之前的操作——每个半字节都有设置位的计数。让我们看一个例子。假设我们有 byte `0b01000010`。这意味着第一个半字节设置了 4 位，第二个半字节设置了 2 位。现在我们将这些半字节加在一起。

```
0b01000010 + 0b01000000 
```

它在第一个半字节中为我们提供了一个字节中设置位的计数，`0b01100010`因此我们屏蔽了该数字中所有字节的最后四个字节（丢弃它们）。

```
0b01100010 & 0xF0 = 0b01100000 
```

现在每个字节都有设置位的计数。我们需要把它们加在一起。诀窍是将结果乘以`0b10101010`具有有趣属性的结果。如果我们的数字有四个字节 ，`A B C D`它将产生一个包含这些字节的新数字`A+B+C+D B+C+D C+D D`。一个 4 字节的数字最多可以设置 32 位，可以表示为`0b00100000`.

我们现在需要的是第一个字节，它具有所有字节中所有设置位的总和，我们得到它 `>> 24`。该算法是为`32 bit`单词设计的，但可以很容易地针对`64 bit`单词进行修改。

* * *

## 回答 #6

> 赞同：62
> 
> 时间：2008-09-20T19:14:39.733

如果您碰巧使用的是 Java，内置方法`Integer.bitCount`将执行此操作。

* * *

## 回答 #7

> 赞同：58
> 
> 时间：2008-09-25T02:46:32.720

我感到无聊，并为三种方法的十亿次迭代计时。编译器是 gcc -O3。CPU 就是他们在第一代 Macbook Pro 中放入的任何东西。

最快的是以下，为 3.7 秒：

```
static unsigned char wordbits[65536] = { bitcounts of ints between 0 and 65535 };
static int popcount( unsigned int i )
{
    return( wordbits[i&0xFFFF] + wordbits[i>>16] );
} 
```

第二名是相同的代码，但查找的是 4 个字节而不是 2 个半字。这花了大约 5.5 秒。

第三名是位旋转的“横向加法”方法，耗时 8.6 秒。

第四名是 GCC 的 __builtin_popcount()，仅用了 11 秒。

一次一位地计数的方法要慢得多，我厌倦了等待它完成。

因此，如果您最关心性能，请使用第一种方法。如果您关心，但不足以在其上花费 64Kb 的 RAM，请使用第二种方法。否则，请使用可读（但速度慢）的一次一位的方法。

很难想到您想要使用位旋转方法的情况。

编辑：类似的结果[在这里](http://www.dalkescientific.com/writings/diary/archive/2008/07/03/hakmem_and_other_popcounts.html)。

* * *

## 回答 #8

> 赞同：38
> 
> 时间：2012-08-05T12:47:03.247

```
unsigned int count_bit(unsigned int x)
{
  x = (x & 0x55555555) + ((x >> 1) & 0x55555555);
  x = (x & 0x33333333) + ((x >> 2) & 0x33333333);
  x = (x & 0x0F0F0F0F) + ((x >> 4) & 0x0F0F0F0F);
  x = (x & 0x00FF00FF) + ((x >> 8) & 0x00FF00FF);
  x = (x & 0x0000FFFF) + ((x >> 16)& 0x0000FFFF);
  return x;
} 
```

让我解释一下这个算法。

该算法基于分而治之算法。假设有一个 8 位整数 213（二进制 11010101），算法是这样工作的（每次合并两个相邻块）：

```
+-------------------------------+
| 1 | 1 | 0 | 1 | 0 | 1 | 0 | 1 |  <- x
|  1 0  |  0 1  |  0 1  |  0 1  |  <- first time merge
|    0 0 1 1    |    0 0 1 0    |  <- second time merge
|        0 0 0 0 0 1 0 1        |  <- third time ( answer = 00000101 = 5)
+-------------------------------+ 
```

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2008-09-20T19:10:30.057

为什么不迭代地除以 2？

```
计数 = 0
而 n > 0
  如果 (n % 2) == 1
    计数 += 1
  n /= 2  

```

我同意这不是最快的，但“最好”有点模棱两可。我会争辩说，“最好”应该有一个清晰的元素

* * *

## 回答 #10

> 赞同：29
> 
> 时间：2009-10-02T21:34:54.937

这是有助于了解您的微架构的问题之一。我刚刚使用 C++ 内联对使用 -O3 编译的 gcc 4.3.3 下的两个变体进行计时，以消除函数调用开销，十亿次迭代，保持所有计数的运行总和以确保编译器不会删除任何重要的东西，使用 rdtsc 进行计时（时钟周期精确）。

```
内联 int pop2（无符号 x，无符号 y）
{
    x = x - ((x >> 1) & 0x55555555);
    y = y - ((y >> 1) & 0x55555555);
    x = (x & 0x33333333) + ((x >> 2) & 0x33333333);
    y = (y & 0x33333333) + ((y >> 2) & 0x33333333);
    x = (x + (x >> 4)) & 0x0F0F0F0F;
    y = (y + (y >> 4)) & 0x0F0F0F0F;
    x = x + (x >> 8);
    y = y + (y >> 8);
    x = x + (x >> 16);
    y = y + (y >> 16);
    返回 (x+y) & 0x000000FF;
}

```

未修改的 Hacker's Delight 耗时 12.2 gigacycles。我的并行版本（计算比特数的两倍）以 13.0 千兆周期运行。在 2.4GHz Core Duo 上，两者总共耗时 10.5 秒。25 gigacycles = 在这个时钟频率下刚刚超过 10 秒，所以我相信我的时间安排是正确的。

这与指令依赖链有关，这对这个算法非常不利。通过使用一对 64 位寄存器，我几乎可以再次将速度提高一倍。事实上，如果我很聪明，早一点添加 x+ya，我就可以减少一些班次。进行了一些小调整的 64 位版本的结果差不多，但位数又是原来的两倍。

使用 128 位 SIMD 寄存器，又是两倍，SSE 指令集通常也有巧妙的捷径。

没有理由让代码特别透明。界面简洁，算法多处可在线引用，可进行综合单元测试。偶然发现它的程序员甚至可能学到一些东西。这些位操作在机器级别是非常自然的。

好的，我决定对调整后的 64 位版本进行基准测试。对于这个 sizeof(unsigned long) == 8

```
内联 int pop2（无符号长 x，无符号长 y）
{
    x = x - ((x >> 1) & 0x5555555555555555);
    y = y - ((y >> 1) & 0x5555555555555555);
    x = (x & 0x3333333333333333) + ((x >> 2) & 0x3333333333333333);
    y = (y & 0x3333333333333333) + ((y >> 2) & 0x3333333333333333);
    x = (x + (x >> 4)) & 0x0F0F0F0F0F0F0F0F;
    y = (y + (y >> 4)) & 0x0F0F0F0F0F0F0F0F;
    x = x + y;
    x = x + (x >> 8);
    x = x + (x >> 16);
    x = x + (x >> 32);
    返回 x & 0xFF;
}

```

这看起来是对的（不过我没有仔细测试）。现在的时间是 10.70 gigacycles / 14.1 gigacycles。后来的数字总计 1280 亿位，对应于这台机器上经过的 5.9 秒。非并行版本加快了一点点，因为我在 64 位模式下运行，并且它喜欢 64 位寄存器，略好于 32 位寄存器。

让我们看看这里是否有更多的 OOO 流水线。这涉及到更多，所以我实际上进行了一些测试。每一项单独总和为 64，所有组合总和为 256。

```
inline int pop4(unsigned long x, unsigned long y,
                unsigned long u, unsigned long v)
{
  枚举 { m1 = 0x5555555555555555,
         m2 = 0x3333333333333333,
         m3 = 0x0F0F0F0F0F0F0F0F，
         m4 = 0x000000FF000000FF };

    x = x - ((x >> 1) & m1);
    y = y - ((y >> 1) & m1);
    u = u - ((u >> 1) & m1);
    v = v - ((v >> 1) & m1);
    x = (x & m2) + ((x >> 2) & m2);
    y = (y & m2) + ((y >> 2) & m2);
    u = (u & m2) + ((u >> 2) & m2);
    v = (v & m2) + ((v >> 2) & m2);
    x = x + y;
    u = u + v；
    x = (x & m3) + ((x >> 4) & m3);
    u = (u & m3) + ((u >> 4) & m3);
    x = x + u;
    x = x + (x >> 8);
    x = x + (x >> 16);
    x = x & m4;
    x = x + (x >> 32);
    返回 x & 0x000001FF;
}

```

我兴奋了一会儿，但事实证明 gcc 正在使用 -O3 玩内联技巧，即使我在某些测试中没有使用 inline 关键字。当我让 gcc 发挥作用时，对 pop4() 的十亿次调用需要 12.56 个千兆周期，但我确定它是将参数折叠为常量表达式。一个更现实的数字似乎是 19.6gc，另外 30% 的加速。我的测试循环现在看起来像这样，确保每个参数都足够不同以阻止 gcc 玩诡计。

```
   hitime b4 = rdtsc();
   for (无符号长 i = 10L * 1000*1000*1000; i < 11L * 1000*1000*1000; ++i)
      总和 += pop4 (i, i^1, ~i, i|1);
   hitime e4 = rdtsc();

```

在 8.17 秒内总计 2560 亿位。在 16 位表查找中以 3200 万位为基准，运行时间为 1.02 秒。不能直接比较，因为另一个bench没有给出时钟速度，但是看起来我已经把64KB table edition的鼻涕给拍了出来，这首先是一个悲惨的使用L1缓存。

更新：决定做显而易见的事情并通过添加四个重复的行来创建 pop6()。得出 22.8gc，在 9.5 秒内总计 3840 亿位。所以现在还有 20% 的时间为 800 毫秒，用于 320 亿位。

* * *

## 回答 #11

> 赞同：27
> 
> 时间：2013-12-20T06:55:35.740

当您写出位模式时，Hacker's Delight 位旋转变得更加清晰。

```
unsigned int bitCount(unsigned int x)
{
  x = ((x >> 1) & 0b01010101010101010101010101010101)
     + (x       & 0b01010101010101010101010101010101);
  x = ((x >> 2) & 0b00110011001100110011001100110011)
     + (x       & 0b00110011001100110011001100110011); 
  x = ((x >> 4) & 0b00001111000011110000111100001111)
     + (x       & 0b00001111000011110000111100001111); 
  x = ((x >> 8) & 0b00000000111111110000000011111111)
     + (x       & 0b00000000111111110000000011111111); 
  x = ((x >> 16)& 0b00000000000000001111111111111111)
     + (x       & 0b00000000000000001111111111111111); 
  return x;
} 
```

第一步将偶数位与奇数位相加，在每两个中产生一个位的总和。其他步骤将高阶块添加到低阶块，将块大小一直增加一倍，直到最终计数占据整个 int。

* * *

## 回答 #12

> 赞同：23
> 
> 时间：2008-09-22T03:55:59.800

对于 2 ^(32)查找表和单独遍历每个位之间的快乐媒介：

```
int bitcount(unsigned int num){
    int count = 0;
    static int nibblebits[] =
        {0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4};
    for(; num != 0; num >>= 4)
        count += nibblebits[num & 0x0f];
    return count;
} 
```

来自[http://ctips.pbwiki.com/CountBits](http://ctips.pbwiki.com/CountBits)

* * *

## 回答 #13

> 赞同：19
> 
> 时间：2014-01-14T12:53:05.003

这可以在 中完成`O(k)`，其中`k`是设置的位数。

```
int NumberOfSetBits(int n)
{
    int count = 0;

    while (n){
        ++ count;
        n = (n - 1) & n;
    }

    return count;
} 
```

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2012-10-19T12:31:03.940

这不是最快或最好的解决方案，但我在我的方式中发现了同样的问题，我开始思考和思考。最后我意识到如果你从数学方面得到问题，然后画一个图，然后你会发现它是一个有一些周期部分的函数，然后你就会意识到周期之间的差异......所以干得好：

```
unsigned int f(unsigned int x)
{
    switch (x) {
        case 0:
            return 0;
        case 1:
            return 1;
        case 2:
            return 1;
        case 3:
            return 2;
        default:
            return f(x/4) + f(x%4);
    }
} 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2008-09-23T09:20:15.830

您正在寻找的函数通常称为二进制数的“横向和”或“人口计数”。Knuth 在前分册 1A，pp11-12 中讨论了它（尽管在第 2 卷，4.6.3-(7) 中有一个简短的参考。）

*经典轨迹*是 Peter Wegner的文章“A Technique for Counting Ones in a Binary Computer”，来自[*ACM 通讯*，第 3 卷 (1960) 第 5 期，第 322 页](http://cacm.acm.org/magazines/1960/5/14709-a-technique-for-counting-ones-in-a-binary-computer/abstract)。他在那里给出了两种不同的算法，一种针对预期为“稀疏”的数字进行了优化（即，有少量的数字），另一种针对相反的情况。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2016-06-01T02:16:13.770

我认为[Brian Kernighan 的](https://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetKernighan)方法也会很有用......它会经历与设置位一样多的迭代。因此，如果我们有一个仅设置了高位的 32 位字，那么它只会通过循环一次。

```
int countSetBits(unsigned int n) { 
    unsigned int n; // count the number of bits set in n
    unsigned int c; // c accumulates the total bits set in n
    for (c=0;n>0;n=n&(n-1)) c++; 
    return c; 
} 
```

> 1988 年出版的 C 程序设计语言第 2 版。（由 Brian W. Kernighan 和 Dennis M. Ritchie 撰写）在练习 2-9 中提到了这一点。2006 年 4 月 19 日，Don Knuth 向我指出，这种方法“由 Peter Wegner 在 CACM 3 (1960), 322 中首次发表。（也由 Derrick Lehmer 独立发现，并于 1964 年在 Beckenbach 编辑的书中发表。）”

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2017-11-08T14:50:34.043

```
 private int get_bits_set(int v)
    {
      int c; // c accumulates the total bits set in v
        for (c = 0; v>0; c++)
        {
            v &= v - 1; // clear the least significant bit set
        }
        return c;
    } 
```

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2010-05-07T04:51:57.037

几个未解决的问题：-

1.  如果这个数字是负数呢？
2.  如果数字是 1024 ，那么“迭代除以 2”方法将迭代 10 次。

我们可以修改算法以支持负数，如下所示：-

```
count = 0
while n != 0
if ((n % 2) == 1 || (n % 2) == -1
    count += 1
  n /= 2  
return count 
```

现在要克服第二个问题，我们可以编写如下算法：-

```
int bit_count(int num)
{
    int count=0;
    while(num)
    {
        num=(num)&(num-1);
        count++;
    }
    return count;
} 
```

如需完整参考，请参阅：

[http://goursaha.freeoda.com/Miscellaneous/IntegerBitCount.html](http://goursaha.freeoda.com/Miscellaneous/IntegerBitCount.html)

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2012-05-05T07:12:53.040

我使用下面的代码更直观。

```
int countSetBits(int n) {
    return !n ? 0 : 1 + countSetBits(n & (n-1));
} 
```

逻辑：n & (n-1) 重置 n 的最后一个设置位。

PS：我知道这不是 O(1) 解决方案，尽管它是一个有趣的解决方案。

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2008-09-20T19:31:08.743

“最佳算法”是什么意思？短代码还是禁食代码？您的代码看起来非常优雅，并且执行时间恒定。代码也很短。

但是，如果速度是主要因素而不是代码大小，那么我认为以下可以更快：

```
 static final int[] BIT_COUNT = { 0, 1, 1, ... 256 values with a bitsize of a byte ... };
        static int bitCountOfByte( int value ){
            return BIT_COUNT[ value & 0xFF ];
        }

        static int bitCountOfInt( int value ){
            return bitCountOfByte( value ) 
                 + bitCountOfByte( value >> 8 ) 
                 + bitCountOfByte( value >> 16 ) 
                 + bitCountOfByte( value >> 24 );
        } 
```

我认为这对于 64 位值不会更快，但 32 位值可以更快。

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2010-06-11T21:40:40.173

我在 1990 年左右为 RISC 机器编写了一个快速位计数宏。它不使用高级算术（乘法、除法、%）、内存获取（太慢）、分支（太慢），但它确实假设 CPU 有一个32 位桶形移位器（换句话说，>> 1 和 >> 32 占用相同数量的周期。）它假设小常数（例如 6、12、24）无需任何成本加载到寄存器或存储在临时和反复使用。

有了这些假设，在大多数 RISC 机器上，它在大约 16 个周期/指令中计算 32 位。请注意，15 条指令/周期接近于周期或指令数的下限，因为似乎至少需要 3 条指令（掩码、移位、运算符）才能将加数数量减半，因此 log_2(32) = 5, 5 x 3 = 15 指令是准下限。

```
#define BitCount(X,Y)           \
                Y = X - ((X >> 1) & 033333333333) - ((X >> 2) & 011111111111); \
                Y = ((Y + (Y >> 3)) & 030707070707); \
                Y =  (Y + (Y >> 6)); \
                Y = (Y + (Y >> 12) + (Y >> 24)) & 077; 
```

这是第一步也是最复杂的步骤的秘密：

```
input output
AB    CD             Note
00    00             = AB
01    01             = AB
10    01             = AB - (A >> 1) & 0x1
11    10             = AB - (A >> 1) & 0x1 
```

因此，如果我取上面的第一列 (A)，将其右移 1 位，然后从 AB 中减去它，我得到输出 (CD)。对 3 位的扩展类似；如果您愿意，可以使用上面我的 8 行布尔表来检查它。

*   唐·吉利斯

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2012-04-04T04:25:21.287

如果您使用 C++，另一种选择是使用模板元编程：

```
// recursive template to sum bits in an int
template <int BITS>
int countBits(int val) {
        // return the least significant bit plus the result of calling ourselves with
        // .. the shifted value
        return (val & 0x1) + countBits<BITS-1>(val >> 1);
}

// template specialisation to terminate the recursion when there's only one bit left
template<>
int countBits<1>(int val) {
        return val & 0x1;
} 
```

用法是：

```
// to count bits in a byte/char (this returns 8)
countBits<8>( 255 )

// another byte (this returns 7)
countBits<8>( 254 )

// counting bits in a word/short (this returns 1)
countBits<16>( 256 ) 
```

您当然可以进一步扩展此模板以使用不同的类型（甚至自动检测位大小），但为了清楚起见，我保持简单。

**编辑：忘了提到这很好，因为它*应该*在任何 C++ 编译器中工作，并且如果将常量值用于位计数，它基本上只是为您展开循环**（换句话说，我很确定这是最快的通用方法你会找到）

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2017-08-23T17:31:11.697

你能做的是

```
while(n){
    n=n&(n-1);
    count++;
} 
```

这背后的逻辑是 n-1 的位从 n 的最右边设置位反转。如果 n=6 即 110 那么 5 是 101 这些位从 n 的最右边设置位反转。因此，如果我们和这两个我们将在每次迭代中将最右边的位设为 0，并且总是转到下一个最右边的设置位。因此，计算设置位。当每个位都设置时，最差的时间复杂度将是 O(logn)。

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2008-09-23T01:29:53.683

我特别喜欢财富文件中的这个例子：

```
#define BITCOUNT(x) (((BX_(x)+(BX_(x)>>4)) & 0x0F0F0F0F) % 255)
#define BX_(x) ((x) - (((x)>>1)&0x77777777)
                             - (((x)>>2)&0x33333333)
                             - (((x)>>3)&0x11111111))

```

我最喜欢它，因为它太漂亮了！

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2010-12-10T20:40:53.250

Java JDK1.5

整数.bitCount(n);

其中 n 是要计算其 1 的数字。

还要检查，

```
Integer.highestOneBit(n);
Integer.lowestOneBit(n);
Integer.numberOfLeadingZeros(n);
Integer.numberOfTrailingZeros(n);

//Beginning with the value 1, rotate left 16 times
     n = 1;
         for (int i = 0; i < 16; i++) {
            n = Integer.rotateLeft(n, 1);
            System.out.println(n);
         } 
```

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2014-01-30T11:32:25.820

快速 C# 解决方案，使用预先计算的字节位计数表，并在输入大小上进行分支。

```
public static class BitCount
{
    public static uint GetSetBitsCount(uint n)
    {
        var counts = BYTE_BIT_COUNTS;
        return n <= 0xff ? counts[n]
             : n <= 0xffff ? counts[n & 0xff] + counts[n >> 8]
             : n <= 0xffffff ? counts[n & 0xff] + counts[(n >> 8) & 0xff] + counts[(n >> 16) & 0xff]
             : counts[n & 0xff] + counts[(n >> 8) & 0xff] + counts[(n >> 16) & 0xff] + counts[(n >> 24) & 0xff];
    }

    public static readonly uint[] BYTE_BIT_COUNTS = 
    {
        0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,
        1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
        1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
        1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
        2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
        3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
        3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
        4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8
    };
} 
```

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2016-02-15T14:33:01.543

我发现使用 SIMD 指令（SSSE3 和 AVX2）在数组中实现位计数。与使用 __popcnt64 内在函数相比，它的性能要好 2-2.5 倍。

SSSE3 版本：

```
#include <smmintrin.h>
#include <stdint.h>

const __m128i Z = _mm_set1_epi8(0x0);
const __m128i F = _mm_set1_epi8(0xF);
//Vector with pre-calculated bit count:
const __m128i T = _mm_setr_epi8(0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4);

uint64_t BitCount(const uint8_t * src, size_t size)
{
    __m128i _sum =  _mm128_setzero_si128();
    for (size_t i = 0; i < size; i += 16)
    {
        //load 16-byte vector
        __m128i _src = _mm_loadu_si128((__m128i*)(src + i));
        //get low 4 bit for every byte in vector
        __m128i lo = _mm_and_si128(_src, F);
        //sum precalculated value from T
        _sum = _mm_add_epi64(_sum, _mm_sad_epu8(Z, _mm_shuffle_epi8(T, lo)));
        //get high 4 bit for every byte in vector
        __m128i hi = _mm_and_si128(_mm_srli_epi16(_src, 4), F);
        //sum precalculated value from T
        _sum = _mm_add_epi64(_sum, _mm_sad_epu8(Z, _mm_shuffle_epi8(T, hi)));
    }
    uint64_t sum[2];
    _mm_storeu_si128((__m128i*)sum, _sum);
    return sum[0] + sum[1];
} 
```

AVX2 版本：

```
#include <immintrin.h>
#include <stdint.h>

const __m256i Z = _mm256_set1_epi8(0x0);
const __m256i F = _mm256_set1_epi8(0xF);
//Vector with pre-calculated bit count:
const __m256i T = _mm256_setr_epi8(0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4, 
                                   0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4);

uint64_t BitCount(const uint8_t * src, size_t size)
{
    __m256i _sum =  _mm256_setzero_si256();
    for (size_t i = 0; i < size; i += 32)
    {
        //load 32-byte vector
        __m256i _src = _mm256_loadu_si256((__m256i*)(src + i));
        //get low 4 bit for every byte in vector
        __m256i lo = _mm256_and_si256(_src, F);
        //sum precalculated value from T
        _sum = _mm256_add_epi64(_sum, _mm256_sad_epu8(Z, _mm256_shuffle_epi8(T, lo)));
        //get high 4 bit for every byte in vector
        __m256i hi = _mm256_and_si256(_mm256_srli_epi16(_src, 4), F);
        //sum precalculated value from T
        _sum = _mm256_add_epi64(_sum, _mm256_sad_epu8(Z, _mm256_shuffle_epi8(T, hi)));
    }
    uint64_t sum[4];
    _mm256_storeu_si256((__m256i*)sum, _sum);
    return sum[0] + sum[1] + sum[2] + sum[3];
} 
```

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2016-11-03T21:02:05.770

我总是在竞争性编程中使用它，它易于编写且高效：

```
#include <bits/stdc++.h>

using namespace std;

int countOnes(int n) {
    bitset<32> b(n);
    return b.count();
} 
```

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2019-07-31T07:44:33.490

**C++20`std::popcount`**

以下提案已合并[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p0553r4.html](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p0553r4.html)并应将其添加到`<bit>`标题中。

我希望用法如下：

```
#include <bit>
#include <iostream>

int main() {
    std::cout << std::popcount(0x55) << std::endl;
} 
```

当支持到达 GCC 时，我会尝试一下，GCC 9.1.0`g++-9 -std=c++2a`仍然不支持它。

该提案说：

> 标题：`<bit>`
> 
> ```
> namespace std {
> 
>   // 25.5.6, counting
>   template<class T>
>     constexpr int popcount(T x) noexcept; 
> ```

和：

> ```
> template<class T>
>   constexpr int popcount(T x) noexcept; 
> ```
> 
> 约束：T 是无符号整数类型（3.9.1 [basic.fundamental]）。
> 
> 返回： x 值中 1 的位数。

`std::rotl`并且`std::rotr`还被添加以进行循环位旋转：[C++ 中循环移位（旋转）操作的最佳实践](https://stackoverflow.com/questions/776508/best-practices-for-circular-shift-rotate-operations-in-c/57285854#57285854)

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2011-03-29T08:04:29.253

这是一个可移植模块 (ANSI-C)，它可以在任何架构上对您的每个算法进行基准测试。

你的 CPU 有 9 位字节？没问题 :-) 目前它实现了 2 种算法，K&R 算法和逐字节查找表。查找表平均比 K&R 算法快 3 倍。如果有人能想出一种方法使“Hacker's Delight”算法可移植，请随意添加。

```
#ifndef _BITCOUNT_H_
#define _BITCOUNT_H_

/* Return the Hamming Wieght of val, i.e. the number of 'on' bits. */
int bitcount( unsigned int );

/* List of available bitcount algorithms.  
 * onTheFly:    Calculate the bitcount on demand.
 *
 * lookupTalbe: Uses a small lookup table to determine the bitcount.  This
 * method is on average 3 times as fast as onTheFly, but incurs a small
 * upfront cost to initialize the lookup table on the first call.
 *
 * strategyCount is just a placeholder. 
 */
enum strategy { onTheFly, lookupTable, strategyCount };

/* String represenations of the algorithm names */
extern const char *strategyNames[];

/* Choose which bitcount algorithm to use. */
void setStrategy( enum strategy );

#endif 
```

.

```
#include <limits.h>

#include "bitcount.h"

/* The number of entries needed in the table is equal to the number of unique
 * values a char can represent which is always UCHAR_MAX + 1*/
static unsigned char _bitCountTable[UCHAR_MAX + 1];
static unsigned int _lookupTableInitialized = 0;

static int _defaultBitCount( unsigned int val ) {
    int count;

    /* Starting with:
     * 1100 - 1 == 1011,  1100 & 1011 == 1000
     * 1000 - 1 == 0111,  1000 & 0111 == 0000
     */
    for ( count = 0; val; ++count )
        val &= val - 1;

    return count;
}

/* Looks up each byte of the integer in a lookup table.
 *
 * The first time the function is called it initializes the lookup table.
 */
static int _tableBitCount( unsigned int val ) {
    int bCount = 0;

    if ( !_lookupTableInitialized ) {
        unsigned int i;
        for ( i = 0; i != UCHAR_MAX + 1; ++i )
            _bitCountTable[i] =
                ( unsigned char )_defaultBitCount( i );

        _lookupTableInitialized = 1;
    }

    for ( ; val; val >>= CHAR_BIT )
        bCount += _bitCountTable[val & UCHAR_MAX];

    return bCount;
}

static int ( *_bitcount ) ( unsigned int ) = _defaultBitCount;

const char *strategyNames[] = { "onTheFly", "lookupTable" };

void setStrategy( enum strategy s ) {
    switch ( s ) {
    case onTheFly:
        _bitcount = _defaultBitCount;
        break;
    case lookupTable:
        _bitcount = _tableBitCount;
        break;
    case strategyCount:
        break;
    }
}

/* Just a forwarding function which will call whichever version of the
 * algorithm has been selected by the client 
 */
int bitcount( unsigned int val ) {
    return _bitcount( val );
}

#ifdef _BITCOUNT_EXE_

#include <stdio.h>
#include <stdlib.h>
#include <time.h>

/* Use the same sequence of pseudo random numbers to benmark each Hamming
 * Weight algorithm.
 */
void benchmark( int reps ) {
    clock_t start, stop;
    int i, j;
    static const int iterations = 1000000;

    for ( j = 0; j != strategyCount; ++j ) {
        setStrategy( j );

        srand( 257 );

        start = clock(  );

        for ( i = 0; i != reps * iterations; ++i )
            bitcount( rand(  ) );

        stop = clock(  );

        printf
            ( "\n\t%d psudoe-random integers using %s: %f seconds\n\n",
              reps * iterations, strategyNames[j],
              ( double )( stop - start ) / CLOCKS_PER_SEC );
    }
}

int main( void ) {
    int option;

    while ( 1 ) {
        printf( "Menu Options\n"
            "\t1.\tPrint the Hamming Weight of an Integer\n"
            "\t2.\tBenchmark Hamming Weight implementations\n"
            "\t3.\tExit ( or cntl-d )\n\n\t" );

        if ( scanf( "%d", &option ) == EOF )
            break;

        switch ( option ) {
        case 1:
            printf( "Please enter the integer: " );
            if ( scanf( "%d", &option ) != EOF )
                printf
                    ( "The Hamming Weight of %d ( 0x%X ) is %d\n\n",
                      option, option, bitcount( option ) );
            break;
        case 2:
            printf
                ( "Please select number of reps ( in millions ): " );
            if ( scanf( "%d", &option ) != EOF )
                benchmark( option );
            break;
        case 3:
            goto EXIT;
            break;
        default:
            printf( "Invalid option\n" );
        }

    }

 EXIT:
    printf( "\n" );

    return 0;
}

#endif 
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2011-04-13T07:50:16.590

有很多算法来计算设置的位数；但我认为最好的是更快的！您可以在此页面上查看详细信息：

[Bit Twiddling Hacks](http://graphics.stanford.edu/~seander/bithacks.html)

我建议这个：

**使用 64 位指令对 14、24 或 32 位字中设置的位进行计数**

```
unsigned int v; // count the number of bits set in v
unsigned int c; // c accumulates the total bits set in v

// option 1, for at most 14-bit values in v:
c = (v * 0x200040008001ULL & 0x111111111111111ULL) % 0xf;

// option 2, for at most 24-bit values in v:
c =  ((v & 0xfff) * 0x1001001001001ULL & 0x84210842108421ULL) % 0x1f;
c += (((v & 0xfff000) >> 12) * 0x1001001001001ULL & 0x84210842108421ULL) 
     % 0x1f;

// option 3, for at most 32-bit values in v:
c =  ((v & 0xfff) * 0x1001001001001ULL & 0x84210842108421ULL) % 0x1f;
c += (((v & 0xfff000) >> 12) * 0x1001001001001ULL & 0x84210842108421ULL) % 
     0x1f;
c += ((v >> 24) * 0x1001001001001ULL & 0x84210842108421ULL) % 0x1f; 
```

此方法需要具有快速模除法的 64 位 CPU 才能有效。第一个选项只需要 3 次操作；第二个选项取 10；第三个选项需要 15。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2011-11-15T23:52:50.830

32位还是不是？[在阅读了“破解编码面试](https://rads.stackoverflow.com/amzn/click/com/145157827X)”第 4 版练习 5.5（第 5 章：位操作）后，我刚刚在 Java 中使用了这种方法。如果最低有效位是 1 increment `count`，则右移整数。

```
public static int bitCount( int n){
    int count = 0;
    for (int i=n; i!=0; i = i >> 1){
        count += i & 1;
    }
    return count;
} 
```

我认为这个比具有常数 0x33333333 的解决方案更直观，无论它们有多快。这取决于您对“最佳算法”的定义。

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2021-05-20T11:00:37.943

**天真的解决方案**

时间复杂度为 O（n 中的位数）

```
int countSet(int n)
{
    int res=0;
    while(n>0){
      res=res+(n&1);
      n=n>>1;
    }
   return res;
} 
```

**Brian Kerningam 的算法**

时间复杂度为 O（n 中的设置位数）

```
int countSet(int n)
{
  int res=0;
  while(n>0)
  {
    n=(n & (n-1));
    res++;
  }
  return res;
} 
```

**32 位数字的查找表方法 -**在此方法中，我们将 32 位数字分成四个 8 位数字的块

时间复杂度为 O(1)

```
int table[256]; /*here size of the table is take 256 because when all 8 bit are set 
                 its decimal representation is 256*/

void initialize() //holds the number of set bits from 0 to 255
{
  table[0]=0;
  for(int i=1;i<256;i++)
     table[i]=(i&1)+table[i>>1];
}

int countSet(int n)
{
  // 0xff is hexadecimal representation of 8 set bits.
  int res=table[n & 0xff];
  n=n>>8;
  res=res+ table[n & 0xff];
  n=n>>8;
  res=res+ table[n & 0xff];
  n=n>>8;
  res=res+ table[n & 0xff];
  return res;
} 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2012-04-26T02:25:11.280

我个人使用这个：

```
 public static int myBitCount(long L){
      int count = 0;
      while (L != 0) {
         count++;
         L ^= L & -L; 
      }
      return count;
  } 
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2021-02-07T09:33:35.677

[蟒蛇解决方案：](https://leetcode.com/problems/number-of-1-bits/solution/)

```
def hammingWeight(n: int) -> int:
    sums = 0
    while (n!=0):
        sums+=1
        n = n &(n-1)

    return sums 
```

在二进制表示中，n 中的最低有效 1 位始终对应于 n - 1 中的 0 位。因此，将两个数 n 和 n - 1 相加总是将 n 中的最低有效 1 位翻转为 0，并且保持所有其他位相同。

[![在此处输入图像描述](https://i.stack.imgur.com/zRjbD.png)](https://i.stack.imgur.com/zRjbD.png)

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2013-11-26T23:26:10.847

这是迄今为止尚未提及的使用位域的解决方案。以下程序使用 4 种不同的方法计算 100000000 个 16 位整数数组中的设置位。计时结果在括号中给出（在 MacOSX 上，带有`gcc -O3`）：

```
#include <stdio.h>
#include <stdlib.h>

#define LENGTH 100000000

typedef struct {
    unsigned char bit0 : 1;
    unsigned char bit1 : 1;
    unsigned char bit2 : 1;
    unsigned char bit3 : 1;
    unsigned char bit4 : 1;
    unsigned char bit5 : 1;
    unsigned char bit6 : 1;
    unsigned char bit7 : 1;
} bits;

unsigned char sum_bits(const unsigned char x) {
    const bits *b = (const bits*) &x;
    return b->bit0 + b->bit1 + b->bit2 + b->bit3 \
         + b->bit4 + b->bit5 + b->bit6 + b->bit7;
}

int NumberOfSetBits(int i) {
    i = i - ((i >> 1) & 0x55555555);
    i = (i & 0x33333333) + ((i >> 2) & 0x33333333);
    return (((i + (i >> 4)) & 0x0F0F0F0F) * 0x01010101) >> 24;
}

#define out(s) \
    printf("bits set: %lu\nbits counted: %lu\n", 8*LENGTH*sizeof(short)*3/4, s);

int main(int argc, char **argv) {
    unsigned long i, s;
    unsigned short *x = malloc(LENGTH*sizeof(short));
    unsigned char lut[65536], *p;
    unsigned short *ps;
    int *pi;

    /* set 3/4 of the bits */
    for (i=0; i<LENGTH; ++i)
        x[i] = 0xFFF0;

    /* sum_bits (1.772s) */
    for (i=LENGTH*sizeof(short), p=(unsigned char*) x, s=0; i--; s+=sum_bits(*p++));
    out(s);

    /* NumberOfSetBits (0.404s) */
    for (i=LENGTH*sizeof(short)/sizeof(int), pi=(int*)x, s=0; i--; s+=NumberOfSetBits(*pi++));
    out(s);

    /* populate lookup table */
    for (i=0, p=(unsigned char*) &i; i<sizeof(lut); ++i)
        lut[i] = sum_bits(p[0]) + sum_bits(p[1]);

    /* 256-bytes lookup table (0.317s) */
    for (i=LENGTH*sizeof(short), p=(unsigned char*) x, s=0; i--; s+=lut[*p++]);
    out(s);

    /* 65536-bytes lookup table (0.250s) */
    for (i=LENGTH, ps=x, s=0; i--; s+=lut[*ps++]);
    out(s);

    free(x);
    return 0;
} 
```

虽然位域版本非常易读，但时序结果显示它比`NumberOfSetBits()`. 基于查找表的实现仍然要快一些，特别是对于 65 kB 的表。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2014-06-07T16:41:10.560

```
int bitcount(unsigned int n)
{ 
      int count=0;
      while(n)
      {
           count += n & 0x1u;
           n >>= 1;
      }
      return  count;
 } 
```

迭代的“计数”运行时间与总位数成正比。它只是循环遍历所有位，由于 while 条件而稍早终止。有用，如果 1'S 或设置的位是**稀疏**的并且在**最低有效位**之间。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2015-02-12T04:19:05.203

```
int countBits(int x)
{
    int n = 0;
    if (x) do n++;
           while(x=x&(x-1));
    return n;
} 
```

或者还有：

```
int countBits(int x) { return (x)? 1+countBits(x&(x-1)): 0; } 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2015-11-18T22:45:59.313

如果您使用支持 BMI2 的 CPU，则另一种 Hamming 权重算法

```
the_weight=__tzcnt_u64(~_pext_u64(data[i],data[i])); 
```

玩得开心！

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2016-10-04T21:05:15.570

在 Java 8 或 9 中，只需调用`Integer.bitCount`.

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2017-06-15T12:01:54.870

> 您可以使用名为 __builtin_popcount() 的内置函数。C++ 中没有 __builtin_popcount，但它是 GCC 编译器的内置函数。此函数以整数形式返回设置的位数。

```
int __builtin_popcount (unsigned int x); 
```

参考：[Bit Twiddling Hacks](http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetTable)

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2020-09-14T17:38:11.347

从 Python 3.10 开始，您将可以使用该`int.bit_count()`函数，但暂时您可以自己定义该函数。

```
def bit_count(integer):
    return bin(integer).count("1") 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2010-06-01T21:54:32.873

一种简单的方法，它可以很好地处理少量的位，就像这样（在这个例子中是 4 位）：

(i & 1) + (i & 2)/2 + (i & 4)/4 + (i & 8)/8

其他人会推荐这作为一个简单的解决方案吗？

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2012-02-24T06:37:53.207

这是示例代码，可能有用。

```
private static final int[] bitCountArr = new int[]{0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4, 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5, 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7, 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7, 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6, 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7, 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7, 4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8};
private static final int firstByteFF = 255;
public static final int getCountOfSetBits(int value){
    int count = 0;
    for(int i=0;i<4;i++){
        if(value == 0) break;
        count += bitCountArr[value & firstByteFF];
        value >>>= 8;
    }
    return count;
} 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2012-02-24T14:16:47.773

这是在 PHP 中工作的东西（所有 PHP 整数都是 32 位签名的，因此是 31 位）：

```
function bits_population($nInteger)
{

    $nPop=0;
    while($nInteger)
    {
        $nInteger^=(1<<(floor(1+log($nInteger)/log(2))-1));
        $nPop++;
    }
    return $nPop;
} 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2012-06-06T20:04:48.860

```
#!/user/local/bin/perl

    $c=0x11BBBBAB;
     $count=0;
     $m=0x00000001;
    for($i=0;$i<32;$i++)
    {
        $f=$c & $m;
        if($f == 1)
        {
            $count++;
        }
        $c=$c >> 1;
    }
    printf("%d",$count);

ive done it through a perl script. the number taken is $c=0x11BBBBAB   
B=3 1s   
A=2 1s   
so in total  
1+1+3+3+3+2+3+3=19 
```

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2016-02-04T11:45:31.550

如何将整数转换为二进制字符串并计数？

php解决方案：

```
substr_count( decbin($integer), '1' ); 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2017-07-07T23:51:50.937

我在任何地方都没有看到这种方法：

```
int nbits(unsigned char v) {
    return ((((v - ((v >> 1) & 0x55)) * 0x1010101) & 0x30c00c03) * 0x10040041) >> 0x1c;
} 
```

它按字节工作，因此对于 32 位整数必须调用 4 次。它源自横向加法，但使用两个 32 位乘法来将指令数量减少到只有 7 条。

当前大多数 C 编译器会在请求数明显为 4 的倍数时使用 SIMD (SSE2) 指令优化此功能，并且变得相当有竞争力。它是可移植的，可以定义为宏或内联函数，不需要数据表。

这种方法可以扩展到一次处理 16 位，使用 64 位乘法。但是，当所有 16 位都设置时它会失败，返回零，因此它只能在 0xffff 输入值不存在时使用。由于 64 位操作，它也较慢，并且不能很好地优化。

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2019-06-06T16:12:25.157

计算设置位数的简单算法：

```
int countbits(n){
     int count = 0;
     while(n != 0){
        n = n & (n-1);
        count++;
   }
   return count;
} 
```

以11（1011）为例，尝试手动运行算法。应该对你有很大帮助！

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2020-03-22T07:16:21.170

```
def hammingWeight(n):
    count = 0
    while n:
        if n&1:
            count += 1
        n >>= 1
    return count 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2020-10-16T14:49:08.753

我很失望地看到没有人对功能性主竞赛递归解决方案做出回应，这是迄今为止最纯粹的解决方案（并且可以与任何位长度一起使用！）：

```
template<typename T>
int popcnt(T n)
{
  if (n>0)
    return n&1 + popcnt(n>>1);
  return 0; 
} 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2020-12-03T06:44:45.107

对于 Java，有一个`java.util.BitSet`. [https://docs.oracle.com/javase/8/docs/api/java/util/BitSet.html](https://docs.oracle.com/javase/8/docs/api/java/util/BitSet.html)

> cardinality()：返回此 BitSet 中设置为 true 的位数。

BitSet 的内存效率很高，因为它存储为 Long。

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2021-04-20T20:17:01.873

提供另一种未提及的算法，称为 Parallel，取自[此处](http://graphics.stanford.edu/%7Eseander/bithacks.html#CountBitsSetParallel)。很好的一点是它是通用的，这意味着位大小为 8、16、32、64、128 的代码是相同的。

我检查了 2^26 位大小为 8、16、32、64 的数量的值和时间的正确性。请参阅下面的时间。

提供这个算法作为第一个代码片段，这里提到的其他两个仅供参考，因为我测试并与它们进行了比较。

算法是用 C++ 编码的，是通用的，但可以很容易地被旧 C 所采用。

```
#include <type_traits>
#include <cstdint>

template <typename IntT>
inline size_t PopCntParallel(IntT n) {
    // https://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetParallel
    using T = std::make_unsigned_t<IntT>;
    #define MY_CHAR_BIT 8
    T v = T(n);
    v = v - ((v >> 1) & (T)~(T)0/3);                           // temp
    v = (v & (T)~(T)0/15*3) + ((v >> 2) & (T)~(T)0/15*3);      // temp
    v = (v + (v >> 4)) & (T)~(T)0/255*15;                      // temp
    return size_t((T)(v * ((T)~(T)0/255)) >> (sizeof(T) - 1) * MY_CHAR_BIT); // count
    #undef MY_CHAR_BIT
} 
```

以下是我比较的两种算法。一种是带循环的 Kernighan 简单方法，取自[此处](http://graphics.stanford.edu/%7Eseander/bithacks.html#CountBitsSetKernighan)。

```
template <typename IntT>
inline size_t PopCntKernighan(IntT n) {
    // http://graphics.stanford.edu/~seander/bithacks.html#CountBitsSetKernighan
    using T = std::make_unsigned_t<IntT>;
    T v = T(n);
    size_t c;
    for (c = 0; v; ++c)
        v &= v - 1; // clear the least significant bit set
    return c;
} 
```

另一种是使用 built-in // `__popcnt16()`MSVC的内在函数（[doc here](https://docs.microsoft.com/en-us/cpp/intrinsics/popcnt16-popcnt-popcnt64?view=msvc-160)），这个内在函数应该提供非常优化的版本，可能是硬件：`__popcnt()``__popcnt64()`

```
template <typename IntT>
inline size_t PopCntMsvcIntrinsic(IntT n) {
    // https://docs.microsoft.com/en-us/cpp/intrinsics/popcnt16-popcnt-popcnt64?view=msvc-160
    using T = std::make_unsigned_t<IntT>;
    T v = T(n);
    if constexpr(sizeof(IntT) <= 2)
        return __popcnt16(uint16_t(v));
    else if constexpr(sizeof(IntT) <= 4)
        return __popcnt(uint32_t(v));
    else
        return __popcnt64(uint64_t(v));
} 
```

以下是时间，每一个数字以纳秒为单位。所有计时都是针对 2^26 个随机数完成的。比较所有 3 种算法的时间以及 8、16、32、64 之间的所有位大小。总的来说，我的机器上的所有测试都用了 16 秒。使用了高分辨率时钟。

```
08 bit MsvcIntrinsic 4.8 ns
08 bit Parallel 4.0 ns
08 bit Kernighan 18.1 ns
16 bit MsvcIntrinsic 0.7 ns
16 bit Parallel 0.7 ns
16 bit Kernighan 25.7 ns
32 bit MsvcIntrinsic 1.6 ns
32 bit Parallel 1.6 ns
32 bit Kernighan 31.2 ns
64 bit MsvcIntrinsic 2.5 ns
64 bit Parallel 2.4 ns
64 bit Kernighan 49.5 ns 
```

正如人们所看到的，提供的并行算法（3 个中的第一个）与 MSVC 的内在算法一样好，并且对于 8 位它甚至更快。

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2021-05-06T02:02:11.083

Kotlin 1.4 之前

```
 fun NumberOfSetBits(i: Int): Int {
            var i = i
            i -= (i ushr 1 and 0x55555555)
            i = (i and 0x33333333) + (i ushr 2 and 0x33333333)
            return (i + (i ushr 4) and 0x0F0F0F0F) * 0x01010101 ushr 24
        } 
```

这或多或少是这里看到的答案的副本[https://stackoverflow.com/a/109025/6499953](https://stackoverflow.com/a/109025/6499953)

使用 java 修复，然后使用 Intellij IDEA 社区版中的转换器进行转换

1.4 及更高版本（截至 21 年 5 月 5 日，未来可能会发生变化）

```
 fun NumberOfSetBits(i: Int): Int {
            return i.countOneBits()
        } 
```

在它使用的引擎盖下，`Integer.bitCount`如此处所示

```
@SinceKotlin("1.4")
@WasExperimental(ExperimentalStdlibApi::class)
@kotlin.internal.InlineOnly
public actual inline fun Int.countOneBits(): Int = Integer.bitCount(this) 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2022-01-19T08:35:42.557

对于那些希望将`C++11`任何无符号整数类型用作 consexpr 函数的人（[https://github.com/andry81/tacklelib/blob/trunk/include/tacklelib/utility/math.hpp](https://github.com/andry81/tacklelib/blob/trunk/include/tacklelib/utility/math.hpp)）：

```
#include <stdint.h>
#include <limits>
#include <type_traits>

const constexpr uint32_t uint32_max = (std::numeric_limits<uint32_t>::max)();

namespace detail
{
    template <typename T>
    inline constexpr T _count_bits_0(const T & v)
    {
        return v - ((v >> 1) & 0x55555555);
    }

    template <typename T>
    inline constexpr T _count_bits_1(const T & v)
    {
        return (v & 0x33333333) + ((v >> 2) & 0x33333333);
    }

    template <typename T>
    inline constexpr T _count_bits_2(const T & v)
    {
        return (v + (v >> 4)) & 0x0F0F0F0F;
    }

    template <typename T>
    inline constexpr T _count_bits_3(const T & v)
    {
        return v + (v >> 8);
    }

    template <typename T>
    inline constexpr T _count_bits_4(const T & v)
    {
        return v + (v >> 16);
    }

    template <typename T>
    inline constexpr T _count_bits_5(const T & v)
    {
        return v & 0x0000003F;
    }

    template <typename T, bool greater_than_uint32>
    struct _impl
    {
        static inline constexpr T _count_bits_with_shift(const T & v)
        {
            return
                detail::_count_bits_5(
                    detail::_count_bits_4(
                        detail::_count_bits_3(
                            detail::_count_bits_2(
                                detail::_count_bits_1(
                                    detail::_count_bits_0(v)))))) + count_bits(v >> 32);
        }
    };

    template <typename T>
    struct _impl<T, false>
    {
        static inline constexpr T _count_bits_with_shift(const T & v)
        {
            return 0;
        }
    };
}

template <typename T>
inline constexpr T count_bits(const T & v)
{
    static_assert(std::is_integral<T>::value, "type T must be an integer");
    static_assert(!std::is_signed<T>::value, "type T must be not signed");

    return uint32_max >= v ?
        detail::_count_bits_5(
            detail::_count_bits_4(
                detail::_count_bits_3(
                    detail::_count_bits_2(
                        detail::_count_bits_1(
                            detail::_count_bits_0(v)))))) :
        detail::_impl<T, sizeof(uint32_t) < sizeof(v)>::_count_bits_with_shift(v);
} 
```

加上谷歌测试库中的测试：

```
#include <stdlib.h>
#include <time.h>

namespace {
    template <typename T>
    inline uint32_t _test_count_bits(const T & v)
    {
        uint32_t count = 0;
        T n = v;
        while (n > 0) {
            if (n % 2) {
                count += 1;
            }
            n /= 2;
        }
        return count;
    }
}

TEST(FunctionsTest, random_count_bits_uint32_100K)
{
    srand(uint_t(time(NULL)));
    for (uint32_t i = 0; i < 100000; i++) {
        const uint32_t r = uint32_t(rand()) + (uint32_t(rand()) << 16);
        ASSERT_EQ(_test_count_bits(r), count_bits(r));
    }
}

TEST(FunctionsTest, random_count_bits_uint64_100K)
{
    srand(uint_t(time(NULL)));
    for (uint32_t i = 0; i < 100000; i++) {
        const uint64_t r = uint64_t(rand()) + (uint64_t(rand()) << 16) + (uint64_t(rand()) << 32) + (uint64_t(rand()) << 48);
        ASSERT_EQ(_test_count_bits(r), count_bits(r));
    }
} 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2022-01-28T18:56:25.077

## 以二进制表示（ N ）计算集合位：

#### 伪代码 -

1.  设置计数器 = 0。

2.  重复计数，直到 N 不为零。

3.  检查最后一点。如果最后一位 = 1，则递增计数器

4.  丢弃 N 的最后一位。

#### 现在让我们用 C++ 编写代码

```
int countSetBits(unsigned int n){

int count = 0;

while(n!=0){

    count += n&1;

    n = n >>1;
}

  return count;

} 
```

让我们使用这个功能。

```
int main(){

 int x = 5;
 cout<<countSetBits(x);

 return 0;
} 
```

输出：2

因为 5 在二进制表示中设置了 2 位（ 101 ）

[你可以在这里](https://replit.com/@mayukhpankaj/countsetbits#main.cpp)运行代码

* * *

## 回答 #57

> 赞同：-1
> 
> 时间：2012-04-06T21:24:41.613

```
// How about the following:
public int CountBits(int value)
{
    int count = 0;
    while (value > 0)
    {
        if (value & 1)
            count++;
        value <<= 1;
    }
    return count;
} 
```

* * *

## 回答 #58

> 赞同：-1
> 
> 时间：2012-06-21T13:34:47.647

您可以执行以下操作：

```
int countSetBits(int n)
{
    n=((n&0xAAAAAAAA)>>1) + (n&0x55555555);
    n=((n&0xCCCCCCCC)>>2) + (n&0x33333333);
    n=((n&0xF0F0F0F0)>>4) + (n&0x0F0F0F0F);
    n=((n&0xFF00FF00)>>8) + (n&0x00FF00FF);
    return n;
}

int main()
{
    int n=10;
    printf("Number of set bits: %d",countSetBits(n));
     return 0;
} 
```

见heer：http: [//ideone.com/JhwcX](http://ideone.com/JhwcX)

工作可以解释如下：

首先，所有偶数位向右移动并与奇数位相加以计算两组中的位数。然后我们两人一组，然后四人一组，以此类推..

* * *

## 回答 #59

> 赞同：-1
> 
> 时间：2015-01-09T02:40:46.833

我给出了两种算法来回答这个问题，

```
 package countSetBitsInAnInteger;

    import java.util.Scanner;

    public class UsingLoop {

    public static void main(String[] args) {
        Scanner in = new Scanner(System.in);
        try{
        System.out.println("Enter a integer number to check for set bits in it");
        int n = in.nextInt();
        System.out.println("Using while loop, we get the number of set bits as: "+usingLoop(n));
        System.out.println("Using Brain Kernighan's Algorithm, we get the number of set bits as: "+usingBrainKernighan(n));
        System.out.println("Using ");
        }
        finally{
        in.close();
        }
    }
    private static int usingBrainKernighan(int n) {
        int count = 0;
        while(n>0){
            n&=(n-1);
            count++;
        }
        return count;
    }/*
    Analysis:
        Time complexity = O(lgn)
        Space complexity = O(1)
    */
    private static int usingLoop(int n) {
        int count = 0;
        for(int i=0;i<32;i++){
            if((n&(1<<i))!=0)
                count++;
        }
        return count;
    }
    /*
    Analysis:
        Time Complexity = O(32) // Maybe the complexity is O(lgn)
        Space Complexity = O(1)
    */
    } 
```

* * *

## 回答 #60

> 赞同：-2
> 
> 时间：2013-05-29T09:16:30.363

我使用以下功能。没有检查基准，但它有效。

```
int msb(int num)
{
    int m = 0;
    for (int i = 16; i > 0; i = i>>1)
    {
        // debug(i, num, m);
        if(num>>i)
        {
            m += i;
            num>>=i;
        }
    }
    return m;
} 
```

* * *

## 回答 #61

> 赞同：-2
> 
> 时间：2019-08-25T22:00:15.367

这是golang中的实现

```
func CountBitSet(n int) int {

    count := 0
    for n > 0 {
      count += n & 1
      n >>= 1

    }
    return count
} 
```

* * *

## 回答 #62

> 赞同：-3
> 
> 时间：2015-09-25T17:31:37.777

```
public class BinaryCounter {

private int N;

public BinaryCounter(int N) {
    this.N = N;
}

public static void main(String[] args) {

    BinaryCounter counter=new BinaryCounter(7);     
    System.out.println("Number of ones is "+ counter.count());

}

public int count(){
    if(N<=0) return 0;
    int counter=0;
    int K = 0;
    do{
        K = biggestPowerOfTwoSmallerThan(N);
        N = N-K;
        counter++;
    }while (N != 0);
    return counter;

}

private int biggestPowerOfTwoSmallerThan(int N) {
    if(N==1) return 1;
    for(int i=0;i<N;i++){
        if(Math.pow(2, i) > N){
            int power = i-1;
            return (int) Math.pow(2, power);
        }
    }
    return 0;
}
} 
```

* * *

## 回答 #63

> 赞同：-3
> 
> 时间：2018-02-11T13:12:57.233

这也可以正常工作：

```
int ans = 0;
while(num){
 ans += (num &1);
 num = num >>1;
}    
return ans; 
```

# php - 在php中对结果进行分页的最佳方法是什么

> ID：109027
> 
> 赞同：5
> 
> 时间：2008-09-20T19:06:00.973
> 
> 标签：php, pagination

我需要在网站中显示许多新闻页面。`LIMIT`获得所有结果后，我应该使用 PHP 脚本还是使用 PHP 脚本在数据库查询中进行分页？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-20T19:06:44.760

使用限制 - 如果可以避免的话，您不希望将大量数据从数据库传输到脚本引擎。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-20T19:09:45.767

在 SQL 中使用限制！每次！

否则，您会抛出比您需要的更多的数据，这会使您的脚本不必要地变慢，并且随着表中数据量的增加会导致可伸缩性问题。

极限是你的朋友！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T19:11:33.220

如果您只想使用支持此功能的 DBMS，而不是在 DBMS 上使用。如果您希望将来支持其他 DBMS，则在其之间添加一个可以根据当前 DBMS 处理的层。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T20:25:08.940

您可以使用一些现有的库来帮助您：

Pear:: [Pager](http://pear.php.net/package/Pager) 可以帮助输出，并将数据库流量限制在您需要的范围内，您可以使用随附示例中提供的包装器。

这是我刚刚在谷歌上搜索的一个[教程，其中包含所有内容......](http://www.alberton.info/pear_pager_tutorial_database_results.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-07T18:58:37.927

除了 using 之外`LIMIT`，我还建议使用显式`WHERE`子句来设置偏移量，并对该列的结果进行排序。例如：

```
--- First page (showing first 50 records)
SELECT * FROM people ORDER BY id LIMIT 50
--- Second page
SELECT * FROM people WHERE id > 50 ORDER BY id LIMIT 50 
```

这进一步将返回的行数限制在所需范围内。使用该`WHERE`方法（`LIMIT`与具有单独偏移量的子句相反，例如`LIMIT 50,50`）允许您有效地处理使用其他自然键的记录分页，例如按名称字母顺序或按日期顺序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T19:08:48.033

就个人而言，我会使用查询来做到这一点。显然，如果您处理 AJAX 等，情况可能会发生变化，但只需在查询中进行基本限制并输出结果即可简单而高效。

# vb.net - VB.NET - RichTextBox - 将格式应用于选定的文本

> ID：109032
> 
> 赞同：2
> 
> 时间：2008-09-20T19:07:52.357
> 
> 标签：vb.net, visual-studio, winforms, formatting, text-editor

我的表单上有一个**RichTextBox**控件。我也有这个按钮，标记为**Bold**，如果有人在**RichTextBox**中选择文本，然后按下按钮，**则所选文本变为粗体。**有什么办法吗？最终用户的简单日常任务。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T19:11:03.080

您需要使用 RichTextBox 的 .SelectionFont 属性并为其分配具有所需样式的 Font 对象。

示例 - 此代码将在按钮的事件处理程序中：

```
Dim bfont As New Font(RichTextBoxFoo.Font, FontStyle.Bold)
RichTextBoxFoo.SelectionFont = bfont 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-22T17:49:06.320

上面的变体考虑根据当前选择的文本的字体信息打开/关闭粗体：

```
 With Me.rtbDoc
        If .SelectionFont IsNot Nothing Then
            Dim currentFont As System.Drawing.Font = .SelectionFont
            Dim newFontStyle As System.Drawing.FontStyle

            If .SelectionFont.Bold = True Then
                newFontStyle = currentFont.Style - Drawing.FontStyle.Bold
            Else
                newFontStyle = currentFont.Style + Drawing.FontStyle.Bold
            End If

            .SelectionFont = New Drawing.Font(currentFont.FontFamily, currentFont.Size, newFontStyle)
        End If
    End With 
```

它可能需要清理一下，我是从一个较旧的项目中提取的。

# .net - ASP.NET MVC：使路由/URL 对 IIS6 和 IIS7 友好

> ID：109044
> 
> 赞同：3
> 
> 时间：2008-09-20T19:10:17.060
> 
> 标签：.net, asp.net-mvc, iis, url, url-routing

我有一个 ASP.NET MVC 应用程序，我希望它可以部署在 IIS6 和 IIS7 上，众所周知，IIS6 需要 URL 中的“.mvc”命名。

此代码是否可以确保它适用于所有 IIS 版本？无需对不同 IIS 版本的代码、global.asax 或配置文件进行特殊调整。

```
bool usingIntegratedPipeline = HttpRuntime.UsingIntegratedPipeline;

routes.MapRoute(
    "Default",
    usingIntegratedPipeline ?
        "{controller}/{action}/{id}" : "{controller}.mvc/{action}/{id}",
    new { controller = "Home", action = "Index", id = "" }
); 
```

**更新**：忘了提。没有 ISAPI。托管网站，无法控制 IIS 服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T19:37:22.567

这应该可以解决 .mvc 问题，因为集成管道严格是 IIS7。但请记住在 IIS7 网站上更改设置以使用“2.0 Integrated Pipeline”，否则它也会返回 false。还可以设置 .mvc 到 asp.net isapi dll 的映射，但我猜你已经知道了。

关于在 IIS6 上部署 MVC 应用程序时可能需要记住的其他一些小建议，我发现它们很有用：http: [//msmvps.com/blogs/omar/archive/2008/06/30/deploy-asp-net-mvc- on-iis-6-solve-404-compression-and-performance-problems.aspx](http://msmvps.com/blogs/omar/archive/2008/06/30/deploy-asp-net-mvc-on-iis-6-solve-404-compression-and-performance-problems.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T19:33:22.980

您可以使用 ISAPI 过滤器重写 URL，这将允许您在 IIS 6 上仍然拥有漂亮的 URL。

例如，看[这里](http://www.flux88.com/UsingASPNETMVCOnIIS6WithoutTheMVCExtension.aspx)

# asp.net - ASP.NET 页面上的倒数计时器

> ID：109064
> 
> 赞同：5
> 
> 时间：2008-09-20T19:19:45.323
> 
> 标签：asp.net, javascript, asp.net-ajax

你能推荐我一种在 ASP.NET 页面上放置倒数计时器的方法吗？

现在我使用这段代码：

**默认.aspx**

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
</asp:ScriptManager>
<asp:UpdatePanel ID="UpdatePanel1" runat="server">
<ContentTemplate>
    <asp:Label ID="Label1" runat="server">60</asp:Label>
    <asp:Timer ID="Timer1" runat="server" Interval="1000" 
        ontick="Timer1_Tick">
    </asp:Timer>
</ContentTemplate>
</asp:UpdatePanel> 
```

**默认.aspx.cs**

```
protected void Timer1_Tick(object sender, EventArgs e)
{
    int seconds = int.Parse(Label1.Text);
    if (seconds > 0)
        Label1.Text = (seconds - 1).ToString();
    else
        Timer1.Enabled = false;
} 
```

但是交通费很贵。我更喜欢纯客户端方法。在 ASP.NET 中可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-21T13:18:41.593

好的，最后我以

```
<span id="timerLabel" runat="server"></span>

<script type="text/javascript">

    function countdown() 
    {
        seconds = document.getElementById("timerLabel").innerHTML;
        if (seconds > 0) 
        {
            document.getElementById("timerLabel").innerHTML = seconds - 1;
            setTimeout("countdown()", 1000);
        }
    }

    setTimeout("countdown()", 1000);

</script> 
```

真的很简单。就像带有 JavaScript 的老式纯 HTML 一样。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-16T08:25:43.207

```
time1 = (DateTime)ViewState["time"] - DateTime.Now;

if (time1.TotalSeconds <= 0)
{
    Label1.Text = Label2.Text = "TimeOut!";                
}
else
{
    if (time1.TotalMinutes > 59)
    {
        Label1.Text = Label2.Text = string.Format("{0}:{1:D2}:{2:D2}",
                                                time1.Hours,
                                                time1.Minutes,
                                                time1.Seconds);
    }
    else
    {
        Label1.Text = Label2.Text = string.Format("{0:D2}:{1:D2}",                                    
                                                time1.Minutes,
                                                time1.Seconds);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T19:31:40.490

您可以在 .aspx 页面中添加类似的内容

```
<form name="counter"><input type="text" size="8" 
name="d2"></form> 

<script> 
<!-- 
// 
 var milisec=0 
 var seconds=30 
 document.counter.d2.value='30' 

function display(){ 
 if (milisec<=0){ 
    milisec=9 
    seconds-=1 
 } 
 if (seconds<=-1){ 
    milisec=0 
    seconds+=1 
 } 
 else 
    milisec-=1 
    document.counter.d2.value=seconds+"."+milisec 
    setTimeout("display()",100) 
} 
display() 
--> 
</script> 
```

[在这里](http://www.java-scripts.net/javascripts/Countdown-Timer.phtml)找到

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-16T14:25:00.703

```
<script type="text/javascript">
    var sec = 10;
    var min = 0
    var hour = 0;
    var t;

    function display() {
        sec -= 1
        if ((sec == 0) && (min == 0) && (hour == 0)) {
            //if a popup window is used:
            setTimeout("self.close()", 1000);
            return;
         }
        if (sec < 0) {
            sec = 59;
            min -= 1;
        }
        if (min < 0) {
            min = 59;
            hour -= 1;
        }
       else
        document.getElementById("<%=TextBox1.ClientID%>").value = hour + ":" + min + ":" + sec;
        t = setTimeout("display()", 1000);
    }
    window.onload = display; 
</script> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-16T10:23:02.597

使用这个javascript代码----

```
var sec=0 ;
 var min=0;
var hour=0;
var t;

function display(){ 
 if (sec<=0){ 
    sec+=1;
 } 
if(sec==60)
{
sec=0;
min+=1;
}
if(min==60){
hour+=1;
min=0;
}

 if (min<=-1){ 
    sec=0; 
    min+=1;
 } 

 else 
    sec+=1 ;
document.getElementById("<%=TextBox1.ClientID%>").value=hour+":"+min+":"+sec;
    t=setTimeout("display()",1000);
    }
window.onload=display; 
```

# actionscript-3 - 如何在 ActionScript 3.0 中使用 FlashVars？

> ID：109066
> 
> 赞同：4
> 
> 时间：2008-09-20T19:20:19.877
> 
> 标签：actionscript-3, parameters, documentation, flashvars

我找到了使用 flash 参数的指南，认为在此处发布可能很有用，因为 Flash CS3 缺少读取这些参数的用法示例。

查看链接的答案

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T08:01:42.680

不确定[他的示例](http://blogs.adobe.com/pdehaan/2006/07/using_flashvars_with_actionscr.html)为什么调用 LoaderInfo。[DisplayObject](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/DisplayObject.html)类有自己的（只读）loaderinfo[属性](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/DisplayObject.html#loaderInfo)。只要你的主类扩展了一个DisplayObject，就可以直接调用该属性

```
package {
    import flash.display.Sprite;

    public class Main extends Sprite {

        public function Main() {
            var test1:String    = '';

            if (this.loaderInfo.parameters.test1 !== undefined) {
                test1 = this.loaderInfo.parameters.test1;
            }
        }
    }
} 
```

从文档：

> 返回一个 LoaderInfo 对象，其中包含有关加载此显示对象所属文件的信息。loaderInfo 属性仅为 SWF 文件的根显示对象或已加载的位图（不适用于使用 ActionScript 绘制的位图）定义。要查找与包含名为 myDisplayObject 的显示对象的 SWF 文件关联的 loaderInfo 对象，请使用 myDisplayObject.root.loaderInfo。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T19:20:58.610

```
var paramObj:Object = LoaderInfo(this.root.loaderInfo).parameters; 
```

整篇文章位于：

[http://blogs.adobe.com/pdehaan/2006/07/using_flashvars_with_actionscr.html](http://blogs.adobe.com/pdehaan/2006/07/using_flashvars_with_actionscr.html)

重要的提示！这仅适用于主类。如果您尝试在子类中加载参数，您将一无所获。

# .net - 是否有 .NET OS 抽象层来使 OS 调用跨平台工作？

> ID：109070
> 
> 赞同：1
> 
> 时间：2008-09-20T19:23:10.447
> 
> 标签：.net, mono, cross-platform, operating-system, abstraction

我真的很想编写可以在任何平台（PC、Linux 和 Mac）上运行的 .NET 应用程序。我并不真正关心 UI 功能，因为这些主要是后台服务。我听说过 MONO，它允许您编写在 Mac 和 Linux 上运行的 .NET 应用程序，但我希望能够编写一个应用程序，在为 Windows 编译时将作为服务运行，而在为 Linux 编译时将像 UNIX 等价物一样运行。我也希望能够将东西存储在注册表中并进行这项工作。有没有办法编写像这样真正与操作系统无关的代码？...而且不要说我应该让它在网络上运行！:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T19:29:43.833

是的，Mono 已将 Windows 服务的东西移植到 Linux，但您将不得不想出一种比注册表更好的方法来存储配置设置……例如，使用 XML 文件将是跨平台的。

[您还应该在此处查看](http://www.mono-project.com/Guidelines:Application_Portability)关于如何开发可移植应用程序的 mono 的 wiki 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T19:26:50.593

简短的回答：没有。您可以创建一个可在 Windows 和 Linux 上运行的应用程序。但是有特定于平台的功能，现在 Mono 无法自动为您“翻译”这些功能。Windows 服务就是一个很好的例子。

# java - 测试所有在 Java 中实现接口的类

> ID：109072
> 
> 赞同：7
> 
> 时间：2008-09-20T19:24:09.773
> 
> 标签：java, unit-testing, interface

有什么东西可以让您自动测试接口的行为（特别是针对 Java）吗？例如，假设我对 Comparable 接口进行了一堆测试，这些测试应该适用于实现 Comparable 的任何东西。我想要的是能够在我的任何实现 Comparable 的类的测试装置中自动包含“ComparableTests”。如果这适用于通用接口，则可以加分。

我知道 .NET 框架[mbUnit](http://weblogs.asp.net/astopford/archive/2008/08/25/mbunit-typefixture.aspx)有类似的东西，当你使用类似 TestNG 的生成器函数时，你可以为 Comparable 设置一个测试装置，并让生成器为你的每个实现 Comparable 的类创建一个实例。但我更希望它是自动的，并且位于我的每个类的测试夹具中（因为我已经有了它们来测试该类的其他部分）。

**澄清：**我绝对可以建造这样的东西。我在问是否有任何东西已经启用了这个。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T23:45:57.367

根据您的最后一段，您要做的是在单元测试中注入一些“额外方法”，因为您已经在测试特定的类。我不知道允许您根据类的层次结构附加测试的测试工具。

但是，根据您自己建议使用 TestNG 构建类似的东西，我认为您可能非常接近。您可以很好地合并一些基本代码，将您的类添加到“默认测试类”列表中，如果它们实现特定接口，则依次测试它们。

不过，对于一般情况，我认为您不走运，因为 Java 类型系统是单向的，您只能（轻松）找出类实现的接口，而不是相反。此外，问题是“在哪里停止寻找”：如果您有一个检查所有`comparable`实现者的测试，您是否希望它也检查`String`' 的有效性，因为那是在您的 Java 环境中？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-14T22:26:07.977

试试这个 [http://www.xmlizer.biz/java/classloader/ClassList.java](http://www.xmlizer.biz/java/classloader/ClassList.java)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T19:44:47.260

在 .NET 中，设置一个查看程序集并标识每个类的继承/实现层次结构的方法非常简单。[如果您研究Java 反射 API](http://www.onjava.com/pub/a/onjava/2007/03/15/reflections-on-java-reflection.html)，我相信您也可以使用 Java 来完成。

然后，您可以创建一个`ITargetInterface`s 数组并在每个数组上调用一个测试方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T20:07:04.303

一种方法是在 jar 文件中搜索所有 .class 文件（或搜索 classes 目录），使用 Class.forName() 方法加载类文件并检查 MyInterface.class.isAssignableFrom(myClass)。

这不会轻易处理公共内部静态类（您可以解析类文件名），但永远不会与私有内部类或匿名内部类一起使用。

# wcf - 有谁知道使用 WCF 为非 .NET 客户端公开 SOAP 接口的任何问题？

> ID：109083
> 
> 赞同：4
> 
> 时间：2008-09-20T19:28:27.690
> 
> 标签：wcf, networking, soap, network-programming, network-protocols

有谁知道使用 WCF 为非 .NET 客户端公开 SOAP 接口的任何问题？例如与其他 SOAP 库不兼容？

这样可以将 SOAP 接口公开给第三方以与我们的软件集成。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T12:33:32.607

我在使用 WCF 时遇到的一些问题领域：

*   它生成跨多个 URL 拆分的 WSDL。也就是说，模式的一部分位于一个 URL，另一部分位于不同的 URL，等等。“主”WSDL URL（在服务名称后仅带有“?WSDL”的那个）通过`xsd:import` 元素引用其他部分。许多 SOAP 客户端（例如 pre-.NET Delphi）在使用这个习惯用法时遇到了很大的困难。因此，您确实必须“扁平化”您的 WSDL，以便在实践中实现互操作性。[这里](http://blogs.thinktecture.com/cweyer/archive/2007/05/10/414840.aspx)给出了一种解决方案。
*   WCF 生成 XML 命名空间的方式与生成 ASMX Web 服务的方式不同。WCF 倾向于将任何服务或数据协定放入自己选择的命名空间中。同样，一些 SOAP 客户端对此也有困难。您可以通过向 ServiceContract 和 DataContract 属性添加显式命名空间来提高互操作性级别。
*   许多 SOAP 客户端不会像 WCF 客户端那样处理故障。例如，代理生成代码不会为 WSDL 中声明的错误创建客户端对象。当然，故障仍然会传递给客户端，但是客户端必须做更多的工作才能弄清楚它是什么类型的故障。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T15:10:09.283

WS-* 标准堆栈的版本也可能是一个互操作性问题 - 例如，某些 java 实现支持的 WS-Addressing (2003) 版本，例如支持更高版本和 1.0 版本但不支持的 WCF 不支持 Oracle BPEL 2003 年初的一个

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T19:31:04.517

通常一切正常。这显然取决于您使用的客户端 - 并非每个人都正确实施 SOAP。

PS如果您希望得到更具体的答案，能否请您改写您的问题？

# javascript - 在 JavaScript 中停止 setInterval 调用

> ID：109086
> 
> 赞同：1613
> 
> 时间：2008-09-20T19:29:55.377
> 
> 标签：javascript, dom-events, setinterval

我`setInterval(fname, 10000);`在 JavaScript 中每 10 秒调用一次函数。是否可以在某些事件上停止调用它？

我希望用户能够停止重复刷新数据。

* * *

## 回答 #1

> 赞同：2494
> 
> 时间：2008-09-20T19:30:59.243

`setInterval()`返回一个间隔 ID，您可以将其传递给`clearInterval()`：

```
var refreshIntervalId = setInterval(fname, 10000);

/* later */
clearInterval(refreshIntervalId); 
```

请参阅 和 的[`setInterval()`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval)文档[`clearInterval()`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/clearInterval)。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2008-09-20T19:32:06.667

如果将返回值设置`setInterval`为变量，则可以使用`clearInterval`停止它。

```
var myTimer = setInterval(...);
clearInterval(myTimer); 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2010-05-16T14:02:25.653

您可以设置一个新变量，并在每次运行时将其递增 ++（向上计数），然后我使用条件语句来结束它：

```
var intervalId = null;
var varCounter = 0;
var varName = function(){
     if(varCounter <= 10) {
          varCounter++;
          /* your code goes here */
     } else {
          clearInterval(intervalId);
     }
};

$(document).ready(function(){
     intervalId = setInterval(varName, 10000);
}); 
```

我希望它有所帮助，而且它是正确的。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-01-19T05:46:41.267

上面的答案已经解释了 setInterval 是如何返回一个句柄的，以及这个句柄是如何用来取消 Interval 定时器的。

一些架构考虑：

请不要使用“无范围”变量。最安全的方法是使用 DOM 对象的属性。最简单的地方是“文件”。如果复习是通过启动/停止按钮启动的，您可以使用该按钮本身：

```
<a onclick="start(this);">Start</a>

<script>
function start(d){
    if (d.interval){
        clearInterval(d.interval);
        d.innerHTML='Start';
    } else {
        d.interval=setInterval(function(){
          //refresh here
        },10000);
        d.innerHTML='Stop';
    }
}
</script> 
```

由于该函数是在按钮单击处理程序中定义的，因此您不必再次定义它。如果再次单击该按钮，则可以恢复计时器。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-08-23T15:14:22.340

已经回答...但是如果您需要一个特色的、可重复使用的计时器，它还支持不同时间间隔的多个任务，您可以使用我的[TaskTimer](https://github.com/onury/tasktimer)（用于节点和浏览器）。

```
// Timer with 1000ms (1 second) base interval resolution.
const timer = new TaskTimer(1000);

// Add task(s) based on tick intervals.
timer.add({
    id: 'job1',         // unique id of the task
    tickInterval: 5,    // run every 5 ticks (5 x interval = 5000 ms)
    totalRuns: 10,      // run 10 times only. (omit for unlimited times)
    callback(task) {
        // code to be executed on each run
        console.log(task.name + ' task has run ' + task.currentRuns + ' times.');
        // stop the timer anytime you like
        if (someCondition()) timer.stop();
        // or simply remove this task if you have others
        if (someCondition()) timer.remove(task.id);
    }
});

// Start the timer
timer.start(); 
```

在您的情况下，当用户单击干扰数据刷新时；如果他们需要重新启用，您也可以致电`timer.pause()`then 。`timer.resume()`

在这里查看[更多](https://onury.io/tasktimer/api)。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2019-05-31T05:12:28.143

clearInterval() 方法可用于清除使用 setInterval() 方法设置的计时器。

setInterval 总是返回一个 ID 值。可以在 clearInterval() 中传递此值以停止计时器。这是一个从 30 开始并在变为 0 时停止的计时器示例。

```
 let time = 30;
  const timeValue = setInterval((interval) => {
  time = this.time - 1;
  if (time <= 0) {
    clearInterval(timeValue);
  }
}, 1000); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-01-08T17:30:19.380

@cnu，

您可以停止间隔，在查看控制台浏览器（F12）之前尝试运行代码...尝试评论 clearInterval(trigger) 再次查看控制台，而不是美化器？:P

检查示例来源：

```
var trigger = setInterval(function() { 
  if (document.getElementById('sandroalvares') != null) {
    document.write('<div id="sandroalvares" style="background: yellow; width:200px;">SandroAlvares</div>');
    clearInterval(trigger);
    console.log('Success');
  } else {
    console.log('Trigger!!');
  }
}, 1000);
```

```
<div id="sandroalvares" style="background: gold; width:200px;">Author</div>
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-07-15T14:12:46.030

这就是我使用 clearInterval() 方法在 10 秒后停止计时器的方式。

```
function startCountDown() {
  var countdownNumberEl = document.getElementById('countdown-number');
  var countdown = 10;
  const interval = setInterval(() => {
    countdown = --countdown <= 0 ? 10 : countdown;
    countdownNumberEl.textContent = countdown;
    if (countdown == 1) {
      clearInterval(interval);
    }
  }, 1000)
}
```

```
<head>
  <body>
    <button id="countdown-number" onclick="startCountDown();">Show Time </button>
  </body>
</head>
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-10-17T20:15:42.393

声明变量以分配从 setInterval(...) 返回的值并将分配的变量传递给 clearInterval();

例如

```
var timer, intervalInSec = 2;

timer = setInterval(func, intervalInSec*1000, 30 ); // third parameter is argument to called function 'func'

function func(param){
   console.log(param);
} 
```

// 任何你可以访问上面声明的**计时器**的地方调用 clearInterval

```
$('.htmlelement').click( function(){  // any event you want

       clearInterval(timer);// Stops or does the work
}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-09-14T22:34:52.617

在 nodeJS 中，您可以在 setInterval 函数中使用“ **this** ”特殊关键字。

您可以使用此**关键字**来清除Interval，这是一个示例：

```
setInterval(
    function clear() {
            clearInterval(this) 
       return clear;
    }()
, 1000) 
```

当您在函数中打印**此**特殊关键字的值时，您会输出一个 Timeout 对象 `Timeout {...}`

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-11-05T07:41:25.410

# 清除间隔（）

请注意，您可以使用此功能启动和暂停您的代码。这个名字有点欺骗性，因为它说的是 CLEAR，但它并没有清除任何东西。它实际上暂停了。

使用此代码进行测试：

HTML：

```
<div id='count'>100</div>
<button id='start' onclick='start()'>Start</button>
<button id='stop' onclick='stop()'>Stop</button> 
```

JavaScript：

```
let count;

function start(){
 count = setInterval(timer,100)  /// HERE WE RUN setInterval()
}

function timer(){
  document.getElementById('count').innerText--;
}

function stop(){
  clearInterval(count)   /// here we PAUSE  setInterval()  with clearInterval() code
}
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-10-21T09:01:05.053

使用 setTimeOut 在一段时间后停止间隔。

```
var interVal = setInterval(function(){console.log("Running")  }, 1000);
 setTimeout(function (argument) {
    clearInterval(interVal);
 },10000); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-04-03T04:33:10.843

很多人都给出了他们很好的答案，`clearInterval`是正确的解决方案。

但我认为我们可以做更多，让我们的编辑器使用 javascript 计时器强制执行最佳实践。

`setTimeout`忘记清除或设置的计时器总是很容易`setInterval`，这可能会导致难以发现的错误。

所以我为上面的问题创建了一个 eslint 插件。

[https://github.com/littlee/eslint-plugin-clean-timer](https://github.com/littlee/eslint-plugin-clean-timer)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-05-19T07:47:43.577

我想下面的代码会有所帮助：

```
var refreshIntervalId = setInterval(fname, 10000);

clearInterval(refreshIntervalId); 
```

你做的代码 100% 正确......所以......有什么问题？或者是教程...

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-09-08T20:13:43.270

尝试

```
let refresch = ()=>  document.body.style= 'background: #'
  +Math.random().toString(16).slice(-6);

let intId = setInterval(refresch, 1000);

let stop = ()=> clearInterval(intId);
```

```
body {transition: 1s}
```

```
<button onclick="stop()">Stop</button>
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2015-04-27T18:04:30.957

## 为什么不使用更简单的方法？加一门课！

只需添加一个告诉间隔不要做任何事情的类。例如：悬停时。

```
var i = 0;
this.setInterval(function() {
  if(!$('#counter').hasClass('pauseInterval')) { //only run if it hasn't got this class 'pauseInterval'
    console.log('Counting...');
    $('#counter').html(i++); //just for explaining and showing
  } else {
    console.log('Stopped counting');
  }
}, 500);

/* In this example, I'm adding a class on mouseover and remove it again on mouseleave. You can of course do pretty much whatever you like */
$('#counter').hover(function() { //mouse enter
    $(this).addClass('pauseInterval');
  },function() { //mouse leave
    $(this).removeClass('pauseInterval');
  }
);

/* Other example */
$('#pauseInterval').click(function() {
  $('#counter').toggleClass('pauseInterval');
});
```

```
body {
  background-color: #eee;
  font-family: Calibri, Arial, sans-serif;
}
#counter {
  width: 50%;
  background: #ddd;
  border: 2px solid #009afd;
  border-radius: 5px;
  padding: 5px;
  text-align: center;
  transition: .3s;
  margin: 0 auto;
}
#counter.pauseInterval {
  border-color: red;  
}
```

```
<!-- you'll need jQuery for this. If you really want a vanilla version, ask -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<p id="counter">&nbsp;</p>
<button id="pauseInterval">Pause</button></p>
```

多年来，我一直在寻找这种快速简便的方法，因此我发布了几个版本，以向尽可能多的人介绍它。

# python - 如何在 Python 中获取实例变量？

> ID：109087
> 
> 赞同：140
> 
> 时间：2008-09-20T19:30:24.580
> 
> 标签：python, methods, instance-variables

Python中是否有内置方法来获取所有类的实例变量的数组？例如，如果我有以下代码：

```
class hi:
  def __init__(self):
    self.ii = "foo"
    self.kk = "bar" 
```

我有没有办法做到这一点：

```
>>> mystery_method(hi)
["ii", "kk"] 
```

编辑：我最初错误地要求类变量。

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-09-20T19:34:17.050

每个对象都有一个`__dict__`变量，其中包含所有变量及其值。

试试这个

```
>>> hi_obj = hi()
>>> hi_obj.__dict__.keys() 
```

* * *

## 回答 #2

> 赞同：118
> 
> 时间：2008-09-20T20:02:26.657

使用 vars()

```
class Foo(object):
    def __init__(self):
        self.a = 1
        self.b = 2

vars(Foo()) #==> {'a': 1, 'b': 2}
vars(Foo()).keys() #==> ['a', 'b'] 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-09-20T19:38:01.300

你通常不能只给一个类就获得实例属性，至少在没有实例化类的情况下不能。但是，您可以获得给定实例的实例属性，或给定类的类属性。请参阅“检查”模块。您无法获得实例属性列表，因为实例实际上可以具有任何属性，并且 - 就像在您的示例中一样 - 创建它们的正常方法是在 __init__ 方法中分配给它们。

一个例外是如果您的类使用插槽，这是类允许实例具有的固定属性列表。[插槽在http://www.python.org/2.2.3/descrintro.html](http://www.python.org/2.2.3/descrintro.html)中有解释，但是插槽有各种陷阱；它们会影响内存布局，因此多重继承可能会有问题，而且继承通常也必须考虑插槽。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-12-23T21:50:34.267

Vars() 和 dict 方法都适用于 OP 发布的示例，但它们不适用于“松散”定义的对象，例如：

```
class foo:
  a = 'foo'
  b = 'bar' 
```

要打印所有不可调用的属性，可以使用以下函数：

```
def printVars(object):
    for i in [v for v in dir(object) if not callable(getattr(object,v))]:
        print '\n%s:' % i
        exec('print object.%s\n\n') % i 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-20T19:39:31.813

您还可以测试对象是否具有特定变量：

```
>>> hi_obj = hi()
>>> hasattr(hi_obj, "some attribute") 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-20T19:42:43.630

您的示例显示“实例变量”，而不是真正的类变量。

查找`hi_obj.__class__.__dict__.items()`类变量以及其他其他类成员，如成员函数和包含模块。

```
class Hi( object ):
    class_var = ( 23, 'skidoo' ) # class variable
    def __init__( self ):
        self.ii = "foo" # instance variable
        self.jj = "bar" 
```

类变量由类的所有实例共享。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-20T20:12:58.690

建议

```
>>> print vars.__doc__
vars([object]) -> dictionary

Without arguments, equivalent to locals().
With an argument, equivalent to object.__dict__. 
```

换句话说，它本质上只是包装了 __dict__

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-21T19:46:01.337

虽然不是直接回答 OP 问题，但有一种非常好的方法可以找出函数范围内的变量。看看这段代码：

```
>>> def f(x, y):
    z = x**2 + y**2
    sqrt_z = z**.5
    return sqrt_z

>>> f.func_code.co_varnames
('x', 'y', 'z', 'sqrt_z')
>>> 
```

func_code 属性里面有各种有趣的东西。它可以让你做一些很酷的事情。这是我如何使用它的示例：

```
def exec_command(self, cmd, msg, sig):

    def message(msg):
        a = self.link.process(self.link.recieved_message(msg))
        self.exec_command(*a)

    def error(msg):
        self.printer.printInfo(msg)

    def set_usrlist(msg):
        self.client.connected_users = msg

    def chatmessage(msg):
        self.printer.printInfo(msg)

    if not locals().has_key(cmd): return
    cmd = locals()[cmd]

    try:
        if 'sig' in cmd.func_code.co_varnames and \
                       'msg' in cmd.func_code.co_varnames: 
            cmd(msg, sig)
        elif 'msg' in cmd.func_code.co_varnames: 
            cmd(msg)
        else:
            cmd()
    except Exception, e:
        print '\n-----------ERROR-----------'
        print 'error: ', e
        print 'Error proccessing: ', cmd.__name__
        print 'Message: ', msg
        print 'Sig: ', sig
        print '-----------ERROR-----------\n' 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-07-05T06:42:34.737

建立在 dmark 的答案上以获得以下信息，如果您想要 sprintf 的等价物并希望能帮助某人，这很有用...

```
def sprint(object):
    result = ''
    for i in [v for v in dir(object) if not callable(getattr(object, v)) and v[0] != '_']:
        result += '\n%s:' % i + str(getattr(object, i, ''))
    return result 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-04-26T09:11:31.673

有时您想根据公共/私有变量过滤列表。例如

```
def pub_vars(self):
    """Gives the variable names of our instance we want to expose
    """
    return [k for k in vars(self) if not k.startswith('_')] 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-12-23T16:23:07.527

您需要首先**检查类**，然后**检查函数的字节码**，然后**复制字节码**，最后**使用`__code__.co_varnames`**. **这很棘手**，因为有些类使用像**模块****中的构造函数来创建它们的方法`types`**。[我将在GitHub 上](https://github.com/g7a20/class-inst-vars)提供它的代码。

# perl - 如何在 Perl 中同时捕获标准错误、标准输出和退出代码？

> ID：109124
> 
> 赞同：57
> 
> 时间：2008-09-20T19:40:40.733
> 
> 标签：perl, stdout, exit-code

是否可以从 Perl 运行外部进程，捕获其标准错误、标准输出和进程退出代码？

我似乎能够将这些组合起来，例如使用反引号来获取标准输出，使用 IPC::Open3 来捕获输出，以及使用 system() 来获取退出代码。

如何一次捕获标准错误、标准输出和退出代码？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-20T22:48:35.507

（**更新**：我更新了 IO::CaptureOutput 的 API 以使其更容易。）

有几种方法可以做到这一点。这是一个选项，使用[IO::CaptureOutput](http://search.cpan.org/perldoc?IO::CaptureOutput)模块：

```
use IO::CaptureOutput qw/capture_exec/;

my ($stdout, $stderr, $success, $exit_code) = capture_exec( @cmd ); 
```

这是 capture_exec() 函数，但 IO::CaptureOutput 还有一个更通用的 capture() 函数，可用于捕获 Perl 输出或来自外部程序的输出。因此，如果某个 Perl 模块碰巧使用了某个外部程序，您仍然会得到输出。

这也意味着您只需要记住一种捕获 STDOUT 和 STDERR（或合并它们）的方法，而不是使用 IPC::Open3 来捕获外部程序和其他模块来捕获 Perl 输出。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-20T19:49:11.913

如果您重新阅读 IPC::Open3 的文档，您会看到一条说明，您应该调用[waitpid](http://perldoc.perl.org/functions/waitpid.html)来获取子进程。完成此操作后，状态应该在`$?`. 退出值为`$? >> 8`。请参阅 [`$?`perldoc perlvar](http://perldoc.perl.org/perlvar.html#$CHILD_ERROR)。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-21T00:57:54.980

如果您不想要 STDERR 的内容，那么[IPC::System::Simple](http://search.cpan.org/perldoc?IPC::System::Simple)模块中的 capture() 命令几乎正是您所追求的：

```
 use IPC::System::Simple qw(capture system $EXITVAL);

   my $output = capture($cmd, @args);

   my $exit_value = $EXITVAL; 
```

您可以使用带有单个参数的 capture() 来调用 shell，或者使用多个参数来可靠地避免 shell。还有一个从不调用 shell 的 capturex()，即使只有一个参数。

与 Perl 的内置系统和反引号命令不同，IPC::System::Simple 在 Windows 下返回完整的 32 位退出值。如果命令无法启动、死于信号或返回意外的退出值，它也会引发详细的异常。这意味着对于许多程序，您可以依靠 IPC::System::Simple 为您完成艰苦的工作，而不是自己检查退出值：

```
 use IPC::System::Simple qw(system capture $EXIT_ANY);

 system( [0,1], "frobincate", @files);     # Must return exitval 0 or 1

 my @lines = capture($EXIT_ANY, "baznicate", @files);  # Any exitval is OK.

 foreach my $record (@lines) {
     system( [0, 32], "barnicate", $record);  # Must return exitval 0 or 32
 } 
```

IPC::System::Simple 是纯 Perl，没有依赖关系，可在 Unix 和 Windows 系统上运行。不幸的是，它没有提供捕获 STDERR 的方法，因此它可能不适合您的所有需求。

[IPC::Run3](http://search.cpan.org/perldoc?IPC::Run3)提供了一个干净简单的界面来重新检查所有三个常见的文件句柄，但不幸的是它不会检查命令是否成功，所以你需要检查 $? 手动，这一点也不好玩。提供一个公共接口来检查 $? 自从检查 $ [?](http://rt.cpan.org/Public/Bug/Display.html?id=26519) 以跨平台的方式不是我希望任何人完成的任务。

[IPC::](http://search.cpan.org/search?query=IPC%3A%3A&mode=all)命名空间中的其他模块也可以为您提供帮助。YMMV。

祝一切顺利，

保罗

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-20T19:53:28.067

运行外部命令的三种基本方式：

```
system $cmd;        # using system()
$output = `$cmd`;       # using backticks (``)
open (PIPE, "cmd |");   # using open() 
```

使用`system()`,`STDOUT`和 STDERR 将与脚本的位置相同`STDOUT`，`STDERR,`除非`system()`命令重定向它们。反引号并`open()`只读`STDOUT`您的命令。

您还可以使用 open 调用类似以下内容来重定向`STDOUT`和`STDERR`。

```
open(PIPE, "cmd 2>&1 |"); 
```

`$?`如[@Michael Carman](https://stackoverflow.com/a/109139/1084)所述，返回码始终存储在其中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T03:15:38.300

如果你变得非常复杂，你可能想试试 Expect.pm。但是，如果您也不需要管理向进程发送输入，那可能就有点过头了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-25T17:10:27.953

我发现[IPC:run3](http://search.cpan.org/~rjbs/IPC-Run3-0.045/lib/IPC/Run3.pm)非常有帮助。您可以将所有子管道转发到一个 glob 或一个变量；非常简单地！退出代码将存储在 $? 中。

下面是我如何抓取我知道会是一个数字的 stderr。cmd 将信息转换输出到标准输出（我使用 > 将其通过管道传输到 args 中的文件），并报告了对 STDERR 的转换次数。

```
use IPC::Run3

my $number;
my $run = run3("cmd arg1 arg2 >output_file",\undef, \undef, \$number);
die "Command failed: $!" unless ($run && $? == 0); 
```

# c++ - 动态创建的运算符

> ID：109129
> 
> 赞同：1
> 
> 时间：2008-09-20T19:43:18.620
> 
> 标签：c++, dynamic, operators, wxwidgets

我使用 dev-cpp 和 wxwidgets 创建了一个程序，它解决了一个难题。

用户必须填写操作块和结果块，程序将解决它。我正在使用蛮力解决它，我使用递归算法生成所有非重复的 9 长度数字组合。它做得非常快。

到这里为止一切都很棒！

但问题是当我的程序根据块上的字符运行时。由于与 +、-、* 等的字符比较，它非常慢（它永远不会得到答案）。我正在做一个 CASE。

是否有某种方式或某种编程语言允许动态创建运算符？所以我可以将运算符 ROW1COL2 定义为 +，并且与所有其他操作相同。

我留下了应用程序的屏幕截图，以便更容易理解拼图的工作原理。

[http://www.imageshare.web.id/images/9gg5cev8vyokp8rhlot9.png](http://www.imageshare.web.id/images/9gg5cev8vyokp8rhlot9.png)

PD：算法有效，我用一个简单的谜题试了一下，一秒钟就解决了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T19:58:20.457

不确定这是否真的是您要寻找的，但是..
任何面向对象的语言（例如 C++ 或 C#）都允许您创建“Operator”基类，然后从该基类派生“PlusOperator”或“MinusOperator” “ ETC'。这是避免此类案例陈述的标准方法。

但是我不确定这会解决您的性能问题。
对此类问题使用简单的蛮力将导致您获得指数解决方案。对于少量输入，这似乎工作得很快——比如完成所有数字。但是，如果您想完成操作，这是一个更大的问题，有更多的可能性。
因此，即使没有 CASE，您的程序也可能无法解决它。

尝试解决此类问题的正确方法是使用一些使用启发式函数的高级搜索方法。例如，参见[A*（A 星）算法](http://en.wikipedia.org/wiki/A_star)。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T19:58:39.410

您可以将数字和运算符表示为对象，因此解析只在求解开始时进行一次。

# asp.net - 如何以编程方式更改 div 的样式

> ID：109134
> 
> 赞同：11
> 
> 时间：2008-09-20T19:46:42.980
> 
> 标签：asp.net, asp.net-mvc

如何更改 div 的样式（颜色），如下所示？

```
"<div id=foo class="ed" style="display: <%= ((foo.isTrue) ? string.Empty : "none") %>">
                        <%= ((foo.isTrue) ? foo.Name: "false foo") %>"` 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-20T19:58:18.490

试试这个：在 .aspx 文件中放入这些行

```
<div id="myDiv" runat="server">
    Some text
</div> 
```

那么你可以使用例如

```
myDiv.Style["color"] = "red"; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T19:58:15.730

如果您想使用在浏览器中运行的客户端代码 (javascript) 更改 div 的颜色，请执行以下操作：

```
<script>
 var fooElement = document.getElementById("foo");
 fooElement.style.color = "red"; //to change the font color
</script> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-09T14:32:28.190

如果您想直接更改类而不是样式：即..使用您想要的样式创建另一个类...

```
myDiv.Attributes["class"] = "otherClassName" 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T19:49:58.057

看起来您正在编写 ASP，或者可能是 JSP。我对这两种语言都不太熟悉，但是无论您使用哪种语言，原则都是相同的。

如果您使用的颜色数量有限，那么通常的选择是创建多个类并在样式表中为它们编写规则集：

```
 .important { background: red; }
.todo { background: blue; } 
```

等等。

然后让您的服务器端脚本生成 HTML 以使 CSS 匹配：

```
 <div class="important"> 
```

当然，您应该[确保信息也可以通过颜色以外的方式获得](http://www.w3.org/TR/WCAG10-CSS-TECHS/#style-info-not-in-color-alone)。

如果颜色是在运行时确定的，那么您可以生成样式属性：

```
 <div style="background-color: red;"> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T19:51:08.943

您应该在 CSS 中设置颜色，然后以编程方式更改 CSS 类。例如：

(CSS)

```
div.Error {
  color:red;
} 
```

(ASP.NET/VB)

```
<div class='<%=Iif(HasError, "Error", "")%>'> .... </div> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T19:54:30.963

一般可以直接做

document.getElementById("myDiv").style.color = "red";

[这里](http://w3schools.com/htmldom/dom_obj_style.asp)有一个参考。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T19:49:33.503

该代码片段并没有说太多 - 如果代码是服务器端的，为什么不更改例如那里的 HTML 元素的类？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-05-12T21:49:02.583

IMO 这是更好的方法。我在其他帖子中发现了其中一些，但这个在谷歌搜索中首先出现。

这部分适用于标准 JavaScript。我很确定您可以使用它来删除所有样式以及添加/覆盖。

```
var div = document.createElement('div');
div.style.cssText = "border-radius: 6px 6px 6px 6px; height: 250px; width: 600px"; 
```

或者

```
var div = document.getElementById('foo');
div.style.cssText = "background-color: red;"; 
```

这仅适用于 jQuery

```
$("#" + TDDeviceTicketID).attr("style", "padding: 10px;");
$("#" + TDDeviceTicketID).attr("class", "roundbox1");

This works for removing it JQUERY
$("#" + TDDeviceTicketID).removeAttr("style");
$("#" + TDDeviceTicketID).removeAttr("class"); 
```

# project-management - 您如何管理大量产品积压？

> ID：109141
> 
> 赞同：22
> 
> 时间：2008-09-20T19:49:40.803
> 
> 标签：project-management, requirements, product-management, backlog

我们在软件中积压了大量应该做的事情，有很多不同的类别，例如：

*   我们的产品需要解决的新问题领域
*   支持现有问题领域的新功能
*   我们现有用户要求的新功能
*   可用性和“外观”增强
*   后端架构升级
*   Bug修复

以明智的方式管理所有这些是属于产品管理的工作，但由于很多原因，这很棘手。首先，我们有许多不同的系统来保存不同的东西（文件中的市场需求文档、错误数据库中的错误、我们的帮助台系统中的客户需求、我们内部网上的工程愿望清单等）。其次，许多项目的大小、范围、复杂性和价值都大相径庭，这意味着选择并不像按优先级排序那样简单。

因为我们现在相当大，拥有复杂的产品和大量的客户，基本的解决方案（电子表格、谷歌文档、basecamp 待办事项列表）不足以解决这个问题。我们需要一种以各种方式将事物组合在一起的方法，持续对它们进行优先级排序，明确我们正在做什么以及即将发生的事情——而不需要花费所有人的时间来管理某些工具。

您如何以一种允许企业始终做对现有客户最有价值的事情、帮助获得新客户并保持软件内部健全的方式来管理这一点？

请注意，这与开发方面不同，我认为我们已经做得很好。我们以迭代、敏捷的方式开发所有东西，一旦选择了某些东西进行设计和实施，我们就可以做到。这是我们需要弄清楚接下来要做什么的部分，这是最难的！

您是否找到了有效的方法或工具？如果有，请分享！（如果您也想知道答案，请对问题进行评分，使其保持可见:)

*附录：*当然最好先修复所有错误，但在实际安装在客户机器上的真实系统中，这并不总是实用的。例如，我们可能有一个很少发生的错误，并且需要大量的时间和架构巨变来修复 - 我们可能会暂时搁置它。或者我们可能有一个错误，有人认为某些东西很难使用，我们认为修复它应该等待对该区域进行更大的改造。所以，有很多原因我们不只是立即修复它们，而是保持它们开放，这样我们就不会忘记。此外，最难的是非 bug 的优先级；想象一下我们没有:)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-20T21:18:22.230

以积极的方式管理大量积压几乎总是浪费。当您到达优先事项的中间时，事情往往会发生变化。我建议采用类似 Corey Ladas 所说的优先级过滤器的方法：

[http://leansoftwareengineering.com/2008/08/19/priority-filter/](http://leansoftwareengineering.com/2008/08/19/priority-filter/)

本质上，您有几个大小不断增加和优先级降低的存储桶。您允许利益相关者填补它们，但迫使他们忽略其余的故事，直到桶中有空缺。非常简单但非常有效。

**编辑：**艾伦问如果任务大小不同该怎么办。基本上，完成这项工作的很大一部分是正确调整您的任务。我们仅将此优先级应用于用户故事。用户故事通常比“创建社区站点”要小得多。我会认为社区网站有点史诗，甚至是一个项目。它需要被分解成更小的部分才能被优先考虑。

也就是说，制作类似大小的故事仍然具有挑战性。有时你就是做不到，所以你在计划决策时就传达了这一点。

With regards to moving wibbles two pixels, many of these things that are easy can be done for "free". You just have to be careful to balance these and only do them if they're really close to free and they're actually somewhat important.

We treat bugs similarly. Bugs get one of three categories, Now, Soon or Eventually. We fix Now and Soon bugs as quickly as we can with the only difference being when we publish the fixes. Eventually bugs don't get fix unless devs get bored and have nothing to do or they somehow become higher priority.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T20:08:55.783

关键是积极的分类和优先排序。

解决使客户快速离开的问题，并添加更多功能以保持客户光临。推迟只影响少数人的问题，除非它们很容易解决。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T20:01:47.390

一种简单的技术是使用优先级矩阵。

例子：

*   [http://erc.msh.org/quality/pstools/psprior2.cfm](http://erc.msh.org/quality/pstools/psprior2.cfm)

*   [http://it.toolbox.com/blogs/enterprise-solutions/sample-project-prioritization-matrix-23381](http://it.toolbox.com/blogs/enterprise-solutions/sample-project-prioritization-matrix-23381)

Covey 提出的优先级象限（两个维度：重要性、紧迫性）也很有用：[http](http://www.dkeener.com/keenstuff/priority.html) ://www.dkeener.com/keenstuff/priority.html 。关注重要和紧急，然后关注重要和不紧急。不重要的东西......好吧......如果有人想在他们的下班时间这样做:-)。我使用的 Covey 象限的一个变体是重要性和轻松的维度。轻松是在 Covey 象限内确定任务优先级的好方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T19:56:42.863

我认为您必须将它们全部放在一个地方，以便优先考虑。必须整理几个不同的来源使得这几乎是不可能的。一旦你有了它，那么某人/一个小组必须对每个错误、请求的功能和期望的开发进行排名。

您可以优先考虑的事情是：

*   产品附加值
*   对现有和潜在客户的重要性
*   任务规模

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T19:57:05.840

您应该首先修复所有错误，然后才考虑为其添加新功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T20:07:43.337

所有这些东西都可以通过具有以下功能的良好错误跟踪系统进行跟踪：

*   能够将工作项标记为错误或增强请求
*   工作项所属责任区域的类别字段（UI、后端等）
*   计划完成修复或功能时的版本 # 字段
*   状态字段（进行中、已完成、已验证等）
*   优先领域

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T20:24:51.813

由于您已经在以敏捷的方式做事，您可以从 XP 中借鉴一些想法：

*   把你*所有*的故事放在一大堆索引卡中（或一些这样的工具）
*   现在开发人员应该估计这些故事的大小（这里开发人员有最终决定权）
*   并让客户（或他们的代理人——比如产品经理）按照他们的商业价值对这些故事进行排序（这里客户有最终决定权）
*   如果开发人员认为有一些技术更重要（比如修复那些讨厌的错误），他们必须将其传达给客户（业务人员）并让客户提高优先级（客户仍有最终决定权）
*   在团队速度允许的情况下为下一次迭代选择尽可能多的故事

这边走：

*   有一个任务队列，按业务需求排序
*   客户获得最佳投资回报
*   商业价值推动发展，而不是技术或极客
*   开发人员可以说出实现的难度
*   如果没有**投资回报率**，任务将停留在该堆的底部附近

有关更多信息，请参阅*Kent Bech*和*Martin Fowler*的**规划极限编程**。他们说的比我做的要好得多。

 *** * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T19:56:31.070

我不确定该工具是否与流程一样重要。我已经看到团队使用索引卡和白板这样简单的东西来管理相当大的项目非常成功。我建议优先考虑的一件事是确保您拥有这些项目的完整列表。通过这种方式，您可以权衡修复问题与新功能等的优先级。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T20:07:07.283

除了任何工具和流程之外，还应该有……一些人；）

在我们的车间，他被称为**发布经理**，他确定下一个功能范围以交付生产。
然后有一个**Freeze Manager**，他实际上知道代码、文件和错误（他通常是程序员之一），并将强制发布管理器的选择，并监控必要的合并，以便有一些东西要测试然后发布.

在它们两者之间，可以在高级（功能请求）和低级（错误和技术问题）上建立优先级

# javascript - 用于绘制/显示图像的最佳 javascript 框架？

> ID：109149
> 
> 赞同：3
> 
> 时间：2008-09-20T19:53:18.423
> 
> 标签：javascript, toolkit

在图像上绘制（线条、曲线之类的）的最佳 javascript 框架是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T20:16:25.263

jQuery 有几个可用于绘制图形的插件。Raphael 是一个使用 SVG（用于 Firefox 和其他支持 SVG 的浏览器）的插件，以及用于 IE 产品的 VML。此外，jQuery 为 javascript 项目提供了出色的架构，并提供了大量支持和插件。

拉斐尔可在此处获得：[http ://raphaeljs.com/index.html](http://raphaeljs.com/index.html)

jQuery 在这里可用：http: [//jquery.com/](http://jquery.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T20:00:07.410

[加工](http://ejohn.org/blog/processingjs/)

```
var p = Processing(CanvasElement);
p.size(100, 100);
p.background(0);
p.fill(255);
p.ellipse(50, 50, 50, 50); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T20:00:26.817

看看这个库，它是一个 jquery 插件： [http ://www.openstudio.fr/Library-for-simple-drawing-with.html](http://www.openstudio.fr/Library-for-simple-drawing-with.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T20:02:35.547

参考[这个问题](https://stackoverflow.com/questions/96486/javascript-drawing-library#96509)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T20:02:42.163

您可以使用 javascript 的 flot 库创建“图像”。

它在[谷歌代码上：flot](http://code.google.com/p/flot/)
并且需要[jQuery](http://www.jquery.com/)

这是一个示例，[图表的外观](http://people.iola.dk/olau/flot/examples/graph-types.html)

# c# - .NET 报告教程

> ID：109154
> 
> 赞同：3
> 
> 时间：2008-09-20T19:56:15.187
> 
> 标签：c#, .net, reporting

有谁知道 C# .NET 中的报告教程。我的意思是“Microsoft.Reporting”命名空间中的报告（不是 Crystal Reports）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-20T22:31:47.450

我知道您可能不是在寻找可以在 google 上找到的链接，但这些链接非常详细地涵盖了报告服务，并且应该涵盖了您的大部分问题。

1.  [报告服务教程](http://msdn.microsoft.com/en-us/library/ms170246.aspx)
2.  [报告服务简介](http://www.developer.com/net/article.php/3495136)
3.  [报告服务在行动](http://www.codeproject.com/KB/books/MSReportingServices.aspx)
4.  [报告服务网络广播](http://blogs.msdn.com/gsnowman/archive/2005/10/19/482905.aspx)
5.  [有用的报告服务链接](http://sqlblogcasts.com/blogs/thepremiers/archive/2008/08/01/useful-reporting-services-links-good-kickstart-with-the-product.aspx)

但我很确定报告服务与 MS SQL 非常接近，因此如果您不使用它，您可能需要寻找不同的解决方案。

# nhibernate - Strict vs NonStrict NHibernate 缓存并发策略

> ID：109179
> 
> 赞同：13
> 
> 时间：2008-09-20T20:04:59.253
> 
> 标签：nhibernate, caching

这个问题是关于NHibernate二级缓存的ReadWrite和NonStrictReadWrite缓存并发策略的区别。

*据我了解，当您拥有分布式复制*缓存时，这两种策略之间的区别是相关的- nonstrict 不能保证一个缓存具有与另一个缓存完全相同的值，而严格的读/写应该 - 假设缓存提供程序确实适当的分布式锁定。

我不明白的部分是，当您拥有单个缓存或分布式*分区*（非复制）缓存时，严格与非严格的区别是如何相关的。可以相关吗？在我看来，在非复制场景中，时间戳缓存将确保不提供过时的结果。如果它可能是相关的，我想看一个例子。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-21T03:43:15.597

您的假设是正确的，在单个目标/线程环境中几乎没有区别。但是，如果您查看缓存提供程序，即使在多线程场景中也会发生一些事情。

在非严格的情况下，如何从修改状态重新缓存对象是不同的。例如，如果您的对象需要重新加载，但您希望它在更新后重新加载，而不是让下一个用户支付账单，那么您将看到严格与非严格的不同性能。例如：非严格在执行更新后简单地从缓存中转储一个对象......为下一次访问而不是更新后事件处理程序的获取支付价格。在严格模型中，重新缓存是自动处理的。插入也会发生类似的事情，non-strict 不会在 strict 后面执行任何操作并将新插入的对象加载到缓存中。

在非严格的情况下，您也有可能进行脏读，因为在读取时缓存未锁定，您将看不到另一个线程更改项目的结果。严格来说，该项目的缓存键将锁定，您会被阻止，但会看到绝对最新的结果。

因此，即使在单一目标环境中，如果对对象有大量并发读取/编辑，那么您就有机会看到并不准确的数据。

当执行保存并且正在加载编辑屏幕时，这当然会成为一个问题：认为他们正在编辑对象的最新版本的人实际上不是，当他们尝试保存时会遇到令人讨厌的惊喜对他们加载的过时数据的编辑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-23T07:43:02.320

我在这里创建了一个帖子[来](http://anirbanchowdhury.wordpress.com/2012/07/23/hibernate-second-level-cache-ehcache/)解释这些差异。请查看并随时发表评论。

# .net - 在 .Net 中调用 Web 服务时绕过无效的 SSL 证书错误

> ID：109186
> 
> 赞同：89
> 
> 时间：2008-09-20T20:07:16.987
> 
> 标签：.net, web-services, sharepoint

我们正在设置一个新的 SharePoint，我们还没有有效的 SSL 证书。我想在其上调用 Lists Web 服务来检索有关设置的一些元数据。但是，当我尝试这样做时，我得到了异常：

> 基础连接已关闭：无法为 SSL/TLS 安全通道建立信任关系。

嵌套异常包含错误消息：

> 根据验证程序，远程证书无效。

这是正确的，因为我们使用的是临时证书。

我的问题是：如何告诉 .Net Web 服务客户端（*SoapHttpClientProtocol*）忽略这些错误？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2009-01-09T11:57:08.533

或者，您可以注册一个忽略认证错误的回调委托：

```
...
ServicePointManager.ServerCertificateValidationCallback = MyCertHandler;
...

static bool MyCertHandler(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors error)
{
// Ignore errors
return true;
} 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-05-14T21:10:31.920

就像 Jason S 的回答一样：

```
ServicePointManager.ServerCertificateValidationCallback = delegate { return true; }; 
```

我把它放在我的 Main 中，并在调用那行代码之前 查看`app.config`并测试是否。`(ConfigurationManager.AppSettings["IgnoreSSLCertificates"] == "True")`

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2010-08-06T12:23:07.240

我是这样解决的：

在调用导致该错误的 ssl webservice 之前调用以下命令：

```
using System.Net;
using System.Net.Security;
using System.Security.Cryptography.X509Certificates;

/// <summary>
/// solution for exception
/// System.Net.WebException: 
/// The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel. ---> System.Security.Authentication.AuthenticationException: The remote certificate is invalid according to the validation procedure.
/// </summary>
public static void BypassCertificateError()
{
    ServicePointManager.ServerCertificateValidationCallback +=

        delegate(
            Object sender1,
            X509Certificate certificate,
            X509Chain chain,
            SslPolicyErrors sslPolicyErrors)
        {
            return true;
        };
} 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-20T20:51:42.263

遇到此问题时，我使用的方法是将临时证书的签名者添加到相关计算机上的受信任机构列表中。

我通常使用 CACERT 创建的证书进行测试，并将它们添加到我的受信任的权威列表中工作得很好。

这样做意味着您不必向应用程序添加任何自定义代码，并且它可以正确模拟部署应用程序时会发生的情况。因此，我认为这是以编程方式关闭检查的绝佳解决方案。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-02-14T14:47:29.860

我在使用 DownloadString 时遇到了同样的错误；并且能够通过此页面上的建议使其如下工作

```
System.Net.WebClient client = new System.Net.WebClient();            
ServicePointManager.ServerCertificateValidationCallback = delegate { return true; };
string sHttpResonse = client.DownloadString(sUrl); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-02-02T08:47:16.937

```
ServicePointManager.ServerCertificateValidationCallback +=
            (mender, certificate, chain, sslPolicyErrors) => true; 
```

将绕过无效的 ssl 。将其写入您的 Web 服务构造函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-12-16T18:12:40.623

对于新手，您可以在单独的 cs 文件中扩展您的部分服务类，并添加“imanabidi”提供的代码以使其集成

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-04-12T02:22:09.833

为了进一步扩展 Simon Johnson 的帖子 - 理想情况下，您需要一个能够模拟您将在生产中看到的条件的解决方案，并且修改您的代码不会这样做，并且如果您在部署之前忘记将代码取出，则可能会很危险。

您将需要某种自签名证书。如果您使用的是 IIS Express，那么您已经拥有其中之一，您只需找到它。打开 Firefox 或任何您喜欢的浏览器，然后访问您的开发网站。您应该能够从 URL 栏中查看证书信息，并且根据您的浏览器，您应该能够将证书导出到文件中。

接下来，打开 MMC.exe，并添加证书管理单元。将您的证书文件导入受信任的根证书颁发机构存储中，这就是您所需要的。重要的是要确保它进入那家商店，而不是像“个人”这样的其他商店。如果您不熟悉 MMC 或证书，有许多网站提供有关如何执行此操作的信息。

现在，您的计算机作为一个整体将隐式信任它自己生成的任何证书，您无需添加代码来专门处理此问题。当您转移到生产环境时，只要您在那里安装了适当的有效证书，它将继续工作。不要在生产服务器上执行此操作 - 这会很糟糕，并且它不适用于服务器本身以外的任何其他客户端。

# php - 如何检查目录是否可在 PHP 中写入？

> ID：109188
> 
> 赞同：62
> 
> 时间：2008-09-20T20:07:38.657
> 
> 标签：php, permissions, directory

有谁知道我如何检查一个目录是否可以用 PHP 写？

该功能[`is_writable`](http://php.net/manual/en/function.is-writable.php)不适用于文件夹。

> 编辑：它确实有效。请参阅已接受的答案。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-09-20T20:09:44.923

是的，它确实适用于文件夹....

> 如果文件名存在且可写，则返回 TRUE。文件名参数可能是一个目录名，允许您检查目录是否可写。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-09-23T22:58:49.347

这是代码:)

```
<?php 

$newFileName = '/var/www/your/file.txt';

if ( ! is_writable(dirname($newFileName))) {

    echo dirname($newFileName) . ' must writable!!!';
} else {

    // blah blah blah
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-25T07:38:58.713

对所有者/组/世界更具体

```
$dir_writable = substr(sprintf('%o', fileperms($folder)), -4) == "0774" ? "true" : "false"; 
```

和平...

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-10-13T16:31:01.917

您可能正在向`is_writable()`函数发送完整的文件路径。`is_writable()`如果文件在目录中不存在，将返回 false。如果是这种情况，您需要检查已删除文件名的目录本身。如果你这样做，`is_writable`将正确地告诉你目录是否可写。如果`$file`包含您的文件路径，请执行以下操作：

```
$file_directory = dirname($file); 
```

然后用于`is_writable($file_directory)`确定文件夹是否可写。

我希望这可以帮助别人。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-20T20:10:17.587

根据[is_writable 的文档](http://uk.php.net/manual/en/function.is-writable.php)，它应该可以正常工作 - 但您说的是“文件夹”，所以这可能是[Windows 问题](http://bugs.php.net/bug.php?id=27609)。评论提出[了一种解决方法](http://uk.php.net/manual/en/function.is-writable.php#68098)。

（早先的匆忙阅读让我认为尾部斜杠很重要，但事实证明这是针对此工作的）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-08-10T02:39:15.643

我编写了一个小脚本（我称之为*isWritable.php*），它检测脚本所在目录中的所有目录并写入页面，无论每个目录是否可写。希望这可以帮助。

```
<?php
// isWritable.php detects all directories in the same directory the script is in
// and writes to the page whether each directory is writable or not.

$dirs = array_filter(glob('*'), 'is_dir');

foreach ($dirs as $dir) {
    if (is_writable($dir)) {
        echo $dir.' is writable.<br>';
    } else {
        echo $dir.' is not writable. Permissions may have to be adjusted.<br>';
    } 
}
?> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T20:12:29.253

统计（）

很像系统统计信息，但在 PHP 中。您要检查的是模式值，就像您在其他语言（IE C/C++）中对 stat 的任何其他调用一样。

[http://us2.php.net/stat](http://us2.php.net/stat)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T20:09:45.640

根据 PHP 手册[is_writable](http://de3.php.net/is-writable)应该可以在目录上正常工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-03-07T15:30:48.060

在我的情况下，`is_writable`返回 true，但是当尝试写入文件时 - 生成了错误。
此代码有助于检查是否`$dir`存在并且可写：

```
<?php
$dir = '/path/to/the/dir';

// try to create this directory if it doesn't exist
$booExists     = is_dir($dir) || (mkdir($dir, 0774, true) && is_dir($dir));
$booIsWritable = false;
if ($booExists && is_writable($dir)) {
    $tempFile = tempnam($dir, 'tmp');
    if ($tempFile !== false) {
        $res = file_put_contents($tempFile, 'test');

        $booIsWritable = $res !== false;
        @unlink($tempFile);
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-06-16T12:11:57.087

我就是这样做的：

创建一个文件`file_put_contents()`并检查返回值，如果它是正数（写入字节数）那么你可以继续做你必须做的事情，如果它是 FALSE 那么它是不可写的

```
$is_writable = file_put_contents('directory/dummy.txt', "hello");

if ($is_writable > 0) echo "yes directory it is writable";

else echo  "NO directory it is not writable"; 
```

然后您可以使用 unlink() 删除虚拟文件

```
unlink('directory/dummy.txt'); 
```

# asp.net - 从 VSS 部署站点

> ID：109199
> 
> 赞同：2
> 
> 时间：2008-09-20T20:10:53.220
> 
> 标签：asp.net, visual-sourcesafe

在回答[这个问题](https://stackoverflow.com/questions/102833/how-do-i-use-aspnet-with-visual-studio-2008)时乔尔·科霍恩说

> 最后，只有在站点经过合适的 QA 流程后，生产服务器才会从源代码控制更新，而不是从 Visual Studio 中更新。

VSS Explorer 是否有用于部署站点的工具（我假设是通过 FTP）？我第一次注意到 Web/Deploy 菜单选项，但它是灰色的。这是如何运作的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T20:16:23.783

VSS 有一套相当全面的命令行参数。我知道的最好的方法是将批处理文件写入：

1 - 获取最新到本地系统（大概是一个干净的构建机器）

2 - 将新更新的本地文件推送到您的 FTP 站点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T02:40:47.533

我们在项目中使用 Nant。Nant 是 ant for java 的一个点网端口。它具有从 VSS 签出、编译和部署的任务。

*   [南特](http://nant.sf.net)
*   [VSS 签出任务](http://nantcontrib.sourceforge.net/release/latest/help/tasks/vsscheckout.html)
*   [关于使用 Nant 进行部署的 Codeproject 文章](http://www.codeproject.com/KB/applications/webappbuild_Nant.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-22T02:43:14.717

[使用 MS Visual SourceSafe 管理 Web 内容](http://www.microsoft.com/technet/archive/itsolutions/intranet/plan/webvss.mspx)

是的，您可以使用 VSS 资源管理器中的“网络部署”功能通过 ftp 或网络共享进行部署。

# php - PHP GD, imagecreatefromstring(); 如何获得图像尺寸？

> ID：109210
> 
> 赞同：11
> 
> 时间：2008-09-20T20:13:43.587
> 
> 标签：php, image, upload, gd

通常我使用`imagecreatefromjpeg()`and then `getimagesize()`，但是对于 Firefox 3 我需要绕过这个不同的地方。所以现在我正在使用`imagecreatefromstring()`，但我现在如何检索图像尺寸？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-20T20:38:14.730

`imagesx()`和`imagesy()`函数似乎也适用于用 制作的图像`imagecreatefromstring()`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T20:38:44.150

是啊！我刚刚在互联网上找到了答案：）

对于那些仍然感兴趣的人：

```
$image = imagecreatefromstring($img_str);
$w = imagesx($image);
$h = imagesy($image); 
```

# reference - 什么是软件开发参考的最佳在线图书服务？

> ID：109230
> 
> 赞同：5
> 
> 时间：2008-09-20T20:15:54.003
> 
> 标签：reference

我是 ACM 的成员，我对 Books 24x7 和 Safari Books Online 的访问权限有限，但是如果我有兴趣升级到完整帐户以更好地访问其他书籍，您会推荐哪种在线图书服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-20T20:54:04.130

[Safari Books Online](http://www.safaribooksonline.com/whysafari/try-safari.php)提供企业订阅服务，公司对此表示赞赏。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T18:44:14.787

Safari Books Online 是我的选择，这是一个相关的帖子： [您使用哪个在线电子书参考图书馆？](https://stackoverflow.com/questions/179447/which-online-ebook-reference-library-do-you-use)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T20:17:18.570

我有 24x7 的图书，它有很多图书，而且搜索功能运行良好。它还为您提供其他用户的推荐，如果您组织的其他人加入，它会告诉您他们推荐的书籍。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T20:52:28.487

[Audible](http://www.audible.com) - 自我发展、商业和教育部分！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T20:54:36.903

Safari 在线图书.. 到目前为止.. [http://techbus.safaribooksonline.com:80/](http://techbus.safaribooksonline.com:80/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T18:39:43.423

我认为这取决于您想要多少 O'Reilly 和 Pearson Technology 的书籍（其中包括许多较小的出版商，如 Peachpit）。Safari 对这些标题拥有专有权。Safari 也有每月订阅级别，因此您不必承诺一整年。

# sql - 在 SQL Server 中对结果进行分页的最佳方法是什么

> ID：109232
> 
> 赞同：545
> 
> 时间：2008-09-20T20:16:18.633
> 
> 标签：sql, sql-server, performance, pagination

如果您还想获得结果的总数（在分页之前），那么在 SQL Server 2000、2005、2008、2012 中对结果进行分页的最佳方法（性能方面）是什么？

* * *

## 回答 #1

> 赞同：614
> 
> 时间：2012-05-17T15:55:50.977

最后，**Microsoft SQL Server 2012**发布了，我真的很喜欢它对分页的简单性，您不必使用这里回答的复杂查询。

要获取接下来的 10 行，只需运行以下查询：

```
SELECT * FROM TableName ORDER BY id OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY; 
```

[https://docs.microsoft.com/en-us/sql/t-sql/queries/select-order-by-clause-transact-sql#using-offset-and-fetch-to-limit-the-rows-回来](https://docs.microsoft.com/en-us/sql/t-sql/queries/select-order-by-clause-transact-sql#using-offset-and-fetch-to-limit-the-rows-returned)

使用时要考虑的要点：

*   `ORDER BY`必须使用`OFFSET ... FETCH`子句。
*   `OFFSET`条款是强制性的`FETCH`。你不能使用`ORDER BY ... FETCH`.
*   `TOP`不能在同一个查询表达式中与`OFFSET`and组合。`FETCH`

* * *

## 回答 #2

> 赞同：506
> 
> 时间：2008-09-20T20:35:18.323

获取结果总数和分页是两个不同的操作。为了这个例子，让我们假设您正在处理的查询是

```
SELECT * FROM Orders WHERE OrderDate >= '1980-01-01' ORDER BY OrderDate 
```

在这种情况下，您将使用以下方法确定结果总数：

```
SELECT COUNT(*) FROM Orders WHERE OrderDate >= '1980-01-01' 
```

...这可能看起来效率低下，但实际上性能相当不错，假设所有索引等都已正确设置。

接下来，要以分页方式返回实际结果，以下查询将是最有效的：

```
SELECT  *
FROM    ( SELECT    ROW_NUMBER() OVER ( ORDER BY OrderDate ) AS RowNum, *
          FROM      Orders
          WHERE     OrderDate >= '1980-01-01'
        ) AS RowConstrainedResult
WHERE   RowNum >= 1
    AND RowNum < 20
ORDER BY RowNum 
```

这将返回原始查询的第 1-19 行。这里很酷的事情，尤其是对于网络应用程序，是您不必保留任何状态，除了要返回的行号。

* * *

## 回答 #3

> 赞同：130
> 
> 时间：2013-10-26T17:51:18.857

令人难以置信的是，没有其他答案提到在所有 SQL Server 版本中进行分页的*最快方法。*对于大页码，偏移量可能会非常慢，正如[这里的基准测试](http://www.4guysfromrolla.com/webtech/042606-1.shtml)一样。在 SQL 中执行分页有一种完全不同的、更快的方法。这通常被称为“seek 方法”或“keyset pagination”，[如此处的博](http://blog.jooq.org/2013/10/26/faster-sql-paging-with-jooq-using-the-seek-method/)文中所述。

```
SELECT TOP 10 first_name, last_name, score, COUNT(*) OVER()
FROM players
WHERE (score < @previousScore)
   OR (score = @previousScore AND player_id < @previousPlayerId)
ORDER BY score DESC, player_id DESC 
```

### “寻找谓词”

`@previousScore`和`@previousPlayerId`值是上一页最后一条记录的相应值。这允许您获取“下一页”。如果`ORDER BY`方向是`ASC`，只需使用即可`>`。

使用上述方法，您不能在没有先获取前 40 条记录的情况下立即跳转到第 4 页。但通常，无论如何你都不想跳那么远。相反，您将获得更快的查询，该查询可能能够在恒定时间内获取数据，具体取决于您的索引。另外，您的页面保持“稳定”，无论基础数据是否发生变化（例如，在第 1 页，而您在第 4 页）。

例如，当在 Web 应用程序中延迟加载更多数据时，这是实现分页的最佳方式。

请注意，“seek 方法”也称为[keyset pagination](https://stackoverflow.com/a/3215973/521799)。

### 分页前的总记录

窗口功能将`COUNT(*) OVER()`帮助您计算“分页前”的总记录数。如果您使用的是 SQL Server 2000，您将不得不对`COUNT(*)`.

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2016-01-14T14:44:39.973

从SQL Server 2012开始，我们可以使用`OFFSET`and `FETCH NEXT`Clause来实现分页。

试试这个，对于 SQL Server：

> 在 SQL Server 2012 中，在 ORDER BY 子句中添加了一项新功能，用于查询优化一组数据，使任何使用 T-SQL 编写的人以及 SQL Server 中的整个执行计划都可以更轻松地进行数据分页。
> 
> 在 T-SQL 脚本下方，其逻辑与前一个示例中使用的逻辑相同。
> 
> ```
> --CREATING A PAGING WITH OFFSET and FETCH clauses IN "SQL SERVER 2012"
> DECLARE @PageNumber AS INT, @RowspPage AS INT
> SET @PageNumber = 2
> SET @RowspPage = 10 
> SELECT ID_EXAMPLE, NM_EXAMPLE, DT_CREATE
> FROM TB_EXAMPLE
> ORDER BY ID_EXAMPLE
> OFFSET ((@PageNumber - 1) * @RowspPage) ROWS
> FETCH NEXT @RowspPage ROWS ONLY; 
> ```

[TechNet：使用 SQL Server 分页查询](http://social.technet.microsoft.com/wiki/contents/articles/23811.paging-a-query-with-sql-server.aspx)

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2012-10-31T08:09:15.080

[MSDN：ROW_NUMBER (Transact-SQL)](https://msdn.microsoft.com/en-us/library/ms186734%28v=sql.105%29.aspx)

> 返回结果集分区内行的序号，每个分区的第一行从 1 开始。
> 
> 以下示例按照 OrderDate 的顺序返回编号为 50 到 60 的行。

```
WITH OrderedOrders AS
(
    SELECT
        ROW_NUMBER() OVER(ORDER BY FirstName DESC) AS RowNumber, 
        FirstName, LastName, ROUND(SalesYTD,2,1) AS "Sales YTD"
    FROM [dbo].[vSalesPerson]
) 
SELECT RowNumber, 
    FirstName, LastName, Sales YTD 
FROM OrderedOrders 
WHERE RowNumber > 50 AND RowNumber < 60; 
```

```
 RowNumber FirstName    LastName               SalesYTD
  --- -----------  ---------------------- -----------------
  1   Linda        Mitchell               4251368.54
  2   Jae          Pak                    4116871.22
  3   Michael      Blythe                 3763178.17
  4   Jillian      Carson                 3189418.36
  5   Ranjit       Varkey Chudukatil      3121616.32
  6   José         Saraiva                2604540.71
  7   Shu          Ito                    2458535.61
  8   Tsvi         Reiter                 2315185.61
  9   Rachel       Valdez                 1827066.71
  10  Tete         Mensa-Annan            1576562.19
  11  David        Campbell               1573012.93
  12  Garrett      Vargas                 1453719.46
  13  Lynn         Tsoflias               1421810.92
  14  Pamela       Ansman-Wolfe           1352577.13 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-09-20T20:51:37.257

[http://www.codeproject.com/KB/aspnet/PagingLarge.aspx](http://www.codeproject.com/KB/aspnet/PagingLarge.aspx)对不同的分页技术有很好的概述

我经常在 SQL Server 2000 中使用 ROWCOUNT 方法（也适用于 2005 和 2008，只是测量与 ROW_NUMBER 相比的性能），它快如闪电，但您需要确保已排序的列（主要是) 独特的价值。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-03-27T18:25:28.257

对于 SQL Server 2000，您可以使用带有 IDENTITY 列的表变量来模拟 ROW_NUMBER()：

```
DECLARE @pageNo int -- 1 based
DECLARE @pageSize int
SET @pageNo = 51
SET @pageSize = 20

DECLARE @firstRecord int
DECLARE @lastRecord int
SET @firstRecord = (@pageNo - 1) * @pageSize + 1 -- 1001
SET @lastRecord = @firstRecord + @pageSize - 1   -- 1020

DECLARE @orderedKeys TABLE (
  rownum int IDENTITY NOT NULL PRIMARY KEY CLUSTERED,
  TableKey int NOT NULL
)

SET ROWCOUNT @lastRecord
INSERT INTO @orderedKeys (TableKey) SELECT ID FROM Orders WHERE OrderDate >= '1980-01-01' ORDER BY OrderDate

SET ROWCOUNT 0

SELECT t.*
FROM Orders t
  INNER JOIN @orderedKeys o ON o.TableKey = t.ID
WHERE o.rownum >= @firstRecord
ORDER BY o.rownum 
```

这种方法可以扩展到具有多列键的表，并且不会产生使用 OR 的性能开销（跳过索引使用）。不利的一面是，如果数据集非常大并且靠近最后一页，则会占用大量临时空间。在那种情况下，我没有测试游标性能，但它可能会更好。

请注意，这种方法可以针对第一页数据进行优化。此外，由于 TOP 在 SQL Server 2000 中不接受变量，因此使用了 ROWCOUNT。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-01-15T05:23:42.640

在 sql server 2012 中进行分页的最佳方式是在存储过程中使用偏移量和获取下一个。 **OFFSET 关键字**- 如果我们在 order by 子句中使用偏移量，那么查询将跳过我们在 OFFSET n Rows 中指定的记录数。

**FETCH NEXT 关键字**- 当我们将 Fetch Next 与 order by 子句一起使用时，它只会返回要在分页中显示的行数，如果没有 Offset，则 SQL 将生成错误。这是下面给出的示例。

```
create procedure sp_paging
(
 @pageno as int,
 @records as int
)
as
begin
declare @offsetcount as int
set @offsetcount=(@pageno-1)*@records
select id,bs,variable from salary order by id offset @offsetcount rows fetch Next @records rows only
end 
```

您可以按如下方式执行它。

```
exec sp_paging 2,3 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-05-29T14:23:23.137

试试这个方法：

```
SELECT TOP @offset a.*
FROM (select top @limit b.*, COUNT(*) OVER() totalrows 
        from TABLENAME b order by id asc) a
ORDER BY id desc; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-10-19T22:30:30.950

这些是我在 SQL 服务器端对查询结果进行分页的解决方案。这些方法在 SQL Server 2008 和 2012 之间是不同的。此外，我还添加了筛选和排序的概念。当您在 Gridview 中进行分页、过滤和排序时，它非常有效。

在测试之前，您必须创建一个示例表并在该表中插入一些行：（在现实世界中，您必须考虑您的表字段来更改 Where 子句，也许您在选择的主要部分有一些连接和子查询）

```
Create Table VLT
(
    ID int IDentity(1,1),
    Name nvarchar(50),
    Tel Varchar(20)
)
GO

Insert INTO VLT
VALUES
    ('NAME' + Convert(varchar(10),@@identity),'FAMIL' + Convert(varchar(10),@@identity))
GO 500000 
```

在所有这些示例中，我想每页查询 200 行，并且我正在获取第 1200 页的行。

在 SQL server 2008 中，您可以使用 CTE 概念。因此，我为 SQL Server 2008+ 编写了两种类型的查询

-- SQL Server 2008+

```
DECLARE @PageNumber Int = 1200
DECLARE @PageSize INT = 200
DECLARE @SortByField int = 1 --The field used for sort by
DECLARE @SortOrder nvarchar(255) = 'ASC' --ASC or DESC
DECLARE @FilterType nvarchar(255) = 'None' --The filter type, as defined on the client side (None/Contain/NotContain/Match/NotMatch/True/False/)
DECLARE @FilterValue nvarchar(255) = '' --The value the user gave for the filter
DECLARE @FilterColumn int = 1 --The column to wich the filter is applied, represents the column number like when we send the information.

SELECT 
  Data.ID,
  Data.Name,
  Data.Tel
FROM
  (  
    SELECT 
      ROW_NUMBER() 
        OVER( ORDER BY 
                CASE WHEN @SortByField = 1 AND @SortOrder = 'ASC'
                      THEN VLT.ID END ASC,
                CASE WHEN @SortByField = 1 AND @SortOrder = 'DESC'
                      THEN VLT.ID END DESC,
                CASE WHEN @SortByField = 2 AND @SortOrder = 'ASC'
                      THEN VLT.Name END ASC,
                CASE WHEN @SortByField = 2 AND @SortOrder = 'DESC'
                      THEN VLT.Name END ASC,
                CASE WHEN @SortByField = 3 AND @SortOrder = 'ASC'
                      THEN VLT.Tel END ASC,
                CASE WHEN @SortByField = 3 AND @SortOrder = 'DESC'
                      THEN VLT.Tel END ASC
         ) AS RowNum
      ,*  
    FROM VLT 
    WHERE
      ( -- We apply the filter logic here
        CASE
          WHEN @FilterType = 'None' THEN 1

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 1
            AND VLT.ID = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 1
            AND VLT.ID <> @FilterValue THEN 1               

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 2
            AND VLT.Name = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 2
            AND VLT.Name <> @FilterValue THEN 1         

         -- Tel column filter   
         WHEN @FilterType = 'Contain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 3
            AND VLT.Tel = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 3
            AND VLT.Tel <> @FilterValue THEN 1    

        END
      ) = 1   
  ) AS Data
WHERE Data.RowNum > @PageSize * (@PageNumber - 1)
  AND Data.RowNum <= @PageSize * @PageNumber
ORDER BY Data.RowNum

GO 
```

在 SQL Server 2008+ 中使用 CTE 的第二个解决方案

```
DECLARE @PageNumber Int = 1200
DECLARE @PageSize INT = 200
DECLARE @SortByField int = 1 --The field used for sort by
DECLARE @SortOrder nvarchar(255) = 'ASC' --ASC or DESC
DECLARE @FilterType nvarchar(255) = 'None' --The filter type, as defined on the client side (None/Contain/NotContain/Match/NotMatch/True/False/)
DECLARE @FilterValue nvarchar(255) = '' --The value the user gave for the filter
DECLARE @FilterColumn int = 1 --The column to wich the filter is applied, represents the column number like when we send the information.

;WITH
  Data_CTE
  AS
  (  
    SELECT 
      ROW_NUMBER() 
        OVER( ORDER BY 
                CASE WHEN @SortByField = 1 AND @SortOrder = 'ASC'
                      THEN VLT.ID END ASC,
                CASE WHEN @SortByField = 1 AND @SortOrder = 'DESC'
                      THEN VLT.ID END DESC,
                CASE WHEN @SortByField = 2 AND @SortOrder = 'ASC'
                      THEN VLT.Name END ASC,
                CASE WHEN @SortByField = 2 AND @SortOrder = 'DESC'
                      THEN VLT.Name END ASC,
                CASE WHEN @SortByField = 3 AND @SortOrder = 'ASC'
                      THEN VLT.Tel END ASC,
                CASE WHEN @SortByField = 3 AND @SortOrder = 'DESC'
                      THEN VLT.Tel END ASC
         ) AS RowNum
      ,*  
    FROM VLT
    WHERE
      ( -- We apply the filter logic here
        CASE
          WHEN @FilterType = 'None' THEN 1

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 1
            AND VLT.ID = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 1
            AND VLT.ID <> @FilterValue THEN 1               

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 2
            AND VLT.Name = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 2
            AND VLT.Name <> @FilterValue THEN 1         

         -- Tel column filter   
         WHEN @FilterType = 'Contain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 3
            AND VLT.Tel = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 3
            AND VLT.Tel <> @FilterValue THEN 1    

        END
      ) = 1     
  )

SELECT 
  Data.ID,
  Data.Name,
  Data.Tel
FROM Data_CTE AS Data
WHERE Data.RowNum > @PageSize * (@PageNumber - 1)
  AND Data.RowNum <= @PageSize * @PageNumber
ORDER BY Data.RowNum 
```

-- SQL Server 2012+

```
DECLARE @PageNumber Int = 1200
DECLARE @PageSize INT = 200
DECLARE @SortByField int = 1 --The field used for sort by
DECLARE @SortOrder nvarchar(255) = 'ASC' --ASC or DESC
DECLARE @FilterType nvarchar(255) = 'None' --The filter type, as defined on the client side (None/Contain/NotContain/Match/NotMatch/True/False/)
DECLARE @FilterValue nvarchar(255) = '' --The value the user gave for the filter
DECLARE @FilterColumn int = 1 --The column to wich the filter is applied, represents the column number like when we send the information.

;WITH
  Data_CTE
  AS
  (  
    SELECT 
      *  
    FROM VLT
    WHERE
      ( -- We apply the filter logic here
        CASE
          WHEN @FilterType = 'None' THEN 1

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 1
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.ID NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 1
            AND VLT.ID = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 1
            AND VLT.ID <> @FilterValue THEN 1               

          -- Name column filter
          WHEN @FilterType = 'Contain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 2
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Name NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 2
            AND VLT.Name = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 2
            AND VLT.Name <> @FilterValue THEN 1         

         -- Tel column filter   
         WHEN @FilterType = 'Contain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'NotContain' AND @FilterColumn = 3
            AND ( -- In this case, when the filter value is empty, we want to show everything.
                VLT.Tel NOT LIKE '%' + @FilterValue + '%'
               OR
                @FilterValue = ''
               ) THEN 1
          WHEN @FilterType = 'Match' AND @FilterColumn = 3
            AND VLT.Tel = @FilterValue THEN 1
          WHEN @FilterType = 'NotMatch' AND @FilterColumn = 3
            AND VLT.Tel <> @FilterValue THEN 1    

        END
      ) = 1         
  )

SELECT 
  Data.ID,
  Data.Name,
  Data.Tel
FROM Data_CTE AS Data
ORDER BY 
    CASE WHEN @SortByField = 1 AND @SortOrder = 'ASC'
        THEN Data.ID END ASC,
    CASE WHEN @SortByField = 1 AND @SortOrder = 'DESC'
        THEN Data.ID END DESC,
    CASE WHEN @SortByField = 2 AND @SortOrder = 'ASC'
        THEN Data.Name END ASC,
    CASE WHEN @SortByField = 2 AND @SortOrder = 'DESC'
        THEN Data.Name END ASC,
    CASE WHEN @SortByField = 3 AND @SortOrder = 'ASC'
        THEN Data.Tel END ASC,
    CASE WHEN @SortByField = 3 AND @SortOrder = 'DESC'
        THEN Data.Tel END ASC
OFFSET @PageSize * (@PageNumber - 1) ROWS FETCH NEXT @PageSize ROWS ONLY; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2020-01-17T10:10:14.187

从 2012 年起，我们可以使用 `OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY`

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-11-28T04:57:36.577

用例明智，以下似乎易于使用且快速。只需设置页码。

```
use AdventureWorks
DECLARE @RowsPerPage INT = 10, @PageNumber INT = 6;
with result as(
SELECT SalesOrderDetailID, SalesOrderID, ProductID,
ROW_NUMBER() OVER (ORDER BY SalesOrderDetailID) AS RowNum
FROM Sales.SalesOrderDetail
where 1=1
)
select SalesOrderDetailID, SalesOrderID, ProductID from result
WHERE result.RowNum BETWEEN ((@PageNumber-1)*@RowsPerPage)+1
AND @RowsPerPage*(@PageNumber) 
```

也没有 CTE

```
use AdventureWorks
DECLARE @RowsPerPage INT = 10, @PageNumber INT = 6
SELECT SalesOrderDetailID, SalesOrderID, ProductID
FROM (
SELECT SalesOrderDetailID, SalesOrderID, ProductID,
ROW_NUMBER() OVER (ORDER BY SalesOrderDetailID) AS RowNum
FROM Sales.SalesOrderDetail
where 1=1
 ) AS SOD
WHERE SOD.RowNum BETWEEN ((@PageNumber-1)*@RowsPerPage)+1
AND @RowsPerPage*(@PageNumber) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-12-03T12:17:43.553

这是 2012 年旧 SO 问题的副本： [Efficient way to implement paging](https://stackoverflow.com/questions/548475/efficient-way-to-implement-paging/13991192#13991192)

> FROM [TableX] ORDER BY [FieldX] OFFSET 500 ROWS FETCH NEXT 100 ROWS ONLY

[此处](https://sqlperformance.com/2015/01/t-sql-queries/pagination-with-offset-fetch)将更详细地讨论该主题，并采用替代方法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-11-19T16:34:42.813

我们可以使用**LIMIT在 SQL 中实现分页**

```
SELECT * FROM table_name ORDER BY column_name LIMIT <start_index>,<end_index> 
```

我们可以将 1 作为第 1 页的 id，将 2 作为第 2 页的 id 等等，让我们将页码视为 id

```
n = numberOfRecordsInEachPage  
start_index = id * n - n  
end_index = n 
```

一般查询

```
SELECT * FROM table_name ORDER BY column_name LIMIT <skip_rows>,<number_of_rows_to_display_after_skipping> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-06-11T11:18:53.043

好吧，我在我的 SQL 2000 数据库中使用了以下示例查询，它也适用于 SQL 2005。它为您提供的功能是通过使用多个列来动态排序。我告诉你......这很强大:)

```
 ALTER PROCEDURE [dbo].[RE_ListingReports_SelectSummary] 

@CompanyID  int,
@pageNumber     int,
@pageSize   int, 
@sort       varchar(200)
AS

DECLARE @sql nvarchar(4000)
DECLARE @strPageSize nvarchar(20)
DECLARE @strSkippedRows nvarchar(20)
DECLARE @strFields nvarchar(4000)
DECLARE @strFilter nvarchar(4000)
DECLARE @sortBy nvarchar(4000)
DECLARE @strFrom nvarchar(4000)
DECLARE @strID nvarchar(100)

If(@pageNumber < 0)
  SET @pageNumber = 1
SET @strPageSize = CAST(@pageSize AS varchar(20)) 
SET @strSkippedRows = CAST(((@pageNumber - 1) * @pageSize) AS varchar(20))-- For    example if pageNumber is 5  pageSize is 10, then SkippedRows = 40.
SET @strID = 'ListingDbID'
SET @strFields = 'ListingDbID,
ListingID,  
[ExtraRoom]
'
SET @strFrom = ' vwListingSummary '

SET @strFilter = ' WHERE
        CompanyID = ' + CAST(@CompanyID As varchar(20)) 
End
SET @sortBy = ''
if(len(ltrim(rtrim(@sort))) > 0)
SET @sortBy = ' Order By ' + @sort

-- Total Rows Count

SET @sql =  'SELECT Count(' + @strID + ')  FROM ' + @strFROM + @strFilter
EXEC sp_executesql @sql

--// This technique is used in a Single Table pagination
SET @sql = 'SELECT ' + @strFields + ' FROM ' + @strFROM +
    ' WHERE ' + @strID +  ' IN ' + 
   '  (SELECT TOP ' + @strPageSize + ' ' + @strID + ' FROM ' + @strFROM + @strFilter + 
             ' AND  ' + @strID + ' NOT IN ' + '
          (SELECT TOP ' + @strSkippedRows + ' ' + @strID + ' FROM ' + @strFROM + @strFilter + @SortBy + ') ' 
   + @SortBy + ') ' + @SortBy
Print @sql 
EXEC sp_executesql @sql 
```

最好的部分是 sp_executesql 缓存以后的调用，前提是您传递相同的参数，即生成相同的 sql 文本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-03-13T02:45:45.290

```
 CREATE view vw_sppb_part_listsource as 
    select row_number() over (partition by sppb_part.init_id order by sppb_part.sppb_part_id asc ) as idx, * from (
      select 
          part.SPPB_PART_ID
          , 0 as is_rev
          , part.part_number 
          , part.init_id 
      from t_sppb_init_part part 
      left join t_sppb_init_partrev prev on ( part.SPPB_PART_ID = prev.SPPB_PART_ID )
      where prev.SPPB_PART_ID is null 
      union 
      select 
          part.SPPB_PART_ID
          , 1 as is_rev
          , prev.part_number 
          , part.init_id 
      from t_sppb_init_part part 
      inner join t_sppb_init_partrev prev on ( part.SPPB_PART_ID = prev.SPPB_PART_ID )
    ) sppb_part 
```

当涉及到不同的 init_id 时将重新启动 idx

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-02-12T05:16:33.450

对于该`ROW_NUMBER`技术，如果您没有要使用的排序列，则可以使用[`CURRENT_TIMESTAMP`](https://msdn.microsoft.com/en-us/library/ms188751.aspx)如下：

```
SELECT TOP 20 
    col1,
    col2,
    col3,
    col4
FROM (
    SELECT 
         tbl.col1 AS col1
        ,tbl.col2 AS col2
        ,tbl.col3 AS col3
        ,tbl.col4 AS col4
        ,ROW_NUMBER() OVER (
            ORDER BY CURRENT_TIMESTAMP
            ) AS sort_row
    FROM dbo.MyTable tbl
    ) AS query
WHERE query.sort_row > 10
ORDER BY query.sort_row 
```

这对我来说非常适合搜索甚至高达 700,000 的表大小。

**这将获取记录 11 到 30。**

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-06-17T21:37:36.843

> ```
> create PROCEDURE SP_Company_List (@pagesize int = -1 ,@pageindex int= 0   ) > AS BEGIN  SET NOCOUNT ON;
> 
>     select  Id , NameEn     from Company  ORDER by Id ASC  
> OFFSET (@pageindex-1 )* @pagesize   ROWS FETCH NEXt @pagesize ROWS ONLY END  GO 
> ```
> 
> * * *
> 
> ```
> DECLARE   @return_value int
> 
> EXEC  @return_value = [dbo].[SP_Company_List]         @pagesize = 1 ,         > @pageindex = 2
> 
> SELECT    'Return Value' = @return_value
> 
> GO 
> ```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-27T16:23:19.140

此位使您能够使用 SQL Server 和更新版本的 MySQL 进行分页，并携带每行中的总行数。使用您的主键来计算唯一行的数量。

```
WITH T AS
(  
  SELECT TABLE_ID, ROW_NUMBER() OVER (ORDER BY TABLE_ID) AS RN
  , (SELECT COUNT(TABLE_ID) FROM TABLE) AS TOTAL 
  FROM TABLE (NOLOCK)
)

SELECT T2.FIELD1, T2.FIELD2, T2.FIELD3, T.TOTAL 
FROM TABLE T2 (NOLOCK)
INNER JOIN T ON T2.TABLE_ID=T.TABLE_ID
WHERE T.RN >= 100
AND T.RN < 200 
```

* * *

## 回答 #20

> 赞同：-21
> 
> 时间：2008-09-20T20:23:51.877

您没有指定语言或您使用的驱动程序。所以我抽象地描述它。

*   创建一个可滚动的结果集/数据集。这需要表上的主节点
*   跳到最后
*   请求行数
*   跳转到页面的开头
*   滚动行直到页面末尾

# c - 为什么没有标准的 memswap 功能

> ID：109249
> 
> 赞同：21
> 
> 时间：2008-09-20T20:21:47.250
> 
> 标签：c

为什么 c 标准没有 memswap 函数，它可能看起来像：

```
int memswap(void *ptr1, void *ptr2, size_t nbytes)? 
```

我知道它很容易编写，但我认为 libc 可以做一些很棒的技巧来加速它，就像一些实现为 memcpy 做的那样。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-20T20:38:58.487

我认为因为它并不经常需要。但是，在 C++ 中有一种简单的方法可以做到这一点：

```
#include <algorithm>

swap_ranges(ptr1, ptr1 + nbytes, ptr2) 
```

它可能没有内置编译器那么优化，但它有可能比您自己编写的循环更快，因为它可能具有您不会实现的特定于平台的优化。

您确实需要小心上述内容，因为它假定 ptr1 和 ptr2 是 char 指针。更规范的方法是：

```
#include <algorithm>

swap_ranges(ptr1, ptr1 + num_items, ptr2) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-21T15:21:50.863

这不是通常需要的东西。

这些想法可能已被考虑并放弃，因为很难提出通用的算法。不要忘记 C 是一门古老的语言，扩展需要普遍有用。

可能的错误情况：-

*   交换范围重叠时的行为
*   长度为零
*   内存不足（最佳实现可能会为此分配内存）
*   空指针

**最好**的算法也可能取决于您在做什么，因此您*可以*更好地直接编码。

*   使用临时结构和赋值可能会更快地交换结构
*   小长度 - 可能更好地分配临时内存
*   long lengths - 'section' by section 交换（其中 section 是一些最佳长度）
*   使用硬件复制功能

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T20:24:02.827

可能是因为它并不经常需要——我相当频繁地 memset 和 memcpy，但我不知道我是否曾经使用过 memswap，如果它可用的话。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T20:42:22.177

在 C 编程中可能并不经常需要它，在 C++ 中，交换是对类成员进行的常规操作，因此[std::swap](http://www.sgi.com/tech/stl/swap.html)算法针对不同类型进行了高度优化。

# sql - 在访问报表中绑定 TRANSFORM 查询

> ID：109251
> 
> 赞同：2
> 
> 时间：2008-09-20T20:22:09.103
> 
> 标签：sql, ms-access, report, transform

使用交叉表查询时，将变量列名绑定到 Access 中的报表字段的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T21:56:33.620

此页面包含在 Access 中设置动态列（“交叉表”类型）报告的详尽示例。

[http://www.blueclaw-db.com/report_dynamic_crosstab_field.htm](http://www.blueclaw-db.com/report_dynamic_crosstab_field.htm)

（来自谷歌搜索：访问变换查询报告）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T21:54:16.690

我发现的将列从交叉表查询绑定到报告的最佳文章来自[ewbi.develops](http://ewbi.blogs.com/develops/2005/01/access_sql_tran.html)的注释。

具体来说，

```
PARAMETERS foryear Short;
TRANSFORM Sum(mytable.amount) AS total
SELECT mytable.project
FROM mytable
WHERE mytable.year In ([foryear],[foryear]+1)
GROUP BY mytable.project
PIVOT IIf(mytable.year=[foryear],"thisyear","nextyear") IN ("thisyear", "nextyear"); 
```

这仅显示可以根据需要绑定的两列。

# c# - WinForms 上下文菜单 - 在某些部分未打开/检测底层控件

> ID：109262
> 
> 赞同：1
> 
> 时间：2008-09-20T20:24:38.973
> 
> 标签：c#, .net, winforms, contextmenu

我有一个 .NET 2.0 Windows 窗体应用程序。在这个应用程序上有一个带有菜单栏和状态栏的表单控件。此表单上还有一个 ListView。

如果我向该表单添加上下文菜单，则当用户右键单击表单的任何部分（包括菜单栏和状态栏）时，上下文菜单将打开。

1.  当单击菜单栏/状态栏时，如何防止上下文菜单打开？我希望它仅在单击表单的“灰色区域”时打开。

2.  如果单击发生在此窗体上的控件上方（例如，在 ListView 上），我如何识别它？我想知道用户是否右键单击了灰色区域上方或 ListView 上方，因此我可以基于此启用/禁用某些菜单项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T20:53:21.260

将 Statusbar 放在底部并将 MenuStrip 放在顶部之后，

1.  将表单上的 ContextMenuStrip 设置为*None*
2.  在中间放置一个标准面板（在 MenuStrip 和 StatusStrip 之间），并将*Dock*属性设置为*Fill*。
3.  *在Panel*上（而不是在窗体上）设置 ContextMenuStrip 属性。

并将 ListView 和所有其他应该进入*Panel表单的控件*

例如

~~~~~~~~~~~~~

菜单条

~~~~~~~~~~~~~

控制板。停靠=填充。ContextMenuStrip=你的上下文菜单。

~~~~~~~~~~~~~

状态条

~~~~~~~~~~~~~

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T20:50:06.167

我找到了答案：

```
Point clientPos = this.PointToClient(Form.MousePosition);
Control control = this.GetChildAtPoint(clientPos); 
```

这应该提供在窗体上单击的基础控件，如果单击是在灰色区域上，则为 null。所以我们只需要在上下文菜单的Opening事件上测试控件的类型。如果是 MenuStrip、ToolStrip 或 StatusStrip，请执行 e.Cancel = true;。

# c# - 将属性数据绑定到两个依赖属性中的任何一个

> ID：109275
> 
> 赞同：1
> 
> 时间：2008-09-20T20:28:15.690
> 
> 标签：c#, wpf, data-binding, xaml

我有两个类似于节点的自定义控件和在节点之间绘制链接的控件。

我希望尽可能多地用 xaml 编写这两个控件。该链接将两个节点都存储为依赖属性，并且每当节点移动时，我都会使用数据绑定来移动节点之间的线。

能够根据两个节点之间的距离更改线条的其他值（例如笔划宽度）会很棒。因此，当任一节点移动时，该属性都需要更新，我无法完全理解它是如何工作的。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-22T23:46:29.470

你可以尝试做这样的事情：

1.  与上一篇文章一样，在链接类上定义宽度、笔触（无论您需要什么）属性
2.  定义应用于该属性的多重绑定，将您的两个节点传递给它应该如下所示的绑定：

> <Multibinding Converter="{StaticResource converter}">
> <Binding Path="Node1" RelativeSource|Source.../>
> <Binding Path="Node2" ... />
> </Multibinding>

3.  实现接口IMultiValueConverter，它基本上会根据节点之间的距离计算笔画应该是什么样子。

4.  在 xaml 创建转换器的实例，并将其添加到多重绑定的 Converter 属性中。

该解决方案的优点是，您拥有非常清晰的类模型，并且每个类都执行简单的任务。此外，稍后，您可以配置您的转换器类以支持额外的情况，而无需触及节点类，该类保持简单并且仅用于显示节点。

通常，每当您必须将多个属性值映射到另一个属性时，您都必须使用多重绑定和转换器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T20:43:34.873

您可以在链接类中定义一个属性 StrokeWidth，每次节点移动时都会计算该属性，然后将适当的样式属性绑定到它。

我想你也可以尝试用 DataTriggers 做一些事情，但它们需要特定的值才能使用——你不能使用任何类型的表达式。这将使解决方案难以很好地扩展到节点之间的广泛距离。

# .net - 在 ASP.NET 中，当 HttpContext.Current 为 NULL 时如何获取物理文件路径？

> ID：109280
> 
> 赞同：8
> 
> 时间：2008-09-20T20:29:47.650
> 
> 标签：.net, asp.net, dotnetnuke, scheduler, server.mappath

我正在使用 DotNetNuke 的调度程序来安排任务，并且我正在寻找我创建的电子邮件模板的物理文件路径。问题是 HttpContext 为 NULL，因为计划任务在不同的线程上，并且没有 http 请求。您将如何获取文件的物理路径？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T13:53:26.293

[System.Web.Hosting.HostingEnvironment.MapPath](http://msdn.microsoft.com/en-us/library/system.web.hosting.hostingenvironment.mappath.aspx)是您正在寻找的。每当您使用 Server 或 HttpContext.Current 对象时，请先检查[HostingEnvironment](http://msdn.microsoft.com/en-us/library/system.web.hosting.hostingenvironment.aspx)是否具有您需要的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T15:44:33.513

有很多方法可以做到这一点，我个人通过将路径信息存储为我的模块的配置选项来解决它，它并不优雅，但它每次都能正常工作。

我相信在某个地方的 Joe Brinkman 有一篇关于如何构造新的 HTTPContext 以在调度程序中使用的博客文章。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T20:33:50.590

由于这个过程对于网站来说确实是带外的，也许你可以把路径放在一个配置文件中。

可能不是最好的主意，但它是一个替代方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T20:37:19.537

this.GetType().Assembly.Location 怎么说？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T20:43:18.633

您能像这样查看 Assembly 和 CodeBase 路径吗：

```
Imports System.Reflection
Imports System.IO
...
Path.GetDirectoryName( Assembly.GetExecutingAssembly().CodeBase ) 
```

这种东西并不总是有效，所以我建议做的是写一个包含一堆关于程序集的数据的日志，看看在这个位置有什么用。当我创建要在 AppCenter 中托管的 COM 组件时，我必须这样做才能获得类似的东西。我用它来“获取”“APP_BASE”应该是什么，并设置它，以便 app.config 文件正确加载。

```
Log.Write ( Assembly.GetExecutingAssembly().CodeBase )
Log.Write ( Assembly.GetExecutingAssembly().Location )
Log.Write ( Path.GetFullPath(".") )
Log.Write ( Application.StartupPath )
... and so on, whatever you can think of ... 
```

# visual-studio-2008 - BSCMAKE：错误 BK1506：无法打开文件 StdAfx.sbr 没有这样的文件或目录

> ID：109281
> 
> 赞同：7
> 
> 时间：2008-09-20T20:29:53.127
> 
> 标签：visual-studio-2008, visual-studio-2005, compilation, .sbr

我已将我的 VS2006 项目之一转换为 VS2008，当尝试在 VS2008 中构建项目时，出现上述错误。什么是 .sbr 文件？以及如何修复编译错误？非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-01-27T12:23:00.080

你可以去：
**配置属性 -> C/C++ -> 浏览信息**

删除`Enable Browse Information`（将其设置为`No`）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-20T21:43:33.167

.sbr 文件用于保存项目中符号浏览的“浏览信息”。它是在编译其源 .cpp 文件的同时创建的。

如果 VS 找不到 .sbr 文件，则意味着源 .cpp 没有正确编译。尝试“重建”项目（而不仅仅是“构建”它），它可能会修复错误。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-10-20T10:08:33.323

检查（手动）您的 .vcproj 文件，以`<BrowseFileInformation></BrowseFileInformation>`获取您正在编译的配置的配置部分中的属性标记。如果你的中间目录是正常的 $(IntDir)，那么空属性告诉编译将 SBR 文件放在与源文件相同的目录中，但是 BSCMAKE 命令在 $(IntDir) 目录中查找它们（他们不在那里）。

删除`<BrowseFileInformation></BrowseFileInformation>`.vcproj 文件中的行（您必须通过手动编辑文件来执行此操作；在 VS2010 或 VS2008 中设置属性不会这样做）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-20T15:13:26.763

我通过 VS 向导在我的项目中添加一个新类来解决这个问题。

我不得不更改“class.cpp”和“class.h”的位置，所以我将它们复制粘贴到正确的目录中。然后，我通过 VS 向导使用它的新路径将它们添加到我的项目中，最终在生成（和重新生成）我的项目后得到 BSCMAKE 错误。我在另一个错误之后遇到了这个错误，说找不到我的“class.cpp”。

多亏了 SVN，我得到了我的问题的解决方案。通过比较我的“project.vcproj”文件的当前版本和原始版本，我意识到我添加的类设置为旧路径，因此找不到正确的路径。

因此，如果您认为您的错误可能具有相同的来源，您需要做的是： - 在编辑器中打开您的“project.vcproj”文件 - 在设置了“class.cpp”路径的代码中搜索- 将其更改为正确的 - 重建您的项目

它应该工作

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-06-30T12:32:33.330

我是 C++ 新手，我正在使用 Visual Studio 2008。我试图向一个大型程序添加一个新类，但遇到了同样的错误（BK1506）。

我的问题是我没有使用以下方法正确实现我的课程：

```
namespace ns
{ 
    class Name
    {
    };
} 
```

尽管这很可能不是您错误的原因，但我建议人们先检查一下，因为以前的答案让我认为我的问题比实际情况更高级

# ruby-on-rails - 使用 RSpec & Rails 测试给定布局的渲染

> ID：109284
> 
> 赞同：28
> 
> 时间：2008-09-20T20:33:03.213
> 
> 标签：ruby-on-rails, rspec, layout

是否可以使用带有 Rails 的 RSpec 测试给定布局的使用，例如，我想要一个执行以下操作的匹配器：

```
response.should use_layout('my_layout_name') 
```

我在谷歌搜索时发现了一个 use_layout 匹配器，但它不起作用，因为响应或控制器似乎都没有匹配器正在寻找的布局属性。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2010-09-28T13:45:28.040

David Chelimsky 在[Ruby 论坛](http://www.ruby-forum.com/topic/216851)上发布了一个很好的答案：

```
response.should render_template("layouts/some_layout") 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-27T16:39:39.163

这适用于 Edge Rails 和 Edge RSpec on Rails：

```
response.layout.should == 'layouts/application' 
```

将其变成适合您的匹配器应该不难。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2012-05-28T14:48:08.503

已经有一个功能完善的匹配器：

```
response.should render_template(:layout => 'fooo') 
```

(Rspec 2.6.4)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-21T05:15:28.167

我找到了一个[如何编写一个`use_layout`匹配器](http://rubyforge.org/pipermail/rspec-users/2007-May/001816.html)的例子。这是链接消失的代码：

```
# in spec_helper.rb

class UseLayout
   def initialize(expected)
     @expected = 'layouts/' + expected
   end
   def matches?(controller)
     @actual = controller.layout
     #@actual.equal?(@expected)
     @actual == @expected
   end
   def failure_message
     return "use_layout expected #{@expected.inspect}, got # 
{@actual.inspect}", @expected, @actual
   end
   def negeative_failure_message
     return "use_layout expected #{@expected.inspect} not to equal # 
{@actual.inspect}", @expected, @actual
   end
end

def use_layout(expected)
   UseLayout.new(expected)
end

# in controller spec
   response.should use_layout("application") 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-01-09T15:31:40.077

我必须编写以下内容才能完成这项工作：

```
response.should render_template("layouts/some_folder/some_layout", "template-name") 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-22T17:08:20.790

这是匹配器的更新版本。我已经更新它以符合最新版本的 RSpec。我添加了相关的只读属性并删除了旧的返回格式。

```
# in spec_helper.rb

class UseLayout
  attr_reader :expected
  attr_reader :actual

  def initialize(expected)
    @expected = 'layouts/' + expected
  end

  def matches?(controller)
    if controller.is_a?(ActionController::Base)
      @actual = 'layouts/' + controller.class.read_inheritable_attribute(:layout)
    else
      @actual = controller.layout
    end
    @actual ||= "layouts/application"
    @actual == @expected
  end

  def description
    "Determines if a controller uses a layout"
  end

  def failure_message
    return "use_layout expected #{@expected.inspect}, got #{@actual.inspect}"
  end

 def negeative_failure_message
   return "use_layout expected #{@expected.inspect} not to equal #{@actual.inspect}"
  end
end

def use_layout(expected)
  UseLayout.new(expected)
end 
```

此外，匹配器现在也适用于在控制器类级别指定的布局，可以按如下方式使用：

```
class PostsController < ApplicationController
  layout "posts"
end 
```

在控制器规范中，您可以简单地使用：

```
it { should use_layout("posts") } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-05-16T02:09:54.937

这是我最终采用的解决方案。它适用于 rpsec 2 和 rails 3。
我刚刚在 spec/support 目录中添加了这个文件。链接是：[https ://gist.github.com/971342](https://gist.github.com/971342)

```
# spec/support/matchers/render_layout.rb

ActionView::Base.class_eval do
  unless instance_methods.include?('_render_layout_with_tracking')
    def _render_layout_with_tracking(layout, locals, &block)
      controller.instance_variable_set(:@_rendered_layout, layout)
      _render_layout_without_tracking(layout, locals, &block)
    end
    alias_method_chain :_render_layout, :tracking
  end
end

# You can use this matcher anywhere that you have access to the controller instance,
# like in controller or integration specs.
#
# == Example Usage
#
# Expects no layout to be rendered:
#   controller.should_not render_layout
# Expects any layout to be rendered:
#   controller.should render_layout
# Expects app/views/layouts/application.html.erb to be rendered:
#   controller.should render_layout('application')
# Expects app/views/layouts/application.html.erb not to be rendered:
#   controller.should_not render_layout('application')
# Expects app/views/layouts/mobile/application.html.erb to be rendered:
#   controller.should_not render_layout('mobile/application')
RSpec::Matchers.define :render_layout do |*args|
  expected = args.first
  match do |c|
    actual = get_layout(c)
    if expected.nil?
      !actual.nil? # actual must be nil for the test to pass.  Usage: should_not render_layout
    elsif actual
      actual == expected.to_s
    else
      false
    end
  end

failure_message_for_should do |c|
    actual = get_layout(c)
    if actual.nil? && expected.nil?
      "expected a layout to be rendered but none was"
    elsif actual.nil?
      "expected layout #{expected.inspect} but no layout was rendered"
    else
      "expected layout #{expected.inspect} but #{actual.inspect} was rendered"
    end
  end

failure_message_for_should_not do |c|
    actual = get_layout(c)
    if expected.nil?
      "expected no layout but #{actual.inspect} was rendered"
    else
      "expected #{expected.inspect} not to be rendered but it was"
    end
  end `def get_layout(controller)
    if template = controller.instance_variable_get(:@_rendered_layout)
      template.virtual_path.sub(/layouts\//, '')
    end
  end
end` 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-23T20:45:18.463

`controller.active_layout.name`为我工作。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-18T03:53:11.757

`response.should render_template("layouts/some_folder/some_layout") response.should render_template("template-name")`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-07-31T20:05:54.150

**Shoulda Matchers**为这种情况提供了一个匹配器。（[文档](http://www.rubydoc.info/github/thoughtbot/shoulda-matchers/Shoulda%2FMatchers%2FActionController%3Arender_with_layout)）这似乎工作：

```
 expect(response).to render_with_layout('my_layout') 
```

它会产生适当的失败消息，例如：

*预计使用“calendar_layout”布局呈现，但使用“应用程序”、“应用程序”呈现*

用`rails 4.2`,`rspec 3.3`和`shoulda-matchers 2.8.0`

*编辑：shouda-matchers 提供了这种方法。应该::Matchers::ActionController::RenderWithLayoutMatcher*

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-20T18:41:43.687

这是 dmcnally 代码的一个版本，它不允许传递任何参数，使“应该使用布局”和“应该不使用布局”工作（分别断言控制器正在使用任何布局或没有布局 - 我希望只有第二个有用，因为如果它使用布局，您应该更具体）：

```
class UseLayout
   def initialize(expected = nil)
     if expected.nil?
       @expected = nil
     else
       @expected = 'layouts/' + expected
     end
   end
   def matches?(controller)
     @actual = controller.layout
     #@actual.equal?(@expected)
     if @expected.nil?
       @actual
     else
       @actual == @expected
     end
   end
   def failure_message
     if @expected.nil?
       return 'use_layout expected a layout to be used, but none was', 'any', @actual
     else
       return "use_layout expected #{@expected.inspect}, got #{@actual.inspect}", @expected, @actual
     end
   end
   def negative_failure_message
     if @expected.nil?
       return "use_layout expected no layout to be used, but #{@actual.inspect} found", 'any', @actual
     else
       return "use_layout expected #{@expected.inspect} not to equal #{@actual.inspect}", @expected, @actual
     end
   end
end

def use_layout(expected = nil)
   UseLayout.new(expected)
end 
```

# asp.net - 您希望在初学者的 ASP.NET 安全书中看到什么

> ID：109293
> 
> 赞同：8
> 
> 时间：2008-09-20T20:35:55.357
> 
> 标签：asp.net, security

*这是我自己的书的无耻信息收集练习。*

我在社区中发表的演讲之一是介绍网站漏洞。通常在演讲过程中，我可以看到至少有两名听众脸色苍白；这是基本的东西，跨站点脚本、SQL 注入、信息泄漏、跨站点表单请求等等。

因此，如果您可以回想一下，作为一名初级 Web 开发人员（无论是否是 ASP.NET），您认为有关 Web 安全以及如何安全开发的有用信息是什么？我已经涵盖了[OWASP 前十名](http://www.owasp.org/index.php/OWASP_Top_Ten_Project)

（是的，这意味着如果有人提出我还没有想到的东西，stackoverflow 将出现在致谢列表中！）

*已经全部完成，已发布，谢谢大家的回复*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T20:42:02.007

首先，我会指出 Web 的不安全性，以使人们可以接触到以安全为目的的开发可能（不幸地）是一个新概念的人。例如，向他们展示如何拦截 HTTP 标头并实施 XSS 攻击。您想向他们展示攻击的原因是为了让他们自己更好地了解他们要防御的内容。谈论超出此范围的安全性很好，但如果不了解他们要阻止的攻击类型，他们将很难准确地“测试”他们的系统的安全性。一旦他们可以通过尝试拦截消息、欺骗标头等来测试安全性，那么他们至少知道他们尝试实施的任何安全性是否有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T20:40:34.647

防御性编程作为涵盖所有特定攻击的原型主题，因为大多数（如果不是全部）攻击是由于没有足够的防御性思考引起的。

将该主题作为本书的中心栏目。那时对我很有帮助的是了解从不信任任何东西的技术，而不仅仅是一站式提示，例如“不允许在您的输入中使用 SQL 注释或特殊字符”。

我很想早点学到的另一件有趣的事情是如何实际测试它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T20:49:30.800

我认为所有的漏洞都是基于程序员没有思考的，要么是瞬间的判断失误，要么是他们没有想到的东西。我负责“修复”的应用程序中的一个大漏洞是，当登录的用户是管理员时，他们从身份验证方法返回了 0（零）。由于变量最初初始化为0，如果出现数据库宕机等问题，就会引发异常。该变量永远不会设置为正确的“安全代码”，然后用户将拥有对该站点的管理员访问权限。绝对可怕的想法进入了那个过程。所以，这让我想到了一个主要的安全概念；永远不要设置代表“安全级别”的变量的初始值 或任何类似的东西，代表上帝对网站的完全控制的东西。更好的是，使用已经在大量生产环境中长期使用的现有库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T20:54:46.623

我想看看 ASP.NET 安全性与 ASP Classic 安全性有何不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T20:42:50.473

[狐狸](http://poignantguide.net/ruby/chapter-3.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-17T10:19:34.520

很高兴听到您将获得 OWASP 前十名。为什么不包括 SANS/CWE 前 25 个编程错误的报道。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-24T14:46:20.823

我总是试图在可能出错的事情上展示最坏的情况。例如，跨站点脚本注入如何作为黑盒攻击工作，甚至可以在黑客无法访问自己的应用程序页面上工作，或者 SQL 注入如何作为黑盒工作，[以及黑客如何](https://cuttingedge.it/blogs/steven/pivot/entry.php?id=44)即使您的网站使用普通的非特权登录帐户连接到您的数据库，也[可以窃取您的敏感业务数据。](https://cuttingedge.it/blogs/steven/pivot/entry.php?id=44)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-27T22:27:25.023

如何确保您的安全方法可通过 SQL Server 进行扩展。特别是如何避免让 SQL Server 序列化来自多个用户的请求，因为它们都使用相同的 ID 连接......

# java - 来自 Tomcat 6 CometProcessor 的写入是非阻塞的

> ID：109294
> 
> 赞同：0
> 
> 时间：2008-09-20T20:36:40.147
> 
> 标签：java, tomcat, servlets, comet

我有一个 CometProcessor 实现，它有效地对可能大量的客户端进行多播。当发生需要传播到所有客户端的事件时，CometProcessor 将需要遍历客户端列表并写出响应。如果写入响应阻塞，那么潜在的慢客户端可能会对事件的分布产生不利影响。例子：

```
public class MyCometProcessor implements CometProcessor {
    private List<Event> connections = new ArrayList<Event>();
    public void onEvent(byte[] someInfo) {
        synchronized (connections) {
            for (Event e : connections) {
                HttpServletResponse r = e.getHttpResponse();

                // -- Does this line block while waiting for I/O --
                r.getOutputStream().write(someInfo);
            }
        }
    }

    public void event(CometEvent event) {
        switch (event.getEventType()) {
        case READ:
            synchronzied (connections) {
                connections.add(event);
            }
            break;
        // ...
        }

    }
} 
```

**更新**：回答我自己的问题。来自 CometProcessor 的写入被阻塞：

[http://tomcat.apache.org/tomcat-6.0-doc/config/http.html](http://tomcat.apache.org/tomcat-6.0-doc/config/http.html)

请参阅页面底部的表格。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-21T13:19:45.413

Tomcat6 对 HttpServlerResponse 的实现是 Response 类。在内部，它使用包裹在 OutputBuffer 周围的 CoyoteOutputStream。顾名思义，这个类是一个缓冲区，默认大小为 8k。所以我至少会说，如果你写的少于 8k，那么你不会阻塞。您可能需要刷新您的客户才能看到数据，这意味着最终它取决于您使用的连接器变体。如果您想要非阻塞写入，请在您的连接器配置中指定

`protocol=org.apache.coyote.http11.Http11NioProtocol`

此连接器/协议可大量配置：

[http://tomcat.apache.org/tomcat-6.0-doc/config/http.html](http://tomcat.apache.org/tomcat-6.0-doc/config/http.html)

# asp.net - ASP.Net GridView 大小格式化

> ID：109305
> 
> 赞同：0
> 
> 时间：2008-09-20T20:40:40.057
> 
> 标签：asp.net, gridview, formatting

我有一个 ASP.Net GridView 控件，无论网格中有 0 条记录还是*n*条记录，我都需要保持固定大小。无论网格中的数据量如何，页眉和页脚都应保持在同一位置。显然，我需要为更大的数据集实现分页，但我将如何实现这个固定大小的 GridView？理想情况下，我希望这是一个可重用的控件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T21:34:05.313

您可能必须完全从 GridView 中删除页眉和页脚，并将它们作为单独的表格元素添加到页面中。您需要确保页眉和页脚表格中的每个表格单元格具有与 GridView 中的单元格宽度相对应的固定宽度。

GridView 本身可能会嵌套在固定高度的 DIV 标记中。如下所示。

```
<table><tr><td style="width:100px">Header 1</td><td style="width:200px">Header 2</td></table>
<div style="width:300px;height:400px">
<asp:GridView>.....</asp:GridView>
</div>
<table><tr><td style="width:100px">Footer 1</td><td style="width:200px">Footer 2</td></table> 
```

您可能必须调整边距和填充值以使其完全对齐。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-03T12:49:41.403

将网格放在 div 中设置 div 样式如下

```
<div style="width:100px; height:100px; overflow:scroll;">
   <asp:GridView ID="GridView1" runat="server">
   </asp:GridView>
</div> 
```

# c++ - 为什么在 c++ 中使用 c 字符串？

> ID：109317
> 
> 赞同：20
> 
> 时间：2008-09-20T20:45:24.837
> 
> 标签：c++, c, stl, string, c-strings

现在有什么好的理由在 C++ 中使用 C 字符串吗？我的教科书在某些时候在示例中使用了它们，我真的觉得使用 std::string 会更容易。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-20T20:52:02.683

我不得不使用它们的唯一原因是与使用 C 样式字符串的 3rd 方库交互时。出于性能原因，您可能还会在某些深奥的情况下使用 C 样式字符串，但通常情况下，由于内联和专门化等原因，在 C++ 字符串上使用方法可能更快。

在使用这类 API 时，您可以在许多情况下使用该[`c_str()`](http://en.cppreference.com/w/cpp/string/basic_string/c_str)方法，但您应该知道返回的 char * 是 const，并且您不应该通过该指针修改字符串。在这种情况下，您仍然可以使用 vector<char> 代替，并且至少可以获得更轻松的内存管理的好处。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-21T15:24:20.387

还有一些内存控制说明：

C 字符串是 POD 类型，因此它们可以分配在应用程序的只读数据段中。如果您在命名空间范围内声明和定义常量，编译器将生成在调用每个常量的构造函数`std::string`之前运行的附加代码。如果您的应用程序有很多常量字符串（例如，如果您生成了使用常量字符串的 C++ 代码），在这种情况下 C 字符串可能更可取。`main()``std::string`

一些实现`std::string`支持称为 SSO（“短字符串优化”或“小字符串优化”）的功能，其中`std::string`该类包含存储到一定长度的字符串。这会增加`std::string`但通常会显着降低自由存储分配/释放的频率，从而提高性能。如果您的实现`std::string`不支持 SSO，则`std::string`在堆栈上构造一个空仍将执行自由存储分配。如果是这种情况，使用临时堆栈分配的 C 字符串可能有助于使用字符串的性能关键代码。当然，当你这样做时，你必须小心不要射中自己的脚。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-20T20:46:05.070

因为这就是它们来自众多 API/库的方式？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T20:54:20.353

假设您的代码中有一些字符串常量，这是很常见的需求。最好将它们定义为 C 字符串而不是 C++ 对象——更轻量级、可移植等。现在，如果您要将这些字符串传递给各种函数，最好这些函数接受 C 字符串而不是需要C++ 字符串对象。

当然，如果字符串是可变的，那么使用 C++ 字符串对象要方便得多。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T20:58:38.797

如果一个函数需要一个**常量**字符串，我仍然更喜欢使用 'const char*'（或 const wchar_t*），即使程序使用 std::string、CString、EString 或其他任何东西。

大型代码库中的字符串来源太多，无法确保调用者将字符串作为 std::string 并且 'const char*' 是最低公分母。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-20T21:02:24.390

教科书以老式 C 字符串为特色，因为许多基本函数仍然期望它们作为参数，或返回它们。此外，它还可以深入了解内存中字符串的底层结构。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-21T14:41:24.907

内存控制。我最近不得不在一个大规模多线程应用程序中处理大小约为 200-300 MB 的字符串（实际上是数据库中的 blob）。在这种情况下，字符串的多一份副本可能会破坏 32 位地址空间。我必须确切知道该字符串存在多少个副本。虽然我是一名 STL 传播者，但我当时使用了 char *，因为它保证了不会分配额外的内存甚至额外的副本。我确切地知道它需要多少空间。

除此之外，标准的 STL 字符串处理错过了一些用于字符串处理/解析的出色 C 函数。值得庆幸的是，std::string 具有 c_str() 方法，用于 const 访问内部缓冲区。要使用 printf() 你仍然必须使用 char * （C++ 团队的一个疯狂的想法是不包括（s）printf-like 功能，这是 C 中最有用的功能之一。我希望 boost::format 会很快就会被包含在 STL 中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T20:55:30.070

如果 C++ 代码很“深”（接近内核，严重依赖 C 库等），您可能希望显式使用 C 字符串以避免大量进出 std::string 的转换。当然，如果您正在与其他语言领域（Python、Ruby 等）交互，您可能会出于同样的原因这样做。否则，使用 std::string。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-21T22:50:16.370

一些帖子提到了内存问题。这可能是避开 std::string 的一个很好的理由，但 char* 可能不是最好的替代品。它仍然是一种面向对象的语言。您自己的字符串类可能比 char* 更好。它甚至可能更有效 - 例如，您可以应用小字符串优化。

在我的例子中，我试图从一个 2GB 的文件中获取大约 1GB 的字符串，将它们填充到具有大约 60 个字段的记录中，然后对它们进行 7 次不同字段的排序。我的前辈代码使用 char* 花了 25 小时，我的代码在 1 小时内运行。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-22T18:16:31.510

1）“字符串常量”是C字符串（const char *），将其转换为const std::string&是运行时过程，不一定简单或优化。2) fstream 库使用 c 风格的字符串来传递文件名。

我的经验法则是传递 const std::string& 如果我无论如何都要将数据用作 std::string （例如，当我将它们存储在向量中时），而在其他情况下传递 const char * 。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T02:01:00.870

在花费了太多时间调试初始化规则和几个平台上每个可能的字符串实现之后，我们需要静态字符串为 const char*。

在花费了太多时间调试错误的 char* 代码和内存泄漏之后，我建议所有非静态字符串都是某种类型的字符串对象......直到分析表明你可以而且应该做得更好;-)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-10-01T17:27:04.040

不知道 std::string 的遗留代码。此外，在 C++11 之前，使用 std::ifstream 或 std::ofstream 打开文件只能使用 const char* 作为文件名的输入。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-20T21:02:14.220

给定选择，通常没有理由选择原始 C 字符串 ( `char*`) 而不是 C++ 字符串 ( `std::string`)。但是，您通常没有选择的余地。例如`std::fstream`，由于历史原因， 的构造函数采用 C 字符串。此外，C 库（您猜对了！）使用 C 字符串。

在您自己的 C++ 代码中，最好`std::string`使用[`c_str()`.`std::string`](http://www.cplusplus.com/reference/string/string/c_str.html)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-20T21:03:18.490

这取决于您使用的库。例如，在使用[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)时，在使用 Windows API 的各个部分时使用 CString 通常更容易。在 Win32 应用程序中，它似乎也比 std::string 执行得更好。

但是，std::string 是 C++ 标准的一部分，因此如果您想要更好的可移植性，请使用 std::string。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-20T21:35:00.817

对于大多数嵌入式平台等应用程序，在这些应用程序中，您没有奢侈的堆来存储被操作的字符串，并且需要确定性地预分配字符串缓冲区。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-21T01:31:19.640

c 字符串不承担成为类的开销。

c 字符串通常可以产生更快的代码，因为它们更接近机器级别

这并不是说，你不能用它们编写糟糕的代码。它们可能被滥用，就像其他所有构造一样。

由于历史原因，有大量的库调用需要它们。

学习使用 c 字符串和 stl 字符串，并在有意义的时候使用它们。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-20T20:50:03.530

STL 字符串当然更容易使用，我看不出有任何理由不使用它们。

如果您需要与仅将 C 样式字符串作为参数的库进行交互，您始终可以调用 string 类的 c_str() 方法。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2008-09-21T11:05:16.890

这样做的通常原因是您喜欢在字符串处理中写入缓冲区溢出。计数字符串优于终止字符串，很难理解 C 设计者为什么使用终止字符串。那时这是一个糟糕的决定。现在这是一个糟糕的决定。

# .net - 使用 .Net 使用 XmlSerializer 有哪些限制（如果有）？

> ID：109318
> 
> 赞同：8
> 
> 时间：2008-09-20T20:45:39.657
> 
> 标签：.net, xml, serialization

使用 .Net 使用 XmlSerializer 有哪些限制（如果有）？例如，您可以将图像序列化为 XML 吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-21T00:26:12.747

我通常发现 XmlSerializer 对于任何不仅仅是 DTO 的 POCO 来说都是一个糟糕的选择。如果您需要特定的 XML，您可以使用 Xml*Attribute 和/或 IXmlSerializable 路线 - 但您会得到一个非常混乱的对象。

出于某些目的，它仍然是一个显而易见的选择——即使它有局限性。但是，为了简单地存储和重新加载数据，我发现 BinaryFormatter 是一个更容易的选择，而且陷阱更少。

以下是 XmlSerializer 的一些烦恼列表 - 大多数我都曾在某个时候或另一个地方被咬过，还有一些我在[MSDN](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)上找到的：

*   需要一个公共的，没有参数的构造函数
*   仅序列化公共读/写属性和字段
*   需要知道所有类型
*   实际上调用 get_* 和 set_*，因此将运行验证等。这可能是好是坏（还要考虑调用的顺序）
*   只会序列化符合特定规则的 IEnumerable 或 ICollection 集合

> XmlSerializer 对实现 IEnumerable 或 ICollection 的类进行特殊处理。实现 IEnumerable 的类必须实现采用单个参数的公共 Add 方法。Add 方法的参数必须与从 GetEnumerator 返回的值的 Current 属性返回的类型相同，或者该类型的基数之一。
> 
> 除了 IEnumerable 之外，实现 ICollection 的类（例如 CollectionBase）必须具有采用整数的公共 Item 索引属性（C# 中的索引器），并且必须具有整数类型的公共 Count 属性。Add 方法的参数必须与从 Item 属性返回的类型相同，或者是该类型的基数之一。对于实现 ICollection 的类，要序列化的值是从索引的 Item 属性中检索的，而不是通过调用 GetEnumerator。

*   不序列化 IDictionary
*   使用动态生成的程序集，这些程序集可能不会从应用程序域中卸载。

> 为了提高性能，XML 序列化基础结构动态生成程序集以序列化和反序列化指定类型。基础结构查找并重用这些程序集。此行为仅在使用以下构造函数时发生：
> 
> XmlSerializer.XmlSerializer（类型） XmlSerializer.XmlSerializer（类型，字符串）
> 
> 如果您使用任何其他构造函数，则会生成同一程序集的多个版本并且永远不会卸载，这会导致内存泄漏和性能下降。

*   无法序列化 ArrayList[] 或 List<T>[]
*   还有其他奇怪的边缘情况

> 如果满足以下条件，则无法实例化 XmlSerializer 以序列化枚举：枚举的类型为 unsigned long（C# 中的 ulong），并且枚举包含值大于 9,223,372,036,854,775,807 的任何成员。
> 
> XmlSerializer 类不再序列化标记为 [Obsolete] 的对象。
> 
> 您必须有权写入临时目录（由 TEMP 环境变量定义）才能反序列化对象。

*   需要阅读 .InnerException 以获取有关错误的任何有用信息

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-20T21:07:10.040

XmlSerializer 有一些缺点。

1.  它必须知道所有被序列化的类型。您不能通过表示序列化程序不知道的类型的接口传递一些东西。
2.  它不能做循环引用。
3.  如果在对象图中多次引用，它将多次序列化同一个对象。
4.  无法处理私有字段序列化。

我（愚蠢地）编写了自己的序列化程序来解决其中的一些问题。不要那样做；这是很多工作，你会在几个月后发现其中的细微错误。在编写自己的序列化程序和格式化程序时，我获得的唯一收获是对对象图序列化所涉及的细节有了更大的了解。

当 WCF 出现时，我发现了[NetDataContractSerializer 。](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.netdatacontractserializer.aspx)它完成了上面 XmlSerializer 没有做的所有事情。它以与 XmlSerializer 类似的方式驱动序列化。一种是用属性装饰各种属性或字段，以通知序列化程序要序列化什么。我用 NetDataContractSerializer 替换了我编写的自定义序列化程序，并且对结果非常满意。我会极力推荐它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T11:34:21.663

另一个问题是，调用 XmlSerializer 的构造函数将在运行时编译代码，并将生成一个临时 DLL（在 %temp% 文件夹中），其中包含执行反序列化的代码。

如果您在 app.config 中添加以下行，您可以观看代码：

```
 <system.diagnostics>
    <switches>
      <add name="XmlSerialization.Compilation" value="4"/>
    </switches>
  </system.diagnostics> 
```

当您第一次序列化一个类并且需要具有编译和写入磁盘权限的代码时，这会花费大量时间。

一种解决方法是使用 VS 2005+ 附带的 sGen.exe 工具预编译这些 DLL。

[在这里查看更多信息](http://seewinapp.blogspot.com/2005/09/xmlserializer-performance-issue.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T20:51:24.790

不确定是否有任何限制.. 但是 .NET 1.1 中的 XmlSerialization 中存在内存泄漏错误，您必须创建一个缓存序列化程序对象来解决这个问题......事实上，我不确定这个问题已在 .net 2.0 或更高版本中修复...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T20:51:37.630

我能想到的一个限制是 XmlSerialization 是可选的；意味着您不想序列化的类的任何属性都必须用 [XmlIgnore] 装饰。与所有属性都可选择加入的 DataContractSerializer 相比，您必须显式声明包含属性。这是一篇很好[的文章](http://www.danrigsby.com/blog/index.php/2008/03/07/xmlserializer-vs-datacontractserializer-serialization-in-wcf/)。

图像或其二进制数组由 XmlSerializer 序列化为 base64 编码文本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T20:55:11.567

理论上，您编写的任何类都可以通过 XmlSerializer 提供。但是，它只能访问公共字段，并且需要用正确的属性（例如 XmlAttribute）标记类。即使在基本框架中，也不是所有东西都支持 XmlSerializer。例如 System.Collections.Generic.Dictionary<>。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-20T21:17:38.097

例如，您不能序列化实现 IDictionary 接口的类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-21T00:17:19.943

对于集合，他们需要一个带有单个参数的 Add 方法。如果您只需要文本格式而不是特定的 xml，则可以尝试 JSON。我已经为 .NET 开发了一个[JsonExSerializer ，在](http://jsonexserializer.googlecode.com)[http://www.json.org](http://www.json.org)上还有其他可用的。

# path - 错误 PRJ0003：生成“cl.exe”时出错

> ID：109319
> 
> 赞同：3
> 
> 时间：2008-09-20T20:46:00.513
> 
> 标签：path, compilation

我将 VS2006 vc++ 项目转换为 VS2008。编译时出现上述错误。我如何解决它？我错过了这个 exe 吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-02-12T15:40:24.370

Visual Studio 2008 标准版安装程序中有一个错误。如果您只安装 Visual C++ 而不是 Visual C#，它不会安装 cl.exe。要解决此问题，即使您不需要它，您也必须安装 Visual C#。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T21:40:48.680

cl.exe 是 VS2008（和任何其他 VS）C/C++ 编译器，因此请检查更详细的错误消息，了解为什么它无法生成。安装 VS2008 时，请确保您已经安装了 C++ 语言支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T21:55:19.800

可能是您的“路径”环境变量不包含 cl.exe 所在文件夹的路径。

另一个可能的原因可能是在安装 VS2008 时，您没有选择安装 Win32 工具（包括命令行编译器）的选项。

在任何情况下，您可能想尝试修复 VS2008 的安装（通过通过控制面板 - 添加/删除程序运行其设置），或使用其“添加/删除组件”选项并添加“Win32 工具”选项（在Visual C++ - Visual C++ 工具）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-04-10T12:17:48.213

我在 Windows 10 下遇到了这个问题，并通过将以下路径添加到 PATH 环境变量来解决它：

C:\ProgramFilesC\VS2008\Common7\IDE C:\ProgramFilesC\VS2008\VC\bin\x86_amd64

其中 C:\ProgramFilesC\VS2008 是我安装 Visual Studio 的路径。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-05-12T01:48:14.327

实际上，由于路径设置不正确而发生此错误。

转到工具>选项>目录>显示目录>选择可执行文件在这里从您安装的文件夹中复制路径地址并粘贴该路径地址

G:\Program 文件\vb (Visual Basic) 6.0\Visual Basic 6.0\VC98\BIN

然后单击确定。

这可能对你有用。

# postgresql - PostgreSQL“描述表”

> ID：109325
> 
> 赞同：2005
> 
> 时间：2008-09-20T20:47:48.917
> 
> 标签：postgresql, psql, table-structure

您如何`DESCRIBE TABLE`在 PostgreSQL 中执行相当于 Oracle 的操作（使用 psql 命令）？

* * *

## 回答 #1

> 赞同：3003
> 
> 时间：2008-09-20T20:50:17.243

试试这个（在`psql`命令行工具中）：

```
\d+ tablename 
```

有关更多信息，请参阅[手册](http://www.postgresql.org/docs/current/interactive/app-psql.html#APP-PSQL-META-COMMANDS)。

* * *

## 回答 #2

> 赞同：836
> 
> 时间：2008-09-20T20:51:28.533

除了 PostgreSQL 方式（\d 'something' or \dt 'table' or \ds 'sequence' 等等）

SQL 标准方式，如下[所示](https://stackoverflow.com/questions/100504/what-is-the-sql-command-to-return-the-field-names-of-a-table#100513)：

```
select column_name, data_type, character_maximum_length, column_default, is_nullable
from INFORMATION_SCHEMA.COLUMNS where table_name = '<name of table>'; 
```

许多数据库引擎都支持它。

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2008-09-22T23:39:44.090

如果你想从查询而不是 psql 中获取它，你可以查询目录模式。这是一个复杂的查询：

```
SELECT  
    f.attnum AS number,  
    f.attname AS name,  
    f.attnum,  
    f.attnotnull AS notnull,  
    pg_catalog.format_type(f.atttypid,f.atttypmod) AS type,  
    CASE  
        WHEN p.contype = 'p' THEN 't'  
        ELSE 'f'  
    END AS primarykey,  
    CASE  
        WHEN p.contype = 'u' THEN 't'  
        ELSE 'f'
    END AS uniquekey,
    CASE
        WHEN p.contype = 'f' THEN g.relname
    END AS foreignkey,
    CASE
        WHEN p.contype = 'f' THEN p.confkey
    END AS foreignkey_fieldnum,
    CASE
        WHEN p.contype = 'f' THEN g.relname
    END AS foreignkey,
    CASE
        WHEN p.contype = 'f' THEN p.conkey
    END AS foreignkey_connnum,
    CASE
        WHEN f.atthasdef = 't' THEN d.adsrc
    END AS default
FROM pg_attribute f  
    JOIN pg_class c ON c.oid = f.attrelid  
    JOIN pg_type t ON t.oid = f.atttypid  
    LEFT JOIN pg_attrdef d ON d.adrelid = c.oid AND d.adnum = f.attnum  
    LEFT JOIN pg_namespace n ON n.oid = c.relnamespace  
    LEFT JOIN pg_constraint p ON p.conrelid = c.oid AND f.attnum = ANY (p.conkey)  
    LEFT JOIN pg_class AS g ON p.confrelid = g.oid  
WHERE c.relkind = 'r'::char  
    AND n.nspname = '%s'  -- Replace with Schema name  
    AND c.relname = '%s'  -- Replace with table name  
    AND f.attnum > 0 ORDER BY number
; 
```

它非常复杂，但它确实向您展示了 PostgreSQL 系统目录的强大功能和灵活性，并且应该让您掌握 pg_catalog ;-)。请务必更改查询中的 %s。第一个是Schema，第二个是表名。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2008-09-20T20:49:54.450

您可以使用 psql 斜杠命令执行此操作：

```
 \d myTable describe table 
```

它也适用于其他对象：

```
 \d myView describe view
 \d myIndex describe index
 \d mySequence describe sequence 
```

资料来源：[faqs.org](http://www.faqs.org/docs/ppbook/c4890.htm)

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-09-20T20:49:34.500

psql 等价于`DESCRIBE TABLE`.`\d table`

有关详细信息，请参阅 PostgreSQL 手册的 psql 部分。

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2019-01-09T10:25:12.053

这应该是解决方案：

```
SELECT * FROM information_schema.columns
WHERE table_schema = 'your_schema'
   AND table_name   = 'your_table' 
```

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2013-05-30T16:20:10.020

您可以`\d *search pattern *` **使用星号**来查找与您感兴趣的搜索模式匹配的表。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2016-02-25T08:03:49.800

除了`\d+ <table_name>`您已经找到的命令行之外，您还可以使用[info_schema.columns 使用 info_schema.columns](http://www.postgresql.org/docs/current/static/infoschema-columns.html)[来](http://www.postgresql.org/docs/current/static/information-schema.html)查找列数据

```
SELECT *
FROM info_schema.columns
WHERE table_schema = 'your_schema'
AND table_name   = 'your_table' 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2013-12-05T18:55:55.810

你可以使用这个：

```
SELECT attname 
FROM pg_attribute,pg_class 
WHERE attrelid=pg_class.oid 
AND relname='TableName' 
AND attstattarget <>0; 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2016-05-05T08:00:45.193

使用以下 SQL 语句

```
SELECT DATA_TYPE 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE table_name = 'tbl_name' 
AND COLUMN_NAME = 'col_name' 
```

如果您替换 tbl_name 和 col_name，它会显示您要查找的特定列的数据类型。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2018-04-10T08:53:41.050

在**MySQL**中，描述表名

* * *

在**PostgreSQL**中，\d 表名

* * *

或者，您可以使用这个长命令：

```
SELECT
        a.attname AS Field,
        t.typname || '(' || a.atttypmod || ')' AS Type,
        CASE WHEN a.attnotnull = 't' THEN 'YES' ELSE 'NO' END AS Null,
        CASE WHEN r.contype = 'p' THEN 'PRI' ELSE '' END AS Key,
        (SELECT substring(pg_catalog.pg_get_expr(d.adbin, d.adrelid), '\'(.*)\'')
                FROM
                        pg_catalog.pg_attrdef d
                WHERE
                        d.adrelid = a.attrelid
                        AND d.adnum = a.attnum
                        AND a.atthasdef) AS Default,
        '' as Extras
FROM
        pg_class c 
        JOIN pg_attribute a ON a.attrelid = c.oid
        JOIN pg_type t ON a.atttypid = t.oid
        LEFT JOIN pg_catalog.pg_constraint r ON c.oid = r.conrelid 
                AND r.conname = a.attname
WHERE
        c.relname = 'tablename'
        AND a.attnum > 0

ORDER BY a.attnum 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2018-02-14T13:46:49.407

查询的这种变体（如其他答案中所述）对我有用。

```
SELECT
 COLUMN_NAME
FROM
 information_schema.COLUMNS
WHERE
 TABLE_NAME = 'city'; 
```

这里有详细描述： [http ://www.postgresqltutorial.com/postgresql-describe-table/](http://www.postgresqltutorial.com/postgresql-describe-table/)

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2018-10-02T18:56:48.147

为了改进另一个答案的 SQL 查询（这很棒！），这里有一个修改后的查询。它还包括约束名称、继承信息和分解为其组成部分（类型、长度、精度、比例）的数据类型。它还过滤掉已删除的列（仍存在于数据库中）。

```
SELECT
    n.nspname as schema,
    c.relname as table,
    f.attname as column,  
    f.attnum as column_id,  
    f.attnotnull as not_null,
    f.attislocal not_inherited,
    f.attinhcount inheritance_count,
    pg_catalog.format_type(f.atttypid,f.atttypmod) AS data_type_full,
    t.typname AS data_type_name,
    CASE  
        WHEN f.atttypmod >= 0 AND t.typname <> 'numeric'THEN (f.atttypmod - 4) --first 4 bytes are for storing actual length of data
    END AS data_type_length, 
    CASE  
        WHEN t.typname = 'numeric' THEN (((f.atttypmod - 4) >> 16) & 65535)
    END AS numeric_precision,   
    CASE  
        WHEN t.typname = 'numeric' THEN ((f.atttypmod - 4)& 65535 )
    END AS numeric_scale,       
    CASE  
        WHEN p.contype = 'p' THEN 't'  
        ELSE 'f'  
    END AS is_primary_key,  
    CASE
        WHEN p.contype = 'p' THEN p.conname
    END AS primary_key_name,
    CASE  
        WHEN p.contype = 'u' THEN 't'  
        ELSE 'f'
    END AS is_unique_key,
    CASE
        WHEN p.contype = 'u' THEN p.conname
    END AS unique_key_name,
    CASE
        WHEN p.contype = 'f' THEN 't'
        ELSE 'f'
    END AS is_foreign_key,
    CASE
        WHEN p.contype = 'f' THEN p.conname
    END AS foreignkey_name,
    CASE
        WHEN p.contype = 'f' THEN p.confkey
    END AS foreign_key_columnid,
    CASE
        WHEN p.contype = 'f' THEN g.relname
    END AS foreign_key_table,
    CASE
        WHEN p.contype = 'f' THEN p.conkey
    END AS foreign_key_local_column_id,
    CASE
        WHEN f.atthasdef = 't' THEN d.adsrc
    END AS default_value
FROM pg_attribute f  
    JOIN pg_class c ON c.oid = f.attrelid  
    JOIN pg_type t ON t.oid = f.atttypid  
    LEFT JOIN pg_attrdef d ON d.adrelid = c.oid AND d.adnum = f.attnum  
    LEFT JOIN pg_namespace n ON n.oid = c.relnamespace  
    LEFT JOIN pg_constraint p ON p.conrelid = c.oid AND f.attnum = ANY (p.conkey)  
    LEFT JOIN pg_class AS g ON p.confrelid = g.oid  
WHERE c.relkind = 'r'::char  
    AND f.attisdropped = false
    AND n.nspname = '%s'  -- Replace with Schema name  
    AND c.relname = '%s'  -- Replace with table name  
    AND f.attnum > 0 
ORDER BY f.attnum
; 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-12-12T12:27:24.730

您也可以使用以下查询进行检查

```
Select * from schema_name.table_name limit 0; 
```

示例：我的表有 2 列名称和密码。下面给出截图。

[![添加图像](https://i.stack.imgur.com/QokcT.png)](https://i.stack.imgur.com/QokcT.png)

*使用 PG admin3

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-07-20T13:22:39.073

```
Use this command 

\d table name

like 

\d queuerecords

             Table "public.queuerecords"
  Column   |            Type             | Modifiers
-----------+-----------------------------+-----------
 id        | uuid                        | not null
 endtime   | timestamp without time zone |
 payload   | text                        |
 queueid   | text                        |
 starttime | timestamp without time zone |
 status    | text                        | 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-08-06T15:25:06.087

描述表的最佳方式，例如列、类型、列的修饰符等。

```
\d+ tablename or \d tablename 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-06-18T09:14:42.037

在 postgres 中，\d 用于描述表结构。

例如`\d schema_name.table_name`

此命令将为您提供表的基本信息，例如列、类型和修饰符。

如果您想了解有关表使用的更多信息

```
\d+ schema_name.table_name 
```

这将为您提供额外的信息，例如存储、统计目标和描述

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-09-05T09:05:10.743

当您的表不是默认模式的一部分时，您应该编写：

```
\d+ schema_name.table_name 
```

否则，您会收到“关系不存在”的错误消息。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-03-04T09:54:08.543

**1) 使用 psql 的 PostgreSQL 描述表**

在 psql 命令行工具中，**\d table_name**或**\d+ table_name**以查找有关表列的信息

**2) PostgreSQL DESCRIBE TABLE 使用 information_schema**

SELECT语句查询information_schema数据库中columns表的column_names、datatype、character最大长度；

**SELECT COLUMN_NAME, DATA_TYPE, CHARACTER_MAXIMUM_LENGTH from INFORMATION_SCHEMA.COLUMNS where table_name = 'tablename';**

有关更多信息[https://www.postgresqltutorial.com/postgresql-describe-table/](https://www.postgresqltutorial.com/postgresql-describe-table/)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-11-12T11:35:48.320

即使您请求了 psql 命令，我也会添加 pg_dump 命令。因为它生成对以前的 MySQl 用户更常见的输出。

`# sudo -u postgres pg_dump --table=my_table_name --schema-only mydb`

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-08-09T06:03:09.880

/dt 是列出数据库中所有表的逗号。使用
/d 命令和 /d+ 我们可以获得表的详细信息。sysntax 类似于
* /d table_name (or) \d+ table_name

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2018-03-23T00:02:44.963

我为获取表模式制定了以下脚本。

```
'CREATE TABLE ' || 'yourschema.yourtable' || E'\n(\n' ||
array_to_string(
array_agg(
'    ' || column_expr
)
, E',\n'
) || E'\n);\n'
from
(
SELECT '    ' || column_name || ' ' || data_type || 
coalesce('(' || character_maximum_length || ')', '') || 
case when is_nullable = 'YES' then ' NULL' else ' NOT NULL' end as column_expr
FROM information_schema.columns
WHERE table_schema || '.' || table_name = 'yourschema.yourtable'
ORDER BY ordinal_position
) column_list; 
```

# wcf - REST 中的批处理

> ID：109343
> 
> 赞同：5
> 
> 时间：2008-09-20T20:52:50.917
> 
> 标签：wcf, rest

对于 Web 服务，将多个服务调用批处理到一条消息中以减少远程调用的数量被认为是一种很好的做法。有没有办法用 RESTful 服务做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T13:11:57.467

如果你真的需要批处理，Http 1.1 支持一个叫做 HTTP Pipelining 的概念，它允许你在收到响应之前发送多个请求。[在这里](http://en.wikipedia.org/wiki/HTTP_pipelining)查看

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T14:05:16.497

我看不出批处理请求在 REST 中有何意义。由于基于 REST 的服务中的 URL 表示要执行的操作以及要执行它的数据，因此发出批处理请求将严重破坏概念模型。

如果您多次对同一数据执行相同的操作，则例外。在这种情况下，您可以为请求参数传递多个值，也可以在正文中对该重复进行编码（但这仅适用于 PUT 或 POST）。Gliffy REST API 支持通过以下方式将多个用户添加到同一个文件夹

```
POST /folders/ROOT/the/folder/name/users?userId=56&userId=87&userId=45 
```

这本质上是：

```
PUT /folders/ROOT/the/folder/name/users/56
PUT /folders/ROOT/the/folder/name/users/87
PUT /folders/ROOT/the/folder/name/users/45 
```

正如另一位评论者所指出的，来自 GET 的分页结果可以通过请求参数完成：

```
GET /some/list/of/resources?startIndex=10&pageSize=50 
```

**如果**REST 服务支持它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T10:03:56.417

我同意达雷尔·米勒的观点。HTTP 已经支持 HTTP Pipelining，加上 HTTP 支持保持活动状态，让您可以在同一个套接字上同时流式传输多个 HTTP 操作，以避免在将新请求流式传输到服务器之前必须等待响应等。

因此，通过 HTTP 流水线和保持活动，您可以在使用相同的底层 REST API 的同时获得批处理的效果——因此通常不需要为您的服务添加另一个 REST API

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T05:11:29.520

与 Astoria 的团队很好地利用了多部分 mime 来发送一批电话。与流水线不同，多部分消息可以推断原子操作的意图。显得比较优雅。

*   [解释理性的原始博客文章](http://blogs.msdn.com/astoriateam/archive/2008/04/06/batching-data-service-requests.aspx)
*   [MSDN 文档](http://msdn.microsoft.com/en-us/library/cc668802.aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-20T21:27:05.343

当然有一种方法，但它需要服务器端的支持。据我所知，没有一种神奇的方法适合所有方法。

# ms-access - Application.SysCmd 方法的所有可能用途

> ID：109345
> 
> 赞同：3
> 
> 时间：2008-09-20T20:53:20.073
> 
> 标签：ms-access, methods, vba

有没有地方可以在 MS Access 中找到 syscmd 方法的所有可能用途？我知道 Microsoft 有一个[开发人员参考](http://msdn.microsoft.com/en-us/library/bb214117.aspx)，但我发现此方法还有许多其他用途，此处未列出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T00:39:14.923

Access 本身为所有正在使用的库的完整对象模型提供了一个接口。在 VBE 中，按键盘上的 F2（或者，从 VIEW 菜单中，选择 OBJECT BROWSER）。在搜索框中键入“syscmd”，您将获得完整的详细信息。变量名称足够详细，可以解释您需要知道的所有内容。

编辑：对象浏览器除了通过分配命名常量记录的 SysCmd 函数之外什么都不给你。但是熟悉对象浏览器的建议是一个很好的建议，特别是如果您右键单击 CLASSES 列表并选择 SHOW HIDDEN MEMBERS ——您可以从中学到很多东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T20:57:29.673

这是一些“未记录”的功能，我从经验中知道，一旦您了解了如何从这些示例中构造命令，您基本上可以使用 syscmd 运行 Windows 可以执行的任何操作。

[http://www.everythingaccess.com/tutorials.asp?ID=Undocumented-SysCmd-Functions](http://www.everythingaccess.com/tutorials.asp?ID=Undocumented-SysCmd-Functions)

从google搜索：syscmd访问

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T21:11:23.340

这是一个完整的列表，包括每个命令适用的 Access 版本，翻译成英文。

[http://www.excite-webtl.jp/world/english/web/?wb_url=http%3A%2F%2Fwww.f3.dion.ne.jp%2F%7Eelement%2Fmsaccess%2FAcTipsUnDocumentedSysCmd.html&wb_lp=JAEN&wb_dis=2](http://www.excite-webtl.jp/world/english/web/?wb_url=http%3A%2F%2Fwww.f3.dion.ne.jp%2F%7Eelement%2Fmsaccess%2FAcTipsUnDocumentedSysCmd.html&wb_lp=JAEN&wb_dis=2)

# graphics - 贝塞尔剪裁

> ID：109364
> 
> 赞同：14
> 
> 时间：2008-09-20T20:56:31.847
> 
> 标签：graphics, geometry, 2d, bezier, csg

我正在尝试找到/制作一种算法来计算两个任意填充的 2D 对象的交集（一个新的填充对象）。对象使用直线或三次贝塞尔曲线定义，并且可能有孔或自相交。我知道一些现有的算法对多边形做同样的事情，[这里列出](http://www.complex-a5.ru/polyboolean/comp.html)。但是，我想支持贝塞尔曲线而不将它们细分为多边形，并且在没有交叉点的区域中，输出应该具有与输入大致相同的控制点。

这是一个交互式程序来做一些 CSG，但剪辑不需要是实时的。我已经搜索了一段时间，但没有找到好的起点。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-06-09T11:35:29.583

我发现以下出版物是有关 Bezier Clipping 的最佳信息：

TW Sederberg, BYU, 计算机辅助几何设计课程笔记

第 7 章讨论曲线交点可在线获取。它概述了查找交叉点的 4 种不同方法，并详细描述了 Bezier Clipping：

[http://www.tsplines.com/technology/edu/CurveIntersection.pdf](http://www.tsplines.com/technology/edu/CurveIntersection.pdf)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-04T22:44:42.437

我知道我有被多余的风险，但我正在调查同样的问题并找到了一个我在学术论文中读过但没有找到可行的解决方案的解决方案。

您可以将贝塞尔曲线重写为一组两个双变量三次方程，如下所示：

*   Δx = ax₁*t₁^3 + bx₁*t₁^2 + cx₁*t₁ + dx₁ - ax₂*t₂^3 - bx₂*t₂^2 - cx₂*t₂ - dx₂₂
*   Δy = ay₁*t₁^3 + by₁*t₁^2 + cy₁*t₁ + dy₁ - ay₂*t₂^3 - by₂*t₂^2 - cy₂*t₂ - dy₂</li>

显然，曲线与 (t₁,t₂) 的值相交，其中 Δx = Δy = 0。不幸的是，由于很难在二维中找到根，并且近似方法倾向于（正如另一位作者所说它）炸毁。

但是，如果您使用整数或有理数作为控制点，那么您可以使用**Groebner 基**将您的双变量 3 阶多项式重写为 (possibly-up-to-order-9-thus-your-nine-可能的交叉点）单变量多项式。之后，您只需要在一个维度中找到您的根（例如 t₂），然后将您的结果重新插入您的原始方程之一以找到另一个维度。

Burchburger 对 Groebner Bases 有一个通俗易懂的介绍，称为“ **Gröbner Bases: A Short Introduction for Systems Theorists** ”，这对我很有帮助。去谷歌上查询。另一篇很有帮助的论文是 TF Hain 的一篇名为“**三次贝塞尔路径和偏移曲线的快速、精确展平**”的论文，其中包含许多贝塞尔曲线的实用方程，包括如何找到 x 和 y 方程的多项式系数。

至于贝塞尔剪裁是否有助于这种特定方法，我对此表示怀疑，但贝塞尔剪裁是一种缩小交叉点可能存在的方法，而不是找到它所在位置的最终（尽管可能是近似的）答案。使用这种方法会花费大量时间来寻找单变量方程，而使用裁剪不会使这项任务变得更容易。相比之下，找到根源是微不足道的。

但是，这种方法的优点之一是它不依赖于递归地细分曲线，问题变成了一个简单的一维求根问题，这并不容易，但有据可查。主要缺点是计算 Groebner 基的成本很高，并且如果您正在处理浮点多项式或使用更高阶的 Bezier 曲线，则会变得非常笨拙。

如果你想在 Haskell 中完成一些代码来找到交叉点，请告诉我。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-10T18:54:23.107

很久很久以前，我编写了代码来执行此操作。我正在使用作为 PostScipt 路径生成的分段 Bezier 边界来定义 2D 对象的项目。

我使用的方法是：

让曲线 p、q 由 Bezier 控制点定义。它们相交吗？

计算控制点的边界框。如果它们不重叠，则两条曲线不相交。否则：

px(t), py(t), qx(u), qy(u) 是 0 <= t,u <= 1.0 上的三次多项式。距离平方 (px - qx) ** 2 + (py - qy) ** 2 是 (t,u) 上的多项式。使用 Newton-Raphson 尝试将其解决为零。丢弃 0 <= t,u <= 1.0 之外的任何解

NR 可能收敛也可能不收敛。曲线可能不相交，或者当两条曲线几乎平行时，NR 可能会爆炸。因此，如果在任意次数的迭代后没有收敛，则切断 NR。这可能是一个相当小的数字。

如果 NR 不收敛于解，则在 t = 0.5 时将一条曲线（例如 p）分成两条曲线 pa、pb。这很简单，它只是计算中点，如链接文章所示。然后递归地测试 (q, pa) 和 (q, pb) 的交叉点。（请注意，在下一层递归中，q 已变为 p，因此 p 和 q 在递归的每一层上交替拆分。）

大多数递归调用很快返回，因为边界框是不重叠的。

您将不得不在某个任意深度切断递归，以处理两条曲线平行且不完全接触的奇怪情况，但它们之间的距离任意小 - 可能只有 1 ULP 的差异。

当你找到一个交点时，你还没有完成，因为三次曲线可以有多个交叉点。所以你必须在交点处分割每条曲线，并递归检查（pa，qa），（pa，qb），（pb，qa），（pb，qb）之间的更多交点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T21:03:10.970

有许多关于进行贝塞尔剪裁的学术研究论文：

[http://www.andrew.cmu.edu/user/sowen/abstracts/Se306.html](http://www.andrew.cmu.edu/user/sowen/abstracts/Se306.html)

[http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.61.6669](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.61.6669)

[http://www.dm.unibo.it/~casciola/html/research_rr.html](http://www.dm.unibo.it/~casciola/html/research_rr.html)

我推荐间隔方法，因为正如您所描述的，您不必划分为多边形，并且可以获得有保证的结果以及为结果集定义自己的任意精度。有关区间渲染的更多信息，您也可以参考[http://www.sunfishstudio.com](http://www.sunfishstudio.com)

# java - 对地图进行排序 按价值观

> ID：109383
> 
> 赞同：1803
> 
> 时间：2008-09-20T21:03:23.403
> 
> 标签：java, sorting, dictionary, collections

我对 Java 比较陌生，经常发现我需要对`Map<Key, Value>`值进行排序。

由于这些值不是唯一的，我发现自己将 转换`keySet`为，并使用**自定义比较器**`array`通过**数组排序**对该数组进行排序，该比较器对与键关联的值进行排序。

 **有没有更简单的方法？

* * *

## 回答 #1

> 赞同：974
> 
> 时间：2010-04-05T23:24:05.927

这是一个通用的友好版本：

```
public class MapUtil {
    public static <K, V extends Comparable<? super V>> Map<K, V> sortByValue(Map<K, V> map) {
        List<Entry<K, V>> list = new ArrayList<>(map.entrySet());
        list.sort(Entry.comparingByValue());

        Map<K, V> result = new LinkedHashMap<>();
        for (Entry<K, V> entry : list) {
            result.put(entry.getKey(), entry.getValue());
        }

        return result;
    }
} 
```

* * *

## 回答 #2

> 赞同：432
> 
> 时间：2009-08-16T07:53:12.447

### 重要的提示：

**此代码可以以多种方式中断。**如果您打算使用提供的代码，请务必阅读注释以了解其中的含义。例如，值不能再通过其键检索。（`get`总是返回`null`。）

* * *

这似乎比上述所有内容都容易得多。使用 TreeMap 如下：

```
public class Testing {
    public static void main(String[] args) {
        HashMap<String, Double> map = new HashMap<String, Double>();
        ValueComparator bvc = new ValueComparator(map);
        TreeMap<String, Double> sorted_map = new TreeMap<String, Double>(bvc);

        map.put("A", 99.5);
        map.put("B", 67.4);
        map.put("C", 67.4);
        map.put("D", 67.3);

        System.out.println("unsorted map: " + map);
        sorted_map.putAll(map);
        System.out.println("results: " + sorted_map);
    }
}

class ValueComparator implements Comparator<String> {
    Map<String, Double> base;

    public ValueComparator(Map<String, Double> base) {
        this.base = base;
    }

    // Note: this comparator imposes orderings that are inconsistent with
    // equals.
    public int compare(String a, String b) {
        if (base.get(a) >= base.get(b)) {
            return -1;
        } else {
            return 1;
        } // returning 0 would merge keys
    }
} 
```

输出：

```
unsorted map: {D=67.3, A=99.5, B=67.4, C=67.4}
results: {D=67.3, B=67.4, C=67.4, A=99.5} 
```

* * *

## 回答 #3

> 赞同：417
> 
> 时间：2014-05-24T15:53:51.647

Java 8 提供了一个新的答案：将条目转换为流，并使用 Map.Entry 中的比较器组合器：

```
Stream<Map.Entry<K,V>> sorted =
    map.entrySet().stream()
       .sorted(Map.Entry.comparingByValue()); 
```

这将允许您使用按值升序排序的条目。如果您想要递减值，只需反转比较器：

```
Stream<Map.Entry<K,V>> sorted =
    map.entrySet().stream()
       .sorted(Collections.reverseOrder(Map.Entry.comparingByValue())); 
```

如果这些值不可比较，您可以传递一个显式比较器：

```
Stream<Map.Entry<K,V>> sorted =
    map.entrySet().stream()
       .sorted(Map.Entry.comparingByValue(comparator)); 
```

然后，您可以继续使用其他流操作来使用数据。例如，如果您想要新地图中的前 10 名：

```
Map<K,V> topTen =
    map.entrySet().stream()
       .sorted(Map.Entry.comparingByValue(Comparator.reverseOrder()))
       .limit(10)
       .collect(Collectors.toMap(
          Map.Entry::getKey, Map.Entry::getValue, (e1, e2) -> e1, LinkedHashMap::new)); 
```

或打印到`System.out`：

```
map.entrySet().stream()
   .sorted(Map.Entry.comparingByValue())
   .forEach(System.out::println); 
```

* * *

## 回答 #4

> 赞同：215
> 
> 时间：2010-08-06T03:59:41.683

**三个 1 行答案...**

我会使用~~Google Collections~~ [**Guava**](http://code.google.com/p/guava-libraries/)来做到这一点 - 如果你的价值观是，`Comparable`那么你可以使用

```
valueComparator = Ordering.natural().onResultOf(Functions.forMap(map)) 
```

这将为地图创建一个函数（对象）[将任何键作为输入，返回相应的值]，然后对它们应用自然（可比较）排序[值]。

如果它们没有可比性，那么您需要按照以下方式做一些事情

```
valueComparator = Ordering.from(comparator).onResultOf(Functions.forMap(map)) 
```

这些可以应用于 TreeMap （如`Ordering`extends `Comparator`），或[经过一些排序后的 LinkedHashMap](https://stackoverflow.com/questions/109383/how-to-sort-a-mapkey-value-on-the-values-in-java/109389#109389)

*注意*：如果您要使用 TreeMap，请记住，如果比较 == 0，则该项目已经在列表中（如果您有多个比较相同的值，则会发生这种情况）。为了缓解这种情况，您可以像这样将您的键添加到比较器中（假设您的键和值是`Comparable`）：

```
valueComparator = Ordering.natural().onResultOf(Functions.forMap(map)).compound(Ordering.natural()) 
```

=*对键映射的值应用自然排序，并将其与键的自然排序复合*

请注意，如果您的密钥比较为 0，这仍然不起作用，但这对于大多数`comparable`项目来说应该足够了（因为`hashCode`,`equals`并且`compareTo`通常是同步的......）

请参阅[Ordering.onResultOf()](http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Ordering.html#onResultOf(com.google.common.base.Function))和[Functions.forMap()](http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Functions.html#forMap(java.util.Map))。

## 执行

所以现在我们有了一个可以做我们想要的比较器，我们需要从中得到一个结果。

```
map = ImmutableSortedMap.copyOf(myOriginalMap, valueComparator); 
```

现在这很可能会起作用，但是：

1.  需要完成一张完整的地图
2.  不要在 a 上尝试上面的比较器`TreeMap`；当插入的键在放置之后才具有值时，尝试比较它是没有意义的，即它会非常快地中断

第 1 点对我来说有点破坏交易；google collections 非常懒惰（这很好：您几乎可以在瞬间完成所有操作；真正的工作在您开始使用结果时完成），这需要复制*整个*地图！

## “完整”答案/按值实时排序的地图

不过不用担心；如果您对以这种方式排序的“实时”地图非常着迷，那么您可以解决上述问题中的一个，而是解决两个（！）问题，如下所示：

**`TreeMap.get()`注意：这在 2012 年 6 月发生了显着变化 - 以前的代码永远无法工作：需要内部 HashMap 来查找值，而不会在->`compare()`和`compare()`->之间创建无限循环`get()`**

```
import static org.junit.Assert.assertEquals;

import java.util.HashMap;
import java.util.Map;
import java.util.TreeMap;

import com.google.common.base.Functions;
import com.google.common.collect.Ordering;

class ValueComparableMap<K extends Comparable<K>,V> extends TreeMap<K,V> {
    //A map for doing lookups on the keys for comparison so we don't get infinite loops
    private final Map<K, V> valueMap;

    ValueComparableMap(final Ordering<? super V> partialValueOrdering) {
        this(partialValueOrdering, new HashMap<K,V>());
    }

    private ValueComparableMap(Ordering<? super V> partialValueOrdering,
            HashMap<K, V> valueMap) {
        super(partialValueOrdering //Apply the value ordering
                .onResultOf(Functions.forMap(valueMap)) //On the result of getting the value for the key from the map
                .compound(Ordering.natural())); //as well as ensuring that the keys don't get clobbered
        this.valueMap = valueMap;
    }

    public V put(K k, V v) {
        if (valueMap.containsKey(k)){
            //remove the key in the sorted set before adding the key again
            remove(k);
        }
        valueMap.put(k,v); //To get "real" unsorted values for the comparator
        return super.put(k, v); //Put it in value order
    }

    public static void main(String[] args){
        TreeMap<String, Integer> map = new ValueComparableMap<String, Integer>(Ordering.natural());
        map.put("a", 5);
        map.put("b", 1);
        map.put("c", 3);
        assertEquals("b",map.firstKey());
        assertEquals("a",map.lastKey());
        map.put("d",0);
        assertEquals("d",map.firstKey());
        //ensure it's still a map (by overwriting a key, but with a new value) 
        map.put("d", 2);
        assertEquals("b", map.firstKey());
        //Ensure multiple values do not clobber keys
        map.put("e", 2);
        assertEquals(5, map.size());
        assertEquals(2, (int) map.get("e"));
        assertEquals(2, (int) map.get("d"));
    }
 } 
```

我们放的时候保证hash map有比较器的值，然后放到TreeSet中进行排序。但在此之前，我们检查哈希映射以查看密钥实际上不是重复的。此外，我们创建的比较器还将包含键，以便重复值不会删除非重复键（由于 == 比较）。这两项对于确保保留地图合同*至关重要；*如果您认为您不想要那样，那么您几乎处于完全反转地图的地步（到`Map<V,K>`）。

构造函数需要被称为

```
 new ValueComparableMap(Ordering.natural());
 //or
 new ValueComparableMap(Ordering.from(comparator)); 
```

* * *

## 回答 #5

> 赞同：188
> 
> 时间：2008-09-20T21:06:34.647

来自[http://www.programmersheaven.com/download/49349/download.aspx](http://www.programmersheaven.com/download/49349/download.aspx)

```
private static <K, V> Map<K, V> sortByValue(Map<K, V> map) {
    List<Entry<K, V>> list = new LinkedList<>(map.entrySet());
    Collections.sort(list, new Comparator<Object>() {
        @SuppressWarnings("unchecked")
        public int compare(Object o1, Object o2) {
            return ((Comparable<V>) ((Map.Entry<K, V>) (o1)).getValue()).compareTo(((Map.Entry<K, V>) (o2)).getValue());
        }
    });

    Map<K, V> result = new LinkedHashMap<>();
    for (Iterator<Entry<K, V>> it = list.iterator(); it.hasNext();) {
        Map.Entry<K, V> entry = (Map.Entry<K, V>) it.next();
        result.put(entry.getKey(), entry.getValue());
    }

    return result;
} 
```

* * *

## 回答 #6

> 赞同：89
> 
> 时间：2014-03-02T19:38:15.900

在 Java 8 中，您可以使用[流 api](https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html)以一种更简洁的方式执行此操作：

```
Map<K, V> sortedMap = map.entrySet().stream()
                         .sorted(Entry.comparingByValue())
                         .collect(Collectors.toMap(Entry::getKey, Entry::getValue, (e1, e2) -> e1, LinkedHashMap::new)); 
```

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2008-09-20T23:41:54.273

对键进行排序需要比较器为每次比较查找每个值。一个更具可扩展性的解决方案将直接使用 entrySet，从那时起，该值将立即可用于每次比较（尽管我没有通过数字支持这一点）。

这是此类事物的通用版本：

```
public static <K, V extends Comparable<? super V>> List<K> getKeysSortedByValue(Map<K, V> map) {
    final int size = map.size();
    final List<Map.Entry<K, V>> list = new ArrayList<Map.Entry<K, V>>(size);
    list.addAll(map.entrySet());
    final ValueComparator<V> cmp = new ValueComparator<V>();
    Collections.sort(list, cmp);
    final List<K> keys = new ArrayList<K>(size);
    for (int i = 0; i < size; i++) {
        keys.set(i, list.get(i).getKey());
    }
    return keys;
}

private static final class ValueComparator<V extends Comparable<? super V>>
                                     implements Comparator<Map.Entry<?, V>> {
    public int compare(Map.Entry<?, V> o1, Map.Entry<?, V> o2) {
        return o1.getValue().compareTo(o2.getValue());
    }
} 
```

有一些方法可以减少上述解决方案的内存轮换。例如，创建的第一个 ArrayList 可以重新用作返回值；这将需要抑制一些泛型警告，但对于可重用的库代码可能是值得的。此外，Comparator 不必在每次调用时重新分配。

这是一个更有效但不那么吸引人的版本：

```
public static <K, V extends Comparable<? super V>> List<K> getKeysSortedByValue2(Map<K, V> map) {
    final int size = map.size();
    final List reusedList = new ArrayList(size);
    final List<Map.Entry<K, V>> meView = reusedList;
    meView.addAll(map.entrySet());
    Collections.sort(meView, SINGLE);
    final List<K> keyView = reusedList;
    for (int i = 0; i < size; i++) {
        keyView.set(i, meView.get(i).getKey());
    }
    return keyView;
}

private static final Comparator SINGLE = new ValueComparator(); 
```

最后，如果您需要持续访问排序后的信息（而不是偶尔排序一次），您可以使用额外的多图。如果您需要更多详细信息，请告诉我...

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2008-09-20T21:10:31.233

commons-collections 库包含一个名为[TreeBidiMap](http://commons.apache.org/collections/api-release/org/apache/commons/collections/bidimap/TreeBidiMap.html)的解决方案。或者，您可以查看 Google Collections API。它有你可以使用的[TreeMultimap 。](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/TreeMultimap.html)

如果你不想使用这些框架......它们带有源代码。

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2010-01-21T20:34:39.877

我已经查看了给定的答案，但是其中很多都比需要的更复杂，或者当多个键具有相同的值时删除地图元素。

这是我认为更合适的解决方案：

```
public static <K, V extends Comparable<V>> Map<K, V> sortByValues(final Map<K, V> map) {
    Comparator<K> valueComparator =  new Comparator<K>() {
        public int compare(K k1, K k2) {
            int compare = map.get(k2).compareTo(map.get(k1));
            if (compare == 0) return 1;
            else return compare;
        }
    };
    Map<K, V> sortedByValues = new TreeMap<K, V>(valueComparator);
    sortedByValues.putAll(map);
    return sortedByValues;
} 
```

请注意，地图是从最高值到最低值排序的。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2013-11-20T06:54:39.477

要使用 Java 8 中的新功能实现这一点：

```
import static java.util.Map.Entry.comparingByValue;
import static java.util.stream.Collectors.toList;

<K, V> List<Entry<K, V>> sort(Map<K, V> map, Comparator<? super V> comparator) {
    return map.entrySet().stream().sorted(comparingByValue(comparator)).collect(toList());
} 
```

条目使用给定的比较器按它们的值排序。或者，如果您的值可以相互比较，则不需要显式比较器：

```
<K, V extends Comparable<? super V>> List<Entry<K, V>> sort(Map<K, V> map) {
    return map.entrySet().stream().sorted(comparingByValue()).collect(toList());
} 
```

返回的列表是调用此方法时给定地图的快照，因此两者都不会反映对另一个的后续更改。对于地图的实时可迭代视图：

```
<K, V extends Comparable<? super V>> Iterable<Entry<K, V>> sort(Map<K, V> map) {
    return () -> map.entrySet().stream().sorted(comparingByValue()).iterator();
} 
```

返回的可迭代对象在每次迭代时都会创建给定映射的新快照，因此除非并发修改，否则它将始终反映映射的当前状态。

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2019-11-21T08:02:42.850

**给定地图**

```
 Map<String, Integer> wordCounts = new HashMap<>();
    wordCounts.put("USA", 100);
    wordCounts.put("jobs", 200);
    wordCounts.put("software", 50);
    wordCounts.put("technology", 70);
    wordCounts.put("opportunity", 200); 
```

**根据值升序对地图进行排序**

```
Map<String,Integer>  sortedMap =  wordCounts.entrySet().
                                                stream().
                                                sorted(Map.Entry.comparingByValue()).
        collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (e1, e2) -> e1, LinkedHashMap::new));
    System.out.println(sortedMap); 
```

**根据值按降序对地图进行排序**

```
Map<String,Integer>  sortedMapReverseOrder =  wordCounts.entrySet().
            stream().
            sorted(Map.Entry.comparingByValue(Comparator.reverseOrder())).
            collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue, (e1, e2) -> e1, LinkedHashMap::new));
    System.out.println(sortedMapReverseOrder); 
```

**输出：**

{软件=50，技术=70，美国=100，工作=200，机会=200}

{工作=200，机会=200，美国=100，技术=70，软件=50}

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2013-02-10T06:10:09.980

创建自定义比较器并在创建新 TreeMap 对象时使用它。

```
class MyComparator implements Comparator<Object> {

    Map<String, Integer> map;

    public MyComparator(Map<String, Integer> map) {
        this.map = map;
    }

    public int compare(Object o1, Object o2) {

        if (map.get(o2) == map.get(o1))
            return 1;
        else
            return ((Integer) map.get(o2)).compareTo((Integer)     
                                                            map.get(o1));

    }
} 
```

在您的主要功能中使用以下代码

```
 Map<String, Integer> lMap = new HashMap<String, Integer>();
    lMap.put("A", 35);
    lMap.put("B", 75);
    lMap.put("C", 50);
    lMap.put("D", 50);

    MyComparator comparator = new MyComparator(lMap);

    Map<String, Integer> newMap = new TreeMap<String, Integer>(comparator);
    newMap.putAll(lMap);
    System.out.println(newMap); 
```

输出：

```
{B=75, D=50, C=50, A=35} 
```

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2008-09-23T04:30:40.630

虽然我同意对地图进行排序的持续需求可能是一种气味，但我认为以下代码是不使用不同数据结构的最简单方法。

```
public class MapUtilities {

public static <K, V extends Comparable<V>> List<Entry<K, V>> sortByValue(Map<K, V> map) {
    List<Entry<K, V>> entries = new ArrayList<Entry<K, V>>(map.entrySet());
    Collections.sort(entries, new ByValue<K, V>());
    return entries;
}

private static class ByValue<K, V extends Comparable<V>> implements Comparator<Entry<K, V>> {
    public int compare(Entry<K, V> o1, Entry<K, V> o2) {
        return o1.getValue().compareTo(o2.getValue());
    }
} 
```

}

这是一个令人尴尬的不完整的单元测试：

```
public class MapUtilitiesTest extends TestCase {
public void testSorting() {
    HashMap<String, Integer> map = new HashMap<String, Integer>();
    map.put("One", 1);
    map.put("Two", 2);
    map.put("Three", 3);

    List<Map.Entry<String, Integer>> sorted = MapUtilities.sortByValue(map);
    assertEquals("First", "One", sorted.get(0).getKey());
    assertEquals("Second", "Two", sorted.get(1).getKey());
    assertEquals("Third", "Three", sorted.get(2).getKey());
} 
```

}

结果是 Map.Entry 对象的排序列表，您可以从中获取键和值。

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2011-07-05T14:49:19.647

使用通用比较器，例如：

```
final class MapValueComparator<K,V extends Comparable<V>> implements Comparator<K> {
    private final Map<K,V> map;

    private MapValueComparator() {
        super();
    }

    public MapValueComparator(Map<K,V> map) {
        this();
        this.map = map;
    }

    public int compare(K o1, K o2) {
        return map.get(o1).compareTo(map.get(o2));
    }
} 
```

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2011-07-15T09:23:24.780

当您有 2 个相等的项目时，投票最多的答案不起作用。TreeMap 会留下相等的值。

示例：未排序的地图

```
键/值：D/67.3
键/值：A/99.5
键/值：B/67.4
键/值：C/67.5
键/值：E/99.5

```

结果

```
键/值：A/99.5
键/值：C/67.5
键/值：B/67.4
键/值：D/67.3

```

所以省略E！

对我来说，调整比较器效果很好，如果它等于不返回 0 而是 -1。

在示例中：

> > 类 ValueComparator 实现 Comparator {
> > 
> > 地图基地；public ValueComparator(Map base) { this.base = base; }
> > 
> > 公共 int 比较（对象 a，对象 b）{
> > 
> > ```
> > if((Double)base.get(a) < (Double)base.get(b)) {
> >   return 1;
> > } else if((Double)base.get(a) == (Double)base.get(b)) {
> >   return -1;
> > } else {
> >   return -1;
> > } 
> > ```
> > 
> > } }

现在它返回：

未排序的地图：

```
键/值：D/67.3
键/值：A/99.5
键/值：B/67.4
键/值：C/67.5
键/值：E/99.5

```

结果：

```
键/值：A/99.5
键/值：E/99.5
键/值：C/67.5
键/值：B/67.4
键/值：D/67.3

```

作为对 Aliens（2011 年 11 月 22 日）的回应：我正在将此解决方案用于整数 ID 和名称的映射，但想法是相同的，所以可能是上面的代码不正确（我将在测试中编写它并给你正确的代码），这是地图排序的代码，基于上面的解决方案：

```
package nl.iamit.util;

import java.util.Comparator;
import java.util.Map;

public class Comparators {

    public static class MapIntegerStringComparator implements Comparator {

        Map<Integer, String> base;

        public MapIntegerStringComparator(Map<Integer, String> base) {
            this.base = base;
        }

        public int compare(Object a, Object b) {

            int compare = ((String) base.get(a))
                    .compareTo((String) base.get(b));
            if (compare == 0) {
                return -1;
            }
            return compare;
        }
    }

} 
```

这是测试类（我刚刚测试过，这适用于整数、字符串映射：

```
package test.nl.iamit.util;

import java.util.HashMap;
import java.util.TreeMap;
import nl.iamit.util.Comparators;
import org.junit.Test;
import static org.junit.Assert.assertArrayEquals;

public class TestComparators {

    @Test
    public void testMapIntegerStringComparator(){
        HashMap<Integer, String> unSoretedMap = new HashMap<Integer, String>();
        Comparators.MapIntegerStringComparator bvc = new Comparators.MapIntegerStringComparator(
                unSoretedMap);
        TreeMap<Integer, String> sorted_map = new TreeMap<Integer, String>(bvc);
        //the testdata:
        unSoretedMap.put(new Integer(1), "E");
        unSoretedMap.put(new Integer(2), "A");
        unSoretedMap.put(new Integer(3), "E");
        unSoretedMap.put(new Integer(4), "B");
        unSoretedMap.put(new Integer(5), "F");

        sorted_map.putAll(unSoretedMap);

        Object[] targetKeys={new Integer(2),new Integer(4),new Integer(3),new Integer(1),new Integer(5) };
        Object[] currecntKeys=sorted_map.keySet().toArray();

        assertArrayEquals(targetKeys,currecntKeys);
    }
} 
```

这是地图比较器的代码：

```
public static class MapStringDoubleComparator implements Comparator {

    Map<String, Double> base;

    public MapStringDoubleComparator(Map<String, Double> base) {
        this.base = base;
    }

    //note if you want decending in stead of ascending, turn around 1 and -1
    public int compare(Object a, Object b) {
        if ((Double) base.get(a) == (Double) base.get(b)) {
            return 0;
        } else if((Double) base.get(a) < (Double) base.get(b)) {
            return -1;
        }else{
            return 1;
        }
    }
} 
```

这是测试用例：

```
@Test
public void testMapStringDoubleComparator(){
    HashMap<String, Double> unSoretedMap = new HashMap<String, Double>();
    Comparators.MapStringDoubleComparator bvc = new Comparators.MapStringDoubleComparator(
            unSoretedMap);
    TreeMap<String, Double> sorted_map = new TreeMap<String, Double>(bvc);
    //the testdata:
    unSoretedMap.put("D",new Double(67.3));
    unSoretedMap.put("A",new Double(99.5));
    unSoretedMap.put("B",new Double(67.4));
    unSoretedMap.put("C",new Double(67.5));
    unSoretedMap.put("E",new Double(99.5));

    sorted_map.putAll(unSoretedMap);

    Object[] targetKeys={"D","B","C","E","A"};
    Object[] currecntKeys=sorted_map.keySet().toArray();

    assertArrayEquals(targetKeys,currecntKeys);
} 
```

当然你可以让它更通用，但我只需要它来处理 1 个案例（地图）

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2012-05-30T00:47:27.547

`Collections.sort`我建议不要像某些人那样使用`Arrays.sort`. 实际上`Collections.sort`是这样的：

```
public static <T extends Comparable<? super T>> void sort(List<T> list) {
    Object[] a = list.toArray();
    Arrays.sort(a);
    ListIterator<T> i = list.listIterator();
    for (int j=0; j<a.length; j++) {
        i.next();
        i.set((T)a[j]);
    }
} 
```

它只是调用`toArray`列表然后使用`Arrays.sort`. 这样所有的地图条目将被复制三次：一次从地图复制到临时列表（无论是 LinkedList 还是 ArrayList），然后复制到临时数组，最后复制到新地图。

我的解决方案省略了这一步，因为它不会创建不必要的 LinkedList。这是代码，通用友好且性能最佳：

```
public static <K, V extends Comparable<? super V>> Map<K, V> sortByValue(Map<K, V> map) 
{
    @SuppressWarnings("unchecked")
    Map.Entry<K,V>[] array = map.entrySet().toArray(new Map.Entry[map.size()]);

    Arrays.sort(array, new Comparator<Map.Entry<K, V>>() 
    {
        public int compare(Map.Entry<K, V> e1, Map.Entry<K, V> e2) 
        {
            return e1.getValue().compareTo(e2.getValue());
        }
    });

    Map<K, V> result = new LinkedHashMap<K, V>();
    for (Map.Entry<K, V> entry : array)
        result.put(entry.getKey(), entry.getValue());

    return result;
} 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2011-02-09T10:21:25.467

这是 Anthony 答案的变体，如果存在重复值，则该方法不起作用：

```
public static <K, V extends Comparable<V>> Map<K, V> sortMapByValues(final Map<K, V> map) {
    Comparator<K> valueComparator =  new Comparator<K>() {
        public int compare(K k1, K k2) {
            final V v1 = map.get(k1);
            final V v2 = map.get(k2);

            /* Not sure how to handle nulls ... */
            if (v1 == null) {
                return (v2 == null) ? 0 : 1;
            }

            int compare = v2.compareTo(v1);
            if (compare != 0)
            {
                return compare;
            }
            else
            {
                Integer h1 = k1.hashCode();
                Integer h2 = k2.hashCode();
                return h2.compareTo(h1);
            }
        }
    };
    Map<K, V> sortedByValues = new TreeMap<K, V>(valueComparator);
    sortedByValues.putAll(map);
    return sortedByValues;
} 
```

请注意，如何处理空值尚无定论。

这种方法的一个重要优点是它实际上返回了一个 Map，这与这里提供的其他一些解决方案不同。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2018-05-18T07:40:39.830

迟到。

随着 Java-8 的出现，我们可以以非常简单/简洁的方式使用流进行数据操作。您可以使用流按值对映射条目进行排序，并创建一个保留*插入顺序*迭代的[LinkedHashMap 。](https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html)

 *例如：

```
LinkedHashMap sortedByValueMap = map.entrySet().stream()
                .sorted(comparing(Entry<Key,Value>::getValue).thenComparing(Entry::getKey))     //first sorting by Value, then sorting by Key(entries with same value)
                .collect(LinkedHashMap::new,(map,entry) -> map.put(entry.getKey(),entry.getValue()),LinkedHashMap::putAll); 
```

* * *

对于反向排序，请替换：

```
comparing(Entry<Key,Value>::getValue).thenComparing(Entry::getKey) 
```

和

```
comparing(Entry<Key,Value>::getValue).thenComparing(Entry::getKey).reversed() 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2015-11-19T10:29:01.647

**最佳方法**

```
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.Map.Entry; 

public class OrderByValue {

  public static void main(String a[]){
    Map<String, Integer> map = new HashMap<String, Integer>();
    map.put("java", 20);
    map.put("C++", 45);
    map.put("Unix", 67);
    map.put("MAC", 26);
    map.put("Why this kolavari", 93);
    Set<Entry<String, Integer>> set = map.entrySet();
    List<Entry<String, Integer>> list = new ArrayList<Entry<String, Integer>>(set);
    Collections.sort( list, new Comparator<Map.Entry<String, Integer>>()
    {
        public int compare( Map.Entry<String, Integer> o1, Map.Entry<String, Integer> o2 )
        {
            return (o1.getValue()).compareTo( o2.getValue() );//Ascending order
            //return (o2.getValue()).compareTo( o1.getValue() );//Descending order
        }
    } );
    for(Map.Entry<String, Integer> entry:list){
        System.out.println(entry.getKey()+" ==== "+entry.getValue());
    }
  }} 
```

**输出**

```
java ==== 20

MAC ==== 26

C++ ==== 45

Unix ==== 67

Why this kolavari ==== 93 
```

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2012-11-18T06:37:50.230

主要问题。如果您使用第一个答案（Google 将您带到此处），请更改比较器以添加相等子句，否则您无法通过键从 sorted_map 获取值：

```
public int compare(String a, String b) {
        if (base.get(a) > base.get(b)) {
            return 1;
        } else if (base.get(a) < base.get(b)){
            return -1;
        } 

        return 0;
        // returning 0 would merge keys
    } 
```

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2016-04-24T05:11:41.910

这个问题已经有很多答案了，但是没有一个能提供我正在寻找的东西，一个映射实现，它返回按关联值排序的键和条目，并在映射中修改键和值时维护这个属性。[另外](https://stackoverflow.com/q/13108887/1760575) 两个[问题](https://stackoverflow.com/q/7465369/1760575)专门针对这个问题。

我制作了一个通用的友好示例来解决这个用例。此实现不遵守 Map 接口的所有约定，例如反映从原始对象中的 keySet() 和 entrySet() 返回的集合中的值更改和删除。我觉得这样的解决方案太大而无法包含在 Stack Overflow 的答案中。如果我设法创建一个更完整的实现，也许我会将它发布到 Github，然后在这个答案的更新版本中链接到它。

```
import java.util.*;

/**
 * A map where {@link #keySet()} and {@link #entrySet()} return sets ordered
 * by associated values based on the the comparator provided at construction
 * time. The order of two or more keys with identical values is not defined.
 * <p>
 * Several contracts of the Map interface are not satisfied by this minimal
 * implementation.
 */
public class ValueSortedMap<K, V> extends HashMap<K, V> {
    protected Map<V, Collection<K>> valueToKeysMap;

    // uses natural order of value object, if any
    public ValueSortedMap() {
        this((Comparator<? super V>) null);
    }

    public ValueSortedMap(Comparator<? super V> valueComparator) {
        this.valueToKeysMap = new TreeMap<V, Collection<K>>(valueComparator);
    }

    public boolean containsValue(Object o) {
        return valueToKeysMap.containsKey(o);
    }

    public V put(K k, V v) {
        V oldV = null;
        if (containsKey(k)) {
            oldV = get(k);
            valueToKeysMap.get(oldV).remove(k);
        }
        super.put(k, v);
        if (!valueToKeysMap.containsKey(v)) {
            Collection<K> keys = new ArrayList<K>();
            keys.add(k);
            valueToKeysMap.put(v, keys);
        } else {
            valueToKeysMap.get(v).add(k);
        }
        return oldV;
    }

    public void putAll(Map<? extends K, ? extends V> m) {
        for (Map.Entry<? extends K, ? extends V> e : m.entrySet())
            put(e.getKey(), e.getValue());
    }

    public V remove(Object k) {
        V oldV = null;
        if (containsKey(k)) {
            oldV = get(k);
            super.remove(k);
            valueToKeysMap.get(oldV).remove(k);
        }
        return oldV;
    }

    public void clear() {
        super.clear();
        valueToKeysMap.clear();
    }

    public Set<K> keySet() {
        LinkedHashSet<K> ret = new LinkedHashSet<K>(size());
        for (V v : valueToKeysMap.keySet()) {
            Collection<K> keys = valueToKeysMap.get(v);
            ret.addAll(keys);
        }
        return ret;
    }

    public Set<Map.Entry<K, V>> entrySet() {
        LinkedHashSet<Map.Entry<K, V>> ret = new LinkedHashSet<Map.Entry<K, V>>(size());
        for (Collection<K> keys : valueToKeysMap.values()) {
            for (final K k : keys) {
                final V v = get(k);
                ret.add(new Map.Entry<K,V>() {
                    public K getKey() {
                        return k;
                    }

                    public V getValue() {
                        return v;
                    }

                    public V setValue(V v) {
                        throw new UnsupportedOperationException();
                    }
                });
            }
        }
        return ret;
    }
} 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2020-03-13T19:47:43.863

在 Java 8 及更高版本中对任何地图进行排序的简单方法

```
Map<String, Object> mapToSort = new HashMap<>();

List<Map.Entry<String, Object>> list = new LinkedList<>(mapToSort.entrySet());

Collections.sort(list, Comparator.comparing(o -> o.getValue().getAttribute()));

HashMap<String, Object> sortedMap = new LinkedHashMap<>();
for (Map.Entry<String, Object> map : list) {
   sortedMap.put(map.getKey(), map.getValue());
} 
```

如果您使用的是 Java 7 及以下版本

```
Map<String, Object> mapToSort = new HashMap<>();

List<Map.Entry<String, Object>> list = new LinkedList<>(mapToSort.entrySet());

Collections.sort(list, new Comparator<Map.Entry<String, Object>>() {
    @Override
    public int compare(Map.Entry<String, Object> o1, Map.Entry<String, Object> o2) {
       return o1.getValue().getAttribute().compareTo(o2.getValue().getAttribute());      
    }
});

HashMap<String, Object> sortedMap = new LinkedHashMap<>();
for (Map.Entry<String, Object> map : list) {
   sortedMap.put(map.getKey(), map.getValue());
} 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2008-09-20T21:07:49.353

根据上下文，使用`java.util.LinkedHashMap<T>`which 记住项目放置到地图中的顺序。否则，如果您需要根据值的自然顺序对值进行排序，我建议您维护一个单独的列表，该列表可以通过`Collections.sort()`.

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2011-06-08T15:23:04.577

Afaik 最干净的方法是利用集合对值进行排序：

```
Map<String, Long> map = new HashMap<String, Long>();
// populate with data to sort on Value
// use datastructure designed for sorting

Queue queue = new PriorityQueue( map.size(), new MapComparable() );
queue.addAll( map.entrySet() );

// get a sorted map
LinkedHashMap<String, Long> linkedMap = new LinkedHashMap<String, Long>();

for (Map.Entry<String, Long> entry; (entry = queue.poll())!=null;) {
    linkedMap.put(entry.getKey(), entry.getValue());
}

public static class MapComparable implements Comparator<Map.Entry<String, Long>>{

  public int compare(Entry<String, Long> e1, Entry<String, Long> e2) {
    return e1.getValue().compareTo(e2.getValue());
  }
} 
```

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2010-05-09T13:40:59.477

这太复杂了。地图不应该做按价值对它们进行排序这样的工作。最简单的方法是创建您自己的类，使其符合您的要求。

在较低的示例中，您应该在 * 所在的位置添加 TreeMap 比较器。但是通过 java API，它只给比较器提供键，而不是值。此处所述的所有示例均基于 2 个地图。一个哈希和一个新树。这很奇怪。

这个例子：

```
Map<Driver driver, Float time> map = new TreeMap<Driver driver, Float time>(*); 
```

因此，以这种方式将地图更改为一组：

```
ResultComparator rc = new ResultComparator();
Set<Results> set = new TreeSet<Results>(rc); 
```

您将创建课程`Results`，

```
public class Results {
    private Driver driver;
    private Float time;

    public Results(Driver driver, Float time) {
        this.driver = driver;
        this.time = time;
    }

    public Float getTime() {
        return time;
    }

    public void setTime(Float time) {
        this.time = time;
    }

    public Driver getDriver() {
        return driver;
    }

    public void setDriver (Driver driver) {
        this.driver = driver;
    }
} 
```

和比较器类：

```
public class ResultsComparator implements Comparator<Results> {
    public int compare(Results t, Results t1) {
        if (t.getTime() < t1.getTime()) {
            return 1;
        } else if (t.getTime() == t1.getTime()) {
            return 0;
        } else {
            return -1;
        }
    }
} 
```

这样您就可以轻松添加更多依赖项。

最后一点，我将添加简单的迭代器：

```
Iterator it = set.iterator();
while (it.hasNext()) {
    Results r = (Results)it.next();
    System.out.println( r.getDriver().toString
        //or whatever that is related to Driver class -getName() getSurname()
        + " "
        + r.getTime()
        );
} 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2011-08-31T20:40:25.623

由于***TreeMap<> 不适***用于可以相等的值，我使用了这个：

```
private <K, V extends Comparable<? super V>> List<Entry<K, V>> sort(Map<K, V> map)     {
    List<Map.Entry<K, V>> list = new LinkedList<Map.Entry<K, V>>(map.entrySet());
    Collections.sort(list, new Comparator<Map.Entry<K, V>>() {
        public int compare(Map.Entry<K, V> o1, Map.Entry<K, V> o2) {
            return o1.getValue().compareTo(o2.getValue());
        }
    });

    return list;
} 
```

您可能想将***list***放入***LinkedHashMap***，但如果您只想立即对其进行迭代，那是多余的......

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2009-04-14T13:44:29.413

基于@devinmoore 代码，一种使用泛型并支持升序和降序的地图排序方法。

```
/**
 * Sort a map by it's keys in ascending order. 
 *  
 * @return new instance of {@link LinkedHashMap} contained sorted entries of supplied map.
 * @author Maxim Veksler
 */
public static <K, V> LinkedHashMap<K, V> sortMapByKey(final Map<K, V> map) {
    return sortMapByKey(map, SortingOrder.ASCENDING);
}

/**
 * Sort a map by it's values in ascending order.
 *  
 * @return new instance of {@link LinkedHashMap} contained sorted entries of supplied map.
 * @author Maxim Veksler
 */
public static <K, V> LinkedHashMap<K, V> sortMapByValue(final Map<K, V> map) {
    return sortMapByValue(map, SortingOrder.ASCENDING);
}

/**
 * Sort a map by it's keys.
 *  
 * @param sortingOrder {@link SortingOrder} enum specifying requested sorting order. 
 * @return new instance of {@link LinkedHashMap} contained sorted entries of supplied map.
 * @author Maxim Veksler
 */
public static <K, V> LinkedHashMap<K, V> sortMapByKey(final Map<K, V> map, final SortingOrder sortingOrder) {
    Comparator<Map.Entry<K, V>> comparator = new Comparator<Entry<K,V>>() {
        public int compare(Entry<K, V> o1, Entry<K, V> o2) {
            return comparableCompare(o1.getKey(), o2.getKey(), sortingOrder);
        }
    };

    return sortMap(map, comparator);
}

/**
 * Sort a map by it's values.
 *  
 * @param sortingOrder {@link SortingOrder} enum specifying requested sorting order. 
 * @return new instance of {@link LinkedHashMap} contained sorted entries of supplied map.
 * @author Maxim Veksler
 */
public static <K, V> LinkedHashMap<K, V> sortMapByValue(final Map<K, V> map, final SortingOrder sortingOrder) {
    Comparator<Map.Entry<K, V>> comparator = new Comparator<Entry<K,V>>() {
        public int compare(Entry<K, V> o1, Entry<K, V> o2) {
            return comparableCompare(o1.getValue(), o2.getValue(), sortingOrder);
        }
    };

    return sortMap(map, comparator);
}

@SuppressWarnings("unchecked")
private static <T> int comparableCompare(T o1, T o2, SortingOrder sortingOrder) {
    int compare = ((Comparable<T>)o1).compareTo(o2);

    switch (sortingOrder) {
    case ASCENDING:
        return compare;
    case DESCENDING:
        return (-1) * compare;
    }

    return 0;
}

/**
 * Sort a map by supplied comparator logic.
 *  
 * @return new instance of {@link LinkedHashMap} contained sorted entries of supplied map.
 * @author Maxim Veksler
 */
public static <K, V> LinkedHashMap<K, V> sortMap(final Map<K, V> map, final Comparator<Map.Entry<K, V>> comparator) {
    // Convert the map into a list of key,value pairs.
    List<Map.Entry<K, V>> mapEntries = new LinkedList<Map.Entry<K, V>>(map.entrySet());

    // Sort the converted list according to supplied comparator.
    Collections.sort(mapEntries, comparator);

    // Build a new ordered map, containing the same entries as the old map.  
    LinkedHashMap<K, V> result = new LinkedHashMap<K, V>(map.size() + (map.size() / 20));
    for(Map.Entry<K, V> entry : mapEntries) {
        // We iterate on the mapEntries list which is sorted by the comparator putting new entries into 
        // the targeted result which is a sorted map. 
        result.put(entry.getKey(), entry.getValue());
    }

    return result;
}

/**
 * Sorting order enum, specifying request result sort behavior.
 * @author Maxim Veksler
 *
 */
public static enum SortingOrder {
    /**
     * Resulting sort will be from smaller to biggest.
     */
    ASCENDING,
    /**
     * Resulting sort will be from biggest to smallest.
     */
    DESCENDING
} 
```

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2011-01-02T05:53:22.097

这是一个面向对象的解决方案（即，不使用`static`方法）：

```
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

public class SortableValueMap<K, V extends Comparable<V>>
  extends LinkedHashMap<K, V> {
  public SortableValueMap() { }

  public SortableValueMap( Map<K, V> map ) {
    super( map );
  }

  public void sortByValue() {
    List<Map.Entry<K, V>> list = new LinkedList<Map.Entry<K, V>>( entrySet() );

    Collections.sort( list, new Comparator<Map.Entry<K, V>>() {
      public int compare( Map.Entry<K, V> entry1, Map.Entry<K, V> entry2 ) {
        return entry1.getValue().compareTo( entry2.getValue() );
      }
    });

    clear();

    for( Map.Entry<K, V> entry : list ) {
      put( entry.getKey(), entry.getValue() );
    }
  }

  private static void print( String text, Map<String, Double> map ) {
    System.out.println( text );

    for( String key : map.keySet() ) {
      System.out.println( "key/value: " + key + "/" + map.get( key ) );
    }
  }

  public static void main( String[] args ) {
    SortableValueMap<String, Double> map =
      new SortableValueMap<String, Double>();

    map.put( "A", 67.5 );
    map.put( "B", 99.5 );
    map.put( "C", 82.4 );
    map.put( "D", 42.0 );

    print( "Unsorted map", map );
    map.sortByValue();
    print( "Sorted map", map );
  }
} 
```

特此捐赠给公共领域。

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2011-12-27T17:43:44.593

当然斯蒂芬的解决方案真的很棒，但是对于那些不能使用番石榴的人：

这是我按值排序地图的解决方案。该解决方案处理存在两倍相同值等的情况......

```
// If you want to sort a map by value, and if there can be twice the same value:

// here is your original map
Map<String,Integer> mapToSortByValue = new HashMap<String, Integer>();
mapToSortByValue.put("A", 3);
mapToSortByValue.put("B", 1);
mapToSortByValue.put("C", 3);
mapToSortByValue.put("D", 5);
mapToSortByValue.put("E", -1);
mapToSortByValue.put("F", 1000);
mapToSortByValue.put("G", 79);
mapToSortByValue.put("H", 15);

// Sort all the map entries by value
Set<Map.Entry<String,Integer>> set = new TreeSet<Map.Entry<String,Integer>>(
        new Comparator<Map.Entry<String,Integer>>(){
            @Override
            public int compare(Map.Entry<String,Integer> obj1, Map.Entry<String,Integer> obj2) {
                Integer val1 = obj1.getValue();
                Integer val2 = obj2.getValue();
                // DUPLICATE VALUE CASE
                // If the values are equals, we can't return 0 because the 2 entries would be considered
                // as equals and one of them would be deleted (because we use a set, no duplicate, remember!)
                int compareValues = val1.compareTo(val2);
                if ( compareValues == 0 ) {
                    String key1 = obj1.getKey();
                    String key2 = obj2.getKey();
                    int compareKeys = key1.compareTo(key2);
                    if ( compareKeys == 0 ) {
                        // what you return here will tell us if you keep REAL KEY-VALUE duplicates in your set
                        // if you want to, do whatever you want but do not return 0 (but don't break the comparator contract!)
                        return 0;
                    }
                    return compareKeys;
                }
                return compareValues;
            }
        }
);
set.addAll(mapToSortByValue.entrySet());

// OK NOW OUR SET IS SORTED COOL!!!!

// And there's nothing more to do: the entries are sorted by value!
for ( Map.Entry<String,Integer> entry : set ) {
    System.out.println("Set entries: " + entry.getKey() + " -> " + entry.getValue());
}

// But if you add them to an hashmap
Map<String,Integer> myMap = new HashMap<String,Integer>();
// When iterating over the set the order is still good in the println...
for ( Map.Entry<String,Integer> entry : set ) {
    System.out.println("Added to result map entries: " + entry.getKey() + " " + entry.getValue());
    myMap.put(entry.getKey(), entry.getValue());
}

// But once they are in the hashmap, the order is not kept!
for ( Integer value : myMap.values() ) {
    System.out.println("Result map values: " + value);
}
// Also this way doesn't work:
// Logic because the entryset is a hashset for hashmaps and not a treeset
// (and even if it was a treeset, it would be on the keys only)
for ( Map.Entry<String,Integer> entry : myMap.entrySet() ) {
    System.out.println("Result map entries: " + entry.getKey() + " -> " + entry.getValue());
}

// CONCLUSION:
// If you want to iterate on a map ordered by value, you need to remember:
// 1) Maps are only sorted by keys, so you can't sort them directly by value
// 2) So you simply CAN'T return a map to a sortMapByValue function
// 3) You can't reverse the keys and the values because you have duplicate values
//    This also means you can't neither use Guava/Commons bidirectionnal treemaps or stuff like that

// SOLUTIONS
// So you can:
// 1) only sort the values which is easy, but you loose the key/value link (since you have duplicate values)
// 2) sort the map entries, but don't forget to handle the duplicate value case (like i did)
// 3) if you really need to return a map, use a LinkedHashMap which keep the insertion order 
```

执行官： [http ://www.ideone.com/dq3Lu](http://www.ideone.com/dq3Lu)

输出：

```
Set entries: E -> -1
Set entries: B -> 1
Set entries: A -> 3
Set entries: C -> 3
Set entries: D -> 5
Set entries: H -> 15
Set entries: G -> 79
Set entries: F -> 1000
Added to result map entries: E -1
Added to result map entries: B 1
Added to result map entries: A 3
Added to result map entries: C 3
Added to result map entries: D 5
Added to result map entries: H 15
Added to result map entries: G 79
Added to result map entries: F 1000
Result map values: 5
Result map values: -1
Result map values: 1000
Result map values: 79
Result map values: 3
Result map values: 1
Result map values: 3
Result map values: 15
Result map entries: D -> 5
Result map entries: E -> -1
Result map entries: F -> 1000
Result map entries: G -> 79
Result map entries: A -> 3
Result map entries: B -> 1
Result map entries: C -> 3
Result map entries: H -> 15 
```

希望它会帮助一些人

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2011-09-01T09:53:33.270

一些简单的更改，以便有一个带有重复值对的排序映射。在比较方法（ValueComparator 类）中，当值相等时，不返回 0，而是返回比较 2 个键的结果。映射中的键是不同的，因此您可以成功保留重复值（顺便说一下，这些值是按键排序的）。所以上面的例子可以这样修改：

```
 public int compare(Object a, Object b) {

        if((Double)base.get(a) < (Double)base.get(b)) {
          return 1;
        } else if((Double)base.get(a) == (Double)base.get(b)) {
          return ((String)a).compareTo((String)b);
        } else {
          return -1;
        }
      }
    } 
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2021-01-27T10:14:14.410

使用 java 8 可以很容易地实现这一点

```
public static LinkedHashMap<Integer, String> sortByValue(HashMap<Integer, String> map) {

        List<Map.Entry<Integer, String>> list = new ArrayList<>(map.entrySet());
        list.sort(Map.Entry.comparingByValue());
        LinkedHashMap<Integer, String> sortedMap = new LinkedHashMap<>();
        list.forEach(e -> sortedMap.put(e.getKey(), e.getValue()));
        return sortedMap;
    } 
```

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2013-07-28T02:26:00.303

你可以试试 Guava 的多图：

```
TreeMap<Integer, Collection<String>> sortedMap = new TreeMap<>(
        Multimaps.invertFrom(Multimaps.forMap(originalMap), 
        ArrayListMultimap.<Integer, String>create()).asMap()); 
```

结果，您获得了从原始值到对应于它们的键集合的映射。即使同一值有多个键，也可以使用此方法。

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2011-09-26T21:39:32.453

如果您有重复的键并且只有一小组数据（<1000）并且您的代码不是性能关键，您可以执行以下操作：

```
Map<String,Integer> tempMap=new HashMap<String,Integer>(inputUnsortedMap);
LinkedHashMap<String,Integer> sortedOutputMap=new LinkedHashMap<String,Integer>();

for(int i=0;i<inputUnsortedMap.size();i++){
    Map.Entry<String,Integer> maxEntry=null;
    Integer maxValue=-1;
    for(Map.Entry<String,Integer> entry:tempMap.entrySet()){
        if(entry.getValue()>maxValue){
            maxValue=entry.getValue();
            maxEntry=entry;
        }
    }
    tempMap.remove(maxEntry.getKey());
    sortedOutputMap.put(maxEntry.getKey(),maxEntry.getValue());
} 
```

**inputUnsortedMap**是代码的输入。

变量**sortedOutputMap**将在迭代时按降序包含数据。要更改顺序，只需在 if 语句中将 > 更改为 <。

不是最快的排序，但可以在没有任何额外依赖项的情况下完成这项工作。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2014-04-22T09:09:59.703

我已经合并了 user157196 和 Carter Page 的解决方案：

```
class MapUtil {

    public static <K, V extends Comparable<? super V>> Map<K, V> sortByValue( Map<K, V> map ){
        ValueComparator<K,V> bvc =  new ValueComparator<K,V>(map);
        TreeMap<K,V> sorted_map = new TreeMap<K,V>(bvc);
        sorted_map.putAll(map);
        return sorted_map;
    }

}

class ValueComparator<K, V extends Comparable<? super V>> implements Comparator<K> {

    Map<K, V> base;
    public ValueComparator(Map<K, V> base) {
        this.base = base;
    }

    public int compare(K a, K b) {
        int result = (base.get(a).compareTo(base.get(b)));
        if (result == 0) result=1;
        // returning 0 would merge keys
        return result;
    }
} 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2016-11-28T20:16:27.053

这是 Java 8 和[AbacusUtil的代码](https://github.com/landawn/AbacusUtil)

```
Map<String, Integer> map = N.asMap("a", 2, "b", 3, "c", 1, "d", 2);
Map<String, Integer> sortedMap = Stream.of(map.entrySet()).sorted(Map.Entry.comparingByValue()).toMap(e -> e.getKey(), e -> e.getValue(),
    LinkedHashMap::new);
N.println(sortedMap);
// output: {c=1, a=2, d=2, b=3} 
```

声明：我是AbacusUtil的开发者。

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2021-07-24T11:03:46.433

在 Java 中以最简单的方式对任何 Hashmap 进行排序。我们不需要将它存储在树形图、列表等中。

在这里，我将使用 Java Streams：

让我们按它的值对这张地图进行排序（升序）

```
Map<String, Integer> mp= new HashMap<>();
mp.put("zebra", 1);
mp.put("blossom", 2);
mp.put("gemini", 3);
mp.put("opera", 7);
mp.put("adelaide", 10);

Map<String, Integer> resultMap= mp.entrySet().stream().sorted(Map.Entry.<String, Integer>comparingByValue()).collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue,(e1, e2) -> e1, LinkedHashMap::new)); 
```

您现在可以通过多种方式打印排序的 resultMap，例如使用高级 for 循环或迭代器。

上图也可以按值降序排列

```
 Map<String, Integer> resultMap= mp.entrySet().stream().sorted(Map.Entry.<String, Integer>comparingByValue().reversed()).collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue,(e1, e2) -> e1, LinkedHashMap::new)); 
```

现在让我们看另一个场景，我们将“用户”存储在地图中，并根据“用户”的“名称”按升序（按字典顺序）对其进行排序：

```
User u1= new User("hi", 135);
User u2= new User("bismuth", 900);
User u3= new User("alloy", 675);
User u4= new User("jupiter", 342);
User u5= new User("lily", 941);

Map<String, User> map2= new HashMap<>();
map2.put("zebra", u3);
map2.put("blossom", u5);
map2.put("gemini", u1);
map2.put("opera", u2);
map2.put("adelaide", u4);

Map<String, User>  resultMap= 
          map2.entrySet().stream().sorted(Map.Entry.<String, User>comparingByValue( (User o1, User o2)-> o1.getName().compareTo(o2.getName()))).collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue,(e1, e2) -> e2, LinkedHashMap::new));

class User
 {
    String name;
    int id;

public User(String name, int id) {
    super();
    this.name = name;
    this.id = id;
}
public String getName() {
    return name;
}
public void setName(String name) {
    this.name = name;
}
public int getId() {
    return id;
}
public void setId(int id) {
    this.id = id;
}
@Override
public String toString() {
    return "User [name=" + name + ", id=" + id + "]";
}
@Override
public int hashCode() {
    final int prime = 31;
    int result = 1;
    result = prime * result + id;
    result = prime * result + ((name == null) ? 0 : name.hashCode());
    return result;
}
@Override
public boolean equals(Object obj) {
    if (this == obj)
        return true;
    if (obj == null)
        return false;
    if (getClass() != obj.getClass())
        return false;
    User other = (User) obj;
    if (id != other.id)
        return false;
    if (name == null) {
        if (other.name != null)
            return false;
    } else if (!name.equals(other.name))
        return false;
    return true;

    }
 } 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2008-09-21T15:03:21.547

When I'm faced with this, I just create a list on the side. If you put them together in a custom Map implementation, it'll have a nice feel to it... You can use something like the following, performing the sort only when needed. (Note: I haven't really tested this, but it compiles... might be a silly little bug in there somewhere)

(If you want it sorted by both keys and values, have the class extend TreeMap, don't define the accessor methods, and have the mutators call super.xxxxx instead of map_.xxxx)

```
package com.javadude.sample;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;

public class SortedValueHashMap<K, V> implements Map<K, V> {
    private Map<K, V> map_ = new HashMap<K, V>();
    private List<V> valueList_ = new ArrayList<V>();
    private boolean needsSort_ = false;
    private Comparator<V> comparator_;

    public SortedValueHashMap() {
    }
    public SortedValueHashMap(List<V> valueList) {
        valueList_ = valueList;
    }

    public List<V> sortedValues() {
        if (needsSort_) {
            needsSort_ = false;
            Collections.sort(valueList_, comparator_);
        }
        return valueList_;
    }

    // mutators
    public void clear() {
        map_.clear();
        valueList_.clear();
        needsSort_ = false;
    }

    public V put(K key, V value) {
        valueList_.add(value);
        needsSort_ = true;
        return map_.put(key, value);
    }

    public void putAll(Map<? extends K, ? extends V> m) {
        map_.putAll(m);
        valueList_.addAll(m.values());
        needsSort_ = true;
    }

    public V remove(Object key) {
        V value = map_.remove(key);
        valueList_.remove(value);
        return value;
    }

    // accessors
    public boolean containsKey(Object key)           { return map_.containsKey(key); }
    public boolean containsValue(Object value)       { return map_.containsValue(value); }
    public Set<java.util.Map.Entry<K, V>> entrySet() { return map_.entrySet(); }
    public boolean equals(Object o)                  { return map_.equals(o); }
    public V get(Object key)                         { return map_.get(key); }
    public int hashCode()                            { return map_.hashCode(); }
    public boolean isEmpty()                         { return map_.isEmpty(); }
    public Set<K> keySet()                           { return map_.keySet(); }
    public int size()                                { return map_.size(); }
    public Collection<V> values()                    { return map_.values(); }
} 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2011-08-23T18:52:42.207

这种方法只是为了达到目的。（“挫折”是 Values**必须实现 java.util.Comparable 接口**）

```
 /**

 * Sort a map according to values.

 * @param <K> the key of the map.
 * @param <V> the value to sort according to.
 * @param mapToSort the map to sort.

 * @return a map sorted on the values.

 */ 
public static <K, V extends Comparable< ? super V>> Map<K, V>
sortMapByValues(final Map <K, V> mapToSort)
{
    List<Map.Entry<K, V>> entries =
        new ArrayList<Map.Entry<K, V>>(mapToSort.size());  

    entries.addAll(mapToSort.entrySet());

    Collections.sort(entries,
                     new Comparator<Map.Entry<K, V>>()
    {
        @Override
        public int compare(
               final Map.Entry<K, V> entry1,
               final Map.Entry<K, V> entry2)
        {
            return entry1.getValue().compareTo(entry2.getValue());
        }
    });      

    Map<K, V> sortedMap = new LinkedHashMap<K, V>();      

    for (Map.Entry<K, V> entry : entries)
    {
        sortedMap.put(entry.getKey(), entry.getValue());

    }      

    return sortedMap;

} 
```

[http://javawithswranga.blogspot.com/2011/06/generic-method-to-sort-hashmap.html](http://javawithswaranga.blogspot.com/2011/06/generic-method-to-sort-hashmap.html)

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2018-10-07T13:13:25.873

**最简单**的暴力破解`sortHashMap`方法`HashMap<String, Long>`：你可以**复制粘贴它并**像这样使用：

```
public class Test  {
    public static void main(String[] args)  {
        HashMap<String, Long> hashMap = new HashMap<>();
        hashMap.put("Cat", (long) 4);
        hashMap.put("Human", (long) 2);
        hashMap.put("Dog", (long) 4);
        hashMap.put("Fish", (long) 0);
        hashMap.put("Tree", (long) 1);
        hashMap.put("Three-legged-human", (long) 3);
        hashMap.put("Monkey", (long) 2);

        System.out.println(hashMap);  //{Human=2, Cat=4, Three-legged-human=3, Monkey=2, Fish=0, Tree=1, Dog=4}
        System.out.println(sortHashMap(hashMap));  //{Cat=4, Dog=4, Three-legged-human=3, Human=2, Monkey=2, Tree=1, Fish=0}
    }

    public LinkedHashMap<String, Long> sortHashMap(HashMap<String, Long> unsortedMap)  {
        LinkedHashMap<String, Long> result = new LinkedHashMap<>();

        //add String keys to an array: the array would get sorted, based on those keys' values
        ArrayList<String> sortedKeys = new ArrayList<>();
        for (String key: unsortedMap.keySet())  {
            sortedKeys.add(key);
        }

        //sort the ArrayList<String> of keys    
        for (int i=0; i<unsortedMap.size(); i++)  {
            for (int j=1; j<sortedKeys.size(); j++)  {
                if (unsortedMap.get(sortedKeys.get(j)) > unsortedMap.get(sortedKeys.get(j-1))) {
                    String temp = sortedKeys.get(j);
                    sortedKeys.set(j, sortedKeys.get(j-1));
                    sortedKeys.set(j-1, temp);
                }
            }
        }

        // construct the result Map
        for (String key: sortedKeys)  {
            result.put(key, unsortedMap.get(key));
        }

        return result;
    }
} 
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2020-02-04T11:52:17.287

这具有能够使用 Java 8 进行升序或降序排序的额外好处

```
import static java.util.Comparator.comparingInt;
import static java.util.stream.Collectors.toMap;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.stream.Collectors;
import java.util.stream.Stream;

class Utils {
    public static Map<String, Integer> sortMapBasedOnValues(Map<String, Integer> map, boolean descending) {
        int multiplyBy = (descending) ? -1: 1;
        Map<String, Integer> sorted =  map.entrySet().stream()
                .sorted(comparingInt(e -> multiplyBy * e.getValue() ))
                .collect(toMap(
                        Map.Entry::getKey, 
                        Map.Entry::getValue,
                        (a, b) -> { throw new AssertionError();},
                        LinkedHashMap::new
                    ));
        return sorted;
    }
} 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2021-12-18T07:40:31.520

```
 Map<String, Integer> map = new HashMap<>();
    map.put("b", 2);
    map.put("a", 1);
    map.put("d", 4);
    map.put("c", 3);

    // ----- Using Java 7 -------------------
    List<Map.Entry<String, Integer>> entries = new ArrayList<>(map.entrySet());
    Collections.sort(entries, (o1, o2) -> o1.getValue().compareTo(o2.getValue()));
    System.out.println(entries); // [a=1, b=2, c=3, d=4]

    // ----- Using Java 8 Stream API --------
   map.entrySet().stream().sorted(Map.Entry.comparingByValue()).forEach(System.out::println); // {a=1, b=2, c=3, d=4} 
```

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2020-03-30T14:20:37.087

```
map = your hashmap;

List<Map.Entry<String, Integer>> list = new LinkedList<Map.Entry<String, Integer>>(map.entrySet());
Collections.sort(list, new cm());//IMP

HashMap<String, Integer> sorted = new LinkedHashMap<String, Integer>();
for(Map.Entry<String, Integer> en: list){
    sorted.put(en.getKey(),en.getValue());
}

System.out.println(sorted);//sorted hashmap 
```

创建新班级

```
class cm implements Comparator<Map.Entry<String, Integer>>{
    @Override
    public int compare(Map.Entry<String, Integer> a, 
                            Map.Entry<String, Integer> b)
    {
        return (a.getValue()).compareTo(b.getValue());
    }
} 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2019-12-06T11:58:43.937

使用链表

```
//Create a list by HashMap
List<Map.Entry<String, Double>> list = new LinkedList<>(hashMap.entrySet());

//Sorting the list
Collections.sort(list, new Comparator<Map.Entry<String, Double>>() {
    public int compare(Map.Entry<String, Double> o1, Map.Entry<String, Double> o2) {
        return (o1.getValue()).compareTo(o2.getValue());
    }
});

//put data from sorted list to hashmap
HashMap<String, Double> sortedData = new LinkedHashMap<>();
for (Map.Entry<String, Double> data : list) {
    sortedData.put(data.getKey(), data.getValue());
}

System.out.print(sortedData); 
```

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2019-07-23T12:23:02.347

发布我的答案版本

```
List<Map.Entry<String, Integer>> list = new ArrayList<>(map.entrySet());
    Collections.sort(list, (obj1, obj2) -> obj2.getValue().compareTo(obj1.getValue()));
    Map<String, Integer> resultMap = new LinkedHashMap<>();
    list.forEach(arg0 -> {
        resultMap.put(arg0.getKey(), arg0.getValue());
    });
    System.out.println(resultMap); 
```

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2020-09-11T13:34:31.520

我可以给你一个例子，但肯定这是你需要的。

```
map = {10 = 3, 11 = 1,12 = 2} 
```

假设您想要前 2 个最常用的键，即 (10, 12) 所以最简单的方法是使用 PriorityQueue 根据地图的值进行排序。

```
PriorityQueue<Integer> pq = new PriorityQueue<>((a, b) -> (map.get(a) - map.get(b));
for(int key: map.keySets()) {
   pq.add(key);
   if(pq.size() > 2) {
      pq.poll();
   }
}
// Now pq has the top 2 most frequent key based on value. It sorts the value. 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2016-09-23T11:10:50.660

我的解决方案是使用大多数给定 API 的一种非常简单的方法。我们使用**Map**的特性通过**entrySet()**方法将其内容导出为**Set 。**我们现在有一个包含**Map.Entry**对象的**Set 。**

 ******好的，一个 Set 不携带订单，但我们可以将内容放入一个**ArrayList**。它现在有一个*随机*顺序，但无论如何我们都会对其进行排序。

由于**ArrayList**是一个**Collection**，我们现在使用**Collections.sort()**方法来使秩序混乱。因为我们的**Map.Entry**对象没有实现我们需要的那种比较，所以我们提供了一个自定义的**Comparator**。

```
public static void main(String[] args) {
    HashMap<String, String> map = new HashMap<>();
    map.put("Z", "E");
    map.put("G", "A");
    map.put("D", "C");
    map.put("E", null);
    map.put("O", "C");
    map.put("L", "D");
    map.put("Q", "B");
    map.put("A", "F");
    map.put(null, "X");
    MapEntryComparator mapEntryComparator = new MapEntryComparator();

    List<Entry<String,String>> entryList = new ArrayList<>(map.entrySet());
    Collections.sort(entryList, mapEntryComparator);

    for (Entry<String, String> entry : entryList) {
        System.out.println(entry.getKey() + " : " + entry.getValue());
    }

} 
```

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2019-11-12T18:24:20.587

*为每个值创建一个条目列表，其中对值进行排序*
需要 Java 8 或更高版本

```
Map<Double,List<Entry<String,Double>>> sorted =
map.entrySet().stream().collect( Collectors.groupingBy( Entry::getValue, TreeMap::new,
    Collectors.mapping( Function.identity(), Collectors.toList() ) ) ); 
```

使用地图 {[A=99.5], [B=67.4], [C=67.4], [D=67.3]}
得到`{67.3=[D=67.3], 67.4=[B=67.4, C=67.4], 99.5=[A=99.5]}`

*…以及如何一个接一个地访问每个条目：*

```
sorted.entrySet().forEach( e -> e.getValue().forEach( l -> System.out.println( l ) ) ); 
```

`D=67.3` `B=67.4` `C=67.4` `A=99.5`

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2018-08-22T16:15:06.017

我重写了 devinmoore 的方法，该方法在不使用 Iterator 的情况下按其值对地图进行排序：

```
public static Map<K, V> sortMapByValue(Map<K, V> inputMap) {

    Set<Entry<K, V>> set = inputMap.entrySet();
    List<Entry<K, V>> list = new ArrayList<Entry<K, V>>(set);

    Collections.sort(list, new Comparator<Map.Entry<K, V>>()
    {
        @Override
        public int compare(Entry<K, V> o1, Entry<K, V> o2) {
            return (o1.getValue()).compareTo( o2.getValue() );  //Ascending order
        }
    } );

    Map<K, V> sortedMap = new LinkedHashMap<>();

    for(Map.Entry<K, V> entry : list){
        sortedMap.put(entry.getKey(), entry.getValue());
    }

    return sortedMap;
} 
```

`Note:`我们用作 `LinkedHashMap`输出映射，因为我们的列表已按值排序，现在我们应该按照插入键值的顺序将列表存储到输出映射中。因此，如果您使用例如`TreeMap`作为输出地图，您的地图将再次按地图键排序！

这是主要方法：

```
public static void main(String[] args) {
    Map<String, String> map = new HashMap<>();
    map.put("3", "three");
    map.put("1", "one");
    map.put("5", "five");
    System.out.println("Input Map:" + map);
    System.out.println("Sorted Map:" + sortMapByValue(map));
} 
```

最后，这是输出：

```
Input Map:{1=one, 3=three, 5=five}
Sorted Map:{5=five, 1=one, 3=three} 
```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2018-07-21T14:56:50.300

如果偏好使用一种`Map`数据结构，该数据结构本质上按值排序，而无需触发任何排序方法或显式传递给实用程序，那么以下解决方案可能适用：

(1) [org.drools.chance.core.util.ValueSortedMap](https://github.com/kiegroup/drools-chance/blob/898c619b74ebff5ea6add8dd750c505b441e17bb/drools-chance-core/src/main/java/org/drools/chance/core/util/ValueSortedMap.java)（JBoss 项目）在内部维护两个映射，一个用于查找，一个用于维护排序值。与之前添加的答案非常相似，但可能是抽象和封装部分（包括复制机制）使其从外部使用更安全。

(2) [http://techblog.molindo.at/2008/11/java-map-sorted-by-value.html](http://techblog.molindo.at/2008/11/java-map-sorted-by-value.html)避免维护两个地图，而是依赖/扩展 Apache Common 的 LinkedMap。（博客作者注：）`as all the code here is in the public domain`：

```
// required to access LinkEntry.before and LinkEntry.after
package org.apache.commons.collections.map;

// SNIP: imports

/**
* map implementation based on LinkedMap that maintains a sorted list of
* values for iteration
*/
public class ValueSortedHashMap extends LinkedMap {
    private final boolean _asc;

    // don't use super()!
    public ValueSortedHashMap(final boolean asc) {
        super(DEFAULT_CAPACITY);
        _asc = asc;
    }

    // SNIP: some more constructors with initial capacity and the like

    protected void addEntry(final HashEntry entry, final int hashIndex) {
        final LinkEntry link = (LinkEntry) entry;
        insertSorted(link);
        data[hashIndex] = entry;
    }

    protected void updateEntry(final HashEntry entry, final Object newValue) {
        entry.setValue(newValue);
        final LinkEntry link = (LinkEntry) entry;
        link.before.after = link.after;
        link.after.before = link.before;
        link.after = link.before = null;
        insertSorted(link);
    }

    private void insertSorted(final LinkEntry link) {
        LinkEntry cur = header;
        // iterate whole list, could (should?) be replaced with quicksearch
        // start at end to optimize speed for in-order insertions
        while ((cur = cur.before) != header & amp; & amp; !insertAfter(cur, link)) {}
        link.after = cur.after;
        link.before = cur;
        cur.after.before = link;
        cur.after = link;
    }

    protected boolean insertAfter(final LinkEntry cur, final LinkEntry link) {
        if (_asc) {
            return ((Comparable) cur.getValue())
            .compareTo((V) link.getValue()) & lt; = 0;
        } else {
            return ((Comparable) cur.getValue())
            .compareTo((V) link.getValue()) & gt; = 0;
        }
    }

    public boolean isAscending() {
        return _asc;
    }
} 
```

(3) 编写一个自定义`Map`或扩展`LinkedHashMap`，仅在枚举期间根据需要进行排序（例如`values()`，、、、`keyset()`）`entryset()`。内部实现/行为是从使用此类的实现/行为中抽象出来的，但对于此类的客户来说，在请求枚举时总是对值进行排序。这个类希望如果`put`在枚举之前所有操作都已完成，排序将主要发生一次。排序方法采用了该问题的一些先前答案。

```
public class SortByValueMap<K, V> implements Map<K, V> {

    private boolean isSortingNeeded = false;

    private final Map<K, V> map = new LinkedHashMap<>();

    @Override
    public V put(K key, V value) {
        isSortingNeeded = true;
        return map.put(key, value);
    }

    @Override
    public void putAll(Map<? extends K, ? extends V> map) {
        isSortingNeeded = true;
        map.putAll(map);
    }

    @Override
    public Set<K> keySet() {
        sort();
        return map.keySet();
    }

    @Override
    public Set<Entry<K, V>> entrySet() {
        sort();
        return map.entrySet();
    }

    @Override
    public Collection<V> values() {
        sort();
        return map.values();
    }

    private void sort() {
        if (!isSortingNeeded) {
            return;
        }

        List<Entry<K, V>> list = new ArrayList<>(size());

        for (Iterator<Map.Entry<K, V>> it = map.entrySet().iterator(); it.hasNext();) {
            Map.Entry<K, V> entry = it.next();
            list.add(entry);
            it.remove();
        }

        Collections.sort(list);

        for (Entry<K, V> entry : list) {
            map.put(entry.getKey(), entry.getValue());
        }

        isSortingNeeded = false;
    }

    @Override
    public String toString() {
        sort();
        return map.toString();
    }
} 
```

(4) Guava 提供[ImmutableMap.Builder.orderEntriesByValue(Comparator valueComparator)](https://google.github.io/guava/releases/22.0/api/docs/com/google/common/collect/ImmutableMap.Builder.html#orderEntriesByValue-java.util.Comparator-)虽然结果映射是不可变的：

> 将此 Builder 配置为根据指定的比较器按值对条目进行排序。
> 
> 排序顺序是稳定的，也就是说，如果两个条目的值比较相等，则首先插入的条目将在构建映射的迭代顺序中排在第一位。

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2021-11-16T17:30:41.967

在 TreeMap 中，键按自然顺序排序。例如，如果您对数字进行排序，（请注意 的排序`4`）

`{0=0, 10=10, 20=20, 30=30, 4=4, 50=50, 60=60, 70=70}`

为了解决这个问题，在 Java8 中，首先检查字符串长度，然后进行比较。

```
Map<String, String> sortedMap = new TreeMap<>Comparator.comparingInt(String::length)
.thenComparing(Function.identity())); 
```

`{0=0, 4=4, 10=10, 20=20, 30=30, 50=50, 60=60, 70=70}`

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2019-08-27T21:32:24.817

使用番石榴库：

```
public static <K,V extends Comparable<V>>SortedMap<K,V> sortByValue(Map<K,V> original){
    var comparator = Ordering.natural()
            .reverse() // highest first
            .nullsLast()
            .onResultOf(Functions.forMap(original, null))
            .compound(Ordering.usingToString());
    return ImmutableSortedMap.copyOf(original, comparator);
} 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2018-01-02T22:35:37.273

```
public class Test {
  public static void main(String[] args) {
    TreeMap<Integer, String> hm=new TreeMap();
    hm.put(3, "arun singh");
    hm.put(5, "vinay singh");
    hm.put(1, "bandagi singh");
    hm.put(6, "vikram singh");
    hm.put(2, "panipat singh");
    hm.put(28, "jakarta singh");

    ArrayList<String> al=new ArrayList(hm.values());
    Collections.sort(al, new myComparator());

    System.out.println("//sort by values \n");
    for(String obj: al){
        for(Map.Entry<Integer, String> map2:hm.entrySet()){
            if(map2.getValue().equals(obj)){
                System.out.println(map2.getKey()+" "+map2.getValue());
            }
        } 
     }
  }
}

class myComparator implements Comparator{
    @Override
    public int compare(Object o1, Object o2) {
       String o3=(String) o1;
       String o4 =(String) o2;
       return o3.compareTo(o4);
    }   
} 
```

输出=

```
//sort by values 

3 arun singh
1 bandagi singh
28 jakarta singh
2 panipat singh
6 vikram singh
5 vinay singh 
```

* * *

## 回答 #53

> 赞同：-1
> 
> 时间：2011-02-18T13:06:29.453

```
public class SortedMapExample {

    public static void main(String[] args) {
        Map<String, String> map = new HashMap<String, String>();

        map.put("Cde", "C");
        map.put("Abc", "A");
        map.put("Cbc", "Z");
        map.put("Dbc", "D");
        map.put("Bcd", "B");
        map.put("sfd", "Bqw");
        map.put("DDD", "Bas");
        map.put("BGG", "Basd");

        System.out.println(sort(map, new Comparator<String>() {
            @Override
            public int compare(String o1, String o2) {
                    return o1.compareTo(o2);
            }}));
    }

    @SuppressWarnings("unchecked")
    public static <K, V> Map<K,V> sort(Map<K, V> in, Comparator<? super V> compare) {
        Map<K, V> result = new LinkedHashMap<K, V>();
        V[] array = (V[])in.values().toArray();
        for(int i=0;i<array.length;i++)
        {

        }
        Arrays.sort(array, compare);
        for (V item : array) {
            K key= (K) getKey(in, item);
            result.put(key, item);
        }
        return result;
    }

    public static <K, V>  Object getKey(Map<K, V> in,V value)
    {
       Set<K> key= in.keySet();
       Iterator<K> keyIterator=key.iterator();
       while (keyIterator.hasNext()) {
           K valueObject = (K) keyIterator.next();
           if(in.get(valueObject).equals(value))
           {
                   return valueObject;
           }
       }
       return null;
   } 
```

}

// 请在这里尝试。我正在修改值排序的代码。

* * *

## 回答 #54

> 赞同：-2
> 
> 时间：2008-09-21T01:37:01.873

好的，这个版本适用于两个新的 Map 对象和两个迭代和值排序。希望，尽管映射条目必须循环两次，但性能良好：

```
public static void main(String[] args) {
    Map<String, String> unsorted = new HashMap<String, String>();
    unsorted.put("Cde", "Cde_Value");
    unsorted.put("Abc", "Abc_Value");
    unsorted.put("Bcd", "Bcd_Value");

    Comparator<String> comparer = new Comparator<String>() {
        @Override
        public int compare(String o1, String o2) {
            return o1.compareTo(o2);
        }};

    System.out.println(sortByValue(unsorted, comparer));

}

public static <K, V> Map<K,V> sortByValue(Map<K, V> in, Comparator<? super V> compare) {
    Map<V, K> swapped = new TreeMap<V, K>(compare);
    for(Entry<K,V> entry: in.entrySet()) {
        if (entry.getValue() != null) {
            swapped.put(entry.getValue(), entry.getKey());
        }
    }
    LinkedHashMap<K, V> result = new LinkedHashMap<K, V>();
    for(Entry<V,K> entry: swapped.entrySet()) {
        if (entry.getValue() != null) {
            result.put(entry.getValue(), entry.getKey());
        }
    }
    return result;
} 
```

该解决方案使用带有 Comparator 的 TreeMap 并整理出所有空键和值。首先，来自 TreeMap 的排序功能用于对值进行排序，接下来，排序后的 Map 用于创建一个结果，作为保持具有相同值顺序的 LinkedHashMap。

格瑞兹，GHad

* * *

## 回答 #55

> 赞同：-2
> 
> 时间：2008-09-20T21:33:37.140

为了对键进行排序，我找到了一个更好的 TreeMap 解决方案（我也会尝试为基于值的排序准备一个解决方案）：

```
public static void main(String[] args) {
    Map<String, String> unsorted = new HashMap<String, String>();
    unsorted.put("Cde", "Cde_Value");
    unsorted.put("Abc", "Abc_Value");
    unsorted.put("Bcd", "Bcd_Value");

    Comparator<String> comparer = new Comparator<String>() {
        @Override
        public int compare(String o1, String o2) {
            return o1.compareTo(o2);
        }};

    Map<String, String> sorted = new TreeMap<String, String>(comparer);
    sorted.putAll(unsorted);
    System.out.println(sorted);
} 
```

输出将是：

{Abc=Abc_Value, Bcd=Bcd_Value, Cde=Cde_Value}

* * *

## 回答 #56

> 赞同：-2
> 
> 时间：2016-01-15T01:09:37.877

```
 static <K extends Comparable<? super K>, V extends Comparable<? super V>>
    Map sortByValueInDescendingOrder(final Map<K, V> map) {
        Map re = new TreeMap(new Comparator<K>() {
            @Override
            public int compare(K o1, K o2) {
                if (map.get(o1) == null || map.get(o2) == null) {
                    return -o1.compareTo(o2);
                }
                int result = -map.get(o1).compareTo(map.get(o2));
                if (result != 0) {
                    return result;
                }
                return -o1.compareTo(o2);
            }
        });
        re.putAll(map);
        return re;
    }
    @Test(timeout = 3000l, expected = Test.None.class)
    public void testSortByValueInDescendingOrder() {
        char[] arr = "googler".toCharArray();
        Map<Character, Integer> charToTimes = new HashMap();
        for (int i = 0; i < arr.length; i++) {
            Integer times = charToTimes.get(arr[i]);
            charToTimes.put(arr[i], times == null ? 1 : times + 1);
        }
        Map sortedByTimes = sortByValueInDescendingOrder(charToTimes);
        Assert.assertEquals(charToTimes.toString(), "{g=2, e=1, r=1, o=2, l=1}");
        Assert.assertEquals(sortedByTimes.toString(), "{o=2, g=2, r=1, l=1, e=1}");
        Assert.assertEquals(sortedByTimes.containsKey('a'), false);
        Assert.assertEquals(sortedByTimes.get('a'), null);
        Assert.assertEquals(sortedByTimes.get('g'), 2);
        Assert.assertEquals(sortedByTimes.equals(charToTimes), true);
    } 
```

* * *

## 回答 #57

> 赞同：-2
> 
> 时间：2015-12-15T17:26:17.917

如果没有任何值大于地图的大小，则可以使用数组，这应该是最快的方法：

```
public List<String> getList(Map<String, Integer> myMap) {
    String[] copyArray = new String[myMap.size()];
    for (Entry<String, Integer> entry : myMap.entrySet()) {
        copyArray[entry.getValue()] = entry.getKey();
    }
    return Arrays.asList(copyArray);
} 
```

* * *

## 回答 #58

> 赞同：-3
> 
> 时间：2012-08-29T07:33:26.030

我们只是像这样对地图进行排序

```
 Map<String, String> unsortedMap = new HashMap<String, String>();

    unsortedMap.put("E", "E Val");
    unsortedMap.put("F", "F Val");
    unsortedMap.put("H", "H Val");
    unsortedMap.put("B", "B Val");
    unsortedMap.put("C", "C Val");
    unsortedMap.put("A", "A Val");
    unsortedMap.put("G", "G Val");
    unsortedMap.put("D", "D Val");

    Map<String, String> sortedMap = new TreeMap<String, String>(unsortedMap);

    System.out.println("\nAfter sorting..");
    for (Map.Entry <String, String> mapEntry : sortedMap.entrySet()) {
        System.out.println(mapEntry.getKey() + " \t" + mapEntry.getValue()); 
```

* * *

## 回答 #59

> 赞同：-5
> 
> 时间：2017-02-20T05:37:33.093

最好的方法是将 HashMap 转换为 TreeMap。TreeMap 自行排序键。如果您想对值进行排序而不是快速修复，如果您的值不重复，您可以使用键切换值。

* * *

## 回答 #60

> 赞同：-8
> 
> 时间：2008-09-20T21:10:36.210

如果您的 Map 值实现 Comparable（例如 String），这应该可以

```
Map<Object, String> map = new HashMap<Object, String>();
// Populate the Map
List<String> mapValues = new ArrayList<String>(map.values());
Collections.sort(mapValues); 
```

如果地图值本身没有实现 Comparable，但您有一个可以对它们进行排序的 Comparable 实例，请将最后一行替换为：

```
Collections.sort(mapValues, comparable); 
```

* * *

## 回答 #61

> 赞同：-9
> 
> 时间：2013-10-24T10:13:12.380

由于地图是无序排序的，我们可以做以下

```
Map<String, String> map= new TreeMap<String, String>(unsortMap); 
```

您应该注意，与哈希映射不同，树映射保证其元素将按键升序排序。

* * *

## 回答 #62

> 赞同：-11
> 
> 时间：2008-09-20T22:47:31.250

使用**[java.util.TreeMap](http://java.sun.com/javase/6/docs/api/java/util/TreeMap.html)**。

“地图根据其键的自然顺序排序，或者由地图创建时提供的比较器排序，具体取决于使用的构造函数。”

# javascript - 您可以使用 JavaScript 进行桌面开发吗？

> ID：109399
> 
> 赞同：73
> 
> 时间：2008-09-20T21:08:18.837
> 
> 标签：javascript, windows, desktop, platform

我知道有 JScript.NET，但它与我们从网络上知道的 JavaScript 不同。

有谁知道是否有任何基于 JavaScript 的桌面开发平台/编译器？尤其是 Windows 桌面开发。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-20T21:17:40.517

有[XULRunner](http://developer.mozilla.org/en/XULRunner)，它可以让你使用 JavaScript 和 XUL 构建像 Firefox 这样的 GUI 应用程序。不过，它使用 XPCOM 对 JavaScript 进行了很多扩展。他们还提供[Prism](http://developer.mozilla.org/en/Prism)，让您可以构建离线工作的 Web 应用程序，有点像 AIR。雅虎将它用于他们的[Zimbra](http://www.zimbra.com/)电子邮件桌面客户端。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-20T21:09:54.933

是的，使用[Adob​​e AIR](http://www.adobe.com/products/air/)。Adobe AIR 允许您使用 Javascript、Flex 或 Flash 制作桌面应用程序。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2012-10-28T22:48:20.113

看起来有 3 种类型的 html5-desktop 应用程序

SDK

*   [https://qt-project.org/](https://qt-project.org/)
*   [http://awesomium.com](http://awesomium.com)
*   [http://berkelium.org](http://berkelium.org)
*   [http://www.appcelerator.com/platform](http://www.appcelerator.com/platform)

浏览器运行时

*   [http://developer.mozilla.org/en-US/docs/XULRunner](http://developer.mozilla.org/en-US/docs/XULRunner)
*   [http://developer.chrome.com/apps/about_apps.html](http://developer.chrome.com/apps/about_apps.html)

基于 Node.js

*   [http://appjs.com/](http://appjs.com/)
*   [https://github.com/maccman/bowline](https://github.com/maccman/bowline)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-12-13T17:52:46.783

Windows 8 允许使用 HTML5/JavaScript 编写 Windows 应用商店应用程序。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-08-15T05:24:08.103

“ [node-webkit](https://github.com/rogerwang/node-webkit)是一个基于 Chromium 和 node.js 的应用程序运行时。您可以使用 node-webkit 以 HTML 和 Javascript 编写本机应用程序。它还允许您直接从 DOM 调用 Node.js 模块......”

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-10-18T05:56:06.140

[Titanium Developer](http://www.appcelerator.com/)类似于 Adob ​​e AIR (html+css+javascript)，但不需要预先安装框架。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-21T12:10:14.753

您可以使用 Windows 脚本宿主使用 XML 和 javascript（和/或 VBS）制作桌面应用程序。

诀窍是使用`.hta`扩展名保存您的 XML 文件。[请参阅此参考](http://msdn.microsoft.com/en-us/library/ms536496.aspx)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-20T21:35:19.710

有[SpiderMonkey ，一个用 C 和](http://www.mozilla.org/js/spidermonkey/)[Rhino](http://www.mozilla.org/rhino/)编写的 JavaScript 引擎，一个用 Java 实现的 JavaScript。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-09-08T17:33:52.237

试试[AppJS](http://appjs.com/)，它是一个基于 NodeJS 和 Chromium Embedded Framework 的 SDK。您可以使用 Web 技术轻松构建桌面应用程序。

*   网页：[http ://appjs.com](http://appjs.com)
*   Github：[https ://github.com/appjs](https://github.com/appjs)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-20T21:26:36.500

[谷歌齿轮](http://gears.google.com)。还有 Mozilla 的[XUL](http://www.mozilla.org/projects/xul/)，但它太复杂了，恕我直言（虽然非常强大）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-09-29T12:31:06.920

谷歌正在开发一项有趣的新技术。它处于相当早期的阶段，但已经运作良好。它被称为打包应用程序，使用 Chrome 作为运行时，可在 PC 和 Mac 上运行。看看[http://developer.chrome.com/apps/about_apps.html](http://developer.chrome.com/apps/about_apps.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-05-08T07:30:11.133

我没有看到提到的另一个选项是对于 Cocoa（Mac OS X、iPhone OS）应用程序，您可以使用 Web 视图（嵌入式 WebKit）作为应用程序 UI。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-12-04T21:10:26.893

您可以尝试[JavaLikeScript](http://javalikescript.free.fr/)，它不提供与 Web 浏览器相同的本机/根对象，但它具有网络和用户界面功能。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-12-21T23:42:45.827

[Electron](http://electron.atom.io/)最初是 Atom Shell，允许应用程序以 Web 技术（HTML、JS、CSS）编写并在包括 Windows 在内的任何主要操作系统上运行。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-20T21:11:47.847

有适用于 Windows 桌面的[Yahoo 的 Konfabulator](http://widgets.yahoo.com/tools/)。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-20T21:39:32.490

Script# 具有 Vista Gadgets 的扩展。

[http://projects.nikhilk.net/ScriptSharp/](http://projects.nikhilk.net/ScriptSharp/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-05-08T07:14:31.723

这里有一些 JSOS（Javascript 操作系统），还需要一个浏览器。

[http://fractalbrain.net/](http://fractalbrain.net/) /* 最好的。*/

[http://cometdesktop.com/](http://cometdesktop.com/) /* 好的。*/

[http://skylightproject.com/](http://skylightproject.com/) /* 最差 */

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-02-27T21:27:50.453

我用上面的 node-webkit 回答了，但我最近看到了一个关于[**Tint2**](https://www.trueinteractions.com/tint2/docs/)的介绍。它似乎解决了 node-webkit 的安全问题，看起来很有希望。

# .net - ASP.NET Webforms 的主要优势是什么？

> ID：109409
> 
> 赞同：3
> 
> 时间：2008-09-20T21:10:44.417
> 
> 标签：.net, asp.net, webforms

ASP.NET Webforms (2.0-3.5) 的主要优势是什么？我不是在寻找与其他框架的比较，我只是在寻找对 ASP.NET 的反馈，就像它现在一样。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T21:16:58.693

一个关键优势（对某些人来说）是集成到 Visual Studio 中的拖放式开发环境。这使您可以快速启动和运行简单的事情，但当您真正需要了解底层代码时，这也可能是一种负担。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T21:15:46.917

我认为组件模型是关键，易于使用其他网页的部分作为组件（通过用户控件）是关键优势。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T21:16:53.420

ASP.Net 的主要优势是：

1.  编译代码 - 性能
2.  多语言开发
3.  XCopy 部署
4.  Visual Studio 设计时集成和表达式 Web
5.  许多第三方控件，包括开源的和商业的
6.  易于初学者学习

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T21:16:58.113

*   状态管理
*   入门简单的学习曲线低（但是，一旦您拥有一个包含动态添加元素的页面，就会很快变得复杂）。
*   庞大的成熟控件库
*   大量的文档和资源
*   很棒的演出

尽管其他人可能会说什么，但有可能防止事情变得一团糟。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T22:44:24.130

网络表单的好处

1.  事件驱动
2.  有状态的
3.  轻松开发可重用控件

对 Web 表单的误解

1.  它不容易测试
    *   如果您正确地构建代码，它很容易测试
2.  控件生成的 HTML 不好
    *   不再，有 CSS 友好的控制适配器

总体而言，ASP.NET 网络表单是一个很好的开发模型，人们抱怨的大多数缺点是误解或糟糕的设计/架构。最重要的功能是 Web 表单的生命周期/状态性，您可以灵活地开发非常易于使用和可重用的控件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-01T08:35:08.203

**Web 应用程序的构建速度**相对较快，但维护起来相对较难。

比较**容易学**。您不需要了解 html、css 和 javascript。但是，如果您已经了解 html、css 和 javascript，其他 Web 开发技术可能更容易学习。

如果您来自不同的技术，采用 asp.net 网络表单相对**容易**，因为它不需要严格的方法来有效，而且它支持多种语言。

这是一项比较**成熟**的技术。

向 Web 应用程序添加新功能相对**容易**，但在保持良好代码质量的同时更改现有功能相对困难。

**易于与 Windows 应用程序集成**，因为它是事件驱动的。

**许多第三方库可用。**

比较**容易处理应用程序状态**。

比较**容易部署**。

**平台独立性**（我没有这方面的经验，所以我不知道这是不是真的）

* * *

然而：

理论上它有很好的性能，但实际上它没有。编译后的代码不会带来更好的性能，因为这不是 Web 应用程序的瓶颈。瓶颈是发送到浏览器的 html 数量、执行字符串操作的速度以及查询数据库的速度。在这些方面，它是市场上最差的产品之一。

在竞争对手公司正在开发类似产品的简单应用程序或创新项目中，快速构建 Web 应用程序可能是一个优势，但在大多数情况下，应用程序的可维护性比构建时间重要得多。

使用多种语言进行开发是不利的，因为某些第三方组件只能以一种语言提供，如果您碰巧需要它，您将需要学习两种语言，而不仅仅是一种语言。C# 和 VB.Net 99% 相同，只是使用不同的词，但语法几乎相同。在团队中开发时，总会有人偏好其中一种语言，而用两种语言开发一种产品只会让事情变得混乱，因此必须选择一种语言，不同意这种选择的团队成员将以糟糕的方式开始项目士气最终会对您的项目产生不良影响。唯一真正受益于多语言支持的是微软。

与无状态系统相比，Web 表单的全状态特性是一个缺点，因为它会导致很多问题。外部网站或书签将无法直接链接到所有内容，因为某些内容只有在执行几个用户操作后才可用，因此不要直接链接到 www.example.com/a/b?c=d 网站必须链接到 www.example.com/a/b 并向用户提供一些关于如何访问引用内容的说明。大多数搜索引擎将无法找到大部分内容。在浏览器中使用后退按钮可能会导致错误。客户端的连接问题或休眠可能会导致错误。它不能利用代理，在某些情况下会导致性能不佳。代理、网关和缓存可能会导致错误。在网站更新时浏览网站会导致错误。

我同意 sontek 的观点，即如果以正确的方式构建很容易测试，但我不同意 sontek 的观点，即这是 Web 表单的优势。因为在软件架构中，您通过架构创造的每一个优势也会导致劣势。在这种情况下，它会导致构建时间的劣势，这几乎是 Web 表单的主要优势，所以如果你想要一个可测试的系统，使用 Web 表单是没有意义的，因为那样你可以更好地使用 MVC 或其他东西像那样。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T21:16:34.573

它使您无需很好地理解 HTTP 等底层概念即可构建 Web 应用程序。这有其自身的缺点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T21:16:52.077

易于使用以完成简单的事情

# .net - 读取数据网格视图

> ID：109417
> 
> 赞同：0
> 
> 时间：2008-09-20T21:13:07.047
> 
> 标签：.net, winforms, datagridview, datatable

我从数据表中填充了一个 datagridview。应用程序运行时如何从 datagridview 中读取数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T21:19:30.980

你是如何填充它的？DataSource 是否有用，例如 BindlingList？如果是这样的话：

```
BindingSource bindingSource = this.dataGridView1.DataSource as BindingSource;
//substitute your business object type for T 
T entity = bindingSource.Current as T; 
```

将使您将实体绑定到该行。

否则总会有 datagridview.Columns[n].Cells[n].Value 但我真的会考虑使用 DataSource 中的对象

编辑：啊......一个数据表......对：

```
 var table = dataGridView1.DataSource as DataTable;

 foreach(DataRow row in table.Rows)
 {
     foreach(DataColumn column in table.Columns)
     {
         Console.WriteLine(row[column]);
     }
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T21:27:00.273

您可以遍历您的 datagridview 并检索每个单元格。

```
for(int i =0; i < DataGridView.Rows.Count; i++){
  DataGridView.Rows.Columns["columnName"].Text= "";
} 
```

[这里](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=276684&SiteID=1)有一个例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T21:28:06.403

```
namespace WindowsFormsApplication2
{
    public partial class Form1 : Form
    {
        public static DataTable objDataTable = new DataTable("UpdateAddress");

        public Form1()
        {
            InitializeComponent();

        }

        private void button1_Click(object sender, EventArgs e)
        {
            Stream myStream = null;
            OpenFileDialog openFileDialog1 = new OpenFileDialog();

            openFileDialog1.InitialDirectory = "c:\\";
            openFileDialog1.Filter = "csv files (*.csv)|*.txt|All files (*.*)|*.*";
            openFileDialog1.FilterIndex = 2;
            openFileDialog1.RestoreDirectory = true;

            if (openFileDialog1.ShowDialog() == DialogResult.OK)
            {
                try
                {
                    if ((myStream = openFileDialog1.OpenFile()) != null)
                    {
                        string fileName = openFileDialog1.FileName;

                        List<string> dataFile = new List<string>();
                        dataFile = ReadList(fileName);
                        foreach (string item in dataFile)
                        {
                            string[] temp = item.Split(',');
                            DataRow objDR = objDataTable.NewRow();
                            objDR["EmployeeID"] = temp[0].ToString();
                            objDR["Street"] = temp[1].ToString();
                            objDR["POBox"] = temp[2].ToString();
                            objDR["City"] = temp[3].ToString();
                            objDR["State"] = temp[4].ToString();
                            objDR["Zip"] = temp[5].ToString();
                            objDR["Country"] = temp[6].ToString();
                            objDataTable.Rows.Add(objDR);

                        }
                    }
                }
                catch (Exception ex)
                {
                    MessageBox.Show("Error: Could not read file from disk. Original error: " + ex.Message);
                }
            }
        }

        public static List<string> ReadList(string filename)
        {
            List<string> fileData = new List<string>();
            StreamReader sr = new StreamReader(filename);
            while (!sr.EndOfStream)
                fileData.Add(sr.ReadLine());
            return fileData;
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            objDataTable.Columns.Add("EmployeeID", typeof(int));
            objDataTable.Columns.Add("Street", typeof(string));
            objDataTable.Columns.Add("POBox", typeof(string));
            objDataTable.Columns.Add("City", typeof(string));
            objDataTable.Columns.Add("State", typeof(string));
            objDataTable.Columns.Add("Zip", typeof(string));
            objDataTable.Columns.Add("Country", typeof(string));
            objDataTable.Columns.Add("Status", typeof(string));

            dataGridView1.DataSource = objDataTable;
            dataGridView1.Refresh();
        }

        private void button2_Click(object sender, EventArgs e)
        {
            // Displays a SaveFileDialog so the user can save the backup of AD address before the update
            // assigned to Button2.
            SaveFileDialog saveFileDialog1 = new SaveFileDialog();
            saveFileDialog1.Filter = "BAK Files|*.BAK";
            saveFileDialog1.Title = "Save AD Backup";
            saveFileDialog1.ShowDialog();

            if (saveFileDialog1.FileName != "")
            {
                TextWriter fileOut = new StreamWriter(saveFileDialog1.FileName); 
                //This is where I want read from the datagridview the EmployeeID column and use it in my BackupAddress method.
            }

        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T00:29:49.837

您可能想看看[DataTable.WriteXml](http://msdn.microsoft.com/en-us/library/system.data.datatable.writexml.aspx)，它是[DataTable.ReadXml](http://msdn.microsoft.com/en-us/library/system.data.datatable.readxml.aspx)的兄弟。无需大惊小怪，无需大惊小怪地保存 DataTable。

# iphone - 非程序员学习 iPhone 应用程序创建基础知识的最简单方法是什么？

> ID：109429
> 
> 赞同：4
> 
> 时间：2008-09-20T21:15:50.940
> 
> 标签：iphone, objective-c

我主要是一名设计师，对 CSS 和 HTML 有相当高的理解。我有一个非常简单的 iPhone 应用程序的想法，主要涉及计时器、动画图形和一些声音。如果我变得更高级，可能会有一些简单的自定义设置

我对Objective C或任何类型的C都不了解。（我得到的最接近的是 20 年前的 Pascal 课程。）除了与有动力帮助我的开发人员交朋友之外，学习创建自己的 iPhone 应用程序所需的最低知识的最简单、最有可能的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T21:52:14.223

如果您没有编程经验，那么创建原生 iPhone 应用程序将是一项艰巨的任务。为 iPhone 开发就像为桌面 mac 开发一样，是一个非常完整和成熟的系统。

老实说，坚持为 iPhone 做一个网络应用程序。Mobile Safari 提供了一些特殊的钩子，可以让您比“常规”网络应用程序更“接近”系统。有时这已经足够了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T22:15:42.013

如果你真的很认真并且愿意花一些时间来真正学习用 Cocoa 编程，我会这样做的方式是结合阅读 Apple 提供的所有东西以及几本好书供参考和更多概念性的大图/进入可可心态的东西。

如果您只是想尝试一起破解一些可行的东西，那么当您遇到困难时，您可能会最好结合使用 Apple 的示例代码和各种论坛上的大量问题。

我推荐的书[是 Stephen Kochan 的 Programming in Objective-C](https://rads.stackoverflow.com/amzn/click/com/0672325861 "Objective-C 编程，Stephen Kochan")和[Aaron Hillegass 的 Cocoa Programming for Mac OS](https://rads.stackoverflow.com/amzn/click/com/0321503619 "Mac OS X 的 Cocoa 编程，作者 Aaron Hillegass") X。前者很好地介绍了 Objective-C 语言本身，后者几乎*是*Cocoa 的书。这不是 iPhone 特定的书，但其中的几乎所有内容（尤其是概念和设计模式）仍然适用。请记住，您将无法访问 iPhone 上的垃圾收集器。您还应该确保通读 Apple 自己的[Introduction to The Objective-C 2.0 Programming Language](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Introduction/chapter_1_section_1.html "Objective-C 2.0 编程语言简介")。

要查看并适应您自己的需求的实际代码，很难找到比 Apple 自己的 iPhone 示例代码库更好的东西。

您也可以尝试[这](http://forums.macrumors.com/forumdisplay.php?f=135 "这些") [两个](http://www.iphonedevsdk.com/forum/iphone-sdk-development/ "二")论坛来解决您可能遇到的任何 SDK 问题，当然还有 Stack Overflow 来了解不属于 NDA 的更一般的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T22:19:17.857

参加[iNVASIVECODE](https://www.invasivecode.com/ios-training-swift.html)或[Big Nerd Ranch](https://training.bignerdranch.com/classes/beginning-ios-iphone-ipad-with-swift)的课程。

还有斯坦福 CS193 iOS 课程，非常好。每学期更新[CS193p](http://web.stanford.edu/class/cs193p/cgi-bin/drupal/)

/* 2015 年 4 月更新的链接 */

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T21:19:16.410

[http://developer.apple.com/iphone/](http://developer.apple.com/iphone/)

他们有一些非常基本的应用程序和一些不错的文章。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-21T17:43:33.720

Manning Publication 正在编写一本名为[iPhone in Action](http://www.manning.com/callen/)的书，该书将解决基于 Web 和原生 iPhone 应用程序的编码问题。它定于 1 月 9 日发布，但取决于 Apple 将 NDA 保持多长时间，可能需要更长时间......</p>

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T21:20:42.897

加入[iPhone 开发计划](http://developer.apple.com/iphone/)并阅读他们的代码示例（它们很简单）以及他们的指南（非常有帮助）。我不知道别的办法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-11T05:47:25.730

最简单的方法是使用为非程序员创建的基于 Web 的服务。找到一个可以让您灵活地创建自定义应用程序，而不仅仅是看起来相似的模板。查看[http://www.Snappii.com](http://www.Snappii.com)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-29T00:53:36.920

如果您已经了解 HTML 和 CSS，那么您可能需要重新学习 JavaScript 并使用[Kendo UI Mobile](http://www.kendoui.com/mobile.aspx)或[jQuery Mobile](http://jquerymobile.com/)之类的东西。您基本上可以制作一个可以在 iPhone 和 Android 设备上运行的 HTML5 单页应用程序。与其从头开始，不如发挥自己的长处！除非你真的想学习objective-c，在这种情况下，请忽略这个答案:)

# unit-testing - 在单元测试方面什么不能测试？

> ID：109432
> 
> 赞同：33
> 
> 时间：2008-09-20T21:16:48.660
> 
> 标签：unit-testing, language-agnostic, tdd, testing-strategies

在项目的哪些部分编写单元测试几乎或实际上是不可能的？数据访问？FTP？

如果这个问题有答案，那么 %100 覆盖率就是一个神话，不是吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-21T06:36:10.377

[在这里](http://www.artima.com/weblogs/viewpost.jsp?thread=126923)，我发现（通过[hacked](http://haacked.com/archive/2008/07/22/unit-test-boundaries.aspx) Michael Feathers 所说的可以作为答案的内容：

他说，

> 如果满足以下条件，则测试不是单元测试：
> 
> > *   它与数据库对话
> > *   它通过网络进行通信
> > *   它涉及文件系统
> > *   它不能与您的任何其他单元测试同时运行
> > *   你必须对你的环境做一些特殊的事情（比如编辑配置文件）来运行它。

在同一篇文章中，他再次补充道：

> 通常，单元测试应该很小，它们测试一个方法或几个方法的交互。当您将数据库、套接字或文件系统访问拉入您的单元测试时，它们不再是真正关于这些方法的；它们是关于您的代码与其他软件的集成。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T21:24:17.300

100% 的覆盖率是一个神话，这并不意味着 80% 的覆盖率是无用的。当然，目标是 100%，在单元测试和集成测试之间，你可以接近它。

在单元测试中不可能预测您的客户会对产品做的所有完全*奇怪的事情。*一旦您开始发现代码的这些令人难以置信的变态，请确保将针对它们的测试回滚到测试套件中。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-20T21:25:16.690

实现 100% 的代码覆盖率几乎总是浪费。这方面有很多资源。

没有什么是不可能进行单元测试的，但收益总是递减的。对单元测试很痛苦的东西进行单元测试可能不值得。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-21T05:05:29.737

目标不是 100% 的代码覆盖率，也不是 80% 的代码覆盖率。易于编写的单元测试并不意味着您应该编写它，而难以编写的单元测试并不意味着您应该避免努力。

任何测试的目标都是以最实惠的方式检测用户可见的问题。

编写、维护和诊断测试标记的问题（包括误报）的总成本是否值得特定测试捕获的问题？

如果测试捕获的问题是“昂贵的”，那么您可以付出努力找出如何测试它并维护该测试。如果测试捕获的问题是微不足道的，那么编写（和维护！）测试（即使存在代码更改）最好是微不足道的。

单元测试的核心目标是保护开发人员免受实施错误的影响。仅此一项就应该表明，过多的努力将是一种浪费。在某一点之后，有更好的策略来获得正确的实施。同样，在某个点之后，用户可见的问题是由于正确实施了错误的东西，只能通过用户级别或集成测试来捕捉。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-20T21:44:16.207

你不会测试什么？任何不可能破坏的东西。

当涉及到代码覆盖率时，您希望 100% 覆盖您实际编写的代码——也就是说，您无需测试第三方库代码或操作系统代码，因为这些代码已经交付给您测试过。除非不是。在这种情况下，您可能需要对其进行测试。或者，如果存在已知的错误，在这种情况下，您可能想要测试错误是否存在，以便您收到有关何时修复错误的通知。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-20T21:18:38.953

数据访问是可能的，因为您可以设置一个测试数据库。

通常，“不可测试”的东西是 FTP、电子邮件等。但是，它们通常是您可以依赖的框架类，因此如果您将它们隐藏在抽象后面，则无需进行测试。

此外，仅 100% 的代码覆盖率是不够的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-21T00:08:59.777

GUI 的单元测试也很困难，尽管我猜这并非不可能。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-20T21:27:49.273

@GarryShutler

我实际上使用假的 smtp 服务器 (Wiser) 对电子邮件进行了单元测试。确保您的应用程序代码正确：

[http://maas-frensch.com/peter/2007/08/29/unittesting-e-mail-sending-using-spring/](http://maas-frensch.com/peter/2007/08/29/unittesting-e-mail-sending-using-spring/)

类似的事情可能会为其他服务器做。否则你应该能够模拟 API ......

顺便说一句：100% 的覆盖率只是一个开始……只是意味着所有代码实际上都执行了*一次*bean ……没有关于边缘情况等。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-20T21:49:43.870

大多数需要大量且昂贵（资源或计算时间成本）设置的测试是集成测试。单元测试应该（理论上）只测试代码的小单元。个别功能。

例如，如果您正在测试电子邮件功能，那么创建一个模拟邮件程序是有意义的。该模拟的目的是确保您的代码正确调用邮件程序。查看您的应用程序是否真的发送邮件是一个集成测试。

区分单元测试和集成测试非常有用。单元测试应该运行得非常快。在签入代码之前，应该可以轻松运行所有单元测试。

但是，如果您的测试套件包含许多集成测试（设置和拆除数据库等），您的测试运行很容易超过半小时。在这种情况下，开发人员很可能不会在签入之前运行所有单元测试。

所以回答你的问题：做网络单元测试的东西，更好地实现为集成测试（也不要测试getter/setter - 这是浪费时间;-)）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-21T00:10:36.870

在单元测试中，你不应该测试任何不属于你的单元的东西；在他们的上下文中测试单元是另一回事。这就是简单的答案。

我使用的基本规则是，你应该对任何触及你的单元边界的东西（通常是班级，或者你的单元可能是什么）进行单元测试，并模拟其余的。无需测试某些数据库查询返回的结果，只需测试您的单元是否发出正确的查询即可。

这并不意味着你不应该忽略那些难以测试的东西。甚至可以使用正确的工具很好地测试异常处理和并发问题。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-21T03:43:11.650

“在单元测试方面有什么不能测试的？” * 只有 getter 和 setter 的 Bean。推理：通常是浪费时间，最好花在测试其他东西上。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-29T10:48:51.887

Anything that is not completely deterministic is a no-no for unit testing. You want your unit tests to ALWAYS pass or fail with the same initial conditions - if weirdness like threading, or random data generation, or time/dates, or external services can affect this, then you shouldn't be covering it in your unit tests. Time/dates are a particularly nasty case. You can usually architect code to have a date to work with be injected (by code and tests) rather than relying on functionality at the current date and time.

That said though, unit tests shouldn't be the only level of testing in your application. Achieving 100% unit test coverage is often a waste of time, and quickly meets diminishing returns.

更好的是拥有一组更高级别的功能测试，甚至是集成测试，以确保系统*“一旦全部连接起来”就*可以正常工作- 根据定义，单元测试**不会**测试。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-20T21:24:36.287

任何需要非常大而复杂的设置的东西。当然你可以测试 ftp（客户端），但是你需要设置一个 ftp 服务器。对于单元测试，您需要一个可重现的测试设置。如果你不能提供它，你就不能测试它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-20T22:04:23.507

您可以测试它们，但它们不会是单元测试。单元测试是不跨越边界的东西，例如跨越线路、访问数据库、运行/与第三方交互、接触未经测试/遗留代码库等。

除此之外的任何事情都是集成测试。

标题中问题的明显答案是你不应该对你的 API 内部进行单元测试，你不应该依赖别人的行为，你不应该测试任何你不负责的东西。

其余的应该足以让您能够在其中编写代码，不多也不少。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-20T22:31:22.727

在处理大型项目时，肯定 100% 的覆盖率是一个很好的**目标**，但对于大多数项目而言，在部署之前修复一两个错误并不一定值得花时间创建详尽的单元测试。

在非常详细的级别上对表单提交、数据库访问、FTP 访问等进行详尽的测试通常只是浪费时间；除非正在编写的软件需要非常高水平的可靠性（99.999% 的东西），否则过多的单元测试可能是过度杀伤和实时接收器。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-21T06:50:04.757

我不同意 quamrana 关于不测试第三方代码的回应。这是单元测试的理想用途。如果在新版本的库中引入了错误怎么办？理想情况下，当发布新版本的第三方库时，您运行代表该库预期行为的单元测试，以验证它是否仍按预期工作。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-20T19:18:45.627

配置是另一个在单元测试中很难很好测试的项目。集成测试和其他测试应该针对配置进行。这减少了测试的冗余并节省了大量时间。尝试对配置进行单元测试通常是轻率的。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-11-07T23:02:26.910

FTP、SMTP、I/O 通常应使用接口进行测试。该接口应该由一个适配器（用于真实代码）和一个用于单元测试的模拟来实现。

没有单元测试应该使用真正的外部资源（FTP 服务器等）

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-20T21:24:05.010

如果用于设置单元测试所需状态的代码变得比要测试的代码复杂得多，我倾向于划清界限，并找到另一种方法来测试功能。那时你必须问你怎么知道单元测试是正确的！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-20T21:29:00.893

FTP、电子邮件等您可以使用服务器仿真进行测试。这很困难，但可能。

不可测试的是一些错误处理。在每个代码中都有永远不会发生的错误处理。例如，在 Java 中必须捕获许多异常，因为它是接口的一部分。但是使用过的实例永远不会抛出它。或者，如果所有可能的情况下都存在 case 块，则使用 switch 的默认情况。

当然，可以删除一些不需要的错误处理。但是将来是否存在编码错误，那么这很糟糕。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-20T21:51:37.003

首先对代码进行单元测试的主要原因是验证代码的设计。获得 100% 的代码覆盖率是可能的，但不能不使用模拟对象或某种形式的隔离或依赖注入。

请记住，单元测试不是针对用户的，它们是针对开发人员和构建系统的，用于在发布之前验证系统。为此，单元测试应该运行得非常快，并且尽可能少的配置和依赖摩擦。尽量在内存中做尽可能多的事情，并避免使用测试中的网络连接。

# php - PHP 将双反斜杠“\\”替换为单个反斜杠“\”

> ID：109444
> 
> 赞同：4
> 
> 时间：2008-09-20T21:18:22.120
> 
> 标签：php, string, replace, backslash

好的，我正在研究这个 php 图片上传系统，但由于某种原因，Internet Explorer 将我的基本路径变成了相同的路径，但使用双反斜杠而不是一个；IE：

```
C:\\Documents and Settings\\kasper\\Bureaublad\\24.jpg 
```

这需要变成 C:\Documents and Settings\kasper\Bureaublad\24.jpg。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T22:31:09.153

请注意，您可能会遇到 PHP 的 Magic Quotes “功能”，其中传入的反斜杠变为`\\`.

见 [http://us2.php.net/magic_quotes](http://us2.php.net/magic_quotes)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T21:20:29.260

使用该[`stripslashes`](http://us.php.net/manual/en/function.stripslashes.php)功能。

这应该使它们都是单斜杠。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T21:22:02.783

您是否考虑过 stripslashes() 函数？

[http://www.php.net/stripslashes](http://www.php.net/stripslashes)

# c++ - 从 std::fstream 获取 FILE*

> ID：109449
> 
> 赞同：76
> 
> 时间：2008-09-20T21:19:16.020
> 
> 标签：c++, c, file, file-io, fstream

是否有（跨平台）方法从 C++ std::fstream 获取 C FILE* 句柄？

我问的原因是因为我的 C++ 库接受 fstreams 并且在一个特定的函数中我想使用一个接受 FILE* 的 C 库。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-09-20T21:43:45.680

最简洁的答案是不。

原因，是因为`std::fstream`不需要使用 a`FILE*`作为其实现的一部分。因此，即使您设法从对象中提取文件描述符`std::fstream`并手动构建 FILE 对象，您也会遇到其他问题，因为您现在将有两个缓冲对象写入同一个文件描述符。

真正的问题是为什么要将`std::fstream`对象转换为`FILE*`？

虽然我不推荐，但你可以试试看`funopen()`。
不幸的是，这**不是**POSIX API（它是 BSD 扩展），因此它的可移植性存在问题。这也可能是为什么我找不到任何人`std::stream`用这样的对象包裹 a 的原因。

```
FILE *funopen(
              const void *cookie,
              int    (*readfn )(void *, char *, int),
              int    (*writefn)(void *, const char *, int),
              fpos_t (*seekfn) (void *, fpos_t, int),
              int    (*closefn)(void *)
             ); 
```

这允许您构建一个`FILE`对象并指定一些将用于执行实际工作的函数。`std::fstream`如果您编写适当的函数，您可以让它们从实际打开文件的对象中读取。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-20T21:53:40.397

没有标准化的方法。我认为这是因为 C++ 标准化小组不想假设文件句柄可以表示为 fd。

大多数平台似乎确实提供了一些非标准的方式来做到这一点。

[http://www.ginac.de/~kreckel/fileno/](http://www.ginac.de/~kreckel/fileno/)提供了很好的情况记录，并提供了隐藏所有平台特定粗略的代码，至少对于 GCC 而言。考虑到这只是在 GCC 上的严重程度，我想如果可能的话，我会避免一起做这件事。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-11-03T01:48:42.827

> 更新：请参阅@Jettatura，我认为这是最好的答案[https://stackoverflow.com/a/33612982/225186](https://stackoverflow.com/a/33612982/225186)（仅限 Linux？）。

原来的：

（可能不是跨平台，但很简单）

[在http://www.ginac.de/~kreckel/fileno/](http://www.ginac.de/~kreckel/fileno/) （dvorak 答案）中简化 hack ，并查看这个 gcc 扩展[http://gcc.gnu.org/onlinedocs/gcc-4.6.2/libstdc++/ api/a00069.html#a59f78806603c619eafcd4537c920f859](http://gcc.gnu.org/onlinedocs/gcc-4.6.2/libstdc++/api/a00069.html#a59f78806603c619eafcd4537c920f859)，我有这个适用于`GCC`（至少4.8）和`clang`（至少3.3）的解决方案

```
#include<fstream>
#include<ext/stdio_filebuf.h>

typedef std::basic_ofstream<char>::__filebuf_type buffer_t;
typedef __gnu_cxx::stdio_filebuf<char>            io_buffer_t; 
FILE* cfile_impl(buffer_t* const fb){
    return (static_cast<io_buffer_t* const>(fb))->file(); //type std::__c_file
}

FILE* cfile(std::ofstream const& ofs){return cfile_impl(ofs.rdbuf());}
FILE* cfile(std::ifstream const& ifs){return cfile_impl(ifs.rdbuf());} 
```

并且可以使用这个，

```
int main(){
    std::ofstream ofs("file.txt");
    fprintf(cfile(ofs), "sample1");
    fflush(cfile(ofs)); // ofs << std::flush; doesn't help 
    ofs << "sample2\n";
} 
```

**限制：（**欢迎评论）

1.  我发现打印到`fflush`之后很重要，否则在上面的示例中，“sample2”出现在“sample1”之前。我不知道是否有比使用. 显然没有帮助。`fprintf``std::ofstream``fflush``ofs << flush`

2.  无法从中提取 FILE* `std::stringstream`，我什至不知道是否可能。（请参阅下面的更新）。

3.  我仍然不知道如何`stderr`从`std::cerr`等中提取 C，例如`fprintf(stderr, "sample")`在这样的假设代码中使用 in `fprintf(cfile(std::cerr), "sample")`。

关于最后一个限制，我发现的唯一解决方法是添加这些重载：

```
FILE* cfile(std::ostream const& os){
    if(std::ofstream const* ofsP = dynamic_cast<std::ofstream const*>(&os)) return cfile(*ofsP);
    if(&os == &std::cerr) return stderr;
    if(&os == &std::cout) return stdout;
    if(&os == &std::clog) return stderr;
    if(dynamic_cast<std::ostringstream const*>(&os) != 0){
       throw std::runtime_error("don't know cannot extract FILE pointer from std::ostringstream");
    }
    return 0; // stream not recognized
}
FILE* cfile(std::istream const& is){
    if(std::ifstream const* ifsP = dynamic_cast<std::ifstream const*>(&is)) return cfile(*ifsP);
    if(&is == &std::cin) return stdin;
    if(dynamic_cast<std::ostringstream const*>(&is) != 0){
        throw std::runtime_error("don't know how to extract FILE pointer from std::istringstream");
    }
    return 0; // stream not recognized
} 
```

**尝试处理`iostringstream`**

可以使用`fscanf`from `istream`using进行读取`fmemopen`，但如果想要结合 C-reads 和 C++-reads，则需要在每次读取后大量保存和更新流的输入位置。我无法将其转换为上述`cfile`函数。（也许每次阅读后都会不断更新的`cfile` *课程*是要走的路）。

```
// hack to access the protected member of istreambuf that know the current position
char* access_gptr(std::basic_streambuf<char, std::char_traits<char>>& bs){
    struct access_class : std::basic_streambuf<char, std::char_traits<char>>{
        char* access_gptr() const{return this->gptr();}
    };
    return ((access_class*)(&bs))->access_gptr();
}

int main(){
    std::istringstream iss("11 22 33");
    // read the C++ way
    int j1; iss >> j1;
    std::cout << j1 << std::endl;

    // read the C way
    float j2;

    char* buf = access_gptr(*iss.rdbuf()); // get current position
    size_t buf_size = iss.rdbuf()->in_avail(); // get remaining characters
    FILE* file = fmemopen(buf, buf_size, "r"); // open buffer memory as FILE*
    fscanf(file, "%f", &j2); // finally!
    iss.rdbuf()->pubseekoff(ftell(file), iss.cur, iss.in); // update input stream position from current FILE position.

    std::cout << "j2 = " << j2 << std::endl;

    // read again the C++ way
    int j3; iss >> j3;
    std::cout << "j3 = " << j3 << std::endl;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-20T21:26:56.953

好吧，你可以得到文件描述符——我忘记了方法是fd()还是getfd()。 *我使用的实现提供了这样的方法，但我相信语言标准不需要它们 - 标准不应该关心您的平台是否使用 fd 文件。*

由此，您可以使用 fdopen(fd, mode) 来获取 FILE*。

但是，我认为标准所需的同步 STDIN/cin、STDOUT/cout 和 STDERR/cerr 的机制不必对您可见。因此，如果您同时使用 fstream 和 FILE*，缓冲可能会搞砸。

此外，如果 fstream 或 FILE 关闭，它们可能会关闭底层 fd，因此您需要确保在关闭任何一个之前都刷新两者。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-11-04T23:03:02.797

在单线程 POSIX 应用程序中，您可以轻松地以可移植方式获取 fd 编号：

```
int fd = dup(0);
close(fd);
// POSIX requires the next opened file descriptor to be fd.
std::fstream file(...);
// now fd has been opened again and is owned by file 
```

如果此代码与打开文件描述符的其他线程竞争，则此方法会在多线程应用程序中中断。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-11-09T15:52:59.660

在 Linux 中执行此操作的另一种方法：

```
#include <stdio.h>
#include <cassert>

template<class STREAM>
struct STDIOAdapter
{
    static FILE* yield(STREAM* stream)
    {
        assert(stream != NULL);

        static cookie_io_functions_t Cookies =
        {
            .read  = NULL,
            .write = cookieWrite,
            .seek  = NULL,
            .close = cookieClose
        };

        return fopencookie(stream, "w", Cookies);
    }

    ssize_t static cookieWrite(void* cookie,
        const char* buf,
        size_t size)
    {
        if(cookie == NULL)
            return -1;

        STREAM* writer = static_cast <STREAM*>(cookie);

        writer->write(buf, size);

        return size;
    }

    int static cookieClose(void* cookie)
    {
         return EOF;
    }
}; // STDIOAdapter 
```

用法，例如：

```
#include <boost/iostreams/filtering_stream.hpp>
#include <boost/iostreams/filter/bzip2.hpp>
#include <boost/iostreams/device/file.hpp>

using namespace boost::iostreams;

int main()
{   
    filtering_ostream out;
    out.push(boost::iostreams::bzip2_compressor());
    out.push(file_sink("my_file.txt"));

    FILE* fp = STDIOAdapter<filtering_ostream>::yield(&out);
    assert(fp > 0);

    fputs("Was up, Man", fp);

    fflush (fp);

    fclose(fp);

    return 1;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-06-15T21:46:27.250

有一种方法可以从中获取文件描述符`fstream`，然后将其转换为`FILE*`（通过`fdopen`）。就我个人而言，我没有看到任何需要`FILE*`，但使用文件描述符，您可以做许多有趣的事情，例如重定向 ( `dup2`)。

解决方案：

```
#define private public
#define protected public
#include <fstream>
#undef private
#undef protected

std::ifstream file("some file");
auto fno = file._M_filebuf._M_file.fd(); 
```

最后一个字符串适用于 libstdc++。如果您使用的是其他库，则需要对其进行一些逆向工程。

这个技巧很脏，会暴露 fstream 的所有私有和公共成员。如果您想在您的生产代码中使用它，我建议您创建单独的`.cpp`和`.h`单一的功能`int getFdFromFstream(std::basic_ios<char>& fstr);`。头文件不能包含 fstream。

# .net - Reporting Services 折线图：如何更好地控制平滑曲线

> ID：109464
> 
> 赞同：0
> 
> 时间：2008-09-20T21:22:31.220
> 
> 标签：.net, graphics, reporting-services, charts, splines

我有一个为客户构建的报告，我需要在其中绘制 x 0-100，y 0-100。假设我有以下几点：

```
 0,  0
  2,  24
 50,  70
100, 100 
```

我需要将这些表示为平滑折线图，因为它的应用是印刷机的网点增益图。

这就是问题所在。这条线从 100,100（右上）到 2,24 都很好。但随后发生的情况是从 2,24 到 0,0，线从图形左侧弯曲，然后向下弯曲到 0,0。想象一下它把一个点放在-10,10。

我知道这是因为它使用的通用[贝塞尔曲线](http://en.wikipedia.org/wiki/B%C3%A9zier_curve)算法和控制点的大分离，因此对其进行了很大的加权。

但是我想知道是否有人知道我可以控制它的方法。我已经尝试在现有控制点之间添加平均点，但它仍然曲线偏离图表，就好像它仍然很重。

我能想到的唯一其他答案是自定义绘制图表或查看[Dundas Charts](https://en.wikipedia.org/wiki/Dundas_Data_Visualization#History)并使用其[GDI+](https://en.wikipedia.org/wiki/Graphics_Device_Interface#Windows_XP)绘图支持。

但在我走那条路之前，有人有什么想法吗？

* * *

事情就是这样。我知道如何手动绘制曲线。问题在于 2 到 50 之间的权重如此之高。我尝试在低点和中点添加点，但它仍然在边缘弯曲。我将不得不去查看源代码并修改图表，看看我是否可以获取屏幕截图。

现在我只是让图表在 2 处停止，直到我能解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-20T21:50:20.313

[替代文字 http://img140.imageshack.us/img140/1279/smoothlinebezierxl0.jpg](http://img140.imageshack.us/img140/1279/smoothlinebezierxl0.jpg)

（提供行为图片以帮助您获得更好的答案）。

对于那些有理论的人，您也可以在 Excel 中进行尝试（不仅仅是 Reporting Services）。

您在问题中提到了添加点，但似乎在问题区域附近添加插值点具有预期的效果（例如 { (1,12), (1.5, 18) }）。不过，这充其量只是一个笨拙的“解决方案”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T22:40:18.617

您可以尝试对中间的点使用余弦插值。

# php - 缓存分页结果，清除更新 - 如何解决？

> ID：109480
> 
> 赞同：7
> 
> 时间：2008-09-20T21:27:25.983
> 
> 标签：php, caching, pagination, memcached

我创建了一个论坛，我们正在实施一个 apc 和 memcache 缓存解决方案来为数据库节省一些工作。

我开始使用“Categories::getAll”之类的键来实现缓存层，如果我有用户特定的数据，我会在键中附加用户 ID 之类的东西，这样你就可以得到`"User::getFavoriteThreads|1471"`. 当用户添加新的收藏线程时，我会删除缓存键，然后它会重新创建条目。

**然而，问题来了：**

我想缓存论坛中的线程。很简单，“Forum::getThreads|$iForumId”。但是......使用分页，我必须将它分成几个缓存条目，例如

```
"Forum::getThreads|$iForumId|$iLimit|$iOffset". 
```

没关系，直到有人在论坛上发布新帖子。`"Forum::getThreads|$iForumId"`无论限制和偏移量是多少，我现在都必须删除 下的所有键。

解决这个问题的好方法是什么？我真的不想遍历所有可能的限制和偏移，直到找到不再匹配的东西。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T07:46:45.050

只是一个更新：我认为 Josh 关于数据使用的观点非常好。人们不太可能继续查看论坛的第 50 页。

基于这个模型，我决定在每个论坛缓存 90 个最新的帖子。在获取函数中，我检查限制和偏移量以查看指定的线程片是否在缓存内。如果它在缓存限制内，我使用 array_slice() 检索正​​确的部分并返回它。

这样，我可以在每个论坛中使用一个缓存键，并且清除/更新缓存只需很少的努力 :-)

我还想指出，在其他资源较多的查询中，我使用了 flungabunga 的模型，存储键之间的关系。不幸的是，堆栈溢出不会让我接受两个答案。

谢谢！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T23:19:13.860

我设法通过`memcache`使用自定义类（例如 ExtendedMemcache）扩展该类来解决这个问题，该类具有受保护的属性，该属性将包含组到键值的哈希表。

该`ExtendedMemcache->set`方法接受 3 个 args ( `$strGroup`, `$strKey`, ) 当您调用 set 时，它会将, 和,`$strValue`之间的关系存储在受保护的属性中，然后继续将to关系存储在.`$strGroup``$strKey``$strKey``$strValue``memcache`

然后，您可以向`ExtendedMemcache`名为“deleteGroup”的类添加一个新方法，该方法将在传递一个字符串时找到与该组关联的键，并依次清除每个键。

应该是这样的：http: [//pastebin.com/f566e913b](http://pastebin.com/f566e913b) 我希望这一切都有意义并且对你有用。

PS。我想如果你想使用静态调用，受保护的属性可以保存在`memcache`它自己的密钥下。只是一个想法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-21T03:31:12.083

您可能还想查看存储缓存数据的成本，根据您的工作量和 CPU 成本，以及缓存将如何购买您。

如果您发现 80% 的论坛浏览量都在查看主题的第一页，那么您可以决定只缓存该页面。这意味着缓存读取和写入都更容易实现。

用户最喜欢的线程列表也是如此。如果这是每个人很少访问的东西，那么缓存可能不会太多地提高性能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T21:48:46.963

您实际上是在尝试缓存视图，这总是会变得棘手。相反，您应该尝试仅缓存数据，因为数据很少更改。不要缓存论坛，缓存线程行。然后您的 db 调用应该只返回一个 id 列表，该列表已经在您的缓存中。db 调用将在任何 MyISAM 表上快速减轻，然后您不必进行大连接，这会占用 db 内存。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T21:49:05.213

一种可能的解决方案是不对论坛中的线程缓存进行分页，而是将线程信息放入`Forum::getThreads|$iForumId`. 然后在您的 PHP 代码中，只为该给定页面提取您想要的那些，例如

```
$page = 2;
$threads_per_page = 25;
$start_thread = $page * $threads_per_page;

// Pull threads from cache (assuming $cache class for memcache interface..)
$threads = $cache->get("Forum::getThreads|$iForumId");

// Only take the ones we need
for($i=$start_thread; $i<=$start_thread+$threads_per_page; $i++)
{
    // Thread display logic here...
    showThread($threads[$i]);
} 
```

这意味着您确实需要做更多的工作来在每个页面上将它们拉出，但现在只需要担心在更新/添加新线程时会使缓存在一个地方失效。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T23:47:57.643

flungabunga：您的解决方案与我正在寻找的非常接近。唯一阻止我这样做的是必须在每次请求后将关系存储在 memcache 中并将它们加载回来。

我不确定这意味着多少性能影响，但它似乎有点低效。我会做一些测试，看看结果如何。感谢您提供结构化的建议（以及一些显示代码，谢谢！）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-21T11:07:35.823

在没有确凿的事实来衡量的情况下，在进行这种优化时要非常小心。

大多数数据库都有多个级别的缓存。如果这些调整正确，数据库在缓存方面可能会比你自己做的更好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T05:41:52.720

对飞龙草的回应：

实现分组的另一种方法是将组名加上序列号放入键本身，并增加序列号以“清除”组。您将每个组的当前有效序列号存储在其自己的密钥中。

例如

```
get seqno_mygroup
23

get mygroup23_mykey
<mykeydata...>
get mygroup23_mykey2
<mykey2data...> 
```

然后简单地“删除”该组：

```
incr seqno_mygroup 
```

瞧：

```
get seqno_mygroup
24

get mygroup24_mykey
...empty 
```

ETC..

# html - 在 html 中显示表单时使用表格标签是不好的设计吗？

> ID：109488
> 
> 赞同：22
> 
> 时间：2008-09-20T21:30:04.650
> 
> 标签：html, css, forms, layout

我一直听说`div`标签应该用于布局目的而不是`table`标签。那么这也适用于表单布局吗？我知道表单布局仍然是布局，但似乎使用`div`s 创建表单布局需要更多`html`和`css`. 那么考虑到这一点，表单布局应该使用`div`标签吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-20T21:41:21.160

是的，它确实适用于表单布局。请记住，还有专门用于向表单添加结构的标签，如 FIELDSET 和 LABEL，因此这并不是只使用 DIV 的问题。您应该能够使用非常少的 HTML 来标记表单，并让 CSS 完成其余的工作。例如：

```
<fieldset>
    <div>
         <label for="nameTextBox">Name:</label>
         <input id="nameTextBox" type="text" />
    </div>
    ...
</fieldset> 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T21:50:21.717

我认为表单“难以”以良好的 HTML 和 CSS 很好地布局是一个神话。CSS 为您提供的布局控制级别远远超出了任何笨拙的基于表格的布局。这不是一个新想法，正如2006 年[Smashing Magazine 的这篇文章](http://www.smashingmagazine.com/2006/11/11/css-based-forms-modern-solutions/)所示。

我倾向于在我的表单中使用以下标记的变体。我的 CSS 中有一个通用的 .form 样式，然后是文本输入、复选框、选择、文本区域等的变体。

```
.field label {
  float: left;
  width: 20%;
}

.field.text input {
  width: 75%;
  margin-left: 2%;
  padding: 3px;
}
```

```
<div class="field text">
  <label for="fieldName">Field Title</label>
  <input value="input value" type="text" name="fieldName" id="fieldName" />
</div>
```

桌子并不邪恶。当需要显示表格数据时，它们是迄今为止最好的选择。表单恕我直言，它们不是表格数据——它们是表单，CSS 提供了足够多的工具来根据您的喜好布局表单。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-20T21:40:32.940

如果您只需要一个简单的行列夹式布局，您不应该对使用表格感到内疚。我不知道任何人怎么能仅仅因为它不是 CSS 就称它为“糟糕的设计”。我见过**很多**糟糕的基于 CSS 的设计。我喜欢 CSS，并且认为它在许多方面都优于传统的嵌套表格布局，但要做最有效、最容易维护的事情，并做出更重要、更有影响力的决策。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T21:41:55.807

一般原则是您希望使用最能传达您想要的语义内容的任何 HTML 元素，然后依靠 css 直观地表示该语义内容。遵循这一原则可以带来很多内在的好处，包括更容易的网站整体视觉变化、搜索引擎优化、多设备布局和可访问性。

所以，简短的回答是：你可以做任何你想做的事情，但最佳实践建议你只使用表格标签来表示表格数据，而不是使用最能传达你想要表示的内容的任何 html 标签。一开始可能会有点困难，但是一旦你习惯了这个想法，你会想知道为什么你曾经以其他方式做到这一点。

根据您尝试对表单执行的操作，使用语义标记和 css 不需要太多标记，尤其是当您依赖 css 的级联属性时。此外，如果您在站点的许多页面中有多个相同的表单，那么语义方法会更加高效，无论是编码还是维护。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T22:08:10.380

为了使表单尽可能易于访问且语义正确，我使用以下格式：

```
<fieldset>
  <ol>
    <li>
      <label for='text_field'>Text Field</label>
      <input type='text' name='text_field' id='text_field' />
    </li>
  </ol>
</fieldset> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-16T20:29:32.177

我主要使用 CSS，直到 CSS 成为拖累。例如，使用表格创建 3+ 列（3 组标签 + 表单字段）的表单比在 css 中要容易得多。我无法让布局在使用纯 CSS 的所有主要浏览器中正常显示，而且我花了太多时间让它工作。所以我说拧它，我用桌子很容易地做到了。表还不错。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-20T21:40:33.457

这是一个灰色地带。并非标记中的所有内容都有明确定义的界限，这是您可以使用个人偏好并做出判断的一种情况。它不太符合组织数据的想法，但单元格跨多个轴相关，这是我用来决定某些东西是否适合表格的经验法则。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-20T21:32:42.150

使用 table 比 div 来布局表格肯定更容易，但请记住，表格应该意味着某些东西 - 它以常规方式呈现数据供用户查看，而不是以给定的顺序在屏幕上放置框. 一般来说，我认为表单布局应该使用 div 来决定表单元素的显示方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T23:18:27.120

在这些表单布局问题中我不经常看到讨论的一件事，如果您选择了一个表格来布局您的表单（其中一个答案中提到了左侧的标签和右侧的字段），那么该布局是固定的。在工作中，我们最近不得不对我们的阿拉伯语网络应用程序进行快速“概念验证”。使用表格进行表单布局的应用程序基本上卡住了，而我可以通过更改我的 CSS 文件中的大约十行来反转所有页面上所有表单字段和标签的顺序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T21:45:20.590

如果您的表单以表格格式布局（例如，左侧的标签和右侧的字段），那么可以，使用表格标签。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-20T21:54:45.513

表格不是“演示文稿”，您要求提供数据，您通常不提供数据。我在表格数据中使用了大量的内联编辑。显然，当从演示切换到输入时，我使用数据单元 - td 作为输入元素的持有者。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-21T03:51:49.383

我在这里看到的大多数答案似乎都是合适的。我唯一要补充的是，特别是对于冷漠或马特先生的，是使用`<dl>/<dt>/<dd>`. 我相信这些在语义上代表了列表。

```
<dl>
  <dt><label for="nameTextBox">Name:</label></dt>
  <dd><input value="input value" type="text" name="fieldName" id="fieldName" /></dd>
</dl> 
```

您可能想要重新设置这些样式，但这在语义上说明了发生了什么，即您有一个“术语”（`<dt>`）和“定义”（`<dd>`）的列表，其中术语是标签，定义是用户输入的值.

# flash - 在 AS3 中通过参数访问 FlashVars 的问题

> ID：109491
> 
> 赞同：0
> 
> 时间：2008-09-20T21:32:09.530
> 
> 标签：flash, actionscript-3, parameters, flashvars

当我尝试访问 AS3 类中的 flashVars 时，我不断收到编译器错误。

这是代码的剥离版本：

```
package myPackage {
 import flash.display.Loader;
 import flash.display.LoaderInfo;
 import flash.display.Sprite;
  public class myClass {
    public function CTrafficHandler() {
        var myVar:String = LoaderInfo(this.root.loaderInfo).parameters.myFvar;}}} 
```

我得到一个编译错误：

*1119：通过静态类型 source:myClass 的引用访问可能未定义的属性根。*

当我将班级行更改为

```
public class myClass extends Sprite { 
```

我没有收到编译器错误，但我确实在输出窗口中得到了这个：

*TypeError：错误 #1009：无法访问空对象引用的属性或方法。*

通过调试器（如建议的那样），我可以看到**this.root**为空。

我怎么解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-24T15:25:18.240

您的问题是您的 DisplayObject 尚未添加到 DisplayList，在您尝试访问 flash vars 时。因此，根据您的对象，根显示对象为空。

您可以使用以下方法确保您的 DisplayObject 在舞台上：

```
package
{
    import flash.display.Sprite;
    import flash.events.Event;

    public class MySprite extends Sprite
    {
        // constructor
        public function MySprite()
        {
            super();
            addEventListener( Event.ADDED_TO_STAGE, onAddedToStage, false, 0, true );
        }

        private function onAddedToStage( event:Event ):void
        {
            removeEventListener( Event.ADDED_TO_STAGE, onAddedToStage );

            var paramList:Object = LoaderInfo( this.root.loaderInfo ).parameters;
            var myParam:String = paramList["myParam"];
        }
    }
} 
```

`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T22:23:00.857

我发现了问题所在。有问题的班级不是项目中使用的主要班级，而是次要班级。

我已将代码移至主类以获取参数，并在获取参数后将它们发送到类构造函数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T18:11:28.713

问题确实是您试图从非显示对象或文档类外部访问此信息。如果您希望访问 root 或 stage，则必须首先将希望访问的对象添加到显示列表中。

我经常将 flashvars 用于在整个项目中经常使用的变量。国家和语言等变量。我发现在这种情况下，最好在文档类中捕获这些参数并使用所述参数作为值创建公共变量。这将使 _global 样式访问这些变量。话虽如此，您确实应该谨慎使用全局变量，尤其是在处理协作项目时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T22:30:59.997

作为替代方案，您可以尝试使用**mx.core.Application.application.parameters**对象。

从[mx.core.Application](http://livedocs.adobe.com/flex/3/langref/mx/core/Application.html#propertySummary)的 LiveDocs 页面：

> **application** : Object
> [静态] [只读]​​ 对顶级应用程序的引用。
> 
> **parameters** : Object
> [只读]​​ parameters 属性返回一个对象，其中包含表示提供给此应用程序的参数的名称-值对。
> 
> 有两个参数来源：应用程序 URL 的查询字符串和 FlashVars HTML 参数的值（这只影响主应用程序）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T21:39:03.833

我认为你应该从 Sprite 扩展，但一定要先初始化它，然后再放到舞台上。尝试启用调试并查看异常报告所说的究竟是什么。

# ruby-on-rails - Rails 和 Gmail SMTP，如何使用自定义发件人地址

> ID：109520
> 
> 赞同：7
> 
> 时间：2008-09-20T21:43:25.227
> 
> 标签：ruby-on-rails, smtp, gmail, actionmailer

我已经将 Rails (2.1) 应用程序设置为通过 Gmail 发送电子邮件，但是无论何时发送电子邮件，无论我在 ActionMailer 中将发件人地址设置为什么，电子邮件总是像从我的 Gmail 电子邮件地址发送一样。这是他们在 Gmail 中为阻止垃圾邮件发送者使用其 SMTP 而设置的安全限制吗？

注意：我在 ActionMailer 中尝试了以下两种方法（以防万一）：

```
@from = me@mydomain.com
from 'me@mydomain.com' 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T21:50:47.597

我相信这只是 Gmail 通过其 SMTP 发送邮件时所做的事情，正如在有关使用 SMTP 发送邮件的教程中提到的那样，他们这样做了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-20T22:00:32.783

这很可能会阻止人们尝试从 Google 无法验证发件人拥有的地址发送电子邮件。这在邮件提供商中相当普遍，并且可能是阻止人们使用 Google 服务发送垃圾邮件的一种保护措施。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T22:27:54.620

我想我自己过去尝试过但失败了，但我只是在 gmail 网站上遇到了这个问题：http: [//mail.google.com/support/bin/answer.py ?ctx=gmail&hl=en&answer=22370](http://mail.google.com/support/bin/answer.py?ctx=gmail&hl=en&answer=22370)

看起来您可以在 gmail 中指定一个自定义的“发件人”地址，也许到那时，看看设置 @from 是否有效（现在 gmail 知道您的自定义发件人地址）。

# ruby-on-rails - 如何测试 Rails Helper 是否定义了方法？

> ID：109528
> 
> 赞同：3
> 
> 时间：2008-09-20T21:46:51.490
> 
> 标签：ruby-on-rails, ruby, unit-testing, helper

我正在创建一个 Rails 插件，它正在动态地向 Helper 添加一个方法。我只想确保添加了该方法。如何查看 Helper 是否响应方法名称？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T22:18:10.433

试试这个：

```
def test_that_foo_helper_defines_bar
  o = Object.new
  assert !o.respond_to? :bar
  o.extend FooHelper
  assert o.respond_to? :bar
end 
```

# linux - 如何以编程方式即时管理 iptables 规则？

> ID：109553
> 
> 赞同：45
> 
> 时间：2008-09-20T21:57:49.593
> 
> 标签：linux, api, kernel, iptables, netfilter

我需要查询现有规则，以及能够轻松添加和删除规则。我还没有找到任何用于执行此操作的 API。有什么我想念的吗？

我最接近的解决方案是`iptables-save | iptables-xml`用于查询和手动调用 iptables 命令本身来添加/删除规则。我考虑过的另一个解决方案是简单地从我的应用程序的数据库中重新生成整个规则集并刷新整个链，然后再次应用它。但我想避免这种情况，因为我不想丢弃任何数据包——除非有办法自动执行此操作。我想知道是否有更好的方法。

C 中的 API 会很棒；但是，由于我打算将其构建到一个独立的 suid 程序中，因此可以使用任何语言执行此操作的库也可以。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-20T22:14:52.873

从[netfilter 常见问题解答](http://www.netfilter.org/documentation/FAQ/netfilter-faq-4.html#ss4.5)：

> 不幸的是，答案是：不。
> 
> 现在你可能会想'但是 libiptc 呢？'。正如邮件列表中多次指出的那样，libiptc*从来没有*打算用作公共接口。我们不保证一个稳定的接口，并计划在 linux 包过滤的下一个版本中将其删除。libiptc 太底层了，无论如何都无法合理使用。
> 
> 我们很清楚这种 API 根本就缺乏，我们正在努力改善这种情况。在此之前，建议使用 system() 或打开管道进入 iptables-restore 的标准输入。后者将为您提供更好的性能。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T23:49:28.467

使用 iptables-save 和 iptables-restore 查询和重新生成规则是最有效的方法。这些曾经是 shell 脚本，但现在它们是运行非常高效的 C 程序。

但是，我应该指出，您可以使用一个工具来使维护 iptables 变得更加容易。大多数动态规则集实际上是重复多次的相同规则，例如：

```
iptables -A INPUT -s 1.1.1.1 -p tcp -m --dport 22 -j ACCEPT
iptables -A INPUT -s 2.2.2.0/24 -p tcp -m --dport 22 -j ACCEPT
iptables -A INPUT -p tcp -m tcp --dport 22 -j REJECT 
```

每次您想更改哪些端口可以访问端口 22（例如，端口敲击很有用）时，您可以使用 ipsets，而不是替换这些规则。即：

```
ipset -N ssh_allowed nethash
iptables -A ssh_allowed -m set --set ssh_allowed src -p tcp -m --dport 22 -j ACCEPT
ipset -A ssh_allowed 1.1.1.1
ipset -A ssh_allowed 2.2.2.0/24 
```

集合可以保存 ip 地址、网络、端口、mac 地址，并在其记录中设置超时。（曾经想在一个小时内添加一些东西吗？）。

甚至还有一种将一个集合与另一个交换的原子方式，因此刷新意味着创建一个新的临时集合，然后将其作为现有集合的名称进行交换。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-03-25T22:49:40.860

您可以考虑使用[rfw](https://github.com/securitykiss-com/rfw)，它是 iptables 的 REST API。它正在序列化来自各种潜在并发源的 iptables 命令，并即时远程执行 iptables。

rfw 是为尝试在多个机器上更新防火墙规则的分布式系统而设计的，但它也可以在 localhost 接口上的单台机器上运行。然后它允许避免 SSL 和身份验证开销，因为在这种情况下它可以在纯 HTTP 上运行。

示例命令：

```
PUT /drop/input/eth0/11.22.33.44 
```

对应于：

```
iptables -I INPUT -i eth0 -s 11.22.33.44 -j DROP 
```

您可以插入和删除规则以及查询当前状态以获取 JSON 格式的现有规则：

```
GET /list/input 
```

免责声明：我开始了那个项目。它是在 MIT 许可下开源的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-20T22:13:15.593

据我了解（尽管似乎没有提到它），`iptables-restore`是原子的。最后，当`COMMIT`读取该行时，`iptables`调用（`iptc_commit`在`libiptc`您不应该使用的内部接口中），然后`setsockopt(SO_SET_REPLACE)`使用您的新规则集调用。

这听起来就像你能得到的一样原子：一个内核调用。但是，请更多知识渊博的各方对此提出异议。:-)

编辑：我可以确认您的描述是正确的。`iptables-restore`在内核中作为原子操作完成。

更*具体地说*，“仅”操作是基于每个 CPU 的原子操作。当我们存储每个 CPU 的整个规则集 blob 时（由于缓存优化）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-20T22:02:27.897

故意没有 API 来管理这些规则。你不应该想要这样做。或者其他的东西。

如果您需要足够动态的规则，您关心执行 /sbin/iptables 的性能，还有其他方法可以做到：

*   使用“最近”匹配或 ip 集匹配之类的东西，您可以在不更改规则集的情况下从黑/白名单中添加/删除 IP 地址。
*   您可以将数据包传递到用户空间以使用 NFQUEUE 进行过滤

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-04-18T21:56:23.997

今天早上我醒来发现这是来自俄罗斯的拒绝服务 (DOS) 攻击。他们从几十个 IP 块中攻击我。他们必须拥有大量 IP 或某种代理列表/服务。每次我屏蔽一个IP，就会弹出另一个IP。最后，我寻找了一个脚本，发现我需要编写自己的解决方案。以下内容有点激进，但他们将我的 TOP LOAD LEVEL 运行到 200 以上。

这是我编写的用于实时阻止 DOS 的快速脚本。

```
cat  **"output of the logs"** | php ipchains.php **"something unique in the logs"** 
```

**==> PHP 脚本：**

```
<?php

$ip_arr = array();

while(1)
{
   $line = trim(fgets(STDIN)); // reads one line from STDIN
   $ip = trim( strtok( $line, " ") );

   if( !array_key_exists( $ip, $ip_arr ) )
      $ip_arr[$ip] = 0;

   $regex = sprintf( "/%s/", $argv[1] );

   $cnt = preg_match_all( $regex, $line );

   if( $cnt < 1 ) continue;

   $ip_arr[$ip] += 1;

   if( $ip_arr[$ip] == 1  )
     {
//     printf( "%s\n", $argv[1] );
//     printf( "%d\n", $cnt );
//     printf( "%s\n", $line );

       printf( "-A BLOCK1 -s %s/24 -j DROP\n", $ip );

       $cmd = sprintf( "/sbin/iptables  -I BLOCK1  -d %s/24 -j DROP", $ip );
       system( $cmd );
     }
}

?> 
```

**假设：**

```
1) BLOCK1 is a Chain already created. 
2) BLOCK1 is a Chain that is run/called from the INPUT CHAIN 
3) Periodically you will need to run "ipchains -S BLOCK1" and put output in /etc/sysconfig file. 
4) You are familiar with PHP 
5) You understand web log line items/fields and output. 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-23T14:20:17.363

这是使用 bash 和 iptables 动态阻止黑客在 CentOS 上滥用 sshd 的示例。在这种情况下，我将 sshd 配置为禁止密码登录（允许密钥）。我在 /var/log/secure 中查找“Bye Bye”的条目，这是 sshd 说 f-off 的礼貌方式......

```
IP=$(awk '/Bye Bye/{print $9}' /var/log/secure |
     sed 's/://g' |sort -u | head -n 1)

[[ "$IP" < "123" ]] || {

  echo "Found $IP - blocking it..." >> /var/log/hacker.log

  /sbin/iptables -A INPUT -s $IP -j DROP

  service iptables save

  sed -i "/$IP/d" /var/log/secure

} 
```

我每秒或每分钟循环运行一次，或者任何让我开心的事情。我测试 $IP 的值以验证它是否找到了有用的值，如果是，我调用 iptables 删除它，并使用 sed 清除 $IP 的日志文件，这样就不会再次添加该条目。

我做了一些预处理（未显示）以将一些始终有效且可能无法连接（由于用户错误）的重要 IP 列入白名单。

我不时地对 iptables 过滤器列表进行排序并从中创建 IP 范围（使用不同的脚本 - 当检查时，它们通常是来自印度、中国和俄罗斯的 IP 范围）。因此，我的整体 iptables 过滤规则集保持在 50 到 500 个条目之间；ipset 在这么短的列表上并没有真正改进。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T22:13:11.943

MarkR 是对的，你不应该这样做。最简单的方法是从脚本调用 iptables 或编写 iptables 配置并“恢复”它。

不过，如果您愿意，请阅读 iptables 的源代码。iptables 使用匹配项和表作为共享对象。您可以使用源或它们。

Linux netfilter 在 /usr/include/netfilter* 下也有一些包含文件。这些是一些低级功能。这是 iptables 使用的。这与没有 iptables 的 API 一样接近。

但是这个 API 很“混乱”。请记住，它被设计为仅供 iptables 使用。它没有很好的文档记录，您可能会遇到非常具体的问题，API 可以在没有任何警告的情况下快速更改，因此升级可能会破坏您的代码等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-21T12:40:39.213

根据 netfilter 的讨论，我知道它是一个短期解决方案，但在短期内，您可以使用包装在 python 中的 iptc：

[https://github.com/ldx/python-iptables](https://github.com/ldx/python-iptables)

我在我最近的一个项目中使用了它，发现它非常有效。

# flash - 如何在 Flash 中访问 c ookie？

> ID：109580
> 
> 赞同：10
> 
> 时间：2008-09-20T22:09:49.593
> 
> 标签：flash, actionscript, cookies

我希望在 Flash 电影中获取同一域的 cookie 值。这可能吗？

让我们看看我让用户设置一个变量 foo 并使用任何 Web 编程语言存储它。我可以通过该语言轻松访问它，但我想通过 Flash 电影访问它，而不是通过在 HTML 页面中打印它来传递它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-22T11:12:10.767

如果您只想存储和检索数据，您可能需要使用 SharedObject 类。有关详细信息，请参阅[Adob​​e 的 SharedObject 参考](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/SharedObject.html)。

如果要访问 HTTP cookie，则需要使用 ExternalInterface 与 javascript 对话。我们在这里这样做的方式是有一个名为 HTTPCookies 的帮助程序类。

HTTPCookies.as：

```
import flash.external.ExternalInterface;

public class HTTPCookies
{
    public static function getCookie(key:String):*
    {
        return ExternalInterface.call("getCookie", key);
    }

    public static function setCookie(key:String, val:*):void
    {
        ExternalInterface.call("setCookie", key, val);
    }
} 
```

您需要确保使用 Flash 对象中的“allowScriptAccess”参数启用 javascript。

然后你需要创建一对javascript函数getCookie和setCookie，如下（感谢[quirksmode.org](http://www.quirksmode.org/js/cookies.html)）

HTTPCookies.js：

```
function getCookie(key)
{
    var cookieValue = null;

    if (key)
    {
        var cookieSearch = key + "=";

        if (document.cookie)
        {
            var cookieArray = document.cookie.split(";");
            for (var i = 0; i < cookieArray.length; i++)
            {
                var cookieString = cookieArray[i];

                // skip past leading spaces
                while (cookieString.charAt(0) == ' ')
                {
                    cookieString = cookieString.substr(1);
                }

                // extract the actual value
                if (cookieString.indexOf(cookieSearch) == 0)
                {
                    cookieValue = cookieString.substr(cookieSearch.length);
                }
            }
        }
    }

    return cookieValue;
}

function setCookie(key, val)
{
    if (key)
    {
        var date = new Date();

        if (val != null)
        {
            // expires in one year
            date.setTime(date.getTime() + (365*24*60*60*1000));
            document.cookie = key + "=" + val + "; expires=" + date.toGMTString();
        }
        else
        {
            // expires yesterday
            date.setTime(date.getTime() - (24*60*60*1000));
            document.cookie = key + "=; expires=" + date.toGMTString();
        }
    }
} 
```

一旦你的 Flash 项目中有 HTTPCookies.as，并且从你的网页加载了 HTTPCookies.js，你应该能够从你的 Flash 电影中调用 getCookie 和 setCookie 来获取或设置 HTTP cookie。

这仅适用于非常简单的值——字符串或数字——但对于更复杂的值，你真的应该使用 SharedObject。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T22:18:29.200

我相信 Flash 对象具有可通过 javascript 访问的功能，因此如果没有更简单的方法，您至少可以使用 javascript onload 处理程序并将 document.cookie 从外部传递到您的 Flash 应用程序。

更多信息在这里：[http ://www.permadi.com/tutorial/flashjscommand/](http://www.permadi.com/tutorial/flashjscommand/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T22:19:39.010

您可以从闪存读取和写入 cookie（本地共享对象）。Flash cookie 存储在您的 PC 上以您的域名称命名的目录中。这些目录位于：

```
[Root drive]:\Documents and Settings\[username]\Application Data\Macromedia\Flash Player\#SharedObjects\ 
```

Adobe 的这篇[文章](http://www.adobe.com/products/flashplayer/articles/lso/)是一个好的开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T22:22:48.940

一些谷歌搜索表明它可以通过使用[查询字符串](http://forums.asp.net/t/1315014.aspx)来完成：

> 对于 Web 应用程序，您可以通过 url 参数将值传递给 swf，然后（使用 swf 中的操作脚本）将它们保存到沙箱中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T09:29:19.260

cookie 可通过 document.cookie 用于 javascript - 尝试使用 flash 的 getURL 调用 javascript 函数。

`getURL('javascript:document.cookie = "varname=varvalue; expires=Thu, 2 Aug 2001 20:47:11 UTC; path="');`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T18:27:39.353

HTTPCookies.as 中的 getCookie 方法应该使用“return”语句。

```
import flash.external.ExternalInterface;
public class HTTPCookies
{    
  public static function getCookie(key:String):*   
  {
        return ExternalInterface.call("getCookie", key);    
  }
  public static function setCookie(key:String, val:*):void 
  {
        ExternalInterface.call("setCookie", key, val);    
  }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-04-30T20:06:56.343

我晚了10年。如果你可以在页面中嵌入你需要的数据，那么抓取起来会容易 10 倍。

```
import flash.net.*

var _loader:URLLoader = new URLLoader();
var _req:URLRequest = new URLRequest('https://stackoverflow.com');
_loader.addEventListener(Event.COMPLETE, _onComplete);
_loader.load(_req);

function _onComplete(e:Event):void{
    var wantedData:RegExp = /<div class="cool-data">(.*?)</div>/ig;
    var result:Object = wantedData.exec(String(_loader.data));
    trace(result[0].split('<div class="cool-data">').join('')
                   .split('</div>').join(''));

} 
```

# optimization - 在 Tomcat 6 中加速图像

> ID：109592
> 
> 赞同：3
> 
> 时间：2008-09-20T22:15:35.727
> 
> 标签：optimization, tomcat, ajp

在 tomcat 6 中，我有一个运行 openbluedragon 的 servlet，一切都编译并快速启动服务器，除了图像，它们确实明显滞后。任何关于图像服务的优化建议？

这是我的 server.xml：

```
 <Service name="Catalina">

      <Connector port="8009" protocol="AJP/1.3" />
      <Connector port="8080" maxThreads="100" protocol="HTTP/1.1" connectionTimeout="20000" />
      <Engine name="Standalone" defaultHost="hostname.whatever" jvmRoute="ajp13">

      <Realm className="org.apache.catalina.realm.UserDatabaseRealm" resourceName="UserDatabase"/>
      <Host name="hostname.whatever"  appBase="webapps" unpackWARs="true" autoDeploy="true" xmlValidation="false" xmlNamespaceAware="false">
        ...context
      </Host>

    </Engine>
  </Service> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-22T06:35:28.827

另一种选择是使用 apache 作为前端，将 tomcat 与 mod_jk 连接起来。这样，您可以让 apache 提供静态内容（例如图像、css、javascript）并让 tomcat 生成动态内容。可能需要做一些工作来将静态内容与动态内容分开，但对我来说效果很好。

在 Unix 上，将 apache 作为前端是一个不错的选择，因为绑定到端口 80 您经常被迫以 root 身份运行。Apache 知道如何在绑定端口后删除 root 权限，而 Tomcat 不知道。您不希望面向公众的服务器以 root 身份运行。

（这类似于反向代理答案，但不涉及代理但 mod_jk）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T11:50:08.763

Are you serving the same set of images over and over? In that case adding a servlet filter that adds a reasonable Expires header might save tomcat a lot of work. It will not increase the speed of the served image but will just make the number of requests it has to handle less. Lots of examples for this on the web.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T22:50:38.467

如果您可以选择，您可以在应用程序之前添加反向代理。在工作中，我有一个接收所有入站 HTTP 连接的 Apache Web 服务器。根据 URL，它要么将请求转发到另一台服务器，要么自己提供内容。我使用这种方法来加速为 Trac 站点提供静态内容。如果你想走这条路，ProxyPass 和 ProxyPassReverse 指令是一个很好的起点。

举个简单的例子，如果您有一个名为 /images 的虚拟目录，Apache 可以为该目录中的某些内容提供任何请求，并将其他所有内容转发到您的 Tomcat 实例。语法相当全面。如果有任何方法可以识别您的静态内容，那么这是一种可行的方法。

Apache 不是这里唯一的选择。我认为所有现代 Web 服务器都包含类似的功能。如果我从今天开始，我可能会改用 LigHTTPd，因为它做得更少。

甚至可能会有缓存反向代理自动为您解决这个问题。我不熟悉他们中的任何一个。

# sql-server - 在已编译的应用程序中查找 SQL 查询

> ID：109594
> 
> 赞同：2
> 
> 时间：2008-09-20T22:17:04.197
> 
> 标签：sql-server

我刚刚继承了一个服务器应用程序，但是似乎数据库的唯一副本已损坏并且工作版本已经消失，所以是否可以找到应用程序正在运行的查询以便我可以尝试重建表？

编辑：我有一些没有扩展名的文件，我的命名与数据库相同，IDK 如果有什么可以用它们做的，但如果有人有任何想法。

接受的答案似乎最有可能成功，但是我能够找到另一个备份，所以我没有测试它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T22:18:42.757

打开 SQL 查询日志并观察应用程序的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T22:21:23.967

如果您可以访问 unix 机器，或者可以安装 cygwin 实用程序 ( [http://www.cygwin.com/](http://www.cygwin.com/) )，则有一个名为“strings”的命令将搜索任何文件类型并打印出任何连续的序列字符数据（可能只是 ascii）。该工具应该可以帮助您识别应用程序中嵌入的 sql 查询。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T22:25:49.057

查找 SQL Profiler，它（取决于您拥有的版本）通常可从查询分析器 (isqlw.exe) 或管理工作室（在更高版本中）的工具菜单中获得。

使用 SQL 探查器，您可以在服务器上运行跟踪，它可以显示应用程序正在请求哪些查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T22:20:04.407

您可以在程序上运行 UNIX 命令“strings”以查看它是否嵌入了 sql 字符串：

[http://en.wikipedia.org/wiki/Strings_(Unix)](http://en.wikipedia.org/wiki/Strings_(Unix))

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-20T22:57:38.887

您可以对要搜索的文件进行正则表达式

*   “选择 *”
*   “更新 *”
*   “从 * 中删除”
*   “插入 *”

# c# - 如何在 Silverlight 中定位标签页的内容？

> ID：109608
> 
> 赞同：1
> 
> 时间：2008-09-20T22:22:45.663
> 
> 标签：c#, silverlight

当我在 Silverlight 中的标签页上放置一个控件时，该控件向下放置 ~10 像素，向右放置 ~10 像素。例如，以下 xaml：

```
<System_Windows_Controls:TabControl x:Name=TabControlMain Canvas.Left="0" Canvas.Top="75" Width="800" Height="525" Background="Red" HorizontalContentAlignment="Left" VerticalContentAlignment="Top" Padding="0" Margin="0">
        <System_Windows_Controls:TabItem Header="Test" VerticalContentAlignment="Top" BorderThickness="0" Margin="0" Padding="0" HorizontalContentAlignment="Left">
            <ContentControl>
                <Grid Width="400" Height="200" Background="White"/>
                </ContentControl>
        </System_Windows_Controls:TabItem>    
</System_Windows_Controls:TabControl> 
```

将产生：

![替代文字](https://i.stack.imgur.com/y5LuN.jpg)

如何将内容定位在 0,0？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T02:25:03.490

检查 TabItem 的控件模板，它可能有一些默认的 Margin 10。只是猜测

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T06:33:01.773

看看控件模板，它有那个大小的边距。使用 blend 修改选项卡控件模板的副本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T19:47:41.190

您还可以为内容添加负边距。我发现该值为9像素...

```
<System_Windows_Controls:TabControl x:Name=TabControlMain Canvas.Left="0" Canvas.Top="75" Width="800" Height="525" Background="Red" HorizontalContentAlignment="Left" VerticalContentAlignment="Top" Padding="0" Margin="0">
        <System_Windows_Controls:TabItem Header="Test" VerticalContentAlignment="Top" BorderThickness="0" Margin="0" Padding="0" HorizontalContentAlignment="Left">
            <ContentControl>
                <Grid Width="400" Height="200" Margin="-9,-9,-9,-9" Background="White"/>
                </ContentControl>
        </System_Windows_Controls:TabItem>    
</System_Windows_Controls:TabControl> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T11:59:00.897

在花了几个小时鬼混这个问题之后。布赖恩是完全正确的。当前版本的VS不允许更改TabControl的模板，但是可以使用Blend来完成，而且模板上有一个margin。这样做的主要缺点是 XAML 文件将不再可从 Visual Studio 预览。

# html - 您将如何使用 CSS 而不是 HTML 表格来实现这种基于表格的布局？

> ID：109618
> 
> 赞同：9
> 
> 时间：2008-09-20T22:28:26.493
> 
> 标签：html, css

我希望以下布局出现在屏幕上：

```
FieldName 1             [Field input 1]
FieldName 2 is longer   [Field input 2]
    .                         .
    .                         .
FieldName N             [Field input N] 
```

要求：

*   字段名称和字段输入必须在左边缘对齐
*   两列都必须根据其内容动态调整大小
*   必须跨浏览器工作

我发现这种布局使用 HTML 表格非常简单，但由于我看到很多 CSS 纯粹主义者坚持表格只能用于表格数据，我想我会找出是否有办法使用 CSS 来做到这一点。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-20T22:48:20.750

我不会，我会用一张桌子。这是表格布局的经典示例 - 正是表格*应该*用于的那种事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T23:24:33.283

我认为大多数答案都忽略了原始提问者希望列宽取决于内容宽度的观点。我相信使用纯 CSS 执行此操作的唯一方法是使用“display: table”、“display: table-row”和“display: table-cell”，但 IE 不支持。但是我不确定这个属性是否可取，我发现创建一个宽列是因为有一个长字段名称会使布局在美学上不那么令人愉悦并且更难使用。我认为换行很好，所以我认为我刚才建议的答案不正确可能是要走的路。

[Robertc 的示例](https://stackoverflow.com/questions/109618/how-would-you-achieve-this-table-based-layout-using-css-instead-of-html-tables#109714)`<th>`很理想，但如果您真的必须使用表格，我认为您可以通过使用字段名称使其更加“语义化” 。我不确定这一点，所以如果我错了，请有人纠正我。

```
<table>
    <tr><th scope="row"><label for="field1">FieldName 1</label></th>
        <td><input id="field1" name="field1"></td></tr>
    <tr><th scope="row"><label for="field2">FieldName 2 is longer</label></th>
        <td><input id="field2" name="field2"></td></tr>
    <!-- ....... -->
</table> 
```

更新：我没有密切关注这一点，但 IE8 显然支持 CSS 表，所以有些人建议我们应该开始使用它们。有[一篇关于 24 种方式](http://24ways.org/2008/the-first-tool-you-reach-for)的文章，最后包含一个相关示例。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T22:43:14.507

最好还是使用列表

```
 <fieldset class="classname">
        <ul>
            <li>
                <label>Title:</label>
                <input type="text" name="title" value="" />
            </li>
        </ul>
     </fieldset> 
```

为标签和输入设置足够宽的 li 标签宽度，并将标签浮动到左侧。

还可以使用表格实现类似块的表格，您可以将标签宽度设置为与强制所有标签的最大字段名一样大或扩展该宽度。

[编辑] 这是一个很好的阅读[列表](http://www.alistapart.com/stories/practicalcss/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T23:05:15.593

尚不清楚它是否像其他一些人评论的那样是表格数据，尽管它可能是。表将暗示各个列中所有项目之间的语义关系（不仅仅是“它们都是数据库列的名称”）。无论如何，这是我之前的做法：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Form layout</title>
    <style type="text/css">
        fieldset {width: 60%; margin: 0 auto;}
        div.row {clear: both;}
        div.row label {float: left; width: 60%;}
        div.row span {float: right; width: 35%;}
    </style>
</head>
<body>
    <form action="#" method="post">
        <fieldset>
            <legend>Section one</legend>
            <div class="row">
                <label for="first-field">The first field</label>
                <span><input type="text" id="first-field" size="15" /></span>
            </div>
            <div class="row">
                <label for="second-field">The second field with a longer label</label>
                <span><input type="text" id="second-field" size="10" /></span>
            </div>
            <div class="row">
                <label for="third-field">The third field</label>
                <span><input type="text" id="third-field" size="5" /></span>
            </div>
            <div class="row">
                <input type="submit" value="Go" />
            </div>
        </fieldset>
    </form>
</body>
</html> 
```

编辑：似乎“按设计”我无法回复对我的答案的评论，显然这不那么令人困惑。因此，回复 17 of 26 的评论 - 60% 的宽度完全是可选的，默认情况下，字段集将继承包含元素的宽度。当然，您也可以使用 min-width 和 max-width，或任何表格布局规则，只要 IE 支持它们，但这并不是 CSS 惨遭失败；）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-03T14:53:18.400

在此问题的限制下，此标记和 CSS 大致实现了您的既定目标......

**提案**

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>My Form</title>
    <style type="text/css">
      #frm1 div {float: left;}
      #frm1 div.go {clear: both; }
      #frm1 label, #frm1 input { float: left; clear: left; }
    </style>
  </head>
  <body>
    <form id="frm1" action="#" method="post">
      <fieldset>
        <legend>Section One</legend>
        <div>
          <label for="field1">Name</label>
          <label for="field2">Address, City, State, Zip</label>
          <label for="field3">Country</label>
        </div>
        <div>
          <input type="text" id="field1" size="15" />
          <input type="text" id="field2" size="20" />
          <input type="text" id="field3" size="10" />
        </div>
        <div class="go">
          <input type="submit" value="Go" />
        </div>
      </fieldset>
    </form>
  </body>
</html> 
```

**优点**

...但我不建议使用它。这个解决方案的问题是

1.  在窄浏览器宽度下非常烦人的整列换行
2.  它将标签与标记中的相关输入字段分开

上面的解决方案应该是（我还没有验证过）易于访问的，因为我读过的屏幕阅读器很好地使用了`for=""`将标签关联到输入字段的属性。所以在视觉上和可访问性上这很有效，但您可能不喜欢将所有标签与输入字段分开列出。

**结论**

精心设计的问题——特别是自动将整列不同长度标签的宽度调整为最大标签长度的要求——使标记解决方案偏向于表格。没有这个要求，有几个很好的语义解决方案来呈现表单，正如这个线程中的其他人已经提到和建议的那样。

我的观点是：有几种方法可以以令人愉悦、易于访问和直观的方式呈现表单和收集用户输入。如果您找不到可以满足最低要求但表格可以满足的 CSS 布局，请使用表格。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-20T22:31:47.593

FieldName 对象应包含在 SPAN 中，其样式属性为 float: left 且宽度足以容纳您的标签。

输入应包含在样式为 float:left 的跨度内。在每个字段输入之后放置一个`<div style="clear: both"/>`或`<br/>`以中断浮动。

您可以将上述对象封装到一个具有宽度样式属性集的 div 中，该属性集对于标签和输入来说都足够宽，以便“表格”保持小而包含。

例子：

```
<span style="float: left; width: 200px">FieldName1</span><span style="float: left"><input/><br/>

<span style="float: left; width: 200px">FieldName2</span><span style="float: left"><input/><br/>

<span style="float: left">FieldName3</span><span style="float: left"><input/><br/> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-20T22:42:56.020

每一行都将被视为一个“div”，其中包含两个“跨度”，一个用于字段名，一个用于输入。在两个跨度上设置“float:left”。但是，您需要为“fieldname”跨度设置一些宽度。

此外，为 div 设置样式以包含属性“clear:both”以防万一。

# c# - 克服从 Winforms 迁移到 WPF 的更大障碍是什么？

> ID：109620
> 
> 赞同：6
> 
> 时间：2008-09-20T22:29:44.133
> 
> 标签：c#, wpf, windows, winforms

几年来，我一直在用 C# 开发 Winforms 应用程序，并且一直有兴趣将未来的开发转向 WPF，这主要是因为我听到了关于它的积极消息。但是，我想知道其他人在迁移到 WPF 时必须克服什么样的障碍。是否对您的工作效率造成了重大影响，或者您发现具有挑战性的任何特定问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-20T22:32:49.307

我不确定我能给你一个障碍，因为它完全背离了 WinForms。我的建议是获取 Adam Nathan 的 WPF Unleashed，忘记你所知道的关于使用任何以前的技术（Winforms、MFC、Java）构建 UI 的所有知识，然后从一开始就重新开始。

如果您尝试以任何其他方式进行操作，那将导致彻底的挫败感。

ETA：我之所以说从头开始，是因为有时如果你从头开始，学习新概念会更容易。过去，我发现在学习新事物时，如果我尝试将知识从技术带到技术，我可能是自己最大的敌人（例如，认为多年来从事 asmx Web 服务使我无法阅读前几对WCF 书籍的章节）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-20T22:47:01.783

在我公认的 WPF 经验有限的情况下，更大的障碍包括彻底改革我的关于如何构建 UI 的心理模型以及因此需要学习的新术语。不过，其他人可能更容易适应模型。我可以看到来自网络世界最佳实践的人会如何发现过渡更加自然。

我的工作效率肯定受到了重大打击（如此重大，以至于我还不习惯去找我的雇主并说“让我用 WPF 而不是 Winforms 来做这件事”）。我不认为我永远不会到达那里，但我需要在我的个人时间通过练习来开发一些额外的技术舒适度。

我没有遇到任何我发现比其他任何问题更具挑战性的特定问题。我相信[Adam Nathan](http://blogs.msdn.com/Adam_Nathan/)的[WPF Unleashed](https://rads.stackoverflow.com/amzn/click/com/0672328917)曾在其他地方提到过，这绝对值得一读。我也听说过关于[查尔斯·佩佐德的](http://www.charlespetzold.com/blog/blog.xml) [书](https://rads.stackoverflow.com/amzn/click/com/0735619573)的好消息，但我不能亲自担保。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T22:49:36.707

1.  您不能关闭[抗锯齿](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/1ad9a62a-d1a4-4ca2-a950-3b7bf5240de5)。
2.  您的用户需要带有 .net 3.x 框架的 Vista 或 XP SP2。
3.  如果您想使用 winforms，请注意 Air Space（[这里](http://www.drwpf.com/blog/Home/tabid/36/EntryID/38/Default.aspx)是 D3D 的一种解决方案）。

这些是我的主要问题。除此之外，我完全赞成，它的方式不仅仅是看起来。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T23:28:53.727

Microsoft Learning 网站有一个有用的介绍，如果您有 Microsoft Passport 帐户，我相信它是免费的[https://www.microsoftelearning.com/eLearning/courseDetail.aspx?courseId=85488](https://www.microsoftelearning.com/eLearning/courseDetail.aspx?courseId=85488)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-21T02:33:46.870

如果 WinForms 应用程序定义了适当的对象模型架构（更像是 MVC 模型架构），我认为将您的 UI 迁移到 WPF 不会花费太多时间。WPF 按层次结构（VisualTree）组织了它的视觉元素，RoutedEvents 和 RoutedCommands 是 WPF 中的全新概念。显然还有更多像 DataTemplate/Controltemplate 这样的东西都在 XAML 级别。所有这些都为实现出色的用户体验提供了一种非常强大且简单的方法。 ***所以我在这里的主要观点是，您可以期望您的对象模型在 WPF 中可重用（经过一些修改），而 Winforms 项目中的所有其他内容都需要抛弃。***当然所有其他层都不需要修改（通信层/数据层）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-21T05:25:04.167

我在同一条船上。我一直在使用 winforms 编程这么久。现在我一直决定我要学习 WPF 并开始用它做所有事情。对我来说最难的事情是习惯于主要将 XAML 用于 UI 而不是 C# 代码，而且 WPF 中的许多属性都不同。（IE - 要更改标签的文本，您必须更改 Content 属性）。所以我最大的问题是让我的头脑脱离 winforms 并进入一种全新的思维方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-20T22:57:43.303

嗯，对我来说，WPF 中的控件的行为与 WPF 中的控件有很大不同（例如，在窗体中定位时）。您必须尽快了解差异，才能成功且高效地使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-25T14:34:12.317

即使有 20 多年的经验，我也发现 WPF 的学习曲线很陡峭。我尝试使用 WPF 完成我的最新项目，但缺少内置控件（例如 NumericUpDown）以及让 DataBinding 与业务对象一起工作的问题迫使我为这个项目回退到 Winforms，但我希望在未来的项目中使用它。当我在 WPF 和 Winforms 之间切换时，几乎所有我编写的代码（与设计器生成的代码相比）都是可重用的。

# vps - 寻找合适的 VPS

> ID：109631
> 
> 赞同：20
> 
> 时间：2008-09-20T22:33:28.820
> 
> 标签：vps

市场上充斥着 VPS（虚拟专用服务器）托管选项。似乎每个人和他们的母亲在他/她的衣橱里都有一台超载的服务器。企业选项的价格似乎总是高得离谱，这使得那些便宜并声称企业级别的选项似乎不稳定。

您在优质的 VPS 提供商中寻找什么（语言支持、24 小时技术等），如果有的话，您如何检查他们的可信度？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-08T08:53:50.397

选择 VPS 供应商可能很棘手。一些警告标志：

*   未列出您通过 VPS 计划获得的保证 RAM 数量的供应商，
*   没有列出他们的联系信息或办公地址的供应商（许多小型经销商只列出他们的计划以及他们想要你的钱的方式）。
*   供应商没有提及他们是否拥有自己的硬件或转售他人的能力。

从性能的角度来看，还有许多其他事情需要考虑：

*   能够让您的 VPS 靠近您的大多数客户（至少在同一个国家/地区）
*   保证 RAM 的成本/数量。

要列出至少提供此基本信息的 VPS 计划和供应商，请尝试[CompareVPS.com](http://www.comparevps.com/)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T22:48:34.900

我在[Linode](http://linode.com)上运气不错。我通过它们运行[Utility Mill 。](http://utilitymill.com)他们的收费很好，价格合理，而且总是有人可以在他们的 IRC 房间里为您提供帮助。

回到我研究的时候，[Slicehost](http://www.slicehost.com/)看起来也很有前途，但当时他们有一个等候名单。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-20T23:00:34.560

大多数虚拟主机平台都会有一个试用期，您可以在其中测试它们的可靠性。他们还将为您提供他们系统上的知名网站列表。大多数人都会跟踪交通拥堵者，因为这是他们证明自己稳定性的好方法。

我会推荐[Slicehost](http://www.slicehost.com/)，因为我和他们在一起已经一年多了，并且喜欢控制。他们有一个很棒的面板，您可以在其中进行控制台操作、重建切片并在实例中重新启动切片。它们还允许非常快速和轻松的内存升级、带宽池（将您所有的帐户带宽放入一个大池中），并且它们允许许多不同的 Linux 内核操作系统。

因此，要回答您的问题而不听起来像一个完整的广告：

1.  检查他们管理您的 VPS 的远程功能。
2.  查看他们最大的客户和他们系统上的一些大型网站。
3.  测试他们的 VPS 30 天左右，并给他们的支持一个测试！
4.  查看人们谈论服务的论坛（比如这个帖子已经提到了 Slicehost 3 次）。
5.  检查地点并确保人们没有抱怨过度销售或挤占服务器。我知道在 VPS 世界中，沙盒化的东西比共享主机要多得多，但很高兴知道它们可以处理负载。
6.  查看移动服务器或为您的 VPS 添加更多内存的能力。

这些是我寻找的东西。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-20T23:53:25.180

[在http://www.webhostingtalk.com/](http://www.webhostingtalk.com/)等论坛上检查可信度

我即将购买 VPS，经过一番研究，我选择了[http://www.servint.com/](http://www.servint.com/)

*   市场多年
*   在 webhostingtalk 上看起来可信
*   托管服务器：[http ://www.servint.net/vps/faq.php#14](http://www.servint.net/vps/faq.php#14)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-20T22:37:58.060

我认为一种方法是寻找信誉良好的网站使用的方法。例如，我通过使用它[重构我的代码了解了](http://refactormycode.com/)[Slicehost](http://www.slicehost.com/)，我喜欢它。:-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-09T06:44:31.787

我在 ServInt 只工作了一个月，但到目前为止，体验非常好。在论坛上听到一些好消息后，我最初从 LiquidWeb 获取了一个 VPS，但非常失望。我得到的加载时间很糟糕。虽然我会说他们的客户服务非常敏锐。无论如何，我认为与 ServInt 一起使用会是一个不错的选择。到目前为止，表现非常出色，但还没有真正需要处理他们的 CS。就 unmanaged 而言，我听说 Slicehost 和 Linode 正在赢得这场比赛。我的 2 美分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-09T06:50:53.053

我还应该补充一点，这让我非常自信，我正在与一家优秀的公司打交道，他们支持他们的竞争对手，而他们本可以轻松地做相反的事情。

[http://blog.servint.net/2009/07/08/why-servint-stands-beside-rackspace-and-you-should-too/](http://blog.servint.net/2009/07/08/why-servint-stands-beside-rackspace-and-you-should-too/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-20T22:48:35.507

我已经尝试了很多。我唯一可以全心推荐的是[Slicehost](http://www.slicehost.com/)。他们非常擅长他们所做的事情。我有很多客户在他们的系统上运行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-20T22:58:09.417

我使用机架力。我havnt有我的问题，但后来我没有任何大规模的。关于它们的一件好事是它们处于两个电网和骨干的边界上。（所以我听说过）

远离 Webserve.ca。他们是可怕的，可怕的支持，他们把事情搞砸了，解决问题的速度很慢。我听说他们是经销商。当我只需要快速的东西并且没有进行任何搜索时，我尝试了它们。坏坏坏。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-20T22:59:45.823

查找有关托管服务的好坏参考的最佳方法始终是谷歌搜索和论坛。我一直在寻找良好的支持以及它的服务提供商的灵活性。我作为开发和登台服务器拥有的一个位于“A small orange” [http://www.asmallorange.com/services/vps/](http://www.asmallorange.com/services/vps/)中。他们甚至有一个开发人员包，这就是我使用的。但我从那里开始获得一个简单的更便宜的托管计划（25 美元/年），我检查了他们的支持、他们的正常运行时间，当我对他们的服务充满信心时，我就有了一个 VPS。我推荐它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-21T00:46:44.287

可用性很好，但即使是廉价的解决方案通常也足够了。

自从我开始托管网站以来，我最想要的东西：Shell 访问。

通过 FTP 和 Web 界面做所有事情是一件很痛苦的事情。

哦，如果您的应用程序有 PHP/MySQL/Apache/IIS/.Net/JSP/etc 版本要求，您需要先检查这些。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-10-06T02:22:23.623

你应该试试JoinVPS。它便宜且足够可靠。

# c - C 指针赋值行为

> ID：109644
> 
> 赞同：-1
> 
> 时间：2008-09-20T22:39:41.880
> 
> 标签：c, memory, pointers

`temp2`,`temp1`是指向某个结构 x 的指针：

```
struct FunkyStruct x;
struct FunkyStruct *temp1 = &x, *temp2 = &x; 
```

现在，在执行以下几行之后：

```
temp2=temp1;
temp1=temp1->nxt; 
```

...会`temp2`并且`temp1`仍然指向相同的内存位置吗？如果不是，请解释为什么它们会有所不同。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-20T22:50:35.283

最初，`temp1`和`temp2`都包含 的内存地址`x`。

`temp2 = temp1`意思是“将值分配`temp1`给`temp2`”。由于它们开始时具有相同的值，因此该命令不执行任何操作。

该表达式的意思是“查看指向`temp1->next`的数据结构，并返回该字段的值。” 因此将 的值分配给。（当然，查找发生*在*赋值之前。） 现在将包含该字段碰巧包含的任何值。它可能与旧值相同，也可能不同。`temp1``next``temp1 = temp1->next``temp1->next``temp1`*`temp1``next`*

 ** * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T23:42:28.950

这听起来像是一个基于java背景的问题？

[障碍](https://stackoverflow.com/users/10704/dysfunctor)者给出的答案很好。

要意识到的重要一点是，在 C 中分配指针与分配整数没有什么不同。

考虑对原始代码进行以下修改：

```
 int temp1 = 1;
 int temp2;
 temp2=temp1;
 temp1=temp1 + 1; 
```

在这个 temp1 结束时为 2，temp2 为 1。

这不像在 java 中分配一个（非原始）对象，其中分配实际上分配了对对象的引用而不是值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T22:41:27.553

temp2 不会更新，但 temp1 将指向下一项。所以如果 temp1 是 0x89abcdef 并且 temp1->next 是 0x89b00000，那么在你完成之后，temp1 将是 0x89b00000 而 temp2 将是 0x89abcdef。

当然，假设您正在制作一个链接列表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-20T22:42:44.727

您并没有真正向我们提供足够的信息来回答您的问题。它们是开始指向同一个结构，还是它们都只是指向结构 x 的类型指针？如果是某个 struct x，那么 nxt 字段的定义是什么？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-20T22:43:11.433

不同的。

您已将 temp1 最初指向的地址保存到 temp2 中。然后，您更改了 temp1 所指向的内容，而不是 temp1 所指向的另一端的变量。

如果你做了

```
temp2 = temp1;
*temp1 = temp1->foo; 
```

那么 temp1 和 temp2 都将指向（相同的）修改后的变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T22:44:59.043

不，假设有像 C 中的指针。 temp2 将指向 x 的位置，而 temp1 将指向 nxt 指针指向的任何位置。通常这将是单链表的布局。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-21T07:34:07.257

最简洁的答案是不。但前提是**nxt与****temp1**和**temp2**开始时都不同。

行**temp1=temp1->nxt;** 有两个部分，由**=**运算符分隔。这些是：

*   右侧的**temp1->nxt**查找**temp1**指向的结构并获取**nxt**变量的值。这是一个指针（新的内存位置）。
*   然后使用右侧的指针来更新**temp1**的值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-21T03:47:57.550

x（因此 x.nxt）将被初始化为未指定的值，具体取决于编译器、编译器选项和运行时环境的组合。temp1 和 temp2 都将指向 x（在 temp1=temp2 之前和之后）。然后 temp1 将被分配任何值 x.nxt 。

最终答案：0 < Pr(temp1 == temp2) << 1，因为 temp1 == temp2 iff x.nxt == &x。

# project-planning - 您如何对编码任务进行非常快速（和肮脏）的估计？

> ID：109666
> 
> 赞同：11
> 
> 时间：2008-09-20T22:47:22.470
> 
> 标签：project-planning, estimation

所以你刚刚被老板放在了现场。您有 15 分钟的时间来估算添加一些新功能的信封背面。你的老板（幸运的是）认识到你无法在那个时候提供准确的估计，所以期待一些正确数量级的东西。

问题是你如何在时间范围内给出一个精确到一个数量级的估计？

* * *

请注意，这是一个快速而肮脏的估计，而不是像[这样的问题所期望的](https://stackoverflow.com/questions/14279/how-to-estimate-the-length-of-a-programming-task#14289)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-20T22:55:22.043

将手指放在嘴里，舔舐，在空气中挥动，根据过去的经验编一个数字。然后加倍。

真的，重要的是经验。你想象任务需要你做什么，你知道你需要多长时间才能完成。将意外物品加倍。这也是为什么您从不向初级程序员询问此类估算的原因。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-20T22:54:41.327

最好的方法是尝试快速分解所有主要子组件，例如

1.  更新数据模型脚本（2 个表中的 3 个项目）
2.  更改输入屏幕（3 个新输入）
3.  检查输入（3 个新输入）
4.  更新数据。
5.  显示结果等...
6.  构建单元测试

对每一项进行粗略的猜测，如果你想不出一个至少需要 2 小时，因为即使是最简单的项目也可能需要至少一个小时，但 2x 将允许不确定性。

至少你会想到你必须做的所有项目，这样它就会按照要求的数量级进行。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-20T22:53:56.057

回想一下您过去完成的类似任务以及它们花费了您多长时间。

如果您之前没有做过类似的事情，请尝试将任务分解为子任务，然后将每个子任务进一步分解，直到没有留下任何子任务，这听起来像最天真的原型需要超过 1-2 天的时间方法; 如果您无法将估计超过 3 天的任务分开，这通常意味着您并不真正了解执行该任务所涉及的内容；做一些快速的研究。一旦所有的东西都被分解得足够多，就把它加起来，把结果加倍，然后把它作为你的估计。

如果您不知道如何解决问题足以完成上述工作，并且您的老板正在扼杀您的脖子，因此您觉得自己无法在那里进行研究，然后尝试给您的老板估计需要多长时间将带您进行所需的研究，以充分了解问题，从而给他一个正确的估计。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-20T22:55:27.363

我无法想象我真的无法做出估计的情况——更常见的情况是，我可以想象多种场景，这将导致项目的时间框架大不相同，具体取决于可以合理裁剪的各种事情向上。而且我不想撒谎——你能对你的老板做的最糟糕的事情就是编造一些东西。

所以我解释了每一种可能性。当然，这只适用于理解力强的上司，但如果你的上司无知或愚蠢到拒绝听完整的解释，你就有其他问题了。

例如，对于最近的一个案例，我是这样做的，实际上我必须这样做。

我工作的视频编码器 x264 实现了一种非常原始的隔行编码形式，之所以选择它，只是因为它很容易实现。我们想实现这种编码的完整形式，但我不知道有多少简化版本的假设在这种情况下会失败。

所以我仔细考虑了可能需要改变的各个层面，并做出了一个范围的估计——好吧，充其量，它可能已经接近工作了，但这是值得怀疑的。最坏的情况是有一大堆东西需要改变。所以，我告诉我的老板，最好在这里假设最坏的情况，因为规范非常复杂，尽管不知道任何复杂性，我怀疑由于程序中主要缺乏相关代码，几乎没有这种复杂性实际上已经实现。最后，我是对的——所需的更改最终变得相当复杂，他们将项目外包给了一个在 H.264 交错编码的复杂性方面拥有更多专业知识的承包商。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-06T21:43:25.067

除了必要的细分之外：我从实用程序员那里学到的一条建议是以周为单位表达超过 15 天的估计，以月为单位表达超过 8 周的估计；以便单位反映估计的准确性。在 30 周内要非常小心。

您还可以根据您已经完成的类似任务做出估计。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-20T23:16:48.420

如果您真的需要*非常快速*的估算，您可以对每个任务进行 1-2 天或更短的工作分解结构，然后通过提供最小和最大估算值来估算每个任务。

最小值和最大值之和指定整个任务的间隔。这为您的老板提供了有关风险的信息，这总是非常有用的。

您将获得一些间隔，例如 12-15 天或 5-30 天 - 这比 16 天而不是提到的间隔更有用。

[Steve McConnel Software Estimation: Demystifying the Black Art 的](https://rads.stackoverflow.com/amzn/click/com/0735605351)好书对你很有用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-01T22:17:18.353

**想一个数字，把它加倍，然后再加倍（即四倍于你脑海中出现的第一个数字）**

当老板说“完成项目需要多长时间”时，他指的是项目完成并实时部署给用户的时间。程序员（自然）只会考虑完成编程所需的时间（实际输入问题解决方案的时间），因此您通常会低估。

*经验法则是：*

“第一个数字”是您认为根据刚才描述的任务范围完成任务所需的天数。（当然，你还没有被告知一切）。

第一个倍数是在给老板第一个演示/原型后重新编码所需的额外时间，他说“很好，很好。但是你能添加......”

第二个倍数是将重新编码到正确的生产标准所需的时间。

第三个倍数是测试、文档和部署的时间，以及你需要做的所有其他管理工作才能真正把事情拿出来并投入使用。

第四倍数是您对上述情况的意外情况。

这应该给你一个安全的估计。当然，您应该坚持进行更彻底的计划和估算工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-21T02:15:24.137

因素 #1 是未知数，你是对的，你不可能全部知道。但是，您通常会知道一些当时没有人可以为您回答的主要问题。

因素 #2 是手头的工具和资源的感知难度和可用性。

* * *

结果 = 大约是您估计的两倍

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-21T07:45:53.390

*   将任务分解为多个部分并为每个部分分配时间

*   以每天不少于1/2的单位工作。这将防止微调度

*   项目估算的最大问题是低估。如果您对任务非常了解并且几乎可以看到代码，则将任务加权 1。如果存在一些不确定性或任务需要未知技术，则将其乘以更高的因子，具体取决于不确定性的程度

*   不要太担心每个部分的准确性。错误往往会抵消，因为唯一真正重要的是总持续时间

采用乐观的时间尺度并将其乘以 PI 始终是一个很好的旧备用方案。比它应该更频繁地工作！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T22:58:26.937

我最近一直在阅读[Agile Estimating and Planning](https://rads.stackoverflow.com/amzn/click/com/0131479415)，并且推荐得还不够。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-20T23:02:24.913

如果我被迫提供估计而没有足够的时间来正确调查手头的主题，我往往会严重高估。修复几乎总是比我想象的要困难。如果我认为某件事需要一天的时间，那么我会说两天。如果我说某件事需要一个小时，那么我会说一天。我试图用这些评论来说明的是，除了拼写错误等最平凡的任务之外，即使是很小的代码更改也可能会爆发一整天。对于我认为可能需要一天或更长时间的任何事情，我将估计值加倍。我知道这可能很难做到。管理层想要小数字。您想在其他开发人员面前显得聪明而有能力。另见[斯科蒂工厂](http://c2.com/cgi/wiki?ScottyFactor)。

即使您有 QA 团队成员来测试您的代码，您也必须记住，测试代码也是您的工作。确保将其纳入任何估计。这是我看到很多开发人员在他们的估算过程中遗漏的东西。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-20T23:19:17.383

我通常将任务分解成几部分，但我不会在小于半天的时间段内估计这类事情。只要故障后该功能至少有 5 或 6 个部分，我发现错误大部分会自行平衡（某些任务需要不到一个小时，等等）

当然，一定程度的舒适度所需的最小时间划分和件数需要根据问题领域而有所不同——至少 5 或 6 个半天的块似乎适合我最近被问到的东西，但这需要每隔几个月进行一次审查。

当我被要求代表其他人进行估算时，我会更加抗拒，并使用慷慨的填充系统遵循类似的做法（上面提到的“加倍并​​添加 x”可能是一个很好的近似值）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-30T14:07:18.197

“六到八周”的效果非常好，另一件有效的事情是基于数据模型。

想象一下应用程序所需的数据库表（或类似表）的数量，乘以您需要为每个表编写模型、CRUD、UI 等的天数，然后在上面增加 30% 到 50% 的时间那。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-06T22:06:20.840

要以正确的数量级进行估计，您需要：

*   没有为想要的功能引入新技术或框架；
*   将您对纯开发时间和开发人员（以及客户和测试人员）可用性的估计分开。
*   获得有关您先前估计的反馈；
*   您安全估计范围内的特征大小（不是 2 倍大，2 倍多的人）
*   稳定的开发团队。
*   没有项目启动开销。
*   只估计你自己做的工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-20T22:50:35.253

我个人拒绝这种事情。但后来我为自己工作，所以我不回答老板。只是一个客户，但更容易让他们理解它很难在现场做。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-20T22:52:08.807

在这样的时候，我记得麦肯齐兄弟关于转换为公制的规则：“加倍，再加上 30。”

我通常会想出我最初认为做一件事需要多快，然后加倍因为我总是低估，然后添加 30 进行测试，具体取决于我使用的单位。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-07-01T08:07:24.457

我相信答案总是“六到八周”。

# oop - IoC，你把容器放在哪里？

> ID：109668
> 
> 赞同：27
> 
> 时间：2008-09-20T22:48:01.907
> 
> 标签：oop, dependency-injection, inversion-of-control, castle-windsor

我正在将城堡温莎用于我正在从事的宠物项目。我开始注意到我需要在代码的不同位置调用 IoC 容器来创建新对象。这种对容器的依赖使我的代码更难维护。

我用过两种解决方案来解决这个问题

我尝试创建抽象工厂作为容器的包装器，我可以将其注入需要创建对象的应用程序部分。这可行但有一些缺点，因为城堡很难将自己的容器作为依赖项注入。所以我必须手动完成，这违背了 IoC 容器的全部目的。

我使用主 applicationcontroller 类来包装 IoC 容器并作为中央工厂/存储库工作。这是相当成功的，但是这个类变得太大了，就像一个中心上帝对象，几乎所有其他对象都有对它的引用。

两种解决方案都有效，但都有其缺点。所以我很好奇其他人是否有同样的问题并找到了更好的解决方案。

* * *

*编辑* 问题不在于依赖于对象B的对象A。在这里我通常只使用构造函数注入并且一切正常。有时我有类型 A 的对象需要在其生命周期内创建可变数量的其他类型 B 的对象。我不知道该怎么做。

@Blair Conrad：到目前为止，维护问题并不严重。我有一些类依赖于容器对象调用 container.Resolve<>。而且我不想让我的代码取决于我认为的基础设施。我仍在尝试，所以我注意到在从 ninject 切换到 Castle 时，我必须更改很多代码。

@花：嗯。我喜欢你的拳头解决方案。它结合了我尝试过的两种解决方案的工作原理。我想我仍然在对象方面考虑太多，而在接口/职责方面考虑得不够。我尝试了专门建造的工厂，但我想让他们在幕后使用容器来创建对象，但我还没有发现如何以干净的方式将容器 DI 转换为对象。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T09:22:12.357

请永远不要使用像 IoC.Container.Resolve 或 ContainerFactory.GetContainer 这样的静态类！

这使得代码更复杂，更难测试、维护、重用和阅读。

通常，任何单个组件或服务只有一个注入点——即构造函数（具有可选属性）。通常，您的组件或服务类不应该知道容器之类的存在。

如果您的组件确实需要在内部进行动态解析（即根据名称解析异常处理策略或工作流），那么我建议考虑[通过高度特定的提供者提供 IoC 权力](http://rabdullin.com/how-to-avoid-tight-ioc-coupling-in-non-deterministic-resolution-scenarios/)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-01T08:16:24.290

我建议您查看 Nick Blumhardt 的迷你系列。

[http://blogs.msdn.com/nblumhardt/archive/2008/12/27/container-managed-application-design-prelude-where-does-the-container-belong.aspx](http://blogs.msdn.com/nblumhardt/archive/2008/12/27/container-managed-application-design-prelude-where-does-the-container-belong.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-20T23:11:02.367

至少在我的应用程序中，依赖注入的主要好处是能够编写与上下文无关的代码。从这个角度来看，您的第二个解决方案似乎真的颠覆了 DI 可能给您带来的好处。如果“上帝对象”向引用它的每个类公开不同的接口，它可能不会太邪恶。但是如果你走那么远，我不明白你为什么不把它一直带到篮筐。

示例：您的 God 对象有一个 getFoo() 方法和一个 getBar() 方法。对象 A 需要 Foo，对象 B 需要 Bar。如果 A 只需要一个 Foo，则 Foo 应该直接注入 A 并且 A 根本不应该意识到上帝。但是如果 A 需要继续创造 Foos，那么给 A 一个对上帝的参考几乎是不可避免的。但是你可以通过缩小对上帝的提及类型来保护自己免受传递上帝的伤害。如果你让上帝实现 FooFactory 并给 A 一个对上帝实现的 FooFactory 的引用，你仍然可以在 A 中以上下文中立的方式编写代码。这增加了代码重用的机会，并增加了你对上帝的改变不会导致意想不到的副作用的信心。例如，您可以确定当从上帝那里移除 getBar() 时，A 类不会中断。

但是......如果你无论如何都要拥有所有这些接口，你可能最好编写专门构建的工厂类并将所有对象连接在一起，包括工厂，在容器中，而不是完全包装容器。容器仍然可以配置工厂。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T13:50:40.067

虽然我很欣赏“专用工厂”的明确性，甚至自己也使用它们，但在我自己的设计中，这感觉就像是代码味道，因为公共接口（小“i”）会随着新工厂和/或新 GetX 方法而不断变化对于每个实现。在阅读 Jeremy Miller 的[It's time for IoC Container Detente](http://codebetter.com/blogs/jeremy.miller/archive/2008/08/16/it-s-time-for-ioc-container-detente.aspx)之后，我怀疑泛型和注入容器本身是要走的路。

我会将 Ninject、StructureMap 或 Windsor 包装在某种 IServiceLocator 接口中，就像 Jeremy 的文章中提出的那样。然后有一个容器工厂，它只在代码中的任何位置返回一个 IServiceLocator，即使是在你最初建议的循环中也是如此。

```
IServiceLocator container = ContainerFactory.GetContainer(); 
while( keepLooping )
{
    IExample example = container.GetInstance<IExample>();
    keepLooping = example.DoWork();
} 
```

你的容器工厂总是可以返回相同的实例，你可以交换 IoC 框架，无论如何。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T07:07:58.837

[作为@flipdoubt](https://stackoverflow.com/users/470/flipdoubt)的后续行动

如果您最终使用了服务定位器类型模式，您可能需要查看[http://www.codeplex.com/CommonServiceLocator](https://github.com/unitycontainer/commonservicelocator)。它有一些可用于几个流行的 IoC 框架（windsor、structuremap）的绑定，这可能会有所帮助。

祝你好运。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-22T18:09:03.817

在这种情况下，我建议使用您提到的强类型工厂，这些工厂会被注入。这些工厂可以包装容器，但可以允许传入额外的上下文并进行额外的处理。例如，OrderFactory 上的 Create 可以接受上下文参数。

当您失去意图和上下文时，对通用服务定位器具有静态依赖是一个坏主意。当 IoC 构建一个实例时，它可以根据诸如配置文件、上下文等许多因素提供正确的依赖关系，因为它具有全局性。

CommonServiceLocator 不是为了这个目的，尽管人们可能会想使用它。CommonServiceLocator 的主要用途是用于希望跨 IoC 容器兼容的应用程序/框架。但是，使用的应用程序应该只最佳地调用一次定位器，以建立组件及其依赖关系的层次结构。永远不要再直接调用它。如果我们有某种方式来强制执行，我们就会有。在棱镜（[http://www.microsoft.com/compositewpf](http://www.microsoft.com/compositewpf)) 我们引入了一个 IContainerFacade 来构建模块。那是一个服务定位器，虽然是一个低级别的。回想起来，我们可能应该创建一个 ModuleFactory 或其他东西并使用 IContianerFacade 来获取它，然后使用该解析模块而不是直接进入 Facade。后见之明是 20 / 20。虽然它并没有真正影响事物，但它的水平已经足够低了。

在 CSL 上，我们一直在努力命名，因为它可能会导致混淆。最后我们决定使用 CSL，因为从技术上讲，接口不适合你做 DI。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-23T00:56:58.197

That's a really comon problem. Windsor's built in [Typed Factory Facility](http://docs.castleproject.org/Windsor.Typed-Factory-Facility-interface-based-factories.ashx) will give you the benefits of using a factory, without the mentioned drawbacks.

# python - Python 信号问题：如果在执行另一个信号处理程序期间收到 SIGQUIT，则 SIGQUIT 处理程序会延迟执行？

> ID：109705
> 
> 赞同：9
> 
> 时间：2008-09-20T23:02:35.333
> 
> 标签：python, signals

下面的程序非常简单：它每半秒输出一个点。如果它收到一个**SIGQUIT**，它会继续输出 10 个**Q** s。如果它收到一个**SIGTSTP** *( `Ctrl`- `Z`)*，它会输出 10 个**Z**。

如果它在打印**Q s 时收到****SIGTSTP** ，它将在完成 10 个**Q** s 后打印 10 个**Z** s。这是一件好事。

 ******但是，如果它在打印**Z s 时收到****SIGQUIT**，则无法在它们之后打印**Q** s。相反，它仅在我通过 KeyboardInterrupt 手动终止执行后才将它们打印出来。我希望**Q s 在****Z** s之后立即打印。

 ******这发生在 Python2.3 中。

我究竟做错了什么？

```
#!/usr/bin/python

from signal import *
from time import sleep
from sys import stdout

def write(text):
    stdout.write(text)
    stdout.flush()

def process_quit(signum, frame):
    for i in range(10):
        write("Q")
        sleep(0.5)

def process_tstp(signum, frame):
    for i in range(10):
        write("Z")
        sleep(0.5)

signal(SIGQUIT, process_quit)
signal(SIGTSTP, process_tstp)

while 1:
    write('.')
    sleep(0.5) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-20T23:39:49.287

您更大的问题是阻塞信号处理程序。

这通常是不鼓励的，因为它会导致奇怪的时序条件。但这并不是问题的原因，因为由于您选择了信号处理程序，您容易受到时序条件的影响。

无论如何，这里是如何通过仅在处理程序中设置标志并让主 while 循环来完成实际工作来至少最小化计时条件。代码后描述了为什么您的代码行为异常的解释。

```
#!/usr/bin/python

from signal import *
from time import sleep
from sys import stdout

print_Qs = 0
print_Zs = 0

def write(text):
    stdout.write(text)
    stdout.flush()

def process_quit(signum, frame):
     global print_Qs
     print_Qs = 10

def process_tstp(signum, frame):
     global print_Zs
     print_Zs = 10

signal(SIGQUIT, process_quit)
signal(SIGTSTP, process_tstp)

while 1:
    if print_Zs:
        print_Zs -= 1
        c = 'Z'
    elif print_Qs:
        print_Qs -= 1
        c = 'Q'
    else:
        c = '.'
    write(c)
    sleep(0.5) 
```

无论如何，这就是发生的事情。

SIGTSTP 比 SIGQUIT 更特殊。

SIGTSTP 在其信号处理程序运行时屏蔽其他信号，使其不被传递。当内核传递 SIGQUIT 并看到 SIGTSTP 的处理程序仍在运行时，它只是将其保存以备后用。一旦另一个信号通过传递，例如当你`CTRL`+时的 SIGINT `C`（又名 KeyboardInterrupt），内核会记住它从未传递过 SIGQUIT 并现在传递它。

您会注意到，如果您在主循环中更改`while 1:`为`for i in range(60):`并再次执行您的测试用例，程序将退出而不运行 SIGTSTP 处理程序，因为退出不会重新触发内核的信号传递机制。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T23:49:18.763

在 Linux 2.6.24 上的 Python 2.5.2 上，您的代码完全按照您描述所需结果的方式工作（如果在处理前一个信号的同时接收到一个信号，则在第一个信号完成后立即处理新信号）。

在 Linux 2.6.16 上的 Python 2.4.4 上，我看到了您描述的问题行为。

我不知道这是由于 Python 还是 Linux 内核的变化。

# linux - Linux 内核中可能/不太可能的宏是如何工作的，它们有什么好处？

> ID：109710
> 
> 赞同：411
> 
> 时间：2008-09-20T23:04:16.813
> 
> 标签：linux, gcc, linux-kernel, likely-unlikely

我一直在研究 Linux 内核的某些部分，发现了这样的调用：

```
if (unlikely(fd < 0))
{
    /* Do something */
} 
```

或者

```
if (likely(!err))
{
    /* Do something */
} 
```

我找到了它们的定义：

```
#define likely(x)       __builtin_expect((x),1)
#define unlikely(x)     __builtin_expect((x),0) 
```

我知道它们是为了优化，但它们是如何工作的？使用它们可以减少多少性能/尺寸？至少在瓶颈代码中（当然是在用户空间中）是否值得麻烦（并且可能失去可移植性）。

* * *

## 回答 #1

> 赞同：381
> 
> 时间：2008-09-20T23:09:26.847

它们暗示编译器发出指令，这些指令将导致分支预测有利于跳转指令的“可能”一侧。这可能是一个巨大的胜利，如果预测正确，则意味着跳转指令基本上是免费的，并且将占用零个周期。另一方面，如果预测错误，则意味着需要刷新处理器流水线，并且可能会花费几个周期。只要预测在大多数情况下都是正确的，这往往对性能有好处。

像所有这样的性能优化一样，您应该只在进行广泛的分析后才进行它，以确保代码确实处于瓶颈中，并且可能考虑到微观性质，它正在一个紧密的循环中运行。一般来说，Linux 开发人员非常有经验，所以我想他们会这样做。他们并不真正关心可移植性，因为他们只针对 gcc，并且他们对他们希望它生成的程序集有一个非常接近的想法。

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2015-06-30T08:56:40.753

**让我们反编译看看 GCC 4.8 用它做了什么**

**没有`__builtin_expect`**

```
#include "stdio.h"
#include "time.h"

int main() {
    /* Use time to prevent it from being optimized away. */
    int i = !time(NULL);
    if (i)
        printf("%d\n", i);
    puts("a");
    return 0;
} 
```

使用 GCC 4.8.2 x86_64 Linux 编译和反编译：

```
gcc -c -O3 -std=gnu11 main.c
objdump -dr main.o 
```

输出：

```
0000000000000000 <main>:
   0:       48 83 ec 08             sub    $0x8,%rsp
   4:       31 ff                   xor    %edi,%edi
   6:       e8 00 00 00 00          callq  b <main+0xb>
                    7: R_X86_64_PC32        time-0x4
   b:       48 85 c0                test   %rax,%rax
   e:       75 14                   jne    24 <main+0x24>
  10:       ba 01 00 00 00          mov    $0x1,%edx
  15:       be 00 00 00 00          mov    $0x0,%esi
                    16: R_X86_64_32 .rodata.str1.1
  1a:       bf 01 00 00 00          mov    $0x1,%edi
  1f:       e8 00 00 00 00          callq  24 <main+0x24>
                    20: R_X86_64_PC32       __printf_chk-0x4
  24:       bf 00 00 00 00          mov    $0x0,%edi
                    25: R_X86_64_32 .rodata.str1.1+0x4
  29:       e8 00 00 00 00          callq  2e <main+0x2e>
                    2a: R_X86_64_PC32       puts-0x4
  2e:       31 c0                   xor    %eax,%eax
  30:       48 83 c4 08             add    $0x8,%rsp
  34:       c3                      retq 
```

内存中的指令顺序没有改变：首先是`printf`然后`puts`是`retq`返回。

**和`__builtin_expect`**

现在替换`if (i)`为：

```
if (__builtin_expect(i, 0)) 
```

我们得到：

```
0000000000000000 <main>:
   0:       48 83 ec 08             sub    $0x8,%rsp
   4:       31 ff                   xor    %edi,%edi
   6:       e8 00 00 00 00          callq  b <main+0xb>
                    7: R_X86_64_PC32        time-0x4
   b:       48 85 c0                test   %rax,%rax
   e:       74 11                   je     21 <main+0x21>
  10:       bf 00 00 00 00          mov    $0x0,%edi
                    11: R_X86_64_32 .rodata.str1.1+0x4
  15:       e8 00 00 00 00          callq  1a <main+0x1a>
                    16: R_X86_64_PC32       puts-0x4
  1a:       31 c0                   xor    %eax,%eax
  1c:       48 83 c4 08             add    $0x8,%rsp
  20:       c3                      retq
  21:       ba 01 00 00 00          mov    $0x1,%edx
  26:       be 00 00 00 00          mov    $0x0,%esi
                    27: R_X86_64_32 .rodata.str1.1
  2b:       bf 01 00 00 00          mov    $0x1,%edi
  30:       e8 00 00 00 00          callq  35 <main+0x35>
                    31: R_X86_64_PC32       __printf_chk-0x4
  35:       eb d9                   jmp    10 <main+0x10> 
```

( `printf`compiled to `__printf_chk`) 被移到函数的最后，之后`puts`返回以改进分支预测，如其他答案所述。

所以它基本上是一样的：

```
int main() {
    int i = !time(NULL);
    if (i)
        goto printf;
puts:
    puts("a");
    return 0;
printf:
    printf("%d\n", i);
    goto puts;
} 
```

此优化未使用`-O0`.

但是祝你好运，编写一个运行`__builtin_expect`比没有运行更快的示例，[这些天 CPU 真的很聪明](https://stackoverflow.com/a/1851905/895245)。我的天真尝试[就在这里](https://github.com/cirosantilli/assembly-cheat/tree/ba3b76cd4530268d4c34e29c354d399c0d8552fc/compiler-generated/gcc/interactive)。

**C++20`[[likely]]`和`[[unlikely]]`**

C++20 已经标准化了那些 C++ 内置函数：[如何在 if-else 语句中使用 C++20 的可能/不太可能属性](https://stackoverflow.com/questions/51797959/how-to-use-c20s-likely-unlikely-attribute-in-if-else-statement)他们很可能（双关语！）做同样的事情。

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2008-09-20T23:14:39.580

这些是向编译器提示分支可能走向的宏。如果可用，宏会扩展到 GCC 特定的扩展。

GCC 使用这些来优化分支预测。例如，如果您有以下内容

```
if (unlikely(x)) {
  dosomething();
}

return x; 
```

然后它可以将这段代码重组为更像：

```
if (!x) {
  return x;
}

dosomething();
return x; 
```

这样做的好处是，当处理器第一次进行分支时，会有很大的开销，因为它可能已经推测性地加载和执行更前面的代码。当它确定它将采用分支时，它必须使该分支无效，并从分支目标开始。

大多数现代处理器现在都有某种分支预测，但这仅在您之前经历过分支并且分支仍在分支预测缓存中时才有帮助。

在这些场景中，编译器和处理器可以使用许多其他策略。您可以在 Wikipedia 上找到有关分支预测器如何工作的更多详细信息：[http ://en.wikipedia.org/wiki/Branch_predictor](http://en.wikipedia.org/wiki/Branch_predictor)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-20T23:11:53.267

它们使编译器在硬件支持的地方发出适当的分支提示。这通常只是意味着在指令操作码中旋转几位，因此代码大小不会改变。CPU 将开始从预测的位置获取指令，并在到达分支时刷新管道并在发现错误时重新开始；在提示正确的情况下，这将使分支更快——确切的速度取决于硬件；而这对代码性能的影响程度将取决于时间提示正确的比例。

例如，在 PowerPC CPU 上，一个未提示的分支可能需要 16 个周期，正确提示的一个 8 周期和一个错误提示的 24 个周期。在最内层循环中，良好的提示可以产生巨大的差异。

可移植性并不是真正的问题——大概定义在每个平台的标题中；对于不支持静态分支提示的平台，您可以简单地将“可能”和“不太可能”定义为空。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-11-23T13:22:05.497

```
long __builtin_expect(long EXP, long C); 
```

这个结构告诉编译器表达式 EXP 最有可能的值为 C。返回值是 EXP。 **__builtin_expect**旨在用于条件表达式。在几乎所有情况下，它将在布尔表达式的上下文中使用，在这种情况下，定义两个辅助宏会更方便：

```
#define unlikely(expr) __builtin_expect(!!(expr), 0)
#define likely(expr) __builtin_expect(!!(expr), 1) 
```

然后可以将这些宏用作

```
if (likely(a > 1)) 
```

参考：[https ://www.akkadia.org/drepper/cpumemory.pdf](https://www.akkadia.org/drepper/cpumemory.pdf)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-20T23:19:44.153

（一般性评论 - 其他答案涵盖了细节）

没有理由因为使用它们而失去可移植性。

您始终可以选择创建一个简单的零效应“内联”或宏，以允许您使用其他编译器在其他平台上进行编译。

如果您在其他平台上，您将无法从优化中受益。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-01-27T20:59:36.603

根据[Cody](https://stackoverflow.com/users/4977/cody-brocious)的评论，这与 Linux 无关，而是对编译器的提示。会发生什么取决于架构和编译器版本。

Linux 中的这一特殊功能在驱动程序中有些误用。正如[osgx在](https://stackoverflow.com/users/196561/osgx)[hot attribute](https://stackoverflow.com/questions/15028990/semantics-of-gcc-hot-attribute)的语义中指出的那样，在块中调用的任何函数`hot`或`cold`函数都可以自动提示该条件可能与否。例如，`dump_stack()`被标记`cold`所以这是多余的，

```
 if(unlikely(err)) {
     printk("Driver error found. %d\n", err);
     dump_stack();
 } 
```

的未来版本`gcc`可能会根据这些提示选择性地内联函数。也有人建议它不是`boolean`，而是*最有可能*的分数等。通常，应该首选使用一些替代机制，如`cold`. 除了热路径之外，没有理由在任何地方使用它。编译器在一种架构上所做的事情在另一种架构上可能完全不同。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-07T02:27:04.490

在许多 linux 发行版中，您可以在 /usr/linux/ 中找到 complier.h，您可以简单地包含它以供使用。另一种观点是，不太可能（）比可能（）更有用，因为

```
if ( likely( ... ) ) {
     doSomething();
} 
```

它也可以在许多编译器中进行优化。

顺便说一句，如果您想观察代码的详细行为，您可以简单地执行以下操作：

> gcc -c test.c objdump -d test.o > obj.s

然后，打开obj.s，就可以找到答案了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-20T23:07:35.493

它们是编译器在分支上生成提示前缀的提示。在 x86/x64 上，它们占用一个字节，因此每个分支最多会增加一个字节。至于性能，它完全取决于应用程序——在大多数情况下，处理器上的分支预测器会忽略它们，这些天。

编辑：忘记了一个他们实际上可以提供帮助的地方。它可以允许编译器重新排序控制流图，以减少为“可能”路径采用的分支数量。这可以显着改善您检查多个退出案例的循环。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-20T23:08:15.243

这些是供程序员使用的 GCC 函数，用于向编译器提示在给定表达式中最可能出现的分支条件。这允许编译器构建分支指令，以便在最常见的情况下执行最少数量的指令。

如何构建分支指令取决于处理器架构。

# c# - 具有复杂逻辑的多个构造函数

> ID：109717
> 
> 赞同：6
> 
> 时间：2008-09-20T23:06:48.647
> 
> 标签：c#, .net

在 C# 中，如果您有多个构造函数，则可以执行以下操作：

```
public MyClass(Guid inputId, string inputName){
    // do something
}

public MyClass(Guid inputId): this(inputId, "foo") {} 
```

这个想法当然是代码重用。但是，当需要一些复杂的逻辑时，最好的方法是什么？说我想要这个构造函数：

```
public MyClass(MyOtherClass inputObject)
{
    Guid inputId = inputObject.ID;
    MyThirdClass mc = inputObject.CreateHelper();
    string inputText = mc.Text;
    mc.Dispose();
    // Need to call the main Constructor now with inputId and inputText
 } 
```

这里需要注意的是，我需要创建一个**必须**在使用后处理的对象。（澄清：不是立即，但我必须调用 Dispose() 而不是等待垃圾收集）

但是，如果我在重载的构造函数中添加一些代码，我看不到再次调用基本构造函数的方法。有没有办法从重载的构造函数中调用基本构造函数？

或者是否可以使用

```
public MyClass(MyOtherClass inputObject): this(inputObject.ID,
                                               inputObject.CreateHelper().Text) 
{} 
```

这会自动处理从 CreateHelper() 生成的对象吗？

**编辑：**到目前为止谢谢。两个问题：我不控制 MyOtherClass 并且我没有扩展方法（仅限 .NET 3.0...）。不过，我确实控制了自己的类，并且由于我刚刚开始编写它，因此如果有一个好的方法，我可以毫无问题地重构构造函数。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-20T23:13:11.690

用于解决此问题的最常见模式是使用构造函数调用的 Initialize() 方法，但在您刚刚给出的示例中，添加您调用的静态方法（如下面的代码）就可以了。

```
public MyClass(MyOtherClass inputObject): this(inputObject.ID, GetHelperText(inputObject) {}

private static string GetHelperText(MyOtherClass o)
{
   using (var helper = o.CreateHelper())
      return helper.Text;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-20T23:17:34.080

我看不出有任何理由相信在构造函数中创建对象会自动处置该对象。是的，您的对象将立即超出范围并可用于垃圾收集，但这肯定与被处置不同。

确实没有一种很好的方法可以完全按照您的意愿去做，但是整个事情感觉就像它可以从一些重构中受益。当我发现自己试图向后弯腰以创建构造函数重载时，通常在我自己的代码中就是这种情况。

如果您可以控制 MyOtherClass，为什么不通过添加处理 dispose 的 getter 方法来简化对该文本属性的访问：

```
public class MyOtherClass
{
     //...
     public string GetText()
     {
        using (var h = CreateHelper())
             return h.Text;
     }
} 
```

如果你不控制 MyOtherClass 你可以使用扩展方法

```
public static class MyOtherClassExtensions
{
    public static string GetText(this MyOtherClass parent)
    {
        using(var helper = parent.CreateHelper())
        {
           return helper.Text;
        }
    }
} 
```

然后，当然，在您的构造函数中，您可以安全地调用

```
public MyClass(MyOtherClass inputObject): this(inputObject.ID, inputObject.GetText()) {} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T23:12:51.907

该对象只会在垃圾收集运行时自动释放。如果您希望 dispose 在超出范围后立即运行，则应使用`using`块：

```
using (MyThirdClass mc = inputObject.CreateHelper())
{
  // do something with mc
} 
```

这实际上更多是风格问题，而不是您所遇到问题的核心。

# .net - 用 .NET 编写的单元测试 COM

> ID：109719
> 
> 赞同：3
> 
> 时间：2008-09-20T23:08:00.220
> 
> 标签：.net, unit-testing, com

有没有办法从 .NET 对 COM 可见的 .NET 程序集进行单元测试（而不是通过直接的 .NET 程序集引用）？当我在我的测试项目中添加对 .NET 中的 COM 组件的引用时，它会抱怨。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T23:34:36.380

总是有[vbunit](http://www.vbunit.com/)。单元测试 vb 代码（vb 经典 / VB6）和 com 对象就是它的作用。

# virtualization - 如何在 Hyper-V 中分支虚拟服务器？

> ID：109731
> 
> 赞同：0
> 
> 时间：2008-09-20T23:14:02.280
> 
> 标签：virtualization, hyper-v

我们在开发环境中广泛使用 Hyper-V。每个开发人员都有自己的虚拟服务器，然后我们有一堆构建、测试、研发和暂存的虚拟服务器。

是否有任何记录或最佳实践方法可以在 Hyper-V 中复制虚拟机？

我真正想做的是将一台机器从一个快照中分离出来，并拥有多个虚拟机，它们都在一个共同的根机器快照下滚动。

我不介意必须运行一些工具或必须重新加入域，我只希望能够从现有快照中生成新机器。

这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T02:23:29.500

我认为真正的问题是网络上的服务器重复 - 再加上虚拟服务器的任何脱机副本都可能遭受的邪恶 kerberos-keys-getting-out-of-date 问题。

我建议创建一个 SysPreped 映像作为基础，然后从中创建多台机器。我不认为分支服务器是非常明智的（至少不在同一个网络上）。

否则，我只需将 VHD 复制并粘贴到新路径并为每个分支创建一个新服务器 - 将它们保存在自己的网络空间（和 IP 范围）中。

# database - 设计网站内容管理系统时要考虑的突出问题和问题

> ID：109736
> 
> 赞同：0
> 
> 时间：2008-09-20T23:16:59.247
> 
> 标签：database, database-design

我正在设计我的网站并且很好奇，在我撕掉别人的想法之前，在设计数据库时应该提出哪些突出的考虑和问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-20T23:24:32.643

我认为最重要的问题是，“你为什么要这样做（CMS，而不是网站）？” 这是一个很好的基础。除非您有一些真正创新的想法和对如何完成它的独特见解……并且您的问题表明您可能没有……选择现有解决方案可能会为您提供更好的服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T03:29:24.240

在 99% 的情况下，编写 CMS 只是忙于重新发明轮子。那里有很多开源 CMS，我几乎可以保证您可以找到适合您需求的一个。

也就是说，如果您仍然决心编写自己的代码，我只会编写您需要的功能。编写 CMS*可能是*一项非常简单的任务。但它是可能成为重叠、未使用功能的令人费解的噩梦的事情之一。只写你需要的，你可以根据需要添加功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-21T03:17:25.970

这只是我的想法：

*   内容组织应该是您的主要关注点之一。您将如何组织所有不同的内容？
*   安全，什么级别？您是否只需要确保编辑任何内容的能力？某些内容？观看内容怎么样，是否需要以任何方式保护？
*   内容的版本控制？
*   多种语言？
*   什么样的内容？简单的文字？图片？视频？博客帖子？

这至少应该让你开始朝着正确的方向思考。

# java - 使用 Java 更新软件更新的后端数据库

> ID：109746
> 
> 赞同：1
> 
> 时间：2008-09-20T23:19:56.277
> 
> 标签：java, database, jdbc, alter-table

使用哪个工具/库可以更新现有的数据库结构。在更新软件时，还需要更改数据库。因为可以有不同版本的软件，它应该将当前状态与数据库的目标状态进行比较。它应该：

*   添加表格列，用默认值填充它。
*   删除表列
*   更改列的数据类型，例如 varchar(30) --> varchar(40)
*   添加/删除索引
*   添加/更改/删除视图
*   更新表中的一些数据
*   ...

它应该支持 DBMS：

*   微软 SQL 服务器 2000 - 2008
*   甲骨文服务器 8 - 11
*   MySQL

因为我们的软件设置和应用程序在 Java 中运行，所以它也必须在 Java 中运行。我们可以使用什么？

理想情况下，它会扫描我们的开发并将其保存在 XML 文件中。然后我们可以添加一些数据修改SQL命令。然后它可以通过更新设置在客户端运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T01:16:25.263

查看[Liquibase](http://www.liquibase.org/)。数据库迁移工具，例如[dbmigrate](http://code.google.com/p/dbmigrate/)，也可能值得一试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T23:39:30.987

我们正在使用[自动补丁。](http://autopatch.sourceforge.net/)它工作得很好。

它允许将 sql 补丁、数据补丁和 java 补丁全部应用于您的 sql 数据库。

# .net - 创建闪亮的图形/光泽效果

> ID：109753
> 
> 赞同：8
> 
> 时间：2008-09-20T23:22:30.903
> 
> 标签：.net, image

我想以编程方式在图像上创建光泽效果，有点像 Web 在更新到 2.0 Beta 时采用的受 Apple 启发的设计。

本质上是这样的：

[示例图标 http://nhc.hcmuns.googlepages.com/web2_icons.jpg](http://nhc.hcmuns.googlepages.com/web2_icons.jpg)

现在，我在这里看到了两种方法：我创建了一个具有光泽效果的 Alpha 通道的图像，然后我将输入和光泽 Alpha 图标组合起来创建它。

第二种方法：在代码中创建 Alpha Gloss Image，然后将其与输入图形合并。

我更喜欢第二种解决方案，但我不是一个图形人，我不知道创建这种效果的算法是什么。有人可以给我一些指示*我实际上在这里寻找什么吗？有没有名字的“光泽算法”？甚至已经实现了.net？

*不，不是[那些类型](http://xkcd.com/138/)的指针。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-21T00:19:14.930

谢谢你，德文！这是我的 C# 代码，用于实现您的建议。它工作得很好。将其变成社区拥有的 Wiki 帖子，如果有人喜欢添加一些代码，请随时编辑。

![例子](https://i.stack.imgur.com/bUQE6.jpg)

（示例使用的 Alpha 和曝光值与下面的代码不同）

```
Image img = Image.FromFile("rss-icon.jpg");
pictureBox1.Image = AddCircularGloss(img, 30,25,255,255,255);

public static Image AddCircularGloss(Image inputImage, int exposurePercentage, int transparency, int fillColorR, int fillColorG, int fillColorB)
{
    Bitmap outputImage = new Bitmap(inputImage);
    using (Graphics g = Graphics.FromImage(outputImage))
    {
        using (Pen p = new Pen(Color.FromArgb(transparency, fillColorR, fillColorG, fillColorB)))
        {
            // Looks jaggy otherwise
            g.SmoothingMode = SmoothingMode.HighQuality;
            g.CompositingQuality = CompositingQuality.HighQuality;
            int x, y;

            // 3 * Height looks best
            int diameter = outputImage.Height * 3;
            double imgPercent = (double)outputImage.Height / 100;
            x = 0 - outputImage.Width;

            // How many percent of the image to expose
            y = (0 - diameter) + (int)(imgPercent * exposurePercentage);
            g.FillEllipse(p.Brush, x, y, diameter, diameter);
        }
    }
    return outputImage;
} 
```

（根据 John 的建议进行了更改。但我无法处理 Bitmap，这必须由函数的调用者完成）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-20T23:34:25.913

我可以用图形术语来解释这种效果。

1.  创建一个大约 3* 图标大小的图像。

2.  在此图像中，创建一个圆圈，其中（图标的高度）< 半径 < 2*（图标的高度）。

3.  用 10% 的 alpha 混合/透明度（到白色）填充圆圈。

4.  将该圆形图像裁剪为与您的图标大小相同的新图像，其中圆形的中心位于查看区域之外，但向上是较小图像高度的 1/2。

如果然后将此图像叠加到原始图标上，效果应该类似于上面的图标。如果您热衷于此，它应该可以使用 imagemagick，或者您可以根据要使用的语言选择其中一种图形 API。从上面的步骤来看，它应该很容易以编程方式进行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-21T10:17:17.473

响应 C# 代码……总的来说，在成像方面做得很好。过去，我不得不对我的一些应用程序做类似的事情。

但是，有一条建议：.NET 中的所有图形对象都基于 Windows GDI+ 原语。这意味着这些对象需要正确处理以清理它们的非内存资源，就像文件句柄或数据库连接一样。您需要稍微调整代码以正确支持它。

所有的 GDI+ 对象都实现了 IDisposable 接口，使它们在 using 语句中起作用。考虑重写您的代码，类似于以下内容：

```
// Experiment with this value
int exposurePercentage = 40;

using (Image img = Image.FromFile("rss-icon.jpg"))
{
    using (Graphics g = Graphics.FromImage(img))
    {    
        // First Number = Alpha, Experiment with this value.
        using (Pen p = new Pen(Color.FromArgb(75, 255, 255, 255)))
        {
            // Looks jaggy otherwise
            g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;

            int x, y;

            // 3 * Height looks best
            int diameter = img.Height * 3;
            double imgPercent = (double)img.Height / 100;
            x = 0 - img.Width;

            // How many percent of the image to expose
            y = (0 - diameter) + (int)(imgPercent * exposurePercentage);

            g.FillEllipse(p.Brush, x, y, diameter, diameter);

            pictureBox1.Image = img;
        }
    }
} 
```

（请记住，与我的大多数示例不同，我没有机会编译和测试它......这更多的是作为构建代码以确保没有资源泄漏的示例，而不是作为成品. 无论如何，可能有更好的方法来抽象/构造它。强烈考虑这样做——把它扔进一个图形库 DLL 中，你可以在将来需要这些功能的任何项目中引用它！）

# ruby-on-rails - Rails ar_mailer 无法发送电子邮件

> ID：109759
> 
> 赞同：1
> 
> 时间：2008-09-20T23:26:09.067
> 
> 标签：ruby-on-rails, plugins, smtp, ar-mailer

我刚刚将应用程序切换为使用 ar_mailer，当我运行 ar_sendmail（长时间停顿后）时，出现以下错误：

```
Unhandled exception 530 5.7.0 Must issue a STARTTLS command first. h7sm16260325nfh.4 
```

我正在使用 Gmail SMTP 发送电子邮件，并且我没有更改任何刚刚安装的 ar_mailer 的 ActionMailer::Base.smtp_settings。

版本：

导轨：2.1，ar_mailer：1.3.1

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-20T23:45:45.963

在库中进行了一些挖掘，似乎如果您想使用 TLS（就像您使用 Gmail 一样），那么它会为 :tls 的 ActionMailer::Base.smtp_settings 添加一个新选项（默认为 false），您应该这样做设置为真。

安装说明中提到的关于 TLS 的唯一一件事是删除任何其他 smtp_tls 文件，但我不需要 tls 选项来工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-12T04:40:47.360

也许你使用 Ruby 版本 1.8.7

你不需要`smtp_tls`以前的。

您只需要添加`enable_startls_auto`选项：

```
ActionMailer::Base.smtp_settings = {
  :enable_starttls_auto => true,
  ...
  ...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T23:28:49.810

您使用的是什么版本的 ar_mailer？1.3.1 中修复了 gmail 特定的错误，如下所示：

[http://rubyforge.org/forum/forum.php?forum_id=16364](http://rubyforge.org/forum/forum.php?forum_id=16364)

# trac - 如何设置 Trac 在子域上运行 / 使用 Lighttpd

> ID：109761
> 
> 赞同：1
> 
> 时间：2008-09-20T23:27:25.570
> 
> 标签：trac, lighttpd, fastcgi

我的 lighttpd.conf 中有以下配置：

```
$HTTP["host"] == "trac.domain.tld" {
    server.document-root = "/usr/home/daniels/trac/htdocs/"
    fastcgi.server       = ( "/trac" =>
                             ( "trac" =>
                               ( "socket" => "/tmp/trac-fastcgi.sock",
                                 "bin-path" => "/usr/home/daniels/trac/cgi-bin/trac.fcgi",
                                 "check-local" => "disable",
                                 "bin-environment" =>
                                 ( "TRAC_ENV" => "/usr/home/daniels/trac" )
                               )
                             )
                           )
} 
```

它在 trac.domain.tld/trac 运行。我怎样才能让它在 trac.domain.tld/ 上运行，所以我将拥有 trac.domain.tld/wiki、trac.domain.tld/timeline 等，而不是 trac.domain.tld/trac/wiki 等。 .

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-21T00:06:11.093

只需在 fastcgi.server 中将“/trac”更改为“/”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-21T00:04:46.027

[在此处](http://trac.lighttpd.net/trac/wiki/HowToSetupTrac)查找“对于顶级设置：...” 。

# javascript - 使用 Jaxer 时定义对象

> ID：109762
> 
> 赞同：2
> 
> 时间：2008-09-20T23:27:53.760
> 
> 标签：javascript, oop, aptana, jaxer

我一直在玩[Jaxer](https://github.com/aptana/Jaxer)，虽然这个概念很酷，但我不知道如何定义在客户端和服务器上都可用的对象。我能找到的例子都没有定义对象。

**我希望能够定义一个对象并指定哪些方法在服务器上可用，哪些在客户端可用，哪些在客户端可用但在服务器上执行（服务器代理）。** 这可以在不使用具有不同属性的三个单独`<script`的 > 标记的情况下完成吗？`runat`如果可能的话，我希望能够在同一个 js 文件中定义我的所有方法，并且用三个单独的标签在 html 中内联定义我的对象是不切实际的......

基本上我希望能够在一个 js 文件中做到这一点：

```
function Person(name) {
    this.name = name || 'default';
}
Person.runat = 'both';

Person.clientStaticMethod = function () {
    log('client static method');
}
Person.clientStaticMethod.runat = 'client';

Person.serverStaticMethod = function() {
    log('server static method');
}
Person.serverStaticMethod.runat = 'server';

Person.proxyStaticMethod = function() {
    log('proxy static method');
}
Person.proxyStaticMethod.runat = 'server-proxy';

Person.prototype.clientMethod = function() {
    log('client method');
};
Person.prototype.clientMethod.runat = 'client';

Person.prototype.serverMethod = function() {
    log('server method');
};
Person.prototype.serverMethod.runat = 'server';

Person.prototype.proxyMethod = function() {
    log('proxy method');
}
Person.prototype.proxyMethod.runat = 'server-proxy'; 
```

另外，假设我能够做到这一点，我将如何正确地将其包含到 html 页面中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T04:25:24.560

我在 Aptana 论坛（网络上不再存在）上发现了一篇帖子，指出**只能代理全局函数**……真是太糟糕了。

`<script>`但是，我一直在玩，您可以通过将代码放在包含文件中并使用带有`runat`属性的标签来控制客户端和服务器上可用的方法。

例如，我可以创建这个名为`Person.js.inc`：

```
<script runat="both">

    function Person(name) {
        this.name = name || 'default';
    }

</script>

<script runat="server">

    Person.prototype.serverMethod = function() {
        return 'server method (' + this.name + ')';
    };

    Person.serverStaticMethod = function(person) {
        return 'server static method (' + person.name + ')';
    }

    // This is a proxied function.  It will be available on the server and
    // a proxy function will be set up on the client.  Note that it must be 
    // declared globally.
    function SavePerson(person) {
        return 'proxied method (' + person.name + ')';
    }
    SavePerson.proxy = true;

</script>

<script runat="client">

    Person.prototype.clientMethod = function() {
        return 'client method (' + this.name + ')';
    };

    Person.clientStaticMethod = function (person) {
        return 'client static method (' + person.name + ')';
    }

</script> 
```

我可以使用以下方法将其包含在页面中：

```
<jaxer:include src="People.js.inc"></jaxer:include> 
```

不幸的是，使用这种方法，我失去了浏览器缓存客户端脚本的优势，因为所有脚本都被内联了。我能找到避免该问题的唯一技术是将客户端方法、服务器方法和共享方法拆分为它们自己的 js 文件：

```
<script src="Person.shared.js" runat="both" autoload="true"></script>
<script src="Person.server.js" runat="server" autoload="true"></script>
<script src="Person.client.js" runat="client"></script> 
```

而且，在这一点上，我不妨将代理函数也拆分到它们自己的文件中......

```
<script src="Person.proxies.js" runat="server-proxy"></script> 
```

请注意，我`autoload="true"`在共享脚本和服务器脚本上使用了它们，以便它们可用于代理函数。

# asp.net - 如何使用 JSON 方法序列化 javascript 对象？

> ID：109769
> 
> 赞同：3
> 
> 时间：2008-09-20T23:31:46.277
> 
> 标签：asp.net, json, viewstate

我正在寻找对 JSON 的增强，它也将序列化方法。我有一个充当对象集合的对象，并且还想序列化集合对象的方法。到目前为止，我已经找到[了 ClassyJSON](http://www.thomasfrank.se/classier_json.html)。有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-20T23:41:05.367

尝试在不序列化 javascript 代码的情况下逃脱。那样就是一个痛苦的世界。如果代码只能来自静态文件而不是数据库，那么调试会容易得多。相反，在您收到 JSON 响应并将适当的数据传递给适当的对象构造函数后对其进行处理。

如果您绝对必须对它们进行序列化，则在函数上调用 toString() 将返回其源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-20T23:41:13.557

如果你使用 WCF 框架来开发 RESTful Web 服务，那是很容易实现的。只需使用具有 DataContract、DataMember 属性的所需集合创建数据结构类。

```
[DataContract]
public class Foo
{
    [DataMember]
     public string FooName {get;set;}
    [DataMember]
     public FooItem[] FooItems {get;set;}
}

[DataContract]
public class FooItem
{
    [DataMember]
    public string Name {get;set;}
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T23:41:56.643

我不认为序列化方法是一个好主意。如果您打算在服务器端运行代码，那么您就容易受到攻击。如果你想在客户端运行它，你最好只使用本地方法，可能引用你将在序列化对象中使用的方法的名称。

我确实相信这`"f = "+function() {}`将为您提供一个可以评估的字符串版本：

```
var test = "f = " + function() { alert("Hello"); };
eval(test) 
```

对于良好的 json 处理，我会推荐原型，它具有将对象序列化为 json 的好方法。

# calendar - 如何逻辑地组织重复性任务？

> ID：109776
> 
> 赞同：1
> 
> 时间：2008-09-20T23:37:54.110
> 
> 标签：calendar, logic, task

创建重复任务的最佳方式是什么？

我应该创建一些特殊的语法并对其进行解析，类似于 Linux 上的 Cronjobs，还是我应该更愿意使用每小时运行的 cronjob 来创建更多那些没有尽头的重复任务？

请记住，您可以拥有无​​穷无尽的重复任务和具有结束日期的任务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-21T00:03:06.703

[Quartz](http://www.quartz-scheduler.org/)是一个开源作业调度系统，它使用 cron 表达式来控制作业执行的周期性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T01:30:01.453

我的方法始终是“以最小的努力获得最大的效果”（或每块钱的最佳效果）。

如果可以用 cron 来完成，为什么不使用 cron 呢？我认为重新实现 cron 只是为了好玩是浪费精力，所以除非你真的需要 cron 没有的功能，否则请坚持下去。

# ruby-on-rails - Ruby中对象属性的唯一性

> ID：109781
> 
> 赞同：137
> 
> 时间：2008-09-20T23:39:17.897
> 
> 标签：ruby-on-rails, ruby, arrays, unique

在一个数组中选择一个或多个属性唯一的对象的最优雅的方法是什么？

这些对象存储在 ActiveRecord 中，因此使用 AR 的方法也可以。

* * *

## 回答 #1

> 赞同：219
> 
> 时间：2012-04-10T05:57:30.980

[`Array#uniq`](http://ruby-doc.org/core-1.9.2/Array.html#method-i-uniq)与块一起使用：

```
@photos = @photos.uniq { |p| p.album_id } 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-22T08:18:32.103

将`uniq_by`方法添加到项目中的 Array。它与`sort_by`. `uniq_by`就是这样。`uniq`_ `sort_by`_ `sort`用法：

```
uniq_array = my_array.uniq_by {|obj| obj.id} 
```

实施：

```
class Array
  def uniq_by(&blk)
    transforms = []
    self.select do |el|
      should_keep = !transforms.include?(t=blk[el])
      transforms << t
      should_keep
    end
  end
end 
```

请注意，它返回一个新数组，而不是修改您当前的数组。我们还没有编写`uniq_by!`方法，但如果您愿意，它应该很容易。

编辑：Tribalvibes 指出该实现是 O(n^2)。更好的是（未经测试）......

```
class Array
  def uniq_by(&blk)
    transforms = {}
    select do |el|
      t = blk[el]
      should_keep = !transforms[t]
      transforms[t] = true
      should_keep
    end
  end
end 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-21T01:42:06.527

在数据库级别执行此操作：

```
YourModel.find(:all, :group => "status") 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-06-08T14:21:52.000

您可以使用此技巧通过数组中的多个属性元素选择唯一的：

```
@photos = @photos.uniq { |p| [p.album_id, p.author_id] } 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-20T23:45:15.123

我最初建议`select`在 Array 上使用该方法。以机智：

`[1, 2, 3, 4, 5, 6, 7].select{|e| e%2 == 0}` 还给我们`[2,4,6]`。

但是，如果您想要第一个这样的对象，请使用`detect`.

`[1, 2, 3, 4, 5, 6, 7].detect{|e| e>3}`给我们`4`。

不过，我不确定你要在这里做什么。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-23T21:11:26.460

我喜欢 jmah 使用哈希来强制唯一性。这里还有一些给猫剥皮的方法：

```
objs.inject({}) {|h,e| h[e.attr]=e; h}.values 
```

这是一个不错的 1-liner，但我怀疑这可能会快一点：

```
h = {}
objs.each {|e| h[e.attr]=e}
h.values 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-09-20T22:55:33.097

我发现的最优雅的方式是使用[`Array#uniq`](http://ruby-doc.org/core-1.9.2/Array.html#method-i-uniq)块的衍生产品

```
enumerable_collection.uniq(&:property) 
```

……它读起来也更好！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-20T23:59:26.243

如果我正确理解了您的问题，我已经使用比较 Marshaled 对象以确定是否有任何属性变化的准hacky方法解决了这个问题。以下代码末尾的注入就是一个示例：

```
class Foo
  attr_accessor :foo, :bar, :baz

  def initialize(foo,bar,baz)
    @foo = foo
    @bar = bar
    @baz = baz
  end
end

objs = [Foo.new(1,2,3),Foo.new(1,2,3),Foo.new(2,3,4)]

# find objects that are uniq with respect to attributes
objs.inject([]) do |uniqs,obj|
  if uniqs.all? { |e| Marshal.dump(e) != Marshal.dump(obj) }
    uniqs << obj
  end
  uniqs
end 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-09-20T18:57:45.493

将[Array#uniq](http://ruby-doc.org/core-1.9.2/Array.html#method-i-uniq)与块一起使用：

```
objects.uniq {|obj| obj.attribute} 
```

或者更简洁的方法：

```
objects.uniq(&:attribute) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-21T01:48:53.047

您可以使用散列，其中每个键只包含一个值：

```
Hash[*recs.map{|ar| [ar[attr],ar]}.flatten].values 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-05-10T05:03:10.060

Rails 也有一个`#uniq_by`方法。

参考：[参数化数组#uniq（即uniq_by）](https://stackoverflow.com/questions/5251871/parameterized-arrayuniq-i-e-uniq-by)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-03-11T16:15:53.887

我喜欢 jmah 和 Head 的回答。但是它们是否保留数组顺序？它们可能在 ruby​​ 的更高版本中，因为在语言规范中写入了一些保留哈希插入顺序的要求，但这里有一个类似的解决方案，我喜欢使用它无论如何都保留顺序。

```
h = Set.new
objs.select{|el| h.add?(el.attr)} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-07-18T22:31:34.960

ActiveSupport 实施：

```
def uniq_by
  hash, array = {}, []
  each { |i| hash[yield(i)] ||= (array << i) }
  array
end 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-21T01:11:18.113

现在，如果您可以对属性值进行排序，则可以这样做：

```
class A
  attr_accessor :val
  def initialize(v); self.val = v; end
end

objs = [1,2,6,3,7,7,8,2,8].map{|i| A.new(i)}

objs.sort_by{|a| a.val}.inject([]) do |uniqs, a|
  uniqs << a if uniqs.empty? || a.val != uniqs.last.val
  uniqs
end 
```

这是一个 1 属性唯一的，但同样的事情可以用字典排序来完成......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-27T07:37:49.063

如果你没有和数组结婚，我们也可以尝试通过集合消除重复

```
set = Set.new
set << obj1
set << obj2
set.inspect 
```

请注意，在自定义对象的情况下，我们需要覆盖`eql?`和`hash`方法

# .net - c#中异常类的使用

> ID：109790
> 
> 赞同：5
> 
> 时间：2008-09-20T23:43:15.097
> 
> 标签：.net, exception-handling

发生在数据访问层甚至更高层深处的错误（例如在 ADO.net 操作中）对最终用户来说几乎没有多大意义。简单地将这些错误冒泡到 UI 并显示它们通常只会让最终用户感到沮丧。

我最近采用了一种基本技术来报告诸如此类的错误，借此我可以捕获错误并至少添加一些用户友好的文本，以便至少最终用户了解失败的原因。

为此，我在每个特定函数中捕获异常（例如，数据访问层中的获取函数），然后使用用户友好的文本引发一个新错误，该错误是关于失败并可能导致的函数，然后嵌入原始新异常中的异常作为该新异常的“内部异常”。

如有必要，这可以在每一层发生，每个低层函数的消费者都将它自己的上下文添加到错误消息中，这样到达 UI 的就是越来越用户友好的错误消息。

一旦错误到达 UI - 如果有必要 - 它可以遍历嵌套的异常，以显示错误消息，首先告诉用户哪个操作失败，但也提供一些关于实际错误的技术信息。

例如

> “您请求的客户名称列表无法显示。”
> 
> “由于数据库错误，获取您请求的客户列表失败。”
> 
> “检索客户列表时连接到数据库时出错”
> 
> “用户 xx 登录失败”

我的问题是：这是否非常低效（所有这些嵌套异常）？我怀疑这不是最佳实践，所以我应该怎么做才能实现同样的目标 - 或者我实际上应该尝试实现更好的目标？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-20T23:50:06.030

这只是有点可怕。

如果您向最终用户显示错误，则用户应该能够对此采取行动。在“无法显示您请求的客户名称列表”中。在这种情况下，您的用户只会想“那又怎样？” 在所有这些情况下，只显示“发生了不好的事情”消息。您甚至不需要捕获这些异常，当出现问题时，让一些全局方法（如 application_error）处理它并显示通用消息。当您或您的用户可以对错误采取措施时，抓住它并采取措施或通知用户。

但是你会想要记录你没有处理的每一个错误。

顺便说一句，显示有关发生的错误的信息可能会导致安全漏洞。攻击者对您的系统了解得越少，他们就越不可能找到破解它的方法（请记住那些消息，例如“sql 语句中的语法错误：Select * From Users Where username='a'; drp database;--'.. ." 预期：'drop' 而不是 'drp'。他们不再制作这样的网站）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-21T00:36:29.210

抛出新异常在技术上代价高昂，但是我不会对此进行大辩论，因为“代价高昂”是相对的——如果你每分钟抛出 100 个这样的异常，你可能看不到成本；如果你每秒抛出 1000 个这样的异常，你很可能会看到性能下降（因此，这里不值得讨论 - 性能是你的决定）。

我想我不得不问为什么要使用这种方法。您是否真的可以在可能引发异常的*每个*级别添加有意义的异常信息，如果是这样，信息是否也将是：

*   您真正*想*与用户分享的东西？
*   您的用户将能够解释、理解和*使用*的东西？
*   以不会干扰以后重用低级组件的方式编写，在编写时可能不知道它们的实用性？

我询问与您的用户共享信息的问题，因为在您的示例中，您的人工堆栈首先通知用户在数据库上进行身份验证时出现问题。对于潜在的黑客来说，这是一个很好的信息，可以揭示有关操作正在做什么的一些信息。

至于交还整个自定义异常堆栈，我认为这对大多数（诚实的）用户没有用处。例如，如果我在获取客户姓名列表时遇到问题，是否会帮助我（作为用户）知道数据库身份验证存在问题？除非您使用集成身份验证，并且您的每个用户都有一个帐户，并且能够联系系统管理员以找出他们的帐户缺少权限的原因，否则可能没有。

我将首先确定抛出的框架异常与您想提供给用户的异常消息之间是否真的存在语义差异。如果有，那么继续并在最低级别使用自定义异常（在您的示例中为“登录失败”）。接下来的步骤，直到异常的实际呈现，实际上并不需要任何自定义异常。您感兴趣的异常已经生成（登录失败） - 继续在调用堆栈的每个级别包装该消息除了将调用堆栈暴露给用户之外没有任何实际目的。对于那些“中间”步骤，假设有任何 try/catch 块，一个简单的“记录并抛出”策略就可以正常工作。

但实际上，这种策略还有另一个潜在缺陷：它强制开发人员负责维护已实施的自定义异常标准。由于在编写低级类型时您不可能知道调用层次结构的每一个排列（它们的“客户端”甚至可能还没有被编写），所有开发人员——甚至一个开发人员——似乎都不太可能记得包装和自定义每个代码块中的任何错误情况。

我通常不是从下往上工作，而是担心在进程中尽可能晚地显示抛出的异常（即尽可能靠近调用堆栈的“顶部”）。通常，我不会尝试替换在我的应用程序的低级别引发的异常中的任何消息 - 特别是因为这些低级别成员的使用往往会随着调用的深入而变得越来越抽象。我倾向于在业务层及更低的层中捕获并记录异常，然后在表示层中以易于理解的方式显示它们。

这里有几篇关于异常处理最佳实践的不错的文章：

[http://www.codeproject.com/KB/architecture/exceptionbestpractices.aspx](http://www.codeproject.com/KB/architecture/exceptionbestpractices.aspx)

[http://aspalliance.com/1119](http://aspalliance.com/1119)

天哪，这太罗嗦了……提前道歉。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T23:49:09.700

是的，异常很昂贵，因此捕获和重新抛出或抛出更有用的异常需要付出一定的代价。

但是等一下！如果您正在使用的框架代码或库引发异常，那么事情已经无法解决了。您是否对异常后错误消息的传播速度有非功能性要求？我对此表示怀疑。真的很重要吗？发生了一些无法预料和“异常”的事情。主要是向用户提供明智、有用的信息。

我认为你正在做的事情是正确的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-20T23:45:07.213

当然，这是非常低效的。但是在发生足以向最终用户显示的重要异常时，您不应该关心这一点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-21T00:24:30.597

在我工作的地方，我们只有几个理由来捕获异常。我们只在...

1.  我们可以做点什么——例如，我们知道这有时会发生，我们可以在代码中纠正它（非常罕见）。

2.  我们想知道它发生在哪里（然后我们只是重新抛出异常）。

3.  我们想添加一条友好消息，在这种情况下，我们将原始异常包装在从应用程序异常派生的新异常中，并向其中添加一条友好消息，然后让它从那时起保持不变。

在您的示例中，我们可能只显示“发生登录错误”。anbd 在记录真正的错误并为用户提供他们想要深入研究异常的原因时将其保留。（可能是错误表单上的一个按钮）。

4.  我们想完全抑制异常并继续前进。不用说，我们只对预期的异常类型执行此操作，并且仅在没有其他方法来检测生成异常的条件时才这样做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-20T23:47:37.190

通常，当您处理异常时，性能和效率是您最不担心的问题。您应该更担心做一些事情来帮助用户从问题中恢复过来。如果将某条记录写入数据库时​​出现问题，要么回滚更改，要么至少转储行信息，这样用户就不会丢失它。

# linux - 目前 Linux 虚拟化技术的最新技术是什么？

> ID：109797
> 
> 赞同：3
> 
> 时间：2008-09-20T23:46:07.693
> 
> 标签：linux, virtualization

有哪些适用于 Linux 的 VM 技术，它们的优缺点，以及推荐用于哪个应用程序？

由于此类问题可以针对“Linux VM 技术”以外的 X 提出，并且由于答案随着进度而变化，因此我建议为此类页面定义一个模板。这些页面将带有“stateoftheart”标签，每个月都会重新访问它们，每个月都会有最新的技术列表、最新的评论和最新的建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-21T01:47:43.113

这是……**[维基百科](http://en.wikipedia.org/wiki/Main_Page)**的工作！

*   [虚拟化类型](http://en.wikipedia.org/wiki/Virtualization)
*   [平台虚拟化](http://en.wikipedia.org/wiki/Platform_virtualization)
*   [虚拟机比较](http://en.wikipedia.org/wiki/Comparison_of_virtual_machines)

现在明显的东西已经不碍事了......

Linux 在我使用过的每个 VM 主机上都可以作为来宾运行良好，所以我假设您将 Linux 称为主机操作系统。我还将假设 x86 或 amd64 硬件。

平台虚拟化分为两种主要形式：桌面虚拟化和服务器虚拟化。这两种类型都允许您作为来宾加载和运行多个操作系统实例，通过主机操作系统虚拟化其 I/O。桌面虚拟化专注于为每个来宾 VM 提供高度交互的控制台体验，而服务器虚拟化专注于最大化计算性能，通常同时牺牲控制台服务和更奇特的设备（声卡、USB 等）。服务器虚拟化实现通常包括[RDP](http://en.wikipedia.org/wiki/Remote_Desktop_Protocol)或[VNC](http://en.wikipedia.org/wiki/VNC)用于远程访问虚拟控制台。

在 Linux 上，您对**桌面虚拟化**的选择包括：

*   [VMware Workstation——](http://en.wikipedia.org/wiki/VMware_Workstation)它是商业化的、有点昂贵的、成熟的，并且提供任何解决方案中最多的硬件、设备和客户操作系统支持。
*   [VMware Player——](http://en.wikipedia.org/wiki/VMware_Player)它是商业的（免费软件），只支持在别处创建的虚拟机。可用于 Ubuntu。
*   [Parallels Workstation——](http://en.wikipedia.org/wiki/Parallels_Workstation)它是商业化的，有点贵，而且比不上VMware。不支持 64 位来宾。
*   [VirtualBox——](http://en.wikipedia.org/wiki/VirtualBox)提供商业（免费软件）和社区版本（GPL）。Fedora 的首选解决方案。

在 Linux 上，您对**服务器虚拟化**的选择包括：

*   [VMware 服务器](http://en.wikipedia.org/wiki/VMware_Server)——它是商业（免费软件）、成熟的，并提供任何解决方案中最多的硬件、设备和客户操作系统支持。可用于 Ubuntu。
*   [Xen——](http://en.wikipedia.org/wiki/Xen)它是开源的。半虚拟化解决方案，它最近才添加硬件虚拟化，因此 Windows 来宾支持取决于特定的 CPU 支持。
*   [Virtual Iron](http://en.wikipedia.org/wiki/Virtual_Iron) ——Xen 的商业化版本，增加了本地虚拟化。
*   [KVM——](http://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine)它是开源的。最后一英里取决于[QEMU](http://en.wikipedia.org/wiki/QEMU)。Ubuntu 的首选解决方案。
*   [Linux-VServer——](http://en.wikipedia.org/wiki/Linux-VServer)它是开源的。它提供基于主机操作系统内核的虚拟监狱，因此没有 Windows 来宾。

对于我自己，我坚持使用 VMware Workstation（7 年以上）和 VMware Server 来满足我的 Linux 托管虚拟化需求。在工作中，它是 VMware Workstation（在 Windows 上）、VMware Server（在 Windows 上）和 VMware ESX（在裸机上）。我可能会在某个时候再看看 Xen、KVM 和 VirtualBox，但现在工作和家庭之间的兼容性是最重要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-20T23:52:16.370

# 2008 年 10 月

10月份填写，反映当时的市场状况。

# 2008 年 9 月

## 现有产品/服务/技术

1.  [VMware](http://www.vmware.com)
2.  [辛](http://www.xen.org)
3.  [虚拟盒子](http://www.virtualbox.org)
4.  [虚拟服务器](http://linux-vserver.org)
5.  ？？？

## 比较

？？？

## 针对特定应用领域的建议

1.  家庭多引导替换
2.  拥有 MS-Windows 旧版应用程序的小型企业
3.  跨国公司数据中心
4.  ？？？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-21T17:30:12.973

W Craig Trader 的回答很好，但要补充一点，还有[用户模式 ​​Linux](http://en.wikipedia.org/wiki/User-mode_Linux) (UML)，它已经存在了一段时间——它从 2.6.0 开始就在主线内核树中。请注意，我自己没有使用它。

Ubuntu 更喜欢 KVM，我相信 Red Hat 现在也正在转向它而不是 Xen。KVM 和 Xen 都可以由[libvirt](http://libvirt.org/)管理，也可以通过[虚拟机管理器](http://virt-manager.org/)GUI 进行管理。虚拟机管理器可以通过 ssh 连接管理远程实例。

此外，可以在[这里](http://ols.fedoraproject.org/OLS/Reprints-2008/camargos-reprint.pdf)找到一个很好的比较(pdf)。做了很多性能测试。简短的版本是 xen 和 linux-vserver 通常在性能方面是最好的。

# c# - C# 2008 前端的数据库选择

> ID：109810
> 
> 赞同：0
> 
> 时间：2008-09-20T23:52:06.197
> 
> 标签：c#, database, networking

我想知道什么以及为什么您会选择能够创建一个数据库，该数据库可以支持不超过 100 个用户，同时使用它的用户不超过 10 个，并通过 Visual Studio 2008 C# Windows Form 前端访问它。我必须通过网络连接访问数据库，而不仅仅是在本地机器上。我还需要在代码中定义运行时数据库的位置，而不是 Visual Studio 中的“数据源”视图。如果我的问题需要重新构建或不被理解，请告诉我，我会调整。我的部分问题是我什至不知道如何提出正确的问题，更不用说答案是什么了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-20T23:55:23.943

如果不是出于商业目的，您可以尝试 SQL Server 2008 Express。它可以很好地与 Visual Studio 2008 集成以进行开发，并支持 LINQ、实体数据模型和 ADO.NET 实体框架，从而可以轻松创建下一代支持数据的应用程序。

[http://www.microsoft.com/express/sql/default.aspx](http://www.microsoft.com/express/sql/default.aspx)

您还可以将连接字符串存储在应用程序配置文件中，并以编程方式检索它们以设置数据库连接。

[http://www.codeguru.com/columns/DotNet/article.php/c7987/](http://www.codeguru.com/columns/DotNet/article.php/c7987/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T00:01:18.250

我可能会使用 Sql Server Express，它是免费的，并且可以与 .NET 配合使用。假设您的架构在运行时没有更改，您可能仍然可以使用 Visual Studio 中的设计时数据源功能。连接信息存储在 app.config 文件中，您可以在部署应用程序后更新该文件以指向不同的数据库。您还可以开发一个从其他地方获取连接信息的类，并在需要打开数据库连接时使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T23:55:17.390

我知道使用 mssql 您可以在所有数据库调用的不同连接字符串之间进行选择，只需执行类似的操作

Command.Connection = GetMyConnectionWithWhateverLogicINeed();

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-20T23:56:43.130

我会看看 Sql Server Workgroup Edition

[http://www.microsoft.com/sql/editions/workgroup/](http://www.microsoft.com/sql/editions/workgroup/)

Express 版曾经对超过 5 个用户有一些限制功能，并且没有提供任何管理工具，这有点令人沮丧。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T00:12:28.160

我不确定我是否完全明白您的要求，Matt，但我可以告诉您，我开发了一系列使用 VS 2008 编写的应用程序，并且我们使用了 MySQL DB。虽然此时我绝对不是数据库专家，但我在使用 MySQL 方面并没有遇到很多问题。

也许如果您改写您的问题，我们可以提供更好的答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-22T03:04:56.537

SQLite 是肯定的。

[ADO 2.0 提供程序](http://sqlite.phxsoftware.com/)

# php - 以编程方式确定视频文件格式？

> ID：109815
> 
> 赞同：6
> 
> 时间：2008-09-20T23:54:11.217
> 
> 标签：php, linux, video, file-io, binaryfiles

好的，我了解了视频格式的基础知识——有一些容器格式，然后你就有了核心视频/音频格式。我想编写一个基于 Web 的应用程序来确定文件使用的视频/音频编解码器。

如何最好地以编程方式确定视频编解码器？最好通过系统调用使用标准库并解析其输出？（例如ffmpeg、转码等？）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-20T23:58:49.723

`mplayer -identify`会成功的。只需调用`ffmpeg`一个文件也可以——它会在开始时自动打印一组关于输入文件的信息，而不管你告诉 ffmpeg 实际做什么。

当然，如果您想从您的程序中执行此操作，而不需要对外部程序进行 exec 调用，您可以只包含 avcodec 库并直接运行它自己的识别例程。

虽然您可以实现自己的检测，但考虑到 libav* 支持的绝对大量的格式，它肯定不如现有的例程。这将是一个相当愚蠢的重新发明轮子的案例。

Linux 的“文件”命令也可以做到这一点，但它打印出的数据量取决于视频格式。例如，在 AVI 上，它会提供有关分辨率、FOURCC、fps 等的各种数据，而对于 MKV 文件，它只会显示“Matroska 数据”，而不会告诉您内部结构，甚至是使用的视频和音频格式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T08:43:51.957

我在 perl 脚本中使用了 FFMPEG 来实现这一点。

```
$info = `ffmpeg -i $path$file 2>&1 /dev/null`;
@fields = split(/\n/, $info); 
```

只需找出您需要提取的 @fields 中的哪些项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-20T23:59:29.660

您需要进一步开始。您需要了解容器格式以及它如何指定编解码器。

所以我会从一个识别容器格式的程序开始（不仅仅是从扩展，进入标题并确定真正的容器）。

然后找出您的程序将支持哪些容器，并放入解析存储在容器中的元数据所需的函数，其中将包括编解码器。

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-21T00:01:32.180

您确实需要一个大型二进制识别标记数据库，以便在文件开头附近查找。幸运的是，您的问题被标记为“Linux”，并且那里已经存在这样的数据库；file(1) 将为您完成这项工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-01T07:57:24.240

我建议使用`ffprobe`并将输出格式强制为 json。解析起来会容易得多。最简单的例子：

```
$meta = json_decode(join(' ', `ffprobe -v quiet -print_format json -show_format -show_streams /path/to/file 2>&1`)); 
```

请注意，在文件损坏的情况下，您将`null`根据您的错误报告设置获得结果和警告。具有正确错误处理的完整示例：

```
$file = '/path/to/file';
$cmd = 'ffprobe -v quiet -print_format json -show_format -show_streams ' . escapeshellarg($file).' 2>&1';

exec($cmd, $output, $code);
if ($code != 0) {
    throw new ErrorException("ffprobe returned non-zero code", $code, $output);
}

$joinedOutput = join(' ', $output);
$parsedOutput = json_decode($joinedOutput);
if (null === $parsedOutput) {
    throw new ErrorException("Unable to parse ffprobe output", $code, $output);
}

//here we can use $parsedOutput as simple stdClass 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-14T14:19:42.467

您可以使用媒体信息：

```
sudo apt-get install mediainfo 
```

如果您只想获取视频/音频编解码器，可以执行以下操作：

```
$videoCodec = `mediainfo --Inform="Video;%Format%" $filename`;
$audioCodec = `mediainfo --Inform="Audio;%Format%" $filename`; 
```

如果您想捕获更多信息，可以解析 mediainfo 返回的 XML 输出。这是示例函数：

```
function getCodecInfo($inputFile)
{
    $cmdLine = 'mediainfo --Output=XML ' . escapeshellarg($inputFile);

    exec($cmdLine, $output, $retcode);
    if($retcode != 0)
        return null;

    try
    {
        $xml = new SimpleXMLElement(join("\n",$output));
        $videoCodec = $xml->xpath('//track[@type="Video"]/Format');
        $audioCodec = $xml->xpath('//track[@type="Audio"]/Format');
    }
    catch(Exception $e)
    {
        return null;
    }

    if(empty($videoCodec[0]) || empty($audioCodec[0]))
        return null;

    return array(
        'videoCodec' => (string)$videoCodec[0],
        'audioCodec' => (string)$audioCodec[0],
    );
} 
```

# c# - 我应该直接绑定到从 web 服务返回的对象吗？

> ID：109825
> 
> 赞同：3
> 
> 时间：2008-09-20T23:58:02.690
> 
> 标签：c#, web-services, data-binding, serialization

我应该直接绑定到从 Web 服务返回的对象，还是应该将客户端对象绑定到我的网格控件？例如，如果我有一个返回对象 Car 的服务，我是否应该有一个客户端 Car 对象，我用来自 web 服务 Car 对象的值填充？什么被认为是最佳实践？在 C# 中，我是否需要将我的类标记为可序列化或对它们做一些特别的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-24T19:54:07.273

这是一个很好的问题，它与我问自己的两个问题相同：

1.  [大型复杂对象作为 Web 服务结果](https://stackoverflow.com/questions/17725/large-complex-objects-as-a-web-service-result)。
2.  [ASP.NET Web 服务结果、代理类和类型转换](https://stackoverflow.com/questions/6681/aspnet-web-service-results-proxy-classes-and-type-conversion)。

这两本书对你来说可能都值得一读。

这是我的两点：

*   尽可能将 Web 服务的返回类型保留为原语。这不仅有助于减小消息的大小，而且还降低了接收端的复杂性。
*   如果您确实需要返回复杂对象，请将它们作为**原始 xml 字符串**返回（我将在下面解释）。

然后我要做的是创建一个单独的类，它代表对象并处理它的 xml。我确保可以轻松地将类实例化并序列化为 xml。然后两个项目（Web 服务和客户端）都可以引用包含具体对象的 DLL，但没有与代理类的烦人耦合。如果您有共享代码，这种耦合会导致问题。

例如（使用您的`Car`课程）：

*   Web Service( `CarFactory`) 方法`BuyCar(string make, string model)`是返回汽车的工厂方法。
*   您还编写了一个`Mechanic`处理`Car`对象以修复它们的类，这是在没有 Web 服务知识的情况下开发的。
*   然后，您可以为您的应用程序选择一个`Garage`类。您添加对服务的网络引用以`CarFactory`获取您的汽车，然后将一些`Mechanic`'s 添加到您的车库，然后破解您的指关节并准备从工厂获取一些汽车以让它们工作。
*   然后一切都崩溃了，当你得到结果`CarFactory.BuyCar("Audi", "R8")`然后告诉你`Mechanic.Inspect(myAudi)`的编译器呻吟，因为`Car`实际上是类型`CarFactory.Car`而不是原始`Car`类型，是吗？

所以，使用我建议的方法：

*   `Car`在自己的 DLL 中创建您的类。添加方法来实例化它并分别从/到 XML 序列化它。
*   创建您的`CarFactory`Web 服务，添加对 DLL 的引用，像以前一样构建您的汽车，但不是返回对象，而是**返回 XML**。
*   创建`Garage`添加对`Mechanic`、`Car`DLL 和`CarFactory`Web 服务的引用。调用您的`BuyCar`方法，现在它返回一个字符串，然后您将该字符串传递给`Car`该类，该类重新构建其对象模型。`Mechanic`'s 也可以很高兴地处理这些，`Car's`因为所有内容都来自同一张赞美诗（或 DLL？）:)
*   一个主要的好处是，如果对象在其设计中发生变化，您只需更新 DLL，Web 服务和客户端应用程序就会与该过程完全分离。

**注意：通常创建一个**[外观](http://en.wikipedia.org/wiki/Facade_pattern)层第二层与 Web 服务一起使用并从 XML 结果自动生成对象会很有用。

我希望这是有道理的，如果没有，请大喊大叫，我会澄清。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-21T00:25:59.767

这实际上取决于您从 Web 服务中获得什么。如果它们是简单的数据传输对象并且您只显示数据，那么可以，您可以绑定。如果您计划编辑对象，它可能没有用，因为您需要跟踪更改。

您在客户端上的对象和/或集合是否跟踪更改？如果是这样，您可以使用它们。

如果您没有更改跟踪，那么您将需要自己跟踪更改，因此您可能需要翻译对象或将它们包装在某些东西中以跟踪更改。

同样，这真的取决于你得到什么，他们支持什么，你用他们做什么，以及服务器想要什么响应来改变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-21T06:28:28.477

如果您直接绑定到 Web 服务类型，那么您将引入耦合。如果 Web 服务在未来发生变化，这可能会产生不希望的副作用，这意味着需要进行大量代码更改。

例如，如果您今天使用 .asmx Web 服务，那么明天转向 WCF 会怎样？如果您使用了 WCF 不会序列化的类型，这可能意味着对您的代码进行相当多的更改。

从长远来看，创建特定的客户端对象然后在 Web 服务数据契约类型之间进行转换通常会更好。看起来工作量很大，但是当需要重构时，这通常会得到很大回报，因为您的更改已本地化在一个地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T03:33:06.917

您可以做的一件事是创建与具有您想要的任何附加功能的 Web 服务数据协定相对应的客户端类，并将 Web 服务引用设置为重用现有类型。那么就没有理由创建一个额外的包装类来绑定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-24T21:25:05.780

If you are the owner of both the web service and the client.
And you need the parameters of the web service calls to be complex classes which contain not only data but also behavior (actual coded logic) then you are in a bit of a pickle when developing these web services using web service frame works.
As suggested in the [answer by Rob Cooper](https://stackoverflow.com/questions/109825/should-i-bind-directly-to-objects-returned-from-a-webservice#235048) you can use pure xml as web service parameters and xml serialization, but there is a cleaner solution.
If you are using Visual Studio 2005 (probably applies the same for 2008), You can customize the way VS creates you proxy as described in this article: [Customizing generated Web Service proxies in Visual Studio 2005](http://www.microsoft.com/belux/msdn/nl/community/columns/jdruyts/wsproxy.mspx)

This way you can tell VS to use your own classes instead of generating a proxy class.

Well when I think of it, it's pretty much same [solution](https://stackoverflow.com/questions/109825/should-i-bind-directly-to-objects-returned-from-a-webservice#235048) as proposed by Rob Cooper, with the little twist, that you wont be writing a Facade layer your self but will be using VS itself as this layer.

# ruby-on-rails - 没有收到来自 ExceptionNotifier 的电子邮件

> ID：109830
> 
> 赞同：1
> 
> 时间：2008-09-20T23:59:36.977
> 
> 标签：ruby-on-rails, ruby, exception

我按照本[教程](http://svn.rubyonrails.org/rails/plugins/exception_notification/README)配置 Rails 插件 ExceptionNotifier。

我知道我正确配置了 ActionMailer，因为我正在从其他表单接收邮件。我什至设置了 local_addresses.clear 以便无论如何它都应该发送邮件。

我正在使用 Apache 和在后端运行的 mongrel_cluster。

我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T01:22:34.950

您正在使用该插件的 SVN 版本，该版本可能未维护。[最新版本可以在这里找到](http://github.com/rails/exception_notification/tree/master)。

您可以做的第二件事是检查生产日志。邮件被写入日志，所以你会看到 Rails 是否曾经*尝试*发送它。如果没有条目，则意味着事情正在默默地失败，这可能是因为——由于某种原因——异常没有被正确捕获。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T01:29:30.380

检查您的生产日志，异常可以在 exception_notifier 插件中抛出，这会阻止它发送邮件

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-21T23:42:58.863

如果您将 ExceptionNotifier 配置信息（您的电子邮件地址等）添加到 config/environment.rb 中，您是在 Rails::Initializer 块中添加它还是在文件末尾添加它？

您链接到的教程没有指定*在*环境文件中放置配置信息的位置。我遵循的教程（可能是[这个](http://internetducttape.com/2008/02/06/rails-guide-exception-notifier-plugin/)）确实指定将其放在块之外。

哪些东西在那个街区里面，哪些东西在外面，坦率地说，对我来说仍然有点神秘。但我认为这可能会回答您的具体问题。

# .net - .NET 中的对象内存分析

> ID：109836
> 
> 赞同：6
> 
> 时间：2008-09-21T00:02:52.350
> 
> 标签：.net, memory

是否有工具或方法可以找出 .NET 中每个 DLL 或对象消耗了多少内存？它分析得越详细越好。谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-21T00:11:44.777

您可以尝试免费的[CLR Profiler](http://www.microsoft.com/downloads/details.aspx?familyid=a362781c-3870-43be-8926-862b40aa0cd0&displaylang=en)，或者试用[ANTS Profiler](http://www.red-gate.com/Products/ants_profiler/index.htm)的试用版。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-21T00:11:09.380

.NET Memory Profiler 应该允许您这样做：http: [//memprofiler.com/](http://memprofiler.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-21T00:10:42.067

有一些不错的内存分析器..可以看看这个问题

[有哪些好的 .NET 分析器？](https://stackoverflow.com/questions/3927/what-are-some-good-net-profilers)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T12:53:46.130

我一直很喜欢Jetbrains（以及 Resharper）的[dot.Trace 分析器](http://www.jetbrains.com/profiler/index.html)

# javascript - 使用 jQuery 插件自动格式化结构化数据（电话、日期）（或无法使用原生 JavaScript）

> ID：109854
> 
> 赞同：22
> 
> 时间：2008-09-21T00:14:22.540
> 
> 标签：javascript, jquery, html, user-interface

我喜欢 jQuery，我想知道是否有人使用了一个好的插件或（非 jQuery）JavaScript 库，允许自动格式化电话号码或日期等结构化字段。我知道 jquery-ui-datapicker 插件，而不是我在这里寻找的。您可以输入电话号码为 123，然后变为 (123)，其他号码将格式化为 (123) 456 7890 Ext。123456\. 如果您按删除，自动格式化的东西会自动消失，重新定位光标，例如，在 (123) 之后并按删除将删除 3 并使其余的 (124) 567 8901 分机。23456\. 我玩过的那些似乎不可靠。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-21T01:12:26.520

[Masked Input 插件](http://digitalbush.com/projects/masked-input-plugin/)是否满足您的需求或您已经发现不可靠的插件？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-21T01:46:30.713

艾伦，

我相信您最好的选择是在两种单独的格式化方法中使用正则表达式，以达到预期的效果。对于电话号码，这将是相当直接的，如果在我坐下来并有 10 分钟的时间直接写一些东西时没有发布一个代码示例，我将发布一个代码示例。也许对于日期字段，您可以改用 jQuery UI Datepicker 之类的东西？[http://marcgrabanski.com/pages/code/jquery-ui-datepicker](http://marcgrabanski.com/pages/code/jquery-ui-datepicker)

高温下，

/sf

# c - 在哪里可以找到 ncurses C API 的完整参考资料？

> ID：109855
> 
> 赞同：38
> 
> 时间：2008-09-21T00:14:36.470
> 
> 标签：c, api, reference, ncurses

在哪里可以找到 ncurses C API 的完整参考资料？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-11-26T21:23:32.910

我不久前发现了这个问题，但到目前为止，没有一个答案能回答原始问题。完整的免费 API 参考可通过 . . .

[NCURSES 手册页](http://invisible-island.net/ncurses/man/ncurses.3x.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-22T02:05:54.200

图书馆附带的文档实际上并没有那么糟糕。

[http://tldp.org/HOWTO/NCURSES-Programming-HOWTO/](http://tldp.org/HOWTO/NCURSES-Programming-HOWTO/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-21T00:19:35.023

你可以买这本书。我有它并推荐：John Strang，Programming with curses，O'Reilly，ISBN 0-937175-02-1

最好的在线资源信息：http: [//invisible-island.net/ncurses/ncurses-intro.html](http://invisible-island.net/ncurses/ncurses-intro.html)

通过阅读 minicom 源代码和 iptraf linux 网络监视器，我学到了很多关于 ncurses 的知识。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-21T00:59:47.267

我发现“nCurses 程序员指南”（Dan Gookin，Wiley 出版）一书非常宝贵，因为它包含教程和对 API 的令人印象深刻的参考。

还有 O'Reilly Nutshell 指南“Programming with Curses”，还不错。

# php - PHP 与 AWASP 框架

> ID：109858
> 
> 赞同：0
> 
> 时间：2008-09-21T00:15:50.447
> 
> 标签：php, model-view-controller, frameworks

谁在使用 WASP ( [http://wasp.sourceforge.net/content/](http://wasp.sourceforge.net/content/) ) 在现实世界的应用程序中？你有什么印象？好的？坏的？如果您可以提供任何输入，例如与 rails 相比有多好。

我真的在寻找 PHP 的 MVC 框架

> **更新：我发现** [这个比较](http://www.phpit.net/article/ten-different-php-frameworks/)很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-21T00:29:15.577

我不久前下载了它并试用了它，但由于目前文档非常糟糕（由一些无用的自动生成的“文档”组成），我很快就放弃了。我认为框架中最重要的事情之一是清晰、完整的文档——如果你不得不花时间挖掘框架的代码来找出你想要的类是否存在，那么使用框架的意义就丢失了. WASP 似乎还没有为生产环境做好准备，甚至他们的网站也承认它还没有为企业应用做好准备。

如果您正在寻找一个 PHP 框架，我会推荐 CodeIgniter，它具有出色的文档和有用的社区，或者是非常成熟的 Zend。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-21T03:11:32.380

[CakePHP](http://www.cakephp.org)是一个很棒的框架，有很棒的文档。Symfony 让我失去了所有的配置，当时我对这两个框架都是新手，而 CakePHP 对我来说是最好的，我很快就能学会

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-22T01:45:39.473

嘿，维克多，这种比较已经过时了。它是在大约 1.5 年前完成的，至少在我经常使用的 Zend Framework 的情况下，从那时起情况发生了很大变化。我会说这种比较太老了以至于没有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T02:35:59.097

也可以查看 symfony。免费软件，一流的文档。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T03:52:49.053

[QCodo](http://www.qcodo.com)很棒 - 惊人的代码生成，完整的 MVC 支持。我见过的最强的对象关系映射；他们的脚手架模型比 CakePHP 和 Zend 强大得多……另外，它可以通过社区控件进行漂亮的扩展。在过去的两年里，我一直在将它用于大型项目，非常棒！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-21T09:14:05.457

你试过[CodeIgniter](http://codeigniter.com/)吗？我测试了 CakePHP，但它太像 Rails 风格了，我不喜欢它。CodeIgniter 让您可以更自由地做任何您想做的事情。

# c# - “日期时间”是什么意思？在 C# 中是什么意思？

> ID：109859
> 
> 赞同：77
> 
> 时间：2008-09-21T00:16:02.740
> 
> 标签：c#, .net, datetime, syntax, nullable

我正在阅读一本 .NET 书籍，在其中一个代码示例中有一个包含此字段的类定义：

```
private DateTime? startdate 
```

是什么`DateTime?`意思？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2008-09-21T00:20:10.263

因为`DateTime`is a`struct`而不是 a ，所以当您声明该类型的字段或变量时`class`，您会得到一个`DateTime` *object*，而不是*reference 。*

而且，与 an `int`cannot be一样`null`，这个`DateTime`对象永远不可能 be `null`，因为它不是引用。

添加问号会将其变为[*可空类型*](http://msdn.microsoft.com/en-us/library/1t3y8s4s%28v=vs.80%29.aspx)，这意味着它*要么*是`DateTime`对象，*要么*是`null`。

`DateTime?`是 的语法糖`Nullable<DateTime>`，其中[`Nullable`](http://msdn.microsoft.com/en-us/library/b3h38hb0%28v=vs.80%29.aspx)本身就是 a `struct`。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-21T00:16:34.173

这是一个可以为空的日期时间。`?`在原始类型/结构表明它是可为空的版本之后。

DateTime 是一个永远不能为空的结构。来自[MSDN](http://msdn.microsoft.com/en-us/library/ee432844.aspx)：

> DateTime 值类型表示日期和时间，其值范围从 0001 年 1 月 1 日午夜 12:00:00 Anno Domini 或 AD（也称为 Common Era 或 CE）到 9999 年 12 月 31 日晚上 11:59:59广告 (CE)

`DateTime?`但是可以为空。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-21T00:20:56.377

一个**？**作为值类型的后缀，允许分配原本不可能的空值。

[http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx](http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx)

> 表示一个对象，其基础类型是一个值类型，也可以分配一个空引用。

这意味着您可以编写如下内容：

```
 DateTime? a = null;
    if (!a.HasValue)
    {
        a = DateTime.Now;
        if (a.HasValue)
        {
            Console.WriteLine(a.Value);
        }
    } 
```

**约会时间？**在语法上等同于**Nullable<DateTime>**。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-21T00:19:44.290

它相当于 Nullable<DateTime>。您可以附加“？” 任何原始类型或结构。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-21T00:21:05.583

它基本上为您提供了原语的额外状态。它可以是一个值，也可以为空。它在不需要分配值的情况下很有用。因此，您可以将其分配为 null 以表示没有值，而不是使用例如 datetime.min 或 max。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-05-15T07:09:37.470

正如我们所知，DateTime 是一个结构意味着 DateTime 是一个值类型，所以你得到一个 DateTime 对象，而不是一个引用，因为 DateTime 不是一个类，当你声明一个该类型的字段或变量时，你不能用 null 初始化因为值类型不接受空值。就像 int 不能为空一样。所以 DateTime 对象永远不会为空，因为它不是引用。

但有时我们需要可为空的变量或值类型的字段，那时我们使用问号将它们设为可空类型，以便它们允许为空。

**例如：-**

约会时间？日期=空；

诠释？整数值 = 空；

在上面的代码中，变量**date**是 DateTime 的一个对象，或者它为 null。整数值相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-12-23T10:55:34.257

```
public class ReportsMapper : CommonMapper
{

    public DateTime? cb_Bill_From_Date { get; set; }

    public DateTime? cb_Bill_To_Date { get; set; }

    public DateTime? tff_Bill_From_Date { get; set; }
    public DateTime? tff_Bill_To_Date { get; set; }
} 
```

If you declare DateTime As Null In Procedure Then You get an error stating DateTime Object Can never be Null so you need to add ? After DateTime that will say DateTime is Nullable too.

Hope This Help!

# mysql - 将 PostgreSQL 数据库转换为 MySQL

> ID：109861
> 
> 赞同：3
> 
> 时间：2008-09-21T00:16:27.667
> 
> 标签：mysql, postgresql

我已经看到了反向操作的问题，但是我有一个 800MB 的 PostgreSQL 数据库需要转换为 MySQL。我假设这是可能的（一切皆有可能！），我想知道解决此问题的最有效方法以及需要注意的任何常见错误。我几乎没有使用 Postgre 的经验。任何指向这方面指南的链接也会有所帮助！谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-21T00:18:52.983

一个建议是从当前版本的 MySQL 开始，否则您将没有子查询、存储过程或视图。另一个明显的区别是自动增量字段。查看：

[pg2mysql](http://www.lightbox.ca/pg2mysql.php)

/艾伦

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T12:28:03.737

You should not convert to new database engine based solely on the fact that you do not know the old one. These databases are very different - MySQL is speed and simplicity, Postgres is robustness and concurrency. It will be easier for you to learn Postgres, it is not that hard.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-22T18:39:11.020

pg_dump 可以将转储作为插入语句和创建表语句。那应该让你接近。然而，更大的问题是你为什么要切换。你可能做了很多工作，却没有从中获得任何真正的收益。

# perl - Perl 6 的这一侧是否有针对惰性列表的 Perl 解决方案？

> ID：109880
> 
> 赞同：11
> 
> 时间：2008-09-21T00:26:55.070
> 
> 标签：perl, lazylist, source-filter

有没有人为 Perl 中的惰性求值列表找到了一个好的解决方案？我尝试了很多方法来改变类似的东西

```
for my $item ( map { ... } @list ) { 
} 
```

进入懒惰的评估——例如，通过绑定@list。我试图避免分解并编写源过滤器来做到这一点，因为它们会干扰您调试代码的能力。有没有人成功过。还是您只需要分解并使用while循环？

**注意：**我想我应该提一下，有时我有点迷上了用于功能转换列表的长 grep-map 链。所以与其说是 foreach 循环或 while 循环。这是地图表达式倾向于将更多功能打包到相同的垂直空间中。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-21T01:16:22.580

如前所述，for(each) 是一个急切的循环，因此它希望在开始之前评估整个列表。

为简单起见，我建议使用迭代器对象或闭包，而不是尝试使用延迟评估的数组。虽然您*可以*使用 tie 来获得一个惰性求值的无限列表，但如果您（直接或间接地，如上面的 foreach 中）询问整个列表（甚至整个列表的大小），您可能会遇到麻烦。

无需编写完整的类或使用任何模块，您只需使用闭包即可创建一个简单的迭代器工厂：

```
sub make_iterator {
    my ($value, $max, $step) = @_;

    return sub {
        return if $value > $max;    # Return undef when we overflow max.

        my $current = $value;
        $value += $step;            # Increment value for next call.
        return $current;            # Return current iterator value.
    };
} 
```

然后使用它：

```
# All the even numbers between 0 -  100.
my $evens = make_iterator(0, 100, 2);

while (defined( my $x = $evens->() ) ) {
    print "$x\n";
} 
```

CPAN 上还有[Tie::Array::Lazy](http://search.cpan.org/perldoc?Tie::Array::Lazy)模块，它为惰性数组提供了更丰富、更完整的接口。我自己没有使用过该模块，因此您的里程可能会有所不同。

祝一切顺利，

保罗

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-21T17:45:11.907

[旁注：请注意，沿 map/grep 链的每一步都是急切的。如果你一次给它一个很大的列表，你的问题比决赛要早得多`foreach`。]

为了避免完全重写，你可以做的是用一个外循环包裹你的循环。而不是这样写：

```
for my $item ( map { ... } grep { ... } map { ... } @list ) { ... } 
```

……这样写：

```
while ( my $input = calculcate_next_element() ) {
    for my $item ( map { ... } grep { ... } map { ... } $input ) { ... }
} 
```

这使您不必大量重写现有代码，并且只要列表在转换过程中不增长几个数量级，您几乎可以获得重写迭代器样式所提供的所有好处。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-21T18:30:18.757

如果要创建惰性列表，则必须编写自己的迭代器。一旦你有了它，你就可以使用[Object::Iterate](http://search.cpan.org/dist/Object-Iterate)`map`之类的东西，它具有和的迭代器感知版本`grep`。查看该模块的源代码：它非常简单，您将了解如何编写自己的迭代器感知子例程。

祝你好运， ：）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-21T01:09:58.787

至少存在一种特殊情况，其中 for 和 foreach 已被优化为不会一次生成整个列表。这就是范围运算符。所以你可以选择说：

```
for my $i (0..$#list) {
  my $item = some_function($list[$i]);
  ...
} 
```

这将遍历数组，随心所欲地转换，而无需预先创建一长串值。

如果你希望你的 map 语句返回可变数量的元素，你可以这样做：

```
for my $i (0..$#array) {
  for my $item (some_function($array[$i])) {
    ...
  }
} 
```

如果您希望比这更普遍的惰性，那么您最好的选择是学习如何使用闭包来生成惰性列表。MJD 的优秀书籍*Higher Order Perl*可以引导您了解这些技术。但是请注意，它们将对您的代码进行更大的更改。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-01-25T22:14:40.603

把这个从死里复活，提到我刚刚`List::Gen`在[CPAN](http://search.cpan.org/search%3fmodule=List::Gen)上写了这个模块，这正是海报所寻找的：

```
use List::Gen;

for my $item ( @{gen { ... } \@list} ) {...} 
```

列表的所有计算都是惰性的，并且有 map / grep 等价物以及其他一些功能。

每个函数都返回一个“生成器”，它是对绑定数组的引用。您可以直接使用绑定数组，也可以使用一堆访问器方法，如迭代器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-21T01:08:25.127

[使用迭代器](http://perldesignpatterns.com/?LazyEvaluation)或考虑使用CPAN 中的[Tie::LazyList](http://search.cpan.org/dist/Tie-LazyList/)（有点过时）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-22T08:42:49.907

我在 perlmonks.org 上问了一个类似的问题，[BrowserUk](http://perlmonks.org/?node_id=712235)[在他的回答中](http://perlmonks.org/?node_id=712271)给出了一个非常好的框架。基本上，获得惰性评估的一种方便方法是为计算生成线程，至少只要您确定想要结果，就不是现在。如果您希望惰性评估不是为了减少延迟而是为了避免计算，我的方法将无济于事，因为它依赖于推送模型，而不是拉取模型。可能使用[Coro](http://search.cpan.org/perldoc?Coro)程序，您也可以将这种方法转换为（单线程）拉模型。

`map`在思考这个问题的同时，我还研究了将数组绑定到线程结果以使 Perl 程序流程`parallel`更像结果的方法。更多文档版本的代码将作为[对该线程](http://perlmonks.org/?node_id=712235)的回复发布，也可能发布到 CPAN 上。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-21T00:56:39.163

如果我没记错的话，for/foreach 无论如何都会首先获取整个列表，因此将完全读取一个懒惰评估的列表，然后它会开始遍历元素。因此，我认为除了使用 while 循环之外别无他法。但我可能错了。

while 循环的优点是您可以使用代码引用来伪造延迟评估列表的感觉：

```
my $list = sub { return calculate_next_element };
while(defined(my $element = &$list)) {
    ...
} 
```

毕竟，我想在 Perl 5 中，平局是最接近的。

# asp.net-mvc - 如何从 HandleError 过滤器返回 JSON？

> ID：109883
> 
> 赞同：12
> 
> 时间：2008-09-21T00:32:48.847
> 
> 标签：asp.net-mvc

aspnet mvc 具有 HandleError 过滤器，如果发生错误，它将返回一个视图，但是如果在调用 JsonResult Action 时发生错误，我如何返回表示错误的 JSON 对象？

我不想将代码包装在每个在 try/catch 中返回 JsonResult 的操作方法中来完成它，我宁愿通过添加“HandleJsonError”属性或使用现有的 HandleError 属性到所需的操作方法来做到这一点.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-21T17:45:28.147

看一下 HandleErrorAttribute 的 MVC 实现。它返回一个 ViewResult。您可以编写自己的版本 (HandleJsonErrorAttribute) 来返回 JsonResult。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-15T11:23:01.773

简而言之，可以采用扩展 HandleErrorAttribute 的方法，如下所示：

```
public class OncHandleErrorAttribute : HandleErrorAttribute
{
    public override void OnException(ExceptionContext context)
    {
        // Elmah-Log only handled exceptions
        if (context.ExceptionHandled)
            ErrorSignal.FromCurrentContext().Raise(context.Exception);

        if (context.HttpContext.Request.IsAjaxRequest())
        {
            // if request was an Ajax request, respond with json with Error field
            var jsonResult = new ErrorController { ControllerContext = context }.GetJsonError(context.Exception);
            jsonResult.ExecuteResult(context);
            context.ExceptionHandled = true;
        }
        else
        {
            // if not an ajax request, continue with logic implemented by MVC -> html error page
            base.OnException(context);
        }
    }
} 
```

如果不需要，请删除 Elmah 日志记录代码行。我使用我的一个控制器根据错误和上下文返回一个 json。这是示例：

```
 public class ErrorController : Controller
{
    public ActionResult GetJsonError(Exception ex)
    {
        var ticketId = Guid.NewGuid(); // Lets issue a ticket to show the user and have in the log

        Request.ServerVariables["TTicketID"] = ticketId.ToString(); // Elmah will show this in a nice table

        ErrorSignal.FromCurrentContext().Raise(ex); //ELMAH Signaling

        ex.Data.Add("TTicketID", ticketId.ToString()); // Trying to see where this one gets in Elmah

        return Json(new { Error = String.Format("Support ticket: {0}\r\n Error: {1}", ticketId, ex.ToString()) }, JsonRequestBehavior.AllowGet);
    } 
```

我在上面添加了一些票务信息，你可以忽略这个。由于过滤器的实现方式（扩展了默认的 HandleErrorAttributes），我们可以从全局过滤器中删除 HandleErrorAttribute：

```
 public class MvcApplication : System.Web.HttpApplication
{
    public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
        filters.Add(new GlobalAuthorise());
        filters.Add(new OncHandleErrorAttribute());
        //filters.Add(new HandleErrorAttribute());
    } 
```

基本上就是这样。您可以阅读[我的博客文章](http://plainoldstan.blogspot.cz/2012/08/mvc-3-elmah-handle-ajaxjson-action.html)以获取更详细的信息，但对于这个想法，以上就足够了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-21T00:54:26.407

也许您可以创建自己的属性并拥有一个构造函数值，该值采用 View 或 Json 的枚举值。下面是我使用自定义授权属性来演示我的意思。这样，当 json 请求的身份验证失败时，它会以 json 错误响应，如果它返回 View 则相同。

```
 public enum ActionResultTypes
   {
       View,
       Json
   }

    public sealed class AuthorizationRequiredAttribute : ActionFilterAttribute, IAuthorizationFilter
    {
        public ActionResultTypes ActionResultType { get; set; }

        public AuthorizationRequiredAttribute(ActionResultTypes actionResultType)
        {
            this.ActionResultType = ActionResultType;
        }
    }

    //And used like
    [AuthorizationRequired(ActionResultTypes.View)]
    public ActionResult About()
    {
    } 
```

# ruby - 正则表达式仅匹配 RAR 文件集中的第一个文件

> ID：109916
> 
> 赞同：1
> 
> 时间：2008-09-21T01:14:46.873
> 
> 标签：ruby, regex, rar

要查看在哪个文件上调用 unrar 命令，需要确定哪个文件是文件集中的第一个文件。

以下是一些示例文件名，其中 - 自然地 - 只有第一组应该匹配：

```
yes.rar
yes.part1.rar
yes.part01.rar
yes.part001.rar

no.part2.rar
no.part02.rar
no.part002.rar
no.part011.rar 
```

使用 PCRE 兼容的正则表达式的一种（有限）方法是：

```
.*(?:(?<!part\d\d\d|part\d\d|\d)\.rar|\.part0*1\.rar) 
```

[然而，当我在Rejax](http://www.projects.aphexcreations.net/rejax/)测试它时，这在 Ruby 中不起作用。

您将如何编写一个**与 Ruby 兼容**的正则表达式来仅匹配一组 RAR 文件中的第一个文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-03-29T13:13:38.813

不要依赖文件的名称来确定哪个是第一个。你最终会发现一个极端情况，你得到错误的文件。

[RAR 的标题](http://www.win-rar.com/index.php?id=24&kb_article_id=162)将告诉您哪个文件是卷中的第一个文件，假设它们是在最近的 RAR 版本中创建的。

> HEAD_FLAGS 位标志：
> 2 个字节
> 
> > 0x0100 - 第一卷（仅由 RAR 3.0 及更高版本设置）

因此，打开每个文件并检查 RAR 标头，专门寻找指示哪个文件是第一卷的标志。只要存档没有损坏，这永远不会失败。我已经对跨越 RAR 档案进行了自己的测试，并且根据上面的链接，它们的标题是正确的。

这是一种更安全的方法来确定哪个文件在这样的集合中首先出现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-21T03:31:40.227

简短的回答是，不可能构建一个单一的正则表达式来满足您的问题。Ruby 1.8 没有环视断言（ (?<! 在您的示例正则表达式中的东西），这就是您的正则表达式不起作用的原因。这给您留下了两个选择。

1) 使用多个正则表达式来做到这一点。

```
def is_first_rar(filename)
    if ((filename =~ /part(\d+)\.rar$/) == nil)
        return (filename =~ /\.rar$/) != nil
    else
        return $1.to_i == 1
    end
end 
```

2) 使用 ruby​​ 1.9, [Oniguruma](http://www.geocities.jp/kosako3/oniguruma/)的正则表达式引擎。它支持环视断言，您可以[将其安装为 ruby​​ 1.8 的 gem](http://oniguruma.rubyforge.org/)。之后，您可以执行以下操作：

```
def is_first_rar(filename)
    reg = Oniguruma::ORegexp.new('.*(?:(?<!part\d\d\d|part\d\d|\d)\.rar|\.part0*1\.rar)')
    match = reg.match(filename)
    return match != nil
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-21T03:08:24.493

我不是正则表达式专家，但这是我的尝试

```
^(yes|no)\.(rar|part0*1\.rar)$ 
```

将“yes|no”替换为实际文件名。我将它与您的示例进行了匹配，以查看它是否仅匹配第一组，因此正则表达式中的“是|否”。

更新：根据评论修复。不知道为什么用户不知道文件名所以我没有修复那个部分......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T03:09:18.423

在这种情况下，我个人不会使用（扩展）正则表达式（或者至少不只是一个来完成这一切）。例如，在几个`if`s 中编码有什么问题？

# vb6 - Visual Basic 6.0 中的多线程

> ID：109931
> 
> 赞同：15
> 
> 时间：2008-09-21T01:24:03.717
> 
> 标签：vb6

如何在visual basic 6.0中实现多线程。如果有人可以举个例子，那就太好了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-21T01:33:04.053

VB6 对于多线程应用程序来说并不是一个非常好的环境。没有开箱即用的支持，您需要深入研究标准的**WinAPI**函数。看看这篇文章，它提供了一个相当全面的示例：

[http://www.freevbcode.com/ShowCode.Asp?ID=1287](http://www.freevbcode.com/ShowCode.Asp?ID=1287)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-21T01:34:37.997

在几个项目中，我使用多个进程在 VB6 中实现了异步处理。基本上在一个与主进程分开的活动 exe 项目中有一个工作线程。然后可以将 worker exe 传递给它需要的任何数据并启动，引发一个事件以表示它已完成或主进程有数据。

它更消耗资源（一个额外的进程而不是线程），但 VB6 在单线程单元中运行，并且没有任何内置支持来启动新线程。

如果您确实需要在一个进程中拥有多个线程，我建议您考虑使用 .net 或 VC6 而不是 VB6。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-20T19:00:39.423

如果您尝试解决的问题是一个长计算并且您希望保持 UI 响应，那么一种可能性是`DoEvents`在长计算中频繁调用该函数。这样，您的程序可以处理任何 Windows 消息，因此 UI 将响应用户命令。您还可以设置一个取消按钮来指示您的进程需要结束。

如果这样做，则需要小心禁用任何可能导致问题的控件，例如在启动后再次运行长进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-23T11:26:53.070

您可以在 VB6 中使用 Interop Forms Toolkit 2.0 进行多线程处理。该工具包允许您利用 .NET 功能，而不必被迫升级。因此，您还可以将 .NET 用户控件用作 VB6 中的 ActiveX 控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-01T11:21:22.887

创建“Active X”控件来管理您的代码。每个控件都有自己的线程。您可以堆叠多个控件来做同样的事情，或者让单独的控件做独特的事情。

EG，你让一个从网上下载文件。添加十个控件，您将运行十个单独的线程下载，与实际程序正在运行的线程无关。本质上，它们都是交互式的窗口，由一个实例化的 mini-dll 程序控制。

没有比这更容易的了。您可以根据需要限制、打开和关闭它们，以及创建更多或删除它们。（索引就像表单上的任何其他“对象”一样。它们都是 active-x 控件，由 vb-runtime dll 简单地管理。）

# c# - linq 等效于通用函数的'select *' sql？

> ID：109934
> 
> 赞同：6
> 
> 时间：2008-09-21T01:25:30.887
> 
> 标签：c#, linq, generics, anonymous-types

我有一个通用<> 函数，它接受一个 linq 查询（'items'）并通过它枚举添加额外的属性。如何选择原始“项目”的所有属性而不是项目本身（如下面的代码）？

所以等价于sql: select *, 'bar' as Foo from items

```
foreach (var item in items)
{
    var newItem = new {
        item, // I'd like just the properties here, not the 'item' object!
        Foo = "bar"
    };

    newItems.Add(newItem);
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-21T01:55:54.667

没有简单的方法可以按照您的建议进行操作，因为 C# 中的所有类型都是强类型的，即使是您正在使用的匿名类型也是如此。不过，也不是不可能做到的。为此，您必须利用反射并在内存中发出您自己的程序集，添加一个包含您想要的特定属性的新模块和类型。可以使用以下方法从您的匿名项目中获取属性列表：

```
foreach(PropertyInfo info in item.GetType().GetProperties())
    Console.WriteLine("{0} = {1}", info.Name, info.GetValue(item, null)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-21T01:59:47.437

射击你写的正是我要发布的内容。我刚刚准备好一些代码：/

它有点令人费解，但无论如何：

```
ClientCollection coll = new ClientCollection();
var results = coll.Select(c =>
{
    Dictionary<string, object> objlist = new Dictionary<string, object>();
    foreach (PropertyInfo pi in c.GetType().GetProperties())
    {
        objlist.Add(pi.Name, pi.GetValue(c, null));
    }
    return new { someproperty = 1, propertyValues = objlist };
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-21T01:41:34.033

```
from item in items
where someConditionOnItem
select
{
     propertyOne,
     propertyTwo
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T03:04:01.010

要求物品将它们交给您。

反射是一种方法……但是，由于所有属性在编译时都是已知的，因此每个项目都可以有一个方法来帮助该查询获得所需的内容。

这是一些示例方法签名：

```
public XElement ToXElement()
public IEnumerable ToPropertyEnumerable()
public Dictionary<string, object> ToNameValuePairs() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-09-19T06:25:41.647

假设您有一个 Department 类的集合：

```
 public int DepartmentId { get; set; }
   public string DepartmentName { get; set; } 
```

然后像这样使用匿名类型：

```
 List<DepartMent> depList = new List<DepartMent>();
        depList.Add(new DepartMent { DepartmentId = 1, DepartmentName = "Finance" });
        depList.Add(new DepartMent { DepartmentId = 2, DepartmentName = "HR" });
        depList.Add(new DepartMent { DepartmentId = 3, DepartmentName = "IT" });
        depList.Add(new DepartMent { DepartmentId = 4, DepartmentName = "Admin" });
        var result = from b in depList
                     select new {Id=b.DepartmentId,Damartment=b.DepartmentName,Foo="bar" }; 
```

# c++ - 从长远来看，最好的方法是什么：C、Objective C 或 C++？

> ID：109937
> 
> 赞同：7
> 
> 时间：2008-09-21T01:28:06.437
> 
> 标签：c++, c, objective-c

我真正想要回归的一件事是 C++ 编程，但我不确定我应该回到 C++（我有一些基本的控制台编程知识）还是应该研究 C 或 Objective C？我正在关注长期和易于编码的问题，例如好的编辑器、编译器等，以及哪些是最快的设置和运行。

除此之外，您会建议使用什么软件来使用建议的语言？

[编辑]

有人提到，当我不知道我在做什么时，很难提出建议。目前我没有任何具体的计划，我只是考虑从这三种语言中的一种开始，以进行长期投资和工作，或者作为其他东西的跳板。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T01:31:20.610

如果您主要在 Windows 上工作，我建议您使用 C++。Microsoft 在新的 C++/CLI 和本机 C++ 编译器背后投入了大量工作。随着新的 TR1 和 C++0X 添加，过去存在的许多问题正在得到解决。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-21T01:32:44.023

我会说 - 选择你喜欢的任何语言并坚持一段时间。同时专注于算法。这些是程序的构建块。语言只是一种语言。

如果您已经学习/掌握了一种语言，只需几周时间就可以切换到不同的语言，尤其是如果您使用同一语言系列（例如 C、C++、Objective C、Java、C# 等）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-21T01:54:28.400

我真的只能说 C 和 C++。如果仅仅是因为有这么多遗留代码是在 C 和 C++ 中，那么学习两者都不会受到伤害。

纯 C 通常是操作系统、驱动程序开发或嵌入式开发环境的唯一选择。其他用途包括性能非常关键的时候——您希望尽可能“接近”机器内部。了解 C 永远不会有什么坏处，因为它的这些应用似乎不会很快消失。C 也是许多 *nix 应用程序的“通用语言”。因此，如果您想为很多开源项目（apache/svn/cvs/etc）做出贡献，了解 C 语言将是一项要求。

根据我的经验，当您希望像编写 C 代码一样“接近机器”时使用 C++，但您希望通过一些 OOP 来包含更高级别的抽象。C++ 的主要优势（也是最大的弱点）是它的多范式。它为您提供了几乎所有您可以在 C 中做的事情以及许多面向对象的功能。例如，您可以在创建类、进行继承/多态性时根据需要重用大量超优化的 C 代码——尽可能多的“面向对象”。甚至还有一些方法可以将一些函数式编程加入到混合中......

C++ 经常被批评为试图为太多人做太多事情。批评者说，作为一种尝试做所有事情的尝试，它在任何一件事上都不是很擅长。C++ 曾经是桌面应用程序的“通用语言”，但 Java 和 .Net 确实已经夺走了很多企业用户。尽管如此，许多既关心性能又使用大量额外的、有用的、通常只在 C++ 中可用的功能足够好的应用程序会选择 C++。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-21T01:29:03.703

如果你认为苹果有一天会统治世界，那么目标 C。

现在我认为 iPhone Cocoa 的开发是它的所在。所以，Obj-C，就个人而言。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-21T01:38:33.057

您可以忽略任何没有首先询问您实际要做什么的答案。如果没有这些信息，答案要么是错误的、具有误导性的，要么就是无关紧要的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-21T10:01:24.143

我的看法：

在您展示的三个选择中，您最好的初始选择可能是 C。一旦您了解 C、掌握其怪癖并精通它，学习 C++ 或 Objective-C 很可能是相当简单的。（您最难的点将在世界的面向对象方面。）

目前，在 Mac 上*最常*使用 Objective-C ，但有些人忘记了用于 Objective-C 的 GNU 工具，而 GNUStep 也支持这一点。（当前的 Mac OS X 很大程度上基于旧的 NextSTEP，GNUStep 或多或少是它的克隆。）然而，关于 Objective-C 的问题在于，它并没有在这两种环境之外广泛使用——这使它有点像狭窄的环境。（使用 Obj-C，就像几乎任何其他现代 OO 语言一样，您将花费更多的时间来学习框架类，而不是实际的底层语法/词法规则。）

我主要是 C# 开发人员。这支付了我的账单，而且做得很好。C# 不在您的列表中，我怀疑我知道原因：听起来您希望更接近金属，不那么抽象。我明白了——我认为这是长期职业发展的正确选择。我从我的代码和盒子之间的无数抽象开始（首先是专业的 Java，然后是 VB6，然后是 .NET），因此，我现在在业余时间努力工作以“赶上”其余的世界 - 我目前正在阅读[K&R 书](http://netlib.bell-labs.com/cm/cs/cbook/)。诚然，我没有专业的需要去接近金属——但我确实觉得个人需要尽可能地了解这台机器。

（另外，具有讽刺意味的是，我正在考虑通过 Objective-C 重新进入 Cocoa 开发。我在几年前曾经使用它，我认为我现在更有能力“获得”它......我个人觉得对 C 的预知将使迁移到 Objective-C 变得更容易、更顺畅，并且使我不太可能在我的代码中引入灾难性的内存相关错误！）

归根结底，我认为拥有 C 的预先存在的知识（虽然这对我来说显然不是必需的！）是一件非常好的事情，并且随着时间的推移可能会转向其他语言（你*会*做，除非你做操作系统、驱动程序或嵌入式工作）更容易和更流畅。我不是说“没有它你就活不下去”，我是说根据你的问题的措辞方式......我认为这是这种情况的正确答案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-21T14:21:09.603

我对您的问题的看法略有不同，最终建议您学习 Objective-C。我有几个原因。

第一，Obj-C 以一种非常不同的方式看待 OO 模型，因为它通常用 C++ 等语言实现。Obj-C 基于 Smalltalk，因此所有“方法调用”都实现为发送到适当对象的消息。由于这个程序员已经能够将其扩展为一些非常有趣且非常强大的技术。学习一门新语言的部分原因应该始终是扩展您对事物如何工作的看法——在这方面，Obj-C 比 C 或 C++ 具有更大的潜力。

第二，至少在 Mac 上，Obj-C 背后有一个极其强大的框架和一个优秀的工具链。C 和 C++ 在任何平台上都没有真正具有相同凝聚力的框架，尽管微软可能在它们的实现上接近。仅仅使用 Cocoa 就足以让我相信 Obj-C 是一门很棒的语言。图书馆经过深思熟虑，让我嫉妒那些每天都在使用它的人。

第三，Obj-C 是 C 的超集，所以通过学习它你已经熟悉了 C 的语法。另外，C 标准库非常贫乏，可以很快学会。C++ 稍微好一点，可以使用 boost，但是 boost 远没有 Cocoa 那样具有凝聚力。

最终你需要决定你的优先事项是什么。如果您只是想学习一些新东西，请使用 Obj-C。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-21T01:35:33.593

取决于你在做什么。如果我必须选择一个，我会说 C++。它比 Obj-C 更跨平台，比 C 更轻松。但如果你在做 Mac 编程，你会想了解 Objective-C。如果你正在做任何嵌入式编程或任何内核黑客，你可能想要使用 C。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-21T01:39:00.887

有没有理由不使用 C++ 而使用 C 或 Objective C？C++ 目前拥有迄今为止最广泛的社区、最大的现有代码库，并且是这三者中最好的。如果您认为这不是真的，请澄清（说真的，我真的很感兴趣）。

此外，就 .NET 而言，MS 仅支持 C++（当然，如果您计划有一天迁移到 .NET）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-21T01:40:48.340

从 C 开始，如果您需要面向对象，可以将您的知识扩展到 C++。Objective C 是一个像 Apple Script 这样的晦涩难懂的东西，只有 Apple 开发人员听说过（如果有的话），你不会对这种语言走得太远（无意冒犯该语言的粉丝）。

C 非常容易学习（与 C++ 相比），并且您对以后可能想要学习的任何其他语言（尤其是 C++）都有很好的基础知识。

关于 Loren Segal 的回答，当您想在 C 和 C++ 之间进行选择时，您想要做什么并不重要。这只是一个偏好问题。两者都有适用于所有内容的库（因为 C++ 库通常只是围绕 C 库的面向对象的包装器），两者都有庞大的社区、稳定的 IDE 和编译器。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-21T02:57:26.690

英特尔在 C++ 库上投入了大量资金，以便在其处理器上运行。由于英特尔最近似乎在 PC 处理器领域占据主导地位，这似乎是一个不错的选择。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-21T11:05:39.043

无论您随后专注于哪种其他编程语言，纯 C 都是一个很好的基础。尤其是 Objective-C 只是基本的 C 代码，上面散布着 smalltalk 的想法。尽管 C++ 与 C 相去甚远，但在我看来，C 仍然是最有用的语言。在 Objective-C 中，您经常使用 C。在 Ruby、Python、Erlang 和无数其他语言中，您也经常进入 C 模式。它也是一种您始终可以在您接触的每台计算机上使用的语言。

所以我个人认为每个程序员都应该真正了解C。至少一点点。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T23:37:53.040

在做了 10 年左右的 C++ 开发人员之后，我最近学习了 Objective-C（因为我开始玩 Cocoa）。

我发现除了 C++ 之外学习 Objective-C 的经验非常有启发性，即使我可能不会在任何实际项目中使用 Objective-C。

Objective-C 和 C++ 都在 C 之上添加了一层面向对象的编程。但是它们以几乎完全相反的方式进行。似乎每次 C++ 做出一个设计决策时，objective-C 都会做出相反的选择。例如，C++ 使用静态类型，而 Objective-C 使用动态类型。或者，（最近的）objective-C 使用了 C++ 没有的垃圾收集。

这真的让我更好地理解了面向对象编程的概念以及与之相关的设计选择。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-09-21T01:33:18.030

如果你只想专注于Windows操作系统，那么我建议直接从**C#（.Net Framework）开始**

# java - Xcode：“-source 1.3 不支持泛型”编译器错误？

> ID：109948
> 
> 赞同：2
> 
> 时间：2008-09-21T01:32:54.613
> 
> 标签：java, xcode, compiler-construction

只是一个简单的问题：

我是一名 CS 本科生，只使用过 Eclipse 和 Net Beans IDE。我最近买了一台 Macbook，想用 Xcode 重新编译一个最近的学校项目，只是为了测试一下。在我声明 ArrayList 的新实例的那一行之后：

```
dictionary = new ArrayList<String>(); 
```

我收到以下错误：**-source 1.3 不支持泛型**。

我只是想知道是否有人可以就问题所在提供建议。同一项目在同一台机器上的 Eclipse 中编译。我正在使用 Java 1.5.0_13 运行 OSX 10.5.4。

谢谢你。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T01:41:22.957

Xcode 中的 Java 支持已过时且未维护；它是 Xcode 中唯一仍然使用从 Project Builder 继承的“旧”构建系统的部分。甚至 Apple 也建议改用 Eclipse。对于 Java，Eclipse 和 NetBeans 在 Mac 上运行良好；如果您想尝试原生 Mac 编程，请使用 Xcode 适合的 Objective-C 和 Cocoa。

也就是说，问题在于 javac 的目标是 Java 1.3，它没有泛型。您可以修改 Ant 构建文件 (build.xml) 中的 javac 引用，如下所示：

```
 <target name="compile" depends="init" description="Compile code">
    <mkdir dir="${bin}"/>
    <javac deprecation="on" srcdir="${src}" destdir="${bin}"
           source="1.3" target="1.2" 
```

将“源”和“目标”更改为“1.5”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-21T01:36:42.967

Java 5 中引入了泛型，因此您不能将泛型与 -source 1.3 选项一起使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T17:42:05.447

build.xml 文件放在

```
/Developer/Library/XCode/Project Templates/Java/Java Tool/build.xml 
```

（用您自己的项目替换 Java Tool）。

如果您`source="XX" target="YY"`在第 30 行查找，并将 XX 和 YY 更改为您的首选值，事情会变得更好，就像在之前的帖子中解释的那样。

干杯，

彼得

# asp.net - 我应该如何组织我的 ASP.Net 主题和常见的 CSS 文件

> ID：109970
> 
> 赞同：6
> 
> 时间：2008-09-21T01:42:12.313
> 
> 标签：asp.net, css, themes

我目前正在从事一个项目，其中一位自认为是图形设计师的程序员尝试使用 ASP.Net 主题。CSS 非常糟糕，但这完全是另一个问题。

我真正需要帮助的是组织 ASP.Net 主题和其中的 CSS 的最佳方式。想象一下，有一个看起来像这样的目录结构：

*   主题
    *   主题一
        *   样式A.css
        *   *通用.css*
    *   主题 B
        *   样式B.css
        *   *通用.css*
    *   主题 C
        *   样式C.css
        *   *通用.css*

每个主题都有一个共同的样式表。*不幸的是，这些样式表的作者只设法在Common.css*的每个副本中到处更改了一些内容。最终，我将评估这些更改是否必要，但首先需要进行一些重大清理。现在只是假设这些变化非常小，对于每个主题看起来都正确。

我想知道使用主题的最佳实践是什么，同时还需要在您的应用程序中使用一些通用样式。我想最大限度地减少页面加载中的 AppTurn 数量，但我真的想以一种保持主题易用性的方式将常用样式合并到一个地方。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-21T02:54:30.767

您应该只在网站中包含标准/通用 css 并将其包含在母版页的头部，而不是将其放在主题中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-15T13:23:38.183

我为此写了一篇小文章：

[http://www.sambeauvois.be/blog/2010/01/dont-repeat-your-common-css-between-your-different-themes/](http://www.sambeauvois.be/blog/2010/01/dont-repeat-your-common-css-between-your-different-themes/)

稍后我将使用更多信息完成它

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-21T03:11:18.043

是的，直接引用通用 CSS 文件，而不是放在主题文件夹中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-30T09:13:15.997

但是，如果您在使用母版页的子文件夹中有一个网页怎么办？那么css文件的页面不会出错吗？

# ruby-on-rails - 为什么我应该在 Rails 中使用 RSpec 或 shoulda？

> ID：109976
> 
> 赞同：33
> 
> 时间：2008-09-21T01:47:01.147
> 
> 标签：ruby-on-rails, ruby, unit-testing, testing, shoulda

我正在设置一个 Rails 应用程序，我刚刚完成了一些单元测试，我的朋友说显然夹具不再酷，人们现在正在使用 RSpec 或 shoulda。我想知道使用这些其他工具包的实际好处是什么。任何信息都表示赞赏。

-fREW

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-21T11:42:57.860

我个人更喜欢Shouda而不是RSpec。我发现 Shoulda 的魔法语法比 RSpec 少。我对 RSpec 的问题是，是的，当我大声朗读它时它非常易读，但是当我开始编写它时，嗯，我永远不确定应该*如何*编写给定的断言。[Prag Dave 比我更好地解释了这个问题](http://pragdave.blogs.pragprog.com/pragdave/2008/03/the-language-in.html)。他也[喜欢Shouda](http://pragdave.blogs.pragprog.com/pragdave/2008/04/shoulda-used-th.html) ，并举了几个例子。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-21T01:57:42.433

RSpec 和类似框架是旨在帮助行为驱动开发的工具。它们不仅是编写测试的更漂亮的方式，尽管它们确实对此有所帮助。

这里有很多关于 BDD 的信息：http: [//behaviour-driven.org/](http://behaviour-driven.org/) 和维基百科：[http ://en.wikipedia.org/wiki/Behavior_Driven_Development](http://en.wikipedia.org/wiki/Behavior_Driven_Development)

这里列出的好处太多了，所以我建议稍微浏览一下那个网站。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-22T11:27:41.727

这里有两个不同的东西：

首先是使用什么框架来编写测试/规范。在这里，您可以在 Test::Unit、RSpec、Shouda 等之间进行选择。选择是您是否想要执行传统的 TDD（Test::Unit），或者您是否更喜欢[David Chemlinsky](http://blog.davidchelimsky.net/)（RSpec 和某种程度上的 Shoulda）等开发人员所倡导的指定行为的替代思考方式。

第二件事是如何处理测试数据。有 Rails 固定装置和替代方案设计有其他目标，例如[FixtureReplacement 插件](http://replacefixtures.rubyforge.org/)。在 Rails 2.0 之前，fixture 存在重大且有据可查的实际问题。Rails 2.0 中修复了许多实际问题。然而，夹具可能会导致无意的测试耦合，一些替代方案试图避免这种情况。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-21T01:51:28.657

RSpec 更强大，因为它更容易读取和编写测试。使用模拟和存根时它也非常优雅，一旦你开始在测试中使用它们，这个概念将变得非常有用。在一个简单的测试应用程序（NON RAILS！）中尝试它，您会发现您的规格与同等标准测试相比有多优雅。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-23T11:56:37.517

查看 Josh Susser 的[The Great Test Framework Dance-off](http://blog.hasmanythrough.com/2008/6/1/the-great-test-framework-dance-off)以比较流行的 Ruby 测试框架。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-02-07T10:00:33.017

如果您正在构建一个大型应用程序并且没有一个团队都非常擅长编写可以通过黑盒测试进行良好测试的解耦代码，并且准备完全接受使用/调试大量模拟和存根，请不要不要沿着工厂路走。

无论你在哪里读到关于 Awesome Factories Are 的文章，你都会看到一些关于工厂在大型应用程序中可能不可行的警告，因为它们比固定装置慢一点。

但是“慢一点”确实慢了几个数量级。

工厂并不比使用标签作为 id 的夹具容易得多，只要您保持夹具井井有条。在某些情况下，工厂更难调试。

就在今晚，我将一个工厂转换为固定装置，使用它的测试文件的运行时间从 65 秒变为 15 秒，尽管该测试文件中只有大约 15% 的测试使用该工厂。

如果你使用 minitest，你可以随机运行你的测试；这将很快揭示测试之间的任何数据耦合。（不确定 rspec 是否可以选择随机化测试顺序）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-10T10:48:46.493

Test::Unit 适用于小型应用程序。但是使用像 Shoulda 或 RSpec 这样的测试框架有很多好处，例如上下文！

我不认为应该和 RSpec 存在非此即彼的关系。在进行单断言测试时，我使用 Shoulda 作为 RSpec 的替代品。我真的很喜欢 Shoulda 单线，但是在 RSpec 中编写匹配器要容易得多。所以我的建议是在最适合的地方使用不同的测试工具。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-11T14:18:55.357

您可以使用 Cucumber 之类的测试框架，它比 RSpec 更快。

# flash - 如何获得基于硬件的屏幕截图？

> ID：109993
> 
> 赞同：3
> 
> 时间：2008-09-21T01:55:57.227
> 
> 标签：flash, video, video-capture

过去，我的一些项目要求我创建全屏 Flash 应用程序的电影版本。最简单的方法是获取屏幕截图。但是，捕获超过 1024x768 的任何内容都会导致视频断断续续，这是不可接受的。我知道有用于捕获全屏视频的基于硬件的解决方案，但我无法找出这些是什么。我的输出需要可缩放到 1920x1080，并生成一个没有断断续续的未压缩 AVI 文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-21T02:16:01.563

各种专业产品支持全高清拍摄：

[http://www.decklink.com/products/hd/](http://www.decklink.com/products/hd/)

[http://www.aja.com/](http://www.aja.com/)

还有其他的。捕获完整的、未压缩的数字或模拟流是一项非常艰巨的要求。

-亚当

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-21T02:42:00.470

如果 Flash 应用程序是非交互式的，那么有许多工具可以对 AVI 文件或一系列 PNG 文件进行非实时捕获（但完全流畅和完美）。

如果它是交互式的并且您绝对需要实时捕获，FRAPS 实际上可能能够完成这项工作，至少在 Vista 上，通过使用 Aero 作为图形层来操作 FRAPS 录制各种非 DirectShow 应用程序通常并不难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-21T03:06:27.243

如果将影片加载到 Flash ActiveX 控件中，则可以调用控件上的[`IViewObject::Draw`](http://msdn.microsoft.com/en-us/library/ms688655(VS.85).aspx)方法（或[`OleDraw`](http://msdn.microsoft.com/en-us/library/ms692711(VS.85).aspx)辅助函数）将其绘制到您选择的 DC 中，并循环播放动画中的每一帧。提取音频会更加困难，但是如果您在内部制作了动画，那应该不会太麻烦。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-21T02:01:36.713

幸运的是，您的图形适配器已经具有模拟视频输出。您可以连接 DVD 刻录机，然后在独立的硬件盒上将视频信号数字化。

不过，这不会给你 1920x1080。

如果您真的需要获得高于 dvd 分辨率的捕获，您需要专业的（而且*非常*昂贵）的视频捕获设备。

# 编辑：

顺便说一句，如果您想以 30 帧/秒未压缩的速度捕获 1920x1080 的真彩色，您必须以某种方式存储大约**237 兆字节/秒**。只是为了让您了解您必须处理多少数据...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-21T02:01:39.320

[飞利浦dvdr3575h](http://www.google.com/products/catalog?rlz=1C1GGLS_enUS291&sourceid=chrome&ie=UTF-8&q=dvd+recoreder+hdd&um=1&cid=9245182892068372171&sa=X&oi=product_catalog_result&resnum=1&ct=result#ps-tech-specs) 等机顶盒可能是最简单的。但是，我不相信他们支持您正在寻找的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-21T09:12:20.657

If you don't need to click around in the movie Flash CS3 supports frame by frame export of Flash movies (including scripted stuff).

Open up your animation in Flash, if you don't have a .fla available making a simple wrapper that loads your swf should work too. Then go File -> Export -> Export movie, and choose Quicktime. Set the various fiddly bits to your liking, and then Flash will step through your animation as fast as it can, saving you both the risk of dropped frames and having to wait for a 1 fps capture.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-20T23:59:51.850

[http://rgb.com/](http://rgb.com/) I've looked at their product before - very high end/expensive but perfect video and it's a hardware solution so it's not processor intensive on the machine you are trying to do the demo on.

# security - 您如何保护您的软件免受非法分发？

> ID：109997
> 
> 赞同：92
> 
> 时间：2008-09-21T01:58:00.357
> 
> 标签：security, licensing, protection, software-distribution, piracy

我很好奇您如何保护您的软件免受破解、黑客攻击等。

您是否使用某种序列号检查？硬件钥匙？

您是否使用任何第三方解决方案？

您如何解决许可问题？（例如管理浮动许可证）

编辑：我不是在谈论任何开源，而是严格的商业软件分发......

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-21T02:24:32.180

有很多很多很多的保护措施可用。关键是：

*   评估你的目标受众，以及他们愿意忍受什么
*   了解观众对免费游戏的渴望
*   评估某人愿意为破坏您的保护而付出的金额
*   应用足够的保护来防止大多数人逃避付款，同时又不会惹恼那些使用您的软件的人。

没有什么是牢不可破的，所以衡量这些东西并选择一个好的保护比简单地拍打你能负担得起的最好（最差）的保护更重要。

*   简单的注册码（在线验证一次）。
*   使用可撤销密钥进行简单注册，经常在线验证。
*   加密密钥包含程序算法的一部分（不能只是跳过检查 - 它必须运行才能使程序工作）
*   硬件密钥（公钥/私钥加密）
*   硬件密钥（包括在密钥上运行的程序算法部分）
*   Web 服务运行关键代码（黑客永远看不到它）

以及上述的变体。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-21T02:22:25.337

无论您走哪条路，都要收取合理的价格，使其易于激活，提供免费的小更新，并且永远不要停用他们的软件。如果您尊重您的用户，他们会因此而奖励您。尽管如此，无论您做什么，有些人最终都会盗版。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-21T03:52:33.530

不。

海盗会海盗。无论您想出什么解决方案，它都可以并且将会被破解。

另一方面，您的实际付费客户是那些因废话而感到不便的客户。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-09-21T02:30:09.610

让买比偷更容易。如果您设置大量复制保护，那么它只会使拥有真实交易的价值变得非常低。

使用简单的激活密钥并向客户*保证*，如果他们丢失了激活密钥，他们可以*随时获得激活密钥或重新下载软件。*

您可以假设的任何复制保护（除了在线组件，如多人游戏和连接到您的银行的金融软件等）都会被击败。至少，您希望非法下载软件比购买软件稍微难一些。

我有一个我从未打开过的 PC 游戏，因为上面有太多的复制保护垃圾，实际上下载假版本更容易。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-21T02:11:51.043

软件保护不值钱——如果你的软件有需求，无论如何它**都会被打败。**

也就是说，硬件保护可以很好地工作。它可以很好地工作的一个示例方法是：找到一个（相当）简单但必要的软件组件，并在 Verilog/VHDL 中实现它。生成一个公私密钥对并创建一个接受挑战字符串并使用私钥对其进行加密的 Web 服务。然后制作一个包含您的公钥并生成随机挑战字符串的 USB 加密狗。您的软件应该向 USB 加密狗询问质询字符串并将其发送到服务器进行加密。然后软件将其发送到加密狗。加密狗使用公钥验证加密的质询字符串并进入“启用”模式。然后，您的软件会在需要执行您用 HDL 编写的操作时调用加密狗。

编辑：刚刚意识到一些验证的东西与它应该是相反的，但我很确定这个想法会出现。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-09-21T16:35:14.180

Microsoft 软件许可计划对于小型企业来说非常昂贵。如果您想自己设置服务器，服务器成本约为 12,000 美元。我不推荐它来伪装心脏。

我们实际上只是在我们的产品中实现了[Intellilock 。](http://www.eziriz.com/intellilock.htm)它让您可以决定您希望您的许可证有多严格，而且它也非常具有成本效益。此外，它还进行混淆、编译器预防等。

我看到小型/医疗企业使用的另一个很好的解决方案是[SoloServer](http://www.softwarekey.com/swk_products/solo/server/)。它更像是一个电子商务和许可证控制系统。它是非常可配置的，可能有点太复杂了。但从我所听到的情况来看，它做得非常好。

过去，我也使用过[Desaware 许可证](http://www.desaware.com/support/faq/licensing/index.aspx)系统用于 dot net。与上述两个相比，它是一个非常轻量级的系统。就密码学而言，它是一个非常好的许可证控制系统。但它是一个非常低级的 API，您必须在其中实现应用程序实际使用的几乎所有内容。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-21T03:48:36.987

数字“权利”管理是业内最大的软件蛇油产品。借用经典密码学的一页，典型的场景是 Alice 想在 Charlie 无法阅读的情况下将消息发送给 Bob。DRM 不起作用，因为在其应用程序中，Bob 和 Charlie 是同一个人！

你最好问相反的问题，即“我如何让人们购买我的软件而不是窃取它？” 这是一个非常广泛的问题。但它通常从做研究开始。您找出谁购买了您希望销售的软件类型，然后生产出吸引这些人的软件。

对此的附加措施是将更新/附加组件限制为仅合法副本。这可以像购买交易期间收到的订单代码一样简单。

看看 Stardock 软件、WindowBlinds 的制造商和太阳帝国的罪恶之类的游戏，后者没有 DRM，并且从 200 万美元的预算中获得了可观的利润。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-21T02:02:39.020

有几种方法，例如使用处理器 ID 生成“激活密钥”。

底线是，如果有人想要它足够糟糕 - 他们会逆向设计你拥有的任何保护。

最安全的方法是在运行时使用在线验证或硬件搭扣。

祝你好运！

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-21T02:22:05.230

只要一点时间，您的软件总会被破解。您可以搜索任何知名软件的破解版本以确认这一点。但仍然值得为您的软件添加某种形式的保护。

请记住，不诚实的人永远不会为您的软件付费，并且总是会找到/使用破解版。即使没有许可计划，非常诚实的人也会始终遵守规则，因为他们就是这样的人。但大多数人介于这两个极端之间。

添加一些简单的保护方案是让大部分中间人诚实行事的好方法。这是一种促使他们记住该软件不是免费的并且他们应该为适当数量的许可证付费的方法。许多人确实对此做出了回应。企业特别擅长遵守规则，因为经理不会花自己的钱。消费者不太可能遵守规则，因为这是他们自己的钱。

但最近发布的诸如来自*Electronic Arts的**Spore*的经验表明，您可以在许可方面走得更远。如果你让合法的人觉得自己像罪犯，因为他们不断得到验证，那么他们就会开始反抗。所以添加一些简单的许可来提醒人们他们是否不诚实，但除此之外的任何东西都不太可能促进销售。

 ** * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-21T01:59:23.630

像魔兽世界（WoW）这样的在线游戏已经制作出来了，每个人每次都必须连接到服务器，因此可以不断验证帐户。没有其他方法适用于 bean。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-21T02:32:04.923

通常有两个系统经常被混淆 -

*   许可或激活跟踪，合法合法使用
*   安全防止非法使用

对于使用商业包的许可，[FlexLM](http://en.wikipedia.org/wiki/FLEXlm)许多公司在许可上投入巨资认为他们也获得了安全性，这是一个常见的错误，这些商业包的密钥生成器非常丰富。

如果您将产品出售给会根据使用情况合法付款的公司，我只会建议您获得许可，否则它可能会付出更多的努力而不是其价值。

请记住，随着您的产品取得成功，所有的许可和安全措施最终都会遭到破坏。所以现在决定是否真的值得付出努力。

几年前，我们实现了 FlexLM 的洁净室克隆，我们还必须增强我们的应用程序以抵御二进制攻击，它的过程很长，你必须在每个版本中重新访问它。这还取决于您也销售哪些全球市场，或者您的主要客户群在哪里，您需要做什么。

查看我关于[保护 DLL](https://stackoverflow.com/questions/106347/secure-dll-with-license-file#107503)的另一个答案。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-21T04:04:33.797

不完全是您正在寻找的答案，但它是来自游戏开发者的关于盗版的重要资源，该游戏开发者积极询问他们的*盗版*者他们为什么这样做。并且与您选择的答案的第一部分有关。

在 [与海盗交谈中](http://www.positech.co.uk/talkingtopirates.html)阅读。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-21T02:26:27.090

正如已经指出的，软件保护永远不能保证是万无一失的。您打算使用什么很大程度上取决于您的目标受众。例如，游戏不是您可以永远保护的东西。另一方面，服务器软件不太可能在 Internet 上分发，原因有很多（想到产品渗透和责任；大公司不想为盗版软件承担责任，以及海盗只关心需求量足够大的东西）。老实说，对于一个备受瞩目的游戏，最好的解决方案可能是自己播种种子（秘密！）并以某种方式对其进行修改（例如，在玩了两周后它会弹出消息告诉你请考虑通过购买合法副本来支持开发人员）。

如果您采取保护措施，请记住两件事。首先，较低的价格将通过使人们更倾向于支付购买价格来补充任何复制保护。其次，保护不能妨碍用户 - 请参阅最近的示例 Spore。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-21T17:08:29.263

DRM this, DRM that - 将 DRM 强制用于项目的出版商正在这样做，因为它是有利可图的。他们的经济学家根据我们谁都看不到的数据得出了这一结论。“DRM 是邪恶的”巨魔走得太远了。

对于低知名度的产品，简单的互联网激活将停止随意复制。任何其他复制对于您的底线来说都可能微不足道。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-11-07T06:24:50.277

非法分发实际上是不可能防止的；问问美国唱片工业协会。数字内容只能被复制；模拟内容可以数字化，然后复制。

您应该集中精力防止未经授权的*执行*。永远不可能完全阻止代码在其他人的机器上执行，但是您可以采取某些步骤将标准提高到足够高，以使购买您的软件比盗版更容易。

查看[为软件保护和许可](http://www.offbyzero.com/resources/software_protection_licensing)而开发的文章，它解释了如何最好地在考虑许可的情况下开发应用程序。

强制性免责声明和插件：我共同创立的公司[为 .NET 生产 OffByZero Cobalt 软件许可解决方案](https://cobalt.offbyzero.com/)。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-03-17T09:06:04.530

这种让海盗使用它的想法的麻烦是他们无论如何都不会购买它并且会向可能购买它的朋友展示它是双重的。

1.  对于使用 3rd 方服务的软件，盗版副本正在占用宝贵的带宽/资源，这给合法用户带来更差的体验，让我的 sw 看起来更受欢迎，并且 3rd 方服务要求我为他们的服务支付更多费用，因为正在使用的带宽。

2.  许多休闲人士不会梦想自己破解 sw，但如果在 piratebay 这样的网站上存在易于评估的破解，他们会使用它，如果没有，他们可能会购买。

这种发现盗版软件不禁用的概念也似乎很疯狂，我不明白为什么我应该让别人继续使用他们不应该使用的软件，我想这只是盗版者的观点/希望。

此外，值得注意的是，使程序难以破解是一回事，但您还需要防止共享合法副本，否则有人可以简单地购买一份副本，然后
通过洪流站点与成千上万的其他人共享。将他们的姓名/电子邮件地址嵌入许可证这一事实不足以阻止每个人这样做，而且只需要一个就可以解决问题。

我能看到防止这种情况的唯一方法是：

1.  每次程序启动时服务器检查并锁定许可证，程序退出时释放许可证。如果另一个客户端以相同的许可证开始，而第一个客户端具有许可证，则它被拒绝。这种方式不会阻止多个用户使用许可证，但确实可以防止多个用户同时使用许可证 - 这已经足够了。它还允许合法用户在他们的任何计算机上传输许可证，从而提供更好的体验。

2.  在第一次客户端启动时，客户端向服务器发送许可证，服务器对其进行验证，从而在客户端软件中设置一些标志。来自具有相同许可证的其他客户端的进一步请求将被拒绝。这种方法的问题是，如果他们重新安装软件或想使用不同的计算机，原始客户端会出现问题。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-05-27T00:07:15.217

即使您使用某种生物指纹认证，也有人会找到破解它的方法。确实没有实际的解决方法。与其试图让您的软件防黑客攻击，不如考虑通过添加额外的复制保护将带来多少额外收入，以及实施它所需的时间和金钱。在某些时候，使用不那么严格的复制保护方案会变得更便宜。

这取决于您的软件产品究竟是什么，但一种可能性是将程序的“有价值”部分移出软件并保持在您的专有控制之下。您将为软件收取少量费用（主要用于支付打印和分发成本），并从外部组件中获得收入。例如，以低价出售（或与其他产品免费捆绑）但出售其病毒定义更新服务订阅的防病毒程序。使用该模型，订阅您的更新服务的盗版副本不会造成太大的经济损失。随着“云端”应用程序的日益普及，这种方法变得越来越容易实施；在您的云上托管应用程序，并向用户收取云访问费用。这不

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-21T02:15:46.850

如果您对保护打算出售给消费者的软件感兴趣，我会推荐各种许可证密钥生成库中的任何一种（Google 搜索许可证密钥生成）。通常用户必须给你一些种子，比如他们的电子邮件地址或姓名，然后他们会取回注册码。

有几家公司将托管和分发您的软件或提供完整的安装/购买应用程序，您可以集成并自动执行此操作，可能无需您额外付费。

我已经向消费者出售了软件，我发现这是成本/易用性/保护之间的正确平衡。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-21T22:26:40.530

简单且最佳的解决方案就是预先为它们充电。设定一个适合您和他们的价格。

要求付费客户在他们已经付款后证明他们是付费客户只会让他们生气。实施代码以使您的软件无法运行会浪费您的时间和金钱，并为合法客户带来错误和烦恼。你最好把时间花在制作更好的产品上。

许多游戏/等会“保护”第一个版本，然后由于与真实客户的兼容性问题而放弃第一个补丁中的保护。如果你坚持一点保护，这不是一个不合理的策略。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-21T22:32:16.177

几乎所有的复制保护都是无效的，而且是可用性的噩梦。其中一些，例如将root-kits放在客户的机器上变得完全不道德

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-22T16:26:38.810

我建议使用简单的激活密钥（即使您知道它可能会被破坏），您真的不希望您的软件妨碍您的用户，否则他们会简单地将其推开。

确保他们可以重新下载软件，我建议他们只有在付费后才可以登录和下载您的软件的网页（是的，他们应该能够直接下载任意次数，没有一个问题关于你的原因）。

把你的付费用户放在首位，当你是合法用户时，没有什么比被指控为罪犯更令人恼火的了（DVD 的反盗版警告任何人）。

您可以添加一项服务，在联机时根据服务器检查密钥，如果两个不同的 IP 使用相同的密钥，则弹出购买另一个许可证的建议。

但是请不要停用它，它可能是一个快乐的用户向朋友展示您的软件！！！！

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-21T02:09:41.500

使您的产品的一部分成为需要连接和身份验证的在线组件。这里有些例子：

*   线上游戏
*   病毒防护
*   垃圾邮件防护
*   笔记本电脑跟踪软件

不过，这种范式只能走这么远，并且可以关闭一些消费者。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-21T16:16:28.530

我同意许多发帖者的观点，即没有任何基于软件的复制保护方案可以阻止熟练的软件盗版者。对于基于 .NET 的商业软件，Microsoft 软件许可保护 (SLP) 是一种价格非常合理的解决方案。它支持限时和浮动许可证。他们的起价为每月 10 美元 + 每次激活 5 美元，并且保护组件似乎像宣传的那样工作。不过，这是一个相当新的产品，所以买家要小心。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-05-26T23:29:29.677

我们使用我们自己的许可系统对我们的商业软件进行许可——这就是我们所销售的（许可管理工具）。我们通常出售订阅许可证，但如果我们愿意，也可以根据使用情况出售。到目前为止，它对我们来说是安全的：www.agilis-sw.com

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-02-11T13:39:55.997

如果您是软件开发人员，可能的解决方案之一是将元数据直接嵌入到您的产品中。查看 theredsunrise 的实例销毁安全工具。*************************