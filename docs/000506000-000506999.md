# StackOverflow 问答 000506000-000506999

# asp.net-mvc - 带有默认空选项的 ASP.NET MVC 下拉菜单

> ID：506001
> 
> 赞同：81
> 
> 时间：2009-02-03T04:23:01.437
> 
> 标签：asp.net-mvc, html.dropdownlistfor, html-select

如果下拉列表没有选定值，有没有办法包含默认的空选项（或带有文本）？

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-02-03T04:39:52.463

下面将在 ViewData["Menu"] 项中指定的 SelectList（或 IEnumerable）前面添加 string.Empty。选择将具有 id 和 name `MenuID`。

```
<%= Html.DropDownList( "MenuID",
                      (IEnumerable<SelectListItem>)ViewData["Menu"],
                      string.Empty ) %> 
```

文档：[DropDownList 方法](http://msdn.microsoft.com/en-us/library/dd492883.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2016-02-01T17:00:22.603

**例如：**

```
 Controller :

    private void InitScreenInfoCollate()
    {   
        IEnumerable<MstBrd> listbrd = ibrandRepository.GetItemsByUsercode("");
        ViewBag.Brands = new SelectList(listbrd, "brd_cod", "brd_mei", null);

    }

    View :
    @Html.DropDownList("Brands", null, string.Empty, new { @class = "form-control"}) 
```

结果 ：

[![内嵌图片](https://i.stack.imgur.com/738Dg.png)](https://i.stack.imgur.com/738Dg.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-16T22:19:46.597

这个简单的解决方案适用于我的 mvc5 项目：

**鉴于：**

```
@{
     Model.ModelItemsList.Add(new ModelItem{ });
     SelectList modelItemSelectList = new SelectList(Model.ModelItemsList, "ModelItemID", "ModelItemName");
} 
```

只需将新项目添加到`List<>`要在视图中显示的项目即可。就我而言，我在我的`List<ModelItem> ModelItemList`. 由于我的 ModelItemID 是一个 Guid，我必须在我的控制器方法中检查 Guid.Empty 并执行一些代码。就这样。

* * *

## 回答 #4

> 赞同：-8
> 
> 时间：2013-02-01T21:39:25.700

这里提出的解决方案对我来说效果很好：[http ://forums.asp.net/t/1142484.aspx/1](http://forums.asp.net/t/1142484.aspx/1)

基本思想是，您将to的`AppendDataBoundItems`属性设置为然后将其放入，这将成为您的默认项，所有数据绑定项都在其后。`DropDownList``true``asp:ListItem``DropDownList`

# c# - 编写泛型扩展方法时的类型推断问题

> ID：506003
> 
> 赞同：3
> 
> 时间：2009-02-03T04:24:02.560
> 
> 标签：c#, generics, extension-methods

我真的很讨厌有时`IDictionary<TKey, TValue> [key]`如果字典中不存在密钥，将如何抛出异常。

当然有`TryGetValue()`，但这似乎已经针对性能而非可用性进行了优化。

所以我想，哦，我会为它做一个扩展方法——我做了：

```
public static class CollectionExtensions
{
    public static TType GetValueOrDefault<TKeyType, TValue, TType>(this IDictionary<TKeyType, TType> dictionary, TKeyType key)
    {
        TType value = default(TType);

        // attempt to get the value of the key from the dictionary
        // if the key doesn't exist just return null
        if (dictionary.TryGetValue(key, out value))
        {
            return value;
        }
        else
        {
            return default(TType);
        }
    }    
} 
```

这很好用，除了我似乎无法让类型推断工作。

显然我希望能够做到以下几点：

```
var extraDataLookup = new Dictionary<string, string>();
extraDataLookup["zipcode"] = model.Zipcode; 
```

然后能够访问该值：

```
var zipcode = extraDataLookup.GetValueOrDefault("zipcode");
var foo = extraDataLookup.GetValueOrDefault("foo"); // should be null 
```

我看过一些关于类型推断的东西，将[Jon Skeet 的文章](http://msmvps.com/blogs/jon_skeet/archive/2008/08/06/making-the-most-of-generic-type-inference.aspx)甚至源代码引入`System.Linq.Enumerable`到[反射器](http://www.red-gate.com/products/reflector/)中，但似乎遗漏了一些东西。

这有效：

```
extraDataLookup.GetValueOrDefault<string, string,string> ("foo") 
```

但这不是

```
extraDataLookup.GetValueOrDefault ("foo") 
```

我该怎么办。

PS。我只是在寻找通用类型推断问题的解决方案，而不是任何其他建议。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T04:34:06.440

当您只需要两种时，您似乎正在用三种泛型类型定义您的扩展方法。“TValue”和“TType”的意思是一样的，不是吗？试试这个：

```
public static TValue GetValueOrDefault<TKey, TValue>(
    this IDictionary<TKey, TValue> dictionary, TKey key)
{
    TValue value;
    // attempt to get the value of the key from the dictionary
    dictionary.TryGetValue(key, out value);
    return value;
} 
```

# perl - 我应该手动设置 Perl 的 @ARGV 以便我可以使用 <> 打开、扫描和关闭文件吗？

> ID：506009
> 
> 赞同：5
> 
> 时间：2009-02-03T04:27:24.267
> 
> 标签：perl, file, input

我最近开始学习 Perl，我最近的一个任务是在一堆文件中搜索一个特定的字符串。用户提供目录名称作为参数，程序在该目录中的所有文件中搜索模式。使用`readdir()`我已经设法构建了一个包含所有可搜索文件名的数组，现在需要搜索每个文件的模式，我的实现看起来像这样 -

```
sub searchDir($) {
    my $dirN = shift;
    my @dirList = glob("$dirN/*");
    for(@dirList) {
        push @fileList, $_ if -f $_;

    }
    @ARGV = @fileList;
    while(<>) {
        ## Search for pattern
    }
} 
```

我的问题是 - 是否可以像上面那样手动加载 @ARGV 数组并使用 <> 运算符扫描单独的行，还是应该单独打开/扫描/关闭每个文件？如果这个处理存在于子程序中而不是主函数中，会有什么不同吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T05:25:39.190

关于操纵@ARGV 的话题——这绝对是有效的代码，Perl 肯定允许你这样做。不过，我认为这不是一个好的编码习惯。我看到的大多数使用“while (<>)”习语的代码都是使用它从标准输入中读取，这就是我最初希望您的代码执行的操作。更易读的模式可能是单独打开/关闭每个输入文件：

```
foreach my $file (@files) {
    open FILE, "<$file" or die "Error opening file $file ($!)";
    my @lines = <FILE>;
    close FILE or die $!;

    foreach my $line (@file) {
        if ( $line =~ /$pattern/ ) {
            # do something here!
        }
    }
} 
```

这对我来说会更容易阅读，尽管它是几行代码。Perl 为您提供了很大的灵活性，但我认为这使得在 Perl 中开发自己的风格变得更加重要，这种风格对您（以及您的同事，如果这对您的代码/职业很重要）来说是可读和可理解的。

将子例程放在主函数或子例程中也主要是您应该尝试和思考的风格决定。现代计算机在这方面的速度如此之快，以至于样式和可读性对于这样的脚本更为重要，因为您不太可能遇到这样的脚本使您的硬件负担过重的情况。

祝你好运！Perl 很有趣。:)

编辑：当然，如果他有一个非常大的文件，他应该做一些比将整个文件吞入数组更聪明的事情。在这种情况下，这样的事情肯定会更好：

```
while ( my $line = <FILE> ) {
    if ( $line =~ /$pattern/ ) {
        # do something here!
    }
} 
```

当我写“您不太可能遇到这样的脚本使您的硬件负担过重的情况”时，这一点旨在涵盖这一点，抱歉没有更具体。再说了，谁还有 4GB 的硬盘，更别说 4GB 的*文件*了？:P

另一个编辑：根据评论者的建议仔细阅读互联网后，我意识到有比 4GB 大得多的硬盘可供购买。我感谢评论者指出这一点，并承诺在未来永远*不会*尝试在互联网上写讽刺评论。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T04:37:49.207

我更喜欢这个更明确和可读的版本：

```
#!/usr/bin/perl -w 

foreach my $file (<$ARGV[0]/*>){
    open(F, $file) or die "$!: $file";
    while(<F>){
      # search for pattern
    }
    close F;
} 
```

但也可以操纵`@ARGV`：

```
#!/usr/bin/perl -w 

@ARGV = <$ARGV[0]/*>;
while(<>){
    # search for pattern
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T04:36:21.177

`while (<>)`是的，在开始' '循环之前调整参数列表是可以的；在循环内调整它几乎是鲁莽的。例如，如果您处理选项参数，您通常会从 @ARGV 中删除项目；在这里，您正在添加项目，但它仍然会更改 @ARGV 的原始值。

代码是在子例程中还是在“主函数”中，这并不奇怪。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T10:24:20.803

前面的答案很好地涵盖了您的主要 Perl 编程问题。

因此，让我评论一下基本问题：如何在一堆文件中找到模式。

根据操作系统，调用专门的外部程序可能是有意义的，比如

```
grep -l <pattern> <path> 
```

在 Unix 上。

根据您需要对包含该模式的文件执行的操作以及命中/未命中率的大小，这可能会节省大量时间（并重复使用经过验证的代码）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T05:18:12.480

调整@ARGV 的最大问题是它是一个全局变量。另外，你应该知道它`while (<>)`具有[特殊的魔法属性](http://perldoc.perl.org/perlop.html#I%2fO-Operators)。（读取每个文件`@ARGV`或处理`STDIN`是否`@ARGV`为空，测试定义性而不是真实性）。为了减少需要理解的魔法，我会避免它，除了快速黑客工作。

您可以通过检查来获取当前文件的文件名`$ARGV`。

您可能没有意识到，但实际上您正在影响两个全局变量，而不仅仅是`@ARGV`. 你也打`$_`。本地化也是一个非常非常好的主意`$_`。

`local`您可以通过使用本地化更改 来减少修改全局变量的影响。

顺便说一句，还有另一个重要的、微妙的魔法`<>`。假设您要返回文件中匹配项的行号。你可能会想，好吧，检查 perlvar 并 find`$.`给出最后访问的句柄中的行号——太棒了。但是这里潜伏一个问题——文件`$.`之间没有重置。`@ARGV`如果您想知道总共处理了多少行，但如果您想知道当前文件的行号，这很好。幸运的是，有一个简单的技巧`eof`可以解决这个问题。

```
use strict;
use warnings;

...

searchDir( 'foo' );

sub searchDir {
    my $dirN    = shift;
    my $pattern = shift;

    local $_;

    my @fileList = grep { -f $_ } glob("$dirN/*");

    return unless @fileList;  # Don't want to process STDIN.

    local @ARGV;

    @ARGV = @fileList;
    while(<>) {
        my $found = 0;
        ## Search for pattern
        if ( $found ) {
            print "Match at $. in $ARGV\n";
        }
    }
    continue {
        # reset line numbering after each file.
        close ARGV  if eof;  # don't use eof().
    }
} 
```

**警告**：我刚刚在浏览器中修改了您的代码。我没有运行它，可能有错别字，如果不进行一些调整可能无法工作

**更新**：使用`local`而不是的原因`my`是它们做的事情非常不同。 `my`创建一个新的*词法变量*，该变量仅在包含的块中可见，不能通过符号表访问。 `local`保存现有的*包变量*并将其别名为新变量。新的本地化版本在任何后续代码中都可见，直到我们离开封闭块。请参阅[perlsub：通过 local() 的临时值](http://perldoc.perl.org/perlsub.html#Temporary-Values-via-local())。

在制作新变量并使用它们的一般情况下，这`my`是正确的选择。 `local`当您使用全局变量时是合适的，但您要确保不会将您的更改传播到程序的其余部分。

这个简短的脚本演示了本地：

```
$foo = 'foo';

print_foo();
print_bar();
print_foo();

sub print_bar {
    local $foo;
    $foo = 'bar';
    print_foo();
}

sub print_foo {
    print "Foo: $foo\n";
} 
```

# java - Java 和 MSMQ

> ID：506022
> 
> 赞同：16
> 
> 时间：2009-02-03T04:35:43.003
> 
> 标签：java, interop, msmq

我很好奇是否有人对提供访问 MSMQ 的 Java 库有任何建议？我已经下载了 J-Integra Java-COM 库的试用版，并构建并运行了他们的 MSMQ 示例应用程序，但我很好奇是否有任何好的（免费 :)）替代方案。我遇到过一些 JNI 实现，比如 jMSMQ 和其他一些实现，但如果可能的话，我宁愿避免使用 JNI。

我们还研究了一些 .NET<->JMS 互操作解决方案，例如 JNBridge（使用 ActiveMQ）。我认为我们公司已经决定将我们的队列集中在 MSMQ 中，所以这将是我们理想的解决方案。

我们希望在 .NET 端使用 WCF（netMsmq 或 msmqIntegration）。我有点担心 java 端将如何处理 WCF 消息（二进制编码），但那里应该有选项（带有文本编码和 MSMQ 传输的 customBinding？），所以我不太担心。主要担心在 Java 中访问 MSMQ。

我们的另一个选择是在每个队列的输入端放置一个瘦 Web 服务层，并以这种方式实现互操作。然而，性能在那里有点令人担忧。

有什么建议么？非常感谢任何人的时间。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-11T09:10:28.900

据我了解，J-Integra 是 MSMQ 的唯一纯 Java 实现，也就是说，如果您不在 Windows 上运行，这是唯一的选择。（如果有其他选择，请告诉我！）

Apache Camel 和其他人使用 JNI 来访问 Windows API（DLL 文件），这显然意味着它只适用于 Windows。

我目前正在尝试这里提供的代码[http://www.codeplex.com/MsmqJava](http://www.codeplex.com/MsmqJava)这似乎很容易使用，但我不确定事务是如何工作的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T15:44:15.927

CodePlex 上有一个开源库： [MsmqJava](http://MsmqJava.codeplex.com)。自由。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-31T18:33:17.907

我是[jni4net](http://jni4net.sf.net/)的作者，它是 JVM 和 CLR 之间的开源进程内桥梁。它建立在 JNI 和 PInvoke 之上。无需 C/C++ 代码。我希望它会帮助你。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-16T22:29:34.267

您也可以尝试[http://javamsmq.codeplex.com/](http://javamsmq.codeplex.com/)，它也提供了 MSMQ JAVA 互操作性的完整解决方案。以及它具有 Unicode ASCII 所有功能。在其他基于 dll 的开源中存在内存泄漏问题，如应用程序崩溃.但是这个开源没有任何内存泄漏问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T20:03:53.753

**更新**：此答案不再适用于每条评论：

> Camel msmq 组件已停产： [fusesource.com/forums/thread.jspa?messageID=6040](http://fusesource.com/forums/thread.jspa?messageID=6040)

你可以看看 Apache Camel 是如何做到的：[Apache Camel: msmq](https://camel.apache.org/msmq "阿帕奇骆驼：msmq")

# hash - 散列信息的目的是什么？

> ID：506029
> 
> 赞同：18
> 
> 时间：2009-02-03T04:39:37.177
> 
> 标签：hash

在课堂上学习如何创建哈希表后，我不明白哈希数据何时有用。在我看来，所有散列方法都是将信息存储在数组中的半随机位置。我想知道任何数据在存储后如何变得有用。

我的问题是：有哪些散列信息有益的例子？如何以任何有组织的方式检索数据？它似乎被放置在难以检索的任意位置。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-03T04:41:52.773

散列可用于多种用途：

1.  它可用于比较大量数据。您为数据创建散列，存储散列，然后如果要比较数据，只需比较散列即可。

2.  哈希可用于索引数据。它们可以在哈希表中用于指向正确的行。如果你想快速找到一条记录，你计算数据的hash，直接去对应hash记录所指向的记录。（这假设您有一个指向实际记录的哈希排序列表）

3.  它们可用于加密应用程序，如数字签名。

4.  散列可用于生成看似随机的字符串。

以下是维基百科列出的哈希函数的应用：

1.  [查找重复记录](http://en.wikipedia.org/wiki/Hash_function#Finding_duplicate_records)
2.  [查找相似记录](http://en.wikipedia.org/wiki/Hash_function#Finding_similar_records)
3.  [寻找相似的子串](http://en.wikipedia.org/wiki/Hash_function#Finding_similar_substrings)
4.  [几何散列](http://en.wikipedia.org/wiki/Hash_function#Geometric_hashing)

现在关于**hash table**，这里有几点需要注意：

如果您使用的是哈希表，则表中的哈希应该是有序的。如果没有，您将不得不在哈希列上创建一个索引。一些实现以排序的方式单独存储散列并指向原始记录。

如果有人以半随机顺序存储哈希，那一定是由于上述原因，或者因为他们只想存储信息的消息摘要以进行比较、查找重复项等，而不是作为数据的索引。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-03T04:46:37.520

![替代文字](https://upload.wikimedia.org/wikipedia/commons/thumb/c/c2/HASHTB08.svg/362px-HASHTB08.svg.png)

您在课堂上创建的哈希表的主要用途之一是当您需要快速 O(1) 查找时间时。您将有两个组件，键和值。

*散列函数*将键转换为*散列*。该哈希是一个数字，具体来说，它是数组中数据的索引。

因此，当您需要在哈希表中查找 Agscala 的声誉并且您已使用您的用户名作为键时，几乎不需要任何时间来定位和找到相关值。它只是重新散列您的用户名和中提琴，这是您要查找的数据的索引。您不必遍历整个数组来查找该特定值。

[对于一些参考，哈希表](http://en.wikipedia.org/wiki/Hash_table)上的维基百科页面非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T04:44:51.177

散列数据有几个典型的原因。在您引用的示例中，您将散列数据并将其用作键来提取散列项的实际值。散列数据通常被称为键，它引用可以找到实际非散列值的存储桶。

另一个典型原因是创建散列值的签名，以便您可以检查该值是否已被其他人更改。由于根据所使用的算法，通常很少有两个项目散列到相同的值，您可以重新散列一个值并将其与保存的散列值进行比较，以检查该项目是否仍然相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T05:43:08.810

散列是一种对快速键查找有用的技术。它允许人们更有效地找到一个值，而不是从头到尾扫描一个列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T00:00:52.587

你用过字典或集合吗？它们通常根据哈希表实现，因为可以快速找到与键关联的值。

```
{
'WA': 'Washington',
'WV': 'West Virginia',
'WY': 'Wyoming'
} 
```

# c# - 将用户输入的搜索查询转换为用于 SQL Server 全文搜索的 where 子句

> ID：506034
> 
> 赞同：14
> 
> 时间：2009-02-03T04:40:45.567
> 
> 标签：c#, sql-server, search, full-text-search, user-input

将用户输入的搜索词转换为可在 where 子句中用于全文搜索以查询表并获取相关结果的查询的最佳方法是什么？例如，用户输入的以下查询：

```
+"e-mail" +attachment -"word document" -"e-learning" 
```

应该翻译成类似的东西：

```
SELECT * FROM MyTable WHERE (CONTAINS(*, '"e-mail"')) AND (CONTAINS(*, '"attachment"')) AND (NOT CONTAINS(*, '"word document"')) AND (NOT CONTAINS(*, '"e-learning"')) 
```

我目前正在使用一个[查询解析器类](http://pastebin.com/gsLqR9n1)，它使用正则表达式将用户输入的查询解析为标记，然后从标记构造 where 子句。

但是，鉴于这可能是许多使用全文搜索的系统的共同要求，我很好奇其他开发人员是如何解决这个问题的，以及是否有更好的处理方式。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2015-05-23T06:28:56.197

**如何使用 .Net / C# / Entity Framework 实现接受的答案...**

1.  使用 nuget 安装 Irony。

2.  添加示例类：http: [//irony.codeplex.com/SourceControl/latest#Irony.Samples/FullTextSearchQueryConverter/SearchGrammar.cs](http://irony.codeplex.com/SourceControl/latest#Irony.Samples/FullTextSearchQueryConverter/SearchGrammar.cs)

3.  编写这样的代码将用户输入的字符串转换为查询。

    ```
    var grammar = new Irony.Samples.FullTextSearch.SearchGrammar();
    var parser = new Irony.Parsing.Parser(grammar);
    var parseTree = parser.Parse(userEnteredSearchString);
    string query = Irony.Samples.FullTextSearch.SearchGrammar.ConvertQuery(parseTree.Root); 
    ```

4.  也许写一个这样的存储过程：

    ```
    create procedure [dbo].[SearchLivingFish]

    @Query nvarchar(2000)

    as

    select *
    from Fish
    inner join containstable(Fish, *, @Query, 100) as ft
    on ft.[Key] = FishId
    where IsLiving = 1
    order by rank desc 
    ```

5.  运行查询。

    ```
    var fishes = db.SearchLivingFish(query); 
    ```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T08:17:30.077

这可能不是您正在寻找的东西，但它可能会为您提供一些进一步的想法。

[http://www.sqlservercentral.com/articles/Full-Text+Search+(2008)/64248/](http://www.sqlservercentral.com/articles/Full-Text+Search+(2008)/64248/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-08-11T02:46:24.433

除了上面@franzo 的回答之外，您可能还想更改 SQL 中的默认停用词行为。否则，包含单个数字（或其他停用词）的查询将不会返回任何结果。

禁用停用词，创建您自己的停用词列表和/或设置要转换的干扰词，如[SQL 2008 中所述：关闭全文搜索查询的停用词](https://stackoverflow.com/questions/8435602/sql-2008-turn-off-stop-words-for-full-text-search-query)

要查看（英文）sql 停用词的系统列表，请运行：

```
select * from sys.fulltext_system_stopwords where language_id = 1033 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T08:05:03.673

我意识到这与您最初的问题有点偏离，但是您是否考虑过放弃 SQL 全文索引并改用[Lucene/Solr](http://lucene.apache.org/solr/)之类的东西？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T08:20:02.537

最简单的方法是使用动态 SQL（我知道，在这里插入安全问题）并将短语分解为格式正确的字符串。

您可以使用函数将短语分解为可用于创建新字符串的表变量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-30T15:38:54.753

GoldParser 和 Calitha 的组合应该可以解决您的问题。

这篇文章：[http](http://www.15seconds.com/issue/070719.htm) ://www.15seconds.com/issue/070719.htm 也有一个 googleToSql 类，它会为你做一些翻译。

# linq-to-sql - Linq to SQL：组合两列以创建只读自定义列

> ID：506046
> 
> 赞同：0
> 
> 时间：2009-02-03T04:48:25.380
> 
> 标签：linq-to-sql

基本上，这是一个简单的场景，需要通过将实体中的两列组合为 FullName 来使用 LastName、FirstName 填充下拉列表。我希望它存在于实体中，这样每当我发现它的用途时我就可以抓住它。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T04:52:47.057

我会添加一个具有 FullName 属性的部分类。查看要使用的命名空间和部分类名的数据上下文类的设计器文件。

```
namespace your.namespace {

  public partial class yourclassname {
      public string FullName {
          get { return string.format("{0} {1}", FirstName, LastName); }
      }
  }

} 
```

# c# - 将 ASP.Net 连接到 Wcf/Tcp 聊天服务

> ID：506052
> 
> 赞同：2
> 
> 时间：2009-02-03T04:51:31.537
> 
> 标签：c#, asp.net, wcf, soap, service

我有一个接受双工 tcp 连接的 WCF 聊天服务。单个双工 tcp 连接可用于为多个用户发送和接收消息（因此我可以拥有多个相互连接的聊天服务器）。

现在我想将 Web 用户添加到组合中，让他们与桌面用户聊天。这是一个现场支持类型的东西。基本上，我试图找出从 ASP.Net 到此聊天服务的“带外”通信的最佳方式。

我在想我可以与其中一个聊天服务器建立静态/全局双工连接，并且可以将其用于对该 ASP.Net 服务器的所有请求。这行得通吗？双工连接都是单向调用，我可以使用这个 WCF 通道而不锁定对它的访问吗？

更新：到目前为止，感谢您的建议。我应该注意到：我的聊天服务是自托管的，它没有在 IIS 中运行。所以，我主要关心如何让 IIS 保持连接打开，直到应用程序卸载。从 Web 浏览器到 IIS 的连接将是 silverlight、flash、ajax、iframe 等等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T05:43:13.663

最好的办法是在应用程序级别实现双向消息队列，按用户和会话标识符索引消息。然后，您可以根据等待对象弹出和推送应用程序级别的 WCF 服务（又名对等）。对队列的访问将需要被锁定，但这是相对较低的成本。WCF 服务将完成繁重的工作。不过，在某些时候，如果只使用一个代理来发送消息，我预计应用程序会遇到瓶颈。在我看来，每个会话都有一个专用的通道代理可能更有效，从而使事情变得不那么有状态。我还允许非双工连接，因为所有消息都是单向操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T05:07:03.487

这可能无法回答您的问题，但您可以让 silverlight 执行此操作并使用您的桌面版本使用的类似代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T05:23:32.063

一种可以考虑的可能性是将 Silverlight 2 应用程序作为 Web 用户导航到的 ASP.NET 页面的一部分提供。

此 Silverlight 应用程序可以利用Silverlight 2 SDK 附带的 System.ServiceModel.PollingDuplex.dll 程序集（[一个用于 Silverlight 应用程序，一个用于 WCF 服务器）中的 WCF 轮询双工支持。](http://petermcg.wordpress.com/2008/09/03/silverlight-polling-duplex-part-1-architecture/)

我有[一些博客文章和一个示例应用程序](http://petermcg.wordpress.com/2008/11/19/silverlight-polling-duplex-part-4-wpf-client/)，它们演示了如何从控制台应用程序“推送”库存更新，该控制台应用程序自托管具有两个端点的 WCF 服务，如下所示：

```
using System;
using System.ServiceModel;
using System.ServiceModel.Description;

namespace StockServer
{
    public class StockServiceHost : ServiceHost
    {
        public StockServiceHost(object singletonInstance, params Uri[] baseAddresses)
            : base(singletonInstance, baseAddresses)
        {
        }

        public StockServiceHost(Type serviceType, params Uri[] baseAddresses)
            : base(serviceType, baseAddresses)
        {
        }

        protected override void InitializeRuntime()
        {
            this.AddServiceEndpoint(
                typeof(IPolicyProvider),
                new WebHttpBinding(),
                new Uri("http://localhost:10201/")).Behaviors.Add(new WebHttpBehavior());

            this.AddServiceEndpoint(
                typeof(IStockService),
                new PollingDuplexHttpBinding(),
                new Uri("http://localhost:10201/SilverlightStockService"));

            this.AddServiceEndpoint(
                typeof(IStockService),
                new WSDualHttpBinding(WSDualHttpSecurityMode.None),
                new Uri("http://localhost:10201/WpfStockService"));

            base.InitializeRuntime();
        }
    }
} 
```

WPF 客户端连接到 WSDualHttpBinding 端点，Silverlight 客户端连接到同一 WCF 服务的 PollingDuplexHttpBinding 端点。该应用程序还展示了如何处理 Silverlight 客户端访问策略要求。

客户端（Silverlight 或 WPF）可以在其 UI 中针对股票添加注释，这些注释传播回服务器以推送到所有其他客户端。这演示了双向通信，并有望执行聊天应用程序所需的大部分必要通信。

您可以[在此处查看运行的演示应用程序](http://petermcg.wordpress.com/2008/11/19/silverlight-polling-duplex-part-4-wpf-client/)的屏幕截图。

# php - Exchange Server 2007 Web 服务 PHP 类

> ID：506057
> 
> 赞同：3
> 
> 时间：2009-02-03T04:53:20.627
> 
> 标签：php, exchange-server, exchange-server-2007, exchangewebservices

有谁知道一个开源的 PHP 类（最好是 BSD 或 MIT 许可证），它将与 MS Exchange Server 2007 Web 服务通过。肥皂？

我正在寻找一个具有发送消息功能的更高级别的类。网络服务。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-10-26T14:55:27.520

我遇到了同样的问题，所以我开始在这里构建一些东西：

[https://github.com/rileydutton/Exchange-Web-Services-for-PHP](https://github.com/rileydutton/Exchange-Web-Services-for-PHP)

它还没有做太多（基本上只是让您从服务器获取电子邮件列表并发送电子邮件），但它足以用作做一些更复杂事情的基本起点。

我已经抽象出很多使用 php-ews 必须费力的复杂性。如果您希望在服务器上执行一些原始的、强大的命令，我会使用 php-ews...这适用于那些碰巧在 Exchange 服务器上工作并想要一种简单的方法来完成一些基本任务的人。

哦，它是麻省理工学院许可的。

希望有人觉得它有用！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-14T12:02:16.703

这是您需要的一个类：php-ews（该库使 Microsoft Exchange 2007 Web 服务更容易在 PHP 中实现）。您可以在以下位置找到它：[http ://code.google.com/p/php-ews/](http://code.google.com/p/php-ews/)

只有一个示例，但这应该为您提供实现它的方法。您可以在下面找到一个实现，以便：

*   连接到服务器
*   获取日历事件

注意：不要忘记填写空白变量。您还需要包含 php-ews 类文件（我使用了 __autoload PHP 函数）。

```
$host = '';
$username = '';
$password = '';
$mail = '';
$startDateEvent = ''; //ie: 2010-09-14T09:00:00
$endDateEvent = ''; //ie: 2010-09-20T17:00:00

$ews = new ExchangeWebServices($host, $username, $password);
$request = new EWSType_FindItemType();
$request->Traversal = EWSType_FolderQueryTraversalType::SHALLOW;

$request->CalendarView->StartDate = $startDateEvent; 
$request->CalendarView->EndDate = $endDateEvent; 
$request->CalendarView->MaxEntriesReturned = 100;
$request->CalendarView->MaxEntriesReturnedSpecified = true;
$request->ItemShape->BaseShape = EWSType_DefaultShapeNamesType::ALL_PROPERTIES;

$request->ParentFolderIds->DistinguishedFolderId->Id = EWSType_DistinguishedFolderIdNameType::CALENDAR;   
$request->ParentFolderIds->DistinguishedFolderId->Mailbox->EmailAddress = $mail;
$response = $ews->FindItem($request);
echo '<pre>'.print_r($response, true).'</pre>'; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T02:47:14.750

Exchange 服务器支持 WebDAV：

[http://www.troywolf.com/articles/php/exchange_webdav_examples.php](http://www.troywolf.com/articles/php/exchange_webdav_examples.php)

如果您只想发送消息，则可以使用 SMTP：

[http://ca2.php.net/manual/en/book.mail.php](http://ca2.php.net/manual/en/book.mail.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T13:18:01.543

我一直在研究同样的问题，但我还没有找到特定于 MS Exchange 的课程。但是，如果您愿意自己学习和构建 XML，您可能想看看[http://rabaix.net/en/articles/2008/03/13/using-soap-php上的 NTLM SOAP 类-with-ntlm-authentication](http://rabaix.net/en/articles/2008/03/13/using-soap-php-with-ntlm-authentication)。这将允许您针对 Active Directory 进行身份验证以进行 SOAP 调用，而本机 PHP SOAP 不允许您这样做。使用相同方法连接到 MS CRM 的另一个不错的资源是[http://www.reutone.com/heb/articles_internet.php?instance_id=62&actions=show&id=521](http://www.reutone.com/heb/articles_internet.php?instance_id=62&actions=show&id=521)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T11:02:57.520

[http://www.troywolf.com/articles/php/exchange_webdav_examples.php](http://www.troywolf.com/articles/php/exchange_webdav_examples.php)下的示例适用于 Exchange 2003 而不是 2007。

# ruby-on-rails - 在调用 AJAX onComplete 事件之前，页面上的 Javascript 未执行

> ID：506060
> 
> 赞同：0
> 
> 时间：2009-02-03T04:56:32.213
> 
> 标签：ruby-on-rails, ruby, ajax, prototypejs

我有一个表单，它发出 Ajax POST 请求以将小部件插入我的数据库。在表单中，我有一个选择框，您可以在其中从小部件中进行选择。数据库插入完成后，我必须更新选择框。实际上，我现在只是替换整个表格。

因为选择框有小部件，所以我必须有 javascript 中对象的副本。我将此变量称为 widget_objects。在更新事件期间替换表单时，我打印 ruby​​ 变量 <%= @widget_objects %> 并且可以看到新创建的对象。但是，当我尝试在 onComplete 事件中访问 javascript var“widget_objects”时，新对象不存在。我在页面上使用这行代码创建了 javascript widget_objects：widget_objects = <%= @widget_objects %>;

所以看起来上面这行代码并没有在Ajax请求的onComplete事件之前执行。但是，我认为 onComplete 事件是在页面加载后发生的，我会假设在脚本被评估之后......有什么想法吗？

```
<%= submit_to_remote( 
                    "save_widget", 
                    "Save Widget & Generate Embed Code", 
                    {
                        :url => widgets_url(:user_id => @user.id),
                        :update => "widget_form",
                        :method => :POST,
                        :html => {  :id => "save_widget_button", 
                                    :onclick => "this.value='Saving...'; this.disabled = 'true';",
                                    :style => "width: 220px;"
                                 }, 
                        :complete =>"
                            $('save_widget_button').disabled=''; 
                            $('save_widget_button').value='Save Widget & Generate Embed Code';
                            var last_id = $j('select#widget_id').children(':last').attr('value');
                            alert( widget_objects[last_id] );
                            ",
                        :success => "reportMessage('success', request.headerJSON.success, 'save_widget_status'); $('band_form').reset();",
                        :failure => "reportMessage('failure', request.headerJSON.errors, 'save_widget_status');"
                    }) %> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-07T09:33:39.497

将 EvalScripts 设置为 true 必须有效。

否则你可以尝试使用加载脚本

```
> <script> function window.onload(){
> alert('I am loaded as the page
> completes loading') } </script> 
```

如果这没有帮助，那么您可以在收到响应时调用函数：加载 ajax 调用，该函数将被调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T11:44:26.993

我的 PHP 脚本中发生了类似的情况，脚本的时间似乎不同步。更多的是关于 ajax 调用之后出现的代码如何在 onSuccess 事件中的代码之前执行，解决方案是将整个事件响应代码包装在一个匿名函数中，如下所示：

```
onSuccess: function(reply)
{
    resp = reply.reponseText();
    pieces = resp.split('|');
    (...etc...)
} 
```

您可以在 :complete 标识符之后尝试类似的操作。希望这可以帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T19:59:21.437

处理这类问题时，请使用 Firefox 的 JS 调试器（安装 Firebug 插件），启用异常时自动中断（从“脚本”选项卡），然后重新加载页面。如果 Firefox 拦截到异常（例如，源自响应 rjs 内），则修复异常。您可能还想用 'try { ... } catch(e) { alert(e) }' JS 包装器围绕 rjs 和 :complete 代码。

接下来，使用 JS 调试器在prototype.js 的respondToReadyState 方法中设置断点，您可以在其中检查应用程序的rjs 回复并逐步执行evalResponse() 方法。你会很快缩小范围。

# html - 在 HTML 页面中嵌入 Quick Time 电影

> ID：506067
> 
> 赞同：0
> 
> 时间：2009-02-03T05:05:12.490
> 
> 标签：html, quicktime

我正在尝试将 QuickTime 电影嵌入到我的 HTML/ASPX 页面中，但不知何故它们可以在本地机器上运行，但是当我将它们部署在我的服务器上时，它们根本不播放。我尝试了各种选择，但仍然找不到原因。其他人有过这个问题吗？

我进行了快速研究，发现资源很少，但即使在我的本地机器上跟踪它们，但在生产环境中却不行。我在徘徊，我需要设置某种流媒体来嵌入几个视频文件还是什么？

是的，我也确实关注了苹果的文章（谁把责任归咎于简单的互联网浏览器），而我的 Firefox 显示了相同的结果。我得到了图像（启动），但没有视频，因为我点击播放。

一个视频为 11 MB，另一个为 50 MB。我现在通过删除所有空格来重命名文件，我可以看到 QuickTime 插件正在启动，但过了一会儿问号出现在 QuickTime 徽标上。哑剧类型也是视频/快速时间，所以这是正确的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T22:29:39.450

实际上问题不在于我的页面，QuickTime 电影需要在服务器上安装 QuickTime（mov 电影）和 ITune（m4v 电影）。因此，安装这两个软件后，问题就解决了

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T05:53:01.910

将您的浏览器直接指向电影的 URL，而不是包含页面。看看你得到什么错误。另外，MIME 类型是否正确？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T05:23:16.260

视频有多大？如果您没有流式传输，则插件可能需要先下载整个文件才能播放，而在本地则不需要。这可能会在电影开始之前导致很长的停顿。

# vim - 如何在 Vi 中修复整个文件的缩进？

> ID：506075
> 
> 赞同：676
> 
> 时间：2009-02-03T05:15:25.483
> 
> 标签：vim, vi, indentation

在 Vim 中，纠正所有行的缩进的命令是什么？

很多时候，我会将代码复制并粘贴到远程终端中，然后整个事情就搞砸了。我想一口气解决这个问题。

* * *

## 回答 #1

> 赞同：1301
> 
> 时间：2009-02-03T05:19:20.670

`=`, indent 命令可以进行动作。因此，`gg`要获取文件的开头，`=`缩进，`G`到文件的末尾，`gg=G`.

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2009-02-03T05:47:19.473

在粘贴到终端之前，请尝试`:set paste`，然后`:set nopaste`在完成之后。这将关闭自动缩进、换行和其他扰乱粘贴的功能。

编辑：另外，我应该指出，`=`通常可以通过使用外部程序获得比缩进更好的结果。例如，我`:%!perltidy`一直在跑步。`astyle`,`cindent`等也可以使用。而且，当然，您可以将它们映射到按键，并根据文件类型将不同的按键映射到相同的按键。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2015-08-31T10:23:40.747

所有命令的主人是

`gg=G`

这会缩进整个文件！

下面是一些用于在 Vim 或 gVim 中快速缩进行的简单而优雅的命令。

缩进当前行下方的所有行

```
=G 
```

缩进当前行

```
== 
```

缩进`n`当前行下方的行

```
n== 
```

例如，在当前行下面缩进 4 行

```
4== 
```

要缩进代码块，请转到其中一个大括号并使用命令

```
=% 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2011-03-02T03:44:55.157

如果您想重新缩进您所在的块而无需键入任何和弦，您可以执行以下操作：

```
[[=]] 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-12-02T13:22:19.413

按 Escape 然后快速键入以下组合：

```
gg=G 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-07-06T08:48:06.600

您可以使用整洁的应用程序/实用程序来缩进 HTML 和 XML 文件，它在缩进这些文件时效果很好。

美化 XML 文件

```
:!tidy -mi -xml % 
```

美化 HTML 文件

```
:!tidy -mi -html % 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-02-03T21:17:02.093

`1G=G`. 这应该缩进文件中的所有行。`1G`带您进入第一行，`=`将启动自动缩进，final`G`将带您进入文件的最后一行。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-02-03T21:34:52.477

`:set paste`是你的朋友吗？我使用腻子并最终在 Windows 之间复制代码。在我被打开`:set paste`（和`:set nopaste`）复制/粘贴之前，正是出于这个原因。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-12-21T22:05:47.897

如果不想用`:set paste`，中键，`set nopaste`也可以粘贴剪贴板的内容：

```
"*p
"+p 
```

这样您就不必离开正常模式。如果您必须粘贴`+`或`*`取决于您选择文本的方式，请参阅`:help quoteplus`。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-02-03T05:44:14.970

在 Vim 中，使用`:insert`. 这将保留您的所有格式并且不进行自动缩进。欲了解更多信息`help :insert`。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2015-03-22T18:26:52.723

[vim-autoformat](https://github.com/Chiel92/vim-autoformat)使用特定于您的语言的外部程序格式化您的源文件，例如用于 Ruby 文件的“rbeautify”gem，用于 JavaScript 的“js-beautify”npm 包。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-12-16T12:05:52.060

`=`对于复杂的 C++ 文件，使用 vim 的filter 命令时，vim 并不总是能正确格式化。因此，对于这种情况，最好使用外部 C++ 格式化程序，如[astyle](http://astyle.sourceforge.net/)（或[uncrustify](http://uncrustify.sourceforge.net/)），例如：

```
:%!astyle 
```

Vim 的 '=' 函数默认使用其内部格式化程序（这并不总是正确），但也可以通过适当地设置它来设置它使用外部格式化程序，如 astyle，如[本问题](https://stackoverflow.com/questions/4587940/using-astyle-in-vim)中所述。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-08-26T10:16:45.063

对于 XML 文件，我使用此命令

```
:1,$!xmllint --format --recover - 2>/dev/null 
```

您需要安装 xmllint（软件包 libxml2-utils）

（来源： http: [//ku1ik.com/2011/09/08/formatting-xml-in-vim-with-indent-command.html](http://ku1ik.com/2011/09/08/formatting-xml-in-vim-with-indent-command.html)）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-02-08T22:06:33.610

您可以创建一个映射来为您执行此操作。

这将自动缩进整个文件，并且仍将光标保持在您所在的位置：

```
nmap <leader>ai mzgg=G`z 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-12-04T12:14:10.317

只需在 vim 中进入可视模式，并在选择后从上到下选择行 = ，所有选定的行都会缩进。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-12-23T15:12:25.623

对于 vi 编辑器，使用 :insert。这将保留您的所有格式并且不插入自动缩进。完成后按转义键查看实际的格式化文件，否则您会看到一些垃圾字符。像 ^I 例如：

```
public static void main(String[] args) {
^I
^I System.out.println("Some Garbage printed upon using :insert"); 
} 
```

# asp.net-mvc - 抽象 FormsCollection 对象接收到的 MVC 复选框值的解释

> ID：506077
> 
> 赞同：2
> 
> 时间：2009-02-03T05:18:11.233
> 
> 标签：asp.net-mvc, checkbox

在 ASP.NET MVC 中，此处的 HtmlHelper 代码会生成一个复选框：

```
<%= Html.CheckBox("List_" + mailingList.Key, true) %> 
```

作为这个 HTML：

```
<input id="List_NEW_PRODUCTS" name="List_NEW_PRODUCTS" type="checkbox" value="true" />
<input name="List_NEW_PRODUCTS" type="hidden" value="false" /> 
```

如果您想知道为什么会有一个额外的隐藏字段？- 然后 [读这个](https://stackoverflow.com/questions/220020#479220)。它绝对是一个让您首先想到“hmmmmm”的解决方案，但随后您意识到它是一个非常优雅的解决方案。

我遇到的问题是当我试图解析后端的数据时。好吧，如果将来在框架中发生任何变化，这与其说是一个问题，不如说是一个问题。

如果我使用内置绑定，一切都很好 - 这一切都为我完成了。但就我而言，我正在动态生成名称未知且模型中没有相应属性的复选框。

所以我最终不得不编写这样的代码：

```
if (forms["List_RETAIL_NOTIFICATION"] == "true,false") {

} 
```

或这个：

```
if (forms.GetValues("List_RETAIL_NOTIFICATION")[0] == "true") {

} 
```

这两个我仍然看和畏缩 - 特别是因为不能保证这将永远是返回值。我想知道是否有一种方法可以访问模型绑定器使用的抽象层 - 或者我是否坚持我的控制器“知道”这么多关于 HTTP POST hacks。

是的，我可能有点挑剔 - 但也许有更好的聪明方法使用模型绑定器，我可以使用它来读取动态创建的复选框参数。

此外，我希望这篇文章可以帮助其他人搜索：“真，假”。尽管我知道为什么会这样，但我只是忘记了，我花了一点时间才意识到“呃”。

* * *

仅供参考：我尝试了另外几件事，这就是我发现的：

`forms["List_RETAIL_NOTIFICATION"]` 评估为 "true,false" `forms.GetValues("List_RETAIL_NOTIFICATION")[0]`评估为 "true" `(forms.GetValue("List_RETAIL_NOTIFICATION").RawValue as string[])[0]`评估为 "true" `forms.GetValues("List_RETAIL_NOTIFICATION").FirstOrDefault()`评估为 "true"

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T13:36:24.877

如果你：

1.  为“自定义”属性值创建带有列表或其他内容的模型
2.  继承自 DefaultModelBinder
3.  重写 BindProperty，并将自定义属性值放在某个适当的位置，例如模型类型内的列表。

然后我认为这几乎可以满足您的需求。您正在使用布尔字段的默认绑定，但添加您自己的自定义属性，而不依赖于模型类型的反射。有关创建自定义模型绑定器的更多详细信息，请参阅候选版本的发行说明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:33:27.780

默认模型绑定器可以很好地处理这个问题。因此，如果您有：

```
public ActionResult Save(bool List_RETAIL_NOTIFICATION) 
```

或者

```
public ActionResult Save(MyObjectWithABoolPropertyToBeBoundFromACheckBox myObject) 
```

应该可以正常工作。

# c# - 是否有必要在 C# 中显式删除事件处理程序

> ID：506092
> 
> 赞同：123
> 
> 时间：2009-02-03T05:28:23.210
> 
> 标签：c#, garbage-collection, event-handling

我有一堂课提供了一些活动。该类是全局声明的，但不会在该全局声明上实例化——它是在需要它的方法中根据需要实例化的。

每次在方法中需要该类时，都会对其进行实例化并注册事件处理程序。是否有必要在方法超出范围之前显式删除事件处理程序？

当方法超出范围时，类的实例也会消失。离开注册到超出范围的实例的事件处理程序是否会影响内存占用？（我想知道事件处理程序是否阻止 GC 将类实例视为不再被引用。）

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2009-02-03T06:28:08.080

在你的情况下，一切都很好。它是*发布*事件的对象，它使事件处理程序的*目标*保持活动状态。所以如果我有：

```
publisher.SomeEvent += target.DoSomething; 
```

然后`publisher`有一个参考，`target`但不是相反。

在您的情况下，发布者将有资格进行垃圾收集（假设没有其他对它的引用），因此它获得对事件处理程序目标的引用这一事实是无关紧要的。

棘手的情况是发布者长期存在但订阅者不想成为 - 在*这种*情况下，您需要取消订阅处理程序。例如，假设您有一些数据传输服务，可以让您订阅有关带宽更改的异步通知，并且传输服务对象是长期存在的。如果我们这样做：

```
BandwidthUI ui = new BandwidthUI();
transferService.BandwidthChanged += ui.HandleBandwidthChange;
// Suppose this blocks until the transfer is complete
transferService.Transfer(source, destination);
// We now have to unsusbcribe from the event
transferService.BandwidthChanged -= ui.HandleBandwidthChange; 
```

（您实际上希望使用 finally 块来确保您不会泄漏事件处理程序。）如果我们没有取消订阅，那么`BandwidthUI`至少与传输服务一样长。

就我个人而言，我很少遇到这种情况 - 通常如果我订阅一个事件，该事件的目标至少与发布者一样长 - 例如，一个表单将与它上面的按钮一样长。了解这个潜在问题是值得的，但我认为有些人在不需要时会担心，因为他们不知道参考文献的走向。

**编辑：**这是为了回答乔纳森狄金森的评论。首先，查看[Delegate.Equals(object)](http://msdn.microsoft.com/en-us/library/99bthb1z.aspx)的文档，它清楚地给出了平等行为。

其次，这是一个简短但完整的程序来显示退订工作：

```
using System;

public class Publisher
{
    public event EventHandler Foo;

    public void RaiseFoo()
    {
        Console.WriteLine("Raising Foo");
        EventHandler handler = Foo;
        if (handler != null)
        {
            handler(this, EventArgs.Empty);
        }
        else
        {
            Console.WriteLine("No handlers");
        }
    }
}

public class Subscriber
{
    public void FooHandler(object sender, EventArgs e)
    {
        Console.WriteLine("Subscriber.FooHandler()");
    }
}

public class Test
{
    static void Main()
    {
         Publisher publisher = new Publisher();
         Subscriber subscriber = new Subscriber();
         publisher.Foo += subscriber.FooHandler;
         publisher.RaiseFoo();
         publisher.Foo -= subscriber.FooHandler;
         publisher.RaiseFoo();
    }
} 
```

结果：

```
Raising Foo
Subscriber.FooHandler()
Raising Foo
No handlers 
```

（在 Mono 和 .NET 3.5SP1 上测试。）

**进一步编辑：**

这是为了证明在仍有对订阅者的引用时可以收集事件发布者。

```
using System;

public class Publisher
{
    ~Publisher()
    {
        Console.WriteLine("~Publisher");
        Console.WriteLine("Foo==null ? {0}", Foo == null);
    }

    public event EventHandler Foo;
}

public class Subscriber
{
    ~Subscriber()
    {
        Console.WriteLine("~Subscriber");
    }

    public void FooHandler(object sender, EventArgs e) {}
}

public class Test
{
    static void Main()
    {
         Publisher publisher = new Publisher();
         Subscriber subscriber = new Subscriber();
         publisher.Foo += subscriber.FooHandler;

         Console.WriteLine("No more refs to publisher, "
             + "but subscriber is alive");
         GC.Collect();
         GC.WaitForPendingFinalizers();         

         Console.WriteLine("End of Main method. Subscriber is about to "
             + "become eligible for collection");
         GC.KeepAlive(subscriber);
    }
} 
```

结果（在 .NET 3.5SP1 中；Mono 在这里的行为似乎有点奇怪。一段时间后会调查）：

```
No more refs to publisher, but subscriber is alive
~Publisher
Foo==null ? False
End of Main method. Subscriber is about to become eligible for collection
~Subscriber 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T05:37:41.770

在你的情况下，你很好。我最初是向后阅读您的问题，即*订阅者*超出范围，而不是*发布*者。如果事件发布者超出范围，那么对订阅者的*引用*（当然不是订阅者本身！）也会随之而来，无需显式删除它们。

我的原始答案如下，关于如果您创建一个事件*订阅者*并让它超出范围而不取消订阅会发生什么。它不适用于您的问题，但我会将其留作历史。

如果类仍然通过事件处理程序注册，那么它仍然是可访问的。它仍然是一个活的物体。遵循事件图的 GC 会发现它已连接。是的，您需要明确删除事件处理程序。

仅仅因为对象超出其原始分配的范围并不意味着它是 GC 的候选对象。只要活着的参考仍然存在，它就是活着的。

# multithreading - 为什么线程本地存储这么慢？

> ID：506093
> 
> 赞同：38
> 
> 时间：2009-02-03T05:28:37.513
> 
> 标签：multithreading, performance, d, thread-local-storage

我正在为 D 编程语言开发一个自定义标记释放样式的内存分配器，它通过从线程本地区域分配来工作。与其他相同的单线程代码版本相比，线程本地存储瓶颈似乎导致从这些区域分配内存的速度大幅下降（~50%），即使在将我的代码设计为每次分配只有一个 TLS 查找之后/解除分配。这是基于在循环中多次分配/释放内存，我试图弄清楚它是否是我的基准测试方法的产物。我的理解是线程本地存储基本上应该只涉及通过额外的间接层访问某些东西，类似于通过指针访问变量。这是不正确的吗？线程本地存储通常有多少开销？

注意：虽然我提到了 D，但我也对不特定于 D 的一般答案感兴趣，因为如果 D 的线程本地存储实现比最佳实现慢，它可能会改进。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-03T06:06:59.420

速度取决于 TLS 实现。

是的，你是正确的，TLS 可以像指针查找一样快。在具有内存管理单元的系统上，它甚至可以更快。

但是，对于指针查找，您需要调度程序的帮助。调度程序必须 - 在任务切换上 - 更新指向 TLS 数据的指针。

实现 TLS 的另一种快速方法是通过内存管理单元。在这里，TLS 被视为与任何其他数据一样，但 TLS 变量被分配在特殊段中。调度程序将在任务切换时将正确的内存块映射到任务的地址空间。

如果调度程序不支持任何这些方法，编译器/库必须执行以下操作：

*   获取当前的 ThreadId
*   获取信号量
*   通过 ThreadId 查找指向 TLS 块的指针（可以使用 map 左右）
*   释放信号量
*   返回那个指针。

显然，为每个 TLS 数据访问执行所有这些操作需要一段时间，并且可能需要多达三个操作系统调用：获取 ThreadId、获取和释放信号量。

顺便说一句，需要信号量来确保没有线程从 TLS 指针列表中读取，而另一个线程正在生成一个新线程。（因此分配一个新的 TLS 块并修改数据结构）。

不幸的是，在实践中看到缓慢的 TLS 实施并不少见。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-04-13T08:56:39.717

D 中的线程局部变量非常快。这是我的测试。

64 位 Ubuntu，核心 i5，dmd v2.052 编译器选项：dmd -O -release -inline -m64

```
// this loop takes 0m0.630s
void main(){
    int a; // register allocated
    for( int i=1000*1000*1000; i>0; i-- ){
        a+=9;
    }
}

// this loop takes 0m1.875s
int a; // thread local in D, not static
void main(){
    for( int i=1000*1000*1000; i>0; i-- ){
        a+=9;
    }
} 
```

因此，每 1000*1000*1000 个线程本地访问，我们只损失 1.2 秒的 CPU 内核之一。使用 %fs 寄存器访问线程本地 - 所以只涉及几个处理器命令：

使用 objdump -d 反汇编：

```
- this is local variable in %ecx register (loop counter in %eax):
   8:   31 c9                   xor    %ecx,%ecx
   a:   b8 00 ca 9a 3b          mov    $0x3b9aca00,%eax
   f:   83 c1 09                add    $0x9,%ecx
  12:   ff c8                   dec    %eax
  14:   85 c0                   test   %eax,%eax
  16:   75 f7                   jne    f <_Dmain+0xf>

- this is thread local, %fs register is used for indirection, %edx is loop counter:
   6:   ba 00 ca 9a 3b          mov    $0x3b9aca00,%edx
   b:   64 48 8b 04 25 00 00    mov    %fs:0x0,%rax
  12:   00 00 
  14:   48 8b 0d 00 00 00 00    mov    0x0(%rip),%rcx        # 1b <_Dmain+0x1b>
  1b:   83 04 08 09             addl   $0x9,(%rax,%rcx,1)
  1f:   ff ca                   dec    %edx
  21:   85 d2                   test   %edx,%edx
  23:   75 e6                   jne    b <_Dmain+0xb> 
```

也许编译器可以更聪明，并在循环之前将线程本地缓存到寄存器并在最后将其返回到线程本地（与 gdc 编译器进行比较很有趣），但即使是现在，恕我直言，事情还是非常好的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-03T20:15:04.213

在解释基准测试结果时需要非常小心。例如，最近 D 新闻组中的一个线程从基准测试中得出结论，dmd 的代码生成导致执行算术的循环严重减慢，但实际上花费的时间主要由执行长除法的运行时辅助函数控制。编译器的代码生成与减速无关。

要查看为 tls 生成了哪种代码，请编译并 obj2asm 这段代码：

```
__thread int x;
int foo() { return x; } 
```

TLS 在 Windows 上的实现与在 Linux 上的实现非常不同，并且在 OSX 上也将非常不同。但是，在所有情况下，它都会比简单的静态内存位置加载更多的指令。相对于简单访问，TLS 总是会很慢。在紧密循环中访问 TLS 全局变量也会很慢。尝试将 TLS 值缓存在一个临时文件中。

我几年前写了一些线程池分配代码，并将 TLS 句柄缓存到池中，效果很好。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-01-07T23:35:16.887

我为嵌入式系统设计了多任务程序，从概念上讲，线程本地存储的关键要求是让上下文切换方法保存/恢复指向线程本地存储的指针以及 CPU 寄存器以及它正在保存/恢复的任何其他内容。对于一旦启动将始终运行相同代码集的嵌入式系统，最简单的方法是简单地保存/恢复一个指针，该指针指向每个线程的固定格式块。漂亮，干净，简单，高效。

如果一个人不介意为每个线程中分配的每个线程局部变量分配空间——即使是那些从未实际使用它的变量——并且如果将在线程局部存储块中的所有内容都可以定义为单个结构。在这种情况下，访问线程局部变量几乎可以像访问其他变量一样快，唯一的区别是额外的指针取消引用。不幸的是，许多 PC 应用程序需要更复杂的东西。

在某些 PC 框架上，如果使用这些变量的模块已在该线程上运行，则该线程只会为线程静态变量分配空间。虽然这有时可能是有利的，但这意味着不同的线程通常会有不同的本地存储布局。因此，线程可能需要对其变量所在位置的某种可搜索索引，并通过该索引引导对这些变量的所有访问。

我希望如果框架分配少量的固定格式存储，保留最后访问的 1-3 个线程局部变量的缓存可能会有所帮助，因为在许多情况下，即使是单项缓存也可以提供命中率相当高。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-27T05:44:04.130

如果你不能使用编译器 TLS 支持，你可以自己管理 TLS。我为 C++ 构建了一个包装模板，因此很容易替换底层实现。在这个例子中，我为 Win32 实现了它。注意：由于您无法为每个进程获得无限数量的 TLS 索引（至少在 Win32 下），您应该指向足够大的堆块以容纳所有线程特定的数据。这样您就可以拥有最少数量的 TLS 索引和相关查询。在“最佳情况”中，每个线程只有 1 个 TLS 指针指向一个私有堆块。

简而言之：不要指向单个对象，而是指向特定于线程的堆内存/包含对象指针的容器以实现更好的性能。

如果不再使用，请不要忘记释放内存。我通过将线程包装到一个类中（就像 Java 一样）并通过构造函数和析构函数处理 TLS 来做到这一点。此外，我将线程句柄和 ID 等常用数据存储为类成员。

## 用法：

> 对于类型*： tl_ptr<类型>
> 
> 对于 const 类型*：tl_ptr<const type>
> 
> 对于类型* const： const tl_ptr<type>
> 
> 常量类型* 常量：常量 tl_ptr<常量类型>

```
template<typename T>
class tl_ptr {
protected:
    DWORD index;
public:
    tl_ptr(void) : index(TlsAlloc()){
        assert(index != TLS_OUT_OF_INDEXES);
        set(NULL);
    }
    void set(T* ptr){
        TlsSetValue(index,(LPVOID) ptr);
    }
    T* get(void)const {
        return (T*) TlsGetValue(index);
    }
    tl_ptr& operator=(T* ptr){
        set(ptr);
        return *this;
    }
    tl_ptr& operator=(const tl_ptr& other){
        set(other.get());
        return *this;
    }
    T& operator*(void)const{
        return *get();
    }
    T* operator->(void)const{
        return get();
    }
    ~tl_ptr(){
        TlsFree(index);
    }
}; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-18T12:45:29.370

我们已经从 TLS（在 Windows 上）看到了类似的性能问题。我们依靠它来完成我们产品“内核”中的某些关键操作。经过一番努力，我决定尝试改进这一点。

我很高兴地说，我们现在有一个小型 API，当调用线程不“知道”它的线程 ID 时，它可以为等效操作减少 50% 以上的 CPU 时间，如果调用线程已经知道，则减少 65% 以上获得了它的线程 id（可能用于其他一些较早的处理步骤）。

新函数（ get_thread_private_ptr() ）总是返回一个指针，指向我们在内部用来保存所有排序的结构，因此每个线程只需要一个。

总而言之，我认为 Win32 TLS 支持确实做得很差。

# c# - 在 C# 中比较对象属性

> ID：506096
> 
> 赞同：111
> 
> 时间：2009-02-03T05:32:05.417
> 
> 标签：c#, object, properties, comparison

这就是我想出的作为由我的许多其他类继承的类的方法。这个想法是它允许在相同类型的对象的属性之间进行简单的比较。

现在，这确实有效——但为了提高我的代码质量，我想我会把它扔掉以供审查。它怎么能更好/更有效/等等？

```
/// <summary>
/// Compare property values (as strings)
/// </summary>
/// <param name="obj"></param>
/// <returns></returns>
public bool PropertiesEqual(object comparisonObject)
{

    Type sourceType = this.GetType();
    Type destinationType = comparisonObject.GetType();

    if (sourceType == destinationType)
    {
        PropertyInfo[] sourceProperties = sourceType.GetProperties();
        foreach (PropertyInfo pi in sourceProperties)
        {
            if ((sourceType.GetProperty(pi.Name).GetValue(this, null) == null && destinationType.GetProperty(pi.Name).GetValue(comparisonObject, null) == null))
            {
                // if both are null, don't try to compare  (throws exception)
            }
            else if (!(sourceType.GetProperty(pi.Name).GetValue(this, null).ToString() == destinationType.GetProperty(pi.Name).GetValue(comparisonObject, null).ToString()))
            {
                // only need one property to be different to fail Equals.
                return false;
            }
        }
    }
    else
    {
        throw new ArgumentException("Comparison object must be of the same type.","comparisonObject");
    }

    return true;
} 
```

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2009-05-10T07:04:11.097

我正在寻找一段代码，它可以做类似的事情来帮助编写单元测试。这是我最终使用的。

```
public static bool PublicInstancePropertiesEqual<T>(T self, T to, params string[] ignore) where T : class 
  {
     if (self != null && to != null)
     {
        Type type = typeof(T);
        List<string> ignoreList = new List<string>(ignore);
        foreach (System.Reflection.PropertyInfo pi in type.GetProperties(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Instance))
        {
           if (!ignoreList.Contains(pi.Name))
           {
              object selfValue = type.GetProperty(pi.Name).GetValue(self, null);
              object toValue = type.GetProperty(pi.Name).GetValue(to, null);

              if (selfValue != toValue && (selfValue == null || !selfValue.Equals(toValue)))
              {
                 return false;
              }
           }
        }
        return true;
     }
     return self == to;
  } 
```

*编辑：*

**与上面相同的代码，但使用 LINQ 和扩展方法：**

```
public static bool PublicInstancePropertiesEqual<T>(this T self, T to, params string[] ignore) where T : class
{
    if (self != null && to != null)
    {
        var type = typeof(T);
        var ignoreList = new List<string>(ignore);
        var unequalProperties =
            from pi in type.GetProperties(BindingFlags.Public | BindingFlags.Instance)
            where !ignoreList.Contains(pi.Name) && pi.GetUnderlyingType().IsSimpleType() && pi.GetIndexParameters().Length == 0
            let selfValue = type.GetProperty(pi.Name).GetValue(self, null)
            let toValue = type.GetProperty(pi.Name).GetValue(to, null)
            where selfValue != toValue && (selfValue == null || !selfValue.Equals(toValue))
            select selfValue;
        return !unequalProperties.Any();
    }
    return self == to;
}

public static class TypeExtensions
   {
      /// <summary>
      /// Determine whether a type is simple (String, Decimal, DateTime, etc) 
      /// or complex (i.e. custom class with public properties and methods).
      /// </summary>
      /// <see cref="http://stackoverflow.com/questions/2442534/how-to-test-if-type-is-primitive"/>
      public static bool IsSimpleType(
         this Type type)
      {
         return
            type.IsValueType ||
            type.IsPrimitive ||
            new[]
            {
               typeof(String),
               typeof(Decimal),
               typeof(DateTime),
               typeof(DateTimeOffset),
               typeof(TimeSpan),
               typeof(Guid)
            }.Contains(type) ||
            (Convert.GetTypeCode(type) != TypeCode.Object);
      }

      public static Type GetUnderlyingType(this MemberInfo member)
      {
         switch (member.MemberType)
         {
            case MemberTypes.Event:
               return ((EventInfo)member).EventHandlerType;
            case MemberTypes.Field:
               return ((FieldInfo)member).FieldType;
            case MemberTypes.Method:
               return ((MethodInfo)member).ReturnType;
            case MemberTypes.Property:
               return ((PropertyInfo)member).PropertyType;
            default:
               throw new ArgumentException
               (
                  "Input MemberInfo must be if type EventInfo, FieldInfo, MethodInfo, or PropertyInfo"
               );
         }
      }
   } 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2011-04-28T18:43:43.153

**更新：**最新版本的 Compare-Net-Objects 位于[GitHub 上](https://github.com/GregFinzer/Compare-Net-Objects) ，有[NuGet 包](https://www.nuget.org/packages/CompareNETObjects)和[Tutorial](http://www.codeproject.com/Tips/754435/Compare-NET-Objects-Tutorial)。它可以称为

```
//This is the comparison class
CompareLogic compareLogic = new CompareLogic();

ComparisonResult result = compareLogic.Compare(person1, person2);

//These will be different, write out the differences
if (!result.AreEqual)
    Console.WriteLine(result.DifferencesString); 
```

或者，如果您需要更改某些配置，请使用

```
CompareLogic basicComparison = new CompareLogic() 
{ Config = new ComparisonConfig()
   { MaxDifferences = propertyCount 
     //add other configurations
   }
}; 
```

可配置参数的完整列表在[ComparisonConfig.cs](https://github.com/GregFinzer/Compare-Net-Objects/blob/master/Compare-NET-Objects/ComparisonConfig.cs)

**原答案：**

我在您的代码中看到的限制：

*   最大的一个是它没有进行深入的对象比较。

*   如果属性是列表或包含列表作为元素（这可以进行 n 级），它不会逐个元素进行比较。

*   它没有考虑到不应比较某些类型的属性（例如，用于过滤目的的 Func 属性，例如 PagedCollectionView 类中的属性）。

*   它不会跟踪实际不同的属性（因此您可以在断言中显示）。

我今天正在寻找一些用于单元测试目的的解决方案，以逐个属性进行深度比较，最终我使用了：[http](http://comparenetobjects.codeplex.com) ://comparenetobjects.codeplex.com 。

它是一个免费库，只有一个类，您可以像这样简单地使用它：

```
var compareObjects = new CompareObjects()
{
    CompareChildren = true, //this turns deep compare one, otherwise it's shallow
    CompareFields = false,
    CompareReadOnly = true,
    ComparePrivateFields = false,
    ComparePrivateProperties = false,
    CompareProperties = true,
    MaxDifferences = 1,
    ElementsToIgnore = new List<string>() { "Filter" }
};

Assert.IsTrue(
    compareObjects.Compare(objectA, objectB), 
    compareObjects.DifferencesString
); 
```

此外，它可以很容易地为 Silverlight 重新编译。只需将一个类复制到 Silverlight 项目中，然后删除一两行用于比较 Silverlight 中不可用的代码，例如私有成员比较。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T06:09:26.980

我认为最好遵循 Override Object#Equals() 的模式以
*获得更好的描述：阅读 Bill Wagner's [Effective C#](https://rads.stackoverflow.com/amzn/click/com/0321245660) - Item 9 I think*

```
public override Equals(object obOther)
{
  if (null == obOther)
    return false;
  if (object.ReferenceEquals(this, obOther)
    return true;
  if (this.GetType() != obOther.GetType())
    return false;
  # private method to compare members.
  return CompareMembers(this, obOther as ThisClass);
} 
```

*   同样在检查相等性的方法中，您应该返回 true 或 false。它们要么相等，要么不相等.. 而不是抛出异常，而是返回 false。
*   我会考虑覆盖 Object#Equals。
*   即使您必须考虑到这一点，使用反射来比较属性据说也很慢（我没有数字来支持这一点）。这是 C# 中 valueType#Equals 的默认行为，建议您为值类型覆盖 Equals 并针对性能进行成员明智的比较。（早些时候我快速阅读了这篇文章，因为你有一组自定义属性对象......我的错。）

**2011 年 12 月更新：**

*   当然，如果该类型已经有一个产生式 Equals() 那么你需要另一种方法。
*   如果您使用它来专门为测试目的比较不可变数据结构，则不应将 Equals 添加到生产类（有人可能会通过链接 Equals 实现来进行测试，或者您可能会阻止创建生产所需的 Equals 实现） .

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-06-25T20:36:39.813

如果性能无关紧要，您可以将它们序列化并比较结果：

```
var serializer = new XmlSerializer(typeof(TheObjectType));
StringWriter serialized1 = new StringWriter(), serialized2 = new StringWriter();
serializer.Serialize(serialized1, obj1);
serializer.Serialize(serialized2, obj2);
bool areEqual = serialized1.ToString() == serialized2.ToString(); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-04-21T15:40:15.917

*我觉得Big T*的回答很好，但是缺少深度比较，所以我稍微调整了一下：

```
using System.Collections.Generic;
using System.Reflection;

/// <summary>Comparison class.</summary>
public static class Compare
{
    /// <summary>Compare the public instance properties. Uses deep comparison.</summary>
    /// <param name="self">The reference object.</param>
    /// <param name="to">The object to compare.</param>
    /// <param name="ignore">Ignore property with name.</param>
    /// <typeparam name="T">Type of objects.</typeparam>
    /// <returns><see cref="bool">True</see> if both objects are equal, else <see cref="bool">false</see>.</returns>
    public static bool PublicInstancePropertiesEqual<T>(T self, T to, params string[] ignore) where T : class
    {
        if (self != null && to != null)
        {
            var type = self.GetType();
            var ignoreList = new List<string>(ignore);
            foreach (var pi in type.GetProperties(BindingFlags.Public | BindingFlags.Instance))
            {
                if (ignoreList.Contains(pi.Name))
                {
                    continue;
                }

                var selfValue = type.GetProperty(pi.Name).GetValue(self, null);
                var toValue = type.GetProperty(pi.Name).GetValue(to, null);

                if (pi.PropertyType.IsClass && !pi.PropertyType.Module.ScopeName.Equals("CommonLanguageRuntimeLibrary"))
                {
                    // Check of "CommonLanguageRuntimeLibrary" is needed because string is also a class
                    if (PublicInstancePropertiesEqual(selfValue, toValue, ignore))
                    {
                        continue;
                    }

                    return false;
                }

                if (selfValue != toValue && (selfValue == null || !selfValue.Equals(toValue)))
                {
                    return false;
                }
            }

            return true;
        }

        return self == to;
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-07-26T11:16:23.690

我将以下行添加到 PublicInstancePropertiesEqual 方法以避免复制和粘贴错误：

```
Assert.AreNotSame(self, to); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-03T05:57:57.097

您是否在属性中的所有对象上覆盖 .ToString() ？否则，第二次比较可能会返回 null。

此外，在第二个比较中，我对 !( A == B) 与 (A != B) 的构造相比，在六个月/两年后的可读性方面持观望态度。这条线本身很宽，如果你有一个宽显示器，这没关系，但可能打印得不太好。（挑剔）

您的所有对象是否总是使用这样的代码才能工作的属性？是否存在一些内部的、非专有的数据，这些数据可能因一个对象而异，但所有公开的数据都是相同的？我正在考虑一些可能随时间变化的数据，例如两个随机数生成器，它们碰巧在某一点达到相同的数字，但会产生两个不同的信息序列，或者只是任何不会暴露的数据通过属性接口。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-03T05:37:49.790

确保对象不是`null`.

有`obj1`和`obj2`：

```
if(obj1 == null )
{
   return false;
}
return obj1.Equals( obj2 ); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-03T06:05:12.637

如果您只是比较相同类型的对象或在继承链的下游，为什么不将参数指定为基本类型，而不是 object ？

还要对参数进行空检查。

此外，我会使用 'var' 只是为了使代码更具可读性（如果它的 c#3 代码）

此外，如果对象具有引用类型作为属性，那么您只是在它们上调用 ToString() 并不会真正比较值。如果 ToString 没有被覆盖，那么它只会将类型名称作为可能返回误报的字符串返回。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-03T06:36:21.870

我建议的第一件事是将实际比较分开，使其更具可读性（我还取出了 ToString() - 需要吗？）：

```
else {
    object originalProperty = sourceType.GetProperty(pi.Name).GetValue(this, null);
    object comparisonProperty = destinationType.GetProperty(pi.Name).GetValue(comparisonObject, null);

    if (originalProperty != comparisonProperty)
        return false; 
```

下一个建议是尽可能减少反射的使用——它真的很慢。我的意思是，*真的很*慢。如果你打算这样做，我建议缓存属性引用。我对反射 API 不是很熟悉，所以如果这有点偏离，只需调整以使其编译：

```
// elsewhere
Dictionary<object, Property[]> lookupDictionary = new Dictionary<object, Property[]>;

Property[] objectProperties = null;
if (lookupDictionary.ContainsKey(sourceType)) {
  objectProperties = lookupProperties[sourceType];
} else {
  // build array of Property references
  PropertyInfo[] sourcePropertyInfos = sourceType.GetProperties();
  Property[] sourceProperties = new Property[sourcePropertyInfos.length];
  for (int i=0; i < sourcePropertyInfos.length; i++) {
    sourceProperties[i] = sourceType.GetProperty(pi.Name);
  }
  // add to cache
  objectProperties = sourceProperties;
  lookupDictionary[object] = sourceProperties;
}

// loop through and compare against the instances 
```

但是，我不得不说我同意其他海报。这闻起来很懒惰而且效率低下。您应该改为实施 IComparable :-)。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-11-18T00:48:25.200

这里被修改为将 null = null 视为相等

```
 private bool PublicInstancePropertiesEqual<T>(T self, T to, params string[] ignore) where T : class
        {
            if (self != null && to != null)
            {
                Type type = typeof(T);
                List<string> ignoreList = new List<string>(ignore);
                foreach (PropertyInfo pi in type.GetProperties(BindingFlags.Public | BindingFlags.Instance))
                {
                    if (!ignoreList.Contains(pi.Name))
                    {
                        object selfValue = type.GetProperty(pi.Name).GetValue(self, null);
                        object toValue = type.GetProperty(pi.Name).GetValue(to, null);
                        if (selfValue != null)
                        {
                            if (!selfValue.Equals(toValue))
                                return false;
                        }
                        else if (toValue != null)
                            return false;
                    }
                }
                return true;
            }
            return self == to;
        } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-06-09T17:22:58.440

我最终这样做了：

```
 public static string ToStringNullSafe(this object obj)
    {
        return obj != null ? obj.ToString() : String.Empty;
    }
    public static bool Compare<T>(T a, T b)
    {
        int count = a.GetType().GetProperties().Count();
        string aa, bb;
        for (int i = 0; i < count; i++)
        {
            aa = a.GetType().GetProperties()[i].GetValue(a, null).ToStringNullSafe();
            bb = b.GetType().GetProperties()[i].GetValue(b, null).ToStringNullSafe();
            if (aa != bb)
            {
                return false;
            }
        }
        return true;
    } 
```

用法：

```
 if (Compare<ObjectType>(a, b)) 
```

**更新**

如果您想按名称忽略某些属性：

```
 public static string ToStringNullSafe(this object obj)
    {
        return obj != null ? obj.ToString() : String.Empty;
    }
    public static bool Compare<T>(T a, T b, params string[] ignore)
    {
        int count = a.GetType().GetProperties().Count();
        string aa, bb;
        for (int i = 0; i < count; i++)
        {
            aa = a.GetType().GetProperties()[i].GetValue(a, null).ToStringNullSafe();
            bb = b.GetType().GetProperties()[i].GetValue(b, null).ToStringNullSafe();
            if (aa != bb && ignore.Where(x => x == a.GetType().GetProperties()[i].Name).Count() == 0)
            {
                return false;
            }
        }
        return true;
    } 
```

用法：

```
 if (MyFunction.Compare<ObjType>(a, b, "Id","AnotherProp")) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-12-28T08:18:55.383

您可以通过对每种类型仅调用一次 GetProperties 来优化您的代码：

```
public static string ToStringNullSafe(this object obj)
{
    return obj != null ? obj.ToString() : String.Empty;
}
public static bool Compare<T>(T a, T b, params string[] ignore)
{
    var aProps = a.GetType().GetProperties();
    var bProps = b.GetType().GetProperties();
    int count = aProps.Count();
    string aa, bb;
    for (int i = 0; i < count; i++)
    {
        aa = aProps[i].GetValue(a, null).ToStringNullSafe();
        bb = bProps[i].GetValue(b, null).ToStringNullSafe();
        if (aa != bb && ignore.Where(x => x == aProps[i].Name).Count() == 0)
        {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-06-22T10:38:46.063

为了完整起见，我想添加对 [http://www.cyotek.com/blog/comparing-the-properties-of-two-objects-via-reflection](http://www.cyotek.com/blog/comparing-the-properties-of-two-objects-via-reflection)的引用 它比此页面上的大多数其他答案具有更完整的逻辑。

但是我更喜欢 Compare-Net-Objects 库 [https://github.com/GregFinzer/Compare-Net-Objects](https://github.com/GregFinzer/Compare-Net-Objects)（由[Liviu Trifoi](https://stackoverflow.com/users/327075/liviu-trifoi)的[回答](https://stackoverflow.com/questions/506096/comparing-object-properties-in-c-sharp/5823459#5823459)引用）
该库有 NuGet 包[http://www.nuget.org/packages/比较 NETObjects](http://www.nuget.org/packages/CompareNETObjects)和要配置的多个选项。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-12-01T17:52:22.147

即使对象不同，这也有效。您可以自定义实用程序类中的方法也许您还想比较私有属性...

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

class ObjectA
{
    public string PropertyA { get; set; }
    public string PropertyB { get; set; }
    public string PropertyC { get; set; }
    public DateTime PropertyD { get; set; }

    public string FieldA;
    public DateTime FieldB;
}

class ObjectB
{
    public string PropertyA { get; set; }
    public string PropertyB { get; set; }
    public string PropertyC { get; set; }
    public DateTime PropertyD { get; set; }

    public string FieldA;
    public DateTime FieldB;

}

class Program
{
    static void Main(string[] args)
    {
        // create two objects with same properties
        ObjectA a = new ObjectA() { PropertyA = "test", PropertyB = "test2", PropertyC = "test3" };
        ObjectB b = new ObjectB() { PropertyA = "test", PropertyB = "test2", PropertyC = "test3" };

        // add fields to those objects
        a.FieldA = "hello";
        b.FieldA = "Something differnt";

        if (a.ComparePropertiesTo(b))
        {
            Console.WriteLine("objects have the same properties");
        }
        else
        {
            Console.WriteLine("objects have diferent properties!");
        }

        if (a.CompareFieldsTo(b))
        {
            Console.WriteLine("objects have the same Fields");
        }
        else
        {
            Console.WriteLine("objects have diferent Fields!");
        }

        Console.Read();
    }
}

public static class Utilities
{
    public static bool ComparePropertiesTo(this Object a, Object b)
    {
        System.Reflection.PropertyInfo[] properties = a.GetType().GetProperties(); // get all the properties of object a

        foreach (var property in properties)
        {
            var propertyName = property.Name;

            var aValue = a.GetType().GetProperty(propertyName).GetValue(a, null);
            object bValue;

            try // try to get the same property from object b. maybe that property does
                // not exist! 
            {
                bValue = b.GetType().GetProperty(propertyName).GetValue(b, null);
            }
            catch
            {
                return false;
            }

            if (aValue == null && bValue == null)
                continue;

            if (aValue == null && bValue != null)
                return false;

            if (aValue != null && bValue == null)
               return false;

            // if properties do not match return false
            if (aValue.GetHashCode() != bValue.GetHashCode())
            {
                return false;
            }
        }

        return true;
    }

    public static bool CompareFieldsTo(this Object a, Object b)
    {
        System.Reflection.FieldInfo[] fields = a.GetType().GetFields(); // get all the properties of object a

        foreach (var field in fields)
        {
            var fieldName = field.Name;

            var aValue = a.GetType().GetField(fieldName).GetValue(a);

            object bValue;

            try // try to get the same property from object b. maybe that property does
            // not exist! 
            {
                bValue = b.GetType().GetField(fieldName).GetValue(b);
            }
            catch
            {
                return false;
            }

            if (aValue == null && bValue == null)
               continue;

            if (aValue == null && bValue != null)
               return false;

            if (aValue != null && bValue == null)
               return false;

            // if properties do not match return false
            if (aValue.GetHashCode() != bValue.GetHashCode())
            {
                return false;
            }
        }

        return true;
    }

} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-09-30T06:19:21.250

更新 Liviu 上面的答案 - CompareObjects.DifferencesString 已被弃用。

这在单元测试中效果很好：

```
CompareLogic compareLogic = new CompareLogic();
ComparisonResult result = compareLogic.Compare(object1, object2);
Assert.IsTrue(result.AreEqual); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-08-10T08:18:11.330

此方法将获取`properties`类并比较每个 的值`property`。如果任何值不同，它会`return false`，否则它会`return true`。

```
public static bool Compare<T>(T Object1, T object2)
{
    //Get the type of the object
    Type type = typeof(T);

    //return false if any of the object is false
    if (Object1 == null || object2 == null)
        return false;

    //Loop through each properties inside class and get values for the property from both the objects and compare
    foreach (System.Reflection.PropertyInfo property in type.GetProperties())
    {
        if (property.Name != "ExtensionData")
        {
            string Object1Value = string.Empty;
            string Object2Value = string.Empty;
            if (type.GetProperty(property.Name).GetValue(Object1, null) != null)
                Object1Value = type.GetProperty(property.Name).GetValue(Object1, null).ToString();
            if (type.GetProperty(property.Name).GetValue(object2, null) != null)
                Object2Value = type.GetProperty(property.Name).GetValue(object2, null).ToString();
            if (Object1Value.Trim() != Object2Value.Trim())
            {
                return false;
            }
        }
    }
    return true;
} 
```

**用法：**

`bool isEqual = Compare<Employee>(Object1, Object2)`

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-05-13T09:23:55.083

为了扩展@nawfal:s 的答案，我在单元测试中使用它来测试不同类型的对象，以比较相同的属性名称。在我的情况下，数据库实体和 DTO。

在我的测试中这样使用；

```
Assert.IsTrue(resultDto.PublicInstancePropertiesEqual(expectedEntity));

public static bool PublicInstancePropertiesEqual<T, Z>(this T self, Z to, params string[] ignore) where T : class
{
    if (self != null && to != null)
    {
        var type = typeof(T);
        var type2 = typeof(Z);
        var ignoreList = new List<string>(ignore);
        var unequalProperties =
           from pi in type.GetProperties(BindingFlags.Public | BindingFlags.Instance)
           where !ignoreList.Contains(pi.Name)
           let selfValue = type.GetProperty(pi.Name).GetValue(self, null)
           let toValue = type2.GetProperty(pi.Name).GetValue(to, null)
           where selfValue != toValue && (selfValue == null || !selfValue.Equals(toValue))
           select selfValue;
           return !unequalProperties.Any();
    }
    return self == null && to == null;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-12-22T19:03:46.897

有时您不想比较所有公共属性而只想比较它们的子集，因此在这种情况下，您可以移动逻辑来将所需的属性列表与抽象类进行比较

```
public abstract class ValueObject<T> where T : ValueObject<T>
{
    protected abstract IEnumerable<object> GetAttributesToIncludeInEqualityCheck();

    public override bool Equals(object other)
    {
        return Equals(other as T);
    }

    public bool Equals(T other)
    {
        if (other == null)
        {
            return false;
        }

        return GetAttributesToIncludeInEqualityCheck()
            .SequenceEqual(other.GetAttributesToIncludeInEqualityCheck());
    }

    public static bool operator ==(ValueObject<T> left, ValueObject<T> right)
    {
        return Equals(left, right);
    }

    public static bool operator !=(ValueObject<T> left, ValueObject<T> right)
    {
        return !(left == right);
    }

    public override int GetHashCode()
    {
        int hash = 17;
        foreach (var obj in this.GetAttributesToIncludeInEqualityCheck())
            hash = hash * 31 + (obj == null ? 0 : obj.GetHashCode());

        return hash;
    }
} 
```

并稍后使用这个抽象类来比较对象

```
public class Meters : ValueObject<Meters>
{
    ...

    protected decimal DistanceInMeters { get; private set; }

    ...

    protected override IEnumerable<object> GetAttributesToIncludeInEqualityCheck()
    {
        return new List<Object> { DistanceInMeters };
    }
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-03-31T13:04:08.400

我的解决方案灵感来自上面的 Aras Alenin 答案，其中我添加了一个级别的对象比较和一个自定义对象来比较结果。我也有兴趣使用对象名称获取属性名称：

```
 public static IEnumerable<ObjectPropertyChanged> GetPublicSimplePropertiesChanged<T>(this T previous, T proposedChange,
     string[] namesOfPropertiesToBeIgnored) where T : class
    {
        return GetPublicGenericPropertiesChanged(previous, proposedChange, namesOfPropertiesToBeIgnored, true, null, null);
    }

    public static IReadOnlyList<ObjectPropertyChanged> GetPublicGenericPropertiesChanged<T>(this T previous, T proposedChange,
        string[] namesOfPropertiesToBeIgnored) where T : class
    {
        return GetPublicGenericPropertiesChanged(previous, proposedChange, namesOfPropertiesToBeIgnored, false, null, null);
    }

    /// <summary>
    /// Gets the names of the public properties which values differs between first and second objects.
    /// Considers 'simple' properties AND for complex properties without index, get the simple properties of the children objects.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="previous">The previous object.</param>
    /// <param name="proposedChange">The second object which should be the new one.</param>
    /// <param name="namesOfPropertiesToBeIgnored">The names of the properties to be ignored.</param>
    /// <param name="simpleTypeOnly">if set to <c>true</c> consider simple types only.</param>
    /// <param name="parentTypeString">The parent type string. Meant only for recursive call with simpleTypeOnly set to <c>true</c>.</param>
    /// <param name="secondType">when calling recursively, the current type of T must be clearly defined here, as T will be more generic (using base class).</param>
    /// <returns>
    /// the names of the properties
    /// </returns>
    private static IReadOnlyList<ObjectPropertyChanged> GetPublicGenericPropertiesChanged<T>(this T previous, T proposedChange,
        string[] namesOfPropertiesToBeIgnored, bool simpleTypeOnly, string parentTypeString, Type secondType) where T : class
    {
        List<ObjectPropertyChanged> propertiesChanged = new List<ObjectPropertyChanged>();

        if (previous != null && proposedChange != null)
        {
            var type = secondType == null ? typeof(T) : secondType;
            string typeStr = parentTypeString + type.Name + ".";
            var ignoreList = namesOfPropertiesToBeIgnored.CreateList();
            IEnumerable<IEnumerable<ObjectPropertyChanged>> genericPropertiesChanged =
                from pi in type.GetProperties(BindingFlags.Public | BindingFlags.Instance)
                where !ignoreList.Contains(pi.Name) && pi.GetIndexParameters().Length == 0 
                    && (!simpleTypeOnly || simpleTypeOnly && pi.PropertyType.IsSimpleType())
                let firstValue = type.GetProperty(pi.Name).GetValue(previous, null)
                let secondValue = type.GetProperty(pi.Name).GetValue(proposedChange, null)
                where firstValue != secondValue && (firstValue == null || !firstValue.Equals(secondValue))
                let subPropertiesChanged = simpleTypeOnly || pi.PropertyType.IsSimpleType()
                    ? null
                    : GetPublicGenericPropertiesChanged(firstValue, secondValue, namesOfPropertiesToBeIgnored, true, typeStr, pi.PropertyType)
                let objectPropertiesChanged = subPropertiesChanged != null && subPropertiesChanged.Count() > 0
                    ? subPropertiesChanged
                    : (new ObjectPropertyChanged(proposedChange.ToString(), typeStr + pi.Name, firstValue.ToStringOrNull(), secondValue.ToStringOrNull())).CreateList()
                select objectPropertiesChanged;

            if (genericPropertiesChanged != null)
            {   // get items from sub lists
                genericPropertiesChanged.ForEach(a => propertiesChanged.AddRange(a));
            }
        }
        return propertiesChanged;
    } 
```

使用下面的类来存储比较结果

```
[System.Serializable]
public class ObjectPropertyChanged
{
    public ObjectPropertyChanged(string objectId, string propertyName, string previousValue, string changedValue)
    {
        ObjectId = objectId;
        PropertyName = propertyName;
        PreviousValue = previousValue;
        ProposedChangedValue = changedValue;
    }

    public string ObjectId { get; set; }

    public string PropertyName { get; set; }

    public string PreviousValue { get; set; }

    public string ProposedChangedValue { get; set; }
} 
```

和一个示例单元测试：

```
 [TestMethod()]
    public void GetPublicGenericPropertiesChangedTest1()
    {
        // Define objects to test
        Function func1 = new Function { Id = 1, Description = "func1" };
        Function func2 = new Function { Id = 2, Description = "func2" };
        FunctionAssignment funcAss1 = new FunctionAssignment
        {
            Function = func1,
            Level = 1
        };
        FunctionAssignment funcAss2 = new FunctionAssignment
        {
            Function = func2,
            Level = 2
        };

        // Main test: read properties changed
        var propertiesChanged = Utils.GetPublicGenericPropertiesChanged(funcAss1, funcAss2, null);

        Assert.IsNotNull(propertiesChanged);
        Assert.IsTrue(propertiesChanged.Count == 3);
        Assert.IsTrue(propertiesChanged[0].PropertyName == "FunctionAssignment.Function.Description");
        Assert.IsTrue(propertiesChanged[1].PropertyName == "FunctionAssignment.Function.Id");
        Assert.IsTrue(propertiesChanged[2].PropertyName == "FunctionAssignment.Level");
    } 
```

# iis - 当通过 IIS 配置 Web 应用程序时，从剪贴板粘贴图像不起作用

> ID：506102
> 
> 赞同：0
> 
> 时间：2009-02-03T05:37:11.630
> 
> 标签：iis, image, internet-explorer-7, c#-2.0, clipboard

我正在使用 ASP.NET v2.0 创建一个基于 Web 的应用程序。我的项目要求在我的网页中有一个控件，允许用户从剪贴板输入文本或复制粘贴图像（比如快照）。

为了达到同样的效果，我尝试在 Web 表单中使用 windows 剪贴板类并检索剪贴板图像并将其存储在 Sql Server DB 中。单击按钮后，将获取相应的图像并将其显示给最终用户。

通过 IDE 运行时，所有这些都可以正常工作。当我在 IIS 中托管我的 Web 应用程序时，我无法实现相同的目标。通过单击按钮从剪贴板粘贴图像不起作用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-02-03T06:19:13.513

您不能直接在 Web 应用程序上使用 windows 剪贴板类。

您可以让用户将一些数据从剪贴板复制到输入控件，然后通过回发或 AJAX 发布该数据。或者，您可以使用自定义 ActiveX 控件等客户端工具从剪贴板获取数据。

我的猜测是，当它通过 IDE 运行时，信息是通过“后门”获取的。由于一切都发生在同一个系统上，正确的信息恰好在 Windows 剪贴板中。

# java - 如何检查单个字符是否出现在字符串中？

> ID：506105
> 
> 赞同：258
> 
> 时间：2009-02-03T05:38:42.737
> 
> 标签：java, validation, string, character

在 Java 中有一种方法可以检查条件：

“这个单个字符是否出现在字符串 x 中”

**不**使用循环？

* * *

## 回答 #1

> 赞同：328
> 
> 时间：2009-02-03T05:40:35.853

您可以使用[`string.indexOf('a')`](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#indexOf%28int%29).

如果字符`a`存在于`string`：

> 它返回此对象表示的字符序列中字符第一次出现的索引，如果字符不出现，则返回 -1。

* * *

## 回答 #2

> 赞同：156
> 
> 时间：2009-02-03T05:41:41.513

*   [**`String.contains()`**](http://java.sun.com/javase/6/docs/api/java/lang/String.html#contains(java.lang.CharSequence))检查字符串是否包含指定的 char 值序列
*   [**`String.indexOf()`**](http://java.sun.com/javase/6/docs/api/java/lang/String.html#indexOf(int))它返回指定字符或子字符串第一次出现的字符串中的索引（此方法有 4 种变体）

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-02-03T13:53:56.310

我不确定原始海报到底在问什么。由于 indexOf(...) 和 contains(...) 都*可能*在内部使用循环，也许他正在寻找如果没有循环这是否可能？我可以想到两种方法，一种当然是递归：

```
public boolean containsChar(String s, char search) {
    if (s.length() == 0)
        return false;
    else
        return s.charAt(0) == search || containsChar(s.substring(1), search);
} 
```

另一个远没有那么优雅，但完整性......：

```
/**
 * Works for strings of up to 5 characters
 */
public boolean containsChar(String s, char search) {
    if (s.length() > 5) throw IllegalArgumentException();

    try {
        if (s.charAt(0) == search) return true;
        if (s.charAt(1) == search) return true;
        if (s.charAt(2) == search) return true;
        if (s.charAt(3) == search) return true;
        if (s.charAt(4) == search) return true;
    } catch (IndexOutOfBoundsException e) {
        // this should never happen...
        return false;
    }
    return false;
} 
```

当然，随着您需要支持越来越长的字符串，行数会增加。但是根本没有循环/递归。如果您担心 length() 使用循环，您甚至可以删除长度检查。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-07-11T07:00:51.840

```
String temp = "abcdefghi";
if(temp.indexOf("b")!=-1)
{
   System.out.println("there is 'b' in temp string");
}
else
{
   System.out.println("there is no 'b' in temp string");
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2018-03-27T13:14:16.553

您可以使用`String`类中的 2 种方法。

*   [**`String.contains()`**](http://java.sun.com/javase/6/docs/api/java/lang/String.html#contains(java.lang.CharSequence))检查字符串是否包含指定的 char 值序列
*   [**`String.indexOf()`**](http://java.sun.com/javase/6/docs/api/java/lang/String.html#indexOf(int))返回指定字符或子字符串第一次出现的字符串中的索引，如果未找到该字符，则返回 -1（此方法有 4 种变体）

方法一：

```
String myString = "foobar";
if (myString.contains("x") {
    // Do something.
} 
```

方法二：

```
String myString = "foobar";
if (myString.indexOf("x") >= 0 {
    // Do something.
} 
```

链接：[扎克·斯克里维纳](https://stackoverflow.com/users/20029/zach-scrivena)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-05-07T11:16:01.167

如果您需要经常检查相同的字符串，您可以预先计算出现的字符。这是一个使用包含在长数组中的位数组的实现：

```
public class FastCharacterInStringChecker implements Serializable {
private static final long serialVersionUID = 1L;

private final long[] l = new long[1024]; // 65536 / 64 = 1024

public FastCharacterInStringChecker(final String string) {
    for (final char c: string.toCharArray()) {
        final int index = c >> 6;
        final int value = c - (index << 6);
        l[index] |= 1L << value;
    }
}

public boolean contains(final char c) {
    final int index = c >> 6; // c / 64
    final int value = c - (index << 6); // c - (index * 64)
    return (l[index] & (1L << value)) != 0;
}} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-03T05:41:44.400

要检查字符串中是否不存在某些内容，您至少需要查看字符串中的每个字符。因此，即使您没有明确使用循环，它也将具有相同的效率。话虽如此，您可以尝试使用 str.contains(""+char)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-03T05:44:38.357

是的，在字符串类上使用 indexOf() 方法。[请参阅此方法的 API 文档](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#indexOf(int))

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-03-27T13:20:16.207

以下是您要查找的内容吗？

```
int index = string.indexOf(character);
return index != -1; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-07-24T15:54:30.780

```
package com;
public class _index {

    public static void main(String[] args) {
        String s1="be proud to be an indian";
        char ch=s1.charAt(s1.indexOf('e'));
        int count = 0; 
        for(int i=0;i<s1.length();i++) {
            if(s1.charAt(i)=='e'){
                System.out.println("number of E:=="+ch);
                count++;
            }
        }
        System.out.println("Total count of E:=="+count);
    }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-08-09T07:25:18.853

如果你在 JAVA 中看到**indexOf的源代码：**

```
public int indexOf(int ch, int fromIndex) {

        final int max = value.length;

        if (fromIndex < 0) {

            fromIndex = 0;

        } else if (fromIndex >= max) {

            // Note: fromIndex might be near -1>>>1.

            return -1;

        }

        if (ch < Character.MIN_SUPPLEMENTARY_CODE_POINT) {

            // handle most cases here (ch is a BMP code point or a

            // negative value (invalid code point))

            final char[] value = this.value;

            for (int i = fromIndex; i < max; i++) {

                if (value[i] == ch) {

                    return i;

                }

            }

            return -1;

        } else {

            return indexOfSupplementary(ch, fromIndex);

        }

    } 
```

您可以看到它使用 for 循环来查找字符。请注意，您可能在代码中使用的每个*indexOf*都等于一个循环。

**因此，对单个字符使用循环是不可避免的。**

但是，如果您想找到具有更多不同形式的特殊字符串，请使用有用的库，例如`util.regex`，它部署了更强大的算法来匹配字符或字符串模式与*正则表达式*。例如在字符串中查找电子邮件：

```
String regex = "^(.+)@(.+)$";

Pattern pattern = Pattern.compile(regex);
Matcher matcher = pattern.matcher(email); 
```

如果您不喜欢使用正则表达式，只需使用一个循环`charAt`并尝试在一个循环中涵盖所有情况。

小心递归方法比循环有更多的开销，所以不推荐。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-02-22T22:34:30.773

`String.contains(String)`或`String.indexOf(String)`- 建议

```
"abc".contains("Z"); // false - correct
"zzzz".contains("Z"); // false - correct
"Z".contains("Z"); // true - correct
"and".contains(""); // true - correct
"and".contains(""); // false - correct
"and".indexOf(""); // 0 - correct
"and".indexOf(""); // -1 - correct 
```

`String.indexOf(int)`并仔细考虑`String.indexOf(char)`与 char`int`扩大

```
"and".indexOf("".charAt(0)); // 0 though incorrect usage has correct output due to portion of correct data
"and".indexOf("".charAt(0)); // 0 -- incorrect usage and ambiguous result
"and".indexOf("".codePointAt(0)); // -1 -- correct usage and correct output 
```

## Java世界中关于字符的讨论是模棱两可的

### 可以将值`char`或`Character`视为单个字符吗？

**没有**。在 unicode 字符的上下文中，`char`或者`Character`有时可以`part of a single character`并且不应该被视为`a complete single character`逻辑上的。

### 如果不是，什么应该被视为单个字符（逻辑上）？

任何支持 Unicode 字符的字符编码的系统都应将 unicode 的代码点视为单个字符。

所以 Java 应该非常清晰和响亮地做到这一点，而不是向用户暴露太多的内部实现细节。

`String`类不擅长抽象（尽管它需要令人困惑的大量 of `understanding of its encapsulations to understand the abstraction` ，因此需要 a `anti-pattern`）。

### 它与一般`char`用法有何不同？

`char`只能映射到基本多语言平面中的一个字符。

只能`codePoint - int`覆盖 Unicode 字符的全部范围。

### 为什么会有这种差异？

`char`在内部被视为`16-bit`无符号值，无法使用 UTF-16 内部表示法表示所有 unicode 字符，仅使用`2-bytes`. 有时，`16-bit`必须将某个范围内的值与另一个`16-bit`值组合才能正确定义字符。

不用太冗长， , 和此类方法的用法`indexOf`应该`charAt`更加`length`明确。真诚地希望 Java 将添加具有明确定义抽象的新类`UnicodeString`。`UnicodeCharacter`

### 喜欢`contains`和不喜欢的理由`indexOf(int)`

1.  实际上，有许多代码流将逻辑字符视为`char`在 java 中。
2.  在 Unicode 上下文中，`char`是不够的
3.  虽然, to转换`indexOf`中的转换掩盖了用户和用户可能会做的事情（除非用户知道确切的上下文）`int``char``int``str.indexOf(someotherstr.charAt(0))`
4.  因此，将所有内容都视为`CharSequence`(aka `String`) 更好

```
 public static void main(String[] args) {
        System.out.println("and".indexOf("".charAt(0))); // 0 though incorrect usage has correct output due to portion of correct data
        System.out.println("and".indexOf("".charAt(0))); // 0 -- incorrect usage and ambiguous result
        System.out.println("and".indexOf("".codePointAt(0))); // -1 -- correct usage and correct output
        System.out.println("and".contains("")); // true - correct
        System.out.println("and".contains("")); // false - correct
    } 
```

## 语义

1.  `char`可以处理大部分实际用例。为了将来的可扩展性，在编程环境中使用代码点仍然更好。
2.  `codepoint`应该处理几乎所有围绕编码的技术用例。
3.  尽管如此，[Grapheme Clusters](https://unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries)`codepoint`仍然超出了抽象级别的范围。
4.  如果成本太高（加倍），存储层可以选择`char`接口。`int`除非存储成本是唯一的指标，否则它仍然更好用`codepoint`。此外，最好将存储视为`byte`并将语义委托给围绕存储构建的业务逻辑。
5.  语义可以在多个级别进行抽象。`codepoint`应该成为最低级别的接口，并且可以`codepoint`在运行时环境中构建其他语义。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-05-22T05:21:00.020

```
static String removeOccurences(String a, String b)
{
    StringBuilder s2 = new StringBuilder(a);

    for(int i=0;i<b.length();i++){
        char ch = b.charAt(i);  
        System.out.println(ch+"  first index"+a.indexOf(ch));

        int lastind = a.lastIndexOf(ch);

    for(int k=new String(s2).indexOf(ch);k > 0;k=new String(s2).indexOf(ch)){
            if(s2.charAt(k) == ch){
                s2.deleteCharAt(k);
        System.out.println("val of s2 :             "+s2.toString());
            }
        }
      }

    System.out.println(s1.toString());

    return (s1.toString());
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-01-09T06:05:34.767

```
you can use this code. It will check the char is present or not. If it is present then the return value is >= 0 otherwise it's -1\. Here I am printing alphabets that is not present in the input.

import java.util.Scanner;

public class Test {

public static void letters()
{
    System.out.println("Enter input char");
    Scanner sc = new Scanner(System.in);
    String input = sc.next();
    System.out.println("Output : ");
    for (char alphabet = 'A'; alphabet <= 'Z'; alphabet++) {
            if(input.toUpperCase().indexOf(alphabet) < 0) 
                System.out.print(alphabet + " ");
    }
}
public static void main(String[] args) {
    letters();
} 
```

}

```
//Ouput Example
Enter input char
nandu
Output : 
B C E F G H I J K L M O P Q R S T V W X Y Z 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2019-07-03T08:45:42.893

您将无法检查 char 是否出现在某个字符串中，而无需使用循环/递归至少遍历字符串一次（诸如 indexOf 的内置方法也使用循环）

如果没有。*如果字符在字符串x*中，您查找的次数比我建议使用[Set](https://docs.oracle.com/javase/7/docs/api/java/util/Set.html)数据结构的字符串长度要多得多，因为这比简单地使用更有效`indexOf`

```
String s = "abc";

// Build a set so we can check if character exists in constant time O(1)
Set<Character> set = new HashSet<>();
int len = s.length();
for(int i = 0; i < len; i++) set.add(s.charAt(i));

// Now we can check without the need of a loop
// contains method of set doesn't use a loop unlike string's contains method
set.contains('a') // true
set.contains('z') // false 
```

使用 set 您将能够在**恒定时间**O(1) 中检查字符串中是否存在字符，但您还将使用额外的内存（空间复杂度将为 O(n) ）。

# backup - 您为数据集（磁盘上的文件）使用什么备份库/代码？

> ID：506108
> 
> 赞同：-1
> 
> 时间：2009-02-03T05:41:41.513
> 
> 标签：backup, desktop, clarion

我正在我的新（小）应用程序[Oldaer](http://oldaer.com)中实现备份功能。我有独立的桌面文件（而不是坐在 SQL 数据库中）。

环顾四周，我决定使用 Clarion 3rd-Party 模板，将它们打包成一个文件，然后压缩（霍夫曼的）那个文件。恢复正好相反。解压，解压。

但是，我不相信这是理想的。

**您为数据集实施了哪些备份功能？**

当然，“备份/恢复”功能还有很多。位置、跟踪/存档、开箱即用信息（例如让用户知道存档文件中内容的更好方法）。但这是另一个问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T13:46:01.193

SQL 复制、集群、RAID 5

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T13:28:15.713

刚刚使用 Clarion 中的 NetTalk 3rd 方库将数据集上传到 Amazon S3。似乎是一种享受。我正在努力使用 MetaTags 功能保留数据集的多个“版本”。

很高兴挖掘我的代码并在需要时进一步讨论。

# teamcity - TeamCity 忘记了管理员密码 - 去哪里看？

> ID：506115
> 
> 赞同：69
> 
> 时间：2009-02-03T05:43:41.820
> 
> 标签：teamcity

我需要恢复/重置 JetBrain 的**TeamCity**的管理员密码。

我对服务器有完全的 RDP 访问权限，所以那里没有问题。我们使用它才 2 个月，所以现在我忘记了我的登录 - 我通常的登录不起作用。

目前它是在没有数据库的情况下设置的，所以希望用户名只是在某个文件中，但到目前为止还没有找到它。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2013-09-11T07:46:00.977

在 TeamCity 8 中，您可以以超级用户身份登录并以这种方式更改密码。您只需要使用一个空的用户名和最后一次出现在 logs\teamcity-server.log 文件中的“超级用户身份验证令牌”作为您的密码。

有关更多信息，请参阅以下内容：

*   TeamCity 8 - [http://confluence.jetbrains.com/display/TCD8/Super+User](http://confluence.jetbrains.com/display/TCD8/Super+User)
*   TeamCity 9 - [http://confluence.jetbrains.com/display/TCD9/Super+User](http://confluence.jetbrains.com/display/TCD9/Super+User)
*   TeamCity 10 - [https://confluence.jetbrains.com/display/TCD10/Super+User](https://confluence.jetbrains.com/display/TCD10/Super+User)

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-08-14T11:50:45.623

如果这些都不起作用，请参阅[http://sebastienlachance.com/post/Resetting-TeamCity-Password.aspx](http://sebastienlachance.com/post/Resetting-TeamCity-Password.aspx)。

打开命令提示符并转到 \webapps\ROOT\WEB-INF\lib 文件夹。现在输入以下内容：

```
..\..\..\..\jre\bin\java.exe -cp server.jar;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword username newpassword 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-10T19:37:53.933

对于 TeamCity 6.5.4

从 [TeamCity 安装文件夹]\webapps\ROOT\WEB-INF\lib 中的命令提示符：

```
..\..\..\..\jre\bin\java -cp server.jar;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword admin NewPassword 
```

在我的情况下，我的用户名是“admin”（我想我是在安装过程中设置的，但我不能确定）。

我省略了 TeamCity 参数的路径，它足够聪明，可以使用正确的路径（我的是 c:\users\administrator.BuildServer）

当我提供到 TeamCity 的（错误的）路径作为参数时，我收到了这条消息：

```
Using TeamCity configuration directory path: c:/TeamCity/.BuildServer
Exception in thread "main" java.sql.SQLException: Table not found in statement [UPDATE users SET PASSWORD = ? WHERE USERNAME = ? AND REALM IS NULL]
    at org.hsqldb.jdbc.Util.throwError(Util.java:58)
    at org.hsqldb.jdbc.jdbcPreparedStatement.<init>(jdbcPreparedStatement.java:1833)
    at org.hsqldb.jdbc.jdbcConnection.prepareStatement(jdbcConnection.java:580)
    at ChangePassword.main(ChangePassword.java:14) 
```

以防这也让其他人感到困惑。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T08:25:15.147

您可以尝试通过删除 TeamCity 数据目录（`$/.BuildServer`默认为目录）来重置 TeamCity 的安装

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-03-06T13:35:55.753

超级用户直接网址：

```
http://servername:port/login.html?super=1 
```

打开TeamCity日志文件夹（例C:盘：C:\TeamCity\logs）：teamcity-server.log，找到key：“超级用户认证”

```
[2019-03-04 12:14:30,770]   INFO -   jetbrains.buildServer.SERVER - Super user authentication token: `8347518935696887114` (use empty username with the token as the password to access the server) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-17T23:28:39.257

尝试以下操作：

首先停止 TeamCity 服务（如果安装了构建代理，也会停止）。接下来打开一个控制台，转到您的 java 目录并从那里运行以下命令：

```
java.exe -cp server.jar; hsqldb.jar ChangePassword USERNAME PASSWORD "PATH_TO_YOUR_TEAMCITY_INSTALLATION".BuildServer 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-11-04T04:27:59.480

我刚刚用 v5 EAP 经历了这种痛苦。

我设法通过运行成功重置密码：

```
C:\TeamCity\webapps\ROOT\WEB-INF\lib>..\..\..\..\jre\bin\java -cp server.jar;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword admin password c:\TeamCity\.BuildServer 
```

尽管您需要将 C:\TeamCity 替换为安装所在的位置。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-21T16:55:51.277

万一这对其他人有帮助，无论谁在我的服务器上安装了 TeamCity，都将构建目录放置在管理员配置文件下，而不是 C:\TeamCity。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-09-25T01:22:30.077

特别是对于在 Windows 上的 Tomcat 上运行的 TeamCity，它将是 C:\ProgramData\JetBrains\TeamCity

最后一个参数指定的目录需要是您的数据目录（在 /logs/teamcity-server.log 中查找）

如果不正确，您将收到“找不到表”错误。

如果您已运行 TeamCity，您将收到“数据库已在使用中”错误。

您还可以搜索 /logs/teamcity-server.log 以查看您是否创建了管理员、管理员或其他管理员用户名。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-06-22T01:24:09.347

对于可能像我刚刚做的原始答案多年后到达本文的每个人，都有一个内置的超级用户帐户，并且每次启动团队城市时都会重新生成密码，并且密码在日志中。您可以使用此超级用户登录和重置任何密码。这非常容易。

[https://confluence.jetbrains.com/display/TCD9/Super+User](https://confluence.jetbrains.com/display/TCD9/Super+User)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-03T08:54:48.580

TeamCity 始终使用数据库 - 如果您没有明确配置数据库，它会[使用 HSQLDB 数据库在内部存储数据](http://www.jetbrains.net/confluence/display/TCD4/Migrating+to+an+External+Database)。

使用外部数据库时，用户信息存储在该数据库中，因此您的案例中的用户信息很可能存储在 HSQLDB 系统中。

您可能可以通过使用数据库来访问系统 - 但我建议先进行备份。

第二个建议 - 给 JetBrains 的支持人员发一封电子邮件。甚至在我的工作场所购买 TeamCity Enterprise 许可证之前，他们的支持就非常出色 - 快速、准确且乐于助人。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-11-23T13:45:52.757

使用使用 MySQL 的 TeamCity 5（可能还有其他版本和 RDBM，但未经测试），可以直接通过 SQL 更新密码：

```
mysql> update users set password = md5("mypass123") where username = "bob"; 
```

尽管如此，如果没有充分的理由不这样做，我会坚持使用其他人已经提到的 CLI 版本。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-10T22:48:36.717

第一点是，如果您注销登录屏幕已经填写了用户名“TCAdmin”，那么它应该是“管理员”。TCAdmin 是（我认为）默认版本 5 管理员用户的全名。将其更改为管理员，然后使用我认为解决了我的问题的密码。

重置...如果它在 TeamCity 版本 5 上的 Windows XP 上帮助其他人，我的 .BuildServer 配置信息也在我当前登录的用户的文档和设置文件夹下。我也被塞巴斯蒂安上面的好答案中的 jar 文件列表中的一个空格绊倒了。

所以我在命令提示符下切换到这个目录：

```
 c:\teamcity\webapps\ROOT\WEB-INF\lib 
```

然后这个命令行（设置密码：Password1）对我有用：

```
C:\TeamCity\webapps\ROOT\WEB-INF\lib>..\..\..\..\jre\bin\java.exe -cp server.jar;commonapi.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword administrator Password1 
```

这给出了输出：

```
Using TeamCity configuration directory path: C:/Documents and Settings/tamw/.BuildServer 
Password changed successfuly 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-23T15:47:42.147

1.  停止团队城市
2.  您应该将路径传递给您的构建服务器，例如，如果您将构建服务器安装到目录“c:\.BuildServer”

........\jre\bin\java.exe -cp server.jar;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword username newpassword c:\.构建服务器

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-04-15T07:33:12.987

更改用户密码：

关闭服务器

切换到 /webapps/ROOT/WEB-INF/lib 目录

调用以下命令：

Windows平台：java -cp server.jar;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword

Unix平台：java -cp server.jar:common-api.jar:commons-codec-1.3.jar:util.jar:hsqldb.jar ChangePassword

如果您使用 TeamCity 数据文件的默认路径，则可以跳过该选项：/.BuildServer

[参考：http://confluence.jetbrains.com/display/TCD7/Changing+user+password+with+default+authentication+scheme]

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-04-17T10:03:22.627

这对我有用。

关闭服务器服务

```
> cd c:\TeamCity\webapps\ROOT\WEB-INF\lib> 
```

然后

```
> ..\..\..\..\jre\bin\java.exe -cp server.jar ;common-api.jar;commons-codec-1.3.jar;util.jar;hsqldb.jar ChangePassword admin password1 C:\ProgramData\JetBrains\TeamCity\ 
```

如果没有最后的路径，它将失败：

```
Exception in thread "main" java.sql.SQLException: Table not found in statement [
UPDATE users SET PASSWORD = ? WHERE USERNAME = ? AND REALM IS NULL]
        at org.hsqldb.jdbc.Util.throwError(Util.java:58)
        at org.hsqldb.jdbc.jdbcPreparedStatement.<init>(jdbcPreparedStatement.ja
va:1833)
        at org.hsqldb.jdbc.jdbcConnection.prepareStatement(jdbcConnection.java:5
80)
        at ChangePassword.main(ChangePassword.java:14) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-11-05T16:47:43.793

我们使用带有 MS SQL Server 的 Teamcity 7 作为 RDBMS。

要重置密码，您可以使用以下查询：

```
UPDATE users SET password = LOWER(SUBSTRING(sys.fn_sqlvarbasetostr(HASHBYTES('md5','your_new_password')),3,32))
 where username = "your_user_name"; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-10-03T07:21:20.813

或者，您可以使用 TeamCity 服务器日志并检索超级用户令牌。

使用令牌，转到 URL：[http://(server):(port)/login.html?super=1](http://(server):(port)/login.html?super=1)

即：[http://localhost:92/login.html?super=1](http://localhost:92/login.html?super=1)

登录后，您始终可以创建新用户或重置相关帐户的密码。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-04-09T13:00:57.510

我在相同的情况下通过并使用超级用户登录，请按照以下步骤操作：

1 - 在路径“XX:\TeamCity\logs”中的“teamcity-server.log”中获取 Token；

2 - 使用 url 上的令牌访问和登录：“/login.html?super=1”；

更多关于它：

[https://confluence.jetbrains.com/display/TCD18/Super+User](https://confluence.jetbrains.com/display/TCD18/Super+User)

# random - 如何手动生成随机数

> ID：506118
> 
> 赞同：16
> 
> 时间：2009-02-03T05:44:52.753
> 
> 标签：random

我想手动生成随机数。我知道每种语言都有 rand 或 random 函数，但我很想知道它是如何工作的。有没有人有代码？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-01T18:53:03.697

`rand()`POSIX.1-2001 给出了和的以下实现示例，`srand()`当在两台不同的机器上需要相同的序列时可能很有用。

```
static unsigned long next = 1;
/* RAND_MAX assumed to be 32767 */
int myrand(void) {
    next = next * 1103515245 + 12345;
    return((unsigned)(next/65536) % 32768);
}
void mysrand(unsigned seed) {
    next = seed;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-03T05:55:00.177

看看以下内容：

[随机数生成](http://en.wikipedia.org/wiki/Random_number_generator)

[线性同余生成器](http://en.wikipedia.org/wiki/Linear_congruential_generator)——一种在 Java 中也使用的流行方法

[随机数生成器列表](http://en.wikipedia.org/wiki/List_of_random_number_generators)

这是另一个[链接](http://www.javamex.com/tutorials/random_numbers/java_util_random_algorithm.shtml)，详细说明了 LCG 在 Java 的 Random 类中的使用

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-08-30T00:17:01.197

```
 static void Main()
    {
        DateTime currentTime = DateTime.Now;

        int maxValue = 100;

        int hour = currentTime.Hour;
        int minute = currentTime.Minute;
        int second = currentTime.Second;
        int milisecond = currentTime.Millisecond;

        int randNum = (((hour + 1) * (minute + 1) * (second + 1) * milisecond) % maxValue);

        Console.WriteLine(randNum);

        Console.ReadLine();
    } 
```

上面显示了一段非常简单的代码来生成随机数。它是一个用 C# 编写的控制台程序。如果您知道任何类型的基本编程，这应该是可以理解的并且很容易转换为所需的任何其他语言。

DateTime 只接受当前日期和时间，大多数编程语言都有这样做的工具。

小时、分钟、秒和毫秒变量将日期时间值分解为其组成部分。我们只对这些部分感兴趣，所以可以忽略一天。同样，在大多数语言中，日期和时间通常显示为字符串。在 .Net 中，我们有一些工具可以让我们轻松解析这些信息。但是在大多数其他以字符串形式表示时间的语言中，将字符串解析为您想要的部分并将它们转换为它们的数字并不是太困难。这些设施通常甚至以最古老的语言提供。

种子本质上给了我们一个总是变化的起始数字。传统上，您只需将此数字乘以 0 到 1 之间的十进制值，这样就省去了该步骤。

upperRange 定义最大值。所以生成的数字永远不会超过这个值。它也永远不会低于 0。所以没有 ngatives。但如果你想要否定，你可以手动否定它。（乘以-1）

实际变量 randNumis 保存您感兴趣的随机值。

诀窍是在将种子除以上限后得到余数（模数）。余数总是小于除数，在这种情况下为 100。简单的数学告诉你，余数不能大于除数。因此，如果除以 10，余数不能大于 10。在这种情况下，正是这个简单的定律使我们得到了介于 0 和 100 之间的随机数。

console.writeline 只是将它输出到屏幕上。

console.readline 只是暂停程序以便您可以看到它。

这是一段非常简单的生成随机数的代码。如果您每天在完全相同的时间间隔运行该程序（但您必须在相同的小时、分钟、秒和毫秒）运行超过 1 天，您将开始一次又一次地生成相同的数字集额外的一天。这是因为它与时间有关。那就是生成器的分辨率。所以如果你知道这个程序的代码，以及它运行的时间，你就可以预测生成的数字，但这并不容易。这就是我使用毫秒的原因。仅使用秒或分钟来了解我的意思。所以你可以写一个表格，显示1什么时候进去，0出来，2什么时候进去，0出来等等。然后，您可以预测每秒的输出以及生成的数字范围。增加分辨率的次数越多（通过增加变化的数字）就越难，获得可预测的模式所需的时间就越长。这种方法对于大多数人来说已经足够好了。

那是为基本游戏进行随机数生成的老派方式。它需要快速且简单。这是。这也突出了为什么随机数生成器不是真正随机的，而是伪随机的。

我希望这是对您问题的合理回答。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-03T05:55:54.760

我假设您的意思是伪随机数。我知道的最简单的一个（从在旧机器上编写电子游戏游戏开始）是这样工作的：

种子=种子*5+1；

每次调用 random 时都这样做，然后使用任意数量的低位。*5+1 有一个很好的属性（IIRC），可以在重复之前击中每一种可能性，无论你正在查看多少位。

当然，缺点是它的可预测性。但这在游戏中并不重要。我们为各种各样的事情疯狂地抓取随机数，你永远不知道下一个数字是什么。

并行做几件这样的事情，并结合结果。这是一个线性同余生成器。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-03T05:47:37.133

[http://en.wikipedia.org/wiki/Random_number_generator](http://en.wikipedia.org/wiki/Random_number_generator)

描述不同类型的随机数生成器以及它们是如何创建的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-06-22T13:20:26.780

啊哈！

手动是指“不使用计算机”还是“编写我自己的代码”？

如果不使用计算机，您可以使用骰子、袋子中的数字以及在电视上看到的所有这些方法，当他们选择球队时，赢得宾果系列等。拉斯维加斯充满了这些用于目标过程（游戏）的方法在给你不好的赔率和投资回报率。您还可以获得出色的 RAND 书籍并转到随机选择的页面：

[http://www.amazon.com/Million-Random-Digits-Normal-Deviates/dp/0833030477](https://rads.stackoverflow.com/amzn/click/com/0833030477)

（另外，为了一些娱乐，阅读评论）

为了编写自己的代码，您需要考虑为什么不使用系统提供的 RNG 还不够好。如果您使用的是现代操作系统，它将有一个可用于用户程序的 RNG，这对于您的应用程序来说应该足够好。

如果您真的需要实现自己的，那么有大量可用的生成器。对于非安全用途，您可以查看 LFSR 链、同余生成器等。无论您需要什么分布（均匀、正态、指数等），您都应该能够找到算法描述和具有实现的库。

对于安全性使用，您应该查看诸如 Yarrow/Fortuna、NIST SP 800-89 指定的 PRNG 和 RFC 4086 之类的东西，以获得提供 PRNG 所需的良好熵源。或者更好的是，使用操作系统中*应该*满足安全 RNG 要求的那个。

RNG 的实现可能是一个有趣的练习，但很少需要。除非用于玩具应用，否则不要发明自己的算法。不要，重复不要为安全应用程序发明 RNG（例如生成加密密钥），至少除非您进行一些 seripus 阅读和调查。你会感谢我的（我希望）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-08-17T19:03:13.877

希望我不是多余的，因为我没有阅读所有链接，但我相信你可以非常接近**真正的**随机生成器。如今的系统通常非常复杂，即使是最优秀的极客也需要大量时间来了解*内部发生*的事情:)

只要打开你的思维，想想你是否可以监控一些全局系统属性，用它来播种……选择一个网络数据包（不适合您？）并从其内容中计算“某些东西”并使用它来播种......等等。

您可以根据所有这些提示设计最适合您的需求;）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-10-12T17:23:44.967

[梅森龙卷风](http://en.wikipedia.org/wiki/Mersenne_twister)的周期很长（2^19937-1）。

这是 C++ 中一个非常基本的实现：

```
struct MT{
    unsigned int *mt, k, g;
    ~MT(){ delete mt; }
    MT(unsigned int seed) : mt(new unsigned int[624]), k(0), g(0){
        for (int i=0; i<624; i++)
            mt[i]=!i?seed:(1812433253U*(mt[i-1]^(mt[i-1]>>30))+i);
    }
    unsigned int operator()(){
        unsigned int q=(mt[k]&0x80000000U)|(mt[(k+1)%624]&0x7fffffffU);
        mt[k]=mt[(k+397)%624]^(q>>1)^((q&1)?0x9908b0dfU:0);
        unsigned int y = mt[k];
        y ^= (y >> 11);
        y ^= (y << 7) & 0x9d2c5680U;
        y ^= (y << 15) & 0xefc60000U;
        y ^= (y >> 18);
        k = (k+1)%624;
        return y;
    }
}; 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-12T18:00:41.307

获得随机数的一种好方法是监视通过计算机麦克风传来的环境噪音水平。如果您能获得驱动程序（或支持麦克风输入的语言）并将其转换为数字，那么您一切顺利！

还研究了如何获得“真正的随机性”——由于计算机只不过是二进制机器，它们不能给我们“真正的随机性”。一段时间后，序列将开始重复。对更好的随机数生成的追求仍在继续，但他们说监控房间内的环境噪声水平是防止随机数生成中形成模式的一种好方法。

您可以查看[这篇 wiki 文章](http://en.wikipedia.org/wiki/Random_number_generation#.22True.22_random_numbers_vs._pseudorandom_numbers)，了解有关随机数生成背后的科学的更多信息。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-12-29T10:13:03.243

如果您正在寻找随机数的理论处理方法，您可能可以查看*计算机编程艺术的*第 2 卷。它有一章专门讨论随机数。看看能不能帮到你。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-11-10T03:14:38.793

If you are wanting to manually, hard code, your own random generator I can't give you efficiency, however, I can give you reliability. I actually decided to write some code using time to test a computer's processing speed by counting in time and that turned into me writing my own random number generator using the counting algorithm for modulo (the count is random). Please, try it for yourselves and test on number distributions within a large test-set. By the way, this is written in python.

```
def count_in_time(n):
   import time
   count = 0
   start_time = time.clock()
   end_time = start_time + n
   while start_time < end_time:
       count += 1
       start_time += (time.clock() - start_time)
   return count

def generate_random(time_to_count, range_nums, rand_lst_size):
    randoms = []
    iterables = range(range_nums)
    count = 0
    for i in range(rand_lst_size):
        count += count_in_time(time_to_count)
        randoms.append(iterables[count%len(iterables)])
    return randoms 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-12-07T23:39:29.477

该[文档](http://www.cs.ucl.ac.uk/staff/d.jones/GoodPracticeRNG.pdf)是关于伪随机数生成的非常好的文章，并且包含许多例程（在 C 中）。它还讨论了对随机数生成器进行适当播种的必要性（参见规则 3）。对此特别有用的是 /dev/randon/ 的使用（如果您在 linux 机器上）。

注意：本文档中包含的例程比 Mersenne Twister 编码要简单得多**。**另请参阅[WELLRNG](http://www.iro.umontreal.ca/~panneton/WELLRNG.html)生成器，它应该具有更好的理论特性，作为 MT 的替代品。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-12-22T23:02:41.317

阅读随机数的兰特书（随机数的蒙特卡洛书）其中的数字是为您随机生成的！！！我的祖父为兰德公司工作。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-01-08T01:30:47.017

大多数 RNG（随机数生成器）都需要少量初始化。这通常是为了执行播种操作并存储播种值的结果以供以后使用。这是我为游戏引擎编写的随机发生器的播种方法示例：

```
 /// <summary>
    /// Initializes the number array from a seed provided by <paramref name="seed">seed</paramref>.
    /// </summary>
    /// <param name="seed">Unsigned integer value used to seed the number array.</param>
    private void Initialize(uint seed)
    {
        this.randBuf[0] = seed;
        for (uint i = 1; i < 100; i++)
        {
            this.randBuf[i] = (uint)(this.randBuf[i - 1] >> 1) + i;
        }
    } 
```

这是从随机化类的构造函数中调用的。现在可以使用上述种子值滚动/计算真实随机数。这通常是应用实际随机化算法的地方。这是另一个例子：

```
 /// <summary>
    /// Refreshes the list of values in the random number array.
    /// </summary>
    private void Roll()
    {
        for (uint i = 0; i < 99; i++)
        {
            uint y = this.randBuf[i + 1] * 3794U;
            this.randBuf[i] = (((y >> 10) + this.randBuf[i]) ^ this.randBuf[(i + 399) % 100]) + i;
            if ((this.randBuf[i] % 2) == 1)
            {
                this.randBuf[i] = (this.randBuf[i + 1] << 21) ^ (this.randBuf[i + 1] * (this.randBuf[i + 1] & 30));
            }
        }
    } 
```

现在滚动的值被存储以供本例以后使用，但这些数字也可以即时计算。预先计算的好处是性能略有提高。根据所使用的算法，滚动值可以直接返回或在代码请求时进行最后一分钟的计算。这是一个示例，它取自预滚动值并吐出一个非常漂亮的伪随机数：

```
 /// <summary>
    /// Retrieves a value from the random number array.
    /// </summary>
    /// <returns>A randomly generated unsigned integer</returns>
    private uint Random()
    {
        if (this.index == 0)
        {
            this.Roll();
        }

        uint y = this.randBuf[this.index];
        y = y ^ (y >> 11);
        y = y ^ ((y << 7) + 3794);
        y = y ^ ((y << 15) + 815);
        y = y ^ (y >> 18);
        this.index = (this.index + 1) % 100;
        return y;
    } 
```

# javascript - 延迟加载某个css背景图片

> ID：506126
> 
> 赞同：5
> 
> 时间：2009-02-03T05:48:15.570
> 
> 标签：javascript, html, css, loading, background-image

在这样的 CSS 中：

```
...
#big-menu {
    background: #fff url(../images/big-menu.jpg) no-repeat;
}
#some-menu {
    background: #fff url(../images/some-menu.jpg) no-repeat;
}
#some-other-menu {
    background: #fff url(../images/some-other-menu.jpg) no-repeat;
}
... 
```

有没有办法延迟加载`#big-menu`背景图像，以便它在其他所有内容之后加载，包括 HTML 中的所有图像，以及所有其他 CSS 背景（`some-menu`和`some-other-menu`）。

原因是，big-menu.jpg 的大小很重，我希望它最后加载。毕竟，它只是一种养眼，还有其他背景图像比这更好用。（例如按钮中使用的那些）

将它放入 CSS 中的顺序或`#big-menu`HTML 中标记 () 的出现是否与首先加载的内容有关？还是有更可靠的方法来控制它？javascript（首选jQuery）很好。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T06:33:21.393

css 中的排序不控制首先加载哪些资源，但会影响正在覆盖或继承的现有样式。

尝试 JavaScript onload 事件。该事件仅在页面完成加载后执行。

```
function loadBG(){
    document.getElementById("big-menu").style.backgroundImage="url(../images/big-menu.jpg)";
}
window.onload=loadBG(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T14:34:05.370

这可能不是一个完美的解决方案（因为它是一个 CSS 背景而不是图像），但[YUI 图像加载器](http://developer.yahoo.com/yui/imageloader/)提供了一种延迟加载图像的好方法。

创建群组

```
var imgGroup = new YAHOO.util.ImageLoader.group(window, 'load', 2); 
```

文档加载后，图像将在 2 秒后加载。见[雅虎！Shine](http://shine.yahoo.com/)或演示[示例](http://developer.yahoo.com/yui/examples/imageloader/index.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-05T08:06:59.503

另一种解决方案是将您的资产拆分到不同的域，浏览器一次只会请求两个资产，然后等待一个加载，然后再开始下一个。[您可以使用Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)和[YSlow](http://developer.yahoo.com/yslow/)观察这一点，因此将一些资产放在 images.example.com 和 images1.example.com 上，看看是否会产生影响

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T14:15:55.063

我不认为样式表中的位置会影响它，因为应用它们的元素的顺序将决定首先加载哪个图像。

不过，您可以使用 jQuery 以正确的顺序加载图像

```
$('firstElement').addClass('some-menu');
$('secondElement').addClass('some-other-menu');
$('lastElement').addClass('big-menu'); 
```

**编辑：** 好的，那么也许不是添加一个类，更好的解决方案是在运行时添加背景图像。

```
$('firstElement').css("background-image", "some-menu.jpg");
$('secondElement').css("background-image", "some-other-menu.jpg");
$('lastElement').css("background-image", "big-menu.jpg"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T12:10:12.493

在 CSS 中控制图像何时加载是不可能的。您可以尝试将它放在样式表的最底部，但我怀疑您会看到改进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T00:51:16.157

使用css无法控制下载顺序。但是，您可以使用 javascript 来实现这一点。

虽然与问题没有直接关系，但在这样做之前，您应该使用 smush.it 或您最喜欢的图像程序优化图像，我发现 jpeg 在以 85% 的质量保存时看起来非常好。进行实验，不要忘记将您的网络服务器设置为长时间缓存图像，然后问题将出现在您的用户第一次访问该站点时。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-09T14:39:57.017

Jason 的 Javascript 技巧为我解决了这个问题。但是，我不得不稍微更正语法：

```
function loadBG(){
     document.getElementById("big-menu").style.backgroundImage="url(../images/big-menu.jpg)";
}
window.onload=loadBG(); 
```

# php - 如何使用 Zend_Db 获取 Sqlite 数据库的最后插入 ID

> ID：506132
> 
> 赞同：5
> 
> 时间：2009-02-03T05:51:55.127
> 
> 标签：php, sqlite, zend-db

我正在尝试在我的 PHP 应用程序中获取 Sqlite DB 的最后插入的行 ID。我正在使用 Zend Framework 的 PDO Sqlite 适配器进行数据库处理。lastInsertId() 方法应该给我结果，但它不会。在 php.net 的 PDO 文档中，我读到 lastInsertId() 在所有数据库上的工作方式可能不同。但它根本不适用于sqlite吗？我尝试通过以下方式覆盖适配器的 lastInsertId() 方法：

```
// Zend_Db_Adapter_Pdo_Sqlite
public function lastInsertId() {
    $result = $this->_connection->query('SELECT last_insert_rowid()')->fetch();
    return $result[0];
} 
```

但它也不起作用。每次我调用它时都返回 0。有没有什么特别干净的方法可以找到最后插入的 ID？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-03T07:52:43.417

给定一个带有 table 的 SQLite3 数据库`b`，如下所示：

```
BEGIN TRANSACTION;
CREATE TABLE b(a integer primary key autoincrement, b varchar(1));
COMMIT; 
```

这段代码给了我一个`lastInsertId`：

```
public function lastInsertId() {
    $result = $this->_connection->query('SELECT last_insert_rowid() as last_insert_rowid')->fetch();
    return $result['last_insert_rowid'];
} 
```

也就是说 - 如果您的表定义正确，您唯一的问题可能是您尝试获取键 $result[0] - 此外，每当您使用计算列时，我建议使用“AS”为列命名正如我在上面演示的那样。如果您不想为该列起别名，则在 SQLite3 中该列应命名为“last_insert_rowid()”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-10T19:34:25.280

PDO::lastInserId()

见：[http ://us2.php.net/manual/en/pdo.lastinsertid.php](http://us2.php.net/manual/en/pdo.lastinsertid.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-02T12:45:34.253

不使用

```
SELECT * FROM tablename WHERE id = (SELECT COUNT(*) FROM tablename); 
```

改为使用

```
SELECT MAX(id) as id FROM tablename LIMIT 1; 
```

或者

```
SELECT id FROM tablename ORDER DESC LIMIT 1; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-10-04T20:06:31.570

```
SELECT * FROM [tablename] ORDER BY id DESC LIMIT 1 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-06-26T11:34:24.583

嘿，试试这个查询。但我不知道PHP。

```
SELECT *
FROM tablename
WHERE id = (SELECT COUNT(*) FROM tablename); 
```

# ms-access - 为什么我应该在 Jet 数据库上使用 SQLite

> ID：506136
> 
> 赞同：22
> 
> 时间：2009-02-03T05:53:40.973
> 
> 标签：ms-access, sqlite, jet

前几天有人问我这个问题，我想不出一个好的答案。平台可移植性与项目完全无关。

事实上，Jet 有一些 SQLite 没有的特性，即外键。

那么谁能想到为什么应该使用 SQLite 而不是 Jet 数据库？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-12T11:13:58.767

与其他人所说的相反，Jet 并没有死，而且离它还很远：ACE 是 Jet 的新版本，它非常健壮且向后兼容。

SQLite 和 Jet/ACE 都有其优点和缺点，您需要获取有关对您和您的应用程序很重要的特定点的更多信息。

*   无论哪种情况，您都可以重新分发引擎。
*   Jet/ACE 在 MS 工具和 Visual Studio 中的集成度更高，并且支持开箱即用。
*   Jet/ACE 具有更细粒度的锁定，如果您的应用程序允许多用户或需要多线程访问数据库，这可能很重要。
*   就您对数据库的期望（连接、联合和复杂查询）而言，Jet/ACE 具有更多功能。
*   Jet/ACE 具有到 SQL Server 的简单迁移路径，因此如果您的数据库需求变大，您可以相当轻松地迁移到 SQL Server。
*   SQLite 是跨平台的，所以如果你的应用需要移植到 Mono 下的 Linux/Mac 上，那么 SQLite 是一个更好的选择。
*   SQLite 引擎更紧凑，因此重新分配可能更容易。
*   SQLite 中的数据类型非常松散。
*   SQLite 拥有更自由的再分配权（因为你基本上可以用它做任何你想做的事）。

那些说 Jet 破坏数据库的人被困在 1995 年。

最后，除非您的应用程序有一些非常具体的要求正在推动任一数据库引擎的界限，那么您选择哪一个可能并不重要。
只需使用最容易包含在项目中的一个即可。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-12T10:52:21.547

SQLite 优于 Jet 的主要原因是 SQLite[符合 ACID 标准](http://en.wikipedia.org/wiki/ACID)，而不幸的是，Jet 不符合。如果数据完整性是一个问题，SQLite 为您的数据存储需求提供了一个更加“强大”的平台。有关详细信息，请参阅[“SQLite 是事务性的”](http://www.sqlite.org/transactional.html)和[“SQLite 中的原子提交”](http://www.sqlite.org/atomiccommit.html)。

SQLite 确实缺少一些功能（例如外键），但是，这主要是因为 SQLite 是专门开发的，它是一个极小且轻量级的数据库，也是无服务器的。

SQLite 的无服务器方面也是 Jet 的一个主要优势，因为它不需要在运行数据库的机器上安装任何东西。例如，我在一个 ASP.NET Web 应用程序中使用了 SQLite，而我所需要的只是应用程序的“bin”文件夹中的 SQLite DLL（在这种情况下是出色的[System.Data.SQLite](http://sqlite.phxsoftware.com/)替代品），以及我的应用程序的“App_Data”文件夹中的数据库。然后我可以将这些文件上传到我的虚拟主机，这一切都“正常工作”。这无需在目标机器上实际*安装*或注册任何东西。

SQLite 的一个小缺点是由于数据库是基于文件的。数据库写入将锁定整个数据库文件而不是特定的行或表，而 Jet 将为您提供更精细的锁定级别。基于相同的基于文件的推理，另一个小问题是并发性，但是 Jet 本身也不提供高级别的并发性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-27T20:29:48.060

这仍然是一个不时出现的问题。我现在正在考虑一个新项目的所有利弊。我写了很多处理金钱价值的金融应用程序，所以 Access/JET/ACE/whatever-theyre-call-it-today（我只是称之为 Access）最重要的“优点”之一是它的强类型. 在处理金钱时不要低估强类型的力量——Access 是我见过的唯一一个支持可以存储真实金钱值的金钱/十进制类型的单文件数据库。

我的一个主要零售产品使用 SQLite 作为后端，我可以告诉你，即使在最疯狂的情况下部署它，我也几乎没有遇到任何问题。SQLite 绝对是为单用户设计的，但我有很多客户在 SMB 上使用它。您必须在软件中写入检查以在运行查询时检查 SQLITE_BUSY 的返回值，但如果您使用自动重试将其包装起来，它“就可以工作”。

我选择 Access 而不是 SQLite 的原因只有几个——一个是数据类型。如果我曾经编写必须对货币价值（税等）进行数学运算的软件，我将使用 Access。使用 Access 的唯一另一个令人信服的原因是 SQL Server 的升级路径。由于我一生中从未使用过 SQL Server（也不打算使用），所以这没什么大不了的。

最后，两者都是非常强大的数据库——我会毫不犹豫地在生产环境中使用它们。只要记住使用正确的工具来完成这项工作，有时这意味着数据库服务器（PostgreSQL 在过去 13 年里一直在对待我，这是肯定的！）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-08T03:15:19.973

我们使用 Jet 很长时间，最近切换到 SQLite。为什么？

1：当数据库接近 2 GB 或频繁使用时，它最终会在 Jet 中损坏。这给我们带来了很大的悲痛！这在 Jet 或 ACE 中没有得到修复，尽管微软有一个单独的工具可以修复数据库文件。

2：微软几年前就弃用了 Jet，转而支持 ACE，但如果您阅读详细信息，微软自己说 ACE 不是 Jet 的替代品，并且真的希望您使用 SQL Server 来代替。

3：Jet 不再是 Windows 的标准部分，而是 Microsoft Office 的一部分，尽管您可以下载并安装分发包。但是，您不能同时安装 32 位和 64 位引擎。如果您安装了 Office 2007 32 位，并且您尝试安装 64 位 ACE 引擎，它会告诉您需要先卸载 Office 2007。

因此，出于这些原因，我们只是决定足够了。安装 SQL Server 不是一个解决方案，因为它是一个大型复杂的侵入式安装，并且不是很便携。

我们的 C++ 软件通过 sqlite3.c 文件直接支持 SQLite，效果很好。我已经为 OCILIB、Oracle、SQL Server、MySQL 等实现了反接口，这是最简单的接口之一。它也比 Jet 快得多，生成的文件可能是 Jet 大小的三分之一。我们确实有一些 VB6、VBA 和 .NET 代码，它们也需要使用我们的数据库文件，为此我们使用 SQLite ODBC 驱动程序（只需谷歌它）。效果很好。

SQLite 在 32 位和 64 位上都可以正常工作。如果你阅读它，你会发现它经过了严格的测试并且非常稳定。它还支持更标准的 SQL，并且比 Jet 更接近 Oracle/SQL Server。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-03T05:59:51.413

不再支持 Jet。SQLite 也更易于安装，因为它是一个可以轻松与您的应用程序打包的 dll。使用 SQLite 还可以防止供应商锁定，仅仅因为语言或跨平台可移植性现在不是问题并不意味着以后不会成为问题。有关 Jet 退休的更多信息，请参阅 [http://en.wikipedia.org/wiki/Microsoft_Jet_Database_Engine](http://en.wikipedia.org/wiki/Microsoft_Jet_Database_Engine)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T13:50:45.957

成本不是问题。如果您的前端是在 MS-Access 以外的其他东西中构建的，则应用程序的用户无需支付任何费用即可安装 Jet 驱动程序。Visual Studio 将在您的构建过程中包含这些驱动程序（至少 .NET 之前的版本包含。）。

我猜你没有个人偏好，并且在任何一种环境中都同样擅长开发。如果您的用户已经拥有 MS-Access 许可证并且他们希望能够编写自己的报告（哦，上帝禁止任何非黑客尝试如此巨大的壮举！），请使用 Jet。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-03T14:05:36.347

SQLite 是新的 Jet。即使跨平台与您无关，也可能与您的客户无关。使用 Jet 将它们锁定到 Windows 和不再受支持的数据库中，这两者都不是好事。SQLite 几乎可以与任何开发环境一起使用。

Jet 以有奇怪的腐败问题而闻名，所以我一般倾向于远离它。

您当然可以在 SQLite 中创建外键，并且从 SQLite 3.6.19 开始，还添加了外键约束。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T06:15:44.393

在我的脑海中，它是免费且跨平台的；但更重要的是……你认为它比 Jet/MS Access/.mdb 更稳定、更可扩展吗？它的继任者会更长寿吗 (ACE/.accdb)

如果它被不止几个人使用，我不会打扰 Jet。我直接使用 MS-SQL（甚至是它的免费版本）。只是不值得为损坏的数据库而痛苦（Jet 以它而闻名 - 尽管他们可能修复了它 - 但我不想成为他们的测试用例）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-16T20:59:41.193

如果您使用 Python、Pearl、Lua 或许多其他语言进行良好的编程，SQLite 将是自然的选择。

# database - 如何通过最小安装使用 OLE DB 访问各种数据库

> ID：506142
> 
> 赞同：1
> 
> 时间：2009-02-03T05:58:18.110
> 
> 标签：database, crystal-reports, installation, oledb

我们的报告工具需要访问数据库并从中获取信息。该工具使用**Crystal Reports**。数据库可以是**SQL Server**、**Oracle**、**Sybase**和**Postgres**之一。目前，我们通过报表工具安装来安装数据库客户端。由于许可问题和用户权限，我们希望避免此客户端安装——我们希望非管理员也能够安装该工具。

有没有一种无需安装客户端软件即可访问所有这些数据库的方法？

正如我所说，我们的工具使用**Crystal Reports**生成报告，Crystal 使用**OLE DB**连接到数据库。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T01:51:54.140

您在哪里/如何设置连接？

我创建了一个基本的 Crystal 查看器，它附加到 SQL Server、Access 和 Oracle 中的数据。该连接在设计时嵌入到每个报表中，使用每个服务器上的特定 Crystal Reports 登录来控制权限。

这允许为任何用户安装查看器。报告由 Crystal 团队开发并集中存储以供任何人使用（假设他们有权访问报告目录）。

# perl - 如何将 Perl 变量与插值字符串中的文本分开？

> ID：506147
> 
> 赞同：39
> 
> 时间：2009-02-03T06:02:46.010
> 
> 标签：perl, variables, interpolation

考虑：

```
print "    $foo", "AAAAAAAA", $foo, "BBBBBBBB"; 
```

假设我想将此代码与以下代码一起使用`print <<EOF;`：

```
print <<EOF;
    $fooAAAAAAAA$fooBBBBBBBB";
EOF 
```

那是行不通的，因为 Perl 认为我有一个名为`$fooAAAAAAAA`. `print <<`当我要打印很长的测试时，如何轻松使用这些行？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-02-03T06:06:40.590

使用`${foo}`：

```
print <<EOF;
    ${foo}AAAAAAAA${foo}BBBBBBBB";
EOF 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T07:10:08.510

这是另一种使用方法`printf`：

```
printf << EOF, $foo, $foo;
   %dAAAAA%dBBBBBBB 
EOF 
```

也就是说，假设您要打印`$foo`为十进制数。您可以`%d`用您需要的任何格式替换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-12-05T09:14:56.770

还有另一个答案，基于非插值字符串，我认为这是最合适的。

```
print <<'EOF';
    $fooAAAAAAAA$fooBBBBBBBB";
EOF 
```

[http://perldoc.perl.org/perlop.html#Quote-Like-Operators](http://perldoc.perl.org/perlop.html#Quote-Like-Operators)

# java - java中的运行时类

> ID：506154
> 
> 赞同：3
> 
> 时间：2009-02-03T06:09:34.157
> 
> 标签：java, runtime, runtime.exec

如何在 Runtime.getRuntime().exec() 的帮助下执行 java 程序。例如，我们将 java 文件路径设为 c:/java/abc.java。请帮我写代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T08:44:41.300

不要忘记：

*   您可能需要阅读 java 程序的 stdout/stderr
*   您可能必须在执行 java 命令之前设置/更新环境变量和 PATH

    创建进程：c:\j2sdk1.4.0\bin\helloworld 错误=2

表示 Win32`CreateProcess`在找不到您指定的命令时返回 2 作为错误代码；更具体地说，当命令不引用其查找路径上的可执行文件时。

查看这个[SO question](https://stackoverflow.com/questions/236737#236873)以获得更完整的“ `Runtime.getRuntime().exec()`”代码，以及[这个片段](http://snippets.dzone.com/posts/show/6335)。

这段代码创建了一个 shell（如 中`Runtime.getRuntime().exec("cmd /K")`），您可以在其中编写`sdtin`要执行的任何命令。

这种方法的好处是重用shell进程以从先前的命令中受益：如果您执行一个' `cd`'，然后执行一个' `dir`'，后一个命令将显示该命令引用的目录的内容`cd`。

设置也是如此`PATH`，就在使用`javac`or之前`java`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T08:58:36.047

您应该使用[ProcessBuilder](http://java.sun.com/developer/JDCTechTips/2005/tt0727.html#2)而不是 Runtime。基本用法如下：

```
Process process = new ProcessBuilder(command).start(); 
```

您将在上面的链接下找到更多代码。另请参阅[此问题](https://stackoverflow.com/questions/480433/launch-jvm-process-from-a-java-application-use-runtime-exec/480463#480463)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T06:17:14.063

假设 abc.java 包含您要执行的主要方法：

```
Runtime.getRuntime().exec("javac c:\java\abc.java -d c:\java\")
Runtime.getRuntime().exec("java c:\java\abc") 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T06:17:01.037

你的意思是你想让一个Java程序运行另一个Java程序。[在这种情况下，这个 SO 线程](https://stackoverflow.com/questions/419715/sample-java-code-to-run-bat-file-periodically)可能会有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-03T05:23:02.493

```
String path1 = "f://" + File.separator+username+File.separator+progName; 
Runtime runtime = Runtime.getRuntime();
String command = "javac -classpath " + path + " " + path1;
System.out.println(command);
Process process = runtime.exec(command);
InputStream error = process.getErrorStream(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T08:55:34.943

请参阅以前称为 javaalmanac 的优秀资源。

[http://www.exampledepot.com/egs/java.lang/Exec.html](http://www.exampledepot.com/egs/java.lang/Exec.html)

```
try {
    // Execute a command with an argument that contains a space
    String[] commands = new String[]{"grep", "hello world", "/tmp/f.txt"};
    commands = new String[]{"grep", "hello world", "c:\\Documents and Settings\\f.txt"};
    Process child = Runtime.getRuntime().exec(commands);
 } catch (IOException e) {
 } 
```

# php - 警告：无法修改标头信息 - 标头已由

> ID：506155
> 
> 赞同：1
> 
> 时间：2009-02-03T06:09:39.053
> 
> 标签：php, html, xml

当我运行 player.php 时，它给出了这个错误：

```
Warning: Cannot modify header information - headers already sent by (output started 
at /www/110mb.com/m/u/s/i/c/k/i/n/musicking/htdocs/player.php:8) in
/www/110mb.com/m/u/s/i/c/k/i/n/musicking/htdocs/player.php on line 24 
```

你能帮忙吗？

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Player</title>
</head>
<body>
<?php
if(isset($_POST["song"])&& $_POST['song'] != "")
    {
        $song = $_POST["song"];
    }
    else {$song=array();}
for ($i="0"; $i<count($song); $i++) {
}
//start of new php codep
// create doctype
//$array = array(
  //  'song.mp3','song.mp3','song.mp3',
//);
$dom = new DOMDocument("1.0");
// display document in browser as plain text
// for readability purposes
header("Content-Type: text/plain");
// create root element
$root = $dom->createElement("xml");
$dom->appendChild($root);
$i = "1";
foreach ($song as $counter) {
// create child element
$song = $dom->createElement("track");
$root->appendChild($song);
$song1 = $dom->createElement("path");
$song->appendChild($song1);
// create text node
$text = $dom->createTextNode($counter);
$song1->appendChild($text);
$song1 = $dom->createElement("title");
$song->appendChild($song1);
$text = $dom->createTextNode("song ".$i);
$song1->appendChild($text);
$i++;
}
// save and display tree
$dom->save("playlist.xml");
?>
<script type="text/javascript" src="swfobject.js">
</script>
<div id="flashPlayer">
  This text will be replaced by the flash music player.
</div>
<script type="text/javascript">
   var so = new SWFObject("playerMultipleList.swf", "mymovie", "295", "200", "7", "#FFFFFF");  
   so.addVariable("autoPlay","yes")
   so.addVariable("playlistPath","playlist.xml")
   so.write("flashPlayer");
</script>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T06:24:12.097

由于出现在您的第一个`<?php`标记之前的 HTML，因此触发了错误消息。`header()`在被调用之前你不能输出任何东西。要修复此错误，请使用标记开始您的文档，`<?php`并且仅在您处理完为 Flash 输出 XML 的条件后才开始输出 HTML。

更简洁的解决方案是将 Flash 的 XML 生成和 HTML 输出分离到不同的文件中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T06:14:28.483

错误消息意味着 php 脚本在调用 header() 函数或其他任何需要修改 http 标头的操作之前已经将输出发送到浏览器。

如果没有正确格式化脚本，很难尝试诊断问题出在哪里，但是这一行：

```
header("Content-Type: text/plain"); 
```

应该在 php 标签中脚本的开头。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T06:25:16.247

似乎您正在尝试使用 Flash MP3 播放器，但您混淆了一些东西。

您正在与播放器相同的文件上生成 XML 播放列表文件，您可以这样做，但我认为这样会更清晰、更简单，比如说，一个 genPlayList.php 文件将为您生成 XML 文件.

然后在您的 MP3 播放器页面中，您只能引用该脚本：

```
....
so.addVariable("playlistPath","genPlayList.php");
.... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T06:21:15.833

就像 nav 说的那样，这意味着输出已经发送。在这种情况下，一切都是

```
<!DOCTYPE html PUBLIC ...
....
<body> 
```

你去那里。您应该在此之前移动整个 php 处理块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-08T07:35:42.300

尝试使用**javascript 重定向**而不是带有标头的重定向。

# database-design - 对主键使用项目特定前缀和自动编号？

> ID：506164
> 
> 赞同：12
> 
> 时间：2009-02-03T06:16:56.763
> 
> 标签：database-design, primary-key

我们今天早上开了个会，讨论如何为我们正在制作的数据库中的一些资产存储我们的 ID，讨论产生了一些热度，所以我决定咨询 SO 的专家。

我认为我们应该拥有的表结构（短版）如下所示：

**示例 1)**

*   AssetId - int(32) - 主键
*   类型 - 字符串

所以一些示例数据是这样的：

```
==AssetId======Type===
  12345        "Manhole"
  155415       "Pit" 
```

等等

团队的另一位成员提出了这样的建议：

**例 2)**

*   AssetId - 字符串 - 主键
*   类型 - 字符串

所以一些示例数据是这样的：

```
==AssetId======Type===
  "MH12345"    "Manhole"
  "P155415"    "Pit" 
```

我们制作一个简短版本的类型并将其附加到 ID 的前面并将其存储在数据库中。我见过一些这样做的资产数据库，但从未真正采用过这种方法。

由于排序原因，我从来没有真正喜欢过使用字符串作为 ID 的想法。我也觉得当你已经拥有资产商店的类型时，它只是为了它而存储无用的信息。

你会采取什么方法？为什么？使用方法 1 超过 2 有什么好处吗？

编辑：是的，我将在方法 1 中使用 AUTO_INCREMENT。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-03T06:36:08.313

通常经验法则是永远不要在主键中使用有意义的信息（如社会安全号码或条形码）。只是普通的自动递增整数。无论数据看起来多么稳定 - 它可能会在某一时刻发生变化（新立法出台，所有 SSN 都会重新计算）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T06:31:46.920

这是[代理和自然键](http://www.agiledata.org/essays/keys.html)之间的决定，第一个是代理（或“技术”），第二个是自然的。

我得出的结论是，您几乎应该始终使用代理键。如果您使用自然键，这些可能会更改并且更新主键/外键通常不是一个好主意。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T06:22:35.237

我会选择前者。创建唯一 ID 应该留给 SQL 服务器，如果它们是字符串，则不能以线程安全的方式自动创建它们。据我了解，您必须以某种方式自己处理？

速度是另一个因素。处理 int 值总是比字符串快。我会说索引还有其他性能优势，比我更精通 SQL 的人可以详细说明；）

以我的经验，拥有字符串 ID 是失败的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T06:32:14.937

好吧，我想提出一些观点和建议，

*   考虑为 Type 创建一个单独的表，比如列 Id 和 Desc，然后在该表中创建一个外键 TypeId。更进一步，以使事物正常化。但这可能并不理想。如果你认为它有某种目的就去做

*   如果以后你们考虑转向 UUID，将其设为 String 确实有意义。您不需要更改数据类型

**[已编辑]**

我同意 Cletus 的观点。事实证明，该代理键在某些现实生活项目中是有益的。它们允许变化，你很清楚，变化是唯一不变的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-17T16:34:09.200

出于性能原因，我会选择数字主键。整数比较比字符串比较便宜得多，并且它在数据库中占用的空间更少。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T06:22:47.997

我个人认为第一种方法要好得多。它让数据库软件做简单的整数比较来查找和排序，这将提高表操作性能（SELECTs、complex JOINs、by-key INDEX lookups等）

当然，我假设无论哪种方式，您都在使用某种自动递增方法来生成 ID——序列、AUTO_INCREMENT 或类似的东西。帮我个忙，不要在你的程序代码中构建它们，好吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T07:46:39.793

由于您提到的原因，我更喜欢示例 1，我能想到的使用示例 2 的唯一论点是，如果您尝试从现有数据库中容纳字符串 ID（很常见），但即使在这种情况下，我也更喜欢使用以下方法。

```
==AssetId(PK)==Type========DeprecatedId====
  12345        "Manhole"   "MH64247"
  155415       "Pit"       "P6487246" 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T06:31:50.290

如果您的资产已经具有唯一的自然标识符（例如具有员工 ID 的员工），请使用它们。创建另一个唯一标识符是没有意义的。

另一方面，如果没有自然的唯一 ID，请使用最短的 ID，以确保有足够的唯一键用于您的预期表大小（例如您的整数）。它需要更少的磁盘空间并且可能更快。此外，如果您以后发现自己需要使用基于字符串的键，这是一个简单的替换工作：

*   将 sting 主键添加到资产表。
*   将字符串外键添加到引用表。
*   使用整数关系通过简单的 UPDATE 命令更新字符串关系。
*   为 sting 列添加外键约束。
*   删除整数列的外键约束。
*   完全删除整数列。

其中一些步骤在特定的 DBMS 上可能存在问题，可能需要卸载/重新加载表以删除整数主键列，但该策略基本上是必需的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-17T16:30:04.263

示例 2 的唯一优点是您可以仅从主键轻松判断此键适用于哪个表的哪一行。这个想法很好，但它是否有用取决于您的日志记录和错误消息策略。它可能确实有性能劣势，所以我不会使用它，除非你能说出使用它的一些具体原因。

（您也可以通过使用全局序列来生成数字键，或使用不同的数字范围、最后一位数字或其他方式来获得此优势。这样您就没有性能劣势，但也许您不会那么容易找到该表。 )

# java - 建立一个德州扑克玩 AI..从头开始

> ID：506167
> 
> 赞同：34
> 
> 时间：2009-02-03T06:17:33.483
> 
> 标签：java, lisp, artificial-intelligence, poker, jatha

我对用 Java 构建 Texas Hold 'Em AI 引擎很感兴趣。这是一个长期项目，我计划至少投资两年。我还在上大学，还没有建立任何雄心勃勃的东西，并且想要解决一个长期保持我兴趣的问题。我是人工智能领域的新手。从我在大学的数据结构课上，我知道了 BFS 和 DFS、回溯、DP、树、图等基本构建块。我正在学习正则表达式，为 SCJP 和 SCJD 学习，我很快就会学习（密集) 统计课程。

问题：

-我从哪里开始？我应该选择什么书？扑克游戏程序运行在什么样的人工智能上？我可以从哪个开源项目中获取页面？Java中有什么好的AI资源吗？我也有兴趣学习 Lisp，Jatha 好吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-03T06:35:23.277

以下可能证明是有用的：

*   [阿尔伯塔大学计算机扑克研究小组](http://poker.cs.ualberta.ca/)
*   [OpenHoldem](http://code.google.com/p/openholdembot/)
*   [扑克手牌识别、比较、枚举和评估](http://www.codingthewheel.com/archives/how-i-built-a-working-online-poker-bot-8)
*   [扑克理论](https://rads.stackoverflow.com/amzn/click/com/1880685000)
*   [扑克数学](https://rads.stackoverflow.com/amzn/click/com/1886070253)
*   [特别KPokerEval](http://code.google.com/p/specialkpokereval/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T06:29:36.330

众所周知，扑克人工智能很难做对，因为人类下注是不可预测的。它通常分为两部分。

1）计算你的手成为赢家的几率。

2）根据1制定投注策略。

我建议从第 1 部分的大量统计数据开始阅读。乍一看似乎很容易，但实际上非常复杂（如果弄错了，你的 AI 就会失败）。然后转到第 2 部分的遗传算法。投注策略主要是遗传算法。他们根据过去的成功和失败+一些随机化来调整自己，以免变得可预测。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-02T21:26:21.570

我用 Java 写了一个德州扑克视频扑克引擎

此代码是德州扑克的核心引擎，没有视图和其他

[http://github.com/phstc/javapokertexasholdem](http://github.com/phstc/javapokertexasholdem)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T11:01:55.087

此外，让遗传算法调整神经网络的权重，从而确定决策逻辑。这种方法非常适合扑克 AI。

我像这样制作了自己的AI。起初，我创建了大约 1000 名玩家，他们根本不知道如何玩这款游戏。根据他们最初的运气，他们的体能被加权并创造了新一代。新的“大脑”比上一代玩得更好。

最终，最好的个人打得非常好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-25T07:55:11.007

正如已经推荐的那样，《**扑克理论》**一书对于玩游戏和构建 AI 来说是非常宝贵的信息来源。您可能应该购买它，因为它不会花费那么多。

阿尔伯塔大学的研究小组目前是最先进的，尽管他们时不时出现激烈的竞争。（并非所有该领域的扑克机器人和人工智能研究都是公开的，因为人们很容易在互联网扑克中使用自己的结果，尽管这是被禁止的。）

首先你应该决定你要先解决什么样的扑克。两人德州扑克已经基本解决，尽管最好的人类仍然与最好的 AI 进行真正的战斗。与人类相比，人工智能的主要优势在于对过去的手有无限完美的记忆，基于此对模式进行完美的分析，而且由于它们是机器，它们不会像几乎所有人类偶尔那样倾斜。

固定德州扑克可能是最容易破解的，因此您可能希望从 1-1 固定德州扑克开始，然后决定下一步要做什么。

以下是改变正确策略（和你的人工智能）的一些方面：

*   现金游戏与锦标赛不同 - 玩家的数量使决策不同。
*   德州扑克不是唯一的扑克。奥马哈、梭哈等存在并被广泛使用。
*   固定限注不同于底池限注，底池限注又不同于无限注。
*   为了击败最好的球员，你需要涵盖很多最好的球员在比赛时考虑的非常微妙的事情。要击败低风险的业余比赛，这些都不重要。

如果您决定参加无限注德州扑克，您可能需要查看三本书的系列**Harrington on Hold'em**和一本**无限注扑克 - 理论与实践**。读了很多扑克书，我可以说这些书结合扑克理论已经足够了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-17T15:30:59.880

我不确定您对哪个确切的游戏感兴趣，但典型的方法是创建一个更小的抽象游戏版本，解决那个更小的游戏，然后将真实的游戏情况映射回抽象游戏以生成建议。大多数学术论文跳过了这个过程的细节，而倾向于展示关于收敛、利用和竞争结果的结果。

但是，有一些公开可用的代码库提供了完整的实现。最好的之一是 Fell Omen：

[http://www.deducer.org/pmwiki/pmwiki.php?n=Main.ArtificialIntelligencePoker](http://www.deducer.org/pmwiki/pmwiki.php?n=Main.ArtificialIntelligencePoker)

这是一个基本的完整策略机器人，它使用虚拟游戏来优化抽象游戏的策略。这是一个很好的起点，因为它相当简单、完整，并且代表了抽象游戏方法的良好呈现。

如果您对开发扑克 AI 感兴趣，我建议您阅读 2007 年及以后来自 UA 扑克小组和 Tuomas Sandholm 的学生的所有内容：

[http://www.cs.cmu.edu/~sandholm/](http://www.cs.cmu.edu/~sandholm/)

[http://poker.cs.ualberta.ca/publications.html](http://poker.cs.ualberta.ca/publications.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T09:44:57.233

我在本科时写了一个德州扑克 AI。它不是特别先进，我使用了一个 Q-Value 机器，它遍历了许多状态并更新了每个状态的 Q 值。

我发现阿尔伯塔大学的人工智能扑克项目是避免陷阱的宝贵信息来源。

正如上面的一张海报所说，第一步是确定几个可确定的扑克规则——一对一的扑克可以通过编程方式开发。

我陷入的一个陷阱是没有在早期构建可重构性。例如能够切换学习/玩耍的等级。

我很想听听你是如何在 gmail.com 上给我发邮件的 stevekeogh

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-14T07:13:20.357

只是添加到上面的链接中，要实施的重要事项之一是[http://en.wikipedia.org/wiki/Kelly_criterion](http://en.wikipedia.org/wiki/Kelly_criterion)，这将有助于根据一系列投注的预期赔率计算出最佳投注规模。对于人类来说，赔率的判断可能会出错，但如果你的人工智能程序可以根据任何算法吐出一些预期的标准化赔率，那么这种为优势赌徒平衡风险和回报的下注规模技术将是一个很好的廉价解决方案.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-03T07:34:13.937

我听到的一个有趣的结果是，如果你将下注选项限制为弃牌、check 和全押，你可以编写一个 AI 赢得一对一的概率至少为 49%，如果是，则为 49.5%（IIRC )*不*先。

我不知道这个AI更容易写一个知道下注的AI，但它值得深思：选择下注的金额仅占获胜概率的1.5％。

# asp.net-mvc - asp.net mvc中是否有像drupal这样的cms系统

> ID：506173
> 
> 赞同：3
> 
> 时间：2009-02-03T06:22:56.470
> 
> 标签：asp.net-mvc, plugins

我是 asp.net mvc 世界的新手。是否有任何基于 asp.net mvc 的 cms 系统，如 drupal（php、cms、插件模块）。我不喜欢 dotnetnuke，因为它们使用 webform 并且难以扩展。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T09:36:17.623

如果您没有太多的 Drupal 经验，如果您想要 .NET， [Umbraco](http://www.umbraco.org/)是一个不错的选择（尽管他们有一个动画网站图标）。如果您需要，也有专业的支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-05T11:13:26.467

我很惊讶没有人提到[Orchard](http://www.orchardproject.net/)。

> ## 基本果园概念
> 
> Orchard 是一个 Web CMS，其本质上旨在帮助您从现有的部分构建网站。这些碎片有几种不同的尺寸和形状，如果你要使用它们来提高工作效率，就需要很好地理解它们。本文将介绍这些部分并解释它们的名称和行为。

更多信息：[http ://docs.orchardproject.net/Documentation/Basic-Orchard-Concepts](http://docs.orchardproject.net/Documentation/Basic-Orchard-Concepts)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T07:35:10.677

[啤酒屋](http://www.codeplex.com/TheBeerHouse/SourceControl/ListDownloadableCommits.aspx)。

从他们的网站：

TheBeerHouse 是一个使用纯 ASP.NET 2.0 开发的网站，其中包括您期望从典型的 CMS / 电子商务网站获得的许多功能和模块，例如：

```
* Layout with user-selectable themes.
* Membership system with registration, login, profile setup and complete administration.
* Content management system for publishing and syndicating articles and photos, with support for categories, comments, rating and profile-based personalization.
* Opinion polls with support for multiple active polls and archived polls.
* Mailing lists with support for HTML and plain-text newsletters, background transmission and real-time AJAX-based feedback.
* Forums with support for multiple categories, custom pagination, avatars, signatures, moderation, and complete administration.
* E-commerce store with support for real-time credit card processing, with support for multiple categories, percentage discounts, zoomable pictures, ratings, availability display and more.
* Homepage personalization with webparts.
* Localization. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T06:30:36.187

我不认为DNN很难扩展，但我没有太多经验。明智的 ASP.Net MVC 数量并不多，考虑到它实际上还没有出来，这并不奇怪 :-)

主要的（如果相当简单的话）是 CodePlex 上的[Oxite 。](http://www.codeplex.com/oxite)刚发布时，它并没有被认为是 MVC 的一个特别“好例子”，但是社区提供了相当多的重构帮助，因此值得一看。不过，这只是一个相对简单的博客，而不是完整的 CMS，所以不要指望 Drupal :-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T09:32:54.963

我目前正在玩 N2 cms。我还没有完全理解它，但你可以将它插入 web 表单或 asp.net mvc（他们有一些适用于两个平台的示例站点）。由于 nhibernate，它也可以使用多种数据库平台。它基本上整理了后端，因此您可以专注于前端。[N2 cms 点击这里](http://n2cms.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T09:52:52.987

我可以推荐使用 MojoPortal，它有一个很棒的 Framwework，它可以在 Linux 和 Windows 上完美运行 :) url 是 => [http://www.mojoportal.com/](http://www.mojoportal.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-01T13:36:44.930

您还可以查看：[http](http://cmsmvc.codeplex.com/) ://cmsmvc.codeplex.com/这是一个使用 asp.net mvc 构建的 CMS，具有插件和主题支持

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-19T09:32:41.467

有一个项目正在进行将 Drupal 移植到名为[Drupal.NET](http://drupalnet.codeplex.com)的 .NET 平台，该平台目前正在开发中。

# sql - 列数

> ID：506176
> 
> 赞同：9
> 
> 时间：2009-02-03T06:24:35.890
> 
> 标签：sql, oracle, schema

oracle如何计算表中的列数？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T06:30:16.297

```
SELECT count(*) FROM user_tab_columns WHERE table_name = 'FOO' 
```

应该给你 foo 中的列数。`USER_TAB_COLUMNS`您可以从and获得相当多的信息`USER_TABLES`（也有`ALL_`and`DBA_`变体）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T20:18:19.573

@derobert 有一个很好的答案，只要您尝试计算您拥有的表中的列。如果您需要计算另一个模式表中的列，则需要使用 all_tab_columns 视图。此视图中的附加列之一是表所有者。当多个模式中存在相同的表名时，这也很有用。请注意，您必须具有表的权限才能在 all_tab_columns 视图中查看它们。查询变为：

```
select count(*) from all_tab_columns where owner='BAR' and table_name='FOO'; 
```

请注意，所有者和表名列通常是大写的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T07:03:52.923

如果 Oracle 支持 INFORMATION_SCHEMA.COLUMNS，我会说使用它。但正如其他人所说，使用 USER_% 视图。

为了完整起见，以下链接描述了哪些系统支持 SQL-92 标准。 [支持 INFORMATION_SCHEMA 的系统](http://www.petefreitag.com/item/666.cfm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-03T20:26:36.443

老问题 - 但我最近需要这个以及行数......这是两者的查询 - 按行数 desc 排序：

```
SELECT t.owner, 
       t.table_name, 
       t.num_rows, 
       Count(*) 
FROM   all_tables t 
       LEFT JOIN all_tab_columns c 
              ON t.table_name = c.table_name 
WHERE  num_rows IS NOT NULL 
GROUP  BY t.owner, 
          t.table_name, 
          t.num_rows 
ORDER  BY t.num_rows DESC; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-04T08:01:31.377

oracle表的列数和行数：

```
SELECT u.table_name Table_Name, 
       Count(*)     Table_Columns, 
       u.num_rows   Table_Rows 
FROM   user_tab_columns c, 
       user_tables u 
WHERE  u.table_name = c.table_name 
GROUP  BY u.table_name, 
          u.num_rows 
```

# documentation - 基本 Unix 系统管理 (OSX) 资源

> ID：506186
> 
> 赞同：1
> 
> 时间：2009-02-03T06:28:56.160
> 
> 标签：documentation, sysadmin

在阅读并理解了 Dan Benjamin 关于[在 OSX (Leopard) 上安装 Ruby、Rails 等](http://hivelogic.com/articles/2008/02/ruby-rails-leopard)的帖子之后，我真的很喜欢使用`usr/local`. 我在本地机器上运行 Rails 没有问题，但我仍然觉得我并没有完全理解这些基本的系统管理员实践。

例如，当我运行`which git`git 安装运行的路径时`/usr/local/git/bin/git`，这看起来*对吗？*

多亏了 JavaScript，我已经学会了大部分编程，而且我还没有真正深入了解 Mac 的底层，但我非常渴望使用这些命令行工具和脚本。

你能为初学者推荐一个很好的关于基本 Unix 系统管理的文档资源吗（最好是 Mac 套件）？

我意识到这可能并不完全与编程相关，但我相信基本的 shell 和命令行脚本知识非常重要，我希望有信心继续前进。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T09:36:43.020

为了提高您的基本 shell 和命令行脚本知识，您无需进入系统管理员任务。最近的信息来源（虽然一开始不是最友好的）是`man`命令。尝试`man bash`或`man intro`。从编写小型 shell 脚本实用程序开始。

关于您的`git`安装问题，您可以在任何地方安装任何东西。但推荐的目录适用于系统范围的工具和`/usr/local/bin`您的私有工具。通常，工具会在推荐的目录中创建自己的子目录，在其中放置文档和资源，例如您的.`/opt/bin``~/bin``/usr/local/git`

对于在线资源，我假设您已经知道如何查找 Apple 网站以及如何使用 Google。

# winapi - Win32 API 优雅地关闭另一个进程？

> ID：506195
> 
> 赞同：1
> 
> 时间：2009-02-03T06:35:44.307
> 
> 标签：winapi, process, shutdown

我正在寻找一种方法来关闭另一个 Windows 应用程序。有没有办法做到这一点？

理想情况下，我想要基本上模仿 ALT-F4 的东西，或者按右上角的“X”或类似的东西。

或者，是否有一个应用程序已经这样做了？tskill 对于我的想法来说有点太苛刻了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T07:32:31.070

**编辑：**我做了一点挖掘，发现了一篇微软推荐方法的[MSDN 文章](http://support.microsoft.com/kb/178893)。

由于这是一个 Windows 应用程序，您可以将[WM_CLOSE](http://msdn.microsoft.com/en-us/library/ms632617(VS.85).aspx)消息发送到主窗口，但请记住，如果应用程序覆盖 WM_CLOSE 消息的处理，您可能会得到意想不到的结果。还要记住，使用诸如[TerminateProcess](http://msdn.microsoft.com/en-us/library/ms686714(VS.85).aspx)和[ExitProcess](http://msdn.microsoft.com/en-us/library/ms682658(VS.85).aspx)之类的 win32 函数也会产生令人不快的副作用（请参阅 msdn 上的备注部分），包括 dll 中的全局数据受到损害以及死锁。

如果您负责对目标应用程序进行编码，我建议您添加某种形式的内置终止机制，可以在外部触发（例如环回地址或管道上的魔术包），这样您就可以确保您的应用程序已自行清理适当地。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T06:55:38.837

根据您的描述，这听起来像是一个窗口应用程序。在这种情况下，您可以向它发送一条[WM_CLOSE](http://msdn.microsoft.com/en-us/library/ms632617(VS.85).aspx)消息来模拟按下“X”按钮时的行为。

另一种选择是使用[TerminateProcess](http://msdn.microsoft.com/en-us/library/ms686714(VS.85).aspx)，但这可能也是 tskill 所做的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T08:00:13.653

关闭应用程序更强大的命令是：

```
 PostMessage (myhnd,WM_ENDSESSION,TRUE,ENDSESSION_LOGOFF); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T07:15:35.880

我将首先向您[推荐我对另一个问题的回答](https://stackoverflow.com/questions/268208/delphi-gracefully-closing-created-process-in-service-using-tprocess-createp/277040#277040)；尽管它是关于 Delphi 和服务的，但答案既不是 Delphi 特定的，也不是服务特定的。简而言之，没有通用的方法可以优雅地停止程序。该问题的公认答案演示了将`wm_Close`消息发布到程序的窗口。

# wcf-data-services - 替换 Astoria Payload？

> ID：506197
> 
> 赞同：1
> 
> 时间：2009-02-03T06:36:17.567
> 
> 标签：wcf-data-services, astoria

我很想使用数据服务通过 http 发布只读数据。

我真正想要的是能够提供不同形状的 xml 位，这些位使用过滤器、扩展等来代表我的数据库中的内容。

我真正不喜欢的是 atom 中的“goop”，我知道 json 有点轻，但我真正想做的是使用我自己的序列化策略。

最初我认为他们有更多格式，我认为它很容易扩展......但我找不到任何东西。

我找错地方了吗？我是不是一起叫错树了？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T00:13:22.423

是的，是的，我同意。

甚至非常努力地研究“网络编程模型”，因为它似乎提供了更多的灵活性。

基本上我想

*   接收 uri + 查询
*   将 uri 映射到实体/记录
*   根据查询返回 pox，包括链接

它目前正在吸引我的包括链接实体。数据服务允许您使用扩展功能“浏览图表”，但我找不到替代该功能的简单方法。

使用休息服务，我是否必须在序列化它们之前手动解析“扩展路径”并将适当的实体加载到对象图中？

感谢您的帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T06:57:06.557

数据服务是为特定问题而设计的，它不是基于 REST 实现的通用 POX，我不确定尝试以这种方式弯曲它是要走的路。

[使用 WCF（此处的文章](http://msdn.microsoft.com/en-us/library/aa395208.aspx)） “推出您自己的”REST/POX 服务非常简单，如果您过多地偏离数据服务，这可能是一个更好的起点。

# javascript - JavaScript 64 位数字精度

> ID：506200
> 
> 赞同：7
> 
> 时间：2009-02-03T06:54:13.287
> 
> 标签：javascript, 64-bit, precision

有没有办法在 JavaScript 中表示一个精度高于 53 位的数字？换句话说，有没有办法表示 64 位精度数？

我正在尝试实现一些逻辑，其中 64 位数字的每一位都代表一些东西。当我尝试设置高于 2^53 的位时，我会丢失较低的有效位。

```
Math.pow(2,53) + Math.pow(2,0) == Math.pow(2,53) 
```

有没有办法实现自定义库或实现这一目标的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-03-15T06:24:48.653

谷歌的 Closure 库有[goog.math.Long](http://docs.closure-library.googlecode.com/git/class_goog_math_Long.html)用于此目的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T02:51:36.503

也许我应该添加一些技术细节。基本上，GWT 长仿真使用两个数字的元组，第一个保存高 32 位，第二个保存 64 位长的低 32 位。

该库当然包含添加内容的方法，例如添加两个“long”并获得“long”结果。在您的 GWT Java 代码中，它看起来就像两个常规的 long - 一个不需要摆弄或注意元组。通过使用这种方法，GWT 避免了您可能暗示的问题，即“longs”会降低精度，这在许多情况下是不可接受的。

虽然根据定义，浮点数是一个值的不精确/近似值，但像 long 这样的整数却不是。GWT 始终保持 64 位长 - 使用这种长的数学从不使用精度。例外情况是溢出，但是当您添加两个需要超过 64 位的非常大的长值时，它与 Java 等中发生的情况准确匹配 - 例如 2^32-1 + 2^32-1。

对浮点数做同样的事情需要类似的方法。您将需要一个使用元组的库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T08:59:57.697

我只会使用整数数组或字符串。

javascript 中的数字是双精度数，我认为您的等式中存在舍入误差。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T07:32:47.030

GWT 团队添加了 long 仿真支持，因此 java longs 真正拥有 64 位。你想要 64 位浮点数还是整数？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-06T11:38:54.753

以下代码可能对您有用；不过我还没有测试过： [BigDecimal for JavaScript](https://github.com/iriscouch/bigdecimal.js "JavaScript 的 BigDecimal")

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-01-25T06:08:07.407

是的，11 位为指数保留，只有 52 位包含值，也称为分数。Javascript 允许对数字进行按位运算，但根据 Javascript 标准规范，在这些运算中仅使用前 32 位。

我不明白 Javascript/double 问题中误导性的 GWT/Java/long 答案吗？Javascript 不是 Java。

* * *

## 回答 #7

> 赞同：-7
> 
> 时间：2009-02-05T02:53:53.533

为什么有人在 javascript 中需要 64 位精度？

Longs 有时会在数据库中保存东西的 ID，因此重要的是不要丢失一些低位......但浮点数大部分时间用于计算。使用浮点数来保存货币或类似的精确值是完全错误的。如果您真的需要 64 位精度，请在更快的服务器上进行数学运算，依此类推。

# vb.net - Visual Basic 中数组的大小？

> ID：506207
> 
> 赞同：26
> 
> 时间：2009-02-03T06:59:12.153
> 
> 标签：vb.net, arrays

我在VB中试过这段代码：

```
Dim a(1) As Byte
Console.WriteLine(a.Length) 
```

输出为“2”。有人知道为什么吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-03T08:07:40.690

如果您习惯于 C/C++/C# 语言，则在声明数组时使用数组中**的元素数**对其进行初始化。

```
C# : byte a[] = new byte[1] 
```

将声明一个包含 1 个元素的字节数组（upperBound = 0）

VB 中的行为有所不同，在声明数组时，初始化中使用的参数表示数组的**UpperBound**。

```
VB.NET: Dim a(1) As Byte 
```

将声明一个包含 2 个元素的字节数组（upperBound = 1）

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-03T09:19:19.513

在 Visual Basic 中，数组的大小是用数组的*上限*声明的，其中大多数语言通过指定数组*中元素的数量来*声明数组的大小。如果您没有意识到这一点，那么您的 Visual Basic 数组最终会比您预期的长 1 个元素：

VB.NET：

```
 Dim a(1) as Byte ' under the hood, translated to byte[2] 
 Console.WriteLine("{0}", a.Length) ' output 2

 a(0) = 7 ' No error, element exists
 a(1) = 7 ' No error, element exists, array length is 2
 a(a.Length) = 7  ' error: Index was outside the bounds of the array. 
```

C＃：

```
 byte[] a = new byte[1];
 Console.WriteLine("{0}", a.Length); // output 1

 a[0] = 7 // No error, element exists
 a[1] = 7 // error:  Index was outside of bounds of the array. (because array length is 1)
 a[a.Length] = 7; // error: Index was outside the bounds of the array. 
```

微软之所以设计 VB.NET 来根据上限而不是数组长度来调整数组大小，是为了更容易将代码从 VB6 移植到 VB.NET。VB6 数组的初始索引为 1，除非您声明 Option Base 0。通常使用 . 循环遍历大小为 N 的数组`For i = 1 To N`。通过将 VB.NET 设计为将数组的大小参数解释为上限而不是数组中元素的数量，从 1 循环到 N 的旧 VB6 代码可以直接移植到 VB.NET。与 VB6 中的数组（索引 0 处的元素）相比，VB.NET 中的数组将多出一个元素，但在其他方面的行为与 VB6 中的一样。

您有时会看到人们声称 Visual Basic 创建了“浪费”元素。这仅在移植不期望索引 0 处的元素的旧版 VB6 代码时才适用。编写新代码时，您只需记住大小参数的含义（上限，而不是元素计数），并相应地声明您的数组。与您在 C# 中看到的相比，只需将您的大小参数减少一个。生成的数组将包含 from `a(0)`to的元素`a(a.Length-1)`，就像 C# 数组一样。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-03T07:06:25.850

数组从位置 0 开始。您正在定义两个位置。

如果您只想要 1 个职位，那么：

```
Dim a(0) As Byte 
```

你会得到 a.Length 为 1。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-03T07:06:44.023

> **维度长度**每个维度的索引都是从 0 开始的，这意味着它的范围是从 0 到其上限。因此，给定维度的长度比该维度声明的上限大 1。

[Visual Basic 中的数组大小](http://msdn.microsoft.com/en-us/library/b388cb5s.aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-11-22T14:26:46.623

前面的答案每个都有正确答案的片段，但不是完整的正确答案。当您声明一个数组时（就像您的代码：Dim a(1) As Byte），您在数组声明中放入的数字（在本例中为 1）不是数组中有**多少**条目的声明，它是一个声明数组的**上边界**。

因此，在您的声明中，您正在创建一个包含 2 个条目的数组：a(0) 和 a(1)

# unix - 有没有人提供免费的电子邮件/ssh 规定？

> ID：506209
> 
> 赞同：-1
> 
> 时间：2009-02-03T06:59:34.507
> 
> 标签：unix, shell

我想学习 UNIX SHELL 有人可以为我提供这样的服务吗？SSH/POP 等？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T08:32:21.980

为了扩展 Zach 的回复，我建议您购买一个 Live Distro，您可以从 CD/etc 运行而无需安装到硬盘驱动器。非常适合在不影响现有操作系统的情况下玩耍。

从[www.livecdlist.com](http://www.livecdlist.com)中选择一个- 按投票排序，因此最好选择靠近顶部的一个。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:08:14.487

如果您有一台 Windows PC 并且可以在其上安装软件，请尝试[Cygwin](http://www.cygwin.com/)这为您提供了 Unix 环境和 bash shell。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T07:13:31.407

你看过[这个列表](http://www.red-pill.eu/freeunix.shtml)吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T07:14:24.960

有许多公共/开放访问的 Unix 系统（例如[SDF](http://sdf.lonestar.org/)）提供通常非常严格的免费帐户（付费帐户提供更多“权利”、磁盘空间、带宽和对更多服务的访问）。获取 Unix 或类 Unix 操作系统的免费发行版并将其安装在您自己的计算机上可能会更好。这样，您就可以扮演“管理员”的角色并亲自动手。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T14:12:38.983

如果您想在不破坏当前安装的情况下使用 Unix 环境，您可以尝试使用虚拟化。一个名为[VirtualBox](http://www.virtualbox.org/)的程序可以让您在封闭环境中运行 x86 操作系统，如果出现问题，只需删除虚拟机并重新安装即可。

或者，如果您只想要一个 shell，您可以尝试[Rootshell](http://www.rootshell.be/)，它会为您提供一个基于 OpenBSD 的 shell。对于基于 Linux 的 shell，[Polarhome](http://www.polarhome.com/)可以做到这一点，并为您提供一些其他操作系统可供使用。

不过，在我个人看来，我会尝试 VirtualBox，因为如果您只是学习 shell，当您需要修复或检查您可能不知道如何在 shell 中执行的操作时，GUI 会很有帮助。

# web-farm - 服务器场是否在两边都抽象了？

> ID：506212
> 
> 赞同：1
> 
> 时间：2009-02-03T07:01:59.853
> 
> 标签：web-farm

我试图了解如果部署在服务器场中的解决方案将如何表现。我们有一个 Java Web 应用程序，它将与 FTP 服务器通信以进行文件上传和下载。

还希望使用防火墙保护 FTP 服务器，以便它只允许来自 Web 服务器的传入流量。

目前，由于我们没有服务器场，对 FTP 服务器的所有请求都来自同一个 IP（Web 服务器 IP），因此可以在防火墙中添加一个简单的规则。但是，如果将应用程序移动到服务器场，那么我不知道场中的哪台机器会向 FTP 服务器发出请求。

就像农场隐藏在它的客户的门面后面一样，它是否隐藏在它可能调用的服务的门面后面，所以无论农场中的哪台机器向 FTP 服务器发出请求，它总是看到相同的 IP？

是否所有服务器场都以相同的方式实现，或者这种行为是否取决于服务器场的类型？我正在考虑使用 Amazon Elastic CLoud。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T07:15:00.530

这在很大程度上取决于您的 Web 集群的配置方式。如果您的集群位于 NAT 防火墙后面，那么是的，所有传出连接似乎都来自同一个地址。否则，IP 地址会有所不同，但几乎可以肯定它们都在一个相当小的地址范围内，您应该能够将该范围添加到防火墙的排除列表中，甚至只列出每台机器的 IP 地址分别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T07:15:13.447

通常在设置防火墙规则时可以输入 cnames 或子网，这样可以简化它们的维护。您还可以通过负载均衡器或代理发送所有流量。这基本上就是任何云/集群/农场服务的工作方式。

许多客户端 ips <-> 负载平衡器 <-> 许多服务器

# java - 在 Java 中创建状态历史

> ID：506220
> 
> 赞同：5
> 
> 时间：2009-02-03T07:08:13.523
> 
> 标签：java, history, state

我需要保存 Java 应用程序中一些操作的状态历史记录，以便稍后重新加载以恢复某个操作的状态。换句话说，我有一个屏幕，它有一个与之关联的状态，我需要存储它以及历史记录中的任何更改，以便我可以随时恢复屏幕的状态。这有点像“撤消”，但不完全是因为两个状态之间的差异可能非常大，并且没有明确定义的动作可以改变状态。

让我用一个例子来解释一下：一个非常基本的屏幕状态可能只包含一个地图。在状态 A 中，此 Map 包含对具有键“Key1”的“Object1”和具有键“Key2”的“Object2”的引用。在状态 B 中，地图仍然包含对“Object1”的引用，但“Object2”已被修改并添加了“Object3”。我现在需要能够返回到状态 A，这将涉及“删除”Object3 并将 Object2 恢复到之前的状态。我无法定义任何自定义“撤消操作”，因为我不知道对 Object2 进行了哪些更改，甚至不知道 Object2 的类型是什么。此外，由于在状态 A 和 B 中 Object2 的引用保持不变，因此这些更改会反映在状态 A 中，因此 Object2 与以前不同。

我意识到最好的解决方案是实现克隆方法，但是因为我需要支持所有类型的对象（包括原语和标准集合），所以这是不可行的。我考虑过使用可序列化，一旦发生状态转换，我会序列化 Map，然后在再次需要时反序列化它，但这似乎是一个非常丑陋的解决方案。

有人有其他想法吗？谢谢你，里斯特雷托

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-03T07:19:11.160

您是否尝试过研究[Memento 设计模式](http://en.wikipedia.org/wiki/Memento_pattern)？它似乎特别适合您的问题。来自维基百科：

> 备忘录模式是一种软件设计模式，它提供了将对象恢复到其先前状态（通过回滚撤消）的能力。

同一页面还有一个包含[Java 实现](http://en.wikipedia.org/wiki/Memento_pattern#Java)的部分，因为您提到这是用 Java 编写的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T08:37:13.390

考虑换个角度。不要改变构成屏幕状态的对象，而是使用不可变状态。这听起来可能有点矛盾，但事实并非如此。

例如，假设（为简单起见）您的状态由单个字符串组成。显然，由于字符串是不可变的，因此您不必为了保存和修改状态而克隆字符串。例如：

```
public List<String> changeTheScreen(List<String> states) {
  return states.cons(states.head() + "x");
}

public void renderTheScreen(String currentState) {
  // TODO: draw the screen given the current state
} 
```

在上面的示例中，`List`is 是来自[Functional Java](http://functionaljava.org)`fj.data.List`库的不可变内存中单链表类型（标准库没有不可变列表）。该方法将获取状态的历史记录，当前状态位于列表的前面。它通过创建一个新状态并将其放在新状态列表的前面来操纵屏幕的状态。

将相同的原则应用于您想要用作状态的任何类型。确保您的状态完全由*不可变*对象组成（字符串和原语已经是不可变的）。将不可变对象用于状态将为您节省很多维护方面的麻烦，并节省内存，因为不可变对象可以重复使用而无需克隆。

不可变对象将在其构造函数中初始化，其所有内部字段将是`final`.

[函数式 Java 有一个称为 TreeMap 的不可变映射。](http://code.google.com/p/functionaljava/source/browse/trunk/src/main/fj/data/TreeMap.java?spec=svn29&r=29)您可以通过以下方式使用它：

```
public List<TreeMap<String, Object>>
changeState(List<TreeMap<String, Object>> states) {
  return states.cons(states.head().set("Key1", new Object1("x")));
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T07:26:54.063

你可能想看看[Prevayler](http://www.prevayler.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T09:05:40.150

在我的项目中，我们通过序列化为 XML 文件实现了非常相似的效果。这对我们很有效。您想要取回的所有对象 - 以明确定义的方式在 XML 文件中序列化，以便之后您可以随时从 XML 文件取回状态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T07:15:58.937

我们用序列化做类似的事情。

我们以序列化的形式将归档数据存储到文件系统中。我们需要恢复的对象图部分和主对象一样是序列化的。

确保您对对象进行版本化，并确保您的差异可以处理缺失/新字段。

我们选择存储到文件系统是因为它（有效地）为我们提供了无限的容量。速度对我们来说不是问题，但文件系统方法非常快，大多数人没有注意到额外的 50-100 毫秒！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T07:17:56.170

你总是可以使用序列化；

```
ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);
objectOutputStream.writeObject(object);
objectOutputStream.flush();
byteArrayOutputStream.close();
ByteArrayInputStream istream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray());
ObjectInputStream objectInputStream= new ObjectInputStream(istream);
Object deserialized = objectInputStream.readObject();
istream.close(); 
```

缓慢而笨重，但有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T07:36:48.130

如果您想要的实际上是一张地图，您可能需要研究持久数据结构；例如，持久性 B 树。

# sql-server - NHibernate 包映射

> ID：506223
> 
> 赞同：1
> 
> 时间：2009-02-03T07:09:27.560
> 
> 标签：sql-server, nhibernate, mapping

我需要一个手工绘制一个集合。

我正在使用连接表来保存对房间 ID 和 calEvent Id 的引用。但是，查找将主要基于房间的`buildingID`- 所以我想添加`buildingID`到以下映射中。有谁知道该怎么做？

我浏览了 NHibernate 文档，但找不到任何东西。

```
<bag name="rooms" table="tb_calEvent_rooms" lazy="false">
  <key column="calEventID"/>
  <many-to-many class="BasicRoom" column="roomID"/>
</bag> 
```

班级：

```
public class BasicRoom 
{
    private long _id;
    private long _buildingID;
    private string _roomName; 
```

非常感谢任何提示/帮助。

**推理：**

房间永远不会改变建筑物，所以如果我将 buildingID 添加到连接表；我将通过以下方式降低 select 语句的复杂性 -

```
SELECT *
FROM
  dbo.tb_calEvent_rooms
  INNER JOIN dbo.tb_calEvents ON (dbo.tb_calEvent_rooms.calEventID = dbo.tb_calEvents.id)
  INNER JOIN dbo.tb_rooms ON (dbo.tb_calEvent_rooms.roomID = dbo.tb_rooms.id)
  INNER JOIN dbo.tb_buildings ON (dbo.tb_rooms.buildingID = dbo.tb_buildings.id)
WHERE
  dbo.tb_buildings.id = 54 
```

至

```
SELECT *
FROM
  dbo.tb_calEvents
  INNER JOIN dbo.tb_calEvent_rooms ON (dbo.tb_calEvents.id = dbo.tb_calEvent_rooms.calEventID),
  dbo.tb_buildings
WHERE
  dbo.tb_buildings.id = 54 
```

我的推理正确吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T07:50:34.297

从元素中删除`column`属性`many-to-many`并将其添加为子节点 insead，以及`column`引用的附加元素`buildingID`：

```
<bag name="rooms" table="tb_calEvent_rooms" lazy="false">
  <key column="calEventID"/>
  <many-to-many class="BasicRoom">
    <column name="roomID"/>
    <column name="buildingID"/>
  </many-to-many>
</bag> 
```

这应该使您能够基于`buildingID`以及进行查询`roomID`。

# .net - 调试成功但安装后服务不工作

> ID：506227
> 
> 赞同：2
> 
> 时间：2009-02-03T07:12:47.320
> 
> 标签：.net, service, installation

我在服务中使用以下代码通过将服务作为控制台应用程序运行来成功调试服务并验证一切正常。但是后来当我安装服务并将其作为 Windows 应用程序启动时，服务正在运行，如下所示服务控制台，但它没有做它必须做的工作。我想知道在这种情况下出了什么问题。谢谢。

静态无效 Main() { System.ServiceProcess.ServiceBase[] ServicesToRun;

```
 if (Environment.UserInteractive)
        {
            ListenerSVC service = new ListenerSVC();
            service.OnStart(null);
            Console.WriteLine("Press any key to stop program");
            Console.Read();
            service.OnStop();
        }
        else
        {

            ServicesToRun = new System.ServiceProcess.ServiceBase[] { new ListenerSVC() };
            ServiceBase.Run(ServicesToRun);

        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T08:40:07.877

您是否尝试过捕获/记录任何异常？最可能的原因是安全性（即服务帐户无权访问某些资源）。查找服务的 .config 文件时也经常出现问题（如果您使用的是配置，请注意这一点）。最后，为简单起见，尝试使用命令 arg 以防`UserInteractive`报告不正确 - 我倾向于将“-c”用于控制台/调试模式。

# c# - 如何在 C# 中编组打包结构的非托管缓冲区

> ID：506231
> 
> 赞同：2
> 
> 时间：2009-02-03T07:14:41.123
> 
> 标签：c#, arrays, struct, marshalling, buffer

我（成功）使用以下 pinvoke 签名在 c# 中调用 Windows FilterSendMessage 函数：

```
[DllImport("fltlib.dll")]
    public static extern IntPtr FilterSendMessage(
        IntPtr hPort,
        IntPtr inBuffer,
        UInt32 inBufferSize,
        IntPtr outBuffer,
        UInt32 outBufferSize,
        out UInt32 bytesReturned); 
```

**outBuffer**参数填充了任意数量的结构（一个接一个地打包），在 C 中定义为：

```
typedef struct _BAH_RECORD {

    int evt
    int len;
    WCHAR name[1];

} BAH_RECORD, *PBAH_RECORD; 
```

**名称**字段被分配了一个可变长度、以空字符结尾的 unicode 字符串。**len**字段以字节为单位描述结构的总大小（包括名称字符串）。我相信在非托管方面如何处理结构没有任何问题。

当我尝试将 outBuffer 编组到 C# 中定义为 BAH_RECORD 结构的实例时，我的问题出现了：

```
[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
public struct BAH_RECORD
{
    public UInt32 evt;
    public UInt32 len;
    public string name;
}

IntPtr outBuffer = Marshal.AllocHGlobal(OUT_BUFFER_SIZE);

hResult = Win32.FilterSendMessage(hPortHandle, inBuffer, IN_BUFFER_SIZE, outBuffer, OUT_BUFFER_SIZE, out bytesReturned);

BAH_RECORD bah = (BAH_RECORD)Marshal.PtrToStructure(outBuffer, typeof(BAH_RECORD));

<snip> 
```

如果我尝试打印/查看/显示 bah.name，我会得到垃圾......

为了确认 outBuffer 确实包含有效数据，我在 c# 中做了一些粗略的指针骇客来逐步处理它，调用 Marshal.ReadInt32 两次（以覆盖前 2 个结构字段），然后调用 Marshal.ReadByte 几次以填充一个字节[] 然后我将其用作 Encoding.Unicode.GetString() 的参数......字符串出来很好，所以它肯定在那里，我似乎无法让编组器正确处理它（如果它甚至能够？）

任何帮助表示赞赏

史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T10:29:12.680

问题是 C# BAH_RECORD 结构中的“名称”字符串被编组为指向字符串 (WCHAR*) 的指针，但在 C 端它是一个内联 WCHAR 缓冲区。因此，当您编组结构时，运行时会将缓冲区的前四个字节作为指针读取，然后尝试读取它指向的字符串。

不幸的是，运行时无法在结构内自动封送可变大小的缓冲区，因此您需要使用手动封送处理（或者如您所说的“指针黑客”）。但是，当您将指针指向缓冲区时，您不需要单独读取字节然后将它们转换为字符串 - 只需调用 Marshal.PtrToStringUni。

# performance - 为什么浮点除法慢？

> ID：506237
> 
> 赞同：22
> 
> 时间：2009-02-03T07:16:19.030
> 
> 标签：performance, algorithm, hardware

算法中进行浮点除法的步骤是什么？

为什么结果比乘法慢？

它的完成方式与我们手动除法的方式相同吗？通过重复除数，减去结果获得余数，再次对齐数字并继续直到余数小于特定值？

另外，如果我们不这样做，为什么我们会提高性能？

```
a = b / c 
```

我们的确是

```
d = 1 / c
a = b * d 
```

?

编辑：基本上我问是因为有人要求我根据权重分配在竞争者之间分配一个值。我用整数完成了所有这些操作，后来被要求转换为浮点数，这导致性能下降。我只是想知道 C 或 C++ 如何执行这些会导致缓慢的操作。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-03T08:26:07.593

FPU division often basically uses Newton-Raphson (or some other algorithm) to get a reciprocal then multiplies by that reciprocal. That's why the reciprocal operation is slightly faster than the general division operation.

[This HP paper](http://www.hpl.hp.com/techreports/93/HPL-93-42.pdf) (which is actually more understandable than most papers I come across talking about Newton-Raphson) has this to say about floating point division:

> Floating point division and square root take considerably longer to compute than addition and multiplication. The latter two are computed directly while the former are usually computed with an iterative algorithm. The most common approach is to use a division-free Newton-Raphson iteration to get an approximation to the reciprocal of the denominator (division) or the reciprocal square root, and then multiply by the numerator (division) or input argument (square root).

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-03T11:07:03.103

From a hardware point of view division is a iterative algorithm, and the time it takes is proportional to the number of bits. The fastest division that is currently around uses the radix4 algorithm which generates 4 bit of result per iteration. For a 32 bit divide you need 8 steps at least.

Multiplication can be done in parallel to a certain degree. Without going into detail you can break up a large multiplication into several smaller, independent ones. These multiplications can again be broken down until you're at a bit-level, or you stop earlier and use a small lookup-table in hardware. This makes the multiplication hardware heavy from a silicon real estate point of view but very fast as well. It's the classic size/speed tradeoff.

You need log2 steps to combine the parallel computed results, so a 32 bit multiply need 5 logical steps (if you go down to the minimum). Fortunately these 5 steps are a good deal simpler than the division steps (it's just additions). That means in practice multiplies are even faster.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T07:35:01.190

As described in the Wikipedia article *[Division algorithm](https://en.wikipedia.org/wiki/Division_algorithm)*, there are two main aproaches to division in computers:

### Slow Division

Uses the following recurrence and finds one digit per iteration: `partialRemainder[j+1] = radix * partialRemainder[j] - quotientDigit[n-(j+1)]*denominator`

### Fast Division

Starts with an estimation and converges on the quotient. How accurate you are depends on the number of iterations.

Newton-Raphson division (very briefly):

1.  Calculate estimate of the reciprocal.
2.  Compute more accurate estimates of the reciprocal.
3.  Compute quotient by multiplying the dividend by the reciprocal.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T07:19:58.630

你不会通过这样做来获得性能

```
d = 1 / c
a = b * d 
```

你可能的意思是：

```
d = 1 / c
a1 = b1 * d
a2 = b2 * d 
```

这样，除法只进行一次。

除法本身比乘法慢，但是，我不知道细节。基本原因是，类似于 sin 或 sqrt 等函数，它只是在数学上更复杂。IIRC，乘法在平均 CPU 上大约需要 10 个周期，而除法大约需要 50 或更多。

John Mulder 很好地解释了它是如何完成的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T07:33:07.920

Think of the hardware involved, and you'll understand a lot better why it takes so much longer to divide than multiply. Both operations are done down at the Floating Point Unit (FPU) level, and even in the world of integral ALUs, the division circuit is a far busier place than a multiplication circuit. I would suspect this is only more painful in the world of floating point, as now the data isn't just least to most significant digit ordered, but is instead ordered by the IEEE 754 standard.

As for the round off, it's really about wherever the signals traveling between the gates get soldered to ground; where that happens, you lose digits. Not rounding, so much as truncation.

Or were you asking about simulating floating point arithmetic using just integers?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T12:38:00.080

Float division is not much slower than integer division, but the compiler may be unable to do the same optimizations.

For example the compiler can replace integer division between 3 with a multiplication and a binary shift. Also it can replace float division between 2.0 with a multipliation by 0.5 but it cannot replace division between 3.0 with a multiplication by 1/3.0 as 1/3.0 cannot be represented exactly using binary numbers, therefore rounding errors may change the result of the division.
As the compiler doesn't know how sensitive is your application to rounding errors (say you were doing a weather simulation, see [Butterfly effect](http://en.wikipedia.org/wiki/Butterfly_effect) )it cannot do the optimization.

# c++ - DynamicArray 抛出 OutOfBounds 异常

> ID：506240
> 
> 赞同：1
> 
> 时间：2009-02-03T07:19:41.753
> 
> 标签：c++, c++builder

我知道这听起来可能很奇怪，但是是的，现在是 2009 年，我需要使用 BCB5 编写小型应用程序 :)

问题是 DynamicArray 在尝试从工作线程中扩展它时抛出 OutOfBound 异常。

我有全局变量，比方说

```
DynamicArray<double> X; 
```

在主线程中，我检查数组的长度，我得到 0，这没关系（长度未设置）

```
Application->MessageBox(itoa(X.Length,str , 10), "", MB_OK); 
```

下面是我的工作线程类

```
class ArrayModifierThread : public TThread
{
private:
DynamicArray<double> __thread X;

protected:
void __fastcall Execute();

public:
__fastcall ArrayModifierThread(bool CreateSuspended);
 void setX(DynamicArray<double> &a);
}; 
```

到目前为止，一切都很好。接下来我创建新线程：

```
ArrayModifierThread *t = new ArrayModifierThread(true);
t->setX(X); // Pass reference to my global DynamicArray
t->Resume(); 
```

这里 Execute() 方法被执行：

```
void __fastcall ArrayModifierThread::Execute()
{
 X.Length = 10;
 X[5] = 45.5;
} 
```

我期望的是全局数组被扩展，第 6 个元素的值为 45.5。

但是从主线程中进行更仔细的调查会给出 Length = 0 和 ArrayOfBounds 异常：

```
 Application->MessageBox(itoa(__X.Length,str , 10), "", MB_OK);
 Application->MessageBox(itoa(__X[5],str , 10), "", MB_OK); 
```

谁能告诉我我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T14:19:19.847

它不起作用，因为成员 X 不是参考。当您调用 set() 时，您正在制作对象的本地副本，然后 Execute() 正在修改本地版本。

```
class ArrayModifierThread : public TThread
{
    private:
        DynamicArray<double> __thread X;

void __fastcall ArrayModifierThread::Execute()
{
    X.Length = 10;
    X[5] = 45.5;
 } 
```

有三种替代解决方案：

使您的本地成员变量 X 成为引用。
由于引用必须在构造时初始化，您不能使用 set() 修改它，因此将引用传递给对象的构造函数并将其保存在那里。

使您的本地成员变量 X 成为指针。使用 set() 时，获取传入参数的地址（注意它是一个引用，因此您将获得它所引用的对象的地址）。这也意味着需要修改执行以考虑到 X 是一个指针。

不要使用局部成员变量。直接修改全局即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T07:33:39.773

在您的`Execute`方法中，您正在修改*线程的* `X`字段，而不是全局`X`变量。尽管该`setX`方法通过引用接收其参数，但成员变量不是引用。它存储值的*副本*，`DynamicArray`更改`Length`属性可确保它引用唯一的数组。

正如您在“答案”中正确观察到的那样，该`setX`函数*接收*对全局变量的引用，但它不*保留*对它的引用。`X`相反，它在分配对象的字段时会复制它。

也许您也打算声明`X`为参考：

```
private:
  DynamicArray<double>& X; 
```

那可以工作。您的`setX`函数将不再起作用，因为您不允许在初始化后“重新设置”引用。相反，您需要在线程的构造函数中对其进行初始化：

```
ArrayModifierThread(DynamicArray<double>& a): X(a) { ... } 
```

您还可以存储*指向*数组的指针而不是引用：

```
private:
  DynamicArray<double>* X;
public:
  void setX(DynamicArray<double>& a) {
    X = &a;
  }
protected:
  void Execute() {
    X->Length = 10;
    (*X)[5] = 45.5;
  } 
```

您需要注意的另一件事是您的代码不是线程安全的。（这里也不是我的。）您有多个线程修改相同的共享资源（数组）而没有任何保护，例如临界区。不过，这超出了这个问题的范围。首先搜索 Stack Overflow 和 Web 的其余部分，如果您需要有关该问题的帮助，然后再回来提出*新问题。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T07:43:50.610

嗯，这对我来说不是很清楚。我认为由于 void setX(DynamicArray &a) 工作线程获得了对全局变量的引用。

您能否发布示例代码应该如何完成？

这就是我的 void setX(DynamicArray &a) 的样子：

```
void ArrayModifierThread::setX(DynamicArray<double> &a)
{
   X = a;
} 
```

# database - 在 ColdFusion 中，如何提取和存储提交表单的内容？

> ID：506242
> 
> 赞同：4
> 
> 时间：2009-02-03T07:21:59.220
> 
> 标签：database, coldfusion, error-logging

我正在用 ColdFusion 编写一个应用程序，尽管它基本上是稳定的，但它时常出错。因为它已经取代了旧的应用程序，所以有时是用户而不是我得到错误。

我创建了一个很好的页面，当人们收到向我发送信息的错误时会得到该页面，例如错误、引荐来源、哪个页面上的错误、行号等。

我似乎无法工作的唯一一件事是获取提交的表单数据（如果有的话）。我不知道它事先在哪个页面出错，所以我不能只输出'#form.field#'。

例如，如果：

```
form.abc = 1
form.def = 2 
```

如何在事先不知道它们的情况下从“表单”中获取变量名称和值？

这份文件是否在沿着正确路径[的某处循环结构？](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_j-l_16.html)

另外，我正在寻找一种将数据存储在数据库中的好方法，因为这是存储有关错误的其他信息的地方，我真的不想把它放在给我的电子邮件中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T08:14:47.913

Form 范围有一个`FieldNames`变量，它将告诉您提交了哪些字段。

您还可以`StructKeyList(Form)`获取范围内当前变量的列表。这还将包括 FieldNames 和任何其他已添加到 Form 范围的变量。

这些中的任何一个都可以在内部使用`<cfloop index="CurField" list="#StructKeyList(Form)#">`- 但有更简单的方法......

如果您在 CF8 上，您可以使用`serializeJson()`和`deserializeJson()`函数轻松地将范围转换为字符串，然后可以将其存储在合适的数据库字段中。

如果您使用的是 CF6..7，那么您可以从[riaforge下载一个名为](http://www.riaforge.org)[cfjson](http://cfjson.riaforge.org)的 CFC，它模仿了这些功能。

最后，如果您使用的是早期版本的 CF，或者对使用 JSON 进行存储有一种奇怪的反感，您可以使用更简单的循环来滚动自己的循环到上面提示的循环 - 收集循环允许您直接循环遍历结构或范围 - 请注意，有些烦人的人选择了“项目”而不是“索引”作为这些属性。

因为我们知道表单变量都是简单的对象（即字符串），所以我选择了一种基本`key=value[newline]key=value[newline]...`格式，它也很容易反转。

编码：

```
<cfset Output = '' />
<cfloop item="CurField" collection="#Form#">
    <cfset Output = Output & CurField & '=' & Form[CurField] & Chr(10) />
</cfloop>

<cfoutput>#Output#</cfoutput> 
```

解码：

```
<cfset FormData = StructNew()/>
<cfloop index="CurLine" list="#Output#" delimiters="#Chr(10)#">
    <cfset FormData[ListFirst(CurLine,'=')] = ListRest(CurLine,'=') />
</cfloop>

<cfdump var="#FormData#"/> 
```

最后一个重要注意事项：与所有用户提供的变量（Form、Url、Cookie 范围）一样，您必须确保正确处理它们以防止安全漏洞 - 特别***是确保您使用 cfqueryparam 进行*** **所有** ***数据库查询***- 不想要偏离得太远了，但如果您需要有关 cfqueryparam 的任何帮助，请随时提出另一个问题。

希望这可以帮助。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-05T13:33:12.900

如果您想手动遍历所有表单字段，最简单的方法是像这样的 cfloop：

```
<cfloop collection="#form#" item="variables.name">
  #variables.name#=(#form[variables.name]#)<br/>
</cfloop> 
```

但话虽如此，出于错误电子邮件的目的，您可能会发现“转储”表单范围（这只是一个特殊结构）更容易，如下所示：

```
<cfmail
  from="errors@#cgi.server_name#"
  to="you@yourdomain.com"
  subject="Error Occurred in such and such a place"
  type="html">
    <cfdump var="#form#"/>
</cfmail> 
```

在发送错误电子邮件时，我喜欢在 CGI 范围内包含第二个`cfdump`（同样，只是一个特殊的结构），因为这可以提供有关请求的其他一些有用信息。

如果您有 CF 8，您可能还想以文本格式转储，如下所示，因为它会使消息大小更小（在我看来，使消息更具可读性）

```
<cfdump var="#form#" format="text"> 
```

**注意：`format`CFDump 标签的属性是为 CF 8 添加的，因此您将无法在以前的 ColdFusion 版本中使用它。**

您提到您正在寻找一种将这些错误存储在数据库中的方法，这是一个好主意。我建议您查看[**BugLogHQ**](http://bugloghq.riaforge.org/) ，而不是为此推出您自己的自定义解决方案。它已经存在了一段时间，对包括我在内的其他人都很好用，最重要的是它是*免费*和开源的。它的年龄和广泛使用意味着它自己的代码不太可能出现错误，并且可能具有比您编写的更多、更好的功能。

使用 BugLogHQ，您不必担心错误的显示，您只需将数据发送到错误记录器，剩下的就交给它了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T08:47:54.023

`Form`只是一个哈希/结构，所以你可以遍历它的键：

```
<cfoutput>
 <cfloop collection=#form# item="field">
  #htmleditformat(field)=#htmleditformat(form[field])#<br/>
 </cfloop>
</cfoutput> 
```

将数据放入数据库？你如何做到这一点取决于你以后想用它做什么。最灵活的解决方案可能是将整个`form`(and `url`) 转换为 WDDX 对象，并将其存储在 blob 字段中：

```
<cfwddx action="cfml2wddx" input=#url# output="encodedURL"/>
<cfwddx action="cfml2wddx" input=#form# output="encodedForm"/>
<cfquery datasource="yourDSN">
 INSERT INTO errorlog (datestamp, event, script_name, path_info, url, form)
 VALUES
  (<cfqueryparam value=#now()# cfsqltype="CF_SQL_TIMESTANP"/>,
   <cfqueryparam value="your error string or cfcatch data" cfsqltype="CF_SQL_VARCHAR"/>,
   <cfqueryparam value=#cgi.script_name# cfsqltype="CF_SQL_VARCHAR"/>,
   <cfqueryparam value=#cgi.path_info# cfsqltype="CF_SQL_VARCHAR"/>,
   <cfqueryparam value=#encodedURL# cfsqltype="CF_SQL_BLOB"/>,
   <cfqueryparam value=#encodedForm# cfsqltype="CF_SQL_BLOB"/>)
</cfquery> 
```

这样您就可以在闲暇时访问所有原始数据进行分析。当然，还有很多其他方法可以解决这个问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T14:20:23.633

如果您在应用程序中使用 Application.cfc，只需将 onError 方法替换为下面的方法。注意：application.settings.mode 可以是以下值之一（dev、test、prod）。application.settings.webmasteremail 应设置为您希望将错误信息邮寄到的电子邮件地址。这两个变量都应该在 onApplicationStart 方法中设置。

这个函数有什么作用？如果应用程序设置为“dev”模式（通过设置 application.settings.mode = “dev”），它将在屏幕上显示错误信息。如果应用程序设置为任何其他模式（如测试或产品），它将通过电子邮件发送信息并将信息存储在数据库中。

```
<cffunction name="onError" returnType="void" output="true">
    <cfargument name="exception" required="true">
    <cfargument name="eventname" type="string" required="true">
    <!--- corrects bug where <cfabort> throw an error --->
    <cfif arguments.exception.rootCause eq "coldfusion.runtime.AbortException">
        <cfreturn>
    </cfif>
    <cfsavecontent variable="errordata">
        <p>#eventname#</p>
        <cfdump var="#exception#" label="Exception Information" format="text">
        <cfdump var="#url#" label="URL Information" format="text">
        <cfdump var="#form#" label="FORM Information" format="text">
        <cfdump var="#application#" label="Application Scope" format="text">
        <cfif isdefined("session")>
            <cfdump var="#session#" label="Session Scope" format="text">
        </cfif>
        <cfif isdefined("client")>
            <cfdump var="#client#" label="Client Scope" format="text">
        </cfif>
        <cfdump var="#cgi#" label="URL Information" format="text">
    </cfsavecontent>

    <!--- will email the error inforation and display the error page --->
    <cfif application.settings.mode eq "dev">
        <p>#eventname#</p>
        #errordata#
    <cfelse>
        <cfmail to="#application.settings.webmasteremail#" from="error@#cgi.http_host#" subject="Error has occured on #cgi.http_host#" type="HTML" charset="windows-1252">
        <p>#eventname#</p>
        #errordata#
        </cfmail>

        <cfquery datasource="yourDSN">
        insert into errorlog
        (
            creationdate
            ,event
            ,info
        )
        values
        (
            <cfqueryparam value="#now()#" cfsqltype="CF_SQL_TIMESTAMP"/>
            ,<cfqueryparam value="#eventname#" cfsqltype="CF_SQL_VARCHAR"/>
            ,<cfqueryparam value="#errordata#" cfsqltype="CF_SQL_LONGVARCHAR"/>
        )
        </cfquery>

        <h2>A functional error has occurred.</h2>
        <p>A notification of this error has been automatically e-mailed to the development team; no action on your part is required.</p>
        <p>Please click the "back" button on your browser to return to the web site.  We apologize for this inconvenience.</p>
    </cfif>
</cffunction> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T18:27:19.610

如果您通过电子邮件向自己发送表单变量，只需转储它们，如下所示：

```
<cfmail type="html" ...>
    <cfdump var="#form#" label="form">
    <cfdump var="#cgi#" label="cgi">
    <cfdump var="#session#" label="session">
</cfmail> 
```

你可以在那里倾倒你喜欢的任何范围。你可能需要也可能不需要我提供的那些。

您说您最初的问题是应用程序正在替换旧应用程序？您是否在部署的同一台服务器上进行开发？如果是这样，您可以为您的开发副本更改应用程序的名称 - 确保名称是唯一的以避免此问题（如果这是您的问题）。

# c# - 向文件添加评论 [元数据]

> ID：506246
> 
> 赞同：4
> 
> 时间：2009-02-03T07:29:39.283
> 
> 标签：c#, windows, winforms

我很确定这是可能的，只是不确定它的术语是什么以及如何去做。基本上，如果您右键单击任何文件并转到属性然后摘要，您可以将注释等添加到文件中。

我想知道的是，您将如何从 c# 有问题地执行此操作。此外，一旦您添加了评论，您以后如何从文件中读取这些评论。

我确信它与文件的元数据有关，只是不确定去哪里查看。另外我需要在 Windows 表单中执行此操作，因此权限不是什么大问题。

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T08:15:46.210

一个使用 DSO 的示例，它显示了如何设置作者和评论字段：

```
try
{
    DSOFile.OleDocumentPropertiesClass doc = new DSOFile.OleDocumentPropertiesClass();
    doc.Open(filename, false, DSOFile.dsoFileOpenOptions.dsoOptionDefault);

    doc.SummaryProperties.Author = author;
    doc.SummaryProperties.Comments = comments;

    doc.Close(true);
}
catch (Exception ex)
{
    throw new Exception("Could not update the file properties: " + filename, ex);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T07:58:50.707

据我了解，出于安全原因，这些属性中的大多数都无法从用户代码中设置 - 但是，某些特定于**Office 文档**的属性可以使用 DSOFile 进行设置。有关更多信息，请参阅[此 MSDN 博客](http://blogs.msdn.com/gstemp/archive/2004/02/25/79867.aspx)

# .net - ObjectContext 内存消耗和性能

> ID：506258
> 
> 赞同：2
> 
> 时间：2009-02-03T07:35:03.187
> 
> 标签：.net, linq, linq-to-sql, entity-framework

我想以一种使每个实体对象负责保存自己的更改的方式编写业务对象层。

我认为让每个实体拥有自己的 ObjectContext、将自身附加到该 ObjectContext 并在需要保存时执行事务是一种好方法。

在 LINQ to SQL 中，DataContext 非常轻量级，因此我的解决方案没有太多的内存消耗和性能损失。和ObjectContext一样吗？

那么附加对象呢？它是不是像 LINQ to SQL 这样的繁重工作单元？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T08:43:45.000

有人认为对象*不应该*对此负责。他们的工作是表示实例化的对象；持久化它是另一个（存储库）类的工作。

在附加/分离对象时，ObjectContext 可能会很痛苦，因为（与 LINQ-to-SQL 不同）上下文和实体之间的耦合要紧密得多。就个人而言，我不会使用这种方法。我会使用实体本身（或工作副本）作为临时工作单元以及短暂的上下文。

# excel - Excel 导入返回空白单元格

> ID：506260
> 
> 赞同：0
> 
> 时间：2009-02-03T07:36:15.667
> 
> 标签：excel, asp-classic

我一直有这个问题，从来没有设法弄清楚。

我正在将 excel (.xls) 文件导入到 asp 记录集中。大多数情况下，这很好用。

我有以下值的列

```
4
4
5,6
3 
```

Asp 会读取除 5,6 之外的那些值。我试过格式化单元格，这没有区别。似乎asp（或excel）正试图通过检查值来确定单元格的类型。无论出于何种原因，如果某些单元格的格式与其他大多数单元格的格式不同，它就会引发此问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-12T00:43:50.840

问题是 ADO 扫描前 8 行并根据它在每一列中找到的数据设置列类型。因此，如果您的前 8 行包含数字，那么它将该列设置为数字并为任何其他值返回 null，例如，如果第九行包含文本或逗号。有关如何避免这种情况的一些建议，请参阅[http://blog.lab49.com/archives/196 。](http://blog.lab49.com/archives/196)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T07:37:57.347

您是否尝试将 5,6 设置为 5.6？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-23T13:52:40.427

尝试将 IMEX=1 添加到您的连接字符串。

如果这不能解决问题，请尝试更改以下注册表项值： HKLM/Software/Microsoft/Jet/4.0/Engines/Excel/ "TypeGuessRows"=dword:00000000

如果您有 64 位系统，注册表项将位于：HKLM/Software/Wow6432node/Microsoft/Jet/4.0/Engines/Excel/ "TypeGuessRows"=dword:00000000

# templates - 在freemarker中交替表格行颜色

> ID：506262
> 
> 赞同：8
> 
> 时间：2009-02-03T07:36:53.277
> 
> 标签：templates, freemarker

[使用freemarker](http://freemarker.sourceforge.net/)进行交替行着色的好方法是什么？

这真的是最好的方法吗？

```
<#assign row=0>
<#list items as item>
    <#if (row % 2) == 0>
        <#assign bgcolor="green">
    <#else>
        <#assign bgcolor="red">
    </#if>
    <tr style='background-color: ${bgcolor}'><td>${item}</td></tr>
    <#assign row = row + 1>
</#list> 
```

我试过这样做：

```
<#assign row=0>
<#list items as item>
    <tr style='background-color: ${(row % 2) == 0 ? "green" : "blue"}'><td>${item}</td></tr>
    <#assign row = row + 1>
</#list> 
```

但显然你不能在那里使用三元运算符。

**注意**：我想我应该在前面提到它，但我不能使用 css 类或 javascript，因为这个 HTML 将进入电子邮件消息。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2010-05-19T18:30:43.073

```
class='${["odd", "even"][item_index%2]}' 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-06-04T21:27:32.417

如果您有一系列表格，您可能想要创建一个小功能。

```
<#function zebra index>
  <#if (index % 2) == 0>
    <#return "white" />
  <#else>
    <#return "#efefef" />
  </#if>
</#function>

<#assign arr=["a","b","c","d"] />
<table>
<#list arr as n>
  <tr><td bgcolor=${zebra(n_index)}>${n}</td></tr>
</#list>
</table> 
```

使用 list 时内置的[_index](http://freemarker.sourceforge.net/docs/ref_directive_list.html)使您不必自己创建和增加索引变量。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-02-16T20:24:11.470

使用 freemarker，您可以使用`string`内置的：

```
<#list items as item>
   <tr style='background-color: ${((item_index % 2)==0)?string("green", "blue")}'><td>${item}</td></tr>
</#list> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-04T11:30:18.860

嗯......好吧，这是我想出的最好的：

```
<#assign row=0>
<#list items as item>
    <tr style='background-color: <#if (row % 2) == 0>green<#else>red</#if>'><td>${item}</td></tr>
    <#assign row = row + 1>
</#list> 
```

从震耳欲聋的沉默中，我推断出没有比这更好的方法了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-16T19:54:31.270

然后解决方案归结为：

```
<style>
.rowon {
 background-color:#dedede;
}

.rowoff{

}
</style> 
```

在您的模板中：

```
<#list items as item>
    <tr  class="<#if item_index % 2 ==0>rowon<#else>rowoff</#if>"><td>${item}</td></tr>
</#list> 
```

但是，如先前回复中所述，您可以使用 CSS 执行此操作，而无需此 freemarker 解决方案（请参阅[http://www.w3.org/Style/Examples/007/evenodd](http://www.w3.org/Style/Examples/007/evenodd)）：

```
<style>
.striped tr:nth-child(odd) {background: #eee}
.striped tr:nth-child(even) {background: #fefefe}
</style> 
```

然后只需在行上使用没有类的普通表：

```
<table class="striped">
 <tr><td>hello</td></tr>
 <tr><td>hello</td></tr>
 <tr><td>hello</td></tr>
 <tr><td>hello</td></tr>
</table> 
```

或使用 freemarker 生成的表：

```
<table class="striped">
<#list items as item>
    <tr><td>${item}</td></tr>
</#list>
</table> 
```

所以这一切都在 CSS 中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-05T17:29:42.040

在 FreeMarker 2.3.23 中：

```
<#list items as item>
    <tr style='background-color: ${item?item_cycle('green', 'red')}'><td>${item}</td></tr>
</#list> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T11:43:44.060

使用 FreeMarker，回答这个问题的方法有限，但如果你想单独使用 CSS（仍然允许关注点分离），那么这里有一种方法：

**将以下内容放入您的样式表中：**

```
tr.linea {
    background-color: #CC9999; color: black;
}
tr.lineb {
    background-color: #9999CC; color: black;
} 
```

**然后使用以下`tr`类来定义备用行**：

```
<table>
<tr class="linea"><td>One Fish</td></tr>
<tr class="lineb"><td>Two Fish</td></tr>
<tr class="linea"><td>Red Fish</td></tr>
<tr class="lineb"><td>Blue Fish</td></tr>
</table> 
```

还有[很多资源](http://www.google.com/#hl=en&q=Use+CSS+to+alternate+colors+in+a+table&fp=Rhq7p-mUk-o)可供选择。

**编辑**：如果您的 HTML 进入电子邮件，那么您无法确定客户端的电子邮件客户端是否允许您尝试放入其中的任何 HTML。那时你最好的选择是使用与你拥有它的方式类似的 FreeMarker，除了你需要删除标签`style`，并为标签中使用的每一行使用颜色。`bgcolor="color"``<tr>`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-24T08:43:37.803

您可以使用以下构造在 FreeMarker 中模拟三元运算符：${condition?string(result_for_true, result_for_false)}。

```
<#assign arr=["a","b","c","d"] />
<table>
<#list arr as n>
    <tr><td bgcolor=${((index % 2) == 0)?string("white", "#efefef")}>${n}</td></tr>
</#list>
</table> 
```

# wpf - WPF 滚动条应该更频繁地更改值

> ID：506265
> 
> 赞同：0
> 
> 时间：2009-02-03T07:37:35.647
> 
> 标签：wpf, scrollbar, custom-scrolling

如果用户按下向上或向下滚动按钮并按住鼠标按钮，我目前试图强制 wpf 滚动条经常触发它的值更改。

我尝试使用如下风格：

```
<Style TargetType="{x:Type RepeatButton}">
    <Setter Property="Interval" Value="20"/>
    <Setter Property="Delay" Value="20"/>
</Style> 
```

或者直接设置值：

```
scrollBar.Track.DecreaseRepeatButton.Delay = 20;
scrollBar.Track.DecreaseRepeatButton.Interval = 20;

scrollBar.Track.IncreaseRepeatButton.Delay = 20;
scrollBar.Track.IncreaseRepeatButton.Interval = 20; 
```

我用mole检查了repeatbutton上存在的值，但是这些按钮不会更频繁地触发命令......

有任何想法吗？

蒂亚

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-04T11:06:53.120

我用它切换到故事板和动画我解决了我的问题

# perl - 如何打开具有 OO 风格的管道？

> ID：506275
> 
> 赞同：5
> 
> 时间：2009-02-03T07:49:01.740
> 
> 标签：perl, pipe

我用新的风格重写了我的旧代码，如下所示：

```
#old style
open(FD,"file");

#new style
$fh = IO::File->new("file","r"); 
```

文件没问题，但我不知道如何打开管道。

```
# read from pipes.
open(PIPE,"some_program |");

# write to pipes.
open(PIPE,"| some_program"); 
```

OO Style IO如何处理管道？

补充：
谢谢乔纳森，很好。

```
# read from pipes.
$pipe = IO::Pipe->new;
$pipe->reader('some_program');
$data = <$pipe>;

# write from pipes.
$pipe = IO::Pipe->new;
$pipe->writer('some_program');
print $pipe "foo,bar,baz"; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T07:59:10.033

您应该查看[IO::Pipe](http://perldoc.perl.org/IO/Pipe.html)和[FileHandle](http://perldoc.perl.org/FileHandle.html)。

# sql - mysql查询以获取列中每个元素的计数

> ID：506279
> 
> 赞同：1
> 
> 时间：2009-02-03T07:51:39.147
> 
> 标签：sql, mysql

我有一个名为 category 的表，其中我有主类别 id 和名称，每个主要类别都有子类别 id 和名称。我还有一个产品表，其中包含一个类别 id 列，它有一个数字子类别 id 或一个 2 字母主类别 ID 例如：电子产品的 EL..我的问题是如何获得顶级类别，即每个类别中的产品数量按降序排列。

```
category
{
sub_cat_id - numeric
sub_cat_name - varchar
main_cat_id - varchar (2 characters)
main_cat_name
}
products
{
categoryid,//this can be either main_cat_id or sub_cat_id 
} 
```

请帮助....

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T08:25:15.550

似乎它应该是直截了当的，你能发布“CREATE TABLE”语句和一些示例行吗（我无法从上面的语法中“逆向工程”“CREATE TABLE”......）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T09:18:16.287

实际上，我认为您无法通过单个查询来做到这一点。由于`categoryid`表中列的双重性质`products`（即它可能是外键*或*类别名称），您必须以某种方式将该列与连接`main_cat_id`后的表列组合`category`，并`GROUP BY`在合并后执行列，但这是不可能的，AFAIK。

当然，您可以执行两个单独的 SQL 查询（一个用于直接计算主要类别中的产品，另一个用于计算子类别中的产品），并将它们的结果与一些服务器端脚本结合起来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T09:27:35.363

如果主类别 ID 和子类别 ID 之间没有命名空间冲突，您可以：

```
select main_cat_id , count(*) as total
from category
where ( main_cat_id in (select categoryid from products) 
                       OR 
       sub_cat_id in (select categoryid from products)
       )
group by main_cat_id 
order by total desc 
```

但是，从表面上看，类别表的设计似乎存在问题。sub_cat 应该是具有适当约束的不同表。

# c# - 保护 .NET 代码免受逆向工程？

> ID：506282
> 
> 赞同：514
> 
> 时间：2009-02-03T07:53:46.223
> 
> 标签：c#, .net, obfuscation, reverse-engineering

混淆是一种方式，但它不能防止破坏应用程序的盗版保护安全。如何确保应用程序不被篡改，如何确保注册机制不会被逆向工程？

也可以将 C# 应用程序转换为本机代码，而[Xenocode](http://en.wikipedia.org/wiki/Spoon_%28software%29)成本太高。

C# 提供了很多功能，并且是我的代码的理想语言，因此再次用 C++ 编写整个代码库是不可能的。

可以轻松地从 .NET 中的签名程序集中删除安全证书。

* * *

## 回答 #1

> 赞同：689
> 
> 时间：2009-02-03T08:03:10.557

你不能。

您可以采取一些步骤使其*变得*更加困难，但最终本地计算机上的任何可执行文件都是可破解的。最终，该代码必须转换为本机机器代码，并且每个可运行的应用程序都是易受攻击的。

您要做的只是使其难以破解，使其不值得人们麻烦。

我有一些建议可以帮助保护您的应用程序：

*   **混淆**你的代码。[Dotfuscator](http://en.wikipedia.org/wiki/Dotfuscator)有一个免费版本，并附带 Visual Studio。
*   使用[公钥/私钥](http://en.wikipedia.org/wiki/Public-key_cryptography)或非**对称加密**来生成您的产品许可证。这确保只有*您*可以生成您的许可证代码。即使您的应用程序*被*破解，您也可以确定他们不会为您的应用程序发布密钥生成器，因为无法反转密钥生成算法。
*   使用**第三方**打包程序将您的 .NET 可执行文件打包到加密的 Win32 包装应用程序中。[Themida](http://www.oreans.com/)是最好的之一。这会阻止人们在[.NET Reflector](http://www.red-gate.com/products/reflector/)中反射您的应用程序，并且使解包以进行逆向变得很痛苦。
*   编写您自己的**自定义打包程序**。如果第三方打包程序太贵，请考虑自己编写。有时自定义打包器可能非常有效，因为没有很好的方法来解包它们。*[How to write your own packer](http://www.stonedcoder.org/~kd/lib/61-267-1-PB.pdf)*教程提供了大量关于编写自己的 Win32 打包器的好信息。

但最终，如果人们希望您的应用程序被破解，他们会的。看看那些拥有大量资源来保护其应用程序的商业软件，但它们甚至在应用程序发布给公众之前就被破解了。

无论您做什么，熟练的逆向工程师都可以启动[IDA-Pro并像黄油一样切入您的应用程序。](http://www.hex-rays.com/idapro/)打包的应用程序可以被解包，混淆只会阻止它在公园里散步。您使用复杂的许可证代码所做的所有辛勤工作都可以通过一个字节补丁来撤消。

您只需要接受人们很有可能盗版您的软件。有些人无论如何都*不会*为您的申请付费，而这些人是您无需担心的。

然而，有许多企业永远不会冒险提起诉讼并乐于购买软件许可证，而许多计算机用户要么不想冒险，要么发现它错了，要么对盗版技术不够了解。这些是您真正的客户，您应该集中精力为他们提供良好的用户体验，而忽略破解您软件的人。

我的应用程序以前被盗版过，我认为这是对我个人的侮辱。在这里，我是一个小开发人员，全心全意地投入到应用程序中，而这些人竟敢从我这里盗版？！他们直接从我的口袋里拿钱！

我立即添加了一堆严苛的 DRM 代码，并试图使用非法或破解副本破坏任何人。我当然应该一直致力于使我的应用程序更好，而不是试图阻止不可避免的事情。不仅如此，我所采取的所有这些额外保护措施都会伤害到我*真正的*客户。

经过长时间的战斗，我意识到我正在与潮汐作斗争，所有这些浪费的时间都是徒劳的。除了准系统许可功能外，我取出了所有的电话回家代码，再也没有回头。

* * *

## 回答 #2

> 赞同：269
> 
> 时间：2009-03-16T17:31:11.933

您无法完全保护任何应用程序（托管或非托管）。如果像 Playstation 和 iPad 这样的系统可以被破解——供应商甚至可以控制硬件——你的应用还有什么希望？谢天谢地，你真的不想。在我看来，您需要保护您的应用程序，以防止有人*意外*盗版您的产品，仅此而已*。*

例如，如果您使用每台机器的许可证，那么当您将它安装在新的第二台机器上时，它不应该只工作。你会想要一个好的错误消息来防止额外的支持电话，但不要花费额外的时间让它太难解决，也不要用它来打击用户。

另一个例子是限时试用。甚至不用担心简单的事情，例如用户是否可以回滚系统时钟。这样做的人知道他们正在违反您的许可，并且只要用户*知道*他们何时违反了您就已经做得足够了。

您需要这样做，因为用户不关心您的许可证。许可证是虚构的东西，除非需要，否则*没人*关心。没有人阅读它们，他们真的不应该阅读它们。因此，告诉用户边界在哪里的最佳方法是您的应用程序的开箱即用行为是否符合许可。在第一种情况下，这意味着安装失败或第二次以试用版模式安装。对于后者，它可能只是意味着检查配置文件中的纯文本日期。无论哪种方式，请确保以优雅、乐于助人和尊重的方式处理它。

所以这就解释了做那么多是什么意思。但为什么不更进一步呢？**为什么不堵住你能找到的每一个小洞呢？**答案分为两部分。首先，如果有人越过有*意识地*违反你的许可条款的道德门槛——即使是以简单的方式——他们也会愿意做一些更困难或更危险的事情，比如从[洪流中提取你的应用程序](http://en.wikipedia.org/wiki/Torrent_file)网站 — 运行从不受信任的来源下载的应用程序存在一定的危险。对于这些用户来说，让它变得更难只是一个小烦恼，并有可能导致您的付费客户出现问题。保持简单可能会阻止有人深入研究您的应用程序并发布更全面的破解。其次，你没有多少眼睛可以寻找缺陷；黑客有很多，而且他们有更多的练习来找到它们。你只需要漏掉一个小缺陷，你的应用程序就会在盗版网站上进行相同的分发，就好像你什么都没做一样。你必须每次都是对的；他们只需要幸运一次。因此，所需的努力非常高，任何衡量成功的可能性都非常低。

最终，如果有人想要*盗版*您的应用程序（而不是仅仅使用它），这是他们的主要目标，他们会的。*你无法阻止他们。*这是软件的本质；一旦构成您的产品的文件在用户的计算机上，他们*就*可以随意使用它们。[这在 Java 或.NET](http://en.wikipedia.org/wiki/.NET_Framework)等托管环境中尤其重要，但它也绝对适用于本机代码。时间站在他们这边，只要有足够的时间，任何数字安全都可以被破解。

由于您无法阻止用户盗版您的产品，因此您最好的做法是让这类用户以一种使他们受益的方式参与其中。通常可以让他们为你工作而不是反对你。考虑到这一点，无论您的应用程序是什么，保留一个几乎完全可用且不会过期的免费版本可能是值得的。即使是 1 美元的价格标签和免费之间的差异也是巨大的，如果没有其他原因，客户不必用他们的信用卡信任您。您的产品的免费版本不仅会有效地扼杀盗版发行（当您可以以相同的价格获得合法版本时，为什么还要冒着盗版的风险？），它有可能极大地扩大您的受众。

结果是你可能需要提高付费版的价格，这样最终你就有了 10 万免费用户，而不是每人 20 美元的 2000 名用户，其中 500 名愿意为“专业”版支付 99 美元. 与花费大量时间锁定产品相比，这可以为您赚更多的钱。不仅如此，您还可以吸引这些免费用户并以多种重要方式利用这种关系。

一是支持。悲观主义者会借此机会抱怨支持 100,000 名免费用户的成本增加，但令人惊奇的事情却发生了：您的产品在很大程度上可以自我支持。在没有钱支付支持成本的大型开源项目中，您总是会看到这种情况。用户将加紧努力并实现它。

免费用户通常一开始就降低了对支持的期望，这是有充分理由的。您需要做的就是将免费版标记为仅符合社区支持的条件，并为此目的建立一个用户主持的在线论坛。您的支持知识库是自动生成的，高级用户将代表您引导那些需要额外帮助的人。更重要的是，这将使您能够更快地识别和纠正错误，最终提高产品质量并降低总支持成本。这在以前是不可能的，因为您的用户群不够大，但是当您将免费用户视为客户时，它可以很好地工作。

另一个是反馈。通过观看您的论坛，您可以了解您可能从未考虑过的重要改进想法。这可以让您最终将更多的免费用户转变为付费用户，并创造出更具吸引力的产品，从而吸引更多的受众。

最后，您需要考虑营销。所有这些免费用户现在都是粉丝而不是对手，他们会采取相应的行动。不仅如此，当发布您的下一个版本时，这些用户都将通过您批准的分发渠道，而不是其他一些未知的机制。这意味着对于您的下一个版本，您将开始与更多、高度感兴趣和支持的观众建立联系。

为专业版保留的最佳功能是旨在简化企业部署和管理的工具。破解者不会将这些视为足够令人信服的理由来破解它以供自己使用，但对于希望购买 300 个许可证并将其在公司范围内推出的企业来说，这是必须具备的。当然，专业版无论如何都会被盗版，但再次强调：不要担心，因为无论您做什么，您都可能无法将产品出售给那些盗版者，因此不会花费您*任何*收入。

虽然从心理上讲，很难把你的产品送出这么多，但希望你能理解这真的是最好的方式。不仅如此，从长远来看，这是唯一的出路。我知道有人在那里认为他们不想这样做。毕竟，他们多年来一直很好地销售他们锁定的 20 美元产品。但这太糟糕了，因为如果你不这样做，*最终会有人*这样做。他们的产品会和你的一样好，或者足够接近他们可以逃脱声称。然后突然之间你的定价看起来离谱，销售额急剧下降，你无能为力。如果必须，您可以选择额外的中间层，但这不太可能对您有所帮助。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-03-16T17:12:56.750

In my experience, making your application or library more difficult to crack hurts your honest customers whilst only slightly delaying the dishonest ones. Concentrate on making a great, low friction product instead of putting a lot of effort into delaying the inevitable.

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2010-02-21T06:13:52.477

你与很多人分享的秘密不是秘密。如果你的代码中有秘密的东西，混淆它是没有保护的；它只需要被反混淆*一次*。如果您有不想与客户分享的秘密，请不要与您的客户*分享*。将您的代码编写为 Web 服务，并将您的超级密码保存在您自己的服务器上，只有您可以看到它。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-02-03T08:30:25.150

从广义上讲，那里有三类人。

*   那些不会购买您的软件并求助于破解的人，或者如果他们没有找到任何破解，则根本不使用您的软件。不要指望从这个群体中赚钱。他们要么依靠自己的技能，要么依靠破解者（他们倾向于根据你的有用性和你的受众有多大来优先考虑他们的时间。越有用，破解就越快可用）。

*   将购买（支付）您的软件的合法用户群体，无论您使用何种保护机制。不要使用精心设计的保护机制让合法用户的生活变得艰难，因为无论如何他们都会为此付出代价。复杂的保护机制很容易破坏用户体验，你不希望这种情况发生在这个群体身上。就个人而言，我会投票反对任何硬件解决方案，这会增加您的软件成本。

*   少数会诉诸“不道德”破解并且只会为您的软件*付费的人，**因为*它的功能受到许可机制的保护。您可能不想让该组非常容易绕过您的保护。但是，您在保护软件上所付出的所有努力都会得到回报，具体取决于这群人的规模。这完全取决于您正在构建的软件类型。

鉴于您所说，如果您认为有足够多的少数人可以被迫购买您的软件，请继续实施某种形式的保护。考虑一下您可以从这个少数群体中赚多少钱，与您花在保护上的时间，或者您在第三方保护 API/工具上花费的金额。

如果您想实现自己的解决方案，使用公钥加密是防止简单黑客攻击的好方法（与对称算法相反）。例如，您可以对您的许可证（序列号或许可证文件）进行数字签名。解决此问题的唯一方法是反编译、更改和重新编译代码（使用 Simucal 的答案中建议的技术，您可以使代码变得更难）。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-02-03T09:11:51.917

您无法阻止人们破解您的软件。

但是，您可以让它们产生裂缝，从而减少对您的销售造成的伤害。可以为您的软件颁发有效注册码的密钥生成器比从您的软件中删除注册激励的简单补丁要糟糕得多。那是因为破解只适用于一个软件版本，并且将不再适用于您发布的下一个软件更新。密钥生成器将继续工作，直到您更改注册密钥算法，这是您不希望经常做的事情，因为它会推迟您的诚实客户。

因此，如果您正在寻找一种方法来对抗您的软件的非法密钥生成器，并且由于生成的注册码较长，您不想使用非对称加密，那么您可以看看 Partial Key Verification。

部分密钥验证确保每个非法密钥生成器仅适用于您的软件的一个特定版本。基本上，您要做的是确保您的软件的每个版本仅与用于检查注册码的某些数字的代码链接。哪些数字是随机的，因此破解者必须对软件的许多不同版本进行逆向工程，并将所有这些组合到一个密钥生成器中，以便发布适用于所有软件版本的密钥生成器。

如果您定期发布新的软件版本，这会导致大量密钥生成器散布在各种不再起作用的软件盗版档案中。潜在的软件盗版者通常会寻找最新版本的破解或注册机，因此他们可能会尝试其中的一些并最终放弃。

我在我的 (C++) 较新的共享软件游戏中使用了部分密钥验证，它非常有效。在我们遇到很多无法解决的密钥生成器问题之前。之后有很多破解和一些仅适用于该特定游戏版本的密钥生成器，但没有适用于所有版本的密钥生成器。我们会定期发布非常小的游戏更新，并让之前存在的所有裂缝失效。

似乎有一个用于 Partial Key Verification 的开源[.NET 框架](http://www.dotnetkicks.com/opensource/Partial_Key_Verification_for_NET)，虽然我没有尝试过。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2009-02-03T09:00:46.760

*   使用在线更新来阻止那些未经许可的副本。

*   从应用程序的不同模块验证序列号，不要使用单个函数调用来进行验证（这样破解者就无法轻易绕过验证）。

*   不仅启动时检查序列号，保存数据时进行验证，每周五晚上进行，用户空闲时进行......

*   验证应用程序文件校验和，将您的安全校验和存储在不同的地方。

*   不要在这些技巧上走得太远，确保您的应用程序在验证注册码时永远不会崩溃/出现故障。

*   为用户构建一个有用的应用程序比为破解者制作一个牢不可破的二进制文件更重要。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-02-03T09:15:50.037

你可以..

[~~Microsoft SLP 服务~~InishTech 的软件潜力](http://SoftwarePotential.com)提供了在不影响应用程序功能的情况下帮助保护代码的能力。

*更新：（披露：我在 Eazfuscator.NET 上工作）*使*~~Microsoft SLP 服务~~软件潜力*不同的是能够虚拟化代码，所以你绝对*可以*。自从最初提出这个问题以来已经过去了几年。今天有更多可用的产品也可以在类似的基础上工作，例如：

*   [敏捷.NET](http://secureteam.net/.NET-Obfuscator.aspx)
*   [Eazfuscator.NET](http://www.gapotchenko.com/eazfuscator.net)

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2010-02-21T05:55:43.280

[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)只能打开“托管代码”，这基本上意味着“.NET 代码”。所以你不能用它来反汇编 COM DLL 文件、原生 C++、经典的[Visual Basic 6.0](http://en.wikipedia.org/wiki/Visual_Basic#Timeline)代码等。编译的 .NET 代码的结构使其非常方便、可移植、可发现、可验证等。.NET Reflector 利用这让您可以查看已编译的程序集，但反编译器和反汇编器绝不是特定于 .NET 的，只要编译器存在就一直存在。

您可以使用混淆器使代码更难阅读，但您不能完全防止它被反编译，而不会使其对 .NET 不可读。有一些[产品](http://www.remotesoft.com/linker/)（通常很昂贵）声称将您的托管代码应用程序“链接”到本机代码应用程序，但即使这些产品确实有效，一个有决心的人总能找到方法。

然而，当涉及到混淆时，你会得到你所付出的。因此，如果您的代码是如此专有，以至于您必须竭尽全力保护它，您应该愿意在一个好的混淆器上投资。

然而，在我 15 年左右的代码编写经验中，我意识到对源代码进行过度保护是浪费时间并且没有什么好处。仅仅试图在没有支持文档、注释等的情况下阅读原始源代码可能会非常难以理解。再加上反编译器提出的无意义的变量名和现代混淆器创建的意大利面条代码——你可能不必太担心人们窃取你的知识产权。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2010-02-21T11:34:57.657

If you want people to able to run your code (and if you don't, then why did you write it in the first place?), then their CPU needs to be able to execute your code. In order to be able to *execute* the code, the CPU needs to be able to *understand* it.

Since CPUs are dumb, and humans aren't, this means that humans can understand the code as well.

There's only one way to make sure that your users don't get your code: don't give them your code.

This can be achieved two ways: [Software as a service](http://en.wikipedia.org/wiki/Software_as_a_service) (SaaS), that is, you run your software on *your* server and only let your users access it remotely. This is the model that Stack Overflow uses, for example. I'm pretty sure that Stack Overflow doesn't obfuscate their code, yet you can't decompile it.

The other way is the appliance model: instead of giving your users your code, you give them a computer containing the code. This is the model that gaming consoles, most mobile phones and [TiVo](http://en.wikipedia.org/wiki/TiVo) use. Note that this only works if you "own" the entire execution path: you need to build your own CPU, your own computer, write your own operating system and your own [CLI](http://en.wikipedia.org/wiki/Common_Language_Infrastructure) implementation. Then, and *only then* can you protect your code. (But note that even the *tiniest* mistake will render all of your protections useless. Microsoft, Apple, Sony, the music industry and the movie industry can attest to that.)

Or, you could just do nothing, which means that your code will be automatically protected by copyright law.

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2009-02-03T07:59:50.970

是不是真的值得吗？只要有足够的决心，每一个保护机制都可以被打破。考虑您的市场、产品价格、客户数量等。

如果您想要更可靠的东西，那么请走硬件密钥的道路，但这很麻烦（对用户而言）并且更昂贵。软件解决方案可能会浪费时间和资源，它们给你的唯一东西就是“安全”的错误感觉。

更多的想法（没有一个是完美的，因为没有完美的想法）。

*   [反重复](http://www.alkonost.com/antiduplicate/)
*   [更改语言，使用Skype](http://en.wikipedia.org/wiki/Skype)的作者使用的技巧
*   许可证服务器

并且不要在上面浪费太多时间，因为饼干对典型技术有很多经验，并且比您领先几步。除非您想使用大量资源，否则可能会更改编程语言（以 Skype 方式进行）。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2009-02-04T15:29:17.160

除了购买保护之外，您（或您的开发人员）还可以学习复制保护。

这些是想法：

首先，尝试编写一个将自身写入控制台的程序。这是一个著名的问题。此任务的主要目的是练习编写自引用代码。

其次，您需要开发一种技术，该技术将以一种依赖于其他方法的[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)的方式重写某些代码。

您可以编写一个虚拟机（但在[.NET](http://en.wikipedia.org/wiki/.NET_Framework)中）。并在那里放一些代码。最终，虚拟机运行另一个运行代码的虚拟机。这是为了不让性能降低太多而很少调用的函数的一部分。

将一些逻辑重写为 C++/CLI，并将托管代码与非托管代码混合在一起。这将加强拆卸。在这种情况下，不要忘记也提供[x64](http://en.wikipedia.org/wiki/X86-64)二进制文件。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-02-03T08:05:22.270

不幸的是，你不会逃避这一点。最好的办法是用 C 语言编写代码并[P/Invoke](http://en.wikipedia.org/wiki/Platform_Invocation_Services)。

有一个小的 catch-22，有人可以将您的应用程序反编译为[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)并终止任何验证/激活代码（例如，对您的 C 库的调用）。请记住，用 C 编写的应用程序也会被更顽固的黑客进行逆向工程（看看这些天破解游戏的速度有多快）。没有什么可以保护您的应用程序。

最后，它的工作原理很像你的家，保护得足够好，这样它就会付出太多的努力（意大利面条代码在这里会有所帮助），这样攻击者就会移动到你的隔壁邻居身上（竞争:)）。看看Windows Vista，一定有10种不同的破解方法。

有一些软件包可以加密您的 EXE 文件并在允许用户使用它时对其进行解密，但再一次，这是使用毫无疑问已被破解的通用解决方案。

激活和注册机制针对的是“普通乔”：那些没有足够的技术知识来绕过它（或者就此而言知道他们可以绕过它）的人。不要为饼干而烦恼，他们手头有太多的时间。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2011-06-28T09:40:12.223

好吧，你不能完全保护你的产品不被破解，但你可以最大化/增强安全级别，让它有点难以被新手和中级破解者破解。

但请记住，没有什么是无法破解的，只有服务器端的软件受到了很好的保护，无法破解。无论如何，为了提高应用程序的安全级别，您可以执行一些简单的步骤来防止某些“并非全部”的破解者破解您的应用程序。这些步骤将使这些饼干发疯，甚至绝望：

*   混淆你的源代码，显然这会让你的源代码看起来一团糟，不可读。
*   在您的应用程序中触发几个随机检查例程，例如每两小时、24 小时、一天、一周等，或者可能在用户执行的每个操作之后触发。
*   将您发布的应用程序的[MD5](http://en.wikipedia.org/wiki/MD5)校验和保存在您的服务器上，并实现一个例程，该例程可以将当前文件的 MD5 校验和与您服务器端的真实校验和进行检查，并使其随机触发。如果 MD5 校验和已更改，则表示此副本已被盗版。现在您可以阻止它或发布更新以阻止它等。
*   尝试创建一个例程来检查您的某些代码（函数、类或特定例程）是否实际上已被修改、更改甚至删除。我称之为（代码完整性检查）。
*   使用免费的未知打包程序来打包您的应用程序。或者，如果您有钱，可以选择[Thamida](http://www.oreans.com/themida.php)或[.NET Reactor](http://www.eziriz.com/dotnet_reactor.htm)等商业解决方案。这些应用程序会定期更新，一旦破解者解压您的应用程序，您就可以从这些公司获得新的更新，一旦获得新的更新，您只需打包您的程序并发布新的更新。
*   定期发布更新并强制您的客户下载最新更新。
*   最后使您的应用程序非常便宜。不要让它太贵。相信我，你会得到更多满意的客户，破解者会离开你的应用程序，因为他们不值得花时间破解一个非常便宜的应用程序。

这些只是防止新手和中级破解者破解您的应用程序的简单方法。如果您有更多想法来保护您的应用程序，请不要羞于实施它们。它只会让饼干的生活变得艰难，他们会感到沮丧，最终他们会离开你的申请，因为这不值得他们花时间。

最后，您还需要考虑花时间编写优质的应用程序。不要浪费时间编写复杂的安全层。如果一个好的破解者想要破解你的应用程序，无论你做什么，他/她都会做......

现在去为饼干实施一些玩具......

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2010-06-22T13:11:55.123

是的。是真的。如果代码没有被混淆，.NET 代码非常容易进行逆向工程。

混淆会给试图对您的软件进行逆向工程的人增加一层烦恼。根据您获得的版本，您将获得不同级别的保护。

Visual Studio 包含一个[Dotfuscator](http://www.preemptive.com/products/dotfuscator/compare-editions)版本。由于它是捆绑版本，因此您肯定不会获得最强的混淆。如果您查看他们的功能列表，您会确切地看到您缺少什么（以及应用程序将如何使您的代码更安全）。

还有其他一些免费或开源的 .NET 混淆器（但我无法评论它们使用的质量或各种方法）：

*   [混淆视听](http://code.google.com/p/obfuscar/)
*   [通天网](http://www.babelfor.net/)

最后，没有什么是完美的。如果有人真的想看看你的软件是如何工作的，他们会的。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2009-02-03T12:50:07.357

[.NET 反应堆](http://www.eziriz.com/dotnet_reactor.htm)

**更新**

Jared 指出[de4dot](https://bitbucket.org/0xd4d/de4dot/)声称能够反编译它。

> .NET Reactor 通过将您的 .NET 程序集转换为无法理解为 CIL 且现有工具无法反编译的非托管进程，为您的敏感知识产权提供全面保护。黑客无法访问您的任何可理解形式的来源。
> 
> 强大而灵活的 .NET Reactor 许可功能允许您通过使用硬件和软件锁定来强制执行许可条件并保护您的收入流。许可证管理器可以在几秒钟内建立试用或永久许可证。完整记录的软件开发工具包 (SDK) 包含示例，允许您直接从代码调用许可系统，从而允许您创建许可系统的自定义扩展。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-03-16T17:11:06.413

If Microsoft could come up with a solution, we will not have pirated Windows versions, so nothing is very secure. Here are some similar questions from Stack Overflow and you can implement your own way of protecting them. If you are releasing different versions then you can adopt different techniques for different version so by the time first one is cracked the second one can take over.

*   *[Managing features on a license basis for a C++ application](https://stackoverflow.com/questions/638012)*

*   *[Secure a DLL file with a license file](https://stackoverflow.com/questions/106347)*

*   *[Licensing / protection software?](https://stackoverflow.com/questions/111291)*

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2009-02-04T20:04:21.630

[Salamander](http://www.remotesoft.com/linker/)是 Remotesoft 的本地 .NET 编译器和链接器，可以在没有 .NET 框架的情况下部署应用程序。我不知道它是否符合其要求。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2009-03-16T17:12:41.463

Here's one idea: you could have a server hosted by your company that all instances of your software need to connect to. Simply having them connect and verify a registration key is not sufficient -- they'll just remove the check. In addition to the key check, you need to also have the server perform some vital task that the client can't perform itself, so it's impossible to remove. This of course would probably mean a lot of heavy processing on the part of your server, but it would make your software difficult to steal, and assuming you have a good key scheme (check ownership, etc), the keys will also be difficult to steal. This is probably more invasive than you want, since it will require your users to be connected to the internet to use your software.

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2020-01-27T18:03:57.010

有几个 .Net 混淆工具的详细比较表。

[![在此处输入图像描述](https://i.stack.imgur.com/Rky3t.png)](https://i.stack.imgur.com/Rky3t.png)

截屏取自[obfuscators.io](https://www.obfuscators.io)

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-03-16T17:10:04.760

It's impossible to fully secure an application, sorry.

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2010-02-21T07:35:44.823

混淆代码！*[Obfuscating C# Code](http://www.semdesigns.com/Products/Obfuscators/CSharpObfuscationExample.html)*中有一个示例。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2010-06-22T13:13:45.210

在客户端上运行的任何东西都可以被反编译和破解。混淆只会让它变得更难。我不知道你的应用程序，但 99% 的时间我认为这不值得付出努力。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2009-03-16T17:13:39.980

When it comes to .NET, if you're releasing a [Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms) application (or any application where the client has the Portable Executable file), it's able to be cracked.

If you want to stick with .NET and want to minimize the chance of having your source code taken, then you may want to consider deploying it as an [ASP.NET](http://en.wikipedia.org/wiki/ASP.NET) application across a webserver, instead of making it a Windows Forms application.

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2010-02-21T07:06:25.707

我可以推荐使用[Obfuscator](http://en.wikipedia.org/wiki/Dotfuscator)。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2009-02-03T08:01:30.467

如果它是用 .NET 编写并编译为[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)，则可以反映。如果安全是一个问题并且要避免混淆，那么我建议使用非托管语言编写您的应用程序，从本质上讲，这种语言更难进行逆向工程。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2009-02-03T08:05:41.130

> 如何保证应用不被篡改，如何保证注册机制不被逆向工程。

两者都有一个非常简单的答案：不要将目标代码分发给不受信任的各方，例如（显然）您的客户。在您的机器上托管应用程序是否可行仅取决于它的作用。

如果它不是[Web 应用程序](http://en.wikipedia.org/wiki/Web_application)，也许您可​​以允许通过 X 转发到应用程序服务器（或[远程桌面连接](http://en.wikipedia.org/wiki/Remote_Desktop_Services#Remote_Desktop_Connection)，我猜，对于 Windows）进行[SSH登录。](http://en.wikipedia.org/wiki/Secure_Shell)

如果您将目标代码提供给书呆子类型的人，并且他们认为您的程序可能很有趣，那么它*就会*被破解。没有办法解决它。

如果您不相信我，请指出一个尚未被破解和盗版的高知名度应用程序。

如果您使用硬件密钥，它将使生产成本更高，并且您的用户会因此而讨厌您。在地板上爬来爬去插拔 27 个不同的 USB 东西真是个婊子，因为软件制造商不信任你（我想）。

> 有一些软件包可以加密您的 EXE 并在允许用户使用它时对其进行解密

当然，绕过它的方法是破解“我可以使用它”测试，以便它始终返回 true。

一个讨厌的技巧可能是使用操作码的字节值，这些字节值在程序中的其他地方以一种肮脏的方式执行测试，这将使程序很有可能崩溃，除非该值恰到好处。但是，它使您链接到特定的体系结构:-(

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2009-02-04T15:36:58.550

只需制作一个好的应用程序并编写一个简单的保护系统。不管你选择什么保护，它都会被逆转……所以不要浪费太多时间/金钱。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2010-02-21T06:31:31.993

坦率地说，有时我们需要对代码进行混淆处理（例如，注册许可类等）。在这种情况下，您的项目不是免费的。IMO，您应该为一个好的混淆器付费。

[Dotfuscator](http://en.wikipedia.org/wiki/Dotfuscator)会隐藏您的代码，而[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)在您尝试对其进行反编译时会显示错误。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2010-06-22T13:16:44.923

请记住，99% 以上的用户不会对检查可执行文件以了解其工作方式感兴趣。

鉴于很少有人会费心去尝试，而且大多数混淆器都可以解决，这值得你花时间和精力吗？

你最好把时间花在改进你的产品上，让更多的人想要使用它。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2010-06-22T13:20:18.653

只是添加一个警告：如果您要使用混淆，请检查一切是否仍然有效！混淆可能会改变类名和方法名之类的东西。因此，如果您使用反射来调用某些方法和/或类（例如在插件架构中），您的应用程序可能会在混淆后失败。堆栈跟踪也可能无法追踪错误。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2018-01-25T17:18:08.617

我还对我的设计中的黑客安全性做了一些考虑，并想添加它们，因为其中一些似乎没有被提及：

我的应用程序中有一个脚本接口。为了确保，脚本只能调用打算由（python）脚本调用的方法，我有一个 scriptvisibilityattribute 和 System.Dynamic.DynamicMetaObjectProvider 可以识别这些属性。

许可证使用公钥/私钥。

ViewModel 需要解锁，并为解锁功能提供密码。

CoreRoutines 可以在加密狗上实现。（周围有加密狗支持）

没有计划像包装器这样的大解决方案。

当然，这种脚本/viewModel 方法不会使您无法从代码中解锁和调用脚本不可见的函数，但这样做会变得更加困难——就像所有与反黑客努力相关的事情一样。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2013-10-28T22:11:50.347

最好的答案是第一个来自小开发者的经验，上面讨论的所有反逆向技术对于任何严重的逆向工程师来说都是101个教科书案例。

一些商业 DRM 解决方案相当不错，但它们总是在数小时（或数天）内使用自定义 DRM 解决方案破解每款三重 AAA 游戏。只有引入全新的 DRM 解决方案——有时——不可避免地会延迟几周。

充分利用 DRM 需要花费大量时间和金钱，而且很容易损害性能、可靠性、兼容性/可移植性和一般客户关系。要么坚持一些体面的商业 DRM，而不要试图太聪明并承担你的（更少）损失，或者完全忘记它......

挖自己（商业）坟墓的 DRM 解决方案的一个示例：[http ://en.wikipedia.org/wiki/StarForce](http://en.wikipedia.org/wiki/StarForce)

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2010-06-22T13:13:52.993

是的，[.NET](http://en.wikipedia.org/wiki/.NET_Framework)二进制文件（EXE 和 DLL）可以很容易地反编译成几乎源代码。检查工具[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)。只需针对任何 .NET 二进制文件进行尝试。最好的选择是混淆文件，它们仍然可以被 .NET Reflector 反编译，但它们会造成无法阅读的混乱。我认为好的混淆器不会免费或便宜。一个是 Visual Studio 附带的 Dotfuscator Community Edition。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2020-10-04T14:41:49.607

看起来永远是原生的，现在不需要混淆器；看起来像 net core RT 可行的解决方案；很快所有应用程序都将转到 .net 核心；[https://www.codeproject.com/Articles/5262251/Generate-Native-Executable-from-NET-Core-3-1-Proje?msg=5753507#xx5753507xx](https://www.codeproject.com/Articles/5262251/Generate-Native-Executable-from-NET-Core-3-1-Proje?msg=5753507#xx5753507xx) [https://docs.microsoft.com/en-us /archive/msdn-magazine/2018/november/net-core-publishing-options-with-net-core](https://docs.microsoft.com/en-us/archive/msdn-magazine/2018/november/net-core-publishing-options-with-net-core)

未测试可能与旧的 win .net sdk 可能类似。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2019-01-27T06:28:19.800

***根据微软博客中的以下问题：***

[https://blogs.msdn.microsoft.com/amb/2011/05/27/how-to-prevent-ildasm-from-disassemble-my-net-code/](https://blogs.msdn.microsoft.com/amb/2011/05/27/how-to-prevent-ildasm-from-disassembling-my-net-code/)

如何防止 ILDASM 拆卸组件？

`.NET`有一个名为的属性***`SuppressIldasmAttribute`***，它可以防止反汇编代码。例如，考虑以下代码：

```
using System;
using System.Text;
using System.Runtime.CompilerServices;
[assembly: SuppressIldasmAttribute()]

namespace HelloWorld
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Hello world...");
        }
    }
} 
```

如您所见，只有两个区别：

1.  我们添加了`System.Runtime.CompilerServices`命名空间减速。

2.  我们添加了`[assembly: SuppressIldasmAttribute()]`属性。

在 Visual Studio 中构建应用程序后，当我们尝试在 中打开生成的 EXE 文件时`ILDASM`，现在我们收到以下消息：

[![在此处输入图像描述](https://i.stack.imgur.com/MFEr0.jpg)](https://i.stack.imgur.com/MFEr0.jpg)

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-10-14T03:40:22.233

我从两个主要方面看待这个话题。

A) .NET 是否只能进行逆向工程而不是原生的？

B）我们是什么类型的程序员/业余爱好者？

标题：保护 .NET 代码免受逆向工程

我的观点：

1.  最不喜欢在 .NET 中制作商业应用程序，因为它甚至会在反编译后公开您对构建二进制文件的评论。（我不知道将注释也包含在二进制文件中的逻辑是什么）所以任何人都可以反编译它，重命名/修改/更改外观并在 24 小时内转售应用程序。

2.  在本机应用程序中重命名/修改/更改外观不可能像在 .NET 中那样简单

3.  .NET 中令人担忧的部分是，您可以从单个二进制 exe/dll 获得整个项目的解决方案。

想象一下它在安全方面有多周。因此，即使是外行也可以轻松地对 .NET 应用程序进行逆向工程。

4.  如果它是像 C++/VB6/Delphi 这样的本机应用程序，只有知道 ASM 的专家破解者才能修补 exe，而不是像 .NET 这样的 100% 逆向工程。

但是现在整个世界都在.NET 后面运行，因为使用高级功能和库很容易制作项目。

5.  好消息是，微软似乎在 2020 年支持 .NET 的本地输出，这将使像我这样的编码人员将 .NET C# 视为主要语言。

[https://www.codeproject.com/Articles/5262251/Generate-Native-Executable-from-NET-Core-3-1-Proje?msg=5755590#xx5755590xx](https://www.codeproject.com/Articles/5262251/Generate-Native-Executable-from-NET-Core-3-1-Proje?msg=5755590#xx5755590xx)

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2022-02-25T21:48:49.310

使用 Skater .NET 混淆器。该 .NET 保护工具适用于 de4dot，deobfuscator 将原始受保护的程序集成员名称重命名为人类可读的字符串。溜冰者与之抗争！

最近 MindSystemm 小组发布了一个名为 Skater.NetDeobfuscator [url: https://github.com/MindSystemm/Skater.NetDeobfuscator] 的特殊工具，它利用了 Skater .NET 混淆器的漏洞。混淆器的开发者 Rustemsoft LLC 收到了急需保护关键 Skater .NET 混淆器算法和软件基础设施的信号，以便为 Skater 用户提供更强大的源代码保护。[那已经解决了](https://www.linkedin.com/pulse/skater-net-obfuscator-vulnerabilities-have-been-skater-net-obfuscator-1e/?trackingId=xRvp6dppUcMs0ADscr1SHw%3D%3D)。

# command-line - 如何在 Wget 中为未完成的下载设置临时目录？

> ID：506283
> 
> 赞同：3
> 
> 时间：2009-02-03T07:53:46.643
> 
> 标签：command-line, ftp, wget

我正在尝试在 FTP 服务器上镜像文件。这些文件可能非常大，因此下载可能会中断。我想在将部分文件下载到临时文件夹时保留原始文件，并在完成后覆盖本地旧版本。

1.  我可以这样做吗？如何？
2.  我可以使用其他易于使用的（命令行）工具吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T10:02:12.063

首先，将文件下载到临时目录。使用 -c 以便您可以恢复。

下载完成后，使用复制、重命名或 rsync 将文件复制到最终位置。

注意：考虑在整个过程中使用 rsync，因为它只是为这个用例而设计的，它对服务器和 Internet 造成的压力要小得多。如果您出于这个原因要求他们提供 rsync 访问权限，大多数站点管理员都会很高兴。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T08:23:20.127

查看 wget 手册我看不到此功能，但是您可以编写一个 bash 脚本来执行您想要的操作，这实际上将为每个文件运行一个单独的 wget，然后使用普通的 mv 命令移动它。

或者根据[手册](http://linux.about.com/library/cmd/blcmdl1_rsync.htm)查看 rsync有一个设置临时目录的参数

```
-T  --temp-dir=DIR          create temporary files in directory DIR 
```

我不是 100% 确定这是它在下载期间放置文件的地方，因为没有机会尝试它。

# sql - CONTAINSTABLE 和 CONTAINS，传递哪个字符串来匹配所有记录？

> ID：506284
> 
> 赞同：0
> 
> 时间：2009-02-03T07:55:54.237
> 
> 标签：sql, sql-server

我们在 SQL Server 2005 中有一个使用 CONTAINSTABLE() 的单语句函数。当我们传递一个非空的搜索字符串时，一切正常。是否有可以传递给 CONTAINSTABLE() 的通配符字符串，以便它匹配表中的所有记录。

亲切的问候，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T08:27:20.273

如果没有要搜索的全文短语，则必须使用存储过程中的逻辑来运行没有 CONTAINSTABLE 谓词的 SQL 语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T08:28:31.753

我不认为有，你必须做类似（伪代码）的事情

```
IF @searchterm='*' 
    SELECT * FROM YOURTTABLE
ELSE
    SELECT * FROM YOURTABLE INNER JOIN CONTAINSTABLE etc
END IF 
```

# .net - Debug.Assert 与异常

> ID：506285
> 
> 赞同：17
> 
> 时间：2009-02-03T07:56:28.603
> 
> 标签：.net, exception, assertions

令人惊讶的是，我只能找到关于这个主题的一个关于 SO 的先前问题，我只想让社区对我的方法进行“信任投票”（或不投票！）。

我的看法是这样的：

*   用来`Debug.Assert`陈述你期望是真的事情。这将在我们完全控制我们的环境时使用，例如在验证某些前置条件和后置条件的方法中。
*   出现异常情况时使用异常。处理外部资源，即文件、数据库、网络等是轻而易举的事。但...

在以下场景中它变得有点模糊。请注意，这是一个人为的示例，仅用于说明！

假设我们有一个 MyClass 类，它有一个公共属性 MyMode 和一个方法`GetSomeValueForCurrentMode()`。将 MyClass 视为一个打算在库中交付（发布构建）以供其他开发人员使用的类。

我们希望 MyMode 由此类的外部用户更新。现在，`GetSomeValueForCurrentMode()`有以下逻辑：

```
switch(MyMode)
{
case Mode.ModeA:
return val1;
case Mode.ModeB:
return val2;
default:
//Uh-uh this should never happen

} 
```

我在这里得到的是 MyClass 的用户已将其置于无效状态。那么我们应该怎么做呢？

默认情况下，我们应该`Debug.Assert`还是`throw new InvalidOperationException`（或其他）？

有一个口头禅说我们不应该信任我们课程的用户。如果我们选择 Debug.Assert 并将 MyClass 构建为发布版本（从而删除 Debug Asserts），则该类的用户将不会获得他们将其置于无效状态的有用信息。但这有点与另一个口头禅相反，后者说只有在完全无法控制的事情发生时才抛出异常。

我发现我在这个圈子里转了一圈 - 那些似乎没有明确的“正确”答案的编程辩论之一。所以让我们把它付诸表决吧！

编辑：我在一个相关的 SO 问题中注意到了这个响应（[使用断言或异常进行合同设计？](https://stackoverflow.com/questions/117171/design-by-contract-tests-by-assert-or-by-exception)）：

> 经验法则是，当你试图捕捉自己的错误时，你应该使用断言，而当你试图捕捉别人的错误时，你应该使用异常。换句话说，您应该使用异常来检查公共 API 函数的先决条件，以及每当您获得系统外部的任何数据时。您应该对系统内部的功能或数据使用断言。

对我来说，这是有道理的，并且可以与下面概述的“断言然后抛出”技术相结合。

欢迎提出想法！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T08:20:31.350

首先，MyClass 的有效性当然应该由 MyClass 的**invariant**表示。

其次，您说“我们希望 MyMode 由此类的外部用户更新”-当然，此模式的设置器应该具有典型的按合同设计的形式（与任何公共函数一样）：

```
 void Setter(mode m)
  {
    // INVARIANT ASSERT (1)
    // PRECONDITION ASSERTS (uses "m") (2)

    // BODY (3)

    // POSTCONDITION ASSERTS (if any) (4)
    // INVARIANT ASSERT (5)
  } 
```

在 (5) 中，您将因不变量不成立的尖叫断言违规而失败。**但是在 (2) 中，您会更早地失败，因为传递的*模式 m无效。***这将向用户发送明确的信息，从而解决您的问题。

请不要告诉我模式字段是公开的，用户在没有任何控制的情况下更改它。

**编辑：**关于断言和发布模式，另请参阅：

*   [断言总是不好的吗？](https://stackoverflow.com/questions/419406/are-assertions-always-bad)

*   [断言什么时候应该留在生产代码中？](https://stackoverflow.com/questions/17732/when-should-assertions-stay-in-production-code)

*   [使用断言或异常按合同设计？](https://stackoverflow.com/questions/117171/design-by-contract-tests-by-assert-or-by-exception)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T09:39:34.077

我基本上同意您自己的问题的结论：如果**A** lice的代码检测到 A lice 犯的错误**，**则这是 A ssert 的情况**（**除非性能另有规定，否则断言应保留在生产代码中）。如果 Alice 的代码在 Eve 的代码中检测到错误**，**那么这是一个例外情况，假设 Alice 和 Eve 在**您****的错误跟踪软件的对立面**。

 ******现在这是一般的经验法则。断言形式稍作修改，也可以用作**“提醒，开发人员！”**机制（然后它们不应该被称为“ASSERT”，而是“HEADS_UP”或类似的东西）。如果您的公司开发了客户端/服务器产品，而服务器向客户端发送无效数据怎么办？如果您是客户端程序员，您想将其视为外部数据（即 Eve 的数据是 kaputt）并且您想抛出异常。但是一个“更软”的断言，它使 Visual Studio 的调试器停在那里，可能是一个非常好的方法来真正及早地检测这些问题并将其报告给服务器团队。在实际安装中，它很可能是 Mallory 对 Eve 和 Alice 之间的数据进行调和，但大多数时候这确实是你的一位同事的错误，你想在它发生时看到它——这就是我称之为他们的原因“单挑”断言：他们没有

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-03T10:33:48.663

我同意这里的大多数人并遵循按合同设计。您应该尝试非常清楚地区分已部署代码（合同）中的需求和在设计期间确定预期状态（调试断言）。

您应该始终将合同断言作为异常抛出（因为它们应该始终是异常的）。大多数框架都内置了用于捕获调试断言的机制。但是在运行时你应该总是抛出一个异常。

我使用自定义库来帮助解决这个问题（在 C#/VB.NET 中）。如果您对它在实践中的工作方式感兴趣，我最近将它放在 Codeplex ( [http://www.contractdriven.com/ ) 上。](http://www.contractdriven.com/)

这样做的一个附带好处是，当您开始更频繁地使用 DbC 时，您很少需要使用调试断言，因为您的代码中已经写入了明确的保证，因此实际上很难进入无效状态。

所以你原来的帖子中的问题......“我在这里得到的是 MyClass 的用户让它处于无效状态。那么我们应该怎么做？”......永远不会出现。

您可能再也不需要调试任何东西了！;-)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T08:24:01.013

通常两者兼而有之：断言，然后抛出。

你断言是因为你想在开发过程中通知开发人员一个错误的假设。

你抛出是因为如果这发生在发布版本中，你需要确保系统在处于错误状态时不会继续处理。

您的系统所需的可靠性特性可能会影响您在这里的选择，但我认为“断言然后抛出”通常是一种有用的策略。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T08:16:36.007

我对断言的使用遵循[合同设计的](http://en.wikipedia.org/wiki/Design_by_contract)想法。基本上，您断言传入参数、全局变量和其他状态信息在您进入函数时是有效的，并且断言返回值和状态在您离开时也是有效的。如果你在开始时得到一个失败的断言，那是调用代码中的一个错误，如果你在最后得到它，那么这个错误就在这个代码中。这些是前置条件和后置条件。

switch 语句中的断言只有在您检查了输入的先决条件时才真正有用。在这种情况下，如果您在函数的中间到达不可接受的状态，则它是您的函数失败或被调用的函数。就个人而言，我会在这里坚持断言，因为它也不例外。正如您所暗示的，异常与资源有关，而不是错误。但是，您可以创建一个存在于发布版本中的自定义断言处理程序，并在失败时引发异常，以使您的程序有机会返回到稳定状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-06T19:06:45.940

我想说：如果错误在其他人的代码中，或者在不同子系统的代码中（无论您是否编写），请使用异常。如果来自外部源（如文件）的数据存在错误，也使用异常。

有时，您不知道数据是否来自外部来源。如果安全性很重要，并且您可能正在处理未经验证正确的外部数据，请使用异常。如果安全性不重要，那么我会将性能用作决胜局：此代码是否可以在紧密循环中执行？如果是这样，请考虑使用断言，因为您将在发布版本中获得更好的性能。否则，使用异常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T08:11:35.157

它取决于语言，如果您使用语法糖则断言，那么您应该使用它。但是在 Java 中，需要打开断言才能使其工作，所以异常更好。然而，有特定的异常总是更好，所以这里应该是 IllegalStateException。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T08:16:29.330

在 .Net 中，当您进行发布构建时，程序中不包含 Debug 类方法，因此如果此代码投入生产，您将不得不抛出异常。

# c# - 休眠日期时间问题

> ID：506295
> 
> 赞同：2
> 
> 时间：2009-02-03T08:01:01.077
> 
> 标签：c#, sql-server, nhibernate

我目前遇到一个小问题。我正在使用 nhibernate，大约有 40 个实体映射到 sql server 数据库。但是，由于性能原因，一些操作是通过存储过程完成的。我有一个需要 3 个参数的存储过程。一个实体 ID 和 2 个日期时间。

现在，当我有一个像 2008 年 12 月 10 日这样的日期时，Nhibernate 使

```
'10.12.2008 00:00:00.000' 
```

出它。（德国文化）但是 Sql Server 2008 不能正确解释它，因为它交换了日和月。当我手动将日期时间文本更改为

```
'2008-12-10 00:00:00.000' 
```

当以“正常”方式使用会话或使用 NHibernate.linq 时，我没有遇到这个问题。只是在使用 sql-query 执行存储过程时。

有没有办法手动克服 NHibernate 将 DateTime 对象转换为其文本表示的方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T08:08:07.910

NHibernate 根本不应该将 DateTimes 转换为其文本表示，IMO - 它应该要求数据库驱动程序以它想要的任何形式传递该 DateTime。

您的存储过程是否声明为*以*DateTimes（或任何 SQL 类型）或 varchar 形式接收参数？如果 if 被声明为接收 DateTime 并且 NHibernate 知道这一点，那么它*应该*只是正常使用参数化调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T08:15:26.350

我将带有 .SetDateTime(name,datetimeValue) 的日期时间传递给 IQuery，因此我认为 nhibernate 应该处理它。存储过程需要 DateTime 参数。当我打开 show_sql 时，我刚刚看到了这个文本表示

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-26T13:43:58.210

我在将单个 DateTime 传递到 CLR 存储过程中时看到了同样的情况。我的也是多个参数。我也将它作为字符串尝试过，无论我做什么都会出错。这是映射文件中的代码：

" 执行 spGetRentRollByDate :@propertyID :@reportDate "

存储过程首先在给定表中查找结果集，如果它不存在，它会触发另一个函数来创建一个并返回该集合。

# java - 将 CSV 映射到模型

> ID：506317
> 
> 赞同：4
> 
> 时间：2009-02-03T08:12:13.627
> 
> 标签：java, xml, csv, mapping, jaxb

我正在用 Java 编写一个简单的 CSV 到 XML 处理器。

我正在使用 JAXB 从 DTD 生成 java 模型。我需要将 CSV 格式处理成这个模型，然后将其编组为符合 DTD 的 XML。我正在使用 JAXB 将数据从 Java 模型整理到 XML。我必须自己编写 CSV 模型映射。

目前，我想不出比通过读入 CSV 并将其分配给代码中的模型来直接将其映射到 Java 模型更好的解决方案了。

您能想到一个更优雅的解决方案吗？也许一些可重用的映射库等？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T09:58:57.140

我通常使用 flatpack 库将 CSV 解析为 Java 模型： [Sourceforge 上的 Flatpack 项目](http://flatpack.sourceforge.net/)

使用和使用 XML 映射来处理 CSV 到模型的投影非常简单（因此不会导致 csv 和 java 对象之间的紧密耦合）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T09:58:07.610

如果你有一个简单的映射，你可以使用第三方工具直接将 csv 映射到 xml（例如[csv2xml 转换器](http://csv2xml.sourceforge.net/)

或者，将 csv 文件作为映射集合读取，其中“键”作为 java 类中相应属性的名称。然后您可以编写一个简单的解析器，该解析器将使用反射将地图中的 csv 值设置为 java 对象。

# wpf - 免费的 WPF 应用程序模板？

> ID：506324
> 
> 赞同：9
> 
> 时间：2009-02-03T08:15:44.307
> 
> 标签：wpf, templates

是否有网站提供免费的“WPF 应用程序模板”，例如 freecsstemplates.com 为 HTML 网站提供的？

我正在寻找可以在 XAML 中构建的具有漂亮布局、功能菜单等的东西。

### 附录

虽然主题很好，但我也在寻找一种布局，[类似于我在这里使用 silverlight 停靠面板创建的布局](http://tanguay.info/web/index.php?pg=howtos&id=1)，但当然，由在设计和 XAML 方面更有经验的人完成，因此具有例如具有侧面板在鼠标悬停时移入和移出，顶部的完整菜单，侧面的手风琴菜单。WPF 让这些事情变得如此简单，我认为这些类型的免费模板/主题网站现在会如雨后春笋般涌现。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T08:20:40.647

[http://www.codeplex.com/wpfthemes](http://www.codeplex.com/wpfthemes)有免费的 WPF 主题。[http://reuxables.nukeation.com/catalog.aspx](http://reuxables.nukeation.com/catalog.aspx)和[http://www.xamltemplates.net/index.php?page=1](http://www.xamltemplates.net/index.php?page=1)也有主题，但它们不是免费的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T09:20:24.503

[这](http://www.actiprosoftware.com/Default.aspx)不是免费的，但您可以下载免费示例。它有很多非常酷的模板和功能齐全的对象

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-08-21T08:58:49.267

我偶然发现了[这一点](https://visualstudiogallery.msdn.microsoft.com/7a4362a7-fe5d-4f9d-bc7b-0c0dc272fe31)，它看起来非常好且稳定。

# c++ - C++ 标准输入输出::重命名(); 同步？

> ID：506329
> 
> 赞同：0
> 
> 时间：2009-02-03T08:16:55.273
> 
> 标签：c++, stdio, file-rename

`stdio::rename()`如果函数调用是完全同步的，我只是在徘徊。那么从函数调用返回后的文件是否可以以新名称立即使用，或者可能需要一些时间（几毫秒）才能发生这种情况？我正在调查一个恼人的计时错误，并怀疑后一种情况会发生。

我的软件在 Win2k3 服务器机器上运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T08:29:48.087

MSVC 运行时简单地调用`MoveFile()`API，它是同步的。

如果您尝试使用旧名称创建新文件（即，某些编辑器如何通过将原始文件重命名为“filename.bak”然后使用原始文件名保存新文件来保存文件）并且您会感到惊讶如果新文件的创建日期（和其他元数据）与原始文件匹配，那么您可能会被“文件系统隧道”所困扰：

*   [http://support.microsoft.com/?kbid=172190](http://support.microsoft.com/?kbid=172190)

# actionscript-3 - ActionScript 2 中缺少 ExternalInterface.objectID 是否有解决方法

> ID：506339
> 
> 赞同：2
> 
> 时间：2009-02-03T08:23:15.710
> 
> 标签：actionscript-3, actionscript-2, externalinterface

我正在将一些 ActionScript 3 移植到 ActionScript 2（遗憾的是，一些广告代理商仍然拒绝拥抱未来）并且我遇到了 ActionScript 2`ExternalInterface`中没有`objectID`属性的问题，就像在 ActionScript 3 中一样。

我正在处理的代码调用了很多 JavaScript，其中一些代码需要脚本知道 Flash 对象/嵌入的 ID（例如，查找页面上的位置，并调整对象/嵌入的大小） .

是否有一个简单的解决方法来获取 ActionScript 2 中的对象/嵌入 ID？

我设法编写了一些 JavaScript 代码，这些代码基本上搜索页面上的所有对象并嵌入节点，直到找到具有特殊方法（设置`ExternalInterface.addCallback`为和不安全的依赖方法。当然有更简单的方法吗？

*编辑：我无法控制嵌入 SWF 的代码，因此传入 ID 不起作用。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T07:28:03.517

这是你要找的吗？发现它拥有 Flash html 对象 ID 的简单 actionscript 2 类。

[http://sourceblogg.se/lang/en/mina-projekt/isitme-get-flash-html-object-id-within-flash/](http://sourceblogg.se/lang/en/mina-projekt/isitme-get-flash-html-object-id-within-flash/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T21:15:52.187

通过 FlashVars 将 ID 传递给 SWF 怎么样？您应该在嵌入 ID 时知道它，因此将其添加为传递给 Flash 的 FlashVars 变量之一应该很容易。然后将其存储在调用 ExternalInterface 的代码可以获取的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-09T14:48:55.663

试试 Flash Javascript 集成工具包[http://weblogs.macromedia.com/flashjavascript/](http://weblogs.macromedia.com/flashjavascript/)。据我所知，AS3 中的 ExternalInterface 类是这个 AS2 解决方案的形式化。

# c++ - excelApp.CreateDispatch() 返回零值：失败

> ID：506358
> 
> 赞同：1
> 
> 时间：2009-02-03T08:32:56.673
> 
> 标签：c++

我在 Visual C++ 2005 中有以下代码：

类 _Application:public COleDispatchDriver {....};

_应用程序excelApp；

excelApp.CreateDispatch((LPCTSTR)_T("Excel.Application")))

但是对 excelApp.CreateDispatch((LPCTSTR)_T("Excel.Application"))) 的调用返回一个零值，表示失败。

你能告诉我可能的原因是什么吗？

PS：我从另一个解决方案（Visual C++ 2005）复制了上面的代码，在同一台机器上它工作得很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T09:39:12.923

我得到了答案：

我只需要在上面的代码之前调用 CoInitialize(0) 。

然后 CoUninitialize() 完成后。

酷它是....

# configuration - 为什么要在没有配置的情况下进行依赖注入？

> ID：506359
> 
> 赞同：5
> 
> 时间：2009-02-03T08:34:42.723
> 
> 标签：configuration, dependency-injection, inversion-of-control

在阅读了[这个问题](https://stackoverflow.com/questions/21288/which-c-net-dependency-injection-frameworks-are-worth-looking-into)的好答案后，我观看了 Justin Etheredge 的截屏视频。这一切看起来都很好，只需最少的设置，您就可以从代码中直接获得 DI。

现在让我毛骨悚然的问题是：为什么要使用不使用配置文件的 DI 框架？这难道不是使用 DI 基础设施的全部意义，这样您就可以在构建/发布/任何代码之后改变行为（可以说是“策略”）吗？

谁能给我一个很好的用例来验证使用像 Ninject 这样的非配置 DI 吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T08:49:04.350

我不认为你想要一个*没有*配置的 DI 框架。*我认为您*想要一个具有所需配置的 DI 框架。

我以春天为例。回到“旧时代”，我们曾经将所有内容都放在 XML 文件中以使所有内容都可配置。

当切换到完全注释的机制时，您基本上定义了您的应用程序包含哪些组件*角色。*因此，例如，给定的服务可能具有一个用于“常规运行时”的实现，其中还有另一个实现属于应用程序的“存根”版本。此外，在为集成测试接线时，您可能正在使用第三种实现。

当以这种方式看待问题时，您很快就会意识到大多数应用程序在运行时中只包含一组非常有限的组件角色——这些实际上会导致使用不同版本的组件。并且通常组件的给定*实现**总是*绑定到这个角色；这确实是该实现存在的原因。

因此，如果您让“配置”简单地指定您需要哪些组件角色，那么您无需更多配置就可以逃脱。当然，总会有例外，但你只需要处理例外。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T09:57:46.770

我在使用 krosenvold 的道路上，这里只有更少的文本：在大多数应用程序中，每个所需的“服务”都有一个实现。我们根本不会编写每个对象需要每个服务的 10 个或更多实现的应用程序。因此，有一种简单的方式说“这是默认实现，使用此服务的所有对象中有 99% 会对此感到满意”是有意义的。

在测试中，您通常使用特定的模型，因此也不需要任何配置（因为您手动进行接线）。

这就是约定优于配置的全部内容。大多数时候，配置只是重复 DI 框架应该知道的东西的转储:)

在我的应用程序中，我使用类对象作为查找实现的键，而“键”恰好是默认实现。如果我的 DI 框架在配置中找不到覆盖，它只会尝试实例化密钥。拥有超过 1000 个“服务”，我需要四个覆盖。那将是很多无用的 XML 编写。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T09:18:54.320

通过依赖注入，单元测试的设置变得非常简单，因为您可以在被测对象中注入模拟而不是真实对象。您不需要为此进行配置，只需在单元测试代码中创建并注入模拟。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-04T15:03:42.407

我在我的博客上收到了[Nate Kohari](http://kohari.org/)的评论：

> 很高兴您正在考虑使用 Ninject！Ninject 的立场是，DI 框架的配置实际上是应用程序的一部分，不应公开配置。如果您希望某些绑定是可配置的，您可以轻松地让您的 Ninject 模块读取您的 app.config。在代码中进行绑定可以让您摆脱 XML 的冗长，并为您提供类型安全、可重构性和智能感知。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T08:51:53.673

您甚至不需要使用 DI 框架来应用依赖注入模式。如果除了重新编译代码之外不需要可配置性，您可以简单地使用静态工厂方法来创建对象。

所以这一切都取决于您希望应用程序的可配置性。如果您希望它在不重新编译代码的情况下可配置/可插入，您将需要可以通过文本或 xml 文件配置的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T09:34:55.490

我将支持使用 DI 进行测试。我现在只真正考虑使用 DI 进行测试，因为我们的应用程序不需要任何基于配置的灵活性——目前它也太大了，无法考虑。

DI 往往会带来更清洁、更分离的设计——这会带来全方位的优势。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T08:51:18.650

如果您想在发布构建后更改行为，那么您将需要一个支持外部配置的 DI 框架，是的。

但我可以想到其他不需要此配置的场景：例如控制业务逻辑中组件的注入。或者使用 DI 框架来简化单元测试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T08:53:41.250

您应该阅读.NET 中的[PRISM](http://www.codeplex.com/CompositeWPF)（在 .NET 中执行复合应用程序是最佳实践）。在这些最佳实践中，每个模块在共享容器内“公开”它们的实现类型。这样，每个模块对“谁提供此接口的实现”都有明确的责任。我认为当您了解 PRISM 的工作原理时就足够清楚了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T09:42:58.220

当您使用控制反转时，您正在帮助您的班级尽可能少地做事。假设您有一些 Windows 服务等待文件，然后对文件执行一系列处理。其中一个过程是将其转换为 ZIP，然后通过电子邮件发送。

```
public class ZipProcessor : IFileProcessor
{
  IZipService ZipService;
  IEmailService EmailService;

  public void Process(string fileName)
  {
    ZipService.Zip(fileName, Path.ChangeFileExtension(fileName, ".zip"));
    EmailService.SendEmailTo(................);
  }
} 
```

当您可以有专门的课程为您执行此操作时，为什么这门课程需要实际进行压缩和发送电子邮件？显然你不会，但这只是我的观点:-)

除了不实现 Zip 和电子邮件之外，为什么该类应该知道哪个类实现了该服务？如果您将接口传递给该处理器的构造函数，则它永远不需要创建特定类的实例，它会获得完成这项工作所需的一切。

使用 DIC，您可以配置哪些类实现某些接口，然后让它为您创建一个实例，它将依赖项注入到类中。

```
var processor = Container.Resolve<ZipProcessor>(); 
```

因此，现在您不仅将类的功能与共享功能清晰地分开，而且还阻止了消费者/提供者对彼此有任何明确的了解。这使得阅读代码更容易理解，因为同时需要考虑的因素更少。

最后，在进行单元测试时，您可以传入模拟的依赖项。当您测试您的 ZipProcessor 时，您的模拟服务只会断言该类试图发送一封电子邮件，而不是它真的试图发送一封电子邮件。

```
//Mock the ZIP
var mockZipService = MockRepository.GenerateMock<IZipService>();
mockZipService.Expect(x => x.Zip("Hello.xml", "Hello.zip"));

//Mock the email send
var mockEmailService = MockRepository.GenerateMock<IEmailService>();
mockEmailService.Expect(x => x.SendEmailTo(.................);

//Test the processor
var testSubject = new ZipProcessor(mockZipService, mockEmailService);
testSubject.Process("Hello.xml");

//Assert it used the services in the correct way
mockZipService.VerifyAlLExpectations();
mockEmailService.VerifyAllExceptions(); 
```

所以简而言之。你会想要做到 01: 防止消费者明确知道哪个提供者实现了它需要的服务，这意味着当你阅读代码时一次理解的更少。02：使单元测试更容易。

皮特

# c - C：指向结构定义中的结构的指针

> ID：506366
> 
> 赞同：58
> 
> 时间：2009-02-03T08:40:19.563
> 
> 标签：c, struct, pointers

我怎样才能在这个结构的定义中有一个指向下一个结构的指针：

```
typedef struct A {
  int a;
  int b;
  A*  next;
} A; 
```

这是我第一次写它的方式，但它不起作用。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-02-03T08:43:50.087

您可以先在一个语句中定义 typedef 并前向声明该结构，然后在后续定义中定义该结构。

```
typedef struct A A;

struct A
{
    int a;
    int b;
    A* next;
}; 
```

编辑：正如其他人所提到的，如果没有前向声明，结构名称在结构定义中仍然有效（即您可以使用`struct A`），但 typedef 直到 typedef 定义完成后才可用（因此 using just`A`无效）。这对于只有一个指针成员可能无关紧要，但如果您有一个包含大量自类型指针的复杂数据结构，则可能不太实用。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-02-03T08:45:40.363

除了第一个答案，没有 typedef 和 forward 声明，这也应该没问题。

```
struct A 
{ 
    int a; 
    int b; 
    struct A *next; 
}; 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-02-03T08:48:02.417

你错过了`struct`之前的`A*`

```
 typedef struct A {
    int a;
    int b;
    struct A* next;
  } A; 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-02-03T08:46:56.740

您可以不使用前向声明：

```
struct A {
    int a;
    int b;
    struct A *next;
}; 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-03T21:34:12.340

请，您使用的是 C，而不是 C++。

如果您真的必须 typedef 一个结构（而我使用的大多数程序员不会¹），请执行以下操作：

```
typedef struct _A {
    int a;
    int b;
    struct _A *next;
} A; 
```

清楚地区分`_A`（在`struct`命名空间中）和`A`（在类型命名空间中）。

¹`typedef`隐藏了它所指向的类型的大小和存储——论点（我同意）是，在像 C 这样的低级语言中，试图隐藏任何东西都是有害的并且适得其反。习惯于随便`struct A`打字`struct A`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-12-14T10:49:34.240

```
typedef struct {
 values
} NAME; 
```

这是 typedef 结构的较短方法，我认为它是最简单的表示法，只是不要将名称放在前面而是放在后面。

然后你可以这样称呼它

```
NAME n;  

NAME *n; // if you'd like a ptr to it. 
```

这种方法有什么问题吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-21T07:10:20.267

使用以下预处理器：

```
#define structdef(NAME) typedef struct NAME NAME; struct NAME 
```

用法：

```
structdef(node_t)
{
   void* value;
   node_t* next;
}; 
```

# .net - 如何将枚举值序列化为 int？

> ID：506368
> 
> 赞同：78
> 
> 时间：2009-02-03T08:40:28.080
> 
> 标签：.net, enums, xml-serialization

我想将我的枚举值序列化为 int，但我只得到名称。

这是我的（示例）类和枚举：

```
public class Request {
    public RequestType request;
}

public enum RequestType
{
    Booking = 1,
    Confirmation = 2,
    PreBooking = 4,
    PreBookingConfirmation = 5,
    BookingStatus = 6
} 
```

和代码（只是为了确保我没有做错）

```
Request req = new Request();
req.request = RequestType.Confirmation;
XmlSerializer xml = new XmlSerializer(req.GetType());
StringWriter writer = new StringWriter();
xml.Serialize(writer, req);
textBox1.Text = writer.ToString(); 
```

[这个答案](https://stackoverflow.com/questions/117348/can-you-force-the-serialization-of-an-enum-value-into-an-integer/117374#117374)（对另一个问题）似乎表明枚举应该默认序列化为整数，但它似乎没有这样做。这是我的输出：

```
<?xml version="1.0" encoding="utf-16"?>
<Request xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <request>Confirmation</request>
</Request> 
```

我已经能够通过在每个值上放置一个“[XmlEnum("X")]”属性来序列化为值，但这似乎是错误的。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-04-08T15:20:26.030

最简单的方法是像这样使用 [XmlEnum] 属性：

```
[Serializable]
public enum EnumToSerialize
{
    [XmlEnum("1")]
    One = 1,
    [XmlEnum("2")]
    Two = 2
} 
```

这将序列化为 XML（假设父类是 CustomClass），如下所示：

```
<CustomClass>
  <EnumValue>2</EnumValue>
</CustomClass> 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-02-03T08:53:33.543

大多数时候，人们想要的是名字，而不是整数。您可以为此添加一个 shim 属性吗？

```
[XmlIgnore]
public MyEnum Foo {get;set;}

[XmlElement("Foo")]
[EditorBrowsable(EditorBrowsableState.Never), Browsable(false)]
public int FooInt32 {
    get {return (int)Foo;}
    set {Foo = (MyEnum)value;}
} 
```

或者你可以使用`IXmlSerializable`，但这是很多工作。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-03T09:51:49.200

请参阅下面的完整示例控制台应用程序，了解使用 DataContractSerializer 实现您正在寻找的有趣方式：

```
using System;
using System.IO;
using System.Runtime.Serialization;

namespace ConsoleApplication1
{
    [DataContract(Namespace="petermcg.wordpress.com")]
    public class Request
    {
        [DataMember(EmitDefaultValue = false)]
        public RequestType request;
    }

    [DataContract(Namespace = "petermcg.wordpress.com")]
    public enum RequestType
    {
        [EnumMember(Value = "1")]
        Booking = 1,
        [EnumMember(Value = "2")]
        Confirmation = 2,
        [EnumMember(Value = "4")]
        PreBooking = 4,
        [EnumMember(Value = "5")]
        PreBookingConfirmation = 5,
        [EnumMember(Value = "6")]
        BookingStatus = 6
    }

    class Program
    {
        static void Main(string[] args)
        {
            DataContractSerializer serializer = new DataContractSerializer(typeof(Request));

            // Create Request object
            Request req = new Request();
            req.request = RequestType.Confirmation;

            // Serialize to File
            using (FileStream fileStream = new FileStream("request.txt", FileMode.Create))
            {
                serializer.WriteObject(fileStream, req);
            }

            // Reset for testing
            req = null;

            // Deserialize from File
            using (FileStream fileStream = new FileStream("request.txt", FileMode.Open))
            {
                req = serializer.ReadObject(fileStream) as Request;
            }

            // Writes True
            Console.WriteLine(req.request == RequestType.Confirmation);
        }
    }
} 
```

调用WriteObject后request.txt的内容如下：

```
<Request xmlns="petermcg.wordpress.com" xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
    <request>2</request>
</Request> 
```

您需要对 DataContractSerializer 的 System.Runtime.Serialization.dll 程序集的引用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-09-14T14:55:10.437

```
using System.Xml.Serialization;

public class Request
{    
    [XmlIgnore()]
    public RequestType request;

    public int RequestTypeValue
    {
      get 
      {
        return (int)request;
      } 
      set
      {
        request=(RequestType)value; 
      }
    }
}

public enum RequestType
{
    Booking = 1,
    Confirmation = 2,
    PreBooking = 4,
    PreBookingConfirmation = 5,
    BookingStatus = 6
} 
```

上述方法对我有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T09:05:03.130

看一下 System.Enum 类。Parse 方法将字符串或 int 表示形式转换为 Enum 对象，而 ToString 方法将 Enum 对象转换为可以序列化的字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-08T08:40:51.087

由于您正在为枚举选项分配显式的非顺序值，我假设您希望一次能够指定多个值（二进制标志），那么接受的答案是您唯一的选择。通过 PreBooking | PreBookingConfirmation 将有一个整数值 9 并且序列化程序将无法反序列化它，但是使用 shim 属性对其进行强制转换会很好。或者，也许您只是错过了 3 值 :)

# c# - 线程在 for 循环中休眠

> ID：506369
> 
> 赞同：1
> 
> 时间：2009-02-03T08:41:33.350
> 
> 标签：c#, .net, winforms, multithreading

我需要您的帮助才能使用此方法：

```
for (int i =0; i<dt.count; i++)
{
    process...
    sleep(3000);
}

int sleeptime=0;
private void timer2_Tick(object sender, EventArgs e)
{
    for (int i = 0; i &#60; mylist.Items.Count;)
    {
        listBox1.Items.Add(mylist.Items[i].Name.ToString() + "starting...");
        sleeptime = int.Parse(mylist.Items[i++].TimeSpan.ToString()) - timer2.Interval;
        System.Threading.Thread.Sleep(sleeptime);
    }
    timer1.Start();
    timer2.Stop();
} 
```

但我没有看到我的数据流像瀑布一样。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T08:58:55.657

您正在阻止 UI 线程 - 在您离开事件处理程序之前，通常不会显示任何更新。一个 hacky 方法是使用`Application.DoEvents()`，但这是懒惰的，并且有重新进入的风险，*尤其是*在您暂停时。

更好的方法是在后台线程上完成工作，并用于`Invoke`将数据推送到 UI（不要从工作线程与 UI 对话）。

或者只是在单独的刻度中添加单个项目？

`BackgroundWorker`这是一个用于工作的示例，`ReportProgress`用于将项目推送到 UI：

```
using System.ComponentModel;
using System.Threading;
using System.Windows.Forms;
static class Program
{
    static void Main()
    {
        // setup some form state
        Form form = new Form();
        ListView list = new ListView();
        list.View = View.List;
        BackgroundWorker worker = new BackgroundWorker();
        worker.WorkerReportsProgress = true;
        form.Controls.Add(list);
        list.Dock = DockStyle.Fill;
        // start the worker when the form loads
        form.Load += delegate {
            worker.RunWorkerAsync();
        };
        worker.DoWork += delegate
        {
            // this code happens on a background thread, so doesn't
            // block the UI while running - but shouldn't talk
            // directly to any controls
            for(int i = 0 ; i < 500 ; i++) {
                worker.ReportProgress(0, "Item " + i);
                Thread.Sleep(150);
            }
        };
        worker.ProgressChanged += delegate(object sender,
           ProgressChangedEventArgs args)
        {
            // this is invoked on the UI thread when we
            // call "ReportProgress" - allowing us to talk
            // to controls; we've passed the new info in
            // args.UserState
            list.Items.Add((string)args.UserState);
        };
        Application.Run(form);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-07T14:26:39.113

Or you can use instead System.Threading.Timer class. The timer's callback is executed on a thread from ThreadPool, not the UI thread. But than, you can't directly access any GUI controls, so you would have to use Invoke.

# c# - 如何修改 MS Dynamics AX 业务数据查找管理单元以选择要登录的公司？

> ID：506371
> 
> 赞同：0
> 
> 时间：2009-02-03T08:42:50.430
> 
> 标签：c#, dynamics-ax-2009

任何人都可以提供一些可以完成的编码（C#）修改或任何其他实用的方式吗？或者当然指出我已经做过的地方。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-18T11:32:15.233

我假设管理单元正在使用来自 Business Connector 的设置。在管理员控制面板中找到 Dynamics AX 配置实用程序，并将 Business Connector 指向您希望它连接的任何 AOS，然后尝试在那里填写所选公司。

# sql-server - 大型数据集是否需要存储过程？

> ID：506375
> 
> 赞同：5
> 
> 时间：2009-02-03T08:43:01.617
> 
> 标签：sql-server, database, database-design, stored-procedures, performance

我刚刚为一家规模合理、必须管理大量数据的公司开始了我的第一份开发工作。平均数据库为 6gb（据我目前所见）。其中一项工作是报告。目前的做法是——

数据被复制并传输到数据仓库。从那里，收集特定报告所需的所有数据（数千行和大量表）并聚合到仓库中的报告数据库中。这一切都是通过存储过程完成的。

当请求报告时，将调用存储过程，将数据复制到报告数据库中，PHP 从中读取数据以显示数据。

我根本不是存储过程的忠实粉丝。但与我交谈过的人坚持认为存储过程是唯一的选择，因为通过编程语言直接查询数据非常慢（想想 30 分钟？）。安全也是一个问题。

所以我的问题是——当你有一个非常大的数据集时是否需要存储过程？查询真的需要这么长时间处理如此大量的数据，还是数据库服务器或数据的排列方式（和索引？）存在问题。我有一种感觉，有些不对劲。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T09:00:46.587

使用存储过程背后的原因是，为执行您的过程而创建的执行计划由 SQL Server 缓存在称为计划缓存的内存区域中。当该过程随后在稍后时间重新运行时，执行计划有被重新使用的可能性。

存储过程的运行速度不会比作为一批 T-SQL 执行的相同查询快。正是执行计划的重用导致了性能的提高。实际 T-SQL 的查询成本将相同。

将数据卸载到报告数据库是一种典型的追求，但是您可能需要查看报告数据库上的索引策略，因为它可能需要与您的 OLTP 平台的索引策略完全不同。

您可能还希望考虑使用 SQL Server Analysis Services 来满足您的报告要求，因为听起来您的报告包含大量数据聚合。为快速计数和分析而存储和处理数据正是 SSAS 的全部意义所在。听起来您的企业是时候考虑构建数据仓库了。

我希望这会有所帮助，但请随时索取更多详细信息。

干杯，约翰

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-04T08:43:56.793

在您操作的环境中——在多个地方访问的大型企业数据库——实际上**总是**最好在数据库中放置尽可能多的业务逻辑。

在这种情况下，您的直接性能优势是：

1.  首先，因为如果 SP 涉及除简单选择之外的任何处理，则数据库中数据的处理可能比通过网络将行发送到您的程序进行处理要快几个数量级。
2.  您确实获得了一些好处，因为 SP 存储已编译。与 1 相比，这通常是微不足道的。如果处理大量

然而，在我看来，通常比性能更重要的是，企业数据库将逻辑封装在数据库本身中提供了主要的管理和维护优势：-

1.  数据结构可以从程序逻辑中抽象出来，允许更改数据库结构而不需要更改访问数据的程序。任何在进行简单的数据库更改之前花费数小时使用 [mytable] 为 SQL 查找公司代码库的人都会喜欢这一点。
2.  SP 可以提供安全层，尽管这可能会被过度使用和过度依赖。

您说这是您在拥有此类数据库的公司中的第一份工作，因此您可以原谅没有意识到以数据库为中心的数据处理方法在此类环境中的重要性。你也不孤单——在最近的播客中，Jeff Attwood 说他不喜欢将代码放入数据库。如果您正在处理为单个应用程序提供服务的数据库，这是一个很好且有效的意见，*但对于由多个应用程序在公司内使用的数据库是 100% 错误*的，最好的策略是用完整的补充限制和自由使用 SP 进行访问和更新。

这样做的原因是，如果你不这样做，这样的数据库总是会失去数据完整性并积累杂物。有时几乎无法想象它们是如何工作的，但在任何没有足够约束的大型企业数据库（数千万条记录）中，都会出现格式错误的记录——充其量只能强制定期清理数据（我经常使用的一项任务）作为初级程序员被抛弃），或者更糟糕的是会导致应用程序由于无效的输入而崩溃，或者更糟糕的是不会导致它们崩溃而是向最终用户提供不正确的业务信息。如果您的最终用户是您的财务总监，那么这就是您的工作:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T09:03:25.740

在我看来，根据您的描述，其中还有一个额外的步骤似乎是不必要的。这就是我所指的 -

> 当请求报告时，将调用一个存储过程，该过程将数据收集成报告所需的格式，然后转发到另一个将数据转换为视图的存储过程，并将其转发到 PHP 框架进行显示。

一个 sproc 将数据转换为报告，然后另一个 sproc 将此数据转换为另一种格式以用于前端呈现 - 数据是否曾经以它在第一个 sproc 之后的格式使用？如果不是，那这个阶段对我来说似乎是不必要的。

我假设您的报告数据库是一个数据仓库，并且该数据经过 ETL 处理并以某种格式存储在其中以用于报告目的。在我目前工作的地方，这是常见的做法。

至于您关于存储过程的问题，它们允许您在数据库中集中逻辑并“封装”安全性，考虑到您拥有用于数据转换的其他存储过程，第一个似乎对您的组织有益。存储过程也有一个存储的执行计划，在某些情况下，它可以提高性能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T14:28:49.390

我发现存储过程有助于处理大型数据集，因为它们消除了大量的网络流量，这可能是一个巨大的性能瓶颈，具体取决于数据集的实际大小。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T15:27:40.643

当处理大量行时，索引可用并且 SQL 相对调整，数据库引擎直接对数据执行基于集合的操作 - 例如通过 SQL - 几乎总是优于逐行处理（即使在同一服务器）在客户端工具中。数据不会跨越任何物理或逻辑边界离开数据库服务器进程或离开数据库服务器并通过网络传出。即使只有有限数量的数据真正需要离开服务器，即使在服务器上执行 RBAR（通过痛苦的行）也会比在客户端工具中执行更快，因为...

当您开始跨网络提取更多数据时，该过程将减慢并且限制每个阶段的行数成为下一个优化。

所有这些都与存储过程无关。存储过程（在 SQL Server 中）不再提供比批处理 SQL 更多的性能优势。存储过程确实提供了大量其他好处，例如模块化、封装、安全管理、合同设计、版本管理。然而，性能不再是优势。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T08:53:32.640

一般来说，存储过程比直接查询有很多优点。我无法评论您完整的端到端流程，但是，SP 可能会执行得更快。首先，每次执行直接查询时都需要编译直接查询并制定执行计划——SP 不需要。

还有其他原因，您为什么要使用存储过程 - 逻辑集中化、安全性等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T09:04:18.670

端到端过程确实看起来有点复杂，但可能有充分的理由，这仅仅是因为数据量 - 如果您在主数据库上运行报告，查询会减慢系统的其余部分如此之多，以至于您会给其他用户带来问题。

关于存储过程，它们在这种情况下的主要优势是它们是预编译的，并且数据库已经制定了它认为的最佳查询计划。尤其是对于您正在谈论的数据量，这很可能会带来非常显着的性能提升。

是的，根据报告的复杂性，这样的查询可能需要半小时或更长时间......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-03T10:01:53.033

这个报告解决方案似乎是由认为数据库是世界中心的人设计的。这是一个普遍而**有效**的观点——但我并不总是坚持它。

在表/数据库之间移动数据时，使用存储过程会快得多，因为数据不需要在数据库和应用程序之间传输。但是在大多数情况下，我宁愿不使用存储过程，因为它们使开发更加复杂，我自己也在 ORM 阵营。有时您可以通过将大量加载到 RAM 中并在那里进行处理来获得极大的加速，但是这是一种完全不同的编码方式，并且不允许重用已存储在存储过程中的逻辑。抱歉，我认为您在从事该工作时与存储过程堆叠在一起。

给出要移动的数据量，如果使用 SQL 服务器，我会考虑使用 SSIS 或 DTS——oracle 也会有类似的东西。SSIS 将在许多线程上进行数据转换，同时为您处理很多细节。

*请记住，软件的设计更多地与软件的历史和使用它的人有关，而不是与“正确的做事方式”有关。100年后回来，我们可能会写软件，目前大多是盲人带盲的情况。就像第一座桥建起来，很多桥倒塌一样，没有人能提前告诉你女巫桥会一直屹立不倒，为什么。*

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-03T15:19:21.660

与 ORM 产品的自动生成代码不同，存储过程可以进行性能调整。这在大型生产环境中至关重要。使用 ORM 时，有许多方法无法调整性能。此外，大型数据库执行的许多任务与用户界面无关，因此不应从那里生成的代码运行。

如果您想控制权限，则还需要存储过程，以便用户只能执行过程中指定的过程而不能做其他事情。否则，用户可以更容易地对数据库进行未经授权的更改并进行欺诈。这就是为什么使用大型关键业务系统的数据库人员除了通过存储过程之外不允许任何访问的原因之一。

如果您将大量数据移动到其他服务器，我会考虑使用 DTS（如果使用 SQL Server 2000）或 SSIS。这可能会进一步加快您的流程，但这在很大程度上取决于您在做什么以及如何做。

在这种情况下，sps 可能更快的事实并不排除索引可能是错误的或统计数据已过时，但通常管理大量数据的 dbas 往往非常了解这些东西。

确实，您描述的过程似乎有点令人费解，但是在没有看到正在发生的事情的结构和了解数据库和环境的情况下，我不能说这是否是最好的过程。

我可以告诉你，新员工进来并想要改变工作内容以适应他们自己的个人偏见往往不会被认真对待，当你确实需要提出有效的改变时，你的可信度就会很低。当您过去的经验不是使用相同大小或处理类型的数据库时，尤其如此。如果您是大型系统方面的专家，那么您可能从一开始就受到更认真的对待，但是，面对现实，您不是，因此您的意见不太可能影响任何人，直到您在那里待了一段时间并且他们对您有一定的了解真正的能力。另外，如果您按原样学习系统并按原样使用它，您将在六个月左右的时间内处于更好的位置，提出改进建议而不是更改。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T15:27:57.600

我也许可以想出更多，但有几点。

1.  假设一个现代数据库，由于缓存等原因，存储过程实际上可能不会比普通过程快得多。
2.  存储过程的安全优势有些被高估了。
3.  改变是邪恶的。一致性为王。

我想说#3 胜过所有其他问题，除非存储过程导致了合法问题。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-03T15:08:14.350

更快的报告方法是将所有数据读入内存（需要 64 位操作系统），然后遍历对象。这当然仅限于 ram 大小（负担得起的 32 GB），并报告您在哪里遇到了大部分 db。无需为小报告而努力。

在过去，我可以在 1.5 秒内运行一个查询超过 800 万个对象的报告。那是在 3GHz 奔腾 4 上大约 1 GB 的内存。64 位应该是慢两倍，但这可以通过更快的处理器来补偿。

# c# - MVC 批量编辑 - Linq to Sql 列表保存

> ID：506381
> 
> 赞同：7
> 
> 时间：2009-02-03T08:44:52.703
> 
> 标签：c#, asp.net-mvc, linq, linq-to-sql

为了让我了解一些使用 MVC 和 Linq to SQL 的基础知识，我正在对 Stephen Walther 的[TaskList 应用程序](http://www.asp.net/learn/mvc-videos/video-395.aspx)进行改编：

我正在使用[Steve Sanderson 的博客](http://blog.codeville.net/2008/12/22/editing-a-variable-length-list-of-items-in-aspnet-mvc/)中描述的概念添加批量编辑系统。

这一切都按预期工作，但是，我无法保存返回的任务列表。Post to my BulkEdit 循环遍历返回的列表并更新我的 LinqToSql db 任务列表中的每个项目。

我的 BulkEdit 视图继承`ViewPage<List<TaskList.Models.Task>>`如下：

```
<% 
using (Html.BeginForm())
{
%>
        <div id="items">

<%
            foreach (var task in ViewData.Model)
            {
                Html.RenderPartial(
                    "TaskEditor",
                    task,
                    new ViewDataDictionary(ViewData)
                            {
                                {"prefix", "tasks"}
                            }
                );
            }
%>

        </div>

        <input type="submit" value="Save changes" />

<%
    }
%> 
```

TaskEditor 控件继承`System.Web.Mvc.ViewUserControl<Models.Task>`并如下所示：

```
<div>
<%= Html.Hidden(ViewData["prefix"] + ".index", ViewData.Model.Id) %>

<% var fieldPrefix = string.Format("{0}[{1}].", ViewData["prefix"], ViewData.Model.Id); %>

<%= Html.Hidden(fieldPrefix + "Id", ViewData.Model.Id) %>
Description:
<%= Html.TextBox(fieldPrefix + "TaskDescription", ViewData.Model.TaskDescription)%>
Date:
<%= Html.TextBox(fieldPrefix + "EntryDate", ViewData.Model.EntryDate.ToString("o"))%>   
Completed:
<%= Html.CheckBox(fieldPrefix + "IsCompleted", ViewData.Model.IsCompleted)%>
</div> 
```

Controller 的 Get 和 Post 方法如下：

```
 [AcceptVerbs(HttpVerbs.Get)]
    public ActionResult BulkEdit()
    {
        var tasks = from t in db.Tasks orderby t.EntryDate descending select t;

        return View(tasks.ToList());
    }        

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult BulkEdit(IList<Task> tasks)
    {
        foreach(Task task in tasks)
        {
            foreach(Task dbTask in db.Tasks)
            {
                if (dbTask.Id == task.Id)
                {
                    dbTask.TaskDescription = task.TaskDescription;
                    dbTask.EntryDate = task.EntryDate;
                    dbTask.IsCompleted = task.IsCompleted;
                }
            }
        }

        db.SubmitChanges();

        return RedirectToAction("Index");
    } 
```

我的问题是，这似乎太复杂了，我还没有考虑从列表中添加或删除的任务。我更愿意做的是

```
db.Tasks = tasks; 
```

并让 Linq 尽其所能找出哪些已经改变，哪些是新的/旧的。

这可能吗？还是我这么快就对 Linq 期望过高了？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-04T09:26:06.350

您正在处理 LINQ to SQL 没有多层故事的事实。我认为这就是你要找的东西：

[http://blog.irm.se/blogs/eric/archive/2008/08/20/Go-Distributed-With-LINQ-to-SQL.aspx](http://blog.irm.se/blogs/eric/archive/2008/08/20/Go-Distributed-With-LINQ-to-SQL.aspx)

这家伙提出的 Merge 方法可以很容易地变成 DataContext 类的“扩展方法”，几乎就像它直接内置在 LINQ to SQL 中一样。我说几乎是因为您必须包含扩展方法所在的名称空间才能使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T12:34:12.880

我认为您应该考虑使用视图来实现您想要的。ObservebleCollection 集合来保存项目，然后您可以在列表中绑定到该集合的视图，您仍然需要处理添加和删除项目的情况，但您也可以选择 IBindingList 它将给您一个将更新数据库的 BindingListCollectionView，您需要做的就是调用视图 AddNew() CommitNew() 等等。

HTH，埃里克

# javascript - getElementsByTagName("*") 对性能有何影响？

> ID：506390
> 
> 赞同：2
> 
> 时间：2009-02-03T08:48:04.897
> 
> 标签：javascript, cross-browser

首先让我说我不是 JavaScript 开发人员，所以这个问题可能相当基本。

[`all`](http://msdn.microsoft.com/en-us/library/aa752281.aspx)在模拟我正在使用的 IE 的非标准属性时`getElementsByTagName("*")`，两种方法之间是否存在显着的性能差异？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T09:29:41.427

对于兴趣，您可能会发现 John Resig 的这个讲座很有趣。像您一样使用 dom 方法时，它与新用户和有经验的用户相关。

*   [http://ejohn.org/blog/the-dom-is-a-mess/](http://ejohn.org/blog/the-dom-is-a-mess/)

它讨论了许多浏览器中 dom 方法的许多可爱的警告。

其中之一是在 IE5 中不`getElementsByTagName(“*”)`返回**任何**元素，并且在 IE7 下使用 Objects +做[奇怪的事情](http://webbugtrack.blogspot.com/2007/09/bug-204-getelementsbytagname-doesnt.html)`getElementsByTagName("*")`，根据谈话，它是这样的：

```
 <a id="length"></a> 
```

表现得好像有人做过：

```
 var a = getElementsByTagName("a"); 
  a.length = ""; # This overrides the arrays length attribute :/ 
```

这样您就无法迭代数组。

我不知道哪些 javascript 库绕过了这个缺陷，但你真的应该使用一个来避免跨浏览器的麻烦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T08:52:37.290

本质上不应该有明显的性能影响，`document.all`无论如何使用是不可接受的。

然而，有一个问题是，*为什么*你会对收集每个元素的集合感兴趣？我想不出一个不能用另一种方式更好地处理的副手用例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T09:20:37.220

不是真正的性能影响，但值得注意：从 getElementsByTagName 返回的 nodeList 是**live**。如果您操作 DOM，列表也会更改以反映这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T17:26:13.977

不同的浏览器和不同版本的浏览器具有不同的性能特点。如果您正在操作大型 DOM，您应该在您关心的浏览器上进行基准测试。考虑人们发布的 Javascript 库[基准测试](http://blog.creonfx.com/javascript/dojo-vs-jquery-vs-mootools-vs-prototype-performance-comparison)。它们展示了不同浏览器的性能有多大差异。因此，如果不知道您使用的是什么浏览器，这个问题就无法真正回答。但是，您还应该警惕过度优化某些东西，这对于大多数机器上的大多数人来说可能实际上需要零时间。

# c - Win32 编程与现代专业人士的相关性如何？

> ID：506396
> 
> 赞同：33
> 
> 时间：2009-02-03T08:50:13.113
> 
> 标签：c, winapi

*作为 Charles Petzold 的书Code*和*The Annotated Turing*的忠实粉丝，我偶然发现了他的书*Programming Windows*，它教用 C 语言进行 Win32 编程。我是一名计算机科学大一学生，首先学习了 C，但我现在使用 C# 和 .NET 进行 Windows 编程，所以我想知道 Win32 是否仍然与专业的 Windows 程序相关。作为一个想要编写 Windows 应用程序的学生，我是否值得将 Win32 API 学习到本书所涵盖的深度？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-03T08:57:31.447

这实际上取决于您要开发的应用程序类型。对于当今的大多数用途，C# 和 .NET 完全适合。但是，某些类型的应用程序需要尽可能少的依赖项（想到 shell 扩展），这对于 .NET 应用程序来说是不切实际的。对于那些你需要Win32的人。

与往常一样，即使您的大部分工作都使用 .NET，至少对 Win32 有基本的了解也是值得的。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-02-03T08:57:49.683

我完全同意 Joel Spolsky 在他的许多伟大[文章](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)之一中所写的内容。我认为了解机器的低层不仅能够编写高质量的代码而且能够解决不可避免地出现的问题，这一点至关重要。

所以，是的，重要的是至少了解 WIN32 API 的基础知识可能不是深入，但至少要知道它在那里，在你将编码的所有内容的基础上。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-03T09:20:30.557

如果您在 Windows 上编写 C#，这非常重要。并非 Win32 的所有功能都通过 .Net 库公开。一个具体的例子是我在这里描述的 WM_SETREDRAW 消息技术：[WM_SETREDRAW](https://stackoverflow.com/questions/487661/how-do-i-suspend-painting-for-a-control-and-its-children/487757#487757)。在其他时候也需要控制焦点问题。

此外，了解 Win32 和 Windows 的工作方式将使您更好地了解 C#/.Net 的各个方面，例如：

*   Control.Invoke() 实际上做了什么？
*   Control.BeginInvoke 和 Control.Invoke 有什么区别？
*   实际上是什么导致我的控件的事件触发，例如 OnClick 等，我该如何调试它。

也就是说，WPF 改变了这一切，如果您只编写 .Net 3/3.5 代码，那么我的论点就失去了一些相关性。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-03T08:54:27.990

在我看来，没有。我很久以前就学会了，所以你不必！

我认为您首先学习 C 很棒，而且我会时不时地继续编写 C 程序，但我不明白为什么 win32 API 会有用。老实说，这是一个很大的混乱。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-03T12:50:12.427

我认为学习基础知识很重要。如果你学会了显示一个带有一些字段、一些按钮和一个菜单的窗口。也许在一个单独的窗口中画一些东西。它将帮助您了解 Windows 如何真正工作的基础知识。我相信理解消息循环并认识到你所看到的几乎所有东西都是一个窗口是每个人都应该知道的基本知识。当我第一次意识到按钮是它自己的窗口时，我真的睁大了眼睛。然后它可以帮助您了解可以通过发送这些 Windows 消息来打开和关闭事物的功能。[子类化](http://dotnet.sys-con.com/node/39039)窗口让您可以访问在 .NET 或 VB Classic 中未向您公开的功能，并让您增强窗口的功能。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-03T09:05:00.900

一定要学习 AlexDrenea 提到的基础知识。同时 .NET 保护您免受许多 Win32 API 调用的影响。Win32 API 是如此庞大，您一定会遇到 .NET 没有为您包装它的情况。

[ListViewColumns 上](https://stackoverflow.com/questions/254129/how-to-i-display-a-sort-arrow-in-the-header-of-a-list-view-column-using-c)的现实生活常见情况排序箭头

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-03T09:03:03.353

我真的不认为“学习 Win32 API”对任何人来说都是现实的。API（是的，不止一个）非常庞大，您几乎不需要详细了解所有这些 API。我建议阅读一些基础知识（即窗口创建、窗口消息传递、窗口过程，可能还有一些 GDI 等），并在需要时使用 MSDN 查找其余部分。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-03T09:13:00.993

根据 Greg 的评论，它在某种程度上取决于域。我做了很多 Windows CE / 移动编程，其中 .NET 对于许多设备来说过于庞大，而 MFC 等其他框架还没有完全实现。在这种情况下，Win32 的大部分内容仍然非常重要。

也就是说，我不会提前全部学习，我会简单地了解基础知识，并在需要时挖掘其余部分。那里的文档和示例对于这种方法来说已经足够好了，像这样的社区提供的在线帮助也是如此。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-03T08:59:04.190

除非您需要一些 .NET Framework 中没有的功能（例如获取有关打印机驱动程序的详细信息），否则不需要。这大约是您将要做的事情的 99%（当然，这是我刚刚编造的一个任意值）。

即使你使用的是 Win32 而不是 .NET，真的有必要像本书一样深入学习吗？浏览这些部分，了解如果您将来遇到一些问题，您知道在哪里寻找它。然后停下来。当您需要它或有空闲时间时深入了解它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-03T09:38:46.307

我认为它已经得到了解答，但是如果您在 .NET 中进行 .NET 2.0 开发或任何 winforms，您肯定会遇到很多关于框架的某些部分如何包装 win32 和 mfc 的问题，您需要深入研究以实际使东西按预期工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-03T11:16:56.360

如果您正在尝试解决业务问题，那么有比 C 更好的工具来编程 Win32 系统。号角。德尔福。其他人我毫不怀疑。

但我想要*了解事情是如何工作*的，你对 C 是有利的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-03T08:55:52.493

有些东西如果没有 win api 调用就无法完成，但是随着 .net 的每个版本，这些东西变得越来越少，所以不，如果我在哪里，我不会学习 win api。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-03T09:02:47.677

您必须知道它的存在，因为更“高级”托管语言的大多数本机函数最终都会调用它们。

此外，它可以封装在[Autoit](http://en.wikipedia.org/wiki/AutoIt)等脚本语言中[`DllCall`](http://www.autoitscript.com/forum/index.php?showtopic=7072)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-04T11:25:28.527

我仍然使用它来赚取我的一部分钱。我们确实有一个基于 WinAPI 的 C IDE。它现在已经存在了 15 年左右，并且仍在运行；-)。它的完整下载量约为 5 MB，因为您在 .NET 世界中什么也得不到。所以对我们来说它仍然是一件有价值的事情......

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-03T11:12:29.270

这已经在专业 Win32 api 新闻组（news://comp.os.ms-windows.programmer.win32）上讨论过很多次

（由世界上最伟大的大师和畅销书作者（Petzold、Russinovich 等）...）

# visual-studio - 有没有办法解锁被另一个用户锁定的文件，而无需使用他们的帐户登录 VSTFS 2008？

> ID：506423
> 
> 赞同：3
> 
> 时间：2009-02-03T09:00:51.313
> 
> 标签：visual-studio, visual-studio-2008, tfs

我需要更改被另一个无法访问的用户锁定的文件。如何在不使用 Visual Studio 2008 TFS 中的帐户登录的情况下解锁文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T09:52:28.527

是的，尽管您需要熟悉 Team Foundation Server 命令行 tf.exe。

请参阅我不久前在此处发布的帖子[http://www.woodwardweb.com/vsts/unlocking_files.html](http://www.woodwardweb.com/vsts/unlocking_files.html)

自从我写了那篇文章（2005 年 10 月）以来，对于那些不想学习新命令行的麻烦的人来说，已经出现了一些替代方案。

您可以在 Visual Studio 2008 SP1 之上安装[TFS 2008 Power Tools](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx) ，并且您可以从 Visual Studio 的 UI 中执行其中的一些操作（右键单击 Power Tools 安装的 Team Members 节点中的 Developer，然后选择“Show待更改”，然后“撤消...”

或者，安装 Atrice 的优秀（免费）[TFS Sidekicks](http://www.attrice.info/cm/tfs/)。

祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T09:07:24.717

如果您有相关权限这样做，是的。[这里](http://weblogs.asp.net/dmckinstry/archive/2006/07/09/Undo-_2F00_-Unlock-for-Others-with-Team-Foundation-Version-Control.aspx)有一篇很好的博客文章。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T09:57:15.833

是的，你可以，但你需要特权。请参阅这篇文章：http: [//blogs.msdn.com/sayanghosh/archive/2007/11/08/howto-undo-another-users-check-out-as-a-tfs-admin.aspx](http://blogs.msdn.com/sayanghosh/archive/2007/11/08/howto-undo-another-users-check-out-as-a-tfs-admin.aspx)

# c++ - 参考变量

> ID：506424
> 
> 赞同：4
> 
> 时间：2009-02-03T09:01:05.400
> 
> 标签：c++

在某些文本中，我们不能将常量值分配给引用变量。当我执行这样的程序时，我可以做到。是否有任何条件我们不能将常量值分配给引用变量？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T09:09:59.097

您可以初始化对常量值的常量引用。

```
const int &i = 12; 
```

如果引用不是 const，则会出现编译器错误。

```
int &i = 12; //compiler error 
```

常量值（例如文字）（大部分时间）存储在内存的只读段中。因此，您不能使用非常量引用来引用它们，因为这意味着您可以修改它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T09:09:37.227

您不能将常量值分配给非常量引用，就像您不能将常量值的地址分配给指向非常量值的指针一样。

至少，不是没有 const_cast。

**编辑：**如果您实际上指的是文字值，那么 Luc 的答案是更好的答案。我指的是 const 变量，而不是文字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T20:18:14.857

对于“初始化”和“赋值”之间的区别，您可能会有些困惑。这些在 C++ 中是不同的，理解差异对于理解语言至关重要。忽略参考：

```
int x = 1;    // initialisation
x = 1;        // assignment 
```

只能初始化引用

```
int & r = x;  // initialisation
r = 2;        // assigns 2 to x _not_ to r 
```

没有办法重新初始化引用。

关于您的问题，就 const 而言，您*可以*使用 const 值初始化 const 引用：

```
const int & r2 = 42; 
```

# c# - UrlRewriter+HttpModule+Session问题

> ID：506431
> 
> 赞同：3
> 
> 时间：2009-02-03T09:04:23.290
> 
> 标签：c#, asp.net

我需要使用 HttpModule 编写一个自定义的“UrlRewriter”，在“重写”的那一刻，我需要访问 Session 并遵循另一个 SO 线程的建议：

[我可以从 HTTPModule 访问会话状态吗？](https://stackoverflow.com/questions/276355/can-i-access-session-state-from-an-httpmodule)

一切正常，除了 RewritePath/Redirect 部分。我没有任何异常，但浏览器需要永远加载。这真的是构建这样的 urlrewriter 的最佳方法吗？

```
using System;
using System.Web;
using System.Web.SessionState;
using System.Diagnostics;

namespace MyCompany.Campaigns
{

    public class CampaignRewriteModule : IHttpModule
    {
        public void Init(HttpApplication application)
        {
            application.PostAcquireRequestState += new EventHandler(Application_PostAcquireRequestState);
            application.PostMapRequestHandler += new EventHandler(Application_PostMapRequestHandler);
        }

        void Application_PostMapRequestHandler(object source, EventArgs e)
        {
            HttpApplication app = (HttpApplication)source;

            if (app.Context.Handler is IReadOnlySessionState || app.Context.Handler is IRequiresSessionState)
            {
                return;
            }

            app.Context.Handler = new MyHttpHandler(app.Context.Handler);
        }

        void Application_PostAcquireRequestState(object source, EventArgs e)
        {
            HttpApplication app = (HttpApplication)source;

            MyHttpHandler resourceHttpHandler = HttpContext.Current.Handler as MyHttpHandler;

            if (resourceHttpHandler != null)
            {
                HttpContext.Current.Handler = resourceHttpHandler.OriginalHandler;
            }

            Debug.Assert(app.Session != null);

            string path = HttpUtils.Path();

            if (!CampaignCodeMethods.IsValidCampaignCode(path)) return;

            string domain = HttpUtils.Domain();

            CampaignCode code = CampaignManager.RegisterCode(path, domain.Equals(Config.Instance.Domain.ToLower()) ? null : domain);

            if (code != null)
            {
               //app.Context.RewritePath(code.CampaignCodePath.Path, false);
               app.Context.Response.Redirect(code.CampaignCodePath.Path, true);
            }

        }

        public void Dispose() { }

        public class MyHttpHandler : IHttpHandler, IRequiresSessionState
        {
            internal readonly IHttpHandler OriginalHandler;

            public MyHttpHandler(IHttpHandler originalHandler)
            {
                OriginalHandler = originalHandler;
            }

            public void ProcessRequest(HttpContext context)
            {
                throw new InvalidOperationException("MyHttpHandler cannot process requests.");
            }

            public bool IsReusable
            {
                get { return false; }
            }
        }

    }

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T08:40:02.597

I think I know what it is. Your module is executed on ALL requests and assigns a handler that throws an error unless there is a valid campaign code (where a rewrite/redirect occurs).

But because this is not just for your "handler campaign code" url it is causing an error to be thrown, which is causing you to be redirected to your error page, which is being caught by the module, which is assigning the handler, which is throwing an error, which is redirecting... I think you get where I'm going ;)

Otherwise I'd try a few things:

*   Setup Fiddler and check for an infinite redirect loop
*   Put a breakpoint on app.Context.Response.Redirect - make sure your not in an infinite loop
*   Put a breakpoint on MyHttpHandler.ProcessRequest - make sure it's not being called and the exception swallowed

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T08:28:14.110

I wrote a simple URL rewriter module that did something similar. The url rewriting is done in BeginRequest by comparing the requested url to a list of known urls. If we find a mach we use HttpContext.RewritePath to change the requested url.

This appears to work well with no serious side effects.

I notice that you use Response.Redirect instead of Context.RewritePath. Using Redirect will cause the users browser to request a new page with the new url. Is this really what you want? The user will then see the new url in his browser. If this really is what you want you could use an alternative approach where you use a custom 404 page not found error handler to redirect the user to the appropriate page.

If you set up IIS to redirect all 404 errors to a new page, say Custom404.aspx, that you have set up. In this page you can check the requested url to see if the url should be rewritten. If it should you can simply set the Response.Status to "301 Moved Permanently" and write a header with the name "Location" and the new url as the value. If the url should not be rewritten you can just output the standard 404 page not found error.

This last approach works well, but as with your Response.Redirect approach the user will see the new url in his browser. Using Context.RewritePath allows you to serve a different page than the one requested.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T20:06:15.587

Is your URL rewriter handling requests that aren't for an actual page? If they are, then I don't think you can access Session... the last URL rewriter that I had written was there to handle 404 errors, and I remember digging around and finding (somewhere, can't remember where) that you don't get access to Session if that request is not for an actual .aspx page.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T15:48:20.167

我在想问题可能出在这个块内：

```
if (code != null)
{
    //app.Context.RewritePath(code.CampaignCodePath.Path, false);
    app.Context.Response.Redirect(code.CampaignCodePath.Path, true);
} 
```

尝试在语句中放置一个断点，`if`看看是否不断被命中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T19:51:24.460

I think there should be a call to 'return' after you reset it to the original handler, else you will continually rewrite the path.

Thinking about it, that's probably why the page is loading forever! :)

# sql - 级联软删除

> ID：506432
> 
> 赞同：34
> 
> 时间：2009-02-03T09:04:34.630
> 
> 标签：sql, soft-delete

SQL 一直有一个很棒的特性：级联删除。你提前计划好，什么时候删除，BAM！无需担心所有这些依赖记录。

然而，现在实际上删除任何东西几乎是禁忌。您将其标记为已删除并停止显示。不幸的是，当存在依赖记录时，我无法找到可靠的解决方案。我总是手动编写复杂的软删除网络。

有没有我完全错过的更好的解决方案？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2018-10-29T13:17:35.790

我最近提出了一个使用 Postgres 9.6 级联软删除的解决方案，它利用继承将条目划分为已删除和未删除的条目。这是我为我们的项目编写的文档的副本：

* * *

# 级联软删除

## 抽象的

在本文档中，我描述了我们当前处理 Postgres 数据库中对象删除的方法，并介绍了当前实现的缺陷。例如，到目前为止，我们还没有级联软删除的能力。然后我展示了一种方法，它结合了 Postgres**级联硬删除**的优势和易于实施、维护的归档方法，并在所有搜索查询中带来了性能提升。

## 关于 GORM 中的软删除

在用 Go 编写的[fabric8-services/fabric8-wit](https://github.com/fabric8-services/fabric8-wit)项目中，我们为我们的数据库使用了一个面向对象的映射器，称为[GORM](http://gorm.io/)。

GORM 提供了一种[软删除](http://gorm.io/docs/delete.html#Soft-Delete)数据库条目的方法：

> 如果模型有`DeletedAt`字段，它会自动获得软删除能力！那么它不会在调用时从数据库中永久删除`Delete`，而只会将 field`DeletedAt`的值设置为当前时间。

假设你有一个模型定义，也就是一个看起来像这样的 Go 结构：

```
// User is the Go model for a user entry in the database
type User struct {
    ID        int
    Name      string
DeletedAt *time.Time
} 
```

假设您已将现有用户条目`ID`从数据库加载到 object`u`中。

```
id := 123
u := User{}
db.Where("id=?", id).First(&u) 
```

如果您继续使用 GORM 删除对象：

```
db.Delete(&u) 
```

在 SQL 中不会删除数据库条目`DELETE`，但将更新行并将其`deleted_at`设置为当前时间：

```
UPDATE users SET deleted_at="2018-10-12 11:24" WHERE id = 123; 
```

## GORM 中的软删除问题 - 依赖反转和无级联

上面提到的软删除非常适合归档单个记录，但对于依赖它的所有记录，它可能会导致非常奇怪的结果。这是因为 GORM 的软删除不会像`DELETE`使用`ON DELETE CASCADE`.

当您为数据库建模时，您通常会设计一个表，然后可能是另一个与第一个具有外键的表：

```
CREATE TABLE countries (
    name text PRIMARY KEY,
    deleted_at timestamp
);

CREATE TABLE cities (
    name text,
    country text REFERENCES countries(name) ON DELETE CASCADE,
    deleted_at timestamp
); 
```

在这里，我们模拟了引用特定国家/地区的国家和城市列表。当您`DELETE`创建国家/地区记录时，所有城市也将被删除。但是由于该表有一个`deleted_at`在国家或城市的 Go 结构中进行的列，因此 GORM 映射器只会软删除该国家而使所属城市保持不变。

### 将责任从数据库转移到用户/开发人员

因此，GORM 将它交给开发人员来（软）删除所有依赖城市。换句话说，以前被建模为**城市与国家**的关系现在被颠倒为**国家与城市**的关系。这是因为用户/开发人员现在负责（软）删除属于一个国家/地区的所有城市，当该国家/地区被删除时。

## 提议

如果我们可以进行软删除和 a 的所有好处，那不是很好`ON DELETE CASCADE`吗？

事实证明，我们可以毫不费力地拥有它。现在让我们关注单个表，即`countries`表。

### 存档表

假设一秒钟，我们可以有另一个名为的表，它与表`countries_archive`具有**完全相同的结构**`countries`。还假设完成的所有未来**模式迁移**都`countries`应用于`countries_archive`表。唯一的例外是**唯一约束**和**外键**不会应用于`countries_archive`.

我想，这听起来好得令人难以置信，对吧？好吧，我们可以使用Postgres 中的[继承来创建这样一个表：](https://www.postgresql.org/docs/9.6/static/ddl-inherit.html)

```
CREATE TABLE countries_archive () INHERITS (countries); 
```

结果`countries_archive`表将用于存储所有记录`deleted_at IS NOT NULL`。

请注意，在我们的 Go 代码中，我们永远不会直接使用任何`_archive`表。相反，我们会查询`*_archive`表继承的原始表，然后 Postgres 会神奇地`*_archive`自动查看表。下面我解释一下为什么会这样；它与分区有关。

### 在（软）-DELETE 上将条目移动到存档表

由于这两个表，`countries`并且在模式上`countries_archive`看起来完全一样，我们可以`INSERT`很容易地使用触发器函数进入存档

1.  发生`DELETE`在`countries`桌子上
2.  `deleted_at`或者当通过设置为非`NULL`值来进行软删除时。

触发函数如下所示：

```
CREATE OR REPLACE FUNCTION archive_record()
RETURNS TRIGGER AS $$
BEGIN
    -- When a soft-delete happens...
    IF (TG_OP = 'UPDATE' AND NEW.deleted_at IS NOT NULL) THEN
        EXECUTE format('DELETE FROM %I.%I WHERE id = $1', TG_TABLE_SCHEMA, TG_TABLE_NAME) USING OLD.id;
        RETURN OLD;
    END IF;
    -- When a hard-DELETE or a cascaded delete happens
    IF (TG_OP = 'DELETE') THEN
        -- Set the time when the deletion happens
        IF (OLD.deleted_at IS NULL) THEN
            OLD.deleted_at := now();
        END IF;
        EXECUTE format('INSERT INTO %I.%I SELECT $1.*'
                    , TG_TABLE_SCHEMA, TG_TABLE_NAME || '_archive')
        USING OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql; 
```

要使用触发器连接函数，我们可以编写：

```
CREATE TRIGGER soft_delete_countries
    AFTER
        -- this is what is triggered by GORM
        UPDATE OF deleted_at 
        -- this is what is triggered by a cascaded DELETE or a direct hard-DELETE
        OR DELETE
    ON countries
    FOR EACH ROW
    EXECUTE PROCEDURE archive_record(); 
```

## 结论

最初 postgres 中的继承功能是为了[分区数据](https://www.postgresql.org/docs/9.1/static/ddl-partitioning.html)而开发的。当您使用特定的列或条件搜索分区数据时，Postgres 可以找出要搜索的分区，从而[提高查询的性能](https://stackoverflow.com/a/3075248/835098)。

除非另有说明，否则我们可以通过仅搜索存在的实体来从这种性能改进中受益。存在的条目是那些`deleted_at IS NULL`成立的条目。（注意，如果GORM 的模型结构中有 a ，GORM 会自动`AND deleted_at IS NULL`为每个查询添加一个。）`DeletedAt`

让我们看看 Postgres 是否已经知道如何通过运行以下命令来利用我们的分离`EXPLAIN`：

```
EXPLAIN SELECT * FROM countries WHERE deleted_at IS NULL;
+-------------------------------------------------------------------------+
| QUERY PLAN                                                              |
|-------------------------------------------------------------------------|
| Append  (cost=0.00..21.30 rows=7 width=44)                              |
|   ->  Seq Scan on countries  (cost=0.00..0.00 rows=1 width=44)          |
|         Filter: (deleted_at IS NULL)                                    |
|   ->  Seq Scan on countries_archive  (cost=0.00..21.30 rows=6 width=44) |
|         Filter: (deleted_at IS NULL)                                    |
+-------------------------------------------------------------------------+ 
```

正如我们所见，Postgres 仍然搜索两个表，`countries`并且`countries_archive`. 让我们看看当我们`countries_archive`在创建表时向表添加检查约束时会发生什么：

```
CREATE TABLE countries_archive (
    CHECK (deleted_at IS NOT NULL)
) INHERITS (countries); 
```

现在，Postgres 知道它可以跳过预期的`countries_archive`时间：`deleted_at``NULL`

```
EXPLAIN SELECT * FROM countries WHERE deleted_at IS NULL;
+----------------------------------------------------------------+
| QUERY PLAN                                                     |
|----------------------------------------------------------------|
| Append  (cost=0.00..0.00 rows=1 width=44)                      |
|   ->  Seq Scan on countries  (cost=0.00..0.00 rows=1 width=44) |
|         Filter: (deleted_at IS NULL)                           |
+----------------------------------------------------------------+ 
```

`countries_archive`注意前面提到的表中没有顺序扫描`EXPLAIN`。

## 好处和风险

### 好处

1.  我们有常规的**级联删除**，可以让数据库找出删除的顺序。
2.  同时，我们也在**归档我们的数据**。每个软删除
3.  **无需更改 Go 代码**。我们只需要为每个要归档的表设置一个表和一个触发器。
4.  每当我们认为我们不再希望这种带有触发器和级联软删除的行为时，**我们都可以轻松返回**。
5.  对原始表进行的所有未来**模式迁移**也将应用于`_archive`该表的版本。除了约束，这很好。

### 风险

1.  假设您添加一个新表，该表引用另一个现有表，其外键具有`ON DELETE CASCADE`. 如果现有表使用上面的函数，当现有表中的某些内容被软删除时`archive_record()`，您的新表将收到 hard 。如果您也使用新的从属表，`DELETE`这不是问题。`archive_record()`但你只需要记住它。

## 最后的想法

此处介绍的方法不能解决恢复单个行的问题。另一方面，这种方法并没有使它变得更难或更复杂。它只是仍未解决。

在我们的应用程序中，工作项的某些字段没有指定外键。一个很好的例子是区域 ID。这意味着当区域为`DELETE`d 时，关联的工作项不会自动为`DELETE`d。当一个区域被自己移除时，有两种情况：

1.  直接向用户请求删除。
2.  用户请求删除一个空间，然后该区域由于其对空间的外键约束而被删除。

请注意，在第一个场景中，用户的请求通过区域控制器代码，然后通过区域存储库代码。我们有机会在任何这些层中修改所有引用不存在区域的工作项。在第二种情况下，与该区域相关的所有事情都会发生并保留在 DB 层上，因此我们没有机会修改工作项。好消息是我们不必这样做。每个工作项都引用一个空间，因此当空间消失时无论如何都会被删除。

适用于区域的内容也适用于迭代、标签和板列。

# 如何申请到我们的数据库？

脚步

1.  为继承原始表的所有表创建“*_archived”表。
2.  `archive_record()`使用上述功能安装软删除触发器。
3.  通过执行将触发该功能的硬操作将所有条目移动`deleted_at IS NOT NULL`到各自的表中。`_archive``DELETE``archive_record()`

# 例子

这是一个[完整的工作示例](https://rextester.com/BMCB94324)，我们在其中演示了对两个表的级联软删除，`countries`并且`capitals`. 我们展示了如何独立于为删除选择的方法归档记录。

```
CREATE TABLE countries (
    id int primary key,
    name text unique,
    deleted_at timestamp
);
CREATE TABLE countries_archive (
    CHECK ( deleted_at IS NOT NULL )
) INHERITS(countries);

CREATE TABLE capitals (
    id int primary key,
    name text,
    country_id int references countries(id) on delete cascade,
    deleted_at timestamp
);
CREATE TABLE capitals_archive (
    CHECK ( deleted_at IS NOT NULL )
) INHERITS(capitals);

CREATE OR REPLACE FUNCTION archive_record()
RETURNS TRIGGER AS $$
BEGIN
    IF (TG_OP = 'UPDATE' AND NEW.deleted_at IS NOT NULL) THEN
        EXECUTE format('DELETE FROM %I.%I WHERE id = $1', TG_TABLE_SCHEMA, TG_TABLE_NAME) USING OLD.id;
        RETURN OLD;
    END IF;
    IF (TG_OP = 'DELETE') THEN
        IF (OLD.deleted_at IS NULL) THEN
            OLD.deleted_at := now();
        END IF;
        EXECUTE format('INSERT INTO %I.%I SELECT $1.*'
                    , TG_TABLE_SCHEMA, TG_TABLE_NAME || '_archive')
        USING OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER soft_delete_countries
    AFTER
        UPDATE OF deleted_at 
        OR DELETE
    ON countries
    FOR EACH ROW
    EXECUTE PROCEDURE archive_record();

CREATE TRIGGER soft_delete_capitals
    AFTER
        UPDATE OF deleted_at 
        OR DELETE
    ON capitals
    FOR EACH ROW
    EXECUTE PROCEDURE archive_record();

INSERT INTO countries (id, name) VALUES (1, 'France');
INSERT INTO countries (id, name) VALUES (2, 'India');
INSERT INTO capitals VALUES (1, 'Paris', 1);
INSERT INTO capitals VALUES (2, 'Bengaluru', 2);

SELECT 'BEFORE countries' as "info", * FROM ONLY countries;
SELECT 'BEFORE countries_archive' as "info", * FROM countries_archive;
SELECT 'BEFORE capitals' as "info", * FROM ONLY capitals;
SELECT 'BEFORE capitals_archive' as "info", * FROM capitals_archive;

-- Delete one country via hard-DELETE and one via soft-delete
DELETE FROM countries WHERE id = 1;
UPDATE countries SET deleted_at = '2018-12-01' WHERE id = 2;

SELECT 'AFTER countries' as "info", * FROM ONLY countries;
SELECT 'AFTER countries_archive' as "info", * FROM countries_archive;
SELECT 'AFTER capitals' as "info", * FROM ONLY capitals;
SELECT 'AFTER capitals_archive' as "info", * FROM capitals_archive; 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-03T09:08:46.323

我不想这么说，但触发器是专门为这种事情设计的。

（讨厌的部分是因为好的触发器很难编写，当然也不能调试）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T09:12:59.947

外键约束可以进行级联更新。如果您在键和删除标志上链接您的表，那么当主表中的删除标志更改时，该更改将向下传播到详细表。我没有尝试过，但它应该可以工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T09:13:29.103

我认为软删除的一个好处通常是不是每个表都有一个软删除标志，所以需要级联的东西很少。这些行在数据库中只是未使用，但不是孤立的 - 它们仅由已删除的行引用。

但是，就像所有事情一样，这取决于您的模型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T09:09:49.423

不确定您在谈论什么后端，但您可以了解您的“删除标志”更改并使用触发器将更改向下级联。

# c++ - 保持 GUI 独立

> ID：506441
> 
> 赞同：5
> 
> 时间：2009-02-03T09:09:35.977
> 
> 标签：c++, user-interface, signals-slots

我有一个程序（除其他外）有一个命令行界面，允许用户输入字符串，然后将通过网络发送。问题是我不确定如何将在 GUI 深处生成的事件连接到网络接口。例如，假设我的 GUI 类层次结构如下所示：

GUI -> MainWindow -> CommandLineInterface -> EntryField

每个 GUI 对象都包含其他一些 GUI 对象，并且一切都是私有的。现在 entryField 对象生成一个事件/信号，表明已输入了一条消息。目前我将信号向上传递到类层次结构中，因此 CLI 类看起来像这样：

```
public:
    sig::csignal<void, string> msgEntered; 
```

在 c'tor 中：

```
entryField.msgEntered.connect(sigc::mem_fun(this, &CLI::passUp)); 
```

passUp 函数只是再次发出信号让所属类（MainWindow）连接到，直到我终于可以在主循环中执行此操作：

```
gui.msgEntered.connect(sigc::mem_fun(networkInterface, &NetworkInterface::sendMSG)); 
```

现在这似乎是一个非常糟糕的解决方案。每次我向 GUI 添加一些东西时，我都必须通过类层次结构将它连接起来。我确实看到了几种解决方法。我可以公开所有对象，这样我就可以在主循环中执行此操作：

```
gui.mainWindow.cli.entryField.msgEntered.connect(sigc::mem_fun(networkInterface, &NetworkInterface::sendMSG)); 
```

但这会违背封装的想法。我还可以在整个 GUI 中传递对网络接口的引用，但我希望 GUI 代码尽可能独立。

感觉就像我在这里遗漏了一些重要的东西。有没有一种干净的方法可以做到这一点？

**注意：**我正在使用 GTK+/gtkmm/LibSigC++，但我没有这样标记它，因为我在 Qt 上遇到了几乎相同的问题。这真的是一个普遍的问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T09:25:48.080

根本问题是您将 GUI 视为一个单一的应用程序，只有 gui 通过比平常更大的线连接到逻辑的其余部分。

您需要重新考虑 GUI 与后端服务器交互的方式。一般来说，这意味着您的 GUI 成为一个独立的应用程序*，它几乎什么都不做*，并且与服务器对话，而 GUI 内部（即您的信号和事件）与服务器的处理逻辑之间没有任何直接耦合。即，当您单击一个按钮时，您可能希望它执行一些操作，在这种情况下您需要调用服务器，但几乎所有其他事件只需要更改 GUI 内的状态而不对服务器执行任何操作 - 直到你准备好了，或者用户想要一些响应，或者你有足够的空闲时间在后台拨打电话。

诀窍是为服务器定义一个完全独立于 GUI 的接口。您应该能够稍后更改 GUI，而无需修改服务器。

这意味着您将无法自动发送事件，您需要手动连接它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T09:17:58.893

试试[观察者](http://en.wikipedia.org/wiki/Observer_pattern)设计模式。链接包括截至目前的示例代码。

您缺少的基本内容是，如果该引用被转换为您的对象实现的接口（抽象类），您可以在不违反封装的情况下传递引用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T09:17:19.910

由于这是一个普遍的问题，即使我“只是”一名 Java 程序员，我也会尝试回答它。:)

我更喜欢在我的程序的两边都使用接口（抽象类或 C++ 中的任何相应机制）。一方面是包含业务逻辑的程序核心。它可以生成例如 GUI 类可以接收的事件，例如（对于您的示例）“stringReceived”。另一方面，核心实现了一个“UI listener”接口，其中包含“stringEntered”等方法。

这样，UI 就与业务逻辑完全解耦了。通过实现适当的接口，您甚至可以在核心和 UI 之间引入网络层。

[编辑] 在我的应用程序的入门类中，几乎总是有这样的代码：

```
Core core = new Core(); /* Core implements GUIListener */
GUI gui = new GUI(); /* GUI implements CoreListener */
core.addCoreListener(gui);
gui.addGUIListener(core); 
```

[/编辑]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T09:34:25.460

如果没有一些全球发布/订阅中心，您将无法避免在层次结构中向上或向下传递一些东西。即使您将侦听器抽象为通用接口或控制器，您仍然必须以某种方式将控制器附加到 UI 事件。

使用 pub/sub 集线器，您可以添加另一层间接，但仍然存在重复 - entryField 仍然显示“发布消息就绪事件”，侦听器/控制器/网络接口显示“侦听消息就绪事件”，所以有一个共同点双方都需要知道的事件 ID，如果您不打算在两个地方对其进行硬编码，则需要将其传递到两个文件中（尽管作为全局，它不会作为参数传递；这本身就是' t 任何巨大的优势）。

我已经使用了所有四种方法 - 直接耦合、控制器、侦听器和 pub-sub - 在每个后继者中，您都稍微放松了耦合，但您永远不会摆脱一些重复，即使它只是 id发布的事件。

这真的归结为差异。如果您发现需要切换到接口的不同实现，那么将具体接口抽象为控制器是值得的。如果您发现需要其他逻辑来观察状态，请将其更改为观察者。如果您需要在进程之间解耦，或者想要插入更通用的架构，pub/sub 可以工作，但它引入了一种全局状态形式，并且不适合编译时检查。

但是，如果您不需要独立更改系统的各个部分，则可能不值得担心。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T09:18:19.360

在我看来，CLI 应该独立于 GUI。在一个MVC架构中，它应该扮演模型的角色。

我会放置一个同时管理 EntryField 和 CLI 的控制器：每次 EntryField 更改时，CLI 都会被调用，所有这些都由控制器管理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-12T07:33:43.517

[您可以解耦任何 GUI 并使用模板虚拟包](http://templatious.org/goodstuff/virtual-packs)轻松地与消息通信。也看看[这个项目](https://github.com/davidkazlauskas/DecoupledGuiExamples)。

# performance - 嵌入式系统中的软件性能（MCPS 和功耗）

> ID：506452
> 
> 赞同：2
> 
> 时间：2009-02-03T09:14:53.453
> 
> 标签：performance

假设具有 DSP 内核（任何其他处理器内核）的嵌入式环境。

如果我有一些应用程序/功能的代码，从消耗的周期（MCPS）的角度来看，它被优化为最好的代码之一，那么它是否也是一个代码，从该代码消耗的功率的角度来看是最好的真正的硬件系统？

是否可以保证针对最低 MCPS 优化的代码也具有最低功耗？

我知道这里有很多方面需要考虑，比如底层处理器的架构和硬件系统（内存、总线等）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T10:50:19.580

不，最低周期数不能保证最低功耗。

这是一个很好的迹象，但您没有考虑到内存总线活动也会消耗大量电力。

例如，如果您将经常需要的数据移动到内部存储器（片上 ram）中，您的代码可能具有更高的循环计数但功耗更低。这不会增加算法的循环计数，但将数据移入和移出内部存储器会增加循环计数。

如果您的系统具有高速缓存和内部存储器，请优化高速缓存利用率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T09:32:14.013

如果不在您的电路板和电源之间放置一个灵敏的电流表并记录消耗的电流，就很难分辨。我的方法是测试各种现实世界场景的假设，而不是使用支持文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T15:01:43.380

这不是一个直接的答案，但我认为这篇论文（来自[这个答案](https://stackoverflow.com/questions/49962/task-schedulers)）很有趣：[Real-Time Task Scheduling for Energy-Aware Embedded Systems](http://www.ee.duke.edu/~krish/wip.pdf)。

据我了解，它试图在处理器的低功耗状态下运行每个任务，除非它在没有高功率的情况下无法满足最后期限。所以在这样的方案中，更高效的代码（更少的周期）应该允许处理器花费更多的时间来节流。

# sql - 如何判断我在 Oracle 事务中是否有未提交的工作？

> ID：506456
> 
> 赞同：14
> 
> 时间：2009-02-03T09:16:17.150
> 
> 标签：sql, oracle, transactions

有没有办法判断我在事务中是否有未提交的工作（即 DML）？也许我可以查询一个数据字典视图？

一种从运行开放事务的会话内部和外部找出这一点的方法将受到欢迎。

谢谢

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-03T21:43:17.767

如果您无权访问 v$session，您可以使用

```
select dbms_transaction.local_transaction_id from dual; 
```

这仅适用于会话内，但不需要 v$ 权限。如果它返回一个非空值，你已经开始了一个事务。这通常意味着未提交的更改，但也有例外。如果您发布了保存点、更改了数据并回滚到保存点，则事务仍然“有效”。此外，使用数据库链接启动事务，即使只是为了选择（或者他们曾经这样做过）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-03T11:26:06.747

```
SELECT  *
FROM    v$session v
WHERE   v.AUDSID = userenv('sessionid')
    AND v.TADDR IS NOT NULL 
```

# mysql - MySql 获取 cloumn 中每种类型元素的计数

> ID：506471
> 
> 赞同：1
> 
> 时间：2009-02-03T09:23:39.007
> 
> 标签：mysql

我有 2 个具有以下结构的表..

```
category
{
  sub_cat_id - numeric
  sub_cat_name -  varchar
  main_cat_id - varchar (2 characters)
  main_cat_name -  varchar
}

products
{
  pid - autoincrement
  pname - varchar
  category (Will be either sub_cat_id or main_cat_id)
} 
```

产品表

```
pid       pname       category
1         mobile      EL
2         shoes       1
3         shirt       1 
4         TV          EL
5         mp3 player  EL 
```

我想获取 products 表中每个类别的计数，以便我的查询返回类别 1 的 2 和类别 EL 的 3

有人可以帮我吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T09:27:03.117

这应该是您所追求的查询：

```
SELECT category, COUNT(*) FROM products GROUP BY category; 
```

我建议您考虑一下您的类别表的设计，因为它可能会在将来给您带来困难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-05T01:25:35.907

注意空值：

```
mysql> select resourcetype,count(resourcetype) as num from resources group by resourcetype     order by num desc;
+-------------------+-------+
| resourcetype      | num   |
+-------------------+-------+
| COLLECTION        | 20036 |
| HIDDEN_RESOURCE   | 17443 |
| DEFAULT_CALENDAR  | 12528 |
| CALSCHED_INBOX    | 12528 |
| CALSCHED_OUTBOX   | 12528 |
| CAL_RESOURCE      | 12367 |
| SHARING_OUTBOX    |  2465 |
| SHARING_INBOX     |  2452 |
| CALENDAR          |     8 |
| HIDDEN_COLLECTION |     4 |
| NULL              |     0 |
+-------------------+-------+

mysql> select count(*) from resources where resourcetype is null;
+----------+
| count(*) |
+----------+
|       56 |
+----------+ 
```

# php - Project Euler #5 php 疑问！

> ID：506482
> 
> 赞同：0
> 
> 时间：2009-02-03T09:29:59.227
> 
> 标签：php, performance, for-loop

[问题欧拉 #5](http://projecteuler.net/index.php?section=problems&id=5)

我找到了解决方案，但我不知道为什么第一个代码更快（我放了 14 以尝试使代码更清晰）唯一的区别是我消除了 for 我写的一个巨大的 if

```
if($num%14==0 && $num%13==0 &&$num%12==0 &&$num%11==0 &&$num%10==0 && $num%9==0 && $num%8==0 && $num%7==0 && $num%6==0 && $num%5==0 && $num%4==0 && $num%3==0 && $num%2==0 && $num%1==0){
    $notFound=0;
} 
```

为什么第二个代码比第一个慢得多？使用*for*它应该会更快。在其他语言中是一样的？？？

```
$notFound=0;
for ( $i=14; $i>=2 && notFound==0; $i--){
    if($num%$i!=0){
        $notFound=1;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T09:39:27.820

`for ( $i=14; $i>=2 && notFound==0; $i--){`

应该

`for ( $i=14; $i>=2 && $notFound==0; $i--){`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T09:45:55.733

我会从最小的数字到最大的数字。因为如果一个数能被 14 整除，它也能被 2 整除。

```
$notFound = 0;
for ($i=2; $i<=14; $i++) {
    if ($num % $i !== 0) {
        $notFound = 1;
        break;
    }
} 
```

通过这样做，您可以尽早排除这些数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T09:35:39.637

我认为这是由于 PHP 的解释器开销（它必须解析和执行 for 循环）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T09:42:14.523

第二个代码示例只是执行比第一个更多的操作，所以我希望它会更慢。在这种情况下，您会发现虽然性能较差，但`for`循环提供了明显更好的可读性和可维护性。

# c# - 视觉的错误？（覆盖面板的问题）

> ID：506484
> 
> 赞同：1
> 
> 时间：2009-02-03T09:30:38.463
> 
> 标签：c#, visual-studio, controls

我有一个非常奇怪的问题，我想知道这是视觉的错误还是我做错了什么。这是一个覆盖 Panel 类的简单代码：

```
public class MyPanel : Panel
    {
        private TableLayoutPanel table = new TableLayoutPanel();

        public MyPanel()
        {
            this.Controls.Add(table);
            table.BackColor = Color.Green;
        }

        public override System.Drawing.Color BackColor
        {
            get
            {
                return table.BackColor;
            }
            set
            {
                table.BackColor = value;
            }
        }
    } 
```

如果我将控件放在表单上并构建项目，视觉将产生错误并且再次打开项目将是不可能的。但是，如果我将 TableLayoutPanel 更改为 TextBox，它工作正常。此外，如果我在将控件添加到 Controls 集合之前在构造函数中设置 BackColor，它也可以正常工作。问题是什么？还是只是一个错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T09:35:46.017

我怀疑递归可能是一个问题；默认情况下（如果未明确设置），控件从父级继承颜色。这导致了孩子的颜色（如果未设置）询问父母的情况，父母询问孩子（永远）。

`SystemColors.Window`但是，如果没有明确的颜色集，TextBox 会覆盖此行为以返回。因此没有递归。

无论哪种方式，我都不确定这是一个好主意——如果你不小心，设计师可能会开始复制控件。

# solaris - 我是 Ubuntu Linux 的长期用户（开发人员），使用 Open Solaris 有什么好处

> ID：506486
> 
> 赞同：2
> 
> 时间：2009-02-03T09:31:48.507
> 
> 标签：solaris, opensolaris

我是一名 Web 开发人员（J2EE 应用程序开发人员），只想扩展我使用的工具。我想将 Open Solaris 用于我的个人项目。我对 Linux 没有任何意见，而且看起来两个系统上都有很多相同的工具。

您跳到 Solaris 了吗，这是一次很好的体验吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T14:38:06.140

DTrace、区域、使用单个 GRUB 开关在 32 位和 64 位模式之间切换、ZFS、**稳定库**（我不能真正强调这一点）。Solaris 7 软件通常在 OpenSolaris（也称为 Solaris 11）上运行。glibc 在次要内核版本之间发生变化。

Xen 集成得非常紧密，设置 lx 区域或虚拟化以保持 Linux 环境非常简单。

OpenSolaris 现在有 /usr/bin/gnu，可以在其中找到所有您喜欢的实用程序。

不过，预计最终会与 ./configure && make && make install 周期有点冲突。许多开发人员假设您正在运行 Linux，并且不为 Solaris 预先添加 -m64 等等。例如，编译 wxPython 是一种冒险。

编辑：我忘了向您提及一件（可能很重要）的事情。软件包存储库几乎没有可比性。很简洁`pkg image-update`（相当于 `apt-get update && apt-get upgrade && apt-get dist-upgrade）制作了一个 ZFS 快照，您可以随时通过 GRUB 恢复它，但是您在 IPS 中*没有*那么多软件包恰如其分。不过，所有的大人物都在那里。

如果您打算切换，Sun 的文档非常棒，当天的 BigAdmin 技巧值得阅读一段时间，以帮助您快速上手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T10:14:03.210

对于 J2EE 工作本身来说，可能并不多。作为更一般的开发人员，您可能会喜欢 DTrace。作为管理员，您会喜欢 ZFS 和区域。不过，您会讨厌过时的实用程序（主要是用户空间）。FreeBSD 是介于 Linux 和 Solaris 之间的一个不错的选择。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T10:07:59.697

我想底层操作系统对于 J2EE 开发人员来说并不重要，只要您坚持使用 java 平台并且不通过 JNI 使用本机库。话虽如此，选择操作系统的最重要因素是成本和性能。现在，Linux 和 OpenSolaris 都是开源的并且可以免费使用，但我不确定在商业部署中使用 OpenSolaris。我也不知道 java 性能如何不同，但我坚信 Sun 的 Linux 实现非常好。

注意：我从未使用过 OpenSolaris，我主要使用 Linux。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T14:31:49.053

我不确定您的问题是针对您的开发桌面还是您的托管解决方案，但我可以对两者都进行尝试。大约六个月前，我在运行 GlassFish 的 OpenSolaris 上获得了一年的免费托管服务。我以前没有使用过 Solaris，并认为这将是一次很好的学习经历。我搭建了一个测试服务器，安装了 OpenSolaris 和 GlassFish，并用它来练习。配置 GlassFish 和部署应用程序非常简单。阅读正确的文档后，在 OpenSolaris 中管理服务也很简单。我喜欢 OpenSolaris，我喜欢 GlassFish。

很明显，我发现与以前使用 Java 应用程序服务器和操作系统的经验有相似之处和不同之处。但是，我对操作系统的评价很高，以至于上个月我切换了桌面。这是一次很好的经历。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T14:55:01.470

遗憾的是，Eclipse 在 OpenSolaris 上不可用。如果您是 Eclipse 用户，则必须迁移到 NetBeans。

# c# - 如何从资源管理器打开文件到不同的选项卡

> ID：506492
> 
> 赞同：1
> 
> 时间：2009-02-03T09:34:37.610
> 
> 标签：c#, shell, explorer

如何从资源管理器打开文件到不同的选项卡。我可以将打开菜单与文件类型相关联，现在当我已经让程序工作时，如何将新文件打开到另一个选项卡，而不是新程序。如何准确地找到已经运行的进程，而不是使用名称并将文件名发送给它。

让我说清楚：我希望我的应用程序是单实例，这样当用户选择 10 个文本文件并按回车键时，我的应用程序会将所有 10 个文本文件打开到 10 个选项卡中，而不是创建 10 个进程。怎么做？如何在同一进程的各个实例之间进行通信。

编辑已解决：使用 C# 中的 WM_COPYDATA 和 codeproject 中的 SingleApplication 类实现了该功能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T15:23:08.703

我不太确定你在这个问题中的意思。您是否尝试将 Windows 资源管理器窗口打开到一个带有选项卡的窗口中？如果是这种情况，那么我建议您查看[QT TabBar](http://qttabbar.wikidot.com/)，它扩展了 Windows Explorer 以允许这种行为。

或者，您可能正试图在 Web 浏览器中打开一个指向新选项卡的链接。如果是这种情况，则此行为由 Web 浏览器本身定义。对于 Internet Explorer 7，您可以在**工具**> **Internet 选项**下设置此行为。

在“常规”选项卡中，单击“选项卡”部分旁边的“设置”按钮。您将需要设置“打开来自其他程序的链接：”选项以打开一个新选项卡。

请记住，此行为是由每个用户定义的，您无法保证他们将拥有与您相同的浏览器设置。

* * *

看了你的评论，我想我明白了一点。听起来您希望您的应用程序一次只允许一个实例。由于您标记了这篇文章 C#，我会假设这就是您正在编写程序的内容。

Codeproject.com 有一个很棒的[教程](http://www.codeproject.com/KB/cs/singleinstance.aspx)，教你如何让你的程序只允许一个实例。

这是他们网站上的一段代码：

```
static void Main() 
{
   if(SingleInstance.SingleApplication.Run() == false)
   {
      return;
   }
   //Write your program logic here
} 
```

您可能希望在 return 语句之前编写代码，以使现有实例在新选项卡中打开文件。

如果您能够提供有关您的程序正在做什么的详细信息，我们可能会在一些细节方面为您提供帮助。

# excel - 使用 CreateObject("Excel.Application") - 无符号控件的问题

> ID：506494
> 
> 赞同：0
> 
> 时间：2009-02-03T09:35:08.517
> 
> 标签：excel, asp-classic, vbscript, activex

我们有一个旧版 ASP 页面，它通过根据数据库中的数据生成客户端 VB 脚本来将内容写入 excel 文件。它使用 set app = CreateObject("Excel.Application") 来初始化 Excel。

问题是这是一个“未签名的 activex 控件”，一些客户现在说他们不会更改他们的 IE 设置以使其工作。

除了使用 Aspose.Cells 在 ASP.NET 中重写页面（此页面需要很长时间）之外，我想知道是否有人知道任何其他可以提供帮助的选项？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T12:12:15.687

虽然这个线程引用了 ASP.Net，但您可能会对其中的很多内容感兴趣：

[从 ASP.NET 网站将查询结果发送到 Excel](https://stackoverflow.com/questions/148945/send-query-results-to-excel-from-asp-net-website)

它提到了创建 HTML 输出和修改标题以输出到 Excel。这也可能是有趣的[http://support.microsoft.com/kb/199​​841](http://support.microsoft.com/kb/199841)

这是一个非常简单的例子。

```
<%
Response.ContentType = "application/vnd.ms-excel"
%>
<TABLE>
<TR><TD>
<!-- Cell : A1 -->
2
</TD></TR>
<TR><TD>
<!-- Cell : A2 -->
3
</TD></TR>
<TR><TD>
<!-- Cell : A3 -->
=SUM(A1:A2)
</TD></TR>
</TABLE> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T13:55:00.097

感谢您的回复。问题是我们生成的电子表格有很多附加功能，例如为某些列设置一些“验证”——我认为 HTML 解决方案无法做到这一点。

但是 - 你的回答迫使我重新看一下代码，结果证明它比我想象的更简单，使用像 Aspose.Cells 这样的“Excel Writer”:)

# wpf - 如何在 WPF 中正确绑定 ListBoxItem？

> ID：506495
> 
> 赞同：10
> 
> 时间：2009-02-03T09:35:29.840
> 
> 标签：wpf, data-binding, xaml, listview

我有一个列表框，我想遍历我的 Foo 对象中的 Bars 集合。

```
<ListBox DataContext="{Binding Path=Foo.Bars}" >
    <ListBox.Items>
        <ListBoxItem>
            <ContentControl DataContext="{Binding Path=.}" />
        </ListBoxItem>
    </ListBox.Items>
</ListBox> 
```

这是我要使用的数据模板。

```
<DataTemplate DataType="{x:Type Bar}">
        <Label Content="hello stackoverflow" />
</DataTemplate> 
```

如果我窥探（-> 使用 Snoop 工具检查）我的应用程序，我注意到**整个 Bars 集合**都绑定到 ContentControl，**而不仅仅是 1**。

如何正确绑定，以便对集合的迭代顺利进行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T11:36:25.290

您可以只设置 DataTemplate，而 WPF 会完成所有工作。将 ItemsSource 设置为`Bar`项目列表，然后为`Bar`项目定义 DataTemplate。

```
<ListBox ItemsSource="{Binding Path=Foo.Bars}">
    <ListBox.Resources>
        <DataTemplate DataType="{x:Type Bar}">
            <Label Content="hello stackoverflow" />
        </DataTemplate>
    </ListBox.Resources>
</ListBox> 
```

您也可以使用`<ListBox.ItemTemplate>`而不是直接设置 ItemsTemplate`<ListBox.Resources>`

请参阅MSDN 上的[数据绑定概述](http://msdn.microsoft.com/en-us/library/ms752347.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T10:15:09.027

首先将您的命名空间添加到`Window`元素（智能感知）：

```
xmlns:local="clr-namespace:yourenamespace" 
```

然后以下`XAML`（in`Window.Resources`是一种干净的方法）：

```
 <Window.Resources>

        <ObjectDataProvider x:Key="DataProvider" ObjectType="{x:Type local:Foo}"/>

        <DataTemplate x:Key="Template" >
           <TextBlock Text="{Binding Bar}"/>
        </DataTemplate>

    </Window.Resources> 
```

放置`Listbox`：

```
<ListBox DataContext="{Binding Source={StaticResource DataProvider}}" ItemsSource="{Binding Bars}" ItemTemplate="DynamicResource Template" /> 
```

但是，这取决于您的代码隐藏对象，您必须设置一个构造函数来初始化对象中的公共属性，这些属性最好是[ObservableCollection<>](http://msdn.microsoft.com/en-us/library/ms668604.aspx)（对象实例中有一些限制规则`XAML`）。

# c++ - 构造函数中的奇怪行为

> ID：506496
> 
> 赞同：2
> 
> 时间：2009-02-03T09:35:38.030
> 
> 标签：c++, parameters, constructor

我有一个由几个字段组成的类，我有几个构造函数。我还有一个不带任何参数的构造函数，但是当我尝试使用它时：

```
int main {
    A a;
} 
```

编译器会产生一个错误，而如果我这样使用它：

```
int main {
    A a();
} 
```

没关系。那是什么？

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-03T09:39:14.530

第一个`main`使用 A 的默认构造函数。第二个声明了一个不带参数并按值返回 A 的函数，这可能不是您想要的。

那么 A 的定义是什么样的，编译器产生的错误又是什么？

哦，你需要在 main: 的声明中提供一个参数列表`int main() { //...`，而不是`int main { //...`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T09:41:44.553

好的，您的意思是它可以编译还是可以工作？代码行：

```
 A a(); 
```

是一个名为的函数的声明（或原型）`a`，它不带参数并返回一个类型的对象`A`。

我认为任何人都有机会帮助您解决真正的问题，您至少需要发布`class A`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T13:33:15.163

Charles 和 Michael Burr 都认为第二个声明实际上是一个函数原型，而不是`A`.

至于您的第一个代码段不起作用的可能原因，在以下情况下您会收到编译错误：

1.  类`A`继承自没有默认构造函数的基类；或者
2.  类`A`包含没有默认构造函数的类型的对象；或者
3.  类`A`包含引用成员；

和

您提供了一个默认构造函数，该构造函数从其初始化列表中省略了这些子对象中的一个或多个。

所有这些子对象都需要某种方式进行初始化，而编译器生成的默认构造函数不会这样做。请注意，在所有情况下，您都需要在*初始化列表*中初始化它们，而不是构造函数的*主体*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T10:03:41.687

你们都说得对，我在课堂上遇到了*问题*。

# asp.net - ASP.NET GridView 浏览器兼容性

> ID：506498
> 
> 赞同：0
> 
> 时间：2009-02-03T09:35:43.163
> 
> 标签：asp.net, gridview, cross-browser

我使用一个`GridView`使用分页和内联编辑的控件。我没有使用任何其他功能（没有排序或任何花哨的东西）。

该控件与哪些浏览器`GridView`完全兼容？是否有来自 MS 的“官方”文件/规范？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T09:59:24.020

[您可以通过http://browsershots.org/](http://browsershots.org/)查看您的网站

# tfs - TFS 工作项类型：任务与场景，还是同时使用？

> ID：506503
> 
> 赞同：5
> 
> 时间：2009-02-03T09:37:06.857
> 
> 标签：tfs, task-tracking

在默认的 TFS 设置中，存在三种工作项类型：方案、任务和错误。最后一个非常简单，而且任务也很简单：这是团队成员要完成的特定工作。但我认为场景有点模糊。

我通常为更大和更一般的工作单元创建一个场景：例如“创建功能以将员工行添加到雇主”。更小、更具体的工作项将是任务，例如：“创建详细信息表单。”、“在服务器上创建保存方法。”等

当我签入更改时，我将更改集链接到场景和特定任务。这是一个好习惯吗？你如何处理任务和场景？最佳实践的任何资源？

我也听说场景实际上是针对用例的，是这样吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-03T10:07:47.233

场景可以是任何用户故事。

您只需要签入任务。创建任务时，应先将它们链接到场景，然后再分配给开发人员。

这样，签入和场景之间的关联是自动的（并且可报告）。

无意义双重处理

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T10:08:53.160

在 MSF 敏捷模板中，场景也可以被认为是“[用户故事](http://www.think-box.co.uk/blog/2006/02/user-stories-part-1-what-is-user-story.html)”——有点像轻量级敏捷用例。

场景详细描述了想要实现的功能的大致情况，记录了用户与系统部分交互的单一路径。例如，在 Stack Overflow 中，有几个场景可能是“提出问题”或“回答问题”。场景和服务质量需求可以被认为是 MSF Agile 中的顶级工作项（即定义系统的工作项），其中场景是功能性需求，而服务质量是非功能性需求。

我倾向于从每个场景中创建多个任务，并且通常只记录我对任务的签到。在 TFS 2010 中，将出现适当分层的工作项，这将使这种工作方式更容易报告。当前工作项关联是双向的（即，您可以说任务与场景相关联，但不能说它是场景的子项）。

根据任务和场景标记您的签入并没有错，只是它在签入时为您创建了更多工作。此外，该场景可能由许多开发人员交付 - 因为任务往往会失败在个人活动的粒度上。

如果您正在将工作项与场景关联很多，那么以下提示可能对您很方便 ( [http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html](http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html) )。它向您展示了如何修改标准 MSF Agile 过程模板，以消除签入解决方案的能力，而只是将签入与该工作项相关联。为像场景这样的长期运行的工作项解决签入问题几乎总是不是您想要发生的——而是开箱即用的默认行为。

希望有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T10:05:06.567

如果“默认 TFS 设置”是指“MSF for Agile Software Development”项目模板，则场景定义如下：

> 场景是一种工作项，记录用户通过系统交互的单一路径。当角色试图达到一个目标时，场景会记录他们在尝试达到那个目标时将采取的具体步骤。有些场景会记录成功的路径；其他人将记录一个不成功的。编写场景时，请具体说明，因为有许多可能的路径。

要获得更多信息，请仔细查看团队资源管理器中项目下的“文档/流程指南”文件夹 - 它很好地解释了推荐的流程

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T10:08:03.050

您可以将场景视为代表用户的视角，而任务则是开发人员的视角。根据[MSF Agile 文档](http://msdn.microsoft.com/en-us/library/bb668964.aspx)，场景“表示通过您正在构建的系统进行的用户交互的单一路径。”，任务“识别团队成员要执行的特定工作项”。

任务可以链接到场景。在签入时，作为开发人员，您已经解决了一项任务，而不是场景，因此您应该将变更集与该任务相关联。

# c++ - C++ 的新操作是否可以保证地址返回的对齐？

> ID：506518
> 
> 赞同：31
> 
> 时间：2009-02-03T09:44:04.287
> 
> 标签：c++, performance, alignment, new-operator

大多数有经验的程序员都知道数据对齐对程序的性能很重要。我见过一些程序员编写的程序分配了比他们需要的更大的缓冲区，并使用对齐的指针作为开始。我想知道我是否应该在我的程序中这样做，我不知道 C++ 的新操作返回的地址是否对齐有任何保证。所以我写了一个小程序来测试

```
for(size_t i = 0; i < 100; ++i) {
    char *p = new char[123];
    if(reinterpret_cast<size_t>(p) % 4) {
        cout << "*";
        system("pause");
    }
    cout << reinterpret_cast<void *>(p) << endl;
}
for(size_t i = 0; i < 100; ++i) {
    short *p = new short[123];
    if(reinterpret_cast<size_t>(p) % 4) {
        cout << "*";
        system("pause");
    }
    cout << reinterpret_cast<void *>(p) << endl;
}
for(size_t i = 0; i < 100; ++i) {
    float *p = new float[123];
    if(reinterpret_cast<size_t>(p) % 4) {
        cout << "*";
        system("pause");
    }
    cout << reinterpret_cast<void *>(p) << endl;
}
system("pause"); 
```

我使用的编译器是 Visual C++ Express 2008。似乎新操作返回的所有地址都是对齐的。但我不确定。所以我的问题是：有任何保证吗？如果他们有保证，我不必调整自己，如果没有，我必须。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-03T10:09:40.457

对齐具有来自标准 (3.7.3.1/2) 的以下保证：

> 返回的指针应适当对齐，以便它可以转换为任何完整对象类型的指针，然后用于访问已分配存储中的对象或数组（直到通过调用相应的释放函数显式释放存储） .

**编辑**：感谢[timday](https://stackoverflow.com/users/24283/timday)强调gcc/glibc 中的一个保证不成立的[错误。](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=15795)

**编辑 2**：本的评论突出了一个有趣的边缘案例。分配程序的要求仅适用于标准提供的要求。如果应用程序有自己的版本，那么结果就没有这样的保证。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2012-05-16T21:47:31.293

这是一个较晚的答案，但只是为了澄清 Linux 上的情况 - 在 64 位系统上，内存始终是 16 字节对齐的：

[http://www.gnu.org/software/libc/manual/html_node/Aligned-Memory-Blocks.html](http://www.gnu.org/software/libc/manual/html_node/Aligned-Memory-Blocks.html)

> 在 GNU 系统中 malloc 或 realloc 返回的块的地址始终是 8 的倍数（或 64 位系统上的 16）。

操作员在内部`new`调用`malloc`（请参阅`./gcc/libstdc++-v3/libsupc++/new_op.cc`），因此这也适用`new`。

其实现`malloc`是x86-32 和 x86-64 系统上`glibc`基本定义 `MALLOC_ALIGNMENT`为32bit=4byte`2*sizeof(size_t)`和`size_t`64bit=8byte 的一部分。

```
$ cat ./glibc-2.14/malloc/malloc.c:
...
#ifndef INTERNAL_SIZE_T
#define INTERNAL_SIZE_T size_t
#endif
...
#define SIZE_SZ                (sizeof(INTERNAL_SIZE_T))
...
#ifndef MALLOC_ALIGNMENT
#define MALLOC_ALIGNMENT       (2 * SIZE_SZ)
#endif 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2019-07-31T17:45:25.710

C++17 更改了对`new`分配器的要求，因此它需要返回一个对齐等于宏的指针`__STDCPP_DEFAULT_NEW_ALIGNMENT__`（由实现定义，而不是包含头文件）。

这很重要，因为这个大小可以*大于*。`alignof(std::max_align_t)`例如，在 Visual C++ 中，最大常规对齐是 8 字节，但默认`new`总是返回 16 字节对齐的内存。

另外，请注意，如果您`new`使用自己的分配器覆盖默认值，您也*需要*遵守`__STDCPP_DEFAULT_NEW_ALIGNMENT__`。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-03T12:11:37.187

顺便说一句，[MS 文档](http://msdn.microsoft.com/en-us/library/ycsb6wwf.aspx)提到了一些关于 malloc/new 返回地址的内容，这些地址是 16 字节对齐的，但从实验来看，情况并非如此。我碰巧需要一个项目的 16 字节对齐（以通过增强的指令集加速内存复制），最后我求助于编写自己的分配器......

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-03T10:28:44.680

平台的 new/new[] 运算符将返回具有足够对齐的指针，以便它在基本数据类型（double、float 等）中表现良好。至少任何明智的 C++ 编译器+运行时都应该这样做。

如果您对 SSE 有特殊的对齐要求，那么使用特殊的 aligned_malloc 函数可能是个好主意，或者自己动手。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-03T11:12:29.800

**我在一个系统上工作，他们使用对齐来释放奇数位供自己使用！**

他们使用奇数位来实现虚拟内存系统。

当一个指针设置了奇数位时，他们用它来表示它指向（减去奇数位）从数据库中获取数据而不是数据本身的信息。

我认为这是一种特别讨厌的编码，为了它自己的利益，它远非聪明！

托尼

# php - 如何区分wordpress中的用户角色？

> ID：506519
> 
> 赞同：1
> 
> 时间：2009-02-03T09:44:40.913
> 
> 标签：php, wordpress

我试图限制订阅者可以看到的内容，但我所做的一切似乎都不起作用。我花了几个小时在网上和 wordpress 代码中搜索，但都无济于事。有谁知道我怎么能做到这一点？

理想情况下，代码结构如下所示：

```
if(get_role() = 'subscriber'){
    redirect
} 
```

谢谢

顺便说一句，我尝试过 get_role($role) 但这对我不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T20:35:46.043

我为此使用了 current_user_can。这里有一个角色和能力列表：

[http://codex.wordpress.org/Roles_and_Capabilities#Capabilities:_5](http://codex.wordpress.org/Roles_and_Capabilities#Capabilities:_5)

因此，由于“订阅者”级别以上的每个人都可以编辑帖子，因此满足您概述的要求的一种方法是：

```
if (!current_user_can('edit_posts')){

//redirect, error, etc as you like

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T10:00:46.093

**更新**：有一个功能`current_user_can(capability)`可以用来找出用户可以做什么和不能做什么。我想您将需要添加另一个角色或功能。

尝试以下操作：

```
if ('subscriber' == get_role()) {
    # do whatever
} 
```

= 赋值
== 比较

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T20:26:27.343

Wordpress 在内容访问限制方面做得不是很好。它只是没有内置到系统中。大多数权限工作涉及控制谁可以创建和编辑，但最重要的设计原则是让任何人查看。这对于博客应用程序来说是有意义的，但如果您有需要条件访问的用户类型，它可能会受到限制。

您可以毫不费力地添加订阅者角色，但是您必须为大量渲染代码添加挂钩，以重定向或隐藏循环中的帖子。最少的开发工作是检查用户在循环中的角色并隐藏他们不应该看到的内容。这样做的缺点是您最终可能会在空白页附近进行渲染。

# c# - 在 WPF 中的 DataBound 时将 TextBlock 设置为完全粗体

> ID：506521
> 
> 赞同：28
> 
> 时间：2009-02-03T09:45:01.210
> 
> 标签：c#, .net, wpf, xaml, textblock

我有一个数据绑定的 TextBlock 控件（在 DataTemplate 中使用它来显示 ListBox 中的项目），我想让控件中的所有文本都加粗。我似乎无法在属性资源管理器中找到一个属性来将整个文本设置为粗体，而我在网上只能找到`<Bold>`TextBlock 内标签的使用，但由于数据即将到来，我无法将其放入直接来自数据源。

必须有一种方法可以做到这一点 - 但是如何？我对 WPF 非常缺乏经验，所以我真的不知道去哪里找。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-02-03T10:24:27.247

我是否遗漏了什么，或者您只需将 FontWeight 属性设置为“Bold”？

```
<TextBlock FontWeight="Bold" Text="{Binding Foo}" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:20:17.037

而不是只有一个TextBlock，试试这个：

```
<TextBlock>
  <Bold>
    <Run />
  </Bold>
</TextBlock> 
```

然后将数据绑定到 Run.TextProperty。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T10:05:47.580

您说数据直接来自数据源；是否可以在它前面放置一个抽象层？为您正在显示的内容创建视图并让视图与数据通信是很常见的。这个想法最常见的实现是模型视图视图模型（MVVM）。在线阅读它。

您可能有一个绑定到文本框的“DisplayText”属性，它只是一个包装底层文本的“getter”。它可以检测文本是否已经被包裹，如果没有，则包裹它。

例如。

```
public class TestView {
  private Test datasource;
  public TestView(Test source)
  { 
     this.datasource = source;
  }

   public string DisplayText {
     get {
       if (datasource.Text.Contains("<bold>")==false) {
           return "<bold>" + datasource.Text + "</bold>";
       }
       return datasource.Text;
     }
   }
} 
```

然后，绑定到视图而不是直接绑定到对象。

# c++ - 神秘的相对路径库依赖

> ID：506522
> 
> 赞同：1
> 
> 时间：2009-02-03T09:45:21.350
> 
> 标签：c++, visual-studio-2008, linker

在 Visual Studio 2008 中加载现有 MFC 应用程序后，我留下了一个链接错误：

```
LINK : fatal error LNK1104: cannot open file '..\..\xpressmp\lib\xprm_rt.lib' 
```

我看过“无处不在”，但我无法弄清楚相对路径的设置位置。lib文件位于C:\xpressmp\lib，我在Tools-Options->Projects and Solutions->VC++Directories->Library files和Project->Properties->Linker->Additional下都添加了这个目录图书馆目录。我还搜索了项目中的所有文件均无济于事。

我在Debug和Release的附加依赖项下列出了库文件（xprm_rt.lib）。我也尝试在那里添加路径，但这没有帮助。我找不到任何#pragma 注释指令。

关于 LNK1104，该文件显然不存在于链接器正在搜索的位置。但是我看不出它为什么在那里搜索（`..\..\`...），因为我没有指定任何相对路径。

任何帮助表示赞赏:-)

更新：在项目 .vcproj 文件中，我找到了以下 xml：

```
<File RelativePath="..\..\XpressMP\lib\xprm_rt.lib"></File>
<File RelativePath="..\..\XpressMP\lib\xprs.lib"></File> 
```

删除这些行（它们在哪里设置？）后，我能够成功链接。感谢您的帮助，似乎相对库路径确实是由 VS“自动”附加的。

谢谢你们，我认为是尼克让我走上了正轨。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T10:10:43.497

在项目属性中，查看配置属性 -> 链接器 -> 输入 -> 附加依赖项下的每个项目配置（调试、发布等）。另外，`#pragma comment(lib, ...)`在代码中查找指令。

当您将该`C:\xpressmp\lib`文件夹添加到 VC++ 目录中的库搜索路径时，请检查是否仅在 Additional Dependencies 下指定了库文件名，并且这不包括路径（即`xprm_rt.lib`, not `..\..\xpressmp\lib\xprm_rt.lib`）。

另外，您是否尝试过[LNK1104 错误文档](http://msdn.microsoft.com/en-us/library/ts7eyw4s.aspx)中的每个解决方案？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T14:35:58.080

对我来说，这听起来像是几种可能性之一：

*   库本身通过 #pragma comment(lib, ...) 指令设置 lib 包含路径；搜索库标题以查看是否是这种情况
*   您的解决方案中包含一个库项目，您的主项目依赖于该库，并且相对库路径由 VC 自动附加；检查主项目的命令行属性页面，看看是否是这种情况

这就是我能想到的可能导致错误的原因；希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T10:23:58.713

谢谢你这么快回答！

我在`xprm_rt.lib`Debug和Release的附加依赖项下列出了库文件（）。我也尝试在那里添加路径，但这没有帮助。我找不到任何`#pragma comment`指令。

关于 LNK1104，该文件显然不存在于链接器正在搜索的位置。但我不明白为什么它在那里搜索（`..\..\...`）

# css - CSS 框架真的值得使用吗？

> ID：506523
> 
> 赞同：9
> 
> 时间：2009-02-03T09:45:33.940
> 
> 标签：css, frameworks

CSS 框架有没有什么东西让你自己做起来不容易？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-04T12:15:09.830

我对 CSS 框架的主要用途是，它们往往会迫使您考虑如何组织代码，而不是为您的日常任务提供必不可少的工具。

出于这个原因，我是[样板](http://code.google.com/p/css-boilerplate/)文件的粉丝，而不是蓝图之类的东西，因为样板文件倾向于关注您如何构建 css 样式表和导入，而不是为您提供语义上令人困惑的帮助类的集合。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T10:27:58.923

它们只是一种便利，因此适用于线框图和快速原型制作等事情。如果您可以熟悉布局代码，它们可能也是学习 CSS 布局的好方法。

我不喜欢 CSS 框架的地方在于它们鼓励使用非语义类名，并且对于更简单的设计来说有点笨拙。我仍然认为理解 CSS 布局的工作原理非常重要，而不是仅仅依赖框架，因为你会限制你的创造力和你可以实现的目标。有时从[csszengarden](http://www.csszengarden.com/)站点读取 CSS 文件可以教给您一些您不确定如何实现的东西。

对于线框图，这是我见过的最有前途的 CSS 框架：http: [//designinfluences.com/fluid960gs/](http://designinfluences.com/fluid960gs/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T10:54:17.170

我认为这一切都取决于你自己的知识和项目。如果你有很多小企业客户，或者因为其他原因做了很多类似的设计，我认为使用 css 框架可以节省一些时间。而且您可以节省浏览器错误修复的时间，但无论如何您都应该始终进行测试。

但是如果你的 CSS 技能很好，你知道最常见的 IE 错误以及如何破解它们，我认为在大多数情况下不需要使用框架。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T10:32:15.967

一些描述的重置样式表是一个有价值的起点。

例如：

[http://developer.yahoo.com/yui/reset/](http://developer.yahoo.com/yui/reset/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T10:04:36.100

IE6 兼容性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T11:20:01.237

鉴于您已经熟悉一个特定的框架，因此执行某些常见的网格布局会更加容易和快捷。如果你做了很多 CSS，你可能想学习并尝试坚持使用框架。

[Blueprint CSS](http://code.google.com/p/blueprintcss/)是我比较喜欢的 CSS 框架。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-22T15:58:18.970

是的，测试测试和更多测试。你有时间在所有浏览器中测试和调试你的代码吗？如果你有它是最好的编写自己的代码。如果您需要快速解决方案，您可以使用一些框架。我写了一篇关于这个主题的文章：[http ://www.vcarrer.com/2008/08/when-to-use-css-framework.html](http://www.vcarrer.com/2008/08/when-to-use-css-framework.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-03-28T07:21:11.277

这取决于框架和您的最终目标。

很多时候，它们可以作为预定义模板的指南来帮助您的开发工作。但有时您只是希望您的页面看起来更好，而不必处理 CSS 文件的实际工作。在后者中，您可以完全跳过“让自己”部分，并在项目的其他部分投入更多精力。

以[Skeleton](http://getskeleton.com/)和[Tacit](https://yegor256.github.io/tacit/) CSS 框架为例。两者都是非常小的框架。第一个更集中于提供易于使用和适应样板代码，并带有适量的实用程序。另一方面，[Tacit](https://yegor256.github.io/tacit/)是一个针对傻瓜的 CSS 框架，例如，对于那些对使用 CSS 不感兴趣但仍希望获得比默认的无 CSS 的 HTML 显示更好的显示外观的人，他们想要这个输出-开箱即用，不必使用 CSS 类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-16T23:32:23.610

我认为，无论是使用 CSS 还是 Javascript 框架，当我们联合起来时，任何类型的兼容性都是最好的，肯定会有更多的机会修复错误并实现愿望。类似的界面也有可能减少您网站的新用户所需的培训量。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-02T09:31:06.553

我永远不会使用 CSS 框架。它们不会使任何事情变得更快或更容易，增加代码膨胀并使调试或测试变得更加困难。如果我确实使用 CSS 框架开始，它看起来像这样：

身体 {}

你会以什么方式需要更多？基线起点应该始终是**浏览器默认显示的内容**，仅此而已。

重置 CSS 样式表会导致同样的问题。

例如：[http ://withoutsubstance.blogspot.com/2008/09/why-you-should-never-ever-ever-use.html](http://withoutsubstance.blogspot.com/2008/09/why-you-should-never-ever-ever-use.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-12-18T05:24:30.443

我曾经使用过 960，发现它非常适合制作原型，但我不喜欢将它投入生产。我发现使用浮动让我的头有点疼。

有一个普遍的误解，认为框架 == 膨胀，另一个认为框架的特定实现代表定义。框架只是一个工具。这是一个类比：如果你需要一把扳手来修理你的汽车，你不应该扔掉你的螺丝刀组。

如果你发现你看过的框架不适合手头的任务，你不应该把它们写下来。当您需要时，您可以轻松制作自己的框架或使用框架。

# language-agnostic - 像 memcached 这样的缓存系统，但我需要列出缓存中的内容

> ID：506530
> 
> 赞同：0
> 
> 时间：2009-02-03T09:51:19.310
> 
> 标签：language-agnostic, caching, memcached

什么是支持 get、put、delete 和 list 的最佳缓存系统/守护进程（我认为 memcached 不支持列表）

一个例子

我想将 memcached 用于我的缓存解决方案，但我坚持使用我目前拥有的应用程序设计，即我缓存以下 3 个 URL，我需要始终拥有不同的缓存键。这阻止了我仅仅声明一个 URL 参数列表，我可以使用这些参数生成一个缓存项。

*   /badappdesign?iod=3
*   /badappdesign?iod=3&h=23
*   /badappdesign?iod=3&dsfj=435&dasv=342

在这种情况下 iod=3 已更改，因此我需要清除所有包含 iod=3 的键

我目前缓存到一个数据库，并且必须做一个相当昂贵的事情，比如 '%iod=3%'

有什么帮助？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T20:26:55.157

将“3”从 iod=3 中拉出并将其粘贴到整数列中并为其编制索引？这将大大降低成本。

# nhibernate - 具有多个关系的 2 个类的 NHibernate 映射

> ID：506539
> 
> 赞同：1
> 
> 时间：2009-02-03T09:56:37.177
> 
> 标签：nhibernate

尝试使用 NHibernate 持久化 2 个对象的新实例时出现以下错误，这些对象之间有多个关联：

```
 NHibernate.Exceptions.GenericADOException: could not insert: [MyProject.BusinessEntities.Client][SQL: INSERT INTO dbo.Client (Version, CurrentEvent_ClientEvent_Id, EntityType, Id) VALUES (?, ?, 'MyProject.BusinessEntities.Client', ?)] --->  System.Data.SqlClient.SqlException: The INSERT statement conflicted with the FOREIGN KEY constraint "FK328F067A46E318FD". The conflict occurred in database "DatabaseName", table "dbo.ClientEvent", column 'ClientId'. 
```

**场景如下：**

我有 2 个类（为清楚起见，我已重命名）：Client 和 ClientEvent。客户端有一个名为 Events 的属性，它的类型为 List。ClientEvent 包含一个属性“Client”，它是与 Client 对象的反向关联。此外，Client 类还有另一个名为 CurrentEvent 的属性，它包含对 ClientEvents 集合中的一项的引用。

Client.hbm.xml 包含：

```
<bag name="ClientEvents" access="field.camelcase-underscore" inverse="true" cascade="save-update">
    <key column="Client_Id"/>
    <one-to-many class="MyProject.BusinessEntities.ClientEvent, MyProject.BusinessEntities" />
</bag>
<many-to-one name="CurrentEvent" access="property" class="MyProject.BusinessEntities.ClientEvent, MyProject.BusinessEntities" column="CurrentEvent_ClientEvent_Id" cascade="save-update" /> 
```

ClientStatusRecord.hbm.xml 包含：

```
<many-to-one name="Client" access="property" class="MyProject.BusinessEntities.Client, MyProject.BusinessEntities" column="Client_Id" cascade="save-update" /> 
```

我从映射中自动生成数据库模式，并且两个表中的外键都可以为空。

我使用以下代码来持久化一个新的 Client 和 ClientRecord（再次简化以删除所有会话管理 gumpf）

```
var newClient = CreateNewClient();
var newEvent = CreateNewEvent();
newEvent.client = newClient; // ensure the reverse association is set
newClient.Events.Add(newEvent);
session.SaveOrUpdate(newClient);
session.Flush(); 
```

查看 NHibernate 的 SQL 输出，它似乎在保存 ClientEvent 记录之前尝试保存 Client 记录，尝试将 ClientEvent Id 插入外键，但由于 ClientEvent 记录不存在而失败

**问题**

*   有没有人让它在 nhibernate 持久化具有多个关系的对象时工作？
*   如果是这样，映射应该是什么样的？
*   对我可以尝试的事情有什么建议吗？

*对不起，冗长的帖子*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-04T01:54:36.057

谢谢，我尝试了在 Client 和 ClientEvent 映射中将级联属性设置为 Save-Update 或 None 的所有组合，但没有成功。

但是，通过从头开始逐步构建我的映射，我发现了问题所在......我在 Client 和 ClientEvent 对象上设置了 Id，而不是让 NHibernate 在对象被持久化时生成值。在大多数情况下，是否在持久化对象之前显式设置 Id 似乎并不重要。但是，在这种情况下，NHibernate 似乎错误地解析了对象需要被持久化的顺序，并尝试持久化引用不存在的 ClientEvent 的 Client 记录。

**解决方案：**让 NHibernate 为对象生成 Identifier

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T10:06:52.210

我猜这是关于*cascade*，尝试更改映射中级联的值。不是 100% 肯定，但是，尝试在多对一映射中将级联设置为“无”

# php - 如何使用swig为c++生成php接口so

> ID：506544
> 
> 赞同：6
> 
> 时间：2009-02-03T09:58:38.657
> 
> 标签：php, c++, swig

我已经尝试了一百件事，但我无法让我的 .so 文件使用 swig 与 php 交互。我可以生成文件，然后我必须编译 Zend 并与之链接以制作 .so 但它现在在加载时会出现段错误。

有人可以告诉我如何使用 swig 为 C++ 库生成 PHP 接口吗？swig 网站上的[文档没有帮助。](http://www.swig.org/Doc1.3/Php.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T21:15:50.843

[这个例子](http://www.swig.org/Doc1.3/Php.html)似乎信息丰富。你试过了吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-11-06T02:54:15.247

我陷入了同样的情况，但 Gaius 的回答澄清了必须首先创建 example.i 文件，它不仅仅是一个花哨的参数来告诉 swig 你的项目名称。[该指南的第 2.3.1 段](http://www.swig.org/Doc2.0/SWIGDocumentation.html#Introduction_nn5)！告诉这个 example.i 文件是关于什么的。

```
/* File : example.i */
%module example
%{
/* Put headers and other declarations here */
extern double My_variable;
extern int    fact(int);
extern int    my_mod(int n, int m);
%}

extern double My_variable;
extern int    fact(int);
extern int    my_mod(int n, int m); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-16T19:55:45.787

嗨仔细检查您的PHP代码所在文件夹的权限。我遇到了同样的问题。事实上，我也在同一个目录中做一些文件读/写的东西，我必须相应地设置我的 php 项目的权限，否则它曾经说**没有收到数据**，当我在 apache 错误日志中看到时，我看到了分段错误。

所以请检查。这可能会有所帮助。

是的，Swig 站点中的文档对 PHP 开发人员仍然没有多大帮助。

# knowledge-management - 知识转移的最佳实践是什么？

> ID：506545
> 
> 赞同：2
> 
> 时间：2009-02-03T09:58:40.760
> 
> 标签：knowledge-management

如果您最终遇到您正在从事的项目的主要开发人员决定离开的情况。

他拥有所有知识，从一开始就参与项目。如果你很幸运，你可能会得到他两个月的时间，如果没有，可能只是一个月的休假通知。

知识流失、转移的最佳实践是什么？

过去证明什么对你有用？配对、演示、文档？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T10:06:09.297

**我认为配对开发人员**之间定期安排的知识共享会议效果很好。确保至少有 2 名编码人员对代码库的每个部分都有一定的经验。

我们制作了一个**知识共享图表**，其中在页边空白处列出了每个开发人员的姓名，在顶部列出了每个项目。我们在方框中放置了一个绿色符号，将主要开发人员与他们的项目对齐，并在第二个开发人员和同一项目中放置一个黄色符号。

那时很容易，顺着每个项目的路线，确保它至少有 2 分。如果不是这样，那么在我们的下一次重大会议上，我们会让开发人员决定他们是哪个项目的辅助开发人员，但他们都必须是至少*一个*项目的辅助开发人员。通过这种方式，他们可以了解他们感兴趣的项目，并与他们选择的开发人员合作。

一些大型或系统关键项目有 2 或 3 个辅助项目。每个月我们都会安排两个小时的知识分享时间。你会在去你的次要项目和人们来你的主要项目之间切换。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T10:03:53.683

如果您有足够的时间，请让他完整记录系统，**然后**与他一起阅读系统和文档以确保您了解两者。

不要依赖于你会记住细节的事实。**记下他在转会会议上所说的一切**。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T10:06:00.060

我在录音机会话中与一位同事配对。他正在给我详细的解释，带我浏览代码并用代码映射应用程序的功能。他离开后，我花了几天时间转录这些录音并制作技术文档，这些文档在我离开公司一段时间后使用

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T10:06:06.503

文档是*必不可少*的，但它应该在任何人离开之前存在。但是，有人离开应该触发编辑/审查/更新的循环。

然而，仅文档本身就非常枯燥，而演示文稿只是让你即将成为前同事的无聊的一种更生动的方式，所以根据我的经验，唯一真正有价值的是由学习者推动的**动手代码演练**不是尽可能小团体的离开者。*学习者必须*看到正在运行的代码，包括断点、异常、单元测试和最终结果。

*（而且 FWIW 我相信所有项目都应该记录 UML 类图 - 框和线是我在学习架构时想要看到的）*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T10:12:56.303

如果可能的话，我会说带另一位可能正在做同样事情的高级/同事参加传递会议。如果可能，请让该人员先对业务逻辑进行演练，然后再编写代码。另一个人提供第二意见很重要，因为他们可能会抓住您由于经验等原因错过的一些要点。

我赞同 Galwegian 的观点，将所有内容记录下来。只需确保您的文字清晰易读 :) 如果可能的话，在会议结束后对材料进行审查，就像中间的休息时间一样，1-2 小时让材料潜入您的脑海。然后在下次会议上再次询问该人您不了解的任何内容。

我了解到，如果您在查看材料之前离开太久，那么到那时对您来说几乎是希腊语。

只是我的两分钱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T10:15:59.807

不要相信文档会购买该开发人员积累的知识。

我认为获得真正知识转移的唯一方法是让某人与他一起在项目中进行实际工作。然后，他将发现在项目中工作所需的小技巧。我记得一个例子，我们的模拟器不能一步一步地正常工作，但你可以使用断点让它工作。这是一个典型的例子，你只能通过实践来学习。

在其他开发人员对项目及其使用方式更加熟悉后，只需查看所有代码、文档即可。但最好的办法是，对于项目的每个部分，他们都可以做一个小的改进来使用所有的工具并发现所有的怪癖。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T10:14:09.280

除了关于当前项目是什么的静态文档外，我还制作了一份关于执行了哪些演示/实验以及做出了哪些决定的记录。项目的轨迹很重要，要知道哪些已经尝试过，哪些失败了，哪些部分存在技术债务以及原因。

# .net - 在 C# 中转换日期

> ID：506549
> 
> 赞同：2
> 
> 时间：2009-02-03T09:59:36.627
> 
> 标签：.net, datetime, icalendar

有谁知道在 C# 中将像“20081231T130000”（我认为是 ICalendar）这样的字符串转换为 DateTime 的简单（内置）方法？还是我需要解析字符串？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T10:06:18.233

试试这个：

```
DateTime when = DateTime.ParseExact("20081231T130000",
    "yyyyMMddTHHmmss",CultureInfo.InvariantCulture); 
```

旁白：它*接近*xml 中使用的格式，但不够接近 - 否则会`XmlConvert`包装这个：

```
DateTime when = XmlConvert.ToDateTime("2008-12-31T13:00:00"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:12:42.433

这似乎有效：

```
string dateTimeString = "20080115T115959";
string format = "yyyyMMddTHHmmss";
IFormatProvider us = new System.Globalization.CultureInfo("en-US", true);

DateTime dt = DateTime.ParseExact(dateTimeString, format, us); 
```

# maven-2 - 硒 Maven 插件

> ID：506550
> 
> 赞同：1
> 
> 时间：2009-02-03T09:59:37.077
> 
> 标签：maven-2, selenium, maven-plugin

我正在尝试设置 selenium-maven-plugin 并遇到一些困难，希望有人能帮助我。我的配置如下所示：

```
<plugin>
  <groupId>org.codehaus.mojo</groupId>
  <artifactId>selenium-maven-plugin</artifactId>
  <executions>
    <execution>
      <phase>pre-integration-test</phase>
      <goals>
    <goal>start-server</goal>
    <goal>selenese</goal>
      </goals>
      <configuration>
    <background>true</background>
    <browser>*firefox</browser>
    <results>src/test/resources/selenium/result.html</results>
    <startURL>http://localhost/MyProject</startURL>
    <suite>src\test\resources\selenium\Testsuite.html</suite>
      </configuration>
    </execution>
  </executions>
</plugin> 
```

我也有货物设置，效果很好。然而，启动服务器目标运行没有问题，但是当 maven 尝试执行 selenium:selenese 目标时，我得到这个异常：找不到匹配的构造函数：org.openqa.selenium.server.SeleniumServer(java.lang.Integer, java. lang.Boolean, java.lang.Boolean)

一个建议？在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T11:09:16.637

这是 selenium 中的一个错误，可以通过下载新版本来修复。

# wpf - 使用 Findresource 加载资源会引发异常 - WPF/C#

> ID：506551
> 
> 赞同：4
> 
> 时间：2009-02-03T09:59:45.487
> 
> 标签：wpf, resources

我正在 WPF 中编写 CustomControl。我的 Themes/Generic.xaml 中有一些 DataTemplates，位于资源字典级别，并为它们分配了 x:Key。

现在从同一个控制类代码中，我想找到并加载该资源，以便我可以动态地分配代码中的某些内容。

我已经尝试过 base/this.FindResource("keyvalue")、this.Resources[""] 等。

它不断返回找不到资源，因此为空。

该资源肯定在 generic.xaml 中。

请帮忙。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-08-14T16:40:28.727

答案有点晚，但它可能会使其他人受益。

您尝试访问的资源**位于主题级别**，要从程序集中的任何位置访问它，它必须由 ComponentResourceKey 标识：

```
<Style TargetType="{x:Type TreeViewItem}" 
       x:Key="{ComponentResourceKey {x:Type local:MyTVIStyleSelector}, tviBaseStyle}">
  <!-- style setters -->
</Style> 
```

然后在你的 XAML 中你会像这样引用它：

```
<Style TargetType="{x:Type TreeViewItem}" 
       x:Key="{ComponentResourceKey {x:Type local:MyTVIStyleSelector}, tviStyle_1}"
       BasedOn={StaticResource {ComponentResourceKey {x:Type local:MyTVIStyleSelector}, tviBaseStyle}}>
  <!-- style setters -->
</Style> 
```

在你的代码中是这样的：

```
ComponentResourceKey key = new ComponentResourceKey(typeof(MyTVIStyleSelector), "tviStyle_1");
Style style = (Style)Application.Current.TryFindResource(key); 
```

还有一种详细形式的 XAML 语法，看起来像这样（但它只是一回事）：

```
<Style TargetType="{x:Type TreeViewItem}" 
       x:Key="{ComponentResourceKey TypeInTargetAssembly={x:Type local:MyTVIStyleSelector}, ResourceId=tviBaseStyle}">
  <!-- style setters -->
</Style> 
```

请注意，即使必须设置 TypeInTargetAssembly，它也不会限制程序集中其他类型对该资源的访问。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-05T04:16:56.457

在使用 FindResource 之前，请确保您已将自定义控件作为子控件实际添加到另一个控件。我很确定当您使用 FindResource 时，它​​会爬上控制层次结构，直到找到匹配项。如果您的控件没有父控件，它将找不到您要查找的资源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-06-09T20:24:19.523

您可以像这样加载资源字典：

```
ResourceDictionary myDictionary = Application.LoadComponent(new Uri("/MyAssembly;component/Themes/Generic.xaml", UriKind.RelativeOrAbsolute)) as ResourceDictionary; 
```

然后，您可以以通常的方式在其中查找资源，例如 myDictionary["keyvalue"]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-02T20:07:55.200

x:Key 和 DataType 是互斥的。在内部，如果您设置 DataType，WPF 会生成一个 DataTemplateKey 类型的键。因此，使用 ComponentResourceKey 调用 FindResource 会引发异常，因为无法使用此键找到资源。利用

```
frameworkElement.FindResource(new DataTemplateKey(typeof(yourType))); 
```

对于定义了 DataType={x:Type local:yourType} 的 DataTemplate 或

```
frameworkElement.FindResource(new ComponentResourceKey(typeof(yourType), "ressId")); 
```

对于定义了 x:Key={ComponentResourceKey TypeInAssembly={x:Type l:yourType}, ResourceId=ressId} 的 DataTemplate。不要在同一个模板中定义 DataType 和 x:Key。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T19:13:39.440

由于您正在构建一个自定义控件，我假设您在 generic.xaml 文件中定义了一个 ControlTemplate？如果是这样，那么如果您将 DataTemplate(s) 添加到 ControlTemplate 的资源部分，如下所示：

```
<ControlTemplate>
    <ControlTemplate.Resources>
        <!-- Data Templates Here -->
    </ControlTemplate.Resources>

    <!-- Rest of Control Template -->
</ControlTemplate> 
```

然后假设控件模板已被应用/加载，那么您将能够在您的控件中使用调用 this.FindResource() 找到该数据模板。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T12:59:21.100

我不确定我认为您需要在 XAML 中定义您使用的或具有新 x:Key 的静态资源，该 x:Key 对应于您想要更改的内容。

另一种选择是，如果您使用包含模板的文件合并资源，如下所示：

```
<ResourceDictionary.MergedDictionaries>
  <ResourceDictionary Source="SomeTemplate.xaml"/>
</ResourceDictionary.MergedDictionaries> 
```

在适当的地方，您将尝试找到资源

HTH，埃里克

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T23:03:38.367

归功于两者。

我尝试将资源移至 CT 的资源部分。即使这样，当我在运行时查看时，比如在 OnApplyTemplate 或 EndInit() 等中，this.Resources 中也没有对象:-( 尽管它都在控件的 Generic.xaml 中。

因此它始终返回 null 。

# sql - 在mysql中根据经理和员工级别选择数据

> ID：506564
> 
> 赞同：0
> 
> 时间：2009-02-03T10:03:50.313
> 
> 标签：sql, mysql

表结构是这样的——

id 名称管理器 1 aa NULL 2 hh 1 3 YY 4 4 Kk NULL 5 PP 4

所以我想要这样的结果 -

名称管理器 aa NULL hh aa Kk NULL YY Kk PP Kk

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-01T09:02:53.540

SELECT a.name AS employee, b.name AS manager FROM `employees`AS a JOIN employees AS b ON a.manager_id = b.id

这行得通，会给你员工和它的经理

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T10:07:35.797

尝试这个：

```
SELECT b.name, a.name FROM table AS a RIGHT JOIN table AS b ON a.manager = b.id 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-07T06:07:47.150

**未经测试**试试这个：

```
SELECT Name FROM table ORDER BY IFNULL(Manager,id), IFNULL(Manager,0), Name 
```

我*认为*这将使您将所有经理分组在一起，经理在他们应该按姓名排序的员工面前。不幸的是，我目前无法访问 MySQL 服务器实例进行测试。

# java - 如何在 Java 中成功扩展图形

> ID：506589
> 
> 赞同：4
> 
> 时间：2009-02-03T10:09:00.677
> 
> 标签：java, inheritance, graphics

我正在尝试创建一个通用图形导出工具，该工具通过实现 Graphics 接口并拦截和解释对其各种方法的调用来工作。但是，尽管我可以为单个组件成功地做到这一点，但当我在包含其他组件的组件上使用它时，我的 Graphics 类正在被替换。奇怪的是，这只发生在 Windows 和 Linux 上。在 OSX 上它工作正常。

谁能建议我如何确保它是传递给所有子组件的原始 Graphics 类？

我有一个简短的脚本来演示基本问题。当我使用 MyGraphics 的实例显式调用绘画时，我在 JPanel 中看不到 MyGraphics - 只是 sun.java2d.SunGraphics2D。

```
import java.awt.*;
import java.awt.image.*;
import java.text.AttributedCharacterIterator;
import javax.swing.*;

public class GraphicsTest {

public static void main(String[] args) {
    new GraphicsTest();
}

public GraphicsTest () {
    JFrame frame = new JFrame();
    frame.getContentPane().add(new MyPanel());
    frame.setSize(500,500);
    frame.setVisible(true);
    try {
        Thread.sleep(2000);
    } catch (InterruptedException e) {}
    System.out.println("Using my graphics - expect to see 'MyGraphics' next");
    frame.paint(new MyGraphics());

}

class MyPanel extends JPanel {
    public void paint (Graphics g) {
        super.paint(g);
        System.out.println("Graphics is "+g);

        g.fillRect(10, 10, 20, 20);
    }
}

class MyGraphics extends Graphics {

    public String toString () {
        return "MyGraphics";
    }

    public Graphics create() {
        return this;
    }

    // I've left out the huge list of abstract methods from the original script
    // since they're unchanged from the defaults and don't really matter here.
} 
```

在我的 Windows 系统上，输出是：

```
图形是 sun.java2d.SunGraphics2D[font=javax.swing.plaf.FontUIResource[family=Dialog,name=Dialog,style=plain,size=12],color=sun.swing.PrintColorUIResource[r=51,g=51 ,b=51]]
使用我的图形 - 期待接下来看到“MyGraphics”
图形是 sun.java2d.SunGraphics2D[font=javax.swing.plaf.FontUIResource[family=Dialog,name=Dialog,style=plain,size=12],color=sun.swing.PrintColorUIResource[r=51,g=51 ,b=51]]

```

而在 OSX 下，我得到了我的预期，即：

```
图形是 sun.java2d.SunGraphics2D[font=apple.laf.CUIAquaFonts$DerivedUIResourceFont[family=LucidaGrande,name=LucidaGrande,style=plain,size=13],color=javax.swing.plaf.ColorUIResource[r=0,g =0,b=0]]
使用我的图形 - 期待接下来看到“MyGraphics”
图形是我的图形

```

那么我能做些什么来确保在所有情况下都将“MyGraphics”传递给适当的子组件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T10:22:15.580

我不确定，但我怀疑 Swing 是由 Windows 上的 Java（而不是 OS X 上的窗口管理器）双缓冲的，你不会绘制到你的图形，而是绘制到由提供的 Graphics2D离屏缓冲区，然后 blt 到您的图形。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T10:48:11.877

就是这样！如果我在调用paint之前禁用组件上的双缓冲，然后重新启用它，那么一切都按我需要的方式工作。

```
RepaintManager.currentManager(frame).setDoubleBufferingEnabled(false);
frame.paint(new MyGraphics());
RepaintManager.currentManager(frame).setDoubleBufferingEnabled(true); 
```

谢谢。

# ruby - 在 GC Patched ruby 中安装 gem 的正确方法是什么？

> ID：506593
> 
> 赞同：3
> 
> 时间：2009-02-03T10:11:58.190
> 
> 标签：ruby, garbage-collection, rubygems, patch, memory-profiling

我想安装一个 GC Patched Ruby 来对我的应用程序进行内存分析。我按照[http://guides.rubyonrails.org/performance_testing.html#gc](http://guides.rubyonrails.org/performance_testing.html#gc)上的说明在我的主目录安装了一个 ruby​​ 实例（我已经有另一个“官方”实例用于开发）。这个 GC Patched ruby​​ 实例工作正常。

问题是当我需要将 gems 安装到这个实例时，正如上面指南中的步骤 1.8.6 告诉我的那样。我不能在我的机器上使用已经安装的 ruby​​gems，因为它指向其他 ruby​​ 实例。而且我无法将另一个 ruby​​gems 实例安装到我的 gc 修补的 ruby​​ 中。

这就是为什么我想知道在 GC 修补的 ruby​​ 上安装 ruby​​gems 的正确方法，在一台已经安装了另一个未修补的 ruby​​ 的机器上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T17:04:51.290

您需要设置您的`GEM_HOME`和`GEM_PATH`环境变量以指向您希望 ruby​​ 从中提取 gem 的目录。

还要确保修补的 ruby​​ 二进制文件出现在`PATH`环境变量中的其他版本之前，以确保它选择正确的版本。

# python - Twisted 是否有广泛使用的 STOMP 适配器？

> ID：506594
> 
> 赞同：2
> 
> 时间：2009-02-03T10:12:30.577
> 
> 标签：python, twisted, activemq, stomp

我检查了 stomper，它看起来并不完整。（我对 Python 很陌生）有人在生产环境中使用 stomper 吗？

如果没有，我想我将不得不推出我自己的 Twisted Stomp 适配器。

提前致谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T16:45:59.217

有一个名为[stomper](https://github.com/oisinmulvihill/stomper)的 python 库，我过去曾使用过 twisted（它带有扭曲的示例代码）。免责声明，我已经编写了 stomper 的代码，所以我喜欢它 :)

这些天来，我使用[txAMQP](https://launchpad.net/txamqp)和[py-amqplib](http://barryp.org/software/py-amqplib/)库从 stomp/ActiveMQ 转向 AMQP + [RabbitMQ 。](http://www.rabbitmq.com/)我发现 rabbit 更可靠，AMQP 协议也很好。请参阅[这篇文章](http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/)以获得非常好的概述。一个很大的好处是良好的 java 和 .net 库支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T13:02:58.017

Twisted Stomp 适配器太酷了。您会考虑分享它并让我们了解最新进展吗？

干杯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-01T19:21:22.463

我们刚刚开源了一个建立在 stomper 之上的源代码： [https ://github.com/mozes/stompest](https://github.com/mozes/stompest)

# java - 使用 JMS 连接到大型机

> ID：506595
> 
> 赞同：2
> 
> 时间：2009-02-03T10:12:42.230
> 
> 标签：java, jms, mainframe

我们目前正在使用 WebSphere MQ 从大型机获取数据，并且有时会在 MQ 端遇到问题。

我想知道是否有办法绕过 MQ 并使用 JMS 从大型机中获取数据。我们使用 WebSphere Application Server 6.0.2。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T10:18:00.240

抱歉，JMS 只是一个驱动程序接口而不是队列管理器实现。

JMS 和队列管理器之间的区别与 JDBC 和数据库之间的区别相同。

律师事务所，安德里亚

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T02:06:45.487

当然，您可以在 java 端使用 JMS，这将最终包装对 MQ 的调用。您只需要注意邮件标题。用另一个消息传递基础架构替换 MQ 取决于大型机可以与之通信的内容，因为我想您对此没有太多控制权，对吧？经常选择 MQ 是因为它受到 IBM 大型机系统的支持。

格雷格

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-10-26T17:44:57.873

请找出逻辑，

1.  我们必须使用 ConnectionFactory、Connection 和 Session 建立到服务器的连接

2.  我们需要使用 Queue 创建 Queue 引用

3.  需要为我们计划使用 TextMessage 发送到队列的 Message 创建一个对象

4.  我们必须创建对象来与队列交互。在这里，MessageProducer 用于发送我们在步骤 3 中创建的消息，MessageConsumer 用于接收响应

请找到下面的代码来实现，

```
//Instantiate a Sun Java(tm) System Message Queue ConnectionFactory 
ConnectionFactory myConnFactory = new com.sun.messaging.ConnectionFactory();

String h = "HOSTNAME";
String p = "PORTNO";

// Set imqAddressList property
((com.sun.messaging.ConnectionFactory)myConnFactory).setProperty(
com.sun.messaging.ConnectionConfiguration.imqAddressList,
new StringBuffer().append("mq://").append(h).append(":").append(p).append("/jms").toString());

//Create a connection to the Sun Java(tm) System Message Queue Message Service.
Connection myConn = myConnFactory.createConnection();

//Start the Connection created in step 3.
myConn.start();

//Create a session within the connection.
Session mySess = myConn.createSession(false, Session.AUTO_ACKNOWLEDGE);

//Instantiate a Sun Java(tm) System Message Queue Destination administered object.
Queue myQueue = new com.sun.messaging.Queue("<MODULENAME>");

//Create a message producer.
MessageProducer myMsgProducer = mySess.createProducer(myQueue);

//Create and send a message to the queue.
TextMessage myTextMsg = mySess.createTextMessage();
myTextMsg.setText("<message>");

System.out.println("Sending Message: " + myTextMsg.getText());
myMsgProducer.send(myTextMsg);

//Create a message consumer.
MessageConsumer myMsgConsumer = mySess.createConsumer(myQueue);

//Start the Connection created in step 3.
myConn.start();

//Receive a message from the queue.
Message msg = myMsgConsumer.receive();

//Retreive the contents of the message.
if (msg instanceof TextMessage) {
TextMessage txtMsg = (TextMessage) msg;
System.out.println("Read Message: " + txtMsg.getText());
}

//Close the session and connection resources.
mySess.close();
myConn.close(); 
```

# ios - UITableView中的iOS多列

> ID：506601
> 
> 赞同：35
> 
> 时间：2009-02-03T10:14:19.187
> 
> 标签：ios, uitableview

我有多行和多列数据。但是 iPhone UITableView 只包含单列和多行。如何按照 Apple 的人机界面指南显示我的多列数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-03-06T16:20:09.887

您可能需要自己构建它，或者使用[UIGridView 之](https://github.com/tanin47/UIGridView)类的库。（我是创造者）

您可以学习[UIGridView](https://github.com/tanin47/UIGridView)的源代码。真的很短。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-31T09:21:44.310

对于那些感兴趣的人，我刚刚将[MDSpreadView](https://github.com/mochidev/MDSpreadViewDemo)更新为*更快*，它实际上支持无限数量的行和列（直到`CGFloat`不再精确到像素），其 API 非常类似于`UITableView`. 更多信息在[我的网站](http://mochidev.com/open)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-06T07:35:11.480

如果您正在寻找看起来像 Excel 电子表格的东西，那么我会推荐这`MDSpreadview`门课。源代码可在[http://mochidev.com/open](http://mochidev.com/open)获得。它看起来很漂亮，但如果你有很多数据要显示，它就会陷入困境。

除此之外，您可能应该只创建自己的`UITableViewCell`. 使用 iOS5 的新 Storyboard 非常简单，您可以处理数百万个单元格的数据。

# sql - 在 MS SQL Server Management Studio 中处理事务的最佳方式

> ID：506602
> 
> 赞同：131
> 
> 时间：2009-02-03T10:14:48.857
> 
> 标签：sql, tsql, transactions

假设我有一个语法和语义正确的 SQL 语句，因此它可以执行。

在 Management Studio（或任何其他查询工具）中，我如何测试 SQL 语句，如果我发现它们破坏了某些东西，则回滚（在单独的查询中？）

* * *

## 回答 #1

> 赞同：238
> 
> 时间：2009-02-03T10:27:43.637

最简单的做法是将代码包装在事务中，然后逐行执行每批 T-SQL 代码。

例如，

```
Begin Transaction

         -Do some T-SQL queries here.

Rollback transaction -- OR commit transaction 
```

如果您想合并错误处理，您可以使用 TRY...CATCH BLOCK 来实现。如果发生错误，您可以在 catch 块中回滚事务。

例如：

```
USE AdventureWorks;
GO
BEGIN TRANSACTION;

BEGIN TRY
    -- Generate a constraint violation error.
    DELETE FROM Production.Product
    WHERE ProductID = 980;
END TRY
BEGIN CATCH
    SELECT 
        ERROR_NUMBER() AS ErrorNumber
        ,ERROR_SEVERITY() AS ErrorSeverity
        ,ERROR_STATE() AS ErrorState
        ,ERROR_PROCEDURE() AS ErrorProcedure
        ,ERROR_LINE() AS ErrorLine
        ,ERROR_MESSAGE() AS ErrorMessage;

    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION;
END CATCH;

IF @@TRANCOUNT > 0
    COMMIT TRANSACTION;
GO 
```

有关详细信息，请参阅以下链接。

[http://msdn.microsoft.com/en-us/library/ms175976.aspx](http://msdn.microsoft.com/en-us/library/ms175976.aspx)

希望这会有所帮助，但如果您需要更多详细信息，请告诉我。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2016-06-30T15:50:10.617

我想补充一点，如果你处于测试模式，你也可以（如果你写的东西很复杂，应该）添加一个测试变量来回滚。然后你可以一次执行整个事情。我还经常添加代码来查看各种操作的前后结果，特别是如果它是一个复杂的脚本。

下面的例子：

```
USE AdventureWorks;
GO
DECLARE @TEST INT = 1--1 is test mode, use zero when you are ready to execute
BEGIN TRANSACTION;

BEGIN TRY
     IF @TEST= 1
        BEGIN
            SELECT *FROM Production.Product
                WHERE ProductID = 980;
        END    
    -- Generate a constraint violation error.
    DELETE FROM Production.Product
    WHERE ProductID = 980;

     IF @TEST= 1
        BEGIN
            SELECT *FROM Production.Product
                WHERE ProductID = 980;
            IF @@TRANCOUNT > 0
                ROLLBACK TRANSACTION;
        END    
END TRY

BEGIN CATCH
    SELECT 
        ERROR_NUMBER() AS ErrorNumber
        ,ERROR_SEVERITY() AS ErrorSeverity
        ,ERROR_STATE() AS ErrorState
        ,ERROR_PROCEDURE() AS ErrorProcedure
        ,ERROR_LINE() AS ErrorLine
        ,ERROR_MESSAGE() AS ErrorMessage;

    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION;
END CATCH;

IF @@TRANCOUNT > 0 AND @TEST = 0
    COMMIT TRANSACTION;
GO 
```

# visual-studio - Subsonic 3 alpha 和 Visual Web Developer 2008：t4 模板的问题

> ID：506604
> 
> 赞同：1
> 
> 时间：2009-02-03T10:15:45.687
> 
> 标签：visual-studio, visual-studio-2008, t4

我在 Windows 7 beta 上使用 VWD 2008 Express。当我将 Subsonic 3 模板添加到我的 MVC RC 项目时，Web Developer Express 不会基于它们生成类。连接字符串正确。你有什么想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-28T08:02:44.543

这是因为 T4 模板需要 Visual Studio 标准版或更高版本。

有些人一直在尝试使用[命令行工具](http://msdn.microsoft.com/en-us/library/bb126245.aspx)生成代码来尝试一些解决方法，但我还没有看到真正适用于 Subsonic 3 的解决方法。有关更多信息，请参阅[此](https://stackoverflow.com/questions/786734/subsonic-asp-net-mvc-sample-in-visual-web-developer-express/1009950#1009950)答案。

# c++ - 用于 Visual C++ 的简单面向对象的 2D 图形框架？

> ID：506605
> 
> 赞同：3
> 
> 时间：2009-02-03T10:15:59.307
> 
> 标签：c++, visual-c++, graphics, mfc, 2d

我们正在构建一种通过 Visual C++ 应用程序 (MFC) 中的 GUI 以可视方式连接组件的方法。简单的事情，例如单击框并在连接的框之间画线，并在其上存储信息。问题是我们在 GDI 中从头开始自己制作所有这些，并且很快就需要维护大量代码。

我们真的在这里重新发明轮子吗？

我在网上四处寻找提供面向对象的 2D 框架的组件（矢量图形在这里很有趣）。面向对象的意思是屏幕上的正方形是代码中的正方形对象，或者至少您可以在图形对象上存储自定义信息。它应该支持在代码中检索对象位置等信息以在对象之间画线，并检测鼠标是否在对象上。

不是很复杂的事情，但是如果仅仅因为你自己写了所有的代码就需要维护成百上千行，那么它就会变得非常复杂和难以维护，更不用说潜在的 bug 潜入，这在成熟的环境中是可以避免的框架。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T12:17:30.433

也许矫枉过正，但看看[这个](http://www.box2d.org/)。还有[这个](http://en.wikipedia.org/wiki/Scalable_Vector_Graphics)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:28:33.227

你有没有看过direct2d，它是gdi的替代品。[http://blogs.technet.com/thomasolsen/archive/2008/10/29/introducing-the-microsoft-direct2d-api.aspx](http://blogs.technet.com/thomasolsen/archive/2008/10/29/introducing-the-microsoft-direct2d-api.aspx) [http://msdn.microsoft.com/en-us/library/dd370990(VS .85).aspx](http://msdn.microsoft.com/en-us/library/dd370990(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T13:57:22.323

我相信你会选择一个 OO 包，但不要指望奇迹。这就是为什么。

我假设您从一些应用程序数据开始，一组应用程序对象，我们称它们为对象 A。

您可以使用一个 OO 图形对象包来表示对象 A 的图形视图，将这组新的对象称为 G。

现在你有两组对象，A 和 G，其中任何一组都可以动态变化，你面临着保持它们正确对应的问题。不仅要从 A 生成 G，还要在 A 变化时修改 G，在 G 变化时修改 A。这需要大量事件驱动的链接代码，而且您永远无法确定您已经正确处理了每个案例。您很容易陷入所见即所得的*情况*。(所见即所得)

我有两个建议：

*   你在做什么

有一个直接渲染对象 A 的“绘制”例程（如果要避免闪烁，请使用“blt”）。将简单的图形信息附加到对象 A，例如屏幕位置和大小。自己处理鼠标事件，用于突出显示、拖动、创建连线等。这可能看起来很麻烦，但它避免了您在使用冗余对象集时遇到的所有链接问题。而且，您可以完全控制代码。

*   我使用的一种奇怪的方法：[差异执行](https://stackoverflow.com/questions/371898/how-does-differential-execution-work)

这是管理冗余对象集的通用技术。然而，它有一个艰难的学习曲线。大多数程序员都无法做到这一点，但它确实减少了代码并保证了正确性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T07:40:00.037

“绘制对象并将它们连接在一起”的描述听起来有点像 Fig (xfig / winfig / et al) 处理的东西。

另一个可能适合此目的的产品（尽管有一定的价格）是 Visio——Microsoft Office Visio SDK（参见[http://office.microsoft.com/en-us/visio/HA101656401033.aspx](http://office.microsoft.com/en-us/visio/HA101656401033.aspx)）据说非常丰富。

但是，从程序员的角度来看，我既没有看过 fig 也没有看过 Visio，所以我不知道底层代码是什么样的，也不知道它是否适合你的目的……但我认为它们都是很好的灵感起点。也许那里有另一个图形/图形库可能适合您的目的。

顺便说一句，在对此进行搜索（呃，谷歌搜索）时，我偶然发现了 AGD - [http://www.ads.tuwien.ac.at/research/graphDrawing.html](http://www.ads.tuwien.ac.at/research/graphDrawing.html)上的自动绘图。同样，不确定它是否适合您的特定情况，但指出它似乎很有趣。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T13:16:16.183

作为一个看起来很有用的 SVG 库（感谢 Malkocoglu 的想法！），我找到了这个：[libboard](http://libboard.sourceforge.net/)。代码示例的简单性看起来很棒；我剩下的唯一问题就是让用户与其生成的 SVG 绘图进行交互。:/ AFAIK，它甚至不包括渲染器，更不用说与其绘图交互的方法了。我不确定我是否愿意自己开发一个 SVG 解析器来控制这些需求。但是以编程方式构建图形的代码简单性看起来正是我所追求的。唔。

# sql - 简单的 SQL 问题（MySQL）

> ID：506607
> 
> 赞同：2
> 
> 时间：2009-02-03T10:17:25.717
> 
> 标签：sql, mysql

我有这个查询：

```
SELECT page.id, revision.title, revision.number
FROM page
    INNER JOIN revision ON page.id = revision.pageId 
```

这将返回如下内容：

```
"1"   "Page Version A"   "1"
"1"   "Page Version B"   "2"
"1"   "Page Version C"   "3" 
```

现在我只想为每一页返回一行，其中包含最新（最高编号）修订版的数据。如果我做：

```
SELECT page.id, revision.title, revision.number
FROM page
    INNER JOIN revision ON page.id = revision.pageId
GROUP BY page.id 
```

我得到：

```
"1"   "Page Version A"   "1" 
```

但我想要：

```
"1"   "Page Version C"   "3" 
```

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T10:24:57.883

添加类似于的 WHERE 子句

WHERE revision.number = (select max(number) from revision r where r.pageId = page.id)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:28:59.217

如果您只想选择一条记录，您可以使用 MySQL 'LIMIT' 关键字（类似于 MSSQL 'TOP'）

例如：

```
SELECT page.id, revision.title, revision.number
FROM page
    INNER JOIN revision ON page.id = revision.pageId

ORDER BY revision.number DESC
LIMIT 0, 1 
```

这将对您的所有结果进行排序，然后选择最高的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T10:41:11.627

如果这是您将多次运行的查询，我会考虑创建一个视图，以选择每个 pageid 的最新修订：

```
create view LatestRevision
as 
Select pageid, max(number) from revision 
```

那么查询将是

```
SELECT page.id, revision.title, revision.number
FROM page
    INNER JOIN revision ON page.id = revision.pageId
    INNER JOIN LatestRevision on revision.pageid = LatestRevision.pageid and revision.Number = LatestRevision.number 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-03T10:31:05.050

```
SELECT page.id, MAX(revision.number)
FROM page
INNER JOIN revision ON page.id = revision.pageId
GROUP BY page.id 
```

# c# - 使用 C# 以编程方式更新 xml

> ID：506609
> 
> 赞同：3
> 
> 时间：2009-02-03T10:18:15.840
> 
> 标签：c#, .net, xml, .net-2.0

我尝试在没有 linq 的情况下更新 xml（我使用的是 VC 2.0）。我的 xml 文件格式：

```
 <schedule>
<id>0</id>
<name>yusuf</name>
<status>0</status>
</schedule>

AFTER UPDATE:

<schedule>
<id>0</id>
<name>yusuf</name>
<status>1</status>
</schedule> 

```

但我没有任何想法将状态 =0 更新为状态 =1

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T10:20:52.480

您可以[`System.Xml.XmlDocument`](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)在任何版本的 .NET 中执行此操作（Silverlight 除外，仅`XDocument`存在）：

```
 XmlDocument doc = new XmlDocument();
    doc.LoadXml(xml); // or doc.Load(path)
    doc.SelectSingleNode("/schedule/status").InnerText = "1";
    string newXml = doc.OuterXml; // or doc.Save(path); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:24:35.310

将您的 XML 填充到 XmlDocument 中，进行更新，然后保存结果。

# asp.net - 如何让 JQuery 和 ASP.Net 一起工作？

> ID：506616
> 
> 赞同：0
> 
> 时间：2009-02-03T10:20:27.487
> 
> 标签：asp.net, javascript, jquery

在 ASPX 页面中使用 JQuery 时是否有任何原因无法工作？我们一直在尝试进行这样的简单调用：

```
$(document).ready(function() {
    alert("This is SPARTA!!!!!!!!!");
}); 
```

永远不会显示警报框。我在使用按钮之前对 JS 和 ASP.Net 有一些经验，我知道我必须在 JS 之后返回 false，例如：

```
<input type=button value="Button 1" 
   onclick='button_1_onclick();return false;'> 
```

有没有类似的事情要做？

编辑：我在调试器模式下运行了 Firebug，并且 JS 从未运行过，所有的库都存在于页面中。我唯一能想到的就是没有触发就绪事件或类似的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T11:09:50.010

ASP.NET and JQuery play really nicely together (and also with ASP.NET AJAX library too), I have used all of them together on a recent ASP.NET 3.5 web application. There are some [oddities to be aware of](http://encosia.com/2008/09/28/avoid-this-tricky-conflict-between-aspnet-ajax-and-jquery/), but on the whole work well together.

Firstly, you need to ensure that you have a script tag with src of your jQuery file-

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script> 
```

I have usually done this by adding a ScriptReference to the ScriptManager, but either way works. Then put your jQuery code after the script tag -

```
$(function() { alert("This is SPARTA!!!!!!!!!"); }); 
```

If your jQuery file is in a folder and you have some kind of authentication set up on your site, then you need to ensure that the folder is accessible on the pages where you are using jQuery, by modifying the web.config (much like you need to do with images and css). I've been tripped up by this before. You can check in firebug to see if the jQuery code is accessible (i.e. visible) by expanding the relevant script node; if you see some kind of HTTP error, then it could be due to the script not being accessible.

As others have already said, there could be conflicts with other JavaScript libraries. You can still use the $ shorthand if also using libraries by using the following pattern

```
(function($) {

$(function() { alert("This is SPARTA!!!!!!!!!"); });

})(jQuery); 
```

This means that $ within the scope of the outer function is shorthand for jQuery object.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T10:33:30.643

您是否同时使用另一个库？$ 可能已被重新分配，试试这个：

```
jQuery(document).ready(function() {
    alert("This is SPARTA!!!!!!!!!");
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T10:33:38.240

这可能有两个原因：

1）您可能会错过

```
<script language="JavaScript" src="JQuery.js"></script> 
```

陈述。

2) A semicolon is missing at the end of your alert. It should be:

```
$(document).ready(function() {   alert("This is SPARTA!!!!!!!!!"); }); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T10:59:36.270

Have you tried putting the JavaScript reference after any CSS includes?

I have had problems where `$(document).ready` didn't run since the CSS classes had not been loaded. Moving the jQuery include seem to sort it out.

Might not be the same as your problem but it is worth a try.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T13:33:44.420

Maybe you have made the same mistake as me:

I included the jQuery script reference in my master page. The result was that the .Aspx page could not find the JQuery.js file, because I put it in a different folder.

In the masterpage I now include the jQuery, using

```
<script src="<%= this.ResolveUrl("~/js/jquery.js") %>"></script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T14:08:54.790

I tried this. You need to reference the jquery library and you need to have the $(document).ready function. You also need to reference your button with a class so that jquery can find which button you're looking for. You then tell jquery what you're going to do with that object, such as using .click().

Here is some code: Reference the jquery library.

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js"></script> 
```

Wrap the following in a script tag.

```
 $(document).ready(function()
    { 
        $('.clicker').click(function() 
        {

           alert('This is SPARTA!!!!');
        });
    }); 
```

Then in the HTML of the page you make your button like this:

```
<input type="button" value="Show Alert" class="clicker" /> 
```

Hope this helps some.

# php - 什么是完全解析 url 的最有效方法（使用 php 和 curl）

> ID：506621
> 
> 赞同：1
> 
> 时间：2009-02-03T10:22:41.413
> 
> 标签：php, curl

在所有 30x 重定向和位置标头之后，我正在寻找将给定 url 解析为其最终端点的最有效方法。

基本上，我有一堆像[http://foo.com](http://foo.com)这样的 URL，当你访问它们时，它们最终会出现在像[http://foo.com/Welcome.html](http://foo.com/Welcome.html)这样的页面上，我需要找到最后一个 URL。

现在，我正在使用`CURLOPT_FOLLOWLOCATION`and `CURLOPT_NOBODY`（因为我真的不关心返回的文本），一旦它被执行，我运行 curl_getinfo() 并从该数组中保存 'url' 键。

我只是一直在想，这是一种巨大的浪费，`<something>`可能有更好的方法。

编辑：对于那些稍后阅读此内容的人。我最终找到了一个更好的解决方案（不涉及 curl），请参阅php5+ 中的[get_headers()](http://php.net/manual/en/function.get-headers.php)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T12:09:53.243

您可以通过分析接收到的标头在 php 中手动执行此操作，但 cURL 执行完全相同的操作。没有其他直接的方法，cURL 是最舒服的一种。别管它。

或者你可以使用一些已经被爬虫检索到的搜索引擎信息。

# ios - CGContextDrawImage 在传递 UIImage.CGImage 时将图像倒置

> ID：506622
> 
> 赞同：185
> 
> 时间：2009-02-03T10:23:11.117
> 
> 标签：ios, cocoa-touch, core-graphics, cgcontextdrawimage

有谁知道为什么`CGContextDrawImage`要把我的形象颠倒过来？我正在从我的应用程序中加载图像：

```
UIImage *image = [UIImage imageNamed:@"testImage.png"]; 
```

然后简单地要求核心图形将其绘制到我的上下文中：

```
CGContextDrawImage(context, CGRectMake(0, 0, 145, 15), image.CGImage); 
```

它呈现在正确的位置和尺寸，但图像是颠倒的。我必须在这里遗漏一些非常明显的东西？

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2009-02-06T20:46:51.277

代替

```
CGContextDrawImage(context, CGRectMake(0, 0, 145, 15), image.CGImage); 
```

采用

```
[image drawInRect:CGRectMake(0, 0, 145, 15)]; 
```

在开始/结束`CGcontext`方法的中间。

这会将具有正确方向的图像绘制到您当前的图像上下文中 - 我很确定这与`UIImage`保持方向知识有关，而该`CGContextDrawImage`方法在不了解方向的情况下获取底层原始图像数据。

* * *

## 回答 #2

> 赞同：217
> 
> 时间：2009-02-04T12:49:36.610

即使在应用了我提到的所有内容之后，我仍然有带有图像的戏剧。最后，我刚刚使用 Gimp 为我的所有图像创建了一个“垂直翻转”版本。现在我不需要使用任何变换。希望这不会导致进一步的问题。

> 有谁知道为什么 CGContextDrawImage 会颠倒我的图像？我正在从我的应用程序中加载图像：

Quartz2d 使用不同的坐标系，原点在左下角。因此，当 Quartz 绘制 100 * 100 图像的像素 x[5]、y[10] 时，该像素被绘制在左下角而不是左上角。从而导致“翻转”图像。

x 坐标系匹配，因此您需要翻转 y 坐标。

```
CGContextTranslateCTM(context, 0, image.size.height); 
```

这意味着我们将图像在 x 轴上平移了 0 个单位，在 y 轴上平移了图像高度。但是，仅此一项就意味着我们的图像仍然是颠倒的，只是在我们希望绘制的位置下方绘制“image.size.height”。

Quartz2D 编程指南建议使用 ScaleCTM 并传递负值来翻转图像。您可以使用以下代码来执行此操作 -

```
CGContextScaleCTM(context, 1.0, -1.0); 
```

在您打电话之前将两者结合起来`CGContextDrawImage`，您应该可以正确绘制图像。

```
UIImage *image = [UIImage imageNamed:@"testImage.png"];    
CGRect imageRect = CGRectMake(0, 0, image.size.width, image.size.height);       

CGContextTranslateCTM(context, 0, image.size.height);
CGContextScaleCTM(context, 1.0, -1.0);

CGContextDrawImage(context, imageRect, image.CGImage); 
```

如果您的 imageRect 坐标与您的图像的坐标不匹配，请小心，因为您可能会得到意想不到的结果。

要转换回坐标：

```
CGContextScaleCTM(context, 1.0, -1.0);
CGContextTranslateCTM(context, 0, -imageRect.size.height); 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2013-08-07T05:47:55.447

两全其美，使用 UIImage`drawAtPoint:`或`drawInRect:`同时指定您的自定义上下文：

```
UIGraphicsPushContext(context);
[image drawAtPoint:CGPointZero]; // UIImage will handle all especial cases!
UIGraphicsPopContext(); 
```

`CGContextTranslateCTM`您还避免使用第二个`CGContextScaleCTM`答案修改您的上下文。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-04-08T06:11:33.833

相关 Quartz2D 文档：[https ://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html#//apple_ref/doc/uid/TP40010156-CH14-SW4](https://developer.apple.com/library/ios/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html#//apple_ref/doc/uid/TP40010156-CH14-SW4)

> **翻转默认坐标系**
> 
> UIKit 绘图中的翻转会修改支持的 CALayer，以将具有 LLO 坐标系的绘图环境与 UIKit 的默认坐标系对齐。如果您只使用 UIKit 方法和函数进行绘图，则不需要翻转 CTM。但是，如果您将 Core Graphics 或 Image I/O 函数调用与 UIKit 调用混合，则可能需要翻转 CTM。
> 
> 具体来说，如果您通过直接调用 Core Graphics 函数来绘制图像或 PDF 文档，则对象会在视图的上下文中颠倒呈现。您必须翻转 CTM 才能正确显示图像和页面。
> 
> 要翻转绘制到 Core Graphics 上下文的对象，以便它在 UIKit 视图中显示时正确显示，您必须分两步修改 CTM。将原点平移到绘图区域的左上角，然后应用比例平移，将 y 坐标修改为 -1。执行此操作的代码类似于以下内容：

```
CGContextSaveGState(graphicsContext);
CGContextTranslateCTM(graphicsContext, 0.0, imageHeight);
CGContextScaleCTM(graphicsContext, 1.0, -1.0);
CGContextDrawImage(graphicsContext, image, CGRectMake(0, 0, imageWidth, imageHeight));
CGContextRestoreGState(graphicsContext); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-02-18T14:20:40.980

如果有人对在上下文中以自定义矩形绘制图像的简单解决方案感兴趣：

```
 func drawImage(image: UIImage, inRect rect: CGRect, context: CGContext!) {

    //flip coords
    let ty: CGFloat = (rect.origin.y + rect.size.height)
    CGContextTranslateCTM(context, 0, ty)
    CGContextScaleCTM(context, 1.0, -1.0)

    //draw image
    let rect__y_zero = CGRect(origin: CGPoint(x: rect.origin.x, y:0), size: rect.size)
    CGContextDrawImage(context, rect__y_zero, image.CGImage)

    //flip back
    CGContextScaleCTM(context, 1.0, -1.0)
    CGContextTranslateCTM(context, 0, -ty)

} 
```

图像将被缩放以填充矩形。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-03T10:34:26.477

我不确定`UIImage`，但这种行为通常发生在翻转坐标时。大多数 OS X 坐标系的原点位于左下角，如 Postscript 和 PDF。但是`CGImage`坐标系的原点在左上角。

可能的解决方案可能涉及`isFlipped`属性或`scaleYBy:-1`仿射变换。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2019-09-30T08:28:44.700

发生这种情况是因为 QuartzCore 的坐标系是“左下角”，而 UIKit 是“左上角”。

在这种情况下，您可以扩展**CGContext**：

```
extension CGContext {
  func changeToTopLeftCoordinateSystem() {
    translateBy(x: 0, y: boundingBoxOfClipPath.size.height)
    scaleBy(x: 1, y: -1)
  }
}

// somewhere in render 
ctx.saveGState()
ctx.changeToTopLeftCoordinateSystem()
ctx.draw(cgImage!, in: frame) 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-10-20T06:00:26.430

我使用这个**Swift 5**纯**核心图形**扩展，它可以正确处理图像矩形中的非零原点：

```
extension CGContext {

    /// Draw `image` flipped vertically, positioned and scaled inside `rect`.
    public func drawFlipped(_ image: CGImage, in rect: CGRect) {
        self.saveGState()
        self.translateBy(x: 0, y: rect.origin.y + rect.height)
        self.scaleBy(x: 1.0, y: -1.0)
        self.draw(image, in: CGRect(origin: CGPoint(x: rect.origin.x, y: 0), size: rect.size))
        self.restoreGState()
    }
} 
```

您可以像使用`CGContext`常规`draw(: in:)`方法一样使用它：

```
ctx.drawFlipped(myImage, in: myRect) 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-07-31T23:26:32.087

`UIImage`包含 a`CGImage`作为其主要内容成员以及缩放和方向因素。由于`CGImage`它的各种功能都是从 OSX 派生的，因此它需要一个与 iPhone 相比颠倒的坐标系。创建 时`UIImage`，它默认为上下颠倒的方向以进行补偿（您可以更改它！）。使用 。`CGImage`属性来访问非常强大的`CGImage`功能，但绘制到 iPhone 屏幕等最好使用`UIImage`方法。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-12-22T03:25:46.050

**Swift 代码的补充答案**

Quartz 2D 图形使用原点在左下角的坐标系，而 iOS 中的 UIKit 使用原点在左上角的坐标系。通常一切正常，但是在进行一些图形操作时，您必须自己修改坐标系。该[文档](https://developer.apple.com/library/mac/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_overview/dq_overview.html#//apple_ref/doc/uid/TP30001066-CH202-CJBBAEEC)指出：

> 一些技术使用与 Quartz 使用的不同的默认坐标系来设置它们的图形上下文。相对于 Quartz，这样的坐标系是一种修改后的坐标系，在进行一些 Quartz 绘图操作时必须进行补偿。最常见的修改坐标系将原点放在上下文的左上角，并将 y 轴更改为指向页面底部。

这种现象可以在以下两个在其`drawRect`方法中绘制图像的自定义视图实例中看到。

[![在此处输入图像描述](https://i.stack.imgur.com/WSPWq.png)](https://i.stack.imgur.com/WSPWq.png)

在左侧，图像是上下颠倒的，而在右侧，坐标系已被平移和缩放，因此原点位于左上角。

**颠倒的图像**

```
override func drawRect(rect: CGRect) {

    // image
    let image = UIImage(named: "rocket")!
    let imageRect = CGRect(x: 0, y: 0, width: image.size.width, height: image.size.height)

    // context
    let context = UIGraphicsGetCurrentContext()

    // draw image in context
    CGContextDrawImage(context, imageRect, image.CGImage)

} 
```

**修改坐标系**

```
override func drawRect(rect: CGRect) {

    // image
    let image = UIImage(named: "rocket")!
    let imageRect = CGRect(x: 0, y: 0, width: image.size.width, height: image.size.height)

    // context
    let context = UIGraphicsGetCurrentContext()

    // save the context so that it can be undone later
    CGContextSaveGState(context)

    // put the origin of the coordinate system at the top left
    CGContextTranslateCTM(context, 0, image.size.height)
    CGContextScaleCTM(context, 1.0, -1.0)

    // draw the image in the context
    CGContextDrawImage(context, imageRect, image.CGImage)

    // undo changes to the context
    CGContextRestoreGState(context)
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-08-04T10:41:40.347

***斯威夫特 3.0 和 4.0***

```
yourImage.draw(in: CGRect, blendMode: CGBlendMode, alpha: ImageOpacity) 
```

无需改动

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-02-22T05:57:20.200

`drawInRect`肯定是要走的路。这是另一个在执行此操作时会派上用场的小东西。通常图片和它要进入的矩形不符合。在这种情况下`drawInRect`将拉伸图片。这是一种快速而酷的方法来确保图片的纵横比不会改变，通过反转转换（这将适合整个事物）：

```
//Picture and irect don't conform, so there'll be stretching, compensate
    float xf = Picture.size.width/irect.size.width;
    float yf = Picture.size.height/irect.size.height;
    float m = MIN(xf, yf);
    xf /= m;
    yf /= m;
    CGContextScaleCTM(ctx, xf, yf);

    [Picture drawInRect: irect]; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-08-25T06:27:55.470

我们可以使用相同的函数来解决这个问题：

```
UIGraphicsBeginImageContext(image.size);

UIGraphicsPushContext(context);

[image drawInRect:CGRectMake(gestureEndPoint.x,gestureEndPoint.y,350,92)];

UIGraphicsPopContext();

UIGraphicsEndImageContext(); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-08-31T20:05:04.873

**Swift 3 CoreGraphics 解决方案**

如果您出于任何原因想使用 CG，而不是 UIImage，这个基于先前答案的 Swift 3 构造确实为我解决了这个问题：

```
if let cgImage = uiImage.cgImage {
    cgContext.saveGState()
    cgContext.translateBy(x: 0.0, y: cgRect.size.height)
    cgContext.scaleBy(x: 1.0, y: -1.0)
    cgContext.draw(cgImage, in: cgRect)
    cgContext.restoreGState()
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-15T16:13:31.560

在我的项目过程中，我从[Kendall 的回答](https://stackoverflow.com/a/522091/1338292)跳到[Cliff 的回答](https://stackoverflow.com/a/511199/1338292)，以解决从手机本身加载的图像的这个问题。

最后我最终[`CGImageCreateWithPNGDataProvider`](https://developer.apple.com/library/mac/documentation/graphicsimaging/reference/CGImage/Reference/reference.html#//apple_ref/c/func/CGImageCreateWithPNGDataProvider)改用：

```
NSString* imageFileName = [[[NSBundle mainBundle] resourcePath] stringByAppendingPathComponent:@"clockdial.png"];

return CGImageCreateWithPNGDataProvider(CGDataProviderCreateWithFilename([imageFileName UTF8String]), NULL, YES, kCGRenderingIntentDefault); 
```

这不会受到从`CGImage`a获得的方向问题的影响`UIImage`，它可以用作 a 的内容而`CALayer`没有任何障碍。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-05-03T12:06:37.670

```
func renderImage(size: CGSize) -> UIImage {
    return UIGraphicsImageRenderer(size: size).image { rendererContext in
        // flip y axis
        rendererContext.cgContext.translateBy(x: 0, y: size.height)
        rendererContext.cgContext.scaleBy(x: 1, y: -1)

        // draw image rotated/offsetted
        rendererContext.cgContext.saveGState()
        rendererContext.cgContext.translateBy(x: translate.x, y: translate.y)
        rendererContext.cgContext.rotate(by: rotateRadians)
        rendererContext.cgContext.draw(cgImage, in: drawRect)
        rendererContext.cgContext.restoreGState()
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-09-20T07:24:00.230

**基于@ZpaceZombor 的优秀答案的**Swift 5答案****

 **如果您有 UIImage，只需使用

```
var image: UIImage = .... 
image.draw(in: CGRect) 
```

如果您有 CGImage，请使用下面的我的类别

注意：与其他一些答案不同，这个答案考虑到您要绘制的矩形可能有 y != 0。那些没有考虑到这一点的答案是不正确的，并且在一般情况下不起作用。

```
extension CGContext {
    final func drawImage(image: CGImage, inRect rect: CGRect) {

        //flip coords
        let ty: CGFloat = (rect.origin.y + rect.size.height)
        translateBy(x: 0, y: ty)
        scaleBy(x: 1.0, y: -1.0)

        //draw image
        let rect__y_zero = CGRect(x: rect.origin.x, y: 0, width: rect.width, height: rect.height)
        draw(image, in: rect__y_zero)

        //flip back
        scaleBy(x: 1.0, y: -1.0)
        translateBy(x: 0, y: -ty)

    }
} 
```

像这样使用：

```
let imageFrame: CGRect = ...
let context: CGContext = ....
let img: CGImage = ..... 
context.drawImage(image: img, inRect: imageFrame) 
```

* * *

## 回答 #18

> 赞同：-5
> 
> 时间：2012-04-04T01:55:04.057

您也可以通过以下方式解决此问题：

```
//Using an Image as a mask by directly inserting UIImageObject.CGImage causes
//the same inverted display problem. This is solved by saving it to a CGImageRef first.

//CGImageRef image = [UImageObject CGImage];

//CGContextDrawImage(context, boundsRect, image);

Nevermind... Stupid caching. 
```

# wcf - WCF 配置元素：baseAddressPrefixFilters

> ID：506634
> 
> 赞同：6
> 
> 时间：2009-02-03T10:26:44.183
> 
> 标签：wcf, configuration-files

我已经阅读了这个元素的文档，但仍然无法理解它的目的是什么。这是我在示例中看到的示例：

```
<serviceHostingEnvironment>
  <baseAddressPrefixFilters>
    <add prefix="http://localhost:5100/"/>
  </baseAddressPrefixFilters>
</serviceHostingEnvironment> 
```

我想了解服务节点中的基地址没有做什么。我不明白这个元素的实际用途。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T12:32:00.373

WCF 服务主机将只允许每个方案有一个基地址（在本例中为 HTTP）。现在，如果您在配置有多个基地址（例如[http://www.example.com](http://www.example.com)和[http://example.com](http://example.com) ）的 IIS 上部署 WCF 服务，您将看到一个错误。使用 baseAddressPrefixFilters 您可以过滤两个基地址之一，您的服务将运行得很好。

# c# - C# 对象构造函数 - 速记属性语法

> ID：506635
> 
> 赞同：10
> 
> 时间：2009-02-03T10:27:15.073
> 
> 标签：c#, class, object

几个月前，我读到了一种技术，如果您传入的参数与局部变量匹配，那么您可以使用一些简写语法来设置它们。为了避免这种情况：

```
public string Method(p1, p2, p3)
{
    this.p1 = p1;
    this.p2 = p2;
    this.p3 = p3;
} 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-03T10:32:37.963

您可能正在考虑 C# 3.0 中的新对象初始值设定项语法。它看起来像这样：

```
var foo = new Foo { Bar = 1, Fizz = "hello" }; 
```

这给了我们一个新的 Foo 实例，“Bar”属性初始化为 1，“Fizz”属性初始化为“hello”。

这种语法的诀窍是，如果您省略“=”并提供标识符，它将假定您分配给同名的属性。因此，例如，如果我已经有一个 Foo 实例，我可以这样做：

```
var foo2 = new Foo { foo1.Bar, foo1.Fizz }; 
```

那么，这与您的示例非常接近。如果你的类有 p1、p2 和 p3 属性，并且你有同名的变量，你可以这样写：

```
var foo = new Foo { p1, p2, p3 }; 
```

请注意，这仅用于构造实例 - 不是用于将参数传递给您的示例所示的方法 - 所以它可能不是您所想的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2019-05-28T11:04:20.877

在 C# 7 中有一种更简单的方法 - 表达式体构造函数。

使用上面的示例-您的构造函数可以简化为一行代码。为了完整起见，我已经包含了类字段，我想它们无论如何都会在你的类中。

```
private string _p1;
private int _p2;
private bool _p3;  

public Method(string p1, int p2, bool p3) => (_p1, _p2, _p3) = (p1, p2, p3); 
```

有关更多信息，请参阅以下链接：-

[https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/expression-bodied-members](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/expression-bodied-members)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T10:31:56.670

您可能会想到 C# 中的“对象初始化器”，您可以在其中通过设置类的属性来构造对象，而不是使用参数化的构造函数。

我不确定它是否可以在您的示例中使用，因为您的“this”已经构建。

# c# - 在 C# (ASP.net) 中删除查询字符串的最快方法是什么

> ID：506636
> 
> 赞同：3
> 
> 时间：2009-02-03T10:27:23.917
> 
> 标签：c#, asp.net-2.0, query-string

我有一个问题，该公司使用业务跟踪系统捕获用户的首次访问并将他们重定向到他们尝试访问但附加了引用 URL 的页面......现在，由于引用 URL 带有该人的 URL试图访问（不要问为什么，我不知道）它导致我拥有每个值的副本。

所以参观这个...

**home.aspx?test=test&test2=test2**

变成

**home.aspx?test=test&test2=test2&referrerurl=home.aspx?test=test&test2=test2**

现在，对引荐来源网址进行 URL 编码可以解决问题，但我更有可能被大猩猩骚扰；所以问题是存在的。如何对 .QueryString 的输出进行重复数据删除？

目前我正在使用这个...

```
private string queryClean(string entity)
{
    try
    {
        if(Request.QueryString["referrerUrl"] != null){
        string[] Split = entity.Split(new Char[] { ',' });
        string tmpValue = Convert.ToString(Split[0]);

        return tmpValue;
        }else{ return entity; }
    }
    catch (Exception cleanError) 
    { 
        errors.Text += "-clean-" + cleanError + "-endclean-";
        return entity;
    }

} 
```

（忽略我们有应用程序级错误捕获的 try/catch，但我仍在使用它）。

我正在使用 C# .net 2

谢谢

* * *

[附加信息]

引用 URL 将始终位于字符串的末尾，因此可以在此之后删除所有查询字符串吗？

我试过使用

```
string test = Convert.ToString(Request.QueryString);
string[] tRSplit = Regex.Split(test, "&referrerUrl");
Response.Write(tRSplit[0]); 
```

和...

```
System.Collections.Generic.List<string> testb = new System.Collections.Generic.List<string>(Convert.ToString(Request.QueryString).Split('&'));
            for (int i = 0; i < testb.Count; i++)
            {

                Response.Write(i +": "+ testb[i].ToString()+"<br><br>");
            } 
```

两者仍然产生重复

* * *

我可以使用[Trim](http://www.developerfusion.com/code/4398/string-manipulation-in-c/)但是有没有更清洁/更快的方法来实现这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T11:26:31.490

像这样的东西应该工作：

```
NameValueCollection fixedQueryString = new NameValueCollection();
foreach (string key in Request.QueryString.Keys)
{
  string value = Request.QueryString[key];
  if(value.Contains(","))
  {
     value = value.Split(',')[0];
  }
  fixedQueryString.Add(key, value);
} 
```

此代码将创建一个新的 NameValueCollection，我们将在其中重建查询字符串。然后我们检查每个值的 a ，这通常表明一个值重复了不止一次。例如，url home.aspx?test=test&test2=test2&referrerurl=home.aspx?test=test&test2=test2 将为查询字符串值“test”生成值“test, test”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T11:00:47.750

我假设您无法控制重定向，对吗？我自己去过那里，我很抱歉。您的问题在理论上是无法解决的，但趋势似乎是那些不使用 URI 编码参数的可爱的人只是将它们附加到 URL，因此您可以获得原始查询字符串（来自 request.RawUrL 属性）并忽略之后的所有内容推荐人网址。这很丑陋，但基本上：

```
if(Request.QueryString["referrerUrl"] != null)
{
    string qs = request.RawUrl.Substring(request.RawUrl.IndexOf("?") + 1);
    qs = qs.Substring(0, qs.IndexOf("referrerUrl"));
    ReplaceQuerystring(qs);
} 
```

ReplaceQuerystring 现在接收查询字符串为“var1=valA&var2=varB&”。只需在 & 符号上切分，在等号上切分每个部分，URL 解码并存储在某处（实际上， request.QueryString 应该是可变的，所以这可能是一个选项）。至少，这几乎是我做的方式。为了您，我希望有人提出更好的解决方案:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T12:10:14.473

**[示例网址]**

Default2.aspx?test=test&test2=test2&referrerURL= [http://www.test.com/home.aspx?test=test&test=test](http://www.test.com/home.aspx?test=test&test=test)

**[这会产生]**

test=test
test=test
test2=test2
referrerURL= [http://www.test.com/home.aspx?test=test](http://www.test.com/home.aspx?test=test)

**[所以 gustafc 答案的编辑版本......]**

```
 //Capture the raw url
    test = Request.RawUrl.ToString();
    //Set the start index as 1 after the query ?
    int startTxt = (test.IndexOf("?") + 1);
    //Find the number of characters between ? and &referrerURL
    int countTxt = ((test.IndexOf("&referrerURL")-1) - test.IndexOf("?"));
    //Capture the substring and split into a string array using &
    string[] aTest = test.Substring(startTxt, countTxt).Split(new Char[] { '&' }); 
```

**[运行测试产生以下结果]**

-0~测试=测试

-1~test2=test2

**[这是我期望收到的]**

***（为了完整性，这里是简单的 for 语句）***

```
 for (int i = 0; i < aTest.Length; i++)
    {
        Response.Write("<br>-" + i + "~" + Convert.ToString(aTest[i]) + "<br>");
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-30T16:33:40.550

下面的示例读取所有“email”查询字符串参数，并通过读取“email”字符串并将内容添加到名为“email1”的新字符串中，直到找到逗号，只获取第一次出现的参数。对于新手来说非常简单易用。

```
string email = Request.QueryString["email"];
string email1 = "";
for(int i = 0; i < email.Length; i++)
{
    if (email[i] != ',')
    {
        email1 += email[i].ToString();
    }
    else
    {
        break;
    }
}
email = email1; 
```

# .net - 当我将 .NET 按钮的 BackColor 更改回其原始值时，它看起来不再一样了

> ID：506641
> 
> 赞同：10
> 
> 时间：2009-02-03T10:28:27.767
> 
> 标签：.net, button, backcolor

我有一个按钮，我想简单地“闪烁”以引起用户的注意。我认为最简单的方法是将 Button 的`BackColor`属性更改为另一种颜色，然后再将其切换回来。所以我做这样的事情：

```
this.oldColor = myButton.BackColor;
myButton.BackColor = Color.Blue; 
```

然后大约 1/2 秒后：

```
myButton.BackColor = this.oldColor; 
```

但是按钮的背景颜色最终*明显*比表单上的其他按钮更暗！

起初，我认为这是因为按钮的原始颜色是命名颜色（在本例中为“Control”）有一些特别之处，但事实并非如此。

更糟糕的是，当我`myButton.BackColor`在调试器中查看时，我得到了

```
{Name=Control, ARGB=(255, 236, 233, 216)} 
```

这是完全正确的！但是当我截屏并检查颜色时，它与其余按钮不一样！

是否有某种掩蔽发生？或者也许是某种抖动？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-03T11:24:18.933

我找出了问题的原因。原来还有另一个名为`UseVisualStyleBackColor`. 它控制在计算`BackColor`. 更糟糕的是，一旦你设置了`BackColor`，它就会设置为`false`。所以我最终这样做了：

```
this.oldUseVisualStyleBackColor = myButton.UseVisualStyleBackColor;
this.oldColor = myButton.BackColor;
myButton.BackColor = Color.Blue; 
```

当我准备好重置它时：

```
myButton.BackColor = this.oldColor;
myButton.UseVisualStyleBackColor = this.oldUseVisualStyleBackColor; 
```

（是的，您必须先重置`BackColor`，然后才能设置`UseVisualStyleBackColor`。）

我不知道为什么`UseVisualStyleBackColor`要使用它，或者它为什么会这样做，但它现在似乎可以工作了。

（谢谢，马克！没有你的帮助，我不会找到这个！）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T10:30:41.647

我怀疑区别在于一个是常规的 argb 颜色，一个是系统/已知颜色。

.NET 中的控件跟踪颜色是显式的（在此控件上设置）还是继承的。这使得很难正确改回......但您可以使用 来做到这一点`PropertyDescriptor`，如下所示：

```
 TextBox tb = new TextBox();
    tb.BackColor = Color.Red;
    // now set it back to inherited
    PropertyDescriptor prop = TypeDescriptor.GetProperties(tb)["BackColor"];
    if (prop.CanResetValue(tb))
    {
        prop.ResetValue(tb);
    } 
```

有点笨拙，但它应该工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-12T17:06:21.663

按钮的 UseVisualStyleBackColor 属性确定按钮的背景是否使用视觉样式绘制。当按钮的 UseVisualStyleBackColor 属性设置为 True 时，BackColor 属性将被忽略。当 BackColor 属性更改为不同的颜色时，UseVisualStyleBackColor 属性会自动设置为 False。

当您处于设计模式时，您可以看到这种效果。创建一个按钮并将 BackColor 属性更改为红色。然后向下滚动到 UseVisualStyleBackColor 属性，并注意它已设置为 False。如果随后将 UseVisualStyleBackColor 属性设置为 True，则按钮颜色将变回默认颜色。将 UseVisualStyleBackColor 属性切换回 False 会将按钮颜色更改回红色。

下面的程序演示了这种效果。

```
Private Sub Form1_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load
    Button1.BackColor = Color.Red
End Sub

Private Sub Button1_Click(sender As System.Object, e As System.EventArgs) Handles Button1.Click
    Button1.UseVisualStyleBackColor = Not Button1.UseVisualStyleBackColor
End Sub 
```

感谢 scraimer 发布他的问题并将 UseVisualStyleBackColor 属性识别为有罪的罪魁祸首。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-09T10:24:45.887

或者你可以输入：

```
TextBox tb = new TextBox();
//Change the Backcolor
tb.BackColor = Color.Red;
//Resets the Backcolor to its default value, its pretty strange that you don't see the method but it works with allmost all properties
tb.ResetBackColor(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-01T22:51:04.530

简单的方法：

```
myButton.BackColor = Color.Empty 
```

# java - 在容器而不是 web.xml 中指定身份验证

> ID：506643
> 
> 赞同：1
> 
> 时间：2009-02-03T10:28:38.500
> 
> 标签：java, authentication, containers, war

`.war`我们将我们的网络应用程序作为文件分发给我们的客户。这样，用户就可以将战争部署到他们的容器中，他们就可以开始了。问题是我们的一些客户希望进行身份验证，并使用用户名作为应用程序中某些操作的参数。

我知道如何使用 web.xml 进行配置，但这意味着我们要么必须告诉我们的客户在 war 文件中进行修改，要么分发 2 个单独的战争；一种具有身份验证（和预定义角色），一种没有。

我也不想对我们的客户强制进行身份验证，因为这通常需要更多关于 Java 容器和 Web 服务器的知识，并且让我们更难将我们的应用程序用于试驾。

有没有办法在容器中进行身份验证配置，而不是在 Web 应用程序本身中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T12:07:45.243

在 web.xml 中，定义安全约束以将 Web 资源集合绑定到 J2EE 角色和登录配置（两者都适用于希望对应用程序的某些资源进行访问控制的客户）。

然后，让客户将您的 Web 应用程序中定义的 J2EE 角色绑定到用户组特定用户和在他们的应用程序服务器上定义的组。不想要任何访问控制的客户可以将所有角色绑定到未经授权的用户（该用户组的名称特定于应用服务器，例如 Websphere 将其称为“所有人”）。想要将您的 web 应用程序中的资源的访问权限限制为一组有限的用户或用户组的客户可以通过根据他们的需要将角色绑定到用户/组来实现。

如果需要身份验证来验证用户在角色中的成员身份，则将使用 web.xml 中登录配置中指定的身份验证方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T10:39:01.227

将用户信息存储在例如数据源（数据库）中是常见的做法。让您的应用程序使用相同的数据源进行身份验证。数据库相对容易维护。您甚至可以实现一些管理页面来维护应用程序内的用户信息。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-03T11:31:28.500

许多容器，例如 Glassfish，提供对 JDBC 领域的支持。在这种情况下，您可以为组配置访问权限（例如，在 web.xml 中），并让客户配置用户名、密码和组成员资格。

# javascript - 仅在 FireFox 中工作的简单 javascript

> ID：506647
> 
> 赞同：2
> 
> 时间：2009-02-03T10:29:13.150
> 
> 标签：javascript, cross-browser

我创建了一个脚本，该脚本需要选择一个开始年份，然后只显示该开始年份 -> 2009 的年份。它只是一个 startYear 到 endYear 范围选择器。

该脚本仅适用于 Firefox。我正在学习 javascript，所以我希望有人能指出我正确的方向。可以在[http://motolistr.com找到实时脚本](http://motolistr.com)

```
<script type="text/javascript">
function display_year2(start_year) {
//alert(start_year);
if (start_year != "Any") {
    var i;
    for(i=document.form.year2.options.length-1;i>=0;i--)
    {
        document.form.year2.remove(i);
    }

    var x = 2009;
    while (x >= start_year) {
        var optn = document.createElement("OPTION");
        optn.text = x;
        optn.value = x;
        document.form.year2.options.add(optn);
        //alert(x);
        x--;
    }
}
else 
{
    var i;
    for(i=document.form.year2.options.length-1;i>=0;i--)
    {
        document.form.year2.remove(i);
    }
    var optn = document.createElement("OPTION");
    optn.text = "Any";
    optn.value = "Any";
    document.form.year2.options.add(optn);
} // end else
} // end function
</script> 
```

有任何想法吗？

谢谢，尼克

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T11:00:51.463

您正在尝试在每个选项上设置一个 onclick 事件。IE 不支持这个。尝试在选择元素中使用 onchanged 事件。

而不是这个：

```
<select name="year1" id="year1">
    <option value="Any" onclick="javascript:display_year2('Any');" >Any</option>
    <option value="2009" onclick="javascript:display_year2(2009);" >2009</option>
    <option value="2008" onclick="javascript:display_year2(2008);" >2008</option>
</select> 
```

试试这个：

```
<select name="year1" id="year1" onchange="javascript:display_year2(this.options[this.selectedIndex].value)">
    <option value="Any">Any</option>
    <option value="2009">2009</option>
    <option value="2008">2008</option>
</select> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T11:04:43.843

它不起作用的原因不在您的代码段中：

```
<OPTION onclick=javascript:display_year2(2009); value=2009> 
```

Option.onclick 不是通常预期会触发的事件，但在 Firefox 中会触发。检测 Select 值更改的常用方法是通过 Select.onchange。

此外，您不需要在事件处理程序中包含“javascript:”，它们不是 URL（而且，永远不要使用 javascript: URL）。另外，引用您的属性值；这总是一个好主意，当您开始在值中包含标点符号时，它是必需的。此外，坚持使用字符串作为您的值 - 您使用数字调用 display_year2，但 option.value 始终是字符串；尝试使用混合数据类型会导致混淆。

总之：

```
<select onchange="display_year2(this.options[this.selectedIndex].value)">
    <option value="2009">2009</option>
    ...
</select> 
```

其他事情：

```
var i;
for(i=document.form.year2.options.length-1;i>=0;i--)
{
document.form.year2.remove(i);
} 
```

您可以通过写入 options.length 来取消循环。此外，最好避免直接从文档中引用元素名称 - 使用 document.forms[] 集合或 getElmentById：

```
var year2= document.getElementById('year2');
year2.options.length= 0; 
```

还：

```
var optn = document.createElement("OPTION");
optn.text = x;
optn.value = x;
document.form.year2.options.add(optn); 
```

HTMLCollection.add 不是标准的 DOM 方法。传统的老式做法是：

```
year2.options[year2.options.length]= new Option(x, x); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-21T12:01:28.760

我在 Firefox 中使用 onchange 时遇到了类似的问题，但在 IE 中没有，有时在 Chrome 中也没有。我在我的 Head 标签中添加了下面，一切都很好（放入元标签：我必须为这个笔记剥离标签内容，这样它才会显示出来）元 http-equiv="X-UA-Compatible" content="IE=边缘，铬=1"

注意：它的作用是：始终强制使用最新的 IE 渲染引擎（即使在 Intranet 中）和 Chrome 框架但是：如果您使用 .htaccess，请删除它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T10:55:42.113

谷歌搜索我发现了一些关于 IE 中 createElement 的问题： [http ://webbugtrack.blogspot.com/2007/10/bug-235-createelement-is-broken-in-ie.html](http://webbugtrack.blogspot.com/2007/10/bug-235-createelement-is-broken-in-ie.html)

还有一个指向带有解决方法的页面的链接。希望这对您有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T10:57:44.307

虽然它不能解决您的问题；您以不正确的方式引用您的输入字段：`document.form.year2`应该是`document.getElementById('year2')`. 我还注意到您当前的脚本可以在 Opera 中运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T11:03:48.820

尝试手动设置*长度。*

document.form.year2.options.length = number_of_items。

# c# - 在 C# 中浅拷贝某些内容时，字符串如何工作？

> ID：506648
> 
> 赞同：25
> 
> 时间：2009-02-03T10:29:49.107
> 
> 标签：c#, .net, shallow-copy

字符串被认为是引用类型，但可以像值一样起作用。当手动或使用 MemberwiseClone() 进行浅拷贝时，如何处理字符串？它们是否被认为是独立于副本和母版的？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-02-03T10:35:00.640

字符串是引用类型。但是它们是不可变的（它们不能更改），因此它们是按值复制还是按引用复制并不重要。

如果它们是浅复制的，那么引用将被复制......但你不能改变它们，所以你不能一次影响两个对象。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-03T10:46:56.793

考虑一下：

```
public class Person
{
    string name;
    // Other stuff
} 
```

如果您调用 MemberwiseClone，您最终会得到两个单独的 Person 实例，但它们的`name`变量虽然不同，但将具有相同的值 - 它们将引用相同的字符串实例。这是因为它是一个浅克隆。

如果您在其中一个实例中更改名称，则不会影响另一个，因为这两个变量本身是独立的 - 您只是更改其中一个变量的值以引用不同的字符串。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T10:35:53.557

你只是在复制一个**参考**（想想“指针”）；这两个引用是分开的（但恰好具有相同的值），但只有一个字符串对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-06-23T16:13:34.163

@stusmith 有一个非常好的答案，乔恩提到了浅拷贝的行为。只是为了详细说明这一点，我制作了一个[.NET Fiddle](https://dotnetfiddle.net/V13kAa)

你会注意到我做了一个浅拷贝，但实际上，因为唯一的成员是一个字符串，所以它也可以作为一个深拷贝。需要明确的是，从复制对字符串的引用的意义上说，它不是深度复制，因此当运行复制函数时，内存中存在两个引用同一字符串的对象。

但是对于许多应用程序来说，这很好，因为就像在我的示例中一样，当我在复制第一个对象后更新字符串时，会创建一个新字符串和引用，因此最终结果是两个对象具有对不同字符串值的不同引用。

这是小提琴正在做什么的预览：

```
// Create a person
Person a = new Person("Sally");

// Shallow copy the person
Person b = a.ShallowCopy();

// Change the name of the second person
b.firstName = "Bob";

// Observe that the original person's name has not changed
Console.WriteLine("First person is {0}", a.firstName);
Console.WriteLine("Second person is {0}", b.firstName);

// Output is:
// First person is Sally
// Second person is Bob 
```

# .net - EpiServer CMS 5 R2：自定义页面提供程序 - 正确的选择？

> ID：506649
> 
> 赞同：0
> 
> 时间：2009-02-03T10:30:06.813
> 
> 标签：.net, architecture, episerver, design-decisions

我在一个新项目中使用 EpiServer CMS 5R2。我的任务是创建一个 CustomPageProvider 以链接到我们无法控制的现有后端存储。然而，查看示例提供程序 (XmlPageProvider) 似乎提供程序负责维护 EpiServer 所需的元信息，例如（来自 examples.xml 文档）：

```
<page id="10011" parent="10010" pagetypeid="3" versionid="1" security="Everyone:Read;Administrators:Create,Edit">
  <property name="PageGUID">35a988fe-2bc1-4e45-a41f-3a009a660551</property>
  <property name="PageTypeID">3</property>
  <property name="PageWorkStatus">4</property>
  <property name="PageFolderID">118</property>
  <property name="PageTypeName">[Public] Standard page</property>
  <property name="PageMasterLanguageBranch">en</property>
  <property name="PageLanguageBranch">en</property>
  <!---- SNIP! ---->
  <property name="Heading">A subpage</property>
  <property name="MainBody"><p>an external subpage</p></property>
  <property name="SecondaryBody"><p>second body</p></property>
  <property name="MetaAuthor">John Doe</property>
</page> 
```

我对此有点担心，因为我更希望 EpiServer 负责这一点。这是一个大容量网站，如果我的服务不必包含额外的数据存储来维护此信息，那就太好了，至少可以说存在缓存性问题。

所以，问题：

1.  自定义页面提供者是适合这项工作的工具吗？

2.  如果是这样，有没有办法将这个责任推回到 EpiServer 上？

3.  如果没有，您能否就如何最好地存储这些数据给我任何建议？因为它超出了我们数据源的内容。

非常感激！

罗伯特·史蒂文森-莱格特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T15:07:23.867

从我在 EpiServer CMS 论坛上的问题得到这个： [http ://world.episerver.com/Forum/Pages/thread.aspx?id=27574&pageIndex=1](http://world.episerver.com/Forum/Pages/thread.aspx?id=27574&pageIndex=1)

> 回复：自定义页面提供者 发布者：Johan Björnfot 于 2009 年 2 月 3 日，13:43:28
> 
> 您不必在后端存储中存储任何元信息。PageProviderBase 中有一些辅助方法，例如 InitializePageData（设置元数据属性）和 SetPropertyValues（设置元和/或自定义属性）可以帮助您初始化 PageData 对象。
> 
> 所以你的问题的答案：
> 
> 1.  听起来 PageProvider 很适合您的目的。
>     
>     
> 2.  使用 InitializePageData 处理元数据（InitializePageData 将为元属性设置默认值，例如状态为已发布等）。但是，如果您想设置圆顶其他元数据属性值而不是默认值，例如状态（发布等），您可以通过调用 SetPropertyValues 来做到这一点。
>     
>     
> 3.  如果需要将其他数据存储在后备存储之外，则有多种选择（数据库中的自定义表、基于文件的表等）。使用哪一个取决于您的环境、要存储的数据类型等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T13:31:04.777

要使用自定义页面提供程序，还需要许多客户没有的企业许可证。只是为了让您不要忘记就该问题与客户核实...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-05T01:45:19.583

您仍然必须处理管理页面 guid、id 和 url - 这对于外部数据存储可能很棘手。查找 MappedPageProvider - 它会为您处理所有这些。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-20T21:59:00.697

页面提供程序是一种从外部数据源导入数据的好方法，它们听起来好像它们可能适合您的情况。

也就是说，我在这里要小心，因为您必须安装很多管道，并且您必须非常注意大型数据源的性能。

重要的是要准确了解 EPiServer 何时以及如何请求页面数据——即何时使用页面缓存以及何时尝试访问数据源。最终，您将不得不以一种可以有效搜索的格式缓存关于您的页面的大量信息，尤其是在指向您的数据源的链接相对较慢的情况下。

这里有一个非常全面的讨论：[EPiServer page providers and performance](http://www.bombaycrow.com/web_development_asp_net/episerver_page_providers_optimizing_performance/)。

# c# - c# DateLastAccessed 保存在 SQL 中返回 1 毫秒输出（更少）

> ID：506661
> 
> 赞同：0
> 
> 时间：2009-02-03T10:35:06.523
> 
> 标签：c#, .net, sql-server, vb.net

当我在 SQL 数据库中保存文件“上次保存”日期时间时，我无法直接与将来的扫描进行比较，例如`if( SavedLastAccessDate <> FileSavedDate`.

我必须这样做：

```
DateTime fileSavedDateTime = System.IO.File.getLastWriteTime(filepath);
TimeSpan gap = fileSavedDateTime - SavedLastAccessDateTime;
if (gap.Milliseconds > )
{
 do something - new save
} 
```

这有意义吗？当我在 msSQL 中保存最后一次访问时，它会增加 0.001 毫秒！

有没有更好的办法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T10:38:13.507

它不会增加毫秒 - 它只是以有限的精度存储日期和时间。

即，`datetime`s 以 0.000、0.003 或 0.007 秒的增量四舍五入，而`smalldatetime`29.998 秒或更小的值更粗略地向下四舍五入到最接近的分钟，而 29.999 秒或更大的值向上四舍五入到最近的分钟。

# .net - WPF 中 ComboBox 的 DataTemplate 的模糊/像素化显示

> ID：506665
> 
> 赞同：1
> 
> 时间：2009-02-03T10:37:41.837
> 
> 标签：.net, wpf, xaml, combobox, datatemplate

我有一个 DataTemplate 提供在 ListBox 和 ComboBox 中显示的项目。我创建的窗口如下所示： [截图 http://img223.imageshack.us/img223/8117/datatemplateexampletz4.png](http://img223.imageshack.us/img223/8117/datatemplateexampletz4.png)

我的问题是为什么 ComboBox 中的 DataTemplate 比 ListBox 中的显示更模糊或更像素化。在屏幕截图上很难看到，但当我实际使用该应用程序时，它似乎更明显。知道为什么会这样吗？是否与为一个控件启用 ClearType 而不是为另一个控件有关？

任何想法，将不胜感激。如果需要，我可以发布代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T11:05:10.610

这种效果在图标上的“Adobe”字母上似乎特别明显。由于我假设该图标是某种图形，因此这与[ClearType 无关，后者在 WPF 下只是略微有用](https://stackoverflow.com/questions/190344/wpf-blurry-fonts-problem-solutions/190521#190521)，而是一个更普遍的问题。一个常见的嫌疑人是[像素捕捉](http://msdn.microsoft.com/en-us/library/aa970908.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T14:15:42.833

这是因为图像未与像素网格对齐，您可以给所有对齐的明确大小和位置，或者使用替代图像控件，请参阅我博客上的这篇文章：

[http://www.nbdtech.com/blog/archive/2008/11/20/blurred-images-in-wpf.aspx](http://www.nbdtech.com/blog/archive/2008/11/20/blurred-images-in-wpf.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T19:42:50.660

与 ListBox 相比，ComboBox 上的文本模糊是因为在弹出窗口（包括 ComboBox 的弹出窗口）上禁用了 ClearType。微软已经[证实了](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/a2f093ca-267c-4af2-b35e-13c01eb4854b/)这一点。

从链接的文章：

> 在弹出窗口中，这是一个单独的 Win32 窗口，WPF ClearType 系统无法知道后面的像素（不做各种可疑和缓慢的 win32 技巧），所以它只是被禁用。

# c# - IFormatProvider 做什么？

> ID：506676
> 
> 赞同：101
> 
> 时间：2009-02-03T10:46:37.403
> 
> 标签：c#, asp.net, iformatprovider

我在玩 Datetime.ParseExact 方法，它需要一个 IFormatProvider ......

它可以输入null，但它到底是做什么的？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-04T13:13:48.340

除了伊恩博伊德的回答：

也`CultureInfo`实现了这个接口，可以在你的情况下使用。例如，您可以解析法语日期字符串；你可以使用

```
var ci = new CultureInfo("fr-FR");
DateTime dt = DateTime.ParseExact(yourDateInputString, yourFormatString, ci); 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2013-08-12T19:41:57.147

该`IFormatProvider`接口通常由一个`CultureInfo`类为您实现，例如：

*   `CultureInfo.CurrentCulture`
*   `CultureInfo.CurrentUICulture`
*   `CultureInfo.InvariantCulture`
*   `CultureInfo.CreateSpecificCulture("de-CA") //German (Canada)`

该接口是一个函数的网关，用于从一种文化中获取一组特定于文化的数据。`IFormatProvider`可以查询的两个常用区域性对象是：

*   [`DateTimeFormatInfo`](https://docs.microsoft.com/en-us/dotnet/api/system.globalization.datetimeformatinfo)：`IFormatProvider.GetFormat(typeof(DateTimeFormatInfo));`
*   [`NumberFormatInfo`](https://docs.microsoft.com/en-us/dotnet/api/system.globalization.numberformatinfo)： `IFormatProvider.GetFormat(typeof(NumberFormatInfo));`

它通常的工作方式是你要求`IFormatProvider`给你一个`DateTimeFormatInfo`对象：

```
DateTimeFormatInfo? format;
format = (DateTimeFormatInfo)provider.GetFormat(typeof(DateTimeFormatInfo));
if (format != null)
   DoStuffWithDatesOrTimes(format); 
```

还有内部知识，任何`IFormatProvider`接口都可能由继承自`CultureInfo`或 继承自的类实现`DateTimeFormatInfo`，因此您可以直接转换接口：

```
CultureInfo? info = provider as CultureInfo;
if (info != null)
   format = info.DateTimeInfo;
else
{
   DateTimeFormatInfo? dtfi = provider as DateTimeFormatInfo;
   if (dtfi != null)
       format = dtfi;
   else
       format = (DateTimeFormatInfo)provider.GetFormat(typeof(DateTimeFormatInfo));
}

if (format != null)
   DoStuffWithDatesOrTimes(format); 
```

# 但不要那样做

所有辛苦的工作都已经为您编写好了：

**`DateTimeFormatInfo`从a 中获取 a`IFormatProvider`**：

```
DateTimeFormatInfo format = DateTimeFormatInfo.GetInstance(provider); 
```

**`NumberFormatInfo`从a 中获取 a`IFormatProvider`**：

```
NumberFormatInfo format = NumberFormatInfo.GetInstance(provider); 
```

的优点`IFormatProvider`是您可以创建自己的文化对象。只要他们实现`IFormatProvider`并返回他们被要求的对象，你就可以绕过内置的文化。

您还可以使用`IFormatProvider`传递任意文化对象的方式 - 通过`IFormatProvider`. 例如不同文化中神的名字

*   上帝
*   上帝
*   约娃
*   耶和华
*   耶和华
*   אהיה אשר אהיה

这可以让您的自定义`LordsNameFormatInfo`类在`IFormatProvider`.

实际上，您永远不需要调用自己`GetFormat`的方法`IFormatProvider`。

每当您需要时，`IFormatProvider`您都可以传递一个`CultureInfo`对象：

```
DateTime.Now.ToString(CultureInfo.CurrentCulture);

endTime.ToString(CultureInfo.InvariantCulture);

transactionID.toString(CultureInfo.CreateSpecificCulture("qps-ploc")); 
```

> **注意**：任何代码都会发布到公共领域。无需归属。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-01-07T11:26:42.860

将 null 作为 the 传递`IFormatProvider`不是正确的方法。如果用户在其 PC 上具有自定义日期/时间格式，您将在解析和转换为字符串时遇到问题。我刚刚修复了一个错误，即有人在转换为字符串时将 null 作为 IFormatProvider 传递。

相反，您应该使用`CultureInfo.InvariantCulture`

错误的：

```
string output = theDate.ToString("dd/MM/yy HH:mm:ss.fff", null); 
```

正确的：

```
string output = theDate.ToString("dd/MM/yy HH:mm:ss.fff", CultureInfo.InvariantCulture); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-03T11:09:51.757

[IFormatProvider](http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx)为相关方法提供文化信息。[DateTimeFormatInfo](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.aspx)实现 IFormatProvider，并允许您指定希望日期/时间显示的格式。示例可以在相关的 MSDN 页面上找到。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-03T10:49:32.967

你可以在这里看到[http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx](http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx)

请参阅那里的备注和示例部分。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T10:49:49.287

检查API 的[http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx](http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-02-02T03:05:31.057

通过[MSDN](https://msdn.microsoft.com/en-us/library/system.iformatprovider(v=vs.110).aspx)

.NET Framework 包括以下**三个**预定义的 IFormatProvider 实现，以提供用于格式化或解析数字和日期和时间值的区域性特定信息：

1.  该类`NumberFormatInfo`提供用于格式化数字的信息，例如特定文化的货币、千位分隔符和小数分隔符。有关`NumberFormatInfo`对象识别并用于数字格式化操作的预定义格式字符串的信息，请参阅标准数字格式字符串和自定义数字格式字符串。
2.  该类`DateTimeFormatInfo`提供用于格式化日期和时间的信息，例如特定文化的日期和时间分隔符或日期的年、月和日组件的顺序和格式。有关`DateTimeFormatInfo`对象识别并用于数字格式化操作的预定义格式字符串的信息，请参阅标准日期和时间格式字符串和自定义日期和时间格式字符串。
3.  `CultureInfo`代表特定文化的类。它的`GetFormat`方法返回一个特定于文化的对象`NumberFormatInfo`或`DateTimeFormatInfo`对象，具体取决于该`CultureInfo`对象是否用于涉及数字或日期和时间的格式化或解析操作。

.NET Framework 还支持自定义格式。这通常涉及创建实现 IFormatProvider 和 ICustomFormatter 的格式化类。然后将此类的实例作为参数传递给执行自定义格式化操作的方法，例如`String.Format(IFormatProvider, String, Object[])`.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-03T10:50:54.960

[DateTimeFormatInfo](http://msdn.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.aspx)类实现了这个接口，因此它允许您控制 DateTime 字符串的格式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-08-08T20:24:33.030

该问题询问 IFormatProvider 和 DateTime，但您也可以在 .NET 的其他上下文中使用 IFormatProvider，例如用于 string.Format。

然后传入 IFormatProvider 实例，您可以通过实现 IFormatProvider 指定字符串如何为对象格式化。因此，IFormatProvider 和相关 ICustomFormatter 接口的使用在 .NET 中比仅用于日期更广泛。

例如考虑这个实现：

```
using System;

namespace ConsoleApp
{
    class EmployeeProductivityFormatProvider : IFormatProvider, ICustomFormatter
    {
        public string Format(string format, object arg, IFormatProvider formatProvider)
        {
            int rating = (int)arg;

            if (rating == 0)
            {
                return $"{rating} (new employee)";
            }

            if (rating > 0)
            {
                return $"{rating} (good employee)";
            }

            return $"{rating} (bad employee)";
        }

        public object GetFormat(Type formatType)
        {
            if (formatType == typeof(ICustomFormatter))
            {
                return this;
            }

            return null;
        }
    }
} 
```

现在我们可以通过指定这样的 int 值来获取员工的字符串表示形式：

```
 string prod = string.Format(new EmployeeProductivityFormatProvider(),
                                "Productivity rating: {0}",
                                employee.ProductivityRating); 
```

对于 DateTime，有很多已经创建的 IFormatProvider 实现可供选择。这是将对象表示为字符串并在 .NET 中指定其格式的一种非常灵活的方法，是一个非常笼统的概念。

# iphone - 如何使用 Cocos2d 显示 UIViewController 和 UIView？

> ID：506680
> 
> 赞同：7
> 
> 时间：2009-02-03T10:48:51.940
> 
> 标签：iphone, objective-c, cocos2d-iphone

我正在尝试使用 Cocos2d 构建一个 iPhone 应用程序。但我使用了四种类型的类，如下所示-

```
@interface MenuScene : Scene {}

@end
@interface FlipView : UIImageView
{
    CGPoint startTouchPosition;
    NSString *dirString;
    UIImageView *firstPieceView;   
    UIImageView *secondPieceView;

}
@end

@interface HelloController : UIViewController
@end

@interface MenuLayer: Layer{
        Todo *todo;
        Menu * menu;
        sqlite3 *database;
        NSMutableArray *todos;
    NSString *dirString;
    CGPoint startTouchPosition;
}
@property (nonatomic, retain) NSMutableArray *todos;
-(void) button1: (id)sender;
-(void) button2: (id)sender;
-(void) black_jack: (id)sender;
@end 
```

但是如何通过 MenuLayer 类显示 FlipView 和 HelloController 类。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-10T01:18:31.657

If you are asking how to attach UIKit views and such to a cocos2d-iphone project, you just have to do it like:

```
[[[Director sharedDirector] window] addSubview:myView]; 
```

Updated to cocos 0.7 and now this is:

```
[[[Director sharedDirector] openGLView] addSubview:myView]; 
```

And in Cocos 0.99:

```
[[[CCDirector sharedDirector] openGLView] addSubview:myView]; 
```

And in Cocos 2.0

```
[[[CCDirector sharedDirector] view] addSubview:myView]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-10T01:04:54.293

It's very difficult to answer this question just from the code but I think you need to go back and read up a little on UIKit design and cocos2d programming.

HelloController is a view controller - you cannot 'show' it. A view controller is a class that replies to messages from a view and controls the data it displays from the model.

FlipView is an ImageView which is a subclas of UIView. To have UIKit render this image, you need to add it to another view using `[UIView addSubView:...]`

Here's what I think you want to do:

1.  The menu item receives a touch event. It signals to:
2.  the view controller which
3.  adds the UIImage to the main view

Like I said though, this is a very general question and I really think you should go back to the documentation and think about your design. The Apple docs are good and there are some good iPhone books on the market now.

# msbuild - 使用 MSBuild 将多个值传递给 Wix DefineConstants 属性

> ID：506687
> 
> 赞同：14
> 
> 时间：2009-02-03T10:50:48.817
> 
> 标签：msbuild, wix, msbuild-task

我目前正在将我的 Wix 项目集成到 MSBuild 中。我有必要将多个值传递给 Wix 项目。一个值将起作用（下面示例中的 ProductVersion）。

```
<Target Name="BuildWixSetups">
    <MSBuild Condition="'%(WixSetups.Identity)'!=''"
                Projects="%(WixSetups.Identity)"
                Targets="Rebuild" Properties="Configuration=Release;OutputPath=$(OutDir);DefineConstants=ProductVersion=%(WixSetups.ISVersion)" ContinueOnError="true"/>
</Target> 
```

但是，如何将多个值传递给 DefineConstants 键？我已经尝试了所有“逻辑”分隔符（空格、逗号、分号、管道符号），但这不起作用。

有没有其他人遇到过这个问题？

不起作用的解决方案：

1.  尝试添加 DefineConstants 元素不起作用，因为 DefineConstants 需要在 Properties 属性中表示。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-04-26T21:24:47.367

**问题：**

MSBuild 任务（不是 MSBuild.exe，名为 MSBuild 的 MSBuild 任务）无法处理 WIX 项目使用的多个常量。通常，您会在构建脚本中指定属性，例如：

```
<MSBuild Projects="YourSolution.sln" Properties="Configuration=MyConfig;Platform=x86;DefineConstants=&quot;SOMETHING=1;SOMETHINGELSE=2&quot;" /> 
```

但是，当您查看构建日志时，您会看到 MSBuild 将常量分开，并且不会像您期望的那样将值组合在一起 - 类似于：

```
Task "MSBuild" Global Properties:
Configuration=MyConfig
Platform=x86
DefineConstants="SOMETHING=1
SOMETHINGELSE=2" 
```

因此，当蜡烛尝试使用这些常量时，它通常会响应“错误 CNDL0150：未定义的预处理器变量 '$(var.SOMETHINGELSE)'。这意味着 MSBuild 任务没有正确处理值中包含多个“=”的属性当用引号分组时。如果没有将属性值分组在引号中，它们显然应该被视为单独的属性，而不是单个值。

**解决方法：**

为了解决这个问题，您需要直接调用 MSBuild.exe 并手动将这些值传递给它。

```
msbuild.exe /p:Configuration=MyConfig /p:Platform=x86 /p:DefineConstants="SOMETHING=1;SOMETHINGELSE=2" YourSolution.sln 
```

这将使您的常量以您希望的方式工作，而无需重新设计您的 WiX 安装项目。

注意：如果您只使用一个常量，您仍然可以像这样使用 MSBuild 任务：

```
<MSBuild Projects="YourSolution.sln" Properties="Configuration=MyConfig;Platform=x86;DefineConstants=&quot;SOMETHING=1&quot;" /> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-11-25T19:53:33.973

问题在于将名称-值对传递给 MSBuild 任务，然后让 MSBuild 正确解析它们，以便将它们传递给 Candle 任务。似乎 MSBuild 可以处理简单名称列表或单个名称-值对，但不能处理对列表。

我的解决方案是在列表传递到 MSBuild 任务时对其进行转义，并在进入 Candle 任务时再次对其进行转义。

在您的 MSBuild 文件中，在属性中定义这些对，如下所示：

```
<PropertyGroup>
    <WixValues>
        One=1;
        Two=2;
        Three=3;
    </WixValues>
</PropertyGroup> 
```

当您调用 MSBuild 任务时，转义该属性（需要 MSBuild 4）：

```
<MSBuild 
    Projects="setup.wixproj"
    Properties="WixValues=$([MSBuild]::Escape($(WixValues)))" /> 
```

必须在 wixproj 文件中完成转义，但无需手动编辑文件。只需打开项目的属性，转到“构建”选项卡，然后在其中显示“定义预处理器变量”，输入：

```
$([MSBuild]::Unescape($(WixValues))) 
```

即使该框中已经有其他变量，这也有效；只需将其与分号一起添加到列表中即可。

您将在 MSBuild 日志中看到该`candle.exe`工具正确接收参数：

```
candle.exe -dOne=1 -dTwo=2 -dThree=3 -dConfiguration=Release... 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-08-30T15:13:39.737

我仍然很难让这个工作，但上面每个答案的部分都有助于我的解决方案，所以我想分享。

环境：TFS Build Server 2010 - Powershell 调用 MSBuild.exe Wix 3.6 安装在构建服务器上

目标是将构建版本号和 5 个目录传递给 MSBuild，以便 Candle.exe 正确接收它们

Build 在构建结束时调用一个命令文件，该命令文件包含一个调用 powershell 脚本来构建 Wix 安装程序的步骤。它传入构建的版本号以及源和输出目录（输出是 UNC 文件共享引用 \tfsbuildserver..）

为了让它工作，在 Powershell ps1 文件中，

*   使用以双 " 开头的单个 /p:DefineConstants=
*   编码所有分隔符；作为 %3b
*   = 可以未编码
*   任何带空格的文件名周围不应有额外的引号

    ```
    $msbuild = "C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe"

    $options = " /p:Configuration=Release /p:Platform=x64 "
    $options = $options + " /p:DefineConstants="""
    $options = $options + "SolutionDir=" + $SourceDir
    $options = $options + "%3bTFSBuildSourceLanding=" + $OutputLocation + "SharepointWebRoot\Landing"
    $options = $options + "%3bTFSBuildSourceLandingAdmin=" + $OutputLocation + "SharepointWebRoot\LandingAdmin"
    $options = $options + "%3bTFSBuildSourceRegistration=" + $OutputLocation + "Extranet_Registration"
    $options = $options + "%3bTFSBuildSourceGAC=" + $OutputLocation + "GAC"
    $options = $options + "%3bTFSBuildSourceSQL=" + $OutputLocation + "SQL"
    $options = $options + "%3bProductVersion=" + $BuildVersion + """" 

    $build = $msbuild + " ""EUM WIX\EUM Wix.wixproj"" " + $options + " /t:Build"
    $clean = $msbuild + " ""EUM WIX\EUM Wix.wixproj"" " + $options + " /t:Clean"

    Write-Host "Building Wix Installer..."
    Invoke-Expression $clean
    Invoke-Expression $build 
    ```

*   在 wixproj 文件中，我们必须取消转义（在底部，它表示取消注释以进行修改）

    ```
     <Target Name="BeforeBuild">
          <CreateProperty Value="$([MSBuild]::Unescape($(DefineConstants)))">
             <Output TaskParameter="Value" PropertyName="DefineConstants" />
          </CreateProperty>
      </Target> 
    ```

*   另请注意，在 Visual Studio 中，我将使用调试设置，并且可以在“构建”选项卡的“定义预处理器变量”中为这些值设置默认值

*   在发布设置中，此项应为空白，因为它将在上面的命令行中传递。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-13T06:46:36.603

在使用 MSBuild 任务构建 Visual Studio 解决方案时，以下内容适用于我：

```
<MSBuild Projects="Solution.sln"
         Targets="Rebuild"
         Properties="Configuration=Debug;DefineConstants=DEBUG%3bTRACE" /> 
```

诀窍是`%3b`用来转义值`;`内的分隔符`DefineConstants`。我不确定这是否也适用`=`。他们可能需要逃脱，`%3d`否则它可能根本不起作用......

MSBuild 元素上还有一个`TargetAndPropertyListSeparators`属性。我找不到任何文档，但可以使用它来设置除`;`.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-13T15:49:28.673

您可以将其作为参数传递，而不是常量。代码将如下所示：

```
<MSBuild ...
    Properties="ProductVersion=%(WixSetups.ISVersion)" /> 
```

现在在 WiX 项目中添加一个常量：

```
<DefineConstants>BuildVersion=$(ProductVersion)</DefineConstants> 
```

并在需要时在 *.wxs 文件中使用它：

```
$(var.BuildVersion) 
```

例如：

```
<Product Id="*" Name="My Company" Language="1033" Version="$(var.BuildVersion)"... /> 
```

这将适用于多个参数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-06T15:14:44.380

我知道 MSDN 文档充满了错误，有时还具有误导性：这就是它所说的**DefineConstants**

> 定义条件编译器常量。符号/值对由分号分隔，并使用以下语法指定：
> 
> 符号 1 = 值 1；符号 2 = 值 2
> 
> 该属性等效于 /define 编译器开关。

[http://msdn.microsoft.com/en-us/library/bb629394.aspx](http://msdn.microsoft.com/en-us/library/bb629394.aspx)

根据 MSDN，您可以 1\. 定义多个常量和 2\. (@Sayed) 赋值

*但是*，我无法让 MSBuild 任务的此属性的预期行为按预期工作并推荐 Jeff Winn 的解决方法，他的帖子应标记为答案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-09T22:45:53.390

当我将它们包含在 .wixproj 文件中（使用 Visual Studio 2010）时，以下几行有效。

```
<PropertyGroup>
  <DefineConstants>Const1=Value1;Const2=Value2;Const3=Value3</DefineConstants>
</PropertyGroup> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T11:00:34.037

我认为这样的事情应该有效。

```
<DefineConstants>调试；跟踪</DefineConstants> 

```

查看此博客文章，看看它是否可以帮助您。 [http://www.sedodream.com/PermaLink,guid,9b1d23aa-6cb2-48cb-a47a-9cef29622676.aspx](http://www.sedodream.com/PermaLink,guid,9b1d23aa-6cb2-48cb-a47a-9cef29622676.aspx)

另请查看此论坛帖子。它解决了与您类似的问题。 [http://social.msdn.microsoft.com/Forums/en-US/msbuild/thread/3f485bf4-1b00-48bf-b5d0-4b83341ce4a6/](http://social.msdn.microsoft.com/Forums/en-US/msbuild/thread/3f485bf4-1b00-48bf-b5d0-4b83341ce4a6/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-30T00:47:35.720

解决方法黑客。

假设：

*   SomeEnumValue 的可能值为 EnumValue1 和 EnumValue2

在 MSBuild 中：

```
<DefineConstants>Debug;use_$(SomeEnumValue)</DefineConstants> 
```

在 WiX 中：

```
<?ifdef $(var.use_EnumValue1) ?>
  ...
<?elseif $(var.use_EnumValue2) ?>
  ...
<?endif?> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-05T19:25:52.463

我的解决方案是使用 转义分号`&#59;`，这样：

```
<MSBuild
    Projects="MyApplication.sln"
    Properties="DefineConstants=Sources=$(OutputPath)\MyApplication\&#59;Configuration=$(Configuration)&#59;OutDir=$(OutputPath)\WiX\"
    Targets="Clean;Rebuild"
/> 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2012-06-22T02:21:33.827

这对我有用，并允许我传入尚未定义键值对的项目。不是最优雅的，但我不是编码员。

msbuild test.proj /p:PassedInProp="ProductVersion=45;rt=669;wewanttoknow=test5"

```
<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="4.0" DefaultTargets="Test" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
<ItemGroup>
    <test Include="$([MSBuild]::Unescape($(PassedInProp)))" />
  </ItemGroup>
 <Target Name ="Test">
    <CreateItem Include ="$([System.String]::New('%(test.identity)').Split('=')[0])" AdditionalMetadata="value=$([System.String]::New('%(test.identity)').Split('=')[1])">
      <Output TaskParameter="Include" ItemName ="Test2"/>
    </CreateItem>
    <Message Text ="Key: %(test2.identity)  Value: %(test2.value)"/>
  </Target>
</Project> 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-07-01T19:44:52.580

为什么要指定 DefineContstants=ProductVersion=XXXXXX？

对于 DefineConstants，您没有分配值，要么定义了常量（如 DEBUG 或 TRACE），要么没有定义。此属性与[/define](http://msdn.microsoft.com/en-us/library/0feaad6z.aspx) C# 编译器开关有关。你真正想做什么？

另外，当您说我的博客文章是“黑客”时，我不确定您的意思是什么，因为它被构建了两次，这才是重点。

# visual-studio - 在 Visual Studio IDE 和其他 IDE 中进行的高级定制和更改是什么

> ID：506695
> 
> 赞同：0
> 
> 时间：2009-02-03T10:58:09.813
> 
> 标签：visual-studio, ide

程序员使用 IDE 比其他任何东西都多，对他来说意义重大。但有时我们需要定制它并改变偏好。

您在 Visual Studio IDE 和其他 IDE 中所做的高级定制和更改是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T11:08:21.090

[Viemu](http://www.viemu.com/)，一个插件，可让您在 Visual Studio 中使用 vi 键绑定。您会惊讶于这节省了多少时间！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T11:14:13.433

对我来说最 supiror 正在改变 IDE 背景和字体颜色和字体类型的外观

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T11:22:30.093

通常我会重新组织工具栏的位置，并尝试为代码窗口获得尽可能多的空间。 [Ankhsvn](http://ankhsvn.open.collab.net/)对我来说也是必须的，因为我经常使用 SVN，而且这个插件效果很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-12T03:04:57.867

我喜欢让字符串在紫色背景和白色前景中[脱颖而出。](http://www.secretgeek.net/IDETips.asp)

# wpf - XAML / WPF 中的用户控件有什么问题？

> ID：506702
> 
> 赞同：2
> 
> 时间：2009-02-03T11:02:52.037
> 
> 标签：wpf, vb.net, xaml, user-controls

我在让 UserControls 在 XAML 中工作时遇到了重大问题——我花了几个小时试图找出所有问题，但一无所获，也找不到哪里出错了。
我遇到的主要问题是当我创建一个用户控件时，例如一个简单的用户控件，它显示一个不同颜色的对象 - 我已经成功为此创建了一个属性，并且可以在设计时将颜色分配给这个用户控件并且它可以工作 - 显示绿色，红色等。
但是，当我给这个 UserControl 一个名称以便我可以在运行时分配这个属性时，如果我删除用户控件工作的名称，我会收到一个错误“无法创建类型为 'MyUserControl' 的实例” - 我可以添加多达我想在设计时它们都可以工作，但是一旦我分配了 Name 或 x:Name 它就会中断，我不知道为什么。
例如，可以创建一个标签，它有一个我可以在代码中引用它的名称——为什么不是我自己的控件——不管多么简单。

我的主要问题是：

1.  为什么给我的 UserControl 一个 Name 或 x:name 会阻止它工作？
2.  如何在一个窗口上使用多个相同类型的用户控件？
3.  如何从用户控件内部或外部访问用户控件的画布、标签等？
4.  如何在运行时或设计时在代码或 XAML 中实例化 UserControl？

我不明白为什么这些应该如此困难 - 我无法弄清楚这个问题，所以请如果有人可以提供帮助，那么谢谢！

* * *

这是我的 UserControl 的 XAML 和代码

```
<UserControl x:Class="Device.Draco"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Width="20" Height="36" x:Name="Icon">
    <Canvas Width="20" Height="36" HorizontalAlignment="Left" VerticalAlignment="Top">
        <Rectangle Height="36" Width="20" Fill="{Binding ElementName=Icon, Path=ZuneColour}" Canvas.Left="0" Canvas.Top="0" RadiusX="1" RadiusY="1">
            <Rectangle.BitmapEffect><OuterGlowBitmapEffect GlowColor="Black" GlowSize="2" /></Rectangle.BitmapEffect>
        </Rectangle>
        <Rectangle Canvas.Left="1" Canvas.Top="1" Height="24" Stroke="#191616" Width="18">
            <Rectangle.Fill>
                <LinearGradientBrush>
                    <GradientStop Offset="1" Color="#231F20"/>
                    <GradientStop Offset="0" Color="#524F4F"/>
                    <LinearGradientBrush.Transform>
                        <RotateTransform Angle="68" CenterX="0.5" CenterY="0.5"/>
                    </LinearGradientBrush.Transform>
                </LinearGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle Canvas.Left="5.5" Canvas.Top="25" Height="9" Width="9" RadiusX="3" RadiusY="3">
            <Rectangle.Fill>
                <LinearGradientBrush>
                    <GradientStop Offset="0" Color="#66000000"/>
                    <GradientStop Offset="1" Color="#22000000"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
            <Rectangle.Stroke>
                <LinearGradientBrush>
                    <GradientStop Offset="0" Color="#66FFFFFF"/>
                    <GradientStop Offset="1" Color="#22FFFFFF"/>
                </LinearGradientBrush>
            </Rectangle.Stroke>
        </Rectangle>
    </Canvas> 
```

这是 UserControl 的代码 - 添加了所有样式并填充了简单的 XAML 以消除此原因 - 后面的代码如下：

```
Namespace Device
    Partial Public Class Draco
        Inherits System.Windows.Controls.UserControl
        Public Shared ZuneColorProperty As DependencyProperty = _
        DependencyProperty.Register("ZuneColour", GetType(Brush), GetType(Device.Draco))
        Public Property ZuneColour() As Brush
            Get
                Return GetValue(ZuneColorProperty)
            End Get
            Set(ByVal Value As Brush)
                SetValue(ZuneColorProperty, Value)
            End Set
        End Property
    End Class
End Namespace 
```

这是我当前如何使用它的示例

```
<Window x:Class="Demo"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="clr-namespace:ZuneCards.Device"
    Title="Demo" Height="300" Width="300" Name="Window1">
    <Grid>
        <ui:Draco ZuneColour="Pink" HorizontalAlignment="Right" Margin="0,113,81,113" Width="20"></ui:Draco>
    </Grid>
</Window> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T11:20:50.237

我不确定是否可以在不查看源代码的情况下解决您的 UserControl 的具体问题。

但是，我可以回答第 3 部分。如果您为控件模板的一部分命名，则可以从控件代码中检索该部分。如果需要，您可以从那里公开退货。

```
<ControlTemplate TargetType="{x:Type l:MyUserControl}">
    <Button x:Name="PART_button">My Button</Button>
</ControlTemplate>

[TemplatePart(Name = "PART_button", Type = typeof(Button))]
public class MyUserControl:UserControl
{

    public override void OnApplyTemplate()
    {
        base.OnApplyTemplate();

        Button button = (Button)base.GetTemplateChild("PART_button");

        // do something with the button control
    }

} 
```

该属性表示该控件需要`Button`在其模板中输入类型为“PART_button”的控件。然后在`OnApplyTemplate`方法中你可以调用`GetTemplateChild`来检索你需要的部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T15:16:11.963

1\. `Name`如果添加或`x:Name`导致 UserControl 失败，可能还有其他问题。此外，使用`x:Name`over `Name`。

2\. 以下代码将使用多个控件：

```
<WrapPanel>
    <ui:Draco ZuneColour="Pink" Width="20" />
    <ui:Draco ZuneColour="Red" Width="20" />
    <ui:Draco ZuneColour="Orange" Width="20" />
</WrapPanel> 
```

3\. UserControl 是一个类。UserControl 的 XAML 是私有的，除非通过模板公开。因此，除非您提供方法或 UserControl 的使用者覆盖模板，否则他们无法控制内部结构。您的 UserControl 也是如此，它不能使用其父级的内部结构。如果您需要这种紧密的耦合，我建议您不要使用 UserControl。

4\. 给定以下 XAML：

```
<StackPanel x:Name="ZunePanel" /> 
```

您可以在后面使用以下代码：

```
ZunePanel.Children.Add(new Draco()); 
```

# linq - 为什么 VS2005 的 Linq Preview 不创建对象？

> ID：506703
> 
> 赞同：0
> 
> 时间：2009-02-03T11:03:07.260
> 
> 标签：linq, visual-studio-2005

我正在为 VS2005 使用 Linq CTP May 2006（我必须使用它，所以请不要建议使用 VS2008）。问题是它没有以正确的方式创建对象。我看到了几个解决方案：

1）使用DLinq（缺点：不支持语言集成查询） 2）使用SqlMetal（缺点：相同）

但它们都不适合我。所以问题是：为什么 Linq CTP 不创建对象？你可以建议使用什么？

* * *

TIA，亚历克斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T13:24:46.413

抱歉误会，问题是我使用 System.Data.Linq 而不是 System.Data.DLinq

# php - 如何从扩展 PHP 类中的静态调用中获取类名？

> ID：506705
> 
> 赞同：95
> 
> 时间：2009-02-03T11:04:21.033
> 
> 标签：php, oop, inheritance

我有两个班级：`Action`和`MyAction`。后者声明为：

```
class MyAction extends Action {/* some methods here */} 
```

我只需要`Action`类中的方法（仅在其中，因为会有很多继承的类，我不想在所有这些类中都实现此方法），它将从静态调用中返回类名。这就是我所说的：

```
Class Action {
 function n(){/* something */}
} 
```

当我称之为：

```
MyAction::n(); // it should return "MyAction" 
```

但是父类中的每个声明只能访问父类`__CLASS__`变量，其值为“Action”。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-02-03T11:16:18.297

`__CLASS__`总是返回使用它的类的名称，所以它对静态方法没有多大帮助。如果方法不是静态的，您可以简单地使用[get_class](http://php.net/get_class) ($this)。例如

```
class Action {
    public function n(){
        echo get_class($this);
    }

}

class MyAction extends Action {

}

$foo=new MyAction;

$foo->n(); //displays 'MyAction' 
```

## 后期静态绑定，在 PHP 5.3+ 中可用

现在 PHP 5.3 发布了，您可以使用[后期静态绑定](http://php.net/oop5.late-static-bindings)，它可以让您在运行时而不是在定义静态方法调用时解析目标类。

虽然该功能没有引入一个新的魔术常量来告诉您被调用的类名，但它确实提供了一个新函数[get_called_class()](http://php.net/get_called_class)可以告诉您调用静态方法的类的名称。下面是一个示例：

```
Class Action {
    public static function n() {
        return get_called_class();
    }
}

class MyAction extends Action {

}

echo MyAction::n(); //displays MyAction 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2014-09-05T22:28:42.837

从 5.5 开始，您可以[使用`class`关键字解析类名](http://php.net/manual/en/language.oop5.basic.php#language.oop5.basic.class.class)，这比进行函数调用要快得多。也适用于接口。

```
// C extends B extends A

static::class  // MyNamespace\ClassC when run in A
self::class    // MyNamespace\ClassA when run in A
parent::class  // MyNamespace\ClassB when run in C
MyClass::class // MyNamespace\MyClass 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-10-09T06:07:28.173

这不是理想的解决方案，但它适用于 PHP < 5.3.0。

代码是从[septuro.com复制的](http://www.septuro.com/2009/07/php-5-2-late-static-binding-get_called_class-and-self-new-self/)

```
if(!function_exists('get_called_class')) {
    class class_tools {
        static $i = 0;
        static $fl = null;

        static function get_called_class() {
            $bt = debug_backtrace();

            if (self::$fl == $bt[2]['file'].$bt[2]['line']) {
                self::$i++;
            } else {
                self::$i = 0;
                self::$fl = $bt[2]['file'].$bt[2]['line'];
            }

            $lines = file($bt[2]['file']);

            preg_match_all('/([a-zA-Z0-9\_]+)::'.$bt[2]['function'].'/',
                $lines[$bt[2]['line']-1],
                $matches);

            return $matches[1][self::$i];
        }
    }

    function get_called_class() {
        return class_tools::get_called_class();
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-09-27T12:36:43.117

现在（当 5.3 到来时）它非常简单：

[http://php.net/manual/en/function.get-call-class.php](http://php.net/manual/en/function.get-called-class.php)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-14T20:16:22.943

```
class MainSingleton { 
  private static $instances = array(); 
  private static function get_called_class() {
    $t = debug_backtrace();
    return $t[count($t)-1]["class"];
  }  

  public static function getInstance() { 
    $class = self::get_called_class();
    if(!isset(self::$instances[$class]) ) { 
      self::$instances[$class] = new $class; 
    } 
    return self::$instances[$class]; 
  } 

}

class Singleton extends MainSingleton { 
  public static function getInstance()
  {
    return parent::getInstance();
  }     
  protected function __construct() { 
    echo "A". PHP_EOL; 
  } 

  protected function __clone() {} 

  public function test() { 
    echo " * test called * "; 
  } 
} 

Singleton::getInstance()->test(); 
Singleton::getInstance()->test(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-08-22T14:15:00.623

**(PHP 5 >= 5.3.0, PHP 7)**
get_call_class — “后期静态绑定”类名

```
<?php

class Model
{
  public static function find()
  {
    return get_called_class();
  }
}

class User extends Model
{
}

echo User::find(); 
```

[此链接可能会有所帮助](https://www.php.net/manual/en/function.get-called-class.php)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T11:27:40.160

在可用的 PHP 版本中，没有办法做你想做的事。Paul Dixon 的解决方案是唯一的。我的意思是，代码示例，因为他所说的后期静态绑定功能在 PHP 5.3 中可用，该版本处于测试阶段。

# c - 将数组转换为 int/float

> ID：506707
> 
> 赞同：0
> 
> 时间：2009-02-03T11:04:35.760
> 
> 标签：c, arrays, floating-point, floating-point-conversion

我需要使用C将char数组转换为int和float数组是这样的

```
char* text = "15.34"; 
```

我还需要再次将浮点/整数转换回数组

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T11:07:33.243

使用`atoi()`/`strtol()`和`atof()`/`strtod()`库函数从字符串转换。

转换回使用`sprintf()`with`%d`和`%f`格式说明符。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T11:10:00.057

您也可以使用 sscanf。例如：

> 浮动 fp = 0; sscanf（文本，“%f”，&fp）；

要转换回来使用 sprintf()

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T11:08:06.550

看看`sscanf()`和`sprintf().`

# .net - 如何实现自定义代理服务器？

> ID：506718
> 
> 赞同：2
> 
> 时间：2009-02-03T11:08:32.260
> 
> 标签：.net, proxy, filter, browser, response

最终，我想[阻止 .NET WebBrowser 控件中的下载](https://stackoverflow.com/questions/483262/how-to-block-downloads-in-net-webbrowser-control)，有效地将其限制为显示 HTML、图像、脚本等，但永远不会*向*用户显示“另存为”对话框。

在回答该问题时提出的解决方案是连接一个自定义代理服务器，该服务器检查响应并过滤掉任何会导致下载提示的内容。如何在我的 .NET 应用程序中实现这样的代理？我不想安装第三方软件或库。

我找到了[HttpListener 类](http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx)，但我遇到了两个问题：

1.  侦听器需要一组预定义的前缀来触发它。但是，我不希望在我的应用程序中硬编码主机名或端口号，并保持其通用性。
2.  我必须自己实现执行实际请求的代码 - 是不是有什么东西可以为我做这件事，我可以简单地点击该行，检查响应的内容并根据需要更改它们（如请求过滤器J2EE 在服务器端做）？

## 更新

好的，我想我需要更清楚一点：我的 .NET（富客户端）应用程序正在多个项目中使用，这些项目也有基于 Web 的应用程序。.NET 应用程序包括一个带有 WebBrowser 控件的可重复使用的通用表单。其他开发人员使用该表单将对其 Web 应用程序的访问集成到 .NET 应用程序中。

我想阻止下载，所以我想让我的 WebBrowser 表单拦截所有流量并确保它不会导致“另存为”对话框。因此...

*   我不知道主机名是什么
*   WebBrowser 指向真实的 URL，用户点击常规链接，触发 JavaScript……所有这些都由 Web 应用程序提供
*   如果 WebBrowser 指向 localhost（如建议的那样），我必须解析响应并重写所有链接，以便它们再次指向 localhost，保留原始 URL。我不想经历那个麻烦。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T11:39:57.703

`HttpListener`应该没问题，但它只是 http.sys 的包装，而且这个库仅在 Windows XP 和更高版本上可用。

## **Http前缀**

您只需要一个前缀`http://127.0.0.1:8080/`，因为它仅适用于您的本地 web 控件。或者，支持通配符，`http://*:8080/`但没有理由在您的情况下使用它。

> **延斯班曼写道：**
> 
> 访问的应用程序不在`localhost`，它们可以在任何地方。这就是为什么我不想硬编码任何东西。

你说的应用是什么意思？你是说网站吗？这完全是另一回事，您的特殊代理服务器将在 HttpListenerRequests 上侦听`http://127.0.0.1:8080/`，因此您的 webcontrol 必须使用代理服务器`http://127.0.0.1:8080/`。此时它仍然在本地机器中。

## **在 HttpListenerRequest/Response 和 HttpWebRequest/Response 之间转换**

将每个传入转换`HttpListenerRequest`为`HttpWebRequest`，请求响应，您将获得`HttpWebResponse`对象，分析它是否允许您的 WebBrowser 控件响应，如果是，则将其写入`HttpListnererResponse`对象，否则写入其他内容（错误状态）。

这可能是在 .NET 上构建自己的代理服务器的最简单方法

> **延斯班曼写道：**
> 
> 对，这种转换是我想要避免做的事情。或者我可以只用几行代码来做到这一点吗？从 API 来看，它看起来更复杂。

这实际上很容易，因为 http 协议很简单。它基本上分为三个部分。

*   请求行（它包含 URL、http 方法和 http 版本）
*   标头（这实际上是使 API 看起来如此庞大和重要的原因，但实际上所有这些属性和方法都只是原始 http 标头之上的薄层。您需要做的就是以通用方式**直接将所有标头**`HttpListenerRequest`从 复制到中`HttpWebRequest`。这两个类都有用于原始访问的通用**Headers属性）**
*   消息正文（如果有，只需复制其内容）

整个转换看起来像这样：

```
HttpListenerRequest listenerRequest;

WebRequest webRequest = WebRequest.Create(listenerRequest.Url);
webRequest.Method = listenerRequest.HttpMethod;
webRequest.Headers.Add(listenerRequest.Headers);
byte[] body = new byte[listenerRequest.InputStream.Length];
listenerRequest.InputStream.Read(body, 0, body.Length);
webRequest.GetRequestStream().Write(body, 0, body.Length);

WebResponse webResponse = webRequest.GetResponse(); 
```

如果您需要有关 http 协议的更多帮助，[请参阅此维基百科文章](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)。

您还可以查看[此开源项目](http://www.mentalis.org/soft/projects/proxy/)以了解另一种方法。它不依赖于`HttpListener`类，但它是完整的代理服务器解决方案，应该很容易根据您的需要进行修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T13:17:20.377

也许是一个开源代理？

[http://www.mentalis.org/soft/projects/proxy/](http://www.mentalis.org/soft/projects/proxy/)

# c# - 编写保密照片程序的解决方案

> ID：506719
> 
> 赞同：-1
> 
> 时间：2009-02-03T11:08:37.187
> 
> 标签：c#, .net, winforms, image

编写用于保密照片的程序的解决方案。

我有很多我和我朋友的秘密照片，我现在不想让任何人看到我只是使用 Winrar 和设置密码功能，并使用一些加密和隐藏文件夹软件。但我认为这还不够安全。

因为我是 C# 程序员，所以我想开发一个应用程序来做这件事。

*   我想知道加密和解密文件的解决方案。
*   我需要编写查看器应用程序吗？如果我通过 ACSSee 或其他程序查看它们，我担心它会缓存我的文件。
*   据我所知，当我们编写“File.Delete()”时，它不是真正的删除，任何人都可以恢复它。我如何确保我的应用程序真正删除它（修改数据并使其在删除之前无法使用呢） ?

供参考

*   我的电脑无法连接到互联网，我买了它以保留，只查看我的照片我不想做其他事情。
*   如果我的电脑坏了，我不会把它寄给任何人修理它。
*   我只是一个使用它的人。

**更新**

我的照片只是羞耻的照片。其实我只是想知道怎么做，而我写的只是“假设”

例如“我买它是为了保留，只看我的照片我不想做其他事情。”

如果我花了 400 美元做这样的事情，那就太奇怪了。我虽然每个人都会知道这只是在开玩笑。抱歉让这个问题不清楚。

我只是想知道在这种情况下有人如何破解它。以及如何用 C# 语言保护它们。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T11:18:27.947

有人已经写过了：[TrueCrypt](http://www.truecrypt.org/)

加密您的整个 PC 或文件夹 - 您的选择。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T11:59:19.550

如前所述，只需使用[TrueCrypt](http://www.truecrypt.org/)。

但是让我试着找出为什么你得到了所有这些反对票。

你写道，你的电脑上有一些秘密的东西，没有人需要知道，但你是电脑的唯一用户，它没有连接到互联网。

所以你已经做了足够多的事情来隐藏你的秘密。肯定有人可以闯入你的房子偷走电脑。但这不是电脑问题。这是你家的安全问题。

而且您所询问的有关加密和解密的风格听起来您完全不知道如何以真正保护您的数据的方式编写软件。那么你真的想编写自己的密码算法吗？正如许多其他程序员已经证明的那样，自己编写安全代码是不可能的。

因此，如果您需要一些“真正的”安全解决方案来锁定某些驱动器或文件夹，只需 TrueCrypt，因为真正知道如何使用经过验证的算法和在您的电脑上留下最少的痕迹来保护数据。

只是另一个标记：如果您刚刚清楚地写下了您的问题，例如“我怎样才能安全地锁定我电脑上的文件夹，以便没有人可以访问其中的数据？” 您添加获得相同的答案而没有任何反对意见。相信我。;-)

最好的祝福，

奥利弗

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T11:55:40.727

上面提到的 Truecrypt 是您想要的一件事。我认为它是开源的，所以没有后门解决方案（没有 FBI 先生来拿你的脏东西！）。

关于被临时保存到 c:\temp 的文件，请确保您使用的查看器不会将图像或部分图像缓存到磁盘。

Irfanview/Xnview？（我将它们与 Total Commander 结合使用）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T11:14:58.750

对于你的情况，我只有一个答案：[了解你的敌人](http://en.wikipedia.org/wiki/Computer_forensics)。

# trace - 跟踪交易升级到 DTC 的原因

> ID：506733
> 
> 赞同：13
> 
> 时间：2009-02-03T11:14:16.833
> 
> 标签：trace, msdtc, system.transactions, escalation

有什么方法可以准确地确定 System.Transaction TrasactionScope 升级到 DTC 的原因？我们的一个组件似乎升级了事务，而所有其他组件（看起来很相似）都没有升级，我们遇到了一个问题。

是否提供了有关升级原因以及如何找到和观察这些原因的任何信息？SQL 探查器？日志文件？还是我在这方面不走运？

更新：我正在针对 SQL Server 2005 运行以获取信息

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T11:23:49.293

`TransactionScope`每当应用程序在相关事务范围内打开第二个连接（甚至是同一个数据库）时，使用事务就会升级。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T11:32:48.420

您可以尝试关闭分布式事务协调器服务并将其启动类型设置为禁用。当事务被提升时，这将导致异常，该事务将在调用堆栈中有问题代码。

当然，如果您在需要此服务的机器上运行其他项目，这将无济于事，但在调试机器上是可能的。

# localization - 本地化和国际化，有什么区别？

> ID：506743
> 
> 赞同：213
> 
> 时间：2009-02-03T11:20:02.343
> 
> 标签：localization, internationalization

我要问一个关于准备桌面应用程序以在 UI 上支持多种语言的问题。

在搜索有关该主题的现有问题时，我想到了“国际”一词，因此我选择了国际化标签并阅读了一些匹配的问题。

最终我意识到我可能应该查看标记为本地化的问题。然而，似乎我并不是唯一一个混淆这两个术语的人。

那么，本地化和国际化之间的主要区别是什么？

另外，它们之间的明显区别真的那么重要吗？

* * *

## 回答 #1

> 赞同：240
> 
> 时间：2009-02-03T11:23:37.843

**国际化 (i18n)**

更改软件以使其不与一种语言/区域设置/文化硬连线的过程。

**本地化 (l10n)**

向您的软件添加适当资源以支持特定语言/区域设置的过程。它的范围比[这个 Wikipedia 条目](http://en.wikipedia.org/wiki/Language_localization "关于语言本地化的维基百科")更大，但它是一个好的开始。

区分它们的价值在于（理论上）一旦您的程序经过 i18n 进程，您就可以根据需要迭代许多 l10n 进程；另外，语言准确也很好。

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2009-02-03T11:25:35.890

根据[苹果](https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPInternational/Introduction/Introduction.html)：

> **国际**化是设计和构建应用程序以促进本地化的过程。反过来，**本地化是国际化应用程序对两个或多个文化不同的市场的文化和语言适应。**

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-03T11:37:51.823

国际化**准备**您的应用程序进行本地化。例如，您可以使用 Unicode（`utf8mb4`而不是`latin1`）对存储在数据库中的字符进行编码，将字符串移动到资源文件，*启用*日期、时间和货币格式等。

例如，当您希望销售您的应用程序的中文版本时，您可以通过聘请翻译来构建 zh-CN 资源文件并使用新的日期/时间/货币格式对其进行本地化。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-03T12:35:38.400

L10n 有时可以显示你的 i18n 失败的地方——例如，你的字典有一个词条，其中一个词被用作名词，而英语中的动词不能翻译成另一种语言的同一个词，或者 UI 元素/design 不适合一种文化（L/R 方向）。

所以 l10n“通常”发生在 i18n 之后，但可以反馈到您的 i18n 并需要进一步重新设计，因此在您完成一些本地化之前，您不能认为您的应用程序完全国际化。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-11-24T14:51:22.887

根据[维基百科](http://en.wikipedia.org/wiki/Internationalization_and_localization)

**国际**化是设计软件应用程序的过程，以便它可以潜在地适应各种语言和地区`without engineering changes`。

**本地化**是`adapting internationalized software`通过添加特定于区域设置的组件和翻译文本来针对特定区域或语言的过程。

**此外**，本地化（可能会针对不同的语言环境执行多次）使用`infrastructure or flexibility provided by internationalization`（理想情况下只执行一次，或作为正在进行的开发的一个组成部分）。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-07-28T20:08:12.640

很多答案，很多正确的信息，但我的回答有点另一种观点。

**国际**化- 这是当开发人员在代码中没有特定语言的直接消息/错误消息/按钮名称/标签标题/等，但有一个传递给翻译函数的**键**，并且根据当前用户的语言环境的翻译函数将返回最终文本在英语/法国/等...
翻译功能适用于存储（db/files/associative array/etc）。
存储包含在代码中使用的**键**和值，它是应用程序支持的某种语言的文本。

**本地化- 它是以适合于****密钥**的新语言（例如西班牙）将新值添加到存储中的过程，而无需开发人员参与此过程。

例如，我们有存储：

```
key   | english    | italian           |
------+------------+-------------------+
title | Welcome    | Benvenuto         |
agree | I agree    | Sono d'accordo    |
thank | Thank you  | Grazie            | 
```

它在代码中使用的国际化类似于`confirm(t(agree));`代替`confirm("I agree");`或`confirm("Sono d'accordo");`
本地化 - 它向我们的存储添加新的语言环境，例如：

```
key   | english    | italian           | spanish          |
------+------------+-------------------+------------------+
title | Welcome    | Benvenuto         | Bienvenido       |
agree | I agree    | Sono d'accordo    | Estoy de acuerdo |
thank | Thank you  | Grazie            | Gracias          | 
```

并且这里开发者不需要更新代码，翻译功能会正确携带适当的文本。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-09T19:55:14.667

全球化 (G11n)：是向全球市场开发和营销多语言软件产品的过程。

目前多语言软件的发展经历了两个阶段：第一个阶段是国际化，第二个阶段是本地化。

国际化（I18n）：是对产品进行概括的过程，以便它可以处理多种语言和文化惯例而无需重新设计（即语言和文化中立）。

本地化 (L10n)：是获取产品并使其在语言和文化上适合将要使用和销售的目标地区（国家/地区和语言）（即特定于语言和文化）的过程。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2015-12-22T12:28:28.040

如果您遵循以下定义，这非常简单，

**i18n（国际化）**是

> **设计应用程序**的过程，使其具有 **更改为不同语言的功能，**而无需对应用程序进行编程更改。

**l10n（本地化）**是

> **创建****实际特定语言文本和格式**的过程。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-09T20:07:02.217

这里有一些非常好的答案，所以我不会回收它们。然而，在某些时候，通常在国际化测试和本地化语言测试之间，国际化和本地化往往会重叠。有人提到 l10n 反馈到国际化，但如果你在做高质量的 i18n 测试，并创建伪本地化内容，那么在本地化期间迭代开发问题应该是例外，而不是规则。界面调整大小，特别是调整页面以支持阿拉伯语和希伯来语等双向语言也倾向于将本地化问题和国际化工程结合起来。

可以说，国际化涉及对源进行更改以支持基于要求的任何语言环境。如果国际化做得好...

...本地化涉及内容的调整和某些级别的表示（例如粗体标签），以便最好地满足特定目标市场（区域设置）的需求。

大量文章和白皮书可供参考：[http ://www.lingoport.com/software-internationalization-articles](http://www.lingoport.com/software-internationalization-articles)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-10-21T21:39:11.513

国际化 - i18n - 从任何特定语言/文化中抽象出应用程序。

本地化 - l10n - 将特定语言/文化/区域设置的具体支持插入到上述 i18n 框架中。

基本上通过先做 i18n，你可以让 l10n 少很多 PITA。

相反，如果您先在具体的语言环境中创建应用程序，然后再尝试将其国际化，那将是一个巨大的 PITA。将一个具体的英文字符串“Hello World”换成 Resource.Global.HelloWorld 并不是一件简单的事情。

不同的语言会有不同的空间要求、布局、重点、颜色等。

*如果您甚至认为*您可能需要支持多个语言环境，您需要从头开始安装 i18n 框架，以便轻松支持在语言环境之间切换以应对上述差异。

稍后将其改装到应用程序中真的很难。您将不得不重新审视您（或其他人）第一次做出的大量架构考虑和限制。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-02-12T05:08:16.387

让我们先了解**语言环境**

**locale** - 一组参数，用于定义用户的语言、地区和用户希望在其用户界面中看到的任何特殊变体首选项。通常一个地区标识符至少由一个语言标识符和一个地区标识符组成。

**i18n** - 设计和开发支持多种语言环境的软件。

**l10n** - 这只有在您的软件支持 i18n 时才有可能。但是 l10n 确保语言、日期格式、货币格式等显示在特定语言环境的上下文中。

**例如，**

#1。1977 年 6 月 3 日将被翻译成西班牙语为 3 de junio de 1977。

#2。某些国家/地区的货币以“.”分隔。与'，'

#3。根据区域设置的国家/地区显示相应的货币符号

#1、#2 和 #3 是本地化的用例。

如果软件设计为支持基于用户区域设置的#1 **OR** #2 **OR #3，则产品启用 l10n。**

如果它支持多个语言环境，那么它的 i18n 启用。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-17T06:38:19.903

我觉得没有国际化可以进行本地化，但是..不应该进行带有本地化的国际化...

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-06-19T01:29:57.257

类比视角：想象一下你图书馆的书架只能放一本 4x4 英寸的书。国际化将构建具有各种不同隔间的书架，使其能够处理任何书本大小或形状。本地化会将所有书籍放在正确的部分。将您的数据库、业务逻辑和 UI 视为书架，将不同的语言、货币和文本方向视为书籍。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-05-18T06:37:40.437

简单地，

**国际化 (I18N)**是使您的软件能够适应不同语言、地区和文化的过程。

**本地化 (L10N)**是将您的软件翻译成多种语言的过程。但在您可以本地化您的软件之前，您需要将其国际化。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-02-03T11:28:02.000

i18n 和 l10n 有很多定义。我使用的是：

**国际化（i18n）**：您的应用程序的语言特定适应（翻译）

**本地化 (l10n)**：您的应用程序的区域设置特定适应（货币、数字格式、日期格式......）。

例如，我们可以为在法国和瑞士分发的应用程序使用相同的语言（我们都说法语，至少在瑞士的某些地区），但我们仍然需要进行一些调整才能将 EUR 更改为 CHF。

# asp.net - IIS & ASP.NET 阻塞文件

> ID：506744
> 
> 赞同：1
> 
> 时间：2009-02-03T11:20:03.017
> 
> 标签：asp.net, iis

我有一个在 IIS 中运行的 ASP.NET 应用程序，它可以很好地托管文件，但它会阻止所有 *.upd 文件并显示 http 404。

如果我打开目录列表，它会列出很好的文件，但我无法以任何方式下载它......

有没有什么办法解决这一问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T11:35:10.240

您必须配置 IIS 以提供您的文件类型，因为它不会提供未知的文件类型：http: [//support.microsoft.com/kb/326965](http://support.microsoft.com/kb/326965)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T11:40:04.690

您需要将 .upd 文件类型添加到 IIS Mime 类型。您可以通过以下方式做到这一点：

*   启动 IIS MMC
*   右键单击->机器名称节点上的属性
*   单击 Mime 类型按钮
*   点击“新建”
*   输入“扩展名”（在本例中为 .upd'）
*   输入 Mime 类型（你需要找出类型，如果你不确定尝试 `application/octet-stream`，它总是一个不错的选择）。
*   单击确定并关闭所有对话框。

然后该文件应该是可下载的。

# api - 使用谷歌地图api计算两点之间的距离？

> ID：506747
> 
> 赞同：3
> 
> 时间：2009-02-03T11:21:23.480
> 
> 标签：api, google-maps

是否可以向谷歌发送两个经纬度点来计算两者之间的距离？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-06-21T00:39:27.157

如果您正在寻找使用 v3 谷歌地图 API，这是我使用的一个函数：注意：您必须添加`&libraries=geometry`到您的脚本源

```
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&libraries=geometry"></script> 
```

现在的功能：

```
//calculates distance between two points in km's
function calcDistance(p1, p2){
  return (google.maps.geometry.spherical.computeDistanceBetween(p1, p2) / 1000).toFixed(2);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T11:35:35.433

你所追求的是**[Haversine 公式](http://en.wikipedia.org/wiki/Haversine_formula)**。你不需要谷歌地图来做这个，你可以单独解决。[这里](http://www.movable-type.co.uk/scripts/latlong.html)有一个脚本（在 JavaScript 中）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-13T09:43:48.920

是的，谷歌可以做到这一点

[谷歌 API 文档](http://code.google.com/apis/maps/documentation/reference.html#GLatLng.GLatLng)

这是一段java脚本，它得到两点的公里距离

```
函数初始化（）{
      如果（GBrowserIsCompatible（））{
          map = new GMap2(document.getElementById("map_canvas"));
          map.setCenter(新 GLatLng(52.6345701, -1.1294433), 13);
          map.addControl(新 GLargeMapControl());          
          map.addControl(new GMapTypeControl());
          地理编码器 = 新 GClientGeocoder();

          // NR14 7PZ
          var loc1 = new GLatLng(52.5773139, 1.3712427);
          // NR32 1TB
          var loc2 = new GLatLng(52.4788314, 1.7577444);          
          警报（loc2.distanceFrom（loc1）/ 1000）；
      }
    }

```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-25T08:44:50.707

以及 c# 中的距离校准：

```
// this returns the distance in miles. for km multiply result: * 1.609344
public static double CalculateDistance(double lat1, double lon1, double lat2, double lon2)
{
    double t = lon1 - lon2;
    double distance = Math.Sin(Degree2Radius(lat1)) * Math.Sin(Degree2Radius(lat2)) + Math.Cos(Degree2Radius(lat1)) * Math.Cos(Degree2Radius(lat2)) * Math.Cos(Degree2Radius(t));
    distance = Math.Acos(distance);
    distance = Radius2Degree(distance);
    distance = distance * 60 * 1.1515;

    return distance;
}

private static double Degree2Radius(double deg)
{
    return (deg * Math.PI / 180.0);
}

private static double Radius2Degree(double rad)
{
    return rad / Math.PI * 180.0;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T12:40:26.783

~~不，但~~您可以使用文森蒂公式，它模拟了地球的形状。它在[Javascript](http://www.movable-type.co.uk/scripts/latlong-vincenty.html)中可用。

一个很容易解析的网页是（例如）：[http ://boulter.com/gps/distance/?from=51.5329855+-0.1303506&to=40.757584+-73.985642&units=m](http://boulter.com/gps/distance/?from=51.5329855+-0.1303506&to=40.757584+-73.985642&units=m)

对于只想快速测量距离的人，请查看[此小工具](http://maps.google.com/gadgets/directory?synd=mpl&backlink=http%3A%2F%2Fmaps.google.com%2Fmaps%2Fms%3Fie%3DUTF8%26hl%3Den%26msa%3D0%26ll%3D51.849777%2C-2.005005%26spn%3D0.089497%2C0.188141%26t%3Dh%26z%3D12%26msid%3D103027944771875072080.000462e55d09784e56337&url=http%3A%2F%2Frestonthewind.googlepages.com%2FrhumbMeasure.xml)。但是，它只使用大圆计算。

* * *

正如 Rob 所指出的，谷歌已经添加了它，但他们仍然只使用大圆公式，它可能不准确 1/300。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T12:05:35.420

我这样做已经很多年了，但你可以使用[大圆距离](http://en.wikipedia.org/wiki/Great-circle_distance)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-13T20:07:52.067

如果您只想将距离作为一个数字，请尝试这样的方法。

```
function InitDistances() {
    var startLocation = new GLatLng(startLat, startLon);
    var endLocation = new GLatLng(endLat, endLon);
    var dist = startLocation .distanceFrom(endLocation);

    // Convert distance to miles with two decimal points precision
    return (dist / 1609.344).toFixed(2);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-18T21:00:30.587

有一个方便的功能

[http://code.google.com/apis/maps/documentation/reference.html#GLatLng.distanceFrom](http://code.google.com/apis/maps/documentation/reference.html#GLatLng.distanceFrom)

基本上创建 2 个 GlatLng 对象然后使用上述方法

# python - 符号数学 Python？

> ID：506748
> 
> 赞同：21
> 
> 时间：2009-02-03T11:21:53.603
> 
> 标签：python, algorithm, math, symbolic-math

我对数学和编程非常感兴趣，并计划**从头开始****符号数学**项目。

 **1.  这是一个好的项目想法吗？

2.  从哪儿开始？

3.  应该如何处理这个项目？

4.  有什么好的资源吗？

提前致谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T11:41:40.240

1.  这是一个练习编程技能的好项目。但是，如果您想创建一个其他人想要使用的真实库，这是一个您不想从头开始的项目......

2.  *从哪里开始：*看看已经存在的解决方案，想想你想做的不同之处是什么。您的项目与其他项目有何不同？

3.  资源：[SymPy 是用于符号数学的 Python 库](http://code.google.com/p/sympy)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-03T12:02:38.700

1.Is this good project idea?

Yes; I would expect it to provide an endless source of interesting work which will, quite quickly, test and extend your programming powers.

2.Where to start?

I second the other suggestions that you should look at existing work. SAGE is very impressive and if you had asked for my advice I would suggest that you firstly write a basic system for doing arithmetic with numbers and symbols; then have a look at SAGE and write a module to extend the system, in other words become a contributor to something larger rather than trying to do it all on your own. Look also at Mathematica and Maple, Macsyma and Axiom. The latter 2 are free (I think) but they are all well documented on-line and a great source of ideas and challenges.

3.How should one approach this project?

As one would approach eating an elephant. One bite at a time. More seriously, I think there are some core issues, such as representation of expressions, and some basic functionality (arithmetic on polynomials) which you could cut your teeth on.

4.Any good resources?

Lots and lots. google for 'computer algebra', 'term rewriting'. Have a look at what's available on Amazon. And, if you have access, check out the ACM digital library

Good luck.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T11:57:43.423

Symbolic math is a fun project. Whether or not anyone uses it doesn't appear to matter in your question, so dive in.

I've written two of these over the years. The coolest was one for SQL where clauses -- it did some trivial symbolic manipulations on the SQL to fold in some additional AND conditions. Not a complete "solver" or "optimizer" or anything, just a few symbolic manipulations of any SQL where clause possible. The less cool one was for a debugger; it did complex math to work out (symbolically) stack offsets for variables.

You start by defining classes for elements of a mathematical expression -- operands, operators, functions, etc.

You have to decide what manipulations these objects have to participate in. Getting a concrete value for an expression is an easy and obvious one. Start with the case where all variables have a binding.

Then handle the case where some variables remain unbound, and you can only evaluate parts of the expression.

Then handle rearranging an expression into a canonical form. I.e., you've done a partial evaluation and have `Add( Variable(x), Add( Variable(x), Lit(3) ) )`. You need to write rules to transform this into `Add( Multiply( Lit(2), Variable(x) ), Lit(3) )`.

One very cool exercise is optimizing the parenthesis so that the printed output has the fewest parenthesis necessary to capture the meaning.

There are many, many other "expression transformation" rules that we all learn in school for doing algebraic manipulations. Lots of them.

In particular, rearranging an equation to isolate a variable can be really hard in some cases.

Doing the derivative transformation is easy, but symbolic integration is really, really hard with a ton of special cases.

The basics are fun. Depending on how far you want to go, it gets progressively harder.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T11:36:33.123

@Resources：你可以看看[pythonica](https://github.com/mikexstudios/pythonica) - 这是尝试在 Python 中实现 Mathematica 类型的程序（源代码可供下载）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T11:38:38.173

这个[pySym 博客](http://planet.sympy.org/)也可能会让您感兴趣，因为您可以获取想法和入门，并了解其他人使用 python 和符号数学所做的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T11:39:13.100

更多资源方式：[SympyCore](http://code.google.com/p/sympycore/)：

> SympyCore 项目的目的是寻找新的高性能解决方案来表示和操作 Python 编程语言中的符号表达式，并尝试新的符号模型以实现基本一致且足够通用的符号模型，该模型很容易扩展到计算机代数系统（CAS）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T22:04:22.277

I think this is a great project for a programmer of any skill level. It is quite easy to do implement a symbolic calculator that is just powerful enough to be useful. If you continue to work on breadth, there are so many fun features to add that you can occupy yourself with it for a long time. If you choose to go for depth, you will find that things soon get *very hard*. You can challenge yourself indefinitely, if that's what you like.

There are many great resources. I recommend the book "Modern Computer Algebra" by zur Gathen and Gerhard, although it is really more concerned with arithmetic in special forms (polynomials, integers, matrices) than general symbolic manipulation. When you're starting out, you may actually be better helped by looking at some Lisp or Scheme tutorial, because symbolic math is conceptually very straightforward to do in Lisp, and to build a symbolic engine in Python you'll more or less have to implement a mini-Lisp as a foundation.

As others have pointed out, you could look at SymPy and sympycore for inspiration or concrete algorithms. The source code for either project is a bit complex (but certainly not too hard to learn from).

(If I may plug a bit, I [wrote a tiny symbolic engine](http://www.dd.chalmers.se/~frejohl/code/sym/) a while back (as a weekend project -- it's very tiny and I haven't worked on it since). It implements a generic symbolic engine in about 200 lines of code, and then there are 300 lines of code implementing symbolic arithmetic and symbolic boolean algebra, with some very rudimentary simplification. Perhaps easier to dig into than SymPy. But everything in there is things that you could easily discover for yourself, and may have more fun doing so.)

# asp.net-mvc - 相当于要在控制器中调用的 html.actionlink？

> ID：506755
> 
> 赞同：0
> 
> 时间：2009-02-03T11:24:51.757
> 
> 标签：asp.net-mvc

我正在从控制器设置我的标题标签：

```
ViewData["H1"] = "Home > " + category + " > " + subcategory; 
```

我希望**Home**和**category**是 url，最好的方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T12:57:16.733

你不应该这样做。您的问题是询问如何从控制器创建 HTML。控制器不应创建 HTML。这就是视图的用途。相反，将类别和子类别传递给视图，并在那里生成 HTML：

```
 public ActionResult Foo()
    {
        ViewData["category"] = "Foo";
        ViewData["subcategory"] = "Bar";
        return View();
    }

<asp:Content ID="Content1" ContentPlaceHolderID="MainContentPlaceHolder" runat="server">
    <h3>Home &gt; <%=Html.ActionLink(ViewData["category"]) %>  
             &gt; <%=Html.ActionLink(ViewData["subcategory"]) %></h3> 
```

当然，您可以随意使用强类型模型而不是 ViewData 字典，但这应该会给您一个大致的概念。

**注意：我的原始答案如下。最初提出的问题（见后面的修订）与现在的问题完全不同。我留下了原来的答案，因为我认为它有一些价值。**

在我得到答案之前，如果我没有说这个例子在几个不同的方面是错误的，那我就是失职了。

1.  您是否应该在 MVC 应用程序中使用所有代码背后的代码至少是值得商榷的。
2.  您当然不应该在视图中设置 ViewData。ViewData 应该在控制器中设置并在视图中*读取。*

现在，话虽如此，在代码隐藏页面中调用 Html.ActionLink 的方法是，嗯，只需调用它。它工作得很好，并返回一个字符串，就像它在 aspx 中一样。

但是，我不建议这样做。相反，为您的标题创建一个助手：

1.  创建一个新的静态类。称之为 ViewHelpers 什么的。
2.  将此类的命名空间添加到 web.config 中的 pages->namespaces 部分
3.  向该类添加一个新方法 Header（或您喜欢的任何名称）。请参见下面的示例。
4.  现在从您的角度调用助手。同样，请参见下面的示例。

例子：

```
public static class ViewHelpers
{
    public static string Header(this HtmlHelper helper, 
        string category, string subcategory)
    {
        return string.Format("Home > {0} > {1}",
           helper.ActionLink(category),
           helper.ActionLink(subcategory);
    }
}

<asp:Content ID="Content1" ContentPlaceHolderID="MainContentPlaceHolder" runat="server">
    <%= Html.Header("foo", "bar") %>

<pages [...]>
  [...]
  <namespaces>
    [...]
    <add namespace="Your.Namespace.ContainingYourClass"/>
  </namespaces>
</pages> 
```

# multithreading - 线程化 DbExpress 查询

> ID：506762
> 
> 赞同：4
> 
> 时间：2009-02-03T11:28:50.643
> 
> 标签：multithreading, delphi, dbexpress

我只在 Delphi 中使用 DbExpress 组件完成了“GUI”数据库访问，但现在我想在后台执行一个查询。我读了一些 TSQLConnection 不是线程安全的，我必须为每个线程创建新连接。我看到 TSQLConnection 中有 CloneConnection，但 help 声称新连接归原始连接所有。

所以，

1) 执行位于线程数据模块上的 TSQLQuery 的正确方法是什么？

2) 我可以使用 TSQLConnection.CloneConnection 吗？我应该释放克隆的连接还是在线程结束时保持不变？

简单的示例代码（或 URL）会很有帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T12:00:32.077

这不是 DbExpress 特有的（我没有经验），但是将某些功能移动到后台线程的最佳想法是首先在主线程中开发它，调试它，一旦你确定它运行良好，然后移动它。

你能做的就是把所有东西都放在一个 TDataModule 上。如果数据模块能够独立工作，不需要其他表单或数据模块上的其他组件，并且您在后台线程中创建它，那么您可以相当确定事情会正常工作。您不需要克隆连接，因为它将在执行所有数据库访问的同一线程中创建和销毁。

数据库使用后台线程的一些重要提示：

*   处理所有异常，因为辅助线程中未处理的异常可能/将使您的应用程序崩溃。Application 对象中的异常处理对您不起作用。

*   不要访问 GUI 线程中的任何内容。这意味着最重要的是 TDataSource 不可用，并且不能使用任何数据敏感控件。

*   如果您使用的组件对 SendMessage 或 PostMessage 执行任何操作，则您必须在后台线程中创建标准消息循环。

*   如果您使用的组件对 OLE 执行任何操作，请在后台线程的上下文中调用 OleInitialize() 和 OleUnitialize()。

如果您想让您的生活更轻松，请考虑使用[OmniThreadLibrary](http://otl.17slon.com/)或[AsyncCalls](http://andy.jgknet.de/blog/?page_id=100)。哪一个取决于您的后台数据库连接将存在多长时间以及您是否要重用它们。

# ajax - 使用 jQuery 和 AJAX 对动态内容重新绑定函数

> ID：506764
> 
> 赞同：0
> 
> 时间：2009-02-03T11:29:53.447
> 
> 标签：ajax, asynchronous, jquery

我正在为网站构建后端管理面板，但我遇到了用于构建页面的 jQuery 和 AJAX 代码的问题。

在加载时，我将操作绑定到某些表格字段，允许用户添加或删除颜色或大小。当他们提交表格时，我清空表格并使用 AJAX 生成一个新表格，然后将新表格放入表格中。

不幸的是，新表单（如我所料）不受 $(document).ready 函数的影响。我想知道是否有一种方法可以重新调用 document.ready 函数以将操作绑定到页面中的新元素，或者在不通过 document.ready 函数的情况下调用 jQuery 函数。

我可以用 vanilla javascript 重写 jQuery 函数并以这种方式调用它，但如果可能的话，我更喜欢重用 jQuery 代码。

我找到了一些关于如何使用 ASP.NET 和 UpdatePanels 来做这件事的东西，但是这个网站是用 PHP 编写的，它使用一个基本的 AJAX 查询来插入数据库，重新获取结果然后建立结果表。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T11:44:15.337

您是否尝试过使用[现场活动](http://docs.jquery.com/Events/live)？这仅适用于 1.3。

对于以前的版本，您可以使用[实时查询](http://plugins.jquery.com/project/livequery)插件。有了这个，您可以运行匹配和不匹配侦听器（在匹配发生时运行代码）。您还可以使用 livequery.run 方法强制评估绑定。

更新：

对于现在发现此问题的任何人，从 1.7 开始，live 方法已被弃用。Live 有一些主要的烦人问题，因此被更强大的功能所取代：[on](http://api.jquery.com/on/)。即使您不在 1.7 上，您也应该高度考虑至少使用[委托](http://api.jquery.com/delegate/)（jquery 1.4.2），因为 live 有一些严格的限制

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T12:46:24.150

现场活动似乎是最好的答案；但如果不是，您应该简化`$(document).ready()`函数以使其调用初始化函数。稍后，在加载您的 AJAX 内容后，您只需再次调用它。

# c# - 将行插入数据库（C#、SQL Server CE）

> ID：506773
> 
> 赞同：0
> 
> 时间：2009-02-03T11:34:57.557
> 
> 标签：c#, sql-server, visual-studio-2008

我正在尝试使用表适配器的更新方法向数据库中的表添加一行。我没有收到任何错误。看起来它工作正常，但没有实际插入数据库。但是，如果我尝试再次插入同一行，我会收到一个约束异常，说我正在尝试插入表中已经存在的数据。但最终没有数据物理插入到表中。我尝试使用表适配器的插入方法，但我得到了同样的错误。

我在哪里做错了？

这是插入的代码：（数据库名称：`pompadatabase`，表名称`pompa`：）

```
pompadatabaseDataSet.pompaRow tmprow;
tmprow = pompadatabaseDataSet.pompa.NewpompaRow();
tmprow.isim = textBox5.Text;
tmprow.info = richTextBox1.Text;
tmprow.resim = bao;
tmprow.seri_id = Convert.ToInt32(sinifBox.SelectedValue.ToString());
this.pompadatabaseDataSet.pompa.Rows.Add(tmprow);
this.pompaTableAdapter.Update(this.pompadatabaseDataSet.pompa); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T11:53:59.030

您在哪里“物理地”寻找数据？我的意思是，您是在检查解决方案资源管理器中的数据库实例还是调试文件夹中的数据库实例？当您运行您的应用程序时，SQL Server CE db 文件的副本将放在该文件夹中，并且行将保存在那里。每次重新运行应用程序时，该文件都会被覆盖。尝试从该文件夹运行您的应用程序，如果一切顺利，那就是问题所在。好吧，这听起来可能很傻，但是当我第一次开始使用 DataSets 和 TableAdapters 时，它就发生在我身上。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-04T06:44:21.950

pompaTableAdapter 的事务需要提交。即 urtransaction.Commit(); 然后在 Db 中查看您的数据是否已保存。

# sql - SQL 触发器

> ID：506776
> 
> 赞同：1
> 
> 时间：2009-02-03T11:35:13.890
> 
> 标签：sql, triggers

`tbl_repair_visit.TENANTSATISFACTION = 'Poor'`如果更新，我有附加的触发器。

如果我们更改工程师名称，工程师列会更新并且触发器再次运行，如果`TENANTSATISFACTION = 'Poor'`

我如何将其设置为仅在`TENANTSATISFACTION = 'Poor'`更新列并忽略所有其他列的更新时运行

```
ALTER TRIGGER [dbo].[tr_CustomerSatisfactionAlertRepair] 
    ON [dbo].[tbl_repair_visit] 
AFTER UPDATE
AS 
BEGIN
    SET NOCOUNT ON;
    INSERT alertmessagedata (TypeID, Contract, Address, ORDERID, 
                ENGINEERS, Sent, DateAdded)
    SELECT '5', tbl_property.contract, tbl_property.fulladdress, 
            tbl_repair_visit.orderid, tbl_repair_visit.engineer, 
            0, GETDATE()
    FROM TBL_REPAIR_VISIT 
    INNER JOIN
        INSERTED X ON TBL_REPAIR_VISIT.VISITID = X.VISITID 
    INNER JOIN 
        TBL_PROPERTY ON TBL_REPAIR_VISIT.PROPREF = TBL_PROPERTY.PROPREF
    WHERE tbl_repair_visit.TENANTSATISFACTION = 'Poor'
END 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T11:42:11.003

在更新触发器中，您可以检查列是否正在更新：

如果更新（租户满意）开始 .... 结束

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T11:54:31.713

我不认为你可以指定。每当对表执行 UPDATE、DELETE 或 INSERT（相应地）时，都会触发触发器 UPDATE、DELETE 和 INSERT。

您可以按照 Mike K. 的建议进行操作，并检查您感兴趣的列是否发生了变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T12:09:36.877

你不能用嵌套触发器选项做点什么吗？
（关闭该选项，以便触发器不会导致其他触发器被触发）

或者，也许您可​​以创建一个 INSTEAD OF 触发器，而不是一个 AFTER 触发器。当然，然后在您的 INSTEAD OF 触发器中，您还必须在附加逻辑旁边编写应该执行实际更新或插入表的 UPDATE（或插入）语句。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T12:11:00.243

从旧版本左连接记录的新版本，如果连接的表（即插入）有空值，则表示您要检测更改的字段已更改。

```
create table family
(
id int not null identity(1,1),
name varchar(100) not null,
age int not null
);

insert into family(name,age) values('Michael', 32);
insert into family(name,age) values('Matthew', 23);

create trigger TrigUpdOnFamily on family
for update
as

    if exists
        (
        select * from deleted 
        left join inserted on inserted.id = deleted.id    

        -- put the fields to detect here...
        and inserted.age = deleted.age
            -- ...detections
        where inserted.age is null) begin    

        -- detect important fields
        print 'age change';

    end
    else begin
        -- ignore non-important fields
        print 'nothing change';
    end;

go

-- possible SqlCommand from .NET
update family set name = 'Michael', age = 20 where id = 1;    

update family set name = 'Mateo', age = 23 where id = 2; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T13:03:25.630

```
create table Programmer
(
id int not null identity(1,1),
name varchar(100) not null,
status varchar(20)
);

insert into Programmer(name,status) values('Pampers', 'Rich');

create trigger TrigUpdOnProgrammer on Programmer
for update
as

    if exists
        (
        select * from deleted 
        left join inserted on inserted.id = deleted.id    

        -- put the fields to detect here...
        and inserted.status = deleted.status -- detect if changed
        -- ...detections
        where inserted.status is null) 

       -- if changes detected on status, then check if it is Poor.  
       -- don't worry, there's no performance degradation.  SQL AND is short-circuited
       and exists(select * from inserted where status = 'Poor')
    begin    
       print 'status changed';
    end
    else begin
        print 'changes ignored';
    end;

go

-- execute the following on succession, then check the output

update Programmer set status = 'Poor' where id = 1; -- changes detected

update Programmer set status = 'Poor' where id = 1; -- changes ignored

update Programmer set status = 'Rich' where id = 1; -- changes ignored

update Programmer set status = 'Poor' where id = 1; -- changes detected 
```

# android - 如何从 Eclipse 自动运行 Android 模拟器？

> ID：506777
> 
> 赞同：24
> 
> 时间：2009-02-03T11:35:25.730
> 
> 标签：android, eclipse, emulation

我需要知道如何从 Eclipse 自动运行 Android 模拟器。

有任何想法吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-03T11:44:38.630

安装[**ADT**](http://code.google.com/android/intro/installing.html#installingplugin)后，您需要定义[ADT 启动配置](http://code.google.com/android/intro/hello-android.html#run)，以便您的项目将自身作为 Android 可执行文件执行。

![你好世界安卓](https://i.stack.imgur.com/8fDv6.png)

* * *

然后，不要忘记进入`Eclipse->Preferences->Run/Debug->Launching`。
在“<code>Launch Operation”小节中，选择“<code>始终启动之前启动的应用程序”：

![Eclipse 启动选项](https://i.stack.imgur.com/5JJNn.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-12-17T16:54:01.717

有两种方法。

*   从**菜单栏**启动*AVD*

     ***脚步 ：*

    1.  点击**Android 虚拟设备管理器**

        [![图像1](https://i.stack.imgur.com/almHS.png)](https://i.stack.imgur.com/almHS.png)

    2.  选择您创建的设备，然后单击**开始**

        [![图2](https://i.stack.imgur.com/U2Lgw.png)](https://i.stack.imgur.com/U2Lgw.png)

    3.  单击**启动**并等待启动*AVD*。

        [![图3](https://i.stack.imgur.com/BAUbO.png)](https://i.stack.imgur.com/BAUbO.png)

    4.  您的*AVD*正在运行..

        [![图4](https://i.stack.imgur.com/ov15c.png)](https://i.stack.imgur.com/ov15c.png)** 
***   从**运行配置**启动*AVD*

     ***脚步 ：*

    1.  右键单击菜单栏上的**运行图标，然后选择***运行配置*

        [![图5](https://i.stack.imgur.com/jfDVf.png)](https://i.stack.imgur.com/jfDVf.png)

    2.  选择**目标**选项卡>选择第三个单选选项说*（自动选择兼容设备：...）* >勾选您想要启动的*所需AVD* >单击**应用**>单击**运行**

        [![图6](https://i.stack.imgur.com/Ox4Z7.png)](https://i.stack.imgur.com/Ox4Z7.png)**** 

 ****# ruby-on-rails - act_as_ordered Rails 插件不工作

> ID：506788
> 
> 赞同：1
> 
> 时间：2009-02-03T11:38:33.477
> 
> 标签：ruby-on-rails, ruby

act_as_ordered 插件在我的 Ruby on Rails 应用程序中没有排序记录。

我有以下型号

测验.rb

```
class Quiz < ActiveRecord::Base
  acts_as_ordered :order => 'created_at DESC'
  validates_presence_of :name, :user_id

  belongs_to :user
  has_many :questions

  before_destroy :delete_questions
end 
```

问题.rb

```
class Question < ActiveRecord::Base
  acts_as_ordered :scope => :Quiz, :order => 'question_order'
  validates_presence_of :quiz_id

  belongs_to :quiz
end 
```

[我已经从http://svn.viney.net.nz/things/rails/plugins/acts_as_ordered](http://svn.viney.net.nz/things/rails/plugins/acts_as_ordered)安装了acts_as_ordered 插件

据我所见，以下内容应该在 quizzes/edit.html.erb 视图中工作（它实际上是部分的，但我认为这不太相关）

```
<table>
  <% for question in @quiz.questions %>
    <tr>
      <td><%= question.question_order %>. <%= question.question_text %></td>
    </tr>
  <% end %>
</table> 
```

问题是问题没有显示在“question_order”中。

我以前使用过这个插件，并让它与 find 命令一起工作。

act_as_ordered 在这种情况下有效吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T05:37:02.550

我认为您为您的目的使用了错误的插件...按顺序操作是用于从单个找到的记录中查找下一个/上一个记录，而不是用于订购关联列表。

我相信你要找的是[作为列表](http://github.com/rails/acts_as_list/tree/master)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-03T03:29:39.720

仅按顺序列出记录的宝石似乎过大了。

我会尝试：question.rb

```
class Question < ActiveRecord::Base
  scope :by_quiz :order => 'question_order'
  validates_presence_of :quiz_id
  belongs_to :quiz
end 
```

# linux - 串行终端上的二进制数据

> ID：506805
> 
> 赞同：5
> 
> 时间：2009-02-03T11:49:30.397
> 
> 标签：linux, embedded, binary, terminal

我与嵌入式设备的唯一通信方式是串行端口。默认情况下，嵌入式 Linux 使用此端口作为终端。如何禁用此终端并使用串行链路传输二进制数据？我听说过 rx 和 tx 之类的命令，但我找不到它们。

我想我可以从 /dev/tty 中读取（）和写入（）内容，但我想确保没有错误消息或任何与我的数据流混淆的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T12:08:08.410

您不能将终端设置为原始吗？

看看[这个教程](http://www.faqs.org/docs/Linux-HOWTO/Serial-Programming-HOWTO.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T13:26:16.693

要禁用 Linux 控制台，您必须更改引导加载程序创建的 Linux 命令行：console=/dev/ttyS? 到：控制台=空

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T14:18:05.573

您可以使用 xmodem 之类的应用程序通过任何终端传输文件。您所说的串行端口是终端，还是内核控制台。

如果您的内核不嘈杂，那么您可以使用您当前的连接来进行 xmodem 之类的传输。在主机端，您可以使用 kermit，它很好且可编写脚本。

如果你想让你的串口变成原始的，并且你打开了文件描述符 ttyfd，这是一种方法：

```
struct termios tty, orig_tty;

...

if(tcgetattr(ttyfd, &tty) < 0)
{
    // error checking
}
// backup tty, make it raw and apply changes
orig_tty = tty;
cfmakeraw(&tty);
if(tcsetattr(ttyfd, TCSAFLUSH, &tty) < 0)
{
    // error checking
}

...
//end of program or error path :
tcsetattr(ttyfd, TCSAFLUSH, &orig_tty) 
```

如果您仍然想要一个表现良好的终端，请不要忘记在程序结束时恢复设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T12:14:46.727

您可以在终端上运行将通过应用程序级协议传输数据的命令。您所指的 rx 和 tx 命令实现了[XMODEM 文件传输协议](http://en.wikipedia.org/wiki/XMODEM)。这可能是一个解决方案，如果您要传输的二进制数据由文件组成，吞吐量需求很低，并且您不介意运行命令的管理开销。或者，您可能希望复用串行端口来处理数据传输和终端。禁用串行终端驱动程序命令 (getty)，并通过串行线路运行[PPP](http://en.wikipedia.org/wiki/Point-to-Point_Protocol)协议以建立与您的设备的 IP 连接。然后，您可以通过 ssh 或 telnet 登录设备并通过 IP 套接字传输数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-09T04:34:49.133

正如其他注释所暗示的那样，有几件事需要检查，收集在这里：

1.  确保 linux 内核没有使用串口。确保 grub 文件中的 bootload 命令没有 console= 选项。默认情况下它通常不存在。
2.  确保串行端口上没有运行 getty。在 /etc/inittab 中查找 /dev/ttyS0（串行端口 A）的条目，如果存在则将其注释掉。
3.  确保您的进程可以读写 /dev/ttyS0。您可以创建一个运行控制程序的特定用户，该用户拥有 /dev/ttyS0，然后 chmod 700 /dev/ttyS0。这将有助于确保其他一些用户/程序也不会尝试使用串行端口。
4.  在 ttyS0 上使用 open() 来获取 fd，然后使用 tcsetattr 系列例程来设置线路速度和纪律。

终端程序可能对您没有用处，除非您可以在嵌入式设备上运行相同的程序来管理连接的另一端。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T12:29:05.403

是的，你所有的串口都在`/dev/ttyxx`. 请注意，这`/dev/tty`是代表您当前终端的快捷方式，而不是特定的串行端口。通常，这些由 root 拥有，并且要求您具有特权或在`adm`组中才能直接从您的应用程序访问设备。

您可能需要`chown`该设备，以便您可以访问它。我不确定更改设备所有权的后果是什么；IIRC，它很容易做到并且效果很好。另一种方法是用于`setuid`将您的程序提升到特权状态。

有一个名为`getty`让用户从串行端口登录的程序。您`inittab`将从`getty`串行端口开始，以便人们可以登录。

你想禁用`getty`. 在某些情况下，有一个端口管理器可以帮助做到这一点。

在某些情况下，您可以更改您`inittab`的使用`mgetty`，这是一个更智能且更易于控制的`getty`.

# api - 是否可以以编程方式与 MSN messenger / Live messenger 交谈？

> ID：506806
> 
> 赞同：2
> 
> 时间：2009-02-03T11:49:43.783
> 
> 标签：api, msn

我一直在研究如何以编程方式与 MSN messenger / Live messenger 服务进行交互，但我找不到任何关于此的真实文档。Live 服务的文档似乎只在 Javascript 中实现（它们在这里：[http](http://dev.live.com/Messenger/) ://dev.live.com/Messenger/ ）

可以对这个 API 进行逆向工程以获取它实际使用的 Web 服务，但我猜他们没有提供源代码是有原因的（这意味着这些 Web 服务不适合直接访问） .

但是，我找不到任何其他允许编程访问的官方 API（更具体地说，没有提到套​​接字、Web 服务或适当的编程语言（如 Java 或 .Net）的 API）。

有谁知道这样的 API 是否存在？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T11:54:30.870

查看[LibPurple](http://developer.pidgin.im/wiki/WhatIsLibpurple)，它是 pidgin 多协议 IM 客户端的底层库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T11:53:02.060

开源[pidgin](http://www.pidgin.im/)做到了，所以也许看看？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-03T00:26:23.707

[MSNP-Sharp](http://code.google.com/p/msnp-sharp/)是一个非常好的 C# API。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T11:51:58.693

您还没有说明您的目的是什么，但也许您可以使用 pidgin、amsn 或 centerim 等替代客户端的源代码来访问 msn live 网络并使用您想要的任何服务。我无法向您指出任何文档，但您可以根据需要使用他们的源代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T11:56:07.390

C足够合适吗？

我会看看[msn-pecan](http://github.com/felipec/msn-pecan/tree/master) - Pidgin 的 WLM 插件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T12:08:57.910

让我澄清一下我要用它做什么。我们想要一个可行的解决方案，能够从 Flash 连接到 MSN messenger，我们不能直接连接，因为 flash 有点疯狂，并且不喜欢打开到域的套接字连接，除非它被邀请。

所以我们需要用适当的语言构建一个代理服务器（显然我们也希望支持其他协议，所以它可以很好地与 lib Purple 配合使用）。我们在 C 领域没有任何经验，因此最好将其保留在 Java 中，这是我们团队在这方面的经验，但似乎真的没有任何像样的 Java API 或 API Java 可以与之交互的。

不过，感谢小伙子的建议。它们看起来非常有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-25T23:54:06.197

[Java MSN Messenger Library](http://sourceforge.net/apps/trac/java-jml)也很不错。

# algorithm - 创建具有特定位数设置的多个数字

> ID：506807
> 
> 赞同：20
> 
> 时间：2009-02-03T11:50:31.190
> 
> 标签：algorithm, binary, permutation, combinations

## 问题

我需要创建 32 位数字（有符号或无符号都无关紧要，无论如何都不会设置最高位）并且每个数字都必须设置给定数量的位。

## 天真的解决方案

最简单的解决方案当然是从零开始。在一个循环内，数字现在增加一，对位的数量进行计数，如果计数具有所需的值，则将数字存储到列表中，如果不是，则循环重复。如果找到足够的数字，则停止循环。当然，这工作得很好，但是一旦所需的位数变得非常高，它就会非常慢。

## 更好的解决方案

设置（假设）5 位的最简单数字是设置前 5 位的数字。这个号码可以很容易地创建。在一个循环中，第一位被设置并且数字向左移动一个。这个循环运行了 5 次，我找到了第一个设置了 5 位的数字。接下来的几个数字也很容易创建。我们现在假设这个数字是 6 位宽，并且最高的没有设置。现在我们开始将第一个零位向右移动，因此我们得到 101111、110111、111011、111101、111110。我们可以通过在前面添加另一个 0 并重复此过程来重复此过程。0111110、1011110、1101110 等。然而，这样数字的增长速度会比必要的快得多，因为使用这种简单的方法，我们会忽略像 1010111 这样的数字。

那么有没有更好的方法来创建所有可能的排列，一种通用的方法，可以使用，不管下一个数字有多少位，也不管我们需要设置多少位？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-03T12:11:18.340

您可以使用[来自hackersdelight.org 的bit-twiddling hack](https://web.archive.org/web/20130731200134/http://hackersdelight.org/hdcodetxt/snoob.c.txt)。

在他的书中，他有代码可以使用相同数量的一位集合来获得下一个更高的数字。

如果您将其用作增加数量的原语，您所要做的就是找到一个起点。获得设置了 N 位的第一个数字很容易。它只是 2^(N-1) -1。

这样，您将非常快速地遍历所有可能的数字。

```
 unsigned next_set_of_n_elements(unsigned x) 
  {
     unsigned smallest, ripple, new_smallest, ones;

     if (x == 0) return 0;
     smallest     = (x & -x);
     ripple       = x + smallest;
     new_smallest = (ripple & -ripple);
     ones         = ((new_smallest/smallest) >> 1) - 1;
     return ripple | ones;
  }

  // test code (shown for two-bit digits)

  void test (void)
  {
    int bits = 2;
    int a = pow(2,bits) - 1;
    int i;

    for (i=0; i<100; i++)
    {
       printf ("next number is %d\n", a);
       a = next_set_of_n_elements(a);
    }
  } 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-03T12:05:06.933

尝试从相反的方式解决问题 - 您尝试做的相当于“在 0-31 范围内查找*n 个*数字”。

假设您要查找 4 个数字。你从 [0,1,2,3] 开始，然后每次增加最后一个数字（得到 [0,1,2,4]，[0,1,2,5] ...），直到达到极限[0,1,2,31]。然后增加倒数第二个数字，并将最后一个数字设置为高一个：[0,1,3,4]。回到增加最后一个数字：[0,1,3,5]，[0,1,3,6]...等。一旦你结束了，你回到[0,1,4 ,5] - 最终你到达 [0,1,30,31] ，此时你必须进一步回溯：[0,2,3,4] 然后再走。继续前进，直到最终得到 [28,29,30,31]。

给定一组数字，显然很容易将它们转换为 32 位数字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T12:18:30.900

您想生成组合，请参阅此[Wikipedia 文章](http://en.wikipedia.org/wiki/Combinadic)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T11:54:05.677

您要么需要 Factoradic Permutations (Google on that)，要么需要 Wiki 上的一种[算法](http://en.wikipedia.org/wiki/Permutation#Algorithms_to_generate_permutations)

# .net - 通过 .NET 应用程序运行 CrystalReport 与使用任何 CrystalReport 设计器运行它是否不同？

> ID：506817
> 
> 赞同：0
> 
> 时间：2009-02-03T11:54:12.370
> 
> 标签：.net, visual-studio-2005, crystal-reports

我使用嵌入 VisulaStudio.NET 2005 的 CrystalReport Designer 设计了一个 CrystalReport，在使用报表查看器运行报表时，它可以正常运行并检索所需的数据。通过应用程序运行它时，没有检索到数据？！

通过 .NET 应用程序运行 CrystalReport 是否与使用嵌入 VisulaStudio 的 CrystalReport Designer 运行不同？

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T12:59:56.823

我面临类似的问题。 [打开 CrystalReport 查看器时出错](https://stackoverflow.com/questions/506915/error-opening-crystalreport-viewer)

我认为没有任何区别，因为它在我的开发人员上运行良好。设置以及当应用程序与数据库在同一台机器上运行时。我猜它有一些安全/凭据问题。

如果你发现了什么，请告诉我。

谢谢，拉姆吉

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T15:03:14.377

如果您认为它与安全/凭据有关，您可以使用此代码来解决此问题。即使，我这样做了，我仍然有问题。

```
// Provides current ReportDocument with LogonInfo.
CrystalGen cg = new CrystalGen(this.Page);
cg.CrystalReportLogOn(rptDoc, ConfigurationManager.AppSettings["ReportDataSource"], ConfigurationManager.AppSettings["ReportUserID"], ConfigurationManager.AppSettings["ReportPassword"]); 
```

当然，使用您的更改登录访问权限。尝试并反馈我们。

# database-design - 双主键设计

> ID：506819
> 
> 赞同：0
> 
> 时间：2009-02-03T11:54:25.723
> 
> 标签：database-design

我的数据库有一个跟踪部门和用户 ID 的表。这里要注意的是，虽然部门和 user_id 列可以有重复项，但它们的组合不能。这就是说，

```
DepartmentA    0001
DepartmentA    0002
DepartmentB    0001
DepartmentB    0002 
```

是我表中的有效数据。但

```
DepartmentA   0001
DepartmentA   0001 
```

*无效*。_

部门和 user_id 的组合形成了记录的唯一标识符。在另一个表中，我需要使用这个唯一标识符来跟踪用户的活动，比如他们什么时候进入大楼、什么时候离开大楼等。

我在想的是我创建了以下表格

```
CREATE TABLE user (
 user_id INT( 4 ),
 department VARCHAR( 25 ) NOT NULL ,
 combined_id int(4) ,
 UNIQUE ( combined_id ) ,
 Primary key(user_id, department)
 );

CREATE TABLE user_activity(
combined_id int(4),
activity varchar(25),
Foreign Key (combined_id) references user(combined_id)
); 
```

所以我正在考虑为我的目的使用双主键。恕我直言，这是保证数据完整性的最佳方式。但是据我所知，使用双主键可能很难与[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)一起使用，即它们不完全受支持，必须为其编写自定义查询。

考虑到我的情况，上述设计是最好的吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T12:05:40.100

我会使用代理主键，并对这两个应该保持唯一的字段的组合施加唯一约束。

也就是说，我不会考虑将我的员工编号作为主键。这有利于很多场景。

所以，这就是我要做的

```
CREATE TABLE Employee
(
  EmployeeId INT ,
  EmployeeNumber VARCHAR(4),
  DepartmentId INT,
  EmployeeName
)

CREATE TABLE Department
(
   DepartmentId INT,
   DepartmentName
) 
```

在 Employee 表中，EmployeeId 是主键。此列仅包含一个数字，在问题域中没有任何意义。它在数据库中仅具有管理意义（唯一标识员工）。

EmployeeNumber 包含“用于识别员工的业务/域号”。请注意，我已将此字段设为 VARCHAR 字段，因为您在示例中将该数字用 LPAD 表示为零。所以实际上，它不应该是一个数字字段。:)

除此之外，Employees 表中还有一个 DepartmentId 列，它是 Department 表的外键。在 Employee 表中，您应该在 EmployeeNumber/DepartmentId 字段上放置一个唯一约束。（因此，对两列组合的一个约束）。

然后，User_Activity 表可以如下所示：

```
CREATE TABLE User_Activity
(
  EmployeeId INT,
  ActivityId INT
) 
```

（我知道 CREATE TABLE 语句并不是真正真正正确的 SQL 语句，但这只是为了说明的目的）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T12:07:23.013

只需创建单独的主键，并为 (user_id, department) 创建新的唯一索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T12:06:42.983

我会将您的主键创建为 User_ID 和 Department 的组合，并在该表中有另一个字段是身份/自动增量字段（也带有唯一索引），并将该值用作您对其他字段的 FK 引用。

这假设您不会经常删除和重新创建用户/部门对（因为您每次都会中断与从属表的这些链接），在这种情况下，使用复合键作为 FK 引用可能更有意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T12:06:57.820

我建议将代理标识符作为主键，将复合 user_id 和部门键作为备用唯一键。

# mysql - 在mysql中选择一个名称中带有空格的数据库

> ID：506826
> 
> 赞同：17
> 
> 时间：2009-02-03T11:57:05.250
> 
> 标签：mysql, database, console, spaces

我想在 mysql 控制台中选择我的特定数据库，但问题是我的数据库名称之间有一个空格，mysql 忽略了空格后面的部分。例如，当我发出命令时：

```
use 'student registration' 
```

我收到消息：

```
cannot find database 'student' 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-03T11:59:54.557

您应该尝试使用反引号 ("`") 来引用您的数据库名称。一般来说，最好使用命名约定来消除空格，例如

```
USE `StudentRegistration`; 
```

或者

```
USE `student_registration`; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-03T12:53:36.243

你有两个选择。

1 用反引号或单引号将数据库名称括起来。

> ```
> USE `student registration`;
> USE 'student registration'; 
> ```

2 转义空白字符。

> `USE student\ registration;`

奇怪的是，这会产生。

> 错误：未知命令“\”。

但仍然更改数据库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-01-24T12:33:56.737

使用双引号而不是单引号，双引号对我有用：

```
USE "student registration"; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-09T18:24:56.763

当我不得不用空格处理其他人的桌子时，以下工作：

```
use `student registration`; 
```

至少那将是你的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-08T10:50:49.407

`student registration`不带引号使用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-08-27T13:51:31.970

您必须使用方括号来完成这项工作：

```
Use [student registration] 
```

# sql - 如何将一周（200851）转换为日期（2008-12-27）？

> ID：506827
> 
> 赞同：5
> 
> 时间：2009-02-03T11:57:25.403
> 
> 标签：sql, sql-server, tsql, date-arithmetic

我如何将年周（例如 0852 或 200852）转换为日期（例如 2008 年 12 月 31 日或特别是周末的一天，即星期六 2008 年 12 月 27 日或一周的开始日，即 2008 年 12 月 21 日) ? 周末的任何一天都可以，周五、周六、周日或周一。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T12:50:23.770

MS SQL SERVER 具有 DATEADD 功能，应该可以帮助...

```
DECLARE @date_string NCHAR(6)
SELECT  @date_string = N'200852'

SELECT DATEADD(
           WEEK,
           CAST(RIGHT(@date_string, 2) AS INT),
           DATEADD(
               YEAR,
               CAST(LEFT(@date_string, 4) AS INT) - 1900,
               0
           )
       ) 
```

编辑：

抱歉，错过了关于使它成为星期六等的一点...

一旦你有了这个值，使用 DATEPART 来得到它是星期几，然后从你的答案中减去它......

```
DECLARE @new_date DATETIME
SELECT  @new_date = '2008 Dec 30'

SELECT DATEADD(DAY, 1-DATEPART(dw, @new_date), @new_date) 
```

这会将值带到一周的开始，具体取决于您将 DATEFIRST 设置为什么。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T13:44:10.807

这是一个几乎独立于数据库的解决方案，如果这很重要的话。

创建一个名为 ALMANAC、主键 DATE 的表，其中列出了您计划使用的日期的所有属性。其中一个可能是 YEAR，另一个可能是 WEEK。您可以包含任何您想经常使用的 DATE 可计算函数。您还可以包括公司特定的 DATE 属性，例如该日期是否是公司假日。

编写一个程序来填充 DATE 比如说 10 年（大约 3650 行加上一些闰年）。该程序将使用 DBMS 或某些编程语言中可用的环境特定日期函数。一旦您填充了 ALMANAC 表，就可以像使用普通数据一样使用它。将主键与数据库中的任何日期字段连接起来。

事实证明，这对于按周、按月、按季度和按年几乎自动地准备报告等事情非常有用。

如果 DATE 的粒度不够细，您甚至可以将年历划分为更小的时间单位，例如 3 个班次为 1 天的班次。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2021-12-02T12:53:49.920

为此，我创建了一个 UDF。
它将 YYYYWW 字符串或数字转换为日期。

```
CREATE FUNCTION dbo.GetDateFromYearWeek (
 @YearWeek VARCHAR(7) = '000101', -- default
 @WeekDay INT = 1, -- default
 @FirstWeekDayName VARCHAR(9) = 'mon' -- default
) RETURNS DATE
BEGIN

 IF @YearWeek = '000101'
   SET @YearWeek = CONCAT(DATEPART(year, GETDATE()), '-', DATEPART(week, GETDATE())); 

 IF @YearWeek NOT LIKE '[0-9][0-9][0-9][0-9]%[0-9-][0-9]'
   RETURN NULL;

 IF @WeekDay < 1 OR @WeekDay > 7
   RETURN NULL;

 DECLARE @FirstWeekDay INT = CHARINDEX(LOWER(LEFT(@FirstWeekDayName,3)), '   montuewedthufrisatsun')/3;
 IF @FirstWeekDay = 0 -- not found in string
   SET @FirstWeekDay = @@DATEFIRST;

 DECLARE @Year INT = TRY_CAST(LEFT(@YearWeek, 4) AS INT);
 DECLARE @Week INT = ABS(TRY_CAST(RIGHT(@YearWeek, 2) AS INT));

 DECLARE @Date DATE = TRY_CAST(CONCAT(@Year,'-01-01') AS DATE);
 SET @Date = DATEADD(week, @Week-1, @Date);

 DECLARE @DowDiff INT = (6-@FirstWeekday+@@DATEFIRST+DATEPART(weekday,@Date))%7;
 SET @Date = DATEADD(day, -@DowDiff, @Date);
 SET @Date = DATEADD(day, @WeekDay-1, @Date);

 RETURN @Date;
END; 
```

**示例用法：**

```
SELECT *
, [StartOfWeek_SundayFirst] = dbo.GetDateFromYearWeek(col, 1, 'sun')
, [StartOfWeek_MondayFirst] = dbo.GetDateFromYearWeek(col, 1, 'mon')

, [EndOfWeek_SundayFirst]   = dbo.GetDateFromYearWeek(col, 7, 'sunday')
, [EndOfWeek_MondayFirst]   = dbo.GetDateFromYearWeek(col, 7, 'monday')
FROM (VALUES (202201), (202202)) q(col)
ORDER BY 1; 
```

| 山口 | StartOfWeek_SundayFirst | StartOfWeek_MondayFirst | EndOfWeek_SundayFirst | EndOfWeek_MondayFirst |
| --- | --- | --- | --- | --- |
| 202201 | 2021-12-26 | 2021-12-27 | 2022-01-01 | 2022-01-02 |
| 202202 | 2022-01-02 | 2022-01-03 | 2022-01-08 | 2022-01-09 |

*[在这里](https://dbfiddle.uk/?rdbms=sqlserver_2017&fiddle=fa6e5fb32d9677b71052479ed8b7d2e2)*测试*db<>fiddle*

**ISO_WEEK 版本**

> ```
> CREATE FUNCTION dbo.GetDateFromIsoYearWeek (
>  @YearWeek VARCHAR(7) = '0000-00', -- default
>  @WeekDay INT = 1 -- default
> ) RETURNS DATE
> BEGIN
>  
>  IF @YearWeek = '0000-00'
>    SET @YearWeek = CONCAT(DATEPART(year, GETDATE()), '-', DATEPART(iso_week, GETDATE())); 
>  
>  IF @YearWeek NOT LIKE '[0-9][0-9][0-9][0-9]%[0-9-][0-9]'
>    RETURN NULL;
>  
>  IF @WeekDay < 1 OR @WeekDay > 7
>    RETURN NULL;
>  
>  DECLARE @FirstWeekDay INT = 1; -- monday
>  DECLARE @Year INT = TRY_CAST(LEFT(@YearWeek, 4) AS INT);
>  DECLARE @Week INT = ABS(TRY_CAST(RIGHT(@YearWeek, 2) AS INT));
>  
>  DECLARE @Date DATE = TRY_CAST(CONCAT(@Year,'-01-08') AS DATE);
>  SET @Date = DATEADD(week, @Week - 2 + (DATEPART(week, @Date)-(DATEPART(iso_week, @Date))), @Date);
>  
>  DECLARE @DowDiff INT = (6-@FirstWeekday+@@DATEFIRST+DATEPART(weekday,@Date))%7;
>  SET @Date = DATEADD(day, -@DowDiff, @Date);
>  SET @Date = DATEADD(day, @WeekDay-1, @Date);
> 
>  RETURN @Date;
> END; 
> ```

> ```
> DECLARE @Test TABLE ([column] char(7)); 
> INSERT INTO @Test VALUES 
>   ('2020-53'), ('2021-01'), ('2021-02')
> , ('2021-48')
> , ('2021-53'), ('2022-01'), ('2022-02')
> ;
> 
> SELECT [column]
> , [FirstOfWeek] = dbo.GetDateFromIsoYearWeek([column], 1)
> , [LastOfWeek]  = dbo.GetDateFromIsoYearWeek([column], 7)
> FROM @Test
> ORDER BY 1; 
> ```

> | 柱子 | 第一周 | 最后一周 |
> | --- | --- | --- |
> | 2020-53 | 2020-12-28 | 2021-01-03 |
> | 2021-01 | 2021-01-04 | 2021-01-10 |
> | 2021-02 | 2021-01-11 | 2021-01-17 |
> | 2021-48 | 2021-11-29 | 2021-12-05 |
> | 2021-53 | 2022-01-03 | 2022-01-09 |
> | 2022-01 | 2022-01-03 | 2022-01-09 |
> | 2022-02 | 2022-01-10 | 2022-01-16 |

*[在这里](https://dbfiddle.uk/?rdbms=sqlserver_2014&fiddle=1973e0b3af8e3979925c90cda231e858)*测试*db<>fiddle*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T12:38:28.303

日期函数几乎是特定于数据库的。例如，在 MySQL 中，您可以执行以下操作以获取 'YYYYWW' 格式的一周中的星期一：

```
select date_sub(makedate(left('YYYYWW', 4), 1 + (right('YYYYWW', 2) - 1) * 7), 
interval weekday(makedate(left('YYYYWW', 4), 1 + (right('YYYYWW', 2) - 1) * 7)) DAY); 
```

使用 makedate(left('YYYYWW', 4), 1 + (right('YYYYWW', 2) - 1) * 7) 你会得到一个绝对在给定周和年的日期，并且使用 date_sub 函数我们回到那周的星期一。

例子：

*   对于“200906”，这将返回“2009-02-02”
*   对于“200901”，它将返回“2008-12-29”（这实际上是 2009 年第 1 周的星期一）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T12:20:02.347

在甲骨文中：

```
SELECT  TO_DATE('04.01.' || SUBSTR(iso, 1, 4)) + (TO_NUMBER(SUBSTR(iso, 5, 2))) * 7 - TO_CHAR(TO_DATE('04.01.' || SUBSTR(iso, 1, 4)), 'D')
FROM    (
    SELECT  '200101' AS iso
    FROM    dual
    ) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-03T12:25:47.860

如果这是在 Oracle 中，请查看带有各种选项 YYYYWW 的 TO_Date 函数。从对偶中选择 TO_Date ('200852' YYYYWW)；

[http://www.oradev.com/oracle_date_format.jsp](http://www.oradev.com/oracle_date_format.jsp) 一旦你得到一周的开始，你总是可以添加天数来获得周末日期。

# php - PHP - 从数组中输出特定内容

> ID：506829
> 
> 赞同：0
> 
> 时间：2009-02-03T11:58:40.457
> 
> 标签：php, arrays

如何在这个数组中一个接一个地输出[Comment][title]？

```
Array
(  
    [User] => Array
        (
            [id] => 121
            [name] => Gwoo the Kungwoo
            [created] => 2007-05-01 10:31:01
        )
    [Comment] => Array
        (
            [0] => Array
                (
                    [id] => 123
                    [user_id] => 121
                    [title] => On Gwoo the Kungwoo
                    [body] => The Kungwooness is not so Gwooish
                    [created] => 2006-05-01 10:31:01
                )
            [1] => Array
                (
                    [id] => 123
                    [user_id] => 121
                    [title] => More on Gwoo
                    [body] => But what of the ‘Nut?
                    [created] => 2006-05-01 10:41:01
                )
        )
) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T12:02:30.293

数组在哪里`$foo`，执行：

```
foreach ($foo['Comment'] as $comment) {
    echo $comment['title'];
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:05:31.537

那行不通，a ) 应该是 ]

```
foreach ($foo['Comment'] as $comment) {
  echo $comment['title'];
} 
```

在模板中尝试使用这个，设计师更喜欢这样：

```
foreach($foo['Comment'] as $comment):
      echo $comment['title'];
endforeach; 
```

# css - Facebook 喜欢状态 div

> ID：506835
> 
> 赞同：3
> 
> 时间：2009-02-03T12:01:00.187
> 
> 标签：css, dynamic-css

我正在寻找一个像 facebook 一样的页脚，但只使用 CSS 来设置它的样式，而不是 js。

正如您在此处看到的那样[http://dl.getdropbox.com/u/5910/Jing/2009-02-03_1256.png](http://dl.getdropbox.com/u/5910/Jing/2009-02-03_1256.png)即使我向下滚动它也始终保持在底部。[http://dl.getdropbox.com/u/5910/Jing/2009-02-03_1258.png](http://dl.getdropbox.com/u/5910/Jing/2009-02-03_1258.png)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T12:15:43.730

对于所有浏览器，除了 IE6，请执行以下操作：

```
div#footer {
    bottom: 0;
    width: 100%;
    height: 25px;
    position: fixed;
} 
```

我知道你提到不想使用 JavaScript，但是对于 IE6，我的经验是你可能不得不在 CSS 中使用某种 JavaScript 表达式才能让它像其他浏览器中的 CSS 一样流畅地工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:12:52.207

这可能会做到： [http ://ryanfait.com/sticky-footer/](http://ryanfait.com/sticky-footer/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T12:46:36.227

我过去用过这个：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Fixed CSS layer sample</title>
<style type="text/css">
 body
 {
  margin:0;
  padding:0 10px 0 10px;
  border:0;
  height:100%;
  overflow-y:auto;
 }
 #fixed
 {
  display:block;
  bottom:0px;
  left:0px;
  right:0px;
  position:fixed;
  border:1px solid #888;
  padding:0px;
  text-align:center;
  font-weight:bold;
  color:#000;
  background: #ccc;
  width: 100%;
  height: 100px;
 }
 * html #fixed
 {
  position:absolute;
 }
</style>
<!--[if lte IE 6]>
 <style type="text/css">
  /*<![CDATA[*/ 
   html {overflow-x:auto; overflow-y:hidden;}
  /*]]>*/
 </style>
<![endif]-->
</head>
<body>
<div id="page">
  <p><h3>Some latin text here to make the page scroll</h3></p>
  <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Proin pharetra pharetra tortor. Nunc in pede. Cras dapibus. Phasellus pede tortor, facilisis id, rutrum non, eleifend non, sem. Phasellus ut metus eu pede mollis sagittis. Cras ut justo ut metus rutrum auctor. Sed gravida consectetuer quam. Ut ligula. Suspendisse potenti. Ut et ante. Aenean mauris.</p>
  <p>Praesent lorem. Praesent suscipit convallis orci. Morbi nec felis vitae est vehicula ornare. Quisque nisi neque, pretium ac, eleifend nonummy, cursus sit amet, purus. Nullam venenatis suscipit arcu. Aenean mattis enim vitae nisl. Maecenas diam pede, vehicula in, vehicula in, auctor ac, urna. Phasellus vel nibh scelerisque ante varius feugiat. Phasellus vehicula malesuada lorem. Donec elementum, elit vel cursus rhoncus, purus est nonummy leo, fermentum lacinia ante libero quis libero. Vivamus tincidunt, nulla et dapibus interdum, risus magna pharetra purus, eu adipiscing mi nisl eu massa. Donec elit arcu, scelerisque eu, suscipit quis, tincidunt ut, enim. Suspendisse eget justo vitae lectus euismod facilisis. Donec at ipsum nec mi sollicitudin viverra. Fusce accumsan, ante non dictum viverra, libero pede condimentum dolor, non congue nisl enim sit amet nulla. Aenean mollis, metus sed molestie bibendum, nulla erat tincidunt velit, non feugiat lorem mauris id mi. Mauris eleifend. Vivamus viverra. Fusce dapibus libero feugiat lorem.</p>
  <p>Donec a nisl nec neque dictum varius. Aliquam consequat ipsum in dui placerat feugiat. Nam fringilla, libero ut consectetuer aliquet, lorem nisi pharetra est, eu sagittis lorem purus ac dolor. Donec aliquet mi nec augue. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas pretium, est sed feugiat bibendum, odio ligula convallis pede, id aliquet erat turpis sit amet ipsum. Phasellus pulvinar laoreet arcu. Curabitur nunc. Ut id purus vitae lacus convallis consectetuer. Duis in quam. Praesent pharetra. In quis est a massa pretium auctor. Nam metus mi, pulvinar ac, blandit nec, suscipit semper, quam. Integer eget felis id enim sodales dictum. Phasellus quis neque. Duis cursus imperdiet lorem. Etiam eget risus et erat dapibus feugiat. Aenean gravida justo vitae lectus. Nullam aliquet. Integer et augue porttitor urna varius porta.</p>
  <p>Suspendisse ultricies mauris eget velit dictum tincidunt. Maecenas id pede quis massa ornare congue. Fusce placerat odio non erat. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Quisque dignissim nunc ac ipsum. Integer ac libero et risus luctus ultrices. Phasellus urna. Nunc a lorem eu diam mollis rhoncus. Curabitur velit mi, mollis sit amet, vulputate ut, varius lobortis, turpis. Nulla scelerisque euismod lacus. Phasellus vehicula justo sed diam. Sed non nisi sit amet sem posuere fermentum. Donec faucibus pede. Donec pharetra tristique lacus.</p>
  <p>Maecenas luctus, nisl molestie gravida sagittis, quam augue elementum mi, vitae scelerisque lacus eros id mi. Pellentesque purus erat, hendrerit eu, suscipit eu, elementum quis, quam. Sed faucibus lorem lobortis ipsum. Nulla facilisi. In et leo et erat ullamcorper iaculis. Duis aliquet ipsum quis ligula. Sed condimentum, ipsum semper tincidunt tempus, nisi nulla congue ante, ut placerat ligula est eget risus. Nam nonummy molestie tortor. Nunc dapibus, metus id adipiscing mattis, felis enim pretium risus, ac elementum nibh massa at nulla. Duis eu dui nec lacus aliquet iaculis. Fusce et odio eu pede ultricies fermentum. Morbi pulvinar vulputate odio. Vestibulum dui ante, feugiat a, sodales at, tristique eu, dolor. Phasellus est. In in neque at lectus tristique pulvinar. Pellentesque sed nulla. Aliquam fermentum, diam eu auctor eleifend, velit elit scelerisque nulla, at dignissim odio justo id metus. Duis mattis rutrum mauris. Nullam quis nulla.</p>
  <p>In justo tellus, elementum ac, aliquet egestas, luctus ac, pede. Nulla facilisi. Sed et dui. Suspendisse pede. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Cras erat lectus, fermentum at, iaculis quis, blandit non, eros. Donec libero turpis, laoreet vitae, volutpat in, molestie ac, nulla. Donec tempus. Aenean eleifend cursus velit. Duis dolor ipsum, commodo a, commodo ac, faucibus vitae, quam. Integer dignissim. Curabitur non elit. Ut aliquet eros sit amet nisi.</p>
  <p>Sed consequat est vitae tellus. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Donec convallis, ligula sed rhoncus viverra, augue orci commodo massa, quis laoreet nulla lacus quis velit. Suspendisse a eros in massa sodales fermentum. Aliquam a augue. Sed nonummy eros eget magna dictum venenatis. Vestibulum molestie pede sit amet neque. Duis et ante ac eros mattis ultrices. Praesent placerat felis non nisl. Curabitur eleifend, purus non rhoncus lobortis, erat felis vestibulum est, at sagittis est orci ut orci. Aliquam pretium. Pellentesque eget neque. Nam sit amet tellus.</p>
  <p>Integer ultricies. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Proin nulla metus, auctor sit amet, semper ut, ullamcorper sit amet, eros. Maecenas aliquam metus ut metus. Suspendisse sed neque vel odio dapibus iaculis. Sed semper. Nulla et pede vel sapien laoreet interdum. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Vivamus neque dolor, ultrices quis, molestie commodo, tempus vel, massa. Cras nec diam eleifend libero adipiscing aliquet. Duis malesuada. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Vestibulum volutpat metus ac elit imperdiet tincidunt. Mauris pellentesque nunc eget lectus.</p>
  <p>Proin id nunc sit amet mi lobortis aliquet. Ut eget felis sit amet nunc viverra lacinia. Maecenas ut nulla sed metus bibendum mattis. In hac habitasse platea dictumst. Aliquam consectetuer nunc vel neque. Nullam quam nisi, semper eget, faucibus nec, vehicula quis, mi. Nunc nisi. Donec massa metus, pharetra vitae, vehicula non, eleifend at, libero. Ut ac est a nunc rutrum vestibulum. Nulla gravida. Sed suscipit luctus augue. Aliquam posuere felis. Nunc interdum, nisi a blandit scelerisque, mi nibh blandit justo, et malesuada nibh ligula id ipsum. Donec a ipsum sed nunc placerat interdum. Curabitur blandit. Suspendisse varius faucibus dolor. Cras a urna. Mauris leo. Nunc pretium, pede ut posuere cursus, sapien tellus blandit massa, id vestibulum metus est vitae tellus. Maecenas urna.</p>
  <p>Pellentesque tortor. Pellentesque faucibus dui vitae mauris. Pellentesque bibendum iaculis tortor. In sem purus, eleifend in, laoreet ut, tincidunt nec, magna. Mauris gravida, diam eu tincidunt fringilla, est nisi pharetra ante, non luctus justo odio a ipsum. Maecenas eu augue. Ut iaculis. Nunc arcu nunc, elementum sed, aliquam non, laoreet sed, nisl. Pellentesque felis. Suspendisse auctor tortor ut turpis. Vestibulum tincidunt laoreet neque. Phasellus odio enim, mollis vel, varius sed, imperdiet ut, tortor. Phasellus eleifend dolor ut metus. Proin est. Phasellus placerat pede rutrum libero. Suspendisse varius erat a urna convallis porta. Integer hendrerit odio id leo. Sed porta sapien suscipit sem.</p>
  <p>Quisque a lorem. Duis quis tortor. Suspendisse mattis porttitor augue. Aliquam facilisis porttitor quam. In vel metus ut quam commodo viverra. Pellentesque et mauris sit amet eros adipiscing commodo. Maecenas vitae pede vitae diam viverra vestibulum. Integer suscipit, quam sit amet hendrerit porta, velit tellus rhoncus pede, eget sollicitudin arcu felis quis leo. Sed auctor blandit ligula. Fusce accumsan viverra nibh. Aliquam erat volutpat. Quisque velit velit, sagittis et, congue at, auctor eu, quam. Sed dui ipsum, rhoncus eget, commodo at, vulputate a, metus. Donec eu mi. Sed laoreet faucibus ipsum. Donec cursus egestas turpis. Nulla facilisi. Nam et tellus.</p>
  <p>Praesent sagittis ligula eget lacus dictum blandit. Nam libero pede, faucibus non, vestibulum tempus, tincidunt quis, est. Vestibulum accumsan risus. Nulla facilisi. Praesent nisi turpis, pulvinar vitae, blandit vitae, hendrerit vel, ante. Morbi viverra purus dapibus quam. Donec ligula. Cras pretium metus. Nunc ac erat. Sed elit quam, cursus sit amet, egestas eget, cursus sit amet, orci. Praesent non purus non orci sodales interdum. Fusce lobortis risus eu est.</p>
  <p>Quisque arcu nisl, fringilla vel, vehicula in, bibendum nec, arcu. Nullam sit amet mi nec velit cursus rhoncus. In sed ante. Aenean nec augue. Curabitur et sem laoreet dolor blandit aliquam. Mauris sollicitudin orci nec leo. Proin magna. Suspendisse eleifend, diam vitae mattis suscipit, felis risus varius massa, ut ornare eros pede nec ligula. Proin commodo, justo et egestas ultrices, tellus elit aliquam ante, a rhoncus felis risus elementum arcu. Quisque placerat mattis arcu. Etiam auctor auctor nisl. Ut sed purus. Donec semper iaculis arcu. Maecenas nulla. Sed congue euismod nulla. Vestibulum ligula justo, venenatis at, rhoncus ac, iaculis id, nunc. Morbi sit amet augue eu ipsum fermentum facilisis.</p>
  <p>Nam magna. Fusce sed ante in mauris consectetuer mattis. Mauris imperdiet nibh tincidunt elit. Praesent eget lectus quis sem egestas molestie. Suspendisse potenti. Nunc mauris quam, pharetra id, gravida vitae, sodales id, lacus. Fusce lectus. Integer mollis justo. Duis vel mi et massa porttitor dictum. Donec scelerisque leo quis nulla. Sed ante ante, feugiat eget, vulputate a, dignissim quis, elit. Nam in turpis. Morbi lacus libero, varius at, dignissim id, auctor eget, urna. Cras in mauris. Vivamus felis purus, tempus at, volutpat eget, fermentum sagittis, lacus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla facilisi.</p>
  <p>Mauris mattis tincidunt erat. Maecenas aliquam mauris vel nulla. Morbi volutpat. Sed lorem mauris, interdum id, accumsan sit amet, consequat interdum, velit. Pellentesque ac est non sem posuere accumsan. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Ut vitae augue non lorem rhoncus malesuada. Phasellus viverra, leo non commodo ullamcorper, leo nibh accumsan mi, a tempus lectus lectus ac erat. Morbi ultrices mauris sit amet nunc. Donec porta nisl. Aenean tempor.</p>
</div>
<div id="fixed">[fixed footer]</div>
</body>
</html> 
```

可能需要一些修改，尤其是在 IE6 中工作。如果我没记错的话，我必须在页面内容下添加一些分页符以阻止页脚与内容重叠，但除此之外，我认为它工作得很好。

# php - 从 PHP 站点进行 Websphere 单点登录？

> ID：506847
> 
> 赞同：2
> 
> 时间：2009-02-03T12:06:31.160
> 
> 标签：php, active-directory, ldap, websphere, single-sign-on

我需要为 Webpshere 门户提供 SSO。身份验证过程需要由 PHP 站点处理（该站点本身应该通过 LDAP 针对 Active Directory 对用户进行身份验证——不过我想我已经涵盖了这一点）。有人告诉我我需要创建一个 LTPA cookie。我该怎么做呢？需要设置哪些信息？Websphere 是否能够读取此 cookie 并授予用户访问权限？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T12:22:32.797

Websphere 提供了对使用 LTPA 令牌进行身份验证传播的开箱即用支持（在 Web 应用程序中，这些通常存储在名为 LTPAToken 和 LTPAToken2 的 cookie 中）。通常，要使 Websphere 和您的 PHP 应用程序都能正常工作，必须共享相同的 LTPA 密钥（基于该密钥生成 LTPA 令牌）。在 websphere 管理中，需要进行一些配置来启用 LTPA 并同步密钥。

但是，我完全不知道 PHP 的功能；不知道是否有任何 LTPA PHP 库或对 LTPA 的内置 Apache/PHP 支持。谷歌搜索 IBM 的信息中心 (publib.boulder.ibm.com) 可能会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T14:57:26.687

IBM developerWorks上 PHP 页面上的这篇[ST Awareness文章可能会对您有所帮助。](http://www.ibm.com/developerworks/blogs/page/InsideLotus?entry=st_awareness_on_a_php)[在红皮书Building Sametime Enabled Applications](http://www.redbooks.ibm.com/redbooks.nsf/0/d9524ffb96c67e6185256d410065fafe?OpenDocument)的第 12 章中，还有一个为 ASP 页面添加感知的示例。如果您的环境中没有 LTPA，它详细说明了一种方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-08-01T03:25:16.753

WAS 可以使用自定义 TAI 创建 LTPA cookie，请阅读以下链接了解更多详细信息：

[开发自定义信任关联拦截器](https://www.ibm.com/support/knowledgecenter/en/SSAW57_8.5.5/com.ibm.websphere.nd.doc/ae/tsec_waci.html)

# c# - 面向对象的方法设计选项

> ID：506863
> 
> 赞同：1
> 
> 时间：2009-02-03T12:11:25.720
> 
> 标签：c#, oop

我想开发一个 process() 方法。该方法以数据类的形式获取一些数据，并对其进行处理。数据类相似，但略有不同。

例如，我们有以下数据类 processDataObject_A、processDataObject_B 和 processDataObject_C。

重载方法是否更好：

```
void process(processDataObject_A data)
{
//Process processDataObject_A here
}

void process(processDataObject_B data)
{
//Process processDataObject_B here
}

void process(processDataObject_C data)
{
//Process processDataObject_C here
} 
```

或者让具体数据类扩展一些抽象数据类，并将其传递给 process 方法，然后让方法检查类型并采取相应措施：

```
void process(AbstractProcessDataObject data)
{
//Check for type here and do something  
} 
```

或者有没有更好的方法来解决它？如果这是一种 Web 方法，方法会改变吗？

提前致谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T12:18:57.407

我会去：

```
process (data) {
   data.doProcessing();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T12:41:28.560

您的方法返回 void 的事实使我相信您可能已经转过身来。我认为最好将其视为让您的每个类都实现一个接口，该接口`IProcessable`定义了一个`Process`方法。然后每个类都知道如何操作它自己的数据。我认为，与拥有一个在每个对象内部操作数据的类相比，这更少耦合。假设所有这些类都派生自同一个基类，您可以将共享的处理算法部分放在基类中。

这与您可能有多个算法对相同数据进行操作的情况略有不同。如果您需要这种功能，那么您可能仍希望实现该接口，但让该`Process`方法采用策略类型参数并使用工厂根据其类型创建适当的策略。通过这种方式，您最终会为每个受支持的算法和数据类对拥有一个策略类，但您可以保持代码解耦。如果算法相当复杂，我可能只会这样做，以便分离代码使其更具可读性。如果只是几行不同，在策略类型上使用 switch 语句可能就足够了。

关于网络方法，我想每个班级都有不同的签名。如果方法采用各个类型的具体类，那么正确地通过网络获取数据会容易得多，因此它知道如何正确序列化/反序列化它。当然，在后端，Web 方法可以使用上述方法。

```
public interface IProcessable
{
    public void Process() {....}
}

public abstract class ProcessableBase : IProcessable
{
    public virtual void Process()
    {
        ... standard processing code...
    }
}

public class FooProcessable : ProcessableBase
{
    public override void Process()
    {
        base.Process();
        ... specific processing code
    }
}

...

IProcessable foo = new FooProcessable();
foo.Process(); 
```

实现基于策略的机制稍微复杂一些。

Web 界面，使用数据访问对象

```
[WebService]
public class ProcessingWebService
{
    public void ProcessFoo( FooDataObject foo )
    {
        // you'd need a constructor to convert the DAO
        // to a Processable object.
        IProcessable fooProc = new FooProcessable( foo );
        fooProc.Process();
    }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T15:19:27.587

我赞同 Marko 的设计。想象一下，您需要添加另一种类型的数据结构和流程逻辑，例如 processDataObject_D。对于您提出的第一个解决方案（方法重载），您将不得不通过添加另一个方法来修改类。对于您提出的第二个解决方案，您将不得不在类型检查和执行语句中添加另一个条件。两者都需要您修改现有代码。Marko 的解决方案是通过利用**多态性**来避免修改现有代码。您不必编写 if-else 类型检查代码。它允许您在*不修改现有代码的情况下*添加新的数据结构和流程逻辑，只要新类继承相同的超类即可。

学习设计模式的**策略模式**将使您对所面临的问题有充分的理论理解。O'Reilly 的《Head First Design Pattern》一书是我所知道的最好的介绍。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T12:14:13.903

多态性怎么样`AbstractProcessDataObject`- 即虚拟方法？如果这不合适（关注点分离等），那么重载似乎更可取。

重新网络方法；非常不同：多态性和重载都没有得到很好的支持（至少在基本配置文件上没有）。检测选项“在此处检查类型并执行某些操作”可能是最佳途径。或者对每种类型有不同的命名方法。

* * *

每个请求：

```
abstract class SomeBase { // think: AbstractProcessDataObject
    public abstract void Process();
}
class Foo : SomeBase {
    public override void Process() { /* do A */ }
}
class Bar : SomeBase {
    public override void Process() { /* do B */ }
}
SomeBase obj = new Foo();
obj.Process(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T15:45:30.827

我相信[策略模式](http://www.dofactory.com/Patterns/PatternStrategy.aspx#_self1)会对你有所帮助。

# wpf - WPF：使 ControlTemplate 中的控件无效

> ID：506872
> 
> 赞同：0
> 
> 时间：2009-02-03T12:13:56.417
> 
> 标签：wpf, decorator, controltemplate

我创建了一个在 OnRender 方法中绘制一些自定义图形的装饰器。图形取决于包含装饰器的对象的位置。我通过样式通过模板属性设置装饰器。问题是装饰器的 OnRender 方法在应用模板时只被调用一次。因此，当我更改对象的位置并在该对象上调用 InvalidateVisual() 时，不会重新渲染装饰器。

我设法通过将对象的模板设置为 null 然后将其重置回相同的模板来解决此问题，如下所示：

```
if (myObject.Template != null)
{
  ControlTemplate tmpTemplate = myObject.Template;
  myObject.Template = null;
  myObject.Template = tmpTemplate;
} 
```

这可以解决问题，但我确信这不是应该的方式。我错过了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-30T15:01:46.077

我想您可能会使错误的视觉效果无效。尝试在对象类中声明全局变量以包含装饰器实例，覆盖装饰元素的 OnApplyTemplate 方法，并通过 FindName 方法调用将全局变量与模板中的装饰器实例连接。类似于： myDecorator = Template.FindName("PART_decorator", this) as MyDecoratorType （请注意，在这种情况下，xaml 模板中的装饰器应具有定义为“PART_decorator”的 x:Name）。

之后，您可以在代码中的适当位置针对装饰器实例调用 InvalidateVisual()。

# tfs - 是否有 Visual Studio Team System 和 Team Foundation Server 的替代品？

> ID：506878
> 
> 赞同：4
> 
> 时间：2009-02-03T12:15:44.383
> 
> 标签：tfs, version-control, alt.net

Visual Studio Team System 和 Team Foundation Server 提供了很多好东西，例如源代码控制、单元测试和自动构建。

我想知道以下问题：对于拥有所有这些的 .NET 开发人员来说，有哪些替代方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T12:23:09.957

我们正在使用

*   颠覆
*   TortoiseSVN
*   CruiseControl.Net（带有 NAnt）
*   Confluence 和 Jira ( [http://www.atlassian.com/](http://www.atlassian.com/) )
*   单位
*   微软企业库

了解此产品套件与 TS/TFS 的比较会很有趣

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T14:37:28.983

以下问题也可能对您的研究有用：

*   [您使用什么来替代 Team System？](https://stackoverflow.com/questions/11857/what-do-you-use-as-a-good-alternative-to-team-system)
*   [有没有类似小版本的 TFS 的东西？](https://stackoverflow.com/questions/268018/is-there-anything-like-a-small-version-of-tfs)

希望有帮助。

马丁。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T12:27:39.650

我认为没有任何一种产品可以提供相同的功能集，但*一些*替代品是：

源代码控制

*   [颠覆](http://subversion.tigris.org/)

单元测试

*   [MBUnit](http://www.mbunit.com/)
*   [单元](http://www.nunit.org/index.php)

自动化构建

*   [南安特](http://nant.sourceforge.net/)
*   [团队城市](http://www.jetbrains.com/teamcity/)

还可以查看[Gallio](http://www.gallio.org/)，它的目的是为多种工具提供一个通用平台，以插入和使用来自

# networking - 关于 IP 组播的问题？

> ID：506879
> 
> 赞同：2
> 
> 时间：2009-02-03T12:15:57.660
> 
> 标签：networking, udp

嗨，我正在创建流媒体应用程序。因为我正在使用 IP 多播。

告诉我如何在将客户端添加到组之前对其进行验证。

我和 IGMP 有什么关系吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T12:22:22.577

你不会用你的应用程序来做这件事。

`IGMP`是一个互联网层协议，它甚至可能无法到达您的应用程序。

每当一个单元想要接收到某个地址的多播时，它都会发送一个`IGMP`加入组的请求。路由器收到请求并记住该用户希望属于该组。

每当路由器接收到发往该地址的多播包时，它会将其路由到所有组成员，可能会考虑一些访问控制限制。

所有组操作均由路由器执行。您只需将`UDP`数据包发送到多播地址（即`224/4`），然后路由器决定是否将其路由到订阅者。

如果您想限制多播数据包的目的地，您可以在路由器上进行。

不过，您应该明白，上面的**“路由”**一词意味着路由器将数据包发送到适当的接口，其中标头中的多播目标地址`Ethernet`和标头中的多播目标地址`IP`。连接到接口的以太网交换机（如果有）将在*所有*活动端口上分发数据包。由于它对 Internet 路由一无所知，它只会看到`Ethernet`标头中设置的广播/多播位并采取相应的行动。

但是，有些`link layer`设备（以太网交换机）会窥探`network layer`标头并将多播限制到订阅的单元。那就是所谓的`IGMP snooping`。其中一些还可以控制访问。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T11:47:50.790

好的，控制谁可以加入多播组是合法的。我可以看到完成的唯一方法是过滤路由器接口上的入站 IGMP 数据包。如果“允许的订阅者”列表足够静态，这将起作用，但如果有很多变化，它很快就会变得站不住脚。

如果（且仅当）有管理控制一直到“客户放置的”路由器，我怀疑可以在那里做一些事情，以限制设备可见的组，但这在很大程度上取决于环境（在“来自单个提供商的宽带和多播视频”场景，使用提供商管理的 DSL 路由器的合同要求是可能的）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T12:51:24.000

除了 Quassnoi 关于多播如何工作的评论之外，我还想知道……为什么要限制多播成员资格和/或在将接收者添加到组之前对其进行验证？

# .net - 在 ASP.NET Web 应用程序 (.Net 2.0) 中模拟构建提供程序

> ID：506880
> 
> 赞同：2
> 
> 时间：2009-02-03T12:17:23.163
> 
> 标签：.net, asp.net

我正在使用 .Net 2.0 ASP.NET Web 应用程序。

我正在以编程方式创建一个程序集，其中包含在 Web 应用程序的 xml 文件中指定的命名空间和类。我创建了一个单独的库来执行此操作，我得到了程序集，这很好。

但我不想将此作为预编译组件引用。

我想动态创建它，所以当我运行 Web 应用程序的构建时，程序集被构建，对程序集的引用添加，然后 Web 应用程序代码可以进一步使用它。另外，我可以拥有智能感知。

现在这正是构建提供程序的场景，但问题是构建提供程序不能与这种类型的应用程序一起使用。

我设法像这样运行程序集生成工具：

```
<Target Name="BeforeBuild">
  <Exec Command="CreateAssembly.exe config.xml"/>
</Target> 
```

但是动态引用生成的程序集没有运气..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T09:30:25.003

您要查找的类是 System.Reflection 命名空间中的 Assembly 类。

## 例子

```
Assembly.Load(AssemblyPath) 
```

或者

```
Assembly.LoadFrom(AssemblyPath) 
```

这些方法可用于将非引用程序集加载到您的应用程序域中。

有各种条件和限制，所以我会阅读它们。

## 链接

[组装](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.load.aspx).加载 (MSDN)

[Assembly.LoadFrom](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.loadfrom.aspx) (MSDN)

[有用的 MS 知识库文章](http://support.microsoft.com/kb/837908)

玩得开心！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T13:03:32.870

我最近一直在玩弄使用 Rake 来自动化构建，所以你可能想尝试一下。以下是一些您可能会觉得有用的链接：

*   [http://www.tobinharris.com/2008/11/4/getting-started-with-rake-on-net](http://www.tobinharris.com/2008/11/4/getting-started-with-rake-on-net)
*   [http://www.tobinharris.com/2008/12/13/automate-boring-tasks-with-rake-in-dotnet](http://www.tobinharris.com/2008/12/13/automate-boring-tasks-with-rake-in-dotnet)

# java - 使用 Axis 2 的 Web 服务：复杂类型还是简单类型参数？

> ID：506881
> 
> 赞同：2
> 
> 时间：2009-02-03T12:17:24.350
> 
> 标签：java, service, axis2, axis2c

问题是以下专业：

[OO 样式参数与类型参数](https://stackoverflow.com/questions/403058/oo-style-parameters-vs-type-parameters)

如果要定义 Web 服务操作怎么办？让参数像这样的复杂类型传递

```
public String insertPerson(Person person); 
```

看起来很酷，因为您可以在不更改接口定义的情况下更改 Person 的定义。但是，如果另一个用 C/C++ 实现的 WS 客户端（例如使用 gsoap 或axis2c）使用这个定义会怎样。访问在 Java 中使用 Axis2 实现的 Web 服务会不会有问题？使用简单的参数化方法可能更安全：

```
public String insertPerson(long id, String name, String personalId); 
```

我不太确定。你怎么看？

弗雷德

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T12:47:55.740

我非常喜欢第一种方法。

但请注意，更改 Person 类型*确实会*更改界面。Web 服务的接口（调用约定，...）由 WSDL 和它包含（或引用）的 XML Schema 定义。如果您更改其中任何一个，您将更改 Web 服务的界面。

如果您纯粹从 Java 的角度来看它，那么您应该将其视为 Person 类（以及它引用的任何其他类！）是 Web 服务接口的一部分！

好处是您可以对 Person 类（或者更准确地说：由 Person 类表示的复杂类型/元素）进行兼容更改，而不会破坏旧客户端。添加可选元素或属性就是一个很好的例子。新客户端可以使用它，而旧客户端不会知道它，但不会中断（因为服务器不会强制它的存在）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T12:29:43.903

一个好的 Web Services 框架将能够理解复杂的类型。可能需要进行一些调整。Axis2 可以应付。

我通常更喜欢参数化方法，尤其是在参数数量很少（不超过 4 个）的情况下。它的优点是 WSDL 文件和生成的 SOAP 消息更易于编写和阅读。这对于测试和调试非常有帮助。

# jquery - jQuery中的列表选择

> ID：506884
> 
> 赞同：0
> 
> 时间：2009-02-03T12:18:11.603
> 
> 标签：jquery, dom

我正在使用 jQuery，我的列表有以下内容。

```
<div id="wrapper">
    <ul id="testnav">
        <li class="test1"><a href="/link">Heading</a>
            <ul>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
            </ul>
        </li>
        <li class="test2"><a href="/link">Heading</a>
            <ul>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
            </ul>
        </li>
        <li class="test3"><a href="/link">Heading</a>
            <ul>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
                <li><a href="/link">Sub Heading</a></li>
            </ul>
        </li>
    </ul>
</div> 
```

当我单击标题或子标题时，我需要相应的文本。我使用了以下内容，但它不起作用。

```
$("li").bind("click", function(){
     alert( $(this).text());
}); 
```

我应该做出什么改变？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T12:19:50.227

```
 $("li a").bind("click", function(){
     alert( $(this).text());
 }); 
```

li 的文本实际上是一个 A 链接文本。所以你需要得到它。那只会对孩子们有用。

我不确定 LI 是否有点击事件，但如果您使用 html() 函数而不是 text()，它会起作用：

```
 $("li").bind("click", function(){
     alert( $(this).html() );
 }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T12:26:33.397

您非常接近 - 您需要将事件绑定到锚标记并确保将事件绑定包装在`$(document).ready`如下函数中：

```
$(document).ready(function() {
    $("li a").bind("click", function() { alert( $(this).text()); })
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T12:35:05.033

尽管其他答案都不正确，但我会这样做：

```
$('#testnav a').click(function(ev){
    alert($(this).text())

    //if you need to stop the browser going to the link
    // (eg you're doing something else AJAXey):
    ev.preventDefault();
    ev.stopPropagation();
}); 
```

如果您尝试`li`直接附加到 s 的原因是您希望整个内容“可点击”，请使用 CSS 调整链接大小：

```
#testnav a { display:block } 
```

根据您的操作方式，您可能需要尝试制作链接、li 和/或 ul 浮动，并设置宽度。

# c++ - 将 STL 容器与迭代器一起使用的常见误用是什么？

> ID：506898
> 
> 赞同：12
> 
> 时间：2009-02-03T12:22:59.737
> 
> 标签：c++, stl, iterator

[将STL](http://en.wikipedia.org/wiki/Standard_Template_Library)容器与迭代器一起使用的常见误用是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-03T12:26:29.153

如果您通过插入或删除容器成员来更改容器，请忘记迭代器通常会失效。

对于使用 STL 的许多重要提示，我**强烈**推荐 Scott Meyers 的书“Effective STL”（[经过消毒的亚马逊链接](https://rads.stackoverflow.com/amzn/click/com/0201749629)）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T12:47:25.430

结束范围检查应该使用 != 而不是 < 因为不能保证指针的顺序。

例子：

```
for(it = list.begin(); it != list.end(); ++it)
{
     // do stuff
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-03T12:36:47.930

可以在预增量时进行后增量。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-03T13:52:32.130

其他几个：

*   将反向迭代器转换为基迭代器，而无需记住迭代器现在将是它所指向的元素之外的一个元素。

*   尝试使用需要随机访问迭代器和集合和映射等迭代器的算法。

*   使用非常量迭代器编辑映射条目的键（这恰好构建在 VS.Net 上，但不会使用 GCC）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-03T13:17:02.483

在不阅读 Scott Meyers 的“Effective STL”书的情况下使用它们。：） 真的。这使得大多数愚蠢的错误消失了。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-03T14:19:10.377

**之后适当的继续`erase()`。**

假设：

```
Container::iterator i = cont.begin(), iEnd = cont.end(); 
```

例如`std::map`，这不是一个好主意：

```
for (; i != iEnd; ++i) {
    if (i->second.eraseCondition()) {
        cont.erase(i);
    }
} 
```

这会起作用：

```
for (; i != iEnd; ) {
    Container::iterator temp = i;
    ++temp;
    if (i->second.eraseCondition()) {
        cont.erase(i);
    }
    i = temp;
} 
```

这也是：

```
for (; i != iEnd; ) {
    if (i->second.eraseCondition()) {
        cont.erase(i++);
    }
    else {
        ++i;
    }
} 
```

真的太多次了，我不得不在一些生产代码中应用这些修复:(

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-03T14:36:20.093

在容器内使用 auto_ptr，例如

```
list<auto_ptr<int> > foo; 
```

幸运的是，现在编写了很多 auto_ptr 实现来使这成为不可能。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-03T14:54:06.797

这不仅是 STL 容器的问题——在迭代容器时修改容器几乎总是会导致问题。

这是游戏中非常常见的错误来源——大多数游戏循环包括迭代每个游戏对象做某事。如果这个东西从游戏对象容器中添加或删除元素，几乎肯定有错误。

解决方案 - 有两个容器 - objectsToDelete 和 objectsToAdd - 在游戏代码中将对象添加到该容器，并仅在您迭代后更新游戏对象容器。

可以设置 objetsToAdd 以确保我们不会多次删除任何内容。

如果您可以构造 Object 而不将其添加到游戏对象容器中，则 objectsToDelete 可以是 Queue，或者如果您的代码假定 Object 实例总是在创建后直接添加到游戏对象容器中（例如在构造函数中），它可以是其他一些类（ObjectCreateCommand？） ）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-03T22:06:47.233

```
list<int> l1, l2;
// ...

for_each(l1.begin(), l2.end(), do_it()); 
```

# .net - 标签页在 C# 中添加一个新属性（winform）

> ID：506903
> 
> 赞同：2
> 
> 时间：2009-02-03T12:26:06.080
> 
> 标签：.net, winforms

我需要知道如何将新属性添加到标签页。

你能帮忙吗？？

提前致谢

玛丽亚

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T12:34:37.793

从 TabPage 派生一个类并将其称为 MariaTabPage 或其他名称。在那里添加额外的属性。之后用 MariaTabPages 填充您的 TabControl。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:35:53.627

好吧，您可以使用的一个小技巧是将属性放入您自己的自定义对象或结构中，然后将该对象分配给 TabPage 的 .Tag 属性，该属性接受一个对象。

# vxworks - 如何在 VxWorks 项目中获取变量的地址

> ID：506906
> 
> 赞同：0
> 
> 时间：2009-02-03T12:26:29.917
> 
> 标签：vxworks

VxWorks 如何获取局部变量的地址以查看内存内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T18:34:44.510

这取决于上下文。
在代码中，就像 mouviciel 提到的那样，只需使用运算符 (&) 的地址：

> printf("var addr = %x", &var);

* * *

如果您在 vxworks 主机或目标 shell 中：

您只需输入变量名即可查看全局变量和静态变量。

> -> var
> var = 0x103b4188：值 = 10 = 0xa
> ->

这为您提供了变量的地址和内容。
但是，这不适用于本地（自动）变量，因为它位于堆栈上。shell 没有一种简洁的方式来表达“给我看任务 X 的堆栈变量”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T12:35:44.313

这就像任何其他 C 环境一样：（本地或全局）的地址`var`是`&var`.

# c# - 在 C# 编译时检查字符串格式

> ID：506908
> 
> 赞同：6
> 
> 时间：2009-02-03T12:27:30.773
> 
> 标签：c#, .net, string, compiler-construction

在我的代码中，有几个字符串用作访问资源的键。这些密钥具有特定的格式，例如

```
string key = "ABC123"; 
```

目前，所有这些键都存储为字符串，但我想让事情变得更健壮和类型安全。理想情况下，我想在编译时检查字符串的格式是否正确。

下一阶段是创建一个从字符串初始化的 ResourceKey 类。然后我可以在运行时检查字符串的格式，例如

```
ResourceKey key = "ABC123"; 
```

其中 ResourceKey 定义为：

```
using System.Diagnostics;
using System.Text.RegularExpressions;

class ResourceKey
{
    public string Key { get; set; }

    public static implicit operator ResourceKey (string s)
    {
        Debug.Assert(Regex.IsMatch(s, @"^[A-Z]{3}[0-9]{3}$"));
        return new ResourceKey () { Key = s };
    }
} 
```

我真正想做的是有一种编译时断言，这样如果有人试图使用无效的密钥，程序就无法构建。例如

```
ResourceKey k1 = "ABC123"; // compiles
ResourceKey k2 = "DEF456"; // compiles
ResourceKey k3 = "hello world"; // error at compile time 
```

有什么办法可以做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T12:32:53.430

您可以通过单元测试检查这些值。我的一位同事不得不在一个项目中做类似的事情，我们需要确保某个命名空间中的所有类都应用了某些属性。

使用您的构建运行单元测试（您这样做对吗？:) 或作为集成构建的一部分。这将使您的源代码更清洁，并且您不必引入执行断言的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:52:56.883

我相信我会添加一个 Settings 类并将它们存储在那里而不是创建一个新类型。Settings 类可以由应用程序配置文件支持，这将使它们更容易在需要时通过配置文件更改进行更改。但是，如果您没有在配置文件中指定它们，它将使用您设置为默认值的值。

我也会走单元测试路线。您需要在 Assembly.cs 文件中使用 InternalsVisibleTo 属性，因为如果您不这样做，我认为设置不能在项目之外使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T12:33:22.790

您真的希望将这些密钥硬编码到您的应用程序中吗？将它们放在配置文件中不是更好吗？然后，如果编译后有任何问题，那只是运行时配置问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T17:05:19.993

AdamRalph 有一点，但反点也有效，如果你在编译时做对了，你永远不会有运行时配置问题（假设正确的值不能改变）

除此之外，C# 的编译时能力绝对是*Junk*。它们几乎没有什么可以在编译时完成的。我所知道的最好的可用是模板`where`子句。如果我不得不猜测，我会说这是 Anders Hejlsberg 有意的设计选择，因为它似乎与其他语言相匹配

Andrew Hare 关于单元测试 + 反射的观点与我预期的一样好。我的一位同事使用它来测试可以在特定情况下使用的任何类是否正确实现了某些协议。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T20:30:37.460

如果键是根据与 C# 标识符相同的规则命名的，或者可能更具限制性，并且已知且有限，则可以使用枚举：

```
public enum ResourceKeys
{
    ABC123,
    DEF456
} 
```

# java - Java - 分布式编程，RMI？

> ID：506911
> 
> 赞同：2
> 
> 时间：2009-02-03T12:28:11.193
> 
> 标签：java, distributed, rmi, simulation, traffic-simulation

我在这里遇到了一个问题。我的目标是构建一个框架以允许集成不同的交通模拟模型。这种集成基于在模拟之间共享链路连接性、链路成本和车辆。

为了进行分布式模拟，我计划有一个“协调器”（星形拓扑）。所有参与的模拟只需注册它，并只与协调员交谈。然后协调器在每次模拟之间协调各种任务的执行。

分布问题的一个简单示例是当一个模拟“负责”某些对象（如道路）时。另一个是“负责”其他道路。然而，这些道路是相互关联的（因此，我们需要这些模拟之间的同步，并且需要能够远程交换数据/调用方法）。

我看过 RMI 并认为它可能适合这项任务。（抽象出必须创建一个有线信号规则）。

这是理智的吗？这里的问题是，模拟参与者需要将他们的*一些*数据存储集中在“协调器”中，以确保模拟之间的显式同步。此外，一些模拟可能需要来自其他模拟的组件或方法。（因此使用 RMI 的想法）。

我的基本方法是让“协调员”运行一个巨大的 RMI 注册表。并且每次模拟都只是在注册表中查找所有内容，确保在每个步骤中使用正确的对象。

任何人有任何沿着这条路前进的提示吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-04T21:54:12.767

您可能还想查看[Hazelcast](http://www.hazelcast.com)。Hazelcast 是队列、主题、映射、集合、列表、锁定和执行器服务的开源事务性、分布式/分区实现。使用起来超级容易；只需将 hazelcast.jar 添加到您的类路径中并开始编码。几乎不需要任何配置。

如果您对以分布式方式执行 Runnable、Callable 任务感兴趣，请查看[http://code.google.com/docreader/#p=hazelcast上的分布式执行器服务文档](http://code.google.com/docreader/#p=hazelcast)

[Hazelcast](http://www.hazelcast.com)是在 Apache 许可下发布的，并且还提供企业级支持。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T12:53:24.857

这是理智的吗？恕我直言，没有。我会告诉你为什么。但首先我要添加免责声明，即这是一个复杂的话题，因此任何答案都必须被视为几乎没有触及表面。

首先，我不会重复自己，而是向您指出我不久前写[的 Java 网格/集群技术的总结。](https://stackoverflow.com/questions/383920/what-is-the-best-library-for-java-to-grid-cluster-enable-your-application/383929#383929)它是一个几乎完整的列表。

星型拓扑对于“幼稚”（我并不是说以不好的方式）实现是“自然的”，因为点对点很简单，集中关键控制器逻辑也很简单。然而，它不是容错的。它引入了可扩展性问题和单一瓶颈。它引入了通信效率低下（即点通过中心通过两步过程进行通信）。

你真正想要的可能是一个集群（而不是数据/计算网格）解决方案，我建议你看看[Terracotta](http://www.terracotta.org/)。理想情况下，您会查看[Oracle Coherence](http://www.oracle.com/technology/products/coherence/index.html)，但它无疑很昂贵（与免费相比）。这是一个很棒的产品。

这两个产品可以有多种使用方式，但两者的核心都是将缓存视为分布式地图。你把东西放进去，把东西拿出来，然后触发改变缓存的代码。在这方面的连贯性（我更熟悉）非常好。这些是更多基于“服务器”的产品，但对于真正的集群而言。

如果您正在查看一个更加分布式的模型，那么也许您应该更多地查看基于 SOA 的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-05T12:22:52.260

看看[http://www.terracotta.org/](http://www.terracotta.org/)

它是一个分布式 Java VM，因此它的优点是集群应用程序看起来与标准 Java 应用程序没有什么不同。

我已经在应用程序中使用过它，到目前为止速度非常令人印象深刻。

保罗

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-05T12:04:18.633

您是否考虑过使用消息队列方法？您可以使用 JMS 在一组服务器/节点之间通信/协调任务和结果。您甚至可以使用 Amazon 的 SQS（简单队列服务：aws.amazon.com/sqs）并让您的服务器在 EC2 上运行，以允许您根据需要进行扩展和缩减。

只是我的2美分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T12:36:07.993

看看JINI，它可能对你有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T13:01:45.337

嗯，Jini，或者更具体地说，Javaspaces 是一个很好的起点，可以从一个简单的方法开始解决这个问题。Javaspaces 允许您实现一个主从模型，您的主（在您的情况下为协调器）将任务写入 Javaspace，并且工作人员查询并处理这些任务，将结果写回给主。由于您的问题不是令人尴尬的并行，并且您的工作人员需要同步/交换数据，这将为您的解决方案增加一些复杂性。

与使用纯 RMI（Jini 框架在内部将其用作默认的“有线协议”）相比，使用 Javaspaces 将为您的实现添加更多的抽象。

看看[这篇](http://java.sun.com/developer/technicalArticles/tools/JavaSpaces/)来自 sun 的文章以获得介绍。

Jan Newmarch 的[Jini 教程](http://jan.newmarch.name/java/jini/tutorial/)是开始学习 Jini 的好地方

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T15:21:01.500

[GridGain](http://www.gridgain.com)是一个不错的选择。他们有一个 map/reduce 实现，带有“对拆分和聚合的直接 API 支持”和“分布式任务会话”。您可以浏览[他们的示例](http://www.gridgainsystems.com/wiki/display/GG15UG/Examples+Gallery)，看看其中一些是否符合您的需求。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-03T21:59:26.057

正如我所看到的所有关注网格和云计算的其他答案的补充一样，您应该注意到仿真模型具有一个独特的特征：仿真时间。

当并行和同步运行分布式仿真模型时，我看到两个选项：

*   当每个仿真模型都有自己的仿真时钟和事件列表时，这些应该通过网络同步。
*   或者，可以有一个模拟时钟和事件列表，它将为所有分布式（子）模型“计时”。

第一个选项已针对高级架构 (HLA) 进行了广泛研究，例如[http://en.wikipedia.org/wiki/IEEE_1516](http://en.wikipedia.org/wiki/IEEE_1516)作为入门。

然而，第二个选项对我来说似乎更简单，开销也更少。

# sql-server-2005 - 打开 CrystalReport 查看器时出错

> ID：506915
> 
> 赞同：0
> 
> 时间：2009-02-03T12:31:39.453
> 
> 标签：sql-server-2005, crystal-reports, sql-server-2005-express

我有这个问题，我试图调试很多时间。

设置是这样的：

一世。该应用程序是使用VS2005，.net 2.0开发的Windows应用程序。

ii. 我使用 Cyrstal 报表组件 Crystal Report Viewer 并以相同的形式动态显示各种报表。

iii. db 是 SQLSERVER Express 2005，位于另一台机器上。

当我在数据库服务器上运行应用程序时，我可以查看报告。但是，当我在连接到上述 dbServer 的另一台机器上运行应用程序时，我收到错误消息。（我的开发设置中没有出现此错误）

来源：CrystakReprotViewer.CS:SendDBLogonForReport() 详细信息：登录失败。详细信息：ADO 错误代码：0x 来源：Microsoft OLE DB Provider for SQL Server 描述：[DBNETLIB][ConnectionOpen (Invalid Instance()).]无效连接。SQL 状态：08001 本机错误：文件 C:\DOCUME~1\admin\LOCALS~1\Temp\ActionPoints {52820D22-199C-4D46-A76B-70A55D9F54D5}.rpt 中的错误：无法连接：登录参数不正确。在 CrystalDecisions.ReportAppServer.Controllers.DatabaseControllerClass.SetTableLocation(ISCRTable CurTable, ISCRTable NewTable) 在 CrystalDecisions.CrystalReports.Engine.Table.set_Location(String value) 在 Trivalve.UI.Client.Reports.CrystalViewer.CrystalReportViewer.SetDBLogonForReport(ConnectionInfo connectionInfo, ReportDocument报告文档）在 D 中：

[有关详细信息，请参阅http://go.microsoft.com/fwlink/events.asp](http://go.microsoft.com/fwlink/events.asp)上的帮助和支持中心。

谢谢，拉姆吉

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-10-13T13:52:08.253

利用`datasource=servername or ip address\instance name if available,port number`

默认端口号是`1433`或`1434`

我的问题就这样解决了。发帖供他人使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T13:37:37.230

如果这是 SQL Server Express 的标准安装，请记住默认安装的唯一连接方法是共享内存，并且仅在服务器上可用——您需要启用其他连接协议，例如命名管道或 TCP/知识产权。要打开网络，请使用 SQL Server 配置管理器启用相关协议并启动 SQL Browser。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T13:52:07.827

它准确地告诉你出了什么问题。

> 详细信息：登录失败。

太好了，我们无法登录。

> （无效的实例（））。]无效的连接。

好的。我敢打赌，我们将“localhost”作为连接字符串中实例名称的一部分。由于我不再在“本地主机”上，这显然行不通。我们先在那里试试。那么也许它是我用来查询我的数据库的凭据。通常我所做的是创建一个只能在我的数据库上进行选择并将其用于 CR 的 RO 用户。如果这些都没有让我接近，让我们尝试确保[为 SQLEXPRESS 启用远程连接](http://support.microsoft.com/kb/914277)

> 无法连接：登录参数不正确。

好的，这绝对是连接问题。

# wpf - 如何格式化 WPF Datagrid 上的标题？

> ID：506921
> 
> 赞同：5
> 
> 时间：2009-02-03T12:34:13.817
> 
> 标签：wpf, datagrid

我正在使用 Codeplex 的 WPF Datagrid。

我可以在 dg:DataGrid 元素中设置行和以下属性的样式。

但是我如何设置标题的样式？我在网上找到了 100 个定义样式并在 Datagrid 元素中使用例如 x:Key="DataGridColumnHeaderStyle" 的示例，但它们似乎都不适合我。

我怎样才能在这个 DataGrid 上将 Datagrid Header 背景更改为橙色？

```
<dg:DataGrid AlternatingRowBackground="#ddd" 
    RowBackground="#eee" 
    Name="theGrid1" 
    VerticalAlignment="Stretch" 
    AutoGenerateColumns="False" 
    BorderBrush="#ddd">
...
</dg:DataGrid> 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-11-09T21:19:30.307

DataGrid 上还有一个属性允许设置标题样式：

```
<DataGrid.ColumnHeaderStyle>
     <Style TargetType="{x:Type DataGridColumnHeader}">
          <Setter Property="FontWeight"
                  Value="Bold" />
     </Style>
</DataGrid.ColumnHeaderStyle> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:56:05.503

在这种情况下，样式位于名为 generic.xaml 的文件中，它应该位于项目的主题文件夹中。

找到它并打开它。在里面你会发现控制列标题背景的这一行

```
 <dg:DataGridHeaderBorder SortDirection="{TemplateBinding SortDirection}"
                                     IsHovered="{TemplateBinding IsMouseOver}"
                                     IsPressed="{TemplateBinding IsPressed}"
                                     IsClickable="{TemplateBinding CanUserSort}"
                                     Background="{TemplateBinding Background}"
                                     BorderBrush="{TemplateBinding BorderBrush}"
                                     BorderThickness="{TemplateBinding BorderThickness}"
                                     Padding ="{TemplateBinding Padding}"
                                     SeparatorVisibility="{TemplateBinding SeparatorVisibility}"

                         SeparatorBrush="{TemplateBinding SeparatorBrush}"> 
```

基本上它在模板中的另一个位置定义：这将向您解释 [TemplateBinding MSDN TemplateBinding](http://msdn.microsoft.com/en-us/library/ms742882.aspx)

HTH，埃里克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-26T17:40:18.813

这是另一个示例

```
 <DataGrid AutoGenerateColumns="False" Height="200" 
                  HorizontalAlignment="Left" Name="dgDownloads" 
                  VerticalAlignment="Top" Width="777"  
                  Background="Black" RowBackground="Gray"  Foreground="White"
                  AlternatingRowBackground="Gray" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch">
            <DataGrid.Columns>

                <DataGridTextColumn 
                Header="{lex:LocTextExtension Key=Name, Dict=Resources, Assembly=PreShow.Player}"
                Width="220"
                IsReadOnly="True"
                Binding="{Binding Filename}" >
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextWrapping" Value="Wrap"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                    <DataGridTextColumn.HeaderStyle>
                        <Style TargetType="{x:Type DataGridColumnHeader}">
                            <Setter Property="FontWeight"  Value="Bold" />
                            <Setter Property="Foreground"  Value="Yellow" />
                            <Setter Property="Background"  Value="Black" />
                        </Style>
                    </DataGridTextColumn.HeaderStyle>
                </DataGridTextColumn>

                <DataGridCheckBoxColumn 
                  IsReadOnly="True"
                  Header="{lex:LocTextExtension Key=Success, Dict=Resources, Assembly=PreShow.Player}" 
                  Width="60"
                  Binding="{Binding IsSuccess}"
                  IsThreeState="False">
                    <DataGridCheckBoxColumn.HeaderStyle>
                        <Style TargetType="{x:Type DataGridColumnHeader}">
                            <Setter Property="FontWeight"  Value="Bold" />
                            <Setter Property="Foreground"  Value="Yellow" />
                            <Setter Property="Background"  Value="Black" />
                        </Style>
                    </DataGridCheckBoxColumn.HeaderStyle>
                </DataGridCheckBoxColumn>

                <DataGridTemplateColumn Header="{lex:LocTextExtension Key=Time, Dict=Resources, Assembly=PreShow.Player}" IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Downloaded}" Margin="4"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.HeaderStyle>
                        <Style TargetType="{x:Type DataGridColumnHeader}">
                            <Setter Property="FontWeight"  Value="Bold" />
                            <Setter Property="Foreground"  Value="Yellow" />
                            <Setter Property="Background"  Value="Black" />
                        </Style>
                    </DataGridTemplateColumn.HeaderStyle>
                </DataGridTemplateColumn>

                <DataGridCheckBoxColumn 
                  IsReadOnly="True"
                  Header="{lex:LocTextExtension Key=IsDownloading, Dict=Resources, Assembly=PreShow.Player}" 
                  Width="60"
                  Binding="{Binding IsDownloading}"
                  IsThreeState="False">
                    <DataGridCheckBoxColumn.HeaderStyle>
                        <Style TargetType="{x:Type DataGridColumnHeader}">
                            <Setter Property="FontWeight"  Value="Bold" />
                            <Setter Property="Foreground"  Value="Yellow" />
                            <Setter Property="Background"  Value="Black" />
                        </Style>
                    </DataGridCheckBoxColumn.HeaderStyle>
                </DataGridCheckBoxColumn>

                <DataGridHyperlinkColumn 
                    Header="URL" 
                    Width="Auto"
                    IsReadOnly="True"
                    Binding="{Binding Path=URL}"
                    TargetName="{Binding Path=URL}">
                    <DataGridHyperlinkColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <EventSetter Event="Hyperlink.Click" Handler="OnHyperlinkClick" />
                        </Style>
                    </DataGridHyperlinkColumn.ElementStyle>
                    <DataGridHyperlinkColumn.HeaderStyle>
                        <Style TargetType="{x:Type DataGridColumnHeader}">
                            <Setter Property="FontWeight"  Value="Bold" />
                            <Setter Property="Foreground"  Value="Yellow" />
                            <Setter Property="Background"  Value="Black" />
                        </Style>
                    </DataGridHyperlinkColumn.HeaderStyle>
                </DataGridHyperlinkColumn>
            </DataGrid.Columns>
        </DataGrid> 
```

# email - TFS：电子邮件差异

> ID：506931
> 
> 赞同：3
> 
> 时间：2009-02-03T12:38:49.953
> 
> 标签：email, tfs, diff, notifications

[Eric 建议](http://www.ericsink.com/entries/Read_the_Diffs.html "阅读差异")你每天早上阅读团队的差异。我可以让 TFS 以某种方式自动执行此操作吗？理想情况下，我想要一封包含所有差异的电子邮件，但我会接受每个提交的链接。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T14:25:09.053

作为[为 Eric 工作](http://www.ericsink.com/entries/Welcome_Martin_Woodward.html)并且每天早上都会检查差异的人，让我解释一下我的工作。我想我是他写这篇文章时想到的人之一，但我知道他不知道我每天早上都做了差异检查:-)

在 Eclipse 中，我使用 Team、Synchronize... 功能将我的本地工作区与服务器上的最新工作区进行比较。因为我经常做最新的，这告诉我自从我上次这样做以来发生了什么（即在我不看的时候发生了什么变化）。

在 Visual Studio 中，我可以通过右键单击我感兴趣的区域的根文件夹并选择比较...然后将工作区版本与最新版本进行比较来执行类似的操作。

或者，您可以只对感兴趣的文件夹执行“历史记录...”，然后简要浏览历史记录视图将向您显示发生了什么，您可以查看感兴趣的内容。它还鼓励您留下良好的签入评论，并鼓励您的开发人员也这样做:-)

我曾经为每次签到（团队、项目警报...）配置电子邮件警报，但我最终大部分时间都忽略了它们。我什至有一个[机器人兔子配置为在有人签入或运行构建时与我交谈](http://www.woodwardweb.com/gadgets/000434.html)- 但这仅在白天有用，而不是检查前一天我睡着时发生的事情（我住在不同的我的其他同事的时区，所以他们在我睡觉时做很多工作，反之亦然，使差异检查的实践更加有用）

从理论上讲，可以编写一个程序，每天都会在最新版本和您的工作区版本之间产生差异，但是我从来没有打扰过自己。这部分是因为我发现实践的最大价值在于探索每天所做的变化，而不仅仅是阅读它们。我还承认，我不知道世界上其他任何人都在做这个日常的差异例程——我认为我的代码 voyerisum 中只有我一个人，但显然不是！

**2009 年 2 月 12 日更新：**我刚刚注意到以下博客文章。

[http://blogs.msdn.com/abhinaba/archive/2008/07/07/auto-generating-code-review-email-for-tfs.aspx](http://blogs.msdn.com/abhinaba/archive/2008/07/07/auto-generating-code-review-email-for-tfs.aspx)

它讨论（并提供源）一个名为 CRMail 的工具，该工具将从搁置集中生成一封电子邮件，其中包含返回到 Team System Web Access 的链接，以显示变更集中每个更改的差异。如果您愿意，可以修改此源以显示变更集之间的差异。然后，您只需要通过订阅 TFS 的签入事件将其连接为作为夜间计划任务或在每次签入时运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T13:13:23.287

您是否探索过在项目门户上设置报告以显示基于日期的差异？我还没有这样做（而且我现在在家，所以我无法调查它），但我知道你可以从门户中获取很多信息。我不知道您是否可以获得代码差异。

另一种选择是使用 tfsadmin 或[电动工具](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)使某些东西自动化。再说一次，不是在工作，所以我看不到它，尽管电动工具似乎可以让你从文档中做你想做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T13:18:10.703

一个快速的解决方案是配置项目警报，以便每个变更集向您发送一封电子邮件。

将这些过滤到您的电子邮件客户端中的单独文件夹中，并在您闲暇时查看它们。

# .net - 我怎样才能重构这段代码？

> ID：506934
> 
> 赞同：1
> 
> 时间：2009-02-03T12:39:59.437
> 
> 标签：.net, vb.net, refactoring

我正在使用以下函数将 DataTable 中的列（从数据层传递）映射到对象属性。该函数存在于我正在填充的类中。该类有两个方法：Load() 加载带有值的对象，LoadAll() 返回填充对象的集合。我希望能够使用相同的代码来填充当前对象或新对象。但是我对结果不太满意，主要是因为重复有点像维护噩梦。

```
Private Function MapDataRowToProperties(ByVal dr As DataRow, ByVal target As Incident) As Incident
            If target.Equals(Me) Then
               Me.ID = Convert.ToInt32(dr.Item("pkIncidentID"))
               Me.Description = dr.Item("IncidentDetail").ToString
               Me.Created = Convert.ToDateTime(dr.Item("CreatedOn"))
               ...
               Return Me
           Else
              Dim NewIncident As New Incident
              NewIncident.ID = Convert.ToInt32(dr.Item("pkIncidentID"))
              NewIncident.Description = dr.Item("IncidentDetail").ToString
              NewIncident.Created = Convert.ToDateTime(dr.Item("CreatedOn"))
              ...
              Return NewIncident
           End If

    End Function 
```

注意：我很清楚 ORM 工具会为我做这件事，我通常使用 EntitySpaces，但对于这个项目，我无法这样做。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T12:45:01.940

怎么样 ：

```
dim Inc as Incident 
if target.Equals(me) then 
   Inc = Me
else
   Inc = new Incident
end if 
'Other code'
return Inc 
```

OTOH，如果 target.Equals(me) 应该只匹配当前对象（在这种情况下，您应该使用 Is 或 ReferenceEquals，因为可以覆盖 Equals 以为其他对象返回 True）并且您正在传递一个新事件（或者目标可以被修改）在第二种情况下，然后删除 if 并直接使用目标。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T13:00:57.133

在我看来，您的`If`和`Else`块的不同之处仅在于一个假设已经传递了现有对象（当前实例），而另一个通过重新创建它来覆盖任何传递的引用。

这似乎是 ByRef 参数的理想情况，换句话说，让调用代码传递不同的变量并让此函数在每种情况下以相同的方式工作：

```
Private Sub MapDataRowToProperties(ByVal dr As DataRow, ByRef target As Incident)
  If target Is Nothing Then
    target = New Incident()
  End If
  'Set properties 
  '...
End Sub 
```

示例调用：

```
'Usage 1:
MapDataRowToProperties(dr, Me)

'Usage 2:
Dim inc as New Incident()
MapDataRowToProperties(dr, inc) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T13:38:37.727

你有一个功能试图做不止一件事，分开你的意图，一切都会变得清晰

```
Public Class Incident

   Private sub CopyFrom(ByVal dr As DataRow) 
       MapDataRowToProperties(dr, me)
   End Function

   Private Shared Function CreateFrom(ByVal dr As DataRow) As Incident
      Dim NewIncident As New Incident
      MapDataRowToProperties(dr, me)
      Return NewIncident
   End Function

   Private Shared sub MapDataRowToProperties(ByVal dr As DataRow, byval target As Incident) 
      target.ID = Convert.ToInt32(dr.Item("pkIncidentID"))
      target.Description = dr.Item("IncidentDetail").ToString
      target.Created = Convert.ToDateTime(dr.Item("CreatedOn"))
   End Sub
End Class 
```

现在用法变成

```
 Dim aClass as new Incident
   aClass.CopyFrom(dr) 
```

或者

```
 Dim aClass as MyClass = Incident.CreateFrom(dr) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T12:51:23.720

希望这可以帮助。（请原谅我的语法错误，自从vb编码以来已经很长时间了）。

在调用函数中

```
If target.Equals(Me) Then

    target = MapDataRosToProperties(target,dr)
Else

    Dim target as Incident

    target = MapDataRosToProperties(target,dr) 
```

**重构函数**

```
Private Function MapDataRowToProperties(ByVal target as Incident,ByVal dr as DataRow) As Incident

    target .ID = Convert.ToInt32(dr.Item("pkIncidentID"))
    target .Description = dr.Item("IncidentDetail").ToString
    target .Created = Convert.ToDateTime(dr.Item("CreatedOn"))
    ...
    Return target 

End Function 
```

# java - 从内存中检索字节码以防止黑客攻击

> ID：506939
> 
> 赞同：3
> 
> 时间：2009-02-03T12:42:59.183
> 
> 标签：java, security, bytecode

如何检索字节码并进行哈希处理以查看是否有人在内存或文件中操纵了我的字节码？

*编辑：* 对二进制文件进行签名是否可以保护代码不被修改和执行？尽管我想保护我的用户免于确保他们正在运行我的软件。我还想保护程序（服务器）不被黑客客户端使用。

如果有人篡改了我的客户端，我如何从服务器端检测到？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-03T12:50:21.867

因此，您正试图阻止某些具有与您的应用程序相同（或更高）权限级别的进程操纵您的应用程序？

这是一项注定要失败的任务。因为如果您添加安全检查，什么会阻止攻击者`isSecure()`通过将其替换为简单的方法来修改您的方法`return true;`？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T13:03:59.653

我认为您需要澄清您的要求（至少我无法理解您在寻找什么）。

在与安全相关的领域，您总是需要回答两个问题，然后才能开始解决问题：

*   我想保护什么？
*   攻击者有什么能力？

在您的情况下，我相信您正在尝试保护 Java 客户端的类文件不被修改。在这种情况下，答案取决于（潜在的）攻击者可以做什么。

如果攻击者实际上在客户端运行的机器上拥有管理员权限，那么您基本上无能为力。正如上面 saua 所指出的，如果您不能信任正在运行的系统，那么您注定要失败。

如果攻击者只能在类文件到达客户端*之前*修改它们，那么签署您的 JAR 文件将使您的客户端检测到该操作。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T12:45:38.663

也许您想对[jar 文件进行签名](http://java.sun.com/docs/books/tutorial/deployment/jar/intro.html)？

通过添加自定义 Transformer，您应该可以通过 Intrumentation 实现您想要的。见[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html)

自定义类加载器也可以完成这项工作，因为它在定义类时获取字节码。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-03T13:50:13.523

> 服务器端如何检测是否有人篡改了我的客户端？

你不能。在互联网上没有人知道你是不是一只狗；-)

说真的：服务器端对客户端做出任何假设的唯一选择是通过网络发回的信息。通过加密协议并使其难以进行逆向工程，您可以使入侵者难以破解客户端，但并非不可能。

[NGSCB](http://en.wikipedia.org/wiki/Next-Generation_Secure_Computing_Base)（以前称为 Palladium）旨在使这一点更加安全，但这有其自身的一系列[问题](http://www.theregister.co.uk/2002/06/25/ms_to_eradicate_gpl_hence/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T12:46:38.613

您可以创建自己的类加载器并手动进行检查，**或者**您可以**签署**您的代码并让 java 运行时为您完成这项工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T13:27:49.683

签署 jars 将保护代码不被修改。签名涉及根据您的私钥创建签名。公钥嵌入到带有这些签名的 jar 中。Java 将根据您的公钥验证签名并拒绝加载修改后的类。

被黑客入侵的客户端将更难预防。首先，被攻击者必须对您的协议进行逆向工程。您可以使用 java 混淆器采取措施防止这种情况发生，但最终攻击者可以只监视线路并从流量中对协议进行逆向工程。即使您加密客户端-服务器通信（这并不容易，考虑使用已经为您完成的协议...... SSH 或 HTTPS），您最终仍然容易受到中间人攻击.

你到底想保护什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-01T19:24:36.243

在客户端，您可以使用 jar 中类文件的路径名调用 getResourceAsStream。

这回答了您问题的一部分（“我如何检索字节码”）。其他答案很好地涵盖了更大的问题。

# sql-server - 单个表中的列太多 - 它是良好的正常形式吗？

> ID：506964
> 
> 赞同：5
> 
> 时间：2009-02-03T12:51:49.070
> 
> 标签：sql-server, normalization

规范化的表应该有更少的列数，并且可以有尽可能多的引用字段。这是正确的方法吗？列数与良好的规范化过程之间是否存在任何关系？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T12:56:48.170

> 列数与良好的规范化过程之间是否存在任何关系？

简而言之，没有。一个 3NF 规范化的表将有尽可能多的列，前提是

> 表中的数据依赖于键，整个键，除了键之外什么都没有（所以帮帮我 Codd）。

在某些情况下，（某些）非规范化实际上可能会提高性能，而何时应该这样做的唯一真正衡量标准是对其进行测试。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-03T12:53:56.493

您应该遵循规范化原则，而不是关心表中的列数。业务需求将驱动实体、它们的属性和它们的关系，没有绝对的数字是“正确的”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T13:12:14.117

如果您觉得表格的字段过多，可以使用以下方法。例子：-

```
CREATE TABLE Person
    Person_ID int not null primary key,
    Forename nvarchar(50) not null,
    Surname nvarchar(50) not null,
    Username varchar(20) null,
    PasswordHash varchar(50) null 
```

此表代表人，但显然并非所有人都需要成为用户，因此 Username 和 PasswordHash 字段可以为空。然而，可能会有比用户多 1 或 2 个数量级的人。

在这种情况下，我们可以创建一个 User 表来保存与 Person 表一对一关系的 Username 和 PasswordHash 字段。

您可以通过查找可以为空的字段集来概括此方法，这些字段要么一起为空，要么一起具有值并且很可能为空。这表明您可以提取另一个表。

**编辑**

感谢 Stephanie（见评论），这种技术显然被称为“垂直分区”

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T12:59:07.137

虽然我同意@ocdecio，但我也会观察到，在相同的数据存储要求的情况下，一个经过规范化的数据库通常每个表的列数更少，而表比非规范化的数据库多。与代码异味类似，如果应用程序相当大，数据库异味将是相对较少的表。这暗示您的数据可能不是正常形式。在适当的情况下应用规范化规则将减轻这种“气味”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T13:28:58.323

每列必须与主键具有直接且排他的关系。如果您有一个属性重的项目，那么您可以做的事情就是简化模型。任何拆分成多个表的尝试都将适得其反且毫无意义。

# thread-safety - 对象必须被锁定才能使用？

> ID：506970
> 
> 赞同：1
> 
> 时间：2009-02-03T12:54:00.017
> 
> 标签：thread-safety, language-features, mutex

我在思考语言特性，我想知道以下特性是否已在任何语言中实现。

一种声明对象只能在 Mutex 中访问的方法。所以例如在java中你只能访问一个对象，如果它在一个同步块中并且在C#中是一个锁。

如果在 Mutex 块之外使用该对象，则会出现编译器错误。

有什么想法吗？

**更新**

我认为有些人误解了这个问题，我不是在问你是否可以锁定对象，我是在问是否有一种机制可以在声明对象时声明它只能从锁定/同步语句中访问。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T13:03:02.980

有两种方法可以做到这一点。

您的程序要么拒绝**运行**方法，除非保护互斥锁被调用线程（即 a `runtime check`）锁定；或者它拒绝**编译**（那是 a `compile time check`）。

第一种方法是做什么`C# lock`。

第二种方法要求编译器能够评估每个可能的执行路径。这几乎是不可行的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T12:58:51.757

在 Java 中，您可以将`synchronized`关键字添加到方法中，但这只是将整个方法体包装在`synchronized(this)`-block 中的语法糖（对于非静态方法）。

因此，对于 Java，没有强制执行该行为的语言结构。您可以尝试`.wait()`使用零超时来确保调用代码已获取监视器，但这只是事后检查

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T13:00:46.353

在 Objective-C 中，您可以使用`@property`and`@synthesize`指令让编译器为访问器生成代码。默认情况下，它们受互斥锁保护。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T04:03:52.570

如您所描述的那样要求对所有事物进行锁定会产生死锁的可能性，因为可能会被迫比其他人更快地获得锁定。

也就是说，有一些类似于您所描述的方法 - [Software Transactional Memory](http://en.wikipedia.org/wiki/Software_transactional_memory)特别是通过允许回滚和重试来避免死锁问题。

# ruby-on-rails - 您如何记住/组织 Rails 信息以防止车轮再造？

> ID：506976
> 
> 赞同：3
> 
> 时间：2009-02-03T12:56:27.313
> 
> 标签：ruby-on-rails, code-snippets

我喜欢使用 Rails，但我一直在为自己的低效率而绊倒：我会花时间实现一些“有用的”功能，但后来发现它已经在框架中，如果我知道的话！

对我来说，车轮改造的特定领域是

*   助手和内置类扩展
*   最近发布的功能可能还没有进入我的大脑
*   插件（Rails 插件的分类，如果这样的事情有意义，将是一个福音）
*   迁移选项
*   不常用的 rake 任务
*   选项散列几乎所有内容

显然（？）我们不可能一直记住所有这些东西。有“备忘单”，但除非它们是最新的，否则当它们真正针对旧版本时，它们可能会通过出现权威来加剧问题。

你怎么做才能最大限度地减少这种消费税？有什么可以做的吗？

我想知道一组大可见图表是否会有所帮助，尽管天知道我会把它们放在开放式办公室的什么地方。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T15:09:19.433

这里有一件事是首先要了解特定功能（插件、gem 等）的存在。这就是为什么

*   我尝试了解有关 Edge Rails 的最新信息。
*   我关注了很多博客，如果没有别的事情，我每天都会尝试浏览标题，只是为了让它至少在我的记忆中留下一些微小的足迹。

这是被动部分。现在对于主动：

*   当我浏览新功能/插件时，我尝试至少想象一些用例，在这些用例中它可能对我现在正在做的事情有所帮助——这个练习帮助我记住这件事，因为我将它与我的实际概念联系起来系统。
*   在我不太严肃的项目中，我真的尝试尝试新事物。
*   在 SO 上，我经常回答我不确定或我并不真正了解的问题，但它们对我来说似乎很有趣 - 然后我会做一些研究并扩展我对该特定主题的知识。

从长远来看，我认为“大可见图表”不会有所帮助。我只在学习新事物时使用备忘单，这实际上只是短期的事情。正如亚里士多德所说，卓越是一种习惯。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T15:50:15.590

这不仅仅是 Rails 的问题，任何框架都有。我认识的那些与 Delphi 合作多年的程序员仍然对发现他们复制的简单标准函数感到震惊。

WRT Rails，[Mike Gunderloy 最近写了一篇关于高亮文本](http://afreshcup.com/2009/01/29/highlighting-text-in-rails/)的文章，并以这个明智的花絮结束：

> [偶尔看看ActionView::Helpers](http://apidock.com/rails/ActionView/Helpers)是值得的，看看还有哪些其他功能潜伏着你已经忘记了。

每当我需要做一些我认为应该比现在更容易的事情时，我都会在那里以及谷歌进行快速检查，以确保我不会浪费大量时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T15:07:51.450

我也面临这个问题——当我第一次开始使用 RoR 时情况更糟。现在经过 1.5 年多，我知道什么是可用的。

基本上我所做的是，如果我使用我知道的部分框架......没什么大不了的。如果我需要做一些我可能必须自己创建的事情，我首先用谷歌搜索它或搜索 Rails API。最近我也开始搜索 github 和一些插件网站，比如 railslodge.com。

虽然这并不能完全解决问题，但它的帮助很大。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T15:24:24.927

我在我的 RSS 提要中浏览 Rails 博客，阅读标题，足以弄清楚这篇文章是关于什么的。这给了我很好的知识广度，但很肤浅。它仍然让我知道外面有什么。就像昨天我看到一篇关于高亮助手的博客文章（我不知道它存在。现在我知道了，如果我需要它，我知道去寻找它——即使没有深入阅读这篇文章）。我还会在另一个选项卡中打开我想深入阅读的帖子（我曾经使用 ReadItLater，但它失控了），当我阅读它们时，我在自己博客上的帖子中写笔记更多是为了我自己的利益，而不是为了其他 - 进入记忆并确保我以后可以找到它。

当我进入未知领域或被遗忘的领域时，我做的另一件事是在这里提出一个关于最佳实践或具体细节的问题，即使我认为我知道答案。例如，我不记得[用于跟踪记录编辑历史的流行插件的名称](https://stackoverflow.com/questions/487572/what-is-the-best-way-to-maintain-a-records-edit-history-with-rails-and-activerec)（acts_as_audited 和acts_as_versioned）。我在 15 分钟内得到了答案。

它把单人编程变成了在那些很酷、吵闹的开发商店之一的编程，那里有一张桌上足球桌和许多其他知道我不知道的东西的人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T16:21:13.200

我倾向于假设我正在解决的大多数类型的基本问题已经被其他人解决了；从假设开始，我的想法不是“我如何构建这个”，而是“我在哪里可以找到它”，当然谷歌、wiki、插件和 gems 列表都在其中发挥了作用。我编写的代码很少，与我的业务领域没有直接关系。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T17:25:07.817

我先写测试。然后编码。有时框架会为我做这件事，而我不必编写代码。:)

我不认为 Rails 与其他框架有什么不同......需要一段时间才能知道事情在哪里。您能做的最好的事情就是阅读 API 文档并查看其中的内容。您无需学习如何使用它，只需了解它的存在并了解如何在需要时查找它。

此外，编写别人已经拥有的代码也不是一件坏事。你从中学习。稍后您只需交换框架 mojo 并查看您的测试是否仍然通过。如果是这样，那么您很好，并且您知道框架的一部分的内部可能是如何工作的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-11T12:15:31.310

我相信消除浪费在重新发明轮子上的时间的关键是拥有一个非常少数的工具来在 Rails 助手/功能中进行搜索。

一方面，一个好的 IDE 选择可以帮助很多。另一方面 - 一个非常好的在线（离线）边缘文档，能够快速搜索它。这些天来，我们的一位俄罗斯 Rails 程序员做了一个：[http](http://railsapi.com/) ://railsapi.com/ 。搜索以非常 MacOS 的风格完成，使其成为快速挖掘的非常好的选择。

# mysql - MySQL使用不同表的字段对结果进行排序

> ID：506980
> 
> 赞同：0
> 
> 时间：2009-02-03T12:58:02.507
> 
> 标签：mysql, sql

我有以下结构的 3 个表

```
 products
    {
        pid
        pname
        plocation...
    }

    services
    {
        s_id
        s_name
        s_location...
    }

    txn
    {
        tid
        pid...
    } 
```

我正在使用以下查询来获取我需要的值。

```
 $dbquery = "SELECT DISTINCT products.pid AS id,
                   products.pname AS name,
                   products.p_desc AS description,
                   products.p_loc AS location,
                   products.category AS category,
                   products.p_uid AS userid,
                   products.add_date AS dateadded,
                   products.isaproduct AS whatisit
              FROM products
             WHERE products.pname
              LIKE '%".$keyword."%'
               AND category = '".$refine_value."'
             UNION
             SELECT DISTINCT services.s_id AS id,
                   services.s_name AS name,
                   services.s_desc AS description,
                   services.s_category AS category,
                   services.s_uid AS userid,
                   services.s_location AS location,
                   services.date_added AS dateadded,
                   services.isaservice AS whatisit
              FROM services
             WHERE services.s_name
              LIKE '%".$keyword."%'
               AND s_category = '".$refine_value."' 
```

我需要通过在上面的查询中获得 txn 表中的 pid 计数来订购我选择的值。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T13:04:09.873

首先，使用参数化查询而不是构建这样的查询字符串。这让我很烦。

但看起来您真正需要做的就是按 txn 表中的 pid 列进行分组。

定义一个像

```
SELECT pid, COUNT(tid) tid_count
FROM txn
GROUP BY pid 
```

并将其加入到您的查询中，然后按 tid_count 排序。

# google-maps - 如何在 Google 地球插件上放置一个 html div？涉及wmode，我想

> ID：506984
> 
> 赞同：11
> 
> 时间：2009-02-03T12:59:13.643
> 
> 标签：google-maps, google-earth, google-earth-plugin

我在网络应用程序中**的 Google 地球插件上放置 html div 时**遇到问题，我们将不胜感激。

它适用于地图、地形和混合模式，但在“**地球**”模式下，**Flash 会启动并自动将地图分层**。

Z索引没有帮助。

大概我可以做类似的事情：

```
document.getElementById('flashDiv').setAttribute('wmode', 'opaque'); 
```

但考虑到谷歌的东西是即时编译的，这使得它变得更加困难。查看生成的代码在这里没有帮助。同样，由于它是动态编译的，像 SWFObject 这样的东西无法挽救这一天……

有没有人遇到过类似的事情？我花了一上午的时间搜索 Google Earth API 组，但无济于事。

**更新**：经过更多的拉扯，答案可能在于[iframe shim](http://groups.google.com/group/google-earth-browser-plugin/browse_thread/thread/dc38137e4b816837)。我可能也草率地得出该插件是基于 Flash 的结论。正在调查...

[![替代文字](https://i.stack.imgur.com/6ZYkp.jpg)](https://i.stack.imgur.com/6ZYkp.jpg)
[（来源：[googlepages.com](http://neilsimonmckeown.googlepages.com/overlay.jpg)）]

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-08-12T15:58:56.060

我在这里整理了一个演示，展示了如何使用`IFRAME`垫片：

[http://earth-api-samples.googlecode.com/svn/trunk/demos/customcontrols/index.html](http://earth-api-samples.googlecode.com/svn/trunk/demos/customcontrols/index.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T13:14:30.507

没有直接支持在 Api 或 Dom 中覆盖“z-indexing”一个 div。插件加载一个可执行文件，简单来说，就是在浏览器窗口上打了一个洞。使用“iframe shim”技术是标准的解决方法，尽管透明度可能很棘手。

有一个[开放的功能请求](http://code.google.com/p/earth-api-samples/issues/detail?id=9&colspec=ID%20)将此功能添加到 api - 评论部分有一些很好的信息和链接。

此外，这里有一个很棒的在线[演示](http://maps.myosotissp.com/demos/popups.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-02T06:04:28.210

如果它是一个插件，那么您不能可靠地将其他元素放在它的顶部。当涉及插件时，浏览器通常会放弃大部分“分层”元素的能力。

我想 Iframe 可能是一种解决方法，只要您检查它是否仍然适用于大多数浏览器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T13:15:03.417

在调查了谷歌让用户嵌入代码的方式之后，它看起来像是一个 iFrame。不过，如果您在使用闪光灯时遇到任何问题，请参见下文...

尝试在 Flash 元素上显示下拉导航（或在 YouTube 视频上显示 html）时遇到类似情况。有几个因素起作用。

第一个是我想要悬停在 flash 元素上的 html 元素，它必须是同级 html 元素，并为每个同级元素以及父 div 设置 css 属性。因此，例如：

```
<div id="parent">
  <div id="sibling"></div>
  <embed id=”flash”&gt;<other script code></embed>
</div> 
```

那么我的CSS将是

```
//.parent may not need to be set to relative
#parent   { position: relative; }
// the value on sibling1 just needs to be higher than .sibling2
#sibling  { position: relative; z-index: 20; }
#flash    { position: relative; z-index: 10; display:inline } 
```

另一件值得注意的事情是您的闪存需要将 wmode 参数设置为透明。

这个技巧适用于各种 Flash 应用程序以及 YouTube 视频 - 技巧是确保要在 Flash 上显示的 html 是实际 Flash 代码的兄弟元素，而不是父 div，z-index 为在 flash 上显示的 html 高于 flash 元素，两个 html 元素的定位都设置为相对或绝对，并且 wmode 参数设置为透明。

希望这会有所帮助——但我猜你的问题出在 iFrame 上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-21T21:21:46.560

将“iframe”z-index 设置为 100

并将显示在顶部 z-index 上的 div 设置为 200（div 必须至少是相对位置）

# eclipse - Eclipse - 编辑器颜色 - 健康配置

> ID：506999
> 
> 赞同：13
> 
> 时间：2009-02-03T13:06:08.247
> 
> 标签：eclipse, ide, color-scheme

我将 Eclipse 用于 Java、Python、C(++) 等。我习惯了 Vim 和深色的配色方案。默认的白色背景只是伤害了我的眼睛。这是一个真正的问题。Eclipse 似乎不支持任何方案？我尝试[了一个插件](http://colorer.sourceforge.net/eclipsecolorer/) ，但它似乎不适用于 MacOS 和 Eclipse 3.3.2。

对于某些颜色支持有更好的选择吗？

谢谢，希望

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-01-27T13:42:42.233

Eclipse Color Theme 插件中有一些深色主题可用：

[http://marketplace.eclipse.org/content/eclipse-color-theme](http://marketplace.eclipse.org/content/eclipse-color-theme)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T13:14:13.317

请检查Eclipse 中的[字体和颜色](http://help.eclipse.org/helios/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/accessibility/fontsandcolors.htm)以自定义 Eclipse。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-05-21T08:52:32.467

注意：Eclipse Luna（4.4，将于 2014 年 6 月发布）刚刚引入（2014 年 5 月）在使用[Koneki 项目](http://www.eclipse.org/koneki/)时为深色主题的默认语法着色：请参阅[Simon Bernard](https://projects.eclipse.org/content/simon-bernard-committer-koneki)的[bug 433607](https://bugs.eclipse.org/bugs/show_bug.cgi?id=433607)：

![https://bugs.eclipse.org/bugs/attachment.cgi?id=243299](https://i.stack.imgur.com/lkfIr.png)

这说明了如何定义自己的语法着色主题，以及如何 为最近的 (4.x) Eclipse[注册深色主题的扩展。](https://git.eclipse.org/c/platform/eclipse.platform.ui.git/commit/?id=bc7c5eaf84573cd45d325f0f62f2d5009d07e6da)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T13:12:58.577

转到“窗口”菜单下的“首选项”。

在弹出的对话框中，选择 General，然后是 Appearance，然后是 Colors and Fonts

更正：对于编辑器前景/背景颜色，您需要转到首选项对话框，然后选择编辑器，然后选择文本编辑器

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-29T12:36:41.480

您还可以转到源代码，按鼠标右键，选择“外观颜色选项：”下的一个选项，然后使用显示的“颜色：”选择器更改颜色。**************