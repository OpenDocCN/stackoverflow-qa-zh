# StackOverflow 问答 000620000-000620999

# sql-server - 需要查询帮助（使用连接）

> ID：620017
> 
> 赞同：0
> 
> 时间：2009-03-06T18:59:58.390
> 
> 标签：sql-server, tsql

我有三个表：

Checkbook 表包含我需要获取的内容
Receipts 表包含指向所有者表的链接
Owner 表知道它链接到哪个支票簿

只有当收据中有行链接到它时，我才需要获取支票簿（通过所有者表）。我不确切知道如何做到这一点，而且它似乎有点循环。这是我尝试过的：

```
SELECT chk.ID, chk.Description FROM tblCheckbook chk
LEFT JOIN tblOwner o
ON r.OwnerID = o.ID
INNER JOIN tblCashReceipts r
ON chk.ID = o.CheckbookID 
```

但是sql server 报错“无法绑定**多部分标识符“r.OwnerID” 。”**
我需要做什么才能使其正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T19:05:34.447

在您执行 LEFT JOIN 时，还没有遇到 r (tblCashReceipts) 的定义。你可能想要这样的东西：

```
SELECT chk.ID, chk.Description FROM tblCheckbook chk
LEFT JOIN tblOwner o
ON chk.ID = o.CheckbookID
INNER JOIN tblCashReceipts r
ON o.ID = r.OwnerID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:16:10.457

每个连接都有一个`on`描述关系的子句。您只需将关系与正确的连接放在一起。

在这里使用左连接没有意义，因为您在第二步中使用了内连接。这只会使数据库使用更大的集合来获得相同的结果。

```
select c.ID, c.Description
from tblCheckBook c
inner join tlbOwner o on o.CheckbookID = c.ID
inner join tblCashReceipts r on r.OwnerID = o.ID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T20:05:39.653

我想你快到了，你只是改变了你的加入条件。试试这个：

```
SELECT chk.ID, chk.Description FROM tblCheckbook chk
LEFT JOIN tblOwner o ON o.CheckbookID = chk.ID 
INNER JOIN tblCashReceipts r ON r.OwnerID = o.ID 
```

或者：

```
SELECT chk.ID, chk.Description FROM tblCheckbook chk
LEFT JOIN tblOwner o ON o.CheckbookID = chk.ID 
LEFT JOIN tblCashReceipts r ON r.OwnerID = o.ID 
WHERE r.OwnerID IS NOT NULL 
```

那么，如果同一所有者有多个收据，会发生什么？使用此查询，您将为每个收据返回一个支票簿，这可能是您想要的，但听起来不像。您可能还想在那里扔一个 DISTINCT 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T19:06:40.590

收据是否知道它们属于哪个支票簿？

通过收据表加入支票簿。

所有者 -> 收据 -> 支票簿

# sharepoint - 关注“我的网站”时 OWA Web 部件跳转/转移

> ID：620018
> 
> 赞同：2
> 
> 时间：2009-03-06T19:00:20.153
> 
> 标签：sharepoint, moss, web-parts, outlook-web-app

在 SharePoint (MOSS 2007) 中，如果页面上有 OWA Web 部件（收件箱或日历部件），当页面加载时它会“跳”下以将该部件作为焦点。不管它在页面的什么位置。有没有人遇到过这个问题或知道如何解决这个问题？

这发生在带有 OWA 组件的开箱即用的共享点站点上。没有修改或第 3 方组件或自定义在起作用。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-11-20T10:59:56.100

默认情况下。Webpart 旨在在加载时获得焦点。
下面可能是使用 jQuery/JS 的解决方案：

1.  只需在底部创建另一个 webpart（CE webpart 仅用于添加 JS）并添加 JQUERY/JS 代码以将页面滚动到顶部

2.  了解从 OWA webparts 调用的默认 JS 函数并在您的自定义 JS 中覆盖它们

没有经过任何测试，但通常这是我们防止默认行为的方式。

# programming-languages - 不同语言的静态

> ID：620024
> 
> 赞同：4
> 
> 时间：2009-03-06T19:02:26.823
> 
> 标签：programming-languages, static, keyword

我听说在关键字的含义上存在语言之间的差异**`static`**，但我还没有找到一个很好的列表来整合这些差异。

以下是我对**`static`**C++ 中含义的了解：

*   对于函数内的局部静态变量，该变量在启动时初始化，并且值在函数调用之间保存。
*   静态数据成员在类的所有实例之间共享。换句话说，静态数据成员只有一个实例。静态数据成员必须在文件范围内初始化。
*   静态成员函数只能访问静态成员。
*   在递归代码中，静态对象或变量保证在代码块的不同实例中具有相同的状态。
*   在文件范围内定义的静态对象和变量只有内部链接。没有其他文件可以使用它们。

**`static`**在其他语言中的含义如何变化？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-06T19:36:04.373

**C**

* * *

*   关键字可以更改对象的链接或持续时间（生命周期）。
*   变量总是初始化为 0
*   函数具有内部链接。
*   如果在文件级范围内声明：变量具有内部链接和静态持续时间（即在程序的整个生命周期中都存在）
*   如果在块范围内声明：变量没有链接但静态持续时间
*   在一个翻译单元中可以有同一个静态变量的多个声明。但是，请注意它们必须相同。例如：在文件级范围内：

* * *

```
int a;        // a has external linkage

static int a; // a now has static linkage
              // same as if you wrote: static int a = 0;

//...

static int b; // static linkage

extern int b; // extern loses its meaning, b still has internal linkage

//...

extern int b; // b has external linkage

static int b; // error

//...

void func() {
  static int x; // automatic linkage, static duration
                // same as if you wrote: static int x = 0;
} 
```

**C++**

* * *

*   在文件级别范围内，已弃用变量和成员的用法，转而支持匿名命名空间。仅作为兼容性存在
*   变量仍然默认初始化（如在 C 中）为 0
*   **“6.7 在任何其他初始化发生之前执行所有具有静态存储持续时间 (3.7.1) 或线程存储持续时间 (3.7.2) 的本地对象的零初始化 (8.5) [...]”**
*   变量具有静态存储持续时间，除非附带`thread_local`说明符（从 C++0x 开始）
*   翻译单元中只能有一个静态定义
*   成员变量/函数意味着它们是类的属性，而不是实例合法的访问语法：instance.property 或 Class::property
*   静态成员函数只能访问静态成员变量`this`此类函数没有指针
*   然而，非静态成员可以访问任何静态成员
*   在文件级别，对象具有内部链接，但具有类范围的类成员除外
*   类成员需要在类声明中或外部通过类名和范围解析运算符显式定义
*   不能`this`在静态方法中使用

* * *

**动作脚本**

* * *

*   C++ 中的类方法
*   不能在静态方法中使用`this`或`super`
*   只能通过类名而不是实例名访问
*   不继承
*   然而，派生类可以访问基类的静态属性
*   使用 static 和 const 关键字声明的变量必须在声明常量的同时初始化

* * *

**面向对象设计**

* * *

*   许多人认为 Singleton 设计模式是一种美化的静态对象
*   用于工厂设计模式

* * *

我可能错过了很多其他的东西——请随意加入。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T19:44:56.333

在 Delphi 中，static 关键字专门用于定义类方法。在 Delphi 中，一个*普通*的类方法可以被声明为虚拟的并在子类中被覆盖。此外，Delphi 有一个*self*变量，类似于其他语言中的*this*指针。然而，在类方法中，*self*指向调用该方法的类而不是实例。

声明一个类方法*静态*意味着：

1.  它不能在子类中被覆盖
2.  它没有*自*指针

这意味着静态类方法只能访问定义它的类中的类成员，而普通类方法可以访问派生类中重写的类成员。

在 Delphi 文档中还有其他非正式的静态用法，通常指的是特性的不可更改性（这是一个词吗？）。例如静态数组与动态数组。Delphi 中的所有实例方法都是静态的，除非另有声明。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T19:05:25.070

在 C# 中，它几乎总是意味着：“与类型相关而不是类型的实例”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T19:17:35.150

在 VB.NET 中，`Static`变量就像 C++ 局部静态变量。

但是，没有全类`Static`；改为使用`Shared`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-06T19:45:38.280

在 C# 中有 3 种方式可以使用静态关键字：

*   在类定义上，这意味着该类只会暴露静态成员并且不能被实例化
*   在类成员上，这意味着无需实例化类即可调用该成员。
*   在构造函数上，这意味着将始终在调用静态成员之前调用静态构造函数。（这些主要是性能瓶颈，因此不推荐）

希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T19:12:54.507

Python 有装饰器@staticmethod，当应用于类成员时，使方法在类而不是实例上可用，并且不向方法传递自动参数。@classmethod 装饰器执行类似的功能，但将类作为第一个参数传递，使其更加有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T19:21:08.743

在 C 语言中，静态将函数或全局变量标记为其所在文件的本地变量。

这有点像其他语言中的私有。排序。

如果它在函数中，则静态在二进制文件的数据部分中预分配该变量，而不是在运行时在堆栈上。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-06T19:30:44.290

在 VB.NET 中，静态使用过程级别来表示变量与过程的所有执行相关联（它在调用之间保留）。不过，这在面向对象的应用程序中有点神秘。

对应的是“共享”，这意味着方法或成员是类型级别的（您不需要实例来访问它）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-06T19:57:41.323

维基百科总结了许多不同的含义`static`：

[静态方法](http://en.wikipedia.org/wiki/Static_method#Static_methods "静态方法")、[静态变量](http://en.wikipedia.org/wiki/Static_variable#Static_Variables_as_Class_Variables "静态变量")、[静态类型](http://en.wikipedia.org/wiki/Type_system#Type_checking "静态打字")。

# ruby - 为什么问号在Ruby中被解释为“z”

> ID：620031
> 
> 赞同：2
> 
> 时间：2009-03-06T19:04:06.367
> 
> 标签：ruby

为什么此行输出“z”而不是“？”

$ ruby​​ -e 'puts %x[ echo #{"?"} ]'

假设#{...} 中的表达式是一个可能具有“？”值的变量。我应该如何修改这个脚本，以便输出问号而不是“z”？

（请原谅这个问题的标题——我还不太明白这里发生了什么，无法提供更具描述性的标题。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T23:24:08.303

不是红宝石，是你的外壳。

许多贝壳扩展 ? 字符以匹配命令行参数中的单个字符。这很有用，如果您有一堆要删除的文件名为 tempA,temp1,tempB,...,temp9，但又不想删除“temple”

```
% rm temp? 
```

所以我猜你的工作目录中有一个名为“z”的文件或目录，而 ? 匹配它，所以它被shell替换。

通常，当在单引号内（如您的 ruby​​ 脚本）时，它不会被扩展，但由于您将问号传递给 shell 命令，它会在那里被扩展。

```
% ruby -e 'puts %x[ echo ? ]'
z
% 
```

应该向您展示相同的行为。

此外，如果您触摸其他几个单字符文件名，例如 abcd，它们也应该显示出来：

```
% touch a b c
% ruby -e 'puts %x[ echo ? ]'
a b c z
% 
```

如果您想在从 ruby​​ 中调用外部 shell 命令时避免这种情况，则必须转义您传递的任何字符串。对于大多数目的`String#inspect`，应该提供足够好的转义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:09:55.450

它没有？

```
irb(main):001:0> puts %x[echo #{"?"}]
?
=> nil 
```

使用 #{} 将为您提供内部任何变量​​的值 - 我不确定您为什么使用它而不是

```
puts %x[echo "?"] 
```

要不就

```
puts '?' 
```

# windows-mobile - 数据网格样式windows mobile c#

> ID：620034
> 
> 赞同：0
> 
> 时间：2009-03-06T19:06:18.547
> 
> 标签：windows-mobile

我正在尝试在我的列中设置样式，`DataGrid`以便它适合 100% 的屏幕宽度。

我将数据绑定到我的网格：

```
 DataTable dt = new LoadGenres().Load(strFullPathToMyFile).Tables[0];
        genreGrid.DataSource = dt; 
```

LoadGenres 使用以下 XML 创建数据集：

```
<?xml version="1.0" encoding="utf-8"?>
<list>
<genre>Top 500</genre>
<genre>70s</genre>
<genre>80s</genre>
</list> 
```

这工作正常，但在屏幕上我得到下面的图像：

[替代文字 http://img17.imageshack.us/img17/7054/20090306190547.png](http://img17.imageshack.us/img17/7054/20090306190547.png)

如何让列适合网格的宽度？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T21:55:17.313

得到它

```
DataTable myTable = new DataTable();
        myTable = new LoadGenres().Load(strFullPathToMyFile).Tables[0];
        genreGrid.DataSource = myTable;
        DataGridTableStyle tableStyle = new DataGridTableStyle();
        tableStyle.MappingName = myTable.TableName.ToString();
        DataGridTextBoxColumn tbcName = new DataGridTextBoxColumn();
        tbcName.Width = Screen.PrimaryScreen.WorkingArea.Width;
        tbcName.MappingName = myTable.Columns[0].ColumnName.ToString();
        //tbcName.HeaderText = myTable.Columns[0].ColumnName.ToString();
        tableStyle.GridColumnStyles.Add(tbcName);
        genreGrid.TableStyles.Clear();
        genreGrid.TableStyles.Add(tableStyle); 
```

# tfs - TFS2008递归复制文件并不总是有效（编译vs2003）（AfterCompile目标）

> ID：620039
> 
> 赞同：0
> 
> 时间：2009-03-06T19:07:23.067
> 
> 标签：tfs, visual-studio-2003, tfs-2008

我在没有 SP1 的 TFS2008 的自定义脚本中复制文件时遇到了一些奇怪的问题，我必须多次运行构建才能复制文件（大多数情况下，我在第二个构建中获取文件），让我给你详细信息：

这发生在 ASP 站点和 VS2003 Web 解决方案上，（vs2008 解决方案还可以）在 ASP 中我有一个 2008 虚拟解决方案，构建编译这个虚拟，我覆盖 AfterCompile 并在其中将所有文件复制到 VS 2003 中的放置位置我还有一个虚拟 2008 解决方案，构建首先编译虚拟，我覆盖 AfterCompile，使用“Exec”和“Command”编译 2003 解决方案，然后将文件复制到放置位置。

正如您所看到的，这两种方法是相似的，我的构建本身没有问题，我的问题可以通过两种方式重现（是的，我确实签出、更新、签入然后测试构建）：

1.  创建一个新的构建，配置脚本，第一次运行构建，bin文件夹中的一些DLL没有被复制，第二次运行构建，我得到了所有的文件。

2.  构建已经配置并运行 OK，向项目添加一些文件（这主要发生在 ASP 站点上），运行构建，不要得到这个新文件，再次运行构建，我得到这个新文件。

这是我的 VS2003 Web 解决方案的构建脚本作为示例

```
<PropertyGroup> 
<TasksPath>D:\BuildTools\</TasksPath> 
    <VS2003Devenv>D:\Archivos de programa\Microsoft Visual Studio .NET 2003\Common7\IDE\devenv.com</VS2003Devenv> 
    <VS2003VirtualFolder>CnbvPifWeb</VS2003VirtualFolder> 
    <VS2003Suba>Cnbv.Pif.Web</VS2003Suba> 
    <VS2003Project>Cnbv.Pif.Web</VS2003Project> 
    <VS2003WebSiteName>Sitio Web predeterminado</VS2003WebSiteName> 
    <VS2003Configuration>Release</VS2003Configuration> 
    <VS2003Branch>Desarrollo</VS2003Branch> 
    <VS2003RelativePath>$(SolutionRoot)\$(VS2003Branch)\$(VS2003Suba)\</VS2003RelativePath> 
    <VS2003SolutionPath>$(VS2003RelativePath)Cnbv.Pif.Web.sln</VS2003SolutionPath> 
    <VS2003LocalFolder>$(VS2003RelativePath)Sources\$(VS2003Project)\</VS2003LocalFolder> 
    <VS2003Output>$(BinariesRoot)\$(VS2003Project)\</VS2003Output> 
    <VS2003CachePath>C:\Documents and Settings\srvfoundation\VSWebCache\230-2555-CPU015\</VS2003CachePath> 
    <VS2003ProjectExtension>vbproj</VS2003ProjectExtension> 
    <VS2003CacheFile>$(VS2003CachePath)$(VS2003VirtualFolder)\_vti_pvt\$(VS2003Project).$(VS2003ProjectExtension).cache</VS2003CacheFile>
</PropertyGroup> 
<Import Project="$(TasksPath)Microsoft.Sdc.Common.tasks"/> 
<UsingTask TaskName="Microsoft.Sdc.Tasks.Web.WebSite.CreateVirtualDirectory" AssemblyFile="Microsoft.Sdc.Tasks.dll" /> 
<UsingTask TaskName="Microsoft.Sdc.Tasks.Web.WebSite.DeleteVirtualDirectory" AssemblyFile="Microsoft.Sdc.Tasks.dll" /> 
<ItemGroup> 
    <!--list of ouput files, excluding .DLL outside bin and some other files--> 
        <VS2003OutputFiles 
            Include="$(VS2003LocalFolder)**\*.*" 
            Exclude="$(VS2003LocalFolder)**\*.vb;$(VS2003LocalFolder)**\*.cs;$(VS2003LocalFolder)**\*.resx;$(VS2003LocalFolder)**\*.vspscc;$(VS2003LocalFolder)**\*.csproj;$(VS2003LocalFolder)**\*.vbproj;$(VS2003LocalFolder)**\*.scc;$(VS2003LocalFolder)**\*.webinfo;$(VS2003LocalFolder)**\*.snk;$(VS2003LocalFolder)**\*.dll;$(VS2003LocalFolder)**\*.exe;" />
    <!-- copy dll to bin folder -->
        <VS2003OutputBinFiles 
        Include="$(VS2003LocalFolder)bin\*.dll"/> 
</ItemGroup> 
<Target Name="AfterCompile"> 
<Message Text="Deleting cache file" /> 
    <Microsoft.Build.Tasks.Delete 
        Condition="Exists('$(VS2003CacheFile)')" 
        Files="$(VS2003CacheFile)" /> 
    <Message Text="Creating virtual folder $(VS2003VirtualFolder) in IIS in local path $(VS2003LocalFolder)" /> 
    <Web.WebSite.CreateVirtualDirectory 
        VirtualDirectoryName="$(VS2003VirtualFolder)" 
        Path="$(VS2003LocalFolder)" 
        WebSiteName="$(VS2003WebSiteName)" /> 
    <Message Text="Compiling $(VS2003Project) in $(VS2003Branch)" /> 
    <Exec 
        Command="&quot;$(VS2003Devenv)&quot; &quot;$(VS2003SolutionPath)&quot; /build $(VS2003Configuration) /out &quot;$(VS2003LocalFolder)$(VS2003Project).log&quot; "/> 
    <Message Text="Eliminando la carpeta virtual $(VS2003VirtualFolder) en IIS" /> 
    <Web.WebSite.DeleteVirtualDirectory 
        WebSiteName="$(VS2003WebSiteName)" 
        VirtualDirectoryName="$(VS2003VirtualFolder)" /> 
    <MakeDir Condition="!Exists('$(VS2003Output)')" Directories="$(VS2003Output)" /> 
    <Message Text="Copying output files @(VS2003OutputFiles)" /> 
    <Copy 
        SourceFiles="@(VS2003OutputFiles)" 
        DestinationFiles="@(VS2003OutputFiles->'$(VS2003Output)%(RecursiveDir)%(Filename)%(Extension)')" 
    /> 
    <MakeDir Condition="!Exists('$(VS2003Output)bin\')" Directories="$(VS2003Output)bin\" /> 
    <Message Text="Copying DLL to bin folder @(VS2003OutputBinFiles)" /> 
    <Copy 
        SourceFiles="@(VS2003OutputBinFiles)" 
        DestinationFiles="@(VS2003OutputBinFiles->'$(VS2003Output)bin\%(Filename)%(Extension)')" 
    /> 
    <OnError ExecuteTargets="VS2003Fail" />
</Target>
    <Target Name="VS2003Fail"> 
<Message Text="Copying log file $(VS2003RelativePath)$(VS2003Project).log" /> 
    <Copy Condition="Exists('$(VS2003RelativePath)$(VS2003Project).log')" SourceFiles="$(VS2003RelativePath)$(VS2003Project).log" DestinationFolder="$(DropLocation)\$(BuildNumber)" /> 
    <CallTarget ContinueOnError ="true" Targets ="CreateWorkItemWhenPartialSucceed" /> 
</Target> 
<Target 
        Name="CreateWorkItemWhenPartialSucceed" 
        Condition=" '$(SkipWorkItemCreation)'!='true' and '$(IsDesktopBuild)'!='true' "> 
        <Message Text="ejecutando work" /> 
        <PropertyGroup> 
            <WorkItemTitle>$(WorkItemTitle) $(BuildNumber)</WorkItemTitle> 
            <BuildLogText>$(BuildlogText) &lt;ahref='file:///$(DropLocation)\$(BuildNumber)\BuildLog.txt'&gt;$(DropLocation)\$(BuildNumber)\BuildLog.txt&lt;/a &gt;.</BuildLogText> 
            <ErrorWarningLogText     Condition="!Exists('$(MSBuildProjectDirectory)\ErrorsWarningsLog.txt')"></ErrorWarningLogText> 
        <ErrorWarningLogText Condition="Exists('$(MSBuildProjectDirectory)\ErrorsWarningsLog.txt')">$(ErrorWarningLogText) &lt;a href='file:///$(DropLocation)\$(BuildNumber)\ErrorsWarningsLog.txt'&gt;$(DropLocation)\$(BuildNumber)\ErrorsWarningsLog.txt&lt;/a &gt;.</ErrorWarningLogText> 
        <WorkItemDescription>$(DescriptionText) %3CBR%2F%3E $(BuildlogText) %3CBR%2F%3E $(ErrorWarningLogText)</WorkItemDescription> 
    </PropertyGroup> 
        <CreateNewWorkItem 
        TeamFoundationServerUrl="$(TeamFoundationServerUrl)" 
  BuildUri="$(BuildUri)" 
  BuildNumber="$(BuildNumber)" 
  Description="$(WorkItemDescription)" 
  TeamProject="$(TeamProject)" 
  Title="$(WorkItemTitle)" 
  WorkItemFieldValues="$(WorkItemFieldValues)" 
  WorkItemType="$(WorkItemType)" 
  ContinueOnError="true" /> 
</Target> 
```

当我在日志中看到此消息的输出时

```
<Message Text="Copying DLL to bin folder @(VS2003OutputBinFiles)" /> 
```

第一次我只看到一个文件的名称，第二次它打印所有正确的文件，同样的情况发生在 ASP 网站上，如果我添加一个文件，我会在第二次构建的输出中看到该文件。

我希望你能帮助我解决这个问题，非常感谢。

胡安·扎穆迪奥

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T06:40:16.513

这是 [OsirisJakob在 tfs 论坛上的答案](http://social.msdn.microsoft.com/Forums/en-US/tfsbuild/thread/1d60b52f-3080-4331-bc74-00b2ddd3348c)

问题是您在根级别定义项目组。这意味着在加载项目文件时会立即评估它们。您想要的是在执行 AfterCompile 目标时对它们进行评估。

由于您正在运行 TFS 2008，您可以通过将项目组移动到 AfterCompile 目标（也称为动态项目组）来解决此问题。这将导致在 AfterCompile 目标执行时评估项目组，并为您提供正确的结果。

# java - 如何防止 Hibernate 修剪字符串？

> ID：620041
> 
> 赞同：3
> 
> 时间：2009-03-06T19:07:53.487
> 
> 标签：java, oracle, hibernate

我正在使用 Oracle 10g 和 Hibernate 2.1（旧版本，但不允许升级修复）。我有一个表，其中包含一个不可为空的列，名为 TIN，varchar2(9)。此列用于暂存从平面文件加载的数据，因此可以存储长度为 9 的任何字符串，如果输入文件有 9 个空格，则包括 9 个空格（即：''）。

我注意到的是：

1.  Oracle 10g 自动将空字符串转换为 NULL。所以如果你执行：

    ```
    SELECT NVL('', 'Input string converted to NULL') FROM dual; 
    ```

    结果是“输入字符串转换为 NULL”，而不是“”。我认为这与问题有关。

2.  当 Hibernate 读取 TIN 值为 9 个空格（或任意数量的空格）且没有其他字符的记录时，它会将值作为 '' 存储在内存中。然后，Hibernate 似乎自欺欺人地认为，可以说，该值已从 9 个空格变为空字符串。然后，如果将记录写回数据库，Hibernate 会尝试写入一个空字符串而不是 9 个空格，Oracle 显然会将其转换为 null，然后引发非空约束违规。

作为参考，这里是本专栏的 HBM：

```
<property
    name="tin"
    type="java.lang.String"
    column="TIN"
    not-null="true"
    length="9"> 
```

我的问题是，如何指示 Hibernate 不要将仅包含空格的值转换为空字符串？

更新1：我刚回去测试了像'text'这样的字符串，发现Hibernate也修剪了这些空格，使字符串'text'并自欺欺人地认为值改变了。我肯定错过了什么。这似乎不是默认行为。

更新 2：看起来将 HBM​​ 转换为 Java 源的 hbm2java Ant 任务可能是字符串修剪的源。还在调查。

谢谢，杰夫

编辑：将问题措辞更改为更准确。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T19:49:23.513

处理这个问题的一种方法是[创建一个 Hibernate UserType](http://www.hibernate.org/169.html)。hibernate.org 的链接中有一些说明，其中包含一些已经制作的字符串转义类。我意识到这并没有直接回答“我如何告诉休眠不要将 9 个空格转换为空字符串”，但它会解决数据库端的存储问题。

该页面上有 2 个实现 - 一个转义所有字符串（可能以您想要的方式处理您的 9 个空格大小写），一个只转义值 ''。听起来前者可能更适合你。

作为记录 - 我自己正在使用这种方法。您需要做的就是在您的类路径中添加该类，并将 HBM​​.xml 中的 'type' 属性设置为完全限定的类名（即，将 type="my.fully.qualified.HibernateUserType" 添加到您的属性元素）。

在 Java 方面，您的类仍将直接处理 java.lang.String 和您希望看到的值，但在休眠方面，它们将使用 UserType 类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T21:22:22.730

原来问题不在于 Hibernate。我正在处理的项目设置为使用 hbm2java Ant 任务从 HBM 文件生成 Java POJO。这反过来又引用了 getters/setters/equals/toString/etc 的源模板，该模板被编写用于修剪 setter 中的所有 java.lang.String 属性。为了解决这个问题，我钝化了我遇到问题的一个类，这样它就不再在每个构建中生成，然后删除了 TIN 属性上的修剪。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T19:33:00.993

我不知道冬眠。但我确实知道 Oracle 确实将空字符串视为 Null 值。并且没有任何解决方法。

# jquery - 使用 jquery 的多个可排序列表

> ID：620043
> 
> 赞同：1
> 
> 时间：2009-03-06T19:08:27.027
> 
> 标签：jquery, sorting

我正在为我的一个项目构建一个待办事项列表应用程序，并且我正在从数据库动态创建多个待办事项列表，每个待办事项列表将有多个待办事项。这些项目将被限制在它们自己的列表中，并且无法连接到另一个列表。

我之前在 jquery 中完成了一个可排序的列表，但是我很难思考如何编写 DRY 代码，所以我不会为用户创建的每个新的待办事项列表重复自己。由于 jquery 代码必须弄清楚有多少个待办事项列表，然后管理每个列表。

任何人都知道如何去做，或者你可以用一些伪代码或例子来讨论它会很棒。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T19:45:10.903

使用 jQuery[可排序](http://docs.jquery.com/UI/Sortable)插件和做类似的事情有什么问题

```
$(document).ready(){
    $('ol, ul').sortable(); //make every ordered and unordered list sortable
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-21T18:57:39.160

其他两个选项（通常）：

1.  按 id 创建可排序组：

    ```
    $("#list1, #list2, #list3").sortable({ connectWith: "#list1, #list2, #list3" }); 
    ```

2.  按类创建可排序组：

    ```
    $("#list1, #list2, #list3").sortable({ connectWith: ".transfer" }); 
    ```

    （`.transfer`是类，只需将其分配给您的 html 中的所有列表。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T19:22:26.073

要在 jQuery 中保持 DRY，您需要[编写插件](http://docs.jquery.com/Plugins/Authoring)，或者使用现有的插件，例如[Tablesorter](http://tablesorter.com/docs/)。

# apache-flex - 如何在flex中重构花括号内的代码

> ID：620045
> 
> 赞同：1
> 
> 时间：2009-03-06T19:09:27.057
> 
> 标签：apache-flex, actionscript

[ActionScript 中的数据绑定](http://livedocs.adobe.com/flex/201/html/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Book_Parts&file=databinding_091_03.html)非常酷。但是，如果我想将大括号内的大 switch 或 if 语句重构为函数怎么办，例如：

```
{person.gender == '男性' ? '先生。' ： '小姐。'}

```

进入：

```
{称呼（人）}

```

编译器不允许我这样做。我知道属性，我可以在 person 对象上编写 getter 和 setter。但是由于我现在使用的是内联 JSON 对象，所以不方便（我认为）。重构此代码的其他好方法是什么？

回答马特的评论。person 的数据类型就是普通的 Object。它是从来自服务调用的 JSON 格式解码的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T20:05:59.840

您需要使 Person 类（假设您有一个）可绑定才能使其工作。

但是，由于您说您使用的是 JSON 对象，我假设您只有从 JSON 字符串解析的匿名对象。在那种情况下，我很确定那是行不通的。您需要创建一个具有可绑定属性的强类型对象。

仅供参考：为了避免为您要创建的每个对象编写自定义 JSON 解析器，您可以使用 bytearray 技巧从 vanilla 对象创建强类型对象：

```
public static function toInstance( object:Object, clazz:Class ):* {
  var bytes:ByteArray = new ByteArray();
  bytes.objectEncoding = ObjectEncoding.AMF0;

  // Find the objects and byetArray.writeObject them, adding in the
  // class configuration variable name -- essentially, we're constructing
  // and AMF packet here that contains the class information so that
  // we can simplly byteArray.readObject the sucker for the translation

  // Write out the bytes of the original object
  var objBytes:ByteArray = new ByteArray();
  objBytes.objectEncoding = ObjectEncoding.AMF0;
  objBytes.writeObject( object );

  // Register all of the classes so they can be decoded via AMF
  var typeInfo:XML = describeType( clazz );
  var fullyQualifiedName:String = typeInfo.@name.toString().replace( /::/, "." );
  registerClassAlias( fullyQualifiedName, clazz );

  // Write the new object information starting with the class information
  var len:int = fullyQualifiedName.length;
  bytes.writeByte( 0x10 );  // 0x10 is AMF0 for "typed object (class instance)"
  bytes.writeUTF( fullyQualifiedName );
  // After the class name is set up, write the rest of the object
  bytes.writeBytes( objBytes, 1 );

  // Read in the object with the class property added and return that
  bytes.position = 0;

  // This generates some ReferenceErrors of the object being passed in
  // has properties that aren't in the class instance, and generates TypeErrors
  // when property values cannot be converted to correct values (such as false
  // being the value, when it needs to be a Date instead).  However, these
  // errors are not thrown at runtime (and only appear in trace ouput when
  // debugging), so a try/catch block isn't necessary.  I'm not sure if this
  // classifies as a bug or not... but I wanted to explain why if you debug
  // you might seem some TypeError or ReferenceError items appear.
  var result:* = bytes.readObject();
  return result;
} 
```

# c# - .NET 和数据库层

> ID：620046
> 
> 赞同：10
> 
> 时间：2009-03-06T19:09:31.533
> 
> 标签：c#, database, linq-to-sql, entity-framework

当我上次从事编程工作时，我们正试图从`DataReaders`传统的 ADO.NET API 转向对象关系映射 (ORM)。

为此，我们`DataContext`通过`sqlmetal`. 然后有一个瘦数据层，`DataContext` `private`任何需要访问数据库的代码都必须使用`public`这个瘦数据层中的方法。这些方法基本上是存储过程；他们将通过 LINQ to SQL 对数据库执行查询。

这是当今常见的方法吗？我的意思是，每个使用 .NET 3.5 框架的人是否真的在他们的构建过程中运行 sqlmetal，还是什么？这在当时几乎看起来像是一个黑客。

基本上，我想知道如果我今天要在不使用第三方开源 ORM 的 .NET 3.5 商店编写 DAL，那么 LINQ to SQL 和 sqlmetal 是否是预期的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T19:16:41.127

拥有某种数据访问层仍然被认为是最佳实践。这是否最好通过 ORM 实现是一个备受争议的问题。有一个派系通常认为 ORM 是要走的路。另一派认为，以存储过程和数据库为中心是最好的路线。

此外，这可能不是您想要的海报，但它很相似（也是我隔间里的那个）

[http://download.microsoft.com/download/4/a/3/4a3c7c55-84ab-4588-84a4-f96424a7d82d/NET35_Namespaces_Poster_LORES.pdf](http://download.microsoft.com/download/4/a/3/4a3c7c55-84ab-4588-84a4-f96424a7d82d/NET35_Namespaces_Poster_LORES.pdf)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T19:15:54.500

我认为这取决于您的使用，但我会说您解释的如此薄的数据层将是您的 DAL。大多数项目将在此之上构建另一层，主要用于编辑/创建逻辑，也许还有一些用于获取的拼接逻辑。

对于我的大多数项目，我都是这样设计的。

Repository 保存 DataContext 的实例并公开一些基本的添加/删除方法
ProductRepository ：Repository 公开一般查询 (IQueryable)
StoreService 使用不同存储库的实例，如 ProductRepository、SalesRepository 并处理用于创建产品之类的所有逻辑。

所以像...

```
StoreService.CreateProduct(/* properites */) 
```

这将返回某种结果类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T19:24:18.427

你的方法很好。我目前使用 Astroria 服务（[ADO.NET 数据服务](http://msdn.microsoft.com/en-us/data/bb931106.aspx)）。[MSDN 杂志](http://msdn.microsoft.com/en-us/magazine/cc748663.aspx)对此有很好的介绍。

我也喜欢新的[PLINQO](http://code.google.com/p/codesmith/)（虽然需要[CodeSmith 工具](http://www.codesmithtools.com/)）。在我看来，这非常巧妙。

当我有这样的 DAL（服务层）时，我只是从我的客户端应用程序（Silverlight 或 ASP.NET MVC）中使用此服务。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-29T17:52:52.490

最好的数据层是简单明了的数据层，可以在没有任何花哨的情况下完成工作。我已经使用了你提到的技术，并在这里写过： [数据访问的唯一模式是 - 数据访问没有模式](http://www.adnanahmad.net/2009/06/only-pattern-for-data-access-is-there.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T19:18:12.870

这个站点使用 LINQ to SQL，因此请随意使用。

正式地，微软在新开发方面支持 LINQ to SQL 上的[实体框架。](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx?ppud=4)然而，有一群人认为[EF 是错误的方式](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)。LINQ to SQL 仍将存在一段时间，并且是一个非常不错的 ORM，如果在您可以使用的 DB 后端方面有所限制的话。

我会推荐 LINQ 作为 ORM 的一个很好的起点。如果您需要更好的，请查看 EF 和/或[NHibernate](http://www.nhibernate.org/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T21:13:57.523

“今天这是一种常见的方法吗？我的意思是，每个使用 .NET 3.5 框架的人是否真的在他们的构建过程中运行 sqlmetal，还是什么？”

我认识的使用 3.5 框架的人（几乎所有人）——绝大多数人——仍在使用 NHibernate。2.0 版是一个非常好的 OR/M。我开始在最近的一个项目中使用它，它大大减少了我的数据访问代码，以至于我以后真的不想使用其他任何东西。Fluent NHibernate API 正在为不喜欢 XML 映射的人们取得一些进展。

# asp.net - 在后面的 webform 代码中查找本地声明的过程和方法 (GetMethods)

> ID：620048
> 
> 赞同：0
> 
> 时间：2009-03-06T19:10:08.520
> 
> 标签：asp.net, vb.net

我正在尝试使用 GetMethods 在 Webform 代码中获取本地声明的方法的子集，但无法找出正确的 BindingFlags 设置（请参见下面的代码）......以及一些更具体的问题：

1）是否可以区分过程和功能？
2）此外，我只想获取其中的某个子集....有没有什么方法可以用属性装饰我想要的那些，然后根据它进一步过滤？

```
Private Sub LoadFunctions()
        Dim thisClass As Type = Me.GetType
        For Each method As MethodInfo In thisClass.GetMethods(BindingFlags.Instance Or BindingFlags.Public Or BindingFlags.DeclaredOnly)
            If method.Name.Substring(0, 3) = "Get" Then
                Me.ddlCodeSamples.Items.Add(method.Name)
            End If
        Next
    End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T23:54:00.070

a）问题的真正根源似乎是反映在错误的课程中......从网络表单中，您必须这样做：

```
Dim thisClass As Type = GetType(yourWebFormName) 
```

...*不是*：

```
Dim thisClass As Type = Me.GetType 
```

b）我认为`method.ReturnType`可以检查以区分程序或方法。

c)[以下](http://www.codeguru.com/vb/gen/vb_general/attributes/article.php/c6073)是如何使用自定义属性：

或多或少的工作代码：

```
Private Sub LoadFunctions()
        '....When run from a webform that you want to reflect on the locally defined functions:
        ' This is *incorrect*:
        '   Dim thisClass As Type = Me.GetType
        ' This is *correct* (I'm not sure why though):
        Dim thisClass As Type = GetType(CodeSamples)    '<-- "CodeSamples" is the webform name
        For Each method As MethodInfo In thisClass.GetMethods(BindingFlags.Public Or BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.DeclaredOnly)
            If Not method.IsSpecialName Then    '<-- to exclude property getter/setters, etc
                ' Rather than filtering on function name, could use custom attributes as discussed here:  
                '        http://www.codeguru.com/vb/gen/vb_general/attributes/article.php/c6073
                If method.Name.Substring(0, 3) = "Get" Then
                    Me.ddlCodeSamples.Items.Add(method.Name)
                End If
            End If
        Next
    End Sub 
```

# ruby-on-rails - 如何以不同的方式对字符串列进行排序

> ID：620049
> 
> 赞同：1
> 
> 时间：2009-03-06T19:10:13.840
> 
> 标签：ruby-on-rails, ruby

我有一个这样的 has_many 关联：

```
has_many  :respostas_matriz_alternativas, :class_name => 'RespostaMatrizAlternativa',
          :order => 'respostas_matriz.codigo asc',
          :include => :resposta_matriz 
```

那么重要的片段是“顺序”。Codigo 是一个 varchar 列，在大多数情况下将包含数值。为了显示这些数据，我需要通过代码对其进行排序，但是当我只有数字时，顺序会变得很尴尬，例如：

1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 2, 20, ...

你有什么建议让我解决它？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T19:17:36.133

我不知道如果列将包含字符串和数字的混合，你可以做很多事情，但如果列总是数字，你可以使用类似的东西：

```
:order => 'cast(respostas_matriz.codigo as unsigned) asc' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-11-09T16:12:42.743

接受的答案适用于 SQLite 但不适用于 PostgreSQL，我必须使用其中一种内置类型才能在不同的数据库中获得相同的结果：

```
order: 'cast(respostas_matriz.codigo as integer) asc' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T00:49:11.607

我只是一个 Ruby 的初学者，但你可以使用类似下面的方法将字符串拆分为一个较小的字符串数组，然后将每个字符串转换为一个整数。

我面前没有我的 ruby​​doc，但是像

```
:order => 'respostas_matriz.codigo.split.map {|s| s.to_i}' 
```

# iphone - iPhone Gameloop 从一个单独的线程渲染更新

> ID：620055
> 
> 赞同：2
> 
> 时间：2009-03-06T19:12:03.323
> 
> 标签：iphone, multithreading, game-loop

我是 iPhone 开发的新手。我有一个游戏循环设置如下。

```
(void)CreateGameTick:(NSTimeInterval) in_time
{
  [NSThread detachNewThreadSelector:@selector(GameTick) toTarget:self withObject:nil];
} 
```

我的基本游戏滴答/渲染看起来像这样

```
(void)GameTick
{
  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];

  CGRect wrect = [self bounds];

  while( m_running )
  {
    [self drawRect: wrect];
  }

  [pool release];       
} 
```

我的渲染函数被调用。然而，什么都没有被绘制（我正在使用 Core Graphics 在派生的 UIView 上绘制一些线条）。

如果我通过计时器调用我的更新，那么一切都很好。

你能告诉我为什么通过线程完成渲染会失败吗？是否有可能通过线程使其工作？

谢谢丰富

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T19:32:05.053

你不能（好吧，不应该）直接调用 -drawRect: 。相反，使用 -setNeedsDisplay; 然后您的视图将在下次通过事件循环更新。如果你在一个单独的线程中运行它，你可能需要使用 performSelectorOnMainThread:。

# jquery - 使用 JQUERY 检测 tinyMCE 文本区域

> ID：620065
> 
> 赞同：2
> 
> 时间：2009-03-06T19:16:53.840
> 
> 标签：jquery, tinymce

在我们的一些表单中，我们将 textareas 转换为 tinyMCE textareas。如何在 jquery 中判断给定的 textarea 是否已被转换？

我注意到 tinyMCE 会在初始化时将我的原始 textarea 的显示更改为 none，然后使用 mceEditor 类创建一个相邻的跨度，但是下面的 jquery 语句似乎永远找不到它。

if ( $(formElm).siblings("span .mceEditor").size() > 0) { ...do this};

或者

if( $(formElm).parent().find("span .mceEditor").length > 0 ) {...do this};

或者

if( $(formElm).parent().children("span .mceEditor").size() > 0 ) {...do this};

[编辑]

在tinymce 完成后，有人要求textarea 是什么样子。开始

```
<td class="fields">
<textarea id="serviceDesc" class="form req blob" style="display: none;"> Warm and yummy in your tummy<br /></textarea>
<span id="serviceDesc_parent" class="mceEditor defaultSkin">
<table id="serviceDesc_tbl" class="mceLayout" cellspacing="0" cellpadding="0" style="width: 400px; height: 152px;">
<tbody>
<tr class="mceFirst">
<td class="mceIframeContainer mceFirst mceLast">
<iframe id="serviceDesc_ifr" frameborder="0" src="javascript:""" style="width: 100%; height: 129px;">
<html>
</html>
</iframe>
</td>
</tr>
<tr class="mceLast">
</tr>
</tbody> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T19:22:14.670

快速提示：*可能*是您在 span 之后（在选择器中）放置了一个空格，这使得 jQuery 在 span 中查找具有名为“mceEditor”的类的元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T19:25:49.170

$('span.mceEditor+textarea:hidden') 会这样做吗？这假设“相邻”是指 mceEditor 跨度紧接在文本区域之前（ala FCKeditor）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-17T13:41:34.070

将与`if ( $(formElm + ' span.mceEditor').size() > 0) { ...do this};`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-17T19:50:40.000

我尝试了以下方法并且它有效，如果我想检查一个带有 id 'tmce' 的 textarea，那么我将 '_parent' 附加到它并因此对其进行了测试：

```
if( $("#tmce_parent").size() )
{
//code in case of a textarea with tinymce
} 
```

# c# - 如果 silverlight 不存在，则自定义行为

> ID：620071
> 
> 赞同：1
> 
> 时间：2009-03-06T19:17:53.980
> 
> 标签：c#, .net, silverlight

在 aspx 页面上使用 Silverlight 控件 (asp:Silverlight)，如果 silverlight 不存在，有没有办法自定义行为？如果客户端上不存在 silverlight，我想显示一个包含图像的表格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T04:08:52.953

[Tim Heuer](http://timheuer.com/blog/)写了很多关于这方面的信息。这是直接来自他的博客的要点：

```
 <asp:Silverlight ID="Xaml1" runat="server"
     Source="~/ClientBin_SilverlightApplication1.xap" 
                 MinimumVersion="2.0.30523" Width="100%" Height="100%">
             <PluginNotInstalledTemplate>

             Your Content goes here.

             </PluginNotInstalledTemplate>
        </asp:Silverlight> 
```

这是原始博客文章
[http://timheuer.com/blog/archive/2008/03/25/creating-a-great-silverlight-deployment-experience.aspx](http://timheuer.com/blog/archive/2008/03/25/creating-a-great-silverlight-deployment-experience.aspx)

还有几个跟进
[http://timheuer.com/blog/archive/2008/09/08/silverlight-install-experience-too-hard.aspx](http://timheuer.com/blog/archive/2008/09/08/silverlight-install-experience-too-hard.aspx) [http://timheuer.com/blog/archive/2008/12/ 02/silverlight-install-experience-best-practices-netflix.aspx](http://timheuer.com/blog/archive/2008/12/02/silverlight-install-experience-best-practices-netflix.aspx)

而且，为了您的观看乐趣
[http://silverlight.net/learn/learnvideo.aspx?video=57016](http://silverlight.net/learn/learnvideo.aspx?video=57016)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:21:54.343

asp:Silverlight 服务器控件只是呈现一些客户端脚本来为 Silverlight 创建主机/接收器，您可以自己测试它，但您必须使用 JavaScript 执行此操作。asp:Silverlight 控件可能支持这一点，但我认为您必须自己编写一些东西。在这种情况下，请查看如何在浏览器中创建 Silverlight 主机，您将在那里找到答案。

您的困境是 asp:Silverlight 服务器控件在任何客户端代码之前运行。您可能必须编写一些自定义 JavaScript 来处理这个问题，除非您有可靠的 User-Agent 字符串，否则不可能让服务器采取行动，这不太可能。

# entity-framework - 如何摆脱“一个实体对象不能被多个 IEntityChangeTracker 实例引用”？

> ID：620084
> 
> 赞同：15
> 
> 时间：2009-03-06T19:23:31.313
> 
> 标签：entity-framework

我在 Ado.Net EF 中有一个模型。我有一个一对多的关系，当我想添加实体时出现错误

“一个实体对象不能被多个 IEntityChangeTracker 实例引用”

有什么线索吗？

类似的东西

```
Template template = new Template();
...
...
while (from < to)
{
    Course course = new Course();
    .....
    template.Course.Add(course);
    .....
}
courseEntities.AddToTemplate(template); // Problem line
courseEntities.SaveChanges(); 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-06T21:20:35.480

在我开始将数据上下文存储在[HttpContext.Items](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items(VS.80).aspx)属性中之前，我收到了这条消息。这意味着您可以对当前的 Web 请求使用相同的数据上下文。这样你就不会得到两个引用相同实体的数据上下文。

这是一篇关于[DataContext Life Management](http://www.west-wind.com/weblog/posts/246222.aspx)的好帖子。

我希望它有所帮助。

戴夫

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T19:41:58.773

“模板”，或者它引用的东西，已经被添加到 courseEntities*或*其他上下文中。我在您展示的代码中看不到任何内容，但它肯定正在发生。也许它发生在您修剪的某些代码中。在调试器中查看“template”的EntityState属性，同时查看“template”属性的EntityState。这应该可以帮助您找出哪个实体实例已经在上下文中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T19:48:05.577

我已经意识到问题所在。我有另一个关系，我从另一个上下文中得到另一个实体。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T18:40:13.933

让我将我的经验与这个令人讨厌的错误联系起来，并指出追逐它的地形将带你超越导致一个非常简单的解决方案。

CompanyGroup 非常简单。它有一个名称，并且有一个 Company 对象。

我从这个开始：

```
1        public static void Add(CompanyGroup item)
2        {
3            try
4            {
5                using (Entities scope = new Entities())
6                {
7             scope.AddToCompanyGroup(item);
8                       scope.SaveChanges();
9                }
10            }
11            catch (Exception ex)
12            {
13                LogException(ex, item);
14                throw;
15            }     
16  } 
```

并得到这个错误：

> {“一个实体对象不能被多个 IEntityChangeTracker 实例引用。”}

所以，我在第 6 行和第 7 行之间添加了这个：

```
 (IEntityWithChangeTracker)item).SetChangeTracker(null); 
```

这奖励了我：

> {“无法将对象添加到 ObjectStateManager，因为它已经具有 EntityKey。使用 ObjectContext.Attach 附加具有现有键的对象。”}

所以我改变了

```
scope.AddToCompanyGroup(item); 
```

到

```
scope.Attach(item); 
```

现在它抱怨：

> {“具有临时 EntityKey 值的对象不能附加到对象上下文。”}

（开始听起来像我年轻时约会过的一些女孩——从不满足——但我离题了）

所以我将实体键设为空（不起作用）并使用该方法创建新的（也不起作用）

一路上，我也遇到了这个错误：

> {“当相关对象处于添加状态或分离状态并且最初未使用 NoTracking 合并选项检索时，无法返回此 EntityCollection 或 EntityReference 的源查询。”}

解决方案？

将核心，第 7 行和第 8 行替换为：

```
 CompanyGroup newcg = new CompanyGroup();
                newcg.GroupName = item.GroupName;
                newcg.Company = scope.Company.Where(c => c.CompanyID == item.Company.CompanyID).First();

      scope.AddToCompanyGroup(newcg);
                scope.SaveChanges(); 
```

本质上，我将通过“item”传递的数据移动到新创建的对象中，该对象的类型与 Add 中使用的对象具有相同的范围。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-11T12:10:29.623

我希望这是最简单和正确的解决方案。每个 httprequest 需要一个数据库上下文。

EF4 Code First 模板 Global.asax.cs [http://gist.github.com/574505](http://gist.github.com/574505)

```
void MvcApplication_BeginRequest(object sender, EventArgs e)
{
 HttpContext.Current.Items[SessionKey] = new Db();
}

void MvcApplication_EndRequest(object sender, EventArgs e)
{
 var disposable = HttpContext.Current.Items[SessionKey] as IDisposable;
 if (disposable != null)
  disposable.Dispose();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-18T14:26:24.143

通过从我更新的对象中删除与其他实体（虚拟）的额外关系，我解决了这个问题。只留下他们的身份证。

这是错误的代码

```
dataFileEntity.IterParameterValue = parameterValueEntity.ParameterValue;
dataFileEntity.IterParameterValueId = parameterValueEntity.ParameterValue.Id;
dataFileEntity.ResultParameter = parameterValueEntity.ResultParameter;
dataFileEntity.ResultParameterId = parameterValueEntity.ResultParameter.Id;
dataFileEntity.RawDataResult = result.Value; 
```

这是对的

```
dataFileEntity.IterParameterValueId = parameterValueEntity.ParameterValue.Id;
dataFileEntity.ResultParameterId = parameterValueEntity.ResultParameter.Id;
dataFileEntity.RawDataResult = result.Value;
RequestTestRawDataFileRepository.AddOrUpdate(dataFileEntity); 
```

Я эту проблему решила, убрав из объекта, который я апдейтила лишние связи с другими сущностями（虚拟）。Оставила только их id。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-11T10:41:54.027

请仅初始化一次您的实体。

就像

如果您不止一次初始化您的实体。

你会得到错误：

> 一个实体对象不能被多个 IEntityChangeTracker 实例引用。

前任：

```
public class Test

{

 private Entities db=new Entities();

 public static void Add(CompanyGroup item)
    {
        try
        {

         db.CompanyGroup.Add(item);
         db.SaveChanges();

        }
        catch (Exception ex)
        {
        }     
    }   
} 
```

# javascript - 我正在为自己编写的库的简单易用的 AJAX 功能；这足够了吗？

> ID：620085
> 
> 赞同：0
> 
> 时间：2009-03-06T19:23:38.427
> 
> 标签：javascript, ajax

首先，有问题的代码：

```
ajax = function(url, cb)
 {
    xhr = (window.XMLHttpRequest)
        ? new XMLHttpRequest()
        : new ActiveXObject('Microsoft.XMLHTTP');
    xhr.onreadystatechange = function()
     {
        if (xhr.readyState == 4 && xhr.status == 200)
         {
            cb(xhr.responseText);
         };
     } 
    xhr.open('get', url, true);
    xhr.send();
 }; 
```

现在，我知道我可以轻松地选择一个库解决方案，但目前我正在尝试整合一个更轻量级的库供个人使用；这个功能是否缺少任何重要的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T19:37:47.190

That's pretty basic but looks complete without actually trying it. You might want to consider how you are going to handle errors. You might also want to make it where you could POST or set headers if needed. If, however, all you need is to call RESTful URLs to get your data, that should work.

# ruby-on-rails - 在 Ruby on Rails 中 AJAX 调用失败时重定向到 500 页

> ID：620091
> 
> 赞同：6
> 
> 时间：2009-03-06T19:24:55.850
> 
> 标签：ruby-on-rails, ruby, ajax, rjs

我正在使用一个在 Ruby on Rails 中构建的应用程序，现在的错误处理非常差。如果通过 ajax 执行控制器方法，并且该方法导致 500（或 404 或任何其他响应），则 500.html 页面将被呈现并作为 AJAX 请求的结果返回。显然，javascript 不知道如何处理该 HTML，并且网页看起来只是在等待响应。

在 AJAX 调用期间发生错误时，rails 中是否有一种简单的方法来呈现 error.rjs 模板？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T02:57:05.980

您可以在控制器的rescue_action 或rescue_action_in_public 方法中使用respond_to。考虑以下控制器：

```
class DefaultController < ApplicationController

  def index
    raise "FAIL"
  end

  def rescue_action(exception)
    respond_to do |format|
      format.html { render :text => "Rescued HTML" }
      format.js { render :action => "errors" }
    end
  end
end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T16:27:12.413

我通过授权解决了类似的问题。我用这个动作创建了一个简单的授权控制器：

```
 def unauthorizedxhr
    render :update do |page|
      page.replace_html("notice", :partial=>"unauthorizedxhr")
      page.show("notice")       
    end
  end 
```

这是模板：

```
<% if flash[:notice] -%>
    <div id="noticexhr"><%= flash[:notice] %></div>
<% end -%> 
```

当控制器中的授权失败时，我会在设置 flash[:notice] 值后重定向到 :controller=>"authorization", :action=>"unauthorizedxhr" 。这使我可以自定义发送给用户的消息，并通过上面的 render :update 代码处理消息的显示。

您可以通过创建一个错误控制器来适应您的问题，在其他控制器中捕获任何引发的错误，然后在调用失败时简单地重定向到 :controller=>"errors", :action=>"displayxhr" 。这样，您将标准化您的错误通信机制，但允许您自己通过每个操作自定义错误消息。

您仍然可以使用上面 cpm 的想法，但错误的显示将由单独且不同的控制器逻辑处理。这应该使它更容易维护。

希望有帮助。-克里斯

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:47:23.817

这是我的最终解决方案：

```
def rescue_action_in_public(exception)
  response_code = response_code_for_rescue(exception)
  status = interpret_status(response_code)
  respond_to do |format|
    format.html { render_optional_error_file response_code}
    format.js { render :update, :status => status  do |page| page.redirect_to(:url => error_page_url(status)) end}
  end
end 
```

无论请求是通过 AJAX 还是正常的 GET/POST，这基本上都会转发到正确的静态 HTML 页面。

这不用于正常的错误处理，如验证等。它仅在发生非常糟糕的事情时使用 - 例如未处理的异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-18T08:07:20.240

你可以像下面这样：

在 allpication.js 中

```
$(document).ready(function(){
    $(document).ajaxError( function(e, xhr, options){
    if("500" == xhr.status)
    {
       $(location).attr('href','/users/sign_in');
    }
  });
}) 
```

它为我工作......

# widget - “小工具”还是“小工具”？

> ID：620093
> 
> 赞同：1
> 
> 时间：2009-03-06T19:25:50.887
> 
> 标签：widget, semantics

这个问题是关于语义的。

我有一个客户说，“小部件”一词只应在指代将您自己的内容联合到第三方网站的动态对象时使用。我相信小部件可用于引用站点上的任何自包含动态对象（您自己的或第三方）。但是，我的客户说，如果该对象在您自己的站点上，它就是一个“小工具”。

我不确定是否有官方定义，但我很想知道对这两个术语之间的区别（如果有的话）的共同理解是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-06T19:29:47.820

如果您的客户想称其为小工具，请让他/她称其为小工具。它们具有相似的含义，都不是一个非常专业的术语，争论这一点是浪费时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T19:45:53.600

词典网：

> widg⋅et -名词
> 小型
> 机械装置，如旋钮或开关，特别是。姓名不详或无法回忆的人；gadget：仪表板上的一排小部件。
> 
> gadg⋅et -名词
> 机械
> 装置或装置；任何巧妙的文章。

“小部件”并不**意味着**“窗口小工具”。这些术语在已发表的文献中已经存在了 150 年（大约 85 个用于“小部件”），就编程而言，这取决于您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T19:36:15.463

“小部件”是指“窗口小工具”

就个人而言，我不太喜欢“小部件”这个词，尤其是在 GUI 库中。我仍在等待将提供“窗口”命名空间的库，其中声明了“小工具”类。

# asp.net - ASP.NET 中模式屏幕的最佳选择

> ID：620094
> 
> 赞同：4
> 
> 时间：2009-03-06T19:26:13.850
> 
> 标签：asp.net, jquery, modal-dialog

我正在寻找在另一个 ASP.NET 页面的 ASP.NET 中实现模式弹出窗口的最佳方法。我正在为 Firefox 2.x+ 编写代码并且可以使用 JQuery，但我对它不是很熟悉。

我看到很多使用“AJAX”的解决方案，但我不确定在什么情况下，所以我没有走那条路。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T19:27:45.593

我正在使用[jQuery UI](http://jqueryui.com/)对话框插件。效果很好。该插件的文档可以在[http://docs.jquery.com/UI](http://docs.jquery.com/UI)找到。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T19:39:37.843

I have used both the ajax modal extender as well as the jQuery jqModal, both have worked pretty well. At the end of the day, this decision should come down to what the rest of the code is like, what your comfort is with each, etc.

If I were to pick an option today, I would probably pick the jqModal or simple modal for jQuery. I'm pretty comfortable with these now.

*   [jqModal](http://dev.iceburg.net/jquery/jqModal)
*   [SimpleModal](http://www.ericmmartin.com/projects/simplemodal)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T22:44:56.180

对于简单的模态显示，我发现 BlockUI 是一个很好的解决方案。

例如，这里有一篇关于[使用 BlockUI 作为模态进度指示器](http://encosia.com/2008/10/04/using-jquery-to-enhance-aspnet-ajax-progress-indication/)的文章，还有一篇关于[使用 BlockUI 显示模态确认对话框的文章](http://encosia.com/2008/10/11/using-jquery-to-display-a-modal-updatepanel-confirmation/)。

如果您需要更复杂的东西，我会选择 jQueryUI 对话框。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T22:58:31.187

我自己制作，使用 DOM 方法。我发现它比将这些插件中的任何一个适应我们的 CSS 要简单得多。

模态框只是一个带有背景的绝对定位窗口。我们使用带有浮动内容的更大透明容器来制作我们的容器。

我使用一个函数返回一些带有浮动内容的 html。用于模态框的类应该绝对定位在高 z 层。

```
function create_modal(doc_id,css_class,append_to)
{
if(typeof append_to==='undefined'){append_to='content';}
var container=document.getElementById(append_to);
if(!container){return false;}
var modal_box=document.createElement('div');
container.appendChild(modal_box);
modal_box.id=doc_id;
modal_box.className=css_class;
return modal_box;
}

var modal_window=create_modal('modal_id','a_css_class');
if(!modal_window){return false;}
modal_window.innerHTML=function_or_var_providing_html(); 
```

所以，没有一些 10 或 15 k 插件，一切都很好，很简单！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T19:33:26.657

我用过[AjaxControlToolkit](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx)但@tvanfosson 建议的 jQuery 选项似乎好多了

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T19:35:14.513

You could use radWindow from Telerik, the jQuery UI Dialog plugin like tvanfosson recommended or you could take a look at

[http://vision-media.ca/resources/jquery/jquery-popup-plugin-review](http://vision-media.ca/resources/jquery/jquery-popup-plugin-review) which review some jQuery plugins for popups.

Having only expericence with radWindow, I can tell you that with radWindow, you might have to use some hacks and quirks to make it work properly, but the result is good if you put enough time into it.

# sql-server - 如何使用 ETL 管理身份？

> ID：620104
> 
> 赞同：1
> 
> 时间：2009-03-06T19:30:04.667
> 
> 标签：sql-server, database, etl

我需要帮助找出工作流程，但我不知道该怎么做......假设我正在将（ETL？）数据从表 A 转换到表 B。表 A 有一个复合主键 A.a+ A.b+Ac，而表 B 只有一个自动填充的标识列。如何将复合键从 A 映射回插入 B 时创建的标识？

最好我不希望表 B 中的任何列与 A 的复合键相关，因为有许多其他表需要进行相同的操作但没有相同的复合键结构。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T19:49:26.273

如果我理解正确，您不能在转换后将表 B 中的记录关联回表 A 的记录，除非您在转换过程中以某种方式捕获 A 的复合键和 B 的标识符之间的映射。

您可以向 A 添加一列并预先计算插入 B 时要使用的标识符。然后您将拥有一个映射。如果您不想向 A 添加列，这也可以使用单独的映射表来完成。

如果您不想覆盖标识符的默认分配，则必须在加载期间捕获它们。为此， Oracle在 PL/SQL 中提供了`returning`for 子句。`insert`我不确定 SQL Server。也可以通过在 B 上使用触发器插入单独的映射表或更新 A 中的列来完成此操作。尽管这可能会大大减慢您的负载。

如果不出意外，您可以在 B 中创建额外的列以在加载期间保存 A 的键，然后将映射查询到单独的表中，然后删除额外的列。

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:31:06.760

问问自己，您需要原始密钥的确切用途。答案可能因源系统而异。这可能会导致您维护“源系统”列和“原始源键”列。后者可能需要是原始键的逗号分隔列表。

或者，您可能会发现您实际上不需要映射回来，因此不需要保留任何东西。

# ruby-on-rails - 实施价格等级

> ID：620106
> 
> 赞同：-1
> 
> 时间：2009-03-06T19:31:09.097
> 
> 标签：ruby-on-rails, e-commerce

我很好奇是否有任何按功能划分 Web 应用程序的常见模式？一个例子是以多个价格层级销售。

我要问的是有一种通用的开发模式来划分应用程序中的功能

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:32:01.633

没有我知道的模式。实现您想要的一种方法是根据用户选择的价格等级赋予用户角色，然后对特定功能/视图进行角色检查。几乎就像一种访问控制列表，由他们购买的包控制。

# database - 全局应用程序中的个人姓名：存储什么

> ID：620118
> 
> 赞同：5
> 
> 时间：2009-03-06T19:34:32.020
> 
> 标签：database, localization

对于来自许多不同国家/地区的用户使用的应用程序，以结构化方式存储[个人姓名似乎相当困难。](http://en.wikipedia.org/wiki/Personal_name)我正在开发的应用程序理论上可以被世界上任何地方的任何人使用。

大多数情况下，似乎使用了一个[名字（名字/名字）](http://en.wikipedia.org/wiki/Given_name)和[姓氏。](http://en.wikipedia.org/wiki/Surname)在这种情况下，这两个可以简单地存储在用户数据库表中。

*   对于全局使用的应用程序，在用户表中存储“名字”和“姓氏”是否足够？请给出你的意见，并带有动机。
*   你有什么其他的建议？
*   有没有关于如何解决这个问题的好指南？

一些重要的事实：

*   用户之间的通信（他们居住在相同或不同的公司，可能在不同的国家）。
*   重要的是，按名称搜索用户对用户来说感觉很自然，并且人名的所有重要部分都是可搜索的。
*   如果在向另一个国家/地区的某人发送消息时，系统应该能够通过建议适当的问候来提供帮助，那就太好了。阿拉伯名字可能很难，至少从我读过的内容来看，因为它们似乎有一个复杂的结构。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T19:44:44.647

实际上并没有一种通用的结构化方法来做到这一点。我将有一个大字段用于“全名”，另一个字段用于“显示名称”。都是统一码。

例如，在西班牙语国家 IIRC，人们通常有四个名字。两个名字和两个姓氏（一个来自父亲，一个来自母亲）。阿拉伯人基本上有一个可以追溯到他们选择去的名字的链接列表（某某，某某之子，某某之子，......）。东亚国家倾向于把名字放在最后，而欧洲人把名字放在第一位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T20:50:38.670

如果您真的对跨文化走向全球感兴趣，请查看[Person 的 HR-XML 规范](http://ns.hr-xml.org/2_5/HR-XML-2_5/CPO/PersonName.html)。当您移出西方时，名字和姓氏并没有减少。FamilyName GivenName 的东方标准会让您在定义 FullName 时出错。此外，您还拥有替代脚本（不是每个人都使用拉丁字母，你知道）、前缀和后缀（NN Sr，van der Waals）的所有潜在复杂性。

这是一个用于传输和集成而不是存储的标准，但不要让 XML 模式语法吓到您。我不会实现它的所有方面，但它是一个出色的极端案例提供者，这些案例并不是立即显而易见的，然后你可以有意识地忽略它。特别是，请查看最后的示例！

看在上帝的份上，不要创建一个假定每个人都使用中间首字母的美国应用程序！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T22:27:05.570

通常，名称是一个人的可读标识符。对于给定的人，您需要为此类标识符的每个用例存储一个名称。您将需要一个姓名作为邮政地址的一部分显示；您可能需要一个用作“网名”；您可能需要在给对方的一封信的开头使用一个；您有时可能需要包含此人的头衔和荣誉，有时则不需要。

在任何这些情况下，您要显示的是单个字符串。通过存储这些字符串的组件并稍后将它们重新组合在一起，您可能会也可能不会避免重复工作。但总的来说，无论是从国家文化还是职业文化的角度来看，你最好只存储完整的字符串。

顺便说一句，同样的情况主要发生在邮政地址上，除了有国际标准允许一个国家的邮政当局向另一个国家的人发送邮件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-08T02:08:41.547

注意：不要同时要求“名字”和“姓氏”。

有些人，比如我，只有一个名字。

（证明：[http](http://saizai.com/dl_redacted_small.png) ://saizai.com/dl_redacted_small.png ）

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2021-12-26T11:49:11.780

W3 对这些东西有很好的参考 [https://www.w3.org/International/questions/qa-personal-names](https://www.w3.org/International/questions/qa-personal-names)。您可以阅读很多文化场景，也许最好的选择是选择全名以避免文化麻烦，但是在英语文化中，很多人习惯选择字段：名字和姓氏......如果您了解您的文化场景，您可以选择字段。

# authentication - Access control for static content served from S3?

> ID：620128
> 
> 赞同：3
> 
> 时间：2009-03-06T19:36:05.840
> 
> 标签：authentication, amazon-s3

I'm thinking about serving user-specific static content from S3 - the user needs to be authenticated in order to access his static content. So if user A has content c1, c2 and use B has c3, c4, only A should be able to access c1, c2 .

What's a good way to accomplish this? Is there a way to perform per-user / per file authentication in S3?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T12:50:47.617

1.  您可以使用预先授权的网址
2.  a) 您可以使用 ACL 列表并让每个用户登录 b) 分发列表的 ACL 也可以工作

对于预签名的 URL，这里有一些关于它的想法[http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1434](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1434)

对于 ACL 文档，您应该查看[http://docs.amazonwebservices.com/AmazonS3/latest/S3_ACLs.html](http://docs.amazonwebservices.com/AmazonS3/latest/S3_ACLs.html)

有一些图书馆可以为您做到这一点。这取决于您使用的是哪种语言。

# winforms - 使用 WebBrowser.DocumentText 设置文档时如何启用脚本

> ID：620132
> 
> 赞同：1
> 
> 时间：2009-03-06T19:37:05.197
> 
> 标签：winforms, webbrowser-control

我正在使用 Windows 窗体 WebBrowser 控件，并让它显示我动态创建并使用 DocumentText 属性设置的文档。我创建的文档引用了与我的可执行文件位于同一目录中的脚本文件。问题是，当 WebBrowser 控件显示页面时，脚本没有启用。

现在我知道 IE7 引入了一个新的安全功能，影响了这种情况。我记得必须在 IE 键下的注册表中某处设置 FEATURE_BLOCK_LMZ_SCRIPT 键，但我不知道确切的位置。有没有人有这方面的说明。

更好的是，有没有办法在不更改注册表的情况下启用我的场景？我真的不想为我的可执行文件提供安装程序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-04-08T19:43:43.837

请检查[Web 的标记](http://msdn.microsoft.com/en-us/library/ms537628%28v=vs.85%29.aspx)。
您需要标记您的“页面”。在**html**标签之后，输入：

```
<!-- saved from url=(0020)http://www.test.com/ --> 
```

0020是以下url的长度（包括/）

这确保您正在查看的页面将在 Internet 安全区域中运行，因此，除非另有设置，否则启用脚本。

# c# - 在 ASP.NET 2.0 中使用登录控件时将值或数据从一个页面传递到另一个页面

> ID：620134
> 
> 赞同：0
> 
> 时间：2009-03-06T19:37:35.023
> 
> 标签：c#, asp.net, asp.net-2.0

我在登录页面中使用 ASP.NET 2.0 中可用的登录控件。用户成功通过数据库身份验证后，我将用户重定向到 home.aspx。在这里，我也想将用户名传递给 home.aspx，这样用户就会在 home.aspx 中看到他/她的名字。例如：欢迎史密斯

在检查登录凭据期间，我正在从数据库中的用户表中提取用户名。

有人可以告诉我如何以安全的方式做到这一点（可能不是安全，但有点）？

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T19:39:47.110

此类数据的一个好地方是在会话中。在第一页尝试这样的事情：

```
this.Session["UserName"] = userName; 
```

然后该用户可以访问该会话中的后续页面`this.Session["UserName"]`。

最好的办法是创建一个静态类来`Session`为您管理，如下所示：

```
using System;
using System.Web;

static class SessionManager
{
    public static String UserName
    {
        get
        {
            return HttpContext.Current.Session["UserName"].ToString();
        }
        set
        {
            HttpContext.Current.Session["UserName"] = value;
        }
    }

        // add other properties as needed
} 
```

然后您的应用程序可以像这样访问会话状态：

```
SessionManager.UserName 
```

这将为您提供最大的灵活性和可扩展性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:47:10.663

如果您使用标准的 asp.net 身份验证，那么您应该能够通过页面对象的 User 属性访问用户名。

用户.身份.名称

正如 Andrew 建议的那样，Session 是放置用户名的常用位置，尽管我尽可能避免使用 session。

您可以使用用户名设置 cookie。

您还可以设置登录控件的 DestinationPageUrl 属性以在查询字符串中包含用户名。虽然感觉/看起来很蹩脚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T20:41:39.830

正如[ScottS](https://stackoverflow.com/questions/620134/pass-values-or-data-from-one-page-to-another-when-you-use-login-control-in-asp-ne/620177#620177)所说，如果您使用标准登录控件和会员提供程序，则此信息已在 User.Identity.Name 中可供您使用。

我发布答案的唯一原因是提及[LoginName](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginname.aspx)控件，您可以将其放在页面/母版页上并自动为您完成：

```
<asp:LoginName id="LoginName1" runat="server" FormatString ="Welcome, {0}" /> 
```

这将在用户登录时呈现“Welcome, Zhaph”，否则将不呈现任何内容。

[您还可以将其与LoginView](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginview.aspx)和[LoginStatus](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginstatus.aspx)控件很好地结合起来：

```
<asp:LoginView ID="RegisterLink" runat="server">
  <AnonymousTemplate>
    <div class="titleRegistration">
      <a href="/Users/Register.aspx">Register</a> or 
    </div>
  </AnonymousTemplate>
  <LoggedInTemplate>
    <div class="titleRegistration">
      Welcome back
        <asp:LoginName ID="LoginName1" runat="server" /> -
    </div>
  </LoggedInTemplate>
</asp:LoginView>
<asp:LoginStatus ID="lsGeneral" runat="server"
  LogoutPageUrl="/Users/Logout.aspx" /> 
```

这种控件组合将执行以下操作：

1.  如果用户未登录显示：注册或登录
2.  如果用户已登录，则显示： Welcome back Zhaph - Logout

登录链接由 web.config 中的设置填充，并由 LoginStatus 控件生成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T19:46:47.340

是的，正如安德鲁所说，会话是存储敏感数据的主要场所。

但是为什么用户的名字是敏感的？您可以将其保存在 cookie 中，并在用户进入时将其打印在 home.aspx 中。

**编辑：**您可以像这样在 ASP.NET 中使用 cookie：

```
// Setting cookie : 
Response.Cookies["UserName"].Value = "Erhan";
Response.Cookies["UserName"].Expires = DateTime.Now.AddDays(7); // Persists 1 week

// Getting cookie : 
string username = string.Empty;
if(Request.Cookies["UserName"] != null)
{
    username = Server.HtmlEncode(Request.Cookies["UserName"].Value);
} 
```

**注意：**存储在客户端机器上的 Cookie。所以你不应该使用它们来存储敏感数据。

# c++ - 类型名称后的括号是否与 new 不同？

> ID：620137
> 
> 赞同：1066
> 
> 时间：2009-03-06T19:39:12.697
> 
> 标签：c++, constructor, initialization, new-operator, c++-faq

如果'Test'是一个普通的类，有什么区别：

```
Test* test = new Test; 
```

和

```
Test* test = new Test(); 
```

* * *

## 回答 #1

> 赞同：998
> 
> 时间：2009-03-06T21:01:23.543

让我们变得迂腐，因为存在实际上会影响代码行为的差异。以下大部分内容来自对[“旧新事物”文章](https://devblogs.microsoft.com/oldnewthing/20061214-02/?p=28713)的评论。

有时 new 运算符返回的内存将被初始化，有时它不会取决于您要更新的类型是[POD (plain old data)](https://stackoverflow.com/questions/146452/what-are-pod-types-in-c)还是包含 POD 成员的类并且正在使用编译器生成的默认构造函数。

*   在 C++1998 中有两种类型的初始化：零和默认
*   在 C++2003 中，添加了第三种初始化类型，即值初始化。

认为：

```
struct A { int m; }; // POD
struct B { ~B(); int m; }; // non-POD, compiler generated default ctor
struct C { C() : m() {}; ~C(); int m; }; // non-POD, default-initialising m 
```

在 C++98 编译器中，应发生以下情况：

*   `new A` - 不确定的价值
*   `new A()`- 零初始化

*   `new B` - 默认构造（B::m 未初始化）

*   `new B()`- 默认构造（B::m 未初始化）

*   `new C` - 默认构造（C::m 是零初始化的）

*   `new C()`- 默认构造（C::m 是零初始化的）

在符合 C++03 的编译器中，事情应该是这样的：

*   `new A` - 不确定的价值
*   `new A()` - value-initialize A，它是零初始化，因为它是一个 POD。

*   `new B` - 默认初始化（使 B::m 未初始化）

*   `new B()` - value-initializes B，它将所有字段初始化为零，因为它的默认 ctor 是编译器生成的，而不是用户定义的。

*   `new C` - 默认初始化 C，它调用默认 ctor。

*   `new C()` - 值初始化 C，它调用默认的 ctor。

因此，在所有版本的 C++ 中，和之间存在差异`new A`，`new A()`因为 A 是 POD。

对于 case ，C++98 和 C++03 之间的行为存在差异`new B()`。

这是 C++ 尘土飞扬的角落之一，会让你发疯。构造对象时，有时您想要/需要括号，有时您绝对不能拥有它们，有时这无关紧要。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2013-02-15T19:57:41.420

`new Thing();`明确表示您希望调用构造函数，而`new Thing;`暗示您不介意不调用构造函数。

如果在具有用户定义构造函数的结构/类上使用，则没有区别。如果在一个微不足道的结构/类（例如`struct Thing { int i; };`）上调用，那么`new Thing;`就像`malloc(sizeof(Thing));`，而`new Thing();`就像`calloc(sizeof(Thing));`- 它被初始化为零。

问题介于两者之间：

```
struct Thingy {
  ~Thingy(); // No-longer a trivial class
  virtual WaxOn();
  int i;
}; 
```

`new Thingy;`在这种情况下， vs的行为`new Thingy();`在 C++98 和 C++2003 之间发生了变化。请参阅[Michael Burr 的解释](https://stackoverflow.com/a/620402/8735401)，了解如何以及为什么。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-06T19:42:10.707

不，它们是一样的。但两者之间有区别：

```
Test t;      // create a Test called t 
```

和

```
Test t();   // declare a function called t which returns a Test 
```

这是因为基本的 C++（和 C）规则：如果某物可能是声明，那么它就是声明。

**编辑：**关于 POD 和非 POD 数据的初始化问题，虽然我同意所说的一切，但我只想指出，这些问题仅适用于新事物或以其他方式构建的事物没有用户定义的构造函数。如果有这样的构造函数，它将被使用。99.99% 的合理设计的类都会有这样的构造函数，所以这些问题可以忽略。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-06T20:00:19.603

一般来说，我们在第一种情况下进行默认初始化，在第二种情况下进行值初始化。

例如：如果是 int（POD 类型）：

*   `int* test = new int`- 我们有任何初始化，*test 的值可以是任何值。

*   `int* test = new int()`- *test 将有 0 值。

下一个行为取决于您的类型测试。我们有不同的情况：测试有默认构造函数，测试生成默认构造函数，测试包含 POD 成员，非 POD 成员......

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-06T19:42:34.013

假设 Test 是具有定义构造函数的类，则没有区别。后一种形式使 Test 的构造函数正在运行更加清晰，但仅此而已。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-08-20T04:47:33.630

的规则`new`类似于初始化具有自动存储持续时间的对象时发生的情况（尽管由于令人烦恼的解析，语法可能略有不同）。

如果我说：

```
int my_int; // default-initialize → indeterminate (non-class type) 
```

然后`my_int`具有不确定的值，因为它是非类类型。或者，我可以`my_int`像这样进行值初始化（对于非类类型，零初始化）：

```
int my_int{}; // value-initialize → zero-initialize (non-class type) 
```

（当然，我不能使用`()`，因为那将是一个函数声明，但与构造一个临时`int()`的相同。）`int{}`

而对于类类型：

```
Thing my_thing; // default-initialize → default ctor (class type)
Thing my_thing{}; // value-initialize → default-initialize → default ctor (class type) 
```

调用默认构造函数创建一个`Thing`，没有异常。

所以，规则或多或少：

*   是类类型吗？
    *   **YES**：调用默认构造函数，无论它是值初始化（带`{}`）还是默认初始化（不带`{}`）。（值初始化有一些额外的预先归零行为，但默认构造函数总是有最终决定权。）
    *   **NO** :`{}`用过吗？
        *   **YES**：对象是值初始化的，对于非类类型，或多或少只是零初始化。
        *   **NO**：对象是默认初始化的，对于非类类型，它会留下一个不确定的值（实际上它没有被初始化）。

这些规则精确地转换为`new`语法，并添加了`()`可以替换的规则，`{}`因为`new`它永远不会被解析为函数声明。所以：

```
int* my_new_int = new int; // default-initialize → indeterminate (non-class type)
Thing* my_new_thing = new Thing; // default-initialize → default ctor (class type)
int* my_new_zeroed_int = new int(); // value-initialize → zero-initialize (non-class type)
     my_new_zeroed_int = new int{}; // ditto
       my_new_thing = new Thing(); // value-initialize → default-initialize → default ctor (class type) 
```

（这个答案包含了 C++11 中的概念变化，而最佳答案目前没有；值得注意的是，一个新的标量或 POD 实例现在在技术上现在是默认初始化的（对于 POD 类型，在技术上调用一个简单的默认构造函数）。虽然这不会导致行为上的太多实际变化，但它确实在一定程度上简化了规则。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-01T09:16:28.407

我在下面写了一些示例代码，作为对 Michael Burr 答案的补充：

```
#include <iostream>

struct A1 {
    int i;
    int j;
};

struct B {
    int k;
    B() : k(4) {}
    B(int k_) : k(k_) {}
};

struct A2 {
    int i;
    int j;
    B b;
};

struct A3 {
    int i;
    int j;
    B b;
    A3() : i(1), j(2), b(5) {}
    A3(int i_, int j_, B b_): i(i_), j(j_), b(b_) {}
};

int main() {
    {
        std::cout << "Case#1: POD without ()\n";
        A1 a1 = {1, 2};
        std::cout << a1.i << " " << a1.j << std::endl;
        A1* a = new (&a1) A1;
        std::cout << a->i << " " << a->j  << std::endl;
    }
    {
        std::cout << "Case#2: POD with ()\n";
        A1 a1 = {1, 2};
        std::cout << a1.i << " " << a1.j << std::endl;
        A1* a = new (&a1) A1();
        std::cout << a->i << " " << a->j  << std::endl;
    }
    {
        std::cout << "Case#3: non-POD without ()\n";
        A2 a1 = {1, 2, {3}};
        std::cout << a1.i << " " << a1.j << " " << a1.b.k << std::endl;
        A2* a = new (&a1) A2;
        std::cout << a->i << " " << a->j << " " << a->b.k << std::endl;
    }
    {
        std::cout << "Case#4: non-POD with ()\n";
        A2 a1 = {1, 2, {3}};
        std::cout << a1.i << " " << a1.j << " " << a1.b.k  << std::endl;
        A2* a = new (&a1) A2();
        std::cout << a->i << " " << a->j << " " << a1.b.k << std::endl;
    }
    {
        std::cout << "Case#5: user-defined-ctor class without ()\n";
        A3 a1 = {11, 22, {33}};
        std::cout << a1.i << " " << a1.j << " " << a1.b.k << std::endl;
        A3* a = new (&a1) A3;
        std::cout << a->i << " " << a->j << " " << a->b.k << std::endl;
    }
    {
        std::cout << "Case#6: user-defined-ctor class with ()\n";
        A3 a1 = {11, 22, {33}};
        std::cout << a1.i << " " << a1.j << " " << a1.b.k  << std::endl;
        A3* a = new (&a1) A3();
        std::cout << a->i << " " << a->j << " " << a1.b.k << std::endl;
    }
    return 0;
}

/*
output with GCC11.1(C++20)
Case#1: POD without ()
1 2
1 2
Case#2: POD with ()
1 2
0 0
Case#3: non-POD without ()
1 2 3
1 2 4
Case#4: non-POD with ()
1 2 3
0 0 4
Case#5: user-defined-ctor class without ()
11 22 33
1 2 5
Case#6: user-defined-ctor class with ()
11 22 33
1 2 5
*/ 
```

# winforms - 在 Windows 窗体应用程序中使用 Visual Studio 图像库 PNG

> ID：620138
> 
> 赞同：4
> 
> 时间：2009-03-06T19:39:25.317
> 
> 标签：winforms, visual-studio-2008, image, png

我的问题是关于VS2008 附带的[Visual Studio Image Library 。](http://msdn.microsoft.com/en-us/library/ms247035.aspx)在 _Common Elements\Annotations 文件夹中，有多种尺寸的 PNG，我想知道这些的预期用途是什么。是否有实现这些图像的标准方法，例如在 Windows 窗体状态栏中？

下面以三个 PNG 为例：

![替代文字](https://lh6.ggpht.com/_OZWxOfjIgdA/SbF6ZwoRzVI/AAAAAAAAEIs/86H7LzBIH9I/Complete_OK.png)

![替代文字](https://lh6.ggpht.com/_OZWxOfjIgdA/SbF6aC14YPI/AAAAAAAAEI0/3iK306ZRjxI/Blocked.png)

![替代文字](https://lh5.ggpht.com/_OZWxOfjIgdA/SbF6aSIOW6I/AAAAAAAAEI8/m0-f1SI7nYU/Warning.png)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T20:07:23.953

建议的用法是基本上将所需大小的图像复制/粘贴到新的图像文件中。然后只需将其用作您认为合适的控件中的图标或图像。所有的PNG都已经有了透明背景，所以应该很容易复制/粘贴。

# c# - 使用 Windows 服务和 C# 检测 USB 驱动器插入和移除

> ID：620144
> 
> 赞同：71
> 
> 时间：2009-03-06T19:40:51.147
> 
> 标签：c#, .net, windows, windows-services, wmi

研究制作 USB 分布式应用程序的可能性，该应用程序
将在插入 U 盘时自动启动并在移除 U 盘时关闭

将使用 .Net 和 C#。
寻找建议如何使用 C# 来解决这个问题？

* * *

更新：将其作为服务实现的两种可能的解决方案。
- 覆盖 WndProc
或
- 使用带有 ManagementEventWatcher 的 WMI 查询

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2010-06-07T10:08:40.477

您可以使用 WMI，它很简单，并且比带有服务的 WndProc 解决方案工作得更好。

这是一个简单的例子：

```
using System.Management;

ManagementEventWatcher watcher = new ManagementEventWatcher();
WqlEventQuery query = new WqlEventQuery("SELECT * FROM Win32_VolumeChangeEvent WHERE EventType = 2");
watcher.EventArrived += new EventArrivedEventHandler(watcher_EventArrived);
watcher.Query = query;
watcher.Start();
watcher.WaitForNextEvent(); 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2013-10-17T19:41:13.263

这对我来说效果很好，而且您可以找到有关该设备的更多信息。

```
using System.Management;

private void DeviceInsertedEvent(object sender, EventArrivedEventArgs e)
{
    ManagementBaseObject instance = (ManagementBaseObject)e.NewEvent["TargetInstance"];
    foreach (var property in instance.Properties)
    {
        Console.WriteLine(property.Name + " = " + property.Value);
    }
}

private void DeviceRemovedEvent(object sender, EventArrivedEventArgs e)
{
    ManagementBaseObject instance = (ManagementBaseObject)e.NewEvent["TargetInstance"];
    foreach (var property in instance.Properties)
    {
        Console.WriteLine(property.Name + " = " + property.Value);
    }
}            

private void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)
{
    WqlEventQuery insertQuery = new WqlEventQuery("SELECT * FROM __InstanceCreationEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'");

    ManagementEventWatcher insertWatcher = new ManagementEventWatcher(insertQuery);
    insertWatcher.EventArrived += new EventArrivedEventHandler(DeviceInsertedEvent);
    insertWatcher.Start();

    WqlEventQuery removeQuery = new WqlEventQuery("SELECT * FROM __InstanceDeletionEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'");
    ManagementEventWatcher removeWatcher = new ManagementEventWatcher(removeQuery);
    removeWatcher.EventArrived += new EventArrivedEventHandler(DeviceRemovedEvent);
    removeWatcher.Start();

    // Do something while waiting for events
    System.Threading.Thread.Sleep(20000000);
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-12-11T18:23:42.760

添加到 VitalyB 的帖子。

要引发插入**任何**USB 设备的事件，请使用以下命令：

```
var watcher = new ManagementEventWatcher();
var query = new WqlEventQuery("SELECT * FROM Win32_DeviceChangeEvent WHERE EventType = 2");
watcher.EventArrived += new EventArrivedEventHandler(watcher_EventArrived);
watcher.Query = query;
watcher.Start(); 
```

每当插入 USB 设备时，这将引发一个事件。它甚至可以与我试图自动检测的 National Instruments DAQ 一起使用。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2016-02-23T21:22:18.200

VitalyB 的回答不包括移除设备。我对其进行了一些更改，以在**插入**和**删除**媒体时触发事件，以及获取插入媒体的驱动器号的代码。

```
using System;
using System.Management;

namespace MonitorDrives
{
    class Program
    {
        public enum EventType
        {
            Inserted = 2,
            Removed = 3
        }

        static void Main(string[] args)
        {
            ManagementEventWatcher watcher = new ManagementEventWatcher();
            WqlEventQuery query = new WqlEventQuery("SELECT * FROM Win32_VolumeChangeEvent WHERE EventType = 2 or EventType = 3");

            watcher.EventArrived += (s, e) =>
            {
                string driveName = e.NewEvent.Properties["DriveName"].Value.ToString();
                EventType eventType = (EventType)(Convert.ToInt16(e.NewEvent.Properties["EventType"].Value));

                string eventName = Enum.GetName(typeof(EventType), eventType);

                Console.WriteLine("{0}: {1} {2}", DateTime.Now, driveName, eventName);
            };

            watcher.Query = query;
            watcher.Start();

            Console.ReadKey();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-05-10T17:49:50.897

对以上所有答案进行一点编辑：

```
using System.Management;

public partial class MainForm : Form
{
    public MainForm()
    {
        InitializeComponent();

        bgwDriveDetector.DoWork += bgwDriveDetector_DoWork;
        bgwDriveDetector.RunWorkerAsync();
    }

    private void DeviceInsertedEvent(object sender, EventArrivedEventArgs e)
    {
        string driveName = e.NewEvent.Properties["DriveName"].Value.ToString();
        MessageBox.Show(driveName + " inserted");
    }

    private void DeviceRemovedEvent(object sender, EventArrivedEventArgs e)
    {
        string driveName = e.NewEvent.Properties["DriveName"].Value.ToString();
        MessageBox.Show(driveName + " removed");
    }

    void bgwDriveDetector_DoWork(object sender, DoWorkEventArgs e)
    {
        var insertQuery = new WqlEventQuery("SELECT * FROM Win32_DeviceChangeEvent WHERE EventType = 2");
        var insertWatcher = new ManagementEventWatcher(insertQuery);
        insertWatcher.EventArrived += DeviceInsertedEvent;
        insertWatcher.Start();

        var removeQuery = new WqlEventQuery("SELECT * FROM Win32_DeviceChangeEvent WHERE EventType = 3");
        var removeWatcher = new ManagementEventWatcher(removeQuery);
        removeWatcher.EventArrived += DeviceRemovedEvent;
        removeWatcher.Start();
    }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-06T21:50:10.087

您还可以使用[WMI](http://msdn.microsoft.com/en-us/library/aa394582.aspx)来检测插入事件。它比监视 WM_CHANGEDEVICE 消息要复杂一些，但它不需要窗口句柄，如果您在后台作为服务运行，它可能很有用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-06T19:48:04.483

尝试[**WM_CHANGEDEVICE**](http://www.codeproject.com/KB/dotnet/devicevolumemonitor.aspx)处理。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2020-03-05T15:44:42.717

我的完整答案可以在[这里](https://gist.github.com/dtwk2/42d3aa1d6f42b6b106228c472272b966)找到作为一个要点

我从这个问题/答案中找到了从序列号中确定驱动器号的答案 [How to get the drive letter of USB device using WMI](https://stackoverflow.com/questions/31938686/how-to-get-the-drive-letter-of-usb-device-using-wmi/60548941#60548941)

我修改了 Phil Minor 的代码以使其具有反应性：

```
 public class UsbDetector : IUsbDetector
    {
        private const string Query = "SELECT * FROM {0} WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'";
        private const string CreationEvent = "__InstanceCreationEvent";
        private const string DeletionEvent = "__InstanceDeletionEvent";
        private const int ReplayNumber = 1;

        private readonly Subject<USBDeviceInfo> adds = new Subject<USBDeviceInfo>();
        private readonly Subject<USBDeviceInfo> removes = new Subject<USBDeviceInfo>();

        public UsbDetector()
        {
            var bgwDriveDetector = new BackgroundWorker();
            bgwDriveDetector.DoWork += DoWork;
            bgwDriveDetector.RunWorkerAsync();
        }

        public IObservable<USBDeviceInfo> Adds => adds.AsObservable();

        public IObservable<USBDeviceInfo> Removes => removes.AsObservable();

        private void DoWork(object sender, DoWorkEventArgs e)
        {
            SubscribeToEvent(CreationEvent, adds);
            SubscribeToEvent(DeletionEvent, removes);
        }

        private static void SubscribeToEvent(string eventType, IObserver<USBDeviceInfo> observer)
        {
            WqlEventQuery wqlEventQuery = new WqlEventQuery(string.Format(Query, eventType));
            ManagementEventWatcher insertWatcher = new ManagementEventWatcher(wqlEventQuery);

            var observable = Observable.FromEventPattern<EventArrivedEventHandler, EventArrivedEventArgs>(
                h => insertWatcher.EventArrived += h,
                h => insertWatcher.EventArrived -= h).Replay(ReplayNumber);

            observable.Connect();
            observable.Select(a => a.EventArgs).Select(MapEventArgs).Subscribe(observer);
            insertWatcher.Start();
        }

        private static USBDeviceInfo MapEventArgs(EventArrivedEventArgs e)
        {
            ManagementBaseObject instance = (ManagementBaseObject)e.NewEvent["TargetInstance"];

            string deviceId = (string)instance.GetPropertyValue("DeviceID");
            string serialNr = deviceId.Substring(deviceId.LastIndexOf('\\')).Replace("\\", "");
            char driveLetter = GetDriveLetter(serialNr).First();

            return new USBDeviceInfo(deviceId, serialNr, driveLetter);
        } 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-04-06T14:10:58.007

这是我们在 WPF 应用程序下使用 C# .Net 4.0 所做的。我们仍在寻找“如何判断插入/删除了哪种设备类型”的答案，但这是一个开始：

```
 using System.Windows.Interop;
...
public partial class MainWindow : Window
 {
    ...
    public MainWindow()
    {
    ...
    }

    //============================================================
    // WINDOWS MESSAGE HANDLERS
    // 

    private const int WM_DEVICECHANGE = 0x0219;  // int = 537
    private const int DEVICE_NOTIFY_ALL_INTERFACE_CLASSES = 0x00000004; 

    /// <summary>
    ///
    /// </summary>
    /// <param name="e"></param>
    protected override void OnSourceInitialized(EventArgs e)
    {
        base.OnSourceInitialized(e);
        HwndSource source = PresentationSource.FromVisual(this) as HwndSource;
        source.AddHook(WndProc);
    }

    private IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
    {
        if (msg == WM_DEVICECHANGE)
        {
            ReadDongleHeader();
        }
        return IntPtr.Zero;
    }

} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-04-15T13:13:01.393

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Management;
using System.ComponentModel;

namespace ConsoleApplication4
{
  public  class usbState
    {
       public usbState()
        {

        }

   private void DeviceInsertedEvent(object sender, EventArrivedEventArgs e)
   {
       ManagementBaseObject instance = (ManagementBaseObject)e.NewEvent["TargetInstance"];
       foreach (var property in instance.Properties)
       {
           Console.WriteLine(property.Name + " = " + property.Value);
       }
   }

   private void DeviceRemovedEvent(object sender, EventArrivedEventArgs e)
   {
       ManagementBaseObject instance = (ManagementBaseObject)e.NewEvent["TargetInstance"];
       foreach (var property in instance.Properties)
       {
           Console.WriteLine(property.Name + " = " + property.Value);
       }
   } 

    public  void bgwDriveDetector_DoWork(object sender, DoWorkEventArgs e)
    {
        WqlEventQuery insertQuery = new WqlEventQuery("SELECT * FROM __InstanceCreationEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'");

        ManagementEventWatcher insertWatcher = new ManagementEventWatcher(insertQuery);
        insertWatcher.EventArrived += new EventArrivedEventHandler(DeviceInsertedEvent);
        insertWatcher.Start();

        WqlEventQuery removeQuery = new WqlEventQuery("SELECT * FROM __InstanceDeletionEvent WITHIN 2 WHERE TargetInstance ISA 'Win32_USBHub'");
        ManagementEventWatcher removeWatcher = new ManagementEventWatcher(removeQuery);
        removeWatcher.EventArrived += new EventArrivedEventHandler(DeviceRemovedEvent);
        removeWatcher.Start();
    }

}

class Class1
{
       private static void Main(string[] args)
      {
          usbState  usb= new usbState();

          BackgroundWorker bgwDriveDetector = new BackgroundWorker();
          bgwDriveDetector.DoWork += usb.bgwDriveDetector_DoWork;
          bgwDriveDetector.RunWorkerAsync();
          bgwDriveDetector.WorkerReportsProgress = true;
          bgwDriveDetector.WorkerSupportsCancellation = true;

         // System.Threading.Thread.Sleep(100000);
           Console.ReadKey();

       }

}

} 
```

# ruby-on-rails - Rails：在 environment.rb 所需的 lib 文件中定义的过滤器从生产环境中的 filter_chain 中消失。为什么？

> ID：620146
> 
> 赞同：0
> 
> 时间：2009-03-06T19:41:01.787
> 
> 标签：ruby-on-rails, ruby, debugging, filter, environment

在我的 rails 应用程序中，我在 lib 中有一个文件，除其他外，它设置了一个在所有控制器上运行的过滤器。

在开发环境下运行时，一切正常。但是，在生产过程中，过滤器丢失了。有趣的是，通过检查`filter_chain`，我注意到其他过滤器仍然存在，例如。那些在插件中定义的，或者稍后在特定控制器类中定义的。

我已经用 rails edge 和 v2.3.0 对此进行了测试。

### 测试更新：

我现在已经用旧的导轨进行了测试，发现问题出现在 v2.1.0 中，但在 v2.0.5 中没有，我将它们一分为二，发现[986aec5](http://github.com/rails/rails/commit/986aec5dbbdfb578945e706cbe6a54c4f06640e5)导轨是有罪的。

* * *

我已将行为隔离到以下小测试用例：

```
# app/controllers/foo_controller.rb
class FooController < ApplicationController
  def index
    render :text => 'not filtered'
  end
end

# lib/foobar.rb
ActionController::Base.class_eval do
  before_filter :foobar
  def foobar
    render :text => 'hi from foobar filter'
  end
end

# config/environment.rb (at end of file)
require 'foobar' 
```

* * *

这是我在**开发**环境下运行时得到的输出：

```
$ script/server &
$ curl localhost:3000/foo
> hi from foobar filter 
```

这是**生产**环境的输出：

```
$ script/server -e production &
$ curl localhost:3000/foo             
> not filtered 
```

* * *

正如之前提到的，当我通过插件做同样的事情时，它适用于任何环境。我所需要的只是将下面的内容放入`lib/foobar.rb`插件的`init.rb`文件中。

所以在某种程度上我已经有了一个解决方法，但我想了解发生了什么以及是什么导致过滤器在生产中丢失。

我猜想这是 Rails 在不同环境中处理加载的不同方式，但我需要更深入地挖掘。

### 更新

事实上，我现在已将其范围缩小到以下配置行：

```
config.cache_classes = false 
```

如果 中的`production.rb`由`config.cache_classes`更改`true`为`false`，则测试应用程序正常工作。

我仍然想知道为什么类重新加载会导致这样的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T21:58:22.533

[Rails 名单](http://groups.google.com/group/rubyonrails-talk?hl=en)上的 Frederick Cheung给出[了答案](http://groups.google.com/group/rubyonrails-talk/msg/02ad57a81a89a120?hl=en)：

> 因为 cache_classes 不仅如此。过滤器工作之前的方式，如果 Foo < Bar 则只有那些在 Bar 中定义的过滤器将被 Foo 继承 - 稍后将它们添加到 Bar 不会做任何事情
> 
> 在开发模式下，应用程序启动，您的文件是必需的，过滤器添加到 ActionController::Base。稍后第一个请求出现，控制器被加载并继承该过滤器。
> 
> 当 cache_classes 为 true 时，所有应用程序类都会提前加载。这发生在需要您的文件之前，因此在运行该文件时您的所有控制器都已经存在，因此没有任何效果。您可以通过从初始化程序中要求此文件来解决此问题（确保它在加载应用程序类之前运行），但实际上为什么不把它放在 application.rb 中？
> 
> 弗雷德

* * *

我的真实案例实际上涉及更多，这就是我发现解决问题的方法：

```
config.after_initialize do
  require 'foobar'
end 
```

该`after_initialize`块在框架初始化之后但在加载应用程序文件之前运行，因此，它会`ActionPack::Base`在加载之后但在应用程序控制器之前生效。

我想这是处理生产中进行的所有预加载的一般安全方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:58:45.013

将 ruby​​ 脚本放入

> RAILS_ROOT\config\initializers

包含

```
require "foobar.rb" 
```

这为我调用了 before_filter。

# java - Java 小程序权限

> ID：620153
> 
> 赞同：5
> 
> 时间：2009-03-06T19:43:42.590
> 
> 标签：java, upload, permissions, applet

我整理了一个基本的小程序，用户从他们的硬盘驱动器中选择一个文件，它读取该文件的第一行并将其传递给 JavaScript 进行一些额外的预处理，然后当您单击一个按钮时，它会尝试上传该文件通过 HTTP POST 请求文件。我找到了一个非常基本的开源小程序，用于上传我为最后一点复制和修改的文件。

但问题是，它并不完全奏效。看起来它运行良好，但后来我遇到了两个与权限相关的障碍。Java 控制台中的消息表明小程序在以下两个权限上存在访问被拒绝错误：

```
java.lang.RuntimePermission setFactory
java.io.FilePermission read 
```

我觉得这很奇怪，因为当我使用 NetBeans 中选中的“自签名”选项构建小程序时，我以为我已经授予了对小程序的权限，然后单击以确认浏览器中的小安全弹出窗口。

此外，我自己编写的部分，它读取文件并将第一行传递给 JavaScript 工作正常。这是一个非常明确的指标，表明小程序能够从本地文件系统中读取！直到我真正尝试开始上传，麻烦才开始。我想需要注意的一件事是，上传过程似乎在一个新线程中运行，而其余部分都在主类中运行而没有创建线程。

我完全是 Java 新手，对 Java 中的线程知之甚少；我是否需要以某种方式将权限传递给这个新线程？或者有什么效果？提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T19:53:20.680

您可能需要向安全管理员（代码，而不是管理员）询问执行特权操作的权限。由于种种原因，applet 能够打开本地文件通常不是一件好事，因此它受到了相当严格的保护。

基本的关键是打电话， Java Ranch FAQ 上`AccessController.doPrivileged()`有一个[很好的小教程。](http://faq.javaranch.com/java/HowCanAnAppletReadFilesOnTheLocalFileSystem)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-14T20:11:53.447

我有一个类似的问题，需要永远解决。事实证明，从 JavaScript 调用的小程序方法没有权限，即使您在策略文件中明确授予它们。

这种解决方法对我有用（将命令添加到小程序循环通过的队列）： [http ://blog.carrythezero.com/?p=5](http://blog.carrythezero.com/?p=5)

确保您了解这里的危险：任何人都可以修改页面上的 JavaScript 并更改输入小程序的内容。就我而言，我知道代码永远不会在网络服务器上运行，并且该类是未签名的，因此除非在我的策略文件授予的特定位置，否则它将失败。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T20:33:34.500

这可能是因为 JavaScript 未签名。我强烈建议不要签署代码，特别是如果你不知道自己在做什么。从 6u10（尚未在 Mac 上）开始，小程序可以使用 JNLP，包括 FileOpenService，因此您不必签名。

# python - 以编程方式重新启动 Windows 以使系统日志认为用户已注销

> ID：620154
> 
> 赞同：4
> 
> 时间：2009-03-06T19:44:12.450
> 
> 标签：python, windows, automation

我希望制作一个快速脚本以在设定的时间注销/重新启动窗口。例如，启动一个脚本来“十分钟后重新启动窗口”。对于这个实现，我不需要它自己在后台运行或 pop=up。我只想设置脚本然后走开，因为我知道计算机将在设定的时间注销/重新启动。

**我为什么要这样做？** 在公司网络上，有时会审查系统日志，如果发现系统日志过早离开 X 分钟，就会出现复杂情况。有点烦。

**我已经谷歌了吗？** 是的。我找到[了这个](http://kvance.livejournal.com/985732.html)。但这并没有太大帮助。它需要一个我找不到的框架，并且可能无法安装，因为我们在这些机器上没有管理员权限。

我想为它使用 Python，而且我真的很想让它看起来像是用户做的，而不是脚本。也许屏幕抓取是唯一的方法，如果是这样，只需将我指向一个快速指南或 IDE，我就会为大家发布源代码。

**编辑**：我也遇到了[这个](http://sourceforge.net/projects/pywinauto/)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-06T19:53:01.850

批处理关闭命令将关闭计算机

-s 关闭它，-f 强制它，-t xx 让它在 x 秒内关闭，

使用 python 中的 subprocess 模块来调用它。

由于您希望它在特定时间关闭，因此要完全自动化作业，您需要使用类似 autosys 的东西。将脚本设置为调用 shutdown ，其 T 的值等于您要关闭的时间 - 当前时间（以秒为单位）。在你离开一天之前运行它，或者将它设置为在启动时运行并且忽略它带来的那个愚蠢的窗口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:53:08.840

[PsShutdown](http://technet.microsoft.com/en-us/sysinternals/bb897541.aspx)可能是您正在寻找的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T20:04:24.943

您可以在批处理脚本中使用[关闭命令。](http://technet.microsoft.com/en-us/library/cc732503.aspx)

# iphone - 了解 iPhone 上的 UINavigationController

> ID：620155
> 
> 赞同：1
> 
> 时间：2009-03-06T19:44:27.877
> 
> 标签：iphone, cocoa-touch

我的假设是每个控制器都使用 presentModalViewController:animated: 需要他们自己的 UINavigationController 堆栈用于他们自己的向下钻取控制器层次结构？意思是，假设我有一个顶级控制器它有自己的导航堆栈，以及一个通过模式呈现另一个控制器的操作按钮。该模式有自己的导航堆栈。最好用自己的导航堆栈拆分每个 modalView 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:27:45.963

如果您希望模态视图具有导航控制器提供的前进和后退行为，则需要为其提供单独的导航控制器。（如果您不需要在该模态视图中推送和弹出视图控制器，那么您当然不需要一个。）这可能有点痛苦，但它们是休息时间。

# sql - 运行 django 测试用例时 SQLite 合并问题

> ID：620156
> 
> 赞同：-1
> 
> 时间：2009-03-06T19:44:29.080
> 
> 标签：sql, django, testing, sqlite, postgresql

我正在使用 django 来运行我的项目。我正在为我的生产数据库使用 postgresql_psycopg2 引擎，但测试运行程序使用 sqllite3 运行测试。牢记我的生产数据库（postgresql），我尝试构建一个使用“coalesce”的查询。但是 sqllite3 不承认这一点。我如何通过这个。我甚至可以在我的测试运行中使用 postgresql_psycopg2（只是为了避免浪费时间），但它太慢了。我如何通过这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T19:49:41.390

Sqlite 确实支持[`coalesce`](http://www.sqlite.org/lang_corefunc.html)，但至少需要两个参数。我相信 Postgresl 实现只需要一个参数，而 Sqlite 至少需要两个。也许您`coalesce`在 Postgresql 中只使用一个参数，并且在迁移到 Sqlite 时会中断？

你能发布失败的代码吗？

# frameworks - 基于 Web 的应用程序应该遵循 Web 标准吗？

> ID：620172
> 
> 赞同：3
> 
> 时间：2009-03-06T19:46:12.273
> 
> 标签：frameworks, standards, web-standards

白天，我是一名前端 Web 开发人员，但在空闲时间，我会涉足其他语言，例如 C、Objective-C、Python 等。当我第一次接触 Web 开发时，Web 应用程序的想法才刚刚起步。

从那以后出现了两个惊人的框架，SproutIt 的 SproutCore 和 280 North 的 Cappuccino (+Objective-J)。Apple 正在将 SproutCore 用于其 MobileMe 应用程序，并且 280 North 发布了 280 Slides。这两个应用程序都很棒，它们证明了网络上的可能性。因此，势头正在转变。Web 应用程序开始看起来和行为类似于桌面应用程序。

所以我的问题是：基于 Web 的应用程序是否应该遵循 Web 标准、标记（内容）、表示（设计）和行为（功能）的分离？

我不确定 SproutCore，因为我没有查看源代码，但我知道如果你去 280slides.com 并关闭 JavaScript，一切基本上都会消失。你留下了一些无意义的话。

让我澄清一下，我知道基于 Web 的应用程序（例如 280 Slides）是为了启用 JavaScript 而不是没有它就可以正常工作，但在我的日常工作中，我的主要重点是编写干净的标记，分离内容、演示和行为，以便我们的网站和应用程序可以被尽可能多的人使用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:38:27.183

到目前为止回答的其他人似乎**不知道**您在说什么。

像我一样，您已经将它深深地印在了您的脑海中，以使您的 Web 应用程序尽可能易于访问。也就是说，它们应该在没有脚本和样式表的情况下工作。JavaScript 和 CSS 只能用于增强体验。它们不应该是必需的。

[SproutCore](http://www.sproutcore.com/)和[Cappuccino](http://cappuccino.org/)是*前端*开发框架，要求用户同时启用 JavaScript 和 CSS。你的问题是关于我们如何协调这与当时的教条。

不幸的是，我没有一个明确的答案。我喜欢 SproutCore 和 Cappuccino（可能还有其他人）正在测试 Web 浏览器中可能的极限的事实。我也坚信，鉴于技术的局限性，网络上提供的信息和服务应该提供给尽可能多的人。

您如何处理您的解决方案需要基于对您的用户群的深入了解。如果您正在开发 iPhone 应用程序，则无需担心传统的 Web 可访问性，因为这种体验非常直观。如果您正在为普通用户构建一个 Web 应用程序，那么这些新框架可能是一个糟糕的选择（如果您重视尽可能广泛地访问您的信息和服务）。

随着时间的推移，屏幕阅读器软件可能会在解释大量 JavaScript 的界面方面变得更好，所以这个问题可能会逐渐消失。问题是，其他东西很可能会在它的位置“萌芽”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T22:36:55.187

Javascript*是*一种 Web 标准——肯定比以前（并且仍然经常）用于富 Web 应用程序的 Flash 更重要。在这方面，SproutCore 和 Cappuccino 是我书中的巨大改进。

这里的问题似乎是可访问性的重要性。正如安德鲁所说，这在很大程度上是基于了解您的用户的个人决定。对于某些应用程序来说，可访问性确实没有多大意义——280 Slides 就是一个很好的例子。这是一个主要与视觉行为有关的图形设计应用程序。将其降级为明文没有多大意义。（至少，一个基于文本的应用程序旨在完成 280 Slides 所做的事情将是完全不同的事情。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T19:49:13.093

是的。一开始会很困难，但一旦代码库成熟，你会庆幸你遵循了这些严格的标准。

编辑：一个额外的好处是通过 CSS 配置文件和诸如此类的东西可移植到许多基于 Web 的平台。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T19:51:55.957

MVC 模型可以像应用于基于 Web 的应用程序一样容易地应用于桌面应用程序。我看不出区分两者的理由，特别是因为在 Web 应用程序的情况下界限更加模糊。

我不知道这些特定的框架，但是现在很多 Web 框架都是围绕 MVC 模型构建的，例如 ASP MVC、CakePHP、Ruby on Rails 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T19:54:13.283

尽可能多地分开，最终会得到回报。当事情变得复杂和多毛时:)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-06T19:50:41.450

我认为他们应该。遵循这种类型的[MVC 设计](http://en.wikipedia.org/wiki/Model-view-controller)可以使更改更容易实现，提供良好[的关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)，并且对于项目的新手来说通常更容易理解。

# .net - 创建 sha1 哈希时如何使用 machineKey validationKey？

> ID：620178
> 
> 赞同：2
> 
> 时间：2009-03-06T19:48:03.360
> 
> 标签：.net, asp.net, hash, validation

```
<machineKey validation="SHA1" validationKey="<64-byte key>" 
```

验证密钥到底是做什么的？假设我使用 SHA1 创建了一个哈希。验证密钥如何发挥作用？

考虑这段代码：

```
HMACSHA1 hashSha = new HMACSHA1(_validationKey);
byte[] ret = hashSha.ComputeHash(bytes, offSet, count);
return ret; 
```

我们正在生成一个新的 _validationkey，对吧？然后我们获取我们的字节并在 ComputeHash 中对它们进行散列。_validationKey 的意义何在？当我们以某种方式验证哈希时，我们需要它吗？

如果它在这个过程中没有任何作用，那么下面的说法是否正确？

我有一个 80 字节长的字节数组，最后 20 个字节由 asp.net sha1 哈希组成，然后是前 60 个字节，如果 sha1 哈希应该与最后 20 个匹配

validationKey 在其中没有任何作用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T20:07:56.073

validationKey 用于加密视图状态数据并确保回发的内容是有效的。

[http://msdn.microsoft.com/en-us/library/system.web.configuration.machinekeysection.validationkey.aspx](http://msdn.microsoft.com/en-us/library/system.web.configuration.machinekeysection.validationkey.aspx)

编辑：对不起，这并没有真正回答你的问题。validationKey 仅在验证您的视图状态数据未被篡改时使用，并且您所指的 SHA1 是您想要与您的validationKey 一起使用的算法类型。创建 SHA1 哈希时不使用它，它仅用于 asp.net 页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T17:56:08.673

就我而言，我发现验证密钥用于创建 sha1 hmac 键控哈希。

# hardware - L2 高速缓存

> ID：620181
> 
> 赞同：0
> 
> 时间：2009-03-06T19:48:32.080
> 
> 标签：hardware, cpu-cache

2*512 KB L2 缓存和 1 MB L2 缓存有什么区别？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T19:50:29.737

第一个可以专用于双核，每个核心 512 KB，第二个可以共享，如果多个核心？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-21T12:30:30.243

假设我们谈论的是 2 核处理器，它们可能是内存层次结构第二级的两种设计选择：

*   2*512 KB L2 缓存：两个私有 L2 缓存。
*   1 MB L2 缓存：两个内核之间共享的 L2 缓存。

例如，可以在[Sandy Bridge](http://en.wikipedia.org/wiki/Sandy_Bridge)或[K10](http://en.wikipedia.org/wiki/AMD_K10)微架构的处理器中找到私有 L2 缓存。在 T1、T2 和 T3 UltraSPARC 处理器中可以找到共享的 L2 缓存（T4 具有专用的 L2 缓存）。

# testing - 推荐的基于模型的测试工具

> ID：620188
> 
> 赞同：4
> 
> 时间：2009-03-06T19:49:53.620
> 
> 标签：testing, model, model-driven, mbt

有人对使用什么基于模型的测试工具有任何建议吗？Spec Explorer/SPEC# 在测试人员培训中值得重视吗？

我传统上所做的是创建一个 Visio 模型，在其中我调用每个状态的状态和相关变量、输出和预期结果。然后以一种完全断开的方式，我使用基于该模型的这些变量来驱动我的测试脚本。但是，它们没有连接。我想要一种创建模型的方法，以业务友好的方式关联变量，然后为脚本构建数据参数。

我不能成为第一个需要这个的人。有没有一种工具可以基本上做到这一点？没有自己开发。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-27T15:36:37.493

您可能会发现以下对类似问题的回答很有帮助：

[http://testing.stackexchange.com/questions/92/how-to-get-started-with-model-based-testing](https://web.archive.org/web/20100110013424/http://testing.stackexchange.com:80/questions/92/how-to-get-started-with-model-based-testing)

在其中，我提到：

UML Pad [http://web.tiscali.it/ggbhome/umlpad/umlpad.htm](http://web.tiscali.it/ggbhome/umlpad/umlpad.htm) 免费 UML 工具列表： [http](http://en.wikipedia.org/wiki/Category:Free_UML_tools) ://en.wikipedia.org/wiki/Category:Free_UML_tools 我们的成对和组合测试用例生成器（其中根据您创建的模型自动为您生成测试 - 即使您不创建 UML 模型）：[http ://hexawise.com](http://hexawise.com)

顺便说一句，正如我在上面链接的答案中所解释的，我将精力（研究、工具开发重点、热情等）集中在问题的第二部分 - 生成有效且有效的测试集，以最少的数量最大化覆盖率的测试用例。

贾斯汀（Hexawise 创始人）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-23T16:55:42.633

我认为“Spec Explorer for Visual Studio”电动工具的更新版本应该很快就会发布 - 它比[当前版本](http://research.microsoft.com/en-us/projects/specexplorer/)更容易升级，但仍然需要一些时间来学习。

如果您想从较小的规模开始，[nmodel](http://www.codeplex.com/NModel)（也来自 microsoft）是一个不错的起点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-14T05:30:37.853

查看 TestOptimal。它提供全周期基于模型的测试，并在模型中内置数据驱动测试和组合测试。它具有图形建模和调试功能，您可以播放模型并以图形方式动画模型执行。您可以将状态/转换链接到需求。模型可以重新用于负载测试而无需更改。它甚至可以为 Web 应用程序创建全自动 MBT，而无需任何编码/脚本。看看这个简短的幻灯片演示：http: [//TestOptimal.com/tutorials/Overview.htm](http://TestOptimal.com/tutorials/Overview.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-08T20:53:45.493

我可以告诉你，需要 Visual Studio 专业版的 2010 版 Spec Explorer 是一个很棒的工具，假设你已经有了 Visual Studio。旧版本的规范浏览器很好，但限制是，如果你最终建模了一个非有限的系统，那么你就不走运了。

新版本改进了查看模型“切片”的技术，使其达到有限状态。一旦有了有限状态，就可以生成测试用例。

最棒的是，当您更改模型并重新切片模型时，重新生成测试并重新运行它们很简单。这肯定比任何一天的手动过程都要好。

我无法将此工具与其他工具集进行比较，但与 Visual Studio 的集成是非常宝贵的。如果您不使用 Visual Studio，您可能会获得有限的成功。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-22T15:33:40.373

我的一位同事制作了这个工具，[http](http://mbt.tigris.org/) ://mbt.tigris.org/ ，并且多年来一直在大规模测试环境中使用。它是开源的，所有..

更新：这里是简短的白皮书： http: [//www.prolore.se/filer/whitepaper/MBT-Agile.pdf](http://www.prolore.se/filer/whitepaper/MBT-Agile.pdf)

这个工具非常适合 MBT，yED 是一款免费的建模软件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-01T16:26:43.933

你应该试试 All4Tec 的“MaTeLo”工具。www.all4tec.net

“MaTeLo 是用于黑盒功能和系统测试的测试用例生成器。MaTeLo 遵循基于模型的测试方法，使用马尔可夫链对测试进行建模。这个统计插件允许以系统的方式验证产品。效率是通过减少所需的人力资源，模型重用的增加和测试策略相关性的增强（由于可靠性目标）。MaTeLo 是独立且用户友好的，提供从测试脚本到实际测试的验证活动工程并专注于测试的真正附加值：测试计划”

您可以要求评估许可证并自行尝试。

你可以在这里找到一些例子：[http ://www.all4tec.net/wiki/index.php?title=Tutorials](http://www.all4tec.net/wiki/index.php?title=Tutorials)

# c# - 如何从 XElement 获取 XML 片段作为字符串？

> ID：620191
> 
> 赞同：2
> 
> 时间：2009-03-06T19:50:52.527
> 
> 标签：c#, xml, linq

我有一个`XElement`并且在那个元素里面我有另一个 XML 片段。如何检索 XML？

如果我尝试以下操作，我只会得到值：

```
string str = "<Root><Node1>value1</Node1><Node2></Node2></Root>";

XElement elem = XElement.Parse(str);
string innerXml = elem.value; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T08:56:28.887

Eric White 刚刚发布了一篇博客文章来做到这一点 - 将 XElement 转换为 XmlNode 并返回。

[在这里](http://blogs.msdn.com/ericwhite/archive/2008/12/22/convert-xelement-to-xmlnode-and-convert-xmlnode-to-xelement.aspx)查看。

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T19:54:14.577

尝试这样的事情：

```
var x = elem.Descendants(); 
```

这将返回根节点的所有后代 - 如果您想要一个特定的后代，您可以将其名称作为字符串参数传递给同一方法。

**编辑：**如果你*真的*需要它作为一个字符串，你可以聚合节点。这是一个可以解决问题的扩展方法：

```
public static String InnerXml(this XElement source)
{
    return source.Descendants().Select(x => x.ToString()).Aggregate(String.Concat);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T20:22:47.973

我只是要创建一个扩展方法 InnerXml 来返回 innerXML

# .net - 有没有办法告诉给定的 .net 程序集在哪个 DLL 中？

> ID：620198
> 
> 赞同：1
> 
> 时间：2009-03-06T19:54:01.927
> 
> 标签：.net, dll

长话短说：我们有一个系统，我们正在从一台服务器移动到另一台服务器。此时，唯一的问题是新盒子上缺少一个组件。在旧盒子上，我们可以看到程序集名称，但对于我们的生活，我们无法弄清楚代码在物理上位于哪个 dll 中，因此我们可以将其移动到新盒子中。

是否有一些时髦的 .net 程序集小部件会告诉你？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T19:56:58.223

我会使用[.NET Reflector](http://www.red-gate.com/products/reflector/)来加载主应用程序，然后查看“引用”部分以查看引用了哪些程序集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T19:56:33.980

你试过[反光板](http://www.red-gate.com/products/reflector/)吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T20:05:19.310

程序集名称应与 DLL 名称相同。（当然，DLL 将在最后包含“.dll”。）程序集名称是 CLR 确定要加载哪个文件的方式！

您的意思是您可以看到用于某些类型的*命名空间吗？*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T20:09:41.047

对于运行代码，您可以启动[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx "进程浏览器")并在下部面板中查看 DLL，这些列包括加载给定程序集的路径

# assembly - 为什么内存区 $1020 在 M68HC12 上无法写入 staa？

> ID：620206
> 
> 赞同：6
> 
> 时间：2009-03-06T19:56:51.577
> 
> 标签：assembly, embedded, memory-mapping

我有以下asm代码：

```
 org $1000             ;Table Origin is at $1000
fcb $02,$04,$06,$08   ; values of table from $1001 - $1004
fcb $0a,$0c,$0e,$10   ; values of table from $1005 - $1009

        org $400          ; Program Start
        lds #$4000        ; Set Stack Pointer at value (#) $4000
        ldy #$1000        ; Set Index Y at $1000
        ldaa #$04         ; Load Accumulator a with value $04
loop    staa $20,y        ; Store value of Accumulator a at y = $1000 {DOESNT WORK} 
        staa $21,y        ; Store value of Accumulator a at y = $1021 {DOESNT WORK}
        iny               ; increment y (at this point $1020 and $1021 are still ff)
        iny               ; increment y (at this point $1020 and $1021 are still ff)
        deca              ; decrement a
        bne loop          ; loop until a = 0
hold    bra hold          ; end of program
        end 
```

该表设置正确，但 staa 在 1020 处没有写入任何内容。为什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T20:37:25.113

我相信那里有ROM

> 10.3 只读存储器阵列
> 
> ROM 由一个从 $1000 映射到 $7FFF 的 28K 字节数组和一个在复位时从 $8000 映射到 $FFFF 的 32K 字节数组组成。MISC 寄存器中的 MAPROM 位允许交换两个数组。ROMON28 和 ROMON32 启用或禁用 ROM 模块

来自 M68HC12[数据表](http://www.datasheetcatalog.org/datasheets/restul/446196_DS.pdf)

# entity-framework - Jira 使用 OfBiz 的企业架构

> ID：620215
> 
> 赞同：3
> 
> 时间：2009-03-06T19:58:46.970
> 
> 标签：entity-framework, jira, enterprise-library, ofbiz

“开放商业项目”是一个企业框架。

碰巧 Jira 使用了这个，我对提取特定实体的数据所涉及的工作量感到非常震惊（比如 Jira 案例中的问题/错误）。

想象一下获取所有问题的列表，它必须首先获取要为表列显示的所有列（或属性），然后为每个列提取值。对于企业解决方案，这听起来像是一个次优解决方案（但我了解它如何增加灵活性）。

您可以阅读它在 Jira 中的实际使用方式：[http://confluence.atlassian.com/display/JIRA/Database+Schema](http://confluence.atlassian.com/display/JIRA/Database+Schema)

主站点： http: [//ofbiz.apache.org/docs/entity.html](http://ofbiz.apache.org/docs/entity.html)

我只是对如何列出所有问题感到困惑。意思是，sql 查询会是什么样子？

拉一个问题是一回事，但要获得一个列表，您必须做大量工作才能获得价值。 **我不认为现在可以通过使用连接的单一查询来完成它吗？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-01T02:55:00.753

（免责声明：我为 Atlassian 工作，但我不在 JIRA 团队中）

OFBiz EE 只是一个抽象层，用于在数据库表和称为 GenericValues 的精美地图之间移动。它对数据库模式本身没有影响。您真正的问题似乎是 JIRA 的数据库模式很复杂。

它之所以复杂，是因为它必须支持一个数据模型，其中问题是任意字段的任意集合，在任意工作流中的某个时间点。字段本身可以由第三方插件定义。很难生成一个外观友好的 RDBMS 模式来适应这种动态数据模型，JIRA 会尽力而为。

如果需要，您可以直接从数据库中获取信息，数据库架构记录在上面的链接中，或者您可以上一层或十二层抽象并通过 JIRA 的许多 API 中的一个进行交谈。

询问有关从 JIRA 获取数据的问题的好地方是[http://forums.atlassian.com/上的论坛](http://forums.atlassian.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T13:41:00.487

```
SELECT * FROM jiraissue; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T20:06:06.937

jira 中使用的实体引擎是一个数据库抽象层（具有非常丰富且易于使用的 API），它将您的应用程序与一个或多个数据源连接起来。但是数据库仍然是关系型的，因此您可以根据需要使用 SQL。关于您要提取的问题信息，我想说仅使用连接并不容易。我建议您使用 RDBMS 的脚本语言（即 PL/SQL、pgPL/SQL）。

# windows - windows中的svn/ssh问题

> ID：620223
> 
> 赞同：3
> 
> 时间：2009-03-06T20:03:45.913
> 
> 标签：windows, svn, ssh

我正在尝试在我的 Windows 机器上执行命令行 svn 更新（以在批处理文件中使用），并且我希望它模拟我在 Tortoise SVN GUI 中的设置。

在乌龟设置中，我们必须在SSH客户端中指定以下内容...

```
C:\Program Files\TortoiseSVN\bin\TortoisePlink.exe -l usernamehere -pw mypassword -i C:\Users\Mike\Documents\myprivatekey.ppk 

```

我只需右键单击更新...

有谁知道我将如何使用 svn.exe 来模拟上述内容？（使用带有私钥的 plink？）

如果我对某些事情不清楚，请发表评论，我会解决的。

最好的，迈克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T21:04:14.893

[svn+ssh 命令行](http://agateau.wordpress.com/2007/07/03/windows-svnssh-and-the-subversion-command-line-client/)

基本上，

*   编辑文件 c:\Documents and Settings\user\Application Data\Subversion\config

*   找到名为 [tunnels] 的部分

*   添加以下行：ssh=c:/path/to/plink.exe -ic:/path/to/your/key.ppk

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-19T12:01:29.773

我无法使用 subversion `plink`，所以我使用了 Git 的 SSH。在我的 wiki 上的详细信息[http://wiki.dandascalescu.com/howtos/subversion/subversion_access_through_ssh_on_windows](http://wiki.dandascalescu.com/howtos/subversion/subversion_access_through_ssh_on_windows)。

# sql-server - SQL Server 2005 内存压力和 tempdb 写入问题

> ID：620226
> 
> 赞同：11
> 
> 时间：2009-03-06T20:05:37.593
> 
> 标签：sql-server, sql-server-2005, performance, tempdb

我们的生产 SQL Server 存在一些问题。

服务器：双四核 Xeon 8 GB RAM 单 RAID 10 阵列 Windows 2003 Server 64 位 SQL Server 2005 标准 64 位

现在机器上有大约 250MB 的可用 RAM。SQL Server 有大约 6GB 的 RAM，而我们的监控软件说只有一半的 SQL Server 分配的 RAM 实际被使用。

我们的主数据库大约为 20GB，其中大约 12GB 用于任何频率。我们的 tempdb 为 700MB。两者都位于同一个物理磁盘阵列上。

此外，使用 Filemon，我能够看到 tempdb 文件有 100 或 1000 次长度为 65536 的写入。磁盘队列长度在近 80% 的情况下超过 100。

所以，这是我的问题-

1.  什么会导致 tempdb 上的所有这些写入？我不确定我们是否一直有这么多活动，但这似乎过度了，而且这些问题是最近才出现的。

2.  我应该向服务器添加更多内存吗？

3.  在高负载服务器上，tempdb 和 db 文件是否应该位于不同的阵列上？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T13:59:08.470

如果您有 SAN 或 NAS，那么高磁盘队列长度并不意味着您有 I/O 瓶颈，您可能需要查看其他额外的计数器。查看[所讨论的 SQL Server Urban Legends](http://blogs.msdn.com/psssql/archive/2007/02/21/sql-server-urban-legends-discussed.aspx)以了解更多详细信息。

1：以下操作大量使用 tempdb

*   重复创建和删除临时表（本地或全局）
*   使用 tempdb 进行存储的表变量
*   与 CURSORS 关联的工作表
*   与 ORDER BY 子句关联的工作表
*   与 GROUP BY 子句关联的工作表
*   与 HASH PLANS 关联的工作文件

这些 SQL Server 2005 功能也大量使用 tempdb：

*   行级版本控制（快照隔离）
*   在线索引重建

正如其他 SO 答案中提到的，请阅读[这篇](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1307255,00.html)关于提高 tempdb 性能的最佳实践的文章。

2：查看服务器上的可用 RAM 量，即查看 WMI 计数器 Memory->Available Mbytes 无济于事，因为 SQL Server 会将数据页缓存在 RAM 中，因此任何运行时间足够长的 db 服务器将几乎没有可用 RAM .
您应该查看的计数器在告诉您向服务器添加 RAM 是否有帮助时更有意义：
*SQL Server Instance:Buffer Manager->Page Life Expectancy (in seconds)* 低于 300-400 秒的值意味着页面是不在内存中很长时间，并且不断地从磁盘读取数据。页面预期寿命较短的服务器将受益于额外的 RAM。
和
*SQL Server Instance:Buffer Manager->Buffer Cache hit Ratio* 这告诉你从 RAM 读取的页面的百分比不必从磁盘读取，缓存命中率低于 85 将意味着服务器将受益来自额外的 RAM

3：是的，这里不会出错。建议将 tempdb 放在一组单独的磁盘上。查看标题下的[这篇知识库文章](http://support.microsoft.com/kb/224071)：移动 tempdb 数据库以了解如何执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T20:30:27.190

很好的问题，+1

tempdb 在 SQL 2005+ 中使用得更多。至少：快照隔离级别、在线索引重建、在触发器中读取 INSERTED/DELETED（用于读取日志文件！）

除了通常的 order by 子句、临时表等之外。

你可能会更好地分割你的日志和数据文件（也是为了可恢复性）。更多的内存总是好的，但请参阅下面的这个[64 位特定的东西，Grumpy Old DBA](http://sqlblogcasts.com/blogs/grumpyolddba/archive/tags/x64/default.aspx)。

最后，也许是最重要的，您可能会在 tempdb 中发生空间分配争用：[Linchi Shea](http://sqlblog.com/blogs/linchi_shea/archive/2007/08/07/reduce-the-contention-on-tempdb-with-trace-flag-1118-to-enable-or-not-to-enable.aspx)和[SQL Server 存储团队的解释](http://blogs.msdn.com/sqlserverstorageengine/archive/2009/01/04/managing-tempdb-in-sql-server-tempdb-configuration.aspx)

后期编辑：

Paul Randall 添加了一个条目“ [Comprehensive tempdb blog post series](http://www.sqlskills.com/BLOGS/PAUL/post/Comprehensive-tempdb-blog-post-series.aspx) ”，它提供了很好的链接

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T20:37:37.500

是的，对高负载服务器的建议是将 TempDB 放在与用户数据库不同的一组驱动器上：

[SQL Server 2005 联机丛书：优化 tempdb 性能](http://msdn.microsoft.com/en-us/library/ms175527(SQL.90).aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-08T11:09:10.360

不是直接回答您的问题，但这可能是一个很好的提示：重新启动您的 SQL Server 实例将清除 tempdb，这在调查对 tempdb 执行的操作时可能是一个好的开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T06:29:23.560

1.  对 tempdb 的写入可以是任何内容。内部哈希表、临时表、表变量、存储过程调用等。

2.  如果您只有 250 兆的可用 RAM，那么更多的 RAM 会更好。

3.  始终建议您将 tempdb 和用户数据库拆分到不同的磁盘。

所有对 tempdb 的写入都将是 64k 大小，因为这是每个数据库范围的大小。

# database - Postgres 是否有类似于 Oracle 的虚拟专用数据库的东西？

> ID：620229
> 
> 赞同：3
> 
> 时间：2009-03-06T20:05:49.463
> 
> 标签：database, oracle, postgresql

正如标题所暗示的，有谁知道这样的事情是否存在？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:50:29.790

看起来 Postgres [Veil](http://veil.projects.postgresql.org/curdocs/main.html)项目就是这样做的。

> Veil 是 Postgres 的数据安全插件。它提供了一个 API，允许您控制对行甚至列级别的数据的访问。不同的用户将能够运行相同的查询并看到不同的结果。其他数据库供应商将其描述为虚拟专用数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T23:19:54.007

你可以用数据的视图/规则做类似的事情。此外，8.4 具有列级权限 iirc。

# linq - 我是否应该担心 LINQ（查询语言）的升级路径

> ID：620234
> 
> 赞同：0
> 
> 时间：2009-03-06T20:07:22.393
> 
> 标签：linq, upgrade, maintainability

我开始在代码中使用 LINQ 作为真正的查询语言来帮助提高可读性。直到最近我还害怕接触 LINQ，因为 LINQ to SQL 团队在实体框架团队下移动（试图忽略这里的对话）—— LINQ 查询语言是否会成为一个安全的赌注（就像任何东西一样快速搬家行业）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T20:13:26.280

区分“LINQ”和“特定的 LINQ 提供程序”是值得的。我认为可以肯定地说 LINQ 本身将继续存在 - 它对于通过 LINQ to Objects 进行的进程内收集处理*非常*有用。

至于哪个 LINQ 提供者将“获胜”（如果有的话） - 这是一个更难的赌注。

不过，我*当然会*学习 LINQ 本身的基础知识——而且 LINQ to XML 也是一个可爱的 XML API。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T20:22:31.843

正如 Jon 所说，区分 LINQ 提供程序非常重要。例如

*   LINQ to objects：这是基于 IEnumerable<T> 并且在 BCL 中如此根深蒂固，以至于我发现它很难去任何地方
*   LINQ to SQL：我几乎没有使用 LINQ，但我知道它有很多追随者，而且人们似乎喜欢它。

警告：我在 LINQ 上工作，所以我在这里很有偏见。

LINQ 的真正优点是，我认为我们真正做对的是任何人都可以编写 LINQ 提供程序。所需要的只是一些具有正确名称的可绑定方法，然后您就拥有了查询语法。

```
var query = from it in someCollection select it.SomeProperty; 
```

我可以在不使用任何 3.5 框架的情况下编写此语句。我有[自己的 LINQ Provider](http://code.msdn.microsoft.com/BclExtras)，它适用于 2.0 框架，并且与编译器中使用的查询语法兼容。

我个人更倾向于 lambda/ 扩展方法 synatx，但生成的代码确实没有什么不同。

# javascript - 如何修复 Vim 中不正确的内联 Javascript 缩进？

> ID：620247
> 
> 赞同：64
> 
> 时间：2009-03-06T20:13:33.847
> 
> 标签：javascript, vim

我似乎无法在 Vim 中正确缩进内联 Javascript。考虑以下：

```
 $(document).ready(function() {

  // Closing brace correctly indented
    $("input").focus(function() {
      $(this).closest("li").addClass("cur-focus");
    }); // <-- I had to manually unindent this

  // Closing brace incorrectly indented
    $("input").blur(function() {
      $(this).closest("li").removeClass("cur-focus");
      }); // <-- This is what it does by default. Argh!

  }); 
```

Vim 似乎坚持自动缩进第二种情况中显示的右大括号。如果我重新缩进整个文件，它会做同样的事情。如何使用在第一种情况下看到的更标准的 JS 缩进样式自动缩进？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2010-11-15T10:16:27.283

最全面和无错误的 Javascript 缩进脚本是[Preston Koprivica 的一个](http://www.vim.org/scripts/script.php?script_id=3081)。~~提议的答案中所谓的 OOP 脚本有严重的错误，并且没有正确缩进带有方括号的代码。~~

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2009-03-06T20:47:14.497

使用[JavaScript 缩进：](http://www.vim.org/scripts/script.php?script_id=3081) Preston Koprivica 的 Javascript 缩进（包括 HTML 缩进）。感谢[oligofren](https://stackoverflow.com/questions/620247/how-do-i-fix-incorrect-inline-javascript-indentation-in-vim/4183349#4183349)的提醒- 给他一个赞成票。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-07-20T11:30:01.100

上面提到的脚本没有正确格式化 jQuery 中经常使用的闭包语法：

```
$(function() {
  // only one level of indentation, not two
}); 
```

这个脚本更适合我：[http ://www.vim.org/scripts/script.php?script_id=2765](http://www.vim.org/scripts/script.php?script_id=2765)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-12-09T18:41:23.990

这些答案大部分来自 2009 年，坦率地说，已经过时了。

[vim-javascript](https://github.com/pangloss/vim-javascript)比[Preston 的脚本更新和更新。](http://www.vim.org/scripts/script.php?script_id=3081)

[如果您还没有开始使用Vundle](https://github.com/gmarik/vundle) ，安装会稍微复杂一些，但它似乎不会受到替代品问题的影响。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-06T20:35:36.787

也许这些设置的某种组合应该在您的 VIMRC 文件中。

```
syntax on 
set syn=auto 
set showmatch 
filetype on 
filetype plugin on 
filetype indent on 
set tabstop=4 
set softtabstop=4 
set shiftwidth=4 
set expandtab 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-04-20T01:35:13.613

我有同样的问题。这是所有 Javascript 缩进脚本中最好的：

[http://www.vim.org/scripts/script.php?script_id=1840](http://www.vim.org/scripts/script.php?script_id=1840)

它需要 IndentAnything 插件

[http://www.vim.org/scripts/script.php?script_id=1839](http://www.vim.org/scripts/script.php?script_id=1839)

作为额外的奖励，我编写了这个缩进脚本，它将使 Javascript 块非常漂亮。它默认使用默认的 html 缩进器（在 Javascript 块中使用 IndentAnything 缩进器）

[http://gist.github.com/371902](http://gist.github.com/371902)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-04-29T15:52:06.340

如果有人来这里请注意[https://github.com/pangloss/vim-javascript](https://github.com/pangloss/vim-javascript)到目前为止对我的帮助，即 Vim 7.4 `vim-javascript`。而来自 oligofren 和 Charles Roper 的上述解决方案却没有。`pangloss`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-08T14:38:10.920

假设语法文件对 java 脚本有良好的缩进，可视地突出显示该块并按 =。这适用于java，所以我希望它为java脚本做一些不错的事情。结果可能还取决于 tabstop、expandtab 和 shiftwidth 的设置。

gq 也很有用，它格式化行而不是缩进。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-10-04T15:52:39.873

您不必安装专门用于 Javascript 的插件，您可以学习内置的 Vim 缩进选项。Vim 有很多选项，一些缩进样式如`cindent`,`smartindent`并且`indentexpr`有自己的选项。

要检查您是否使用`cindent`or`smartindent`或`indentexpr`，请运行：

```
:set cindent?
:set smartindent?
:set indentexpr? 
```

尽管有这个名字，`cindent`但它不仅适用于 C 程序，它还可以适用于许多共享大致相同语法的编程语言，包括 Javascript。查看[`:help C-indenting`](http://vimdoc.sourceforge.net/htmldoc/indent.html#C-indenting)有关此的文档。您可以调整设置，特别是使用像这样的行，请参阅[`:help 'cinoptions'`](http://vimdoc.sourceforge.net/htmldoc/options.html#'cinoptions')和[`:help cinoptions-values`](http://vimdoc.sourceforge.net/htmldoc/indent.html#cinoptions-values)。这是一个示例配置：

```
:au FileType js,javascript setlocal shiftwidth=2 softtabstop=2 cinoptions=j1,J1,(1s " see help cino-j cino-J cino-( 
```

# log4net - 如果运行某台机器，将 Log4Net 配置为不使用 smtp appender

> ID：620248
> 
> 赞同：5
> 
> 时间：2009-03-06T20:13:56.653
> 
> 标签：log4net, environment-variables

当生产代码中出现错误时，我正在设置一个 SMPTAppender 以通过电子邮件发送日志文件。有一些机器，例如本地的测试机器，我不希望发送电子邮件。

我尝试在属性过滤器中使用环境变量 COMPUTERNAME，但这不起作用：

```
<filter type="log4net.Filter.PropertyFilter">
  <Key value="COMPUTERNAME" />
  <StringToMatch value="myComputerName" />
  <Accept value="false" />
</filter> 
```

我在这样的文件附加程序中使用了 ComputerName：

```
<file value="${HOMEDRIVE}\\loggingDirectory\\AppLogFile.${COMPUTERNAME}.log" /> 
```

这也不起作用（我也不希望它）：

```
<filter type="log4net.Filter.PropertyFilter">
  <Key value="${COMPUTERNAME}" />
  <StringToMatch value="myComputerName" />
  <Accept value="false" />
</filter> 
```

有没有办法在属性过滤器中使用环境变量？欢迎提出其他建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T09:23:51.507

您使用了错误的 Key 值。LoggingEvent.Properties 集合由具有“log4net:HostName”签名的 HostName 属性填充。

您的过滤器应如下所示：

```
<filter type="log4net.Filter.PropertyFilter">
    <Key value="log4net:HostName" />
    <StringToMatch value="computerToExclude" />
    <AcceptOnMatch value="false" />
</filter> 
```

还要注意使用 AcceptOnMatch，而不是 Accept。

# java - Java DomImplementationLS

> ID：620250
> 
> 赞同：1
> 
> 时间：2009-03-06T20:14:48.240
> 
> 标签：java, xml, networking, xml-serialization

我希望在 Java 中创建 XML 文档对象并将它们序列化为字节数组（在通过 TCP 连接发送它们之前）。我目前的代码如下所示：

```
public byte [] EncapsulateThingy( ThingyType thingy )
{
    parser.reset(); // parser is a pre-existing DocumentBuilder object
    Document doc = parser.newDocument();
    doc.appendChild( doc.createElement("Thingy") );
    // ...  add nodes to doc to represent thingy
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream( 8192 ); 

    //
    // Missing: Write doc to outputStream with xml version 1.0 and UTF-8 
    // encoding.
    //

    return outputStream.toByteArray();
} 
```

[Sun Java 文档](http://java.sun.com/javase/6/docs/api/org/w3c/dom/ls/DOMImplementationLS.html)有关于一组接口的信息，这些接口似乎以 DomImplementationLS 开头，用于加载和保存 XML，我可以用它来方便地填写上面缺失的部分。但我不知道如何创建一个实现 DomImplementationLS 的对象。

我的最终目标是将非常简单的对象序列化和反序列化为以字节数组编码的 XML，这样我就可以通过网络传输它们。我有兴趣保持解决方案的轻量级，以便它可以处理高吞吐量的消息。

我对替代解决方案感兴趣，只要它们让我指定要发送的确切 XML 结构。

当这些 XML 消息被消费时，我当然必须提供反序列化，但是网上有大量的文档和教程可用于阅读 XML，但用于编写的却不多。

我更喜欢包含在 Java 6 中而不添加包的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:27:09.850

希望这可以帮助：

```
import java.io.ByteArrayOutputStream;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.junit.Test;
import org.w3c.dom.DOMImplementation;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSOutput;
import org.w3c.dom.ls.LSSerializer;

public class DomLsTest {

    @Test
    public void testDomLs() throws Exception {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        DOMImplementation di = db.getDOMImplementation();
        Document d = di.createDocument("", "foo", null);
        Element e = d.createElement("bar");
        d.getDocumentElement().appendChild(e);
        DOMImplementationLS ls = (DOMImplementationLS) di;
        LSOutput lso = ls.createLSOutput();
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        lso.setByteStream(baos);
        LSSerializer lss = ls.createLSSerializer();
        lss.write(d, lso);
        System.out.println(baos.toString());
    }

} 
```

因此，对于您的代码，您需要执行以下操作：

```
DOMImplementationLS ls = (DOMImplementationLS) parser.getDOMImplementation();
LSOutput lso = ls.createLSOutput();
lso.setByteStream(...);
LSSerializer lss = ls.createSerializer();
lss.write(..., lso); 
```

# c# - 网络上的 C#/mySQL 数据检索问题

> ID：620252
> 
> 赞同：0
> 
> 时间：2009-03-06T20:16:03.713
> 
> 标签：c#, mysql, database

我在本地网络的服务器上运行了一个 mySQL 数据库。

如果我做一个正常的`SELECT`陈述，我会得到 6000 个结果。在 mySQL 查询浏览器中的执行时间是`0.35s`，但数据被接收并在查询浏览器中显示之后`9s`。

如果我尝试通过 .NET 应用程序访问数据，我也会遇到同样的问题。查询本身很快，但在应用程序中显示它很慢。

有谁知道会导致这种情况的原因是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T20:37:11.620

如果记录很大，则可能完全取决于数据通过网络传输所需的时间。你没有提供太多细节，所以很难说。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T21:19:58.287

设置一个分析器，以检查时间的去向。我还将设置一个集成测试，它只直接调用获取结果的 c# 方法。

附言。我重新阅读了这个问题，它看起来真的很常见，需要很长时间才能通过网络。我会仔细检查它是否真的与一些记录有相同的行为。

# git - git推送被拒绝

> ID：620253
> 
> 赞同：64
> 
> 时间：2009-03-06T20:16:16.820
> 
> 标签：git, push

我放弃！每当我尝试推动时，我都会变得愚蠢：

```
! [rejected]        master -> master (non-fast forward)
error: failed to push some refs to 'git@github.com:companyX/projectX.git' 
```

我们的团队有一个新的 git 设置。我现在没有创建私有分支，而是将我们的主存储库（在 github 上）创建为我自己的副本。

在某些时候，我所做的是：

```
$ git fetch upstream master:upstreammaster 
```

所以这是我当前的设置::

```
$ git branch
master
* upstreammaster

$ git remote -v
origin  git@github.com:userX/projectX.git
upstream    git@github.com:companyX/projectX.git 
```

其中 userX 是我的私人存储库。

所以我去对我的 upstreammaster 分支和“upstream master”的 PULL 进行一些更改。一切都合并和东西：

```
$ git pull upstream master
remote: Counting objects: 95, done.
remote: Compressing objects: 100% (60/60), done.
remote: Total 60 (delta 54), reused 0 (delta 0)
Unpacking objects: 100% (60/60), done.
From git@github.com:companyX/projectX
 * branch            master     -> FETCH_HEAD
Merge made by recursive.
stuff                      |  165 ++++++++++++--------
stuff                      |   35 ++--
stuff                       |  107 ++++++++++---
stuff                       |  105 ++++++++++---
stuff             |   24 ++--
stuff               |    9 +-
stuff                   |   53 +++----
stuff            |   44 +++---
stuff              |   52 +++----
stuff |   32 +----
stuff          |    4 +-
 stuff             |  138 ++++++++---------
stuff     |   58 ++++----
stuff    |  115 ++++++++------
stuff          |    5 +-
stuff                       |   39 ++---
stuff                        |   28 ++--
 17 files changed, 560 insertions(+), 453 deletions(-) 
```

但是当我尝试这样做时：

```
$ git push upstream master
To git@github.com:companyX/projectX.git
 ! [rejected]        master -> master (non-fast forward)
error: failed to push some refs to 'git@github.com:companyX/projectX.git' 
```

任何帮助将不胜感激！如果您需要澄清，请询问，我会回复！

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-06T20:31:25.237

进行推送时，请尝试为上游主服务器指定 refspec：

```
git push upstream upstreammaster:master 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-06T23:47:12.397

杰瑞特哈迪是正确的。或者，首先将您的更改合并回主服务器，然后尝试推送。默认情况下，`git push`推送所有名称与远程匹配的分支——而不是其他分支。所以这是你的两个选择——要么像 Jarret 所说的那样明确指定它，要么合并回一个公共分支，然后推送。

Git 邮件列表上已经讨论过这个问题，很明显这种行为不会很快改变——许多开发人员在他们的工作流程中依赖这种行为。

**编辑/澄清**

假设您的`upstreammaster`分支已准备好推送，那么您可以这样做：

1.  从上游拉入任何更改。

    $ git pull 上游大师

2.  切换到我的本地主分支

    $ git结账大师

3.  合并从`upstreammaster`

    $ git 合并上游管理员

4.  推动我的改变

    $ git 向上游推送

*在推送之前您可能*想要做的另一件事是`rebase`针对上游/主服务器的更改，以便您的提交全部在一起。您可以将其作为上述 #1 和 #2 之间的单独步骤（`git rebase upstream/master`），也可以作为拉动的一部分（`git pull --rebase upstream master`）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-02-18T13:03:59.970

首次使用

```
git pull https://github.com/username/repository master 
```

然后尝试

```
git push -u origin master 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-06T20:37:01.403

首先，尝试从您尝试推送到的同一个 refspec 中提取。

如果这不起作用，您可以`git push`使用强制 a `git push -f <repo> <refspec>`，但要小心：此方法可能会导致远程存储库上的引用被删除。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2020-07-26T14:06:01.280

实际上我得到了同样的错误，但下面的评论对我有用

```
git push -f origin master 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-22T09:52:23.560

您位于“上游”的存储库是裸存储库吗？我遇到了同样的错误，但是当我改为裸机时，它们不再发生。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-09-18T02:33:32.257

如果没有任何效果，请尝试：

```
git pull --allow-unrelated-histories <repo> <branch> 
```

然后做：

```
git push --set-upstream origin master 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-26T07:23:29.743

如果推送请求显示被拒绝，请先尝试从您的 github 帐户中拉取，然后再尝试推送。

前任：

就我而言，它给出了一个错误-

```
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'https://github.com/ashif8984/git-github.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details. 
```

****所以我所做的是-****

```
$ git pull
$ git push 
```

并且代码已成功推送到我的 Github 帐户中。

# ruby-on-rails - 是否可以使用 Rails 迁移重命名索引？

> ID：620259
> 
> 赞同：43
> 
> 时间：2009-03-06T20:19:16.733
> 
> 标签：ruby-on-rails, migration

我知道有一个`rename_column`转变，但似乎`rename_index`不存在。

我必须使用`remove_index`and`add_index`代替吗？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2012-04-24T00:14:32.043

`rename_index`应该给出字符串而不是符号。

```
rename_index :table_name, 'old_name', 'new_name' 
```

尝试重命名表及其索引时让我摸不着头脑。Rails 3.2.3 和 MySQL。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-09-29T12:49:44.973

Rails 3 提供了重命名索引的快捷方式：

```
rename_index :table_name, :old_name, :new_name 
```

[http://guides.rubyonrails.org/migrations.html](http://guides.rubyonrails.org/migrations.html)

顺便说一句，它只是删除旧的并添加新的：

[http://apidock.com/rails/v2.3.8/ActiveRecord/ConnectionAdapters/SchemaStatements/rename_index](http://apidock.com/rails/v2.3.8/ActiveRecord/ConnectionAdapters/SchemaStatements/rename_index)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2016-05-28T01:19:29.410

从 Rails 5 开始（编辑：也在 Rails 4 中），重命名列也会自动重命名索引。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-06T20:31:20.933

根据[API](http://api.rubyonrails.org/classes/ActiveRecord/Migration.html)，使用`remove_index`and`add_index`是实现此目的的唯一方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T23:57:36.723

您也可以在迁移中执行任意 SQL。

我们有一些辅助方法可以将外键添加到我们的表中：

```
def add_foreign_key(from_table, from_column, to_table)
  constraint_name = "fk_#{from_table}_#{from_column}"

  execute %{alter table #{from_table}
            add constraint #{constraint_name}
            foreign key (#{from_column})
            references #{to_table}(id)
           }
  end 
```

您可以使用数据库支持的任何 SQL。

# profiling - 什么影响代码的速度？

> ID：620260
> 
> 赞同：9
> 
> 时间：2009-03-06T20:19:26.360
> 
> 标签：profiling, performance

查看代码运行速度的方法是性能分析。有用于它的工具等，但我想知道代码速度的因素是什么。

例如，有人告诉我，图像编辑软件将使用按位运算而不是整数变量来计算它们的内容，仅仅是因为它更快。

所以这一定意味着与二进制相比，使用整数和其他原始类型需要更多的步骤来计算。

肯定还有其他东西，但是我没有足够的经验来了解操作系统如何连接到您的硬件以及许多编码语言的内部工作原理来知道什么。

所以我在这里问：你知道是什么影响了代码的速度吗？

**不一定**是程序的速度。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-06T20:34:28.820

整数*是*二进制的。或者更确切地说，整数只是整数，可以用任何数字基数表示。在基数 10 中你会写 13，在基数 16 中你会写 d（或 0xd），在二进制中你会写 1101（或 0b1101）。罗马人会写 XIII。它们都代表数字“十三”的相同*概念*。在人类中，我们倾向于使用以 10 为底的表示，但是当您要求计算机处理整数时，它使用二进制表示。这并没有什么不同。不管我怎么写，十三加四十五的结果都是一样的。十三 + 0x2D = 13 + 45 = 0xd + 0b101101。无论您使用哪种表示形式，算术运算的结果都是相同的。

一些编程语言还为您提供“十进制”数据类型，但这通常与浮点运算有关，其中并非所有值都可以用所有基数表示（1/3 可以很容易地用基数 3 表示，但不能用 2 或 10 , 例如. 1/10 可以以 10 为底表示, 但不能表示 2)

然而，将任何特定操作单独列为“慢”是非常困难的，因为*它取决于*. 现代 CPU 在大多数情况下采用了许多技巧和优化来加速大多数操作。所以说真的，要获得高效的代码，你需要做的是避免所有特殊情况。而且它们有很多，它们通常更多地与指令的组合（和顺序）有关，而不是使用哪些指令。

只是为了让您了解我们正在谈论的那种微妙之处，在理想情况下，浮点运算可以像整数运算一样快（或有时比整数运算更快），但延迟更长，这意味着理想的性能更难达到。原本几乎是空闲的分支变得很痛苦，因为它们在编译器中和在 CPU 上动态地抑制指令重新排序和调度，这使得隐藏这种延迟变得更加困难。延迟定义了从指令开始到结果准备好需要多长时间；大多数指令只占用 CPU 一个时钟周期即使结果在下一个周期还没有准备好，CPU 也可以开始另一条指令。这意味着如果不是立即需要结果，高延迟指令几乎是免费的。

无论您做什么，某些指令都很慢，并且通常会停止 CPU 的相关部分，直到指令完成（平方根是一个常见的例子，但整数除法可能是另一个例子。在某些 CPU 上，双精度通常会受到同样的问题） - 另一方面，虽然浮点平方根会阻塞 FP 管道，但它不会阻止您同时执行整数指令。

有时，将值存储在可以根据需要重新计算的变量中会更快，因为可以将它们放入寄存器中以节省几个周期。其他时候，它会变慢，因为您用完了寄存器，并且必须将值推送到缓存甚至 RAM，从而使每次使用时都重新计算更可取。你遍历内存的顺序有很大的不同。随机（分散）访问可能需要数百个周期才能完成，但顺序访问几乎是即时的。以正确的模式执行读/写可以让 CPU 几乎一直将所需的数据保存在缓存中，而且*通常*“正确的模式”意味着顺序读取数据，并一次处理约 64kb 的块。但有时不是。在 x86 CPU 上，有些指令占用 1 个字节，有些则占用 17 个字节。如果您的代码包含大量前者，那么指令获取和解码不会成为瓶颈，但如果它充满了较长的指令，那可能限制每个周期 CPU 可以加载多少条指令，然后它能够​​执行的数量无关紧要。

现代 CPU中几乎没有*通用*的性能规则。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-06T20:22:53.153

我认为你错了。整数*是*二进制数。图像编辑软件将尽其所能避免*浮点*计算，因为与整数或位移运算相比，它们的速度非常慢。

但通常情况下，首先是通过选择正确的算法进行优化，而不是通过诸如担心是后增量还是前增量之类的琐碎小事来进行优化。

例如：我刚刚花了两天时间加快我们重新计算一组特定值的方式。我从循环中抽出一些东西并预先计算它，所以它只完成了 M 次而不是 M x N 次，并将一个值存储在一个变量中，而不是每次都从其他地方查找它，因为该值已被使用在 Comparator 所以它会在 Collections.sort 阶段被调用很多。我得到的总执行时间从大约 45 秒到 20 秒。然后我的一位在这里待了很长时间的同事指出，我不需要重新计算这些值，我可以将它们从不同的对象中提取出来。突然它在 2 秒内执行。现在*这*是我可以相信的优化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-06T20:38:20.977

“程序的速度”通常归结为算法选择。错误的算法可以将 2 秒的任务变成 2 分钟或更糟的任务。当您专注于做到这一点时，您将看到最佳的性能提升。

一旦你有了一个好的算法，你可能仍然需要一个更有效的实现。实现这一点通常依赖于“代码速度”类型的选择。有几件事情需要考虑，它们往往非常依赖于硬件。一个处理器的优化实际上可能会减慢其他处理器的代码。

一些“代码速度”因素：

*   整数与浮点数
*   分支、函数调用、上下文切换的成本
*   CPU 指令流水线中断
*   维护内存访问的局部性，缓存一致性。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-06T21:10:41.913

稍微扩展一下 Oscar Reyes 所说的内容，即使在最低级别，数据传输实际上也是性能的关键因素，因此 CPU 执行的操作的数量和类型对整体性能都至关重要。

对于像 x86 这样的 CISC 处理器尤其如此，其中指令本身可能具有不同的循环计数，尽管现代设计大多缓解了这一点。但是，在内存加载和存储操作的情况下，所有 CPU 都是如此，这可能比任何其他操作都贵很多、很多、很多倍。考虑到现代 CPU 的时钟频率与内存延迟的关系，如果出现页面错误并且必须写入磁盘，您可能会看到数十条指令在缓存未命中的情况下被浪费到数百万条。在许多情况下，当考虑到缓存行为以及加载和存储行为时，执行大量算术运算来重新计算一个值实际上可能要快得多，而不是缓存它并从内存中重新读取它，即使负载是一条汇编指令与一条汇编指令。许多用于执行计算的指令。在某些情况下，考虑您的性能仅受加载和存储限制并将其他操作视为“免费”实际上可能是有意义的，尽管这自然取决于具体情况。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-06T21:24:34.253

代码速度主要受计算机体系结构的低级优化影响，包括 CPU 和其他优化。

代码速度有很多因素，它们通常是编译器自动处理的低级问题，但如果你知道自己在做什么，这可以让你的代码更快。

首先，显然是字大小。64 位机器具有更大的字长（是的，更大通常意味着更好），以便可以更快地执行大多数操作，例如双精度操作（其中双精度通常表示 2 * 32 位）。64 位架构还受益于提供更快数据传输速率的更大数据总线。

其次，管道也很重要。基本指令可以分为不同的状态或阶段，例如，指令通常分为：

*   Fetch：从指令缓存中读取指令
*   解码：指令被解码并解释，看看我们必须做什么。
*   Execute：指令被执行（通常意味着在 ALU 中进行操作）
*   内存访问：如果指令必须访问内存（例如从数据缓存加载注册表值），则在此处执行。
*   写回：将值写回目标寄存器。

现在，流水线允许处理器在这些阶段划分指令并同时执行它们，这样当它执行一条指令时，它也在解码下一条指令并获取之后的一条指令。

一些指令具有依赖性。如果我将一起添加到寄存器中，则 add 指令的执行阶段将需要这些值，然后才能真正从内存中恢复它们。通过了解流水线结构，编译器可以对汇编指令重新排序，以便在加载和加法之间提供足够的“距离”，从而使 CPU 无需等待。

另一个 CPU 优化将是超标量，它利用冗余 ALU（例如），以便可以同时执行两个加法指令。同样，通过准确了解架构，您可以优化指令的顺序以利用。例如，如果编译器检测到代码中不存在依赖关系，它可以重新排列加载和算术，以便将算术延迟到所有数据都可用的稍后位置，然后同时执行 4 个操作。

这主要由编译器使用。

在设计应用程序时可以使用并且可以真正提高代码速度的是了解缓存策略和组织。最典型的例子是在循环中对双精度数组进行错误排序的访问：

```
// Make an array, in memory this is represented as a 1.000.000 contiguous bytes
byte[][] array1 = new byte[1000, 1000];
byte[][] array2 = new byte[1000, 1000;
// Add the array items

for (int j = 0; j < 1000; i++)
  for (int i = 0; i < 1000; j++)
     array1[i,j] = array1[i,j] + array2[i,j] 
```

让我们看看这里发生了什么。

array1[0,0] 被带入缓存。由于缓存在块中工作，因此您将前 1000 个字节放入缓存中，因此缓存将 array1[0,0] 保存到 array1[0,999]。

array2[0,0] 可以缓存。再次阻塞，以便您拥有 array2[0,0] 到 array2[0,999]。

下一步我们访问不在缓存中的array1[1,0]，array2[1,0] 也不在缓存中，因此我们将它们从内存中带到缓存中。现在，如果我们假设我们有一个非常小的缓存大小，这将使 array2[0...999] 被从缓存中取出......等等。因此，当我们访问 array2[0,1] 时，它将不再在缓存中。缓存对array2 或array1 没有用。

如果我们重新排序内存访问：

```
for (int i = 0; i < 1000; i++)
  for (int j = 0; j < 1000; j++)
     array1[i,j] = array1[i,j] + array2[j,i] 
```

没有内存必须从缓存中取出，程序将运行得更快。

这些都是幼稚的学术示例，如果您真的想或需要学习计算机体系结构，您需要对体系结构的细节有非常深入的了解，但同样只有在编写编译器时才有用。尽管如此，缓存和基本低级 CPU 的基本知识可以帮助您提高速度。

例如，这些知识在密码编程中可能具有极高的价值，您必须处理非常大的数字（如 1024 位），以便正确的表示可以改进需要执行的底层数学......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-06T20:53:48.880

在我真正关心的极少数情况下，我遇到的最大的单一事情就是地方性。现代 CPU 运行速度非常快，但它们的高速缓存数量有限，而且很容易获得。当他们在缓存中找不到他们需要的东西时，他们必须从内存中读取，这是比较慢的。（当他们正在寻找的东西不在物理内存中时，它真的很慢。）

因此，在重要的时候，尽量保持你的代码和数据紧凑。尽可能多地卷起循环。

在多线程环境中，存在不同的约束，如果所有线程都在处理来自不同缓存“行”的数据，那么情况会更好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-06T20:36:07.753

假设代码具有“速度”是思考问题的错误方式，IMO。

执行任何给定的操作码都需要一定的时间。函数的操作码越多，执行所需的时间就越多。知道如何最小化执行的操作码数量（从而创建最快的代码）是我们学习 ASM、研究算法等的原因。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-06T20:32:38.667

代码的速度受到影响，主要是受它必须执行的操作量的影响。

它必须执行的操作越多，代码就越慢。某些代码执行的操作与其使用的算法直接相关。

所以最后是算法。

另外（仅说明代码速度和程序速度之间的差异）

当今计算机的速度已经提高了很多，以至于应用程序的速度与它使用的代码的速度无关，而与它从一个设备传输到其他设备的数据量有关。

例如（我知道您在这里标记了一个明显的区别）Web 应用程序的速度受通过网络发送的数据量（从数据库到应用程序服务器以及从应用程序服务器到客户端）的影响比时间更大它花费在其中一个节点内处理该数据。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-06T20:40:18.790

传统观点认为，更好的算法将为您提供更快的代码，但实际上并非如此简单。Jalf 是对的，这取决于。对于已编译的语言，特定的编译器可以产生比算法更改更大的差异。此外，更快的处理器应该让事情运行得更快。通常。只需阅读代码完成。它将回答您有关优化代码以提高速度的所有问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-06T21:08:21.157

什么影响代码的速度？

一切。

通常最大的因素是你从未想过的事情。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-06T22:21:24.333

在 2009 年的硬件上，就像在房地产中一样，在考虑代码速度时，只需要记住三件事：内存、内存、内存。（我包括缓存和位置。）

减少分配。减少写入。减少读取。

在那之后，您通常会陷入困境，并且很难说出分类结果。（例如，在浮点单元中完成的计算几乎总是比在整数单元中完成的类似计算慢，这是真的。现在不再是这样了。）

如果您可以同时保持多个整数单元和一个浮点单元忙碌，那将是一个加号。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-07T22:31:50.853

是的，分析是一种判断速度的方法。

是的，各种事情都会导致执行缓慢。

但是，解决性能问题的基本方法是假设*您不知道甚至可以猜测*问题是什么，即使您有很多加速技巧。

就在今天，我正在开发一个应用程序，打算通过在优化问题中使用封闭形式的梯度计算来使其更快。你猜怎么了？这不是问题所在，而是其他问题。

如果 X、Y 或 Z 造成了时间浪费，它会在执行此操作时位于调用堆栈中，您可以轻松地看到它。如果它通常不在调用堆栈上，那么它可能不是导致它的原因。 [看这里。](https://stackoverflow.com/questions/566014/why-does-my-c-code-run-slow/567926#567926)

# php - PHP 无法设置cookie()

> ID：620262
> 
> 赞同：1
> 
> 时间：2009-03-06T20:20:42.033
> 
> 标签：php, setcookie

我在 php 中过期 cookie 时遇到问题。这是我的代码：

```
<?php
setcookie('reitinvestor_user', 'null', time()-3600,'',$_SERVER['SERVER_NAME']);
setcookie('reitinvestor_pass', 'null', time()-3600,'',$_SERVER['SERVER_NAME']);
echo '<pre>'; print_r($_COOKIE); echo '</pre>';
exit;
?> 
```

每次我点击刷新，我都会得到这个结果：

```
Array
(
    [_csuid] => 47dae7b6cd2d9e89
    [reitinvestor_user] => john
    [reitinvestor_pass] => 1f3870be274f6c49b3e31a0c6728957f
    [PHPSESSID] => 6027e370abad115e35b54b0be76befc8
) 
```

我可以用不同的键值做一个 setcookie，也可以让它们过期。我似乎无法为 reitinvestor_user 和 reitinvestor_pass 做这件事。怎么了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T20:28:13.357

您是否检查过您是否在相同的域和路径中以更改 cookie？

> [...] 如果以下任何一种情况属实，用户代理将拒绝 cookie（不应存储其信息）：
> 
> *   Path 属性的值不是 request-URI 的前缀。
>     
>     
> *   Domain 属性的值不包含嵌入的点或不以点开头。
>     
>     
> *   请求主机的值与域属性的域不匹配。
>     
>     
> *   request-host 是一个 FQDN（不是 IP 地址），格式为 HD，其中 D 是 Domain 属性的值，H 是包含一个或多个点的字符串。
>     
>     
> 
> — [RFC 2109](http://www.ietf.org/rfc/rfc2109.txt)

# c# - 我可以使用 ASP.NET 设置 HTML/电子邮件模板吗？

> ID：620265
> 
> 赞同：99
> 
> 时间：2009-03-06T20:21:10.830
> 
> 标签：c#, asp.net, email, templates

我正在开发一个会发送大量电子邮件的网站。我想设置页眉和页脚文本，甚至可能是模板，以允许用户在需要时轻松编辑这些电子邮件。

如果我将 HTML 嵌入到 C# 字符串文字中，那会很丑陋，他们将不得不担心转义。包括页眉和页脚的平面文件可能会起作用，但它的某些内容感觉不对。

`.ASPX`以某种方式将页面用作模板，然后告诉我的代码为该页面提供服务，并使用为电子邮件返回的 HTML，这将是理想的。

有没有一种简单易用的方法来做到这一点？有没有更好的方法来解决这个问题？

**更新：**
我添加了一个答案，使您能够使用标准的 .aspx 页面作为电子邮件模板。只需像往常一样替换所有变量，使用数据绑定等。然后只需捕获页面的输出，瞧！你有你的 HTML 电子邮件！

**更新了警告!!!：**
我在某些 aspx 页面上使用 MailDefinition 类就好了，但是当尝试在正在运行的服务器进程期间使用这个类时，它失败了。我相信这是因为 MailDefinition.CreateMailMessage() 方法需要一个有效的控件来引用，即使它并不总是做某事。正因为如此，我会推荐我的方法使用 aspx 页面，或者 Mun 的方法使用 ascx 页面，这似乎更好一些。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2011-02-24T06:48:55.173

这里已经有很多答案，但我偶然发现了一篇关于如何将 Razor 与电子邮件模板一起使用的精彩文章。Razor 是使用 ASP.NET MVC 3 推送的，但使用 Razor 不需要 MVC。这是做电子邮件模板的非常巧妙的处理

正如文章指出的那样，“Razor 的最佳之处在于，与它的前身（webforms）不同，它不与 web 环境绑定，我们可以轻松地将它托管在 web 之外并将其用作模板引擎用于各种目的。”

[使用 RazorEngine 生成 HTML 电子邮件 - 第 01 部分 - 简介](http://mehdi.me/generating-html-emails-with-razorengine-introduction/)

[利用 ASP.NET 之外的 Razor 模板：它们不再只是用于 HTML！](http://www.codemag.com/Article/1103081)

[使用 RazorEngine 的 ASP.NET 中更智能的电子邮件模板](http://blog.falafel.com/smarter-email-templates-in-asp-net-with-razorengine/)

**类似的 Stackoverflow 质量检查**

[使用新的 RazorEngine API 进行模板化](https://stackoverflow.com/q/28606132/92166)

[在没有 MVC 的情况下使用 Razor](https://stackoverflow.com/questions/4808348/using-razor-without-mvc)

[是否可以在 asp.net 之外使用 Razor View Engine](https://stackoverflow.com/questions/3628895/is-it-possible-to-use-razor-view-engine-outside-asp-net)

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-03-06T20:51:15.893

您可能还想尝试加载控件，然后将其呈现为字符串并将其设置为 HTML 正文：

```
// Declare stringbuilder to render control to
StringBuilder sb = new StringBuilder();

// Load the control
UserControl ctrl = (UserControl) LoadControl("~/Controls/UserControl.ascx");

// Do stuff with ctrl here

// Render the control into the stringbuilder
StringWriter sw = new StringWriter(sb);
Html32TextWriter htw = new Html32TextWriter(sw);
ctrl.RenderControl(htw);

// Get full body text
string body = sb.ToString(); 
```

然后，您可以像往常一样构建您的电子邮件：

```
MailMessage message = new MailMessage();
message.From = new MailAddress("from@email.com", "from name");
message.Subject = "Email Subject";
message.Body = body;
message.BodyEncoding = Encoding.ASCII;
message.IsBodyHtml = true;

SmtpClient smtp = new SmtpClient("server");
smtp.Send(message); 
```

您的用户控件可以包含其他控件，例如页眉和页脚，并且还可以利用数据绑定等功能。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-03-06T20:34:05.933

你可以试试[MailDefinition 类](https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.webcontrols.maildefinition)

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-03-06T20:36:30.420

如果您想传递用户名、产品名称等参数，您可以使用开源模板引擎[NVelocity](http://nvelocity.sourceforge.net/)来生成最终的电子邮件/HTML。

NVelocity 模板 ( **MailTemplate.vm** ) 的示例：

```
A sample email template by <b>$name</b>.
<br />

Foreach example :
<br />    
#foreach ($item in $itemList)

[Date: $item.Date] Name: $item.Name, Value: $itemValue.Value
<br /><br />

#end 
```

在您的应用程序中通过 MailTemplate.vm 生成邮件正文：

```
VelocityContext context = new VelocityContext();
context.Put("name", "ScarletGarden");
context.Put("itemList", itemList);

StringWriter writer = new StringWriter();

Velocity.MergeTemplate("MailTemplate.vm", context, writer);

string mailBody = writer.GetStringBuilder().ToString(); 
```

结果邮件正文是：

> **ScarletGarden**的示例电子邮件模板 。
> 
> Foreach 示例：
> 
> [日期：2009 年 2 月 12 日] 名称：项目 1，值：09
> 
> [日期：21.02.2009] 名称：项目 4，价值：52
> 
> [日期：01.03.2009] 名称：项目 2，值：21
> 
> [日期：23.03.2009] 名称：项目 6，值：24

对于编辑模板，也许您可​​以使用[FCKEditor](http://www.fckeditor.net/)并将您的模板保存到文件中。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-03-01T07:42:00.600

[Mail.dll 电子邮件组件](http://www.lesnikowski.com/mail/)包括电子邮件模板引擎：

这是语法概述：

```
<html>
<body>
Hi {FirstName} {LastName},

Here are your orders: 
{foreach Orders}
    Order '{Name}' sent to <strong>{Street}</strong>. 
{end}

</body>
</html> 
```

加载模板、从 c# 对象填充数据并发送电子邮件的代码：

```
Mail.Html(Template
              .FromFile("template.txt")
              .DataFrom(_contact)
              .Render())
    .Text("This is text version of the message.")
    .From(new MailBox("alice@mail.com", "Alice"))
    .To(new MailBox("bob@mail.com", "Bob"))
    .Subject("Your order")
    .UsingNewSmtp()
    .WithCredentials("alice@mail.com", "password")
    .Server("mail.com")
    .WithSSL()
    .Send(); 
```

您可以获取有关[电子邮件模板引擎](http://www.lesnikowski.com/blog/index.php/email-template-engine/)博客文章的更多信息。

或者只需下载[Mail.dll 电子邮件组件](http://www.lesnikowski.com/mail/)并试一试。

请注意，这是我创建的商业产品。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-26T18:43:28.560

如果灵活性是您的先决条件之一，那么 XSLT 可能是一个不错的选择，它完全由 .NET 框架支持，您甚至可以让用户编辑这些文件。这篇文章 ( [http://www.aspfree.com/c/a/XML/XSL-Transformations-using-ASP-NET/](http://www.aspfree.com/c/a/XML/XSL-Transformations-using-ASP-NET/) ) 可能对开始很有用（msdn 有关于它的更多信息）。正如 ScarletGarden 所说，NVelocity 是另一个不错的选择，但我更喜欢 XSLT，因为它的“内置”.NET 框架支持和平台无关。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-24T16:37:40.950

我想你也可以这样做：

创建和.aspx 页面，并将其放在OnLoad 方法的末尾，或者手动调用它。

```
 StringBuilder sb = new StringBuilder();
    StringWriter sw = new StringWriter(sb);
    HtmlTextWriter htmlTW = new HtmlTextWriter(sw);
    this.Render(htmlTW); 
```

我不确定这是否有任何潜在问题，但看起来它会起作用。这样，您可以使用功能齐全的 .aspx 页面，而不是仅支持文本替换的 MailDefinition 类。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-06T20:27:08.307

当然你可以创建一个 html 模板，我也推荐一个文本模板。在模板中，您可以将 [BODY] 放在要放置正文的位置，然后您可以阅读模板并将正文替换为新内容。您可以使用 .Nets Mail Class 发送电子邮件。最初创建电子邮件后，您只需循环将电子邮件发送给所有收件人。对我来说就像一个魅力。

```
using System.Net.Mail;

// Email content
string HTMLTemplatePath = @"path";
string TextTemplatePath = @"path";
string HTMLBody = "";
string TextBody = "";

HTMLBody = File.ReadAllText(HTMLTemplatePath);
TextBody = File.ReadAllText(TextTemplatePath);

HTMLBody = HTMLBody.Replace(["[BODY]", content);
TextBody = HTMLBody.Replace(["[BODY]", content);

// Create email code
MailMessage m = new MailMessage();

m.From = new MailAddress("address@gmail.com", "display name");
m.To.Add("address@gmail.com");
m.Subject = "subject";

AlternateView plain = AlternateView.CreateAlternateViewFromString(_EmailBody + text, new System.Net.Mime.ContentType("text/plain"));
AlternateView html = AlternateView.CreateAlternateViewFromString(_EmailBody + body, new System.Net.Mime.ContentType("text/html"));
mail.AlternateViews.Add(plain);
mail.AlternateViews.Add(html);

SmtpClient smtp = new SmtpClient("server");
smtp.Send(m); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-08-26T23:38:25.373

下面是另一种将 XSL 转换用于更复杂的电子邮件模板的替代方法：[**从 .NET 应用程序发送基于 HTML 的电子邮件**](http://alekdavis.blogspot.com/2009/08/sending-html-based-email-from-net.html)。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-27T13:22:58.150

这样做时要小心，SPAM 过滤器似乎会阻止 ASP.net 生成的 html，显然是因为 ViewState，所以如果你要这样做，请确保生成的 Html 是干净的。

我个人会考虑使用 Asp.net MVC 来实现您想要的结果。或者[NVelocity](http://www.castleproject.org/others/nvelocity/index.html)很擅长这个

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-06T20:41:36.913

> 以某种方式使用 .ASPX 页面作为模板，然后告诉我的代码为该页面提供服务，并使用为电子邮件返回的 HTML，这将是理想的。

您可以轻松地构造一个 WebRequest 来访问 ASPX 页面并获得生成的 HTML。多做一些工作，您可能无需 WebRequest 就可以完成它。PageParser 和 Response.Filter 将允许您运行页面并捕获输出......尽管可能有一些更优雅的方式。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-27T13:03:37.150

我对其中一个项目有类似的要求，您必须每天发送大量电子邮件，而客户希望完全控制不同类型电子邮件的 html 模板。

由于要发送大量电子邮件，因此性能是主要问题。

我们想出的是 sql server 中的静态内容，您可以在其中保存不同类型电子邮件的整个 html 模板标记（以及占位符，例如 [UserFirstName]、[UserLastName]，它们在运行时被真实数据替换）

然后我们将这些数据加载到 asp.net 缓存中 - 所以我们不会一遍又一遍地读取 html 模板 - 但只有在它们实际更改时

我们为客户提供了一个所见即所得的编辑器，以通过管理 Web 表单修改这些模板。每当进行更新时，我们都会重置 asp.net 缓存。

然后我们有一个单独的电子邮件日志表 - 每封要发送的电子邮件都被记录下来。该表有名为 emailType、emailSent 和 numberOfTries 的字段。

对于需要尽快发送的重要电子邮件类型（例如新会员注册、忘记密码），我们只需每 5 分钟运行一次工作

对于不太重要的电子邮件类型（如促销电子邮件、新闻电子邮件等），我们每 15 分钟运行另一项工作

这样您就不会阻止您的服务器发送不间断的电子邮件，并且您可以批量处理邮件。发送电子邮件后，您将 emailSent 字段设置为 1。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-11-17T04:05:22.937

请注意，aspx 和 ascx 解决方案需要当前的 HttpContext，因此不能在没有大量工作的情况下异步使用（例如在线程中）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-09T04:45:34.043

我认为简单的答案是 MvcMailer。它是 NuGet 包，可让您使用自己喜欢的视图引擎生成电子邮件。[请参阅此处](http://nuget.org/Packages/Search?packageType=Packages&searchCategory=All+Categories&searchTerm=mvcmailer)的 NuGet 包和[项目文档](https://github.com/smsohan/MvcMailer/wiki/MvcMailer-Step-by-Step-Guide)

希望能帮助到你！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-07T21:56:49.450

DotLiquid 是另一种选择。您从类模型中指定值`{{ user.name }}`，然后在运行时提供该类中的数据以及带有标记的模板，它将为您合并这些值。它在许多方面类似于使用 Razor 模板引擎。它支持更复杂的东西，如循环和 ToUpper 等各种功能。好消息是这些是“安全的”，因此创建模板的用户不会像在 razor 中那样使您的系统崩溃或编写不安全的代码：http: [//dotliquidmarkup.org/try-online](http://dotliquidmarkup.org/try-online)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-06T20:31:52.943

如果您能够允许 ASPNET 和相关用户读取和写入文件的权限，您可以轻松地使用带有标准`String.Format()`占位符（`{0}`、`{1:C}`等）的 HTML 文件来完成此操作。

仅使用命名空间中的类以字符串形式读取文件`System.IO`。获得该字符串后，将其作为第一个参数传递给`String.Format()`，并提供参数。

保留该字符串，并将其用作电子邮件的正文，您基本上就完成了。我们今天在几十个（诚然很小的）网站上执行此操作，并且没有遇到任何问题。

我应该注意，如果（a）您不一次发送无数电子邮件，（b）您不个性化每封电子邮件（否则您会吃掉大量字符串）和（c ) HTML 文件本身比较小。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-06T22:36:24.330

设置设置Email Message IsBodyHtml = true

获取包含您的电子邮件内容的对象序列化对象并使用 xml/xslt 生成 html 内容。

如果你想做 AlternateViews 做同样的事情 jmein 只使用不同的 xslt 模板来创建纯文本内容。

这样做的主要优点之一是如果您想更改布局，您只需更新 xslt 模板。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-30T15:24:00.940

看看 SubSonic (www.subsonicproject.com)。他们这样做是为了生成代码——模板是标准的 ASPX，它输出 c#。对于您的方案，相同的方法可以重复使用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-30T23:01:17.250

我会使用像[TemplateMachine](http://www.stefansarstedt.com/templatemaschine.html)这样的模板库。这允许您将电子邮件模板与普通文本放在一起，然后根据需要使用规则注入/替换值。与 Ruby 中的 ERB 非常相似。这使您可以将邮件内容的生成分开，而不会将您与 ASPX 等类似的东西过于紧密地联系在一起。然后，一旦生成了内容，您就可以通过电子邮件发送出去。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-30T23:15:19.697

我喜欢拉杰的回答。像 ListManager 这样的程序和像 DNN 这样的框架做类似的事情，如果需要由非技术用户轻松编辑，所见即所得的编辑器来修改存储在 SQL 中的 HTML 是一种最简单、直接的方法，并且可以轻松地独立于页脚编辑页眉，等，以及使用令牌动态插入值。

如果使用上述方法（或任何方法，真的），要记住的一件事是严格和小心您允许编辑器插入哪些类型的样式和标签。如果您认为浏览器很挑剔，请等到您看到电子邮件客户端呈现相同内容的方式有何不同...

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-01-28T21:30:02.147

类似于 Canavar 的答案，但不是 NVelocity，而是我总是使用“ [StringTemplate](http://www.stringtemplate.org/) ”，我从配置文件加载模板，或者使用 File.ReadAllText() 加载外部文件并设置值。

这是一个 Java 项目，但 C# 端口是可靠的，我已经在几个项目中使用过它（只是将它用于使用外部文件中的模板进行电子邮件模板化）。

替代品总是好的。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-10-18T19:28:13.700

这是使用**WebClient**类的简单方法：

```
public static string GetHTMLBody(string url)
{
    string htmlBody;

    using (WebClient client = new WebClient ())
    {
        htmlBody = client.DownloadString(url);
    }

    return htmlBody;
} 
```

然后像这样调用它：

```
string url = "http://www.yourwebsite.com";
message.Body = GetHTMLBody(url); 
```

当然，您的 CSS 需要内联，以便在大多数电子邮件客户端（例如 Outlook）中显示网页的样式。如果您的电子邮件显示动态内容（例如客户姓名），那么我建议在您的网站上使用 QueryStrings 来填充数据。（例如[http://www.yourwebsite.com?CustomerName=Bob](http://www.yourwebsite.com?CustomerName=Bob)）

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-08-30T22:45:33.837

@bardev 提供了一个很好的解决方案，但不幸的是它在所有情况下都不是理想的。我的就是其中之一。

我在 VS 2013 中在网站中使用 WebForms（我发誓我永远不会再使用网站——多么 PITA）。

我尝试了 Razor 的建议，但作为一个网站，我没有获得 IDE 在 MVC 项目中提供的最重要的 IntelliSense。我还喜欢在我的模板中使用设计器——这是 UserControl 的完美位置。

尼克斯再次上剃刀。

所以我想出了这个小框架（@mun 用于 UserControl，@imatoria 用于强类型）。我能看到的唯一潜在的麻烦点是你必须小心保持你的 .ASCX 文件名与其类名同步。如果你迷路了，你会得到一个运行时错误。

FWIW：在我的测试中，至少 RenderControl() 调用不喜欢 Page 控件，所以我选择了 UserControl。

我很确定我已经在这里包含了所有内容。如果我遗漏了什么，请告诉我。

高温高压

用法：

```
Partial Class Purchase
  Inherits UserControl

  Private Sub SendReceipt()
    Dim oTemplate As MailTemplates.PurchaseReceipt

    oTemplate = MailTemplates.Templates.PurchaseReceipt(Me)
    oTemplate.Name = "James Bond"
    oTemplate.OrderTotal = 3500000
    oTemplate.OrderDescription = "Q-Stuff"
    oTemplate.InjectCss("PurchaseReceipt")

    Utils.SendMail("{0} <james.bond@mi6.co.uk>".ToFormat(oTemplate.Name), "Purchase Receipt", oTemplate.ToHtml)
  End Sub
End Class 
```

基类：

```
Namespace MailTemplates
  Public MustInherit Class BaseTemplate
    Inherits UserControl

    Public Shared Function GetTemplate(Caller As TemplateControl, Template As Type) As BaseTemplate
      Return Caller.LoadControl("~/MailTemplates/{0}.ascx".ToFormat(Template.Name))
    End Function

    Public Sub InjectCss(FileName As String)
      If Me.Styler IsNot Nothing Then
        Me.Styler.Controls.Add(New Controls.Styler(FileName))
      End If
    End Sub

    Private ReadOnly Property Styler As PlaceHolder
      Get
        If _Styler Is Nothing Then
          _Styler = Me.FindNestedControl(GetType(PlaceHolder))
        End If

        Return _Styler
      End Get
    End Property
    Private _Styler As PlaceHolder
  End Class
End Namespace 
```

“工厂”类：

```
Namespace MailTemplates
  Public Class Templates
    Public Shared ReadOnly Property PurchaseReceipt(Caller As TemplateControl) As PurchaseReceipt
      Get
        Return BaseTemplate.GetTemplate(Caller, GetType(PurchaseReceipt))
      End Get
    End Property
  End Class
End Namespace 
```

模板类：

```
Namespace MailTemplates
  Public MustInherit Class PurchaseReceipt
    Inherits BaseTemplate

    Public MustOverride WriteOnly Property Name As String
    Public MustOverride WriteOnly Property OrderTotal As Decimal
    Public MustOverride WriteOnly Property OrderDescription As String
  End Class
End Namespace 
```

ASCX 标头：

```
<%@ Control Language="VB" ClassName="_Header" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--
  See https://www.campaignmonitor.com/blog/post/3317/ for discussion of DocType in HTML Email
-->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <asp:PlaceHolder ID="plcStyler" runat="server"></asp:PlaceHolder>
</head>
<body> 
```

ASCX 页脚：

```
<%@ Control Language="VB" ClassName="_Footer" %>

</body>
</html> 
```

ASCX 模板：

```
<%@ Control Language="VB" AutoEventWireup="false" CodeFile="PurchaseReceipt.ascx.vb" Inherits="PurchaseReceipt" %>

<%@ Register Src="_Header.ascx" TagName="Header" TagPrefix="uc" %>
<%@ Register Src="_Footer.ascx" TagName="Footer" TagPrefix="uc" %>

<uc:Header ID="ctlHeader" runat="server" />

  <p>Name: <asp:Label ID="lblName" runat="server"></asp:Label></p>
  <p>Order Total: <asp:Label ID="lblOrderTotal" runat="server"></asp:Label></p>
  <p>Order Description: <asp:Label ID="lblOrderDescription" runat="server"></asp:Label></p>

<uc:Footer ID="ctlFooter" runat="server" /> 
```

ASCX 模板代码文件：

```
Partial Class PurchaseReceipt
  Inherits MailTemplates.PurchaseReceipt

  Public Overrides WriteOnly Property Name As String
    Set(Value As String)
      lblName.Text = Value
    End Set
  End Property

  Public Overrides WriteOnly Property OrderTotal As Decimal
    Set(Value As Boolean)
      lblOrderTotal.Text = Value
    End Set
  End Property

  Public Overrides WriteOnly Property OrderDescription As Decimal
    Set(Value As Boolean)
      lblOrderDescription.Text = Value
    End Set
  End Property
End Class 
```

帮手：

```
'
' FindNestedControl helpers based on tip by @andleer
' at http://stackoverflow.com/questions/619449/
'

Public Module Helpers
  <Extension>
  Public Function AllControls(Control As Control) As List(Of Control)
    Return Control.Controls.Flatten
  End Function

  <Extension>
  Public Function FindNestedControl(Control As Control, Id As String) As Control
    Return Control.Controls.Flatten(Function(C) C.ID = Id).SingleOrDefault
  End Function

  <Extension>
  Public Function FindNestedControl(Control As Control, Type As Type) As Control
    Return Control.Controls.Flatten(Function(C) C.GetType = Type).SingleOrDefault
  End Function

  <Extension>
  Public Function Flatten(Controls As ControlCollection) As List(Of Control)
    Flatten = New List(Of Control)

    Controls.Traverse(Sub(Control) Flatten.Add(Control))
  End Function

  <Extension>
  Public Function Flatten(Controls As ControlCollection, Predicate As Func(Of Control, Boolean)) As List(Of Control)
    Flatten = New List(Of Control)

    Controls.Traverse(Sub(Control)
                        If Predicate(Control) Then
                          Flatten.Add(Control)
                        End If
                      End Sub)
  End Function

  <Extension>
  Public Sub Traverse(Controls As ControlCollection, Action As Action(Of Control))
    Controls.Cast(Of Control).ToList.ForEach(Sub(Control As Control)
                                               Action(Control)

                                               If Control.HasControls Then
                                                 Control.Controls.Traverse(Action)
                                               End If
                                             End Sub)
  End Sub

  <Extension()>
  Public Function ToFormat(Template As String, ParamArray Values As Object()) As String
    Return String.Format(Template, Values)
  End Function

  <Extension()>
  Public Function ToHtml(Control As Control) As String
    Dim oSb As StringBuilder

    oSb = New StringBuilder

    Using oSw As New StringWriter(oSb)
      Using oTw As New HtmlTextWriter(oSw)
        Control.RenderControl(oTw)
        Return oSb.ToString
      End Using
    End Using
  End Function
End Module

Namespace Controls
  Public Class Styler
    Inherits LiteralControl

    Public Sub New(FileName As String)
      Dim _
        sFileName,
        sFilePath As String

      sFileName = Path.GetFileNameWithoutExtension(FileName)
      sFilePath = HttpContext.Current.Server.MapPath("~/Styles/{0}.css".ToFormat(sFileName))

      If File.Exists(sFilePath) Then
        Me.Text = "{0}<style type=""text/css"">{0}{1}</style>{0}".ToFormat(vbCrLf, File.ReadAllText(sFilePath))
      Else
        Me.Text = String.Empty
      End If
    End Sub
  End Class
End Namespace

Public Class Utils
  Public Shared Sub SendMail(Recipient As MailAddress, Subject As String, HtmlBody As String)
    Using oMessage As New MailMessage
      oMessage.To.Add(Recipient)
      oMessage.IsBodyHtml = True
      oMessage.Subject = Subject.Trim
      oMessage.Body = HtmlBody.Trim

      Using oClient As New SmtpClient
        oClient.Send(oMessage)
      End Using
    End Using
  End Sub
End Class 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-08-29T16:40:13.463

只需将我正在使用的库放入混合中： [https ://github.com/lukencode/FluentEmail](https://github.com/lukencode/FluentEmail)

它使用[RazorLight](https://github.com/toddams/RazorLight)渲染电子邮件，使用 fluent 样式构建电子邮件，并支持开箱即用的多个发件人。它也带有 ASP.NET DI 的扩展方法。使用简单，设置少，支持纯文本和 HTML。

# sql - 选择与时间对应的所有行

> ID：620272
> 
> 赞同：0
> 
> 时间：2009-03-06T20:25:43.973
> 
> 标签：sql, mysql

我有一个每分钟发送电子邮件的脚本。当它开始循环时，它会在数据库中查询所有等于当前 UTC 时间的条目。我想让它找到数据库中与当前时间对应的所有条目，直到分钟。

所以有一个“时间”列存储 UTC 时间：“2009-03-06 20:18:31”。当它搜索时，有什么方法可以忽略秒属性而不改变我存储时间的方式？

编辑：我正在使用 mysql 服务器。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:37:20.590

在**MySQL**中：

```
SELECT *
FROM   table
WHERE  time >= NOW() - INTERVAL EXTRACT(SECOND FROM NOW()) SECOND
       AND time < NOW() - INTERVAL (EXTRACT(SECOND FROM NOW()) + 60) SECOND 
```

这将有效地使用`time`字段索引。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T20:31:11.620

我之前执行过这个逻辑：

查询：TimeField >=（现在 - 1 分钟）。

您还可以修改此逻辑以查询 TimeField >= (Now - # of seconds pass in the current minute) - 这可能更准确地检索您要查找的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T20:34:17.710

确保对不等式的“现在”部分进行计算。在 SQL Server 中，您可以使用 DATEADD(mi, -1, GETDATE())。如果您在列上执行该函数，您最终可能会生成一个 RBAR 操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T20:34:26.680

```
where datediff(minute, Time, getdate()) = 0 
```

这将适用于 SQL Server，但由于您没有指定您正在使用的服务器，因此很难判断它是否适合您。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T01:10:52.000

这是我使用的实际 sql 语句。请注意，Quassnoi 的反应对它的影响很大，但也存在一些关键差异。我使用了 UTC_TIMESTAMP 而不是 NOW()。

```
select * 
from table
where time < UTC_TIMESTAMP() + INTERVAL(1) MINUTE  - INTERVAL (EXTRACT(SECOND FROM UTC_TIMESTAMP())) SECOND 
and time >= UTC_TIMESTAMP() - INTERVAL (EXTRACT(SECOND FROM UTC_TIMESTAMP())) SECOND; 
```

# php - 通过 PHP 检查浏览器的语言？

> ID：620276
> 
> 赞同：9
> 
> 时间：2009-03-06T20:26:45.733
> 
> 标签：php, browser

如何通过 PHP 检查用户浏览器的语言？

我需要为美国和英国的人显示不同的页面。

我尝试了以下代码不成功

```
<?php
if(ereg("us", $_SERVER["HTTP_ACCEPT_LANGUAGE"]))
   include('http://page.com/us.txt');
else
   include('http://page.com/uk.txt');
?> 
```

我为美国和英国的人们运行了一个特定的代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-06T21:40:33.433

可能只是区分大小写的问题；eregi('en-us') 或 preg_match('/en-us/i') 应该已经把它捡起来了。

但是，有时仅在标题中查找“en-us”可能会出错，尤其是在同时列出美国和英国语言时。“Accept-Language”实际上是一个相当复杂的标题，你真的需要一个合适的解析器。

如果你有 PECL，整个工作已经为你完成了：[http ://www.php.net/manual/en/function.http-negotiate-language.php](http://www.php.net/manual/en/function.http-negotiate-language.php)

我不知道为什么其他答案是针对 User-Agent 标头的；这完全是假的。User-Agent 没有强制要求在任何特定位置保存语言值，对于某些浏览器（例如 Opera，以及一些我从未听说过的称为“Internet Explorer”的小型浏览器），它根本不会。如果它*确实*包含一种语言，那将是安装浏览器构建时使用的语言，而不是您应该查看的用户首选语言。（此设置将默认为构建语言，但用户可以从首选项 UI 自定义。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T20:57:33.333

试试这个：

```
<?
if(preg_match('/en-us/i', $_SERVER['HTTP_USER_AGENT']))
    include('http://page.com/us.txt');
else
    include('http://page.com/uk.txt');
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T20:41:46.447

一种*可能*更可靠的方法是对`$_SERVER['HTTP_USER_AGENT']`字符串执行正则表达式。

```
<?php
  if(preg_match('/en-US/', $_SERVER['HTTP_USER_AGENT']))
    include('http://page.com/us.txt');
  else
    include('http://page.com/uk.txt');
?> 
```

不能保证您获得有效且有用的用户代理字符串，因此请确保 else 语句包含合理的替代方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-22T12:04:45.853

这是一个基于 zend 的解决方案。当您添加其他语言时，它也将起作用。

```
<?php

include_once "Zend/Locale.php";

$zend_locale = new Zend_Locale(Zend_Locale::BROWSER);

// returns en for English, de for German etc.
echo $browser_language = $zend_locale->getLanguage();
echo "<br />\n";
// returns en_US for American English, en_GB for British English etc.
echo $browser_locale = $zend_locale->toString();
echo "<br />\n"; 
```

解决方案见于：

[http://www.mpopp.net/2010/07/how-to-detect-the-users-preferred-language-smarter-than-google/](http://www.mpopp.net/2010/07/how-to-detect-the-users-preferred-language-smarter-than-google/)

# c# - #develop 的设置编辑器？

> ID：620281
> 
> 赞同：0
> 
> 时间：2009-03-06T20:27:56.010
> 
> 标签：c#, settings, sharpdevelop

使用 Visual C# Express，如果我双击 Properties/Settings.settings 文件，我会自动获得一个特殊的设置编辑器。在#develop 下执行相同操作只会生成标准编辑器，并且看起来 Settings.Designer.cs 没有更新，因此也必须手动更新。是否有我缺少的#develop 插件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T22:20:00.017

SharpDevelop 可能没有针对“.settings”文件的特定编辑器/设计器实现。查看[他们的 wiki](http://wiki.sharpdevelop.net/Default.aspx?Page=FeaturesWeSolicitHelpFor)看起来他们正在寻求#develop 的设置设计器的帮助......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T22:27:25.257

SharpDevelop 是一个很好的免费 IDE，它有很多很好的功能，我希望在 VS2008 pro 中，我想到了测试覆盖率，但是作为一个开源项目缺少一些东西，例如很多特殊的编辑器，我认为最部分原因是它的目标受众不使用它们。

好消息是，如果它对您很重要，您可以编写一个插件并回馈社区。

# java - 是否可以创建一个日历对象，如 Tue Mar 03 13:43:00（无时区）？

> ID：620283
> 
> 赞同：1
> 
> 时间：2009-03-06T20:29:09.113
> 
> 标签：java, calendar, timezone

我需要发送带有时区的日历对象，例如`Tue Mar 03 13:43:00`. 我知道 Calendar 对象总是返回`Tue Mar 03 13:43:00 CST 2009`，那么如何在没有时区的情况下创建它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T04:47:52.580

没有 TimeZone 的 Calendar 对象是不可能的。真的，这没有任何意义——日历试图表示“[特定的时间瞬间](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html)”——你怎么能在不知道你所代表的时间所在的 TimeZone 的情况下及时表示一个实例？

所以，有几点需要考虑：

1.  您说您需要将此日历传递给其他一些组件-该 API 是否关心日历所在的 TimeZone？该 API 是否会忽略 TimeZone 设置，使用它来计算与它自己的本地时区的时差等？
2.  您是否知道可以轻松更改日历实例的时区？

    ```
    Calendar cal = Calendar.getInstance();
    cal.setTimeZone(TimeZone.getDefault()); // returns default TimeZone for your system
    cal.setTimeZone(TimeZone.getTimeZone("EST")); // Eastern Standard Time
    cal.setTimeZone(TimeZone.getTimeZone("Asia/Kolkota"); // UTC+5:30 
    ```

[Calendar](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html)和[TimeZone](http://java.sun.com/javase/6/docs/api/java/util/TimeZone.html)上的 Javadocs 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T20:34:58.257

您可以使用[DateFormat](http://java.sun.com/javase/6/docs/api/java/text/DateFormat.html)类（更具体地说是[SimpleDateFormat](http://java.sun.com/javase/6/docs/api/java/text/SimpleDateFormat.html)具体子类）来根据需要格式化日期。这是一个例子：

```
Calendar cal = Calendar.getInstance();
DateFormat format = new SimpleDateFormat("EEE MMM dd HH:mm:ss");

String dateString = format.format(cal.getTime())); 
```

印刷：

```
周五 3 月 6 日 15:50:26
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T21:14:11.563

您可以使用简单的 Date 对象；

```
Date d = new Date();
Date d2 = calendar.getTime(); 
```

或者更简单的，以毫秒为单位的时间。

```
long time = System.currentTimeMillis(); 
```

为避免时区混淆，我建议将所有日期/时间存储并设置为标准时区，例如 GMT+0，然后根据需要转换显示时间等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T21:22:52.087

在重新阅读您的问题和您对我的其他答案的评论后，听起来问题是您希望结果是日历对象，而不是字符串。所以这不是格式化日历的字符串表示的问题。

在这种情况下，您要问的问题在技术上是不可能的：Calendar 类的所有实现都存在以表示内部时间，该时间存储为自 Unix 纪元（1970 年 1 月 1 日 00:00 GMT）以来的毫秒数。波士顿的时间“5:00 am”与西雅图的“5:00 am”不同——它们有不同的内部时间戳。

您最好的选择是在任何地方都使用相同的时区，而 GMT 可能最适合此目的：

```
cal.setTimeZone(TimeZone.getTimeZone("GMT+0000")); 
```

# php - 计算 MySQL 数据库中的多个条目？

> ID：620285
> 
> 赞同：0
> 
> 时间：2009-03-06T20:30:20.030
> 
> 标签：php, mysql

我正在尝试计算 MySQL 数据库中的多个条目，我知道如何使用 COUNT()，但是我想获得所需结果的确切语法却让我望而却步。

问题：表结构：ID、CODE、AUTHOR、COUNTRY、TIMESTAMP。

代码、作者和国家在表中多次重叠。我试图发现是否有一个简单的查询可以运行以返回（使用 COUNTRY 上的 WHERE 子句）作者字段、代码字段，然后是计算代码在查询中出现的次数的最终字段结果。

所以，理论上我可以得到一个像这样的数组：

```
array('author', 'code', 'codeAppearsNTimes'); 
```

作者也有与之相关的不同代码，所以我不希望结果合并。我想最终的结果是：“这个作者与这段代码关联了很多次”。

这对 MySQL 可行吗？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:32:10.370

```
SELECT author, code, COUNT(*)
FROM   table
WHERE  country = @country
GROUP BY
       author, code 
```

# http - HTTP 1.0 和 1.1 有什么区别？

> ID：620290
> 
> 赞同：9
> 
> 时间：2009-03-06T20:31:24.550
> 
> 标签：http, http-headers

最新的 StackOverflow[播客](https://blog.stackoverflow.com/2009/03/podcast-44/)激起了我对 HTTP 1.0 和 HTTP 1.1 之间差异的兴趣。

谁能提供一个简单的列表，列出 HTTP 1.0 和 HTTP 1.1 规范之间的主要区别？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T20:34:35.760

你检查过[HTTP/1.1 – 19.6.1 从 HTTP/1.0 的变化](http://www.w3.org/Protocols/rfc2616/rfc2616-sec19.html#sec19.6.1)吗？

# wpf - DataBind 字符串到 DataTemplated 复选框

> ID：620293
> 
> 赞同：2
> 
> 时间：2009-03-06T20:31:55.767
> 
> 标签：wpf, data-binding, .net-3.5

我想在 WPF 中创建一个填充有复选框的 ListBox，并且我想将“内容”值与一个简单的字符串值进行数据绑定。但是，当我尝试`<CheckBox Margin="5" Content="{Binding}" />`应用程序崩溃时。

这就是我所拥有的。（我确定我错过了一些简单的东西）

```
<ListBox Grid.Row="1" IsSynchronizedWithCurrentItem="True" x:Name="drpReasons">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" >
                            </WrapPanel>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.Resources>
                        <DataTemplate DataType="{x:Type System:String}">
                            <CheckBox Margin="5" Content="{Binding}" />
                    </DataTemplate>
                    </ListBox.Resources>
                </ListBox> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T20:54:09.613

您创建了一个无限递归的 DataTemplate。通过为 String 设置 DataTemplate，然后将 CheckBox 的 Content 设置为 String，CheckBox 将使用 DataTemplate 本身，因此您将在 CheckBoxes 中拥有 CheckBoxes，依此类推。

您可以通过在 CheckBox 中显式放置一个 TextBlock 来修复它：

```
<ListBox x:Name="drpReasons" Grid.Row="1" IsSynchronizedWithCurrentItem="True">
    <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal">
            </WrapPanel>
        </ItemsPanelTemplate>
    </ListBox.ItemsPanel>
    <ListBox.Resources>
        <DataTemplate DataType="{x:Type sys:String}">
            <CheckBox Margin="5">
                <TextBlock Text="{Binding}"/>
            </CheckBox>
        </DataTemplate>
    </ListBox.Resources>
</ListBox> 
```

# svn - 使用 CruiseControl.Net 和 SVN

> ID：620295
> 
> 赞同：0
> 
> 时间：2009-03-06T20:32:09.900
> 
> 标签：svn, cruisecontrol.net

我正在尝试使用 Cruisecontrol.net 检查 svn 存储库是否有更新，然后导出更新的项目。我是 Cruisecontrol 的新手，不知道该怎么做。任何帮助都会很棒。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T21:03:52.460

抱歉，如果这没有帮助……但请查看 Scott Cowan 的博客。他对 CruiseControl.NET 和 SVN 有很好的处理。你可能会在那里找到你要找的东西。

[http://sleepoverrated.com/archive/2007/12/buildknowledgepromotingyourbuild/](http://sleepoverrated.com/archive/2007/12/buildknowledgepromotingyourbuild/)

我也在这个stackoverflow问题上发表了同样的帖子：

[将 SVN 设置为 Best Suit Dev -> QA -> Prod](https://stackoverflow.com/questions/616254/setting-up-svn-to-best-suit-dev-qa-prod/616357#616357)

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:12:22.843

以下是如何设置 CruiseControl 以检查更新并将代码拉入本地存储库

[http://confluence.public.thoughtworks.org/display/CCNET/Subversion+Source+Control+Block](http://confluence.public.thoughtworks.org/display/CCNET/Subversion+Source+Control+Block)

然后，如果您要导出，我会做的是使用可执行任务

[http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task](http://confluence.public.thoughtworks.org/display/CCNET/Executable+Task)

调用 svn 可执行文件并将所需的导出标志和参数传递给它。

# python - 在 Python 中将年/月/日转换为年中的某天

> ID：620305
> 
> 赞同：163
> 
> 时间：2009-03-06T20:34:32.220
> 
> 标签：python, datetime

我正在使用该[`datetime`](https://docs.python.org/3/library/datetime.html)模块，即：

```
>>> import datetime
>>> today = datetime.datetime.now()
>>> print(today)
2009-03-06 13:24:58.857946 
```

我想计算考虑闰年的一年中的哪一天。例如，今天（2009 年 3 月 6 日）是 2009 年的第 65 天。

我看到两个选项：

1.  创建一个`number_of_days_in_month = [31, 28, ...]`数组，确定它是否是闰年并手动总结天数。

2.  用于`datetime.timedelta`猜测，然后对一年中的正确日期进行二进制搜索：

    ```
    >>> import datetime
    >>> YEAR = 2009
    >>> DAY_OF_YEAR = 62
    >>> d = datetime.date(YEAR, 1, 1) + datetime.timedelta(DAY_OF_YEAR - 1) 
    ```

这些都感觉很笨拙，我有一种直觉，有一种更“Pythonic”的方式来计算一年中的哪一天。有什么想法/建议吗？

* * *

## 回答 #1

> 赞同：314
> 
> 时间：2009-03-08T09:27:24.177

用于[`datetime.timetuple()`](https://docs.python.org/3/library/datetime.html#datetime.datetime.timetuple)将您的`datetime`对象转换为[`time.struct_time`](https://docs.python.org/3/library/time.html#time.struct_time)对象，然后获取其[`tm_yday`](https://docs.python.org/3/library/time.html#time.struct_time)属性：

```
from datetime import datetime
day_of_year = datetime.now().timetuple().tm_yday  # returns 1 for January 1st 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-03-06T20:37:27.297

您可以使用[`strftime`](https://docs.python.org/3/library/datetime.html#datetime.datetime.strftime)格式[`%j`字符串](https://docs.python.org/3/library/datetime.html#strftime-and-strptime-format-codes)：

```
>>> import datetime
>>> today = datetime.datetime.now()
>>> today.strftime('%j')
'065' 
```

但是如果你想用这个数字进行比较或计算，你必须将它转换为，`int()`因为`strftime()`返回一个字符串。如果是这种情况，最好使用[DzinX 的](https://stackoverflow.com/questions/620305/convert-year-month-day-to-day-of-year-in-python/623312#623312)答案。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-10-23T14:28:51.133

[DZinX 的回答](https://stackoverflow.com/a/623312/40785)是对这个问题的一个很好的回答。我在寻找反函数时发现了这个问题并使用[了 DZinX 的答案：将带有朱利安年的日期转换为日期时间。](https://stackoverflow.com/a/623312/40785)

我发现这个工作：

```
import datetime
datetime.datetime.strptime('1936-077T13:14:15','%Y-%jT%H:%M:%S')

>>>> datetime.datetime(1936, 3, 17, 13, 14, 15)

datetime.datetime.strptime('1936-077T13:14:15','%Y-%jT%H:%M:%S').timetuple().tm_yday

>>>> 77 
```

或数字：

```
import datetime
year,julian = [1936,77]
datetime.datetime(year, 1, 1)+datetime.timedelta(days=julian -1)

>>>> datetime.datetime(1936, 3, 17, 0, 0) 
```

或者使用在某些领域流行的基于小数 1 的 jdate：

```
jdate_frac = (datetime.datetime(1936, 3, 17, 13, 14, 15)-datetime.datetime(1936, 1, 1)).total_seconds()/86400+1
display(jdate_frac)

>>>> 77.5515625

year,julian = [1936,jdate_frac]
display(datetime.datetime(year, 1, 1)+datetime.timedelta(days=julian -1))

>>>> datetime.datetime(1936, 3, 17, 13, 14, 15) 
```

我不确定这里的礼仪，但我认为指向反向功能的指针可能对像我这样的其他人有用。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-05-11T13:58:49.603

如果您有理由避免使用该`datetime`模块，那么这些功能将起作用。

```
def is_leap_year(year):
    """ if year is a leap year return True
        else return False """
    if year % 100 == 0:
        return year % 400 == 0
    return year % 4 == 0

def doy(Y,M,D):
    """ given year, month, day return day of year
        Astronomical Algorithms, Jean Meeus, 2d ed, 1998, chap 7 """
    if is_leap_year(Y):
        K = 1
    else:
        K = 2
    N = int((275 * M) / 9.0) - K * int((M + 9) / 12.0) + D - 30
    return N

def ymd(Y,N):
    """ given year = Y and day of year = N, return year, month, day
        Astronomical Algorithms, Jean Meeus, 2d ed, 1998, chap 7 """    
    if is_leap_year(Y):
        K = 1
    else:
        K = 2
    M = int((9 * (K + N)) / 275.0 + 0.98)
    if N < 32:
        M = 1
    D = N - int((275 * M) / 9.0) + K * int((M + 9) / 12.0) + 30
    return Y, M, D 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-06T20:43:04.413

只需从日期中减去 1 月 1 日：

```
import datetime
today = datetime.datetime.now()
day_of_year = (today - datetime.datetime(today.year, 1, 1)).days + 1 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-15T16:29:18.170

我想展示不同方法在 Python 3.4、Linux x64 上的性能。线轮廓仪的摘录：

```
 Line #      Hits         Time  Per Hit   % Time  Line Contents
      ==============================================================
         (...)
         823      1508        11334      7.5     41.6          yday = int(period_end.strftime('%j'))
         824      1508         2492      1.7      9.1          yday = period_end.toordinal() - date(period_end.year, 1, 1).toordinal() + 1
         825      1508         1852      1.2      6.8          yday = (period_end - date(period_end.year, 1, 1)).days + 1
         826      1508         5078      3.4     18.6          yday = period_end.timetuple().tm_yday
         (...) 
```

所以最有效的是

```
yday = (period_end - date(period_end.year, 1, 1)).days 
```

# jquery - jQuery 表单验证插件：要求电子邮件为 .EDU 地址

> ID：620311
> 
> 赞同：2
> 
> 时间：2009-03-06T20:35:42.950
> 
> 标签：jquery, ajax, email, forms, validation

我正在尝试构建一个仅接受 .EDU 电子邮件地址的注册表单。我还想保留我拥有的 AJAX 功能（使用“远程”参数），以确保以前没有使用过电子邮件地址。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T20:46:10.413

```
$.validator.addMethod("edu-email", 
    function(value) {
        return (value.endsWith(".edu"));
    },
    "e-mail address must end in .edu."
); 
```

JavaScript 没有 string.endsWith。您必须添加自己的。

现在将“edu-email”添加到表单输入类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T20:45:56.450

没关系 - 想通了！

只需使用`jQuery.validator.addMethod`创建一个函数来检查最后 3 个字母的子字符串，保持我的其他代码不变，并在我的 HTML 中添加一个引用添加方法的类。

# perl - 如何使用 DBI 在 Postgres 中执行“\从远程表复制”命令？

> ID：620319
> 
> 赞同：3
> 
> 时间：2009-03-06T20:37:19.420
> 
> 标签：perl, copy, dbi

我需要从远程 PostgreSQL 服务器复制到本地服务器。我不能使用任何 ETL 工具，必须使用 Perl 和 DBI 来完成。这个数据会很大，所以我不想使用“从源中选择”和“插入到本地”。我希望使用 COPY 创建一个文件，但是这个文件将在远程服务器上创建。我也做不到。我想改用 \COPY 。

如何使用 DBI 执行“\从远程表复制”命令并在 Perl 中使用 DBI 创建本地文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-17T15:26:16.507

您可以使用 DBD::Pg 在 perl 中执行此操作，可以在此处找到详细信息：

[https://metacpan.org/pod/DBD::Pg#COPY-support](https://metacpan.org/pod/DBD::Pg#COPY-support)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:10:18.560

您肯定希望使用“复制自”和“复制到”命令有效地将数据进出数据库。它们比迭代数据行快几个数量级。许多人还希望在将数据复制到目标表时关闭索引，然后在复制完成时启用它们（并让它们构建）。

假设您只是连接到两个数据库的侦听器端口，只需打开到源数据库的连接，将表复制到文件，打开到目标数据库的连接并将文件复制回目标表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-07T16:50:39.780

您可以使用 ~/.pgpass 并为自己保存导出 PGUSER 的东西，并将密码保留在环境之外......（从安全角度来看总是一个好主意）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T06:17:11.390

唔。 `\copy to ...`是一个`psql`指令，而不是 SQL，因此 DBI 或另一端的 PostgreSQL 服务器不会理解它。

我看到 PostgreSQL 的 SQL`COPY`命令有`FROM STDIN`和`TO STDOUT`选项——但我怀疑 DBI 是否有办法执行访问结果数据所需的“原始读取”。（我确定内部`TO STDOUT`是如何`psql`实现`\copy to ...`的。）

所以：在你的情况下，我会使用例如 samba 或 nfs 将源盒上的文件夹安装回目标盒，并使用普通的 old `COPY TO '/full/path/to/mounted/folder/data.txt' ...`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T21:24:34.253

我使用 \copy (select * from remote_table) to '/local/file.txt' ... 然后 \copy local_table from '/local/file.txt' 将文件加载到本地数据库中。我从 psql 脚本执行了 \copy 命令。

这是我的脚本

导出 PGUSER=remoteuser 导出 PGPASSWORD=remotepwd

/opt/PostgreSQL/8.3/bin/psql -h xx.xx.xx -p 5432 -d remotedb -c "\COPY (select * from remote_table where date(reccreationtime e) = date((current_date - interval '4 day' ))) TO '/local/copied_from_remote.txt' D ELIMITER '|'"

导出 PGUSER=localuser 导出 PGPASSWORD=localpwd

/opt/PostgreSQL/8.3/bin/psql -h xx.xx.xx.xx -p 5432 -d localdb -c "\COPY local_table FROM '/local/copied_from_remote.txt' DELIMITER '|'"

# sql-server - 无法访问属性 spatialindextype

> ID：620323
> 
> 赞同：0
> 
> 时间：2009-03-06T20:37:31.340
> 
> 标签：sql-server, sql-server-2008, spatial

我正在使用 SQL Server 2008，我尝试编写我的一张表的脚本，我收到错误“无法访问属性 SpatialIndexType 这在 Sql Server 2005 中不可用”。麻烦的是，我用的是2008。

我不知道这是什么意思。我只想编写表格脚本，这样我就可以在开发数据库中创建它，而无需手动添加所有列。我的数据库脚本中的大多数其他表都很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T16:33:05.397

检查您正在使用的数据库的兼容性级别。数据库属性，选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:05:13.143

您是否使用 2008 Management Studio，但连接到 2005 数据库？

# html - XML文件中的url是什么意思

> ID：620332
> 
> 赞同：2
> 
> 时间：2009-03-06T20:39:38.167
> 
> 标签：html, xml, url

我总是在 HTML 文件、XML、XSD 上找到这个 URL（或类似的 URL）……比如“ [http://www.w3.org/2001/XMLSchema](http://www.w3.org/2001/XMLSchema) ”或“ [http://www.w3.org/2001 ” /XMLSchema-instance](http://www.w3.org/2001/XMLSchema-instance) " 我总是想知道这些 URL 是什么意思。即使是离线的 XML 或 HTML 文档也无需更改即可工作。链接到这些 URL 有什么好处？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T20:43:06.707

这些 URL 不一定指向任何网站/服务器。它们是一种方便的命名机制。这个想法是因为每家公司都会有一个独特的网站，使用它作为他们的命名空间将避免冲突。因此具有更好的互操作性。故此风俗。

[XML 1.0 规范中的命名空间](http://www.w3.org/TR/REC-xml-names/)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-06T20:42:15.413

它是[XML 模式](http://en.wikipedia.org/wiki/XML_schema)。

> XML 模式以相对较高的抽象级别提供文​​档类型的视图。

# c# - 测试 WCF 服务的最佳方法是什么？

> ID：620333
> 
> 赞同：42
> 
> 时间：2009-03-06T20:39:42.050
> 
> 标签：c#, .net, wcf

我使用了微软随 Visual Studio 提供的这个工具，因为它又快又脏

[http://msdn.microsoft.com/en-us/library/bb552364.aspx](http://msdn.microsoft.com/en-us/library/bb552364.aspx)

但它有点笨重且难以使用。是否还有其他有用的测试客户端可供您使用并且不需要创建新的 Visual Studio 项目和编译代码？

编辑：我正在寻找更多的图形测试工具，我可以使用它在我们不同的环境中对系统进行快速的临时测试，而无需编写一堆不同的测试。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-06T20:51:12.163

[SoapUI](http://www.soapui.org/)是另一个 Web 服务测试工具。我强烈推荐它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-06T21:38:50.863

您找不到比使用您最喜欢的单元测试框架和编写测试更好的工具来创建 WCF 服务的自动化测试。测试客户端和soapUI 都不会创建一个可以在持续集成场景中运行的测试。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-10-15T18:51:20.247

[WCFStorm](http://www.wcfstorm.com/)可用于测试您描述的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-14T20:03:56.490

[http://blogs.msdn.com/b/wcftoolsteamblog/archive/2010/01/04/tips-for-launching-wcf-test-client.aspx](http://blogs.msdn.com/b/wcftoolsteamblog/archive/2010/01/04/tips-for-launching-wcf-test-client.aspx)

以下是测试不同 wcf 场景的一些技巧。

![在此处输入图像描述](https://i.stack.imgur.com/dbcPZ.jpg)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-12T17:44:59.480

我用它的 15 天评估运行了 WcfStorm，我对它印象深刻。连接到服务并公开所有方法。单击一个方法，您可以构建多个测试用例。完成后，您可以保存这些测试（将我的作为解决方案文件保存在服务中），并且当您进行更改时，您可以运行所有满足连续测试的测试。它还有一个命令行，应该允许您集成到您的构建机器中以进行真正的持续测试。

它还支持 IronPython，因此如果您熟悉该脚本语言，您可以编写脚本删除您的测试添加的记录。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T22:35:41.943

好吧，我最终在 MS 测试中编写单元测试。在每次测试之前，服务由测试程序集托管，然后被拆除。当然这不是单元测试，所以纯粹主义者会不寒而栗，但这确实意味着我可以随心所欲地运行测试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-04T00:56:11.400

我并不是要暗示soapUI 不适用于使用basicHttpBinding 公开的WCF 服务。使用 basicHttpBinding 会起作用，因为该服务将作为旧版 ASMX Web 服务运行。但是，例如，如果要将绑定（或使用多个绑定）切换到 netTcpBinding，我认为仍然无法使用soapUI 调用该服务的方法。我描述的场景很常见，其中您使用 basicHttpBinding 端点在 Web 上公开 WCF 服务以实现最大互操作性，而另一个端点作为 netTcpBinding（以获得最大性能）仅在内部使用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-12T13:17:11.137

有一个名为 SOA Cleaner 的新测试客户端，我建议您尝试一下。它支持 WCF。可在以下网址找到：http: [//xyrow.com](http://xyrow.com)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-08T15:05:04.740

如果您需要测试客户端逻辑：您可以使用模拟/隔离框架来存根对服务器的实际调用，并使用单元测试框架来编写适当的单元测试。

测试服务器逻辑可能更容易——您所需要的只是测试对业务逻辑的调用和对外部组件（即数据库）的存根调用。

对客户端与服务器之间的完整交互进行单元测试没有实际好处，因为您知道 WCF 可以在专用服务器/客户端上添加整个环境的集成测试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-08T16:36:17.853

令人惊叹的 WCFStorm，但我认为对于独立开发人员来说太贵了。

正如达林所说，我也推荐soapUI。

但是有一种特殊情况，当您在 WCF 中使用 REST 并将请求作为 POST 消息发送时，soapUI 不支持 JSON 请求。

在这种情况下，您可以使用我在此处找到的工具：

[WCF RESTful JSON 自动化测试](http://jordi-montana.blogspot.com.es/2012/03/testing-wcf-restful-services-with-post.html)

# java - Java中的i+=d和i=i+d有什么区别？

> ID：620336
> 
> 赞同：0
> 
> 时间：2009-03-06T20:41:20.237
> 
> 标签：java

### 复制：

> [java += 问题](https://stackoverflow.com/questions/608721/java-question)
> 
> [为什么在 java 中 op-assign 运算符类型不安全？](https://stackoverflow.com/questions/590868/why-arent-op-assign-operators-type-safe-in-java)

When`i`是一个整数并且`d`是 a `double`，`i+=d`有效但`i= i+d`无效。

为什么是这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T20:43:36.847

i = i + d 不起作用，因为您会将 double 分配给 int 并且这是不允许的。

+= 运算符自动将 double 类型转换为 int，这就是它起作用的原因。

这是规范信息的链接：http: [//java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5304](http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5304)

# asp.net-mvc - ASP.NET MVC 可以应用于 Web 服务吗？

> ID：620341
> 
> 赞同：2
> 
> 时间：2009-03-06T20:41:59.610
> 
> 标签：asp.net-mvc, web-services

我正在为基于 Web 的应用程序构建一个架构，它将利用 Web 服务。有人建议我研究 ASP.NET MVC 框架的使用。我在 MVC 上找到的所有信息都讨论了它与网页的使用，但我没有找到任何关于 Web 服务的信息。MVC 可以用于 Web 服务吗？如果是这样，我在哪里可以找到资源来支持我的研究工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T20:44:12.867

ASP.NET MVC 可用于[创建 REST Web 服务](https://stackoverflow.com/questions/573363/using-asp-net-mvc-for-rest-based-endpoint)。对于 SOAP，您应该坚持使用标准的 Web 服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T03:29:10.443

MVC 是一种 UI 设计模式。它不适合 Web 服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:03:49.133

为了显示数据，您可以使用“JsonResults”中内置的 mvc 以 json 格式返回各种类型的权利或集合，我觉得这很实用。如果您需要更多选项，我建议您使用 WCF 而不是 Web 服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T04:04:15.197

从您的问题中不清楚您是在构建一个具有 Web 服务组件的 Web 应用程序，还是只是一个 Web 服务。严格来说，Web 服务没有用户界面，因此 MVC 模型不能直接应用。但实际上没有什么可以替代以一种直接的方式思考你正在尝试做的事情。架构模式可以提供帮助，但它们只是指南。听起来你还在摸索中，所以在这个阶段不要过多考虑这些模式：弄清楚需要做什么，找出最适合使用的技术。最终会出现整体架构。

# python - 如何从子目录导入 Django 项目 settings.py Python 文件？

> ID：620342
> 
> 赞同：17
> 
> 时间：2009-03-06T20:42:11.763
> 
> 标签：python, django

我为我的 Django 项目创建了一个子目录，名为`bin`我想要放置所有命令行运行 Python 脚本的位置。其中一些脚本需要导入我的 Django 项目`settings.py`文件，该文件位于`bin`.

如何`settings.py`从项目的子目录中导入文件？

我在命令行脚本中用于设置项目的“Django 上下文”的代码是：

```
from django.core.management import setup_environ
import settings
setup_environ(settings) 
```

如果脚本在我的项目的根目录中，这很好用。

我尝试了以下两种技巧来导入`settings.py`文件，然后设置项目：

```
import os
os.chdir("..")

import sys
sys.path = [str(sys.path[0]) + "/../"] + sys.path 
```

残酷的黑客可以 import `settings.py`，但后来我得到了错误：

```
project_module = __import__(project_name, {}, {}, [''])
ValueError: Empty module name 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-06T21:21:17.503

我认为您的方法可能使 Django 1.x 为您提供的东西过于复杂。只要您的项目在您的 python 路径中，您就可以在脚本顶部设置环境变量 DJANGO_SETTINGS_MODULE，如下所示：

```
import os
os.environ['DJANGO_SETTINGS_MODULE'] = 'myproject.settings' 
```

在需要读取设置的命令行脚本中，只需从“django.conf”导入设置模块，就像在应用程序代码中所做的那样：

```
from django.conf import settings 
```

并且很快，您就有了脚本的设置和支持 Django 的环境。

我个人更喜欢在名为 'proj_env' 的 bash 脚本中使用 '/usr/bin/env' 设置我的 DJANGO_SETTINGS_MODULE，所以我不必重复它

```
#!/bin/bash

proj_env="DJANGO_SETTINGS_MODULE=myproject.settings"

/usr/bin/env $proj_env ${*} 
```

有了这个，现在我可以在上下文中使用我的 Django 应用程序运行任何 python 脚本：

```
proj_env python -m 'myproject.bin.myscript' 
```

如果您使用 virtualenv，这也为您提供了一个获取激活脚本的好地方。

等等等等

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-07T20:38:00.533

这比您的问题更上一层楼，但这里最好的解决方案可能是将您的脚本实现为[自定义 manage.py (django-admin.py) commands](http://docs.djangoproject.com/en/dev/howto/custom-management-commands/#howto-custom-management-commands)。这为您免费提供了 Django 的所有功能（包括设置），没有丑陋的路径黑客，以及像选项解析这样的命令行细节。我从未见过以其他方式编写与 Django 相关的命令行脚本的充分理由。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T20:48:27.927

将父目录添加到您的路径：

```
import sys
sys.path.append('../')
import settings 
```

**评论更新：**

> 不要忘记`__init__.py`包含您的 settings.py 的目录中的文件 – S.Lott

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-09-30T16:41:23.003

假设您的项目目录是 /opt/someProject/`

这有如下文件：

> 管理.py

现在你有了你可能在任何地方都有你的子目录，没关系。例如。子目录可能像：

```
/opt/someproject/dir1/dir2 
```

现在让您在 /opt/someProject/dir1/dir2 中导入您的项目设置

您需要设置 PYTHONPATH 变量

> 导出 PYTHONPATH=/opt/someproject/

现在从 bin 导入模块

> 从某个项目导入箱

# asp.net - 我可以使用具有 ASP.NET 成员资格的实体框架吗？

> ID：620350
> 
> 赞同：10
> 
> 时间：2009-03-06T20:43:56.503
> 
> 标签：asp.net, .net, entity-framework, asp.net-membership

我正在创建（实际上是重新创建）一个在 MS-Access 数据库中具有现有用户和其他数据的应用程序。数据将被移动到 SQL Server，其中一部分涉及迁移用户。我想用 EF 做 ORM，我很确定我知道 SQL Server 中的数据模型是什么。我是 EF 新手，但不是 ASP.NET，我想利用 ASP.NET 中的成员资格功能。我正在考虑几种方法来做到这一点，并希望得到一些建议。到目前为止，我只对这个想法做了一点研究，也许它已经在其他地方得到了回答。所以，这里有一组相关的问题。

1.  EF 可以通过某些我不知道的类或命名空间直接与 ASP.NET 成员身份一起使用吗？

2.  如果我将用户转换到会员系统，为了将他们的用户 ID 与其他表中的数据对齐，我是否应该在 aspnet_* 表的顶部创建另一组用户数据表（如 DotNetNuke）？

3.  我想避免在处理用户标记数据时仅将内置成员资格函数用于用户身份验证并切换到 EF 上下文的情况。通过进入每一行的会员用户来撤回用户信息以绑定到 GridView 中的列似乎很笨拙，但也许这就是所需要的？为了数据检索的目的，我是否需要吸收它并复制 EF 中的成员资格类？

4.  我正在考虑为会员资格实施某种 EF 提供程序，其想法是，也许提供程序可以位于整个 EF 数据模型中。这是疯话吗？（我以前从未编写过自己的提供程序）

随意告诉我我没有任何意义。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:36:23.710

为什么不反过来呢？您可以为 asp.net 实现您自己的 Membership 提供程序，它使用您想要/需要的模型。

如果您需要的功能与内置的 asp.net 成员实现不完全匹配，您可以滚动您自己的提供程序。如果您只使用几个特性，您将只需要实现几个方法（您不必为所有方法填写实现）。如果您需要的功能超出其支持的范围，则使用会员提供程序可能会妨碍您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T20:49:51.997

1.  我们这样做，但我们不映射成员资格表。您不应假定使用 SQL 成员资格提供程序。
2.  我们映射用户身份，而不是数据库 ID。微妙，但很重要。同样，请记住还有其他成员资格提供程序（例如，域身份验证）。
3.  你能澄清这个问题吗？您不需要复制 EF 模型中的所有成员信息，但您需要一个已知身份的列表。
4.  不，一点也不疯狂，但很困难，而且可能没有必要。

# compiler-construction - 解释器实际上是否在内存中预编译？

> ID：620358
> 
> 赞同：3
> 
> 时间：2009-03-06T20:46:50.193
> 
> 标签：compiler-construction, theory, interpreter

好吧，伙计们，我想我会带上我的旧 CS 笔记并多看一下编译器理论。我不得不说我无法记住所有这些东西是如何工作的，但我确实有一个很好的大学时代的示例应用程序，可以帮助我理解一些事情。

此示例应用程序采用组合语言并将其编译为中间汇编代码，如语言。然后有一个简单的 VM 实现，它采用这种中间语言并执行语句。

我无法理解的是，如果我这是一个直截了当的解释器而不是编译器，它是否仍会在内存中构建这些中间命令以在最后执行。还是解释器实际上一次“执行”代码块的隐藏部分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T20:53:19.163

这取决于语言。大多数现代解释语言（Perl、Python 和 Ruby，仅举几例）将源代码预编译成某种中间形式，以便在最后执行（[引用](http://en.wikipedia.org/wiki/Interpreter_(computing))）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T22:29:12.567

我编写或使用过解释器，这些解释器直接作用于解析输入中的标记，直接作用于解析器构建的抽象语法树 (AST)，并将 AST 转换为为高效执行而设计的形式。所以答案是，**这取决于**。

*   如果您的目标机器有 8K 的 RAM，那么直接解析解释器将是一个明智的选择（想想 FORTH）。
*   如果您正在使用解释器来教授或学习编程语言的结构和语义，那么构建和解释 AST 是一个不错的选择。
*   如果您使用解释器来实现可移植性并且想要快速执行，那么编译到基于寄存器的虚拟机是一个不错的选择。（David Gregg 和其他人已经表明，在[Lua](http://www.lua.org) VM 这样的基于寄存器的 VM 中，解释开销比在 Java VM 这样的基于堆栈的 VM 中要少。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T20:54:10.207

解析器不编译。翻译程序时实际上涉及很多步骤（从 C++ 等高级语言到机器代码）。它取决于设计是一次性执行还是在多次通过输入后执行。你能把你的问题说得更具体一点吗？同时，不管你多么讨厌它，看看[这里](http://en.wikipedia.org/wiki/Compiler)——特别是前端和后端部分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T21:24:14.550

大多数现代解释器将程序解析为中间代码，然后再进行解释。有些显式存储此中间代码（例如 Python 的`.pyc`）。也有例外，例如，shell 脚本被直接解释，而不是被解析为中间格式。

一些更高级的“解释器”实际上并不解释，而是进行 JIT（即时）编译（例如 Java 或 .NET）。

# vim - 如何移动文本块或列

> ID：620360
> 
> 赞同：32
> 
> 时间：2009-03-06T20:47:03.577
> 
> 标签：vim

我有以下文本作为一个简单的案例：

```
...
abc xxx 123 456
wer xxx 345 678676
... 
```

我需要将一块文本 xxx 移动到另一个位置：

```
...
abc 123 xxx 456
wer 345 xxx 678676
... 
```

我想我使用可视模式来阻止一列文本，将块移动到另一个位置的其他命令是什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-06T20:52:41.660

您应该使用分块视觉模式 ( `Ctrl`+ `v`)。然后`d`删除块，`p`或`P`粘贴块。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-06T20:53:56.510

试试[链接](http://www.worldtimzone.com/res/vi.html)。

* * *

标记文本（可视模式）

*   `v`- 启动视觉模式，标记线条，然后执行命令（例如 y-yank）
*   `V`- 启动 Linewise 视觉模式
*   `o`- 移动到标记区域的另一端
*   `Ctrl`+ `v`- 启动视觉块模式
*   `O`- 移动到块的其他角落
*   `aw`- 标记一个词
*   `ab`- 一个 () 块（带大括号）
*   `aB`- 一个 {} 块（带括号）
*   `ib`- 内部（）块
*   `iB`- 内部 {} 块
*   `Esc`- 退出视觉模式

视觉命令

*   `>`- 右移
*   `<`- 左移
*   `y`- 猛拉（复制）标记的文本
*   `d`- 删除标记的文本
*   `~`- 开关盒

剪切和粘贴

*   `yy`- 拉出（复制）一行
*   `2yy`- 拉出 2 行
*   `yw`- 拉字
*   `y$`- 拉到行尾
*   `p`- 在光标后放置（粘贴）剪贴板
*   `P`- 在光标前放置（粘贴）
*   `dd`- 删除（剪切）一行
*   `dw`- 删除（剪切）当​​前单词
*   `x`- 删除（剪切）当​​前字符

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-11-06T23:59:41.490

我在学习 VIM 时学到的少数有用命令之一是 :1,3 mo 5 这意味着将文本第 1 行到第 3 行移动到第 5 行。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-06T20:52:45.047

1.  在 VIM 中，按`Ctrl`+`V`进入可视块模式
2.  用您的选择所需的列，`arrow keys`然后按`x`将它们剪切到缓冲区中。
3.  将光标移动到第 1 行第 9 列，然后`P`在命令模式下按（即大写 P）。
4.  按`Ctrl`+ `Shift`+`b`进出它。（[来源](http://ubuntuforums.org/showthread.php?t=729349)）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-04T21:49:19.407

使用外部命令“awk”。

```
%!awk '{print $1,$3,$2,$4}' test.txt 
```

用纯 vim

```
:%s,\v(\w+) (\w+) (\w+) (\w+),\1 \3 \2 \4,g 
```

另一个使用全局命令的 vim 解决方案

```
:g/./normal wdwwP 
```

# python - 如何跳转到巨大文本文件中的特定行？

> ID：620367
> 
> 赞同：118
> 
> 时间：2009-03-06T20:49:52.823
> 
> 标签：python, text-files

下面的代码是否有任何替代方案：

```
startFromLine = 141978 # or whatever line I need to jump to

urlsfile = open(filename, "rb", 0)

linesCounter = 1

for line in urlsfile:
    if linesCounter > startFromLine:
        DoSomethingWithThisLine(line)

    linesCounter += 1 
```

如果我正在处理一个`(~15MB)`包含未知但长度不同的行的巨大文本文件，并且需要跳转到我事先知道的数字的特定行？当我知道我至少可以忽略文件的前半部分时，我会通过一个一个地处理它们而感到难过。如果有的话，寻找更优雅的解决方案。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-03-06T21:28:23.400

如果不至少读取一次文件，您将无法继续前进，因为您不知道换行符在哪里。您可以执行以下操作：

```
# Read in the file once and build a list of line offsets
line_offset = []
offset = 0
for line in file:
    line_offset.append(offset)
    offset += len(line)
file.seek(0)

# Now, to skip to line n (with the first line being line 0), just do
file.seek(line_offset[n]) 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-03-06T20:58:06.967

[线缓存](http://docs.python.org/library/linecache.html)：

> 该[`linecache`](https://docs.python.org/3/library/linecache.html#module-linecache)模块允许从 Python 源文件中获取任何行，同时尝试使用缓存进行内部优化，这是从单个文件中读取多行的常见情况。模块使用它[`traceback`](https://docs.python.org/3/library/traceback.html#module-traceback)来检索源代码行以包含在格式化的回溯中...

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-06T21:28:28.220

如果行的长度不同，您实际上并没有那么多选择……遗憾的是，您需要处理行尾字符才能知道何时进入下一行。

但是，您可以通过将最后一个参数“open”更改为非 0 来显着加快速度并减少内存使用量。

0 表示文件读取操作是无缓冲的，非常慢且占用大量磁盘空间。1 表示文件是行缓冲的，这将是一个改进。任何大于 1（比如 8 kB，即 8192 或更高）的文件都会将文件块读入内存。您仍然可以通过`for line in open(etc):`.

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-06T21:25:53.377

我可能被丰富的ram宠坏了，但15 M并不大。读入内存[`readlines()`](https://docs.python.org/3/library/io.html#io.IOBase.readlines)是我通常对这种大小的文件所做的。之后访问一行是微不足道的。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-04-26T02:36:41.480

我很惊讶没有人提到 islice

```
line = next(itertools.islice(Fhandle,index_of_interest,index_of_interest+1),None) # just the one line 
```

或者如果你想要整个文件的其余部分

```
rest_of_file = itertools.islice(Fhandle,index_of_interest)
for line in rest_of_file:
    print line 
```

或者如果你想要文件中的每一行

```
rest_of_file = itertools.islice(Fhandle,index_of_interest,None,2)
for odd_line in rest_of_file:
    print odd_line 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-06T21:33:41.670

由于不阅读就无法确定所有行的长度，因此您别无选择，只能遍历起始行之前的所有行。你所能做的就是让它看起来不错。如果文件真的很大，那么您可能需要使用基于生成器的方法：

```
from itertools import dropwhile

def iterate_from_line(f, start_from_line):
    return (l for i, l in dropwhile(lambda x: x[0] < start_from_line, enumerate(f)))

for line in iterate_from_line(open(filename, "r", 0), 141978):
    DoSomethingWithThisLine(line) 
```

注意：基于这种方法，索引为零。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-06T21:31:08.823

如果您不想读取内存中的整个文件..您可能需要提出除纯文本之外的某种格式。

当然，这完全取决于您要执行的操作，以及您跳过文件的频率。

例如，如果您要在同一个文件中*多次*跳转到行，并且您知道文件在使用它时不会更改，您可以这样做：
首先，遍历整个文件，并记录“ seek-location" 的一些关键行号（例如，曾经 1000 行），
然后如果你想要第 12005 行，跳转到 12000 的位置（你已经记录了）然后读 5 行你就会知道你'在第 12005 行，依此类推

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-08-07T18:15:27.323

您可以使用 mmap 来查找线的偏移量。MMap 似乎是处理文件的最快方法

例子：

```
with open('input_file', "r+b") as f:
    mapped = mmap.mmap(f.fileno(), 0, prot=mmap.PROT_READ)
    i = 1
    for line in iter(mapped.readline, ""):
        if i == Line_I_want_to_jump:
            offsets = mapped.tell()
        i+=1 
```

然后使用 f.seek(offsets) 移动到您需要的行

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2019-12-04T23:11:47.330

没有一个答案特别令人满意，所以这里有一个小片段可以提供帮助。

```
class LineSeekableFile:
    def __init__(self, seekable):
        self.fin = seekable
        self.line_map = list() # Map from line index -> file position.
        self.line_map.append(0)
        while seekable.readline():
            self.line_map.append(seekable.tell())

    def __getitem__(self, index):
        # NOTE: This assumes that you're not reading the file sequentially.  
        # For that, just use 'for line in file'.
        self.fin.seek(self.line_map[index])
        return self.fin.readline() 
```

示例用法：

```
In: !cat /tmp/test.txt

Out:
Line zero.
Line one!

Line three.
End of file, line four.

In:
with open("/tmp/test.txt", 'rt') as fin:
    seeker = LineSeekableFile(fin)    
    print(seeker[1])
Out:
Line one! 
```

这涉及进行大量文件搜索，但对于无法将整个文件放入内存的情况很有用。它会进行一次初始读取以获取行位置（因此它会读取整个文件，但不会将其全部保存在内存中），然后每次访问都会在事后查找文件。

我根据用户的判断在 MIT 或 Apache 许可下提供上面的代码片段。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-06T21:06:13.360

如果您事先知道文件中的位置（而不是行号），则可以使用[file.seek()](http://docs.python.org/library/stdtypes.html#file.seek)转到该位置。

**编辑**：您可以使用[linecache.getline(filename, lineno)](http://docs.python.org/library/linecache.html#linecache.getline)函数，该函数将返回 lineno 行的内容，但只有在将整个文件读入内存之后。如果您从文件中随机访问行（因为 python 本身可能想要打印回溯），但对于 15MB 文件来说不是很好。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-04-28T07:39:40.613

什么会生成您要处理的文件？如果它在您的控制之下，您可以在附加文件时生成一个索引（哪一行在哪个位置。）。索引文件可以是固定的行大小（空格填充或 0 填充数字）并且肯定会更小。从而可以快速读取和处理。

*   你要哪条线？
*   计算索引文件中对应行号的字节偏移量（可能是因为索引文件的行大小是恒定的）。
*   使用 seek 或其他直接跳转以从索引文件中获取行。
*   解析以获取实际文件相应行的字节偏移量。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-07-06T18:03:39.267

我遇到了同样的问题（需要从大文件的特定行中检索）。

当然，我每次都可以遍历文件中的所有记录并在计数器等于目标行时停止它，但是在您想要获得复数个特定行的情况下它不起作用。这导致主要问题得到解决 - 如何直接处理必要的文件位置。

我发现了下一个决定：首先我完成了每行开始位置的字典（键是行号，值是前行的累积长度）。

```
t = open(file,’r’)
dict_pos = {}

kolvo = 0
length = 0
for each in t:
    dict_pos[kolvo] = length
    length = length+len(each)
    kolvo = kolvo+1 
```

最终，目标函数：

```
def give_line(line_number):
    t.seek(dict_pos.get(line_number))
    line = t.readline()
    return line 
```

t.seek(line_number) - 执行文件修剪的命令，直到行开始。因此，如果您下一次提交 readline – 您将获得目标行。

使用这种方法，我节省了大量时间。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-03-06T22:33:30.203

这些行本身是否包含任何索引信息？如果每一行的内容类似于“ `<line index>:Data`”，那么`seek()`即使数量`Data`是可变的，也可以使用该方法对文件进行二进制搜索。你会寻找文件的中点，读取一行，检查它的索引是高于还是低于你想要的，等等。

否则，你能做的最好的就是`readlines()`. 如果您不想读取全部 15MB，则可以使用该`sizehint`参数至少将大量`readline()`s 替换为对`readlines()`.

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-03-23T09:47:33.247

如果您正在处理基于*linux 系统的**文本文件*，则可以使用 linux 命令。 对我来说，这很好用！

 *```
import commands

def read_line(path, line=1):
    return commands.getoutput('head -%s %s | tail -1' % (line, path))

line_to_jump = 141978
read_line("path_to_large_text_file", line_to_jump) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-07T04:24:33.197

这是一个[`readlines(sizehint)`](https://docs.python.org/3/library/io.html#io.IOBase.readlines)用于一次读取一大块行的示例。DNS 指出了该解决方案。我写这个例子是因为这里的其他例子都是面向单行的。

```
def getlineno(filename, lineno):
    if lineno < 1:
        raise TypeError("First line is line 1")
    f = open(filename)
    lines_read = 0
    while 1:
        lines = f.readlines(100000)
        if not lines:
            return None
        if lines_read + len(lines) >= lineno:
            return lines[lineno-lines_read-1]
        lines_read += len(lines)

print getlineno("nci_09425001_09450000.smi", 12000) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-11-25T09:17:22.433

@george 出色地建议[mmap](https://docs.python.org/3/library/mmap.html)，它可能使用系统调用[mmap](https://www.man7.org/linux/man-pages/man2/mmap.2.html)。这是另一个演绎。

```
import mmap

LINE = 2  # your desired line

with open('data.txt','rb') as i_file, mmap.mmap(i_file.fileno(), length=0, prot=mmap.PROT_READ) as data:
  for i,line in enumerate(iter(data.readline, '')):
    if i!=LINE: continue
    pos = data.tell() - len(line)
    break

  # optionally copy data to `chunk`
  i_file.seek(pos)
  chunk = i_file.read(len(line))

print(f'line {i}')
print(f'byte {pos}')
print(f'data {line}')
print(f'data {chunk}') 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2015-09-19T22:05:15.107

可以使用此函数返回第 n 行：

```
def skipton(infile, n):
    with open(infile,'r') as fi:
        for i in range(n-1):
            fi.next()
        return fi.next() 
```

# c# - 如何找到接口的所有实现？

> ID：620376
> 
> 赞同：70
> 
> 时间：2009-03-06T20:53:01.253
> 
> 标签：c#, visual-studio, resharper, reflector

假设您有一个用 C# 定义的接口。找到所有提供接口实现的类的最简单方法是什么？

蛮力方法是在 Visual Studio 中使用“查找引用”并手动查看结果以将用法与实现分开，但对于大型代码库中的接口，该接口被大量*引用*而实现相对较少，这可以是耗时且容易出错。

在 Java 中，在代码库上运行 javadoc（使用 -private 选项包括私有类）将为接口（例如[Comparable](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Comparable.html)）生成一个文档页面，其中包括接口的所有实现类以及任何子接口（尽管它不包括子接口的实现类，这些相对容易通过深入研究列出的子接口来确定）。这是我正在寻找的功能，但使用 C# 和 Visual Studio。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2011-05-04T13:13:29.297

您可以右键单击方法名称（接口中的定义或其他类中的实现）并选择查看调用层次结构。在 Call Hierarchy 窗口中有“Implements”文件夹，您可以在其中找到接口方法实现的所有位置。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-03-06T20:57:58.200

（根据评论编辑...）

**如果您安装了 ReSharper：**

在 Visual Studio 中，右键单击类型名称并选择“Go to Inheritor”。或者，选择类型名称，然后转到 ReSharper/View/Type Hierarchy 打开一个新选项卡。（菜单将向您显示键盘快捷键 - 这可能会有所不同，这就是我解释如何找到它的原因:)

**如果您没有 ReSharper：**

*   您可以使用[Reflector](http://www.red-gate.com/products/reflector)，它能够非常轻松地向您显示所有类型层次结构 - 在类型名称下方是基本类型和派生类型的可扩展项。类似的工具可用，例如[ILSpy](http://ilspy.net/)和[dotPeek](https://www.jetbrains.com/decompiler/)。
*   购买 ReSharper - 这是一个很棒的工具 :)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2016-05-26T10:59:46.187

将光标放在类或接口类型上，然后

**CTRL + F12**

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2014-04-24T19:36:40.270

**使用 Visual Studio 2010+**

右键单击成员方法并选择查看调用层次结构。展开实施文件夹。这列出了实现该方法所属接口的所有类型。

![在此处输入图像描述](https://i.stack.imgur.com/d3QXC.png)

**使用 Resharper 7**

右键单击界面 > 导航到 > 派生符号。**以粗体**列出的符号直接来自界面。非粗体符号派生自超类。

![在此处输入图像描述](https://i.stack.imgur.com/Atj6M.png)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-08-30T15:12:53.590

对于使用 Visual Studio 2015 的用户，有一个名为[Go To Implementation](https://visualstudiogallery.msdn.microsoft.com/0ed93222-83cd-4db3-92bc-a78909047156)的很棒的扩展。试试看。

安装扩展程序后，您只需右键单击任何出现的界面（例如 IUrlShortener），然后单击`Go To Implementation`菜单。如果您只有一个实现接口的类，单击菜单将直接带您进入该类。如果您有多个实现该接口的类，它将列出所有类。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-02-24T00:24:59.060

对于使用 Visual Studio 2015 的用户，请安装 Visual Studio 2015 Update 1 RC。来自[Visual Studio 博客](https://blogs.msdn.microsoft.com/visualstudio/2015/10/29/visual-studio-update-1-rc/)：

> 今天我们发布了 Visual Studio 2015 Update 1 RC，它建立在我们三周前发布的 Update 1 CTP 的基础上。除了此处描述的 CTP 中引入的功能外，候选发布版还包括以下内容：
> 
> *   **转到实施**。许多人一直在等待的功能：只需右键单击接口或抽象方法并选择此命令即可导航到实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-06T20:57:17.360

我不认为这个功能是内置在 VS 中的，但是 IIRC [Resharper](http://www.jetbrains.com/resharper/)有这个。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-10-20T11:18:13.310

您可以对界面进行正则表达式搜索。

```
:(\ *[^},]+,)*\ *IMyInterfaceName 
```

CTRL+SHIFT+F 启动以下窗口：

![Visual Studio 屏幕截图](https://i.stack.imgur.com/ddy0l.png)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-04-17T16:25:46.930

我更喜欢“导航到...”选项。将光标放在函数调用上，尝试以下操作：

快捷键：

1.  Ctrl+, (Ctrl+逗号)

菜单：

1.  编辑菜单
2.  单击“导航至...”

好处：

*   不显示所有参考，如“查找所有参考”
*   显示实现的“类型”，以便它会注意哪个是您的接口

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-10-17T19:47:29.633

使用 Shift + F12 显示所有引用，包括定义。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-06T20:57:55.173

如果您使用 resharper **ALT + END**快捷方式可能有助于找到所有继承者。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-06T21:00:52.763

我听说过（我自己没有经验）[doxygen](https://www.doxygen.nl)之于 .Net 就像 javadoc 之于 java 一样。

# c++ - 为什么 C++ 模板可以让我规避不完整的类型（前向声明）？

> ID：620378
> 
> 赞同：1
> 
> 时间：2009-03-06T20:53:20.693
> 
> 标签：c++, templates, forward-declaration

我尝试了以下简单程序的三个迭代。这是编写容器和迭代器对类的高度简化的尝试，但我遇到了不完整类型（前向声明）的问题。我发现一旦我将所有内容都模板化，这实际上是可能的——但前提是我实际使用了模板参数！（我通过查看[Google sparsetable code](http://code.google.com/p/google-sparsehash/source/browse/trunk/src/google/sparsehash/densehashtable.h)意识到了这一点。）

任何提示解释为什么第二个有效而第三个无效？（我知道为什么第一个不起作用——编译器需要知道容器的内存布局。）

提前致谢。

```
// This doesn't work: invalid use of incomplete type.
#if 0
struct container;
struct iter {
  container &c;
  int *p;
  iter(container &c) : c(c), p(&c.value()) {}
};
struct container {
  int x;
  int &value() { return x; }
  iter begin() { return iter(*this); }
};
int main() {
  container c;
  c.begin();
  return 0;
}
#endif

// This *does* work.
template<typename T> struct container;
template<typename T> struct iter {
  container<T> &c;
  T *p;
  iter(container<T> &c) : c(c), p(&c.value()) {}
};
template<typename T> struct container {
  T x;
  T &value() { return x; }
  iter<T> begin() { return iter<T>(*this); }
};
int main() {
  container<int> c;
  c.begin();
  return 0;
};

// This doesn't work either.
#if 0
template<typename T> struct container;
template<typename T> struct iter {
  container<int> &c;
  int *p;
  iter(container<int> &c) : c(c), p(&c.value()) {}
};
template<typename T> struct container {
  int x;
  int &value() { return x; }
  iter<int> begin() { return iter<int>(*this); }
};
int main() {
  container<int> c;
  c.begin();
  return 0;
}
#endif 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T21:11:28.013

第一个需要定义，`container`因为您正在执行复制操作。如果你定义`iter`after定义的构造函数，`container`你会没事的。所以：

```
struct container;
struct iter {
  container &c;
  int *p;
  iter(container &c);
};

struct container {
  int x;
  int &value() { return x; }
  iter begin() { return iter(*this); }
};

iter::iter(container &c) : c(c), p(&c.value()) {}

int main() {
  container c;
  c.begin();
  return 0;
} 
```

第二个示例有效，因为在您实际在`main`函数中实例化一个类之前没有类。到那时，所有类型都已定义。尝试在 main 之后移动任何`iter`or `container`templates 定义，您会遇到错误。

第三个例子是`int`它出现的一个特化。这应该可以编译，因为`iter`没有使用模板参数 for。你的专业化语法有点偏离。但是，没有合适的构造函数，所以你只会得到`x`. 此外，迭代器可以通过指针很好地建模。Passing`this`的值不会有太大帮助。序列通常需要迭代器，而不是单个对象。尽管如此，没有什么可以阻止你建造一个。

而且你不需要`;`一个函数体。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:03:41.510

你可以在没有模板的情况下通过在定义容器后定义 iter::iter() 来做到这一点：

```
struct container;

struct iter {
  container &c;
  int *p;
  iter(container &c);
};

struct container {
  int x;
  int &value() { return x; }
  iter begin() { return iter(*this); }
};

iter::iter(container &c)
    : c(c), p(&c.value()) {}

int main() {
  container c;
  c.begin();
  return 0;
} 
```

模板版本有效，因为当您实例化模板时，两个类都已完全定义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T21:06:43.640

在第一种情况下，您试图在定义类之前访问 Container 类的成员函数，因此这是行不通的。

在第二种情况下，模板在第一次与特定类型一起使用时被实例化。此时，Container 类已在 main 中定义，因此可以编译。

在第三种情况下，存在循环引用。container 使用 iter，iter 使用 container，所以不能工作。

# iphone - iPhone如何创建全屏应用？

> ID：620386
> 
> 赞同：23
> 
> 时间：2009-03-06T20:54:49.830
> 
> 标签：iphone, uiviewcontroller, rendering, fullscreen

我一直在尝试创建全屏视图。我计划使用核心图形进行渲染。我是 iPhone 开发的新手，所以请原谅这个基本问题。

这是我的设置代码；

```
- (void)loadView
{
    CGRect  rect = [[UIScreen mainScreen] bounds];
    GameView *main_view;
    main_view = [[GameView alloc] initWithFrame:rect ];
    main_view.clearsContextBeforeDrawing = NO;
    self.view = main_view;
    [main_view release];    
} 
```

然而，当我运行它时，我会在顶部看到一个带有时间和电池电量的细状态栏。

我尝试寻找一些样本，但所有样本都是opengles。

有人可以告诉我哪里出错了吗？以及如何创建全屏视图。

谢谢

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-06T20:59:42.470

有两种方法；

在应用程序的 info.plist 中添加一个`boolean`键`UIStatusBarHidden`并将其设置为 true。

在运行时，您可以调用`setStatusBarHidden`您的应用程序来显示/隐藏状态栏。例如

```
[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO] 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-10-03T04:00:38.303

由于我刚刚在这里找到了我正在寻找的答案，所以我不妨补充一下，上面的方法现在已经贬值了。现代方法是：

`- (void)setStatusBarHidden:(BOOL)hidden withAnimation:(UIStatusBarAnimation)animation`

谢谢！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-08T01:55:27.743

你可能还想让你的`rect = [[UIScreen mainScreen] applicationFrame]`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-11-15T08:48:58.207

在相应的视图控制器中添加以下方法

-(BOOL) 偏好状态栏隐藏

它对我有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-10-06T00:39:00.363

这行得通，而且是最简单的

UIViewControllerBasedStatusBarAppearance：.plist 中的否

# php - 你如何为函数调用创建 __call() 方法？

> ID：620391
> 
> 赞同：0
> 
> 时间：2009-03-06T20:56:03.713
> 
> 标签：php

我正在尝试开发一个拦截功能的应用程序。我知道在类方法中，你可以有一个函数的 __call() 方法。我想知道常规功能是否存在这样的事情？我知道有一个“function_exists”调用，但是每次调用函数时我都必须这样做。我想要一种自动化的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T21:06:10.163

没有等效的功能。根据您的实际情况，您可能能够从 __autoload() 中获得一些好处，这是唯一在全局范围内而不是为类定义的魔术函数；它允许您按需定义类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:02:20.217

对象重载仅适用于类。“function_exists”也很慢。

顺便说一句，还有[is_callable](http://is.php.net/manual/en/function.is-callable.php)

# html - 如何将所有网址重写为“/”？

> ID：620400
> 
> 赞同：2
> 
> 时间：2009-03-06T21:00:46.463
> 
> 标签：html, apache, mod-rewrite, url-rewriting

服务器：阿帕奇

我希望通过以下方式重写我的网址，但我想不出一种让它工作的方法。

```
http://website.com/index.html 
```

我希望它重定向到：

```
http://website.com/ 
```

所以基本上我想加载 index.html，但不在 url 中显示它。我也不想给它取另一个名字。我不是在寻找**/index.html**成为**/index**

此外，我正在尝试获取任何 GET 数据，例如：

```
http://website.com/index.html?id=0&name="fred" 
```

重写为：

```
http://website.com/?id=0&name="fred". 
```

如果您有一个不使用 .htaccess 文件的解决方案，也可以。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T21:05:26.543

我相信这应该有效：

```
RewriteEngine on
RewriteRule ^index\.html(.*)$ /$1 [R=permanent,L] 
```

这会将所有以“”开头的请求重定向`/index.html`到简单的“ `/`”，并将保留后面的任何参数`index.html`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T21:06:16.120

对于 .htaccess 文件：

```
RewriteEngine on
RewriteCond %{THE_REQUEST} ^GET\ /index\.html
RewriteRule ^index\.html$ / [L,R=301] 
```

# javascript - 为什么我不能设置一个等于 XMLHttpRequest 的 responseText 值的变量？

> ID：620421
> 
> 赞同：0
> 
> 时间：2009-03-06T21:07:08.617
> 
> 标签：javascript, ajax, responsetext

如果我在我的 XHR 的 onreadystatechange 函数中，我可以很容易地做到`document.title = xhr.responseText`，但是如果我让函数返回 responseText，我不能设置一个等于我的 XHR 的外部包装器的变量来使它等于响应；有什么办法可以做到这一点吗？

我的包装：

```
ajax = function(url, cb)
 {
    xhr = (window.XMLHttpRequest)
        ? new XMLHttpRequest()
        : new ActiveXObject('Microsoft.XMLHTTP');
    xhr.onreadystatechange = function()
     {
        if (xhr.readyState == 4 && xhr.status == 200)
         {
            cb(xhr.responseText);
         };
     }
    xhr.open('get', url, true);
    xhr.send();
 }; 
```

现在，如果我做了类似的事情：

```
ajax('bacon.txt', function(_)
 {
    document.title = _;
 } 
```

它绝对完美；document.title 实际上变成了调用 bacon.txt 的 responseText。但是，如果我尝试以这种方式实现它：

```
document.title = ajax('bacon.txt', function(_)
 {
    return _;
 } 
```

没有这样的运气。谁能澄清这是为什么？};

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T21:26:37.523

您将 ajax 函数的返回分配给标题。ajax 函数本身不返回任何内容。

AJAX 的全部意义在于该函数在收到任何响应**之前立即返回它向服务器发出的请求。**您正在将 undefined 分配给 title 属性（顺便说一句，我通常让我的 ajax 函数返回正在使用的 xhr 允许我在必要时中止）。

当请求完成时，回调（代码中的 cb）函数被调用，因此您的原始代码是有意义的，它会进行分配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:31:05.127

onreadystatechange 函数的结果与您的“ajax”函数不同...您可以使您的帖子同步，并使 ajax 函数返回相同，但如果响应需要，它最终会延迟浏览器中的用户响应太长。

你可以做的更好的是找到另一种方法，如你所愿。我的意思是，不要试图让它那样工作，因为它会更糟。

# lucene - Lucene 搜索错误堆栈

> ID：620422
> 
> 赞同：2
> 
> 时间：2009-03-06T21:07:11.640
> 
> 标签：lucene

尝试使用 Lucene 进行搜索时，我看到以下错误。（版本 1.4.3）。关于为什么我会看到这个以及如何解决它的任何想法？

```
Caused by: java.io.IOException: read past EOF
    at org.apache.lucene.store.InputStream.refill(InputStream.java:154)
    at org.apache.lucene.store.InputStream.readByte(InputStream.java:43)
    at org.apache.lucene.store.InputStream.readVInt(InputStream.java:83)
    at org.apache.lucene.index.FieldInfos.read(FieldInfos.java:195)
    at org.apache.lucene.index.FieldInfos.<init>(FieldInfos.java:55)
    at org.apache.lucene.index.SegmentReader.initialize(SegmentReader.java:109)
    at org.apache.lucene.index.SegmentReader.<init>(SegmentReader.java:89)
    at org.apache.lucene.index.IndexReader$1.doBody(IndexReader.java:118)
    at org.apache.lucene.store.Lock$With.run(Lock.java:109)
    at org.apache.lucene.index.IndexReader.open(IndexReader.java:111)
    at org.apache.lucene.index.IndexReader.open(IndexReader.java:106)
    at org.apache.lucene.search.IndexSearcher.<init>(IndexSearcher.java:43) 
```

在同一环境中，我还看到以下错误：

```
Caused by: java.io.IOException: Lock obtain timed out:
Lock@/tmp/lucene-3ec31395c8e06a56e2939f1fdda16c67-write.lock
    at org.apache.lucene.store.Lock.obtain(Lock.java:58)
    at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:223)
    at org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:213) 
```

相同的代码在测试环境中有效，但在生产环境中无效。无法识别两种环境之间的任何明显差异。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:10:53.020

文件权限错误（需要写入权限）或您无法访问当前进程需要的锁定文件。

# numpy - 有没有办法降低 scipy/numpy 精度以减少内存消耗？

> ID：620428
> 
> 赞同：8
> 
> 时间：2009-03-06T21:08:28.923
> 
> 标签：numpy, scipy, numerical, matplotlib, fft

在我的 64 位 Debian/Lenny 系统（4GByte RAM + 4GByte 交换分区）上，我可以成功地做到：

```
v=array(10000*random([512,512,512]),dtype=np.int16)
f=fftn(v) 
```

但是 f 是 a`np.complex128`的内存消耗是令人震惊的，我不能对结果做更多​​的事情（例如调制系数然后`f=ifftn(f)`）而没有`MemoryError`回溯。

与其安装更多的 RAM 和/或扩展我的交换分区，是否有某种方法可以控制 scipy/numpy “默认精度”并让它计算一个 complex64 数组？

我知道我可以在之后使用`f=array(f,dtype=np.complex64)`; 我希望它实际上以 32 位精度和一半的内存进行 FFT 工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:54:55.333

在 scipy 的 fft 函数中似乎没有任何函数可以执行此操作（请参阅[http://www.astro.rug.nl/efidad/scipy.fftpack.basic.html](http://www.astro.rug.nl/efidad/scipy.fftpack.basic.html)）。

除非您能够为 python 找到定点 FFT 库，否则您想要的函数不太可能存在，因为您的本机硬件浮点格式是 128 位。看起来您确实可以使用 rfft 方法来获取 FFT 的实值分量（无相位），这样可以节省一半的 RAM。

我在交互式 python 中运行了以下命令：

```
>>> from numpy import *
>>>  v = array(10000*random.random([512,512,512]),dtype=int16)
>>> shape(v)
(512, 512, 512)
>>> type(v[0,0,0])
<type 'numpy.int16'> 
```

此时python的RSS（驻留集大小）为265MB。

```
f = fft.fft(v) 
```

而此时python的RSS为2.3GB。

```
>>> type(f)
<type 'numpy.ndarray'>
>>> type(f[0,0,0]) 
<type 'numpy.complex128'>
>>> v = [] 
```

在这一点上，RSS 下降到 2.0GB，因为我已经释放了 v。

使用“fft.rfft(v)”计算实数值只会产生 1.3GB 的 RSS。（几乎一半，正如预期的那样）

正在做：

```
>>> f = complex64(fft.fft(v)) 
```

两全其美，因为它首先计算 complex128 版本（2.3GB），然后将其复制到 complex64 版本（1.3GB），这意味着我机器上的峰值 RSS 为 3.6GB，然后稳定到 1.3GB再次。

我认为如果你有 4GB RAM，这一切都应该很好（就像它对我一样）。有什么问题？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T02:38:55.250

Scipy 0.8 将对几乎所有 fft 代码提供单精度支持（代码已经在主干中，因此如果您现在需要该功能，可以从 svn 安装 scipy）。

# asp.net-3.5 - 如何突出显示 .NET Web 应用程序中两个版本的文本之间的差异？

> ID：620431
> 
> 赞同：4
> 
> 时间：2009-03-06T21:10:13.897
> 
> 标签：asp.net-3.5

大约 2 年以来，我一直在为我们的呼叫中心部门工作支持 Web 应用程序。该应用程序是用 ASP.NET 3.5 和 SQL server 2005 数据库编写的。我被要求扩展呼叫详细信息部分，以允许座席编辑当前呼叫记录，并能够恢复到以前的版本。现在，这一切都很酷，但现在经理希望能够单击任何特定的注释并查看所有以黄色突出显示更改的编辑（如果某些内容被删除，他希望看到已删除的文本被划掉）。实际上，我需要的与 Stackoverflow 处理问题编辑的方式非常相似。我一直在考虑如何解决这个问题，当然，在进行了研究和谷歌搜索之后，我仍然不确定该走哪条路。我对 .NET 开发相当陌生。关于突出 UI 变化的最佳技术的任何想法？恐怕每次他们进行更改时我都必须存储整个笔记的副本，因为经理希望能够在发送之前轻松查看笔记并恢复到任何版本（不仅仅是最新版本）每月向我们的 VIP 客户报告电话报告。由于该部门经常改变主意，因此我想确保新功能具有可扩展性且易于维护。任何想法将不胜感激。我真的只是在寻找能指引我正确方向的人；也许有一些有用的工具，谷歌查找中推荐的关键字等。我想确保新功能可扩展且易于维护。任何想法将不胜感激。我真的只是在寻找能指引我正确方向的人；也许有一些有用的工具，谷歌查找中推荐的关键字等。我想确保新功能可扩展且易于维护。任何想法将不胜感激。我真的只是在寻找能指引我正确方向的人；也许有一些有用的工具，谷歌查找中推荐的关键字等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:02:48.560

这将很难做到。

1.  您需要一个“文本编辑器”控件，它不仅可以编辑文本，还可以告诉您进行了哪些更改。
2.  然后，您不仅需要存储最终文本字符串，还需要存储更改列表
3.  然后，您需要能够显示文本和更改、使用删除线以及插入与更改的不同颜色
4.  您不仅需要为单个用户的更改执行此操作，还需要将每个用户的更改存储在数据库中，并且需要能够同时显示所有更改。

你的经理应该*非常*确定他需要这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:21:55.033

可以在[任何适合 .NET 的文本差异/合并引擎中找到一些为您进行差异分析的工具？](https://stackoverflow.com/questions/138331/any-decent-text-diff-merge-engine-for-net).

这将需要像你说的那样存储每个版本。这应该允许您以类似于 SO 的方式实现它。我似乎记得读过或听过 Jeff 提到它，但没能找到它，可能是在其中一个 SO 播客中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T01:59:18.133

最简单的方法是存储每个修订的文本，然后当用户想要查看差异时，使用差异工具生成突出显示的文本。

这是一些 Javascript 差异代码： [http ://ejohn.org/projects/javascript-diff-algorithm/](http://ejohn.org/projects/javascript-diff-algorithm/)

如果所有计算机都安装了 Word，则您可以使用 Word 控件来完成此操作。TortoiseSVN 在其程序目录中有脚本，可以获取两个 word 文档并生成一个突出显示更改的文档。要查看这个创建 c:\aaa.doc 和 bbb.doc，然后安装 TortoiseSVN 并运行：

```
wscript.exe "C:\program files\tortoisesvn\Diff-Scripts\diff-doc.js" c:\aaa.doc c:\bbb.doc //E:javascript 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T22:14:59.933

我想你应该看看[http://en.wikipedia.org/wiki/Revision_control](http://en.wikipedia.org/wiki/Revision_control)

# web-services - 调用 Web 服务时使用服务代理

> ID：620436
> 
> 赞同：4
> 
> 时间：2009-03-06T21:11:08.277
> 
> 标签：web-services, design-patterns

任何人都可以在调用Web服务时解释服务代理的使用吗？它如何适应项目架构？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T21:25:41.130

在 MVC 又名模型视图控制器中，

```
View -> Controller -> Service Agent 
```

服务代理充当 Web 服务的代理。它可以位于应用程序的资源访问层。

*   控制器初始化对服务代理的调用，因为视图需要一些数据或需要从服务执行一些操作。
*   在控制器从代理获取结果后，它会执行一些逻辑并将**模型**应用于视图。

编辑：

代理包装代理类，以便它负责代理的实例化和处理来自服务器的错误等。代理类是 Web 服务的通用接口，代理为相关服务实现了更多逻辑。例如，您可以将响应转换为模型并将其返回给控制器。

# security - 行级用户权限，帮助设计

> ID：620438
> 
> 赞同：0
> 
> 时间：2009-03-06T21:12:08.230
> 
> 标签：security, permissions

假设我正在创建一个论坛应用程序，我了解如何使用 Groups 设计一个论坛级别的权限系统。

即，您创建一个论坛到组映射，并将用户分配到一个组以让他们访问特定论坛。

如何优化权限以允许行级别权限（或在论坛术语中，帖子级别）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T21:32:59.410

您将按照您已经描述的类似方式执行此操作。它需要更多的连接。假设您有一个这样的结构（我故意避开约束以使其通用并减少代码量）：

```
CREATE TABLE ForumPost (
PostID int,
ForumID int,
PostText varchar(255)
);

CREATE TABLE ForumUser (
ForumUserID int,
ForumUserName varchar(255),
NumofPosts int
);

CREATE TABLE ForumGroups (
ForumGroupID int,
ForumGroupName varchar(255)
)

CREATE TABLE ForumGroupMembership (
ForumUserID int,
ForumGroupID int
)

CREATE TABLE ForumPermissions (
ForumID int,
ForumGroupID int,
MinPosts int
) 
```

然后你可以做几个连接来确保你相应地限制内容：

```
SELECT FPost.PostID, FPost.ForumID, FPost.PostText
FROM ForumPost FPost
  JOIN ForumPermissions FPerm
    ON FPost.ForumID = FPerm.ForumID
  JOIN ForumGroupMembership FGM
    ON FPerm.ForumGroupID = FGM.ForumGroupID
  JOIN ForumUser FUser
    ON FUser.ForumUserID = FGM.ForumUserID
WHERE FUser.NumOfPosts >= FPerm.MinPosts
  AND FPost.PostID = <Some Number> 
```

# git - 如何设置公共 git 存储库？

> ID：620439
> 
> 赞同：15
> 
> 时间：2009-03-06T21:12:28.820
> 
> 标签：git, repository, public

我最近尝试在 linux 机器上设置 git repo 并浪费了大约 10 个小时，完全没有结果。编译或类似的东西没有任何问题，这只是配置问题。2 小时后，我得到了 mercurial 来做我需要的一切：

1.  公共回购
2.  网页界面
3.  具有每个用户权限的推/拉（不绑定到 linux 帐户）

我能看到的关于 git 的所有内容都假设您只是在本地运行它，使用 github 或者已经设置了所有内容。我要么没有寻找正确的关键字，要么没有或很少有关于该主题的信息。

我确实想尝试 git，但设置它是一种非常令人沮丧的体验。谁能指出这些方面有用的东西？

谢谢你！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-06T21:31:02.520

~~我相信（但我还没有尝试过）[**gitosis**](http://eagain.net/gitweb/?p=gitosis.git;a=blob_plain;f=README.rst;hb=73a032520493f6b4186185d4826d12edb5614135)是为了：~~
更新：2011，我实际上已经部署了**[gitolite](https://github.com/sitaramc/gitolite)**

*   使托管存储`git`库更容易和更安全。它
*   在一个用户帐户下管理多个存储库，使用 SSH 密钥来识别用户。
    最终用户不需要服务器上的 shell 帐户，他们将与一个不允许他们运行任意命令的共享帐户交谈。

我推荐的安装过程是从客户端帖子中完成的，以便在服务器上复制 gitolite 的完整安装：

[（从客户端方法）从客户端安装到服务器](https://github.com/sitaramc/gitolite/blob/pu/doc/1-INSTALL.mkd#_from_client_method_install_from_the_client_to_the_server)

请记住：[gitolite 管理授权，而不是身份验证（SSH）](https://github.com/sitaramc/gitolite/blob/0f377a7679845e1db9e6ea0830da7d25ba4ecf07/doc/gitolite-without-ssh.mkd)：它可以在没有 SSH 的情况下使用，但它的自然部署是通过 SSH 和[强制命令机制](http://oreilly.com/catalog/sshtdg/chapter/ch08.html#22858)。（就像 gitosis 一样，但有更多功能）

* * *

gitosis 的旧参考资料：

~~这是一个分步**[教程](http://www.perevillega.com/installation-guides/gitosis-git-repository/)**。~~

~~然后是本教程的一个应用程序：[Gitosis — 使托管多个 Git 存储库变得可管理](http://ssteiner.wordpress.com/2008/12/21/installing-secure-git-with-gitosis/)（对于 Mac）或[在 Ubuntu 上安装 gitosis](http://www.urbanpuddle.com/articles/2008/07/11/installing-git-on-a-server-ubuntu-or-debian)~~

~~其次：[将用户添加到我们的安全 Git 设置中](http://ssteiner.wordpress.com/2008/12/26/gitosis-adding-users-and-repositories/)~~

~~完成：[Git 子项目](http://ssteiner.wordpress.com/2008/12/30/git-subprojects/)（因为您的 gitosis 服务器管理所有这些不同的 git 存储库）~~

* * *

对于真正的轻量级（cgi 服务器）公共 Git 存储库，您可以：

*   设置一个[git 服务器](http://www.kernel.org/pub/software/scm/git/docs/user-manual.html#exporting-via-git)：[git-daemon](http://www.kernel.org/pub/software/scm/git/docs/git-daemon.html)；它将侦听端口 9418。默认情况下，它将允许访问任何看起来像 git 目录并包含魔术文件 git-daemon-export-ok 的目录。将一些目录路径作为 git-daemon 参数传递将进一步限制对这些路径的导出。
    您还可以将 git-daemon 作为 inetd 服务运行；
*   [使用 http 导出](http://www.kernel.org/pub/software/scm/git/docs/user-manual.html#exporting-via-http)将新创建的裸 git 存储库放在 Web 服务器导出的目录中，并进行一些调整以向 Web 客户端提供他们需要的一些额外信息

以下是如何在[**Apache 服务器**](http://www.kernel.org/pub/software/scm/git/docs/howto/setup-git-server-over-http.txt)上执行此操作。

* * *

2010 年的文章“[**共享 git 存储库的 8 种方法**](http://www.jedi.be/blog/2009/05/06/8-ways-to-share-your-git-repository/#)”提到了授予对 Git 存储库的访问权限的所有可能性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-27T17:02:15.500

你可以做

[`git instaweb`](http://www.kernel.org/pub/software/scm/git/docs/git-instaweb.html)

如果你安装了[lighttpd](http://www.lighttpd.net/)。不过，这只是 Web GUI。

# c# - 为什么我必须在 C# 中指定“out”关键字？

> ID：620444
> 
> 赞同：3
> 
> 时间：2009-03-06T21:16:38.967
> 
> 标签：c#, .net, compiler-construction

在我问我的问题之前，请看一下这个示例函数：

```
DateTime.TryParse("01/01/2000", out oDate) 
```

为什么我需要指定`out`关键字？编译器不应该从函数的定义中知道这一点吗？

我纯粹出于好奇而问这个问题，希望我能学到一些关于编译器的新东西。

我还应该澄清一下，我特别询问的是 C# .NET 3.5 编译器。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-06T21:19:39.537

out 关键字*可能*由编译器隐含，但我的理解是 C# 团队决定使`out`函数调用者明确要求该关键字，以增加对参数性质的可见性。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-06T21:19:03.500

编译器知道，你可能不知道。这是一种让您知道您传递的参数可以在您传递给它的函数中更改的方式。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-06T21:20:12.640

这不是关于编译器知道什么，而是确保开发人员意识到这个调用可以并且将会改变变量 X 的值。

其中很多都源于 C++，其中引用值不需要调用站点监视器。不可能查看 C++ 调用并确切知道它会做什么。C++中通过引用和值传递的参数在语义上有很大的不同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T21:19:36.713

是的，编译器可以弄清楚，但是这样你就知道它会修改你传入的变量。

C# 语言有很多我称之为安全网的东西，它们明确地告诉程序员正在发生什么。几个例子是：

1.  在 switch 语句中不会失败。
2.  您不能在 if 语句中赋值：if(x = 5) 会抛出错误而不是评估为真。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T21:22:21.700

[http://msdn.microsoft.com/en-us/library/t3c3bfhx(VS.80).aspx](http://msdn.microsoft.com/en-us/library/t3c3bfhx(VS.80).aspx)

"out 关键字导致参数通过引用传递。这与 ref 关键字类似，只是 ref 要求在传递之前对变量进行初始化。要使用 out 参数，方法定义和调用方法都必须显式使用out 关键字。”

由于 DateTime.TryParse 不需要初始化 oDate，因此您必须传递 out 关键字。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T21:28:34.757

好的，我不是 C# 专家，所以如果我搞砸了，有人请纠正我吗？

将参数传递给 C# 函数有两种方法：按值和按引用。这里最大的区别是修改函数内部的参数是否会修改用于调用它的变量。这不是我相信编译器自己决定的事情。

由于您希望 oDate 是从调用者传入的变量，并且已更改，因此您希望它通过引用传递。

另一个问题是它是否应该被初始化。C# 喜欢在未初始化的情况下使用变量，因为这几乎总是一个错误。在这种情况下，您可能只需声明您传入的内容，并使用 TryParse() 为其赋予第一个值。这是一个完全合法的技术，所以编译器应该允许它。这是另一件事我不相信编译器会正确。（我假设编译器还会检查以确保在 TryParse() 中使用之前初始化 out 参数。）

所以，“出”有两个目的。它确定参数是通过引用传入的，并且预计将在函数内部进行初始化。这些都不能由编译器确定。

# sql - 在 DB2 中将位数据的 char 转换为整数

> ID：620446
> 
> 赞同：2
> 
> 时间：2009-03-06T21:17:34.643
> 
> 标签：sql, db2, bit-manipulation

我正在编写一个 DB2 用户定义函数，我需要一个非负整数数组，我将其表示**为 bit data 的 varchar**。我计划为每个整数使用两个字节（给我一个最大值 2^16-1，这是可以接受的）。

**我可以使用chr**函数将整数转换为位数据的字符，但是如何将其恢复为整数？

有关 DB2 过程中位操作的任何其他建议也会有所帮助，因为我似乎找不到太多关于它的文档。我在 Linux 上使用 v9.1。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T16:55:37.663

我不确定 CHR 是否真的是你想要的。根据[文档](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.admin.doc/doc/r0000778.htm)，CHR 功能：

> 返回具有参数指定的 ASCII 码值的字符。参数可以是 INTEGER 或 SMALLINT。参数的值应该在 0 到 255 之间；否则，返回值为空。

CHR 函数的反面是[ASCII 函数。](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.admin.doc/doc/r0000770.htm)

DB2 标量过程的完整列表在[这里](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.admin.doc/doc/c0000767.htm)。

我不确定以这种方式编写 UDF 是否最适合您尝试做的事情。您可能需要考虑编写不在 SQL 中的存储过程。有一个支持的语言列表，如 Java、C、C++ 等。

# php - 如何显示大于当前日期的所有可能数据

> ID：620467
> 
> 赞同：0
> 
> 时间：2009-03-06T21:22:48.220
> 
> 标签：php

```
$Date = date("m/d/Y");
$result = mysql_query("SELECT * FROM service WHERE SType = 'Retreat' and Start_date > '$Date' "); 
```

Start_date 格式也是 m/d/y。

我的代码有什么问题？我要做的就是显示所有可能大于当前日期的数据。但它总是显示数据库中的所有数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T21:34:30.750

使用日期（“Ymd”）而不是日期（“m/d/Y”）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:27:47.363

你看过这个： http: [//www.bigroom.co.uk/blog/dates-in-php-and-mysql](http://www.bigroom.co.uk/blog/dates-in-php-and-mysql)吗？

这篇文章建议你考虑做类似的事情

```
$result = mysql_query(
    "SELECT * FROM service WHERE SType = 'Retreat' and Start_date > FROM_UNIXTIME($Date)"
); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T21:28:33.073

最好使用**YYYY-MM-DD**格式作为 MySQL 中的日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T21:34:54.633

这取决于您如何存储日期。如果它存储为 unixtime，那么您只需进行相等或更大的检查即可。

PHP 有一些很棒的函数可以将日期转换为 unixtime。喜欢[strtotime](http://is.php.net/manual/en/function.strtotime.php)

# perl - 如何使用 CAM::PDF 获取文本字符串的宽度和高度？

> ID：620470
> 
> 赞同：1
> 
> 时间：2009-03-06T21:23:10.403
> 
> 标签：perl, pdf

我使用以下内容读取 PDF 文件并获取页面的文本字符串：

```
my $pdf = CAM::PDF->new($pdf_file);
my $pagetree = $pdf->getPageContentTree($page_no);

# Get all text strings of the page
# MyRenderer is a separate package which implements getTextBlocks and
# renderText methods

my @text = $pagetree->traverse('MyRenderer')->getTextBlocks; 
```

现在，`@text`拥有所有文本字符串和每个文本字符串的开始 x,y。

如何获取每个字符串的宽度（可能还有高度）？

MyRenderer 包如下：

```
package MyRenderer;
use base 'CAM::PDF::GS';
sub new {
    my ($pkg, @args) = @_;
    my $self = $pkg->SUPER::new(@args);
    $self->{refs}->{text} = [];
    return $self;
}

sub getTextBlocks {
    my ($self) = @_;
    return @{$self->{refs}->{text}};
}

sub renderText {
    my ($self, $string, $width) = @_;
    my ($x, $y) = $self->textToDevice(0,0);
    push @{$self->{refs}->{text}}, {
                                    str => $string,
                                    left => $x,
                                    bottom => $y,
                                    right =>$x + $width,
                                   };
    return;
} 
```

**更新 1：** CAM::PDF 中 有一个函数**getStringWidth($fontmetrics, $string)** 。尽管该函数中有一个参数 $fontmetrics ，但无论我传递给该参数的内容如何，​​该函数都会为给定的字符串返回相同的值。

另外，我不确定返回值使用的度量单位。

**更新 2：** 我将 renderText 函数更改为以下内容：

```
sub renderText {
    my ($self, $string, $width) = @_;
    my ($x, $y) = $self->textToDevice(0,0);
    push @{$self->{refs}->{text}}, {
                                str => $string,
                                left => $x,
                                bottom => $y,
                                right =>$x + ($width * $self->{Tfs}),
                                font => $self->{Tf},
                                font_size => $self->{Tfs},
                               };
    return;
} 
```

请注意，除了获取 font 和 font_size 之外，我还将 $width 与字体大小相乘以获得字符串的实际宽度。

现在，唯一缺少的是高度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T02:02:50.573

getStringWidth() 很大程度上取决于您提供的字体指标。如果在该数据结构中找不到字符宽度，则返回到以下代码：

```
 if ($width == 0)
   {
      # HACK!!!                                                                   
      #warn "Using klugy width!\n";                                               
      $width = 0.2 * length $string;
   } 
```

这可能就是您所看到的。当我写这个时，我认为这比返回 0 更好。如果您的字体指标看起来不错，并且您认为 CAM::PDF 中存在错误，请随时[发布更多详细信息](http://rt.cpan.org/Public/Dist/Display.html?Name=CAM-PDF)，我会看看。

# sql - 在单个 SQL 语句中使用多个 COUNT 和 SUM

> ID：620471
> 
> 赞同：3
> 
> 时间：2009-03-06T21:23:12.117
> 
> 标签：sql, mysql

我有一个名为**pages**、**page_views**、**page_items**和**page_votes**的表。后三个表包含一个**page_id**外键，以便记录属于页面的每个单独的视图、项目和投票。

当我查询一个页面时，我还想检索**COUNT page_views**、**COUNT page_items**和**SUM page_votes.vote**。

我在下面粘贴了一个查询。它检索视图总数。我进行了各种尝试来添加项目和投票，但结果要么是语法错误，要么是视图/项目/投票返回为相同且“错误”的数字，可能是由于我加入的方式。

如何向此查询添加项目和投票？

```
SELECT
  Page.*,
  COUNT(*) AS views
FROM pages AS Page 
INNER JOIN page_views AS PageView
  ON Page.id = PageView.page_id 
GROUP BY Page.id 
ORDER BY views DESC   
LIMIT 10 OFFSET 0 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T21:25:47.337

这将选择`TOP 10 viewed`页面，并将仅计算这些页面的项目和投票。

如果您有很多页面但只需要`10`它们，则效率很高，消除了不必要的计数。

```
SELECT  (
        SELECT COUNT(*)
        FROM   page_views
        WHERE  page_views.page_id = pages.id
        ) AS views_count,
        (
        SELECT COUNT(*)
        FROM   page_items
        WHERE  page_items.page_id = pages.id
        ) AS items_count,
        COALESCE(
        (
        SELECT SUM(vote)
        FROM   page_votes
        WHERE  page_votes.page_id = pages.id
        ), 0) AS votes_sum
FROM    pages
ORDER BY
        views_count DESC
LIMIT 10 
```

更高效的查询：

```
SELECT  pages.*,
        (
        SELECT COUNT(*)
        FROM   page_items
        WHERE  page_items.page_id = pages.id
        ) AS items_count,
        COALESCE(
        (
        SELECT SUM(vote)
        FROM   page_votes
        WHERE  page_votes.page_id = pages.id
        ), 0) AS votes_sum
FROM    (
        SELECT  page_id, COUNT(*) AS cnt
        FROM    page_views
        GROUP BY
                page_id
        ORDER BY cnt DESC
        LIMIT 10
        ) AS pvd,
        pages
WHERE  pages.id = pvd.page_id 
```

, 消除不需要的连接`pages`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T21:58:50.707

假设我正确阅读了您的 SQL，并且您想要按视图排名前 10 的页面，请尝试以下操作：

```
SELECT p.*,
  (SELECT SUM(views) FROM page_views WHERE page_id = p.page_id) views,
  (SELECT SUM(votes) FROM page_votes WHERE page_id = p.page_id) votes,
  (SELECT SUM(items) FROM page_items WHERE page_id = p.page_id) items
FROM pages p
ORDER BY views DESC
LIMIT 10 
```

# sql - 在事务中保留自动增量 ID

> ID：620473
> 
> 赞同：2
> 
> 时间：2009-03-06T21:24:04.470
> 
> 标签：sql, mysql

假设我有两个表，用户和组，每个表都有一个自动递增的主键。每当创建新用户时，我想与该用户一起创建一个组（同时/同一事务）。但是，用户需要知道他们属于哪个组，因此每个用户都存储一个 group_id。

为了做到这一点，我创建了一个组并将其插入到数据库中，找出我刚刚插入的那个组的主键是什么，最后用这个新组的主键插入用户。

请注意，我需要将组提交到数据库（因此将其置于任何事务之外并提交用户）以检索分配给它的主键。

虽然这在大多数情况下都有效，但如果在我插入组并找出其主键和插入用户之间出现某种故障（电源故障、系统崩溃等），我最终会得到不一致的数据库。

有没有办法做一些事情，比如临时保留一个主键，这样如果系统崩溃，它就不会处于不一致的状态？

我主要关心 MySQL 数据库，但如果标准 SQL 中有一些东西可以让我这样做（因此与其他数据库后端兼容），我也有兴趣知道这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T21:26:03.827

很简单，只需将这两个操作放在一个事务中即可。启动事务，创建组，创建用户，然后提交事务。

```
SET autocommit = 0

START TRANSACTION

INSERT INTO Groups ...
INSERT INTO Users ...

COMMIT 
```

您必须为您的表使用支持事务的引擎，例如 InnoDB，才能使其正常工作。默认的 MyISAM 引擎不支持事务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:25:55.810

如果您使用事务，那么您将没有问题。

# html - 谁能告诉我为什么我的 按钮不会调整大小？

> ID：620476
> 
> 赞同：1
> 
> 时间：2009-03-06T21:25:14.110
> 
> 标签：html, resize

无论我将它们设置为我用于按钮的 DIV，都不会调整大小。我正在上传正确的文件，它在服务器上有更改，但无论我刷新多少都没有发生任何事情。我将删除 URL，因此一旦我得到答案，它就不能用作广告。

[删除网址]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T21:42:14.350

这里的问题是您正在尝试调整无法明确控制的内联元素的大小。为了设置元素的高度和宽度，您需要将其显示模式设置为“块”并使用浮动来水平对齐元素。

```
div .button {
   display: block;
   -moz-border-radius: 25px;
   -webkit-border-radius: 25px;
   border: 3px double #F1A631;
   background-color: #FCFF68;
   float: left;
   width: 150px;
   height: 30px;
} 
```

此外，您需要按照您希望它们从左到右显示的相反顺序重新排列您的 DIV。CSS2 中有一个名为“inline-block”的显示属性，旨在纠正此问题，但并未得到普遍支持。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:46:05.993

**在 CSS 中，带有display: inline**的元素不能应用*宽度*或*高度*。你需要**display: inline-block**。如果你给它们一个宽度或高度，IE 将错误地将任何内联元素转换为内联块。Fortunatley，自从 Firefox 3 发布以来，您可以使用 inline-block 只需最少的黑客攻击。

**没有 Firefox 2 兼容性：**

```
.ib { display: inline-block; zoom: 1; *display: inline; } 
```

**示例 HTML**

```
<div class="ib button">My button</div> 
```

**Firefox 2 兼容性**

```
.ib{ display: -moz-inline-stack; display: inline-block; zoom: 1; *display: inline; }
.button { display: block; } 
```

**示例 HTML**

```
<div class="ib"><div class="button">My button</div></div> 
```

在您的 .button 实现中，您需要删除 display: inline 部分。

# javascript - 在 iPhone 上锁定方向 UIWebView

> ID：620483
> 
> 赞同：2
> 
> 时间：2009-03-06T21:26:13.780
> 
> 标签：javascript, iphone, html, objective-c

有没有办法锁定 UIWebView 的方向？使用 Obj-C、JS 还是 Html？我不想有按钮或任何东西，我只想在应用程序打开后立即将其锁定为纵向。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T21:56:35.017

看起来[这个堆栈溢出帖子](https://stackoverflow.com/questions/432793)可能会间接回答您的问题。当 iPhone 旋转时，“顶级”视图会收到通知，该视图负责布置其子视图。

如果您的 UIWebView 是顶级视图，它将自动旋转。但是，如果您将 UIWebView 放在另一个视图中，并让该“容器”视图的视图控制器实现如下 shouldAutorateToInterfaceOrientation 方法：

```
-(BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
        return NO;
} 
```

这可能会阻止 UIWebView 知道界面已旋转。请注意，我实际上并没有尝试过，但它应该可以工作。

# c# - 对象初始化和“命名构造函数习语”

> ID：620484
> 
> 赞同：1
> 
> 时间：2009-03-06T21:26:17.197
> 
> 标签：c#, .net, object-initializers

行。所以我有一个值列表，我想做如下的事情：

```
MyObjectValues
.Select(currentItems=>new MyType()
{
     Parameter1 = currentItems.Value1,
     Parameter2 = currentItems.Value2
}); 
```

所以这就是问题所在。我需要上面的示例来使用命名构造函数，例如：

```
MyObjectValues
.Select(currentItems=>MyType.GetNewInstance()
{
     Parameter1 = currentItems.Value1,
     Parameter2 = currentItems.Value2
}); 
```

有什么办法可以做到吗？基本上，我需要调用一个静态方法来获取对象实例，并且我想像上面那样初始化它。

编辑：目前我没有一种简单的方法来修改 MyType 的接口，因此添加新的函数调用（虽然可能是“最好的”方法）目前不是很实用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T21:30:54.830

我敢肯定，有人会在 C# 4.0 之前的版本中想到一个聪明的方法，但我刚刚阅读了[Sam Ng 的关于 C# 4.0 中命名参数的博客文章](https://docs.microsoft.com/en-us/archive/blogs/samng/named-arguments-optional-arguments-and-default-values)。这应该可以解决您的问题。它看起来像这样：

```
MyObjectValues.Select(currentItems=>MyType.GetNewInstance(
    Parameter1:currentItems.Value1,
    Parameter2:currentItems.Value2)); 
```

**编辑**

忘了提一下，它的有用之处在于您可以为参数设置默认值，因此您不必全部传递它们。博客文章是一个很好的简短摘要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:34:53.230

不幸的是，在 C# 3.0 中没有对此的直接支持。对象初始化器*仅*支持构造函数调用。但是，您可能会考虑 Builder 模式。在我的协议缓冲区端口中，我支持它是这样的：

```
MyType foo = new MyType.Builder {Parameter1 = 10, Parameter2 = 20}.Build(); 
```

所以你的例子会变成：

```
MyObjectValues.Select(currentItems => new MyType.Builder
{
     Parameter1 = currentItems.Value1,
     Parameter2 = currentItems.Value2
}.Build()); 
```

当然，这意味着编写嵌套的 Builder 类型，但它可以很好地工作。如果您不介意 MyType*严格来说*是可变的，您可以保留一个不可变的 API，但创建一个实例`Builder`立即创建一个新实例`MyType`，然后设置属性（因为它可以访问私有成员），然后最后返回方法`MyType`中的实例`Build()`。（然后它应该“忘记”该实例，从而禁止进一步的突变。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T21:33:36.103

**更新：**工厂怎么样：

```
MyObjectValues.Select(currentItems=>MyTypeFactory.GetNewInstance(currentItems.Value1,
currentItems.Value2));

public static class MyTypeFactory
{
    public static MyType GetNewInstance(
         typeofvalue1 value1, 
         typeofvalue2 value2)
    {
        return new MyType { Parameter1 = value1, Parameter2 = value2 };
    }
} 
```

# c++ - 如何从 C++ 插件中检测 PowerPoint 2007？

> ID：620498
> 
> 赞同：1
> 
> 时间：2009-03-06T21:30:30.243
> 
> 标签：c++, powerpoint, idispatch

我需要通过我的 C++ 插件检测我的插件是否在 PowerPoint 2007 中。PowerPoint 对象模型公开了 Application.Version，它应该可以工作，但我对如何将它与 IDispatch 一起使用知之甚少。

如何从 C++ 插件中检测 PowerPoint 2007？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T21:50:01.600

首先 - 调用 IDispatch::GetIDsOfNames 并获取“版本”属性的 id。之后调用 IDispatch::Invoke 将通过 id 获取版本属性值。

此外，您可以使用 #import 指令生成包装器，并使用更简单的方法来获取此属性的值。

也许这篇文章会对您有所帮助[http://support.microsoft.com/kb/238393](http://support.microsoft.com/kb/238393)（如何使用 Visual C++ 自动化访问 DocumentProperties）

# delphi - "Left side cannot be assigned to" for record type properties in Delphi

> ID：620506
> 
> 赞同：23
> 
> 时间：2009-03-06T21:32:03.937
> 
> 标签：delphi, record

I'm curious to know why Delphi treats record type properties as read only:

```
 TRec = record
    A : integer;
    B : string;
  end;

  TForm1 = class(TForm)
  private
    FRec : TRec;
  public
    procedure DoSomething(ARec: TRec);
    property Rec : TRec read FRec write FRec;
  end; 
```

If I try to assign a value to any of the members of Rec property, I'll get "Left side cannot be assigned to" error:

```
procedure TForm1.DoSomething(ARec: TRec);
begin
  Rec.A := ARec.A;
end; 
```

while doing the same with the underlying field is allowed:

```
procedure TForm1.DoSomething(ARec: TRec);
begin
  FRec.A := ARec.A;
end; 
```

Is there any explanation for that behavior?

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-06T22:11:20.363

Since "Rec" is a property, the compiler treats it a little differently because it has to first evaluate the "read" of the property decl. Consider this, which is semantically equivalent to your example:

```
...
property Rec: TRec read GetRec write FRec;
... 
```

If you look at it like this, you can see that the first reference to "Rec" (before the dot '.'), has to call GetRec, which will create a temporary local copy of Rec. These temporaries are by design "read-only." This is what you're running into.

Another thing you can do here is to break out the individual fields of the record as properties on the containing class:

```
...
property RecField: Integer read FRec.A write FRec.A;
... 
```

This will allow you to directly assign through the property to the field of that embedded record in the class instance.

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-06T23:22:29.070

Yes this is a problem. But the problem can be solved using record properties:

```
type
  TRec = record
  private
    FA : integer;
    FB : string;
    procedure SetA(const Value: Integer);
    procedure SetB(const Value: string);
  public
    property A: Integer read FA write SetA;
    property B: string read FB write SetB;
  end;

procedure TRec.SetA(const Value: Integer);
begin
  FA := Value;
end;

procedure TRec.SetB(const Value: string);
begin
  FB := Value;
end;

TForm1 = class(TForm)
  Button1: TButton;
  procedure Button1Click(Sender: TObject);
private
  FRec : TRec;
public
  property Rec : TRec read FRec write FRec;
end;

procedure TForm1.Button1Click(Sender: TObject);
begin
  Rec.A := 21;
  Rec.B := 'Hi';
end; 
```

This compiles and workes without problem.

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-05-05T09:04:12.900

A solution I frequently use is to declare the property as a pointer to the record.

```
type
  PRec = ^TRec;
  TRec = record
    A : integer;
    B : string;
  end;

  TForm1 = class(TForm)
  private
    FRec : TRec;

    function GetRec: PRec;
    procedure SetRec(Value: PRec);
  public
    property Rec : PRec read GetRec write SetRec; 
  end;

implementation

function TForm1.GetRec: PRec;
begin
  Result := @FRec;
end;  

procedure TForm1.SetRec(Value: PRec);
begin
  FRec := Value^;
end; 
```

With this, directly assigning `Form1.Rec.A := MyInteger` will work, but also `Form1.Rec := MyRec` will work by copying all the values in `MyRec` to the `FRec` field as expected.

The only pitfall here is that when you wish to actually retrieve a copy of the record to work with, you will have to something like `MyRec := Form1.Rec^`

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-07T07:25:32.980

The compiler is stopping you from assigning to a temporary. The equivalent in C# is permitted, but it has no effect; the return value of the Rec property is a copy of the underlying field, and assigning to the field on the copy is a nop.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-06T22:29:35.767

Because you have implicit getter and setter functions and you cannot modify the Result of a function as it is a const parameter.

(Note: In case you transform the record in an object, the result would actually be a pointer, thus equivalent to a var parameter).

If you want to stay with a Record, you have to use an intermediate variable (or the Field variable) or use a WITH statement.

See the different behaviors in the following code with the explicit getter and setter functions:

```
type
  TRec = record
    A: Integer;
    B: string;
  end;

  TForm2 = class(TForm)
  private
    FRec : TRec;
    FRec2: TRec;
    procedure SetRec2(const Value: TRec);
    function GetRec2: TRec;
  public
    procedure DoSomething(ARec: TRec);
    property Rec: TRec read FRec write FRec;
    property Rec2: TRec  read GetRec2 write SetRec2;
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}

{ TForm2 }

procedure TForm2.DoSomething(ARec: TRec);
var
  LocalRec: TRec;
begin
  // copy in a local variable
  LocalRec := Rec2;
  LocalRec.A := Arec.A; // works

  // try to modify the Result of a function (a const) => NOT ALLOWED
  Rec2.A := Arec.A; // compiler refused!

  with Rec do
    A := ARec.A; // works with original property and with!
end;

function TForm2.GetRec2: TRec;
begin
  Result:=FRec2;
end;

procedure TForm2.SetRec2(const Value: TRec);
begin
  FRec2 := Value;
end; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-09-18T05:59:21.253

This is because property are actually complied as a function. Properties only return or set a value. It is not a reference or a pointer to the record

so :

```
Testing.TestRecord.I := 10;  // error 
```

is same as calling a function like this:

```
Testing.getTestRecord().I := 10;   //error (i think) 
```

what you can do is:

```
r := Testing.TestRecord;    // read
r.I := 10;
Testing.TestRecord := r;    //write 
```

It is a bit messy but inherent in this type of architecture.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-08T04:29:42.740

Like others have said - the read property will return a copy of the record, so the assignment of fields isn't acting on the copy owned by TForm1.

Another option is something like:

```
 TRec = record
    A : integer;
    B : string;
  end;
  PRec = ^TRec;

  TForm1 = class(TForm)
  private
    FRec : PRec;
  public
    constructor Create;
    destructor Destroy; override;

    procedure DoSomething(ARec: TRec);
    property Rec : PRec read FRec; 
  end;

constructor TForm1.Create;
begin
  inherited;
  FRec := AllocMem(sizeof(TRec));
end;

destructor TForm1.Destroy;
begin
  FreeMem(FRec);

  inherited;
end; 
```

Delphi will dereference the PRec pointer for you, so things like this will still work:

```
Form1.Rec.A := 1234; 
```

There's no need for a write part of the property, unless you want to swap the PRec buffer that FRec points at. I really wouldn't suggest to do such swapping via a property anyway.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-11-09T21:41:24.397

The simplest approach is:

```
procedure TForm1.DoSomething(ARec: TRec);
begin
  with Rec do
    A := ARec.A;
end; 
```

# asp.net - ASP.net 表单复式输入

> ID：620508
> 
> 赞同：1
> 
> 时间：2009-03-06T21:32:20.257
> 
> 标签：asp.net, javascript, ajax, forms

我有一个表单，我需要用户能够在文本框中输入某些内容，在他们使用标签后让他们在靠近它的另一个文本框中输入相同的值，以确保他们正确输入。之后，第二个文本框将消失，他们将继续下一个字段而无需回发。

有人对如何最有效地做到这一点有任何建议吗？是否有一个控件可以为我提供便利？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T21:52:29.800

您可以通过 javascript 轻松完成。在 onblur 或 onchange 客户端事件上，您应该检查两个文本框的值。

另一种选择：也许您想使用[CompareValidator](http://msdn.microsoft.com/en-us/library/db330ayw(VS.71).aspx)来比较表单元素的值。不要忘记设置 EnableClientScript=true 并使用[ValidationSummary](http://msdn.microsoft.com/en-us/library/f9h59855(VS.80).aspx)控件。

# java - 为什么java找不到我的方法？

> ID：620509
> 
> 赞同：2
> 
> 时间：2009-03-06T21:32:53.873
> 
> 标签：java, class, object, methods

我正试图围绕java中的一些东西来思考。当我将一个对象传递给另一个类的方法时，我不能只调用该对象类固有的任何方法吗？

如下示例代码无法编译的原因是什么？

谢谢，

```
class a {
  public static void myMethod(Object myObj) {
    myObj.testing();
  }
}

class b {
  public void testing() {
    System.out.println ("TESTING!!!");
  }
}

class c {  
  public static void main (String[] args) {
    b myB = new b();    
    a.myMethod(myB);  
  }
} 
```

**编辑：我将 myMethod 中的参数保留为 Object 类型的原因是因为我希望能够传入各种对象类型，每个对象类型都有一个 testing() 方法。**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-06T21:43:25.330

如果您想通过`testing()`方法传递各种对象，请让每个对象实现一个`Testable`接口：

```
public interface Testable
{
   public void testing()
} 
```

然后有`myMethod()`一个`Testable`。

```
public static void myMethod(Testable testable)
{
  testable.testing();
} 
```

* * *

编辑：为了澄清，实现一个接口意味着该类保证具有该方法，但该方法可以为所欲为。所以我可以有两个类，它们的`testing()`方法做不同的事情。

```
public class AClass implements Testable
{
   public void testing()
   {
      System.out.println("Hello world");
   }
}

public class BClass implements Testable
{
   public void testing()
   {
      System.out.println("Hello underworld");
   }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-06T21:35:46.690

问题是在它实际运行之前`myMethod`无法知道它正在获取一个对象。`b`你可以传`String`进去，因为它知道。

将其更改为

```
public static void myMethod(b myObj) {
  myObj.testing();
} 
```

它应该可以工作。

* * *

问题更新：

> **编辑：我将 myMethod 中的参数保留为 Object 类型的原因是因为我希望能够传入各种对象类型，每个对象类型都有一个 testing() 方法。**

正如 Amanda S 和其他几个人所说，这是一个完美的界面案例。做到这一点的方法是创建一个接口，该接口定义`testing()`方法并更改`myMethod`以获取实现该接口的对象。

另一种解决方案（没有接口）是反思性地发现对象是否有`testing()`方法并调用它，但对于这样一个简单的情况，不建议这样做，也不需要这样做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-06T21:47:38.707

你在说的是鸭子打字。Java 没有鸭子类型。

因此，您需要定义一个所有具有`testing()`方法的类都实现的接口。

例如：

```
public interface Testable
{
   public void testing()
}

class B implements Testable 
{
  public void testing() {
    System.out.println ("TESTING!!!");
  }
}

class A {
  public static void myMethod(Testable myObj) {
    myObj.testing();
  }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-06T21:48:16.223

您的问题是支持接口的经典论点。您希望尽可能通用，但您希望传递的每个对象都有一个 testing() 方法。我建议以下内容：

```
public interface Testable
{
  public void testing();
}

public class A
{
  public static void myMethod(Testable myObj)
  {    
    myObj.testing();
  }
}

public class B implements Testable
{
  public void testing()
  {
    System.out.println("This is class B");
  }
}

public class C implements Testable
{
  public void testing()
  {
    System.out.println("This is class C");
  }
}

public class Test
{  
  public static void main (String[] args) 
  {
    B myB = new B();
    C myC = new C();
    A.myMethod(myB); // "This is class B"
    A.myMethod(myC); // "This is class C" 
  }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-06T21:35:54.257

因为您正在传递一个对象（b 继承自对象）。对象没有测试，b 有。

您可以在调用方法之前传入 b 或将对象强制转换为 b。

编辑要传入实现该方法的泛型类：您需要创建一个具有方法签名的接口并传入接口类型而不是 Object。您传入的所有对象都必须实现该接口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T21:37:59.710

您只能访问对对象的引用类型可见的成员。

在这种情况下`myMethod(Object myObj)`，意味着只有在 Object 中定义的成员，因此在`class a`成员`class b`中将不可见。

如果您更改了`a.myMethod`to be的定义，`public static void myMethod(b myObj)`那么您将能够在while in`testing`的实例上看到该方法。`b``myMethod`

**根据澄清更新：**

在这种情况下，为所有这些定义一个接口来实现可能是您想要的。

```
public interface Testable {
    public void testing();
}

public class a {
    public static void myMethod(Testable myObj) {
        myObj.testing();
    }
}

public class b implements Testable {
    public void testing () {
        System.out.println("TESTING!!!");
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T22:21:04.210

> *为什么java找不到我的方法？*

因为Java的设计方式。

Java 是[“静态类型的”](http://en.wikipedia.org/wiki/Type_system)，这意味着**在**编译期间检查对象类型。

在 Java 中，只有当该方法属于该类型时，您才能调用该方法。

由于此验证是在编译期间进行的，并且 Object 类型没有“testing()”方法，因此编译失败（即使在运行时对象确实具有该方法”。这主要是为了安全。

其他人描述的解决方法将要求您创建一个新类型，您可以在其中告诉编译器

*“嘿，这种类型的实例**会**响应测试方法”*

如果您想传递各种对象并保持其非常通用，一种方法是让这些对象实现和接口。

```
public interface Testable { 
    public void testing();
}

class A implements Testable { // here this class commits to respond to "testing" message 
    public void testing() {
    }
}

class B implements Testable { // B "is" testable 
    public void testing() { 
        System.out.println("Testing from b");
    } 
}

class C implements Testable { // C is... etc. 
    public void testing() { 
        //.... 
    }
} 
```

后来在别的地方

```
public void doTest( Testable object ) { 
    object.testing();
}

doTest( new A() );
doTest( new B() );
doTest( new C() ); 
```

在java中执行此操作的“其他”方式是[反射性](http://java.sun.com/docs/books/tutorial/reflect/index.html)地调用方法，但我不确定这是否是您需要的，因为当您这样做时代码更加抽象，但这就是自动化测试框架的方式（和许多其他框架（例如 Hibernate）确实有效。

我希望这可以帮助您澄清原因。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-06T22:26:52.153

如果你真的，真的想尽可能地保持参数抽象，你应该考虑反射 API。这样，您可以传递您想要的任何对象并动态执行您想要的方法。你可以看看[一些例子](http://java.sun.com/developer/codesamples/refl.html)。

这不是唯一的方法，但根据您的问题，它可能是一种有效的替代方法。

Keep in mind that reflection is way slower than calling your methods directly. You might consider using an interface as well, such as the one on Amanda's post.

# visual-studio - Xcode中是否有类似“添加服务参考”的东西？

> ID：620518
> 
> 赞同：0
> 
> 时间：2009-03-06T21:34:31.670
> 
> 标签：visual-studio, xcode

我目前的工作地点主要是一家微软商店，我们非常广泛地使用 Visual Studio。我越来越喜欢懒惰地使用“添加服务引用”（以前在 VS2005 中为“添加 Web 引用”）下载 WSDL 并在漂亮、方便的命名空间中形成类和方法。

自从我们开始涉足 iPhone 开发以来，我们一直使用 Xcode 作为 iPhone 项目的 IDE。我希望能够做类似的事情，但一直无法找到这种能力是否存在。

如果 Xcode 中有类似的功能，它在哪里？
如果没有，是否有模板或我可以下载的东西可以满足我的需求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:20:02.310

没有任何内置的消费肥皂服务。如果您的团队将 WCF 用于 Web 服务，那么您最简单的方法是将 REST 端点添加到您现有的服务中。然后，您可以结合使用 NSUrlConnection、NSXmlParser 和键值编码，使其几乎同样简单。

# python - 找到与现有类型最接近的匹配类型的最佳方法是什么？

> ID：620530
> 
> 赞同：0
> 
> 时间：2009-03-06T21:37:18.323
> 
> 标签：python, types

我在 Python 2.5 中有一个类和类型的注册表，如下所示：

```
class ClassA(object):
    pass

class ClassB(ClassA):
    pass 

MY_TYPES = {
    basestring : 'A string',
    int : 'An integer',
    ClassA : 'This is ClassA or a subclass',
} 
```

我希望能够将类型传递给函数，并让它在层次结构中查找最接近的匹配类型。所以，查找`str`会返回`"A string"`，查找`ClassB`会返回`"This is ClassA or a subclass"`问题是，我不知道如何找到类型对象的超类（或者更确切地说，跟踪 MRO 链）。

处理这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T21:44:48.133

```
from inspect import getmro
[st for cls, st in MY_TYPES.items() if cls in getmro(ClassB)]

['This is ClassA or a subclass'] 
```

或者如果您只对第一个匹配生成器版本感兴趣：

```
(st for cls, st in MY_TYPES.iteritems() if cls in getmro(ClassB)) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:41:28.003

要获取类的超类，请使用`__bases__`：

```
class ClassA(object):
    pass

class ClassB(ClassA):
    pass

print ClassB.__bases__
(<class '__main__.ClassA'>,) 
```

但是，请注意诸如 之类的事情`int`。所有这些的基础将是`<type 'object'>`. 您必须进行一些测试和迭代以匹配您在示例中列出的 dict 键。

另一种选择是`isinstance`在任何对象实例或`issubclass`参数上使用，针对您的 dict 键测试每个对象。有些人认为`isinstance`及其同类是魔鬼的标记，但 c'est la vie。不过，再次注意不要`issubclass`与 ints 和其他此类类型一起使用。给定您的 dict 键，您可能需要结合一些方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T00:40:06.577

> （st for cls，st in MY_TYPES.iteritems() if cls in getmro(ClassB)）

更简单的写法是：

```
(st for cls, st in MY_TYPES.iteritems() if issubclass(ClassB, cls)) 
```

然而，这并没有找到“最近的”匹配；如果“对象”在查找中，它可以匹配所有内容！如果您在查找中有属于其他事物的子类的事物，或者您想支持多重继承，那么您必须选择 MRO 中的第一个：

```
for cls in inspect.getmro(ClassB):
    if cls in MY_TYPES:
        print MY_TYPES[cls]
        break
else:
    print 'Dunno what it is' 
```

无论如何......我通常会认为类型查找有点代码味道，没有更好的方法来做你想做的事吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T21:56:20.697

这确实是通用函数的工作。请参阅[PEAK 规则](http://peak.telecommunity.com/DevCenter/RulesReadme)和[PEP 3124](http://www.python.org/dev/peps/pep-3124/)。泛型函数将允许您根据参数类型甚至更复杂的表达式调度任意函数。

或者，如果您真的很喜欢惩罚，请见证[Practical Common Lisp](http://www.gigamonkeys.com/book/)的这一[章](http://www.gigamonkeys.com/book/object-reorientation-generic-functions.html)。

# c# - 正在为每个子控件调用 OnPaint 方法

> ID：620533
> 
> 赞同：3
> 
> 时间：2009-03-06T21:38:27.573
> 
> 标签：c#, winforms, drawing, onpaint

我有一个 UserControl（WinForms，.net 2.0），我有这个：

```
protected override void OnPaint(PaintEventArgs e)
{
    base.OnPaint(e);

    var rect = e.ClipRectangle;
    var pen = new Pen(Brushes.LightGray, 1);

    e.Graphics.DrawRectangle(pen, rect);
} 
```

我基本上想在 UserControl 上绘制一个边框，但矩形也在所有子控件中绘制！我从来没有读过它应该为每个子控件调用，有解决方案吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T22:10:07.340

你为什么用它`PaintEventArgs.ClipRectangle`来确定矩形的边界？尝试[`Control.ClientRectangle`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.clientrectangle.aspx)改用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T22:16:29.993

因为子控件使父控件无效，导致每个控件都触发此方法。

不要使用 e 作为参数（e 将是触发事件的任何控件，无论是否为子控件），而是使用控件名称显式。

# c# - 使用 OrderBy<> 对项目数组进行排序

> ID：620534
> 
> 赞同：25
> 
> 时间：2009-03-06T21:38:31.363
> 
> 标签：c#, arrays, sorting

我有一系列项目，我想对它们的一个属性进行排序。我可以使用“ *item.Fields[“FieldName”].Value* ”访问 items 属性，该属性作为字符串返回，但我可以将其转换为 int。

我看过 OrderBy<> 但我不知道如何使用它。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-06T21:43:41.880

需要明确的是，`OrderBy`不会对数组进行就地排序——它将返回一个新序列，该序列是数组的排序*副本*。如果没关系，那么你想要类似的*东西*：

```
var sorted = array.OrderBy(item => item.Fields["FieldName"].Value); 
```

另一方面，我不明白您关于属性作为字符串返回但您可以将其转换为 int 的评论 - 您不能将字符串转换为 int，您必须解析它们。如果这就是你的意思，你可能想要：

```
var sorted = array.OrderBy(item => int.Parse(item.Fields["FieldName"].Value)); 
```

如果你想把它作为一个数组，你可以在`ToArray()`之后调用：

```
var sorted = array.OrderBy(item => int.Parse(item.Fields["FieldName"].Value))
                  .ToArray(); 
```

或者，`Array.Sort`如果您想就地排序，您可以使用，但这会有点混乱。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-06T21:47:50.530

使用 Sort 方法对数组进行排序：

```
Array.Sort(theArray, (a, b) => String.Compare(a.Fields["FieldName"].Value, b.Fields["FieldName"].Value)); 
```

如果您不使用 C# 3，则使用委托而不是 lambda 表达式：

```
Array.Sort(theArray, delegate(Item a, Item b) { return String.Compare(a.Fields["FieldName"].Value, b.Fields["FieldName"].Value); } ); 
```

（这也适用于框架 2，而 OrderBy 扩展不适用。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-06T21:43:49.587

如果您可以使用 orderby，它应该很容易，请尝试以下操作。我投入了 int.Parse 虽然根据您实际想要的排序方式，这可能不是必需的。

```
var sorted = array.OrderBy(item => int.Parse(item.Fields["FieldName"].Value)); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-06T21:45:02.690

```
var sortedArray = items.OrderBy(i => i.property).ToArray(); 
```

如果您不想要一个数组，您可以将其关闭，在这种情况下您将拥有一个 IEnumerable<> 类型的 item。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-12-31T04:03:22.767

值得一提的是，它[`List<T>.Sort`](http://msdn.microsoft.com/en-us/library/w56d4y5z.aspx)是基于快速排序的，而且在大多数情况下它并不是一种稳定的排序。

> 此实现执行不稳定的排序；也就是说，如果两个元素相等，则可能不会保留它们的顺序。相反，稳定排序保留了相等元素的顺序。

但是，您可以使用[`Enumberable.OrderBy`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.orderby?redirectedfrom=MSDN&view=netframework-4.8#System_Linq_Enumerable_OrderBy__2_System_Collections_Generic_IEnumerable___0__System_Func___0___1__System_Collections_Generic_IComparer___1__)which 执行稳定的排序。

> 该方法执行稳定排序；也就是说，如果两个元素的键相等，则保留元素的顺序。相反，不稳定的排序不会保留具有相同键的元素的顺序。

# vb6 - 如何以编程方式更新 vb6 项目中的 OCX 引用？

> ID：620535
> 
> 赞同：4
> 
> 时间：2009-03-06T21:38:36.607
> 
> 标签：vb6, activex

我定期破坏二进制兼容性，需要重新编译由几十个 ActiveX DLL 和 OCX 组成的整个 vb6 应用程序。我已经编写了一个脚本来自动化这个过程，但是我遇到了一个问题。

当 OCX 以项目兼容性重新编译时，其版本会增加，并且引用 OCX 的项目将不会重新编译，直到它们的引用更新到新版本。这个是项目正常打开时自动勾选的，提示用户更新引用，但我需要在脚本中进行。

我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-01-27T14:24:54.650

我们正在做类似的事情，即在我们的[VB6 项目引用更新工具](http://10tec.com/vb6-project-references-update/)（[在此处下载](https://10tec.com/download/free-products.aspx)）中直接在 VB6 .vbp 文件中操作对使用过的 OCX 的引用。通常它用于在使用的 ActiveX 更改其版本号、CLSID 等时更新引用。

[![在此处输入图像描述](https://i.stack.imgur.com/JLLOM.png)](https://i.stack.imgur.com/JLLOM.png)

这些工具是开源的，所以对这个问题感兴趣的每个人都可以借用我们的 VB 代码片段来实现这些任务。

我们的工具是用 Visual Basic 6 编写的，并使用 tlbinf32.dll（TypeLib 信息 DLL），它允许您以编程方式从类型库中提取信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T05:24:13.147

我的项目维护了十多年，由两打 ActiveX DLL 和六个控件的层次结构组成。也用脚本系统编译。

我不建议做你正在做的事情。

我们所做的如下

1.  进行更改，包括在 IDE 中添加和测试。
2.  我们从层次结构的底部编译到顶部
3.  我们将新编译的文件复制到修订目录，例如 601，然后是 602 等
4.  我们创建 setup.exe
5.  当设置完成后，我们将修订目录复制到我们的兼容性目录中。请注意，我们从不指向项目目录中的已编译二进制文件。始终指向包含所有 DLL 的兼容性目录。

这样做的原因是，如果您使用 OLE 视图工具查看 IDL 源代码，您会发现任何引用的控件或 dll 都通过#include 添加到界面中。如果您指向项目目录中的二进制文件，则会从注册表中获取包含，这可能会导致很多奇怪和兼容性。

但是，如果引用的 DLL 存在于二进制存在的目录中，同时用于二进制兼容性，则 VB6 将使用它而不是注册表中的任何内容。

现在有一个问题，你会很少遇到。考虑这个层次结构

*   我的实用程序DLL
*   我的对象DLL
*   我的UIDLL
*   我的EXE

如果您在 MyUtilityDLL 中向类中添加属性或方法，如果幸运的话，MyUIDLL 可能无法编译，出现二进制不兼容错误或类似 [inref] 的奇怪错误。无论如何，解决方案是编译 MyUtilityDLL，然后立即将 MyUtilityDLL 复制到兼容性目录中。然后其余的自动编译将正常工作。

您可能希望将此步骤包含在自动构建中。

请注意，在许多情况下，项目将在 IDE 中正常工作。如果你现在意识到这一点，你可能会把头发拉出来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T22:06:16.197

我猜你必须编辑引用 DLL 和 OCX 的项目文件 (.vbp)、表单文件 (.frm) 和控制文件 (.ctl) 并增加 typelib 版本号。

您会在注册表中找到控件/DLL 的最新 typelib 版本号。

这可能会很痛苦，具体取决于您拥有多少文件。

一个技巧是使用您的脚本使用 VB6 打开主项目并发送密钥以确认更新引用，然后保存项目。

祝你好运

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T00:49:46.507

自我回答：我编写了一些 vb6 代码以编程方式进行升级。它没有经过广泛的测试，可能存在一些针对极端情况的错误，但我确实成功地使用了它。

```
Option Explicit

Const HKEY_LOCAL_MACHINE As Long = &H80000002
Const KEY_ENUMERATE_SUB_KEYS As Long = 8
Private Declare Function RegOpenKeyEx Lib "advapi32.dll" Alias "RegOpenKeyExA" (ByVal hKey As Long, ByVal lpSubKey As String, ByVal ulOptions As Long, ByVal samDesired As Long, phkResult As Long) As Long
Private Declare Function RegEnumKeyEx Lib "advapi32.dll" Alias "RegEnumKeyExA" (ByVal hKey As Long, ByVal dwIndex As Long, ByVal lpName As String, lpcbName As Long, lpReserved As Long, ByVal lpClass As String, lpcbClass As Long, lpftLastWriteTime As Any) As Long
Private Declare Function RegCloseKey Lib "advapi32.dll" (ByVal hKey As Long) As Long

'''Returns the expected major version of a GUID if it exists, and otherwise returns the highest registered major version.
Public Function GetOcxMajorVersion(ByVal guid As String, Optional ByVal expected_version As Long) As Long
    Const BUFFER_SIZE As Long = 255
    Dim reg_key As Long
    Dim ret As Long
    Dim enum_index As Long
    Dim max_version As Long: max_version = -1

    ret = RegOpenKeyEx(HKEY_LOCAL_MACHINE, "SOFTWARE\Classes\TypeLib\{" & guid & "}", 0, KEY_ENUMERATE_SUB_KEYS, reg_key)
    If ret <> 0 Then Err.Raise ret, , "Failed to open registry key."
    Do
        'Store next subkey name in buffer
        Dim buffer As String: buffer = Space(BUFFER_SIZE)
        Dim cur_buffer_size As Long: cur_buffer_size = BUFFER_SIZE
        ret = RegEnumKeyEx(reg_key, enum_index, buffer, cur_buffer_size, ByVal 0&, vbNullString, ByVal 0&, ByVal 0&)
        If ret <> 0 Then Exit Do
        buffer = Left(buffer, cur_buffer_size)

        'Keep most likely version
        buffer = Split(buffer, ".")(0)
        If Not buffer Like "*[!0-9A-B]*" And Len(buffer) < 4 Then
            Dim v As Long: v = CLng("&H" & buffer) 'convert from hex
            If v = expected_version Then
                max_version = v
                Exit Do
            ElseIf max_version < v Then
                max_version = v
            End If
        End If

        enum_index = enum_index + 1
    Loop
    RegCloseKey reg_key

    If max_version = -1 Then Err.Raise -1, , "Failed to enumerate any viable subkeys."
    GetOcxMajorVersion = max_version
End Function

Public Function RemoveFilename(ByVal path As String) As String
    Dim folders() As String: folders = Split(Replace(path, "/", "\"), "\")
    RemoveFilename = Left(path, Len(path) - Len(folders(UBound(folders))))
End Function

'''Changes any invalid OCX references to newer registered version
Public Sub UpdateFileOCXReferences(ByVal path As String)
    Dim file_data As String
    Dim changes_made As Boolean

    'Read
    Dim fn As Long: fn = FreeFile
    Open path For Input As fn
        While Not EOF(fn)
            Dim line As String
            Line Input #fn, line

            'check for ocx reference line
            If LCase(line) Like "object*=*{*-*-*-*-*}[#]*#.#*[#]#*;*.ocx*" Then
                'get guid
                Dim guid_start As Long: guid_start = InStr(line, "{") + 1
                Dim guid_end As Long: guid_end = InStr(line, "}")
                Dim guid As String: guid = Mid(line, guid_start, guid_end - guid_start)

                'get reference major version
                Dim version_start As Long: version_start = InStr(line, "#") + 1
                Dim version_end As Long: version_end = InStr(version_start + 1, line, ".")
                Dim version_text As String: version_text = Mid(line, version_start, version_end - version_start)

                'play it safe
                If Len(guid) <> 32 + 4 Then Err.Raise -1, , "GUID has unexpected length."
                If Len(version_text) > 4 Then Err.Raise -1, , "Major version is larger than expected."
                If guid Like "*[!0-9A-F-]*" Then Err.Raise -1, , "GUID has unexpected characters."
                If version_text Like "*[!0-9]*" Then Err.Raise -1, , "Major version isn't an integer."

                'get registry major version
                Dim ref_version As Long: ref_version = CLng(version_text)
                Dim reg_version As Long: reg_version = GetOcxMajorVersion(guid, ref_version)

                'change line if necessary
                If reg_version < ref_version Then
                    Err.Raise -1, , "Registered version precedes referenced version."
                ElseIf reg_version > ref_version Then
                    line = Left(line, version_start - 1) & CStr(reg_version) & Mid(line, version_end)
                    changes_made = True
                End If
            End If

            file_data = file_data & line & vbNewLine
        Wend
    Close fn

    'Write
    If changes_made Then
        Kill path
        Open path For Binary As fn
            Put fn, , file_data
        Close fn
    End If
End Sub

'''Changes any invalid in included files to newer registered version
Public Sub UpdateSubFileOCXReferences(ByVal path As String)
    Dim folder As String: folder = RemoveFilename(path)
    Dim fn As Long: fn = FreeFile
    Open path For Input As fn
        While Not EOF(fn)
            Dim line As String
            Line Input #fn, line

            If LCase(line) Like "form=*.frm" _
                            Or LCase(line) Like "usercontrol=*.ctl" Then
                Dim file As String: file = folder & Mid(line, InStr(line, "=") + 1)
                If Dir(file) <> "" Then
                    UpdateFileOCXReferences file
                End If
            End If
        Wend
    Close fn
End Sub 
```

# c# - C# 字符串操作 - 如何删除集合中每个连接字符串的第一个元素

> ID：620546
> 
> 赞同：1
> 
> 时间：2009-03-06T21:43:59.853
> 
> 标签：c#, string, listview

我正在根据我的 ListView 控件每一行中的数据创建连接字符串。我需要弄清楚如何删除每个字符串中与 ListView 的单行有关的第一个元素。我怎么能做到这一点？这是一个 C# winforms 项目。

**这是我当前的代码：**

```
 foreach (ListViewItem HazPackErrItems in HazmatPackageErrorListview.Items)
        {
            string HazPackErrRow = " ";

            foreach (ListViewItem.ListViewSubItem HazPackErrSub in HazPackErrItems.SubItems)
            {
                HazPackErrRow += " " + HazPackErrSub.Text + ",";
            }
            // Remove comma after last element of string.
            HazPackErrRow = HazPackErrRow.Substring(0, HazPackErrRow.Length - 2); 
            MessageBox.Show(HazPackErrRow); // List concatenated subitems
        } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T21:45:36.510

只是不要一开始就添加它？

```
foreach (ListViewItem HazPackErrItems in HazmatPackageErrorListview.Items)
    {
        string HazPackErrRow = " ";

        bool first = true;
        foreach (ListViewItem.ListViewSubItem HazPackErrSub in HazPackErrItems.SubItems)
        {
            if (first) 
                first = false;
            else
                HazPackErrRow += " " + HazPackErrSub.Text + ",";
        }
        // Remove comma after last element of string.
        HazPackErrRow = HazPackErrRow.Substring(0, HazPackErrRow.Length - 2); 
        MessageBox.Show(HazPackErrRow); // List concatenated subitems
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T21:49:48.467

这是基于 Inferis 的回答，但它使用 StringBuilder 并避免了对最终 Substring 调用的需要：

```
foreach (ListViewItem errors in HazmatPackageErrorListview.Items)
{
    StringBuilder builder = new StringBuilder();

    bool first = true;
    foreach (ListViewItem.ListViewSubItem error in errors.SubItems)
    {
        if (first)
        {
            first = false;
        }
        else
        {
            if (builder.Length > 0)
            {
                builder.Append(", ");
            }
            builder.Append(error.Text);
        }
    }
    MessageBox.Show(builder.ToString()); // List concatenated subitems
} 
```

这是解决分隔符问题的另一种方法：

```
foreach (ListViewItem errors in HazmatPackageErrorListview.Items)
{
    StringBuilder builder = new StringBuilder();

    bool first = true;
    string prefix = "";
    foreach (ListViewItem.ListViewSubItem error in errors.SubItems)
    {
        if (first)
        {
            first = false;
        }
        else
        {
            builder.Append(prefix);
            prefix = ", ";
            builder.Append(error.Text);
        }
    }
    MessageBox.Show(builder.ToString()); // List concatenated subitems
} 
```

当然，还有更简单的方法：

```
foreach (ListViewItem errors in HazmatPackageErrorListview.Items)
{
    string[] bits = errors.SubItems.Skip(1)
                          .Select(item => item.Text)
                          .ToArray();
    string errorLine = string.Join(", ", bits);
    MessageBox.Show(errorLine);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T21:52:08.430

如果您可以使用 Linq，请使用 String.Join()，它会更容易阅读：

```
 foreach (ListViewItem HazPackErrItems in HazmatPackageErrorListview.Items)
    {
        string HazPackErrRow = string.Join(", ", HazPackErrItems.SubItems.Skip(1).Select(s => s.Text).ToArray())

        MessageBox.Show(HazPackErrRow); // List concatenated subitems
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T21:46:59.347

您可以使用[`IList<T>.Skip()`](http://msdn.microsoft.com/en-us/library/bb358985.aspx)：

```
foreach (var HazPackErrSub in HazPackErrItems.SubItems.Skip(1)) 
```

因为其他人似乎在重写你的代码，我为什么不呢？=]

```
foreach(ListViewItem HazPackErrItems in HazmatPackageErrorListview.Items)
{
    string HazPackErrRow = String.Join(", ", HazPackErrItems.SubItems.Skip(1).Select(t => t.Text).ToArray());

    MessageBox.Show(HazPackErrRow); // List concatenated subitems
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T21:47:09.940

如果我正确理解了这个问题，您可以使用 for 循环并将索引从 1 开始而不是 0。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T22:21:37.283

在开头添加逗号，然后您只需进行一次检查，而不是每次迭代都检查

```
 string HazPackErrRow = "";
foreach (ListViewItem.ListViewSubItem HazPackErrSub in HazPackErrItems.SubItems)        
{
            HazPackErrRow +=  "," + " " + HazPackErrSub.Text;        
}
// Remove comma before first element of string.
if(HazPackErrRow.Length > 0)
 HazPackErrRow = HazPackErrRow.Substring(1); 
```

编辑：嗯，忽略我，我误读了这个问题。

# java - 更新数据库记录的最佳实践

> ID：620551
> 
> 赞同：3
> 
> 时间：2009-03-06T21:46:52.483
> 
> 标签：java, database, hibernate, sql-update

假设您检索 100 条记录，并将它们显示在页面上。用户仅更新页面上的 2 条记录。现在您只想更新两条记录，而不是其他 98 条记录。

最好在页面上提交一个，然后以某种方式知道哪两个已更新，然后仅将这两个发送到数据库进行更新？

“不知何故”是什么样子的？

或者，您是否会为每一行设置一个更新提交按钮，并让它只更新与其关联的记录？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:02:24.550

当然，有不同的方法可以做到这一点。一般来说，您可以通过使用 Javascript 仅针对已更改的记录组装您的 POST 数据来节省一些麻烦和服务器端处理。关于这可能如何工作的两个想法：

1）走ajax路线并进行*实时*编辑。因此记录显示在表格中，并且似乎不可编辑。当用户单击特定行时，该行变为可编辑的，方法是使用 Javascript 动态创建适当的 html 表单。然后有一个提交按钮或其他一些处理程序（例如，将焦点移动到另一个表行），这将触发更新数据库的 POST（通过您首选的 ajax 方法异步）。令人高兴的是，主流 Javascript 框架可以在这方面提供很多帮助。

2) 复选框 - 每当编辑一行时，它的复选框就会被选中。单击提交按钮时，使用 javascript 通过抓取选中复选框的行中的所有内容来发布 POST 数据。用户可以在提交之前取消选中一个框以取消对该行的更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T21:58:54.187

使用 jQuery 或其他一些 JavaScript 库对其进行 Ajax，并在每一行上放置和更新按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T21:59:32.950

这个问题有很多答案，在某种程度上，它们取决于您的开发工具和网站的“感觉”。

如果您正在实现 Ajax 调用以逐行进行更新，那么从逻辑上讲，每行都有一个按钮，然后在更改行时使用 Ajax 调用对其进行更新，这在逻辑上似乎是正确的。

这也只是断开数据集旨在解决的场景，而 ADO.net 可以很好地处理这些问题。

因此，与以往一样，答案是“视情况而定！”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T22:01:38.750

当用户更改输入字段时，您可以使用 JavaScript 将每个字段标记为已更改。创建一个隐藏字段，其中包含您要更新的行的 id 和脏标志。（如 is_dirty_$id） 在 JavaScript 中，创建一个 onChange 处理程序，将隐藏字段设置为脏。当任何输入发生变化时。

或者，您可以为您显示的每个真实字段创建隐藏字段。隐藏字段将包含初始值。检查服务器端的每个字段以确定发生了什么变化。

您可能希望将 last_modified 日期存储为每条记录的隐藏字段。这样，如果另一个用户更新了相同的记录，您可以显示一条错误消息，指出“此记录已被另一个用户更新”或类似的信息。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-06T21:58:28.600

一个提交按钮。我可以预见我可能会使用不止一个，但在一般情况下只使用一个。（注意，这对我来说看起来像是一个网页问题，所以我用这个假设来回答。）

您可以想到 3 种方法可以处理跟踪更改：

JavaScript：在更新隐藏字段的控件上放置一个 onChange() 函数。如果该隐藏有一个值，则更新关联的记录。在浏览器上需要 JS，并且不会告诉您要更新哪些字段，只告诉您哪些记录。

大量表单字段：每个控件都放置一个隐藏字段，并在它们返回时进行比较。这会很难看，但它可以让您知道要更新哪些字段（不仅仅是记录）。它还可以让您知道是否有人撤消了开始的更改。

会话：您可以将原始值放在会话变量中，然后在值返回时进行比较。这将比许多隐藏字段更优雅一些，并且对玩回传数据的人不那么开放（因为你永远不应该相信任何返回的东西，即使是在隐藏字段中）。需要浏览器上的 cookie 和服务器技术上的会话。

# javascript - 使用谷歌地图 api 的标记和折线

> ID：620558
> 
> 赞同：2
> 
> 时间：2009-03-06T21:48:52.057
> 
> 标签：javascript, api, google-maps

我有一张地图，它有标记和折线。

现在我需要将这些折线和不同图层上的标记分开 IE

当我想删除折线时，我只需执行带有删除折线图层的图层名称的方法

你能帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T23:21:00.417

不确定您所说的层是什么意思，但请查看文档。

[Google Maps API Docs](http://code.google.com/apis/maps/documentation/reference.html) Sepcifically，查看 GPolyline.hide();

# c# - 如何在 List 的公共属性中添加值 输入c#？

> ID：620560
> 
> 赞同：2
> 
> 时间：2009-03-06T21:49:30.103
> 
> 标签：c#, list, collections

```
private List<string> _Baseline = new List<string>();

public List<string> Baseline 
{
    get { return _Baseline; }
    set { _Baseline = value; }
} 
```

如何设置此属性？它不允许我使用 add 方法添加；它会引发“对象引用空”错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T21:53:31.733

如果你做了你在这里写的事情，它应该可以工作。我猜你正在使用泛型，我在你的帖子中看不到它们。

如果您有一个复杂的表达式，请将其拆分。例如，将 ObjectA.Prop.Other.Xyz.Add(..) 更改为：

```
SomeClass a = ObjectA.Prop;
SomeClass2 b = a.Other;
SomeClass3 c = b.Xyz;
c.Add(...) 
```

这样你会很快找到空引用的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T23:04:40.987

有3种可能：

1.  你`list<string>`是空的
2.  包含你的对象`list<string>`为空
3.  您插入的项目为空

1 在您为其分配新列表时得到解决

2和3我们无法从您在此处发布的代码中确定。

如果你不打算允许在你的类之外分配一个新的列表对象，那么你不需要一个 setter，正如其他地方所指出的那样。您可以删除它或将其声明为私有或受保护，就像这样......

```
public List<string> Baseline 
{
    get { return _Baseline; }
    protected set { _Baseline = value; }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T21:52:44.183

您是否在使用前初始化了`new`包含此属性的类（使用）？

有两种可能的情况（假设您的代码在`MyClass`课堂上）：

```
//External code:
MyClass x = new MyClass();
x.Baseline = null; // Somewhere it'll be set to null.
x.Baseline.Add("Something"); // NullReferenceException 
```

或者：

```
//External code:
MyClass x = null; // Somewhere the class itself is set to null.
x.Baseline.Add("Something"); // NullReferenceException 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-03-02T12:16:36.687

由于声明不正确，我得到了同样的错误：

```
private List<string> _Baseline;    - incorrect
private List<string> _Baseline = new List<string>();    - correct 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-06T22:01:54.630

您可能需要使用 IList：

```
private IList<string> _Baseline = new List<string>();

public IList<string> Baseline 
{
    get { return _Baseline; }
    set { _Baseline = value; }
} 
```

# sql - 如何仅在日期时间的日期部分创建唯一约束？

> ID：620561
> 
> 赞同：11
> 
> 时间：2009-03-06T21:49:37.890
> 
> 标签：sql, sql-server, sql-server-2008, datetime, unique-constraint

我正在编写一个非常简单的博客引擎供自己使用（因为我遇到的每个博客引擎都太复杂了）。我希望能够通过其 URL 来唯一标识每个帖子，例如`/2009/03/05/my-blog-post-slug`. 为了在数据层中完成它，我想创建一个复合唯一约束，以限制组合日期的日期部分（忽略一天中的时间）在`(Date, Slug)`哪里。`Date`我自己有一些想法（比如另一列，可能是计算出来的，只包含日期部分），但我来到 SO 是为了知道解决这个问题的最佳实践是什么。

我怀疑 SQL Server 版本在这里很重要，但为了记录，我使用的是 2008 Express（我欣赏更便携的解决方案）。

表架构：

```
create table Entries (
    Identifier int not null identity,
    CompositionDate datetime not null default getdate(),
    Slug varchar(128) not null default '',
    Title nvarchar(max) not null default '',
    ShortBody nvarchar(max) not null default '',
    Body nvarchar(max) not null default '',
    FeedbackState tinyint not null default 0,
    constraint pk_Entries primary key(Identifier),

    constraint uk_Entries unique (Date, Slug) -- the subject of the question
) 
```

## 选择的解决方案：

考虑到这个问题大约是 2008 年，我认为 marc 的解决方案更合适。但是，我将使用整数方法（但不使用`INSERT`s，因为它不能确保数据的完整性；我将使用预先计算的整数列）因为我认为使用来自客户端的整数事物（在查询中）更容易。

谢谢你们。

```
create table Entries (
    Identifier int not null identity,
    CompositionDate smalldatetime not null default getdate(),
    CompositionDateStamp as cast(year(CompositionDate) * 10000 + month(CompositionDate) * 100 + day(CompositionDate) as int) persisted,
    Slug varchar(128) not null default '',
    Title nvarchar(max) not null default '',
    ShortBody nvarchar(max) not null default '',
    Body nvarchar(max) not null default '',
    FeedbackState tinyint not null default 0,
    constraint pk_Entries primary key(Identifier),
    constraint uk_Entries unique (CompositionDateStamp, Slug)
)
go 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-06T21:55:54.317

好吧，在 SQL Server 2008 中，有一个名为“DATE”的新数据类型——您可以使用该列并在其上创建索引。

当然，您也可以将“DATE”类型的计算列添加到您的表中，只需将 DATETIME 列的日期部分填充到该计算列中，使其成为 PERSISTED，然后对其进行索引。应该工作得很好！

像这样的东西：

```
ALTER TABLE dbo.Entries
   ADD DateOnly as CAST(CompositionDate AS DATE) PERSISTED

CREATE UNIQUE INDEX UX_Entries ON Entries(DateOnly, Slug) 
```

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T22:10:26.793

由于您在 2008 年，请按照 Marc 的建议使用 Date 数据类型。否则，更简单的解决方案是使用格式为 YYYYMMDD 的日期的非计算列（这意味着您必须在 INSERT 上填充它）。这是一个整数数据类型，体积小且易于使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T22:01:37.220

对于 SQL 2005，您可以执行 marc_s 推荐的基本相同的操作，只需使用标准 DateTime。它看起来像这样（此处未经测试的代码）：

```
ALTER TABLE Entries ADD
    JustTheDate AS DATEADD(day, DATEDIFF(day, 0, CompositionDate), 0) NOT NULL PERSISTED 
```

然后在 (JustTheDate, Slug) 上创建您的索引

注意：那里的 DATEADD/DATEDIFF 语句只计算 CompositionDate 的日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T12:42:14.380

多年来，我们在 SQL Server 中遇到了各种计算列问题，因此我们已经停止使用它们。

您可以将 VIEW 与仅用于日期的列一起使用 - 并在该 VIEW 的列上放置一个唯一索引。

（一个可能有用的副作用是您可以让 VIEW 排除某些行 - 因此您可以实现诸如“DateColumn 必须是唯一的，但排除 WHERE DateColumn IS NULL）之类的东西

现有的 CompositionDate 列可以拆分为两个字段 - CompositionDate 和 CompositionTime - 以及一个检索视图，如果需要，可以将它们重新组合在一起 - 然后允许在仅日期列上使用本机索引

（这可以在 SQL 2005 和更早的版本中使用 DateTime 来实现——尽管对于日期或时间来说有点奢侈，而不是两者）

最后，您可以有一个 INSERT / UPDATE 触发器，该触发器强制不存在具有重复 CompositionDate 的其他记录（仅限日期部分）

# delphi - 递增十六进制字符串

> ID：620582
> 
> 赞同：2
> 
> 时间：2009-03-06T21:58:32.890
> 
> 标签：delphi

我正在尝试像这样增加一个十六进制字符串：

```
#$67#$1c#$87#$b1;
#$67#$1c#$87#$b2;
#$67#$1c#$87#$b3;

```

这是我的程序：

```
var test : array [0..3] of char; intSequence : cardinal;

Sequence := #$67#$1c#$87#$b1;

procedure IncSequence;
begin
  move(Sequence[1],intSequence,SizeOF(Sequence));
  inc(intSequence);
  move(intSequence,Sequence[1],SizeOf(test));
end; 
```

有了这个程序，只增加了第二个字节。结果是：

```
#$67#$1D#$87#$B1  
#$67#$1E#$87#$B1
#$67#$1F#$87#$B1

```

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T22:36:12.690

您也可以通过创建“变体记录”并仅使用 Inc();

```
type
  testrec = record
    case Byte of
      0: (data: array[0..3] of AnsiChar);
      1: (intSequence: Integer);
  end;
var
  Sequence: testrec;
begin
  Sequence.data = #$b1#$87#$1c#$67; // reversed because of "endian-ness"
  Inc(Sequence.intSequence);
end; 
```

在这种情况下，数据和 intSequence 字段在内存中相互“重叠”，因此对一个字段的任何写入都会立即反映在另一个字段中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:26:58.500

您在这里遇到三个问题：

1.  SizeOf(Sequence) 不是序列的长度。
2.  您将序列类型定义为 [0..3]，因此您需要将索引开始为 0
3.  字节序问题。在小端机器上，即使您将索引和长度设置正确，您也会得到`#$67#$1c#$87#$b1 #$68#$1c#$87#$b1 #$69#$1c#$87#$b1 ...`有关此问题的解决方案，请参阅[本文](http://edn.embarcadero.com/article/28964)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T22:50:54.777

*警告，不是德尔福专家*

不要进行字符串操作，也不要使用整数数组。

你想要的是增加一个数字，所以这样做！十六进制数表示单个整数，而不是整数数组。

1.  将十六进制字符串转换为整数
2.  递增整数
3.  将整数转换为十六进制字符串

不要跟我抱怨这效率低下，它是正确的、简单的、显而易见的。代码应该是这样的。

如果您的十六进制字符串太大而无法放入整数，那么继续使用整数数组，只需确保封装它，这样看起来就像您处理一种类型。然后您可以单独测试这个整数类型的数组

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T22:22:43.940

如果要增加序列，您应该执行以下操作：

```
move(Sequence[0], intSequence, SizeOf(Cardinal));
inc(intSequence);
move(intSequence, Sequence[0], SizeOf(Cardinal)); 
```

您的代码不起作用，因为 Sequence[1] 指向 Sequence 的第二个字节（数组以 0 开头）并且 Sequence 和 test 都由字节/字符组成，因此只有 1 个字节被传输。

编辑：尝试此操作后，我看到 intSequence 以“向后”字节顺序存储，这增加了 Sequence 的第一个字节，因此您可能想要反转 Sequence 之前。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-07T03:04:35.353

我想我明白这里到底发生了什么：

我相信这是 Delphi 2009。 Char 实际上是一个 UnicodeChar，它是一个*两*字节变量。

增加第 4 个字节，你真正改变了什么？第二个字符的低位字节——准确地产生所示的输出。如果你让它超过 $FF 你会看到一个非常不同的结果！

抱歉，我无法提供更多信息，我还没有升级。

# apache-flex - Flex HA 手风琴没有文字？

> ID：620586
> 
> 赞同：0
> 
> 时间：2009-03-06T21:59:01.470
> 
> 标签：apache-flex

我是一个灵活的菜鸟，我正在尝试弄清楚如何实现水平手风琴。我正在尝试在 Doug McCune 的博客上制作手风琴的水平版本：http: [//dougmccune.com/blog/2007/09/22/nifty-flex-accordion-menu-like-on-applecom/](http://dougmccune.com/blog/2007/09/22/nifty-flex-accordion-menu-like-on-applecom/)

我只是将 VACcordion 切换到 HAccordion（和一些样式），当我这样做时，文本不再呈现在标题上。我可以将其他组件添加到标题中，这些组件将呈现，但不会呈现文本。

如何使文本出现在标题上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:09:41.977

在版本 10 发布之前，Flash Player 存在无法使用标准设备字体显示旋转文本的限制。如果您的目标是 Flash Player 9，则需要[嵌入](http://livedocs.adobe.com/flex/3/html/fonts_04.html)标题中使用的字体。顺便说一下，默认字体是 Verdana。

# asp.net-mvc - 为什么我的图像/脚本不会显示在 asp.net mvc 部署的站点上？

> ID：620587
> 
> 赞同：1
> 
> 时间：2009-03-06T21:59:13.450
> 
> 标签：asp.net-mvc, deployment, iis-6

我已将应用程序部署到 IIS6 服务器。现在，我正在使用通配符映射。我的应用程序在我的开发机器上运行良好，但是当我尝试在服务器上访问它时，有些页面可以正常工作，有些则不能。

给我最大的问题是脚本和图像。

我有一个 url [http://localhost/sdev/home/index](http://localhost/sdev/home/index)并且页面很好，除了图像和脚本没有加载。当我查看源代码并查看我看到的 url 时：

```
../../Content/Images/logo.png 
```

如果我尝试导航到该网址，它会尝试转到

```
http://localhost/content/images/logo.png 
```

代替

```
http://localhost/sdev/content/images/logo.png 
```

奇怪的是有些页面可以正常工作，例如：

```
http://localhost/sdev/ServiceCall/DivisionStep/ALB?type=fsr 
```

关于我能做些什么来解决这个问题的任何想法？是的，我已经阅读了 Phil 的说明，并认为我正确地遵循了它们，但也许我错过了一些东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T08:05:40.873

采用

```
<%= Url.Content("~/Content/Images/logo.png") %> 
```

生成网址，你应该没问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T09:05:57.937

我刚刚为您可以使用的图像编写了一些帮助程序。

(1) 只需使用 a 创建一个名为 AppHelper 的公共静态类`using System.Web.Mvc;`，并将其添加到 MVC 项目中名为“Helpers”的文件夹中。

(2) 复制这些方法：

> ```
>  public static string Image(this HtmlHelper helper,
>         string classText, string sourcePath, string altText, string width, string height)
>     {
>         return Image(helper, classText, sourcePath, altText, width, height, null);
>     } 
> ```

```
 public static string Image(this HtmlHelper helper,
        string classText, string sourcePath, string altText, string width, string height, object htmlAttributes)
    {
        StringBuilder sb = new StringBuilder();
        if (htmlAttributes != null)
            foreach (PropertyInfo p in htmlAttributes.GetType().GetProperties())
                sb.AppendFormat(@" {0}=""{1}""", p.Name, p.GetValue(htmlAttributes, null).ToString());

        if (htmlAttributes == null)
            return String.Format(@"<img{0} src=""{1}"" alt=""{2}"" width=""{3}"" height=""{4}"" />",
                String.IsNullOrEmpty(classText) ? String.Empty : String.Format(@" class=""{0}""", classText),
                (new UrlHelper(helper.ViewContext.RequestContext)).Content(sourcePath),
                altText, width, height);
        else
            return String.Format(@"<img{0} src=""{1}"" alt=""{2}"" width=""{3}"" height=""{4}""{5} />",
                String.IsNullOrEmpty(classText) ? String.Empty : String.Format(@" class=""{0}""", classText),
                (new UrlHelper(helper.ViewContext.RequestContext)).Content(sourcePath),
                altText, width, height, sb.ToString());
    } 
```

(3) ..并像这样使用： `<% =Html.Image("small_pic_border","~/Content/Images/Home/office2_137x139.jpg","principal headshot","137","139") %>`

该方法使用了 liammclennan 提到的 Url.Content 方法。它还应该迫使你养成一些好的习惯：比如使用替代文本等。

对于脚本使用： `<script type="text/javascript" src="<% =Url.Content("~/Scripts/mootools.js") %>"></script>`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:07:49.220

而不是这样做：

```
../../Content/Images/logo.png 
```

做这个：

```
/sdev/Content/Images/logo.png 
```

更好的是，在您的代码中生成该 URL (/sdev) 的第一部分，因为听起来那部分可能会改变（我猜这里的“sdev”是该网站的某种开发版本，并且用于生产URL 前面没有“sdev”吗？）

它在第一个示例中不起作用的原因是浏览器将其视为您正在查看“sdev/home”目录中名为“index”的文件。因此，向上两个目录会将您带到根级别。

它对“/sdev/ServiceCall/DivisionStep/ALB”工作正常，因为您现在正在“/sdev/ServiceCall/DivisionStep”目录中查看“ALB”，并且上升两个级别会将您带到“/sdev”

# java - 在 Ant 构建中引用外部库

> ID：620590
> 
> 赞同：1
> 
> 时间：2009-03-06T22:01:14.197
> 
> 标签：java, ant

我们为 PDA 开发的项目有一个 ant 构建脚本。在 Eclipse 中，我们有大量引用的库，当我们在 PDA 上运行 jar 时，我知道如何让它们工作，因为我们有一个 .lnk 文件，您可以在其中添加外部库，只需添加以下内容：

```
512#"\J9\PPRO11\bin\j9.exe" -jcl:ppro11 -cp "\dist\WiFiTest.jar;\placelab\lib\placelab.jar" j2medemo.wifi.WiFiTest 
```

在 -cp 参数之后添加我们需要的任何库。但是，我不知道如何在 ant 文件中复制它（不知道实际上是夸大其词，但在阅读了所有文档后我*仍然*不明白）。

我们有以下 .

```
<target name="jar" depends="prepare">
 <delete file="${dist}/${appname}.jar"/>
 <delete file="${dist}/MANIFEST.MF"/>
 <manifest file="${dist}/MANIFEST.MF">
    <attribute name="Built-By" value="${user.name}"/>
    <attribute name="Main-Class" value="j2medemo.GUI.MapPanel"/>
</manifest>
<jar destfile="${dist}/${appname}.jar"
     basedir="${classes}"
     includes="**/*.class, **/*.jpg, **/*.gif,**/*.png,**/*.xml"
     manifest="${dist}/MANIFEST.MF"
     />
</target> 
```

我已经尝试在我能想到的任何地方添加，但它没有帮助。我可以将它添加到包含部分吗？

其次，我们有一个运行目标：

```
<target name="run" description="run" depends="jar">
    <exec dir="${j9bin}" executable="${j9bin}\j9.exe">
        <arg line="-jcl:ppro11 -cp '${dist}\${appname}.jar;placelab\lib\placelab.jar' ${mainclass}"/>
        <env key="JAVA_HOME" path="${j9home}"/>
    </exec>
</target> 
```

我想改变它来运行一个不同的类，所以我创建了以下两个目标：

```
<target name="jarSAX" depends="prepare">
 <delete file="${dist}/SAXParse.jar"/>
 <delete file="${dist}/MANIFEST.MF"/>
 <manifest file="${dist}/MANIFEST.MF">
    <attribute name="Built-By" value="${user.name}"/>
    <attribute name="Main-Class" value="j2medemo.Routes.SAXParse"/>
</manifest>
<jar destfile="${dist}/SAXParse.jar"
     basedir="${classes}"
     includes="**/*.class, **/*.jpg, **/*.gif,**/*.png,**/*.xml"
     manifest="${dist}/MANIFEST.MF"
     />
</target> 
```

和

```
<target name="runSAXParser" description="run" depends="jarSAX">
        <exec dir="${j9bin}" executable="${j9bin}\j9.exe">
            <arg line="-jcl:ppro11 -cp '${dist}\SAXParse.jar' j2medemo.Routes.SAXParse"/>
            <env key="JAVA_HOME" path="${j9home}"/>
        </exec>
    </target> 
```

但是，如果我尝试运行它，我会收到以下错误：

```
Exception in thread "main" java.lang.NoClassDefFoundError: j2medemo.Routes.SAXParse 
```

如果有人对这两个问题最有帮助的任何想法/解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T22:19:51.890

据我所知，您需要将类路径元素添加到清单中。应该看起来像这样：

```
 <manifest file="${dist}/MANIFEST.MF">
    <attribute name="Built-By" value="${user.name}"/>
    <attribute name="Main-Class" value="j2medemo.Routes.SAXParse"/>
    <attribute name="Class-Path" value="WiFiTest.jar;placelab.jar"/>
 </manifest> 
```

类路径条目应该与可分发的 Jar 的位置相关。从那里，您应该能够直接执行 jar（使用 -jar 命令行选项，我不确定 J9 是什么）。应该类似于类似的 Java 调用：

```
java -jar MainJar.jar 
```

# php - PHP 内存限制

> ID：620602
> 
> 赞同：13
> 
> 时间：2009-03-06T22:04:43.063
> 
> 标签：php

在 PHP 5.0.4 中，如果您**不**配置 -enable-memory-limit，memory_limit 指令将被忽略。（在推荐的 php.ini 文件中设置为 8M，但文档说它被忽略了。）那么在这种情况下，是否存在每个脚本的内存限制，或者它仅受系统限制？

我问是因为我正在升级到 PHP 5.2.8，默认情况下它**确实**允许内存限制。所以现在我实际上必须将值设置为适当的值。推荐的 php.ini 文件现在设置为 128M，但我不知道这是否比 5.0.4 默认设置的*更多*或*更少！*

我正在升级生产系统，所以我想避免行为发生任何重大变化。[文档](http://us3.php.net/ini.core)（搜索“memory_limit”）在这一点上非常混乱。它说“默认”，但我不知道这是否意味着在配置文件中设置的默认值，或者它在禁用内存限制时使用的默认值。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-07T23:58:01.537

PHP 中的内存限制器是可选的；如果您在编译时禁用它，则根本没有限制。

在 5.0.4 中它被禁用，除非你在编译时明确要求它，原因是内存限制器在[5.2 之前是无用](http://php.net/manual/en/migration52.other.php)的，并且没有计算它应该做的很多事情，包括 mysql 函数之类的事情。现在他们学会了计数，它从 5.2.1 开始*启用。*

如果有疑问，请禁用它或确保更新配置文件以使用新的默认值。将其保留为 8MB 并升级到 5.2.8 几乎肯定会导致问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-06T22:08:57.360

128M非常高。你可能需要那个，但我会感到惊讶。

更重要的是，可以在 php.ini 中将限制设置为全局默认值：

```
memory_limit = 32M 
```

您也可以在脚本中覆盖它：

```
<?php
ini_set('memory_limit', '128M');
... 
```

您可能会发现您只有少数需要大量内存的脚本。找到一些舒适的价值（通过测试），然后为需要更多的人增加它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-06T22:13:42.590

php 在 5.2 之前的默认内存限制是 8MB，在 php 5.2.0 中增加到默认的 16MB。目前默认为 128MB。

要重现 5.2 之前版本的行为，请将内存限制显式设置为 8MB。

查看 php.net 网站上的“资源限制”。

[http://us.php.net/ini.core](http://us.php.net/ini.core)

**编辑**

“在 PHP 5.2.1 之前，为了使用这个指令，它必须在编译时通过在配置行中使用 -enable-memory-limit 来启用。”

检查旧服务器的编译标志，如果您没有启用它，则不会强制执行任何限制。

# cocoa - 双击 Cocoa 中的 NSTableView 行？

> ID：620603
> 
> 赞同：75
> 
> 时间：2009-03-06T22:05:08.773
> 
> 标签：cocoa, nstableview, double-click

当用户双击`NSTableView`. 我很难找到有关如何完成此操作的信息或示例。谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2009-03-06T22:18:18.693

看看[`-setDoubleAction:`](https://developer.apple.com/documentation/appkit/nstableview/1526992-doubleaction)NSTableView上的方法；您可以将其设置为一个方法，该方法将像正常的目标操作系统一样被调用，但需要双击。

在那个动作方法中，[`-clickedRow`](https://developer.apple.com/documentation/appkit/nstableview/1527357-clickedrow)会很有用。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2011-12-04T22:14:57.497

为 Cocoa 的其他新人添加更多基本信息到 @JimPuls 答案。

1.  NSTableView 的 IBOutlet 需要在接口中声明。我认为最好在表的代表中这样做。
2.  IBOutlet 到表需要通过 Interface Builder 连接。为此，在 IB 中从声明出口的类到表视图的 Ctrl-Drag & Drop。当您释放鼠标时，应该会出现一个弹出窗口，其中包含您在步骤#1 中声明的插座名称。选择那个。
3.  在@implementation 部分，在 -awakeFromNib 方法上，在步骤#1 中声明并在步骤#2 中连接的 IBOutlet 上调用 -setTarget: 和 -setDoubleAction:。

这是我的表视图委托的摘录。我将我的委托也设置为数据源，这就是为什么您会看到与其关联的 NSTableViewDelegate 和 NSTabeViewDataSource 接口。

// 接口摘录。

```
@interface MyTableViewDelegate : NSObject <NSTableViewDelegate, NSTableViewDataSource>
{
  // This iVar needs to be connected to the table view via the IB.
  IBOutlet NSTableView *tableOutlet;
}

@property (assign) IBOutlet NSTableView *tableOutlet;

- (void)doubleClick:(id)nid;

@end 
```

// 实现摘录。

```
@implementation MyTableViewDelegate

@synthesize tableOutlet = _tableOutlet;

- (void)awakeFromNib {
  [_tableOutlet setTarget:self];
  [_tableOutlet setDoubleAction:@selector(doubleClick:)];
}

- (void)doubleClick:(id)object {
  // This gets called after following steps 1-3.
  NSInteger rowNumber = [_tableOutlet clickedRow];
  // Do something...
} 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-09-22T20:28:27.853

如果有人在寻找 swift 2.0 版本：这对我有用。似乎比 Objective C 代码容易得多。

```
@IBOutlet weak var searchResultTable: NSTableView!

override func viewDidLoad() {
    super.viewDidLoad()
    searchResultTable.doubleAction = "doubleClickOnResultRow"
}

func doubleClickOnResultRow()
{
    print("doubleClickOnResultRow \(searchResultTable.clickedRow)")
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-03-25T14:17:27.627

正如 PR Singh 所说，您可以使用可可绑定，也可以传递 selectedObjects。

1.  在 IB 中选择您的表视图，然后在绑定检查器中设置这两个绑定，如下所示：

    ```
    >Double Click Target

    bind to = Application delegate object (or file owner)
    model key path = self
    selector name = myMethod:

    >Double Click Argument

    bind to = array controller
    controller key = selectedObjects
    selector name = myMethod: 
    ```

myMethod 实现为

```
- (void)myMethod:(NSArray*)selectedObjects
{
    NSLog(@"%@", selectedObjects);
} 
```

这也记录在这里： [https ://developer.apple.com/library/mac/qa/qa1472/_index.html](https://developer.apple.com/library/mac/qa/qa1472/_index.html)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-11-11T06:10:27.030

您可以在 Interface Builder 中连接双击操作。按住 Control 并单击您的表格视图（确保您获得的是**表格视图**，而不是滚动视图或剪辑视图或表格列）以获取其连接面板。在“Sent Actions”部分找到“doubleAction”项。将其连接到您选择的 IBAction。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-10-26T09:44:36.737

更新了 Alfred 对 Swift 5 的回答

```
@IBOutlet weak var searchResultTable: NSTableView!

override func viewDidLoad() {
    super.viewDidLoad()
    searchResultTable.target = self
    searchResultTable.doubleAction = #selector(doubleClickOnResultRow)
}

@objc func doubleClickOnResultRow()
{
    print("doubleClickOnResultRow \(searchResultTable.clickedRow)")
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-23T12:59:52.087

你可以对绑定做同样的事情，首先在 .h 文件中声明一个mentod

```
-(IBAction)openWindow:(id)sender 
```

在 .m 文件中实现相同

```
-(IBAction)openWindow:(id)sender
{
    //do something here;
} 
```

到达您的表格视图所在的笔尖，选择表格视图并获得属性检查器的倒数第二个选项卡（绑定），打开`double click argument`披露三角形检查绑定到复选框选择文件的所有者，模型键路径应该是“自我”，选择器名称将是“openWindow：”，与“双击目标”披露相同的过程，这将起作用

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-04-06T03:25:01.567

在 SWIFT 4.1 上，您在代码中设置 TableView 对象的 doubleAction 方法，以使用 #selector(nameOfYourFunction) 执行 @objc 函数

在此函数中，您调用 segue。您可以将新窗口链接到 InterfaceBuilder 上的原始窗口（不是 NSTableView 对象，而是实际的 ViewController 对象。

然后为准备 segue 的新窗口进行所有设置：

好的，首先在 Interface Builder 上：

[![在此处输入图像描述](https://i.stack.imgur.com/mKH3x.jpg)](https://i.stack.imgur.com/mKH3x.jpg)

当然给那个segue一个标识符：

[![在此处输入图像描述](https://i.stack.imgur.com/zJGlo.jpg)](https://i.stack.imgur.com/zJGlo.jpg)

接下来，在我们的第一个视图控制器（表视图所在的位置）代码中：

```
 //We use this function: prepare for segue
override func prepare(for segue: NSStoryboardSegue, sender: Any?) {
        // check if we are referring to the actual segue we want
          if segue.identifier?.rawValue == "segueToYourNewWindow" {
    // now create a reference to that new window
            let yourNewWindow = segue.destinationController as! newWindowViewController
    // now change variables inside that view controller code, remember that the objects might fail if they are not yet visible to the user so first set up the variables or call them using the main thread, up to your design.
           yourNewWindow.selectedRowVariable = thisTableView.clickedRow
        } 
```

然后我们需要一个函数来在表格视图的双击上执行segue，这个函数是用#selector调用的，因此需要对Objective C可见（即使我们正在用Swift编程）我们只需简单地用@启动函数对象就是这样。

```
@objc func doubleClickOnResultRow() {
//beware of double-clicking also triggers this function when no rows is selected with the selectedRow being -1
 if (thisTableView.selectedRow > -1 ) {
  performSegue(withIdentifier: NSStoryboardSegue.Identifier(rawValue: "segueToYourNewWindow"), sender: nil)
 }
} 
```

最后，我们在代码的初始设置部分中将此函数设置为 TableView 的 doubleAction 方法，如下所示：

```
override func viewDidLoad() {
    super.viewDidLoad()
    thisTableView.doubleAction = #selector(doubleClickOnResultRow)
} 
```

# c++ - 指针参数和引用参数的区别？

> ID：620604
> 
> 赞同：70
> 
> 时间：2009-03-06T22:05:14.373
> 
> 标签：c++, pointers, reference, object-slicing

这些是否相同：

```
int foo(bar* p) {
  return p->someInt();
} 
```

和

```
int foo(bar& r) {
  return r.someInt();
} 
```

忽略空指针电位。这两个函数在功能上是否相同，无论`someInt()`是 virtual 还是传递了`bar`的子类或子类`bar`？

这切任何东西：

```
bar& ref = *ptr_to_bar; 
```

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-06T22:12:36.227

C++ 引用故意没有在标准中指定使用指针来实现。引用更像是变量的“同义词”，而不是指向它的指针。这种语义为编译器打开了一些可能的优化，当它可能意识到在某些情况下指针可能是一种过度杀伤力时。

还有一些区别：

*   您不能将 NULL 分配给引用。这是一个至关重要的区别，也是您更喜欢其中一个的主要原因。
*   当您获取指针的地址时，您将获得指针变量的地址。当您获取引用的地址时，您将获得被引用变量的地址。
*   您不能重新分配参考。一旦它被初始化，它的整个生命周期都指向同一个对象。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-06T22:33:27.427

忽略每个语法糖和可以用一个而不是另一个来完成的可能性，以及在其他答案（其他问题）中解释的指针和引用之间的区别......是的，这两个在功能上完全相同！两者都调用函数并且都同样处理虚函数。

不，你的线没有切片。它只是将引用直接绑定到指针指向的对象。

关于为什么要使用其中一个的一些问题：

*   [指针和引用的区别](https://stackoverflow.com/questions/57483/difference-between-pointer-variable-and-reference-variable-in-c)
*   [通过指针传递引用有什么好处吗？](https://stackoverflow.com/questions/334856/are-there-benefits-of-passing-by-pointer-over-passing-by-reference-in-c/334944)
*   [指针与参考](https://stackoverflow.com/questions/114180/pointer-vs-reference)

我没有尝试自己提出差异，而是将您委托给那些您想知道的人。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-07T05:30:41.430

引用是一个常量指针，即您不能更改引用以引用其他对象。如果您更改，引用对象的值会更改。

例如：

```
 int j = 10;
       int &i = j;
       int l = 20;
       i = l; // Now value of j = 20

       int *k = &j;
       k = &l;   // Value of j is still 10 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-06T22:14:12.697

是的，它们在功能上是相同的。由于引用将要求您在使用它之前将其设置为对象，因此您不必处理空指针或指向无效内存的指针。

查看语义差异也很重要：

*   当您实际上将正常传递对象时使用引用 - 但它是如此之大以至于传递对对象的引用而不是制作副本更有意义（如果您不修改对象）。
*   当您想处理内存地址而不是对象时，请使用指针。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-06T22:11:42.440

我很久没有使用 C++，所以我什至不会尝试真正回答你的问题（对不起）；然而，Eric Lippert 刚刚发布了一篇关于指针/引用的[优秀文章](http://blogs.msdn.com/ericlippert/archive/2009/02/17/references-are-not-addresses.aspx)，我想我会指给你看。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-07T02:40:29.670

不确定是否有人回答了隐藏在底部的关于切片的第二个问题......不，这不会导致切片。

切片是指派生对象被分配（复制）给基类对象——派生类的特化被“切片”掉。请注意，我说的是*对象*被复制，我们不是在谈论被复制/分配的指针，而是对象本身。

在您的示例中，这没有发生。您只是取消引用指向 Bar 对象的指针（从而导致 Bar 对象）在引用初始化中用作右值。不确定我的术语是否正确...

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-06T22:46:16.473

正如其他人所提到的，在实现中引用和指针在很大程度上是相同的。有一些小警告：

*   您不能将 NULL 分配给引用（shoosh 提到了这一点）：这很重要，因为没有“未定义”或“无效”的引用值。

*   您可以将临时变量作为**const**引用传递，但将指针传递给临时变量是不合法的。

例如，这没关系：

```
class Thingy; // assume a constructor Thingy(int,int)
void foo(const Thingy &a)
{ 
   a.DoSomething();
}

void bar( ) 
{
  foo( Thingy(1,2) );
} 
```

但大多数编译器都会抱怨

```
void foo2( Thingy * a);

void bar2()
{
  foo( &Thingy(1,2) );
} 
```

*   获取变量的地址以获取指针会强制编译器将其保存到内存中。分配对局部变量的引用只会创建同义词；在某些情况下，这可能允许编译器将数据保留在寄存器上并避免[load-hit-store](http://www.google.com/search?q=load+hit+store)。但是，这仅适用于局部变量——一旦通过引用将某些内容作为参数传递，就无法避免将其保存到堆栈中。

```
void foo()
{
   int a = 5;
   // this may be slightly more efficient
   int &b = a;
   printf( "%d", ++b );
   // than this
   int *c = &a;
   printf( "%d", ++(*c) );
} 
```

*   同样，[__restrict 关键字](http://msdn.microsoft.com/en-us/library/5ft82fed(VS.80).aspx)不能应用于引用，只能应用于指针。

*   你不能对引用进行指针运算，所以如果你有一个指向数组的指针，那么数组中的下一个元素可以通过 p+1 获得，一个引用在其整个生命周期中只指向一个事物。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-06T22:16:39.977

这些功能显然不是“相同的”，但就虚拟行为而言，它们的行为相似。关于切片，这只发生在处理值时，而不是引用或指针。

# c# - 如何从任意字符串生成有效的 Windows 文件名？

> ID：620605
> 
> 赞同：104
> 
> 时间：2009-03-06T22:05:17.493
> 
> 标签：c#, windows, filenames

我有一个像“Foo: Bar”这样的字符串，我想将它用作文件名，但在 Windows 上，文件名中不允许使用“:”字符。

有没有一种方法可以将“Foo: Bar”变成类似“Foo-Bar”的东西？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-03-06T22:09:40.430

尝试这样的事情：

```
string fileName = "something";
foreach (char c in System.IO.Path.GetInvalidFileNameChars())
{
   fileName = fileName.Replace(c, '_');
} 
```

**编辑：**

由于`GetInvalidFileNameChars()`将返回 10 或 15 个字符，因此最好使用 a`StringBuilder`而不是简单的字符串；原始版本将花费更长的时间并消耗更多的内存。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-03-06T22:14:28.953

```
fileName = fileName.Replace(":", "-") 
```

然而，“:”并不是 Windows 唯一的非法字符。您还必须处理：

```
/, \, :, *, ?, ", <, > and | 
```

这些包含在 System.IO.Path.GetInvalidFileNameChars();

另外（在 Windows 上），“。” 不能是文件名中的唯一字符（“.”、“..”、“...”等均无效）。使用“.”命名文件时要小心，例如：

```
echo "test" > .test. 
```

将生成一个名为“.test”的文件

最后，如果你**真的**想正确地做事，你需要注意一些[特殊的文件名。](http://en.wikipedia.org/wiki/Filename#Reserved_characters_and_words)**在 Windows 上**，您不能创建名为：

```
CON, PRN, AUX, CLOCK$, NUL
COM0, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9
LPT0, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8, and LPT9. 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-11-10T16:16:56.887

这不是更有效，但更有趣:)

```
var fileName = "foo:bar";
var invalidChars = System.IO.Path.GetInvalidFileNameChars();
var cleanFileName = new string(fileName.Where(m => !invalidChars.Contains(m)).ToArray<char>()); 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-08-09T22:56:25.267

如果有人想要基于 的优化版本`StringBuilder`，请使用它。包括[rkagerer 的把戏](https://stackoverflow.com/a/25075667/185123)作为一个选项。

```
static char[] _invalids;

/// <summary>Replaces characters in <c>text</c> that are not allowed in 
/// file names with the specified replacement character.</summary>
/// <param name="text">Text to make into a valid filename. The same string is returned if it is valid already.</param>
/// <param name="replacement">Replacement character, or null to simply remove bad characters.</param>
/// <param name="fancy">Whether to replace quotes and slashes with the non-ASCII characters ” and ⁄.</param>
/// <returns>A string that can be used as a filename. If the output string would otherwise be empty, returns "_".</returns>
public static string MakeValidFileName(string text, char? replacement = '_', bool fancy = true)
{
    StringBuilder sb = new StringBuilder(text.Length);
    var invalids = _invalids ?? (_invalids = Path.GetInvalidFileNameChars());
    bool changed = false;
    for (int i = 0; i < text.Length; i++) {
        char c = text[i];
        if (invalids.Contains(c)) {
            changed = true;
            var repl = replacement ?? '\0';
            if (fancy) {
                if (c == '"')       repl = '”'; // U+201D right double quotation mark
                else if (c == '\'') repl = '’'; // U+2019 right single quotation mark
                else if (c == '/')  repl = '⁄'; // U+2044 fraction slash
            }
            if (repl != '\0')
                sb.Append(repl);
        } else
            sb.Append(c);
    }
    if (sb.Length == 0)
        return "_";
    return changed ? sb.ToString() : text;
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-12-10T17:48:55.593

`Linq`这是使用which uses接受的答案的一个版本[`Enumerable.Aggregate`](https://msdn.microsoft.com/en-us/library/bb549218(v=vs.110).aspx)：

```
string fileName = "something";

Path.GetInvalidFileNameChars()
    .Aggregate(fileName, (current, c) => current.Replace(c, '_')); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-08-01T08:09:10.697

迭戈的回答略有不同。

如果您不害怕 Unicode，则可以通过将无效字符替换为与其相似的有效 Unicode 符号来保持更高的保真度。这是我在最近一个涉及木材切割清单的项目中使用的代码：

```
static string MakeValidFilename(string text) {
  text = text.Replace('\'', '’'); // U+2019 right single quotation mark
  text = text.Replace('"',  '”'); // U+201D right double quotation mark
  text = text.Replace('/', '⁄');  // U+2044 fraction slash
  foreach (char c in System.IO.Path.GetInvalidFileNameChars()) {
    text = text.Replace(c, '_');
  }
  return text;
} 
```

这会产生文件名，`1⁄2” spruce.txt`而不是`1_2_ spruce.txt`

是的，它确实有效：

![资源管理器示例](https://i.stack.imgur.com/7ACIk.png)

**买者自负**

我知道这个技巧适用于 NTFS，但惊讶地发现它也适用于 FAT 和 FAT32 分区。这是因为[长文件名](http://en.wikipedia.org/wiki/Long_filename)存储[在 Unicode 中](http://blogs.msdn.com/b/oldnewthing/archive/2011/08/26/10200583.aspx)，甚至[可以追溯到](http://home.teleport.com/~brainy/lfn.htm)Windows 95/NT。我在 Win7、XP 甚至基于 Linux 的路由器上进行了测试，结果显示正常。不能在 DOSBox 内部说同样的话。

也就是说，在你发疯之前，考虑一下你是否真的需要额外的保真度。Unicode 相似可能会混淆人们或旧程序，例如依赖[代码页](https://stackoverflow.com/q/19503697/589059)的旧操作系统。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-09-09T07:49:16.607

Diego 确实有正确的解决方案，但其中存在一个非常小的错误。使用的string.Replace的版本应该是string.Replace(char, char)，没有string.Replace(char, string)

我无法编辑答案，否则我只会进行微小的更改。

所以应该是：

```
string fileName = "something";
foreach (char c in System.IO.Path.GetInvalidFileNameChars())
{
   fileName = fileName.Replace(c, '_');
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2020-03-12T06:19:33.117

一个简单的一行代码：

```
var validFileName = Path.GetInvalidFileNameChars().Aggregate(fileName, (f, c) => f.Replace(c, '_')); 
```

如果要重用它，可以将其包装在扩展方法中。

```
public static string ToValidFileName(this string fileName) => Path.GetInvalidFileNameChars().Aggregate(fileName, (f, c) => f.Replace(c, '_')); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-05-08T14:20:41.677

这是一个使用`StringBuilder`和`IndexOfAny`批量追加以提高效率的版本。它还返回原始字符串，而不是创建重复的字符串。

最后但并非最不重要的一点是，它有一个 switch 语句，它返回看起来相似的字符，您可以根据需要自定义任何方式。查看[Unicode.org 的 confusables 查找](http://unicode.org/cldr/utility/confusables.jsp)，看看你可能有哪些选项，具体取决于字体。

```
public static string GetSafeFilename(string arbitraryString)
{
    var invalidChars = System.IO.Path.GetInvalidFileNameChars();
    var replaceIndex = arbitraryString.IndexOfAny(invalidChars, 0);
    if (replaceIndex == -1) return arbitraryString;

    var r = new StringBuilder();
    var i = 0;

    do
    {
        r.Append(arbitraryString, i, replaceIndex - i);

        switch (arbitraryString[replaceIndex])
        {
            case '"':
                r.Append("''");
                break;
            case '<':
                r.Append('\u02c2'); // '˂' (modifier letter left arrowhead)
                break;
            case '>':
                r.Append('\u02c3'); // '˃' (modifier letter right arrowhead)
                break;
            case '|':
                r.Append('\u2223'); // '∣' (divides)
                break;
            case ':':
                r.Append('-');
                break;
            case '*':
                r.Append('\u2217'); // '∗' (asterisk operator)
                break;
            case '\\':
            case '/':
                r.Append('\u2044'); // '⁄' (fraction slash)
                break;
            case '\0':
            case '\f':
            case '?':
                break;
            case '\t':
            case '\n':
            case '\r':
            case '\v':
                r.Append(' ');
                break;
            default:
                r.Append('_');
                break;
        }

        i = replaceIndex + 1;
        replaceIndex = arbitraryString.IndexOfAny(invalidChars, i);
    } while (replaceIndex != -1);

    r.Append(arbitraryString, i, arbitraryString.Length - i);

    return r.ToString();
} 
```

它不检查`.`,`..`或保留名称之类的`CON`，因为不清楚替换应该是什么。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-04-05T19:11:32.183

另一个简单的解决方案：

```
private string MakeValidFileName(string original, char replacementChar = '_')
{
  var invalidChars = new HashSet<char>(Path.GetInvalidFileNameChars());
  return new string(original.Select(c => invalidChars.Contains(c) ? replacementChar : c).ToArray());
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-08-01T10:47:04.610

清理一些我的代码并进行一些重构......我为字符串类型创建了一个扩展：

```
public static string ToValidFileName(this string s, char replaceChar = '_', char[] includeChars = null)
{
  var invalid = Path.GetInvalidFileNameChars();
  if (includeChars != null) invalid = invalid.Union(includeChars).ToArray();
  return string.Join(string.Empty, s.ToCharArray().Select(o => o.In(invalid) ? replaceChar : o));
} 
```

现在它更容易使用：

```
var name = "Any string you want using ? / \ or even +.zip";
var validFileName = name.ToValidFileName(); 
```

如果您想用不同于“_”的字符替换，您可以使用：

```
var validFileName = name.ToValidFileName(replaceChar:'#'); 
```

你可以添加字符来替换..例如你不想要空格或逗号：

```
var validFileName = name.ToValidFileName(includeChars: new [] { ' ', ',' }); 
```

希望能帮助到你...

干杯

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-08-28T19:57:58.757

我需要一个不能产生冲突的系统，所以我不能将多个字符映射到一个字符。我最终得到：

```
public static class Extension
{
    /// <summary>
    /// Characters allowed in a file name. Note that curly braces don't show up here
    /// becausee they are used for escaping invalid characters.
    /// </summary>
    private static readonly HashSet<char> CleanFileNameChars = new HashSet<char>
    {
        ' ', '!', '#', '$', '%', '&', '\'', '(', ')', '+', ',', '-', '.',
        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '=', '@',
        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
        'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
        '[', ']', '^', '_', '`',
        'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm',
        'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
    };

    /// <summary>
    /// Creates a clean file name from one that may contain invalid characters in 
    /// a way that will not collide.
    /// </summary>
    /// <param name="dirtyFileName">
    /// The file name that may contain invalid filename characters.
    /// </param>
    /// <returns>
    /// A file name that does not contain invalid filename characters.
    /// </returns>
    /// <remarks>
    /// <para>
    /// Escapes invalid characters by converting their ASCII values to hexadecimal
    /// and wrapping that value in curly braces. Curly braces are escaped by doubling
    /// them, for example '{' => "{{".
    /// </para>
    /// <para>
    /// Note that although NTFS allows unicode characters in file names, this
    /// method does not.
    /// </para>
    /// </remarks>
    public static string CleanFileName(this string dirtyFileName)
    {
        string EscapeHexString(char c) =>
            "{" + (c > 255 ? $"{(uint)c:X4}" : $"{(uint)c:X2}") + "}";

        return string.Join(string.Empty,
                           dirtyFileName.Select(
                               c =>
                                   c == '{' ? "{{" :
                                   c == '}' ? "}}" :
                                   CleanFileNameChars.Contains(c) ? $"{c}" :
                                   EscapeHexString(c)));
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-08-01T10:25:34.493

我今天需要这样做……就我而言，我需要将客户名称与最终 .kmz 文件的日期和时间连接起来。我的最终解决方案是：

```
 string name = "Whatever name with valid/invalid chars";
 char[] invalid = System.IO.Path.GetInvalidFileNameChars();
 string validFileName = string.Join(string.Empty,
                            string.Format("{0}.{1:G}.kmz", name, DateTime.Now)
                            .ToCharArray().Select(o => o.In(invalid) ? '_' : o)); 
```

如果将空格字符添加到无效数组，您甚至可以使其替换空格。

也许它不是最快的，但由于性能不是问题，我发现它优雅且易于理解。

干杯!

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-09-23T15:30:51.390

该主题尚无有效答案。作者说：“......我想用作文件名......”。删除/替换无效字符不足以将某些内容用作文件名。您至少应该检查：

1.  您在要创建新文件夹的文件夹中还没有具有此类名称的文件
2.  文件的总路径（文件夹路径 + 文件名 + 扩展名）不超过 MAX_PATH（260 个符号）。是的，有一些技巧可以在最新的 Windows 上破解它，但如果你想让你的应用程序正常工作 - 你应该检查一下
3.  您不使用任何特殊文件名（请参阅@Phil Price 的回答）

可能最好的方法是：

1.  使用此处的其他答案之一删除坏字符。
2.  确保总路径少于 260 个字符（如果不是 - 删除最后 N 个字符）
3.  确保具有给定文件名的文件不存在（如果存在 - 替换最后 N 个字符，直到找到可用的文件名）
4.  确保您不使用任何保留的文件名（如果使用 - 替换最后 N 个字符，直到找到正确且可用的文件名）

与往常一样，事情变得更加复杂，然后看起来。最好使用一些已经存在的函数，比如[GetTempFileNameW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-gettempfilenamew)

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2010-12-11T01:00:52.837

您可以使用以下`sed`命令执行此操作：

```
 sed -e "
 s/[?()\[\]=+<>:;©®”,*|]/_/g
 s/"$'\t'"/ /g
 s/–/-/g
 s/\"/_/g
 s/[[:cntrl:]]/_/g" 
```

# java - 如何在 javadoc 编译期间抑制警告（代码库范围）？

> ID：620606
> 
> 赞同：12
> 
> 时间：2009-03-06T22:05:30.347
> 
> 标签：java, javadoc, suppress-warnings

我被一个遗留的 Java 代码库困住了，当你编译它时，它有成千上万的警告。我很想真正解决所有这些警告的来源，但不幸的是，目前在我的公司这不是一个选择（其他事情，比如“制造产生收入的新产品”被负责人认为是更高的优先级；想象一下） .

现在，我可以忍受所有这些警告，如果不是因为它们很难在我们的连续构建服务器的输出中找到实际错误。构建服务器只使用了一个 ant 调用，没什么特别的，但到目前为止，我还没有在任何地方找到任何关于如何修改这个调用以防止警告输出的东西。

浏览代码并在各处添加@SuppressWarnings 注释会起作用，但它也几乎与浏览并修复所有警告的来源一样痛苦。所以我真正喜欢的是，如果我能做一些事情：

```
<javadoc suppressWarrnings="true" 
```

或类似的东西，使 javadoc 编译器不输出所有警告消息。这样的事情（全局javadoc警告禁用）可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-03-26T17:24:25.473

在 Java 8 中，您可以添加`additionalparam="-Xdoclint:none"`到`javadoc`任务中。 [（来源）](http://blog.joda.org/2014/02/turning-off-doclint-in-jdk-8-javadoc.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T22:59:30.390

试试 -quiet 标志。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-06T23:26:24.240

ant 任务和 javadoc 工具本身都无法全局禁用警告。

我能想到的一种可能的解决方法是将 javadoc 任务作为与构建的其余部分分开的 ant 调用运行。您可以使用 ant 的 -logfile 参数将输出重定向到日志文件而不是控制台。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-06-27T20:07:58.737

如今，一些 javadoc 非标准选项允许您避免过多的错误和/或警告。查看javadoc的帮助（执行javadoc -X）；应提供以下非标准选项：

```
-Xmaxerrs <number>
-Xmaxwarns <number>              
-Xdoclint:(all|none|[-]<group>) 
```

`-Xmaxerrs`设置要打印的最大错误数 `-Xmaxwarns`设置要打印的最大警告数 `-Xdoclint`启用或禁用对 javadoc 注释中问题的特定检查。

例如，指定`-Xdoclint:none`将禁用对 javadoc 注释中大多数问题的特定检查；并将`-Xmaxwarns 1`警告的数量限制为 1（我试过了`-Xmaxwarns 0`，但是它打印了所有的警告，所以我的猜测是 0 意味着没有限制）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-10T15:58:44.860

Mark 的回答对我来说听起来不错，并且可能对不使用 Cruise Control 持续构建系统的任何人都有效。但是，我发现对于任何（像我一样）使用该系统的人来说，还有另一种方法。

Cruise control 通过使用多个 XSLT 样式表来组装它的报告。在我们的例子中，这些样式表位于：

```
~/applications/cruisecontrol-bin-2.7.3/webapps/cruisecontrol/xsl 
```

但由于我没有设置我们的安装，我不知道这是否是标准路径。无论如何，您应该能够在安装中找到等效目录。在该目录中是一个名为errors.xsl 的文件。要消除警告，您需要对该文件进行两项更改，这两项更改都涉及注释掉现有规则。

代替：

```
<xsl:variable name="total.errorMessage.count" select="count($warn.messages) + count($error.messages)"/> 
```

和：

```
<!--        <xsl:variable name="total.errorMessage.count" select="count($warn.messages) + count($error.messages)"/>-->
<xsl:variable name="total.errorMessage.count" select="count($error.messages)"/> 
```

这将使“错误计数”成为实际错误的计数，而不是错误+警告的​​计数。

然后，替换：

```
<xsl:template match="message[@priority='warn']" mode="errors">
    <xsl:if test="not(starts-with(text(),'cvs update'))">
        <xsl:value-of select="text()"/><br class="none"/>
    </xsl:if>
</xsl:template> 
```

和：

```
<!--<xsl:template match="message[@priority='warn']" mode="errors">
    <xsl:if test="not(starts-with(text(),'cvs update'))">
        <xsl:value-of select="text()"/><br class="none"/>
    </xsl:if>
</xsl:template>--> 
```

这将隐藏实际的警告本身。或者，您总是可以只删除注释掉的代码，但是您应该首先备份文件，以防您想要恢复您的警告。此外，XSLT 忽略任何非 XSLT 标记，因此除了完全消除警告之外，您还可以对警告执行其他操作：例如，您可以将所有警告包装在 DIV 中，然后使用 CSS/Javascript 来“折叠”警告而不是完全删除它们。

虽然我最终不得不自己发现这个解决方案，但这里的所有答案都帮助我理解了发生了什么，所以感谢大家的帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T22:16:06.717

我刚刚发现我在之前的回答中描述的内容有一个更好的变体。编辑 buildresults.xsl，而不是编辑 errors.xsl。该文件包含一条注释：

```
for traditional cc display of only compile errors and warnings
comment out mode="errors" and uncomment mode="compile" and mode="javadoc" 
```

如果您遵循该评论的建议（注释掉它提到的两行并取消注释它提到的一行），您将获得相同的确切效果，但包含编译错误。

为什么要用这种方法而不是我以前的方法呢？好吧，我认为（我真的应该更好地测试这个，但我很懒）我以前的方法会吃编译错误；这种方法可以保留它们。

# c++ - C++ 本地化最佳实践？

> ID：620609
> 
> 赞同：3
> 
> 时间：2009-03-06T22:06:53.400
> 
> 标签：c++, localization

我们正在本地化一个跨平台的基于 C++ 的客户端应用程序。第一次本地化通行证是在很短的期限内为一个大合作伙伴匆忙完成的，现在是重构它的时候了。

我们目前每个语言环境都有一个 XML 字符串文件，每个资源都有一个公共键和一个本地化值。但是，向我们的非必要技术本地化人员发送 xml 文件并不理想——他们不知道编码特殊字符等。我想使用一种简单、众所周知的格式，如 Excel/csv本地化程序（也很好，因为我们也有服务器端本地化，可以在同一文件的不同选项卡中），然后从那里代码生成字符串文件。Excel 似乎不喜欢输出 UTF-8 CSV 文件，这很烦人，并且阻止我将一些快速脚本放在一起来自动执行 Excel --> 字符串文件转换。

这个问题已经解决了数百次。人们发现哪些工作流程最好，尤其是对于本地化人员将在公司外部的情况？我正在寻找一些对非技术用户来说很容易的东西，而且对于开发团队来说也很容易，然后用它来生成像 XML 这样的简单格式的字符串文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T22:55:56.827

1.  使用 OpenOffice 代替 exel，它可以转储为 UTF-8 编码的 CSV。

2.  我们有带有通用 ID 的 .xls 文件，我们将其发送给翻译公司。然后使用 OpenOffice 将 .xls 转储到 CSV。我们有一个基于 CSV 文件生成包含本地化文件的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T05:31:19.387

Qt 有一个很好的[本地化](http://doc.trolltech.com/4.5/linguist-manual.html)工具。第一步是使用他们的字符串类QString。

接下来，您只需将任何字符串文字包装在 tr() 宏中。这种方法的好处是您不必浪费时间维护常量或定义。只需在您想要的位置键入您想要的字符串。

稍后，您使用 Qt 实用程序在所有代码单元中搜索可翻译字符串并创建一个 .ts 文件。该文件是 xml，因此您不必担心您的数据会被困在某种专有格式中。

现在您有了一个 .ts 文件，Qt 提供了一个名为 linguist 的翻译编辑器。这是一个非常好的程序，可以将字符串呈现给翻译（人），并提供一些简单的工具来管理整个过程。该程序查找常见错误（不同的标点符号），跟踪每个字符串的状态，例如是否已翻译，以及源字符串是否已更改或已删除。该程序还将显示开发人员可以包含在 tr() 宏中的每个字符串的上下文信息。

翻译完成后，.ts 文件被编译成较小的二进制文件，与应用程序一起分发并在运行时加载。翻译可以即时切换。

它的内容比我在这里能完全解释的要多。这确实是一个值得研究的伟大系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T23:02:50.770

这是一个有趣的话题。过去我以多种方式处理外包

有一次我们只是使用专有格式的简单文本文件。我们对每种语言都有不同的文件。格式是这样的：

```
 #LOCALIZATION_ID
 English String 
```

本地化人员对此没有任何问题。我使用的另一件事是自定义 xls 电子表格应用程序。基本上，该应用程序通过 Web 服务将其数据发布到服务器。不需要有 csv 等中间文件格式。这很好，因为所有字符串都是版本化的，并且允许多个外包在同一个字符串文件上工作。

您可能应该能够编写一些 vba 来获取您的 excel 电子表格并输出外包商可以通过电子邮件发送给您的 UTF-8 xml 文件。工作表顶部的一个大按钮，上面写着“发送 XML 文件”。它会将其发送到预定义的电子邮件地址，或将其发布到您的服务器。最坏的情况是他们可以将文件本身通过电子邮件发送给您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T23:17:45.027

我会警惕任何带有不明确字符编码的格式。考虑使用[XLIFF](http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=xliff)（不过请咨询您的翻译供应商，了解他们熟悉哪些工具/流程）。

*   [本地化中的 XML：实用分析](http://www.ibm.com/developerworks/xml/library/x-localis/)

# python - SQLAlchemy 在提交前使用自动增量获取主键

> ID：620610
> 
> 赞同：52
> 
> 时间：2009-03-06T22:07:19.983
> 
> 标签：python, sql, sqlalchemy

当我创建了一个具有自动递增主键的表时，有没有办法在不实际提交的情况下获取主键（即保留主键之类的操作）？

我想在事务中放置两个操作，但是其中一个操作将取决于在前一个操作中分配的主键。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-03-06T23:10:07.430

你不需要`commit`，你只需要`flush`。这是一些示例代码。在调用[flush](http://docs.sqlalchemy.org/en/latest/orm/session_api.html#sqlalchemy.orm.session.Session.flush)之后，您可以访问分配的主键。请注意，这是使用 SQLAlchemy v1.3.6 和 Python 3.7.4。

```
from sqlalchemy import *
import sqlalchemy.ext.declarative

Base = sqlalchemy.ext.declarative.declarative_base()

class User(Base):
    __tablename__ = 'user'
    user_id = Column('user_id', Integer, primary_key=True)
    name = Column('name', String)

if __name__ == '__main__':
    import unittest
    from sqlalchemy.orm import *
    import datetime

    class Blah(unittest.TestCase):
        def setUp(self):
            self.engine = create_engine('sqlite:///:memory:', echo=True)
            self.sessionmaker = scoped_session(sessionmaker(bind=self.engine))
            Base.metadata.bind = self.engine
            Base.metadata.create_all()
            self.now = datetime.datetime.now()

        def test_pkid(self):
            user = User(name="Joe")
            session = self.sessionmaker()
            session.add(user)
            session.flush()
            print('user_id', user.user_id)
            session.commit()
            session.close()

    unittest.main() 
```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-03-06T22:57:00.253

您可以使用多个事务并在范围内对其进行管理。

# asp.net - 带有子页面的 ASP.NET 中的自定义授权

> ID：620613
> 
> 赞同：0
> 
> 时间：2009-03-06T22:08:08.860
> 
> 标签：asp.net, authentication, master-pages, master

我正在做一种自定义身份验证方法，它使用轻会话对象来保存用户的授权详细信息。现在我希望每个页面（主要是母版的子页面）能够判断用户是否应该有权访问该页面。

我应该创建一个页面类并从中派生子页面吗？

应用程序知道哪些角色可以访问哪个页面的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:35:20.727

我不喜欢基页方法。对我来说，检查安全的东西为时已晚。您可以创建自己的 HttpModule 来检查这一点，或者将授权信息存储在数据库/xml/...中，或者使用页面上的反射读取它。

context.Handler 将保存您正在执行的类 Page。因此，您可以执行以下操作：

我复制了我使用的部分代码，它检查角色、公共页面，跳过检查图像和脚本（但你也可以这样做）：

```
 // In the HttpModule:
    public void context_PreRequestHandlerExecute(object sender, EventArgs e)
    {
        HttpContext context = HttpContext.Current;

        // Don´t validate permissions if the user wasn´t allowed by the asp.net security
        // Neighter the advanced (custom) permissions are validated for non ASPX files.
        if (!context.Request.FilePath.EndsWith(".aspx") || !context.User.Identity.IsAuthenticated)
            return;

        // Give full access to the unathorized error page, and logins, and so on...
        string pageClass = context.Handler.GetType().BaseType.FullName;

        string param = context.Request["p"];
        if (!string.IsNullOrEmpty(param))
            pageClass += "@" + param;

        if (SecurityService.IsFullTrustClass(pageClass))
            return;

        if (SecurityService.Context.CurrentPerson == null)
        {
            LogOff();
            return;
        }

        // Verify access permissions for the current page
        IList<Role> roles = SecurityService.Context.CurrentPerson.Roles;
        bool allow = SecurityService.HasAccessPermission(pageClass, roles);

        if (!allow)
        {
            LogOff();
        }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T22:12:42.250

如果您在授权方面需要更大的灵活性，您最好使用自定义页面类。否则，`Web.config`应该够了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:13:58.283

如果您使用自定义角色提供程序插入它，您实际上可以依赖 asp.net 配置。有一种方法可以让您检查用户是否有权访问给定页面：

```
System.Web.Security.UrlAuthorizationModule.CheckUrlAccessForPrincipal(
     "~/admin/test.aspx", principal, "GET"
); 
```

然后，您可以在 web.config 上使用常规方法来配置授权。这样做时，如果页面位于同一文件夹中，您只需将 web.config 添加到该文件夹​​并适当地配置授权即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T22:23:06.937

在相同的场景中，我将需要身份验证的页面放在一个文件夹中，并在 web.config 中定义 location 元素来配置身份验证，如下所示：

```
<location path="protected">
     <system.web>
        <authorization>
          <deny users="?"/>
        </authorization>
    </system.web>
</location> 
```

# sql-server - SQL Server 中的 PAGEIOLATCH_SH 等待类型是什么？

> ID：620626
> 
> 赞同：104
> 
> 时间：2009-03-06T22:10:21.507
> 
> 标签：sql-server, tsql, optimization

我有一个查询在交易过程中需要很长时间。当我得到这个`wait_type`过程时，它是`PAGEIOLATCH_SH`.

这种等待类型是什么意思，如何解决？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-03-06T22:18:26.900

来自[**微软文档**](https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql)：

> `PAGEIOLATCH_SH`
> 
> 当任务正在等待`I/O`请求中的缓冲区的闩锁时发生。锁存请求处于共享模式。长时间等待可能表明磁盘子系统存在问题。

实际上，这几乎总是由于对大表的大扫描而发生。在有效使用索引的查询中几乎不会发生这种情况。

如果您的查询是这样的：

```
Select * from <table> where <col1> = <value> order by <PrimaryKey> 
```

，检查您是否有一个复合索引`(col1, col_primary_key)`。

如果您没有，那么如果选择了则您将需要一个完整`INDEX SCAN`的`PRIMARY KEY`，或者`SORT`如果选择了一个索引，则您将需要一个完整的`col1`。

它们都是`I/O`大型表上非常消耗磁盘的操作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2017-11-10T16:07:46.707

`PAGEIOLATCH_SH`等待类型通常作为碎片或未优化索引的结果出现。

`PAGEIOLATCH_SH`过度等待类型的原因通常是：

*   I/O 子系统有问题或配置错误
*   产生高 I/O 活动的其他进程使 I/O 子系统过载
*   不良索引管理
*   逻辑或物理驱动器误解
*   网络问题/延迟
*   内存压力
*   同步镜像和 AlwaysOn AG

为了尝试解决高`PAGEIOLATCH_SH`等待类型，您可以检查：

*   SQL Server，查询和索引，通常这可以作为过度`PAGEIOLATCH_SH`等待类型的根本原因
*   跳入任何 I/O 子系统故障排除之前的内存压力

请始终牢记，在 AlwaysOn AG 中的高安全性镜像或同步提交可用性的情况下，`PAGEIOLATCH_SH`可能会增加/过度。

[您可以在处理过多的 SQL Server PAGEIOLATCH_SH 等待类型](https://www.sqlshack.com/handling-excessive-sql-server-pageiolatch_sh-wait-types/)一文中找到有关此主题的更多详细信息

# cocos2d-iphone - 我们如何使用 cocos2d 捕捉左右移动？

> ID：620644
> 
> 赞同：0
> 
> 时间：2009-03-06T22:15:09.870
> 
> 标签：cocos2d-iphone

[我们如何使用cocos2d](http://cocos2d.org/)捕获左移、右移和上移事件？

我正在带一个精灵（汽车），如果我向左移动，它应该在屏幕上向左移动，如果向右移动，它应该向右移动。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T00:45:11.730

Cocos2d 使用称为 ccTouchesBegan、ccTouchesEnded 等的自定义回调...基本上与您在常规 UIView 中用于检测触摸或加速度计变化的回调相同，但在 Cocos2d 中附加了字母“cc”——这允许事件传播到发生。

您必须返回 kEventHandled 或 kEventIgnored - 这些事件仅传递到 Cocos2d 层。如果场景中有多个图层，则每个图层都将接收事件（以相反的顺序将它们添加到场景中，而不是它们的 z 顺序）。如果您返回 kEventHandled，则事件将被丢弃并且不会进一步向下传递，否则事件会进一步向下传递到下一层，直到返回 kEventHandled，或者所有层都有机会处理该事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-05T04:50:25.323

There are a few ways to implement movement in an iPhone app.

1.  You can use the accelerometer (tilt the device around various axis.
2.  Tap and drag. You can monitor the direction of a drag and move your sprite accordingly.
3.  You can use a simple tap mechanism where tapping on the left side of the screen moves the unit left, and tapping on the right moves the unit right.

Hope this gives you some ideas.

# php - 存储用户 ID 列表的最佳方法

> ID：620645
> 
> 赞同：4
> 
> 时间：2009-03-06T22:15:20.590
> 
> 标签：php, mysql, performance

我现在正在研究 PHP/MySQL 评级系统。为了让用户能够对用户进行评分，用户必须登录。每个用户都有一个唯一的“UID”。网站上将有多个评级实例（在我的情况下，每个游戏一个），我需要一种有效的方法将 UID 列表存储在 MySQL 行中（评级表中的一个 MySQL 行用于评级系统的每个实例) 记录谁投票。

我在其他系统中看到该列表存储在序列化的 PHP 数组中。每次用户投票时，都必须提取序列化数组，反序列化，插入新的 UID，重新序列化数组，并更新 MySQL 行。每次加载页面时，该列表必须再次反序列化并检查查看页面的用户是否已经投票，以确保用户没有投票两次。

这似乎有点低效和麻烦。MySQL 是否有一个内置的列表函数来帮助这个过程更有效率？有没有更聪明的方法可以解决这个问题？

我考虑过一种可能的替代方法，即忘记序列化并将 UID 存储在 MySQL 数据库的 TEXT 类型字段中。我只会在每个 UID 之后附加一些非数字字符（比如说句点 [.]）。要添加用户条目，我只需将 UID 连接到 TEXT 字段的末尾，然后是句点。在检查用户是否已经投票时，我可以只选择“SELECT * FROM table WHERE votes = '%$UID.%';”。这会更有效地工作还是有更优雅的方式来完成工作？

**关于表结构的后续帖子...[评级系统的高效 MySQL 表结构](https://stackoverflow.com/questions/621065/efficient-mysql-table-structure-for-rating-system)**

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-06T22:18:58.350

这是低效的。您在这里所拥有的关系术语是用户和游戏之间的多对多关系。一个用户可以对许多游戏进行投票。一个游戏可以被许多用户投票。解决方案是有一个连接表：

```
USERS (uid, name, ...)
GAMES (gid, name, ...)
VOTES (id, uid, gid, ...) 
```

其中 uid 和 gid 是返回各自表的外键。

如果有人投票，请在 VOTES 中插入一条记录。

要获得游戏的投票列表：

```
$get = mysql_query("SELECT * FROM votes WHERE gid = $game_id");
... 
```

获取用户投票列表：

```
$get = mysql_query("SELECT * FROM votes WHERE uid = $user_id");
... 
```

等等。

不要加入数组并将其存储在单个列中。避免这种情况是对的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T22:18:48.210

在规范化数据库中，您应该将其存储在联结表中：

```
UserRatings
-------------
RatingID int
UserID int
UserVote int 
```

我不知道你有什么疑问。根据应用程序，这可能没有可接受的性能。但是，无论哪种情况，我都建议您使用规范化方法、基准测试，并仅在适当时进行非规范化。

# ruby-on-rails - 如何在 Rails 中建模和创建自定义卡片组？

> ID：620646
> 
> 赞同：2
> 
> 时间：2009-03-06T22:15:47.687
> 
> 标签：ruby-on-rails

我正在尝试为纸牌游戏建模以学习 Rails。这与一副标准的扑克牌不同，因为一副牌中可以有多个副本。我在尝试初始化卡组时遇到了问题。到目前为止，我已经有了一个基本的卡片模型，它具有各种属性（例如copys_in_deck）但没有关联。一个 DeckCard 模型，它代表一副牌中的牌（这是由于牌组中有多个同一张牌）：

```
class DeckCard < ActiveRecord::Base
  belongs_to :card
  belongs_to :deck
end 
```

这些 DeckCard 最终将具有反映位置的属性；例如在弃牌堆中，在抽牌堆中等。

甲板模型

```
belongs_to :game
has_many :deck_cards 
```

我正在尝试初始化卡片组并且遇到了各种问题。我正在甲板上尝试以下内容

```
def initialize
  @cards = Card.find(:all)
  @cards.each do |card|
    # eventually another loop here on copies_in_deck
      @deck_cards.build(card)
  end
end 
```

当我这样做时，`Deck.new`我在 nil.build 上得到一个错误。为什么@deck_cards 为零？

我正在使用具有 rails 2.0.2 的 InstantRails2。我发现[这篇](http://zargony.com/2007/09/17/vanishing-records-on-creating-multiple-models-in-one-action/ "这个链接")关于在一个操作中创建多个模型的文章，所以我尝试使用 Deck.create！相反，并收到有关错误数量的参数的错误。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:32:51.593

```
class Deck < ActiveRecord::Base
  belongs_to :game
  has_many :deck_cards

  # To create new: Deck.new.build_deck
  def build_deck
    Card.find(:all).each do |card|
      self.deck_cards << DeckCard.new(:card => card)
    end
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:26:59.360

ActiveRecord 的子类不应定义初始化方法，因为 ActiveRecord 会为您处理这些。

听起来你想要每张卡一张记录。Model DeckCard 一次可以容纳多张卡片。

回复：为什么@deck_cards 为零？因为你没有在任何地方设置它。

@deck_cards 是一个实例变量。您正在尝试对其调用 build 方法，但您尚未将其设置为任何内容。您应该在 DeckCard 类上调用 build（或 create 或 new 方法）。

如果要在 DeckCard 模型中创建并保存卡片：
DeckCard.create(card) # not @deck_cards.build(card)

拉里

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:31:53.653

不要对从 ActiveRecord::Base 继承的对象使用#initialize。它会破坏各种内部 Rails 魔法。相反，请使用此处记录的#after_initialize 回调：http: [//api.rubyonrails.org/classes/ActiveRecord/Callbacks.html](http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html)

请注意，after_initialize 在查找后以及在新创建的对象上调用，因此您需要包装初始化代码以确保该对象以前没有保存（使用#new_record？）：

```
def after_initialize
  if new_record?
    # initialize deck_cards here.
  end
end 
```

过去，我采用了这种替代方法，但语法更好，但请注意，在您尝试保存或验证记录之前，它不会启动。

```
before_validation :build_default_associations, :if => :new_record?

def build_default_associations
  # initialize default associations here.
end 
```

# git - 我可以同时从远程分支轻松更新所有本地 git 分支吗？

> ID：620650
> 
> 赞同：21
> 
> 时间：2009-03-06T22:16:46.077
> 
> 标签：git, version-control, branch

我有一个带有（目前）三个分支的 git 存储库：

*   `head`是稳定版本（不要与 git 混淆`HEAD`）
*   `experimental`是实验代码；它应该编译
*   `norman`是我的沙盒；其中的代码可能已损坏

“master” git repo 位于已备份的文件服务器上。但我在本地磁盘、家里的机器和笔记本电脑上都有副本。（我准备随时随地编写代码）。

`git branch -a`显示：

```
 experimental
  head
* norman
  tufts/HEAD
  tufts/experimental
  tufts/head
  tufts/norman 
```

Tufts 分支是“主”存储库上的远程分支。当地分支机构应该跟踪；`git config -l | grep -w remote`说：

```
remote.tufts.url=linux.cs.tufts.edu:/r/ghc/git/experimental.git
remote.tufts.fetch=+refs/heads/*:refs/remotes/tufts/*
branch.experimental.remote=tufts
branch.head.remote=tufts
branch.norman.remote=tufts 
```

这是我的问题：**如何**使用单个 git 命令同时从远程分支更新所有本地分支？ `git-fetch`不太行；它更新它对每个远程分支的内容的了解，但它不会将它们合并到本地。显然`git-pull`只更新当前签出的分支。我想一次更新所有分支。可以做到吗？

（我并不疯狂

```
for i in `git branch | sed 's/^.//'`; do git checkout $i ; git pull; done 
```

部分原因是在我的工作目录中修改后的文件在这一切进行时会发生什么对我来说并不明显，部分原因是我需要更多的 shell 代码来保存和恢复有关我当前所在分支的信息。）

我发现了一个（不是很密切相关的）问题：

*   关于[跟踪远程分支](https://stackoverflow.com/questions/415433/sometimes-git-will-track-all-remote-git-branches-as-local-branches-without-me-ask/415542)

# apache-flex - 在数据更改 (AS3) 后刷新 AdvancedDataGrid 中的数据？

> ID：620653
> 
> 赞同：0
> 
> 时间：2009-03-06T22:18:26.587
> 
> 标签：apache-flex, actionscript-3, advanceddatagrid

我正在使用`AdvancedDataGrid`控件。我以分层格式显示数据，因为我有一个父母和两个孩子。在父级中，我有一个复选框，当我选中该复选框时，我必须删除子级的现有数据并替换为新数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-07-08T07:54:10.933

[我假设这个问题是针对 AS3 的]

遇到类似的问题，要刷新advancedDataGrid，在你操作完源数据后才运行

> AdvanceDataGrid.invalidateList();

然后它将在下一帧刷新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-02T21:17:05.803

要在显示分层数据时刷新数据，只需刷新高级数据网格中的组列表。

API 不一致，这使许多人感到困惑。

groupList.refresh();

```
<mx:dataProvider>
   <mx:GroupingCollection id="groupList" source="{OrderDB.flatData}" >
     <mx:Grouping>
        <mx:GroupingField name="benchmark" >
         <mx:summaries> 
```

# iphone - Receiver 'ClassName' 是一个转发类，对应的@interface 可能不存在

> ID：620661
> 
> 赞同：13
> 
> 时间：2009-03-06T22:20:01.780
> 
> 标签：iphone, objective-c

我目前正试图`UIPickerTable`在 UIPickerView.subviews 中找到一个 ...所以我循环并执行`isKindOfClass:[UIPickerTable class]`.... 这可行.. 但因为 UIPickerTable 的标题没有暴露，我收到一个警告，“接收器 'UIPickerTable' 是转发类和对应的@interface 可能不存在'

为了能够编译，我做了@class UIPickerTable，显然它想让我#include它。

我想知道是否有办法绕过看到这个警告。

蒂亚！

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2010-04-04T14:31:39.667

也许您`@class UIPickerTable`的 .h 文件中有，而`#import UIPickerTable.h`{RootViewController}.m 文件中没有

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T02:17:21.613

我认为您不能使用编译器选项来抑制该警告。您可以通过简单地为该类创建自己的头文件来使其消失，其中包含：

```
@interface FacesViewController : NSObject {
} 
```

我想不言而喻，让您的应用程序依赖于 UIKit 类的内部结构可能不是最好的策略。想必你有充分的理由在 UIPicker 内部捣乱......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-04T07:25:54.793

导入类与使用 @class 指令将解决此警告。请记住，@class 不会告诉编译器“签名”方法/类有什么，而只是说该类存在，所以不要出错。详细介绍时，请改用 import "..." ，以便它包含类的标头/接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T03:55:58.523

在 iPhone 应用程序中使用私有 API 会被 AppStore 拒绝（Google 的接近感应功能无法承受）。除非您打算只自己使用该软件，否则不要使用私有 API。如果不求助于私有 API 就无法做你想做的事，请在 Apple 的[雷达](http://bugreport.apple.com)上提交一个错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-01T17:47:39.723

我可能完全错过了这里的重点，但我遇到了与 AddressBook 类似的东西。我已经像这样包含了 AddressBook 框架

```
#import <AddressBook/ABAddressBook.h> 
```

但是当我想检查 peoplePickerView 中所选记录的类时..

```
NSArray *selected = [peoplePickerView selectedRecords];
for(id record in selected)
{
if([record isKindOfClass:[ABPerson class]])
{
    return [record valueForKey:@"identityUniqueId"];
}

} 
```

...我收到警告说“接收器'ABPerson'是一个转发类，相应的@interface 可能不存在”。然而，这证明通过调整头文件很容易解决：

```
#import <AddressBook/ABAddressBook.h>
#import <AddressBook/ABPerson.h>
@class ABPerson; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-04T10:35:51.813

当有时未导入正确的标头时，会发生这种情况。例如，当尝试设置 NSManagedObjectContext 时，您可能会通过不导入来获得它`#import <CoreData/CoreData.h>`

# asp.net - AjaxControlToolkit 的“正确”标签前缀是什么？

> ID：620665
> 
> 赞同：2
> 
> 时间：2009-03-06T22:20:56.677
> 
> 标签：asp.net, asp.net-ajax, naming-conventions

我见过很多他们只使用“asp”前缀的例子。这是一个好习惯吗？

（我问的原因是因为为新网站创建默认值的模板似乎有问题。在 BulletedList 控件上存在明显的命名冲突。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:24:46.010

我认为没有“最佳实践”。我通常使用公司名称作为控制集。对于 MS Ajax 和 AjaxToolKit，我使用“ajax”作为前缀，因为它短且与“asp”不同。

对于我在工作场所开发的控件，我使用“esi”，因为这是缩写。这是唯一的一个原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T22:33:25.087

我喜欢前缀**act**。

我绝对建议不要使用**asp**作为除基本 ASP.NET WebControls 之外的任何东西的前缀。

# asp.net-mvc - 将网站 URL 传递到 ASP.NET MVC 中的路由中

> ID：620669
> 
> 赞同：2
> 
> 时间：2009-03-06T22:21:14.677
> 
> 标签：asp.net-mvc, routing, routes, url-routing

我正在开发一个需要获取实际 URL 并在路由本身中使用它的项目。我所看到、阅读和测试的所有内容都允许路由在站点 URL 之后获取项目。这是我尝试过的，每次它只是说网站是空白的（这可能是因为默认的空白）。你能告诉我任何关于允许路由也使用根 URL 的问题吗？目标是一个网站，它会处理 URL 并在视图内部将我路由到不同的胆量。

这是我尝试过的代码，但在本地主机之外没有运气

```
 routes.MapRoute(
            "PageRouter",
            "{site}/{*url}",
            new { controller = "PageRouter", action = "RoutePage", site = "", url = "" }
        ); 
```

非常感谢您的帮助。提前致谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T07:33:42.663

在控制器的操作中使用 HttpContext.Request.RawUrl 怎么样。我可能在这里遗漏了一些东西。您要阅读的网址来自哪里？是当前页面还是其他页面？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T22:16:52.877

内森的答案是答案的一部分。HttpContext.Request.RawUrl 允许访问此信息，但在 Global.asax.cs 文件中。这在 Application_BeginRequest 事件中完成。但是诀窍（如果有人知道更优雅的方法，请发表评论）但是我们将正在使用的 Url 注入到剩余的路由路径中，以便可以在 MapRoute 方法中获取它。因此，“ [http://subdomain.domain.net/url](http://subdomain.domain.net/url) ”站点将显示为“ [http://subdomain.domain.net/subdomain.domain.net/url ”](http://subdomain.domain.net/subdomain.domain.net/url)因此可以在 MapRoute 命令的 {site} 部分中获取它。这不会显示给用户，但允许我们根据收到的 URL 在应用程序内做出决定。这听起来合理吗？如果这似乎是一种疯狂的方式来吸收根 URL，则欢迎发表评论。

# svn - 如何在我的代码中获得更新的 $Revision$

> ID：620671
> 
> 赞同：2
> 
> 时间：2009-03-06T22:21:23.150
> 
> 标签：svn, keyword-substitution

我有一个项目，我想自动将修订号嵌入其中。

在这种情况下，它是一个多文件 perl 脚本。在主文件中，我有一行如下所示：

我的 $revision = '$Revision: 24 $';

当我发布时，我将项目签出到我的发布目录。

每当我签入对该文件的更改时，修订号确实会更改。$Revision$ 属性在签入时更新，但不在签出时更新。

问题是，主文件不会经常更改，所以即使项目中的其他文件现在是 27，主文件仍然有 24。

有没有办法让主文件反映最新的转速？svn 在结帐结束时打印出来的那个，即“Checked out revision 27”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:36:30.367

它类似于 CVS，您可以使用 $Revision$，您只需为该文件设置关键字属性，以便 SVN 知道它应该进行关键字替换。

从手册：

“在该文件上没有设置 svn:keywords 属性，Subversion 不会做任何特别的事情。现在，让我们启用 LastChangedDate 关键字的替换。$ svn propset svn:keywords "Date Author" weather.txt property 'svn:keywords' set on '天气.txt' $ "

[http://svnbook.red-bean.com/en/1.5/svn-book.pdf](http://svnbook.red-bean.com/en/1.5/svn-book.pdf)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:34:41.480

```
if (! -e '.version')
{
    open VERSION, '>.version';
    print VERSION `svnversion -n | cut -f1 -d:`;
    close VERSION;
}

my $revision = '$Revision: ' . `cat .version` . ' $'; 
```

（**注意：**如果您按原样使用此代码，小狗会死）

# apache-flex - Degrafa：在 ActionScript 中添加 RasterImage

> ID：620680
> 
> 赞同：0
> 
> 时间：2009-03-06T22:24:04.750
> 
> 标签：apache-flex, actionscript-3, degrafa

我正在尝试在运行时将 RasterImage 组件添加到 Surface 。我的代码运行如下：

```
var ri:RasterImage = new RasterImage();
ri.loadingLocation = new LoadingLocation('http://resources.mydomain.com/','crossdomain.xml');
ri.source = 'http://resources. mydomain.com/some.jpg'
this.myGeometryGroup.geometryCollection.addItem(ri); 
```

LoadingLocation 和源路径都适用于同一文档中声明的 RasterImage 的 mxml，但尝试在 AS 中创建它不起作用。我已经尝试了所有我能想到的变体，包括对 LoadingLocation 使用 null、对源代码使用嵌入式类等。

使用外部资源时，应用程序会占用。对于嵌入式资源，什么都没有显示。任何帮助，将不胜感激-

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T14:58:07.980

没关系 - 这是框架中的一个错误。Degrafa 团队听说了它并在不到一个小时内发布了修复（！）

# wcf - 使用 WCF (.NET) 进行进程内通信设计

> ID：620683
> 
> 赞同：6
> 
> 时间：2009-03-06T22:24:50.817
> 
> 标签：wcf, garbage-collection, reference, communication

我有一个有趣的设计问题，希望大家能提出一些建议。我正在使用 C# 和 .NET 3.0

我有一个非常好的、可扩展的框架，它构建在 WCF 之上，可以自动设置端点和创建合同。我正在使用的系统可以以不同的方式运行——端点可以在互联网上的其他地方，在同一个盒子上的不同程序集中运行，甚至在同一个进程中运行。WCF 非常适合使所有这些透明化，但在最后一种情况下，我想提高效率：

我很想避免序列化并没有真正去任何地方的对象的开销。在同一个程序集中的两个线程之间进行通信确实没有意义。同时，我想利用已经存在的基于 WCF 的框架，因为如果我们没有两个独立的通信路径，这将更容易维护，具体取决于系统的设置。

我的第一个想法是在不安全的上下文中使用对象指针——不与序列化作斗争，而只序列化最小数量。我对此的担忧是，在 GC 具有攻击性的环境中的异步消息上，在我们有机会取消引用其中包含的指针之前，该消息可能并且很可能会消失，这将导致很多问题。

我的下一个想法是使用 GCHandles，但我不确定它们的行为 - 如果 GCHandle 不再被引用，但包含对托管对象的引用，是否都被 GC 清理了，或者两者都没有？我担心使用这些会引入巨大的内存泄漏，因为消息丢失的可能性很大，我们将无法调用 Free()，而且我能找到的文档是......缺少.

另一个想法是使用反射来查看所有托管对象，但这样做的开销似乎很大，而且这个系统必须尽可能高效。

因此，总而言之，我正在尝试使用 WCF 跨进程发送一个对象而不对其进行序列化，据我所知，这意味着即使它暂时没有引用也保持它的活动状态。看起来应该是可能的，但我想知道我是否也想吃蛋糕。

非常感谢您的意见！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T09:49:48.960

查看本文中的空传输绑定。

[http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx](http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-07T08:47:51.800

我将研究 WCF 中的“NetNamedPipes”传输协议，该协议专为同一机器、进程间通信而设计，并且具有尽可能少的开销（包括快速二进制序列化）。

马克

# c# - 如何将控件移动到页面中动态添加的用户控件中？

> ID：620684
> 
> 赞同：2
> 
> 时间：2009-03-06T22:25:51.470
> 
> 标签：c#, asp.net, dynamic-usercontrols

我有一个在 CreateChildControls 方法上动态移动一些 web 控件的用户控件。当将此控件用于以下页面时：

```
<myControls:MyUserControl runat="server" ID="myUserControl" /> 
```

它完美无缺。

但是，如果我想将该 userControl 动态添加到如下页面中：

```
<asp:UpdatePanel runat="server">
    <ContentTemplate>
        <asp:PlaceHolder runat="server" ID="plhControls" />
    </ContentTemplate>
</asp:UpdatePanel>
<asp:Button runat="server" ID="btnAdd" OnClick="btnAdd_Click" /> 
```

。CS

```
protected void btnAdd_Click(object sender, EventArgs e)
{
    MyUserControl myUserControl =(MyUserControl)LoadControl("~/Controls/MyUserControl.ascx");
    myUserControl.ID = "test";
    plhControls.Controls.Add(myUserControl );
} 
```

它在我的 CreateChildControls 中崩溃并出现错误：在 DataBind、Init、Load、PreRender 或 Unload 阶段无法修改控件集合。

确切的做法是当我将 webControls 添加到我的 UserControl 内的占位符时：

```
plhContent.Controls.Add(myWebControl); 
```

所以我不明白为什么在这种情况下，当我动态添加我的 UserControl 时，我无法在 CreateChildControls 事件中移动 Web 控件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T18:39:28.773

由于 LoadControl 将加载控件的每个事件都赶上当前事件，因此不可能与父控件同时运行 CreateChildControls，因为此时事件已经发生。

在我的情况下，我无法动态添加我的 UserControl，所以我做了相反的事情来重现我想要的相同行为。我初始化了所有控件，并删除了那些我不想要 OnClick 的控件。这会增加不必要的加载时间，但在我使用它的场景中是可以接受的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T01:03:08.393

就“页面生命周期”而言，必须初始化控件并使其与其余控件一起加速。查看 Page.LoadControl 方法，看看是否可以更早地创建您的控件。

我们有时使用的方法涉及使用页面中的回发参数。不要忘记您需要在每次回发时将控件重新添加到表单中，因为它不会为您创建

# .net - 以非管理员身份在 VS 中调试

> ID：620688
> 
> 赞同：1
> 
> 时间：2009-03-06T22:27:04.087
> 
> 标签：.net, debugging, code-access-security, non-admin

我正在做一些 WinForms 开发，运行 XP 和 VS 2005（我知道很古老）。我想确保我的应用程序可以在没有管理员权限的情况下运行，但是我懒得尝试以非管理员身份运行 VS，而且我不想登录和退出来测试我的应用程序。

有没有一种方法可以让我以非管理员身份进行调试？

是否有一组代码访问安全属性可以添加到我的代码中，以强制我以与非管理员相同的权限集运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:32:51.560

从您当前登录的桌面会话中以另一个用户身份运行 VS。请参阅[在 Windows 中运行程序时如何启用和使用“运行方式”命令](http://support.microsoft.com/kb/294676)。这意味着您不必登录和退出。

我建议您通过 RunAs 以另一个用户身份运行您的目标应用程序，然后通过 Visual Studio 中的 Debug > Attach To Process... 菜单项将 VS 调试器附加到进程（如果需要）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T20:39:35.317

基于 Phil 的回答，您可以通过将启动项目设置为：

启动外部程序：`c:\windows\system32\runas.exe`

使用命令行参数：`/noprofile /user:{MachineName}\{UserName} {ApplicationName}.exe`

不幸的是，我认为没有一种自动方法可以将进程附加到 VS 调试器（因为有安全警告），而是有条件地调用

```
#if (DEBUG) 
    System.Diagnostics.Debugger.Launch();
#endif 
```

系统将提示您单击两次以附加到调试器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-11T19:39:17.110

用更根本的变化来解决这个问题：

如果您让您的计算机允许并发远程桌面会话（[Vista](http://www.missingremote.com/index.php?option=com_content&task=view&id=1220&Itemid=224)、[XP](http://www.mydigitallife.info/2008/06/13/enable-multiple-concurrent-remote-desktop-connections-or-sessions-in-windows-xp/)，其他人使用 Google），然后启动到 127.0.0.2 的远程桌面会话，您可以在本地系统上以完全不同的用户身份运行，使您能够无需在用户之间切换即可满足您的任何需求。

对我来说，我通常以非管理用户身份运行，但每当我需要运行管理任务时，我都会以管理员身份启动远程桌面会话。但是，您也可以轻松地反其道而行之。

# c# - 关于拳击的问题

> ID：620692
> 
> 赞同：1
> 
> 时间：2009-03-06T22:27:51.883
> 
> 标签：c#, boxing

我知道拳击是一个流行的概念，有很多可用的信息，但我有几个问题我无法真正找到答案：

1）如果装箱导致值类型（结构）被转换为对象（引用类型）或引用类型，那么为什么要使用将被装箱并导致性能损失的值类型？我知道结构或类在某些情况下的好处和适用性。据说 (1) 值（值类型）倾向于在堆栈中的一个临时存储空间中存在，但要多长时间？如果我不需要该类型，我如何确保它在那个时候得到照顾和处置？或者这就是一次性模式发挥作用的地方？我认为使用结构的原因将是由于它的好处。

有趣的是，如果我使用一个结构来存储两个字符串和一个 DateTime 字段，那么该结构将同时保存两个引用（字符串）和 DateTime。我显然认为这比分散的值要快。在这个设计中有什么我需要注意的吗？(2)。

1) [http://en.csharp-online.net/Classes, Structs, and Objects——装箱和拆箱](http://en.csharp-online.net/Classes,_Structs,_and_Objects%E2%80%94Boxing_and_Unboxing)

2) [http://dotnetperls.com/Content/Struct-Examples.aspx](http://dotnetperls.com/Content/Struct-Examples.aspx)

我在这里搜索了我想要的答案，但没有运气。我通常在这个站点上搜索诸如 GC、泛型、异常处理等主题，因为有很多智慧可以学习和分享。

感谢所有海报的（潜在）教育！请原谅任何潜在的天真。学习内部结构让我很好地花一些时间来理解 IL 等（很快要解决的问题）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T22:36:50.537

如果您从不将值类型传递给引用变量，则不会发生装箱。当您不知道时，请回答以下[问题](http://msdn.microsoft.com/en-us/library/y23b5415(vs.71).aspx)：

*   像原始类型一样工作。
*   实例大小小于 16 字节。
*   是不可变的。
*   值语义是可取的。

我通常也会考虑这样一个变量的生命周期。如果它是在方法中使用的局部变量，那么我会倾向于使用结构（否则是类）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:35:59.917

您应该使用值类型，因为它们具有逻辑优势，而不是性能提升。话虽这么说，因为值类型是在堆栈上管理的，不需要参与垃圾回收。如果您有一个不断创建和丢弃的类型（如 int、float、double 等），那么您可以通过将它们转换为结构来获得良好的提升。需要注意的是，如果你也可以使结构不可变，你应该真正考虑这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T02:10:55.233

需要考虑的其他几件事 -

首先，您要确保结构是不可变的（通常）。因此，没有包含引用类型的结构是一个很好的经验法则。字符串可能是一个例外，因为它们在 C# 中是不可变的，但就设计的通用经验法则而言，我会对此保持警惕。

其次，到目前为止还没有提到结构的另一个用例——大量的小对象。如果您有一个大列表或小对象数组，结构提供了显着更好的缓存一致性，并且绝对至关重要。这就是为什么大多数 3D 引擎使用结构作为点/向量的原因——它们往往有大量的点数组作为顶点等。

如果性能是您的应用程序的重要组成部分，这是值得关注的。例如，在我的一个应用程序中，将单一类型从类更改为结构体可以将长时间运行（> 5 分钟运行时间）的进程减少 40%。如果您在繁重的数学计算中重复使用它们，则将对象放在内存中可以提供巨大的收益。

现在 - 在您的情况下，拥有 2 个字符串和一个 DateTime 可能不会看到任何改进。适用于字符串的例程类型可能不会进行繁重的计算（希望如此），即：在空间中转换 50 万个点，或进行大型矩阵解等。

最后 - 您会注意到 .net3.5sp1 使结构更加有用。在 3.5sp1 之前（在 x86 上），没有内联结构调用的方法。这限制了通过结构可能获得的性能提升。更新您的框架可以使旧的结构代码更快（在某些情况下）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T23:23:15.637

您并不总是需要拳击，而对于泛型，几乎不需要拳击。
值类型（结构是值类型）使用的内存将
在方法结束/返回后立即被占用，您
无需为此做任何事情。

声明为实例成员的值类型将在内存中，直到对象
被 GC 删除。

引用类型保存在托管堆上。 当没有对象持有对它的引用时，
在方法中实例化的引用类型将被垃圾收集器删除。

GC 自己工作，在大多数情况下，您应该不理会它。
您无法预测对象何时会被 GC 删除。

Dispose 模式用于引用类型，但不会强制 GC 删除
对象。它通常用于释放非托管资源。

对于堆栈中的值，请考虑以下事项：
假设您有一个具有三个方法的简单程序，如下所示：
当该程序运行时，Main 方法将运行，等等。请遵循以下
数字：

```
 Main
{
   // (0) Stack is empty
   int firstInt = 0;
   // (1) Stack now contains:
   //                     firstInt
   DoSomething1();
   // (7) Stack still contains:
   //                     firstInt
}
// Program ends

DoSomething()
{
   int anInteger = 0; 
   // (2) Stack now contains:
   //                    anInteger
   //                    firstInt
   DoMore()
   // (5) Stack now contains:
   //                     anInteger
   //                     firstInt
}
// (6) anInteger goes out of scope

DoMore
{
  int anotherInteger = 1; 
   // (3) Stack now contains:
   //                     anotherInteger
   //                     anInteger
   //                     firstInt
}
// (4) anotherInteger goes out of scope 
```

 `# mysql - MySQL 许可和 GPL

> ID：620696
> 
> 赞同：23
> 
> 时间：2009-03-06T22:29:38.090
> 
> 标签：mysql, licensing, gpl

据我所知，当我使用任何 GPL 代码（如 MySQL）构建桌面/服务器应用程序时，我将不得不在 GPL 下发布我的软件的源代码。

如果我想使用 MySQL 开发一个网络应用程序，我的代码将链接到 MySQL 库。在这种情况下，我必须按照 GPL 发布我的 webapp 的源代码吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-06T22:41:33.083

如果您将其保留为仅服务器（因此是“私有”），则不必将其作为 GPL 发布。但是一旦它到达公共桌面，就不能再被认为是内部构建，因此需要源代码。

这样你就可以：

*   以 GPL 形式发布您的代码
*   购买商业版 MySQL
*   保持它仅服务器。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T22:32:42.170

您必须发布源代码（在 GPL 下），或者支付 MySQL 的专有许可证，以便您获得根据更适合专有产品使用的许可证分发 MySQL 二进制文件的权利。不过，最好将此类问题交给您的律师。

**ETA**：只是澄清一点；如果您编写自己的库并使用其有线协议与 MySQL 对话，那么您将始终 100% 清楚。同样，如果您使用的库已经做到了这一点，但获得了 BSD 许可（例如），那么您也很清楚，因为您只是通过套接字连接与 MySQL 对话，而不是实际调用进入 GPL 代码。我没有立即知道任何 BSD 许可的 MySQL 协议接口，但肯定有可能在某个地方有一个。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-06-10T14:52:41.960

您不必为了在应用程序中使用 MySQL 而链接 MySQL 库。您所要做的就是使用 MySQL 协议与 MySQL 服务器“对话”；在这种情况下，您作为客户端（即作为用户）连接到 MySQL 服务器，然后您不需要在 GNU GPL 许可下发布您的软件。

问题是，你的程序怎么能说 MySQL 协议？一种可能性是使用 GPL 的官方 MySQL 客户端库（连接器**）**。如果您这样做，您将您的程序静态链接到 GPL 库，因此您需要在 GPL 下发布您的软件。

或者，您可以使用不同的许可证链接到第三方客户端库。例如，您可以使用[MariaDB 客户端库](https://downloads.mariadb.org/client-native/)，它是 LGPL 的（因此与专有软件兼容）并提供与原始 MySQL 客户端库相同的 API。有关更多详细信息和建议，请参阅同样适用于 MySQL的[MariaDB 许可常见问题解答。](https://mariadb.com/kb/en/licensing-faq/)

将 MySQL 服务器与您的软件一起分发可能会很棘手：您可以简单地要求您的客户自己下载和安装 MySQL，或者开发一个简单的下载器来与您的软件一起分发。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T22:34:52.913

如果您自己运行 Web 应用程序，而不是将其作为应用程序分发，那么您不必发布源代码。允许访问 Web 应用程序不被视为分发。

编辑：如果有兴趣，您可以查看[Affero 通用公共许可证](http://en.wikipedia.org/wiki/Affero_General_Public_License)，它要求 AGPL 软件的网络用户可以使用该源（例如，它将适用于 Web 应用程序）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T22:33:07.973

除非您从 GPL 软件派生和/或分发 GPL 软件，否则您应该是安全的。

链接 MySQL 客户端库既不是衍生作品，也不是分发。

**更新：**想想看，你如何链接（动态或静态）与库会有所不同。静态链接是分发，但如果您动态链接并且您的客户端自己下载连接器，那不是分发，您应该是安全的。

哦，还有 IANAL。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T22:33:08.923

MySQL 使用双重许可。正如他们所说——如果你有空，我们就有空。

因此，据我所知，如果您仅使用 MySQL JDBC 连接器 - 您的代码应该有许可证或 GPL。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T23:49:19.270

> 如果我想使用 MySQL 开发一个网络应用程序，我的代码将链接到 MySQL 库。我应该在这种情况下发布我的 webapp 的源代码以符合 GPL 吗？

1.  正如其他人所说，如果您不将应用程序分发给其他人，则根本没有问题。

2.  通常，您将针对标准数据库 API 进行开发，并让用户决定将哪个数据库连接到应用程序。在这种情况下没有问题。“你的代码”不会链接到 libmysqlclient，但它可能会与链接到 libmysqlclient 的数据库访问模块结合使用。

3.  如果你想分发一个安装程序，将你的应用程序和 libmysqlclient 一起设置，那可能不会算作“纯粹的聚合”，所以它需要你在开源许可证下分发你的应用程序。然而，这不一定是 GPL - 请参阅[MySQL FOSS License Exception](http://www.mysql.com/about/legal/licensing/foss-exception/)。

4.  如果您想分发一个安装程序来设置您的应用程序和 MySQL 服务器本身，则该例外不适用，因此您仅限于 GPL。

自然是 IANAL，对于什么算作派生，尤其是在动态链接方面，肯定仍然存在一些不确定性。然而，以上是我对 MySQL AB 在许可方面的传统立场的理解，我还没有听说在 Sun 收购后有任何变化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-22T12:19:44.857

不幸的是，它并没有那么清晰：GPL 禁止在不提供每个“衍生产品”来源的情况下进行**分发。**分发在法律上被定义为将源从一台计算机转移到一台或多台计算机以供官方使用的行为。

不幸的是，**这也可能包括在服务器集群、QA 盒、开发盒等上**的使用。在现代开发商店中，仅将代码发布到多个前端/后端盒在技术上是分发（在法律看来）。

自由软件基金会怎么想并不重要，重要的是一旦某人/一家公司因为这样做而被起诉，一些法官的想法。

**这只是GPL 的主要客户如今是希望阻止竞争对手分叉代码的公司**的另一个原因。其他所有人都应该考虑少得多的许可，例如 MIT 或知识共享署名许可。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-06T22:35:11.663

首先，我不是律师。在这里接受任何建议之前，先和一个人谈谈。

除此之外，如果您不分发您的网络应用程序，您可能不需要发布您的更改。如果您托管 Web 应用程序，您仍然可以让其他人使用您的 Web 应用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-06T22:52:12.140

如果您的发行版在同一个包中包含并安装 MySql，则需要商业许可证。

但是，如果您仅分发代码，仅使用“需要 MySql”通知和安装脚本（用于创建/填充表），AFAIK 应该没有问题。

当然，伊纳尔。

# php - 将元素放在 PHP 数组中间的简单方法是什么？

> ID：620709
> 
> 赞同：0
> 
> 时间：2009-03-06T22:33:22.793
> 
> 标签：php, arrays

假设您有一个包含 10 个元素的索引数组，并且您想在中间的某个位置放置一个元素（例如索引 3）。然后我想让数组的其余部分移位，因此长度为 11 个元素。是否有捷径可寻？

我很惊讶没有`put()`功能或其他东西。

我知道用 and 的组合来做到这一点很容易，`array_splice`但`array_merge`我只是想知道是否有更简单的方法。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-06T22:40:32.307

[array_splice() 这样做](http://us2.php.net/manual/en/function.array-splice.php)

```
$input = array("red", "green", "blue", "yellow");
array_splice($input, 3, 0, "purple");
// $input is now array("red", "green", "blue", "purple", "yellow"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T22:40:52.197

不幸的是，您最好的选择是您在帖子中描述的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T22:52:04.963

如果你使用 array_splice()，PHP 仍然需要复制一半的数组来进行插入，这对于大数组大小来说会影响性能。也许您应该改用列表或树数据结构？

我唯一一次需要插入到数组中间是在我做一些与插入排序基本相似的操作时。也许您想将未排序的项目存储在一个数组中，然后在将它们全部添加后对它们进行排序？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T22:50:33.610

目前没有 PHP 函数可以处理这个问题。然而，自己动手并不难：

```
function array_insert(&$array, $insert, $position) {
    $c = count($array);
    $slice = array_merge($insert, array_slice($array, $position));
    array_splice($array, $position, $c, $slice);
}

$array = array('a','b','d','e');
print_r($array);
array_insert($array, array('c'), 2);
print_r($array); 
```

将导致：

```
Array
(
    [0] => a
    [1] => b
    [2] => d
    [3] => e
)
Array
(
    [0] => a
    [1] => b
    [2] => c
    [3] => d
    [4] => e
) 
```

如果位置大于数组，插入不是数组等，您可能可以添加检查。

# xml - 根据属性删除 XElement

> ID：620729
> 
> 赞同：0
> 
> 时间：2009-03-06T22:38:12.827
> 
> 标签：xml, linq-to-xml, xelement

我还在玩xml。现在我有一个看起来像这样的文件：

```
<?xml version="1.0" encoding="utf-8"?>
<Attributes>
 <AttributeSet id="10110">
  <Attribute id="1">some text here</Attribute>
  <Attribute id="2">some text here</Attribute>
  <!-- 298 more Attribute nodes follow -->
  <!-- note that the value for the id attribute is numbered consecutively -->
 </AttributeSet>
</Attributes> 
```

总共有 300 个属性节点，其中大部分我不需要。我想做的是删除所有没有为 id 属性指定值的 Attribute 节点。我已经建立了一个包含大约 10 个值的字符串数组。这些值代表我想保留在 xml 中的属性。其余的我想删除。

我试图用下面的代码做的是通过删除我不想使用的所有属性节点来修改 xml：

```
Dim ss() As String = New String() {"39", "41", "38", "111", "148", "222", "256", "270", "283", "284"} 'keep the Attributes whose id value is one of these numbers
Dim rv As New List(Of String)'will hold Attribute ids to remove
Dim bool As Boolean = False
For Each x As XElement In doc...<eb:Attribute>
 For Each s As String In ss
  If x.@id = s Then
   bool = True
   Exit For
  End If
 Next
 If bool = True Then
  'do nothing
 Else 'no attribute matched any of the attribute ids listed mark xelement for removal
  rv.Add(x.@id)
 End If
Next
'now remove the xelement
For Each tr As String In rv
 Dim h As String = tr
 doc...<eb:Attribute>.Where(Function(g) g.@id = h).Remove()
Next
'save the xml
doc.Save("C:\myXMLFile.xml") 
```

出于某种原因，我的代码不起作用。不删除不需要的属性节点。

有什么问题？如何删除 id 属性值与字符串数组中的任何数字都不匹配的 Attribute 节点？

提前致谢。

PS - 我希望我在描述我的问题时说清楚了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T23:05:13.947

没关系。我想到了。这是我所做的：

```
For Each x As XElement In doc...<eb:Attribute>
 **bool = False 'I simply added this line of code and everything worked perfectly**
 For Each s As String In ss
  If x.@id = s Then
   bool = True
   Exit For
  End If
 Next
 If bool = True Then
  'do nothing
 Else 'no attribute matched any of the attribute ids listed so remove the xelement
  rv.Add(x.@id)
 End If
Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-27T06:27:29.083

**删除所有不需要的节点：**

```
XDocument xDoc = XDocument.Load(xmlFilename);

List<string> keepList = new List<string> { "1", "2", "3" };

var unwanted = from element in xDoc.Elements("Attributes").Elements("AttributeSet").Elements("Attribute")
               where !keepList.Contains((string)element.Attribute("id"))
               select element;

unwanted.Remove();

xDoc.Save(xmlFilename); 
```

# installation - Wix 本地设置\应用数据快捷方式

> ID：620731
> 
> 赞同：3
> 
> 时间：2009-03-06T22:38:37.117
> 
> 标签：installation, wix, windows-installer, shortcuts

如何使用 Wix 以“%UserProfile%\Local Settings\Application Data\Foo\Logs”为目标创建快捷方式？

```
<Shortcut Id="LogsStartMenuShortcut"
  Name="Logs"
  Target="%UserProfile%\Local Settings\Application Data\FalconMobileServer\"
  Icon="icon.ico"/> 
```

它不喜欢目标中的 % 符号。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T08:50:24.960

查看列出所有[MSI 预定义目录](http://kb.acresso.com/selfservice/viewContent.do?externalID=Q105880)的该站点- 我认为您应该在某处找到您正在寻找的目录 :-)

这个可能在这里？

`LocalAppDataFolder`用作本地（非漫游）应用程序的数据存储库的目录的完整路径。

# c# - C# 中的内存泄漏

> ID：620733
> 
> 赞同：56
> 
> 时间：2009-03-06T22:38:57.740
> 
> 标签：c#, .net, memory-leaks, garbage-collection, managed

当您确保所有句柄和实现的东西`IDispose`都被释放时，托管系统中是否有可能泄漏内存？

会不会有一些变量被遗漏的情况？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-03-07T02:25:52.063

事件处理程序是非明显内存泄漏的常见来源。如果您从 object2 订阅 object1 上的事件，然后执行 object2.Dispose() 并假装它不存在（并从您的代码中删除所有引用），则 object1 的事件中有一个隐式引用将阻止 object2垃圾收集。

```
MyType object2 = new MyType();

// ...
object1.SomeEvent += object2.myEventHandler;
// ...

// Should call this
// object1.SomeEvent -= object2.myEventHandler;

object2.Dispose(); 
```

这是一个常见的泄漏案例——忘记轻松取消订阅事件。当然，如果 object1 被收集，object2 也会被收集，但在此之前不会。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-03-06T22:43:00.820

我认为 C++ 风格的内存泄漏是不可能的。垃圾收集器应该考虑这些。可以创建聚合对象引用的静态对象，即使这些对象不再使用。像这样的东西：

```
public static class SomethingFactory
{
    private static List<Something> listOfSomethings = new List<Something>();

    public static Something CreateSomething()
    {
        var something = new Something();
        listOfSomethings.Add(something);
        return something;
    }
} 
```

这显然是一个愚蠢的例子，但它相当于托管运行时内存泄漏。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-07T04:37:42.387

正如其他人指出的那样，只要内存管理器中没有实际的错误，不使用非托管资源的类就不会泄漏内存。

您在 .NET 中看到的不是内存泄漏，而是永远不会被释放的对象。只要垃圾收集器可以在对象图上找到一个对象，它就不会被释放。因此，如果任何地方的任何活对象都引用了该对象，它就不会被释放。

事件注册是实现这一目标的好方法。如果一个对象注册了一个事件，它注册的任何东西都有对它的引用，即使你消除了对该对象的所有其他引用，直到它取消注册（或者它注册的对象变得不可访问）它都会保持活动状态。

因此，您必须注意在您不知情的情况下注册静态事件的对象。例如，一个漂亮的功能`ToolStrip`是，如果您更改显示主题，它将自动在新主题中重新显示。它通过注册静态`SystemEvents.UserPreferenceChanged`事件来完成这个漂亮的功能。当您更改 Windows 主题时，会引发事件，并且所有`ToolStrip`正在侦听该事件的对象都会收到通知，告知您有新主题。

`ToolStrip`好的，假设您决定在表单上丢弃 a ：

```
private void DiscardMyToolstrip()
{
    Controls.Remove("MyToolStrip");
} 
```

你现在有一个`ToolStrip`永远不会死的。即使它不再出现在您的表单上，每次用户更改主题时，Windows 都会尽职尽责地告诉其他不存在的人`ToolStrip`。每次垃圾收集器运行时，它都会认为“我不能把那个对象扔掉，`UserPreferenceChanged`事件正在使用它”。

这不是内存泄漏。但也可能如此。

这样的事情使内存分析器变得非常宝贵。运行内存分析器，你会说“这很奇怪，`ToolStrip`堆上似乎有一万个对象，尽管我的表单上只有一个。这是怎么发生的？”

哦，如果您想知道为什么有些人认为属性设置器是邪恶的：要让 a`ToolStrip`从`UserPreferenceChanged`事件中注销，请将其`Visible`属性设置为`false`.

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-06T23:00:51.727

委托可能会导致不直观的内存泄漏。

每当您从实例方法创建委托时，对该实例的引用都会存储在该委托“中”。

此外，如果您将多个委托组合成一个多播委托，那么只要在某处使用该多播委托，您就会拥有对众多对象的一大堆引用，这些对象不会被垃圾收集。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-03-20T20:30:05.560

如果您正在开发一个 WinForms 应用程序，一个微妙的“泄漏”是`Control.AllowDrop`属性（用于启用拖放）。如果`AllowDrop`设置为“true”，CLR 仍会通过`System.Windows.Forms.DropTarget`. 要解决此问题，请确保您`Control`的 's`AllowDrop`属性设置为`false`您不再需要它时，CLR 将处理其余的事情。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-06T23:01:53.613

.NET 应用程序中内存泄漏的唯一原因是对象仍在被引用，尽管它们的生命周期已经结束。因此，垃圾收集器无法收集它们。它们成为长寿的对象。

我发现通过订阅事件而不在对象的生命结束时取消订阅它很容易导致泄漏。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-03-06T22:48:18.060

如前所述，保留引用将导致内存使用量随着时间的推移而增加。进入这种情况的一个简单方法是使用事件。如果您有一个长寿命的对象，并且您的其他对象正在侦听某个事件，如果从未删除侦听器，那么长寿命对象上的事件将在不再需要这些其他实例后很长时间内保持它们的活性。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-11-03T14:29:49.190

您可能会发现我的新文章很有用：[如何检测和避免 .NET 应用程序中的内存和资源泄漏](http://weblogs.asp.net/fmarguerie/archive/2009/11/03/article-detect-avoid-memory-leaks.aspx)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-03-06T22:52:22.480

[反射发射](http://msdn.microsoft.com/en-us/library/3y322t50.aspx)是另一个潜在的泄漏源，例如内置对象反序列化器和花哨的 SOAP/XML 客户端。至少在框架的早期版本中，从不卸载从属 AppDomains 中生成的代码......

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-21T20:37:08.247

您不能在托管代码中泄漏内存是一个神话。诚然，这比非托管 C++ 中要困难得多，但有一百万种方法可以做到这一点。持有引用、不必要的引用、缓存等的静态对象。如果你以“正确”的方式做事，你的许多对象直到比必要的时间晚得多才会被垃圾收集，这在我看来也是一种内存泄漏，以实际而非理论的方式。

幸运的是，有一些工具可以帮助您。我经常使用 Microsoft 的[CLR Profiler——](http://www.microsoft.com/downloadS/details.aspx?FamilyID=86ce6052-d7f4-4aeb-9b7a-94635beebdda&displaylang=en)它不是有史以来最友好的工具，但它绝对非常有用并且是免费的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-06T22:43:11.380

一旦对对象的所有引用都消失了，垃圾收集器将在下一次传递时释放该对象。我不会说泄漏内存是不可能的，但这相当困难，为了泄漏，你必须在没有意识到的情况下引用一个坐在周围的对象。

例如，如果您将对象实例化为列表，然后在完成后忘记将它们从列表中删除并且忘记释放它们。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-01-22T06:49:01.373

不是真正的内存泄漏，但在使用大对象时很容易耗尽内存（如果我没记错的话，大于 64K）。它们存储在 LOH 上，并且没有进行碎片整理。因此，使用这些大对象并释放它们会释放 LOH 上的内存，但 .NET 运行时不再为该进程使用该空闲内存。因此，只需使用 LOH 上的几个大对象，您就可以轻松地用完 LOH 上的空间。微软知道这个问题，但我记得现在正在计划解决这个问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-06T22:45:04.137

如果未正确清理非托管资源，则可能会发生泄漏。实现[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)的类可能会泄漏。

但是，常规对象引用不像低级语言那样需要显式内存管理。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-06T22:44:18.477

虽然框架中的某些东西可能存在泄漏，但更有可能的是您有一些东西没有被正确处理，或者某些东西阻止了 GC 处理它，IIS 将是这个问题的主要候选者。

请记住，并非 .NET 中的所有内容都是完全托管的代码、COM 互操作、文件 io（如文件流、数据库请求、图像等）。

我们前段时间遇到的一个问题（IIS 6 上的 .net 2.0）是我们将创建一个映像然后将其处理掉，但 IIS 暂时不会释放内存。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-06T22:47:29.590

唯一的泄漏（除了运行时中可能存在的错误，尽管由于垃圾收集而不太可能）将用于本机资源。如果您 P/Invoke 到本机库中，该库代表您的托管应用程序打开文件句柄或套接字连接或任何内容，并且您从未显式关闭它们（并且不在处置器或析构器/终结器中处理它们），您可以有内存或资源泄漏，因为运行时无法为您自动管理所有这些。

但是，如果您坚持使用纯托管资源，那么您应该没问题。如果您在没有调用本机代码的情况下遇到任何形式的内存泄漏，那么这就是一个错误。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-03T14:40:55.783

在我的上一份工作中，我们使用了一个像筛子一样泄漏的第 3 方 .NET SQLite 库。

在每次都必须打开和关闭数据库连接的奇怪情况下，我们进行了大量快速数据插入。第 3 方库做了一些我们应该手动打开的相同连接，但没有记录它。它还在我们从未找到的地方保存了参考资料。结果是打开的连接数量是预期的 2 倍，而只有 1/2 的连接被关闭。由于引用被保留，我们有内存泄漏。

这显然与经典的 C/C++ 内存泄漏不同，但从所有意图和目的来看，这对我们来说都是一个问题。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-12-13T04:29:11.227

自我提醒如何找到内存泄漏：

*   删除和 gc.collect 调用。
*   等到我们确定内存正在泄漏。
*   从任务管理器创建转储文件。
*   [使用DebugDiag](https://www.microsoft.com/en-us/download/details.aspx?id=49924)打开转储文件。
*   先分析结果。那里的结果应该可以帮助我们，这个问题通常会占用大部分内存。
*   修复代码，直到在那里找不到内存泄漏。
*   使用 .net profiler 等 3rd 方应用程序。（我们可以试用，但需要尽快解决问题。第一次转储应该主要帮助我们了解如何泄漏）
*   如果问题出在虚拟内存中，则需要查看非托管内存。（通常那里有另一个需要启用的配置）
*   根据使用方式运行第 3 方应用程序。

常见的内存泄漏问题：

*   事件/代表永远不会被删除。（处置时，请确保事件未注册） - 请参阅[ReepChopsey](https://stackoverflow.com/a/621177)答案
*   列表/字典从未被清除。
*   引用保存在内存中的另一个对象的对象永远不会被释放。（克隆它以便于管理）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-06-16T15:31:12.880

如果它被认为是内存泄漏，也可以使用这种代码来实现：

```
public class A
{
    B b;
    public A(B b) { this.b = b; }
    ~A()
    {
        b = new B();
    }
}

public class B
{
    A a;
    public B() { this.a = new A(this); }
    ~B()
    {
        a = new A(this);
    }
}

class Program
{
    static void Main(string[] args)
    {
        {
            B[] toBeLost = new B[100000000];
            foreach (var c in toBeLost)
            {
                toBeLost.ToString(); //to make JIT compiler run the instantiation above
            }
        }
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-07T15:37:55.553

使用 .NET XmlSerializer 时可能会发生内存泄漏，因为它使用了不会被释放的非托管代码。

请参阅文档并在此页面上搜索“内存泄漏”：

[https://docs.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer?view=netframework-4.7.2](https://docs.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer?view=netframework-4.7.2)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-11-27T21:58:26.453

在控制台或 Win 应用程序中创建一个`Panel`对象（panel1），然后添加 1000`PictureBox`并设置其`Image`属性，然后调用`panel1.Controls.Clear`. 所有 PictureBox 控件仍在内存中，`GC`无法收集：

```
var panel1 = new Panel();
var image = Image.FromFile("image/heavy.png");
for(var i = 0; i < 1000;++i){
  panel1.Controls.Add(new PictureBox(){Image = image});
}
panel1.Controls.Clear(); // => Memory Leak! 
```

正确的做法是

```
for (int i = panel1.Controls.Count-1; i >= 0; --i)
   panel1.Controls[i].Dispose(); 
```

[调用 Controls.Clear() 时内存泄漏](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.control.controlcollection.clear?redirectedfrom=MSDN&view=netframework-4.7.2#remarks)

> 调用 Clear 方法不会从内存中删除控制句柄。您必须显式调用 Dispose 方法以避免内存泄漏

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-07-15T09:41:56.610

小功能有助于避免“内存泄漏”。因为垃圾收集器在函数结束时释放局部变量。如果函数很大并且占用大量内存，您必须自己释放占用大量内存且不再需要的局部变量。类似的全局变量（数组、列表）也很糟糕。

在创建图像而不是处理它们时，我在 C# 中遇到了内存泄漏。这有点奇怪。人们说你必须在每个拥有它的对象上调用 .Dispose() 。但是图形 C# 函数的文档并不总是提到这一点，例如函数 GetThumbnailImage()。我认为 C# 编译器应该警告你。

# visual-studio-2008 - Visual Studio 2008 测试集

> ID：620734
> 
> 赞同：0
> 
> 时间：2009-03-06T22:39:49.563
> 
> 标签：visual-studio-2008, unit-testing

是否可以将测试组合在一起，以便我可以运行所有可用测试的子集？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T22:47:09.343

假设您使用的是 VSTT，又名 MSTest；您可以使用[测试列表](http://msdn.microsoft.com/en-us/library/ms182463(VS.80).aspx#)功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T22:55:12.863

IN VS 2008 pro and Team 允许您创建一个测试列表，您可以在其中指定要运行的测试。

您还可以使用命名空间来安排测试以指定测试组，然后在指定的上下文中运行测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:47:30.713

两种简单的方法是：按类和按命名空间。

有一个在上下文中运行测试选项，可以使用运行特定的测试方法，也可以是一个测试类或命名空间。这仅取决于您指向的内容。在编辑器中打开一个测试，将光标放在命名空间上并检查它。

# database - 有没有办法获得关于两个 Jet (.mdb) 数据库的差异报告？

> ID：620740
> 
> 赞同：3
> 
> 时间：2009-03-06T22:42:54.640
> 
> 标签：database, ms-access, diff

我的代码依赖于一个相对较小的 MS Jet（在 Access 中创建）数据库。我们的源代码控制过程远非它可能/应该是的（这是一个需要立即解决的问题），我们最终得到了同一个数据库的两个版本。编辑“其他”版本的人不再在身边给我关于他改变了什么的提示。找出两个版本数据库中包含的实际数据差异的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T22:47:49.293

将所有表单和模块输出到文本文件并使用文本比较实用程序。

例如：

```
Sub ToText()
Dim frm, mdl

For Each frm In CurrentProject.AllForms
    Application.SaveAsText acForm, frm.Name, "c:\docs\" _ 
        & frm.Name & ".txt" 
```

'所以格式化

```
Next

For Each mdl In CurrentProject.AllModules
    Application.SaveAsText acModule, mdl.Name, "c:\docs\" _
        & mdl.Name & ".txt" 
```

'所以格式化

```
Next
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T22:48:42.380

看看这个[http://www.download.com/StarInix-Database-Compare/3000-10254_4-10614062.html](http://www.download.com/StarInix-Database-Compare/3000-10254_4-10614062.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T22:50:38.913

有一些工具可以做到这一点：[http ://www.fmsinc.com/MicrosoftAccess/DatabaseCompare.html](http://www.fmsinc.com/MicrosoftAccess/DatabaseCompare.html)

或者您可以查看创建/修改日期，看看是否可以提供线索（更改数据库窗口以显示详细信息）

或者您可以运行工具/分析/文档并查看对象属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-11T01:48:59.457

我制作了一个应用程序，允许在两个 Microsoft Access 文件（mdb 或 accdb）之间比较和导入/导出数据库对象。它被称为“AccdbMerge”，可以在这里下载： [https ://www.db-merge-tools.net/accdbmerge](https://www.db-merge-tools.net/accdbmerge)

基本上，它自动化了 Remou 提供的方法

# c++ - C ++：围绕某个点旋转矢量

> ID：620745
> 
> 赞同：15
> 
> 时间：2009-03-06T22:44:04.700
> 
> 标签：c++, vector, rotation

我正在尝试围绕向量上的某个点旋转向量（在 C++ 中）：

```
1 2 3
4 5 6
7 8 9 
```

围绕点 (1,1)（即“5”）旋转 90 度将导致：

```
7 4 1
8 5 2
9 6 3 
```

现在我正在使用：

```
x = (x * cos(90)) - (y * sin(90))
y = (y * cos(90)) + (x * sin(90)) 
```

但我不希望它围绕 (0,0) 旋转

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-01T13:26:40.580

答案取决于您的坐标系。

## 计算机图形坐标系，`(0,0)`在*左上角*

如果您使用的是计算机图形矢量实现，**左上角**`(0,0)`在哪里，并且您围绕点旋转，那么旋转计算，包括转换回原始坐标系，将是：**`(dx, dy)`**

 **```
x_rotated =      ((x - dx) * cos(angle)) - ((dy - y) * sin(angle)) + dx
y_rotated = dy - ((dy - y) * cos(angle)) + ((x - dx) * sin(angle)) 
```

## 物理/数学坐标系，`(0,0)`在*左下角*

如果您使用的是更传统的现实世界坐标系，左下角在哪里**，**`(0,0)`那么围绕点的旋转计算，包括平移回原始坐标系，将是：**`(dx, dy)`**

 **```
x_rotated = ((x - dx) * cos(angle)) - ((y - dy) * sin(angle)) + dx
y_rotated = ((x - dx) * sin(angle)) + ((y - dy) * cos(angle)) + dy 
```

[感谢[mmx](https://stackoverflow.com/users/33708/mmx)对[Pesto](https://stackoverflow.com/a/620769/42473)帖子的评论，感谢[SkeletorFromEterenia](https://stackoverflow.com/a/29075925/42473)强调我的实现中的一个错误。]

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-06T22:47:47.187

解决方案是将向量平移到旋转中心为 (0,0) 的坐标系。应用旋转矩阵并将向量转换回原始坐标系。

```
dx = x of rotation center  
dy = y of rotation center

V2 = V - [dx, dy, 0]  
V3 = V2 * rotation matrix  
Result = V3 + [dx, dy, 0] 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-06T22:51:08.787

假设您正在使用标准向量实现，其中 (0,0) 将是左上角并且您围绕点 (x_origin, y_origin) 旋转，应该这样做：

```
x = ((x - x_origin) * cos(angle)) - ((y_origin - y) * sin(angle))
y = ((y_origin - y) * cos(angle)) - ((x - x_origin) * sin(angle)) 
```

请注意，y 是`y_origin - y`因为 y 值随着您下降而增加。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-03-16T11:40:49.733

我发现 Mark Booth 的答案是错误的（将 (0,1,0) 旋转 0 度，然后用他的公式得到 (0,-1,0)），我最终得到：

```
double cs = cos_deg(new_degrees);
double sn = sin_deg(new_degrees);

double translated_x = x - x_origin;
double translated_y = y - y_origin;

double result_x = translated_x * cs - translated_y * sn;
double result_y = translated_x * sn + translated_y * cs;

result_x += x_origin;
result_y += y_origin; 
```

当然，这可以进一步缩短，但我想让它尽可能简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T22:49:04.860

您将需要使用[平移矩阵](http://en.wikipedia.org/wiki/Translation_%28geometry%29)来围绕不同的点移动旋转。

# c++ - 在 Windows XP 上编译 C++ 程序

> ID：620752
> 
> 赞同：0
> 
> 时间：2009-03-06T22:46:22.387
> 
> 标签：c++, windows

我在 Windows XP 上用 C++ 运行一个简单的 Hello-world 程序时遇到问题。我在这里写了一个帖子：

> [使用来自 cygwin 的 g++ C++ 编译器](https://stackoverflow.com/questions/602937/using-the-g-c-compiler-from-cygwin)

在我陈述问题的地方，我收到了许多有用的回复，这解决了一些问题。但是，我仍然无法运行我的 hello-world 程序。请看一下帖子，我已经在其中包含了该程序。我的一个朋友能够在他的机器上毫无问题地运行这个程序。所以，问题应该出在我的系统或库或其他东西上，但我不知道是什么。在我的帖子的“已编辑”部分，我已经包含了我收到的错误消息。

这是我尝试像这样编译程序时收到的内容：

> g++你好.cpp

从 cygwin 外壳：

当我尝试 g++ hello.cpp 时，我得到：

```
hello.cpp:1: parse error before character 0357
hello.cpp: In function 'int main()':
hello.cpp:'cout' undeclared (first use this function)
hello.cpp: (Each undeclared identifier is reported only once
hello.cpp: for each function it appears in.)
hello.cpp: 'endl' undeclared (first use this function)
g++.exe: hello.cpp: No such file or directory
g++.exe: No input files
g++.exe: hello.cpp: No such file or directory
g++.exe: No input files
g++.exe: hello.cpp: No such file or directory
g++.exe: No input files
g++.exe: hello.cpp: No such file or directory
g++.exe: No input files
g++.exe: hello.cpp: No such file or directory
g++.exe: No input files 
```

这是我尝试从 DOS 命令提示符编译程序（再次使用 g++ hello.cpp）时得到的结果：

当我尝试 g++ hello.cpp 时，我得到：

```
hello.cpp:1: parse error before character 0357
hello.cpp: In function 'int main()':
hello.cpp:'cout' undeclared (first use this function)
hello.cpp: (Each undeclared identifier is reported only once
hello.cpp: for each function it appears in.)
hello.cpp: 'endl' undeclared (first use this function) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T23:03:49.443

您的代码中有非法字符；它可能是由错误的字符编码或类似的东西引起的。试着检查一下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T23:03:50.863

看起来您的代码中不知何故有一个非法字符。您是自己输入代码还是复制粘贴？如果是后者，您复制的源可能在某种程度上是可疑的 - 自己将代码输入编辑器，保存并重新编译。

# ruby - Ruby 文件强制复制

> ID：620754
> 
> 赞同：7
> 
> 时间：2009-03-06T22:47:10.607
> 
> 标签：ruby, file, copy

有没有办法让红宝石做一个强制复制？FileUtils.cp_r 似乎没有 :force => true 选项。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-06T22:55:10.243

不，但它确实有`:remove_destination`一个选项，它做同样的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-03-08T17:13:31.730

如果您[`FileUtils.cp`](https://ruby-doc.org/stdlib-2.4.1/libdoc/fileutils/rdoc/FileUtils.html#method-c-cp)用于复制单个文件，则覆盖目标文件（如果存在）是默认行为；不需要“强制”或类似选项。

# php - 在没有 GD 的情况下在 PHP 中加载 PNG 和读取像素？

> ID：620764
> 
> 赞同：1
> 
> 时间：2009-03-06T22:49:19.727
> 
> 标签：php, png, gd

我需要从真彩色 PNG 文件中读取准确的未更改像素数据 (ARGB)，最好是从 PHP 中读取。

不幸的是，PHP 中的 GD 库与 alpha 通道混淆（将其从 8 位减少到 7 位），使其无法使用。

我目前假设我的选择是：

1.  ~~实现我自己的原始 PNG 阅读器来提取必要的数据。~~
2.  使用一些较少损坏的语言/库并从 PHP 中将其作为 shell 进程或 CGI 调用。

不过，我很想听听任何其他想法，或者对另一种方式的建议......

**编辑**：我认为＃1已经出局了。我尝试将 IDAT 数据流传递给 gzinflate()，但它只是给了我一个数据错误。（在 PHP 之外使用完全相同的数据执行完全相同的操作会产生预期的结果。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T22:51:41.343

ImageMagick 怎么样？

```
<?php
$im = new Imagick("foo.png");
$it = $im->getPixelIterator();

foreach($it as $row => $pixels) {
    foreach ($pixels as $column => $pixel) {
        // Do something with $pixel
    }

    $it->syncIterator();
}
?> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-08T21:12:08.217

您可以使用[netpbm](http://www.libpng.org/pub/png/apps/pnmtopng.html)的 pngtopnm 函数将 PNG 转换为易于解析的 PNM。这是一个有点幼稚的 php 脚本，可以帮助您获得所需的内容：

```
<?php
$pngFilePath = 'template.png';
// Get the raw results of the png to pnm conversion
$contents = shell_exec("pngtopnm $pngFilePath");
// Break the raw results into lines
//  0: P6
//  1: <WIDTH> <HEIGHT>
//  2: 255
//  3: <BINARY RGB DATA>
$lines = preg_split('/\n/', $contents);

// Ensure that there are exactly 4 lines of data
if(count($lines) != 4)
    die("Unexpected results from pngtopnm.");

// Check that the first line is correct
$type = $lines[0];
if($type != 'P6')
    die("Unexpected pnm file header.");

// Get the width and height (in an array)
$dimensions = preg_split('/ /', $lines[1]);

// Get the data and convert it to an array of RGB bytes
$data = $lines[3];
$bytes = unpack('C*', $data);

print_r($bytes);
?> 
```

# asp.net - 编译器失败，错误代码 2000

> ID：620765
> 
> 赞同：0
> 
> 时间：2009-03-06T22:49:44.140
> 
> 标签：asp.net, vb.net

对于那些像我在 .NET 1.1 中仍然有大量遗留代码的人，有没有人找到解决这个问题的方法： [http ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=90240](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=90240)

细节通常如下：

```
Microsoft (R) Visual Basic .NET Compiler version 7.10.6001.4
for Microsoft (R) .NET Framework version 1.1.4322.2407
Copyright (C) Microsoft Corporation 1987-2002\. All rights reserved.

vbc : Command line error BC2017 : could not find library 'c:\windows\microsoft.net\framework\v1.1.4322\temporary asp.net files\...\...\...\*.dll
vbc : Fatal error BC2000 : compiler initialization failed unexpectedly: The filename, directory name, or volume label syntax is incorrect. 
```

命令行中给出的目录将不存在，考虑到错误消息，这是有道理的。有问题的部分是一切都可以完全重建。由于“变通”如此简单，微软当然不会为 .net 1.1 解决问题。

对于抢先建议升级到 .net 2.0+ 的每个人来说，由于时间限制和资源，这不是一个可接受的解决方案。对于那些说这不是一个可以接受的借口的人，去寻找另一个话题，不是每个公司都是完美的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-26T09:55:05.213

不幸的是，似乎没有针对此问题的实际解决方案，只有各种解决方法。

这是 1.0 和 1.1 框架中的一个已知错误，在 2.0（或更高版本）框架中不存在。升级到 2.0（或更高版本）当然是更好的解决方案（我相信您知道），但是，正如您所说的那样，您不能这样做。

除了有解决该问题的方法外，您可能还配置了其他设置，也可能没有配置这些设置，这有助于在一定程度上缓解问题。

此线程：
[BC2017 - 编译器错误 - BC2000](http://groups.google.com/group/microsoft.public.dotnet.languages.vb/browse_thread/thread/77facb0b57798228/8416d0e4346450f4?q=BC2017+-+Compiler+Error+-+BC2000#8416d0e4346450f4)
（尤其是直接链接到的帖子）应该为可能的重新配置更改提供一些选项，以帮助缓解问题。

# c# - 安装合并模块以及“消费”

> ID：620775
> 
> 赞同：0
> 
> 时间：2009-03-06T22:54:36.767
> 
> 标签：c#, visual-studio, installation, merge-module

我有几个解决方案代表了我在工作中建立的代码框架。一种解决方案称为“框架”，另一种称为“扩展”。

我拆分它们的原因是“扩展”解决方案包含由扩展方法组成的项目，并且这些项目被组织起来，以便生成的程序集反映 .NET 程序集。

我为“扩展”创建了一个合并模块项目，以及一个使用它的安装程序。一切都很好而且很花哨 - 但现在我想为“框架”创建一个安装程序，它也使用相同的合并模块。因此，我想修改“扩展”安装程序以将“扩展”合并模块文件复制到 C `:\Program Files\Common Files\Merge Modules`，以便“框架”安装程序有一个众所周知的路径来引用“扩展”的合并模块，而不是引用我的 VS 解决方案所在的任何晦涩路径（原因是框架有时会构建在不同的机器上，而这些机器上的 VS 项目的路径可能会有所不同）。

MSDN 文档只是简单地解决了这个问题，只是说合并模块不能安装到文件系统中，而只能“使用”。

失败。

有谁知道解决这个问题的方法？自定义操作？Visual Studio 安装程序如何安装它的合并模块？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T01:07:03.943

当您创建 MergeModule 安装程序作为文件系统编辑器的一部分时，有一个名为“Module Retargetable Folder”的文件夹（这是默认名称，可以更改，也可以添加其他名称）。

构建 .msm 后，如果您转到主设置项目并将合并模块添加到其中，您可以在解决方案资源管理器中选择 .msm 并查看属性窗口应该有一个名为“MergeModuleProperties”的条目，展开此您应该会看到列出的所有可重定向文件夹，然后您可以将它们指向正确的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T20:25:17.620

简短的回答是：没有办法做到这一点，除非编写自己的安装框架。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T20:44:51.647

晚会迟到了，但是

我通过重命名合并模块（更改文件扩展名），将其作为普通文件安装到文件系统，然后重命名已安装的文件来完成此操作。

# c# - C# 是高级语言吗？

> ID：620778
> 
> 赞同：6
> 
> 时间：2009-03-06T22:55:15.907
> 
> 标签：c#, programming-languages

C# 是高级语言吗？我认为它更像是中等水平，但我仍然不确定这一点。你会认为它和一些流行的脚本语言一样高级吗？

还是它可以容纳不止一层？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-06T22:57:28.647

是的，它是高级别的。非常。你是唯一一个承认“中级语言”这个词的人。:)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-07T00:32:33.240

根据我从各种来源阅读的内容，**C#**被认为是一种**3GL**语言。更高级别的语言 4GL 看起来更像自然语言，而 5GL 语言是关于基于约束的编程（人工智能），您可以在其中定义问题的约束，但将其留给计算机来解决。

如果您单独判断**C#**语言（不考虑 .Net 框架），它与其他基于 C 的语言并没有太大的不同，因此从这个意义上说，3GL 定义适合。

这是维基百科的链接以供参考：

[http://en.wikipedia.org/wiki/Third-generation_programming_language](http://en.wikipedia.org/wiki/Third-generation_programming_language)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-07T00:55:48.910

“当它的程序需要关注不相关的内容时，编程语言是低级的。” ——艾伦·佩利斯

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-06T22:56:18.697

是的，C# 被认为是一种高级语言。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-06T22:58:01.547

定义高级语言？在创建 C 时，它被认为是一种高级语言，因为它可以在多种体系结构上编译

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-06T23:00:10.560

我个人会说它具有高度的抽象性。与 C 或 C++ 不同，很多复杂的事情都由 .NET 框架处理，在 C 或 C++ 中，您几乎负责发生的所有事情。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-06T23:21:32.707

考虑到 Bob The Janitor 的帖子：

> 定义高级语言？在创建 C 时，它被认为是一种高级语言，因为它可以在多种体系结构上编译

我想说它就像 Java 一样从“高”点移动。

Java 在这一点上被认为是 JVM 的汇编语言。像 Scala 和 Ruby 这样的新语言似乎提供了 Java 和 C# 不容易匹配的多种语言。

不要误解我的意思，我碰巧认为 Java/C# 处于完美的水平——我只是说，与 C 一样，这些语言具有相当固定的定义/功能集，而“功能”将继续存在以较新的语言发明和实现。

如果你不相信我，看看 Scala.. 一个完全不同的怪物！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-06T23:18:15.790

C# 允许使用指针，是及时编译的，但有时会提前编译。与我使用的许多其他语言相比，尽管它允许非常快速的软件开发，但它略低且更接近硬件，这具有很大的优势。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-06T23:01:40.760

C# 是一种非常高级的语言，比大多数脚本语言更发达。据我所知，没有中级语言之类的东西，而如今被认为是低级的语言几乎是任何形式的汇编或二进制代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-07T00:45:14.207

20 年后人们可能不会认为它是一种高级语言，但目前它确实是。这一切都与您的比较基础有关。与汇编程序相比，它是一种非常高级的语言。与为您编写代码的假设计算机程序（如 Brian 所说的 5GL）相比，我想它不是。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-06T23:00:05.193

嗯，是的，它是一种高级语言。您可以删除主观标签。没有什么主观的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-01-05T10:45:31.063

C# 也是一种非常“灵活”的语言。如果“低级编程”是指指针操作，那么你可以在 C# 中做同样的事情。
对于想要做“低级”工作的人，C# 允许你这样做。但是如果你不想进入“低级”的东西，你可以做同样的事情而不用担心`unsafe`关键字。许多新手甚至不知道编译 C# 代码的 /unsafe 选项。
根据维基百科：-

`C# is intended to be suitable for writing applications for both hosted and embedded systems, ranging from the very large that use sophisticated operating systems, down to the very small having dedicated functions.`

我认为上述陈述几乎总结了 C# 是“高级”还是“低”级语言。

# android - 在有根手机上安装失败

> ID：620779
> 
> 赞同：4
> 
> 时间：2009-03-06T22:55:55.857
> 
> 标签：android, mobile

谁能告诉我从市场下载应用程序与从我的网络服务器下载应用程序时如何将应用程序交付和安装到 Android G1 手机的区别？

这个小测试应用程序：

[http://yootles.com/outbox/TallyBee.apk](http://yootles.com/outbox/TallyBee.apk)（保持简单计数）

安装在我的（未破解的）G1 上，但无法安装在两个朋友的（被黑的）G1 上，当他们从我这里下载时——它认为该软件包与/想要覆盖 Android 系统冲突——但下载时安装良好（相同的.apk）来自市场。

*   使用 adb 将 .apk 推送到手机没有问题。
*   是的，他们都将手机设置为在应用程序设置中允许“未知来源”。
*   我想从我的服务器上进行安装以加快测试速度。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T11:00:42.660

如果没有在我自己的 G1 上安装这个 apk（我不想这样做），你应该确认你的朋友已经`Settings > Applications > Unknown sources`勾选了。否则，他们将无法安装非来自市场的应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-08T21:12:13.737

您遇到了一个奇怪的 android 签名错误。如果您尝试重新安装手机上已存在的应用程序，则必须使用相同的密钥对其进行签名。如果您安装使用不同密钥签名的相同应用程序，它将首先删除该应用程序，然后重新安装失败，从而给您一个无用的错误。有关在此处签名的更多信息 ( [http://developer.android.com/guide/publishing/app-signing.html](http://developer.android.com/guide/publishing/app-signing.html) )，但如果安装了它，那么您可能已经了解了签名系统。

解决方案是从市场（或他们最初获得它的任何地方）重新安装应用程序，然后通过应用程序管理器将其删除。删除后，他们应该能够从您的网络服务器下载新版本。（另外，请确保上面帖子中提到的设置被勾选）

# php - 您如何编码撇号以便在 mysql 中可搜索？

> ID：620783
> 
> 赞同：2
> 
> 时间：2009-03-06T22:56:51.770
> 
> 标签：php, mysql

我认为这不是最明确的问题，但一个例子应该让它更清楚一点。

我有一张表，里面装满了电影名称，其中一些包含撇号。我有一个用于查找电影的搜索框。

如果我通过执行搜索

```
mov_title = '$search_keywords' 
```

一切正常，但是这种方法不会为部分搜索产生任何结果，所以我必须使用它

```
mov_title LIKE '%$search_keywords%' 
```

此方法适用于 A-Za-z0-9 的标题，但如果标题有撇号，即使我进行完全匹配，它也无法找到电影。

在将标题存储在数据库中之前，我将它们通过以下方式：

```
$search_keywords = htmlspecialchars(mysql_escape_string($_GET["search_keywords"])); 
```

所以在数据库中，每个单引号前都有一个正斜杠。

将电影标题与撇号匹配的唯一方法是在搜索框中的撇号前面物理上放置一个正斜杠。

这似乎微不足道，我确信解决方案非常明显，但我只是没有看到它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T22:59:07.177

使用`mysql_real_escape_string()`，不要使用`htmlspecialchars()`。后者不是用于数据库转义，而是用于 HTML 生产。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T23:01:45.313

这只是因为您在进行输出之前转义了 html 输出的数据！您应该只在执行输出*之前*执行此操作，即：

```
<li><?php echo htmlspecialchars($some_var); ?></li>
```

取消转义数据库中的值并将应用程序更改为仅在输出时转义。`htmlspecialchars(mysql_real_escape_string())`你目前除了在 $search_string 上做之外别无他法。

即使在插入数据库时​​对 HTML 进行转义是有意义的，`mysql_real_escape_string()`也将是外部函数而不是内部函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T00:35:16.197

如果您希望保持数据库完整，您可以在构建查询之前对您要查找的任何搜索词运行 htmlspecialchars() 函数。虽然我建议将数据完全按原样放入数据库中，（但使用 mysql_real_escape_string() 对其进行转义以阻止 sql 注入尝试）。然后在将数据打印到浏览器时使用 htmlspecialchars()。

# sql - 一个困难的 SQL 查询：具有复杂关联的模型的标签流行度

> ID：620788
> 
> 赞同：1
> 
> 时间：2009-03-06T22:58:08.893
> 
> 标签：sql, tags

我什至不确定这是否可以有效地完成，但这是我的问题：

我正在编写本质上是一个博客引擎的东西，其中可以标记博客文章和对每个博客文章的所有回复。

所以，我可以有一个标记为“堆栈”的博客文章，以及对该文章的回复标记为“溢出”。

现在，当用户在我的应用程序中点击一个特殊页面时，我正在尝试生成一个最受欢迎的标签列表。它不仅应该返回按博客文章数量降序排列的 n 个最受欢迎的标签，还应该返回与每个标签关联的博客文章的数量，**即使该文章中的回复而不是文章本身带有该标签**。

因此，如果 BlogPost A 被标记为“foo”，并且 BlogPost B 中的回复被标记为“foo”，那么流行的标签摘要应该将其计为总共两篇博客文章，即使 BlogPost B 在技术上没有被标记。

以下是可能相关的表/字段的描述：

```
BlogPosts
| id     # Primary key for all tables, Rails-style

BlogComments
| id
| blog_post_id

Tags
| id
| name   # 'foo'

Taggings
| id
| tag_id
| blog_post_id
| blog_comment_id 
```

为了方便起见，标记中有一些非规范化。如果有人标记 BlogPost，它会填写 blog_post_id 字段，并且 blog_comment_id 保持为 NULL。如果有人标记了对帖子的评论，它会同时填写 blog_post_id 和 blog_comment_id。

有没有办法在一个或几个 SQL 查询中返回最流行标签的排序列表？我在想我可能需要在 cron 作业上每隔几分钟运行一个计算量很大的脚本并渲染缓存的输出，而不是每次有人点击页面时都运行它......

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T23:10:39.940

到目前为止，我认为您的请求没有任何复杂之处：

```
SELECT
  tag_id,
  COUNT(blog_post_id) + COUNT(blog_comment_id) tag_count
FROM
  Taggings
GROUP BY
  tag_id
ORDER BY
  COUNT(blog_post_id) + COUNT(blog_comment_id) DESC 
```

如果您只想计算“受影响的博客文章”，我认为是这样的：

```
SELECT
  t.id    tag_id,
  t.name  tag_name,
  COUNT(DISTINCT COALESCE(x.blog_post_id, c.blog_post_id)) tag_count
FROM
  Tags                    t  
  INNER JOIN Taggings     x ON x.tag_id = t.id
  LEFT  JOIN BlogComments c ON c.id     = x.blog_comment_id
GROUP BY
  t.id,
  t.name
ORDER BY
  COUNT(DISTINCT COALESCE(x.blog_post_id, c.blog_post_id)) DESC 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T23:11:00.360

我可能遗漏了一些明显的东西，但是由于您有“如果有人标记了对帖子的评论，它会同时填写 blog_post_id 和 blog_comment_id”，因此下面的 sql 应该可以解决问题。*我在这里假设这里的 Tags.name 将是唯一的。*

```
SELECT MIN(ts.tag_id), t.name, COUNT(ts.blog_post_id) as rank
FROM Taggings ts
    INNER JOIN Tags t ON ts.tag_id = t.id
GROUP BY t.name
ORDER BY COUNT(ts.blog_post_id) DESC 
```

希望这就是你要找的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T23:21:18.417

我没有尝试过，但是这样的事情呢？：

```
select t.Id, 
    t.Name, 
    count(*)

from Taggings tings
inner join Tags t
    on (t.id = tings.blog_post_id or t.id = tings.blog_comment_id)

group by t.Id, t.Name
order by count(*) desc 
```

# php - 如何在不使用 HTML POST 方法的情况下将数据从 html 表单插入数据库？

> ID：620793
> 
> 赞同：0
> 
> 时间：2009-03-06T22:59:10.920
> 
> 标签：php, html, database

您好我想知道是否有任何其他方式使用 javascript 或其他方式将用户输入直接输入到数据库而不使用 POST 方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T23:07:06.237

如果您想要的结果是 javascript 本身连接到数据库并运行查询，那么我相信答案是否定的。但是，这是您*永远*不想做的事情，因为这意味着用户将拥有对数据库的完全访问权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T23:04:46.430

有几个 HTTP 命令：

```
GET POST PUT DELETE HEAD CONNECT TRACE 
```

唯一会*根据规范执行您想要的操作的*是 PUT 和 POST。

您不应该使用 GET 将数据发送回服务器进行存储。因此，如果您不想使用 POST，请使用 PUT。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:18:52.153

使用 jQuery、原型或 dojo 使用 Ajax 调用有什么问题。

另一种选择是使用闪光灯或silverlight并调用网络服务

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T23:00:27.563

是的，使用 GET 方法。通过 HTTP，这些是您的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T23:05:40.297

如果该页面是从可以访问数据库的机器上查看的，那么您可以要求 javascript 创建一个 ADO activex 对象的实例（没有人记得那些吗？我在显示我的年龄）然后您的 js 代码可以说话直接进入数据库。同样，这仅适用于可以直接访问数据库的机器（本地机器/网络）。

# c++ - c++ 中的函数范围异常处理 - 这是一种不好的风格吗？

> ID：620795
> 
> 赞同：6
> 
> 时间：2009-03-06T22:59:24.400
> 
> 标签：c++, exception, coding-style

关于函数有一个 try-catch 的东西，我认为有时它可能非常有用：

```
bool function() 
try
{
    //do something
}
catch(exception_type & t)
{
   //do something
} 
```

所以问题的第一部分：这种风格在一般情况下被认为是不好的吗？

我在以下具体示例中使用了这种方法：

我们的项目中有很多 c 和 c++ 代码。我们有自定义异常类型（不是 std::exception 派生的）。我需要集成 XML 库并将所有异常转换为我们的类型。因此，基本上，最后一步是从 XML 库中捕获所有异常并进行转换。

之前的功能：

```
bool readEntity(...)
{
   while(...)
   { 
      if(...)
      {
         //lot's of code...
      }
   }
} 
```

后：

```
bool readEntity(...)
try
{
   while(...)
   { 
      if(...)
      {
         //lot's of code...
      }
   }
}
catch(XMLBaseException & ex)
{
    //create our exception and throw
} 
```

我的想法是这样的：我清楚地表明我打算将所有从一种类型派生的异常转换为自定义类型，并且我们保持屏幕没有水平滚动条（因为水平滚动条不好）。

好吧，我实际上因为这种方法而受到批评，就像在代码审查期间不清晰的方法一样。

所以我想听听你的想法。

**更新**：只是要明确一点：重构函数不是一种选择。实际上它写得很好。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-06T23:05:08.630

实际上，函数级尝试块的唯一原因是构造函数，否则它是一个有点晦涩的功能，不会给你带来太多好处。这样做也很容易：

```
bool readEntity(...)
{
   try
   {
      while(...)
      { 
         if(...)
         {
            //lot's of code...
         }
      }
   }
   catch(XMLBaseException & ex)
   {
       //create our exception and throw
   }
} 
```

如果您在水平滚动时遇到问题，那么要做的就是拆分您的代码。try/catch 很复杂，这应该在嵌套级别表示，而不是隐藏。

在构造函数中，这是一个不同的问题：没有其他方法可以在初始化列表中捕获异常：

```
SomeClass::SomeClass(parameter p1, parameter p2) : Member1(p1), Member2(p2)
try
{ 
}
catch(Exception &ex)
{
    // handle and rethrow
} 
```

当然，如果你在构造过程中遇到异常，除了 log 和 rethrow 之外，你不可能做太多恢复（无论如何在构造函数的情况下它都会被重新抛出）。您的对象尚未完全构建，您无法真正用它做任何事情。您唯一可以相信有效的是参数（尽管如果初始化失败，那很可能是由于参数错误）。

有关此问题的讨论，请参阅此[GOTW 。](http://www.gotw.ca/gotw/066.htm)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T23:08:25.063

需要明确一点：重新抛出和重新打包异常并不是一个糟糕的做法，这是一件好事，因为它最大限度地减少了外部依赖项的暴露。

但是，函数级别的 try-catch 旨在用于构造函数初始化。在代码中保存几个水平空格不值得使用相对晦涩的语言功能。如果你真的缩进那么远，最好重构嵌套代码！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:17:32.373

[在Herb Sutters GotW 网站上](http://www.gotw.ca/gotw/066.htm)有一个关于构造函数/函数尝试块的一般无用的很好的讨论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T23:09:51.050

该函数应该返回一个布尔值，因此您可以返回一个真或假，但如果该函数失败并且布尔值用于成功标志以外的其他东西（除非纯c，否则这是不好的做法）它应该抛出以向调用者发出信号它没有用。

# ruby-on-rails - Rails：使用 Paperclip、S3 和 RMagick 进行图像裁剪

> ID：620809
> 
> 赞同：3
> 
> 时间：2009-03-06T23:03:27.277
> 
> 标签：ruby-on-rails, ruby, amazon-s3, paperclip

我目前正在尝试编写一个类似于互联网上其他系统的自定义图像裁剪系统，用户可以在其中选择一个裁剪区域，然后相应地裁剪他们的图像。该应用程序位于 Rails 中，我们使用带有 Amazon S3 的 Paperclip 来存储文件。尽管让 RMagick 从 S3 适当地裁剪文件，但我遇到了很多麻烦。这是当前代码（不起作用）：

```
 if params[:width].to_i > 0 and params[:height].to_i > 0 then
      photo = Photo.find(params[:id])
      image_data = Net::HTTP.get_response(URI.parse(photo.photo.url(:big))).body
      orig_img = Magick::ImageList.new
      orig_img.from_blob(image_data)

      args = [params[:x1].to_i, params[:y1].to_i, params[:width].to_i, params[:height].to_i]
      orig_img.crop!(*args)
      photo.update_attributes({:photo => orig_img.to_blob})

      photo.photo.reprocess!
      photo.save
    end 
```

主要问题是裁剪后的图像没有通过回形针上传回 S3，因此没有正确裁剪。以前有人用回形针尝试过这样的事情吗？这甚至不可能，但任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T20:56:38.477

我暂时能够解决这个问题如下：

```
 photo = Photo.find(params[:id])
  image_data = Net::HTTP.get_response(URI.parse(photo.photo.url(:big))).body
  orig_img = Magick::ImageList.new
  orig_img.from_blob(image_data)

  args = [params[:x1].to_i, params[:y1].to_i, params[:width].to_i, params[:height].to_i]
  orig_img.crop!(*args)

  tmp_img = Tempfile.new("image_data")
  orig_img.format = "png"
  tmp_img.write(orig_img.to_blob)
  photo.photo = tmp_img
  tmp_img.close

  photo.photo.reprocess!
  photo.save 
```

这里主要关注的是创建新临时文件的速度，因此可能我们必须创建自己的自定义界面。希望这可以成为人们解决类似问题的良好起点。

编辑：请注意，Tempfile 是回形针库的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T23:40:14.067

您可以在模型上定义一些 attr_accessors 并在创建实际文件之前在控制器操作中设置它们。下面应该工作..

```
class Poodle < ActiveRecord::Base
  has_attached_file :avatar, :styles => Proc.new{|a| a.instance.get_styles}
  attr_accessor :width, :height

  def get_styles(style = "medium")
    return {style.to_sym => [self.width, self.height].join("x") + ">" }
  end
 end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T20:00:00.727

您可能想仔细看看[Paperclip 处理器](http://dev.thoughtbot.com/paperclip/classes/Paperclip/Processor.html)。

实际上，我自己的代码中也有同样的问题，并且在我的待办事项列表中有这个问题。

# java - 在检查条件时摆脱代码中嵌套 if 的最佳方法是什么？

> ID：620810
> 
> 赞同：3
> 
> 时间：2009-03-06T23:03:43.360
> 
> 标签：java, design-patterns, blackberry

我正在用 Java 开发一个 BlackBerry 应用程序，并且我有一个 Options 类，其中存储了所有用户设置。问题是我需要检查一些条件才能知道如何做出反应。随着我不断添加更多功能，向用户显示更多 GUI 选项，更多设置存储在 Options 类中，需要检查更多条件。

以下面的代码为例：

```
private void doCallMonitoring(int callId){
    /*This is the part that I want to avoid. Having
      multiple nested ifs. Here's just two conditions
      but as I add more, it will get unmantainable
      very quickly.*/
    if(Options.isActive().booleanValue()){
        callTime = new Timer();
        TimerTask callTimeTask = new TimerTask(){
            public void run(){
                callTimeSeconds++;
        if((callTimeSeconds == Options.getSoftLimit().intValue()) && (Phone.getActiveCall().getStatus() == PhoneCall.STATUS_CONNECTED)){
                    injectDTMFTone(Phone.getActiveCall());
        }else if((callTimeSeconds >= Options.getHardLimit().intValue()) && (Phone.getActiveCall().getStatus() == PhoneCall.STATUS_CONNECTED)){
                    injectEndCall();
                }
             }
        };     
        callTime.schedule(callTimeTask, 0,1000);
    }else{
    System.out.println("Service not active");
    }
} 
```

我希望它如何工作是通过一次调用来验证所有选项，并从那里确定行动的诅咒。我怎样才能实现这样的设计？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T23:26:47.047

另一种选择是制作方法，例如`injectDMTFTone()`检查他们是否要处理该条件，并根据是否已处理返回真或假。

例如：

```
public void run() {
    callTimeSeconds++;
    do {
        if (handleInjectDMTFTone())
            break;
        if (handleInjectEndCall())
            break;
    } while(false);

    callTime.schedule(callTimeTask, 0,1000);
}

boolean handleInjectDMTFTone() {
    if ((callTimeSeconds != Options.getSoftLimit().intValue()) ||
        (Phone.getActiveCall().getStatus() != PhoneCall.STATUS_CONNECTED))
        return false;

    injectDTMFTone(Phone.getActiveCall());
    return true;
}

boolean handleInjectEndCall() {

    if ((callTimeSeconds < Options.getHardLimit().intValue()) ||
        (Phone.getActiveCall().getStatus() != PhoneCall.STATUS_CONNECTED))
        return false;

    injectEndCall();
    return true;
} 
```

当然，您只需在这些方法中内联该逻辑，而不是调用另一个`injectDMTFTone()`方法或方法。`injectEndCall()`通过这种方式，您将如何以及何时处理这些条件的所有逻辑组合在同一个地方。

这是我最喜欢的模式之一；尽可能使用`if`靠近方法顶部的语句来消除条件并返回。该方法的其余部分没有缩进很多级别，并且易于阅读。

您可以通过创建所有实现相同接口并位于处理程序存储库中的对象来进一步扩展它，您的`run`方法可以迭代这些处理程序以查看哪个将处理它。这对您的情况可能会也可能不会过分杀伤力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T23:10:53.873

您可以使用“提取方法”重构并将所有这些检查变成一个“可读”条件。

看到这个相关的[答案](https://stackoverflow.com/questions/360063/is-there-an-alternative-to-hyper-indented-code/360251#360251)有点冗长，但关键是要替换这样的结构：

```
 }else if((callTimeSeconds >= Options.getHardLimit().intValue()) && (Phone.getActiveCall().getStatus() == PhoneCall.STATUS_CONNECTED)){
                injectEndCall();
            }
         } 
```

对于这样的事情：

```
 ....
       }else if(shouldInjectEndCall() ){
                injectEndCall();
            }
         }
       ... 
```

请记住，对象确实具有状态，并且可能使用其他对象来帮助它们完成工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:26:01.980

其他选择是做某种“用多态性替换条件”。

尽管看起来只是编写更多代码，但您可以用“验证器”对象替换所有这些规则，并将所有验证放在某个数组中并循环它们。

像这样的临时代码。

```
 private void doCallMonitoring(int callId){
     // Iterate the valiators and take action if needed. 

      for( Validation validation : validationRules ) { 
          if( validation.succeed() ) { 
              validation.takeAction();
          }
      }
   } 
```

你像这样实现它们：

```
abstract class Validation { 

      public boolean suceed();
      public void takeAction();
}

class InjectDTMFToneValidation extends Validation { 
    public boolean suceed() { 
        return (callTimeSeconds == Options.getSoftLimit().intValue()) 
               && (Phone.getActiveCall().getStatus() == PhoneCall.STATUS_CONNECTED)
     }
     public void takeAction() { 
         injectDTMFTone(Phone.getActiveCall());
     }
}

class InjectEndCallValidation extends Validation { 
    public boolean suceed() { 
        return (callTimeSeconds >= Options.getHardLimit().intValue()) 
                && (Phone.getActiveCall().getStatus() == PhoneCall.STATUS_CONNECTED)
     }
     public void takeAction() { 
         injectEndCall();
     }
} 
```

最后将它们安装在列表中：

```
private List<Validation> validationRules = new ArrayList<Validation>();{
   validationrules.add( new InjectDTMFToneValidation() );
   validationrules.add( new InjectEndCallValidation () );
   ...
   ...
} 
```

这里的想法是将逻辑移动到子类。当然，您将获得更好的结构，并且可能会*成功*，并且*takeAction*可以被替换为其他更有意义的方法，目的是从它所在的位置提取验证。

 *变得更抽象了？.. 是的。

顺便说一句，我为什么要使用 Options 和 Phone 类来调用它们的静态方法而不是使用实例？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T00:19:26.453

所有这些答案可能都是更好的面向对象的答案。这一次，我将寻求快速而肮脏的答案。

我真的很喜欢通过反转它们来简化复杂的嵌套 if。

```
if(!Options.isActive().booleanValue()) {
    System.out.println("Service not active");
    return;
}
the rest... 
```

我知道有些人不喜欢中间方法返回，但是当您验证对我来说一直是一个很棒的模式的进入条件时，我从不后悔使用它。

它确实简化了您的方法的外观。

如果你编写的方法比屏幕长，不要这样做或写一个大的注释指出它——太容易丢失返回语句而忘记你做了。更好的是，不要编写比屏幕更长的方法。

# c# - 在 C# 中使用枚举作为状态返回的状态指示器

> ID：620822
> 
> 赞同：3
> 
> 时间：2009-03-06T23:05:54.103
> 
> 标签：c#, design-patterns, enums

只是想知道关于从指示状态的方法返回枚举的普遍共识是什么。返回代码（整数）的概念在老式系统编程（C）中是天生的，但我想知道指示状态的方法是否已经改变。

谢谢

**编辑：**我知道枚举基本上是 int 值。我正在询问让方法开始抛出状态代码（无论是枚举还是整数）以完全指示状态的纯粹做法。这似乎是一个很好的做法，但我想知道这个想法是否有任何负面情绪。

我总是会选择一个枚举而不是一个状态码的 int 返回。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T23:12:34.587

如果您返回枚举以指示错误而不是抛出异常，那么您当然处于犯罪状态。

调用者真的对某事的状态感兴趣吗？我通常在 C 风格的函数库中发现这种东西，其中没有对象来表示状态。这取决于您要做什么，但是如果您（比如说）创建代码来管理通信套接字，我强烈建议将它们包装在类中并允许客户端代码通过属性而不是作为结果来检测它们的状态打开（）方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T23:09:07.230

如果您想要的只是返回的状态，那么 enum 是一种比 int 更好的方法，原因有很多，它强制一致意味着什么，因此您不必记住返回码 1 的含义，使您的代码更易于维护。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:09:14.843

由于枚举基本上只是一个 int，因此它可以正常工作。您将获得智能感知的额外奖励。

那是假设您想要函数调用的状态。如果您正在寻找系统/整体状态，您可能希望将其公开为事件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T23:13:33.647

返回原始整数（用于状态和类似的东西）甚至不通过常量隐藏它们的数字性质（或者如果语言不支持真正的常量，那么按照约定将变量视为常量）是一种非常糟糕的做法，即使在旧的像 C 这样的学校语言。它是许多错误和无休止的头痛的根源。

此外，C# 风格的枚举提供了（某些）类型安全性，并为各种错误和错误腾出了更少的空间。你绝对应该使用它们。因此，这确实是对返回整数然后将其与整数常量进行比较的改进。如果语言提供了有用的特性，为什么不使用它呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T23:18:27.457

只是在这里大声思考，但为什么不只返回一个对象（类），类型取决于您需要如何使用它。例如，一个类可能只包含一个消息字符串，而另一个类可能包含许多记录更新的整数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T05:04:49.137

Pontus Gagge 说得对：将您的方法包装在一个类中并通过属性公开状态。

另外，请记住使用枚举的危险：您可以将任何整数转换为任何枚举。这将编译并运行得很好：

```
public enum Status
{
    Good,
    Bad,
    Indifferent
};

public class Program
{
    static void Main(string[] args)
    {
        Status s = (Status) 30;
    }
} 
```

假设枚举类型的变量包含可能值之一基本上是不安全的；它可能包含一个不可能的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-05T18:56:45.593

我一直在考虑这个（并使用了一点点），我发现只返回一个布尔值、一个整数或一直到过度创建一个类来返回状态和一些与之相关的值会更有帮助状态，我真的觉得返回一个**简单的枚举**很实用：我的代码似乎更具可读性，而且我没有异常的所有负担，因为正如我所读到的：**异常应该是异常**的=)

# asp.net - asp:UpdatePanel / 自定义控件 / RegisterClientScriptResource

> ID：620823
> 
> 赞同：0
> 
> 时间：2009-03-06T23:06:47.517
> 
> 标签：asp.net, asp.net-ajax

我已经构建了一个包含少量 JavaScript 的自定义控件。JS 作为嵌入式资源进行维护。当我的控件被渲染时，我将它添加到页面中，如下所示：

```
Page.ClientScript.RegisterClientScriptResource(
    GetType(), "Resources.MyControl.js"); 
```

该控件工作得很好，但是当它在更新面板中呈现时，我猜测 JS 资源正在被添加到页面对象中，而该页面对象没有被发送回客户端（只有更新面板中的内容才会使它返回给客户端。）

我可以将 JS 添加到我的应用程序库中，以解决在初始页面请求开始时加载的问题。还有其他修复吗？从更新面板中使用 RegisterClientScriptResource 的任何方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T00:09:53.980

在这里或多或少地找到了答案：

[http://forums.asp.net/p/1040033/1445844.aspx](http://forums.asp.net/p/1040033/1445844.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T00:12:25.893

您必须在页面 ScriptManager 中注册您的脚本才能在更新面板中工作。

幸运的是，您不需要在页面上找到 scriptmanager 的实例，因为有一个方便的静态类，只需添加：

```
 ScriptManager.RegisterClientScriptResource(this.GetType(), "Resources.MyControl.js"); 
```

由您控制，您已设置好。

# ruby-on-rails - 你如何测试不是模型或控制器的代码

> ID：620829
> 
> 赞同：3
> 
> 时间：2009-03-06T23:09:48.447
> 
> 标签：ruby-on-rails, ruby, unit-testing, testing

我在我的 Rails 项目目录的文件中定义了一个类`lib`，它将实现一堆实用程序函数作为类方法。我想使用 Test::Unit 针对这些方法编写测试，并将它们作为项目常规测试例程的一部分运行。

我尝试将文件粘贴在目录的顶层`test`...

```
require 'test_helper'

class UtilsTest < ActiveSupport::TestCase
  should 'be true' do
    assert false
  end
end 
```

...但这没有用。测试没有运行。

测试不是 Rails 常规部分之一的代码的正常方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T23:14:55.093

我只是把它们放在测试/单元中。我不确定这是否是“正确”的方法，但它似乎对我有用......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T23:31:05.353

您可以将它们放在您的单位目录中，而不会有任何复杂性。

我的图书馆：

```
[ cpm juno ~/apps/feedback ] cat lib/my_library.rb
class MyLib
  def look_at_me
    puts "I DO WEIRD STUFF"
  end
end 
```

我的测试：

```
[ cpm juno ~/apps/feedback ] cat test/unit/fake_test.rb
require 'test_helper'

class FakeTest < ActiveSupport::TestCase
  # Replace this with your real tests.
  def test_truth
    require 'my_library'

    puts "RUNNING THIS NOW"
    MyLib.new.look_at_me
    assert true
  end
end 
```

并运行它：

```
[ cpm juno ~/apps/feedback ] rake test:units
(in /home/cpm/apps/feedback)
/usr/bin/ruby1.8 -Ilib:test "/usr/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake/rake_test_loader.rb" "test/unit/fake_test.rb"
Loaded suite /usr/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake/rake_test_loader
Started
RUNNING THIS NOW
I DO WEIRD STUFF
.
Finished in 0.254404 seconds.

1 tests, 1 assertions, 0 failures, 0 errors
Loaded suite /var/lib/gems/1.8/bin/rake
Started

Finished in 0.00094 seconds.

0 tests, 0 assertions, 0 failures, 0 errors 
```

只要它以 _test.rb 结尾，它就应该把它捡起来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T19:31:50.637

这是测试助手功能的 test\functional\application_helper_test.rb 示例

```
require File.dirname(__FILE__) + '/../test_helper'

require 'application_helper'

class HelperTest < Test::Unit::TestCase
    include ApplicationHelper

    def test_clear_search_string
        assert_equal 'Park Ave', clear_search_string('street Park Ave')
    end
end 
```

# macos - 如何隐藏 Dock 图标

> ID：620841
> 
> 赞同：83
> 
> 时间：2009-03-06T23:15:38.837
> 
> 标签：macos, cocoa, icons, dock, lsuielement

我想优先隐藏 Dock 图标并显示`NSStatusItem`. 我可以创建 StatusItem 但我不知道如何从 Dock 中删除图标。：-/

有任何想法吗？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-03-07T00:09:22.843

我想你正在寻找`LSUIElement`Info.plist

> LSUIElement（字符串）。如果此键设置为“1”，则启动服务将应用程序作为代理应用程序运行。座席应用程序不会出现在 Dock 或强制退出窗口中。尽管它们通常作为后台应用程序运行，但如果需要，它们可以到前台呈现用户界面。

[在此处查看](http://www.cocoabuilder.com/archive/message/cocoa/2009/2/3/229461)有关打开/关闭它的简短讨论

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2012-02-10T00:01:56.437

您可以使用所谓的激活策略：

### Objective-C

```
// The application is an ordinary app that appears in the Dock and may
// have a user interface.
[NSApp setActivationPolicy: NSApplicationActivationPolicyRegular];

// The application does not appear in the Dock and does not have a menu
// bar, but it may be activated programmatically or by clicking on one
// of its windows.
[NSApp setActivationPolicy: NSApplicationActivationPolicyAccessory];

// The application does not appear in the Dock and may not create
// windows or be activated.
[NSApp setActivationPolicy: NSApplicationActivationPolicyProhibited]; 
```

### 斯威夫特 4

```
// The application is an ordinary app that appears in the Dock and may
// have a user interface.
NSApp.setActivationPolicy(.regular)

// The application does not appear in the Dock and does not have a menu
// bar, but it may be activated programmatically or by clicking on one
// of its windows.
NSApp.setActivationPolicy(.accessory)

// The application does not appear in the Dock and may not create
// windows or be activated.
NSApp.setActivationPolicy(.prohibited) 
```

这应该隐藏停靠图标。

### 也可以看看

*   启发这个答案的答案：[如何创建一个还具有（可移动）停靠图标的帮助应用程序（LSUIElement）](https://stackoverflow.com/a/5384319/133374)
*   [的文档`NSRunningApplicationActivationPolicy`](https://developer.apple.com/documentation/appkit/nsapplication/activationpolicy)。
*   一个相关问题：[“在没有停靠图标的 Mac OS X 中启动 GUI 进程”](https://stackoverflow.com/q/6796028/3939277)。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2011-01-14T00:11:14.950

要做到这一点，同时遵守 Apple 不修改应用程序包的准则，并保证 Mac App Store 应用程序/（Lion 应用程序？）的签名不会被 info.plist 修改破坏，您可以将 LSUIElement 默认设置为 1，然后当应用程序启动：

```
ProcessSerialNumber psn = { 0, kCurrentProcess };
TransformProcessType(&psn, kProcessTransformToForegroundApplication); 
```

显示它的停靠图标，或者如果用户选择不想要该图标，则绕过它。

只有一个副作用，应用程序的菜单在失去并重新获得焦点之前不会显示。

资料来源：[制作复选框打开和关闭 Dock 图标](https://stackoverflow.com/questions/1082374/making-a-checkbox-toggle-the-dock-icon-on-and-off)

就我个人而言，我不喜欢设置任何 Info.plist 选项并使用`TransformProcessType(&psn, kProcessTransformToForegroundApplication)`或`TransformProcessType(&psn, kProcessTransformToUIElementApplication)`基于用户设置。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2011-05-24T12:28:57.053

在 Xcode 中显示为“Application is agent (UIElement)”，它是布尔值。

在您的 Info.plist 控件中单击空白区域并从菜单中选择“添加行”类型“应用程序是代理（UIElement）”将其设置为 YES。

为了使其可选，我在我的代码中添加了以下行（感谢 Valexa！）

```
 // hide/display dock icon
if (![[NSUserDefaults  standardUserDefaults] boolForKey:@"hideDockIcon"]) {
    //hide icon on Dock
    ProcessSerialNumber psn = { 0, kCurrentProcess };
    TransformProcessType(&psn, kProcessTransformToForegroundApplication);
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-10-09T16:58:05.240

Swift 更新：（上面已经介绍了两种使用方式，它们的结果相同）

```
public class func toggleDockIcon_Way1(showIcon state: Bool) -> Bool {
    // Get transform state.
    var transformState: ProcessApplicationTransformState
    if state {
        transformState = ProcessApplicationTransformState(kProcessTransformToForegroundApplication)
    }
    else {
        transformState = ProcessApplicationTransformState(kProcessTransformToUIElementApplication)
    }

    // Show / hide dock icon.
    var psn = ProcessSerialNumber(highLongOfPSN: 0, lowLongOfPSN: UInt32(kCurrentProcess))
    let transformStatus: OSStatus = TransformProcessType(&psn, transformState)
    return transformStatus == 0
}

public class func toggleDockIcon_Way2(showIcon state: Bool) -> Bool {
    var result: Bool
    if state {
        result = NSApp.setActivationPolicy(NSApplicationActivationPolicy.Regular)
    }
    else {
        result = NSApp.setActivationPolicy(NSApplicationActivationPolicy.Accessory)
    }
    return result
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-10T13:05:51.157

如果你想让它成为用户偏好，那么你不能使用 UIElement。UIElement 位于应用程序包中，您不应编辑应用程序包中的任何文件，因为这将使包签名无效。

我发现的最佳解决方案是基于[这篇优秀的文章](http://codesorcery.net/2008/02/06/feature-requests-versus-the-right-way-to-do-it)。我的解决方案基于 Dan 的评论。简而言之，Cocoa 无法做到这一点，但只需一点点 Carbon 代码就可以做到。

该文章还建议制作一个专门处理停靠图标的辅助应用程序。然后主应用程序会根据用户的偏好启动并终止该应用程序。这种方法让我觉得比使用 Carbon 代码更健壮，但我还没有尝试过。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-06-20T15:24:52.410

在尝试了不同的变体后，我仍然遇到如下所示的问题：

1.  **启用**Dock 中的应用程序图标后（设置后），应用程序菜单**不可点击**。您需要先切换到其他应用程序（例如 Finder.app），然后再切换回您的应用程序以使应用程序菜单按预期工作。**`NSApplication.ActivationPolicy.regular`**
***   应用程序窗口在 Dock 中的应用程序图标被**禁用**后（设置后）**后退/隐藏**。您需要启动“任务控制”以显示应用程序窗口。**`NSApplication.ActivationPolicy.accessory`****

 ****为了解决上述问题，我做了一个扩展：

```
import AppKit

extension NSApplication {
   public enum Dock {
   }
}

extension NSApplication.Dock {

   public enum MenuBarVisibiityRefreshMenthod: Int {
      case viaMenuVisibilityToggle, viaSystemAppActivation
   }

   public static func refreshMenuBarVisibiity(method: MenuBarVisibiityRefreshMenthod) {
      switch method {
      case .viaMenuVisibilityToggle:
         DispatchQueue.main.async { // Async call not reaaly needed. But intuition tells to leave it.
            // See: cocoa - Hiding the dock icon without hiding the menu bar - Stack Overflow: https://stackoverflow.com/questions/23313571/hiding-the-dock-icon-without-hiding-the-menu-bar
            NSMenu.setMenuBarVisible(false)
            DispatchQueue.main.asyncAfter(deadline: .now() + 0.1) { // Without delay windows were not always been brought to front.
               NSMenu.setMenuBarVisible(true)
               NSRunningApplication.current.activate(options: [.activateAllWindows, .activateIgnoringOtherApps])
            }
         }
      case .viaSystemAppActivation:
         DispatchQueue.main.async { // Async call not reaaly needed. But intuition tells to leave it.
            if let dockApp = NSRunningApplication.runningApplications(withBundleIdentifier: "com.apple.dock").first {
               dockApp.activate(options: [])
            } else if let finderApp = NSRunningApplication.runningApplications(withBundleIdentifier: "com.apple.finder").first {
               finderApp.activate(options: [])
            } else {
               assertionFailure("Neither Dock.app not Finder.app is found in system.")
            }
            DispatchQueue.main.asyncAfter(deadline: .now() + 0.1) { // Without delay windows were not always been brought to front.
               NSRunningApplication.current.activate(options: [.activateAllWindows, .activateIgnoringOtherApps])
            }
         }
      }
   }

   public enum AppIconDockVisibilityUpdateMethod: Int {
      case carbon, appKit
   }

   @discardableResult
   public static func setAppIconVisibleInDock(_ shouldShow: Bool, method: AppIconDockVisibilityUpdateMethod = .appKit) -> Bool {
      switch method {
      case .appKit:
         return toggleDockIconViaAppKit(shouldShow: shouldShow)
      case .carbon:
         return toggleDockIconViaCarbon(shouldShow: shouldShow)
      }
   }

   private static func toggleDockIconViaCarbon(shouldShow state: Bool) -> Bool {
      // Get transform state.
      let transformState: ProcessApplicationTransformState
      if state {
         transformState = ProcessApplicationTransformState(kProcessTransformToForegroundApplication)
      } else {
         transformState = ProcessApplicationTransformState(kProcessTransformToUIElementApplication)
      }

      // Show / hide dock icon.
      var psn = ProcessSerialNumber(highLongOfPSN: 0, lowLongOfPSN: UInt32(kCurrentProcess))
      let transformStatus: OSStatus = TransformProcessType(&psn, transformState)
      return transformStatus == 0
   }

   private static func toggleDockIconViaAppKit(shouldShow state: Bool) -> Bool {
      let newPolicy: NSApplication.ActivationPolicy = state ? .regular : .accessory
      let result = NSApplication.shared.setActivationPolicy(newPolicy)
      return result
   }
} 
```

## 用法：

前提条件：`Info.plist`设置`LSUIElement`不存在或设置为 value `NO`。

```
 private func hideDock() {
      log.debug("Will hide app from dock.")
      let status = NSApplication.Dock.setAppIconVisibleInDock(false)
      log.debug("Status is: \(status)")
      NSApplication.Dock.refreshMenuBarVisibiity(method: .viaMenuVisibilityToggle)
   }

   private func showDock() {
      log.debug("Will show app in dock.")
      let status = NSApplication.Dock.setAppIconVisibleInDock(true)
      log.debug("Status is: \(status)")
      // The method `viaMenuVisibilityToggle` not working. Menu itens non-clickable
      NSApplication.Dock.refreshMenuBarVisibiity(method: .viaSystemAppActivation)
   } 
```

# ada - 为什么我在作业中弄错了这个项目？

> ID：620842
> 
> 赞同：2
> 
> 时间：2009-03-06T23:16:57.650
> 
> 标签：ada, scoping

我在作业中弄错了这个问题，我不知道为什么：

```
procedure Main is
    X: Integer;
    procedure Sub1 is
       X: Integer;
    begin -- of Sub1
       Put(X);
    end; -- of Sub1
    procedure Sub2 is
       X: Integer;
    begin -- of Sub2
       X:=5;
       Sub1;
    end; -- of Sub2
begin -- of Main
    X:=12;
    Sub2;
end; -- of Main 
```

问题是：假设以下 Ada 程序是使用静态范围规则编译和执行的。在 Sub1 的程序中打印 X 的什么值？如果它在动态范围规则下怎么办？

我分别得到了 12 和 5，但这被标记为不正确。为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T23:28:01.333

更仔细地逐步完成程序。Sub1 中的值来自哪里？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-03T22:09:36.053

Ada 使用静态（词法）范围规则，但即使没有，也很难看出 Sub1 中的 Put(X) 除了上面未初始化的 X 2 行之外还指的是什么。打印的值可能取决于操作系统、使用的编译器标志，甚至可能取决于一天中的时间。

更正代码后，答案（在 Mac OS X 上使用各种 GNAT）都是 0，所有这些都使用 -O2，但没有优化 GCC 4.3.3 得到 42291，GNAT GPL 2009（它是一个 64 位编译器）得到 16777216 ，对 32 位的 GNAT GPL 2009 重新编译得到 1。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:29:50.177

提示：在静态作用域下它是未初始化的。你能弄清楚为什么吗？

# c++ - 如何创建指针数组？

> ID：620843
> 
> 赞同：51
> 
> 时间：2009-03-06T23:16:59.223
> 
> 标签：c++, arrays, pointers

我正在尝试创建一个指针数组。这些指针将指向我创建的 Student 对象。我该怎么做？我现在拥有的是：

```
Student * db = new Student[5]; 
```

但是该数组中的每个元素都是学生对象，而不是指向学生对象的指针。谢谢。

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-03-06T23:18:35.540

```
Student** db = new Student*[5];
// To allocate it statically:
Student* db[5]; 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-06T23:21:16.483

```
#include <vector>
std::vector <Student *> db(5);
// in use
db[2] = & someStudent; 
```

这样做的好处是您不必担心删除分配的存储 - 向量会为您完成。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-06T23:22:38.087

指针数组被写为指针的指针：

```
Student **db = new Student*[5]; 
```

现在的问题是，您只为五个指针保留了内存。因此，您必须遍历它们以自己创建 Student 对象。

在 C++ 中，对于大多数用例来说，使用 std::vector 会更轻松。

```
std::vector<Student*> db; 
```

现在您可以使用 push_back() 来添加指向它的新指针，并使用 [] 来索引它。使用起来比**的东西更干净。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2018-03-25T02:29:09.887

```
 void main()
    {
    int *arr;
    int size;
    cout<<"Enter the size of the integer array:";
    cin>>size;
    cout<<"Creating an array of size<<size<<"\n";
        arr=new int[size];
    cout<<"Dynamic allocation of memory for memory for array arr is successful";
    delete arr;
    getch();enter code here
} 
```

# python - 为什么我在酸洗后在 Python isinstance 中出现意外行为？

> ID：620844
> 
> 赞同：7
> 
> 时间：2009-03-06T23:17:27.553
> 
> 标签：python, pickle

撇开使用[isinstance 是否有害](http://www.canonical.org/~kragen/isinstance/)，我在通过 Pickle 序列化/反序列化对象后尝试评估 isinstance 时遇到了以下难题：

```
from __future__ import with_statement
import pickle

# Simple class definition
class myclass(object):
    def __init__(self, data):
        self.data = data

# Create an instance of the class
x = myclass(100)

# Pickle the instance to a file
with open("c:\\pickletest.dat", "wb") as f:
    pickle.dump(x, f)

# Replace class with exact same definition
class myclass(object):
    def __init__(self, data):
        self.data = data

# Read an object from the pickled file
with open("c:\\pickletest.dat", "rb") as f:
    x2 = pickle.load(f)

# The class names appear to match
print x.__class__
print x2.__class__

# Uh oh, this fails...(why?)
assert isinstance(x2, x.__class__) 
```

谁能解释为什么 isinstance 在这种情况下会失败？换句话说，为什么 Python 认为这些对象属于两个不同的类？当我删除第二类定义时，`isinstance`工作正常。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T23:24:32.590

显而易见的答案，因为它不是同一类。

它是一个类似的类，但不一样。

```
class myclass(object):
    pass

x = myclass()

class myclass(object):
    pass

y = myclass()

assert id(x.__class__) == id(y.__class__) # Will fail, not the same object

x.__class__.foo = "bar"

assert y.__class__.foo == "bar" # will raise AttributeError 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T23:28:57.620

这就是 unpickler 的工作方式（site-packages/pickle.py）：

```
def find_class(self, module, name):
    # Subclasses may override this
    __import__(module)
    mod = sys.modules[module]
    klass = getattr(mod, name)
    return klass 
```

查找并实例化一个类。

所以当然，如果你用同名的类替换一个类，`klass = getattr(mod, name)`将返回新类，实例将属于新类，因此 isinstance 将失败。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T23:22:08.820

更改代码以打印`id`and`x.__class__`你`x2.__class__`会发现它们是不同的：

```
$ python foo4.py
199876736
200015248 
```

# java - 如何在 Java 中创建平铺地图？

> ID：620852
> 
> 赞同：2
> 
> 时间：2009-03-06T23:20:40.743
> 
> 标签：java, 2d, maps

所以我有一个平铺图像 tile.png 并且我正在尝试在整个窗口中创建一个平铺地图。我正在将其构建为小程序。这就是我的绘画方法的样子，但它并不有效。当我运行小程序时，大约需要 2 秒，整个屏幕都是从左到右绘制图像，而不是一次渲染所有内容。此外，它看起来像一个大 tile.png 而不是 40 个小 tile.png 实例

```
public void paint(Graphics g)
{
    Image tile=getImg("tile.png");
    int width=this.getWidth();
    int height=this.getHeight();

    int x;
    int y;
    for (x=0; x<= width; x++)
    {
        for (y=0; y<= height; y++)
        {
            g.drawImage(tile, x, y, this);
        }
    }
} 
```

顺便说一句，tile.png 文件是 10 x 10 像素，这是实际的 img：

[tile.png http://img12.imageshack.us/img12/1368/tile.png](http://img12.imageshack.us/img12/1368/tile.png)

编辑：使用下面的代码并通过改进平铺图像我修复了这个问题。这是我的新瓷砖 img，以防它帮助某人：

[![瓷砖-new.png](https://i.stack.imgur.com/pL2vF.png)](https://i.stack.imgur.com/pL2vF.png)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-06T23:22:26.713

```
 for (x=0; x<= width / tileWidth; x++)
    {
            for (y=0; y<= height / tileHeight ; y++)
            {
                    g.drawImage(tile, x * tileWidth, y * tileHeight, this);
            }
    } 
```

您需要偏移瓷砖的宽度/高度。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-06T23:39:44.863

顺便说一句，您可能会想在某个时候开始检查您的“剪辑区域”，而不是在该区域之外绘制东西。您的代码设置得很好。

你可以做的另一件事是“双缓冲”。创建一个与地图大小相同的组件，为该组件调用 getGraphics()，对这个新的图形对象进行所有绘制，然后将组件绘制到传递给您的绘制方法的真实 Graphics 对象。

这样做的好处是，您可以在点击绘制语句之前绘制整个地图，然后立即将其拍掉。

Java 中的 Google 双缓冲以获取更多信息。

# windows - 注册 DLL 有什么作用？

> ID：620858
> 
> 赞同：67
> 
> 时间：2009-03-06T23:22:12.083
> 
> 标签：windows, com, dll

我知道如何注册 dll，但我从来没有真正确定我为什么要这样做或在什么条件下必须注册 dll。有人可以解释或指出一些文件吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-06T23:27:58.527

注册 DLL 时，`DllRegisterServer`将调用 DLL 中的方法入口点。同样，`DllUnregisterServer`在取消注册 DLL 时调用。

如[本 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms682162(VS.85).aspx)中所述：

> 指示进程内服务器为此服务器模块中支持的所有类创建其注册表项。如果此函数失败，则其所有类的注册表状态是不确定的。

对于 COM DLL，您将需要实现自己的`DllRegisterServer`入口`DllUnregisterServer`点方法，这些方法会根据需要进行注册/取消注册。示例代码`DllRegisterServer`可以在[这里](http://msdn.microsoft.com/en-us/library/dd376682(VS.85).aspx)找到。

注册 DLL 的最终结果是 DLL 中组件的所有 CLSID 都在`HKEY_CLASSES_ROOT\CLSID`. 这允许`CoCreateInstance`在从另一个 DLL 或应用程序实例化 COM 对象时找到正确的服务器。

`DllUnregisterServer`将执行相反的操作，并从注册表中删除所有由`DllRegisterServer`.

更多关于的一般信息`DllRegisterServer`可以在[这里](http://msdn.microsoft.com/en-us/library/aa369359.aspx)找到。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-06T23:28:48.447

最常被称为 DLL 注册的是当它实现 COM 对象时。regsvr32 确保可以创建对象的实例。例如，当 VBScript 使用 New 或 CreateObject() 时，注册确保 COM 知道要加载什么 DLL 以创建新实例，无论是通过名称还是 CLSID。

有关（非常）简短的摘要，请参见[“外行的解释”](https://chewychong.wordpress.com/2004/08/23/layman-s-explanation-of-regscvs-regasm-regsvr32/)。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-03-07T10:06:11.097

简单看regsvr32.exe的源码

# hyperlink - 复制特定的传出链接

> ID：620863
> 
> 赞同：1
> 
> 时间：2009-03-06T23:22:57.667
> 
> 标签：hyperlink

网站上有 46 个链接：[http](http://www.math.hmc.edu/~ajb/PCMI/problem_solve.html) ://www.math.hmc.edu/~ajb/P​​CMI/problem_solve.html 。我想要从第 7 个链接到第 33 个链接的链接。我需要将它们分开到一个文件中。**我可以复制传出链接吗？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T23:33:49.840

grep 来源

```
<a href 
```

然后将结果输入 vim 并使用以下命令

```
%s/.*<a href="\(.*\)">.*/\1/g

pcmi08_b.pdf
pcmi07_b.pdf
pcmi06_b.pdf
pcmi05_a.pdf
pcmi05_b.pdf
pcmi04_b.pdf
pcmi03_b.pdf
http://www.math.hmc.edu/putnam/
pcmi_classic.pdf
pcmi_classic.tex
http://www.math.hmc.edu/putnam/seminar.shtml
pcmi_tng.tex
pss_solution.pdf
pss_solution.tex
http://www.maa.org/mathhorizons/
http://www.maa.org/pubs/mathmag.html
http://www.maa.org/pubs/cmj.html
http://www.maa.org/pubs/monthly.html
http://www.math.hmc.edu/funfacts/
http://mathforum.org/students/
http://mathworld.wolfram.com
http://www.cecm.sfu.ca/projects/ISC/
http://www.research.att.com/%7Enjas/sequences/index.html
http://ams.rice.edu/mathscinet/
http://mathforum.org/wagon/
http://math.scu.edu/putnam/index.html
http://www.unl.edu/amc/a-activities/a7-problems/putnam/
http://www.unl.edu/amc/a-activities/a7-problems/problemarchive.html
http://www.amazon.com/exec/obidos/ASIN/0387982191/ref=pd_sxp_elt_l1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/tg/detail/-/038790803X/ref=pd_sim_books_1/t/002-7200940-4079202?v=glance&amp;s=books
http://www.amazon.com/exec/obidos/tg/detail/-/0471135712/ref=pd_sim_books_2/t/002-7200940-4079202?v=glance&amp;s=books
http://www.amazon.com/exec/obidos/tg/detail/-/0817641556/ref=pd_bxgy_text_1/t/002-7200940-4079202?v=glance&amp;s=books&amp;st=*
http://www.amazon.com/exec/obidos/ASIN/0387947434/ref=pd_pym_rvi_1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/ASIN/0883855194/ref=pd_sxp_elt_l1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/tg/detail/-/0883853256/qid=1057672535/sr=8-1/ref=sr_8_1/t/002-7200940-4079202?v=glance&amp;s=books&amp;n=507846" style="font-style: italic;
http://www.amazon.com/exec/obidos/ASIN/088385807X/ref=pd_sxp_elt_l1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/ASIN/0486694151/ref=pd_sxp_elt_l1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/ASIN/0486695735/ref=pd_sxp_elt_l1/t/002-7200940-4079202
http://www.amazon.com/exec/obidos/ASIN/0691023565/ref=pd_sxp_elt_l1/t/002-7200940-4079202 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T23:35:01.100

解析 html 并提取 < a > 标签是相当容易的。然后找到href属性。如果您有这些，您可以选择保留哪些以及删除哪些。

# wpf - 在 wpf TextBlock 中装饰数据绑定文本的最佳方法

> ID：620870
> 
> 赞同：2
> 
> 时间：2009-03-06T23:26:37.203
> 
> 标签：wpf, data-binding, textblock

假设我有一些要格式化的多行文本，并且还假设它是数据绑定的。因此，在 XAML 中：

```
<TextBlock TextWrap="Wrap">
    <TextBlock.Inlines>
        <Run TextWeight="Bold" Text="{Binding Path=FirstName}" />
        <Run TextStyle="Italic Text="{Binding Path=LastName}" />
    </TextBlock.Inlines>
</TextBlock> 
```

现在，这不起作用，因为 Run 的 Text 不是依赖属性。所以，我想知道，像这样设计内联数据绑定文本的最佳方式是什么？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T23:47:19.090

[这里](http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html)发布了一个解决方法。它基本上涉及将 Run 子类化为可绑定。虽然有效。

# database - 分布式系统中的故障转移有哪些算法？

> ID：620877
> 
> 赞同：19
> 
> 时间：2009-03-06T23:28:50.520
> 
> 标签：database, algorithm, distributed, cluster-computing, failover

我正计划使用无[共享架构](http://en.wikipedia.org/wiki/Shared_nothing_architecture)和[多版本并发控制](http://en.wikipedia.org/wiki/Multiversion_concurrency_control)来制作分布式数据库系统。冗余将通过[异步复制实现](http://www.webopedia.com/TERM/A/asynchronous_replication.html)（只要系统中的数据保持一致，它就可以在发生故障时丢失一些最近的更改）。对于每个数据库条目，一个节点具有主副本（只有该节点对其具有写访问权限），此外，一个或多个节点具有条目的辅助副本以用于可伸缩性和冗余目的（辅助副本是只读的） . 当条目的主副本被更新时，它会被打上时间戳并异步发送到具有辅助副本的节点，以便最终他们将获得条目的最新版本。拥有主副本的节点可以随时更改 - 如果另一个节点需要写入该条目，它将请求主副本的当前所有者给该节点该条目的主副本的所有权，

最近我一直在思考当集群中的一个节点出现故障时该怎么办，使用什么策略进行故障转移。这里有一些问题。我希望您至少知道其中一些的可用替代品。

*   在分布式系统中进行故障转移有哪些算法？
*   分布式系统中有哪些共识算法？
*   集群中的节点应该如何判断一个节点宕机了？
*   节点应如何确定故障时哪些数据库条目在故障节点上有其主副本，以便其他节点可以恢复这些条目？
*   如何确定哪些节点具有某个条目的最新辅助副本？
*   如何决定应该将哪个节点的辅助副本提升为新的主副本？
*   本来以为down的节点突然又像什么都没发生一样怎么处理？
*   如何避免出现裂脑场景，网络暂时一分为二，双方都认为对方已经死了？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-08T23:57:36.113

```
* What algorithms there are for doing failover in a distributed system? 
```

可能不是算法，而是系统。你需要围绕你提出的问题来设计你的架构。

```
* What algorithms there are for consensus in a distributed system? 
```

您可能想要实现 Paxos。简单的 Paxos 并不难做到。如果你想让它防弹，请阅读 Google 的“Paxos Made Live”论文。如果您希望使其具有高性能，请查看 Multi-Paxos。

```
* How should the nodes in the cluster determine that a node is down? 
```

要看。心跳实际上是一个很好的方法来做到这一点。问题是您有误报，但这是不可避免的，并且在同一 LAN 上具有可管理负载的集群中，它们是准确的。Paxos 的好处是可以自动处理误报。但是，如果您出于其他目的确实需要故障信息，那么您需要确保可以检测到节点失败，但实际上它只是处于负载状态并且需要时间来响应心跳。

```
* How should the nodes determine that what database entries had their master copy on the failed node at the time of failure, so that other nodes may recover those entries?
* How to decide that which node(s) has the latest secondary copy of some entry?
* How to decide that which node's secondary copy should be promoted to be the new master copy? 
```

我认为您可能真的从阅读 Google FileSystem 论文中受益。在 GFS 中有一个专用的主节点，它跟踪哪些节点有哪些块。这个方案可能对你有用，但关键是尽量减少对这个 master 的访问。

如果您不将此信息存储在专用节点上，那么您将不得不将其存储在任何地方。尝试使用主持有者的 ID 标记数据。

```
* How to handle it, if the node which was though to be down, suddenly comes back as if nothing happened? 
```

见上文，但基本点是您必须小心，因为不再是主节点的节点可能会认为它是主节点。我认为您尚未解决的一件事：更新如何到达主节点 - 即客户端如何知道将更新发送到哪个节点？

```
* How to avoid split-brain scenarios, where the network is temporarily split into two, and both sides think that the other side has died? 
```

Paxos 通过在完美拆分的情况下阻止进展来发挥作用。否则，和以前一样，你必须非常小心。

一般来说，解决知道哪个节点将哪个数据项作为主节点的问题，您将在修复您的架构方面有很长的路要走。请注意，您不能只让接收更新的节点成为主节点——如果两个更新同时发生怎么办？也不要依赖同步的全球时钟——那是疯狂的所在。如果可以的话，您可能希望避免在每次写入时都达成共识，因此可能需要一个缓慢的主故障转移协议和一个快速的写入路径。

如果您想了解更多详细信息，请随时给我发送邮件。我的博客[http://the-paper-trail.org](http://the-paper-trail.org)处理了很多这样的东西。

干杯，

亨利

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-06T23:48:57.790

你问的是一个绝对庞大的问题，而你想知道的很多东西仍在积极研究中。

一些想法：

*   分布式系统很困难，因为没有万无一失的系统来处理故障；在异步系统中，无法确定节点是否已关闭或是否存在网络延迟。这听起来可能微不足道，但事实并非如此。
*   达成共识可以通过[Paxos 系列算法](http://en.wikipedia.org/wiki/Paxos_algorithm)来完成，其版本在 Google 的 bigtable 和其他地方使用。

您需要深入研究分布式系统教科书（或多本）。我喜欢[Tannenbaum 的分布式系统：原理和范式](https://rads.stackoverflow.com/amzn/click/com/0132392275)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T18:57:19.767

http://the-paper-trail.org/是一个很棒的博客，它讨论了很多关于分布式系统和分布式算法——包括实现[Paxos——](http://the-paper-trail.org/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T23:50:23.747

[使用分布式锁管理器](http://en.wikipedia.org/wiki/Distributed_lock_manager)的 DEC for VMS 解决了这个问题。现代解决方案基于这种设计。阅读 Wikipedia 文章以了解一些当前的解决方案。您应该查看[OCFS2](http://oss.oracle.com/projects/ocfs2/)，它现在是 Linux 内核的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T23:37:31.703

仅解决您问题的一小部分：在您描述的场景中，无法决定（抽象地）哪些节点具有最新的辅助副本。充其量，一些节点可以轮询并确定（经过一些通信之后）他们知道/可以看到的节点中谁知道/可以看到它们，并且*看不到*旧的master拥有最新的复制。但：

*   他们无法找出他们无法到达的节点的状态
*   他们无法找出无法到达的节点的状态
*   他们不能确定他们认为自己知道的节点状态是否是当前的——当邻居报告状态后，主节点可能已经更新了共享邻居。

在更广泛的问题上，你可能想看看 memcached 之类的东西是如何处理这些问题的，尤其是通读列表，看看他们在理论遇到实践时遇到了哪些问题。

# javascript - 将 html 放在 iframe 中（使用 javascript）

> ID：620881
> 
> 赞同：37
> 
> 时间：2009-03-06T23:30:11.593
> 
> 标签：javascript, jquery, html, iframe

我可以创建一个空的 iframe 作为占位符，以便稍后将 html 插入其中吗？

换句话说，假设我有一个带有 id 的空 iframe，

如何在其中插入 html？

我正在使用 jquery，如果这样更容易的话。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2013-09-23T10:36:53.470

你也可以不用 jQuery 来做到这一点：

```
var iframe = document.getElementById('iframeID');
iframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);

iframe.document.open();
iframe.document.write('Hello World!');
iframe.document.close(); 
```

jQuery 的 html 从插入的 HTML 中去除 body、html 和 head 标签。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-03-06T23:46:55.063

查看此页面的源代码：http: [//mg.to/test/dynaframe.html](http://mg.to/test/dynaframe.html)它似乎完全符合您的要求。

```
$(function() {
    var $frame = $('<iframe style="width:200px; height:100px;">');
    $('body').html( $frame );
    setTimeout( function() {
        var doc = $frame[0].contentWindow.document;
        var $body = $('body',doc);
        $body.html('<h1>Test</h1>');
    }, 1 );
}); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-02-15T17:08:11.593

不，这不对。您可以像这样修改脚本：

```
$(function() {
    var $frame = $('iframe');
    setTimeout( function() {
            var doc = $frame[0].contentWindow.document;
            var $body = $('body',doc);
            $body.html('<h1>Test</h1>');
    }, 1 );
}); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-04T10:59:01.837

```
iframeElementContainer =   document.getElementById('BOX_IFRAME').contentDocument;
iframeElementContainer.open();
iframeElementContainer.writeln("<html><body>hello</body></html>");
iframeElementContainer.close(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-12T04:48:21.373

是的，我知道这是可能的，但主要问题是我们无法从外部处理框架，我已经加载了其他东西。

```
$(function() {
        var $frame = $('<iframe style="width:200px; height:100px;">');
        $('body').html( $frame );
        setTimeout( function() {
                var doc = $frame[0].contentWindow.document;
                var $body = $('body',doc);
                $body.html('<h1>Test</h1>');
        }, 1 );
}); 
```

但如果我们开始

```
<iframe src="http:/www.hamrobrt.com">
<---Your Script to put as you like---> 
```

那么就不可能做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-26T08:13:41.957

> 我有同样的问题，我必须在没有 iframe 的 SRC 属性的情况下从数据库动态显示 iframe 中的 html 代码片段，并且我用以下代码修复了同样的问题
> 
> 我希望这会对我有同样要求的人有所帮助。

[jsfiddle 示例在这里](https://jsfiddle.net/sunnysm/hywpfceh/)

HTML：

```
<iframe src="" frameborder="0" class="iframe"></iframe>
<iframe src="" frameborder="0" class="iframe"></iframe>
<iframe src="" frameborder="0" class="iframe"></iframe>
<iframe src="" frameborder="0" class="iframe"></iframe> 
```

JS

```
<script>
var doc,$body;
var txt = Array(
            '<style>body{background-color:grey} h1{background-color:red;font-weight:900}</style><h1>Cool!!! this is text for</h1><p>First Iframe</p>',
            '<style>body{background-color:pink}h1{background-color:green;font-weight:200}</style><h1>Cool This is Text for</h1><p> second Iframe',
            '<style>body{background-color:yellow}h1{font-weight:400}</style><h1>Cool..... This is text FOR : </h1> <div>3rd Iframe</div>',
            '<style>body{background-color:blue} h1{font-weight:400}</style><h1>Cool This is text for Fourth iframe</h1>'
            );
$('.iframe').each(function(index,value){
    doc = $('iframe')[index].contentWindow.document;
        $body = $('body',doc);
        $body.html(txt[index]);
});
</script> 
```

# algorithm - 我怎样才能更有效地实现这一点

> ID：620883
> 
> 赞同：8
> 
> 时间：2009-03-06T23:32:26.503
> 
> 标签：algorithm, math, algebra

所以我有一个函数（我用伪函数语言写这个，我希望它清楚）：

```
dampen (lr : Num, x : Num) = x + lr*(1-x) 
```

我希望将这个 n 次应用于值 x。我可以递归地实现它：

```
dampenN (0, lr, x) = dampen(lr, x)
dampenN (n, lr, x) = dampenN(n-1, lr, dampen(x)) 
```

但是必须有一种方法可以在数学上做到这一点，而无需诉诸迭代过程（递归或循环）。

不幸的是，我的代数技能生疏得令人难以置信，有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T23:57:37.003

```
x + lr*(1-x) 
= x + lr - lr*x 
= x*(1-lr)+lr 
```

应用它两次给出

```
(x*(1-lr)+lr)*(1-lr)+lr 
= x*(1-lr)^2 + lr*(1-lr) + lr 
```

和三倍

```
(x*(1-lr)+lr)*(1-lr)^2 + lr*(1-lr) + lr 
= x*(1-lr)^3 + lr*(1-lr)^2 + lr*(1-lr) + lr 
```

或者一般来说， n 次给出

```
x*(1-lr)^n + lr * ( (1-lr)^n + (1-lr)^(n-1)...+(1-lr) +1) 
```

这有帮助吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T05:35:41.047

我们可以完全从您的公式中消除该系列。

我们得到：

```
x_(n+1) = x_n + lr(1-x_n) 
```

这可以通过如下重写来简化：

```
x_(n+1) = (1-lr)x_n + lr 
```

实际上，我们已将其转换为尾递归。（如果你想要计算机科学的观点。）

这意味着：

```
x_n = (1-lr)^n * x_0    +   ((1-lr)^(n-1) + (1-lr)^(n-2) + ... + 1)*lr 
```

右边的大项是[几何级数](http://en.wikipedia.org/wiki/Geometric_series)，所以也可以折叠：

```
x_n = (1-lr)^n * x_0   +   lr *  (1 - (1-lr)^n) / (1- (1 -lr))
x_n = (1-lr)^n * x_0   +   1 - (1 - lr)^n 
```

由于最终表达式中的小错误而进行了编辑。+1 来袭。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T06:52:38.457

实际上，MarkusQ 的帖子有一个错误。正确的公式是：

```
x * (1-lr)^n + lr * ( (1-lr)^(n-1) + (1-lr)^n-2 + ... + (1-lr) + 1 )
= x * (1-lr)^n + lr * ( 1 - (1-lr)^n )/(1 - (1-lr))
= x * (1-lr)^n + (lr/lr) * (1 - (1-lr)^n)
= (x-1) * (1-lr)^n + 1

```

另外，请注意“n”是您应用该功能的次数。在上面的函数伪代码中，“n=0”的情况下应用函数一次，而不是零次；为了匹配上面的公式，它必须去：

```
阻尼N (0, lr, x) = x
阻尼N（n，lr，x）=阻尼N（n-1，lr，阻尼（x））

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T00:01:23.907

我的代数技能也很烂，但我决定稍微重构一下方程并开始研究一些情况，d0 和 d1：

```
d0 = x + lr(1-x) => x + lr - lr*x => (1 - lr)x + lr
d1 = (1 - lr)[(1 - lr)x + lr] + lr => (1 - lr)^2 x + lr(1 - lr) + lr 
```

基本上，如果你开始看到二次方，你就可以开始看到三次方等等。

此时 x 仅使用一次，您只需处理 (1 - lr)^n 形式的所有子项的幂运算。

# c++ - 如何将断言放入 C/C++ 中的发布版本中

> ID：620892
> 
> 赞同：25
> 
> 时间：2009-03-06T23:39:07.627
> 
> 标签：c++, c, release, assert

我只需要运行 ship build 并且我需要在 release build 中的某些条件下断言以查看问题是否已解决。我该怎么做？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-06T23:44:32.433

取消定义 NDEBUG 宏 - 您可以围绕要保留在构建中的断言在本地执行此操作：

```
#undef NDEBUG
#include <assert.h>   // reinclude the header to update the definition of assert() 
```

或者做任何你需要做的事情，这样你的构建过程就不会首先定义 NDEBUG 宏。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-07T00:36:15.587

为什么不定义自己的断言：

```
#define assert(x) MessageBox(...); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-10T08:51:07.773

只需直接调用`assert`在发布模式下处于活动状态的宏定义部分。

[您可以在Miro Samek 撰写的这篇精彩文章](http://www.drdobbs.com/an-exception-or-a-bug/184401686)( [PDF](https://www.state-machine.com/doc/Samek0308.pdf) )中找到非常有用的 C++ 断言定义。然后，您可以稍微调整它们以满足您的需求。例如，您可以创建另一个宏，`release_assert`它与 assert 的作用相同，但不管它是处于发布模式还是调试模式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-06T23:48:12.003

ASSERT 的默认行为是在 Debug 配置下中止程序，但这通常在 Release 配置下变成无操作。我相信它通过检查预处理器 NDEBUG 宏的存在来做到这一点。我现在不在工作，所以无法检查。

我认为解决此问题的最简单方法是修改调试配置以将所有优化提升到与发布（内存中的 O2）相同的级别，然后重新构建您的软件。这将为您提供与发布版本相同的性能和速度，但它仍将定义 NDEBUG 预处理器宏，这意味着所有失败的 ASSERT 仍将导致程序中止。请记住稍后将优化级别更改回来，否则您将无法在 Debug 配置下进行调试。

但总的来说，ASSERT 应该只用于编程前提条件，而不是处理交付软件中的故障。您希望在开发过程中*快速*失败，但在用户面前*优雅地失败。*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T04:12:15.867

我喜欢将它定义为抛出某种从 std::runtime_error 派生的 assert_exception。然后在某个地方抓住它并做一些有用的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-29T06:31:50.020

使用 Visual Studio 时，您可以将 NDEBUG 预编译器定义取消定义为发布版本中的活动断言。

例如，您可以在 Projekt 设置中为 /U 选项设置 $(undefesTheNDEBUG)，然后将环境变量 undefesTheNDEBUG 定义为 NDEBUG (SET undefesTheNDEBUG=NDEBUG) 或将其与 msbuild 一起传递 (/p:undefesTheNDEBUG=NDEBUG)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-28T13:04:32.097

实际上 - 如果你能接受它，我会发布调试版本。如果不需要发布版本的性能，请使用调试。它往往有更少的错误（这是一个严重的过度简化，如果你的程序没有错误，只是切换到发布不会改变这一点，但由于编译器在调试模式下所做的事情，错误可能不会发生和/或有后果较轻）。

也许也可以只优化程序的时间关键部分。

它还可以简化调试。

# mocking - 使用 Rhino 模拟抽象类默认行为

> ID：620894
> 
> 赞同：3
> 
> 时间：2009-03-06T23:39:36.253
> 
> 标签：mocking, rhino-mocks, abstract-class, behavior

我对嘲笑很陌生，所以这可能是我还没有接受的东西，但我在任何地方都找不到一个好的例子。

我试图断言默认情况下，从我的抽象类继承的任何类都将在构造函数中实例化一个集合。这是抽象类：

```
public abstract class DataCollectionWorkflow : SequentialWorkflowActivity
{
        private readonly DataSet _output = new DataSet();
        private List<DataCollectionParameter> _params = null;

        public DataCollectionWorkflow()
        {
            _params = new List<DataCollectionParameter>();   
        }

        public virtual IList<DataCollectionParameter> Parameters
        {
            get { return _params; }
            set { _params = (List<DataCollectionParameter>)value; }
        }
} 
```

我如何用 Rhino 模拟这个？如果我做一个`GenerateMock<DataCollectionWorkflow>`（或一个存根），构造函数运行并且模拟的私有字段“ `_params`”被初始化，但模拟的“ `Parameters`”属性只是空的。

显然，生成的模拟子类覆盖了属性实现。是否有某种方法可以将 Parameters 属性排除在重新实现之外？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T06:53:24.633

好吧，我想通了。把我当作 Rhino 错综复杂的另一个牺牲品。这种事情让我想转向一个更简单的框架，也许我会看看 MoQ。

所以答案是使用 PartialMocks。我曾短暂地玩弄过生成一个部分模拟，但是当我在它上面运行调试器时，我注意到属性甚至不是空的，它们抛出了奇怪的异常，所以我没有深入研究。我使用的是缩写 AAA 类型的语法。

事实证明，如果我只是将模拟置于播放模式，则测试有效 - 属性按原样使用（因为它们应该与部分模拟一起使用）。

所以这是答案：

```
[Test]
public void ShouldCreateParameterListInConstructor()
{
      var mockRepository = new MockRepository();
      var mock = mockRepository.PartialMock<DataCollectionWorkflow>();
      using ( mockRepository.Record() )
      {

      }
      using (mockRepository.Playback())
      {
           Assert.That(mock.Parameters, Is.Not.Null, "DataCollectionWorkflow base class didn't create new param collection");
      }
} 
```

我意识到这是一个有状态的测试，但它实际上是一些涉及相关属性的行为测试的更简单的前奏，所以我希望这个案例作为先决条件。希望它可以帮助某人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T23:54:52.363

尝试使 _params 虚拟

# javascript - 访问内容 with Javascript

> ID：620896
> 
> 赞同：22
> 
> 时间：2009-03-06T23:39:59.090
> 
> 标签：javascript, innerhtml, noscript

```
<noscript><div id="example">I want to get this innerHTML</div></noscript>

<script type="text/javascript"> alert($('example').innerHTML);</script> 
```

This javascript snippet just returns an empty string. Is there a way of getting the contents of a noscript node?

p.s. I'm using prototype on this particular project.

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-07T00:11:06.723

If scripting is enabled, [the noscript element is defined as containing only text](https://html.spec.whatwg.org/multipage/scripting.html#the-noscript-element) - though it must be *parsable* text, with some restrictions on content. With that in mind, you should be able to extract the text, parse it, and then find your desired element. A rudimentary example of this follows:

```
var nos = document.getElementsByTagName("noscript")[0]; 
// in some browsers, contents of noscript hang around in one form or another
var nosHtml = nos.textContent||nos.innerHTML; 

if ( nosHtml )
{
  var temp = document.createElement("div");
  temp.innerHTML = nosHtml;

  // lazy man's query library: add it, find it, remove it
  document.body.appendChild(temp);
  var ex = document.getElementById("example");
  document.body.removeChild(temp);

  alert(ex.innerHTML);
} 
```

Note that when I originally wrote this answer, the above failed in Google Chrome; access to noscript content appears to be somewhat better-supported these days, but it still strikes me as an edge-case that is perhaps somewhat more likely than other elements to exhibit bugs - I would avoid it if you've other options.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-06-08T16:54:23.837

I'm not sure about prototype, but this works in Chrome with jQuery:

```
$('noscript').before($('noscript').text()); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T00:00:22.037

Testing with Firefox 3.0.7, Safari 3.2.2, and MSIE 7.0.5730.13 (all on WinXP SP3) it appears that everything within the `<noscript>` tags is completely omitted from the DOM tree.

It may be possible to access the `<noscript>` element itself, however, and then use DOM methods to change its child elements.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-07T00:01:14.953

From the [HTML 4.0 spec](http://www.w3.org/TR/REC-html40/interact/scripts.html#h-18.3.1):

> The NOSCRIPT element allows authors to provide alternate content when a script is not executed. The content of a NOSCRIPT element should only be rendered by a script-aware user agent in the following cases:
> 
> *   The user agent is configured not to evaluate scripts.
> *   The user agent doesn't support a scripting language invoked by a SCRIPT element earlier in the document.

It seems to me that this implies that the entire contents of the NOSCRIPT tag (in this case, your div) are ignored altogether if scripting is enabled in the browser. Have you verified that the "example" div is accessible through the DOM at all in your case?

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-08-18T16:16:05.180

Try $($("noscript").text()) with jQuery.

# wordpress - WordPress 帖子的 Facebook 通知

> ID：620899
> 
> 赞同：4
> 
> 时间：2009-03-06T23:42:00.693
> 
> 标签：wordpress, facebook

有没有办法向 facebook 帐户发送有关基于 wordpress 的新博客的通知？或者也许是wordpress的插件？

限制是用户不应该登录到 facebook，只需为插件指定 facebook 凭据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T17:03:36.400

I am not sure if this is what you are looking for but... just grab your RSS feed and put it here:

[http://www.facebook.com/home.php#/editnotes.php?import](http://www.facebook.com/home.php#/editnotes.php?import)

Whenever you post it will show up in your notes.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-05T16:15:13.993

如果您转到您的 wordpress 管理页面，请单击仪表板，从下拉菜单中选择我的博客。这给您的博客、宣传、点击 facebook、twitter 等，您将需要授权链接。然后，所有新帖子也将发布在您的 fb/twitter 帐户上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T23:53:43.393

查看 Wordpress.com Facebook 应用程序：[http ://en.blog.wordpress.com/2007/07/18/facebook/](http://en.blog.wordpress.com/2007/07/18/facebook/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-22T17:16:16.203

这个插件听起来像是会发布到 Facebook 页面： http: [//fullthrottledevelopment.com/facepress](http://fullthrottledevelopment.com/facepress)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-15T08:47:50.997

如何从外部博客导入条目？Facebook 允许您快速轻松地从另一个网站导入外部博客。在 Notes 页面上，单击页面右侧的 Import a blog 链接。在文本框中输入您博客的 URL（网址），然后选中下方的框，表明您同意我们的使用条款。要完成该过程，请单击“保存设置”。执行此操作后，您以前的帖子将显示为注释，并且您发布的任何新帖子都将自动显示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T23:57:12.433

从来没听说过。根据我的研究，其中一种方法是创建一个 Facebook Connect 应用程序（这不是一个完整的 Facebook 应用程序）。如果用户决定他/她希望授予您的网站/博客连接到 FB 帐户的权限，您将能够在他们的墙上发布通知等。

资源：http: [//developers.facebook.com/connect.php](http://developers.facebook.com/connect.php)

如果您使用的是 ASP .NET： http: [//www.codeplex.com/FacebookToolkit](http://www.codeplex.com/FacebookToolkit)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-15T02:43:24.917

[WordBook](http://wordpress.org/extend/plugins/wordbook/)正是您想要的！

# c++ - C++ 概念检查与继承

> ID：620914
> 
> 赞同：8
> 
> 时间：2009-03-06T23:51:08.533
> 
> 标签：c++, templates, polymorphism

使用虚函数和 C++ 继承机制与使用模板和类似 boost 概念之间的关系是什么？

似乎有很多可能的重叠。也就是说，似乎有可能用任何一种方法来实现多态行为。那么，什么时候偏爱一个比另一个有意义呢？

我提出这个的原因是因为我有一个模板化的容器，其中容器本身具有层次关系。我想编写使用这些容器的算法，而不关心它是哪个特定容器。此外，某些算法将受益于知道模板类型满足某些概念（例如，可比较）。

因此，一方面，我希望容器具有多态性。另一方面，如果我想正确实现一些算法，我仍然必须使用概念。初级开发人员应该做什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T00:22:17.740

我认为概念是一种元界面。他们根据能力对类型进行分类。下一个 C++ 版本提供本地概念。直到我遇到 C++1x 的概念以及它们如何允许将不同但不相关的类型放在一起之前，我才理解它。想象一下你有一个`Range`界面。您可以通过两种方式对其进行建模。一种是*亚型关系*：

```
class Range {
    virtual Iterator * begin() = 0;
    virtual Iterator * end() = 0;

    virtual size_t size() = 0;
}; 
```

当然，从它派生的每个类都实现 Range 接口并且可以与您的函数一起使用。但现在你看到它是有限的。数组呢？也是一个范围！

```
T t[N];

begin() => t
end() => t + size()
size() => N 
```

遗憾的是，您不能从实现该接口的 Range 类派生数组。您需要一个额外的方法（*重载*）。那么第三方容器呢？您的库的用户可能希望将他们的容器与您的函数一起使用。但他不能改变他们容器的定义。在这里，概念进入游戏：

```
auto concept Range<typename T> {
    typename iterator;
    iterator T::begin();
    iterator T::end();
    size_t T::size();
} 
```

现在，您说一下如果`T`具有适当的成员函数可以实现的某种类型的受支持操作。在您的库中，您将编写函数泛型。这允许您接受任何类型*，只要*它支持所需的操作：

```
template<Range R>
void assign(R const& r) {
    ... iterate from r.begin() to r.end(). 
} 
```

这是一种很好的*可替代性*。*任何*类型都符合遵循该概念的要求，而不仅仅是那些积极实现某些接口的类型。下一个 C++ 标准更进一步：它定义了一个`Container`概念，该概念将适合普通数组（通过一些定义某些类型如何适合某些概念的缩放*概念图）和其他**现有的*标准容器。

> 我提出这个的原因是因为我有一个模板化的容器，其中容器本身具有层次关系。我想编写使用这些容器的算法，而不关心它是哪个特定容器。此外，某些算法将受益于知道模板类型满足某些概念（例如，可比较）。

您实际上可以使用模板来做这两个。你可以保持你的层次关系来共享代码，然后以通用的方式编写算法。例如，传达您的容器具有可比性。这就像实现了标准的随机访问/转发/输出/输入迭代器类别：

```
// tag types for the comparator cagetory
struct not_comparable { };
struct basic_comparable : not_comparable { };

template<typename T>
class MyVector : public BasicContainer<T> {
    typedef basic_comparable comparator_kind;
};

/* Container concept */
T::comparator_kind: comparator category 
```

实际上，这是一种合理的简单方法。现在您可以调用一个函数，它将转发到正确的实现。

```
template<typename Container>
void takesAdvantage(Container const& c) {
    takesAdvantageOfCompare(c, typename Container::comparator_kind());
}

// implementation for basic_comparable containers
template<typename Container>
void takesAdvantage(Container const& c, basic_comparable) {
    ...
}

// implementation for not_comparable containers
template<typename Container>
void takesAdvantage(Container const& c, not_comparable) {
    ...
} 
```

实际上有不同的技术可以用来实现它。另一种方法是使用`boost::enable_if`每次启用或禁用不同的实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T00:14:02.783

是的，这两种机制都可以实现多态行为。事实上，两者都被*称为*多态性。

虚函数给你动态多态性（因为它是在运行时决定的），而模板给你静态多态性（一切都是在编译时决定的）。

这也应该回答更喜欢哪个的问题。只要有可能，宁愿将工作转移到编译时。因此，当您可以摆脱它时，请使用模板来解决您的多态性需求。当这不可能时（因为您需要使用运行时类型信息，因为在编译时不知道确切的类型），回退到动态多态性。

（当然可能有其他原因偏爱其中一个。特别是，模板要求您将大量代码移动到头文件中，这可能会或可能不会有问题，并且编译速度往往会受到影响，这也可能会或可能不是问题。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T23:57:38.080

如果可以在编译时做出决定，请使用模板。否则使用继承和虚函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T00:18:25.583

在这种特定情况下，您可以执行类似的操作

```
template<typename T>
class ContainerBase{};

template<typename T>
class ContainerDerived : public ContainerBase<T> {}; 
```

由于每个“容器”类型对于每个模板类型都是唯一的，因此没有理由不能将每个容器类型的成员函数专门用于模板化类型的特征。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T02:26:10.597

作为编译时和运行时多态性之间差异的简单示例，请考虑以下代码：

```
template<typename tType>
struct compileTimePolymorphism
{ };

// compile time polymorphism,
// you can describe a behavior on some object type
// through the template, but you cannot interchange 
// the templates
compileTimePolymorphism<int> l_intTemplate;
compileTimePolymorphism<float> l_floatTemplate;
compileTimePolymorphism *l_templatePointer; // ???? impossible

struct A {};
struct B : public A{};
struct C : public A{};

// runtime polymorphism 
// you can interchange objects of different type
// by treating them like the parent
B l_B;
C l_C:
A *l_A = &l_B;
l_A = &l_C; 
```

当一个对象的行为依赖于另一个对象时，编译时多态性是一个很好的解决方案。在需要更改对象行为的情况下，运行时多态性是必需的。

两者可以通过定义一个多态的模板来组合：

```
template<typename tType>
struct myContainer : public tType
{}; 
```

那么问题是你的容器的行为在哪里需要改变（运行时多态性），以及行为取决于它包含的对象（编译时多态性）。

# simulation - 是否可以通过物理过程模拟生成随机数？

> ID：620921
> 
> 赞同：2
> 
> 时间：2009-03-06T23:55:50.770
> 
> 标签：simulation, prng, random

是否可以通过物理过程模拟生成随机数？

如果我模拟骰子的物理掷骰（即你拿起它，在手中摇晃它，将它释放到桌子上并记录哪一面最终“向上”......）会产生一个“随机”数字还是会我只是有一个复杂的模拟，它真的什么也没做。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T23:58:48.250

**你会有一个复杂的模拟，它真的什么也没做。**

（除了每次都返回相同的值，或者给现有的 PRNG 增加不必要的复杂性）

除非您使用“随机”变量为模拟环境播种（即依赖于生成随机数的不同方法），否则您将始终获得相同的值，因为过程中的每一步每次都会以相同的方式发生。

假设您确实使用了基本伪随机数生成器 (PRNG)：

由于您的模拟只会与您使用的其他 PRNG 一样随机，因此您也可以直接使用其他 PRNG，而无需进行所有额外工作！（实际上，您的模拟可能不会做任何事情，除了使输出*的*随机性低于基础 PRNG 中的值）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T00:00:42.053

它仍然是一个伪随机数，因为大概您将使用伪随机数生成器来模拟您手中骰子的所有弹跳。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T00:01:03.360

是的，你会“只是有一个复杂的模拟，它真的什么也没做”。

当您实际上可以使用真实的物理过程时，为什么要模拟随机物理过程？

SO上有很多关于随机数生成器的问题。这里仅仅是少数：

[真随机数发生器](https://stackoverflow.com/questions/37702/true-random-number-generator)

[是否存在无状态随机数生成器？](https://stackoverflow.com/questions/203382/do-stateless-random-number-generators-exist)

[赌场游戏行业使用什么类型的随机数生成器？](https://stackoverflow.com/questions/426821/what-type-of-random-number-generator-is-used-in-the-gaming-industry)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T00:01:21.473

您的算法将是一个伪随机数生成器，也就是说，它会接收一个随机种子并生成可能看起来相当随机的大量字符串。

但是，不能保证您的随机输出将具有加密或其他目的所需的质量。我倾向于认为您的输出中会有不受欢迎的重复模式，并且过多的工作将涉及问题的物理学，而不足以产生伪随机性。（很抱歉，有点虚弱，但简而言之就是这样。）存在有效的伪数生成器，我会使用其中一个架子。

也就是说，对于您自己的目的，这可能是一个有趣且内容丰富的实验。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-11-17T00:17:41.897

我不同意普遍的反应。

如果您添加（i）“能量”组件来模拟您“投掷”骰子的力，（ii）模拟骰子如何“旋转”的“扭矩”组件，以及（iii）“延迟”组件模拟骰子和桌子之间的“摩擦”，那么您应该能够全面地模拟该过程。

然而，这个过程在现实中并不是完全随机的，如果你以相同的力量掷骰子并旋转，那么你一定会得到相同的面朝上。假设骰子的形状/大小没有变化并且桌子上的摩擦力保持不变，则可以完成模拟“掷骰子”的过程。

需要注意的是 - 您需要一个随机数生成器来选择您输入到模拟模型中的“能量”、“扭矩”、“摩擦”的随机值，否则您将重复前面的模式。但这不是所描述的模拟模型的限制，初始条件相当有缺陷 - 掷骰子的过程不是完全随机的，因此不会给你一个“随机数”。如果您保持相同的“力”、“旋转”和“摩擦”，您将始终以同一面朝上结束。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T23:59:25.487

后者。

除非您注入一些随机（或伪随机）因子，否则模拟每次都会产生相同的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-07T00:01:40.753

首先，您需要定义“随机”。当然，您可以通过使用一组奇怪的计算来生成难以预测的数字。但是你不会得到有用的随机性或数字的均匀分布。

像您描述的物理模拟实际上需要在计算中的某个点使用某种随机数生成器。幸运的是，random() 很容易使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-07T00:04:59.373

除非您准备好模拟两个完整芯片的量子态，否则您将没有任何随机...

# wpf - 这两个绑定有什么区别？

> ID：620927
> 
> 赞同：0
> 
> 时间：2009-03-06T23:57:56.020
> 
> 标签：wpf, data-binding

很久以前，我看了[这个 MSDN walkthrough](http://msdn.microsoft.com/en-us/library/bb546930.aspx)。它实现了一个颜色编辑器，工具提示使用颜色的名称，如“红色”或“蓝色”。

今天，我正在实现一个类似的 ListBox；它会显示一个框，其中包含颜色及其旁边的颜色名称。除了在我的应用程序中，所有颜色名称都显示为十六进制值，例如 #FFFF0000 和 #FF0000FF。为什么？

这是`ColorsList`两个项目中使用的类：

```
public ColorsList()
{
    Type type = typeof(Colors);
    foreach (PropertyInfo propertyInfo in type.GetProperties(BindingFlags.Public | BindingFlags.Static))
    {
        if (propertyInfo.PropertyType == typeof(Color))
        {
            Add((Color)propertyInfo.GetValue(null, null));
        }
    }
} 
```

此 XAML 片段使工具提示使用 MSDN 项目中的颜色名称（您可以在演练中查看其余代码）：

```
<ItemsControl.ItemTemplate>
    <DataTemplate>
        <Button Tag="{Binding}" Command="{x:Static PropertyEditing:PropertyValueEditorCommands.ShowInlineEditor}">
            <Button.Template>
                <ControlTemplate>
                    <Border Width="30" Height="30" BorderBrush="Black" BorderThickness="1" CornerRadius="5">
                        <Rectangle Width="22" Height="22" ToolTip="{Binding}">
                            <Rectangle.Fill>
                                <SolidColorBrush Color="{Binding}"/>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Border>
                </ControlTemplate>
            </Button.Template>
        </Button>
    </DataTemplate>
</ItemsControl.ItemTemplate> 
```

这是生成十六进制代码的我的 XAML：

```
<ListBox x:Name="lstColors" Grid.Row="1" ItemsSource="{StaticResource colors}">
    <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal">
                <Rectangle Stroke="Black"
                           StrokeThickness="3"
                           Width="24"
                           Height="24"
                           RadiusX="5"
                           RadiusY="5">
                    <Rectangle.Fill>
                        <SolidColorBrush Color="{Binding}" />
                    </Rectangle.Fill>
                </Rectangle>
                <TextBlock Text="{Binding}" />
            </StackPanel>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

在我看来是一样的；有什么不同？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T03:08:51.337

不完全是您问题的答案，更多的是观察：

如果您将 ColorsList 更改为继承自`ObservableCollection<string>`而不是`ObservableCollection<Color>`并修改以下行：

```
Add((Color)propertyInfo.GetValue(null, null)); 
```

到

```
Add(propertyInfo.Name); 
```

您的代码将按您希望的方式工作。这不是将颜色转换为颜色名称，而是反过来 - 使用从颜色名称到颜色的内置转换。

作为旁注，我尝试了 MSDN 示例中的 XAML 代码（仅您引用的部分），但工具提示显示颜色代码而不是颜色名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T15:28:40.370

事实证明，设计时与运行时不同。MSDN 示例用作扩展属性编辑器。我听取了朋友的建议并尝试将其公开为运行时控件，神奇的是，它获得了颜色的哈希名称而不是友好名称。整洁的。

# java - 旋转 Swing JLabel

> ID：620929
> 
> 赞同：7
> 
> 时间：2009-03-06T23:59:14.600
> 
> 标签：java, swing, jlabel

我目前正在尝试实现一个 Swing 组件，从`JLabel`该组件继承应该简单地表示一个可以垂直定向的标签。

从这个开始：

```
public class RotatedLabel extends JLabel {

    public enum Direction {
        HORIZONTAL,
        VERTICAL_UP,
        VERTICAL_DOWN
    }

private Direction direction; 
```

我认为将结果从以下位置更改是个好主意`getPreferredSize()`：

```
@Override
public Dimension getPreferredSize() {
    // swap size for vertical alignments
    switch (getDirection()) {
        case VERTICAL_UP:
        case VERTICAL_DOWN:
            return new Dimension(super.getPreferredSize().height, super
                .getPreferredSize().width);
        default:
            return super.getPreferredSize();
    }
} 
```

然后`Graphics`在我将绘画卸载到原始之前简单地转换对象`JLabel`：

```
@Override
protected void paintComponent(Graphics g) {
    Graphics2D gr = (Graphics2D) g.create();

    switch (getDirection()) {
        case VERTICAL_UP:
            gr.translate(0, getPreferredSize().getHeight());
            gr.transform(AffineTransform.getQuadrantRotateInstance(-1));
            break;
        case VERTICAL_DOWN:
            // TODO
            break;
        default:
    }

    super.paintComponent(gr);
} 
```

它似乎以某种方式起作用，因为文本现在垂直显示。但是，位置和大小是关闭的。

实际上，背景的宽度（在这种情况下为橙色）与周围的高度相同，这与`JFrame`我的想法不太一样。

任何想法如何以适当的方式解决这个问题？是否鼓励将渲染委托给超类？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T12:54:57.680

在一位同事的帮助下，我现在可以使用它了。`JLabel`基本上我现在有一个字段指示是否交换高度/宽度，该字段仅在原件进行绘画时才有效。

```
private boolean needsRotate;

@Override
public Dimension getSize() {
  if (!needsRotate) {
    return super.getSize();
  }

  Dimension size = super.getSize();

  switch (getDirection()) {
  case VERTICAL_DOWN:
  case VERTICAL_UP:
      return new Dimension(size.height, size.width);
  default:
    return super.getSize();
  }
}

@Override
public int getHeight() {
  return getSize().height;
}

@Override
public int getWidth() {
  return getSize().width;
}

@Override
protected void paintComponent(Graphics g) {
  Graphics2D gr = (Graphics2D) g.create();

  switch (getDirection()) {
  case VERTICAL_UP:
    gr.translate(0, getSize().getHeight());
    gr.transform(AffineTransform.getQuadrantRotateInstance(-1));
    break;
  case VERTICAL_DOWN:
    gr.transform(AffineTransform.getQuadrantRotateInstance(1));
    gr.translate(0, -getSize().getWidth());
    break;
  default:
  }

  needsRotate = true;
  super.paintComponent(gr);
  needsRotate = false;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-04-05T19:11:09.147

我现在不知道它是否相关，但是在搜索相同的东西时，我在网络上找到了一个非常好的实现， http: [//macdevcenter.com/pub/a/mac/2002/03/22/垂直文本.html](http://macdevcenter.com/pub/a/mac/2002/03/22/vertical_text.html)

检查一下，它是在 TabbedPane 上的一个带有垂直文本的实现，看看它是否适合你的目的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-04T11:22:58.497

我玩过这个，它最初工作得不是很好，因为标签边界完全是方形的，导致标签右侧的组件移动并变得模糊。但后来我意识到这是因为我使用的是 JGoodies FormLayout。如果您使用此布局管理器，请确保将列大小设置为“首选”而不是“默认”。HTH。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T00:45:45.033

我认为它已经关闭，因为您正在翻译错误的观点。

对象的大小取决于您在哪个容器中，所以虽然您的首选大小可能是您想要的，但您的实际大小不是？

如果您在 BorderLayout 的 CENTER 中有此标签，则大小始终为容器的全尺寸（减去北+南高度，减去东+西宽度）

所以你不必翻译实际尺寸，而不是首选尺寸吗？

# mappoint - MapPoint Web 服务缩放级别

> ID：620931
> 
> 赞同：2
> 
> 时间：2009-03-06T23:59:51.057
> 
> 标签：mappoint

我正在修改其他人为 MapPoint Web 服务编写的应用程序。它是一个相当古老的应用程序，我认为它使用的是 MapPoint Web 服务的 3.5 版。我想知道如何设置默认缩放级别？默认情况下，我想更近距离地查看该位置。

我找到了 MapOptions.Zoom 属性，但这看起来就像每次按下按钮时它会缩放多少。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T00:06:55.423

我相信您只是将 MapSpecification.MapOptions.Zoom 设置为双精度值。但是[MSDN](http://msdn.microsoft.com/en-us/library/cc514567.aspx)很可能会有更好的答案

# java - 通配符和泛型错误

> ID：620934
> 
> 赞同：5
> 
> 时间：2009-03-07T00:00:46.577
> 
> 标签：java

下面的代码是一次性的，让枚举在新的 foreach 循环中工作是一个失败的想法，但是我想让它编译，因为我一直遇到泛型和通配符的问题。无论出于何种原因，我都看不到如何解决它。

那么，需要进行哪些更改才能进行此编译？

```
import java.util.Enumeration;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;

public class Main
{
    private ZipFile zipFile;

    public Set<String> entries()
    {
        final Set<String>                             names;
        final Enumeration<? extends ZipEntry>         enumeration;
        final IterableEnumeration<? extends ZipEntry> iteratable;

        names = new HashSet<String>();

        // zipFile.entries() returns "Enumeration<? extends ZipEntry>"
        enumeration = zipFile.entries();

        // this line won't compile
        iteratable  = new IterableEnumeration<? extends ZipEntry>(enumeration);

        for(final ZipEntry entry : iteratable)
        {
            if(!(entry.isDirectory()))
            {
                names.add(entry.getName());
            }
        }

        return (names);
    }
}

class IterableEnumeration<T>
    implements Iterable<T>
{
    private final Enumeration<T> enumeration;

    public IterableEnumeration(final Enumeration<T> e)
    {
        enumeration = e;
    }

    public Iterator<T> iterator()
    {
        final EnumerationIterator<T> iterator;

        // yeah cannot do this since an Iterable is supposed to work multiple times on the same object and Enumeration is descructive...
        iterator = new EnumerationIterator<T>(enumeration);

        return (iterator);
    }
}

class EnumerationIterator<T>
    implements Iterator<T>
{
    private final Enumeration<T> enumeration;

    public EnumerationIterator(final Enumeration<T> e)
    {
        enumeration = e;
    }

    public boolean hasNext()
    {
        return (enumeration.hasMoreElements());
    }

    public T next()
    {
        return (enumeration.nextElement());
    }

    public void remove()
    {
        throw new UnsupportedOperationException("Cannt remove via an Enumeration");
    }
} 
```

错误是：

```
Main.java:26: unexpected type
found   : ? extends java.util.zip.ZipEntry
required: class or interface without bounds
        iteratable  = new IterableEnumeration<? extends ZipEntry>(enumeration);
                                             ^
1 error 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T00:31:34.693

构造参数化类型时不能指定通配符。这是正确的语法：

```
iteratable  = new IterableEnumeration<ZipEntry>(enumeration); 
```

正如您所指出的，因为是一次性使用，所以很难实现，而代码可以根据`Iterable`需要创建尽可能多的新对象。您可以在增强的 for 循环中安全地使用它，但将这种方法传递给任何其他方法都是不安全的。`Enumeration``Enumeration``Iterable``Iterator``Iterable`

* * *

奥斯卡说得对，上面的改动还不够。`enumeration`我忽略了底层是“ ”的事实`? extends ZipEntry`。此外，进行以下更改：

```
class IterableEnumeration<T>
  implements Iterable<T>
{

  private final Enumeration<? extends T> enumeration;

  public IterableEnumeration(final Enumeration<? extends T> e)
  {
    enumeration = e;
  }

  ... 
```

和

```
class EnumerationIterator<T>
  implements Iterator<T>
{

  private final Enumeration<? extends T> enumeration;

  public EnumerationIterator(final Enumeration<? extends T> e)
  {
    enumeration = e;
  }

  ... 
```

这些变化基本上意味着，*“`IterableEnumeration<T>`可以与`Enumeration`任何子类型的`T`.*

# java - 在 Java (metro) 中消费 .NET webservice - XMLNode/XMLDocument 消费？

> ID：620943
> 
> 赞同：-2
> 
> 时间：2009-03-07T00:03:23.840
> 
> 标签：java, .net, xml, jax-ws, java-metro-framework

我的 Java 有点生疏，这是我第一次使用 Metro/JAX-WS，所以如果这是一个愚蠢的问题，我深表歉意。

我必须编写一个使用 .NET Web 服务的客户端。我已经掌握了基础知识；我已经从 WSDL 生成了包装器，我可以创建我的对象和端口并进行调用并获得响应。

```
 Widgets d = new Widgets();
    WidgetsSoap dp = d.getWidgetsSoap();
    ((BindingProvider)dp).getRequestContext(). put(javax.xml.ws.BindingProvider.ENDPOINT_ADDRESS_PROPERTY, "http://actualsite/foo.asmx");

    UserGetWidgetsResponse.UserGetWidgetsResult j = dp.userGetWidgets(); 
```

Web 服务的返回值几乎都是 XmlDocument 或 XmlNode。如何从 wsimport 生成的“UserGetWidgetsResponse.UserGetWidgetsResult”到调用返回的实际 XML？

我有很多这样的服务和一堆方法，所以我希望找到一个不需要以任何方式修改生成的包装器的解决方案。我也无法控制 Web 服务返回的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T14:18:34.720

我在周末找到了解决方案，但我不确定它是否是正确的解决方案：

```
 UserGetDevicesResponse.UserGetDevicesResult j = dp.userGetDevices();
    List<Object> n = j.getContent();
    if (n.size() > 0)
    {
        Node z = (Node)n.get(0);
        System.out.println(nodeToString(z));
    } 
```

这给了我想要的 XML 文档响应。然后我可以在树上执行任何我想要的操作来提取我正在寻找的数据。

# sql-server - Visual Basic 登录表单查询

> ID：620945
> 
> 赞同：0
> 
> 时间：2009-03-07T00:04:00.373
> 
> 标签：sql-server, vb6

```
Private Sub cmdOK_Click()
 Adodc1.Recordset.MoveFirst
 Do While Not Adodc1.Recordset.EOF
        If Adodc1.Recordset.Fields(0) <> txtuser.Text Or Adodc1.Recordset.Fields(1) <>   txtPassword.Text Then

            MsgBox "Please verify login details", vbInformation + vbOKOnly, "Login Denied"
            txtuser.SetFocus
            txtuser.Text = ""
            txtPassword.Text = ""
        Else
            Unload Me
            Load Main
            Main.Show
        End If
        Adodc1.Recordset.MoveNext
        Loop
End Sub 
```

如果有人查看上面的代码片段并告诉我是否需要进行任何更改，我将不胜感激！这是我用于连接到 SQL SERVER 2005 DB 的登录表单的代码！现在为什么这不起作用？似乎只从两列的第一行获取数据，而不是后面的行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T00:09:38.317

我会退后一步，重写所有这些。您应该向数据库发送用户名和密码，而不是向您的应用程序发送每个用户名和密码并循环访问它。让 DBMS 为您完成工作。我还建议您不要将密码存储为纯文本（就像您正在做的那样）。此信息是一般信息，可以通过搜索找到，但如果您遇到特定问题，请回复。

# .net - 搜索 NTFS 目录 .NET

> ID：620949
> 
> 赞同：1
> 
> 时间：2009-03-07T00:08:44.967
> 
> 标签：.net, search, ntfs

我想写一个网页，用户可以在其中搜索 NTFS 上的目录以获取某些条件并显示结果。

目录是否必须被索引？

是否有可用于查询目录的 .NET 可访问 Windows 搜索 API？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T00:14:28.883

你得到的只是 System.IO.DirectoryInfo，它甚至没有内置搜索功能。

大多数人最终会编写一个递归方法，在每个 DirectoryInfo 上调用 getDirectories 和 getFiles。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T03:51:10.303

[这](http://dotnetzip.codeplex.com/SourceControl/changeset/view/29860#442559)是一个名为 FileSelector 的可重用类，它根据名称（使用通配符）、大小、时间戳和属性进行文件选择。

用法是这样的：

```
 Ionic.FileSelector ff = new Ionic.FileSelector(selectionCriteria);
   var filesToAdd = ff.SelectFiles(directoryOnDisk, recurseDirectories); 
```

selectionCriteria 是这样的：

```
*.txt
name = *.txt
size > 10000
name = *.txt and size > 20000
attributes = H and name = *.doc
name = *.cs~ and mtime < 2009-02-14
mtime < 2009-01-01 and (name = *.cs or name = *.vb)
(name = '* Report.docx'  or  name = *.pptx) 
```

...其中 mtime 表示“上次写入时间”，atime 表示“上次访问时间”，ctime 表示“创建时间”，而 attributes 指的是 NTFS 属性集，如 System、Hidden、Readonly、Archive 和 ContentIndexed (S, H、R、A、I)。

仅当存在中间空格时，文件名模式周围才需要单引号。

您可以获取此文件选择器类的源代码并在任何地方使用它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T00:22:39.753

[您可以通过这种方式](http://www.winnershtriangle.com/w/CSharpHelp_WindowsIndexingService.asp)使用 Windows 搜索 API ，但我不太喜欢这种方式。

如果您有时间自己索引目录，我建议您尝试[Lucene.net](http://incubator.apache.org/lucene.net/)，它肯定比 windows 索引服务更快。

无论如何，最短的方法是使用 System.IO.DirectoryInfo.GetDirectories。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T00:27:58.570

DirectoryInfo.GetFiles 确实支持通过子目录递归。它是重载方法之一。它只允许您按文件名过滤。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-07T01:07:22.063

如果您使用的是 .NET 2.0 或更高版本（和 VB.Net），那么您可以使用 [My.Computer.FileSystem.GetFiles Method](http://msdn.microsoft.com/en-us/library/t71ykwhb(VS.80).aspx)。这个方法有三个参数：

*   目录
*   搜索类型（枚举）
*   通配符

[SearchType 枚举](http://msdn.microsoft.com/en-us/library/ms172906%28VS.80%29.aspx)有两个值，其中之一是**SearchAllSubDirectories**。所以 1 方法返回所有匹配的文件（名称）的只读字符串集合。

如果您使用的是 C#，那么您可以使用[DirectoryInfo.GetFiles Method](http://msdn.microsoft.com/en-us/library/ms143327.aspx)。DirectoryInfo.GetFiles 只有 2 个参数：

*   搜索模式
*   搜索选项

如果您为 SearchOption 指定**AllDirectories**，您将获得类似的结果。

主要区别在于 FileSystem.GetFiles 作为字符串集合返回，而 DirectoryInfo.GetFiles 返回 FileInfo 对象数组。

# python - 你知道任何用于语法高亮的 python 组件吗？

> ID：620954
> 
> 赞同：1
> 
> 时间：2009-03-07T00:10:37.800
> 
> 标签：python, components, syntax-highlighting

是否有任何易于使用的 Python 组件可以在 GUI 中使用？如果有像 Python 的 JSyntaxPane 这样的东西会很棒。我想知道仅限 python 的版本（对 jython 不感兴趣）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-07T00:21:01.473

除了 pygments 吗？ [http://pygments.org/](http://pygments.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T00:25:33.007

如果您使用的是 gtk+，则在[gnome-python-extras](http://ftp.gnome.org/pub/GNOME/sources/gnome-python-extras/2.25/)中有 Python 的 gtksourceview 绑定。根据我的经验，它似乎运作良好。缺点：文档不够完善。

如果您喜欢 PyQt，那么还有一个用于 Python 的[QScintilla绑定。](http://www.riverbankcomputing.co.uk/software/qscintilla/intro)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T00:42:14.760

您可以在[wxPython中使用](http://www.wxpython.org)[StyledTextCtrl](http://www.wxpython.org/docs/api/wx.stc.StyledTextCtrl-class.html)。查看官方演示以获取示例（任何演示的*演示代码*选项卡）。

 ** * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-22T19:26:34.347

您说“在 GUI 应用程序中”，但没有提及工具包。

如果您正在使用 PyQt，并且需要一个只读小部件，您可以使用 QWebKit，它基于 WebKit 包含一个完整的 HTML 小部件，因此它几乎支持任何东西，从 flash 到 ACID2 测试。

如果你想要一个读写小部件，Qt 的 QTextEdit 支持语法高亮，我写了一个适配器让 pygments 使用它：

[http://lateral.netmanagers.com.ar/weblog/2009/09/21.html#BB831](http://lateral.netmanagers.com.ar/weblog/2009/09/21.html#BB831)

我确信可以使用其他工具包完成类似的操作，但我不知道如何。

# c# - 获取堆栈跟踪

> ID：620959
> 
> 赞同：6
> 
> 时间：2009-03-07T00:12:59.153
> 
> 标签：c#, debugging, stack-trace, printstacktrace

当发生异常时，您可以打印出 StackTrace 并查看它。

如果您想在不发生异常的情况下获取 StackTrace 怎么办？

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-07T00:13:45.517

您可以随时通过调用[Environment.StackTrace打印出堆栈跟踪](http://msdn.microsoft.com/en-us/library/system.environment.stacktrace.aspx)

```
string tracktrace = System.Environment.StackTrace; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-07T00:23:42.323

当您捕获异常时，您可以构造[StackTrace](http://msdn.microsoft.com/en-us/library/system.diagnostics.stacktrace(VS.71).aspx)对象并从中提取有用的信息。请参见以下示例：

```
 StackTrace st = new StackTrace(true);
        for(int i =0; i< st.FrameCount; i++ )
        {
            // Note that high up the call stack, there is only
            // one stack frame.
            StackFrame sf = st.GetFrame(i);
            Console.WriteLine();
            Console.WriteLine("High up the call stack, Method: {0}",
                sf.GetMethod());

            Console.WriteLine("High up the call stack, Line Number: {0}",
                sf.GetFileLineNumber());
        } 
```

PS：即使没有异常也可以使用 - 请参阅[How to print the current stack trace in .NET without any exception](https://stackoverflow.com/questions/531695/how-to-print-the-current-stack-trace-in-net-without-any-exception)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T01:04:52.227

System.Environment.StackTrace 是一个很棒的工具，但请注意，您并不总能得到您想要的东西，而且 x86 和 x64 平台之间存在可能影响输出的差异。 [格罗迪细节在这里](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2008/11/24/stupid-nunit-tricks-3-foiled.aspx)。

# ruby-on-rails - Ruby on Rails 中的“返回”浏览器操作

> ID：620962
> 
> 赞同：69
> 
> 时间：2009-03-07T00:13:39.633
> 
> 标签：ruby-on-rails, browser

可以从 Rails 的“返回”链接调用“返回”浏览器功能吗？

* * *

## 回答 #1

> 赞同：204
> 
> 时间：2009-03-07T00:17:03.620

采用

```
<%= link_to 'Back', :back %> 
```

[这在此处](http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001565)的 RDoc 中有具体说明

这会生成一些 Javascript 来向后导航。我刚刚测试了它，它可以工作。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-03-07T00:20:45.310

在 Rails 3 及更早版本中：

```
link_to_function "Back", "history.back()" 
```

在 Rails 4 中，此方法已被删除。见安德烈亚斯的评论。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2017-10-06T15:21:56.110

这与 Turbolinks 一起在 Rails 5.1 中工作。

```
link_to 'Back', 'javascript:history.back()' 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-05-01T04:18:31.667

在 Rails 4.2 中，我得到了它：

```
<a href="javascript:history.back()">Refine Search</a> 
```

我从[@cpm 的答案](https://stackoverflow.com/a/620985/)中偷了这个，除了`link_to("Refine Search", :back)`在粘贴生成的代码时没有完成我想要的工作`<a href="javascript:history.back()">Refine Search</a>`。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-07T00:27:33.937

您可以使用`link_to("Hello", :back)`来生成`<a href="javascript:history.back()">Hello</a>`.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-07-30T07:15:47.037

这将与浏览器后退按钮类似地工作尝试这个

`<%= link_to 'Back', 'javascript:history.go(-1);' %>`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-03-18T07:28:09.647

注意用户[rthbound的](https://stackoverflow.com/users/1152759/rthbound)[这条评论](https://stackoverflow.com/users/1152759/rthbound)！正如他所指出的，使用符号并不总是会生成“真实”的返回事件，就像用户单击浏览器的返回按钮一样。它也可以是重新提交加载当前视图的操作。`link_to``:back`

[Rails 4.2.6](http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to)的文档说明了这一点`link_to`和`:back`符号：

> 使用`:back`符号而不是选项哈希将生成指向引荐来源网址的链接（如果不存在引荐来源网址，将使用 JavaScript 反向链接代替引荐来源网址）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-11T17:28:34.607

#### 导轨 <= 4.0

使用

```
link_to_function "Back", "history.back()" 
```

似乎就像在浏览器中点击后退按钮一样。当您返回时，所有输入的表单数据仍然存在。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-10-18T14:17:15.063

如果你喜欢我不想要你的行为，`link_to "cancel", :back`可以实现一个辅助方法，它可以链接到记录索引路径或显示路径。（即`teams_path`或`team_path(@team)`

```
module CancelFormButtonHelper
  def cancel_button(record)
    index_path = record.class.to_s.pluralize.downcase + "_path"
    path = record.persisted? ? record : eval(index_path)

    link_to "Cancel", path
  end
end 
```

例如，它可以`<%= cancel_button @team %>`在表格中使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-05-11T13:46:27.360

你可以使用js函数window.history.back()

```
 = link_to 'Back', onclick: "window.history.back();" 
```

# sharepoint - 如何在 Sharepoint Web 应用程序中部署 web.config 修改？

> ID：620978
> 
> 赞同：4
> 
> 时间：2009-03-07T00:21:46.137
> 
> 标签：sharepoint, sharepoint-2007

我在 Sharepoint 2007 中有一个网站。我们使用 wsp 来部署我们的项目。我们可以部署 dll、用户控件、功能，但我不知道如何在 web.config 中包含新行。

在 web.config 中进行更改的可能方法是什么？

另一件事，我如何在 wsp 中包含资源（resx）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T02:00:52.717

在多服务器场中手动编辑 web.config 是个坏主意。确保 web.config 文件在每个 WFE 上保持同步将很快成为一场噩梦。

使用 SPWebConfigModification 类来管理整个场中的 web.config 更改是一个好主意，因为更改将保留在 SharePoint 配置数据库中，并自动推送到场中的每个服务器。

话虽如此，针对类进行编码可能会很痛苦。幸运的是，有一个[非常好的免费提供的前端](http://spwebconfigmodif.codeplex.com/)，它为您在管理中心提供了一个配置屏幕来添加/删除 web.config 更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T02:54:41.917

有一种非常简单的方法可以通过解决方案添加安全控制条目。添加到 manifest.xml 的以下代码段将对 web.config 文件进行相关修改。要设置其他值，您应该使用[SPWebConfigModification](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spwebconfigmodification.aspx)类在功能接收器中进行。

```
<Assemblies>
  <Assembly ...>
     <SafeControl Namespace=".." Assembly="..." Type="..." Safe="True" />
  </Assembly>
  ....
</Assemblies> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T11:03:23.203

此外，如果您考虑使用 web.config 中的 appSettings 作为站点配置值，您实际上还有其他选择。由于各种原因，web.config 可能并不总是放置您的值的最佳位置 - 至少如果“超级用户”等应该能够在以后更改它们的话。为此，您可以改为使用 Config Store 功能，该功能还可以在整个场中针对多个前端服务器等进行扩展：

[http://www.sharepointnutsandbolts.com/2008/05/introducing-sharepoint-config-store-for.html](http://www.sharepointnutsandbolts.com/2008/05/introducing-sharepoint-config-store-for.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T01:16:08.110

关于 web.config 文件...

Web.config 是一个 XML 文档，其中包含 Web 应用程序的配置设置。它位于 Web 应用程序的根目录中，因此对于 SharePoint，它通常位于文件夹 C:\Inetpub\wwwroot\wss\VirtualDirectories\SharePoint80 中，其中 SharePoint80 是您的 Web 应用程序的名称。

只要您保持标签和部分的顺序正确，手动编辑 web.config 文件是安全的。看看[这篇文章](http://msdn.microsoft.com/en-us/library/w7w4sb0w.aspx)。

也可以以编程方式对其进行更改，[这篇文章](http://www.crsw.com/mark/Lists/Posts/Post.aspx?ID=32)应该向您展示如何进行。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T01:24:50.553

我认为当你有多个服务器时，直接的 web.config 操作会变得很棘手。如果您的整个安装仅在几台服务器上，那么这样做可能比尝试通过代码进行简单的 web.config 更改更容易。

此外，直接操作 web.config 可确保您在源代码控制系统中拥有完整的 web.config。如果您使用 API 进行更改，那么您在源代码管理中所拥有的只是一堆您希望没有错误的 C# 代码！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-14T09:20:11.657

我的建议是不要通过代码进行任何手动修改。相反，通过将修改放在 12\Config 目录[中，如 Microsoft 的 SharePoint 文档中所述，](http://msdn.microsoft.com/en-us/library/ms439965.aspx)按照“SharePoint 方式”执行操作。

# php - 将博客添加到现有网页

> ID：620987
> 
> 赞同：9
> 
> 时间：2009-03-07T00:28:30.113
> 
> 标签：php, wordpress

如何将博客（尚未创建）插入到已经存在的“静态”网页中？该网页主要是用 PHP 编写的。我正在考虑使用 wordpress.org（主机安装版本）之类的东西并使用它来更新网站的新闻页面。

根据我的阅读，听起来我需要做很多主题调整才能让 WordPress 正确显示在我们网站的模板中。这对我来说听起来有点吓人。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T06:03:08.063

[我在我的网站](http://echoreply.us)上做了同样的事情。我有大约 20 个静态页面，想添加一个博客，并希望将 WP 页面中的内容添加到静态页面。找到一个（几乎）与我的静态页面匹配的主题并不难。/tech/ 之外的所有内容都是静态页面。

您还可以获得一个非常简约的主题，然后使其与您的设计相匹配。这是 CSS 的一大堆剪切和粘贴，重新标记元素以匹配 WP 想要的内容，然后进行一些调整。我在其他网站上不到 8 小时就完成了。

阅读使用[Wordpress 循环](http://codex.wordpress.org/The_Loop)。这比你想象的要容易得多，特别是如果你的东西已经用 PHP 完成了。

**编辑：**

这是我在静态页面中使用的代码片段，它允许我在现有代码中使用所有其他 WP 函数：

```
<?php
    if ( empty( $wp ) )
       require_once( "tech/wp-config.php" );
    wp();
?> 
```

然后，获取最近的帖子列表很简单：

```
<?php get_archives( 'postbypost', 8 ); ?> 
```

请注意使用已弃用的功能，两年前集成 WP 时，我还有一些需要清理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T05:48:45.803

Greg 是对的，iframe 是一种简单的方法。但是，我遇到过 iframe 会在 IE 中抛出会话变量的情况，不确定这是否会影响 WordPress。

如果您要创建一个页面来在 iframe 中安装 WordPress，为什么不只使用用于显示带有 iframe 的页面的链接只是链接到 WordPress 安装所在的单独子域？

我的猜测是，如果您想将 WordPress 放入 iframe 中，您并不想在主题开发方面做很多事情。如果是这种情况，您有几个选择：(a) 谷歌搜索空白 wordpress 主题，(b) 开发一个看起来像您当前站点的主题，这样当用户点击链接时，他们不会知道他们在不同的平台上，(c) 不要隐藏任何东西，让 WordPress 安装以不同的主题显示。考虑一下美国运通在其 OPEN 论坛站点 ( [http://www.openforum.com/](http://www.openforum.com/) ) 中的博客，其博客位于[http://blogs.openforum.com/](http://blogs.openforum.com/) - 标题相同，正文和布局略有不同。

使用 iframe 路线的问题是 WordPress 网站的高度会增长，您必须在其中设置 iframe 的高度。您可以通过将高度设置为非常大的值来控制这一点，但是您的页面会非常大，或者您可以控制显示在 WordPress 管理员中的帖子数量。

我的建议，废弃 iframe，在子域上安装您的 WordPress，然后链接到该子域而不是链接到您的 iframe 页面

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:26:35.557

我现在正在尝试使用我正在修补的网站（尚未公开）。我没有直接在我的网站上发布博客，而是链接到由 Google Blogger 托管的博客。

Google 还提供了“ [AJAX 搜索 API](http://code.google.com/apis/ajaxsearch/) ”，我用它来嵌入静态网页。我生成了指向我博客的动态链接。因为链接是由 AJAX 搜索生成的，所以它总是显示最近的条目。这是使您的网站保持静态的好方法，同时也包含在其他地方托管的动态内容。

当然，这将有助于设计您的博客以匹配您的主站点的品牌。如果您可以使用 iframe 或通用导航栏使其无缝衔接，则可加分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-12T09:59:43.317

通常使用 WordPress 博客并用它重新创建静态网站的其余部分可能更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-16T20:00:37.743

你也可以通过在你的服务器上安装 wordpress，将 wordpress 主题削减到它的骨架，在 wordpress 主题之上添加你自己的样式、标题、导航栏等，然后将它作为一个页面链接到你的地点。这看起来比使用 iframe 更干净，并且比使用循环更容易做到。查看以下链接以获取有关如何执行此操作的说明（以这种方式方便地写在博客设置中）：

[http://www.nubaria.com/en/blog/?p=14](http://www.nubaria.com/en/blog/?p=14)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T02:54:57.313

一个简单的解决方案是简单地添加一个 iframe 并将博客站点放入其中。它几乎不需要代码，博客条目就会出现。

至于代码选项，我会看一个 RSS 阅读器，比如这个： [http ://www.scriptol.com/rss/rss-reader.php](http://www.scriptol.com/rss/rss-reader.php)

一些代码，但您通过 RSS 阅读博客条目并显示您想要的内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-07T09:02:45.103

我为此使用了[SnewsCMS](http://snewscms.com/)，将新闻部分集成到静态 php 页面中很简单。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-07T11:21:38.700

使用[Blogger](http://www.blogger.com)服务，您可以将其设置为通过 FTP 将博客发布到您的站点。但是您仍然必须自定义模板。不过这应该很容易，他们有一个接口。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-08T00:56:30.520

当我不得不将博客添加到现有网站上时，我使用了[textpattern](http://textpattern.com/)。我发现它很容易定制，因为它非常轻量级和简单。在我看来，它比 Wordpress 好用得多，尽管标记样式不太人性化，而且它缺少 whizz-bang 插件、主题等。

我只是将它安装在它自己的目录中，因此文章间链接可以正常工作，并将必要的 textpattern 内容嵌入到我自己的页面布局中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-12T11:59:23.517

你也可以通过在你的服务器上安装 wordpress 来做到这一点，将 wordpress 主题削减到它的骨架，添加你自己的样式、标题、导航栏等

# java - 在Java中确定二进制/文本文件类型？

> ID：620993
> 
> 赞同：47
> 
> 时间：2009-03-07T00:31:04.477
> 
> 标签：java, file, text, binary

即，您将如何从文本（xml/txt，与编码无关）文件中区分存档（jar/rar/etc.）文件？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-07T00:35:27.350

没有保证的方法，但这里有几种可能性：

1.  在文件中查找标题。不幸的是，标头是特定于文件的，因此虽然您可能会发现它是一个 RAR 文件，但您不会得到更通用的答案，即它是文本还是二进制文件。

2.  计算字符与非字符类型的数量。文本文件将主要是字母字符，而二进制文件——尤其是压缩文件，如 rar、zip 等——将倾向于更均匀地表示字节。

3.  寻找定期重复的换行符模式。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2016-10-06T19:02:53.273

使用 Java 7 文件类[http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType(java.nio.file.Path)](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType(java.nio.file.Path))

```
boolean isBinaryFile(File f) throws IOException {
        String type = Files.probeContentType(f.toPath());
        if (type == null) {
            //type couldn't be determined, assume binary
            return true;
        } else if (type.startsWith("text")) {
            return false;
        } else {
            //type isn't text
            return true;
        }
    } 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-10-21T06:39:18.130

运行`file -bi {filename}`。如果它返回的任何内容都以'text/'开头，那么它是非二进制的，否则它是。;-)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-11-23T17:16:05.293

我做了这个。稍微简单一点，但对于基于拉丁语的语言，它应该可以正常工作，并调整比率。

```
/**
 *  Guess whether given file is binary. Just checks for anything under 0x09.
 */
public static boolean isBinaryFile(File f) throws FileNotFoundException, IOException {
    FileInputStream in = new FileInputStream(f);
    int size = in.available();
    if(size > 1024) size = 1024;
    byte[] data = new byte[size];
    in.read(data);
    in.close();

    int ascii = 0;
    int other = 0;

    for(int i = 0; i < data.length; i++) {
        byte b = data[i];
        if( b < 0x09 ) return true;

        if( b == 0x09 || b == 0x0A || b == 0x0C || b == 0x0D ) ascii++;
        else if( b >= 0x20  &&  b <= 0x7E ) ascii++;
        else other++;
    }

    if( other == 0 ) return false;

    return 100 * other / (ascii + other) > 95;
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-07T12:38:36.300

看看[JMimeMagic](https://github.com/arimus/jmimemagic)库。

> jMimeMagic 是一个 Java 库，用于确定文件或流的 MIME 类型。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-07-14T12:49:51.607

**我使用了这段代码，它非常适用于英语和德语文本：**

```
private boolean isTextFile(String filePath) throws Exception {
    File f = new File(filePath);
    if(!f.exists())
        return false;
    FileInputStream in = new FileInputStream(f);
    int size = in.available();
    if(size > 1000)
        size = 1000;
    byte[] data = new byte[size];
    in.read(data);
    in.close();
    String s = new String(data, "ISO-8859-1");
    String s2 = s.replaceAll(
            "[a-zA-Z0-9ßöäü\\.\\*!\"§\\$\\%&/()=\\?@~'#:,;\\"+
            "+><\\|\\[\\]\\{\\}\\^°²³\\\\ \\n\\r\\t_\\-`´âêîô"+
            "ÂÊÔÎáéíóàèìòÁÉÍÓÀÈÌÒ©‰¢£¥€±¿»«¼½¾™ª]", "");
    // will delete all text signs

    double d = (double)(s.length() - s2.length()) / (double)(s.length());
    // percentage of text signs in the text
    return d > 0.95;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-07T01:29:22.010

如果文件由字节 0x09（制表符）、0x0A（换行）、0x0C（换页）、0x0D（回车）或 0x20 到 0x7E 组成，那么它可能是 ASCII 文本。

如果文件包含任何其他 ASCII 控制字符，0x00 到 0x1F 不包括上述三个，那么它可能是二进制数据。

UTF-8 文本对于任何具有高位的字节都遵循非常特定的模式，但像 ISO-8859-1 这样的固定长度编码则不遵循。UTF-16 可以经常包含空字节 (0x00)，但只能在其他位置。

对于其他任何事情，您都需要一个较弱的启发式。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-15T02:12:53.287

只是为了让你知道，我选择了一条完全不同的道路。我的情况是，只有两种类型的文件，任何给定文件都是二进制文件的可能性很高。所以

1.  假设文件是​​二进制文件，尝试做应该做的事情（例如反序列化）
2.  捕捉异常
3.  将文件视为文本
4.  如果失败，则文件本身有问题

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-07T01:26:16.357

见[http://en.wikipedia.org/wiki/Magic_number_(programming)](http://en.wikipedia.org/wiki/Magic_number_(programming))

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-05-19T07:42:41.340

你可以试试 Apache Tika，我已经[专门为此功能打开了一个请求](https://issues.apache.org/jira/browse/TIKA-3409)

但就目前而言，我认为这可能有效......需要更彻底的测试，也可能存在其他 mime 类型库的问题，在这些库中，您仍然需要从类型到是否为二进制的映射。

```
var config = TikaConfig.getDefaultConfig();
var tika = new Tika( config );
var mimeTypes = config.getMimeRepository();

var mimetype = tika.detect(Path.of("my/foo"));
var rootType = mimeTypes.forName( mime ).getType().getType();
rootType.endsWith( "text" ); // text and x-text 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-07T00:43:54.693

你可以试试[DROID](http://droid.sourceforge.net/)工具。**********`*