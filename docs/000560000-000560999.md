# StackOverflow 问答 000560000-000560999

# .net - vb.net倒计时

> ID：560001
> 
> 赞同：0
> 
> 时间：2009-02-18T05:59:20.160
> 
> 标签：.net, vb.net, timer

我正在尝试在我的应用程序中制作倒数计时器。我已经知道倒计时时间是 4 分钟。我有一个`Timer`每秒滴答的声音。现在，我如何更新我的`TextBox`，以便它显示格式中的剩余时间`HHMMSS`？

编辑：我遇到的问题是计算剩余时间。我应该使用什么？时间戳？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T06:05:52.157

在开始倒计时之前，请使用类似的方式记下当前时间

```
Dim endTime as DateTime = DateTime.Now.Add(TimeSpan.FromMinutes(4)) 
```

然后，当您的滴答事件发生时，您可以计算出还剩多少时间使用

```
Dim timeLeft as TimeSpan = endTime.Subtract(DateTime.Now) 
```

您可以根据需要格式化 timeLeft，可能使用 Jared 提到的 .ToString("hh:mm:ss")

您可以阅读有关[TimeSpan](http://msdn.microsoft.com/en-us/library/system.timespan.aspx)和[DateTime](http://msdn.microsoft.com/en-us/library/system.datetime.aspx)的文档，以获取有关如何使用它们的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T06:04:35.217

跟踪时间的最佳方法是使用 DateTime.Now 记录开始时间。然后您可以通过减去保存的值随时看到差异。

```
Dim diff = DateTime.Now - savedTime
Dim remaining = TimeSpan.FromMinutes(4) - diff 
```

要获得您想要的格式，只需将其作为字符串传递给 .ToString 函数

```
Dim readable = remaining.ToString("hh:mm:ss") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T06:00:48.753

为计时器添加一个事件处理程序并让它计算剩余时间，格式化字符串并更新文本框。

要跟踪时间并计算差异，您可以使用 Environment.TickCount - 这是最简单的变体。在开始倒计时时保存时间戳，并在每次调用事件处理程序时获取它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T17:46:46.437

```
Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
    Timer1.Interval = 500
    Timer1.Start()
End Sub
Dim stpw As New Stopwatch
Dim CountDownFrom As Integer = 4 * 60 'as seconds
Dim CountDown As New TimeSpan
Private Sub StartCountDown()
    CountDown = TimeSpan.FromSeconds(CountDownFrom)
    stpw.Stop() : stpw.Reset() : stpw.Start()
End Sub
Private Sub Timer1_Tick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Timer1.Tick
    If Not stpw.IsRunning Then Exit Sub
    Dim TimeRemaining As TimeSpan = CountDown - stpw.Elapsed
    Label1.Text = TimeRemaining.Hours.ToString.PadLeft(2, "0"c) & ":" & _
                    TimeRemaining.Minutes.ToString.PadLeft(2, "0"c) & ":" & _
                    TimeRemaining.Seconds.ToString.PadLeft(2, "0"c)
    If TimeRemaining.TotalMilliseconds <= 0 Then stpw.Stop()
End Sub
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    StartCountDown()
End Sub 
```

# audio - 压缩和未压缩的 .wav 文件

> ID：560011
> 
> 赞同：5
> 
> 时间：2009-02-18T06:06:36.710
> 
> 标签：audio, wav

压缩和未压缩的 .wav 文件有什么区别？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T06:18:05.857

[WAV 格式](http://en.wikipedia.org/wiki/WAV)是 Windows 中音频文件的容器格式。

WAV 文件由标题和内容组成。标头包含有关大小、持续时间、采样频率、分辨率以及有关 WAV 文件中包含的音频的其他信息的信息。通常，在标头之后是实际的音频数据。

由于 WAV 是一种容器格式，它所包含的数据可以以各种格式存储。其中之一是未压缩的[PCM](http://en.wikipedia.org/wiki/Pulse-code_modulation)，但它也可以存储[ADPCM](http://en.wikipedia.org/wiki/ADPCM)、[MP3和其他格式，如果该格式的](http://en.wikipedia.org/wiki/MP3)[音频编解码器](http://en.wikipedia.org/wiki/Codec)可用，则可以读取和写入。

压缩和未压缩的 WAV 文件之间的区别在于，WAV 文件中包含的数据要么是未压缩的原始音频样本，要么是使用音频编解码器压缩的，在这种情况下，必须解压缩才能播放。

进一步阅读：

*   [维基百科：音频压缩（数据）](http://en.wikipedia.org/wiki/Audio_data_compression)
*   [维基百科：WAV](http://en.wikipedia.org/wiki/WAV)
*   [维基百科：编解码器](http://en.wikipedia.org/wiki/Codec)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T06:11:00.913

[这里](http://en.wikipedia.org/wiki/.WAV_file)有一个很好的解释。基本区别在于未压缩的波形文件在“出现”时只有原始位。没有做任何事情来压缩或收缩它们。压缩的波形文件使用某种编解码器在将数据放入文件之前缩小数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-28T01:27:41.630

这两件事之间的区别基本上在于对象的大小，压缩后的大小可能比未压缩的小，内容基本相同。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-18T07:18:54.930

在谈论媒体时使用“未压缩”一词时必须非常小心。

基本上所有数字媒体都以某种方式压缩。音频，或视频。不管它是什么，它都会以某种方式被压缩。它固有的从模拟转换为数字。

问题不是真正的技术问题，而是语言问题。

人们认为未压缩意味着“没有做任何事情”，而实际上您确实没有任何方法可以做到这一点。当您将来自麦克风的模拟信号转换成文件时，总会进行某种压缩……这是必不可少的。

未压缩意味着非常高质量。不同的“未压缩”编解码器做的事情也不同。

我对视频编解码器了解更多，因此我将以此为基础。

Black Magic（一家生产视频输出卡的公司）有一个未压缩的编解码器。这很好。制作精美的图像..但它并不是真正的“未压缩”。当然它很大。但是将它与 TIFF 图像序列的 DPX 进行比较……它并没有那么大，而且被压缩得很厉害。它只有 10 位，但像 OpenEXR 图像序列之类的东西就像 32 位......并且来自电影，在技术上仍然是压缩的。它一定要是。

这只是野兽的本性。

# php - Zend Framework 中有处理文件上传的函数吗？

> ID：560014
> 
> 赞同：0
> 
> 时间：2009-02-18T06:09:18.280
> 
> 标签：php, zend-framework, file-upload

Zend Framework 使开发变得更加容易；例如 Zend_Http 有一个 getPost 函数来处理 POST 参数。

有没有类似处理文件上传的东西？我可以直接访问 $_FILES，但我宁愿使用内置函数来保持一致。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T10:06:50.597

您可以使用 Zend_Form_Element_File，它具有与 Zend_File_Transfer 非常相似的功能，并且可以正常工作。

[http://framework.zend.com/manual/en/zend.form.standardElements.html#zend.form.standardElements.file](http://framework.zend.com/manual/en/zend.form.standardElements.html#zend.form.standardElements.file)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T06:14:18.703

您可以使用 Zend_Form 进行文件上传。教程[在这里](http://akrabat.com/2008/04/07/simple-zend_form-file-upload-example/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T06:43:39.990

阅读有关[`Zend_File_Transfer`](http://framework.zend.com/manual/en/zend.file.html#zend.file.transfer.introduction). 这能满足你的需要吗？

# iphone - 不可预测地影响导航栏的旋转

> ID：560016
> 
> 赞同：1
> 
> 时间：2009-02-18T06:09:40.493
> 
> 标签：iphone, cocoa-touch

这是我的设置：一个导航​​控制器，两个视图

第一个视图，根视图，显示状态栏和导航栏（纵向视图）。当 rootviewController 感知到旋转时，它会隐藏导航栏和状态栏，然后将视图 2 推送到导航控制器上（现在为横向）。

这部分按预期工作。

当 View2 视图控制器感应到旋转（回到纵向）时，它会弹出导航控制器本身，显示视图 1。然后视图 1 取消隐藏状态栏和导航栏。从这里开始，它变得很奇怪。根据我何时取消隐藏导航栏，我会得到奇怪的结果。正如你在下面看到的（烧杯照片应该就在屏幕顶部的导航栏下方）。

我尝试在以下位置取消隐藏导航栏：

*   视图 2 的 viewWillRotate/viewDidRotate
*   视图 1 的 viewWillAppear/viewDidAppear
*   导航控制器中的 poptoRootView （我子类化只是为了尝试）

没有任何效果。任何想法是怎么回事？这应该很简单，但也许我在错误的地方做事。

![拙劣的屏幕](https://farm4.static.flickr.com/3642/3289929946_6eca8bed6c.jpg?v=0)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T06:56:23.783

检查您笔尖中所有视图的自动调整大小蒙版，并确保其全部设置正确。如果你有任何不应该的方式，它会在旋转时发疯。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T13:19:04.097

不知道为什么它是必要的，但是当你交换视图时，你必须对你的视图应用一个转换（只有 1 个视图 iPhone 会为你做这个），你必须设置它的边界。

这是应该为您工作的代码（在 willAnimateFirstHalfOfRotationToInterfaceOrientation 上）：

```
#define degreesToRadians(x) (M_PI * (x) / 180.0)
if (UIInterfaceOrientationIsLandscape(toInterfaceOrientation)) {
    self.view = landscapeView;
    self.view.transform = CGAffineTransformIdentity;
    self.view.transform = CGAffineTransformMakeRotation(degreesToRadians(90));
    self.view.bounds = CGRectMake(0.0, 0.0, 480.0, 320);

} else {
    self.view = portraitView;
    self.view.transform = CGAffineTransformIdentity;
    self.view.transform = CGAffineTransformMakeRotation(degreesToRadians(0));
    self.view.bounds = CGRectMake(0.0, 0.0, 300, 480);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T03:33:26.377

最后，我重新设计了我的应用程序。（使用模态视图控制器）

但是我遇到了类似的问题，而是状态栏所在的空白区域。

我认为这两个问题都可以归因于在旋转/调整视图大小时没有与导航控制器交谈（相反，我是在与 ViewController 交谈。

有关我如何解决问题的详细信息：

[iPhone + CGAffineTransFormRotate(pi/2) + statusBarHidden:YES + presentModalViewController = 20 像素的空白](https://stackoverflow.com/questions/563956/iphone-cgaffinetransformrotatepi-2-statusbarhiddenyes-presentmodalviewco/568174#568174)

# asp.net - ASP.NET 中继器模板，每 N 个元素的条件代码

> ID：560023
> 
> 赞同：14
> 
> 时间：2009-02-18T06:14:50.543
> 
> 标签：asp.net, webforms, repeater, itemtemplate

我正在使用 asp.net 中继器来创建一堆图像。图像标记都是一样的，所以标准`<ItemTemplate>`很好。

但是，我想将 K 图像包装在一个 div 中。假设我将 25+ 图像绑定到中继器，并且我想要每个 div 5 图像。如何有条件地为 div 创建开始和结束标签？

这是一个更适合 for 循环的案例吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-18T18:37:22.397

这应该对您有用，不需要后面的代码中的任何内容（除了绑定中继器..）：

```
<asp:Repeater ID="repImages" runat="server">
<HeaderTemplate><div></HeaderTemplate>

<ItemTemplate>
<%# (Container.ItemIndex != 0 && Container.ItemIndex % 5 == 0) ? @"</div><div>" : string.Empty %>
<asp:Image ID="imgGallery" runat="server" ImageUrl='<%# /* your code  here */ %>' />
</ItemTemplate>

<FooterTemplate></div></FooterTemplate>
</asp:Repeater> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-14T18:24:29.853

这就是 Asp.Net WebForms 可以为您提供令人难以置信的 RAD 效率的地方。您可以使用新的 ListView 控件，并设置每个“组”的项目数，这将允许您设置围绕组的 HTML，以及每个单独的项目。这样，您可以使用条件标签围绕组。

```
<asp:ListView ID="ListView1" runat="server" DataKeyNames="id" DataSourceID="LinqDataSource1" GroupItemCount="3">
<LayoutTemplate>
    <div id="layout">
        <asp:PlaceHolder ID="groupPlaceholder" runat="server"></asp:PlaceHolder>
    </div>
</LayoutTemplate>
<GroupTemplate>
    <div class="group">
        <asp:PlaceHolder ID="itemPlaceholder" runat="server"></asp:PlaceHolder>
    </div>
</GroupTemplate>
<EmptyDataTemplate>
    <span>No data was returned.</span>
</EmptyDataTemplate>
<ItemTemplate>
    <div class="item">
        <img alt='<%# Eval("title") %>' title='<%# Eval("title") %>'
            src='<%# Eval("filename","photos/{0}") %>' />
    </div>
</ItemTemplate>
</asp:ListView> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T06:37:48.197

如果你想在 ASPX 页面上保留你的标记，你也可以尝试 David 方法的这种变体：

在 aspx 页面上：

```
<ItemTemplate>
<asp:Literal runat="server" ID="divStart" Text="<div>" />
<asp:Image ....>
<asp:Literal runat="server" ID="divEnd" Text="</div>" />
</ItemTemplate> 
```

在代码隐藏的 ItemDataBound 事件中：

```
e.Item.FindControl("divStart").Visible
    = e.Item.FindControl("divEnd").Visible 
    = e.Item.ItemIndex % 5 == 0; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T06:26:23.997

将两个空标签控件添加到您希望 div 标签所在的Repeaters ItemTemplate 中。

然后向Repeater 添加一个ItemDataBound 事件。

然后将此代码添加到 ItemDataBound 事件中：

```
 Protected Sub Repeater1_ItemDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.RepeaterItemEventArgs)
    If (e.Item.ItemType = ListItemType.Item) Or (e.Item.ItemType = ListItemType.AlternatingItem) Then
        If e.Item.ItemIndex Mod 5 = 0 Then
            Dim lblDivStart As Label = CType(e.Item.FindControl("lblDivStart"), Label)
            Dim lblDivEnd As Label = CType(e.Item.FindControl("lblDivEnd"), Label)
            lblDivStart.text = "<div>"
            lblDivEnd.text = "</div>"
        End If
    End If
End Sub 
```

注意 - 这需要一些调整来处理第一个 div，您可能需要执行类似 *If (e.Item.ItemIndex + 1) Mod 5 = 0*的操作，以使 div 准确显示在您想要的位置。

有关详细信息：
[DataListItem.ItemIndex 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalistitem.itemindex.aspx)
[DataList.ItemDataBound 事件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.itemdatabound(VS.71).aspx)

# database - 在 Hibernate 中记录测试数据

> ID：560027
> 
> 赞同：2
> 
> 时间：2009-02-18T06:18:36.213
> 
> 标签：database, hibernate, database-design, architecture

我有一个用于测试硬件小部件的自动化测试框架。现在只有测试用例的通过/失败结果使用休眠存储到关系数据库中。我想改变它，以便将测试的各种特征存储在数据库中。（例如，有多少沙鼠在小部件内运行，测试中各种断言的输入等）。

每个测试用例都表示为一个 Java 类，所以我想到的第一件事就是使用 hibernate 为每个测试用例创建一个表。但是，我们有很多很多的测试用例，所以我不认为为每个测试用例都有一个表一定是最好的主意。

特定测试用例的数据量和数据类型不会随着测试用例的不同执行而改变，但每个测试用例所需的数据会大不相同。举一个愚蠢的例子：对于沙鼠啃咬测试，我们总是想记录沙鼠啃咬电线的年龄和颜色，但对于粉碎测试，我们只需要记录向小部件扔了多少石头。

理想情况下，我们将能够使用 SQL 从数据库中查询此信息，因此数据不能存储为二进制 blob 或其他不可查询的实体。

关于如何构建数据库以满足这些要求的任何想法？我完全不想要大量的桌子吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:39:26.047

我会说你有两个主要选择：

使您的 TestCase 类成为公共超类的子类，然后使用其中一种继承映射策略（[http://hibernate.org/hib_docs/reference/en/html/inheritance.html](http://hibernate.org/hib_docs/reference/en/html/inheritance.html)）不要太担心表的数量/columns 但是你应该确保你没有达到你的数据库引擎的限制。

或者你做一个 EAV 模型（[http://en.wikipedia.org/wiki/Entity-Attribute-Value_model](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)）它非常灵活，但请注意它会导致对简单问题的极其复杂的查询。

确保在提交一个或另一个之前使用真实的卷运行测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:46:31.700

我不会担心很多桌子。如果那是正确的架构，那么就是这样。DB旨在处理它。

# workflow-foundation - Windows 工作流 - 现在是开始的好时机吗？

> ID：560031
> 
> 赞同：2
> 
> 时间：2009-02-18T06:22:31.773
> 
> 标签：workflow-foundation

我听说Windows Workflow 团队正在为下一个版本重新实现许多现有框架。我的公司有几个项目可能非常适合 Workflow，而且我现在熟悉框架的基础知识，但我担心如果我们现在尝试在 WF 中实现这些，我们最终会当事情本应在不久的将来好转时感到后悔。

我们应该等待工作流的下一个主要版本，还是应该现在开始探索它以更好地做好准备？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T12:30:30.627

阅读此博客[再见 Windows Workflow Foundation 2011 年再见](http://realworldsa.dotnetdevelopersjournal.com/goodbyewindowsworkflowfoundationseeyouin2011.htm)

我也一直在研究 WF 解决方案，但我不相信它能给我带来什么太特别的东西。在阅读了博客文章和相关链接之后，我会等待 4.0 版本，然后再投入太多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T16:59:25.123

我认为现在是开始学习 nServiceBus 的最佳时机。我认为很难理解为什么 WWF 之后会如此复杂......

说真的，我知道这是一个“拒绝问题”的答案，但是您应该自己调查 WWF 的 OSS 替代方案。我会说他们都更好...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T16:54:23.883

这是一篇关于处理 3.5 工作流并着眼于过渡到 4.0 的文章：

[http://visualstudiomagazine.com/articles/2008/12/17/windows-workflow-changes-direction-write-new-workflows-with-net-40-in-mind.aspx](http://visualstudiomagazine.com/articles/2008/12/17/windows-workflow-changes-direction-write-new-workflows-with-net-40-in-mind.aspx)

# c# - 如何组合两个成员表达式树？

> ID：560039
> 
> 赞同：4
> 
> 时间：2009-02-18T06:26:49.157
> 
> 标签：c#, .net, linq-to-sql, lambda, expression-trees

我正在尝试将以下表达式组合成一个表达式：item => item.sub，sub => sub.key 成为 item => item.sub.key。我需要这样做，以便我可以创建一个 OrderBy 方法，该方法将项目选择器与键选择器分开。这可以使用 OrderBy 上的重载之一并提供 来完成`IComparer<T>`，但它不会转换为 SQL。

以下是一个方法签名，以进一步阐明我想要实现的目标，以及一个不起作用但应该说明这一点的实现。

```
 public static IOrderedQueryable<TEntity> OrderBy<TEntity, TSubEntity, TKey>(
        this IQueryable<TEntity> source, 
        Expression<Func<TEntity, TSubEntity>> selectItem, 
        Expression<Func<TSubEntity, TKey>> selectKey)
        where TEntity : class
        where TSubEntity : class 
    {
        var parameterItem = Expression.Parameter(typeof(TEntity), "item");
        ...
        some magic
        ...
        var selector = Expression.Lambda(magic, parameterItem);
        return (IOrderedQueryable<TEntity>)source.Provider.CreateQuery(
            Expression.Call(typeof(Queryable), "OrderBy", new Type[] { source.ElementType, selector.Body.Type },
                 source.Expression, selector
                 ));
    } 
```

这将被称为：

```
.OrderBy(item => item.Sub, sub => sub.Key) 
```

这可能吗？有没有更好的办法？我想要一个以这种方式工作的 OrderBy 方法的原因是支持适用于许多实体的复杂键选择表达式，尽管它们以不同的方式公开。此外，我知道一种使用深层属性的字符串表示来执行此操作的方法，但我试图保持它的强类型。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T08:15:07.977

由于这是 LINQ-to-SQL，您通常可以使用`Expression.Invoke`子表达式来发挥作用。我会看看我是否能想出一个例子（**更新：完成**）。但是请注意，EF 不支持这一点 - 您需要从头开始重建表达式。我有一些代码可以做到这一点，但它很长......

表达式代码（使用`Invoke`）非常简单：

```
var param = Expression.Parameter(typeof(TEntity), "item");
var item = Expression.Invoke(selectItem, param);
var key = Expression.Invoke(selectKey, item);
var lambda = Expression.Lambda<Func<TEntity, TKey>>(key, param);
return source.OrderBy(lambda); 
```

这是 Northwind 上的示例用法：

```
using(var ctx = new MyDataContext()) {
    ctx.Log = Console.Out;
    var rows = ctx.Orders.OrderBy(order => order.Customer,
        customer => customer.CompanyName).Take(20).ToArray();
} 
```

使用 TSQL（重新格式化以适应）：

```
SELECT TOP (20) [t0].[OrderID], -- snip
FROM [dbo].[Orders] AS [t0]
LEFT OUTER JOIN [dbo].[Customers] AS [t1]
  ON [t1].[CustomerID] = [t0].[CustomerID]
ORDER BY [t1].[CompanyName] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-10-29T15:49:30.983

我需要同样的，所以做了这个小的扩展方法：

```
 /// <summary>
    /// From A.B.C and D.E.F makes A.B.C.D.E.F. D must be a member of C.
    /// </summary>
    /// <param name="memberExpression1"></param>
    /// <param name="memberExpression2"></param>
    /// <returns></returns>
    public static MemberExpression JoinExpression(this Expression memberExpression1, MemberExpression memberExpression2)
    {
        var stack = new Stack<MemberInfo>();
        Expression current = memberExpression2;
        while (current.NodeType != ExpressionType.Parameter)
        {
            var memberAccess = current as MemberExpression;
            if (memberAccess != null)
            {
                current = memberAccess.Expression;
                stack.Push(memberAccess.Member);
            }
            else
            {
                throw new NotSupportedException();
            }
        }

        Expression jointMemberExpression = memberExpression1;
        foreach (var memberInfo in stack)
        {
            jointMemberExpression = Expression.MakeMemberAccess(jointMemberExpression, memberInfo);
        }

        return (MemberExpression) jointMemberExpression;
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T07:02:16.530

你所拥有的是sotting，然后是投影，然后再次排序。

```
.OrderBy(x => x.Sub)
    .Select(x => x.Sub)
        .OrderBy(x => x.Key) 
```

你的方法可能是这样的：

```
public static IOrderedQueryable<TSubEntity> OrderBy<TEntity, TSubEntity, TKey>(
    this IQueryable<TEntity> source, 
    Expression<Func<TEntity, TSubEntity>> selectItem, 
    Expression<Func<TSubEntity, TKey>> selectKey)
    where TEntity : class
    where TSubEntity : class 
{
    return (IOrderedQueryable<TSubEntity>)source.
        OrderBy(selectItem).Select(selectItem).OrderBy(selectKey)
} 
```

这将由 SQL 执行，但您可能已经注意到，我必须将此处的返回类型更改为 IOrderedQueryable<TSubEntity>。你能解决这个问题吗？

# python - Python中的条件编译

> ID：560040
> 
> 赞同：19
> 
> 时间：2009-02-18T06:26:54.260
> 
> 标签：python, conditional-compilation

如何在 Python 中进行条件编译？

它使用 DEF 吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-18T06:30:22.567

Python 的编译方式与 C 或 C++ 甚至 Java 不同，python 文件是“即时”编译的，您可以将其视为类似于 Basic 或 Perl 等解释语言。[1]

只需使用 if 语句，您就可以执行与条件编译等效的操作。例如：

```
if FLAG:
    def f():
        print "Flag is set"
else:
    def f():
        print "Flag is not set" 
```

您可以对创建类、变量设置和几乎所有内容执行相同的操作。

模仿 IFDEF 的最接近的方法是使用 hasattr 函数。例如：

```
if hasattr(aModule, 'FLAG'):
    # do stuff if FLAG is defined in the current module. 
```

您还可以使用 try/except 子句来捕获名称错误，但惯用的方法是在脚本顶部将变量设置为 None。

1.  Python 代码被字节编译成像 Java 这样的中间形式，但是通常没有单独的编译步骤。以 .py 结尾的“原始”源文件是可执行的。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-18T14:47:12.043

实际上有一种方法可以获得条件编译，但是非常有限。

```
if __debug__:
    doSomething() 
```

`__debug__`标志是一种特殊情况。当使用`-O`or`-OO`选项调用 python 时，`__debug__`将为 false，编译器将忽略该语句。这主要与断言一起使用，这就是为什么如果您“真正编译”带有优化的脚本，断言就会消失的原因。

因此，如果您的目标是添加调试代码，但要防止它减慢或以其他方式影响“发布”构建，那么这就是您想要的。但是您不能为 分配值`__debug__`，所以这就是您可以使用它的全部内容。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-03-16T02:53:03.407

使用[pypreprocessor](http://github.com/evanplaice/pypreprocessor/)

这也可以在[PYPI（Python 包索引）](http://pypi.python.org/pypi/pypreprocessor)上找到，并且可以使用 pip 获取。

使用的基本示例是：

```
from pypreprocessor import pypreprocessor

pypreprocessor.parse()

#define debug

#ifdef debug
print('The source is in debug mode')
#else
print('The source is not in debug mode')
#endif 
```

您还可以通过指定...将后处理代码输出到文件中

```
pypreprocessor.output = 'output_file_name.py' 
```

在 pypreprocessor 导入和调用 parse() 之间的任何地方。

该模块本质上是C预处理器条件编译的python实现。

*旁注：这与 python2x 和 python 3k 兼容*

*免责声明：我是 pypreprocessor 的作者*

**更新：**

我之前忘了提。与其他答案中描述的`if`/`else`或方法不同，这是一个真正的预处理器。`if _debug:`生成的字节码不会包含有条件排除的代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T22:43:46.173

Python 会在您导入模块时自动编译它，因此避免编译它的唯一方法是不导入它。您可以编写如下内容：

```
if some_condition:
  import some_module 
```

但这仅适用于完整的模块。在 C 和 C++ 中，您通常使用预处理器进行条件编译。没有什么可以阻止您在 Python 代码上使用预处理器，因此您可以编写如下内容：

```
#ifdef SOME_CONDITION
def some_function():
  pass
#endif 
```

通过 C 预处理器运行它，您将拥有真正的条件编译，并且`some_function`只有在定义时才会被`SOME_CONDITION`定义。

但是（这很重要）：条件编译可能不是您想要的。请记住，当您导入模块时，Python 只是执行其中的代码。模块中的 def 和 class 语句实际上是在导入模块时*执行的。*因此，实现其他语言将使用条件编译的典型方法只是一个普通的 if 语句，例如：

```
if some_condition:
  def some_function():
    pass 
```

这只会定义`some_function`是否`some_condition`为真。

正是这样的东西使动态语言如此强大，同时在概念上保持简单。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-18T06:31:23.967

在动态环境中没有多大意义。如果您正在寻找函数的条件定义，您可以使用`if`：

```
if happy:
    def makemehappy():
        return "I'm good" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-21T04:16:17.080

您可以使用此处讨论的方法：[确定变量是否在 Python 中定义](https://stackoverflow.com/questions/1592565/determine-if-variable-is-defined-in-python)为替代`#ifdef`

# database - 数据访问代码代表了你的代码库的百分之几？

> ID：560054
> 
> 赞同：1
> 
> 时间：2009-02-18T06:38:27.617
> 
> 标签：database, persistence

今晚推特上出现了一个有趣的问题，我觉得我会在这里发布。

基本上，我想知道您使用什么来将数据持久化到数据库中，以及估计代码库中数据访问代码的百分比。

-- 编辑 --
其他有趣的指标（如评论中所述）包括业务类的数量和代码库的总体大小。

我只是看了一个我在发现 NHibernate 之前做了很长时间的项目。快速查看一些数据访问代码，可以看到大约 10 行代码用于类中每个可持久属性的持久性/水合。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T12:47:38.930

在我们做的一个项目中，我们使用 LLBLGenPro 作为我们的 OR/M。但是因为我们不想在我们的应用程序中乱扔 LLBL 实体，所以我们在它们到达客户端之前将它们映射到我们的 BO。这意味着在再次访问数据库之前将它们映射回 LLBL 实体。DAL 代码最终成为我们应用程序的很大一部分。不是 50%，但相当大。

在我现在正在处理的一个项目中，我从 db40 开始，希望最大限度地减少 DAL 占用空间。而且它很小，但我遇到了db40的问题，不得不放弃它。我切换到 ADO.NET 几天只是为了让一些东西正常工作，并且惊讶于我为了让一个简单的存储库工作而必须编写多少该死的 ADO。那是一个令人头疼的问题，所以我最终选择了 NHibernate。

我的 NHibernate (2.0) 的 DAL 代码可能占我代码库的 5% 或更少。这包括 XML 映射文件。我的意思是，DAL 的足迹是如此之小，与它一起工作非常愉快。过去，我在需要处理分离对象的分布式环境中遇到了 NHibernate 1.2 的问题，但 NHibernate 2.0 似乎已经解决了这个问题。我知道这是我从现在开始做 DAL 的方式，直到出现更好的东西。

有趣的是，几个月前我和我的同事进行了类似的对话。但我们的重点不是我们的 DAL 占了多少代码，而是我们的应用程序有多少只是简单的数据查询/操作。我们估计，我们应用程序的 90% 可能只是获取正确的数据子集并允许用户对其进行编辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T06:59:25.367

我们大部分时间都使用 nHibernate，它是由一个工具生成的，不知道这是否重要，我们最终仍然会为每个实体向 nHibernate 层添加大量代码，是的；它确实继续成为代码的很大一部分。

此外，随着您在应用程序中添加更多功能和更多实体，DAL 代码也会增加。所以或多或少我猜大约 20%-30% 的代码库是由 DAL 组成的。

# project-management - 只在子项目中引入敏捷实践？

> ID：560060
> 
> 赞同：4
> 
> 时间：2009-02-18T06:42:34.953
> 
> 标签：project-management, agile

想象一下，您在一个涉及多个系统的大型项目中作为承包商工作，并且您正在创建其中一个系统。整个项目使用传统的流程​​，但有一些气味告诉你敏捷流程会好得多。

现在的问题。仅在您自己的团队中引入敏捷软件开发流程是否有意义？没有机会改变整个项目，但您可能会在自己的团队中改变流程。

这种本地流程变更的主要好处和缺陷是什么？在这种情况下，是否有特定的敏捷流程可以很好地发挥作用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T07:30:26.807

这是一篇很棒的日记，讲述了一个人如何在几年内将整个公司转变为敏捷——是的，从他自己的子项目开始，即“自下而上”。但他确实谈到了尝试“自上而下”改变的利弊。

[http://jamesshore.com/Change-Diary/](http://jamesshore.com/Change-Diary/)

非常有趣和有趣的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T06:50:18.837

阅读[《将敏捷引入工作场所的有效方法》](https://stackoverflow.com/questions/53318/effective-ways-to-introduce-agile-into-the-workplace)和 Joel 的[开创性](http://en.wiktionary.org/wiki/seminal_work) [著作《当你只是一个小伙子时把事情做好》](http://joelonsoftware.com/articles/fog0000000332.html)。

除此之外，它可能主要是与您的上级和客户进行营销/期望管理。两者都可能会厌恶投资于各种敏捷的客户包容“游戏”。两者都可能对“新奇”的做事方式感到不满。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T07:09:11.943

我认为答案取决于您与其他人的流程之间的隔离程度。如果他们只是告诉你去完成你的部分并返回一个完整的小部件，那么在本地实施敏捷应该相对容易。另一方面，如果您需要遵循许多随机的日期和程序，那将更加困难。

您必须保持灵活性，并确保您拥有的任何 sprint 节奏都与系统其余部分的日期相似。你必须提前计划好你的 sprint，因为中央计划者很可能希望尽早得到一个完整的功能列表，并且不支持更悠闲的敏捷方法。只是对你将要交付的东西保持保守，你应该没问题。

优势应该与敏捷在其他地方的优势相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T07:18:30.580

这是一个有趣的场景。几年前我也遇到过类似的情况，我想说这样做基本上会使项目经理（你的？）的工作量增加一倍。您将需要玩双面牌，一组面向客户，一组面向开发人员。

如果你的开发人员很好，我会去的。如果他们不是，并且需要踢和手，请小心。如果他们很好，但可能会被自己的议程带走，那么就坚定地负责。

有时有趣的是，传统项目模型的组织如何强调次要功能，与开发人员的想法无关，而完全忽略了真正的热点。我还是不明白——也许这纯粹是愚蠢和不专业。期待那个。

请记住，基于测试的方法是敏捷开发的核心。先做测试。这将是客户所特有的，但他们将受益于了解子项目的实际进展情况。您可能会在早期获得较少的“进步”，但在最后一码中获得更多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T12:11:15.837

取决于你的动机，以及你想要达到的目标。

陷阱：主要的一个是敏捷开发通过提高可见性来工作。因此，在一个子项目中采用敏捷实践，如果努力取得成功，可能会导致暴露影响整个项目的问题，从而产生反弹的风险。请记住[两个信封](http://marketplace.publicradio.org/archive/old_features/90s971115.htm)的比喻。

您首先采取的做法取决于您希望如何处理这种风险。如果您从采用与计划相关的实践（任务板、发布计划、用户故事、速度）开始，事情可能会相对较快地出现。

如果您从需求领域的实践（用户故事、自动化验收测试）开始，或多或少也是如此。

如果您从内部质量开始（测试驱动开发、重构、持续集成），您可能会提高开发人员对项目的积极性，但在更大的计划中不一定很重要。

# installation - 托管 DirectX 作为先决条件

> ID：560061
> 
> 赞同：3
> 
> 时间：2009-02-18T06:43:16.997
> 
> 标签：installation, bootstrapper, managed-directx

我正在打包一个使用托管 DirectX 的 vb.net 应用程序，但我没有使用 vs 部署项目等。现在，我想检查托管 DirectX 9 C 是否安装在客户端上。如果不下载从 Web 管理的 directX。这样做的首选方法是什么？我找到了以下 Microsoft 组件安装程序软件开发工具包， http: [//msdn.microsoft.com/en-us/library/ms994369.aspx](http://msdn.microsoft.com/en-us/library/ms994369.aspx)。这是我找到的最新版本[http://www.microsoft.com/downloads/ details.aspx?familyid=2a5e4ebc-651c-40aa-9525-1810af47c317&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=2a5e4ebc-651c-40aa-9525-1810af47c317&displaylang=en) 我正在寻找一些东西（引导程序）来检测是否安装了托管 DirectX，如果没有安装，下载并安装它。任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T20:50:21.590

您可以从组件安装程序中获取 mdxredist.msi 文件，并使用 Visual Studio 中的正常设置应用程序触发它。您可以按照以下步骤将 msi 添加到安装项目的先决条件列表中：

[添加自定义先决条件。](http://msdn.microsoft.com/en-us/library/ms165429(VS.80).aspx)

然后您只需右键单击您的设置项目并转到属性。单击先决条件按钮，然后在列表中检查您的自定义先决条件。

# java - 连接jdbc和mysql的步骤是什么

> ID：560063
> 
> 赞同：0
> 
> 时间：2009-02-18T06:44:24.793
> 
> 标签：java, mysql, database, jdbc, connection

我不是在问代码。我只想知道除了编码之外，连接中涉及的所有步骤是什么。我正在使用 j2sdk1.4.0 和 MySQL Server 4.1。我对这个地区很陌生。

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T09:56:13.290

如果您的代码找不到该类，那么您的类路径总是会出现问题（而且这无论如何都不是特定于 JDBC）。确保您在运行时的类路径上有 MySQL JDBC JAR（它可能被称为`mysql-connector-java-3.0.17-ga.jar`；如果您有一个 IDE，它可能会告诉您有问题的类在哪里）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T08:53:55.293

我的建议可能不如 Vinegar 的建议有用，但为了简单起见，您总是可以这样做：

1.  首先下载'mysql-connector-java.jar'——我想你已经有了这个——如果你在Linux中，一个yum install mysql-connector-java就足够了。
2.  正常编译你的代码
3.  现在，当您需要运行您的应用程序时，请在命令行上执行以下操作：

    java -classpath .:“/*你计算机中的某个地方*/mysql-connector-java.jar”*你的应用程序*

我希望这可以帮助您入门。祝你好运！

# graphics - 给定一组点，我如何近似其形状的主轴？

> ID：560068
> 
> 赞同：5
> 
> 时间：2009-02-18T06:47:47.673
> 
> 标签：graphics, bounding-box, ellipse, eigenvector

给定用户绘制的“形状”，我​​想对其进行“标准化”，以便它们都具有相似的大小和方向。我们拥有的是一组点。我可以使用边界框或圆形来近似大小，但方向有点棘手。

我认为正确的方法是计算其[边界椭圆的](http://en.wikipedia.org/wiki/Bounding_volume)[长轴](http://en.wikipedia.org/wiki/Ellipse)。为此，您需要计算[协方差矩阵](http://en.wikipedia.org/wiki/Covariance_matrix)的[特征向量](http://en.wikipedia.org/wiki/Eigenvector)。这样做可能对我的需要来说太复杂了，因为我正在寻找一些足够好的估计。选择最小、最大和 20 个随机点可能是一些开始。有没有一种简单的方法来近似这个？

**编辑**：我找到了迭代近似特征向量的[幂方法。](http://math.fullerton.edu/mathews/n2003/PowerMethodMod.html)[维基百科文章](http://en.wikipedia.org/wiki/Power_method)。到目前为止，我喜欢[大卫的回答](https://stackoverflow.com/questions/560068/given-a-set-of-points-how-do-i-approximate-the-major-axis-of-its-shape/560128#560128)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T07:16:27.730

您将计算 2x2 矩阵的特征向量，这可以通过一些简单的公式来完成，因此并不复杂。在伪代码中：

```
// sums are over all points
b = -(sum(x * x) - sum(y * y)) / (2 * sum(x * y))
evec1_x = b + sqrt(b ** 2 + 1)
evec1_y = 1
evec2_x = b - sqrt(b ** 2 + 1)
evec2_y = 1 
```

如果您希望您选择的点子集代表整个集合，您甚至可以通过仅对一些点求和来获得估计值来做到这一点。

**编辑**：我认为 x 和 y 必须转换为零均值，即先从所有 x, y 中减去均值*(eed3si9n)*。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T06:53:08.893

这里有一个想法......如果你对点执行线性回归并使用结果线的斜率怎么办？如果不是所有的点，至少是其中的一个样本。

r^2 值还会为您提供有关一般形状的信息。越接近 0，形状越圆形/均匀（圆形/方形）。越接近 1，形状越拉长（椭圆/矩形）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T08:16:54.900

这个问题的最终解决方案是运行[PCA](http://en.wikipedia.org/wiki/Principal_components_analysis)
我希望我能找到一个不错的小实现供您参考...

# visual-studio - 按键时奇怪的Visual Studio 2008行为

> ID：560073
> 
> 赞同：3
> 
> 时间：2009-02-18T06:51:29.567
> 
> 标签：visual-studio, visual-studio-2008

每隔一段时间，我会做一些在按下某些键时会导致奇怪行为的事情。

1）单引号键（'）不会输入字符，除非我按两次，在这种情况下它将打印两个向后的单引号字符（``）。
2) `（向后单引号？）键类型一个 # 字符。
3) 尖括号键（< 和 >）键入单引号 (') 和句点 (.)。
4) Shift + 任意 AZ 字符键入字符并打开代码完成窗口。

我确定还有其他症状，他们只希望我发现停止它就是重新启动 Visual Studio。此行为不会出现在任何其他应用程序中。有人经历过这个吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T23:06:34.653

我开始在我的计算机上安装它（不是在 Visual Studio 中，而是在其他任何地方）。我将默认输入语言设置为“英语（新西兰）-美国-国际”，无论*它*应该是什么意思。将其更改为英语-美国。禁用“语言栏”

“控制面板>>区域设置>>语言，单击高级，查看已安装的服务。看看您是否有多个选择-如果您有“国际”选项，请将其删除，我相信问题会消失。它确实适用于我。

AFAIK，这发生在我安装 XP-SP3 时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T07:04:46.727

您可能设置了另一种输入语言（尝试在发生这种情况时键入 `a，您会得到 à）。我认为在输入语言之间切换的默认热键是 Ctrl+Shift，所以你可能偶尔会不小心碰到它。使用语言设置控制面板关闭热键或删除不需要的键盘配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T07:05:30.687

我有一台笔记本电脑/键盘，可用于法裔加拿大人。一些键（绿色）上印有替代键含义......它们与您提到的键相匹配，即：

*   ' 的 alt 是 ``
*   ` 的 alt 是 #
*   < 和 > 的 alt 是 ' 和 .

我安装了一个了解法裔加拿大人的 Vista 版本。在操作系统任务栏的右侧，时钟附近，有一个键盘图标。它通常设置为“美国”，但如果我将其设置为“加拿大法语”，那么我会得到您描述的键映射。

您的机器上也必须发生类似的事情（即更改键盘的特定语言解释）。你说它在 Visual Studio 中，但对我来说，我在我的操作系统中找到它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T23:10:29.540

如果您的机器上有多种语言，那么您可能通过按 ctrl+shift 触发了此行为，这会导致窗口切换活动窗口的系统语言。

您可以再次按下它，或者更好的是，禁用语言栏和所有其他辅助语言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T23:26:47.473

就像其他人说的那样，您可以按 ctrl-shift 来“循环”设置。

# c# - 将自定义对象的 ArrayList 保存到用户设置

> ID：560076
> 
> 赞同：2
> 
> 时间：2009-02-18T06:53:40.683
> 
> 标签：c#, .net, serialization, settings

是否可以在不诉诸自定义序列化的情况下将自定义对象的 ArrayList 保存到应用程序用户设置中？

例如，给定一个仅包含公共 get/set 属性和私有支持字段的基本数据类：

```
[Serializable]
class SimpleClass()
{
  ...   
} 
```

当我在代码中运行以下代码，然后重新启动应用程序时，名为 MyList 的 ArrayList 设置始终为空，即未保存。

```
if (Properties.Settings.Default.MyList==null)
{
    Properties.Settings.Default.MyList=new ArrayList();
}

Properties.Settings.Default.MyList.Add(new SimpleClass(DateTime.Now.ToString()));

Properties.Settings.Default.Save(); 
```

我意识到没有输入 ArrayList，即。它拥有一组对象。然而，在每个对象上使用 GetType() 来确定实际类型很简单。这应该允许序列化发生，不是吗？

我也知道如何绕过这个执行一些自定义序列化。这只是一种痛苦，这似乎不起作用，因为它对于更简单的情况来说是迄今为止最方便的。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-28T22:57:50.460

如果您使用 XML 序列化，则可以使用 XmlArrayItem 属性。

```
 [XmlArray("Items")]
 [XmlArrayItem("A.Thing",typeof(Thing))]
 [XmlArrayItem("A.Different.Thing",typeof(Whatzit))]
 public System.Collections.ArrayList List; 
```

这要求您在编译时了解 ArrayList 中可能存在的不同类型。

# java - 如何从 Java 启动给定文件的默认（本机）应用程序？

> ID：560077
> 
> 赞同：7
> 
> 时间：2009-02-18T06:54:23.897
> 
> 标签：java, eclipse-rcp, explorer, finder, file-manager

我正在显示文件列表；即 xls、doc、pdf、odt 等，在我的 Java 应用程序（Eclipse RCP）中。当用户单击文件时，我想启动适当的（根据操作系统的想法）本机应用程序，就像它发生在 Windows 资源管理器或 Finder 中一样。

当我在这里时：最好也显示 Finder 或 Explorer 用于不同文件类型的相同图标。

是否有为此的库或 Eclipse 插件？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-11T12:27:24.317

你想要的是[java.awt.Desktop](https://docs.oracle.com/javase/8/docs/api/java/awt/Desktop.html)：

```
Desktop.getDesktop().open( file ); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T07:22:51.737

我现在在 Eclipse 的 SWT 中找到了一个似乎可以解决问题的 API： [org.eclipse.swt.program.Program](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/swt/program/package-summary.html) “提供对发现外部程序启动的操作系统特定方面的设施的访问”。

它具有查找给定文件扩展名的程序、获取程序图标甚至启动程序的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T07:01:59.370

听起来您正在使用[Java 激活框架](http://java.sun.com/javase/technologies/desktop/javabeans/jaf/)（“JAF”）。此 API 可让您确定哪些文件是什么以及您可以对它们执行哪些操作。或者，[Java 桌面集成组件](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/jdic_assoc/)（“JDIC”）。JDIC 允许您创建和毫无疑问地查询文件关联。

这两个项目似乎都处于半废弃状态（叹气）。但这对于 Sun 来说是这样的。我只知道其他一些基于 JNI 的 Windows 特定第三方库，称为[Winpack](http://www.teamdev.com/winpack/features.jsf)。它还做了很多其他的事情。

您可以使用[FileSystemView](http://java.sun.com/javase/6/docs/api/javax/swing/filechooser/FileSystemView.html)类 (Java 1.4+)[获取关联的图标。](http://blog.codebeach.com/2008/02/get-file-type-icon-with-java.html)

# asp.net - 在 MasterPage 中访问控制的 Javascript

> ID：560079
> 
> 赞同：1
> 
> 时间：2009-02-18T06:54:56.127
> 
> 标签：asp.net, javascript

我的 MasterPage 中有一个文本框控件 Super1。

我正在使用 javascript 从我的内容页面访问此控件，如下所示：

```
<asp:Content ID="ContentPage" ContentPlaceHolderID="ContentPlaceHolder1" Runat="Server">
<script type="text/javascript">
    function Somethin() {
        {
            document.forms[0].elements['Super1'].value = "sdfsd";
            //document.getElementById('<%=Super1.ClientID%>').value = "sdfsdf";                
        }
    }
</script>
</asp:Content> 
```

但是在页面加载时它说 Super1 not found。如何访问 Super1？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T07:03:02.177

您必须确保文档已加载，确保调用依赖于正在加载的 DOM 的函数 onload。例如：

```
<script type="text/javascript">
window.onload = function() {
  Somethin();
}
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T07:19:50.373

在您的母版页的 onload 中添加以下代码：

```
string script = @"<script>
function Somethin() {
        document.getElementById('" + Super1.ClientID + @"').value = 'sdfsd';               
}

Somethin();
</script>";
if (!Page.ClientScript.IsClientScriptBlockRegistered("somethin_script_block"))
{
    Page.ClientScript.RegisterClientScriptBlock(this.GetType(), "somethin_script_block", script);
} 
```

这会将您的脚本添加到页面的末尾。

**编辑：**我刚刚意识到，您直接在您的 javascript 代码中使用您的控件 ID。这可能会导致异常。我更新你的代码来修复它。

我希望这有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T07:27:45.253

从您发布的示例代码中，由于您说您正在使用控件，请检查您尝试获取的控件的呈现 ID。以我的经验，这个名字很疯狂，比如 ctl100_masterpagename_namingcontainer_controlname... 也需要出现在 js 中。

Super1 可能位于不同的命名容器（母版页的控件集合）中。您要么需要在主页面呈现期间在全局 javascript 变量中呈现控件的 clientid，以便可以通过子页面中的 javascript 访问它，要么您需要获取对 Masterpage 的引用，在那里找到控件并写出您的子页面中的客户端 ID javascript...

就像是...

如果文本框在其自己的内容占位符中

var txtSuper1 = Master.FindControl("ContentPlaceHolderName").FindControl("Super1") as Textbox;

或者如果它不在内容占位符中 var txtSuper1 = Master.FindControl("Super1") as Textbox;

第三个选项可能是将控件公开为母版页的属性（不确定）-我的网络表单生锈了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T07:41:36.840

在母版页上，为控件声明一个 javascript 变量，例如：

```
<asp:TextBox id="Super1" runat="server"/>
...
<script type="text/javascript">
var txtSuper1 = document.getElementById('<%= Super1.ClientID %>');
</script> 
```

使用 ClientID 属性很重要，因为呈现控件的 ID（在客户端上）将不同于服务器控件的 ID（由于命名容器）。

现在您可以从内容页面中声明的 javascript 访问文本框：

```
<asp:Content ID="ContentPage" ContentPlaceHolderID="ContentPlaceHolder1" Runat="Server">
<script type="text/javascript">
function Somethin()
{
  txtSuper1.value = "sdfsd";
}
</script>
<a href="javascript:Somethin()">click me</a>
</asp:Content> 
```

顺便说一句：在您的代码中，函数 Somethin() {{ ... }} 中有重复的花括号

# ios - 如何从按钮导航到另一个页面

> ID：560081
> 
> 赞同：1
> 
> 时间：2009-02-18T06:55:52.990
> 
> 标签：ios, objective-c, iphone, xcode, cocoa-touch

我是 Objective-C 领域的新手，正在使用 Xcode 构建一个 iphone 应用程序。我在一个页面上使用了两个按钮，我想从其中一个按钮转到另一个页面。在 Xcode 怎么可能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T10:16:34.597

你可以试试。

```
EnterNameController *newEnterNameController = [[EnterNameController alloc] initWithNibName:@"EnterNibFileName" bundle:[NSBundle mainBundle]];
    [[self navigationController] pushViewController:newEnterNameController animated:YES]; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-24T09:16:23.667

```
EnterNameController *newEnterNameController = [[EnterNameController alloc]     initWithNibName:@"EnterNibFileName" bundle:[NSBundle mainBundle]];
    [[self navigationController] pushViewController:newEnterNameController animated:YES];
[newEnterNamecontroller release]; 
```

据我所知，这个更准确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T13:01:49.113

这种类型的东西是 iPhone 应用程序的基本构建块，Apple 提供了大量示例代码来展示如何做到这一点。

首先查看 UICatalog 示例项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-02T07:33:55.743

获取[“Beginning iPhone Development”](http://www.apress.com/book/view/1430216263)一书，从头到尾通读一遍，不要跳过任何内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-11-22T07:32:16.360

你可以试试

```
TwoViewController * twoVC = [[TwoViewController alloc] init];
[self.navigationController pushViewController:twoVC animated:YES]; 
```

“TwoViewController”是一个自定义 UIViewController

# asp.net-mvc - ASP.NET MVC 中的会话变量

> ID：560084
> 
> 赞同：171
> 
> 时间：2009-02-18T06:58:19.783
> 
> 标签：asp.net-mvc, session, session-variables

我正在编写一个 Web 应用程序，它允许用户浏览到网站中的多个网页，发出某些请求。用户输入的所有信息都将存储在我创建的对象中。问题是我需要从网站的任何部分访问这个对象，我真的不知道实现这一点的最佳方法。我知道一种解决方案是使用会话变量，但我不知道如何在 asp .net MVC 中使用它们。我将在哪里声明一个会话变量？还有其他方法吗？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-02-18T07:09:36.043

我认为您会想考虑事物是否真的属于会话状态。这是我发现自己时不时做的事情，它是一种很好的强类型方法，但是在将事情放在会话上下文中时应该小心。并非所有东西都应该存在，因为它属于某个用户。

在 global.asax 中钩住 OnSessionStart 事件

```
void OnSessionStart(...)
{
    HttpContext.Current.Session.Add("__MySessionObject", new MySessionObject());
} 
```

从代码中 HttpContext.Current 属性 != null 的任何位置，您都可以检索该对象。我使用扩展方法来做到这一点。

```
public static MySessionObject GetMySessionObject(this HttpContext current)
{
    return current != null ? (MySessionObject)current.Session["__MySessionObject"] : null;
} 
```

这样你就可以在代码中

```
void OnLoad(...)
{
    var sessionObj = HttpContext.Current.GetMySessionObject();
    // do something with 'sessionObj'
} 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2011-09-24T18:31:18.607

这里的答案是正确的，但是我很难在 ASP.NET MVC 3 应用程序中实现它。我想访问控制器中的 Session 对象，但不知道为什么我不断收到“实例未设置为对象错误的实例”。我注意到的是，当我尝试通过执行以下操作访问会话时，在控制器中，我不断收到该错误。这是因为 this.HttpContext 是 Controller 对象的一部分。

```
this.Session["blah"]
// or
this.HttpContext.Session["blah"] 
```

但是，我想要的是作为 System.Web 命名空间一部分的 HttpContext，因为这是上面的答案建议在 Global.asax.cs 中使用的那个。所以我必须明确地执行以下操作：

```
System.Web.HttpContext.Current.Session["blah"] 
```

这对我有帮助，不确定我是否做了任何不是 MO 的事情，但我希望它对某人有所帮助！

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-05-10T12:41:38.533

因为我不喜欢看到关于这个地方的“HTTPContext.Current.Session”，所以我使用单例模式来访问会话变量，它使您可以轻松访问强类型的数据包。

```
[Serializable]
public sealed class SessionSingleton
{
    #region Singleton

    private const string SESSION_SINGLETON_NAME = "Singleton_502E69E5-668B-E011-951F-00155DF26207";

    private SessionSingleton()
    {

    }

    public static SessionSingleton Current
    {
        get
        {
            if ( HttpContext.Current.Session[SESSION_SINGLETON_NAME] == null )
            {
                HttpContext.Current.Session[SESSION_SINGLETON_NAME] = new SessionSingleton();
            }

            return HttpContext.Current.Session[SESSION_SINGLETON_NAME] as SessionSingleton;
        }
    }

    #endregion

    public string SessionVariable { get; set; }
    public string SessionVariable2 { get; set; }

    // ... 
```

然后您可以从任何地方访问您的数据：

```
SessionSingleton.Current.SessionVariable = "Hello, World!"; 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-23T16:32:38.267

如果您使用的是 asp.net mvc，这里有一个访问会话的简单方法。

从控制器：

```
{Controller}.ControllerContext.HttpContext.Session["{name}"] 
```

从一个视图：

```
<%=Session["{name}"] %> 
```

这绝对不是访问会话变量的最佳方式，但它是一条直接路径。所以谨慎使用它（最好在快速原型设计期间），并在合适的时候使用 Wrapper/Container 和 OnSessionStart。

高温高压

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-02-18T07:26:48.170

好吧，恕我直言..

1.  永远不要在您的视图/母版页中引用会话
2.  尽量减少对 Session 的使用。MVC 为此提供了 TempData obj，它基本上是一个 Session，只为一次访问服务器而存在。

关于#1，我有一个强类型的主视图，它具有访问 Session 对象所代表的任何内容的属性......

```
ViewMasterPage<AdminViewModel>

AdminViewModel
{
    SomeImportantObjectThatWasInSession ImportantObject
}

AdminViewModel<TModel> : AdminViewModel where TModel : class
{
   TModel Content
} 
```

进而...

```
ViewPage<AdminViewModel<U>> 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-02-18T07:11:54.480

虽然我不知道asp.net mvc，但这是我们在一个普通的.net网站中应该做的。它也应该适用于 asp.net mvc。

```
YourSessionClass obj=Session["key"] as YourSessionClass;
if(obj==null){
obj=new YourSessionClass();
Session["key"]=obj;
} 
```

您可以将其放在一个方法中以便于访问。高温高压

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-06-14T23:04:40.717

有 3 种方法可以做到这一点。

> 1.  可以直接访问`HttpContext.Current.Session`
>     
>     
> 2.  你可以模拟`HttpContextBase`
>     
>     
> 3.  为`HttpContextBase`

我更喜欢第三种方式。这个链接是很好的参考。

[在 BaseController 中获取/设置 HttpContext 会话方法与模拟 HttpContextBase 以创建获取/设置方法](https://stackoverflow.com/questions/6314626/get-set-httpcontext-session-methods-in-basecontroller-vs-mocking-httpcontextbase)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-05-18T09:13:54.183

我访问会话的方式是编写一个帮助类，它封装了各种字段名称及其类型。我希望这个例子有帮助：

```
using System;
using System.Collections.Generic;
using System.Web;
using System.Web.SessionState;

namespace dmkp
{
    /// <summary>
    /// Encapsulates the session state
    /// </summary>
    public sealed class LoginInfo
    {
        private HttpSessionState _session;
        public LoginInfo(HttpSessionState session)
        {
            this._session = session;
        }

        public string Username
        {
            get { return (this._session["Username"] ?? string.Empty).ToString(); }
            set { this._session["Username"] = value; }
        }

        public string FullName
        {
            get { return (this._session["FullName"] ?? string.Empty).ToString(); }
            set { this._session["FullName"] = value; }
        }
        public int ID
        {
            get { return Convert.ToInt32((this._session["UID"] ?? -1)); }
            set { this._session["UID"] = value; }
        }

        public UserAccess AccessLevel
        {
            get { return (UserAccess)(this._session["AccessLevel"]); }
            set { this._session["AccessLevel"] = value; }
        }

    }
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-02-23T23:38:41.340

伙计们的回答很好，但我会提醒你不要总是依赖 Session。这样做既快速又容易，当然会起作用，但在所有情况下都不会很好。

例如，如果您遇到托管不允许会话使用的情况，或者您在 Web 场中，或者在共享 SharePoint 应用程序的示例中。

如果您想要一个不同的解决方案，您可以考虑使用[IOC 容器](http://en.wikipedia.org/wiki/Inversion_of_control)，例如[Castle Windsor](http://docs.castleproject.org/Windsor.MainPage.ashx)，创建一个提供程序类作为包装器，然后根据您的要求使用每个请求或会话生活方式保留您的类的一个实例。

IOC 将确保每次返回相同的实例。

更复杂的是，如果您需要一个简单的解决方案，只需使用会话。

下面是一些出于兴趣的实现示例。

使用此方法，您可以按照以下方式创建提供程序类：

```
public class CustomClassProvider : ICustomClassProvider
{
    public CustomClassProvider(CustomClass customClass)
    { 
        CustomClass = customClass;
    }

    public string CustomClass { get; private set; }
} 
```

并将其注册为：

```
public void Install(IWindsorContainer container, IConfigurationStore store)
{
    container.Register(
            Component.For<ICustomClassProvider>().UsingFactoryMethod(
                () => new CustomClassProvider(new CustomClass())).LifestylePerWebRequest());
    } 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-07-06T07:06:58.060

您可以使用 ViewModelBase 作为所有模型的基类，该类将负责从会话中提取数据

```
class ViewModelBase 
{
  public User CurrentUser 
  {
     get { return System.Web.HttpContext.Current.Session["user"] as User };
     set 
     {
        System.Web.HttpContext.Current.Session["user"]=value; 
     }
  }
} 
```

你可以在 HttpContextBase 上写一个扩展方法来处理会话数据

```
T FromSession<T>(this HttpContextBase context ,string key,Action<T> getFromSource=null) 
{
    if(context.Session[key]!=null) 
    {
        return (T) context.Session[key];
    }
  else if(getFromSource!=null) 
  {
    var value = getFromSource();
   context.Session[key]=value; 
   return value; 
   }
  else 
  return null;
} 
```

在控制器中使用如下

```
User userData = HttpContext.FromSession<User>("userdata",()=> { return user object from service/db  }); 
```

第二个参数是可选的，当会话中不存在值时，它将用于填充该键的会话数据。

# c++ - 运行 K 次基准代码的 Unix 命令

> ID：560089
> 
> 赞同：7
> 
> 时间：2009-02-18T07:00:38.827
> 
> 标签：c++, unix, benchmarking, performance

假设我有一个以这种方式在 Unix 中执行的代码：

```
$ ./mycode 
```

我的问题是有没有一种方法可以计算我的代码执行 K 次的运行时间。例如，K 的值 = 1000。

我知道 Unix“时间”命令，但只执行了 1 个实例。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T07:06:46.083

改进/澄清查理的回答：

```
time (for i in $(seq 10000); do ./mycode; done) 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T07:03:38.540

尝试

```
$ time ( your commands ) 
```

编写一个循环进入括号以根据需要重复您的命令。

### 更新

好的，我们可以解决命令行太长的问题。这是 bash 语法，如果您使用另一个 shell，您可能必须使用*expr(1)*。

```
$ time (
> while ((n++ < 100)); do echo "n = $n"; done
> )

real    0m0.001s
user    0m0.000s
sys     0m0.000s 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T07:24:43.777

只是一个建议：确保这个“基准”接近你对执行程序的实际使用。如果这是一个短暂的进程，那么仅创建进程就可能会产生很大的开销。不要假设它与*在*程序中将其实现为循环相同。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T07:25:32.247

为了增强一些其他响应，如果您决定测试，例如一百万次，其中一些（基于 seq 的响应）可能会导致命令行太长。以下没有这个限制

```
time ( a=0 ; while test $a -lt 10000 ; do echo $a ; a=`expr $a + 1` ; done) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-21T14:19:11.183

“命令行太长”问题的另一个解决方案是在 bash 中使用 C 风格的 for 循环：

```
 $ for ((i=0;i<10;i++)); do echo $i; done 
```

这也适用于 zsh（尽管我敢打赌 zsh 有一些更好的使用方式，但我对 zsh 还是很陌生）。我无法测试其他人，因为我从未使用过任何其他人。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T07:51:48.970

如果您担心不断地将可执行文件加载和卸载到进程空间的开销，我建议您设置一个 ram 磁盘并从那里为您的应用程序计时。

早在 70 年代，我们曾经能够在可执行文件上设置一个“粘性”位并将其保留在内存中。我不知道有哪个 unix 现在支持这种行为，因为它使更新应用程序成为一场噩梦。 .. :o)

# c++ - 发布/订阅和智能指针

> ID：560091
> 
> 赞同：3
> 
> 时间：2009-02-18T07:01:33.677
> 
> 标签：c++, smart-pointers, publish-subscribe

我想实现一个简单的发布/订阅模式，其中：

单个发布者向其订阅者发布令牌（指向对象的指针）。发布者和订阅者都是独立的线程。我计划为每个订阅者添加线程安全队列，以便发布者可以在订阅者处理令牌时继续将令牌分发给订阅者。

如您所见，这意味着所有订阅者实际上共享相同的指针（注意：订阅者无论如何都不能修改指向的对象，所以没有问题）。一旦共享指针不再被任何订阅者使用，如果指针可以在最后一个订阅者线程完成后自动删除它自己，那就太好了。

这是使用智能指针的好地方吗？如果是这样，我应该使用哪些智能指针？

我在 Windows 上使用 MSVC2008 进行开发，并且正在使用 Intel TBB、Boost 和 Qt。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T07:07:57.500

如果我假设你的设计是可行的（零上下文闻起来很有趣，但很可能是正确的）， boost::shared_ptr 可能是要走的路。

[http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/smart_ptr.htm](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/smart_ptr.htm)

编辑：从 ::weak_ptr 切换到 ::shared_ptr，因为我是个白痴...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T08:01:02.067

您描述的是用于对象生命周期控制的经典 COM 模式。您需要一个智能指针来保持对象上的引用计数器 -[`boost::shared_ptr`](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm)或[`boost::intrusive_ptr`](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/intrusive_ptr.html)ATL 的[`CComPtr`](http://msdn.microsoft.com/en-us/library/ezzw7k98(vs.80).aspx)类。我建议`shared_ptr`，因为其他两个将需要您自己实现 ref 计数。

# c# - 公共属性的类内部使用

> ID：560095
> 
> 赞同：2
> 
> 时间：2009-02-18T07:02:35.000
> 
> 标签：c#

假设我有一个公开一个属性的类。在课堂内部使用私有“持有者变量”是否被认为是一种好方法？或者我也应该将该物业用于内部使用。

为了解释，我应该使用：

```
public class foo
{
    String _statusHolder;
    public String myStaus
    {
        get { return _statusHolder; }
        set{ _statusHolder = value; }
    }

    public void DisplayMyStatus()
    {
        Console.WriteLine(_statusHolder);
    }
} 
```

或者：

```
public class foo
{
    String _statusHolder;
    public String myStaus
    {
        get { return _statusHolder; }
        set{ _statusHolder = value; }
    }

    public void DisplayMyStatus()
    {
        Console.WriteLine(myStaus);
    }
} 
```

我可以认为使用第二种方法更一致、更易读。如果我稍后在 set-statement 中做一些修改，它也会更有效。但是是否存在任何性能问题，或者由于某种原因被认为是不良做法？

* * *

**编辑：**

似乎每个人都倾向于在内部使用该物业。我最初的想法是一样的，但作为一个新手程序员，你永远不会知道。感谢大家的快速反馈！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T07:07:27.750

性能问题应该可以忽略不计，因为 JITer 或编译器会很高兴地发现您的函数调用（属性的 getter）没有做任何令人兴奋的事情，并且可以内联。

好处是将来可能对 getter 中的业务逻辑进行更改，然后您的类将自动利用这些更改，而无需进行太多重构。

当然，缺点是，您可能希望在某些情况下避免使用新的业务逻辑，因此需要根据 a) 逻辑更改的可能性以及 b) 可能需要规避该逻辑来考虑这一点。

在内部使用该属性的另一个（潜在）优势是您可以轻松地移入或移出自动属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T07:07:04.163

我倾向于调用属性，因为一旦事情变得棘手，您可以在 getter 中放入锁定和业务逻辑

对于 C# 3.0，我会采用这些方法（并且仅在真正需要时显式创建支持字段）

```
public class foo
{

    public String Status
    {
        get;
        set;
    }

    public void DisplayMyStatus()
    {
        Console.WriteLine(Status);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T07:09:28.290

如果有，请使用该属性。无论您从何处访问该变量，属性都可能具有您想要的延迟初始化等副作用。

即使该属性现在没有副作用，其他开发者可以稍后添加它们，而使用“原始”变量的地方可能会因为没有调用新代码而容易出错。

最后，该属性使重构更容易，例如，当稍后的值不再存储在变量中，而是在属性访问器内部计算或来自其他源变量时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T07:40:21.650

在 Java 中编程，我更喜欢使用 getter 方法，因为我可以在其中放置一个断点和/或在日志输出中查看对它的更改。

# perl - 如何在 Perl 中创建 Zip 存档？

> ID：560097
> 
> 赞同：6
> 
> 时间：2009-02-18T07:03:19.350
> 
> 标签：perl, zip

在过滤我想要包含的文件列表后，我需要创建一个 Zip 存档。最好我希望该模块在 Windows 和 Linux 中都可以工作。

由于我需要过滤文件列表，我真的不想使用外部程序。我也不想引入外部依赖项，这样我就可以将脚本编译成 Windows 上的单个可执行文件（使用[ActiveState PDK](http://www.activestate.com/perl_dev_kit/)）。

**我已经尝试过的**

到目前为止，我一直使用在[CPAN](http://search.cpan.org/)上找到的[Archive::Zip](http://search.cpan.org/~adamk/Archive-Zip-1.26/lib/Archive/Zip.pm) ，但它在使用非 ASCII 文件名的 Windows 机器上存在一个重大错误：文件名在存档中被损坏，因为它们没有被翻译成 unicode。

有一个[错误报告为此提交](http://rt.cpan.org/Public/Bug/Display.html?id=35334)，但它已经超过 10 个月没有更新，并且在模块文档中，开发人员相当无益（“修复您的计算机或摆脱 Windows”类型）。

*更新：*
感谢 brian 和 Alan Haggai Alavi 的澄清，似乎已经投入了足够的精力`Archive::Zip`来尽快解决这些错误，并最终在 Windows 中拥有一个功能齐全的 zip 模块。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T08:03:01.003

尽管模块文档说了一些关于 Windows 的愚蠢的事情，但当前的维护者是 Adam Kennedy，就是给你带来[Strawberry Perl](http://www.strawberryperl.org)的那个人。他绝对不是反Windows。他在 10 月发布了一个版本，因此他们正在努力。[Perl 基金会](http://www.perlfoundation.org/)还提供了一项公开拨款来[修复 Archive::Extract 错误](http://www.perlfoundation.org/fixing_bugs_in_the_archive_zip_perl_module)。您提到的错误，[RT 35334: Filename Encoding by Archive::Zip](http://rt.cpan.org/Public/Bug/Display.html?id=35334)，也许只是需要有人来表达一些爱。那可能是你。人们解决了困扰他们的问题，所以也许对模块感兴趣的人还不需要这个。

该模块有问题，自从我在几个项目中使用它以来，我一直在关注它的进展。它最近好多了，当然可以使用一些爱。有时开源意味着帮助解决您遇到的问题。我知道这并不能帮助您立即解决问题，但我认为这就是除了`system()`电话之外您将完成此任务的方式。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T17:26:53.703

最近通过在 Windows 下添加 Unicode 文件名支持解决了上述错误。一周内将在 CPAN 中提供包含该修复程序的版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T07:20:29.200

您可以尝试标准分发[Archive::Extract](http://perldoc.perl.org/Archive/Extract.html)。它可能并不比 Archive::Zip 好，但文档说，如果有问题，它会在后台尝试使用系统上的命令行工具来解压缩文件。这在 Unix 上可能是最强大的，但 Windows 有一个 zip 存档实用程序，它*应该*可以通过命令行访问。另外，Archive::Extract 可以处理许多其他类型的压缩（理论上）。

当然，Archive::Extract 可能会简单地计算出文件使用哪种压缩，然后将其传递给适当的其他库，可能是 Archive::Zip。

您也可以尝试[IO::Uncompress::Unzip](http://perldoc.perl.org/IO/Uncompress/Unzip.html)和它的对应物[IO::Compress::Zip](http://perldoc.perl.org/IO/Compress/Zip.html)，仅用于解压缩、读取和重新压缩。如果绝对必要。再说一次，我不知道这些会好多少，但它们*都是*标准库的一部分。

# .net - MSMQ 与 WCF 问题

> ID：560100
> 
> 赞同：1
> 
> 时间：2009-02-18T07:04:25.370
> 
> 标签：.net, wcf, msmq

这是一个虽然解释，但我走了。

我们正在创建一个程序，其中 msmq 的发送方和接收方使用 WCF。我们实现了一个与此非常相似的故障处理：http: [//msdn.microsoft.com/en-us/library/ms751472.aspx](http://msdn.microsoft.com/en-us/library/ms751472.aspx)结合[http://msdn.microsoft.com/en-us/library/ms789028。 aspx](http://msdn.microsoft.com/en-us/library/ms789028.aspx)

一切都很好。我们甚至制作了通过队列运行 100 条消息的测试用例，一切都得到处理。当我们将其设置为 10000 时，我们会遇到一些超时，但 de 错误处理工作正常，因此消息被重试几次，然后它最终进入毒队列。

我签入了我的代码并将其发布给其他开发人员。使用队列时出现以下问题不止一次：

未正确读取的消息最终会作为错误消息（在 PoisonErrorHandler 类中）。它总是有这个异常消息（FaultException 类型）：由于 EndpointDispatcher 的 AddressFilter 不匹配，接收方无法处理带有 To 'net.msmq://localhost/private/adpqueue' 的消息。检查发送方和接收方的 EndpointAddresses 是否一致。在此错误中 Code.Name = Sender 和 Code.SubCode.Name = DestinationUnreachable

在重试次数之后，它会变成 M​​smqPoisonMessageException，它会得到一个 LookupId。有了这个lookupid，我执行了ReceiveByLookupId(lookupId)（使用标准的System.Messaging.MessageQueue 类）。这会导致 InvalidOperationException。

在此之后，服务将自行重新启动并且循环将重新启动，这永远不会结束。（重新启动后，清除队列永远不会停止）。

如果您打开计算机管理并查看队列中是否有消息，则它是空的。但是当我使用文本编辑器打开 p0000001.mq 文件（在 C:\WINDOWS\system32\msmq\storage 中）时，您可以看到该消息。如果你删除这个文件，一切都会重新开始。我无法使用应用程序重新创建问题（我可以重新创建问题，因为我保存了损坏的 .mq 文件），它只是有时会发生。

这不是一个可行的情况。- 任何人都知道我如何通过代码解决这个问题或如何防止它发生？- 为什么 wcf 服务可以看到消息，而带有 LookupId 的 MessageQueue 什么也看不到？- 是否有另一种方法可以使用 LookupId 查询队列？- 这种情况怎么会发生？我可以看到所有其他消息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-25T13:16:27.543

我终于找到了我的问题。

在队列的接收端，我使用了嵌套事务范围。发生这种情况时： - 收到无效消息 - 异常 - 捕获异常 - 处理嵌套事务

但是这个异常被抛出的有点早，嵌套事务还没有打开。

我认为这感染了事务性 msmq 的事务，并且消息被毒句柄锁定且无法读取。当服务重新启动时，它可以再次读取，但由于嵌套事务的处置而再次变得不可读。

（要在您的接收操作中重播此行为，只需键入： new TransactionScope(TransactionScopeOption.Required).Dispose(); ）

# xml - 基于 XML 的用户界面

> ID：560107
> 
> 赞同：0
> 
> 时间：2009-02-18T07:06:48.110
> 
> 标签：xml, user-interface, templates

基于 XML 参数的最佳/推荐生成 UI 是什么？

目标是：

*   在不干扰其他元素的情况下，向 UI 添加新对象/参数应该简单快捷。

UI 当前是使用 JSP/Servlets 构建和呈现的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T07:11:54.213

你看过[XAML](http://msdn.microsoft.com/en-us/library/ms752059.aspx)吗？我认为您可以通过学习 XAML 和 WPF/Silverlight 应用程序来学习或学习。

他们为 UI 使用声明性语法的方式相当不错，而且这是一个可行的概念。您说的是与 Java 相关的东西，但我认为您可以通过查看 Microsoft 对 XAML 所做的事情以及他们这样做的原因来学习新的东西。

谈到 XML，我在更短、更漂亮的语法（如[Haml](http://haml.hamptoncatlin.com/) ）和冗长的 XSLT 之间有点纠结。如果我可以自由选择，我会选择 Haml 之类的东西来渲染 HTML UI，因为最终你可以用更少的资源完成更多的工作，并且它使整个 UI 代码更易于阅读（代码行更少，混乱更少） .

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T07:16:58.727

[XForms](http://www.w3.org/MarkUp/Forms/)是使用 XML 创建 Web 界面的标准。它用 XForms 代替了标准的 HTML 表单，并在表示层和模型层之间提供了清晰的分离。虽然它已经存在了一段时间，但它并没有真正赶上。浏览器不支持它，您需要一个 XForms 引擎。

由于您使用的是 JSP/Servlets，请查看[Orbeon](http://www.orbeon.com/) XForms 引擎。它是最成熟的 XForms 技术，它与 JSP 页面很好地集成在一起。

# wpf - 任何有针对 Silverlight 和 WPF 经验的人？

> ID：560119
> 
> 赞同：2
> 
> 时间：2009-02-18T07:11:47.677
> 
> 标签：wpf, silverlight

是否可以使用相同的源代码针对 Silverlight 和 WPF 进行开发？也许在必要的地方使用一些#define 块。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T07:23:40.613

理论上应该是可行的。这对代码来说不是一个大问题。但是，您必须非常小心使用 XAML，并且只使用 WPF 和 SL (1) 的相交子集，因为`#if/#endif`XAML 没有。

(1) 与普遍看法相反，SL 不是 WPF 的真子集。它有[一些 WPF 没有的功能](http://blogs.msdn.com/johngossman/archive/2008/08/08/visualstatemanager-for-desktop-wpf.aspx)，尽管这些功能正在开发中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T09:28:54.260

顺便说一句，PRISM（来自模式和实践的复合应用程序块）现在支持 Silverlight，并且有一个[C9 视频](http://channel9.msdn.com/shows/Continuum/Prismv2/)，其中包含有关在 WPF 和 Silverlight 中使用代码的快速示例。

我认为如果你坚持使用 MV-V-VM（或类似的东西），那么你的很多后端代码将是可重用的，但如果你想要一个完整的“丰富”体验，XAML 本身可能需要分叉，除非你愿意为 WPF 使用 VSM 测试版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T09:53:41.313

我没有这方面的经验，但我使用了一个针对 WPF 和 Silverlight 环境且具有相同代码的组件（只有很少的差异）。

该组件是来自[Visifire](http://visifire.com/)的 Chart ，它是开源的

也许你可以看看它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T00:26:50.607

您可以使用 Visual Studio 文件链接在 Silverlight 中包含 WPF 项目中的类 - 但前提是它们不执行任何基于 UI 或 XAML 的内容（因为这是您通常会发现两者之间不一致的地方）...

所以保持它的业务逻辑等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-16T02:40:25.197

Flashcards.Show 应用程序是这种 WPF/SL/WP7 代码共享和跨平台可能性的一个很好的例子。 [http://windowsteamblog.com/windows_phone/b/wpdev/archive/2011/03/03/flashcards-show-planning-a-cross-platform-solution.aspx](http://windowsteamblog.com/windows_phone/b/wpdev/archive/2011/03/03/flashcards-show-planning-a-cross-platform-solution.aspx)

跨平台的概念非常简单，因为一切都在 .NET 和类似的 XAML 绑定系统上运行。我的建议是在 MVVM 和其他抽象方面投入更多时间在应用程序的架构上，以分离平台依赖项。因此，大部分代码可以重复使用，而某些 XAML 可能需要重写，这取决于应用程序在不同平台上的视觉复杂性。

# c# - 从位数组转换为字节

> ID：560123
> 
> 赞同：41
> 
> 时间：2009-02-18T07:13:49.030
> 
> 标签：c#, .net, binary, bitarray, base-class-library

我有一个[`BitArray`](https://msdn.microsoft.com/en-us/library/system.collections.bitarray(v=vs.110).aspx)长度为 8 的 a，我需要一个函数将其转换为`byte`. 怎么做？

具体来说，我需要一个正确的函数`ConvertToByte`：

```
BitArray bit = new BitArray(new bool[]
{
    false, false, false, false,
    false, false, false, true
});

//How to write ConvertToByte
byte myByte = ConvertToByte(bit);
var recoveredBit = new BitArray(new[] { myByte });
Assert.AreEqual(bit, recoveredBit); 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-18T07:17:37.850

这应该有效：

```
byte ConvertToByte(BitArray bits)
{
    if (bits.Count != 8)
    {
        throw new ArgumentException("bits");
    }
    byte[] bytes = new byte[1];
    bits.CopyTo(bytes, 0);
    return bytes[0];
} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2011-01-06T20:04:28.607

有点晚了，但这对我有用：

```
public static byte[] BitArrayToByteArray(BitArray bits)
{
    byte[] ret = new byte[(bits.Length - 1) / 8 + 1];
    bits.CopyTo(ret, 0);
    return ret;
} 
```

适用于：

```
string text = "Test";
byte[] bytes = System.Text.Encoding.ASCII.GetBytes(text);
BitArray bits = new BitArray(bytes);
bytes[] bytesBack = BitArrayToByteArray(bits);
string textBack = System.Text.Encoding.ASCII.GetString(bytesBack);
// bytes == bytesBack
// text = textBack 
```

.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T07:45:19.483

穷人的解决方案：

```
protected byte ConvertToByte(BitArray bits)
{
    if (bits.Count != 8)
    {
        throw new ArgumentException("illegal number of bits");
    }

    byte b = 0;
    if (bits.Get(7)) b++;
    if (bits.Get(6)) b += 2;
    if (bits.Get(5)) b += 4;
    if (bits.Get(4)) b += 8;
    if (bits.Get(3)) b += 16;
    if (bits.Get(2)) b += 32;
    if (bits.Get(1)) b += 64;
    if (bits.Get(0)) b += 128;
    return b;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T07:28:51.210

这应该可以解决问题。但是，先前的答案很可能是更好的选择。

```
 public byte ConvertToByte(BitArray bits)
    {
        if (bits.Count > 8)
            throw new ArgumentException("ConvertToByte can only work with a BitArray containing a maximum of 8 values");

        byte result = 0;

        for (byte i = 0; i < bits.Count; i++)
        {
            if (bits[i])
                result |= (byte)(1 << i);
        }

        return result;
    } 
```

在您发布的示例中，结果字节将为 0x80。换句话说，BitArray 中的第一个值对应于返回字节中的第一位。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-12-01T11:22:22.700

不幸的是，BitArray 类在 .Net Core 类 (UWP) 中部分实现。例如 BitArray 类无法调用 CopyTo() 和 Count() 方法。我写了这个扩展来填补空白：

```
public static IEnumerable<byte> ToBytes(this BitArray bits, bool MSB = false)
{
    int bitCount = 7;
    int outByte = 0;

    foreach (bool bitValue in bits)
    {
        if (bitValue)
            outByte |= MSB ? 1 << bitCount : 1 << (7 - bitCount);
        if (bitCount == 0)
        {
            yield return (byte) outByte;
            bitCount = 8;
            outByte = 0;
        }
        bitCount--;
    }
    // Last partially decoded byte
    if (bitCount < 7)
        yield return (byte) outByte;
} 
```

该方法使用 LSB（低有效字节）逻辑将 BitArray 解码为字节数组。这与 BitArray 类使用的逻辑相同。调用将 MSB 参数设置为 true 的方法将生成 MSB 解码字节序列。在这种情况下，请记住您可能还需要反转最终的输出字节集合。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-30T21:28:48.253

这应该是终极的。适用于任何长度的数组。

```
private List<byte> BoolList2ByteList(List<bool> values)
    {

        List<byte> ret = new List<byte>();
        int count = 0;
        byte currentByte = 0;

        foreach (bool b in values) 
        {

            if (b) currentByte |= (byte)(1 << count);
            count++;
            if (count == 7) { ret.Add(currentByte); currentByte = 0; count = 0; };              

        }

        if (count < 7) ret.Add(currentByte);

        return ret;

    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-07-05T08:57:21.887

除了@JonSkeet's answer之外，您还可以使用如下扩展方法：

```
public static byte ToByte(this BitArray bits)
{
    if (bits.Count != 8)
    {
        throw new ArgumentException("bits");
    }
    byte[] bytes = new byte[1];
    bits.CopyTo(bytes, 0);
    return bytes[0];
} 
```

并使用如下：

```
BitArray foo = new BitArray(new bool[]
{
    false, false, false, false,false, false, false, true
});

foo.ToByte(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-25T22:22:20.560

```
byte GetByte(BitArray input)
{
  int len = input.Length;
  if (len > 8)
    len = 8;
  int output = 0;
  for (int i = 0; i < len; i++)
    if (input.Get(i))
      output += (1 << (len - 1 - i)); //this part depends on your system (Big/Little)
      //output += (1 << i); //depends on system
  return (byte)output;
} 
```

干杯!

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-25T19:15:26.493

Little endian 字节数组转换器：BitArray 中的第一位（以“0”索引）假定代表最低有效位（位八位字节中的最右边位），将其解释为二进制的“零”或“一”。

```
 public static class BitArrayExtender {

    public static byte[] ToByteArray( this BitArray bits ) {

        const int BYTE = 8;
        int length = ( bits.Count / BYTE ) + ( (bits.Count % BYTE == 0) ? 0 : 1 );
        var bytes  = new byte[ length ];

        for ( int i = 0; i < bits.Length; i++ ) {

           int bitIndex  = i % BYTE;
           int byteIndex = i / BYTE;

           int mask = (bits[ i ] ? 1 : 0) << bitIndex;
           bytes[ byteIndex ] |= (byte)mask;

        }//for

        return bytes;

    }//ToByteArray

 }//class 
```

# c++ - gcc 等效于 VC++ 警告 C4018: 有符号/无符号不匹配

> ID：560124
> 
> 赞同：1
> 
> 时间：2009-02-18T07:14:07.453
> 
> 标签：c++, visual-c++, gcc, warnings

是否存在与 VC++ 警告 C4018：有符号/无符号不匹配的 gcc 等效项？我们在使用 /WX 运行的 Windows 上进行了自动构建，我希望在 Linux 上构建时也能够捕捉到这些警告。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T07:16:06.043

`-Wsign-compare`

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-02-18T08:20:39.790

最佳实践是使用它进行编译，`-Wall`为您提供所需的大部分警告。

```
g++ -c -Wall code.cpp -o code.o 
```

这是在**大多数**项目中所做的，实际上它会启用您想要的警告。

# c# - 你怎么知道这是否是一个序数索引？

> ID：560129
> 
> 赞同：0
> 
> 时间：2009-02-18T07:16:40.927
> 
> 标签：c#, datatable

我通过在线使用 C# 在示例中看到了这段代码

> 数据表 dt = ds.Tables["employees"];
> 
> dt.Rows[0]["city"] = "威尔明顿";

我的问题是零代表什么？它是序数索引吗？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T07:19:24.523

0 引用数据表的第一行。（从零开始计数）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T07:25:01.453

在 MSDN 上查找[DataTable](http://msdn.microsoft.com/en-us/library/system.data.datatable.aspx)并查看属性[Rows](http://msdn.microsoft.com/en-us/library/system.data.datatable.rows.aspx)。[它返回DataRowCollection](http://msdn.microsoft.com/en-us/library/system.data.datarowcollection.aspx)的一个实例。

文档并不清楚，但非数组类型也可以实现 [] 索引器。DataRowCollection 实现 [int index] 其中 index 是要返回的行。因此，可以以与使用数组相同的方式访问集合，但这是一个方法调用。例如，不可能将索引方法的返回值作为参考参数传递。

# sas - 我们如何在 sas 数据集中进行条件迭代

> ID：560132
> 
> 赞同：0
> 
> 时间：2009-02-18T07:18:00.237
> 
> 标签：sas

我们如何在 sas 数据集中进行迭代。例如我选择了第一个。的一个变量。并希望找到特定条件的出现并在满足时设置一个值

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-21T05:57:37.660

SAS 数据步骤有一个内置的观察循环。除非出于某种原因，您不需要做任何事情。例如，以下为每个观察生成一个随机数：

```
data one;
  set sashelp.class;
  rannum = ranuni(0);
run; 
```

如果你想循环变量，那么就有数组。例如，以下使用随机数初始化变量 var1 到 var10：

```
data one;
  array vars[1:10] var1-var10;
  do i = 1 to 10;
    vars[i] = ranuni(0);
  end;
run; 
```

首先。最后。当您使用 by 语句设置（排序的）数据时，会自动生成标志。一个例子：

```
proc sort data=sashelp.class out=class;
  by age;
run;
data one;
  set class;
  by age;
  first = first.age;
  last = last.age;
run;
/* check */
proc print data=one;
run;
/* on lst
  Obs    Name       Age    first    last

  1    Joyce       11      1        0
  2    Thomas      11      0        1
  3    James       12      1        0
  4    Jane        12      0        0
  5    John        12      0        0
  6    Louise      12      0        0
  7    Robert      12      0        1
  8    Alice       13      1        0
  ...
 18    William     15      0        1
 19    Philip      16      1        1
*/ 
```

# c# - Asp.net Dev Server 使用错误版本的框架？

> ID：560138
> 
> 赞同：0
> 
> 时间：2009-02-18T07:20:25.533
> 
> 标签：c#, asp.net, visual-studio, asp.net-development-serv

目前正在用 VS2008 开发一个 ASP.NET WebApplication。我停止了几个星期的开发，当我回来时，我的项目出现了以下问题：

整个项目编译良好（全部针对 Framework3.5SP1）。但是，当我（使用 ASP.NET 开发服务器）启动它时，我（从浏览器）收到一条消息，指出存在编译错误“编译器错误消息：CS0234：类型或命名空间名称 'DirectoryServices' 不存在于命名空间“系统”（您是否缺少程序集引用？）”

错误页面底部，版本信息：Version Information: Microsoft .NET Framework Version:2.0.50727.3053；ASP.NET 版本：2.0.50727.3053

服务器使用的是 .NET Framework 版本 2？但我所有的项目都针对 3.5

有没有一种简单的方法可以防止这种情况发生？

我应该补充：

重新安装 .net 框架版本 3.5 + sp1，仍然是同样的问题。这里需要注意的重要一点是，我没有使用完整的 IIS，只是 VS2008 提供的“Asp.net 开发服务器”。（CTRL + F5/启动）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T07:53:07.140

.NET 3.5 的原因不是像 v2.0 或 v1.1 这样的独立框架。它只是 2.0 框架的扩展。该扩展为开发人员提供了新的语言功能，例如匿名类型、扩展方法、Lambda 表达式，当然还有 LINQ .... 并且现在集成了 AJAX。因此，您只需在 IIS 中使用 2.0。

您应该尝试在该服务器上安装 .NET Framework 3.5，IIS 服务器将自动使用正确的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T07:39:07.907

这里只是猜测。会不会是您的开发机器或服务器之一已升级到 .Net 3.5 SP1 而另一个没有？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T07:43:28.570

您的机器 web.config 可能引用 2.0。您可以通过 IIS 管理控制台将其重新配置为 3.5。或者，您可以修改 web.config 中的 <assemblies> 元素以添加 <clear /> 并为每个 3.5 程序集显式指定 <add assembly>。

# workflow-foundation - 为 WF 3.0/3.5 编写长时间运行的自定义活动的最佳实践

> ID：560153
> 
> 赞同：0
> 
> 时间：2009-02-18T07:26:29.560
> 
> 标签：workflow-foundation

为 Workflow Foundation (3.0/3.5) 编写长期运行的自定义活动的最佳实践表明，完全在活动的 Execute 方法中执行长期运行的任务并不是一个好主意。分配给工作流的单个线程将被阻止，从而阻止处理工作流的其他计划请求。

所以对于长时间运行的任务，应该创建一个队列。实际工作将由本地服务（在线程池线程上运行）完成。该服务通过先前的工作流队列将工作结果传递给等待活动。

所以我的问题是，究竟是什么将任务量化为长时间运行？是处理时间的问题吗？什么时候应该创建一个队列，什么时候只使用本地服务就足够了？

感谢您的任何澄清。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T07:50:12.140

您需要什么样的可靠性将主要控制这一点。我认为可以安全地假定任何涉及与一个或多个外部系统（无论是电子邮件）通信的任务都应该在处理时考虑到某种可靠性，即两者之间的持久存储。

长时间运行与其说是一个问题，不如说是如果您在某个时候无法从故障中恢复会发生什么。这就是为什么我在处理工作流时依赖数据库事务来提交或回滚工作流状态。

我会考虑任何可能阻塞超过 2 分钟的操作。根据我有多少可用的免费完成端口，我什至不想等待那么久，但这更多的是负载平衡。保持您的工作流程运行时处理但不阻塞；）

## 编辑

这 2 分钟的事情来自 RFC 793，它规定任何 TCP 会话都不应保持空闲超过 2 分钟。我认为，如果我的系统正在与您的系统通信并且需要超过 2 分钟才能完成，那么他们不应该等待对方完成。

# c - memset 和 SIGSEGV

> ID：560155
> 
> 赞同：1
> 
> 时间：2009-02-18T07:27:03.460
> 
> 标签：c, memory, memset, segmentation-fault

我在一段代码中遇到了一个奇怪的问题。

```
void app_ErrDesc(char *ps_logbuf, char *pc_buf_err_recno)
 {
    char *pc_logbuf_in;
    char rec_num[10];
    char *y = "|";
    int i, j;

    memset(rec_num, 0, sizeof(rec_num));
    memset(pc_buf_err_recno, 0, LOGBUFF);
        .....
        .....
 } 
```

出于某种原因，第一个 memset 调用发送了一个 SIGSEGV。更奇怪的是，在 gdb 内部，同一行执行了大约 30 次，尽管该函数只调用了一次并且内部没有循环！这是一段 gdb 会话。

```
7295            /*Point to logbuffer string*/
(gdb)
7292            memset(rec_num, 0, sizeof(rec_num));
(gdb)
7295            /*Point to logbuffer string*/
(gdb)
7292            memset(rec_num, 0, sizeof(rec_num));
(gdb) n
7295            /*Point to logbuffer string*/
(gdb)
7292            memset(rec_num, 0, sizeof(rec_num));
(gdb) 
```

程序收到信号 SIGSEGV，分段错误。

我还尝试通过 valgrind 的 memcheck 工具运行该程序，但对上述代码没有任何意义。

我正在解析的文件只有一条记录。

任何指针表示赞赏。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T07:56:29.800

它很可能是第二个 memset，原因是调用外部函数时缓冲区大小不足。调试器可能会错误地显示您的位置。尝试在每个步骤之后添加日志记录，以找出究竟是什么崩溃了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T07:52:21.510

我怀疑对函数的调用，所以确保调用不是类似的

```
char pc_buf_err_recno[SMALLER_THAN_LOGBUFF];
char ps_logbuf[TOO_SMALL]
app_ErrDesc(ps_logbuf, pc_buf_err_recno); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T08:03:46.460

调试器可能不正确，尤其是在您获得 SEGV 时。请记住，当您遇到分段错误时，很有可能您已经破坏了堆栈，如果发生这种情况，调试器会感到困惑。

调用函数也很可能弄得一团糟，而不是当前的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T08:05:18.750

> 更奇怪的是，在 gdb 内部，同一行执行了大约 30 次，尽管该函数只调用了一次并且内部没有循环！

这听起来是用优化编译的症状。如果您在关闭优化的情况下进行编译，您可能更容易在 GDB 中查明问题。

# ruby-on-rails - Ruby 和 Ruby on Rails 速成课程大纲

> ID：560163
> 
> 赞同：4
> 
> 时间：2009-02-18T07:33:18.313
> 
> 标签：ruby-on-rails, ruby

我打算为开始学习 Ruby 和 Ruby on rails 的开发人员设计一个入门计划，或者你可以说一个速成课程大纲。我不确定要涵盖的主题数量（以及涵盖的深度），因为这是一个为期 3 天的课程（24 到 27 小时）。此外，新手倾向于将 ruby​​ 与现有的面向对象编程老手（如 C++、Java 或 C#）进行比较。但是由于 Ruby 完全不同（没有抽象类、接口、虚拟关键字等，并且存在模块、mixins 等概念），应该如何设计课程以便新手开始**在 ruby​​ 中“思考”**？因为，我相信一旦他们开始这样做，那些有 C++、Java 或 C# 经验的人可以很快上手。

我能否从经验丰富的 ruby​​/rails 讲师那里获得一些提示或可能已经在使用的 ruby​​/rails 课程摘要？

目的是让新手，尽快生产 ruby​​/rails 应用程序的开发人员。

如果需要，该课程可延长至最多 5 天（40 至 45 小时）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T07:56:24.247

我喜欢向人们展示代码来说明差异。不如从一个简单的循环开始：

> 10次​​做|x| ...

表明即使是一个固定的数字也是一个对象应该唤醒他们。

您还可以表明修改一个类永远不会太晚：

```
class Fixnum
    attr_accessor :foo
end

>> 10.foo = "bar"
=> "bar" 
```

在 20 分钟内快速浏览 Ruby 也可以提供一些想法：[http ://www.ruby-lang.org/en/documentation/quickstart/](http://www.ruby-lang.org/en/documentation/quickstart/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T09:06:17.963

我在[这里](http://www.bignerdranch.com/classes/ruby_ruby_on_rails.shtml)找到了这个。他们也有[关于铁轨的高级课程](http://www.bignerdranch.com/classes/advanced_ruby_on_rails.shtml)。但是，两者都是 7 天的课程。需要压缩/剪切一些东西。

[替代文字 http://www.freeimagehosting.net/uploads/deb9ba083a.png](http://www.freeimagehosting.net/uploads/deb9ba083a.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:02:26.730

我认为这个优秀的教程将有助于快速开始使用 Rails： [http](http://www.onlamp.com/pub/a/onlamp/2006/12/14/revisiting-ruby-on-rails-revisited.html)
://www.onlamp.com/pub/a/onlamp/2006/12/14/revisiting-ruby-on-rails-revisited.html 它演示了你如何构建一个简单的 Rails 应用程序，我认为这是向人们展示它的不同之处的最佳方式。一旦你引起了他们的注意，就可以加入其他的东西，比如 mixins 等。

# c# - 在 C# 中，是列表中的值 盒装？

> ID：560184
> 
> 赞同：35
> 
> 时间：2009-02-18T07:49:03.203
> 
> 标签：c#, generics

假设我声明了一个包含结构类型值的通用列表：

```
struct MyStruct {
    public MyStruct(int val1, decimal val2) : this() {
        Val1 = val1;
        Val2 = val2;
    }
    public int Val1 {get; private set;}
    public decimal Val2 {get; private set;}
}

List<MyStruct> list; 
```

List<> 是否将每个单独的值存储为盒装结构，在堆上单独分配？还是比这更聪明？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-18T07:59:19.437

没有拳击。

> “不，不会有拳击。这是泛型的主要设计目标之一。”

[http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/359cf58a-f53d-478e-bc31-1507e77c9454/](http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/359cf58a-f53d-478e-bc31-1507e77c9454/)

> “如果值类型用于类型 T，编译器会`List<T>`专门为该值类型生成类的实现。这意味着`List<T>`对象的列表元素不必在元素可以使用之前被装箱，并且在大约 500创建列表元素所节省的内存不是装箱列表元素大于用于生成类实现的内存。”

[http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-18T08:04:04.917

它没有装箱，但数据会是原始数据的**副本**，每次取出数据时，它都会**再次**复制。这往往使丢失更改变得容易。因此，您的目标应该是不要编写可变结构。除非`MyStruct`实际上代表一个度量单位（或类似的），否则将其设为一个类。如果它*是*一项措施，请使其不可变（没有公共可设置成员）。

无论哪种方式，都不要公开字段！使用属性；-p

例如：

```
struct MyStruct {
    public MyStruct(int val1, decimal val2) {
        this.val1 = val1;
        this.val2 = val2;
    }
    private readonly int val1;
    private readonly decimal val2;
    public int Val1 {get {return val1;}}
    public decimal Val2 {get {return val2;}}
} 
```

或者（C# 3.0）：

```
struct MyStruct {
    public MyStruct(int val1, decimal val2) : this() {
        Val1 = val1;
        Val2 = val2;
    }
    public int Val1 {get; private set;}
    public decimal Val2 {get; private set;}
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-18T07:56:30.317

不，`List<T>`不装箱。在内部，它将其值存储在一个简单的数组中：

```
public class List<T> : IList<T>, ICollection<T>, IEnumerable<T>, IList, ICollection,    IEnumerable
{
    // Fields
    private const int _defaultCapacity = 4;
    private static T[] _emptyArray;
    private T[] _items;
    private int _size; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T08:05:37.407

```
typeof(List<>) // or informally List`1 
```

...是一个泛型类型。泛型类型或参数化类型的特殊之处在于它们以正常方式编译，但在运行时它们会根据它们的用途再次编译。

如果您将 ValueType 放在通用列表中，例如 List<int> ，则运行时行为会威胁到它好像在存储类型 int （这是按值复制）。不需要进行装箱，因为您不需要将这个 List`1 的类型视为 int 以外的类型。

在 .NET 2.0 之前无法做到这一点，因此臭名昭著的 ArrayList 类维护了一个对象数组，这意味着 ValueType（整数或结构）必须装箱才能放置在该容器中。

不要将这与完全不同的 Java 泛型混淆。Java 泛型是用类型擦除实现的，它不会给你同样的性能提升。Java 所做的是，一旦编译器完成类型检查，它会将所有内容转换为对象。这就是为什么您不能使用 Java 泛型进行反射，而您可以使用 .NET 泛型类型系统。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T08:00:20.073

List 将所有内容存储在 T 类型的数组中。没有装箱，但数组是在堆上分配的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T07:53:08.793

没有拳击，这就是为什么它比非通用方式快一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T07:59:56.983

没有拳击，这是[泛型的好处之一](http://msdn.microsoft.com/en-us/library/b5bx6xee.aspx)：

```
List<int> list1 = new List<int>();    
// No boxing, no casting:
list1.Add(3);

// Compile-time error:
// list1.Add("It is raining in Redmond."); 
```

# wcf - WCF：配置已知类型

> ID：560218
> 
> 赞同：6
> 
> 时间：2009-02-18T08:10:18.567
> 
> 标签：wcf, wcf-configuration

我想知道如何在 WCF 中配置已知类型。例如，我有一个**Person**类和一个**Employee**类。**Employee**类是**Person**类的子类。两个类都标有一个`[DataContract]`属性。

我不想硬编码类的已知类型，例如`[ServiceKnownType(typeof(Employee))]`在 Person 类中放置一个，以便 WCF 知道 Employee 是 Person 的子类。

现在，我在主机的 App.config 中添加了以下 XML 配置：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <system.runtime.serialization>
    <dataContractSerializer>
      <declaredTypes>
        <add type="Person, WCFWithNoLibrary, Version=1.0.0.0,Culture=neutral,PublicKeyToken=null">
          <knownType type="Employee, WCFWithNoLibrary, Version=1.0.0.0,Culture=neutral, PublicKeyToken=null" />
        </add>
      </declaredTypes>
    </dataContractSerializer>
  </system.runtime.serialization>
  <system.serviceModel>
    ....... 
  </system.serviceModel>
</configuration> 
```

我编译它，运行主机，在客户端添加服务引用并添加一些代码并运行客户端。但是出现了错误：

> 格式化程序在尝试反序列化消息时抛出异常：尝试反序列化参数时出现错误 `http://www.herbertsabanal.net:person`。InnerException 消息是“第 1 行位置 247 中的错误。元素 `'http://www.herbertsabanal.net:person'` 包含 `'http://www.herbertsabanal.net/Data:Employee'` 数据合同的数据。反序列化器不知道映射到该合约的任何类型。将与 'Employee' 对应的类型添加到已知类型列表中 - 例如，通过使用 KnownTypeAttribute 属性或将其添加到传递给 DataContractSerializer 的已知类型列表中。有关更多详细信息，请参阅 InnerException。

以下是数据合同：

```
[DataContract(Namespace="http://www.herbertsabanal.net/Data", Name="Person")]
    class Person
    {
        string _name;
        int _age;

        [DataMember(Name="Name", Order=0)]
        public string Name
        {
            get { return _name; }
            set { _name = value; }
        }

        [DataMember(Name="Age", Order=1)]
        public int Age
        {
            get { return _age; }
            set { _age = value; }
        }
    }

[DataContract(Namespace="http://www.herbertsabanal.net/Data", Name="Employee")]
    class Employee : Person
    {
        string _id;

        [DataMember]
        public string ID
        {
            get { return _id; }
            set { _id = value; }
        }
    } 
```

顺便说一句，我的服务没有使用类库（WCF 类库或非 WCF 类库）。我只是在宿主项目中对其进行了简单的编码。

我想配置文件肯定有问题（请参阅上面的配置文件）。或者我一定错过了什么。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T08:53:15.657

我想我现在已经找到了答案。

我在上面发布的配置文件如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <system.runtime.serialization>
    <dataContractSerializer>
      <declaredTypes>
        <add type="Person, WCFWithNoLibrary, Version=1.0.0.0,Culture=neutral,PublicKeyToken=null">
          <knownType type="Employee, WCFWithNoLibrary, Version=1.0.0.0,Culture=neutral, PublicKeyToken=null" />
        </add>
      </declaredTypes>
    </dataContractSerializer>
  </system.runtime.serialization>
  <system.serviceModel>
    ....... 
  </system.serviceModel>
</configuration> 
```

我刚刚添加的是**Person**类和**Employee**类的命名空间。并且不需要更长的 Version 和 Culture 值......正确的配置应该是：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <system.runtime.serialization>
    <dataContractSerializer>
      <declaredTypes>
        <add type="WCFWithNoLibrary.Person, WCFWithNoLibrary">
          <knownType type="WCFWithNoLibrary.Employee, WCFWithNoLibrary" />
        </add>
      </declaredTypes>
    </dataContractSerializer>
  </system.runtime.serialization>
  <system.serviceModel>
    ....... 
  </system.serviceModel>
</configuration> 
```

现在它更短，更有意义。但如果使用 3rd 方库，则需要添加版本、文化、publickeytokens。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-17T14:46:43.627

我知道这是很久以前回答的，但是，另一个（对于未来的程序员可能更明显）解决方案：

```
[KnownType(typeof(SubClass))]
public class BaseClass 
```

斯科特

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-21T14:23:30.193

在另一种情况下，我也收到了这个冗长的错误消息。我确实使用`KnownTypeAttribute`并成功部署了一个`WCF.RIA`用于生产的应用程序。在第二个版本中，我添加了一个新的子类型，并添加了必要的对应`KnownTypeAttribute`（编译器不接受没有这个属性 - 很好）。但是，编译器接受的内容以及在我的机器上运行的内容并没有在生产中运行。只有在生产中我才得到上面提到的错误。比较现有子类型和新子类型的所有用法，我发现我忘记了`WCF.RIA`需要在方法名称中使用子类型的名称，例如 GetMySubTypes。因此，如果在添加属性后出现此错误，请查看是否是因为`WCF.RIA`s 约定。

# sql - Microsoft SQL Server 2008 外部备份

> ID：560230
> 
> 赞同：3
> 
> 时间：2009-02-18T08:17:38.127
> 
> 标签：sql, sql-server, sql-server-2008, backup

我想将我的备份从我的 SQL 2008 服务器保存到另一个服务器位置。我们有 2 台服务器：

*   部署服务器
*   文件服务器

问题是部署服务器没有太多空间。我们保留 10 天的数据库备份。因此，我们需要将备份存储在外部“文件服务器”上。问题是 SQL 不允许这样做。我尝试使用在两台电脑（域帐户）上都具有管理员权限的帐户运行 SQL 2008 服务，但这仍然不起作用。

关于这个的任何想法。否则我们将不得不在机架服务器上放置一个外部硬盘，这有点愚蠢，不是吗？

**编辑：**

我找到了一种让它工作的方法。您必须在服务器上共享该文件夹。然后授予开发服务器（PC 本身）写入权限。这将使 SQL Server 的外部备份成为可能。不知道它是否安全，我觉得给一个文件夹的计算机权限有点奇怪。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-05T09:53:46.347

您可以使用[SqlBackupAndFTP等 3rd 方工具](http://SqlBackupAndFTP.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-24T01:19:07.767

已经描述了几种执行此操作的方法，但这是基于我的开源项目[SQL Server Compressed Backup](http://sourceforge.net/projects/mssqlcompressed/)的。它是一个用于备份 SQL Server 数据库的命令行工具，它可以写入运行它的 NT 用户可以写入的任何位置。只需将其安排在与具有适当权限的用户一起运行的计划任务中即可。

备份到另一台服务器上的共享的示例是：

```
msbp.exe backup "db(database=model)" "gzip" "local(path=\\server\share\path\model.full.bak.gz)" 
```

所有对备份文件有意义的 BACKUP 命令选项都可用：日志、差异、copy_only、校验和等（例如，磁带驱动器选项不可用）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T08:23:17.413

在使用批处理文件开始备份后的一定时间后，您可能会使用调度程序来移动备份。

如果我没记错的话，有一个 hack 可以使 sql server 备份到远程存储上，但我不认为 hack 是要走的路。

当然，最好的可能是使用支持代理使用的外部备份工具。他们控制备份何时开始并负责移动文件。

萨沙

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T13:01:24.967

您可以创建一个漂亮而整洁的小型 SQL Server 集成服务 (SSIS) 包来执行备份，然后将数据移动到您的备用文件存储中。

有趣的是，SQL Server 中的维护计划实际上使用了 SSIS 组件。这些相同的组件可在商业智能设计工作室 (BIDS) 中使用。

我希望这很清楚，但如果您需要进一步的帮助，请告诉我。

干杯，约翰

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T17:03:16.820

我的经验是旧版本的 MSSQL，所以 SQL2008 中可能有一些东西可以更好地帮助你。

我们的一些旧服务器上的磁盘空间非常紧张。这些是我们 ISP 的机器，它们从磁带恢复的提前期并不好 - 24 小时并不少见 :( 所以我们需要保持一个体面的在线备份历史记录。

我们在周日进行完全备份，每晚进行一次差异备份，每 10 分钟进行一次 TLog 备份。

我们在表/索引碎片整理和统计更新期间每分钟强制 Tlog 备份 - 这是因为这些是我们运行的最密集的 TLog 任务，并且它们以前负责确定常设 Tlog 文件的大小；自此更改以来，我们已经能够运行比以前小 60% 的 TLog 站立大小。

不过值得关注 Diff 备份的大小 - 如果事实证明，到周三备份时，您的 DIFF 备份已接近完整备份的大小，您不妨每周运行两次完整备份，并在下一次备份时使用较小的 Diff 备份一两天。

当您删除完整或差异备份文件（以恢复磁盘空间）时，请确保删除较早的 TLog 备份。但是考虑一下您的恢复路径——您是否希望能够恢复上周日的完整备份以及此后的所有 Tlog，或者您是否很高兴对于即时恢复您只能回到昨晚的 DIFF 备份？（即要返回更远，您只能恢复到 FULL / DIFF 备份，而不是时间点）如果后者，您可以在进行 DIFF 备份后立即删除所有较早的 Tlog 备份。

（显然，无论如何，您需要将备份保存到磁带等和复制服务器上，您不必依赖磁带恢复来进行还原，但是您正在失去还原粒度时间）

我们可以将最后一个完整（或最后一个完整加上星期一的 DIFF）恢复到“临时数据库”以检查某些内容，然后删除该数据库，但如果我们真的必须恢复到“上星期一过去 15 分钟”上午 10 点”，我们将不得不从磁带或复制服务器上获取备份。

我们所有的备份文件都在带有压缩集的 NTFS 目录中。（您可能可以直接从 SQL2008 进行压缩备份？？，我们拥有的磁盘不足的服务器正在运行 SQL2000）。我已经读到这是不受欢迎的，但从来没有看到很好的理由，而且我们从来没有遇到过问题 - 触摸木头！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-10T06:47:18.040

一些第三方备份软件允许为网络位置设置特定的用户权限。因此，SQL Server 服务帐户拥有什么权限并不重要。我建议您尝试 EMS SQL Backup，它还支持“即时”备份压缩以节省存储空间。

# php - 有 PHP4 的分支吗？

> ID：560231
> 
> 赞同：3
> 
> 时间：2009-02-18T08:18:37.080
> 
> 标签：php, fork, php4

有没有人 fork PHP4 来继续支持这个版本？

**编辑：**这不是关于迁移到 PHP5 的问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-18T08:24:19.297

据我所知 - 没有。PHP5 具有很好的向后兼容性，如果安全性对你来说有点重要，你不应该在任何面向公众的网络服务器上运行 PHP4。

我估计 PHP5 99% 向后兼容。[这是一篇博客文章](http://www.sitepoint.com/blogs/2004/07/15/backwards-compatibility-in-php5/)，其中包含您可能会遇到的典型（小）问题，通常是函数在极端情况下的行为方式。您可能想要查看的另外两个资源是 PHP 手册中的[从 PHP 4 迁移到 PHP 5和](http://php.net/manual/en/faq.migration5.php)[PHP5 迁移附录](http://www.php.net/manual/en/migration5.php)，特别是[向后不兼容的更改](http://www.php.net/manual/en/migration5.incompatible.php)。

总结一下：迁移后需要进行详细的测试。大多数事情都会起作用，但有些事情可能会在极端情况下失败。有些事情可以通过调整 php.ini 来解决，有些需要一些更改。一般来说，为 PHP4 编写的应用程序不如为 PHP5 编写的应用程序安全，因为某些安全功能不存在或未被广泛使用。因此，还应考虑[mod_security](http://www.modsecurity.org/)或[PHPIDS （或两者）之类的东西。](http://php-ids.org/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T02:05:51.127

没有已知的 PHP4 分支可以继续提供支持。

PHP4 的代码非常大，并且通过它的所有扩展，它将是一个非常大的项目，可以作为遗留应用程序来支持。

# hibernate - 修复来自 Hibernate 的警告

> ID：560235
> 
> 赞同：2
> 
> 时间：2009-02-18T08:22:19.193
> 
> 标签：hibernate, warnings

我目前正在研究一个 Hibernate 项目。我当前的开发设置在启动时有相当长的调试打印输出，来自很多休眠警告。我想把它清理干净。

> 2009-02-18 09:14:19 org.hibernate.util.JDBCExceptionReporter logWarnings 警告：[Microsoft][SQLServer 2000 JDBC 驱动程序][SQLServer]将语言设置更改为 us_english。

我该如何解决这个问题？谷歌无法给我答案

> 2009-02-18 09:14:19 org.hibernate.util.JDBCExceptionReporter logWarnings 警告：SQL 警告：0，SQLState：

这个我不明白。谁能解释一下？

> 2009-02-18 09:48:36 org.hibernate.util.JDBCExceptionReporter logWarnings 警告：[Microsoft][SQLServer 2000 JDBC 驱动程序][SQLServer]将数据库上下文更改为“bess_test”。

我如何指定数据库，以避免这种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:56:56.570

将来当您想要为 Hibernate 的特定部分打开日志记录时，您可能会发现这很有帮助。此配置还应该隐藏您看到的警告。

```
# Hibernate logging
# Log everything (a lot of information, but very useful for troubleshooting)
log4j.logger.org.hibernate=FATAL
# Log all SQL DML statements as they are executed
log4j.logger.org.hibernate.SQL=INHERITED
# Log all JDBC parameters
log4j.logger.org.hibernate.type=INHERITED
# Log all SQL DDL statements as they are executed
log4j.logger.org.hibernate.tool.hbm2ddl=INHERITED
# Log the state of all entities (max 20 entities) associated with the session at flush time
log4j.logger.org.hibernate.pretty=INHERITED
# Log all second-level cache activity
log4j.logger.org.hibernate.cache=INHERITED
# Log all OSCache activity - used by Hibernate
log4j.logger.com.opensymphony.oscache=INHERITED
# Log transaction related activity
log4j.logger.org.hibernate.transaction=INHERITED
# Log all JDBC resource acquisition
log4j.logger.org.hibernate.jdbc=INHERITED
# Log all JAAS authorization requests
log4j.logger.org.hibernate.secure=INHERITED 
```

# sql - 您将如何维护 SQL 表中的历史记录？

> ID：560236
> 
> 赞同：2
> 
> 时间：2009-02-18T08:22:42.810
> 
> 标签：sql

我正在设计一个数据库来存储产品信息，并且我想存储几个月的历史（价格）数据以供将来参考。但是，我想在一段时间后开始覆盖初始条目，以最小的努力找到初始条目。有谁知道如何解决这个问题？我最初的设计是有一个名为历史数据的表，它每天都会提取活动数据并将其存储到带有时间戳的历史数据库中。有没有人有更好的主意？或者可以看看我的有什么问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T08:26:50.260

首先，我想对您提出的解决方案发表评论。当然，薄弱的部分是，实际上，您的间隔之间可以有不止一个变化。这意味着，记录在一天中被更改了 3 次，但您只归档最后一次更改。

有可能有更好的解决方案，但它必须是事件驱动的。如果您有支持事件或触发器的数据库服务器（如 MS SQL），您应该编写一个在历史表中创建条目的触发器代码。如果您的服务器不支持触发器，您可以将归档代码添加到您的应用程序（在保存操作期间）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T08:25:33.583

这是一个比最初看起来更广泛的话题。Martin Fowler对“随时间变化的事物”有一个很好的[叙述。](http://martinfowler.com/eaaDev/timeNarrative.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T08:31:13.790

你可以在你的价格表上放置一个触发器。这样，您可以在每次更新或删除事件时将旧价格存档在另一个表中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T09:41:37.537

> > 我想在一段时间后开始覆盖初始条目，以最小的努力找到初始条目

正如其他人建议的那样，我们使用触发器将数据存储在存档表中。我们的存档表有额外的 AuditDate 列，并存储“已删除”数据 - 即数据的先前版本。当前数据仅存储在实际表中。

我们按照“删除所有超过 3 个月的存档数据，其中至少存在一个小于 3 个月的存档记录；删除所有超过 6 个月的存档数据”的业务规则修剪存档表

因此，如果过去 3 个月内没有价格变化，您仍然会有 3-6 个月前的价格变化记录。

（询问您是否需要自引用连接的示例来执行删除，或触发器来存储存档表中的更改）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T08:31:18.203

如果您所需的历史数据是当天数据结束的快照，IMO 您的方法似乎是合理的 - 过去我曾使用类似的方法来处理隔夜作业 (SP)，这些作业会获取当天的新数据，为其添加时间戳，然后使用“删除所有时间戳<今天 - x”的数据，其中 x 是我要保留的数据的时间段。

如果您需要跟踪所有历史更改，那么您需要查看触发器。

# linux - 如何在 Linux/Unix 中创建大小超过 2GB 的文件？

> ID：560238
> 
> 赞同：8
> 
> 时间：2009-02-18T08:23:39.267
> 
> 标签：linux, tar, filesize

我有这个家庭作业，我必须使用 bittorrent 算法将一个非常大的文件从一个源传输到多台机器。最初，我将文件切割成块，然后将块传输到所有目标。目标具有与其他目标共享其拥有的块的智能。它工作正常。我想传输一个 4GB 的文件，所以我压缩了四个 1GB 的文件。当我创建 4GB tar 文件时它没有出错，但在另一端将所有块组装回原始文件时出错，说超出了文件大小限制。我该如何解决这个 2GB 限制问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T08:33:28.730

我可以想到两个可能的原因：

*   您的 Linux 内核中没有启用[大文件支持](http://www.suse.de/~aj/linux_lfs.html)
*   您的应用程序没有编译支持大文件（您可能需要传递 gcc 额外标志来告诉它使用某些文件 I/O 函数的 64 位版本。例如`gcc -D_FILE_OFFSET_BITS=64`）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T08:27:22.567

这取决于[文件系统类型](http://www.novell.com/documentation/suse91/suselinux-adminguide/html/apas04.html)。使用 ext3 时，我对大得多的文件没有这样的问题。

如果底层磁盘是 FAT、NTFS 或 CIFS (SMB)，您还必须确保使用最新版本的相应驱动程序。有一些较旧的驱动程序具有文件大小限制，就像您遇到的那样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T08:27:45.233

这可能与[系统限制配置](http://www.cyberciti.biz/faq/file-size-limit-exceeded-error-under-linux-and-solution/)有关吗？

```
$ ulimit -a
vi /etc/security/limits.conf
vivek       hard  fsize  1024000 
```

如果您不希望`fsize`从`/etc/security/limits.conf`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T08:32:34.957

如果您的系统支持它，您可以通过以下方式获得提示：`man largefile`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T08:47:23.890

You should use fseeko and ftello, see [fseeko(3)](http://linux.die.net/man/3/fseeko) Note you should define `#define _FILE_OFFSET_BITS 64`

```
#define _FILE_OFFSET_BITS 64
#include <stdio.h> 
```

# c# - 新的 IntPtr(0) 与 IntPtr.Zero

> ID：560244
> 
> 赞同：26
> 
> 时间：2009-02-18T08:26:11.883
> 
> 标签：c#, .net, pinvoke

这两种说法有什么区别：

```
IntPtr myPtr = new IntPtr(0);
IntPtr myPtr2 = IntPtr.Zero; 
```

如果 myPtr 参数由 ref 发送到被调用函数，我已经看到许多使用 PInvoke 的示例更喜欢第一种语法。如果我在我的应用程序中用 IntPtr.Zero 替换所有新的 IntPtr(0)，它会造成任何损害吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-18T08:50:21.467

`IntPtr`是一种值类型，因此与`String.Empty`拥有静态属性的好处不同`IntPtr.Zero`

只要你通过`IntPtr.Zero`任何地方你都会得到一个副本，所以对于变量初始化它没有区别：

```
IntPtr myPtr = new IntPtr(0);
IntPtr myPtr2 = IntPtr.Zero;

//using myPtr or myPtr2 makes no difference
//you can pass myPtr2 by ref, it's now a copy 
```

有一个例外，那就是比较：

```
if( myPtr != new IntPtr(0) ) {
    //new pointer initialised to check
}

if( myPtr != IntPtr.Zero ) {
    //no new pointer needed
} 
```

正如几张海报已经说过的那样。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T08:28:29.333

它们在功能上是等效的，所以应该不会引起任何问题。

`IntPtr.Zero`表示结构的默认状态（已声明但未使用构造函数），因此 的默认`intptr (void*)`值为`null`. 然而，因为`(void*)null`和`(void*)0`是等价的，`IntPtr.Zero == new IntPtr(0)`

**编辑：**虽然它们是等价的，但我建议使用`IntPtr.Zero`比较，因为它更容易阅读。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T08:32:16.580

的使用`IntPtr.Zero`将允许您避免`IntPtr`.

来自[msdn](http://msdn.microsoft.com/en-us/library/system.intptr.zero(VS.85).aspx)：

> 使用此字段可以有效地确定 IntPtr 的实例是否已设置为非零值

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T08:40:34.657

如果你通过`IntPtr.Zero`ref 传递，而接收者试图修改引用会发生什么？从那一刻起，`IntPtr.Zero != new IntPtr(0)`接收者是否会在尝试进行更改时收到某种异常？

我不确定这一点，但这似乎是一个合理的解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-04T22:48:13.353

JITter 可以像内联 IntPtr.Size 一样内联 IntPtr.Zero。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-18T08:30:50.670

这主要是一个问题封装（和性能，但程度要小得多）。在未来的某个时刻，微软可能会决定（尽管这不太可能）一个未初始化的指针值从现在开始等于`0xDEADBEEF`，从而使所有`new IntPtr(0)`代码无效。

就性能而言，MSDN 是这样说的：

> 例如，假设变量 ,`ip`是 的一个实例`IntPtr`。您可以通过将其与构造函数返回的值进行比较来确定它是否已设置，例如：“ if ip != new IntPtr(0)...”。但是，调用构造函数来获取未初始化的指针是低效的。最好编码“ `if ip != IntPtr.Zero...`”或“ `if !IntPtr.Zero.Equals(ip)...`”。

# asp.net-mvc - MS Expression Web（和其他 Web 编辑工具）中的 Asp.net mvc

> ID：560247
> 
> 赞同：3
> 
> 时间：2009-02-18T08:27:22.580
> 
> 标签：asp.net-mvc

今天我屈服于所有要求我测试 MS Expression web 2 演示的横幅。经过一些设置后，我启动了这个东西并立即遇到了一个问题：如何使这个工具与我的 asp.net-mvc 项目一起工作？实际上，我如何让我的网站使用除 Visual Studio 2008 之外的任何工具？

直到现在我用 VS2008 / Notepad++ 完成了所有的事情。有没有人在dreamweaver、expression web 等工具中使用asp.net-mvc 项目的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-10T19:58:07.307

您可以使用任何 Web 工具来编辑网站的 HTML+CSS+Javascript 端，但您需要使用 VS2008 或 MSBuild 对其进行编译才能运行它。

# .net - 叠加两个控件

> ID：560249
> 
> 赞同：5
> 
> 时间：2009-02-18T08:28:16.480
> 
> 标签：.net, wpf, layout

我开始在 WPF 中做一些事情，我有一个问题。我认为答案可能很简单，甚至很明显，但不知何故......

我在一个由网格包围的表单上有两个控件。我想要将第二个控件放在第一个控件之上（它是透明的）。来自并不难的 WinForms 开发，因此它不会出现在 WPF 中。但我不明白这一点...

萨沙

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T08:37:34.913

`Grid`和`Canvas`控件都会做你想做的事。

在大多数情况下，我建议使用`Grid`to 覆盖元素，因为您还可以轻松控制它们调整大小的方式。它们将按照您定义它们的顺序堆叠（最后定义在顶部）。

尝试这样的事情：

```
<Grid>
    <Rectangle Fill="Blue"/>
    <Ellipse Fill="Red"/>
</Grid> 
```

[顺便说一句，在Kaxaml](http://www.kaxaml.com/)这样的交互式工具中学习 XAML 要容易得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T08:34:58.740

如果我理解正确，只需将控件以相反的顺序放入 Grid 中。顺序决定控件的 Z-Index

```
 <Grid>
    <c:ControlFirst/>
    <c:ControlSecond/>        
  </Grid> 
```

# iphone - kCGColorSpaceGenericRGB 在 iPhone 上已弃用？

> ID：560254
> 
> 赞同：16
> 
> 时间：2009-02-18T08:30:46.520
> 
> 标签：iphone, cocoa, image, colors, core-graphics

我正在尝试使用以下代码获取位图上下文：

```
GContextRef MyCreateBitmapContext (int pixelsWide, int pixelsHigh)
{
    CGContextRef    context = NULL;
    CGColorSpaceRef colorSpace;
    void *          bitmapData;
    int             bitmapByteCount;
    int             bitmapBytesPerRow;

    bitmapBytesPerRow   = (pixelsWide * 4);                          // 1
    bitmapByteCount     = (bitmapBytesPerRow * pixelsHigh);

    colorSpace = CGColorSpaceCreateWithName(kCGColorSpaceGenericRGB);// 2
    bitmapData = malloc( bitmapByteCount );                          // 3
    if (bitmapData == NULL)
    {
        fprintf (stderr, "Memory not allocated!");
        return NULL;
    }

    context = CGBitmapContextCreate (bitmapData,                     // 4
                                    pixelsWide,
                                    pixelsHigh,
                                    8,      // bits per component
                                    bitmapBytesPerRow,
                                    colorSpace,
                                    kCGImageAlphaPremultipliedLast);
    if (context== NULL)
    {
        free (bitmapData);                                          // 5
        fprintf (stderr, "Context not created!");
        return NULL;
    }

    CGColorSpaceRelease( colorSpace );                              // 6
    return context;                                                 // 7
} 
```

警告说：`'kCGColorSpaceGenericRGB' is deprecated.`

这是否意味着它`colorSpace`是不可改变的？如果这是真的，我们将无法使用`colorSpace`. 那么如何处理图像呢？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-18T08:48:01.487

不推荐使用通用颜色空间。而是尝试；

`CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB()`;

# regex - 正则表达式等价

> ID：560263
> 
> 赞同：16
> 
> 时间：2009-02-18T08:35:07.883
> 
> 标签：regex, algorithm, dfa

有没有办法找出两个任意正则表达式是否等价？对我来说看起来很复杂，但可能有一些 DFA 简化机制之类的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T09:35:37.660

要测试等价性，您可以计算表达式的[最小 DFA并进行比较。](http://www.google.de/search?hl=en&q=minimal+dfa)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-18T10:03:12.600

等式的可测试性是正则表达式的经典属性之一。（注意，如果你真的在谈论 Perl 正则表达式或其他一些技术上非常规的超级语言，这不成立*。*）

将你的 RE 转换为广义有限自动机 A 和 B，然后构造一个新的自动机 AB，使得 A 的接受状态到 B 的起始状态的转换为零，并且 B 的接受状态反转。这给了你一个自动机，它接受 A 接受的所有字符串，除了 B 接受的所有字符串。

对 BA 做同样的事情，并将两者都简化为纯 FA。如果 FA 没有可从起始状态访问的接受状态，则它接受空语言。如果你能证明 AB 和 BA 都是空的，你就证明了 A = B。

`Edit`嘿，我不敢相信没有人注意到那里的巨大错误——当然是故意的：-p

所描述的自动机 AB 将接受前半部分被 A 接受而后半部分不被 B 接受的字符串。构建*所需*的AB 是一个稍微棘手的过程。我无法想到它，但我确实知道它是明确定义的（并且可能涉及创建状态以表示 A 中的接受状态和 B 中的非接受状态的产物）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T10:05:18.650

这实际上取决于您所说的正则表达式的含义。正如其他发帖者所指出的，将这两个表达式减少到它们的最小 DFA 应该可以工作，但它只适用于纯正则表达式。

现实世界的正则表达式库中使用的一些结构（尤其是反向引用）赋予它们表达非正则语言的能力，因此 DFA 算法不适用于它们。例如，正则表达式 :`([a-z]*) \1`匹配由空格分隔的相同单词的两次出现（`a a`and`b b`但不是`b a`nor `a b`）。有限自动机根本无法识别这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T08:49:51.373

这两个 Perlmonks 线程讨论了这个问题（具体来说，请阅读 blokhead 的回复）：

*   [正则表达式的比较可满足性](http://www.perlmonks.org/index.pl?node_id=423487)
*   [测试正则表达式等价](http://www.perlmonks.org/index.pl?node_id=531661)

# java - 自动化在 Eclipse 中创建的 Web 应用程序的构建过程

> ID：560268
> 
> 赞同：1
> 
> 时间：2009-02-18T08:37:00.093
> 
> 标签：java, eclipse, ant, build-process

我有一个 Eclipse Tomcat 项目，它对其他 Eclipse 项目有几个依赖项。

例如，假设主项目名为 server 并且有几个依赖项：

*   服务器

（取决于）：

*   数据库
*   服务器工具
*   消息传递工具

目前，每次我更改 data-lib、server-utils、messaging-utils 时，我都必须重新创建 .jar 文件并将其复制到服务器的 WEB-INF/lib 目录中。那时我将服务器导出为 .war 并部署到我的服务器。

我想使用 ant 从 cmd 行使这个过程工作（注意我知道 maven 就在那里，但从过去的经验中我对 ant 非常了解，所以现在更愿意坚持使用它）。为服务器创建构建文件很容易——它最终会创建一个 .war 文件。但我希望它自动构建依赖库。我想这样做，同时在 Eclipse 中保留我的开发工作区。

最简单和最干净的方法是什么？目前我的想法是每个单独的项目都有自己的 build.xml（即 data-lib/build.xml 、 server-utils/build.xml 等）。我将让 server/build.xml 对这些单独的构建文件进行 antcall，然后将 jar 复制到 server/WEB-INF/lib 目录。

有没有更简单/更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T21:38:19.223

如果你想要一个基于 Ant 的脚本，我会选择[Apache Ivy](http://ant.apache.org/ivy/)。基本思想是您的每个子模块都有自己的 build.xml 文件，并（通过 Ivy）将它们的“出版物”（如 Jar 文件）发布到文件系统上的存储库。然后其他模块导入这些“出版物”来构建最终产品。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T08:46:10.383

我不确定它是否可以帮助您，但是在您的 WAR 项目中，在 Package Explorer 中右键单击它，然后单击 Properties。有一个“J2EE 模块依赖关系”。在此选项中，选择所有依赖项（即“data-lib”、“server-utils”和“messaging-utils”）。

现在，当您在其中一个依赖项中修改 Java 类时，Eclipse 将重新创建 JAR 文件并将其直接部署到您的 Web 应用程序的 WEB-INF/lib 中。

# web-services - 使用 vbscript 调用具有身份验证的 Web 服务

> ID：560269
> 
> 赞同：3
> 
> 时间：2009-02-18T08:37:10.890
> 
> 标签：web-services, authentication, vbscript

当我使用如下 vbscript 代码时，如何在 web 服务中获取用户名和密码。

```
call oXMLHTTP.open("POST","http://localhost:11883/ServiceCall.asmx/GetEmloyee,false,testUser,testPasword) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-07T05:54:57.447

您的代码示例是正确的。

从[MSDN 参考](http://msdn.microsoft.com/en-us/library/aa924068.aspx)：

`oXMLHttpRequest.open(bstrMethod, bstrUrl, varAsync, bstrUser, bstrPassword);`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-07T06:01:18.577

您还必须[`send`](http://msdn.microsoft.com/en-us/library/ms763706(VS.85).aspx)在调用后调用该方法[`open`](http://msdn.microsoft.com/en-us/library/ms757849(VS.85).aspx)。

# xml - 如何比较 Oracle XML Gateway 消息设计器映射？(.xgm)

> ID：560273
> 
> 赞同：1
> 
> 时间：2009-02-18T08:38:31.790
> 
> 标签：xml, oracle, version-control

它们是 XML，但似乎每次保存地图时都会重新创建它们，并且内部元素的 id 每次都在变化。该工具（消息设计器）相当陈旧，使用起来不太方便。

您是否有任何提示如何在此类地图中进行版本化、跟踪更改？或者消息设计器有替代方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T02:33:54.097

在开发和加载 Oracle XML Gateway 消息映射时，您可以使用多种方法来跟踪版本。但是，它们都是手动的，需要在开发团队中设置标准。

除了 SVN 等版本跟踪工具之外，每次更改消息映射时，您都可以在“属性”选项卡中更改映射名称。然后每次加载地图时，您都可以从 XML 网关的贸易伙伴设置中选择要使用/测试的版本。如果您的问题是如何比较两个现有的地图文件以找出它们之间的差异......不幸的是，最有效的方法是启动 Message Designer 的两个会话，将它们平铺并并排移动。确定哪些元素映射到哪些相对简单（假设您正在比较相同源和目标定义和映射的细微变化）。您可以特别关注在元素映射选项卡中具有蓝色圆圈图标的元素或关卡 - 这就是使用的逻辑变得重要的地方。确实，地图文件本身是 XML 格式的，但是使用比较工具将 XML 与另一个进行比较几乎没有什么用处……在这种情况下，人类分析确实没有替代品。使用消息设计器工具进行比较可以公开逻辑和前、中、后处理过程以及元素本身。

希望这会有所帮助，如果我误解了这个问题，请随时详细说明，我很乐意再次回答。

最好的，

梅格汉森

[Oracle XML 网关顾问](http://oraclexmlgatewayconsultant.com)

# wcf - 通过 WCF 服务显示远程文件

> ID：560279
> 
> 赞同：0
> 
> 时间：2009-02-18T08:40:51.707
> 
> 标签：wcf, user-interface

我不想重新发明轮子，我必须显示远程文件和文件夹（就像 SQL Management Studio 一样），我应该开发自己的界面和逻辑还是有替代方案？我需要多项选择。

我正在使用 VS2008 .Net Framework 3.5 SP1

谢谢

编辑：

我构建了一个在网络中运行的多环境音乐服务器，我必须提供选择应该播放哪些音乐文件或文件夹的能力。这些文件驻留在服务器上，对客户端不可用。客户端通过我构建的 WCF 服务与服务器通信。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T12:34:45.903

当你说远程时，你到底是什么意思？您是指在您的 Intranet 中的另一台服务器上，还是在万维网上？

如果您只需要查看 Intranet 中另一台机器上的文件，.net 中的内置文件选择器将起作用。您需要做的就是给它一个网络地址（例如：\somemachine\somefilepath）。

如果您的意思比这更远，那么 FTP 可能是一种选择。您可以在很短的时间内在您的 C# 应用程序中构建自己的基本 FTP 功能。谷歌“C# FTP”，你会发现很多例子。

第三种选择是返回文件名列表的简单 WCF 服务。但是你说你需要“多选”，所以我假设你想做的不仅仅是“读取”文件，在这种情况下你需要通过网络传输它们，在这种情况下我推荐 FTP 路由。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:02:39.663

除上述内容外 - “文件”是什么意思，您希望如何显示它们？在自定义应用程序中，还是使用 Windows 资源管理器？

* * *

如上所述，WCF 可能不是最合适的方法。世界上已经有文件传输协议了，如果不想重新发明轮子，就不应该创建基于WCF的文件传输协议。您应该使用 FTP、HTTP 或 WebDAV。

否则，您应该查看这些协议（尤其是 WebDAV）以获取有关您的服务需要做什么的灵感。它将需要公开文件和文件夹的概念，并有一种获取文件信息和获取文件的方法。

就像“轮子”已经做的那样。

# c# - WPF 圆角 - 拐角处是否有一致的渐变？

> ID：560282
> 
> 赞同：4
> 
> 时间：2009-02-18T08:44:53.350
> 
> 标签：c#, wpf, xaml, rounded-corners

我在表情混合中制作了一个我非常喜欢的渐变，我正在尝试确定是否可以在拐角处制作渐变曲线，从而为我提供渐变的圆角边框效果。

问题是我不能使用正常的边框，因为渐变不会是一致的。

我想出了以下内容，这应该有助于证明我的想法： [渐变圆角 http://img232.imageshack.us/img232/9899/roundedcornerrg0.th.jpg](http://img232.imageshack.us/img232/9899/roundedcornerrg0.th.jpg)

```
<Grid x:Name="grid" >
    <Border
        BorderThickness="0,0,40,40"
        CornerRadius="0,0,40,0"
        Padding="2" Height="60" VerticalAlignment="Bottom" Width="65" HorizontalAlignment="Right" >
        <Border.BorderBrush>
            <RadialGradientBrush>
                <RadialGradientBrush.RelativeTransform>
                    <TransformGroup>
                        <ScaleTransform CenterX="0.5" CenterY="0.5" ScaleX="2.058" ScaleY="2.177"/>
                        <SkewTransform AngleX="0" AngleY="0" CenterX="0.5" CenterY="0.5"/>
                        <RotateTransform Angle="-119.481" CenterX="0.5" CenterY="0.5"/>
                        <TranslateTransform X="0.209" Y="0.52"/>
                    </TransformGroup>
                </RadialGradientBrush.RelativeTransform>
                <GradientStop Color="#FF000000" Offset="0"/>
                <GradientStop Color="#000A0A0A" Offset="1"/>
                <GradientStop Color="#6B050505" Offset="0.829"/>
                <GradientStop Color="#BB020202" Offset="0.763"/>
            </RadialGradientBrush>
        </Border.BorderBrush>
    </Border>
    <Rectangle VerticalAlignment="Stretch" Height="100" Width="40" HorizontalAlignment="Right" Margin="0,0,0,60" StrokeThickness="0" Panel.ZIndex="0">
        <Rectangle.Fill>
            <LinearGradientBrush EndPoint="-0.025,0.5" StartPoint="1,0.5">
                <GradientStop Color="#FF000000" Offset="0"/>
                <GradientStop Color="#000A0A0A" Offset="1"/>
                <GradientStop Color="#6B050505" Offset="0.829"/>
                <GradientStop Color="#BB020202" Offset="0.763"/>
            </LinearGradientBrush>
        </Rectangle.Fill>
    </Rectangle>
    <Rectangle VerticalAlignment="Bottom" Height="40" Width="100" HorizontalAlignment="Stretch" Margin="0,0,65,0">
        <Rectangle.Fill>
            <LinearGradientBrush EndPoint="0.5,0" StartPoint="0.5,1">
                <GradientStop Color="#FF000000" Offset="0"/>
                <GradientStop Color="#000A0A0A" Offset="1"/>
                <GradientStop Color="#6B050505" Offset="0.829"/>
                <GradientStop Color="#BB020202" Offset="0.763"/>
            </LinearGradientBrush>
        </Rectangle.Fill>
    </Rectangle>
</Grid> 
```

有什么办法可以像我想的那样在拐角处弯曲渐变？我在网上看到一个建议将边界相互嵌套，但这对我也没有好处，因为渐变让生活变得困难。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T08:55:25.243

您可能想查看[Charles Petzolds 关于具有渐变颜色的图形路径的文章](http://www.charlespetzold.com/blog/2009/02/Graphical-Paths-with-Gradient-Colors.html)，他在其中讨论了与您的问题类似的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-21T08:05:23.640

```
 <Grid x:Name="grid" VerticalAlignment="Top" HorizontalAlignment="Left" Width="100" Height="100" Margin="200,200,0,0">
         <Rectangle VerticalAlignment="Stretch" Width="20" HorizontalAlignment="Right" Margin="0,20,0,20" StrokeThickness="0" Panel.ZIndex="0">
            <Rectangle.Fill>
                <LinearGradientBrush EndPoint="1,0" StartPoint="0,0">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Bottom" Height="20" HorizontalAlignment="Stretch" Margin="20,0,20,0">
            <Rectangle.Fill>
                <LinearGradientBrush EndPoint="1,1" StartPoint="1,0">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Stretch" Width="20" HorizontalAlignment="Left" Margin="0,20,0,20" StrokeThickness="0" Panel.ZIndex="0">
            <Rectangle.Fill>
                <LinearGradientBrush EndPoint="0,0" StartPoint="1,0">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Top" Height="20" HorizontalAlignment="Stretch" Margin="20,0,20,0">
            <Rectangle.Fill>
                <LinearGradientBrush EndPoint="1,0" StartPoint="1,1">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Top" Height="20" Width="20" HorizontalAlignment="Left" Margin="0,0,0,0">
            <Rectangle.Fill>
                <RadialGradientBrush Center=".9,.9" GradientOrigin="1,1" RadiusX=".85" RadiusY=".85">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Bottom" Height="20" Width="20" HorizontalAlignment="Right" Margin="0,0,0,0">
            <Rectangle.Fill>
                <RadialGradientBrush Center=".1,.1" GradientOrigin="0,0" RadiusX=".85" RadiusY=".85">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Top" Height="20" Width="20" HorizontalAlignment="Right" Margin="0,0,0,0">
            <Rectangle.Fill>
                <RadialGradientBrush Center=".1,.9" GradientOrigin="0,1" RadiusX=".85" RadiusY=".85">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
        <Rectangle VerticalAlignment="Bottom" Height="20" Width="20" HorizontalAlignment="Left" Margin="0,0,0,0">
            <Rectangle.Fill>
                <RadialGradientBrush Center=".9,.1" GradientOrigin="1,0" RadiusX=".85" RadiusY=".85">
                    <GradientStop Color="#00FFFFFF" Offset="0"/>
                    <GradientStop Color="#FFFFFFFF" Offset="1"/>
                    <GradientStop Color="#22FFFFFF" Offset="0.5"/>
                    <GradientStop Color="#11FFFFFF" Offset="0.3"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>
    </Grid> 
```

# python - 你如何构造一个适合 numpy 排序的数组？

> ID：560283
> 
> 赞同：1
> 
> 时间：2009-02-18T08:45:47.060
> 
> 标签：python, algorithm, arrays, numpy

我需要同时对两个数组进行排序，或者更确切地说，我需要对其中一个数组进行排序，并在排序时将其关联数组的相应元素带入其中。也就是说，如果数组是 [(5, 33), (4, 44), (3, 55)] 并且我按第一个轴排序（标记在 dtype='alpha' 下面），那么我想要： [(3.0, 55.0 ) (4.0, 44.0) (5.0, 33.0)]。这些是非常大的数据集，我需要先排序（对于 nlog(n) 速度），然后再执行一些其他操作。我不知道如何以正确的方式合并我的两个单独的数组以使排序算法正常工作。我认为我的问题很简单。我尝试了三种不同的方法：

```
import numpy
x=numpy.asarray([5,4,3])
y=numpy.asarray([33,44,55])

dtype=[('alpha',float), ('beta',float)]

values=numpy.array([(x),(y)])
values=numpy.rollaxis(values,1)
#values = numpy.array(values, dtype=dtype)
#a=numpy.array(values,dtype=dtype)
#q=numpy.sort(a,order='alpha')
print "Try 1:\n", values

values=numpy.empty((len(x),2))
for n in range (len(x)):
        values[n][0]=y[n]
        values[n][1]=x[n]
print "Try 2:\n", values
#values = numpy.array(values, dtype=dtype)
#a=numpy.array(values,dtype=dtype)
#q=numpy.sort(a,order='alpha')

###
values = [(x[0], y[0]), (x[1],y[1]) , (x[2],y[2])]
print "Try 3:\n", values
values = numpy.array(values, dtype=dtype)
a=numpy.array(values,dtype=dtype)
q=numpy.sort(a,order='alpha')

print "Result:\n",q 
```

我注释掉了第一次和第二次尝试，因为它们会产生错误，我知道第三次会起作用，因为这反映了我在 RTFM 时看到的情况。给定数组 x 和 y （它们非常大，仅显示示例）如何构造可以由 numpy.sort 正确调用的数组（称为值）？

*** Zip 很好用，谢谢。额外的问题：我以后如何将排序后的数据再次解压缩到两个数组中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T10:19:56.290

I think what you want is the zip function. If you have

```
x = [1,2,3]
y = [4,5,6] 
```

then `zip(x,y) == [(1,4),(2,5),(3,6)]`

So your array could be constructed using

```
a = numpy.array(zip(x,y), dtype=dtype) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T20:11:46.803

for your bonus question -- zip actually unzips too:

```
In [1]: a = range(10)
In [2]: b = range(10, 20)
In [3]: c = zip(a, b)
In [4]: c
Out[4]: 
[(0, 10),
 (1, 11),
 (2, 12),
 (3, 13),
 (4, 14),
 (5, 15),
 (6, 16),
 (7, 17),
 (8, 18),
 (9, 19)]
In [5]: d, e = zip(*c)
In [6]: d, e
Out[6]: ((0, 1, 2, 3, 4, 5, 6, 7, 8, 9), (10, 11, 12, 13, 14, 15, 16, 17, 18, 19)) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-05T18:09:08.297

Simon suggested [argsort](http://docs.scipy.org/doc/numpy/reference/generated/numpy.argsort.html) as an alternative approach; I'd recommend it as the way to go. No messy merging, zipping, or unzipping: just access by index.

```
idx = numpy.argsort(x)
ans = [ (x[idx[i]],y[idx[i]]) for i in idx] 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-04-10T07:44:08.143

`zip()` *might* be inefficient for large arrays. [`numpy.dstack()`](http://www.scipy.org/Numpy_Example_List#dstack) could be used instead of `zip`:

```
ndx = numpy.argsort(x)
values = numpy.dstack((x[ndx], y[ndx])) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T10:18:49.333

我认为您只需要在制作最终 ndarray 时指定要排序的轴。或者，对原始数组之一进行 argsort，您将拥有一个索引数组，可用于在 x 和 y 中查找，这可能意味着您根本不需要值。

（现在 scipy.org 似乎无法访问，否则我会向您发布一些文档的链接）

Given that your description doesn't quite match your code snippet it's hard to say with certainty, but I think you have over-complicated the creation of your numpy array.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T10:27:04.447

I couldn't get a working solution using Numpy's `sort` function, but here's something else that works:

```
import numpy
x = [5,4,3]
y = [33,44,55]
r = numpy.asarray([(x[i],y[i]) for i in numpy.lexsort([x])]) 
```

`lexsort` returns the permutation of the array indices which puts the rows in sorted order. If you wanted your results sorted on multiple keys, e.g. by `x` and then by `y`, use `numpy.lexsort([x,y])` instead.

# sql - 数据表现

> ID：560290
> 
> 赞同：0
> 
> 时间：2009-02-18T08:48:42.110
> 
> 标签：sql, sql-server, sql-server-2005

我在一个表中有 60 列。

1）。我想在该表中再添加一列。会不会对性能有影响？

2）。我可以添加多少列？

3）。任何避免递归的想法。*[我不知道这里 - anakata]*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T08:50:54.397

是的，但是多一列比您已经有 60 列的问题要少。

我敢打赌它们中的大多数都是可以为空的？

对于非常宽的表（很多列），编写可维护的 SQL 变得更加困难。由于 NULLS，您不得不处理大量异常。

另请参阅此帖子，其中询问[多少字段太多](https://stackoverflow.com/questions/220613/how-many-fields-is-too-many-in-a-table)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:02:21.227

> > 会不会对性能有影响？

如果您要添加“Notes”类型的 TEXT 列，或存储用户图像的 Blob，并且您的大多数/许多查询是

```
SELECT * FROM MyTable 
```

那么你肯定会产生性能问题。

如果您总是明确地只命名您的查询需要的列，例如：

```
SELECT Col1, ColX, ColN 
FROM MyTable 
```

那么添加一个新列对性能几乎没有影响——但更宽的行意味着每个数据页的记录更少，所以会有一些影响，如果你在新列中添加一个索引，那么这个索引也必须维护——但如果您的应用程序需要它，那么这是必要的“成本”。

我们有很多超过 60 列的表格。但是，我想认为这是设计使然，而不是因为桌子刚刚变大。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-18T08:53:24.237

如果我是你，我将不太关心你必须再添加一列这一事实，而更关心决定 60 列是否合适。

# c# - 在 winforms 中嵌入用户可自定义的富文本或 html

> ID：560303
> 
> 赞同：2
> 
> 时间：2009-02-18T08:56:14.010
> 
> 标签：c#, winforms, .net-3.5, richtextbox

我正在编写 ac# winforms 应用程序，该应用程序需要使其用户能够向其界面添加内容。我查看了 RichTextBox 和 WebBrowser 控件，但我不确定该采取哪条路线。内容将包含带有换行符的文本和几个标签，其中包括项目资源中的图像。

```
This is my text [niceimage] and it
includes an image and another: [smiley] 
```

RichTextBox 控件的缺点是我需要手工制作我不熟悉的富文本。.net 框架也没有从图像生成元文件的功能，RTF 用于嵌入图像的格式。

我在使用 WebBrowser 时遇到的问题是我不知道如何通过流加载页面。我尝试了 DocumentStream 无济于事。我还需要在 html 字符串中包含需要嵌入图像的图像，这可能不受支持。另一个问题是 WebBrowser 控件可能太重，因为该控件将出现在应用程序的多个位置。它还需要非常快速地加载才能使应用程序感觉活泼。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T10:10:02.913

您可能想查看 WPF RichTextBox，它应该是对 .NET 2.0 版本的重大改进。这[是一篇](http://www.devx.com/dotnet/Article/34644/1954?pf=true)详细说明改进的文章。

此外，许多组件开发公司提供他们自己的商业版本，该版本具有许多功能和可用性改进。假设您愿意购买这样的组件，您可能想要评估其中的一些。尝试谷歌搜索“RichTextBox 组件”。

对于您需要的功能，我觉得使用 WebBrowser（尤其是在应用程序中的多个位置）将是矫枉过正。

# jquery - 如何在 JQuery $.each 函数中编辑全局变量？

> ID：560307
> 
> 赞同：2
> 
> 时间：2009-02-18T08:57:32.837
> 
> 标签：jquery, json, global-variables, scope

好的，所以这个标题可能不能很好地解释我的问题。希望这是有道理的。这也是我第一个使用 jQuery 的应用程序，如果我在做一些愚蠢的事情，请原谅我。

我有以下功能：

```
function getRandomImages(limit) {
    imagesArray = new Array();
    $.getJSON('createImageArray.php', {limit: limit}, function(data) {
        $.each(data, function(i) {
            imagesArray[i] = data[i];  //imagesArray is declared globally.
        });
    }); 
} 
```

getJSON 正确地抓取了 JSON 对象。它返回如下内容：

```
{"image0":"images/19.10.FBB9.jpg","image1":"images/8.16.94070.jpg","image2":"images/8.14.47683.jpg","image3":"images/8.15.99404.jpg","image4":"images/8.13.20680.jpg","image5":"images/21.12.9A.jpg","image6":"images/8.17.75303.jpg"} 
```

我正在调试并且确信 data[i] 正确包含从 JSON 对象中获取的图像路径。但是，在调用 getRandomImages() 之后，我查看了我的全局 imagesArray 并注意到没有任何更改。我猜它正在创建 imagesArray 的副本，而不是获取实际的副本。

有人能告诉我我需要做什么才能让我的全局 imagesArray 在 $.each 块中更新吗？我需要以某种方式通过引用传入 imagesArray 吗？对不起，我有点迷路了。

谢谢您的帮助。

**编辑**：一些背景信息。我正在从数据库中填充一组随机图像位置。我不想一次将数据库中的所有图像加载到数组中，因为太多了。所以，我有一个计数器来跟踪我在图像阵列中的位置。处理完一张图片后，我将指针移至下一张图片。如果我到达终点，我需要抓取更多随机图像。这就是调用上述 js 函数的地方；它调用 createImageArray.php 从数据库中获取 x 个随机图像并返回一个数组。然后我想将这些图像位置存储在我的全局 imagesArray 中。

我不确定如何重构我的代码以考虑 .getJSON 的异步特性。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T09:05:44.923

这里发生的`getJSON`是异步调用的。因此该函数立即返回，并在稍后的某个时间调用其中的代码。只有到那时才会更新 imagesArray。

您可以让 getJSON 同步运行，但我不建议这样做。相反，我建议重组代码以考虑 AJAX 请求的异步性质。

**编辑：**要发出同步请求，请使用`async`选项（[链接](http://docs.jquery.com/Ajax/jQuery.ajax)）。使用通用`$.ajax`函数或设置 AJAX 全局选项。我不推荐这样做的原因是它锁定了浏览器。如果您的服务器未能及时响应，用户将无法使用他/她的浏览器。

重构代码并不难。只需在回调函数中移动处理图像数组的逻辑即可。例如，而不是：

```
function getRandomImages(limit) {
    imagesArray = new Array();
    $.getJSON('createImageArray.php', {limit: limit}, function(data) {
        $.each(data, function(i) {
                imagesArray[i] = data[i];  //imagesArray is declared globally.
        });
    }); 
   processImages();
} 
```

做

```
function getRandomImages(limit) {
    imagesArray = new Array();
    $.getJSON('createImageArray.php', {limit: limit}, function(data) {
        $.each(data, function(i) {
                imagesArray[i] = data[i];  //imagesArray is declared globally.
        });
        processImages();
    }); 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T17:08:30.440

好吧，我第一次没有理解这个问题。这有点骇人听闻，但在不了解您的代码的情况下，我会在您创建 imagesArray 时创建一个 bool imagesLoaded。

```
function getRandomImages(limit) {
    imagesArray = new Array();
    imagesLoaded = false;
    $.getJSON('createImageArray.php', {limit: limit}, function(data) {
        $.each(data, function(i) {
                imagesArray[i] = data[i];  //imagesArray is declared globally.
        });
        imagesLoaded = true;
    }); 
} 
```

然后，在调用 getRandomImages() 之后，将代码放入带有 setTimeout() 的保持模式，直到 imagesLoaded = true。哦，也许在页面上放一些加载图形供用户查看，这样他们就不会认为你的应用程序被破坏了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T09:06:06.390

试试这个：

```
function getRandomImages(limit) {
    imagesArray = new Array();
    $.getJSON('createImageArray.php', {limit: limit}, function(data) {
        $.each(data, function(i, val) {
                imagesArray[i] = val;  //imagesArray is declared globally.
        });
    }); 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:56:12.423

首先：为什么要使用全局变量？这是个坏主意，不要这样做。您可以在给定命名空间内的函数之间共享变量，如下所示：

```
var NAMESPACE = {};
NAMESPACE.example = function() { 

    var myField = '1';

    return { 

        someMethod: function() { 
             return myField;
        }, 

        anotherMethod: function() { 
            return myField;
        } 
    };
}(); 
```

其次，拿到数组后怎么办？你想在页面上显示图像还是什么？您可以将 img-elements 放在页面上而不是将它们放入数组中吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-02-01T16:11:02.673

也许这项工作对我有用.. :)

```
$variable= new array();

$.getJSON("url", function(data){
asignVariable(data);
}

function asignVariable(data){
$variable = data;
}

console.log($variable); 
```

希望对你有帮助.. :)

# ms-access - 如何在 MS Access 中创建表单并使用它向表中插入记录？

> ID：560311
> 
> 赞同：0
> 
> 时间：2009-02-18T09:00:08.463
> 
> 标签：ms-access, ms-access-2007

如何在 MS Access 中创建表单，如何获取它以将记录添加到表中？

我在哪里可以找到一个很好的教程来学习这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T09:09:52.667

你可以在谷歌中搜索一下。第一个结果：

[http://www.functionx.com/access/form/introduction.htm](http://www.functionx.com/access/form/introduction.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T13:19:58.090

我发现任何 Access 问题的最佳资源（无意冒犯 Stack Overflow）是

[http://www.utteraccess.com/](http://www.utteraccess.com/)

在我提出的任何问题上，它从来没有让我失望过，它是一个非常活跃和友好的论坛。

# javascript - 如何以编程方式访问 webkit 引擎 (Chrome/Safari) 中的样式表

> ID：560314
> 
> 赞同：0
> 
> 时间：2009-02-18T09:04:04.817
> 
> 标签：javascript, safari, google-chrome, stylesheet

在 IE 中使用 document.getElementById("css_id").styleSheet

或在 Firefox document.getElementById("css_id").sheet

我有一个样式表对象要操作，但在 Chrome 和 Safari 浏览器中没有该属性。

我怎样才能得到那个对象？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T10:18:59.367

错误，在我的测试中 .sheet 工作正常——我的测试用例是

```
<html>
<head>
    <style id="styleElement"></style>
    <link id="linkElement" data="data:text/css," rel="stylesheet"></link>
    <script>
        window.onload=function() {
            alert(["<style element>.style: " + document.getElementById('styleElement').sheet,
                   "<link element>.style: " + document.getElementById('linkElement').sheet])
        }
    </script>
</head>
</html> 
```

我只在 Safari 3.2 和 WebKit nightlies 中进行了测试，Chrome 只使用了 Safari 3.1 中的 WebKit，但我不相信 3.1 和 3.2 之间有任何引擎变化。

# image - 如何检测主观图像质量

> ID：560316
> 
> 赞同：18
> 
> 时间：2009-02-18T09:05:10.773
> 
> 标签：image, algorithm, image-processing

对于图像上传工具，我想自动检测图像的（主观）质量，从而对质量进行评级。

我有以下想法来启发式地实现这一点：

*   显然将分辨率纳入评级。
*   将其压缩为 JPG (75%)，解压缩并比较 jpg 大小与解压缩后的大小以获得比率。图像越模糊，比例越高。

显然，如果对大图像进行评级，我的方法会占用大量周期和内存，尽管这在我的场景中会这样做（胖服务器，上传次数不多），而且我总是可以围绕更昂贵的步骤构建“短路”如果图像超过一定的分辨率。

还有什么我可以尝试的，或者有没有办法更有效地做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T09:16:13.510

评估图像（声音或视频也是如此）质量并不是一件容易的事，并且有许多出版物解决了这个问题。

很大程度上取决于图像的性质——不同的标准适用于人工创建的图像（即图表）或自然图像（即照片）。必须考虑一些微妙的影响——比如颜色掩蔽、亮度掩蔽、对比度感知。对于某些图像，给​​定的压缩比是完全足够的，而对于其他图像，则会导致质量显着下降。

这是一份免费访问出版物，简要介绍了[图像质量评估](http://citeseerx.ist.psu.edu/viewdoc/summary;jsessionid=9BDCF27A1C101763342FB0E13B1BDC61?doi=10.1.1.30.3150)的主题。

您提到的方法 - 压缩图像并将结果与​​原始结果进行比较远非完美。您计划使用的指标是什么？微博？每个区块的 MSE？当然，实现起来并不太难，但结果将难以解释（考虑具有高频分量和没有高频分量的图像）。

如果您想深入研究图像质量评估领域，机器学习社区也进行了大量研究。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T11:20:10.903

我想否定“明显合并分辨率”的想法。分辨率什么也没告诉你。我可以将图像缩放 2 倍，使像素数增加四倍。这不会增加任何**信息**，也不会提高质量。

我不确定“压缩为 JPG”的想法。JPG 是一种*面向照片的*算法。并非所有图像都是照片。此外，蓝天压缩得很好。均匀的灰色更好。您认为确切的云类型决定了图像质量吗？

出于类似的原因，锐度是一个坏主意。景深与图像质量并非无关紧要。故意在黑色背景下拍摄的物品会有很多强度很低的像素。同样，这并不表示曝光不足，因此直方图本身也不是一个好的质量指标。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T10:13:51.797

您可以尝试查看图像的 EXIF 标签（使用 exiftool 之类的工具），您得到的内容会有很大差异。例如，在我的 SLR 上，您甚至可以知道拍摄图像时哪些焦点处于活动状态。可能还有一些关于压缩质量的问题。

要检查的另一件事是图像直方图 - 注意图像偏向左侧，这表明曝光不足或大量饱和像素。

对于图像模糊，您可以查看傅里叶变换的高频分量，这可能是访问与 JPG 压缩相关的参数。

这是一个有点棘手的领域，因为您可能能够实施的大多数“规则”可能会因为艺术效果而被打破。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-06-30T17:39:33.583

但是如果这些照片是“商业的”呢？如果照片是日常物品并且故意非艺术性，那么现有技术的价值是否有效？

如果我雇用数百人为公园长椅拍照，我想快速知道哪些照片质量更好（焦点清晰、光线充足），哪些不是。我不想要小猫、人、日落等的照片。

或者如果图片应该是目录中的物品怎么办？没有模特，只有衣服。图像质量处理会有帮助吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-04-28T11:54:08.067

我也很想知道一张照片有多模糊。

那这个呢：

1.  测量压缩为JPEG时图像的字节大小
2.  将图像缩小到 1/4
3.  使用某种基本插值将其放大 4 倍
4.  使用 JPEG 压缩该版本
5.  比较两个压缩图像的大小。

如果尺寸没有下降很多（超过某个百分比阈值），那么缩小和放大不会丢失太多信息，因此原始图像与缩放后的图像相同。

# c# - 在打印机之间传输打印作业

> ID：560317
> 
> 赞同：2
> 
> 时间：2009-02-18T09:05:15.923
> 
> 标签：c#, printing

我们被分配使用 C# 开发一个可以在打印机之间传输打印作业的应用程序。我查看了 Windows API 和 System.Printing 命名空间，但找不到可以执行此操作的类或函数。有没有适合这个的免费图书馆？您将如何使用 .Net 或 Win32 API 做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T10:38:36.010

如果 Win32 API 中不存在任何内容，那么 .NET 中将不存在任何内容。

除非打印机驱动程序*相同*，否则您可能会遇到问题，因为打印机作业在进入队列之前要经过驱动程序的一些处理。

您是否考虑过与多个打印机关联的单个队列（这在打印机故障的情况下提供了更多容量和冗余）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T09:12:44.547

这不是负载平衡/将特定作业路由到最不忙的打印机的问题吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-08T03:05:02.377

我很确定如果它是相同的驱动程序，您可以将 SPL 文件复制到新的打印机端口。如果您在 EMF 中打印，您可能会遇到不同的驱动程序。

根据打印机的连接方式，端口名称可能有点棘手。WinObj 和[开发者命名规则](http://msdn.microsoft.com/en-us/library/aa365247(VS.85).aspx)将有助于追踪它。

# c# - C# 中的多线程：如何将函数名传递给另一个函数以启动新线程？

> ID：560321
> 
> 赞同：4
> 
> 时间：2009-02-18T09:05:47.187
> 
> 标签：c#, .net, multithreading, oop

我在我的 C# 代码中使用多线程，如下所示：

```
Thread startThread;

public void NewThread()
{
   ThreadStart starter = delegate { foo(); };
   startThread = new Thread(starter);
   startThread.Start();
}

private void foo()
{
   //do some work
} 
```

然后在我的应用程序中调用 NewThread() 来运行新线程。

但是现在我在每个类上都有很多线程，每个类都有一个 NewThread() ，我正在考虑将其移至静态 Util 类，并在每次我想要该函数上的新线程时将函数名传递给它。

**你知道这是最好的方法吗，如果是的话，我怎样才能将函数名作为参数传递给它？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T09:12:44.593

好吧，既然方法是私有的，那么调用者知道方法名称是否有意义？如果它是公开的，您可以将方法传递给：

```
public void NewThread(Action task)
{
   ThreadStart starter = delegate { task(); };
   startThread = new Thread(starter);
   startThread.Name = task.Method.Name;
   startSpoolerThread.Start();
}

public void foo()
{
   //do some work
}

NewThread(obj.foo); 
```

但是，对于私有方法，我怀疑枚举/开关是最好的选择......

```
NewThread(TasktType.Foo); 
```

或者，您可以通过反射获取方法...

```
public void NewThread(string name)
{
    MethodInfo method = GetType().GetMethod(name,
        BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic,
        null, Type.EmptyTypes, null);
    ThreadStart starter = delegate { method.Invoke(this, null); };
    // etc (note: no point using Delegate.CreateDelegate for a 1-call usage 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T09:25:27.293

除非您明确创建线程有特定原因，否则为什么不使用线程池？Threadpool.QueueUserWorkItem 方法将委托作为要执行的工作单元。委托是一种特定类型，但您可以像在示例中那样将自己的委托调用包装在其中。除非您需要精细控制或取消，否则通常最好使用线程池而不是自己启动线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T09:23:14.070

我鼓励您也考虑查看并行扩展任务 API 的 CTP；你没有提到为什么你需要一个线程，但他们已经自动化了大部分[这里是他们博客的链接](http://blogs.msdn.com/pfxteam)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T09:09:00.920

看看下面关于 Codeproject 的文章“ [Poor Man's Parallel.ForEach Iterator](http://www.codeproject.com/KB/dotnet/PoorMansParallelForEach.aspx) ”。我认为这正是您正在寻找的。非常容易使用。

如需更强大的功能，还请查看[Power Threading Library](http://www.wintellect.com/PowerThreading.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T09:33:36.150

或者，如果您正在执行 Win.Forms 或类似的基于 GUI 的应用程序，我建议使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker(VS.80).aspx)。它会为您处理大多数与线程相关的事件的编组，并且中止的复杂性也要小得多（如果这是您需要做的事情）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T10:08:37.767

委托已经提供了一种异步执行它们的方法。例如：

```
delegate void dowork();
private static void WorkDone(IAsyncResult result)
{
   ((dowork)result.AsyncState).EndInvoke(result);
    // this function is called when the delegate completes
}
public void Start()
{
    dowork dw = delegate {// code in this block has it's own thread };
    dw.BeginInvoke(WorkDone, null);
} 
```

因此，为了将函数指针传递给其他任何东西，您只需要创建一个具有正确签名的委托（在这种情况下，我使用了一个匿名方法，但您可以使用具有正确签名的任何函数）并调用它的 BeginInvoke 方法，传递一个完成后将被调用的函数。该函数必须在原始委托上调用 EndInvoke，该委托在 result 参数中传递给 WorkDone 函数。

# c++ - 还有什么方法可以实现“模板化函数指针”？

> ID：560322
> 
> 赞同：2
> 
> 时间：2009-02-18T09:05:47.637
> 
> 标签：c++, templates, function-pointers

是否可以建立一组模板化的函数指针，而无需手动操作？这是一个例子来说明我在说什么。

假设我有一个经常调用的函数“write”，我有两个实现（write0 和 write1），我希望能够在它们之间动态切换。这些写函数是在参数类型上模板化的。一种方法是只使用一个模板化的前端函数 write()，它在内部使用 if 语句。

事实证明这对我的需求来说足够快了，但现在我想知道我是否可以使用函数指针来做同样的事情（只是为了好玩）。这种方法的问题是设置函数指针很麻烦。有没有其他方法可以基本上实现 write() 的理想但没有条件（直接静态调度）？

（其他“规则”：我不能将 Msg 类更改为具有 write() 方法，也不能更改使用站点代码以将 Msgs 替换为 Msgs 的适配器。）

FWIW，我发现[这篇文章](http://www.devarticles.com/c/a/Cplusplus/Function-Pointers-part-1/3/)基本上和我在这里说的一样。

```
#include <iostream>
using namespace std;

template<typename T> void write0(T msg) { cout << "write0: " << msg.name() << endl; }
template<typename T> void write1(T msg) { cout << "write1: " << msg.name() << endl; }

// This isn't so bad, since it's just a conditional (which the processor will
// likely predict correctly most of the time).
bool use_write0;
template<typename T> void write(T msg) { if (use_write0) write0(msg); else write1(msg); }

struct MsgA { const char *name() { return "MsgA"; } };
struct MsgB { const char *name() { return "MsgB"; } };
struct MsgC { const char *name() { return "MsgC"; } };
struct MsgD { const char *name() { return "MsgD"; } };

// This doesn't work: templates may not be virtual.
#if 0
struct Writer { template<typename T> virtual void write(T msg) = 0; };
struct Writer0 { template<typename T> virtual void write(T msg) { cout << "write0: " << msg.name() << endl; } };
struct Writer1 { template<typename T> virtual void write(T msg) { cout << "write0: " << msg.name() << endl; } };
#endif

int main(int argc, char **argv) {
  use_write0 = argc == 1;

  // I can do this:
  write(MsgA());

  // Can I achieve the following without the verbosity (manual setup, named
  // template instantiations, etc.)?
  void (*pwriteA)(MsgA) = use_write0 ? (void(*)(MsgA)) write0<MsgA> : (void(*)(MsgA)) write1<MsgA>;
  void (*pwriteB)(MsgB) = use_write0 ? (void(*)(MsgB)) write0<MsgB> : (void(*)(MsgB)) write1<MsgB>;
  void (*pwriteC)(MsgC) = use_write0 ? (void(*)(MsgC)) write0<MsgC> : (void(*)(MsgC)) write1<MsgC>;
  void (*pwriteD)(MsgD) = use_write0 ? (void(*)(MsgD)) write0<MsgD> : (void(*)(MsgD)) write1<MsgD>;
  pwriteA(MsgA());
  pwriteB(MsgB());
  pwriteC(MsgC());
  pwriteD(MsgD());

  return 0;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T10:24:44.920

如果您想在程序运行时来回切换日志记录功能，我认为您必须手动设置每种类型的功能指针。

如果仅在启动时选择日志记录功能就足够了，则可以以完全通用的方式完成，甚至不知道稍后将调用哪些类型的函数：

```
// writer functions
template<typename T> void write0(T msg) { std::cout << 0; };
template<typename T> void write1(T msg) { std::cout << 1; };

// global flag
bool use_write0;

// function pointers for all types
template<typename T>
struct dispatch {
   typedef void (*write_t)(T);
   static write_t ptr;
};

// main write function
template<typename T>
inline void write(T msg) {
   (*dispatch<T>::ptr)(msg);
}

// the fun part
template<typename T>
void autoinit(T msg) {
   if (use_write0)
      dispatch<T>::ptr = &write0<T>;
   else
      dispatch<T>::ptr = &write1<T>;
   // call again for dispatch to correct function
   write(msg);
}

// initialization
template<typename T>
typename dispatch<T>::write_t dispatch<T>::ptr = &autoinit<T>;

// usage example
int main(int argc, char **argv) {
   use_write0 = (argc == 1);
   write("abc");
   return 0;
} 
```

对于每种类型`T`，第一次调用`write<T>()`决定应该使用哪个写入函数。随后的调用直接使用指向该函数的函数指针。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T10:48:53.473

您还可以使用 Don Clugston 的[FastDelegates](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)标头。不会产生任何运行时开销，并且是真正面向对象的委托。虽然使用它们的语法并不完美，但它比摆弄原始函数指针要简单一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T11:57:04.153

为什么不使用函数指针数组？

```
#include <iostream>
using namespace std;

template<typename T> void write0(T msg) { cout << "write0: " << msg.name() << endl; }
template<typename T> void write1(T msg) { cout << "write1: " << msg.name() << endl; }

template<typename T> struct WriteSelector
{
    static void(* const s_functions[])(T msg);
};
template<typename T> void(* const WriteSelector<T>::s_functions[])(T msg)=
{
    &write0<T>,
    &write1<T>
};

unsigned write_index=0;
template<typename T> void write(T msg)
{
    WriteSelector<T>::s_functions[write_index](msg);
}

struct MsgA { const char *name() { return "MsgA"; } };
struct MsgB { const char *name() { return "MsgB"; } };
struct MsgC { const char *name() { return "MsgC"; } };
struct MsgD { const char *name() { return "MsgD"; } };

void Test()
{
    write(MsgA());
    write(MsgB());
    write(MsgC());
    write(MsgD());
}

int main()
{
    Test();
    write_index=1;
    Test();
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T19:52:38.737

写入有两个变化轴：write0/write1 选择和 MsgA/B/C.... 选择。

从概念上讲，这意味着您需要一个`write`函数的 NxM 实现。当然，如果添加了 write 实现，或者添加了消息类型，这会导致 resp。要添加 M 或 N 个额外功能。

对于这两个轴，您可以选择是使用静态多态还是动态多态来实现它们。可以使用模板或使用函数覆盖来完成静态多态性。

可以通过在每个类中使用 M 个写入函数创建一个 N 元素类层次结构来完成。但它很快就会成为维护的噩梦。除非消息内容也是运行时多态的。但问题是关于消息的静态多态性。

由于过于复杂而排除了运行时多态性（并且你不能有一个虚拟的模板函数，这会减少覆盖的冗长），我们需要实现一个小的类型调度例程，将运行时信息转换为编译时信息.

更具体地说：`Tmain`使用 writer-to-use 模板化主要操作（在名为 的示例中），并使用来自 'real' 的正确模板参数调用它`main`。

这省略了“全局”选择变量的使用，但它是面向对象且简洁的。

```
 // twodimensionalpolymorph.cpp
    //

    #include <iostream>

    using namespace std;

    class Write0 {
        public: 
        template< typename tMsg > 
        void operator()( /*const*/ tMsg& msg ) { cout << "write0: " << msg.name() << endl; };
    };

    class Write1 {
        public: 
        template< typename tMsg > 
        void operator()( /*const*/ tMsg& msg ) { cout << "write1: "<< msg.name() << endl; };
    };

    struct MsgA { const char *name() { return "MsgA"; } };
    struct MsgB { const char *name() { return "MsgB"; } };
    struct MsgC { const char *name() { return "MsgC"; } };
    struct MsgD { const char *name() { return "MsgD"; } };

    // the Tmain does the real action
    //
    template< typename Writer >
    int Tmain( Writer& write, int argc, char** args ) {

        write( MsgA() );
        write( MsgB() );
        write( MsgB() );
        write( MsgD() );

        return 0;
    }

    // the main merely chooses the writer to use
    //
    int main( int argc, char** args ) {

        if( argc==1 )
            return Tmain( Write0(), argc, args);
        else
            return Tmain( Write1(), argc, args);

    } 
```

# database-design - 多数据库事务

> ID：560326
> 
> 赞同：6
> 
> 时间：2009-02-18T09:06:41.893
> 
> 标签：database-design, symfony1

在我的 PHP 应用程序（使用 symfony 框架和 Propel ORM 构建）中，当我向 MYSQL 数据库添加记录时，我需要使用外部供应商提供的 Web 服务 API 更新外部 MYSQL 数据库。

问题是维护数据库完整性的最佳实践是什么。举个例子，如果第一次更新成功，第二次更新失败，由于网络服务不可用，我必须能够

1.  回滚第一次更新的事务，或者
2.  缓存对 Web 服务的调用并继续调用 Web 服务，直到服务可用
3.  其他一些可以维护多个数据库完整性的技术。

具体来说，我正在寻找类似的语法

```
void RootMethod()
{
     using(TransactionScope scope = new TransactionScope())
     {
        try
         { 
          SomeMethod();
          scope.Complete();
          CallWebService();
         }
         catch
         {
             scope.abort();
          }
     }
} 
```

但不确定是否

1.  这是一个很好的技术
2.  或者这在 symfony 中是否可行，就像在 C# 中一样

你怎么看？

**编辑：有人问我为什么需要两部分更新。这是因为我正在创建一个连接到现有后端应用程序的前端应用程序。而且我不想更改后端应用程序。所以不可避免地会有一些重叠。所以需要同步数据**

**另一个编辑：两部分事务必须一起完成，做一个cron作业来同步表是不可取的**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T11:32:43.127

最大的问题是对 Web 服务的重复更新是否重要，以及是否可以检测到它们。如果您可以检测到重复（通常使用唯一的事务编号）或者如果重复无关紧要，那么您可以构建一个可靠的两阶段提交样式方法。

如果无法检测到 Web 服务的重复事务并且更新不是幂等的，那么您就不走运了。

这是基本算法：

```
begin transaction;
do local work;
save information for external call;
set an appropriate time for next attempt;
mark external call as not performed;
commit work;

begin transaction;
make external call;
if successful
   mark external call as performed (or delete the record)
else
   set the time for the next attempt
commit; 
```

然后，您需要一个常规任务、线程或任何类似这样的东西：

```
for each record where the time for the next attempt <= now
    begin work;
    if the remote service has not performed this transaction
        make the remote call;
        if successful
            mark as done;
        else if too many attempts
            mark the transaction as permanently failed;
            alert operator;
        else
            set the time for the next attempt;
        endif
    else
        mark as done;
    endif

    commit;
 endfor 
```

这种方法可靠地处理所有故障情况，并确保最终完成两项工作。

基本故障：

1.  第一次提交完成之前的失败：一切都回滚。

2.  第一次提交之后但 Web 服务完成之前的故障（这包括 Web 服务本身的暂时故障）：远程 Web 服务事务由恢复任务重放。

3.  Web 服务完成后但第二次提交完成之前的故障：恢复任务检测到重复的 Web 服务事务，本地记录出列。

4.  恢复任务中的失败：与第二个事务中的失败基本相同。

其他注意事项：

*   逐渐退避的方法对于失败很有用。如果您希望减慢重试速度的服务出现暂时性故障。

*   如果您对外部服务有订购要求，您可能需要一些额外的结构。

*   根据您实现恢复任务的方式，您可以只将 Web 服务调用留给该任务，而在主应用程序流中没有第二个事务。

对附加要求的回应：“两部分事务必须一起完成，做一个cron作业来同步表是不可取的”

我对这个要求的解读是：“这两个系统永远不应该失败”。

当其中一个或两个系统出现故障时，您需要一些东西来收拾残局并协调事情。您可以使用成熟的 TP 监视器来进行事务协调，或者您可以构建一个简单的监视器，例如我的示例中的监视器来处理您的特定情况。无论哪种方式，都有一些东西可以跟踪正在发生的事情，以便在发生故障后可以正确解决问题。

如果您确实要求事情总是一起发生（并且事务消息队列或两阶段提交方法对您不起作用），那么最好将两个系统的数据存储在同一个数据库中（又名“资源管理器” ) 并拥有一个资源管理器事务。

如果您确实找到了解决此问题的解决方案，该解决方案满足了两个独立系统在多个事务中保持一致的要求，并且在发生故障后不再需要后续协调，您应该将其写下来并发表在 The VLDB Journal、ACM TODS 或 IEEE TKDE .

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-22T03:24:17.647

这会很棘手。您需要 2 阶段提交才能获得可靠的解决方案，但这将是为了满足您的特定需求而实施的大量工作。

也许实际上并不需要一个很好的解决方案。您是否处于困难的性能限制之下？一般来说，交易时间应该很短......但也许你应该在网络服务调用周围保持交易开放？这将降低数据库的整体吞吐量（至少）......但这可能是完全可以接受的。

您展示的方法在处理硬系统故障（电源故障、硬件故障等）时会遇到问题。要解决这个问题，您需要向主数据库和后台进程/启动进程添加跟踪以处理故障。做起来很繁琐，但肯定有可能。

有些失败可能最终无法修复（第一部分成功，第二部分失败，第一部分无法撤消，因为另一个事务已更新相同的数据）。这完全取决于您的精确业务规则。会计系统将是最简单的，因为撤消交易实际上是作为抵消记录而不是更新完成的。

祝你好运。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-24T18:10:25.707

我不认为回滚真的会帮助这种情况。如果您的 Web 服务出现故障，则进行更多调用只会使问题更加复杂，然后您必须担心回滚是否通过等。

我会通过预定的完全同步来做到这一点。你的误差范围是多少？你愿意让数据库稍微不同步吗？多少？每天晚上运行一个同步器来解决任何突然出现的问题会很重要吗？您需要担心的 Web 服务多久关闭一次？

失败的 Web 服务调用的更新队列是一个不错的主意，但是如果您的 Web 服务出现故障，可能会同时出现很多这样的情况，而不仅仅是一两个，所以您不妨在一个反正停电。

你的答案真的取决于这些问题。如果 0.01% 不同步 10 分钟，请不要错误地假设您的整个程序会崩溃。找出可接受的错误余量是多少。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T11:01:01.317

保持数据库同步是一项艰巨的任务，具体取决于您拥有的数据，您是否可以添加另一个包含已更改内容的表，然后通过 cron 运行单独的脚本或尝试更新 Web 服务并使其同步的单独代码存储在数据库中的更改。如果更改成功，它将删除指定更改尚未发送到远程服务器的标志。

在插入数据后的本地数据库上，您可以使用一个标志来指定它不应该上线，然后同步的任何和所有数据都会导致该标志更改为完全提交。

这样做的具体原因是什么？为什么您需要在应用程序本身中保持两个数据库同步，您是否可以每小时同步一次？

这将需要对数据进行状态跟踪，以及它是否已成功提交到两端。

我个人的选择是 1 号。回滚本地事务，除非那绝对不可能使用 2 号。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-26T15:57:56.553

不要尝试自己*构建*两阶段事务管理逻辑。你会弄错的，相信我。如果它在您的 proggy 环境中可用，就像在 C# 中一样，请使用它。如果没有，那么不要自己构建它。

在大多数情况下，*设计*一个具有跨多个在线数据库的分布式事务的系统会更容易，但*如果*它包含一个队列以实现（1）面对网络不可用时的弹性，则更容易适应系统的操作方面，（ 2) 面对高负载时的一致延迟行为。

因此，将您的事务限制在本地资源中：

```
make a change to reliable store (I believe this would be called a "resource" in X/Open transaction parlance)
enqueue a record of that change in a disk-backed log 
```

然后，按计划（每小时，每天，无论如何）

```
while not done
    pop item from queue or log
    sync that change with the external, remote resource 
```

在高负载时，您的队列会填满，但网络负载和事务延迟将保持相对恒定。这有点像家庭取暖费的每月预算计划。在负载相对较低的时候，队列会耗尽。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T11:11:36.237

我不明白，您的应用程序是 PHP 还是 C#？如果它在 C# (WCF) 中并且 Web 服务是 WCF（或支持 WS-AtomicTransaction），那么这是可能的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-26T20:12:37.753

也许您可以尝试不将这种多次更新的逻辑放在您的应用程序中，而是使用一个外部进程，该进程知道何时更新以及如果更新失败该怎么办。例如，Oracle BPEL 就是这样一个流程。您可以将其配置为协调不同的服务，例如参见[http://alisonatoracle.blogspot.com/2006_01_01_archive.html](http://alisonatoracle.blogspot.com/2006_01_01_archive.html)

不过，这可能对您的应用程序来说太过分了，具体取决于它的大小......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T18:47:27.573

后端数据库必须与前端同时更新是否有特定原因？

如果没有，一种方法是将前端更新为您的记录数据库，并将更新的记录标记为需要同步。管家任务可以定期从前端提取所有标记为需要同步的记录，然后更新后端。当后端更新完毕后，清除前端的同步标志。

# java - 从Java中的串口读取文件

> ID：560328
> 
> 赞同：3
> 
> 时间：2009-02-18T09:08:34.933
> 
> 标签：java, serial-port

我是java技术的初学者，我必须从端口读取文件。首先，我将“FLASH”写入输出流，然后我会从目标设备获得“FLASH_OK”的响应，在获得 FLASH_OK 作为响应之后，我必须再次写入我想要的文件的名称，但问题是它没有写入输出流的文件名，下面是我的代码。请帮我。

```
package writeToPort;

import java.awt.Toolkit;
import java.io.*;
import java.util.*;

import javax.comm.*;
import javax.swing.JOptionPane;

import constants.Constants;

public class Flashwriter implements SerialPortEventListener {
Enumeration portList;
CommPortIdentifier portId;
String messageString = "\r\nFLASH\r\n";
SerialPort serialPort;
OutputStream outputStream;
InputStream inputStream;
Thread readThread;
String one, two;
String test = "ONLINE";
String[] dispArray = new String[1];
int i = 0;

byte[] readBufferArray;
int numBytes;
String response;
FileOutputStream out;
final int FLASH = 1, FILENAME = 2;
int number;

File winFile;

public static void main(String[] args) throws IOException {
    Flashwriter sm = new Flashwriter();
    sm.FlashWriteMethod();
}

public void FlashWriteMethod() throws IOException {

    portList = CommPortIdentifier.getPortIdentifiers();
    winFile = new File("D:\\testing\\out.FLS");

    while (portList.hasMoreElements()) {
        portId = (CommPortIdentifier) portList.nextElement();
        if (portId.getPortType() == CommPortIdentifier.PORT_SERIAL) {
            if (portId.getName().equals("COM2")) {
                try {
                    serialPort = (SerialPort) portId.open("SimpleWriteApp",
                            1000);
                } catch (PortInUseException e) {
                }

                try {
                    inputStream = serialPort.getInputStream();

                    System.out.println(" Input Stream... " + inputStream);
                } catch (IOException e) {
                    System.out.println("IO Exception");
                }
                try {
                    serialPort.addEventListener(this);

                } catch (TooManyListenersException e) {
                    System.out.println("Tooo many Listener exception");
                }
                serialPort.notifyOnDataAvailable(true);

                try {
                    outputStream = serialPort.getOutputStream();
                    inputStream = serialPort.getInputStream();
                } catch (IOException e) {
                }
                try {
                    serialPort.setSerialPortParams(9600,
                            SerialPort.DATABITS_8, SerialPort.STOPBITS_1,
                            SerialPort.PARITY_NONE);
                    serialPort
                            .setFlowControlMode(SerialPort.FLOWCONTROL_NONE);
                                            number = FLASH;
                    sendRequest(number);

                } catch (UnsupportedCommOperationException e) {
                }

            }
        }
    }
}

public void serialEvent(SerialPortEvent event) {
    SerialPort port = (SerialPort) event.getSource();

    switch (event.getEventType()) {
    case SerialPortEvent.DATA_AVAILABLE:
        try {
            if (inputStream.available() > 0) {
                numBytes = inputStream.available();
                readBufferArray = new byte[numBytes];
                int readBytes = inputStream.read(readBufferArray);

                one = new String(readBufferArray);
                System.out.println("readBytes " + one);
            }
            if (one.indexOf("FLASH_") > -1 & !(one.indexOf("FLASH_F") > -1)) {
                System.out.println("got message");
                response = "FLASH_OK";
                number = FILENAME;
                sendRequest(number);
            }

            out = new FileOutputStream(winFile, true);
            out.write(readBufferArray);
            out.close();
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        readBufferArray = null;
        // break;
    }

}

public void sendRequest(int num) {
    switch (num) {
    case FLASH:
        try {
            outputStream.write(messageString.getBytes());
            outputStream.flush();
        } catch (IOException e) {
            e.printStackTrace();
        }
        break;
    case FILENAME:
        try {
            outputStream.write("\r\n26-02-08.FLS\r\n".getBytes());
            outputStream.flush();
        } catch (IOException e) {
            e.printStackTrace();
        }
        break;

    }
}

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T11:43:38.537

您是否使用串行端口仿真器软件进行了测试？

当我为大学做这种应用程序时，我们的教授告诉我们构建应用程序并使用模拟器对其进行测试，因为它更便宜且不易出错。

在搜索谷歌时，您可以找到一些这样做的软件。我不记得我们当时使用的确切型号，但效果很好。

我的意思是这样的产品：[Eterlogic - Virtual Serial Ports Emulator](http://www.eterlogic.com/Products.VSPE.html)，但这只是一个例子（我还没有测试过这个软件，我只是用谷歌搜索了它）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T06:13:59.043

您错误地假设总是会收到完整的消息。相反，当触发串行事件时，可能只有部分消息可用。例如，您可能会收到一个事件并读取“FLAS”，随后的事件将给出“H_OK”。您需要将代码调整为以下内容：

```
// member variables
byte [] receiveBuffer = new byte[BUFFER_LENGTH];
int receiveIndex = 0;

// Receive code

receiveIndex +=
   inputStream.read(receiveBuffer, receiveIndex, BUFFER_LENGTH - receiveIndex); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T11:19:29.797

抱歉，我无法为您提供 Java 代码，但您确定数据“FLASH”实际上是在您的串行端口上发送的吗？当我遇到此类问题时，我通常使用示波器查看串口上的 TX 引脚，并检查我是否可以“看到”正在发送的数据（数据突发会很短暂，但您将能够看到它）。如果您可以看到它，请使用示波器查看串行端口的 RX 引脚，看看您是否可以看到实际发送的“FLASH_OK”响应。

十分之九的问题不是软件问题，而是硬件问题，通常是由于握手引脚连接不正确。

祝你好运。

# r - 如何在 R 的条形图中对 X 轴进行排序？

> ID：560329
> 
> 赞同：3
> 
> 时间：2009-02-18T09:08:38.397
> 
> 标签：r, statistics

我已经合并了如下所示的数据：

```
 (8.048,18.05] (-21.95,-11.95] (-31.95,-21.95]   (18.05,28.05] (-41.95,-31.95]
             81              76              18              18             12
    (-132,-122]     (-122,-112]     (-112,-102]     (-162,-152]  (-102,-91.95]
              6               6               6               5              5
(-91.95,-81.95]     (-192,-182]   (28.05,38.05]   (38.05,48.05]  (58.05,68.05]
              5               4               4               4              4
  (78.05,88.05]     (98.05,108]     (-562,-552]     (-512,-502]    (-482,-472]
              4               4               3               3              3
    (-452,-442]     (-412,-402]     (-282,-272]     (-152,-142]  (48.05,58.05]
              3               3               3               3              3
  (68.05,78.05]       (118,128]       (128,138]     (-582,-572]    (-552,-542]
              3               3               3               2              2
    (-532,-522]     (-422,-412]     (-392,-382]     (-362,-352]    (-262,-252]
              2               2               2               2              2
    (-252,-242]     (-142,-132] (-81.95,-71.95]       (148,158]  (-1402,-1392]
              2               2               2               2              1
  (-1372,-1362]   (-1342,-1332]     (-942,-932]     (-862,-852]    (-822,-812]
              1               1               1               1              1
    (-712,-702]     (-682,-672]     (-672,-662]     (-632,-622]    (-542,-532]
              1               1               1               1              1
    (-502,-492]     (-492,-482]     (-472,-462]     (-462,-452]    (-442,-432]
              1               1               1               1              1
    (-432,-422]     (-352,-342]     (-332,-322]     (-312,-302]    (-302,-292]
              1               1               1               1              1
    (-202,-192]     (-182,-172]     (-172,-162] (-51.95,-41.95]  (88.05,98.05]
              1               1               1               1              1
      (108,118]       (158,168]       (168,178]       (178,188]      (298,308]
              1               1               1               1              1
      (318,328]       (328,338]       (338,348]       (368,378]      (458,468]
              1               1               1               1              1 
```

如何绘制这些数据，以便将 bin 从左侧的最负值排序到右侧的最正值？目前我的图表看起来[像这样](http://docs.google.com/Doc?id=dcvdrfrh_5cm5qkchw)。请注意，它根本没有排序。特别是第二个栏 ( `value = 76`) 放置在第一个栏的右侧：

```
 (8.048,18.05] (-21.95,-11.95]
            81              76 
```

这是我用来绘图的命令：

```
barplot(x,ylab="Number of Unique Tags", xlab="Expected - Observed") 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-21T01:54:56.340

我真的很想帮助回答你的问题，但我得告诉你，我无法对你的数据做出正面或反面。我看到很多左括号，但没有右括号。数据看起来按每行底部的值降序排序。我不知道如何利用像“（8.048,18.05]”这样的值

我错过了一些明显的东西吗？你能举一个更简单的例子，说明你的数据结构不是一个因素吗？

我通常希望数据框或矩阵具有两列，一列用于 X，一列用于 Y。

看看这个排序示例是否有帮助（我在这里是在黑暗中拍摄）

```
tN <- table(Ni <- rpois(100, lambda=5))
r <- barplot(tN)

#stop here and examine the plot
#the next bit converts the matrix to a data frame,
#  sorts it, and plots it again

df<-data.frame(tN)
df2<-df[order(df$Freq),]
barplot(df2$Freq) 
```

# memcached - 可视化 Memcached RAM 消耗随时间的变化

> ID：560333
> 
> 赞同：1
> 
> 时间：2009-02-18T09:09:27.550
> 
> 标签：memcached

我想可视化 Memcached 守护程序的 RAM 使用情况——最好的实用程序是什么？

理想情况下，我想使用 Perl。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-09T14:32:09.443

Memcache 报告许多统计信息，例如内存使用、存储的对象、命中和未命中。使用标准 TCP 套接字连接到服务器（可能是 localhost:11211）并写入“stats\n”以获取统计信息列表。请参阅下面的示例。

查看[Cacti](http://www.cacti.net/)以实际绘制数据。我已经取得了巨大的成功。

```
> $ 远程登录本地主机 11211
正在尝试 ::1...
正在尝试 127.0.0.1...
连接到本地主机。
转义字符是 '^]'。
统计数据
统计 PID 75723
STAT 正常运行时间 4166691
统计时间 1236609062
统计版本 1.2.4
STAT 指针大小 32
STAT rusage_user 115.028511
STAT rusage_system 326.163351
STAT curr_items 83335
统计总项目 1822140
STAT 字节 239997834
STAT curr_connections 48
统计总连接数 7840
STAT 连接结构 83
统计 cmd_get 4273541
STAT cmd_set 1822140
STAT get_hits 2442609
STAT get_misses 1830932
统计驱逐 1696494
STAT bytes_read 5162992092
STAT bytes_written 7000049654
STAT limit_maxbytes 268435456
统计线程 1
结尾

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T09:16:36.037

看看失忆症（[http://github.com/benschwarz/amnesia/tree/master](http://github.com/benschwarz/amnesia/tree/master)），它可能有一些事情可以做你想做的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T09:12:48.433

如果您想构建自己的小工具，您应该查看[RRDtool](http://oss.oetiker.ch/rrdtool/)

# xml - 如何使用 VIM 复制 XML 文件中的整个条目？

> ID：560335
> 
> 赞同：5
> 
> 时间：2009-02-18T09:10:28.127
> 
> 标签：xml, vim

我在 XML 文件中有以下内容：

```
<TypeDef name="a">
  <ArrayType high="14" low="0">
    <UndefType type="node">
    </UndefType>
  </ArrayType>
</TypeDef> 
```

我想复制这个条目。通常我会转到第一行，使用 进入 Line-Visual 模式`V`，然后到最后一行，拉出并粘贴。

如何复制整个条目而不自己寻找条目的结尾？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T09:22:03.463

我今天学到的解决方案（感谢回答[这个问题的](https://stackoverflow.com/questions/405415/can-you-grab-or-delete-between-parentheses-in-vi-vim/405450#405450)[CMS](https://stackoverflow.com/users/5445/cms)）是使用 VIM 的[文本对象](http://vimdoc.sourceforge.net/htmldoc/motion.html#object-select)动作。

将光标放在要复制的条目中，并在命令模式下键入以下内容`yat`：

*   `y`根据以下动作猛拉。
*   `at`选择当前标签。

请注意，如果光标位于“ArrayType”标签内，那么这就是将被拉出的内容。
另请注意，这不会拉动整条线。仅从开始标签的左大括号到结束标签的右大括号。如果您不小心，这可能会导致对齐问题。

解决此问题的一种方法是粘贴 with`:put`而不是 just `p`，如下所示：`yat:put`.
请注意，这不会保留缩进，因为 XML 条目没有作为一整行被拉出。

另一种方法是`vatVy`：

*   `v`进入视觉模式。
*   `at`如上。
*   `V`切换到 Line Visual 模式并选择整行。
*   `y`抽出选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T22:53:06.400

除了 Nathan 的回答之外，您可能还想查看 matchit.vim ...如果您有较新的安装，您可能拥有它

[http://www.vim.org/scripts/script.php?script_id=39](http://www.vim.org/scripts/script.php?script_id=39)

matchit 扩展了 vim 的 % （查找匹配括号）以覆盖 xml/html 标签等。因此，对于您的解决方案，操作将从开始标签开始

```
V%y 
```

matchit 当然对于一般导航目的非常有用。

# delphi - 使用 Indy 测量网络流量

> ID：560338
> 
> 赞同：5
> 
> 时间：2009-02-18T09:11:43.113
> 
> 标签：delphi, networking, client-server, indy

我正在使用 TIdTCPCmdServer 来处理与客户端应用程序的所有通信。我希望我的服务器记录所有类型的东西，包括网络流量。有什么简单或聪明的方法可以查看 TCPCmdServer 实际接收和发送了多少字节？我只能想到像这样的代码

```
ASender.SendReply;
Inc (FTraffic, Sizeof (ASender.NormalReply.Code) +
               Sizeof (Char) * ASender.NormalReply.Text.Length)); 
```

这在我看来是非常难看的，因为这些流量更新会分布在我的代码中，而且也相当复杂。

有什么建议么？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T12:29:00.317

查看 Indy 的拦截类。您应该能够创建一个覆盖 Receive() 和 Send() 方法的自定义拦截类，并且除了调用基类的方法之外，还可以实现您的流量计算。已经有拦截类来做日志记录，你可以用同样的方式连接你的自定义类。

[TIdConnectionIntercept](http://www.indyproject.org/docsite/html/frames.html?frmname=topic&frmfile=TIdConnectionIntercept.html)的文档应该是一个很好的起点。这里还有一个非常简单的示例，[说明](http://www.atozed.com/indy/Demos/10/index.EN.aspx)如何在运行时创建和连接拦截。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T09:36:25.240

包装`TCPCmdServer`成记录流量的类。

您可以从 TCPCmdServer 派生您的类并覆盖发送和接收方法（如果它们是虚拟的）。

就像是：

```
type
  TTcpCmdServerWithLogging = class(TTcpCmdServer)
    ...
    procedure SendReply; override;

implementation
    procedure SendReply;
    begin
      inherited SendReply;
      Inc (FTraffic, Sizeof (NormalReply.Code) +
           Sizeof (Char) * NormalReply.Text.Length)); 
    end; 
```

如果它们不是虚拟的，则创建实例化 TCPCmdServer 的新类并公开所需的方法和属性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T13:31:05.223

非常感谢你们的回答。我选择按照 mghie 描述的方式来实现它——通过为我的连接实现一个自定义拦截器类。仅针对那些对解决方案感兴趣的人，我将在此处提供一些源代码：

```
type
  TCountTrafficInterceptor = class (TIdConnectionIntercept)
  public
    type TIntPointer = ^Longint;
  private
    FTraffic : TIntPointer;
  public
    constructor Create (TrafficVar : TIntPointer);
    procedure Send (var ABuffer : TIdBytes); override;
    procedure Receive (var ABuffer : TIdBytes); override;
  end;

constructor TCountTrafficInterceptor.Create (TrafficVar : TIntPointer);
begin
  FTraffic := TrafficVar;
end;

procedure TCountTrafficInterceptor.Send (var ABuffer : TIdBytes);
begin
  inherited Send (ABuffer);
  FTraffic^ := FTraffic^ + Length (ABuffer);
end;

procedure TCountTrafficInterceptor.Receive (var ABuffer : TIdBytes);
begin
  inherited Receive (ABuffer);
  FTraffic^ := FTraffic^ + Length (ABuffer);
end; 
```

在 TIdTCPCmdServer 的 OnConnect 方法中：

```
AContext.Connection.IOHandler.Intercept := 
  TCountTrafficInterceptor.Create (@FNetworkTraffic); 
```

效果很好，正是我正在寻找的那种解决方案。再次感谢您的回答。

顺便说一句：我如何在我的帖子中使用 (at) 符号？当我尝试输入它时，我总是得到一个块引用......

# css - CSS Sprite 在 IE 中不起作用[8/7/6]

> ID：560339
> 
> 赞同：2
> 
> 时间：2009-02-18T09:12:01.833
> 
> 标签：css, internet-explorer, css-sprites

我正在尝试使用 CSS 使用精灵来为我的风险矩阵设置动画......它在 Firefox 和 Chrome 中运行良好，但图像不会出现在 IE 中......

代码在下面，不想在这里粘贴整个东西，但摘录显示了模式：

```
<dl id="rmMap4x4">
<dd id="m4p4s1">
<a onclick="setDropDownListValues(4,1,3,4)" onmouseover="setDropDownListValues(4,1,-1,4)">
</a>
</dd>
<dd id="m4p3s1">
<a onclick="setDropDownListValues(3,1,2,4)" onmouseover="setDropDownListValues(3,1,-1,4)">
</a>
</dd>
...
</dl> 
```

CSS：

```
dl#rmMap4x4
{
background:  url(/images/RiskMatrix_4x4.png) no-repeat scroll left top;
height: 400px;
margin: 0pt;
padding: 0pt;
position: relative;
width: 400px;
}
/*column 1*/
dd#m4p4s1 a
{
top: 99px;
left: 99px;
}
dd#m4p4s1 a:hover
{
position: absolute;
background:  url(/images/RiskMatrix_4x4.png) -98px -500px no-repeat;
top: 100px;
left: 99px;
}
dd#m4p3s1 a
{
top: 149px;
left: 99px;
}
dd#m4p3s1 a:hover
{
position: absolute;
background:  url(/images/RiskMatrix_4x4.png) -98px -550px no-repeat;
top: 150px;
left: 99px;
} 
```

我用 IE Dev 检查了样式。工具栏（我想要 IE 的萤火虫），所有样式都到位，图像在服务器上，但它不会在 IE 中显示！

我很确定这是一些愚蠢的 IE CSS 怪癖，请帮忙。

**更新：** @RoBorg：你的建议没有解决问题，但它解决了“悬停”问题。问题出在绝对定位的外部 div 和一些菜单样式上，它们以某种方式把整个事情搞砸了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-18T09:29:54.600

IE 不适`:hover`用于`<a>`没有`href`. 这应该有效：

```
<a href="#" onclick="setDropDownListValues(3,1,2,4); return false;"
     onmouseover="setDropDownListValues(3,1,-1,4);"> 
```

# javascript - Web 制作：外部 JS 文件中的绝对 URL？

> ID：560343
> 
> 赞同：1
> 
> 时间：2009-02-18T09:13:20.647
> 
> 标签：javascript, workflow, maintenance, production

我想知道，您是否知道在外部 javascript 文件中指定绝对 URL 的任何最佳做法？我正在寻找一个可维护的解决方案。

基本场景是当我需要在运行时通过 javascript 包含 css 文件，或者对某些 URL 进行 ajax 调用，以及通常需要在（外部）javascript 文件中指定 URL 的其他情况。

如果您要更改服务器，或者可能引入 mod_rewrite，如何防止手动编辑 js 文件中的所有 url？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T09:29:05.430

那么您可以使用以下属性构建一个 URL 字符串：

```
var thisurl = document.location.href; 
```

这将为您提供当前页面的 URL 字符串，并希望您可以从那里解析它？

或者，如果您使用的是服务器端语言（例如 PHP），那么您可以使用它来获取 URL 字符串，这样会更快（[这](http://www.webcheatsheet.com/PHP/get_current_page_url.php)是从这里复制粘贴的；未经我测试）：

```
<?php
function curPageURL() {
 $pageURL = 'http';
 if ($_SERVER["HTTPS"] == "on") {$pageURL .= "s";}
 $pageURL .= "://";
 if ($_SERVER["SERVER_PORT"] != "80") {
  $pageURL .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"].$_SERVER["REQUEST_URI"];
 } else {
  $pageURL .= $_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];
 }
 return $pageURL;
}
?>
var thisurl = <?php echo curPageURL(); ?>; 
```

或者，您可以将属性存储在服务器上的文件中，该文件可由服务器端语言解析。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T09:48:51.590

您可以引入 javasript 类，该类保留所有 URL。像这样的东西

```
function urlContainer(){
    this.searchServer = 'http://search.example.com';
    this.submitServer = 'http://submit.example.com';
} 
```

然后在您的其他脚本文件中引用此类，并使用如下 URL：

```
alert (new urlContainer().searchServer); 
```

因此，您的所有外部 URL 都将包含在一个文件中。您可以获得更多创意并使用 baseUrls 和连接，但这取决于您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T09:51:52.677

另一种（可能更简单）的解决方案可能是将您想要的 URL 存储到隐藏字段值中，然后使用客户端 Javascript 访问它。请注意，您的 Hidden 字段需要是 HtmlInputHidden 或 HiddenField 控件。（基本上，它需要具有`runat="server"`属性，以便可以在服务器端设置它的值。）

# c++ - 如何反汇编 Pro*C/C++ 程序？

> ID：560344
> 
> 赞同：6
> 
> 时间：2009-02-18T09:13:21.613
> 
> 标签：c++, c, reverse-engineering, decompiling

有没有办法反汇编 Pro*C/C++ 可执行文件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T09:48:08.520

一般来说，应该有可用于可执行文件的反汇编程序，无论它们是如何创建的（gcc、proC、手写等），但反编译优化的二进制文件很可能会导致不可读或源代码不可读。

此外，Pro C/C++ 不是直接编译器，而是输出 C/C++ 代码，然后由平台本地编译器（gcc、xlc、vc++ 等）编译。

此外，如果没有大量手动更正，生成的代码通常不能直接再次编译。

如果您仍想试试运气，请先查看此[x86 反汇编](http://en.wikibooks.org/wiki/X86_Disassembly/Disassemblers_and_Decompilers)程序列表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T17:47:57.043

试试[PE Explorer Disassembler](http://www.heaventools.com/PE_Explorer_disassembler.htm)，一个非常不错的 32 位可执行文件反汇编程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T10:59:27.223

您应该尝试使用您选择的反汇编工具进行反汇编。归根结底，使用 PRO C/C++ 预处理器编译的可执行文件只是普通的 C/C++ 可执行文件。

如果您要查找的是代码中的 SQL 语句，您可能需要查看：

```
$ strings your_executable_file 
```

它将为您提供可执行文件中存在的所有常量字符串的列表，并且您很可能会得到 SQL 语句。

祝你好运。

# menu - 如何在 ECB 中仅对文档项目应用自定义操作

> ID：560347
> 
> 赞同：1
> 
> 时间：2009-02-18T09:14:07.337
> 
> 标签：menu, contextmenu, moss, menuitem, emacs-ecb

我在文档库的编辑控制块（ECB）中添加了一个菜单项（使用以下 msdn 文章[http://msdn.microsoft.com/en-us/library/ms473643.aspx](http://msdn.microsoft.com/en-us/library/ms473643.aspx)）

现在我发现 ECB 中的自定义操作（菜单项）同时针对文档项和文档文件夹显示。那么如何仅对文档项应用自定义操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T09:43:30.417

您将需要创建一个继承自 WebControl 的类。此类将需要按照您希望的方式呈现您的菜单项。

然后，您需要使用 CustomAction 定义中的 ControlAssembly 和 ControlClass 参数来指定此类。

您的班级将需要检测当前项目是否为文档或文件夹并相应地呈现/不呈现自身。

我会让控件首先显示一个链接，然后再添加逻辑。

这是[一篇关于该技术的好博文](http://tonybierman.blogspot.com/2008/07/quick-site-settings-adding-sub-menus-to.html)，它不是针对欧洲央行的，但原则是相同的。

享受！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:17:54.547

您是否使用列表作为您的 RegistrationType？

尝试使用 ContentType 作为您的 RegistrationType 并在您的 RegistrationID 中指定文档内容类型的 guid（我认为它是 0x0101）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-11T18:09:54.123

在您的 customAction 中使用 RegistrationType="FileType" 来确定 FILE 并使用 RegistrationId="doc" 来确定扩展名，我的示例使用 word 文档。;-)

# c# - 序列化时加载新程序集

> ID：560349
> 
> 赞同：1
> 
> 时间：2009-02-18T09:15:03.950
> 
> 标签：c#, memory-management, assemblies, xml-serialization

我在 BackgroundWorker 中有一个循环，可以在需要时通过 xml 序列化保存一些东西，但这似乎每次都加载一个新程序集

> “xxyyzz.Main.vshost.exe”（托管）：已加载“9skkbvdl”
> 
> “xxyyzz.Main.vshost.exe”（托管）：已加载“d2k4bdda”

等等。为什么会这样？我能做些什么吗？这是我应该关心的事情吗？该程序将长时间运行而无需重新启动...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T09:18:23.177

当您创建 XML 序列化程序时，程序集是动态生成的 - 我不会太担心它，但如果您是，您可以为您的类型保存对序列化程序的引用，并在连续调用中使用它

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T09:18:53.690

您是否将其他参数传递给您的 XmlSerializer？即使用非默认构造函数？是的，它会这样做（因为它每次都构建一个新的序列化程序集）......考虑在类型初始化程序中创建序列化程序并缓存它：

```
static readonly XmlSerializer foo;
static MyType() {
    foo = new XmlSerializer(typeof(TypeToSerialize), additionalArgs);
} 
```

然后重复使用缓存的`foo`序列化程序实例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T09:43:49.137

“ [***.vshost.exe**](http://msdn.microsoft.com/en-us/library/ms185331(VS.80).aspx) ”文件是 Visual Studio 调试器的一部分。

# windows - 大型应用程序/文件加载时间

> ID：560363
> 
> 赞同：2
> 
> 时间：2009-02-18T09:23:13.947
> 
> 标签：windows, performance, load-time

我相信很多人已经注意到，当您有一个大型应用程序（即需要几 MB DLL 的东西）时，它第二次加载的速度比第一次快得多。如果您在应用程序中读取大文件，也会发生同样的情况。第一次后阅读速度要快得多。

这有什么影响？我想这是硬盘缓存，或者是操作系统添加了自己的一些内存缓存。

您使用什么技术来加快大型应用程序和文件的加载时间？

提前致谢

**注意**：问题指的是 Windows

补充：什么影响操作系统的缓存大小？在某些应用程序中，文件在大约一分钟后再次缓慢加载，所以缓存会在一分钟内填满？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T09:33:27.633

有两件事会影响这一点。第一个是硬盘缓存（由影响很小的磁盘和往往影响更大的操作系统完成）。第二个是 Windows（和其他操作系统）在使用完 DLL 后几乎没有理由卸载它们，除非内存需要其他东西。这是因为 DLL 可以很容易地在进程之间共享。

所以 DLL 有一个习惯，即使在使用它们的应用程序消失之后，它们仍然存在。如果另一个应用程序决定需要该 DLL，则它已经在内存中，只需将其映射到进程地址空间即可。

我已经看到一些应用程序预加载了它们所需的 DLL（通常称为 QuickStart，我认为 MS Office 和 Adob​​e Reader 都这样做），以便感知加载时间更好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-20T22:29:33.947

Windows 的内存管理器实际上非常漂亮——它服务于内存请求并充当磁盘缓存。如果系统上有足够的空闲内存，最近访问过的大量文件将驻留在内存中。在需要物理内存之前，这些 DLL 将保留在缓存中——所有这些都是 CacheManager。

至于如何提供帮助，请查看延迟加载您的 DLL。LoadLibrary 的优点仅在您需要时才具有，但它是自动的，因此您的所有代码都没有 LoadLibrary/GetProcAddress。（自动，只要添加一个链接器命令开关）：

[http://msdn.microsoft.com/en-us/library/yx9zd12s.aspx](http://msdn.microsoft.com/en-us/library/yx9zd12s.aspx)

或者您可以像 Office 和其他人一样预加载（如上所述），但我个人讨厌这样 - 在初始启动时减慢计算机速度。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-20T11:33:32.447

我看到两种可能性：

*   在系统启动时预加载您的库，正如已经提到的 Office、OpenOffice 和其他人正在这样做。

我不是该解决方案的忠实拥护者：它会使您的启动时间更长并占用大量内存。

*   仅在需要时动态加载您的 DLL（请参阅 LoadLibrary）。不幸的是，所有 DLL 都不可能。

例如，当您不确定是否需要它时，为什么要在启动时加载 DLL 以导出 XYZ 格式的文件？当用户选择此导出格式时加载它。

我有一个梦想，Adobe Acrobat 使用这种方法，而不是让我每次想显示 PDF 文件时都使用我从未使用过的大量插件！

根据您的需要，您可能必须同时使用这两种技术：预加载一些使用过的大型库，然后仅按需加载特定插件...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T22:22:45.727

可能值得一看的一项是“变基”。每个 DLL 都有一个预设的“基”地址，它更喜欢将其加载到内存中。如果应用程序在不同的地址加载 DLL（因为首选地址不可用），则 DLL 将在新地址加载并“重新设置”。粗略地说，这意味着部分 dll 会即时更新。这仅适用于本机映像，而不是 .NET vm .dll 的。

这篇非常古老的 MSDN 文章涵盖了 rebase'ng：http: [//msdn.microsoft.com/en-us/library/ms810432.aspx](http://msdn.microsoft.com/en-us/library/ms810432.aspx)

不确定其中大部分是否仍然适用（这是一篇非常古老的文章）......但这里有一个诱人的报价：

> 首选一个大 DLL 而不是几个小 DLL；确保操作系统不需要很长时间搜索 DLL；如果操作系统有可能重新设置 DLL 的基础（或者，尝试选择您的基地址，以便不太可能重新设置基础），请避免许多修复。

顺便说一句，如果您正在处理 .NET，那么“ngen'ng”您的应用程序/dll 应该有助于加快速度（ngen = natve 图像生成）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T09:28:23.480

是的，从硬盘读取的任何内容都会被缓存，因此第二次加载速度会更快。基本假设是很少使用一次来自 HD 的大量数据然后丢弃它（这在实践中通常是一个很好的假设）。通常我认为是操作系统（内核）实现了缓存，占用了一大块 RAM，尽管我不确定现代硬盘驱动器是否有一些内置的缓存功能。（我曾经写过一个小内核作为一个学术项目；在内存中缓存高清数据是它的特点之一）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T10:02:41.387

影响程序启动时间的另一个因素是 Superfetch，这是（我相信）Windows XP 引入的一项技术。从本质上讲，它在程序启动期间监视磁盘访问，识别文件访问模式，并且它们尝试“捆绑”所需的数据以便更快地访问（例如，通过根据加载顺序在磁盘上顺序地重新排列数据）。

正如其他人所提到的，一般来说，任何读取操作都可能被 Windows 磁盘缓存缓存，并且除非其他操作需要内存，否则可以重用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T13:11:31.673

NGENing 程序集可能有助于启动时间，但是，运行时可能会受到影响（有时 NGened 代码不如 OnDemand Compiled 代码最佳）

NGENing 也可以在后台完成：http: [//blogs.msdn.com/davidnotario/archive/2005/04/27/412838.aspx](http://blogs.msdn.com/davidnotario/archive/2005/04/27/412838.aspx)

这是另一篇好文章 NGen 和性能[http://msdn.microsoft.com/en-us/magazine/cc163808.aspx](http://msdn.microsoft.com/en-us/magazine/cc163808.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-20T16:42:37.433

系统缓存用于任何脱离磁盘的内容。这包括文件元数据，因此如果您正在使用打开大量文件的应用程序（例如，目录扫描程序），那么如果您还运行着占用大量内存的应用程序，则可以轻松刷新缓存。

对于我使用的东西，我更喜欢使用少量的大文件（>64 MB 到 1 GB）和异步无缓冲 I/O。并且每隔一段时间进行一次良好的碎片整理。

# windows - 检测是否在 Windows XP 下以管理员权限运行

> ID：560366
> 
> 赞同：13
> 
> 时间：2009-02-18T09:25:12.507
> 
> 标签：windows, ruby, command-line, privileges

我正在尝试找出如何检测用户是否在 Windows XP 下以管理员权限运行。**借助 whoami**命令，这在 Vista/Win7 中相当容易做到。这是 Ruby 中的一个片段，说明如何在 Vista 下执行此操作：

*请注意，以下链接现在包含 muteW 建议的解决方案*

[http://gist.github.com/65931](http://gist.github.com/65931)

问题是，whoami 没有随 Windows XP 一起提供，所以上面链接的方法在 WinXP 上总是会返回 false，即使我们以管理员身份运行。

那么，有没有人知道一种方法来检测我们是否在 Windows XP 下使用 Ruby、命令行工具、批处理文件或什至第三方（真的需要开源）工具作为管理员运行？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2011-07-14T10:21:30.857

这将检测用户是否在提升模式下运行（例如，“运行为”管理员的命令提示符）。它依赖于您需要管理员权限才能读取 LOCAL SERVICE 帐户注册密钥这一事实：

```
reg query "HKU\S-1-5-19" 
```

如果无法读取，这将返回非零错误代码，如果可以读取，则返回零。
从 XP 开始工作...

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-18T09:46:24.560

如果你跑

```
>net localgroup administrators 
```

在命令外壳中，您应该获得 Windows XP 中的管理员帐户列表。只需解析和扫描输出以检查您想要的特定用户帐户。例如，要检查当前用户是否是管理员，您可以这样做 -

```
>net localgroup administrators | find "%USERNAME%" 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T13:13:22.690

Piskvor 选项很好，或查看此网址 [http://weseetips.com/2008/04/16/how-to-check-whether-current-user-have-administrator-privilege/](http://weseetips.com/2008/04/16/how-to-check-whether-current-user-have-administrator-privilege/)

这是该页面中的代码

```
SID_IDENTIFIER_AUTHORITY NtAuthority = SECURITY_NT_AUTHORITY;
PSID AdministratorsGroup;
// Initialize SID.
if( !AllocateAndInitializeSid( &NtAuthority,
                               2,
                               SECURITY_BUILTIN_DOMAIN_RID,
                               DOMAIN_ALIAS_RID_ADMINS,
                               0, 0, 0, 0, 0, 0,
                               &AdministratorsGroup))
{
    // Initializing SID Failed.
    return false;
}
// Check whether the token is present in admin group.
BOOL IsInAdminGroup = FALSE;
if( !CheckTokenMembership( NULL,
                           AdministratorsGroup,
                           &IsInAdminGroup ))
{
    // Error occurred.
    IsInAdminGroup = FALSE;
}
// Free SID and return.
FreeSid(AdministratorsGroup);
return IsInAdminGroup; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T09:32:58.400

查看[CheckTokenMembership](http://msdn.microsoft.com/en-us/library/aa376389(VS.85).aspx)方法。那里有一个 IsUserAdmin() 实现的示例以及一些其他有用的社区反馈，关于该函数何时不返回预期的内容以及如何改进它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-02-05T19:43:27.817

这将在没有炮击的情况下发现：

```
require 'win32/registry'

is_admin = false
begin
  Win32::Registry::HKEY_USERS.open('S-1-5-19') {|reg| }
  is_admin = true
rescue
end 
```

该策略类似于 Peter 的策略，但开销较小。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-10-11T19:44:48.760

这是更好的（PowerShell）方法：[https ://stackoverflow.com/a/16617861/863980](https://stackoverflow.com/a/16617861/863980)

在一行中，您可以说（复制/粘贴到豪华中，它会起作用）：

```
(@(([ADSI]"WinNT://./Administrators,group").psbase.Invoke("Members")) | `
foreach {$_.GetType().InvokeMember("Name", 'GetProperty', $null, $_, $null)}) -contains "Administrator" 
```

=>`True`当用户属于管理员组时返回（而不是检查用户 IS 管理员）

（注意：反引号或重音 ` 在 PowerShell 中转义回车，在 Ruby 中它执行 shell 命令，如 C++ 的 system('command')..）

所以在 Ruby 中，你可以说（在 irb 中复制/粘贴）：

```
def is_current_user_local_admin?
  return `powershell "(@(([ADSI]'WinNT://./Administrators,group').psbase.Invoke('Members')) | foreach {$_.GetType().InvokeMember('Name', 'GetProperty', $null, $_, $null)}) -contains 'Administrator'"`.include? "True"
end 
```

虽然不知道（甚至更好）WMI 的方式。有了这个，你可以做类似的事情（再次在 Ruby 中）：

```
require 'win32ole'
wmi = WIN32OLE.connect('WinNT://./Administrators,group')
# don't know what should come here... 
```

# wcf-proxy - 处理 WCF 代理空返回问题

> ID：560370
> 
> 赞同：3
> 
> 时间：2009-02-18T09:27:19.600
> 
> 标签：wcf-proxy

我有一个连接到第三方 Web 服务的 WCF 客户端代理。除了功能之外，代理几乎可以正常工作。

此功能与 ASMX 代理一起工作得很好。

我添加了服务跟踪日志记录，可以看到服务返回的响应。只有代理返回 null。

所以现在我确定代理有问题。

从这里到哪里？

**解决方案** 我发现了问题。WCF 没有 ASMX 代理那么宽容。服务 WSDL 指定返回的对象称为“数据”，而实际传回的 xml 称为“结果”

所以那是一场伟大的追逐！我想我在这个问题上浪费了 4 个小时！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T09:33:58.473

您可以尝试使用 Trace Viewer 更详细地分析 WCF 通信，并在遇到错误时找出更多详细信息。

在 app.config（客户端）和 web.config（服务器）中，您可以添加块。要启用跟踪，只需添加诊断块，应用程序运行时将在指定位置生成跟踪文件。这应该使您能够更深入地挖掘问题。

可以找到跟踪查看器：

("C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\SvcTraceViewer.exe")

有关跟踪查看器使用情况的信息：

[http://msdn.microsoft.com/en-us/library/aa751795.aspx](http://msdn.microsoft.com/en-us/library/aa751795.aspx)

另外，它是什么类型的方法？它返回复杂类型还是简单类型？

补充：啊，很抱歉误读，没有意识到你无法控制服务器端。我会尝试更新服务参考/代理（您可能已经这样做了）并检查是否有任何更改。

恐怕 WCF 不会让追踪​​问题变得非常容易。是否可以为有效的调用和无效的调用提供方法签名，以便我们可以看到正在传递的数据类型？

# ruby - 根据正在运行的目标改变以 rake 规则运行的命令/路径图

> ID：560376
> 
> 赞同：1
> 
> 时间：2009-02-18T09:30:42.773
> 
> 标签：ruby, rake

我正在尝试编写一个 Rakefile，它既能在我运行时正常构建我的代码，`rake compile`但将目标放在不同的目录中，并`-DTEST`在我运行时构建`rake test`。不过，我终其一生都无法弄清楚该怎么做。我现在有这样的事情：

```
SRC = FileList['src/*.erl']
OBJ = SRC.pathmap("%{src,ebin}/X.beam")

rule ".beam" => ["%{ebin,src}X.erl"] do |t|
  sh "erlc ... -o ebin #{t.source}"
end

task :compile => OBJ 
```

我想要的是一个`task :test`将编译器输出放入（基本上将上述代码中的`ebin_test`所有实例更改为）并在调用中添加一个 -DTEST 。有人有什么想法吗？`ebin``ebin_test``sh`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T22:15:17.380

嗯，这不是一个积极的第一个问题......没有答案。

作为记录，我通过构建和测试任务来解决问题，该任务定义了不同的编译规则，然后让公共任务在执行实际构建/测试运行之前调用该任务。几个范围界定问题，但没有什么令人兴奋的。我不会费心粘贴完整的 rakefile，但如果您有兴趣看一下，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-28T13:22:38.290

您可以根据需要发布还是测试构建来设置输出目录，但不能在 FileList 路径映射语法中替换该变量。

因此，使用##map 将源映射到对象，并使用 proc 将源转换回对象。

为了选择不同的构建，我通常将一个变量传递给 rake 命令，例如“rake CONFIG=Test build”

这是一个最小的 rakefile，它根据 CONFIG var 输出到单个树：

```
## Config
CONFIG = ENV["CONFIG"] || "Release"
SRC_DIR = "src"
OBJ_DIR = File.join("obj",CONFIG)

## Tools
CC = "gcc"

## Inputs
C_SRCS = FileList["#{SRC_DIR}/**/*.c"]

## Outputs
# Map sources to objects
C_OBJS = C_SRCS.map { |f|
      f.sub(/^#{SRC_DIR}/, OBJ_DIR).ext('.o')
}

## Tasks
task :default => C_OBJS

# Generate a set of directory rules for the object files
C_OBJS.each do |f|
  directory f.pathmap('%d')
end

## Rules

# Generate objects from sources
rule '.o' => [
    proc { |tn| tn.sub(/#{OBJ_DIR}/, SRC_DIR).ext('.c') },
     '%d'
 ] do |t|
 sh %Q{#{CC} -c "#{t.source}" -o "#{t.name}"}
end 
```

还要注意输出目录的创建。

我的网站上有更多[注释和示例。](http://markferry.net/Tech.RakeForMakeUsers)

# c# - 实体框架多对多问题

> ID：560377
> 
> 赞同：0
> 
> 时间：2009-02-18T09:31:59.370
> 
> 标签：c#, entity-framework

我有一个使用包含附加信息的链接表的多对多关系。3 实体 ,LHS, RHS, LHSRHS LHS 1 - * 带有 LHSRHS RHS 1 - * 带有 LHSRHS

我使用设计器根据表格生成 EDMX

我有 2 个问题 1）如果创建所有 3 个实体（新实体）将它们链接起来并尝试持久化，我会遇到 FK 违规，因为它在插入 RHS 表之前尝试插入 LHSRHS 表

2）如果我从数据库加载一个 LHS 对象，然后尝试创建一个 RHS 对象并将其链接到 LHS 对象我得到一个 FK 冲突。如果我从数据库加载一个 RHS 对象，然后尝试创建一个 LHS 对象并将其链接到 RHS 对象，我可以完美地工作。

代码：

```
 //WORKS
        eftestEntities es = new eftestEntities();
        RHS existing = es.RHS.First();

        LHS newObject = new LHS();
        newObject.ID = "LHs1";
        newObject.Name = "LHs1";
        LHSRHS link = new LHSRHS();

        link.Something = "some";

        link.LHS = newObject;

        existing.LHSRHS.Add(link);

        es.SaveChanges();

        ...........

        //DOES NOT WORK
        eftestEntities es = new eftestEntities();
        LHS existing = es.LHS.First();

        RHS newObject = new RHS();
        newObject.ID = "RHSNEW1";
        newObject.Name = "RHSNEW";
        LHSRHS link = new LHSRHS();

        link.Something = "some";

        link.RHS = newObject;

        existing.LHSRHS.Add(link);

        es.SaveChanges(); 
```

有人有想法么 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T09:43:13.490

它在保存 rhs 之前尝试插入链接的事实表明，其中一个关系没有被标记为外键：它不应该这样做（如果配置正确）。

您的链接表是否有自己的额外数据？如果没有，您实际上可以从模型中完全删除该表 - 只需关联两个*有趣*的表（多对多），并选择链接表作为关联的存储机制**（**您需要单击链接在设计器中的两个表之间）。

或者，如果您的链接表有一个复合键：“lhsid，rhsid”，那么我相信该工具会自动为您完成所有这些工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T12:43:48.470

如果链接表不只是一个复合键（即，如果表有超过 2 列），EF 将不会做聪明的事情并正确设置导航属性。当您仅将 2 列设置为复合键时，链接表将从实体中“消失”，并且您将获得一个导航属性，该属性将另一个实体公开为相关实体的集合。我听说 EF v2 将支持附加元数据与复合键一起标记的场景 :(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:57:31.840

我在网上找到了一个有效的例子，与 Beyond Compare 逐行重命名我的所有变量以匹配我的变量我发现的唯一差异，按部分排序，我调整无济于事，以及他们在哪里使用的事实我使用 varchars 的 int PK 更改我在 int 中的键使其工作。考虑到我的数据库已经 15 岁并且几乎每个表中都有 varchar PK，这个 ofcouse 并没有真正的帮助:(

# wix - 最好的 MSI 生成安装工具是什么？

> ID：560386
> 
> 赞同：6
> 
> 时间：2009-02-18T09:34:54.853
> 
> 标签：wix, installation

我目前正在使用 WIX，但不断遇到限制（例如将属性扩展为另一个属性的值的能力）。也不确定我是否遇到了 FileSearch 元素的错误，因为它没有按预期工作（找不到肯定存在的文件）。我可以使用内置在 dll 中的自定义操作，但只是想知道是否有更好的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T09:42:06.693

我认为目前最好的工具（成熟度、功能、文档、易用性）是[AdvancedInstaller](http://www.advancedinstaller.com/)。我通常不推荐商业工具，但这一款确实物有所值。

他们还有满足基本需求的免费软件版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T09:50:50.913

到目前为止，我已经使用[Installshield](http://www.acresso.com/products/is/installshield-overview.htm)将近十年了。

# php - php计数错误

> ID：560392
> 
> 赞同：0
> 
> 时间：2009-02-18T09:36:39.000
> 
> 标签：php, ajax, count

如您所见，我创建了下拉列表并将其命名为字段名称，并且我还具有计数功能。

我想要做的是，如果某些选择下拉菜单..显示在 10、20、.. 等数字中找到了多少结果。如果选择了第二个下拉菜单，它将检查选择的两个下拉菜单并传递结果计数..像那种连续的..如果你想看看我到底想要什么是去这里选择汽车计数将更新..

[http://en.comparis.ch/Carfinder/marktplatz/Search.aspx](http://en.comparis.ch/Carfinder/marktplatz/Search.aspx)

我有 ajax 并且运行良好，但我无法获得准确的 PHP 代码来计算实时时间。

AJAX 代码..

```
var xmlHttp

function showCount(str)
{ 
xmlHttp=GetXmlHttpObject();
if (xmlHttp==null)
  {
  alert ("Your browser does not support AJAX!");
  return;
  } 
var url="phpApplication.php";
url=url+"?action=count2";
url=url+"&sid="+Math.random();
xmlHttp.onreadystatechange=stateChanged;
xmlHttp.open("POST",url,true);
xmlHttp.send(null);
}

function stateChanged() 
{ 
if (xmlHttp.readyState==4)
{ 
document.getElementById("countR").innerHTML=xmlHttp.responseText;
}
}

function GetXmlHttpObject()
{
var xmlHttp=null;
try
  {
  // Firefox, Opera 8.0+, Safari
  xmlHttp=new XMLHttpRequest();
  }
catch (e)
  {
  // Internet Explorer
  try
    {
    xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
    }
  catch (e)
    {
    xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
  }
return xmlHttp;
} 
```

PHP 代码

```
function dropdown($field, $table)
{ 
  //initialize variables
  $oHTML  = '';
  $result = '';

  //check to see if the field is passed correctly
  if (($field == "")||($table == ""))
  {
    die("No column or table specified to create drop down from!");
  }

  $sql = "select distinct($field) from $table";

  //call the db function and run the query
  $result = $this->conn($sql);

  //if no results are found to create a drop down return a textbox
  if ((!$result) ||(mysql_num_rows($result)==0))
  {
    $oHTML .= "<input type='text' name='$field' value='' size='15'>";
  }elseif (($result)&&(mysql_num_rows($result)>0)){

    //build the select box out of the results
    $oHTML .= "<select name='$field' onchange='showCount(this.value)'>\n<option value='all'>All</option>\n";
    while ($rows = mysql_fetch_array($result))
    {
      $oHTML .= "<option value='".$rows[$field]."' name='".$rows[$field]."'>".$rows[$field]."</option>\n";

    }
    $oHTML .= "</select>\n";

  }
  //send the value back to the calling code
  return $oHTML;
}//end function

function count1(){

      $sql2 = "SELECT SQL_CALC_FOUND_ROWS * from produkt_finder_table where Bauform_d ='".($_POST['Bauform_d'])."' ";
      $query = $this->conn($sql2);
      $result = mysql_query( $query );
      $count  = mysql_result( mysql_query( 'SELECT FOUND_ROWS()' ), 0, 0 );
      echo $count;
      //$sql2 = "SELECT COUNT(Bauform_d) from produkt_finder_table where Bauform_d = 'mobil' "; 

     //echo var_dump($result1);
     while($row = mysql_fetch_array($query))
     {
    // echo  $row['COUNT(Bauform_d)'];
     }
      //echo mysql_num_rows($query);
    //  if (isset($_POST['Bauform_d']))
//{
    /* if (mysql_num_rows($result)==0) {
         echo '0';
         } else {
     echo mysql_num_rows($result);
     $row = mysql_fetch_array($result);

     echo $result;
     echo $row['COUNT(Bauform_d)'];
    //   }
}*/
}

$action = $_GET['action'];

$proFin = new Application();

switch($action) {

        case 'show':
            $proFin->show_form();
        break;

        case 'search':
            $proFin->search();
        break; 

        case 'searchAll':
            $proFin->searchAll();
        break; 

        case 'count2':

            $proFin->count1();

        break; 

        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T23:12:25.520

你调试了哪些部分？

将 count1() 函数更改为使用 time() 回显时间或其他内容。

然后，如果它返回正确的值，您就知道您的 JS 正在工作并且您的 PHP 脚本正在调用正确的函数。

我假设 PHP 代码不起作用，因为 SQL 查询正在寻找 $_POST['Bauform_d'] 您调用 xmlHTTP 请求时未设置。运行一个简单的 print_r($_POST); 以确保您在查询中传递了您期望的所有数据。如果不是，则更改您的 JS 代码以传递该值 - 当您确定您的 php 脚本正在传递所有正确的变量时，然后开始添加回您的 SQL 查询等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T16:53:11.177

调试调试

雅各布的回答是关键。

# windows-installer - 如何替换 Windows Installer 上的嵌套安装？

> ID：560396
> 
> 赞同：1
> 
> 时间：2009-02-18T09:37:26.313
> 
> 标签：windows-installer

在此[MSDN 页面](http://msdn.microsoft.com/en-us/library/aa368010(VS.85).aspx)上声明不推荐使用 Windows Installer 上的嵌套安装（也称为并发安装）。我目前正在安装一个自定义操作类型为 23 的第三方 msi。

在不使用嵌套安装的情况下，我可以通过哪些机制安装第三方 msi？我尝试使用类型为 34 的自定义操作调用“ `msiexec.exe /i {.msi-file}`”，但由于不允许同时进行多个安装而失败。

不幸的是，没有可用于安装 msi 的合并模块。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T18:22:39.787

对您（以及在这种情况下的其他所有人）来说不幸的是，您将不得不创建一个引导应用程序来检查先决条件并在必要时启动其安装程序，然后启动您的安装程序。

如果您的先决条件需求仅依赖于某些功能，而不是整个包，那将是双重不幸的，因为这意味着您还必须在引导应用程序中实现用户界面。（我们就是这种情况，但幸运的是，无论如何我们都是从头开始的，所以我们不必重新创建我们已经在 MSI 中实现的用户界面。我们实际上尝试了一种混合方法，其中前几个屏幕UI 的一部分在 bootstrap 应用程序中，其余的在 MSI 中，但其中涉及的挫折太多，所以我们很快就放弃了这个想法。）使用 bootstrap 应用程序中的 UI，用户可以选择功能他们想要安装，然后引导应用程序将在必要时，显示一个页面，说明正在安装先决条件并在此时安装它们，然后再转到下一页。启动安装程序时，引导应用程序会将通过命令行参数从 UI 收集的所有信息提供给它。您甚至可能希望将启动条件放入您的 MSI，以防止它直接运行，除非在卸载或修复情况下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T09:49:24.070

如果您使用自定义操作（Installshield 有这些）来执行您的安装，会发生什么？和/或代替 .msi 创建 .exe 文件？

# user-interface - 向导控件示例

> ID：560399
> 
> 赞同：2
> 
> 时间：2009-02-18T09:40:59.863
> 
> 标签：user-interface, controls, components, wizard

我正在创建一个向导控件（在 Flex 中），并希望查看一些使用 .NET、Java 或其他语言的优秀向导控件的示例。

我对下一个/上一个步骤由当前步骤的输入确定的情况特别感兴趣。例如，在开始屏幕中选择多个选项之一将引导您进入不同的屏幕等

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T09:51:09.493

对于 UI 示例，有很多这样的示例。

[日食](http://wiki.eclipse.org/User_Interface_Guidelines#Wizards)：

![日食向导](https://wiki.eclipse.org/images/d/d3/WizardAppearance.gif)

[Apple](http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/XHIGInstallationsUpdates/chapter_10_section_4.html)（这些在 Apple 用语中称为助手）：

[苹果助手 http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/art/iu_setupassistant.jpg](http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/art/iu_setupassistant.jpg)

Windows 中的[向导：](http://msdn.microsoft.com/en-us/library/aa511302.aspx)

[航空向导 http://i.msdn.microsoft.com/Aa511302.wizards01(en-us,MSDN.10).png](http://i.msdn.microsoft.com/Aa511302.wizards01(en-us,MSDN.10).png)

有关实现细节，请参阅 Fowler 的[应用程序控制器](http://i.msdn.microsoft.com/Aa511302.wizards01(en-us,MSDN.10).png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T09:53:45.620

查看[CodeProject 上的 .Net 向导控件](http://www.codeproject.com/KB/miscctrl/ak_wizard.aspx)。

为了对向导的行为进行编程，您可能还会发现[状态模式](http://en.wikipedia.org/wiki/State_pattern)很有帮助。

# installation - 如何在媒体殿堂服务器上安装 couchDB？

> ID：560409
> 
> 赞同：1
> 
> 时间：2009-02-18T09:45:58.057
> 
> 标签：installation, couchdb

我在使用 CouchDB 开始一个项目时遇到的最大问题是启动和运行它所涉及的噩梦。

在媒体殿堂服务器或任何服务器上安装 couchDB 的任何提示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:52:55.560

我不完全确定什么是媒体模板服务器，但我认为它是一个非常标准的 Linux 服务器（centos？）。目前最好的选择是从 SVN 中的最新源代码编译 CouchDB。

您需要使用 ssh 登录您的服务器，然后按照以下说明操作： [http ://wiki.apache.org/couchdb/Installing_on_RHEL5](http://wiki.apache.org/couchdb/Installing_on_RHEL5)

我知道这表示它适用于 RHEL5，但对于最新版本的 Centos 将完全一样。如果您需要其他操作系统的说明，请尝试： [http ://wiki.apache.org/couchdb/Installation](http://wiki.apache.org/couchdb/Installation)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-24T08:17:33.463

MediaTemple 使用 CentOS 的修改版本。但是不要尝试安装官方 RHEL 文档 - 因为 Spidermonkey 库无法工作，所以它已损坏。

尝试这个。10 分钟前我刚刚在 MediaTemple 上安装了 Couch - [在 CentOS 上安装 CouchDB](http://www.thegeekstuff.com/2012/06/install-couch-db/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-07T09:44:01.023

上面的“安装”链接不再起作用。但是 - 在 MediaTemple 和 1und1 上成功安装了 CouchDB，步骤 1 如下： **http :** [//www.thegeekstuff.com/2012/06/install-couch-db/](http://www.thegeekstuff.com/2012/06/install-couch-db/)

当您在虚拟主机环境中时：确保在 /etc/couchdb/local.ini 中提供虚拟主机的路径

它在 .ini 文件中进行了描述。

# sql - 如何获取每个数组项并插入 SQL 数据库？

> ID：560413
> 
> 赞同：0
> 
> 时间：2009-02-18T09:47:38.753
> 
> 标签：sql, vb.net, arrays

我有以下 vb.net 代码从网页上的文本框中取出值（实际上是空格分隔的标签），并用空格分隔符将它们拆分成一个数组。这正是我想要的。

```
mySample.Tags = tagsTextBox.Text
Dim tags As String = mySample.Tags
Dim tagarray() As String
Dim count As Integer
tagarray = tags.Split(" ")
For count = 0 To tagarray.Length - 1
Next 
```

我的问题是，在此代码运行后，我不知道如何获取数组中的每个值，以将它们作为单独的记录插入到表中。

我也不知道数组中有多少项目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T10:01:11.450

正如 Ian 所说，这可能对 Sql 注入很不利。至少你应该为你想要插入的每个标签做一个 Server.HtmlEncode() 。

要插入数据，您可以执行以下操作：

```
using (SqlConncetion conn = new SqlConnection(connstring))
using (SqlCommand cmd = conn.CreateCommand())
{

  cmd.CommandText = "INSERT INTO table(tag) values (@tag)";
  cmd.Parameters.Add("@tag", SqlDbType.VarChar);

  conn.Open();

  foreach(string tag in tags)
  {
    cmd.Parameters["@tag"].Value = Server.HtmlEncode(tag);
    cmd.ExecuteNonQuery();
  }
} 
```

这应该可以正常工作，但是在存储过程中进行，并且由于您使用参数，因此您应该可以安全地防止 sql 注入。

您还应该[在此处](https://stackoverflow.com/questions/306668/are-parameters-really-enough-to-prevent-sql-injections)查看有关参数使用的讨论。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T10:01:13.167

这完全取决于性能要求和您使用的一般做法。Rune 的回答可以很好。如果您要插入 100,000 行，请查看批量插入器。

如果您习惯于编写存储过程并且您很幸运能够运行 SQL 2008，那么您可以使用[表值参数](http://www.stephenforte.net/PermaLink,guid,07dfeb00-d0b0-47dd-9761-3b4c9f160277.aspx)

这使您可以执行以下操作：

```
SqlCommand cmd = new SqlCommand("usp_ins_Portfolio", conn);
cmd.CommandType = CommandType.StoredProcedure;
//add the ds here as a tvp
SqlParameter sp = cmd.Parameters.AddWithValue("@Portfolio", ds.Tables[0]);
//notice structured
sp.SqlDbType = SqlDbType.Structured;
cmd.ExecuteNonQuery(); 
```

然后对存储过程的一次调用可以将所有需要的行插入到 Tag 表中。

对于 SQL 2005 及以下版本，我通常会对所有值使用单个逗号分隔的参数，并将其拆分为存储过程中的 TSQL。这往往表现得非常好，并避免与临时表混在一起。它也是安全的，但是您必须确保为 proc 使用文本输入参数，或者在代码中具有某种限制或批处理机制（因此您不会截断长列表）。

有关如何在 TSQL 中拆分列表的想法，请查看 Erland 的[优秀文章](http://www.sommarskog.se/arrays-in-sql-2005.html)。

Sql 2000 版本的[文章在这里](http://www.sommarskog.se/arrays-in-sql-2000.html)。

# .net - WPF 文本框太大

> ID：560416
> 
> 赞同：4
> 
> 时间：2009-02-18T09:48:05.773
> 
> 标签：.net, wpf, layout, textbox, stretch

我有一个 WPF 页面，上面有一些数据输入文本框，它们看起来比字体需要的大得多。什么决定了文本框的高度？有没有办法把它们压扁？

文本框根据它显示的字体大小变得越来越小（所以如果我可以帮助的话，我不想直接设置 height 属性。

这是我的意思的一个例子......

```
<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Page.Resources>
    <Style x:Key="LabelStyle" TargetType="Label">
      <Setter Property="HorizontalAlignment" Value="Right"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>

    <Style x:Key="TextBoxStyle" TargetType="TextBox">
      <Setter Property="HorizontalAlignment" Value="Left"/>
      <Setter Property="VerticalAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>

  </Page.Resources>
  <StackPanel>
    <WrapPanel>
      <Label Style="{StaticResource LabelStyle}" Content="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
      <TextBox Style="{StaticResource TextBoxStyle}" Text="{Binding ActualHeight, RelativeSource={RelativeSource Self}, Mode=OneWay}"/>
    </WrapPanel>
    <WrapPanel>
      <Label Style="{StaticResource LabelStyle}" Content="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
      <TextBox Style="{StaticResource TextBoxStyle}" Text="{Binding ActualHeight, RelativeSource={RelativeSource Self}, Mode=OneWay}"/>
    </WrapPanel>
  </StackPanel>
</Page> 
```

如果您查看大小，您会看到标签比文本框大一点。将文本框上的 VerticalAlignment 更改为 Top 使其大小相同。作为一项临时措施，我只是将标签上的边距设置为 -2。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T09:55:43.273

我的猜测是你`TextBox`的容器导致它太大。

[在Kaxaml](http://www.kaxaml.com)中尝试以下 XAML ：

```
<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

  <Grid VerticalAlignment="Center" HorizontalAlignment="Center">  
    <TextBox Text="Sample text" FontSize="2" />
  </Grid>

</Page> 
```

这呈现为页面中心的一个非常小的文本框。如果从容器中删除`VerticalAlignment="Center"`and `HorizontalAlignment="Center"`，则文本框非常大。

和的默认水平和垂直对齐方式`Grid`是`TextBox`，`Stretch`这基本上意味着元素不关心并且会采用它给出的内容。所以布局引擎询问`TextBox`它应该有多大并且没有得到答案，所以布局询问`Grid`. `Grid`也不关心，所以最后它会询问具有固定大小的/ `Page`，`Window`然后这个大小会沿着可视化树传播（沿途考虑任何边距和填充）。最终结果是`TextBox`填充了整个区域。

为了证明这一点，将对齐属性从 移动`Grid`到`TextBox`自身。您无法在视觉上看到差异，但如果您为 Grid 设置背景颜色，您会这样做。

```
<Grid Background="Red">
  <TextBox VerticalAlignment="Center" HorizontalAlignment="Center"
           Text="Sample text" FontSize="2" />
</Grid> 
```

如果您想将文本框的边框塞满文本，您也可以`Padding="0"`在文本框本身上进行设置。

有关 WPF 布局系统的更多信息，请参阅[本文](http://msdn.microsoft.com/en-us/library/ms745058.aspx)。

# windows - 私有字节的 win32 API 函数是什么？

> ID：560430
> 
> 赞同：5
> 
> 时间：2009-02-18T09:53:39.020
> 
> 标签：windows, winapi

什么是私有字节的 win32 API 函数（您可以在 perfmon 中看到的那些）。

我想避免使用 .NET API

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T10:09:22.103

```
BOOL WINAPI GetProcessMemoryInfo(
  __in   HANDLE Process,
  __out  PPROCESS_MEMORY_COUNTERS ppsmemCounters,
  __in   DWORD cb
); 
```

其中`ppsmemCounters`参数可以是一个`PROCESS_MEMORY_COUNTERS`或`PROCESS_MEMORY_COUNTERS_EX`结构。只需类型转换`PROCESS_MEMORY_COUNTERS_EX`为`PROCESS_MEMORY_COUNTERS`.

`PROCESS_MEMORY_COUNTERS_EX.PrivateUsage`就是你要找的。

更多信息[在这里](http://msdn.microsoft.com/en-us/library/ms683219(VS.85).aspx)和[这里](http://msdn.microsoft.com/en-us/library/ms684874(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T10:08:34.570

[您可以使用性能计数器 API](http://msdn.microsoft.com/en-us/library/aa373083(VS.85).aspx)收集 perfmon 显示的相同数据

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T10:06:44.323

你需要澄清你想要做什么。这些是内部数字，其值不受任何 API 的真正控制。

从技术上讲，Private Bytes 是提交费用，即在交换文件中分配的内存量，用于保存应用程序私有内存的内容（如果它被换出）。

通常私有字节=动态分配的内存量+一些额外的。

# c# - 从流中读取 excel 文件

> ID：560435
> 
> 赞同：15
> 
> 时间：2009-02-18T09:55:04.337
> 
> 标签：c#, asp.net, excel, file-upload, filestream

我需要一种从流中读取 Excel 文件的方法。它似乎不适用于 ADO.NET 的处理方式。

场景是用户通过 FileUpload 上传文件，我需要从文件中读取一些值并导入数据库。

由于多种原因，我**无法**将文件保存到磁盘，也没有理由这样做。

那么，有人知道从 FileUpload 流中读取 Excel 文件的方法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T10:51:03.750

看来我自己找到了解决问题的方法。

[http://www.codeplex.com/ExcelDataReader](http://www.codeplex.com/ExcelDataReader)

这个库似乎工作得很好，它需要一个流来读取 excel 文件。

```
ExcelDataReader reader = new ExcelDataReader(ExcelFileUpload.PostedFile.InputStream); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-03-31T11:32:54.667

这可以通过[EPPlus](https://github.com/EPPlusSoftware/EPPlus)轻松完成。

```
//the excel sheet as byte array (as example from a FileUpload Control)
byte[] bin = FileUpload1.FileBytes;

//gen the byte array into the memorystream
using (MemoryStream ms = new MemoryStream(bin))
using (ExcelPackage package = new ExcelPackage(ms))
{
    //get the first sheet from the excel file
    ExcelWorksheet sheet = package.Workbook.Worksheets[1];

    //loop all rows in the sheet
    for (int i = sheet.Dimension.Start.Row; i <= sheet.Dimension.End.Row; i++)
    {
        //loop all columns in a row
        for (int j = sheet.Dimension.Start.Column; j <= sheet.Dimension.End.Column; j++)
        {
            //do something with the current cell value
            string currentCellValue = sheet.Cells[i, j].Value.ToString();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T20:40:45.313

[SpreadsheetGear](http://www.spreadsheetgear.com/)可以做到：

```
SpreadsheetGear.IWorkbook workbook = SpreadsheetGear.Factory.GetWorkbookSet().Workbooks.OpenFromStream(stream); 
```

您可以通过[免费评估](https://www.spreadsheetgear.com/downloads/register.aspx)自己尝试。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T10:07:50.750

[Infragistics](http://www.infragistics.com)有一个[excel 组件](http://www.infragistics.com/dotnet/netadvantage/winforms/infragisticsexcel.aspx)，可以从流中读取 excel 文件。

我在这里的一个项目中使用它并且效果很好。

此外，可以轻松修改开源[myXls 组件以支持此功能。](http://myxls.in2bits.org/wiki/MainPage.ashx)XlsDocument 构造函数仅支持从由文件名给出的文件加载，但它通过创建 FileStream 然后读取 Stream 来工作，因此将其更改为支持从流加载应该是微不足道的。

编辑：我看到您找到了解决方案，但我只想指出我更新了组件的源代码，以便它现在可以直接从流中读取 excel 文件。:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-11-30T10:53:20.983

我使用[ClosedXML](https://www.nuget.org/packages/ClosedXML/) nuget 包从流中读取 excel 内容。它在类中有一个构造函数重载，`XLWorkbook`它将流指向一个 excel 文件（又名工作簿）。

在代码文件顶部导入的命名空间：

```
using ClosedXML.Excel; 
```

源代码：

```
var stream = /*obtain the stream from your source*/;
if (stream.Length != 0)
{
    //handle the stream here
    using (XLWorkbook excelWorkbook = new XLWorkbook(stream))
    {
        var name = excelWorkbook.Worksheet(1).Name;
        //do more things whatever you like as you now have a handle to the entire workbook.
        var firstRow = excelWorkbook.Worksheet(1).Row(1);
    }
} 
```

# email - 以编程方式从 linux 服务器发送电子邮件

> ID：560445
> 
> 赞同：2
> 
> 时间：2009-02-18T10:00:48.737
> 
> 标签：email, sendmail

我想从 linux 服务器发送一封电子邮件。服务器不需要接收回电子邮件。

有没有比 sendmail 更简单的解决方案来仅发送外发电子邮件？

我更喜欢使用 Perl 来发送电子邮件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T10:06:30.470

呼叫`/usr/lib/sendmail`通常是首选方法，因为它可以正确处理交付问题。这*并不*意味着使用[sendmail](http://www.sendmail.org/)。大多数（全部？）邮件传输系统都提供了一个刚刚*命名* `sendmail`的命令，并提供了一个与原始系统兼容的接口。

或者，您可以使用 Net::SMTP 之类的包直接通过 SMTP 中继发送，但要特别确保正确解决交付问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T10:07:58.517

Sendmail 不是唯一的选择。您可以使用 Postfix、Qmail 和许多其他工具

我的 Perl 脚本调用 mailx 命令。要知道如何使用它，请输入“man mailx” 但是这需要配置 MTA correclty。

或者您可以只使用 Net::SMTP perl 库并使用您选择的 smtp 服务器

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T17:51:05.177

我已经成功使用了[msmtp](http://msmtp.sourceforge.net/)，即它支持很好的身份验证

TJ Luoma 在[TUAW上写了一篇不错的文章](http://www.tuaw.com/2010/05/04/msmtp-a-free-tool-to-send-email-from-terminal/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-21T09:24:46.103

对于所描述的场景，我发现 nullmailer 是一个非常有用的解决方案。Nullmailer 是 sendmail/qmail/etc 的替代 MTA，它中继到一组固定的邮件服务器。配置非常简单，占用资源少。

与其他提到的解决方案（如 mstmp 和 ssmtp）相比，nullmailer 的一个重要优势是它维护了要发送的电子邮件队列。在邮件排队时（毫秒），发送邮件的应用程序只会被阻塞很短的时间。邮件的发送发生在另一个进程的上下文中。mstmp 和 ssmtp 等解决方案不维护电子邮件队列。发送发生在应用程序的上下文中，从而阻塞了应用程序。以这种方式发送电子邮件很容易需要 1 到 2 秒或更长时间。在许多情况下这可能不是问题，但如果电子邮件是由 Web 应用程序发送的，则可能会成为问题。

[http://untroubled.org/nullmailer/](http://untroubled.org/nullmailer/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T10:07:29.503

如果您的组织中已经在运行另一个邮件服务器，则您不需要在进行发送的机器上使用邮件传输代理 (MTA) 实例：您可以让 Perl 通过 SMTP 将电子邮件传递到该服务器，因此无需拥有（另一个) MTA 就像“你的”机器上的 sendmail。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T17:58:23.007

我喜欢创建一个 gmail 或其他免费帐户，然后使用 J2EE 中的 java 邮件 api 将消息（从您的新 gmail 帐户）发送给任何人......通常我会创建一个可以用一个构造的 Mailer 类默认构造函数，然后给它一个 send(String dest, String subj, String body[, Obj attach...if you want]) 然后在您的情况下，您可以将事物包装在 main 方法中，以便您可以从中调用它否则使用一些命令行参数，或者从一些java程序中调用。如果你有兴趣我会拍你的代码。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-18T10:05:25.060

我知道你说 perl，但我用过的最简单的跨平台电子邮件发送库是 python 的[smtplib](http://docs.python.org/library/smtplib.html)。当然值得一看。

# c# - 主从关系的 Datagridview 选择列

> ID：560451
> 
> 赞同：0
> 
> 时间：2009-02-18T10:03:31.603
> 
> 标签：c#, datagridview

我在 c# 中使用两个 Datagridview 控件实现了主从关系。每个数据源都连接到一个 DataTable，并且使用 DataRelation 完成连接。我使用 DataGridviewTask 的“添加列”添加了一个复选框列。

我想实现我可以使用此复选框来选择/取消选择将与当前主行相关的详细信息行。主行和明细行之间的关系应为 1 : 0..1。选择详细信息行后，应调用将信息保存在数据库表中的方法。

目前我不知道如何实现这一点，我什至无法点击复选框（它绝对不是只读的），我认为它与复选框列的“DataPropertyName”有关，但我没有不知道我应该将其设置为哪个属性。

如果有人知道如何实现这种情况（甚至可能有免费的 datagridview 扩展），我将不胜感激。

谢谢丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T10:18:00.647

对于初学者，您应该确保复选框存在一个布尔列。在类型化的数据集中，您可以使用 DatasetDesigner 轻松添加一个。

# java - Eclipse 中的通用键绑定

> ID：560452
> 
> 赞同：3
> 
> 时间：2009-02-18T10:03:34.863
> 
> 标签：java, eclipse, key-bindings

我希望能够使用 CTRL-SHIFT-T 从Eclipse 中的*任何角度打开 Java 类型（源代码文件）。*不幸的是，键绑定仅适用于 Java 透视图。

我尝试使用上下文“In Windows”和“In Dialogs and Windows”来定义键绑定。那没有奏效。

任何想法如何做到这一点？

（对于文档，请注意例如[此页面](http://help.eclipse.org/help32/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/accessibility/keyboardshortcuts.htm)。）

[图片由 ImageShack.us 托管 http://img18.imageshack.us/img18/7205/keybindingsna4.png](http://img18.imageshack.us/img18/7205/keybindingsna4.png)
拍摄于 2009-02-18

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T11:43:36.883

在 Eclipse 中转到：

1.  窗口 -> 自定义透视图...
2.  单击“命令”选项卡
3.  选中“Java 导航”复选框
4.  点击“确定”

现在您可以在此透视图中使用 Ctrl + Shift + T。

不幸的是，您必须从通常用于在所有这些方面获得此功能的所有方面都这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T11:44:44.353

您需要在要访问“打开类型”对话框的透视图中激活命令“Java Navigate”。

![替代文字](https://www.qnx.com/developers/docs/6.3.2/ide_en/user_guide/images/customize-perspective-commands.gif)

您将通过右键单击工具栏按钮附近的“自定义透视图”来访问此对话框。

正如[lud0h 的回答](https://stackoverflow.com/questions/560452#560725)中提到的那样，“您必须从通常使用的所有角度执行此操作，才能在所有这些角度上获得此功能”

直到... [eclipse3.5M4 200099 年 1 月下旬](http://blog.eclipse-tips.com/2008/12/whats-cooking-in-m4.html)

> 所有视角的 Java 动作集：
> 
> 如果您正在编辑 Java 文件，您也可以在非 Java 透视图中访问您喜欢的操作（Open Type 等）（CVS、资源）

# .net - 在包含计数的子查询上使用左连接的 Linq

> ID：560453
> 
> 赞同：8
> 
> 时间：2009-02-18T10:04:03.240
> 
> 标签：.net, linq, count, subquery, left-join

我很难将 sql 转换为 linq 语法。

我有 2 个表（Category 和 CategoryListing），它们使用 CategoryID 相互引用。我需要获取 Category 表中所有 CategoryID 的列表以及 CategoryListing 表中所有相应匹配项的 CategoryID 计数。如果 CategoryID 不存在于 CategoryListing 中，则仍应返回 CategoryID - 但频率为 0。

以下 sql 查询演示了预期的结果：

```
SELECT c.CategoryID, COALESCE(cl.frequency, 0) as frequency
FROM Category c
LEFT JOIN (
    SELECT cl.CategoryID, COUNT(cl.CategoryID) as frequency 
    FROM CategoryListing cl
    GROUP BY cl.CategoryID
) as cl
ON c.CategoryID = cl.CategoryID
WHERE c.GuideID = 1 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T10:12:24.590

未经测试，但这应该可以解决问题：

```
var q = from c in ctx.Category
        join clg in 
            (
                from cl in ctx.CategoryListing
                group cl by cl.CategoryID into g
                select new { CategoryID = g.Key, Frequency = g.Count()}
            ) on c.CategoryID equals clg.CategoryID into cclg
        from v in cclg.DefaultIfEmpty()
        where c.GuideID==1
        select new { c.CategoryID, Frequency = v.Frequency ?? 0 }; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-02-13T16:11:16.020

我继续将整个查询移动到数据库上的存储过程。这首先通过避免使用 LINQ 来解决问题。

# django - Django 表单验证中的禁止 IP

> ID：560455
> 
> 赞同：8
> 
> 时间：2009-02-18T10:05:01.647
> 
> 标签：django, django-forms

我正在尝试验证表单，如果用户 ( `request.META['REMOTE_ADDR']`) 的 IP 在表中`BlockedIPs`，则验证将失败。但是我无权`request`访问`Form`. 我该怎么做？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T10:22:58.280

通过覆盖使其可用于您的表单，`__init__`以便可以在构造期间传入（或者您可以只传递 IP 本身）：

```
from django import forms

class YourForm(forms.Form)
    # fields...

    def __init__(self, request, *args, **kwargs):
        self.request = request
        super(YourForm, self).__init__(*args, **kwargs)

    # validation methods... 
```

现在您只需`request`在初始化表单时将对象作为第一个参数传递，您的自定义验证方法将可以通过以下方式访问它`self.request`：

```
if request.method == 'POST':
    form = YourForm(request, request.POST)
    # ...
else:
    form = YourForm(request)
# ... 
```

# c# - 成功的 Visual Studio C# 构建不会创建程序集

> ID：560458
> 
> 赞同：3
> 
> 时间：2009-02-18T10:05:29.257
> 
> 标签：c#, .net, visual-studio-2005, build-process

我正在使用 Visual Studio 2005、.NET 2.0

我还不确定在什么情况下会发生这种情况，但情况如下：我有一个项目结构如下的解决方案：一个库项目 Foo，一个引用 Foo 的库项目 Bar，以及一个引用 Foo 的库项目 Quux和酒吧。

编译失败并出现错误消息“无法找到元数据文件 'Foo.dll'”来自 Bar，并且“找不到元数据文件 'Foo.dll'”和“找不到元数据文件 'Bar.dll'”来自 Quux。

查看我的目标目录（我有一个包含所有 3 个项目的组合目标目录），它是空的，所以根本没有编译任何项目。现在，如果 Foo 没有输出，我可以让 Bar 和 Quux 失败。问题是：为什么 Foo 静默失败？它没有错误，只是构建 Foo 而不是整个解决方案可以正常工作。

“有趣”的是，再次按下构建按钮后，出现 Foo.dll 文件，Bar 不再抱怨但也不产生任何输出文件，Quux 抱怨缺少 Bar.dll。再次按下按钮，出现 Bar.dll，没有更多错误但没有 Quux.dll。只有在再次按下按钮后，Quux.dll 才会出现，再次没有错误。

项目依赖项都设置正确，解决方案构建顺序完全正确。

我什至尝试过创建一个新的解决方案和新的项目文件，然后再次将源添加到这些文件中。也没有欢乐。同样的事情也会发生。

我完全被难住了。有谁知道摆脱这种混乱的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T10:35:31.137

每个项目都应该有单独的输出目录。每次构建项目时，它都会清除输出目录，因此它不会找到下一个项目的任何依赖项。

不要害怕丢失任何 DLL，它们将被复制到需要它们的每个 bin 目录中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T10:45:14.590

我认为解决您的问题的方法可能是使用构建后事件删除以前版本的 dll 并将新版本复制到您的组合目标目录中。

当您设置三个项目以这种方式工作时，您会发现您正在将每个项目编译到其对应的 bin 文件夹和组合的目标目录中。如果您决定使用它，您应该做的第二件事是为您的解决方案中的每个项目设置一个指向组合目标目录的参考路径。编译顺序必须仍然存在。

这样，每次编译时，每个项目 dll 都会在合并的目标目录中找到。

虽然，这个解决方案有它自己的问题，比如构建后事件忘记正常工作；但很少见。

希望这可以帮助

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T10:12:19.677

问题是构建顺序。如果某个项目依赖于另一个项目，则必须先构建第二个项目。在解决方案属性中使用构建依赖项来克服这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T10:14:24.400

检查你的构建顺序，以便一切看起来都在那里。尝试运行一个干净的解决方案并再次构建它是什么时候发生的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-10T05:15:11.623

将您的项目文件拖到记事本中并使用“导入”标签查找并将该标签替换为

```
Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" 
```

它应该工作

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-04T14:06:42.383

由于未知的原因，这发生在我早上工作中使用 Visual Studio 2013 的时候。一个构建，它正在更新 dll，下一个，它只是不是，即使构建似乎进展顺利。我最终通过删除现有的 dll 解决了这个问题。由于没有预先存在的 dll，构建必须提供一个新的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-09T15:43:45.840

我同意每个项目都应该有自己的目标目录。我试图用这个变得可爱，它总是比我试图解决的任何问题都造成更多的麻烦。

我有一个 vs19 , 5 个项目的解决方案。我刚刚添加了一个新的控制台应用程序。这个应用程序突然开始编译而没有抱怨，但没有产生文件。依赖它的单元测试项目抱怨。

我照常做

*   清理/重建
*   按顺序清理/重建每个项目
*   检查项目依赖关系和构建顺序
*   重新启动 vis 工作室（知道它的 2020 年，我仍然需要重新启动 vs 有时）

面对刚刚创建一个新项目的前景，我决定尝试另一件事

1.  删除了对其他项目的所有引用
2.  注释掉所有依赖这些的代码。

我留下了一个 main()，它返回了一个 0 这个编译和生成的文件

3.  我一一添加了引用，直到一切都在那里。
4.  取消注释代码。

在这个练习结束时，事情奏效了。

我不能告诉你发生了什么变化。以为我会提供这个作为故障排除方法。

# vba - 数据透视表总计位于顶部

> ID：560469
> 
> 赞同：0
> 
> 时间：2009-02-18T10:08:23.523
> 
> 标签：vba, excel, pivot, pivot-table

我们有一个 Excel 电子表格，顶部有一个使用 Forumla 的总计，但这不在实际的数据透视表上，它只是在电子表格中。

我们有一个客户希望总和位于数据透视表的顶部，并且不希望我们使用公式。有谁知道这是否可能（即使使用 VBA 或其他东西，只要我们不查找特定的列或行名称并与之比较（所以没有 GETPIVOTDATA("Grand Total...))）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T00:53:13.477

这个有点hacky的解决方案可能会有所帮助：

[http://www.contextures.com/xlPivot13.html](http://www.contextures.com/xlPivot13.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-24T17:11:50.850

实际上，这是可能的。我正在这样做。就是这样。假设我在我的数据源中，我有 1 列包含各种工作订单。在另一列中，我列出了每个工单花费的所有总美元，在最后一列中，我有一个数字，将所有各种工单标识为一个完整组的一部分，或者属于一个标题。就我而言，每个工单都属于一个项目编号。这会将您的总数放在顶部和底部。它还允许您通过在行/列的总计开/关下选择一个选项来打开和关闭底部或顶部。

凯文大号

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:02:37.033

我很高兴被证明是错误的，但我认为这是不可能的。我认为您可能需要在管理客户的期望方面做一些工作...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-09-19T14:34:25.547

它通常有效。但我团队中的许多人制作了不同的数据透视表布局。所以比这个“假”的总计栏真的不再起作用了。

# data-structures - 我在哪里可以了解基本的数据结构概念？

> ID：560471
> 
> 赞同：0
> 
> 时间：2009-02-18T10:08:35.427
> 
> 标签：data-structures

我很久以前就学习过数据结构。我需要更新我对数据结构中基本主题的知识以进行工作面试。任何人都可以向我提供有关此主题的一些资源或链接吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T10:16:34.143

Corman、Leiserson、Rivest 和 Stein 对算法的介绍。

在[亚马逊购买、](https://rads.stackoverflow.com/amzn/click/com/0262032937)[在线](http://www.google.se/url?sa=t&source=web&ct=res&cd=4&url=http%3A%2F%2Fbooks.google.se%2Fbooks%3Fid%3DNLngYyWFl_YC%26dq%3Dintroduction%2Bto%2Balgorithms%26printsec%3Dfrontcover%26source%3Dbn%26hl%3Dsv%26ei%3Di96bScDSPIPc0AWep7XjBQ%26sa%3DX%26oi%3Dbook_result%26resnum%3D4%26ct%3Dresult&ei=i96bScDSPIPc0AWep7XjBQ&usg=AFQjCNF3lfmq7nlrzboVqmjRS48k7NkCEw&sig2=l0zBEjEwj8KseefTSWGPng)阅读或在当地图书馆借阅。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T23:45:57.133

加州大学伯克利分校有许多完整的讲座系列可供免费下载视频和音频。它们包括许多计算机科学课程，包括[关于数据结构的一](http://webcast.berkeley.edu/course_details_new.php?seriesid=2008-D-26332&semesterid=2008-D)门课程。

我真的建议大家看看[Berkeley 视频网站](http://webcast.berkeley.edu/)，不管他们是否对数据结构感兴趣。有关于许多主题的广泛课程，这是免费了解您感兴趣的主题的绝佳方式。这种资源是真正让互联网令人惊叹的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T10:34:33.383

我在计算机科学研究的第一年包括Robert Sedgewick的[“C++ 算法：基础、数据结构、排序、搜索和图形算法”的早期编辑，我发现它非常有用。](http://www.amazon.co.uk/Algorithms-Fundamentals-Structures-Sorting-Searching/dp/020172684X/ref=sr_1_9?ie=UTF8&s=books&qid=1234953128&sr=8-9)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T11:06:36.247

我推荐所有时代的经典： Aho、Ullman 和 Hopcroft 的*“数据结构和算法”*。

[http://www.amazon.com/Structures-Algorithms-Addison-Wesley-Computer-Information/dp/0201000237](https://rads.stackoverflow.com/amzn/click/com/0201000237)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T23:29:28.983

[算法简介](https://rads.stackoverflow.com/amzn/click/com/0201120372)

[算法和数据结构 - 基本工具箱](https://rads.stackoverflow.com/amzn/click/com/3540779779)

# apache-flex - Flex 等效于 ProcessMessages 和长循环期间无响应的 UI

> ID：560474
> 
> 赞同：11
> 
> 时间：2009-02-18T10:08:45.130
> 
> 标签：apache-flex, user-interface

我发现我的 Flex 应用程序的 UI 在很长的处理循环（数十秒）期间变得无响应。例如，在处理非常大的 XML 文件并为每个元素做一些事情时......

是否有“ProcessMessages”的等价物？也就是说，一个调用会告诉 Flex 继续响应 UI 事件，即使是在某个长循环的中间，这样 UI 就不会变得无响应？

**我知道 Flex 在设计上是单线程的**。这正是我寻找类似 ProcessMessages() 的原因 - 一个允许**单线程可重入**应用程序（如在 VB 中，或基于单线程消息循环的 C++ 应用程序）在长时间操作期间保持响应的函数。

**答案摘要**

1.  Flex中没有类似`HandleEvents()`or的内置函数。`ProcessMessages()`
2.  使用某种回调机制来迭代处理长计算过程的块，同时屈服于块之间的运行时间，从而使其能够响应，是在长时间计算期间保持响应式 UI 的唯一方法。
3.  实现上述方法的方法有：
    1.  使用该`enterFrame`事件，只要 Flex 应用程序下方的 Flash“电影”层刷新其帧（类似于 20fps），就会调用该事件。
    2.  使用计时器。
    3.  使用`UIComponent.callLater()`哪些计划“稍后”完成。（正如文档[所说](http://livedocs.adobe.com/flex/3/langref/mx/core/UIComponent.html#callLater())：`Queues a function to be called later. Before each update of the screen, Flash Player or AIR calls the set of functions that are scheduled for the update.`
    4.  使用有意触发的鼠标/键盘事件来创建伪“工作线程”，如[本例所示](http://blogs.adobe.com/aharui/2008/01/threads_in_actionscript_3.html)。

如果有进一步的建议，或者如果我遗漏了任何内容，请随时编辑这个（现在）wiki 文章。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T10:40:40.063

问题是Flash 是单线程的，即在部分代码运行之前，不能进行其他处理。您将不知何故需要将处理分解成更小的块并执行这些块，例如，在`enterFrame`事件中。

**编辑**：恐怕不赞成这个（或西蒙的）答案并不能改变这在 AS3 中不可行的事实。阅读[本文](http://blogs.adobe.com/aharui/2008/01/threads_in_actionscript_3.html)以获取有关该问题的更多信息。这篇文章还包括一个名为 PseudoThread 的简单“库”，它有助于执行长时间的后台计算。不过，您仍然必须自己将问题分解成更小的部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T15:28:22.507

`ProcessMessages`我可以明确地告诉您，从 Flex 3 开始，没有与您所描述的功能类似的内置结构。

解决此问题的最常见方法是将您正在处理的任何工作拆分为一个“工作”任务队列和一个“工作管理器”来控制队列。`callLater()`随着每个“工作人员”完成其处理，工作人员队列管理器将下一个工作人员从队列中弹出并在调用中执行它。这将产生类似于“屈服于主线​​程”的效果，并允许您的 UI 接收事件并做出响应，同时在将控制权返回给工作人员时仍然允许处理继续。

完成这项工作后，您可以进行一些测试和分析，以确定您的应用程序是否可以在调用 之前执行多个工作程序的运行`callLater()`，并将此逻辑封装在工作程序队列管理器中。例如，在我们的这种模式的实现中（队列中有几百个工作人员），我们能够通过执行 4 个工作人员在“屈服于主线​​程”之前以相当的感知性能更快地完成处理`callLater()`，但是这完全取决于您的员工所做工作的范围和性质。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T10:40:29.843

ActionScript 的进程模型是单线程的，所以答案是否定的。最好的办法是尽可能推迟到服务器上的异步任务，或者在长循环运行时弹出等待光标，或者将进程分成一些对 UI 不太具有侵入性的小块，或者执行在用户不太可能感受到效果的时刻（例如应用程序启动）长时间运行的任务。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T12:05:57.797

Actionscript 在设计上是单线程的，再多的反对意见也不会改变这一点。

为了兼容性，您最好的选择是尝试将您的处理分成更小的块，并迭代地进行处理。

如果您绝对需要线程，可以使用[Pixel Bender](http://labs.adobe.com/technologies/pixelbender/)*过滤*器在 Flash Player 10 中完成。这些将在单独的线程上运行，并在完成后给您一个回调。 我相信它们非常适合“核心”处理任务，因此它们可能很适合您的目的。但是，他们会对您的代码提出一系列其他要求，因此您最好还是做一些小的“桶”计算。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T22:00:14.437

Flash Player 中没有等效的功能。按照设计，Flash Player 在渲染到屏幕和运行每一帧的所有代码之间交替进行。`Event.ENTER_FRAME`在显示对象或其他对象上使用事件`Timer`是分解非常长的计算的最佳选择。

值得注意的是，ActionScript 中的一些事件具有`updateAfterEvent()`如下描述的函数：

> 如果显示列表已被修改，则指示 Flash Player 或 AIR 运行时在此事件处理完成后呈现。

特别是[`TimerEvent`](http://livedocs.adobe.com/flex/3/langref/flash/events/TimerEvent.html),[`MouseEvent`](http://livedocs.adobe.com/flex/3/langref/flash/events/MouseEvent.html)和[`KeyboardEvent`](http://livedocs.adobe.com/flex/3/langref/flash/events/KeyboardEvent.html)支持`updateAfterEvent()`。可能还有其他人，但那些是我通过快速搜索找到的。

# apache-flex - Flex - 如何让 Tree itemClick 事件模仿 itemOpen 事件？

> ID：560475
> 
> 赞同：1
> 
> 时间：2009-02-18T10:08:57.563
> 
> 标签：apache-flex, actionscript-3, events, tree

我正在使用带有 XMLListContainer dataProvider 的 Tree 控件...。我使用 itemOpen 事件和以下代码在打开树文件夹时更新另一个数据提供程序（使用小三角形） - 数据提供程序包含`<slide />`该特定内容中的所有元素树文件夹...

```
private function itemOpenEvent(event:TreeEvent):void {          
 slideDP = new XMLListCollection(event.item.elements("slide"));  
 slideDP.refresh();                     
} 
```

如果打开第二个文件夹，thumbDP 更新正常，但是当单击第一个文件夹（或另一个关闭的文件夹）时，我希望发生相同的行为（目前您必须关闭并重新打开第一个文件夹）

所以我使用了一个 itemClick 事件 - 但这会触发一个 ListEvent 并且我无法弄清楚如何轻松地从 XMLListContainer 中获取子元素......下面的代码引发了一个超出范围的异常

```
private function itemClickEvent(event:ListEvent):void {         
 treeFeed.getItemAt(event.rowIndex);                        
} 
```

任何人都可以帮忙吗？谢谢 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:20:34.323

我会更改您的事件侦听器以侦听更改事件，并使用 Tree 的 selectedItem 属性：

```
private function changeHandler(event:ListEvent):void
{                  
    slideDP = new XMLListCollection(tree.selectedItem.elements("slide"));

    slideDP.refresh();                           
} 
```

您可能需要将 selectedItem 转换为 XML 或 XMLList。

# windows-mobile - 如何在 windows mobile 上从 url 播放 mp3

> ID：560479
> 
> 赞同：2
> 
> 时间：2009-02-18T10:10:43.597
> 
> 标签：windows-mobile, mp3, directshow

我正在寻找一种在 Windows Mobile 5 上从 url 播放 mp3 文件的方法。

我发现使用 wmplib.WindowsMediaPlayer.url 属性的示例适用于设备上的文件，但似乎不适用于 http: url。该函数似乎成功而没有抛出异常，但没有播放音频。我已经尝试了 player.settings.volume = 100 并且还调用了 player.controls.play。此方法适用于 Windows 桌面应用程序，但不适用于移动设备。

使用 DirectShow 的另一个选项并不简单，因为根据我查看过的各种网站，Windows Mobile 不包含 Mpeg1（或 mp3）拆分器/解析器过滤器。我找到了两个示例过滤器的源代码，但都无法为 Windows Mobile 成功编译。

有谁知道用于 Windows Mobile 的预编译的、最好是免费的 mp3 解析器/拆分器过滤器，或者知道用于设置 Visual Studio 项目以便能够从源代码编译其中一个示例的明确说明？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T10:17:21.710

您可以使用[Windows Media Player 控件](http://msdn.microsoft.com/en-us/library/bb248593(VS.85).aspx)。Windows Windows Media Player 从 URL 读取多媒体流应该没有问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T14:08:47.950

[这](http://www.codeproject.com/KB/mobile/PocketStreamer.aspx)是一个创建应用程序的项目，用于通过网络连接到 Windows Mobile 设备流式传输音乐。也许该代码可以帮助您。

# flash - 闪光灯切换按钮

> ID：560490
> 
> 赞同：3
> 
> 时间：2009-02-18T10:14:33.167
> 
> 标签：flash, actionscript-3, button, toggle, simplebutton

我需要一个在 Flash/AS3 中切换开和关的按钮。所以我很高兴看到这个[`Button`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/controls/Button.html)类具有[`toggle`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/controls/LabelButton.html#toggle)让我有这种行为的属性。我不太高兴看到当我在 Flash 文件中创建一个“按钮”时得到的是一个[`SimpleButton`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/SimpleButton.html)类的实例，它没有那个选项。

有没有办法从 .fla 获取 Button 实例，或者让 SimpleButton 充当切换？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T12:43:22.060

以下是我如何编写代码：

```
private buttonState:Boolean;

private function buttonToggle(button:SimpleButton){
    var currDown:DisplayObject = button.downState;
    button.downState = button.upState;
    button.upState = currDown;
    buttonState = !buttonState;
}

private function clickEvent(e:MouseEvent){
    buttonToggle(e.target);
} 
```

我没有将代码放入`clickEvent`函数中，因为这允许我从代码中的其他位置切换按钮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T16:06:12.607

您可以从“组件”窗口中拖动一个按钮。那是你要找的吗？

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-18T10:35:16.470

我认为这可能对您有很大帮助：http: [//actionscriptexamples.com/2008/11/26/creating-toggle-buttons-in-flash-with-actionscript-30/](http://actionscriptexamples.com/2008/11/26/creating-toggle-buttons-in-flash-with-actionscript-30/)

它只是动作脚本。但是如果将 Button 组件拖到舞台上并为其分配实例名称，则相同。这样就可以从 as 脚本中访问它。

# perl - 如何使用 SMTP 和 Perl 向我的 Gmail 帐户发送电子邮件？

> ID：560491
> 
> 赞同：12
> 
> 时间：2009-02-18T10:14:59.267
> 
> 标签：perl, email, smtp, gmail

我不想使用 sendmail 发送电子邮件，但更喜欢使用 SMTP。如何使用 Perl 向我的 GMAIL 帐户发送电子邮件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-18T11:31:48.240

我个人建议您使用我的模块[Email::Send::SMTP::TLS](http://search.cpan.org/~fayland/Email-Send-SMTP-TLS-0.03/lib/Email/Send/SMTP/TLS.pm) ，它通过 Google Mail 的 TLS 工作得很好。

谢谢。

```
use Email::Send;

my $mailer = Email::Send->new( {
    mailer => 'SMTP::TLS',
    mailer_args => [
        Host => 'smtp.gmail.com',
        Port => 587,
        User => 'username@gmail.com',
        Password => 'password',
        Hello => 'fayland.org',
    ]
} );

use Email::Simple::Creator; # or other Email::
my $email = Email::Simple->create(
    header => [
        From    => 'username@gmail.com',
        To      => 'to@mail.com',
        Subject => 'Subject title',
    ],
    body => 'Content.',
);

eval { $mailer->send($email) };
die "Error sending email: $@" if $@; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T10:48:44.520

根据评论，目前尚不清楚您是想通过 Google 的 SMTP 发送电子邮件，还是一般只发送电子邮件（可能发送到您的 gmail 帐户）。您应该查看[Email::Send](http://search.cpan.org/perldoc?Email::Send)和可能的[Email::Send::Gmail](http://search.cpan.org/perldoc?Email::Send::Gmail)。

或者，如果您真正要问的是如何将电子邮件从不是 Gmail 的地方移动到 Gmail，那么使用[Mail::Box](http://search.cpan.org/perldoc?Mail::Box)和[Mail::Box::IMAP4:: SSL](http://search.cpan.org/perldoc?Mail::Box::IMAP4::SSL)后端。[您可以在此处](http://cpansearch.perl.org/src/DAGOLDEN/Mail-Box-IMAP4-SSL-0.02/examples/list-inbox.pl)查看使用示例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T13:18:31.557

[我一直使用Mail::Sender](http://search.cpan.org/dist/Mail-Sender/)并且运气很好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T10:21:46.363

CPAN 上有多个 SMTP 模块，例如[Net::ESMTP](http://search.cpan.org/dist/Net-ESMTP)。此外，sendmail 很可能确实使用 SMTP 与邮件服务器进行通信，那么您不想使用它的真正原因是什么？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T11:29:26.713

您可能想要查看的另一种可能性是使用 CPAN 中的[Email::Send::Gmail](http://search.cpan.org/~lbrocard/Email-Send-Gmail-0.33/lib/Email/Send/Gmail.pm)模块。这将允许您将电子邮件从您的 Gmail 帐户发送到任何帐户（例如，给您自己）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-09-06T15:11:00.097

[Email::Send](http://search.cpan.org/dist/Email-Send/lib/Email/Send.pm)（如 Fayland Lam 的回答中所用）已被弃用：

> Email::Send 正在消失……嗯，并没有真正消失，但它被正式标记为“失宠”。

这对我有用，使用首选的电子邮件::发件人：

```
use strict;
use warnings;

use Email::Sender::Simple qw(sendmail);
use Email::Sender::Transport::SMTPS ();
use Email::Simple ();
use Email::Simple::Creator ();

my $smtpserver = 'server';
my $smtpport = 587;
my $smtpuser   = 'username';
my $smtppassword = 'password';

my $transport = Email::Sender::Transport::SMTPS->new({
  host => $smtpserver,
  port => $smtpport,
  ssl => "starttls",
  sasl_username => $smtpuser,
  sasl_password => $smtppassword,
});

my $email = Email::Simple->create(
  header => [
    To      => 'mymail@gmail.com',
    From    => 'sender@example.com',
    Subject => 'Hi!',
  ],
  body => "This is my message\n",
);

sendmail($email, { transport => $transport }); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T10:22:21.993

如果您不熟悉[CPAN](http://www.cpan.org)（综合 Perl 存档网络），我建议您为该站点添加书签。它包含第三方（大部分经过良好测试）库。

显示如何使用 perl 发送电子邮件的示例：[http ://www.perlfect.com/articles/sendmail.shtml](http://www.perlfect.com/articles/sendmail.shtml)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T11:00:39.063

我碰巧使用[`MIME::Lite`](http://search.cpan.org/~rjbs/MIME-Lite/)，它是一个包装器，`Net::SMTP`用于简化构建电子邮件对象、文件附件和发送有效负载的过程。

如果您不熟悉安装模块，请检查：

在 Windows 上，使用 ActiveState Perl 包管理器（在开始菜单中）

在 Unix 上，使用 CPAN：`$ sudo cpan Module::Name`

在托管的 Unix 帐户上：[如何将 CPAN 模块安装到本地目录中？](https://stackoverflow.com/questions/540640/how-to-install-a-cpan-module-into-a-local-directory)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-22T22:54:07.103

如果您只是不喜欢 sendmail，另一种选择是使用[Postfix](http://www.postfix.org/)，另一个 MTA。

以下是我使用 gmail 在我的机器上设置它的说明：http: [//souptonuts.sourceforge.net/postfix_tutorial.html](http://souptonuts.sourceforge.net/postfix_tutorial.html)

如果您收到有关无法验证来自 Thawte Premium Server CA 的证书的警告，这也可能很有用。 [http://ubuntuforums.org/archive/index.php/t-894355.html](http://ubuntuforums.org/archive/index.php/t-894355.html)

# asp.net - ASP 生成的 javascript

> ID：560501
> 
> 赞同：1
> 
> 时间：2009-02-18T10:17:44.563
> 
> 标签：asp.net, javascript, comments, cdata

我想知道是否有人可以指出我正确的方向。我有一个 ASP.NET Web 应用程序。每个处理回发的页面中都有自动生成的 JavaScript 部分。有时，javascript被包围

<[CDATA[ ... ]]>

, 而在另一台机器上，它可能包含在简单的 HTML 注释中，如

> <!-- ... -->

因此，我正在寻找可能导致这种差异的答案或线索。有任何想法吗？

* * *

**回答：**

原因是 .Net 框架的版本。很难找到，因为我使用安装程序来设置所有内容，从 Web 服务器到框架和应用程序源。httpd.conf 中不是很明显的行导致使用了最新的框架。

背后的故事：MS 将 JS 生成从版本 2.0 sp1 更改为使用 CDATA。

感谢您的回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T10:21:44.087

我的猜测是，重要的不是机器，而是用户的浏览器可能不同。对于不支持 Javascript 的“下级”浏览器，Javascript 的呈现方式将有所不同。因此，JS 部分将被 HTML 注释标记所包围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T10:41:25.363

你没有说不同机器是什么意思。如果 Web 服务器使用不同的机器，那是因为 .NET 框架版本。我记得，在 .NET2.0sp1 之前没有使用 CDATA。

# objective-c - 这个复制类方法会泄漏内存吗？

> ID：560507
> 
> 赞同：2
> 
> 时间：2009-02-18T10:20:03.950
> 
> 标签：objective-c, cocoa, memory-management, memory-leaks, properties

```
- (id)copyWithZone:(NSZone *)zone {
    PoolFacility *copy = [[[self class] allocWithZone:zone]init];
    copy.name = [self.name copy];
    copy.type = [self.type copy];
    copy.phoneNumber = [self.phoneNumber copy];
    //make sure I get proper copies of my dictionaries
    copy.address = [self.address mutableCopy];  
    copy.webAddress = [self.webAddress copy];
    copy.prices = [self.prices mutableCopy];
    copy.pools = [self.pools mutableCopy];
    return copy;
} 
```

任何人都可以看到任何内存泄漏吗？

以下是属性类型：

```
NSString *name;
NSString *type;
NSMutableDictionary *address;

NSString *phoneNumber;
NSString *webAddress;   

NSMutableArray *prices;
NSMutableArray *pools; 
```

以下是属性声明：

```
@property (nonatomic, copy) NSString *name;
@property (nonatomic, copy) NSString *type;
@property (nonatomic, copy) NSString *phoneNumber;
@property (nonatomic, retain) NSMutableDictionary *address;
@property (nonatomic, copy) NSString *webAddress;
@property (nonatomic, retain) NSMutableArray *prices;
@property (nonatomic, retain) NSMutableArray *pools; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T10:37:25.217

当设置如下（您的代码）时，定义为**复制**而不**保留的属性将有一个额外的副本**

```
copy.name = [self.name copy];
copy.type = [self.type copy];
copy.phoneNumber = [self.phoneNumber copy];
copy.webAddress = [self.webAddress copy]; 
```

只将它们写为就足够了

```
copy.name = self.name;
copy.type = self.type;
copy.phoneNumber = self.phoneNumber;
copy.webAddress = self.webAddress; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T16:58:45.630

这几乎肯定会像筛子一样泄漏。您需要提供您的 @property 和其他方法声明，以便我们推荐修复它的最佳方法。

# .net - 编写 .NET 可移植代码还是利用语言特性？

> ID：560509
> 
> 赞同：0
> 
> 时间：2009-02-18T10:21:23.337
> 
> 标签：.net, language-features, portability

有时我需要将一段代码或整个项目从 VB.NET 转换为 C#，反之亦然。不幸的是，由于内在的语言差异，有时无法自动完成代码转换。例如，我指的是诸如在 C# 中可用而在 VB.NET 中不可用的关键字，或者在 VB.NET 而在 C# 中不可用的**XML** **Literals**。

 **那么我的问题是，您是否在编写 .NET 项目时考虑过源代码的可移植性，或者您是否充分利用了语言特性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T10:32:53.810

为什么要转换语言？考虑到它们远不止两种 .NET 语言，而且有些非常不同，例如 F#。

为正确的工作使用正确的语言。在 .NET 中，很多时候都是 C# 或 VB，但在其他方面（包括 C++/CLI 和 F#）有很多更容易的事情。

当然，在一个项目中甚至可以在同一个程序集中使用多种语言（尽管 VS 不直接支持）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T10:28:08.610

我总是用 C# 编写代码，我讨厌 VB 语法和冗长。我发现 C# 更精确和简洁，可能是因为我来自 C/C++ 世界。

但是，我从未遇到过将项目从语言转换为另一种语言所需的问题。不要忘记，用 C# 或 VB.NET（或其他任何东西）编写的已编译的 .NET 程序集可用于每个 .NET 项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T10:30:25.140

我永远不会考虑限制我对一种语言的使用，只是因为有一天我想把它移植到另一种语言。这会降低我的工作效率，并意味着对不太可能的未来进行投资。

对于 .NET 语言，我尤其不会这样做，因为 .NET 程序集是可互换的。

如果我事先知道我必须移植我的代码，我会直接用我需要移植到的语言编写它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T10:35:11.447

每次都充分利用。我尝试确保程序集中的公共类型保持 CLS 兼容，但仅此而已。我倾向于留在 C# 领域，但 VB 已经（或曾经）更好地支持后期绑定的 COM，并且 C++/CLI 在与非常笨拙的 c++ 库进行互操作时是必不可少的。

如果您根据语言的功能而不是语法选择语言，我认为您不太可能改变。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T10:35:54.393

我认为编写可移植的 .NET 代码没有任何意义，因为您可以将其链接起来，因此**99% 的时间移植到另一种 .NET 语言是没有意义的**。只需提取代码，使其成为 DLL 并链接它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T10:40:31.327

我尝试充分利用语言特性。所有其他事情都是愚蠢的（在我的书中）。我的工作是以最好的方式使用我的工具来完成工作。在我作为程序员的 20 年里，我没有任何需要将我的任何程序转换为另一种语言（仅从同一语言的不同版本升级）。

现在，当 C# 和 VB.Net 如此容易相互移植时，也许它会改变。我知道我经常将 C#-examples/project 转换为 VB.net，因为 C# 中有更多有趣的示例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T11:00:11.810

我充分利用了语言特定的功能。当很容易从 c# 、 f# 或其他 clr 语言调用 vb 程序集时，我真的发现在语言之间移植的能力并不是很重要。

我真的不明白为什么当你不打算使用它们给你的功能时你甚至会费心使用不同的语言。如果您只使用 VB.Net 中可用的功能，为什么要切换到 C#？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-18T11:53:36.563

在大型项目中，通常不需要支持源代码可移植性，因为组件封装了功能（重用）。您需要的一切都是程序集上的 CLSCompliant 属性。

如果您需要将一段代码从一种语言转换为另一种语言，您可以使用方案“Language1 => IL => Language2”。反射器是执行此操作的好工具。

# apache-flex - Flex 内存限制 - 如何配置

> ID：560510
> 
> 赞同：2
> 
> 时间：2009-02-18T10:21:35.177
> 
> 标签：apache-flex, memory, garbage-collection

我可以在我的 Flex 应用程序中控制内存限制（即必须运行 GC 的时间）吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T07:13:16.330

查看 flash.system.System 类。“totalMemory”属性将显示（以字节为单位）当前应用程序正在使用多少内存。调用 System.gc() 将运行 GC。您可以使用 Timer 定期检查 totalMemory，如果超过阈值则执行 gc。更多信息：

[http://livedocs.adobe.com/flex/3/langref/flash/system/System.html](http://livedocs.adobe.com/flex/3/langref/flash/system/System.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T10:29:12.850

我不是 100% 肯定，但我相信答案是否定的。阅读[这篇文章](http://www.adobe.com/devnet/flashplayer/articles/garbage_collection.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T10:30:20.757

我不这么认为。这可能是基于客户端的 flash 播放器的一个参数，我认为它还取决于客户端机器拥有的确切资源，即更多的 RAM 意味着更少的 gc 频率等。

# silverlight - 在哪里学习使用 Silverlight（或 WPF）的正确方法

> ID：560515
> 
> 赞同：0
> 
> 时间：2009-02-18T10:23:21.820
> 
> 标签：silverlight, graphics

接近 Silverlight 开发是一项相当艰巨的任务，因为我过去所做的工作似乎需要一种完全不同的心态。

我已经为此工作了几个月，我们已经发布了一个显示基于表单的页面的应用程序。所以我掌握了 XAML 布局的基础知识，但我现在需要做的是转向以图形方式表示数据。例如，将表示车辆速度记录的对象列表转换为速度线图。我不知道解决这个问题的最佳方法是什么。

谁能指出我介绍这种事情的文章或教程？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T12:04:55.633

您学习 Silverlight 的第一站应该是官方网站[http://silverlight.net/Learn/](http://silverlight.net/Learn/)

如果您想做任何数据可视化/图表，那么首先尝试 Codeplex 上的[Silverlight Toolkit](http://www.codeplex.com/Silverlight)。如果您想快速启动并运行任何东西，那就太棒了。

另请查看有关[图表和图表构建器代码的延迟博客](http://blogs.msdn.com/delay/archive/2008/12/10/great-silverlight-charts-are-still-just-a-click-away-chartbuilder-sample-and-source-code-updated-for-charting-s-december-08-release.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T10:42:46.873

用头撞它 3-6 个月。我就是这样做的，到目前为止效果很好。

但说真的，学习曲线很糟糕。

那里有 Silverlight 的图表库，你可以拿其中一个，但我不会在上面浪费钱。自己编写这种代码相对容易。

您真正需要的只是一个 DrawingVisual。一旦你有了它，你就可以在它的表面上渲染你需要的东西。诀窍是确保在渲染时有足够的布局信息。因为这是矢量图形，所以您可以使用 ScaleTransform 来匹配您的内容边界，而不是在大小更改时重新绘制。除此之外，您还想在 UIFrameworkElement 中托管您的 DrawingVisual，并让该对象的维度决定您在何处以及如何绘制数据。这将为您提供 WPF/Silverlight 的所有布局优势。

对于绘图，您可以依赖很多几何类，但您需要做一件事，那就是调整数据点相对于绘图的详细程度。这是确保您不会占用 CPU 的第一要诀。

避免每个像素绘制多个数据点。如果您有很多数据点和一个小的绘图表面，您可以使用滚动平均值来平滑结果。

如果您考虑到以上几点，您应该能够编写一个灵活的图形 UI 元素，您可以立即使用它来可视化数据。

我在一个 WPF 应用程序中做到了这一点，我几乎假设你可以用 Silverlight 2.0 做同样的事情，如果你做不到，你只会对我大喊大叫吗？

# objective-c - 使浮点数只显示两位小数

> ID：560517
> 
> 赞同：301
> 
> 时间：2009-02-18T10:25:36.137
> 
> 标签：objective-c, formatting, floating-point

我有 a 中的值`25.00`，`float`但是当我在屏幕上打印它时它是`25.0000000`.
如何仅显示两位小数的值？

* * *

## 回答 #1

> 赞同：660
> 
> 时间：2009-02-18T10:30:00.650

这不是数字如何存储的问题，而是您如何显示它的问题。将其转换为字符串时，您必须四舍五入到所需的精度，在您的情况下是两位小数。

例如：

```
NSString* formattedNumber = [NSString stringWithFormat:@"%.02f", myFloat]; 
```

`%.02f`告诉格式化程序您将格式化一个浮点数 ( `%f`)，并且应该四舍五入到两个位置，并且应该用`0`s 填充。

例如：

```
%f = 25.000000
%.f = 25
%.02f = 25.00 
```

* * *

## 回答 #2

> 赞同：200
> 
> 时间：2011-06-30T07:50:24.553

这里有一些更正-

```
//for 3145.559706 
```

* * *

**斯威夫特 3**

```
let num: CGFloat = 3145.559706
print(String(format: "%f", num)) = 3145.559706
print(String(format: "%.f", num)) = 3145
print(String(format: "%.1f", num)) = 3145.6
print(String(format: "%.2f", num)) = 3145.56
print(String(format: "%.02f", num)) = 3145.56 // which is equal to @"%.2f"
print(String(format: "%.3f", num)) = 3145.560
print(String(format: "%.03f", num)) = 3145.560 // which is equal to @"%.3f" 
```

* * *

**对象-C**

```
@"%f"    = 3145.559706
@"%.f"   = 3146
@"%.1f"  = 3145.6
@"%.2f"  = 3145.56
@"%.02f" = 3145.56 // which is equal to @"%.2f"
@"%.3f"  = 3145.560
@"%.03f" = 3145.560 // which is equal to @"%.3f" 
```

等等...

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-08-22T17:54:00.527

您也可以尝试使用 NSNumberFormatter：

```
NSNumberFormatter* nf = [[[NSNumberFormatter alloc] init] autorelease];
nf.positiveFormat = @"0.##";
NSString* s = [nf stringFromNumber: [NSNumber numberWithFloat: myFloat]]; 
```

您可能还需要设置否定格式，但我认为它足够聪明，可以弄清楚。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-11-05T10:20:18.513

我根据上述答案进行了快速扩展

```
extension Float {
    func round(decimalPlace:Int)->Float{
        let format = NSString(format: "%%.%if", decimalPlace)
        let string = NSString(format: format, self)
        return Float(atof(string.UTF8String))
    }
} 
```

用法：

```
let floatOne:Float = 3.1415926
let floatTwo:Float = 3.1425934
print(floatOne.round(2) == floatTwo.round(2))
// should be true 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-06-20T18:29:24.350

在 Swift 语言中，如果你想展示你需要以这种方式使用它。在 UITextView 中分配 double 值，例如：

```
let result = 23.954893
resultTextView.text = NSString(format:"%.2f", result) 
```

如果你想像 Objective-c 使用 NSLog() 那样在 LOG 中显示，那么在 Swift 语言中你可以这样做：

```
println(NSString(format:"%.2f", result)) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-18T10:48:33.850

在 objective-c 中，如果您正在处理常规 char 数组（而不是指向 NSString 的指针），您还可以使用：

```
printf("%.02f", your_float_var); 
```

OTOH，如果您想要将该值存储在 char 数组中，您可以使用：

```
sprintf(your_char_ptr, "%.02f", your_float_var); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-09-13T16:15:46.560

所有答案的问题在于，乘法然后除法会导致精度问题，因为您使用了除法。我很久以前从 PDP8 上的编程中学到了这一点。解决这个问题的方法是：

```
return roundf(number * 100) * .01; 
```

因此 15.6578 只返回 15.66 而不是 15.6578999 或类似的东西。

您想要什么级别的精度取决于您。只是不要将产品除以乘以十进制等值。不需要有趣的字符串转换。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-07-13T04:51:02.860

在目标 -c 中，您想以 2 个十进制数显示浮点值，然后传递指示您要显示多少个小数点的参数，例如 0.02f 将打印 25.00 0.002f 将打印 25.000

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-02-20T22:33:32.093

以下是一些根据精度动态格式化的方法：

```
+ (NSNumber *)numberFromString:(NSString *)string
{
    if (string.length) {
        NSNumberFormatter * f = [[NSNumberFormatter alloc] init];
        f.numberStyle = NSNumberFormatterDecimalStyle;
        return [f numberFromString:string];
    } else {
        return nil;
    }
}

+ (NSString *)stringByFormattingString:(NSString *)string toPrecision:(NSInteger)precision
{
    NSNumber *numberValue = [self numberFromString:string];

    if (numberValue) {
        NSString *formatString = [NSString stringWithFormat:@"%%.%ldf", (long)precision];
        return [NSString stringWithFormat:formatString, numberValue.floatValue];
    } else {
        /* return original string */
        return string;
    }
} 
```

例如

```
[TSPAppDelegate stringByFormattingString:@"2.346324" toPrecision:4]; 
```

=> 2.3453

```
[TSPAppDelegate stringByFormattingString:@"2.346324" toPrecision:0]; 
```

=> 2

```
[TSPAppDelegate stringByFormattingString:@"2.346324" toPrecision:2]; 
```

=> 2.35（向上取整）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-01-31T13:10:13.657

***Swift***的另一种方法（不使用 NSString）：

```
let percentage = 33.3333
let text = String.localizedStringWithFormat("%.02f %@", percentage, "%") 
```

PS此解决方案不适用于仅使用&测试的*CGFloat*类型`Float``Double`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-09-11T08:29:34.273

使用`NSNumberFormatter`如下`maximumFractionDigits`：

```
NSNumberFormatter *formatter = [[NSNumberFormatter alloc] init];
formatter.maximumFractionDigits = 2;
NSLog(@"%@", [formatter stringFromNumber:[NSNumber numberWithFloat:12.345]]); 
```

你会得到`12.35`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-11-10T19:02:17.807

如果您还需要浮动值：

```
NSString* formattedNumber = [NSString stringWithFormat:@"%.02f", myFloat];
float floatTwoDecimalDigits = atof([formattedNumber UTF8String]); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-04-03T06:38:46.980

```
 lblMeter.text=[NSString stringWithFormat:@"%.02f",[[dic objectForKey:@"distance"] floatValue]]; 
```

# testing - 你如何组织/布局你的测试脚本

> ID：560528
> 
> 赞同：8
> 
> 时间：2009-02-18T10:30:26.530
> 
> 标签：testing, manual-testing

我对其他人如何组织他们的测试脚本很感兴趣，或者在他们工作过的任何地方都看到过很好的测试脚本。此外，这些测试脚本的详细程度如何。这特别涉及为手动测试创建的测试脚本，而不是为任何自动化测试目的创建的测试脚本。

我看到的问题是，测试脚本有很多复杂性，但没有受益于组织复杂或大型代码库所使用的原则。您需要能够指定一段代码应该做什么，但又不会让某人在阅读它时感到无聊至死。

此外，您如何布局测试脚本，我不热衷于创建适合由数据输入类型运行的完全指定的脚本，因为这不是我们拥有的团队并且维护它们的开销似乎太高了。此外，在我看来，如此详细地指定流程可以免除实际进行产品质量测试的人的责任。人们是否指定每个按钮单击和要输入的值？如果不是，则指定详细程度。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T20:11:20.643

由人类执行的测试应该处于非常高的抽象级别。

例如 stackoverflow 注册的测试用例：

好的：

> 具有现有 OpenId 帐户的站点访问者注册为 stackoverflow 用户并发布答案。

坏的：

> 1) 导航到 [http://stackoverflow.com](http://stackoverflow.com) 2) 点击登录链接 3) 等等...

这很重要，原因如下：

a) 它使测试保持可维护性。因此，您不必在每次重新标记导航元素时都更新您的测试脚本（例如，“登录”更改为“登录”）。

b) 它使您的测试人员免于因繁琐的细节而发疯。

c) 编写详细的手动测试脚本是对有限测试资源的不良使用。
详细的手动测试脚本将转移您的测试人员为较小的文档问题编写错误。您想利用您的时间来找出会影响客户的真正错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T05:21:43.410

测试可以按优先级分组。BVT/烟雾测试可能具有最高优先级，而功能、集成、回归、本地化、压力和性能具有较低优先级。根据您的测试通过，您将选择一个优先级并运行具有该优先级或更高优先级的所有测试。您需要做的就是确定特定测试的优先级。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T17:48:06.027

我尝试让手动测试适应自动化结构——你可以两者兼得。

自动化测试使用的组织方案（例如，xUnit 框架）对我有用。事实上，它们可用于半自动化测试，方法是停止并调用手动测试运行，或输入输入，或检查 GUI。该方案通常是镜像生产代码的目录结构，或者将测试包含在生产代码中，有时作为内部类。单元级别以上的测试通常可以放入更高级别的目录中（假设您有足够深的目录树）。这些更高级别的测试可以进入（镜像）没有生产代码但出于组织目的的目录。

详细程度——嗯，这取决于，对吧？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-06T00:48:17.203

在一般情况下，马特安德森提供了很好的答案，但在某些情况下，你不能那样做。例如，当您处理经过验证的应用程序时，它必须符合 FDA 等其他方的法规，并且它经过非常密集的审核、审查、签字，而不是您的示例需要 2 个答案。尽管在这种情况下我会选择使用 HP QuickTestPro 或 IBM RationaRobot 实现自动化。

Maybe you should try with some tests repository? There are again tools from HP QualityCenter and IBM products, but this can expensive. You could find some cheaper, that will let you organize them into tree structures, by requirement/feature, assign them priorities, group them into test suits for releases, group them into regression testing suits etc...

# lucene - Lucene boost：我需要让它更好地工作

> ID：560531
> 
> 赞同：2
> 
> 时间：2009-02-18T10:31:51.253
> 
> 标签：lucene

我正在使用 Lucene 来索引具有名称和类型的组件。一些组件更重要，因此得到更大的提升。但是，我无法让我的提升正常工作。我会得到一些组件稍后出现（得分更差），即使它们有更高的提升。

请注意，索引仅在一个字段上完成，并且我仅将提升设置为该字段。我在 Java 中使用 Lucene。

我认为这与字段长度无关。我见过同名（但类型不同）的组件得分错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T06:14:14.937

Use [Searcher.explain](http://lucene.apache.org/java/2_2_0/api/org/apache/lucene/search/Searcher.html#explain(org.apache.lucene.search.Query,%20int)) to find out how the scores for each document are derived. One of the key criteria in score is length of the field. A match in shorter field gets higher score.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T19:37:28.397

我建议您使用[luke](http://www.getopt.org/luke/)来准确查看索引中存储的内容。你在使用文档提升吗？请参阅[评分文档](http://lucene.apache.org/java/2_4_0/scoring.html)以检查可能的解释。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T18:22:24.990

确保在要提升的字段上将 field.omitNorms 设置为 false。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T12:23:52.653

Boost 只是 Lucene 得分中的一个因素。但它应该工作。你能给出一个更完整的例子来说明你所看到的行为，以及你的期望吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T15:37:42.297

我记得，提升旨在使一个领域比另一个领域更重要。如果您只有一个字段，则提升根本不会改变结果的顺序。

补充说：不，看起来您确实可以提升特定文档。哎呀！

# xcode - 安装 IB 插件

> ID：560542
> 
> 赞同：1
> 
> 时间：2009-02-18T10:36:27.530
> 
> 标签：xcode, plugins, interface-builder

我已经创建了 IB 工具包插件，现在我想在其他 Xcode 项目中使用该插件

怎么做？我已经尝试过开发人员指南，但无法完成..请回答

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T11:29:03.437

首先，我假设您希望您的插件嵌入到您的应用程序包中。如果没有，您可以将 IBPlug-in 框架放置在标准位置，例如`/Library/Frameworks`.

## 创建插件

一旦您使用 Apple 的模板在 XCode 中创建了 IBPlugin 项目，您需要进行一些调整：

*   更改框架目标的名称，使其不同于插件的名称。例如，您可以将其称为 MyIBPluginFramework。
*   在 Target Properties > Build 中：将 MyIBPluginFramework 的安装目录修改为`@loader_path/../Frameworks`.
*   还将其动态库安装名称设置为`@executable_path/../Frameworks/$(CONTENTS_FOLDER_PATH)/$(PRODUCT_NAME)`.
*   将 MyIBPlugin 的安装目录设置为`@loader_path/../Frameworks/Resources`.

（构建时，插件放置在框架的 Resources 目录中）。

此时，它应该可以在 Interface Builder**和**IBCocoaSimulator 中工作。

## 嵌入应用程序

将 IBPluginFramework.framework 文件夹拖到`Linked Frameworks`应用程序项目的组中。编辑您的应用程序目标：将路径附加到框架搜索路径`@loader_path/../Frameworks/MyIBPluginFramework/Resources`。

您现在可以链接框架和插件，但是在构建时必须将框架复制到应用程序的 Frameworks 目录中。向您的目标添加一个`Copy Files`阶段，然后将框架拖入其中。

我不能保证成功（我成功地完成了我的工作，但可能忘记在这里说明一个步骤），但你已经知道了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T11:37:25.880

我认为通常您将插件放入根目录或用户级别的库文件夹中的应用程序特定文件夹中，例如

/库/界面生成器 3.0/

在我的系统上，我在名为“Library”的文件夹下有另一个文件夹，在名为“User Objects”的文件夹下是空的。

所以我会尝试将它依次放入每个文件夹中，每次都重新启动 XCode 和 Interface Builder（只是为了确定）

*   /库/界面生成器 3.0/
*   /库/界面生成器 3.0/库
*   /Library/Interface Builder 3.0/Library/用户对象

希望有帮助。

# jquery - 切换动画隐藏显示按钮 jquery

> ID：560543
> 
> 赞同：-1
> 
> 时间：2009-02-18T10:36:30.260
> 
> 标签：jquery, animation, hide, show

内容隐藏如何在 jQuery 中与动画一起显示？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T10:40:53.867

转到[jquery.com](http://jquery.com)并查看第一页上的示例！

# c# - 在 C# 中防止错误使用支持字段的最佳方法

> ID：560549
> 
> 赞同：4
> 
> 时间：2009-02-18T10:38:51.737
> 
> 标签：c#, design-guidelines

我有一个类（Foo），它延迟加载一个名为（Bar）的属性。防止未初始化的支持字段被错误使用（由于智能感知或缺乏经验的工作人员）的首选方法是什么？

我可以想到3个选项：

```
 class Foo {
    // option 1 - Easy to use this.bar by mistake. 
    string bar;
    string Bar {
        get {
            // logic to lazy load bar  
            return bar; 
        }
    }

    // option 2 - Harder to use this._bar by mistake. It is more obscure.
    string _bar2;
    string Bar2 {
        get {
            // logic to lazy load bar2  
            return _bar2;
        }
    }

    //option 3 - Very hard to use the backing field by mistake. 
    class BackingFields {
        public string bar; 
    }

    BackingFields fields = new BackingFields();

    string Bar3 {
        get {
            // logic to lazy load bar  
            return fields.bar;
        }
    }

} 
```

请记住，我希望人们使用支持字段栏的唯一地方是属性的 setter 和 getter。在课堂上的其他任何地方，他们都应该始终使用 this.Bar

**更新**

我目前正在使用[以下延迟实现](http://code.google.com/p/videobrowser/source/browse/branches/big_refactor/MediaBrowser/Library/Util/Lazy.cs)（不是针对所有具有支持字段的属性，而是针对需要延迟加载、同步和通知的选定属性）。它也可以扩展到支持期货（稍后在单独的线程中强制评估）

**注意**我的实现在读取时锁定，因为它支持外部集。

另外，我想提一下，我认为这是一个可以在[Ruby 中](http://innig.net/software/ruby/closures-in-ruby.rb)克服的语言限制。

您可以通过这种方式[实现惰性](http://moonbase.rydia.net/software/lazy.rb/0.9.5/doc/)。

```
x = lazy do
    puts "<<< Evaluating lazy value >>>"
    "lazy value"
end

puts x
# <<< Evaluating lazy value >>>
# lazy value 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T10:59:45.103

怎么样使用`ObsoleteAttribute`和`#pragma`- 那就很难错过它！

```
 void Test1()
    {
        _prop = ""; // warning given
    }
    public string Prop
    {
#pragma warning disable 0618
        get { return _prop; }
        set { _prop = value; }
#pragma warning restore 0618
    }
    [Obsolete("This is the backing field for lazy data; do not use!!")]
    private string _prop;
    void Test2()
    {
        _prop = ""; // warning given
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T10:58:41.907

选项 5

[`Lazy<T>`](http://msdn.microsoft.com/en-us/vcsharp/bb870976.aspx)

在几种情况下都可以很好地工作，但只要开发人员不是白痴，选项 1 对于大多数项目来说应该真的很好。

如果字段是私有的，则将 [EditorBrowsable(EditorBrowsableState.Never)] 添加到该字段将无济于事，因为此逻辑仅适用于从元数据而不是当前代码（当前项目以及通过项目引用而不是 dll 完成的任何操作）生成的智能感知。

注意：`Lazy<T>`不是线程安全的（这很好，如果您不需要，则没有必要锁定）如果您需要线程安全，请使用[Joe Duffy 的线程安全](http://www.bluebytesoftware.com/blog/2007/06/09/ALazyInitializationPrimitiveForNET.aspx)之一或[并行扩展 CTP](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T10:48:30.497

我通常选择选项 2，因为以后更容易发现错误，尽管选项 1 会通过代码审查。选项 3 似乎令人费解，虽然它可能有效，但在尝试重构/修复错误/等时重新审视 6 个月的代码并不是很好的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T10:43:18.120

选项1，加上一些教育。

基本原理：软件的阅读频率高于编写频率，因此针对常见情况进行优化并保持其可读性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T10:59:41.560

代码审查会发现误用，所以请选择最易读的。我不喜欢在代码中绕过糟糕的程序员，因为 1）他们不工作，2）他们让聪明的程序员更难完成他们的工作，以及 3）它解决了问题的症状而不是原因。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T10:42:21.493

我通常只选择选项 1。因为它是一个私有字段，我认为这不是一个真正的问题，并且在选项 3 中使用类似包装类的东西只会使代码难以阅读和理解。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T21:01:13.913

我会在类的顶部放一个大的注释块，看起来像这样：

```
/************************************************************
* Note: When updating this class, please take care of using *
*       only the accessors to access member data because of *
*       ... (state the reasons / your name, so they can ask *
*       questions)                                          *
*************************************************************/ 
```

通常，只需这样的注释就足够了，但如果项目中的所有类都相同，您可能更愿意将其放在一个简单的文档中，该文档可以提供给从事该项目的程序员，并且每次看到代码时这不符合，您将它们指向文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T10:47:07.910

```
// option 4
class Foo
{
    public int PublicProperty { get; set; }
    public int PrivateSetter { get; private set; }
} 
```

C# 3.0 的特性，编译器会生成匿名的私有支持字段，这些字段不能被错误访问，除非你使用反射......

### 编辑：延迟实例化

你可以有这样的懒惰：

```
// I changed this with respect to ShuggyCoUk's answer (Kudos!)
class LazyEval<T>
{
  T value;
  Func<T> eval;
  public LazyEval(Func<T> eval) { this.eval = eval; }
  public T Eval()
  {
      if (eval == null)
          return value;
      value = eval();
      eval = null;
      return value;
  }
  public static implicit operator T(LazyEval<T> lazy) // maybe explicit
  {
    return lazy.Eval();
  }
  public static implicit operator LazyEval<T>(Func<T> eval) 
  {
    return new LazyEval(eval);
  } 
} 
```

那些隐式转换使语法整洁......

```
// option 5
class Foo
{
    public LazyEval<MyClass> LazyProperty { get; private set; }
    public Foo()
    {
        LazyProperty = () => new MyClass();
    }
} 
```

闭包可用于承载范围：

```
// option 5
class Foo
{
    public int PublicProperty { get; private set; }
    public LazyEval<int> LazyProperty { get; private set; }
    public Foo()
    {
        LazyProperty = () => this.PublicProperty;
    }
    public void DoStuff()
    {
        var lazy = LazyProperty; // type is inferred as LazyEval`1, no eval
        PublicProperty = 7;
        int i = lazy; // same as lazy.Eval()
        Console.WriteLine(i); // WriteLine(7)
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-18T10:54:02.760

自动属性：

```
public int PropertyName { get; set; } 
```

将阻止访问支持字段。但是如果你想把代码放在那里（例如第一次访问时延迟加载），这显然无济于事。

最简单的路线可能是一个辅助类型，它执行延迟加载，并具有该类型的私有字段，公共属性调用辅助类型的正确属性/方法。

例如

```
public class Foo {
  private class LazyLoader {
    private someType theValue;
    public someType Value {
      get {
        // Do lazy load
        return theValue;
      }
    }
  }

  private LazyLoader theValue;
  public someType {
    get { return theValue.Value; }
  }
} 
```

这样做的好处是支持字段比属性更难使用。

（另一种解决问题的额外间接级别的情况。）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-17T13:34:13.797

目前，我处于类似的情况。我有一个只能由其属性访问器使用的字段。
我不能使用自动属性，因为我需要在设置属性时执行额外的逻辑。（该属性也不是延迟加载的）。

如果 C# 的下一个版本允许这样的事情，那不是很好吗：

```
public class MyClass
{
    public int MyProperty
    {
        int _backingField;

        get
        {
            return _backingField;
        }
        set
        {
            if( _backingField != value )
            {
                _backingField = value;
                // Additional logic
                ...
            }
        }
    }
} 
```

使用这种构造，`_backingField`变量的范围仅限于属性。我希望在下一个 C# 版本中看到类似的语言结构：)

但是，恐怕这个功能永远不会实现： [http ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=381625](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=381625)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-17T13:50:41.947

这可能过于简单，但为什么不将所有惰性抽象为基类

```
 public class LazyFoo{
      private string bar;
      public string Bar{
         get{
             // lazy load and return
         }
         set {
             // set
         }
      }
    }

    public class Foo : LazyFoo{
      // only access the public properties here
    } 
```

我可以看到它是不必要的抽象的论点，但这是我能看到的消除对支持字段的所有访问的最简单方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-17T13:56:05.007

这似乎是在试图设计出一开始可能不会发生的错误，而且基本上是在担心错误的事情。

我会选择选项 1 + 评论：

```
///<summary>use Bar property instead</summary> 
string bar;

///<summary>Lazy gets the value of Bar and stores it in bar</summary>
string Bar {
    get {
        // logic to lazy load bar  
        return bar; 
    }
} 
```

如果您确实找到了一个继续使用支持变量的开发人员，那么我会担心他们的技术能力。

无论如何设计使您的代码更易于维护，但尽量保持简单 - 您在这里为自己制定的任何规则都将比它的价值更麻烦。

如果您仍然非常担心它，请创建一个 FxCop（或您正在使用的任何东西）规则来检查此类事情。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-02-22T20:09:23.847

选项 6：

如果你使用它，它确实非常愚蠢。

```
string doNotUseThisBackingField_bar6;
string Bar6 {
   get {
      // logic to lazy load
      return doNotUseThisBackingField_bar6;
   }
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-02-18T10:49:30.743

**选项 4（新解决方案）**：

看看问题是否真的是关于如何防止人们使用未初始化的变量，然后使用 KNOWN INVALID 值对其进行初始化。

我会说这样的话：

```
string str = "SOMETHING_WRONG_HERE"; 
```

曾经使用“str”的人会收到某种警告。

否则选项 3 如果阻止用户使用“str”比可读性等更重要。

# sharepoint - 使用 SPQuery 检索不同/唯一值的最佳方法是什么？

> ID：560550
> 
> 赞同：15
> 
> 时间：2009-02-18T10:39:17.803
> 
> 标签：sharepoint, caml, spquery

我有一个看起来像的列表：

```
Movie          Year
-----          ----
Fight Club     1999
The Matrix     1999
Pulp Fiction   1994 
```

使用 CAML 和 SPQuery 对象，我需要从 Year 列中获取不同的项目列表，该列表将填充下拉控件。

在 CAML 查询中搜索似乎不是一种方法。我想知道人们是如何实现这一目标的？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-18T16:35:07.183

另一种方法是使用 DataView.ToTable-Method - 它的第一个参数是使列表不同的参数。

```
 SPList movies = SPContext.Current.Web.Lists["Movies"];
            SPQuery query = new SPQuery();
            query.Query = "<OrderBy><FieldRef Name='Year' /></OrderBy>";

            DataTable tempTbl = movies.GetItems(query).GetDataTable();
            DataView v = new DataView(tempTbl);
            String[] columns = {"Year"};
            DataTable tbl = v.ToTable(true, columns); 
```

然后，您可以继续使用 DataTable tbl。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-29T10:25:15.357

如果您想将不同的结果绑定到例如 Repeater 的 DataSource 并通过 ItemDataBound 事件的 e.Item.DataItem 方法保留实际项目，则 DataTable 方式将不起作用。相反，除了不想将其绑定到 DataSource 时，您还可以使用 Linq 来定义不同的值。

```
// Retrieve the list. NEVER use the Web.Lists["Movies"] option as in the other examples as this will enumerate every list in your SPWeb and may cause serious performance issues
var list = SPContext.Current.Web.Lists.TryGetList("Movies");

// Make sure the list was successfully retrieved
if(list == null) return;

// Retrieve all items in the list
var items = list.GetItems();

// Filter the items in the results to only retain distinct items in an 2D array
var distinctItems = (from SPListItem item in items select item["Year"]).Distinct().ToArray()

// Bind results to the repeater
Repeater.DataSource = distinctItems;
Repeater.DataBind(); 
```

请记住，由于 CAML 不支持不同的查询，因此此页面上提供的每个示例都将从 SPList 中检索所有项目。这对于较小的列表可能很好，但对于具有数千个列表项的列表，这将严重影响性能。不幸的是，没有更优化的方法可以达到同样的效果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T11:05:40.313

CAML 中没有 DISTINCT 来填充您的下拉列表，请尝试使用以下内容：

```
foreach (SPListItem listItem in listItems)
    {
        if ( null == ddlYear.Items.FindByText(listItem["Year"].ToString()) )
       {
                   ListItem ThisItem = new ListItem();
                   ThisItem.Text = listItem["Year"].ToString();
                   ThisItem.Value = listItem["Year"].ToString();
                   ddlYear.Items.Add(ThisItem);
        }
   } 
```

假设您的下拉列表称为 ddlYear。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T16:29:08.803

您可以从 SPQuery 切换到 SPSiteDataQuery 吗？你应该可以，没有任何问题。

之后，您可以使用标准的 ado.net 行为：

```
SPSiteDataQuery query = new SPSiteDataQuery();
/// ... populate your query here. Make sure you add Year to the ViewFields.

DataTable table = SPContext.Current.Web.GetSiteData(query);

//create a new dataview for our table
DataView view = new DataView(table);

//and finally create a new datatable with unique values on the columns specified

DataTable tableUnique = view.ToTable(true, "Year"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-08-30T20:17:38.930

在一次又一次地遇到关于这是不可能的帖子之后，我终于找到了一种方法。这已在 SharePoint Online 中进行了测试。这是一个可以为您获取列的所有唯一值的函数。它只需要您传入列表 ID、视图 ID、内部列表名称和回调函数。

```
function getUniqueColumnValues(listid, viewid, column,  _callback){
var uniqueVals = [];
$.ajax({
    url: _spPageContextInfo.webAbsoluteUrl + "/_layouts/15/filter.aspx?ListId={" + listid + "}&FieldInternalName=" + column + "&ViewId={" + viewid + "}&FilterOnly=1&Filter=1",
    method: "GET",
    headers: { "Accept": "application/json; odata=verbose" }
    }).then(function(response) {
        $(response).find('OPTION').each(function(a,b){
            if ($(b)[0].value) {
                uniqueVals.push($(b)[0].value);
            }
        });
        _callback(true,uniqueVals);
},function(){
    _callback(false,"Error retrieving unique column values");
}); 
```

}

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-23T21:08:01.050

我今天早些时候正在考虑这个问题，我能想到的最佳解决方案使用以下算法（抱歉，目前没有代码）：

```
L is a list of known values (starts populated with the static Choice options when querying fill-in options, for example)
X is approximately the number of possible options

1\. Create a query that excludes the items in L
1\. Use the query to fetch X items from list (ordered as randomly as possible)
2\. Add unique items to L
3\. Repeat 1 - 3 until number of fetched items < X 
```

这将显着减少返回的项目总数，但代价是进行更多查询。

X 是否完全准确并不重要，但随机性非常重要。本质上，第一个查询可能包含最常见的选项，因此第二个查询将排除这些选项，并可能包含下一个最常见的选项，依此类推。

在最好的情况下，第一个查询包含所有选项，那么第二个查询将为空。（共检索 X 项，超过 2 个查询）

在最坏的情况下（例如，查询是按我们正在寻找的选项排序的，并且每个选项有超过 X 项），我们将进行与选项一样多的查询。总共返回大约 X * X 个项目。

# apache-flex - 在 Flex 中显示视频

> ID：560551
> 
> 赞同：1
> 
> 时间：2009-02-18T10:39:42.670
> 
> 标签：apache-flex

我是 FLEX 的新手，我打算在网页上显示视频。我的 mxml 代码如下

```
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="horizontal">
     <mx:Array id="movieList">
        <mx:String>http://localhost/Flex/Butterfly.flv</mx:String>
     </mx:Array>
     <mx:VBox>
        <mx:List id="cntlMovie" dataProvider="{movieList}" width="300" />
        <mx:Button label="Pause" click="cntlDisp.pause();" />
        <mx:Button label="Play" click="cntlDisp.play();" />
     </mx:VBox>
    <mx:VideoDisplay id="cntlDisp" source="{cntlMovie.selectedItem.valueOf()}"
      width="400" height="300" />
</mx:Application> 
```

我正在运行 Apache2.2.11 服务器。当我运行上面的代码时，浏览器只是挂起（不响应）。直接访问视频url（[http://localhost/Flex/Butterfly.flv](http://localhost/Flex/Butterfly.flv)）时，提示下载视频文件。

有人可以提供一些帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:57:55.793

安装[Charles](http://www.charlesproxy.com/)并监控请求（您可能需要使用您的计算机名称而不是 localhost）。请求是否通过服务器？什么是响应状态码？

# java - 阻止 EntityResolver 在 maven2 构建中使用互联网？

> ID：560565
> 
> 赞同：1
> 
> 时间：2009-02-18T10:44:08.133
> 
> 标签：java, maven-2

我们的构建是在 jdk 1.5 上运行 surefire 的标准 maven2 构建。我*知道*一些测试正在连接到 Internet 以解析模式/dtds，因为它们在 Internet 连接断开时会使用很长时间。我该如何阻止这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T10:45:16.567

连接是由您的测试在解析一些 XML 时完成的，而不是由 Maven 本身完成的。要检查只是在 Maven 之外启动它们，即在 Eclipse 中。

如果您可以控制您解析的文件，并且这是可以接受的，或者只是作为快速检查，您可以从您的 XML 中删除定义（一个肮脏的 hack）。然而，更好的方法是通过 CatalogManager.properties 文件配置 CatalogManager，您可以在其中指定自定义 XML 目录，ei 指向本地资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T16:53:44.593

您应该在离线模式下运行它。这是命令行上的 -o 。

否则，您可以在本地镜像远程存储库，并将本地存储库添加到您的`settings.xml`

```
<project>
  ...
  <repositories>
    <repository>
      <id>my-internal-site</id>
      <url>http://myserver/repo</url>
    </repository>
  </repositories>
  ...
</project> 
```

编辑：我可能在这里回答错误的问题，所以请澄清。

# parent-child - 挂起子进程

> ID：560569
> 
> 赞同：1
> 
> 时间：2009-02-18T10:47:23.180
> 
> 标签：parent-child, unix

我正在尝试测试我的系统并希望模拟子进程挂起的情况。为此，我试图将子进程附加到 GDB 并对其进行中断。但事情似乎并不像预期的那样发展。

此外，同样，我怎么知道生成的子进程没有进行，而是挂起？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T11:06:07.303

使用可以使用 SIGSTOP 挂起子进程 - 但这与子进程进入无限循环或糟糕的条件等待明显不同 - 仍然可能足够接近测试。

要检查子进程是否挂起，您可以让它向父进程发送心跳（为此您需要某种通信通道 - 至少可能是标准输入/标准输出）。如果它未能发送几个心跳消息，那么这个孩子就会挂起。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T04:21:14.863

子进程将继承在 fork 之前创建的任何管道。您可以使用它来“挂”您的孩子并让它知道何时继续。您可以让您的子进程尝试在管道上进行阻塞读取，它会阻塞（即挂起）直到父进程写入某些内容。

你也可以使用道格拉斯提到的信号。你可以让操作系统做基本的停止/继续，或者你可以实现信号处理程序来做一些更复杂的事情（比如进入一个无限循环）。

可以在[Unix Programming FAQ](http://www.faqs.org/faqs/unix-faq/programmer/faq/)中找到这两个示例，以及有关进程控制、信号处理、管道等的大量附加信息......

您可以尝试查看 /proc 以确定您是否挂起。你可以阅读 /proc/<child-pid>/stat 来获取很多低级进程信息，包括当前状态、进程已调度的用户/内核时间量、当前堆栈和指令指针等。 .. 结合使用，您可以尝试确定进程是否挂起。查看[proc(5)](http://linux.die.net/man/5/proc)手册页以获取有关 /proc/<pid>/stat 的更多信息。

# asp.net-mvc - ASP.NET MVC 如何将 JSON 对象作为参数从 View 传递到 Controller

> ID：560575
> 
> 赞同：54
> 
> 时间：2009-02-18T10:49:07.310
> 
> 标签：asp.net-mvc, json

我有一个复杂的 JSON 对象，它可以毫无问题地发送到视图（如下所示），但是当它通过 AJAX 调用传递回控制器时，我无法弄清楚如何将这些数据序列化回 .NET 对象。各个部分的详细信息如下。

```
 var ObjectA = {
        "Name": 1,
        "Starting": new Date(1221644506800),

        "Timeline": [
            {
                "StartTime": new Date(1221644506800),
                "GoesFor": 200

            }
            ,
            {
                "StartTime": new Date(1221644506800),
                "GoesFor": 100

            }

        ]
    }; 
```

我不确定如何将这个对象传递给控制器​​方法，我在下面有这个方法，其中 Timelines 对象使用属性镜像上述 JS 对象。

```
public JsonResult Save(Timelines person) 
```

我正在使用的 jQuery 是：

```
 var encoded = $.toJSON(SessionSchedule);

        $.ajax({
            url: "/Timeline/Save",
            type: "POST",
            dataType: 'json',
            data: encoded,
            contentType: "application/json; charset=utf-8",
            beforeSend: function() { $("#saveStatus").html("Saving").show(); },
            success: function(result) {
                alert(result.Result);
                $("#saveStatus").html(result.Result).show();
            }
        }); 
```

我已经看到了这个问题，它与我没有使用表单来操作数据很相似，但并不完全相同。 [如何使用 json 将复杂类型传递给 ASP.NET MVC 控制器](https://stackoverflow.com/questions/267707/how-to-pass-complex-type-using-json-to-asp-net-mvc-controller)

我还看到了对使用“JsonFilter”手动反序列化 JSON 的引用，但想知道是否有办法通过 ASP.NET MVC 原生地做到这一点？或者以这种方式传递数据的最佳实践是什么？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-03-04T10:54:25.390

**编辑：**

随着 MVC 3 的到来，不再需要此方法，因为它将自动处理 - [http://weblogs.asp.net/scottgu/archive/2010/07/27/introducing-asp-net-mvc-3 -preview-1.aspx](http://weblogs.asp.net/scottgu/archive/2010/07/27/introducing-asp-net-mvc-3-preview-1.aspx)

* * *

您可以使用此 ObjectFilter：

```
 public class ObjectFilter : ActionFilterAttribute {

    public string Param { get; set; }
    public Type RootType { get; set; }

    public override void OnActionExecuting(ActionExecutingContext filterContext) {
        if ((filterContext.HttpContext.Request.ContentType ?? string.Empty).Contains("application/json")) {
            object o =
            new DataContractJsonSerializer(RootType).ReadObject(filterContext.HttpContext.Request.InputStream);
            filterContext.ActionParameters[Param] = o;
        }

    }
} 
```

然后，您可以将其应用于您的控制器方法，如下所示：

```
 [ObjectFilter(Param = "postdata", RootType = typeof(ObjectToSerializeTo))]
    public JsonResult ControllerMethod(ObjectToSerializeTo postdata) { ... } 
```

所以基本上，如果帖子的内容类型是“application/json”，这将立即生效，并将值映射到您指定类型的对象。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T13:33:14.670

你说“我没有使用表单来操作数据”。但是你正在做一个 POST。因此，您实际上是在使用一个表单，即使它是空的。

$.ajax 的[dataType](http://docs.jquery.com/Ajax/jQuery.ajax#options)告诉 jQuery 服务器将*返回*什么类型，而不是您传递的内容。POST 只能传递一个表单。jQuery[会将数据转换为键/值对](http://docs.jquery.com/Ajax/jQuery.ajax#options)并将其作为查询字符串传递。从文档：

> 要发送到服务器的数据。如果还不是字符串，则将其转换为查询字符串。它附加到 GET 请求的 url。请参阅 processData 选项以防止此自动处理。对象必须是键/值对。如果 value 是一个数组，jQuery 使用相同的键序列化多个值，即 {foo:["bar1", "bar2"]} 变为 '&foo=bar1&foo=bar2'。

所以：

1.  您没有将 JSON 传递给服务器。您将 JSON 传递给 jQuery。
2.  模型绑定的发生方式与在任何其他情况下发生的方式相同。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-04-07T06:52:06.380

## 一个简单的 jQuery 插件带来不同的体验

尽管这个问题的答案早就应该得到了，但我仍然发布了一个很好的解决方案，这是我前段时间带来的，它使得**将复杂的 JSON 发送到 Asp.net MVC**控制器操作变得非常简单，因此它们是模型绑定到任何强大的类型参数。

该插件也**支持日期**，因此它们可以`DateTime`毫无问题地转换为对应的日期。

[您可以在我的博客文章](http://erraticdev.blogspot.com/2010/12/sending-complex-json-objects-to-aspnet.html)中找到所有详细信息，我在其中检查问题并提供完成此操作所需的代码。

您所要做的就是在客户端使用这个插件。Ajax 请求如下所示：

```
$.ajax({
    type: "POST",
    url: "SomeURL",
    data: $.toDictionary(yourComplexJSONobject),
    success: function() { ... },
    error: function() { ... }
}); 
```

但这只是整个问题的一部分。现在我们能够将复杂的 JSON 发送回服务器，但是由于它将模型绑定到可能具有属性验证属性的复杂类型，因此此时可能会失败。我也有[解决方案](http://erraticdev.blogspot.com/2010/11/handling-validation-errors-on-ajax.html)。我的解决方案利用了 jQuery Ajax 功能，结果可能成功或错误（如上面的代码所示）。因此，当验证失败时，`error`函数会按原样被调用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T15:24:54.450

您也可以使用[JavaScriptSerializer](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.aspx)类。这将使您可以将 json 反序列化为 .NET 对象。有一个通用的`Deserialize<T>`，尽管您需要 .NET 对象具有与 javascript 相似的签名。此外，还有一种`DeserializeObject`方法可以制作普通的`object`. 然后，您可以使用反射来获取所需的属性。

如果您的控制器采用`FormCollection`，并且您没有向 json 添加任何其他内容，则`data`该 json 应位于`form[0]`：

```
public ActionResult Save(FormCollection forms) {
  string json = forms[0];
  // do your thing here.
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-10T20:42:21.143

这个答案是 DaRKoN_ 使用对象过滤器的答案的后续：

```
[ObjectFilter(Param = "postdata", RootType = typeof(ObjectToSerializeTo))]
    public JsonResult ControllerMethod(ObjectToSerializeTo postdata) { ... } 
```

我在弄清楚如何将多个参数发送到操作方法并让其中一个是 json 对象而另一个是纯字符串时遇到了问题。我是 MVC 的新手，我刚刚忘记了我已经用非 ajaxed 视图解决了这个问题。

如果我需要一个视图上的两个不同对象，我会怎么做。我会创建一个 ViewModel 类。所以说我需要 person 对象和 address 对象，我会做以下事情：

```
public class SomeViewModel()
{
     public Person Person { get; set; }
     public Address Address { get; set; }
} 
```

然后我会将视图绑定到 SomeViewModel。你可以用 JSON 做同样的事情。

```
[ObjectFilter(Param = "jsonViewModel", RootType = typeof(JsonViewModel))] // Don't forget to add the object filter class in DaRKoN_'s answer.
public JsonResult doJsonStuff(JsonViewModel jsonViewModel)
{
     Person p = jsonViewModel.Person;
     Address a = jsonViewModel.Address;
     // Do stuff
     jsonViewModel.Person = p;
     jsonViewModel.Address = a;
     return Json(jsonViewModel);
} 
```

然后在视图中，您可以像这样使用 JQuery 进行简单调用：

```
var json = { 
    Person: { Name: "John Doe", Sex: "Male", Age: 23 }, 
    Address: { Street: "123 fk st.", City: "Redmond", State: "Washington" }
};

$.ajax({
     url: 'home/doJsonStuff',
     type: 'POST',
     contentType: 'application/json',
     dataType: 'json',
     data: JSON.stringify(json), //You'll need to reference json2.js
     success: function (response)
     {
          var person = response.Person;
          var address = response.Address;
     }
}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-19T19:23:07.283

回应丹的上述评论：

> 我正在使用这个方法来实现同样的事情，但由于某种原因，我在 ReadObject 方法上遇到了一个异常：“期望元素 'root' 来自命名空间''..遇到名称为''的'None'，命名空间''。 " 任何想法为什么？– Dan Appleyard 2010 年 4 月 6 日 17:57

我遇到了同样的问题（MVC 3 build 3.0.11209.0），下面的帖子为我解决了这个问题。基本上 json 序列化程序正在尝试读取一个不在开头的流，因此将流重新定位为 0 '修复'它......

[http://nali.org/asp-net-mvc-expecting-element-root-from-namespace-encountered-none-with-name-namespace/](http://nali.org/asp-net-mvc-expecting-element-root-from-namespace-encountered-none-with-name-namespace/)

# wpf - 如何在 WPF 中自动调整和右对齐 GridViewColumn 数据？

> ID：560581
> 
> 赞同：90
> 
> 时间：2009-02-18T10:52:29.707
> 
> 标签：wpf, xaml, listview, gridview, gridviewcolumn

我怎样才能：

*   右对齐 ID 列中的文本
*   根据具有最长可见数据的单元格的文本长度使每一列自动调整大小？

这是代码：

```
<ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="40"/>
            <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}" Width="100" />
            <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}"/>
        </GridView>
    </ListView.View>
</ListView> 
```

## 部分答案：

感谢 Kjetil，GridViewColumn.CellTemplate 运行良好，并且 Auto Width 运行良好，但是当 ObservativeCollection“Collection”使用长于列宽的数据进行更新时，列大小不会自行更新，因此这只是解决数据的初始显示：

```
<ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="ID" Width="Auto">
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Id}" TextAlignment="Right" Width="40"/>
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}" Width="Auto" />
            <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}" Width="Auto"/>
        </GridView>
    </ListView.View>
</ListView> 
```

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-02-18T11:23:53.280

要使每个列自动调整大小，您可以在 GridViewColumn 上设置 Width="Auto"。

要右对齐 ID 列中的文本，您可以使用 TextBlock 创建单元格模板并设置 TextAlignment。然后设置 ListViewItem.Horizo​​ntalContentAlignment（在 ListViewItem 上使用带有 setter 的样式）以使单元格模板填充整个 GridViewCell。

也许有一个更简单的解决方案，但这应该可行。

**注意：**该解决方案需要Window.Resources中的 Horizo​​ntalContentAlignment **=Stretch和 CellTemplate 中的****TextAlignment=Right**。

```
<Window x:Class="WpfApplication6.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">
<Window.Resources>
    <Style TargetType="ListViewItem">
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    </Style>
</Window.Resources>
<Grid>
    <ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}">
        <ListView.View>
            <GridView>
                <GridViewColumn Header="ID" Width="40">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Id}" TextAlignment="Right" />
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>
                <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}" Width="Auto" />
                <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}" Width="Auto"/>
            </GridView>
        </ListView.View>
    </ListView>
</Grid>
</Window> 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-12-19T00:14:54.243

如果内容的宽度发生变化，您将不得不使用这段代码来更新每一列：

```
private void ResizeGridViewColumn(GridViewColumn column)
{
    if (double.IsNaN(column.Width))
    {
        column.Width = column.ActualWidth;
    }

    column.Width = double.NaN;
} 
```

每次该列的数据更新时，您都必须触发它。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-06-30T02:36:16.613

如果您的列表视图也在重新调整大小，那么您可以使用行为模式来重新调整列的大小以适应整个 ListView 宽度。几乎与您使用 grid.column 定义相同

```
<ListView HorizontalAlignment="Stretch"
          Behaviours:GridViewColumnResize.Enabled="True">
        <ListViewItem></ListViewItem>
        <ListView.View>
            <GridView>
                <GridViewColumn  Header="Column *"
                                   Behaviours:GridViewColumnResize.Width="*" >
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <TextBox HorizontalAlignment="Stretch" Text="Example1" />
                        </DataTemplate>
                    </GridViewColumn.CellTemplate> 
```

请参阅以下链接以获取一些示例并链接到源代码 [http://lazycowprojects.tumblr.com/post/7063214400/wpf-c-listview-column-width-auto](http://lazycowprojects.tumblr.com/post/7063214400/wpf-c-listview-column-width-auto)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-04-01T14:13:57.830

我创建了以下类，并在需要的地方在应用程序中使用`GridView`：

```
/// <summary>
/// Represents a view mode that displays data items in columns for a System.Windows.Controls.ListView control with auto sized columns based on the column content     
/// </summary>
public class AutoSizedGridView : GridView
{        
    protected override void PrepareItem(ListViewItem item)
    {
        foreach (GridViewColumn column in Columns)
        {
            // Setting NaN for the column width automatically determines the required
            // width enough to hold the content completely.

            // If the width is NaN, first set it to ActualWidth temporarily.
            if (double.IsNaN(column.Width))
              column.Width = column.ActualWidth;

            // Finally, set the column with to NaN. This raises the property change
            // event and re computes the width.
            column.Width = double.NaN;              
        }            
        base.PrepareItem(item);
    }
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-08-01T16:03:20.277

因为我有一个 ItemContainerStyle 我不得不把 Horizo​​ntalContentAlignment 放在 ItemContainerStyle

```
 <ListView.ItemContainerStyle>
            <Style TargetType="ListViewItem">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Path=FieldDef.DispDetail, Mode=OneWay}" Value="False">
                         <Setter Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>
                </Style.Triggers>
                <Setter Property="HorizontalContentAlignment" Value="Stretch" /> 
    .... 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-05-15T07:32:19.167

我喜欢 user1333423 的解决方案，只是它总是重新调整每一列的大小；我需要允许一些列固定宽度。因此，在此版本中，宽度设置为“自动”的列将自动调整大小，而设置为固定数量的列将不会自动调整大小。

```
public class AutoSizedGridView : GridView
{
    HashSet<int> _autoWidthColumns;

    protected override void PrepareItem(ListViewItem item)
    {
        if (_autoWidthColumns == null)
        {
            _autoWidthColumns = new HashSet<int>();

            foreach (var column in Columns)
            {
                if(double.IsNaN(column.Width))
                    _autoWidthColumns.Add(column.GetHashCode());
            }                
        }

        foreach (GridViewColumn column in Columns)
        {
            if (_autoWidthColumns.Contains(column.GetHashCode()))
            {
                if (double.IsNaN(column.Width))
                    column.Width = column.ActualWidth;

                column.Width = double.NaN;                    
            }          
        }

        base.PrepareItem(item);
    }        
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-05-25T07:39:26.257

我知道这为时已晚，但这是我的方法：

```
<GridViewColumn x:Name="GridHeaderLocalSize"  Width="100">      
<GridViewColumn.Header>
    <GridViewColumnHeader HorizontalContentAlignment="Right">
        <Grid Width="Auto" HorizontalAlignment="Right">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="Local size" TextAlignment="Right" Padding="0,0,5,0"/>
        </Grid>
    </GridViewColumnHeader>
</GridViewColumn.Header>
<GridViewColumn.CellTemplate>
    <DataTemplate>
        <TextBlock Width="{Binding ElementName=GridHeaderLocalSize, Path=Width, FallbackValue=100}"  HorizontalAlignment="Right" TextAlignment="Right" Padding="0,0,5,0" Text="Text" >
        </TextBlock>
    </DataTemplate>
</GridViewColumn.CellTemplate> 
```

主要思想是将cellTemplete元素的宽度绑定到ViewGridColumn的宽度。Width=100 是在第一次调整大小之前使用的默认宽度。后面没有任何代码。一切都在 xaml 中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-24T17:13:55.130

我在接受答案时遇到了麻烦（因为我错过了 Horizo​​ntalAlignment=Stretch 部分并调整了原始答案）。

这是另一种技术。它使用带有 SharedSizeGroup 的 Grid。

**注意：** ListView 上的**Grid.IsSharedScope=true**。

```
<Window x:Class="WpfApplication6.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">
<Grid>
    <ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}" Grid.IsSharedSizeScope="True">
        <ListView.View>
            <GridView>
                <GridViewColumn Header="ID" Width="40">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                             <Grid>
                                  <Grid.ColumnDefinitions>
                                       <ColumnDefinition Width="Auto" SharedSizeGroup="IdColumn"/>
                                  </Grid.ColumnDefinitions>
                                  <TextBlock HorizontalAlignment="Right" Text={Binding Path=Id}"/>
                             </Grid>
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>
                <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}" Width="Auto" />
                <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}" Width="Auto"/>
            </GridView>
        </ListView.View>
    </ListView>
</Grid>
</Window> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-07-31T13:01:40.677

我创建了一个用于更新列表的 GridView 列标题的函数，并在调整窗口大小或列表视图更新其布局时调用它。

```
public void correctColumnWidths()
{
    double remainingSpace = myList.ActualWidth;

    if (remainingSpace > 0)
    {
         for (int i = 0; i < (myList.View as GridView).Columns.Count; i++)
              if (i != 2)
                   remainingSpace -= (myList.View as GridView).Columns[i].ActualWidth;

          //Leave 15 px free for scrollbar
          remainingSpace -= 15;

          (myList.View as GridView).Columns[2].Width = remainingSpace;
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-03T18:04:34.010

> @RandomEngy 上面给出的解决方案有效，但似乎存在一个问题，即仅根据可见数据（因此，前 X 行）调整大小，而不一定是每列的最长（最宽行）值。

要解决上述问题，可以完成以下操作。

附加即使您的列表视图更改的集合，如下所示，

```
((INotifyCollectionChanged) MyListView.ItemsSource).CollectionChanged += CollectionChanged_Handler; 
```

还声明一个私有 maxWidth 属性来存储您的视图遇到的最长内容。

```
private double maxWidth = 200;//Whatever your default width is. 
```

现在处理程序如下，

```
private void CollectionChanged_Handler(object sender, NotifyCollectionChangedEventArgs args)
{
   var gridView = (GridView)MyListView.View;
   if(gridView != null)
   {
      foreach( var column in gridView.Columns)
      {
         if(column.ActualWidth > maxWidth)
         {
            if (double.IsNaN(column.Width))
            {
                   maxWidth = column.ActualWidth;
                   column.Width = maxWidth ;
            }
            column.Width = double.NaN;
         }       
       }   
} 
```

也有可能一旦您启动对话框，寡妇已经填充了多行，而顶行不是最长的。仅当集合更改时才会触发上面的代码，但由于数据已经加载并且加载对话框时可见的行不是最宽的行，因此上面的代码将无法调整列的大小。为了解决此问题，请在 ListView_OnPreviewMouseLeftButton 事件上调用上述处理程序。如下所示，

```
private void MyListView_OnPreviewMouseLeftButtonUp(object sender, MouseButtonEventArgs e)
{
CollectionChanged_Handler(sender, null);
} 
```

一旦有人滚动到视图的最宽行内容，上面的代码将刷新您的列宽。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-02-19T17:02:49.550

这是你的代码

```
<ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}">
    <ListView.View>
        <GridView>
            <GridViewColumn Header="ID" DisplayMemberBinding="{Binding Id}" Width="40"/>
            <GridViewColumn Header="First Name" DisplayMemberBinding="{Binding FirstName}" Width="100" />
            <GridViewColumn Header="Last Name" DisplayMemberBinding="{Binding LastName}"/>
        </GridView>
    </ListView.View>
</ListView> 
```

试试这个

```
<ListView Name="lstCustomers" ItemsSource="{Binding Path=Collection}">
    <ListView.View>
        <GridView>
            <GridViewColumn DisplayMemberBinding="{Binding Id}" Width="Auto">
               <GridViewColumnHeader Content="ID" Width="Auto" />
            </GridViewColumn>
            <GridViewColumn DisplayMemberBinding="{Binding FirstName}" Width="Auto">
              <GridViewColumnHeader Content="First Name" Width="Auto" />
            </GridViewColumn>
            <GridViewColumn DisplayMemberBinding="{Binding LastName}" Width="Auto">
              <GridViewColumnHeader Content="Last Name" Width="Auto" />
            </GridViewColumn
        </GridView>
    </ListView.View>
</ListView> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-05T13:52:22.200

好吧，我刚遇到这个问题，我用 IValueConverter 解决了它。

```
public class GridViewColumHeaderWidthConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        return (double)value / 8;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

注意： 8 是 GridViewColumns 的数量

现在在 Xaml 中：

```
<ListView x:Name="TheListView" ItemsSource="{Binding Customers}">
    <ListView.View>
        <GridView>
            <!--  Id  -->
            <GridViewColumn Width="{Binding ElementName=TheListView, Path=ActualWidth, Converter={StaticResource GridViewColumHeaderWidthConverter}}">
                <GridViewColumnHeader Content="Id" />
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding CustomerId}" />
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn>
            <!--  Code  -->
            <GridViewColumn Width="{Binding ElementName=TheListView, Path=ActualWidth, Converter={StaticResource GridViewColumHeaderWidthConverter}}">
                <GridViewColumnHeader Content="Code" />
                <GridViewColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding CustomerCode}" />
                    </DataTemplate>
                </GridViewColumn.CellTemplate>
            </GridViewColumn> 
```

不要忘记包含转换器文件。在这种情况下，我在 App.xaml 中定义了转换器

```
<Application.Resources>
    <converters:GridViewColumHeaderWidthConverter x:Key="GridViewColumHeaderWidthConverter" />
</Application.Resources> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-02-06T23:07:46.997

可以通过禁用虚拟化并`Width="Auto"`在`GridViewColumn`.

```
<ListView ItemsSource="{Binding ...}" VirtualizingStackPanel.IsVirtualizing="False">
    <ListView.View>
        <GridView>
            <GridViewColumn Width="Auto"
                            DisplayMemberBinding="{Binding Name}"
                            Header="Name"/>
        </GridView>
    </ListView.View>
</ListView> 
```

默认情况下启用虚拟化，这意味着仅呈现可见行。这对性能有好处。缺点是仅使用当前可见的行来计算列宽（`Width="Auto"`）。禁用虚拟化意味着即使某行目前不可见，也会呈现所有行。结果是自动宽度计算考虑了所有行的值。

# aix - aix 中的空闲会话

> ID：560582
> 
> 赞同：1
> 
> 时间：2009-02-18T10:52:37.960
> 
> 标签：aix

在 AIX 中的哪个位置为 telnet 会话设置了 timeot？我需要无限期地保持每个会话开放。我检查以下文件 /etc/security/login.cfg /etc/security/.profile /etc/profile 和我的登录文件 TMOUT=0 或者我从这些文件中删除它，但空闲会话仍然消失？有什么服务可以启动和停止吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T11:58:50.327

有关相同问题，请参阅此[Tek-Tip 论坛帖子](http://www.tek-tips.com/viewthread.cfm?qid=1394610&page=47)。

简而言之：

*   检查您的 TMOUT 和 TIMEOUT 环境变量，如果设置，它们可以启动关闭空闲会话
*   检查 /etc/security/login.cfg 在“logintimeout”中的 shell 超时
*   检查你的防火墙，如果它在一段时间后丢弃空闲的 tcp 连接

也许您还可以将您的客户端配置为不时发送空包以保持会话处于活动状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T11:53:45.377

[GNU Screen](http://en.wikipedia.org/wiki/GNU_Screen)是解决这个问题的一个更通用的解决方案。

# c# - NHibernate 批量插入或更新

> ID：560584
> 
> 赞同：7
> 
> 时间：2009-02-18T10:53:15.930
> 
> 标签：c#, .net, nhibernate, bulkinsert

嗨，我正在做一个项目，我们需要每天处理几个 xml 文件并使用这些文件中包含的信息填充数据库。

每个文件大约 1Mb，包含大约 1000 条记录；我们通常需要处理 12 到 25 个这些文件。我已经看到了一些关于使用 NHibernate 进行批量插入的信息，但我们的问题有点棘手，因为 xml 文件包含混合了更新记录的新记录。

在 xml 中有一个标志告诉我们特定记录是新记录还是对现有记录的更新，但不告诉我们哪些信息发生了变化。xml 记录不包含我们的数据库标识符，但我们可以使用 xml 记录中的标识符来唯一地定位我们数据库中的记录。

到目前为止，我们的策略是确定当前记录是插入还是更新，并基于此我们在数据库上执行插入或进行搜索，然后使用来自xml 记录，最后我们对数据库进行更新。

我们当前方法的问题是我们遇到了数据库锁问题，并且我们的性能下降得非常快。我们已经考虑过一些替代方案，例如为不同的操作设置单独的表，甚至是单独的数据库，但这样做意味着付出很大的努力，所以在做出任何决定之前，我想征求社区对此事的意见，在此先感谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T11:49:51.767

几个想法：

*   始终尝试使用 IStatelessSession 进行批量操作。
*   如果您仍然对性能不满意，只需跳过 NHibernate 并使用特定于此的存储过程或参数化查询，或使用[IQuery.ExecuteUpdate()](http://darioquintana.com.ar/blogging/?p=23)
*   如果您使用的是 SQL Server，则可以将 xml 格式转换为 BCPFORMAT xml，然后在其上运行 BULK INSERT（仅用于插入）
*   如果您有太多数据库锁，请尝试对操作进行分组（即首先找出需要插入的内容和更新的内容，然后获取更新的 PK，然后运行 ​​BULK INSERT 进行插入，然后运行更新）
*   如果解析源文件是一个性能问题（即它最大化 CPU 内核），请尝试并行执行（您可以使用[Parallel Extensions](http://blogs.msdn.com/pfxteam/)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T05:52:50.733

这可能会有所帮助：http: [//ideas-net.blogspot.com/2009/03/nhibernate-update-performance-issue.html](http://ideas-net.blogspot.com/2009/03/nhibernate-update-performance-issue.html)

# sql - 如何处理 SQL 中的长比较

> ID：560586
> 
> 赞同：0
> 
> 时间：2009-02-18T10:53:32.277
> 
> 标签：sql, sql-server, database, algorithm, query-optimization

我有一个关于 SQL 的病态问题，所以我通常通过构建快速软件应用程序来处理我的 SQL 问题来对我的所有数据库问题进行分类。

*（就像我在这种情况下所做的那样）*

感谢 StackOverflow，我想我可能会因为正确性而感到羞耻，所以我想学习如何在实际 SQL 或 T-SQL 本身中进行这种 SQL 故障排除（如果可能的话）：

我有：

**数据库 DB1 表 A (unitNo, BuildingNo)**

**数据库 DB2 表 B (unitNo, BuildingNo)**

1.  我想从数据库 DB1 中找出表 A 上存在的单元（单元号），而数据库 DB2 中的表 B 上不存在这些单元（单元号），反之亦然。

2.  可以有多个单元具有相同的单元号，这是因为可以将相同的单元号分配给不同建筑物的单元。

3.  *我没有对任何数据库的写访问权。*

我希望这不会被视为“给我的 codz”帖子，我想知道比我更流利的 SQL 的人如何对这种算法进行排序，教程或提示的帖子非常受欢迎，不需要完整的代码，但如果它有助于有意义，那么请这样做。

起初我以为我可以从一个表中获取所有单元号，然后从另一个表中排除它们，如下所示：

```
select concated.unit from 
( SELECT (  unitNo + ',' + CONVERT(varchar(12), BuildingNo) ) as unit
FROM A) concated 
having concated.unit not in

(
'201,1',
'202,1',
'203,1',
'204,1',
'205,1',
'206,1',
[...] 
```

这通常会起作用，但是任何一个表中的单元数量都是巨大的，尝试这样做会使 SQL 服务器崩溃：

> “堆栈空间不足”

谢谢，

里克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T10:58:57.647

我认为您正在寻找完整的外部联接。这为您提供了您在第 1 部分中要求的单位编号。

```
Select 
   A.UnitNumber, B.UnitNumber
from
   DB1.dbo.TableA A FULL OUTER JOIN DB2.dbo.TableB B 
       on A.UnitNumber = B.UnitNumber
       and A.BuildingNumber = B.BuildingNumber
Where
   A.UnitNumber is null or B.UnitNumber is null 
```

我在下面概述的其他可能感兴趣的查询。

这为您提供了 A 中的记录而不是 B 中的记录。

```
Select
    A.UnitNumber
From
    DB1.dbo.TableA A Left Join DB2.dbo.TableB B 
        on A.UnitNumber = B.UnitNumber 
        and A.BuildingNumber = B.BuildingNumber
Where
    B.UnitNumber is null 
```

您只需将其反转即可找到 B 中不在 A 中的记录。

```
Select
    B.UnitNumber
From
    DB2.dbo.TableB B left join DB1.dbo.TableA A 
        on B.UnitNumber = A.UnitNumber
        and B.BuildingNumber = A.BuildingNumber
Where
    A.UnitNumber is null 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T11:16:13.813

正如 JPunyon 所说，但如果您希望将它们全部放在一个列表中，则类似于：

```
Select 
    [UnitNumber] = COALESCE(A.UnitNumber, B.UnitNumber),
    [Source] = CASE WHEN A.UnitNumber IS NOT NULL THEN 'A' ELSE 'B' END
from
    DB1.dbo.TableA A
    FULL OUTER JOIN DB2.dbo.TableB B 
        on A.UnitNumber = B.UnitNumber
Where
    A.UnitNumber is null or B.UnitNumber is null
ORDER BY COALESCE(A.UnitNumber, B.UnitNumber) 
```

# java - 是否有专为 Java 5 或更高版本设计的 log4j 或 commons 日志扩展或其他日志框架？

> ID：560588
> 
> 赞同：3
> 
> 时间：2009-02-18T10:54:57.593
> 
> 标签：java, logging, log4j, java-5

Java 5 引入了许多可以使日志语句不那么混乱的特性，例如可变数量的参数和 printf。这可以减轻在记录某些内容时发生的所有消息构建代码，以及周围的`if`.

例如，不要写：

```
if (log.isDebugEnabled()
{
    log.debug("User id: "+uid+", Request id:"
    + rid +", Client IP: "+ip+" blah blah blah");
} 
```

我想写：

```
log.debug("User id: %s, Request id: %s, Client IP: %s blah blah blah",
uid, rid, ip); 
```

或类似的东西。

你知道一个日志框架或一个日志框架的扩展可以帮助解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:01:31.820

[Log5j](http://code.google.com/p/log5j/)正是您所需要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T11:12:28.877

[Java 的简单日志门面 (SLF4J)](http://www.slf4j.org/)

> Java 或 (SLF4J) 的 Simple Logging Facade 旨在用作各种日志 API 的简单外观，允许最终用户在部署时插入所需的实现。SLF4J 还支持桥接遗留 API 以及源代码迁移工具。
> 
> SLF4J API 提供了各种日志系统的高级抽象，包括 JDK 1.4 日志、log4j 和 logback。功能包括参数化日志记录和 MDC 支持。

例子：

```
logger.info("{} {}!", "Hello", "world"); 
```

产生“你好世界！” 但前提是启用了信息级别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T11:06:46.100

为此编写自己的包装器方法很容易。

# java - 如何在JAVA中去除除“src”和“alt”之外的HTML属性

> ID：560605
> 
> 赞同：2
> 
> 时间：2009-02-18T11:03:16.857
> 
> 标签：java, html, string, strip

如何从字符串中的 HTML 标记中去除所有属性，使用 Java 的“alt”和“src”除外？

更进一步..如何从字符串中的所有“src”属性中获取内容？

:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:10:26.730

你可以：

*   实现一个[SAX 解析器](http://java.sun.com/j2se/1.4.2/docs/api/javax/xml/parsers/SAXParser.html)；
*   [使用DOM 解析器](http://snippets.dzone.com/posts/show/3575)构建一个文档，遍历并修剪它，然后转换回 HTML；或者
*   在 XSLT 中使用[身份转换](http://en.wikipedia.org/wiki/Identity_transform)（假设您的 HTML 是 XHTML 格式或可以使用[JTidy](http://jtidy.sourceforge.net/)转换为该格式）以及一些其他情况来删除您不想要的属性。

无论你做什么，***都不要尝试用正则表达式来做。***

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:36:18.753

好的，以某种方式解决了这个问题。

使用 HTMLCleaner 库将输入数据解析为有效格式。

然后我使用 DOM 解析器遍历所有内容，并去除所有不允许的标签和属性。

（还有一些丑陋的小技巧；））

这是一项繁重的工作。

# sql - SQL 将列转换为行

> ID：560621
> 
> 赞同：2
> 
> 时间：2009-02-18T11:07:21.900
> 
> 标签：sql, row

我的表有以下列：

```
A  |  B  |  C  |  D  |  E  |  F 
```

我想显示如下：

```
MyColumn  |  MyColumn2
  A       |    B
  C       |    D
  E       |    F 
```

如您所见，我想将列显示为具有自定义列名的对。这些对是 A 列和 B 列、C 列和 D 列以及 C 和 D 列。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T11:11:35.387

```
select A as [Col 1], B as [Col 2] from table
union all 
select C,D from table 
union all 
select E,F from table 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:12:33.603

这不会扩展到十亿列，但是......

```
Select A as MyColumn, B as MyColumn2 from Table
UNION
Select C as MyColumn, D as MyColumn2 from Table
UNION
Select E as MyColumn, F as MyColumn2 from Table 
```

此查询将删除重复项。所以说表中有一条记录

> 你好 | 世界 | 你好 | 世界 | 你好 | 世界

我的选择只会返回

> 你好 | 世界

Sambo's 将返回所有三个...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T11:17:41.750

如果我对您的理解正确，您可以通过工会做到这一点：

```
SELECT A as MyColumn, B as MyColumn2
UNION
SELECT C as MyColumn, D as MyColumn2
UNION
SELECT E as MyColumn, F as MyColumn2 
```

如果匹配列的数据类型不同，则需要先转换数据类型，例如：

```
SELECT CONVERT(VARCHAR(10), A) as MyColumn, CONVERT(VARCHAR(10), B) as MyColumn2
UNION
SELECT CONVERT(VARCHAR(10), C) as MyColumn, CONVERT(VARCHAR(10), D) as MyColumn2
UNION
SELECT CONVERT(VARCHAR(10), E) as MyColumn, CONVERT(VARCHAR(10), F) as MyColumn2 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-25T05:21:39.297

在 Sql Server 2005 中，Unpivot 运算符可以解决您的问题。 [Unpivot 将列转换为 sql server 2005 中的行](http://www.logiclabz.com/sql-server/transpose-columns-to-rows-in-sql-server-2005-using-unpivot.aspx)。

希望能帮助到你

# c# - c# 获取TreeView父节点列表

> ID：560628
> 
> 赞同：2
> 
> 时间：2009-02-18T11:11:23.110
> 
> 标签：c#, winforms, treeview, parent-node

如果我有一个 TreeView (myTreeview)，我如何获得所有作为父节点的节点的列表？即有孩子的节点

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T11:25:03.497

myTreeview.Nodes 将为您提供 MS 定义的根节点列表，这基本上意味着树根分支上的节点。

此代码将构建一个包含子节点的根节点列表：

```
 IList<TreeNode> nodesWithChildren = new List<TreeNode>();
    foreach( TreeNode node in myTreeview.Nodes )
        if( node.Nodes.Count > 0 ) nodesWithChildren.Add( node ); 
```

* * *

更新：如果您希望 TreeView 中的所有节点都有一个子节点，而不管树有多深，那么请使用一些递归，例如

```
private static IList<TreeNode> BuildParentNodeList(TreeView treeView)
{
    IList<TreeNode> nodesWithChildren = new List<TreeNode>();

    foreach( TreeNode node in treeView.Nodes  )
        AddParentNodes(nodesWithChildren, node);

    return nodesWithChildren;
}

private static void AddParentNodes(IList<TreeNode> nodesWithChildren, TreeNode parentNode)
{
    if (parentNode.Nodes.Count > 0)
    {
        nodesWithChildren.Add( parentNode );
        foreach( TreeNode node in parentNode.Nodes )
            AddParentNodes( nodesWithChildren, node );
    }
} 
```

* * *

更新 2：只有 1 个 foreach 循环的递归方法：

```
private static IList<TreeNode> BuildParentNodeList(TreeView treeView)
{
    IList<TreeNode> nodesWithChildren = new List<TreeNode>();
    AddParentNodes( nodesWithChildren, treeView.Nodes );
    return nodesWithChildren;
}

private static void AddParentNodes(IList<TreeNode> nodesWithChildren, TreeNodeCollection parentNodes )
{
    foreach (TreeNode node in parentNodes)
    {
        if (node.Nodes.Count > 0)
        {
            nodesWithChildren.Add( node );
            AddParentNodes(nodesWithChildren, node.Nodes);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T11:44:56.990

```
private void AddNonLeafNodes(List<TreeNode> nonLeafNodes, TreeNodeCollection nodes)
{
    foreach( TreeNode node in nodes )
    {
        if( node.Nodes.Count > 0 )
        {
            nonLeafNodes.Add(node);
            AddNonLeafNodes(nonLeafNodes,node.Nodes);
        }
    }
}

List<TreeNode> nonLeafNodes = new List<TreeNode>();
AddNonLeafNodes(nonLeafNodes,treeView1.Nodes); 
```

# xml - 使用 XSLT 创建网站是否有意义

> ID：560635
> 
> 赞同：20
> 
> 时间：2009-02-18T11:13:05.443
> 
> 标签：xml, xslt, web, content-management-system

这种技术现在还流行吗？

我想制作一个自动转换 XSLT 文件的网站。它应该像这样工作：当用户访问该站点时，单个处理程序将接受他的请求，然后为它找到合适的 XML（根据请求的 URL）并使用其附加的 XSL 文件对其进行转换。

我想这样做是为了方便使用纯 XML 文件更新站点（而不是使用成熟且昂贵的 CMS 系统）。

你说什么？好主意？馊主意？有人有推荐吗？

谢谢！

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-18T11:21:19.277

回到 2002-2003 年，我用 XSLT 做了很多工作（在 2006-2007 年还做了更多）。您在这方面的里程会有所不同，但老实说，出于以下几个原因，我会避免这样做：

*   语法令人眼花缭乱，难以学习，难以正确理解，简单明了让你头疼。模板本身并不算太糟糕，但会引入一些粗糙的 XPath 表达式，这很痛苦；
*   对于合理大小的文档和转换，它相对较慢。它是否足够慢以至于与您相关，您只能通过对您的场景进行基准测试才能发现，因此不要将其视为一揽子规则，更多的是警示故事或警告；
*   错误消息并没有那么有用，而且很难找出问题所在。与更传统的方法不同，您不能抽出调试器并单步执行 XSLT。
*   使用任何现代 Web 风格的语言（C#、Java、PHP、Python、Ruby 等）生成 HTML 非常简单、直接、易于记录和调试；
*   操作 XML 可以说更加繁琐，并且会生成更多直接操作对象并将其转换为标记的代码。这当然会因您选择的语言为您提供的工具而异。

这些天来，我真正能看到有一个 XSLT 应用程序的唯一地方是使用生成 XML 的 Web 服务（现在很多生成 JSON 和更容易使用的格式）。

即使在那种情况下，我可能仍然会直接使用 Java 中的 JAXB（或其他语言中的类似技术）直接操作 XML。

**更新：**我刚刚[在 Web Frameworks 中遇到了 XSLT 之死](http://java.dzone.com/news/death-xslt-web-frameworks)。例如：

> 例如：如何隐藏表格中的行（使用不同的 CSS 样式），基于一些 CONDITION，使用 XSLT？看：
> 
> ```
> <tr>
>   <xsl:attribute name="style">
>     <xsl:choose>
>       <xsl:when test="CONDITION">
>         <xsl:value-of select="'visibility: visible'">
>       </xsl:when>
>       <xsl:otherwise>
>         <xsl:value-of select="'visibility: collapse'">
>       </xsl:otherwise>
>     </xsl:choose>
>   </xsl:attribute>
>   ...
> </tr> 
> ```
> 
> 现在与 JSP 1.x 相同：
> 
> ```
> <tr style='visibility:<%=CONDITION ? "collapse" : "visible"%>'>
>    ...
> </tr> 
> ```
> 
> 或使用 JSP 2.x：
> 
> ```
> <tr style='visibility:${CONDITION ? "collapse" : "visible"}'>
>   ...
> </tr> 
> ```

总结如下：

> 因此，如果您开始新项目，请在开始使用 XSLT 之前三思（或十次）。并且 > 如果您使用 Eclipse，您甚至可以在使用 JSP/JSTL 之前三思而后行。Velocity 或 > FreeMarker 可能是更好的选择。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-18T12:07:22.757

基于“语法很难”的答案根本没有答案。一种）。它真的不是，和B）。你应该是一个程序员，学习它。

当然，其他技术正在以 XSLT 自 2005 年以来从未有过的速度发展，但它仍然是一个强大的工具，它为您提供了一个抽象级别，比如 asp.net webforms 没有，并允许您提供一个通用的可扩展解决方案简单地序列化为一系列输出格式。使用任何给定语言生成 HTML 都很容易，现在将其扩展到 XML、现在将其扩展到 JSON、现在将其扩展到 CSV 则更难。

在仍然受 I/O 限制的环境中，缓存的转换足够快。

OTOH，在 XML 中存储*数据*通常不是一个好主意。出于上述所有原因，最好存储在数据库/内存中并根据需要进行序列化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T12:53:41.240

在工作中，我正在进行的一个项目使用 XSLT，老实说，这真的很痛苦。实际的 XSLT 文件并不难处理，但必须创建 XML 会增加额外的复杂性。我还发现，除了最基本的页面之外，XML 往往会变得非常臃肿和混乱。所以，不，我不会推荐它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T11:50:01.720

我知道在波兰，很少有大型门户网站大量使用 XSLT。他们使用它是因为它可以最大限度地减少通过网络发送的数据量。

我还参与了这个项目（Huge HRM 应用程序），我们在那里使用它来将我们的编程语言转换为 .NET。

我会说它有时非常有用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T11:21:43.880

XSLT 只是一种模板方法。它也只是一个完整的 MVC 框架的一部分，其中模板是 View 组件。XSLT 是一项伟大的技术，但它速度慢，而且不是构建可扩展网站的首选。

研究 MVC 框架，看看哪个最适合你。例如 ASP.NET MVC、Ruby on Rails、CakePHP、Catalyst 等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T20:54:27.887

> 我想这样做是为了方便使用纯 XML 文件更新站点（而不是使用成熟且昂贵的 CMS 系统）。

呃，什么？有许多免费和开源的 CMS。

spoulson 上面所说的关于模板的内容是重点。从输入 XML 文件提供输出页面很好。但这不会让您获得 CMS。CRUD 呢？搜索？页面列表？

如果您的站点非常小，以至于您可以通过手动编辑一些 XML 文件来完成所有相关的更新，那么为什么不呢，那就去吧。但如果就这么简单，您还不如手动编辑 HTML。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-24T16:06:38.060

我喜欢这个主意。XSL 是一个了不起的工具，但是在您意识到它真正有用之前，您必须有那个特殊的启蒙时刻。在此之前，它似乎马马虎虎。

我在各种应用程序中使用过 XSL，它为我节省了很多时间。但显然不要仅仅为了它而使用它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-15T08:19:57.300

您所描述的已经存在并且是 Apache Cocoon：[http ://cocoon.apache.org/](http://cocoon.apache.org/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-05-07T10:21:59.383

xslt很难吗？

解决复杂问题和复杂标准是程序员的工作。有些东西更难，但仍然需要。只要坚持下去，每次你需要学习新东西时都会变得更容易。

Xslt 很简单。

真的！那里有教你 xslt 的好书。只需学习例如 rdf/owl（一个 w3c 标准），它仍然可以变得更加复杂......

xslt 很慢？如果可以的话，只需使用正确的缓存。（好吧，它并不总是可能的......）。

只需阅读 REST（一些书或 Roy Fielding 论文），这也是必不可少的内容。

现在使用 XProc (xslt piplines) 和一个围绕 calabash (Xproc implementationaion) 的小型 restserver，您可以归档这么多。它绝对可以节省您的时间。任何数据都可以导出到 XML，通过 REST 变为可用并使用 XProc 进行转换。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-05-07T10:37:05.097

[Symphony CMS](http://sympfony-cms.com)使用 XSLT。在使用该 CMS 时，我发现我遇到的唯一真正问题是学习 XSL/XPath 语法，主要是由于缺乏好的教程/文档。如果您想了解一些相对现代的 XSLT 用法，可能值得一试 Symphony。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-18T13:58:27.777

看看[http://www.umbraco.org/](http://www.umbraco.org/)它是一个免费的开源 CMS 工具，它广泛使用 XSLT 来生成页面。

对于那些声称 XSLT 很难的人，我想说它并不比 SQL 难。有些场景很难，比如分组，就像在 SQL 树中很难一样。

为正确的工作选择正确的工具，您应该不会有任何问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-01-10T22:48:24.910

如果您的平台是 ASP.NET，请查看[myxsl](http://maxtoroq.github.io/myxsl/)

XSLT 使您能够进行不显眼的模板，这是 IMO 的终极模板。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-01-23T07:04:22.320

附带说明一下，[wowarmory.com](http://www.wowarmory.com/)是使用 XSLT 的高流量站点的一个很好的例子。事实上，我认为整个网站都在使用它。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-18T11:29:07.980

对我来说听起来是个坏主意。使用 ASP.NET 之类的东西将内容存储在数据库中要容易得多 - 然后您可以将内容直接更新到数据库中 - 这本身比编辑 XML 更容易。

# actionscript-3 - 从 AS3 创建一个圆形按钮？

> ID：560647
> 
> 赞同：2
> 
> 时间：2009-02-18T11:16:18.277
> 
> 标签：actionscript-3, flex3

如何从 AS3 创建圆润且美观的“OK”和“CANCEL”按钮？

我不想为这些使用任何图像，只是绘制它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T15:35:39.730

我会使用 Shape 或 Sprite，并使用类似的图形属性在其上绘制

```
var s:Shape = new Shape();
s.graphics.beginFill(0x123123, 1);
s.graphics.drawRoundRect(...);
s.graphics.endFill(); 
```

或者如果您想在其上附加其他元素（如标签），请使用 Sprite

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T15:31:36.087

根据monkeye的回答，如果使用[Flex](http://www.adobe.com/products/flex/) ，您可以通过设置样式来创建非常简单的圆形[按钮。](http://livedocs.adobe.com/flex/3/langref/mx/controls/Button.html)`cornerRadius`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T11:34:57.450

有很多方法可以做到这一点。

如果我是你——如果你只需要一个按钮。让自己成为一个按钮类。如果您需要更多布局和 GUI 元素，请考虑使用[Flex 框架](http://www.adobe.com/products/flex/)或类似[ASwing](http://www.aswing.org/)

在 Flex 中，要么学习[如何为](http://scalenine.com/blog/2007/02/17/10-ways-to-skin-an-app/)组件蒙皮，要么自己动手。只需创建一个画布、框、标签或其中包含图片的任何东西，并使其表现得像一个按钮。

# oop - 面向对象的登录功能

> ID：560648
> 
> 赞同：2
> 
> 时间：2009-02-18T11:16:33.003
> 
> 标签：oop, authentication, authorization

用户登录功能对于许多应用程序来说非常常见。我想看看人们如何以面向对象的方式实现此功能。

我有一个用户，我需要针对系统验证用户 ID 和密码（这可能是 ldap、数据库等）。那么你会创建什么样的类和操作来实现这个功能呢？

或者 OO 是不是开发这个功能的坏选择？

我即将开始一个新项目，所以想收集好的选择。

* * *

我知道已经有提供此解决方案的框架。我在早期的项目中使用过它们。我试图看到的是人们如何以 OO 方式实现这一点。

我阅读了答案，每个人都建议使用单独的凭据和身份验证服务。如果我使用类名而不是凭据作为用户，那么用户类不应该有一个名为登录的方法吗？就像 Person 对象将有一个方法喝而不是 DrinkService 或者我正确理解这一点是错误的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:25:07.553

它到底需要有多大的可扩展性？我将定义一个抽象类 Credentials，它封装了给定系统所需的身份验证信息。将其子类化为特定系统类型。一个示例是仅包含用户名和密码的 BasicCredentials。然后，定义一个定义身份验证方法的接口。也许我还会定义一个包含附加主机信息的抽象主机类。这可能过于抽象，具体取决于您设想的身份验证对象。

此示例代码是 C# 3.0。

```
public abstract class Credentials
{
}

public class BasicCredentials : Credentials
{
    public String Username { get; set; }
    public String Password { get; set; }
}

public abstract class Host
{
}

public class IPHost : Host
{
    public IPAddress Location { get; set; }
}

public interface IAuthenticate
{
    bool Authenticate(Credentials creds, Host host);
}

public class BasicAuthenticator : IAuthenticate
{
    public bool Authenticate(Credentials creds, Host host)
    {
        // Check to make sure we're given the right type of parameters
        if (creds is BasicCredentials && host is IPHost)
        {
            // Do your magic here
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T11:33:12.120

> 或者 OO 是不是开发这个功能的坏选择？

我认为 OO 的使用不会以任何方式限制您，所以问题应该是，我可以负担得起用 OO 构建这部分吗？其他样式可能会快很多。

话虽如此，我将创建以下类：

*   证书
*   身份验证服务

此外，类 User 需要一个 getCredentials() 函数。但是，这种方法意味着您*始终*使用用户名/密码进行身份验证。对于更广泛的方法，让 AuthenticationService 对 User 对象本身进行操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T11:25:22.590

如果你想要一个 OO 解决方案，我会选择使用 OO 语言并编写一些类；-)。

但说真的，在基本级别上，您将需要一个数据bean 来存储登录信息，我们称之为“登录”。然后我会选择提供身份验证的服务，我们称之为“AuthenticationService”。最后，您可以提供所需的每种不同类型的身份验证方案的具体实现。所以你会有类似的东西：

```
public class Login {
    private String loginName;
    private String password;

    /* getters / setters */
}

public interface AuthenticationService {
    public boolean isLoginValid(Login login);
}

public class LdapAuthenticationService implements AuthenticationService {
    public boolean isLoginValid(Login login) {
        /* LDAP specifics here */
    }
}

public class DatabaseAuthenticationService implements AuthenticationService {
    public boolean isLoginValid(Login login) {
        /* database specifics here */
    }
} 
```

根据您当前的需求，使用依赖注入将所需的具体实现添加到您的系统中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T11:32:42.603

面向对象的方法是使用提供的类或找到一个库并将其子类化，如果它还没有做你想要的:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T23:53:48.657

身份验证还涉及检索凭据，您需要在身份验证框架中包括如何访问凭据。这可能比已经突出显示的 Authenticator 类更重要。

```
class CredentialsAccessor {
  public bool hasCredentials(){};
  public Credentials getCredentials();
}
class FormAccessor : CredentialsAccessor {
    // get credentials from a webapp or form
}
class CookieAccessor : CredentialsAccessor {
    // get credentials based on cookie
}
class SessionAccessor : CredentialsAccessor {
    // get credentials from user session
}
class CredentialAccessManager 
{
   list<CredentialsAccessor> m_Credentials;

   Credentials getCredentials() 
   {
     foreach( CredentialsAccessor l_accessor in m_Credentials )
     {
         if( l_accessor.hasCredentials() ) return l_accessor.credentials();
     }
   }
} 
```

您以正确的顺序将所有访问器对象插入列表中，您的用户每次都会神奇地登录。

# xslt - 在 XPath 中包含不相关元素的属性

> ID：560663
> 
> 赞同：1
> 
> 时间：2009-02-18T11:23:33.610
> 
> 标签：xslt, xpath

我有以下 XML 文件：

```
<phonebook>
    <departments>
        <department id="1" parent="" title="Rabit Hole" address="" email="" index=""/>
        <department id="2" parent="" title="Big Pond" address="" email="" index=""/>
    </departments>
    <employees>
        <employee id="1" fname="Daffy" lname="Duck" title="Admin" email="daffy.duck@example.com" department="2" room="" />
        <employee id="2" fname="Bugs" lname="Bunny" title="Programmer" email="bugs.bunny@example.com" department="1" room="" />
    </employees>
</phonebook> 
```

显示时，我想显示员工的联系方式以及他工作的部门的职位。这是我在模板中的内容：

```
<xsl:for-each select="phonebook/employees/employee">
    <xsl:sort select="@lname" />
    <tr>
        <td>
            <span class="lname"><xsl:value-of select="@lname"/></span>
            <xsl:text> </xsl:text>
            <span class="fname"><xsl:value-of select="@fname"/></span>
        </td>
        <td><xsl:value-of select="@title"/></td>
        <td>
            <xsl:value-of select="/phonebook/departments/department[@id='{@department}']/@title"/>
        </td>
        <td><a href="mailto:{@email}"><xsl:value-of select="@email"/></a></td>
    </tr>
</xsl:for-each> 
```

问题是以下规则似乎不起作用：

```
<xsl:value-of select="/phonebook/departments/department[@id='{@department}']/@title"/> 
```

我猜这是因为 XSLT 引擎在元素中查找`department`属性`department`，而不是在`employee`元素中。但是，我不知道如何解决它。谁能给我一个提示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:32:53.057

有很多方法，但一个很好的可重复使用的方法是使用[**key**](http://www.w3schools.com/xsl/el_key.asp)。

定义：

```
<xsl:key name="dept" match="/phonebook/departments/department" use="@id"/> 
```

用法（当前节点是一个`<employee>`：

```
<xsl:value-of select="key('dept', @department)/@title"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T11:32:22.370

不支持选择中的 {}，我更喜欢使用变量，但另一个选项将使用 current()。但我可能会使用类似的东西：

```
<xsl:variable name="departmentId" select="@department" />
<xsl:value-of select="/phonebook/departments/department[@id=$departmentId]/@title"/> 
```

# jquery - jQuery tablesorter - AJAX 调用后功能丢失

> ID：560664
> 
> 赞同：11
> 
> 时间：2009-02-18T11:23:48.133
> 
> 标签：jquery, ajax, tablesorter

我最近一直在试验 jQuery 的 tablesorter 插件。我已经成功地启动并运行了一次，印象非常深刻。但是，我尝试将 tablesorter 应用到不同的 table，只是遇到了一些困难......

基本上，导致问题的表格在其`<ul>`上方有一个用作表格的一组选项卡。因此，如果您单击其中一个选项卡，则会进行 AJAX 调用，并使用与单击的特定选项卡相关的行重新填充表格。当页面最初加载时（即在单击选项卡之前），tablesorter 功能完全按预期工作。

但是，当单击选项卡并重新填充表格时，该功能会消失，使其没有可排序功能。即使您返回原始选项卡，在单击另一个选项卡后，该功能也不会返回 - 唯一的方法是在浏览器中物理刷新页面。

我在这个站点上看到了一个与我的问题相似的解决方案，有人建议使用 jQuery 插件 livequery。我试过这个但没有用:-(

如果有人有任何建议，我将不胜感激。如果有帮助，我可以发布代码片段（尽管我知道 tablesorter 的实例化代码很好，因为它适用于没有标签的表 - 所以绝对不是那样！）

**编辑：** 根据要求，这里有一些代码片段：
正在排序的表是`<table id="#sortableTable#">..</table>`，我正在使用的表排序器的实例化代码是：

```
$(document).ready(function() 
{ 
    $("#sortableTable").tablesorter(
    {
        headers: //disable any headers not worthy of sorting!
        {
            0: { sorter: false },
            5: { sorter: false }
        },
        sortMultiSortKey: 'ctrlKey',
        debug:true,
        widgets: ['zebra']
    }); 
}); 
```

我尝试按如下方式安装 livequery：

```
$("#sortableTable").livequery(function(){
   $(this).tablesorter();
}); 
```

但这并没有帮助......我不确定我是否应该将表的 id 与 livequery 一起使用，因为它是`<ul>`我应该响应的点击，这当然不是表本身的一部分。我尝试了多种变体，希望其中一种会有所帮助，但无济于事:-(

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-12-23T02:15:08.030

附加数据后，请执行以下操作：

```
$("your-table").trigger("update"); 
var sorting = [[0,0]]; 
$("your-table").trigger("sorton",[sorting]); 
```

这将使插件知道它有更新，并重新排序。

文档中给出的完整示例：

```
$(document).ready(function() { 
    $("table").tablesorter(); 
    $("#ajax-append").click(function() { 
         $.get("assets/ajax-content.html", function(html) { 
             // append the "ajax'd" data to the table body 
             $("table tbody").append(html); 
            // let the plugin know that we made a update 
            $("table").trigger("update"); 
            // set sorting column and direction, this will sort on the first and third column 
            var sorting = [[2,1],[0,0]]; 
            // sort on the first column 
            $("table").trigger("sorton",[sorting]); 
        }); 
        return false; 
    }); 
}); 
```

从这里的 tablesorter 文档：http: [//tablesorter.com/docs/example-ajax.html](http://tablesorter.com/docs/example-ajax.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T11:55:36.200

你试过打电话吗

```
$("#myTable").tablesorter(); 
```

在处理单击选项卡并重新填充表格的代码之后？？？如果没有，请尝试一下。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T12:12:00.200

可能是因为您的第二个表是使用 ajax 创建的，因此您需要重新绑定事件。您可能想要使用 LiveQuery 插件

[http://docs.jquery.com/Plugins/livequery](http://docs.jquery.com/Plugins/livequery)

这可能会“自动”帮助您解决问题。

编辑：对不起，只是重读你的帖子，发现你已经尝试过了。

* * *

**更新。** 我已经安装了一个快速测试工具，希望能有所帮助。顶部有 3 个 LI，每个 LI 都有不同的更新表格内容的方式。最后一个更新内容并保持排序

```
 <script src="jquery-1.3.js"  type="text/javascript" ></script>
    <script src="jquery.livequery.js"  type="text/javascript" ></script>
    <script src="jquery.tablesorter.min.js" type="text/javascript" ></script>

<script>

var newTableContents = "<thead><tr><th>Last Name</th><th>First Name</th>
<th>Email</th><th>Due</th><th>Web Site</th></tr></thead>
<tbody><tr><td>Smith</td><td>John</td><td>jsmith@gmail.com</td><td>$50.00</td>
    <td>http://www.jsmith.com</td></tr><tr><td>Bach</td><td>Frank</td><td>fbach@yahoo.com</td>
<td>$50.00</td><td>http://www.frank.com</td></tr></tbody>";

 $(document).ready(function() 
    { 
        $("#addData").click(function(event){
        $("#sortableTable").html(newTableContents);
    });

    $("#addLivequery").livequery("click", function(event){
        $("#sortableTable").html(newTableContents);
    });

    $("#addLiveTable").livequery("click", function(event){
        $("#sortableTable").html(newTableContents);
        $("#sortableTable").tablesorter( { } ); 
    });

    $("#sortableTable").tablesorter( { } ); 
  });
</script>

        <ul>
            <li id="addData" style="background-color:#ffcc99;display:inline;">Update Table</li>
            <li id="addLivequery" style="background-color:#99ccff;display:inline;">Update Table with livequery</li>
            <li id="addLiveTable" style="background-color:#99cc99;display:inline;">Update Table with livequery & tablesorter</li> 
        </ul>

        <hr />
        <table id="sortableTable"> 
        <thead> 
        <tr> 
            <th>Last Name</th> 
            <th>First Name</th> 
            <th>Email</th> 
            <th>Due</th> 
            <th>Web Site</th> 
        </tr> 
        </thead> 
        <tbody> 
        <tr> 
            <td>Jones</td> 
            <td>Joe</td> 
            <td>jjones@gmail.com</td> 
            <td>$100.00</td> 
            <td>http://www.jjones.com</td> 
        </tr> 
        <tr> 
            <td>French</td> 
            <td>Guy</td> 
            <td>gf@yahoo.com</td> 
            <td>$50.00</td> 
            <td>http://www.french.com</td> 
        </tr> 
        </tbody> 
        </table> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-11T19:00:05.987

使用 ajaxStop 函数，代码将在 ajax 调用完成后运行。

```
$("#DivBeingUpdated").ajaxStop(function(){ 
    $("table").tablesorter()
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T11:17:55.753

原来我必须对 AJAX 相关代码进行一些修改才能`$("#myTable").tablesorter(..)`在提取任何数据后重新调用......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-09T17:00:04.350

我遇到了同样的问题，除了我正在加载一个表，其中每个“类别”都有一行，然后使用异步调用将每个类别的数据插入到表中。在返回每条记录后调用`$("#myTable").tablesorter(..)`会导致我的浏览器在加载超过微不足道的记录数时崩溃。

我的解决方案是声明两个变量，`totalRecords`并且`fetchedRecords`. 在`$(document).ready()`我设置`totalRecords`为`$("#recordRows").length;`并且每次我在表中填充记录时，`fetchedRecords`变量都会递增，如果`fetchedRecords >= totalRecords`然后我调用`$("#myTable").tableSorter(..).`

对我来说效果很好。当然，您的里程可能会有所不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-04T08:25:21.697

我最近遇到了这个问题。elwyn 的解决方案对我不起作用。但是[这个主题](https://forum.jquery.com/topic/dynamically-updating-tablesorter-two-problems)表明问题在于“更新”和“排序”事件的功能同步。

如果您查看 jQuery Tablesorter 2.0 (ver. 2.0.5b) 源代码的代码，您会看到如下内容：

```
$this.bind("update", function () {
    var me = this;
    setTimeout(function () {
        // rebuild parsers.
        me.config.parsers = buildParserCache(me, $headers);
        // rebuild the cache map
        cache = buildCache(me);
    }, 1);
}).bind("sorton", function (e, list) {
    $(this).trigger("sortStart");
    config.sortList = list;
    // update and store the sortlist
    var sortList = config.sortList;
    // update header count index
    updateHeaderSortCount(this, sortList);
    // set css for headers
    setHeadersCss(this, $headers, sortList, sortCSS);
    // sort the table and append it to the dom
    appendToTable(this, multisort(this, sortList, cache));
}); 
```

所以问题在于，这`setTimeout`使得更新在排序之前完成的可能性降低。我的解决方案是实现另一个事件“updateSort”，这样上面的代码就变成了：

```
var updateFunc = function (me) {
    me.config.parsers = buildParserCache(me, $headers);
    cache = buildCache(me);
};
var sortFunc = function (me, e, list) {
    $(me).trigger("sortStart");
    config.sortList = list;
    var sortList = config.sortList;
    updateHeaderSortCount(me, sortList);
    setHeadersCss(me, $headers, sortList, sortCSS);
    appendToTable(me, multisort(me, sortList, cache));
};
$this.bind("update", function () {
    var me = this;
    setTimeout(updateFunc(me), 1);
}).bind("sorton", function(e, list) {
    var me = this;
    sortFunc(me, e, list);
}).bind("updateSort", function (e, list) {
    var me = this;
    updateFunc(me);
    sortFunc(me, e, list);
}); 
```

更新表中的数据后，您只需触发这个新事件：

```
var sorting = [[0,0]]; 
$("#your-table").trigger("updateSort",[sorting]); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-12-22T15:18:15.407

在更改您的 html 内容时调用 ajax 后，您需要更新**TableSorter**。

**为我试试这个工作正常**

*如果你附加 html*

```
$("table tbody").append(html); 
        // let the plugin know that we made a update 
        $("table").trigger("update"); 
        // set sorting column and direction, this will sort on the first and third column 
        var sorting = [[2,1],[0,0]]; 
        // sort on the first column 
        $("table").trigger("sorton",[sorting]); 
```

*当你添加新的 html 而不是旧的*

```
$("table").trigger("update");
$("table").trigger("sorton"); 
```

# c# - 在 C# 中导入 C++ dll

> ID：560677
> 
> 赞同：3
> 
> 时间：2009-02-18T11:25:41.310
> 
> 标签：c#

我创建了一个 C++ dll（比如说 MyC++Dll.dll），并且我有一个头文件（MyC++Dll.h）。MyC++Dll.h 包含类型定义。

我想在我正在创建的 C# 应用程序中导入这个 dll。

我可以使用导入 dll

[DllImport("MyC++Dll.dll")] 静态外部函数();

但我无法在包含类型定义的 C# 应用程序中导入/包含头文件 (MyC++Dll.h)。

请提出一种成功构建此 C# 应用程序的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T11:37:08.180

您必须手动将任何非标准参数类型（即自定义结构等）转换为 C#。查看[http://pinvoke.net](http://pinvoke.net)以获取有关如何使用 Win32 结构执行此操作的示例。您应该能够弄清楚如何为自己的结构执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:30:59.240

我知道的唯一方法是手动在 C# 中创建所有类型定义，确保它们与您的 dll 兼容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T16:36:18.100

您还需要学习如何将类型从 C++ 编组到 C#。

# ienumerable - IEnumerable 提供了两个 GetEnumerator 方法——它们之间有什么区别？

> ID：560678
> 
> 赞同：9
> 
> 时间：2009-02-18T11:27:18.063
> 
> 标签：ienumerable, ienumerator

当我实现`IEnumerable<T>`接口时，我看到两种`GetEnumerator`方法：一种返回`IEnumerator`，另一种`IEnumerator<T>`。我什么时候会使用一个或另一个？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-18T11:33:40.200

您通常同时实现两者。一种是更新的通用版本，它返回一个类型安全的枚举器 ( `IEnumerator<T>`)。另一个是为了与旧代码兼容（返回`IEnumerator`）。一个典型的实现是：

```
public IEnumerator<T> GetEnumerator() {
    foreach(T item in items) {
        yield return item;
    }
}

IEnumerator IEnumerable.GetEnumerator() {
    return GetEnumerator();
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-18T11:33:19.750

有两种方法的原因是因为`IEnumerable<T>`继承了`IEnumerable`接口，所以你看到的是泛型方法 from`IEnumerable<T>`和非泛型方法 from `IEnumerable`。

以下是您希望在您的类型中实现接口的方式：

```
class Foo : IEnumerable<Foo>
{
    public IEnumerator<Foo> GetEnumerator()   
    {
        // do your thing here
    }

    // do a EIMI here and simply call the generic method
    IEnumerator IEnumerable.GetEnumerator()
    {
        this.GetEnumerator();
    }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-18T11:33:48.360

如果您正在实现`IEnumerable<T>`通用接口，则几乎总是必须使用通用 GetEnumerator 方法 - 除非您将对象显式转换为（非通用）IEnumerable。

原因是向后兼容不支持泛型的 .NET 1.0/1.1。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T11:32:59.703

通常`GetEnumerator()`调用`GetEnumerator<T>()`，因此行为上应该没有太大差异。至于为什么有两种方法，这样做是为了向后兼容并用于`T`不太感兴趣（或只是未知）的情况。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T11:31:14.527

一个是通用的，另一个不是。我相信编译器更喜欢使用泛型重载。

# java - 使用免费数据库和带有 Spring 和 Hibernate Web 应用程序的 Java 进行数据库复制以实现冗余

> ID：560679
> 
> 赞同：6
> 
> 时间：2009-02-18T11:27:35.487
> 
> 标签：java, mysql, database, postgresql, redundancy

我有这个想法：

在*每台*服务器上：（它们*都*设置*相同*）

*   一个免费的数据库，如[MySQL](http://www.mysql.com/)或[PostgreSQL](http://www.postgresql.org/)。
*   [Tomcat](http://tomcat.apache.org/) 6.x 用于托管基于 Servlet 的 Java 应用程序
*   [Hibernate](http://www.hibernate.org/) 3.x 作为 ORM 工具
*   [业务层的Spring](http://en.wikipedia.org/wiki/Spring_framework) 2.5
*   表示层的[Wicket 1.3.2](http://wicket.apache.org/)

我在服务器前面放置了一个负载均衡器，并在我的主负载均衡器出现故障时更换了一个负载均衡器。

我使用[Terracotta](http://www.terracotta.org/)在服务器之间复制会话信息。如果一台服务器出现故障，用户应该能够在另一台服务器上继续他们的工作，理想情况下就像什么都没发生一样。剩下要“解决”的是（因为我还没有实际测试过这个，例如不知道我应该使用什么作为负载平衡器）是需要的数据库复制。

如果用户与应用程序交互并且数据库发生更改，则必须将该更改复制到其他服务器机器上的数据库服务器。**我该怎么做呢？我应该使用 MySQL PostgreSQL 还是其他东西（理想情况下是免费的，因为我们的预算有限）？上面的其他事情听起来合理吗？**

澄清：我首先集群以获得高可用性，我希望能够添加服务器并同时使用它们以获得高可扩展性。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T17:56:04.883

由于您已经在使用[Terracotta](http://www.terracotta.org)，并且您认为第二个 DB 是个好主意（同意），您可能会考虑扩展 Terracotta 的角色。我们有使用 Terracotta 进行数据库复制的客户。这是一个简短的示例/描述，但我认为他们已停止支持该产品的客户。：

[http://www.terracotta.org/web/display/orgsite/TCCS+Asynchronous+Data+Replication](http://www.terracotta.org/web/display/orgsite/TCCS+Asynchronous+Data+Replication)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-25T08:39:05.867

您正在尝试创建多主复制，这是一个非常糟糕的主意，因为对任何数据库的任何更改都必须复制到每个其他数据库。这非常慢 - 在一台服务器上，您可以使用几个快速磁盘和 RAID1 或 RAID10 每秒获得​​数百个事务。如果您有一个带有电池后备缓存的良好 RAID 控制器，它可能会更多。如果加上与所有服务器通信的开销，您每秒最多将获得数十个事务。

如果您想要高可用性，您应该选择一个热备用解决方案，其中您有一个服务器，该服务器被复制但未使用 - 当主服务器死亡时，替换接管。如果您的主服务器死机，您可能会丢失一些最近的交易。

您也可以进行一主多从异步复制。对数据库的每次更改都必须在一台主服务器上执行。但是您可以拥有多个从属只读服务器。此从属服务器上的数据可以是主服务器后面的多个事务，因此在服务器死亡的情况下您也可能丢失一些最近的事务。

PostgreSQL 确实有两种类型的复制——使用日志传送的热备份和一个使用 slony 的主多从属。

只有当您的写入数量非常少时，您才能进行同步复制。这也可以使用 PgPool-II 或 Sequoia 为 PostgreSQL 设置。

请阅读Postgres 文档中的[高可用性、负载平衡和复制](http://www.postgresql.org/docs/8.3/interactive/high-availability.html)章节了解更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T11:55:50.630

对于我的（Perl 驱动的）网站，我在两台具有数据库复制功能的服务器上使用 MySQL。每个 MySQL 服务器同时是从属和主控。我这样做是为了冗余，而不是为了性能，但设置在过去 3 年中运行良好，在此期间我们几乎没有停机时间。

关于 Kent 的问题/评论：我正在使用 MySQL 附带的标准复制。

关于故障转移机制：我正在使用 DNSMadeEasy.com 的故障转移功能。我有一个 Perl 脚本通过 cron 每 5 分钟运行一次，它检查复制是否仍在运行（以及许多其他事情，例如服务器负载、HDD 健全性、RAM 使用情况等）。在正常运行期间，两台服务器中速度较快的服务器会传送所有网页。如果脚本检测到服务器出现问题（或者如果服务器只是正常停机），DNSMadeEasy 会切换 DNS 条目，以便辅助服务器成为主服务器。一旦“真正的”主服务器备份，MySQL 会自动赶上丢失的数据库更改，并且 DNSMadeEasy 会自动切换回来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T11:34:53.537

这是一个想法。阅读 Theo Schlossnagle 的《Salable [Internet Architectures](https://rads.stackoverflow.com/amzn/click/com/067232699X) 》一书。

你提出的不是一个最好的主意。

负载均衡器很昂贵，而且不像看起来那么有价值。使用更简单的方法在服务器之间分配负载（例如[Wackamole](http://www.backhand.org/wackamole/)）。

与其在数据库复制上胡闹，不如把钱花在与前端 Web 服务器分开的可靠数据库服务器上。进行定期备份，万一**发生**数据库故障，请尽快从普通备份中恢复运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T09:32:42.170

AFAIK，MySQL 在可扩展性方面做得更好。请参阅文档 [http://dev.mysql.com/doc/mysql-ha-scalability/en/ha-overview.html](http://dev.mysql.com/doc/mysql-ha-scalability/en/ha-overview.html)

还有一个博客，您可以在其中查看现实生活中的示例： [http ://highscalability.com/tags/mysql](http://highscalability.com/tags/mysql)

# svn - 颠覆消除功能

> ID：560684
> 
> 赞同：22
> 
> 时间：2009-02-18T11:30:36.870
> 
> 标签：svn, svnadmin, svndump, svndumpfilter

我只是在考虑编写一个 shell 脚本，以一种易于实现的方式（在外部，使用建议的方式，但自动化）来实现 obliterate 功能。

这是我的想法：

**在客户端**

1.  `svn list -R > file-list`.
2.  以 grep 等多种方式过滤文件列表以创建文件“要删除的文件”，类似于一组`grep XXX file-list>>files-to-delete`.
3.  使用 scp传输`files-to-delete`到服务器。

**在服务器上**

1.  转储存储库`svnadmin dump /path/to/repos > repos-dumpfile`，这也可以作为备份保存。
2.  过滤转储文件，对于“要删除的文件”中的每个单词，执行以下操作：`cat repos-dumpfile | svndumpfilter exclude $file > new-dumpfile`
3.  创建一个新存储库并将新文件加载到其中`svnadmin create new-name; svnadmin load new-name < new-dumpfile`

这行得通吗？怎么会失败？还有其他想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T14:23:39.370

是的，该脚本会起作用。但通常你不会删除那么多文件。通常只有在您意外提交机密信息时才需要删除。

您确定要对这么多文件使用 obliterate 吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-19T20:29:21.140

我认为这`cat new-dumpfile | svndumpfilter exclude $file > new-dumpfile`是一个危险的例子。new-dumpfile 不会被完全处理，它的内容可能会丢失，不是吗？

从下面的评论中：new-dumpfile 肯定会丢失，因为即使在启动命令之前，shell 也会破坏它（截断到零长度）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-16T01:15:35.667

我有一个类似但稍微复杂一点的要求。在过去的数百次修订中，一些*非常*大 (>1GB) 的示例数据文件被提交到存储库。然后它们被移动并最终从 HEAD 中删除。然而，它们仍处于修订历史中，使存储库变得非常庞大。我无法使用`svn list -R`，因为文件不再出现在工作副本中。

但是，`svn list`可以给出一个修订参数。我不确定大文件是什么时候签入的，但我知道那是在 2000 年修订版之后的某个时间。我还有一个文件名列表。所以我使用了一个简单的循环和 uniq 来生成我的`files-to-delete`：

```
cd $working_copy
for rev in {2000..2437}; do
    svn ls -R -r$rev | grep -f ~/tmp/big-file-names >> ~/tmp/file-paths;
done
cat ~/tmp/file-paths | sort | uniq > ~/tmp/files-to-delete
cd ~/tmp
# You should inspect "files-to-delete" to see if it looks reasonable!
cat dumpfile | svndumpfilter exclude `cat files-to-delete` > dumpfile.new 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-25T12:37:43.003

不同版本中具有相同路径的文件呢？例如，如果您提交`/trunk/foo`，然后将其重命名为`/trunk/bar`，然后提交`/trunk/foo`您想要删除的其他内容。你不想失去现在的历史`/trunk/bar`。也许`svndumpfilter`支持[挂钩修订](http://svnbook.red-bean.com/en/1.1/ch07s03.html)？

# sql - 将标签字段添加到 asp.net 网页

> ID：560694
> 
> 赞同：0
> 
> 时间：2009-02-18T11:32:50.717
> 
> 标签：sql, vb.net, tagging

我想向网页添加一个文本字段，让用户可以添加空格分隔的标签。很像 del.icio.us。

我对如何使用 VB.NET 和 SQL 将它们从页面中取出并进入数据库更感兴趣。

谁能指出我如何使用 vb.net 和 sql 2005 实现这一目标的任何文章或代码片段？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T11:50:10.003

您将在这里需要几种技术，并且不知道您已经知道多少这可能很困难（请参阅我的评论）。

1.  您需要查看从 TextBox.Text 属性中拆分分隔字符串（使用 String.Split(" ") 来获取代表您的标签的字符串数组。

2.  您需要对被标记页面的引用（URL 或其他唯一 ID 取决于您的方案）。

3.  将两者都添加到您的数据库中，有很多方法可以做到这一点。查看 SQL Server 的 System.Data.SqlClient 命名空间。还可以使用 Visual Studio 中的数据集进行查找，因为这对您来说可能更快更容易。

你真的需要在你的问题中包含更多信息。您可能想要编辑它并添加更多关于您已经知道的内容以及您需要帮助的方面的详细信息。社区无法为您编写代码，但通过适当结构化的问题，我们将为您提供遇到的任何问题的解决方案。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:54:54.830

这是一个过于简单的例子。我正在使用 c#，但将其转换为 vb 必须是微不足道的。您将需要深入研究更多细节。

假设您使用的是网络表单，您的页面上需要一个文本框：

```
<asp:TextBox ID="txtTags" runat="server" /> 
```

假设您有一个提交按钮：

```
<asp:Button ID="btnSubmit" onclick="SaveTags" runat="server" Text="submit" /> 
```

您将有一个处理单击事件的 SaveTags 方法：

```
protected void SaveTags(object sender, EventArgs e)
{
    string[] tags = txtTags.Text.Split(' ');

    SqlConnection connection = new SqlConnection("Your connection string");
    SqlCommand command = connection.CreateCommand("Insert Into Tags(tag) Values(@tag)");
    foreach (string tag in tags)
    {
        command.Parameters.Clear();
        command.Parameters.AddWithValue("@tag", tag);
        command.ExecuteNonQuery();
    }
    connection.Close();
} 
```

# java - 在 Java 中删除非空目录

> ID：560708
> 
> 赞同：32
> 
> 时间：2009-02-18T11:37:14.357
> 
> 标签：java, file-io, recursion

假设我有一个`File f`代表一个目录的目录，那么`f.delete()`只有在目录为空时才会删除该目录。我在网上找到了几个[示例](http://www.exampledepot.com/egs/java.io/DeleteDir.html)[，](http://www.rgagnon.com/javadetails/java-0483.html)它们使用`File.listFiles()`或`File.list()`获取目录中的所有文件，然后递归遍历目录结构并删除所有文件。但是，由于可以创建无限递归的目录结构（在[Windows](http://blogs.msdn.com/oldnewthing/archive/2004/12/27/332704.aspx)和 Linux 中（带有符号链接）），因此以这种风格编写的程序可能永远不会终止。

那么，有没有更好的方法来编写这样的程序，以免陷入这些陷阱？我是否需要跟踪我走过的所有地方并确保我不会绕圈子，或者有更好的方法吗？

**更新：**为了回应一些答案（谢谢大家！） - 我宁愿代码不遵循符号链接并留在它应该删除的目录中。即使在 Windows 的情况下，我是否可以依靠 Commons-IO 实现来做到这一点？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-18T11:51:18.503

如果您真的希望您的递归目录删除遵循符号链接，那么我认为没有任何平台独立的方式可以这样做而不跟踪您遍历的所有目录。

但是，在我能想到的几乎所有情况下，您只想删除指向目录的实际符号链接，而不是递归地跟踪符号链接。

如果这是您想要的行为，那么您可以使用 Apache Commons IO 中的[FileUtils.deleteDirectory](https://commons.apache.org/proper/commons-io/javadocs/api-2.5/org/apache/commons/io/FileUtils.html#deleteDirectory(java.io.File))方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-18T11:47:39.933

尝试使用[Apache Commons IO](http://commons.apache.org/io/apidocs/org/apache/commons/io/FileUtils.html)进行测试实现。

但是，我认为它不能解决无限递归问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T11:43:22.767

[File.getCanonicalPath()](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#getCanonicalPath())将告诉您文件的“真实”名称，包括已解析的符号链接。当您在扫描时遇到一个您已经知道的目录（因为您将它们存储在[Map](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Map.html)中）时，请退出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T11:45:50.157

如果您知道哪些文件是符号链接，则可以跳过这些文件。

不幸的是，在 Java 中没有检测符号链接的“干净”方法。查看[这个](http://www.idiom.com/~zilla/Xfiles/javasymlinks.html)纯 Java 解决方法或[这个](http://www.onyxbits.de/content/blog/patrick/how-deal-filesystem-softlinkssymbolic-links-java)涉及本机代码的解决方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T11:59:08.640

至少在 MacOSX 下，删除目录的符号链接不会删除目录本身，因此即使目标目录不为空也可以删除。

我认为这适用于大多数 POSIX 操作系统。据我所知，windows下的链接也只是文件，可以从Java程序中删除。

# tsql - T-SQL 中的 Levenshtein 距离

> ID：560709
> 
> 赞同：93
> 
> 时间：2009-02-18T11:38:08.927
> 
> 标签：tsql, edit-distance, levenshtein-distance

我对 T-SQL 计算 Levenshtein 距离的算法感兴趣。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2015-01-01T20:58:05.970

我在 TSQL 中实现了标准的 Levenshtein 编辑距离函数，并进行了一些优化，从而提高了我所知道的其他版本的速度。在两个字符串的开头有共同字符（共享前缀）、结尾有共同字符（共享后缀）的情况下，并且当字符串很大并且提供了最大编辑距离时，速度的提高是显着的。例如，当输入是两个非常相似的 4000 个字符串，并且指定最大编辑距离为 2 时，这几乎比`edit_distance_within`接受答案中的函数，在 0.073 秒（73 毫秒）与 55 秒内返回答案。它还具有内存效率，使用的空间等于两个输入字符串中较大的一个加上一些常量空间。它使用表示一列的单个 nvarchar“数组”，并在其中进行所有计算，以及一些辅助 int 变量。

优化：

*   跳过共享前缀和/或后缀的处理
*   如果较大的字符串以整个较小的字符串开始或结束，则提前返回
*   如果尺寸差异保证将超过最大距离，则提前返回
*   仅使用表示矩阵中的列的单个数组（实现为 nvarchar）
*   当给定最大距离时，时间复杂度从 (len1*len2) 变为 (min(len1,len2)) 即线性
*   当给定最大距离时，一旦已知无法实现最大距离界限，就尽早返回

这是代码（2014 年 1 月 20 日更新以加快速度）：

```
-- =============================================
-- Computes and returns the Levenshtein edit distance between two strings, i.e. the
-- number of insertion, deletion, and sustitution edits required to transform one
-- string to the other, or NULL if @max is exceeded. Comparisons use the case-
-- sensitivity configured in SQL Server (case-insensitive by default).
-- 
-- Based on Sten Hjelmqvist's "Fast, memory efficient" algorithm, described
-- at http://www.codeproject.com/Articles/13525/Fast-memory-efficient-Levenshtein-algorithm,
-- with some additional optimizations.
-- =============================================
CREATE FUNCTION [dbo].[Levenshtein](
    @s nvarchar(4000)
  , @t nvarchar(4000)
  , @max int
)
RETURNS int
WITH SCHEMABINDING
AS
BEGIN
    DECLARE @distance int = 0 -- return variable
          , @v0 nvarchar(4000)-- running scratchpad for storing computed distances
          , @start int = 1      -- index (1 based) of first non-matching character between the two string
          , @i int, @j int      -- loop counters: i for s string and j for t string
          , @diag int          -- distance in cell diagonally above and left if we were using an m by n matrix
          , @left int          -- distance in cell to the left if we were using an m by n matrix
          , @sChar nchar      -- character at index i from s string
          , @thisJ int          -- temporary storage of @j to allow SELECT combining
          , @jOffset int      -- offset used to calculate starting value for j loop
          , @jEnd int          -- ending value for j loop (stopping point for processing a column)
          -- get input string lengths including any trailing spaces (which SQL Server would otherwise ignore)
          , @sLen int = datalength(@s) / datalength(left(left(@s, 1) + '.', 1))    -- length of smaller string
          , @tLen int = datalength(@t) / datalength(left(left(@t, 1) + '.', 1))    -- length of larger string
          , @lenDiff int      -- difference in length between the two strings
    -- if strings of different lengths, ensure shorter string is in s. This can result in a little
    -- faster speed by spending more time spinning just the inner loop during the main processing.
    IF (@sLen > @tLen) BEGIN
        SELECT @v0 = @s, @i = @sLen -- temporarily use v0 for swap
        SELECT @s = @t, @sLen = @tLen
        SELECT @t = @v0, @tLen = @i
    END
    SELECT @max = ISNULL(@max, @tLen)
         , @lenDiff = @tLen - @sLen
    IF @lenDiff > @max RETURN NULL

    -- suffix common to both strings can be ignored
    WHILE(@sLen > 0 AND SUBSTRING(@s, @sLen, 1) = SUBSTRING(@t, @tLen, 1))
        SELECT @sLen = @sLen - 1, @tLen = @tLen - 1

    IF (@sLen = 0) RETURN @tLen

    -- prefix common to both strings can be ignored
    WHILE (@start < @sLen AND SUBSTRING(@s, @start, 1) = SUBSTRING(@t, @start, 1)) 
        SELECT @start = @start + 1
    IF (@start > 1) BEGIN
        SELECT @sLen = @sLen - (@start - 1)
             , @tLen = @tLen - (@start - 1)

        -- if all of shorter string matches prefix and/or suffix of longer string, then
        -- edit distance is just the delete of additional characters present in longer string
        IF (@sLen <= 0) RETURN @tLen

        SELECT @s = SUBSTRING(@s, @start, @sLen)
             , @t = SUBSTRING(@t, @start, @tLen)
    END

    -- initialize v0 array of distances
    SELECT @v0 = '', @j = 1
    WHILE (@j <= @tLen) BEGIN
        SELECT @v0 = @v0 + NCHAR(CASE WHEN @j > @max THEN @max ELSE @j END)
        SELECT @j = @j + 1
    END

    SELECT @jOffset = @max - @lenDiff
         , @i = 1
    WHILE (@i <= @sLen) BEGIN
        SELECT @distance = @i
             , @diag = @i - 1
             , @sChar = SUBSTRING(@s, @i, 1)
             -- no need to look beyond window of upper left diagonal (@i) + @max cells
             -- and the lower right diagonal (@i - @lenDiff) - @max cells
             , @j = CASE WHEN @i <= @jOffset THEN 1 ELSE @i - @jOffset END
             , @jEnd = CASE WHEN @i + @max >= @tLen THEN @tLen ELSE @i + @max END
        WHILE (@j <= @jEnd) BEGIN
            -- at this point, @distance holds the previous value (the cell above if we were using an m by n matrix)
            SELECT @left = UNICODE(SUBSTRING(@v0, @j, 1))
                 , @thisJ = @j
            SELECT @distance = 
                CASE WHEN (@sChar = SUBSTRING(@t, @j, 1)) THEN @diag                    --match, no change
                     ELSE 1 + CASE WHEN @diag < @left AND @diag < @distance THEN @diag    --substitution
                                   WHEN @left < @distance THEN @left                    -- insertion
                                   ELSE @distance                                        -- deletion
                                END    END
            SELECT @v0 = STUFF(@v0, @thisJ, 1, NCHAR(@distance))
                 , @diag = @left
                 , @j = case when (@distance > @max) AND (@thisJ = @i + @lenDiff) then @jEnd + 2 else @thisJ + 1 end
        END
        SELECT @i = CASE WHEN @j > @jEnd + 1 THEN @sLen + 1 ELSE @i + 1 END
    END
    RETURN CASE WHEN @distance <= @max THEN @distance ELSE NULL END
END 
```

如该函数的注释中所述，字符比较的大小写敏感性将遵循有效的排序规则。默认情况下，SQL Server 的排序规则会导致不区分大小写的比较。将此函数修改为始终区分大小写的一种方法是将特定排序规则添加到比较字符串的两个位置。但是，我还没有彻底测试这一点，尤其是当数据库使用非默认排序规则时的副作用。这些是如何更改这两行以强制区分大小写的比较：

```
 -- prefix common to both strings can be ignored
    WHILE (@start < @sLen AND SUBSTRING(@s, @start, 1) = SUBSTRING(@t, @start, 1) COLLATE SQL_Latin1_General_Cp1_CS_AS) 
```

和

```
 SELECT @distance = 
                CASE WHEN (@sChar = SUBSTRING(@t, @j, 1) COLLATE SQL_Latin1_General_Cp1_CS_AS) THEN @diag                    --match, no change 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-02-18T11:45:04.027

Arnold Fribble 在 sqlteam.com/forums 上有两个[提案](http://www.sqlteam.com/forums/)

*   [2005 年 6 月](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=51540)的一份和
*   [2006 年 5 月](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=66781)的另一更新

这是 2006 年更年轻的一个：

```
SET QUOTED_IDENTIFIER ON 
GO
SET ANSI_NULLS ON 
GO

CREATE FUNCTION edit_distance_within(@s nvarchar(4000), @t nvarchar(4000), @d int)
RETURNS int
AS
BEGIN
  DECLARE @sl int, @tl int, @i int, @j int, @sc nchar, @c int, @c1 int,
    @cv0 nvarchar(4000), @cv1 nvarchar(4000), @cmin int
  SELECT @sl = LEN(@s), @tl = LEN(@t), @cv1 = '', @j = 1, @i = 1, @c = 0
  WHILE @j <= @tl
    SELECT @cv1 = @cv1 + NCHAR(@j), @j = @j + 1
  WHILE @i <= @sl
  BEGIN
    SELECT @sc = SUBSTRING(@s, @i, 1), @c1 = @i, @c = @i, @cv0 = '', @j = 1, @cmin = 4000
    WHILE @j <= @tl
    BEGIN
      SET @c = @c + 1
      SET @c1 = @c1 - CASE WHEN @sc = SUBSTRING(@t, @j, 1) THEN 1 ELSE 0 END
      IF @c > @c1 SET @c = @c1
      SET @c1 = UNICODE(SUBSTRING(@cv1, @j, 1)) + 1
      IF @c > @c1 SET @c = @c1
      IF @c < @cmin SET @cmin = @c
      SELECT @cv0 = @cv0 + NCHAR(@c), @j = @j + 1
    END
    IF @cmin > @d BREAK
    SELECT @cv1 = @cv0, @i = @i + 1
  END
  RETURN CASE WHEN @cmin <= @d AND @c <= @d THEN @c ELSE -1 END
END
GO 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-18T11:48:27.433

IIRC，使用 SQL Server 2005 及更高版本，您可以使用任何 .NET 语言编写存储过程：[在 SQL Server 2005 中使用 CLR 集成](http://msdn.microsoft.com/en-us/library/ms345136.aspx)。[这样，编写一个计算Levenstein distance](http://en.wikipedia.org/wiki/Levenshtein_distance)的程序就不难了。

一个简单的Hello, World！从帮助中提取：

```
using System;
using System.Data;
using Microsoft.SqlServer.Server;
using System.Data.SqlTypes;

public class HelloWorldProc
{
    [Microsoft.SqlServer.Server.SqlProcedure]
    public static void HelloWorld(out string text)
    {
        SqlContext.Pipe.Send("Hello world!" + Environment.NewLine);
        text = "Hello world!";
    }
} 
```

然后在您的 SQL Server 中运行以下命令：

```
CREATE ASSEMBLY helloworld from 'c:\helloworld.dll' WITH PERMISSION_SET = SAFE

CREATE PROCEDURE hello
@i nchar(25) OUTPUT
AS
EXTERNAL NAME helloworld.HelloWorldProc.HelloWorld 
```

现在您可以测试运行它：

```
DECLARE @J nchar(25)
EXEC hello @J out
PRINT @J 
```

希望这可以帮助。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-07-11T06:50:39.283

您可以使用 Levenshtein 距离算法来比较字符串

[在这里，您可以在http://www.kodyaz.com/articles/fuzzy-string-matching-using-levenshtein-distance-sql-server.aspx](http://www.kodyaz.com/articles/fuzzy-string-matching-using-levenshtein-distance-sql-server.aspx)找到一个 T-SQL 示例

```
CREATE FUNCTION edit_distance(@s1 nvarchar(3999), @s2 nvarchar(3999))
RETURNS int
AS
BEGIN
 DECLARE @s1_len int, @s2_len int
 DECLARE @i int, @j int, @s1_char nchar, @c int, @c_temp int
 DECLARE @cv0 varbinary(8000), @cv1 varbinary(8000)

 SELECT
  @s1_len = LEN(@s1),
  @s2_len = LEN(@s2),
  @cv1 = 0x0000,
  @j = 1, @i = 1, @c = 0

 WHILE @j <= @s2_len
  SELECT @cv1 = @cv1 + CAST(@j AS binary(2)), @j = @j + 1

 WHILE @i <= @s1_len
 BEGIN
  SELECT
   @s1_char = SUBSTRING(@s1, @i, 1),
   @c = @i,
   @cv0 = CAST(@i AS binary(2)),
   @j = 1

  WHILE @j <= @s2_len
  BEGIN
   SET @c = @c + 1
   SET @c_temp = CAST(SUBSTRING(@cv1, @j+@j-1, 2) AS int) +
    CASE WHEN @s1_char = SUBSTRING(@s2, @j, 1) THEN 0 ELSE 1 END
   IF @c > @c_temp SET @c = @c_temp
   SET @c_temp = CAST(SUBSTRING(@cv1, @j+@j+1, 2) AS int)+1
   IF @c > @c_temp SET @c = @c_temp
   SELECT @cv0 = @cv0 + CAST(@c AS binary(2)), @j = @j + 1
 END

 SELECT @cv1 = @cv0, @i = @i + 1
 END

 RETURN @c
END 
```

（约瑟夫伽马开发的功能）

用法 ：

```
select
 dbo.edit_distance('Fuzzy String Match','fuzzy string match'),
 dbo.edit_distance('fuzzy','fuzy'),
 dbo.edit_distance('Fuzzy String Match','fuzy string match'),
 dbo.edit_distance('levenshtein distance sql','levenshtein sql server'),
 dbo.edit_distance('distance','server') 
```

该算法仅返回 stpe 计数，通过一步替换不同字符将一个字符串更改为另一个字符串

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-05-19T14:02:07.540

我也在寻找 Levenshtein 算法的代码示例，很高兴在这里找到它。当然，我想了解该算法是如何工作的，并且我正在玩一些上面的示例，我正在玩一些由[Veve](https://stackoverflow.com/users/4074148/veve)发布的示例。为了更好地理解代码，我用矩阵创建了一个 EXCEL。

[FUZZY 与 FUZY 相比的距离](https://i.stack.imgur.com/nPlLi.png)

图像说超过 1000 个字。

有了这个 EXCEL，我发现有可能进行额外的性能优化。右上角红色区域的所有值都不需要计算。每个红色单元格的值导致左侧单元格的值加 1。这是因为，该区域中的第二个字符串总是比第一个字符串长，这使每个字符的距离增加了 1。

您可以通过使用语句**IF @j <= @i**并在此语句之前增加 @i 的值**来反映这一点。**

```
CREATE FUNCTION [dbo].[f_LevenshteinDistance](@s1 nvarchar(3999), @s2 nvarchar(3999))
    RETURNS int
    AS
    BEGIN
       DECLARE @s1_len  int;
       DECLARE @s2_len  int;
       DECLARE @i       int;
       DECLARE @j       int;
       DECLARE @s1_char nchar;
       DECLARE @c       int;
       DECLARE @c_temp  int;
       DECLARE @cv0     varbinary(8000);
       DECLARE @cv1     varbinary(8000);

       SELECT
          @s1_len = LEN(@s1),
          @s2_len = LEN(@s2),
          @cv1    = 0x0000  ,
          @j      = 1       , 
          @i      = 1       , 
          @c      = 0

       WHILE @j <= @s2_len
          SELECT @cv1 = @cv1 + CAST(@j AS binary(2)), @j = @j + 1;

          WHILE @i <= @s1_len
             BEGIN
                SELECT
                   @s1_char = SUBSTRING(@s1, @i, 1),
                   @c       = @i                   ,
                   @cv0     = CAST(@i AS binary(2)),
                   @j       = 1;

                SET @i = @i + 1;

                WHILE @j <= @s2_len
                   BEGIN
                      SET @c = @c + 1;

                      IF @j <= @i 
                         BEGIN
                            SET @c_temp = CAST(SUBSTRING(@cv1, @j + @j - 1, 2) AS int) + CASE WHEN @s1_char = SUBSTRING(@s2, @j, 1) THEN 0 ELSE 1 END;
                            IF @c > @c_temp SET @c = @c_temp
                            SET @c_temp = CAST(SUBSTRING(@cv1, @j + @j + 1, 2) AS int) + 1;
                            IF @c > @c_temp SET @c = @c_temp;
                         END;
                      SELECT @cv0 = @cv0 + CAST(@c AS binary(2)), @j = @j + 1;
                   END;
                SET @cv1 = @cv0;
          END;
       RETURN @c;
    END; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-01-05T15:43:08.360

在 TSQL 中，比较两个项目的最好和最快的方法是 SELECT 语句，它在索引列上连接表。因此，如果您想从 RDBMS 引擎的优势中受益，我建议您采用这种方式来实现编辑距离。TSQL 循环也可以工作，但在其他语言中，Levenstein 距离计算将比在 TSQL 中进行大量比较更快。

我已经在几个系统中实现了编辑距离，使用了一系列针对仅为该目的而设计的临时表的连接。它需要一些繁重的预处理步骤 - 临时表的准备 - 但它适用于大量比较。

简而言之：预处理包括创建、填充和索引临时表。第一个包含参考 ID、一个字母列和一个 charindex 列。该表是通过运行一系列插入查询来填充的，这些查询将每个单词拆分为字母（使用 SELECT SUBSTRING）以创建与源列表中的单词有字母一样多的行（我知道，这是很多行，但 SQL Server 可以处理数十亿行数）。然后制作第二个包含 2 个字母列的表，另一个包含 3 个字母列的表，等等。最终结果是一系列表，其中包含每个单词的参考 id 和子字符串，以及它们的位置参考在这个词中。

完成此操作后，整个游戏就是复制这些表并将它们与它们的副本连接到 GROUP BY 选择查询中，该查询计算匹配数。这为每对可能的单词创建了一系列度量，然后将这些度量重新聚合为每对单词的单个 Levenstein 距离。

从技术上讲，这与 Levenstein 距离（或其变体）的大多数其他实现非常不同，因此您需要深入了解 Levenstein 距离的工作原理以及它为何如此设计。还要研究替代方案，因为使用该方法您最终会得到一系列基础指标，这些指标可以帮助同时计算编辑距离的许多变体，从而为您提供有趣的机器学习潜在改进。

本页之前的答案已经提到的另一点：尝试尽可能多地进行预处理以消除不需要距离测量的对。例如，应该排除没有一个共同字母的两个单词对，因为编辑距离可以从字符串的长度获得。或者不要测量同一个单词的两个副本之间的距离，因为它本质上是 0。或者在进行测量之前删除重复项，如果您的单词列表来自长文本，那么相同的单词可能会出现多次，因此仅测量一次距离将节省处理时间等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-04-08T19:27:30.623

我的 Azure Synapse 模组（改为使用 SET 而不是 SELECT）：

```
-- =============================================
-- Computes and returns the Levenshtein edit distance between two strings, i.e. the
-- number of insertion, deletion, and sustitution edits required to transform one
-- string to the other, or NULL if @max is exceeded. Comparisons use the case-
-- sensitivity configured in SQL Server (case-insensitive by default).
-- 
-- Based on Sten Hjelmqvist's "Fast, memory efficient" algorithm, described
-- at http://www.codeproject.com/Articles/13525/Fast-memory-efficient-Levenshtein-algorithm,
-- with some additional optimizations.
-- =============================================
CREATE FUNCTION [db0].[Levenshtein](
    @s nvarchar(4000)
  , @t nvarchar(4000)
  , @max int
)
RETURNS int
WITH SCHEMABINDING
AS
BEGIN
    DECLARE @distance int = 0 -- return variable
          , @v0 nvarchar(4000)-- running scratchpad for storing computed distances
          , @start int = 1      -- index (1 based) of first non-matching character between the two string
          , @i int, @j int      -- loop counters: i for s string and j for t string
          , @diag int          -- distance in cell diagonally above and left if we were using an m by n matrix
          , @left int          -- distance in cell to the left if we were using an m by n matrix
          , @sChar nchar      -- character at index i from s string
          , @thisJ int          -- temporary storage of @j to allow SELECT combining
          , @jOffset int      -- offset used to calculate starting value for j loop
          , @jEnd int          -- ending value for j loop (stopping point for processing a column)
          -- get input string lengths including any trailing spaces (which SQL Server would otherwise ignore)
          , @sLen int = datalength(@s) / datalength(left(left(@s, 1) + '.', 1))    -- length of smaller string
          , @tLen int = datalength(@t) / datalength(left(left(@t, 1) + '.', 1))    -- length of larger string
          , @lenDiff int      -- difference in length between the two strings
    -- if strings of different lengths, ensure shorter string is in s. This can result in a little
    -- faster speed by spending more time spinning just the inner loop during the main processing.
    IF (@sLen > @tLen) BEGIN
        SET @v0 = @s
        SET @i = @sLen -- temporarily use v0 for swap
        SET @s = @t
        SET @sLen = @tLen
        SET @t = @v0
        SET @tLen = @i
    END
    SET @max = ISNULL(@max, @tLen)
    SET @lenDiff = @tLen - @sLen

    IF @lenDiff > @max RETURN NULL

    -- suffix common to both strings can be ignored
    WHILE(@sLen > 0 AND SUBSTRING(@s, @sLen, 1) = SUBSTRING(@t, @tLen, 1))
        SET @sLen = @sLen - 1
        SET @tLen = @tLen - 1

    IF (@sLen = 0) RETURN @tLen

    -- prefix common to both strings can be ignored
    WHILE (@start < @sLen AND SUBSTRING(@s, @start, 1) = SUBSTRING(@t, @start, 1)) 
        SET @start = @start + 1
    IF (@start > 1) BEGIN
        SET @sLen = @sLen - (@start - 1)
        SET @tLen = @tLen - (@start - 1)

        -- if all of shorter string matches prefix and/or suffix of longer string, then
        -- edit distance is just the delete of additional characters present in longer string
        IF (@sLen <= 0) RETURN @tLen

        SET @s = SUBSTRING(@s, @start, @sLen)
        SET @t = SUBSTRING(@t, @start, @tLen)
    END

    -- initialize v0 array of distances
    SET @v0 = ''
    SET @j = 1

    WHILE (@j <= @tLen) BEGIN
        SET @v0 = @v0 + NCHAR(CASE WHEN @j > @max THEN @max ELSE @j END)
        SET @j = @j + 1
    END

    SET @jOffset = @max - @lenDiff
    SET @i = 1

    WHILE (@i <= @sLen) BEGIN
        SET @distance = @i
        SET @diag = @i - 1
        SET @sChar = SUBSTRING(@s, @i, 1)
             -- no need to look beyond window of upper left diagonal (@i) + @max cells
             -- and the lower right diagonal (@i - @lenDiff) - @max cells
        SET @j = CASE WHEN @i <= @jOffset THEN 1 ELSE @i - @jOffset END
        SET @jEnd = CASE WHEN @i + @max >= @tLen THEN @tLen ELSE @i + @max END

        WHILE (@j <= @jEnd) BEGIN
            -- at this point, @distance holds the previous value (the cell above if we were using an m by n matrix)
            SET @left = UNICODE(SUBSTRING(@v0, @j, 1))
            SET @thisJ = @j

            SET @distance = 
                CASE WHEN (@sChar = SUBSTRING(@t, @j, 1)) THEN @diag                    --match, no change
                     ELSE 1 + CASE WHEN @diag < @left AND @diag < @distance THEN @diag    --substitution
                                   WHEN @left < @distance THEN @left                    -- insertion
                                   ELSE @distance                                        -- deletion
                                   END
                     END
            SET @v0 = STUFF(@v0, @thisJ, 1, NCHAR(@distance))
            SET @diag = @left
            SET @j = case when (@distance > @max) AND (@thisJ = @i + @lenDiff) 
                then @jEnd + 2 
                else @thisJ + 1 end
        END
        SET @i = CASE WHEN @j > @jEnd + 1 THEN @sLen + 1 ELSE @i + 1 END
    END
    RETURN CASE WHEN @distance <= @max THEN @distance ELSE NULL END
END 
```

# java - 简单的基于数据库的实例同步

> ID：560710
> 
> 赞同：1
> 
> 时间：2009-02-18T11:38:13.747
> 
> 标签：java, database, jakarta-ee, synchronization

我正在开发在需要执行一些定期作业（例如，每 2 分钟一次）的 java 应用服务器场中运行的服务。该服务必须与外部实体接口，并且必须同步不同的实例，以便在给定时间只有其中一个在工作上工作。由于该服务在这项工作中使用了一个 DB，我想到了基于一个简单的 DB 表来实现同步：

```
id, owner, stamp 
```

其中 id 是锁的 id，owner 是当前所有者，stamp 是它被锁定的时间。

方法是：

```
tryLock(id, maxAge, owner) - to try to lock a record or break an old record
refresh(id, owner) - to update the stamp to signal we're still around working on the job
release(id, owner) - to release the lock 
```

你将如何实现这一点？

编辑：删除了我的实现，我将它作为“答案”发布

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T11:41:52.893

我想出了以下实现，但我不确定它是否能处理所有极端情况（而且我不完全确定我是否正确使用了 BeanManagedTransaction）。另外，如果您认为可以以更简单的方式处理此同步问题，请指出正确的方向。

```
@Service(objectName=Sync.EjbName)
@Management(SyncMgt.class)
@TransactionManagement(value=TransactionManagementType.BEAN)
public class SyncSvc implements SyncMgt {

    @PersistenceContext
    protected EntityManager entityManager_;
    @Resource
    protected UserTransaction utx_;

    @TransactionAttribute(TransactionAttributeType.REQUIRED)
    private boolean update(SyncRecord sr, String owner) {
        Date stamp = (owner != null) ? new Date() : null;
        Query q;
        if (sr.getOwner() != null) {
            q = entityManager_.createQuery("UPDATE SyncRecord sr SET sr.owner = :newOwner, sr.stamp = :stamp WHERE sr.id = :id AND sr.owner = :origOwner AND sr.stamp = :origStamp");
            q.setParameter("origOwner", sr.getOwner());
            q.setParameter("origStamp", sr.getStamp()); // make it fail if someone refreshed in the meantime
        }
        else {
            q = entityManager_.createQuery("UPDATE SyncRecord sr SET sr.owner = :newOwner, sr.stamp = :stamp WHERE sr.id = :id AND sr.owner IS NULL");
        }
        q.setParameter("id", sr.getId());
        q.setParameter("newOwner", owner);
        q.setParameter("stamp", stamp);
        int res = q.executeUpdate();
        if (res != 1) {
            return false;
        }
        return true;
    }

    @TransactionAttribute(TransactionAttributeType.REQUIRED)
    private boolean tryLockImpl(String id, long maxAge, String owner) {
        SyncRecord sr = entityManager_.find(SyncRecord.class, id);
        if (sr == null) {
            // no record yet, create one
            sr = new SyncRecord(id, owner);
            sr.touch();
            entityManager_.persist(sr);
            entityManager_.flush();
            return true;
        }
        // found a SyncRecord, let's see who owns it
        if (owner.equals(sr.getOwner())) {
            // log some warning, re-locking old lock, should use refresh instead
            return update(sr, owner);
        }
        if (sr.getOwner() == null) {
            // sr is not held by anyone, safe to grab it
            return update(sr, owner);
        }
        // someone else holds it, let's check the age
        if (maxAge >= 0) {
            long maxAgeStamp = System.currentTimeMillis() - maxAge;
            if (sr.getStamp().getTime() < maxAgeStamp) {
                if (update(sr, owner)) {
                    return true;
                }
                return false;
            }
        }
        return false;
    }

    // Sync impl: 

    /**
    * Try to lock "id" for "owner"
    * If the lock is held by someone else, but is older than maxAge, break it
    */
    @TransactionAttribute(TransactionAttributeType.REQUIRES_NEW)
    public boolean tryLock(String id, long maxAge, String owner) {
        if (id == null)
            throw new IllegalArgumentException("id is null");
        try {
            utx_.begin();
            if (tryLockImpl(id, maxAge, owner)) {
                utx_.commit();
                return true;
            }
        }
        catch (EntityExistsException e) {
            // failed to lock, someone beat us to it
        }
        catch (Throwable e) {
            // some fishy error, raise alarm, log, etc
        }
        try {
            utx_.rollback();
        }
        catch (Throwable e) {
            // log the error, not much else we can do at this point
        }
        return false;
    }

    /**
    * Refresh lock "id" belonging to "owner" (update its stamp)
    */
    @TransactionAttribute(TransactionAttributeType.REQUIRES_NEW)
    public boolean refresh(String id, String owner) {
        if (id == null)
            throw new IllegalArgumentException("id is null");
        try {
            utx_.begin();
            SyncRecord sr = entityManager_.find(SyncRecord.class, id);
            if (sr == null || !owner.equals(sr.getOwner())) {
                utx_.rollback();
                return false;
            }
            if (update(sr, owner)) {
                utx_.commit();
                return true;
            }
        }
        catch (Throwable e) {
            // some fishy error, raise alarm, log, etc
        }
        try {
            utx_.rollback();
        }
        catch (Throwable e) {
            // log the error, not much else we can do at this point
        }
        return false;
    }

    /**
    * release lock "id" held by "owner"
    */
    @TransactionAttribute(TransactionAttributeType.REQUIRES_NEW)
    public void release(String id, String owner) {
        if (id == null)
            throw new IllegalArgumentException("id is null");
        try {
            utx_.begin();
            SyncRecord sr = entityManager_.find(SyncRecord.class, id);
            if (sr == null || !owner.equals(sr.getOwner())) {
                // we don't own it
                utx_.rollback();
                return;
            }
            if (update(sr, null)) {
                utx_.commit();
                return;
            }
        }
        catch (Throwable e) {
            // some fishy error, raise alarm, log, etc
        }
        try {
            utx_.rollback();
        }
        catch (Throwable e) {
            // log the error, not much else we can do at this point
        }
    }

    // LifeCycle impl:

    public void start() {}
    public void stop() {}

} 
```

# sql-server - 查询性能 - 内部联接

> ID：560711
> 
> 赞同：-4
> 
> 时间：2009-02-18T11:39:00.267
> 
> 标签：sql-server, performance, tsql

我有这个查询，我想提高性能：

```
SELECT 
    OrarioA, 
    OrarioB,
    IDOrario,
    IDDettaglioOrarioA, 
    IDDettaglioOrarioB
FROM
(
    SELECT 
        Tb_01.Orario AS OrarioA,
        Tb_02.Orario AS OrarioB,
        Tb_01.IDDettaglioOrariLinee AS IDDettaglioOrarioA,
        Tb_02.IDDettaglioOrariLinee AS IDDettaglioOrarioB,
        Tb_01.IDOrario,
        ROW_NUMBER() OVER (PARTITION BY Tb_01.Orario, Tb_02.Orario ORDER BY Tb_01.IDOrario DESC) AS Row
    FROM
        (
            SELECT Orario, IDDettaglioOrariLinee, IDOrario 
            FROM DettaglioOrariLinee 
            WHERE IDRelLineeStazionamenti = @IDRelA
        ) AS Tb_01
            INNER JOIN
        (
            SELECT Orario, IDDettaglioOrariLinee, IDOrario 
            FROM DettaglioOrariLinee 
            WHERE IDRelLineeStazionamenti = @IDRelB
        ) AS Tb_02
            ON Tb_01.IDOrario = Tb_02.IDOrario
            INNER JOIN
        (
            SELECT IDOrario 
            FROM Periodi 
            WHERE 
            (
                @Data = 0 OR
                (
                        @Data >= CAST(CAST(DATEPART(DAY, PeriodoDal) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoDal)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                    AND 
                        @Data <= CAST(CAST(DATEPART(DAY, PeriodoAl) AS  VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoAl)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                )
            )
        ) Tb_Periodi
            ON Tb_01.IDOrario = Tb_Periodi.IDOrario        --dbo.periodi ON Tb_01.IDOrario = dbo.periodi.IDOrario
            INNER JOIN                                     --dbo.relgiornisettimanaorarilinee ON Tb_01.IDOrario = dbo.relgiornisettimanaorarilinee.IDOrario
        (
            SELECT IDOrario 
            FROM relgiornisettimanaorarilinee
            WHERE @IDGiorno = 0 OR IDGiorno = @IDGiorno
        ) Tb_Giorni
            ON Tb_01.IDOrario = Tb_Giorni.IDOrario
    WHERE
        (
            @Orario = '' OR DATEDIFF(minute, CAST(@ORARIO AS DATETIME), CAST(Tb_01.Orario AS DATETIME)) >=0
        ) AND (
            DATEDIFF(minute, CAST(Tb_01.Orario AS DATETIME), CAST(Tb_02.Orario AS DATETIME)) >=0
        ) AND (
            @IDOrari = '' OR Tb_01.IDOrario NOT IN (SELECT CAST(s AS INT) AS IDOrario FROM dbo.Split(',', @IDOrari) AS Split_1)
        )
        /*
        AND
            (
                   @Data = 0
                OR
                    (
                            @Data >= CAST(CAST(DATEPART(DAY, PeriodoDal) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoDal)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                        AND 
                            @Data <= CAST(CAST(DATEPART(DAY, PeriodoAl) AS  VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoAl)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                    )
            )
        AND
            (@IDGiorno = 0 OR IDGiorno = @IDGiorno)
        */
) As Tb_New
WHERE ROW = 1

OPTION (MAXRECURSION 0); 
```

我想用 IDOrario 过滤 Tb_Periodi 和 Tb_Giorni。

如何改进此查询？

* * *

是的。我正在使用sql server 2005。它的查询被调用了很多次，每个页面请求50次它在for-cycle中。是否可以使用缓存。我不知道提高性能。我什么都试过了！

我注意到某些查询在循环中重复了很多次，根据您的说法，我该如何利用这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:49:21.550

在优化性能时，通常更好（也更容易）首先衡量瓶颈在哪里。您是否尝试过使用[查询分析器](http://msdn.microsoft.com/en-us/library/aa216945.aspx)？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T16:53:49.650

好的，

1.  查询真的有效吗？试图提高返回错误结果集的查询的性能毫无意义。

2.  您是否有可以比较的已知结果集的测试计划列表。SQL 查询改进是测试驱动开发的一个很好的例子，因为在重构查询时很容易引入错误（错误结果）。

3.  用英语描述您希望查询执行的操作 - 让我们有机会了解查询的目的。

4.  描述您的数据集（大小、索引、数据分布）

5.  你的期望是什么？这个查询应该在 1 秒、1 分钟、1 小时内完成吗？多久时间？它被调用了多少次（每秒多次还是每周一次？）

我认为您的问题被修改是不公平的 - 这是一个有效的问题，但只需要更多信息。祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T20:14:53.177

我怀疑这最终将成为数据库设计问题，而不是查询优化问题。尽管如此，分析此查询的步骤都已在上面概述。重申：

0) 考虑您的应用程序的逻辑，您可能不需要像当前那样多次运行此查询，或者您可能会发现您不需要与当前生成的格式相同的数据，允许您编写更简单、更快的查询。我将假设您需要此查询。

1) 为示例运行的查询生成执行计划。（按包含执行计划按钮或 Ctrl+m）查找执行计划中需要大量工作的部分，并查看是否可以将它们与查询的特定部分联系起来。这将为我们提供有关将精力集中在哪里的线索。玩转查询的这些部分，看看你能想出什么。

我可以看到可能有助于提高性能的一件事（取决于数据的具体情况）是尝试强制数据访问 DettaglioOrariLinee 表的顺序。例如：

```
 ;WITH DettaglioOrariLineePeriodi AS
(
        SELECT Orario, IDDettaglioOrariLinee, IDOrario 
        FROM DettaglioOrariLinee
        WHERE IDOrario IN ( SELECT IDOrario --This is still an inner join
                            FROM Periodi 
                            WHERE 
                            (
                                @Data = 0 OR
                                (
                                    @Data >= CAST(CAST(DATEPART(DAY, PeriodoDal) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoDal)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                                    AND 
                                    @Data <= CAST(CAST(DATEPART(DAY, PeriodoAl) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoAl)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
                                )
                            )
                        )
)
SELECT 
    OrarioA, 
    OrarioB,
    IDOrario,
    IDDettaglioOrarioA, 
    IDDettaglioOrarioB
FROM
(
    SELECT 
        Tb_01.Orario AS OrarioA,
        Tb_02.Orario AS OrarioB,
        Tb_01.IDDettaglioOrariLinee AS IDDettaglioOrarioA,
        Tb_02.IDDettaglioOrariLinee AS IDDettaglioOrarioB,
        Tb_01.IDOrario,
        ROW_NUMBER() OVER (PARTITION BY Tb_01.Orario, Tb_02.Orario ORDER BY Tb_01.IDOrario DESC) AS Row
    FROM
    (
        SELECT Orario, IDDettaglioOrariLinee, IDOrario
        FROM DettaglioOrariLineePeriodi                 --NEW CTE
        WHERE IDRelLineeStazionamenti = @IDRelA
    ) AS Tb_01
    INNER JOIN
    (
        SELECT Orario, IDDettaglioOrariLinee, IDOrario 
        FROM DettaglioOrariLineePeriodi                 --NEW CTE
        WHERE IDRelLineeStazionamenti = @IDRelB
    ) AS Tb_02
    ON Tb_01.IDOrario = Tb_02.IDOrario
    INNER JOIN --dbo.relgiornisettimanaorarilinee ON Tb_01.IDOrario = dbo.relgiornisettimanaorarilinee.IDOrario
    (
        SELECT IDOrario 
        FROM relgiornisettimanaorarilinee
        WHERE @IDGiorno = 0 OR IDGiorno = @IDGiorno
    ) Tb_Giorni
    ON Tb_01.IDOrario = Tb_Giorni.IDOrario
    WHERE
    (
    @Orario = '' OR DATEDIFF(minute, CAST(@ORARIO AS DATETIME), CAST(Tb_01.Orario AS DATETIME)) >=0
    ) AND (
    DATEDIFF(minute, CAST(Tb_01.Orario AS DATETIME), CAST(Tb_02.Orario AS DATETIME)) >=0
    ) AND (
    @IDOrari = '' OR Tb_01.IDOrario NOT IN (SELECT CAST(s AS INT) AS IDOrario FROM dbo.Split(',', @IDOrari) AS Split_1)
    )
/*
AND
(
@Data = 0
OR
(
@Data >= CAST(CAST(DATEPART(DAY, PeriodoDal) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoDal)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
AND 
@Data <= CAST(CAST(DATEPART(DAY, PeriodoAl) AS VARCHAR)+'/'+ CAST(DATEPART(MONTH, PeriodoAl)AS VARCHAR) +'/'+ CAST(DATEPART(YEAR,@Data)AS VARCHAR) AS DATETIME)
)
)
AND
(@IDGiorno = 0 OR IDGiorno = @IDGiorno)
*/
) As Tb_New
WHERE ROW = 1

OPTION (MAXRECURSION 0); 
```

您可以尝试的另一件事是更换生产线

```
@IDOrari = '' OR Tb_01.IDOrario NOT IN (SELECT CAST(s AS INT) AS IDOrario FROM dbo.Split(',', @IDOrari) AS Split_1) 
```

和

```
@IDOrari = '' OR (@IDOrari NOT LIKE Tb_01.IDOrario + ',%' AND @IDOrari NOT LIKE '%,' + Tb_01.IDOrario + ',%' AND @IDOrari NOT LIKE '%,' + Tb_01.IDOrario) 
```

3）如果你找不到任何有用的东西，或者你有一堆表扫描，下一步是看看你是否可以修改这些表的索引。我推荐的是加载 SQL 分析器（您可能需要从 sql 磁盘安装它）并创建一个新跟踪。一旦开始跟踪，执行耗时过长的操作，然后停止跟踪。将跟踪保存到文件中，然后启动数据库引擎优化顾问。加载文件，选择要调整的数据库，然后按“开始跟踪”。

希望这将为您提供建议列表。我将重点关注对 DettaglioOrariLinee 表的更改，以及任何其他通过扫描操作占用大部分执行计划的表。

我强烈建议不要直接从该工具实施建议的更改，而是使用这些建议作为指导。

4）如果以上都没有给你所需的性能改进，你可以考虑对表 DettaglioOrariLinee 进行非规范化，以便每一行都有 A 和 B 侧的数据。这可能不是一个好主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T16:34:11.600

Well look at the execution plan to see what it is doing. You may find some indexes will help, but looking at that code I doubt it will be that simple.

立即想到的有助于提高性能的一件事是更改您的结构以将日期正确存储在日期时间数据类型中。这将消除大量的演员表并转换必须对每一行采取行动的东西，特别是在 where 子句中，它必须将这些东西连接到每一行的日期中，以便应用 where 条件。如果您正在执行任何数据操作，则必须存储为日期时间数据类型，否则可能会出现性能不佳的情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T19:31:16.823

如果不知道表的结构以及它们上存在哪些索引或统计信息，则很难对查询性能进行故障排除。正如建议的那样，您最好的第一步是查看执行计划并确定您的大部分成本在哪里。一个常见的解决方法是实现额外的索引来减少表扫描。

查询调优在某种程度上是一门艺术，所以你们很多人在这个问题上找不到一个“正确”的共识。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T19:36:02.863

正如其他人所提到的，在不了解所有事实的情况下很难提出建议。除了其他人给出的建议之外，如果您经常运行此查询，或者在其他查询中使用一些内部查询，您可能会受益于将它们转换为视图。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T22:46:16.047

不错的代码：-o

正如许多人所说，当我们对数据或您想要实现的目标一无所知时，很难为您提供帮助。

但我可以给你一些建议：

*   查看[http://sql-server-performance.com](http://sql-server-performance.com)以获取有关谁来分析和提高查询性能的信息。他们也有一个论坛，但除非您提供更多信息，否则他们可能也无法为您提供帮助。

*   WHERE 或 ON 子句中的 OR 往往会导致性能不佳

*   IN也容易导致性能不佳
*   WHERE 或 ON 子句中的函数（UDF 或内置）也对性能不利。

您结合了以上所有内容，所以我并不感到惊讶.. 此外，子查询和派生表（您也使用）不一定会导致性能不佳，但使用错误肯定可以:-)

对于 T-SQL 的初学者，我建议保持简单。例如，将大查询拆分为您理解的较小查询，使用变量或临时表来保存数据。

许多较小的查询可能会导致比大的查询更差的性能，但是不理解您的代码或为什么它会导致性能不佳会更糟:)

祝你好运

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T22:50:18.673

我看到了你关于缓存的注释。当然也可以，只要为结果建一个表，把查询的结果插入到表中即可。

确保在需要时清除缓存表（例如使用触发器或其他方式）

我不能说，根据您的系统，使用缓存是一个好还是坏的选择。

此外，如果此代码尚未在存储过程中，请将其放在一个存储过程中，因为它使 SQL Server 更容易缓存计划等。

我建议修复错误代码，而不是用缓存隐藏问题。

干杯

/L

# java - Java 中的文档渲染

> ID：560712
> 
> 赞同：2
> 
> 时间：2009-02-18T11:39:32.650
> 
> 标签：java, image, ms-word, rendering

我想从服务器端 Java 将 MSWord、PDF、HTML 等渲染为图像（例如 TIFF）。

大多数可用的产品是共享软件打印机驱动程序，因此不适合商业服务器应用程序：我想要一个强大、支持良好、高性能和并发的库。

对开源或商业图书馆有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T11:56:38.053

参考这些：

*   [将 PDF 转换为 TIFF 的好库？](https://stackoverflow.com/questions/356550/a-good-library-for-converting-pdf-to-tiff);
*   [将 PDF 页面导出为 Java 中的一系列图像](https://stackoverflow.com/questions/550129/export-pdf-pages-to-a-series-of-images-in-java)；和
*   [用于将 Word 文档转换为 PDF 或图像的 Java 库](https://stackoverflow.com/questions/437394/java-library-for-converting-word-documents-to-pdfs-or-images)。

而且，如果您在搜索中没有找到它们也不要紧，您可能只是使用 SO 搜索而不是谷歌搜索“site:stackoverflow.com convert pdf image java”（等）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T11:54:44.377

似乎在此 API [iText](http://www.lowagie.com/iText/)的某个地方，您将能够将 PDF 呈现为图像。对于 HTML，您可以考虑[Flying Saucer](http://code.google.com/p/flying-saucer//)（但该项目看起来很死板）。[遗憾的是 JWebPane](http://weblogs.java.net/blog/ixmal/archive/2008/05/introducing_jwe.html)还没有准备好。

对于 MSWord ......没有线索。

# statistics - 使用数据挖掘/统计进行日志监控

> ID：560713
> 
> 赞同：0
> 
> 时间：2009-02-18T11:39:39.390
> 
> 标签：statistics, data-mining

我有大量的日志文件，我想描述或可能添加某种决策树或某种分析。但我不知道具体是什么。你对日志文件做了什么样的分析，大量的日志文件。

例如，到目前为止，我正在收集对给定日志文件的特定页面发出的请求数。

Servlet = 60 个请求 Servlet2 = 70 个请求，等等。

我想就在那里，只过滤最流行的请求。此外，在 2 小时内可能会执行 60 个请求。60 / 160 分钟。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T09:54:15.723

决定做什么分析取决于你试图根据该分析做出什么决定。例如，我目前监控我们的应用程序报告的异常日志（客户端应用程序中的所有异常都记录在服务器上）以确定哪些应该是高优先级的客户端错误来调查。我还使用日志搜索软件来监控我们的服务器软件报告的任何可能需要立即调查的异常。除了一切生成的日志之外，我还使用一些监控软件来跟踪我们的 Web 服务器和数据库服务器的使用情况，这些服务器在数据库中记录使用情况统计信息等。这样做的最终目的是预测未来的使用水平并酌情购买更多硬件以满足需求。

我一直在使用的两个（免费）工具是：

[Hyperic](http://www.hyperic.com/)用于监控，它很容易设置，并且可能能够开始记录您可能感兴趣的大量数据，即网络服务器上的每秒请求数。

[Splunk](http://www.splunk.com/)用于搜索日志文件，它非常易于设置和使用，并为您提供出色的日志文件搜索功能。如果您现在正在使用日志文件并且还没有尝试过 splunk，我绝对推荐它。我注意到在我们的主要生产服务器上使用它时有几个 100% cpu 的时刻，所以最近停止在那台机器上运行它，只是一个警告。

不确定您的分析目标是什么，我一直非常关注寻找我应该知道的任何错误，并计划未来的容量需求。如果您对后者感兴趣，我还推荐[The Art of Capacity Planning](http://astore.amazon.com/possiboutpos-20/detail/0596518579)。

# scrum - 如何将用户的需求转化为需要做的实际工作？

> ID：560718
> 
> 赞同：2
> 
> 时间：2009-02-18T11:41:22.723
> 
> 标签：scrum, user-stories

我们使用 Scrum 方法。假设产品所有者想要一个允许用户搜索网站内容的新功能。

总工作量为 8 分，这些将是用户故事：

*   用户可以输入搜索词（0分）
*   搜索结果显示给用户（8分）

我想更深入地了解开发人员的进度。但是，我无法进一步分解这些故事。

然而，我可以重写这些故事。我很不情愿，因为这些故事都是技术故事。

*   添加搜索文本框（0 分）
*   在数据库中创建索引表（0 分）
*   确保在数据 ABC 更改时更新索引表（3 分）
*   确保在数据 XYZ 更改时更新索引表（2 分）
*   从数据库中获取结果（1 分）
*   为每个搜索结果撰写正确的网址（2 分）

*你如何处理这些情况？*

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T11:45:58.033

您不应将这些故事进一步分解为其他技术故事。

在 Sprint 计划会议期间，团队将故事分解为任务。然后以小时数估算这些任务。

在 Sprint 期间，您可以在 Sprint 燃尽图中跟踪剩余小时数。

这些故事是为最终用户准备的。

任务是针对团队的（UI 设计、开发、编码、测试、文档等）

# c# - ASMX Web 服务公开类

> ID：560722
> 
> 赞同：3
> 
> 时间：2009-02-18T11:42:34.780
> 
> 标签：c#, .net, web-services, asmx

我正在使用简单的 ASMX 服务在 asp.net/c# 中创建一个基本的 Web 服务。当我创建一个返回类的方法时，服务的客户可以发现这个类定义。

我想知道是否有一种方法可以将一个类公开给未在任何服务方法中直接使用的服务。我需要我的服务客户了解特定类，即使它在任何方法中都没有显示为返回值或参数类型。

我意识到这是一个奇怪的要求，但它的出现是因为我们正在序列化对象并压缩序列化文件。我们最终将对象作为 byte[] 发送。当在另一端反序列化它时，这会导致问题，因为客户端不知道该类。

有没有办法装饰一个类，以便通过服务发现可以发现它？

提前致谢，

马丁。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T11:50:21.737

在公开的类上使用[XmlInclude](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlincludeattribute.aspx)属性来包含另一个类。

# linux - 如何 tar 正在被另一个进程使用的文件？

> ID：560731
> 
> 赞同：3
> 
> 时间：2009-02-18T11:44:44.573
> 
> 标签：linux, perl, archive, tar

我正在归档一个目录。该目录有一个正在由另一个进程写入的文件。当我使用 Linux tar/Perl Tar 模块 tar 时，在存档中文件的条目在那里，但内容为空。

在压缩文件之前...

```
-rw-r--r--  1 irraju dba 28 Feb 18 02:22 a
-rw-r--r--  1 irraju dba 25 Feb 18 02:23 b
-rw-r--r--  1 irraju dba 29 Feb 18 03:38 c 
```

解压后

```
-rw-r--r-- irraju/dba       28 2009-02-18 02:22:58 a
-rw-r--r-- irraju/dba       25 2009-02-18 02:23:17 b
-rw-r--r-- irraju/dba        0 2009-02-18 03:33:12 c 
```

我该如何解决这个问题？我希望该文件与存档时的内容一起保存在存档中。该文件可以是日志文件，并假设我们无法在 tarring 之前关闭文件句柄。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T13:13:47.260

当您用“Linux”标记问题时，您可能正在使用 LVM 分区。如果您确实在 LVM 分区上运行，则可以使用 LVM 快照功能。

[这是有关如何执行操作](http://tldp.org/HOWTO/LVM-HOWTO/snapshots_backup.html)的相关 LVM 文档的链接。

这是[LVM 快照介绍](http://tldp.org/HOWTO/LVM-HOWTO/snapshotintro.html)的一部分：

> LVM 提供的一个很棒的工具是“快照”。这允许管理员创建一个新的块设备，它提供一个逻辑卷的精确副本，在某个时间点冻结​​。通常，当需要在逻辑卷上执行一些批处理（例如备份），但您不想停止正在更改数据的活动系统时，通常会使用此选项。当快照设备完成后，系统管理员可以删除设备。此功能确实要求在逻辑卷上的数据处于一致状态时创建快照 - LVM1 的 VFS 锁定补丁确保某些文件系统在创建快照时自动执行此操作，并且许多2.6 内核中的文件系统会在创建快照时自动执行此操作而无需打补丁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T11:52:14.820

尝试先复制文件...

```
cp a a.tmp
cp b b.tmp
cp c c.tmp 
```

...然后将所有内容打包在一起...

```
tar *.tmp abc.tar 
```

...并清理：

```
rm *.tmp 
```

如果这不起作用，那么持有文件句柄的进程不想共享读取访问权限......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T11:53:19.357

您可能会发现这取决于使用的文件系统和访问文件的应用程序。最接近通用解决方案的是使用支持快照的文件系统并在运行 tar 之前创建快照。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T12:26:45.533

您的第二个输出是*在*您的第一个输出之后进行的，这是不对的。我猜`tar`就在这里：当它工作时，文件是空的。您可能正在处理这里的竞争条件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T13:16:33.527

As others have said, it depends on the file system & OS being used. `sync` first (or whatever the equivalent is on your file system), copy the files to a temp directory and then tar them up. If the file system won't allow you to copy an opened file, then you're SOL; Perl can't get around file system limitations.

# c# - NHibernate / ActiveRecord：如何在不获取整个对象的情况下设置外键？

> ID：560734
> 
> 赞同：3
> 
> 时间：2009-02-18T11:45:35.973
> 
> 标签：c#, nhibernate, activerecord, castle-activerecord

假设我有以下 ActiveRecord 类：

```
[ActiveRecord]
public class Account
{
    ...

    [BelongsTo("CustomerId")]
    public Customer Customer { get; set; }
} 
```

目前，要设置 CustomerId 字段的值，我必须从数据库中获取整个 Customer 对象并将其分配给 Account：

```
Customer customer = Customer.FindById(1);
account.Customer = customer; 
```

这不是很有效。我宁愿直接设置 CustomerId 字段的值，而不需要往返数据库，例如

```
account.CustomerId = 1; 
```

这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-25T10:01:01.413

我不知道 Castle ActiveRecord 如何使用 NHibernate 从数据库加载对象（使用`ISession.Get`或`ISession.Load`？），但我知道可以使用 NHibernate 完成以下操作：

```
var ghostCustomer = session.Load<Customer>(customerId);

var account = session.Get<Account>(accountId);
account.Customer = ghostCustomer; 
```

在这里，`ghostCustomer`将是一个未初始化的代理对象，其字段将在第一次访问时被延迟加载。但是由于我们只使用它来分配帐户上的客户关系，因此它永远不会真正加载。

因此，此示例中唯一的数据库访问将发生在加载帐户时以及之后刷新会话并且必须更新帐户时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:11:01.797

这取决于，真的。您可以实施缓存以减轻获取可能不会像客户一样经常更改的数据的负担。请注意，这可能是过早的优化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:29:52.453

我同意 Neil，但如果你真的想要这个，你可以用[IQuery.ExecuteUpdate()](http://darioquintana.com.ar/blogging/?p=23)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-22T23:42:57.520

您可以在 ActiveRecord 中实现 MK8k 的解决方案。它看起来像这样：

```
using (new SessionScope()) {
    var ghostCustomer = Customer.Find(customerId);

    var account = Account.TryFind(accountId);
    account.Customer = ghostCustomer;
} 
```

两个重要的点：

Customer.Find 必须在 SessionScope 中。如果未定义 SessionScope，Find 方法会检查并完全加载您的对象。

Customer 类必须定义为惰性类。NHibernate 不会为非惰性类使用代理。

# linux - 如何配置 Apache 2 以运行 Perl CGI 脚本？

> ID：560749
> 
> 赞同：48
> 
> 时间：2009-02-18T11:50:31.080
> 
> 标签：linux, perl, apache, cgi

我想配置运行的 Apache 2`Kubuntu`来执行 Perl CGI 脚本。我尝试了一些通过谷歌搜索遇到的步骤，但似乎没有任何效果。

实现这一目标的正确方法是什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-11-28T11:41:12.303

这篇文章旨在拯救那些遭受*无法在 Ubuntu 上为 Perl 正确设置 Apache2 的人。（特定于您的 Linux 机器的系统配置将在方括号中提及，例如 [this]）。

不正确设置 Apache 2 的可能结果：

1.  浏览器尝试下载 .pl 文件而不是执行并给出结果。
2.  禁止。
3.  内部服务器错误。

如果一个人以合理的智慧遵循下面描述的步骤，他/她可以克服上述错误。

在开始这些步骤之前。转到`/etc/hosts`文件并添加 IP 地址/域名`，例如：

```
127.0.0.1 www.BECK.com 
```

第 1 步：安装`apache2` 第 2 步：安装`mod_perl` 第 3 步：配置`apache2`

打开`sites-available/default`并添加以下内容，

```
<Files ~ "\.(pl|cgi)$">
    SetHandler perl-script
    PerlResponseHandler ModPerl::PerlRun
    Options +ExecCGI
    PerlSendHeader On
</Files>

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
<Directory [path-to-store-your-website-files-like-.html-(perl-scripts-should-be-stored-in-cgi-bin] >
####(The Perl/CGI scripts can be stored out of the cgi-bin directory, but that's a story for another day. Let's concentrate on washing out the issue at hand)
####
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
</Directory>

ScriptAlias /cgi-bin/ [path-where-you-want-your-.pl-and-.cgi-files]

<Directory [path-where-you-want-your-.pl-and-.cgi-files]>
    AllowOverride None
    Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
    AddHandler cgi-script .pl
    Order allow,deny
    allow from all
</Directory>
<Files ~ "\.(pl|cgi)$">
    SetHandler perl-script
    PerlResponseHandler ModPerl::PerlRun
    Options +ExecCGI
    PerlSendHeader On
</Files>

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>
<Directory [path-to-store-your-website-files-like-.html-(perl-scripts-should-be-stored-in-cgi-bin] >
####(The Perl/CGI scripts can be stored out of the cgi-bin directory, but that's a story for another day. Let's concentrate on washing out the issue at hand)
####
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
</Directory>

ScriptAlias /cgi-bin/ [path-where-you-want-your-.pl-and-.cgi-files]

<Directory [path-where-you-want-your-.pl-and-.cgi-files]>
    AllowOverride None
    Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
    AddHandler cgi-script .pl
    Order allow,deny
    allow from all
</Directory> 
```

### 第4步：

将以下行添加到您的`/etc/apache2/apache2.conf`文件中。

```
AddHandler cgi-script .cgi .pl
<Files ~ "\.pl$">
Options +ExecCGI
</Files>
<Files ~ "\.cgi$">
Options +ExecCGI
</Files>

<IfModule mod_perl.c>
<IfModule mod_alias.c>
Alias /perl/ /home/sly/host/perl/
</IfModule>
<Location /perl>
SetHandler perl-script
PerlHandler Apache::Registry
Options +ExecCGI
</Location>
</IfModule>

<Files ~ "\.pl$">
Options +ExecCGI
</Files> 
```

### 第 5 步：

**非常重要**，或者至少我猜是这样，只有在完成这一步之后，我才能让它工作。

`AddHandler cgi-script .cgi .pl`

```
<Files ~ "\.pl$">
Options +ExecCGI
</Files>
<Files ~ "\.cgi$">
Options +ExecCGI
</Files>

<IfModule mod_perl.c>
<IfModule mod_alias.c>
Alias /perl/ /home/sly/host/perl/
</IfModule>
<Location /perl>
SetHandler perl-script
PerlHandler Apache::Registry
Options +ExecCGI
</Location>
</IfModule>

<Files ~ "\.pl$">
Options +ExecCGI
</Files> 
```

### 第 6 步

**非常重要**，或者至少我猜是这样，只有在完成这一步之后，我才能让它工作。

将以下内容添加到您的`/etc/apache2/sites-enabled/000-default`文件中

```
<Files ~ "\.(pl|cgi)$">
SetHandler perl-script
PerlResponseHandler ModPerl::PerlRun
Options +ExecCGI
PerlSendHeader On
</Files> 
```

### 第 7 步：

现在，将您的 Perl 脚本作为 test.pl 添加到您之前在步骤 3 中提到的 [ *path-where-you-want-your-.pl-and-.cgi-files* ] 的位置。

使用授予`.pl`文件权限`chmod`，然后`webaddress/cgi-bin/test.pl`在浏览器的地址栏中键入 ，然后就可以了。

（现在，这篇文章中的许多内容都是多余的。请忽略它。）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-18T12:32:51.743

您需要查看 Apache 错误日志以了解“内部服务器错误”是什么。根据我的经验，最有可能的四种情况是：

1.  CGI 程序位于未启用 CGI 执行的目录中。解决方案：`ExecCGI`通过 httpd.conf 或 .htaccess 文件将选项添加到该目录。

2.  Apache 仅配置为从专用`cgi-bin`目录运行 CGI。解决方案：将 CGI 程序移到那里或`AddHandler cgi-script .cgi`在 httpd.conf 中添加一条语句。

3.  CGI 程序未设置为可执行文件。解决方案（假设是 *nix 类型的操作系统）：`chmod +x my_prog.cgi`

4.  CGI 程序正在退出而不发送标头。解决方案：从命令行运行程序并验证 a) 它实际运行而不是因编译时错误而死 b) 它生成正确的输出，其中至少应包括一个`Content-Type`标题和一个空行在其最后一个标题之后。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-03-02T11:37:38.360

*（即使我没有要求 perl，谷歌搜索也让我想到了这个问题）*

我在运行脚本时遇到问题（尽管 bash 不是 perl）。Apache 有一个配置，`ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/`但是 Apache 错误日志显示`File does not exist: /var/www/cgi-bin/test.html`。

尝试将脚本放在两者中`/usr/lib/cgi-bin/`，`/var/www/cgi-bin/`但都没有工作。

经过长时间的谷歌搜索后，对我来说破解它的是 `sudo a2enmod cgi`，一切都使用`/usr/lib/cgi-bin/`.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-08-04T06:33:35.650

如果您已成功安装 Apache Web 服务器和 Perl，请按照以下步骤在 ubuntu 系统上使用 perl 运行 cgi 脚本。

在开始使用 CGI 脚本之前，有必要配置 apache 服务器，使其能够识别 CGI 目录（保存 cgi 程序的位置）并允许在该目录中执行程序。

1.  在 Ubuntu 中，cgi-bin 目录通常位于路径 /usr/lib 中，如果不存在，则使用以下命令创建 cgi-bin 目录。**cgi-bin**本身应该在这个路径中。

    ```
     mkdir /usr/lib/cgi-bin 
    ```

2.  发出以下命令以检查目录的权限状态。

    ```
     ls -l /usr/lib | less 
    ```

检查权限是否为“drwxr-xr-x 2 root root 4096 2011-11-23 09:08 cgi-bin”，如果是，则转到步骤 3。

如果没有发出以下命令以确保我们的 cgi-bin 目录具有适当的权限。

```
 sudo chmod 755 /usr/lib/cgi-bin
     sudo chmod root.root /usr/lib/cgi-bin 
```

3.  赋予 cgi-bin 目录执行权限

    ```
     sudo chmod 755 /usr/lib/cgi-bin 
    ```

这样你的 cgi-bin 目录就可以使用了。这是您放置所有 cgi 脚本以供执行的地方。我们的下一步是配置 apache 以识别 cgi-bin 目录并允许将其中的所有程序作为 cgi 脚本执行。

**使用 perl 配置 Apache 以运行 CGI 脚本**

1.  需要在 apache 服务器的配置文件中添加一个指令，以便它知道 CGI 的存在及其目录的位置。最初转到 apache 配置文件的位置并使用您喜欢的文本编辑器打开它

    ```
    cd /etc/apache2/sites-available/ 
    sudo gedit 000-default.conf 
    ```

2.  将以下内容复制到代码行“DocumentRoot /var/www/html/”和“ErrorLog $ {APACHE_LOG_DIR}/error.log”之间的文件 000-default.conf

    ```
    ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
    <Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    Require all granted 
    ```

3.  使用以下代码重新启动 apache 服务器

    ```
    sudo service apache2 restart 
    ```

4.  现在我们需要启用默认存在于较新版本的 ubuntu 中的 cgi 模块

    ```
    sudo a2enmod cgi.load
    sudo a2enmod cgid.load 
    ```

5.  此时我们可以重新加载 apache 网络服务器，以便它再次读取配置文件。

    ```
    sudo service apache2 reload 
    ```

apache 的配置部分已经结束，现在让我们用一个示例 cgi perl 程序来检查它。

**测试一下**

1.  进入 cgi-bin 目录并创建一个扩展名为 .pl 的 cgi 文件

    ```
    cd /usr/lib/cgi-bin/
    sudo gedit test.pl 
    ```

2.  在 test.pl 上复制以下代码并保存。

    ```
    #!/usr/bin/perl -w
    print “Content-type: text/html\r\n\r\n”;
    print “CGI working perfectly!! \n”; 
    ```

3.  现在给 test.pl 执行权限。

    ```
    sudo chmod 755 test.pl 
    ```

4.  现在在您的网络浏览器中打开该文件[http://Localhost/cgi-bin/test.pl](http://Localhost/cgi-bin/test.pl)

5.  如果您看到输出“CGI working perfect”，您就可以开始了。现在将所有程序转储到 cgi-bin 目录并开始使用它们。

注意：不要忘记给你的新程序在 cgi-bin, chmod 755 权限，以便成功运行它而不会出现任何内部服务器错误。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-09-07T21:51:16.630

从[Ubuntu 12.04](https://en.wikipedia.org/wiki/Ubuntu_version_history#Ubuntu_12.04_LTS_.28Precise_Pangolin.29)（Precise Pangolin）（可能是之前的一两个版本）开始，只需安装`apache2`和`mod-perl`通过 Synaptic 并将您的 CGI 脚本放在 /usr/lib/cgi-bin 中就可以了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-06-26T21:08:46.763

有两种方法可以处理 CGI 脚本，[`SetHandler`](https://httpd.apache.org/docs/current/mod/core.html#sethandler)和[`AddHandler`](https://httpd.apache.org/docs/current/mod/mod_mime.html#addhandler).

```
SetHandler cgi-script 
```

适用于给定[context](https://httpd.apache.org/docs/current/mod/directive-dict.html#Context)中的所有文件，无论它们如何命名，`index.html`甚至`style.css`.

```
AddHandler cgi-script .pl 
```

类似，但适用于`.pl`给定上下文中以 , 结尾的文件。如果您愿意，您可以选择另一个或多个扩展名。

此外，必须加载和[`Options +ExecCGI`](https://httpd.apache.org/docs/current/mod/core.html#options)配置 CGI 模块。要激活模块，请发出

```
a2enmod cgi 
```

并重新启动或重新加载 Apache。最后，Perl CGI 脚本必须是可执行的。所以必须设置执行位

```
chmod a+x script.pl 
```

它应该从

```
#! /usr/bin/perl 
```

作为它的第一行。

* * *

当您在任何指令之外使用`SetHandler`or `AddHandler`(and `Options +ExecCGI`) 时，它将全局应用于所有文件。但是您可以通过将这些指令包含在其中来将上下文限制为一个子集，例如[`Directory`](https://httpd.apache.org/docs/current/mod/core.html#directory)

```
<Directory /path/to/some/cgi-dir>
    SetHandler cgi-script
    Options +ExecCGI
</Directory> 
```

现在`SetHandler`仅适用于 /path/to/some/cgi-dir 内的文件，而不是网站的所有文件。当然，`AddHandler`在`Directory`or`Location`指令内部也是如此。然后它适用于 /path/to/some/cgi-dir 中的文件，以`.pl`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T11:57:09.753

我猜你已经看过[mod_perl](http://perl.apache.org/)了？

您是否尝试过以下[教程](http://perl.apache.org/docs/1.0/guide/getwet.html)？

编辑：关于您的发布 - 也许您可以在`.cgi`文件中包含代码示例。甚至前几行？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-03-07T17:26:11.787

对于像我这样一直在摸索你现在不需要知道的教程和文档的人，只是想看看对初学者有用的东西，我发现我唯一拥有的东西要做的是添加：

AddHandler cgi-script .pl .cgi

到我的配置文件。

[http://httpd.apache.org/docs/2.2/mod/mod_mime.html#addhandler](http://httpd.apache.org/docs/2.2/mod/mod_mime.html#addhandler)

对于我的情况，这最有效，因为我可以将我的 perl 脚本放在我想要的任何地方，只需添加 .pl 或 .cgi 扩展名。

Dave Sherohman 的回答也提到了 AddHandler 解决方案。

当然，您仍然必须确保正确设置脚本的权限/所有权，尤其是脚本是可执行的。记下从 http 请求运行时的“用户”是谁 - 例如，www 或 www-data。

# vb.net - 如何使用 vb.net 以编程方式对 Excel 中的列进行排序？

> ID：560750
> 
> 赞同：4
> 
> 时间：2009-02-18T11:50:38.460
> 
> 标签：vb.net, excel

我们正在生成一个 Excel 报告，我们需要在保存文件之前以编程方式对数据进行排序。

是否可以使用 vb.net 以编程方式对 Excel 文件的特定列进行排序？

根据您的建议，为了生成对特定列进行排序的 excel 报告，我刚刚实现了如下逻辑..

```
Dim MyRange As Excel.Range
  gobjExcelReportSheet.Activate()
      MyRange = gobjExcelReportSheet.Range("A8", "L8")
      MyRange.Select()
      MyRange.Sort(Key1:=MyRange.Range("L8"), _
                   Order1:=XlSortOrder.xlAscending, _
                   Header:=XlYesNoGuess.xlGuess, _
                   MatchCase:=False, _
                   Orientation:=XlSortOrientation.xlSortColumns) 
```

我在保存文件之前尝试了这个逻辑，甚至在保存文件之后，但它没有给出任何结果，即排序结果，甚至我没有收到任何错误。

但是以下代码有效....

gobjExcelReportSheet.Application.Selection.Autofilter()

但是没有以编程方式排序的选项。

请帮我...

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T12:05:54.943

假设您正在使用互操作程序集，我就是这样做的：

```
Dim myWorkSheet As Excel.Worksheet = myWorkbook.Worksheets(aSheetName)
myWorkSheet.Activate()
Dim myRange As Excel.Range

myRange = myWorkSheet.Range("A1", "L10")
myRange.Select()

myRange.Sort(Key1:=myRange.Range("D1"), _
                        Order1:=Excel.XlSortOrder.xlAscending, _
                        Orientation:=Excel.XlSortOrientation.xlSortColumns) 
```

基本上您需要选择一个范围（在本例中为 A1:L10，然后选择按某个列 (D) 对其进行排序。

# cruisecontrol.net - 使用 CCTray 1.2 连接到 ccnet 1.0

> ID：560763
> 
> 赞同：0
> 
> 时间：2009-02-18T11:55:35.110
> 
> 标签：cruisecontrol.net

是否可以使用 CCTray 1.2 访问旧版 Cruise Control .Net 1.0？我在想应该可以使用“提供自定义 HTTP URL”选项，但我不知道如何配置它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T16:40:35.313

我认为这是可能的，因为 1.3 和 1.4 混合得很好。我认为您正在寻找的 URL 形式是[http://yourwebhost/ccnet](http://yourwebhost/ccnet)至少在 1.3 和 1.4 中有效 我会指出 1.4.3 应该很快就会发布，并且所有的错误修复和添加的功能 1.4如果您考虑采用这种方式，.3 将是一个很好的升级目标，那么您可以将所有内容恢复到同一版本。

# windows - InternetCheckConnection 总是返回 false

> ID：560771
> 
> 赞同：3
> 
> 时间：2009-02-18T11:58:19.593
> 
> 标签：windows, connection, wininet

我想使用该`Wininet`功能`InternetCheckConnection`检查机器何时连接到互联网并可以访问特定主机。问题是这个函数总是返回**false**，不管我放在它上面的 URL 是什么。

[MSDN 链接](http://msdn.microsoft.com/en-us/library/aa384346(VS.85).aspx)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-02-24T08:52:12.010

**以下组合适用于 Windows 7 和 Windows XP SP3：**

```
 InternetCheckConnection("http://www.google.com", FLAG_ICC_FORCE_CONNECTION, 0) ; 
```

如果连接是可能的，GetLastError() 返回 0，否则返回 12029（连接到服务器的尝试失败）。

**以下组合对我不起作用：**

```
 InternetCheckConnection(NULL, FLAG_ICC_FORCE_CONNECTION, 0) ; 
```

GetLastError() 返回 12016（请求的操作无效）。

```
 InternetCheckConnection(NULL, 0, 0) ;
  InternetCheckConnection(("http://www.google.com", 0, 0) ; 
```

对于这两个 GetLastError() 返回 2250（找不到网络连接）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T13:03:05.553

你检查过`GetLastError()`吗？如果我正确阅读 MSDN，您需要检查`ERROR_NOT_CONNECTED`以确定您是否真正离线。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:06:49.263

只是一个疯狂的猜测，但这可能是由于个人防火墙阻止了 Windows DLL 和/或您的应用程序之一的所有传出连接？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-04-27T23:04:21.237

根据 Microsoft API 文档，不推荐使用**[InternetCheckConnection](https://docs.microsoft.com/en-us/windows/win32/api/wininet/nf-wininet-internetcheckconnectiona)**。

> [InternetCheckConnection 可用于“要求”部分中指定的操作系统。在后续版本中可能会更改或不可用。相反，请使用 NetworkInformation.GetInternetConnectionProfile 或 NLM 接口。]

除了这个 API，我们可以使用**[INetworkListManager](https://docs.microsoft.com/en-us/windows/win32/api/netlistmgr/nn-netlistmgr-inetworklistmanager)**接口来检查 Windows 平台是否连接了 Internet。

下面是win32代码库：

```
 #include <iostream>
    #include <ObjBase.h>      // include the base COM header
    #include <Netlistmgr.h>

    // Instruct linker to link to the required COM libraries
    #pragma comment(lib, "ole32.lib")

    using namespace std;

    enum class INTERNET_STATUS
    {
        CONNECTED,
        DISCONNECTED,
        CONNECTED_TO_LOCAL,
        CONNECTION_ERROR
    };

    INTERNET_STATUS IsConnectedToInternet();

    int main()
    {
        INTERNET_STATUS connectedStatus = INTERNET_STATUS::CONNECTION_ERROR;
        connectedStatus = IsConnectedToInternet();
        switch (connectedStatus)
        {
        case INTERNET_STATUS::CONNECTED:
            cout << "Connected to the internet" << endl;
            break;
        case INTERNET_STATUS::DISCONNECTED:
            cout << "Internet is not available" << endl;
            break;
        case INTERNET_STATUS::CONNECTED_TO_LOCAL:
            cout << "Connected to the local network." << endl;
            break;
        case INTERNET_STATUS::CONNECTION_ERROR:
        default:
            cout << "Unknown error has been occurred." << endl;
            break;
        }
    }

    INTERNET_STATUS IsConnectedToInternet()
    {
        INTERNET_STATUS connectedStatus = INTERNET_STATUS::CONNECTION_ERROR;
        HRESULT hr = S_FALSE;

        try
        {
            hr = CoInitialize(NULL);
            if (SUCCEEDED(hr))
            {
                INetworkListManager* pNetworkListManager;
                hr = CoCreateInstance(CLSID_NetworkListManager, NULL, CLSCTX_ALL, __uuidof(INetworkListManager), (LPVOID*)&pNetworkListManager);
                if (SUCCEEDED(hr))
                {
                    NLM_CONNECTIVITY nlmConnectivity = NLM_CONNECTIVITY::NLM_CONNECTIVITY_DISCONNECTED;
                    VARIANT_BOOL isConnected = VARIANT_FALSE;
                    hr = pNetworkListManager->get_IsConnectedToInternet(&isConnected);
                    if (SUCCEEDED(hr))
                    {
                        if (isConnected == VARIANT_TRUE)
                            connectedStatus = INTERNET_STATUS::CONNECTED;
                        else
                            connectedStatus = INTERNET_STATUS::DISCONNECTED;
                    }

                    if (isConnected == VARIANT_FALSE && SUCCEEDED(pNetworkListManager->GetConnectivity(&nlmConnectivity)))
                    {
                        if (nlmConnectivity & (NLM_CONNECTIVITY_IPV4_LOCALNETWORK | NLM_CONNECTIVITY_IPV4_SUBNET | NLM_CONNECTIVITY_IPV6_LOCALNETWORK | NLM_CONNECTIVITY_IPV6_SUBNET))
                        {
                            connectedStatus = INTERNET_STATUS::CONNECTED_TO_LOCAL;
                        }
                    }

                    pNetworkListManager->Release();
                }
            }

            CoUninitialize();
        }
        catch (...)
        {
            connectedStatus = INTERNET_STATUS::CONNECTION_ERROR;
        }

        return connectedStatus;
    } 
```

# c# - 如何将头文件导入到导入 C++ dll 的 C# 项目中

> ID：560772
> 
> 赞同：2
> 
> 时间：2009-02-18T11:58:31.140
> 
> 标签：c#

C++ dll使用的头文件包含一些用户定义的类型定义和函数声明。我浏览了很多网站，所有的海报都说不可能将头文件导入C#。我想知道有没有办法将头文件导入 C# 代码，因为需要在 C# 应用程序类中声明导入的 dll 的功能。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T12:08:17.480

您是否考虑过使用[C++/CLI](http://en.wikipedia.org/wiki/C%2B%2B/CLI)项目来弥补这一差距？如果您在 C++/CLI 项目中编写所有包装库和互操作性代码，则可以轻松定义托管类型，这些类型在 C/C++ 头文件中公开定义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:13:20.573

这或多或少是[Importing a C++ dll in C#](https://stackoverflow.com/questions/560677/importing-a-c-dll-in-c)的副本，但是该问题有一些糟糕的“信息精简版”答案。

不幸的是，对此没有简短的答案，但是您确实有多种选择。

1.  将 C++ 类包装在托管 C++ 类中。然后，您的 C# 项目仅引用托管 C++ 项目，一切正常。
2.  和 1 一样，创建一个托管 C++ 类，但是创建一个外观。这是您的类的简化接口，仅公开您需要的功能。
3.  另一种方法是使用 PInvoke 调用类上的方法。您需要为 pinvoke 调用构建类的 C# 表示。如果您不知道自己在做什么，这可能会出现问题并且涉及大量的反复试验。

以上所有内容都涉及学习一些对您来说是新的技术（管理 C++ 或 PInvoke 的内部）。可惜没有别的办法。

如果可以，我会选择2。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:12:01.200

当我遇到同样的问题时——给定供 C/C++ 使用的 .h 和 .lib 文件，我已经用 C++ 为它编写了一个带有托管扩展的包装器。这真的很简单。您的 C++ 程序集将在您的 Visual Studio 解决方案中巧妙地运行，您将能够单步从 C# 直接进入托管 C++ 再到非托管 C++，然后轻而易举地再次返回！:-)

# php - 使用 PHP 从纯文本和 HTML 文本的混合创建 PDF

> ID：560776
> 
> 赞同：10
> 
> 时间：2009-02-18T11:59:35.753
> 
> 标签：php, html, zend-framework, pdf, pdf-generation

> **可能重复：**
> [使用 PHP 将 HTML + CSS 转换为 PDF？](https://stackoverflow.com/questions/391005/convert-html-css-to-pdf-with-php)

我有一个包含 5 个字段的表单，其中两个是用 tinyMCE 扩展的文本框，其余的是文本类型的简单输入。

我需要从此输入生成 PDF。我知道我可以使用 Zend_Pdf 生成 PDF 并包含纯文本数据。但是，例如，如何从 tinyMCE 字段中包含项目符号列表？

最好的方法是创建一个 HTML 文件，然后使用例如 DOMPDF 或 HTML2PDF？理想情况下，我宁愿只使用 zend 框架来创建文档、定位和插入字段并保存。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T12:09:17.680

[使用 PHP 将 HTML + CSS 转换为 PDF](https://stackoverflow.com/questions/391005/convert-html-css-to-pdf-with-php)中的更多信息？.

根据我的经验，[Prince XML](http://princexml.com/)是这种技术中的劳斯莱斯，远远超过其他任何技术，这甚至都不好笑。虽然很贵。但是我和其他所有人都有各种各样的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:17:57.973

前段时间我尝试使用 HTML 到 PDF 的转换程序来转换... HTML 到 PDF，但最后我放弃了这种方法，直接在代码中创建了 PDF。我使用 fpdf ( [http://www.fpdf.org/](http://www.fpdf.org/) ) 作为基础，并为列表和网格等添加了支持代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T10:02:15.737

FPDF 是 PHP4 非常古老的库。它现在可能甚至都行不通。我推荐[DOMPDF](http://www.digitaljunkies.ca/dompdf/)或[TCPPDF](http://tcpdf.sourceforge.net/)。它们都适用于 PHP5+，并且在某种程度上可以吃 HTML 或 CSS。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:36:58.900

我正在使用 cletus 提到的 Prince XML。结果非常好，即使使用带有浮点数的 css 样式的 html 等。它很昂贵，但它确实有效并且节省了大量时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T12:34:31.067

您可以将其全部转换为 HTML，然后使用 openoffice 或其他一些工具（[pandoc](http://johnmacfarlane.net/pandoc/)也很漂亮）将 HTML 转换为 PDF。

或者，您可以查看[LiveDocx](http://www.livedocx.com/)，它也具有[php-bindings](http://www.phplivedocx.org/)。这是一项托管服务，但您可以免费使用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-18T11:49:00.787

我个人推荐命令行应用程序而不是任何 php 库。

**原因：**

1.  PHP 库需要更多时间和内存（缓存）来进行转换过程

2.  他们只需要格式良好的 html 页面，否则会出现错误或警告

3.  不支持外部样式表。

**命令行工具：**

```
If run your script on Linux server then I suggest command line tool. 
```

**原因：**

1.  与 PHP 库相比，它们非常快。

2.  支持css。

3.  接受格式不正确的 html。

**使用哪个命令行工具？**

1.  wkhtmltopdf
2.  htmltopdf
3.  html2pdf

有关更多信息，请参阅[使用 PHP 将 HTML 转换为 PDF（不是 PDF 到 HTML）](https://stackoverflow.com/questions/1403820/html-to-pdf-not-pdf-to-html-in-php)

# sql - SQL查询性能问题（多个子查询）

> ID：560777
> 
> 赞同：0
> 
> 时间：2009-02-18T12:00:09.310
> 
> 标签：sql, mysql, performance, join, subquery

我有这个查询：

```
SELECT p.id, r.status, r.title
FROM page AS p
    INNER JOIN page_revision as r ON r.pageId = p.id AND (
        r.id = (SELECT MAX(r2.id) from page_revision as r2 WHERE r2.pageId = r.pageId AND r2.status = 'active')
        OR r.id = (SELECT MAX(r2.id) from page_revision as r2 WHERE r2.pageId = r.pageId)
    ) 
```

它返回每个页面和每个页面的最新活动修订，除非没有可用的活动修订，在这种情况下，它只返回最新修订。

有什么办法可以优化它以提高性能或只是一般的可读性？我现在没有任何问题，但我担心的是，当它进入生产环境（可能**有很多**页面）时，它的性能会很差。

另外，有什么明显的问题我应该注意的吗？子查询的使用总是困扰着我，但据我所知，没有它们就无法做到这一点。

*注意：*
条件在 JOIN 而不是 WHERE 子句中的原因是在其他查询中（使用相同的逻辑）我从“site”表到“page”表，如果没有页面存在我仍然希望网站返回。

杰克

**编辑：**我正在使用 MySQL

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T12:46:02.163

也许有点重构是为了？

如果您在问题`latest_revision_id`上添加了一个列，那么`pages`您的问题将会消失，希望您的页面编辑器中只添加几行。

我知道它没有规范化，但它会简化（并大大加快）查询，有时你必须为了性能而去规范化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T12:55:30.330

如果“活动”是按字母顺序排列的第一个，您可以将子查询减少到：

```
SELECT p.id, r.status, r.title
FROM page AS p
    INNER JOIN page_revision as r ON r.pageId = p.id AND 
        r.id = (SELECT r2.id 
                FROM page_revision as r2 
                WHERE r2.pageId = r.pageId 
                ORDER BY r2.status, r2.id DESC
                LIMIT 1) 
```

否则，您可以将 ORDER BY 行替换为

```
ORDER BY CASE r2.status WHEN 'active' THEN 0 ELSE 1 END, r2.id DESC 
```

这些都来自我对 SQL Server 的假设，您对 MySQL 的了解可能会有所不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:07:08.870

在`MS SQL 2005+`和`Oracle`：

```
SELECT p.id, r.status, r.title
FROM (
  SELECT p.*, r,*,
         ROW_NUMBER() OVER (PARTITION BY p.pageId ORDER BY CASE WHEN p.status = 'active' THEN 0 ELSE 1 END, r.id DESC) AS rn
  FROM page AS p, page_revision r
  WHERE r.id = p.pageId
  ) o
WHERE rn = 1 
```

这`MySQL`可能会成为一个问题，因为子查询不能使用`INDEX RANGE SCAN`外部查询中的表达式不被认为是常量。

您需要创建两个索引和一个返回最后一页修订的函数以使用这些索引：

```
CREATE INDEX ix_revision_page_status_id ON page_revision (page_id, id, status);

CREATE INDEX ix_revision_page_id (page_id, id);

CREATE FUNCTION `fn_get_last_revision`(input_id INT) RETURNS int(11)
BEGIN
  DECLARE id INT;
  SELECT r_id
  INTO id
  FROM (
    SELECT r.id
    FROM page_revisions
    FORCE INDEX (ix_revision_page_status_id)
    WHERE page_id = input_id
      AND status = 'active'
    ORDER BY id DESC 
    LIMIT 1
    UNION ALL
    SELECT r.id
    FROM page_revisions
    FORCE INDEX (ix_revision_page_id)
    WHERE page_id = input_id
    ORDER BY id DESC 
    LIMIT 1
  ) o
  LIMIT 1;
  RETURN id;
END;

SELECT po.id, r.status, r.title
FROM (
  SELECT p.*, fn_get_last_revision(p.page_id) AS rev_id
  FROM page p
) po, page_revision r
WHERE r.id = po.rev_id; 
```

这将有效地使用索引来获取页面的最新版本。

*PS*如果您将代码用于状态并`0`用于活动，您可以摆脱第二个索引并简化查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T12:10:40.470

您的问题是此[问题](https://stackoverflow.com/questions/121387/sql-fetch-the-row-which-has-the-max-value-for-a-column)中描述的特殊情况。

使用标准 ANSI SQL 可以获得的最佳效果似乎是：

```
SELECT p.id, r.status, r.title
FROM page AS p
INNER JOIN page_revision as r ON r.pageId = p.id 
AND r.id = (SELECT MAX(r2.id) from page_revision as r2 WHERE r2.pageId = r.pageId) 
```

其他方法可用，但取决于您使用的数据库。我不确定它是否可以对 MySQL 进行很大改进。

# mysql - 相当于mySQL中的SQLServer函数SCOPE_IDENTITY()？

> ID：560783
> 
> 赞同：38
> 
> 时间：2009-02-18T12:03:32.717
> 
> 标签：mysql, sql-server

mySQL中的 SQLServer 函数[SCOPE_IDENTITY()的等价物是什么？](http://msdn.microsoft.com/en-us/library/ms190315.aspx)

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-02-18T12:07:57.823

[这](http://dev.mysql.com/doc/refman/5.0/en/getting-unique-id.html)就是您要查找的内容：

```
LAST_INSERT_ID() 
```

为了回应 OP 的评论，我创建了以下基准测试：

```
CREATE TABLE Foo
(
    FooId INT AUTO_INCREMENT PRIMARY KEY
);

CREATE TABLE Bar
(
    BarId INT AUTO_INCREMENT PRIMARY KEY
);

INSERT INTO Bar () VALUES ();
INSERT INTO Bar () VALUES ();
INSERT INTO Bar () VALUES ();
INSERT INTO Bar () VALUES ();
INSERT INTO Bar () VALUES ();

CREATE TRIGGER FooTrigger AFTER INSERT ON Foo
    FOR EACH ROW BEGIN
        INSERT INTO Bar () VALUES ();
    END;

INSERT INTO Foo () VALUES (); SELECT LAST_INSERT_ID(); 
```

这将返回：

```
+------------------+
| LAST_INSERT_ID() |
+------------------+
|                1 |
+------------------+ 
```

所以它使用`LAST_INSERT_ID()`原始表的，而不是`INSERT`触发器内部的表。

**编辑：**`SELECT LAST_INSERT_ID()`虽然最后的结论是正确的，但我终于意识到我的答案中显示的结果是错误的。我已将结果更新为正确的值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-07-19T07:19:32.777

打开**MySql**命令类型`SELECT LAST_INSERT_ID();`然后**ENTER**

# apache-flex - flex 3 导航到URL

> ID：560784
> 
> 赞同：0
> 
> 时间：2009-02-18T12:04:44.197
> 
> 标签：apache-flex, navigatetourl

我正在使用 navigateToUrl 类来允许用户下载一些内容 - 这在 Firefox 中运行良好，但是在 IE 中打开了一个新的空白页面，其中没有任何内容以及下载窗口（这是我想要显示的全部内容）对此有任何修复吗？干杯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-11T08:54:42.353

在 navigateToURL 中保留第二个参数 "_self"... 示例：navigateToURL(url,"_self");

如果要在窗口中显示文件，则必须使用 iframe。

希望这能解决你的问题。

# jquery - 尝试在 IE 6 中使用 Ajax 时出现 JQuery “parsererror”

> ID：560787
> 
> 赞同：3
> 
> 时间：2009-02-18T12:05:49.373
> 
> 标签：jquery, ajax, internet-explorer-6

使用 jQuery Ajax 时，我在 IE 6 中收到 parseerror，Firefox 工作得很好。

我的代码是这样的：

```
$.ajax({
   url: 'test.xml',
   type: 'GET',
   dataType: 'xml',

   error: function(XMLHttpRequest, textStatus, errorThrown) {
       alert('Error: ' + textStatus + ", " + errorThrown);
   },

   success: function(xml){
        ...
   }
}); 
```

输出为“错误：解析器错误，未定义”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-04T13:58:54.347

好的，当我在 localhost 中执行代码时会发生这种情况。当我将代码上传到远程服务器时工作正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:16:59.643

只是在黑暗中拍摄，但是当您重命名 XMLHttpRequest 参数时会发生什么？

# windows - 获取文件的扇区位置

> ID：560792
> 
> 赞同：4
> 
> 时间：2009-02-18T12:07:11.710
> 
> 标签：windows, file, location, sector

根据文件名或文件句柄，是否有确定文件从哪个物理扇区开始的 Win-API 方法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-08-03T07:59:46.253

您可以通过使用 DeviceIoControl发送[FSCTL_GET_RETRIEVAL_POINTERS来获取文件集群分配。](http://msdn.microsoft.com/en-us/library/aa364572(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:33:04.017

您必须直接阅读分配表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T13:32:15.767

我怀疑没有这样的功能。

即使您知道文件从哪里开始，它又有什么用呢？只要文件由于碎片而大于单个扇区，文件的其余部分就可以在任何地方。

您可能需要深入了解所涉及的文件系统，并从文件分配表或此类机制中读取必要的信息。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-02-19T22:29:58.600

没有为什么？因为文件系统是物理硬件的抽象。您无需知道您是在 RAM 磁盘、硬盘驱动器、CD 还是网络驱动器上，或者您的数据是否经过压缩或加密——Windows 会为您处理这些小细节。

您始终可以打开物理磁盘，但您需要了解所使用的文件系统。

你想用这个来完成什么？

# java - 为什么 Java SDK 安装程序不设置 JAVA_HOME？

> ID：560797
> 
> 赞同：36
> 
> 时间：2009-02-18T12:08:04.580
> 
> 标签：java, sdk, environment-variables

我一直想知道为什么我在安装 Java SDK 之后必须手动设置 JAVA_HOME 环境变量。

> JAVA_HOME=c:\Program Files\Java\jdk1.6.0_12

Visual Studio 至少提供了一个批处理文件来设置这些类型的环境变量：

> 调用“c:\Program Files\Microsoft Visual Studio 9.0\VC\vcvarsall.bat”

Java有类似的东西吗？我正在尝试制作一个在安装 Java SDK 后应该可以正常工作的构建脚本。我不希望人们在他们的 PC 上弄乱环境变量。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-18T12:27:02.037

您可以安装任意多个版本的 Java。

安装程序修改***本地***环境变量（例如 ）会很危险`JAVA_HOME`，因为它可能会引用现有的 Java 安装。

这与所谓的“平台相关问题”无关。;)

由于脚本可能依赖于`JAVA_HOME`自己启动，再次，这对于新的 Java 安装进行修改将是灾难性的`JAVA_HOME`：所有这些脚本将突然必须使用新的可能不兼容的 JVM 启动。

另外，通过设置`$JAVA_HOME/bin`或`%JAVA_HOME%/bin`在您的路径中，您可以动态更改`JAVA_HOME`为您想要使用的任何 Java 版本，而无需过多使用 PATH 变量。

* * *

[Michael Borgwardt](https://stackoverflow.com/users/16883/michael-borgwardt)在评论中提出了有趣的后续问题

> 尽管如此，这并不能解释为什么安装程序在以前根本没有设置 JAVA_HOME 时没有设置它。

答案很简单：

安装**程序无法知道脚本是否已经依赖`JAVA_HOME`于**.

含义：某些脚本可以测试`JAVA_HOME`值，如果未设置，则引用安装在其他地方的另一个 JVM（不要忘记，通过“安装”，只能引用“复制”：JDK/JRE 并不总是由设置）

如果设置`JAVA_HOME`，这可能会破坏某些脚本的默认行为。

> 不想打扰依赖于未设置 env var 的假设脚本对我来说听起来毫无意义的偏执 - 如果脚本这样做，那么它显然希望在安装时使用不同的 JVM - 没有理由避免这种情况。

嗯……甜。对于每天处理大量**部署问题（用于我商店的内部应用程序），我可以向您保证：拥有它是非常理智的“偏执狂”对待。**
当您部署到（非常）大量用户时，您不想对他们的平台和配置做出任何假设。“显然想要”是我不敢做出的假设（或者我将手机重定向到您的手机；）并且您处理愤怒的电话）。

例如，我们有许多脚本使用 sun 的 1.4.2 JVM 启动（开发平台上未设置 JAVA_HOME，直接在脚本中设置默认路径），或者使用 JRockit 的 1.4.2（`JAVA_HOME`设置，因为它是预期目标集成、预生产和生产平台）。

但是我们会定期安装新的 JDK1.6.x，因为我们使用它来启动 eclipse。

假设那些脚本想要他们的`JAVA_HOME`设置......并且没有任何效果了。

... [罗伯特格兰特](https://stackoverflow.com/users/61938/robert-grant)对此进行了现场评论：

> > 您正在描述需要一个特定版本的脚本，但仍然查看全局 JAVA_HOME。那只是经过深思熟虑的脚本。

虽然这可能是真的，也可能不是，但这也准确地说明了我的观点：
“你不想做任何假设”：不假设他们的平台/设置，也不假设他们的“最佳实践”。
前者可能听起来偏执，后者是普通常识：认为您的产品（这里是 JDK 设置）不会破坏用户环境中的任何内容，因为用户“正确”地考虑了他的脚本......这太疯狂了。

* * *

[GvS](https://stackoverflow.com/users/40615/gvs)建议：

> 或者它可以选择这样做，默认情况下禁用

这将意味着在设置屏幕中包含另一个选项，该选项应该由用户仔细查看，并且可能会产生意想不到的后果，即使用户选择它时认为他知道自己在做什么......

这根本不值得。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-18T12:38:23.600

我不认为 JAVA_HOME 是 Sun 发明或支持的约定。

他们可能还记得 CLASSPATH 环境变量**的惨败，并且更愿意远离环境变量。

** 这在早期的 Java SDK 和文献中被鼓励作为设置 JVM 类路径的主要方法，并导致用户和各种应用程序弄乱环境变量，覆盖彼此的更改并依赖相互矛盾的内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T13:22:39.453

vcvarsall.bat机制是 Visual C++ 为控制台提供正确变量而不会弄乱用户/系统的环境变量的便捷方式*。*但是，它假定 Installshield 是将代码导入系统的唯一方法。JDK 应该容忍从一个位置剪切到另一个位置。

如果您正在寻找*java.exe*，Installshield 安装程序应将其放在*%windir%\system32*中，因此它在 PATH 中可用。

您可以通过查询注册表获得有关已安装应用程序位置的一些提示：

```
C:>REG QUERY "HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Development Kit\1.6" /v JavaHome

! REG.EXE VERSION 3.0

HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Java Development Kit\1.6
    JavaHome    REG_SZ  C:\dev\Java\jdk1.6.0_05 
```

但是，您不能完全依赖这一点，因为这会对供应商、版本和安装机制做出一些假设。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-04T03:07:37.440

这可能会帮助像我这样最终来到这里的其他人。我只是想将 Java 用作一种工具，而不是将其作为一种生活方式，所以我只需要知道 JAVA_HOME 是如何设置的以及为什么它不正确。答案原来是 WinAnt 安装设置了 JAVA_HOME（连同 ANT_HOME），但仅基于当前安装的 Java。因此，如果您需要更改 Java 的版本，并且您正在使用 Ant，那么正确的做法是卸载 WinAnt，卸载 Java，安装新的 Java，然后重新安装 WinAnt。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T12:25:20.513

我不确定为什么会这样，因为安装程序清楚地解决了平台相关问题（这当然是 JVM 的重点）。您确定没有将 JRE 与 JSDK 混合使用吗？

也许有一种方法可以让您的程序搜索安装 java 的位置（我猜这将是一个脚本），然后设置 JAVA_HOME 并可能将其添加到路径中。

IBM 似乎已经在做这个技巧了： [http ://www-01.ibm.com/support/docview.wss?rs=180&uid=swg21199220](http://www-01.ibm.com/support/docview.wss?rs=180&uid=swg21199220)

其他有趣的帖子暗示了 JRE 和 JSDK 安装之间的区别：http: [//confluence.atlassian.com/display/CONF26/Set+JAVA_HOME+variable+in+Windows](http://confluence.atlassian.com/display/CONF26/Set+JAVA_HOME+variable+in+Windows)

希望这可以帮助。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-18T12:13:56.267

我猜java不想做任何依赖于平台的事情。在 Windows 中，类路径的设置与 LINUX/UNIX 不同。

# c# - 如何使用 WebRequest 访问使用 HTTPS 的 SSL 加密站点？

> ID：560804
> 
> 赞同：122
> 
> 时间：2009-02-18T12:11:49.017
> 
> 标签：c#, .net, https, httpwebrequest, webrequest

我正在编写一个从用户提供的 URL 读取内容的程序。我的问题出在这样的代码中：

```
Uri uri = new Uri(url);
WebRequest webRequest = WebRequest.Create(uri);
WebResponse webResponse = webRequest.GetResponse();
ReadFrom(webResponse.GetResponseStream()); 
```

如果提供的*url*是`https://`URL，这将是破坏性的。任何人都可以帮助我更改此代码，以便它可以与 SSL 加密内容一起使用。谢谢。

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-02-18T14:24:33.440

您正在以正确的方式进行操作，但用户可能会向安装了无效 SSL 证书的站点提供 URL。如果在发出实际 Web 请求之前输入此行，则可以忽略这些证书问题：

```
ServicePointManager.ServerCertificateValidationCallback = new System.Net.Security.RemoteCertificateValidationCallback(AcceptAllCertifications); 
```

其中`AcceptAllCertifications`定义为

```
public bool AcceptAllCertifications(object sender, System.Security.Cryptography.X509Certificates.X509Certificate certification, System.Security.Cryptography.X509Certificates.X509Chain chain, System.Net.Security.SslPolicyErrors sslPolicyErrors)
{
    return true;
} 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2017-01-05T12:01:24.077

这个对我有用：

```
ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12; 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-18T12:20:19.060

您将对此链接感兴趣：http: [//msdn.microsoft.com/en-us/library/ds8bxk2a.aspx](http://msdn.microsoft.com/en-us/library/ds8bxk2a.aspx)

> 对于 http 连接，WebRequest 和 WebResponse 类使用 SSL 与支持 SSL 的 Web 主机通信。使用 SSL 的决定是由 WebRequest 类根据给定的 URI 做出的。如果 URI 以“https:”开头，则使用 SSL；如果 URI 以“http:”开头，则使用未加密的连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-03-31T06:03:53.330

正如@LukeDuff 投票最多的答案正确地指出的那样，服务器很可能使用了无效或不受信任（或自签名，技术上也是不受信任）的证书。但是答案盲目地接受任何证书。更糟糕的是，即使是任何站点的任何证书，甚至是您期望受信任和有效证书的站点。这是一个安全漏洞。

实施[`ServicePointManager.ServerCertificateValidation`回调](https://docs.microsoft.com/en-us/dotnet/api/system.net.security.remotecertificatevalidationcallback)时，应*验证*证书。例如，通过根据已知值检查证书的哈希：

```
using System.Net;
using System.Net.Security;
using System.Security.Cryptography; 
```

```
ServicePointManager.ServerCertificateValidationCallback +=
    (sender, certificate, chain, errors) =>
    {
        return
            (errors == SslPolicyErrors.None) ||
            certificate.GetCertHashString(HashAlgorithmName.SHA256).Equals(
                "EB8E0B28AE064ED58CBED9DAEB46CFEB3BD7ECA677...");
    }; 
```

对于需要的[`X509Certificate.GetCertHashString`重载`HashAlgorithmName.SHA256`](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate.getcerthashstring#system-security-cryptography-x509certificates-x509certificate-getcerthashstring(system-security-cryptography-hashalgorithmname))，您需要 .NET 4.8。在旧版本上，使用返回 SHA-1 哈希[的无参数重载](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate.getcerthashstring#system-security-cryptography-x509certificates-x509certificate-getcerthashstring)。

* * *

*基于[当您知道无效证书是安全的时测试 X509Certificate.Thumbprint 属性是否安全？](https://stackoverflow.com/q/34642606/850848)*

*对于 VB.NET 版本的代码，请参阅[在 VB.NET 中接受自签名 TLS/SSL 证书](https://stackoverflow.com/q/5998004/850848#66559532)*。

# c++ - 如何使用 Lighthttpd 配置和运行 fastcgi 应用程序

> ID：560808
> 
> 赞同：1
> 
> 时间：2009-02-18T12:13:05.847
> 
> 标签：c++, fastcgi, lighttpd

我已经为 Windows 安装了 Lighthttpd，并且我在 C++ 中创建了一个使用 fastcgi 库的简单程序。我会在这里发布代码...

```
#include "fcgi_stdio.h" 
#include <stdlib.h>
int count;
void initialize(void)
{
  count=0;
}
void main(void)
{
  initialize();
  while (FCGI_Accept() >= 0)   {
    printf("Content-type: text/html\r\n"
           "\r\n"
           "<title>FastCGI Hello! (C, fcgi_stdio library)</title>"
           "<h1>FastCGI Hello! (C, fcgi_stdio library)</h1>"
           "Request number %d running on host <i>%s</i>\n",
            ++count, getenv("SERVER_HOSTNAME"));
  }
} 
```

我使用 lightttpd-inc.conf 中的以下配置在 lighthttpd 中生成了 fastcgi 应用程序

```
fastcgi.server             = ( ".exe" =>
                               ( "" => 
                                 (
                                   "bin-path" => "D:\tinycgi.exe",
                                   "port" => 8080,
                                   "min-procs" => 1,
                                   "max-procs" => 1
                                 )
                               )
                             ) 
```

使用浏览器发送请求时，服务器在控制台中响应此消息

```
2009-02-18 16:08:34: (mod_fastcgi.c.2494) unexpected end-of-file (perhaps the fa
stcgi process died): pid: 0 socket: tcp:localhost:8080
2009-02-18 16:08:34: (mod_fastcgi.c.3325) response not received, request sent: 1
024 on socket: tcp:localhost:8080 for /new/tinycgi.exe , closing connection 
```

我认为 fastcgi 应用程序没有正确生成。

谢谢你，瓦伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T18:59:49.413

首先，main 应该返回一个 int（不是 void）。问题很可能是您没有调用 FCGX_Init() 也没有初始化请求（使用 FCGX_InitRequest()）。

如果要检查应用程序是否正确生成，则应写入日志文件，如果 lighttpd 未启动应用程序，则不会创建日志文件。

# wpf - 如何在 WPF 中使用 DateTimePicker？

> ID：560811
> 
> 赞同：26
> 
> 时间：2009-02-18T12:14:24.377
> 
> 标签：wpf, datetimepicker

我不知道如何在 WPF 中使用 DateTimePicker 控件。它在工具箱中不可用。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-18T12:19:54.253

**请注意：**以下答案仅适用于 3.5 Framework 下的 WPF，因为 NET 4.0 运行时有它自己的[datetime control](http://msdn.microsoft.com/en-us/library/system.windows.controls.datepicker.aspx)。

默认情况下，WPF 3.5 没有像 winforms 这样的日期时间选择器。

[但是，Microsoft 生产的WPF 工具包](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=22567)中添加了一个日期选择器，可以在[此处下载](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=22567)。我想它会在未来的版本中成为框架的一部分。

添加对 WPFToolkit.dll 的引用很简单，在工具箱中查看它并按照网站上的说明与您的应用程序一起分发。

在此可用之前，其他人已经创建了第 3 方选择器（您可能更喜欢），或者使用了不太理想的解决方案，即在 WPF 应用程序中使用 winforms 控件。

**更新：这个问题与**[这个](https://stackoverflow.com/questions/534845/does-anyone-have-a-wpf-net-3-0-date-picker)问题非常相似，它也有一个链接到[日期选择器的演练](http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-calendar-datepicker-walkthrough.aspx)以及其他链接。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-04-20T07:26:39.643

这刚刚进来;）

在 .NET 4.0 运行时中有一个用于 WPF 的新 DatePicker 类：http: [//msdn.microsoft.com/en-us/library/system.windows.controls.datepicker.aspx](http://msdn.microsoft.com/en-us/library/system.windows.controls.datepicker.aspx)

另请参阅“WPF 中的新增功能”以获得更多不错的功能：http: [//msdn.microsoft.com/en-us/library/bb613588.aspx](http://msdn.microsoft.com/en-us/library/bb613588.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T12:20:07.857

WPF 没有开箱即用的日期时间选择器。

但是，当然有很多第三方 DateTime 选择器 :)

[http://www.devcomponents.com/dotnetbar-wpf/WPFDateTimePicker.aspx](http://www.devcomponents.com/dotnetbar-wpf/WPFDateTimePicker.aspx)

[http://marlongrech.wordpress.com/2007/09/11/wpf-datepicker/](http://marlongrech.wordpress.com/2007/09/11/wpf-datepicker/)

[http://www.codeplex.com/AvalonControlsLib](http://www.codeplex.com/AvalonControlsLib)

只需快速 google 即可找到更多信息！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-16T22:48:07.460

我认为之前没有提到过这个 DateTimePicker：

[一个 WPF DateTimePicker，其工作方式与 Winforms 中的类似](http://www.codeproject.com/KB/WPF/wpfDateTimePicker.aspx)

那是在VB中，有一些错误。我将它转换为 C# 并制作了一个[带有错误修复的新版本](https://gist.github.com/1150228)。

![日期时间选择器](https://i.stack.imgur.com/7v97H.png)

[注意：我在WPFToolkit](http://wpf.codeplex.com/)中使用了日历控件，以便可以使用 .NET 3.5 而不是 .NET 4。如果您使用的是 .NET 4，只需删除 XAML 中对“wpftc”的引用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-29T05:55:45.867

对于 WPF Extended WPF Toolkit Release 1.4.0 中嵌入的控件，请参考 [http://elegantcode.com/2011/04/08/extended-wpf-toolkit-release-1-4-0/](http://elegantcode.com/2011/04/08/extended-wpf-toolkit-release-1-4-0/)

对于日历和 DatePicker 演练，请参阅 [http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-calendar-datepicker-walkthrough.aspx](http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-calendar-datepicker-walkthrough.aspx)

`[Use Edit Template option]` 您可以通过此处显示的 Microsoft Expression Studio 示例自定义外观：

将以下命名空间添加到 xaml 页面

```
xmlns:toolkit="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit.Extended"
xmlns:Microsoft_Windows_Controls_Core_Converters="clr-namespace:Microsoft.Windows.Controls.Core.Converters;assembly=WPFToolkit.Extended" 
xmlns:Microsoft_Windows_Controls_Chromes="clr-namespace:Microsoft.Windows.Controls.Chromes;assembly=WPFToolkit.Extended" 
```

在页面/窗口资源中添加以下内容

```
<!--DateTimePicker Customized Style-->
        <Style x:Key="DateTimePickerStyle1" TargetType="{x:Type toolkit:DateTimePicker}">
            <Setter Property="TimeWatermarkTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <ContentControl Content="{Binding}" Foreground="Gray" Focusable="False"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="WatermarkTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <ContentControl Content="{Binding}" Foreground="Gray" Focusable="False"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type toolkit:DateTimePicker}">
                        <Border>
                            <Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <toolkit:DateTimeUpDown AllowSpin="{TemplateBinding AllowSpin}" 
                                                                  BorderThickness="1,1,0,1" 
                                                                  FormatString="{TemplateBinding FormatString}" 
                                                                  Format="{TemplateBinding Format}" 
                                                                  ShowButtonSpinner="{TemplateBinding ShowButtonSpinner}" 
                                                                  Value="{Binding Value, RelativeSource={RelativeSource TemplatedParent}}" 
                                                                  WatermarkTemplate="{TemplateBinding WatermarkTemplate}" 
                                                                  Watermark="{TemplateBinding Watermark}" 
                                                                  Foreground="#FFEFE3E3" 
                                                                  BorderBrush="#FFEBB31A">
                                        <toolkit:DateTimeUpDown.Background>
                                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                <GradientStop Color="Black" Offset="0"/>
                                                <GradientStop Color="#FF2F2828" Offset="1"/>
                                            </LinearGradientBrush>
                                        </toolkit:DateTimeUpDown.Background>
                                    </toolkit:DateTimeUpDown>

                                    <ToggleButton x:Name="_calendarToggleButton" 
                                                  Background="{x:Null}" Grid.Column="1" IsChecked="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}}">
                                        <ToggleButton.IsHitTestVisible>
                                            <Binding Path="IsOpen" RelativeSource="{RelativeSource TemplatedParent}">
                                                <Binding.Converter>
                                                    <Microsoft_Windows_Controls_Core_Converters:InverseBoolConverter/>
                                                </Binding.Converter>
                                            </Binding>
                                        </ToggleButton.IsHitTestVisible>
                                        <ToggleButton.Style>
                                            <Style TargetType="{x:Type ToggleButton}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                            <Grid SnapsToDevicePixels="True">
                                                                <Microsoft_Windows_Controls_Chromes:ButtonChrome x:Name="ToggleButtonChrome" CornerRadius="0,2.75,2.75,0" InnerCornerRadius="0,1.75,1.75,0" RenderMouseOver="{TemplateBinding IsMouseOver}" RenderPressed="{TemplateBinding IsPressed}" BorderBrush="{x:Null}">
                                                                    <Microsoft_Windows_Controls_Chromes:ButtonChrome.Background>
                                                                        <LinearGradientBrush EndPoint="0.5,1" MappingMode="RelativeToBoundingBox" StartPoint="0.5,0">
                                                                            <GradientStop Color="#FFF3F3F3" Offset="1"/>
                                                                            <GradientStop Color="#7FC0A112"/>
                                                                        </LinearGradientBrush>
                                                                    </Microsoft_Windows_Controls_Chromes:ButtonChrome.Background>
                                                                </Microsoft_Windows_Controls_Chromes:ButtonChrome>
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <ContentPresenter ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" ContentStringFormat="{TemplateBinding ContentStringFormat}" HorizontalAlignment="Stretch" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="Stretch"/>
                                                                    <Grid x:Name="arrowGlyph" Grid.Column="1" IsHitTestVisible="False" Margin="5">
                                                                        <Path Data="M0,1C0,1 0,0 0,0 0,0 3,0 3,0 3,0 3,1 3,1 3,1 4,1 4,1 4,1 4,0 4,0 4,0 7,0 7,0 7,0 7,1 7,1 7,1 6,1 6,1 6,1 6,2 6,2 6,2 5,2 5,2 5,2 5,3 5,3 5,3 4,3 4,3 4,3 4,4 4,4 4,4 3,4 3,4 3,4 3,3 3,3 3,3 2,3 2,3 2,3 2,2 2,2 2,2 1,2 1,2 1,2 1,1 1,1 1,1 0,1 0,1z" Fill="#FF82E511" Height="4" Width="7"/>
                                                                    </Grid>
                                                                </Grid>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </Grid>

                                <Popup IsOpen="{Binding IsChecked, ElementName=_calendarToggleButton}" StaysOpen="False">
                                    <Border BorderThickness="1" Padding="3">
                                        <Border.BorderBrush>
                                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                <GradientStop Color="#FFA3AEB9" Offset="0"/>
                                                <GradientStop Color="#FF8399A9" Offset="0.375"/>
                                                <GradientStop Color="#FF718597" Offset="0.375"/>
                                                <GradientStop Color="#FFD2C217" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.BorderBrush>
                                        <Border.Background>
                                            <LinearGradientBrush EndPoint="0,1" StartPoint="0,0">
                                                <GradientStop Color="White" Offset="0"/>
                                                <GradientStop Color="#FFE9B116" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <StackPanel Background="{x:Null}">
                                            <Calendar x:Name="Part_Calendar" BorderThickness="0" DisplayDate="2011-06-28" Background="#7FE0B41A"/>
                                            <toolkit:TimePicker x:Name="Part_TimeUpDown" Format="ShortTime" Value="{Binding Value, RelativeSource={RelativeSource TemplatedParent}}" WatermarkTemplate="{TemplateBinding TimeWatermarkTemplate}" Watermark="{TemplateBinding TimeWatermark}" Background="{x:Null}" Style="{DynamicResource TimePickerStyle1}"/>
                                        </StackPanel>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TimePickerStyle1" 
               TargetType="{x:Type toolkit:TimePicker}">
            <Setter Property="WatermarkTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <ContentControl Content="{Binding}" Foreground="Gray" Focusable="False"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type toolkit:TimePicker}">
                        <Border>
                            <Grid>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid>
                                        <toolkit:DateTimeUpDown x:Name="PART_TimeUpDown" AllowSpin="{TemplateBinding AllowSpin}" BorderThickness="1,1,0,1" FormatString="{TemplateBinding FormatString}" ShowButtonSpinner="{TemplateBinding ShowButtonSpinner}" Value="{Binding Value, RelativeSource={RelativeSource TemplatedParent}}" WatermarkTemplate="{TemplateBinding WatermarkTemplate}" Watermark="{TemplateBinding Watermark}" Background="#7FE0B41A" BorderBrush="#FFF9F2F2">
                                            <toolkit:DateTimeUpDown.Format>
                                                <TemplateBinding Property="Format">
                                                    <TemplateBinding.Converter>
                                                        <Microsoft_Windows_Controls_Core_Converters:TimeFormatToDateTimeFormatConverter/>
                                                    </TemplateBinding.Converter>
                                                </TemplateBinding>
                                            </toolkit:DateTimeUpDown.Format>
                                        </toolkit:DateTimeUpDown>
                                    </Grid>
                                    <ToggleButton x:Name="_timePickerToggleButton" Grid.Column="1" IsChecked="{Binding IsOpen, RelativeSource={RelativeSource TemplatedParent}}" >
                                        <ToggleButton.IsHitTestVisible>
                                            <Binding Path="IsOpen" RelativeSource="{RelativeSource TemplatedParent}">
                                                <Binding.Converter>
                                                    <Microsoft_Windows_Controls_Core_Converters:InverseBoolConverter/>
                                                </Binding.Converter>
                                            </Binding>
                                        </ToggleButton.IsHitTestVisible>
                                        <ToggleButton.Style>
                                            <Style TargetType="{x:Type ToggleButton}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                                                            <Grid SnapsToDevicePixels="True">
                                                                <Microsoft_Windows_Controls_Chromes:ButtonChrome x:Name="ToggleButtonChrome" CornerRadius="0,2.75,2.75,0" InnerCornerRadius="0,1.75,1.75,0" RenderMouseOver="{TemplateBinding IsMouseOver}" RenderPressed="{TemplateBinding IsPressed}"/>
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <ContentPresenter ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" ContentStringFormat="{TemplateBinding ContentStringFormat}" HorizontalAlignment="Stretch" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="Stretch"/>
                                                                    <Grid x:Name="arrowGlyph" Grid.Column="1" IsHitTestVisible="False" Margin="5">
                                                                        <Path Data="M0,1C0,1 0,0 0,0 0,0 3,0 3,0 3,0 3,1 3,1 3,1 4,1 4,1 4,1 4,0 4,0 4,0 7,0 7,0 7,0 7,1 7,1 7,1 6,1 6,1 6,1 6,2 6,2 6,2 5,2 5,2 5,2 5,3 5,3 5,3 4,3 4,3 4,3 4,4 4,4 4,4 3,4 3,4 3,4 3,3 3,3 3,3 2,3 2,3 2,3 2,2 2,2 2,2 1,2 1,2 1,2 1,1 1,1 1,1 0,1 0,1z" Fill="Black" Height="4" Width="7"/>
                                                                    </Grid>
                                                                </Grid>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ToggleButton.Style>
                                    </ToggleButton>
                                </Grid>

                                <Popup IsOpen="{Binding IsChecked, ElementName=_timePickerToggleButton}" StaysOpen="False">
                                    <Border BorderThickness="1">
                                        <Border.Background>
                                            <LinearGradientBrush EndPoint="0,1" StartPoint="0,0">
                                                <GradientStop Color="White" Offset="0"/>
                                                <GradientStop Color="#FFE7C857" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <Border.BorderBrush>
                                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                <GradientStop Color="#FFA3AEB9" Offset="0"/>
                                                <GradientStop Color="#FF8399A9" Offset="0.375"/>
                                                <GradientStop Color="#FF718597" Offset="0.375"/>
                                                <GradientStop Color="#FF617584" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.BorderBrush>

                                        <Grid>
                                            <ListBox x:Name="PART_TimeListItems" BorderThickness="0" DisplayMemberPath="Display" Height="130" Width="150" Background="#7FE0B41A">
                                                <ListBox.ItemContainerStyle>
                                                    <Style TargetType="{x:Type ListBoxItem}">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                                    <Border x:Name="Border" SnapsToDevicePixels="True">
                                                                        <ContentPresenter ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" ContentStringFormat="{TemplateBinding ContentStringFormat}" Margin="4"/>
                                                                    </Border>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" TargetName="Border" Value="#FFE7F5FD"/>
                                                                        </Trigger>
                                                                        <Trigger Property="IsSelected" Value="True">
                                                                            <Setter Property="Background" TargetName="Border" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </ListBox.ItemContainerStyle>
                                            </ListBox>
                                        </Grid>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style> 
```

在 Window 中，您可以将样式用作

谢谢，

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-09-19T08:17:38.767

如果你想要一个没有外部库的，我确实改进了 Qwertie 的那个。可以在这里找到：[https ://stackoverflow.com/a/69241500/9758687](https://stackoverflow.com/a/69241500/9758687)

[![日期时间选择器](https://i.stack.imgur.com/gBTpC.png)](https://i.stack.imgur.com/gBTpC.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-09T18:27:53.757

WPF Tool Kit中有DatePicker，但是我没有在WPF ToolKit中看到过DateTime Picker。所以我不知道 John 说的是哪种 DateTimePicker 控件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-06-28T17:45:50.017

[Extended Toolkit](http://wpftoolkit.codeplex.com/wikipage?title=DateTimePicker&referringTitle=Documentation)中有一个`DateTimePicker`可用的。

# apache-flex - 将按吸积设计的 Flex 项目转换为 Mate 的建议

> ID：560816
> 
> 赞同：2
> 
> 时间：2009-02-18T12:16:48.473
> 
> 标签：apache-flex, architecture, refactoring, frameworks, mate

我们有一个内部 Flex 应用程序，它的设计更多是通过功能蔓延而不是任何清晰的愿景。它基本上是一种 CRM 和报告系统，它利用了相当多的 Flex 组件（树、图表、自定义组件、数据网格 - 各种）并与 .NET Web 服务后端对话。

它最初是我的第一个 Flex 项目，它是用你可能期望从原型中获得的 bodge、hope 和 repair 风格编写的。然而，它现在已经发展到我们将添加其他（新手）开发人员的地步，但一个人（*叹气*，可能是我）在大约一个月内重写当前快照可能并非不可能。所以，在这个阶段，我认为考虑在[Mate](http://mate.asfusion.com/)框架中实现一个新版本可能是个好主意。

我不需要关于选择哪个框架的建议，我*想要*的是关于如何重构项目的建议。看起来这将涉及拆除所有内容并重新开始（我并不完全反对），但是框架是否必须从头开始构建？是否有任何已知和推荐的解决此类问题的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T12:51:21.153

几个月前我做了类似的事情。我所做的是，我创建了一个新的包结构，并将所有“移植”的代码移到那里。我从整体视图结构开始，朝着“分支”迈进。新代码在需要的地方引用旧代码，但没有旧代码引用新代码。拥有一个新的包结构有助于明确哪些已经被移植，哪些没有被移植，并且当我取得进展时也很容易看到。

# sql - SQL 查询过滤

> ID：560820
> 
> 赞同：0
> 
> 时间：2009-02-18T12:17:38.863
> 
> 标签：sql, filter

使用 SQL Server 2005，我有一个记录某些事件的表，我需要创建一个只返回非常具体的结果的查询。下面有一个例子：

```
日志：
日志_ID | FB_ID | 日期 | 日志名称 | 日志类型

   7 | 4 | 2007/11/8 | 尼娜 | 危急
   6 | 4 | 2007/11/6 | 约翰 | 危急
   5 | 4 | 2007/11/6 | 迈克 | 危急
   4 | 4 | 2007/11/6 | 迈克 | 危急
   3 | 3 | 2007/11/3 | 本 | 危急
   2 | 3 | 2007/11/1 | 本 | 危急

```

查询应执行以下操作：每个 FB_ID 仅返回一行，但这需要是 Log_Name 第一次更改的行，或者如果名称从未更改，则返回第一行。

用外行的话来说，我需要它来浏览数据库以检查每个案例的责任（FB_ID）已转移到另一个人的实例，如果它从来没有，那么只需获取原始记录器的名称。

在上面的示例中，我应该得到行 (Log_ID) 2 和 6。

这甚至可能吗？现在正在讨论数据库是否只是以错误的方式制作。:)

我想我需要能够以某种方式将第一个结果 Log_Name 存储到一个变量中，然后将它与一个 IF 条件等进行比较。不过，我不知道如何用 SQL 做这样的事情。

编辑：更新日期。为了澄清这一点，正确的结果如下所示：

```
日志_ID | FB_ID | 日期 | 日志名称 | 日志类型

   6 | 4 | 2007/11/6 | 约翰 | 危急
   2 | 3 | 2007/11/1 | 本 | 危急

```

这不是我所追求的每个 FB_ID 的第一个日期，而是 Log_Name 从原始更改的行。

最初 FB_ID 4 属于 Mike，但查询应该返回它移动到 John 的行。但是，它不应该将其进一步移动到 Nina 的行返回，因为第一个职责更改在 John 得到它时已经发生。

对于 FB_ID 为 3 的 Ben，记录器永远不会更改，因此应该返回 Ben 的第一行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T12:41:29.180

我想有一种更好，性能更高的方法，但这似乎有效：

```
SELECT *
  FROM log
 WHERE log_id IN
   ( SELECT MIN(log_id)
       FROM log
      WHERE
         ( SELECT COUNT(DISTINCT log_name)
                FROM log log2
               WHERE log2.fb_id = log.fb_id ) = 1
         OR log.log_name <> ( SELECT log_name
                                FROM log log_3
                               WHERE log_3.log_id =
                                 ( SELECT MIN(log_id)
                                     FROM log log4
                                    WHERE log4.fb_id = log.fb_id ) )
      GROUP BY fb_id ) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T13:36:42.197

这将有效地使用索引`(fb_id, cdate, id)`：

```
SELECT  lo4.*
FROM
    (
    SELECT  CASE WHEN ln.log_id IS NULL THEN lo2.log_id ELSE ln.log_id END AS log_id,
            ROW_NUMBER() OVER (PARTITION BY lo2.fb_id ORDER BY lo2.cdate) AS rn
    FROM    (
        SELECT
            lo.*,
            (
            SELECT  TOP 1 log_id
            FROM    t_log li
            WHERE   li.fb_id = lo.fb_id
                    AND li.cdate >= lo.cdate
                    AND li.log_id <> lo.log_id
                    AND li.log_name <> lo.log_name
            ORDER BY
                cdate, log_id
            ) AS next_id
        FROM t_log lo
        ) lo2
    LEFT OUTER JOIN
        t_log ln
    ON ln.log_id = lo2.next_id
    ) lo3, t_log lo4
WHERE lo3.rn = 1
    AND lo4.log_id = lo3.log_id 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:30:20.440

如果我正确理解了这个问题，下面的 SQL 应该可以解决问题：

```
SELECT Log_ID, FB_ID, min(Date), Log_Name, Log_Type  
FROM Log  
GROUP BY Date 
```

SQL 将为每个 FP_ID 选择日期最早的行。

# c# - C# 为可序列化 xml 的类创建 XSD 的最简单方法是什么

> ID：560822
> 
> 赞同：3
> 
> 时间：2009-02-18T12:18:24.150
> 
> 标签：c#, visual-studio-2008, xsd

首先，我是这个话题的新手，在收集了很多背景信息后，我变得更加困惑。

我有一些类，它们都是可序列化的，有些实现了 IXmlSerializable。这些类在适当的位置用 [XmlRoot]、[XmlAttribute] 等标记。

我想知道的是如何使用现有的标签为每个类创建一个简单的 XSD。我对手动和编程方式都感兴趣。如果可能的话，我更喜欢使用集成在 VS2008 中的工具。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T12:24:37.020

好吧，`IXmlSerializable`所有的赌注都没有了，因为没有任何模式可以保证。但是，对于其余部分：

```
xsd.exe <assembly>.dll|.exe [/outputdir:] [/type: [...]] 
```

来自[MSDN](http://msdn.microsoft.com/en-us/library/x6c1kb0s.aspx)：

> /t[ype]:typename 指定要为其创建架构的类型的名称。您可以指定多个类型参数。如果 typename 未指定命名空间，则 Xsd.exe 将程序集中的所有类型与指定类型匹配。如果 typename 指定命名空间，则仅匹配该类型。如果 typename 以星号字符 (*) 结尾，则该工具会匹配以 * 前面的字符串开头的所有类型。如果省略 /type 选项，Xsd.exe 会为程序集中的所有类型生成架构。
> 
> ...
> 
> XSD 的类 从运行时程序集文件中的一个或多个类型生成 XML 架构。生成的架构定义了 System.Xml.Serialization.XmlSerializer 使用的 XML 格式。

# iis-6 - IIS 正在关闭动态内容的连接

> ID：560826
> 
> 赞同：1
> 
> 时间：2009-02-18T12:20:06.047
> 
> 标签：iis-6

我面临一个奇怪的问题，如果你们以前可能见过的话。

我刚刚安装了操作系统（Windows 2003 SP2）并且刚刚在它和默认站点上配置了 IIS，静态内容说 hello.htm 工作正常。但是任何动态内容，如 hello.asp（经典 asp）或 hello.aspx (asp.net) 不工作。

如果我为静态内容手动远程登录并发出 HTTP 标头，它可以工作，但对于动态内容，IIS 基本上是强制关闭连接。

*   事件日志中没有任何内容。

有什么线索吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T12:33:29.510

愚蠢的问题，但是您是否在 IIS 本身的添加/删除程序中启用了 ASP.Net？我不认为这会导致它关闭连接，但它是一个常见的“陷阱”以及注册 ASP.Net。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T13:27:41.800

查看 IIS 中的**Web 服务扩展**。

ASP.NET 是否标记为“启用”？你看到了吗？如果没有，请`aspnet_regiis -i`在命令行上的 %windir%\Microsoft.NET\Framework\WHATEVERVERSION\ 目录中执行一个操作，然后就可以了。

然后重新检查 Web Service Extensions 并确保它已启用。

# javascript - 使用 JavaScript 原型调用方法

> ID：560829
> 
> 赞同：132
> 
> 时间：2009-02-18T12:21:16.747
> 
> 标签：javascript, prototype, overriding

如果它被覆盖，是否可以从 JavaScript 中的原型方法调用基本方法？

```
MyClass = function(name){
    this.name = name;
    this.do = function() {
        //do somthing 
    }
};

MyClass.prototype.do = function() {  
    if (this.name === 'something') {
        //do something new
    } else {
        //CALL BASE METHOD
    }
}; 
```

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2009-02-18T12:55:49.427

我不明白你到底想做什么，但通常实现对象特定的行为是按照以下方式完成的：

```
function MyClass(name) {
    this.name = name;
}

MyClass.prototype.doStuff = function() {
    // generic behaviour
}

var myObj = new MyClass('foo');

var myObjSpecial = new MyClass('bar');
myObjSpecial.doStuff = function() {
    // do specialised stuff
    // how to call the generic implementation:
    MyClass.prototype.doStuff.call(this /*, args...*/);
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-18T13:25:23.740

一种方法是保存基本方法，然后从覆盖的方法中调用它，就像这样

```
MyClass.prototype._do_base = MyClass.prototype.do;
MyClass.prototype.do = function(){  

    if (this.name === 'something'){

        //do something new

    }else{
        return this._do_base();
    }

}; 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-18T13:26:32.253

恐怕你的例子不像你想的那样起作用。这部分：

```
this.do = function(){ /*do something*/ }; 
```

覆盖定义

```
MyClass.prototype.do = function(){ /*do something else*/ }; 
```

由于新创建的对象已经具有“do”属性，因此它不会查找原型链。

Javascript 中的经典继承形式很尴尬，而且难以掌握。我建议改用 Douglas Crockfords 的简单继承模式。像这样：

```
function my_class(name) {
    return {
        name: name,
        do: function () { /* do something */ }
    };
}

function my_child(name) {
    var me = my_class(name);
    var base_do = me.do;
    me.do = function () {
        if (this.name === 'something'){
            //do something new
        } else {
            base_do.call(me);
        }
    }
    return me;
}

var o = my_child("something");
o.do(); // does something new

var u = my_child("something else");
u.do(); // uses base function 
```

在我看来，这是一种在 javascript 中处理对象、构造函数和继承的更清晰的方法。您可以在 Crockfords [Javascript: The good parts](https://rads.stackoverflow.com/amzn/click/com/0596517742)中阅读更多内容。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-09-04T15:05:26.420

我知道这篇文章是 4 年前的，但由于我的 C# 背景，我一直在寻找一种方法来调用基类，而不必指定类名，而是通过子类上的属性获取它。[所以我对克里斯托夫的回答的](https://stackoverflow.com/a/560952/812610)唯一改变是

由此：

```
MyClass.prototype.doStuff.call(this /*, args...*/); 
```

对此：

```
this.constructor.prototype.doStuff.call(this /*, args...*/); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-08-13T22:01:53.880

如果您定义这样的函数（使用 OOP）

```
function Person(){};
Person.prototype.say = function(message){
   console.log(message);
} 
```

调用原型函数有两种方法： 1）创建实例并调用对象函数：

```
var person = new Person();
person.say('hello!'); 
```

另一种方法是...... 2）直接从原型调用函数：

```
Person.prototype.say('hello there!'); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-08-21T08:08:34.277

该解决方案使用`Object.getPrototypeOf`

`TestA`是超级有`getName`

`TestB`是一个覆盖`getName`但也有 `getBothNames`调用`super`版本`getName`以及`child`版本的孩子

```
function TestA() {
  this.count = 1;
}
TestA.prototype.constructor = TestA;
TestA.prototype.getName = function ta_gn() {
  this.count = 2;
  return ' TestA.prototype.getName is called  **';
};

function TestB() {
  this.idx = 30;
  this.count = 10;
}
TestB.prototype = new TestA();
TestB.prototype.constructor = TestB;
TestB.prototype.getName = function tb_gn() {
  return ' TestB.prototype.getName is called ** ';
};

TestB.prototype.getBothNames = function tb_gbn() {
  return Object.getPrototypeOf(TestB.prototype).getName.call(this) + this.getName() + ' this object is : ' + JSON.stringify(this);
};

var tb = new TestB();
console.log(tb.getBothNames());
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-12-07T19:56:43.307

```
function NewClass() {
    var self = this;
    BaseClass.call(self);          // Set base class

    var baseModify = self.modify;  // Get base function
    self.modify = function () {
        // Override code here
        baseModify();
    };
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-11-13T16:57:54.043

替代 ：

```
// shape 
var shape = function(type){
    this.type = type;
}   
shape.prototype.display = function(){
    console.log(this.type);
}
// circle
var circle = new shape('circle');
// override
circle.display = function(a,b){ 
    // call implementation of the super class
    this.__proto__.display.apply(this,arguments);
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-18T13:11:00.950

如果我理解正确，您希望始终执行基本功能，而其中一部分应该留给实现。

[您可能会从“模板方法](http://en.wikipedia.org/wiki/Template_method_pattern)”设计模式中获得帮助。

```
Base = function() {}
Base.prototype.do = function() { 
    // .. prologue code
    this.impldo(); 
    // epilogue code 
}
// note: no impldo implementation for Base!

derived = new Base();
derived.impldo = function() { /* do derived things here safely */ } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-02-25T22:56:17.110

如果你知道你的超类的名字，你可以这样做：

```
function Base() {
}

Base.prototype.foo = function() {
  console.log('called foo in Base');
}

function Sub() {
}

Sub.prototype = new Base();

Sub.prototype.foo = function() {
  console.log('called foo in Sub');
  Base.prototype.foo.call(this);
}

var base = new Base();
base.foo();

var sub = new Sub();
sub.foo(); 
```

这将打印

```
called foo in Base
called foo in Sub
called foo in Base 
```

正如预期的那样。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-12-16T13:48:58.140

ES5 的另一种方法是使用显式遍历原型链`Object.getPrototypeOf(this)`

```
const speaker = {
  speak: () => console.log('the speaker has spoken')
}

const announcingSpeaker = Object.create(speaker, {
  speak: {
    value: function() {
      console.log('Attention please!')
      Object.getPrototypeOf(this).speak()
    }
  }
})

announcingSpeaker.speak() 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T13:28:59.643

不，您需要为构造函数中的 do 函数和原型中的 do 函数赋予不同的名称。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-03-26T10:47:51.450

此外，如果您想**覆盖所有实例**而不仅仅是一个特殊实例，这个可能会有所帮助。

```
function MyClass() {}

MyClass.prototype.myMethod = function() {
  alert( "doing original");
};
MyClass.prototype.myMethod_original = MyClass.prototype.myMethod;
MyClass.prototype.myMethod = function() {
  MyClass.prototype.myMethod_original.call( this );
  alert( "doing override");
};

myObj = new MyClass();
myObj.myMethod(); 
```

结果：

```
doing original
doing override 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2015-05-25T04:45:56.993

```
function MyClass() {}

MyClass.prototype.myMethod = function() {
  alert( "doing original");
};
MyClass.prototype.myMethod_original = MyClass.prototype.myMethod;
MyClass.prototype.myMethod = function() {
  MyClass.prototype.myMethod_original.call( this );
  alert( "doing override");
};

myObj = new MyClass();
myObj.myMethod(); 
```

# asp.net - 调试asp页面的最佳方法是什么？

> ID：560831
> 
> 赞同：0
> 
> 时间：2009-02-18T12:21:36.717
> 
> 标签：asp.net, debugging

我试图让一个 ASP 页面工作，但它一直在爆炸。如何让它显示“response.write”信息而不是炸毁？

ps 我注意到这是一种技术，并计划尝试一下。

2.  在页面顶部广告 On Error Resume Next 每行代码后使用 If Err.Number <> 0 Then Response.Write Err.Description Err.Clear End if You may also Set a Debuggingvariable eg intDebug that you increase every x lines intDebug = intDebug + 1

If Err.Number <> 0 Then Response.Write intDebug response.Write "
" Response.Write Err.Description Err.Clear End if

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T12:43:37.520

为什么不直接调试？Visual Studio 的调试功能非常出色。

**对于 ASP.NET：**

只需放置断点并单击**Debug / Attach Process** 选择**aspnet_wp.exe**。

**对于 ASP：**

[在 Visual Studio 2008 中调试经典 ASP (VBScript)](http://www.codeproject.com/KB/debug/DebugVBScriptVS2008.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:29:56.867

您可以使用 ASP.NET 的跟踪，而不是使用 Response.Write 语句。用于输出页面级信息

```
'Display an informational message
Trace.Write(category, message)

'Display a warning (shown in RED)
Trace.Warn(category, message) 
```

要在整个 Web 应用程序的 ASP.NET 网页上启用跟踪输出，只需将 enabled 设置为 true 并将 pageOutput 设置为 true。如果您在实时站点上工作，您可以将 localOnly 设置为 true，这意味着只有通过[http://localhost](http://localhost)访问该站点的人才能看到跟踪信息。在 Web.config 中添加这些设置：

```
<configuration>
  <system.web>
    <trace enabled="true" pageOutput="false" localOnly="false"/>
  </system.web>
</configuration> 
```

将 Web.config 的跟踪设置为启用，并将 requestLimit 设置为大于零的某个值。现在，在您的 Web 应用程序中访问一些 ASP.NET 网页。现在，将您的浏览器指向[http://localhost/trace.axd](http://localhost/trace.axd)（或您的 Web 应用程序的任何目录）

[参考](http://www.4guysfromrolla.com/webtech/081501-1.shtml)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T12:28:37.870

"On Error Resume Next" --> 已过时。

使用 Try Catch 语句覆盖可能引发异常的每一段代码。

```
Try
' Statement which can cause an exception.
Catch x As Type
' Statements for handling the exception
Finally
'Any cleanup code. will run if exception occurs or not.
End Try 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T12:34:06.827

执行页面并逐个模块地监视它。

将 response.write 放在 response.end 之后。

您将知道页面到底在哪里中断！

您的问题中显示的是 ASP 页面中错误处理的正确方法。

更新：查看其他答案，似乎问题是针对 ASP.net 的？我弄错了吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T13:08:10.160

呃...使用调试器？

> 在页面顶部广告 On Error Resume Next 每行代码后使用 If Err.Number <> 0 Then Response.Write Err.Description Err.Clear End if You may also Set a Debuggingvariable eg intDebug that you increase every x lines intDebug = intDebug + 1

啊。我的眼睛！好痛！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-22T01:32:59.410

问题是这不是asp.net，而是asp。我将其标记为 asp.net，因为我没有看到 asp 的标记。

最终，我被黑的解决方案是做一个巨大的 if 语句，例如

if 1 = 1 then ' 继续愉快地显示页面（一堆代码直到结束） else Response.write "messed up variable:" & messed_up_variable

# .net - 如何在部分信任环境中使用我的 app.config 的 system.net 部分？

> ID：560834
> 
> 赞同：2
> 
> 时间：2009-02-18T12:22:37.273
> 
> 标签：.net, wcf, proxy, code-access-security, partial-trust

我有一个使用 clickonce 部署的 WCF 应用程序。它使用 https 连接到我的服务器，一切正常

由于以下代码，我在需要时使用默认代理：

```
 <configSections>
    <sectionGroup name="system.net" type="System.Net.Configuration.NetSectionGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
      <section name="defaultProxy" type="System.Net.Configuration.DefaultProxySection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
    </sectionGroup>
  </configSections>
  <system.net>
    <defaultProxy useDefaultCredentials="true"/>
  </system.net> 
```

在完全信任模式下，一切正常

现在，如果我将我的安全设置设置为部分信任，如果不涉及代理，它确实可以正常工作，但如果我尝试在公司环境中启动我的软件，则不再自动检测到代理。

据我了解：

configSections 不再在部分信任环境中解析，除非设置了 requirePermission 属性，如下所示：

```
<section requirePermission="false" name="defaultProxy"> 
```

* * *

设置此属性会引发带有以下错误消息的 System.Configuration.ConfigurationException：

> 部分或组名称“defaultProxy”已定义。对此的更新可能只发生在定义它的配置级别。

'defaultproxy' 部分确实已经在 machine.config 文件中定义：

```
 <section name="defaultProxy" type="System.Net.Configuration.DefaultProxySection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/> 
```

但是，只要未设置 requirePermission，这似乎不是问题。换句话说，错误消息似乎应该改为：

> 部分或组名 'defaultProxy' **已使用另一个 requirePermission 设置定义**。对此的更新可能只发生在定义它的配置级别。

* * *

有人遇到同样的问题吗？是否可以在部分信任模式下静默使用 WCF 应用程序中的默认代理？我也尝试以编程方式设置代理，但没有成功

```
System.Net.WebProxy proxy = new WebProxy();
proxy.UseDefaultCredentials = true;
WebRequest.DefaultWebProxy = proxy; 
```

wshttpbinding 的 useDefaultWebProxy 属性从一开始就直接设置，但在部分或完全信任环境中，如果没有正确定义 'system.net.defaultProxy' 部分，似乎不起作用：

```
 <binding name="WebBinding" useDefaultWebProxy="true"> 
```

我想我可以要求我的客户更新他们的本地 machine.config 文件以添加所需的 defaultProxy useDefaultCredentials="true"，但这绝对不会简化部署。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T07:59:36.980

我相信这是一个已知问题，可能与私钥传输有关。这里有一个 MS Connect 条目：

[https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=354646](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=354646)

我希望我已经正确理解了这个问题。如果您的问题是这个错误的结果，那么看起来目前还没有 ETA 修复。但是，可能存在与手动请求凭据相关的解决方法。显然这并不理想，但它可能会在您部署到生产系统之前为您提供另一种选择。

MSDN 论坛上还有其他讨论：

[http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c19b726b-573b-4157-91fd-051724f04180/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/c19b726b-573b-4157-91fd-051724f04180/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T08:39:34.247

或者，如果在公司环境中工作，您可以尝试找到所需的权限以使您的应用程序正常工作。所以不是完全信任，而是更具体的代码访问安全策略。然后通过在企业级别/用户级别设置的组策略设置该策略。

# java - 热部署到 Jetty 的最佳解决方案是什么？

> ID：560836
> 
> 赞同：7
> 
> 时间：2009-02-18T12:22:58.960
> 
> 标签：java, deployment, jetty

我有一个在码头上运行的 Web 应用程序。继续构建基于 hudson。我想根据哈德森的要求进行热部署。

我找到了应该能够这样做的货物插件，但是货物的网络没有显示任何完整的示例如何做到这一点 - 对于远程码头服务器 - 我可能会想念它吗？

你有什么建议？您还有其他更好的解决方案吗？

谢谢你，

维泰克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T16:17:20.587

Cargo 的[文档](http://cargo.codehaus.org/Jetty+6.x)显示可以通过 maven 2 部署到码头。

这是[配置](http://cargo.codehaus.org/Deploying+to+a+running+container)。

我想你试过这个？出了什么问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-30T17:08:23.333

对于使用 Windows 的用户，如果遇到文件锁定错误，请访问：

[http://docs.codehaus.org/display/JETTY/Files+locked+on+Windows](https://web.archive.org/web/20100722023113/http://docs.codehaus.org:80/display/JETTY/Files+locked+on+Windows)

Windows 将 Jetty 加载到内存中的文件锁定。上面的链接将向您展示如何防止这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-09T05:49:13.677

码头：可以作为独立运行：只需远程复制您构建的战争。独立的 Jetty 实例可以在独立的端口上运行。

Yml：例如

```
<Set name="ThreadPool">
  -->
  <New class="org.mortbay.thread.QueuedThreadPool">
    <Set name="minThreads">10</Set>
    <Set name="maxThreads">50</Set>
    <Set name="lowThreads">5</Set>
    <Set name="SpawnOrShrinkAt">2</Set>
  </New>

</Set>

<Call name="addConnector">
  <Arg>
      <New class="org.mortbay.jetty.nio.SelectChannelConnector">
        <Set name="host"><SystemProperty name="jetty.host" default="0.0.0.0" /></Set>
        <Set name="port"><SystemProperty name="jetty.port" default="8880"/></Set>
        <Set name="maxIdleTime">300000</Set>
        <Set name="Acceptors">2</Set>
        <Set name="statsOn">false</Set>
        <Set name="confidentialPort">8441</Set>
        <Set name="lowResourcesConnections">20000</Set>
        <Set name="lowResourcesMaxIdleTime">5000</Set>
      </New>
  </Arg>
</Call>

<Set name="handler">
  <New id="Handlers" class="org.mortbay.jetty.handler.HandlerCollection">
    <Set name="handlers">
     <Array type="org.mortbay.jetty.Handler">
       <Item>
         <New id="Contexts" class="org.mortbay.jetty.handler.ContextHandlerCollection"/>
       </Item>
       <Item>
         <New id="DefaultHandler" class="org.mortbay.jetty.handler.DefaultHandler"/>
       </Item>
       <Item>
         <New id="RequestLog" class="org.mortbay.jetty.handler.RequestLogHandler"/>
       </Item>
     </Array>
    </Set>
  </New>
</Set>

<Call name="addLifeCycle">
  <Arg>
    <New class="org.mortbay.jetty.deployer.ContextDeployer">
      <Set name="contexts"><Ref id="Contexts"/></Set>
      <Set name="configurationDir"><SystemProperty name="jetty.home" default="."/>/contexts/</Set>
      <Set name="scanInterval">1</Set>
    </New>
  </Arg>
</Call>

<Set name="UserRealms">
  <Array type="org.mortbay.jetty.security.UserRealm">
    <Item>
      <New class="org.mortbay.jetty.security.HashUserRealm">
        <Set name="name">Test Realm</Set>
        <Set name="config"><SystemProperty name="jetty.home" default="."/>/etc/realm.properties</Set>
        <Set name="refreshInterval">0</Set>
      </New>
    </Item>
  </Array>
</Set>

<Ref id="RequestLog">
  <Set name="requestLog">
    <New id="RequestLogImpl" class="org.mortbay.jetty.NCSARequestLog">
      <Set name="filename"><SystemProperty name="jetty.logs" default="./logs"/>/yyyy_mm_dd.request.log</Set>
      <Set name="filenameDateFormat">yyyy_MM_dd</Set>
      <Set name="retainDays">90</Set>
      <Set name="append">true</Set>
      <Set name="extended">true</Set>
      <Set name="logCookies">false</Set>
      <Set name="LogTimeZone">GMT</Set>
    </New>
  </Set>
</Ref>

<Set name="stopAtShutdown">true</Set>
<Set name="sendServerVersion">true</Set>
<Set name="sendDateHeader">true</Set>
<Set name="gracefulShutdown">1000</Set> 
```

# c# - 在 C# 中从 XML 编写器创建 XML Element 对象

> ID：560842
> 
> 赞同：5
> 
> 时间：2009-02-18T12:24:58.033
> 
> 标签：c#, xml, xmlwriter

我正在用 C# 编写一个 Windows 服务。我有一个`XmlWriter`包含 XSLT 转换的输出。我需要将 XML 放入`XMLElement`对象中以传递给 Web 服务。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T12:53:56.933

您不需要中间字符串，您可以创建一个直接写入 XmlNode 的 XmlWriter：

```
XmlDocument doc = new XmlDocument();
using (XmlWriter xw = doc.CreateNavigator().AppendChild()) {
  // Write to `xw` here.
  // Nodes written to `xw` will not appear in the document 
  // until `xw` is closed/disposed.
} 
```

并将 xw 作为变换的输出传递。

注意。xsl:output 的某些部分将被忽略（例如编码），因为 XmlDocument 将使用它自己的设置。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T12:32:49.997

好吧， an`XmlWriter`不*包含*输出；通常，您有一个支持对象（可能是 a`StringBuilder`或`MemoryStream`），它是倾倒地点。在这种情况下，`StringBuilder`可能是最有效的......也许是这样的：

```
 StringBuilder sb = new StringBuilder();
    using (XmlWriter writer = XmlWriter.Create(sb))
    {
        // TODO write to writer via xslt
    }
    string xml = sb.ToString();
    XmlDocument doc = new XmlDocument();
    doc.LoadXml(xml);
    XmlElement el = doc.DocumentElement; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-08-06T10:57:14.410

如果您提供一个编写器，您就提供了一个存储库，其中输出生成器正在传输数据，因此 Richard 的重播很好，您实际上不需要字符串生成器来将数据从读取器发送到 XmlDocument！

# c++ - C++中经常被误解的概念是什么？

> ID：560845
> 
> 赞同：33
> 
> 时间：2009-02-18T12:26:31.523
> 
> 标签：c++

c++中经常被误解的概念是什么？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-02-18T12:43:53.043

**C++ 不是带有类的 C！**

并且没有称为 C/C++ 的语言。一切都从那里走下坡路。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-02-18T22:55:46.597

C++*确实*具有自动资源管理功能。

（大多数声称 C++ 没有内存管理的人试图过多地使用 new 和 delete 方式，没有意识到如果他们允许 C++ 自己管理资源，任务会变得容易得多）。

示例：（使用编造的 API 制作，因为我现在没有时间查看文档）

```
// C++
void DoSomething()
{
  File file("/tmp/dosomething", "rb");
  ... do stuff with file...
  // file is automatically free'ed and closed.
}

// C#
public void DoSomething()
{
  File file = new File("/tmp/dosomething", "rb");
  ... do stuff with file...

  // file is NOT automatically closed.
  // What if the caller calls DoSomething() in a tight loop?
  // C# requires you to be aware of the implementation of the File class
  // and forces you to accommodate, thus voiding implementation-hiding
  // principles.
  // Approaches may include:
  // 1) Utilizing the IDisposable pattern.
  // 2) Utilizing try-finally guards, which quickly gets messy.
  // 3) The nagging doubt that you've forgotten something /somewhere/ in your
  //    1 million loc project.
  // 4) The realization that point #3 can not be fixed by fixing the File
  //    class.
} 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-02-18T23:38:13.063

**自由函数并不坏，因为它们不在一个类中**C++ 不仅仅是一门 OOP 语言，而是建立在一整套技术之上。

当人们说自由函数（位于命名空间和全局命名空间中的函数）是“C 时代的遗留物”并且应该避免时，我已经听过很多次了。事实恰恰相反。自由函数允许将函数与特定类分离并允许重用功能。如果函数不需要访问实现细节，还建议使用自由函数而不是成员函数 - 因为这将消除当更改类的实现时的级联更改以及其他优点。

这也反映在语言中：基于范围的 for 循环`C++0x`（即将发布的下一个 C++ 版本）将基于自由函数调用。它将通过调用自由函数`begin`和`end`.

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-02-18T12:52:50.307

赋值和初始化的区别：

```
string s = "foo";    // initialisation
s = "bar";           // assignment 
```

初始化总是使用构造函数，赋值总是使用 operator=

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2009-02-18T12:32:05.550

按降序排列：

1.  确保释放分配内存的指针
2.  *什么时候析构函数应该是虚拟的*
3.  虚函数是如何工作的

有趣的是，没有多少人知道虚函数的全部细节，但似乎仍然可以完成工作。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2009-02-18T15:21:06.860

我见过的最有害的概念是它应该被视为带有一些插件的 C。事实上，在现代 C++ 系统中，它应该被视为一种不同的语言，而且我看到的大多数 C++ 抨击都是基于“C with add-ons”模型。

提几个问题：

虽然您可能需要知道 和 之间的区别`delete`，`delete[]`但您通常都不应该写。使用智能指针和`std::vector<>`.

实际上，您应该`*`很少使用 a。对字符串使用 std::string。（是的，它的设计很糟糕。无论如何都要使用它。）

RAII 意味着您通常不必编写清理代码。清理代码是不好的风格，会破坏概念的局部性。作为奖励，使用 RAII（包括智能指针）可以免费为您提供许多基本的异常安全性。总的来说，在某些方面它比垃圾收集要好得多。

一般来说，类数据成员不应该是直接可见的，无论是通过存在`public`还是通过 getter 和 setter。有例外（例如点类中的 x 和 y），但它们是例外，应视为例外。

最重要的是：没有像 C/C++ 这样的语言。可以编写可以在任何一种语言下正确编译的程序，但是这样的程序不是好的 C++，通常也不是好的 C。自从 Stroustrup 开始研究“C with Classes”以来，这些语言一直在分歧，现在不像现在那么相似曾经。使用“C/C++”作为语言名称是用户不知道他或她在说什么的初步证据。正确使用的 C++ 并不像 Java 或 C# 那样像 C。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2009-02-18T13:48:31.967

过度使用与多态性无关的继承。大多数情况下，除非您真的使用运行时多态，否则组合或静态多态（即模板）会更好。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2009-02-18T12:43:11.173

**静态**关键字可以表示三种不同的事物之一，具体取决于它的使用位置。

1.  它可以是静态成员函数或成员变量。
2.  它可以是在命名空间范围内声明的静态变量或函数。
3.  它可以是在函数内部声明的静态变量。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2009-02-18T22:57:50.913

**数组不是指针**

它们是不同的。所以`&array`不是指向指针的指针，而是指向数组的指针。在我看来，这是 C 和 C++ 中最容易被误解的概念。您必须访问所有那些告诉将二维数组传递为的 SO 答案`type**`！

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2009-02-18T12:37:33.243

这里有一些：

1.  使用模板在没有 vtables 的情况下实现多态性，à la ATL。
2.  内存中的逻辑`const`性与实际性。`const`何时使用`mutable`关键字。

* * *

致谢：感谢您纠正我的错误，spoulson。

编辑：

这里有更多：

1.  虚拟继承（不是虚拟方法）：其实我完全看不懂！（我的意思是我不知道它是如何实现的）
2.  成员是对象的联合，其各自的类具有非平凡的构造函数。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2009-02-18T12:43:11.937

这是 C++ 中一个经常被遗忘的重要概念：

> C++ 不应像 Java 或 C# 等面向对象的语言那样简单地使用。从 STL 中启发自己并编写通用代码。

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2009-02-18T15:29:33.767

鉴于这种：

```
int x = sizeof(char); 
```

X 是什么值？

您经常听到的答案取决于对规范的理解程度。

1.  初学者 - x 是一，因为字符总是八位值。
2.  中级 - 这取决于编译器的实现，字符可以是 UTF16 格式。
3.  Expert - x 是 1，并且永远是 1，因为 char 是最小的可寻址内存单元，而 sizeof 决定了存储该类型实例所需的内存单元数。所以在一个 char 为 8 位的系统中，一个 32 位的值的 sizeof 为 4；但在 char 为 16 位的系统中，32 位值的 sizeof 为 2。

不幸的是，该标准使用“字节”来指代内存单元，因为许多程序员认为“字节”是八位。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2009-02-18T13:44:08.140

从 c 到 c++ 的初学者的经典之作：

混淆`delete`和`delete[]`

编辑：

使用 C API 时，各级经验中的另一个经典失败：

```
std::string helloString = "hello world";
printf("%s\n", helloString); 
```

代替：

```
printf("%s\n", helloString.c_str()); 
```

它每周都会发生在我身上。您可以使用流，但有时您必须处理类似 printf 的 API。

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2009-02-18T23:30:31.710

C++ 是一种多范式语言。许多人将 C++ 严格地与 OOP 联系在一起。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2009-02-18T12:36:02.390

指针。

取消引用指针。通过`.`或`->`

`&`需要指针时使用的地址。

`&`通过在签名中指定a 通过引用获取参数的函数。

指向指针的指针`***`或引用指针的指针`void someFunc(int *& arg)`

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2009-02-18T13:38:14.223

人们似乎经常对一些事情感到困惑或不知道：

1.  指针，尤其是函数指针和多指针（例如 int(*)(void*)、void***）

2.  const 关键字和 const 正确性（例如 const char*、char* const 和 const char* const 有什么区别，以及 void class::member() const; 是什么意思？）

3.  内存分配（例如，每个新的指针都应该被删除，malloc/free 不应该与 new/delete 混合，何时使用 delete [] 而不是 delete，为什么 C 函数仍然有用（例如 expand()、realloc( )))

4.  范围（即您可以单独使用 { } 为变量名创建新范围，而不仅仅是作为 if、for 等的一部分...）

5.  切换语句。（例如，不了解它们可以优化（或在某些情况下比 if 链更好），不了解失败及其实际应用（例如循环展开）或存在默认情况）

6.  调用约定（例如 cdecl 和 stdcall 有什么区别，你将如何实现 pascal 函数，为什么它甚至很重要？）

7.  继承和多重继承，更一般地说，整个 OO 范式。

8.  通常实现的内联汇编器不是 C++ 的一部分。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-02-18T14:19:17.913

*   指向成员的指针和指向成员函数的指针。
*   非类型模板参数。
*   多重继承，特别是虚拟基类和共享基对象。
*   构造和销毁的顺序，构造中间基类的中间虚函数的状态。
*   铸造安全和可变尺寸。不，您不能在可移植代码中假设`sizeof(void *) == sizeof(int)`（或任何其他类型，除非可移植标头特别保证）。
*   指针算术。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2009-02-19T17:35:36.657

**头文件和实现文件**

这也是很多人误解的概念。诸如头文件中的内容以及如果函数定义在一侧的程序中多次出现但当类定义在另一侧多次出现时不会导致链接错误的问题。

*与这些问题非常相似的是为什么拥有头球后卫*很重要。

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2009-02-19T17:51:33.437

**如果一个函数接受一个指向指针的指针，`void*`仍然会这样做**

我已经看到*空指针*的概念经常被混淆。人们认为，如果您有指针，则使用 a `void*`，如果您有指向指针的指针，则使用 a `void**`。但是您可以而且应该在这两种情况下使用`void*`. A`void**`没有 a 所具有的特殊属性`void*`。

这是一个特殊的属性，`void*`也可以为 a 分配一个指向指针的指针，并且在回退时接收到原始值。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2009-03-05T12:06:32.073

我认为关于 C++ 最被误解的概念是它为什么存在以及它的目的是什么。它经常受到来自上方（Java、C# 等）和下方（C）的攻击。C++ 具有接近机器操作的能力来处理计算复杂性和管理域复杂性的抽象机制。

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2009-08-26T00:21:45.187

**`NULL`始终为零。**

许多人与地址混淆`NULL`，因此认为如果平台具有不同的空指针地址，它不一定为零。

但`NULL`始终为零，它不是地址。它是一个零常量整数表达式，可以转换为指针类型。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2009-02-18T12:41:15.560

内存对齐。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2009-02-19T17:40:14.227

**`std::vector`使用保留时不创建元素**

我看到程序员争辩说，如果他们达到那个位置，他们可以访问高于`size()`返回值的位置的成员。`reserve()`这是一个错误的假设，但在程序员中很常见——尤其是因为编译器很难诊断出错误，而这会默默地让事情“工作”。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2011-01-09T05:59:26.250

呵呵，这是一个傻回复：C++编程中最被误解的就是模板类编译失败时g++的错误信息！

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2009-02-18T14:25:37.680

C++ 不是带有字符串和向量的 C！

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-02-19T00:09:22.397

C++ 不是典型的面向对象语言。

不相信我？看看 STL，模板多于对象。

几乎不可能使用 Java/C# 方式编写面向对象的代码；它根本行不通。

*   在 Java/C# 编程中，有很多`new`ing，很多实用程序对象，它们实现了一些单一的内聚功能。
*   在 C++ 中，任何对象`new`ed 都必须被删除，但始终存在谁拥有该对象的问题
*   结果，对象倾向于在堆栈上创建
*   但是当你这样做时，如果你要将它们传递给其他函数/对象，则必须一直复制它们，从而浪费了很多据说可以通过 C++ 的非托管环境实现的性能
*   意识到这一点后，您必须考虑组织代码的其他方式
*   您最终可能会以程序方式做事，或者使用元编程习惯用法，如智能指针
*   至此，您已经意识到 C++ 中的 OO 不能像在 Java/C# 中那样使用

[量子点](http://en.wikipedia.org/wiki/Q.E.D.)

如果您坚持使用指针进行 oop，您通常会拥有大型（巨大！）类，并在对象之间明确定义所有权关系以避免内存泄漏。然后即使你这样做了，你已经离 oop 的 Java/C# 习语太远了。

> *实际上我编造了“面向对象”这个术语，我可以告诉你我并没有想到 C++。*
> -- [Alan Kay](http://video.google.com/videoplay?docid=-2950949730059754521)（点击链接，是视频，10:33引用）

*尽管从纯粹主义者的角度来看（例如 Alan Kay），即使是 Java 和 C# 也达不到真正的 oop*

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2009-02-19T01:26:14.490

**C 结构 VS C++ 结构**经常被误解。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2009-02-19T17:46:21.360

**指针是迭代器，但迭代器并不总是指针**

这也是一个经常被误解的概念。指向对象的指针是随机访问迭代器：它可以按任意数量的元素递增/递减，并且可以读取和写入。但是，具有运算符重载的迭代器类也可以满足这些要求。所以它也是一个迭代器，但当然不是一个指针。

我记得我过去的一位 C++ 老师（错误地）教导说，如果你这样做，你会得到一个指向向量元素的指针`vec.begin()`。他实际上是在假设 - 在不知道的情况下 - 向量使用指针实现其迭代器。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2009-02-18T14:46:35.120

*   当人们在 C++ 中创建静态变量时，匿名命名空间几乎总是真正想要的
*   在制作库头文件时，pimpl idiom ( [http://www.gotw.ca/gotw/024.htm](http://www.gotw.ca/gotw/024.htm) ) 应该用于几乎所有私有函数和成员，以帮助进行依赖管理

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2009-02-23T00:39:03.493

我仍然不明白为什么 vector 没有 pop_front 以及我无法排序（list.begin(), list.end())..

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-07-27T23:17:25.567

我知道这是一个老问题，但我认为对象切片/​​堆栈上对象的多态性失败值得一提。如果我六个月不使用 C++，当我再次使用该语言时，这个总是会出现并咬我。

```
#include <iostream>

class base {
    public:
    base(int val) { var1 = val; };
    virtual void doSomething() { var1 *= 2; };
    int getVar1() { return var1; };
    virtual ~base() { };
    protected:
    int var1;
};

class deriv : public base {
    public:
    deriv(int val) : base(val) { };
    void doSomething() { var1 *= 4; };
};

void use_object_ptr(base *arg) {
    arg->doSomething();
    std::cout << arg->getVar1() << std::endl;
};

void use_object_copy(base arg) {
    arg.doSomething();
    std::cout << arg.getVar1() << std::endl;
};

int main(int argc, char **argv) {
    deriv d(42);

    deriv *p2d = new deriv(42);

    use_object_ptr(p2d); // calls deriv::doSomething(), prints 168

    use_object_copy(d); // calls base::doSomething(), prints 84

    use_object_ptr(&d); // calls deriv::doSomething(), prints 168

    return 0;
} 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-07-28T08:24:18.227

1.  对象、堆栈或堆的分配。
2.  常量的使用。
3.  朋友的使用

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-02-18T12:31:52.090

C++ 还是 C/C++？我想说最容易被误解的部分是内存管理和指针。前者是因为人们没有适当地释放（太早或根本没有！）而后者是因为很多人只是没有“获得”指针（无论是通过引用传递“伪装”还是一般类似的东西）一个链表）。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-02-18T22:11:34.737

1.  指针（*）和引用（&）的区别
2.  使用指针访问多维数组。
3.  使用 * 访问指针的值 - 即 *ptr = 5
4.  何时释放分配的内存。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2009-02-19T00:13:38.407

为什么 A[b] 和 b[A] 是一样的？

好吧，这不是一个常见的问题，但它出现在我曾经教过的一堂课上......

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2011-10-19T03:58:46.997

对于某些人来说，继承和多态之间的区别可能是一个令人困惑的概念。

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2009-02-18T12:51:32.900

非常好的资源，我不能厌倦推广 - [C++ 常见问题解答](http://yosefk.com/c++fqa/)

* * *

## 回答 #38

> 赞同：-3
> 
> 时间：2009-02-18T14:18:12.927

一个重要的问题是这些语言在语法上不是 100% 兼容的。C++ 与 C 完全链接兼容，但一些 C++ 风格的语法会在 C 中产生编译器错误。一些编译器并不挑剔，也没有完全遵循 C 标准。从一种语言迁移到另一种语言时，需要学习这些基础知识。注意我还没有阅读最新的 C 标准，但最后我知道这是真的。

# error-handling - 错误代码和消息最佳实践

> ID：560857
> 
> 赞同：4
> 
> 时间：2009-02-18T12:31:34.053
> 
> 标签：error-handling, edi, error-code, custom-errors

我正在计划一个 EDI 系统，其中包括发送包含几个元素的 XML 确认消息，但特别是这三个元素；错误代码、错误严重性和错误描述。

我将基本上解析入站 XML 消息，并根据解析的成功或失败包括消息格式、语法、结构、有效性和一些业务规则，我将返回成功或失败确认。

我可以自由选择 ErrorCodes、ErrorSeverity 和 ErrorDescription，但不是天真地从 ErrorCode [1]、ErrorSeverity [Error]、ErrorDescription [Cannot Find Inbound XML File] 开始，并在入站消息的编码过程中添加我认为的错误parser 我想知道是否有选择错误代码和严重性的最佳实践？

我知道 HTTP 错误代码就像 2xx 表示 OK 消息，4xx 表示某些错误，5xx 表示服务器错误等等，我想知道是否有人有任何好的建议可以帮助我在我将自己编码到一个角落并说“如果只是我所有的“警告”错误都以 3 或类似的东西开始！

我认为 ErrorSeverity 不会比 [Error]、[Warning]、[Info] 和 [OK] 多多少？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T12:34:54.810

您可以在此处找到 EDI 的现有错误代码：

[http://msdn.microsoft.com/en-us/library/bb245948.aspx](http://msdn.microsoft.com/en-us/library/bb245948.aspx)

如果您使用这些文档之一中描述的标准之一，您将与之交流的系统/开发人员可能会很高兴。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:40:34.063

我喜欢将“错误”（输入数据错误）与“致命”（系统损坏）区分开来。第一个要求修复数据并重试；另一个没有。

不言而喻，任何“错误”消息都应该是*可操作*的；他们应该让接收者清楚地知道什么是错误的，以及需要采取什么措施来纠正数据中的错误。

如果您单独传达严重性，那么我不仅认为没有必要坚持预先定义的数字范围，而且我建议这样的举动是直截了当的。如果您*确实*认为使用范围有助记符的价值，请使范围至少比您现在认为的需要大十倍（数字很便宜，为什么不使用五个？;-)

你也可以考虑参数化你的消息；例如，明确的字段来指示文本中的位置。这使得代码更容易接收消息并使用它做一些有用的事情（无需解析人类可读的文本来寻找线索）。

# java - 如何通过 Spring 框架实例化使用泛型的对象？

> ID：560867
> 
> 赞同：38
> 
> 时间：2009-02-18T12:34:12.037
> 
> 标签：java, spring, generics

我有一个看起来像这样的类：

```
class Dao<T>{
...
} 
```

我想做这个：

```
new Dao<Student>(); 
```

来自 Spring XML 配置。

可以这样做吗？如何？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-18T14:15:32.417

阅读有关[类型擦除](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)的内容应该可以帮助您更好地理解这一点。

在运行时，泛型类的类型参数被*擦除*。这意味着，正如 cletus 所说，Java 中的泛型基本上是语法糖——它们只是一个编译时特性。

由于 Spring 在运行时实例化对象，它实际上可以自由地实例化`Dao`任何类型的 a - 实际上，没有什么可以阻止它创建 a并在某些方法中`Dao`传入类型和在另一种方法中传递类型。`Student``Teacher`

所以基本上答案是，Spring 不知道该`Dao`类型是要参数化的，并且不能用它做任何事情。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T12:46:04.863

你不能这样做，你不能这样做的原因是它实际上没有任何意义。我的意思是Java泛型是语法糖，所以你用什么类型创建一个bean是无关紧要的。您可以将它注入到任何采用 Dao（或 Dao）的东西中，此时它将使用注入的任何类型的隐式转换。

# wpf - Silverlight：实施图像

> ID：560874
> 
> 赞同：1
> 
> 时间：2009-02-18T12:35:13.983
> 
> 标签：wpf, silverlight, image, controls

我刚刚在 Microsoft Blend 中创建了一个木偶，其中包含显示虚拟图像的图像框（这是一个白框）。在混合中，它显示图像，但在视觉工作室（以及运行应用程序时）中，图像没有显示。

这是我正在使用的代码片段

```
<Image Source="/Images/BodyParts/dummy.jpg" Height="10" Width="20" Stretch="Fill" OpacityMask="{x:Null}" x:Name="backFoot" Canvas.Left="41.71" Canvas.Top="147.668" /> 
```

[替代文字 http://img26.imageshack.us/img26/1401/blendvscomparewo7.jpg](http://img26.imageshack.us/img26/1401/blendvscomparewo7.jpg)

请注意，您在两个版本中看到的圆圈是不同的控件，而不是图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T13:19:29.960

确保您的图片*“dummy.jpg”*出现在解决方案资源管理器中的正确文件夹中

*例子：*

[解决方案资源管理器 http://img403.imageshack.us/img403/4976/solutiontm2.jpg](http://img403.imageshack.us/img403/4976/solutiontm2.jpg)

如果您*右键单击*图像上的 -> 属性，您应该会看到*“属性”*窗口。

然后将*“Build Action”*设置为***“Content”***，如下图：

[属性 http://img338.imageshack.us/img338/9166/propertiesfl9.jpg](http://img338.imageshack.us/img338/9166/propertiesfl9.jpg)

# .net - 向现有应用程序添加代理支持...？

> ID：560878
> 
> 赞同：1
> 
> 时间：2009-02-18T12:37:40.373
> 
> 标签：.net, http, proxy

我想知道是否有可能（以及如何）构建一个工具来添加对现有应用程序的代理连接的支持。让我解释。

以 CodePlex 客户端 (cpc.exe) 为例，它是一个用于连接到 CodePlex TFS 的命令行实用程序。我在代理后面，无法使用它。我想写一个应用程序，比如说“ProxyEnabler”。此应用程序将启动 cpc.exe 文件作为子进程并拦截每个 HTTP 请求以使用代理配置重新构建它。

可以这样使用： ProxyEnabler.exe cpc.exe 它可以读取 app.config 文件中的代理配置。

我这里不要求写应用程序 ;-) 我只需要知道它是否可行（主要是 HTTP 拦截 & 重定向）

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-02-18T12:51:24.553

[FreeCap](http://www.freecap.ru/eng)可以做到这一点（通过 HTTP CONNECT 或 Socks 代理），但它通过挂钩 Windows 套接字函数来工作；我不确定如何在.net 中做到这一点

# html - 空的 HTML 标记

> ID：560880
> 
> 赞同：7
> 
> 时间：2009-02-18T12:38:40.137
> 
> 标签：html, validation

由于 CSS 图像替换技术，我的代码中有很多空的 span 标签等。它们触发 HTML 验证警告。

我应该关心吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T12:53:56.997

我同意@Gumbo，但是有很多没有区别的警告可以隐藏你确实需要注意的警告。如果您可以在范围内放置一些可以消除警告但不会破坏您的 UI 的东西，那么您至少应该考虑这样做。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-18T16:13:58.357

我已将验证作为工作流程的一部分，因为它可以帮助我及早发现错误。虽然我不认为空元素是一个问题，但如果我每次都必须在精神上解析一个警告列表并决定一个警告是否重要，它就会否定使用验证器的一些价值。所以我尽量保持我的页面没有错误和警告，以便快速[浏览 Firefox 状态栏中的 HTML Validator 图标，](https://addons.mozilla.org/en-US/firefox/addon/249)只有在出现真正问题时才会改变。为此，我通过插入空注释来保持空元素“非空”。

```
<span><!-- --></span> 
```

（至少这适用于 Tidy 验证器。）

现在，话虽这么说，我认为这在许多情况下根本没有必要。完全合理地认为，为了避免验证器警告而在代码中添加八个额外字符是荒谬的。但它对我有用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-18T13:00:24.220

您应该考虑屏幕阅读器等页面的行为。实际上，通常会在标签中放置一些描述图像的词，然后通过图像替换隐藏这些词。

请参阅[CSS Zen Garden](http://www.csszengarden.com/)，您可以在其中看到诸如 H1 spans 之类的示例，其中文本在 CSS 中被图像替换。

这不仅会提高您网站的可访问性，还会提高搜索能力。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T16:28:23.113

“空”标签在 HTML 中有一个非常具体的定义：

```
<span/> 
```

相对

```
<span></span> 
```

[HTML 4.0 Strict DTD](http://www.w3.org/TR/1999/REC-html401-19991224/sgml/dtd.html)不允许前者，因此应由验证器标记。唯一可以使用前一种语法的标签是那些在 DTD 中明确标识为“EMPTY”的标签（例如，`<br>`）。

第二种形式是有效的 HTML，不会被[W3C 验证器](http://validator.w3.org/)标记。

所以我必须假设（1）你的验证器坏了，或者（2）你错误地使用了标签。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T12:40:59.790

警告不是错误。这只是提醒你应该改进一些东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T12:55:16.527

我想如果带宽是一个问题，可以重新访问那些空标签，看看你是否可以让它们不再出现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-09T20:59:31.720

[Eric Meyer](http://meyerweb.com/eric/tools/css/diagnostics/demo-not.html%20Eric%20Meyer)还说 empy 标签在语义上是不好的。

警告并不意味着它是错误的，而是说它可以或有时应该更好。

以同样的方式

```
if("value"==variable) 
```

好于

```
if(variable=="value") 
```

# language-agnostic - 选择哪种认证机制？

> ID：560891
> 
> 赞同：4
> 
> 时间：2009-02-18T12:41:29.303
> 
> 标签：language-agnostic, authentication

好吧，在我的空闲时间，我正在制作这个小型网站。该站点不需要进行身份验证，只有一些操作（如发表评论）需要这样做。

我希望每天有多达 100 个（可能更少）独立访问者。我真的不希望超过 50% 的人（愿意）注册。

现在，我正在考虑三种可能的身份验证机制（但我愿意接受建议）：

*   OpenID认证；
*   HTTP Digest 或至少 HTTP Basic 身份验证；
*   我自己的（基于表单的）身份验证。

对于像这样的小型网站，OpenID 在我看来有点矫枉过正。此外，我网站登录页面上的“OpenID”之类的流行词可能会吓跑不太懂技术的人。

HTTP 摘要（或基本）身份验证提供了低安全级别（或根本没有），因为该站点将不在 HTTPS 下。

我自己的实现很可能会遇到与 HTTP Digest 相同的安全问题。虽然，我可以对暴力攻击实施更多保护（在三个失败后显示验证码等）。

你会建议什么其他机制？我没有看到的优点和缺点是什么？你会选择什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T12:51:19.903

好吧，如果您希望访问者留下评论，我真的认为您最好使用 OpenID 之类的东西。因为如果您提供自己的基于表单的身份验证，谁真的会费心用一些密码注册另一个帐户，想知道他们是否可以信任您？

我认为可以肯定地说喜欢互联网的人拥有一个 gmail 帐户，并且所有这些人都有一个 OpenID（Google 帐户）。

我建议你使用它......这就是我会做的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T12:52:17.577

你还没有说你正在使用什么语言/技术。它可能会影响事情。但我倾向于只推出您自己的基于表单的身份验证。这不是很困难。只需记住一些基础知识：

*   始终清理用户输入。它不能被信任；
*   切勿将用户名或密码存储在 cookie 中（相信我，人们会这样做）；
*   仅使用可靠的加密方法（如 MD5 或 SHA1）存储加密密码；
*   使用不可预测的盐；
*   需要启用 cookie。不要尝试进行 URL 重写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T13:00:34.813

当他们发表评论时，为什么不只是有一个名称字段，如果你愿意，也许可以在 cookie 中记住它。大多数用户只是想表明自己没有帐户。

只要确保您有一些垃圾邮件拦截器，因为表单会吸引垃圾邮件机器人。即使那只是每次都带有表单的验证码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T13:02:08.583

Openid是我认为最好的。此外，如果您提供有关 open id 的更专业的帮助（或像 SOF 节目），那么人们会理解。一旦不太懂技术的人理解了 opend id 的使用（没有新的用户名和密码），他们就会开始喜欢它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T14:14:36.227

一定要使用 OpenID——我们加入的人越多，人们就会越熟悉它，而且第一次使用并没有那么奇怪。如果您是 microsoft 开发人员，[dotNetOpenID](http://blog.nerdbank.net/2008/04/dotnetopenid-20-released.html)库使实现变得非常简单——我已经为 ASP.NET 和 ASP.NET MVC 站点完成了这项工作，没有任何问题。

编辑：

关于支持不精通技术的用户，登录页面上的一些链接/解释将大大减轻人们的担忧。他们将看到的重定向与他们更熟悉的体验非常相似，例如信用卡或贝宝授权，因此用这些术语应该很容易解释。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T12:48:13.470

您可以向访问者分发一些 RSA SecurID ;-)

严肃地说，要问的主要问题是：为我的用户登录实施一个体面的安全系统的总工作时间是否值得如果网站安全被破坏时可能访问的内容？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T12:49:20.313

您应该查看 RPX ( [https://rpxnow.com/](https://rpxnow.com/) )，它是 OpenID 之上的一层，以及其他一些对于大多数语言来说非常容易实现的方案（有一个 ruby​​ 的 gem，我认识一个朋友我的在不到几个小时内就将它放入了他的 php 应用程序中）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T14:29:12.853

OpenID 规则！作为一个知情的用户，我不确定它是否被视为安全的“防弹”，所以我可能不会将它用于金融/医疗网站，但对于 95% 的其他网站，它会节省我不必写下包含 137 个不同用户名和密码的备忘单。我已经在我开发的（非公开）网站中使用了它，让身份验证正常工作有点麻烦，但如果你可以使用其中一个库，那就去吧！

HTTP 身份验证是标准化的，但它的某些方面让我感到不安。我不知道是什么。从浏览器中弹出一个单独的对话框让我感到怀疑。

ps BBC 的 Digital Planet昨天（2009 年 2 月 17 日）在我当地的广播电台播出了一个关于 OpenID的[广播节目。](http://www.bbc.co.uk/worldservice/programmes/digital_planet.shtml)所以我想当电台谈论它时，它一定开始成为主流。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-21T18:59:43.070

**我的建议：不要重新发明轮子。**如果我曾经见过 Web 身份验证就是一个轮子，要正确处理所有微妙的陷阱是非常困难的。您可能会错过一些东西，最终实际上没有安全感。

要么使用 OpenID 解决方案，要么查看那里的许多 auth 库，然后选择一个经过彻底测试的库。

另请参阅：[网站身份验证权威指南](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-21T19:38:37.907

这部分取决于您的目标受众是谁。如果他们都是计算机极客，请使用 OpenID。他们要么熟悉它，要么会理解你在做什么。如果他们不一定是计算机极客，他们可能还没有接触过 OpenID 身份验证，因此 OpenID 可能会构成进入障碍。在这种情况下，您可能希望采用更传统的方法，例如注册/验证电子邮件/登录方法，无论是自行推出还是现成的。

# c - 从 C 源代码中自动删除未使用的局部变量

> ID：560904
> 
> 赞同：10
> 
> 时间：2009-02-18T12:43:56.693
> 
> 标签：c, automated-refactoring

我想从 C 文件中删除未使用的局部变量。例子：

```
int fun(int a , int b)
{
  int c,sum=0;
  sum=a + b;
    return sum;
} 
```

这里未使用的变量是'c'。

我将在外部列出所有未使用的局部变量。现在使用我拥有的未使用的局部变量，我们必须从源代码中找到局部变量并删除。
在上面的示例中，“c”是未使用的变量。我会知道的（我有代码）。在这里我必须找到 c 并删除它。

**编辑**

关键是不要使用外部工具找到未使用的局部变量。关键是从代码中删除它们，给出它们的列表。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-18T12:46:37.980

调高你的编译器警告级别，它应该会告诉你。

将您的源代码片段放入“fc”：

```
% gcc -c -Wall f.c
f.c: In function 'fun':
f.c:1: warning: unused variable 'c' 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-18T12:53:56.217

棘手 - 你将不得不为此解析 C 代码。结果必须有多接近？我的意思的例子：

```
int a, /* foo */
    b, /* << the unused one */
    c; /* bar */ 
```

现在，对人类来说很明显第二条评论必须删除。

轻微变化：

```
void test(/* in */ int a, /* unused */ int b, /* out */ int* c); 
```

同样，第二条评论必须删除，这次是 b 之前的评论。

通常，您希望解析输入，过滤它，并发出不是未使用变量声明的所有内容。您的解析器必须保留注释和#include 语句，但如果您不使用#include 标头，则可能无法识别声明（如果使用宏来隐藏声明，则更是如此）。毕竟，您需要标题来决定是否 A * B(); 是函数声明（当 A 是类型时）或乘法（当 A 是变量时）

* * *

[编辑] 此外：

即使您知道某个变量未使用，删除它的正确方法在很大程度上取决于远程上下文。例如，假设

```
int foo(int a, int b, int c) { return a + b; } 
```

显然，c 未被使用。可以改成吗？

```
int foo(int a, int b) { return a + b; } 
```

也许，但如果 &foo 存储在 int a中，则不是`int(*)(int,int,int)`。这可能发生在其他地方。如果（且仅当）发生这种情况，您应该将其更改为

```
int foo(int a, int b, int /*unused*/ ) { return a + b; } 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T14:02:32.713

你为什么要这样做？假设您有一个不错的优化编译器（GCC、Visual Studio 等），无论您是否删除原始示例中的“int c”，二进制输出都不会有任何不同。

如果这只是代码清理，任何最近的 IDE 都会为您提供每个警告的源代码的快速链接，只需单击并删除 :)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T15:17:37.073

我的回答更像是对 MSalters 非常彻底的回答的详尽评论。我会超越“棘手”并说这样的工具既不可能也不可取。

如果您只想删除对变量的引用，那么您可以编写自己的代码解析器，但它需要区分它所在的函数上下文，例如

```
int foo(double a, double b)
{
   b = 10.0;
   return (int) b;
}

int bar(double a, double b)
{
   a = 5.00;
   return (int) a;
} 
```

任何简单的解析器都会遇到“a”和“b”都是未使用的变量的问题。

其次，如果您像 MSalter 那样考虑评论，您会发现人们的评论并不一致。

```
double a;
/*a is designed as a dummy variable*/
double b;

/*a is designed as a dummy variable*/
double a;
double b;

double a; /*a is designed as a dummy variable*/
double b; 
```

等等

因此，简单地删除未使用的变量将创建孤立的评论，这可能比[根本不评论](http://www.codinghorror.com/blog/archives/001150.html)更危险。

归根结底，优雅地完成这是一项非常困难的任务，无论如何你都会修改代码。通过自动化这个过程，你会让代码变得更糟。

最后，您应该首先考虑为什么变量在代码中，如果它们被弃用，为什么在所有引用都被删除时它们没有被删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T12:48:37.913

[Paul 正确指出的警告级别之外的静态代码分析工具](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T12:48:52.593

除了能够通过警告显示这些内容外，如果打开任何优化，编译器通常会优化这些内容。就编译器中的实现而言，检查变量是否从未被引用是非常简单的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-24T08:10:13.560

您将需要一个好的解析器来保留标记的原始字符位置（即使存在预处理器！）。有一些用于 C/C++ 自动重构的工具，但它们远非主流。

我建议您查看[Taras 的博客](http://blog.mozilla.com/tglek/)。这家伙正在对 Mozilla 代码库进行一些大型的自动重构，比如用返回值替换 out-params。他重写代码的主要工具是[Pork](https://developer.mozilla.org/En/Pork)：

> Pork 是一个 C++ 解析和重写工具链。Pork 的核心是一个 C++ 解析器，它为每个 AST 节点的开始和结束提供准确的字符位置，以及包含任何位置的宏扩展集。此信息允许以精确的方式自动重写 C++。

来自博客：

> 到目前为止，猪肉已被用于“次要”事情，例如重命名类和函数、旋转超参数和纠正 prbool 错误。此外，Pork 在一项实验中证明了自己，该实验涉及重写 Mozilla 中的几乎所有函数（即生成 3+MB 补丁）以使用垃圾收集而不是引用计数。

它适用于 C++，但它可能适合您的需要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-14T06:03:09.533

上面的一张海报说“不可能和不可取”。另一个说“棘手”，这是正确的答案。您需要 1) 一个完整的 C（或任何感兴趣的语言）解析器，2) 理解语言标识符引用和数据流以确定变量确实“死”的推理程序，以及 3) 实际修改源的能力代码。

所有这一切的难点在于构建 1) 2) 3) 所需的巨大能量。您不能为任何单独的清理任务辩护。可以做的是专门构建这样的基础设施，目标是在许多不同的程序分析和转换任务中摊销它。

我的公司提供了这样一个工具：DMS 软件再造工具包。请参阅 [http://www.semdesigns.com/Products/DMS/DMSToolkit.html](http://www.semdesigns.com/Products/DMS/DMSToolkit.html) DMS 具有适用于多种语言的生产质量前端，包括 C、C++、Java 和 COBOL。

事实上，我们已经为 Java 构建了一个自动化的“查找无用声明”工具，它做了两件事：a) 将它们全部列出（从而生成列表！） b) 制作删除无用声明的代码副本。您选择要保留的答案:-)

对 C 做同样的事情并不难。我们已经有一个工具可以识别这些死变量/函数。

一个我们没有提到的情况，是“无用参数”的情况，因为要删除一个无用的参数，你必须找到所有来自*其他*模块的调用，验证设置参数没有副作用，然后撕掉无用的论点。事实上，我们有整个感兴趣的软件系统的完整图表，所以这也是可能的。

所以，这很棘手，如果你有正确的基础设施，甚至不是很棘手。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-09-18T13:39:45.677

您可以将问题作为文本处理问题来解决。源代码中如何定义未使用的局部变量必须有少量的正则表达式模式。

使用未使用的变量名称列表和它们所在的行号，您可以逐行处理 C 源代码。在每一行上，您可以迭代变量名称。在每个变量名上，您可以一一匹配模式。成功匹配后您知道定义的语法，因此您知道如何从中删除未使用的变量。

例如，如果源代码行是：“int a, used, b;” 并且编译器在该行中将“未使用”报告为未使用的变量，而不是模式“/，未使用，/”将匹配，您可以用单个“，”替换该子字符串。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-18T12:48:30.957

另外：[夹板](http://splint.org/)。

> Splint 是一种静态检查 C 程序是否存在安全漏洞和编码错误的工具。用最少的努力，夹板可以用作更好的皮棉。如果投入额外的精力为程序添加注释，则 Splint 可以执行比任何标准 lint 更强大的检查。

# ruby-on-rails - 用于 ruby on rails 开发的数据库建模 mac 应用程序

> ID：560909
> 
> 赞同：2
> 
> 时间：2009-02-18T12:45:17.813
> 
> 标签：ruby-on-rails, macos, database-design

我正在使用 Ruby on Rails 构建 Web 应用程序，我想知道 OS X 从功能角度而非图形设计模拟新应用程序的最佳工具是什么。在开始编写代码之前，我希望能够了解应用程序在资源方面需要什么。

谢谢， 塞萨尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T12:59:27.483

对于任何资源/应用程序规划，我真的只是用笔和纸:)

对于您所追求的功能类型是否有任何具体要求？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:07:34.967

[香脂](http://www.balsamiq.com/products/mockups)？它是基于闪存的。

该试验有一个唠叨，但除此之外似乎功能齐全。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T13:08:28.473

[SQLEditor](http://www.malcolmhardie.com/sqleditor/)非常简约，易于使用，并支持导出到 Rails 迁移。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T00:52:46.703

我通常将 OmniGraffle 用于此类事情。您可以下载允许您进行 UML 和数据库特定设计的其他模板。

# actionscript-3 - TextField() 防止 ctrl+a （全选）

> ID：560925
> 
> 赞同：0
> 
> 时间：2009-02-18T12:49:06.773
> 
> 标签：actionscript-3, apache-flex, flex3

如何防止`CTRL`+`A` 与可编辑的 TextField() 一起使用

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:34:47.673

前面的示例仅适用于 Flex Text 和 TextArea 对象，这适用于所有 flash.text.* 对象。

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="init()">
    <mx:Script>
        <![CDATA[
            import mx.core.UIComponent;

            private var t:TextField;
            private function init():void
            {
                t = new TextField();
                t.height = 80;
                t.width  = 100;
                t.type   = TextFieldType.INPUT;
                t.multiline = true;
                var c:UIComponent = new UIComponent();
                c.addChild( t );
                foo.addChild( c );
                addEventListener( KeyboardEvent.KEY_UP,         edit );
                addEventListener( KeyboardEvent.KEY_DOWN,       edit );
            } 

            private function edit( event:KeyboardEvent ):void
            {
                if( event.type == KeyboardEvent.KEY_DOWN && event.ctrlKey )
                {
                    t.type = TextFieldType.DYNAMIC; // Dynamic texts cannot be edited.  You might be able to remove this line.
                    t.selectable = false; // If selectable is false, then Ctrl-a won't do anything.
                }
                else
                {
                    t.type = TextFieldType.INPUT;
                    t.selectable = true;
                }
            }
        ]]>
    </mx:Script>
    <mx:Canvas id="foo" height="90" width="110" backgroundColor="#FFFFFF" />
</mx:Application> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T14:02:20.013

未经测试，但也许您可以捕获[`selectAll`事件](http://livedocs.adobe.com/flex/3/langref/flash/display/InteractiveObject.html#event:selectAll)并`TextField`防止它冒泡，或清除选择（不确定何时触发事件）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T21:32:20.697

使用与 KeyboardEvent 侦听器配对的 setFocus 函数：

```
<xml version="1.0"?>
<!-- menus/SimpleMenuControl.mxml -->
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" width="800" initialize="init()" >
    <mx:TextInput id="nom"/>
    <mx:Script>
        <![CDATA[
            private function init():void
            {
                addEventListener( KeyboardEvent.KEY_UP,     edit );
                addEventListener( KeyboardEvent.KEY_DOWN,   edit );
            } 

            private function edit( event:KeyboardEvent ):void
            {
                if( event.type == KeyboardEvent.KEY_DOWN && event.ctrlKey ) setFocus();
                else nom.setFocus();
                nom.selectionEndIndex = nom.selectionBeginIndex = nom.text.length;
            }
        ]]>
    </mx:Script>

</mx:Application> 
```

setFocus 意味着 Text 对象将不再监听任何键盘事件。

我不建议使用 enabled 属性，因为这会使 textarea 变灰。

# iphone - 当单击“顶部”图像上的同一位置时，如何阻止单击“下部”视图上的 UIButton

> ID：560928
> 
> 赞同：1
> 
> 时间：2009-02-18T12:49:24.917
> 
> 标签：iphone, cocoa-touch

我在主视图上有 UIButton，当单击按钮时，我将 UIImageView 添加到填充屏幕的整个屏幕（这是添加在按钮顶部）。

发生的情况是，通过单击 UIImageView 的图像（在 UIButton 所在的位置），它会启动 UIButton 单击。但是，由于该按钮对用户不可见并且被图像覆盖，因此这不是所需的行为。

有没有人发生过类似的事情？任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:21:47.050

通常，UIImageViews 应该将其 userInteractionEnabled 属性设置为 NO，因此它们不应响应触摸事件，也不应将它们传递到视图链中（有效地阻止触摸对被图像遮挡的视图执行任何操作）。我假设您没有将该属性重置为“是”，因此听起来您的图像视图没有处理触摸。

可能发生的一种方法是，如果您添加 UIImageView 的超级视图没有覆盖整个屏幕。UIImageView 将溢出超级视图的边界并似乎绘制在整个屏幕上，但只会在其超级视图区域上响应触摸。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T17:16:52.760

我实际上是通过设置框架来让它工作的：

```
[[UIView alloc] initWithFrame:[[UIScreen mainScreen] bounds]]; 
```

代替：

```
[[UIView alloc] initWithFrame:[[UIScreen mainScreen] applicationFrame]]; 
```

似乎有 applicationFrame 而不是边界是问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:27:01.483

这可能更像是一个创可贴而不是修复，但是您可以将 UIImageView 的状态检查添加到 UIButton Click 事件中，如果 UIImageView 当前正在填充屏幕，则只需退出该事件。

# python - 如何从 HTML 文件中提取所需的数据？

> ID：560936
> 
> 赞同：2
> 
> 时间：2009-02-18T12:51:28.670
> 
> 标签：python, screen-scraping, beautifulsoup

这是我拥有的 HTML：

```
p_tags = '''<p class="foo-body">
  <font class="test-proof">Full name</font> Foobar<br />
  <font class="test-proof">Born</font> July 7, 1923, foo, bar<br />
  <font class="test-proof">Current age</font> 27 years 226 days<br />
  <font class="test-proof">Major teams</font> <span style="white-space: nowrap">Japan,</span> <span style="white-space: nowrap">Jakarta,</span> <span style="white-space: nowrap">bazz,</span> <span style="white-space: nowrap">foo,</span> <span style="white-space: nowrap">foobazz</span><br />
  <font class="test-proof">Also</font> bar<br />
  <font class="test-proof">foo style</font> hand <br />
  <font class="test-proof">bar style</font> ball<br />
  <font class="test-proof">foo position</font> bak<br />
  <br class="bar" />
</p>''' 
```

这是我的 Python 代码，使用 Beautiful Soup：

```
def get_info(p_tags):
    """Returns brief information."""

    head_list = []
    detail_list = []
    # This works fine
    for head in p_tags.findAll('font', 'test-proof'):
        head_list.append(head.contents[0])

    # Some problem with this?
    for index in xrange(2, 30, 4):
        detail_list.append(p_tags.contents[index])

    return dict([(l, detail_list[head_list.index(l)]) for l in head_list]) 
```

`head_list`我从 HTML 中得到了正确的，但`detail_list`它不起作用。

```
head_list = [u'全名',
 你'出生'，
 u'当前年龄',
 u'主要团队'，
 你也'，
 u'foo 风格',
 u'酒吧风格',
 你'foo位置']

```

我想要这样的东西

```
{
  '全名': 'Foobar',
  'Born': '1923 年 7 月 7 日，foo，bar'，
  '当前年龄': '78 岁 226 天',
  '主要球队'：'日本，雅加达，bazz，foo，foobazz'，
  '也'：'酒吧'，
  'foo 风格': '手',
  '酒吧风格'：'球'，
  'foo 位置'：'bak'
}

```

任何帮助都是不言而喻的。提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T13:30:15.443

问题是您的 HTML 没有经过深思熟虑——您有一个“混合内容模型”，其中您的标签和数据是交错的。您的标签包含在`<font>`标签中，但您的数据位于 NavigableString 节点中。

您需要遍历`p_tag`. 将有两种节点：`Tag`节点（具有您的`<font>`标签）和`NavigableString`具有其他文本位的节点。

```
from beautifulsoup import *
label_value_pairs = []
for n in p_tag.contents:
    if isinstance(n,Tag) and tag == "font"
        label= n.string
    elif isinstance(n, NavigableString):
        value= n.string
        label_value_pairs.append( label, value )
    else:
        # Generally tag == "br"
        pass
print dict( label_value_pairs ) 
```

大概是这样的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T13:50:26.720

在我意识到您正在使用“美丽的汤”之前，我开始回答这个问题，但我认为这是一个解析器，我认为它适用于您使用 HTMLParser 库编写的示例字符串

```
from HTMLParser import HTMLParser

results = {}
class myParse(HTMLParser):

   def __init__(self):
      self.state = ""
      HTMLParser.__init__(self)

   def handle_starttag(self, tag, attrs):
      attrs = dict(attrs)
      if tag == "font" and attrs.has_key("class") and attrs['class'] == "test-proof":
         self.state = "getKey"

   def handle_endtag(self, tag):
      if self.state == "getKey" and tag == "font":
         self.state = "getValue"

   def handle_data(self, data):
      data = data.strip()
      if not data:
         return
      if self.state == "getKey":
         self.resultsKey = data
      elif self.state == "getValue":
         if results.has_key(self.resultsKey):
            results[self.resultsKey] += " " + data 
         else: 
            results[self.resultsKey] = data

if __name__ == "__main__":
   p_tags = """<p class="foo-body">  <font class="test-proof">Full name</font> Foobar<br />  <font class="test-proof">Born</font> July 7, 1923, foo, bar<br />  <font class="test-proof">Current age</font> 27 years 226 days<br />  <font class="test-proof">Major teams</font> <span style="white-space: nowrap">Japan,</span> <span style="white-space: nowrap">Jakarta,</span> <span style="white-space: nowrap">bazz,</span> <span style="white-space: nowrap">foo,</span> <span style="white-space: nowrap">foobazz</span><br />  <font class="test-proof">Also</font> bar<br />  <font class="test-proof">foo style</font> hand <br />  <font class="test-proof">bar style</font> ball<br />  <font class="test-proof">foo position</font> bak<br />  <br class="bar" /></p>"""
   parser = myParse()
   parser.feed(p_tags)
   print results 
```

给出结果：

```
{'foo position': 'bak', 
'Major teams': 'Japan, Jakarta, bazz, foo, foobazz', 
'Also': 'bar', 
'Current age': '27 years 226 days', 
'Born': 'July 7, 1923, foo, bar' , 
'foo style': 'hand', 
'bar style': 'ball', 
'Full name': 'Foobar'} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T13:41:10.190

抱歉，代码过于复杂，我急需大量咖啡因；）

```
import re

str = """<p class="foo-body">
  <font class="test-proof">Full name</font> Foobar<br />
  <font class="test-proof">Born</font> July 7, 1923, foo, bar<br />
  <font class="test-proof">Current age</font> 27 years 226 days<br />
  <font class="test-proof">Major teams</font> <span style="white-space: nowrap">Japan,</span> <span style="white-space: nowrap">Jakarta,</span> <span style="white-space: nowrap">bazz,</span> <span style="white-space: nowrap">foo,</span> <span style="white-space: nowrap">foobazz</span><br />
  <font class="test-proof">Also</font> bar<br />
  <font class="test-proof">foo style</font> hand <br />
  <font class="test-proof">bar style</font> ball<br />
  <font class="test-proof">foo position</font> bak<br />
  <br class="bar" />
</p>"""

R_EXTRACT_DATA = re.compile("<font\s[^>]*>[\s]*(.*?)[\s]*</font>[\s]*(.*?)[\s]*<br />", re.IGNORECASE)
R_STRIP_TAGS = re.compile("<span\s[^>]*>|</span>", re.IGNORECASE)

def strip_tags(str):
    """Strip un-necessary <span> tags
    """
    return R_STRIP_TAGS.sub("", str)

def get_info(str):
    """Extract useful info from the given string
    """
    data = R_EXTRACT_DATA.findall(str)
    data_dict = {}

    for x in [(x[0], strip_tags(x[1])) for x in data]:
        data_dict[x[0]] = x[1]

    return data_dict

print get_info(str) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T13:03:57.457

您想查找前面有 > 和后面有 < 的字符串，忽略尾随或前导空格。您可以通过循环查看字符串中的每个字符来轻松完成此操作，或者正则表达式可能会有所帮助。类似于 >[ \t]*[^<]+[ \t]*<。

您还可以使用[re.split](http://www.amk.ca/python/howto/regex/regex.html#SECTION000610000000000000000)和表示标签内容的正则表达式，例如 <[^>]*> 作为拆分器，您将在数组中获得一些空条目，但这些很容易删除。

# perl - 从 Perl 程序解析特定 excel 文件时出现内存不足错误

> ID：560940
> 
> 赞同：1
> 
> 时间：2009-02-18T12:52:25.127
> 
> 标签：perl, excel-2003

当 perl 代码运行时，程序会产生一些警告并终止。输出如下：

```
D:\Perl\bin\search tool>perl testa.pl 
UTF-16 surrogate 0xdb79 at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
UTF-16 surrogate 0xdbb1 at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
UTF-16 surrogate 0xd83e at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
UTF-16 surrogate 0xdff8 at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
UTF-16 surrogate 0xdbff at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
UTF-16 surrogate 0xdd98 at D:/Perl/site/lib/Spreadsheet/ParseExcel/FmtDefault.pm line 81\. 
substr outside of string at D:/Perl/site/lib/Spreadsheet/ParseExcel.pm line 1196\. 
Use of uninitialized value in unpack at D:/Perl/site/lib/Spreadsheet/ParseExcel.pm line 1196\. 
substr outside of string at D:/Perl/site/lib/Spreadsheet/ParseExcel.pm line 1196.
Use of uninitialized value in unpack at D:/Perl/site/lib/Spreadsheet/ParseExcel.pm line 1196\. 
Out of memory! 
```

系统信息如下：

Perl 版本：5.010000 操作系统名称：MSWin32 模块版本：（并非全部都是必需的） Spreadsheet::ParseExcel 0.49 Scalar::Util 1.19 Unicode::Map（未安装） Spreadsheet::WriteExcel（未安装） Parse::RecDescent（未安装) 文件::Temp 0.18 OLE::Storage_Lite 0.18 IO::Stringy 2.110

perl 代码如下：

```
use strict; 
    use Spreadsheet::ParseExcel; 
    my $parser = Spreadsheet::ParseExcel->new( 
        CellHandler => \&cell_handler, 
        NotSetCell  => 1 
    ); 
    my $workbook = $parser->Parse('testfile.xls'); 
    sub cell_handler { 
        my $workbook    = $_[0]; 
        my $sheet_index = $_[1]; 
        my $row         = $_[2]; 
        my $col         = $_[3]; 
        my $cell        = $_[4]; 
        print $cell->unformatted(), "\n"; 
    } 
```

我也有示例 testfile.xls。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T13:28:43.370

这个问题在电子表格::ParseExcel Google Group [here](http://groups.google.com/group/spreadsheet-parseexcel/msg/93a9da1f650eded6)上得到了回答。

问题是特定文件是加密的。

约翰。

# java - Java 中的按位与，按位包含或问题

> ID：560956
> 
> 赞同：11
> 
> 时间：2009-02-18T12:59:31.337
> 
> 标签：java, bit-manipulation, byte, operator-keyword

我在一个项目中有几行代码，我看不到......

```
buffer[i] = (currentByte & 0x7F) | (currentByte & 0x80); 
```

它从文件中读取文件缓冲区，存储为字节，然后如图所示传输到缓冲区 [i]，但我不明白总体目的是什么，有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T14:10:33.397

正如其他答案已经说明的那样，`(currentByte & 0x7F) | (currentByte & 0x80)`相当于`(currentByte & 0xFF)`。JLS3 [15.22.1](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#15.22)说这被提升为`int`：

> 当运算符 &、^ 或 | 的两个操作数 是可转换（第 5.1.8 节）为原始整数类型的类型，首先对操作数执行二进制数字提升（第 5.6.2 节）。按位运算符表达式的类型是操作数的提升类型。

因为 JLS3 [5.6.2](http://java.sun.com/docs/books/jls/third_edition/html/conversions.html#170983)说当`currentByte`有类型`byte`并且`0x7F`是一个`int`（情况就是这样）时，两个操作数都被提升为`int`.

因此，`buffer`将是一个元素类型`int`或更宽的数组。

现在，通过在`& 0xFF`上执行`int`，我们有效地将原始范围 -128..127 映射到无符号范围 0..255，例如流`byte`经常使用的操作。`java.io`

您可以在以下代码片段中看到这一点。请注意，要了解这里发生的情况，您必须知道 Java 将整数类型（除了`char`）存储为[2 的补码](http://en.wikipedia.org/wiki/Two%27s_complement)值。

```
byte b = -123;
int r = b;
System.out.println(r + "= " + Integer.toBinaryString(r));
int r2 = b & 0xFF;
System.out.println(r2 + "= " + Integer.toBinaryString(r2)); 
```

最后，对于一个真实世界的示例，请查看 Javadoc 和`read`方法的实现`java.io.ByteArrayInputStream`：

```
/**
 * Reads the next byte of data from this input stream. The value 
 * byte is returned as an <code>int</code> in the range 
 * <code>0</code> to <code>255</code>. If no byte is available 
 * because the end of the stream has been reached, the value 
 * <code>-1</code> is returned. 
 */
public synchronized int read() {
return (pos < count) ? (buf[pos++] & 0xff) : -1;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T13:03:54.197

```
 (currentByte & 0x7F) | (currentByte & 0x80) 
```

相当于

```
 currentByte & (0x7F | 0x80) 
```

这等于

```
 currentByte & 0xFF 
```

这与

```
 currentByte 
```

编辑：我只看了右边的作业，我仍然认为等价是真的。

但是，似乎代码想要将带符号的字节转换为更大的类型，同时将字节解释为无符号的。

有没有更简单的方法将有符号字节转换为 Java 中的无符号字节？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T13:02:32.547

我想有人在这里想太多了。那是不对的。

我只有一句话

*   原作者担心运行时将字节替换为本机有符号整数（可能是 32 位），并明确试图告诉我们有关符号位“特殊”的一些信息？

这是留下的代码。除非你知道你在一个可疑的运行时间？无论如何，“缓冲区”的类型是什么？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T13:03:36.317

**复杂的按位逻辑完全是多余的。**

```
for (int i = 0; i < buffer.length; i++) {
    buffer[i] = filebuffer[currentPosition + i] & 0xff;
} 
```

做同样的事情。如果缓冲区被声明为一个字节数组，你甚至可以省略 & 0xff，但不幸的是声明没有显示。

原因可能是最初的开发人员对用 Java 签名的字节感到困惑。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T13:08:40.550

按位与运算的结果在两个位都为 1 的位上为 1，而按位或运算的结果在任何一个 bot 位为 1 的位上具有一个。

因此，对值 0x65 的示例评估：

```
 01100101 0x65
& 01111111 0x7F
===============
  01100101 0x65

  01100101 0x65
& 10000000 0x80
===============
  00000000 0x00

  01100101 0x65
| 00000000 0x00
===============
  01100101 0x65 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T20:09:17.560

这些逻辑运算的好处是：您可以尝试所有可能的组合（全部 256 种）并验证您是否得到了预期的答案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T10:38:12.270

Turns out, the file which the byte was being read from was in a signed bit notation, and of a different length, therefore it was requried to perform this task to allow it to be extended to the java int type, while retaining its correct sign :)

# batch-file - 如何在 del 失败时停止批处理脚本

> ID：560967
> 
> 赞同：10
> 
> 时间：2009-02-18T13:02:51.810
> 
> 标签：batch-file

我们有一个删除文件 ( `del`) 和目录 ( `rd`) 的批处理脚本。如果这些删除语句中的任何一个失败，有谁知道如何停止（失败）执行脚本？如果文件/目录被 Windows 锁定，它们可能会失败。谢谢。

**更新**

我正在使用的语句：

德尔：`del *.* /S /Q`

研发：`FOR /D %%G in (*) DO RD /s /q %%G`

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-18T16:34:59.117

要删除文件，您可以先尝试`ren`（重命名）文件。 `ren`如果文件被锁定，将设置 ERRORLEVEL 为 1。在文件名周围添加引号。

```
@echo OFF

:: Delete all files, but exit if a file is locked.
for %%F in (*.*) do (
    @echo Deleting %%F
    ren "%%F" tmp 2> nul
    if ERRORLEVEL 1 (
        @echo Cannot delete %%F, it is locked.
        exit /b 1
    )
    del tmp
) 
```

我怀疑您可能可以对目录执行相同的操作，但我似乎无法弄清楚如何锁定目录以便进行测试。以下可能有效：

```
:: Remove all directories, but exit if one is locked.
FOR /D %%G in (*) DO (
    @echo Removing %%G
    ren "%%G" tmpdir 2> nul
    if ERRORLEVEL 1 (
        @echo Cannot remove %%G, it is locked
        exit /b 1
    )
    RD /s /q tmpdir
) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T13:20:49.083

如果文件被锁定，DEL 不会返回错误级别。我刚刚用 excel 文件做了一个测试，我看到一个零（在 Windows XP 上）。

执行删除后，对要删除的文件使用 IF EXIST 可能会更好。

```
del file.txt
if exist file.txt ECHO "FAIL" 
```

**编辑后** 免责声明：我不知道这是如何执行的......

您可以对文件执行此操作

```
DIR /B /S /A-d > c:\filestodelete.txt

del *.* /S /Q    

FOR /F %%i in (c:\filestodelete.txt) DO (
    IF EXIST %%i ECHO %%i STILL EXISTS
) 
```

然后对于目录

```
DIR /B /S /Ad > c:\directoriestodelete.txt

FOR /D %%G in (*) DO RD /s /q %%G    

FOR /F %%i in (c:\directoriestodelete.txt) DO (
    IF EXIST %%i ECHO %%i STILL EXISTS
) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T13:06:43.347

**编辑：**对，所以`del`没有`ERRORLEVEL`正确设置。请参阅[DEL 上的 ERRORLEVEL](http://www.computing.net/answers/programming/errorlevel-on-del-command/16710.html)和[Windows 删除命令可能会静默失败](http://www.dmst.aueb.gr/dds/news/169.html)

**上一个（不正确的）解决方案**

你应该检查`errorlevel`.

例如：

```
del file.txt
if errorlevel 1 goto FAIL
:PASS
echo Worked!
goto :END

:FAIL
echo Failed!
exit /B 1

:END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-01T14:25:30.850

这是我在删除文件时检查错误的首选方法。我们将“错误输出”（标准文件“2”）重定向到一个文件（例如 delCmd.err）。然后我们使用 FOR 命令作为访问 ~z "file size" 操作符的一种方式。如果输出文件的大小不为 0，那么我们知道“del”出错了……我们用“type”命令显示错误并以非零错误代码退出批处理文件：

```
del unwanted.txt 2> delCmd.err
FOR /F "usebackq" %%A IN ('delCmd.err') DO set size=%%~zA
if not "%size%"=="0" (
    echo Error deleting unwanted.txt
    type delCmd.err
    exit /B 1
) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-11T07:18:04.057

这是结果监控变体的较短版本。这是使用`2>&1`技巧将 stderr 重定向到 stdout 并`for /f`检查任何输出。

```
@echo off
setlocal
set error=0
for /f %%i in ('del notepad2.exe 2^>^&1') do set error=1
echo %error% 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-18T09:40:07.640

仅供您参考。如果发生严重错误， DEL 命令*确实会*返回错误代码，但是它的行为超出了我们的直觉，人们会简单地认为错误代码根本不起作用。

这是我在 Windows 7 的 DEL 命令中测试过的：

*   成功删除所有文件：0（当然）
*   删除了一些文件，丢失了一些文件：0（直觉预期为 1）
*   由于没有权限或只读介质导致删除失败：0（直觉期望≥1）
*   不存在的驱动器或驱动器未准备好（例如 CD-ROM 驱动器上没有 CD）：**1（是的，你明白了，但我会期待更高的错误代码）**
*   无效路径：**1（我也会期望更高的错误代码）**

并且，如果您为 DEL 命令指定一个文件列表，其中至少一个文件符合上述最后两种错误，则*列表中的任何文件都不会被删除*。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-19T18:19:18.563

有一个脚本可以像魅力一样工作。它通过测试假定删除的文件/目录的存在来测试删除失败。

输出将是内容完全为空的现有 c:\mydirectory。任何错误都会中断该过程并被报告。

唯一的缺点是目录被递归删除，因为没有简单的方法可以从大多数“子”目录开始删除目录。

```
@echo OFF
set path_to_clean=c:\mydirectory

@echo -Deleting Files
dir /A-D /S /B %path_to_clean%\* > fileslist.txt
for /F %%F in (fileslist.txt) do (
    @echo Deleting %%F
    del %%F 2> nul
    if exist %%F (
        @echo Cannot delete %%F, it is locked.
        goto errorhandling
    )
)
del fileslist.txt
@echo -Deleting Files done

@echo -Deleting Directories
dir /AD /B %path_to_clean%\* > directorieslist.txt

for /F %%D in (directorieslist.txt) do (
    @echo Deleting %path_to_clean%\%%D
    rmdir /S /Q %path_to_clean%\%%D 2> nul
    if exist %path_to_clean%\%%D (
        @echo Cannot delete %path_to_clean%\%%D. This folder or one of its sub-directories is locked.
        goto errorhandling
    )
)
del directorieslist.txt
@echo -Deleting Directories done

:errorhandling
rem some code here 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-22T14:31:21.103

这些似乎对我有用：

研发：

```
FOR /D %d IN (*) DO ( RD /S /Q "%d" & IF EXIST "%d" EXIT /B 1 ) 
```

删除：

```
FOR %f IN (*.*) DO ( DEL /Q "%f" & IF EXIST "%f" EXIT /B 1 ) 
```

虽然不知道性能。

您可以将标志 /F 添加到 DEL 以实现“强制删除”模式。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-03-06T10:10:28.387

因为你可以`rd`做`rmdir`

```
rd "some directory" || rem 
```

这将正确设置错误级别 -[请参阅](https://stackoverflow.com/questions/11137702/batch-exit-code-for-rd-is-0-on-error-as-well)

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-03-06T10:34:47.697

嗨，这也应该有效

```
@echo off  

for /f %%i in ('del notepad2.exe 2^>^&1') do set ERRORLEVEL=1
IF %ERRORLEVEL%=1 then exit 
```

# testing - 如何在行为不端的 i/o 下测试应用程序的可靠性

> ID：560975
> 
> 赞同：2
> 
> 时间：2009-02-18T13:04:37.547
> 
> 标签：testing, io, usability, reliability

~~几乎~~每个应用程序都执行 i/o 操作，无论是使用磁盘还是通过网络。

由于我的应用程序在开发时环境下运行良好，我想确保它们在 Internet 连接缓慢或不稳定，或者当用户试图从写得不好的 CD 中读取数据时仍然可以正常工作。

你会推荐什么工具来模拟：

*   慢速 i/o（打开文件、*关闭*文件、读写、目录项枚举）
*   偶尔的 i/o 错误
*   偶尔的“拒绝访问”响应
*   tcp/ip 丢包
*   ETC...

* * *

编辑：

Windows：
完成上述工作的最接近的解决方案似乎是 holodeck，商业软件（>900 美元）。

Linux：
目前还没有找到开放的解决方案，但可以达到smcameron和krosenvold指定的相同效果。

* * *

装饰器模式是个好主意。它需要包装我的 i/o 类，但会产生一个测试框架。唯一剩下的未经测试的代码将在 3rd 方库中。

然而我决定不走这条路，而是让我的代码保持原样并从外部模拟 i/o 错误。

* * *

我现在知道我需要的是所谓的“故障注入”。我认为这是一个常见的生产线部件，有很多我不知道的解决方案。（顺便说一句，另一个类似的好主意是“模糊测试”，感谢 Lennart）

在我看来，这个问题仍然不值 900 美元。我将实现我自己的基于 hooks 的开源工具（针对 win32）。完成后我会更新这篇文章。三四个星期后回来...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T13:15:25.430

您需要的是一个故障注入测试系统。James Whittaker 的[“如何破解软件”](https://rads.stackoverflow.com/amzn/click/com/0201796198)是关于这个主题的好读物，其中包括一张包含许多所需工具的 CD。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:16:27.863

如果你在 linux 上，你可以用 iptables 做很多魔法；

iptables -I OUTPUT -p tcp --dport 7991 -j DROP

也可以模拟连接向上/向下。那里有很多教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T13:18:23.037

查看“模糊测试”：[http ://en.wikipedia.org/wiki/Fuzzing](http://en.wikipedia.org/wiki/Fuzzing)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T13:19:20.353

在编程级别，许多框架将允许您包装 IO 流类并将调用委托给包装的实例。我会这样做并在关键方法中添加几个等待调用（写入字节、关闭流、抛出 IO 异常等）。您可以编写其中一些具有不同故障或问题类型的代码，并根据需要使用装饰器模式进行组合。

这应该会给你很大的灵活性，可以调整哪些操作会变慢，每隔一段时间插入“随机”错误等等。

另一个优点是您可以使用与您的软件相同的代码来开发它，因此维护不需要任何新技能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T06:09:06.057

你没有说什么操作系统，但如果它是 linux 或 unix-ish，你可以包装 open()、read()、write() 或任何库或系统调用等，使用 LD_PRELOAD-able 库来注入故障。

沿着这些思路：http: [//scaryreasoner.wordpress.com/2007/11/17/using-ld_preload-libraries-and-glibc-backtrace-function-for-debugging/](http://scaryreasoner.wordpress.com/2007/11/17/using-ld_preload-libraries-and-glibc-backtrace-function-for-debugging/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T15:10:31.317

正如我最初所想的那样，我没有去编写自己的文件系统过滤器，因为有一个更简单的解决方案。

## 1\. 网络输入/输出

我在这里找到了至少 2 种模拟 i/o 错误的方法。

a) 运行虚拟机（如 vmware）允许配置带宽和丢包率。Vmware 支持在机调试。

b) 在本地机器上运行代理并通过它隧道传输所有流量。对于 upd/tcp 通信，可以使用代理（例如，widecap）。

## 2.文件输入/输出

通过将驱动器号映射到驻留在虚拟机内部的网络共享，我设法将这种情况推导出到前一种情况。文件 i/o 会很慢。

存在一种更便宜的替代方案：设置本地 ftp 服务器（例如 FileZilla），配置速度并使用 Novell 的 NetDrive 访问它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T13:15:46.727

你会想为此设置一个测试实验室。你到底在构建什么类型的应用程序？您真的希望应用程序收到损坏的数据吗？

我知道人们尝试过的 Microsoft Exchange Server 测试技术是向服务器发送噪音。基本上用看似随机的数据提供每一个可能的输入。他们设法以这种方式经常使服务器崩溃。

但是，如果您不能信任未签名的输入，则适用一般规则。跟踪每个可能不受信任的操作（数据损坏的结果），您应该能够优雅地处理大多数问题。

只需在随机输入上测试您的应用程序行为，这应该会发现大多数问题，但您将永远无法完全保护自己免受损坏数据的侵害。这是不可能的，因为数据可能是在应用程序本身内传递的某些内部缓冲区的一部分。

注意解码数据的时间和方式。就这些。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T13:19:07.780

您需要做的第一件事是定义在这些情况下“正确”的含义。您只能针对预期行为的定义进行测试。

测试的策略将取决于技术。在自动化单元测试的上下文中，我发现在 Java 等 OO 语言中，使用各种“模拟”或“存根”将行为不端的 InputStreams 传递给使用文件 I/O 的部分代码非常有用.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T05:50:20.750

考虑使用[holodeck](http://www.securityinnovation.com/holodeck/index.shtml)进行一些故障注入，如果您可以访问备用硬件，则可以使用[Netem](http://www.linuxfoundation.org/en/Net:Netem)或基于它的商业产品[Mini-Maxwell](http://www.myminimaxwell.com/mini-maxwell-news/mm-tech-specs/menu-id-25.html)模拟网络损伤，这比免费的要贵得多，但可能更容易使用。

# keyboard - 一种始终将 Shift 与数字键一起使用的方法

> ID：560977
> 
> 赞同：-2
> 
> 时间：2009-02-18T13:05:30.260
> 
> 标签：keyboard, typing

`Shift`每当使用键盘顶部的数字行时，有没有办法模拟被按下？我在 Vista 上，希望能对应用程序或注册表进行调整。

我的手指有问题，所以我想使用数字键盘输入数字，而不是一直按住`Shift`输入这些字符：！"£$%^&*()

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T13:08:58.660

有一个来自 MS 的[Layout Creator](http://www.microsoft.com/globaldev/tools/msklc.mspx)，也许可以帮助你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:17:08.970

大写锁定？

# apache-flex - 如何调试 swf 浏览器崩溃

> ID：560979
> 
> 赞同：4
> 
> 时间：2009-02-18T13:05:51.647
> 
> 标签：apache-flex, actionscript-3, browser, flash

我的 swf 偶尔会导致浏览器崩溃（或者就像 chrome 告诉我的那样，只是让插件崩溃）。

如何诊断错误？我正在使用 flex 为 flash player 9 开发。

我尝试过的事情：

*   打开日志文件，以便我可以看到 trace("...") 输出。但是，我的日志文件和我的 swf 以不一致的终止点结束。
*   安装flash播放器调试版
*   尝试了不同的浏览器（今天我在vista，并且可以在四个浏览器上重现该错误）。

我希望插件有一个[清晰的]堆栈跟踪。有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T14:47:24.680

在刷新日志文件之前，flash 插件很可能导致崩溃。我唯一可以推荐的是安装[Windows Debugging Tools](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)。

然后调出命令提示符（如果在 vista 中则以管理员身份），然后键入以下内容：

```
cd "%programfiles%\Debugging Tools for Windows"
adplus -crash -pn iexplore.exe 
```

（显然，将 iexplore.exe 更改为您正在运行的任何浏览器。）

现在，在浏览器中使用您的 flex 应用程序，直到它崩溃。这将在 %programfiles%\Debugging Tools for Windows\Crash_Mode__Date_02-18-2009__Time_14-40-0202 中创建故障转储（将使用实际日期）。

您现在可以将该迷你转储（最小的 dmp 文件）发送给 Adob​​e，以便他们可以正确分析它。

如果您想查看（本机）调用堆栈以发现导致问题的原因，您可以加载 windbg 并加载转储文件（文件 > 打开故障转储）。加载后，在 windbg 命令行中键入以下内容并按回车键：

```
~* kb 2000 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T18:39:28.990

我发现的有关掩码和文本字段的错误的一些细节：

[http://summitprojectsflashblog.wordpress.com/2008/04/16/flash-browser-crashing-bug/](http://summitprojectsflashblog.wordpress.com/2008/04/16/flash-browser-crashing-bug/)

[http://team.bkwld.com/2007/11/21/flash-player-crashes-browser-when-closing-window-possible-fix/](http://team.bkwld.com/2007/11/21/flash-player-crashes-browser-when-closing-window-possible-fix/)

# linux - 如何在 bash 中传递完整的参数列表，同时将多字参数保持在一起？

> ID：560987
> 
> 赞同：10
> 
> 时间：2009-02-18T13:08:49.630
> 
> 标签：linux, bash

我在 bash 变量扩展中遇到了一些分词问题。我希望能够将参数列表存储在变量中并运行它，但是任何引用的多字参数都没有评估我对它们的期望。

我会用一个例子来解释我的问题。假设我有一个函数`decho`可以在自己的行上打印每个位置参数：

```
#!/bin/bash -u
while [ $# -gt 0 ]; do
  echo $1
  shift
done 
```

好的，如果我去，`decho a b "c d"`我会得到：

```
[~]$ decho a b "c d"
a
b
c d 
```

这是我期望和想要的。但另一方面，如果我从变量中获取参数列表，我会得到：

```
[~]$ args='a b "c d"'
[~]$ decho $args
a
b
"c
d" 
```

这不是我想要的。我可以去：

```
[~]$ echo decho $args | bash
a
b
c d 
```

但这似乎有点笨拙。有没有更好的方法让 in 的扩展按`$args`我`decho $args`预期的方式进行分词？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T13:27:36.853

您可以使用：

```
eval decho $args 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T14:49:53.570

您可以在脚本中移动 eval：

```
#!/bin/bash -u
eval set -- $*
for i; 
do 
  echo $i;
done 
```

现在你可以这样做：

```
$ args='a b "c d"'
$ decho $args
a
b
c d 
```

但是如果您在 CL 上传递参数，则必须引用它们：

```
$ decho 'a b "c d"'
a
b
c d 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T13:27:30.537

你有没有尝试过：

```
for arg in "$@"
do
        echo "arg $i:$arg:"
        let "i+=1"
done 
```

应该产生类似的东西：

```
arg 1: a
arg 2: c d 
```

在你的情况下。

直接凭记忆，不保证:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T13:28:33.543

嗯..`eval decho $args`也可以：

```
[~]$ eval decho $args
a
b
c d 
```

而且我也许可以使用 bash 数组做一些事情`"${array[@]}"`（它的工作原理类似于`"$@"`），但是我必须编写代码来加载数组，这会很痛苦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-18T19:40:24.970

尝试将存储在变量中的参数列表传递给命令从根本上是有缺陷的。

据推测，如果您在某处有代码来创建包含预期参数的变量。对于命令，则可以将其更改为将 args 存储到数组变量中：

```
decho_argv=(a b 'c d')  # <-- easy! 
```

然后，您可以执行以下操作，而不是更改命令“decho”以适应从普通变量中获取的参数（这将破坏其处理普通参数的能力）：

```
decho "${decho_argv[@]}"  # USE DOUBLE QUOTES!!! 
```

但是，如果您尝试采用任意输入，该输入应该是与预期命令位置参数相对应的字符串字段，并且您希望将这些参数传递给命令，那么您应该不使用变量，而是阅读将数据放入一个数组中。

请注意，提供使用 eval 来使用普通变量的内容设置位置参数的建议是非常危险的。

因为，将变量的内容暴露给命令行上的引号删除和分词无法防止变量中字符串中的 shell metachars 造成破坏。

例如，想象在以下示例中，如果单词“man”被替换为“rm”和“-rf”这两个单词，并且最后的 arg 单词是“*”：

**不要这样做：**

```
> args='arg1 ; man arg4'
> eval set -- $args
No manual entry for arg4
> eval set -- "$args"        # This is no better
No manual entry for arg4
> eval "set -- $args"        # Still hopeless
No manual entry for arg4

> eval "set -- '$args'"  # making it safe also makes it not work at all!
> echo "$1"
arg1 ; man arg4 
```**