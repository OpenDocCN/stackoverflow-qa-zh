# StackOverflow 问答 000383000-000383999

# python - 使用 Python 的 ctypes 传递/读取声明为“struct_name *** param_name”的参数？

> ID：383010
> 
> 赞同：1
> 
> 时间：2008-12-20T06:26:39.307
> 
> 标签：python, pointers, ctypes, structure, sane

我正在尝试使用 Python 的 ctypes 库来访问扫描库[SANE](http://www.sane-project.org/)中的一些方法。这是我第一次使用 ctypes，也是我一年多以来第一次不得不处理 C 数据类型，所以这里有一个公平的学习曲线，但我认为即使没有这个特定的声明也会很麻烦：

```
extern SANE_Status sane_get_devices (const SANE_Device *** device_list, SANE_Bool local_only); 
```

首先，我已经成功处理了`SANE_Status`(an enum) 和`SANE_Bool`(a typedef to `c_int`)。这些都很简单。另一方面，第一个参数给我带来了各种各样的悲伤。我不熟悉“ `***`”符号，到目前为止，我的示踪子弹只产生了垃圾数据。如何格式化此函数的输入，以便我可以读回我的 Python 结构对象列表？作为参考，被引用的 C 结构是：

```
typedef struct
{
    SANE_String_Const name; /* unique device name */
    SANE_String_Const vendor;   /* device vendor string */
    SANE_String_Const model;    /* device model name */
    SANE_String_Const type; /* device type (e.g., "flatbed scanner") */
 }
SANE_Device; 
```

其中`SANE_String_Const`定义为`c_char_p`.

我的这个对象的 Python/ctypes 版本是：

```
class SANE_Device(Structure):
    _fields_ = [
        ("name", c_char_p),
        ("vendor", c_char_p),
        ("model", c_char_p),
        ("type", c_char_p)] 
```

关于我应该传递什么的建议，以便我可以从中获得预期的行为（结构对象列表）？所有回应表示赞赏。

**更新1：**

使用以下内容，我能够检索到正确的 SANE_Device Python 结构：

```
devices = pointer(pointer(pointer(SANE_Device())))
status = libsane.sane_get_devices(devices, c_int(0))
print status, devices, devices.contents.contents.contents.name 
```

但是，1) 糟糕和 2) 似乎只有在只有一个结果时才会起作用。我不能 len() on `devices.contents.contents`or `devices.contents.contents.contents`。我如何确定结果的数量？SANE 文档指定“如果函数成功执行，它会存储一个指向 *device_list 中指向 SANE_Device 结构的指针的 N​​ULL 终止数组的指针”。建议？

**更新 2：**

我能够传递一个十项数组，然后使用以下方法访问第一个元素：

```
devices = pointer(pointer(pointer((SANE_Device * 10)())))
status = libsane.sane_get_devices(devices, c_int(0))
print status, devices, devices.contents.contents.contents[0].name 
```

但是，十显然是一个任意数字，我无法确定实际结果的数量。`devices.contents.contents.contents[1].name`在仅连接一个设备时尝试访问会导致分段错误。必须有一种适当的方法来处理像 ctypes 中这样的可变长度构造。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-20T07:49:30.810

A`const SANE_Device ***`是一个三级指针：它是一个指向一个指向常量 SANE_Device 的指针的指针。您可以使用程序[cdecl](http://gd.tuwien.ac.at/linuxcommand.org/man_pages/cdecl1.html)来破译复杂的 C/C++ 类型定义。

根据[SANE 文档](http://www.sane-project.org/html/doc012.html)，`SANE_get_devices()`如果成功，将存储一个指向以 NULL 结尾的指向 SANE 设备的指针列表的指针。因此，调用它的正确方法是声明一个类型变量`const SANE_Device **`（即，指向指向常量 `SANE_Device 的指针的指针），并传入该指针的地址：

```
const SANE_Device **device_list;
SANE_get_devices(&device_list, local_only);  // check return value
// Now, device_list[0] points to the first device,
// device_list[1] points to the second device, etc.
// Once you hit a NULL pointer, that's the end of the list:
int num_devices = 0;
while(device_list[num_devices] != NULL)
    num_devices++;
// num_devices now stores the total number of devices 
```

现在，这就是您从 C 代码中调用它的方式。我浏览了有关 ctypes 的文档，看来您希望使用该`byref`函数通过引用传递参数，并且您传递的值应该是指向 SANE_Device 的 POINTER 的 POINTER。`pointer`注意和之间的区别`POINTER`：前者创建一个指向*实例*的指针，而后者创建一个指向*类型*的指针。因此，我猜下面的代码会起作用：

```
// SANE_Device declared as you had it
devices = POINTER(POINTER(SANE_Device))()  // devices is a NULL pointer to a pointer to a SANE_Device
status = libsane.sane_get_devices(byref(devices), c_int(0))
if status != successful:   // replace this by whatever success is
    print error
else:
    num_devices = 0
    // Convert NULL-terminated C list into Python list
    device_list = []
    while devices[num_devices]:
        device_list.append(devices[num_devices].contents)  // use .contents here since each entry in the C list is itself a pointer
        num_devices += 1
    print device_list 
```

[编辑] 我已经使用一个非常简单的占位符 for 测试了上面的代码`SANE_get_devices`，它可以工作。

# c++ - stl容器如何被删除？

> ID：383016
> 
> 赞同：7
> 
> 时间：2008-12-20T06:30:17.133
> 
> 标签：c++, memory-management, stl, vector, containers

stl中的vector之类的容器对象如何被销毁，即使它们是在堆中创建的？

**编辑**

如果容器持有指针，那么如何销毁这些指针对象

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-20T08:08:36.950

指针的 STL 容器不会清理指向的数据。它只会清理保存指针的空间。如果您希望向量清理指针数据，您需要使用某种智能指针实现：

```
{
    std::vector<SomeClass*> v1;
    v1.push_back(new SomeClass());

    std::vector<boost::shared_ptr<SomeClass> > v2;
    boost::shared_ptr<SomeClass> obj(new SomeClass);
    v2.push_back(obj);
} 
```

当该范围结束时，两个向量都将释放它们的内部数组。v1 将泄漏创建的 SomeClass，因为数组中只有指向它的指针。v2 不会泄露任何数据。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T08:09:01.050

如果您有`vector<T*>`，您的代码需要在删除向量之前删除这些指针：否则，该内存会泄漏。

知道 C++ 不做垃圾收集，这里有一个例子说明原因（语法错误的应用程序，自从我写 C++ 以来已经有一段时间了）：

```
typedef vector<T*> vt;
⋮
vt *vt1 = new vt, *vt2 = new vt;
T* t = new T;
vt1.push_back(t);
vt2.push_back(t);
⋮
delete vt1; 
```

最后一行 ( `delete vt1;`) 显然不应该删除它包含的指针；毕竟，它也在vt2中。所以它没有。也不会删除`vt2`.

（如果你想要一个在销毁时删除指针的向量类型，当然可以编写这样的类型。可能已经编写了。但要小心删除其他人仍然持有副本的指针。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T06:55:09.343

当向量超出范围时，编译器会调用其析构函数，从而释放堆上分配的内存。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-20T07:04:38.670

这有点用词不当。与大多数 STL 容器一样，向量由 2 个逻辑部分组成。

1.  向量实例
2.  实际的底层数组实现

虽然是可配置的，但#2 几乎总是存在于堆上。#1 但是可以存在于堆栈或堆上，它只取决于它的分配方式。例如

```
void foo() { 
  vector<int> v;
  v.push_back(42);
} 
```

在这种情况下，第 1 部分位于堆栈中。

现在＃2如何被破坏？当向量的第一部分被破坏时，它也会破坏第二部分。这是通过删除向量类的析构函数内的底层数组来完成的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-20T09:22:51.870

如果将指针存储在 STL 容器类中，则需要在对象被销毁之前手动删除它们。这可以通过遍历整个容器并删除每个项目来完成，或者通过使用某种智能指针类来完成。但是不要使用 auto_ptr，因为它根本不适用于容器。

这样做的一个好的副作用是，您可以在程序中保留多个指针容器，但这些对象只属于其中一个容器，您只需要清理那个容器。

删除指针的最简单方法是：

```
for (ContainerType::iterator it(container.begin()); it != container.end(); ++it)
{
    delete (*it);
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-20T13:04:33.000

在向量内使用智能指针，或使用 boost 的 ptr_vector。它将自动释放其中分配的对象。还有地图、套装等。

[http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_vector.html](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_vector.html) 和主站点： http: [//www.boost.org/doc/libs/1_37_0/libs/ptr_container/ doc/ptr_container.html](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_container.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-20T06:32:49.933

与堆中的任何其他对象一样，它必须手动销毁（使用删除）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-20T07:57:39.607

要回答您的第一个问题：

STL 类没有什么特别之处（我希望如此）。它们的功能与其他模板类完全相同。因此，如果在堆上分配它们，它们不会自动销毁，因为 C++ 对它们没有垃圾收集（除非你用一些花哨的 autoptr 业务或其他东西告诉它）。如果您在堆栈上分配它（没有 new），它很可能会由 C++ 自动管理。

对于第二个问题，这里有一个非常简单的 ArrayOfTen 类来演示 C++ 中典型内存管理的基础知识：

```
/* Holds ten Objects. */
class ArrayOfTen {
    public:
        ArrayOfTen() {
            m_data = new Object[10];
        }

        ~ArrayOfTen() {
            delete[] m_data;
        }

        Object &operator[](int index) {
            /* TODO Range checking */
            return m_data[index];
        }

    private:
        Object *m_data;

        ArrayOfTen &operator=(const ArrayOfTen &) { }
};

ArrayOfTen myArray;
myArray[0] = Object("hello world"); // bleh 
```

基本上，ArrayOfTen 类在堆上保留了一个由十个 Object 元素组成的内部数组。当在构造函数中调用 new[] 时，堆上分配了十个对象的空间，并构造了十个对象。类似地，当在析构函数中调用 delete[] 时，十个对象被解构，然后之前分配的内存被释放。

对于大多数（全部？）STL 类型，调整大小是在幕后完成的，以确保留出足够的内存来容纳您的元素。上面的类只支持十个对象的数组。它基本上是 Object[10] 的一个非常有限的 typedef。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-20T13:42:32.330

为了删除指向的元素，我写了一个简单的仿函数：

```
template<typename T>
struct Delete {
    void operator()( T* p ) const { delete p; }
};

std::vector< MyType > v;
// ....
std::for_each( v.begin(), v.end(), Delete<MyType>() ); 
```

但是当向量的内容要……嗯……共享时，你应该使用共享指针。是的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-20T18:05:25.857

[从 STL 序列容器中删除指针的函子](http://www.codeproject.com/KB/stl/freeptrfnc.aspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-20T22:58:48.867

标准 STL 容器使用复制构造函数将原始对象的副本放入容器中。当容器被销毁时，容器中每个对象的析构函数也会被调用以安全地销毁该对象。

指针的处理方式相同。
问题是指针是 POD 数据。指针的复制构造函数只是复制地址，POD 数据没有析构函数。如果您希望容器管理指针，您需要：

*   使用智能指针容器。（例如共享指针）。
*   使用 boost ptr 容器。

我更喜欢指针容器：
指针容器与 STL 容器相同，只是您将指针放入其中，但容器随后会获得指针指向的对象的所有权，因此会在容器被销毁。

当您访问 ptr 容器的成员时，它们会通过引用返回，因此它们的行为就像在标准算法中使用的标准容器一样。

```
int main()
{
    boost::ptr_vector<int>    data;

    data.push_back(new int(5));
    data.push_back(new int(6));

    std::cout << data[0] << "\n";  // Prints 5.
    std::cout << data[1] << "\n";  // Prints 6.

}   // data deallocated.
    // This will also de-allocate all pointers that it contains.
    // by calling delete on the pointers. Therefore this will not leak. 
```

还应该指出，容器中的智能指针是一种有效的替代方案，不幸的是 std::auto_ptr<> 在这种情况下不是智能指针的有效选择。

这是因为 STL 容器假定它们包含的对象是可复制的，不幸的是 std::auto_ptr<> 在传统意义上是不可复制的，因为它破坏了复制的原始值，因此复制的源不能是 const。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-08-05T05:08:36.127

STL 容器与任何其他对象一样，如果您实例化一个容器，它将在堆栈上创建：

```
std::vector<int> vec(10); 
```

就像任何其他堆栈变量一样，它只存在于定义它的函数的范围内，不需要手动删除。STL容器的析构函数会调用容器中所有元素的析构函数。

将指针保存在容器中是一个冒险的问题。由于指针没有析构函数，我会说你永远不想将原始指针放入 STL 容器中。以异常安全的方式执行此操作将非常困难，您必须在代码中添加 try{}finally{} 块，以确保始终释放包含的指针。

那么你应该将什么放入容器而不是原始指针？+1 jmucchiello 用于提升 boost::shared_ptr。boost::shared_ptr 在 STL 容器中使用是安全的（与 std::auto_ptr 不同）。它使用简单的引用计数机制，并且可以安全地用于不包含循环的数据结构。

包含循环的数据结构需要什么？在这种情况下，您可能想学习垃圾收集，这实际上意味着使用不同的语言，例如 Java。但这是另一个讨论。;)

# http - 是否有任何用于区分 HTTP 请求/响应的工具？

> ID：383017
> 
> 赞同：1
> 
> 时间：2008-12-20T06:31:00.873
> 
> 标签：http, proxy, diff

我正在尝试调试一些非常挑剔/复杂的网络服务的问题，其中一些理论上发出相同请求的客户端得到不同的结果。像 Charles 这样的调试代理有很大帮助，但由于请求很复杂（大量的标头、cookie、查询字符串、表单数据等），并且客户端以不同的顺序创建标头（这应该是完全可以接受的）等等。这是一个手动完成非常繁琐的过程。

我正在考虑自己写一些东西来做这件事，但我希望其他人已经解决了这个问题？

顺便说一句，有没有人知道任何完全开源的类似 Charles 的调试代理？如果 Charles 是开源的，我肯定会将我在这方面所做的任何工作贡献给项目。如果那里有类似的东西，我宁愿这样做而不是从头开始编写一个单独的程序（特别是因为我认为 Charles 或任何类似物已经拥有我可能需要的所有数据结构等）。

编辑：为了清楚起见——文本差异将不起作用，因为行的顺序（例如，至少标题）可能不同和/或行内的值顺序（例如，至少 cookie）可能不同，并且在这两种情况下都是只要名称、值和元数据都相同，不同的排序不应导致其他方面相同的请求被视为不同。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T13:05:29.657

如果您的路径中有 WinDiff，[Fiddler就有这样的选择。](http://www.fiddlertool.com/fiddler/)我不知道它是否适合您的需求，因为乍一看它只是在进行文本比较。但也许它使之前的会议正常化，所以我不能说。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T06:41:33.037

如果没有为该作业构建任何目的，您可以使用数据包捕获将消息内容保存到文本文件（将自身插入 IP 堆栈的文件，如 CommView）。您可以通过文本区分不同消息的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T12:51:11.123

开源代理[Squid](http://www.squid-cache.org/)可以提供帮助吗？

# sql - 存储查找表 ID 或纯数据之间的决定

> ID：383026
> 
> 赞同：16
> 
> 时间：2008-12-20T06:35:25.263
> 
> 标签：sql, database, lookup, database-normalization

我发现这个问题很多，我不确定最好的方法。

**我的问题是如何在使用外键查找表或直接在请求它的表中使用查找表值之间做出决定，完全避免查找表关系。**

要记住的几点：

*   使用第二种方法，如果在查找表中更改了数据，您将需要对引用数据的所有记录进行大规模更新。

*   这更侧重于具有大量列引用许多查找表的表。因此，每次查询表时，大量外键意味着大量连接。

*   该数据将来自从查找表中提取的下拉列表。为了在重新加载时匹配数据，值需要在现有列表中（*与第一点相关*）。

这里有最佳实践，还是需要考虑的关键点？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-20T20:00:28.150

您可以使用带有 VARCHAR 主键的查找表，并且您的主数据表在其列上使用 FOREIGN KEY，并进行级联更新。

```
CREATE TABLE ColorLookup (
  color VARCHAR(20) PRIMARY KEY
);

CREATE TABLE ItemsWithColors (
  ...other columns...,
  color VARCHAR(20),
  FOREIGN KEY (color) REFERENCES ColorLookup(color)
    ON UPDATE CASCADE ON DELETE SET NULL
); 
```

该解决方案具有以下优点：

*   您可以查询主数据表中的颜色名称，而无需连接到查找表。
*   然而，颜色名称受限于查找表中的颜色集。
*   您可以通过查询查找表来获取唯一颜色名称的列表（即使当前没有在主数据中使用）。
*   如果您更改查找表中的颜色，则更改会自动级联到主数据表中的所有引用行。

* * *

令我惊讶的是，这个线程上的许多其他人似乎对什么是“规范化”有错误的想法。使用代理键（无处不在的“id”）与规范化无关！

* * *

来自@MacGruber 的重新评论：

是的，尺寸是一个因素。例如，在 InnoDB 中，每个二级索引都存储出现给定索引值的行的主键值。因此，您拥有的二级索引越多，对主键使用“庞大”数据类型的开销就越大。

这也会影响外键；外键列必须与其引用的主键具有相同的数据类型。您可能有一个小型查找表，因此您认为 50 行表中的主键大小无关紧要。但是该查找表可能会被其他表中的数百万或*数十亿*行引用！

没有适用于所有情况的正确答案。对于不同的情况，任何答案都可能是正确的。您只需了解权衡取舍，并尝试根据具体情况做出明智的决定。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T15:46:36.167

在简单的原子值的情况下，我倾向于不同意这一点的普遍智慧，主要是在复杂性方面。考虑一张包含帽子的桌子。您可以执行“非规范化”方式：

```
CREATE TABLE Hat (
  hat_id INT NOT NULL PRIMARY KEY,
  brand VARCHAR(255) NOT NULL,
  size INT NOT NULL,
  color VARCHAR(30) NOT NULL /* color is a string, like "Red", "Blue" */
) 
```

或者您可以通过制作“颜色”表来对其进行更多规范化：

```
CREATE TABLE Color (
  color_id INT NOT NULL PRIMARY KEY,
  color_name VARCHAR(30) NOT NULL
)

CREATE TABLE Hat (
  hat_id INT NOT NULL PRIMARY KEY,
  brand VARCHAR(255) NOT NULL,
  size INT NOT NULL,
  color_id INT NOT NULL REFERENCES Color(color_id)
) 
```

后者的最终结果是您增加了一些复杂性 - 而不是：

```
SELECT * FROM Hat 
```

你现在不得不说：

```
SELECT * FROM Hat H INNER JOIN Color C ON H.color_id = C.color_id 
```

额外的加入是一笔大买卖吗？不——事实上，这是关系设计模型的基础——规范化可以防止数据中可能出现的不一致。但是像这样的每一种情况都会增加*一点*复杂性，除非有充分的理由，否则值得问问你为什么要这样做。我认为可能的“充分理由”包括：

*   **是否还有其他“挂断”该属性的属性？**例如，您是否正在捕获“颜色名称”和“十六进制值”，使得十六进制值始终取决于颜色名称？如果是这样，那么您肯定需要一个单独的颜色表，以防止出现一行有（“Red”、“#FF0000”）而另一行有（“Red”、“#FF3333”）的情况。多个相关属性是实体应该被规范化的#1 信号。
*   **这组可能的值会经常变化吗？**使用规范化查找表将使将来对集合元素的更改更容易，因为您只是更新单行。但是，如果这种情况不常见，请不要拒绝必须更新主表中大量行的语句；数据库在这方面做得很好。如果您不确定，请进行一些速度测试。
*   **这组可能的值是否会由用户直接管理？**即是否有一个屏幕可以添加/删除/重新排序列表中的元素？如果是这样，显然必须有一个单独的表。
*   **不同值的列表是否会为某些 UI 元素提供支持？**例如，“颜色”是 UI 中的下拉列表吗？那么你最好将它放在自己的表中，而不是每次需要显示下拉列表时都在表上执行 SELECT DISTINCT。

如果这些都不适用，我很难找到另一个（好的）理由来规范化。如果您只是想确保该值是某个（小）合法值集之一，则最好使用 CONSTRAINT 表示该值必须在特定列表中；让事情变得简单，如果需要，您可以随时“升级”到单独的表。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T22:00:38.580

没有人考虑过的一件事是，如果查找表中的数据可以随时间变化并且加入的记录是历史记录，则您不会加入查找表。示例是零件表和订单表。供应商可能会丢弃零件或更改零件编号，但订单表应始终准确包含订购时订购的内容。因此，它应该查找数据以进行记录插入，但绝不应该加入查找表以获取有关现有订单的信息。相反，零件编号、描述和价格等应存储在订单表中。这一点尤其重要，这样价格变化就不会通过历史数据传播，并使您的财务记录不准确。在这种情况下，您还希望避免使用任何类型的级联更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-20T20:42:10.797

rauhr.myopenid.com[写道](https://stackoverflow.com/questions/383026/decision-between-storing-lookup-table-ids-or-pure-data#383580)：

> 我们决定解决这个问题的方法是使用第四范式。...

这不是第四范式。这是一个常见的错误，称为 One True Lookup： [http ://www.dbazine.com/ofinterest/oi-articles/celko22](http://www.dbazine.com/ofinterest/oi-articles/celko22)

第四范式是： [http ://en.wikipedia.org/wiki/Fourth_normal_form](http://en.wikipedia.org/wiki/Fourth_normal_form)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T06:45:33.933

规范化被普遍认为是数据库最佳实践的一部分，规范化说是的，你将数据推出并通过键引用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-20T08:13:11.120

由于没有其他人解决您的第二点：当查询由于所有这些连接而变得冗长且难以读写时，视图通常会解决该问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-20T08:28:39.297

您甚至可以制定一条规则，始终针对视图进行编程，让视图获取查找。

这使得优化视图和使您的代码能够抵抗表中的更改成为可能。

在 oracle 中，如果需要，您甚至可以将视图转换为物化视图。

# gwt - GWT 延迟加载

> ID：383032
> 
> 赞同：1
> 
> 时间：2008-12-20T06:44:58.757
> 
> 标签：gwt, gwt-ext

GWT 有 LazyPanel 吗？我看不到它。请告诉我。如果它有lazyPanel，请让我知道版本

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T11:42:28.873

我同意[rustyshelf](https://stackoverflow.com/questions/383032/gwt-lazy-loading#383188)关于谷歌搜索的原理，但是由于 StackOverflow 本身也是一个参考，这里给出一个更详细的答案：

> 默认情况下，不显示 LazyPanel。只有在 LazyPanel 上调用 setVisible(true) 时才会创建底层小部件。
> 
> 当子面板包含相对较重的重量内容时，此类主要应与 StackPanel、DisclosurePanel 和 TabPanel 结合使用。
> 使用[LazyPanel](http://code.google.com/p/google-web-toolkit-incubator/wiki/LazyPanel)包装这些内容的创建可以显着改善用户体验。

* * *

> [使用 LazyPanel 很简单](http://googlewebtoolkit.blogspot.com/2008/11/improving-performance-with-on-demand.html)。您需要做的就是将要延迟加载的小部件添加到延迟面板中，然后在延迟面板上调用 setVisible(true) 以实际按需加载小部件。值得一提的是，LazyPanel 主要用于与 TabPanel 和 StackPanel 等小部件一起使用，并非在所有情况下都理想。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T02:05:04.307

这是来自“候选版本”GWT 1.6.2 的 LazyPanel.java 所以是的，很简单，并且确认了上面的答案。

```
/*
 * Copyright 2008 Google Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */

package com.google.gwt.user.client.ui;

/**
 * Convenience class to help lazy loading. The bulk of a LazyPanel is not
 * instantiated until {@link #setVisible}(true) or {@link #ensureWidget} is
 * called.
 * <p>
 * <h3>Example</h3> {@example com.google.gwt.examples.LazyPanelExample}
 */
public abstract class LazyPanel extends SimplePanel {

  public LazyPanel() {
  }

  /**
   * Create the widget contained within the {@link LazyPanel}.
   * 
   * @return the lazy widget
   */
  protected abstract Widget createWidget();

  /**
   * Ensures that the widget has been created by calling {@link #createWidget}
   * if {@link #getWidget} returns <code>null</code>. Typically it is not
   * necessary to call this directly, as it is called as a side effect of a
   * <code>setVisible(true)</code> call.
   */
  public void ensureWidget() {
    Widget widget = getWidget();
    if (widget == null) {
      widget = createWidget();
      setWidget(widget);
    }
  }

  @Override
  /*
   * Sets whether this object is visible. If <code>visible</code> is
   * <code>true</code>, creates the sole child widget if necessary by calling
   * {@link #ensureWidget}.
   * 
   * @param visible <code>true</code> to show the object, <code>false</code> to
   * hide it
   */
  public void setVisible(boolean visible) {
    if (visible) {
      ensureWidget();
    }
    super.setVisible(visible);
  }
} 
```

# javascript - “将脚本放在底部”是否正确？

> ID：383045
> 
> 赞同：46
> 
> 时间：2008-12-20T07:05:45.873
> 
> 标签：javascript, performance, yslow

在提高网站性能的最佳实践[http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)中，Steve Souders 提到了一条规则“将脚本移至底部”。这有点令人困惑。实际上，我注意到很多网页没有将脚本放在底部，而[YSlow](http://developer.yahoo.com/yslow/)仍然为这些页面标记 A。

那么，我什么时候应该遵循“将脚本放在底部”的规则？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-20T07:46:56.913

当用户从您的站点请求页面时，页面 HTML 开始流式传输到浏览器。一旦浏览器遇到外部图像、脚本、CSS 文件等的标签，它就会同时开始下载该文件。

如果您将脚本放在页面底部，它们将最后加载。也就是说，你的页面/app的HTML content/structure/css/images会先被加载，一些东西可以更快的出现在浏览器中；您的用户无需等待脚本完成下载，即可在您的应用程序中看到某些内容。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-20T07:43:02.087

页面顶部有脚本的页面仍然获得“A”的原因是因为这不如其他可以进行的性能改进重要。

每条规则都是加权的，因此某些规则对 ySlow 成绩的影响比其他规则更大。

我总是把脚本放在底部。在页面顶部需要脚本的原因很少。我能想到的唯一原因是您需要在页面中的任何其他内容之前*立即*执行您的 JavaScript ，这非常罕见。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-20T07:10:43.570

有时，您别无选择，只能将脚本放在页面中的特定位置。但是，如果您将脚本放在页面底部，浏览器不会中断其渲染以加载 JS 引擎来处理您的脚本（如果您有大量循环运行，这可能会很昂贵）并且可能会显示尽早查看页面。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-20T07:29:52.520

代码可能会引用尚未实例化的 DOM 对象，这是我能想到的最明显的原因。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-20T07:12:09.153

我不确定这是性能问题（可能是），但我参加了 Microsoft 的演示，演示者说网络蜘蛛有时只会读取网页上的前 x 个字符来索引它。因此，如果您有大量脚本，您的内容可能无法被正确访问和索引（并且您网站的页面排名不会那么高）。

# c# - Winforms：删除Visual Studio for Windows Forms创建的自动创建的Dispose（）方法中的代码是否安全

> ID：383047
> 
> 赞同：4
> 
> 时间：2008-12-20T07:08:37.990
> 
> 标签：c#, winforms, dispose

# 背景

在 Visual Studio 2008 中创建一个新的 Windows 窗体应用程序，这将创建一个带有名为“Form1”的类的骨架项目。VS2008 会自动创建一个 Dispose() 方法。

```
 /// <summary>
    /// Clean up any resources being used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
    protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        base.Dispose(disposing);
    } 
```

我走进一个同事的办公室（一位高级开发人员） - 很棒的人，聪明，良好的聊天设计技巧 - 但我注意到他在输入什么 - 当他浏览代码库时，他删除了 VS2008 创建的 Dispose() 方法的这一部分对于表格。

```
 if (disposing && (components != null))
        {
            components.Dispose();
        } 
```

所以，我问他为什么，他说没有必要保留它。

# 问题

*   删除此代码是否安全？
*   将其留在或删除它的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-20T07:14:30.863

不，删除此代码是不安全的。几个组件依赖于这种模式才能生效，以便正确释放它们持有的非托管资源。如果您删除此代码，您的应用程序可能会在 95% 的时间内正常工作。不过，这 5% 的情况将显示为资源泄漏、潜在的内存泄漏、非确定性错误……一般来说，很难追踪问题。

处理一次性资源的最佳方法是在您不再使用它的那一刻进行处理。遵循这种做法将为您省去很多麻烦。删除此代码采用完全相反的方法。

这篇关于 SO 的帖子包含更详细的解释：[我什么时候应该在 .NET 中处理我的对象？](https://stackoverflow.com/questions/245856/when-should-i-dispose-my-objects-in-net)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T08:19:32.950

**如果您在表单上使用过 System.Windows.Forms.Timer 之类的东西，**绝对不要删除它。**而且总是有这样的机会。**

 **正是这段代码将在表单关闭时释放计时器，如果您不释放计时器，它将继续运行。我已经接管了一些引入了此类错误的代码（在 .NET 2.0 之前，这种机制并不能很好地工作），并且由于计时器在它们应该更新的表单关闭后长时间运行而导致的间歇性性能问题可能是一个真正的痛苦。

删除它并没有实际的好处——如果没有控件将自己添加到组件列表中，那么 components.Dispose() 将很容易运行。如果控件*已将*自己添加到列表中，那是因为它们应该被处置。

# sql - 如何更改 SQL 插入语句的目标表？

> ID：383054
> 
> 赞同：2
> 
> 时间：2008-12-20T07:16:27.490
> 
> 标签：sql, mysql

您将如何编写一个 sql 语句，该语句允许您插入从表单获得的数据，但将根据表单上选择的内容将其输入到一个表或另一个表中？我知道如何将表单中的数据插入到指定的表中，但我需要能够使用表单来选择将数据输入到哪个表中。这是我的表格的副本...

```
print("<form action="<?=$PHP_SELF?>" enctype="multipart/form-data" method="post">
  <fieldset>
  <legend>Upload Your Motions and Orders Here</legend>
  <table width="80%" border="0">
    <tr>
      <td class="label"> <label for="label">Select Your File:</label>    
    </p></td>
      <td class="input"><input type="hidden" name="MAX_FILE_SIZE" value="30000" />
      <input type="file" name="thefile" value="<? echo $thefile; ?>" accesskey="s" tabindex="10"></td>
    </tr>
    <tr>
      <td class="label"><span class="input">
        <label for="label">Type of File:</label>
      </span></td>
      <td class="input"><select name="field" id="field" value="<? echo $field; ?>" accesskey="t" tabindex="20">
        <option value="Motions">Motions</option>
        <option value="Orders">Orders</option>
        </select>      </td>
    </tr>
    <tr>
      <td class="label"><label for="label">Name of File:</label> </td>
      <td class="input"><label for="type"></label>
      <input type="text" name="name" id="name" value="<? echo $name; ?>" accesskey="n" tabindex="30"></td>
    </tr>
    <tr>
      <td class="label"><label for="label">Date Filed In Court:</label> </td>
      <td class="input"><label for="date"></label>
      <input type="text" name="date" id="date" value="<? echo $date; ?>" accesskey="f" tabindex="40"></td>
    </tr>
    <tr>
      <td class="label"><span class="input">
        <label for="label">Description:</label>
      </span></td>
      <td class="input"><textarea name="description" id="description" cols="30" rows="5" value="<? echo $description; ?>" accesskey="d" tabindex="50"></textarea></td>
    </tr>
    <tr>
      <td class="label">&nbsp;</td>
      <td class="input"><input type="submit" name="submit" value="Upload This File" /></td>
    </tr>
  </table>
  </fieldset>
</form>");`
<form action="<?=$PHP_SELF?>" enctype="multipart/form-data" method="post">
  <fieldset>
  <legend>Upload Your Motions and Orders Here</legend>
  <table width="80%" border="0">
    <tr>
      <td class="label"> <label for="label">Select Your File:</label>    
    </p></td>
      <td class="input"><input type="hidden" name="MAX_FILE_SIZE" value="30000" />
      <input type="file" name="thefile" value="<? echo $thefile; ?>" accesskey="s" tabindex="10"></td>
    </tr>
    <tr>
      <td class="label"><span class="input">
        <label for="label">Type of File:</label>
      </span></td>
      <td class="input"><select name="field" id="field" value="<? echo $field; ?>" accesskey="t" tabindex="20">
        <option value="Motions">Motions</option>
        <option value="Orders">Orders</option>
        </select>      </td>
    </tr>
    <tr>
      <td class="label"><label for="label">Name of File:</label> </td>
      <td class="input"><label for="type"></label>
      <input type="text" name="name" id="name" value="<? echo $name; ?>" accesskey="n" tabindex="30"></td>
    </tr>
    <tr>
      <td class="label"><label for="label">Date Filed In Court:</label> </td>
      <td class="input"><label for="date"></label>
      <input type="text" name="date" id="date" value="<? echo $date; ?>" accesskey="f" tabindex="40"></td>
    </tr>
    <tr>
      <td class="label"><span class="input">
        <label for="label">Description:</label>
      </span></td>
      <td class="input"><textarea name="description" id="description" cols="30" rows="5" value="<? echo $description; ?>" accesskey="d" tabindex="50"></textarea></td>
    </tr>
    <tr>
      <td class="label">&nbsp;</td>
      <td class="input"><input type="submit" name="submit" value="Upload This File" /></td>
    </tr>
  </table>
  </fieldset>
</form> 
```

文件选择字段的类型将决定数据将插入的表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T08:01:06.857

我会远离运行动态 sql。由于您有一个已知类型列表，您可以根据文件类型将选择表的逻辑放在应用层的案例语句中。另一种选择是使用 case 语句或一组 if 语句创建存储过程。这样您就不会为插入构造动态 sql。

# sql - SQL 数据传输

> ID：383057
> 
> 赞同：3
> 
> 时间：2008-12-20T07:25:27.457
> 
> 标签：sql, sql-server, data-migration

我需要将数据从一个表传输到另一台已被截断的服务器中的同一个表。最简单的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T08:20:14.400

设置[链接服务器](http://msdn.microsoft.com/en-us/library/aa213778(SQL.80).aspx)，然后在目标数据库上使用以下内容：

```
INSERT INTO existingTable (col1,col2..)

SELECT col1,col2...
FROM linkedserver.dbo.database.othertable 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T17:06:16.567

将一台服务器上的表备份到一个文件中，然后将该文件恢复到另一台服务器上的空表中......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T07:30:38.820

使用 SQL Server 导入和导出向导。这可能是完成此任务的最简单方法。

对于更高级的数据传输，请考虑使用`bcp`实用程序、`BULK INSERT`语句和`OPENDATASOURCE`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T07:32:26.740

我会使用数据转换服务（又名集成服务）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-08T04:43:29.943

这是我喜欢使用的脚本。易于使用，并且几乎没有错误。只需将下面的文本复制到您的查询窗口中，然后按照说明进行操作。运行它之后，您将拥有一堆可以在另一台服务器上运行的插入语句。

* * *

```
/*
Use this script to create insert statements for each row in the specified table.

Instructions:
1\. Set the database you want to script from as normal.

2\. change the set @TableName = '<YourTableName>' line to be the
table you want to script out.

3\. Run the script and copy all the text from the results below
the line with all the dashes (----).

Notes:
   If you get the error message "Invalid object name '<YourTableName>'."
   then you either forgot to set the correct database or you spelled
   your table name wrong

Credits:
  Bob Wiechman - Fix for smalldatetime support
  Richard Lesh - correct support of uniqueidentifiers, automatic
        setting of Identity off/on, add Where clause support, more detail in
      debug mode.
*/

declare @TableName sysname
declare @WhereClause  varchar(1024)
declare @IdentityInsert int
declare @ColName sysname
declare @ColType tinyint
declare @ColStatus tinyint
declare @DebugMode bit
declare @ColList nvarchar(4000)
declare @ValList nvarchar(4000)
declare @SQL1 nvarchar(1000)
declare @SQL2 nchar(10)
declare @SQL3 nchar(1000)

set @TableName = '<YourTableName>' --  '<YourTableName>'
set @WhereClause = ''               -- limit scope of inserts
set @DebugMode = 0                  -- set to 1 if you only want a script

set @IdentityInsert = 0                -- set to 1 if you want to force IDENTITY_INSERT statements

set @ColList = ''
set @ValList = ''
set @SQL1 = 'select replace(''insert into ' + @TableName + ' ('
set @SQL2 = ') values ('
set @SQL3 = ')'', ''''''null'''''', ''null'') from ' + @TableName

if @DebugMode = 1 print '-- StmtShell: ' + @sql1 + @sql2 + @sql3

declare csrColumns cursor local fast_forward for
  select c.name, c.xtype, c.status
  from syscolumns c
    inner join sysobjects o
      on o.id = c.id
  where o.name = @TableName
    and o.xtype in ('U', 'S')
  order by ColID

open csrColumns
fetch next from csrColumns into @ColName, @ColType, @ColStatus

while @@fetch_status = 0
begin
  set @ColList = @ColList + ' ' + @ColName
  if @ColType in (173, 104, 106, 62, 56, 60, 108, 59, 52, 122, 48, 165)    -- numeric types (nulls not supported yet)
    set @ValList = @ValList + ' ''+convert(varchar(200),' + @ColName + ')+'''
  else if @ColType in (175, 239, 231, 231, 167)                            -- uid and string types
    set @ValList = @ValList + ' ''''''+isnull(' + @ColName + ',''null'')+'''''''
  else if @ColType in (58, 61)                                             -- dates (nulls not supported yet)
    set @ValList = @ValList + ' ''''''+convert(varchar(200),' + @ColName + ')+'''''''
  else if @ColType = 36                                                    -- uniqueidentfiers (nulls not supported yet)
    set @ValList = @ValList + ' ''''{''+convert(varchar(200),' + @ColName + ')+''}'''''
  if @DebugMode = 1             begin print '-- @ValList: ' + rtrim(@ValList) end
  if (@ColStatus & 0x80) = 0x80 begin set @IdentityInsert = 1 end          -- Check if column has Identity attribute
  fetch next from csrColumns into @ColName, @ColType, @ColStatus
end

close csrColumns
deallocate csrColumns

set @ColList = replace(ltrim(@ColList), ' ', ', ')
set @ValList = replace(ltrim(@ValList), ' ', ', ')

if @IdentityInsert = 1
  print 'set identity_insert ' + @TableName + ' on'

if @DebugMode = 1
  print @SQL1 + @ColList + @SQL2 + @ValList + @SQL3 + ' ' + @WhereClause
else
  exec (@SQL1 + @ColList + @SQL2 + @ValList + @SQL3 + ' ' + @WhereClause)

if @IdentityInsert = 1
  print 'set identity_insert ' + @TableName + ' off' 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-02T09:42:08.620

取决于数据传输的数量和频率。这是一个小批量的一次性过程，您最好使用 T-SQL 直接插入数据。这可以通过链接服务器或 OPENQUERY 子句来完成。

如果它的一次性处理量很大，请使用 SSIS 或 BCP 实用程序。

如果它的高容量高频率，使用复制。

# ruby-on-rails - Rails Schema 创建问题

> ID：383058
> 
> 赞同：11
> 
> 时间：2008-12-20T07:26:15.803
> 
> 标签：ruby-on-rails, jruby, migration, activerecord-jdbc

我正在使用 Jruby 和 rails 2.2.2。我的问题是我的迁移未正确写入数据库模式。

这是我的迁移：

```
class CreateNotes < ActiveRecord::Migration
  def self.up
    create_table(:notes, :options => 'ENGINE=MyISAM') do |t|
      t.string :title
      t.text :body

      t.timestamps
    end

    execute "alter table notes ADD FULLTEXT(title, body)"

end 
```

这是它在 schema.rb 中产生的内容

```
create_table "notes", :force => true do |t|
  t.string   "title"
  t.text     "body"
  t.datetime "created_at"
  t.datetime "updated_at"
end

add_index "notes", ["title", "body"], :name => "title" 
```

我有两个问题：

*   如何`'ENGINE=MyISAM'`进入架构？
*   为什么我的执行语句变成了`add_index "notes", ["title", "body"], :name => "title"`？以及如何强制迁移将其保留为执行语句？

感谢 Christian Lescuyer 的回答。但是，当我尝试这个时，什么都没有改变。我取消了 config.active_record... 行的注释，但是我的架构没有改变。我已经在 jruby 和带有 rails 2.2.2 和 edge rails 的 ruby​​ 1.8.6 上尝试过这个，并且架构没有变化。谁能告诉我我做错了什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T18:40:25.160

我也希望看到一个新的 .sql 文件出现在“rake db:migrate”之后，一旦我设置

```
config.active_record.schema_format = :sql 
```

在 config/environment.rb 中。

然而，显然这不是它的工作方式。我必须明确地这样做才能得到一个 db/[development|test|production]_structure.sql 文件：

```
rake db:structure:dump 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-20T14:21:27.757

当我使用外键约束时，我使用 SQL 格式进行迁移。在*environment.rb 中*：

```
# Use SQL instead of Active Record's schema dumper when creating the test database.
# This is necessary if your schema can't be completely dumped by the schema dumper,
# like if you have constraints or database-specific column types
config.active_record.schema_format = :sql 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-08-04T19:05:11.660

只是 Rails 3 上的更新（目前是 beta 4）——Christian 的解决方案仍然是正确的，只有放置行的正确位置是 in `config/application.rb`，在类的范围内，`Application`该类的范围应该在你的 Rails 项目命名的模块中定义.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T10:12:46.090

克里斯蒂安是对的。

做

config.active_record.schema_format = :sql

在环境中.rb

但是您必须使用不同的模式转储格式和文件位置。尝试进行迁移并寻找“schema.sql”而不是 scehema.rb

所有这一切的原因是方案文件的点是数据库非特定（适用于所有类型的数据库）文件。因此，当您通过不支持的执行语句使用仅适用于 mysql 的功能时，它们不能被硬塞到 schema.rb

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-21T16:23:15.343

要使用 SQL 变体进行测试（而不是 schema.rb），您需要使用

> rake db:test:clone_structure

我们的模式使用 UUID (uuid gem) 和 Red Hill on Rails (RHoR) 不错的 FK 插件。不幸的是，FK 需要只能在迁移中使用 EXECUTES 添加的 PK。

众所周知，这些执行不会进入 schema.rb；但是，对于无法使用 schema.rb 的应用程序，很难找到 db:test:prepare 的 rake 替代方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-29T13:41:31.163

以下猴子补丁解决了模式转储器（Rails 3.2）的 FULLTEXT 索引问题和数据库引擎选项。你可以把它放在`config/initializers/`（例如`schema_dumper_monkeypatch.rb`）：

```
module ActiveRecord
  class SchemaDumper
    def table(table, stream)
      columns = @connection.columns(table)
      begin
        tbl = StringIO.new

        # first dump primary key column
        if @connection.respond_to?(:pk_and_sequence_for)
          pk, _ = @connection.pk_and_sequence_for(table)
        elsif @connection.respond_to?(:primary_key)
          pk = @connection.primary_key(table)
        end

        tbl.print "  create_table #{remove_prefix_and_suffix(table).inspect}"
        if columns.detect { |c| c.name == pk }
          if pk != 'id'
            tbl.print %Q(, :primary_key => "#{pk}")
          end
        else
          tbl.print ", :id => false"
        end
        tbl.print ", :force => true"

        # Add table engine
        res = @connection.execute "SHOW TABLE STATUS LIKE '#{table}'"
        engine = res.first[res.fields.index("Engine")] rescue nil
        tbl.print ", :options => 'ENGINE=#{engine}'" if engine
        res = nil # Free the result        

        tbl.puts " do |t|"

        # then dump all non-primary key columns
        column_specs = columns.map do |column|
          raise StandardError, "Unknown type '#{column.sql_type}' for column '#{column.name}'" if @types[column.type].nil?
          next if column.name == pk
          spec = {}
          spec[:name]      = column.name.inspect

          # AR has an optimization which handles zero-scale decimals as integers. This
          # code ensures that the dumper still dumps the column as a decimal.
          spec[:type]      = if column.type == :integer && [/^numeric/, /^decimal/].any? { |e| e.match(column.sql_type) }
                               'decimal'
                             else
                               column.type.to_s
                             end
          spec[:limit]     = column.limit.inspect if column.limit != @types[column.type][:limit] && spec[:type] != 'decimal'
          spec[:precision] = column.precision.inspect if column.precision
          spec[:scale]     = column.scale.inspect if column.scale
          spec[:null]      = 'false' unless column.null
          spec[:default]   = default_string(column.default) if column.has_default?
          (spec.keys - [:name, :type]).each{ |k| spec[k].insert(0, "#{k.inspect} => ")}
          spec
        end.compact

        # find all migration keys used in this table
        keys = [:name, :limit, :precision, :scale, :default, :null] & column_specs.map{ |k| k.keys }.flatten

        # figure out the lengths for each column based on above keys
        lengths = keys.map{ |key| column_specs.map{ |spec| spec[key] ? spec[key].length + 2 : 0 }.max }

        # the string we're going to sprintf our values against, with standardized column widths
        format_string = lengths.map{ |len| "%-#{len}s" }

        # find the max length for the 'type' column, which is special
        type_length = column_specs.map{ |column| column[:type].length }.max

        # add column type definition to our format string
        format_string.unshift "    t.%-#{type_length}s "

        format_string *= ''

        column_specs.each do |colspec|
          values = keys.zip(lengths).map{ |key, len| colspec.key?(key) ? colspec[key] + ", " : " " * len }
          values.unshift colspec[:type]
          tbl.print((format_string % values).gsub(/,\s*$/, ''))
          tbl.puts
        end

        tbl.puts "  end"
        tbl.puts

        indexes(table, tbl)

        tbl.rewind
        stream.print tbl.read
      rescue => e
        stream.puts "# Could not dump table #{table.inspect} because of following #{e.class}"
        stream.puts "#   #{e.message}"
        stream.puts
      end

      stream
    end    

    def indexes(table, stream)
      if (indexes = @connection.indexes(table)).any?
        add_index_statements = indexes.map do |index|

          if index.name =~ /fulltext/i
            "  execute \"CREATE FULLTEXT INDEX #{index.name} ON #{index.table} (#{index.columns.join(',')})\""
          elsif index.name =~ /spatial/i
            "  execute \"CREATE SPATIAL INDEX #{index.name} ON #{index.table} (#{index.columns.join(',')})\""
          else
            statement_parts = [
              ('add_index ' + remove_prefix_and_suffix(index.table).inspect),
              index.columns.inspect,
              (':name => ' + index.name.inspect),
            ]
            statement_parts << ':unique => true' if index.unique

            index_lengths = (index.lengths || []).compact
            statement_parts << (':length => ' + Hash[index.columns.zip(index.lengths)].inspect) unless index_lengths.empty?

            index_orders = (index.orders || {})
            statement_parts << (':order => ' + index.orders.inspect) unless index_orders.empty?

            '  ' + statement_parts.join(', ')
          end
        end

        stream.puts add_index_statements.sort.join("\n")
        stream.puts
      end
    end
  end
end 
```

# 64-bit - 通过 2008 64 位 SSMS 访问 SQL Server Express 2005 数据库

> ID：383068
> 
> 赞同：0
> 
> 时间：2008-12-20T07:38:47.103
> 
> 标签：64-bit, ssms, sql-server-2005-express

我有一台 64 位 Vista 笔记本电脑。最初，我尝试在我的计算机上安装 64 位版本的 SQL Server Express 2005，但无论我尝试什么，似乎只有 32 位版本的工作......所以这就是安装的。

32 位 SQL Server Express 2005 运行良好，但最近我安装了 64 位版本的 SQL Server Express 2008 - 具有所有工具和功能。在安装过程中，它正确识别了我的 2005 数据库，但它迫使我在安装 2008 版本之前卸载我的 2005 SSMS。

这很好，但问题是当我尝试通过 2008 SSMS 访问现有的 2005 数据库时，它给了我以下消息：

“无法访问数据库板（对象资源管理器）”

--其中“planboard”是我的 2005 数据库的名称。

有谁知道如何解决这个错误/问题？

——谢谢迈克 C。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-20T23:01:50.437

在做了一些谷歌研究后，我找到了答案。我 2005 实例的 sa 密码与 2008 实例不同。此外，虽然我可以使用 Windows 身份验证登录到 2005 实例，但我无法使用它访问 planboard 数据库。使用我的旧 2005 sa 密码专门登录后，我能够看到数据库。然后我发现 2005 实例没有我的 windows 用户名作为具有 planboard 数据库权限的登录名。

我不太清楚为什么它之前可以工作，然后在 2008 年安装后就没有工作了……但是在专门输入我的 Windows 用户名作为 SQL Server 登录到 2005 实例并授予它对 planboard 数据库的权限之后。 ..我现在也可以使用 Windows 身份验证登录来访问 2005 数据库。

我认为这是一个 32 位与 64 位的问题，但这只是一个安全问题。

# python - Django：如何使用我的模型类从 Django 外部与我的数据库进行交互？

> ID：383073
> 
> 赞同：14
> 
> 时间：2008-12-20T07:48:15.867
> 
> 标签：python, django, django-models

我想编写一个使用 Django 应用程序模型与我的数据库交互的脚本。但是，我希望能够从命令行或通过 cron 运行此脚本。我需要导入什么才能允许这样做？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-20T08:18:44.153

您需要设置 Django 环境变量。这些告诉 Python 你的项目在哪里，以及设置模块的名称是什么（设置模块中的项目名称是可选的）：

```
import os

os.environ['PYTHONPATH'] = '/path/to/myproject'
os.environ['DJANGO_SETTINGS_MODULE'] = 'myproject.settings' 
```

现在您应该能够访问模型：

```
from myproject.models import MyModel

all_my_models = MyModel.objects.all() 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-20T12:06:39.667

首选方法应该是添加[自定义命令](http://docs.djangoproject.com/en/dev/howto/custom-management-commands/)，然后像任何其他`django-admin`（不要与`django.contrib.admin`）命令一样运行它：

```
./manage.py mycustomcommand --customarg 
```

仅当自定义命令不可行时才应使用设置 DJANGO_SETTINGS_MODULE。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-20T08:39:53.360

根据您的具体需求，[django-command-extensions](http://code.google.com/p/django-command-extensions/wiki/CommandExtensions)可能会为您节省一些时间。要按原样运行任何脚本而不弄乱环境变量，只需键入：

```
./manage.py runscript path/to/my/script.py 
```

django-command-extensions 还具有用于将脚本自动化为 cron 作业的命令，这是您提到的您想做的事情。

如果您是一个更具体的人，您可以查看这篇[非常详细的帖子](http://www.b-list.org/weblog/2007/sep/22/standalone-django-scripts/)，其中概述了如何制作“独立”django 脚本以从 cron 作业等运行。

# php - 迭代多个 $_POST 数组

> ID：383099
> 
> 赞同：4
> 
> 时间：2008-12-20T08:33:26.353
> 
> 标签：php, arrays, input, multidimensional-array

我有以下代码：

```
<tr>
    <td width="60%">
        <dl>
            <dt>Full Name</dt>
            <dd>
                <input name="fullname[]" type="text" class="txt w90" id="fullname[]" value="<?php echo $value; ?>" />
            </dd>
        </dl>
    </td>
    <td width="30%">
        <dl>
            <dt>Job Title</dt>
            <dd>
                <input name="job_title[]" type="text" class="txt w90" id="job_title[]" value="<?php echo $value2; ?>" />
            </dd>
        </dl>
    </td>
</tr> 
```

假设我有几行上述代码。如何迭代并获取数组`$_POST['fullname']`和的值`$_POST['job_title']`？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-20T08:42:28.643

它只是一个数组：

```
foreach ($_POST['fullname'] as $name) {
    echo $name."\n";
} 
```

如果问题是您想并行迭代两个数组，只需使用其中一个来获取索引：

```
for ($i=0; $i < count($_POST['fullname']); $i++) {
    echo $_POST['fullname'][$i]."\n";
    echo $_POST['job_title'][$i]."\n";
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T09:26:43.390

我早些时候删除了这个，因为它非常接近 Vinko 的答案。

```
for ($i = 0, $t = count($_POST['fullname']); $i < $t; $i++) {
    $fullname = $_POST['fullname'][$i];
    $job_title = $_POST['job_title'][$i];
    echo "$fullname $job_title \n";
} 
```

原始索引不是从 0 - N-1 的数字

```
$range = array_keys($_POST['fullname']);
foreach ($range as $key) {
    $fullname = $_POST['fullname'][$key];
    $job_title = $_POST['job_title'][$key];
    echo "$fullname $job_title \n";
} 
```

这只是一般信息。使用 SPL DualIterator，您可以进行以下操作：

```
$dualIt = new DualIterator(new ArrayIterator($_POST['fullname']), new ArrayIterator($_POST['job_title']));

while($dualIt->valid()) {
    list($fullname, $job_title) = $dualIt->current();
    echo "$fullname $job_title \n";
    $dualIt->next();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T09:35:49.427

我认为您要解决的问题是从具有相同索引的 $_POST['fullname'][] 和 $_POST['jobtitle'][] 中获取一对值。

```
for ($i = 0, $rowcount = count($_POST['fullname']); $i < $rowcount; $i++)
{
    $name = $_POST['fullname'][$i]; // get name
    $job  = $_POST['jobtitle'][$i]; // get jobtitle
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T09:47:24.723

如果我理解正确，您有 2 个数组，您基本上希望并行迭代。

像下面这样的东西可能对你有用。而不是`$a1`,`$a2`你会使用`$_POST['fullname']`and `$_POST['jobtitle']`。

```
<?php
$a1=array('a','b','c','d','e','f');
$a2=array('1','2','3','4','5','6');

// reset array pointers    
reset($a1); reset($a2);
while (TRUE)
{
  // get current item
  $item1=current($a1);
  $item2=current($a2);
  // break if we have reached the end of both arrays
  if ($item1===FALSE and $item2===FALSE) break;  
  print $item1.' '. $item2.PHP_EOL;
  // move to the next items
  next($a1); next($a2);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T09:33:24.143

Vinko 和 OIS 的答案都非常好（我提高了 OIS'）。但是，如果您总是打印 5 个文本字段副本，您总是可以专门为每个字段命名：

```
<?php $i=0; while($i < 5) { ?><tr>
    ...
    <input name="fullname[<?php echo $i; ?>]" type="text" class="txt w90" id="fullname[<?php echo $i; ?>]" value="<?php echo $value; ?>" /> 
```

# objective-c - 如何在视图控制器之间传递变量？

> ID：383101
> 
> 赞同：4
> 
> 时间：2008-12-20T08:36:18.657
> 
> 标签：objective-c, cocoa-touch

我在使用 Xcode 时遇到了困难；出于某种原因，它只是不允许我将变量从一个视图控制器类传递给另一个。它应该可以工作，我基本上只是从我的其他课程中复制/粘贴（它适用于所有课程......除了这个）。我整晚都在做这件事，尝试了我能想到的一切，但它仍然存在。

这是我正在调用的视图控制器类：

## ResultadosViewController.h：

```
#import <UIKit/UIKit.h>
#import "Filme.h"
#import "Festival.h"
#import "Top10Discos.h"
#import "Peca.h"

@class DetalhesViewController;

@interface ResultadosViewController : UIViewController
{
    // Navegation
    DetalhesViewController *dvc;
    BOOL isViewPushed;

    // What i'd really like to pass lol
    NSArray *array_resultados;

}

@property (nonatomic, retain) NSArray *array_resultados;
@property (nonatomic, readwrite) BOOL isViewPushed;

@end* 
```

## ResultadosViewController.m：

```
#import "ResultadosViewController.h"
#import "DetalhesViewController.h"
#import "Filme.h"
#import "Peca.h"
#import "Top10Discos.h"
#import "Festival.h"

@implementation ResultadosViewController
@synthesize isViewPushed, array_resultados;

(...)

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    // Navigation logic -- create and push a new view controller

    if (indexPath.row == 2)
    {
        if(dvc != nil)
            [dvc dealloc];

        NSString *ffs = [[array_resultados objectAtIndex:indexPath.row] TituloFilme];

        dvc = [[DetalhesViewController alloc] initWithNibName:@"DetailedView" bundle:[NSBundle mainBundle]];

        **resultadosControllerCell.array_resultados  = [self array_resultados];** 
        *"Request for member 'array_resultados' in something not a structure or union"*

        //Push the view controller to the top of the stack.
        [self.navigationController pushViewController:dvc animated:YES];

    }
} 
```

这是我想将数组发送到的另一个类：

## DetalhesViewController.h：

```
#import <UIKit/UIKit.h>

#import "Filme.h"
#import "Festival.h"
#import "Top10Discos.h"
#import "Peca.h"

@interface DetalhesViewController : UIViewController
{
    // Navegacao
    NSArray *array_resultados;

}

@property (nonatomic, retain) NSArray *array_resultados;
@end 
```

我不确定你们中是否有人会看到这个类的 .m 文件；在这种情况下，请问。

提前致谢， 哈尔

PS：尝试使用其他变量（也包括其他类型），清理/重建，重新创建 xib 文件，你可以命名它......我没有技巧:(

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T19:18:57.440

首先，不要使用`->`——这是直接的实例变量访问。它可能有效，但是您在不知情的情况下更改了另一个对象的实例变量，这只是自找麻烦。

不，亚当·罗森菲尔德不是故意的`dvc->array_resultados`；他的意思是`resultadosControllerCell->array_resultados`，这是他所说的，也是他基于你所说的。

正确的解决方案是混合您的原始线路和您对亚当线路的修订：

```
dvc.array_resultados = [self array_resultados]; 
```

这通过您在`DetalhesViewController`类中声明的属性。

说到这一点，您应该将该属性声明为`copy`，而不是`retain`。否则，您会发现自己持有其他人的可变数组，然后他们将对其进行修改——更糟糕的 mojo。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T14:32:39.437

这并不能完全回答您的问题，但是您的内存管理有点不稳定。这一行：

```
[dvc dealloc]; 
```

应该是这样的：

```
[dvc release];
dvc = nil; 
```

在 Cocoa 中，您永远不应该`dealloc`直接调用 - 遵循`retain/release/autorelease`模式，事情会按照预期更好地工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T08:41:36.663

只是一个猜测，但您是否尝试使用箭头运算符`->`而不是点运算符`.`？

```
resultadosControllerCell->array_resultados  = [self array_resultados]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T16:17:22.360

好的，我已经有了；使用便宜的技巧来显示信息：

```
UIAlertView *myAlertView = [[UIAlertView alloc] initWithTitle:ffs message:@"this gets covered" delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"OK", nil];
    UILabel *myTextField = [[UILabel alloc] init];
    myTextField.text = @"FFS!";
    CGAffineTransform myTransform = CGAffineTransformMakeTranslation(0.0, 130.0);
    [myAlertView setTransform:myTransform];

    [myTextField setBackgroundColor:[UIColor whiteColor]];
    [myAlertView addSubview:myTextField];
    [myAlertView show];
    [myAlertView release]; 
```

真的很讨厌使用这个，但我已经迟到了一天。我应该在昨天之前交付它。

感谢您的帮助，如果您碰巧找到了解决方案，请告诉我。你永远不知道它是否会再次发生：/

干杯!

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-23T23:21:44.360

一种更有效的方法是将来自两个视图控制器的数据分离到一个模型中。您将有一个名为 ResultadoModel.h/m 的单独类 (NSObject)。这将是一个单例，因此两个类都可以访问同一个实例。

您可以通过执行以下操作来访问数组（在两个 vcs 中）：

```
[[[ResultadoModel sharedInstance] array_resultados] propertyOrMethod]; 
```

您可以搜索如何创建单例，它非常简单且非常强大。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-10T08:37:36.367

请按照这些简单的步骤，它应该工作。

在您的 SecondViewController 中：

1.  在第二个 View Controller 中创建一个初始化程序。前任：

    - `(id)initWithResultsArray: (NSArray *) resultsArray`;

2.  创建一个变量来保存数组。说`myResultsArray`。

3.  在`initWithResultsArray`方法内部，保存`resultsArray`to的值`myResultsArray`。

4.  初始化`SecondViewController`using`initWithResultsArray`而不是 just `init`。

5.  像往常一样展示您的控制器，您将能够使用`myResultsArray`.

希望这可以帮助。

莫妮卡ツ</p>

# c# - 如何在运行时更改图像的颜色

> ID：383103
> 
> 赞同：3
> 
> 时间：2008-12-20T08:40:08.587
> 
> 标签：c#, asp.net, image

我想知道有什么方法可以在运行时更改图像颜色。例如，假设我将 JPG 绑定到 ASP.Net 的图像控件。接下来我有一个下拉列表，它为我提供了各种颜色选项，如红色、绿色等。我现在想将图像的颜色更改为下拉列表中选择的颜色。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-20T13:17:15.360

这是一个加载 JPEG 的代码示例，将图像中的任何红色像素更改为蓝色，然后在图片框中显示位图：

```
Bitmap bmp = (Bitmap)Bitmap.FromFile("image.jpg");
for (int x = 0; x < bmp.Width; x++)
{
    for (int y = 0; y < bmp.Height; y++)
    {
        if (bmp.GetPixel(x, y) == Color.Red)
        {
            bmp.SetPixel(x, y, Color.Blue);
        }
    }
}
pictureBox1.Image = bmp; 
```

警告：GetPixel 和 SetPixel 非常慢。如果您的图像很大和/或性能存在问题，那么在 .NET 中读取和写入像素的方法要快得多，但工作量要多一些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-17T19:37:32.210

您也可以在 web (asp.net) 上尝试此操作，您可以忽略逻辑，但可以查看 getpixel 和 setpixel 在做什么

```
 public string FileUpload( HttpPostedFileBase file )
  {
     Bitmap bmp = new Bitmap(file.InputStream);
     string valid = "";

     for(int i = 0; i < bmp.Width; i++) {
        for(int j = 0; j < bmp.Height; j++) {
           if(bmp.GetPixel(i , j).B < 20) {
              if(bmp.GetPixel(i , j).B == bmp.GetPixel(i , j).G &&
                 bmp.GetPixel(i , j).B == bmp.GetPixel(i , j).R) {
                 valid = valid + bmp.GetPixel(i , j). + "<br/>";
                 bmp.SetPixel(i , j , Color.DarkGreen);
              }
           }
        }
     }

     SaveImage(bmp);

     return valid;
  }

  private void SaveImage( Bitmap newbmp )
  {
     string path = Path.Combine(Server.MapPath("~/Images") , "ScaledImage.jpeg");
     newbmp.Save(path , System.Drawing.Imaging.ImageFormat.Jpeg);
  } 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-10-19T18:59:05.090

在这个问题下，我也面临着麻烦。之后根据一些信息。我手动编写了代码。现在它运行良好。如果你想检查。你可以使用它。

在 C#.net 中运行时更改背景图像的代码

您可以简单地使用此代码。也就是说，==>

```
string str; 
OpenFileDialog od = new OpenFileDialog(); 
if (od.ShowDialog() == DialogResult.OK) 
{ 
    str = od.FileName;
    this.BackgroundImage=Image.FromFile(str); 
} 
```

# unit-testing - 断言消息：假设失败，或假设成功

> ID：383104
> 
> 赞同：10
> 
> 时间：2008-12-20T08:40:22.593
> 
> 标签：unit-testing, language-agnostic, testing

在使用任何语言进行测试时，每个人都如何**表达他们的断言信息**？

我看到三种明显的方式：

```
# assume failure
assert (4-2) == 2, "Subtracting 2 from 4 doesn't equal 2"

# describe success
assert (4-2) == 2, "Subtracting 2 from 4 should equal 2"

# be vauge with failure
assert (4-2) == 2, "Subtracting 2 from 4 is broken" 
```

这显然是一个简单的例子，但你明白了。标准做法是什么？你做什么工作？为什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-20T08:47:04.283

我不知道标准做法是什么，但我将您的前两种方法与获得的实际结果相结合。

```
“从 4 中减去 2 应该等于 2，但等于” + 值

```

这毫无疑问并简化了调试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T08:45:24.783

断言的重要一点是被测试的实际条件。在 C 语言中，您可以使用预处理器“字符串化”来输出正在测试的实际条件。我的代码只是输出

```
Assert Failed: (4-2)==2 : Line 123, File foo.c 
```

如果你幸运的话，你也可以得到一个堆栈转储......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T09:21:01.857

我不知道是否有任何“标准”，但在大多数情况下，我喜欢看到断言条件本身。C 会自动执行此操作。在 C# 中，我必须复制粘贴它，不幸的是，例如。

`Debug.Assert(4-2==2, "4-2==2");`

在某些情况下，查看比条件提供的更多信息会很有用。在这种情况下，我将断言消息视为错误消息并说明问题所在，例如。

`Debug.Assert(result != null, "No result returned for input '" + input + "'");`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-20T16:21:48.343

我将断言消息视为注释：如果我可以避免它，如果我可以从代码中明确意图，我会尽量不使用它们。

通常，当您要断言的多个属性以某种方式相关时，这是一个问题。将断言提取到一个名为以指示您感兴趣的方面/关系的方法中，可以更清楚地了解正在发生的事情，而无需维护评论/消息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T08:46:44.157

只要错误消息告诉您出了什么问题以及问题出在哪里，IMO 真的没关系。在正常操作下，永远不会看到断言消息。如果看到它，则说明代码中某处存在错误，您需要能够追踪并修复该错误。

该消息应提供尽可能多的有用信息——如果您正在检查两个值是否相等而它们不相等，您应该打印出这些值是什么。这消除了使用调试器检查值的需要。当然，这样做需要您的语言支持断言消息中的非静态信息。如果断言消息只能是固定的静态字符串，那么您不能在不跳过箍的情况下添加额外的运行时信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-20T09:15:56.643

Roddy 的建议是一个很好的建议——它肯定会降低添加新断言的“成本”（即不需要考虑或输入新的字符串消息）。信不信由你，但实施他的建议对我对断言的使用产生了重大影响。

但是，如果您仍在寻找更清晰的短信，您可能会考虑以下内容：

“预期 4-2 等于 2”

这似乎清楚地表明（至少对我而言）预期的答案是 2，但没有达到预期......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-20T12:39:23.173

我使用断言消息来**记录**断言正在测试什么，或者预期值是什么。

有时，当测试失败时，我不需要查看失败的测试：仅从断言消息和我刚刚所做的更改，我就知道如何修复它。

# jquery - jQuery - 如何在叠加层上放置 DIV？

> ID：383116
> 
> 赞同：16
> 
> 时间：2008-12-20T08:49:00.160
> 
> 标签：jquery, overlay

我试图在尽可能少的 jQuery 代码中创建一个模态对话框，因为我的项目已经加载了太多的 jQuery。

所以，我首先需要一个覆盖，这是通过以下方式实现的：

```
$('body').wrapInner('<div />')
.css('opacity','0.5')
.css('z-index','2')
.attr('id','dim1'); 
```

现在忽略我有另一个例程来杀死 #dim1 上的点击事件，而这个模式存在。所以，现在我需要在顶部绘制我的模态对话框：

```
$('body').append('<div id="test">My Test</div>');
$('#test')
.css('opacity','1.0')
.css('position','fixed')
.css('color','#000')
.css('z-index','2000')
.css('height','300px')
.css('width','300px')
.css('top','50%')
.css('left','50%'); 
```

但是，当我这样做时，我最终会得到一个变暗的#test，而我不希望它变暗——只是它背后的东西。有什么诀窍？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-20T09:53:46.283

在这里查看这个快速[演示](http://pastebin.me/494ce61eb12fa)，关键在于模态绝对在不透明背景的顶部。该演示动态地将背景覆盖 div 和模态 div 添加到正文中，但您可以在 html 中定义它们并显示它们。

同意不需要使用插件来获得模态效果，大多数插件都有很多选项，因此如果您只需要最简单的效果，您不想要的膨胀。- 请注意，我们可以在两行而不是 3 行中执行此操作 - 并且无需插件！

此外，定义 css 类并添加这些类比将内联样式添加到脚本中的元素要容易得多。更容易维护。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T09:41:03.643

我认为您最好的解决方案可能是使用 jquery 插件。一个快速的谷歌搜索抛出了这个：[http](http://www.ericmmartin.com/simplemodal/) ://www.ericmmartin.com/simplemodal/ 它正在做你需要的三行！

[如果你想要更多， jquery 覆盖插件页面](http://plugins.jquery.com/project/Plugins/category/43)上有负载

从外观上看，CSS 是正确处理事情的关键，并且这些示例中的大多数都应该带有演示 CSS 以供您适应。

显然，这会带来更多您关心的外部 jquery 代码 - 但我建议编写良好且稳定的插件将为您节省大量工作/时间/代码行！

# javascript - ASP.NET MVC 和 Mootools

> ID：383125
> 
> 赞同：1
> 
> 时间：2008-12-20T09:09:11.570
> 
> 标签：javascript, asp.net-mvc, mootools

你知道 MooTools 和 ASP.NET MVC 的例子吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T16:48:23.607

ASP.NET MVC 包括 JQuery，它似乎得到了微软的认可。然而，客户端Javascript框架和服务器端MVC架构确实没有太多重叠（到目前为止）。

在交付视图时使用 JQuery、MooTools 或任何其他此类框架实际上完全独立于 MVC 本身。您可能更感兴趣的是 MooTools 如何与 ASP.NET AJAX 集成，我猜它可能被视为 MVC 的一个组件。

这是[一篇](http://ifwdev.wordpress.com/2007/06/07/ajaxnet-professional-with-mootools-part-2/)关于 ASP.NET AJAX 和 MooTools 的博客。

请注意，尽管 MS 在 VS2008 中添加对 JQuery 的智能感知支持方面付出了相当多的努力。第三方很可能会在智能感知中投入同样的努力来支持 MooTools，但他们可能不会，如果您不太依赖 MooTools，那么值得考虑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-12T22:10:52.130

我有一个带有 Mootools 的 ASP.NET MVC[示例](http://weblogs.asp.net/thiagosantos/archive/2009/01/05/mootools-with-asp-net-mvc.aspx)。

# cocoa - 在 Core Data 中建模关联类的最佳方法是什么？

> ID：383129
> 
> 赞同：2
> 
> 时间：2008-12-20T09:17:15.907
> 
> 标签：cocoa, core-data

我在 Core Data 模型中有一个关系，感觉它需要一个关联类。具体来说，我有一个 Person 对象和一个 Location 对象。这两个类之间存在多对多的关系，具有一些属性，例如此人希望每周在该位置工作多少小时。

如何使用 Core Data 对此进行建模？两者之间的简单关联是图片的一部分，但是创建一个具有所需属性作为属性的新类，然后与其他每个类都有关系感觉不太正确 - 例如它允许关系不具有所需的属性。

我是否遗漏了什么，或者这是模拟这种关系的最佳方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T16:17:51.537

Core Data 可以建模一对多关系。如果两个实体应该具有多对多关系，您将创建一个从 Person 到 Location 的多对多关系，以及另一个从 Location 到 Person 的多对多关系。您可以将这些关系设置为彼此的倒数，以便 Core Data 可以保持对象图的一致性。

如果您想要一个关系是必需的，您可以为一对多关系设置一个最小计数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T21:19:43.303

根据您的问题，我不清楚您提出的模型无法处理哪些约束。您可以要求关联类的所有属性都为非 nil，并且关系（与具有一对多返回的 Person 的一对一关系）和与 Location 的一对一关系（同样具有一对多返回）非零。这要求创建的任何关联都具有 Person 和 Location 以及所需的关联属性。

# instant-message - 第 3 方 IM API 的合法性

> ID：383147
> 
> 赞同：0
> 
> 时间：2008-12-20T09:51:03.450
> 
> 标签：instant-message

编写实现MSN Messener、Yahoo!的即时消息软件是否合法？Messener 或 AIM 协议并通过广告收钱？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T09:56:52.347

MSN 使用条款的第 4 部分这样说（缩短）：

> 4 您如何不使用该服务。
> 
> 使用任何未经授权的第三方软件或服务来访问 Microsoft 即时消息网络（目前称为 .NET Messenger 服务）；

所以我会说有广告或没有广告，除了 Live Messenger 之外，您将不被允许连接到他们的网络，因为他们不发布 API，所以唯一授权的客户端是他们自己的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T10:33:08.407

Stackoverflow 不是一层；Stackoverflow 不是你的laywer；只有您的律师可以提供法律意见。不要向 Stackoverflow 寻求法律建议。

很多人都这样做；Pidgin、Adium、Meebo 等。询问您的律师在您居住的地方是否合法。仅仅因为 MSN 在网站上发布了一些内容说你不能这样做并不意味着它是非法的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-28T21:28:50.243

如果您违反 ToS，他们可以阻止/将您踢出网络。这可能是他们唯一会做的事情，因为这对他们来说既简单又有效。

由于您违反了 ToS，因此起诉 Microsoft 阻止您的服务毫无意义。这取决于您居住的国家/地区，他们是否可以向您索取任何东西。但只要你不是一家大公司，起诉你对他们来说是没有利润的。

# asp.net - 如何从数据表中分割得到的数据并将其中一些绑定到Datalist的Headertemplate

> ID：383157
> 
> 赞同：0
> 
> 时间：2008-12-20T09:57:40.973
> 
> 标签：asp.net, vb.net, datalist

可能题目比较复杂，我试着解释一下：

我从数据库中获取了一些数据，其中一些具有 TypeId=1，有些具有 TypeId=2。我想将 TypeId=1 的数据放入标头模板，将 TypeId=2 的数据放入 Datalist 控件中的 itemtemplate。

我该怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-20T16:58:21.623

您可以使用[DataView](http://msdn.microsoft.com/en-us/library/system.data.dataview.aspx)获取 DataTable 中的数据子集，然后将其绑定到 DataList 以获取项目内容，但您必须通过附加到[ItemDataBound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.itemdatabound(VS.80).aspx)事件并查找标头的 ListItemType。

# django - Web 开发的最佳 IDE 设置是什么？

> ID：383161
> 
> 赞同：18
> 
> 时间：2008-12-20T10:08:27.533
> 
> 标签：django, development-environment

我正在开始一个小项目，其中包括构建一个基于 django 的中小型网站。

不过，上一次我真正从事网站业务，还是几年前的事了。因此，虽然在技术上仍然有能力，但我仍然对网站的工具/IDE 部分感到生锈。

我正在寻找可以支持以下功能的 IDE：

*   带有语法完成、突出显示等的基本 HTML 编辑...
*   带有语法补全、突出显示等的基本 CSS 编辑...
*   对 Django 的 Python 支持
*   支持整个开发-调试-FTP上传周期

如果所有这些都可以发生在我现有的 eclipse 安装中，那将是完美的。

那么您对 ​​Web 开发 IDE 有什么建议？

**编辑：**忘了补充说我在我的开发机器上运行 Win XP。

* * *

**回答后编辑：**感谢大家的有用建议。我想我会选择**Aptana**，因为它适合我已经使用的 eclipse。我还将研究版本控制而不是简单的 FTP 上传。显然我不知道它在网络项目中的使用量。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-20T13:29:59.593

您可以使用带有 Eclipse [PyDev 插件的](http://www.aptana.com/python)[Aptana Studio](http://www.aptana.com/studio)来完成所有这些工作（以及更多）。最好的是它是跨平台的，因此您可以将它安装在您进行开发工作的任何计算机上，而不必学习多个 IDE。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-20T10:25:49.077

我不确定你在哪个平台上，但 Textmate 可以做到所有这些，Emacs 也可以。我听说 e-Text-Editor 在 Windows 上很好用（虽然从未使用过）。

我强烈建议您将“开发-调试-FTP”周期替换为“编写测试、开发、运行测试、提交版本控制”周期。然后，您可以将版本控制签出到生产服务器上，而不是通过 ftp 上传。我强烈建议不要将 ftp 与 Web 应用程序一起使用（例如您将使用 Django 创建的内容）。

与使用世界上最好的 Ide 相比，您将从测试和版本控制中获得更多好处。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T12:43:39.703

[Zeus IDE](http://www.zeusedit.com)具有**HTML**和**CSS**语法突出显示，还可以配置为进行无缝**FTP** / **SFTP**编辑。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-20T13:14:16.410

我们正在使用[Komodo Edit](http://www.activestate.com/Products/komodo_ide/komodo_edit.mhtml)。

您可以通过脚本定义大量复杂的命令。

我还没有写过 FTP 传输命令，但我已经通过在 Komodo 的项目中添加命令来完成其他所有工作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-20T18:23:15.600

我将 vim 用于 python 和 django。它是免费的，坚如磐石，有许多有用的插件和庞大的社区。对于 python/django 编码，您可以为 django 模板自动完成添加语法突出显示。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-07-23T14:44:37.153

最近 JetBrains 发布了一个新的 Django IDE：http: [//www.jetbrains.com/pycharm/](http://www.jetbrains.com/pycharm/)

*   集成版本控制系统（支持GIT）
*   我见过的最好的差异工具
*   调试器

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-20T10:38:05.323

[Coda](http://www.panic.com/coda/)也非常适合 Web 开发。确定它可以处理 Python，我不知道 Python 对 Django 的支持意味着什么，但使用 coda，您可以直接通过 FTP 工作并做其他好事情（还有 SVN 版本控制，并具有良好的集成 CSS 混合器）。

对于 Windows，当我开发 Web 应用程序（使用 PHP）时，我发现 PHPEd 非常有用，但我认为它不能处理 Python。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-20T10:44:58.990

对于 django，我使用 Eclipse+PyDev。这绝不是一个完整的代码完成解决方案，但它是一个很好的界面，它会让你走得很远。

现在对于 HTML，我使用另一个编辑器。Eclipse 确实有一个 Aptana 插件（这很好），但我觉得它有点笨拙。看看它，看看你看到了什么。肯定有足够的 HTML 编辑器供您找到适合您的流程的内容。请记住，没有理由必须在同一个编辑器中执行 python 和 html。一个都没有。

在推出你的代码方面，我恳请你看到你的方式的错误并转向某种版本控制系统。我使用[Bazaar](http://bazaar-vcs.org)，但那里有很多好处。他们需要一段时间才能习惯，但他们很好，非常值得最初的时间投资。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-20T15:29:45.950

Netbeans 不会做您需要的事情（它会做一些事情 - 即它有一些 HTML 和 css 知识），但它可能值得关注。有一些早期版本的 python 支持可用，我相信预计会添加 django 支持。

我不能保证质量（因为我既不使用 python 也不使用 django），但是对 netbeans 的 ruby​​ / ruby​​+rails 支持运行良好，它也支持其他语言，如 java 和 groovy。

与此同时，textmate / E 可能是你最好的选择。无论如何，许多人使用它而不是 IDE。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-29T13:34:08.887

IntelliJ IDEA 对 HTML、CSS 和 JavaScript 有最好的支持。它将 Web 开发人员提升到 Java 开发人员的水平。

无论如何，我不隶属于 IntelliJ，不幸的是，我现在工作的地方我们不使用它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-20T13:08:26.563

您可以在 HTML/CSS/视觉方面做得比 Dreamweaver 差。还可以尝试 Netbeans 的编程部分 - 似乎支持大多数语言。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-22T09:14:51.293

我已经开始了一个与此非常相似的问题，希望讨论对您有所帮助：

[https://stackoverflow.com/questions/365676/which-ide-is-for-me](https://stackoverflow.com/questions/365676/which-ide-is-for-me)

干杯，

# multithreading - 在vb6编程中使用线程

> ID：383162
> 
> 赞同：3
> 
> 时间：2008-12-20T10:15:37.113
> 
> 标签：multithreading, vb6

我正在编程以使用不同的随机函数生成十六进制密钥并将其写入文本文件中。我只有两个 cmd 按钮和显示当前时间和进程状态的状态栏。现在单击 cmd 按钮进行密钥生成，表单被锁定，所有其他活动都被暂停，即使时间暂停，直到过程结束。我什至不能在两者之间中止这个过程。如果可能的话，我想使用线程来解决这个问题。我该怎么做请建议。否则，如果有任何其他方法可以解决此问题，请提出建议。

感谢您期待宝贵的帮助

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-20T11:27:05.737

在 VB6 中进行多线程的唯一“合法”方法是通过 ActiveX EXE——只需使用项目属性对话框中的每个对象线程选项。Matt Curland 有一个很好的例子，如何将标准 EXE 转换为多线程 ActiveX EXE。这样做允许 VB6 调试器在没有崩溃的情况下工作，因为在 IDE 中，所有内容都在单个线程上执行。

如果您想减少 ActiveX EXE 多线程的开销，那么您必须使用不受支持但仍然可行的进程内多线程。检查[Compact In-Process Multi-threading: A FolderWatcher with sample UI](https://github.com/Planet-Source-Code/vlad-vissoultchev-compact-in-process-multi-threading-a-folderwatcher-with-sample-ui__1-36373)，以安全地使用 CreateThread 并在新线程上安全地初始化 VB6 运行时（再次由 Matt Curland 提供）。

您可能想查看他的[Advanced Visual Basic 6](http://powervb.mvps.org/) book 以了解更多详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T10:28:54.903

您可以使用 CreateThread Win32 API，但请记住 VB6 调试器无法处理多个线程。

此外，如果您有任何类型的循环，请尝试在循环中的某处拍打“DoEvents”。它会严重降低性能，但您的表单会响应。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T10:30:57.427

这可能是不可能的，但您可能需要考虑切换到 .NET，其中 VB 完全支持线程。

另一种厚颜无耻的方法（不是很好，但它有效）可能会使用一个 exe 来完成这项工作，并让您的 VB6 简单地轮询结果文件。这将是一个单独的进程，因此完全隔离了线程。真的很乱，不推荐。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-27T16:22:52.330

您还可以通过 CreateProcess 启动子进程并为 IPC 重定向 StdIO 流。匿名管道 I/O 几乎不是试图通过磁盘文件进行通信的黑客。

有一些免费的组件可以做到这一点。

[http://www.xtremevbtalk.com/showpost.php?p=1304628&postcount=4](http://www.xtremevbtalk.com/showpost.php?p=1304628&postcount=4)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T17:54:07.637

我相信 Matt Curland ActiveX exe 方法是经典的方法。或者，您可以使用[DoEvents](https://stackoverflow.com/questions/155517/cancelling-a-long-running-process-in-vb6-0-without-doevents)。[或者像这样](https://stackoverflow.com/questions/727386/making-a-c-kill-event-for-a-vb6-app/752841#752841)将工作委托给一个单独的 ActiveX exe 。你也可以使用[.NET BackgroundWorker 组件](http://msdn.microsoft.com/en-us/library/aa719109.aspx)，但事实证明这[不起作用](https://stackoverflow.com/questions/2785169/using-the-net-backgroundworker-from-vb6-fails-with-an-accessviolationexception)。

# .net - 如何在 .NET 中检索 MP3 的持续时间？

> ID：383164
> 
> 赞同：7
> 
> 时间：2008-12-20T10:25:14.130
> 
> 标签：.net, audio, mp3

我已经构建了一个 WPF 应用程序，用户可以在其中将 MP3 文件拖放到列表框上。我需要一种方法来计算播放列表的总持续时间。

我应该使用任何库吗？或者是否可以仅使用 .NET 框架？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-11-07T12:35:21.243

经过大量的理论研究，我找到了一种正确且无可争议地计算 mp3 文件持续时间的方法。

让我首先重申一下为什么上面的标准方法不起作用：

ID3 方法：并非所有文件都有 id3 标签，如果有，则可能没有在其中设置持续时间字段。

通过读取一帧 * 文件大小进行估计：不适用于 VBR 文件。

Xing 标头：并非所有文件都有它。

通过 PCM 大小解码和确定它：我有 3+ GB 的文件，我不会等到它解码。

我到处阅读，所有事情都导致了 NAudio。马克，感谢您的努力和干净的来源！然而，NAudio 最常用的一种方法是使用 Mp3FileReader 读取文件并获取所有帧。问题：Mp3FileReader 在开始时创建一个 TOC，这需要很长时间，即使对于只有一天的小文件也是如此 :)

Mark 建议我删除 TOC 创建，因为源可用，并且在执行此操作时，我发现了更简单的方法。这里是; 不言自明：

```
 double GetMediaDuration(string MediaFilename)
    {
        double duration = 0.0;
        using (FileStream fs = File.OpenRead(MediaFilename))
        {
            Mp3Frame frame = Mp3Frame.LoadFromStream(fs);
            if (frame != null)
            {
                _sampleFrequency = (uint)frame.SampleRate;
            }
            while (frame != null)
            {
                if (frame.ChannelMode == ChannelMode.Mono)
                {
                    duration += (double)frame.SampleCount * 2.0 / (double)frame.SampleRate;
                }
                else
                {
                    duration += (double)frame.SampleCount * 4.0 / (double)frame.SampleRate;
                }
                frame = Mp3Frame.LoadFromStream(fs);
            }
        }
        return duration;
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-08-24T19:45:50.130

我包装了 mp3 解码器库，并将其提供给 .net 开发人员。你可以在这里找到它：

[http://sourceforge.net/projects/mpg123net/](http://sourceforge.net/projects/mpg123net/)

包括将 mp3 文件转换为 PCM 和读取 ID3 标签的示例。

我猜它可以用来正确计算 mp3 文件的持续时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T12:59:22.073

几年前，我最终为此编写了自己的文章。您可以使用闪存编写一个有效的客户端。我记得的关键点是：

1.  你不能依靠 MP3 标题来准确，所以不要只阅读它来获得持续时间
2.  在 flash 中，寻找到 MP3 的末尾，然后读取当前位置。这会给你持续时间。

编辑：我意识到你想用 .Net 来做这件事，但在你将文件上传到服务器之前了解客户端实际上可能更有用，就像你想对文件长度施加限制一样，你可以更早地做到这一点进行中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T23:35:49.743

[我自己的解决方案]

我添加了第二个 mediaelement 控件，用于打开列表框中的每个 mp3 文件并获取它的 NaturalDuration。打开和关闭列表中的每个文件并对所有值求和。

正如其他人所说，mp3 标题不准确。mediaelement 提供正确的持续时间。

这可能不是最快的方法，但在我的情况下是最简单的（它不依赖于其他库）。

# asp.net-mvc - 为什么要使用内联编码来开发 MVC ASP.NET？

> ID：383166
> 
> 赞同：1
> 
> 时间：2008-12-20T10:26:59.620
> 
> 标签：asp.net-mvc

我回顾了一些关于 MVC ASP.NET 的例子，它们都使用了内联编码方法。

使用这种方法并忽略我喜欢的方法背后的代码有很大的理由吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-20T12:44:47.000

德里克·惠特克（Derek Whittacker）的一句[好话](http://devlicio.us/blogs/derik_whittaker/archive/2008/12/12/psa-using-the-code-behind-in-mvc-causes-blindness.aspx)。不能，但我自己会更好

也可以参考这个[相同的 Q](https://stackoverflow.com/questions/381895/mvc-reminds-me-of-old-classic-asp-spaghetti-code) on SO

> “在标准的 Asp.net WebForms 开发中，CodeBehind 旨在充当页面控制器，但多年来它已经变成了各种邪恶代码（即业务逻辑）的垃圾场。正是这种令人讨厌、丑陋的代码这给了（部分）WebForms 一个糟糕的形象。通过继续在 MVC 中使用你的代码，你真正做的就是采用一种旧的讨厌的技术并将其应用到新的框架中，从而消除 MVC 的一个巨大优势。
> 
> MVC 模式的部分优点（注意我说的是模式，而不是框架），它有助于通过将逻辑从视图中推到控制器中来强制执行关注点分离。”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T10:54:56.597

我认为主要原因是那里真的不应该有太多逻辑，因为它只是与视图相关的逻辑。当没有太多逻辑时，我的观点是使用内联方法读起来更好。但是，如果有很多循环的视图，那么在我看来，使用后面的代码肯定是一个可行的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T10:56:14.193

在[Scott Gu](http://weblogs.asp.net/Scottgu/)最近关于 MVC Release Candidate的[博客](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx)中，他们的视图默认情况下没有代码，这可能是您在示例中看不到的原因。

# c# - 如何编写一个桌面应用程序来读取/写入数据到连接到 PC 的 symbian 手机

> ID：383171
> 
> 赞同：2
> 
> 时间：2008-12-20T10:33:10.090
> 
> 标签：c#, .net, mono, symbian, communication

我想创建一个桌面应用程序（最好在 c# 中，在 .net 或单声道上运行），它可以从/向我连接的（usb/蓝牙）读取/写入信息（电话簿、日历、电话、短信等） symbian 手机（SE p990i），但我似乎无法为它找到正确的关键字来谷歌，因此无法开始。

我考虑查看一些现有的 OSS 应用程序的源代码，但找不到任何源代码。MyPhoneExplorer 是免费软件，但不提供源代码。无论如何，它都需要安装 Sony-Ericsson 通信程序，因此假设它的代码在 linux 上没有用。

所以，请建议要搜索的关键字！

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T13:07:10.450

我在 Symbian 上工作已经有几年了，还没有做过很多 C#，所以我不能直接回答，但我总是发现 Eric Bustarret 的网站[http://www.newlc.com/](http://www.newlc.com/)对我所有的人都非常有帮助塞班问题。

# javascript - 函数的正确原型链

> ID：383172
> 
> 赞同：7
> 
> 时间：2008-12-20T10:33:40.090
> 
> 标签：javascript, constructor, prototype

以下程序的正确输出是什么（根据 ECMA 标准是正确的）？

```
function nl(x) { document.write(x + "<br>"); }
nl(Function.prototype);
nl(Function.prototype.prototype);
nl(Function.prototype.prototype == Object.prototype);
nl(Function.prototype.prototype.prototype); 
```

Chrome 和 IE6 一致表示：

```
function Empty() {}
null for Chrome / undefined for IE6
false 
```

然后崩溃。

Mozilla 输出：

```
function () { }
[object Object]
false
undefined 
```

这些都是正确的吗？似乎 Mozilla 做得更好，但最好的输出是

```
function () { }
[object Object]
true
undefined 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-20T13:01:00.073

**函数原型**

来自[ECMAScript 语言规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)：

> **15.3.3.1 函数原型**
> 
> Function.prototype 的初始值是 Function 原型对象（第 15.3.4 节）。
> 
> **15.3.4 函数原型对象的属性**
> 
> Function 原型对象本身就是一个 Function 对象（它的 [[Class]] 是“Function”），当被调用时，它接受任何参数并返回 undefined。Function 原型对象的内部 [[Prototype]] 属性的值是 Object 原型对象（第 15.3.2.1 节）。
> 
> 它是一个“空体”的函数；如果调用它，它只会返回 undefined。Function 原型对象没有自己的 valueOf 属性；但是，它从 Object 原型 Object 继承 valueOf 属性。

我得到这个输出：

*   **Opera:** function () { [本机代码] }
*   **铬：**函数空（）{}
*   **IE7：**函数原型（）{[本机代码]}
*   **FF3：**函数（）{}

Chrome 和 IE7 已经命名了它们的功能，Opera 和 IE7 告诉你它不会透露实现。他们都同意这一点：

```
nl(typeof Function.prototype); //function 
```

将此与以下内容进行比较：

```
nl(typeof Object.prototype); //object
nl(typeof Array.prototype); //object
nl(typeof String.prototype); // object 
```

**Function.prototype.prototype**

我从 Opera 和 IE7获得**undefined** ，从 Chrome获得**null** ，从 FF3获得**[object Object] 。**谁是对的？既然*“函数原型对象本身就是一个函数对象”*，它不应该是对自身的循环引用吗？为了避免循环引用，他们选择了不同的方式。我不知道是否有标准或者是否取决于实现，但我认为 Object 是正确的。顺便说一句，在这里您可以看到内部 [[prototype]] 和公共原型之间的区别，就像您在之前的问题中所问的那样！

**Function.prototype.prototype == Object.prototype**

这是错误的，因为它不是同一个对象。往上看。

**Function.prototype.prototype.prototype**

只有 FF 会给你一个答案，因为他们的 Function.prototype.prototype 实现返回一个对象。

我同意您提出的输出看起来更合乎逻辑。

他们确实同意这一点：

```
nl(Object.prototype); // [object Object]
nl(Object.prototype.prototype); // undefined 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-20T14:31:10.390

您在这里所做的并不是真正走原型链 -[这个问题](https://stackoverflow.com/questions/383201/relation-between-prototype-and-prototype-in-javascript)可能会帮助您了解实际发生的情况。我没有费心检查 ECMA 规范，但这是我对这个问题的看法：

*   **函数**是函数对象的构造函数

*   **Function.prototype**是所有函数对象继承的原型——它可能包含所有*Function*实例共有的属性，如*call*和*apply ；*您检查的实现是一致的，因为它本身是作为函数对象实现的（正如**一些人**指出的那样，ECMA 规范要求这样做）

****   **Function.prototype.prototype**并没有多大意义，但由于**Function.prototype**是作为函数对象实现的（可能用作构造函数），它至少应该存在；使用**Function.prototype**作为构造函数创建的对象将继承其属性 - 但由于不应该做这样疯狂的事情，将其设置为*null*、*undefined*或空对象是合理的

    *   **Function.prototype.prototype.prototype**很可能是*undefined*：正如我们之前所见，**Function.prototype.prototype**应该是没有属性的东西（*null*，*undefined*或空对象），并且绝对不是函数对象；因此，它的*原型*属性应该是*未定义*的，甚至在尝试访问时可能会抛出错误*** 

 ***希望这可以帮助 ;）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T16:34:40.017

直接回答您的问题：Mozilla 是对的。不仅因为 Brendan Eich 为 Mozilla 工作，而且因为这是唯一正确的方法。让我们来看看细节：

*   每个构造函数都是一个函数。
*   每个函数都有`prototype`用于构造对象的属性。
*   原型是一个对象（字典）。单个对象将方法/属性委托给它们各自的原型。
*   在函数的情况下，原型对象是特殊的——它实现了函数特定的方法和属性。此对象的类型/类未定义，也无法直接使用。
*   这个原型对象不能是`Object`nor `Object.prototype`。

让我详细说明最后一个陈述。如果它是假的，我们可以像这样在用户代码中重新创建函数：

```
// we re-creating the function!

// our function constructor
var Fun = function(){ /*...*/ };

// let's chain the prototype
Fun.prototype = new Object();

// do we have a function now? let's fund out
var fun = new Fun();
console.log(fun.length);  // undefined
fun.call(null);           // fail
fun.apply({}, [1, 2, 3]); // fail
// nope 
```

我们可以观察到`new Object()`它没有定义新的方法或属性，并且可以尝试`Object.prototype`直接使用相同的结果。

总结：函数的原型不是`Object`也不是`Object.prototype`。这是一个非常特殊的物体。这是我们无法在用户代码中重新创建函数的另一个原因。

编辑：有关原型的更多详细信息，请查看[此答案](https://stackoverflow.com/questions/383201/relation-between-prototype-and-prototype-in-javascript#383478)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-22T06:28:19.087

我知道这篇文章有点老了，但我一直在网上搜索有关此主题的信息，并认为我会发布我发现的内容。原型属性用于构造函数。它允许您分配将使用 new 关键字创建的对象的原型对象。

JavaScript 中的每个对象都有一个原型对象，但许多实现不允许您直接访问它或允许您在对象创建后设置它。在 FireFox 中，您可以通过 " `__proto__`" 属性访问此对象。

下面我有一个使用“ `__proto__`”属性的代码版本。函数原型链上的部分与您认为的应该是相匹配的。

```
function nl(z) { document.write(z + "<br>"); }

x = {};

nl(x["__proto__"]);
nl(x["__proto__"] === Object.prototype);

nl("");

nl(nl.prototype.constructor);
nl(nl["__proto__"].constructor);
nl(nl["__proto__"] === nl.prototype);

nl("");

nl(nl["__proto__"]);
nl(nl["__proto__"] === Function.prototype);
nl(nl["__proto__"]["__proto__"] === Object.prototype);
nl(nl["__proto__"]["__proto__"]["__proto__"]);

nl("");

nl(Function["__proto__"]);
nl(Function["__proto__"]["__proto__"]);
nl(Function["__proto__"]["__proto__"] === Object.prototype);
nl(Function["__proto__"]["__proto__"]["__proto__"]); 
```

Firefox 中的输出为：

```
[object Object]
true

function nl(z) { document.write(z + "
"); }
function Function() { [native code] }
false

function () { }
true
true
null

function () { }
[object Object]
true
null 
```

# c++ - QX11EmbedContainer和QProcess问题

> ID：383173
> 
> 赞同：1
> 
> 时间：2008-12-20T10:33:47.030
> 
> 标签：c++, linux, qt, qprocess, qx11embedcontainer

我一直在尝试在我的应用程序中放置一个 QX11EmbedContainer，并且我需要在其中启动一个终端（因为使用 konsolepart 我几乎无能为力）。

```
QX11EmbedContainer* container = new QX11EmbedContainer(this); // with or without "this" I got the same result
container->show(); 
QProcess process(container);
QString executable("xterm -into ");
QStringList arguments;
arguments << QString::number(container->winId());
process.start(executable, arguments); 
```

编译很顺利，但我收到了这条消息：

```
QProcess: Destroyed while process is still running. 
```

而且我看不到容器，建议？？？？？？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T05:04:48.693

被`QProcess`分配在堆栈上，一旦超出范围就会被删除。这很可能发生在“xterm”子进程退出之前（因此输出）。

尝试在堆中分配 QProcess：

```
QProcess * process = new QProcess(container);
...
process->start(executable, arguments); 
```

您可以通过三种方式删除 QProcess：

1.  没做什么。让`QX11EmbedContainer`删除它。它是 的子级，在`QX11EmbedContainer`删除 时将`QX11EmbedContainer`被删除。

2.  将`finished()`信号连接到自己的`deleteLater()`插槽。

    `connect( process, SIGNAL(finished(int,QProcess::ExitStatus)), process, SLOT(deleteLater()) );`

3.  通过保留指向它的指针自己删除它并稍后删除该指针。

作为额外说明，我对`QProcess::start()`. 它应该是可执行文件的路径，并且应该将更多参数添加到`QStringlist`.

```
QProcess * process = new QProcess(container);
QString executable("xterm"); // perhaps try "/usr/X11/bin/xterm"
QStringList arguments;
arguments << "-into";
arguments << QString::number(container->winId());
proces->start(executable, arguments); 
```

# jsf - 在 JSF 中生成弹出窗口

> ID：383183
> 
> 赞同：3
> 
> 时间：2008-12-20T10:40:48.327
> 
> 标签：jsf

我是 JSF 世界的新手，请帮助我在页面中生成一个弹出窗口。

这是我的要求，我将在我的母版页（父级）中有一个链接列表，点击每个链接我需要显示一个包含一些详细信息的弹出窗口，我需要从弹出 mbean 中的 DB 获取这些详细信息。我的弹出窗口中将有几个按钮，并且对于每一个动作，我都会相应地进行数据库操作。我尝试了不同的方法，但都失败了。

我面临的问题是，当第一次弹出加载时它很好，并且可以按预期投射值。但它第二次在 init 函数中显示新值，我无法在屏幕上看到新值，而是显示第一个弹出值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T20:14:09.067

您是否检查过您的 faces-config.xml 文件以确保您的 bean 在请求范围内？

```
<managed-bean-scope>request</managed-bean-scope> 
```

如果您的 bean 在会话或应用程序范围内，则每次刷新页面时都不会重新创建 bean，因此 bean 中的值不会改变。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-14T14:40:20.413

[MyFaces Orchestra](http://myfaces.apache.org/orchestra/myfaces-orchestra-core/multiwindow.html)支持开箱即用的多窗口应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T20:29:46.687

似乎与我有关的缓存，但请检查以下内容：

*   您是否调试并看到了 bean 中的正确值；
*   您是否确保从该 bean 中获取值？
*   你确定浏览器第二次访问服务器吗？和
*   您是否解析了日志（并激活了它们！）并确保没有错误？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T09:56:35.733

了解您如何显示弹出窗口以及是否使用某些 JSF 组件来执行此操作会很有用。如果您只是显示一个隐藏的 div（或您在母版页加载时加载一次的任何内容），您可能不会再次呈现该 div，因此数据不会被实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-12T23:08:17.433

我不是 JSF 的大程序员，但我想你需要 JavaScript 来触发点击事件的弹出窗口。JSF 是一个服务器端 Java 框架，所以它可能无法打开一个新窗口。我不确定这个答案. 以前用这个链接学习JSF思想：[http ://www.javapassion.com/handsonlabs/jsfsimpleapps/#Exercise_1](http://www.javapassion.com/handsonlabs/jsfsimpleapps/#Exercise_1)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T10:45:30.907

不太确定它是否是标准的 JSF（我很确定它实际上不是），但你应该在你的支持 bean 中有一个 isPostBack() 方法，它可以让你知道你是否是第一次加载页面或者在一个动作之后重新加载它；如果您可以使用 isPostBack() 方法，您将能够仅在第一页加载时从数据库加载值，而不会在操作后覆盖修改后的值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-31T04:52:52.080

所以（如果我正确理解您的问题）问题是第二次修改后的 bean 值没有进入前端？

我很惊讶这种变化取决于它是否在弹出窗口中。

一些想法：

*   大概当您打开此弹出窗口时，您只是在访问一个页面，即`http://localhost:8080/myApp/myPopupURL`？
*   mbean（当您说 mbean 时，您的意思是您访问的 java 对象`#{name.javaBeanField}`对吗？）请求或会话范围？
*   你在做什么来得到这个结果？您是否单击了弹出链接，然后再次单击该链接（预计已经打开的弹出窗口会刷新）？还是您单击链接，关闭弹出窗口并再次单击链接？还是您单击链接然后刷新弹出窗口？

目前我没有一个有效的 JSF 设置，但如果我这样做了，我会尝试创建一个带有链接的单个 JSF 页面。该链接将打开一个指向静态 URL 的弹出窗口（如上面的示例）。静态 URL 将映射到一个非常简单的 mbean，它做了一些简单的事情，比如显示一个 int，它是一个介于 1 和 100 万之间的随机数。

让这项工作至少可以排除其他任何错误的可能性。我有时会遇到 JSF 随机吃异常和使用旧值刷新页面的问题（因为生命周期没有完成）。

# javascript - JavaScript - check if in global context

> ID：383185
> 
> 赞同：6
> 
> 时间：2008-12-20T10:42:40.197
> 
> 标签：javascript, object, global

When a function is attached to an object and called:

```
function f() { return this.x; }
var o = {x: 20};
o.func = f;
o.func(); //evaluates to 20 
```

`this` refers to the object that the function was called as a method of. It's equivalent to doing `f.call(o)`.

When the function is called not as part of an object, `this` refers to the global object. How do I check if a function is being called from a non-object context? Is there any standard keyword to access the global object? Is the only way to do it something like this?

```
globalobj = this;
function f() { if (this == globalobj) doSomething(); } 
```

Note: I have no particular use case in mind here - I actually am asking about this exact mechanism.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-22T01:18:53.733

The below should work since using Function.call with a value of null will invoke it in the global scope.

```
this === ((function () { return this; }).call(null)) 
```

A simpler variant,

```
this === (function () { return this; })() 
```

will also work, but I think the first makes the intent clearer.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-20T10:49:41.820

The global object is actually the window so you can do

```
if (this === window) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T08:25:17.010

RoBorg's answer is conceptually correct -- except `window` is only available in the context of the browsers main thread (so this necessarily excludes worker threads and the like, as well as any non-browser hosted JS, which is getting less and less uncommon).

Your safest bet is basically what you had above, but you should use `var` and `===` as it is possible for the interpreter to optimise such accesses more completely.

# javascript - 允许访问 [[Call]] 的 JavaScript 实现

> ID：383189
> 
> 赞同：2
> 
> 时间：2008-12-20T10:47:09.907
> 
> 标签：javascript, python, function

ECMA 标准定义了一个隐藏的内部属性`[[Call]]`，如果实现，则意味着该对象是可调用的/是一个函数。

在 Python 中，也会发生类似的事情，只是您可以自己覆盖它以创建自己的可调用对象：

```
>>> class B:
...     def __call__(self, x,y): print x,y
...
>>> inst = B()
>>> inst(1,2)
1, 2 
```

标准 JavaScript 中是否有类似的机制可用？如果不是，那么当前的 JavaScript 实现呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T11:04:11.120

据我所知，这是不可能的。它应该是对象的内部属性，而不是暴露给脚本本身。我知道的唯一方法是定义一个函数。

但是，由于函数是一等公民，您可以向它们添加属性：

```
function myfunc(){
  var myself = arguments.callee;
  myself.anotherfunc();
}

myfunc.avalue=5;

myfunc.anotherfunc=function(){
  alert(this.avalue);
}

myfunc(); //Alerts 5
myfunc.anotherfunc(); //Alerts 5 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T08:20:23.243

[[Call]] 是一个内部属性，用于描述语言规范中的特定功能。不能保证这样的属性甚至可以在解释器中使用。规范中引用了许多其他属性和对象，例如 Completion 对象，仅当您将语言实现为 AST 解释器时才需要，这就是 KJS 和 JavaScriptCore（JSC == KJS 的 WebKit 分支）使用的去做。非基于 AST 的解释器（SpiderMonkey、新的 KJS 和 JavaScriptCore 执行引擎 FrostByte 和 SquirrelFish，可能是 Opera JS 引擎和 V8）不需要很多这些结构，因为它们主要用于描述行为的目的——而不是执行。

此类访问不可用还有另一个原因——许多这些属性对于解释器来说是如此固有，以至于无论是否使用这些特性，允许自定义行为都会影响性能——例如，JSC API 提供了一种机制embedder 覆盖其中的许多属性，并且即使在 C 级别支持它实际上也会对性能产生*可衡量*的影响。

[编辑：次要注意，当我说“解释器”时，我的意思是一般意义上的——它可能是解释 AST、字节码或机器码（例如 jit）]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-15T15:00:06.483

使用 Javascript 1.5 或更高版本的 Mozilla Spidermonkey 实现的应用程序（例如 Firefox）可以访问该[`__noSuchMethod__`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Object/noSuchMethod)机制：

```
c:\>jsdb
js>x = {};
[object Object]
js>x.__noSuchMethod__ = function(id,args) {writeln('you just called: '+id+'()');}
function (id, args) {
    writeln("you just called: " + id + "()");
}
js>x.foo()
you just called: foo()
js>x.bar()
you just called: bar()
js> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T16:41:53.917

目前还不可能：[[Call]] 是隐藏的，并不是在所有的 conformat 实现中都可以直接使用。它可能会在[ECMAScript 的新标准中](http://wiki.ecmascript.org/doku.php?id=es3.1:es3.1_proposal_working_draft)发生变化。

# asp.net - 在 ASP.NET MVC 中编译视图

> ID：383192
> 
> 赞同：575
> 
> 时间：2008-12-20T10:51:00.303
> 
> 标签：asp.net, asp.net-mvc, msbuild

我想要一个 msbuild 任务来编译视图，这样我就可以查看是否存在编译时错误......编译时。有任何想法吗？

* * *

## 回答 #1

> 赞同：583
> 
> 时间：2009-02-12T19:52:21.047

*来自 RC1 的自述词文档（未被 google 索引）*

**ASP.NET 编译器构建后步骤**

目前，视图文件中的错误直到运行时才会被检测到。为了让您在编译时检测到这些错误，ASP.NET MVC 项目现在包含一个 MvcBuildViews 属性，默认情况下该属性是禁用的。要启用此属性，请打开项目文件并将 MvcBuildViews 属性设置为 true，如下例所示：

```
<Project ToolsVersion="3.5" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <MvcBuildViews>true</MvcBuildViews>
  </PropertyGroup> 
```

**注意** 启用此功能会增加构建时间的一些开销。

您可以通过执行以下步骤更新使用先前版本的 MVC 创建的项目以包括视图的构建时验证：

1.  在文本编辑器中打开项目文件。
2.  在最上面的元素下添加以下`<PropertyGroup>`元素： `<MvcBuildViews>true</MvcBuildViews>`
3.  在项目文件的末尾，取消注释`<Target Name="AfterBuild">`元素并修改它以匹配以下内容：

```
<Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
    <AspNetCompiler VirtualPath="temp" PhysicalPath="$(ProjectDir)\..\$(ProjectName)" />
</Target> 
```

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2013-04-10T21:26:54.357

坦率地说，我会推荐**RazorGenerator** nuget 包。这样，您的视图会`.designer.cs`在您保存它们时生成一个文件，并且除了为您的视图获取编译时错误之外，它们还被预编译到程序集中（= 更快的预热），并且 Resharper 还提供了一些额外的帮助。

要使用它，请在您的 ASP.NET MVC 项目中包含**RazorGenerator nuget 包，并在****Tools → Extensions and Updates**下的项目下安装“ **Razor Generator** ”扩展。

 **我们使用它，并且使用这种方法每次编译的开销要少得多。最重要的是，我可能会推荐**RedGate 的 .NET Demon，**它进一步大大减少了编译时间的影响。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-12-20T11:04:12.227

您可以为此使用**[aspnet_compiler ：](http://msdn.microsoft.com/en-us/library/ms229863.aspx)**

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727\aspnet_compiler -v /Virtual/Application/Path/Or/Path/In/IIS/Metabase -p C:\Path\To\Your\WebProject -f -errorstack C:\Where\To\Put\Compiled\Site 
```

其中“ **/Virtual/Application/Path/Or/Path/In/IIS/Metabase** ”是这样的：“ **/MyApp** ”或“ **/lm/w3svc2/1/root/** ”

MSDN 上还有一个**[AspNetCompiler Task](http://msdn.microsoft.com/en-us/library/ms164291.aspx)**，展示了如何将 aspnet_compiler 与 MSBuild 集成：

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="PrecompileWeb">
        <AspNetCompiler
            VirtualPath="/MyWebSite"
            PhysicalPath="c:\inetpub\wwwroot\MyWebSite\"
            TargetPath="c:\precompiledweb\MyWebSite\"
            Force="true"
            Debug="true"
        />
    </Target>
</Project> 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-12-20T12:25:29.770

此外，如果您使用 Resharper，您可以激活解决方案范围分析，它会检测您在 aspx 文件中可能存在的任何编译器错误。这就是我们所做的...

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-20T12:12:35.427

ASP.NET MVC 的下一个版本（1 月左右可用）应该有编译视图的 MSBuild 任务，所以您可能需要等待。

见[公告](http://weblogs.asp.net/scottgu/archive/2008/12/19/asp-net-mvc-design-gallery-and-upcoming-view-improvements-with-the-asp-net-mvc-release-candidate.aspx)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-11-17T15:04:17.230

此处给出的答案适用于某些 MVC 版本，但不适用于其他版本。

简单的解决方案适用于 MVC1，但在升级到 MVC2 时，视图不再被编译。这是由于网站项目文件中的错误造成的。请参阅这篇 Haacked 文章。

看到这个：[http ://haacked.com/archive/2011/05/09/compiling-mvc-views-in-a-build-environment.aspx](http://haacked.com/archive/2011/05/09/compiling-mvc-views-in-a-build-environment.aspx)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-11-03T08:25:10.750

构建 > 运行代码分析

热键：`Alt`+`F11`

帮助我发现 Razor 错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-03-31T10:49:14.380

使用 Visual Studio 的[**Productivity Power Tools**](https://visualstudiogallery.msdn.microsoft.com/dbcb8670-889e-4a54-a226-a48a15e4cace)（*免费*）扩展会**有所帮助**。具体来说，`Solution Error Visualizer`功能。有了它，在解决方案资源管理器中（在发现错误的源文件中）以可视方式标记编译错误。但是，由于某种原因，此功能不适用于代码中其他任何地方的其他错误。

使用 MVC 视图，任何编译时错误仍将在其各自的 .cs 文件中用红色下划线标出，但这些错误不会在解决方案资源管理器中向上传播（绝不会在包含的源文件中传播）。

感谢您`BlueClouds`更正我之前的陈述。

我刚刚将其报告为扩展的 github 项目中的一个[问题。](https://github.com/Microsoft/VS-PPT/issues/91)

# httpwebrequest - 更重要的是，尽可能少的 http 请求或拆分文件以便于开发？

> ID：383194
> 
> 赞同：1
> 
> 时间：2008-12-20T10:55:04.990
> 
> 标签：httpwebrequest

很多时候在互联网上阅读有关 Web 开发的信息时，我听说您应该将 javascript 和 css 文件拆分为多个文件。
就像将您的 css 文件拆分为：

*   清除.css
*   base.css
*   page_specific.css

或者您甚至应该将它们拆分为包含定位、颜色和排版信息的文件。

但是浏览器不是只能同时发出两个http请求吗？将文件拆分成这么多文件会产生大量的 http 请求。将它们分成两个文件，一个特定于页面的文件和一个基本/清除 css 文件不是更好吗？然后将它们与大量缓存头一起发送？

我知道拆分文件更容易开发，但速度不应该更重要吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-20T11:34:27.253

过早的优化是万恶之源。首先使您的代码易于编写和维护。如果稍后您发现文件数量是一个瓶颈，您可以在构建过程中添加一个步骤，将它们组合成一个文件。此步骤还可以删除注释和空格。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T11:34:14.490

我根据理智维护的需要适度拆分它们；HTTP 1.1 每个连接的多个请求、流水线和缓存对于减轻拥有多个文件的开销大有帮助。也就是说，我不想拥有数百个小虫子。但是，3-7 个 CSS 文件，当然。并且绝对将 JS 和 CSS 从 HTML 中分离出来。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T11:35:05.363

这是整个过早优化的事情。

我认为最好以对您最有意义的方式组织您的代码，然后找到一个工具来组合文件以供您在网站上线时使用。有许多脚本可以为您执行此操作。

每页有大量文件肯定会影响性能。

IE7-每台服务器支持两个并发 HTTP 连接，IE8[将其增加到 6 个](http://www.peterkrantz.com/2008/concurrent-browser-connections-ie8/)。

我想像HTTP 1.1 所支持的[pipelining](http://en.wikipedia.org/wiki/HTTP_pipelining)可以缓解连接限制问题，但它在 FF 和 IE 中默认禁用，Opera 已启用它。

MS [Ajax 控件工具包](http://www.codeplex.com/Wiki/View.aspx?ProjectName=AjaxControlToolkit)实际上具有与 ToolkitScriptManager 控件相结合的内置脚本。

一篇[很好的 MSDN 文章](http://msdn.microsoft.com/en-us/library/cc837190.aspx)，一个[用于 ASP.NET 的工具](http://www.codeproject.com/KB/aspnet/httpcompression.aspx)，以及[另一个](http://www.codeproject.com/KB/aspnet/HttpCombine.aspx)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-20T11:46:48.443

为什么不能两全其美？

我对我的项目所做的是将多个 CSS 和 JS 文件保存在一个`src`目录中，然后有一个脚本将它们组合在一起并将每个文件压缩（打包）到“myproject.pack.js”或“myproject.pack.css”文件中. [在我的 IDE](http://www.ultraedit.com)中创建运行此脚本的快捷方式使这完全无痛，并为您提供大量注释和逻辑分离的 JS 和 CSS 文件的好处，以及单个 HTTP 请求和最小化代码的好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T11:29:26.543

我认为最好制作单独的文件 - 这是更“可支持”的方法。

但在生产中，您可以使用某种解决方案将 CSS（或 JS）文件合并到一个文件中：

[自动将 Javascript 和 CSS 加入到单个文件中](http://aciddrop.com/2008/01/03/automatically-join-your-javascript-and-css-into-a-single-file)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-20T12:47:28.103

天，

我将建议您查看 Steve Souders 在 Yahoo 开发的规则，并可能安装相关的 YSlow 插件，但是...

谷歌搜索 YSlow 让我看到了 Jeff Attwood 在他的 Coding Horror 网站上发表的[一篇有趣的文章](http://www.codinghorror.com/blog/archives/000932.html)，该文章是关于根据 Jeff 所说的事实来定制 YSlow 建议的

> ... 雅虎的问题不一定是你的问题。

这篇文章为您提出的问题提供了很多有用的信息，并且提供的不仅仅是死记硬背的“只需使用 YSlow 插件并遵循建议”的建议。

绝对是一个增值。谢谢杰夫。

干杯，

抢

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-20T12:57:06.243

这是我的两分钱：如果您有 100 个 JS/CSS 文件，每个文件重 1MB，这并不重要。它只会减慢您页面的第一次打开速度。之后，它们将被缓存在客户端上，一切都会好起来的。所以一定要追求可维护性和逻辑分离。

# delphi - 在 Delphi 版本 <= 2007 中处理 Unicode 字符串

> ID：383195
> 
> 赞同：12
> 
> 时间：2008-12-20T10:55:10.093
> 
> 标签：delphi, unicode, encoding

**背景：**这个问题与 2009 年以下的 Delphi 版本有关（即没有内置 Unicode 支持）。我有一个规范，要求我通过 TCP 连接传输 Unicode 编码的字符串，但我没有 Delphi 2009。

**问题**是否有一个函数或非常小的库（我不需要太多的体积）可以在通过网络发送之前立即将单个字符串编码为 UTF-8？作为我问题的第二部分：如果有 UTF-8 编码的字符串作为响应被发回，我想我需要另一个函数将其恢复为 Delphi 字符串格式。我以这种方式理解这种 Unicode 支持的局限性。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-20T16:31:40.943

Delphi 2009 之前的 Delphi 版本*确实*内置了 Unicode 支持。**`WideString`**我认为，该类型从 Delphi 4 开始就可用，可能更早。`WideString`不如新`UnicodeString`类型好，但它仍然包含 16 位 Unicode 字符，您可以将其类型转换**`PWideChar`**为将字符串发送到 Unicode API 函数。该`Windows`单元声明了 API 函数的大多数“宽”版本，如果您发现缺少某些函数，没有什么可以阻止您自己声明其他函数。

以前的版本没有的是 VCL 中的 Unicode 支持。为此，您可以使用**Tnt Unicode 控件**。他们曾经是免费的。看起来有几个地方仍然可以使用最新的免费版本：[(1)](http://mh-nexus.de/en/tntunicodecontrols.php) , [(2)](http://www.yunqa.de/delphi/doku.php/products/tntunicodecontrols/index)。

[**JCL**](http://homepages.codegear.com/jedi/jcl/)有几个单元用于处理 Unicode。该**`JclWideStrings`**单元主要具有轻量级的实用功能。该**`JclUnicode`**单元更完整，但它还包括一个相当大的资源，用于确定所有 Unicode 字符的字符属性。

使用 JCL，您可以选择一些类来保存`WideString`值列表。我认为 Delphi 7 甚至为此提供了一个类。

不要以为没有 Delphi 2009 就不能编写 Unicode 程序。

如果您有一个`WideString`值，并且希望将其编码为 UTF-8，则调用该**`Utf8Encode`**函数。如果您的 Delphi 版本声明了该类型，它将返回一个`AnsiString`值，或者可能返回。`Utf8String`不过，它与 Delphi 2009 的`Utf8String`类型不同。Delphi 2009 将在赋值语句中*自动*转换为`UnicodeString`或`AnsiString(x)`反之亦然。以前的版本只有一种`AnsiString`类型，因此您需要自己跟踪哪些变量保存 UTF-8 数据，哪些保存 Ansi 数据。（变量和参数名称上的匈牙利符号可以帮助您跟踪。）当然，还有一个**`Utf8Decode`**函数可以将 UTF-8 数据转换回`WideString`.

对于处理其他字符编码，您需要查看[**Open XML**](http://www.philo.de/xml/)，这是一个免费的 Delphi XML 库。作为其 XML 处理的一部分，它支持在 70 种不同的编码之间进行转换。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-20T12:16:17.417

使用类型**widestring**和编码函数到/从utf8（UTF8Encode/UTF8Decode）

**不要使用字符串类型**，也不要使用 Ansi 函数——如果你这样做，你会丢失信息。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-20T16:10:33.340

我在没有使用 Delphi 2009（在它发布之前）的情况下构建了一个完整的 unicode 应用程序。

我使用了以下内容：

1.  使用宽字符串作为主要字符串数据类型。

2.  使用支持 unicode 的数据库组件（ADO 也使用宽字符串，但我没有使用它，因为它不处理 unicode 字段名称）。

3.  为 UI 使用了免费的 TNTControls，工作正常，但它与标准控件相同，没有像其他第三方控件那样的太多功能。

4.  我已经设置了一个不同语言的虚拟机，所以我可以在不支持我的语言的不同系统中测试版本。

5.  FastReport 是我的报告工具，它也支持 Unicode。

我还使用Delphi Inspiration 的[DIConverters](http://www.yunqa.de/delphi/doku.php/products/converters/index)将数据库从 ansi 转换为 UTI8 及其功能，您可以将其用于从/到 UTF8 的转换，它是免费软件；-)

还有一个开源项目[Delphi](http://fundementals.sourceforge.net/unicode.html) basics ，它对 unicode 有有用的功能。

但我认为，如果你可以使用 D2009 来完全支持 unicode，你的工作会更容易和更快，因为你不会使用慢速的宽字符串数据类型，而且你会发现大多数第三方提供了 Unicode 版本或正在工作它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-20T13:11:22.033

将 Delphi 2009 之前的应用程序转换为 unicode 很困难但可行。我会把它分成3个任务。

1.  首先，确保您的数据库处理 unicode 字符串。最好支持 UTF-16。确保您的所有数据库代码都正确处理宽字符串，并且您使用的驱动程序也可以处理这个问题。
2.  将所有业务逻辑从使用字符串转换为使用 WideStrings。很容易漏掉一些，而且你不会得到任何错误，因为如果你忘记了任何方法，编译器会隐式地将宽字符串转换为字符串。还要确保将所有标准字符串函数更改为 WideString 等效项。此过程需要扩展到您可能使用的任何第三方组件。
3.  最后一部分是将您可能需要的标准和第三方视觉组件更改为 WideString 等效项。这需要在您要显示可能包含 unicode 字符的字符串的地方完成。

最重要的是确保您的测试是彻底的，并使用实际使用高字节的 unicode 字符。如果您只是使用拉丁字符集进行测试，您将错过错误。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-20T15:56:13.480

如果您确实需要做的只是将程序内部字符串从系统编码转换为 UTF-8 并返回，那么请使用 Uwe Raabe 提到的库函数。如果您仍在使用 Delphi 4 或 5（没有这些功能），您可以使用[GNU gettext for Delphi](http://dxgettext.po.dk/)中的功能。

并且不要让所有关于完全使用 WideString 的答案吓到你——使用 UTF-8 作为数据交换的编码（这就是我理解你的问题的方式）应该可以在没有大问题的普通 Ansi Delphi 程序中实现，只要您正在处理在 Windows 编码中 100% 可表示的数据。

# javascript - JavaScript 中 [[Prototype]] 与原型的关系

> ID：383201
> 
> 赞同：19
> 
> 时间：2008-12-20T11:04:14.550
> 
> 标签：javascript, ecma262

来自[http://www.jibbering.com/faq/faq_notes/closures.html](http://www.jibbering.com/faq/faq_notes/closures.html)：

> 注意：ECMAScript 定义了内部 Object 类型的内部 [[prototype]] 属性。这个属性不能被脚本直接访问，但它是在属性访问器解析中使用的内部 [[prototype]] 属性引用的对象链；对象的原型链。存在一个公共原型属性以允许与内部 [[prototype]] 属性关联的原型的分配、定义和操作。**两者之间的关系细节在 ECMA 262（第 3 版）中进行了描述，超出了本讨论的范围。**

两人的关系有哪些细节？我浏览了 ECMA 262，我读过的所有内容如下：

> 构造函数的关联原型可以被程序表达式constructor.prototype引用，
> 
> 原生 ECMAScript 对象有一个称为 [[Prototype]] 的内部属性。此属性的值为 null 或对象，用于实现继承。
> 
> 每个内置函数和每个内置构造函数都有 Function 原型对象，它是表达式 Function.prototype 的初始值
> 
> 每个内置原型对象都有 Object 原型对象，它是表达式 Object.prototype (15.3.2.1) 的初始值，作为其内部 [[Prototype]] 属性的值，除了 Object 原型对象本身。

由此我收集到的是 [[Prototype]] 属性等效`prototype`于几乎任何对象的属性。我弄错了吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-12-20T11:46:58.273

我相信你在大多数情况下是对的。

每个对象都有一个隐藏`[[Prototype]]`属性，用于继承。函数还有一个公共`prototype`属性，仅在函数用作构造函数时使用：当使用 构造对象时`new`，`[[Prototype]]`新对象的`prototype`属性设置为用作构造函数的函数的属性。

例如

```
function C() {}
C.prototype = P1;  
var obj = new C();  // obj.[[Prototype]] is now P1. 
```

您可以`[[Prototype]]`使用`Object.getPrototypeOf(<obj>)`. （此方法在 ECMAScript 5 中指定。旧版本的 JavaScript 没有任何标准的阅读方式`[[Prototype]]`）。

您*通常*可以通过构造函数获取原型，例如：

```
obj.constructor.prototype == Object.getPrototypeOf(obj) 
```

但情况并非总是如此，因为构造函数的原型属性可以重新分配，但`[[Prototype]]`对象的 属性在对象创建后无法重新分配。所以如果你这样做：

```
C.prototype = P2; 
```

然后

```
obj.constructor.prototype != Object.getPrototypeOf(obj) 
```

因为原型`C`是现在`P2`，但仍然`[[Prototype]]`是。`obj``P1`

请注意，*只有*具有`prototype`属性的函数。另请注意，`prototype`函数的`[[Prototype]]`属性与函数的属性不同！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-20T17:00:57.077

直接回答您的问题：从逻辑上讲，它是对象`prototype`构造函数属性的私有副本。使用元语言这是创建对象的方式：

```
// not real JS

var Ctr = function(...){...};
Ctr.prototype = {...}; // some object with methods and properties

// the object creation sequence: var x = new Ctr(a, b, c);
var x = {};
x["[[prototype]]"] = Ctr.prototype;
var result = Ctr.call(x, a, b, c);
if(typeof result == "object"){ x = result; }
// our x is fully constructed and initialized at this point 
```

此时我们就可以修改原型了，修改会反映到类的所有对象上，因为它们是通过引用来引用原型的：

```
Ctr.prototype.log = function(){ console.log("...logging..."); };

x.log();  // ...logging.. 
```

但是如果我们改变构造函数的原型，已经创建的对象将继续引用旧对象：

```
Ctr.prototype = {life: 42};
// let's assume that the old prototype didn't define "life"

console.log(x.life);  // undefined
x.log();              // ...logging... 
```

完全按照标准`[[prototype]]`是不可用的，但是 Mozilla 用`__proto__`属性（只读）扩展了标准，这暴露了通常隐藏的`[[prototype]]`：

*   [Mozilla 的文档](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Property_Inheritance_Revisited/Determining_Instance_Relationships)
*   [Mozilla 扩展概述：__count__、__proto__、__parent__](http://weblogs.asp.net/stephenwalther/archive/2008/02/26/javascript-magic-properties-using-count-proto-and-parent.aspx)

同样，`__proto__`可以[在下一个 ES3.1 标准](http://wiki.ecmascript.org/doku.php?id=es3.1:es3.1_proposal_working_draft)中合法化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T12:50:17.410

除了 olavk 的回答：一些 JavaScript 实现（例如[mozilla 的](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Object/proto)）允许直接访问 [[Prototype]] 属性...

# html - 直接电子邮件链接无需展望

> ID：383203
> 
> 赞同：1
> 
> 时间：2008-12-20T11:07:39.350
> 
> 标签：html, email

如何获得直接提交电子邮件的链接？我不想使用 Outlook 发送电子邮件。我想通过单击提交按钮而不打开 Outlook eexpress 来发布电子邮件并使用它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-20T11:15:55.010

HTML 不能直接发送电子邮件。您需要可以处理发送电子邮件请求的服务器代码。你想用什么语言来做这件事？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T11:25:48.783

如果您使用 .net，您可以查看命名空间 system.net.mail。

它很容易使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T14:03:18.713

你的问题不是很清楚。如果您只需要发送一封电子邮件，您可以放置​​一个链接/按钮，向服务器 CGI 发送请求以完成这项工作。但当然，电子邮件将使用那里可用的任何电子邮件用户/域从服务器发送。

如果您需要有一种方法让*用户*从浏览器中发送电子邮件，我会说这是一个坏主意，因为它会引发很多安全/隐私问题。事实上，如果某些 javascript（或类似的东西）确实发送电子邮件，我会认为这是安全漏洞 :)

# unit-testing - 对并发 Erlang 代码进行单元测试的最佳方法是什么？

> ID：383211
> 
> 赞同：17
> 
> 时间：2008-12-20T11:24:35.913
> 
> 标签：unit-testing, concurrency, erlang, parallel-processing

我花了一些时间在 Erlang 上，我想将 TDD 应用于我正在编写的代码。

虽然标准库中的[EUnit](http://www.erlang.org/doc/apps/eunit/chapter.html)提供了一个很好的传统单元测试框架来测试常规样式代码，但似乎没有任何东西可以专门帮助测试并发代码，这在 Erlang 中被大量使用。

请注意，我们在这里讨论的是 Erlang，它使用消息传递（而不是共享状态）在并发进程之间进行通信，因此在共享状态语言中对并发代码进行单元测试的技术可能不适用。

有人找到了在 Erlang 中测试并发代码的好方法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-10-10T13:38:59.190

我刚刚发现了一些很酷的新开发的软件（截至 2011 年），用于测试并发 Erlang 应用程序，称为**[Concuerror](http://concuerror.com/)**。有[几篇](http://dspace.lib.ntua.gr/bitstream/123456789/4618/3/gotovosa_concurrency.pdf) 关于它的论文和[github](http://concuerror.com/publications/)[上](https://github.com/parapluu/Concuerror)的存储库。显然，它通过使用自己的调度程序并系统地测试进程之间的不同交错来工作。

另外值得一提的是**Dialyzer** (DIScrepancy AnaLYZer for ERlang) ( [Papers](http://www.it.uu.se/research/group/hipe/dialyzer) , [Tutorial](http://www.ejabberd.im/dialyzer) , [Manual](http://www.erlang.org/doc/man/dialyzer.html) ) ，它是一个对代码进行静态分析以查找错误的工具。这也支持检测一些并发错误（参见[论文](http://www.it.uu.se/research/group/hipe/dialyzer/publications/races.pdf)）。

我自己没有测试过这些，尽管透析器似乎是相对成熟的软件。这两个程序都有一个用于测试的 GUI。

PS。对于非并发部分，EUnit 和 QuickCheck（也有免费版本）应该可以正常工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T12:26:18.920

这个问题有点模糊（“Erlang 是并发的，用 Erlang 测试它！”）但我会尝试详细说明一下。

测试 Erlang 代码的范围可以从直接简单（正确的输入产生正确的输出）到设置复杂的测试工具来验证组件的行为方式。什么最适合您的特定情况完全取决于您的要求以及您想要进行的黑盒/白盒测试的数量。

Erlang 的部分优点在于能够使并发透明化。考虑以下示例（一个并行化列表列表总和的函数）：

```
deep_sum(ListOfLists) ->
     Parent = self(),
     [spawn(fun() -> Parent ! lists:sum(List) end) || List <- ListOfLists],
     lists:sum([receive Sum -> Sum end || _ <- ListOfLists]). 
```

您通常会使用一个非常简单的 EUnit 测试用例来测试它：

```
deep_sum_test() ->
     ?assertEqual(0,  deep_sum([0,  0,  0,  0])),
     ?assertEqual(40, deep_sum([10, 10, 10, 10]). 
```

现在，假设我们有一个更明确的 API 来实现这个功能：一个进程池作为参数：

```
deep_sum(Pool, ListOfLists) ->
     distribute_lists(Pool, ListOfLists),
     lists:sum([receive Sum -> Sum end || _ <- ListOfLists]).

distribute_lists(Pool, ListOfLists) -> distribute_lists(Pool, Pool, ListOfLists).

distribute_lists([P|Pool], All, [L|ListOfLists]) ->
     P ! {self(), L},
     distribute_lists(Pool, All, ListOfLists);
distribute_lists([], All, ListOfLists) ->
     distribute_lists(All, All, ListOfLists);
distribute_lists(_Pool, _All, []) ->
     ok. 
```

在测试这个时，我们必须处理伪造这个进程池：

```
deep_sum_test() ->
     Pool = [spawn_link(fun() -> fake_pool(1) end) || _ <- lists:seq(1, 3)],
     ?assertEqual(4, deep_sum(Pool, [lists:seq(1, 3) || _ <- list:seq(1, 4)]),
     ?assertEqual(7, deep_sum(Pool, [lists:seq(1, 3) || _ <- list:seq(1, 7)]),
     [P ! stop || P <- Pool].

fake_pool(CannedResponse) ->
     receive
         {From, _L} -> From ! CannedResponse;
         stop -> ok
     end,
     fake_pool(CannedResponse). 
```

如您所见，在 Erlang 中测试并发程序可以采用不同的形式。这些都是非常简单的示例，但是使用 Erlang 内置的并发原语，很容易创建您想要的那种测试工具，并在正确的级别进行抽象。

我通常发现 TDD 与您是否正在测试并发代码是正交的，因此所述测试技术也可以用于正常的单元测试。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-07T15:42:05.110

我知道的一个可以用来在并发场景下测试 Erlang 程序的工具是 QuickCheck：[http ://www.quviq.com/](http://www.quviq.com/)

您可以使用属性指定您的预期行为，并且该工具可以在一系列输入和时间上运行您的 Erlang 程序，以确保满足属性。

不幸的是，它是一个商业工具

还可以查看 ProTest 项目： http: [//www.protest-project.eu](http://www.protest-project.eu)

更新：ProTest 项目发布了一项调查，[“结果：ProTest 项目的 Erlang 测试工具调查”](http://www.protest-project.eu/publications/survey.pdf)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T11:42:55.987

因为并发代码中的错误取决于各个部分的执行顺序，所以我认为最好不要依赖测试来发现代码并发部分中的错误。这样的错误很容易溜走，而且极难定位。例如，参见双锁技术，它被广泛引用并用作在多线程环境中实现延迟初始化的有效方法，[后来发现它被破坏了](http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html)。最好使用适当的抽象和技术来使代码的并发部分“按设计”正确。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T12:04:19.017

补充一下 Diomidis 所说的，对并发代码获得信心的唯一真正方法是在不断变化的条件下运行扩展测试；即便如此，这也只是证明它*在这些条件下*没有失败。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-11T16:28:24.477

您可以使用以下方法隔离您想用模拟测试的部分：http: [//github.com/charpi/erl_mock/tree/master](http://github.com/charpi/erl_mock/tree/master)

不过，我没有使用 erl_mock 的经验。

# powershell - 如何使用 Powershell 授予用户对注册表项的权限？

> ID：383225
> 
> 赞同：0
> 
> 时间：2008-12-20T11:40:46.460
> 
> 标签：powershell, registry

我需要向 Windows 用户组 Everyone 授予 HKCR 配置单元和 HKCR 下面的所有键的权限。我想为此使用 PowerShell 脚本。是否可以？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T15:57:03.570

你真的，真的，真的，*不想*这样做——你正在让你的系统面临大量非常真实的安全风险。而且，虽然在 PowerShell 中完全可以，但使用本机 PowerShell 命令将需要非常困难的语法（使用 *-ACL cmdlet 管理 ACL 很痛苦）。考虑阅读[http://support.microsoft.com/default.aspx/kb/264584](http://support.microsoft.com/default.aspx/kb/264584)；您将能够毫无问题地在 PowerShell 中执行命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T11:49:53.523

您应该能够编写一个脚本，使用 PowerShell 的[set-acl](http://technet.microsoft.com/en-us/library/bb978673.aspx)命令更改注册表中任何键的 hte 权限。我相信 HKCR 在 PowerShell 中映射为 HKLM:\Software\Classes。

# opencv - OpenCv Blob/轮廓标记

> ID：383233
> 
> 赞同：4
> 
> 时间：2008-12-20T11:47:03.700
> 
> 标签：opencv, blob, contour, background-subtraction

嗨，我已经为此工作了一段时间，但还没有好的解决方案。

我正在逐帧阅读视频并使用背景减法来识别存在移动的区域并使用 cvFindContours() 来获取移动对象的矩形边界。

假设程序保持简单，则只能有 2 个人。

这些物体以它们可以重叠的方式移动，并以一定的间隔转动和移开。

我怎样才能正确标记这个人 x 2。

cvFindContour 可以随机返回边界。对于 Frame1,Frame2,Frame3....FrameN

我最初可以比较矩形边界质心以正确标记人类。一旦人类重叠并离开，这种方法就会失败。

我试图跟踪原始 obj 的像素颜色（但是人类非常相似，并且某些区域具有相似的颜色，例如手、腿、头发），因此不够好。

我正在考虑使用 Image Statistic，例如：

CountNonZero(), SumPixels() Mean() Mean_StdDev () MinMaxLoc () Norm ()

以唯一区分这两个对象。我相信这将是一个更好的方法。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-20T15:09:12.187

这是一个难题，任何解决方案都不会完美。计算机视觉被戏称为“AI-complete”学科：如果你解决了计算机视觉并且你已经解决了所有的人工智能。

背景减法是检测物体的好方法。如果您需要改善背景减除结果，您可以考虑使用[MRF](https://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=4129585)。据推测，您可以根据 blob 的大小判断何时存在单个对象以及两个 blob 何时合并。如果在 blob 合并期间轨迹没有快速变化，您可以进行[卡尔曼跟踪](http://www.cs.unc.edu/~tracker/media/pdf/SIGGRAPH2001_CoursePack_08.pdf)并在之后使用一些[启发式方法](http://people.csail.mit.edu/cielbleu/pubs/BoseEtalCVPR07Multiclass.pdf)来消除 blob 的歧义。

即使两个对象之间的颜色相似，您也可以考虑尝试使用[均值偏移跟踪器](http://ieeexplore.ieee.org/search/wrapper.jsp?arnumber=1000236)。您可能需要进行一些[粒子过滤](https://en.wikipedia.org/wiki/Particle_filter)来跟踪关于谁是谁的多个假设。

还有一些更复杂的技术称为[分层跟踪](http://persci.mit.edu/demos/jwang/garden-layer/layer-demo.html)。[Jojic 和 Frey](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.11.7433)、[Winn](http://johnwinn.org/Research/Affine_tracking.html)、[Zhou 和 Tao](http://lear.inrialpes.fr/people/triggs/events/iccv03/cdrom/iccv03/1079_zhou.pdf)以及其他人最近的一些作品。这些技术中的大多数都带有非常强的假设和/或需要大量工作才能正确实施。

如果您总体上对这个主题感兴趣，我强烈建议您参加计算机视觉课程和/或阅读[Ponce 和 Forsyth](https://rads.stackoverflow.com/amzn/click/com/0130851981)等教科书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T11:57:41.323

您可以尝试记住每一帧的一个角（例如左上角）。然后，当您收到新的一组帧时，您将它们的角与之前保存的角的距离进行比较。这当然不是完美的解决方案。

*   如果两个 blob 在某个时间点交叉其路径，则不确定其结果是什么。
*   如果两个 blob 移动得太快，也会导致不需要的结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T13:21:48.253

听起来很难，尤其是在视频中有很多噪音的情况下。

也许确定两个人会互动的不同情况。一些例子：

1.  两个人相遇，然后改变方向或继续前进
2.  两个人相遇，然后只有一个人改变方向或继续前进
3.  两个人相遇，然后一个人留下来，另一个人沿着与相机视图“正常”的方向行进，即远离或朝向相机

计算机视觉教科书可以帮助确定其他情况。

考虑测量您为视频中的每一帧列出的所有这些函数，然后绘制它们的结果。从中确定是否有一种方法可以匹配边界框中像素颜色的标准偏差之类的东西，在他们穿过路径之后，人类所在的边界框中。

# c# - 将 ReaderWriterLockSlim UpgradeableReadLock 降级为简单的 ReadLock

> ID：383248
> 
> 赞同：3
> 
> 时间：2008-12-20T12:08:21.130
> 
> 标签：c#, locking

的[文档](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.enterupgradeablereadlock.aspx)`ReaderWriterLockSlim.EnterUpgradeableReadLock`说：

> 可升级模式下的线程可以降级到读取模式或升级到写入模式。

如何将锁降级为读锁？文档没有告诉...

[编辑：]我不想获得写锁。我只想将可升级锁降级为读锁，以便另一个线程可以获取可升级锁。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T14:18:41.850

根据[ReaderWriterLockSlim](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx)（类本身）的 MSDN 文档：

“可升级模式下的线程可以通过首先调用 EnterReadLock 方法，然后调用 ExitUpgradeableReadLock 方法来降级到读取模式。”

# wpf - 如何在 WPF 中设置滑块控件的样式？

> ID：383251
> 
> 赞同：3
> 
> 时间：2008-12-20T12:14:54.860
> 
> 标签：wpf, xaml, slider, styling

我想设置滑块控件的样式，以便将可拖动拇指的高度设置为 8 像素。

[在WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)中执行此操作的最简单方法是什么？

```
<Slider>
    <Slider.Style>
        <!-- which xaml here? -->
    </Slider.style>
</Slider> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T20:26:16.087

Slider Control 有很多部分 Thumb、RepeatButtons 和一个 Track。它是具有命名元素（如 PART_Track）的控件之一，由代码隐藏引用以使其正常工作。一个好的起点是使用 Blend 来帮助您。

开始一个新项目（或创建一个新窗口）。在 XAML 窗口中添加以下内容：

```
<ScrollBar/> 
```

然后在 Blend 的设计窗口中右键单击控件并选择“Edit control parts (Template)\Edit a Copy...”。这将对标准控制模板进行逆向工程。然后可以对其进行编辑。

混合输出是这样的：-

```
 <LinearGradientBrush x:Key="VerticalScrollBarPageButtonNormal" EndPoint="1, 0" StartPoint="0, 0">
        <GradientStop Color="#EEEDE5" Offset="0"/>
        <GradientStop Color="#EEEDE5" Offset="0.05"/>
        <GradientStop Color="#F3F1EC" Offset="0.06"/>
        <GradientStop Color="#FEFEFE" Offset="0.94"/>
        <GradientStop Color="#EEEDE5" Offset="0.95"/>
        <GradientStop Color="#EEEDE5" Offset="1"/>
    </LinearGradientBrush>
    <Style x:Key="ScrollBarButton" TargetType="{x:Type RepeatButton}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="Focusable" Value="false"/>
        <Setter Property="IsTabStop" Value="false"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type RepeatButton}">
                    <Microsoft_Windows_Themes:ScrollChrome SnapsToDevicePixels="true" x:Name="Chrome" RenderMouseOver="{TemplateBinding IsMouseOver}" RenderPressed="{TemplateBinding IsPressed}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="{TemplateBinding Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph}" ThemeColor="Metallic"/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <LinearGradientBrush x:Key="VerticalScrollBarPageButtonPressed" EndPoint="1, 0" StartPoint="0, 0">
        <GradientStop Color="#D7D5C2" Offset="0"/>
        <GradientStop Color="#D7D5C2" Offset="0.05"/>
        <GradientStop Color="#E3DED3" Offset="0.06"/>
        <GradientStop Color="#FDFDF6" Offset="0.94"/>
        <GradientStop Color="#D7D5C2" Offset="0.95"/>
        <GradientStop Color="#D7D5C2" Offset="1"/>
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="VerticalScrollBarPageButtonDisabled" EndPoint="1, 0" StartPoint="0, 0">
        <GradientStop Color="#EEEDE5" Offset="0"/>
        <GradientStop Color="#EEEDE5" Offset="0.05"/>
        <GradientStop Color="#F3F1EC" Offset="0.06"/>
        <GradientStop Color="#FEFEFE" Offset="0.94"/>
        <GradientStop Color="#EEEDE5" Offset="0.95"/>
        <GradientStop Color="#EEEDE5" Offset="1"/>
    </LinearGradientBrush>
    <Style x:Key="VerticalScrollBarPageButton" TargetType="{x:Type RepeatButton}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Focusable" Value="false"/>
        <Setter Property="IsTabStop" Value="false"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type RepeatButton}">
                    <Rectangle x:Name="Bg" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" Fill="{TemplateBinding Background}"/>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsPressed" Value="true">
                            <Setter Property="Fill" TargetName="Bg" Value="{StaticResource VerticalScrollBarPageButtonPressed}"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="false">
                            <Setter Property="Fill" TargetName="Bg" Value="{StaticResource VerticalScrollBarPageButtonDisabled}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style x:Key="ScrollBarThumb" TargetType="{x:Type Thumb}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="IsTabStop" Value="false"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Thumb}">
                    <Microsoft_Windows_Themes:ScrollChrome SnapsToDevicePixels="true" x:Name="Chrome" RenderMouseOver="{TemplateBinding IsMouseOver}" RenderPressed="{TemplateBinding IsDragging}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="{TemplateBinding Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph}" ThemeColor="Metallic"/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <LinearGradientBrush x:Key="HorizontalScrollBarPageButtonNormal" EndPoint="0, 1" StartPoint="0, 0">
        <GradientStop Color="#EEEDE5" Offset="0"/>
        <GradientStop Color="#EEEDE5" Offset="0.05"/>
        <GradientStop Color="#F3F1EC" Offset="0.06"/>
        <GradientStop Color="#FEFEFE" Offset="0.94"/>
        <GradientStop Color="#EEEDE5" Offset="0.95"/>
        <GradientStop Color="#EEEDE5" Offset="1"/>
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="HorizontalScrollBarPageButtonPressed" EndPoint="0, 1" StartPoint="0, 0">
        <GradientStop Color="#D7D5C2" Offset="0"/>
        <GradientStop Color="#D7D5C2" Offset="0.05"/>
        <GradientStop Color="#E3DED3" Offset="0.06"/>
        <GradientStop Color="#FDFDF6" Offset="0.94"/>
        <GradientStop Color="#D7D5C2" Offset="0.95"/>
        <GradientStop Color="#D7D5C2" Offset="1"/>
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="HorizontalScrollBarPageButtonDisabled" EndPoint="0, 1" StartPoint="0, 0">
        <GradientStop Color="#EEEDE5" Offset="0"/>
        <GradientStop Color="#EEEDE5" Offset="0.05"/>
        <GradientStop Color="#F3F1EC" Offset="0.06"/>
        <GradientStop Color="#FEFEFE" Offset="0.94"/>
        <GradientStop Color="#EEEDE5" Offset="0.95"/>
        <GradientStop Color="#EEEDE5" Offset="1"/>
    </LinearGradientBrush>
    <Style x:Key="HorizontalScrollBarPageButton" TargetType="{x:Type RepeatButton}">
        <Setter Property="OverridesDefaultStyle" Value="true"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="Focusable" Value="false"/>
        <Setter Property="IsTabStop" Value="false"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type RepeatButton}">
                    <Rectangle x:Name="Bg" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" Fill="{TemplateBinding Background}"/>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsPressed" Value="true">
                            <Setter Property="Fill" TargetName="Bg" Value="{StaticResource HorizontalScrollBarPageButtonPressed}"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="false">
                            <Setter Property="Fill" TargetName="Bg" Value="{StaticResource HorizontalScrollBarPageButtonDisabled}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style x:Key="ScrollBarStyle1" TargetType="{x:Type ScrollBar}">
        <Setter Property="Stylus.IsPressAndHoldEnabled" Value="false"/>
        <Setter Property="Stylus.IsFlicksEnabled" Value="false"/>
        <Setter Property="Background" Value="{StaticResource VerticalScrollBarPageButtonNormal}"/>
        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
        <Setter Property="Width" Value="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}"/>
        <Setter Property="MinWidth" Value="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ScrollBar}">
                    <Grid SnapsToDevicePixels="true" Background="{TemplateBinding Background}">
                        <Grid.RowDefinitions>
                            <RowDefinition MaxHeight="{DynamicResource {x:Static SystemParameters.VerticalScrollBarButtonHeightKey}}"/>
                            <RowDefinition Height="0.00001*"/>
                            <RowDefinition MaxHeight="{DynamicResource {x:Static SystemParameters.VerticalScrollBarButtonHeightKey}}"/>
                        </Grid.RowDefinitions>
                        <RepeatButton Style="{StaticResource ScrollBarButton}" Command="{x:Static ScrollBar.LineUpCommand}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="UpArrow"/>
                        <Track x:Name="PART_Track" Grid.Row="1" IsDirectionReversed="true">
                            <Track.Thumb>
                                <Thumb Style="{StaticResource ScrollBarThumb}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="VerticalGripper"/>
                            </Track.Thumb>
                            <Track.IncreaseRepeatButton>
                                <RepeatButton Style="{StaticResource VerticalScrollBarPageButton}" Command="{x:Static ScrollBar.PageDownCommand}"/>
                            </Track.IncreaseRepeatButton>
                            <Track.DecreaseRepeatButton>
                                <RepeatButton Style="{StaticResource VerticalScrollBarPageButton}" Command="{x:Static ScrollBar.PageUpCommand}"/>
                            </Track.DecreaseRepeatButton>
                        </Track>
                        <RepeatButton Style="{StaticResource ScrollBarButton}" Command="{x:Static ScrollBar.LineDownCommand}" Grid.Row="2" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="DownArrow"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Style.Triggers>
            <Trigger Property="Orientation" Value="Horizontal">
                <Setter Property="Width" Value="Auto"/>
                <Setter Property="MinWidth" Value="0"/>
                <Setter Property="Background" Value="{StaticResource HorizontalScrollBarPageButtonNormal}"/>
                <Setter Property="Height" Value="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarHeightKey}}"/>
                <Setter Property="MinHeight" Value="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarHeightKey}}"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ScrollBar}">
                            <Grid SnapsToDevicePixels="true" Background="{TemplateBinding Background}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition MaxWidth="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarButtonWidthKey}}"/>
                                    <ColumnDefinition Width="0.00001*"/>
                                    <ColumnDefinition MaxWidth="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarButtonWidthKey}}"/>
                                </Grid.ColumnDefinitions>
                                <RepeatButton Style="{StaticResource ScrollBarButton}" Command="{x:Static ScrollBar.LineLeftCommand}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="LeftArrow"/>
                                <Track x:Name="PART_Track" Grid.Column="1">
                                    <Track.Thumb>
                                        <Thumb Style="{StaticResource ScrollBarThumb}" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="HorizontalGripper"/>
                                    </Track.Thumb>
                                    <Track.IncreaseRepeatButton>
                                        <RepeatButton Style="{StaticResource HorizontalScrollBarPageButton}" Command="{x:Static ScrollBar.PageRightCommand}"/>
                                    </Track.IncreaseRepeatButton>
                                    <Track.DecreaseRepeatButton>
                                        <RepeatButton Style="{StaticResource HorizontalScrollBarPageButton}" Command="{x:Static ScrollBar.PageLeftCommand}"/>
                                    </Track.DecreaseRepeatButton>
                                </Track>
                                <RepeatButton Style="{StaticResource ScrollBarButton}" Command="{x:Static ScrollBar.LineRightCommand}" Grid.Column="2" Microsoft_Windows_Themes:ScrollChrome.ScrollGlyph="RightArrow"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Trigger>
        </Style.Triggers>
    </Style> 
```

用于此的命名空间是这样的（添加到文件顶部）：-

```
 xmlns:Microsoft_Windows_Themes="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Luna" 
```

然后，您显然可以根据自己的喜好更改生成的样式

您需要以编程方式找到嵌入在控件中的滚动条，或者通过更改样式定义将样式应用于范围内的所有滚动条，因此：-

```
 <Style x:Key="ScrollBarStyle1" TargetType="{x:Type ScrollBar}">
    ...
  </Style> 
```

变成

```
 <Style TargetType="{x:Type ScrollBar}">
    ...
  </Style> 
```

这样它将应用于样式定义的区域中的所有滚动条。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T03:29:40.333

您可能还想看看[snoop](http://blois.us/Snoop/)和[style snooper](http://wpfwonderland.wordpress.com/2007/01/02/wpf-tools-stylesnooper/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T17:04:46.930

您必须创建一个控件模板来重新设置您想要的控件部分的样式。

看看这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/cc278073(VS.95).aspx)和[这篇](http://msdn.microsoft.com/en-us/library/ms753256.aspx)应该对你有帮助的文章。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T11:10:05.457

一个很好的 MSDN 文章提供了所有 WPF 控件的控件模板，可以在这里找到：

[http://msdn.microsoft.com/en-us/library/aa970773.aspx](http://msdn.microsoft.com/en-us/library/aa970773.aspx)

请记住，这些控件模板在视觉上生成相同的控件（即：这些是 WPF 使用的控件模板）。但这是自定义控件的可视化树的一个很好的起点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-01-09T13:05:05.503

这是一个简单快捷的方法：

```
<Slider ...>
    <Slider.LayoutTransform>
         <ScaleTransform CenterX="0" CenterY="0" ScaleX="1" ScaleY="0.5"/>
    </Slider.LayoutTransform>
</Slider> 
```

这不是完全 8 像素，但您可以使用 ScaleY 属性进行一些操作，直到获得所需的大小。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-27T06:21:03.443

只是一个概念证明，您也可以为像滑块这样的复合控件的单个部分设置样式：但要注意，颜色的选择是相当随机的，所以这会很丑陋。不幸的是，如果您忽略滑块的自定义样式，拇指样式将不起作用。

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Grid>
    <Grid.Resources>
      <ResourceDictionary>
        <Style TargetType="{x:Type Slider}">
          <Setter Property="Background" Value="Green"/>
          <Setter Property="BorderBrush" Value="Navy"/>
          <Setter Property="Template">
            <Setter.Value>
              <ControlTemplate TargetType="{x:Type Slider}">
                <Grid x:Name="GridRoot">
                  <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                  </Grid.RowDefinitions>
  <!-- TickBar shows the ticks for Slider -->
                  <TickBar x:Name="TopTick" Height="4" Fill="Blue" Placement="Top" SnapsToDevicePixels="True" Visibility="Collapsed"/>
                  <Border x:Name="Border" Height="4" Grid.Row="1" Margin="0" Background="Blue" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="2"/>
  <!-- The Track lays out the repeat buttons and thumb -->
                  <Track x:Name="PART_Track" Grid.Row="1">
                    <Track.Thumb>
                      <Thumb MinWidth="15" MinHeight="30"/>
                    </Track.Thumb>
                    <Track.IncreaseRepeatButton>
                      <RepeatButton Command="Slider.IncreaseLarge"/>
                    </Track.IncreaseRepeatButton>
                    <Track.DecreaseRepeatButton>
                      <RepeatButton Command="Slider.DecreaseLarge"/>
                    </Track.DecreaseRepeatButton>
                  </Track>
                  <TickBar x:Name="BottomTick" Height="4" Grid.Row="2" Fill="{TemplateBinding Foreground}" Placement="Bottom" SnapsToDevicePixels="True" Visibility="Collapsed"/>
                </Grid>
              </ControlTemplate>
            </Setter.Value>
          </Setter>
        </Style>
      </ResourceDictionary>
    </Grid.Resources>
    <Slider Maximum="100" Minimum="0">
      <Slider.Resources>
        <Style TargetType="{x:Type Thumb}">
          <Setter Property="Background" Value="Yellow"/>
          <Setter Property="Height" Value="80"/>
        </Style>
      </Slider.Resources>
    </Slider>
  </Grid>
</Page> 
```

# java - 使用嵌入式 Java 数据库处理来自 Web 的 CSV 文件

> ID：383260
> 
> 赞同：0
> 
> 时间：2008-12-20T12:24:26.310
> 
> 标签：java, csv, hsqldb, data-processing

简短版本：假设我不想长时间保留数据，如何在 HSQLDB 中以编程方式创建数据库并将一些 CSV 数据加载到其中？我的架构将与文件完全匹配，并且文件确实有足够的列名。

这是一个无人看管的过程。

细节：

我需要对通过网络下载的三个 CSV 文件应用一些简单的 SQL 技术，然后创建一些 DTO，然后我可以使用这些 DTO 与一些现有代码一起处理它们，并通过 REST 保存它们。我真的不想搞乱数据库，但 CSV 文件是通过外键链接的，所以我正在考虑使用内存中的嵌入式数据库来完成这项工作，然后把所有东西都扔掉。

我想到了一个像这样工作的命令行应用程序：

1.  在 HSQLDB 中创建一个新的数据库。
2.  使用 Apache HttpClient 在三个线程中启动三个 HTTP GET。
3.  将 CSV 导入三个 HSQLDB MEMORY 表。
4.  运行一些 SQL。
5.  将结果解析为我现有的 DTO。
6.  ETC...

我可以使用对第 1 项和第 3 项有帮助的代码和实用程序的指针。还有我应该考虑的 HSQLDB 的替代方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2018-12-20T16:49:16.540

要使用的命令行应用程序是随 HSQLDB 提供的 SqlTool 实用程序 jar。您的程序可以完成如下：

1.  创建一个新的 HSQLDB 内存数据库（只需连接到内存数据库）。
2.  使用 Apache HttpClient 启动三个 HTTP GET 以获取 CSV 文件。
3.  创建三个 HSQLDB TEXT 表并将这些表的 SOURCE 设置为 CSV
4.  运行一些 SQL。将结果解析为现有的 DTO。

提出问题时，无法在纯内存表中创建 TEXT 表。现在 HSQLDB 2.x 版本完全支持它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T12:30:29.010

检查[opencvs](http://opencsv.sourceforge.net/)。它可以帮助您解析 CSV 文件。

# .net - IList 的 IndexOutOfRangeException

> ID：383291
> 
> 赞同：0
> 
> 时间：2008-12-20T13:01:05.360
> 
> 标签：.net, arrays, exception

我正在实现一个列表，我想知道 IndexOutOfRange 的定义。您认为以下哪一项更好？

```
/// <exception cref="IndexOutOfRangeException">if index is less than 0
/// or greater than <see cref="Count"/>
public T this[int index] { get { return myArray[index]; } } 
```

或者

```
/// <exception cref="IndexOutOfRangeException">if index outside the valid range
/// for an array of length equal to <see cref="Count"/></exception>
public T this[int index] { get { return myArray[index]; } } 
```

我正在考虑从 .NET 语言中使用此类的情况，该语言从 1 开始索引数组。我对此主题了解不多，但第二个版本是否比第一个版本更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T13:12:10.627

**有点 OT：**你能封装一个列表而不是一个数组，然后一切都消失了，因为封装的列表会产生适当的异常？

**编辑：**如果您确实需要内部数组，如何*将其包装在访问器内的列表中*，然后按索引选择。这样，从列表索引到数组索引的转换发生在组件的语言内部，*而*不是调用者的语言中。

大概列表索引的语义不会在 .Net 语言中发生变化？这是您的组件应该遵循的，因为它实现了列表接口。

**再次编辑：**实际上，*这是一个问题吗？*

人们通过访问器访问您的数组，该访问器是用您控制的语言编写的，因此知道数组索引从哪里开始。即使您从 VB.Net 调用者调用（比如说）C# 类，访问器仍将使用 C# 的数组索引概念，不是吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T13:11:00.927

是否有可能你也可以有一个“基础”属性，那么你可以说：

```
/// <exception cref="IndexOutOfRangeException">if index is less than <see cref="Base" /> 
```

如果你不能有一个 Base 属性，那么第二个版本会更好，如果你必须小心基于 1 的数组。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T13:12:55.993

IList<T> 已经[记录](http://msdn.microsoft.com/en-us/library/ewthkb10.aspx)了异常（ArgumentOutOfRangeException，而不是 IndexOutOfRangeException）。如果您正在实现接口而不更改记录的行为，为什么需要记录它？如果你要记录它，它应该与界面一致。

**编辑：** 刚刚注意到你的实现（或者至少是你的实现命名的含义）。我同意@Dan，您真的应该将它基于 List<T> 而不是数组，以便实现与接口一致。在这种情况下，无需重新记录异常。如果您不更改底层实现，那么您应该捕获 IndexOutOfRangeException 并将其映射到接口记录的 ArgumentOutOfRangeException。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T13:32:47.090

顺便说一句- 你总是可以简单地继承`Collection<T>`作为起点......这提供了原始代码，同时让你自定义事物。您可以从 继承`List<T>`，但不像`Collection<T>`在 上没有有用的`virtual`方法`List<T>`。

# initialization - pthread_mutex_t 初始化错误

> ID：383293
> 
> 赞同：5
> 
> 时间：2008-12-20T13:04:49.597
> 
> 标签：initialization, pthreads, mutex

我在老虎上使用 xcode 2.4.1。当我在下面做的时候一切都好。当我做

```
pthread_mutex_t mute;
ImageMan()
{
    dibSize=0;
    mute  = PTHREAD_MUTEX_INITIALIZER;
} 
```

我得到这两个错误

```
error: expected primary-expression before '{' token
error: expected `;' before '{' token 
```

我不知道为什么。但是，如果我这样做 pthread_mutex_t 静音 = PTHREAD_MUTEX_INITIALIZER; 它工作正常。为什么？

-edit- 我还没有运行它，但这似乎可以编译。为什么？嗯？

```
 pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
    mute = mutex; 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-20T13:54:49.887

`PTHREAD_MUTEX_INITIALIZER`是一个常量初始化器，仅在初始化时有效。它是一个不一定扩展为整数类型的宏。

你`mute=mutex;`的无效 - 你应该使用：

```
pthread_mutex_init(&mute, NULL); 
```

或者如果您正在动态分配互斥锁：

```
m = malloc(sizeof(pthread_mutex_t)));
pthread_mutex_init(m, NULL); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-07-10T06:11:05.553

```
mute = (pthread_mutex_t)PTHREAD_MUTEX_INITIALIZER; 
```

这是此错误的另一种解决方案。

# iphone - 如何在 UIScrollView 中取消滚动

> ID：383306
> 
> 赞同：16
> 
> 时间：2008-12-20T13:18:31.380
> 
> 标签：iphone, cocoa-touch, uiscrollview

我使用 UIScrollView 在 iPhone 上制作大尺寸（大于 320 像素）的 UI。

我创建了一个 UIScrollView 实例并在其上添加了一些子视图。问题是我只想在用户触摸子视图外部时启用滚动，当用户触摸子视图之一时停止滚动。

我阅读了文档并试图找到样本，但找不到好的提示。如果您有任何想法，请帮助我。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-20T13:32:50.617

UIScrollView 有一个*scrollEnabled*属性，允许您以编程方式禁用滚动。它还有一个委托 (UIScrollViewDelegate)，允许您查看诸如滚动开始/结束之类的事件。似乎您应该能够以某种方式将这些选项组合起来。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-09-28T05:45:29.273

你真正感兴趣的属性——实际上我现在正在测试它，因为我遇到了同样的问题——是`canCancelContentTouches`.

> 如果此属性的值为 NO，则一旦内容视图开始跟踪，无论手指移动如何，滚动视图都不会滚动。

如果这不能为您提供所需的结果，请将 UIScrollView 子类化并覆盖该`touchesShouldBegin:withEvent:inContentView`方法，这是公认的答案所暗示的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-25T06:07:29.780

如果您想检测 UIScrollView 的任何子视图内的触摸，您必须继承 UIScrollView 并覆盖专门为此目的创建的`touchesShouldBegin`和方法。`touchesShouldCancelInContentView`

除此之外，您无法识别子视图中的触摸，因为 UIScrollView 倾向于自行处理所有触摸并且不会将它们传递给其子视图。

祝一切顺利。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-21T12:22:02.070

最简单的方法是设置`delaysContentTouches`为`NO`滚动视图。这样就设置了默认行为，以便 UIControl 的任何内容都会立即将触摸传递给控件，​​而其他所有内容都会滚动。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-23T17:21:27.813

您还可以子类化 UIScrollViewController 并覆盖 touchesBegan、touchesMoved 和 touchesEnded 方法。如果您的实现从不调用超类实现，则它不会滚动。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-04-08T21:38:17.150

我的问题是有一个用户可以绘制的视图，但滚动视图劫持了触摸和滚动而不是绘制。这是我的工作解决方案：

在我的绘图视图中，我有：

```
override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {

    // Disable scroll on touch begin
    setContainerScrollingEnabled(false)
    super.touchesBegan(touches, with: event)
}

override func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent?) {

    // Reenable scroll on touch end
    setContainerScrollingEnabled(true)
    super.touchesEnded(touches, with: event)
}

private func setContainerScrollingEnabled(_ enabled: Bool) {

    // loop up superviews to find the scrollview
    func scrollingSuperview(of view: UIView) -> UIScrollView? {
        guard let superview = view.superview else { return nil }
        if let scrolling = view.superview as? UIScrollView { return scrolling }
        return scrollingSuperview(of: superview)
    }

    // and switch on/off scrolling
    let scrollView = scrollingSuperview(of: self)
    scrollView?.isScrollEnabled = enabled
} 
```

在包含滚动视图的视图控制器中，我有：

```
// Not sure what exactly this does, but I think it allows the drawing view to have precedence. This was the missing piece of the puzzle.
scrollView.delaysContentTouches = false 
```

# c# - C# 编译问题：1 语句中的换行符导致错误

> ID：383307
> 
> 赞同：0
> 
> 时间：2008-12-20T13:19:15.170
> 
> 标签：c#, compilation, newline

一个简单的问题

考虑 C# 中的这段代码

```
String a;
String b;
String c;

 1\. a =  
 2\. b =
 3\. //Comment
 4\. c = "a String"; 
```

在编译期间，它很好，但是当我运行我的应用程序时遇到了错误。从我的日志中，错误发生在上面。

问题：

错误是由第 3 行的注释引起的吗？

错误是“对象引用未设置为对象的实例”

我猜编译器将上述代码视为 1 语句。

此代码位于 aspx 页面后面的代码中。(aspx.cs)

//背景故事//

该 aspx 在测试服务器中进行了测试，并且是文件。然而，在我们将页面部署到生产服务器后，pageload() 处出现错误，发生错误的行在我上面代码示例的第 1 行。

我只是怀疑该错误是由评论引起的。

我对吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T13:26:33.610

您的原始代码不合法​​。您编辑的代码很好；所有 3 个变量都分配了相同的字符串（“a String”）。

你看到了什么*确切的错误？*

* * *

（更新的问题包括“对象引用未设置为对象的实例”）

此错误与发布的代码无关（除非您在粘贴代码时错误地表示代码），与`//`评论无关。你需要去别处看看。尝试查看堆栈跟踪，或注入调试/输出消息。或者只是单步执行代码以查看它实际崩溃的位置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T13:33:34.157

编译器会忽略第 3 行中“//”右侧的所有内容，但第 1、2 和 4 行仍然是同一语句的一部分（以及第 4 行以下的任何内容，直到到达“;”或块） .

除非您的示例代码在发布时丢失了某些内容，否则此代码甚至不应该编译（解析错误）。

* * *

好的，使用您编辑的代码，语法是有效的，不应该是您的错误的原因。请发布错误...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T13:27:59.067

当你重写它时它是否有效

```
a = b = c = "a String"; 
```

? 如果是这样，很清楚是什么导致了您的问题；）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T14:45:43.793

您的代码中没有错误。它运行良好。如果您看到错误，则它在其他地方。

# wpf - WPF - 如何显示 Web 浏览器控件的加载消息

> ID：383314
> 
> 赞同：1
> 
> 时间：2008-12-20T13:25:22.833
> 
> 标签：wpf

我有一个带有 2 列网格的窗口。左列包含一个浏览器控件

我想显示一个小窗口或其他东西来显示网页仍在加载。

我怎么能这样做？我可以在浏览器前面显示的第二列中有一个浮动窗口吗？？？请解释一下如何？

马尔科姆

感谢本德威的作品就像一个魅力。唯一的事情是找不到我可以使用的 GIF，它会显示一些移动/旋转或类似的东西来覆盖任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T20:33:16.913

我实现这一点的方法是使用公开的 Show() 和 Hide() 方法创建用户控件。下面是代码。加载.xaml：

```
<UserControl x:Class="UK.Budgeting.XBAP.Loading"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Height="200">
  <UserControl.Resources>
    <Color x:Key="FilledColor" A="255" B="155" R="155" G="155"/>
    <Color x:Key="UnfilledColor" A="0" B="155" R="155" G="155"/>

    <Storyboard x:Key="Animation0" FillBehavior="Stop" BeginTime="00:00:00.0" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_00" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation1" BeginTime="00:00:00.2" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_01" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation2" BeginTime="00:00:00.4" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_02" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation3" BeginTime="00:00:00.6" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_03" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation4" BeginTime="00:00:00.8" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_04" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation5" BeginTime="00:00:01.0" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_05" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation6" BeginTime="00:00:01.2" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_06" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>

    <Storyboard x:Key="Animation7" BeginTime="00:00:01.4" RepeatBehavior="Forever">
      <ColorAnimationUsingKeyFrames Storyboard.TargetName="_07" Storyboard.TargetProperty="(Shape.Fill).(SolidColorBrush.Color)">
        <SplineColorKeyFrame KeyTime="00:00:00.0" Value="{StaticResource FilledColor}"/>
        <SplineColorKeyFrame KeyTime="00:00:01.6" Value="{StaticResource UnfilledColor}"/>
      </ColorAnimationUsingKeyFrames>
    </Storyboard>
  </UserControl.Resources>

  <UserControl.Triggers>
    <EventTrigger RoutedEvent="FrameworkElement.Loaded">
      <BeginStoryboard Storyboard="{StaticResource Animation0}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation1}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation2}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation3}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation4}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation5}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation6}"/>
      <BeginStoryboard Storyboard="{StaticResource Animation7}"/>
    </EventTrigger>
  </UserControl.Triggers>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="*"/>
      <RowDefinition Height="100"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="Auto"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <Canvas Grid.Row="1" Grid.Column="1" Height="105" Width="105">
      <Canvas.Resources>
        <Style TargetType="Ellipse">
          <Setter Property="Width" Value="15"/>
          <Setter Property="Height" Value="15" />
          <Setter Property="Fill" Value="#FFFFFFFF" />
        </Style>
      </Canvas.Resources>
      <Ellipse x:Name="_00" Canvas.Left="24.75" Canvas.Top="50"/>
      <Ellipse x:Name="_01" Canvas.Top="36" Canvas.Left="29.5"/>
      <Ellipse x:Name="_02" Canvas.Left="43.5" Canvas.Top="29.75"/>
      <Ellipse x:Name="_03" Canvas.Left="57.75" Canvas.Top="35.75"/>
      <Ellipse x:Name="_04" Canvas.Left="63.5" Canvas.Top="49.75" />
      <Ellipse x:Name="_05" Canvas.Left="57.75" Canvas.Top="63.5"/>
      <Ellipse x:Name="_06" Canvas.Left="43.75" Canvas.Top="68.75"/>
      <Ellipse x:Name="_07" Canvas.Top="63.25" Canvas.Left="30" />
      <Ellipse Stroke="{x:Null}" Width="39.5" Height="39.5" Canvas.Left="31.75" Canvas.Top="37" Fill="{x:Null}"/>
    </Canvas>
    <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Foreground="#AAA" TextAlignment="Center" FontSize="15" Text="{Binding Source={StaticResource Model}, Path=StatusMessage}"/>
  </Grid>

</UserControl> 
```

加载.xaml.cs：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;

namespace UK.Budgeting.XBAP
{
    /// <summary>
    /// Interaction logic for Loading.xaml
    /// </summary>
    public partial class Loading : UserControl
    {
        public Loading()
        {
            InitializeComponent();
        }
        public void Show()
        {
            this.Visibility = Visibility.Visible;
        }
        public void Hide()
        {
            this.Visibility = Visibility.Hidden;
        }
    }
} 
```

要使用，请在您的主页中进行参考：

```
<local:Loading x:Name="LoadingAnimation" Visibility="Hidden" /> 
```

并从代码调用：

```
LoadingAnimation.Show();
LoadingAnimation.Hide(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T03:20:15.987

我不确定显示“小窗口”是什么意思。您是指弹出窗口还是显示在浏览器顶部的元素，例如叠加层。如果您的意思是覆盖元素，您可以使用 webbrowser Navigating 和 LoadCompleted 事件来显示和隐藏该元素。

有多种方法可以定位元素，它取决于父控件。如果您使用的是 Grid 控件，那么只需将加载元素放在浏览器控件下方，它会在可见时显示在顶部。

覆盖控件时需要指出的几件事。仅将不透明度更改为 0 将不起作用，您需要将可见性设置为隐藏，否则您的浏览器控件上的事件将不会触发。另请记住，如果您将属性设置为使用动画淡出/淡入，则必须将其清除。请参阅[Josh Smiths 的帖子](http://joshsmithonwpf.wordpress.com/2008/08/21/removing-the-value-applied-by-an-animation/)。

回复时只需修改您的原始帖子。您可能需要考虑添加 XAML 以帮助解释您的计划。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T04:34:44.510

我找到了一个gif创作者。

唯一的问题是浏览器加载时 gif 不会移动。

我猜这是一些线程问题。

你会怎么做？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T03:12:14.660

感谢您的帖子。

我当然意识到我不需要 GIF 只是一个 WPF 动画。

所以我只是用我找到的 gif 对图像进行了旋转变换。

奇迹般有效

# asp.net-mvc - ActionLinks 在 FireFox 和 Safari 中并不总是有效

> ID：383320
> 
> 赞同：2
> 
> 时间：2008-12-20T13:28:43.807
> 
> 标签：asp.net-mvc, css, firefox, safari, actionlink

我最近一直在学习新的 ASP.NET MVC 框架，并且我为在瑞典经营一家“轻咖啡馆”的朋友开发了一个测试站点。计划是在进行一些最终调整并修复一些安全问题后，在一周左右的时间内发布它。

昨天我将该网站发布到运行 IIS 6 的虚拟主机上，所以我要做的第一件事就是解决无扩展 URL 的问题。我在 Phil Haack 的博客文章[ASP.NET MVC on IIS 6 Walkthrough的帮助下做到了这一点](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)

现在我遇到了另一个在 IE7 中运行良好但在 Firefox 3 和 Safari 中运行良好的问题。

在该站点上，我使用包含带有菜单的“左侧内容”的母版页。该菜单由 ActionLinks 组成。问题是只有第一个（最上面的）链接作为链接起作用，其他的只是看起来像链接，但它们是不可点击的。当我查看源代码时，一切看起来都很好。

有没有人遇到过解决此问题的解决方案，或者您是否知道可能导致此行为的原因？演示站点的链接是[演示站点](http://www.tarsius.se)

非常感谢您的帮助，因为我希望它适用于所有浏览器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T13:54:35.940

您的“主要” div 被放置在“链接” div 的顶部，因此无法单击它们。

添加一个：

浮动：对；

#main 的 CSS 允许单击链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T14:10:36.610

我会检查你的css文件。如果您从包含中删除您的 css 文件，我认为您的链接将起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T14:25:57.920

只需删除 #main 中的 position: relative 即可

# oracle - Oracle 修改语句 - 错误

> ID：383321
> 
> 赞同：1
> 
> 时间：2008-12-20T13:28:44.043
> 
> 标签：oracle

我在表中添加了一个新列。

```
ALTER TABLE neue_buch modify preis not null; 
```

我有这个错误：

```
Error starting at line 40 in command:
ALTER TABLE neue_buch
modify preis not null
Error report:
SQL Error: ORA-02296: cannot enable (S1885872.) - null values found
02296\. 00000 - "cannot enable (%s.%s) - null values found"
*Cause:    an alter table enable constraint failed because the table
           contains values that do not satisfy the constraint.
*Action:   Obvious 
```

我的修改声明有什么问题。？

提前谢谢了，

魔都

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T13:39:22.117

`NEUE_BUCH`错误消息告诉您该`PREIS`列为 NULL的某些行。您需要先将这些行修改为具有非 NULL 值，然后才能创建此 NOT NULL 约束。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-27T04:38:03.160

你有两个选择：

1.  删除 NULL - 例如更新为 NULL 的行以具有某些值；或删除行。

2.  使约束对现有数据不进行验证 - 这将导致约束仅对新插入或更新的行失败。

    ```
    ALTER TABLE neue_buch MODIFY preis NOT NULL NOVALIDATE; 
    ```

两种方法都有优点和缺点。选项 1 的性能更好，因为 CBO 在优化查询时可以依赖约束。但是，如果您根本*不知道*NULL 应该是什么，您可能会想用“空值指示符”（即魔术值）替换它们 - 例如，对于只有正整数的列，您可以替换NULL 带有 -1 或其他东西 - 但这有其自身的缺点。在这种情况下，选项 2 可能更可取，以避免必须使用魔法值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T18:04:17.027

ALTER TABLE AG_PARTICELLE_AZIENDA 修改 SEZIONE NOT NULL；ORA-02296: 不可能的能力 (TRACKER.) - trovati valori non appropriati

nella tabella AG_PARTICELLE_AZIENDA alcuni valori di SEZIONE sono 一个空！

德沃票价：

1) 更新 AG_PARTICELLE_AZIENDA 设置 sezione = null;

2）提交；

3）ALTER TABLE AG_PARTICELLE_AZIENDA MODIFY SEZIONE NOT NULL；

non ho capito il messaggio di errore！qualcquno può aiutarmi? grazie ugo montorsi 邮件：ugo.montorsi@sin.it

# c# - 如何确保所有数据都已物理写入磁盘？

> ID：383324
> 
> 赞同：23
> 
> 时间：2008-12-20T13:32:06.047
> 
> 标签：c#, .net, filestream, flush

我了解 .NET FileStream 的 Flush 方法仅将当前缓冲区写入磁盘，但取决于 Windows 的磁盘驱动程序和硬盘固件，这不能保证数据实际上是物理写入磁盘的。

有没有 .NET 或 Win32 方法可以给我这个保证？所以如果在调用这个方法回来后一纳秒掉电，我仍然可以确定一切正常吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2010-10-21T22:14:20.080

Stefan S. 说：

> 我了解.NET FileStream 的 Flush 方法仅将当前缓冲区写入磁盘

不，.NET FileStream 的 Flush 仅将 .NET 缓冲区写入操作系统缓存，它不会将操作系统缓存刷新到磁盘。遗憾的是，这门课上的 MSDN 文档并没有这么说。对于 .NET < 4.0，您必须调用 Flush + Win32 的 FlushFilebuffers：

```
using System.Runtime.InteropServices;
. . .

// start of class:
[DllImport("kernel32", SetLastError=true)]
private static extern bool FlushFileBuffers(IntPtr handle);
. . .

stream.Flush();     // Flush .NET buffers to OS file cache.
#pragma warning disable 618,612 // disable stream.Handle deprecation warning.
if (!FlushFileBuffers(stream.Handle))   // Flush OS file cache to disk.
#pragma warning restore 618,612
{
  Int32 err = Marshal.GetLastWin32Error();
  throw new Win32Exception(err, "Win32 FlushFileBuffers returned error for " + stream.Name);
} 
```

对于 .NET 4.0，您可以改用新的 flush(true) 方法。2012 年 11 月 9 日更新：[这里](http://connect.microsoft.com/VisualStudio/feedback/details/634385/filestream-flush-flushtodisk-true-call-does-not-flush-the-buffers-to-disk#details)的 MS 错误报告说它已损坏，然后修复，但没有说明它是在哪个版本或服务包中修复的！听起来错误是如果内部 .NET FileStream 缓冲区为空，则 Flush(true) 什么也没做？

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-20T13:36:34.697

在 Windows 下，查看[FlushFileBuffers](http://msdn.microsoft.com/en-us/library/aa364439(v=vs.85).aspx) (Win32 API)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T13:33:50.770

好吧，你可以关闭文件......这可能会做到。实际上，随着 HAL 抽象、虚拟化和磁盘硬件现在比几年前的*计算机拥有更多的处理能力和缓存内存，您将不得不希望磁盘能够完成它的工作。*

事务文件系统从未真正实现过；-p 当然，您也许可以考虑使用数据库作为后端，并使用其中的事务系统？

另外：请注意，并非所有流甚至都保证`Flush()`- 例如，`GZipStream`等即使在刷新之后仍保留未提交数据的工作缓冲区 - 让它刷新*所有内容*的唯一方法就是`Close()`它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-05-18T23:01:40.947

我注意到 .NET 4 #Flush(true) 实际上并没有写入磁盘。我们遇到了数据损坏的奇怪问题，我在 MS 网站上发现了这个[错误报告：](http://connect.microsoft.com/VisualStudio/feedback/details/634385/filestream-flush-flushtodisk-true-call-does-not-flush-the-buffers-to-disk#details)

错误报告的详细信息选项卡有一个您可以运行的测试程序来显示问题；

1.  将一堆数据写入磁盘
2.  `fs.Flush(true)`. 这不需要时间（比可能写入磁盘的速度要快得多）。
3.  使用 win32 API `FlushFileBuffers`。这需要很长时间。

我正在切换到 win32 FlushFileBuffers 调用...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-21T14:23:57.153

在文件系统缓存中缓冲的文件数据要写入磁盘。该数据通常是延迟写入的，基于磁盘写入头的位置。拥有千兆字节的缓存数据在技术上是可行的，因此可能需要相当长的时间。如果这对您很重要，那么请考虑使用该`FileOptions.WriteThrough`选项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-15T13:09:52.113

> 将缓冲区的内容刷新到磁盘有一个简单的答案。在您的 WriteAllText 函数之后，打开文件，关闭它，然后重置它
> 
> 这是一个例子

```
My.Computer.FileSystem.WriteAllText(yourfilename, "hello", False, System.Text.Encoding.ASCII)
FileOpen(1, yourfilename, OpenMode.Input)
FileClose(1)
Reset() 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-12-20T19:05:10.603

抽象级别太多了，无法绝对确保将数据写入磁盘，一直到硬件级别。

不是出色的性能或万无一失，但是一旦在单独的过程中写入文件并检查大小或内容，如何重新打开文件？

# c# - 重载构造函数和重用代码

> ID：383347
> 
> 赞同：5
> 
> 时间：2008-12-20T14:02:57.607
> 
> 标签：c#, oop, constructor

假设我有一个`Customer`具有几个属性 ( `ID`, `FirstName`, `LastName`) 的对象。我有默认构造函数`Customer()`，但我也有一个`Customer(DataRow dr)`，因为我从数据库加载这个对象，这是一种简单的方法。

我经常遇到想要设置另一个构造函数的情况，`Customer(int ID)`有时我想加载 a`Customer`但我还没有访问数据库。对我来说最简单的方法似乎是这样的：

```
Customer(int ID)
{
    DataTable dt = DataAccess.GetCustomer(ID);
    if (dt.Rows.Count > 0)
    {
        // pass control to the DataRow constructor at this point?
    }
    else
    {
        // pass control to the default constructor at this point?
    }   
} 
```

重用已经存在于 DataRow 构造函数中的代码是有意义的，但是我想不出一种方法来调用它并返回它给我的东西。通过谷歌搜索，我找到了有关使用`: this()`语法重载构造函数的信息，但所有这些示例似乎都与我正在尝试做的事情背道而驰或不兼容。

所以我对构造函数的理解存在差距，但我似乎无法理清。我错过了什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-20T14:06:13.700

最简单的解决方案似乎是：构造另一个函数来完成您想做的工作，并让两个构造函数都调用该函数。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-20T14:43:52.347

我担心你没有得到的不是构造函数，而是单一责任原则和松散耦合。

例如，您在上面显示的代码意味着：

*   您的域模型包含数据访问代码
*   您没有重用基类中的任何代码，这些代码可能首先注入了数据访问逻辑
*   您的域对象知道除自身或其成员之外的数据结构，如 DataTable 或 DataRow，这会将其与这些数据结构联系起来，并使其使用其他数据结构变得很麻烦。

当然，这假设您没有使用 ActiveRecord 模型，这似乎是这里的情况，但仍将通过紧密耦合来实现。

我的偏好是域对象将仅包含与持有和操作真实客户数据相关的逻辑，仅此而已。因此，我的构造函数将是：

```
class Customer
{
    public Customer(int id, string firstName, string LastName)
    {
        Id = id;
        FirstName = firstName;
        LastName = lastName;
    }

    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
} 
```

**更新：**话虽这么说，这是一些人更喜欢允许 POCO 的 ORM 的主要原因，例如 NHibernate：不需要将数据加载逻辑放在那里。

例如，如果这是在 NHibernate 中完成的，您将需要一个 DomainObject 基类：

```
public class Customer : DomainObject 
```

NHibernate 的 IRepository 的实现又可以使用它：

```
public class Repository<T> : IRepository where T : DomainObject 
```

该`Repository`对象将包含 CRUD 操作所需的所有代码。

如果您希望坚持使用 ADO.NET，一种可能的解决方案是为所有加载创建 DAL 管理器对象：

```
public class CustomerManager
{
    public IList<Customer> LoadCustomers()
    {
        //load all customers here
        foreach (DataRow dr in dt.Table[0])
        {
             yield return new Customer((int) dr["Id"], dr["FirstName"].ToString(), dr["LastName"].ToString());
        }
    }

    public Customer LoadCustomerByID(int id)
    {
        //load one customer here
        return new Customer((int) dr["Id"], dr["FirstName"].ToString(), dr["LastName"].ToString());
    }
} 
```

当然，这里还有更多的机会可以进一步促进代码重用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T15:24:47.147

拥有许多不同的构造函数，它们都根据参数做完全不同的事情，这通常会使代码难以阅读。一个更好的方法是创建一些静态创建方法，目的是在你的类上[显示名称。](http://xunitpatterns.com/Intent%20Revealing%20Name.html)那么你只有一个构造函数。如果需要，您甚至可以将所有构造函数设为私有。客户端使用静态方法来创建您的类的实例。

所以而不是：

```
Customer c = new Customer(13, "George", "Bush");
Customer c2 = new Customer(12);
Customer c3 = new Customer(GetDataRow(11)); 
```

你得到：

```
Customer c = new Customer(13, "George", "Bush");
Customer c2 = Customer.LoadFromDatabaseId(12);
Customer c3 = Customer.MapFromDataRow(GetDataRow(11)); 
```

您的客户类将如下所示：

```
class Customer
{
    public Customer(int id, string firstName, string lastName)
    {
        //...
    }

    static public Customer MapFromDataRow(DataRow dr)
    {
        return new Customer(
            dr["ID"],
            dr["FirstName"],
            dr["LastName"]);
    }

    static public Customer LoadFromDatabaseId(int id)
    {
        DataTable dt = DataAccess.GetCustomer(ID);
        if (dt.Rows.Count > 0)    
        {
            return MapFromDataRow(dt.Rows[0]);
        }
        else    
        {        
            throw new CustomerNotFoundException(id);                
        } 
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T14:30:04.090

如果你稍微修改你的构造函数，你可以让它按照你想要的方式工作......但是不，没有办法从构造函数的主体内部调用另一个构造函数。但这是你可以做的：

更改采用 DataRows 的构造函数以采用 DataTable 并首先调用默认构造函数：

```
Customer( DataTable dt ) : Customer()
{
    if ( dt != null && dt.Rows.Count > 0 )
    {
        // handle the row that was selected
    }
    else
    {
        throw Exception( "customer not in database" ); // or leave this line out to allow a default customer when they arent in the DB
    }
} 
```

然后修改您的 ID 构造函数：

```
Customer(int ID) : Customer(DataAccess.GetCustomer(ID))
{
    // no code
} 
```

因此，现在将*始终*调用您的默认构造函数，然后如果在数据库中找到客户，您可以使用数据库中的值覆盖默认值。如果客户不在数据库中，您可以抛出异常，或者只允许使用默认值构造客户。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T16:53:54.563

只需使用 this 构造函数语法

```
 public Customer(int ID): this(DataAccess.GetCustomer(ID).Rows[0]) {} 
```

但是如果你传递一个无效的 id（一个不在数据库中），这个构造会抛出一个异常。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-20T14:24:58.267

如果您希望这种新方法能够选择是从检索到的数据行构造客户还是构造未初始化的客户，然后从手头的数据开始设置其数据（例如 ID），我建议使用工厂代替另一个构造函数。一个快速的、类似伪代码的草图将是：

```
Customer ProvideCustomer(int ID)
{
    Customer result; // or initialize to null to signal more work to come
    DataTable dt = DataAccess.GetCustomer(ID);
    if (dt.Rows.Count > 0)
    {
        result = new Customer( dt.getappropriaterow ) // however you choose one
    }
    else
    {
        result = new Customer();
        result.ID = ID;          // whatever other initialization you need
    }
    return result;
} 
```

# c# - ASP.NET 动态数据 - 全球化和本地化

> ID：383356
> 
> 赞同：3
> 
> 时间：2008-12-20T14:20:02.347
> 
> 标签：c#, asp.net

有人知道如何使用动态数据创建多语言 Web 应用程序，并能够根据所选文化以正确的语言显示任何标签或按钮吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-23T11:20:24.690

您可以实现自己`ResourceProviderFactory`的本地化，从您想要的任何地方获取。我们使用字符串作为键来查找本地化：

例如：

```
<asp:Literal Text="<%$ Resources: DBLanguageProvider, Module/Area/HelpMessage %>" runat="server" /> 
```

# ios - 如何将保存的数据重置为默认值？

> ID：383368
> 
> 赞同：6
> 
> 时间：2008-12-20T14:32:48.593
> 
> 标签：ios, cocoa-touch, nsuserdefaults

我正在使用 NSUserDefaults 在我的应用程序上实现保存的数据，如下所示：

```
[[NSUserDefaults standardUserDefaults] registerDefaults:[NSDictionary dictionaryWithObjectsAndKeys:[NSNumber numberWithInt:0],@"mySetting",nil]];
// check
int firstLaunch = [[NSUserDefaults standardUserDefaults] integerForKey:@"mySetting"];
// set
[[NSUserDefaults standardUserDefaults] setInteger:1 forKey:@"mySetting"]; 
```

现在出于开发目的，我希望能够删除保存的数据并返回默认值，而不必每次都删除应用程序并重新安装它。有没有快速的方法来做到这一点？我认为 resetStandardUserDefaults 可以完成这项工作，但事实并非如此。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-20T15:44:01.850

对于您希望恢复为默认值的键，`-removeObjectForKey:`将从应用程序首选项中删除其定义。在所有条件相同的情况下，这意味着后续调用`-<type>ForKey:`将返回注册的默认值。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-04-06T00:39:09.970

以下片段对我有用。

```
NSDictionary *defaultsDict = [[NSUserDefaults standardUserDefaults] dictionaryRepresentation];
for (NSString *key in [defaultsDict allKeys])
    [[NSUserDefaults standardUserDefaults] removeObjectForKey:key];

[[NSUserDefaults standardUserDefaults] synchronize]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T15:49:08.750

您是否尝试在调用重置后重新加载默认值？正如PEZ所说：

例如

```
[NSUserDefaults resetStandardUserDefaults];
[NSUserDefaults standardUserDefaults]; 
```

这将清除标准集中的所有默认值和负载。

如果您只想从您的代码片段中快速获取一个值，那么 Graham 的 -removeObjectForKey 建议更容易。

**编辑：**纠正了我对类方法的滥用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T14:55:49.560

文档对 resetStandardUserDefaults 有这样的说法：

> 随后调用standardUserDefaults 使用标准搜索列表创建一个新的共享用户默认对象。

有了一些积极的（一厢情愿？）的想法，这看起来就是你所需要的。=)

# c++ - 在 C/C++ 中实现跨平台、多线程服务器的最佳方法是什么？

> ID：383371
> 
> 赞同：10
> 
> 时间：2008-12-20T14:39:08.330
> 
> 标签：c++, c, multithreading, network-programming, client-server

与我一起工作的开发团队的一部分人面临着编写服务器以与我们的产品集成的挑战。我们有一些提供 C SDK 的低级传感器设备，我们希望通过网络共享它们以供收集数据的人们使用。听起来很简单，对吧？有人会将传感器设备连接到建筑物一部分的机器并运行我们的服务器，从而与网络的其余部分共享设备。然后客户端将通过我们的应用程序连接到该服务器并从设备收集传感器读数。

我创建了一个简单的、与语言无关的网络协议和一个 Java 参考实现。问题在于创建一个可与仅提供用 C 编写的 SDK 的设备一起使用的实现。我们正在考虑执行以下操作：

1.  创建轮询线程，收集和存储每个连接设备的最新读数。
2.  使用多线程服务器将每个传入连接分离到工作线程。
3.  当工作线程接收到传感器读取请求时，轮询线程收集的最新值将被发送回客户端。

这是很多线程，尤其是在 C 中。所以，回顾一下，一般要求是：

*   在 Windows XP/Vista、Linux 和 OS X 机器上运行
*   用 C 或 C++ 编写，与我们拥有的 C SDK 交互
*   接受可变数量的同时连接（工作线程）
*   必须使用线程，而不是分叉（不想处理另一层 IPC）

谁能建议一个库，最好是一些示例代码来开始使用？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-20T14:57:53.130

我使用[Boost.Thread](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)和[Boost.Asio](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html)在 Windows 和 Linux 系统上构建了一个多线程服务器。这些教程使入门变得容易。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-20T16:04:28.597

编写这样一个服务器的最好方法是不编写一个，重新架构你的系统，这样就没有必要了，和/或重用已经存在的组件。因为：

> 有人会将传感器设备连接到建筑物一部分的机器并运行我们的服务器，从而与网络的其余部分共享设备。

如果您的代码存在漏洞（当您从头开始用 C++ 编写并发明新协议时，它可能会存在漏洞），这也有可能与网络的其他部分共享整个机器。

所以，反过来做。在具有传感器硬件的机器上安装一个简单的客户端，然后始终或定期运行它，并将结果推送（发布）到中央服务器。中央服务器甚至可以是标准的网络服务器。或者它可能是一个数据库。（请注意，这两个都已经写好了 - 不需要重新发明轮子 ;-)

然后，您的应用程序将以您现在想到的相同方式工作，但是它从数据库而不是传感器收集数据。然而，在带有传感器的机器上运行的部分已经从一个多线程自定义服务器的噩梦缩小到一个漂亮的小单线程命令行客户端，它只进行*传出*连接，并且可以从 cron 运行（或在 windows 上等效） ）。

即使您需要实时数据收集（根据您的描述，听起来您不需要），传感器收集器作为客户端而不是服务器仍然可能更好。让它打开与中央收集器（或其中一组）的长期连接，并等待提供其数据的指令。

编辑： ceretullis 和 pukku 的答案表明使用多播对此有一个很好的变化 - 请参阅[此答案](https://stackoverflow.com/questions/383371/what-is-the-best-way-to-implement-a-cross-platform-multi-threaded-server-in-cc#383502)和评论

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-20T15:13:58.807

[Douglas Schmidt 的 ACE（自适应通信环境）](http://www.cs.wustl.edu/~schmidt/ACE.html)是一个[成熟的、](http://freshmeat.net/projects/ace/) [高度可移植](http://www.cs.wustl.edu/~schmidt/ACE.FAQ.html#Q0b)的开源框架，用于构建高性能多线程服务器。它主要针对电信应用，但已用于[各种项目](http://www.cs.wustl.edu/~schmidt/ACE-users.html)。它还带有一个名为[TAO的](http://www.cs.wustl.edu/~schmidt/TAO.html)[对象请求代理](http://en.wikipedia.org/wiki/Object_request_broker)（如果您喜欢[CORBA](http://www.omg.org/gettingstarted/corbafaq.htm)）

该框架的一个声名是它支持许多线程模型（线程池、每个请求的线程、异步+线程等），因此您可以以最适合您的应用程序的方式使用它的线程管理。这实际上是系统最有趣的特性——服务器框架功能开箱即用。我在这里看到的大多数其他库仍然需要您自己实现大部分功能。

有相当多的[电子文档](http://www.cs.wustl.edu/~schmidt/ACE-papers.html)和[几本](http://www.cs.wustl.edu/~schmidt/ACE/)关于它的书籍。它不是最温暖和最蓬松的系统，并且真正为速度而不是舒适而构建 - 但我们使用的是 C++。您可能会发现，了解 ACE 比尝试重建功能和调试所有同步要少得多。

哦，顺便说一句，它是[免费](http://www.cs.wustl.edu/~schmidt/ACE-copying.html)的，就像在演讲中一样 - 就像在啤酒中一样。如果您想要一条商业路线，还有一个[顾问生态系统](http://www.cs.wustl.edu/~schmidt/commercial-support.html)将为它提供支持和指导服务。可以在[此处找到包含一些代码片段的教程。](http://www.huihoo.org/ace_tao/ACE-5.2+TAO-1.2/ACE_wrappers/docs/tutorials/001/page02.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-20T14:58:16.297

我会使用QT。它具有跨平台线程支持。好的文档：

[QT 线程文档](http://doc.trolltech.com/4.4/threads.html)

他们的信号/槽消息机制也在线程之间无缝工作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-20T15:01:03.717

不是你的问题的真正答案，但既然听起来你实际上比 C/C++ 更熟悉 Java，为什么不继续你的参考实现，并使用[Java Native Interface](http://en.wikipedia.org/wiki/Java_Native_Interface)连接到 SDK 。（我从未真正使用过它，但我认为它对这类情况非常有用。）

或者，您可以轻松编写一个使用 SDK 的简单 C 程序，然后将数据发送到您的 Java 程序，例如使用基于套接字的流。这样，您可以再次处理 Java 中更困难的事情。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-20T17:36:18.333

我还想推荐[The Spread Toolkit](http://www.spread.org/)，它（根据项目的网站）是“一个开源工具包，它提供了一种高性能的消息传递服务，该服务对跨局域网和广域网的故障具有弹性”。在听起来与您的情况非常相似的情况下，我已经使用了几次。本质上，它为您提供了[frankodwyer 建议](https://stackoverflow.com/questions/383371/what-is-the-best-way-to-implement-a-cross-platform-multi-threaded-server-in-cc#383436)的服务器。

Spread 守护程序（即服务器）不是多线程的，但它非常快，并且可以很好地扩展到至少成百上千的客户端。此外，该协议支持可靠的 IP 多播，这（在多客户端环境中）可以为您（在性能方面）提供明确的优势，以对抗仅使用点对点 TCP 或 UDP 连接实现的任何内容。（但是：不要尝试自己实现可靠的 IP 多播......显然，Spread 项目已经产生了许多博士/硕士论文作为副产品 - 或者它是作为副产品的工具包，而主要重点一直是学术研究？我真的不知道......）。

由于 Spread 具有 C 和 Java 客户端 API（加上 Python），因此听起来非常适合您的问题。他们有两种许可模式；第一种选择接近BSD。它当然是跨平台的（关于客户端和服务器）。

但是，Spread（当然）不会为您做所有事情。最突出的可能是，它不做持久性（即，如果您的客户端离线或无法接收消息，Spread 将不会缓冲它们，至少超出非常少量的消息）。但幸运的是，在 Spread 所保证的基础上推出您自己的持久性实现并不是很困难（好吧，我什至不知道这样的问题对您是否重要）。其次，Spread 将您的消息限制为每条 100 KB，但该限制也很容易绕过，只需让发送者将一条大消息分成许多较小的消息，然后在接收者处将它们连接起来。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-08-23T06:54:36.040

我使用[libevent](http://www.monkey.org/~provos/libevent/)来复用网络 I/O。您应该将其视为 Boost.Asio 的替代品。

当文件描述符上发生特定事件或达到超时后，libevent API 提供了一种执行回调函数的机制。目前，libevent 支持 /dev/poll、kqueue、事件端口、select、poll 和 epoll。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-20T17:17:20.990

我同意 frankodwyer 的观点，将协议从拉模式转变为推模式。

每当共享服务运行时，让连接了传感器的计算机通过 UDP 多播以 100Hz（或为您的传感器制作的任何内容）广播读数。然后编写读取多播数据的客户端。

或者，您可以使用广播 UDP 而不是多播。

顺便说一句，这就是有多少 GPS、激光雷达和其他传感器在做事。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-20T14:52:29.163

使用跨平台 API 或创建您自己的 API，您可以在每个架构上进行更改。

也修改这个：[http ://www.goingware.com/tips/getting-started/](http://www.goingware.com/tips/getting-started/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-20T15:12:03.710

如果你想使用 C（而不是 C++），[NSPR 库](http://www.mozilla.org/projects/nspr/)可能会提供你需要的东西......

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-12-20T15:19:31.557

我强烈建议您考虑原型设计模式。

我使用这种模式在 C++ 中编写了一个与协议无关的服务器，从 HTTP Web 服务到自定义专有二进制协议，我都使用了该服务器。

基本上，这个想法是这样的：

服务器负责在特定端口上接受（）传入连接并创建线程（或进程）来处理这些连接。

当您尝试构建通用服务器时，您会意识到如果不对协议做出假设，您将无法真正读取或写入任何数据......因此，诀窍是使用原型模式。

使用纯“HandleConnection() = 0”方法创建一个“ConnectionHandlerBase”类。使服务器类的用户使用他们自己的实现来继承这个类。此外，该类实现了一个“Clone()”方法，该方法返回自身的副本......这样服务器可以创建它的新实例而无需知道它的类型......然后当您获得连接时，调用“Clone ()” 在您的原型实例上，并让处理线程在此对象上调用“HandleConnection()”。

在应用程序启动时，服务器类的用户必须调用如下内容：

“Server.AttachConnectionPrototype(&MyConnectionObject);”

# php - Eclipse + PDT 性能提示？

> ID：383389
> 
> 赞同：3
> 
> 时间：2008-12-20T15:01:18.800
> 
> 标签：php, eclipse, performance, eclipse-pdt

我最近想为我的 PHP 侧项目获得一个 decend IDE，并通过搜索找到了 Eclipse+PDT。尽管它还没有达到 Visual Studio 的水平，但在此方面它比 Notepad++ 非常好并且更好。我什至可以进行一些调试，尽管它非常有问题。

但是有一件事让我很烦恼。它似乎有某种奇怪的性能问题，因此它大约每分钟一次使用大量 CPU。就其本身而言，这并不明显，但如果您同时做其他事情（例如看电影或玩 Quake 3），它会时不时地产生烦人的打嗝。

诚然，我的电脑不是最先进的（Sempron 2200+ 配备 1GB 内存），但对于所有这些来说，它肯定绰绰有余。

另一个性能问题是，我习惯于 Visual Studio，只要您键入兼容的符号，就会弹出 IntelliSense。在这里你必须等待片刻。有什么办法让它瞬间打开吗？

PS也许有更好的PHP**免费软件**IDE？

**补充：** Stefan Schmidt 建议更改自动激活速度。这似乎有一个错误。我设置的越小，它就越无法打开。例如，当它是 200 时，它主要是在有东西要打开的时候一直打开。在 10 时，它不会（至少）为静态类成员打开。是什么赋予了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-04-16T00:44:55.583

我*想*我找到了！！！

鉴于：

a) Eclipse for PHP (Eclipse PDT) 几乎每天都会更新，包括每日构建。我只能假设这是来自一个非常敬业和有能力的开发人员团队，他们只想要你做的同样的事情。

b) 我们中只有一小部分人来这里抱怨我们的 CPU 在尝试编辑 PHP 代码时会用尽。

观察：

a）我已经关闭了首选项框中的几乎所有项目，但无济于事。

解决方案：

在我过去的软件经验中，尤其是通常对其他人有用的大型黑匣子。当面对似乎对传统理论没有反应的情况时......我喜欢做非常规的事情。在这种情况下......只需照顾“小事”。

在这种特殊情况下，这意味着我：

1.  通过帮助->检查软件更新进行了更新
2.  安装了最新的更新
3.  删除旧工作区并创建一个新工作区
4.  注意所有警告，尤其是黄色警告，它一直指向代码中的所有 HTML 错误，这些错误我要么没有真正使用，要么打算清理。

换句话说...

一旦我消除了所有的警告...... CPU 停止了最大化！

在更新到最新的 Eclipse 版本，然后花时间修复警告和/或删除所有不必要的源代码（无论如何都将被删除）...... CPU 恢复“正常”。

换句话说...

问题不在于 Eclipse PDT 工作不正常......

...是它工作得太好了！

它正在做它的设计目的......检查（&重新检查）你的源代码中的警告，而键盘被认为是休眠的。

所以...

给你...

注意“问题”窗口中的所有警告，并采取措施将警告数量减少到零！

然后在这里报告你的发现。

老实说，我无法相信我的 Ubuntu 10.04（32 位）安装在 500 美元的 Compaq Presario 上运行得有多好。这是一个梦想，我所做的只是照顾“小事”。

干杯，

佩里

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T04:35:38.030

它可能是垃圾收集器。尝试不同的 JVM 或不同的垃圾收集算法。它可能会帮助您缩短暂停时间。使用[JRockit](http://www.oracle.com/technology/software/products/jrockit/index.html)，您可以为垃圾收集器设置暂停时间目标。

例如，您可以设置：

```
-XgcPrio:pausetime 
-XpauseTarget:250 
```

在你的 eclipse.ini 文件中。有关如何设置 Eclipse 以在 JRockit 上运行的一些信息，请参阅此[博客](http://blogs.oracle.com/hirt/2008/08/running_eclipseworkshop_on_jro.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T10:44:58.010

你可以试试这个：

选择项目 => 从菜单中清理并选择所有 php 项目。这可能需要一段时间（如果您有很多/大型项目），但它应该会变得更快。

对于替代的免费 IDE，您可以尝试[NetBeans](http://www.netbeans.org/features/php/index.html)。从 6.5 版开始，它具有完整的 php 支持，对我来说它比 Eclipse+PDT 更快，并且更稳定/内存消耗。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-05T06:52:29.440

PDT 3.1 和 eclipse 4.2 (juno) 存在已知问题。

[https://bugs.eclipse.org/bugs/show_bug.cgi?id=385272](https://bugs.eclipse.org/bugs/show_bug.cgi?id=385272)

这是解决方案：

打开不同的透视图（例如 java，但不是 php）并重新启动 eclipse。之后，您可以节省地切换回 php 透视图。Eclipse 不会有性能问题。

[这里](http://wiki.eclipse.org/PDT/Installation_3.1.x)也提到

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T15:52:54.670

我在使用 PDT 和 Ganymede 时没有遇到任何问题。您可能想尝试（作为实验）从[一体化 Eclipse PDT + Zend 调试器包](http://www.zend.com/en/community/pdt)zip 下载和复制 eclipse，看看它是否运行得更好？

您可以使用多个不同的 Eclipse，因为它们不需要任何安装并且不会相互干扰 - 只需打开并使用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-07T08:50:48.090

还有另一个项目用于向 Eclipse 添加 PHP 支持：[PHPeclipse](http://www.phpeclipse.com/)。我知道在 PDT 还很年轻的时候，人们经常因为 PDT 的性能问题而选择 PHPeclipse，但我不能说两者的当前版本在性能（和功能）方面的比较，因为我退出了我的 PHPeclipse 开发活动相当多过去。

如果您的性能问题是一个真正的阻碍，您可能想尝试一下 PHPeclipse。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-20T15:50:20.200

对于你的第二个问题：

*   转到窗口->首选项...
*   从那里转到 PHP->Editor->Code Assist
*   底部是一个名为自动激活的框。

您可以在此处指定 Code Assist 显示所需的延迟。

我没有解决您的其他问题，但是如果您等到 12 月 29 日，您的问题可能会在 2.0 版本中得到解决。

编辑：不是解决方案，但可能是一种解决方法：尝试降低 PDT 进程的进程优先级。

# powershell - 使用 PowerShell 创建本地用户 (Windows Vista)

> ID：383390
> 
> 赞同：6
> 
> 时间：2008-12-20T15:01:33.620
> 
> 标签：powershell, adsi

我最近安装了 PowerShell，我开始寻找的第一件事就是如何创建新用户。找了一段时间后，我仍然没有找到这个。我对 linux 上的 bash 有一点经验，发现它非常有效。在那里创建用户很简单。是否有一种简单的内置方法可以使用 PowerShell 创建本地用户？

谢谢你。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-20T15:11:41.387

您可以使用本地主机的[ADSI](http://msdn.microsoft.com/en-us/library/aa772170.aspx)：

```
function create-account ([string]$accountName = "testuser") {   
   $hostname = hostname   
   $comp = [adsi] "WinNT://$hostname"  
   $user = $comp.Create("User", $accountName)   
   $user.SetPassword("Password1")   
   $user.SetInfo()   
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T07:29:38.447

你也可以使用

```
net user /add 
```

此命令不限于 powershell。

# javascript - JavaScript 的“new”关键字被认为是有害的吗？

> ID：383402
> 
> 赞同：585
> 
> 时间：2008-12-20T15:20:07.967
> 
> 标签：javascript

在另一个[问题](https://stackoverflow.com/questions/377716/javascript-automatic-gettersetters-john-resig-book)中，一位用户指出该`new`关键字使用起来很危险，并提出了一个未使用的对象创建解决方案`new`。我不相信这是真的，主要是因为我使用过 Prototype、Scriptaculous 和其他优秀的 JavaScript 库，而且每个人都使用了`new`关键字。

尽管如此，昨天我在 YUI 剧院观看 Douglas Crockford 的演讲，他说了同样的话，他`new`不再在代码中使用关键字（[Crockford on JavaScript - Act III: Function the Ultimate - 50:23分钟](http://www.youtube.com/watch?v=ya4UHuXNygM&t=50m23s)）。

使用`new`关键字“不好”吗？使用它的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：619
> 
> 时间：2008-12-20T17:17:21.537

Crockford 在推广优秀的 JavaScript 技术方面做了很多工作。他对语言关键要素的固执己见引发了许多有益的讨论。也就是说，有太多的人把每一个“坏”或“有害”的宣言都当作福音，拒绝超越一个人的看法。有时可能会有点令人沮丧。

`new`与从头开始构建每个对象相比，使用关键字提供的功能有几个优点：

1.  [原型继承](https://stackoverflow.com/questions/186244/what-does-it-mean-that-javascript-is-a-prototype-based-language)。尽管那些习惯于基于类的 OO 语言的人经常带着怀疑和嘲笑的态度看待，但 JavaScript 的本机继承技术是一种简单且令人惊讶的代码重用方法。关键字是使用它的`new`规范（也是唯一可用的跨平台）方法。
2.  表现。这是 #1 的副作用：如果我想为我创建的每个对象添加 10 个方法，我*可以*编写一个创建函数，手动将每个方法分配给每个新对象……或者，我可以将它们分配给创建函数`prototype`并用于`new`剔除新对象。这不仅更快（原型上的每个方法都不需要代码），而且避免了为每个方法使用单独的属性来膨胀每个对象。在速度较慢的机器（尤其是速度较慢的 JS 解释器）上，当创建许多对象时，这可能意味着显着节省时间和内存。

是的，`new`有一个关键的缺点，其他答案巧妙地描述了：如果您忘记使用它，您的代码将在没有警告的情况下中断。幸运的是，这个缺点很容易得到缓解——只需在函数本身中添加一些代码：

```
function foo()
{
   // if user accidentally omits the new keyword, this will 
   // silently correct the problem...
   if ( !(this instanceof foo) )
      return new foo();

   // constructor logic follows...
} 
```

现在您可以拥有`new`无​​需担心意外误用引起的问题的优势。您甚至可以在检查中添加一个断言，如果您对损坏的代码无声工作的想法感到困扰。或者，正如[一些](https://stackoverflow.com/users/36866/some)评论的那样，使用检查来引入运行时异常：

```
if ( !(this instanceof arguments.callee) ) 
   throw new Error("Constructor called as a function"); 
```

（请注意，此代码段能够避免对构造函数名称进行硬编码，因为与前面的示例不同，它不需要实际实例化对象 - 因此，可以将其复制到每个目标函数中而无需修改。）

John Resig 在他的[简单“类”实例化](http://ejohn.org/blog/simple-class-instantiation/)帖子中详细介绍了这项技术，并包括一种将这种行为默认构建到“类”中的方法。绝对值得一读……正如他即将出版的书，[JavaScript Ninja 的秘密](http://www.manning.com/resig/)，它在 JavaScript 语言的这个和许多其他“有害”特性中发现了隐藏的黄金（对于我们这些最初不屑一顾的人来说，这一章特别有启发性**）**`with`这个备受诟病的功能是一种噱头）。

* * *

## 回答 #2

> 赞同：187
> 
> 时间：2008-12-20T15:43:45.127

我刚刚阅读了他的 Crockfords 书“Javascript: The Good Parts”的部分内容。我觉得他认为曾经咬过他的一切都是有害的：

关于开关掉线：

> 我从不允许切换案例落入下一个案例。我曾经在我的代码中发现了一个错误，这是在我发表了关于为什么跌倒有时有用的激烈演讲后立即意外跌倒造成的。（第 97 页，ISBN 978-0-596-51774-8）

关于 ++ 和 --

> 众所周知，++（递增）和 --（递减）运算符会通过鼓励过度的技巧来导致糟糕的代码。在启用病毒和其他安全威胁方面，它们仅次于错误的架构。（第 122 页）

关于新：

> 如果 在调用构造函数时忘记包含*new前缀，那么**this*将不会绑定到新对象。可悲的是，*这* 将绑定到全局对象，因此您将破坏全局变量，而不是扩充您的新对象。那真的很糟糕。没有编译警告，也没有运行时警告。（第 49 页）

还有更多，但我希望你能明白。

我对你的问题的回答：**不，它没有害处。**但是如果你忘记在你应该使用它的时候使用它，你可能会遇到一些问题。如果您在良好的环境中发展，您会注意到这一点。

**更新**

写完这个答案大约一年后，ECMAScript 的第 5 版发布，支持[严格模式](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode)。在严格模式下，`this`不再绑定到全局对象，而是绑定到`undefined`.

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2008-12-20T17:10:15.093

Javascript 是动态语言，有无数种方法可以搞砸另一种语言会阻止你的地方。

避免一个基本的语言特征，比如`new`你可能会搞砸，这有点像在穿过雷区之前脱掉闪亮的新鞋，以防你的鞋子弄脏。

我使用一个约定，其中函数名称以小写字母开头，而实际上是类定义的“函数”以大写字母开头。结果是一个非常引人注目的视觉线索，表明“语法”是错误的：-

```
var o = MyClass();  // this is clearly wrong. 
```

除此之外，良好的命名习惯也会有所帮助。毕竟函数都是做事的，因此它的名称中应该有一个动词，而类代表对象并且是没有动词的名词和形容词。

```
var o = chair() // Executing chair is daft.
var o = createChair() // makes sense. 
```

有趣的是 SO 的语法着色如何解释上面的代码。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2008-12-22T09:22:52.913

我是 Javascript 的新手，所以也许我在提供一个好的观点方面经验不足。然而，我想分享我对这个“新”事物的看法。

我来自 C# 世界，在那里使用关键字“new”是如此自然，以至于工厂设计模式对我来说很奇怪。

当我第一次用 Javascript 编写代码时，我没有意识到有“new”关键字和类似 YUI 模式的代码，很快我就陷入了灾难。回顾我编写的代码时，我忘记了特定行应该做什么。更混乱的是，当我“空运行”代码时，我的思维无法真正在对象实例边界之间转换。

然后，我找到了对我来说“分离”事物的“新”关键字。使用 new 关键字，它可以创建事物。如果没有 new 关键字，我知道我不会将它与创建事物混淆，除非我调用的函数给了我强有力的线索。

例如，`var bar=foo();`我不知道 bar 可能是什么……它是返回值还是新创建的对象？但`var bar = new foo();`我肯定知道 bar 是一个对象。

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2008-12-20T18:25:32.647

new 的另一个例子**是**我所说的[Pooh Coding](http://old.robowiki.net/cgi-bin/robowiki?PoohCoding)。小熊维尼跟着他的肚子走。我说使用你正在使用的语言，而不是**反对****它**。

语言的维护者很有可能会针对他们试图鼓励的习语优化语言。如果他们将新关键字放入语言中，他们可能认为在创建新实例时明确是有意义的。

按照语言的意图编写的代码将随着每个版本的发布而提高效率。避免语言关键结构的代码会随着时间的推移而受到影响。

编辑：这远远超出了性能。**我数不清有**多少次我听到（或说过）“他们到底为什么要那样做？” 当发现奇怪的代码时。事实证明，在编写代码时，有一些“好的”理由。遵循语言之道是几年后您的代码不会被嘲笑的最佳保险。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2011-06-20T22:52:49.080

我写了一篇关于如何缓解在没有 new 关键字的情况下调用构造函数的问题的帖子。
它主要是说教的，但它展示了如何创建可以使用或不使用的构造函数，`new`并且不需要您添加[样板代码](http://en.wikipedia.org/wiki/Boilerplate_code)`this`以在每个构造函数中进行测试。

[http://js-bits.blogspot.com/2010/08/constructors-without-using-new.html](http://js-bits.blogspot.com/2010/08/constructors-without-using-new.html)

以下是该技术的要点：

```
/**
 * Wraps the passed in constructor so it works with
 * or without the new keyword
 * @param {Function} realCtor The constructor function.
 *    Note that this is going to be wrapped
 *    and should not be used directly 
 */
function ctor(realCtor){
  // This is going to be the actual constructor
  return function wrapperCtor(){
    var obj; // object that will be created
    if (this instanceof wrapperCtor) {
      // Called with new
      obj = this;
    } else {
      // Called without new. Create an empty object of the
      // correct type without running that constructor
      surrogateCtor.prototype = wrapperCtor.prototype;
      obj = new surrogateCtor();
    }
    // Call the real constructor function
    realCtor.apply(obj, arguments);
    return obj;
  }

  function surrogateCtor() {}
} 
```

以下是如何使用它：

```
// Create our point constructor
Point = ctor(function(x,y){
  this.x = x;
  this.y = y;
});

// This is good
var pt = new Point(20,30);
// This is OK also
var pt2 = Point(20,30); 
```

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2008-12-20T15:42:45.160

不使用 new 关键字的理由很简单：

通过根本不使用它，您可以避免意外忽略它所带来的陷阱。YUI 使用的构造模式是如何完全避免使用 new 关键字的示例”

```
var foo = function () {
    var pub= { };
    return pub;
}
var bar = foo(); 
```

或者你可以这样：

```
function foo() { }
var bar = new foo(); 
```

但是这样做会冒着有人忘记使用**new**关键字的风险，并且**this**操作符全是 fubar。AFAIK 这样做没有任何好处（除了你已经习惯了）。

在一天结束时：**这是关于防守的。** 你能用新的说法吗？是的。它会让你的代码更危险吗？是的。

如果您曾经编写过 C++，这类似于在删除指针后将指针设置为 NULL。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2008-12-20T16:12:11.793

我认为“新”增加了代码的清晰度。清晰值得一切。很高兴知道存在陷阱，但通过避免清晰来避免它们对我来说似乎不是这样。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2010-11-13T17:04:53.213

### 情况1：`new`不是必需的，应该避免

```
var str = new String('asd');  // type: object
var str = String('asd');      // type: string

var num = new Number(12);     // type: object
var num = Number(12);         // type: number 
```

### 情况2：`new`必填，否则会报错

```
new Date().getFullYear();     // correct, returns the current year, i.e. 2010
Date().getFullYear();         // invalid, returns an error 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2010-12-28T23:47:43.640

以下是我可以对支持和反对使用运算符的两个最有力的论据做出的最简短的总结`new`：

### 反对`new`

1.  设计为使用 `new`运算符实例化为对象的函数如果被错误地作为正常函数调用，可能会产生灾难性的影响。在这种情况下，函数的代码将在调用函数的范围内执行，而不是按预期在本地对象的范围内执行。这可能会导致全局变量和属性被覆盖并带来灾难性后果。
2.  最后，编写`function Func()`，然后调用`Func.prototype` 并向其中添加一些东西，以便您可以调用`new Func()`来构造您的对象，这对于某些程序员来说似乎很丑陋，出于架构和风格的原因，他们宁愿使用另一种样式的对象继承。

有关此论点的更多信息，请查看 Douglas Crockford 的伟大而简洁的书 Javascript：The Good Parts。事实上，无论如何都要检查一下。

### 赞成的论据`new`

1.  将`new`运算符与原型分配一起使用很快。
2.  如果您总是在构造函数中包含一些代码以检查它们是否被正确调用，并且在它们没有被正确调用的情况下，那么在全局命名空间中意外运行构造函数代码的事情可以很容易地避免，根据需要适当地处理呼叫。

请参阅[John Resig 的帖子](http://ejohn.org/blog/simple-class-instantiation/)以获取对该技术的简单解释，以及对他所倡导的继承模型的一般更深入的解释。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-12-20T17:10:39.617

我同意佩斯和一些在这里。

在我看来，“新”显然是自我描述的对象创建，而 Greg Dean 描述的 YUI 模式*完全被掩盖了*。

有人可以编写`var bar = foo;`或`var bar = baz();`baz 不是对象创建方法的可能性似乎要危险*得多。*

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2010-08-30T20:55:13.323

我认为 new 是邪恶的，不是因为如果你忘记错误地使用它可能会导致问题，而是因为它搞砸了继承链，使语言更难理解。

JavaScript 是基于原型的面向对象的。因此，每个对象都必须像这样从另一个对象创建`var newObj=Object.create(oldObj)`。这里*oldObj*被称为 newObj 的原型*（*因此是“基于原型的”）。这意味着如果在 newObj 中没有找到一个属性，*那么*它将在*oldObj*中搜索。 *newObj*默认情况下将是一个空对象，但由于它的原型链，它似乎具有*oldObj*的所有值。

另一方面，如果你这样做， *newObj*`var newObj=new oldObj()`的原型是*oldObj.prototype*，这不必要地难以理解。

 *诀窍是使用

```
Object.create=function(proto){
  var F = function(){};
  F.prototype = proto;
  var instance = new F();
  return instance;
}; 
```

它在这个函数内部，只有在这里才应该使用 new 。在此之后只需使用*Object.create()*方法。该方法解决了原型问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-04-05T13:23:46.233

IMNSHO“新”是 2021 JavaScript 中的一个有缺陷的概念。它在不需要的地方添加单词。它使函数/构造函数的返回值隐含并强制在函数/构造函数中使用 this。在代码中添加噪音从来都不是一件好事。

```
// With new
function Point(x, y) {
    this.x = x
    this.y = y
}
let point = new Point(0,0) 
```

比。

```
// Without new
function Point(x, y) {
    return { x, y }
}
let point = Point(0,0) 
```

# language-agnostic - Code Golf：用最少的代码行打印整个“圣诞节的 12 天”歌曲

> ID：383403
> 
> 赞同：25
> 
> 时间：2008-12-20T15:20:58.777
> 
> 标签：language-agnostic, code-golf, rosetta-stone

打印[流行节日歌曲](http://en.wikipedia.org/wiki/The_Twelve_Days_of_Christmas_(song))的所有 12 首诗句。

我所说的12*节*是指歌曲中所唱的每一行的重复，即

诗歌一：圣诞节的第一天，我的真爱在梨树上给了我一只鹧鸪。

第二节 圣诞节的第二天，我的真爱给了我两只斑鸠和梨树上的一只鹧鸪。

...

第 N 节：在圣诞节的第 n 天，我的真爱给了我（第 N-1 节没有第一行）（第 N 节中添加的行）

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-20T15:21:11.070

普通 Lisp：

```
(mapc #'princ
      (reverse (maplist #'(lambda(l)
         (format nil 
            "On the ~:R day of Christmas my true love gave to me~%~{~a~%~}~%" 
                (length l) l)) 
    '("twelve drummers drumming,"
      "eleven pipers piping,"
      "ten lords a-leaping,"
      "nine ladies dancing,"
      "eight maids a-milking,"
      "seven swans a-swimming,"
      "six geese a-laying,"
      "five gold rings,"
      "four calling birds,"
      "three french hens,"
      "two turtle doves, and"
      "a partridge in a pear tree.")))) 
```

编辑：

如果去掉空格，上面是 412 个字符。

这个：

```
(let ((g))
  (dotimes (i 12)
    (format t
        "On the ~:R day of Christmas my true love gave to me~%~{~R ~:*~
         ~[~;~;turtle doves and~;french hens,~;calling birds,~;gold rings,~
         ~;geese a-laying,~;swans a-swimming,~;maids a-milking,~
         ~;ladies dancing,~;lords a-leaping,~;pipers piping,~
         ~;drummers drumming,~]~%~}a partridge in a pear tree~2%"
        (1+ i) g)
    (push (+ i 2) g))) 
```

如果在格式字符串中去掉空格和 ~ 引用换行符，则为 344 个字符：

```
(let((g))(dotimes(i 12)(format t"On the ~:R day of Christmas my true love gave to me~%~{~R ~:*~[~;~;turtle doves and~;french hens,~;calling birds,~;gold rings,~;geese a-laying,~;swans a-swimming,~;maids a-milking,~;ladies dancing,~;lords a-leaping,~;pipers piping,~;drummers drumming,~]~%~}a partridge in a pear tree~2%"(1+ i)g)(push(+ i 2)g))) 
```

编辑：

看起来问题已经解决了，该网站正在唠叨我接受答案。据我所知，这个是最短的。如果我接受我自己的答案，我有点害怕网站会做什么——可能会给我一个自恋者或自慰者徽章。

你不能接受自己的答案。很公平。我会把它打开。感谢大家的回应。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-12-20T17:15:50.370

使用 F#：

```
#light
open System.Net; open System.Text.RegularExpressions
printf "%s" ((new WebClient()).DownloadString("http://www.textfiles.com/holiday/12-bugs")
    |> (fun x -> (new Regex("Lines: \d+\s+([\s\S]+)--")).Match(x).Groups.[1].Value)) 
```

第十二天输出：

```
对于圣诞节的第十二个错误，我的经理对我说
     告诉他们这是一个功能
     说不支持
     更改文档
     归咎于硬件
     找到解决方法
     说他们需要升级
     重新安装软件
     要求转储
     使用调试器运行
     尝试重现它
     问他们是怎么做到的
     看看他们能不能再做一次。
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-20T17:01:20.167

不是我的，但很有趣……

[这是来自http://en.wikipedia.org/wiki/Obfuscated_code](http://en.wikipedia.org/wiki/Obfuscated_code)的一个著名示例（作者：James O. Coplien）：

```
#include <stdio.h>
main(t,_,a)char *a;{return!0<t?t<3?main(-79,-13,a+main(-87,1-_,
main(-86,0,a+1)+a)):1,t<_?main(t+1,_,a):3,main(-94,-27+t,a)&&t==2?_<13?
main(2,_+1,"%s %d %d\n"):9:16:t<0?t<-72?main(_,t,
"@n'+,#'/*{}w+/w#cdnr/+,{}r/*de}+,/*{*+,/w{%+,/w#q#n+,/#{l,+,/n{n+,/+#n+,/#\
;#q#n+,/+k#;*+,/'r :'d*'3,}{w+K w'K:'+}e#';dq#'l \
q#'+d'K#!/+k#;q#'r}eKK#}w'r}eKK{nl]'/#;#q#n'){)#}w'){){nl]'/+#n';d}rw' i;# \
){nl]!/n{n#'; r{#w'r nc{nl]'/#{l,+'K {rw' iK{;[{nl]'/w#q#n'wk nw' \
iwk{KK{nl]!/w{%'l##w#' i; :{nl]'/*{q#'ld;r'}{nlwb!/*de}'c \
;;{nl'-{}rw]'/+,}##'*}#nc,',#nw]'/+kd'+e}+;#'rdq#w! nr'/ ') }+}{rl#'{n' ')# \
}'+}##(!!/")
:t<-50?_==*a?putchar(31[a]):main(-65,_,a+1):main((*a=='/')+t,_,a+1)
  :0<t?main(2,2,"%s"):*a=='/'||main(0,main(-61,*a,
"!ek;dc i@bK'(q)-[w]*%n+r3#l,{}:\nuwloca-O;m .vpbks,fxntdCeghiry"),a+1);} 
```

“虽然乍一看难以理解，但它是一个合法的 C 程序，在编译和运行时会生成《圣诞节的 12 天》的 12 节经文。它包含以编码形式内联在代码中的诗歌所需的所有字符串。代码遍历 12 天，显示它需要什么。”

但它不会赢得高尔夫，它大约是 830 字节。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-20T19:19:31.930

```
class TrueLove: ITrueLove 
{
  List<IPresent> give(int day) 
  {
    List<IPresent> lovesLabourLost = new List<IPresent>();

    //if this was C++ could you replace this with a Figgy Duff Device?
    for (int i=1; i<=day; i++)
    {
      if(day > 1 && i<=2) {lovesLabourLost .Add(new TurtleDove());}
      if(day > 2 && i<=3) {lovesLabourLost .Add(new FrenchHen());}
      if(day > 3 && i<=4) {lovesLabourLost .Add(new CallingBird());}
      if(day > 4 && i<=5) {lovesLabourLost .Add(new GOLDRING());}
      if(day > 5 && i<=6) {lovesLabourLost .Add(new LayingGeese());}
      if(day > 6 && i<=7) {lovesLabourLost .Add(new SwimmingSwan());}
      if(day > 7 && i<=8) {lovesLabourLost .Add(new MilikingMaid());}
      if(day > 8 && i<=9) {lovesLabourLost .Add(new DancingLady());}
      if(day > 9 && i<=10) {lovesLabourLost .Add(new LeapingLord());}
      if(day > 10 && i<=11) {lovesLabourLost .Add(new PipingPiper());}
      if(day > 11 && i<=12) {lovesLabourLost .Add(new DrummingDrummer());}
    }

    return lovesLabourLost && (new PartridgeInPearTree());
  }
}

static class Me: IDemanding
{
  static ITrueLove myTrueLove = new TrueLove();

  static List<IPresent> myPresents = new List<IPresent>();

  static void demandPresents()
  {
    for (int i=1; i<=daysOfChristmas; i++)
    {
      List<IPresent> MOAR = myTrueLove.give(i);

      foreach (IPresent another in MOAR)
      {
        myPresents.Add(another);
      }
    }
  }
}

const int daysOfChristmas = 12;

Me.demandPresents(); 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-12-21T16:02:01.877

在 D 编程语言中，使用 switch 语句贯穿：

```
import std.stdio;

void main() {
    for(uint i = 1; i < 13; i++) {
        writeln("On the ", i, " day of Christmas, my true love gave to me:");
        switch(i) {
            case 12:
                writeln("twelve drummers drumming,");
            case 11:
                writeln("eleven pipers piping,");
            case 10:
                writeln("ten lords a-leaping,");
            case 9:
                writeln("nine ladies dancing,");
            case 8:
                writeln("eight maids a-milking,");
            case 7:
                writeln("seven swans a-swimming,");
            case 6:
                writeln("six geese a-laying,");
            case 5:
                writeln("five gold rings,");
            case 4:
                writeln("four calling birds,");
            case 3:
                writeln("three french hens,");
            case 2:
                writeln("two turtle doves, and");
            case 1:
                writeln("a partridge in a pear tree.\n");
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-12-21T02:37:45.370

重击：

```
wget -qO- http://tinyurl.com/a3xw8b 
```

我使用[frizzer.myopenid.com](https://stackoverflow.com/questions/383403/code-golf-print-the-entire-12-days-of-christmas-song-in-the-fewest-lines-of-code#383404)的 CLisp 实现的输出作为开始。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-12-22T23:39:42.683

在 C++ 中，你会

```
std::cout << boost::12_days_of_christmas; 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2008-12-20T19:50:48.840

# C#，421 个字符

```
var t="";for(int i=0;i++<12;)Console.Write("On the {0}{1} day of Christmas, my true love gave to me: {2}\n",i,i<2?"st":i<3?"nd":i<4?"rd":"th",t="|a partridge in a pear tree.|two turtle doves, and |three french hens,|four calling birds,|five gold rings|six geese a-lay@seven swans a-swimm@eight maids a-milk@nine ladies danc@ten lords a-leap@eleven pipers pip@twelve drummers drumm@".Replace("@","ing,|").Split('|')[i]+t); 
```

## 间隔版本：

```
var t="";

for(int i = 0; i++ < 12;)
    Console.Write("On the {0}{1} day of Christmas, my true love gave to me: {2}\n",
            i,
            i < 2 ? "st" : i < 3 ? "nd" : i < 4 ? "rd" : "th",
            t="|a partridge in a pear tree.
               |two turtle doves, and 
               |three french hens,
               |four calling birds,
               |five gold rings
               |six geese a-lay
               @seven swans a-swimm
               @eight maids a-milk
               @nine ladies danc
               @ten lords a-leap
               @eleven pipers pip
               @twelve drummers drumm@"
            .Replace("@","ing,|")
            .Split('|')[i]+t); 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-12-21T15:50:21.353

## PHP：375 个字符

```
$v=split(":",":a partridge in a pear tree.\n:two turtle doves, and:three french hens:four calling birds:five gold rings:six geese a-lay:seven swans a-swimm:eigth maids a-milk:nine ladies danc:ten lords a-leap:eleven pipers pip:twelve drummers drumm");while($i<12){?>On the <?=date(jS,$i*86400)," day of Christmas my true love gave to me",$s=", ".$v[++$i].($i>5?'ing':'').$s;} 
```

编辑：更新的可运行版本（377）字符

```
<?$v=split(":",":a partridge in a pear tree.\n:two turtle doves, and:three french hens:four calling birds:five gold rings:six geese a-lay:seven swans a-swimm:eigth maids a-milk:nine ladies danc:ten lords a-leap:eleven pipers pip:twelve drummers drumm");while($i<12){?>On the <?=date(jS,$i*86400)," day of Christmas my true love gave to me",$s=", ".$v[++$i].($i>5?'ing':'').$s;} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-12-20T19:24:12.687

VB.Net - 530 个字符（无空格）、634 个（空格）

```
Module ChristmasSong
    Sub Main()
        Dim i&, f$ : Dim d$() = {"first", "second", "third", "fourth", "fifth", "sixth", "seventh", "eighth", "ninth", "tenth", "eleventh", "twelfth"}, g$() = {"a partridge in a pear tree.", "two turtle doves, and ", "three french hens, ", "four calling birds, ", "five gold rings, ", "six geese a-laying, ", "seven swans a-swimming, ", "eigth maids a-milking, ", "nine ladies dancing, ", "ten lords a-leaping, ", "eleven pipers piping, ", "twelve drummers drumming, "}
        For i = 0 To 11 : f = g(i) & f : Console.WriteLine("On the {0} day of Christmas, my true love gave to me {1}", d(i), f) : Next
    End Sub
End Module 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-12-21T13:20:03.123

Linq to objects，580 个字符（没有空格）

```
Console.WriteLine(Enumerable.Range(1, 13).SelectMany(day =>
    Enumerable.Repeat("\nOn the " + day + 
                      (day == 1 ? "st" : 
                      (day == 2 ? "nd" : 
                      (day == 3 ? "rd" : 
                      "th"))) + " day of Christmas my true love gave to me ", 1)
              .Concat((new []
                {
                    "twelve drummers drumming,",
                    "eleven pipers piping,",
                    "ten lords a-leaping,",
                    "nine ladies dancing,",
                    "eight maids a-milking,",
                    "seven swans a-swimming,",
                    "six geese a-laying,",
                    "five gold rings,",
                    "four calling birds,",
                    "three french hens,",
                    "two turtle doves, and",
                    "a partridge in a pear tree."
                }).Reverse().Take(day).Reverse()))
              .Aggregate((a, b) => a + "\n" + b)); 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-12-20T18:02:13.070

珀尔。

```
use Lingua::EN::Numbers qw(num2en_ordinal);
print 'On the ', num2en_ordinal($_+1),' day of Christmas my true love gave to me, ', reverse(( split /\|/, "a partridge in a pear tree.\n|two turtle doves, and |three french hens, |four calling birds, |five gold rings, |six geese a-laying, |seven swans a-swimming, |eight maids a-milking, |nine ladies dancing, |ten lords a leaping, |eleven pipers piping, |twelve drummers drumming, ")[ 0 .. $_ ]) for 0 .. 11; 
```

（459 个字符）

我想让它变得更好，更有表现力，但这是一个*高尔夫*挑战。

这种风格在某种程度上违反了适当的编码标准。但这对你来说是高尔夫。

[Lingua::EN::数字](http://search.cpan.org/~sburke/Lingua-EN-Numbers-1.01/lib/Lingua/EN/Numbers.pm)

这是不太紧凑的版本，具有较少的偷偷摸摸的技巧。

```
use Lingua::EN::Numbers qw(num2en_ordinal);
my @gifts = (
    'a partridge in a pear tree.',
    'two turtle doves, and ',
    'three french hens, ',
    'four calling birds, ',
    'five gold rings, ',
    'six geese a-laying, ',
    'seven swans a-swimming, ',
    'eight maids a-milking, ',
    'nine ladies dancing, ',
    'ten lords a leaping, ',
    'eleven pipers piping, ',
    'twelve drummers drumming, '
);
for my $verse_id ( 0 .. $#gifts ) {
    printf 'On the %s day of Christmas my true love gave to me, ', num2en_ordinal($verse_id +1);
    print reverse @verse[ 0 .. $verse_id ];
    print "\n";
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2008-12-20T23:14:13.487

```
for d in range(12):print"On the %s day of Christmas, my true love gave to me\n\t%s\n"%("first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth|eleventh|twelfth".split("|")[d],"\n\t".join("twelve drummers drumming|eleven pipers piping|ten lords a-leaping|nine ladies dancing|eight maids a-milking|seven swans a-swimming|six geese a-laying|five gold rings|four calling birds|three french hens|two turtle doves and|a partridge in a pear tree.".split("|")[11-d:])) 
```

Python，422 个字符

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2009-12-15T05:22:09.387

# **LilyPond，340 个字符（比 Common Lisp 短）**

'这是季节！（而且相当合适，因为 LilyPond 主要用于排版音乐......除了歌词之外，人们可以轻松地修改此代码来为歌曲制作乐谱。）

改编自 fizzer 的解决方案。

```
#(map(lambda(x)(format #t"On the ~:R day of Christmas my true love gave to me~{ ~R~:*~[~;~;turtle doves and~;French hens,~;calling birds,~;gold rings,~;geese a-laying,~;swans a-swimming,~;maids a-milking,~;ladies dancing,~;lords a-leaping,~;pipers piping,~;drummers drumming,~]~} a partridge in a pear tree.
"x(iota(1- x)x -1)))(iota 12 1)) 
```

用法：`$ lilypond thisfile.ly`

此版本包含 341 个字符，与 fizzer 的输出完全匹配，但**短了三个字节**：

```
#(map(lambda(x)(format #t"On the ~:R day of Christmas my true love gave to me~{
~R ~:*~[~;~;turtle doves and~;french hens,~;calling birds,~;gold rings,~;geese a-laying,~;swans a-swimming,~;maids a-milking,~;ladies dancing,~;lords a-leaping,~;pipers piping,~;drummers drumming,~]~}
a partridge in a pear tree

"x(iota(1- x)x -1)))(iota 12 1)) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-12-20T17:10:40.927

红宝石。我认为这非常简洁（辛勤工作都在一条线上）：

```
days = %w{First Second Third Fourth Fifth Sixth Seventh Eighth Ninth Tenth Eleventh Twelfth}

presents = [
    "twelve drummers drumming",
    "eleven pipers piping",
    "ten lords a leaping",
    "nine ladies dancing",
    "eight maids a-milking",
    "seven swans a-swimming",
    "six geese a-laying",
    "five gold rings",
    "four calling birds",
    "three french hens",
    "two turtle doves, and",
    "a partridge in a pear tree"
    ]

0.upto(11) { |i| 
    puts "On the #{days[i]} of Christmas my true love gave to me " + presents.last(i+1).join(", ")
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-12-20T18:00:42.370

## 使用[模板工具包](http://template-toolkit.org/)

`perl -MTemplate -e 'Template->new()->process("12dayxmas.tt")'`

### 12dayxmas.tt

```
[%
  清单 = [
    { day => 'first', item => '梨树上的鹧鸪'},
    { day => 'second', item => '两只斑鸠和'},
    { day => 'third', item => '三只法国母鸡, '},
    { day => 'fourth', item => '四只呼唤鸟，'},
    { day => 'fifth', item => '五枚金戒指, '},
    { day => '第六', item => '六鹅产蛋, '},
    { day => 'seventh', item => '七只天鹅游泳，'},
    { day => '第八', item => '八个女仆挤奶, '},
    { day => '第九', item => '九位女士跳舞, '},
    { day => 'tenth', item => '十主跳跃, '},
    { day => '十一'，item => '十一风笛，'}，
    { day => '第十二'，item => '十二个鼓手打鼓，'}
  ];
-%]
[%
  FOREACH 清单；
  礼物=物品_礼物；
-%]
在圣诞节的 [% day %] 那天，我的真爱给了我 [% present %]

[％ 结尾 ％]

```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-12-20T18:56:38.327

这是一个PHP解决方案：

```
$day = Array('first','second','third','fourth','fifth','sixth','seventh',
             'eighth','ninth','tenth','eleventh','twelfth');
$gifts = Array('Twelve drummers drumming,',
               'Eleven pipers piping,',
               'Ten lords a-leaping,',
               'Nine ladies dancing,',
               'Eight maids a-milking,',
               'Seven swans a-swimming,',
               'Six geese a-laying,',
               'FIVE GOLDEN RINGS,',
               'Four calling birds,',
               'Three French hens,',
               'Two turtle doves, and',
               'A partridge in a pear tree');

for ($i = 0; $i < 12; ++$i) {
    printf("On the $day[$i] of Christmas my true love gave to me\n" . 
         implode("\n", array_slice($gifts,-($i+1))) . "\n\n");
} 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-12-20T19:18:16.457

```
h 
```

在我编造的语言中，命令`h`打印“Hello，World！”。哦等等，你的意思是这不是我们在说什么？

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2008-12-20T22:32:21.277

# Python（71+467 包括空格）

```
import sys
sys.path += ["TDOC.zip"]
import TDOC
TDOC.print_verse() 
```

其中 TDOC.zip（467 字节）包含 TDOC.py：

```
def print_verse(presents="""\
twelve drummers drumming,
eleven pipers piping,
ten lords a-leaping,
nine ladies dancing,
eigth maids a-milking,
seven swans a-swimming,
six geese a-laying,
five gold rings,
four calling birds,
three french hens,
two turtle doves, and
a partridge in a pear tree.""".split("\n")):
    if presents: 
        print_verse(presents[1:])

        number = presents[0].split(" ", 1)[0]
        print("On the %s day of Christmas my true love gave to me %s" % (
            dict(a="first", two="second", three="third", five="fifth").get(number, number+"th"),
            " ".join(presents))) 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-12-20T16:37:38.107

C＃：

```
string[] s = new string[]{
    "a partridge in a pear tree.",
    "two turtle doves, and ",
    "three french hens, ",
    "four calling birds, ",
    "five gold rings, ",
    "six geese a-laying, ",
    "seven swans a-swimming, ",
    "eight maids a-milking, ",
    "nine ladies dancing, ",
    "ten lords a-leaping, ",
    "eleven pipers piping, ",
    "twelve drummers drumming, "
    };
string t = "";
for (int x = 0; x < s.Length; x++) {
    t = s[x] + t;
    Console.Write("On the " 
      + (x + 1).ToString() 
      + (x == 0 ? "st" : (x == 1 ? "nd" : (x == 2 ? "rd" : "th"))) 
      + " day of christmas, my true love gave to me: " + t + "\n");
} 
```

574 个字符，不包括缩进。添加一些额外的字符以使号码扩展正确。不过，可能会有所改进。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-12-20T16:39:07.263

C＃

```
 string[] days = new string[] {"First", 
    "Second", "Third", "Fourth", "Fifth", "Sixth", 
    "Seventh", "Eighth", "Ninth", "Tenth", "Eleventh", "Twelfth"};

    string[] presents = new string[] {"a partridge in a pear tree.",
    "two turtle doves, and",
    "three french hens,", 
    "four calling birds,", 
    "five gold rings,", 
    "six geese a-laying,", 
    "seven swans a-swimming,", 
    "eigth maids a-milking,", 
    "nine ladies dancing,", 
    "ten lords a-leaping,", 
    "eleven pipers piping,", 
    "twelve drummers drumming,"};

     int cnt =0;
     foreach (string s in presents)
     {
           Console.WriteLine(string.Format("On the {0} day of Christmas my true love gave to me", days[cnt++]));
           foreach (string p in presents.Take(cnt).Reverse())
                Console.WriteLine(p);
           Console.WriteLine(System.Environment.NewLine);
     } 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-12-20T16:48:31.923

我无法击败 Lisp 版本，但它仍然很有趣。

德尔福版本：

```
procedure TheTwelfDaysOfChristmas(const AVerse: TStrings);
const 
  cPresentList : array[1..12] of string = (
    'a partridge in a pear tree',
    'two turtle doves, and ',
    'three french hens, ',
    'four calling birds, ',
    'five gold rings, ',
    'six geese a-laying, ',
    'seven swans a-swimming, ',
    'eigth maids a-milking, ',
    'nine ladies dancing, ',
    'ten lords a-leaping, ',
    'eleven pipers piping, ',
    'twelve drummers drumming, '
  );
  cTime : array[1..12] of string = (
    'first',
    'second',
    'third',
    'fourth',
    'fifth',
    'sixth',
    'seventh',
    'eighth',
    'nineth',
    'tenth',
    'eleventh',
    'twelfth'
  );
var
  present : string;
  i       : Integer;

begin
  present := '';
  for i := 1 to 12 do begin
    present := cPresentList[i] + present;
    AVerse.Add(Format('On the %s day of Christmas my true love gave me %s.',
      [cTime[i], present]));
  end;
end; 
```

顺便说一句，对于你们所有人，2009 年节日快乐，编程很棒。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2008-12-20T19:11:33.227

红宝石

```
a=["and a partridge in a pear tree","turtle doves","French hens","calling birds","golden rings","geese a-laying","swans a-swimming","maids a-milking","ladies dancing","lords a-leaping","pipers piping","drummers drumming"]     
b=["","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"]
c=["first","second","third","fourth","fifth","sixth","seventh","eighth","nineth","tenth","eleventh","twelfth"]
0.upto(11){|d|puts "On the "+c[d]+" day of Christmas, my true love gave to me:\n"+b[d]+" "+a[d]+",";(d-1).downto(0){|e| f=", ";f = "." if e==0;puts b[e]+" "+a[e]+f;}} 
```

总计：593 字节，使用 UNIX LF。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2008-12-20T19:41:05.337

PHP

```
$g = array("a partridge in a pear tree.\n",
    "two turtle doves, and",
"three french hens,",
"four calling birds,",
"five gold rings,",
"six geese a-laying,",
"seven swans a-swimming,",
"eight maids a-milking,",
"nine ladies dancing,",
"ten lords a-leaping,",
"eleven pipers piping,",
"twelve drummers drumming,"
);
$d = array("first", "second", "third", "fourth", "fifth", "sixth",
 "seventh", "eighth", "nineth", "tenth", "eleventh", "twelfth");
foreach($d as $i=>$v){
    echo "On the $v day of Christmas my true love gave to me";
    for($j=$i;$j>=0;$j--) echo " ",$g[$j];
} 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2008-12-21T08:57:55.273

26 字节！..

正如 URL 所暗示的，它可能被认为是.. 作弊：

[http://github.com/dbr/so_scripts/tree/master/golf_tdoc/cheating.bash](http://github.com/dbr/so_scripts/tree/master/golf_tdoc/cheating.bash)

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2008-12-21T02:23:32.887

这是一个 Haskell 版本：

```
import Data.List
main=putStrLn$unlines$map(uncurry(\n->(++)("On the "++show n++case n of{1->"st";2->"nd";3->"rd";_->"th"}++" day of Christmas, my true love gave to me: ")))$zip[1..]$(\a->(drop 4$head a):tail a)$ map(intercalate", ".reverse)$tail$inits["and a partridge in a pair tree","two turtle doves","three french hens","four calling birds","five gold rings","six geese a-laying","seven swans a-swimming","eight maids a milking","nine ladies dancing","ten lords a-leaping","eleven pipers piping","twelve drummers drumming"] 
```

它有 527 个字符。由于没有良好的间距，它相当难以理解，这里有一个更分散的版本：

```
import Data.List
main = putStrLn
       $ unlines
       $ map (uncurry (\n -> (++) ("On the " ++ show n ++ case n of { 1 -> "st"; 2 -> "nd"; 3 -> "rd"; _ -> "th"} ++ " day of Christmas, my true love gave to me: ")))
       $ zip [1..]
       $ (\a -> (drop 4 $ head a) : tail a)
       $ tail
       $ map (intercalate ", " . reverse)
             (inits ["and a partridge in a pair tree", "two turtle doves", "three french hens", "four calling birds", "five gold rings", "six geese a-laying", "seven swans a-swimming", "eight maids a milking", "nine ladies dancing", "ten lords a-leaping", "eleven pipers piping", "twelve drummers drumming"]) 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2008-12-21T02:46:47.940

另一个 C#

```
var l="a partridge in a pear tree.|two turtle doves, and|three french hens,|four calling birds,|five gold rings,|six geese a-laying,|seven swans a-swimming,|eight maids a-milking,|nine ladies dancing,|ten lords a-leaping,|eleven pipers piping,|twelve drummers drumming,".Split('|');

for (int i = 1; i < 13; i++)
    Console.Write(
        "On the {0}{2} day of christmas\rmy true love gave to me \r{1}\r\r", 
            i, 
            string.Join("\r", l.Take(i).Reverse().ToArray()), 
            (i==1?"st":i==2?"nd":i==3?"rd":"th")); 
```

从以前的答案中大量借用（嘿，代码重用），同时增加了额外的节省。

去掉不必要的空格后 481 个字符：

```
var l="a partridge in a pear tree.|two turtle doves, and|three french hens,|four calling birds,|five gold rings,|six geese a-laying,|seven swans a-swimming,|eight maids a-milking,|nine ladies dancing,|ten lords a-leaping,|eleven pipers piping,|twelve drummers drumming,".Split('|');for(int i=1;i<13;i++)Console.Write("On the {0}{2} day of christmas, my true love gave to me \r{1}\r\r",i,String.Join("\r",l.Take(i).Reverse().ToArray()),(i==1?"st":i==2?"nd":i==3?"rd":"th")); 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-12-21T03:08:16.743

Objective-C / Cocoa

```
NSArray *days = [NSArray arrayWithObjects:@"first", @"second", @"third", @"forth", 
                    @"fifth", @"six", @"seventh", @"eigth", 
                    @"ninth", @"tenth", @"eleventh", @"twelth", nil];

NSArray *gifts = [NSArray arrayWithObjects:
                    @"a partridge in a pear tree.\n\n",
                    @"two turtle doves, and\n",
                    @"three french hens,\n",
                    @"four calling birds,\n",                      
                    @"five gold rings,\n",
                    @"six geese a-laying,\n",
                    @"seven swans a-swimming,\n",
                    @"eigth maids a-milking,\n",                     
                    @"nine ladies dancing,\n",
                    @"ten lords a-leaping,\n",
                    @"eleven pipers piping,\n",    
                    @"twelve drummers drumming,\n",
                    nil];

NSMutableString *aggregator = [NSMutableString string];
for(int i = 0; i < 12; i++) {
    [aggregator insertString:[gifts objectAtIndex:i] atIndex:0];
    printf("on the %s day of xmas, my true love gave to me %s", [[days objectAtIndex:i] UTF8String], [aggregator UTF8String]);
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2008-12-21T16:27:57.533

一条线怎么样！这是在 C# 中。

```
Xmas(){Console.WriteLine("On the first day of Christmas,\r\nmy true love sent to me\r\nA partridge in a pear tree.\r\n\r\nOn the second day of Christmas,\r\nmy true love sent to me\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the third day of Christmas,\r\nmy true love sent to me\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the fourth day of Christmas,\r\nmy true love sent to me\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the fifth day of Christmas,\r\nmy true love sent to me\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the sixth day of Christmas,\r\nmy true love sent to me\r\nSix geese a-laying,\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the seventh day of Christmas,\r\nmy true love sent to me\r\nSeven swans a-swimming,\r\nSix geese a-laying,\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the eighth day of Christmas,\r\nmy true, love sent to me\r\nEight maids a-milking,\r\nSeven swans a-swimming,\r\nSix geese a-laying,\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the ninth day of Christmas,\r\nmy true love sent to me\r\nNine ladies dancing,\r\nEight maids a-milking,\r\nSeven swans a-swimming,\r\nSix geese a-laying,\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the tenth day of Christmas,\r\nmy true love sent to me\r\nTen lords a-leaping,\r\nNine ladies dancing,\r\nEight maids a-milking,\r\nSeven swans a-swimming,\r\nSix geese a-laying,\r\nfive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the eleventh day of Christmas,\r\nmy true love sent to me\r\nEleven pipers piping,\r\nTen lords a-leaping,\r\nNine ladies dancing,\r\nEight maids a-milking,\r\nSeven swans a-swimming,\r\nSix geese a-laying\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree.\r\n\r\nOn the twelfth day of Christmas,\r\nmy true love sent to me\r\nTwelve drummers drumming,\r\nEleven pipers piping,\r\nTen lords a-leaping,\r\nNine ladies dancing,\r\nEight maids a-milking,\r\nSeven swans a-swimming,\r\nSix geese a-laying,\r\nFive golden rings,\r\nFour calling birds,\r\nThree French hens,\r\nTwo turtle doves,\r\nAnd a partridge in a pear tree!");} 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2008-12-23T03:02:25.350

**C#：395 个字符**（不包括空格...）

```
for (var x = 0; x++ < 12; )
    Console.Write(
        "On the {0} day of Christmas,\nMy true love gave to me\n{1}\n\n",
        x + (x < 2 ? "st" : x < 3 ? "nd" : x < 4 ? "rd" : "th"),
        String.Join(
            "\n",
            "a partridge in a pear tree.|turtle doves and|french hens|calling birds|gold rings|geese a-laying|swans a-swimming|maids a-milking|ladies dancing|lords a-leaping|pipers piping|drummers drumming"
                .Split('|').Take(x).Select((y, i) => (i > 0 ? (i + 1) + " " : "") + y).Reverse().ToArray()
        )
    ); 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2008-12-23T12:26:36.583

这是一个 erlang 版本（约 586 个字符）：

```
-module (xmas).
-export ([xmas/0]).
xmas() ->
    W = ["twelve drummers drumming, ",
    "eleven pipers piping, ",
    "ten lords a-leaping, ",
    "nine ladies dancing, ",
    "eight maids a-milking, ",
    "seven swans a-swimming, ",
    "six geese a-laying, ",
    "five gold rings, ",
    "four calling birds, ",
    "three french hens, ",
    "two turtle doves, and ",
    "a partridge in a pear tree."],
    io:format(lists:foldl(
    fun(X,Acc) -> Acc ++ X ++ "~n" end, "",
    ["On the " ++ day_str(Q) ++ 
    " day of Christmas, my true love gave me " ++ 
    lists:foldl(
        fun(X,Acc)-> Acc++X end,
        "", lists:nthtail(12-Q,W)) || 
        Q <- lists:seq(1,12)]),[]).
day_str(Q) ->
    case Q of
        1 -> "1st";
        2 -> "2nd";
        3 -> "3rd";
        N -> erlang:integer_to_list(N,10) ++ "th"
    end. 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2009-02-11T01:37:03.937

### Python，436 个字符

（443 包括可选的换行符）

```
print """
eJzlk91xxCAMhN9TxRZwSRMp4GpQjGw04ccDunOu+wjcgMkkk8vlxRjQst9q4JygnjFLqQpHN+QZ
r75I1UgV8QYtF0bIV8ZC9tGMyCCsVLSIWxiS2pSpWCnzy9N5P7HylJM7fqRuGXopGhjOtuoJZPID
RuqljPh4E2MunCYPz8mMvmw9Z1P5496tHhOFIGnBm2E38+/kkXkIR9o8B4diQGbz03xVPkb4rBwL
c7X79hzoZlCnX2DmK6ch6iZA3ShV466bxNjJ7yINy6J+JE0XIJK4liZKeN/D3HPIJIlHMrZ6BHLC
1URp6tR/MbiO3VQrt7XSAwamtUM/TDM4jL7cXYFVVi61DR38sbukG4fr0GvZFXDlEmPrU//Z8/+j
/n0CsHRGTA==
""".decode("base64").decode("zlib") 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2009-02-11T14:11:11.020

即使已经结束了一段时间，我仍然喜欢尝试这些代码高尔夫挑战......

我能用**MATLAB 做的最好的事情：383**个字符（删除空格和续行符号后）

```
a = {'twelve drummers drumming';...
     'eleven pipers piping';...
     'ten lords a-leaping';...
     'nine ladies dancing';...
     'eight maids a-milking';...
     'seven swans a-swimming';...
     'six geese a-laying';...
     'five gold rings';...
     'four calling birds';...
     'three french hens';...
     'two turtle doves and';...
     'a partridge in a pear tree.';’’};
b = {'st','nd','rd','th'};
for i = 1:12,...
  disp(char(['On the ',num2str(i),b{min(i,4)},...
             ' day of Christmas my true love gave to me'],...
            a{13-i:13}));...
end 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2008-12-20T19:27:15.020

423 字节，Lingua::EN::Number：

```
use Lingua::EN::Numbers qw/num2en num2en_ordinal/;
@l=map{($i++?num2en($i):'a')." $_"}split/\n/,<<"";
partridge in a pear tree
turtle doves, and
french hens
calling birds
gold rings
geese a-laying
swans a-swimming
maids a-milking
ladies dancing
lords a-leaping
pipers piping
drummers drumming

print"On the ".num2en_ordinal($_+1)
." day of Christmas, my true love gave to me ",
join(', ',reverse@l[0..$_]),"\n\n"for(0..11); 
```

或者不使用 Lingua::EN::Numbers 的 perl 中的 480 字节：

```
@n=qw/first second third forth fifth sixth seventh eigth nineth tenth eleventh twelfth/;
@l=<DATA>;chomp@l;
print"On the $n[$_] day of Christmas, my true love gave to me ",
join(', ',reverse@l[0..$_]),"\n\n"for(0..11);
__DATA__
a partridge in a pear tree
two turtle doves, and 
three french hens
four calling birds 
five gold rings 
six geese a-laying
seven swans a-swimming
eight maids a-milking
nine ladies dancing
ten lords a-leaping
eleven pipers piping
twelve drummers drumming 
```

它应该能够进一步减少，因为数字非常重复。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2008-12-21T02:42:11.117

```
Console.WriteLine(File.ReadAllText("12daysxmas.txt")); 
```

（将字符串常量与代码分开是一种很好的做法，这样您就可以轻松地翻译它们。）

`dynamic`另外，这是我对C# 4 中即将到来的关键字的致敬：

```
string lyric = "On day {0} of Christmas a dynamic gave to me {1} dynamics.";

int total = 0;
for (int day = 1; day <= 12; day++)
{
    total += day;
    Console.WriteLine(string.Format(lyric, day, total));
}

Console.WriteLine("I wonder what all these dynamics are? I guess I'll find out at runtime."); 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2008-12-22T21:38:36.003

**Ruby：458 个字符**
（+ 4 个换行符使其保持在 80 列以下）

```
n=%w{first second third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth}
s=''
["a partridge in a pear tree","two turtle doves, and","three french hens",
"four calling birds","five gold rings","six geese a-laying","seven swans a-swimming",
"eight maids a-milking","nine ladies dancing","ten lords a leaping",
"eleven pipers piping","twelve drummers drumming"].map{|p|
puts "On the #{n.pop} day of Christmas my true love gave to me: "+(s=p+', '+s)} 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2008-12-23T16:29:21.150

Java，基于 Esko 的第二种解决方案：

```
class C{
    public static void main(String[]d){
        String s="";
        d="first1second1third1fourth1fifth1sixth1seventh1eighth1ninth1tenth1eleventh1twelfth".split("1");
        String[]g="a partridge in a pear tree1two turtle doves,\nand 1three french hens,\n1four calling birds,\n1five gold rings,\n1six geese a-laying\n1seven swans a-swimming,\n1eight maids a-milking,\n1nine ladies dancing,\n1ten lords a-leaping,\n1eleven pipers piping,\n1twelve drummers drumming,\n".split("1");
        for(int i=0;i<12;)
            System.out.println("On the "+d[i]+" day of Christmas my true love gave to me:\n"+
                    (s=g[i++]+s)+".\n");
    }
} 
```

如果我计算正确，那是 579 个字符（不包括缩进和换行符）。而这个是完全可运行的，并且不会将每一节都打印在一行上。输出是：

> 在圣诞节的第一天，我的真爱给了我：
> 梨树上的一只鹧鸪。
> 
> 圣诞节的第二天，我的真爱给了我：
> 两只斑鸠，和
> 梨树上的一只鹧鸪。
> 
> 在圣诞节的第三天，我的真爱给了我：
> 三只法国母鸡、
> 两只斑鸠和
> 梨树上的一只鹧鸪。
> 
> ...

* * *

编辑：略微改进的版本，基于 balabaster 用一个字符替换公共字符串的想法：

```
class C{
    public static void main(String[]d){
        String s="";
        d="first1second1third1fourth1fifth1sixth1seventh1eighth1ninth1tenth1eleventh1twelfth".split("1");
        String[]g="a partridge in a pear tree1two turtle doves,\nand 1three french hens,\n1four calling birds,\n1five gold rings,\n1six geese a-lay#seven swans a-swimm#eight maids a-milk#nine ladies danc#ten lords a-leap#eleven pipers pip#twelve drummers drumm#".replace("#","ing,\n1").split("1");
        for(int i=0;i<12;)
            System.out.println("On the "+d[i]+" day of Christmas my true love gave to me:\n"+
                (s=g[i++]+s)+".\n");
    }
} 
```

它现在减少到 562 个字符（尽管我添加了一个以前错过的逗号）。

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2009-07-14T16:09:22.713

这不会赢，但这是我的 576 个字符的 Java 版本（可编译和可运行）。

```
class T{enum D{first,second,third,fourth,fifth,sixth,seventh,eighth,ninth,tenth,eleventh,twelfth}public static void main(String[] args){String o="",s="s, ",i="ing, ";String t[]={"a partridge in a pear tree","two turtle doves, and ","three french hen"+s,"four calling bird"+s,"five gold ring"+s,"six geese a-lay"+i,"seven swans a-swimm"+i,"eight maids a-milk"+i,"nine ladies danc"+i,"ten lords a-leap"+i,"eleven pipers pip"+i,"twelve drummers drumm"+i};int j=0;while(j<12)System.out.println("On the "+D.values()[j]+" day of Christmas my true love gave to me "+(o=t[j++]+o));}} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-12-21T01:34:29.320

这里有一些 C# 的不同方法

```
List<string> lines = new List<string>(new string[]{
    "twelve drummers drumming,\n\r"
    , "eleven pipers piping,\n\r"
    , "ten lords a-leaping,\n\r"
    , "nine ladies dancing,\n\r"
    , "eigth maids a-milking,\n\r"
    , "seven swans a-swimming,\n\r"
    , "six geese a-laying,\n\r"
    , "five gold rings,\n\r"
    , "four calling birds,\n\r"
    , "three french hens,\n\r"
    , "two turtle doves, and \n\r"
    , "a partridge in a pear tree."
    });

string[] day = {
    "first"
    ,"second"
    ,"thrid"
    ,"forth"
    ,"fifth"
    ,"six"
    ,"seventh"
    ,"eigth"
    ,"ninth"
    ,"tenth"
    ,"eleventh"
    ,"twelth"
    };

for (int i = 0; i < 12; i++)
    Console.WriteLine(string.Format("On the {0} day of christmas, my true love gave to me\n\r{1}", day[i], string.Concat(lines.GetRange(11 - i, i + 1).ToArray()))); 
```

不是很好。但它很小。:)

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-12-21T19:21:24.580

没有看到 Java 的任何内容（顺便说一句，它的最小语法并不为人所知）所以首先我做了这个

```
String g;
public void sing() {
    g = "";     
    for(Entry<?,?> e : mm("first", "a partridge in a pear tree",
                          "second", "two turtle doves, and ",
                          "third", "three french hens, ",
                          "fourth", "four calling birds, ",
                          "fifth", "five gold rings, ",
                          "sixth", "six geese a-laying ",
                          "seventh", "seven swans a-swimming, ",
                          "eigth", "eight maids a-milking, ",
                          "ninth", "nine ladies dancing, ",
                          "tenth", "ten lords a-leaping, ",
                          "eleventh", "eleven pipers piping, ",
                          "twelfth", "twelve drummers drumming, ").entrySet()) {
        System.out.println("On the "+e.getKey()+
                " day of Christmas my true love gave to me "+e.getValue()+".");
    }
}

public Map<?,?> mm(String... s) {
    Map m = new LinkedHashMap();
    for(int i=0;i<s.length;i=i+2) {
        g = s[i+1] + g;
        m.put(s[i], g);
    }
    return m;
} 
```

并意识到它相当复杂（重 708 个字符），所以我选择了一个更简单的解决方案（改编自其他答案，行更改仅是为了便于阅读）：

```
public void sing() {
    String s = "";
    String[]d={"first","second","third","fourth",
           "fifth","sixth","seventh","eighth",
           "ninth","tenth","eleventh","twelfth"};
    String[]g={"a partridge in a pear tree",
           "two turtle doves, and ",
           "three french hens, ",
           "four calling birds, ",
           "five gold rings, ",
           "six geese a-laying ",
           "seven swans a-swimming, ",
           "eight maids a-milking, ",
           "nine ladies dancing, ",
           "ten lords a-leaping, ",
           "eleven pipers piping, ",
           "twelve drummers drumming, "};
    int i=0;
    while(i<12)
        System.out.println("On the "+d[i]+" day of Christmas my true love gave to me "+
            (s=g[i++]+s)+".");
} 
```

这是没有空格的 576 个字符，如果方法签名切换到正确的 main() 那么它是 596。

如果我有兴趣制作第三个版本，我也会尝试枚举技巧。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-12-24T00:10:43.603

AC/C++ 版本使用单个缓冲区和指针算法。一个包含，一个声明，技术上只有两行代码在 main 中进行打印：

```
#include <stdio.h>

char *days =
    "twelve drummers drumming,  \n"
    "eleven pipers piping,      \n"
    "ten lords a-leaping,       \n"
    "nine ladies dancing,       \n"
    "eight maids a-milking,     \n"
    "seven swans a-swimming,    \n"
    "six geese a-laying,        \n"
    "five gold rings,           \n"
    "four calling birds,        \n"
    "three french hens,         \n"
    "two turtle doves, and      \n"
    "a partridge in a pear tree.\n\n";

void main()
{
    for (int i = 1; i <= 12; i++)
        printf("On the %d%s day of Christmas, my true love gave to me:\n%s",
                i,i == 1 ? "st" : (i == 2 ? "nd" : "th"), days + (12-i)*28);
} 
```

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-12-24T01:13:45.897

C ++中非常简单的解决方案：

```
#include <iostream.h>
char*a[]={"a partridge in a pear tree.\n","two turtle doves, and","three french hens,","four calling birds,","five gold rings,","six geese a-laying,","seven swans a-swimming,","eight maids a-milking,","nine ladies dancing,","ten lords a-leaping,","eleven pipers piping,","twelve drummers drumming,"};
char*b[]={"first","second","third","fourth","fifth","sixth","seventh","eighth","nineth","tenth","eleventh", "twelfth"};
int main(){for(int i=0;i<12;i++){std::cout<<"On the "<<b[i]<<" day of Christmas my true love gave to me, \n";for(int j=i;j>=0;j--)std::cout<<a[j]<<" \n";}} 
```

595 个字符，但如果您允许某些人使用的“1st, 2nd, 3rd”等符号，它可以减少到 513 个字符。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2009-01-16T20:50:16.653

**LUA 540（没有标签和返回）**

```
t={"twelve drummers drumming,","eleven pipers piping,","ten lords a-leaping,","nine ladies dancing,","eight maids a-milking,","seven swans a-swimming,","six geese a-laying,","five gold rings,","four calling birds,","three french hens,","two turtle doves, and","a partridge in a pear tree."} 

f=function(i) 
    r=i.."th" 
    if (i==1) then r=i.."st" 
    elseif (i==2) then r=i.."nd" 
    elseif (i==3) then r=i.."rd" 
    end 
    return r 
end 

for i=1,12 do 
    s="On the "..f(i).." day of Christmas my true love gave to me" 
    for j=13-i,12 do 
        s=s.." "..t[j] 
    end 
    print(s) 
end 
```

不幸的是，我们没有字符串到数组函数或通过日期库执行“第一次”的方法。正确运行于[http://www.lua.org/cgi-bin/demo](http://www.lua.org/cgi-bin/demo)

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2009-07-14T15:42:35.093

这是一个Javascript版本。我能做的最好的就是压缩后的 497 个字符。

```
s = "", k = "ing, ", t = [":first:a:partridge in a pear tree", 
                ":second:two:turtle doves, and ", 
                "th:ird:ree:french hens, ",
                "four:th::calling birds, ", 
                "fi:fth:ve:gold rings, ", 
                "six:th::geese a-lay" + k,
                "seven:th::swans a-swimm" + k,
                "eight:h::maids a-milk" + k,
                "nin:th:e:ladies danc" + k, 
                "ten:th::lords a-leap" + k,
                "eleven:th::pipers pip" + k,
                "twel:fth:ve:drummers drumm"]

for (i = 0; i < 12; i++)
    document.write("On the " + (v = t[i].split(":"))[0] + v[1]
                    + " day of Christmas my true love gave to me "
                    + (s = v[0] + v[2] + " " + v[3] + s) + "<p>")

s="",k="ing, ",t=[":first:a:partridge in a pear tree",":second:two:turtle doves, and ","th:ird:ree:french hens, ","four:th::calling birds, ","fi:fth:ve:gold rings, ","six:th::geese a-lay"+k,"seven:th::swans a-swimm"+k,"eight:h::maids a-milk"+k,"nin:th:e:ladies danc"+k,"ten:th::lords a-leap"+k,"eleven:th::pipers pip"+k,"twel:fth:ve:drummers drumm"];for(i=0;i<12;i++)document.write("On the "+(v=t[i].split(":"))[0]+v[1]+" day of Christmas my true love gave to me "+(s=v[0]+v[2]+" "+v[3]+s)+"<p>") 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2010-02-19T18:15:48.150

偶然发现这个线程，它看起来非常有趣，我无法抗拒 - 这是另一个 JavaScript 版本 - 它不是最短的，但我喜欢它在循环内使用递归和闭包的方式。

```
(function(){
    var v = [
        {d:'first', p:'a partridge in a pear tree'},
        {d:'second', p:'two turtle doves, and '},
        {d:'third', p:'three french hens, '},
        {d:'fourth', p:'four calling birds, '},
        {d:'fifth', p:'five gold rings, '}, 
        {d:'sixth', p:'six geese a-laying, '}, 
        {d:'seventh', p:'seven swans a-swimming, '},
        {d:'eighth', p:'eight maids a-milking, '},
        {d:'ninth', p:'nine ladies dancing, '}, 
        {d:'tenth', p:'ten lords a-leaping, '},
        {d:'eleveth', p:'eleven pipers piping, '},
        {d:'twelth', p:'twelve drummers drumming, '}
    ];
    for (var i=0;i<12;i++)
    {
        document.write('On the '+v[i].d+' day of Christmas my true love gave to me ');
        (function(i){
            document.write(v[i].p);
            if (i>0)
            {
                arguments.callee(--i);
            }
        })(i);
        document.write('.<p>');
    }
})(); 
```

# javascript - 将 javascript 嵌入为 base64

> ID：383405
> 
> 赞同：13
> 
> 时间：2008-12-20T15:22:12.550
> 
> 标签：javascript, embed, base64

我正在开发一个小的 GreaseMonkey 脚本，我想在其中嵌入一个 jQuery 插件（Markitup），以便该脚本是完全自包含的（图像 + js），除了由谷歌提供的 jQuery。

我找到了网站[http://www.greywyvern.com/code/php/binary2base64](http://www.greywyvern.com/code/php/binary2base64)，它说如果你对脚本进行 base64 编码，你可以使用 href 嵌入 javascript，就像从 CSS 中将图像作为 basse64 一样。

```
<script type="text/javascript" href="data:text/javascript;base64,dmFyIHNjT2JqMSA9IG5ldyBzY3Jv..."></script> 
```

所以我尝试了，但根本无法让它工作，在 OS X 上使用 Firefox 3.0.5。

我整理了一个小测试页面来隔离问题，但也无法让它在该页面上工作。

```
<!DOCTYPE HTML>
<html>
   <head>
      <title>Title</title>
      <meta charset="utf-8">
   </head>
   <body>
      <script href="data:text/javascript;base64,YWxlcnQoJ2FzYWRhc2QnKTsK"></script> 
      <script>alert('a');</script>  
   </body>
</html> 
```

base64 字符串 (YWxlcnQoJ2FzYWRhc2QnKTsK) 说`alert('asadasd');`，所以我应该得到两个警报，但我看到的唯一一个是警报位于脚本标记内的文本的第二个。

我做错了什么或者为什么这不起作用，有什么想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-20T16:09:21.067

也许只是一个想法，但也许“href”应该是“src”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T16:09:52.610

如果您检查脚本标签语法，您会得到

```
<script src="..."
        ^^^
        src NOT href 
```

在此处使用数据 URI 在 IE 6 中不起作用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T17:58:44.450

这很有趣，我正在处理完全相同的问题：制作一个 Greasemonkey 脚本以将 markItUp 添加到页面的所有文本区域。

现在，库脚本本身没有问题。无论如何，我不明白你为什么要将它作为 Base64 插入。正如所指出的，它会更大。
如果你愿意，你可以直接把它放在 GM 脚本中（有些人用 jQuery 这样做），或者动态添加 a`<script src="someURL"></script>`到文档中并等待加载（网上有很多这样的例子）（不方便：在保存文件的站点），或者，就像我目前正在尝试的那样，使用 GM 的最新（0.8）功能：

```
// @require      jquery.js
// @require      markitup.js
// @resource     miuStyle style.css 
```

所需的 JS 文件会自动从本地副本加载到 GM 脚本中，速度快且始终可用。不要使用打包版本，它们在这里不起作用。我也遇到了 set.js 的问题，所以我直接在脚本中输入。
它运作良好，但我还没有样式和图标。
我认为，我必须将 miuStyle 文本放在网页中，然后对其进行更改，以便所有背景图像都指向 Photobucket 或类似服务器上托管的相同图像，并带有偏移量。我还没有找到一种使用本地图像（在 CSS 中）的方法，唉，即使使用 @resource。

唉，我的回答并没有解决你的问题（但约翰的话似乎是有效的），但它可能会让你找到另一个更简单的解决方案。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2015-11-18T01:02:08.710

Base-64 使文件更大，但它使其更具机器可读性，因此它实际上提高了页面速度。除非您想查看文件中的 50 行乱码，否则我绝对可以理解您为什么想要这个。仅供参考，我刚刚阅读了一项研究，base 64 实际上在移动设备上加载速度较慢，所以如果您的应用程序是重型移动设备，我会远离

# erlang - 出于学习目的，在 Erlang 中有哪些有趣的项目需要解决？

> ID：383407
> 
> 赞同：26
> 
> 时间：2008-12-20T15:24:13.433
> 
> 标签：erlang, distributed, concurrency

我最近发现了 Erlang，现在正在学习一些教程。到目前为止，我期待着将一些东西作为一个爱好项目来实际实施。我对另一个聊天服务器并不感兴趣。我想编写一些更有趣的代码（是的，我知道这是一个相当模糊的术语），这也是易于管理的，所以我可以在业余时间完成它。

有什么建议么？

编辑：该项目最好突出 Erlang 的优势（并发、分布式）。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2012-06-01T04:57:57.077

1.  构建一个分布式系统，实时搜索 Twitter 提要，并允许任何人从 Web 前端执行搜索。

2.  构建分布式文件系统。实现分布式 B*Trees 或 B+Trees 作为此文件系统的基础。用二郎做。

3.  在步骤 2 中构建的分布式文件系统之上构建分布式键值存储。

4.  在键值存储之上构建分布式网络索引（供分布式网络搜索引擎使用）。

5.  构建分布式链接器。[高级构建自动化为分布式构建](http://en.wikipedia.org/wiki/Build_automation)和/或分布式处理提供远程代理处理。

6.  构建一个 MMORPG 后端，该后端依赖于游戏/玩家状态的分布式存储和用户请求的分布式处理。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-20T19:06:35.157

对于自己的东西，考虑编写一个简单的服务器；例如，服务日期/时间请求的东西，或者 - 有点花哨 - 一个只提供静态内容的 HTTP 守护程序。

Erlang 最好的部分是它处理并发的方式。锻炼那个。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-20T15:58:13.927

[欧拉计划](http://www.projecteuler.net/)，当然。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-20T16:24:04.873

我丰富的 ToDo 列表中的一些东西既是很好的学习练习，又对整个 erlang 社区有帮助：

*   分析所有可用的键/值存储：

    *   编写一个库，用于测试各种 K/V 存储的插入、查找、删除、搜索时间
    *   创建一个人们可以运行的基准套件
    *   让它与 ets、dets、proplists、gb_trees、dict、orddict、redblack 树、bdb、tokyocabinet 一起工作。
    *   制作漂亮的图表
    *   让更新、贡献和在任何人的机器上运行变得容易
*   编写一个使用命名参数的新 io_lib:format 例程：

    *   io_lib:nformat("你好~{name}s~n.", [{name, "Bob"}]).
    *   如果格式字符串的语言更改时参数的位置发生更改，这对于国际化很有用。
*   扩展 erl -make (make.erl)

    *   允许添加代码路径（这样您就不需要执行 erl -pa LibraryPath -make）
    *   在实现这些行为的模块之前编译/加载行为模块
    *   正确处理分层模块（特别是输出路径）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-20T15:31:25.120

这并不能完全回答您的问题，但是如果您正在寻找一个有趣的、用 Erlang 编写的免费开源项目，那么您绝对应该查看 CouchDB。从网站：

> Apache CouchDB 是一个分布式、容错和无模式的面向文档的数据库，可通过 RESTful HTTP/JSON API 访问。除其他功能外，它还提供具有双向冲突检测和解决的强大的增量复制功能，并且可以使用面向表的视图引擎（以 JavaScript 作为默认视图定义语言）进行查询和索引。
> 
> CouchDB 是用 Erlang 编写的，但可以从任何提供 HTTP 请求方法的环境轻松访问。有大量的第三方客户端库使这对于各种编程语言和环境变得更加容易。

[CouchDB 网站](http://couchdb.apache.org/ "CouchDB 网站")有更多详细信息。快乐编码！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-03T21:31:15.467

找到你理解和喜欢的 erlang 没有的东西。我用 etap 做到了[https://github.com/ngerakines/etap/](https://github.com/ngerakines/etap/)现在 nick 已经接管了管理，它在 EA 游戏内部使用。制作很有趣，就像以前的海报一样，它是真实的，所以我学会了解决现实世界的问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-22T17:05:50.373

文件索引/搜索系统。这将通过介绍项目进行，但我已经切换到其他内容。

一旦你得到它的工作，你可以将索引移动到 mnesia，然后将东西分散到其他节点上，以获得一个完整的网络索引。

# qt - 在 QWidget 上安装 EventFilter (qt4.4.3/kde4)

> ID：383414
> 
> 赞同：5
> 
> 时间：2008-12-20T15:30:53.123
> 
> 标签：qt, event-handling, widget, kde

我有一个 K* 窗口，其中有一个需要过滤事件的小部件。

例如，我不希望点击它的可能性......

我怎样才能做到这一点？

我必须使用事件过滤器吗？在这种情况下，最好的方法是什么？

* * *

但我的问题是我不能子类化我的小部件，因为它是 TerminalInterface->widget()，而不是像其他对象：\

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T17:44:56.897

除了第一个答案中的 setEnabled sledgehammer 方法外，还有其他两种方法，其中一种是使用事件过滤器。

另一种是子类化小部件，然后重新实现，比如说，鼠标*事件。只需将它们留空即可防止任何鼠标交互。所以：

MyWidget : public QSomeWidget { Q_OBJECT public: MyWidget(QWidget *parent);

protected: void mousePressEvent(QMouseEvent *) {} .. etc .. };

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T16:46:53.097

QWidget 有一个`enabled`属性。只需调用`widget->setEnabled(false)`，这将阻止它接受鼠标点击。它还可以修改其外观：例如 a`QPushButton`将变灰。

事件过滤器听起来像你想要的过度杀伤力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T16:55:34.793

看起来`eventFilter()`就是你想要的。

这是讨论它的 Qt 文档部分： [事件过滤器](http://doc.qt.io/qt-5/eventsandfilters.html#event-filters)

基本上你必须创建一个继承`QObject`然后实现虚函数的类`eventFilter()`。然后在要过滤的对象上调用[installEventFilter()方法，并将过滤器作为参数。](https://doc.qt.io/qt-5/qobject.html#installEventFilter)

# .net - 使用 ReaderWriterLockSlim 会导致内存障碍吗？

> ID：383416
> 
> 赞同：2
> 
> 时间：2008-12-20T15:32:33.573
> 
> 标签：.net, multithreading, locking

如果我`ReaderWriterLockSlim`用来获取读/写锁，我需要制作变量`volatile`还是使用`Interlocked.Increment`？

例如，`Add`下面方法中的代码是否可以正常工作，还是需要增强？

```
public class AppendableList<T> { // semi-immutable; supports appending only
    private T[] data = new T[16];
    private ReaderWriterLockSlim rwLock = new ReaderWriterLockSlim();
    public int Count { get; private set; }
    public T this[int index] {
        get {
            rwLock.EnterReadLock();
            try { return data[index]; } finally { rwLock.ExitReadLock(); }
        }
    }
    public void Add(T item) {
        rwLock.EnterUpgradeableReadLock();
        try {
            if (Count == data.Length)
                reAllocateArray(); // upgrades to write lock
            data[Count++] = item; // do I need to use Interlocked here?
        } finally { rwLock.ExitUpgradeableReadLock(); }
    }
} 
```

**编辑：**我正在尝试编写一个轻量级、快速且简单的列表，该列表允许多个线程同时访问其数据（类似于生产者-消费者缓冲区）。我已经编辑了上面的代码，删除了我之前使用的简化，所以现在问题应该更清楚了。在我看来，这段代码是线程安全的，但我不确定`Count`在退出可升级锁后是否所有线程都会看到更新的值。

**编辑2**：这里的“写”锁用于指示写入*数组引用*，而不是数组元素。我假设这已经足够了（因为数据本身是不可变的）。我想我需要在递增时使用 Interlocked `Count`。真的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-20T15:34:56.393

我完全*希望*写锁能够充当内存屏障（特别是在写锁内），但我无法立即证明这一点。

是否需要复杂度`ReaderWriterLockSlim`取决于上下文；`Interlocked`, `volatile`,`lock`或者`[MethodImpl]`每个人都可以更简单地完成这项工作。`ReaderWriterLock[Slim]`如果你有很多读者和很少的作家，你主要需要。

但是，`get`当前不受锁保护；如果您需要写锁跨越多个操作（没有读者看到中间值），您将需要我们一个显式的属性实现并自己取出一个读锁。

顺便说一句，`Count++`人们可能会更熟悉这种用法。

您还应该使用`try`/`finally`来确保您释放异常锁定。

为了避免先写后读锁的问题，也许：

```
 private ReaderWriterLockSlim rwLock = new ReaderWriterLockSlim();

    private int count;
    public int Count {
        get {
            rwLock.EnterReadLock();
            int tmp = count;
            rwLock.ExitReadLock();
            return tmp;
        }
    }
    public void Add(object x) {
        rwLock.EnterWriteLock();
        try {
            // do some processing
            count++;
        } finally {
            rwLock.ExitWriteLock();
        }
    } 
```

* * *

更新了您的编辑；

这看起来很扎实。A`List<T>`将是我的建议（通过`T[]`数组），因为它会在内部完成所有加倍等操作，从而为您节省大量代码。由于一次只能更新一个线程`Count`，因此不需要`Interlocked`，并且此属性在读取 时节省了对锁的需要`Count`，只要您可以让调用者`Count`在另一个线程添加行时获取旧的（而不是被封锁）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T11:02:35.757

[是](http://www.microsoft.com/whdc/driver/kernel/MP_issues.mspx)的，对于各种内存屏障案例的非常深入的概述，请查看该文档，如果您还需要，您可以找到非围栏锁。

并且请**不要使用 VOLITILE，这些天它的效果越来越差！！**

> 所有标准 Windows 锁定机制（自旋锁、互斥锁、内核事件和由执行资源包管理的资源）通过在可执行代码中需要的地方插入内存屏障来防止处理器重新排序。
> 
> 内存屏障是从任何其他处理器的角度保留读取和/或写入操作顺序的处理器指令。内存屏障包括具有获取、释放和栅栏语义的处理器指令。这些语义描述了操作结果变得可见的顺序。
> 
> *   获取语​​义意味着操作的结果在代码中出现在它之后的任何操作的结果之前是可见的。
> *   释放语义意味着操作的结果在代码中出现在它之前的任何操作的结果之后是可见的。
> *   栅栏语义结合了获取和释放语义。具有栅栏语义的操作的结果在代码中出现在它之后的任何操作的结果之前以及出现在它之前的任何操作的结果之后都是可见的。

# c# - 使用（流利的）NHibernate 和 StructureMap（或任何 IoCC）

> ID：383440
> 
> 赞同：5
> 
> 时间：2008-12-20T16:08:12.940
> 
> 标签：c#, nhibernate, fluent-nhibernate, structuremap

在我学习 NHibernate 的过程中，我遇到了下一个障碍；我应该如何将它与 StructureMap 集成？

尽管代码示例非常受欢迎，但我对一般过程更感兴趣。

我本来打算做的是...

*   使用 Fluent NHibernate 创建我的类映射以在 NHibers 配置中使用
*   实现 ISession 和 ISessionFactory
*   将我的 ISessionFactory 实例作为单例引导到 StructureMap 中
*   使用 StructureMap 注册 ISession，并使用每个 HttpRequest 缓存

但是，我不需要在 HttpRequest 结束时在我的会话实例上调用各种整理方法吗（因为那是它生命的尽头）？

如果我在 Dispose() 中进行整理，structuremap 会为我解决这个问题吗？

如果没有，我该怎么办？

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T02:00:53.657

我在我当前的 3 个项目中使用带有 fluent-nhibernate（和 NH Validator）的 StructureMap。其中两个是 ASP MVC 应用程序，第三个是 WCF Web 服务。

您的一般策略听起来是正确的（除非您不会制作自己的 Session 或 SessionFactory，正如评论中已经指出的那样）。有关详细信息，请从此处获取我的配置代码：

[http://brendanjerwin.github.com/development/dotnet/2009/03/11/using-nhibernate-validator-with-fluent-nhibernate.html](http://brendanjerwin.github.com/development/dotnet/2009/03/11/using-nhibernate-validator-with-fluent-nhibernate.html)

这篇文章实际上是关于集成 NH Validator 和 Fluent-NHibernate，但您可以在文章的“Bonus”部分准确了解我如何使用 StructureMap 注册会话工厂和 ISession。

RE：整理：您应该尝试并始终在事务中工作，并在工作单元结束时提交或回滚事务。NH 仅在需要 SQL 连接时才使用它们，并会为您清理有限的资源。正常的垃圾收集将自己处理您的会话。

Session Factory 是一个非常昂贵的对象，您只希望初始化一次并在应用程序的整个生命周期中保留它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T19:09:45.680

我没有使用结构图，但也许我仍然可以帮助引导您朝着正确的方向前进。Fluent nHibernate 是 hbm 文件的不错选择。

对于 http 请求，不需要确保在 http 请求结束时关闭会话。如果你不这样做，你最终会泄漏 nHibernate 会话。我不确定结构映射是否会为您处理这个问题，我所做的是我有一个关闭会话的 http 模块。

有一点需要注意，虽然这让我很生气，但您将确保将所有数据访问包装在事务中，并确保 nHibernate 实际提交其更改。如果您在会话关闭期间执行此操作，您可能会错过处理错误的机会。我很想知道你最终必须做些什么来完成这项工作。

# google-maps - 根据英国邮政编码生成谷歌地图

> ID：383444
> 
> 赞同：6
> 
> 时间：2008-12-20T16:10:18.333
> 
> 标签：google-maps, paf

是否可以使用英国邮政编码的谷歌地图 API 进行谷歌地图查找？我知道您可以在他们的网站上按英国邮政编码进行搜索，但这会转换为纬度/经度。我无权访问 PAF 数据库，无法转换为 long/lat。

一个例子：

用户有要出售的物品。该项目的详细信息之一是用户/项目所在的邮政编码。当商品在网站前端展示时，需要有使用邮政编码生成的商品位置的谷歌地图。

如果这是可能的，我该怎么做？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-05-20T11:50:53.767

如何使用：

```
<img src="http://maps.google.com/maps/api/staticmap?center=POSTCODEHERE&zoom=14&size=200x200&maptype=roadmap&markers=color:ORANGE|label:A|POSTCODEHERE&sensor=false" style="float: right"> 
```

然后将上面两节中的 POSTCODEHERE 替换为他们的邮政编码。

如果您愿意，您也可以从 200x200 或标记颜色、标签等更改尺寸。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T17:14:21.573

# 你*可以*通过谷歌地图纯粹地做到这一点。

今年早些时候我为一个客户做了这个，只需要做一些修改。我也做了一些方向把握。这一切都非常简单，但最好在上下文中查看。

看看[我制作的页面](http://www.bandcmotors.com/findus)的来源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T16:57:24.480

由于皇家邮政发布邮政编码数据的许可模式，谷歌在英国没有提供地理编码 API。

然而，人们编写的一些工具可以使用谷歌进行地理编码，但这在技术上是非法的 afaik。

然后一种选择是使用几个英国地理编码提供商之一。我不想听起来很懒，但他们很容易被谷歌搜索到。他们通常对每个地理编码收取几便士的费用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-28T19:16:00.250

（现在）使用 google 的 LocalSearch API 很容易做到这一点：

```
function usePointFromPostcode(postcode, callbackFunction) {
    localSearch.setSearchCompleteCallback(null, function() {
        if (localSearch.results[0]) {
            var resultLat = localSearch.results[0].lat;
            var resultLng = localSearch.results[0].lng;
            var point = new GLatLng(resultLat,resultLng);
            callbackFunction(point);
        } else {
            alert("Postcode not found!");
        }
    });

    localSearch.execute(postcode + ", UK");
} 
```

`callbackFunction()`根据我的经验，将收到一个带有非常准确坐标的 GLatLng 对象。事实上，将 GLatLng 提供给 GClientGeoCoder 的 getLocations() 方法并获取完整的 Placemark 详细信息（包括地址范围级别的详细信息（例如 1-18 Foo Street））是微不足道的。

真正的问题是：这有多*合法*？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T16:14:58.667

您需要 PAF 数据库，每个邮政编码都保存为一个多边形，因此除非您拥有初始数据，否则您不能将搜索限制在多边形或中心点周围的半径范围内。

[邮局会向您出售您](http://www.royalmail.com/portal/rm/jump2?mediaId=400085&catId=400084)需要的所有数据，价格从 85 英镑起。

PS。谷歌这样做是因为他们有 PAF 数据库，当你输入邮政编码时，他们会查找中心并将其显示在他们的地图上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-20T16:21:40.010

openstreetmap.org 背后的人一直在开发一个免费的等价物——我不知道它对黄金时段的准备情况如何，但 FWIW：

[http://freethepostcode.org/](http://freethepostcode.org/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T03:10:42.663

似乎没有人非常努力地搜索......[那里有一个免费可用的英国邮政编码和职位列表](http://www.easypeasy.com/guides/extras/uk-postcodes.zip)。更重要的是，这一切都是多余的，因为谷歌地图提供了通过邮政编码搜索的能力。即使使用 API 也是多余的，因为该服务是通过 Internet 提供的……只要您保留任何必要的版权消息等，就没有什么可以阻止您自己发送 http 请求并显示部分返回的数据。 .

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-22T23:39:03.750

[http://www.websemantics.co.uk/resources/postcode_to_coordinates_conversion_tool/](http://www.websemantics.co.uk/resources/postcode_to_coordinates_conversion_tool/)

网站将为您提供经度和纬度，您可以将其放入您的谷歌代码中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-10T16:00:00.867

英国小型企业或慈善机构可以申请免费使用 PAF 许可证。 [https://www.poweredbypaf.com/register-for-free-use-of-paf/](https://www.poweredbypaf.com/register-for-free-use-of-paf/)

# java - JSTL 打印 arrayList 元素

> ID：383449
> 
> 赞同：0
> 
> 时间：2008-12-20T16:15:26.187
> 
> 标签：java, jsp, jstl

我有一个 JSP 页面，它接收一个事件对象的 ArrayList，每个事件对象都包含一个日期的 ArrayList。我正在使用以下内容遍历事件对象：

如何遍历每个事件对象的 dateTimes ArrayList 并打印出每个事件的日期/时间？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-20T16:30:19.557

如果我理解你的问题，你基本上有一个 ArrayList 的 ArrayList。JSTL 对什么是有效的“项目”“集合”有一些相当奇怪的规则。[JSTL 1.2 规范](http://jcp.org/aboutJava/communityprocess/mrel/jsr052/index2.html)没有充分回答这个问题，所以我查看了源代码。

forEach 可以迭代：

*   本机或[对象](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html)类型的数组（**注意：**由于类型擦除，这包括任何通用数组）；
*   [集合](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Collection.html)或任何子类；
*   任何[迭代器](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Iterator.html)；
*   [枚举](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Enumeration.html)；_
*   任何实现[Map](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Map.html)的东西；或者
*   逗号分隔值作为[String](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html)。这是已弃用的行为。

**注意事项：**在这种情况下使用迭代器和枚举可能会出现问题，因为这样做会修改它们的状态并且无法重置它们（通过 JSTL）。

无论如何，代码很简单：

```
<%@ taglib uri="http://java.sun.com/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jstl/fmt" prefix="fmt" %>
<c:forEach var="event" items="${events}">
  <c:forEach var="date" items="${event}">
    <fmt:formatDate value="${date}" type="both"
      timeStyle="long" dateStyle="long" />
  </c:forEach>
</c:forEach> 
```

假设事件对象只是日期的集合。如果该集合是一个属性，那么只需替换`${event}`为`${event.dates}`或其他。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T16:31:07.403

```
<%@ taglib uri="http://java.sun.com/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jstl/fmt" prefix="fmt" %>
 <c:forEach items="${events}" var="event">
     <c:forEach items="${event.dates}" var="date">
          <fmt:formatDate value="${date}" type="both"
          timeStyle="long" dateStyle="long" />
      </c:forEach>
 </c:forEach> 
```

# c# - 重构参数和单元测试

> ID：383469
> 
> 赞同：2
> 
> 时间：2008-12-20T16:48:26.010
> 
> 标签：c#, unit-testing, parameters

我有这个方法：

```
public bool CanExecute() 
```

在 70 次提交之后，我添加了一个额外的参数

```
public bool CanExecute(IStation target) 
```

现在的问题是我有 7 个单元测试，涵盖了测试各种空值/属性组合的 CanExecute 方法。

添加这个简单的参数需要修复这 7 个单元测试。修复很简单，但是...

是否有最佳实践和/或模式来避免更新单元测试所需的这种手动重构？

假设我知道在不久的将来可能会添加一个额外的参数，我如何编写单元测试代码来解决这个问题？它只是矫枉过正还是有成语/模式/要遵循的东西？

**编辑：**我不能简单地添加重载，因为 IStation 依赖项不是可选的。我正在修复一个错误，其中需要一个 IStation 实例，但没有一个可用，所以它必须通过 CanExecute 提供......你看。

重构工具似乎是要走的路。谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-20T17:06:38.360

你不能在代码中保留这两种方法吗？除非 IStation 参数必须为非 null，否则您可以在不更改任何现有代码的情况下摆脱它。

或者，如果参数有一个合理的默认值（同样，像 null！），resharper 可以很容易地处理这样的变化。要添加新参数，请右键单击函数名称并选择更改签名... 从这里您可以添加具有合理默认值的新参数。RS 将更新所有呼叫，因此您不必这样做！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T17:08:44.737

您当然需要考虑是否在单元测试中复制了太多功能，但情况可能并非总是如此。

相当多的现代 IDE（C# 的 resharper）支持“更改方法”重构，它允许您为新参数提供默认值。我发现掌握这种重构功能真的很值得。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T17:30:58.810

如果您知道该方法可能会再次更改，我认为明智的做法是重载该方法并为重载的成员*添加*单元测试，而不是更改旧的单元测试。如果星星为您对齐，您甚至可能会发现重载的方法调用了原始的无参数方法，因此您只需为新参数编写测试，而无需重复原始的七个测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T19:34:53.240

我会保留两者。重载该方法并为新的重载方法添加单元测试，以涵盖您刚刚添加的内容。

# c - (rho/theta) 参数化中定义的两条线的交点

> ID：383480
> 
> 赞同：18
> 
> 时间：2008-12-20T17:02:04.313
> 
> 标签：c, math, image-processing, geometry

为检测图像中的线条创建了 Hough 变换的 c++ 实现。找到的行使用 rho、theta 表示，如 wikipedia 上所述：

> “参数r代表直线到原点的距离，而θ是向量从原点到这个最近点的夹角”

如何在 x, y 空间中找到使用 r, θ 描述的两条线的交点？

以下是我当前用于转换进出霍夫空间的函数供参考：

```
//get 'r' (length of a line from pole (corner, 0,0, distance from center) perpendicular to a line intersecting point x,y at a given angle) given the point and the angle (in radians)
inline float point2Hough(int x, int y, float theta) {
    return((((float)x)*cosf(theta))+((float)y)*sinf(theta));
}

//get point y for a line at angle theta with a distance from the pole of r intersecting x? bad explanation! >_<
inline float hough2Point(int x, int r, float theta) {
    float y;
    if(theta!=0) {
            y=(-cosf(theta)/sinf(theta))*x+((float)r/sinf(theta));
    } else {
            y=(float)r; //wth theta may == 0?!
    }
    return(y);
} 
```

如果这是显而易见的事情，请提前抱歉..

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-20T17:47:02.647

查看[维基百科页面](http://en.wikipedia.org/wiki/Hough_transform)，我看到与给定给定 r、θ 对对应的直线方程是

```
r = x cosθ + y sinθ
```

因此，如果我理解，给定两对 r1, θ1 和 r2, θ2，要找到交点，您必须求解未知数 x,y 以下线性 2x2 系统：

```
x cos θ1 + y sin θ1 = r1
x cos θ2 + y sin θ2 = r2

```

即 AX = b，其中

```
A = [cos θ1 sin θ1] b = |r1| X = |x|
    [cos θ2 sin θ2] |r2| |是|

```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-06T13:46:22.020

以前从未遇到过矩阵数学，因此进行了一些研究和实验来制定 Fredrico 答案的过程。谢谢，无论如何都需要学习矩阵。^^

查找两条参数化线相交的函数：

```
//Find point (x,y) where two parameterized lines intersect :p Returns 0 if lines are parallel 
int parametricIntersect(float r1, float t1, float r2, float t2, int *x, int *y) {
    float ct1=cosf(t1);     //matrix element a
    float st1=sinf(t1);     //b
    float ct2=cosf(t2);     //c
    float st2=sinf(t2);     //d
    float d=ct1*st2-st1*ct2;        //determinative (rearranged matrix for inverse)
    if(d!=0.0f) {   
            *x=(int)((st2*r1-st1*r2)/d);
            *y=(int)((-ct2*r1+ct1*r2)/d);
            return(1);
    } else { //lines are parallel and will NEVER intersect!
            return(0);
    }
} 
```

# cocoa-touch - UIAlert 错误行为

> ID：383481
> 
> 赞同：2
> 
> 时间：2008-12-20T17:03:11.113
> 
> 标签：cocoa-touch

// Tratamento de eventos: caso o utilizador clique numa das células da tabela 大家好，我试图显示一个 UIAlertView 来显示我存储的“电影”对象的摘要，我的想法是在其中显示两个按钮，如果我已经存储了电影的网站，或者如果电影没有，则仅显示一个。

奇怪的是，我得到的不是一个，不是两个，而是 3 个非常不同的 UIAlertViews！

[![替代文字](https://i.stack.imgur.com/Y6Mm4.png)](https://i.stack.imgur.com/Y6Mm4.png)

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {

    NSString *ShinraTensei = (@"%@ \n", [[array_resultados objectAtIndex:indexPath.row] Sumario]);

    if([[array_resultados objectAtIndex:indexPath.row] WebSite] != nil)
    {
    //  NSLog(@"Nulo");
        UIAlertView* myAlertView = [[UIAlertView alloc] initWithTitle:[[array_resultados objectAtIndex:indexPath.row] TituloFilme] message:ShinraTensei delegate:self cancelButtonTitle:@"OK" otherButtonTitles:nil];

        CGAffineTransform myTransform = CGAffineTransformMakeTranslation(0.0, 0.0);
        [myAlertView setTransform:myTransform];
        [myAlertView show];
        [myAlertView release];
            myAlertView = nil;
    }
    else
    {
        UIAlertView* myAlertView2 = [[UIAlertView alloc] initWithTitle:[[array_resultados objectAtIndex:indexPath.row] TituloFilme] message:ShinraTensei delegate:self cancelButtonTitle:@"LOL" otherButtonTitles:nil];

        CGAffineTransform myTransform2 = CGAffineTransformMakeTranslation(0.0, 0.0);
        [myAlertView2 setTransform:myTransform2];

        [myAlertView2 show];
        [myAlertView2 release];
            myAlertView = nil;
    }
} 
```

**编辑**：如果您看不到此帖子中嵌入的图片，请访问：http: [//i41.tinypic.com/2vc9hg9.jpg](https://i.stack.imgur.com/Y6Mm4.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T21:27:50.533

第一个对话框是标准的 UIAlertView。第二个我只能猜测，但我认为这是当你有太多的消息文本时，它看起来不同，向用户发出他们可以滚动消息的信号。第三个是 UIAlertView，只有一个标题，根本没有消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T07:26:11.167

那么你的实际问题是什么？我和下一个人一样喜欢截图，但我在任何地方都看不到问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T07:28:30.633

看起来这里的逻辑很好。Youi 很可能是您的数据模型有问题。

我猜 [[array_resultados objectAtIndex:indexPath.row] TituloFilme] message:ShinraTensei] 的值为零，在您看到第三种对话框的情况下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T17:04:56.400

你能看到图片吗？如果你不能，它就在这里：http: [//i41.tinypic.com/2vc9hg9.jpg](http://i41.tinypic.com/2vc9hg9.jpg)

# java - Java Applets 是否有任何插件框架？

> ID：383510
> 
> 赞同：5
> 
> 时间：2008-12-20T17:21:58.783
> 
> 标签：java, plugins, applet, download

我们有一个作为小程序或 Java Web Start 运行的大型 Java 应用程序。而且它越来越多。典型的用户只需要一小部分类。因为Java不知道它可以在哪个jar文件中找到哪个类，所以它会加载所有jar文件，直到找到该类。如果它将加载一个不存在的类（例如资源包），那么它将加载所有 jar 文件。这减少了非常大的小带宽上的启动时间。

是否有一个小框架，我们可以仅在需要时加载插件？或者如果需要和背景更好？

当然，框架不应该因为它的大尺寸而延迟启动时间。

我认为它应该使用 URLClassLoader 进行下载。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T08:06:25.987

我听说您可以实现自定义类加载器，并且我已经看过有关此主题的教程。有了这个，您应该能够更精确地控制下载的内容。对不起，我自己没有试过这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T22:25:12.697

这不是您问题的直接答案，但您可以通过使用[Pack200](http://java.sun.com/j2se/1.5.0/docs/guide/deployment/deployment-guide/pack200.html#pack200_compression)显着减小 JAR 文件的大小来缓解下载速度缓慢的问题。我之前[写过](http://blog.uncommons.org/2008/11/09/smaller-java/)这可以有多么有效。

除此之外，我同意 asalamon74 使用延迟下载 JAR 文件的建议。

也许您可以优化 JAR 的顺序，以便那些包含将首先加载的类的 JAR 更早出现？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T17:52:50.157

我认为（没有 jnlp 我不确定）您已经使用了下载属性：

```
<jar href="sound.jar" download="lazy"/> 
```

由于 webstart 没有关于 jar 内容的信息，我假设如果缺少该类，它会加载所有这些内容。

虽然我从未尝试过，但是有一个`<package>`标签，您可以在其中给出一些提示，让 webstart 在哪里搜索类。检查[这个](http://lopica.sourceforge.net/ref.html#package)（非常短的）文档。

# visual-studio - 如何在 VS2005 自动生成的互操作程序集中保留 COM DLL 版本？

> ID：383511
> 
> 赞同：2
> 
> 时间：2008-12-20T17:24:22.663
> 
> 标签：visual-studio, com, visual-studio-2005, interop, assemblies

我在 Visual Studio 2005 中的 C# 项目中添加了对同事的 COM DLL -- MyLogic.dll -- 的引用。正如预期的那样，这会在我的输出文件夹中自动生成 Interop.MyLogicLib.dll。但是，COM DLL 的版本号是 2.1.0.180，而自动生成的互操作程序集的版本号是 1.0.0.0。如何让 Visual Studio 保留原始版本号？

就目前而言，1.0.0.0 版本号让我在安装产品时感到悲痛。安装程序拒绝覆盖早期版本的互操作 DLL，因为新旧副本都有 1.0.0.0 版本。

顺便说一句，我尝试使用“tlbimp /asmversion:2.1.0.180 MyLogic.dll”在命令行手动生成程序集，但是：

1.  我的项目拒绝使用手动生成的程序集进行构建，说我正在使用的类型是在一个名为 Interop.MyLogicLib.dll 的未引用程序集中定义的（我手动制作的没有“Interop.”前缀）。不得不承认，我不明白这一点。
2.  我需要提前知道版本号，而不是让工具从 COM DLL 中读取它
3.  这是一个手动过程，这很糟糕

无论如何，Visual Studio 肯定可以跨 COM 版本号*自动复制吗？*

**更新：**道歉；我似乎重复[了另一个问题](https://stackoverflow.com/questions/41832/maintain-the-correct-version-for-a-com-dll-referenced-in-a-net-project)。老实说，我确实先搜索了一个现有的。我只是错过了。:(

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T01:06:13.323

程序集版本号由类型库版本号设置，而不是 DLL 中的 VERSIONINFO 资源。确保在 IDL 文件中正确设置库的“版本”属性：

```
import "oaidl.idl";
import "ocidl.idl";
[
  uuid(5F3D3EAC-0F66-4199-B548-654A9174552B),
  version(2.1),
  helpstring("Something descriptive here")
]

library YourLib {
  // etc
}; 
```

# javascript - 用于从网络读取和操作图像的客户端脚本（详情...）

> ID：383522
> 
> 赞同：1
> 
> 时间：2008-12-20T17:42:06.777
> 
> 标签：javascript, greasemonkey, client-side, ocr

我希望能够使用一个 Greasemonkey 脚本，该脚本可以从页面中获取图像，扫描它以查找最暗的像素，然后将这些坐标返回给浏览器。

最初，我使用了一个 Flash 脚本... Greasemonkey 嵌入了一个本地 Flash 文件，该文件将根据网页源中的 URL 获取图像，使用 ActionScript 获取最暗的像素，然后发送带有这些坐标的 POST 请求价值观。

问题是，我只想下载一次图像。使用这种方法，它会执行两次（一次在浏览器中，一次在 Flash 中）。有没有办法在 Javascript 或其他客户端语言中处理网页中的图像？我尝试使用 Canvas，但您无法对托管在远程服务器上的图像执行 getImageData() 函数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T19:11:28.983

您可以仅将其加载到 Flash 中，并随心所欲地处理您的图像，然后如果您需要在页面中显示它，您可以将图像编码为 PNG 的 base64 字符串（您将需要用于 PNG 和 base64 编码的 AS 库） .

下一步是将字符串传递给 javascript，在 Javascript 中，您可以利用嵌入 base64 图像的能力（在 Firefox、opera 中支持，而不是 IE）。

语法是：

```
<img src='data:image/png;base64,ABCDE...'> 
```

其中“ABCDE...”是在 flash 中生成的 base64 字符串。

这样，您只能获得一次图像，但仍然可以将其显示为普通的 html 图像。

我在我创建的一个宠物项目（[www.creationempire.com/tstyles](http://www.creationempire.com/tstyles)）中使用了这种技术来在在线图像生成器中生成图像，并从[http://danielmclaren.net/2008/03/embedding-base64获得了最初的想法-图像数据到网页](http://danielmclaren.net/2008/03/embedding-base64-image-data-into-a-webpage)

雨果

# unit-testing - 一段时间后如何使 UnitTest 自动失败？

> ID：383525
> 
> 赞同：4
> 
> 时间：2008-12-20T17:45:52.277
> 
> 标签：unit-testing, nunit

我正在使用 NUnit (2.4.6)，我的构建/测试之夜是使用 Team City 4 完成的。我已经联系了 Team City，他们已经告诉我他们无法处理这个问题。所以，我在这里。

我想要的是设置我的测试以像往常一样进行测试，但如果他们挂断了......由于未知原因（这可能会发生......）......我不希望他们继续但失败. 这是必需的，因为有时我注意到我的构建之夜已经完成，并且当测试到达时，一些测试会挂断整个晚上。

你会怎么做？

请记住，我知道 Nunit 2.5（Beta）具有[MaxTime 属性](http://nunit.com/index.php?p=maxtime&r=2.5)，但我必须升级 + 进行 800 多个单元测试......我想要整个测试的东西，而不必升级到这个 beta 版本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T17:04:38.037

TC 对每个构建配置都有一个执行超时，如果超过则构建失败。在一般设置中，“如果运行时间超过，则构建失败”。这不是每个单元测试，但我认为这对您的场景来说已经足够了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T06:31:10.843

如果您坚决反对升级到 2.5，则 NUnit 示例中有一个 MaxTimeDecorator 如果花费的时间超过指定时间，它将无法通过测试。显然，当测试挂起时这将无济于事，但是您可以修改示例，以便它在自己的线程中生成测试并每隔一段时间进行一次回调以查看是否超过了时间限制。然而，这很快就会变得相当复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T18:40:37.580

我会按照你的建议使用 MaxTime，这是标准的做法 - 为什么要创建新的东西只是为了避免更新测试本身？

如果问题仅仅是更新测试所花费的时间，我个人可能会敲出一些快速而肮脏的程序来解析源文件并添加属性。更新代码（生成器或其他）可能有更好的方法，但这会起作用。

除非有令人信服的理由不使用 NUnit 2.5？

# perl - 如何自然地对哈希的键进行排序？

> ID：383528
> 
> 赞同：17
> 
> 时间：2008-12-20T17:47:03.177
> 
> 标签：perl, sorting, hash, natural-sort

我有一个 Perl 哈希，其键以数字开头，或者是数字。

如果我使用，

```
foreach my $key (sort keys %hash) {
    print $hash{$key} . "\n";
} 
```

该列表可能会出现，

```
0
0001
1000
203
23 
```

代替

```
0
0001
23
203
1000 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-20T17:56:49.617

```
foreach my $key (sort { $a <=> $b} keys %hash) {
    print $hash{$key} . "\n";
} 
```

排序操作采用一个可选的比较“子例程”（作为代码块，就像我在这里所做的那样，或者作为子例程的名称）。我提供了一个内联比较，它使用内置的数字比较运算符“<=>”将键视为数字。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-12-22T03:14:02.003

[保罗的答案](https://stackoverflow.com/questions/383528/how-can-i-sort-a-hashs-keys-naturally/383539#383539)对数字是正确的，但如果你想更进一步，像人类那样对混合的单词和数字进行排序，`cmp`也不`<=>`会这样做。例如，

```
 9x
  14
  foo
  fooa
  foolio
  Foolio
  foo12
  foo12a
  Foo12a
  foo12z
  foo13a 
```

[Sort::自然](http://search.cpan.org/perldoc?Sort::Naturally)会处理这个问题，提供`nsort`和`ncmp`例程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-06-22T17:55:45.153

您的第一个问题是循环体（这里似乎没有其他答案指出）。

```
foreach my $key ( sort keys %hash ) {
    print $hash{$key} . "\n";
} 
```

我们不知道键`%hash`是什么。我们只知道`$key`在循环内按词汇顺序传递给您的它们。然后，您使用密钥访问散列的内容，打印每个条目。

散列的*值*不会按排序顺序出现，因为您对*键*进行排序。

您是否想要按排序顺序输出*值*，请考虑以下循环：

```
foreach my $value ( sort values(%hash) ) {
    printf( "%s\n", $value );
} 
```

此循环*确实*按照您观察到的顺序打印值：

```
0
0001
1000
203
23 
```

要对它们进行数字排序，请使用

```
foreach my $value ( sort { $a <=> $b } values(%hash) ) {
    printf( "%s\n", $value );
} 
```

这产生

```
0
0001
23
203
1000 
```

这就是你想要的。

See [the Perl manual for the `sort` function](http://perldoc.perl.org/functions/sort.html) for further information and many more examples.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-06-22T17:32:13.683

```
$key (sort { $a <=> $b} keys %hash) 
```

会成功的

或降序排序：

```
$key (sort { $b <=> $a} keys %hash) 
```

甚至

```
$key (sort { $a <=> $b} values %hash)
$key (sort { $b <=> $a} values %hash) 
```

# c# - 如何在 Outlook 命令栏上的控件之间创建垂直分隔符？

> ID：383538
> 
> 赞同：2
> 
> 时间：2008-12-20T17:56:02.520
> 
> 标签：c#, outlook, vsto, outlook-addin, outlook-2003

我正在创建一个 Outlook 2003 插件，它在每个打开的邮件项目上添加了一些下拉菜单和按钮。我创建了一个命令栏并将控件添加到该命令栏。但是，如果我查看邮件消息上的标准工具栏，每个按钮都由一个垂直条分隔，但在我的工具栏中没有分隔符。如何在命令栏上的控件之间创建垂直分隔符。我正在使用 VSTO 2005SE 和 C# 进行开发。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T18:46:55.427

我找到了在控件之间放置分隔符的方法——将按钮的 BeginGroup 属性设置为 true。此属性在控件的开头放置一个垂直条，因此如果按钮是菜单栏上的第一个控件，则此分隔符将不可见，但如果这是栏上的第二个控件，则将在第二个控件之前放置一个垂直条.

# flex3 - flex 3和访问远程java对象

> ID：383550
> 
> 赞同：0
> 
> 时间：2008-12-20T18:09:13.693
> 
> 标签：flex3, remoting

我刚开始学习 flex 并且试图了解 Flex 是如何进行远程处理的？根据我的阅读，Flex 提供了一个 LifeCycle 数据服务战争，它位于您的服务器上并拦截您的远程调用，这是否接近？

我担心如果我使用这个选项 1\. 我必须向我的服务器添加额外的战争 - 生命周期数据服务战争和 2\. 我必须为我在每个 cpu 上使用的每个实例支付许可证。

有没有更简单的 [免费] 选项，我可以使用它从我的 flex mxml 中调用我的远程 java 对象？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-20T20:28:41.637

Blaze DS 基于与 LiveCycle Data Services 相同的 API/代码库，并且完全免费和开源：

[http://opensource.adobe.com/wiki/display/blazeds/BlazeDS/](http://opensource.adobe.com/wiki/display/blazeds/BlazeDS/)

还有许多其他可用选项，包括：

*   花岗岩 DS
*   网络球
*   FluorineFX（用于 .NET）

还有针对 PHP、Python 和 Ruby 的解决方案，虽然我现在不记得它们的名字了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T09:59:19.057

最简单的选择是从服务器发送 xml 并在 Flex 中使用它。但是，如果您想使用 java 对象，您可以使用 BlazeDs。这将要求您放置一个额外的 jar 文件（没有令人讨厌的）此外，还有其他选项可用作[java](http://www.themidnightcoders.com/products/weborb-for-java/overview.html) nr meraapi 的[WebOrb](http://www.merapiproject.net/)。

# java - Java中布尔变量的大小是多少？

> ID：383551
> 
> 赞同：89
> 
> 时间：2008-12-20T18:09:40.497
> 
> 标签：java, boolean

谁能说出Java中**布尔值**的位大小？

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2008-12-20T18:46:20.517

这取决于虚拟机，但很容易从[询问 Java 中字节的类似问题](https://stackoverflow.com/questions/229886)中调整代码：

```
class LotsOfBooleans
{
    boolean a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, aa, ab, ac, ad, ae, af;
    boolean b0, b1, b2, b3, b4, b5, b6, b7, b8, b9, ba, bb, bc, bd, be, bf;
    boolean c0, c1, c2, c3, c4, c5, c6, c7, c8, c9, ca, cb, cc, cd, ce, cf;
    boolean d0, d1, d2, d3, d4, d5, d6, d7, d8, d9, da, db, dc, dd, de, df;
    boolean e0, e1, e2, e3, e4, e5, e6, e7, e8, e9, ea, eb, ec, ed, ee, ef;
}

class LotsOfInts
{
    int a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, aa, ab, ac, ad, ae, af;
    int b0, b1, b2, b3, b4, b5, b6, b7, b8, b9, ba, bb, bc, bd, be, bf;
    int c0, c1, c2, c3, c4, c5, c6, c7, c8, c9, ca, cb, cc, cd, ce, cf;
    int d0, d1, d2, d3, d4, d5, d6, d7, d8, d9, da, db, dc, dd, de, df;
    int e0, e1, e2, e3, e4, e5, e6, e7, e8, e9, ea, eb, ec, ed, ee, ef;
}

public class Test
{
    private static final int SIZE = 1000000;

    public static void main(String[] args) throws Exception
    {        
        LotsOfBooleans[] first = new LotsOfBooleans[SIZE];
        LotsOfInts[] second = new LotsOfInts[SIZE];

        System.gc();
        long startMem = getMemory();

        for (int i=0; i < SIZE; i++)
        {
            first[i] = new LotsOfBooleans();
        }

        System.gc();
        long endMem = getMemory();

        System.out.println ("Size for LotsOfBooleans: " + (endMem-startMem));
        System.out.println ("Average size: " + ((endMem-startMem) / ((double)SIZE)));

        System.gc();
        startMem = getMemory();
        for (int i=0; i < SIZE; i++)
        {
            second[i] = new LotsOfInts();
        }
        System.gc();
        endMem = getMemory();

        System.out.println ("Size for LotsOfInts: " + (endMem-startMem));
        System.out.println ("Average size: " + ((endMem-startMem) / ((double)SIZE)));

        // Make sure nothing gets collected
        long total = 0;
        for (int i=0; i < SIZE; i++)
        {
            total += (first[i].a0 ? 1 : 0) + second[i].a0;
        }
        System.out.println(total);
    }

    private static long getMemory()
    {
        Runtime runtime = Runtime.getRuntime();
        return runtime.totalMemory() - runtime.freeMemory();
    }
} 
```

重申一下，这是依赖于虚拟机的，但在我运行 Sun 的 JDK 版本 1.6.0_11 的 Windows 笔记本电脑上，我得到了以下结果：

```
Size for LotsOfBooleans: 87978576
Average size: 87.978576
Size for LotsOfInts: 328000000
Average size: 328.0 
```

这表明布尔值基本上可以由 Sun 的 JVM 打包成一个字节。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-12-20T18:12:57.417

它取决于虚拟机。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-12-20T18:14:03.543

Java 中布尔值表示的实际信息是一位：1 表示真，0 表示假。但是，内存中布尔变量的实际大小并未由 Java 规范精确定义。请参阅[Java 中的原始数据类型](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/datatypes.html "Java中的原始数据类型")。

> 布尔数据类型只有两个可能的值：真和假。将此数据类型用于跟踪真/假条件的简单标志。这种数据类型代表一点信息，但它的“大小”并不是精确定义的。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-12-21T02:05:19.333

附带说明...

如果您正在考虑使用布尔对象数组，请不要。改用 BitSet - 它有一些性能优化（和一些不错的额外方法，允许您获取下一个设置/取消设置位）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-11-25T05:33:22.723

我读到Java为`boolean`数据类型保留一个字节，但它只使用一位。但是，文档说***“它的“大小”不是精确定义的”***。 [看这里。](http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-20T18:19:08.340

这些`boolean`值被编译为`int`JVM 中的数据类型。见[这里](http://java.sun.com/docs/books/jvms/second_edition/html/Overview.doc.html#22909)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-18T06:45:31.113

java中布尔值的大小取决于虚拟机。但是任何 Java 对象都以 8 字节的粒度对齐。一个布尔值有 8 个字节的报头，加上 1 个字节的有效载荷，总共 9 个字节的信息。然后 JVM 将其向上取整为 8 的下一个倍数。因此 java.lang.Boolean 的一个实例占用了 16 个字节的内存。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-20T19:02:34.553

这是未定义的；像 Jon Skeet 建议的那样做会给你一个给定平台的近似值，但准确了解特定平台的方法是使用分析器。

# wpf - Silverlight按钮样式如何防止按下按钮时的焦点状态？

> ID：383560
> 
> 赞同：3
> 
> 时间：2008-12-20T18:16:42.400
> 
> 标签：wpf, silverlight

在我的自定义按钮中，我需要显示它具有焦点（为按钮提供一些触感）并显示它被按下但我发现我的焦点状态正在显示而不是我的按下状态。我该如何纠正这一点。我想让鼠标悬停在按下而不是鼠标悬停然后聚焦（单击按钮时）

这是我的控件模板的示例。

```
<UserControl.Resources>
    <Style x:Key="GavelButtonStyle" TargetType="Button">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid Background="#FF000000" x:Name="grid">
                        <vsm:VisualStateManager.VisualStateGroups>
                            <vsm:VisualStateGroup x:Name="FocusStates">
                                <vsm:VisualState x:Name="Unfocused"/>
                                <vsm:VisualState x:Name="Focused">
                                    <Storyboard>
                                        <ColorAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="image" Storyboard.TargetProperty="(UIElement.OpacityMask).(SolidColorBrush.Color)">
                                            <SplineColorKeyFrame KeyTime="00:00:00" Value="#FFFFFFFF"/>
                                        </ColorAnimationUsingKeyFrames>
                                        <ColorAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="grid" Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)">
                                            <SplineColorKeyFrame KeyTime="00:00:00" Value="#FF2844B9"/>
                                        </ColorAnimationUsingKeyFrames>
                                    </Storyboard>
                                </vsm:VisualState>
                            </vsm:VisualStateGroup>
                            <vsm:VisualStateGroup x:Name="CommonStates">
                                <vsm:VisualStateGroup.Transitions>
                                    <vsm:VisualTransition GeneratedDuration="00:00:00.2000000"/>
                                </vsm:VisualStateGroup.Transitions>
                                <vsm:VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="image" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1.5"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="image" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1.5"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </vsm:VisualState>
                                <vsm:VisualState x:Name="Normal"/>
                                <vsm:VisualState x:Name="Pressed">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="image" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.5"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="image" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.5"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </vsm:VisualState>
                                <vsm:VisualState x:Name="Disabled"/>
                            </vsm:VisualStateGroup>
                        </vsm:VisualStateManager.VisualStateGroups>
                        <Image Cursor="Hand" x:Name="image" RenderTransformOrigin="0.5,0.5" Source="11_64x64.png" Stretch="Fill" OpacityMask="#FF000000">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <SkewTransform/>
                                    <RotateTransform/>
                                    <TranslateTransform/>
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>
                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</UserControl.Resources>; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T10:43:23.090

当你按下它时它变成焦点，对此无能为力......你可以清除视觉状态管理器的焦点内容，然后它*看起来*不会集中，但无论你做什么，它都会从鼠标交互中获得焦点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-15T21:41:47.367

我已成功将 IsTabStop 设置为 False。我不希望它在单击后阻止焦点，但这似乎就是它的作用。单击按钮后，空格键不被捕获。

# python - 如何在 Python 中迭代重复每个元素的列表

> ID：383565
> 
> 赞同：8
> 
> 时间：2008-12-20T18:23:52.417
> 
> 标签：python, iterator

我正在使用 Python 对列表进行**无限**迭代，多次重复列表中的每个元素。例如给定列表：

```
l = [1, 2, 3, 4] 
```

我想输出每个元素两次，然后重复循环：

```
1, 1, 2, 2, 3, 3, 4, 4, 1, 1, 2, 2 ... 
```

我知道从哪里开始：

```
def cycle(iterable):
  if not hasattr(cycle, 'state'):
    cycle.state = itertools.cycle(iterable)
  return cycle.next()

 >>> l = [1, 2, 3, 4]
 >>> cycle(l)
 1
 >>> cycle(l)
 2
 >>> cycle(l)
 3
 >>> cycle(l)
 4
 >>> cycle(l)
 1 
```

但是我将如何重复每个元素？

**编辑**

为了澄清这一点，应该无限迭代。此外，我使用重复元素两次作为最短示例 - **我真的很想将每个元素重复 n 次**。

**更新**

您的解决方案是否会引导我找到我正在寻找的东西：

```
>>> import itertools
>>> def ncycle(iterable, n):
...   for item in itertools.cycle(iterable):
...     for i in range(n):
...       yield item
>>> a = ncycle([1,2], 2)
>>> a.next()
1
>>> a.next()
1
>>> a.next()
2
>>> a.next()
2
>>> a.next()
1
>>> a.next()
1
>>> a.next()
2
>>> a.next()
2 
```

感谢您的快速回答！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-20T18:36:27.197

这个怎么样：

```
import itertools

def bicycle(iterable, repeat=1):
    for item in itertools.cycle(iterable):
        for _ in xrange(repeat):
            yield item

c = bicycle([1,2,3,4], 2)
print [c.next() for _ in xrange(10)] 
```

编辑：合并[bishanty 的](https://stackoverflow.com/users/37522/bishanty)重复计数参数和[Adam Rosenfield 的列表理解](https://stackoverflow.com/questions/383565/how-to-iterate-over-a-list-repeating-each-element-in-python#383574)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-20T18:31:49.577

你可以很容易地用生成器来做到这一点：

```
def cycle(iterable):
    while True:
        for item in iterable:
            yield item
            yield item

x=[1,2,3]
c=cycle(x)

print [c.next() for i in range(10)]  // prints out [1,1,2,2,3,3,1,1,2,2] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-04-09T10:30:56.897

```
itertools.chain.from_iterable(itertools.repeat(item, repeat) for item in itertools.cycle(l)) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T18:30:05.603

解决方案应该类似于

```
iterable = [1, 2, 3, 4]
n = 2

while (True):
  for elem in iterable:
    for dummy in range(n):
      print elem # or call function, or whatever 
```

编辑：添加“While (True)”以无限期迭代。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T16:32:41.080

```
import itertools as it

def ncycle(iterable, n=1):
    if n == 1:
        return it.cycle(iterable)
    return it.cycle(it.chain(*it.izip(*([iterable]*n)))) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-24T23:38:20.713

我这样做：

```
from itertools import cycle, repeat, chain
flatten = chain.from_iterable # better name

def ncycle(xs, n):
    return flatten(repeat(x, n) for x in cycle(xs))

# example
for n,x in enumerate(ncycle('abcd', 2)):
    print(x, end=" ")
    if n > 9:
        print("")
        break
# output: a a b b c c d d a a b 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-20T18:40:13.150

```
[ "%d, %d" % (i, i) for i in [1, 2, 3, 4] * 4] 
```

最后4个是周期数。

# java - 字符串到整数的映射

> ID：383570
> 
> 赞同：10
> 
> 时间：2008-12-20T18:27:48.713
> 
> 标签：java

Java中将字符串（Java `String`）映射到（正）整数（Java `int`）的最简单方法是什么，以便

*   相等的字符串映射到相等的整数，并且
*   不同的字符串映射到不同的整数？

因此，需要类似`hashCode()`但不同的字符串来产生不同的整数。因此，从某种意义上说，这将是一个没有碰撞可能性的 hasCode() 。

一个明显的解决方案是维护一个从字符串到整数的映射表，以及一个计数器来保证为新字符串分配一个新的整数。我只是想知道这个问题通常是如何解决的。将它扩展到字符串以外的其他对象也会很有趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T22:18:42.303

看看[完美的散列](http://en.wikipedia.org/wiki/Perfect_hash_function)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-20T18:34:12.053

不会有一个简单或完整的解决方案。我们使用哈希是因为可能的字符串比整数多得多。冲突只是使用有限数量的位来表示整数的限制。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T20:30:06.733

在大多数 hashcode() 类型的实现中，冲突被认为是不可避免的并经过测试。

如果您绝对不能有任何碰撞，保证，您概述的解决方案将起作用。

除此之外，还有诸如 MD5 和 SHA 之类的加密散列函数，它们极不可能发生冲突（尽管可以强制执行很多努力）。Java Cryptography Architecture 有这些的实现。对于非常大的集合，这些方法可能比您的解决方案的良好实现更快。它们还将在恒定时间内执行并为相同的字符串提供相同的代码，无论添加字符串的顺序是什么。此外，它不需要存储每个字符串。加密哈希结果可以被视为整数，但它们不适合 java int - 您可以按照另一个答案中的建议使用 BigInteger 来保存它们。

顺便说一句，如果您对碰撞“极不可能”的想法感到厌烦，那么可能有类似的可能性会在您的计算机内存或硬盘中随机翻转并导致任何程序的行为与您预期的不同:-)

请注意，某些散列函数（例如 MD5）也存在一些理论上的弱点，但出于您的目的，这可能无关紧要，您可以使用最有效的此类函数 - 这些弱点仅在有人恶意尝试出现时才相关使用与另一个字符串具有相同代码的字符串。

*编辑：我刚刚在您的问题标题中注意到，您似乎想要双向映射，尽管您实际上并没有在问题中说明这一点。（按设计）不可能从加密哈希到原始字符串。如果你真的需要它，你必须将映射键哈希值存储回字符串。*

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-21T21:04:07.337

没有任何限制，这是不可能实现的，因为可能的字符串比整数多，所以最终你会用完数字。

仅当您限制可用字符串的数量时才有可能解决。然后你可以使用一个简单的计数器。这是一个简单的实现，其中所有（2^32 = 4294967296 个不同的字符串）都可以使用。没关系，它使用大量内存。

```
import java.util.HashMap;
import java.util.Map;

public class StringToInt {

    private Map<String, Integer> map;

    private int counter = Integer.MIN_VALUE;

    public StringToInt() {
        map = new HashMap<String, Integer>();
    }

    public int toInt(String s) {
        Integer i = map.get(s);
        if (i == null) {
            map.put(s, counter);
            i = counter;
            ++counter;
        }
        return i;
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-20T18:41:31.117

我会尝试通过引入一个包含 Map 和 Map 的对象来做到这一点。将字符串添加到该对象（或者可能从所述对象创建它们）将为它们分配一个整数值。为已注册的字符串请求整数值将返回相同的值。

缺点：不同的启动会为同一个字符串产生不同的整数，这取决于顺序，除非你以某种方式坚持整个事情。此外，它不是非常面向对象，需要一个特殊的对象来创建/注册一个字符串。优点：它与内部化字符串非常相似，并且易于理解。（另外，你要求一种简单而不优雅的方式。）

对于更一般的情况，您可以创建 Object 的高级子类，在其中引入“integerize”方法并从中扩展每个类。然而，我认为那条路会让人流泪。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-20T18:39:22.543

由于 java 中的字符串的长度是无限的，并且每个字符有 16 位，而整数有 32 位，因此如果字符串最多两个字符，则只能生成字符串到整数的唯一映射。但是您可以使用 BigInteger 生成一个独特的映射，例如：

```
String s = "my string";
BigInteger bi = new BigInteger(s.getBytes()); 
```

反向映射：

```
String str = new String(bi.toByteArray()); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-20T18:38:55.930

您可以使用 Map 来指示您已经将整数分配给了哪些字符串？这是一种“数据库-y”解决方案，您可以在每个字符串出现时从序列中分配一个“主键”。然后将字符串和整数对放入 Map 中，以便再次查找。如果您需要给定 Integer 的 String，您还可以将同一对放入 Map。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-21T04:09:17.510

正如您所概述的，解决冲突的哈希表是一种标准解决方案。您还可以使用 Bentley/Sedgewick 风格的搜索树，它在许多应用程序中比散列更快。

如果将“唯一指针”替换为“唯一整数”，您可以[在 C 中看到 Dave Hanson 对此问题的解决方案](http://code.google.com/p/cii/source/browse/trunk/src/atom.c?r=214)。这是一个很好的抽象，因为

*   指针仍然可以用作 C 字符串。

*   相等的字符串散列到相等的指针，因此`strcmp`可以省略以支持指针相等，并且指针可以用作其他散列表中的键。

如果 Java 提供了对**对象的对象身份测试，**`String`那么您可以在那里玩同样的游戏。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-20T19:02:46.583

如果整数是指数据类型，那么正如其他发布者所解释的那样，这是完全不可能的，因为整数数据类型是固定大小的，并且字符串是未绑定的。

但是，如果您只是指一个正数，那么理论上您应该能够将字符串解释为一个“整数”，只需将其视为一个字节数组（以一致的编码）。您也可以将其视为任意长度的整数数组，但如果可以做到这一点，为什么不只使用字符串呢？:)

就实现而言，这通常是通过使用哈希码并简单地仔细检查任何冲突来“解决”的，因为无论如何都可能没有冲突，并且如果发生冲突，它仍然是恒定的时间。但是，如果这不适用，我不确定最好的解决方案是什么。

有趣的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-05-22T00:31:47.667

我不知道这是否实用，但如果我们只使用小写字母，那么每个单词都可以被视为 26 基位置系统中的数字。例如，如果 a 为 0，z 为 25，则繁荣为 1*26^3 + 14*26^2 + 14*26^1 + 12*26^0 = 27416

# c# - 你如何在 C# 中做 *integer* 幂运算？

> ID：383587
> 
> 赞同：59
> 
> 时间：2008-12-20T18:40:28.547
> 
> 标签：c#, math, integer, exponentiation

`Math.Pow()`.NET中的内置函数将`double`基数提高到`double`指数并返回`double`结果。

对整数做同样的事情的最好方法是什么？

补充：似乎可以将`Math.Pow()`结果转换为（int），但这总是会产生正确的数字并且没有舍入错误吗？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-12-20T18:45:15.307

一个相当快的可能是这样的：

```
int IntPow(int x, uint pow)
{
    int ret = 1;
    while ( pow != 0 )
    {
        if ( (pow & 1) == 1 )
            ret *= x;
        x *= x;
        pow >>= 1;
    }
    return ret;
} 
```

请注意，这不允许负幂。我会把它作为练习留给你。:)

**补充：**哦，是的，差点忘了——还要添加上溢/下溢检查，否则你可能会在路上遇到一些令人讨厌的惊喜。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2012-08-09T09:43:26.037

LINQ有人吗？

```
public static int Pow(this int bas, int exp)
{
    return Enumerable
          .Repeat(bas, exp)
          .Aggregate(1, (a, b) => a * b);
} 
```

用作扩展：

```
var threeToThePowerOfNine = 3.Pow(9); 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-12-21T17:24:29.400

使用约翰库克博客链接中的数学，

```
 public static long IntPower(int x, short power)
    {
        if (power == 0) return 1;
        if (power == 1) return x;
        // ----------------------
        int n = 15;
        while ((power <<= 1) >= 0) n--;

        long tmp = x;
        while (--n > 0)
            tmp = tmp * tmp * 
                 (((power <<= 1) < 0)? x : 1);
        return tmp;
    } 
```

解决如果您更改电源类型，代码将无法正常工作的反对意见，那么......撇开任何人更改他们不理解的代码然后在没有测试的情况下使用它......
但要解决问题，这个版本可以保护愚蠢的人免受那个错误的影响......（但不是他们可能犯的无数其他人）注意：未经测试。

```
 public static long IntPower(int x, short power)
    {
        if (power == 0) return 1;
        if (power == 1) return x;
        // ----------------------
        int n = 
            power.GetType() == typeof(short)? 15:
            power.GetType() == typeof(int)? 31:
            power.GetType() == typeof(long)? 63: 0;  

        long tmp = x;
        while (--n > 0)
            tmp = tmp * tmp * 
                 (((power <<= 1) < 0)? x : 1);
        return tmp;
    } 
```

也试试这个递归等价物（当然更慢）：

```
 public static long IntPower(long x, int power)
    {
        return (power == 0) ? x :
            ((power & 0x1) == 0 ? x : 1) *
                IntPower(x, power >> 1);
    } 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-04-11T15:28:25.470

怎么样：

```
public static long IntPow(long a, long b)
{
  long result = 1;
  for (long i = 0; i < b; i++)
    result *= a;
  return result;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-02-13T06:49:38.110

非常有趣.. 从 .net 5.0 开始，SimplePower() 现在快了 350 倍。我会说在便携性/性能/可读性方面最好......

```
 public static int SimplePower(int x, int pow)
    {
        return (int)Math.Pow(x, pow);
    } 
```

这是我过去建造的另一个速度很快的...

```
 public static int PowerWithSwitch(int x, int pow)
    {
        switch ((uint)pow)
        {
            case 0: return 1;
            case 1: return x;
            case 2: return x * x;
            case 3: return x * x * x;
            case 4: { int t2 = x * x; return t2 * t2; }
            case 5: { int t2 = x * x; return t2 * t2 * x; }
            case 6: { int t3 = x * x * x; return t3 * t3; }
            case 7: { int t3 = x * x * x; return t3 * t3 * x; }
            case 8: { int t3 = x * x * x; return t3 * t3 * x * x; }
            case 9: { int t3 = x * x * x; return t3 * t3 * t3; }
            case 10: { int t3 = x * x * x; return t3 * t3 * t3 * x; }
            case 11: { int t3 = x * x * x; return t3 * t3 * t3 * x * x; }
            case 12: { int t3 = x * x * x; return t3 * t3 * t3 * t3; }
            case 13: { int t3 = x * x * x; return t3 * t3 * t3 * t3 * x; }
            case 14: { int t4 = x * x * x * x; return t4 * t4 * t4 * x * x; }
            case 15: { int t4 = x * x * x * x; return t4 * t4 * t4 * x * x * x; }
            case 16: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4; }
            case 17: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * x; }
            case 18: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * x * x; }
            case 19: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * x * x * x; }
            case 20: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4; }
            case 21: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * x; }
            case 22: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * x * x; }
            case 23: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * x * x * x; }
            case 24: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4; }
            case 25: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4 * x; }
            case 26: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4 * x * x; }
            case 27: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4 * x * x * x; }
            case 28: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4 * t4; }
            case 29: { int t4 = x * x * x * x; return t4 * t4 * t4 * t4 * t4 * t4 * t4 * x; }
            default:
                if (x == 0)
                    return 0;
                else if (x == 1)
                    return 1;
                else
                    return (x % 1 == 0) ? int.MaxValue : int.MinValue;
        }
        return 0;
    } 
```

性能测试（.Net 5）

* * *

*   MathPow（Sunsetquest）：11 毫秒（.net 4 = 3693 毫秒）<- 350 倍快！！！

*   PowerWithSwitch(Sunsetquest): 145 毫秒 (.net 4 = 298 毫秒)

*   Vilx：148 毫秒（.net 4 = 320 毫秒）

*   Evan Moran 递归除法：249 毫秒（.net 4 = 644 毫秒）

*   迷你我：288 毫秒（.net 4 = 194 毫秒）

*   Charles Bretana（又名库克）：536 毫秒（.net 4 = 950 毫秒）

*   LINQ 版本：4416 毫秒（.net 4 = 3693 毫秒）

（测试说明：AMD Threadripper Gen1，.Net 4 & 5，发布版本，未附加调试器，基础：0-100k，exp：0-10）

注意：在上述测试中几乎没有进行准确性检查。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-20T18:52:54.777

使用双版本，检查溢出（超过最大 int 或最大 long）并转换为 int 或 long？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-01T22:25:22.483

对于这个问题，我最喜欢的解决方案是经典的分而治之的递归解决方案。它实际上比乘 n 次要快，因为它每次将乘法次数减少一半。

```
public static int Power(int x, int n)
{
  // Basis
  if (n == 0)
    return 1;
  else if (n == 1)
    return x;

  // Induction
  else if (n % 2 == 1)
    return x * Power(x*x, n/2);
  return Power(x*x, n/2);
} 
```

注意：这不会检查溢出或负 n。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-08T13:26:09.613

我将结果转换为 int，如下所示：

```
double exp = 3.0;
int result = (int)Math.Pow(2.0, exp); 
```

在这种情况下，没有舍入误差，因为基数和指数是整数。结果也将是整数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-09-02T15:32:57.477

对于一个简短的快速单线。

```
int pow(int i, int exp) => (exp == 0) ? 1 : i * pow(i, exp-1); 
```

没有负指数也没有溢出检查。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-06-09T12:14:35.927

另一种方法是：

```
int Pow(int value, int pow) {
    var result = value;
    while (pow-- > 1)
        result *= value;
    return pow == 0 ? result : pow == -1 ? 1 : throw new ArgumentOutOfRangeException(nameof(pow));
} 
```

# linux - 修复 fstab（只读 /）

> ID：383595
> 
> 赞同：21
> 
> 时间：2008-12-20T18:44:37.260
> 
> 标签：linux, debian

我的 fstab 中有一个错字，它启动到命令行但是是只读的，我知道错误是什么，但我无法更改它，因为它以只读方式安装。我想挂载文件系统并进行更改。我知道我可以启动一个实时发行版并以这种方式对其进行编辑，但我想知道是否有更简单的方法来做到这一点。

顺便说一句，它是 debian lenny。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-20T22:50:16.670

是的，如果您最终进入具有只读根的单用户模式，请尝试：

```
mount / -o remount,rw 
```

也许 -n 是必要的，也许不是。那应该重新挂载根 fs 读/写（假设它没有任何问题）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-12-12T23:13:33.673

我知道这个问题已经过时了，但是看到了，因为现在也遇到了同样的麻烦。我`fstab`手动打破了我的（在参数中打错字）。

这很容易`fstab`从只读模式纠正。`/`我们必须以读写模式挂载。

如果`/etc/fstab`正确，您可以简单地键入：

```
mount -n -o remount / 
```

但是如果`/etc/fstab`是错误的（就像我的情况一样），你必须给出设备名称和可能的类型：例如

```
mount -n -o remount -t extX /dev/hdaX / 
```

`extX`您的文件系统类型在哪里， `/dev/hdaX`-- 是您用于根挂载点的分区。

要查看所有可用分区，只需键入`ls /dev/[sh]d*`.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-01-18T06:51:23.733

```
#mount -n -o remount,rw / 
```

如果 /dev/sda1 是真实设备，则执行以下操作：

```
#mount -n -o remount,rw /dev/sda1 / 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2019-05-25T18:47:09.273

@troyane 通过提供来省去了我的麻烦

```
mount -n -o remount -t extX /dev/hdaX / 
```

当我在具有 ext4 文件系统的 root 的 UUID 中出现拼写错误时，我正在使用 Orangepi3 EMMC。

该命令以读写模式重新安装，我修复了我的 fstab

```
mount -n -o remount -t ext4 /dev/mmcblk2p1 / 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T23:42:10.590

我的内核命令行如下所示：

```
$ cat /proc/cmdline
root=/dev/sda4 ro
$ 
```

告诉 grub 它应该`"ro"`在引导时忽略传递给内核（在要编辑的条目上按`esc`,`e`将允许您编辑提供给内核的参数），它将挂载您的根文件系统，不再是只读的。然后您可以更改*/etc/fstab*并重新启动。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2018-01-24T21:10:54.747

如果您的 /etc/fstab 文件有问题。请按照以下步骤操作。

1.  启动您的 ubuntu 系统或重新启动您的计算机
2.  由于您无法启动系统，因此您会遇到一些错误，例如

“正在为 dev-disk-by 运行启动作业....（您可能需要按 F2 键才能进入 linux 命令终端才能看到此内容）

3.  使用命令 vi /etc/fstab 并编辑您的 fstab 文件
4.  使用# 来推荐一些问题并添加您想要放入 fstab 文件的内容。
5.  完成编辑。按 shift+z 并保存修改
6.  使用命令 reboot 重新启动系统
7.  它再次起作用

请在这里评论，如果您有任何问题

# java - 将 MySql DateTime 类型转换为更友好的东西

> ID：383600
> 
> 赞同：3
> 
> 时间：2008-12-20T18:49:25.300
> 
> 标签：java, mysql, jsp, pojo

我有一个读取 MySql 数据库并返回 DateTime 字段的 Java Web 应用程序。将结果集中返回的 DateTime 字段转换为更具可读性的最佳方法是什么？

目前 DateTime 字段打印为：

2008-12-14 16:30:00

但我想要一些更用户友好的东西，比如：

2008 年 12 月 14 日 16:30

我正在用来自 pojo 的这些 dateTimes 填充 ArrayList。我想在添加到 arrayList 之前对其进行格式化，这样我就可以在 JSP 中打印 arrayList 的内容。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T20:28:45.847

另一种选择是使用 JSTL。格式化库可以很容易地以任何格式显示日期，并且它是 i18n 感知的。优点是您可以将日期保留为 Date 对象并对其进行操作，但仅在需要显示时进行转换。格式标签将如下所示：

```
<fmt:formatDate value="${myDate}" dateStyle="MEDIUM"/> 
```

就像我上面所说的，一个很大的优势是它可以识别 i18n，因此您可以以本地化格式显示日期。

完整的语法是：

```
 <fmt:formatDate value="expression" 
     timeZone="expression"
     type="field" dateStyle="style" 
     timeStyle="style"
     pattern="expression"
     var="name" scope="scope"/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T18:56:54.923

Mysql[日期格式（）](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format)

```
mysql> select date_format(now(),'%d %b %Y at %H:%i') as formated_date;
+----------------------+
| formated_date        |
+----------------------+
| 20 Dec 2008 at 10:56 | 
+----------------------+ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-18T00:13:11.633

我更喜欢`simpleDateFormat`在 Java 代码中使用 a ，这样我的代码就不会*绑定*到任何数据库函数（我知道，原因很弱）。

```
 Date date = ...
    DateFormat df = new SimpleDateFormat("dd MMM yyyy 'at' HH:mm");  // Locale?
    String text = df.format(date); 
```

请注意，这`SimpleDateFormat`不是线程安全的。从文档中：

> 日期格式不同步。建议为每个线程创建单独的格式实例。如果多个线程同时访问一个格式，它必须在外部同步。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T19:05:12.833

你对数据库有什么样的抽象层？它看起来像是一个简单的案例，将您用作字段类的任何内容进行子类化，并为您的格式添加一个方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-18T00:28:45.077

我建议使用标签格式化选项，因为您拥有真实数据（日期/时间），并且您在与格式相关的页面级别进行格式化（并且您知道......例如，要应用的语言环境）。

如果你无论如何都想格式化它并将字符串放入列表`java.text.SimpleDateFormat`中，就像 Carlos Heuberger 所说的那样。

# python - 如何将“或”应用于 Python 中列表的所有值？

> ID：383623
> 
> 赞同：14
> 
> 时间：2008-12-20T19:05:12.257
> 
> 标签：python, list, reduce

如何将“或”应用于 Python 中列表的所有值？我在想类似的事情：

```
or([True, True, False]) 
```

或者如果可能的话：

```
reduce(or, [True, True, False]) 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-20T19:16:37.163

内置函数`any`可以满足您的要求：

```
>>> any([True, True, False])
True
>>> any([False, False, False])
False
>>> any([False, False, True])
True 
```

`any``reduce`一旦找到真值，它的优势在于可以缩短序列中后面项目的测试。如果序列是一个后面有昂贵操作的生成器，这将非常方便。例如：

```
>>> def iam(result):
...  # Pretend this is expensive.
...  print "iam(%r)" % result
...  return result
... 
>>> any((iam(x) for x in [False, True, False]))
iam(False)
iam(True)
True
>>> reduce(lambda x,y: x or y, (iam(x) for x in [False, True, False]))
iam(False)
iam(True)
iam(False)
True 
```

如果您的 Python 版本没有`any()`, `all()`builtins，那么它们很容易按照[Guido van Rossum 的建议](http://www.artima.com/weblogs/viewpost.jsp?thread=98196)实现：

```
def any(S):
    for x in S:
        if x:
            return True
    return False

def all(S):
    for x in S:
        if not x:
            return False
    return True 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-20T19:49:58.873

没有人提到它，但是 " `or`" 可以作为 operator 模块中的一个函数使用：

```
from operator import or_ 
```

然后你可以`reduce`像上面那样使用。

`any`尽管在最近的 Python 中，总是会建议“ ”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T19:17:12.233

```
>>> all([True,False,True])
False
>>> any([True,False,True])
True 
```

Python 2.5 及更高版本（[文档](http://docs.python.org/library/functions.html)）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-20T19:11:38.593

你可以这样做：

```
reduce(lambda a,b: a or b, [True, True, False]) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T19:12:26.500

reduce 应该为你做，不是吗？

```
>>> def _or(x, y):
...     return x or y
... 
>>> reduce(_or, [True, True, False])
True 
```

# php - JSON 编码 MySQL 结果

> ID：383631
> 
> 赞同：320
> 
> 时间：2008-12-20T19:09:44.383
> 
> 标签：php, mysql, json

如何在`json_encode()`MySQL 查询结果中使用该函数？我需要遍历行还是可以将其应用于整个结果对象？

* * *

## 回答 #1

> 赞同：521
> 
> 时间：2008-12-20T19:48:22.667

```
$sth = mysqli_query($conn, "SELECT ...");
$rows = array();
while($r = mysqli_fetch_assoc($sth)) {
    $rows[] = $r;
}
print json_encode($rows); 
```

该函数`json_encode`需要 PHP >= 5.2 和**php-json**包 - 如此[处所述](https://stackoverflow.com/questions/7318191/enable-json-encode-in-php)

*注意*：`mysql`自 PHP 5.5.0 起已弃用，请使用`mysqli`扩展名代替[http://php.net/manual/en/migration55.deprecated.php](http://php.net/manual/en/migration55.deprecated.php)。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2011-01-22T20:19:41.143

试试这个，这将正确地创建你的对象

```
 $result = mysql_query("SELECT ...");
 $rows = array();
   while($r = mysql_fetch_assoc($result)) {
     $rows['object_name'][] = $r;
   }

 print json_encode($rows); 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-20T19:41:50.077

[http://www.php.net/mysql_query](http://www.php.net/mysql_query)说“`mysql_query()`返回资源”。

[http://www.php.net/json_encode](http://www.php.net/json_encode)说它可以编码任何值“除了资源”。

您需要遍历并将数据库结果收集到一个数组中，然后`json_encode`是数组。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-06-16T17:27:03.750

谢谢..我的回答是：

```
if ($result->num_rows > 0) {
            # code...
            $arr = [];
            $inc = 0;
            while ($row = $result->fetch_assoc()) {
                # code...
                $jsonArrayObject = (array('lat' => $row["lat"], 'lon' => $row["lon"], 'addr' => $row["address"]));
                $arr[$inc] = $jsonArrayObject;
                $inc++;
            }
            $json_array = json_encode($arr);
            echo $json_array;
        }
        else{
            echo "0 results";
        } 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-11-15T13:19:53.333

根据我的经验，上述方法不起作用，在您将数组中的根元素命名为某个东西之前，在此之前我无法访问最终 json 中的任何内容。

```
$sth = mysql_query("SELECT ...");
$rows = array();
while($r = mysql_fetch_assoc($sth)) {
    $rows['root_name'] = $r;
}
print json_encode($rows); 
```

这应该够了吧！

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-03-13T01:54:36.003

下面的代码在这里工作正常！

```
<?php

  $con=mysqli_connect("localhost",$username,$password,databaseName);

  // Check connection
  if (mysqli_connect_errno())
  {
   echo "Failed to connect to MySQL: " . mysqli_connect_error();
  }

  $query = "the query here";

  $result = mysqli_query($con,$query);

  $rows = array();
  while($r = mysqli_fetch_array($result)) {
    $rows[] = $r;
  }
  echo json_encode($rows);

  mysqli_close($con);
?> 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2020-07-17T10:26:39.330

# 使用 PDO 时

用于[**`fetchAll()`**](https://www.php.net/manual/en/pdostatement.fetchall.php)获取所有行作为关联数组。

```
$stmt = $pdo->query('SELECT * FROM article');
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
echo json_encode($rows); 
```

当您的 SQL 有参数时：

```
$stmt = $pdo->prepare('SELECT * FROM article WHERE id=?');
$stmt->execute([1]);
$rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
echo json_encode($rows); 
```

当您需要重新设置表的密钥时，您可以使用`foreach`循环并手动构建数组。

```
$stmt = $pdo->prepare('SELECT * FROM article WHERE id=?');
$stmt->execute([1]);

$rows = [];
foreach ($stmt as $row) {
    $rows[] = [
        'newID' => $row['id'],
        'Description' => $row['text'],
    ];
}

echo json_encode($rows); 
```

# 使用 mysqli 时

用于[**`fetch_all()`**](https://www.php.net/manual/en/mysqli-result.fetch-all.php)获取所有行作为关联数组。

```
$res = $mysqli->query('SELECT * FROM article');
$rows = $res->fetch_all(MYSQLI_ASSOC);
echo json_encode($rows); 
```

当您的 SQL 有参数时，您需要执行 prepare/bind/execute/get_result。

```
$id = 1;
$stmt = $mysqli->prepare('SELECT * FROM article WHERE id=?');
$stmt->bind_param('s', $id); // binding by reference. Only use variables, not literals
$stmt->execute();
$res = $stmt->get_result(); // returns mysqli_result same as mysqli::query()
$rows = $res->fetch_all(MYSQLI_ASSOC);
echo json_encode($rows); 
```

当您需要重新设置表的密钥时，您可以使用`foreach`循环并手动构建数组。

```
$stmt = $mysqli->prepare('SELECT * FROM article WHERE id=?');
$stmt->bind_param('s', $id);
$stmt->execute();
$res = $stmt->get_result();

$rows = [];
foreach ($res as $row) {
    $rows[] = [
        'newID' => $row['id'],
        'Description' => $row['text'],
    ];
}

echo json_encode($rows); 
```

# 使用 mysql_* API 时

**请尽快升级到受支持的 PHP 版本！请认真对待。**如果您需要使用旧 API 的解决方案，可以这样做：

```
$res = mysql_query("SELECT * FROM article");

$rows = [];
while ($row = mysql_fetch_assoc($res)) {
    $rows[] = $row;
}

echo json_encode($rows); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-08-21T15:14:33.970

我的简单解决方法是阻止它在数值周围放置语音标记...

```
while($r = mysql_fetch_assoc($rs)){
    while($elm=each($r))
    {
        if(is_numeric($r[$elm["key"]])){
                    $r[$elm["key"]]=intval($r[$elm["key"]]);
        }
    }
    $rows[] = $r;
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-09-30T20:44:08.380

抱歉，这个问题已经过了很长时间，但是：

```
$sql = 'SELECT CONCAT("[", GROUP_CONCAT(CONCAT("{username:'",username,"'"), CONCAT(",email:'",email),"'}")), "]") 
AS json 
FROM users;'
$msl = mysql_query($sql)
print($msl["json"]); 
```

基本上：

```
"SELECT" Select the rows    
"CONCAT" Returns the string that results from concatenating (joining) all the arguments
"GROUP_CONCAT" Returns a string with concatenated non-NULL value from a group 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-09-19T07:48:03.253

```
<?php
define('HOST','localhost');
define('USER','root');
define('PASS','');
define('DB','dishant');

$con = mysqli_connect(HOST,USER,PASS,DB);

  if (mysqli_connect_errno())
  {
   echo "Failed to connect to MySQL: " . mysqli_connect_error();
  }

 $sql = "select * from demo ";

 $sth = mysqli_query($con,$sql);

$rows = array();

while($r = mysqli_fetch_array($sth,MYSQL_ASSOC)) {

 $row_array['id'] = $r;

    **array_push($rows,$row_array);**
}
echo json_encode($rows);

mysqli_close($con);
?> 
```

**aarray_push($rows,$row_array);** 帮助构建数组，否则它会在 while 循环中给出最后一个值

这项工作类似于**java中****StringBuilder**的**append**方法

 ***** * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-09-08T13:51:34.837

使用 FOR 循环的另一种选择：

```
 $sth = mysql_query("SELECT ...");
 for($rows = array(); $row = mysql_fetch_assoc($sth); $rows[] = $row);
 print json_encode($rows); 
```

唯一的缺点是循环 for 比 while 或尤其是 foreach 慢

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-02-17T05:31:23.003

例如 $result = mysql_query("SELECT * FROM userprofiles where NAME='TESTUSER' ");

1.) 如果 $result 只有一行。

```
$response = mysql_fetch_array($result);
echo json_encode($response); 
```

2.) 如果 $result 超过一行。您需要迭代行并将其保存到一个数组中并返回一个包含数组的 json。

```
$rows = array();
if (mysql_num_rows($result) > 0) {
    while($r = mysql_fetch_assoc($result)) {
       $id = $r["USERID"];   //a column name (ex.ID) used to get a value of the single row at at time
       $rows[$id] = $r; //save the fetched row and add it to the array.
    }
}    
echo json_encode($rows); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-05-16T13:32:33.217

我这样解决

```
$stmt->bind_result($cde,$v_off,$em_nm,$q_id,$v_m);
    $list=array();
    $i=0;
    while ($cresult=$stmt->fetch()){    

        $list[$i][0]=$cde;
        $list[$i][1]=$v_off;
        $list[$i][2]=$em_nm;
        $list[$i][3]=$q_id;
        $list[$i][4]=$v_m;
        $i=$i+1;
    }
    echo json_encode($list); 
```

这将作为结果集返回给 ajax，并在 javascript 部分中使用 json 解析，如下所示：

```
obj = JSON.parse(dataX); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-10-13T20:20:01.457

我有同样的要求。我只想将结果对象打印成 JSON 格式，所以我使用下面的代码。我希望你能从中找到一些东西。

```
// Code of Conversion
$query = "SELECT * FROM products;";
$result = mysqli_query($conn , $query);

if ($result) {
echo "</br>"."Results Found";

// Conversion of result object into JSON format
$rows = array();
while($temp = mysqli_fetch_assoc($result)) {
    $rows[] = $temp;
}
echo "</br>" . json_encode($rows);

} else {
    echo "No Results Found";
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-02-17T06:51:09.573

我们可以像这样简化**Paolo Bergantino**的回答

```
$sth = mysql_query("SELECT ...");
print json_encode(mysql_fetch_assoc($sth)); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-02-24T09:39:18.437

代码：

```
$rows = array();

while($r = mysqli_fetch_array($result,MYSQL_ASSOC)) {

 $row_array['result'] = $r;

  array_push($rows,$row_array); // here we push every iteration to an array otherwise you will get only last iteration value
}

echo json_encode($rows); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-07-23T09:42:58.653

```
$array = array();
$subArray=array();
$sql_results = mysql_query('SELECT * FROM `location`');

while($row = mysql_fetch_array($sql_results))
{
    $subArray[location_id]=$row['location'];  //location_id is key and $row['location'] is value which come fron database.
    $subArray[x]=$row['x'];
    $subArray[y]=$row['y'];

 $array[] =  $subArray ;
}
echo'{"ProductsData":'.json_encode($array).'}'; 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2021-06-20T09:46:11.377

考虑到 mysql 中通常没有任何 NESTED json 对象等，制作自己的编码函数相当容易

首先，检索 mysqli 的函数会生成一个数组：

```
function noom($rz) {
    $ar = array();
    if(mysqli_num_rows($rz) > 0) {
        while($k = mysqli_fetch_assoc($rz)) {
            foreach($k as $ki=>$v) {
                $ar[$ki] = $v;
            }
        }
    }
    return $ar;
} 
```

现在，将数组编码为 json 的函数：

```
function json($ar) {
    $str = "";
    $str .= "{";
    $id = 0;
    foreach($ar as $a=>$b) {
        $id++;
        $str .= "\"".$a."\":";
        if(!is_numeric($b)) {
            $str .= "\"".$b."\"";
        } else {
            $str .= $b;
        }

        if($id < count($ar)) {
            $str .= ",";
        }
    }
    $str .= "}";
    return $str;
} 
```

然后使用它：

```
<?php
$o = new mysqli(
    "localhost",
    "root",""
);
if($o->connect_error) {
    echo "DUDE what are you/!";
} else {
    $rz = mysqli_query($o,
        "SELECT * FROM mydatabase.mytable"
    );
    $ar = noom($rz);
    echo json($ar);
}
?> 
```

# unix - 从文本文件中获取特定行

> ID：383633
> 
> 赞同：6
> 
> 时间：2008-12-20T19:10:26.020
> 
> 标签：unix, shell, file-io

我正在开发一个 UNIX 机器，并尝试运行一个应用程序，该应用程序将一些调试日志提供给标准输出。我已将此输出重定向到日志文件，但现在希望获取显示错误的行。

我的问题是一个简单的

```
cat output.log | grep FAIL 
```

没有帮助。因为这仅显示其中有 FAIL 的行。我想要一些更多的信息。就像这条线上面的 2-3 行一样，有 FAIL。有没有办法通过一个简单的shell命令来做到这一点？我想要一个命令行（可以有管道）来执行上述操作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-20T19:14:18.087

```
grep -C 3 FAIL output.log 
```

请注意，这也摆脱了[cat (UUOC) 的无用使用](http://web.archive.org/web/20140123014909/http://partmaps.org/era/unix/award.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T19:13:44.640

grep -A $NUM

这将在匹配后打印 $NUM 行尾随上下文。

-B $NUM 打印前导上下文。

> man grep 是你最好的朋友。

所以在你的情况下：

> 猫日志 | grep -A 3 -B 3 失败

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T19:38:08.960

我有两种我称之为的实现`sgrep`，一种在 Perl 中，一种仅使用 pre-Perl (pre-GNU) 标准 Unix 命令。如果你有 GNU `grep`，你就不需要这些了。处理前向和后向上下文搜索会更复杂，但这可能是一个有用的练习。

Perl 解决方案：

```
#!/usr/perl/v5.8.8/bin/perl -w
#
# @(#)$Id: sgrep.pl,v 1.6 2007/09/18 22:55:20 jleffler Exp $
#
# Perl-based SGREP (special grep) command
#
# Print lines around the line that matches (by default, 3 before and 3 after).
# By default, include file names if more than one file to search.
#
# Options:
# -b n1     Print n1 lines before match
# -f n2     Print n2 lines following match
# -n        Print line numbers
# -h        Do not print file names
# -H        Do     print file names

use strict;
use constant debug => 0;
use Getopt::Std;
my(%opts);

sub usage
{
    print STDERR "Usage: $0 [-hnH] [-b n1] [-f n2] pattern [file ...]\n";
    exit 1;
}

usage unless getopts('hnf:b:H', \%opts);
usage unless @ARGV >= 1;

if ($opts{h} && $opts{H})
{
    print STDERR "$0: mutually exclusive options -h and -H specified\n";
    exit 1;
}

my $op = shift;

print "# regex = $op\n" if debug;

# print file names if -h omitted and more than one argument
$opts{F} = (defined $opts{H} || (!defined $opts{h} and scalar @ARGV > 1)) ? 1 : 0;
$opts{n} = 0 unless defined $opts{n};

my $before = (defined $opts{b}) ? $opts{b} + 0 : 3;
my $after  = (defined $opts{f}) ? $opts{f} + 0 : 3;

print "# before = $before; after = $after\n" if debug;

my @lines = (); # Accumulated lines
my $tail  = 0;  # Line number of last line in list
my $tbp_1 = 0;  # First line to be printed
my $tbp_2 = 0;  # Last line to be printed

# Print lines from @lines in the range $tbp_1 .. $tbp_2,
# leaving $leave lines in the array for future use.
sub print_leaving
{
    my ($leave) = @_;
    while (scalar(@lines) > $leave)
    {
        my $line = shift @lines;
        my $curr = $tail - scalar(@lines);
        if ($tbp_1 <= $curr && $curr <= $tbp_2)
        {
            print "$ARGV:" if $opts{F};
            print "$curr:" if $opts{n};
            print $line;
        }
    }
}

# General logic:
# Accumulate each line at end of @lines.
# ** If current line matches, record range that needs printing
# ** When the line array contains enough lines, pop line off front and,
#    if it needs printing, print it.
# At end of file, empty line array, printing requisite accumulated lines.

while (<>)
{
    # Add this line to the accumulated lines
    push @lines, $_;
    $tail = $.;

    printf "# array: N = %d, last = $tail: %s", scalar(@lines), $_ if debug > 1;

    if (m/$op/o)
    {
        # This line matches - set range to be printed
        my $lo = $. - $before;
        $tbp_1 = $lo if ($lo > $tbp_2);
        $tbp_2 = $. + $after;
        print "# $. MATCH: print range $tbp_1 .. $tbp_2\n" if debug;
    }

    # Print out any accumulated lines that need printing
    # Leave $before lines in array.
    print_leaving($before);
}
continue
{
    if (eof)
    {
        # Print out any accumulated lines that need printing
        print_leaving(0);
        # Reset for next file
        close ARGV;
        $tbp_1 = 0;
        $tbp_2 = 0;
        $tail  = 0;
        @lines = ();
    }
} 
```

Pre-Perl Unix 解决方案（使用普通`ed`的 , `sed`, and `sort`- 虽然它使用`getopt`了当时不一定可用的）：

```
#!/bin/ksh
#
# @(#)$Id: old.sgrep.sh,v 1.5 2007/09/15 22:15:43 jleffler Exp $
#
#   Special grep
#   Finds a pattern and prints lines either side of the pattern
#   Line numbers are always produced by ed (substitute for grep),
#   which allows us to eliminate duplicate lines cleanly.  If the
#   user did not ask for numbers, these are then stripped out.
#
#   BUG: if the pattern occurs in in the first line or two and
#   the number of lines to go back is larger than the line number,
#   it fails dismally.

set -- `getopt "f:b:hn" "$@"`

case $# in
0)  echo "Usage: $0 [-hn] [-f x] [-b y] pattern [files]" >&2
    exit 1;;
esac

# Tab required - at least with sed (perl would be different)
# But then the whole problem would be different if implemented in Perl.
number="'s/^\\([0-9][0-9]*\\)       /\\1:/'"
filename="'s%^%%'"      # No-op for sed

f=3
b=3
nflag=no
hflag=no
while [ $# -gt 0 ]
do
    case $1 in
    -f) f=$2; shift 2;;
    -b) b=$2; shift 2;;
    -n) nflag=yes; shift;;
    -h) hflag=yes; shift;;
    --) shift; break;;
    *)  echo "Unknown option $1" >&2
        exit 1;;
    esac
done
pattern="${1:?'No pattern'}"
shift

case $# in
0)  tmp=${TMPDIR:-/tmp}/`basename $0`.$$
    trap "rm -f $tmp ; exit 1" 0
    cat - >$tmp
    set -- $tmp
    sort="sort -t: -u +0n -1"
    ;;
*)  filename="'s%^%'\$file:%"
    sort="sort -t: -u +1n -2"
    ;;
esac

case $nflag in
yes)    num_remove='s/[0-9][0-9]*://';;
no)     num_remove='s/^//';;
esac
case $hflag in
yes)    fileremove='s%^$file:%%';;
no)     fileremove='s/^//';;
esac

for file in $*
do
    echo "g/$pattern/.-${b},.+${f}n" |
    ed - $file |
    eval sed -e "$number" -e "$filename" |
    $sort |
    eval sed -e "$fileremove" -e "$num_remove"
done

rm -f $tmp
trap 0
exit 0 
```

的 shell 版本`sgrep`是在 1989 年 2 月编写的，并在 1989 年 5 月修复了错误。然后它保持不变，除了 1997 年的管理更改（SCCS 到 RCS 转换）直到 2007 年我添加了该`-h`选项。我在 2007 年切换到 Perl 版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-22T20:14:01.060

[http://thedailywtf.com/Articles/The_Complicator_0x27_s_Gloves.aspx](http://thedailywtf.com/Articles/The_Complicator_0x27_s_Gloves.aspx)

您可以使用`sed`打印特定行，假设您想要第 20 行

`sed '20 p' -n`FILE_YOU_WANT_THE_LINE_FROM

完毕。

-n 防止从文件中回显行。引号中的部分是`sed`要应用的规则，它指定您希望规则应用到第 20 行，并且您要打印。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T19:16:34.993

[在 Windows 上](http://getgnuwin32.sourceforge.net/)使用GNU grep ：

```
$ grep --context 3 FAIL output.log

$ grep --help | grep context 
```

```
  -B, --before-context=NUM 打印前导上下文的 NUM 行
  -A, --after-context=NUM 打印 NUM 行尾随上下文
  -C, --context=NUM 打印 NUM 行输出上下文
  -NUM 与 --context=NUM 相同

```

# php - 在标记的视频系统上寻找有关“相关视频”查询的建议

> ID：383634
> 
> 赞同：9
> 
> 时间：2008-12-20T19:10:29.547
> 
> 标签：php, mysql

好吧，我运行一个小型视频网站，在实际的视频页面上，有一条类似于大多数视频方面（例如 YouTube）的“相关视频”，目前我所做的只是随机获取其中一个标签并查找其他视频同一个标签。毫不奇怪，这不是一个好方法，因为有些标签非常模糊，有些视频标签错误。

当前查询的示例：

```
SELECT video_name FROM videos INNER JOIN videotags ON videos.id=videotags.video_id INNER JOIN tags ON tags.id=videotags.tag_id WHERE tag_name='x' AND videos.id<>'y' LIMIT 5 
```

其中 x 是当前视频中的任一标签，y 是当前视频中的 ID。（PS我用的是参数化查询不用担心）

我只是好奇你们会如何处理这个问题，也许合并类似的视频标题会更好？

这是我的数据库表的设置方式：

```
VIDEOS TABLE
------------
video_id [PK,auto_increment] int(11)
video_name varchar(255)

TAGS TABLE
----------
tag_id [PK,auto_increment] int(11)
tag_name varchar(255)

VIDEOTAGS TABLE
---------------
tag_id [PK,FK] int(11)
video_id [PK,FK] int(11) 
```

视频表中显然有更多列，但这只是说明了简单的多对多关系与双方的自动递增主键

该站点是基于 PHP 和 MySQL 数据库构建的，但这并不重要 :)

**编辑：**有一些关于走有机路线的讨论，所以我想我会发布我的另外两个半相关的表格，这些表格与视频观看次数和视频评级有关。现在请注意，由于隐私问题，我无意在视频视图表中添加更多列（是的，我知道我将 IP 存储在评级表中）

```
VIDEOVIEWS TABLE
----------------
video_id [FK] int(11)
view_time datetime

VIDEORATINGS TABLE
------------------
video_id [PK,FK] int(11)
ip_address [PK] varchar(15)
rating int(1)
rate_time datetime 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T06:21:43.437

此查询应返回与给定视频 (v1) 具有共同标签的视频 (v2) 的 ID，按共同标签数量的降序排列。

```
SELECT v2.video_id
FROM VideoTags AS v1
  JOIN VideoTags AS v2
  USING (tag_id)
WHERE v1.video_id = ?
  AND v1.video_id <> v2.video_id
GROUP BY v2.video_id 
ORDER BY COUNT(*) DESC; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T19:50:44.193

非常有趣的问题。

这只是大声思考，但我能想到的一些选择是：

1) 使用所有标签 - 例如，假设查询具有该视频的每个标签的视频列表。产生一个视频列表，按它们出现在这些列表中的数量排序，即它们与该视频有多少共同标签的计数。具有更多共同标签的标签可能“更相关”。

（我并不是建议您在现实中进行多个查询，只是试图解释我的想法……比我有更好 SQL-fu 的人可能会想出一个执行此操作的查询。也许您可以另外订购通过受欢迎程度或您可能拥有的其他信息）。

2) 尝试使用一种算法，让相关视频自然出现，就像亚马逊“买了这个的人也买了这个”。例如，如果您跟踪谁查看了哪些内容，您可以设计一个生成此类列表的查询。

# c# - 如何在 Coderush 中显示突出显示的箭头

> ID：383658
> 
> 赞同：1
> 
> 时间：2008-12-20T19:38:46.667
> 
> 标签：c#, .net, vb.net, winforms

我正在使用 c# 和 vb.net 编写 winforms。

我喜欢 coderush 中使用的箭头。

对于那些没有看过 coderush 箭头的人，请看这张图片。

[![http://www.aspnetpro.com/productreviews/2004/08/asp200408bn_p/asp200408bn_p_image002.jpg](https://i.stack.imgur.com/6IVX6.jpg)](https://i.stack.imgur.com/6IVX6.jpg)
[（来源：[aspnetpro.com](http://www.aspnetpro.com/productreviews/2004/08/asp200408bn_p/asp200408bn_p_image002.jpg)）]

`[http://www.aspnetpro.com/productreviews/2004/08/asp200408bn_p/asp200408bn_p_image002.jpg](http://www.aspnetpro.com/productreviews/2004/08/asp200408bn_p/asp200408bn_p_image002.jpg)`

我想在我的程序中有类似的东西。唯一的区别是我将使用它来突出显示文本框和按钮。

我只想要箭头，箭头上的文字并不重要。

所以也许我需要做一个像 DrawHighlightArrow(controlname) 这样的通用函数

它会设法在那个控件旁边画一个箭头

请提出一个在 C# 或 Vb.net 中解决此问题的好方法

谢谢你
安娜

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T03:47:49.267

您*可以*创建一个具有透明背景的自定义表单，使用 GDI+ 在其上绘制箭头（使用上述 marxidad 的技术，或者只需在其上放置一个 PictureBox 并处理 Paint 事件）。

然后只需在现有“父”表单的顶部实例化箭头表单的新实例（您可能希望将 TopMost 设置为 true）并启动 Timer 以将其淡出。

唯一需要注意的是...

*   如果您过早关闭“父”表单，请正确清理，并且...
*   将任何点击事件传递给“父”表单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T20:35:41.543

覆盖 Form 上的 OnPaint 方法，并在 PainteEventArgs.Graphics 属性中的对象上使用[DrawImage()](http://msdn.microsoft.com/en-us/library/42807xh1.aspx)方法来绘制箭头的位图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T23:19:20.667

[这里](http://www.codeproject.com/KB/graphics/locuseffects.aspx)有一个非常棒的库，叫做 Locus Effects 。去检查一下，它完全符合您的要求。

# nant - Windows Vista 64 上的 Nant

> ID：383665
> 
> 赞同：7
> 
> 时间：2008-12-20T19:48:27.317
> 
> 标签：nant

我想知道是否有人在 Windows Vista 64 位版本上成功运行了 Nant。它一直失败

设置道具：

[sysinfo] sys.*下设置系统信息属性

构建失败

属性名称“sys.env.CommonProgramFiles(x86)”无效。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T20:49:21.343

是的，它有效。NAnt 默认是为 32 位构建的。因此，必须记住在 32 位命令提示符或[PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/download.mspx)中运行它。我在 Vista 64 机器上以 PowerShell (x86) 模式运行 NAnt 脚本，但 SDK 提示符（32 位）也可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T22:18:27.577

它对我也很有效。我确实按照 Scott 在 32 位命令提示符下所说的那样运行。

它也可能只是您试图捕捉的特定事物，而 nAnt 并不期待。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-20T14:21:11.897

我一直在我的 Windows 7 64 位环境中使用 NAnt，并且发现为了这样做（无需使用 32 位命令环境）只需删除 NAnt 脚本中对 sysinfo 的引用。

我一遍又一遍地浏览了我们的构建脚本，看不到删除此设置的任何不利之处，因为我无法证明我正在使用它的结果，除了将大量数据转储到屏幕上，这在调试期间是无价的！！

希望这可以帮助！

# html - 可接受的网站导航方法？

> ID：383673
> 
> 赞同：1
> 
> 时间：2008-12-20T19:57:27.970
> 
> 标签：html

过去，我创建了带有 php $_GET 变量辅助导航的网站。实现了一个布局，然后根据传递到 URL 的变量包含了内容。

我现在正在创建一个没有任何服务器端帮助的网站。我想知道什么是导航页面的好方法，而不需要在多个 html 文件中重复布局的冗余。

您过去使用过什么样的导航方法，您认为最容易接受/最干净的导航方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T01:02:42.177

目前尚不清楚您遇到了什么样的限制，但让我们尝试一下：

1.  如果您有一个 Web 服务器并且该服务器是 Apache，请考虑[Server Side Includes](http://httpd.apache.org/docs/1.3/howto/ssi.html)；
2.  如果您从 CD 等运行静态站点，您可以使用预处理器在编译时创建包括菜单在内的静态页面。Google for ' *HTML preprocessor* '，有几十个；
3.  他们被鄙视是正确的，“*上个世纪*”，但你考虑过[HTML 框架](http://www.w3.org/TR/html4/present/frames.html)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T20:04:03.463

你的意思是你有所有的静态文件？也许你可以使用 AJAX？

# asp.net - 使用从独立 html 页面返回 json 的 asp.net Web 服务

> ID：383680
> 
> 赞同：2
> 
> 时间：2008-12-20T20:07:48.183
> 
> 标签：asp.net, web-services, json

我在 asp.net 中开发了一个 Web 服务，并且能够从项目内的 aspx 页面对其进行测试，并且可以轻松地显示以 JSON 格式返回的信息。

我现在需要从一个独立的 html 页面使用 Web 服务。

有人有这方面的经验吗？我对取代它的部分感到困惑

```
<asp:ScriptManager ID="ScriptManager" runat="server">
    <Services>
        <asp:ServiceReference Path="~\MyService.asmx" />
    </Services>
</asp:ScriptManager> 
```

如果直接使用 html 和 javascript 无法做到这一点，有人可以向我展示一个独立的 php 页面吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T20:19:32.403

请参阅此链接：

[http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)

使用 jQuery

www.jquery.org

本质上，您使您的 Web 服务脚本可调用，只是您的 Web 服务定义中的一个属性，然后您可以：

```
 $.ajax({
    type: "POST",
    url: "~/MyService.asmx/MyMethod",
    data: "{parameterName:'" aStringArgument + "'}",
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function(msg) {
       var data = msg.d
       // Now var is an object with properties just like your object
    }
  }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T20:15:52.160

[使用 JQUery。](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T20:20:30.030

您可以使用 Javascript 访问您的网络服务。

例如 - 如果你有一个这样定义的 json webservice：

```
[WebMethod]
[ScriptMethod(ResponseFormat = ResponseFormat.Json)]
public String Foo(String p1, String p2)
{    
    return "Hello World";
} 
```

你可以这样称呼它：

```
var httpobj = getXmlHttpRequestObject();
//Gets the browser specific XmlHttpRequest Object
function getXmlHttpRequestObject() 
{    
    if (window.XMLHttpRequest)
        return new XMLHttpRequest();
    else if(window.ActiveXObject)
       return new ActiveXObject("Microsoft.XMLHTTP");
} 

CallService()
{    
    //Set the JSON formatted input params    
    var param = "{'p1' : 'value1', 'p2' : 'value2'}";    
    //Send it to webservice    
    if(httpobj.readyState == 4 || httpobj.readyState == 0)
    {
        httpobj.open("POST", 'service.asmx/' + 'Foo', true);
       //Mark the request as JSON and UTF-8
       httpobj.setRequestHeader('Content-Type','application/json; charset=utf-8');
       httpobj.onreadystatechange = OnSuccess;
       httpobj.send(param);
    }
}

//Called on successfull webservice calls
OnSuccess()
{
   if (httpobj.readyState == 4)
   {
       //Retrieve the JSON return param
       var response = eval("(" + httpobj.responseText + ")");
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T14:39:53.897

如果您不想使用 ScriptManager（它会为您的页面添加超过 100k 的 JS），您可以使用[此方法使用 jQuery 连接到您的 Web 服务](http://www.crossedconnections.org/w/index.php/2008/11/28/aspnet-web-services-from-javascript-with-jquery-without-the-scriptmanager/)。

# visual-studio - 全球化源代码

> ID：383681
> 
> 赞同：1
> 
> 时间：2008-12-20T20:09:41.737
> 
> 标签：visual-studio, globalization

我正在运行一个开源项目，中国用户时不时地报告由于无法识别的转义序列 .cs 和 .js 文件而导致的构建错误。当他们看到他们粘贴文件时，我注意到拉丁字符已更改为中文。

我正在使用 Visual Studio，当我查看“高级保存选项”时，设置为“西欧 (Windows) - 代码页 1252”。

我应该使用 Unicode（带签名的 UTF-8）吗？有没有办法转换解决方案中的所有文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T21:04:17.070

您可能应该使用 UTF-8（或 UTF-16），这样您就可以处理所有字符。Codepage 1252 与 ISO-8859-1 几乎相同，但不能处理中文字符。这是一个可能感兴趣的[链接。](http://intertwingly.net/stories/2004/04/14/i18n.html)

# .net - 你如何循环当前加载的程序集？

> ID：383686
> 
> 赞同：123
> 
> 时间：2008-12-20T20:15:08.653
> 
> 标签：.net, assemblies

我的 ASP.NET 应用程序中有一个“诊断”页面，它执行诸如验证数据库连接、显示当前 appSettings 和 ConnectionStrings 等操作。此页面的一部分显示了整个使用的重要类型的程序集版本，但我无法弄清楚如何有效地显示所有已加载程序集的版本。

**找出.NET 应用程序中所有*当前引用和/或加载的程序集的最有效方法是什么？***

注意：我对基于文件的方法不感兴趣，比如在特定目录中迭代 *.dll。我对应用程序现在实际*使用*的内容感兴趣。

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2008-12-20T20:18:17.787

获取当前加载的程序集`AppDomain`：

```
var loadedAssemblies = AppDomain.CurrentDomain.GetAssemblies(); 
```

获取另一个程序集引用的程序集：

```
var referencedAssemblies = someAssembly.GetReferencedAssemblies(); 
```

请注意，如果程序集 A 引用程序集 B 并且程序集 A 已加载，这并不意味着程序集 B 也已加载。仅在需要时才加载程序集 B。因此，`GetReferencedAssemblies()`返回`AssemblyName`实例而不是`Assembly`实例。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2014-10-10T13:09:01.563

此扩展方法以递归方式获取所有引用的程序集，包括嵌套程序集。

当它使用`ReflectionOnlyLoad`时，它将程序集加载到单独的 AppDomain 中，这具有不干扰 JIT 过程的优点。

您会注意到还有一个`MyGetMissingAssembliesRecursive`. 您可以使用它来检测任何缺少的程序集，这些程序集被引用但由于某种原因不在当前目录中。[这在使用MEF](http://msdn.microsoft.com/en-us/library/dd460648(v=vs.110).aspx)时非常有用。返回列表将为您提供丢失的程序集以及拥有它的人（其父级）。

```
/// <summary>
///     Intent: Get referenced assemblies, either recursively or flat. Not thread safe, if running in a multi
///     threaded environment must use locks.
/// </summary>
public static class GetReferencedAssemblies
{
    static void Demo()
    {
        var referencedAssemblies = Assembly.GetEntryAssembly().MyGetReferencedAssembliesRecursive();
        var missingAssemblies = Assembly.GetEntryAssembly().MyGetMissingAssembliesRecursive();
        // Can use this within a class.
        //var referencedAssemblies = this.MyGetReferencedAssembliesRecursive();
    }

    public class MissingAssembly
    {
        public MissingAssembly(string missingAssemblyName, string missingAssemblyNameParent)
        {
            MissingAssemblyName = missingAssemblyName;
            MissingAssemblyNameParent = missingAssemblyNameParent;
        }

        public string MissingAssemblyName { get; set; }
        public string MissingAssemblyNameParent { get; set; }
    }

    private static Dictionary<string, Assembly> _dependentAssemblyList;
    private static List<MissingAssembly> _missingAssemblyList;

    /// <summary>
    ///     Intent: Get assemblies referenced by entry assembly. Not recursive.
    /// </summary>
    public static List<string> MyGetReferencedAssembliesFlat(this Type type)
    {
        var results = type.Assembly.GetReferencedAssemblies();
        return results.Select(o => o.FullName).OrderBy(o => o).ToList();
    }

    /// <summary>
    ///     Intent: Get assemblies currently dependent on entry assembly. Recursive.
    /// </summary>
    public static Dictionary<string, Assembly> MyGetReferencedAssembliesRecursive(this Assembly assembly)
    {
        _dependentAssemblyList = new Dictionary<string, Assembly>();
        _missingAssemblyList = new List<MissingAssembly>();

        InternalGetDependentAssembliesRecursive(assembly);

        // Only include assemblies that we wrote ourselves (ignore ones from GAC).
        var keysToRemove = _dependentAssemblyList.Values.Where(
            o => o.GlobalAssemblyCache == true).ToList();

        foreach (var k in keysToRemove)
        {
            _dependentAssemblyList.Remove(k.FullName.MyToName());
        }

        return _dependentAssemblyList;
    }

    /// <summary>
    ///     Intent: Get missing assemblies.
    /// </summary>
    public static List<MissingAssembly> MyGetMissingAssembliesRecursive(this Assembly assembly)
    {
        _dependentAssemblyList = new Dictionary<string, Assembly>();
        _missingAssemblyList = new List<MissingAssembly>();
        InternalGetDependentAssembliesRecursive(assembly);

        return _missingAssemblyList;
    }

    /// <summary>
    ///     Intent: Internal recursive class to get all dependent assemblies, and all dependent assemblies of
    ///     dependent assemblies, etc.
    /// </summary>
    private static void InternalGetDependentAssembliesRecursive(Assembly assembly)
    {
        // Load assemblies with newest versions first. Omitting the ordering results in false positives on
        // _missingAssemblyList.
        var referencedAssemblies = assembly.GetReferencedAssemblies()
            .OrderByDescending(o => o.Version);

        foreach (var r in referencedAssemblies)
        {
            if (String.IsNullOrEmpty(assembly.FullName))
            {
                continue;
            }

            if (_dependentAssemblyList.ContainsKey(r.FullName.MyToName()) == false)
            {
                try
                {
                    var a = Assembly.ReflectionOnlyLoad(r.FullName);
                    _dependentAssemblyList[a.FullName.MyToName()] = a;
                    InternalGetDependentAssembliesRecursive(a);
                }
                catch (Exception ex)
                {
                    _missingAssemblyList.Add(new MissingAssembly(r.FullName.Split(',')[0], assembly.FullName.MyToName()));
                }
            }
        }
    }

    private static string MyToName(this string fullName)
    {
        return fullName.Split(',')[0];
    }
} 
```

# 更新

为了使这个代码线程安全，`lock`在它周围加上一个。默认情况下，它目前不是线程安全的，因为它引用了一个共享的静态全局变量来发挥它的魔力。

# iphone - 创建 App Store 分发证书 - 在 Common Name 字段中输入什么？

> ID：383687
> 
> 赞同：3
> 
> 时间：2008-12-20T20:15:31.567
> 
> 标签：iphone, certificate, app-store, portal

在证书助手中创建应用商店分发证书时，我是在 Common Name 字段中输入我的名字还是公司名称？

[此页面显示](http://developer.apple.com/iphone/manage/distribution/index.action)“在通用名称字段中输入您的公司/组织/部门名称”，而门户的添加证书区域显示“在通用名称字段中，输入您的姓名”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T20:36:56.393

它需要与 Apple 开发者网站给你的分发证书中的通用名称相匹配。如果您使用钥匙串访问实用程序，您可以查看证书以了解它是什么。

（如果您查看您的开发配置，您会看到相同的字段与您的开发人员证书的通用名称匹配，这是一个不同的证书。您也会在钥匙串中找到该证书）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T22:04:12.567

我使用了我的开发者连接配置文件的公司/组织字段，他们似乎已接受该应用程序进行审核。我想那行得通。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T07:44:49.707

您应该使用您提交证书签名请求的程序门户的“团队”>“联系信息”选项卡下显示的名称。如果您是公司帐户的团队代理，则应为公司名称，如果您有个人帐户，则应为个人姓名。

# delphi - 泛型：什么是“构造约束”？

> ID：383689
> 
> 赞同：9
> 
> 时间：2008-12-20T20:17:07.523
> 
> 标签：delphi, generics, constructor, delphi-2009

我制作了一个自定义 TObjectList 后代，旨在保存基对象类的子类。它看起来像这样：

```
interface
   TMyDataList<T: TBaseDatafile> = class(TObjectList<TBaseDatafile>)
   public
      constructor Create;
      procedure upload(db: TDataSet);
   end;

implementation

constructor TMyDataList<T>.Create;
begin
   inherited Create(true);
   self.Add(T.Create);
end; 
```

我希望每个新列表都以其中的一个空白对象开始。这很简单，对吧？但是编译器不喜欢它。它说：

“无法在类型参数声明中创建没有 CONSTRUCTOR 约束的新实例”我只能假设这是与泛型相关的东西。任何人都知道发生了什么以及如何使这个构造函数工作？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-20T20:23:31.897

您正在尝试创建`T`via的实例`T.Create`。这不起作用，因为编译器不知道您的泛型类型具有无参数构造函数（请记住：这不是必需的）。为了纠正这个问题，您必须创建一个构造函数约束，如下所示：

```
<T: constructor> 
```

或者，在您的具体情况下：

```
<T: TBaseDatafile, constructor> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-09-04T20:04:55.423

只是对一个老问题的快速更新..

您不需要构造函数约束，也可以通过像这样使用 RTTI（使用带有 XE2 的 RTTI 或 System.RTTI）对带有参数的对象执行此操作

```
constructor TMyDataList<T>.Create;
var
  ctx: TRttiContext;
begin
   inherited Create(true);
   self.Add(
     ctx.
     GetType(TClass(T)).
     GetMethod('create').
     Invoke(TClass(T),[]).AsType<T>
   );
end; 
```

如果您有参数，只需像这样添加它们

```
constructor TMyDataList<T>.Create;
var
  ctx: TRttiContext;
begin
   inherited Create(true);
   self.Add(
     ctx.
     GetType(TClass(T)).
     GetMethod('create').
     Invoke(TClass(T),[TValue.From('Test'),TValue.From(42)]).AsType<T>
   );
end; 
```

# json - 什么是 JSON，它的用途是什么？

> ID：383692
> 
> 赞同：558
> 
> 时间：2008-12-20T20:19:11.093
> 
> 标签：json

我查看了 Wikipedia 并在 Google 上搜索并阅读了官方文档，但我仍然没有真正理解 JSON 是什么，以及我为什么要使用它。

我一直在使用 PHP、MySQL 和 JavaScript / HTML 构建应用程序，如果 JSON 可以做一些事情来让我的生活更轻松，或者我的代码更好，或者我的用户界面更好，那么我想知道它。有人可以给我一个简洁的解释吗？

* * *

## 回答 #1

> 赞同：671
> 
> 时间：2008-12-20T20:25:37.507

**JSON（JavaScript Object Notation）是一种用于数据交换的轻量级格式。** 它基于 JavaScript 语言的一个子集（对象在 JavaScript 中的构建方式）。如[MDN 中所述](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON)，有些 JavaScript 不是 JSON，有些 JSON 不是 JavaScript。

使用此功能的一个示例是 Web 服务响应。在“旧”时代，Web 服务使用 XML 作为回传数据的主要数据格式，但自从 JSON 出现（*Douglas Crockford在**[RFC 4627](https://www.rfc-editor.org/rfc/rfc4627)**中指定 JSON 格式*）以来，它一直是首选格式，因为它更多**轻的**

[您可以在官方JSON 网站](http://www.json.org/)上找到更多信息。

JSON 建立在两种结构之上：

*   名称/值对的集合。在各种语言中，这被实现为对象、记录、结构、字典、哈希表、键控列表或关联数组。
*   值的有序列表。在大多数语言中，这被实现为数组、向量、列表或序列。

* * *

## JSON结构

[![JSON对象图](https://i.stack.imgur.com/VHjrV.gif)](http://www.json.org/object.gif)

[![JSON数组图](https://i.stack.imgur.com/OCsS0.gif)](http://www.json.org/array.gif)

[![JSON值图](https://i.stack.imgur.com/7zOHB.gif)](http://www.json.org/value.gif)

[![JSON字符串图](https://i.stack.imgur.com/pzAPZ.gif)](http://www.json.org/string.gif)

[![JSON数字图](https://i.stack.imgur.com/EK6wD.gif)](http://www.json.org/number.gif)

以下是 JSON 数据的示例：

```
{
     "firstName": "John",
     "lastName": "Smith",
     "address": {
         "streetAddress": "21 2nd Street",
         "city": "New York",
         "state": "NY",
         "postalCode": 10021
     },
     "phoneNumbers": [
         "212 555-1234",
         "646 555-4567"
     ]
 } 
```

* * *

# JavaScript 中的 JSON

**JSON（在 Javascript 中）是一个字符串！**

人们经常假设所有的 Javascript 对象都是 JSON 并且 JSON 是一个 Javascript 对象。这是不正确的。

在 Javascript`var x = {x:y}`中**不是 JSON**，这是一个**Javascript 对象**。两者不是一回事。JSON 等价物（以 Javascript 语言表示）将是`var x = '{"x":"y"}'`. `x`是**字符串**类型的对象，而不是它自己的对象。要将其转换为完全成熟的 Javascript 对象，您必须首先对其进行解析，`var x = JSON.parse('{"x":"y"}');`,`x`现在是一个对象，但这不再是 JSON。

请参阅[Javascript 对象与 JSON](https://stackoverflow.com/questions/8294088/javascript-object-vs-json)

* * *

使用 JSON 和 JavaScript 时，您可能想使用该`eval`函数来评估回调中返回的结果，但不建议这样做，因为 JSON 中有两个字符（U+2028 和 U+2029）有效，但在 JavaScript 中无效（[在这里](https://web.archive.org/web/20110622075541/http://timelessrepo.com/json-isnt-a-javascript-subset "JSON：不是的 Javascript 子集")阅读更多内容）。

因此，必须始终尝试使用 Crockford 的脚本，该脚本在评估它之前检查一个有效的 JSON。[可以在此处](http://www.json.org/js.html)找到脚本说明的链接，这里是js 文件的[直接链接。](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)现在每个主要的浏览器都有[自己的实现](https://stackoverflow.com/q/891299/1505348)。

关于如何使用 JSON 解析器的示例（使用上述代码片段中的 json）：

```
//The callback function that will be executed once data is received from the server
var callback = function (result) {
    var johnny = JSON.parse(result);
    //Now, the variable 'johnny' is an object that contains all of the properties 
    //from the above code snippet (the json example)
    alert(johnny.firstName + ' ' + johnny.lastName); //Will alert 'John Smith'
}; 
```

JSON 解析器还提供了另一种非常有用的方法，`stringify`. 该方法接受一个 JavaScript 对象作为参数，并返回一个 JSON 格式的字符串。*当您想要将数据发送回服务器*时，这很有用：

 *```
var anObject = {name: "Andreas", surname : "Grech", age : 20};
var jsonFormat = JSON.stringify(anObject);
//The above method will output this: {"name":"Andreas","surname":"Grech","age":20} 
```

上述两个方法 (`parse`和`stringify`) 还带有第二个参数，这是一个函数，将在最终结果的每一级为每个键和值调用，每个值将被您输入的函数的结果替换。（更多关于[这里](http://www.json.org/js.html)）

顺便说一句，对于那些认为 JSON 仅适用于 JavaScript 的所有人，请查看[这篇](http://simonwillison.net/2006/Dec/20/json/)解释并确认其他情况的帖子。

* * *

## 参考

*   [JSON.org](http://www.json.org/)
*   [维基百科](http://en.wikipedia.org/wiki/JSON)
*   [3 分钟内的 Json](http://secretgeek.net/json_3mins.asp)（感谢[mson](https://stackoverflow.com/questions/383692/what-is-json-and-why-would-i-use-it#384026)）
*   [在 Yahoo! 中使用 JSON Web 服务](http://developer.yahoo.com/javascript/json.html)（感谢[gljivar](https://stackoverflow.com/questions/383692/what-is-json-and-why-would-i-use-it#383716)）
*   [JSON 到 CSV 转换器](https://json-csv.com)
*   替代[JSON 到 CSV 转换器](https://jsontoexcel.com)
*   [JSON Lint（JSON 验证器）](https://jsonlint.com/)

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2017-01-15T01:36:44.310

## 概念解释 - 没有代码或技术术语

**什么是 JSON？– 我是如何向我的妻子^(TM解释的)**

**我：** “这基本上是一种以书面形式与某人交流的方式......但有非常具体的规则。

**妻子：**是吗……？

**我：**在平淡无奇的英语中，规则很宽松：就像笼子里的格斗一样。JSON 并非如此。描述事物的方式有很多种：

• 示例1：我们家有4 口人：你、我和2 个孩子。

• 示例2：我们的家庭：你、我、kid1 和kid2。

• 示例 3：家庭：[你，我，孩子 1，孩子 2]

• 示例4：我们家有4 口人：妈妈、爸爸、孩子1 和孩子2。

**妻子：**他们为什么不直接用简单的英语呢？

**我：**他们会，但请记住我们正在处理计算机。计算机是愚蠢的，无法理解句子。因此，当涉及计算机时，我们必须非常具体，否则他们会感到困惑。此外，JSON 是一种相当有效的通信方式，因此大部分不相关的东西都被删除了，这很方便。如果您想将我们的家人与计算机通信，您可以这样做的一种方法是：

```
{
    "Family": ["Me", "Wife", "Kid1", "Kid2"] 
} 
```

……这基本上是 JSON。但请记住，您必须遵守 JSON 语法规则。如果您违反了这些规则，那么计算机将根本无法理解（即解析）您正在编写的内容。

**老婆：**那我怎么用Json写呢？

一个好方法是使用 json 序列化器 - 这是一个为您完成繁重工作的库。

**概括**

> **JSON 基本上是一种向某人传达数据的方式，具有非常非常具体的规则。使用键值对和数组。**这是解释的概念，此时值得阅读上面的具体规则。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-12-20T20:54:12.740

简而言之 - JSON 是一种序列化方式，它成为 JavaScript 代码。执行时（使用 eval 或其他方式），此代码创建并返回一个 JavaScript 对象，其中包含您序列化的数据。这是可用的，因为 JavaScript 允许以下语法：

```
var MyArray = [ 1, 2, 3, 4]; // MyArray is now an array with 4 elements
var MyObject = {
    'StringProperty' : 'Value',
    'IntProperty' : 12,
    'ArrayProperty' : [ 1, 2, 3],
    'ObjectProperty' : { 'SubObjectProperty': 'SomeValue' }
}; // MyObject is now an object with property values set. 
```

您可以将其用于多种目的。一方面，这是一种将数据从服务器后端传递到 JavaScript 代码的舒适方式。因此，这经常在 AJAX 中使用。

您还可以将其用作独立的序列化机制，它比 XML 更简单且占用空间更少。存在许多库，允许您为各种编程语言序列化和反序列化 JSON 中的对象。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-12-21T02:35:33.423

简而言之，它是一种用于传递数据的脚本符号。在某些方面是 XML 的替代方案，本机支持基本数据类型、数组和关联数组（名称-值对，称为对象，因为它们代表的是对象）。

语法是 JavaScript 中使用的语法，JSON 本身代表“JavaScript Object Notation”。然而，它已经变得可移植并且也用于其他语言。

一个有用的详细链接在这里：

[http://secretgeek.net/json_3mins.asp](http://secretgeek.net/json_3mins.asp)

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2012-01-19T05:20:30.020

JSON 格式通常用于通过网络连接序列化和传输结构化数据。它主要用于在服务器和 Web 应用程序之间传输数据，作为 XML 的替代品。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-12-20T20:27:33.977

JSON 是 JavaScript 对象表示法。与 XML 相比，它是一种更紧凑的跨网络连接传输数据集的方式。我建议在任何类似 AJAX 的应用程序中使用 JSON，否则 XML 将成为“推荐”选项。XML 的冗长将增加下载时间并增加带宽消耗 ($$$)。您可以使用 JSON 实现相同的效果，它的标记几乎专门用于数据本身，而不是底层结构。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-12-20T20:34:49.923

常见的简短回答是：如果您使用 AJAX 进行数据请求，您可以轻松地将对象作为 JSON 字符串发送和返回。Javascript 的可用扩展支持所有 javascript 类型的 toJSON() 调用，以便在 AJAX 请求中将数据发送到服务器。AJAX 响应可以将对象作为 JSON 字符串返回，可以通过简单的 eval 调用将其转换为 Javascript 对象，例如，如果 AJAX 函数 someAjaxFunctionCallReturningJson 返回

```
"{ \"FirstName\" : \"Fred\", \"LastName\" : \"Flintstone\" }" 
```

你可以用 Javascript 编写

```
var obj = eval("(" + someAjaxFunctionCallReturningJson().value + ")");
alert(obj.FirstName);
alert(obj.LastName); 
```

JSON 也可以用于 Web 服务有效负载等，但对于 AJAX 结果来说真的很方便。

*   更新（十年后）：不要这样做，使用 JSON.parse

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-01T18:54:33.220

**我喜欢 JSON 主要是因为它非常简洁**。对于可以 gzip 压缩的 Web 内容，这不一定是什么大问题（这就是为什么**x** html 如此受欢迎）。但在某些情况下，这可能是有益的。

例如，对于一个项目，我正在传输需要序列化并通过[XMPP](http://xmpp.org/)传输的信息。由于大多数服务器会限制您可以在单个消息中传输的数据量，因此我发现使用 JSON 而不是明显的替代方案 XML 会有所帮助。

作为额外的奖励，如果您熟悉 Python 或 Javascript，那么您已经非常了解 JSON，并且无需太多培训即可解释它。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2015-05-19T11:00:40.220

**什么是 JSON？**

JavaScript Object Notation (JSON) 是一种轻量级的数据交换格式，其灵感来自 JavaScript 的对象文字。

**JSON 值可以包括：**

对象（名称-值对的集合） 数组（值的有序列表） 字符串（双引号） 数字 true、false 或 null

JSON 与语言无关。

**JSON 与 PHP？**

PHP 版本 5.2.0 之后，JSON 扩展默认解码和编码功能。

Json_encode - 返回值的 JSON 表示 Json_decode - 解码 JSON 字符串 Json_last_error - 返回最后发生的错误。

**JSON 语法和规则？**

JSON 语法源自 JavaScript 对象表示法语法：

数据在名称/值对中 数据由逗号分隔 花括号保存对象 方括号保存数组

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2018-03-29T20:36:26.970

有时在不需要技术性的地方给出了技术性，虽然许多投票最多的答案都是准确的技术性和具体的，但我个人认为它们不像维基百科或在官方文档。

我喜欢考虑 JSON 的方式正是它的本质——一种在不同语言世界中的语言。然而，JSON 和其他语言的区别在于“每个人”都“说”JSON，以及他们的“母语”。

使用一个真实世界的例子，让我们假设我们有三个人。一个人说伊博语作为他们的母语。第二个人想与第一个人互动，但是，第一个人说约鲁巴语作为他们的第一语言。

我们能做些什么？

值得庆幸的是，我们示例中的第三个人说英语长大，但也碰巧说伊博语**和**约鲁巴语作为第二语言，因此可以充当前两个人之间的中介。

在编程世界中，第一个“人”是 Python，第二个“人”是 Ruby，第三个“人”是 JSON，恰好能够将 Ruby“翻译”成 Python，反之亦然！现在显然这个类比不是一个完美的类比，但是，作为双语的人，我相信这是了解 JSON 如何与其他编程语言交互的一种简单方法。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-20T20:42:26.227

我们必须在大学做一个项目，我们面临一个非常大的问题，它被称为同源政策。Amog 其他事情，它使您的 Javascript 中的 XMLHttpRequest 方法无法向您的站点所在域以外的域发出请求。

例如，如果您的网站位于 www.example.com，则您不能向 www.otherexample.com 发出请求。JSONRequest 允许这样做，但如果该站点允许，您将获得 JSON 格式的结果（例如，它有一个以 JSON 格式返回消息的 Web 服务）。那可能是您可以使用 JSON 的一个问题。

这是一些实用的东西：[Yahoo JSON](http://developer.yahoo.com/common/json.html)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-10-22T10:21:56.180

JSON 和传统语法之间的区别如下（在 Javascript 中）

**传统的**

```
 function Employee(name, Id, Phone, email){

      this.name = name;
      this.Id = Id;
      this.Phone = Phone;
      this.email = email;
  }

  //access or call it as 

var Emp = new Employee("mike","123","9373849784","mike.Anderson@office.com"); 
```

**使用 JSON**

如果我们使用 JSON，我们可以用不同的方式定义为

```
 function Employee(args){

   this.name = args.name;
   this.Id = args.Id;
   this.Phone = args.Phone;
   this.email = args.email;
}

//now access this as...

var Emp = new Employee({'name':'Mike', 'Id':'123', 'Phone':'23792747', 'email':'mike.adnersone@office.com'}); 
```

我们必须记住的重要一点是，如果我们必须在没有 JSON 方法的情况下构建具有 100 个元素的“Employee”类或模态，我们必须在创建类时解析所有内容。但是使用 JSON，我们只能在定义类的新对象时定义内联对象。

所以下面这一行是用JSON做事的方式（只是一种简单的定义方式）

```
 var Emp = new Employee({'name':'Mike', 'Id':'123', 'Phone':'23792747', 'email':'mike.adnersone@office.com'}); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-06-25T15:12:58.563

这很简单。JSON 代表 Java 脚本对象表示法。将其视为使用 XML 在软件组件之间传输数据的替代方法。

例如，我最近编写了一堆返回 JSON 的 Web 服务，然后一些 Javascript 开发人员编写了调用服务并使用以该格式返回的信息的代码。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-11-20T07:54:27.037

JSON（Javascript object notation）是一种用于数据交换/传输的轻量级数据格式。它与 JavaScript 一样在键值对中。对于 REST API，它广泛用于从服务器到客户端的数据传输。如今，许多社交媒体网站都在使用它。尽管在数据类型方面我认为它不像 XML 那样健壮。XML 具有非常丰富的数据类型和 XSD。JSON 在这方面有点欠缺。

对于相同数量的字符串数据，JSON 与 XML 相比会更轻，因为 XML 具有所有的开始和结束标签等......

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-11-10T03:46:26.853

**了解 JSON**

JSON 只是大多数 REST API 用来返回其数据的一种文本格式。另一种常见的格式是 XML，但 XML 比较冗长。

这是 JSON 的一个小例子：

```
// JSON object
{
  "name": "John",
  "age": 20
}

// JSON array
[
  {
    "name": "John",
    "age": 20
  },
  {
    "name": "Peter",
    "age": 22
  }
] 
```

请注意，该片段以大括号开头`{`，表示一个对象。JSON 也可以作为数组开始，它使用方括号`[`符号来表示数组的开始。JSON 需要正确格式化，因此所有开头`{`和`[`符号都需要有其结尾符号：`}`和`]`.

JSON 可以包含对象或数组。JSON 中的对象被包裹在大括号内`{ … }`，而数组被包裹在方括号内`[ … ]`。

JSON 按键值对数据进行结构化。**键始终是字符串**，但**值可以是任何东西**（字符串、数字、JSON 对象、JSON 数组……）。这将影响我们在接下来的步骤中解析 JSON 的方式。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-03-05T15:17:34.733

在 Java 环境中，可能想要使用 JSON 的一个原因是，它为 Java 的序列化框架提供了一个非常好的替代方案，该框架已被证明（历史上）存在一些相当严重的漏洞。

Joshua Bloch 在 Item 85 “Prefer Alternatives to Java Serialization”（Effective Java 3rd Edition）中深入讨论了这一点

Java 的序列化最初旨在将数据结构转换为易于传输或存储的格式。JSON 满足这个要求，没有上面提到的严重漏洞。

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2017-08-29T08:46:24.700

尝试以下代码来解析您的 php json 响应：read.php

```
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script type="text/javascript">  
$.ajax({
    url:'index.php',
    data:{},
    type:"POST",
    success:function(result) {
        jsondecoded = $.parseJSON(result);
        $.each(jsondecoded, function(index, value) {
            $("#servers").text($("#servers").text() + " " + value.servername);
            console.log(value.start);
            console.log(value.end);
            console.log(value.id);
        });
    },
    statusCode: {
    404: function() {
      alert( "page not found" );
    }
  }
});
</script> 
```

服务器.php

```
<?php 
echo '[{"start":"2017-08-29","end":"2017-09-01","id":"22"},{"start":"2017-09-03","end":"2017-09-06","id":"23"}]';
?> 
```

# algorithm - 我可以降低它的计算复杂度吗？

> ID：383728
> 
> 赞同：9
> 
> 时间：2008-12-20T20:51:36.473
> 
> 标签：algorithm, python-3.x, complexity-theory, time-complexity

好吧，我有这段代码大大减慢了程序的速度，因为它是线性复杂度，但被调用了很多次，使程序成为二次复杂度。如果可能的话，我想降低它的计算复杂度，否则我会尽可能地优化它。到目前为止，我已经减少到：

```
def table(n):
    a = 1
    while 2*a <= n:
      if (-a*a)%n == 1: return a

      a += 1 
```

有人看到我错过的任何东西吗？谢谢！

编辑：我忘了提：n 总是一个素数。

编辑 2：这是我的新改进程序（感谢所有贡献！）：

```
def table(n):
    if n == 2: return 1
    if n%4 != 1: return

    a1 = n-1
    for a in range(1, n//2+1):
        if (a*a)%n == a1: return a 
```

编辑 3：在真实环境中测试它*要*快得多！好吧，这个问题似乎已解决，但有很多有用的答案。我还应该说，除了上述优化之外，我还使用 Python 字典记住了该函数......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T20:55:28.197

暂时忽略算法（是的，我知道，坏主意）*，*只需`while`从`for`.

```
for a in range(1, n / 2 + 1) 
```

（希望这没有一个错误的错误。我很容易犯这些。）

我会尝试的另一件事是查看步长是否可以增加。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-20T22:18:13.020

看看[http://modular.fas.harvard.edu/ent/ent_py](http://modular.fas.harvard.edu/ent/ent_py)。如果您设置 a = -1 和 p = n，函数 sqrtmod 就可以完成这项工作。

你错过了一个小点，因为你改进算法的运行时间仍然是 n 的平方根。只要你只有小的素数 n（比如说小于 2^64），没关系，你可能应该更喜欢你的实现而不是更复杂的实现。

如果素数 n 变大，您可能需要切换到使用一点数论的算法。据我所知，您的问题只能使用时间 log​​(n)^3 中的概率算法来解决。如果我没记错的话，假设黎曼假设成立（大多数人都这样做），可以证明以下算法的运行时间（在 ruby​​ 中 - 对不起，我不知道 python）是 log(log(n))*日志（n）^3：

```
class Integer
  # calculate b to the power of e modulo self
  def power(b, e)
    raise 'power only defined for integer base' unless b.is_a? Integer
    raise 'power only defined for integer exponent' unless e.is_a? Integer
    raise 'power is implemented only for positive exponent' if e < 0
    return 1 if e.zero?
    x = power(b, e>>1)
    x *= x
    (e & 1).zero? ? x % self : (x*b) % self
  end
  # Fermat test (probabilistic prime number test)
  def prime?(b = 2)
    raise "base must be at least 2 in prime?" if b < 2
    raise "base must be an integer in prime?" unless b.is_a? Integer
    power(b, self >> 1) == 1
  end
  # find square root of -1 modulo prime
  def sqrt_of_minus_one
    return 1 if self == 2
    return false if (self & 3) != 1
    raise 'sqrt_of_minus_one works only for primes' unless prime?
    # now just try all numbers (each succeeds with probability 1/2)
    2.upto(self) do |b|
      e = self >> 1
      e >>= 1 while (e & 1).zero?
      x = power(b, e)
      next if [1, self-1].include? x
      loop do
        y = (x*x) % self
        return x if y == self-1
        raise 'sqrt_of_minus_one works only for primes' if y == 1
        x = y
      end
    end
  end
end

# find a prime
p = loop do
      x = rand(1<<512)
      next if (x & 3) != 1
      break x if x.prime?
    end

puts "%x" % p
puts "%x" % p.sqrt_of_minus_one 
```

缓慢的部分现在是找到素数（大约需要 log(n)^4 整数运算）；找到 -1 的平方根需要 512 位素数仍然不到一秒。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-20T21:58:22.267

考虑预先计算结果并将它们存储在文件中。现在很多平台都有巨大的磁盘容量。然后，获得结果将是一个 O(1) 操作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-20T21:53:59.903

（以亚当的回答为基础。）查看关于[二次互易](http://en.wikipedia.org/wiki/Law_of_quadratic_reciprocity)的维基百科页面：

> x^2 ≡ −1 (mod p) 当且仅当 p ≡ 1 (mod 4) 是可解的。

然后，您可以避免为那些与 1 模 4 不相等的奇数素数 n 精确地搜索根：

```
def table(n):
    if n == 2: return 1
    if n%4 != 1: return None   # or raise exception
    ... 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-20T21:03:53.453

看起来您正试图找到 -1 modulo 的平方根`n`。不幸的是，这不是一个简单的问题，具体取决于`n`函数中输入的值。取决于`n`，甚至可能没有解决方案。有关此问题的更多信息，请参阅[Wikipedia](http://en.wikipedia.org/wiki/Quadratic_residue#Complexity_of_finding_square_roots)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-20T22:10:14.253

**编辑 2：**令人惊讶的是，减少平方的强度会大大减少时间，至少在我的 Python2.5 安装中是这样。（我很惊讶，因为我认为解释器开销占用了大部分时间，这并没有减少内部循环中的操作计数。）将 table(1234577) 的时间从 0.572 秒减少到 0.146 秒。

```
 def table(n):
     n1 = n - 1
     square = 0
     for delta in xrange(1, n, 2):
         square += delta
         if n <= square: square -= n
         if square == n1: return delta // 2 + 1 
```

strager 发布[了相同的想法](https://stackoverflow.com/questions/383728/can-i-reduce-the-computational-complexity-of-this#383983)，但我认为编码不那么紧密。再一次，[水罐的答案](https://stackoverflow.com/questions/383728/can-i-reduce-the-computational-complexity-of-this#383815)是最好的。

**原始答案：** Konrad Rudolph 之上的另一个微不足道的编码调整：

```
def table(n):
    n1 = n - 1
    for a in xrange(1, n // 2 + 1):
          if (a*a) % n == n1: return a 
```

在我的笔记本电脑上显着加快了速度。（大约 25% 用于表 (1234577)。）

**编辑：**我没有注意到 python3.0 标签；但主要的变化是将部分计算提升到循环之外，而不是使用`xrange`. （学术，因为有更好的算法。）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-21T01:36:52.620

基于 OP 的第二次编辑：

```
def table(n):
    if n == 2: return 1
    if n%4 != 1: return

    mod = 0
    a1 = n - 1
    for a in xrange(1, a1, 2):
        mod += a

        while mod >= n: mod -= n
        if mod == a1: return a//2 + 1 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-20T21:28:10.797

你可以缓存结果吗？

当您计算较大的 n 时，您几乎可以免费获得较低 n 的结果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-20T22:38:48.627

您正在做的一件事是一遍又一遍地重复计算 -a*a。

一次创建一个值表，然后在主循环中查找。

此外，虽然这可能不适用于您，因为您的函数名称是表，但是如果您调用一个需要时间计算的函数，您应该将结果缓存在表中，如果您再次调用它，只需进行表查找价值。这可以节省您在第一次运行时计算所有值的时间，但您不会浪费时间多次重复计算。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-30T08:06:34.123

我通过并修复了哈佛版本以使其与 python 3 一起使用。 [http://modular.fas.harvard.edu/ent/ent_py](http://modular.fas.harvard.edu/ent/ent_py)

我做了一些细微的改动，使结果与 OP 的功能完全相同。有两个可能的答案，我强迫它返回较小的答案。

```
import timeit

def table(n):

    if n == 2: return 1
    if n%4 != 1: return

    a1=n-1

    def inversemod(a, p):
        x, y = xgcd(a, p)
        return x%p

    def xgcd(a, b):
        x_sign = 1
        if a < 0: a = -a; x_sign = -1
        x = 1; y = 0; r = 0; s = 1
        while b != 0:
            (c, q) = (a%b, a//b)
            (a, b, r, s, x, y) = (b, c, x-q*r, y-q*s, r, s)
        return (x*x_sign, y)

    def mul(x, y):      
        return ((x[0]*y[0]+a1*y[1]*x[1])%n,(x[0]*y[1]+x[1]*y[0])%n)

    def pow(x, nn):      
        ans = (1,0)
        xpow = x
        while nn != 0:
           if nn%2 != 0:
               ans = mul(ans, xpow)
           xpow = mul(xpow, xpow)
           nn >>= 1
        return ans

    for z in range(2,n) :
        u, v = pow((1,z), a1//2)
        if v != 0:
            vinv = inversemod(v, n)
            if (vinv*vinv)%n == a1:
                vinv %= n
                if vinv <= n//2:
                    return vinv
                else:
                    return n-vinv

tt=0
pri = [ 5,13,17,29,37,41,53,61,73,89,97,1234577,5915587277,3267000013,3628273133,2860486313,5463458053,3367900313 ]
for x in pri:
    t=timeit.Timer('q=table('+str(x)+')','from __main__ import table')
    tt +=t.timeit(number=100)
    print("table(",x,")=",table(x))

print('total time=',tt/100) 
```

此版本运行上述测试用例大约需要 3ms。

使用素数进行比较 1234577
OP Edit2 745ms
接受的答案 522ms
上述函数 0.2ms

# javascript - 在网页中压缩 XML

> ID：383729
> 
> 赞同：0
> 
> 时间：2008-12-20T20:52:24.333
> 
> 标签：javascript, compression

我在我的应用程序中将大量 XML 从服务器传输到客户端（每次 250K-500K）。

如何在服务器上压缩它，并在客户端使用标准 JavaScript 解压它？是否可以？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T21:54:18.500

首先，责骂和可能的解决方法。其次，一个可能的疯狂解决方案。

## 责骂

如果您在客户端和服务器之间来回发送 250k - 500k，那么您做错了。调查

1.  只请求和发回您需要的信息

2.  如果 XML 中的信息不经常更改，请将您的 Web 服务器配置为对这些请求进行积极的 http 缓存。另外，考虑在初始页面请求中发送“不经常更改信息”而不是从服务器获取它

3.  考虑发送 JSON 而不是 XML。JSON 不像 XML 那样冗长，而且通常占用的空间更少。如果您的客户端代码需要一个 XML 对象，请从您刚刚下载的 JSON 中重建它。

4.  如果您使用的是 apache，mod_deflate 将为可以接受它的客户端压缩您的数据。上次我研究 IIS 上的 gzip 编码时，它确实是在磁盘上压缩和解压缩，这很快成为高负载情况下的瓶颈 (YMMV)

## 疯狂的解决方案

如果您一心想尝试 compress-in-javascript 路线，LZ77 压缩算法已被移植到大多数语言，[包括 javascript](http://www.geocities.com/diogok_br/lz77/index.html)。

为您的服务器平台找到类似的代码，压缩 XML，然后将其提供给上面链接中的代码。为了避免编码问题，我会在发送压缩数据时尝试将压缩数据本身包装在 XML 或 JSON 中。

Javascript 压缩性能会很慢。as.molasses，这就是我不鼓励这条路线的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T20:56:13.217

这是 HTTP 类型的传输吗？

最简单的方法是查看 Web 服务器端的压缩。

XML 通常压缩得很好。

# tcp - 开发无服务器局域网聊天程序帮助！

> ID：383731
> 
> 赞同：6
> 
> 时间：2008-12-20T20:54:44.203
> 
> 标签：tcp, udp

我想开发简单的无服务器局域网聊天程序只是为了好玩。我怎样才能做到这一点 ？我应该使用什么类型的架构？

去年我从事 TCP、UDP 客户端/服务器应用程序项目。它很简单（服务器侦听某些端口/套接字，客户端连接到服务器的端口等。）但我不知道如何开发“无服务器”局域网聊天程序。我怎样才能做到这一点？UDP，TCP，组播，广播？还是程序的行为应该像服务器和客户端一样？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-20T21:05:52.667

最简单的方法是使用 UDP 并在整个网络上简单地广播您的消息。更高级的版本是只使用广播来发现网络中的其他节点。

*   每个节点都维护着一个已知对等点的列表。
*   消息通过 TCP 发送到所有已知的对等点。
*   当一个节点启动时，它会发出一个 UDP 广播来发现其他节点。
*   当一个节点接收到一个发现广播时，它会将“自己”发送到广播源，以使其自知。接收节点将广播者添加到它自己的已知对等点列表中。
*   当一个节点从网络中退出时，它会发送另一个广播，以通知其余节点它们应该从列表中删除被丢弃的客户端。

您还必须考虑在不通知网络其余部分的情况下处理节点的退出问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T21:34:21.660

[传播工具包](http://www.spread.org/)对于您想要的东西可能有点矫枉过正，但是一个有趣的起点。

从简介：

* * *

Spread 是一个开源工具包，它提供了一种高性能的消息传递服务，该服务对跨局域网和广域网的故障具有弹性。Spread 用作分布式应用程序的统一消息总线，并提供高度调整的应用程序级多播、组通信和点对点支持。传播服务的范围从可靠的消息传递到具有传递保证的完全有序的消息。

Spread 可用于许多分布式应用程序，这些应用程序需要在各种成员子集之间进行高可靠性、高性能和鲁棒的通信。该工具包旨在封装异步网络的挑战性方面，并支持构建可靠且可扩展的分布式应用程序。

Spread 由与用户应用程序链接的库、在作为处理器组的一部分的每台计算机上运行的二进制守护程序以及各种实用程序和演示程序组成。

Spread提供的一些服务和好处：

*   可靠且可扩展的消息传递和群组通信。
*   一个非常强大但简单的 API 简化了分布式架构的构建。
*   易于使用、部署和维护。
*   从一个局域网到复杂的广域网的高度可扩展性。
*   支持具有不同成员集的数千个组。
*   在出现机器故障、进程崩溃和恢复以及网络分区和合并的情况下启用消息可靠性。
*   为消息提供一系列可靠性、排序和稳定性保证。
*   强调稳健性和高性能。
*   完全分布式算法，没有中心故障点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T17:07:55.333

Apples iChat 就是您所设想的产品的一个示例。它使用 Bonjour（苹果的零配置网络协议）来识别 LAN 上的对等点。然后，您可以与他们聊天或音频/视频聊天。

我不完全确定 Bonjour 在内部是如何工作的，但我知道它使用多播。客户端在 LAN 上“注册”服务，Bonjour 协议允许每个主机为给定服务提取主机目录（所有这些都无需中央管理）。

# ruby-on-rails - Rails 中城市/地区/国家的 URL

> ID：383734
> 
> 赞同：2
> 
> 时间：2008-12-20T20:58:35.990
> 
> 标签：ruby-on-rails, url

对于在 Rails 中显示城市、地区和国家/地区的 URL 和处理视图，您有什么建议？

IE：

/us/ca/旧金山

/countries/us/regions/ca/cities/San-Fransisco

应该能够：列出所有国家，列出国家内的所有地区，列出一个地区和国家内的所有城市。

您将在哪里放置代码以显示一个国家/地区的所有区域？：

/我们/地区/

/我们

代码应该在区域（动作秀）还是国家（动作索引）控制器中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T22:46:59.937

同意阿恩。我认为第一个变体没有任何问题。

至于第二个问题，你最好在 RegionsController 中获取区域列表。

说你想

```
GET /us/regions 
```

那么你应该把它路由到

```
class RegionsController < ApplicationController
  # GET /:country_code/regions
  # GET /regions
  def index
    @countries = 
      if params[:country_code]
        Country.find_by_code(params[:country_code]).regions
      else
        Region.all # get all regions if country_code is not set
      end
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T22:28:49.177

我更喜欢简单的 /us/ca/San-Fransisco。较短的路径将导致列表：

*   / 列出国家
*   /us 列出我们的州
*   /us/ca 列出加利福尼亚城市

简单、简短、干净 - 并且会被 google 尊重 ;-)

# .net - 缓慢的方法调用

> ID：383735
> 
> 赞同：0
> 
> 时间：2008-12-20T21:03:14.513
> 
> 标签：.net, performance

方法调用真的这么慢还是我的电脑有问题？

```
static void Main(string[] args) {
    Stopwatch sw = new Stopwatch(); sw.Start(); 
    for (int i = 0; i < 10000000; i++) {
        double z = Math.Pow(i,2);
    }
    Console.WriteLine(sw.ElapsedMilliseconds);
    sw = Stopwatch.StartNew();
    for (int i = 0; i < 10000000; i++) {
        Noop();
    }
    Console.WriteLine(sw.ElapsedMilliseconds);
}

static void Noop() { } 
```

在我的系统中，第一个循环需要 1600 - 1700 毫秒，而第二个循环需要 3100 - 3200 毫秒（Celeron D 2.53 Ghz 512 MB RAM Windows XP SP3 .NET 3.5）。这是一个命令行项目。我用 VB.Net 得到了类似的结果。

编辑：我想我找到了答案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T21:06:20.203

您可能是：

*   内置调试模式
*   在调试器中运行。

我的结果：

```
c:\Users\Jon\Test>csc /o+ /debug- Test.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

c:\Users\Jon\Test>test
1723
13 
```

这更像你所期望的吗？即使`/debug+ /o-`从命令行运行时，我得到的结果也比原来的要好得多，这表明您*正在*调试器中运行。性能测试不是一个好主意:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-20T21:25:45.467

> 1723 13 这是否更符合您的预期？

是的，这就是我所期望的。我没有在调试模式下运行（调试模式给我 1900/3200）。在 IDE 打开或关闭的情况下运行它会得到相同的结果。使用 csc 或使用 ngen install 不会改变结果。我想我应该重新安装 .net 框架。

编辑：

感谢您的回答。
重新安装框架并没有解决问题。在使用虚拟机进行测试后，我得到了有意义的结果。我终于找到了问题所在：
前段时间我安装了一个名为 ProfileSharp 的分析器。我不知道探查器在关闭时未经我的授权在做什么（或为什么），但自从我卸载它的那一刻起，第二个循环的时间为 6 毫秒。我仍然需要重新安装它并做一些测试，看看它是否是罪魁祸首。

编辑2：

探查器具有默认启用的“自动附加并开始分析新进程”选项。当分析器关闭时，它应该停止分析并且确实在我对虚拟机的测试中进行，但由于某种原因，一旦它没有并开始在后台分析每个 .net 进程（系统、ASP 和 Microsoft 命名空间被排除在外）默认，因此它不会对 Math.Pow 产生太大影响）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T21:06:50.153

不管是什么原因，这与方法调用无关。一方面，这样的方法调用是有效的。另一方面，您的第一个示例*还*调用了一个方法。第三，第二个方法调用*将*被内联，因为那里什么都没有发生，所以第二个循环实际上是完全空的。编译器甚至可以优化掉整个循环。

最后，无论是在调试还是在发布模式下，我都无法重现您的结果。

# python - 104, 'Connection reset by peer' 套接字错误，或关闭套接字何时导致 RST 而不是 FIN？

> ID：383738
> 
> 赞同：39
> 
> 时间：2008-12-20T21:04:42.890
> 
> 标签：python, sockets, wsgi, httplib2, werkzeug

我们正在并行开发 Python Web 服务和客户端网站。当我们从客户端向服务发出 HTTP 请求时，一个调用会在 socket.py 中持续引发一个 socket.error，如下所示：

```
（104，'对等方重置连接'）
```

当我用wireshark收听时，“好”和“坏”的反应看起来非常相似：

*   由于 OAuth 标头的大小，请求被分成两个数据包。该服务使用 ACK 响应两者
*   服务发送响应，每个标头一个数据包（HTTP/1.0 200 OK，然后是 Date 标头等）。客户端用 ACK 响应每个。
*   （好请求）服务器发送一个FIN、ACK。客户端以 FIN、ACK 响应。服务器响应 ACK。
*   （错误请求）服务器发送 RST、ACK，客户端不发送 TCP 响应，客户端引发 socket.error。

Web 服务和客户端都在运行 glibc-2.6.1 的 Gentoo Linux x86-64 机器上运行。我们在同一个 virtual_env 中使用 Python 2.5.2。

客户端是一个 Django 1.0.2 应用程序，它调用 httplib2 0.4.0 来发出请求。我们使用 OAuth 签名算法对请求进行签名，OAuth 令牌始终设置为空字符串。

该服务正在运行 Werkzeug 0.3.1，它使用 Python 的 wsgiref.simple_server。我通过 wsgiref.validator 运行 WSGI 应用程序，没有任何问题。

看起来这应该很容易调试，但是当我在服务端跟踪一个好的请求时，它看起来就像是错误的请求，在 socket._socketobject.close() 函数中，将委​​托方法变成了虚拟方法。当 send 或 sendto（不记得是哪个）方法被关闭时，发送 FIN 或 RST，客户端开始处理。

“对等连接重置”似乎将责任归咎于服务，但我也不信任 httplib2。客户有错吗？

** 进一步调试 - 看起来像 Linux 上的服务器 **

我有一台 MacBook，所以我尝试在一台上运行该服务，在另一台上运行客户端网站。Linux 客户端调用 OS X 服务器时没有错误 (FIN ACK)。OS X 客户端调用带有错误的 Linux 服务（RST ACK 和 (54, 'Connection reset by peer')）。因此，它看起来像是在 Linux 上运行的服务。是 x86_64 吗？一个糟糕的 glibc？wsgiref? 还在找...

** 进一步测试 - wsgiref 看起来很不稳定 **

我们已经使用 Apache 和 mod_wsgi 投入生产，并且连接重置已经消失。请参阅下面的答案，但我的建议是记录连接重置并重试。这将使您的服务器在开发模式下运行良好，并在生产中稳定运行。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-20T22:18:15.750

我遇到过这个问题。请参阅[Python“对等连接重置”问题](http://www.itmaybeahack.com/homepage/iblog/architecture/C551260341/E20081031204203/index.html)。

您（很可能）遇到了基于 Python Global Interpreter Lock 的小时间问题。

您可以（有时）通过`time.sleep(0.01)`战略性放置来纠正此问题。

“在哪里？” 你问。打败我。这个想法是在客户端请求中和围绕客户端请求提供一些更好的线程并发性。尝试在发出请求*之前*将其放置，以便重置 GIL 并且 Python 解释器可以清除任何挂起的线程。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-27T00:37:29.857

不要将 wsgiref 用于生产。使用 Apache 和 mod_wsgi 或其他东西。

我们继续看到这些连接重置，有时是频繁的，使用 wsgiref（werkzeug 测试服务器使用的后端，可能还有 Django 测试服务器等其他服务器）。我们的解决方案是记录错误，循环重试调用，并在十次失败后放弃。httplib2 尝试了两次，但我们需要更多。它们似乎也成束出现——增加 1 秒的睡眠时间可能会解决问题。

通过 Apache 和 mod_wsgi 运行时，我们从未见过连接重置。我不知道他们有什么不同，（也许他们只是掩盖了他们），但他们没有出现。

当我们向本地开发社区寻求帮助时，有人确认他们看到很多使用 wsgiref 的连接重置在生产服务器上消失了。那里有一个错误，但很难找到它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T12:44:18.997

通常情况下，如果您进行不逗留的关闭（即，如果尚未发送和确认数据可以被堆栈丢弃的数据），您将获得 RST；如果您允许关闭，您将获得正常的 FIN逗留（即关闭等待传输中的数据被确认）。

也许您需要做的就是将您的套接字设置为 linger，以便您消除在套接字上完成的非延迟关闭和 ACK 到达之间的竞争条件？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-10-15T23:52:03.133

我遇到了同样的问题，但是使用发布到 nginx+uwsgi 后端的 python-requests 客户端上传一个非常大的文件。

最终的原因是后端对上传的最大文件大小的上限低于客户端尝试发送的上限。

该错误从未出现在我们的 uwsgi 日志中，因为此限制实际上是由 nginx 强加的。

提高 nginx 中的限制消除了错误。

# javascript - 切换单击的任何元素

> ID：383739
> 
> 赞同：0
> 
> 时间：2008-12-20T21:04:57.350
> 
> 标签：javascript, jquery, toggle

我正在使用带有 jQ​​uery 的 toggle()，我的页面上有一个侧边栏，每个标题都是

```
<h2 class="sidebar-header"> 
```

我的代码的一部分将如下所示：

```
 <div class="sidebar-section">   
        <h2 class="sidebar-header">SUBSCRIBE</h2>
        <p class="sidebar">Make sure you subscribe to stay in touch with the latest articles and tutorials. Click on one of the images below:</p>
        <div class="rss-icons">
            <a href="http://fusion.google.com/add?feedurl=http://feeds.feedburner.com/ryancoughlin"><img src="http://gmodules.com/ig/images/plus_google.gif" width="62" height="17" alt="Add to Google Reader or Homepage" class="feed-image"/></a> 
            <a href="http://add.my.yahoo.com/rss?url=http://feeds.feedburner.com/ryancoughlin" title="Web/Graphic Design/Development by Ryan Coughlin"><img src="http://us.i1.yimg.com/us.yimg.com/i/us/my/addtomyyahoo3.gif" alt="Add feed to My Yahoo" width="62" height="17" class="feed-image" /></a>
            <a href="http://www.newsgator.com/ngs/subscriber/subext.aspx?url=http://feeds.feedburner.com/ryancoughlin" title="Web/Graphic Design/Development by Ryan Coughlin"><img src="http://www.newsgator.com/images/ngsub1.gif" alt="Subscribe in NewsGator Online" class="feed-image" height="17" /></a>
        </div>
        <hr />
        <p class="sidebar feed">Don't have those? Grab the <a href="http://feeds.feedburner.com/ryancoughlin" target="_blank" title="Subscribe to this feed">RSS</a> url.</p>
        <p class="sidebar delicious">Make sure you add me to <a href="http://del.icio.us/post?url=http://www.ryancoughlin.com&amp;title=Ryan Coughlin - Web/Graphic Design and Development" target="_blank" title="Add to delicious!">delicious!</a> </p>
    </div> 
```

它们都包裹在那些 DIV 元素中。如果您单击标题，我正在尝试这样做，它会缩小内容。我知道切换可以做到这一点，但是如果我为每个“侧边栏标题”制作它，您将单击页面上的任何一个元素，它会将它们全部隐藏，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T21:16:26.127

尝试这样的事情：

假设您有以下代码：

```
<div class="topdiv">
    <h2 class="header">Header 1</h2>
    <div class="somecontent">
        This is the content
    </div>
</div>

<div class="topdiv">
    <h2 class="header">Header 2</h2>
    <div class="somecontent">
        This is the content
    </div>
</div> 
```

现在，假设当您想要单击一个标题时，该标题的内容会显示/隐藏：

```
$(".header").click(function () {
    $(this).parent(".topdiv:first").find(".somecontent").toggle();
}); 
```

这样，只有特定标题的内容将被切换，而不是其余的。

现在您可以分析我为您编写的代码，并将其应用到您自己的上下文中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-20T21:16:30.277

试试这个： [nextAll](http://docs.jquery.com/Traversing/nextAll)

```
 $(".sidebar-header").click(function() {
        $(this).nextAll().toggle();
    }); 
```

# interpreter - 无需安装即可从 USB 记忆棒编程语言

> ID：383757
> 
> 赞同：10
> 
> 时间：2008-12-20T21:26:58.133
> 
> 标签：interpreter, usb-drive

我正在寻找具有基本数学支持和文件 IO 的语言的编译器或解释器，可以直接从 Linux 或 Windows 中的记忆棒执行。内置基本数据结构和排序/搜索的功能将是一个加号。

（我读过可移动的python，但它只支持windows）

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-20T21:32:41.413

不确定其他语言有什么问题，但我很确定[Lua](http://lua.org)在这样的环境下可以正常工作。

它非常适合您的要求：基本 I/O、数学函数、出色的数据结构（全部基于数字和关联数组，具有任何类型的键/值，允许最复杂的操作）。
奖励：当你开始挖掘时，学习非常简单（至少对于基础而言）、可读性强且功能强大。它开始拥有许多有用的库、套接字、正则表达式和解析器、GUI 等。

它只是一个二进制文件，根本不需要安装，没有注册表访问，没有文件访问（除了读取二进制文件和脚本！）如果没有请求，完全透明：它经常用于嵌入式系统，通常内存受限，在 Roms ， ETC。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T22:09:29.950

Java JDK 很容易装在一根棍子上，不需要安装；您可以先将其安装到 PC，然后将安装目录复制到记忆棒。我想你可以对 Linux JDK 做同样的事情。

还有很多不需要安装的好文本编辑器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T00:39:28.900

有一个名为[Movable Python](http://www.voidspace.org.uk/python/movpy/)的 Python 发行版就是为了做到这一点而设计的。它可能会做你想做的事。此外，[MinGW/MSYS](http://www.mingw.org/)将在 Windows 上运行，除了将文件放在目录树中之外，没有注册表项或其他安装 - 您需要做的就是在路径中设置相关目录，这可以在批处理文件中完成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-20T21:39:27.123

不确定它是否仍然适用于当前版本，但我有一个古老的`perl.exe`（版本 5.001，从 1994 年或 1995 年开始），作为免安装的单个可执行文件仍然可以正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T23:30:54.933

如果你能容忍[TCL](http://tcl.tk)，那就很难打败一个[tclkit](http://www.equi4.com/tclkit/index.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T08:04:16.847

[TCC](http://bellard.org/tcc/)（Tiny C Compiler）是一个非常小的包中的 C 的完整实现。你甚至可以用 C 编写 shell 脚本：

```
#!/usr/local/bin/tcc -run
#include <stdio.h>

int main() 
{
    printf("Hello World\n");
    return 0;
} 
```

TCC 可用于任何类 Unix 平台，也可用于 Windows。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T18:54:05.047

我已经用 Ruby 做到了这一点。工作得很好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-12T11:11:50.310

我参加这个派对已经很晚了，但我想我还是会参与进来。

我目前有一个 Windows 可用的 USB 记忆棒，上面安装了以下内容（适用于 Windows）：

**语言**

*   爪哇
*   二郎
*   幻影
*   时髦的
*   哈斯克尔
*   jacl（基于 JVM 的 Tcl）
*   JavaFX
*   JRuby（基于 JVM 的 Ruby）
*   Jython（基于 JVM 的 Python）
*   NASM
*   好的
*   坚果
*   雷克斯
*   斯卡拉
*   SISC（基于 JVM 的方案）
*   睡觉
*   Tcl
*   序言
*   gawk（通过 GnuWin32 和 MinGW/MSys）
*   jawk（基于 JVM 的 AWK）
*   ANTLR
*   Clojure
*   JBasic（基于 JVM 的 BASIC）
*   Tuprolog（基于 JVM 的 Prolog）
*   Rhino（基于 JVM 的 Javascript）
*   YASM
*   卢阿
*   Kahlua（基于 JVM 的 Lua）
*   C（通过 GnuWin32 和 MinGW/MSys）
*   C++（通过 GnuWin32 和 MinGW/MSys）
*   Fortran77（通过 GnuWin32 和 MinGW/MSys）
*   Ada（通过 GnuWin32 和 MinGW/MSys）

**编程工具**

*   jEdit（基于JVM的程序员编辑器）
*   Ant（基于 JVM 的构建工具）
*   Maven 2（基于 JVM 的构建工具）
*   vi (通过 GnuWin32 和 MinGW/MSys)
*   维姆
*   制作
*   gmake（通过 GnuWin32 和 MinGW/MSys）
*   莱宁根
*   颠覆
*   化石
*   ANTLRworks
*   ctags/etags

**极客玩具**

*   所有 SIMH 仿真器，如果可用，可以联网
*   几个操作系统，实用程序等相同

以及几十个关键库，以及 Geronimo 应用程序服务器。

是的，这是一个 USB 记忆棒，我可能在列出此列表时在这里或那里遗漏了一个项目。这些天你可以从 U 盘上运行的东西真是太神奇了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T09:07:18.747

[http://smallbasic.sourceforge.net/](http://smallbasic.sourceforge.net/)

可在任何地方（甚至是手机）运行并拥有您需要的一切。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-22T17:15:40.597

您可以使用 DevCpp，它带有用于 C/C++ 的 Mingw 3.x 或 CodeLite (Mingw 4.x)。对于 Pascal，您可以使用 DevPas，对于 Python Web 开发，请尝试 InstantDjango 或更好的 Web2py（确实非常好！），对于 Ruby，您可以使用 InstanRails，对于 Perl，您可以使用 StrawberryPerl 获得完整的环境（甚至是 C 编译器！）。您可以在 USB 驱动器上安装 cygwin。还有很多选择。对可移植/跨平台和小语言之类的 LISP 感兴趣？尝试 newlisp（它是一个宝石！）。您也可以在 Portable VirtualBox/VMplayer 或 QEmu 下的便携式 VM 上运行几乎任何东西（基于 Linux 或 Windows），但需要支付性能税；）。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-20T22:04:54.920

为什么不是 C++？假设许可允许，您可以静态链接任何外部库，并且您不会有任何外部依赖项。

# python - Django objects.filter，这有多“昂贵”？

> ID：383760
> 
> 赞同：1
> 
> 时间：2008-12-20T21:30:12.167
> 
> 标签：python, sql, django, search, optimization

我正在尝试在 Django 中创建搜索视图。这是一个带有自由文本输入+一些选项的搜索表单，以便您可以过滤年份等。这是到目前为止我在视图中的一些代码，即进行过滤的部分。我想了解一下这在数据库服务器上会有多贵。

`soknad_list = Soknad.objects.all()`

 ````
if var1:
    soknad_list = soknad_list.filter(pub_date__year=var1)

if var2:
    soknad_list = soknad_list.filter(muncipality__name__exact=var2)

if var3:
    soknad_list = soknad_list.filter(genre__name__exact=var3)

# TEXT SEARCH
stop_word_list = re.compile(STOP_WORDS, re.IGNORECASE)
search_term = '%s' % request.GET['q']
cleaned_search_term = stop_word_list.sub('', search_term)
cleaned_search_term = cleaned_search_term.strip()
if len(cleaned_search_term) != 0:
    soknad_list = soknad_list.filter(Q(dream__icontains=cleaned_search_term) | Q(tags__icontains=cleaned_search_term) | Q(name__icontains=cleaned_search_term) | Q(school__name__icontains=cleaned_search_term)) 
````  `所以我要做的是，首先列出所有对象，然后检查哪些变量存在（我在前面使用 GET 获取这些变量），然后过滤结果（如果存在）。但这似乎不太优雅，它可能会进行很多查询来获得结果，那么有没有更好的方法呢？

它完全符合我的要求，但我想有更好/更智能的方法来做到这一点。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T21:43:51.703

filter 本身不执行查询，直到您从查询中显式获取项目（例如 get），才会执行查询，并且 list( query ) 也执行它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T22:02:29.340

您可以使用以下命令查看将生成的查询：

```
soknad_list.query.as_sql()[0] 
```

然后，您可以将其放入数据库 shell 以查看查询需要多长时间，或者使用 EXPLAIN（如果您的数据库后端支持它）查看它的成本。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-20T22:35:20.477

正如 Aaron 所提到的，您应该掌握将要针对数据库运行的查询文本，并使用 EXPLAIN（或其他某种方法）来查看查询执行计划。一旦你掌握了查询的执行计划，你就可以看到数据库本身发生了什么。有很多操作看起来非常昂贵，通过程序代码运行对于任何数据库来说都是非常微不足道的，特别是如果您提供数据库可以用来加速查询的索引。

如果我正确阅读了您的问题，您将检索 Soknad 表中所有行的结果集。一旦你得到这些结果，你就可以使用 filter() 方法来修剪你的结果以满足你的标准。通过查看 Django 文档，看起来这将执行内存过滤器而不是重新查询数据库（当然，这实际上取决于您使用的数据访问层，而不是 Django 本身）。

最佳解决方案是使用全文搜索引擎（Lucene、ferret 等）为您处理此问题。如果这不可用或不实用，则下一个最佳选择是在向数据库发出查询之前构造查询谓词（WHERE 子句）并让数据库执行过滤。

**然而，**与所有涉及数据库的事情一样，真正的答案是“视情况而定”。最好的建议是使用接近生产的数据尝试几种不同的方法，并在确定问题的最终解决方案之前至少 3 次迭代对它们进行基准测试。在内存中过滤而不是在数据库中过滤可能同样快，甚至更快。

# c# - 从 SQL Express 服务器 C# 获取数据集

> ID：383765
> 
> 赞同：0
> 
> 时间：2008-12-20T21:35:00.363
> 
> 标签：c#, sql-server, database, dataset

如何使用 C# 从 SQL Express 服务器获取包含所有数据的 DataSet？

谢谢

编辑：为了澄清，我确实想要每个表中的所有数据。这样做的原因是它是一个相对较小的数据库。以前，我一直在使用 DataSet 的功能将所有三个表存储在一个 XML 文件中。但是，我想将其迁移到数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T21:40:52.800

我认为您需要稍微缩小问题范围...*所有*数据？你的意思是，每个数据库中每个表中的所有数据？好吧，唯一的答案是，*很多代码*。

要连接到 SQL Server Express 数据库引擎并与之对话，请使用 System.Data.SqlClient 命名空间中的类，即：

*   [SqlConnection](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.aspx)：连接到数据库
*   [SqlCommand](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.aspx) : 与数据库对话
*   [SqlDataReader](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.aspx)：迭代从数据库中检索到的数据

您可以通过单击上面的链接查看所有这些类的 MSDN 页面。

以下是一些包含更多信息的概述链接：

*   [CodeProject：通过 C# 访问 SQL Server 的初学者指南](http://www.codeproject.com/KB/database/sql_in_csharp.aspx)
*   [DevHood：使用 ADO.NET 在 C# 中访问 SQL Server 数据](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=454)

请注意，总的来说，您使用 SQL Server Express 数据库引擎的方式与完整的 SQL Server 产品相同，不同之处在于您使用它获得的工具，以及 express 引擎的一些限制。除此之外，您可以只使用用于正常 SQL Server 数据库引擎安装的类和语言。

如果这篇文章没有回答你的问题，请详细说明，你有更高的机会得到你想要的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T22:00:08.033

您可以使用 GetSchema 方法获取数据库中的所有表，然后使用数据适配器填充数据集。像这样的东西（我不知道它是否编译，我只是粘贴一些代码并稍微更改一下）：

```
DbProviderFactory factory = DbProviderFactories.GetFactory("System.Data.SqlClient");

DataTable tables = null;
DataSet database = new DataSet();

using (DbConnection connection = factory.CreateConnection())
{

    connection.ConnectionString = "Data Source=(local);Initial Catalog=Northwind;Integrated Security=True";

    string[] restrictions = new string[4];

    // Catalog
    restrictions[0] = "Northwind";

    // Owner
    restrictions[1] = "dbo";

    // Table - We want all, so null
    restrictions[2] = null;

    // Table Type - Only tables and not views
    restrictions[3] = "BASE TABLE";

    connection.Open();

    // Here is my list of tables
    tables = connection.GetSchema("Tables", restrictions);

    // fill the dataset with the table data
    foreach (DataRow table in tables.Rows)
    {

        string tableName = table["TABLE_NAME"].ToString();

        DbDataAdapter adapter = factory.CreateDataAdapter();
        DbCommand command = factory.CreateCommand();
        command.Connection = connection;
        command.CommandType = CommandType.Text;
        command.CommandText = "select * from [" + tableName + "]";
        adapter.SelectCommand = command;
        adapter.Fill(database, tableName);

    }

} 
```

**编辑：**

现在我对其进行了一些重构，现在它可以正常工作了。DbConnection 和 DbProviderFactories 用于数据库引擎抽象，我建议使用它，这样您就可以更改数据库引擎，更改此行和连接字符串：

```
DbProviderFactory factory = DbProviderFactories.GetFactory("System.Data.OracleClient"); 
```

GetSchema 方法会将数据库中的所有表检索到 DataTable，然后我们使用 DataAdapter 将每个表中的所有数据获取到 DataSet。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T21:42:20.100

这可以通过使用[dataAdapter](http://msdn.microsoft.com/en-us/library/bh8kx08z.aspx)类来完成。

# c# - VMware VIX API FindItems() 方法在查询已注册的虚拟机时永远不会返回

> ID：383768
> 
> 赞同：1
> 
> 时间：2008-12-20T21:39:05.473
> 
> 标签：c#, com, interop, vmware, vix

我在 Windows Vista x64 上使用 VMware Workstation 6.5。我正在尝试编写一些使用 VMware Vix v1.6.1 COM API 来获取已注册虚拟机列表的 C# 代码。

我正在使用的代码如下：

```
using System;
using VixCOM;

namespace ConsoleApplication48
{
    internal class Program
    {
        private static void Main()
        {
            var lib = new VixLibClass();
            object results = null;

            var job = lib.Connect(Constants.VIX_API_VERSION, Constants.VIX_SERVICEPROVIDER_VMWARE_WORKSTATION, null, 0,
null, null, 0, null, null);

            var err = job.Wait(new[] {Constants.VIX_PROPERTY_JOB_RESULT_HANDLE}, ref results);

        if (lib.ErrorIndicatesFailure(err))
            Console.WriteLine("Error: " + err);

        var host = (IHost)((object[])results)[0];

        job = host.FindItems(Constants.VIX_FIND_REGISTERED_VMS, null, -1, new DiscoveryCallback(lib));
        job.WaitWithoutResults();

        host.Disconnect();
    }
}

internal class DiscoveryCallback : ICallback
{
    protected VixLibClass lib;

    public DiscoveryCallback(VixLibClass lib)
    {
        this.lib = lib;
    }

    #region ICallback Members

    public void OnVixEvent(IJob job, int eventType, IVixHandle moreEventInfo)
    {
        // this method is never called
    }

    #endregion
    }
} 
```

我知道 COM dll 是 32 位的，所以我确保测试应用程序编译为 32 位。我还确保所有 VMware 服务都在运行。

没有抛出异常，没有返回错误（据我所知）并且没有事件写入事件日志。

奇怪的是，当我尝试使用常量 VIX_FIND_RUNNING_VMS 获取正在运行的 VM 列表时，上面的代码有效。

关于可能导致这种情况的任何想法？

谢谢，

阿尼

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T17:18:27.557

快速更新情况。

我仔细查看了 FindItems() 方法的[官方文档](http://www.vmware.com/support/developer/vix-api/vix16_reference/types/VixFindItemType.html)。常量 VIX_FIND_REGISTERED_VMS 未列为受支持的参数 - 只有常量 VIX_FIND_RUNNING_VMS 是。

我的猜测是，这意味着目前 VIX API 无法获取在 VMware Workstation 实例上注册的虚拟机列表。

这也可以解释为什么 vmrun.exe 命令行实用程序无法获取已注册的虚拟机。

我想我只能等到下一个版本的 VIX API 发布。

# vb.net - MustOverride 具有混合访问级别 Get / Set 的属性

> ID：383775
> 
> 赞同：4
> 
> 时间：2008-12-20T21:43:09.597
> 
> 标签：vb.net, oop

Visual Basic 允许具有混合访问级别的属性，例如

```
Public Property Name() as String
    Get

    End Get

    Friend Set(ByVal value As String)

    End Set
End Property 
```

有没有办法定义`MustOverride`具有混合 getter/setter 访问级别的属性？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T21:48:47.900

嗯......你可以很容易地在 C# 中：

```
public abstract string Foo { get; protected set; } 
```

不幸的是，当我反编译时，Reflector 会创建无效的 VB...

编辑：查看了一些文档后，我*怀疑*您不能这样做:( [MustOverride 文档](http://msdn.microsoft.com/en-us/library/hyb29zk8.aspx)指出：

> 不完整的声明。当您指定 MustOverride 时，您不为属性或过程提供任何额外的代码行，甚至不提供 End Function、End Property 或 End Sub 语句。

这表明你不能指定不同的访问级别:(

# php - 获取Facebook状态的PHP函数？

> ID：383777
> 
> 赞同：9
> 
> 时间：2008-12-20T21:44:22.887
> 
> 标签：php, facebook, status, updates

我正在寻找一个好的、简单的 PHP 函数来获取我最新的 Facebook 状态更新。有人知道吗？

谢谢！

**编辑：**我在下面添加了一个半解决方案。

或者是否有人知道阅读 RSS 提要并吐出最近状态更新的好方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T21:53:54.850

快速检查[PEAR](http://pear.php.net)发现[Services_Facebook](http://pear.php.net/package/Services_Facebook)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T09:03:44.187

这是一个不完整的答案，但这是我到目前为止所得到的：

首先：[在 FB 上添加开发者应用程序](http://www.facebook.com/developers/)。然后创建一个新的应用程序。随心所欲地称呼它。

二：[下载PHP客户端。](http://svn.facebook.com/svnroot/platform/clients/packages/facebook-platform.tar.gz) 将其转储到您的虚拟主机上的某个位置，即 /facebook/

第三：将以下初学者代码复制到一个php文件中：

```
 <?php
 require_once('facebook/php/facebook.php');
 $facebook = new Facebook("YOUR_API_KEY","YOUR_SECRET_KEY");
 $result = $facebook->api_client->fql_query("SELECT status FROM user WHERE uid = YOURIDNUMBER");
 // OR --- they both get the same data
 $result = $facebook->api_client->users_getInfo(YOURIDNUMBER,'status');
 print_r($result);
 echo "<pre>Debug:" . print_r($facebook,true) . "</pre>"; // debug info
 ?> 
```

**其他信息：**

*   您必须登录并添加应用程序。或者您授予应用程序offline_access 权限并添加应用程序。
*   您可以通过输入以下网址添加 offline_access：http: [//www.facebook.com/authorize.php? api_key=YOUR_API_KEY&v=1.0&ext_perm=offline_access](http://www.facebook.com/authorize.php?api_key=YOUR_API_KEY&v=1.0&ext_perm=offline_access)
*   在此处找到有关权限的更多信息：[http ://wiki.developers.facebook.com/index.php/Extended_permissions](http://wiki.developers.facebook.com/index.php/Extended_permissions)
*   我在一个停止点：任何我的程序调用 fql 查询或 users_getInfo，我的页面停止执行 php？我猜对新应用程序的调用数量有限？我从来没有做过任何FB开发，所以我对它完全陌生。也许拨打电话并将您最近的状态（或最近的状态）保存在您自己的数据库中，以防止对 API 的过度调用？

我希望这可以帮助某人入门！

**编辑：**似乎 FB 不会让您访问某人的状态，即使 offline_access 已打开，除非您是那个人或他们的朋友（取决于他们的隐私设置）。

但是我确实做到了，最终设法在新的个人资料版本中找到了 RSS 提要：http: [//www.new.facebook.com/minifeed.php?filter=11](http://www.new.facebook.com/minifeed.php?filter=11)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-27T08:56:30.367

我找到了获取您最新的 Facebook 状态的方法。这就是你的做法：

1)[创建一个 facebook 应用程序](http://www.facebook.com/developers/createapp.php)，并复制您的应用程序密码和应用程​​序 ID。

2) 授予应用程序 read_stream 和 offline_access 您的个人资料。( [http://developers.facebook.com/docs/authentication/permissions](http://developers.facebook.com/docs/authentication/permissions) ) 要获取您的最新状态，应用程序需要一个 access_token。授予离线访问权限后，访问令牌应该“永不”过期。最简单的方法是单击此代码生成的按钮：（请务必填写“您的应用程序 ID”并将 cookie 设置为 true！）

```
<fb:login-button perms="read_stream,offline_access"></fb:login-button>
<div id="fb-root"></div>
<script src="http://connect.facebook.net/en_US/all.js"></script>
<script>FB.init({appId: 'your app id', status: true, cookie: true, xfbml: true});</script> 
```

3) 现在尝试找出它正在使用什么 access_token。access_token 保存在 fbs_appId cookie 中。使用浏览器或使用`$_COOKIE['fbs_appId']`. 寻找`access_token=...`。

4）现在您有一个（希望）永不过期的 access_token，您可以使用以下代码：

```
$access_token='xxxxxxxxxxxxxxxxxxxx';
$appId='123456789132456789';
$appSecret='xxxxxxxxxxxxxxxxxxxx';
$profileId='123456789';

//http://github.com/facebook/php-sdk/blob/master/src/facebook.php
require 'facebook.php';

$facebook = new Facebook(array('appId' => $appId,'secret' => $appSecret));
$response = $facebook->api('/'.$profileId.'/feed?limit=1&access_token='.$access_token); 
```

5）消息部分应位于：`$response['data'][0]['message']`

我不知道访问令牌的有效期有多长。脸书说：

> 使您的应用程序能够随时代表用户执行授权请求。默认情况下，大多数访问令牌会在短时间内过期，以确保应用程序仅在用户积极使用应用程序时代表用户发出请求。此权限使我们的 OAuth 端点返回的访问令牌长期有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-09T20:57:56.177

如果您只想获取最新状态，这是一个非常简单的功能。它不依赖于 Facebook SDK 或任何东西。您只需要 CURL 和 JSON 支持。

[获取facebook状态的简单PHP函数](http://itslennysfault.com/easiest-way-to-get-the-latest-status-from-facebook-fan-pages-in-php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-20T22:09:07.737

我似乎从不与 PEAR 相处，但如果你的运气比我好，那么 PEAR 解决方案似乎是长期的最佳途径。

另一个想法是探索[Facebook 开发者 API](http://developers.facebook.com/get_started.php)库，看看它是否能给你提供你想要的东西。

最后，曾经有一种方法可以获取 RSS 提要……但我似乎找不到任何有用的说明，但如果你感兴趣的话，你可能会在 Facebook 的帮助下四处寻找。我的最终看起来像这样：

`http://www.new.facebook.com/feeds/status.php?id=[idnumber]&viewer=[viewer]&key=[key]&format=rss20`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-01T21:02:18.000

我使用 Jens 的帖子来检索有效的 access_token。然后，我使用以下代码从 xml 文件中提取了状态消息和发布时间（您可以更改 $limit 以显示更多或更少的状态消息，或使用表单进行更改）。

请务必输入您的 Facebook ID 和从您创建的应用程序中获得的访问令牌（请参阅[Jens 的帖子](https://stackoverflow.com/questions/383777/php-function-to-get-facebook-status/2719874#2719874)）。[您可以在此处](http://www.michlmania.de/status2.php)检查此脚本的输出。

玩得开心！

```
<?php
if(isset($_POST['limit'])) {
    $limit = $_POST['limit'];
}
else {
    $limit = 3; // number of status messages to display
}
$f = fopen ("https://api.facebook.com/method/status.get?uid=YOUR_FACEBOOK_ID&limit=".$limit."&access_token=YOUR_ACCESS_TOKEN", "r");

while ($line= htmlentities(fgets($f))) {
    if ($line===FALSE) print ("FALSE\n");
    else
    {
        $content = $content." ".$line;
    }
}
fclose ($f);

$message = explode("&lt;message&gt;", $content); // search for the <message> tag
$message_cnt = count($message);
$msg_index = 0;

$time = explode("&lt;time&gt;", $content); // search for the <time> tag

for($i=1; $i<$message_cnt; $i++)
{
    $tmp = explode("&lt;/message&gt", $message[$i]);
    $msg[$msg_index] = $tmp[0]; // status message

    $tmp2 = explode("&lt;/time&gt", $time[$i]);
    $t[$msg_index++] = $tmp2[0]; // time of posting
}

for($i=0; $i<$msg_index; $i++)
{
     echo("<span class=\"status\">".preg_replace('!\015\012|\015|\012!','<br>',$msg[$i])."</span><br>\n
           <span class=\"date\">on ".date("d.m.Y", $t[$i])." at ".date("H:i",$t[$i])."</span><br><br>\n");

}
?> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-16T12:19:38.523

在过去的几天里，我尝试了很多教程，但都没有奏效。我认为这可能是由于 facebook 改变了他们的 api 要求。这是我发现目前唯一有效的方法：

[http://www.deanblog.co.uk/article/13/adding-a-facebook-status-feed-to-your-website-with-php](http://www.deanblog.co.uk/article/13/adding-a-facebook-status-feed-to-your-website-with-php)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-20T19:10:59.600

只需使用 PHPforFB 框架（[www.phpforfb.com/en/](http://www.phpforfb.com/en/)）以最快的方式。

代码如下所示：

```
require_once('phpforfb_framework.php');

$structInit = array('app_id' => APP_ID,'app_name' => APP_NAME,'sec_key' => APP_SECKEY);

$FacebookAPP = new PHPforFB($structInit);

if($FacebookAPP->lastErrorCode>0){
    //Creation failed => Display error message and exit
    echo "PHPforFB Error: ".$FacebookAPP->lastErrorCode." -> ".$FacebookAPP->lastError;
}else{
    //PHPforFB framework established

    if($FacebookAPP->userLoggedIn === TRUE){

        //If the user is logged in at Facebook:
        //Here you can determine if the user has at least once before
        //granted basic permissions to your application.
        if($FacebookAPP->userAuthenticated === FALSE){

            //The user has not yet granted permissions
            //**your code here**
        }else{
            //The user has already granted permissions, therefore his Facebook ID
            //is known to us. It is always available in $FacebookAPP->userID:

            $userID = $FacebookAPP->userID;
            //**your code here**
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-04T19:35:07.887

由于我无法使用 API 路由，我选择了在以下位置找到的 RSS：http: [//www.new.facebook.com/minifeed.php?filter=11](http://www.new.facebook.com/minifeed.php?filter=11)

并使用以下[名为 StatusPress](http://www.paradoxica.net/2007/08/30/statuspress/)的 PHP 函数，以及我自己的一些修改，来解析我的 Facebook 状态的 RSS 提要。效果很好！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-04-23T15:29:15.700

```
<?php
// see http://github.com/facebook/php-sdk/blob/master/facebook.php
require './facebook.php';
// Create our Application instance.
// see http://www.youtube.com/watch?v=jYqx-RtmkeU for how to get these numbers
$facebook = new Facebook(array('appId' => 'XXX','secret' => 'XXX'));
// This call will always work since we are fetching public data.
// this could be /username or /username/friends etc...
// see developer api for FQL for examples
$status = $facebook->api('/haanmc/feed?limit=1');
?>
<p><?php print $status['data'][0]['message']; ?></p>
<p>Likes: <?php print $status['data'][0]['likes']; ?> | Comments: <?php print count($status['data'][0]['comments']['data']); ?></p>
<textarea style="width: 95%; height: 600px;"><?php print_r($status); ?></textarea> 
```

# php - 需要在 PHP Formmail 脚本中重新格式化电话号码条目

> ID：383780
> 
> 赞同：5
> 
> 时间：2008-12-20T21:47:45.737
> 
> 标签：php, regex

我在客户网站的联系表格中有一个简单的“电话号码”文本字段。formmail 脚本返回用户在该字段中键入的任何内容。例如，他们将收到“000-000-0000”、“0000000000”、(000) 000-000 等。客户希望收到这种形式的所有电话号码：000-000-0000。有人可以提供一个简单的脚本来删除所有无关的标点符号，然后重新插入破折号吗？

我不是程序员，只是设计师，所以我不能提供任何现有代码供任何人评估，但我很乐意将 formmail 脚本通过电子邮件发送给任何可以提供帮助的人。

谢谢。A. 格兰特

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-20T22:38:21.937

```
<?php
function formatPhone($number)
 {
    $number = preg_replace('/[^\d]/', '', $number); //Remove anything that is not a number
    if(strlen($number) < 10)
     {
        return false;
     }
    return substr($number, 0, 3) . '-' . substr($number, 3, 3) . '-' . substr($number, 6);
 }

foreach(array('(858)5551212', '(858)555-1212', '8585551212','858-555-1212', '123') as $number)
 {
    $number = formatPhone($number);
    if($number)
      {
          echo $number . "\n";
      }
 }
 ?> 
```

以上返回：

```
858-555-1212
858-555-1212
858-555-1212
858-555-1212 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-15T20:42:10.863

```
function format_phone($phone)
{
    $phone = preg_replace("/[^0-9]/", "", $phone);

    if(strlen($phone) == 7)
        return preg_replace("/([0-9]{3})([0-9]{4})/", "$1-$2", $phone);
    elseif(strlen($phone) == 10)
        return preg_replace("/([0-9]{3})([0-9]{3})([0-9]{4})/", "($1) $2-$3", $phone);
    else
        return $phone;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T22:01:37.813

像这样的东西

```
function formatPhone($number)
{
  $number = str_replace(array('(', ')', '-', ' '), '', $number);
  if (strlen($number) == 10)
  {
    $area = substr($number, 0, 3);
    $part1 = substr($number, 3, 3);
    $part2 = substr($number, 6);

    return "$area-$part1-$part2";
  }
  else
  {
    return false;
  }
} 
```

如果传入的数字长度为 10 位，它将返回格式正确的数字。否则，它将返回`FALSE`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-16T16:46:52.160

//电话号码格式
//示例 $phone = '1111111111'

```
$area = substr($phone, 0, 3);
$part1 = substr($phone, 3, 3);
$part2 = substr($phone, 6);
$phone = '('.$area.') '.$part1.'-'.$part2;
echo $phone; 
```

//看起来像 (111) 111-1111

# .net - 在 iis6 中增加文件上传大小限制

> ID：383781
> 
> 赞同：15
> 
> 时间：2008-12-20T21:47:52.677
> 
> 标签：.net, iis-6, file-upload, uploading

除了 metabase.xml 文件还有其他地方可以修改文件上传大小吗？

我目前正在运行一个带有 IIS6 的登台服务器，它被设置为允许上传最大 20mb 的文件。这工作得很好。我有一个新的生产服务器，我正在尝试设置相同的可用大小限制。所以我编辑了 metabase.xml 文件并将其设置为 20971520。然后我重新启动了 IIS，但没有成功。所以我然后重新启动了整个服务器，这也没有用。我可以上传大约 2mb 的文件，所以它绝对允许文件大小大于标准的 200kb 默认大小。我尝试上传一个 5mb 的文件，但我的 upload.aspx 页面完全崩溃了。是否有可能我需要配置其他东西？生产服务器位于服务器场上，是否可以在那里设置一些限制？

谢谢

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-20T22:39:54.240

我将扩展我对您的问题的回答，以考虑其他可能的情况。

学习上传大文件的一个很好的链接是： [http ://weblogs.asp.net/jgalloway/archive/2008/01/08/large-file-uploads-in-asp-net.aspx](http://weblogs.asp.net/jgalloway/archive/2008/01/08/large-file-uploads-in-asp-net.aspx)

Jon Galloway 在这里解释了解决这个问题的最佳技术：

1.-更改机器配置或web.config：

```
<system.web>
  <httpRuntime executionTimeout="240" maxRequestLength="20480" />
</system.web> 
```

在这里，您不仅要更改 maxRequestLength，而且还必须为 executionTimeout 提供更多的秒数。

有趣的事情：考虑到这个设置的值在调试模式下被忽略了。.NET Framework 2.0 中的默认值为 110 秒。在 .NET Framework 1.0 和 1.1 中，默认值为 90 秒。

2.-谈真正的解决方案，HttpModules喜欢免费的[NeatUpload](http://www.brettle.com/neatupload)

3.-解释另一种更直观的上传方式：Silverlight或flash [swfupload](http://swfupload.org/)

4.-他谈到了 II7 的一个限制。在此页面[http://www.telerik.com/help/aspnet-ajax/upload_uploadinglargefiles.html](http://www.telerik.com/help/aspnet-ajax/upload_uploadinglargefiles.html)您可以找到更多有趣的 IIS 7 设置，最大设置为 100 兆。您添加：

```
 <system.webServer>
...
   <security >
     <requestFiltering>
       <requestLimits maxAllowedContentLength="1024000000" />
     </requestFiltering>
   </security>
</system.webServer> 
```

您必须打开文件 C:\Windows\System32\inetsrv\config\applicationHost.config 并找到以下行：

```
<section name="requestFiltering" overrideModeDefault="Deny" /> 
```

更改为：

```
<section name="requestFiltering" overrideModeDefault="Allow" /> 
```

Galloway 提到的另一个有趣的事情是：“在 ASP.NET 1.0 和 1.1 中，整个文件在写入磁盘之前被加载到内存中。在 ASP.NET 2.0 中进行了改进，可以在上传过程中将文件流式传输到磁盘。”

对于 IIS6，Chris 给出的解决方案我认为是合适的：

[http://www.banmanpro.com/support2/File_Upload_limits.asp](http://www.banmanpro.com/support2/File_Upload_limits.asp)

另一个来源：

[http://www.telerik.com/support/kb/aspnet-ajax/upload/page-not-found-error-when-uploading-large-files-on-win2003.aspx](http://www.telerik.com/support/kb/aspnet-ajax/upload/page-not-found-error-when-uploading-large-files-on-win2003.aspx)

* * *

另一个用户在这里测试了很多组件的 URL：

[http://remy.supertext.ch/2008/01/file-upload-with-aspnet/](http://remy.supertext.ch/2008/01/file-upload-with-aspnet/)

他提到了一个代码项目项目（！），这是另一个使用大文件和闪存的非常好的例子：

[http://www.codeproject.com/KB/aspnet/FlashUpload.aspx](http://www.codeproject.com/KB/aspnet/FlashUpload.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-20T21:55:28.310

如果您使用的是 ASP .NET，则需要修改**maxRequestLength** web.config 属性。

请参阅[此链接](http://weblogs.asp.net/mhawley/archive/2004/05/11/129824.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-29T22:06:10.270

我已经为这个问题苦苦挣扎了几个小时，终于解决了我的特定问题，我想在这里分享。

如果您使用的是[urlscan](http://technet.microsoft.com/en-us/security/cc242650.aspx)，则其配置中也存在文件大小限制。要对此进行更改，您需要编辑位于（通常）位于以下位置的文件“UrlScan.ini”：

C:\WINDOWS\system32\inetsrv\urlscan

**将“ MaxAllowedContentLength** ”的值更改为您想要的最大文件大小值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-01T08:49:39.293

如果您从 rad-control 上传文档，则可以使用这行代码。

```
RadFileExplorer1.Configuration.MaxUploadFileSize = 2000 * 1024; 
```

它对我有用。

# java - 通过 Java JDBC 使用 iBATIS 的 Oracle SQL DATE 转换问题

> ID：383783
> 
> 赞同：16
> 
> 时间：2008-12-20T21:49:54.420
> 
> 标签：java, oracle, date, jdbc, ibatis

我目前正在使用来自 Java 的 iBATIS 处理 Oracle SQL DATE 转换问题。

我正在使用 Oracle JDBC 瘦驱动程序 ojdbc14 版本 10.2.0.4.0。iBATIS 版本 2.3.2。Java 1.6.0_10-rc2-b32。

问题围绕此 SQL 片段返回的 DATE 类型的列：

```
SELECT *
FROM   TABLE(pk_invoice_qry.get_contract_rate(?,?,?,?,?,?,?,?,?,?)) order by from_date 
```

包过程调用返回一个引用游标，该游标被包装在一个 TABLE 中，然后很容易读取结果集，就像对表的选择查询一样。

在 PL/SQL Developer 中，返回的列之一是 SQL DATE 类型的 FROM_DATE，具有一天中时间的精度：

```
Tue Dec 16 23:59:00 PST 2008 
```

但是当我通过 iBATIS 和 JDBC 访问它时，该值只保留当天的精度：

```
Tue Dec 16 12:00:00 AM PST 2008 
```

像这样显示时会更清楚：

本来应该：

```
1229500740000 milliseconds since epoch
Tuesday, December 16, 2008 11:59:00 PM PST 
```

但是得到这个：

```
1229414400000 milliseconds since epoch
Tuesday, December 16, 2008 12:00:00 AM PST
(as instance of class java.sql.Date) 
```

无论我尝试什么，我都无法公开要通过 Java JDBC 和 iBATIS 返回的此 DATE 列的完整精度。

iBATIS 的映射是这样的：

```
FROM_DATE : 2008-12-03 : class java.sql.Date 
```

当前的 iBATIS 映射是这样的：

```
<result property="from_date" jdbcType="DATE" javaType="java.sql.Date"/> 
```

我也试过：

```
<result property="from_date" jdbcType="DATETIME" javaType="java.sql.Date"/> 
```

或者

```
<result property="from_date" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/> 
```

但是所有尝试的映射都会产生相同的截断日期值。就好像 JDBC 在 iBATIS 接触它之前就已经造成了丢失数据精度的损害。

显然，当我在 PL/SQL Developer 中运行与测试脚本相同的 SQL 片段时，我会通过 JDBC 和 iBATIS 丢失一些数据精度。完全不能接受，非常令人沮丧，最终非常可怕。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-20T12:50:41.060

完整信息（它比此处描述的更复杂，可能取决于正在使用的特定版本的 Oracle 驱动程序）在 Richard Yee 的回答中 - [现在到 Nabble 的链接已过期]

* * *

在它从 nabble 到期之前快速抓取...

罗杰，见：[http ://www.oracle.com/technetwork/database/enterprise-edition/jdbc-faq-090281.html#08_01](http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-faq-090281.html#08_01)

具体来说：简单数据类型 DATE 和 TIMESTAMP 发生了什么？本节介绍简单数据类型。:-)

在 9.2 之前，Oracle JDBC 驱动程序将 DATE SQL 类型映射到 java.sql.Timestamp。这具有一定的意义，因为 Oracle DATE SQL 类型与 java.sql.Timestamp 一样包含日期和时间信息。由于 java.sql.Date 不包括时间信息，因此更明显的映射到 java.sql.Date 有点问题。也是RDBMS不支持TIMESTAMP SQL类型的情况，所以将DATE映射到Timestamp没有问题。

在 9.2 TIMESTAMP 支持被添加到 RDBMS。DATE 和 TIMESTAMP 之间的区别在于 TIMESTAMP 包括纳秒，而 DATE 不包括。因此，从 9.2 开始，DATE 映射到 Date 并且 TIMESTAMP 映射到 Timestamp。不幸的是，如果您依赖 DATE 值来包含时间信息，就会出现问题。

有几种方法可以解决这个问题：

更改您的表以使用 TIMESTAMP 而不是 DATE。这可能很少有可能，但它是最好的解决方案。

更改您的应用程序以使用 defineColumnType 将列定义为 TIMESTAMP 而不是 DATE。这样做存在问题，因为您真的不想使用 defineColumnType 除非您必须（请参阅什么是 defineColumnType 以及何时应该使用它？）。

更改您的应用程序以使用 getTimestamp 而不是 getObject。如果可能，这是一个很好的解决方案，但是许多应用程序包含依赖于 getObject 的通用代码，因此并不总是可行的。

设置 V8Compatible 连接属性。这告诉 JDBC 驱动程序使用旧映射而不是新映射。您可以将此标志设置为连接属性或系统属性。通过将连接属性添加到传递给 DriverManager.getConnection 或 OracleDataSource.setConnectionProperties 的 java.util.Properties 对象来设置连接属性。通过在 java 命令行中包含 -D 选项来设置系统属性。

java -Doracle.jdbc.V8Compatible="true" MyApp Oracle JDBC 11.1 修复了这个问题。从此版本开始，驱动程序默认将 SQL DATE 列映射到 java.sql.Timestamp。无需设置 V8Compatible 即可获得正确的映射。强烈反对 V8Compatible。你根本不应该使用它。如果你确实将它设置为 true 它不会伤害任何东西，但你应该停止使用它。

虽然它很少以这种方式使用，但 V8Compatible 的存在不是为了修复 DATE to Date 问题，而是为了支持与 8i 数据库的兼容性。8i（和更早版本）数据库不支持 TIMESTAMP 类型。设置 V8Compatible 不仅会导致 SQL DATE 在从数据库读取时映射到 Timestamp，还会导致所有 Timestamp 在写入数据库时​​都转换为 SQL DATE。由于不支持 8i，因此 11.1 JDBC 驱动程序不支持此兼容模式。因此，不支持 V8Compatible。

如上所述，11.1 驱动程序在从数据库读取时默认将 SQL DATE 转换为 Timestamp。这始终是正确的做法，而 9i 的更改是一个错误。11.1 驱动程序已恢复为正确行为。即使您没有在应用程序中设置 V8Compatible，在大多数情况下，您也不应该看到任何行为差异。如果您使用 getObject 读取 DATE 列，您可能会注意到不同之处。结果将是时间戳而不是日期。由于 Timestamp 是 Date 的子类，这通常不是问题。您可能会注意到不同之处在于您是否依赖从 DATE 到 Date 的转换来截断时间组件，或者您是否对值执行 toString。否则更改应该是透明的。

如果由于某种原因您的应用程序对这种更改非常敏感并且您必须具有 9i-10g 行为，那么您可以设置一个连接属性。将 mapDateToTimestamp 设置为 false，驱动程序将恢复为默认的 9i-10g 行为并将 DATE 映射到 Date。

如果可能，您应该将列类型更改为 TIMESTAMP 而不是 DATE。

-理查德

* * *

Roger Voss 写道: 我在 stackoverflow 上发布了以下问题/问题，所以如果有人知道解决方案，很高兴看到它在那里得到回答：

通过 Java JDBC 使用 iBATIS 的 Oracle SQL DATE 转换问题

以下是问题描述：

我目前正在努力解决使用来自 Java 的 iBATIS 的 Oracle sql DATE 转换问题。

我正在使用 Oracle JDBC 瘦驱动程序 ojdbc14 版本 10.2.0.4.0。iBATIS 版本 2.3.2。Java 1.6.0_10-rc2-b32。

问题围绕此 SQL 片段返回的 DATE 类型的列：

SELECT * FROM TABLE(pk_invoice_qry.get_contract_rate(?,?,?,?,?,?,?,?,?,?)) 按 from_date 排序

包过程调用返回一个引用游标，该游标被包装在一个 TABLE 中，然后很容易读取结果集，就像对表的选择查询一样。

在 PL/SQL Developer 中，返回的列之一是 SQL DATE 类型的 FROM_DATE，具有一天中时间的精度：

```
Tue Dec 16 23:59:00 PST 2008 
```

但是当我通过 iBATIS 和 JDBC 访问它时，该值只保留当天的精度：

```
Tue Dec 16 12:00:00 AM PST 2008 
```

像这样显示时会更清楚：

应该是：1229500740000 毫秒，自 2008 年 12 月 16 日星期二太平洋标准时间晚上 11:59:00

但改为：1229414400000 毫秒，自 2008 年 12 月 16 日星期二太平洋标准时间上午 12:00:00 以来（作为 java.sql.Date 类的实例）

无论我尝试什么，我都无法公开要通过 Java JDBC 和 iBATIS 返回的此 DATE 列的完整精度。

iBATIS 的映射是这样的：

FROM_DATE：2008-12-03：类 java.sql.Date

当前的 iBATIS 映射是这样的：

我也试过：

或者

但是所有尝试的映射都会产生相同的截断日期值。就好像 JDBC 在 iBATIS 接触它之前就已经造成了丢失数据精度的损害。

显然，当我在 PL/SQL Developer 中运行与测试脚本相同的 SQL 片段时，我会通过 JDBC 和 iBATIS 失去一些数据精度。完全不能接受，非常令人沮丧，最终非常可怕。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T08:45:16.330

我发现了如何解决这个问题。iBATIS 允许注册自定义类型处理程序。所以在我的 sqlmap-config.xml 文件中我添加了这个：

```
<typeAlias alias="OracleDateHandler" type="com.tideworks.ms.CustomDateHandler"/>
<typeHandler callback="OracleDateHandler" jdbcType="DATETIME" javaType="date"/> 
```

然后添加了这个实现iBATIS TypeHandlerCallback 接口的类：

```
// corrected getResult()/setParameter() to correctly deal with when value is null
public class CustomDateHandler implements TypeHandlerCallback {
    @Override
    public Object getResult(ResultGetter getter) throws SQLException {
        final Object obj = getter.getTimestamp();
        return obj != null ? (Date) obj : null;
    }

    @Override
    public void setParameter(ParameterSetter setter,Object value) throws SQLException {
        setter.setTimestamp(value != null ? new Timestamp(((Date)value).getTime()) : null);
    }

    @Override
    public Object valueOf(String datetime) {
        return Timestamp.valueOf(datetime);
    }
} 
```

当我不需要映射 Oracle DATE 时，我现在这样描述它：

```
<result property="from_date" jdbcType="DATETIME" javaType="date"/> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T12:42:43.850

我已经解决了我的问题，`jdbcType="TIMESTAMP"`而不是`jdbcType="DATE"`

• 问题：

```
<result column="MY_UTC_POS" property="myUtcPosition" jdbcType="DATE" /> 
```

• 解决了：

```
<result column="MY_UTC_POS" property="myUtcPosition" jdbcType="TIMESTAMP" /> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-03T22:03:57.333

问题出在 Oracle 驱动程序上。

我找到的最佳解决方案是将所有 jdbcType="DATE" 更改为 jdbcType="TIMESTAMP" 并将所有 #column_name:DATE# 更改为 #column_name:TIMESTAMP#

所以改变：

```
<result property="from_date" jdbcType="DATE" javaType="java.sql.Date"/> 
```

到

```
<result property="from_date" jdbcType="TIMESTAMP" javaType="java.sql.Date"/> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T23:50:34.503

问题是使用`java.sql.Date`. 根据[Javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Date.html)，由实例包装的毫秒值`java.sql.Date`必须通过在与实例关联的特定时区中将小时、分钟、秒和毫秒设置为零来“规范化”，以符合 SQL 的定义`DATE`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T03:26:43.943

是的，我明白了——普通的 SQL DATE 标准必须只存储到当天的分辨率。事实上，这里有一段关于 Oracle 的 DATE 类型的片段：

> Oracle 同时支持日期和时间，尽管与 SQL2 标准不同。Oracle 没有使用两个单独的实体（日期和时间），而是只使用一个实体 DATE。DATE 类型以一种特殊的内部格式存储，不仅包括月、日和年，还包括小时、分钟和秒。

这表明 Oracle 的 DATE 超过了标准 SQL DATE。

嗯，Oracle PL/SQL 人员广泛使用 DATE 来保存他们依赖于秒的分辨率的值。看起来 iBATIS 需要类似于 Hibernate sql 方言概念的东西，而不是通过 java.sql.Date 解释 DATE，而是可以覆盖并改为通过 java.util.Date 解释，Javadocs 将其定义为允许毫秒分辨率。

不幸的是，当我将映射更改为以下内容时：

```
<result property="from_date" jdbcType="DATE" javaType="java.util.Date"/> 
```

或者

```
<result property="from_date" jdbcType="DATETIME" javaType="java.util.Date"/> 
```

它似乎仍然首先将 SQL DATE 转换为 java.sql.Date 并丢失了时间精度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-06T16:55:21.713

Richard Yee 提到 Oracle 的最新驱动程序解决了这个问题。我可以确认。在这里使用 10.2 驱动程序也有同样的问题，今天升级到 ojdbc5.jar (11.2.0.1.0)，现在问题消失了。

# eclipse - 如何最小化 Eclipse 中的代码区域？

> ID：383784
> 
> 赞同：20
> 
> 时间：2008-12-20T21:49:54.920
> 
> 标签：eclipse

Visual Studio 中有一个很好的特性：您可以创建可以最小化的特殊代码区域，就像 Eclipse 中的类方法被最小化一样。喜欢：

```
#region

//some code

#endregion 
```

有没有办法在 Eclipse 中实现如此令人愉悦的功能？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-02-10T17:15:26.667

叫做“collapse all”，在go to help>key assistant...>双击“collapse all”中点击你想折叠所有方法的编辑器视图，全部折叠

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-06-12T21:11:59.580

单击编辑器侧面的“-（减号）”符号，右键单击减号，转到折叠/全部折叠

键盘快捷键：Ctrl+Shift+NumbPad_Divide

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-20T21:57:57.167

如果您的意思是最小化折叠，那么我认为 Eclipse 没有您想要的折叠选项。当我查看 eclipse 折叠选项时，它告诉我它可以折叠

*   注释
*   标题评论
*   内部类型
*   成员
*   进口

如果您的意思不是折叠，那么我很抱歉造成混乱。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-12-09T08:34:10.307

首先检查折叠是否启用，如果启用则禁用，然后您可以最小化或折叠代码并展开代码。您可以检查折叠通过

折叠在 Window -> Preferences -> Java -> Editor ->Folding 下配置

如果未选中，请选中启用折叠

现在您可以最小化您的代码

全部折叠（页面上的所有功能）：Ctrl+Shift+NumbPad_Divide

全部展开（页面上的所有功能）：Ctrl+Shift+NumbPad_Mulitply

折叠一个功能：Ctrl+NumbPad_Minus

展开一项功能：Ctrl+NumbPad_Plus

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-14T15:06:35.713

为此有一些插件，例如 Eclipse 的“Coffee Bytes Java Folding”。其他 IDE 像 Netbeans 作为原生等价物。

它实际上依赖于 Java 中的 IDE，而不是用 C# 等语言实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-14T06:06:41.077

[Java等价于c#中的#region](https://stackoverflow.com/questions/2344524/java-equivalent-to-region-in-c-sharp)

检查第二个答案

//区域我的区域

代码在这里

//结束区域

* * *

## 回答 #7

> 赞同：-11
> 
> 时间：2010-03-21T23:42:43.703

*   以下是我的做法：

    1.  创建一个名为 Blank 的空类
    2.  将此大纲用于您的代码：

    Blank b = new Blank() { public void myCode() { /*在此处插入代码*/ } }; b.myCode();

# language-agnostic - 为什么 Google 的“人脸识别”功能仅在 Picasa WEB 中可用，而在 PC 版 Picasa 中不可用？

> ID：383789
> 
> 赞同：1
> 
> 时间：2008-12-20T21:56:09.960
> 
> 标签：language-agnostic, picasa, face-recognition

我朋友今天问我这个。

Picasa Web 有一个很酷（也很吓人 :-) 的功能，它可以识别您相册中的所有面孔。

但是PC（桌面）版本没有这个。

我能想到的几个原因：

1.  他们只是还没有开始编写 PC 版本的代码。
2.  他们正在许可该功能，并且在 PC 上花费更多（或不可用）。
3.  需要大量的处理能力（这似乎很奇怪，因为我的 PC 周期对 Google 是免费的，但他们必须为服务器上消耗的周期付费。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T22:11:03.100

我确信它会在即将发布的版本中脱颖而出，但就其自己的竞争/补充服务而言，谷歌是一家有趣的公司。有一件事是肯定的，只有 Picasa 团队中的某个人才能给出准确的答案。

但我们可以假设几件事......

*   他们不希望他们的代码被逆向工程。
*   （正如您所说），他们没有获得重新分发的许可
*   它在开发版本中被其他尚未完成的新功能阻止
*   他们不想发布它，因为他们希望人们将 PicasaWeb 用作社交照片网络。

我认为处理能力不是问题。如果他们在自己的服务器上免费批量运行它，现代桌面可能会毫无问题地运行它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T23:43:16.890

从我对人脸识别软件的有限接触来看，这可能是重新分配的问题。当我处理它时，人脸识别是它自己的小世界，每个 CPU 的许可成本极高，并且对代码松散感到极度偏执。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-09T20:25:17.823

我不太确定这不是处理问题。谷歌的大型服务器花了 30 分钟来浏览我所有的照片。我只能想象在我的本地机器上执行相同的任务需要几天时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T13:07:47.093

实际上，当您进行搜索时，它只是在有限的功能中，有一个图标可以仅查找带有面孔的照片。实验性护照功能也可以这样工作。

所以答案是：

*   可用或使用的基础（API）不同，语言也不同，因此不能直接移植。
*   不是同一个软件，也没有明确的目标使两个应用程序功能相同。
*   程序员是有限的，他们的时间也是有限的。他们选择现在实施什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T17:48:51.317

不知道 Picasa 是否属于这种情况，但还有另一种情况可能是许可问题。如果服务器端代码使用具有 DRM（例如 GPL）的限制性许可证的代码，这会限制您如何使用该代码分发模块。在此类许可下，在用户仅获取输出的 Web 服务器上运行该模块是合法的。如果该代码被分发，将会附加许多法律要求，这对于包括谷歌在内的商业软件公司来说可能是非常不受欢迎的。这是让某些功能只能通过 Web 服务访问的一个很好的理由。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-09T20:35:47.520

[Riya](http://www.riya.com)也是如此（可以说是第一个为消费者照片集提供可靠面部识别的市场）。

最大的原因可能是：

*   处理时间（他们无法控制您的 CPU 的速度，因此他们无法控制体验）。面部识别很可能是过程密集型的（这是 Riya 声明不在客户端进行的原因）
*   识别过程需要大量数据进行处理，只能在服务器上访问？（换句话说，这个过程需要遍历数百万张面孔，而不仅仅是硬盘上的面孔？）

# perl - 为什么我不能从 Perl 连接到 postgres？

> ID：383801
> 
> 赞同：3
> 
> 时间：2008-12-20T22:04:34.000
> 
> 标签：perl, postgresql, tcp, dbi

我相信我已经正确设置了 Pg，但我的脚本似乎没有连接到数据库。我正在测试：

```
$database="networkem";
$user="postgres";
$密码="";
$host="本地主机";

$dbh = DBI->connect("DBI:Pg:dbname=$dbname;host=$host", $user, $password);

```

我的 pg_hba 内容如下：

```
托管所有 postgres 127.0.0.1 255.255.255.255 信任

```

我可以`psql`通过命令行很好地使用并使用 -i 选项启动 postmaster。我错过了什么？

我还尝试了另一个可以通过 psql 正常工作的用户：

```
$user="jimbo"; $password="p2ssw0rd";

```

使用 pg_hba 阅读：

```
托管所有 jimbo 127.0.0.1 255.255.255.255 信任

```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-20T23:29:43.330

与其打 20 个问题来调试您的设置，不如`DBI->errstr`说出连接失败的原因。

```
my $dbh = DBI->connect(...) or die DBI->errstr; 
```

尽管如果我不得不猜测...由于 Postgres 基于主机和登录用户进行身份验证，我怀疑您提供给 Postgres 连接的用户名和您登录的 Unix 用户之间存在混淆。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T21:01:34.003

除了 Schwern 的出色响应之外，您还可以查看 PostgreSQL 日志，根据在 postgresql.conf 中选择的选项，它可能会告诉您很多关于哪里出了问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:53:39.530

我遇到过同样的问题。上面尝试“-h localhost”的提示证实我在通过网络连接时遇到问题。

将以下内容添加到 pg_hba.conf 解决了该问题。

```
host all postgres 127.0.0.1/32 trust 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-10T06:09:09.500

建议您在 postgresql.conf 中使用“listen_addresses”配置选项，而不是在命令行中使用“-i”。例如：

```
listen_addresses = '*' 
```

尝试以与您运行 perl 脚本的用户相同的用户身份执行以下命令：

```
psql -U postgres -h localhost networkem 
```

'-h localhost' 强制使用网络连接而不是 Unix 套接字连接。如果该命令有效，您的 perl 脚本也应该有效。

# delphi - 推荐支持 Delphi 颜色代码的颜色选择器实用程序

> ID：383812
> 
> 赞同：6
> 
> 时间：2008-12-20T22:12:06.590
> 
> 标签：delphi, color-picker

我正在寻找一个支持 Delphi 颜色代码的免费颜色选择应用程序。
- 像[ColorPic](http://www.iconico.com/colorpic/)这样的东西会很完美。（ColorPic 颜色代码与 Delphi 不兼容）
- 支持颜色集将是一个奖励。

如果您有任何建议，请告诉我。

[编辑]
为了澄清，我正在寻找一个独立的颜色选择工具，而不是一个组件。
[/编辑]

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T08:52:09.200

我找到了[Color Cop- http://colorcop.net](http://colorcop.net/download "彩色警察")。它有一个滴管，允许选择颜色并支持 Delphi 颜色代码。它不支持颜色集。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T01:46:56.203

[已经回答了](https://stackoverflow.com/questions/279822/can-someone-recommend-a-colour-picker-component-for-delphi)。

这看起来不错：（[来源：][[bergsoft.net](http://mxs.bergsoft.net/images/logocolorlib.png)][）][![颜色库](https://i.stack.imgur.com/GzagR.png)](https://i.stack.imgur.com/GzagR.png)

> [ColorLib](http://mxs.bergsoft.net/index.php?p=3)是您可以为 Delphi 找到的最完整的颜色选择器和转换库。这些组件为您提供了专业的颜色选择方法和颜色模型之间的转换以及 HTML 颜色转换实用程序。在最新版本中，此包包含 31 种可以组合的颜色工具，让您可以创建大量新工具和颜色对话框。它与 XP Lib（可选）集成以提供完整的 MS Office 风格的颜色对话框。那么，您的用户还会使用 TColorDialog 来挑选颜色吗？

[![替代文字](https://i.stack.imgur.com/Jt7HL.png)](https://i.stack.imgur.com/Jt7HL.png)
[（来源：[bergsoft.net](http://mxs.bergsoft.net/images/colorlib.png)）]

# .net - TextBox 中 Windows 窗体滚动日志输出的最佳方法

> ID：383813
> 
> 赞同：31
> 
> 时间：2008-12-20T22:15:52.947
> 
> 标签：.net, winforms, logging, textbox

在 Forms 应用程序中，我正在显示来自生成大量输出的长时间运行的命令行应用程序的日志输出。我在后台启动程序，捕获它的输出，当前使用 AppendText 在 TextBox 中显示它。例如，我更喜欢只显示最后 1000 行。从 TextBox 中删除行的成本很高，而且 TextBox 并不是滚动日志显示的最佳方法。

关于在 Windows 窗体中执行滚动日志窗口的最佳控件的任何想法？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-20T22:33:48.903

我曾经让列表框做这种事情。如果行数达到 1000，您只需删除第一行。如果日志行太长，您可以使列表框更宽一些（取决于日志信息以及是否有可能从第一个可见的没有水平滚动的单词）并使水平滚动条可见。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-21T12:30:05.453

正是我需要的。我用以下代码解决了它，它使最后添加的项目保持可见：

```
 delegate void UpdateCCNetWindowDelegate(String msg);

     private void Message2CCNetOutput(String message)
     {
         // Check whether the caller must call an invoke method when making method calls to listBoxCCNetOutput because the caller is 
         // on a different thread than the one the listBoxCCNetOutput control was created on.
         if (listBoxCCNetOutput.InvokeRequired)
         {
             UpdateCCNetWindowDelegate update = new UpdateCCNetWindowDelegate(Message2CCNetOutput);
             listBoxCCNetOutput.Invoke(update, message);
         }
         else
         {
             listBoxCCNetOutput.Items.Add(message);
             if (listBoxCCNetOutput.Items.Count > Program.MaxCCNetOutputLines)
             {
                 listBoxCCNetOutput.Items.RemoveAt(0); // remove first line
             }
             // Make sure the last item is made visible
             listBoxCCNetOutput.SelectedIndex = listBoxCCNetOutput.Items.Count - 1;
             listBoxCCNetOutput.ClearSelected();
         }
     } 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-09-20T15:53:04.053

有同样的需求，非常感谢这种帮助。这是一个稍作修改的版本。

创建一个列表框：

```
<ListBox x:Name="lbLog" Background="LightGray"></ListBox> 
```

在主线程中（在代码的初始部分），将其用于存储对 UI 线程的引用：

```
Thread m_UIThread;
....
m_UIThread = Thread.CurrentThread; 
```

然后这是您的日志方法，可从任何线程调用：

```
public void AddToLog(String message)    
{
    if (Thread.CurrentThread != m_UIThread)
    {
        // Need for invoke if called from a different thread
        this.Dispatcher.BeginInvoke(
            DispatcherPriority.Normal, (ThreadStart)delegate()
            {
                AddToLog(message);
            });
    }
    else
    {
        // add this line at the top of the log
        lbLog.Items.Insert(0, message);

        // keep only a few lines in the log
        while (lbLog.Items.Count > LOG_MAX_LINES)
        {
            lbLog.Items.RemoveAt(lbLog.Items.Count-1);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-20T22:44:53.250

不久前我需要这样做，而 Listbox 就是解决方案。甚至没有人会注意到差异。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-19T12:52:49.613

非常简单的解决方案

```
Textbox1.Appendtext(<yourtext>) 
```

用于控制台等滚动日志

# maven-2 - maven-camel 构建问题

> ID：383817
> 
> 赞同：0
> 
> 时间：2008-12-20T22:18:36.233
> 
> 标签：maven-2, dependencies, executable-jar

我有一个简单的应用程序，使用 netbeans 进行开发，使用 maven 进行构建等。我的应用程序使用 camel ，配置了 spring XML。我想构建一个带有依赖项的可执行 jar，所以我使用带有 'jar-with-deps' 描述符的 maven-assembly 插件。jar 构建良好，但我认为由于所有依赖项都已解包，并且其中一些依赖项在与其他依赖项相同的路径中具有相同的资源，因此它们会相互覆盖。我通过使用 winrar 浏览 jar 来验证这一点，我发现在很多地方都出现了同一个文件。我认为这是无法通过一些简单的 maven 配置来解决的，因为我无法阻止依赖项想要特定路径中的资源，而另一个依赖项也使用它。顺便说一句，该应用程序在 netbeans 内运行正常。我还看到我的应用程序类多次出现。

总而言之，我想知道：

1.  是否有任何简单的解决方案可以找到此类冲突，如果没有纠正它们，至少要报告它们？（如何）

2.  我可以告诉归档器（在 maven 中）不要解开 deps，而只是将 jar 包含在父 jar 中，然后将 jar 包含在清单类路径中，以及如何？这会解决问题还是具有相同的结果？

3.  为什么在同一路径中还会多次出现我的应用程序类？

为了让您了解问题，当前生成的 jar 在使用 WinRAR 查看时，在根路径中有 3 个“log4j.properties”实例，在 meta-inf/ 路径中有 7 个文件“spring.schemas”实例，以命名一些。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T09:16:56.257

我认为将所有 .jar 压缩到一个 .jar 中是不可能的。许多这些 .jar 的 .jar 文件（log4j.properties、spring XML 文件）中都有资源，这些资源位于同一文件夹中，因此会有冲突。

最好提供可以通过设置类路径来启动应用程序的启动脚本。我记得在 JDK1.5 或 1.6 中，您可以将文件夹设置为类路径，它将包含该文件夹中的所有 jar。

# spring - 使用 Spring 进行基于 JSP 的模板

> ID：383822
> 
> 赞同：5
> 
> 时间：2008-12-20T22:25:21.667
> 
> 标签：spring, jsp, model-view-controller, spring-mvc, jsp-tags

我将 Spring 的 MVC 与 JSP 视图一起使用。每个 JSP 页面都有类似的结构——页眉、内容、页脚，可能还有边栏等。四处寻找“最佳实践”的人似乎“包含”页脚和页眉，但这意味着每个 JSP 页面都包含这些“包含”语句，给出固定的格式。在我看来，更好的解决方案将涉及嵌套视图，其中使用适合相关页面的信息扩展基本模板。这种方法的一个优点是您可以在基本模板中假定默认值，而无需在其他地方重复它们。另一个优点是您可以进一步分离结构和内容（“页眉”和“页脚”是结构化的，

在 Spring 的 MVC 级别似乎没有对此的任何支持，但它可以使用自定义标签在 JSP 中实现，而且确实，这里有一个相当笨重的尝试[（](http://www.javaworld.com/javaworld/jw-09-2000/jw-0915-jspweb.html)这可能比这个问题更能解释我想要什么，虽然我认为你可以减少干扰）。

无论如何，我的问题是 - 这是否已经作为（流行/标准）标签库存在？我很高兴编写自定义标签，但我对这些东西（生成网站）的印象是已经有大量的解决方案，其中大部分工作都在选择正确的工具（例如 Spring）。谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-23T15:53:29.457

我推荐[SiteMesh](https://github.com/sitemesh)。它适用于 Spring。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T23:46:19.723

我可能没有在这里获得完整的图片，但您可能还想看看[apache tile](http://tiles.apache.org/)

我个人更喜欢避免添加新框架的复杂性，所以我只坚持使用[标签文件](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/JSPTags5.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T22:29:56.010

如果您不依赖于 Spring MVC，我建议您使用 Apache Wicket，因为它允许您所描述的行为类型。它还与 Spring for IoC 很好地集成。

[Wicket 的标记继承](http://wicket.apache.org/examplemarkupinheritance.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-09T09:23:41.913

我会推荐[Apache Tiles](http://tiles.apache.org/)

我已经用 SiteMesh 和 Tiles 做到了这一点。但我相信 Tiles 比 SiteMesh 更适合这项工作。-- 在 MHO 中，SiteMesh 的目标更多是在操纵现有网页。

# mysql - mySQL存储过程where子句问题

> ID：383831
> 
> 赞同：4
> 
> 时间：2008-12-20T22:37:20.143
> 
> 标签：mysql, stored-procedures, return-value, where-clause

我有一个看起来像这样的 mySql 存储过程——

```
delimiter |
create procedure GetEmployeeById(in ID varchar(45))
begin
  select id,
      firstName,
      lastName,
      phone,
      address1,
      address2,
      city,
      state,
      zip,
      username,
      password,
      emptypeid
  from myschema.tblemployees t
  where
      t.id=ID limit 1;
end |
delimiter; 
```

如果我没有限制 1，它总是返回表中的所有行——每个记录的 id 值设置为 ID 参数。为什么我不能只使用 where id=ID，为什么当我这样做时它会返回所有记录？我使用限制 1 有什么影响？为什么我在星期六晚上编程？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-20T22:48:36.143

因为，它将 t.id 与自身进行比较，这始终是正确的。将您的形式参数称为其他名称。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-20T23:16:20.347

MySQL 中的列名不区分大小写。查询中的`id`列*隐藏*了名为的参数`ID`，因此您的`where`子句实际上是使用两个不同的表达式来引用同一列。当然，一列的值总是等于它自己，所以所有的记录都匹配。为输入参数使用不同的名称。

# java - 关于 Java 垃圾收集器、空值和内存泄漏的问题

> ID：383833
> 
> 赞同：4
> 
> 时间：2008-12-20T22:38:42.870
> 
> 标签：java, garbage-collection, reference

假设我在 java 中实现了一个队列，并且我有一个对初始节点的引用，称为 ini，另一个对最后一个节点，称为 last。现在，我开始将对象插入队列。在某一时刻，我决定我想要一个清除队列的操作。然后我这样做：

```
ini = null;
last = null; 
```

我在泄漏内存吗？我猜 ini 和 last 之间的节点仍然是链式的并且仍然有它们的数据，但同时还有垃圾收集器。

另一种方法是访问每个元素，然后将它们对下一个节点的引用设为空，但是我基本上会像在 C++ 中那样做，除了我不会显式使用删除。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-20T22:43:15.450

只要在代码中的其他任何地方都没有引用队列中的项目，垃圾收集器就能够回收该内存。在 Java 中将指针设置为 null 与在 C 中将 malloc 的指针设置为 null 会阻止它被释放是不同的。在 Java 中，内存在不再可访问时被回收。只要您不通过 JNI 使用本机代码，Java 就没有内存泄漏（在 C/C++ 意义上）。

一个简单的垃圾收集器只会计算对一个对象的引用数并在引用计数达到零时释放该对象，但这将无法处理引用周期（A -> B，A -> B -> C -> A 等）。Java GC 算法会进行活性测试，在其中构建系统中所有对象的参考图。GC 会进行图遍历，并且任何无法访问的节点（对象）都被标记为未使用且可用于重新分配。图的根（遍历的起始点）包括线程堆栈上的变量、静态变量以及本机代码通过 JNI 持有的引用。在此处查看更多信息：http: [//java.sun.com/developer/Books/performance/performance2/appendixa.pdf](http://java.sun.com/developer/Books/performance/performance2/appendixa.pdf)

仍然可能有*参考泄漏*。这是指您持有对对象的引用超过所需时间的情况。例如：

```
public class Stack {
  private final Object[] stack = new Object[10];
  private int top = 0;
  public void push(Object obj) {stack[top++] = obj;}
  public Object pop() {return stack[top--]; }
} 
```

忽略上溢/下溢的可能性，在调用 Stack.pop() 之后，数组成员变量仍然具有对返回对象的引用。它将防止该对象被垃圾收集，直到不再引用周围的 Stack 实例。这是需要将变量设置为 null 以便可以回收其内存的罕见情况之一：

```
public Object pop() {Object ret = stack[top]; stack[top--] = null; return ret;} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T22:44:00.707

那会很好用。GC 会检测到节点不可达，所以它们都会被清理掉。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T10:32:03.863

是的，GC 在这种情况下有效。但是head和tail之间的元素可能会存活下来，然后进入老年代空间，然后在full GC期间被收集。如您所知，完整的 GC 很昂贵。就性能而言，将它们归零更好。

您可以看到 java.util.LinkedList 的 clear() 方法是如何实现的。

```
public void clear() {
    Entry<E> e = header.next;
    while (e != header) {
        Entry<E> next = e.next;
        e.next = e.previous = null;
        e.element = null;
        e = next;
    }
    header.next = header.previous = header;
    size = 0;
    modCount++;
} 
```

[http://tech.puredanger.com/2009/02/11/linkedblockingqueue-garbagecollection/](http://tech.puredanger.com/2009/02/11/linkedblockingqueue-garbagecollection/)触及问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T21:41:48.950

如果您怀疑自己有内存泄漏，我建议您使用内存分析器来查看对象是如何随时间保留的。使用这样的工具，快速内存泄漏将是显而易见的，因此，如果您为怀疑泄漏的内容创建测试并重复多次，您将能够看到泄漏以及保留对象的原因。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-21T02:07:50.967

下面是一些代码，用于演示列表结构中间的杂散句柄如何阻止 GC 完全清理：

```
import java.lang.ref.*;

public class MemoryLeak1 {

    MyListItem leakedItem = null;
    WeakReference[] refs = null;

    public static void main(String[] args) {
        WeakReference ref = null;
        MyListItem item = null;
        MemoryLeak1 leak = new MemoryLeak1();
        int i;

        leak.doit(); // create a memory leak
        System.gc(); // force the gc to run;

        // At this point the list has been explicitly cleared,
        // has gone out of scope, and the GC has run.
        // However, leak.leakedItem is still holding a
        // reference to an item in the list, so anything
        // reachable from that item is still alive.

        // show what's still around...
        for (i = 0; i < 10; i++) {
            ref = leak.refs[i];
            item = (MyListItem)ref.get();
            if (item == null) { System.out.println("" + i + " = null"); }
            else { System.out.println("" + i + " = " + (String)item.thing); }
        }
        System.out.println("---------------------");

        // now let's free some additional items...
        for (i = 1; i <= 3; i++) {
            item = leak.leakedItem;
            leak.leakedItem = item.next;
            leak.leakedItem.prev = null;
            item.prev = null;
            item.next = null;
        }
        item = null;

        System.gc(); // force the gc to run again

        // this time we should get fewer items
        for (i = 0; i < 10; i++) {
            ref = leak.refs[i];
            item = (MyListItem)ref.get();
            if (item == null) { System.out.println("" + i + " = null"); }
            else { System.out.println("" + i + " = " + (String)item.thing); }
        }
        System.out.println("---------------------");

        // now clear the last reference
        leak.leakedItem = null;

        System.gc(); // force the gc to run again

        // this time we should none
        for (i = 0; i < 10; i++) {
            ref = leak.refs[i];
            item = (MyListItem)ref.get();
            if (item == null) { System.out.println("" + i + " = null"); }
            else { System.out.println("" + i + " = " + (String)item.thing); }
        }
        System.out.println("---------------------");
    }

    public void doit() {
        this.refs = new WeakReference[10];
        MyList list = new MyList();
        MyListItem item = null;

        // add strings to the list.
        // set each into the array of soft refs 
        // set a ptr to the 6th item in an instance variable
        for (int i = 0; i < 10; i++) {
            item = new MyListItem();
            item.thing = new String("string" + i);
            list.insert(item);
            if (i == 5) this.leakedItem = item;
            this.refs[i] = new WeakReference(item);
        }

        // clear the list, but don't clear the
        // additional ptr to the 6th item
        list.clear();
    }
}

class MyList {
    MyListItem head = null;
    MyListItem tail = null;

    void clear() {
        head = null;
        tail = null;
    }

    void insert(MyListItem item) {
        if (head == null) {
            // empty list
            item.next = null;
            item.prev = null;
            tail = item;
            head = item;
        }
        else if (head == tail) {
            // one item in list
            item.next = head;
            item.prev = null;
            tail = head;
            head = item;
        }
        else {
            // multiple items in list
            item.next = head;
            item.prev = null;
            head = item;
        }
    }

    MyListItem remove() {
        MyListItem item = tail;
        if (item != null) {
            tail = item.prev;
            if (tail == null) {
                head = null;
            }
            else {
                tail.next = null;
            }
            item.next = null;
            item.prev = null;
        }
        return item;
    }
}

class MyListItem {
    MyListItem next = null;
    MyListItem prev = null;
    Object thing = null;
} 
```

# vbscript - 根据位置更改默认打印机

> ID：383843
> 
> 赞同：3
> 
> 时间：2008-12-20T22:52:45.010
> 
> 标签：vbscript, printers

我想编写一个 VBScript 来根据连接的打印机更改默认打印机。
我有一台我在工作和家里使用的笔记本电脑，我想在启动 Windows 时运行这个脚本，这样默认打印机总是正确的。
如果在 XP 中有另一种方法可以做到这一点，我会全力以赴。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T23:37:41.317

WMI 可能适合。

```
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
    & "{impersonationLevel=impersonate}!\\" _
    & strComputer & "\root\cimv2")
Set colInstalledPrinters =  objWMIService.ExecQuery _
    ("Select * from Win32_Printer Where Name = 'ScriptedPrinter'")
For Each objPrinter in colInstalledPrinters
If objPrinter.Name="SomePrinterName" Then 
    objPrinter.SetDefaultPrinter()
End If
Next 
```

-- [http://msdn.microsoft.com/en-us/library/aa394598(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394598(VS.85).aspx)

您还可以找出域等：

```
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
    & "{impersonationLevel=impersonate}!\\" _
    & strComputer & "\root\cimv2")
Set colSettings = objWMIService.ExecQuery _
    ("Select * from Win32_ComputerSystem")
For Each objComputer in colSettings 
    Wscript.Echo "System Name: " & objComputer.Name
    Wscript.Echo "Domain: " & objComputer.Domain
Next 
```

-- [http://msdn.microsoft.com/en-us/library/aa394586.aspx](http://msdn.microsoft.com/en-us/library/aa394586.aspx)

# open-source - F# 开源项目

> ID：383848
> 
> 赞同：59
> 
> 时间：2008-12-20T22:59:49.053
> 
> 标签：open-source, f#

我正在寻找一些可供学习的开源 F# 项目。不是片段而是完整的项目，它们很好地代表了 F# 功能（即模式匹配、可区分联合等）。

我的目标主要是了解所有功能如何组合在一起，项目如何组织以及如何从功能角度解决问题。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-12-21T02:58:47.387

开源 F# 项目列表（已编译）：

*   [F# 中的数学应用程序，通过 .NET 集成 Autocad](http://through-the-interface.typepad.com/through_the_interface/2007/11/a-mathematical-.html)
*   [游戏开发教程](http://code.google.com/p/fs-gamedev/)
*   [单位](https://github.com/fsharp/fsunit)
*   [Storm](http://www.codeplex.com/storm)（用于测试 Web 服务的工具）
*   [FParsec](http://www.quanttec.com/fparsec/) - F# 解析器组合库
*   [下载](http://code.msdn.microsoft.com/DownloadStockPrices)StockPrices - 用 F# 编写
*   [Truskill](http://blogs.technet.com/apg/archive/2008/04/05/trueskill-through-time.aspx) - Xbox Live Player 评分器（用 F# 编写）
*   [F# 集体智能实施](http://github.com/robertpi/fscollintelli/tree/master)
*   [NDjango](http://ndjango.org)
*   [BistroFS - F# Web 框架](http://bistrofs.codeplex.com/)
*   [VsVim - Visual Studio 的 Vim 仿真](https://github.com/jaredpar/VsVim)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-07-14T20:03:51.430

[FsCheck](http://www.codeplex.com/fscheck)，一个基于规范的测试框架。

[VCC](http://vcc.codeplex.com/)，C程序的静态分析（由MS研究）

[VSLab](http://vslab.codeplex.com/)，Visual Studio 中类似数学/matlab 的环境

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-28T21:01:50.377

又找到了一个：

[Storm](http://www.codeplex.com/storm) : 用于测试 Web 服务的工具

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-07-31T17:54:02.807

Frack -- Functional Rack -- is an implementation of OWIN (Open Web Interface for .NET), which has a similar intent as the Python WSGI and JSGI specifications. Frack is similar in implementation to Rack and Jack and owes a lot to those projects.

[https://github.com/panesofglass/frank](https://github.com/panesofglass/frank)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-03-02T17:20:55.243

[BistroFS](http://bistrofs.codeplex.com/) - F# 的 Web 框架

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-31T15:51:39.813

[FParsec](http://www.quanttec.com/fparsec/) - F# 的解析器组合库

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-05-28T20:32:57.507

也许[Wing Beats](http://wingbeats.codeplex.com/)会很有趣？

该项目不到一年，到目前为止我们只有两个贡献者，但我相信有一些有趣的东西可以查看。

我们希望其他人加入，或者至少检查一下并尝试一下。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-26T23:19:26.233

[搜索谷歌代码](http://code.google.com/hosting/search?q=label:fsharp)我发现：

*   [计算器](http://code.google.com/p/fssamples/)_
*   [游戏开发教程](http://code.google.com/p/fs-gamedev/)
*   [FsUnit](http://code.google.com/p/fsunit/)（一个规范框架）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-02T22:14:53.430

[下载股票价格](http://code.msdn.microsoft.com/DownloadStockPrices)：

> 从雅虎历史报价中下载股票价格、股息和拆分。它还修改它们以使它们发生并调整它们以计算调整后的价格。还有一个可以从 C#/VB.NET 重用的 .NET 组件。它是用 F# 编写的，但可以从任何 .NET 语言中使用。
> 
> 博客文章的链接在[这里](http://blogs.msdn.com/lucabol/archive/2008/09/26/downloading-stock-prices-in-f-part-v-adjusting-historical-data.aspx)：
> 
> 它是用 F# 2008 年 9 月 CTP 编写的。
> 
> 解决方案由以下组成：
> 
> *   执行下载的库
> *   使用 xUnit 的测试项目（但您必须下载 xUnit 并在测试项目中引用它才能运行它）
> *   一个简单的基于控制台的驱动程序
> *   使用该库（称为 Bob）的图形 UI 应用程序的开始

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-08T23:16:18.710

Robert Pickering has put an F# project focused on [Collective Intelligence](http://en.wikipedia.org/wiki/Collective_intelligence) similar to Toby Segaran's book ["Collective Intelligence"](http://books.google.com/books?id=fEsZ3Ey-Hq4C&printsec=frontcover&dq=Collective+INtelligence&ei=fzPdSb3vNYKqzgTE_OTUDg) ( demonstrated therein via python ) on github:

[fscollintelli](http://github.com/robertpi/fscollintelli/tree/master)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-02-09T05:26:39.230

我刚刚为我的开源项目[Unquote](http://code.google.com/p/unquote/)创建了一个点，这是一个 F# 库，用于将单元测试断言编写为 F# 引用表达式。这是学习使用活动模式和模式匹配递归处理和重建报价、混合面向对象和功能代码（它大量使用 .NET 反射）以及使用 xUnit.net 和...库本身编写单元测试的一个很好的例子。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-31T15:57:56.573

Though I'm not sure about the licensing... Microsoft's TrueSkill system (which rates players in XBox360 live gaming) has published some source code.

[http://blogs.technet.com/apg/archive/2008/04/05/trueskill-through-time.aspx](http://blogs.technet.com/apg/archive/2008/04/05/trueskill-through-time.aspx)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-06-07T23:30:39.957

我正在为 FSI 开发一个名为[FsEye](http://code.google.com/p/fseye/)的可视对象树检查器。它演示了 F# 中的 WinForms 开发，包括`async`用于执行非阻塞 GUI 更新和并行计算。对象树使用判别联合和记录建模。`Lazy`值和序列表达式用于按需加载（无限深度）子树。活动模式用于平滑处理非泛型`TreeViewNodes`.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-12-09T11:53:29.647

[YaccConstructor](http://code.google.com/p/recursive-ascent/) - 用于语法处理和解析器构建的模块化工具。

# c# - 私有方法命名约定

> ID：383850
> 
> 赞同：44
> 
> 时间：2008-12-20T23:01:53.557
> 
> 标签：c#, coding-style, private-methods

是否有命名我在`_Add`这里称为“”的私有方法的约定？我不喜欢领先的下划线，但这是我的一位队友所建议的。

```
public Vector Add(Vector vector) {
    // check vector for null, and compare Length to vector.Length
    return _Add(vector);
}

public static Vector Add(Vector vector1, Vector vector2) {
    // check parameters for null, and compare Lengths
    Vector returnVector = vector1.Clone()
    return returnVector._Add(vector2);
}

private Vector _Add(Vector vector) {
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
} 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-20T23:04:32.647

我从未在 C# 中看到任何区分公共方法和私有方法的编码约定。我不建议这样做，因为我没有看到好处。

如果方法名称与公共方法冲突，是时候变得更具描述性了；如果像您的情况一样，它包含公共方法的实际方法*实现*，则一种约定是调用它`*Impl`。即`AddImpl`在你的情况下。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-12-20T23:16:43.497

我通常将 thisCase 用于私有方法，将 ThatCase 用于公共方法。

```
private Vector add(Vector vector) {
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
}

public Vector Add(Vector vector) {
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
} 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-12-20T23:22:55.433

我通常会看到并使用“AddCore”或“InnerAdd”

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-20T23:11:01.107

就个人而言，对于方法，无论可见性如何，我都有相同的命名约定。

这些是我对 C# 的命名约定：

*   命名空间、类型、方法、属性：PascalCase
*   局部变量：camelCase
*   方法的参数：camelCase
*   私有字段：带有下划线前缀的_PascalCase，如果是属性的支持字段，则与仅带有下划线前缀的属性同名

**编辑**：注意，我为私有方法使用前缀名称而感到内疚。我第一次阅读时没有抓住你问题的那个特定部分。

例如，如果我有 7 种不同的方式通过我的 DatabaseCommand 类执行我的 SQL 语句，例如 QueryDataTable、QueryEnumerable、、`QueryEnumerable<T>`QueryDataReader 等。那么所有这些都想调用相同的私有方法，我倾向于调用这个方法 InternalQuery或私人查询。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-21T12:04:41.653

由于公共 Add() 做了一些检查，而私人没有：

```
private Vector AddUnchecked(Vector vector) {
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-22T03:11:33.833

我见过的常用的两种变体是：

```
private Vector DoAdd(Vector vector) { ... } 
```

和

```
private Vector AddImpl(Vector vector) { ... } 
```

两者都不是特别令人满意，但它们是我所看到的。

我从未见过所有私有方法都应该有前缀的约定——光是想到它就让我不寒而栗！

与所有在视线中的每个成员都加上“_”前缀的 C++ 开发人员打交道已经够糟糕的了——而且我说的是以前的 Delphi 开发人员，他们过去常常在每个成员前面加上“F”。我还在恢复中！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-20T23:08:43.420

对私有属性使用前导下划线是很常见的，但我从未见过在方法上这样做过

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-10-28T18:32:53.277

公共方法：

```
public void Add()
{
}
this.Add() 
```

私有方法：

```
private void _Add()
{
}
_Add(); 
```

特性：

```
public int Id {get;set;}
this.Id = 10; 
```

领域：

```
private bool _isUsed;
_isUsed = false; 
```

局部变量：

```
bool isUsed; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-20T23:14:33.797

我会按照队友的建议*去做*，并将其作为团队的惯例。但在特定情况下，您似乎可以避免它：

```
public Vector Add(Vector vector) {
    // check vector for null, and compare Length to vector.Length
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
}

public static Vector Add(Vector vector1, Vector vector2) {
    // check parameters for null, and compare Lengths
    Vector returnVector = vector1.Clone()
    return returnVector.Add(vector2);
} 
```

或者也许我只是不应该这么晚...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-20T23:06:20.180

我认为在大多数约定中，私人物品有更多的自由。但是我看到了很多：

```
private Vector AddCore(Vector vector) 
```

或者

```
private Vector DoAdd(Vector vector) 
```

但是，我可能会放弃私有 add 方法，而只有一个：

```
public static Vector Add(Vector vector1, Vector vector2) 
{
    // check if vector1 is null
    Vector returnVector = vector1.Clone()
    return returnVector.Add(vector2);
}

public Vector Add(Vector vector) 
{
    // check parameters for null, and compare Lengths
    for (int index = 0; index < Length; index++) {
        this[index] += vector[index];
    }
    return this;
} 
```

也把那些花括号放在正确的位置:-)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-07-07T19:09:00.370

`AddInternal()`在这种情况下，EPiServer 使用“...内部”的约定。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-20T23:08:54.743

使用方法名称进行描述以创建自我解释的代码，不应该有任何冲突，因为您不应该有两个方法做完全相同的事情，因此您应该没有理由需要一个字符来为方法名称添加前缀。

有些人用“m_”前缀私有字段，我没有看到私有方法有任何类似的样式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-20T23:54:57.833

不幸的是，我经常遇到这种约定，并且倾向于使用前导下划线来命名表单上的控件（例如“_txtFirstname”而不仅仅是“txtFirstname”）。从不再推荐使用下划线命名私有变量的做法来看，这似乎是一种奇怪的溢出效应。那，或者程序员只是喜欢使用下划线键，我无法弄清楚。

不要使用这个约定，当你的同事坚持它时，挑战他在网上找到推荐这种做法的东西（*任何东西）。*

# .net - 为什么这个属性没有被设置？

> ID：383857
> 
> 赞同：1
> 
> 时间：2008-12-20T23:07:53.483
> 
> 标签：.net

我在转换属性后尝试设置它的值时遇到了麻烦。我不确定这是否称为*拳击*。

无论如何，新变量正在设置，但原始变量没有。我认为新变量只是对原始变量的*引用。*但是当我检查智能/调试观察器时，原始属性仍然为空。

这是代码。

```
// NOTE: data is either a Foo || FooFoo || FooBar, at this point.
//       only Foo impliments ITagElement.
if (data is ITagElement)
{
    var tags = ((ITagElement)data).TagList;
    // At this point, tags == null and data.TagList == null.
    if (tags.IsNullOrEmpty())
    {
        tags = new List<Tag>();
    }

    tags.Add(new Tag
    {
        K = xmlReader.GetAttribute("k"),
         V = xmlReader.GetAttribute("v")
    });

    // At this point, Tags.Count == 1 and data.TagList == null :( :( :(
} 
```

请注意我关于`tags`和的值的内联注释`data.TagList`？有人可以解释我做错了什么吗？我认为该变量`tags`只是指向属性的引用指针`data.TagList`.. 但看起来不是。

## 更新/回答:)

谢谢你们的回答！这很尴尬，因为我多年来一直在做这些事情，但仍然忘记/没有注意到像这样的简单事情。（当然，现在我看到了光明，这很有意义）。

Marc 得到了分数，因为他的答案 (IMO) 对于我的单个金发脑细胞来说是最简单的。

谢谢大家！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-20T23:13:48.510

标签和数据是完全独立的变量。仅仅因为您将对象分配给`tags`，这对*变量* `data`没有任何影响。

您感到困惑的是，当两个*变量*指向同一个*对象*时，将通过任一*变量*看到对（单个）*对象*的更改。

 *基本上，如果`data`开始非空，你有

*   数据：指向“列表 A”
*   技术标签： 指向“列表A”

在这种情况下，将对象添加到`data`或`tags`实际上将对象添加到相同的“列表 A”

但是，如果`data`开始为 null，则您有：

*   数据：指向空
*   技术标签： 指向 null

然后分配`tags`，给出：

*   数据：指向空
*   技术标签： 指向“列表B”

您必须手动分配“列表 B”以`data`使其保持不变。

但是，有一种方法可以让它（分配接口/对象）工作：`ref`和泛型：

```
using System.Collections.Generic;
using System;
class Foo : IBar
{
    List<string> list = new List<string>();
    public int Count { get { return list.Count; } }

    void IBar.Add(string s) { list.Add(s); }
}
interface IBar
{
    void Add(string s);
}

static class Program
{
    static void Main()
    {
        Foo foo = null; // note  foo starts as null
        CreateAndAdd(ref foo, "abc");
        Console.WriteLine(foo.Count); // prove non-null and added
    }
    static void CreateAndAdd<T>(ref T data, string s) where T : IBar, new()
    {
        if (data == null) { data = new T(); } // create
        data.Add(s); // mutate
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T23:16:34.790

您需要了解对对象的引用和对变量/属性的引用之间的区别。

当您阅读 .TagList 属性时，您得到的是它存储的引用的副本。假设 TagList 属性的类型是`List<Tag>`，这就是您获得的副本。

重要的是，您现在了解如果 TagList 已经包含对现有列表的引用，那么现在您有*两个*对该列表的引用。一个在 TagList 属性中，一个在您的 tags 变量中。

但是，由于两者都引用内存中相同的单个列表，如果您向其中添加一些内容，那么该列表将包含新项目，无论您如何进入该列表。

但是，在您现在的代码中，您发现包含所有 TagList 的副本的标签为空，因此您构造了一个新列表并将其放入标签中。这使得标签与 TagList 不同，因为 TagList 仍然持有一个空引用。标签没有以任何方式链接到 TagList 属性，并且对标签的更改不会自动更改 TagList。

所以基本上你需要将该引用存储回 TagList 属性，否则当你的代码完成执行时它仍然是空的。

有关引用如何工作的说明，请参阅我的答案：[了解指针](https://stackoverflow.com/questions/5727/understanding-pointers#5754)。由于引用本质上是指针，因此相同的解释仍然正确。

如果你按照我的解释，你所做的就是在一张纸上写下地址的副本，在另一张纸上，即。复制它。一旦你发现你的复印纸是空的，你就在复印纸上写下新建房子的地址，但原来的纸仍然是空的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T23:14:44.890

您正在重新设置您的参考（即`tags`），但这不会改变`TagList`属性的值。对于此类任务，这始终是正确的。只有对*内容*的更改（即您的`Add`调用）才会跨同一对象的引用进行。

为此，您需要为原始属性和变量分配一个`List<>`新*实例*`tags`。然后，您可以使用所需的结果进行操作。

顺便说一句，我认为`IsNullOrEmpty`是一种扩展方法？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T23:12:56.360

您已*阅读*该`TagList`属性。这使得`tags`保持与 相同的值`TagList`。但`tags`不是. *_* _ `TagList`改变其中任何一个都不会改变另一个。您为局部变量分配了一个新值`tags`，但这不会更改您之前用于初始化该变量的属性。您需要将新值`tags`分配*回*`TagList`.

# p2p - 正在寻找一些了解 Bittorrent 的好书/资源？

> ID：383862
> 
> 赞同：2
> 
> 时间：2008-12-20T23:11:43.133
> 
> 标签：p2p, bittorrent

正在寻找一些好的书籍或技术资源来详细了解 Bittorrent 的工作原理？它可能涉及网络编程、P2P 编程和其他主题的书籍。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T23:19:59.310

首先要看的地方可能是[BitTorrent.org](http://www.bittorrent.org/)。它列出了标准规范以及许多已成为事实上的标准的扩展（其中大部分是由 µTorrent 或 Azereus 开发的）。

也可以在[此处](http://jonas.nitro.dk/bittorrent/bittorrent-rfc.html)找到详尽的指南，尽管它可能不如第一个链接那么最新。

请记住，bittorrent 的大部分复杂性都与客户端实现有关，而服务器（“跟踪器”）则相当琐碎。

# php - Zend_Pdf - 形状顶部的文本？

> ID：383874
> 
> 赞同：0
> 
> 时间：2008-12-20T23:24:38.927
> 
> 标签：php, zend-framework, zend-pdf

是否可以使用 Zend_Pdf 在绘制的形状上绘制文本？无论我执行绘制语句的顺序是什么，形状总是在我的文本之上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T01:38:33.553

首先绘制图像，保存，然后加载文档并绘制文本。

# javascript - Javascript RIA 与 .NET GUI

> ID：383876
> 
> 赞同：0
> 
> 时间：2008-12-20T23:27:15.300
> 
> 标签：javascript, vb.net

我正在考虑将我公司的内部业务应用程序从 VB.NET 迁移到 PHP。一些人担心失去可以在 .NET 中找到的 GUI 功能。我的印象是，使用正确的 javascript 框架，可以复制 .NET GUI 中的任何内容。

虽然我仍在研究这一点，但我想问一下 .NET GUI 中的表单功能实际上是否可以用 javascript 复制，更重要的是，开发是否需要更长的时间才能获得相同的结果？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-20T23:38:15.420

首先：回答你的问题。

树控件很难在 Web 环境中模拟。可行，但很难（以 Yahoos YUI 为例）。

*   **状态**：您可以在 WinForms 中获得它，而不是在 Web 中。这与人们如何使用应用程序有关。
*   **交互**：在 WinForms 上比在 Web 上更容易。同样，它是可行的，但涉及更多层。
*   **数据大小**：显示了多少数据？您在网络上看不到包含数千条记录的网格，这在 WinForms 上很常见。这可能会影响比 WinForms 更长的 Web 加载时间。
*   **测试**：您必须使用多少个浏览器进行测试。浏览器之间的 JavaScript/CSS 差异可能会让生活变得困难。哎呀，如果您必须为此进行开发，IE6 将使您的生活变得困难。
*   **开发时间**：对于在两种环境中都有经验的开发人员来说，这大致相同。

但是，在您的初始陈述中还会出现许多其他问题。

为什么从 WinForms VB.Net 转到 PHP？相反，请使用 VB.Net 访问 ASP.Net。可能会使您免于完全重新发明轮子。此外，您不必学习如何在框架之间进行转换。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T23:51:55.813

我会说是的，任何“可以”复制的东西都可以复制，但是这样做的时间可能马上就会变成一个大瓶颈。

我将假设您当前的应用程序是一个 ASP.NET 应用程序，并且您没有从 WinForms 迁移。（如果你是答案仍然几乎相同......但我可能会添加一些额外的评论）。

开箱即用，从 UI 角度使用拖放功能，您可以进行数据验证和许多其他常规的开箱即用项目，尽管它们是在客户端完成的，但您不必编写一行 JavaScript 来让它们工作. 这是一个很大的成本节省，但它可以在其他地方复制，是的，但需要时间。

其次，您可以轻松使用 ASP.NET AJAX 功能与 AJAX 控件工具包相结合。这些再次允许您使用 .NET 逻辑将事物组合在一起，但是它们可以被复制吗？是的，jQuery 和许多其他 AJAX 框架包含与许多项目相似的项目。

我要说的最重要的一点是，如果你已经有了一些东西并且熟悉它背后的语言和技术，为什么要废弃它，冒着不能按时完成的风险，并进入一个新语言的未知世界。我猜这只是我的 0.02 美元。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T00:57:38.473

一般来说，无论是 Web 应用程序、桌面应用程序还是最近的 Silverlight 应用程序，使用 Microsoft 技术做任何事情总是花费更少的时间。有几个原因：

1.  Microsoft 为一切提供向导。
2.  微软将抽象级别提高得很高，以至于有时人们认为它“抛弃”了开发人员，尽管这值得商榷。更多关于这在#5。
3.  大量的第三方小部件、控件等。
4.  与 Intellisense、源代码管理、IE、Excel、SQL 服务器等 IDE 的紧密集成是开箱即用的。
5.  与 #2 相同，MS 在其 IDE 中提供拖放、点击。Microsoft 也喜欢数据绑定的概念，因此，您最终可以得到一个可能只需要很少几行编码的表格或数据网格。
6.  调试是无缝的，大部分时间都是开箱即用的。

我想说，如果您的应用程序稍微简单一些，那么您可以使用 Microsoft 框架更快地完成。在 Intranet 环境中，您可以控制用户必须使用的浏览器（如果是 Web 应用程序），或者要安装哪个框架（.NET 框架和/或 Silverlight 插件），并且开发时间很关键，那么做微软的方式可能是要走的路。

有一些缺点（我不得不说以下几点，除了 StackOverflow 和一些使用 ASP.NET 构建的网站，这些网站做得非常好）：

1.  您的应用程序往往会变得臃肿。一个简单的桌面应用程序仍然需要完整安装 .NET 框架。
2.  有时做一件简单的事情可能会让你最终做各种复杂的事情，因为 Microsoft API 并不总是最干净的。
3.  对于使用 ASP.NET 的 Web 应用程序，您最终可能会得到一个包含非常丑陋的 JavaScript 代码的应用程序。尽管与这一点没有直接关系，但不久前在 Ajaxian.com 上讨论了一个实例，其中有人在 SharePoint 中发现了一些非常丑陋的 JavaScript 代码。在文化方面，大多数 ASP.NET 开发人员并不关心、不需要，或者根本不了解 JavaScript。那是因为框架鼓励这样做（尽管这可能在未来通过 jQuery 集成而改变）。
4.  Your web application tend not to run on anything other than IEs, and this might be acceptable in your situation. If it does, that might be by accident and not by design.
5.  Microsoft replaces its own technologies every few years and offer very little backward compatibility. They force developers to re-learn in every few years or so and could be confusing in any given transition period where we try to sort things out. As an example. this is currently happening with ASP MVC and Silverlight. But this might be a good thing instead of a drawback.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-20T23:36:27.310

我会说这取决于要复制的 UI 功能。很难衡量未知数:)

# java - Java中泛型数组的最简单替代方法是什么？

> ID：383888
> 
> 赞同：9
> 
> 时间：2008-12-20T23:45:15.123
> 
> 标签：java, arrays, generics

假设我有这个：

```
class test<T>
{
    private T[] elements;
    private int size;
    public test(int size)
    {
        this.size = size;
        elements = new T[this.size];
    }
} 
```

这似乎是不可能的，因为编译器一旦尝试替换泛型代码或其他东西，就不知道要调用哪个构造函数。我想知道的是，我该怎么做呢？我想这是可能的，因为它在 C++ 中很容易完成。

编辑：对不起，我忘记了元素声明中的 []。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-20T23:48:45.973

问题在于，由于泛型类型参数被编译器`T`转换为（称为*类型擦除*），因此您实际上创建了一个. 你可以做的是提供一个功能：`Object`*`Object``Class<T>`*

 *```
class test<T>
{
    private T[] elements;
    private int size;
    public test(Class<T> type, int size)
    {
        this.size = size;
        elements = (T[]) Array. newInstance(type, size);
    }
} 
```

您会在这里找到更好的解释：[Angelika Langer - 我可以创建一个其组件类型是类型参数的数组吗？](http://www.angelikalanger.com/GenericsFAQ/FAQSections/TypeParameters.html#Can%20I%20create%20an%20array%20whose%20component%20type%20is%20a%20type%20parameter?)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-20T23:53:40.083

通用数组的*最简单*替代方法是使用列表。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-02T18:58:30.320

出于多种原因，我倾向于避免使用基本数组并尽可能使用[ArrayLists](http://java.sun.com/javase/6/docs/api/java/util/ArrayList.html)（或类似的[Lists ）。](http://java.sun.com/javase/6/docs/api/java/util/List.html)最重要的两个是：

1.  我不需要秃头数组的语义。括号符号（即指针算术的简写）并没有让我的生活更轻松。

2.  如果我使用列表，我会根据需要设置自己使用更复杂的支持并发的结构。例如，用[CopyOnWriteArrayList](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CopyOnWriteArrayList.html)替换 ArrayList 非常容易。

因此，使用通用 ArrayList 编写示例将如下所示：

```
class test<T> {
    /** It's not strictly necessary to make this a List vs. an ArrayList
        You decide what interface you really need to expose internally. */
    private List<T> elements;
    /** This parameter isn't necessary with a List.  You can always call the
        size() method instead. */
    private int size;
    public test(int size) {
        this.size = size;
        elements = new ArrayList<T>();
        // Note that the next line isn't strictly necessary.
        // An ArrayList can be dynamically resized without any real effort on your part.
        elements.ensureCapacity(size); 
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-02T18:36:35.397

有两种解决方案不需要传入类对象。在这两种情况下，我都假设因为它是一个私有变量，所以你是唯一将东西放入其中的人，而外界看不到它。

一种是只使用一个普通的 Object 数组`Object[]`。缺点是您将失去泛型的好处，并且您将不得不从它那里抛出一些东西，这使得代码更加丑陋。但既然你是唯一一个把东西放进去的人，那么演员应该总是安全的。外界不需要知道发生了什么。

其他选项有点像黑客。您创建一个`Object[]`，然后将其“投射”到`T[]`. 从技术上讲，这是非法的，因为`Object[]`和`T[]`是不同的运行时类型，前者不能转换为后者。但是，只要您不将数组从类中传递出去（例如返回它或其他东西），它就不会引起任何问题，因为无论如何`T[]`都会被擦除`Object[]`，并且实际上不会执行任何转换。然后你可以在你的类中获得泛型的好处以便更容易编码，但是你必须非常小心不要将该数组传递给任何实际期望 a 的人`T[]`，因为它不是。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-20T23:47:17.443

我可能是错的，但你的声明似乎很奇怪，你不应该：

```
private T[] elements; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-02T21:16:29.567

size 字段确实显得多余。您可以只使用 elements.length 而不是 size。

```
class Test<T> {
    private final T[] elements;
    public test(int size) {
        elements = (T[]) new Object[size];
    }
} 
```

或者您可以用 ArrayList 替换 Test 类。即完全放弃课程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-08T23:36:06.647

另请查看此代码：

```
public static <T> T[] toArray(final List<T> obj) {
    if (obj == null || obj.isEmpty()) {
        return null;
    }
    final T t = obj.get(0);
    final T[] res = (T[]) Array.newInstance(t.getClass(), obj.size());
    for (int i = 0; i < obj.size(); i++) {
        res[i] = obj.get(i);
    }
    return res;
} 
```

它将任何类型的对象列表转换为相同类型的数组。

# wcf - 报告应用程序中的数据库抽象

> ID：383890
> 
> 赞同：2
> 
> 时间：2008-12-20T23:46:46.900
> 
> 标签：wcf, architecture, reporting-services, reporting, abstraction

在报告应用程序中，是否可以抽象报告逻辑和数据库架构细节？

我有一个具有相当复杂的报告逻辑的 Reporting Services 应用程序，我正在尝试将应用程序迁移到其他一些数据库。（为相同目的而构建但由不同软件公司开发的数据库。）

在中间使用 Web 服务/WCF 层是明智的决定吗？还可以考虑哪些选项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T00:28:26.830

在一般情况下，很难以一种千篇一律的方式做这种事情，但你可以尝试其中一种：

*   在数据库架构上构建一些视图，并针对这些视图编写报告存储过程。这意味着您在底层数据库模式中具有一定的灵活性，并且可以将视图用作抽象层。

*   构建某种数据仓库平台并编写 ETL 流程以从各种数据源填充它。这更灵活，但构建起来更费力，它只能在定期刷新时工作。如果您的应用程序可以接受这种程度的延迟，那么我建议数据仓库系统是更好的方法。

    数据仓库的主要优势在于它针对报告进行了优化，并且在所有数据源中具有一致的界面——您可以将它们整合到具有一个模式的单个数据库中。报告是针对该模式开发的。添加新系统是通过编写 ETL 流程来填充仓库来实现的；无论数据来源如何，报告都会继续工作。

WCF是一个网络通信系统。您会发现很难让这种架构在逐个事务的基础上处理大量数据 - 批量加载 ETL 过程会更有效率。但是，如果您需要实时提要（可能是交易大厅系统），您可以使用类似的方法来实现。

如果您需要低延迟提要，另一种方法是研究一种称为[Enterprise Information Integration](http://en.wikipedia.org/wiki/Enterprise_Information_Integration)的工具。也许可以做到这一点的最广泛可用的工具是[SSIS中的](http://msdn.microsoft.com/en-us/library/ms141026.aspx)[数据源视图](http://msdn.microsoft.com/en-us/library/ms140311.aspx)，它确实为您提供了将任意数据源映射到一致模式的一些灵活性。它不像最好的 EII 工具那样复杂，但是如果您需要进一步转换数据，您可以将 SSIS 包放在它之上，并将它们用作您的报告的数据源。

但是，我从来没有构建过这样的系统，所以我不能真正保证它在实践中的效果如何。我猜想它会非常脆弱并且很难分解成可以进行单元测试的部分，因此对于一个非常复杂的系统来说，开发和维护将非常耗时。

如果您想调查市场上的其他 EII 系统[此链接](http://www.dmoz.org/Computers/Software/Enterprise_Information_Integration/)是有关 EII 和其他一些 EII 工具供应商的各种文章的目录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T16:00:24.500

我同意 NXC 的数据仓库建议：

*   如果它是一次性工作，则不会，但由于它是一个“报告应用程序”，因此您的许多报告很可能适合 OLAP 范式。
*   这显然是一项可行的任务，因为市场上有许多成功的 OLAP 查询工具，其复杂程度各不相同
*   OLAP 模式，例如标准[星型模式](http://en.wikipedia.org/wiki/Star_schema)，被**设计**为易于查询。它们本质上是扁平的，事实表使用简单的键以非常直接的方式连接到一个或多个维度表。
*   人们希望对报告执行的操作类型是可预测的：过滤、排序、分组、添加或删除列、导出到 CSV 等。
*   您将通过生成的报告获得良好的灵活性 - 探索各种关系的数据的能力非常令人上瘾
*   一旦您编写了查询工具，它就可以移植以与任何其他星型模式重用 - 不错！
*   “是否可以抽象报告逻辑和数据库架构细节？” - 是的，OLAP 模式正是为此而设计的 - 它们使所有数据都符合标准化模式。当然，这会将业务逻辑转移到 ETL 层，但我认为这是它所属的地方。

因此，您需要使用这种方法执行 ETL - 一种选择是执行某种形式的[ROLAP](http://en.wikipedia.org/wiki/ROLAP)，但实际上我发现编写 ETL 脚本与从 ROLAP 设置中获得良好性能一样容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-23T00:40:12.830

我认为通常会在后面咬你的答案，但我认识的其他人喜欢的答案是将每个数据库中的数据生成为 XML。这以大多数产品可以轻松处理的形式为您提供了一组一致的数据。

如果您这样做，请确保您将在其上运行的 XPath 查询会很快。

# html - 写清单的正确方法

> ID：383898
> 
> 赞同：4
> 
> 时间：2008-12-20T23:50:37.813
> 
> 标签：html, html-lists, semantic-markup

这是我已经思考了一段时间的事情，因为我已经看到两者都在实践中使用。

## 方法一

```
<ol>
    <li>List item 1</li>
    <li>List item 2
        <ol>
            <li>List item 3</li>
        </ol>
    </li>
    <li>List item 4</li>
</ol> 
```

这在我看来在语义上是正确的，因为子列表是该列表项的子列表，但是它不是很干净（列表项内容`<list right next to it>`）。

## 方法二

```
<ol>
    <li>List item 1</li>
    <li>List item 2</li>
        <ol>
            <li>List item 3</li>
        </ol>
    <li>List item 4</li>
</ol> 
```

更清晰，但不能直接理解该列表是第 2 项的子列表（尽管人类推断可以理解）。

顺便说一句，这纯粹是对语义标记的关注，两种方法在页面上呈现相同的内容。

所以，你怎么看？可能的来源是可取的，但个人使用也很好。我注意到 MediaWiki 的 heirachial TOC 正在使用方法 1，这鼓励我相信这是正确的用法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-21T00:07:15.687

方法 2 不是有效的 HTML。`OL`不允许作为另一个元素的直接子`OL`元素。仅`LI`允许在`OL`.

此外，由于缩进，子列表对第 2 项的成员资格仅对人类读者是显而易见的。即使使用 s 也要缩进`LI`，看起来内部列表本身就是第三项。我可能会期待这样的渲染，有两个数字：

```
1\. 清单项目 1
2\. 列出第 2 项
3\. 1\. 列出项目 3
4\. 列出第 4 项

```

方法1是要走的路。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-20T23:57:34.693

方法1是正确的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T00:12:22.637

[HTML 4.01](http://www.w3.org/TR/html401/struct/lists.html#edef-UL)仅允许 OL 中的 LI 项。然而，LI 的结束标签是可选的。这意味着这相当于您的方法1：

```
<ol>
   <li>List item 1
   <li>List item 2
      <ol>
        <li>List item 3
      </ol>
   <li>List item 4
</ol> 
```

对于读者来说，结束 LI 的位置有点模棱两可——尽管规范很清楚它会*在*结束 OL 之后。

[XHTML 1.1](http://learningforlife.fsu.edu/webmaster/references/xhtml/tags/list/ol.cfm#parent_child)具有相同的限制，但强制使用关闭 LI 使其明确。

# .net - 这是对铸造的低效使用吗？

> ID：383899
> 
> 赞同：2
> 
> 时间：2008-12-20T23:51:54.877
> 
> 标签：.net, casting

[这个问题是对我之前提出](https://stackoverflow.com/questions/383857/why-is-this-property-not-getting-set "我之前关于参考和属性设置的问题")的问题的扩展（并得到了回答）。我正在重构我的代码，玩弄/试验各种重构的解决方案。

我想出的解决方案之一（但不满意..记住，我只是在尝试一些个人编码风格）是以下代码：-

```
if (data is ITagElement)
{
    if (((ITagElement) data).TagList.IsNullOrEmpty())
    {
        ((ITagElement) data).TagList = new List<Tag>();
    }

    ((ITagElement) data).TagList.Add(new Tag
    {
        K = xmlReader.GetAttribute("k"),
         V = xmlReader.GetAttribute("v")
    });
} 
```

请注意我如何将父对象`data`转换为它多次暗示的接口类型？代码有效，但我觉得这是代码异味-> 效率不高。我觉得可以对此进行改进-那里有任何大师的想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-20T23:57:18.157

这个怎么样，所以你只做一次演员表：

```
ITagElement someData = data as ITagElement
if (someData != null)
{
   if (someData.TagList.IsNullOrEmpty())
    {
        someData.TagList = new List<Tag>();
    }

    someData.TagList.Add(new Tag
    {
        K = xmlReader.GetAttribute("k"),
         V = xmlReader.GetAttribute("v")
    });

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-20T23:59:08.077

使用[as 运算符](http://msdn.microsoft.com/en-us/library/cscsdfbt(VS.71).aspx)获取 is 并在同一个操作中强制转换：

```
ITagElement tagElement = data as ITagElement;
if (tagElement == null) return;

if (tagElement.TagList.IsNullOrEmpty()) {
   tagElement.TagList = new List<Tag>();
}

tagElement.TagList.Add(new Tag
{
    K = xmlReader.GetAttribute("k"),
    V = xmlReader.GetAttribute("v")
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-20T23:57:54.100

我认为这样会更清楚：

```
if (data is ITagElement)
{
    ITagElement dataAsTagElement = (ITagElement)data;
    if (dataAsTagElement.TagList.IsNullOrEmpty())
    {
        dataAsTagElement.TagList = new List<Tag>();
    }

    dataAsTagElement.TagList.Add(new Tag
    {
        K = xmlReader.GetAttribute("k"),
        V = xmlReader.GetAttribute("v")
    });
} 
```

这会更好，因为它避免了 3 次强制转换以换取指针。它对眼睛也容易得多！

# .net - 在通过 Linq 插入 SQL 之前检查是否存在

> ID：383912
> 
> 赞同：2
> 
> 时间：2008-12-21T00:03:13.310
> 
> 标签：.net, sql, linq

如果表中尚不存在一组记录，我想知道是否有更简单的方法可以批量插入一组记录。例如，我在数据库中有一个标签表，其中包含 ID、名称列 - 给定一个标签名称列表，我只想添加那些不存在的标签名称。这是我想出的：

```
private static void InsertTags(IEnumerable<string> tagNames)
{
    MyDataContext db = new MyDataContext();

    var tags = from tagName in tagNames
    where (db.Tags.Where(tag => tagName == tag.Name).FirstOrDefault() == null) 
    select new Tag
    {
        Name = tagName 
    };
    db.Tags.InsertAllOnSubmit(tags);
} 
```

有更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T00:30:37.857

我不确定，但我实际上认为这是最优的。我认为提高性能的唯一方法（如果关键的话）是使用 SP，SP 可以通过 linq to sql 访问。

请记住，InsertAllOnSubmit 命令不会进行批量更新，只是进行大量单独的更新。 [http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2747627&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2747627&SiteID=1)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T13:19:20.503

请注意，您实际上并没有提交这些更改，理想情况下，您应该是`using`确保它得到`Dispose()`d 的上下文。

重新优化 - LINQ-to-SQL 中存在一个故障 - 获取单个记录的最佳方法是通过`Single(pred)`or`SingleOrDefault(pred)`方法，因为这些方法使用身份管理器进行主键查询。含义：如果您按主键查询，并且数据上下文已经知道该记录，则它不会命中数据库。大多数其他查询*确实会*访问数据库（包括`.Where(pred).Single()`）。所以如果`Name`是主键，我会调整为：

```
db.SingleOrDefault(tag => tagName == tag.Name) 
```

在这种情况下，它可能没有太大区别（因为上下文可能不会看到它），但很高兴知道。

# vim - Emacs 相当于 Vim 的命令历史记录（用于输入 Meta-x 命令）

> ID：383918
> 
> 赞同：6
> 
> 时间：2008-12-21T00:09:44.357
> 
> 标签：vim, command-line, emacs, comparison, history

**问题：**对于通过 Mx 调用的输入命令，我很难理解 Emacs 如何允许调用和重新运行命令。命令历史的工作方式与 Vim 完全不同。它将命令放在缓冲区而不是“迷你缓冲区”中。

有没有办法获得类似于 Vim 的方法（即，以前键入的命令可以简单地使用上下箭头键滚动）？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-21T00:32:16.793

`C-x ESC ESC`, `C-x M-ESC`, 或`C-x M-:`将您的历史记录放在小缓冲区中，之后您可以使用箭头键来回滚动。

`M-x list-command-history`将整个历史记录放在一个缓冲区中，您可以从中执行命令。

`C-x z`重复上一个命令。

查看 EMACS 手册（信息）第[8.5 节 Minibuffer History。](http://www.gnu.org/software/emacs/manual/html_node/emacs/Minibuffer-History.html#Minibuffer-History)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-09T07:43:05.697

Mp 和 Mn 是 GNU 软件中的规范历史导航键。Emacs 也不例外；这几乎适用于您可以输入内容的任何地方。

对于扩展命令（“Mx 命令”），点击 Mx，然后在整个历史记录中自由导航。您还可以使用 Cr 进行反向历史 isearch，如在 bash 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T00:16:08.057

称呼

```
customize-group minibuffer 
```

它将显示一个选项*历史长度*（此处默认为 30）。如果要跨 emacs 会话保存历史记录，请参阅

```
customize-group savehist 
```

您可以使用普通箭头键浏览历史记录。`up` **`/`** `down`

# java - 为您的应用程序启用网格/集群的最佳 Java 库是什么？

> ID：383920
> 
> 赞同：28
> 
> 时间：2008-12-21T00:10:19.520
> 
> 标签：java, grid, load-balancing, gridgain

这是在服务器集群上运行应用程序的能力，目的是分配负载并提供额外的冗余。

我看过[GridGain](http://www.gridgain.com/)的演示文稿，我对它印象深刻。

知道其他人吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-21T00:22:42.380

有几种：

*   [Terracotta](http://www.terracotta.org/)（[开源，基于 Mozilla Public License](http://www.terracotta.org/confluence/display/wiki/FAQ#FAQ-Q%3AWhat%27syourlicense%3F)）；
*   [Oracle Coherence](http://www.oracle.com/technology/products/coherence/index.html)（以前的 Tangosol Coherence；商业；基于[JSR 107](http://jcp.org/en/jsr/detail?id=107)，从未正式采用）；
*   [GigaSpaces](http://www.gigaspaces.com/)（商业；基于[JavaSpaces API](http://www.jini.org/wiki/JavaSpaces_Specification)，[Jini](http://www.jini.org/wiki/Main_Page)的一部分）；
*   [您提到的GridGain](http://www.gridgain.com/)（开源：[LGPL](http://en.wikipedia.org/wiki/LGPL)）；
*   带有[Java 客户端库的](http://www.whalin.com/memcached/)[memcached](http://www.danga.com/memcached/)（开源：[BSD 许可证](http://en.wikipedia.org/wiki/BSD_License)；
*   [EHCache](http://ehcache.sourceforge.net/)（开源：[Apache Software License](http://ehcache.sourceforge.net/license.html)；
*   [OSCache](http://www.opensymphony.com/oscache/)（开源：[修改后的 Apache 许可证](http://www.opensymphony.com/oscache/license.action)；和
*   毫无疑问还有其他几个。

现在我还没有使用所有这些，但我已经使用或调查了其中的大多数。

GridGain 和 GigaSpaces 更侧重于[网格计算](http://en.wikipedia.org/wiki/Grid_computing)而不是缓存，并且（恕我直言）最适合计算网格而不是数据网格（请参阅[计算与数据网格的解释](http://java.dzone.com/articles/compute-grids-vs-data-grids)）。我发现 GigaSpaces 是一项非常有趣的技术，它有多种许可选项，包括免费版和面向初创公司的免费完整版。

Coherence 和 Terracotta 尝试将缓存视为[Maps](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Map.html)，这是一种相当自然的抽象。我经常使用 Coherence，它是一款出色的高性能产品，但并不便宜。兵马俑我不太熟悉。Coherence 的文档有时我觉得有点欠缺，但它确实是一个强大的产品。

OSCache 我主要用作减少 Java Web 应用程序中内存使用和碎片的一种方法，因为它具有相当简洁的 JSP 标记。如果您曾经看过编译过的 JSP，您会发现它们执行了很多字符串连接。此标记允许您有效地将一段 JSP 代码和 HTML 的结果缓存到单个字符串中，这在某些情况下可以极大地提高性能。

EHCache 是一个简单的缓存解决方案，我也在 Web 应用程序中使用过。虽然从不作为分布式缓存，但它可以做到这一点。我倾向于将其视为一种快速而肮脏的解决方案，但这可能是我的偏见。

memcached 在 PHP 世界中特别流行（并被 Facebook 等网站使用）。这是一个非常轻量级的解决方案，并且具有不在同一个进程中运行的优点，并且如果这对您很重要，您将可以与其他技术堆栈有更好的互操作性选项。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-21T22:06:28.100

您可能还想查看 Hazelcast。[Hazelcast](http://www.hazelcast.com)是队列、主题、映射、集合、列表、锁定和执行器服务的开源事务性、分布式/分区实现。使用起来超级容易；只需将 hazelcast.jar 添加到您的类路径中并开始编码。几乎不需要任何配置。

如果您对以分布式方式执行 Runnable、Callable 任务感兴趣，请查看[http://code.google.com/docreader/#p=hazelcast上的分布式执行器服务文档](http://code.google.com/docreader/#p=hazelcast)

[Hazelcast](http://www.hazelcast.com)是在 Apache 许可下发布的，并且还提供企业级支持。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-06-06T13:43:28.200

你考虑过[Infinispan](http://www.infinispan.org)吗？它是一个开源数据网格平台，来自 JBoss.org。有关更多详细信息，我建议您阅读宣布该项目的这篇（旧）[博客文章](http://infinispan.blogspot.com/2009/04/infinispan-start-of-new-era-in-open.html)，以及更多有趣的博客文章，包括一篇关于[将 Infinispan 与 Hibernate 结合使用](http://infinispan.blogspot.com/2009/10/infinispan-based-hibernate-cache.html)和作为[独立缓存](http://infinispan.blogspot.com/2010/02/infinispan-as-local-cache.html)的文章。甚至最近，在[Red Hat 的 Enterprise Data Grid](http://infinispan.blogspot.com/2011/05/red-hat-announces-enterprise-data-grid.html)上。有[一个快速的“入门”指南](http://community.jboss.org/wiki/5MinuteTutorialOnInfinispan)，还有一个[DZone RefCard](http://refcardz.dzone.com/refcardz/getting-started-infinispan)，甚至[还有一个 YouTube 视频](http://www.youtube.com/watch?v=9v07ehmXtM4):)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-21T02:08:58.470

我认为@cletus 的总结非常好。我确实想提一下，Terracotta 提供的不仅仅是地图形式的分布式缓存。它将 Java 堆和同步原语聚集在一起，将并发 Java 程序转变为分布式 Java 程序。您可以使用它进行缓存（包括使用开源缓存库的分布式版本）或其他一些东西。

对于工作分发，在 Terracotta 之上编写了一些额外的库，特别是 tim-pipes（用于消息）和 tim-masterworker（用于 Master-Worker 风格的分发）是 Terracotta 之上的伟大抽象。这个图书馆位于兵马俑锻造厂：

*   [http://forge.terracotta.org/releases/projects/tim-messaging/](http://forge.terracotta.org/releases/projects/tim-messaging/)

与其他一些潜在的数据技术相比，这个最近添加的页面可能会添加一些额外的信息：

*   [http://www.terracotta.org/web/display/orgsite/Terracotta+vs+Alternate+Technologies](http://www.terracotta.org/web/display/orgsite/Terracotta+vs+Alternate+Technologies)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-25T22:48:16.140

[JPPF](http://www.jppf.org/)也不错。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-21T13:50:51.877

如果你想稍微低一点，可以使用[JGroups](http://www.jgroups.org/)，它为你提供了集群 Java 进程的基础知识。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-05T13:47:57.883

您可以添加到列表中的另一个是[Appistry CloudIQ](http://www.appistry.com)。它是一个分布式计算环境。最多可[免费下载](http://www.appistry.com/developers/)5 台机器。它包括负载分配以及在硬件故障的情况下自动故障转移，以及其他功能。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-14T12:35:06.153

并检查[ProActive](http://proactive.inria.fr/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-07T13:53:25.373

对于网格计算，您还可以考虑[Ice Grid](http://www.zeroc.com/icegrid/index.html)或[DataSynapse GridServer](http://www.datasynapse.com/)。它们都为分配任务提供了非常有效的机制，并提供了故障转移和冗余。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-23T19:14:31.660

我认为您的问题已经以不同的方式进行了解释，您询问了一个可用于“集群启用”您的应用程序的库。

虽然上面提到的一些库可以帮助提供特定的集群功能，例如分布式缓存，但更传统的启用工作负载管理的方法是使用 J2EE 容器。

通过设置集群容器实例，您可以利用 HA 功能和工作负载管理，集群在应用程序级别几乎是透明的。我说几乎是因为在编写将要进行集群的应用程序时，您必须小心管理状态的方式，例如，如果您实现了某种缓存，则需要在每台机器上复制缓存的状态。

一个好的起点是下载 glassfish 并尝试设置集群 glassfish 实例。

希望有帮助。

卡尔

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-09-14T12:25:39.870

还要检查[Fura](http://fura.sourceforge.net/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-11-18T11:23:29.577

一个非常晚的答案——但这部分取决于您的应用程序的配置方式。您可能希望远程运行可执行文件，而不是使用上述方法之一。

*对缺少链接表示歉意——但在我的代表起来之前，我不能发布多个链接。斜体的产品应该很容易被谷歌搜索。*

如果你想在参数搜索中运行一个可执行文件——比如你想为每个实例使用一系列选项来启动同一个可执行文件——那么传统的批处理方法效果很好。这是一种非常传统的高性能计算方法，仍在广泛使用——适合在企业规模处理此问题的基础架构是*Platform LSF*、*DataSynapse GridServer*、*PBS*或随着它的成熟*Windows HPC Server*。您可能还想看看*Globus*和*Condor*等开源产品。根据您的应用程序有多大，您可能还会查看*gLite*，它用于大型科学项目，如 LHC。

传统 HPC 方法受益于将应用程序代码与构成计算基础架构的进程隔离开来，但可能会影响性能，而其他方法可能会显示更快的吞吐量，但容易出现内存泄漏和其他长时间运行系统的问题。

# language-agnostic - 消除彼此之间具有强烈概念联系的类的耦合

> ID：383921
> 
> 赞同：6
> 
> 时间：2008-12-21T00:10:28.037
> 
> 标签：language-agnostic

我有类型`Rock`,`Paper`和`Scissors`. 这些是石头剪刀布游戏的组成部分或“手”。给定两名玩家的手，游戏必须决定谁获胜。如何解决存储此链图的问题

![石头、纸、剪刀图](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Rock_paper_scissors.jpg/250px-Rock_paper_scissors.jpg)

没有将各种手相互耦合？目标是允许在游戏中添加新手（例如 Jon Skeet）而不改变任何其他手。

我对代理的任何想法持开放态度，但不接受大型 switch 语句或代码重复。例如，引入一种管理链比较的新类型就可以了，只要我不需要为我添加的每一手新牌都更改它。再说一次，如果你可以合理化拥有一个必须为每一手新手或当手改变时改变的代理，那也是受欢迎的。

这是一个设计 101 问题，但我很好奇人们可以为此提出什么解决方案。显然，这个问题可以很容易地扩展到更大的系统，其中包含更多的组件以及它们之间任意复杂的关系。这就是为什么我要放置一个非常简单而具体的例子来解决。欢迎使用任何使用的范式，OOP 或其他方式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T00:19:09.673

有一个实现 Win 方法的 GameStrategy 类。win 方法获取一手牌列表，并返回手牌——如果有赢家——或者如果游戏是平局，则返回 null。我认为获胜策略实际上并不是手牌的属性，而是游戏的属性。将一双手中获胜者的判断纳入 GameStrategy 类。

**编辑**：潜在战略

```
public enum RPSEnum { Rock, Paper, Scissors }

private RPSEnum FirtRPS = RPSEnum.Rock;
private RPSEnum LastRPS = RPSEnum.Scissors;

public Hand Win( Hand firstPlayer, Hand secondPlayer )
{
    if (firstPlayer.Value == FirstRPS
        && secondPlayer.Value == LastRPS)
    {
       return firstPlayer;
    }
    else if (secondPlayer.Value == FirstRPS
             && firstPlayer.Value == LastRPS)
       return secondPlayer;
    }
    else
    {
       int compare = (int)firstPlayer.Value - (int)secondPlayer.Value;
       if (compare > 0)
       {
          return firstPlayer;
       }
       else if (compare < 0)
       {
          return secondPlayer;
       }
       else
       {
          return null;
       }       
    }
} 
```

要添加新的手牌值，只需按正确的顺序将该值添加到 RPSEnum。如果是新的“最低”手，请更新 FirstRPS。如果是新的“最高”牌，请更新 LastRPS。您根本不需要更改实际算法。

注意：这比只需要三个值更复杂，但要求是能够在不更新太多代码的情况下添加其他值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T00:21:11.260

如果它们在概念上有足够的相似性，您可能不希望自己减少耦合。

“耦合”实际上只是衡量如果一件事的内部实现发生更改将有多少代码损坏的指标。如果这些东西的内部实现本质上对其他东西敏感，那么它就是；减少耦合很好，但软件首先应该反映现实。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T00:23:42.520

我不认为不同的手是不同的类型：它们是同一类型的不同实例。该类型具有名称、可能图片等属性。

您通过从数据中加载手牌名称列表和一个矩阵来初始化游戏，该矩阵给出了哪只手击败了每只手。也许数据会通过 Compare 方法加载到 Game 类中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T00:27:48.593

在这种情况下，重要的是如果你比较两个*对象*，你会得到一个*结果*。

因此，基本上，您需要以这样一种方式解耦这种比较，即您不仅可以将一种新类型的对象添加到混合中，还可以将比较规则添加到可以处理该对象的混合中。

现在，我还评论了你的问题，说“有时，问题可能*过于*笼统”，这里的问题是，无论我告诉你如何做*你所问的*，它对你一点帮助都没有真正的问题。

除非你正在构建一个石头剪刀布 X 游戏。

我个人会使用我自己的 IoC 容器执行以下操作。

```
ServiceContainer.Global.RegisterFactory<IHandType>()
    .FromDelegate(() => RandomRockScissorPaper());
ServiceContainer.Global.RegisterFactory<IHandComparison, DefaultHandComparison>(); 
```

（或者更确切地说，我会在 app.config 文件或类似文件中配置以上内容，以便在项目构建后可以更改）。

然后，如果用户/客户/端点需要覆盖以添加另一种类型，我将按如下方式增加注册（请记住，上面的内容在 app.config 中，所以我将用下面的内容替换它们）：

```
ServiceContainer.Global.RegisterFactory<IHandType>()
    .FromDelegate(() => RandomRockScissorPaper())
    .ForPolicy("original");
ServiceContainer.Global.RegisterFactory<IHandType>()
    .FromDelegate((IHandType original) => RandomRockScissorPaperBlubb(original))
    .WithParameters(
        new Parameter<IHandType>("original").WithPolicy("original"))
    .ForPolicy("new")
    .AsDefaultPolicy(); 
```

在这里，我添加了一种解决 IHandType 的新方法，不仅保留了原始方法，而且还添加了一个新方法。这个新的将被赋予调用旧的结果，然后必须在内部决定随机机会是否应该返回第四种类型，或者原始类型（三个原始类型之一）。

然后，我还将覆盖原始比较规则：

```
ServiceContainer.Global.RegisterFactory<IHandComparison, DefaultHandComparison>()
    .ForPolicy("original");
ServiceContainer.Global.RegisterFactory<IHandComparison, NewHandComparison>()
    .ForPolicy("new")
    .AsDefaultPolicy()
    .WithParameters(
        new Parameter<IHandType>("original")); 
```

以下是它的使用方法：

```
IHandType hand1 = ServiceContainer.Global.Resolve<IHandType>();
IHandType hand2 = ServiceContainer.Global.Resolve<IHandType>();
IHandComparison comparison = ServiceContainer.Global.Resolve<IHandComparison>();
if (comparison.Compare(hand1, hand2) < 0)
    Console.Out.WriteLine("hand 1 wins");
else if (comparison.Compare(hand1, hand2) > 0)
    Console.Out.WriteLine("hand 1 wins");
else
    Console.Out.WriteLine("equal"); 
```

以下是如何实现：

```
public interface IHandComparison
{
   Int32 Compare(IHandType hand1, IHandType hand2);
}
public class DefaultHandComparison : IHandComparison
{
    public Int32 Compare(IHandType hand1, IHandType hand2)
    {
        ... normal rules here
    }
}
public class NewHandComparison : IHandComparison
{
    private IHandComparison _Original;
    public NewHandComparison(IHandComparison original)
    {
        _Original = original;
    }
    public Int32 Compare(IHandType hand1, IHandType hand2)
    {
        if hand1 is blubb or hand2 is blubb then ...
        else
            return _Original.Compare(hand1, hand2);
    }
} 
```

写完这一切后，我意识到我的 app.config 配置将无法处理委托，因此需要一个工厂对象，但同样适用。

您既要能够解决获得新手的方式，又要解决获胜手的规则。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T00:29:21.680

为什么要解耦？这些元素在本质上都是相互联系的，增加一只新手不会改变这一点。

只需拥有一个由 Rock、Paper 和 Scissors 扩展的基本 Hand 类。为基类提供一个 .beatenby 属性，该属性采用 Hand 类型的其他类之一。如果您最终遇到一只手可以被多只手击败的情况，只需让 .beatenby 属性取一个数组即可。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T02:40:36.970

其他几个答案提供了非常灵活且非常解耦的解决方案......而且它们比它们需要的复杂得多*。*解耦的简短答案是[双重调度](http://en.wikipedia.org/wiki/Double_dispatch)，很少有语言原生支持。GoF 访问者模式的存在是为了在支持单分派的语言中模拟双分派（任何 OO 语言都支持这一点，即使是带有函数指针的 C 语言）。

这是一个稍大一点的例子。假设您正在监控 HTTP 流量，并且您正在尝试根据请求方法和响应代码的组合对模式进行分类。而不是看这个系列：

```
rock/paper
paper/scissors
paper/paper
... 
```

...你正在看这个系列：

```
GET/200
GET/304
POST/401
POST/200
... 
```

如果系统有`HttpRequest`和`HttpResponse`对象，最简单的调度方法是使用单个函数来路由到所有可能的选择：

```
HttpRequest req;
HttpResponse resp;
switch ((req.method, resp.code)) {
    case (GET, 200): return handleGET_OK(req, resp);
    case (GET, 304); return handleGET_NotModified(req, resp);
    case (POST, 404): return handlePOST_NotFound(req, resp);
    ...
    default: print "Unhandled combination"; break;
} 
```

这样，您的基础对象就不会受到添加新类型的影响。但是，您的分类方法仍然非常简单，因此可以为其他开发人员维护。如果您愿意（或者如果您的语言使它变得简单），您可以将该`switch`语句转换为某种函数映射，并在启动时注册处理程序不同的请求方法和响应代码组合。

# ruby-on-rails - Apache 在 FastCGI 虚拟主机上给出 400 错误

> ID：383927
> 
> 赞同：0
> 
> 时间：2008-12-21T00:20:59.513
> 
> 标签：ruby-on-rails, apache, cgi, fastcgi

每当我访问由 FastCGI 脚本处理的页面驱动时，Apache 都会吐出代码的 HTTP 响应：400 “Bad Request”，没有详细信息。

*   我已经安装了 mod_fcgid 模块，并在 Apache 配置文件中加载和配置了它
*   我测试了几个 FastCGI 脚本，它们都在直接执行时运行。
*   适当地提供静态资源。
*   Apache 正在尝试启动脚本，因为当我将 URL 重写为不存在的脚本时它会抱怨

有人知道我的 Apache Config 有什么问题吗？

```
<VirtualHost ip.ad.re.ss:80>
  ServerName   demo.domain.com:80 

  DocumentRoot /var/www/vhosts/domain.com/subdomains/demo/rails/public
  CustomLog  /var/www/vhosts/domain.com/statistics/logs/demo_access_log combined
  ErrorLog  /var/www/vhosts/domain.com/statistics/logs/demo_error_log
  LogLevel info
  Options +FollowSymLinks +ExecCGI -SymLinksIfOwnerMatch
  AddHandler fcgid-script .fcgi

  RewriteEngine On
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ dispatch.fcgi [QSA,L]
</VirtualHost> 
```

编辑——我检查了 mod_rewrite 日志并且 URI 被正确重写

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T23:08:09.723

Alright, one more thing to try.
[http://httpd.apache.org/docs/2.2/mod/core.html#loglevel](http://httpd.apache.org/docs/2.2/mod/core.html#loglevel).

Set the log level to debug and make sure this is not on a production machine because it produces a lot of output per individual event (get/put).

I think how your example above of FastCGI is missing something, but I admit its been a while since I've done anything but php or python fastcgi.
What language is dispatch.fcgi in? Can you execute it from the command line and does Apache have permission to execute the file? ( sudo su apacheaccount ).

Update: Knew you were missing something: check out -> [http://fastcgi.coremail.cn/configuration.htm](http://fastcgi.coremail.cn/configuration.htm) FCGIWrapper is needed to tell fast cgi what to use to execute your dispatch.fcgi file.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T04:43:40.327

尝试删除 DOCUMENT_ROOT 重写条件。其次，检查 mod_rewrite 日志指令，就此类奇怪的问题而言，它们非常有用。

# delphi - 如何从 delphi2007 win32 刻录 CD/DVD

> ID：383938
> 
> 赞同：9
> 
> 时间：2008-12-21T00:39:22.207
> 
> 标签：delphi, cddvd

有什么好的库可以让我从 Delphi 2007 win32 刻录 CD/DVD 吗？谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-21T00:51:02.497

我知道一对：

*   [Bayden 的 Delphi CD 刻录库](http://www.bayden.com/delphi/cdburner.htm)
*   [Dance Mammal 的](http://www.dancemammal.com/)免费 Delphi CD 刻录库
*   用于 Delphi 的 Zyl Burner（需要安装 Nero）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T08:33:37.570

~~我们正在使用[Magic CD/DVD Burner VCL](http://www.binarymagics.com/site/magic_cddvd_burner_vcl.html)，并且对它非常满意。~~

~~Binary Magic 还在制作一系列相关产品（蓝光刻录、.NET 版本、音频刻录...），因此请务必查看他们的[产品](http://www.binarymagics.com/site/products.html)页面。~~

编辑：我的共同开发人员告诉我，我们在使用 Magic CD/DVD 刻录机和更新的 DVD 刻录机时遇到问题，并且不可能从 Binary Magic 的支持中获得任何反馈 :( 所以你也许应该远离他们。

EDIT2：我们现在只是调用[CDBurnerXP](http://cdburnerxp.se/)命令行界面。它简单、有效并且会定期更新。

# php - 什么是 PHP 的 var_dump() 的 Python 等价物？

> ID：383944
> 
> 赞同：470
> 
> 时间：2008-12-21T00:43:36.800
> 
> 标签：php, python, debugging

在 PHP 中进行调试时，我经常发现在我的代码中简单地粘贴一个[var_dump()](http://php.net/var-dump)来向我展示变量是什么、它的值是什么以及它包含的任何内容都是有用的。

什么是好的 Python 等价物？

* * *

## 回答 #1

> 赞同：342
> 
> 时间：2010-05-22T17:21:46.997

我认为与PHP 的最佳等价物`var_dump($foo, $bar)`是结合：[`print`](https://docs.python.org/library/functions.html#print)[`vars`](https://docs.python.org/library/functions.html#vars)

```
print vars(foo),vars(bar) 
```

* * *

## 回答 #2

> 赞同：317
> 
> 时间：2008-12-21T00:59:03.900

要很好地显示一个值，您可以使用[pprint](http://docs.python.org/library/pprint.html)模块。用它转储所有变量的最简单方法是

```
from pprint import pprint

pprint(globals())
pprint(locals()) 
```

如果您在 CGI 中运行，一个有用的调试功能是[cgitb](http://docs.python.org/library/cgitb.html)模块，它显示局部变量的值作为回溯的一部分。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2012-05-22T10:58:36.880

最接近[PHP](http://en.wikipedia.org/wiki/PHP)的`var_dump()`是内置模块中`pprint()`的函数：`getmembers()``inspect`

```
from inspect import getmembers
from pprint import pprint
pprint(getmembers(yourObj)) 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-12-21T03:02:12.713

PHP 的[var_export()](http://php.net/manual/en/function.var-export.php)通常显示对象的序列化版本，可以通过 exec() 重新创建对象。在 Python 中最接近的是[repr()](http://docs.python.org/library/functions.html#repr)

“对于许多类型，此函数尝试返回一个字符串，该字符串在传递给 eval() [...] 时会产生具有相同值的对象”

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2013-08-30T08:00:52.103

我为 PHP 的 var_dump 编写了一个非常轻量级的替代方案，用于在 Python 中使用，并在稍后将其开源。

GitHub：[https ://github.com/sha256/python-var-dump](https://github.com/sha256/python-var-dump)

您可以使用以下方法简单地安装它[`pip`](http://pip.openplans.org/)：

```
pip install var_dump 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2008-12-22T21:26:04.390

所以我从这个问题和[另一个问题](https://stackoverflow.com/questions/192109/is-there-a-function-in-python-to-print-all-the-current-properties-and-values-of)中得到了答案，并在下面提出。我怀疑这对大多数人来说还不够 Pythonic，但我真的想要一些能让我深入了解某个未知变量的值的东西。我将不胜感激有关如何改进这一点或更容易实现相同行为的任何建议。

```
def dump(obj):
  '''return a printable representation of an object for debugging'''
  newobj=obj
  if '__dict__' in dir(obj):
    newobj=obj.__dict__
    if ' object at ' in str(obj) and not newobj.has_key('__type__'):
      newobj['__type__']=str(obj)
    for attr in newobj:
      newobj[attr]=dump(newobj[attr])
  return newobj 
```

这是用法

```
class stdClass(object): pass
obj=stdClass()
obj.int=1
obj.tup=(1,2,3,4)
obj.dict={'a':1,'b':2, 'c':3, 'more':{'z':26,'y':25}}
obj.list=[1,2,3,'a','b','c',[1,2,3,4]]
obj.subObj=stdClass()
obj.subObj.value='foobar'

from pprint import pprint
pprint(dump(obj)) 
```

和结果。

```
{'__type__': '<__main__.stdClass object at 0x2b126000b890>',
 'dict': {'a': 1, 'c': 3, 'b': 2, 'more': {'y': 25, 'z': 26}},
 'int': 1,
 'list': [1, 2, 3, 'a', 'b', 'c', [1, 2, 3, 4]],
 'subObj': {'__type__': '<__main__.stdClass object at 0x2b126000b8d0>',
            'value': 'foobar'},
 'tup': (1, 2, 3, 4)} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-02-15T00:03:31.117

老话题，但值得一试。

这是一个简单而有效的`var_dump`功能：

```
def var_dump(var, prefix=''):
    """
    You know you're a php developer when the first thing you ask for
    when learning a new language is 'Where's var_dump?????'
    """
    my_type = '[' + var.__class__.__name__ + '(' + str(len(var)) + ')]:'
    print(prefix, my_type, sep='')
    prefix += '    '
    for i in var:
        if type(i) in (list, tuple, dict, set):
            var_dump(i, prefix)
        else:
            if isinstance(var, dict):
                print(prefix, i, ': (', var[i].__class__.__name__, ') ', var[i], sep='')
            else:
                print(prefix, '(', i.__class__.__name__, ') ', i, sep='') 
```

样本输出：

```
>>> var_dump(zen)

[list(9)]:
    (str) hello
    (int) 3
    (int) 43
    (int) 2
    (str) goodbye
    [list(3)]:
        (str) hey
        (str) oh
        [tuple(3)]:
            (str) jij
            (str) llll
            (str) iojfi
    (str) call
    (str) me
    [list(7)]:
        (str) coucou
        [dict(2)]:
            oKey: (str) oValue
            key: (str) value
        (str) this
        [list(4)]:
            (str) a
            (str) new
            (str) nested
            (str) list 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-21T00:58:36.410

`print`

对于您自己的课程，只需定义一个`__str__`方法

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-22T11:38:10.987

我没有PHP经验，但对Python标准库有所了解。

出于您的目的，Python 有几种方法：

[日志记录](http://docs.python.org/library/logging.html)模块；

[称为pickle](http://docs.python.org/library/pickle.html)的对象序列化模块。您可以编写自己的 pickle 模块包装器。

如果您`var_dump`用于测试，Python 有自己的[doctest](http://docs.python.org/library/doctest.html)和[unittest](http://docs.python.org/library/unittest.html)模块。设计非常简单快捷。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-18T09:08:37.043

我使用自己编写的打印机类，但 dir() 也适用于输出实例字段/值。

```
class Printer:

       def __init__ (self, PrintableClass):
           for name in dir(PrintableClass):
               value = getattr(PrintableClass,name)
               if  '_' not in str(name).join(str(value)):
                    print '  .%s: %r' % (name, value) 
```

使用示例：

```
Printer(MyClass) 
```

# language-agnostic - “编程到接口”是什么意思？

> ID：383947
> 
> 赞同：880
> 
> 时间：2008-12-21T00:48:59.113
> 
> 标签：language-agnostic, oop, interface

我已经多次看到这句话，但我不清楚它的含义。您何时以及为什么要这样做？

我知道接口的作用，但我不清楚这一点让我觉得我错过了正确使用它们的机会。

如果你这样做是不是这样：

```
IInterface classRef = new ObjectWhatever() 
```

您可以使用任何实现的类`IInterface`？你什么时候需要这样做？我唯一能想到的是，如果您有一个方法并且您不确定将传递什么对象，除了它实现`IInterface`。我想不出你需要多久这样做一次。

另外，你怎么能写一个方法来接受一个实现接口的对象呢？那可能吗？

* * *

## 回答 #1

> 赞同：1769
> 
> 时间：2008-12-21T03:43:06.533

这里有一些关于接口和松散耦合代码、控制反转等问题的精彩答案。有一些相当令人兴奋的讨论，所以我想借此机会将事情分解一下，以了解为什么接口有用。

当我第一次接触接口时，我也对它们的相关性感到困惑。我不明白你为什么需要它们。如果我们使用 Java 或 C# 之类的语言，我们已经有了继承，我将接口视为一种*较弱*的继承形式，然后想，“何必呢？” 从某种意义上说，我是对的，您可以将接口视为一种弱继承形式，但除此之外，我最终通过将它们视为对由可能有许多不相关的对象类。

例如——假设你有一个 SIM 游戏并且有以下类：

```
class HouseFly inherits Insect {
    void FlyAroundYourHead(){}
    void LandOnThings(){}
}

class Telemarketer inherits Person {
    void CallDuringDinner(){}
    void ContinueTalkingWhenYouSayNo(){}
} 
```

显然，这两个对象在直接继承方面没有任何共同之处。但是，你可以说他们都很烦人。

假设我们的游戏需要有某种随机*的东西*，在玩家吃晚餐时会惹恼他们。这可能是 a`HouseFly`或 a`Telemarketer`或两者兼有——但是如何通过一个函数同时允许两者？您如何要求每种不同类型的对象以相同的方式“做他们烦人的事情”？

实现的关键是 a`Telemarketer`和`HouseFly`共享一个共同的松散解释的行为，即使它们在建模方面完全不同。所以，让我们创建一个两者都可以实现的接口：

```
interface IPest {
    void BeAnnoying();
}

class HouseFly inherits Insect implements IPest {
    void FlyAroundYourHead(){}
    void LandOnThings(){}

    void BeAnnoying() {
        FlyAroundYourHead();
        LandOnThings();
    }
}

class Telemarketer inherits Person implements IPest {
    void CallDuringDinner(){}
    void ContinueTalkingWhenYouSayNo(){}

    void BeAnnoying() {
        CallDuringDinner();
        ContinueTalkingWhenYouSayNo();
    }
} 
```

我们现在有两个类，每个类都可能以自己的方式令人讨厌。而且它们不需要从相同的基类派生并共享共同的固有特征——它们只需要满足契约`IPest`——契约很简单。你只需要`BeAnnoying`。在这方面，我们可以建模以下内容：

```
class DiningRoom {

    DiningRoom(Person[] diningPeople, IPest[] pests) { ... }

    void ServeDinner() {
        when diningPeople are eating,

        foreach pest in pests
        pest.BeAnnoying();
    }
} 
```

这里我们有一个餐厅，可以容纳一些食客和一些害虫——注意界面的使用。这意味着在我们的小世界中，`pests`数组的成员实际上可以是`Telemarketer`对象或`HouseFly`对象。

该`ServeDinner`方法在提供晚餐并且我们在餐厅的人应该吃饭时调用。在我们的小游戏中，这就是我们的害虫工作的时候——每个害虫都被指示通过`IPest`界面变得烦人。通过这种方式，我们可以很容易地同时拥有两者`Telemarketers`，并`HouseFlys`以各自的方式令人讨厌——我们只关心我们在`DiningRoom`对象中有什么是害虫，我们并不真正关心它是什么，他们可能什么都没有与其他共同。

这个非常人为的伪代码示例（拖的时间比我预期的要长得多）只是为了说明最终在我们何时可以使用界面方面为我打开了灯的那种东西。我提前为这个例子的愚蠢道歉，但希望它有助于你的理解。而且，可以肯定的是，您在这里收到的其他发布的答案确实涵盖了当今在设计模式和开发方法中使用接口的范围。

* * *

## 回答 #2

> 赞同：314
> 
> 时间：2008-12-21T01:35:31.563

我曾经给学生举的具体例子是他们应该写

```
List myList = new ArrayList(); // programming to the List interface 
```

代替

```
ArrayList myList = new ArrayList(); // this is bad 
```

这些在一个简短的程序中看起来完全一样，但是如果你`myList`在你的程序中继续使用 100 次，你就会开始看到不同之处。第一个声明确保您只调用接口`myList`定义的方法`List`（因此没有`ArrayList`特定的方法）。如果您以这种方式编程到界面，稍后您可以决定您确实需要

```
List myList = new TreeList(); 
```

你只需要在那个地方改变你的代码。您已经知道，您的代码的其余部分不会做任何会因更改*实现*而被破坏的事情，因为您已对*interface*进行了编程。

当您谈论方法参数和返回值时，好处更加明显（我认为）。以此为例：

```
public ArrayList doSomething(HashMap map); 
```

该方法声明将您与两个具体实现（`ArrayList`和`HashMap`）联系在一起。一旦从其他代码调用该方法，对这些类型的任何更改都可能意味着您也必须更改调用代码。对接口进行编程会更好。

```
public List doSomething(Map map); 
```

`List`现在，您返回哪种类型，或者`Map`作为参数传入哪种类型都无关紧要。您在`doSomething`方法中所做的更改不会强制您更改调用代码。

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2008-12-21T00:59:12.090

对接口进行编程是在说，“我需要这个功能，我不在乎它来自哪里。”

考虑（在 Java 中），`List`接口与`ArrayList`具体`LinkedList`类。如果我只关心我有一个包含多个数据项的数据结构，我应该通过迭代访问这些数据项，我会选择一个`List`（99% 的时间）。如果我知道我需要从列表的任一端进行恒定时间插入/删除，我可能会选择`LinkedList`具体的实现（或者更有可能使用[Queue](https://docs.oracle.com/javase/tutorial/collections/interfaces/queue.html)接口）。如果我知道我需要通过索引进行随机访问，我会选择`ArrayList`具体的类。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2012-07-19T19:34:27.343

对接口进行编程与我们在 Java 或 .NET 中看到的抽象接口完全无关。它甚至不是 OOP 概念。

这意味着不要乱搞对象或数据结构的内部。使用抽象程序接口或 API 与您的数据进行交互。在 Java 或 C# 中，这意味着使用公共属性和方法而不是原始字段访问。对于 C，这意味着使用函数而不是原始指针。

**编辑：**对于数据库，这意味着使用视图和存储过程而不是直接访问表。

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2008-12-21T01:20:22.793

除了消除类之间不必要的耦合之外，使用接口是使代码易于测试的关键因素。通过创建一个定义类操作的接口，您允许想要使用该功能的类能够使用它，而无需直接依赖于您的实现类。如果稍后您决定更改并使用不同的实现，您只需更改实例化实现的代码部分。其余代码不需要更改，因为它取决于接口，而不是实现类。

这在创建单元测试时非常有用。在被测类中，它依赖于接口，并通过构造函数或属性设置器将接口实例注入类（或允许它根据需要构建接口实例的工厂）。该类在其方法中使用提供的（或创建的）接口。当你开始编写测试时，你可以模拟或伪造接口，并提供一个接口来响应单元测试中配置的数据。您可以这样做，因为您的测试类只处理接口，而不是您的具体实现。任何实现接口的类，包括你的模拟类或假类，都可以。

**编辑：**下面是一篇文章的链接，其中 Erich Gamma 讨论了他的引语“编程到接口，而不是实现”。

[http://www.artima.com/lejava/articles/designprinciples.html](http://www.artima.com/lejava/articles/designprinciples.html)

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2008-12-21T00:58:46.707

您应该研究控制反转：

*   [Martin Fowler：控制容器的反转和依赖注入模式](http://martinfowler.com/articles/injection.html)
*   [维基百科：控制反转](http://en.wikipedia.org/wiki/Inversion_of_Control)

在这种情况下，您不会这样写：

```
IInterface classRef = new ObjectWhatever(); 
```

你会写这样的东西：

```
IInterface classRef = container.Resolve<IInterface>(); 
```

这将进入对象中基于规则的设置`container`，并为您构建实际对象，它可以是 ObjectWhatever。重要的是你可以用完全使用另一种对象的东西来替换这个规则，你的代码仍然可以工作。

如果我们不考虑 IoC，您可以编写知道它可以与*执行特定*操作的对象通信的代码，但不知道是哪种类型的对象或它是如何实现的。

这在传递参数时会派上用场。

至于带括号的问题“另外，你怎么能写一个方法来接受一个实现接口的对象？这可能吗？”，在 C# 中，你只需使用接口类型作为参数类型，如下所示：

```
public void DoSomethingToAnObject(IInterface whatever) { ... } 
```

这直接插入“与执行特定操作的对象交谈”。上面定义的方法知道对对象的期望，它实现了 IInterface 中的所有内容，但它不关心它是哪种类型的对象，只关心它遵守约定，即接口是什么。

例如，您可能熟悉计算器，并且在您的日子里可能使用过不少，但大多数时候它们都是不同的。另一方面，您知道标准计算器应该如何工作，因此您可以全部使用它们，即使您不能使用每个计算器所具有的其他计算器所没有的特定功能。

这就是界面的美妙之处。您可以编写一段代码，它知道它将获取传递给它的对象，它可以期待某些行为。它并不关心它是什么类型的对象，只关心它支持所需的行为。

让我给你一个具体的例子。

我们有一个为 Windows 窗体定制的翻译系统。该系统循环遍历表单上的控件并翻译每个控件中的文本。系统知道如何处理基本控件，例如具有文本属性的控件类型和类似的基本内容，但对于任何基本的东西，它都达不到要求。

现在，由于控件继承自我们无法控制的预定义类，我们可以做以下三件事之一：

1.  为我们的翻译系统构建支持，以具体检测它正在使用哪种类型的控件，并翻译正确的位（维护噩梦）
2.  在基类中构建支持（不可能，因为所有控件都继承自不同的预定义类）
3.  添加接口支持

所以我们做了nr。3\. 我们所有的控件都实现了 ILocalizable，它是一个接口，它为我们提供了一种方法，能够将“自身”翻译成翻译文本/规则的容器。因此，表单不需要知道它找到了哪种控件，只需知道它实现了特定的接口，并且知道它可以调用一个方法来本地化控件。

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2016-04-14T19:36:55.607

**接口代码而不是实现与 Java 无关，也与它的接口构造无关。**

这个概念在 Patterns / Gang of Four 书中得到了突出，但很可能在此之前就已经存在了。*这个概念肯定早在 Java 出现之前就已经存在了。*

Java 接口结构的创建是为了帮助实现这个想法（除其他外），人们过于关注结构作为意义的中心，而不是最初的意图。然而，这就是我们在 Java、C++、C# 等中拥有公共和私有方法和属性的原因。

这意味着只与对象或系统的公共接口交互。不要担心，甚至不要预测它是如何在内部完成的。不要担心它是如何实现的。在面向对象的代码中，这就是我们有公共与私有方法/属性的原因。我们打算使用公共方法，因为私有方法仅用于在类内部使用。它们构成了类的实现，可以根据需要进行更改，而无需更改公共接口。假设关于功能，每次使用相同的参数调用类上的方法时，都会执行相同的操作并获得相同的预期结果。它允许作者改变类的工作方式和实现，而不会破坏人们与它的交互方式。

*而且您可以对接口进行编程，而不是在不使用接口构造的情况下对实现进行编程。*您可以对接口进行编程，而不是在没有接口构造的 C++ 中实现。只要两个大型企业系统通过公共接口（合同）进行交互，而不是调用系统内部对象的方法，您就可以更加健壮地集成两个大型企业系统。给定相同的输入参数，期望接口始终以相同的预期方式做出反应；如果实现到接口而不是实现。这个概念在很多地方都有效。

动摇 Java 接口与“程序到接口，而不是实现”的概念有任何关系的想法。他们可以帮助应用这个概念，但它们**不是**这个概念。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2008-12-21T04:45:12.710

听起来您了解接口的工作原理，但不确定何时使用它们以及它们提供什么优势。以下是一些接口何时有意义的示例：

```
// if I want to add search capabilities to my application and support multiple search
// engines such as Google, Yahoo, Live, etc.

interface ISearchProvider
{
    string Search(string keywords);
} 
```

然后我可以创建 GoogleSearchProvider、YahooSearchProvider、LiveSearchProvider 等。

```
// if I want to support multiple downloads using different protocols
// HTTP, HTTPS, FTP, FTPS, etc.
interface IUrlDownload
{
    void Download(string url)
}

// how about an image loader for different kinds of images JPG, GIF, PNG, etc.
interface IImageLoader
{
    Bitmap LoadImage(string filename)
} 
```

然后创建 JpegImageLoader、GifImageLoader、PngImageLoader 等。

大多数加载项和插件系统都在接口上工作。

另一个流行的用途是存储库模式。假设我想加载来自不同来源的邮政编码列表

```
interface IZipCodeRepository
{
    IList<ZipCode> GetZipCodes(string state);
} 
```

然后我可以创建一个 XMLZipCodeRepository、SQLZipCodeRepository、CSVZipCodeRepository 等。对于我的 Web 应用程序，我经常在早期创建 XML 存储库，这样我就可以在 SQL 数据库准备好之前启动并运行一些东西。数据库准备好后，我编写一个 SQLRepository 来替换 XML 版本。我的其余代码保持不变，因为它仅在接口之外运行。

方法可以接受以下接口：

```
PrintZipCodes(IZipCodeRepository zipCodeRepository, string state)
{
    foreach (ZipCode zipCode in zipCodeRepository.GetZipCodes(state))
    {
        Console.WriteLine(zipCode.ToString());
    }
} 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2013-04-15T13:05:47.450

那里有很多解释，但要使它更简单。以一个`List`. 可以使用以下方式实现列表：

1.  内部数组
2.  一个链表
3.  其他实现

通过构建一个接口，比如说一个`List`. 您只对 List 的定义或实际`List`含义进行编码。

您可以在内部使用任何类型的实现，比如`array`实现。但是假设您出于某种原因希望更改实现，例如错误或性能。然后你只需要将声明更改`List<String> ls = new ArrayList<String>()`为`List<String> ls = new LinkedList<String>()`.

代码中没有其他地方，您是否必须更改其他任何内容？因为其他一切都是建立在`List`.

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2008-12-21T01:07:05.957

当您拥有一组类似的类时，它使您的代码更具可扩展性和更易于维护。我是一名初级程序员，所以我不是专家，但我刚刚完成了一个需要类似内容的项目。

我从事与运行医疗设备的服务器通信的客户端软件。我们正在开发该设备的新版本，其中包含客户有时必须配置的一些新组件。有两种类型的新组件，它们是不同的，但它们也非常相似。基本上，我必须创建两个配置表单，两个列表类，两个。

我决定最好为每个控件类型创建一个抽象基类，该基类将包含几乎所有的真实逻辑，然后派生类型来处理两个组件之间的差异。但是，如果我必须一直担心类型，则基类将无法对这些组件执行操作（好吧，它们可以有，但每个方法中都会有一个“if”语句或 switch） .

我为这些组件定义了一个简单的接口，所有的基类都与这个接口通信。现在，当我更改某些内容时，它几乎在任何地方都“正常工作”，而且我没有代码重复。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-12-21T01:20:57.067

如果您使用 Java 编程，JDBC 就是一个很好的例子。JDBC 定义了一组接口，但对实现只字未提。您的应用程序可以针对这组接口编写。理论上，您选择一些 JDBC 驱动程序，您的应用程序就可以正常工作。如果您发现有更快或“更好”或更便宜的 JDBC 驱动程序或出于任何原因，理论上您可以再次重新配置您的属性文件，并且无需对您的应用程序进行任何更改，您的应用程序仍然可以工作。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2008-12-21T01:52:52.853

接口编程很棒，它促进了松散耦合。正如@lassevk 提到的，控制反转是一个很好的用途。

**此外，查看 SOLID principals**。[这是一个视频系列](http://dimecasts.net/Casts/ByTag/SOLID%20Principle)

它通过一个硬编码（强耦合示例）然后查看接口，最后进入一个 IoC/DI 工具（NInject）

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2016-01-01T16:00:31.940

我是这个问题的迟到者，但我想在这里提一下，“编程到接口，而不是实现”这一行在 GoF（四人组）设计模式书中进行了一些很好的讨论。

它说，在第。18:

> **编程到接口，而不是实现**
> 
> 不要将变量声明为特定具体类的实例。相反，只提交到由抽象类定义的接口。你会发现这是本书中设计模式的一个共同主题。

除此之外，它开始于：

> 仅根据抽象类定义的接口来操作对象有两个好处：
> 
> 1.  只要对象遵循客户期望的接口，客户就不会知道他们使用的特定类型的对象。
> 2.  客户仍然不知道实现这些对象的类。客户只知道定义接口的抽象类。

所以换句话说，不要把它写成你的类，让它有一个`quack()`鸭子的方法，然后一个`bark()`狗的方法，因为它们对于一个类（或子类）的特定实现来说太具体了。相反，使用足以在基类中使用的通用名称编写方法，例如`giveSound()`or `move()`，以便它们可以用于鸭子、狗甚至汽车，然后您的类的客户端可以只说`.giveSound()`而不是在发出要发送到对象的正确消息之前考虑是否使用`quack()`甚至确定类型。`bark()`

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-12-21T01:08:55.033

为了添加到现有帖子中，有时当开发人员同时处理单独的组件时，对接口进行编码有助于大型项目。您所需要的只是预先定义接口并向它们编写代码，而其他开发人员则向您正在实现的接口编写代码。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2010-04-28T16:44:22.457

如果我正在编写一个新类`Swimmer`来添加功能`swim()`并且需要使用类的对象说`Dog`，并且这个`Dog`类实现`Animal`了声明的接口`swim()`。

在层次结构的顶部 ( `Animal`)，它非常抽象，而在底部 ( `Dog`)，它非常具体。我对“接口编程”的看法是，当我编写`Swimmer`类时，我想针对该层次结构中的接口编写我的代码，在这种情况下是一个`Animal`对象。接口没有实现细节，因此使您的代码松散耦合。

实现细节可以随着时间而改变，但是，它不会影响剩余的代码，因为你所交互的只是接口而不是实现。你不关心实现是什么样的......你所知道的是会有一个实现接口的类。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2017-07-03T19:36:21.633

即使我们不依赖抽象，对接口进行编程也是有利的。

对接口进行编程**迫使我们使用对象的上下文适当的子集**。这很有帮助，因为它：

1.  阻止我们做不符合上下文的事情，并且
2.  让我们在未来安全地更改实现。

例如，考虑一个`Person`实现`Friend`和`Employee`接口的类。

```
class Person implements AbstractEmployee, AbstractFriend {
} 
```

在此人生日的上下文中，我们对`Friend`界面进行编程，以防止将人视为`Employee`.

```
function party() {
    const friend: Friend = new Person("Kathryn");
    friend.HaveFun();
} 
```

在人的工作环境中，我们对`Employee`界面进行编程，以防止工作场所界限模糊。

```
function workplace() {
    const employee: Employee = new Person("Kathryn");
    employee.DoWork();
} 
```

伟大的。我们在不同的环境中表现得恰到好处，我们的软件运行良好。

在遥远的未来，如果我们的业务改变为与狗一起工作，我们可以相当容易地改变软件。首先，我们创建一个`Dog`同时实现`Friend`和的类`Employee`。然后，我们安全地更改`new Person()`为`new Dog()`. 即使这两个函数都有数千行代码，这个简单的编辑也可以工作，因为我们知道以下情况是正确的：

1.  函数`party`仅使用 的`Friend`子集`Person`。
2.  函数`workplace`仅使用 的`Employee`子集`Person`。
3.  类`Dog`实现了`Friend`和`Employee`接口。

另一方面，如果其中一个`party`或`workplace`将要针对 进行编程，则两者都存在特定代码`Person`的风险。`Person`从 更改`Person`为`Dog`需要我们梳理代码以消除任何不支持的`Person`特定代码。`Dog`

**道德**：对接口进行编程有助于我们的代码表现得恰当并为变化做好准备。它还使我们的代码准备好依赖于抽象，这带来了更多的优势。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-01-08T21:12:54.723

它对单元测试也有好处，您可以将自己的类（满足接口要求）注入到依赖于它的类中

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2014-08-08T10:25:26.157

短篇小说：一个邮递员被要求一个接一个地回家并收到包含（信件、文件、支票、礼品卡、申请、情书）的封面，上面写着要投递的地址。

假设没有掩护，让邮递员一个接一个地回家，把所有的东西都收到并交付给其他人，邮递员可能会感到困惑。

所以最好用封面包裹它（在我们的故事中它是界面）然后他会做得很好。

现在邮递员的工作是只接收和交付封面（他不会打扰封面里面的东西）。

创建一个`interface`非实际类型的类型，但用实际类型实现它。

创建接口意味着您的组件可以**轻松融入其余代码**

我给你一个例子。

你有如下的 AirPlane 界面。

```
interface Airplane{
    parkPlane();
    servicePlane();
} 
```

假设您的平面控制器类中有方法，例如

```
parkPlane(Airplane plane) 
```

和

```
servicePlane(Airplane plane) 
```

在您的程序中实施。它不会**破坏**您的代码。我的意思是，只要它接受参数为`AirPlane`.

因为它会接受任何飞机，不管实际类型、`flyer`、`highflyr`、`fighter`等。

此外，在一个集合中：

`List<Airplane> plane;`// 将带走你所有的飞机。

下面的例子将清楚你的理解。

* * *

你有一架战斗机来实现它，所以

```
public class Fighter implements Airplane {

    public void  parkPlane(){
        // Specific implementations for fighter plane to park
    }
    public void  servicePlane(){
        // Specific implementatoins for fighter plane to service.
    }
} 
```

HighFlyer 和其他课程也是如此：

```
public class HighFlyer implements Airplane {

    public void  parkPlane(){
        // Specific implementations for HighFlyer plane to park
    }

    public void  servicePlane(){
        // specific implementatoins for HighFlyer plane to service.
    }
} 
```

现在想想你的控制器类使用`AirPlane`了几次，

假设您的 Controller 类是 ControlPlane，如下所示，

```
public Class ControlPlane{ 
 AirPlane plane;
 // so much method with AirPlane reference are used here...
} 
```

魔法来了，因为您可以根据需要创建任意数量的新`AirPlane`类型实例，并且您不会更改`ControlPlane`类的代码。

您可以添加一个实例...

```
JumboJetPlane // implementing AirPlane interface.
AirBus        // implementing AirPlane interface. 
```

您也可以删除以前创建的类型的实例。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2008-12-21T01:46:00.043

想象一下，您有一个可以通过插件扩展的名为“Zebra”的产品。它通过在某个目录中搜索 DLL 来找到插件。它加载所有这些 DLL 并使用反射来查找任何实现的类，`IZebraPlugin`然后调用该接口的方法与插件进行通信。

这使得它完全独立于任何特定的插件类——它不关心这些类是什么。它只关心它们是否满足接口规范。

接口是一种像这样定义可扩展点的方式。与接口对话的代码更松散耦合——事实上，它根本不与任何其他特定代码耦合。它可以与多年后从未见过原始开发人员的人编写的插件互操作。

您可以改为使用具有虚函数的基类 - 所有插件都将从基类派生。但这更具限制性，因为一个类只能有一个基类，而它可以实现任意数量的接口。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-12-21T04:17:54.123

在 Java 中，这些具体的类都实现了 CharSequence 接口：

> 字符缓冲区、字符串、字符串缓冲区、字符串生成器

这些具体的类除了 Object 之外没有共同的父类，因此没有任何东西与它们相关，除了它们每个都与字符数组有关、表示字符数组或操作字符数组有关。例如，String 对象一旦实例化就不能更改其字符，而 StringBuffer 或 StringBuilder 的字符是可以编辑的。

然而，这些类中的每一个都能够适当地实现 CharSequence 接口方法：

```
char charAt(int index)
int length()
CharSequence subSequence(int start, int end)
String toString() 
```

在某些情况下，过去接受 String 的 Java 类库类已被修改为现在接受 CharSequence 接口。所以如果你有一个 StringBuilder 的实例，而不是提取一个 String 对象（这意味着实例化一个新的对象实例），它可以只传递 StringBuilder 本身，因为它实现了 CharSequence 接口。

对于可以将字符附加到底层具体类对象实例的实例的任何情况，某些类实现的 Appendable 接口具有相同的好处。所有这些具体类都实现了 Appendable 接口：

> BufferedWriter、CharArrayWriter、CharBuffer、FileWriter、FilterWriter、LogStream、OutputStreamWriter、PipedWriter、PrintStream、PrintWriter、StringBuffer、StringBuilder、StringWriter、Writer

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-12-21T22:05:50.037

因此，为了做到这一点，接口的优点是我可以将方法的调用与任何特定的类分开。而是创建接口的实例，其中实现是从我选择的实现该接口的任何类中给出的。因此允许我拥有许多类，它们具有相似但略有不同的功能，并且在某些情况下（与接口意图相关的情况）不关心它是哪个对象。

例如，我可以有一个运动界面。可以传递使某物“移动”的方法以及实现移动接口的任何对象（Person、Car、Cat）并被告知移动。如果没有方法，每个人都知道它是类的类型。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2012-12-18T22:35:36.053

C++ 解释。

将接口视为您的类的公共方法。

然后，您可以创建一个“依赖于”这些公共方法的模板，以执行它自己的功能（它使函数调用在类公共接口中定义）。假设这个模板是一个容器，就像一个 Vector 类，它所依赖的接口是一个搜索算法。

任何定义函数/接口 Vector 调用的算法类都将满足“合同”（正如原始回复中所解释的那样）。算法甚至不需要属于同一个基类；唯一的要求是 Vector 所依赖的函数/方法（接口）在您的算法中定义。

所有这一切的重点是，您可以提供任何不同的搜索算法/类，只要它提供了 Vector 所依赖的接口（冒泡搜索、顺序搜索、快速搜索）。

您可能还想设计其他容器（列表、队列），通过让它们满足您的搜索算法所依赖的接口/契约来利用与 Vector 相同的搜索算法。

这可以节省时间（OOP 原则“代码重用”），因为您可以一次又一次地编写算法，而不是一次又一次地针对您创建的每个新对象编写算法，而不会因继承树过度复杂化问题。

至于“错过”事物的运作方式；大时代（至少在 C++ 中），因为这是大多数标准模板库框架的操作方式。

当然，当使用继承和抽象类时，对接口进行编程的方法会发生变化；但原理是一样的，你的公共函数/方法就是你的类接口。

这是一个巨大的话题，也是设计模式的基石原则之一。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2014-03-09T06:17:46.800

> 问： - ...“你能使用任何实现接口的类吗？”
> 答： - 是的。
> 
> 问：- ...“你什么时候需要这样做？”
> 答： - 每次您需要一个实现接口的类时。

**注意：** *我们无法实例化未由类实现的接口*-**是的。**

*   为什么？
*   因为接口只有方法原型，没有定义（只有函数名，没有它们的逻辑）

> `AnIntf anInst = new Aclass();`
> //***只有当****Aclass 实现 AnIntf​​ 时，**我们才能这样做。* **// anInst 将具有 Aclass 引用。**

 *** * *

**注意：** *现在我们可以理解如果 Bclass 和 Cclass 实现相同的 Dintf 会发生什么。*

```
Dintf bInst = new Bclass();  
// now we could call all Dintf functions implemented (defined) in Bclass.

Dintf cInst = new Cclass();  
// now we could call all Dintf functions implemented (defined) in Cclass. 
```

**我们拥有：**相同的接口原型（接口中的函数名称），并调用不同的实现。

*参考书目：* [原型 - 维基百科](https://en.wikipedia.org/wiki/Function_prototype)

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2016-05-27T10:44:19.630

接口就像一个合同，您希望您的实现类在其中实现合同（接口）中编写的方法。由于Java不提供多重继承，“编程到接口”是实现多重继承的好方法。

如果您的 A 类已经在扩展其他 B 类，但您希望该 A 类也遵循某些准则或实现某个约定，那么您可以通过“编程到接口”策略来实现。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2020-02-02T08:07:02.063

program to an interface 是 GOF 书中的一个术语。我不会直接说它与 java 接口有关，而是与真正的接口有关。要实现干净的层分离，您需要在系统之间创建一些分离，例如：假设您有一个要使用的具体数据库，您永远不会“编程到数据库”，而是“编程到存储接口”。同样，您永远不会“编程到 Web 服务”，而是会编程到“客户端接口”。这样您就可以轻松地换掉东西。

我发现这些规则对我有帮助：

**1** . 当我们有多种类型的对象时，我们使用 java 接口。如果我只有一个对象，我不明白这一点。如果某个想法至少有两个具体实现，那么我将使用 java 接口。

**2** . 如果如上所述，您想将外部系统（存储系统）的解耦带到您自己的系统（本地数据库），那么也可以使用接口。

请注意如何有两种方法来考虑何时使用它们。希望这可以帮助。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2021-08-02T18:29:25.413

为了可扩展性和松散耦合，以前的答案侧重于抽象编程。虽然这些都是非常重要的点，但 **可读性**同样重要。可读性允许其他人（以及你未来的自己）以最小的努力理解代码。这就是可读性利用抽象的原因。

根据定义，抽象比其实现更简单。抽象省略细节以传达事物的本质或目的，但仅此而已。因为抽象更简单，与实现相比，我可以一次在脑海中容纳更多的抽象。

`List`作为一名程序员（使用任何语言），我总是在脑海中带着一个大致的概念四处走动。特别是，a`List`允许随机访问、重复元素并保持顺序。当我看到这样的声明时：`List myList = new ArrayList()`我认为，*很酷*，这是以`List`我理解的（基本）方式使用的；我不必再考虑了。

另一方面，我并没有`ArrayList`在脑海中随身携带具体的实现细节。所以当我看到，`ArrayList myList = new ArrayList()`. 我认为，*呃，哦*，这`ArrayList`必须以`List`界面未涵盖的方式使用。现在我必须追踪它的所有用法`ArrayList`以了解原因，否则我将无法完全理解这段代码。`ArrayList` *当我发现它 100% 的用法确实*符合`List`接口时，它变得更加混乱。然后我想知道......是否有一些依赖于`ArrayList`被删除的实现细节的代码？实例化它的程序员只是不称职吗？此应用程序是否在运行时以某种方式锁定到该特定实现？一种我不明白的方式？

我现在对这个应用程序感到困惑和不确定，我们所谈论的只是一个简单的`List`. 如果这是一个忽略其接口的复杂业务对象怎么办？那么我的业务领域知识不足以理解代码的用途。

因此，即使我需要一个`List`严格的`private`方法（如果它发生更改，不会破坏其他应用程序，并且我可以轻松地找到/替换我的 IDE 中的每个用法），它仍然有利于编程到抽象的可读性。因为抽象比实现细节更简单。你可以说对抽象进行编程是遵循[KISS](https://en.wikipedia.org/wiki/KISS_principle)原则的一种方式。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2016-12-27T16:29:14.250

**对接口的编程**允许无缝地更改接口定义的合约的实现。它允许合约和特定实现之间的松散耦合。

> `IInterface classRef = new ObjectWhatever()`
> 
> 您可以使用任何实现 IInterface 的类吗？你什么时候需要这样做？

看看这个 SE question 作为一个很好的例子。

[为什么首选 Java 类的接口？](https://stackoverflow.com/questions/147468/why-should-the-interface-for-a-java-class-be-prefered/41347099#41347099)

> 使用接口会影响性能吗？
> 
> 如果有，多少钱？

是的。它将在亚秒内产生轻微的性能开销。但是如果您的应用程序需要动态更改接口的实现，请不要担心性能影响。

> 如何避免它而不必维护两位代码？

如果您的应用程序需要它们，请不要尝试避免接口的多个实现。在没有接口与一个特定实现紧密耦合的情况下，您可能必须部署补丁才能将一个实现更改为另一个实现。

一个很好的用例：策略模式的实现：

[策略模式的真实示例](https://stackoverflow.com/questions/370258/real-world-example-of-the-strategy-pattern/35180265#35180265)

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2018-07-30T15:55:21.317

“程序到接口”意味着不要以正确的方式提供硬代码，这意味着您的代码应该在不破坏以前功能的情况下进行扩展。只是扩展，而不是编辑以前的代码。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-12-18T13:23:31.667

我也在这里看到了很多很好的解释性答案，所以我想在这里给出我的观点，包括我在使用这种方法时注意到的一些额外信息。

**单元测试**

在过去的两年里，我写了一个爱好项目，但我没有为它写单元测试。在写了大约 50K 行之后，我发现编写单元测试真的很有必要。我没有使用接口（或者很少使用）……当我进行第一次单元测试时，我发现它很复杂。为什么？

因为我必须制作很多类实例，用作类变量和/或参数的输入。所以这些测试看起来更像是集成测试（必须建立一个完整的类“框架”，因为所有这些都被捆绑在一起）。

**害怕接口** 所以我决定使用接口。我担心我必须多次在所有地方（在所有使用的类中）实现所有功能。在某种程度上这是正确的，但是，通过使用继承可以减少很多。

**接口和继承** 的结合我发现这种结合非常好用。我举一个非常简单的例子。

```
public interface IPricable
{
    int Price { get; }
}

public interface ICar : IPricable

public abstract class Article
{
    public int Price { get { return ... } }
}

public class Car : Article, ICar
{
    // Price does not need to be defined here
} 
```

这种方式不需要复制代码，同时仍然具有使用汽车作为接口 (ICar) 的好处。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-08-05T23:48:47.393

让我们首先从一些定义开始：

**接口** ***n.*** 由对象的操作定义的所有签名的集合称为对象的接口

**键入** ***n。***特定的接口

**上面定义的接口**的一个简单示例是所有 PDO 对象方法，例如`query()`、等，作为一个整体，而不是单独的。这些方法，即它的接口定义了完整的消息集，可以发送到对象的请求。`commit()``close()`

上面定义的**类型**是一个特定的接口。我将使用拼好的形状界面来演示：`draw()`、`getArea()`等`getPerimeter()`。

如果一个对象是数据库类型，我们的意思是它接受数据库接口的消息/请求`query()`等`commit()`。对象可以是多种类型。只要数据库对象实现了它的接口，你就可以拥有一个 shape 类型的数据库对象，在这种情况下，这将是**sub-typing**。

许多对象可以具有许多不同的接口/类型，并以不同的方式实现该接口。这允许我们替换对象，让我们选择使用哪一个。也称为多态性。

客户端只知道接口而不知道实现。

因此，本质上对接口进行编程将涉及制作某种类型的抽象类，例如`Shape`仅指定接口的 ie `draw()`、`getCoordinates()`等`getArea()`。然后让不同的具体类实现这些接口，例如 Circle 类、Square 类、Triangle 类。**因此编程到接口而不是实现。**

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2019-03-26T18:11:42.467

我坚信应该用简单的现实答案来解释难题。在软件设计领域，它非常重要。

看看你家、学校、教堂……任何**建筑物的任何****门**。

 **想象一下有些**门**的**危险是右下角**（所以你必须鞠躬才能与门互动，门是打开还是关闭），

或者其他人只是在**左上角**（所以，一些侏儒、残疾人或凯文哈特不会觉得这样的门很有趣和有用）。

所以**设计**是关键词，为其他**人**创建程序可以**开发/使用它。**

这样做`Interfaces`的目的是让大型项目中的其他初级/高级开发人员更容易^(**[1]**)，所以每个人都知道他们在做什么，而无需其他人的帮助，这样你就可以尽可能顺利地工作（在理论上）。

* * *

[**[1]：如何？通过暴露价值的*形状*。因此，您不需要文档，因为代码本身是不言自明的（真棒）。**]

* * *

[这个答案并不是针对特定语言而不是概念驱动的（毕竟，**人类**是通过编写代码来创建工具的）。]

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2014-12-19T13:15:41.533

下面是一个简单的示例，用于说明您编写航班预订系统时的情况。

```
//This interface is very flexible and abstract
    addPassenger(Plane seat, Ticket ticket); 

//Boeing is implementation of Plane
    addPassenger(Boeing747 seat, EconomyTicket ticket); 
    addPassenger(Cessna, BusinessClass ticket);

    addPassenger(J15, E87687); 
```

# python - 返回给定字符串语言的最佳方法

> ID：383966
> 
> 赞同：7
> 
> 时间：2008-12-21T01:12:56.913
> 
> 标签：python, algorithm, string

更具体地说，我正在尝试检查给定的字符串（一个句子）是否是土耳其语。

我可以检查字符串是否包含土耳其语字符，例如 Ç、Ş、Ü、Ö、Ğ 等。但这不是很可靠，因为在我收到字符串之前，这些字符可能会转换为 C、S、U、O、G。

另一种方法是使用土耳其语中最常用的 100 个单词，并检查句子是否包含这些单词中的任何/一些。我可以结合这两种方法并使用积分系统。

你认为用 Python 解决我的问题最有效的方法是什么？

相关问题：（[人类）文档语言](https://stackoverflow.com/questions/257125/human-language-of-a-document)（Perl、Google Translation API）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-21T01:40:58.680

一种选择是使用贝叶斯分类器，例如[Reverend](http://www.divmod.org/trac/wiki/DivmodReverend)。Reverend 主页给出了一个简单的语言检测器的建议：

```
from reverend.thomas import Bayes
guesser = Bayes()
guesser.train('french', 'le la les du un une je il elle de en')
guesser.train('german', 'der die das ein eine')
guesser.train('spanish', 'el uno una las de la en')
guesser.train('english', 'the it she he they them are were to')
guesser.guess('they went to el cantina')
guesser.guess('they were flying planes')
guesser.train('english', 'the rain in spain falls mainly on the plain')
guesser.save('my_guesser.bay') 
```

使用更复杂的令牌集进行训练将加强结果。有关贝叶斯分类的更多信息，[请参见此处](http://en.wikipedia.org/wiki/Bayesian_analysis)和[此处](http://en.wikipedia.org/wiki/Naive_Bayesian_classification)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-21T03:32:36.833

我以前用过的一个简单的统计方法：

以您想要检测的语言获取大量样本训练文本。将其拆分为三元组，例如

“Hello foobar”在三元组中是：'Hel'、'ell'、'llo'、'lo'、'of'、'fo'、'foo'、'oob'、'oba'、'bar'

对于所有源数据，计算每个三元组出现的频率，大概是在一个字典中，其中键=三元组，值=频率。如果需要，您可以将其限制为前 300 个最常见的 3 字母组合或其他内容。在某处腌制字典。

要判断新的文本样本是否以相同的语言编写，请对样本文本重复上述步骤。现在，您所要做的就是计算样本三元组频率和训练三元组频率之间的相关性。您需要使用它来选择一个阈值相关性，高于该阈值相关性您愿意将输入视为土耳其语或非土耳其语。

这种方法已被证明是高度准确的，击败了更复杂的方法，请参阅

[Cavnar & Trenkle (1994)：“基于 N-Gram 的文本分类”](http://lesfourmisrouges.com/bs/documentation/@%20work/sdair-94-bc.pdf)

使用 trigrams 解决了使用单词列表的问题，因为在任何给定的语言中都有大量的单词，尤其是在不同的语法排列的情况下。我试过寻找常用词，问题是它们经常对其他语言给出误报，或者它们本身有很多排列。统计方法不需要大量的存储空间，也不需要复杂的解析。顺便说一下，这种方法只适用于具有语音书写系统的语言，如果根本不适用于使用表意语言的语言（即中文、日语、韩语），它的效果就很差。

[或者，维基百科在其方便的语言识别图表](http://en.wikipedia.org/wiki/Language_recognition_chart#Turkic_languages)中有一个关于土耳其语的部分。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-21T14:26:36.263

为什么不直接使用现有的拼写检查库？多种语言的拼写检查，选择错误计数最低的语言。

# ruby - 我可以找到定义方法的文件/行号吗？

> ID：383968
> 
> 赞同：0
> 
> 时间：2008-12-21T01:16:40.307
> 
> 标签：ruby, reflection

# 重复：[如何找到运行时定义 Ruby 方法的位置](https://stackoverflow.com/questions/175655/how-to-find-where-a-ruby-method-is-defined-at-runtime)

* * *

对于给定的对象，是否可以找出每个方法的定义位置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T01:46:21.930

事实上，这将非常困难，但是您可以使用钩子方法来观察定义方法的行号。

```
class X < Object

  def X.method_added(symbol)
    puts "adding method #{symbol} to class X from #{caller(0)}"
  end

end

class X
  def a_method
  end
end 
```

# c++ - args[0] 是否保证是执行路径？

> ID：383973
> 
> 赞同：11
> 
> 时间：2008-12-21T01:21:43.977
> 
> 标签：c++

这是一个基本问题，但也是一个重要的问题……

**当启动一个 C++ 程序时，其 main 方法具有以下公共签名：**

```
int main(int argc, char* args[]) {
    //Magic!
    return 0;
} 
```

**args[0] 是否总是保证是当前正在运行的程序的路径？跨平台呢（因为我在 Linux 环境中，但以后可能会移植。）？**

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-21T01:26:08.790

并非总是如此。这是操作系统给程序的值。例如，在启动程序时，`exec`您可以将其设置为任意值：

```
int execve(const char *filename, char *const argv[],
           char *const envp[]); 
```

第一个参数是要启动的文件，argv 将包含 argv[0] 和 main 的所有其他参数。envp 包含环境变量（标准 C 或 C++ 未定义。这是一个 posix 的东西）。

更准确地说，这是 C++ 中 argv 的定义：

> 实现不应预定义主要功能。该功能不得重载。它应该有一个 int 类型的返回类型，否则它的类型是实现定义的。所有实现都应允许以下两种 main 定义：

```
int main() { /* ... */ } 
```

> 和

```
int main(int argc, char* argv[]) { /* ... */ } 
```

> 在后一种形式中，argc 是从程序运行的环境传递给程序的参数数量。如果 argc 不为零，则这些参数应作为指向以空结尾的多字节字符串 (NTMBS) (17.3.2.1.3.2) 的初始字符的指针提供，并且`argv[0]`应 是指向表示所用名称的 NTMBS 的初始字符的指针调用程序或“”。argc 的值应为非负数。的值 应为 0。 [注意：建议在 argv 之后添加任何其他（可选）参数。]`argv[argc-1]``argv[0]``argv[argc]`

定义“用于调用程序的名称”几乎取决于实现。如果要获取可执行文件的完整路径，可以在 Windows 上使用[GetModuleFileName](http://msdn.microsoft.com/en-us/library/ms683197%28VS.85%29.aspx)`argv[0]` ，并且（用于获取用于执行的名称，可能是相对的）与`getcwd`（用于获取当前工作目录，尝试将名称设为绝对名称） .

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T01:48:22.910

否。在 Windows 上，GetModuleFileName 保证当前执行程序的确切完整路径。在 linux 上有一个符号链接 /proc/self/exe。在此符号链接上执行 readlink 以获取当前正在执行的程序的完整路径。即使通过符号链接调用 youprogram /proc/self/exe 也将始终指向实际程序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T02:04:02.020

学生们过去常常试图通过编写以“cc”或“tcsh”的 argv[0] 开头的 C 程序来隐藏他们在学校大型机上玩 Rogue 的事实。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T01:40:40.600

以下是 C 标准所说的内容`argv[0]`：

> 如果 的值`argc`大于零，则 指向的字符串 `argv[0]`代表程序名； `argv[0][0]`如果主机环境中没有程序名，则应为空字符。

至于是否包含完整路径，答案是 argv[0] 不一定包含可执行文件的完整路径。在 Windows 上，它似乎正是命令行中提供的内容。不知道 Linux/Unix 做了什么。

# file - 在 FTP 文件服务器上查看超过 10,000 个文件？

> ID：383977
> 
> 赞同：16
> 
> 时间：2008-12-21T01:26:14.420
> 
> 标签：file, ftp, limit

我已经使用免费软件（基于 Windows）的 FTP 客户端将超过 10,000 个文件排队上传到基于 UNIX 的 FTP 服务器，据我所知，该客户端已完成且没有错误。

现在，当我查看远程目录（使用 Windows 软件）时，输出被截断为 10,000 个文件名。当我使用 Windows 命令行 FTP 工具时，会发生这种情况。有没有办法我可以使用另一款软件看到超过此限制的内容？我只需要确认所有确实上传的文件。

有任何想法吗？

非常欢迎有关此限制的任何信息。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-21T01:42:16.853

请提供更多信息，例如特定操作系统和版本。还请列出您遇到问题时使用的 ftp 客户端的名称和版本。

单个目录中的大量文件可能会导致许多程序出现问题。我建议通过将它们放在多个文件夹中来减少文件夹中的文件数量。

您使用的 FTP 客户端可能有一个查看原始日志的选项，您应该能够使用它来确定是服务器问题还是客户端问题。客户端可能使用稍微不同的方法来检索文件列表。

故事在日志中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-09-28T19:49:21.487

我最近在 FileZilla 中也遇到了这个问题（顺便说一句，它不是特定于客户端的）。该设置称为 LimitRecursion。与您的主机交谈以调整此速率。我只是创建了一张到 LiquidWeb 的票，这在几分钟内就解决了。对于遇到此问题的其他任何人。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T03:25:21.327

我刚刚在我有权访问的 FTP 服务器上创建了 11,000 个文件，然后使用 Firefox 显示以 URL 开头的目录`ftp://hostname/pub/...`。Firefox 可以很好地显示所有 11,000 个文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T04:39:24.017

服务器为 ftp 运行什么软件？如果是 vsftp，那么您可能会达到外壳/内核限制，而不是 ftp 服务器限制。另外 10K 对于一个目录来说有点多，严重可能要考虑进行目录跨越（文件的 /1-3 个字符/文件名的 4-5 个字符/fullname.suffix 只要它一致，这将使它很多更易于查找文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-10T02:41:50.930

如果您的 unix 主机支持 sftp（大多数现代主机支持），那么您应该使用它，winscp 是 Windows 的免费 sftp 客户端。您可以使用它来查看/同步本地和远程目录。它将通过加密和哈希检查安全地传输所有文件

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-07T21:17:46.210

您可以运行[CrossFTP 客户端](http://www.crossftp.com/)，然后选择工具 -> 同步目录来比较您的本地文件夹和远程文件夹。如果缺少任何文件，您可以轻松找到它们。

如果文件列表太大，某些 FTP 服务器会截断文件列表，例如 ProFTPd。您需要检查 FTP 日志消息以确保服务器端也没有截断。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T02:10:09.013

您应该能够访问原始 FTP 接口，或者以其他方式直接提交单个 ftp 命令。如果可以，[此列表](http://technet.microsoft.com/en-us/library/bb490645.aspx)为您提供了一些选项。. （这是一个 Windows 列表，但 unix 应该不会更糟。我记得最好使用 unix ftp 命令。） bang (!) 应该让你进入 cmd 提示符（我确信涉及安全问题。如果你能以某种方式“ls | wc”你会有一个计数，或者你可以“ls”到一个文件，你可以用文件列表ftp返回。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T03:10:46.520

如果您只有 (ls -al|dir) > 文件名具有 shell/rd 访问权限，则对该文件和本地计算机上的类似文件进行比较。

# objective-c - -[NSObject isMemberOfClass:] 方法有多大用处？

> ID：383978
> 
> 赞同：10
> 
> 时间：2008-12-21T01:28:10.643
> 
> 标签：objective-c, cocoa

这是我写的一个小测试程序：

```
#import <Foundation/Foundation.h>

int main(int argc, char **argv) {   
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
    NSArray *arr = [NSArray array];
    printf("Arr isMemberOfClass NSArray: %d\n", [arr isMemberOfClass:[NSArray class]]);
    printf("Arr isKindOfClass NSArray: %d\n", [arr isKindOfClass:[NSArray class]]); 

    [pool release];
    return 0;
} 
```

及其输出：

```
$ ./ismemberof   
Arr isMemberOfClass NSArray: 0   
Arr isKindOfClass NSArray: 1 
```

`-isMemberOfClass:`该方法在任何 Foundation 类中都有多大用处？我知道这可能会为我子类化的类提供所需的结果，但对于 Foundation 类——我发现我的 arr 变量的结果为 false 是不直观的。发生这种情况的原因是因为 NSArray 不是一个具体的类，而是一个抽象类，而在引擎盖下 NSArray 真的是 NSCFArray 的一个具体实例吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-21T03:08:58.443

你一般想要`isKindOfClass:`，没有`isMemberOfClass:`。不同之处在于，如果接收者是相关类的子类的成员，则将返回`isKindOfClass:`，而在相同情况下将返回。`YES``isMemberOfClass:``NO`

正如 Graham Lee 所指出的，`NSArray`是一个类集群。这意味着每个`NSArray`实例实际上都是某个子类的一个实例——因此你的发现。Only`isKindOfClass:`对使用类集群的类成员资格测试很有用。

也就是说，您通常应该使用`respondsToSelector:`而不是类成员资格测试。一个例子是`objectEnumerator`，它也是由`NSSet`and实现的`NSDictionary`（它们都是类集群）。plist 序列化是一个例外：集合不是属性列表，因此您需要先发送`allObjects`到集合以获取数组，然后再尝试从中获取 plist 数据。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-05T22:02:11.567

`-isEqual:`-isMemberOfClass:在您自己的类中实现该方法时很有用。如果你有这样的课程：

```
@interface Person : NSObject {
    NSString *name;
    NSUInteger age;
}
@property(copy) NSString *name;
@property(assign) NSUInteger age;
@end 
```

如果两个 Person 对象具有相同的名称和年龄，则您希望它们被视为相同，您必须实现`-isEqual:`, 以及协议中的`-hash`方法`NSObject`：

```
- (BOOL)isEqual:(id)obj {
    return [obj isMemberOfClass:[self class]]
        && [obj name] == self.name
        && [obj age] == self.age;
}

- (NSUInteger)hash {
    return [self.name hash] + age;
} 
```

PS：为什么要使用`[obj isMemberOfClass:[self class]]`而不是简单地使用`[obj class] == [self class]`？这在上面的代码中并不重要，但是当您处理使用`NSProxy`. 该`isMemberOfClass:`方法将询问代理所代表的对象是否**是**该类的成员，这可能是您想要的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T02:17:29.980

我自己从未使用过 -isMemberOfClass:，因为如果我向现有类添加功能，通常是通过添加方法，所以 -respondsToSelector: 给了我我需要的东西。另一方面，我可以看到想知道您正在查看的特定类（一个实例）可能很有用。例如，如果您正在处理 NSConstantString 或 NSSimpleCString ，您可能更愿意对 -fastestEncoding 做出假设，而不是其他类的实例。

要回答正文中的问题，是的，您是正确的。NSArray 被实现为类集群，因此您不会看到`isMemberOfClass: [NSArray class]`. 这并不意味着 -isMemberOfClass: 毫无意义，它只是意味着它对 NSArray 来说永远不会正确。

# javascript - 在 IE 和 FF / Chrome 中动态构建查询字符串行为

> ID：383979
> 
> 赞同：0
> 
> 时间：2008-12-21T01:32:03.363
> 
> 标签：javascript, jquery

这段代码

```
function LoadContent(Id) {
        alert('Controls/Network/NetworkDetail.aspx?' + rnd() + '&CtlId=' + Id);
        $.get('Controls/Network/NetworkDetail.aspx?' + rnd() + '&CtlId=' + Id, function(data) {
            $(Id).append(data);
        });
        $(Id).removeClass("Waiting");
} 
```

在 IE7 中完美运行。警报显示预期的查询字符串，NetworkDetail.aspx 页面可以使用 Request.QueryString["CtlId"] 获取 CtlId

但是，使用 FF3 和 Chrome，Request.QueryString["CtlId"] 返回 null 但警报正确显示了查询字符串（与 IE7 没有区别）。

Id 值通常是“#Tab1”或“#Tab2”

关于如何正确构造查询字符串的任何想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T01:40:54.297

# 表示 HTML 中的命名锚点，因此不是查询字符串的一部分，也许您正确地对您的 ID 进行了 URL 编码。

例如 #Tab1 变成 %35Tab1

尝试使用转义。例如

“控件/网络/NetworkDetail.aspx？” + rnd() + '&CtlId=' + 转义(Id)

# java - 我应该从哪里开始画画？(Java,图形用户界面)

> ID：383995
> 
> 赞同：-2
> 
> 时间：2008-12-21T01:49:52.970
> 
> 标签：java, user-interface, drawing, jframe

我在 GenerateButton 类的末尾有了点，但是现在我得到了包含所有点的公共 double[][] 矩阵，我从哪里开始绘制它们？？？

我的 Main.java：

```
import java.awt.*;
import javax.swing.*;

public class Main {
     public static Display display = new Display();

     public static void main(String[] args) {
         display.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        display.setVisible(true);
     }
} 
```

我的 Display.java：

```
import java.awt.*;
import java.awt.event.*;
import java.awt.dnd.*;
import java.util.Vector;

import javax.swing.*;

public class Display extends JFrame {
    final int FRAME_WIDTH = 910;
    final int FRAME_HEIGHT = 660;
    final int X_OFFSET = 40;
    final int Y_OFFSET = 40;

    final int GRAPH_OFFSETX = 15;
    final int GRAPH_OFFSETY = 40;
    final int GRAPH_WIDTH = 500;
    final int GRAPH_HEIGHT = 500;
    final int GRAPH_INTERVAL = 20;

    JButton submit;
    JTextField numPoint;
    JPanel bpanel;
    JPanel points;
    Vector<JTextField> pointsA = new Vector<JTextField>();
    int maxPoints;
    public double[][] matrix;

    public Display() {
        init();
    }

    public void init() {
        setBackground(Color.WHITE);
        setLocation(X_OFFSET, Y_OFFSET);
        setSize(FRAME_WIDTH, FRAME_HEIGHT);
        setTitle("Geometric Transformations");
        getContentPane().setLayout(null);
        setDefaultLookAndFeelDecorated(true);

        numPoint = new JTextField();
        numPoint.setText("# Points?");
        numPoint.setBounds(530,200,120+20,25);

        SubmitButton submit = new SubmitButton("Submit");
        submit.setBounds(530+150, 200, 100, 25);

        GenerateButton submitC = new GenerateButton("Generate");
        submitC.setBounds(530-5, 200+130, 100, 25);

        points = new JPanel(new GridLayout(2,2));
        points.setBounds(530, 200+40,100+270,80);

        this.add(numPoint);
        this.add(submit);
        this.add(submitC);
        this.add(points, BorderLayout.LINE_START);

        repaint();
    }

    public void paint(Graphics g) {
        super.paint(g);
        g.setColor(Color.WHITE);
        g.fillRect(100, 100, 20, 30);
        g.setColor(Color.BLACK);
        genGraph(g, GRAPH_OFFSETX, GRAPH_OFFSETY,
                 GRAPH_WIDTH, GRAPH_HEIGHT, GRAPH_INTERVAL);
    }

    public void genGraph (Graphics g, int x, int y,
                          int width, int height, int interval) {
        // draw background
        int border = 5;
        g.setColor(Color.BLACK);
        width = width - (width % interval);
        height = height - (height % interval);
        for (int col=x; col <= x+width; col+=interval) {
            g.drawLine(col, y, col, y+height);
        }
        for (int row=y; row <= y+height; row+=interval) {
            g.drawLine(x, row, x+width, row);
        }
    }
    class SubmitButton extends JButton implements ActionListener {

        public SubmitButton(String title){
            super(title);
            addActionListener(this);
        }
        public void actionPerformed (ActionEvent e) {
            maxPoints = Integer.parseInt(numPoint.getText()) * 2;

            points.removeAll();        // clear JPanel so results from last aren't appended to
                                // delete this line and first enter 2 then 10 for # points
            for (int i=0; i<maxPoints; i++) {
                JTextField textField = new JTextField();
                points.add(textField);        // add to JPanel that gets displayed
                pointsA.add(textField);        // for getting values from later
            }

            matrix = new double[2][pointsA.size()/2];       // setting up dimension of matrix double[][]

            points.validate();
            points.repaint();

            // What to Check:
            // Things between commas are either spaces (which will be stripped later)
            // or numbers!

            // Pairs must match up!
        }
    }
    class GenerateButton extends JButton implements ActionListener {
        public GenerateButton (String title) {
            super(title);
            addActionListener(this);
        }
        public void actionPerformed (ActionEvent e) {
            int c=0;
            for (int i=0; i<pointsA.size()/2; i++) {
                JTextField pointTF = pointsA.get(i);
                Double point = Double.parseDouble(pointTF.getText());
                matrix[0][c] = point;
                c++;
            }
            c=0;
            for (int i=pointsA.size()/2; i<pointsA.size(); i++) {
                JTextField pointTF = pointsA.get(i);
                Double point = Double.parseDouble(pointTF.getText());
                matrix[1][c] = point;
                c++;
            }
            for (int i=0; i<matrix.length; i++) {
                for (int j=0; j<matrix[0].length; j++) {
                    System.out.println("i:"+i+"\t"+"j:"+j);
                    System.out.println("      "+matrix[i][j]);
                }
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T03:51:49.620

我不太确定你在问什么。通常，您将所有绘图功能放在paint() 方法中。但是，您通常希望将任何长时间运行的工作保留在 AWT 调度线程之外，该线程与调用按钮的 actionPerformed() 方法的线程相同。为了让您的程序保持响应，您可能希望将其委托给 SwingWorker。

如果您的应用程序未显示，可能是因为您在 JPanel 初始化期间没有调用 pack() 和 show()（按此顺序）。通常，您应该将此作为 init() 方法中的最后一件事。之后添加组件或在 AWT 线程之外的任何地方更改组件状态可能会导致 AWT 对您生气并引发异常。

如果您询问如何自己绘制点，您应该查看 Graphics.drawPolyline() 和相关方法，您应该从您的 paint() 方法中调用它们。

如果您询问如何从按钮处理程序中绘制它们，您不会。您调用 repaint() 并让对象根据自己的时间重新绘制自己。此外，在您的情况下，我不会费心子类化 JButton。只需实现actionListener。在您的 init() 方法中，只需创建两个按钮并使用它们注册您的侦听器。这也意味着您不必重写它们的构造函数。

此外，您在 init() 方法期间屏蔽提交：它永远不会被引用，bpanel 也不会。另外，我会使用单独的 X 和 Y 数组，而不是尝试将它们组合成一个矩阵。您不需要将矩阵声明为公开的，因为无论如何内部类已经可以看到它。事实上，您可以（并且可能应该）将所有字段声明为私有。你也有太多的魔法数字漂浮在你身边，你和 Swing 的战斗太多了：让它完成你所有的东西的工作。您还应该尝试展示可以让我们回答您的问题的最小可能问题：这种类型的流动无处不在并且难以遵循。

哦，你的线条没有被绘制的真正原因：你在 JPanel 上调用 repaint 而不是你想要绘制的 JFrame。如果您只调用 repaint() 而不是 points.repaint()，JFrame 将负责绘制自身及其所有子项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T21:06:03.603

您应该创建一个新组件并在那里绘制点，而不是在它自己的 Frame 中。

读这个：

[http://java.sun.com/products/jfc/tsc/articles/painting](http://java.sun.com/products/jfc/tsc/articles/painting)

然后你可以使用这个：

[http://java.sun.com/javase/6/docs/api/java/awt/Canvas.html](http://java.sun.com/javase/6/docs/api/java/awt/Canvas.html)

并将该对象添加到框架中。******`*************