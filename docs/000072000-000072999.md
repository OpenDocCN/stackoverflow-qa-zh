# StackOverflow 问答 000072000-000072999

# c++ - C++ 重载决议

> ID：72010
> 
> 赞同：41
> 
> 时间：2008-09-16T13:09:10.827
> 
> 标签：c++, function, overloading, resolution

鉴于以下示例，为什么我必须明确使用该语句`b->A::DoSomething()`而不仅仅是`b->DoSomething()`？

编译器的重载决议不应该弄清楚我在说哪种方法吗？

我正在使用 Microsoft VS 2005。（注意：在这种情况下使用虚拟没有帮助。）

```
class A
{
  public:
    int DoSomething() {return 0;};
};

class B : public A
{
  public:
    int DoSomething(int x) {return 1;};
};

int main()
{
  B* b = new B();
  b->A::DoSomething();    //Why this?
  //b->DoSomething();    //Why not this? (Gives compiler error.)
  delete b;
  return 0;
} 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-16T13:18:27.153

这两个“重载”不在同一个范围内。默认情况下，编译器只考虑可能的最小名称范围，直到找到名称匹配。参数匹配是在*之后*完成的。在您的情况下，这意味着编译器会看到`B::DoSomething`. 然后它尝试匹配参数列表，但失败了。

一种解决方案是将重载从`A`into`B`的范围内拉下来：

```
class B : public A {
public:
    using A::DoSomething;
    // …
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-16T13:18:43.907

重载解析是 C++ 中最丑陋的部分之一

基本上，编译器在 B 的范围内找到一个名称匹配“DoSomething(int)”，看到参数不匹配，并因错误而停止。

它可以通过使用 B 类中的 A::DoSomething 来克服

```
class A  
{  
  public:  
    int DoSomething() {return 0;}
};  

class B : public A  
{  
  public:  
    using A::DoSomething;
    int DoSomething(int x) {return 1;} 
};   

int main(int argc, char** argv)
{
  B* b = new B();  
  // b->A::DoSomething();    // still works, but...
  b->DoSomething();    // works now too
  delete b;  
  return 0;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T13:27:02.017

不，这种行为的存在是为了确保您不会被错误地从远处的基类中继承。

要绕过它，您需要通过在 B 类中放置 using A::DoSomething 来告诉编译器您要调用哪个方法。

有关此行为的快速简便的概述，请参阅[本文](http://becomeaprogrammerin21years.blogspot.com/2008/03/c-inheritance-oddity.html)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T17:21:01.343

派生类中方法的存在隐藏了基类中具有相同名称（无论参数如何）的所有方法。这样做是为了避免这样的问题：

```
class A {} ;
class B :public A
{
    void DoSomething(long) {...}
}

B b;
b.DoSomething(1);     // calls B::DoSomething((long)1)); 
```

后来有人改变了A类：

```
class A
{
    void DoSomething(int ) {...}
} 
```

现在突然：

```
B b;
b.DoSomething(1);     // calls A::DoSomething(1); 
```

换句话说，如果它没有像这样工作，那么你无法控制的类 (A) 中的不相关更改可能会默默地影响你的代码的工作方式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-16T13:30:17.360

这与名称解析的工作方式有关。基本上，我们首先找到名称来自的范围，然后我们收集该范围内该名称的所有重载。但是，您的情况的范围是 B 类，而在 B 类中，B::DoSomething**隐藏**了 A::DOSomething：

3.3.7 名称隐藏 [basic.scope.hiding]

...[剪辑]...

3 在成员函数定义中，局部名称的声明隐藏了类同名成员的声明；见 *basic.scope.class*。派生类（*class.derived*）中成员的声明隐藏了同名基类成员的声明；见*class.member.lookup*。

由于名称隐藏，A::DoSomething 甚至不考虑用于重载解析

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T13:19:23.720

当您在派生类中定义函数时，它会隐藏基类中具有该名称的所有函数。如果基类函数是虚拟的并且具有兼容的签名，那么派生类函数也会覆盖基类函数。但是，这并不影响可见性。

您可以使用 using 声明使基类函数可见：

```
class B : public A  
{  
  public:  
    int DoSomething(int x) {return 1;};  
    using A::DoSomething;
}; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T13:57:25.437

那不是超载！那就是隐藏！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T13:19:24.857

在搜索要使用的函数的继承树时，C++ 使用不带参数的名称，一旦找到任何定义，它就会停止，然后检查参数。在给出的示例中，它在 B 类中停止。为了能够做你想做的事情，B 类应该这样定义：

```
class B : public A  
{  
  public:
    using A::DoSomething;
    int DoSomething(int x) {return 1;};  
}; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T13:20:37.663

该函数被子类中具有相同名称的函数隐藏（但具有不同的签名）。您可以使用 using 语句取消隐藏它，如 using A::DoSomething();

# .net - 在 SQL Server 中嵌入 .NET 程序集的最佳实践

> ID：72014
> 
> 赞同：1
> 
> 时间：2008-09-16T13:09:32.277
> 
> 标签：.net, sql-server-2005, assemblies

创建要嵌入到 SQL Server 2005 的 .NET 程序集时，有哪些重要的做法需要遵循？

我对此很陌生，我发现有重要的方法属性，例如：

```
[SqlFunction(FillRowMethodName = "FillRow", TableDefinition = "letter nchar(1)")] 
```

我也在寻找要避免的常见陷阱等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T13:24:26.687

我记得的一些：

*   尽量减少使用，仅在 T-SQL 太复杂时使用。
*   不惜一切代价避免使用指针/游标，因为 for 循环在 CLR 上下文中很容易被滥用。
*   除非完全必要，否则只使用 SQL-Server 本机数据类型。

不记得我在哪里找到的信息，但那些是我记得的。

基本上，只有在声明式 T-SQL 过于复杂或无法做到（例如注册表编辑等）时才使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T13:36:48.420

关于程序集部署的单一提示：

保持功能在小型组件之间隔离。尽量不要构建依赖链，因为替换基础程序集意味着您需要先删除依赖程序集*，*然后才能更新基础程序集。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-16T14:30:45.013

我强烈建议不要将 .net 程序集放在您的数据库服务器中，想想 n 层应用程序。持久性 <- 业务逻辑 <- 表示逻辑 <- 客户端 将您的逻辑保留在业务逻辑层中。

我能想到将 .net 放入数据库的唯一原因是添加一个新的复杂数据类型，我强烈认为这是一个只保存数据而不对其进行处理的愚蠢类。

仅仅因为你可以并不意味着你应该。很抱歉没有直接回答你的问题。

# winforms - Windows 窗体测试自动化

> ID：72016
> 
> 赞同：9
> 
> 时间：2008-09-16T13:09:48.517
> 
> 标签：winforms, testing

我们正在寻找一种自动化 Windows 窗体以进行验收测试的方法。我们的要求是：

*   **必须可供非开发人员使用**（即：未安装开发环境的人员）
*   必须有录音机
*   必须支持第三方控件
*   必须具备基本功能（允许单击按钮、输入文本、验证结果、必要时跨多个窗口）

基本上，类似于[Selenium](http://selenium.openqa.org/)，但适用于 Windows 窗体。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T16:16:13.653

值得一提的是，我已经测试了 15 年，至今还从未见过以这种方式创建的测试的投资回报率。自动化测试，显然是一件好事，但如果你只是采用应该是手动测试用例的测试用例并让最低工资工人“自动化”它们，你几乎总是会以大量无法维护的脆弱测试而告终，这些测试不会节省时间最后并迅速被淘汰。

paiNie 的 FitNesse 建议是一个很好的建议。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T14:46:59.937

> 必须可供非开发人员使用

任何非 web 测试自动化工具都需要开发者众所周知的 ide（Eclipse 等）或测试工具 ide。SilkTest、TestComplete 等也会让你编写一些代码。

您可以使用创建“可执行需求”的工具（如[“Fitnesse”](http://fitnesse.org) 或[Concordion ）将开发人员和测试人员之间的工作分开](http://www.concordion.org/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T20:37:11.683

Posting this on behalf of my wife :)

* * *

We were using a tool from Compuware called [TestPartner](http://www.compuware.com/375_eng_html.htm) to create the test scripts for testing a WinForms client-server application. For managing and controlling the scripts execution we were using [Compuware QA Director](http://www.compuware.com/products/qacenter/qadirector.htm).

TestPartner uses VBA which is quite easy to understand and to use. Some non-developers could even know it because they write Excel macros. It has good record-and-replay functionality and is very good with objects recognition. So you could use it for both simple scripts created by your business users and to create a framework of advanced scripts by your developers and test engineers.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T13:14:10.563

[AutomatedQA TestComplete](http://www.automatedqa.com/products/testcomplete/index.asp)满足您的要求 AFAIK

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T18:25:10.450

HP QuickTest Pro 是一个很好的工具，即使对于非开发人员也是如此

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T13:28:55.397

从未使用过它，但[Borland SilkTest](http://www.borland.com/us/products/silk/silktest/index.html)似乎是另一个满足您要求的产品。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-14T14:44:12.280

> > 基本上，类似于 Selenium，但适用于 Windows 窗体。

你可以试试 AutoIt。它是免费的，并且有一个社区站点，您可以在其中找到已经创建的解决方案。

但是，我通常担心您的目标。接受标准是非正式的。您是否已经知道如何将非正式的东西转化为技术要求？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-13T19:20:28.767

我们使用[TestComplete](http://www.automatedqa.com/products/testcomplete/)来自动化我们的 Windows 表单测试用例。总体来说是一款非常不错的产品。

您将遇到的主要问题是，虽然这些产品中的大多数都能满足您的所有要求，但您将遇到很多维护问题，尤其是让非开发人员记录测试。

尽管快速记录所有测试然后让它们从记录中运行似乎是个好主意，但通过将自动化测试实际视为常规开发，您将获得更好的[投资回报率。](http://en.wikipedia.org/wiki/Rate_of_return)录音会给你留下很多[重复的代码](http://en.wikipedia.org/wiki/Duplicate_code)，很难维护。通过正确设计测试并分解可重用代码，您最终将获得更稳定的测试，并且您将能够更快地获得结果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T13:18:06.687

佛蒙特州 HighTest： [http ://www.vtsoft.com/vcsproducts/index.html](http://www.vtsoft.com/vcsproducts/index.html)

30天的试用看起来不错！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T13:54:34.617

查看 Oracle/Empirix 电子测试。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-10-01T17:33:02.230

检查完美的解决方案。TestComplete 是一个很棒的工具，用于录制和播放以及使用 VB、C#、C++ 或其他任何您想要的东西创建自己的脚本。它击败了 Silk、Compuware 和 Mercury。每个许可证的价格非常低。您可以在 Compuware 和 Silk 中以 1 个许可证的价格获得 5 个许可证，以 Mercury 的价格获得 1/4 个许可证。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-06-19T12:49:50.197

你可以试试Sikuli。它是免费且容易的。无需编程技能。

# search - 开源全文文章推荐引擎

> ID：72029
> 
> 赞同：4
> 
> 时间：2008-09-16T13:12:43.767
> 
> 标签：search, recommendation-engine, summary

我想知道开源项目中是否有任何好的 .NET 推荐算法可用，无论是否附加到搜索引擎。推荐是指接受全文文章并根据关键字相似度从其索引中推荐其他文章的东西。

在高端有像 Autonomy 这样的文档分类引擎；在低端垃圾邮件过滤器和博客“相关帖子”小部件上。也可能是广告到文章的匹配。我想将一个合并到一个项目中，但买不起高端，而低端似乎都是基于 LAMP 的。

[抱歉，有一个答案要求澄清：我正在寻找理想的独立库，但我愿意根据需要调整好的源代码。最终结果是我需要能够创建一个 C# 服务，该服务接受任意数量的文本并返回类似的先前索引文章的列表。基本上，StackOverflow 本身在您提交问题时所做的确切事情！]

谢谢！史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T17:43:48.423

我认为在 StackOverflow 中，他们从文本中提取所有常见的英语单词，然后将这些单词与其他帖子的剩余单词进行比较，以获得“相关”帖子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:20:23.323

问题不是很清楚（算法还是库？？？）但唯一想到的是 Lucene.NET，它是流行的 Lucene 库在 .Net 框架上的移植。HTH。

# macos - 在 Mac 上从 png 创建光标 rsrc 文件

> ID：72032
> 
> 赞同：2
> 
> 时间：2008-09-16T13:12:59.133
> 
> 标签：macos, png, rsrc

我想从 png 文件在 Mac 上创建光标 rsrc 文件。使用游标的应用程序要求它采用 .rsrc 格式，我无法更改它。有谁知道我可以从 png 图像创建光标 .rsrc 文件的任何方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:16:30.947

您可以使用[Rezilla](http://www.versiontracker.com/dyn/moreinfo/macosx/23349 "雷兹拉")在 Mac OS X 上编辑资源文件，它有一个 CURS（和 crsr）编辑器等。它是一个 PowerPC 二进制文件，但它在英特尔的 Rosetta 下运行良好。

此外，您无需创建 CURS 资源文件，而是创建资源文件并根据需要向其中添加尽可能多的 CURS 资源。资源分叉是通用的，可以包含任意数量/种类的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:27:14.197

根据此链接[http://www.macfixit.com/article.php?story=20060621071707921](http://www.macfixit.com/article.php?story=20060621071707921)我需要一台 Power PC Mac 才能运行 Mac 经典版。这是正确的吗？我有一台运行 Mac OS 10.4.11 的 Intel Mac。是否有任何其他工具能够在 Intel Mac 上运行并且可以帮助我创建 CURS rsrc 文件。我尝试使用 ResKnife，但它似乎没有创建 CURS rsrc 文件的选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:50:19.510

Its been a long time since I've thought about MacOS resource forks. Are you using the classic MacOS (i.e. before MacOS X)?

As I recall, [ResEdit](http://developer.apple.com/documentation/macos8/DevTools/ResEditReference/reseditreference.html) was the application most often used to manipulate the resource fork of a classic Mac application. I know it can edit cursor resources, but I don't recall if it can read PNG files. You may need to convert the files to GIF.

ResEdit is a Classic MacOS application. MacOS X prior to 10.5 could run Classic apps in emulation, but in 10.5 this support has been removed. You'd need to find a system either running the classic MacOS directly, or running 10.4 with Classic installed.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T17:59:49.317

If by .rsrc file you mean a standard Mac resource file, you can use the [Resource Manager](http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-9.html#HEADING9-0) to save the image in a file of the appropriate format.

# asp.net - 在 ASP.NET Webform 上实现多个默认按钮的最佳方法

> ID：72036
> 
> 赞同：1
> 
> 时间：2008-09-16T13:13:14.997
> 
> 标签：asp.net, webforms

在 ASP.NET Webform 上实现多个默认按钮的最佳方法是什么？

我有一个我认为非常标准的页面。有一个带有用户/密码字段和登录按钮的登录区域。然后在同一页面的其他地方有一个带有搜索按钮的搜索字段。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T13:21:15.617

`asp:Panel`有一个名为 的属性`DefaultButton`。您只需要使用适当的面板封装您的标记部分，并为每个面板设置默认按钮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T13:15:10.657

捕获屏幕每个区域的输入键，然后触发相应按钮的点击。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:16:35.177

使用像[这样](http://geekswithblogs.net/jawad/archive/2005/05/15/TextBoxButtonTie.aspx)的辅助函数将文本框绑定到它们的关联按钮。

# c# - IE 中的 .NET ActiveX 组件 - 如何获取浏览器参考

> ID：72048
> 
> 赞同：6
> 
> 时间：2008-09-16T13:14:47.410
> 
> 标签：c#, .net, internet-explorer, activex

我承认我对 COM 和 IE 体系结构了解得足够多，只是很危险。我有一个与此类似的工作 C# .NET ActiveX 控件：

```
using System;
using System.Runtime.InteropServices;
using BrowseUI;
using mshtml;
using SHDocVw;
using Microsoft.Win32;

    namespace CTI
    {
        public interface CTIActiveXInterface
        {
            [DispId(1)]
            string GetMsg();
        }

        [ComVisible(true), ClassInterface(ClassInterfaceType.AutoDual)]
        public class CTIActiveX : CTIActiveXInterface
        {

            /*** Where can I get a reference to SHDocVw.WebBrowser? *****/
            SHDocVw.WebBrowser browser;

            public string GetMsg()
            {
                return "foo";
            }
        }
    } 
```

我使用 regasm 注册并创建了一个类型库：

```
regasm CTIActiveX.dll /tlb:CTIActiveXNet.dll /codebase 
```

并且可以在 javascript 中成功实例化它：

```
var CTIAX = new ActiveXObject("CTI.CTIActiveX");
alert(CTIAX.GetMsg()); 
```

如何在 CTIActiveX 中获取对客户端站点（浏览器窗口）的引用？我通过实现 IObjectWithSite 在 BHO 中完成了这项工作，但我认为这不是 ActiveX 控件的正确方法。如果我在尝试用 Javascript 实例化时在 CTIActiveX 上实现任何接口（我的意思是像 IObjectWithSite 这样的 COM 接口），我会收到一个错误，即该对象不支持自动化。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T17:55:48.203

First, your interface needs ComVisible(true) in order to be seen by the calling script (this is probably causing the error).

Second, add a .NETreference in your project to "Microsoft.mshtml". This will import the COM interfaces for various IE-related things (windows, HTML documents, etc.)

Then, you need to add a property of type IHtmlDocument2 to your interface:

```
IHtmlDocument2 Document { set; } 
```

...implement it in your class:

```
public IHtmlDocument2 Document
{
  set { _doc = value;}
} 
```

...call it from script

```
CTIAX.Document = document; 
```

...once you have stored a reference to the document, you can use it at will to get to the window, other frames, or any part of the HTML DOM that you wish.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:25:03.077

我找到了一个可行的解决方案。这并不理想，因为它依赖于匹配 IE 窗口的位置 URL 来获取正确的容器，但它确实有效。在我的情况下，我在查询字符串上使用了一个特殊值来确保我得到正确的窗口。

这获得了对 SHDocVw.InternetExplorer 的引用，它公开了与 SHDocVw.WebBrowser 相同的 GetProperty 和 PutProperty：

```
private InternetExplorer GetIEWindow(string url)
{
    SHDocVw.ShellWindowsClass sh = new ShellWindowsClass();
    InternetExplorer IE;

    for (int i = 1; i <= sh.Count; i++)
    {
        IE = (InternetExplorer)sh.Item(i);
        if (IE != null)
        {
            if (IE.LocationURL.Contains(url))
            {
                return IE;
            }
        }
    }

    return null;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-02T15:38:55.737

有一种简单而干净的方法来做到这一点：

```
public void GetBrowser()
        {

            ShellWindows m_IEFoundBrowsers = new ShellWindows();

            foreach (InternetExplorer Browser in m_IEFoundBrowsers)
            {
                webBrowser = (SHDocVw.WebBrowser) Browser;
                 // do what you want ...
            }

        } 
```

# unit-testing - 如何在 Guile 中构建单元测试，输出到 TAP 标准？

> ID：72057
> 
> 赞同：3
> 
> 时间：2008-09-16T13:16:47.470
> 
> 标签：unit-testing, tap, guile

我想要一个 Guile 脚本，它实现功能，根据 TAP 协议输出测试结果消息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-02-17T18:13:39.903

现在还有[ggspec](https://github.com/yawaramin/ggspec)，一个 Guile 单元测试框架，可以输出 TAP 格式的（一个子集）结果。为此，请将所有测试（方案）脚本放在名为`spec`并运行的项目子目录中：

```
$ ggspec -f tap 
```

由于 ggspec 是一个成熟的框架，具有设置、拆卸和测试跳过功能，因此有更多选择。请参阅项目附带的示例测试文件 ( `spec/lib-spec.scm`) 以获得良好的概述。

免责声明：我写了 ggspec。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T13:38:45.763

以下名为 guiletap.scm 的脚本实现了在运行测试时使用 TAP 协议时经常需要的功能。

```
; 定义用于在 TAP 协议下运行 Guile 编写的测试的函数。
; 版权所有 © 2008 Omer Zak
; 在 GNU LGPL 2.1 或（由您选择）任何更高版本下发布。
;;;
;;; 要调用它：
;;; （使用模块（guiletap））
;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;;;;;;;;;;;;;;;;;;;;;;
（定义模块（guiletap））
（出口计划）
（出口正常）
（出口纾困）
（出口诊断）
（导出is_ok）

（使用模块（ice-9 格式））

; n 是测试次数。
（定义计划
  (lambda (n) (显示 (格式 "1..~d~%" n))))

; n - 测试编号
; testdesc - 测试描述符
; res - 失败时为 #f 的结果，成功时为其他结果。
（定义好
  (lambda (n testdesc res)
    (if (not res)(显示 "not "))
    (显示 (格式 "ok ~d - ~a~%" n testdesc))))

; testdesc - 测试描述符
（定义 bail_out
  (lambda (testdesc)
    (display (format "Bail out! - ~a~%" testdesc)))

; diagmsg - 诊断消息
（定义诊断
  （λ（诊断）
    （显示（格式“#~a~%”diagmsg）））

; n - 测试编号
; testdesc - 测试描述符
; 表达 - 预期的测试结果
; actres - 实际测试结果
（定义 is_ok
  （lambda（n testdesc 表达actres）
    (ok n testdesc (equal?expres actres))))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;;;;;;;;;;;;;;;;;;;;;;
; ！！！去做：
; ！！！还要实施：
; plan_no_plan
; plan_skip_all [原因]
;
; 是预期结果 [名称]
; 不是预期结果[名称]
; 喜欢结果模式[名称]
; 与结果模式 [名称] 不同
; 通过[姓名]
; 失败[姓名]
;
; 跳过条件 [原因] [NB_TESTS=1]
; 通过设置 $TODO 指定 TODO 模式：

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;;;;;;;;;;;;;;;;;;;;;;
; guiletap.scm 结束
```

# sql-server - SET FMTONLY ON 的问题

> ID：72070
> 
> 赞同：1
> 
> 时间：2008-09-16T13:17:49.760
> 
> 标签：sql-server

我正在使用 SET FMTONLY ON 执行存储过程，以模拟我们的代码生成器的功能。但是，似乎在像这样执行时结果被缓存了，因为我仍然从刚刚删除的 proc 中收到*Conversion failed错误！*即使我在没有 SET FMTONLY ON 的情况下执行 proc 也会发生这种情况。

谁能告诉我这里发生了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T03:19:57.667

某些语句仍将被执行，即使使用**`SET FMTONLY ON`**. 您的“转换失败”错误可能来自`set variable`于存储过程中的语句这样简单的事情。例如，这会返回第一个查询的元数据，但在运行最后一个语句时会引发异常：

```
SET FMTONLY on

select 1 as a

declare @a int
set @a = 'a' 
```

至于运行已删除的程序，这对我来说是一个新程序。SQL Server 使用系统表来确定要执行的对象，因此执行计划是否为该对象缓存并不重要。如果你删除它，它就会从系统表中删除，并且永远不应该是可执行的。您能否在执行该过程之前查询 sysobjects（或 sys.objects）？我希望你会发现你没有放弃它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T13:21:13.340

1.  这听起来像是客户端错误。通过 SQL Management Studio 运行时是否收到相同的消息？

2.  您是否确认没有另一个同名的过程由不同的模式/用户拥有？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T18:49:01.367

解析 DDL 语句，但如果在连接上执行了 SET FMTONLY ON，则在运行时忽略。因此，如果在 FMTONLY 为 ON 时删除 proc、表等，则解析语句，但不执行操作。

试试这个来验证

```
SET FMTONLY OFF 
```

--创建要测试的表

```
CREATE TABLE TestTable (Column1 INT, Column2 INT) 
```

--插入1条记录

```
INSERT INTO TestTable (Column1, Column2)
VALUES (1,2) 
```

--验证记录是否被插入

```
SELECT * FROM TestTable 
```

--now 仅将格式设置为 ON

```
SET FMTONLY ON 
```

--返回列，但没有数据

```
SELECT * FROM TestTable 
```

-- 使用 FMTONLY ON 执行 DDL 语句

```
DROP TABLE TestTable 
```

--再次关闭FMTONLY

```
SET FMTONLY OFF 
```

--该表被丢弃在上面，所以这应该不起作用

```
SELECT * FROM TestTable

DROP TABLE TestTable

SELECT * FROM TestTable 
```

# javascript - 如何在 GreaseMonkey 脚本中实现“DOM Ready”事件？

> ID：72090
> 
> 赞同：20
> 
> 时间：2008-09-16T13:20:58.083
> 
> 标签：javascript, firefox, greasemonkey

我正在尝试将我的 GreaseMonkey 脚本从在 window.onload 上触发到 window.DOMContentLoaded 修改，但此事件永远不会触发。

我正在使用 FireFox 2.0.0.16 / GreaseMonkey 0.8.20080609

[这](https://stackoverflow.com/questions/59205/enhancing-stackoverflow-user-experience)是我试图修改的完整脚本，更改：

```
window.addEventListener ("load", doStuff, false); 
```

到

```
window.addEventListener ("DOMContentLoaded", doStuff, false); 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-16T13:36:42.850

所以我用谷歌搜索了[greasemonkey dom ready](http://www.google.com/search?q=greasemonkey%20dom%20ready)，第[一个结果](http://www.sitepoint.com/article/beat-website-greasemonkey/)似乎说greasemonkey脚本实际上是在“DOM ready”下运行的，所以你只需要删除onload调用并立即运行脚本。

我去掉了 *`window.addEventListener ("load", function() {`*包装*`}, false);`*，效果很好。这种方式响应速度**更快**，页面立即出现，并应用了您的脚本，并且所有看不见的问题都突出显示，根本没有闪烁。有很多欢欣鼓舞……是的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-16T13:40:30.767

GreaseMonkey 脚本本身在 DOMContentLoaded 上执行，因此无需添加加载事件处理程序 - 只需让您的脚本立即执行所需的任何操作。

[http://wiki.greasespot.net/DOMContentLoaded](http://wiki.greasespot.net/DOMContentLoaded)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:41:36.037

@Sam：是的，我也在尝试同样的方法：

```
// ==UserScript==
// @name           Stack Overflow highlight viewed questions
// @namespace      *
// @include        http://stackoverflow.com/questions
// @include        http://stackoverflow.com/questions?*
// @include        http://stackoverflow.com/questions
// @include        http://stackoverflow.com/questions?*
// @version        0.55 (DOM-Ready instead of onload)
// ==/UserScript==

(function() {

    // Customizable items
    // var fav_tags = ["python", "database", "mysql"];          // Your favorite tags
    const UNSEEN_BACK_COLOR = "rgb(225,210,210)";     // Backcolor for the question already seen
    const FAV_TAG_BACK_COLOR = "rgb(210,210,225)";  // Backcolor for the favorite tags

    // Internal to the DOM
    // const QUESTION_URL = "http:\/\/stackoverflow.com\/questions\/([0-9]+)\/";
    const QUESTION_URL = "http:\/\/stackoverflow.com\/questions\/([0-9]+)\/";
    const TAG_PREFIX = "show questions tagged ";

    const SEEN_MARK = "x";
    //

    var seen_q = [];
    var seen_q_str = "";

    var seen_q_str = GM_getValue ("seen_q", "");
    var seen_q = seen_q_str.split("|");

    var fav_tags_str = GM_getValue ("fav_tags", "")
    var fav_tags = fav_tags_str.split(" ")

    var already_run = false;

    GM_registerMenuCommand ("Set favorite tags", askTags);

    // window.addEventListener ("DOMContentLoaded", doStuff, false);
    if (! doStuff()) {
        window.addEventListener ("load", doStuff, false);
    }

    function doStuff() {

        var elements = window.document.getElementsByTagName('A');

        if (! elements || already_run) {
            return false;
        } else {
            already_run = true;
        }

        GM_log ("here");

        for (elem = 0; elem < elements.length; elem++) {
            if (elements[elem].href.match (QUESTION_URL)) {
                curr_q = RegExp.$1;

                // Already seen?
                if ((seen_q.length < curr_q) || (seen_q [curr_q] != SEEN_MARK)) {
                    elements[elem].style.backgroundColor = UNSEEN_BACK_COLOR;
                    seen_q [curr_q] = SEEN_MARK;
                }

                // Is a favorite tag?
                node = elements[elem].parentNode.parentNode;
                for (tag = 0; tag <= fav_tags.length; tag++) {
                    if (node.innerHTML.match ("'" + fav_tags[tag] + "'")) {
                        node.style.backgroundColor = FAV_TAG_BACK_COLOR;
                        break;
                    }
                }

                // return (0);
            }
        }

        seen_q_str = seen_q.join("|");
        GM_setValue ("seen_q", seen_q_str);

        return true;
    }

    function askTags() {
        fav_tags_str = prompt("Favorite tags (separated by spaces)", fav_tags_str);
        GM_setValue ("fav_tags", fav_tags_str)
    }

})(); 
```

# wiki - 有没有更好的方法来创建 MediaWiki 编号列表？

> ID：72098
> 
> 赞同：45
> 
> 时间：2008-09-16T13:21:39.890
> 
> 标签：wiki, mediawiki

当使用 MediaWiki 的标记语言时，我唯一讨厌的就是创建编号列表。我知道创建列表的唯一方法是执行以下操作：

```
#Item1
#Item2 
```

但是，如果我想在这些行之间添加空格或其他文本，编号就会丢失。例如，以下将创建具有两个第一项目的文本：

```
#Item1
Somestuff
#Item2 
```

有什么办法可以解决这个问题，还是我应该只使用项目符号？我刚才注意到stackoverflow系统不允许这样编号，你必须手动完成。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-16T13:26:42.577

像这样：

```
#Item1
#:Somestuff
#Item2 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-11-02T13:37:26.130

我使用`<ol></ol>`并`<li></li>`嵌入`<pre></pre>`代码格式化部分。对我有用！:-)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-16T13:34:51.670

有几个选项，但您可以从任意数字开始有序列表，如下所示：

```
#项目1

某物

<ol 开始=“2”>
#项目2
</ol>

```

如果您不介意“Something”缩进很多，也可以使用“#:”：

```
#项目1
#:
＃： 某物
#:
#项目2

```

列表有很多选项，您可以在[Wiki 的帮助页面：列表](http://en.wikipedia.org/wiki/Help:List)中找到更多信息。

**更新**

较新的版本更像普通的 html 标记，旧的语法现在会给你一个双缩进并且不会调整起始偏移量，但是下面的工作很好，即使使用 source/syntaxhighlight 标记。

```
<ol>
<li>项目 1</li>
某物
</ol>

<ol 开始=“2”>
<li>项目 2</li>
<源语言=javascript>
变量 a = 1;
</source>
</ol>

```

简而言之，ol 标签内的所有内容都将具有相同的缩进，并且如果它在 li 标签之外，则不会被编号。以下内容现在可以使用，这意味着您不必手动偏移组。

```
<ol>
<li>项目 1</li>
某物
<li>项目 2</li>
<源语言=javascript>
变量 a = 1;
</source>
</ol>

```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-11T03:41:44.617

> #: 有效，但您不能创建带有空格的部分，因此我更喜欢非工作选项。任何人都知道类似的语法可以解决问题（从给定值开始编号）？

这个回复可能有点晚了，但我想我会添加它，以防有人偶然发现这个，就像我一样。您可以通过执行以下操作来创建带有空格的部分：

```
# 项目 1
#:
#:
# 项目 2

```

这将显示为：

1.  项目 1

2.  第 2 项

现在，在你说这不起作用之前，诀窍是在 #: 之后添加一个 ASCII 不间断空格，而不是简单地按空格键。您可以通过按住键盘上的 ALT 并键入 0160 来添加此内容。这样做应该添加通常的 Wiki 段落格式，同时保留 #s 之间的编号。

希望有帮助！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T14:54:20.990

我正在使用 Mediawiki 1.13.3，这有效：

```
#Item1
Somestuff
<ol start="2">
<li>Item2 </li>
</ol> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-04-30T23:54:16.247

如果您希望在编号的 wiki 列表中包含一些块文本，请尝试此操作

```
# one
#:<pre>
#:some stuff
#:some more stuff</pre>
# two 
```

产生：

*   1\. 一

    ```
       一些东西
       还有一些东西
    ```

    *   2\. 两个

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-19T07:58:17.057

"#：" 不能与其他标签一起使用，例如

```
<source lang=javascript>
//...
</source> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-08-01T16:16:23.807

从[Wiki 帮助页面](http://en.wikipedia.org/wiki/Help%3aList)`<p>`，我能够使用和获得列表中的编号以保持一致`<pre>`：

```
# Item 1
# Item 2 <p><pre>Item 2 Pre Stuff</pre></p>
# Item 3 
```

会产生

```
1\. Item 1
2\. Item 2
   [ Item 2 Pre Stuff ]
3\. Item 3 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-08T22:37:29.963

你可以做：

```
# one
# two<br />spanning more lines<br />doesn't break numbering
# three
## three point one
## three point two 
```

普通的旧`<br>`作品也可以，但可能会惹恼某人。

您也可以在不破坏编号的情况下添加其他 HTML 格式以进行`<pre>`格式化等。这也适用于其他列表格式。

来自： [http ://www.mediawiki.org/wiki/Help:Formatting](http://www.mediawiki.org/wiki/Help:Formatting)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-09-26T05:24:26.077

[在指向Wiki Help](http://en.wikipedia.org/wiki/Help%3aList)的链接之后，我找到了一个满足我认为是隐含要求的示例

1.  列表需要保持编号
2.  有时“Somestuff”应该在源代码中自己的行

为了得到 (1)，提出了一些解决方案。错误的一种方法是在额外的“东西”周围使用段落分隔符。

示例 1：

```
# 第 1 段。<p>第 2 段。</p><p>第 3 段。</p>
# 第二项。

```

为了满足 (2)，您可以结合使用段落标记和注释掉新行（使用 <!-- *newline* -->）。

示例 2：

```
# 第 1 段 <!--
  --><p>第 2 段。</p><!--
  --><p>第 3 段。</p>
# 第二项。

```

两个示例都显示为

结果：

```
    1\. 第 1 段。
       第 2 段。
       第 3 段。
    2\. 第二项

```

请注意，注释会吃掉一个元素的结尾和下一个元素的开头之间的所有空白，这似乎是标准做法，如果您试图在没有白色的“wiki 效果”的情况下使用空白，这很有意义空间。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-03-25T16:44:36.830

扩展：复杂列表

[https://www.mediawiki.org/w/index.php?oldid=2126533](https://www.mediawiki.org/w/index.php?oldid=2126533)

放在一起但没有维护（因为没有时间）。它适用于 1.26.2 的 MediaWiki。

例如。

```
<cl>
1.列表项A1

* 列出项目 A2

继续清单项目 A2

进一步继续清单项目 A2

* 列出项目 A3
</cl>
```

变成

1.  列表项 A1
2.  列表项 A2
    继续 列表项 A2
    进一步继续 列表项 A2
3.  清单项目 A3

# .net - 如何在 WinForms WebBrowser 控件中引用生成的 HTML 中的本地资源？

> ID：72103
> 
> 赞同：3
> 
> 时间：2008-09-16T13:22:02.980
> 
> 标签：.net, winforms, webbrowser-control

我正在使用 winforms webbrowser 控件在 Windows 窗体应用程序中显示一些内容。我正在使用 DocumentText 属性来编写生成的 HTML。这部分工作非常出色。现在我想在标记中使用一些图像。（不过，我也更喜欢使用链接的 CSS 和 JavaScript，这可以通过嵌入来解决。）

这几天我一直在谷歌上搜索，似乎找不到标题问题的答案。

我尝试使用相对引用：应用程序 exe 在 bin\debug 中。图像位于项目根目录的“Images”目录中。我已将图像设置为在编译时复制到输出目录，因此它们最终位于 bin\debug\Images* 中。所以我然后使用像这样的“图像...”的参考，认为它将与 exe 相关。但是，当我查看嵌入式浏览器窗口中的图像属性时，我看到图像 URL 为“about:blankImages/*”。当 HTML 写入控件时，一切似乎都与“about:blank”相关。缺少位置上下文，我无法弄清楚相对文件资源引用要使用什么。

我戳了一下控件的属性，看看是否有办法设置一些东西来解决这个问题。我创建了一个空白的 html 页面，并使用“Navigate()”方法将浏览器指向它，并使用文件的完整本地路径。这适用于浏览器报告空白页面的本地“file:///...”路径。然后我再次写入浏览器，这次使用 Document.Write()。同样，浏览器现在将“about:blank”报告为 URL。

除了将动态 HTML 结果写入真实文件之外，没有其他方法可以引用文件资源吗？

我将尝试最后一件事：构建图像的绝对文件路径并将其写入 HTML。我的 HTML 是使用序列化对象的 XML 的 XSL 转换生成的，因此我需要使用一些 XSL 参数，这将花费一些额外的时间，因为我对它们不太熟悉。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T13:43:23.410

这就是我们所做的，尽管我应该提到我们使用自定义 Web 浏览器来删除诸如右键单击并查看良好的旧 IE 上下文菜单之类的功能：

```
public class HtmlFormatter
{
    /// <summary>
    /// Indicator that this is a URI referencing the local
    /// file path.
    /// </summary>
    public static readonly string FILE_URL_PREFIX = 
        "file://";

    /// <summary>
    /// The path separator for HTML paths.
    /// </summary>
    public const string PATH_SEPARATOR = "/";
}

// We need to add the proper paths to each image source
// designation that match where they are being placed on disk.
String html = HtmlFormatter.ReplaceImagePath(
    myHtml, 
    HtmlFormatter.FILE_URL_PREFIX + ApplicationPath.FullAppPath + 
    HtmlFormatter.PATH_SEPARATOR); 
```

基本上，您需要有一个具有文件 URI 的图像路径，例如

```
<img src="file://ApplicationPath/images/myImage.gif"> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:06:58.380

我想通了。

我只是将 exe 目录的完整解析 url 传递给包含带有图像标签的 HTML 输出的 XSL 转换：

```
XsltArgumentList lstArgs = new XsltArgumentList();
lstArgs.AddParam("absoluteRoot", string.Empty, Path.GetFullPath(".")); 
```

然后我只是在所有图像前面加上参数值：

```
<img src="{$absoluteRoot}/Images/SilkIcons/comment_add.gif" align="middle" border="0" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-16T12:10:02.890

我最终使用了与肯建议的基本相同的东西。但是，我没有手动附加文件前缀，而是使用 UriBuilder 类通过“文件”协议构建完整的 URI。

当我们在更真实的位置 Program Files 中测试应用程序时，这也解决了后续问题。空格已被编码，但当使用标准系统路径（即“C:\Program%20Files...”）引用文件时，操作系统无法处理编码字符。使用真正的 URI 值 (file:///C:/Program Files/...) 有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T22:29:11.170

或者，保留您正常样式的相对链接，删除 HTML 转换代码，而是在您的 exe 中嵌入这样的 C# Web 服务器[，](http://www.codeplex.com/webserver)然后将您的 WebControl 指向您的内部 URL，例如 localhost:8199/myapp/

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T09:12:58.003

Ken 的代码缺少一些需要工作的东西。我已经对其进行了修改，并创建了一种新方法，可以稍微自动化一些事情。

只需像这样调用静态方法：

```
html = HtmlFormatter.ReplaceImagePathAuto(html); 
```

并且 html 中与 file://ApplicationPath/ 匹配的所有链接都将与当前工作目录交换。如果要指定备用位置，则包括原始静态方法（加上它丢失的位）。

```
public class HtmlFormatter
{

    public static readonly string FILE_URL_PREFIX = "file://";
    public static readonly string PATH_SEPARATOR = "/";
    public static String ReplaceImagePath(String html, String path)
    {
        return html.Replace("file://ApplicationPath/", path);
    }
    /// <summary>
    /// Replaces URLs matching file://ApplicationPath/... with Executable Path
    /// </summary>
    /// <param name="html"></param>
    /// <returns></returns>
    public static String ReplaceImagePathAuto(String html)
    {
        String executableName = System.Windows.Forms.Application.ExecutablePath;
        System.IO.FileInfo executableFileInfo = new System.IO.FileInfo(executableName);
        String executableDirectoryName = executableFileInfo.DirectoryName;
        String replaceWith = HtmlFormatter.FILE_URL_PREFIX
            + executableDirectoryName
            + HtmlFormatter.PATH_SEPARATOR;

        return ReplaceImagePath(html, replaceWith);
    }
} 
```

# debugging - 如何使用 PDB 文件

> ID：72104
> 
> 赞同：48
> 
> 时间：2008-09-16T13:22:10.687
> 
> 标签：debugging, crash, pdb-files

我听说使用 PDB 文件可以帮助诊断发生崩溃的位置。
我的*基本*理解是，您向 Visual Studio 提供源文件、pdb 文件和崩溃信息（来自 Watson 博士？）
有人可以解释一下它是如何工作的/涉及什么吗？（谢谢！）

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-16T13:25:34.610

PDB 文件将程序集的 MSIL 映射到原始源代码行。这意味着如果您将使用程序集编译的 PDB 与程序集放在同一目录中，您的异常堆栈跟踪将具有原始源文件中位置的名称和行。如果没有 PDB 文件，您将只能看到堆栈跟踪的每个级别的类和方法的名称。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-16T13:31:34.610

PDB 文件是在您构建项目时生成的。它们包含与 Visual Studio 可以解释的已构建二进制文件相关的信息。

当程序崩溃并生成崩溃报告时，Visual Studio 能够获取该报告并通过应用程序的 PDB 文件将其链接回源代码。PDB 文件必须从生成崩溃报告的相同二进制文件构建！

随着时间的推移，我们遇到了一些问题。

*   调试崩溃报告的机器需要与构建二进制文件的机器在同一路径上的源。
*   发布版本通常会优化到无法查看对象成员变量状态的程度

如果有人知道如何打败前者，我将不胜感激。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-25T18:06:58.200

您应该考虑设置符号服务器并将 PDB 文件索引到源代码控制系统。我最近刚刚为我们的产品完成了这个过程，效果很好。您不必担心使 PDB 文件与二进制文件一起可用，也不必担心在调试转储文件时如何获取适当的源代码。

约翰罗宾斯的书：[http ://www.amazon.com/Debugging-Microsoft-NET-2-0-Applications/dp/0735622027/ref=pd_bbs_sr_1?ie=UTF8&s=books&qid=1222366012&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0735622027)

在此处查找一些用于生成小型转储的示例代码（不必仅限于崩溃后分析——您可以在代码中的任何位置生成它们而不会崩溃）： http: [//www.codeproject.com/KB /debug/postmortemdebug_standalone1.aspx](http://www.codeproject.com/KB/debug/postmortemdebug_standalone1.aspx)

# multithreading - 可以让多个线程将相同的值写入相同的变量吗？

> ID：72116
> 
> 赞同：7
> 
> 时间：2008-09-16T13:24:42.693
> 
> 标签：multithreading

我了解竞争条件以及多个线程如何访问同一个变量，一个人所做的更新可以被其他人忽略和覆盖，但是如果每个线程都将相同的值（不是不同的值）写入同一个变量怎么办？甚至这会导致问题吗？这段代码可以：

GlobalVar.property = 11;

（假设该属性永远不会被分配除 11 以外的任何值），如果多个线程同时执行它会导致问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T14:01:06.550

当您读回该状态并对其进行处理时，问题就来了。写入是一条红鲱鱼 - 确实，只要这是一个单词，大多数环境都保证写入将是原子的，但这并不意味着包含此片段的更大代码段是线程安全的。首先，大概你的全局变量包含一个不同的值开始 - 否则如果你知道它总是相同的，为什么它是一个变量？其次，大概你最终会再次**读回这个值？**

问题在于，您可能出于某种原因写入这一共享状态 - 表示发生了某些事情？这就是它失败的地方：当您没有锁定结构时，根本就没有隐含的内存访问顺序。很难指出这里有什么问题，因为您的示例实际上不包含变量的**使用**，所以这是一个中性 C 类语法的简单示例：

```
int x = 0, y = 0;

//thread A does:
x = 1;
y = 2;
if (y == 2)
    print(x);

//thread B does, at the same time:
if (y == 2)
    print(x); 
```

线程 A 将始终打印 1，但线程 B 打印 0 是完全有效的。线程 A 中的操作顺序只需要从线程 A 中执行的代码中可观察到 - 允许线程 B 看到状态的任何组合。对 x 和 y 的写入实际上可能不是按顺序发生的。

即使在单处理器系统上也可能发生这种情况，大多数人并不期望这种重新排序 - 您的编译器可能会为您重新排序。在 SMP 上，即使编译器不重新排序，内存写入也可能在单独处理器的缓存之间重新排序。

如果这似乎没有为您解答，请在问题中包含您示例的更多详细信息。如果不使用该变量，就不可能明确地说这种用法是否安全。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T13:34:19.703

这取决于该语句实际完成的工作。在某些情况下仍然会发生“不好的事情”——例如，如果 C++ 类重载了 = 运算符，并且在该语句中做了任何不平凡的事情。

我不小心编写了使用 POD 类型（内置原始类型）执行类似操作的代码，并且效果很好——但是，这绝对不是一个好习惯，而且我不确定它是否可靠。

为什么不在使用它时锁定这个变量周围的内存呢？事实上，如果你以某种方式“知道”这是唯一可能在代码中出现的写入语句，为什么不直接使用值 11，而不是将其写入共享变量？（**编辑：**我想最好在代码中直接使用常量名称而不是[幻数](https://stackoverflow.com/questions/47882/what-is-a-magic-number-and-why-is-it-bad)11，顺便说一句。）

如果您使用它来确定至少一个线程何时到达此语句，您可以使用从 1 开始的信号量，并由第一个命中它的线程递减。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:27:42.170

我希望结果是不确定的。因为它会因编译器而异，语言因语言而异，操作系统因操作系统而异。所以不，它不安全

你为什么要这样做 - 添加一行以获得互斥锁只是一两行代码（在大多数语言中），并且会消除任何问题的可能性。如果这将是两个昂贵​​的，那么您需要找到解决问题的替代方法

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:43:43.643

In General, this is not considered a safe thing to do unless your system provides for atomic operation (operations that are guaranteed to be executed in a single cycle). The reason is that while the "C" statement looks simple, often there are a number of underlying assembly operations taking place.

Depending on your OS, there are a few things you could do:

*   Take a mutual exclusion semaphore (mutex) to protect access
*   in some OS, you can temporarily disable preemption, which guarantees your thread will not swap out.
*   Some OS provide a writer or reader semaphore which is more performant than a plain old mutex.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-21T17:24:30.707

这是我对这个问题的看法。

您有两个或多个线程正在运行写入变量……例如状态标志或其他东西，您只想知道其中一个或多个是否为真。然后在代码的另一部分（线程完成后），您要检查并查看是否至少在线程上设置了该状态...例如

```
bool flag = false
threadContainer tc
threadInputs inputs

check(input)
{
    ...do stuff to input
    if(success)
        flag = true
}

start multiple threads
foreach(i in inputs) 
   t = startthread(check, i)
   tc.add(t)  // Keep track of all the threads started

foreach(t in tc)
    t.join( )  // Wait until each thread is done

if(flag)
   print "One of the threads were successful"
else
   print "None of the threads were successful" 
```

我相信上面的代码是可以的，假设你不知道哪个线程将状态设置为 true，并且你可以等待所有多线程的东西完成，然后再读取该标志。不过我可能是错的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-21T13:28:16.220

假设该属性永远不会被分配除 11 以外的任何东西，那么我首先看不到分配的理由。那就让它成为一个常数。

分配仅在您打算更改值时才有意义，*除非*分配行为本身具有其他副作用 - 例如 volatile 写入在 Java 中具有内存可见性副作用。如果您更改多个线程之间共享的状态，那么您需要同步或以其他方式“处理”并发问题。

当您在没有适当同步的情况下为多个线程之间共享的某个状态分配一个值时，则无法保证其他线程何时会看到该更改。并且没有可见性保证意味着其他线程可能*永远不会*看到分配。

编译器、JIT、CPU 缓存。他们都试图让你的代码尽可能快地运行，如果你没有对内存可见性提出任何明确的要求，那么他们就会利用这一点。如果不在您的机器上，那么其他人。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-16T13:44:37.870

If the operation is atomic, you *should* be able to get by just fine. But I wouldn't do that in practice. It is better just to acquire a lock on the object and write the value.

# c# - 查找传递给函数的变量名

> ID：72121
> 
> 赞同：86
> 
> 时间：2008-09-16T13:24:55.687
> 
> 标签：c#, asp.net, .net

让我用下面的例子来解释我的问题：

```
public string ExampleFunction(string Variable) {
    return something;
}

string WhatIsMyName = "Hello World";
string Hello = ExampleFunction(WhatIsMyName); 
```

当我将变量传递`WhatIsMyName`给 时`ExampleFunction`，我希望能够获得原始变量名称的字符串。也许是这样的：

```
Variable.OriginalName.ToString() 
```

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-16T13:27:16.633

您想要的不能直接实现，但您可以使用 C# 3.0 中的表达式：

```
public void ExampleFunction(Expression<Func<string, string>> f) {
    Console.WriteLine((f.Body as MemberExpression).Member.Name);
}

ExampleFunction(x => WhatIsMyName); 
```

请注意，这依赖于未指定的行为，虽然它在 Microsoft 当前的 C# 和 VB 编译器**以及**Mono 的 C# 编译器中工作，但不能保证这不会在未来的版本中停止工作。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2015-08-31T14:55:58.367

这不是完全可能的，你想要的方式。C# 6.0 他们引入了 nameof 运算符，这将有助于改进和简化代码。运算符的名称解析传递给它的变量的名称。

您的案例的用法如下所示：

```
public string ExampleFunction(string variableName) {
    //Construct your log statement using c# 6.0 string interpolation
    return $"Error occurred in {variableName}";
}

string WhatIsMyName = "Hello World";
string Hello = ExampleFunction(nameof(WhatIsMyName)); 
```

一个主要的好处是它是在编译时完成的，

> nameof 表达式是一个常量。在所有情况下，nameof(...) 在编译时被评估以产生一个字符串。它的参数在运行时不会被评估，并且被认为是无法访问的代码（但是它不会发出“无法访问的代码”警告）。

更多信息可以在[这里找到](https://msdn.microsoft.com/en-us/magazine/Dn802602.aspx)

**旧版本的 C 3.0 及更高版本**
以 Nawfals 为基础构建答案

```
GetParameterName2(new { variable });

//Hack to assure compiler warning is generated specifying this method calling conventions
[Obsolete("Note you must use a single parametered AnonymousType When Calling this method")]
public static string GetParameterName<T>(T item) where T : class
{
    if (item == null)
        return string.Empty;

    return typeof(T).GetProperties()[0].Name;
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-12-13T16:46:20.270

```
static void Main(string[] args)
{
  Console.WriteLine("Name is '{0}'", GetName(new {args}));
  Console.ReadLine();
}

static string GetName<T>(T item) where T : class
{
  var properties = typeof(T).GetProperties();
  Enforce.That(properties.Length == 1);
  return properties[0].Name;
} 
```

更多细节在[这篇博文](http://web.archive.org/web/20130124234247/http://abdullin.com/journal/2008/12/13/how-to-find-out-variable-or-parameter-name-in-c.html)中。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-02-03T09:53:30.657

三种方式：

1) 完全没有反思的东西：

```
GetParameterName1(new { variable });

public static string GetParameterName1<T>(T item) where T : class
{
    if (item == null)
        return string.Empty;

    return item.ToString().TrimStart('{').TrimEnd('}').Split('=')[0].Trim();
} 
```

2）使用反射，但这比其他两个要快得多。

```
GetParameterName2(new { variable });

public static string GetParameterName2<T>(T item) where T : class
{
    if (item == null)
        return string.Empty;

    return typeof(T).GetProperties()[0].Name;
} 
```

3）最慢的，不要使用。

```
GetParameterName3(() => variable);

public static string GetParameterName3<T>(Expression<Func<T>> expr)
{
    if (expr == null)
        return string.Empty;

    return ((MemberExpression)expr.Body).Member.Name;
} 
```

要获取组合参数名称和值，您可以扩展这些方法。当然，如果您将参数作为另一个参数单独传递，则很容易获得价值，但这很不雅。反而：

1)

```
public static string GetParameterInfo1<T>(T item) where T : class
{
    if (item == null)
        return string.Empty;

    var param = item.ToString().TrimStart('{').TrimEnd('}').Split('=');
    return "Parameter: '" + param[0].Trim() +
           "' = " + param[1].Trim();
} 
```

2)

```
public static string GetParameterInfo2<T>(T item) where T : class
{
    if (item == null)
        return string.Empty;

    var param = typeof(T).GetProperties()[0];
    return "Parameter: '" + param.Name +
           "' = " + param.GetValue(item, null);
} 
```

3)

```
public static string GetParameterInfo3<T>(Expression<Func<T>> expr)
{
    if (expr == null)
        return string.Empty;

    var param = (MemberExpression)expr.Body;
    return "Parameter: '" + param.Member.Name +
           "' = " + ((FieldInfo)param.Member).GetValue(((ConstantExpression)param.Expression).Value);
} 
```

1和2现在速度差不多，3又慢了。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-01-19T16:13:10.443

**是的！** 有可能的。我一直在寻找解决方案很长一段时间，终于想出了一个解决它的黑客（这有点讨厌）。我不建议将它用作程序的一部分，我认为它只在调试模式下工作。对我来说这无关紧要，因为我只在控制台类中将它用作调试工具，所以我可以这样做：

```
int testVar = 1;
bool testBoolVar = True;
myConsole.Writeline(testVar);
myConsole.Writeline(testBoolVar); 
```

控制台的输出将是：

```
testVar: 1
testBoolVar: True 
```

这是我用来执行此操作的函数（不包括我的控制台类的包装代码。

```
 public Dictionary<string, string> nameOfAlreadyAcessed = new Dictionary<string, string>();
    public string nameOf(object obj, int level = 1)
    {
        StackFrame stackFrame = new StackTrace(true).GetFrame(level);
        string fileName = stackFrame.GetFileName();
        int lineNumber = stackFrame.GetFileLineNumber();
        string uniqueId = fileName + lineNumber;
        if (nameOfAlreadyAcessed.ContainsKey(uniqueId))
            return nameOfAlreadyAcessed[uniqueId];
        else
        {
            System.IO.StreamReader file = new System.IO.StreamReader(fileName);
            for (int i = 0; i < lineNumber - 1; i++)
                file.ReadLine();
            string varName = file.ReadLine().Split(new char[] { '(', ')' })[1];
            nameOfAlreadyAcessed.Add(uniqueId, varName);
            return varName;
        }
    } 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2021-11-19T17:29:25.850

我知道这篇文章真的很老了，但是由于.Net 6 现在有一种方法，我想我会分享给其他人知道。

您现在可以使用 CallerArgumentExpressionAttribute，如图所示

```
 /// <summary>
    /// Will throw argument exception if string IsNullOrEmpty returns true
    /// </summary>
    /// <param name="str"></param>
    /// <param name="str_name"></param>
    /// <exception cref="ArgumentException"></exception>
    public static void ValidateNotNullorEmpty(this string str,
        [CallerArgumentExpression("str")]string str_name=null)
    {       
        if (string.IsNullOrEmpty(str))
        {
            throw new ArgumentException($"'{str_name}' cannot be null or empty.", str_name);
        }
    } 
```

现在打电话给：

```
param.ValidateNotNullorEmpty(); 
```

将抛出错误：“参数不能为空或为空。”

而不是“str 不能为空或为空”

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-09-17T08:29:19.493

为了创建良好的异常消息，使人们能够更好地查明错误，这将非常有用。行号有帮助，但您可能无法在 prod 中获得它们，并且当您获得它们时，如果代码中有大语句，您通常只会获得整个语句的第一行。

例如，如果您在未设置的 nullable 上调用 .Value，您将收到带有失败消息的异常，但由于缺少此功能，您将看不到哪个属性为 null。如果您在一个语句中执行此操作两次，例如为某个方法设置参数，您将无法看到未设置哪些可空值。

创建像 Verify.NotNull(myvar, nameof(myvar)) 这样的代码是迄今为止我发现的最好的解决方法，但如果不需要添加额外的参数，那就太好了。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-16T13:31:50.913

不，但是每当您发现自己在做这样极其复杂的事情时，您可能需要重新考虑您的解决方案。请记住，代码应该比编写更容易阅读。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-16T13:32:09.523

System.Environment.StackTrace 将为您提供一个包含当前调用堆栈的字符串。您可以对其进行解析以获取信息，其中包括每个调用的变量名称。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-11-07T12:28:32.997

那么试试这个实用程序类，

```
public static class Utility
{
    public static Tuple<string, TSource> GetNameAndValue<TSource>(Expression<Func<TSource>> sourceExpression)
    {
        Tuple<String, TSource> result = null;
        Type type = typeof (TSource);
        Func<MemberExpression, Tuple<String, TSource>> process = delegate(MemberExpression memberExpression)
                                                                    {
                                                                        ConstantExpression constantExpression = (ConstantExpression)memberExpression.Expression;
                                                                        var name = memberExpression.Member.Name;
                                                                        var value = ((FieldInfo)memberExpression.Member).GetValue(constantExpression.Value);
                                                                        return new Tuple<string, TSource>(name, (TSource) value);
                                                                    };

        Expression exception = sourceExpression.Body;
        if (exception is MemberExpression)
        {
            result = process((MemberExpression)sourceExpression.Body);
        }
        else if (exception is UnaryExpression)
        {
            UnaryExpression unaryExpression = (UnaryExpression)sourceExpression.Body;
            result = process((MemberExpression)unaryExpression.Operand);
        }
        else
        {
            throw new Exception("Expression type unknown.");
        }

        return result;
    }

} 
```

并喜欢它的用户

```
 /*ToDo : Test Result*/
    static void Main(string[] args)
    {
        /*Test : primivit types*/
        long maxNumber = 123123;
        Tuple<string, long> longVariable = Utility.GetNameAndValue(() => maxNumber);
        string longVariableName = longVariable.Item1;
        long longVariableValue = longVariable.Item2;

        /*Test : user define types*/
        Person aPerson = new Person() { Id = "123", Name = "Roy" };
        Tuple<string, Person> personVariable = Utility.GetNameAndValue(() => aPerson);
        string personVariableName = personVariable.Item1;
        Person personVariableValue = personVariable.Item2;

        /*Test : anonymous types*/
        var ann = new { Id = "123", Name = "Roy" };
        var annVariable = Utility.GetNameAndValue(() => ann);
        string annVariableName = annVariable.Item1;
        var annVariableValue = annVariable.Item2;

        /*Test : Enum tyoes*/
        Active isActive = Active.Yes;
        Tuple<string, Active> isActiveVariable = Utility.GetNameAndValue(() => isActive);
        string isActiveVariableName = isActiveVariable.Item1;
        Active isActiveVariableValue = isActiveVariable.Item2;
    } 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-06-06T09:18:53.423

做这个

```
var myVariable = 123;
myVariable.Named(() => myVariable);
var name = myVariable.Name();
// use name how you like 
```

或手动在代码中命名

```
var myVariable = 123.Named("my variable");
var name = myVariable.Name(); 
```

使用这个类

```
public static class ObjectInstanceExtensions
{
    private static Dictionary<object, string> namedInstances = new Dictionary<object, string>();

    public static void Named<T>(this T instance, Expression<Func<T>> expressionContainingOnlyYourInstance)
    {
        var name = ((MemberExpression)expressionContainingOnlyYourInstance.Body).Member.Name;
        instance.Named(name);            
    }

    public static T Named<T>(this T instance, string named)
    {
        if (namedInstances.ContainsKey(instance)) namedInstances[instance] = named;
        else namedInstances.Add(instance, named);
        return instance;
    }        

    public static string Name<T>(this T instance)
    {
        if (namedInstances.ContainsKey(instance)) return namedInstances[instance];
        throw new NotImplementedException("object has not been named");
    }        
} 
```

代码经过测试，是我能想到的最优雅的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T13:52:57.350

感谢所有的回复。我想我只需要继续我现在正在做的事情。

对于那些想知道我为什么问上述问题的人。我有以下功能：

```
string sMessages(ArrayList aMessages, String sType) {
    string sReturn = String.Empty;
    if (aMessages.Count > 0) {
        sReturn += "<p class=\"" + sType + "\">";
        for (int i = 0; i < aMessages.Count; i++) {
            sReturn += aMessages[i] + "<br />";
        }
        sReturn += "</p>";
    }
    return sReturn;
} 
```

我向它发送一组错误消息和一个 css 类，然后将其作为网页的字符串返回。

每次调用这个函数，我都要定义sType。就像是：

```
output += sMessages(aErrors, "errors"); 
```

如您所见，我的变量称为 aErrors，而我的 css 类称为错误。我希望我的感冒能根据我发送的变量名找出要使用的类。

再次感谢所有回复。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-08-04T13:37:44.593

继续`Caller*`属性系列（即`CallerMemberName`和`CallerFilePath`）`CallerLineNumber`，[CallerArgumentExpressionAttribute](https://docs.microsoft.com/es-es/dotnet/api/system.runtime.compilerservices.callerargumentexpressionattribute?view=net-5.0)从 C# Next 开始可用（更多信息[在这里](https://stackoverflow.com/a/64900663/1934546)）。

以下示例的灵感来自 Paul Mcilreavy[在 C# 8.0 中的 CallerArgumentExpression 属性](https://blog.mcilreavy.com/articles/2018-08/caller-argument-expression-attribute)：

```
public static void ThrowIfNullOrWhitespace(this string self, 
             [CallerArgumentExpression("self")] string paramName = default)
{
    if (self is null)
    {
        throw new ArgumentNullException(paramName);
    }

    if (string.IsNullOrWhiteSpace(self))
    {
        throw new ArgumentOutOfRangeException(paramName, self, "Value cannot be whitespace");
    }        
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-10-04T19:39:01.073

感谢visual studio 2022，你可以使用它

功能

```
 public void showname(dynamic obj) {
            obj.GetType().GetProperties().ToList().ForEach(state => {
                NameAndValue($"{state.Name}:{state.GetValue(obj, null).ToString()}");
            });
        } 
```

使用

```
 var myname = "dddd";
   showname(new { myname }); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-16T13:27:48.440

简短的回答是否定的……除非你真的很有动力。

做到这一点的唯一方法是通过反射和堆栈行走。您必须获得一个堆栈框架，在调用函数中找出您从中调用的位置，然后使用 CodeDOM 尝试找到树的正确部分以查看表达式是什么。

例如，如果调用是 ExampleFunction("a" + "b") 怎么办？

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T13:28:18.597

不。对您的字符串变量的引用被传递给函数——不包含任何关于它的固有元数据。即使是反射也不能让你走出困境——从单一引用类型向后工作并不能为你提供足够的信息来做你需要做的事情。

最好回到这个绘图板上！

rp

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-16T13:31:21.757

您可以使用反射来获取对象的所有属性，而不是遍历它，并获取（属性的）名称与传入参数匹配的属性的值。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-16T13:31:29.400

嗯，看了一点。*当然*你不能使用任何类型信息。此外，局部变量的名称在运行时不可用，因为它们的名称未编译到程序集的元数据中。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-16T14:12:27.757

GateKiller，我的解决方法有什么问题？你可以简单地重写你的函数来使用它（我冒昧地改进了这个函数）：

```
static string sMessages(Expression<Func<List<string>>> aMessages) {
    var messages = aMessages.Compile()();

    if (messages.Count == 0) {
        return "";
    }

    StringBuilder ret = new StringBuilder();
    string sType = ((MemberExpression)aMessages.Body).Member.Name;

    ret.AppendFormat("<p class=\"{0}\">", sType);
    foreach (string msg in messages) {
        ret.Append(msg);
        ret.Append("<br />");
    }
    ret.Append("</p>");
    return ret.ToString();
} 
```

像这样称呼它：

```
var errors = new List<string>() { "Hi", "foo" };
var ret = sMessages(() => errors); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-04-24T07:52:31.660

获取它的一种方法是读取代码文件并用逗号和括号将其拆分...

```
var trace = new StackTrace(true).GetFrame(1);
var line = File.ReadAllLines(trace.GetFileName())[trace.GetFileLineNumber()];
var argumentNames = line.Split(new[] { ",", "(", ")", ";" }, 
                               StringSplitOptions.TrimEntries)
                        .Where(x => x.Length > 0)
                        .Skip(1).ToList(); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2021-08-17T11:24:26.533

如果我理解正确，您希望字符串“WhatIsMyName”出现在 Hello 字符串中。

```
string Hello = ExampleFunction(WhatIsMyName); 
```

如果用例是它增加了 ExampleFunction 的可重用性并且 Hello 应包含类似“Hello, Peter (from WhatIsMyName)”的内容，那么我认为解决方案是将 ExampleFunction 扩展为接受：

字符串 Hello = ExampleFunction(WhatIsMyName,nameof(WhatIsMyName));

以便将名称作为单独的字符串传递。是的，这与您所要求的不完全一样，您必须输入两次。但它是重构安全的，可读的，不使用调试接口，并且出错的可能性很小，因为它们一起出现在消费代码中。

```
string Hello1 = ExampleFunction(WhatIsMyName,nameof(WhatIsMyName));
string Hello2 = ExampleFunction(SomebodyElse,nameof(SomebodyElse));
string Hello3 = ExampleFunction(HerName,nameof(HerName)); 
```

* * *

## 回答 #22

> 赞同：-11
> 
> 时间：2008-09-16T13:26:32.687

**不**，我不这么认为。

您使用的变量名称是为了您的方便和可读性。编译器不需要它，如果我没记错的话就把它扔掉。

如果有帮助，您可以定义一个新类`NamedParameter`，使用属性`Name`和`Param`. 然后将此对象作为参数传递。

# tdd - 关于 TDD 有哪些常见的误解？

> ID：72123
> 
> 赞同：11
> 
> 时间：2008-09-16T13:25:06.390
> 
> 标签：tdd

阅读对这个问题的回复[测试驱动开发的缺点？](https://stackoverflow.com/questions/64333/what-is-the-downside-to-test-driven-development)我的印象是对什么是 TDD 以及应该如何进行有很多误解。在这里解决这些问题可能会被证明是有用的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T13:42:35.597

我觉得公认的答案是最弱的答案之一（[测试驱动开发的缺点？](https://stackoverflow.com/questions/64333/what-is-the-downside-to-test-driven-development#67184)），而且最上调的答案是可能正在编写指定测试的人的味道。

> 大时间投资：对于简单的情况，你会损失大约 20% 的实际实现，但对于复杂的情况，你会损失更多。

TDD是一种投资。我发现，一旦我完全投入到 TDD 中，我失去的时间是非常少的，而当涉及到维护时间时，我失去的时间比弥补的要多。

> 对于复杂案例，您的测试案例更难计算，我建议在这种情况下尝试使用将在调试版本/测试运行中并行运行的自动参考代码，而不是最简单案例的单元测试。

如果您的测试变得非常复杂，那么可能是时候审查您的设计了。TDD 应该引导您走上更小、更简单的代码单元协同工作的道路

> 有时您的设计一开始并不清楚，并且随着您的进行而不断发展-这将迫使您重做测试，这将导致大量时间损失。在这种情况下，我建议您推迟单元测试，直到您对设计有所了解。

这是他们中最糟糕的一点！TDD 真的应该是“测试驱动**设计**”。TDD 是关于设计，而不是测试。要充分实现 TDD 优势的价值，您必须通过测试来**驱动**您的设计。因此，您应该*重做*您的生产代码以使您的测试通过，而不是正如这一点所暗示的那样

现在更新最多的：[测试驱动开发的缺点？](https://stackoverflow.com/questions/64333/what-is-the-downside-to-test-driven-development#64381)

> 当您有大量测试时，更改系统可能需要重新编写部分或全部测试，具体取决于哪些测试因更改而无效。这可能会将相对快速的修改变成非常耗时的修改。

就像公认的答案第一点一样，这似乎是测试中的过度规范以及对 TDD 过程的普遍缺乏理解。进行更改时，请从您的测试开始。更改新代码应该做什么的测试，并进行更改。如果该更改破坏了其他测试，那么您的测试正在做他们应该做的事情，但失败了。对我来说，单元测试被设计为失败，因此为什么 RED 阶段是第一阶段，并且永远不应错过。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T13:48:14.570

恕我直言，关于 TDD 的最大误解是：**花在编写和重构测试上的时间会浪费掉。**这种想法就像“是的，一个测试套件很好，但如果我们只是编码它，这个功能会更快地完成”。

如果处理得当，编写和维护测试的时间可以在项目的整个生命周期内多次节省，而*不是*花费在调试和修复回归上的时间。由于测试成本是预先支付的，而回报是随着时间的推移而产生的，因此很容易被忽视。

其他重大误解包括忽略 TDD 对设计过程的影响，没有意识到“痛苦的测试”是一种需要快速修复的严重代码异味。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:37:29.010

我看到很多人误解了哪些测试实际上对 TDD 有用。人们编写大型验收测试而不是小型单元测试，然后花费太多时间维护他们的测试，然后得出结论认为 TDD 不起作用。我认为 BDD 人员完全避免使用测试这个词是有道理的。

另一个极端是人们停止进行验收测试，并认为因为他们进行了单元测试，所以他们的代码已经过测试。这又是对单元测试功能的误解。你仍然需要某种形式的验收测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:29:07.360

我经常看到的误解是 TDD 确保了良好的结果。

很多时候，测试是从有缺陷的需求中删除的，因此，开发人员生产的产品不能满足用户的期望。在我看来，TDD 的关键是与用户一起定义需求，同时帮助管理他们的期望。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T13:35:37.830

这些是我认为颇具争议并因此容易产生误解的问题：

*   以我的经验，最大的优势是以花费大量时间编写测试为代价生成更好的代码。因此，对于需要高质量的项目来说，这确实是值得的，但在其他一些以质量不高的网站上，额外的时间将不值得付出努力。

*   人们似乎认为只需要测试功能的主要子集，但恕我直言，这实际上是错误的。您需要测试所有内容，以使您的测试在重构后有效。

*   TDD 的一大缺点是不完整的测试带来的错误安全感：我见过一些网站宕机，因为人们认为单元测试足以触发部署。

*   不需要模拟框架来执行 TDD。它只是一种以更简单的方式测试某些案例的工具。最好的单元测试虽然在堆栈中处于高位，但应该与代码中的层无关。在这种情况下，一次测试一层是没有意义的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-12T08:55:31.463

只是把另一个答案扔进锅里。

最常见的误解之一是您的**代码是固定**的，即。我有这个代码，现在我将如何测试它？如果编写测试很难，我们应该问一个问题：如何更改此代码以使其更易于测试？

**为什么..？**

那么易于测试的代码是：

1.  模块化 - 每种方法都做一件事。
2.  参数化 - 每个方法都接受它需要的一切并输出它应该输出的一切。
3.  明确规定——每种方法都完全按照它应该做的，不多也不少。

如果我们编写这样的代码，测试是轻而易举的事。有趣的是，巧合的是，易于测试的代码是**更好的代码**。

Better as in easier to **read**, easier to **test**, easier to **understand**, easier to **debug**. This is why TDD is often described as a design exercise.

# c# - 如何在应用程序域之间传递经过身份验证的会话

> ID：72125
> 
> 赞同：9
> 
> 时间：2008-09-16T13:25:10.240
> 
> 标签：c#, asp.net, asp.net-membership, membership

假设您有网站 www.xyz.com 和 www.abc.com。

假设用户访问 www.abc.com 并通过正常的 ASP .NET 成员资格提供程序进行身份验证。

然后，从该站点，它们被发送到（重定向、链接、任何工作）站点 www.xyz.com，站点 www.abc.com 的目的是将该用户作为 isAuthenticated 状态传递到另一个站点，这样网站 www.xyz.com 就不会再次要求该用户的凭据。

这需要什么才能起作用？不过，我对此有一些限制，用户数据库是完全独立的，它不是组织内部的，在所有方面，就像从 stackoverflow.com 传递到经过身份验证的谷歌一样，它本质上是独立的。相关文章的链接就足够了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T14:41:42.460

尝试通过设置 web.config 身份验证部分来使用 FormAuthentication，如下所示：

```
<authentication mode="Forms">
  <forms name=".ASPXAUTH" requireSSL="true" 
      protection="All" 
      enableCrossAppRedirects="true" />
</authentication> 
```

生成机器密钥。示例：[生成 MachineKey 的最简单方法 - 提示和技巧：ASP.NET、IIS ...](https://blogs.msdn.microsoft.com/amb/2012/07/31/easiest-way-to-generate-machinekey/)

当发布到其他应用程序时，身份验证票作为隐藏字段传递。从第一个应用程序读取帖子时，第二个应用程序将读取加密票证并对用户进行身份验证。这是传递该字段的页面示例：

.aspx：

```
<form id="form1" runat="server">
  <div>
    <p><asp:Button ID="btnTransfer" runat="server" Text="Go" PostBackUrl="http://otherapp/" /></p>
    <input id="hdnStreetCred" runat="server" type="hidden" />
  </div>
</form> 
```

代码隐藏：

```
protected void Page_Load(object sender, EventArgs e)
{
    FormsIdentity cIdentity = Page.User.Identity as FormsIdentity;
    if (cIdentity != null)
    {
        this.hdnStreetCred.ID = FormsAuthentication.FormsCookieName;
        this.hdnStreetCred.Value = FormsAuthentication.Encrypt(((FormsIdentity)User.Identity).Ticket);
    }
} 
```

另请参阅Wrox[本书](http://www.wrox.com/WileyCDA/WroxTitle/Professional-ASP-NET-2-0-Security-Membership-and-Role-Management.productCd-0764596985.html)第 5 章中的跨应用程序表单身份验证部分。除了提供自制 SSO 解决方案外，它还推荐与上述类似的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T13:56:05.050

如果您使用的是内置的会员系统，您可以通过在每个 web.config 中使用类似这样的方式使用表单身份验证进行跨子域身份验证。

```
<authentication mode="Forms">
    <forms name=".ASPXAUTH" loginUrl="~/Login.aspx" path="/" 
                  protection="All" 
                  domain="datasharp.co.uk" 
                  enableCrossAppRedirects="true" />

</authentication> 
```

确保所有 web.config 中的名称、路径、保护和域都相同。如果站点位于不同的机器上，您还需要确保 machineKey 以及验证和加密密钥相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:40:47.957

如果您将用户会话存储在数据库中，您可以简单地检查会话表中 Guid 的存在，如果存在，则用户已经在另一个域上进行了身份验证。为此，当您将用户重定向到其他网站时，您必须在 URL 中包含会话 guid。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:27:47.020

不确定您将用于 .NET 的内容，但通常我会在 LAMP 堆栈中使用[memcached 。](http://www.danga.com/memcached/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T13:39:14.887

分辨率取决于应用程序的类型和运行它的环境。例如，在具有 NT 域的 Intranet 上，您可以使用 NTLM 将 Windows 凭据直接传递到 Intranet 外围的服务器，而无需复制会话。

如何做到这一点的方法通常称为*单点登录*（参见[Wikipedia](http://en.wikipedia.org/wiki/Single_sign-on)）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T14:10:01.537

这个问题有多种方法，被描述为“跨域单点登录”。如果您正在寻找开源解决方案，Matej 指出的维基百科文章特别有用 - 但是 - 在 Windows 环境中，我相信您最好使用以下两种方法之一：

1.  购买商业 SSO 产品（如 SiteMinder 或 PingIdentity）
2.  使用 MicroSoft 的跨域 SSO 解决方案，称为[ADFS](http://technet.microsoft.com/en-us/library/cc786469.aspx) - Active Directory Federation Services。（联邦是协调多个域的行为的术语）

我使用过 SiteMinder，它运行良好，但价格昂贵。如果您处于全 MicroSoft 环境中，我认为 ADFS 是您最好的选择。从这份[ADFS 白皮书](http://www.microsoft.com/WindowsServer2003/R2/Identity_Management/ADFSwhitepaper.mspx)开始。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T14:45:19.487

我会使用 CAS 之类的东西：

[1]：[http](http://www.ja-sig.org/products/cas/) ://www.ja-sig.org/products/cas/ CAS

这是一个已解决的问题，不建议自己滚动。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-16T14:26:25.680

或者，如果您想推出自己的网站并且有问题的网站不在同一台服务器上或无法访问共享数据库（在这种情况下，请参阅上述回复），那么您可以在每个网站上放置一个[网络信标](http://en.wikipedia.org/wiki/Web_beacon)这将引用到另一个站点。

在站点 A 上放置一个单像素图像（网络信标），该站点将通过用户 ID（加密和时间戳）调用站点 B。然后，这将为用户在站点 B 上创建一个新的用户会话，并将其设置为已登录。然后，当用户访问站点 B 时，他们将已经登录。

为了尽量减少通话，您只能将网络信标放在主页上和/或登录确认页面。我过去曾成功地使用它在合作伙伴站点之间传递信息。

# c++ - 查找是否已使用 3D 坐标的最快方法

> ID：72128
> 
> 赞同：3
> 
> 时间：2008-09-16T13:25:23.940
> 
> 标签：c++, performance

使用 C++（和 Qt），我需要处理大量的 3D 坐标。

具体来说，当我收到一个 3D 坐标（由 3 个双精度值组成）时，如果该坐标已经被处理，我需要检查一个列表。如果没有，那么我处理它并将其添加到列表（或容器）中。

坐标的数量可能会变得非常大，所以我需要将处理后的坐标存储在一个容器中，这样可以确保快速检查容器中是否已经包含 3D 坐标。

我正在考虑使用地图的地图，存储x坐标，然后是y坐标，然后是z坐标，但这使得使用起来非常乏味，所以我实际上希望有更好的方法来做我想不到的事。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T13:36:14.990

加速此类处理的最简单方法可能是将已处理的点存储在[Octree](http://en.wikipedia.org/wiki/Octree)中。检查重复将变得接近对数。

此外，通过检查点之间的距离，而不是坐标的相等性，确保您容忍舍入误差。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T14:00:53.823

您可以按如下方式轻松使用集合：

```
#include <set>
#include <cassert>

const double epsilon(1e-8);

class Coordinate {
public:
Coordinate(double x, double y, double z) :
  x_(x), y_(y), z_(z) {}

private:
double x_;
double y_;
double z_;

friend bool operator<(const Coordinate& cl, const Coordinate& cr);
};

bool operator<(const Coordinate& cl, const Coordinate& cr) {
  if (cl.x_ < cr.x_ - epsilon) return true;
  if (cl.x_ > cr.x_ + epsilon) return false;

  if (cl.y_ < cr.y_ - epsilon) return true;
  if (cl.y_ > cr.y_ + epsilon) return false;

  if (cl.z_ < cr.z_ - epsilon) return true;

  return false;

}

typedef std::set<Coordinate> Coordinates;

// Not thread safe!
// Return true if real processing is done
bool Process(const Coordinate& coordinate) {
  static Coordinates usedCoordinates;

  // Already processed?
  if (usedCoordinates.find(coordinate) != usedCoordinates.end()) {
    return false;
  }

  usedCoordinates.insert(coordinate);

  // Here goes your processing code

  return true;

}

// Test it
int main() {
  assert(Process(Coordinate(1, 2, 3)));
  assert(Process(Coordinate(1, 3, 3)));
  assert(!Process(Coordinate(1, 3, 3)));
  assert(!Process(Coordinate(1+epsilon/2, 2, 3)));
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T13:46:26.697

将您的空间划分为离散的垃圾箱。可以是无限深的正方形，也可以是立方体。将处理后的坐标存储在一个简单的链表中，如果您愿意，可以在每个 bin 中进行排序。当你得到一个新的坐标时，跳到封闭的 bin，然后遍历列表寻找新的点。

小心浮点比较。您需要将值转换为整数（例如乘以 1000 并截断），或者决定将 2 个值视为相等的接近程度。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T13:46:25.433

假设您已经有一个 Coordinate 类，添加一个哈希函数并维护一个 hash_set 坐标。看起来像：

```
struct coord_eq
{
  bool operator()(const Coordinate &s1, const Coordinate &s2) const
  {
    return s1 == s2;
    // or: return s1.x() == s2.x() && s1.y() == s2.y() && s1.z() == s2.z();
  }
};

struct coord_hash
{
  size_t operator()(const Coordinate &s) const
  {
     union {double d, unsigned long ul} c[3];
     c[0].d = s.x();
     c[1].d = s.y();
     c[2].d = s.z();
     return static_cast<size_t> ((3 * c[0].ul) ^ (5 * c[1].ul) ^ (7 * c[2].ul));
  }
};

std::hash_map<Coordinate, coord_hash, coord_eq> existing_coords; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T13:30:49.510

好吧，这取决于什么是最重要的……如果三重映射太乏味而无法使用，那么实现其他数据结构是否不值得努力？

如果你想绕过三重地图解决方案的丑陋，只需将其包装在另一个容器类中，该容器类具有一个具有三个参数的访问函数，并在其中隐藏所有与地图有关的混乱。

如果您更担心这个东西的运行时性能，将坐标存储在[八叉树](http://en.wikipedia.org/wiki/Octree)中可能是一个好主意。

另外值得一提的是，使用浮点数或双精度数做这些事情时，您应该非常小心精度——如果 (0, 0, 0.01) 与 (0, 0, 0.01000001) 的坐标相同？如果是，则无论数据结构如何，您都需要查看使用的比较函数。我猜这也取决于您的坐标来源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T13:31:59.117

您是否期望/需要完全匹配？这些可能很难通过双打来执行。例如，如果您处理了 (1.0, 1.0, 1.0)，然后收到 (0.9999999999999, 1.0, 1.0)，您会认为它相同吗？如果是这样，您将需要应用某种近似值或定义误差范围。

但是，要回答这个问题本身：首先想到的方法是创建一个索引（字符串或位串，取决于您希望事物的可读性）。例如，创建字符串“(1.0,1.0,1.0)”并将其用作地图的键。这将使查找地图变得容易，保持代码的可读性（并且还可以让您轻松转储地图的内容以进行调试）并为您提供合理的性能。如果您需要更快的性能，您可以使用散列算法以数字方式组合三个坐标，而无需通过字符串。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T13:32:36.683

如何使用 boost::tuple 作为坐标，并将元组存储为地图的索引？

（您可能还需要从这个答案中做除以 epsilon 的想法。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T13:34:28.003

使用 3D 坐标的任何唯一变换并仅存储结果列表。

示例： md5('X, Y, Z') 是唯一的，您只能存储结果字符串。

哈希不是一个高性能的想法，但你明白了这个概念。找到任何独特的数学变换，你就有了。

/维

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T13:47:47.847

使用 std::set。为定义了 operator< 的 3d 坐标定义一个类型（或使用 boost::tuple）。添加元素时，您可以将其添加到集合中，如果已添加，则进行处理。如果它没有被添加（因为它已经存在在那里），不要做你的处理。

但是，如果您使用双打，请注意您的算法可能会导致不可预测的行为。IE, (1.0, 1.0, 1.0) 和 (1.0, 1.0, 1.000000001) 一样吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T13:33:18.147

选择一个常数来缩放坐标，以便 1 个单位描述一个可接受的小盒子，但最大分量的整数部分将适合 32 位整数；将结果的 X、Y 和 Z 分量转换为整数并将它们散列在一起。将其用作地图或哈希表的哈希函数（不作为数组索引，您需要处理冲突）。

在比较坐标时，您可能还需要考虑使用软糖因子，因为您可能会得到仅略有不同的浮点值，通常最好将它们焊接在一起以避免渲染时出现裂缝。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T13:35:11.917

如果你用一个简单的公共接口编写一个辅助类，这会大大减少实现细节的实际乏味，比如使用`map<map<map<>>>`. 封装之美！

就是说，您可能能够装配一个哈希图来很好地完成这个技巧。只需将三个双打散列在一起即可获得整个点的关键。如果您担心对称坐标点之间的许多冲突（例如，（1、2、3）和（3、2、1）等），只需使哈希键相对于 x、y 不对称, 和 z 坐标，使用位移或类似的方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T13:38:19.103

您可以使用任何可散列类型的[hash_set](http://www.sgi.com/tech/stl/hash_set.html) - 例如，将每个元组转换为字符串“(x, y, z)”。hash_set 可以快速查找，但可以很好地处理冲突。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T13:38:34.890

无论您使用哪种存储方法，我都建议您确定一个 epsilon（区分两个坐标的最小浮点距离），然后将所有坐标除以 epsilon，四舍五入并将它们存储为整数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T13:44:08.073

这个方向的东西可能：

```
struct Coor {
    Coor(double x, double y, double z)
    : X(x), Y(y), Z(z) {}
    double X, Y, Z;
}

struct coords_thesame
{
  bool operator()(const Coor& c1, const Coor& c2) const {
    return c1.X == c2.X && c1.Y == c2.Y && c1.Z == c2.Z;
  }
};

std::hash_map<Coor, bool, hash<Coor>, coords_thesame> m_SeenCoordinates; 
```

未经测试，使用后果自负:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-16T13:47:05.243

您可以轻松地为 one-level 定义一个比较器`std::map`，这样查找就变得不那么麻烦了。没有理由害怕这一点。比较器定义映射的 _Key 模板参数的顺序。然后它也可以用于多图和集合集合。

一个例子：

```
#include <map>
#include <cassert>

struct Point {
  double x, y, z;
};

struct PointResult {
};

PointResult point_function( const Point& p ) { return PointResult(); }

// helper: binary function for comparison of two points
struct  point_compare {
  bool operator()( const Point& p1, const Point& p2 ) const {
    return p1.x < p2.x
      || ( p1.x == p2.x && ( p1.y < p2.y 
      || ( p1.y == p2.y && p1.z < p2.z ) 
      )
      );
  }
};

typedef std::map<Point, PointResult, point_compare> pointmap;

int _tmain(int argc, _TCHAR* argv[])
{

pointmap pm;

Point p1 = { 0.0, 0.0, 0.0 };
Point p2 = { 0.1, 1.0, 1.0 };

pm[ p1 ] = point_function( p1 );
pm[ p2 ] = point_function( p2 );
assert( pm.find( p2 ) != pm.end() );
    return 0;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T14:00:47.113

有很多方法可以做到这一点，但你必须先问问自己你的假设和条件是什么。

因此，假设您的空间大小有限并且您知道最大精度是多少，那么您可以形成一个函数，给定 (x,y,z) 将它们转换为唯一的数字或字符串 - 只有在您知道您的准确性是有限的（例如 - 没有两个实体可以占据相同的立方厘米）。编码坐标允许您使用具有 O(1) 的单个地图/散列。

如果不是这种情况，您始终可以按照您的建议使用 3 个嵌入地图，或者使用空间划分算法（例如提到的 OcTree），尽管在平均搜索中给出 O(logN)，但它们也会为您提供额外的信息可能想要（邻居、人口等），但当然更难实现。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-16T14:02:52.053

您可以使用`std::set`3D 坐标，也可以使用排序的`std::vector`. 两者都会给你对数时间查找。无论哪种情况，您都需要为您的 3D 坐标类实现小于比较运算符。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-16T18:12:41.110

何苦？你在做什么“处理”？除非它非常复杂，否则再次进行计算可能会更快，而不是浪费时间在巨大的地图或哈希表中查找内容。

这是关于现代 cpu 的更违反直觉的事情之一。计算快，内存慢。

我意识到这并不是对您问题的真正答案，而是在质疑您的问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-16T23:08:39.310

好问题......它有很多解决方案，因为这种类型的问题在图形和科学应用程序中多次出现。

根据您需要的解决方案，它的底层可能相当复杂，在这种情况下，更少的代码并不一定意味着更快。

*“但这使得使用起来非常乏味”* --- 通常，您可以通过 typedefs 或包装类来解决这个问题（强烈推荐在这种情况下使用包装）。

如果您不需要以任何具有空间意义的方式使用 3D 坐标（例如“给我点 P 的 X 距离内的所有点”），那么我建议您找到一种方法来散列每个点，并使用单个哈希映射... O(n) 创建，O(1) 访问（检查它是否已被处理），你不能做得比这更好。

如果您确实需要更多空间信息，则需要一个明确考虑到它的容器。您选择的容器类型将取决于您的数据集。如果您对收到的值范围有很好的了解，这将有所帮助。

如果您在已知范围内接收分布良好的数据......请使用[octree](http://en.wikipedia.org/wiki/Octree)。

如果您有一个倾向于聚集的分布，那么使用[kd trees](http://en.wikipedia.org/wiki/Kd_tree)。在输入新坐标后，您需要重建一个 kd 树（不一定每次都如此，只是在它变得过度不平衡时）。简而言之，Kd-trees 类似于八叉树，但具有非均匀划分。

# sql - ORA-00933: SQL 命令未正确结束

> ID：72151
> 
> 赞同：5
> 
> 时间：2008-09-16T13:27:53.823
> 
> 标签：sql, oracle, ora-00933

我正在使用用于 ADO.Net 的 OLEDB 提供程序连接到 Oracle 数据库。在我的循环中，我正在插入：

```
insert into ps_tl_compleave_tbl values('2626899', 0, TO_DATE('01/01/2002', 'MM/DD/YYYY'), 'LTKN', 'LTKN', '52', TO_DATE('01/01/2002', 'MM/DD/YYYY'), 16.000000, 24.000)insert into ps_tl_compleave_tbl values('4327142', 0, TO_DATE('03/23/2002', 'MM/DD/YYYY'), 'LTKN', 'LTKN', '51', TO_DATE('03/23/2002', 'MM/DD/YYYY'), 0.000000, 0.000) 
```

第一次插入成功，但第二次出现错误：

```
ORA-00933: SQL command not properly ended 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-05-19T10:03:04.247

在 .net 中，当我们尝试执行以分号结尾的单个 Oracle SQL 语句时。结果将是一个 oracle 错误：ora-00911: invalid character。好的，您认为一个 SQL 语句不需要分号，但是在一个字符串中执行 2 个 SQL 语句呢，例如：

```
Dim db As Database = DatabaseFactory.CreateDatabase("db")
Dim cmd As System.Data.Common.DbCommand
Dim sql As String = ""

sql = "DELETE FROM iphone_applications WHERE appid = 1; DELETE FROM iphone_applications WHERE appid = 2; "

cmd = db.GetSqlStringCommand(sql)
db.ExecuteNonQuery(cmd) 
```

上面的代码会给你同样的 Oracle 错误：ora-00911: invalid character。

这个问题的解决方案是用`BEGIN`and`END;`语法包装你的 2 个 Oracle SQL 语句，例如：

```
sql = "BEGIN DELETE FROM iphone_applications WHERE appid = 1; DELETE FROM iphone_applications WHERE appid = 2; END;" 
```

礼貌：[http ://www.lazyasscoder.com/Article.aspx?id=89&title=ora-00911%3A+invalid+character+when+executing+multiple+Oracle+SQL+statements](http://www.lazyasscoder.com/Article.aspx?id=89&title=ora-00911%3A+invalid+character+when+executing+multiple+Oracle+SQL+statements)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-06-19T14:25:22.847

在 Oracle 中，分号 ';' 仅在 sqlplus 中使用。当您使用 ODBC/JDBC、OLEDB 等时，您不要在语句末尾添加分号。在上述情况下，您实际上正在执行 2 个不同的语句，因此处理问题的最佳方法是使用 2 个语句而不是尝试组合成一个语句，因为您不能使用分号。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T13:29:25.613

第一次插入后的半冒号？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T13:30:55.970

对我来说，您似乎`;`在这两个语句之间缺少一个： 尝试添加并让我们知道。
`insert into ps_tl_compleave_tbl values('2626899', 0, TO_DATE('01/01/2002', 'MM/DD/YYYY'), 'LTKN', 'LTKN', '52', TO_DATE('01/01/2002', 'MM/DD/YYYY'), 16.000000, 24.000)`
**`;`**
`insert into ps_tl_compleave_tbl values('4327142', 0, TO_DATE('03/23/2002', 'MM/DD/YYYY'), 'LTKN', 'LTKN', '51', TO_DATE('03/23/2002', 'MM/DD/YYYY'), 0.000000, 0.000)`
**`;`**
`;`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T13:29:53.100

Oracle SQL 使用分号；作为其语句结束标记。

您将需要添加 ; 在打扰插入语句之后。

注意：这也假设 ADODB 将允许在一次调用中进行 2 次插入。

另一种方法可能是将两个调用包装在一个块中，

```
BEGIN
      insert (...) into (...);
      insert (...) into (...);
END; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T14:33:08.767

在我的循环中，我没有重新初始化我的 StringBuilder ...因此我发布了多个插入语句。

还是要谢谢你的帮助！！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T13:35:16.427

这是一个很长的镜头，但在第一次插入中，sql 日期格式对英国/美国都有效，如果 Oracle DB 设置为英国日期格式，第二次插入无效，我意识到你已经使用了 TO_DATE 函数，但我没有看看别的...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T13:54:27.037

ADO.NET OLE DB 提供程序用于您没有特定数据库提供程序的通用数据访问。使用 OracleConnection 等优先于 OleDbConnection 进行 Oracle 数据库连接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T00:12:46.800

除了分号问题，我强烈建议您查看绑定变量。不使用它们可能会导致数据库性能问题。代码也往往更干净。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-02-01T19:03:45.577

问题可能是您在查询中插入了一个为 null 的参数变量。这就是我的问题所在。一旦我给参数一个空字符串的默认值，它就起作用了。

# .net - MSBuild ItemGroup，不包括 .svn 目录和文件

> ID：72153
> 
> 赞同：40
> 
> 时间：2008-09-16T13:28:06.710
> 
> 标签：.net, msbuild, continuous-integration

如何构造一个 MSBuild ItemGroup 以排除 .svn 目录和（递归）其中的所有文件。我有：

```
<ItemGroup> 
     <LibraryFiles Include="$(LibrariesReleaseDir)\**\*.*" Exclude=".svn" />
</ItemGroup> 
```

目前，但这并不排除任何事情！

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-16T13:57:29.650

感谢您的帮助，设法将其排序如下：

```
<ItemGroup>
     <LibraryFiles Include="$(LibrariesReleaseDir)\**\*.*" 
                   Exclude="$(LibrariesReleaseDir)\**\.svn\**" />
</ItemGroup> 
```

结果发现模式匹配基本上在文件上运行，因此您必须排除`.svn`目录 ( `.svn\\**`) 下方的所有内容，以便 MSBuild 排除`.svn`目录本身。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-04T22:23:18.870

所以问题在于在msbuild中出于某种原因链接变量。以下对我有用，请注意我必须只使用基于 MSBuildProjectDirectory 变量的相对路径。

```
<CreateItem Include="$(MSBuildProjectDirectory)\..\Client\Web\Foo.Web.UI\**\*.*"
            Exclude="$(MSBuildProjectDirectory)\..\Client\Web\Foo.Web.UI\**\.svn\**">
  <Output TaskParameter="Include" ItemName="WebFiles" />
</CreateItem> 
```

以下不起作用：

```
<PropertyGroup>
    <WebProjectDir>$(MSBuildProjectDirectory)\..\Client\Web\Foo.Web.UI</WebProjectDir>
</PropertyGroup>
<CreateItem Include="$(WebProjectDir)\**\*.*"
            Exclude="$(WebProjectDir)\**\.svn\**">
  <Output TaskParameter="Include" ItemName="WebFiles" />
</CreateItem> 
```

很奇怪！我只花了大约 3 个小时在这个上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T13:20:33.043

这是一种更好的方法，真正递归。我似乎无法让您的解决方案超过 1 级：

```
<LibraryFiles  
    Include="$(LibrariesReleaseDir)**\*.*"  
    Exclude="$(LibrariesReleaseDir)**\.svn\**\*.*"/> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-30T16:23:24.083

我在使用 Include/Exclude 方法时遇到了一些小故障，所以这里有一些对我有用的东西：

```
<ItemGroup>
    <MyFiles Include=".\PathToYourStuff\**" />
    <MyFiles Remove=".\PathToYourStuff\**\.svn\**" />
</ItemGroup> 
```

# sql - 渗透测试工具

> ID：72166
> 
> 赞同：45
> 
> 时间：2008-09-16T13:29:35.473
> 
> 标签：sql, security, sql-injection

我们有数百个使用 asp、.net 和 java 开发的网站，我们支付大量资金让外部机构对我们的网站进行渗透测试，以检查安全漏洞。有没有（好的）软件（付费或免费）可以做到这一点？

或者.. 是否有任何技术文章可以帮助我开发此工具？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-16T16:56:22.403

您可以使用 Web 应用程序的自动化测试工具有几个不同的方向。

首先是**商业网络扫描仪**，其中 HP WebInspect 和 Rational AppScan 是最流行的两种。这些是“一体式”、“即发即弃”的工具，您可以下载并安装在内部 Windows 桌面上，然后提供 URL 以抓取您的站点，扫描已知漏洞（即， Bugtraq)，并探测跨站点脚本和 SQL 注入漏洞。

其次，还有**源代码扫描工具**，其中 Coverity 和 Fortify 可能是最著名的两个。这些是您安装在开发人员桌面上的工具，用于处理您的 Java 或 C# 源代码并查找众所周知的不安全代码模式，例如输入验证不佳。

最后，还有**渗透测试工具**。到目前为止，安全专业人员中最受欢迎的 Web 应用渗透测试工具是 Burp Suite，您可以在[http://www.portswigger.net/proxy](http://www.portswigger.net/proxy)找到它。其他包括 Spike Proxy 和 OWASP WebScarab。同样，您将在内部 Windows 桌面上安装它。它将作为 HTTP 代理运行，您将浏览器指向它。您将像普通用户一样使用您的应用程序，同时它会记录您的操作。然后，您可以返回到每个单独的页面或 HTTP 操作并探测它是否存在安全问题。

在复杂的环境中，特别是如果你正在考虑任何 DIY，**我强烈推荐渗透测试工具**。原因如下：

商业网络扫描仪提供了很多“广度”，以及出色的报告。然而：

*   他们往往会错过一些东西，因为每个应用程序都是不同的。

*   它们很昂贵（WebInspect 起价为 10 万）。

*   您正在为不需要的东西付费（例如 90 年代已知的不良 CGI 数据库）。

*   它们很难定制。

*   它们会产生嘈杂的结果。

源代码扫描器比网络扫描器更彻底。然而：

*   它们甚至比网络扫描仪还要贵。

*   它们需要源代码才能运行。

*   为了有效，它们通常要求您对源代码进行注释（例如，挑选输入路径）。

*   他们有产生误报的倾向。

商业扫描仪和源代码扫描仪都有成为架子的坏习惯。更糟糕的是，即使它们有效，其成本也相当于让咨询公司审核 1 或 2 个完整的应用程序；如果您信任您的顾问，那么您肯定会从他们那里获得比从工具中获得更好的结果。

渗透测试工具也有缺点：

*   它们比即用即忘的商业扫描仪更难使用。

*   他们假设在 Web 应用程序漏洞方面具有一定的专业知识——你必须知道你在寻找什么。

*   他们很少或根本没有正式报告。

另一方面：

*   它们要便宜得多——最好的 Burp Suite，只需 99EU，并且有免费版本。

*   它们很容易定制并添加到测试工作流程中。

*   它们更擅长帮助您从内部“了解”您的应用程序。

以下是您使用渗透测试工具对基本 Web 应用程序执行的操作：

1.  通过代理登录应用程序

2.  创建应用程序主要功能区域的“命中列表”，并分别练习一次。

3.  在您的渗透测试应用程序中使用“蜘蛛”工具来查找应用程序中的所有页面、操作和处理程序。

4.  对于蜘蛛发现的每个动态页面和每个 HTML 表单，使用“fuzzer”工具（Burp 称其为“入侵者”）使用无效输入来运行每个参数。大多数模糊器都带有基本的测试字符串，包括：

    *   SQL 元字符

    *   HTML/Javascript 转义和元字符

    *   这些的国际化变体以规避输入过滤器

    *   众所周知的默认表单字段名称和值

    *   众所周知的目录名、文件名和处理程序动词

5.  花几个小时过滤产生的错误（一个表单的典型模糊测试可能会产生 1000 个错误）以查找可疑响应。

这是一种劳动密集型的“裸机”方法。但是，当您的公司拥有实际的应用程序时，裸机方法会得到回报，因为您可以使用它来构建回归测试套件，这些套件将在每个应用程序的每个开发周期中像发条一样运行。这是一场胜利，原因有很多：

*   您的安全测试将花费可预测的时间和每个应用程序的资源，这使您可以进行预算和分类。

*   您的团队将获得最准确和全面的结果，因为您的测试将根据您的应用程序进行调整。

*   它的成本将低于商业扫描仪和顾问。

当然，如果你走这条路，你基本上就是把自己变成了公司的安全顾问。我不认为这是一件坏事。如果您不想要这种专业知识，WebInspect 或 Fortify 无论如何也帮不了您太多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T17:13:16.310

我知道你专门询问了渗透测试工具，但由于这些问题已经得到充分回答（我通常会使用 AppScan 和训练有素的渗透测试者），我认为重要的是要指出*渗透测试并不是“检查安全漏洞的唯一方法” "，而且往往**不是最有效的**。*

源代码审查工具可以让您更好地了解您的代码库，并发现许多渗透测试无法发现的缺陷。

其中包括 Fortify 和 OunceLabs（价格昂贵，适用于多种语言）、VisualStudio.NET CodeAnalysis（适用于 .NET 和 C++，VSTS 免费，不错但不是很好），OWASP 的 LAPSE for Java（免费，不错不是很好），CheckMarx（不便宜） ，用于 .NET 和 Java 的 fanTASTic 工具，但开销很大）等等。

您必须注意的重要一点 - （大部分）自动化工具没有找到所有漏洞，甚至没有关闭。您可以期望自动化工具可以找到大约 35-40% 的 secbug，而专业的渗透测试人员会发现；自动与手动源代码审查也是如此。

当然，适当的 SDLC（安全开发生命周期），包括威胁建模、设计审查等，将更有帮助...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T11:40:14.150

McAfee Secure 不是解决方案。他们提供的服务就是个笑话。

见下文：

[http://blogs.zdnet.com/security/?p=1092&tag=rbxccnbzd1](http://blogs.zdnet.com/security/?p=1092&tag=rbxccnbzd1)
[http://blogs.zdnet.com/security/?p=1068&tag=rbxccnbzd1](http://blogs.zdnet.com/security/?p=1068&tag=rbxccnbzd1)
[http://blogs.zdnet.com/security/?p =1114&标签=rbxccnbzd1](http://blogs.zdnet.com/security/?p=1114&tag=rbxccnbzd1)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:41:28.470

就付费解决方案以及 Nikto（免费解决方案）和其他开源工具而言，我听说过关于 SpiDynamics WebInspect 的好消息。如果您还需要检查该层，Nessus 是一个出色的基础设施工具。您可以选择一个带有多个名为 Nubuntu 的工具的 live cd（Auditor、Helix 或任何其他基于安全的发行版也可以），然后谷歌搜索特定工具的一些教程。始终，始终确保从本地网络进行扫描。如果您未经授权从 WAN 扫描一个盒子，您将面临被数据中心封锁的风险。教训是艰难的。;)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-04T08:46:29.127

Skipfish、w3af、arachni、ratproxy、ZAP、WebScarab：所有免费且非常好的 IMO

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T13:45:56.340

[http://www.nessus.org/nessus/](http://www.nessus.org/nessus/) -- Nessus 将帮助提出使您的服务器更好的方法。它本身并不能真正测试自定义应用程序，尽管我认为这些插件相对容易自己创建。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T13:47:22.607

看看[Rational App Scan](http://www-01.ibm.com/software/awdtools/appscan/)（以前称为 Watchfire）。它不是免费的，但有一个漂亮的用户界面，功能非常强大，生成报告（定制并针对标准合规框架，如 Basel2），我相信您可以将其编写到您的 CI 构建中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T09:58:05.120

[尼克托](http://www.cirt.net/nikto2)怎么样？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-18T08:47:58.910

对于这种类型的测试，你真的想看看某种类型的模糊测试器。[SPIKE Proxy](http://www.immunitysec.com/resources-freesoftware.shtml)是 Web 应用程序的几个模糊测试器之一。它是开源的，用 Python 编写。我相信 BlackHat 或 DefCON 有几个关于在某处使用 SPIKE 的视频，但我很难找到它们。

有几个高端专业软件包可以进行 Web 应用程序测试等等。更流行的工具之一是[CoreImpact](http://www.coresecurity.com/content/security-testing-and-penetration-testing-products-and-services)

如果您确实打算自己进行笔测试，我强烈建议您通读[OWASP 项目的大部分文档](http://www.owasp.org/index.php/Category:OWASP_Project)。特别是 OWASP 应用程序安全验证和测试/开发指南。彻底测试应用程序所需的思维方式与正常的开发思维方式略有不同（不是应该不同，但通常是不同的）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-27T08:20:19.053

[老鼠代理](http://code.google.com/p/ratproxy/ "大鼠代理")呢？

> 一种半自动化的、主要是被动的 Web 应用程序安全审计工具，基于对复杂 Web 2.0 环境中现有用户发起的流量的观察，针对潜在问题和安全相关设计模式的准确和敏感检测和自动注释进行了优化.
> 
> 检测各种安全问题并确定其优先级，例如动态跨站点信任模型注意事项、脚本包含问题、内容服务问题、XSRF 和 XSS 防御不足等
> 
> Ratproxy 目前被认为支持 Linux、FreeBSD、MacOS X 和 Windows (Cygwin) 环境。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-13T04:53:03.173

我知道你专门询问了渗透测试工具，但由于这些问题已经得到充分回答（我通常会使用 AppScan 和训练有素的渗透测试者），我认为重要的是要指出渗透测试并不是“检查安全漏洞的唯一方法” "，而且通常不是最有效的。

源代码审查工具可以让您更好地了解您的代码库，并发现许多渗透测试无法发现的缺陷。

其中包括 Fortify 和 OunceLabs（价格昂贵，适用于多种语言）、VisualStudio.NET CodeAnalysis（适用于 .NET 和 C++，VSTS 免费，不错但不是很好），OWASP 的 LAPSE for Java（免费，不错不是很好），CheckMarx（不便宜） ，用于 .NET 和 Java 的 fanTASTic 工具，但开销很大）等等。

您必须注意的重要一点 - （大部分）自动化工具没有找到所有漏洞，甚至没有关闭。您可以期望自动化工具可以找到大约 35-40% 的 secbug，而专业的渗透测试人员会发现；自动与手动源代码审查也是如此。

当然，适当的 SDLC（安全开发生命周期），包括威胁建模、设计审查等，将更有帮助...

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-09-16T17:50:17.950

[以前是hackersafe McAfee Secure。](https://www.mcafeesecure.com/)

# winapi - 如何播放标准的 Windows 声音？

> ID：72167
> 
> 赞同：13
> 
> 时间：2008-09-16T13:29:37.143
> 
> 标签：winapi, audio

如何找出用户在控制面板中配置了哪些声音文件？

示例：我想播放“设备已连接”的声音。

哪个API可以用来查询控制面板声音设置？

我看到第三方程序在控制面板对话框中有一些自定义条目，因此必须有一种方法让这些程序与全局声音设置进行通信。

编辑：谢谢。我不知道 PlaySound 在指定注册表项的名称时也只是播放了适当的声音文件。

播放“设备已连接”声音：

```
::PlaySound( TEXT("DeviceConnect"), NULL, SND_ALIAS|SND_ASYNC ); 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T13:37:24.673

[PlaySound](http://msdn.microsoft.com/en-us/library/ms712879.aspx)是 API，另见[播放系统声音](http://msdn.microsoft.com/en-us/library/ms712868(VS.85).aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-16T13:54:06.273

不是 Win32，但无论如何对于 .net，您可以在 C# 中使用以下命令执行此操作：

```
System.Media.SystemSounds.Asterisk.Play();
// Plays the Asterisk sound (used for Information (i))
// Also available:
// Exclamation (Warning /!\)
// Hand (aka Critical Stop - Error (X))
// Question (?)
// Beep (aka Default Beep) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:37:42.927

看看这些文章：

[使用 C# 播放 .wav 文件](http://www.codeproject.com/KB/audio-video/PlaySounds1.aspx)

[创建您自己的声音警报](http://www.codeproject.com/KB/audio-video/soundalerts.aspx)

# sql-server - LINQ To SQL 是否提供比使用 ado.net 和 oledb 更快的响应时间？

> ID：72168
> 
> 赞同：8
> 
> 时间：2008-09-16T13:29:40.607
> 
> 标签：sql-server, database, linq-to-sql

LINQ 无疑简化了数据库编程，但它有缺点吗？内联 SQL 需要以某种方式与数据库通信，从而打开数据库以进行注入。内联 SQL 还必须进行语法检查，构建计划，然后执行，这需要宝贵的周期。在优秀的数据库应用程序编程中，存储过程也是一个坚如磐石的标准。我认识的许多程序员都使用简化开发的数据层，但是并没有达到 LINQ 的程度。是时候放弃 SP 转而使用 LINQ 了吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T15:48:57.027

LINQ to SQL 实际上在数据库中存在一些令人担忧的性能问题。基本上，它会根据您使用的参数的长度创建多个执行计划。我不久前在我的博客[LINQ to SQL 上发布过它可能会导致性能问题](http://facility9.com/2008/08/28/linq-to-sql-may-cause-performance-problems/)。

现在，是不是说 LINQ 没有一席之地？几乎不。LINQ 在开发工具包中肯定有一席之地，就像存储过程一样。最终，您希望在绝对需要性能时使用存储过程，并在任何其他情况下使用 ORM 工具。

就内联 SQL 而言，有多种方法可以执行内联 SQL，以便计划只构建一次并且永远不会重新编译。大多数 ORM 也应该注意性能调整的这一方面，并​​且使用这些方法通常是执行 SQL 的最安全方法，因为它会强制您使用参数化查询。

与大多数数据库解决方案一样，正确答案取决于您要解决的问题。如果您更喜欢开发速度而不是数据库/应用程序性能，那么使用 LINQ 或其他 DAL/ORM 工具是最好的选择。如果您更喜欢性能而不是易于开发，那么使用存储过程和纯数据集将是您最好的选择。LLBLGen 甚至提供了一个 LINQ to LLBLGen 层，因此您可以使用 LINQ 查询 LLBLGen 的对象，并让 LLBLGen 实际处理构建您的查询并避免 LINQ 的一些缺陷。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T17:42:20.497

你的基本前提是有缺陷的..

> > 内联 SQL 需要以某种方式与数据库通信，从而打开数据库以进行注入。

不，它没有。将用户输入的值硬编码到 SQL 语句中可以，但您也可以使用存储过程来实现。

参数化查询可以防止注入攻击，但内联 SQL 可以像存储过程一样轻松地进行参数化。

> > 内联 SQL 还必须经过语法检查，构建计划，然后执行。

所有 Sql（SP 和内联）都必须经过语法检查，并在第一次调用时制定计划。此后，请求和执行计划的确切文本被缓存。如果收到另一个具有完全相同文本（不计算参数）的请求，则使用缓存的执行计划。

因此，如果您将值硬编码到内联 SQL 中，文本将不匹配，并且必须重新解析查询。但是，如果您使用参数，则查询的文本将匹配，并且您将获得缓存命中。在这种情况下，查询是内联 SQL 还是 SP 无关紧要。

换句话说，内联 SQL 的唯一问题是很容易做一些缓慢且不安全的事情。但是使内联 SQL 快速且安全不再是使用 SP 的工作。

这将我们带到了 LINQ，它始终使用参数，即使您将值硬编码到 LINQ 语句中，也使“快速和安全”的内联 SQL 变得微不足道。

与 SP 相比，LINQ 还具有将所有代码集中在一个位置的优势，而不是分散在两台不同的机器上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T13:41:20.857

如果您对基准测试感兴趣，Rico Mariani 有一个[出色的 5 部分研究](http://blogs.msdn.com/ricom/archive/2007/06/22/dlinq-linq-to-sql-performance-part-1.aspx)，涵盖了定性和定量差异。

他可能是一名 MS 专家，但他被称为性能狂人 - 他的基准测试非常全面且经过深思熟虑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:33:26.073

这是马克西米利安·贝勒（Maximilian Beller）的表演。据他说，LINQ 要慢得多。 [阅读他的综合研究](http://www.mbeller.de/2007/12/performance-comparison-between-linq.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T14:29:04.300

只需考虑更改列名称 - 现在更改 (n)SP 和 (x)Views。

在数据库上做所有昂贵的事情（如搜索、排序等），你不会注意到问题。

此外，如果您想在不分页的情况下显示大网格......然后使用数据集 - 那个更快。

StackOverflow 也使用 linq2sql - 你看到问题了吗 :) ？

使用 ORM - 这是大多数应用程序的方式。

PS：另外，关于微基准测试——比如..让我们用 ORM 选择 10.000 行——不要这样做。这不是你使用 ORM 的原因。如果要选择 10.000 行，请使用 ADO。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T13:41:02.997

这取决于你在做什么。LINQ 在实际数据/集操作方面的效率将低于真实数据库。但是您不必通过网络连接到数据库会节省很多。

如果您的数据库在同一台机器上或正式“连接良好”，那么您最好使用它。

但是，如果您要从远程数据库返回一个大型结果集，这可能意味着大量的传输时间，或者如果它是一个非常短的查询，不能证明开销是合理的，那么 LINQ 可能会更好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T15:23:19.910

由于 LINQ to SQL 的结构，它不可能比使用原始 SQL*更快*，无论是您自己的格式良好的查询还是作为存储过程。LINQ 为您带来的不是速度，而是类型安全和组织；简而言之，ORM 通常授予您的大部分好处。

LINQ to SQL 不是关于速度，而是关于构建一个更易于维护的软件系统。这是关于软件工程师和架构师关心的所有东西，比如松散耦合和分层

这并不是说您不能使用 LINQ 构建一些真正无法维护的代码——没有人阻止您自毁前程，但您自己——但是如果做得好，LINQ 可以提供极大的帮助。然而，我并不是说 LINQ 是灵丹妙药。它有许多问题使其难以在许多企业情况下使用——这就是 MS 提供实体框架 (ADO.NET 3.0) 的原因。当然，考虑到最近 EF 的不信任投票，即使这样也不完美。

LINQ to SQL 甚至 EF 是否比原始 SQL 更好？我会说一个响亮的地狱是的。还有其他可能效果更好的解决方案吗？也许。

# c# - 使用 C#，将包含二进制数据的字符串转换为字节数组的最有效方法是什么

> ID：72176
> 
> 赞同：3
> 
> 时间：2008-09-16T13:30:40.057
> 
> 标签：c#, bytearray

虽然有 100 种方法可以解决转换问题，但我关注的是性能。

假设字符串仅包含二进制数据，就性能而言，在 C# 下将该数据转换为 byte[]（不是 char[]）的最快方法是什么？

澄清：这不是 ASCII 数据，而是恰好在字符串中的二进制数据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T13:31:40.133

[UTF8Encoding.GetBytes](http://msdn.microsoft.com/en-us/library/system.text.utf8encoding.getbytes.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T14:20:52.057

我不确定 ASCIIEncoding.GetBytes 是否会这样做，因为它只支持[范围 0x0000 到 0x007F](https://docs.microsoft.com/en-us/dotnet/api/system.text.asciiencoding)。

你告诉字符串只包含字节。但是 .NET 字符串是一个字符数组，1 个字符是 2 个字节（因为 .NET 将字符串存储为 UTF16）。因此，您可以有两种情况来存储字节 0x42 和 0x98：

1.  该字符串是一个 ANSI 字符串并包含字节并被转换为一个 unicode 字符串，因此字节将为 0x00 0x42 0x00 0x98。（字符串存储为0x0042和0x0098）
2.  该字符串只是一个字节数组，您将其类型转换或刚刚接收到一个字符串，因此成为以下字节 0x42 0x98。（字符串存储为 0x9842）

在第一种情况下，结果将是 0x42 和 0x3F（ascii 表示“B？”）。第二种情况会导致 0x3F（ascii 表示“？”）。这是合乎逻辑的，因为字符超出了有效的 ascii 范围，并且编码器不知道如何处理这些值。

所以我想知道为什么它是一个带字节的字符串？

*   也许它包含一个编码为字符串的字节（例如[Base64](https://en.wikipedia.org/wiki/Base64)）？
*   也许您应该从 char 数组或 byte 数组开始？

如果您确实有情况 2 并且您想从中获取字节，您应该使用[UnicodeEncoding.GetBytes](https://docs.microsoft.com/en-us/dotnet/api/system.text.unicodeencoding.getbytes)调用。因为这将返回 0x42 和 0x98。

如果您想从 char 数组转到 byte 数组，最快的方法是编组。但这不是很好，并且使用双内存。

```
public Byte[] ConvertToBytes(Char[] source)
{
    Byte[] result = new Byte[source.Length * sizeof(Char)];
    IntPtr tempBuffer = Marshal.AllocHGlobal(result.Length);
    try
    {
        Marshal.Copy(source, 0, tempBuffer, source.Length);
        Marshal.Copy(tempBuffer, result, 0, result.Length);
    }
    finally
    {
        Marshal.FreeHGlobal(tempBuffer);
    }
    return result;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:54:54.523

C#中没有ASCII 字符串*这样的东西！*字符串*始终*包含 UTF-16。没有意识到这一点会导致很多问题。也就是说，前面提到的方法有效，因为它们将字符串视为 UTF-16 编码并将字符转换为 ASCII 符号。

/编辑响应澄清：二进制数据是如何进入字符串的？字符串不应该包含二进制数据（`byte[]`用于此）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T16:16:28.083

如果要从字符串转换为二进制数据，**首先必须知道使用什么编码将二进制数据转换为字符串**。否则，您可能无法得到正确的二进制数据。因此，最有效的方法可能是 Encoding 子类（例如 UTF8Encoding）上的 GetBytes()，但您必须确定使用哪种编码。

Kent Boogaart 对原始问题的评论总结得很好。;]

# sql-server - 仅在 FMTONLY 设置为 OFF 的情况下返回列信息

> ID：72185
> 
> 赞同：1
> 
> 时间：2008-09-16T13:31:16.327
> 
> 标签：sql-server

我有一个在查找字段列表和表名后动态构建的查询。我在存储过程中执行这个动态查询。当两个 proc 参数为零时，查询构建时不使用 where 子句，如果不是，则构建时使用 where 子句。

当我使用 SET FMTONLY ON exec [cpExportRecordType_ListByExportAgentID] null, null 执行 proc 时，它不返回任何列信息。我刚刚将构建没有 where 子句的查询替换为直接执行相同的查询，现在我得到了列信息。我很想知道是什么原因造成的，有人吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T14:58:09.580

也许这与传递的参数为 NULL 的事实有关，请检查您的查询是如何构建的，也许它的行为方式与传递 NULL 时的预期不同。调用时是否 proc 返回预期结果： SET FMTONLY OFF exec [cpExportRecordType_ListByExportAgentID] null, null ？

其他可能性：我知道您通过调用另一个查询来获取列名的结果来动态构建查询。也许通常会为您提供列名的查询不返回数据，而只返回列信息（SET FMTONLY ON），因此您没有数据来构建动态查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:12:58.747

> 克里斯托夫：
> 
> > 所以你没有数据来构建你的动态查询。

使用空参数，我的动态查询是纯字符串文字，独立于数据。将其更改为静态查询解决了该问题。

# c# - 有没有一种简单的方法可以在弹出文本窗口中创建两列？

> ID：72198
> 
> 赞同：1
> 
> 时间：2008-09-16T13:32:29.850
> 
> 标签：c#, winforms, controls, formatting

这似乎是一件容易的事。我只想弹出一个文本窗口并显示两列数据——左侧的描述和右侧显示的相应值。我没有过多地使用 Forms，所以我只是抓住了第一个看起来合适的控件，一个 TextBox。我认为使用制表符是创建第二列的一种简单方法，但我发现事情并不那么好。

我尝试这样做的方式似乎有两个问题（见下文）。首先，我在许多网站上读到 MeasureString 函数不是很精确，因为字体非常复杂，还有字距调整问题等等。第二个是我不知道 TextBox 控件在下面用作它的 StringFormat 是什么。

无论如何，结果是我总是在右列中得到一个选项卡关闭的项目。我想我可以滚动自己的文本窗口并自己做所有事情，但是天哪，难道没有一种简单的方法可以做到这一点吗？

```
 TextBox textBox    = new TextBox();
    textBox.Font       = new Font("Calibri", 11);
    textBox.Dock       = DockStyle.Fill;
    textBox.Multiline  = true;
    textBox.WordWrap   = false;
    textBox.ScrollBars = ScrollBars.Vertical;

    Form form            = new Form();
    form.Text            = "Recipe";
    form.Size            = new Size(400, 600);
    form.FormBorderStyle = FormBorderStyle.Sizable;
    form.StartPosition   = FormStartPosition.CenterScreen;
    form.Controls.Add(textBox);

    Graphics g = form.CreateGraphics();

    float targetWidth = 230;

    foreach (PropertyInfo property in properties)
    {
        string text = String.Format("{0}:\t", Description);

        while (g.MeasureString(text,textBox.Font).Width < targetWidth)
            text += "\t";

        textBox.AppendText(text + value.ToString() + "\n");
    }

    g.Dispose();
    form.ShowDialog(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T14:07:25.973

谢谢马特，你的解决方案对我很有用。这是我的代码版本...

```
// This is a better way to pass in what tab stops I want...
SetTabStops(textBox, new int[] { 12,120 });

// And the code for the SetTabsStops method itself...
private const uint EM_SETTABSTOPS = 0x00CB;

[DllImport("User32.dll")]
private static extern uint SendMessage(IntPtr hWnd, uint wMsg, int wParam, int[] lParam);

public static void SetTabStops(TextBox textBox, int[] tabs)
{
    SendMessage(textBox.Handle, EM_SETTABSTOPS, tabs.Length, tabs);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T13:39:37.697

如果需要，可以将此 VB.Net 代码翻译成 C#。这里的理论是您更改控件中选项卡的大小。

```
Private Declare Function SendMessage _
  Lib "user32" Alias "SendMessageA" _
  (ByVal handle As IntPtr, ByVal wMsg As Integer, _
  ByVal wParam As Integer, ByRef lParam As Integer) As Integer

Private Sub SetTabStops(ByVal ctlTextBox As TextBox)

  Const EM_SETTABSTOPS As Integer = &HCBS

  Dim tabs() As Integer = {20, 40, 80}

  SendMessage(ctlTextBox.Handle, EM_SETTABSTOPS, _
    tabs.Length, tabs(0))

End Sub 
```

我也为你将一个版本转换为 C#。在 VS2005 中测试和工作。

将此 using 语句添加到您的表单中：

```
using System.Runtime.InteropServices; 
```

把它放在类声明之后：

```
 private const int EM_SETTABSTOPS = 0x00CB;
    [DllImport("User32.dll", CharSet = CharSet.Auto)]
    public static extern IntPtr SendMessage(IntPtr h, int msg, int wParam, int[] lParam); 
```

当你想设置制表位时调用这个方法：

```
 private void SetTabStops(TextBox ctlTextBox)
    {
        const int EM_SETTABSTOPS = 203;
        int[] tabs = { 100, 40, 80 };
        SendMessage(textBox1.Handle, EM_SETTABSTOPS, tabs.Length, tabs);
    } 
```

要使用它，这就是我所做的一切：

```
 private void Form1_Load(object sender, EventArgs e)
    {
        SetTabStops(textBox1);

        textBox1.Text = "Hi\tWorld";
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:50:23.067

如果您想要真正的表格，Haren 先生的答案是一个很好的答案。DataGridView 将为您提供非常 Excel 电子表格类型的外观。

如果你只想要一个两列布局（类似于 HTML 的表格），那么试试 TableLayoutPanel。它将为您提供所需的布局，并能够在每个表格单元格中使用标准控件。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-16T14:04:43.703

我相信唯一的方法是做一些类似于你正在做的事情，但使用固定字体并用空格做你自己的填充，这样你就不必担心标签扩展。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-16T13:39:35.357

文本框不允许使用 HTML 吗？如果是这种情况，只需使用 HTML 将文本格式化为表格。否则，请尝试将文本添加到数据网格，然后将其添加到表单。

# java - 如何在没有 ant 的情况下从命令行编译使用 Google webdriver 的 java 应用程序

> ID：72201
> 
> 赞同：-3
> 
> 时间：2008-09-16T13:32:39.070
> 
> 标签：java, ant, compiler-construction, webdriver

我想编译一个使用 google 的 webdriver 的示例代码。

我将 webdriver 保存到 /home/iyo/webdriver。我的代码是：

```
包 com.googlecode.webdriver.example；

导入 com.googlecode.webdriver.By；

导入 com.googlecode.webdriver.WebDriver；

导入 com.googlecode.webdriver.WebElement；

导入 com.googlecode.webdriver.htmlunit.HtmlUnitDriver；

公共类 FirstTest {

    公共静态无效主要（字符串[]参数）{
        WebDriver driver = new HtmlUnitDriver();        

        driver.get("http://www.google.com");
        WebElement 元素 =
        driver.findElement(By.xpath("//input[@name = 'q']"));
        element.sendKeys("奶酪！");
        元素.提交（）；
        System.out.println("页面标题为：" + driver.getTitle());

    }

}

```

但我与

```
javac -cp /home/iyo/webdriver FirstTest.java
```

我收到这样的错误：

```
FirstTest.java:5：找不到符号符号：类

位置：包 com.googlecode.webdriver

导入 com.googlecode.webdriver.By；

```
 ^ 
```

FirstTest.java:7：找不到符号

符号：类 WebDriver

位置：包 com.googlecode.webdriver

导入 com.googlecode.webdriver.WebDriver；

```
 ^ 
```

FirstTest.java:9：找不到符号

符号：类 WebElement

位置：包 com.googlecode.webdriver

导入 com.googlecode.webdriver.WebElement；

```
 ^ 
```

FirstTest.java:11：com.googlecode.webdriver.htmlunit 包不存在

导入 com.googlecode.webdriver.htmlunit.HtmlUnitDriver；

```
 ^ 
```

FirstTest.java:19：找不到符号

符号：类 WebDriver

位置：com.googlecode.webdriver.example.FirstTest 类

```
 WebDriver driver = new HtmlUnitDriver();        

    ^ 
```

FirstTest.java:19：找不到符号

符号：类 HtmlUnitDriver

位置：com.googlecode.webdriver.example.FirstTest 类

```
 WebDriver driver = new HtmlUnitDriver();        

                           ^ 
```

FirstTest.java:27：找不到符号

符号：类 WebElement

位置：com.googlecode.webdriver.example.FirstTest 类

```
 WebElement element =

    ^ 
```

FirstTest.java:29：找不到符号

符号：变量

位置：com.googlecode.webdriver.example.FirstTest 类

```
 driver.findElement(By.xpath("//input[@name = 'q']"));

                       ^ 
```

8 个错误

```

它`s possible to use it whitouht Ant?(The code in NetBeans or Eclipse work well, but I don`不想使用它们。）仅使用 javac？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T13:43:03.023

On the [webdriver homepage](http://code.google.com/p/webdriver/wiki/GettingStarted) one can read

*   Add $WEBDRIVER_HOME/common/build/webdriver-common.jar to the CLASSPATH
*   Add $WEBDRIVER_HOME/htmlunit/build/webdriver-htmlunit.jar to the CLASSPATH
*   Add all the Jar files under $WEBDRIVER_HOME/htmlunit/lib/runtime to the CLASSPATH

So you have to put all the jar files behind `-cp` like that

```
javac -cp /home/iyo/webdriver/common/build/webdriver-common.jar:/home/iyo/webdriver/common/build/webdriver-htmlunit.jar FirstTest.java 
```

You probably have to add all the jar files from htmlunit/lib/runtime to the classpath as well.

# asp.net-mvc - 你用过犀牛冰屋吗？

> ID：72204
> 
> 赞同：0
> 
> 时间：2008-09-16T13:32:47.243
> 
> 标签：asp.net-mvc, model-view-controller

有没有人在一个不平凡的项目中使用过[犀牛冰屋？](http://www.ayende.com/Blog/archive/2007/09/03/Rhino-Igloo-ndash-MVC-Framework-for-Web-Forms.aspx)我很好奇它是否值得，它的缺点是什么，它是否增强了可测试性，是否易于使用。您如何将它与纯 MVC 框架 (ASP.NET MVC) 进行比较？请分享经验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T20:50:35.927

你试过[在 IT 上观看 Ayende 的冬眠犀牛](http://www.ayende.com/Blog/archive/2007/12/19/Hibernating-Rhinos-7-Rhino-Igloo.aspx)吗？看来他自己也不是很满意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-19T04:53:02.130

我不会将 Rhino Igloo 与 ASP.NET MVC 进行比较。原因是 MVC 从堆栈中删除了 webforms。而 Rhino Igloo（或 Castle Igloo）在 Webforms 模型之上提供 MVC 样式分离。如果您无法使用*Webforms*，那么 Rhino Igloo 提供了一个很好的分离平台。可以做到这一点的其他框架包括提供模型视图演示器方法的模式和实践 Web 客户端软件工厂。

我玩过 Castle Igloo，发现它结构紧凑，使用起来简洁。WCSF 有更多的功能，但也有更多的包袱，因为它与企业库中的其他内容紧密相关。如果您还没有使用 Entlib 并且仍然想要 MVC/MVP 网络表单，那么一定要看看它。

# performance - 递归还是迭代？

> ID：72209
> 
> 赞同：251
> 
> 时间：2008-09-16T13:33:24.730
> 
> 标签：performance, algorithm, language-agnostic, recursion

如果我们在两者都可以服务于相同目的的算法中使用循环而不是递归或反之亦然，是否会影响性能？例如：检查给定的字符串是否是回文。我见过许多程序员使用递归作为一种手段来炫耀一个简单的迭代算法何时可以满足要求。编译器在决定使用什么方面起着至关重要的作用吗？

* * *

## 回答 #1

> 赞同：443
> 
> 时间：2008-09-16T14:11:30.020

循环可能会为您的程序带来性能提升。递归可能会为您的程序员带来性能提升。选择在您的情况下哪个更重要！

* * *

## 回答 #2

> 赞同：190
> 
> 时间：2008-09-16T13:52:59.050

递归可能会更昂贵，具体取决于递归函数是否为[尾递归](http://en.wikipedia.org/wiki/Tail_recursion)（最后一行是递归调用）。尾递归*应该*被编译器识别并针对其迭代对应物进行优化（同时保持代码中的简洁、清晰的实现）。

我会以最有意义的方式编写算法，并且对于必须在几个月或几年内维护代码的可怜的傻瓜（无论是你自己还是其他人）来说最清晰。如果您遇到性能问题，请分析您的代码，然后并且只有这样才能通过转向迭代实现来进行优化。您可能想研究[记忆](http://en.wikipedia.org/wiki/Memoization)化和[动态编程](http://en.wikipedia.org/wiki/Dynamic_programming)。

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2011-06-24T03:47:50.187

将递归与迭代进行比较就像将十字螺丝刀与平头螺丝刀进行比较。在大多数情况下，您*可以*卸下任何平头十字头螺钉，但如果您使用专为该螺钉设计的螺丝刀会更容易，对吧？

由于设计方式（斐波那契数列、遍历树状结构等），一些算法只适合递归。递归使算法更简洁，更容易理解（因此可共享和可重用）。

此外，一些递归算法使用“惰性评估”，这使得它们比它们的迭代兄弟更有效。这意味着他们只在需要时而不是每次循环运行时进行昂贵的计算。

这应该足以让你开始。我也会为你挖掘一些文章和例子。

***链接 1：* Haskel 与 PHP（递归与迭代）**

这是一个程序员必须使用 PHP 处理大型数据集的示例。他展示了在 Haskel 中使用递归处理是多么容易，但是由于 PHP 没有简单的方法来完成相同的方法，他不得不使用迭代来获得结果。

> [http://blog.webspecies.co.uk/2011-05-31/lazy-evaluation-with-php.html](http://blog.webspecies.co.uk/2011-05-31/lazy-evaluation-with-php.html)

***链接 2：*掌握递归**

大多数递归的坏名声来自于命令式语言的高成本和低效率。这篇文章的作者谈到了如何优化递归算法，使其更快、更高效。他还介绍了如何将传统循环转换为递归函数以及使用尾端递归的好处。他的结束语确实总结了我认为的一些要点：

> “递归编程为程序员提供了一种更好的方式来组织代码，这种方式既可维护又逻辑一致。”
> 
> [https://developer.ibm.com/articles/l-recurs/](https://developer.ibm.com/articles/l-recurs/)

***链接 3：*递归比循环快吗？（回答）**

这是与您的问题类似的 stackoverflow 问题的答案的链接。作者指出，与递归或循环相关的许多基准测试都是**特定**于语言的。命令式语言通常使用循环更快，使用递归更慢，反之亦然。我想从这个链接中得到的主要观点是，很难以语言不可知论/情况盲目的方式回答这个问题。

> [递归比循环快吗？](https://stackoverflow.com/questions/2651112/is-recursion-ever-faster-than-looping/2651200#2651200)

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-16T13:43:04.490

递归在内存中的成本更高，因为每个递归调用通常需要将内存地址推送到堆栈 - 以便稍后程序可以返回该点。

尽管如此，在很多情况下，递归比循环更自然、更易读——比如在处理树时。在这些情况下，我建议坚持递归。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-09-16T13:45:19.240

通常，人们会期望性能损失位于另一个方向。递归调用会导致构建额外的栈帧；对此的处罚各不相同。此外，在 Python 等某些语言中（更准确地说，在某些语言的某些实现中......），对于可能递归指定的任务，您可以很容易地遇到堆栈限制，例如在树数据结构中查找最大值。在这些情况下，你真的想坚持使用循环。

编写好的递归函数可以在一定程度上减少性能损失，假设您有一个优化尾递归的编译器等。（还要仔细检查以确保该函数确实是尾递归——这是许多人犯错误的事情之一在。）

除了“边缘”情况（高性能计算、非常大的递归深度等）之外，最好采用最清楚地表达您的意图、设计良好且可维护的方法。仅在确定需求后进行优化。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-06-24T04:18:54.160

**对于可以分解为多个**较小部分的问题，递归优于迭代。

例如，要制作递归斐波那契算法，您将 fib(n) 分解为 fib(n-1) 和 fib(n-2) 并计算这两部分。迭代只允许你一遍又一遍地重复一个函数。

然而，斐波那契实际上是一个破碎的例子，我认为迭代实际上更有效。请注意，fib(n) = fib(n-1) + fib(n-2) 和 fib(n-1) = fib(n-2) + fib(n-3)。fib(n-1) 被计算两次！

一个更好的例子是树的递归算法。分析父节点的问题可以分解为分析每个子节点的**多个**较小的问题。与斐波那契示例不同，较小的问题彼此独立。

所以是的 - 对于可以分解为多个、更小、独立、类似的问题的问题，递归比迭代更好。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-16T13:55:08.843

使用递归时性能会下降，因为以任何语言调用方法都意味着大量准备工作：调用代码发布返回地址、调用参数、其他一些上下文信息（例如处理器寄存器）可能保存在某处，并且在返回时被调用的方法发布一个返回值，然后由调用者检索，并且之前保存的任何上下文信息都将被恢复。迭代和递归方法之间的性能差异在于这些操作所花费的时间。

从实现的角度来看，当处理调用上下文所需的时间与执行方法所需的时间相当时，您就会真正开始注意到差异。如果您的递归方法执行时间比调用上下文管理部分要长，请采用递归方式，因为代码通常更具可读性和易于理解，并且您不会注意到性能损失。否则出于效率原因进行迭代。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-16T13:56:19.653

我相信java中的尾递归目前没有优化。[详细信息在 LtU 和相关链接的](http://lambda-the-ultimate.org/node/1333)整个讨论中散布。它*可能*是即将发布的第 7 版中的一项功能，但显然与堆栈检查结合使用时会出现某些困难，因为某些帧会丢失。自 Java 2 以来，堆栈检查已被用于实现其细粒度的安全模型。

[http://lambda-the-ultimate.org/node/1333](http://lambda-the-ultimate.org/node/1333)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-06-24T03:39:01.690

在许多情况下，它提供了比迭代方法更优雅的解决方案，常见的例子是二叉树的遍历，因此它不一定更难维护。一般来说，迭代版本通常更快一些（并且在优化期间很可能会替换递归版本），但递归版本更容易理解和正确实现。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2011-06-24T03:46:18.233

递归在某些情况下非常有用。例如考虑查找阶乘的代码

```
int factorial ( int input )
{
  int x, fact = 1;
  for ( x = input; x > 1; x--)
     fact *= x;
  return fact;
} 
```

现在考虑使用递归函数

```
int factorial ( int input )
{
  if (input == 0)
  {
     return 1;
  }
  return input * factorial(input - 1);
} 
```

通过观察这两个，我们可以看出递归是很容易理解的。但是如果不小心使用它也很容易出错。假设如果我们错过了`if (input == 0)`，那么代码将执行一段时间并且通常以堆栈溢出结束。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-12-08T06:26:04.593

在许多情况下，由于缓存，递归更快，从而提高了性能。例如，这里是使用传统合并例程的合并排序的迭代版本。由于缓存性能提高，它将比递归实现运行得慢。

# 迭代实现

```
public static void sort(Comparable[] a)
{
    int N = a.length;
    aux = new Comparable[N];
    for (int sz = 1; sz < N; sz = sz+sz)
        for (int lo = 0; lo < N-sz; lo += sz+sz)
            merge(a, lo, lo+sz-1, Math.min(lo+sz+sz-1, N-1));
} 
```

# 递归实现

```
private static void sort(Comparable[] a, Comparable[] aux, int lo, int hi)
{
    if (hi <= lo) return;
    int mid = lo + (hi - lo) / 2;
    sort(a, aux, lo, mid);
    sort(a, aux, mid+1, hi);
    merge(a, aux, lo, mid, hi);
} 
```

PS - 这是 Kevin Wayne 教授（普林斯顿大学）在 Coursera 上的算法课程中所说的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-16T13:35:38.983

这取决于语言。在 Java 中，您应该使用循环。函数式语言优化递归。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-16T13:38:59.023

使用递归，每次“迭代”都会产生函数调用的成本，而使用循环，您通常支付的唯一费用是递增/递减。因此，如果循环的代码并不比递归解决方案的代码复杂得多，那么循环通常会优于递归。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-11-29T06:23:35.490

递归和迭代取决于您要实现的业务逻辑，尽管在大多数情况下它可以互换使用。大多数开发人员使用递归是因为它更容易理解。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-06-24T04:01:35.147

如果你只是迭代一个列表，那么当然，迭代掉。

其他几个答案提到了（深度优先）树遍历。这确实是一个很好的例子，因为对于一个非常常见的数据结构来说这是一件非常常见的事情。递归对于这个问题非常直观。

在此处查看“查找”方法：http: [//penguin.ewu.edu/cscd300/Topic/BSTintro/index.html](http://penguin.ewu.edu/cscd300/Topic/BSTintro/index.html)

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2011-06-24T10:33:56.977

递归比任何可能的迭代定义都更简单（因此更基本）。[您可以仅使用一对组合](http://en.wikipedia.org/wiki/SK_calculus)子定义图灵完备系统（是的，甚至递归本身也是此类系统中的派生概念）。[Lambda](http://en.wikipedia.org/wiki/Lambda_calculus)演算是一个同样强大的基础系统，具有递归函数。但是如果你想正确地定义一个迭代，你需要更多的原语开始。

至于代码——不，递归代码实际上比纯粹的迭代代码更容易理解和维护，因为大多数数据结构都是递归的。当然，为了让它正确，至少需要一种支持高阶函数和闭包的语言 - 以一种简洁的方式获得所有标准组合器和迭代器。当然，在 C++ 中，复杂的递归解决方案看起来有点难看，除非你是[FC++](http://www.cc.gatech.edu/~yannis/fc++/)等的铁杆用户。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2017-06-02T11:14:08.060

递归的一个缺点是使用递归编写的算法具有 O(n) 空间复杂度。虽然迭代方法的空间复杂度为 O(1)。这是使用迭代而不是递归的优势。那我们为什么要使用递归呢？

见下文。

有时使用递归编写算法更容易，而使用迭代编写相同的算法则稍微困难一些。在这种情况下，如果您选择遵循迭代方法，则必须自己处理堆栈。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-16T13:39:16.713

我认为在（非尾）递归中，每次调用函数时分配新堆栈等都会对性能造成影响（当然取决于语言）。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-09-16T13:48:03.587

它取决于“递归深度”。这取决于函数调用开销对总执行时间的影响程度。

例如，以递归方式计算经典阶乘是非常低效的，因为： - 数据溢出的风险 - 堆栈溢出的风险 - 函数调用开销占用了 80% 的执行时间

在开发用于在国际象棋游戏中进行位置分析的最小-最大算法时，可以在“分析深度”上递归实现（就像我正在做的那样^_^）

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-06-24T03:59:49.190

递归？我从哪里开始，wiki 会告诉你“这是以自相似的方式重复项目的过程”

早在我做 C 的时候，C++ 递归就是天赐之物，诸如“尾递归”之类的东西。您还会发现许多排序算法使用递归。快速排序示例：[http ://alienryderflex.com/quicksort/](http://alienryderflex.com/quicksort/)

递归就像对特定问题有用的任何其他算法一样。也许您可能不会立即或经常找到用途，但会有问题您会很高兴它可用。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2015-10-09T23:22:32.430

在 C++ 中，如果递归函数是一个模板函数，那么编译器就有更多的机会对其进行优化，因为所有类型推导和函数实例化都将在编译时发生。如果可能，现代编译器也可以内联该函数。因此，如果使用`-O3`或`-O2`in之类的优化标志`g++`，则递归可能比迭代更快。在迭代代码中，编译器优化它的机会更少，因为它已经或多或少处于最佳状态（如果写得足够好）。

就我而言，我试图通过使用 Armadillo 矩阵对象以递归和迭代方式进行平方来实现矩阵求幂。该算法可以在这里找到...... [https://en.wikipedia.org/wiki/Exponentiation_by_squaring](https://en.wikipedia.org/wiki/Exponentiation_by_squaring)。我的函数是模板化的，我已经计算`1,000,000` `12x12`了幂次的矩阵`10`。我得到以下结果：

```
iterative + optimisation flag -O3 -> 2.79.. sec
recursive + optimisation flag -O3 -> 1.32.. sec

iterative + No-optimisation flag  -> 2.83.. sec
recursive + No-optimisation flag  -> 4.15.. sec 
```

这些结果是使用带有 c++11 标志 ( `-std=c++11`) 的 gcc-4.8 和带有 Intel mkl 的 Armadillo 6.1 获得的。英特尔编译器也显示了类似的结果。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-16T14:19:09.097

迈克是对的。Java 编译器或 JVM*不会*优化尾递归。你总是会遇到这样的堆栈溢出：

```
int count(int i) {
  return i >= 100000000 ? i : count(i+1);
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-04-21T06:30:50.127

*如果迭代是原子的，并且比推送新堆栈帧和*创建新线程要昂贵几个数量级，*并且*您有多个内核*并且*您的运行时环境可以使用所有内核，那么递归方法可以在结合使用时产生巨大的性能提升多线程。如果平均迭代次数不可预测，那么使用线程池可能是一个好主意，该线程池将控制线程分配并防止您的进程创建过多线程并占用系统。

例如，在某些语言中，存在递归多线程合并排序实现。

但同样，多线程可以与循环一起使用而不是递归，因此这种组合的效果取决于更多因素，包括操作系统及其线程分配机制。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-01-29T12:51:43.823

您必须记住，使用太深的递归会遇到堆栈溢出，具体取决于允许的堆栈大小。为了防止这种情况，请确保提供一些结束递归的基本情况。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2015-09-16T15:50:15.470

仅使用 Chrome 45.0.2454.85 m，递归似乎更快。

这是代码：

```
(function recursionVsForLoop(global) {
    "use strict";

    // Perf test
    function perfTest() {}

    perfTest.prototype.do = function(ns, fn) {
        console.time(ns);
        fn();
        console.timeEnd(ns);
    };

    // Recursion method
    (function recur() {
        var count = 0;
        global.recurFn = function recurFn(fn, cycles) {
            fn();
            count = count + 1;
            if (count !== cycles) recurFn(fn, cycles);
        };
    })();

    // Looped method
    function loopFn(fn, cycles) {
        for (var i = 0; i < cycles; i++) {
            fn();
        }
    }

    // Tests
    var curTest = new perfTest(),
        testsToRun = 100;

    curTest.do('recursion', function() {
        recurFn(function() {
            console.log('a recur run.');
        }, testsToRun);
    });

    curTest.do('loop', function() {
        loopFn(function() {
            console.log('a loop run.');
        }, testsToRun);
    });

})(window); 
```

**结果**

// 使用标准 for 循环运行 100 次

循环运行 100 倍。完成时间：**7.683ms**

// 100 次使用带尾递归的函数递归方法运行

100 倍递归运行。完成时间：**4.841ms**

**在下面的屏幕截图中，当每个测试运行 300 个周期时，递归再次以更大的优势获胜**

[![递归又赢了！](https://i.stack.imgur.com/dQemM.png)](https://i.stack.imgur.com/dQemM.png)

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2020-01-24T16:24:01.833

我发现了这些方法之间的另一个区别。它看起来简单而不重要，但它在你准备面试时起着非常重要的作用，并且这个主题出现了，所以仔细看看。

简而言之：1）迭代后序遍历并不容易 - 这使得 DFT 更加复杂 2）循环检查更容易递归

细节：

在递归的情况下，很容易创建前后遍历：

想象一个非常标准的问题：“当任务依赖于其他任务时，打印所有应该执行的任务以执行任务 5”

例子：

```
 //key-task, value-list of tasks the key task depends on
    //"adjacency map":
    Map<Integer, List<Integer>> tasksMap = new HashMap<>();
    tasksMap.put(0, new ArrayList<>());
    tasksMap.put(1, new ArrayList<>());

    List<Integer> t2 = new ArrayList<>();
    t2.add(0);
    t2.add(1);
    tasksMap.put(2, t2);

    List<Integer> t3 = new ArrayList<>();
    t3.add(2);
    t3.add(10);
    tasksMap.put(3, t3);

    List<Integer> t4 = new ArrayList<>();
    t4.add(3);
    tasksMap.put(4, t4);

    List<Integer> t5 = new ArrayList<>();
    t5.add(3);
    tasksMap.put(5, t5);

    tasksMap.put(6, new ArrayList<>());
    tasksMap.put(7, new ArrayList<>());

    List<Integer> t8 = new ArrayList<>();
    t8.add(5);
    tasksMap.put(8, t8);

    List<Integer> t9 = new ArrayList<>();
    t9.add(4);
    tasksMap.put(9, t9);

    tasksMap.put(10, new ArrayList<>());

    //task to analyze:
    int task = 5;

    List<Integer> res11 = getTasksInOrderDftReqPostOrder(tasksMap, task);
    System.out.println(res11);**//note, no reverse required**

    List<Integer> res12 = getTasksInOrderDftReqPreOrder(tasksMap, task);
    Collections.reverse(res12);//note reverse!
    System.out.println(res12);

    private static List<Integer> getTasksInOrderDftReqPreOrder(Map<Integer, List<Integer>> tasksMap, int task) {
         List<Integer> result = new ArrayList<>();
         Set<Integer> visited = new HashSet<>();
         reqPreOrder(tasksMap,task,result, visited);
         return result;
    }

private static void reqPreOrder(Map<Integer, List<Integer>> tasksMap, int task, List<Integer> result, Set<Integer> visited) {

    if(!visited.contains(task)) {
        visited.add(task);
        result.add(task);//pre order!
        List<Integer> children = tasksMap.get(task);
        if (children != null && children.size() > 0) {
            for (Integer child : children) {
                reqPreOrder(tasksMap,child,result, visited);
            }
        }
    }
}

private static List<Integer> getTasksInOrderDftReqPostOrder(Map<Integer, List<Integer>> tasksMap, int task) {
    List<Integer> result = new ArrayList<>();
    Set<Integer> visited = new HashSet<>();
    reqPostOrder(tasksMap,task,result, visited);
    return result;
}

private static void reqPostOrder(Map<Integer, List<Integer>> tasksMap, int task, List<Integer> result, Set<Integer> visited) {
    if(!visited.contains(task)) {
        visited.add(task);
        List<Integer> children = tasksMap.get(task);
        if (children != null && children.size() > 0) {
            for (Integer child : children) {
                reqPostOrder(tasksMap,child,result, visited);
            }
        }
        result.add(task);//post order!
    }
} 
```

请注意，递归后序遍历不需要随后反转结果。孩子们最先打印，你在问题中的任务最后打印。一切安好。您可以进行递归前序遍历（也如上所示），并且需要反转结果列表。

**迭代方法没那么简单！**在迭代（一个堆栈）方法中，您只能进行预排序遍历，因此您必须在最后反转结果数组：

```
 List<Integer> res1 = getTasksInOrderDftStack(tasksMap, task);
    Collections.reverse(res1);//note reverse!
    System.out.println(res1);

    private static List<Integer> getTasksInOrderDftStack(Map<Integer, List<Integer>> tasksMap, int task) {
    List<Integer> result = new ArrayList<>();
    Set<Integer> visited = new HashSet<>();
    Stack<Integer> st = new Stack<>();

    st.add(task);
    visited.add(task);

    while(!st.isEmpty()){
        Integer node = st.pop();
        List<Integer> children = tasksMap.get(node);
        result.add(node);
        if(children!=null && children.size() > 0){
            for(Integer child:children){
                if(!visited.contains(child)){
                    st.add(child);
                    visited.add(child);
                }
            }
        }
        //If you put it here - it does not matter - it is anyway a pre-order
        //result.add(node);
    }
    return result;
} 
```

看起来很简单，不是吗？

但这在某些采访中是一个陷阱。

这意味着：使用递归方法，您可以实现深度优先遍历，然后选择您需要的前后顺序（只需更改“打印”的位置，在我们的“添加到结果列表”的情况下） ）。使用迭代（一个堆栈）方法，您可以**轻松地**只进行预排序遍历，因此在需要首先打印孩子的情况下（几乎所有需要从底部节点开始打印的情况，向上） - 你在麻烦。如果你有这个麻烦，你可以稍后逆转，但这将是你算法的一个补充。如果面试官正在看他的手表，那对你来说可能是个问题。进行迭代后序遍历有很复杂的方法，它们存在，但**并不简单**。例子：[https://www.geeksforgeeks.org/iterative-postorder-traversal-using-stack/](https://www.geeksforgeeks.org/iterative-postorder-traversal-using-stack/)

因此，底线：我会在面试中使用递归，它更易于管理和解释。在任何紧急情况下，您都可以轻松地从订单前遍历到订单后遍历。使用迭代，你就没有那么灵活了。

我会使用递归然后告诉：“好的，但是迭代可以让我更直接地控制已用内存，我可以轻松测量堆栈大小并禁止一些危险的溢出......”

递归的另一个优点 - 避免/注意图中的循环更简单。

示例（前置代码）：

```
dft(n){
    mark(n)
    for(child: n.children){
        if(marked(child)) 
            explode - cycle found!!!
        dft(child)
    }
    unmark(n)
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-03-04T16:24:08.097

把它写成递归或练习可能会很有趣。

但是，如果要在生产中使用代码，则需要考虑堆栈溢出的可能性。

尾递归优化可以消除堆栈溢出，但是您是否想要这样做，并且您需要知道您可以依靠它在您的环境中进行优化。

## 每次算法递归，数据量减少或`n`减少多少？

如果您`n`每次递归都将数据大小减少一半或一半，那么通常您无需担心堆栈溢出。比如说，如果程序堆栈溢出需要 4,000 级深度或 10,000 级深度，那么程序堆栈溢出的数据大小需要大约 2 ^(4000)。从这个角度来看，最近一个最大的存储设备可以容纳 2 ^(61)个字节，如果你有 2 ^(61)个这样的设备，那么你只处理 2 ^(122 个)数据大小。如果你看宇宙中所有的原子，估计可能不到2 ^(84). 如果你需要处理宇宙中的所有数据以及它们自宇宙诞生以来的每一毫秒的状态估计是 140 亿年前，它可能只有 2 ^(153)。所以如果你的程序可以处理 2 ^(4000)个单位的数据 或者`n`，你就可以处理全宇宙的所有数据并且程序不会堆栈溢出。如果您不需要处理大到 2 ^(4000)（一个 4000 位整数）的数字，那么通常您无需担心堆栈溢出。

但是，如果`n`每次递归时都减少数据大小或恒定数量，那么当`n`仅`20000`. 也就是程序在`n`is时运行良好`1000`，而你认为​​程序良好，然后在未来某个时间时程序堆栈溢出，当`n`is`5000`或时`20000`。

因此，如果您有可能发生堆栈溢出，请尝试使其成为迭代解决方案。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-11-10T17:28:06.253

据我所知，Perl 没有优化尾递归调用，但你可以伪造它。

```
sub f{
  my($l,$r) = @_;

  if( $l >= $r ){
    return $l;
  } else {

    # return f( $l+1, $r );

    @_ = ( $l+1, $r );
    goto &f;

  }
} 
```

首次调用时，它将在堆栈上分配空间。然后它将更改其参数，并重新启动子程序，而不向堆栈添加任何内容。因此它会假装它从未调用过它自己，将它变成一个迭代过程。

*请注意，没有“ `my @_;`”或“ `local @_;`”，如果您这样做了，它将不再起作用。*

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2013-03-22T23:36:35.030

我将通过“归纳”设计一个 Haskell 数据结构来回答您的问题，这是一种“对偶”递归。然后我将展示这种二元性如何导致美好的事物。

我们为一棵简单的树引入一个类型：

```
data Tree a = Branch (Tree a) (Tree a)
            | Leaf a
            deriving (Eq) 
```

我们可以将这个定义解读为“一棵树是一个分支（包含两棵树）或者是一个叶子（包含一个数据值）”。所以叶子是一种最小的情况。如果一棵树不是叶子，那么它一定是包含两棵树的复合树。这些是唯一的情况。

让我们制作一棵树：

```
example :: Tree Int
example = Branch (Leaf 1) 
                 (Branch (Leaf 2) 
                         (Leaf 3)) 
```

现在，假设我们要为树中的每个值加 1。我们可以通过调用来做到这一点：

```
addOne :: Tree Int -> Tree Int
addOne (Branch a b) = Branch (addOne a) (addOne b)
addOne (Leaf a)     = Leaf (a + 1) 
```

首先，请注意这实际上是一个递归定义。它以数据构造函数 Branch 和 Leaf 为案例（并且由于 Leaf 是最小的并且这些是唯一可能的情况），我们确信该函数将终止。

以迭代方式编写 addOne 需要什么？循环到任意数量的分支会是什么样子？

此外，就“函子”而言，这种递归通常可以被分解出来。我们可以通过定义将树变成函子：

```
instance Functor Tree where fmap f (Leaf a)     = Leaf (f a)
                            fmap f (Branch a b) = Branch (fmap f a) (fmap f b) 
```

并定义：

```
addOne' = fmap (+1) 
```

我们可以分解出其他递归方案，例如代数数据类型的变态（或折叠）。使用变态，我们可以写：

```
addOne'' = cata go where
           go (Leaf a) = Leaf (a + 1)
           go (Branch a b) = Branch a b 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2017-11-30T13:46:18.543

堆栈溢出只会在您使用没有内置内存管理的语言进行编程时发生。否则，请确保您的函数中有某些内容（或函数调用、STDLbs 等）。如果没有递归，就不可能拥有诸如... Google 或 SQL 之类的东西，或者任何必须有效地对大型数据结构（类）或数据库进行排序的地方。

如果你想遍历文件，递归是要走的路，很确定这就是'find * | ?grep *' 有效。有点双重递归，尤其是使用管道（但不要像很多人喜欢做的那样做一堆系统调用，如果它是你要放在那里供其他人使用的任何东西）。

更高级的语言甚至 clang/cpp 都可以在后台实现它。

# architecture - Web 应用程序中的实体和值对象

> ID：72218
> 
> 赞同：2
> 
> 时间：2008-09-16T13:34:25.943
> 
> 标签：architecture, web-applications, domain-driven-design

我们有一个简单的域模型：Contact、TelephoneNumber 和 ContactRepository。联系人是实体，它有一个身份字段。TelephoneNumber 是典型的值对象：没有任何标识，不能与 Contact 实例分开加载。

另一方面，我们有用于操作联系人的 Web 应用程序。第一页是“ContactList”，下一页是“Contact/C0001”，显示联系方式和电话号码列表。

我们必须实施电话号码编辑表格。第一个近似的想法是添加一些可导航的页面，如“ThelephoneNumber/T0001”。

但是 ThelephoneNumber 是 Value Object 类，无法通过这种方式识别其实例。

解决此问题的最佳做法是什么？我们如何识别无状态应用程序中的不可识别对象？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T13:41:25.880

值对象状态是否标识了该特定实例？如果不是，您可以在提交编辑表单时传回旧值和新值，然后将任何具有旧状态的对象更新为新状态。

我宁愿有一个像 Contact/C0001/ThelephoneNumber 这样的页面，并使用联系人 id 和值对象类来标识您要更改的实例。

除非我完全误解了你的要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T13:41:40.500

我会让 TelephoneNumber 只包含一堆数字（可能是复数），并以这种方式引用它：Contact/C0001/TelephoneNumber(s)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:45:40.240

在实践中，我总是发现给电话号码一个身份更容易，即使这在设计方面并不是绝对必要的。

如果它是一个不能存在于联系人上下文之外的严格值对象，则表明良好的用户界面可能会要求在联系人页面内而不是在其自己的页面上编辑电话号码。

但是，如果您决定反对这两种方法中的任何一种，我认为 Marc Gear 的解决方案是一个很好的解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:42:25.860

尽管很多人希望你相信，但你不可能是 100% 纯洁的。

您的值对象需要某种身份字段。有时它对于像电话号码这样的对象来说是独一无二的，有时它必须是人造的，比如 TelephoneNumber.Id。

您越早接受这一点，对您就越好:-)

# ruby - 在 Ruby 中模拟构造函数

> ID：72220
> 
> 赞同：4
> 
> 时间：2008-09-16T13:34:37.363
> 
> 标签：ruby, ruby-mocha

我是一名 Java 开发人员，正在玩弄 Ruby，并且喜欢它。我了解到，由于 Ruby 的元编程工具，我的单元测试变得更加清晰，并且我不需要讨厌的模拟框架。我有一个需要`File`类服务的类，在我的测试中我不想接触我真正的文件系统。在 Java 中，我会使用一些虚拟文件系统来更轻松地“接缝”来传递假对象，但在 Ruby 中，这显然是矫枉过正。与 Java 世界相比，我想出的东西似乎已经很不错了。在我的测试类中，我有一个可选的构造函数参数：

```
def initialize(file_class=File) 
```

当我需要在课堂上打开文件时，我可以这样做：

```
@file_class.open(filename) 
```

并且调用转到真正的文件类，或者在我的单元测试的情况下，它转到不接触文件系统的假类。我知道必须有更好的方法来使用元编程来做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T13:36:51.757

Mocha ( [http://mocha.rubyforge.org/](http://mocha.rubyforge.org/) ) 是一个非常好的 ruby​​ 模拟库。根据您实际想要测试的内容（即，如果您想伪造 File.new 调用以避免文件系统依赖性，或者您想验证是否将正确的参数传递给 File.new），您可以这样做像这样的东西：

```
 require 'mocha'

mock_file_obj = mock("My Mock File") do
  stubs(:some_instance_method).returns("foo")
end

File.stubs(:new).with(is_a(String)).returns(mock_file_obj) 

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-21T19:54:51.400

This is a particularly difficult challenge for me. With the help I received on [this question](https://stackoverflow.com/questions/17204371/how-to-test-factory-pattern-using-mocha-in-ruby), and some extra work on my behalf, here's the solution I arrived at.

```
# lib/real_thing.rb
class RealThing
  def initialize a, b, c
    # ...
  end
end

# test/test_real_thing.rb
class TestRealThing < MiniTest::Unit::TestCase

  class Fake < RealThing; end

  def test_real_thing_initializer
    fake = mock()
    Fake.expects(:new).with(1, 2, 3).returns(fake)
    assert_equal fake, Fake.new(1, 2, 3)
  end

end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T15:30:30.127

在您概述的情况下，我建议您正在做的事情看起来不错。我知道这是 James Mead（Mocha 的作者）提倡的一种技术。没有必要仅仅为了它而进行元编程。 [以下是詹姆斯对此的看法](http://www.floehopper.org/articles/2007/11/29/mock-object-injection)（以及您可以尝试的一长串其他技术）

# apache - 从 PEM 文件中获取 ASN.1 颁发者字符串？

> ID：72237
> 
> 赞同：2
> 
> 时间：2008-09-16T13:36:11.260
> 
> 标签：apache, openssl, asn.1, schannel

我最近遇到了 Windows 2003 的一个问题（显然它也存在于其他版本中），如果 SSL/TLS 服务器正在请求客户端证书身份验证并且它具有超过 16KB 的受信任证书 DN、Internet Explorer（或任何其他应用程序）使用 schannel.dll）无法完成 SSL 握手。（简而言之，根据 RFC 2246 sec. 6.2.1，服务器将消息分成 2^14 字节的块，但 Schannel 并未被编写为支持这一点。我已从 Microsoft 支持部门确认这是一个Schannel 中的缺陷，他们正在考虑在未来的版本中修复它。）

所以我试图找到一种方法来轻松解析我的受信任证书（我使用 Apache 作为我的服务器，所以它们都是 PEM 格式）以获得 DN 的总 ASN.1 格式长度（这就是它们在握手期间通过电线发送），从而查看我是否太接近极限。不过，我还没有找到一种方法来做到这一点：OpenSSL asn1parse 函数很接近，但它似乎没有提供一种方法来获取仅针对发行者名称的 ASN.1 序列，这就是我需要。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T19:30:18.700

由于 ASN.1 是自描述的，因此编写 ASN.1 解析器相当容易。您可能知道，ASN.1 数据包含一个值树，其中每个值类型由一个全局分配的 OID（对象 ID）标识。您可以在以下位置找到带有源代码的免费 ASN.1 解码器：[http://www.geocities.co.jp/SiliconValley-SanJose/3377/asn1JS.html](http://www.geocities.co.jp/SiliconValley-SanJose/3377/asn1JS.html)。它是用 javascript 编写的，因此您可以直接在浏览器中使用它。

至于你的确切问题 - 我会：

1.  使用提供的解析器，找到另一个解析器或编写我自己的解析器
2.  查找受信任 DN 的 OID（检查规范或使用提供的 ASN.1 解码器页面简单地解码证书）
3.  结合以上两者来提取证书中受信任 DN 的大小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T20:38:45.360

openssl asn1parse 会做到这一点，但您需要进行一些手动解析来确定颁发者序列的开始位置。根据 RFC 5280，它是 TBSCertificate 序列中的第 4 项（如果是 v1 证书，则可能是第 3 项），紧跟在签名算法之后。在以下示例中：

```
 0:d=0  hl=4 l= 621 cons: SEQUENCE
    4:d=1  hl=4 l= 470 cons:  SEQUENCE
    8:d=2  hl=2 l=   3 cons:   cont [ 0 ]
   10:d=3  hl=2 l=   1 prim:    INTEGER           :02
   13:d=2  hl=2 l=   1 prim:   INTEGER           :02
   16:d=2  hl=2 l=  13 cons:   SEQUENCE
   18:d=3  hl=2 l=   9 prim:    OBJECT            :sha1WithRSAEncryption
   29:d=3  hl=2 l=   0 prim:    NULL
   31:d=2  hl=2 l=  64 cons:   SEQUENCE
   33:d=3  hl=2 l=  11 cons:    SET
   35:d=4  hl=2 l=   9 cons:     SEQUENCE
   37:d=5  hl=2 l=   3 prim:      OBJECT            :countryName
   42:d=5  hl=2 l=   2 prim:      PRINTABLESTRING   :US
   46:d=3  hl=2 l=  26 cons:    SET
   48:d=4  hl=2 l=  24 cons:     SEQUENCE
   50:d=5  hl=2 l=   3 prim:      OBJECT            :organizationName
   55:d=5  hl=2 l=  17 prim:      PRINTABLESTRING   :Test Certificates
   74:d=3  hl=2 l=  21 cons:    SET
   76:d=4  hl=2 l=  19 cons:     SEQUENCE
   78:d=5  hl=2 l=   3 prim:      OBJECT            :commonName
   83:d=5  hl=2 l=  12 prim:      PRINTABLESTRING   :Trust Anchor
   97:d=2  hl=2 l=  30 cons:   SEQUENCE
   99:d=3  hl=2 l=  13 prim:    UTCTIME           :010419145720Z
  114:d=3  hl=2 l=  13 prim:    UTCTIME           :110419145720Z
  129:d=2  hl=2 l=  59 cons:   SEQUENCE 
```

Issuer DN 从偏移量 31 开始，标头长度为 2，值长度为 64，总长度为 66 个字节。当然，这不是那么容易编写脚本...

# biztalk - 如何动态调用 BizTalk 编排

> ID：72240
> 
> 赞同：2
> 
> 时间：2008-09-16T13:36:20.463
> 
> 标签：biztalk, biztalk-2006

如何在知道业务流程名称的情况下动态调用 BizTalk 业务流程？

调用编排形状需要在设计时知道编排的名称和参数。我试过使用'call' XLang 关键字，但它还需要编排名称作为设计时间，就像表达式形状一样，我们可以写成

```
call BizTalkApplication1.Orchestration1(param1,param2); 
```

我正在寻找某种方式来指定调用编排名称，来自传入消息或来自 SSO 配置存储。

编辑：我正在考虑 BizTalk 2006 R1（ESB 指南适用于 R2，我不知道它如何解决我的问题）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-18T13:08:58.097

我过去完成类似事情的方式是在编排中使用直接绑定端口并让 MsgBox 为我完成繁琐的工作。基本上，它是这样的：

1.  使可调用的编排使用附加到您的激活接收形状的直接绑定端口。
2.  使用基于上下文的自定义属性在激活接收形状上设置过滤器表达式，并将其设置为唯一标识编排的值（例如编排名称或其他）
3.  在调用编排中，创建要用于触发新编排的消息。在该消息中，将您的自定义上下文属性设置为与您要触发的特定编排中使用的过滤器匹配的值。
4.  通过直接绑定的发送端口发送消息，以便将消息直接发送到 MsgBox，而 BizTalk 中的 Pub/Sub 机制将负责其余的工作。

在第 4 步中要注意的一件事：要使其正常工作，您需要创建一个包含自定义上下文属性的新关联集类型，然后确保直接绑定发送端口“遵循”关联集发送。否则，自定义属性只会被写入（而不是提升）到 msg 上下文，并且路由将失败。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-09-16T13:44:15.423

查看 ESB 指南 (www.codeplex.com/esb) 这个包提供了您正在寻找的功能

# ruby-on-rails - 如何在 Ruby on Rails 中的 cookie 上设置 HttpOnly 标志

> ID：72242
> 
> 赞同：39
> 
> 时间：2008-09-16T13:36:34.630
> 
> 标签：ruby-on-rails, ruby

*[保护您的 Cookie：HttpOnly](http://www.codinghorror.com/blog/archives/001167.html)*页面解释了为什么制作 HttpOnly cookie 是一个好主意。

如何在 Ruby on Rails 中设置此属性？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-16T14:04:18.010

在用于设置 cookie 的哈希中设置“http_only”选项

例如

```
cookies["user_name"] = { :value => "david", :httponly => true }
```

或者，在 Rails 2 中：

例如

```
cookies["user_name"] = { :value => "david", :http_only => true }
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-12-17T11:42:53.693

Re Laurie 的回答：

请注意，该选项在某些时候被重命名`:http_only`为`:httponly`（无下划线）。

在 actionpack 3.0.0 中，即 Ruby on Rails 3 中，所有对的引用`:http_only`都消失了。

这让我有一段时间。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-16T13:39:53.763

只需将 :http_only 设置为 true，如[更改日志](http://dev.rubyonrails.org/changeset/7525)中所述。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-11-07T21:13:31.320

如果您有一个名为 config/session_store.rb 的文件包括这一行（Rails 3+），那么它已经自动设置了。 `config/initializers/session_store.rb`：

```
# Be sure to restart your server when you modify this file.
Rails.application.config.session_store :cookie_store, key: "_my_application_session" 
```

rails 还允许您设置以下键：

**:expires** -*此 cookie 过期的时间，作为 Time 对象。*

**:secure** -*此 cookie 是否仅传输到 HTTPS 服务器。默认为假。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T18:49:19.733

我还写了一个包含在 Rails 2.2 中的补丁，它默认 CookieStore 会话为 http_only。

不幸的是，默认情况下会话 cookie 仍然是常规 cookie。

# linux - 如何在 X Windows / Linux 中确定 Windows 的可见区域？

> ID：72254
> 
> 赞同：0
> 
> 时间：2008-09-16T13:37:33.097
> 
> 标签：linux, firefox, x11, viewport

我有几个嵌套的 X 窗口 - 比方说 - 可滚动窗口中的可滚动窗口（参见下面的示例）。在这种情况下，主窗口包含（至少）主要滚动条和它们控制的（主要）绘图区域。该绘图区域轮流包含（至少）一个可滚动窗口批处理 - 一个（次要）主窗口，包含一个滚动条和次要绘图区域。

在内部绘图区域的实时滚动期间，重绘过程搞砸了，因为我正在使用 XCopyArea 来加速该过程并移动有效的内容并为新出现的内容调用实际的重绘例程。当内部绘图批处理本身时，这可以正常工作，但是当嵌套在另一个绘图批处理中时会出现问题 - 当内部滚动批处理部分可见（即主要绘图区域被滚动）时，重新绘制新出现的内容会从主要内容中剪裁绘图区域并从未实际重绘，但认为是这样。当在下一次滚动时，XCopyArea 得到这个所谓的重绘区域，它实际上是空的。最后这个空白区域出现在部分可见的内部滚动批次上，它是空的。在第一个一般重绘消息中，它们是固定的。

如果我可以获得从（我的）内部绘图区域实际可见的剪贴蒙版，我可以调整 XCopyArea() 调用和重绘调用，并在没有计划“B”的情况下克服问题，该计划在每个滚动条移动时重绘所有内容.

示例：为 Mozilla Firefox 开发一个插件，需要确定描述“我的”窗口可见区域的区域，即从 Mozilla 系统作为插件视口传递的区域。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T16:34:44.827

如果它真的是您获得的 X Window，而不是来自某些特定工具包的小部件（可能像 GTK+？），那么您可以使用 XGetWindowAttributes 函数调用。

这填写了一个提供的 XWindowAttributes 结构，其中包括窗口的 x 和 y 位置的整数以及它的宽度和高度以及其他有用的事实。

但实际上，我认为您可能正在使用从 Netscape 继承的 Mozilla 插件 API，也就是 NSAPI，在这种情况下，您得到的是对您的函数 NPP_SetWindow() 的调用至少一次（如果有必要，再次调用，因为发生了一些变化）包含您要查找的信息的结构。尝试查看[http://www.mozilla.org/projects/plugins/](http://www.mozilla.org/projects/plugins/)以获取有关您应该使用的 API 的更多信息。

# c# - 如何将 C++ windows dll 合并到 C# 应用程序 exe 中？

> ID：72264
> 
> 赞同：37
> 
> 时间：2008-09-16T13:38:18.323
> 
> 标签：c#, dll, merge

我有一个使用 C++ dll 进行数据 i/o 的 Windows C# 程序。我的目标是将应用程序部署为单个 EXE。

创建这样的可执行文件的步骤是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-16T13:40:32.170

托管和非托管代码的单一程序集部署 2007 年 2 月 4 日，星期日

.NET 开发人员喜欢 XCOPY 部署。他们喜欢单一的装配组件。至少我总是觉得有点不安，如果我必须使用某个组件并且需要记住一个文件列表，还需要包含在该组件的主程序集中。因此，当我最近不得不开发一个托管代码组件并不得不使用来自 C DLL 的一些非托管代码来扩充它时（感谢 Marcus Heege 帮助我解决这个问题！），我想到了如何更轻松地部署这两个 DLL . 如果这只是两个程序集，我可以使用 ILmerge 将它们打包到一个文件中。但这不适用于具有托管和非托管 DLL 的混合代码组件。

所以这是我想出的解决方案：

我将我想要与组件的主程序集一起部署的任何 DLL 作为嵌入式资源包含在内。然后我设置了一个类构造函数来提取这些 DLL，如下所示。类 ctor 在每个 AppDomain 中只调用一次，所以我认为它的开销可以忽略不计。

```
namespace MyLib
{
    public class MyClass
    {
        static MyClass()
        {
            ResourceExtractor.ExtractResourceToFile("MyLib.ManagedService.dll", "managedservice.dll");
            ResourceExtractor.ExtractResourceToFile("MyLib.UnmanagedService.dll", "unmanagedservice.dll");
        }

        ... 
```

在此示例中，我包含了两个 DLL 作为资源，一个是非托管代码 DLL，另一个是托管代码 DLL（仅用于演示目的），以展示该技术如何适用于这两种代码。

将 DLL 提取到自己的文件中的代码很简单：

```
public static class ResourceExtractor
{
    public static void ExtractResourceToFile(string resourceName, string filename)
    {
        if (!System.IO.File.Exists(filename))
            using (System.IO.Stream s = System.Reflection.Assembly.GetExecutingAssembly().GetManifestResourceStream(resourceName))
                using (System.IO.FileStream fs = new System.IO.FileStream(filename, System.IO.FileMode.Create))
                {
                    byte[] b = new byte[s.Length];
                    s.Read(b, 0, b.Length);
                    fs.Write(b, 0, b.Length);
                }
    }
} 
```

使用这样的托管代码程序集与往常一样 - 几乎。您在组件的主项目（此处：MyLib）中引用它（此处：ManagedService.dll），但将 Copy Local 属性设置为 false。此外，您将程序集链接为现有项目并将构建操作设置为嵌入式资源。

对于非托管代码（此处：UnmanagedService.dll），您只需将 DLL 作为现有项链接，并将构建操作设置为嵌入式资源。要访问其功能，请照常使用 DllImport 属性，例如

```
[DllImport("unmanagedservice.dll")] public extern static int Add(int a, int b); 
```

就是这样！一旦您使用静态 ctor 创建了该类的第一个实例，嵌入式 DLL 就会被提取到它们自己的文件中，并准备好使用，就像您将它们部署为单独的文件一样。只要您对执行目录具有写入权限，这对您来说应该可以正常工作。至少对于原型代码，我认为这种单程序集部署方式非常方便。

享受！

[http://weblogs.asp.net/ralfw/archive/2007/02/04/single-assembly-deployment-of-managed-and-unmanaged-code.aspx](http://weblogs.asp.net/ralfw/archive/2007/02/04/single-assembly-deployment-of-managed-and-unmanaged-code.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T19:55:30.110

试试[boxedapp](http://boxedapp.com/ "盒装应用sdk")；它允许从内存中加载所有 DLL。此外，您甚至可以嵌入 .net 运行时。很好地创建一个真正独立的应用程序......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-06-30T20:32:10.570

使用**Fody.Costura** nuget

1.  打开您的解决方案 -> 项目 -> 管理 Nuget 包
2.  搜索**Fody.Costura**
3.  **编译**您的*项目*。

就是这样 ！

> 资料来源： http: [//www.manuelmeyer.net/2016/01/net-power-tip-10-merging-assemblies/](http://www.manuelmeyer.net/2016/01/net-power-tip-10-merging-assemblies/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T13:44:50.973

你试过ILMerge吗？[http://research.microsoft.com/~mbarnett/ILMerge.aspx](http://research.microsoft.com/~mbarnett/ILMerge.aspx)

> ILMerge 是一个实用程序，可用于将多个 .NET 程序集合并为一个程序集。它可从 Microsoft .NET Framework 开发人员中心的工具和实用程序页面免费使用。

如果您正在使用`/clr`标志（全部或部分 C++/CLI）构建 C++ DLL，那么它应该可以工作：

```
ilmerge /out:Composite.exe MyMainApp.exe Utility.dll 
```

但是，它不适用于普通的（本机）Windows DLL。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-15T18:25:39.690

只需在 Visual Studio 中右键单击您的项目，选择 Project Properties -> Resources -> Add Resource -> Add Existing File... 并将以下代码包含到您的 App.xaml.cs 或等效项中。

```
public App()
{
    AppDomain.CurrentDomain.AssemblyResolve +=new ResolveEventHandler(CurrentDomain_AssemblyResolve);
}

System.Reflection.Assembly CurrentDomain_AssemblyResolve(object sender, ResolveEventArgs args)
{
    string dllName = args.Name.Contains(',') ? args.Name.Substring(0, args.Name.IndexOf(',')) : args.Name.Replace(".dll","");

    dllName = dllName.Replace(".", "_");

    if (dllName.EndsWith("_resources")) return null;

    System.Resources.ResourceManager rm = new System.Resources.ResourceManager(GetType().Namespace + ".Properties.Resources", System.Reflection.Assembly.GetExecutingAssembly());

    byte[] bytes = (byte[])rm.GetObject(dllName);

    return System.Reflection.Assembly.Load(bytes);
} 
```

这是我的原始博客文章： [http ://codeblog.larsholm.net/2011/06/embed-dlls-easily-in-a-net-assembly/](http://codeblog.larsholm.net/2011/06/embed-dlls-easily-in-a-net-assembly/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T13:40:44.197

[Thinstall](https://thinstall.com/help/index.php?_netsupport.htm)是一种解决方案。对于本机 Windows 应用程序，我建议将 DLL 作为二进制资源对象嵌入，然后在运行时在需要之前将其提取出来。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-15T11:42:07.340

[Smart Assembly](http://www.red-gate.com/products/dotnet-development/smartassembly/)可以做到这一点，甚至更多。如果您的 dll 具有非托管代码，它不会让您将 dll 合并到单个程序集中，而是可以将所需的依赖项作为资源嵌入到您的主 exe 中。它的另一面，它不是免费的。

您可以通过将 dll 嵌入到您的资源中然后依赖 AppDomain 的 Assembly 来手动执行此操作`ResolveHandler`。当谈到混合模式 dll 时，我发现许多方法的变体和风格`ResolveHandler`对我不起作用（所有这些都将 dll 字节读取到内存并从中读取）。他们都为托管 dll 工作。这对我有用：

```
static void Main()
{
    AppDomain.CurrentDomain.AssemblyResolve += (sender, args) =>
    {
        string assemblyName = new AssemblyName(args.Name).Name;
        if (assemblyName.EndsWith(".resources"))
            return null;

        string dllName = assemblyName + ".dll";
        string dllFullPath = Path.Combine(GetMyApplicationSpecificPath(), dllName);

        using (Stream s = Assembly.GetEntryAssembly().GetManifestResourceStream(typeof(Program).Namespace + ".Resources." + dllName))
        {
            byte[] data = new byte[stream.Length];
            s.Read(data, 0, data.Length);

            //or just byte[] data = new BinaryReader(s).ReadBytes((int)s.Length);

            File.WriteAllBytes(dllFullPath, data);
        }

        return Assembly.LoadFrom(dllFullPath);
    };
} 
```

这里的关键是将字节写入文件并从其位置加载。为了避免先有鸡还是先有蛋的问题，您必须确保在访问程序集之前声明处理程序，并且不要在加载（程序集解析）部分中访问程序集成员（或实例化任何必须处理程序集的东西）。还要注意确保`GetMyApplicationSpecificPath()`不是任何临时目录，因为临时文件可能会被其他程序或您自己尝试删除（不是说它会在您的程序访问 dll 时被删除，但至少它很麻烦。AppData 很好地点）。另请注意，您每次都必须写入字节，您不能从位置加载，因为 dll 已经存在于那里。

如果程序集完全不受管理，您可以查看此[链接](https://stackoverflow.com/questions/666799/embedding-unmanaged-dll-into-a-managed-c-sharp-dll)或[此](http://bsmadhu.wordpress.com/2012/03/19/embedding-c-libraryexe-inside-net-assembly/)链接以了解如何加载此类 dll。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-04-10T19:58:15.177

[Xenocode](http://www.xenocode.com/)的PostBuild可以将托管和非托管打包到单个 exe 中。

# c++ - “文件末尾没有换行符”编译器警告

> ID：72271
> 
> 赞同：195
> 
> 时间：2008-09-16T13:38:42.160
> 
> 标签：c++, compiler-construction, warnings, c-preprocessor

在某些 C++ 编译器中出现以下警告的原因是什么？

> 文件末尾没有换行符

为什么我应该在源/头文件的末尾有一个空行？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2008-09-16T13:49:29.917

想想如果没有换行符可能会出现的一些问题。根据 ANSI 标准`#include`，文件的开头将文件完全按原样插入到文件的前面，而不是在`#include <foo.h>`文件内容之后插入新行。因此，如果您在解析器的末尾包含一个没有换行符的文件，它将被视为最后一行`foo.h`与`foo.cpp`. 如果 foo.h 的最后一行是没有新行的注释怎么办？现在第一行`foo.cpp`被注释掉了。这些只是可能出现的问题类型的几个示例。

* * *

只是想向任何感兴趣的人指出詹姆斯在下面的回答。虽然上述答案对于 C 仍然是正确的，但新的 C++ 标准 (C++11) 已更改，因此如果使用 C++ 和符合 C++11 的编译器，则不应再发出此警告。

通过 James 的帖子来自 C++11 标准：

> 如果源文件不为空且不以换行符结尾，或者在任何此类拼接发生之前以换行符结尾且紧接在反斜杠字符之前，则应将其视为附加的 new-行字符被附加到文件中（C++11 §2.2/1）。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2011-11-17T18:30:36.033

在 C++11 中删除了每个源文件都以非转义换行符结尾的要求。该规范现在写道：

> 如果源文件不为空且不以换行符结尾，或者在任何此类拼接发生之前以换行符结尾且紧接在反斜杠字符之前，则应将其视为附加的 new-行字符被附加到文件中（C++11 §2.2/1）。

符合标准的编译器不应再发出此警告（至少在以 C++11 模式编译时，如果编译器具有针对语言规范的不同修订版的模式）。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-16T13:52:09.600

C++03 标准 [2.1.1.2] 声明：

> ...如果一个非空的源文件不以换行符结尾，或者在任何此类拼接发生之前以紧跟反斜杠字符的换行符结尾，则行为未定义。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-16T13:46:30.503

“听话”的答案是“因为 C++03 标准说不以换行符结尾的程序的行为是未定义的”（释义）。

好奇的答案在这里： http: [//gcc.gnu.org/ml/gcc/2001-07/msg01120.html](http://gcc.gnu.org/ml/gcc/2001-07/msg01120.html)。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-16T13:40:39.207

它不是指空行，而是最后一行（可以包含内容）是否以换行符终止。

大多数文本编辑器会在文件的最后一行末尾添加换行符，因此如果最后一行没有换行符，则存在文件已被截断的风险。但是，您可能不想要换行符是有正当理由的，因此它只是一个警告，而不是错误。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-16T13:47:45.070

`#include`将用文件的文字内容替换它的行。如果文件不以换行符结尾，则包含将`#include`其拉入的行将与下一行合并。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-23T16:47:51.763

> 当然，实际上每个编译器都会在#include 之后添加一个新行。谢天谢地。– @mxcl

不是特定的 C/C++ 而是 C 方言：使用`GL_ARB_shading_language_include`扩展时，OS X 上的 glsl 编译器会警告您**不要**缺少换行符。因此，您可以编写一个`MyHeader.h`带有标题保护的文件，该文件以结尾，`#endif // __MY_HEADER_H__`并且您肯定**会**丢失该行`#include "MyHeader.h"`。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-12-11T09:47:33.483

我正在使用无 c 的 IDE 5.0 版，在我的“c++”或“c”语言的程序中，我遇到了同样的问题。**就在程序的最后，**即程序的最后一行（在函数大括号之后，它可能是main 或任何功能），**按回车**-行号。将增加1。然后执行相同的程序，它将运行没有错误。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-08-06T08:43:25.350

因为如果文件不以换行符结尾，则 C/C++ 版本之间的行为会有所不同。特别令人讨厌的是较旧的 C++ 版本，标准中说的 C++ 03 中的 fx（翻译阶段）：

> 如果非空源文件不以换行符结尾，或以紧跟反斜杠字符的换行符结尾，则行为未定义。

未定义的行为是不好的：符合标准的编译器可以在这里或多或少地做它想要的（插入恶意代码或其他） - 显然是警告的原因。

虽然 C++11 中的情况更好，但最好避免在早期版本中行为未定义的情况。C++03 规范比 C99 更糟糕，后者完全禁止此类文件（然后定义行为）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-01-07T16:19:58.593

此警告还可能有助于表明文件可能已被截断。确实，编译器无论如何都会抛出编译器错误——尤其是在函数中间时——或者可能是链接器错误，但这些可能更神秘，并且不能保证会发生。

当然，如果文件在换行后立即被截断，也不能保证这个警告，但它仍然可以捕捉到其他错误可能遗漏的一些情况，并为问题提供更强有力的提示。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2011-07-21T09:07:00.153

那不是错误。这只是一个警告。

在编辑器中打开文件，转到文件的最后一行，然后按 Enter 在文件末尾添加一个空行。

不过，除此之外，您应该使用`#include <iostream>`而不是`<iostream.h>`. 然后在`using std::cout;`它后面放一个。

# c# - 什么时候应该在 C# 中使用 volatile 关键字？

> ID：72275
> 
> 赞同：348
> 
> 时间：2008-09-16T13:39:04.530
> 
> 标签：c#, multithreading

谁能很好地解释 C# 中的 volatile 关键字？它解决了哪些问题，没有解决哪些问题？在哪些情况下它会节省我使用锁定的时间？

* * *

## 回答 #1

> 赞同：294
> 
> 时间：2013-07-08T15:34:35.263

我认为没有比[Eric Lippert](https://ericlippert.com/2011/06/16/atomicity-volatility-and-immutability-are-different-part-three/)更好的人来回答这个问题（强调原文）：

> 在 C# 中，“volatile”不仅意味着“确保编译器和抖动不会对此变量执行任何代码重新排序或注册缓存优化”。这也意味着“告诉处理器做他们需要做的任何事情，以确保我正在读取最新的值，即使这意味着停止其他处理器并使它们与它们的缓存同步主内存”。
> 
> 实际上，最后一点是谎言。volatile 读写的真正语义比我在这里概述的要复杂得多。事实上**，它们实际上并不能保证每个处理器都会停止它正在做的事情**并更新缓存到主内存/从主内存更新。相反，**它们提供了较弱的保证，即可以观察到读取和写入之前和之后的内存访问如何相对于彼此进行排序**。某些操作（例如创建新线程、进入锁或使用 Interlocked 系列方法之一）会为观察排序引入更强的保证。如果您想了解更多详细信息，请阅读 C# 4.0 规范的第 3.10 和 10.5.3 节。
> 
> 坦率地说，**我不鼓励你创建一个 volatile field**。易失性字段表明您正在做一些彻头彻尾的疯狂事情：您试图在两个不同的线程上读取和写入相同的值而没有设置锁。锁保证观察到锁内的内存读取或修改是一致的，锁保证一次只有一个线程访问给定的内存块，等等。锁太慢的情况很少，因为不了解确切的内存模型而导致代码错误的可能性很大。除了互锁操作的最琐碎用法之外，我不会尝试编写任何低锁代码。我将“易失性”的用法留给真正的专家。

如需进一步阅读，请参阅：

*   [了解低锁技术在多线程应用程序中的影响](https://docs.microsoft.com/archive/msdn-magazine/2005/october/understanding-low-lock-techniques-in-multithreaded-apps)
*   [Sayonara 挥发物](http://joeduffyblog.com/2010/12/04/sayonara-volatile/)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2008-09-16T14:41:40.963

如果您想稍微了解 volatile 关键字的作用，请考虑以下程序（我使用的是 DevStudio 2005）：

```
#include <iostream>
void main()
{
  int j = 0;
  for (int i = 0 ; i < 100 ; ++i)
  {
    j += i;
  }
  for (volatile int i = 0 ; i < 100 ; ++i)
  {
    j += i;
  }
  std::cout << j;
} 
```

使用标准优化（发布）编译器设置，编译器创建以下汇编器 (IA32)：

```
void main()
{
00401000  push        ecx  
  int j = 0;
00401001  xor         ecx,ecx 
  for (int i = 0 ; i < 100 ; ++i)
00401003  xor         eax,eax 
00401005  mov         edx,1 
0040100A  lea         ebx,[ebx] 
  {
    j += i;
00401010  add         ecx,eax 
00401012  add         eax,edx 
00401014  cmp         eax,64h 
00401017  jl          main+10h (401010h) 
  }
  for (volatile int i = 0 ; i < 100 ; ++i)
00401019  mov         dword ptr [esp],0 
00401020  mov         eax,dword ptr [esp] 
00401023  cmp         eax,64h 
00401026  jge         main+3Eh (40103Eh) 
00401028  jmp         main+30h (401030h) 
0040102A  lea         ebx,[ebx] 
  {
    j += i;
00401030  add         ecx,dword ptr [esp] 
00401033  add         dword ptr [esp],edx 
00401036  mov         eax,dword ptr [esp] 
00401039  cmp         eax,64h 
0040103C  jl          main+30h (401030h) 
  }
  std::cout << j;
0040103E  push        ecx  
0040103F  mov         ecx,dword ptr [__imp_std::cout (40203Ch)] 
00401045  call        dword ptr [__imp_std::basic_ostream<char,std::char_traits<char> >::operator<< (402038h)] 
}
0040104B  xor         eax,eax 
0040104D  pop         ecx  
0040104E  ret 
```

查看输出，编译器决定使用 ecx 寄存器来存储 j 变量的值。对于非易失性循环（第一个），编译器已将 i 分配给 eax 寄存器。非常坦率的。不过有几个有趣的位 - lea ebx,[ebx] 指令实际上是一个多字节 nop 指令，因此循环跳转到 16 字节对齐的内存地址。另一种是使用 edx 来增加循环计数器，而不是使用 inc eax 指令。与 inc reg 指令相比，add reg,reg 指令在一些 IA32 内核上具有较低的延迟，但从来没有更高的延迟。

现在使用 volatile 循环计数器的循环。计数器存储在 [esp] 中，并且 volatile 关键字告诉编译器该值应始终从内存读取/写入内存，并且永远不要分配给寄存器。编译器甚至在更新计数器值时不将加载/递增/存储作为三个不同的步骤（加载 eax、inc eax、保存 eax），而是在单个指令中直接修改内存（添加 mem ，注册）。创建代码的方式确保循环计数器的值在单个 CPU 内核的上下文中始终是最新的。对数据的任何操作都不会导致损坏或数据丢失（因此不使用 load/inc/store，因为在 inc 期间值可能会发生变化，从而在存储中丢失）。由于只有当前指令完成后才能处理中断，

一旦将第二个 CPU 引入系统， volatile 关键字将无法防止数据同时被另一个 CPU 更新。在上面的示例中，您需要未对齐数据才能获得潜在的损坏。如果无法以原子方式处理数据，则 volatile 关键字将无法防止潜在的损坏，例如，如果循环计数器的类型为 long long（64 位），则需要两个 32 位操作来更新值，在中间可能会发生中断并更改数据。

因此，volatile 关键字仅适用于小于或等于本机寄存器大小的对齐数据，这样操作始终是原子的。

volatile 关键字被设想用于 IO 操作，其中 IO 将不断变化但具有恒定地址，例如内存映射的 UART 设备，并且编译器不应继续重用从该地址读取的第一个值。

如果您正在处理大数据或有多个 CPU，那么您将需要更高级别 (OS) 的锁定系统来正确处理数据访问。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2014-02-27T20:25:24.617

如果您使用的是 .NET 1.1，则在执行双重检查锁定时需要 volatile 关键字。为什么？因为在 .NET 2.0 之前，以下场景可能会导致第二个线程访问非空但未完全构造的对象：

1.  线程 1 询问变量是否为空。//如果（this.foo == null）
2.  线程 1 确定变量为空，因此进入锁。//锁定（this.bar）
3.  线程 1 再次询问变量是否为空。//如果（this.foo == null）
4.  线程 1 仍然确定变量为 null，因此它调用构造函数并将值分配给变量。//this.foo = new Foo();

在 .NET 2.0 之前，可以在构造函数完成运行之前为 this.foo 分配新的 Foo 实例。在这种情况下，第二个线程可能进入（在线程 1 调用 Foo 的构造函数期间）并遇到以下情况：

1.  线程 2 询问变量是否为空。//如果（this.foo == null）
2.  线程 2 确定变量不为空，因此尝试使用它。//this.foo.MakeFoo()

在 .NET 2.0 之前，您可以将 this.foo 声明为 volatile 以解决此问题。从 .NET 2.0 开始，您不再需要使用 volatile 关键字来完成双重检查锁定。

Wikipedia 实际上有一篇关于 Double Checked Locking 的好文章，并简要介绍了这个主题： [http ://en.wikipedia.org/wiki/Double-checked_locking](http://en.wikipedia.org/wiki/Double-checked_locking)

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-09-16T13:52:16.230

有时，编译器会优化一个字段并使用寄存器来存储它。如果线程 1 写入该字段并且另一个线程访问它，因为更新存储在寄存器（而不是内存）中，所以第二个线程将获得陈旧的数据。

您可以将 volatile 关键字视为对编译器说“我希望您将此值存储在内存中”。这保证了第二个线程检索最新的值。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-09-16T13:45:58.630

来自[MSDN](http://msdn.microsoft.com/en-us/library/x13ttww7(VS.71).aspx)： volatile 修饰符通常用于由多个线程访问的字段，而不使用 lock 语句来序列化访问。使用 volatile 修饰符可确保一个线程检索另一个线程写入的最新值。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-16T13:42:40.463

CLR 喜欢优化指令，因此当您访问代码中的字段时，它可能并不总是访问该字段的当前值（它可能来自堆栈等）。将字段标记为`volatile`可确保指令访问该字段的当前值。当程序中的并发线程或操作系统中运行的一些其他代码可以修改值（在非锁定场景中）时，这很有用。

你显然失去了一些优化，但它确实使代码更简单。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-11-17T21:39:36.337

我发现[Joydip Kanjilal](https://www.infoworld.com/article/3229360/how-to-use-the-volatile-keyword-in-c.html)的这篇文章很有帮助！

`When you mark an object or a variable as volatile, it becomes a candidate for volatile reads and writes. It should be noted that in C# all memory writes are volatile irrespective of whether you are writing data to a volatile or a non-volatile object. However, the ambiguity happens when you are reading data. When you are reading data that is non-volatile, the executing thread may or may not always get the latest value. If the object is volatile, the thread always gets the most up-to-date value`

我把它留在这里以供参考

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-12-04T13:49:26.487

只需查看[volatile 关键字](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/volatile)的官方页面，您就可以看到典型用法的示例。

```
public class Worker
{
    public void DoWork()
    {
        bool work = false;
        while (!_shouldStop)
        {
            work = !work; // simulate some work
        }
        Console.WriteLine("Worker thread: terminating gracefully.");
    }
    public void RequestStop()
    {
        _shouldStop = true;
    }

    private volatile bool _shouldStop;
} 
```

> 将 volatile 修饰符添加到 _shouldStop 的声明中，您将始终获得相同的结果。但是，如果 _shouldStop 成员上没有该修饰符，则行为是不可预测的。

所以这绝对不是*彻头彻尾的疯狂*。

存在负责 CPU 缓存一致性的缓存一致性[。](https://en.wikipedia.org/wiki/Cache_coherence)

此外，如果 CPU 采用[强内存模型](https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/january/csharp-the-csharp-memory-model-in-theory-and-practice-part-2)（如 x86）

> 因此，对 volatile 字段的读取和写入不需要 x86 上的特殊指令：普通读取和写入（例如，使用 MOV 指令）就足够了。

C# 5.0 规范中的示例（第 10.5.3 章）

```
using System;
using System.Threading;
class Test
{
    public static int result;   
    public static volatile bool finished;
    static void Thread2() {
        result = 143;    
        finished = true; 
    }
    static void Main() {

        finished = false;
        new Thread(new ThreadStart(Thread2)).Start();

        for (;;) {
            if (finished) {
                Console.WriteLine("result = {0}", result);
                return;
            }
        }
    }
} 
```

**产生输出：result = 143**

> 如果已完成的字段没有被声明为 volatile，那么在存储完成后，存储结果对主线程可见是允许的，因此主线程可以从字段结果中读取值 0。

易失性行为取决于平台，因此您应该始终考虑`volatile`在需要时使用，以确保它满足您的需求。

甚至`volatile`无法阻止（各种）重新排序（[C# - The C# Memory Model in Theory and Practice，第 2 部分](https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/january/csharp-the-csharp-memory-model-in-theory-and-practice-part-2)）

> 尽管对 A 的写入是易失的，而从 A_Won 的读取也是易失的，但栅栏都是单向的，实际上允许这种重新排序。

所以我相信如果你想知道什么时候使用`volatile`(vs `lock`vs `Interlocked`) 你应该熟悉内存栅栏(full, half) 和同步的需求。然后，您自己就可以得到宝贵的答案。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-02-08T16:44:33.213

编译器有时会更改代码中语句的顺序以对其进行优化。通常这在单线程环境中不是问题，但在多线程环境中可能是问题。请参见以下示例：

```
 private static int _flag = 0;
 private static int _value = 0;

 var t1 = Task.Run(() =>
 {
     _value = 10; /* compiler could switch these lines */
     _flag = 5;
 });

 var t2 = Task.Run(() =>
 {
     if (_flag == 5)
     {
         Console.WriteLine("Value: {0}", _value);
     }
 }); 
```

如果您运行 t1 和 t2，您会期望没有输出或“值：10”作为结果。可能是编译器在 t1 函数内切换行。如果 t2 然后执行，可能是 _flag 的值为 5，但 _value 的值为 0。所以预期的逻辑可能会被破坏。

要解决此问题，您可以使用可应用于该字段的**volatile关键字。**此语句禁用编译器优化，因此您可以强制代码中的正确顺序。

```
private static volatile int _flag = 0; 
```

仅在真正需要时才应使用**volatile ，因为它会禁用某些编译器优化，会损害性能。**并非所有 .NET 语言都支持它（Visual Basic 不支持它），因此它阻碍了语言的互操作性。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-12-14T12:32:59.443

综上所述，问题的正确答案是：如果您的代码在 2.0 运行时或更高版本中运行，则几乎不需要 volatile 关键字，如果不必要地使用，弊大于利。IE 永远不要使用它。但是在运行时的早期版本中，需要对静态字段进行正确的双重检查锁定。特别是类具有静态类初始化代码的静态字段。

* * *

## 回答 #11

> 赞同：-9
> 
> 时间：2013-11-04T10:23:52.587

多个线程可以访问一个变量。最新更新将在变量上

# sql-server - FileLoadException / Msg 10314 错误运行 CLR 存储过程

> ID：72281
> 
> 赞同：36
> 
> 时间：2008-09-16T13:39:33.983
> 
> 标签：sql-server, sqlclr

尝试运行 CLR 存储过程时收到以下错误。任何帮助深表感谢。

```
Msg 10314, Level 16, State 11, Line 1
An error occurred in the Microsoft .NET Framework while trying to load assembly id 65752\. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: 
System.IO.FileLoadException: Could not load file or assembly 'orders, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. An error relating to security occurred. (Exception from HRESULT: 0x8013150A)
System.IO.FileLoadException: 
   at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark& stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)
   at System.Reflection.Assembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark& stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)
   at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark& stackMark, Boolean forIntrospection)
   at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark& stackMark, Boolean forIntrospection)
   at System.Reflection.Assembly.Load(String assemblyString) 
```

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-16T13:52:55.010

Ran the SQL commands below and the issue appears to be resolved.

```
USE database_name
GO

EXEC sp_changedbowner 'sa'
ALTER DATABASE database_name SET TRUSTWORTHY ON 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-08-31T09:00:34.470

使用任何 CPU 配置构建您的项目。当我使用 x86 配置编译我自己的项目并尝试在 x64 SQL 服务器上运行它时，我遇到了这个问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-01T10:12:27.277

应用了上述所有建议，但失败了。然后我用“Any CPU”选项重新编译了我的源代码，它成功了！

此链接有帮助： [SQL Server failed to load assembly with PERMISSION](http://www.codeproject.com/Tips/147250/SQL-Server-failed-to-load-assembly-with-PERMISSION)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:51:56.887

Does your assembly do file I/O? If so, you must grant the assembly permission to do this. In SSMS:

1.  Expand "Databases"
2.  Expand the node for your database
3.  Expand "Programmability"
4.  Expand "Assemblies"
5.  Right-click your assembly, choose Properties
6.  On the "General" page, change "Permission set" to "External access"

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-09-15T12:31:41.753

```
ALTER AUTHORIZATION ON DATABASE::mydb TO sa;
ALTER DATABASE [myDB] SET TRUSTWORTHY ON
GO 
```

# iphone - 学习 OpenGL ES 1.x

> ID：72288
> 
> 赞同：20
> 
> 时间：2008-09-16T13:40:04.527
> 
> 标签：iphone, 3d, opengl-es

加快 OpenGL ES 1.x 速度的最快方法是什么？

假设我对 OpenGL 一无所知（这并不完全正确，但距离我上次使用 OpenGL 已经有一段时间了）。我最感兴趣的是学习这个用于与 iPhone 相关的开发，但我也有兴趣了解它如何在其他平台上工作。

我找到了*OpenGL ES 2.0 Programming Guide*这本书，但我担心它可能不是最好的方法，因为它关注的是 2.0 而不是 1.x。我的理解是 2.0 不向后兼容 1.x，所以我可能会错过一些重要的概念。

注意：有关学习通用 OpenGL 的答案，请参阅[https://stackoverflow.com/questions/62540/learning-opengl](https://stackoverflow.com/questions/62540/learning-opengl)

* * *

我发现的一些资源：

*   [http://khronos.org/opengles/1_X/](http://khronos.org/opengles/1_X/)
*   [http://www.imgtec.com/powervr/insider/sdk/KhronosOpenGLES1xMBX.asp](http://www.imgtec.com/powervr/insider/sdk/KhronosOpenGLES1xMBX.asp)
*   [OpenGL Distilled](https://rads.stackoverflow.com/amzn/click/com/0321336798) by Paul Martz（OpenGL 基础知识的一个很好的复习）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-20T16:35:54.373

如果我可以插入我自己的工作，我会引导您访问我在[http://www.sunsetlakesoftware.com/2008/08/05/lessons-molecules-opengl-es](http://www.sunsetlakesoftware.com/2008/08/05/lessons-molecules-opengl-es)上的帖子。这不是对 OpenGL ES 最好的整体介绍，它很快就会变得相当技术性，但这是我从编写[Molecules](http://www.sunsetlakesoftware.com/molecules)的经验中对这个主题的看法。另外，我刚刚开始阅读[“Mobile 3D Graphics: with OpenGL ES and M3G”](https://rads.stackoverflow.com/amzn/click/com/0123737273)一书。

我同意最好的学习方式是通过实践的建议。一开始我对 OpenGL 一无所知，三周后，Molecules 在 App Store 中进行了审核。一旦您有了明确的目标（“好的，我需要绘制一个 3-D 球体”、“现在我需要按需旋转它”），就很容易找到仅适用于你正在处理的任务。

那里有很多代码示例，尽管其中很多都使用即时模式和 OpenGL ES 不支持的其他调用。 ~~我很想通过向 Molecules 发布源来添加到列表中，但到目前为止，Apple 的 NDA 阻止了这一点。~~ Molecules 的源代码[现在可用](http://www.sunsetlakesoftware.com/molecules)。

我在 OpenGL ES 1.1 上教授的课程的视频现在可以作为[我在 iTunes U 上的春季课程的](https://podcasts.apple.com/us/podcast/advanced-iphone-development-spring-2010/id407243032)一部分下载。可以在[此处](http://www.sunsetlakesoftware.com/sites/default/files/Spring2010CourseNotes/opengl%20es.html)找到该会话的注释。[秋季学期的视频](https://podcasts.apple.com/us/podcast/advanced-iphone-development-fall-2010/id407243028)有一个关于 OpenGL ES 2.0 的课程。

此外，Philip Rideout 还发布了一本关于 iPhone OpenGL ES 1.1 和 2.0 开发的优秀书籍，名为[iPhone 3D Programming](http://oreilly.com/catalog/9780596804831)。我强烈推荐它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T16:22:55.180

iPhone SDK 本身有一些文档。

除此之外，只需了解您对 OpenGL 的了解（或通过其他方式了解），而忘掉所有“老生常谈”的东西（显示列表、即时模式、OpenGL 中但与绘制三角形）。基本上，忘记所有在 OpenGL 3.0 中被声明为弃用的东西。

GL ES 1.x 适用于非常简单的设备。您所拥有的是一种绘制几何图形（顶点缓冲区）、管理纹理和设置一些固定功能状态（照明、纹理组合器）的方法。这就是它的全部内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-17T10:14:00.273

[https://web.archive.org/web/20160309222642/http://iphonedevelopment.blogspot.com/2009/05/opengl-es-from-ground-up-table-of.html](https://web.archive.org/web/20160309222642/http://iphonedevelopment.blogspot.com/2009/05/opengl-es-from-ground-up-table-of.html)有一些优秀的教程

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T15:20:12.490

当我开始使用 OpenGL ES 时，我发现这些非常有用，只是想看看在处理 ES 时会采用什么方法，而不是普通的 GL。

[http://www.zeuscmd.com/tutorials/opengles/index.php](http://www.zeuscmd.com/tutorials/opengles/index.php)

如前所述，iPhone 开发者网站也提供了一些示例：

*   [https://developer.apple.com/documentation/opengles](https://developer.apple.com/documentation/opengles)
*   [https://developer.apple.com/library/archive/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Introduction/Introduction.html](https://developer.apple.com/library/archive/documentation/3DDrawing/Conceptual/OpenGLES_ProgrammingGuide/Introduction/Introduction.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-17T18:28:09.180

仅供参考，Brad Larsons 分子代码现在可[在此处](http://www.sunsetlakesoftware.com/2008/11/12/molecules-13-submitted-review)获得。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-09T18:51:14.380

You might want to take a look at [this](http://iphonedevelopment.blogspot.com/search/label/OpenGL%20ES?updated-max=2010-04-27T14%3A49%3A00-07%3A00&max-results=20) excellent Jef LaMarche’s Tutorial to OpenGL ES on the iPhone.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T01:37:39.873

在花了相当多的时间开发 3D 之后，我开始意识到，在大多数情况下，最好的方法是通过示例学习并随着你的进步而进步。

首先为自己设定一个要实现的目标（例如 - 实现粒子系统。这包括使用混合模式、纹理、顶点颜色、批处理和转换），然后从最简单的元素开始 - 绘制和旋转四边形. 从那里继续添加纹理，添加更多四边形等...在这样做时，您需要一些有关语法的信息-您可以在许多书中找到，但是最好的（非常无聊的）来源是规范委员会的出版物可以在这里找到：[http ://www.khronos.org/opengles/spec/](http://www.khronos.org/opengles/spec/)

即使这样你也会遇到很多问题，好吧，一旦你遇到问题，在这些情况下去找你最好的朋友：演示和示例！
您可以在网上和苹果网站上找到许多 iPhone 的示例源，因此请下载它们，复制粘贴您需要的内容，然后根据您的需要进行更改。

玩得开心。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-17T18:51:25.933

如果您已经下载了 iPhone SDK 示例，请查看崩溃登陆的 EAGLview 文件。这是一个非常直接的 GLES 视图实现，可以在另一个项目中相当干净地导入和使用。该项目中还有一个名为 Texture2d 的类（如果我记得的话），如果您使用 GLES 进行 2D，它也非常有趣。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T01:17:18.317

我还可以建议 Android - 它很容易获得，并且您可以非常快速地拥有一个工作模拟器。此外，据我所知，它使用 v1.0。
可能会有更多教程，但即使是 Google 提供的 APIDemos 也有对 OpenGL ES 的介绍。我当然发现它很有帮助。

# visual-studio - 我应该将 Visual Studio .suo 和 .user 文件添加到源代码管理吗？

> ID：72298
> 
> 赞同：887
> 
> 时间：2008-09-16T13:40:42.437
> 
> 标签：visual-studio, version-control

Visual Studio 解决方案包含两种类型的隐藏用户文件。一个是解决方案`.suo`文件，它是一个二进制文件。另一个是项目`.user`文件，它是一个文本文件。这些文件究竟包含哪些数据？

我也一直想知道是否应该将这些文件添加到源代码控制（在我的例子中是 Subversion）。如果我不添加这些文件并且其他开发人员签出解决方案，Visual Studio 会自动创建新的用户文件吗？

* * *

## 回答 #1

> 赞同：700
> 
> 时间：2008-09-16T14:08:40.497

这些文件包含通常特定于您的机器的用户首选项配置，因此最好不要将其放在 SCM 中。此外，VS 几乎每次执行时都会更改它，因此 SCM 将始终将其标记为“已更改”。我也不包括在内，我在一个使用 VS 的项目中使用了 2 年，并且没有任何问题。唯一的小烦恼是调试参数（执行路径、部署目标等）存储在其中一个文件中（不知道是哪个文件），所以如果你有它们的标准，你将无法'通过 SCM 发布它，让其他开发人员拥有整个开发环境“准备使用”。

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2008-09-16T13:42:39.247

您不需要添加这些 - 它们包含每个用户的设置，其他开发人员不会想要您的副本。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2008-09-17T14:55:38.207

其他人已经解释了为什么将`*.suo`and`*.user`文件置于源代码控制之下并不是一个好主意。

我建议您将这些模式添加到`svn:ignore`属性中，原因有两个：

1.  因此，其他开发人员不会以一个开发人员的设置结束。
2.  因此，当您查看状态或提交文件时，这些文件不会弄乱代码库并掩盖您需要添加的新文件。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2008-09-16T13:46:05.887

我们不提交二进制文件 (*.suo)，但我们提交 .user 文件。.user 文件包含例如调试项目的启动选项。您可以在“调试”选项卡中的项目属性中找到启动选项。我们在一些项目中使用了 NUnit，并将 nunit-gui.exe 配置为项目的启动选项。如果没有 .user 文件，每个团队成员都必须单独配置它。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2011-07-04T14:21:16.293

由于我在 2011 年通过 Google 找到了这个问题/答案，我想我会花一点时间将 Visual Studio 2010 创建的 *.SDF 文件的链接添加到可能不应该添加到版本控制的文件列表中（ IDE 将重新创建它们）。由于我不确定 *.sdf 文件是否可以在其他地方合法使用，所以我只忽略了来自 SVN 的特定 [projectname].sdf 文件。

*[为什么 Visual Studio 转换向导 2010 会创建海量的 SDF 数据库文件？](https://stackoverflow.com/q/4237660/759749)*

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2008-09-16T13:55:38.047

不，您不应该将它们添加到源代码管理中，因为-正如您所说-它们是特定于用户的。

> SUO（解决方案用户选项）：记录您可能与您的解决方案关联的所有选项，以便每次打开它时，它都包含您所做的自定义。

.user 文件包含项目的用户选项（而SUO 用于解决方案）并扩展项目文件名（例如anything.csproj.user 包含anything.csproj 项目的用户设置）。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2008-09-16T13:52:23.220

这似乎是微软对此事的看法：

*[添加（和编辑）.suo 文件到源代码管理](http://social.msdn.microsoft.com/forums/en-US/vssourcecontrol/thread/dee90d75-d825-4c76-a30f-016eab15ef7f)*

> 我不知道你的项目为什么将 DebuggingWorkingDirectory 存储在 suo 文件中。如果这是用户特定的设置，您应该考虑将其存储在 *.proj.user 文件名中。如果该设置可在所有参与项目的用户之间共享，则应考虑将其存储在项目文件本身中。
> 
> **更别想将 suo 文件添加到源代码管理中！**SUO（解决方案用户选项）文件旨在包含特定于用户的设置，不应在使用相同解决方案的用户之间共享。如果您要在 scc 数据库中添加 suo 文件，我不知道您会破坏 IDE 中的其他内容，但从源代码控制的角度来看，您将破坏 Web 项目 scc 集成，使用的 Lan vs Internet 插件由不同的用户进行 VSS 访问，您甚至可能导致 scc 完全中断（存储在 suo 文件中的 VSS 数据库路径可能对您有效，但可能对其他用户无效）。
> 
> 阿林康斯坦丁 (MSFT)

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2008-09-16T13:43:13.460

默认情况下，Microsoft 的 Visual SourceSafe 不将这些文件包含在源代码管理中，因为它们是用户特定的设置文件。如果您使用 SVN 作为源代码控制，我会遵循该模型。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2008-09-16T13:42:45.207

Visual Studio 将自动创建它们。我不建议将它们放在源代码管理中。有很多次本地开发人员的 SOU 文件导致 VS 在该开发人员框中出现异常行为。删除文件然后让 VS 重新创建它总是可以解决问题。

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2016-05-19T02:30:34.867

在[MSDN 网站上](https://msdn.microsoft.com/en-us/library/bb165909.aspx)，它明确指出

> 解决方案用户选项 (.suo) 文件包含每个用户的解决方案选项。**不应将此文件签入源代码控制**。

因此，我会说在将内容签入源代码管理时忽略这些文件是非常安全的。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2019-08-06T01:00:44.947

不。

> 我只是想要一个真正简短的答案，但没有。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2008-09-16T13:52:17.167

我不会。每个“用户”可能改变的任何东西在源代码控制中通常都不好。.suo、.user、obj/bin 目录

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2008-09-16T13:44:07.793

这些文件是用户特定的选项，应该独立于解决方案本身。Visual Studio 将根据需要创建新的，因此不需要将它们签入源代码管理。事实上，最好不要这样做，因为这允许个别开发人员根据他们认为合适的方式定制他们的环境。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2008-09-16T13:44:58.463

它们包含通常分配给单个开发人员的有关项目的特定设置（例如，当您调试应用程序时，启动项目和启动页面）。

所以最好不要将它们添加到版本控制中，让 VS 重新创建它们，以便每个开发人员都可以拥有他们想要的特定设置。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2008-09-16T13:54:56.910

您不能对 .user 文件进行源代码控制，因为这是特定于用户的。它包含远程机器的名称和其他与用户相关的东西。这是一个 vcproj 相关文件。

.suo 文件是一个与 sln 相关的文件，它包含“解决方案用户选项”（启动项目、窗口位置（停靠的位置、浮动的位置）等）

这是一个二进制文件，我不知道它是否包含“用户相关”的内容。

在我们公司，我们不会将这些文件置于源代码控制之下。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2008-09-16T13:43:31.180

.user 是用户设置，我认为 .suo 是解决方案用户选项。您不希望这些文件受源代码控制；它们将为每个用户重新创建。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-09-16T13:43:48.747

使用 Rational [ClearCase](https://en.wikipedia.org/wiki/Rational_ClearCase)，答案是否定的。只有 .sln & .*proj 应该在源代码控制中注册。

我无法回答其他供应商。如果我没记错的话，这些文件是“用户”特定的选项，你的环境。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2018-11-13T05:04:33.220

**不要将任何这些文件添加到版本控制中。**这些文件是使用工作站特定信息自动生成的，如果签入将在其他工作站中引起问题的版本控制。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2019-02-16T18:17:28.207

不，它们不应该致力于源代码控制，因为它们是开发人员/机器特定的本地设置。

[GitHub 在https://github.com/github/gitignore/blob/master/VisualStudio.gitignore](https://github.com/github/gitignore/blob/master/VisualStudio.gitignore)维护了一个建议的文件类型列表供 Visual Studio 用户忽略

对于 svn，我有以下`global-ignore`属性集：

> *.DotSettings.User
> *.onetoc2
> *.suo
> .vs
> PrecompiledWeb
> thumbs.db
> obj
> bin
> debug
> *.user
> *.vshost.*
> *.tss
> *.dbml.layout

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-04-29T09:38:43.327

正如其他答案中所解释的，两者`.suo`都不`.user`应该添加到源代码管理中，因为它们是特定于用户/机器的（顺便说一句`.suo`，最新版本的 VS 已移至专用临时目录`.vs`，应该完全远离源代码管理）。

**但是**，如果您的应用程序需要一些环境设置以在 VS 中进行调试（此类设置通常保存在`.user`文件中），则准备一个示例文件（将其命名为`.user.SAMPLE`）并将其添加到源代码管理以供参考可能会很方便。

代替在此类文件中硬编码的绝对路径，使用相对路径或依赖环境变量是有意义的，因此该示例可能足够通用，可以很容易地被其他人重用。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2021-02-04T10:43:30.597

其他人解释说不，你不希望在版本控制中这样做。您应该配置您的版本控制系统以忽略该文件（例如通过`.gitignore`文件）。

要真正理解原因，查看此文件中的实际内容会有所帮助。我编写了一个命令行工具，可以让您查看`.suo`文件的内容。

通过以下方式将其安装在您的机器上：

```
dotnet tool install -g suo 
```

它有两个子命令，`keys`和`view`。

```
suo keys <path-to-suo-file> 
```

这将转储文件中每个值的键。例如（略）：

```
nuget
ProjInfoEx
BookmarkState
DebuggerWatches
HiddenSlnFolders
ObjMgrContentsV8
UnloadedProjects
ClassViewContents
OutliningStateDir
ProjExplorerState
TaskListShortcuts
XmlPackageOptions
BackgroundLoadData
DebuggerExceptions
DebuggerFindSource
DebuggerFindSymbol
ILSpy-234190A6EE66
MRU Solution Files
UnloadedProjectsEx
ApplicationInsights
DebuggerBreakpoints
OutliningStateV1674
... 
```

如您所见，许多 IDE 功能使用此文件来存储它们的状态。

使用`view`命令查看给定键的值。例如：

```
$ suo view nuget --format=utf8 .suo
nuget

?{"WindowSettings":{"project:MyProject":{"SourceRepository":"nuget.org","ShowPreviewWindow":false,"ShowDeprecatedFrameworkWindow":true,"RemoveDependencies":false,"ForceRemove":false,"IncludePrerelease":false,"SelectedFilter":"UpdatesAvailable","DependencyBehavior":"Lowest","FileConflictAction":"PromptUser","OptionsExpanded":false,"SortPropertyName":"ProjectName","SortDirection":"Ascending"}}} 
```

有关该工具的更多信息：[https ://github.com/drewnoakes/suo](https://github.com/drewnoakes/suo)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-07-26T07:29:54.093

如果您在**ProjectProperties>Debugging>Environment**中设置可执行目录依赖项，则路径将存储在“.user”文件中。

假设我在上述字段中设置了这个字符串：**“PATH=C:\xyz\bin”** 这就是它将如何存储在“.user”文件中：

`<LocalDebuggerEnvironment>PATH=C:\xyz\bin$(LocalDebuggerEnvironment)</LocalDebuggerEnvironment>`

这对我们在 OpenCV 工作时帮助很大。我们可以为不同的项目使用不同版本的 OpenCV。另一个优点是，在新机器上设置我们的项目非常容易。我们只需要复制相应的依赖目录。所以对于某些项目，我更喜欢将“.user”添加到源代码管理中。

尽管如此，它完全依赖于项目。您可以根据自己的需要接听电话。

# java - How do I set the HttpOnly flag on JSF/Richfaces

> ID：72304
> 
> 赞同：2
> 
> 时间：2008-09-16T13:41:03.557
> 
> 标签：java, security, jsf, richfaces

I'd like to add the `HttpOnly` flag to `JSF/richfaces` cookies, especially the session cookie, to up the level of security on my web app. Any ideas?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:20:50.513

```
FacesContext facesContext = FacesContext.getCurrentInstance().getFacesContext();

HttpServletResponse response = (HttpServletResponse) facesContext.getExternalContext().getResponse();

response.addHeader("Set-Cookie", "yourcookiename=yourcookievalue; HTTPOnly"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:13:12.263

可能有一些东西允许您在 servlet 引擎中执行此操作。这是尚未发布的 Servlet 3.0 规范的一部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:46:09.537

Something like:

```
response.setHeader("Set-Cookie", "yourcookiename=yourcookievalue; HTTPOnly"); 
```

might work in a Java environment. I am not aware of a JSF-specific way to achieve this... sorry

This seems to be not an easy task in Java.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:54:13.897

I suspect that I'll need to use a filter to add a response wrapper, which'll add the flag to all cookies as they're added by the framework.

# perl - 我应该如何大写 Perl？

> ID：72312
> 
> 赞同：12
> 
> 时间：2008-09-16T13:41:32.980
> 
> 标签：perl, coding-style, capitalization

珀尔？珀尔？珀尔？什么风格好？

我知道答案——我只是想确保问题存在并且提问者知道有一个正确的形式。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-16T13:43:52.193

正确的大小写是语言的“Perl”和可执行文件的“perl”。使用“PERL”将您标记为不是特别熟悉该语言或社区的人。

另请参阅[“perl”和“Perl”有什么区别？](http://perldoc.perl.org/perlfaq1.html#What%27s-the-difference-between-%22perl%22-and-%22Perl%22?)在[perlfaq1](http://perldoc.perl.org/perlfaq1.html)中。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-16T13:43:25.113

引用[Wikipedia 上的 Perl 文章](http://en.wikipedia.org/wiki/Perl#Name)。

> 由于类 Unix 文件系统区分大小写，因此在指代语言时，名称通常大写 (Perl)，而在指代解释器程序本身时，名称通常不大写 (perl)。在 Programming Perl 第一版发布之前，通常将该语言称为 perl。然而，Randal L. Schwartz 在书中将语言的名称大写以使其在排版时更加突出。案例区分随后被社区采用。

还要检查[关于这个问题的 perlfaq](http://perldoc.perl.org/perlfaq1.html#What's-the-difference-between-%22perl%22-and-%22Perl%22%3f)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-16T17:00:32.283

这是[perlfaq1](http://perldoc.perl.org/perlfaq1.html)的答案：

> “perl”和“Perl”有什么区别？
> 
> 一点。哦，你说的不是ASCII？:-) Larry 现在使用“Perl”来表示正确的语言，“perl”表示它的实现，即当前的解释器。因此，Tom 打趣说“只有 perl 才能解析 Perl”。您可能会或可能不会选择遵循此用法。例如，并行性意味着“awk and perl”和“Python and Perl”看起来不错，而“awk and Perl”和“Python and perl”则不行。但永远不要写“PERL”，因为 perl 不是首字母缩略词，尽管是杜撰的民间传说和事后扩展。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T13:47:40.810

尽管有很多相反的轶事，“PERL”从来都不是真正的首字母缩略词——它是一个“backronym”。首先选择了 Perl 这个名字，然后一些人开玩笑地对其进行了扩展，这很流行。

PerlMonks[社区](http://perlmonks.org)（强烈推荐！）教会了我这个约定，它类似于 Java 的：

*   永远*不是*PERL（或 JAVA）
*   当您谈论语言时，它是 Perl（或 Java）
*   当您谈论解释器本身时，它是 perl（或 java）。

也就是说，如果你“做错了”，它不会成为一整山的豆子。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-16T13:43:05.847

“当指代语言时，名称通常大写 (Perl)，当指代解释器程序本身时，名称通常大写 (perl)，因为类 Unix 文件系统区分大小写。” 发帖时来自[维基百科](http://en.wikipedia.org/wiki/Perl)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-16T14:16:12.710

虽然，正如已经说过的，如果你弄错了它并没有太大的区别，但有些人确实使用正确的大写字母（或者至少，不是指 'PERL' 或任何更明智的后缀）作为一个陈词滥调招聘广告中的线索。:)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T13:42:28.563

[Perl](http://www.perl.org/about/style-guide.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T13:43:11.523

perl 或 Perl 都可以。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-10T01:23:42.740

<pkrumins> perlbot: PERL

<perlbot> 它是 Perl（用于语言）或`perl`（用于解释器），但绝不是“PERL”！

# performance - 我必须怎么做才能使内容（例如通过 HTTPS 提供的图像）在客户端缓存？

> ID：72358
> 
> 赞同：6
> 
> 时间：2008-09-16T13:44:50.973
> 
> 标签：performance, tomcat, ssl, https

我使用 Tomcat 作为服务器，使用 Internet Explorer 6 作为浏览器。我们应用程序中的一个网页大约有 75 张图片。我们正在使用 SSL。加载所有内容似乎很慢。如何配置 Tomcat 以便 IE 缓存图像？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T13:28:58.353

如果您通过 https 提供页面，那么您需要通过 https（来自同一域或另一个域，也通过 https）提供所有包含的静态或动态资源，以避免浏览器中出现安全警告。

大多数浏览器默认不会将通过安全通道传递的内容写入磁盘，因此存在于浏览器内存缓存中，该缓存比磁盘缓存小得多。当应用程序退出时，此缓存也会消失。

说了这么多，您可以做一些事情来提高单个浏览器设置中 SSL 资产的可缓存性。对于初学者，请确保您的所有资产都具有合理的 Expires 和 Cache-Control 标头。如果 tomcat 位于 apache 后面，则使用 mod_expires 添加它们。这将避免浏览器必须检查图像是否在页面之间发生了变化

```
<Location /images>
   FileEtag none
   ExpiresActive on
   ExpiresDefault "access plus 1 month"
</Location> 
```

其次，这是特定于 MSIE 和 Apache 的，大多数 apache ssl 配置都包含这些行

```
SetEnvIf User-Agent ".*MSIE.*" \
     nokeepalive ssl-unclean-shutdown \
     downgrade-1.0 force-response-1.0 
```

这会禁用所有 MSIE 代理的 keepalive。恕我直言，这太保守了，最后一个使用 SSL 出现问题的 MSIE 浏览器是 5.x 和 6.0 pre SP2 的未修补版本，现在这两个版本都非常少见。以下更宽松，在使用 MSIE 和 SSL 时不会禁用 keepalives

```
BrowserMatch "MSIE [1-4]" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0
BrowserMatch "MSIE [5-9]" ssl-unclean-shutdown 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T14:53:38.133

一些浏览器会缓存 SSL 内容。默认情况下，Firefox 2.0+ 不会在光盘上缓存 SSL 资源（为了增加隐私）。除非出现 Cache-control:public 标头，否则 Firefox 3+ 不会将它们缓存在磁盘上。

因此正确设置 Expires: 标头和 Cache-control:public。例如

```
<Files ~ "\.(gif|jpe?g|png|ico|css|js|cab|jar|swf)$">
        # Expire these things
        # Three days after access time
        ExpiresDefault  "now plus 3 days"
        # This makes Firefox 3 cache images over SSL
        Header set Cache-Control public
</Files> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-08T18:19:02.263

如果这 75 个图像中有很多是出现在每个页面上的图标或图像，您可以使用 CSS sprite 来大幅减少 HTTP 请求的数量，从而更快地加载页面：

[http://www.alistapart.com/articles/sprites/](http://www.alistapart.com/articles/sprites/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T13:59:19.380

75张图片听起来很多。如果是很多小图像，有很多方法可以将许多图像捆绑为一个，你可能会看看你是否能找到一个这样做的库。您也可以强制将图像缓存在[google gears](http://gears.google.com)之类的东西中。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-16T13:50:10.073

通过 HTTPS 连接提供的内容**永远不会缓存**在浏览器中。您对此无能为力。

通常，您网站中的图像不是很敏感，因此通过 HTTP 提供服务。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-16T16:26:31.553

第一个答案是正确的，使用 HTTPS 时没有缓存任何内容。但是，当您构建您的网页时，您可能会考虑通过它们各自的 URL 来引用图像。通过这种方式，您可以将图像指定为源自 HTTP 源，并且它们（可能）会被浏览器缓存。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-17T16:52:29.003

也许您可以添加一个额外的服务器/子域来提供没有 https 的图像？

# c# - 如何在 System.Type 变量中使用“is”运算符？

> ID：72360
> 
> 赞同：5
> 
> 时间：2008-09-16T13:44:54.233
> 
> 标签：c#

这是我正在做的事情：

```
object ReturnMatch(System.Type type)  
{  
    foreach(object obj in myObjects)  
    {
        if (obj == type)  
        {  
            return obj;  
        }  
    }  
} 
```

但是，如果 obj 是 的子类`type`，它将不匹配。但我希望函数以与使用 operator 相同的方式返回`is`。

我尝试了以下，但它不会编译：

```
if (obj is type) // won't compile in C# 2.0 
```

我想出的最佳解决方案是：

```
if (obj.GetType().Equals(type) || obj.GetType().IsSubclassOf(type)) 
```

难道没有办法使用运算符`is`来使代码更干净吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T13:59:35.743

遇到此问题时，我使用了 IsAssignableFrom 方法。

```
Type theTypeWeWant; // From argument or whatever
foreach (object o in myCollection)
{
    if (theTypeWeWant.IsAssignableFrom(o.GetType))
         return o;
} 
```

另一种可能会或可能不会解决您的问题的方法是使用通用方法：

```
private T FindObjectOfType<T>() where T: class
{
    foreach(object o in myCollection)
    {
        if (o is T)
             return (T) o;
    }
    return null;
} 
```

（代码从内存中编写，未经测试）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T13:47:14.103

也许

```
type.IsAssignableFrom(obj.GetType()) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T13:56:26.500

不使用 is 运算符，但 Type.IsInstanceOfType 方法似乎是您正在寻找的。

[http://msdn.microsoft.com/en-us/library/system.type.isinstanceoftype.aspx](http://msdn.microsoft.com/en-us/library/system.type.isinstanceoftype.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:48:49.560

is 运算符指示将一个对象转换为另一个对象（通常是超类）是否“安全”。

```
if(obj is type) 
```

如果 obj 是“type”类型或其子类，则 if 语句将成功，因为将 obj 强制转换为 (type)obj 是“安全的”。

见： http: [//msdn.microsoft.com/en-us/library/scekt9xw (VS.71).aspx](http://msdn.microsoft.com/en-us/library/scekt9xw(VS.71).aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T13:54:58.673

您不能使用“is”关键字本身是否有原因？

```
foreach(object obj in myObjects)
{
  if (obj is type)
  {
    return obj;
  }
} 
```

编辑 - 我明白我错过了什么。Isak 的建议是正确的。我已经测试并确认了它。

```
 class Level1
  {
  }

  class Level2A : Level1
  {
  }

  class Level2B : Level1
  {
  }

  class Level3A2A : Level2A
  {
  }

  class Program
  {
    static void Main(string[] args)
    {
      object[] objects = new object[] {"testing", new Level1(), new Level2A(), new Level2B(), new Level3A2A(), new object() };

      ReturnMatch(typeof(Level1), objects);
      Console.ReadLine();
    }

    static void ReturnMatch(Type arbitraryType, object[] objects)
    {
      foreach (object obj in objects)
      {
        Type objType = obj.GetType();

        Console.Write(arbitraryType.ToString() + " is ");

        if (!arbitraryType.IsAssignableFrom(objType))
          Console.Write("not ");

        Console.WriteLine("assignable from " + objType.ToString());

      }
    }
  } 
```

# visual-studio-2008 - 在 Visual Studio 2008 中，是否可以将垂直选项卡组与水平选项卡组混合使用？

> ID：72372
> 
> 赞同：0
> 
> 时间：2008-09-16T13:46:13.890
> 
> 标签：visual-studio-2008, multiple-monitors

我有一个 1920x1200 的屏幕，想自定义 VS2008 代码窗口以使某些区域垂直和水平拆分（选项卡组）。

我似乎只能在 VS2008 中全部垂直或全部水平。有什么巧妙的方法可以混合两者吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-16T13:59:02.733

我不相信这在 Visual Studio 中是可能的。但是，您应该查看这个用于拆分应用程序的好产品：http: [//www.winsplit-revolution.com/](http://www.winsplit-revolution.com/)

# speech-recognition - 搜索文件的语音识别

> ID：72380
> 
> 赞同：0
> 
> 时间：2008-09-16T13:46:51.733
> 
> 标签：speech-recognition

这是我遇到的问题：

我有很多（数万个）我的用户希望能够搜索的 mp3 文件。是否有您使用过或听说过的好软件可以让我索引该内容并将其放入数据库中以便我以后可以搜索？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T19:37:10.210

有一个开源库[Sphinx](http://cmusphinx.sourceforge.net/html/cmusphinx.php)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:09:52.223

我听过Nuance对[Dragon Naturally Speech](http://www.nuance.co.uk/naturallyspeaking/ "龙自然说话")的好评。他们提供了一个[软件开发工具包](http://www.nuance.com/naturallyspeaking/products/sdk.asp)，但我找不到任何关于小型项目定价的信息。

# java - 给定一个日期对象，我如何确定其月份的最后一天？

> ID：72381
> 
> 赞同：6
> 
> 时间：2008-09-16T13:46:58.630
> 
> 标签：java, date

我正在尝试使用以下代码，但它返回了错误的月份。

```
Calendar cal = Calendar.getInstance();
cal.setTime(sampleDay.getTime());
cal.set(Calendar.MONTH, sampleDay.get(Calendar.MONTH)+1);
cal.set(Calendar.DAY_OF_MONTH, 0);
return cal.getTime(); 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-16T13:51:21.317

获取本月的天数：

```
 Calendar cal = Calendar.getInstance();
cal.setTime(sampleDay.getTime());
int noOfLastDay = cal.getActualMaximum(Calendar.DAY_OF_MONTH); 
```

将日历设置为本月的最后一天：

```
 Calendar cal = Calendar.getInstance();
cal.setTime(sampleDay.getTime());
cal.set(Calendar.DAY_OF_MONTH, cal.getActualMaximum(Calendar.DAY_OF_MONTH)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T13:49:48.730

我会为下个月的第一天创建一个日期对象，然后从日期对象中减去一天。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-06-25T20:56:54.587

# tl;博士

```
YearMonth.from(
    LocalDate.now( ZoneId.of( "America/Montreal" ) )
).atEndOfMonth() 
```

# java.time

问题和其他答案使用旧的过时类。它们已被Java 8 及更高版本中内置的[java.time类所取代。](http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html)请参阅[Oracle 教程](http://docs.oracle.com/javase/tutorial/datetime/TOC.html)。大部分功能已在 ThreeTen-Backport 中向后移植到 Java 6 和 7，并在[ThreeTenABP](https://github.com/JakeWharton/ThreeTenABP)[中](http://www.threeten.org/threetenbp/)进一步适应 Android 。

## `LocalDate`

该类[`LocalDate`](http://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html)表示没有时间和时区的仅日期值。虽然这些对象不存储时区，但请注意时区对于确定当前日期至关重要。对于任何给定的时刻，日期都会因时区而在全球范围内变化。

```
ZoneId zoneId = ZoneId.of( "America/Montreal" );
LocalDate today = LocalDate.now( zoneId );  // 2016-06-25 
```

## `YearMonth`

结合[`YearMonth`](http://docs.oracle.com/javase/8/docs/api/java/time/YearMonth.html)班级确定任何一个月的最后一天。

```
YearMonth currentYearMonth = YearMonth.from( today );  // 2016-06
LocalDate lastDayOfCurrentYearMonth = currentYearMonth.atEndOfMonth();  // 2016-06-30 
```

顺便说一句，两者都`LocalDate`使用`YearMonth`月份数字（1-12），而不是在旧的日期时间类中看到的怪异的 0-11。许多糟糕的设计决策之一，使那些旧的日期时间类变得如此麻烦和混乱。

# `TemporalAdjuster`

另一种有效的方法是使用[`TemporalAdjuster`](https://docs.oracle.com/javase/9/docs/api/java/time/temporal/TemporalAdjuster.html). 请参阅[Pierre Henry 的正确答案](https://stackoverflow.com/a/46914556/642706)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T13:52:34.403

看起来您将日历设置为下个月的第一天，因此您需要多行减去一天，以获得*sampleDay*所在月份的最后一天：

```
Calendar cal = Calendar.getInstance();
cal.setTime(sampleDay.getTime());
cal.roll(Calendar.MONTH, true);
cal.set(Calendar.DAY_OF_MONTH, 0);
cal.add(Calendar.DAY_OF_MONTH, -1); 
```

[一般来说，使用Joda Time](http://joda-time.sourceforge.net/)做这种事情要容易得多，例如：

```
DateTime date = new DateTime(sampleDay.getTime());
return date.plusMonths(1).withDayOfMonth(0).minusDays(1).getMillis(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T13:56:27.390

使用 calObject.getActualMaximum(calobject.DAY_OF_MONTH)

有关这方面的更多信息，请参阅[Real 的 Java How-to](http://www.rgagnon.com/javadetails/java-0098.html)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-10-24T15:33:26.823

# `TemporalAdjuster`

使用（相对）**新的 Java 日期 API**，实际上非常简单：

让`date`是 的一个实例`LocalDate`，例如：

```
LocalDate date = LocalDate.of(2018, 1, 22); 
```

或者

```
LocalDate date = LocalDate.now(); 
```

或者，当然，您可以将其作为用户输入、从数据库等获取。

然后应用类[`TemporalAdjuster`](https://docs.oracle.com/javase/9/docs/api/java/time/temporal/TemporalAdjuster.html)中找到的接口的实现[`TemporalAdjusters`](https://docs.oracle.com/javase/9/docs/api/java/time/temporal/TemporalAdjusters.html)：

```
LocalDate first = date.with(TemporalAdjusters.firstDayOfMonth());
LocalDate last = date.with(TemporalAdjusters.lastDayOfMonth()); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-13T02:08:18.153

如果您使用[date4j](http://www.date4j.net)库：

```
DateTime monthEnd = dt.getEndOfMonth(); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-11-16T01:35:10.477

我认为这应该很好用：

```
Dim MyDate As Date = #11/14/2012#  'This is just an example date

MyDate = MyDate.AddDays(DateTime.DaysInMonth(MyDate.Year, MyDate.Month) - MyDate.Day) 
```

# python - Python 和“重新”

> ID：72393
> 
> 赞同：7
> 
> 时间：2008-09-16T13:47:48.550
> 
> 标签：python, regex

我在 python 中的 Regex 上的教程解释了如何在 python 中使用 re 模块，我想从 A 标记中获取 URL，所以知道 Regex 我编写了正确的表达式并在我选择的正则表达式测试应用程序中对其进行了测试并确保它工作。当放入python时它失败了。

经过多次挠头后，我发现了问题，它会自动期望您的模式位于字符串的开头。我找到了解决方法，但我想知道如何更改：

```
regex = ".*(a_regex_of_pure_awesomeness)" 
```

进入

```
regex = "a_regex_of_pure_awesomeness" 
```

好的，这是一个标准的 URL 正则表达式，但我想避免对我想要摆脱的东西产生任何潜在的混淆，并可能假装很有趣。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-16T13:53:03.187

在 Python 中，“匹配”和“搜索”是有区别的；match 只查找字符串开头的模式，而 search 查找从字符串中任何位置开始的模式。

[Python 正则表达式文档](http://docs.python.org/lib/module-re.html)
[匹配与搜索](http://docs.python.org/lib/matching-searching.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T22:44:42.987

```
from BeautifulSoup import BeautifulSoup 

soup = BeautifulSoup(your_html)
for a in soup.findAll('a', href=True):
    # do something with `a` w/ href attribute
    print a['href'] 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T13:54:56.363

```
>>> import re
>>> pattern = re.compile("url")
>>> string = "   url"
>>> pattern.match(string)
>>> pattern.search(string)
<_sre.SRE_Match object at 0xb7f7a6e8> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:52:02.220

你使用`re.match()`or`re.search()`方法吗？我的理解是，`re.match()`假设`^`表达式的开头有一个“”，并且只会在文本的开头进行搜索，而`re.search()`行为更像是 Perl 正则表达式，并且如果您包含一个“ `^`”，则只会匹配文本的开头你表达的开始。希望有帮助。

# asp.net - 以多种语言存储内容？例如英语、法语、德语

> ID：72410
> 
> 赞同：3
> 
> 时间：2008-09-16T13:49:42.210
> 
> 标签：asp.net, internationalization

我应该如何在一个供全球使用的网站上使用多种语言存储（和呈现）文本？内容主要是 500 多字文章的形式，尽管我也需要翻译每一页上的小段文字（例如“打印这篇文章”或“返回菜单”）。

我知道有几个 CMS 包可以处理多种语言，但我也必须与我们现有的 ASP 系统集成，所以我忽略了这些解决方案。

我担心的一个问题是谷歌应该能够找到这些页面，即使对于外国用户也是如此。我不太关心处理日期和货币的问题。

我担心，如果任凭我自己的设备，我会发明一种可行的方法，但最终会导致灾难！我想知道您在实际项目中实际使用了哪些专业解决方案，而不是未尝试过的想法！非常感谢。

* * *

我查看了 RESX 文件，但觉得它们不适用于除了最琐碎的翻译解决方案之外的所有解决方案（如果有人想知道，我会详细说明）。

Google 将帮助我翻译文本，但不会存储/呈现它。

有没有人参与过依赖自己的代码进行演示的多语言项目？

* * *

关于通过以下方式提供内容的任何想法，哪种方式最好？

*   [http://www.website.com/text/view.asp?id=12345&lang=fr](http://www.website.com/text/view.asp?id=12345&lang=fr)
*   [http://www.website.com/text/12345/bonjour_mes_amis.htm](http://www.website.com/text/12345/bonjour_mes_amis.htm)
*   [http://fr.website.com/text/12345](http://fr.website.com/text/12345)

（这些不是真实的 URL，我只是展示示例）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T11:12:42.440

首先将所有语言的所有代码放在一个域下 - 这将有助于您的谷歌排名。

我们有一个完全多语言的系统，本地化存储在数据库中，但与 Web 应用程序一起缓存。

无论我们希望在哪里出现本地化，我们都使用：

```
<%$ Resources: LanguageProvider, Path/To/Localisation %> 
```

然后在我们的 web.config 中：

```
<globalization resourceProviderFactoryType="FactoryClassName, AssemblyName"/> 
```

`FactoryClassName`然后实现`ResourceProviderFactory`以提供实际的动态功能。本地化存储在数据库中，带有字符串键“Path/To/Localisation”

缓存本地化的值很重要——您不希望在每个页面上都有大量的数据库查找，我们缓存了数千个本地化字符串而没有性能问题。

使用用户当前的浏览器本地化选择要提供的语言。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T13:53:07.413

您可能想检查[GNU Gettext](http://www.gnu.org/software/gettext/)项目 - 至少可以开始。

*编辑添加有关项目的信息：*

我曾在多个不同技术中使用 Gettext 技术（包括 C++/MFC 和 J2EE/JSP）参与过多个多语言项目，并且一切正常。但是，您当然需要编写/查找自己的代码来显示本地化数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:52:14.887

如果您使用的是 .Net，我建议您使用一个或多个资源文件 (.resx)。MSDN 上有很多关于此的文档。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T15:12:50.733

与大多数一般编程问题一样，这取决于您的需求。

对于静态文本，我会使用 RESX 文件。对我来说，作为 .Net 程序员，它们很容易使用，并且 .Net 框架对它们有很好的支持。

对于任何动态文本，我倾向于将此类信息存储在数据库中，特别是如果站点维护者将成为非开发人员。在过去，我使用了两种方法，添加语言列并为不同的语言创建不同的条目，或者创建一个单独的表来存储特定于语言的文本。

第一种方法的表格可能如下所示：

文章编号 | 语言 ID | 特定语言文章文本 | 创建者 | 创建日期

这适用于您可以为给定文章创建不同条目并且不需要保持与这些不同条目关联的任何数据同步的情况（例如更新的时间戳）。

另一种方法是有两个单独的表，一个用于非语言特定文本（id、创建日期、创建用户、更新日期等），另一个表包含语言特定文本。所以表格可能看起来像这样：

第一个表：文章 ID | 创建者 | 创建日期 | 更新者 | 更新日期

第二个表：文章 ID | 语言 ID | 特定语言的文章文本

对我来说，问题归结为更新非语言相关数据。如果您要更新该数据，那么我会倾向于第二种方法，否则我会采用第一种方法，因为我认为它更简单（不能忘记 KISS 原则）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T13:56:24.190

如果您只是担心文章内容被翻译，并且不需要完全集成的选项，我过去使用过[谷歌翻译](http://www.google.com/language_tools)，它在较小的规模上效果很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-31T23:37:07.873

奇妙的问题。

我使用自制的 Python 3 脚本为我创建的网站（我的个人资料中的链接）解决了这个问题，该脚本即时翻译通用模板并插入来自请求的语言（或由 Apache 从 Accept-Language 猜测）的特定内容页面。

这很有趣，因为我学习了 Python 并编写了自己的迷你库来创建内容页面。一个缺点是我们的主机没有 Python 3，但我让我的脚本生成静态 HTML（原来的脚本是检查 User-agent），然后将其上传到服务器。到目前为止，这很有效，制作网站的新语言版本现在轻而易举:)

这种方法最大的缺点是从头开始写东西很耗时。因此，如果您愿意，请给我留言，我会帮助您使用我的脚本 :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-31T23:45:52.707

至于 URL 格式，我使用它，`site.com/content/example.fr`因为这允许 Apache 执行语言协商，以防有人要求`/content/example`并让浏览器告诉它喜欢法语。当您这样做时，Apache 还会添加`.html`或其他任何奖励。

因此，当有请求`example`并且我有文件时

```
example.fr
example.en
example.vi 
```

`example.vi`对于使用越南语配置浏览器或`example.en`使用德语配置浏览器的人， Apache 将自动继续。挺有用的。

# python - Python的单元测试逻辑

> ID：72422
> 
> 赞同：4
> 
> 时间：2008-09-16T13:50:25.343
> 
> 标签：python, unit-testing

有人可以向我解释这个结果。第一次测试成功，但第二次失败，尽管测试的变量在第一次测试中发生了变化。

```
>>> class MyTest(unittest.TestCase):
    def setUp(self):
        self.i = 1
    def testA(self):
        self.i = 3
        self.assertEqual(self.i, 3)
    def testB(self):
        self.assertEqual(self.i, 3)

>>> unittest.main()
.F
======================================================================
FAIL: testB (__main__.MyTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "<pyshell#61>", line 8, in testB
AssertionError: 1 != 3

----------------------------------------------------------------------
Ran 2 tests in 0.016s 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-16T13:55:02.777

来自[http://docs.python.org/lib/minimal-example.html](http://docs.python.org/lib/minimal-example.html)：

> 定义 setUp() 方法后，测试运行程序将在每次测试之前运行该方法。

所以 setUp() 在 testA 和 testB 之前运行，每次都将 i 设置为 1。在幕后，整个测试对象实际上正在为每个测试重新实例化，在执行测试之前在每个新实例上运行 setUp()。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-16T15:47:30.993

每个测试都使用 MyTest 类的新实例运行。这意味着如果您在一个测试中更改 self ，更改将不会延续到其他测试，因为 self 将引用不同的实例。

此外，正如其他人所指出的，在每次测试之前都会调用 setUp 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:54:38.953

如果我在那个测试框架中没记错的话，setUp 方法会在每次测试之前运行

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-18T21:13:18.670

从方法论的角度来看，单个测试应该是独立的，否则会产生更多难以发现的错误。例如，想象一下 testA 和 testB 将以不同的顺序被调用。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-16T14:12:08.913

正如其他人所说，setUp 方法在您编写的每个测试方法之前运行。因此，当 testB 运行时，i 的值为 1，而不是 3。

您还可以使用在每个测试方法之后运行的 tearDown 方法。但是，如果您的一项测试崩溃，您的 tearDown 方法将永远不会运行。

# vb.net - Nullable(Of T) 的 null 值是多少？

> ID：72442
> 
> 赞同：1
> 
> 时间：2008-09-16T13:51:38.633
> 
> 标签：vb.net, nullable

我有一个可为空的属性，我想返回一个空值。我如何在 VB.NET 中做到这一点？

目前我使用这个解决方案，但我认为可能有更好的方法。

```
 Public Shared ReadOnly Property rubrique_id() As Nullable(Of Integer)
        Get
            If Current.Request.QueryString("rid") <> "" Then
                Return CInt(Current.Request.QueryString("rid"))
            Else
                Return (New Nullable(Of Integer)).Value
            End If
        End Get
    End Property 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T13:52:55.870

您在寻找关键字“无”吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T13:58:50.300

是的，它在 VB.NET 中是 Nothing，在 C# 中是 null。

Nullable 泛型数据类型使编译器可以将“无”（或空）值分配给值类型。如果不显式编写它，您将无法执行此操作。

[C# 中的可空类型](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T23:16:24.080

```
Public Shared ReadOnly Property rubrique_id() As Nullable(Of Integer)
    Get
        If Current.Request.QueryString("rid") <> "" Then
            Return CInt(Current.Request.QueryString("rid"))
        Else
            Return Nothing
        End If
    End Get
End Property 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T17:28:07.317

或者这就是我使用的方式，老实说 ReSharper 教会了我 :)

```
finder.Advisor = ucEstateFinder.Advisor == "-1" ? (long?)null : long.Parse(ucEstateFinder.Advisor); 
```

在上面的分配中，如果我直接将 null 分配给 finder.Advisor*(long?)* 就不会有问题。但是，如果我尝试使用 if 子句，我需要像那样转换它`(long?)null`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-01T05:43:12.480

虽然`Nothing`可以使用，但您的“现有”代码几乎是正确的；只是不要试图获得`.Value`：

```
Public Shared ReadOnly Property rubrique_id() As Nullable(Of Integer)
    Get
        If Current.Request.QueryString("rid") <> "" Then
            Return CInt(Current.Request.QueryString("rid"))
        Else
            Return New Nullable(Of Integer)
        End If
    End Get
End Property 
```

如果您碰巧想将其简化为`If`表达式，这将成为最简单的解决方案：

```
Public Shared ReadOnly Property rubrique_id() As Nullable(Of Integer)
    Get
        Return If(Current.Request.QueryString("rid") <> "", _
            CInt(Current.Request.QueryString("rid")), _
            New Nullable(Of Integer))
    End Get
End Property 
```

# macos - 创建 3 人游击开发团队时我错过了哪些方面？

> ID：72456
> 
> 赞同：6
> 
> 时间：2008-09-16T13:52:21.517
> 
> 标签：macos

对不起，Windows 开发人员，此解决方案仅适用于 Mac。

这组应用程序占：可用性测试、屏幕捕获（视频和静止图像）、版本控制、任务列表、错误跟踪、开发人员 IDE、Web 服务器、博客、Web 上的共享文档编辑、团队和个人聊天、电子邮件、数据库和持续集成。这确实假设您的团队成员提供他们自己的机器，并且一个人有一台备用的旧计算机作为源存储库和 Web 服务器。全部不到200美元。

**可用性**

[银背](http://silverbackapp.com/)

许可证 = 3 x 49.95 美元

“面向设计师和开发人员的自发的、不显眼的可用性测试软件。”

**源代码管理服务器和客户端（多个选项）**

[颠覆](http://subversion.tigris.org/)= 免费

Subversion 是一个开源版本控制系统。

[版本](http://versionsapp.com/)（目前处于测试阶段）= 免费

版本为您的 Mac 上的 Subversion 提供了愉快的工作。

[Diffly](http://lucidmac.com/products/diffly) = 免费

“Diffly 是一个探索 Subversion 工作副本的工具。它显示所有有更改的文件，单击文件，显示该文件更改的突出显示视图。当您准备好提交时，Diffly 可以轻松选择您的文件想要签入并收集有用的提交信息。”

**错误/功能/缺陷跟踪（多个选项）**

[Bugzilla](http://www.bugzilla.org/) = 免费

Bugzilla 是一个“缺陷跟踪系统”或“错误跟踪系统”。缺陷跟踪系统允许单个或一组开发人员有效地跟踪其产品中的突出错误。大多数商业缺陷跟踪软件供应商收取巨额许可费用。

[Trac](http://trac.edgewall.org/) = 免费

Trac 是用于软件开发项目的增强型 wiki 和问题跟踪系统。

**数据库服务器和客户端**

[MySQL](http://dev.mysql.com/downloads/mysql/?rz=gdl#downloads) = 免费

[CocoaMySQL](http://cocoamysql.sourceforge.net/) = 免费

**网络服务器**

[阿帕奇](http://apache.org/)=免费

**开发和构建工具**

[XCode](http://www.apple.com/macosx/features/300.html#xcode3) = 免费

[CruiseControl](http://cruisecontrol.sourceforge.net/) = 免费

CruiseControl 是一个用于持续构建过程的框架。它包括但不限于电子邮件通知插件、Ant 和各种源代码控制工具。提供了一个 Web 界面来查看当前和以前的构建的详细信息。

**协作工具**

[写字板](http://www.writeboard.com/)=免费

[Ta-da 清单](http://www.tadalist.com/)= 免费

[4 位用户的篝火聊天](https://signup.37signals.com/campfire/free/signup/new)= 免费

[WordPress](http://wordpress.org/download/) = 免费

“WordPress 是一个最先进的发布平台，专注于美学、网络标准和可用性。WordPress 既免费又无价。”

[Gmail](http://www.gmail.com/) = 免费

“Gmail 是一种新型的网络邮件，它建立在电子邮件可以更直观、更高效、更有用的理念之上。”

**屏幕截图（视频/静止）**

[京](http://www.jingproject.com/)=免费

“Jing 的概念是随时可用的程序，它可以立即捕获和共享图像和视频……从您的计算机到任何地方。”

* * *

**很多很棒的回复：**

TeamCity [哟|||]

Skype [埃里克·德拉巴]

FogBugz [脉轮]

IChatAV 和屏幕共享（操作系统内置）[amrox]

谷歌文档 [amrox]

* * *

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T22:43:37.653

你已经涵盖了大部分内容。

我总是为另外两件你可能认为奇怪的事情增加空间、时间和金钱。

1.  像普通用户一样设置的机器。没有安装开发或调试工具。让它看起来像是有人刚刚从 Apple Store 购买的。我进行图像切换，但我认识一些通过切换到外部引导驱动器来发誓的人。

2.  还包括为处女提供的“免费”午餐。这是一个进来测试你的程序的人，他不是开发人员，也不知道你的软件。您可能必须多次这样做，但不要再使用同一个人。

作为补充说明，请确保您使用的“免费”应用程序和网站是真正免费的，而不仅仅是免费供个人使用！

祝你的项目好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:01:35.693

**协作工具**

[Skype](http://www.skype.com/) = 免费 - 如果您不能面对面工作，假设每个人都已经拥有宽带，Skype 之类的工具可以让您免费接近。mac 客户端工作得很好，因为大多数现代 mac 已经有摄像头，所以你应该大部分时间都设置好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-09T04:38:41.340

将 hudson 视为 CI 服务器

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T13:59:00.520

更改 JetBrains 的 TeamCity 的 CruiseControl。它对多达 20 个用户免费，并且比 CruiseControl 更强大、更实用。

它易于设置，并具有一些惊人的功能。例如自动发送构建以在您可能坐在办公室的任何备用计算机上执行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T13:59:26.557

您如何进行时间跟踪/调度/发布计划？

那些可以帮助您按时发货的产品？阿拉FogBugz

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T16:31:59.497

Trac 和 Subversion 有一个非常好的集成，可以让您将 Trac 票证链接到 SVN 变更集，反之亦然（SVN 变更集实际上可以将 Trac 票证移动到新状态）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T16:40:51.770

我发现一些有用的内置 Leopard 工具是 iChat AV 和屏幕共享。

此外，Google Docs，尤其是电子表格和表格也很好（而且免费）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-19T12:32:00.350

*   **版本控制**：[svnX](http://www.apple.com/downloads/macosx/development_tools/svnx.html)是一个*免费*的基于 GUI 的 Subversion 客户端。
*   **RDBMS**：[PostgreSQL](http://postgresql.org/)是一个*免费*的关系数据库，其跟踪记录可以追溯到*几十年前*。它[很容易安装在 OS X 上](http://developer.apple.com/internet/opensource/postgres.html)。
*   **IDE**：如果（并且可能仅当）您正在编写 Java 代码，[Eclipse](http://www.eclipse.org/)是用于 Java（和其他平台，尽管我不保证除了它的 Java 能力之外的任何东西）的无与伦比的（和*免费的）IDE。*
*   **Screencasting**：[ScreenFlow](http://www.flip4mac.com/screenflow.htm)的售价为 99 美元。

# .htaccess - 如何使用 .htaccess 重定向到包含 HTTP_HOST 的 URL？

> ID：72458
> 
> 赞同：3
> 
> 时间：2008-09-16T13:52:30.097
> 
> 标签：.htaccess, mod-rewrite, mod-alias

**问题**

我需要将一些简短的方便 URL 重定向到更长的实际 URL。有问题的站点使用一组子域来识别一组开发或实时版本。

我希望某些请求被重定向到的 URL 包含 HTTP_HOST，这样我就不必为每个主机创建自定义 .htaccess 文件。

**特定于主机的示例（从 .htaccess 文件中截取）**

```
Redirect /terms http://support.dev01.example.com/articles/terms/ 
```

此示例适用于在 dev01.example.com 上运行的开发版本。如果我在 dev02.example.com 下运行的开发版本的主 .htaccess 文件中使用同一行，我最终会被重定向到错误的位置。

**理想规则（不确定语法是否正确）**

```
Redirect /terms http://support.{HTTP_HOST}/articles/terms/ 
```

这条规则不起作用，只是作为我想要实现的一个例子。然后我可以在许多不同的主机下使用完全相同的规则并获得正确的结果。

**答案？**

*   这可以用 mod_alias 完成还是需要更复杂的 mod_rewrite？
*   如何使用 mod_alias 或 mod_rewrite 来实现？如果可能的话，我更喜欢 mod_alias 解决方案。

**澄清**

我不在同一台服务器上。我想要：

*   http://example.com/terms/ -> [http://](http://support) **support**。**example.com** /articles/terms/
***   [https://安全](https://secure)。**example.com** /terms/ -> [http://support](http://support)。**example.com** /articles/terms/*   **http://dev.example.com** /terms/ -> http : [//support](http://support)。**dev.example.com** /articles/terms/*   [https://安全](https://secure)。**dev.example.com** /terms/ -> [http://support](http://support)。**dev.example.com** /articles/terms/**

 **我希望能够在 example.com 和 dev.example.com 上的 .htaccess 文件中使用相同的规则。在这种情况下，我需要能够将 HTTP_HOST 作为变量引用，而不是在请求重定向到的 URL 中逐字指定它。

我将按照建议调查 HTTP_HOST 参数，但希望有一个可行的示例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-04-05T07:35:56.010

奇怪的是没有人完成实际的**工作**答案（大声笑）：

```
RewriteCond %{HTTP_HOST} support\.(([^\.]+))\.example\.com
RewriteRule ^/terms http://support.%1/article/terms [NC,QSA,R] 
```

* * *

为了帮助您更快地完成工作，我最喜欢的检查正则表达式的工具：

[http://www.quanetic.com/Regex](http://www.quanetic.com/Regex)（不要忘记选择 ereg(POSIX) 而不是 preg(PCRE)！）

当您想检查 URL 并查看它们是否有效时，您可以使用此工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:21:18.530

我想你会想要捕获 HTTP_HOST 值，然后在重写规则中使用它：

```
RewriteCond %{HTTP_HOST} (.*)
RewriteRule ^/terms http://support.%1/article/terms [NC,R=302] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-04T11:25:41.403

如果我正确理解您的问题，您需要 301 重定向（告诉浏览器转到其他 URL）。如果我的解决方案不适合您，请尝试使用此工具：[http](http://www.htaccessredirect.net/index.php) ://www.htaccessredirect.net/index.php并找出适合您的解决方案。

```
//301 Redirect Entire Directory
RedirectMatch 301 /terms(.*) /articles/terms/$1

//Change default directory page
DirectoryIndex 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-16T13:56:59.743

根据这个备忘单（[http://www.addedbytes.com/download/mod_rewrite-cheat-sheet-v2/png/](http://www.addedbytes.com/download/mod_rewrite-cheat-sheet-v2/png/)）这应该工作

```
RewriteCond %{HTTP_HOST} ^www\.domain\.com$ [NC]
RewriteRule ^(.*)$ http://www.domain2.com/$1 
```

请注意，我没有办法对此进行测试，因此应将其视为正确方向的指针，而不是明确的答案。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-16T14:02:39.667

如果您停留在同一台服务器上，那么无论服务器如何，都可以将其放入 .htaccess 中：

```
RedirectMatch 301 ^/terms$ /articles/terms/ 
```

产生：

```
http://example.com/terms -> http://example.com/articles/terms 
```

或者：

```
http://test.example.com/terms -> http://test.example.com/articles/terms 
```

显然，您需要调整 REGEX 匹配等，以确保它能够处理您要扔给它的内容。301 也是如此，如果您不希望浏览器缓存重定向，则可能需要 302。

如果你想：

```
http://example.com/terms -> http://server02.example.com/articles/terms 
```

然后您需要使用 HTTP_HOST 参数。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-16T14:06:42.340

您不需要包含此信息。只需提供相对于根的 URI。

```
Redirect temp /terms /articles/terms/ 
```

这在[mod_alias 文档](http://httpd.apache.org/docs/2.2/mod/mod_alias.html#redirect)中有解释：

> 新的 URL 应该是一个以方案和主机名开头的绝对 URL，但也可以使用以斜杠开头的 URL 路径，在这种情况下，将添加当前服务器的方案和主机名。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-16T14:12:28.647

听起来你真正需要的只是一个别名？

```
Alias /terms /www/public/articles/terms/ 
```

# apache-flex - Automated testing of FLEX based applications

> ID：72462
> 
> 赞同：13
> 
> 时间：2008-09-16T13:52:50.567
> 
> 标签：apache-flex, web-services, testing, web-applications

What tools, preferably open source, are recommended for driving an automated test suite on a FLEX based web application? The same tool also having built in capabilities to drive Web Services would be nice.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:37:29.580

Adobe 自己分发了一个测试框架：[FlexUnit](http://opensource.adobe.com/wiki/display/flexunit/FlexUnit)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-21T04:53:21.247

您是否正在寻找编写代码级单元测试的脚本？如果是这样，dpuint 就是炸弹：[http](http://code.google.com/p/dpuint/) ://code.google.com/p/dpuint/ 。这个库使得对各种异步事件进行自动化测试变得非常容易，无论是在非可视 ActionScript 对象还是可视组件上。他们还在 Google Code 项目页面上有一个不错的多页教程。

如果您正在寻找类似于使用 Flex 应用程序模拟最终用户的自动记录和播放的功能测试工具，HP 的 QuickTest Pro 是 Adob​​e 认可的解决方案。它效果很好，但每个座位的成本约为 4,000 至 6,000 美元。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T14:06:13.387

我听说有人使用 selenium 作为免费/开源测试工具。一个快速的谷歌为它揭示了一个 FLEX API。不确定它是否有效或仍在开发中，但它可能值得一看。

[http://sourceforge.net/projects/seleniumflexapi/](http://sourceforge.net/projects/seleniumflexapi/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-23T17:20:07.970

查看[FlexMonkey](http://code.google.com/p/flexmonkey/)。它通过 FlexUnit 测试进行自动化测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-15T16:54:16.003

试着看看 Melomel。它具有 Cucumber 支持，并包含大多数 Halo 和 Spark 组件的步骤。

[http://melomel.info](http://melomel.info)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:16:13.810

[有一个名为RIATest](http://www.riatest.com/)的自动化测试工具可能适合您。

不幸的是，仅适用于 Windows，而不是开源的，但如果它完成了这项工作，它可能非常物有所值（撰写本文时为 399 美元）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T16:35:43.747

[FunFX](http://funfx.rubyforge.org/)是自动化 UI 测试的一个选项。我没有广泛使用它，但我听说有些人使用它取得了成功。 [这](http://blog.objectmentor.com/articles/2008/06/22/observations-on-test-driving-user-interfaces)是我第一次了解它的文章。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-03-09T16:47:31.170

您的 Flex 应用程序所需的 Flex 代码包含在 SeleniumFlexAPI 分发 .swc 文件 SeleniumFlexAPI.swc 中。只需在编译 Flex 应用程序时将此文件作为库包含。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-11-21T09:52:41.547

Sikuli 是一个很好的工具，可以用来测试基于 flex/flash 的 web 应用程序。- 它可以自动化图形用户界面上的任何事情。- 它适用于 Windows、MAC OSX 和 Linux 以及 iPhone 和 Android。-这是[Sikuli链接](http://www.sikuli.org/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-12-03T00:20:37.530

几个月来，我一直在 Flex 3 + Rails 项目中广泛使用[FunFX](http://github.com/peternic/funfx)。它不仅是开源的，而且也是用 Ruby 编写的，因此与 Web 服务的集成应该相当容易。有一些[屏幕截图](http://onrails.org/articles/2009/07/08/screencast-testing-flex-apps-with-cucumber)[涵盖](http://onrails.org/articles/2009/07/13/screencast-testing-flex-apps-with-cucumber-take-2)了基础知识。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-22T21:44:37.313

我首选的工具是 Selenium Remote Control。几个月前我发现了一个插件：

[http://code.google.com/p/flash-selenium/](http://code.google.com/p/flash-selenium/)

这需要在服务器端（ActionScript/Flex）编写“挂钩”。添加后，我就可以使用 Selenium RC 进行一些浏览器测试。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-11T01:16:12.073

[Selenium-Flex API (0.2.5)](https://sourceforge.net/projects/seleniumflexapi/)的新版本运行良好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-23T15:51:30.383

FunFX 很棒。我们已经广泛使用它并且对它非常满意。社区也很活跃，反应迅速，所以这对我来说是一个很大的优势。

# java - java代码的等效vb代码

> ID：72479
> 
> 赞同：4
> 
> 时间：2008-09-16T13:53:33.277
> 
> 标签：java, vba, random

谁能告诉我这段Java代码到底是做什么的？

```
SecureRandom random = SecureRandom.getInstance("SHA1PRNG");
byte[] bytes = new byte[20];
synchronized (random)
{
    random.nextBytes(bytes);
}

return Base64.encode(bytes); 
```

* * *

逐步解释将很有用，以便我可以在 VB 中重新创建此代码。谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T14:02:01.743

使用代码片段，你可以得到这样的东西

```
将 randomNumGen 调暗为 RandomNumberGenerator = RNGCryptoServiceProvider.Create()
将 randomBytes(20) 调暗为字节
randomNumGen.GetBytes(randomBytes)
返回 Convert.ToBase64String(randomBytes)

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T13:56:11.790

这将创建一个随机数生成器 (SecureRandom)。然后它创建一个字节数组（byte[] bytes），长度为 20 个字节，并用随机数据填充它。

然后使用 BASE64 对其进行编码并返回。

所以，简而言之，

1.  生成 20 个随机字节
2.  使用 Base 64 编码

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T13:57:00.790

它创建一个基于 SHA1 的随机数生成器 (RNG)，然后 Base64 对 RNG 返回的接下来的 20 个字节进行编码。

我不能告诉你为什么它会这样做但是没有更多的上下文:-)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T14:02:00.433

此代码获得一个长度为 20 字节的加密强随机数，然后 Base64 对其进行编码。这里有很多 Java 库代码，所以你的猜测和我的猜测一样好，如何在 VB 中做到这一点。

```
SecureRandom random = SecureRandom.getInstance("SHA1PRNG");
byte[] bytes = new byte[20];
synchronized (random) { random.nextBytes(bytes); }
return Base64.encode(bytes); 
```

第一行创建[SecureRandom](http://java.sun.com/j2se/1.4.2/docs/api/java/security/SecureRandom.html)类的一个实例。此类提供了一个加密强的伪随机数生成器。

第二行声明一个长度为 20 的字节数组。

第三行将接下来的 20 个随机字节读入第 2 行创建的数组中。它在 SecureRandom 对象上进行同步，这样就不会与可能正在使用该对象的其他线程发生冲突。从这段代码中看不出为什么需要这样做。

第四行 Base64 对生成的字节数组进行编码。这可能用于以已知格式传输、存储或显示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T14:06:09.847

基本上就是上面的代码：

1.  创建一个安全的随机数生成器（对于 VB，请参见下面的链接）
2.  用随机字节填充长度为 20 的字节数组
3.  Base64 对结果进行编码（您可能可以使用 Convert.ToBase64String(...)）

你应该在这里找到一些帮助：http: [//msdn.microsoft.com/en-us/library/system.security.cryptography.rngcryptoserviceprovider.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rngcryptoserviceprovider.aspx)

# gwt - gwt lazy loading

> ID：72482
> 
> 赞同：5
> 
> 时间：2008-09-16T13:53:44.777
> 
> 标签：gwt, lazy-loading

Is it possible in a large GWT project, load some portion of JavaScript lazy, on the fly? Like overlays.

PS: Iframes is not a solution.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-08T21:25:49.680

查看`GWT.runAsync`下面的 Google I/O 演讲，其中涉及`JavaScript`项目中`GWT`的延迟加载。

*   [http://code.google.com/p/google-web-toolkit/wiki/CodeSplitting](http://code.google.com/p/google-web-toolkit/wiki/CodeSplitting)
*   [http://code.google.com/events/io/sessions/GoogleWavePoweredByGWT.html（25:30](http://code.google.com/events/io/sessions/GoogleWavePoweredByGWT.html)左右）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T10:49:57.703

GWT 不容易支持这一点，因为您加载的模块需要（或者更确切地说可能需要）的所有 Java 代码都被编译到单个 JavaScript 文件中。这个单一的 JavaScript 文件可能很大，但对于重要的模块，它比等效的手写 JavaScript 文件要小。

您是否有单个生成的 JavaScript 文件太大的情况？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T20:03:08.630

尝试使用 iPhone 或 iPod touch 以“一次性”方法加载大型 GWT 应用程序......它永远不会加载。

模块方法管理起来更复杂，但更适合较小的客户端设备。

现在，如何在不使用 iFrame 的情况下从我的 Java 代码中加载模块？

*   埃里克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:59:51.383

我想这就是你要找的。

```
<body onload="onloadHandler();">
<script type="text/javascript">
function onloadHandler() {
    if (document.createElement && document.getElementsByTagName) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = './test.js';
        var heads = document.getElementsByTagName('head');
        if (heads && heads[0]) {
            heads[0].appendChild(script);
        }
    }
}
function iAmReady(theName) {
   if ('undefined' != typeof window[theName]) {
       window[theName]();
   }
}
function test() {
   // stuff to do when test.js loads
}        
</script> 
```

--test.js

```
iAmReady('test'); 
```

在 Firefox 2、适用于 Windows 的 Safari 3.1.2、IE 6 和 Opera 9.52 中测试并运行。我认为这些的高级版本也应该可以工作。

请注意，加载是异步的。如果您在调用后立即尝试在加载的文件中使用函数或变量`appendChild()`很可能会失败，这就是为什么我在加载的脚本文件中包含一个回调，该回调会在脚本加载完成时强制运行初始化函数.

您也可以在加载脚本的底部调用一个内部函数来在加载后执行某些操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-17T12:29:26.250

您可以想象将您的应用程序拆分为多个 GWT 模块，但您需要记住，这将限制您在模块之间共享代码的能力。因此，如果一个模块的类引用了另一个模块引用的同一类，则公共类的代码将被包含两次。

实际上，模块创建了自己的命名空间，类似于通过两个单独的类加载器加载同一个类时在 Java 中获得的命名空间。事实上，因为 GWT 编译器只编译代码中引用的方法（即，它会消除死代码），所以可以想象一个模块将包含从公共类到另一个模块的不同方法子集。

因此，您必须权衡是否将其全部加载为一个整体模块并在第一轮进行前期打击，是否比拥有多个累积代码大小可能明显大于单个模块方法的模块更好。

鉴于 GWT 的设计目的是让用户只应加载相同版本的模块一次（此后将被缓存），在大多数情况下，一次性预先命中更为可取。

# c# - 如何更改 .NET PropertyGrid 中使用的控件类型

> ID：72515
> 
> 赞同：2
> 
> 时间：2008-09-16T13:55:47.640
> 
> 标签：c#, .net, windows

我有一个使用 .NET PropertyGrid 控件的 Windows 应用程序。是否可以更改用于属性值字段的控件类型？

我希望能够使用 RichTextBox 来更好地格式化输入值。这可以在不创建自定义编辑器类的情况下完成吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T14:06:37.553

要在用户选择属性网格值时添加您自己的自定义编辑，您需要实现一个派生自 UITypeEditor 的类。然后，您可以选择仅在属性区域下方显示一个小弹出窗口或一个完整的对话框。

好的是您可以重用现有的实现。因此，要添加多行编辑字符串的功能，您只需执行此操作...

```
[Editor(typeof(MultilineStringEditor), typeof(UITypeEditor))]
public override string Text
{
    get { return _string; }
    set { _string = value; }
} 
```

他们为您提供的另一个不错的功能是编辑字符串数组的能力......

```
[Editor("System.Windows.Forms.Design.StringArrayEditor, 
         System.Design, Version=2.0.0.0, 
         Culture=neutral, 
         PublicKeyToken=b03f5f7f11d50a3a", 
         typeof(UITypeEditor))]
public string[] Lines
{
    get { return _lines; }
    set { _lines = value; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:03:24.893

您可以控制 PropertyGrid 是否显示简单的编辑框、下拉箭头或省略号控件。

查找 EditorAttribute，然后从那里继续。我确实在某处有样品；我会试着把它挖出来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T13:58:11.643

我认为您正在寻找的是自定义类型描述符。您可以阅读一下并从这里开始：http: [//www.codeproject.com/KB/miscctrl/bending_property.aspx](http://www.codeproject.com/KB/miscctrl/bending_property.aspx)

我不确定你是否可以做任何你想做的控制，但那篇文章让我开始研究 propertygrids。

# sql - 在 Microsoft Access 中创建只能按某些字段搜索的数据库

> ID：72528
> 
> 赞同：-1
> 
> 时间：2008-09-16T13:56:43.333
> 
> 标签：sql, vba, ms-access

您将如何在 Microsoft Access 中创建一个只能由某些字段搜索并由表单上的几个（必要的）文本框和复选框控制的数据库，以便易于使用 - 没有困难的查询？

Example: You have several text boxes and several corresponding check boxes on a form, and when the check box next to the text box is checked, the text box is enabled and you can then search by what is entered into said text box

（其实我已经知道了，只是在玩stackoverflow jeopardy，我问一个问题我知道答案只是为了增加世界的编码知识！答案在大约5分钟内出现）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T14:18:23.623

我自己的解决方案是在表单的标题部分为我希望能够过滤的每个列（通常是所有...）添加一个“过滤器”控件。每次更新这样的“过滤器”控件时，将运行一个过程来更新表单的活动过滤器，使用 Access VBA 中可用的“BuildCriteria”函数。

因此，当我`*cable*`在采购订单描述列顶部的“过滤器”中键入“”时，“WHERE PODescription IS LIKE”`*cable*`会自动添加到 MyForm.filter 属性中......

有些人会反对过滤由多个基础表组成的记录源可能会变得非常棘手。这是正确的。因此，根据我的说法，最好的解决方案是始终（我是认真的！）使用平面表或视图（Access 中的“SELECT”查询）作为表单的记录源。这将使您的生活更轻松！

一旦你确信这一点，你甚至可以想到一个小模块，它会自动将“过滤器”控件和相关过程添加到表单中。您将获得真正的用户友好的客户端界面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:05:59.677

对于一个模糊的问题，我只能回答打开 MS Access，然后单击鼠标几次。

再三考虑：
使用“OpenForm”方法的“WhereCondition”参数

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:07:28.097

在启动时，您需要显示一个表单并禁用其他菜单等。这样您的用户只能看到您有限的功能并且不能直接打开表格等。

这本书的摘录，[Real World Microsoft Access Database Protection and Security](http://msdn.microsoft.com/en-us/library/aa200349.aspx)，应该很有启发性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T17:17:57.950

这实际上是一个相当大的话题，并且充满了各种潜在的问题。大多数关于 Access 的中级到高级书籍都会有一些讨论“按表单查询”的部分，其中您有一个未绑定的表单，允许用户选择某些条件，并且在执行时，编写即时 SQL 以返回匹配数据。

除了平面的单表数据结构之外，这不是一项简单的任务，因为 SQL 的 FROM 子句依赖于 WHERE 子句中查询的表。

我为客户创建的应用程序中的一些 QBF 表单示例：

1.  [查询4个基础表](http://dfenton.com/DFA/examples/Search.gif)
2.  [查询平面单表](http://dfenton.com/DFA/examples/SearchSimple.gif)
3.  [查询3个基础表](http://dfenton.com/DFA/examples/QBF/CFM.gif)
4.  [查询6个底层表](http://dfenton.com/DFA/examples/QBF/SA.gif)
5.  [查询2个基础表](http://dfenton.com/DFA/examples/QBF/WTS.gif)

第一个由一个类模块驱动，该类模块具有反映在此表单中选择的标准的属性，并且具有编写 FROM 和 WHERE 子句的方法。这使得添加其他字段变得非常容易（只要这些字段不是来自已包含的表之外的表）。

该过程中最复杂的部分是编写 FROM 子句，因为您必须具有适当的连接类型并且只包括 SELECT 子句或 WHERE 子句中的表。如果您包含其他任何内容，您的查询速度会大大降低（特别是如果您有任何外部连接）。

但这是一个大主题，没有灵丹妙药的解决方案——相反，必须为每个特定的应用程序创建类似的东西。与用户一起彻底测试它也很重要，因为对于您（开发人员）来说完全清楚和可以理解的内容通常对最终用户来说非常神秘。

但这是一个不仅仅适用于 QBF 的原则！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T08:44:51.237

如果功能非常有限和/或专门化，那么 SQL 数据库可能无论如何都会过度杀伤，例如在本地缓存所有数据组合，甚至在内存中，并根据表单上的复选框显示一个。以前，您可以从表中撤消权限并仅在以规定方式查询数据的 VIEWs/PROC 上授予它们，但是安全性已从 MS Access 2007 中删除，因此您现在可以真正阻止用户绕过您的简单应用程序，例如、Excel 并以他们喜欢的任何方式查询数据……但这不是企业数据库的重点吗？;-)

# sharepoint - SharePoint 列表中的自动编号列

> ID：72537
> 
> 赞同：30
> 
> 时间：2008-09-16T13:58:03.080
> 
> 标签：sharepoint, moss

在 SharePoint 列表中，我想要一个自动编号列，当我添加到列表中时该列会递增。我该怎么做才能做到最好？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-16T14:05:52.530

Sharepoint 列表自动有一个带有“ID”的列，该列会自动递增。您只需从“修改视图”屏幕中选择此列即可查看它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-16T14:01:38.827

您无法将新的唯一自动生成 ID 添加到 SharePoint 列表，但那里已经有一个！如果您编辑“所有项目”视图，您将看到未选中显示选项的列列表。

这些列中有很多存在但从未显示，例如“创建者”和“创建者”。这些字段在 SharePoint 中使用，但默认情况下不显示，以免显示混乱。您无法编辑这些字段，但可以将它们显示给用户。如果您选中 ID 字段旁边的“显示”框，您将在列表中显示一个唯一且自动生成的 ID 字段。

签出：[SharePoint 列表中的唯一 ID](https://web.archive.org/web/20130413013118/http://blog.hinshelwood.com/unique-id-in-sharepoint-list/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T15:14:43.473

如果您想控制唯一标识符的格式，您可以[在 SharePoint中](http://msdn.microsoft.com/en-us/library/ms415141.aspx)[创建自己`<FieldType>`](http://msdn.microsoft.com/en-us/library/ms415141.aspx)的。MSDN 也有一个[可视化的 How-To](http://msdn.microsoft.com/en-us/library/bb684919.aspx)。这基本上意味着您正在创建一个自定义列。

WSS 定义了 Counter 字段类型（这是上面的 ID 列使用的）。我从来没有需要重新使用它或扩展它，但它应该是可能的。

无需创建自定义`<FieldType>`. 例如：如果您想要像 CUST1、CUST2、... 这样的唯一 ID，则可以创建一个计算列并在您的公式 ( `="CUST" & [ID]`) 中使用 ID 列的值。我还没有尝试过，但这*应该*可以:)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-04-18T23:06:48.997

我在自定义列表中遇到了这个问题，虽然无法使用自动生成的*ID*列来创建计算列，但可以使用工作流来完成繁重的工作。

我创建了一个*Number*类型的新工作流变量，并将其设置为当前项目中*ID*列的值。然后只需计算自定义列值并设置它 - 在我的情况下，我只需要从 100,000 开始编号。

![在此处输入图像描述](https://i.stack.imgur.com/1S1ek.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T14:00:58.563

默认情况下它在那里。这是 id 字段。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-17T03:55:19.603

如果您想要超出所有列表中的 ID 列的内容，您可能不得不求助于列表中的事件接收器来“计算”您唯一标识的值应该是什么，或者使用自定义字段类型将所需的逻辑嵌入其中。不幸的是，这两个选项都需要编写自定义代码并将其部署到服务器，并将程序集部署到 GAC，这在您无法完全控制服务器的环境中可能会令人不悦。

如果您不需要立即显示唯一标识符，您可以通过工作流（使用 SharePoint Designer 或 Visual Studio 中内置的自定义 WF 工作流）生成它。

不幸的是，计算列似乎是一个显而易见的解决方案，但不适用于此目的，因为在尝试计算时尚未分配 ID。如果您事后进入并编辑项目，计算可能会达到您想要的结果，但在初始创建新项目时，它不会被正确计算。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T13:37:02.250

如前所述，sharepoint 中的所有对象都包含某种唯一标识符（通常是基于整数的列表项计数器和列表的 GUID）。

[也就是说， http://www.codeplex.com/features](http://www.codeplex.com/features)上还有一个名为“唯一列策略”的功能，旨在添加具有唯一值的其他列。完整的文章可在[http://scothillier.spaces.live.com/blog/cns!8F5DEA8AEA9E6FBB!293.entry获得](http://scothillier.spaces.live.com/blog/cns!8F5DEA8AEA9E6FBB!293.entry)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T21:35:01.903

所以我不确定我是否真的能想到*为什么*您实际上需要一个“网站集唯一”ID，所以也许您可以发表评论并让我们知道这里实际要完成的工作......

**无论哪种方式，如果您真的**需要它，所有项目都有一个作为 GUID 的 UniqueID 属性：http: [//msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.uniqueid.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem.uniqueid.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-24T16:07:10.767

Peetha 有最好的主意，我在我们的 SP 站点中对自定义列表做了同样的事情。使用工作流自动递增是最好的方法，而且并不难。看看这个网站：[http ://splittingshares.wordpress.com/2008/04/11/auto-increment-a-number-in-a-new-list-item/](http://splittingshares.wordpress.com/2008/04/11/auto-increment-a-number-in-a-new-list-item/)

我非常感谢发布该解决方案的人，这非常酷！

# language-agnostic - 软件令牌是多因素安全性中有效的第二个因素吗？

> ID：72540
> 
> 赞同：1
> 
> 时间：2008-09-16T13:58:32.940
> 
> 标签：language-agnostic, authentication

我们正在更改我工作场所的远程登录安全流程，我们担心新系统不会像旧系统那样使用[多因素身份验证](http://en.wikipedia.org/wiki/Two-factor_authentication)。（我们一直在使用 RSA 密钥卡，但由于成本原因正在更换它们。）新系统是一种反网络钓鱼图像系统，被误解为双因素身份验证系统。我们现在正在探索在不向用户发布硬件设备的情况下继续提供多因素安全性的方法。

是否可以编写一个基于软件的令牌系统以安装在用户的 PC 上，这将构成多因素身份验证系统中真正的第二因素？这会被认为是“用户拥有的东西”，还是仅仅是“用户知道的东西”的另一种形式？

编辑：*phreakre*对 cookie 提出了一个很好的观点。为了这个问题，假设 cookie 已被排除，因为它们不够安全。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T16:18:54.583

我会说“不”。如果不发布最终用户可以随身携带的东西，我认为您无法真正获得多因素身份验证的“您拥有的东西”部分。如果您“拥有”某些东西，则意味着它可能会丢失 - 没有多少用户会丢失他们的整个台式机。“你拥有的东西”的安全性，毕竟来自以下几点：

*   当您没有它时，您会注意到 - 明确表明安全性已受到损害
*   只有 1 人可以拥有它。因此，如果您这样做，其他人就不会

软件令牌不提供相同的保证，我不会凭良心将其归类为用户“拥有”的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:05:58.367

虽然我不确定这是一个“有效”的第二个因素，但许多网站已经使用这种类型的过程有一段时间了：cookie。几乎不安全，但它是您描述的项目类型。

至于“用户拥有的东西”与“用户知道的东西”，如果它是驻留在用户 PC 上的东西 [比如后台应用程序在被询问时提供信息但不要求用户做任何事情]，我会将其归档在“用户拥有的东西”。如果他们在某个字段中输入密码，然后输入另一个密码来解锁您存储在他们 PC 上的信息，那么这是“用户知道的”。

关于已经存在的商业解决方案：我们使用一种名为 BigFix 的 Windows 产品。虽然它主要是一个远程配置和合规性产品，但我们有一个模块作为我们用于远程/VPN 情况的多因素系统的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:47:35.020

软件令牌是第二个因素，但它可能不如 RSA fob 好。如果用户的计算机受到威胁，攻击者可以默默地复制软件令牌，而不会留下任何被盗的痕迹（不像 RSA 密钥卡，他们必须自己拿走密钥卡，因此用户有机会注意到它丢失了）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T16:42:53.073

我同意@freespace 的观点，即该图像不是用户多因素身份验证的一部分。正如您所说，该图像是反网络钓鱼计划的一部分。我认为图像实际上是系统对用户的弱认证。该图像向用户提供了网站有效而非虚假网络钓鱼网站的身份验证。

> 是否可以编写一个基于软件的令牌系统以安装在用户的 PC 上，这将构成多因素身份验证系统中真正的第二因素？

基于软件的令牌系统听起来您可能想研究 Kerberos 协议，[http://en.wikipedia.org/wiki/Kerberos_(protocol)](http://en.wikipedia.org/wiki/Kerberos_(protocol))。不过，我不确定这是否算作多因素身份验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T17:25:32.020

您所描述的是*计算机*拥有的东西，而不是用户。因此，您可以假设（取决于实施）确信它是计算机，但不能保证用户......

现在，既然我们在谈论远程登录，也许情况是个人笔记本电脑？在这种情况下，*笔记本电脑*就是您所拥有的东西，当然，它的密码也是您知道的……然后剩下的就是安全实施，并且可以正常工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T20:56:14.143

安全总是关于权衡。硬件令牌可能更难被窃取，但它们无法抵御基于网络的 MITM 攻击。如果这是一个基于 Web 的解决方案（我假设它是，因为您使用的是基于图像的系统之一），您应该考虑提供相互 https 身份验证的东西。然后，您可以免受众多 DNS 攻击和基于 wi-fi 的攻击。

您可以在此处了解更多信息：http: [//www.wikidsystems.com/learn-more/technology/mutual_authentication](http://www.wikidsystems.com/learn-more/technology/mutual_authentication) 和 [http://en.wikipedia.org/wiki/Mutual_authentication](http://en.wikipedia.org/wiki/Mutual_authentication) ，这里是关于设置相互身份验证以防止网络钓鱼： http: [//www.howtoforge.net/prevent_phishing_with_mutual_authentication](http://www.howtoforge.net/prevent_phishing_with_mutual_authentication)。

基于图像的系统被定位为相互身份验证，我猜是这样，但由于它不是基于密码学原理，所以它很弱。是什么阻止 MITM 也展示图像？它也不是用户友好的IMO。

# asp.net - 一个更新面板与多个更新面板

> ID：72541
> 
> 赞同：49
> 
> 时间：2008-09-16T13:58:43.297
> 
> 标签：asp.net, asp.net-ajax, webforms

我有一个 ASP.NET 网页，其中显示了需要在某些条件下进行最佳更新的各种字段、按钮单击等。我们已经实现了 AJAX，使用 ASP.NET 更新面板来避免可见的回发。

原本只有*一个*领域需要这种能力……很快就扩展到了其他领域。现在我的网页有多个更新面板。

我想知道是否最好将整个表单包装在单个 UpdatePanel 中，或者保留单独的 UpdatePanel。

使用 ASP.NET UpdatePanel 的最佳实践是什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-16T14:11:43.780

多个面板要好得多。完全使用 UpdatePanels 的主要原因之一是减少流量并仅通过网络来回发送您需要的部分。通过仅使用一个更新面板，您几乎每次都在做一个完整的回帖，您只是使用一点 Javascript 来更新页面而不会闪烁。

如果有页面需要一起更新，有办法在一个更新时触发其他面板更新..但您绝对应该使用多个更新面板。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-16T14:41:55.767

我会提醒您，对于多个更新面板，您需要小心。确保将 UpdateMode 设置为 Conditional。否则，当一个更新面板被“回发”到服务器时，它们都被回发。

我强烈建议使用这些工具

[Web Development Helper](http://projects.nikhilk.net/WebDevHelper/Default.aspx)（这里有一个简短的教程[Web Development Helper 和 ASP.NET Ajax](http://www.nikhilk.net/WebDevHelperHTTPTracingUpdates.aspx)）

[提琴手](http://www.fiddlertool.com/fiddler/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-03-16T21:11:19.207

这些答案中的任何一个都没有提到选择之间的可维护性比较。第三种选择是您不使用任何更新面板，而是将自己留给反向 ajax。查看有趣的项目：[PokeIn](http://pokein.codeplex.com)和[VisualJS.NET](http://visualjs.net)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T14:13:27.397

我相信如果可以的话，最好使用多个 UpdatePanel，因为 UpdatePanel 生成的 POST 的大小。如果您可以将手动 AJAX 方法用于更新字段等小事，那就更好了。WPF 提供了一些 javascript 函数和方法来完成此任务。以下是一些可能有用的链接：

*   [http://msdn.microsoft.com/en-us/library/bb514961.aspx](http://msdn.microsoft.com/en-us/library/bb514961.aspx)
*   [http://msdn.microsoft.com/en-us/library/bb515101.aspx](http://msdn.microsoft.com/en-us/library/bb515101.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-17T13:10:09.780

我推荐多个更新面板。使用多个更新面板将保持在 asp.net Web 应用程序中使用更新面板的真正意义。而且由于我们甚至可以从另一个更新面板触发一个更新面板，这使得编写页面范围的控件和行为变得更加容易。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-02-22T10:56:13.600

我完全同意使用多个更新面板而不是使用单个更新面板，如果您只想回发某个部分，如果您想回发整个页面，那么最好使用单个更新面板。

确保为所有更新面板设置了 updatemode="conditional"，否则所有更新面板都会被刷新。

另请查看以下帖子以了解更新面板的完整用法

[http://www.codeproject.com/KB/aspnet/Select_List_Box.aspx](http://www.codeproject.com/KB/aspnet/Select_List_Box.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T14:01:19.563

不确定最佳实践，但根据我的经验，多个面板运行良好，并减少了一次发送的数据量 - 导致整体响应时间增加。多个面板还降低了每个服务器调用的复杂性。

# c++ - 为什么会存在易失性？

> ID：72552
> 
> 赞同：253
> 
> 时间：2008-09-16T13:59:45.667
> 
> 标签：c++, volatile, c++-faq

关键字有什么作用`volatile`？在 C++ 中它解决了什么问题？

就我而言，我从来没有故意需要它。

* * *

## 回答 #1

> 赞同：299
> 
> 时间：2008-09-16T14:04:06.047

`volatile`如果您正在从内存中的某个位置读取，例如，一个完全独立的进程/设备/可能写入的任何内容，则需要。

我曾经在直接 C 语言的多处理器系统中使用双端口 ram。我们使用硬件管理的 16 位值作为信号量来了解其他人何时完成。本质上我们是这样做的：

```
void waitForSemaphore()
{
   volatile uint16_t* semPtr = WELL_KNOWN_SEM_ADDR;/*well known address to my semaphore*/
   while ((*semPtr) != IS_OK_FOR_ME_TO_PROCEED);
} 
```

没有`volatile`，优化器会认为循环是无用的（这家伙从不设置值！他疯了，摆脱那个代码！）我的代码将在没有获取信号量的情况下继续运行，从而导致以后出现问题。

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-09-16T14:01:20.000

`volatile`在开发嵌入式系统或设备驱动程序时需要它，您需要读取或写入内存映射的硬件设备。特定设备寄存器的内容可能随时更改，因此您需要`volatile`关键字来确保编译器不会优化此类访问。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2008-09-16T15:23:45.713

一些处理器具有精度超过 64 位的浮点寄存器（例如，没有 SSE 的 32 位 x86，请参阅 Peter 的评论）。这样，如果您对双精度数运行多个操作，您实际上会得到比将每个中间结果截断为 64 位时更高精度的答案。

这通常很好，但这意味着根据编译器分配寄存器和优化的方式，在完全相同的输入上执行完全相同的操作会产生不同的结果。如果您需要一致性，则可以使用 volatile 关键字强制每个操作返回内存。

它对于一些没有代数意义但减少浮点误差的算法也很有用，例如 Kahan 求和。从代数上讲，它是一个 nop，因此它通常会被错误地优化，除非某些中间变量是易失的。

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2008-09-16T14:32:59.500

摘自 Dan Saks 的*“Volatile as a promise”*文章：

> (...) volatile 对象是其值可能自发改变的对象。也就是说，当你声明一个对象是 volatile 时，你是在告诉编译器该对象可能会改变状态，即使程序中似乎没有任何语句会改变它。”

以下是他关于`volatile`关键字的三篇文章的链接：

*   [明智地使用 volatile](https://www.embedded.com/electronics-blogs/programming-pointers/4025583/Use-volatile-judiciously)
*   [准确放置挥发物](https://www.embedded.com/electronics-blogs/programming-pointers/4025609/Place-volatile-accurately)
*   [变幻莫测的承诺](https://www.embedded.com/electronics-blogs/programming-pointers/4025624/Volatile-as-a-promise)

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-09-17T11:55:18.687

实现无锁数据结构时必须使用 volatile。否则编译器可以自由地优化对变量的访问，这将改变语义。

换句话说， volatile 告诉编译器对该变量的访问必须对应于物理内存读/写操作。

例如，这是在 Win32 API 中声明 InterlockedIncrement 的方式：

```
LONG __cdecl InterlockedIncrement(
  __inout  LONG volatile *Addend
); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-09-16T21:03:12.123

我曾在 1990 年代初从事的一个大型应用程序包含使用 setjmp 和 longjmp 进行的基于 C 的异常处理。volatile 关键字对于需要保留在充当“catch”子句的代码块中的变量的值是必需的，以免这些变量存储在寄存器中并被 longjmp 清除。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-07-27T18:14:02.053

在标准 C 中，使用`volatile`信号处理程序的地方之一。事实上，在标准 C 中，您可以在信号处理程序中安全地做的就是修改`volatile sig_atomic_t`变量或快速退出。事实上，AFAIK，它是标准 C 中唯一`volatile`需要使用以避免未定义行为的地方。

> ### ISO/IEC 9899:2011 §7.14.1.1`signal`功能
> 
> ¶5 如果信号的出现不是调用`abort`or`raise`函数的结果，则如果信号处理程序引用具有静态或线程存储持续时间的任何对象，该对象不是无锁原子对象，而不是通过分配值，则行为未定义到声明为 的对象`volatile sig_atomic_t`，或者信号处理程序调用标准库中的任何函数，而不是`abort`函数、`_Exit`函数、 `quick_exit`函数或`signal`函数，其第一个参数等于与导致调用的信号对应的信号编号处理程序。此外，如果对`signal`函数的这种调用导致 SIG_ERR 返回，则 的值`errno`是不确定的。^(252))
> 
> ^(252))如果任何信号由异步信号处理程序生成，则行为未定义。

这意味着在标准 C 中，您可以编写：

```
static volatile sig_atomic_t sig_num = 0;

static void sig_handler(int signum)
{
    signal(signum, sig_handler);
    sig_num = signum;
} 
```

其他的不多。

POSIX 对您可以在信号处理程序中执行的操作要宽松得多，但仍然存在限制（其中一个限制是标准 I/O 库 -`printf()`等 - 不能安全使用）。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-16T14:08:47.843

为嵌入式开发，我有一个循环来检查可以在中断处理程序中更改的变量。没有“volatile”，循环就变成了一个 noop——据编译器所知，变量永远不会改变，所以它优化了检查。

同样的事情也适用于在更传统的环境中可能在不同线程中更改的变量，但是我们经常进行同步调用，因此编译器在优化方面并不那么自由。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-16T21:09:49.580

当编译器坚持优化我希望在我逐步执行代码时能够看到的变量时，我在调试版本中使用了它。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-17T09:30:09.597

除了按预期使用它之外，volatile 还用于（模板）元编程。它可用于防止意外重载，因为 volatile 属性（如 const）参与重载决议。

```
template <typename T> 
class Foo {
  std::enable_if_t<sizeof(T)==4, void> f(T& t) 
  { std::cout << 1 << t; }
  void f(T volatile& t) 
  { std::cout << 2 << const_cast<T&>(t); }

  void bar() { T t; f(t); }
}; 
```

这是合法的；这两个重载都可能是可调用的，并且几乎相同。重载中的强制转换是合法的，因为我们知道 bar无论如何`volatile`都不会传递非易失性。`T`但是，该`volatile`版本更糟糕，因此如果非易失性`f`可用，则永远不要在重载解决方案中选择。

请注意，代码实际上从不依赖于`volatile`内存访问。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-16T14:04:48.790

1.  您必须使用它来实现自旋锁以及一些（全部？）无锁数据结构
2.  将其与原子操作/指令一起使用
3.  曾经帮助我克服编译器的错误（优化期间错误生成的代码）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-10-05T13:20:55.820

该`volatile`关键字旨在防止编译器对可能以编译器无法确定的方式更改的对象应用任何优化。

声明为的对象`volatile`从优化中省略，因为它们的值可以随时被当前代码范围之外的代码更改。系统总是从内存位置读取对象的当前值，`volatile`而不是在请求时将其值保存在临时寄存器中，即使先前的指令要求来自同一对象的值也是如此。

**考虑以下情况**

1) 由范围外的中断服务程序修改的全局变量。

2) 多线程应用程序中的全局变量。

**如果我们不使用 volatile 限定符，可能会出现以下问题**

1) 打开优化时，代码可能无法按预期工作。

2) 启用和使用中断时，代码可能无法按预期工作。

[Volatile：程序员最好的朋友](http://www.drdobbs.com/cpp/volatile-the-multithreaded-programmers-b/184403766)

[https://en.wikipedia.org/wiki/Volatile_(computer_programming)](https://en.wikipedia.org/wiki/Volatile_(computer_programming))

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-04-29T06:54:54.100

所有的答案都很棒。但最重要的是，我想分享一个例子。

下面是一个小cpp程序：

```
#include <iostream>

int x;

int main(){
    char buf[50];
    x = 8;

    if(x == 8)
        printf("x is 8\n");
    else
        sprintf(buf, "x is not 8\n");

    x=1000;
    while(x > 5)
        x--;
    return 0;
} 
```

现在，让我们生成上述代码的程序集（我将只粘贴与此处相关的程序集部分）：

生成程序集的命令：

```
g++ -S -O3 -c -fverbose-asm -Wa,-adhln assembly.cpp 
```

和大会：

```
main:
.LFB1594:
    subq    $40, %rsp    #,
    .seh_stackalloc 40
    .seh_endprologue
 # assembly.cpp:5: int main(){
    call    __main   #
 # assembly.cpp:10:         printf("x is 8\n");
    leaq    .LC0(%rip), %rcx     #,
 # assembly.cpp:7:     x = 8;
    movl    $8, x(%rip)  #, x
 # assembly.cpp:10:         printf("x is 8\n");
    call    _ZL6printfPKcz.constprop.0   #
 # assembly.cpp:18: }
    xorl    %eax, %eax   #
    movl    $5, x(%rip)  #, x
    addq    $40, %rsp    #,
    ret 
    .seh_endproc
    .p2align 4,,15
    .def    _GLOBAL__sub_I_x;   .scl    3;  .type   32; .endef
    .seh_proc   _GLOBAL__sub_I_x 
```

您可以在程序集中看到没有生成程序集代码，`sprintf`因为编译器假定它`x`不会在程序之外更改。`while`循环也是如此。`while`由于优化，循环被完全删除，因为编译器将其视为无用的代码，因此直接分配`5`给`x`（参见 参考资料`movl $5, x(%rip)`）。

如果外部进程/硬件会改变 和之间`x`某处的值，就会出现问题。我们希望block 可以工作，但不幸的是编译器已经删除了那部分。`x = 8;``if(x == 8)``else`

现在，为了解决这个问题，在 中`assembly.cpp`，让我们更改`int x;`为`volatile int x;`并快速查看生成的汇编代码：

```
main:
.LFB1594:
    subq    $104, %rsp   #,
    .seh_stackalloc 104
    .seh_endprologue
 # assembly.cpp:5: int main(){
    call    __main   #
 # assembly.cpp:7:     x = 8;
    movl    $8, x(%rip)  #, x
 # assembly.cpp:9:     if(x == 8)
    movl    x(%rip), %eax    # x, x.1_1
 # assembly.cpp:9:     if(x == 8)
    cmpl    $8, %eax     #, x.1_1
    je  .L11     #,
 # assembly.cpp:12:         sprintf(buf, "x is not 8\n");
    leaq    32(%rsp), %rcx   #, tmp93
    leaq    .LC0(%rip), %rdx     #,
    call    _ZL7sprintfPcPKcz.constprop.0    #
.L7:
 # assembly.cpp:14:     x=1000;
    movl    $1000, x(%rip)   #, x
 # assembly.cpp:15:     while(x > 5)
    movl    x(%rip), %eax    # x, x.3_15
    cmpl    $5, %eax     #, x.3_15
    jle .L8  #,
    .p2align 4,,10
.L9:
 # assembly.cpp:16:         x--;
    movl    x(%rip), %eax    # x, x.4_3
    subl    $1, %eax     #, _4
    movl    %eax, x(%rip)    # _4, x
 # assembly.cpp:15:     while(x > 5)
    movl    x(%rip), %eax    # x, x.3_2
    cmpl    $5, %eax     #, x.3_2
    jg  .L9  #,
.L8:
 # assembly.cpp:18: }
    xorl    %eax, %eax   #
    addq    $104, %rsp   #,
    ret 
.L11:
 # assembly.cpp:10:         printf("x is 8\n");
    leaq    .LC1(%rip), %rcx     #,
    call    _ZL6printfPKcz.constprop.1   #
    jmp .L7  #
    .seh_endproc
    .p2align 4,,15
    .def    _GLOBAL__sub_I_x;   .scl    3;  .type   32; .endef
    .seh_proc   _GLOBAL__sub_I_x 
```

在这里您可以看到生成了`sprintf`,`printf`和`while`loop 的汇编代码。好处是，如果`x`变量被一些外部程序或硬件改变，`sprintf`部分代码将被执行。同样`while`循环现在可以用于忙等待。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-16T21:02:04.027

除了 volatile 关键字用于告诉编译器不要优化对某些变量的访问（可以由线程或中断例程修改）之外，它还可以**用来消除一些编译器错误**——*是的，它可以成为*---。

例如，我在嵌入式平台上工作，编译器对变量的值做出了一些错误的假设。如果代码没有优化，程序可以正常运行。使用优化（这是非常需要的，因为它是一个关键的例程），代码将无法正常工作。唯一的解决方案（虽然不是很正确）是将“错误”变量声明为 volatile。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-10-23T11:53:54.007

`volatile`即使没有关键字，您的程序似乎也可以工作？或许这就是原因：

如前所述，`volatile`关键字有助于以下情况

```
volatile int* p = ...;  // point to some memory
while( *p!=0 ) {}  // loop until the memory becomes zero 
```

但是，一旦调用了外部或非内联函数，似乎几乎没有效果。例如：

```
while( *p!=0 ) { g(); } 
```

然后有或没有`volatile`几乎相同的结果。

只要 g() 可以完全内联，编译器就可以看到正在发生的一切，因此可以进行优化。但是当程序调用编译器看不到发生了什么的地方时，编译器再做任何假设是不安全的。因此，编译器将生成始终直接从内存中读取的代码。

但是要当心，当您的函数 g() 变为内联时（由于显式更改或由于编译器/链接器的巧妙性），如果您忘记了`volatile`关键字，您的代码可能会中断！

`volatile`因此，即使您的程序似乎无法正常工作，我也建议您添加关键字。对于未来的变化，它使意图更加清晰和稳健。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-07-30T17:01:03.857

在 C 语言的早期，编译器会将所有读取和写入左值的操作解释为内存操作，按照与代码中出现的读取和写入相同的顺序执行。在许多情况下，如果给编译器一定的自由来重新排序和合并操作，效率可以大大提高，但是这样做存在问题。尽管经常以某种顺序指定操作仅仅是因为必须以*某种*顺序指定它们，因此程序员选择了许多同样好的替代方案之一，但情况并非总是如此。有时，某些操作以特定顺序发生是很重要的。

究竟哪些测序细节很重要，取决于目标平台和应用领域。该标准没有提供特别详细的控制，而是选择了一个简单的模型：如果一系列访问是使用不合格的左值完成的`volatile`，编译器可以在它认为合适的时候重新排序和合并它们。如果使用`volatile`-qualified 左值完成操作，则质量实现应提供针对其预期平台和应用程序领域的代码可能需要的任何额外排序保证，而不要求程序员使用非标准语法。

不幸的是，许多编译器没有确定程序员需要什么保证，而是选择提供标准规定的最低限度的保证。这使得`volatile`它没有应有的用处。例如，在 gcc 或 clang 上，需要实现基本“切换互斥锁”的程序员 [在另一个任务完成之前，已获取和释放互斥锁的任务不会再次这样做] 必须执行一个四件事：

1.  将互斥体的获取和释放放在编译器无法内联的函数中，也无法对其应用全程序优化。

2.  将由互斥锁保护的所有对象限定为`volatile`-- 如果所有访问都发生在获取互斥锁之后和释放它之前，则不需要。

3.  使用优化级别 0 强制编译器生成代码，就好像所有不合格的对象`register`都是`volatile`.

4.  使用 gcc 特定的指令。

相比之下，当使用更适合系统编程的更高质量的编译器（例如 icc）时，会有另一种选择：

5.  确保在`volatile`需要获取或释放的每个地方都执行 -qualified 写入。

获取基本的“切换互斥体”需要`volatile`读取（以查看它是否已准备好），并且也不需要`volatile`写入（对方不会尝试重新获取它，直到它被交还）但必须执行无意义的`volatile`写入仍然比 gcc 或 clang 下可用的任何选项更好。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-05-05T10:33:05.457

我应该提醒您的一种用途是，在信号处理函数中，如果您想访问/修改一个全局变量（例如，将其标记为 exit = true），您必须将该变量声明为“volatile”。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-11-22T23:06:49.757

其他答案已经提到避免一些优化，以便：

*   使用内存映射寄存器（或“MMIO”）
*   编写设备驱动程序
*   允许更轻松地调试程序
*   使浮点计算更具确定性

每当您需要一个值看起来来自外部且不可预测并避免基于已知值的编译器优化时，以及当实际未使用结果但您需要计算它，或者它已被使用时，易失性是必不可少的您想为基准计算多次，并且您需要计算在精确点开始和结束。

易失性读取类似于输入操作（例如`scanf`或使用`cin`）：*值似乎来自程序外部，因此任何依赖于该值的计算都需要在它之后开始*。

易失性写入类似于输出操作（类似于`printf`或使用`cout`）：*该值似乎在程序外部进行通信，因此如果该值取决于计算，则需要在 之前完成*。

因此**可以使用一对易失性读/写来驯服基准并使时间测量变得有意义**。

如果没有 volatile，您的计算之前可以由编译器启动，**因为没有什么可以阻止使用诸如时间测量之类的函数对计算进行重新排序**。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2021-01-09T10:27:23.087

我想从他的[GotW #95](https://herbsutter.com/2014/01/13/gotw-95-solution-thread-safety-and-synchronization/)中引用 Herb Sutter 的话，这有助于理解`volatile`变量的含义：

> `C++` `volatile``C#`变量（在和等语言中没有类似物`Java`）总是超出本文和任何其他关于内存模型和同步的文章的范围。那是因为`C++` `volatile`变量根本与线程或通信无关，并且不与这些事物交互。相反，`C++` `volatile`变量应该被视为通向语言之外不同世界的门户——根据定义，该内存位置不遵守语言的内存模型，因为该内存位置是由硬件访问的（例如，由子卡写入），具有一个以上的地址，或者以其他方式“奇怪”且超出语言范围。所以`C++` `volatile`变量通常是每个关于同步的准则的例外，因为使用普通工具（互斥锁、原子等）总是固有地“活泼”和不可同步，并且更普遍地存在于语言和编译器的所有正常之外，包括它们通常无法优化由编译器（因为不允许编译器知道它们的语义； a 的`volatile int vi;`行为可能不像 normal `int`，而且您甚至不能假设代码 like`vi = 5; int read_back = vi;`保证会导致`read_back == 5`，或者类似的代码`int i = vi; int j = vi;`读取 vi 两次会例如，如果是硬件计数器，结果`i == j`将不正确）。`vi`

# c# - 在编辑节点 (C#) 时提交 TreeView 的更改很热？

> ID：72556
> 
> 赞同：2
> 
> 时间：2008-09-16T14:00:02.560
> 
> 标签：c#, treeview, commit, editing

我正在使用 Microsoft 的 TreeView 控件，并且试图在编辑节点标签时强制进行某种数据更新，类似于网格的 UpdateData。

基本上，在我的编辑器中，我有一个保存按钮和这个 TreeView 控件：我想要的是当我在 TreeView 中编辑节点的标签时，如果我单击保存按钮，我希望能够提交节点的标签我是编辑。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-16T14:28:24.177

节点标签编辑是使用文本框执行的，当该文本框失去焦点时，名称的更改将作为节点的新标签提交。因此，如果您单击的“保存”按钮获得焦点，那么它将自动导致更新，因为文本框将失去焦点。

如果“保存”按钮没有获得焦点，则需要处理“保存”按钮的单击事件并要求树结束任何当前的标签编辑。如果没有方法/属性，您可以调用以请求标签编辑完成，因此您有两个选择。如果树视图有焦点，则将焦点放在其他地方。或者再次关闭/打开标签编辑...

```
treeView.LabelEdit = false;
treeView.LabelEdit = true; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T15:26:32.167

即使没有真正记录在案，我也会接受答案：它有还是没有这样的方法？您实际上没有回答这个问题，只是将问题传回给我。

同时发现了相同的黑客解决方案，将焦点强制到其他一些控件（不是很优雅但有效），尽管这对我来说有点困难，因为我使用 TreeView 作为 UserControl 的一部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T09:26:18.210

你真的需要保存按钮吗？

您可以监听节点编辑的结束 - 例如通过监听 TreeView 的 KeyDown 事件中的“返回”键。如果您正在编辑某些内容（使用 SelectedNode.IsEditing 查找），那么您知道您有一个提交。然后，您可以将其提交给您的数据更新内容。如果您希望能够编辑许多不同的节点并在最后保存它们，那么您需要将每个编辑的节点添加到某种集合中，然后当您单击保存按钮时遍历该集合。

# delphi - 如何找出 Delphi 函数可能抛出的异常？

> ID：72562
> 
> 赞同：13
> 
> 时间：2008-09-16T14:00:10.830
> 
> 标签：delphi, exception-handling

有没有一种好方法可以找出程序/函数在 Delphi 中可以引发哪些异常（包括它被称为程序/函数）？

在 Java 中，您总是必须声明可以抛出哪些异常，但在 Delphi 中并非如此，这可能会导致未处理的异常。

是否有任何代码分析工具可以检测未处理的异常？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T14:22:27.873

（编辑：现在很明显，这个问题*只*涉及设计时检查。）

新答案：

我无法说明是否有任何工具可以为您检查。帕斯卡分析仪，其中之一，没有。

然而，我*可以*告诉你，在大多数 Delphi 应用程序中，即使有一个工具可以帮你检查，你也不会得到任何结果。

*为什么？*因为 TApplication.Run() 中的主消息循环将所有 HandleMessage() 调用包装在一个异常处理块中，该块捕获所有异常类型。因此，在大多数应用程序中，您将拥有大约 99.999% 的代码的隐式/默认异常处理。在大多数应用程序中，这种异常处理将大约 100% 发生在您自己的代码中 - 未包装在异常处理中的 0.001% 的代码将是自动生成的代码。

如果有工具可以为您检查，您需要重写 Application.run() 使其不包括异常处理。

（以前的答案： *Application.OnException 事件处理程序可以被分配来捕获所有其他异常处理程序未处理的异常。虽然这是运行时，因此可能不完全是你所追求的（听起来你想要在设计时识别它们），它确实允许您捕获任何未在其他地方处理的异常。结合[绝地代码库](http://sourceforge.net/projects/jcl/)中的 JCLDebug 等工具，您可以记录堆栈跟踪以找出异常发生的位置和原因，这将允许进一​​步调查并围绕有罪代码添加特定的异常处理或预防......*）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-16T14:18:23.437

我的猜测是你试图让 Delphi 表现得像 Java，这不是一个好方法。我建议不要太担心未处理的异常。在最坏的情况下，它们会冒泡到通用 VCL 异常处理程序并导致 Windows 消息对话框。在正常的应用程序中，它们不会停止应用程序。

编写良好的代码将记录可能引发的不同异常，以便您可以以有意义的方式处理它们。不建议使用包罗万象的处理程序，因为如果您不知道引发异常的原因，实际上无法知道该怎么做。我也可以强烈推荐 madExcept。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T14:07:01.000

除了对“raise”关键字的扫描之外，Delphi 中没有任何语言结构可以告诉不经意的读者可以从方法中预期哪些异常。

在运行时，可以在每个方法中添加一个包罗万象的异常处理程序，但这是不可取的，因为它会减慢执行速度。（而且这样做也很麻烦）。

向方法添加异常处理块将向其添加一些汇编指令（即使未触发异常），当方法被频繁调用时，这会形成可测量的减速。

确实存在一些可以帮助您分析运行时异常的库，例如[madExcept](http://madshi.de/madExceptDescription.htm)、[JclDebug](http://jcl.svn.sourceforge.net/viewvc/jcl/trunk/jcl/source/windows/JclDebug.pas?view=markup)和[EurekaLog](http://www.eurekalog.com/)。这些工具可以记录有关异常的各种详细信息，强烈建议使用其中之一！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T16:02:10.583

简短的回答是没有工具可以做到你所说的，即使是对**raise**关键字的扫描也不会让你到达那里。 *EAccessViolation*或*EOutOfMemory*只是可能在任何地方引发的众多异常中的两个。

关于 Delphi 的一个基本问题是异常是分层的：所有定义的语言异常都来自*Exception*，尽管值得注意的是实际上可以引发任何*TObject*后代。

如果您想**捕获**在特定过程中引发的每个异常，只需将其包装在**try / except**块中，但如前所述***，不建议这样做***。

```
// Other code . . . 
try
  SomeProcedure()
except  // BAD IDEA!
  ShowMessage('I caught them all!');
end; 
```

这将捕获所有内容，甚至是引发的*TObject*的实例。尽管我认为这很少是最好的做法。通常你想使用一个**try / finally**块，然后允许你的全局异常处理程序（或一个最终的**try / except**块）实际处理异常。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-16T14:12:32.577

任何未在特定级别显式或通常处理的异常都将在调用堆栈中向上传播。Delphi RTL（运行时库）将生成一组不同的异常类——（数学错误、访问错误、类特定错误等）。您可以选择在不同的 try except 块中专门或一般地处理它们。

除非您需要传播带有异常的特定功能上下文，否则您实际上不需要声明任何新的异常类。

正如之前的评论者所写，您还可以添加所有异常处理程序的母亲，例如 MadExcept 或 EurekaLog 来捕获未捕获的。

编辑：这是针对未处理异常的全面保险

```
try
  ThisFunctionMayFail;
except
  // but it sure won't crash the application
  on e:exception
  do begin
    // something sensible to handle the error 
    // or perhaps log and/or display the the generic e.description message
  end
end; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T14:51:28.460

我将第二（或第三）[MadExcept](http://www.madshi.net/)。我已经在几个商业应用程序中成功使用它，没有任何问题。MadExcept 的好处在于，它会为您生成一份包含完整堆栈跟踪的报告，该报告通常会为您指出错误的正确方向，甚至可以包含屏幕截图，并自动将其通过电子邮件发送给您只需单击鼠标即可从客户端计算机。

但是，您不想将其用于所有异常，只是为了捕获您错过的异常。例如，如果您打开一个数据库并且登录失败，您最好自己捕获并处理这个数据库，而不是在您的应用程序发生消息中向用户提供 MadExcept 默认错误。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-16T14:03:33.550

看看[http://www.madshi.net/madExceptDescription.htm](http://www.madshi.net/madExceptDescription.htm)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T14:09:22.727

对于运行时尝试[Eurekalog](http://www.eurekalog.com/)。我不知道设计时是否存在工具。即使您有没有源代码的第三方代码，您也会遇到更多困难。Delphi 不需要捕获异常，因此您不必像在 Java 中那样声明它们。

我想说的是，Delphi 不需要处理异常。它只会终止程序。EurekaLog 提供了记录已处理和未处理异常的方法，并提供了有关异常发生时程序状态的大量信息，包括异常发生的代码行和当时的调用堆栈。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-19T19:04:07.617

正如 Jim McKeeth 指出的那样，您无法得到明确的答案，但在我看来，可以通过一些静态分析来*部分*回答这个问题：给定一个特定的函数/过程，构建一个调用图。检查该调用图中的每个函数以获取 raise 语句。例如，这会告诉您 TIdTcpClient.ReadString 可以引发 EIdNotConnected （等等）。

聪明的分析者可能还会注意到某些代码使用 / 运算符并可能包含 EDivByZero，或者某些过程访问数组并包含 ERangeError。

这个答案比简单地寻找“加注”要严格一些。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-07T03:43:42.773

单元的终结部分也可以引发异常。我认为这些会溜走……而且也有些问题。

我认为 Delphi IDE 有一个内置的“堆栈跟踪”或“堆栈树”之类的东西。

这个问题让我想起了 Skybuck 的 TRussianRoulette 游戏……谷歌一下，它的代码和答案可能会有所帮助。

# php - 多个返回值来指示成功/失败。

> ID：72564
> 
> 赞同：5
> 
> 时间：2008-09-16T14:00:14.730
> 
> 标签：php

我有兴趣获得一些关于我从某个地方获得的这项技术的反馈。

当函数可以成功或失败时，我会使用它，但您想获得有关它失败原因的更多信息。做同样事情的标准方法是使用异常处理，但我经常发现这种事情有点过头了，而且 PHP4 不提供这个。

基本上，该技术涉及返回 true 表示成功，以及返回*false*表示*失败*。这是一个例子来说明我的意思：

```
define ('DUPLICATE_USERNAME', false);
define ('DATABASE_ERROR', 0);
define ('INSUFFICIENT_DETAILS', 0.0);
define ('OK', true);

function createUser($username) {
    // create the user and return the appropriate constant from the above
} 
```

这样做的美妙之处在于，在您的调用代码中，如果您不关心用户创建失败的原因，您可以编写简单易读的代码：

```
if (createUser('fred')) {
    // yay, it worked!
} else {
    // aww, it didn't work.
} 
```

如果您特别想检查它为什么不起作用（用于记录、向用户显示或做任何事情），请使用带有 === 的身份比较

```
$status = createUser('fred');
if ($status) {
    // yay, it worked!
} else if ($status === DUPLICATE_USERNAME) {
    // tell the user about it and get them to try again.
} else {
    // aww, it didn't work. log it and show a generic error message? whatever.
} 
```

在我看来，这样做的好处是，正常的预期是成功执行这样的函数会返回 true，而失败则返回 false。

缺点是你只能拥有`7 "error" return values: false, 0, 0.0, "0", null, "", and (object) null.`如果你忘记使用身份检查，你可能会让你的程序流程完全错误。其他人告诉我，使用像`enum`它们都等同于 false 的常量是`"ick"`.

* * *

所以，重申一下这个问题：这样的做法在多大程度上可以接受？你会推荐一种不同的方式来实现同样的事情吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T14:13:53.900

我同意其他人的观点，即这有点偏袒 WTFy。如果它有明确记录的功能，那么问题就不那么重要了，但我认为采取另一种方法更安全，即返回 0 表示成功，返回整数表示错误代码。如果您不喜欢这个想法或全局最后一个错误变量的想法，请考虑将您的函数重新定义为：

```
function createUser($username, &$error) 
```

然后你可以使用：

```
if (createUser('fred', $error)) {
    echo 'success';
}
else {
    echo $error;
} 
```

在 createUser 内部，只需使用您遇到的任何错误填充 $error，由于引用，它将可以在函数范围之外访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T14:02:01.260

只要它被记录和签约，而不是太WTFy，那么就不应该有问题。

再说一次，我建议对这样的事情使用异常。这更有意义。如果您可以使用 PHP5，那将是可行的方法。否则你没有太多选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T14:05:25.043

当异常不可用时，我看到的一种更常见的方法是将错误类型存储在某个地方的“last_error”变量中，然后在发生故障时（即它返回 false）查找错误。

另一种方法是使用古老的 unix 工具方法编号错误代码 - 成功返回 0 并为各种错误条件返回任何整数（映射到某些错误）。

然而，当我看到它们被使用时，其中大多数都与异常相比受到影响。

只是为了回应安德鲁的评论 - 我同意 last_error 不应该是全球性的，也许我的答案中的“某处”有点模糊 - 其他人已经建议了更好的地方，所以我不会费心重复它们

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T14:06:52.060

通常您会返回 0 表示成功，返回 1、2、3 等表示不同的失败。你这样做的方式有点老套，因为你只能有这么多的错误，而且这种编码迟早*会咬你。*

我喜欢定义一个结构/对象，其中包含一个表示成功的布尔值，一个错误消息或其他值表示发生了哪种错误。您还可以包含其他字段以指示执行了哪种操作。

这使得记录非常容易，因为您可以将状态结构传递给记录器，然后它将插入适当的日志条目。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T14:39:36.240

> 这样的做法有多可接受？

我会说这是不可接受的。

1.  需要 === 运算符，这是非常危险的。如果用户使用 ==，则会导致很难找到 bug。
2.  使用 "0" 和 "" 表示 false 可能会在未来的 PHP 版本中发生变化。加上在许多其他语言中，“0”和“”不会评估为假，这会导致很大的混乱

使用 getLastError() 类型的全局函数可能是 PHP 中的最佳实践，因为它*与语言很好地结合在一起*，因为 PHP 仍然主要是一种程序语言。我认为您刚才给出的方法的另一个问题是很少有其他系统可以像这样工作。程序员必须学习这种错误检查方式，这是错误的根源。最好让事情像大多数人期望的那样工作。

```
if ( makeClient() )
{ // happy scenario goes here }

else
{
    // error handling all goes inside this block
    switch ( getMakeClientError() )
    { case: // .. }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T14:43:59.257

当异常不可用时，我会使用[PEAR](http://en.wikipedia.org/wiki/PEAR)模型并在您的所有类中提供 isError() 功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T19:35:05.493

在这里重新发明轮子。使用正方形。

好的，PHP 4 中没有例外。欢迎来到 1982 年，看看 C。

你可以有错误代码。考虑负值，它们看起来更直观，因此您只需检查是否 (createUser() > 0)。

如果需要，您可以有一个错误日志，将错误消息（或只是任意错误代码）推送到一个数组中，然后进行优雅处理。

但是 PHP 是一种松散类型的语言是有原因的，并且抛出具有不同类型但评估为相同“假”的错误代码是不应该做的事情。

当您用完内置类型时会发生什么？

当你得到一个新的编码器并且必须解释这个东西是如何工作的时会发生什么？说，在 6 个月内，你不会记得了。

PHP === 运算符是否足够快以通过它？它比错误代码快吗？或任何其他方法？

扔掉它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T14:08:46.423

伊克。

在 Unix 预异常中，这是通过 errno 完成的。您返回 0 表示成功或 -1 表示失败，然后您可以使用整数错误代码检索一个值以获取实际错误。这适用于所有情况，因为您对错误代码的数量没有（实际）限制。INT_MAX肯定大于7，不用担心类型（errno）。

我投票反对问题中提出的解决方案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T14:22:23.537

如果你真的想做这种事情，你应该为每个错误设置不同的值，并检查是否成功。就像是

```
define ('OK', 0);
define ('DUPLICATE_USERNAME', 1);
define ('DATABASE_ERROR', 2);
define ('INSUFFICIENT_DETAILS', 3); 
```

并检查：

```
if (createUser('fred') == OK) {
    //OK

}
else {
    //Fail
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T14:29:27.763

成功执行返回 true 是有道理的。处理一般错误会容易得多：

```
if (!createUser($username)) {
// the dingo ate my user.
// deal with it.
} 
```

但是将意义与不同类型的错误联系起来根本没有意义。False 应该只表示一件事和一件事，而不管类型或编程语言如何处理它。如果您要定义错误状态常量，最好坚持使用 switch/case

```
define(DUPLICATE_USERNAME, 4)
define(USERNAME_NOT_ALPHANUM, 8)

switch ($status) {
case DUPLICATE_USERNAME:
  // sorry hun, there's someone else
  break;
case USERNAME_NOT_ALPHANUM:
  break;
default:
  // yay, it worked
} 
```

同样使用这种技术，您将能够按位 AND 和 OR 状态消息，因此您可以返回带有多个含义的状态消息，`DUPLICATE_USERNAME & USERNAME_NOT_ALPHANUM`并适当地对待它。这并不总是一个好主意，这取决于你如何使用它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T15:17:15.293

我喜欢 COM 可以同时处理异常和非异常调用者的方式。下面的示例显示了如何测试 HRESULT 并在失败的情况下引发异常。（通常在 tli 文件中自动生成）

```
inline _bstr_t IMyClass::GetName ( ) {
    BSTR _result;
    HRESULT _hr = get_name(&_result);
    if (FAILED(_hr)) _com_issue_errorex(_hr, this, __uuidof(this));
    return _bstr_t(_result, false);
} 
```

使用返回值会影响可读性，因为错误处理分散，最坏的情况是，代码永远不会检查返回值。这就是为什么我更喜欢违反合同时的例外情况。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T15:29:25.777

其他方式包括例外：

```
throw new Validation_Exception_SQLDuplicate("There's someone else, hun");), 
```

返回结构，

```
return new Result($status, $stuff);
if ($result->status == 0) {
    $stuff = $result->data;
}
else {
    die('Oh hell');
} 
```

我不想成为追随您使用您最初建议的代码模式的人。

我的意思是“追随你”，就像“在工作中跟随你并且不得不维护代码”而不是“追随你”“带着婚礼”，尽管两者都是选项。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-16T14:07:37.380

在我看来，只有当失败是你的方法/函数的“正常操作部分”时，你才应该使用这种技术。例如，调用成功的可能性与失败的可能性一样大。如果失败是一个异常事件，那么您应该使用异常处理，以便您的程序可以尽早且优雅地终止。

至于您使用不同的“假”值，我最好返回一个带有正确错误代码的自定义“结果”类的实例。就像是：

```
class Result
{
    var $_result;
    var $_errormsg;

    function Result($res, $error)
    {
       $this->_result = $res;
       $ths->_errorMsg = $error
    }

    function getResult()
    {
       return $this->_result;
    }

    function isError()
    {
       return ! ((boolean) $this->_result);
    }

    function getErrorMessage()
    {
       return $this->_errorMsg;
    } 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-09-16T14:09:47.170

查看 COM HRESULT 以获得正确的方法。

但例外情况通常更好。

更新：正确的方法是：定义尽可能多的错误值，而不仅仅是“假”的。使用 function succeeded() 检查函数是否成功。

```
if (succeeded(result = MyFunction()))
  ...
else
  ... 
```

# django - Django中的多连接查询

> ID：72568
> 
> 赞同：4
> 
> 时间：2008-09-16T14:00:53.963
> 
> 标签：django, orm, join

使用 ORM 和 QuerySet API 在 Django 中进行多连接查询的最佳和/或最快方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T15:05:54.540

If you are trying to join across tables linked by ForeignKeys or ManyToManyField relationships then you can use the double underscore syntax. For example if you have the following models:

```
class Foo(models.Model):
    name = models.CharField(max_length=255)

class FizzBuzz(models.Model):
    bleh = models.CharField(max_length=255)

class Bar(models.Model):
    foo = models.ForeignKey(Foo)
    fizzbuzz = models.ForeignKey(FizzBuzz) 
```

You can do something like:

```
Fizzbuzz.objects.filter(bar__foo__name = "Adrian") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T15:18:00.720

不要使用 API ;-) 说真的，如果您的 JOIN 很复杂，您应该会看到通过使用 SQL 而不是使用 API 来显着提高性能。这并不意味着您需要在漂亮的 Python 代码中使用肮脏的 SQL；只需制作一个自定义管理器来处理 JOIN，然后让其余代码使用它而不是直接使用 SQL。

另外，我刚刚在 DjangoCon 上，他们举办了一个关于高性能 Django 的研讨会，我从中学到的一个关键问题是，如果性能是一个真正的问题（并且你计划有一天会有大量的流量），你真的首先不应该做 JOIN，因为它们使你的应用程序在保持良好性能的同时扩展几乎是不可能的。

这是 Google 制作的演讲视频： [http ://www.youtube.com/watch?v=D-4UN4MkSyI&feature=PlayList&p=D415FAF806EC47A1&index=20](http://www.youtube.com/watch?v=D-4UN4MkSyI&feature=PlayList&p=D415FAF806EC47A1&index=20)

当然，如果您知道您的应用程序将永远不必处理这种扩展问题，请加入 :-) 如果您也不担心使用 API 对性能的影响，那么您真的不需要无需担心（AFAIK）使用一种 API 方法与另一种 API 方法之间的性能差异（如果有的话）。

只需使用： [http ://docs.djangoproject.com/en/dev/topics/db/queries/#lookups-that-span-relationships](http://docs.djangoproject.com/en/dev/topics/db/queries/#lookups-that-span-relationships)

希望有帮助（如果没有，希望一些真正的 Django 黑客可以介入并解释为什么方法 X 实际上确实有一些明显的性能差异）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T17:42:12.523

使用 queryset.query.join 方法，但前提是此处描述的其他方法（使用双下划线）不够用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-12T19:01:38.993

Caktus 博客对此有答案：http: [//www.caktusgroup.com/blog/2009/09/28/custom-joins-with-djangos-queryjoin/](http://www.caktusgroup.com/blog/2009/09/28/custom-joins-with-djangos-queryjoin/)

基本上有一个隐藏的 QuerySet.query.join 方法允许添加自定义连接。

# mfc - 您可以将 CMFCVisualManager 与基于对话框的应用程序一起使用吗？

> ID：72573
> 
> 赞同：4
> 
> 时间：2008-09-16T14:01:15.333
> 
> 标签：mfc, mfc-feature-pack

您可以将 CMFCVisualManager 与基于对话框的应用程序一起使用来更改应用程序的外观吗？如果是这样，它是如何完成的？

这个想法是使用随 MSVC 2008 发布的 MFC 功能包来更改控件的形状、颜色等，例如按钮。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T14:38:06.213

不，做不到，至少在您谈论 Feature Pack 版本时不能。BCGSoft 库的第 10 版确实具有此功能，例如参见：[http](http://www.bcgsoft.com/bcgcontrolbarpro-versions.htm) ://www.bcgsoft.com/bcgcontrolbarpro-versions.htm和[http://www.bcgsoft.com/images/SkinnedBuiltInDlgs.jpg](http://www.bcgsoft.com/images/SkinnedBuiltInDlgs.jpg)。MFC 功能包或多或少是 BCGSoft 库的先前版本，MS 从他们那里购买了许可证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-18T15:25:27.847

您需要将 Common Controls 清单添加到您的项目资源中。这是清单文件的代码：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
<assemblyIdentity
 version="1.0.0.0"
 processorArchitecture="X86"
 name="Program Name"
 type="win32"
/>
<description>Description of Program</description>
<dependency>
 <dependentAssembly>
 <assemblyIdentity
   type="win32"
   name="Microsoft.Windows.Common-Controls"
   version="6.0.0.0"
   processorArchitecture="X86"
   publicKeyToken="6595b64144ccf1df"
   language="*"
 />
 </dependentAssembly>
</dependency>
</assembly> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-23T16:31:29.880

`OnApplicationLook`我认为您可以通过在您的基础上实现一些 MFC 功能包功能`CDialog`（检查[此页面](http://www.codeguru.com/cpp/cpp/cpp_mfc/tutorials/print.php/c14929__2)上的第 4 步）。实现整个`OnApplicationLook`方法可能会更好，但您只需将其添加到以下内容即可测试您的应用程序`OnInitDialog`：

```
CMFCVisualManagerOffice2007::SetStyle(CMFCVisualManagerOffice2007::Office2007_Silver);
CMFCVisualManager::SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerOffice2007));
CDockingManager::SetDockingMode(DT_SMART);
RedrawWindow(NULL, NULL, RDW_ALLCHILDREN | RDW_INVALIDATE | RDW_UPDATENOW | RDW_FRAME | RDW_ERASE); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-15T08:53:10.417

这是启用视觉样式的最少代码量。您应该能够轻松地将 CDialog 弹出到框架中。IDR_MAINFRAME 是一个菜单资源。

```
class CMFCApplication2Dlg : public CFrameWndEx
{
    CMFCMenuBar bar;
public:
    CMFCApplication2Dlg() : CFrameWndEx()
    {
        LoadFrame(IDR_MAINFRAME);
        bar.Create(this);
    }
};

class CMFCApplication2App : public CWinAppEx
{
public:
    virtual BOOL InitInstance()
    {
        CWinAppEx::InitInstance();

        CMFCVisualManagerOffice2007::SetStyle(
            CMFCVisualManagerOffice2007::Office2007_ObsidianBlack);

        CMFCVisualManager::SetDefaultManager(
            RUNTIME_CLASS(CMFCVisualManagerOffice2007));

        SetRegistryKey(_T("Local AppWizard-Generated Applications"));

        m_pMainWnd = new CMFCApplication2Dlg();

        m_pMainWnd->ShowWindow(SW_SHOW);
        m_pMainWnd->UpdateWindow();

        return TRUE;
    }
};

CMFCApplication2App theApp; 
```

# c# - 使 C#/Winform 应用程序跨平台 - 我应该使用 AIR、Mono 还是其他？

> ID：72580
> 
> 赞同：6
> 
> 时间：2008-09-16T14:01:31.170
> 
> 标签：c#, winforms, cross-platform

我有一个用 C#/WinForms 编写的应用程序（[我的小应用程序](http://www.thekbase.com "知识库")）。为了使其跨平台，我正在考虑在 Adob​​e AIR 中重做它。是否有任何支持 WinForms 作为跨平台应用程序的论据？Winforms（例如，Mono 等）是否有跨平台的未来？对跨平台 UI 开发的建议？

我所说的跨平台是指目前的 Mac OSX、Windows 和 Linux。

这个问题又被[问了一遍，得到了更好的回答](https://stackoverflow.com/questions/116468/winforms-for-mono-on-mac-linux-and-pc-redux)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T14:05:11.987

就我在 Flex/AIR/Flash 动作脚本方面的经验而言，Adobe AIR 开发环境和编码/调试工具集目前远不如 Visual Studio 和 .NET SDK。用户界面工具集虽然优越。

但是由于*您已经有一个工作 C# 代码*，将其移植到 ActionScript 可能需要重新设计，因为 ActionScript 具有不同的思维/编程方式，它们使用不同的原始数据类型，例如，它们仅使用 a`Number`而不是`int float double`etc。与 VS IMO 相比，调试工具非常缺乏。

而且我听说[Mono 的 GtkSharp](http://www.mono-project.com/GtkSharp)是一个安静的平台。

但是，如果您不介意编码/调试工具问题，那么 AIR 是一个很棒的平台。我喜欢 Adob​​e 如何将 Flash 体验集成到其中，例如，您可以通过单击 Flash 影片剪辑中的按钮开始安装 AIR 应用程序，这种集成。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T06:06:19.753

> 我正在考虑在 Adob​​e AIR 中重做它

没有花太多时间在 AIR 上，我个人认为最好将 webapp 带到桌面并为其提供 shell 或在桌面上运行现有的 flash/flex 项目。

顺便说一句，如果您不了解 ActionScript，我的意思是它的细节、怪癖等，不要忘记考虑在谷歌上搜索答案所需的时间。

> 是否有任何支持 WinForms 作为跨平台应用程序的论据？Winforms（例如，Mono 等）是否有跨平台的未来？

总是很难预测会发生什么，但我知道至少有一个项目（Plastic SCM）在 Win、Mac 和 Linux 上使用 Mono Winforms，所以它肯定是可行的。但是，他们说他们从头开始构建了大部分控件（并声称他们希望将它们作为开源发布，但不确定是否或何时发布），因此您需要做一些工作以使事情看起来“漂亮” .

我在非 Windows 平台上玩过 Winforms，不幸的是，它并不完全“成熟”（尤其是在 Mac 上）。因此，您开箱即用的内容可能足以满足您的需求，也可能不足以满足您的需求。

如果您认为桌面应用程序不是提供跨平台解决方案的最佳方式，您始终可以使用 C# 编写的业务逻辑，并使用 ASP.NET 或使用 Silverlight 创建一个成熟的 web 应用程序，还有很多其他选择与 C# 一起存在。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T14:03:10.633

Mono 完全支持 WinForms，因此它们是跨平台的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T14:34:20.653

你为什么要选择Air？

使用[GTK#](http://www.mono-project.com/GtkSharp)，你有一个跨平台的表单引擎，你可以保留你的 C# 代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T14:03:31.787

好吧，我认为使用 C# 可靠地跨平台的唯一方法是[Microsoft Silverlight](http://www.silverlight.net)，但不是真正的 WinForms 和基于浏览器的。除此之外，是的，Mono 是一个机会。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T14:33:26.707

如果您想使用 .net 框架，Microsoft Silverlight 是一个不错的（唯一的？）选择。浏览器作为外壳做得很好，但您也可以为它编写自己的应用程序外壳。例如，Scott Handelman[提到](http://www.hanselman.com/blog/default.aspx?date=2008-09-05)了用 Silverlight 编写的 NY Times Reader 和 Mac 上的 Cocoa 上的 hostet。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T14:05:05.730

我认为 WinForms 根本没有未来。因为即使在 MSFT 世界中它似乎也是一个权宜之计（Win32 的一个非常薄的包装器）。在 .NET 3.0 和 3.5 中几乎没有对 System.Windows.Forms 进行任何更改

```
</speculation> 
```

我会使用 Java 或 Air。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-20T18:13:14.730

我认为，只要您确保您编写的业务逻辑代码是跨平台的（即在路径中使用反斜杠仅适用于 Windows - 正斜杠适用于所有操作系统），那么 Mono 运行未经修改的程序不会有重大问题WinForms 程序。只要确保您测试图形故障。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T18:16:47.953

上周我问了一个类似的问题。我一直在使用 Mono，并且在运行我编译到 IL 以在 SuSE linux（我通常运行 KDE）或 windows 上运行的应用程序时没有遇到任何问题，但是，我还没有出去并得到一个尚未测试的 mac它在。不过，我很快就会到，可能在几周后。但是 Mono 中的所有开发都非常擅长创建将在多个平台上运行的应用程序。

# sql - 临时表和 SQL SELECT 性能

> ID：72593
> 
> 赞同：4
> 
> 时间：2008-09-16T14:02:14.863
> 
> 标签：sql, performance

为什么使用带有 SELECT 语句的临时表会提高逻辑 I/O 计数？它不会增加对数据库的点击量而不是减少它。这是因为“问题”被分解成几个部分吗？我想知道幕后发生了什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T18:57:07.980

没有一般的答案。这取决于临时表的使用方式。

临时表可以通过缓存在批处理中多次使用的复杂过滤器/连接之后创建的行来减少 IO。这样，当只需要记录的子集时，数据库可以避免多次访问基表。

临时表可能会通过存储以后在查询中永远不会使用的记录来增加 IO，或者通过占用引擎缓存中本可以更好地被其他数据使用的大量空间来增加 IO。

创建一个临时表以使用其所有内容一次比在主查询中包含临时查询要慢，因为查询优化器无法看到临时表，并且它强制（可能）不必要的数据[假脱机](http://msdn.microsoft.com/en-us/library/ms181032.aspx)而不是允许它从源表流式传输。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T16:04:23.633

我将假设临时表是指 WHERE 子句中的子选择。（这称为半连接操作，您通常可以在查询的文本执行计划中看到它。）

当查询优化器遇到子选择/临时表时，它会对如何处理该数据做出一些假设。本质上，优化器将创建一个执行计划，对子选择的结果集执行连接，从而减少需要从其他表中读取的行数。由于行数较少，查询引擎能够从磁盘/内存中读取更少的页面并减少所需的 I/O 量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:04:58.447

AFAIK，至少对于 mysql，tmp 表保存在 RAM 中，这使得 SELECT 比任何命中 HD 的东西都快得多

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:53:26.473

有一类问题是在数据库端的集合结构中构建结果比将结果的部分返回给客户端、每个部分往返更可取。

例如：任意深度递归关系（boss of）

还有另一类查询问题，其中数据没有并且不会以使查询有效运行的方式被索引。将结果拉入可以以自定义方式索引的集合结构中，将减少这些查询的逻辑 IO。

# .net - 如何调用 .Net 程序集中嵌入资源的 exe？

> ID：72615
> 
> 赞同：4
> 
> 时间：2008-09-16T14:03:46.687
> 
> 标签：.net

我有一个非 .Net 可执行文件，它作为嵌入式资源包含在我的 .net 程序集中。有没有办法运行这个可执行文件而不涉及将其写入磁盘并启动它？

这是.Net 2.0。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T14:15:07.143

[您可以使用Assembly.Load](http://msdn.microsoft.com/en-us/library/twt16z2x.aspx)的重载从字节数组加载 .NET 程序集。

但是，需要考虑安全模型的一些含义，这会使事情变得更加复杂。[请参阅此处](http://blogs.msdn.com/shawnfa/archive/2007/04/18/loading-an-assembly-as-a-byte-array.aspx)的讨论，以及此[线程](https://web.archive.org/web/20160513112857/http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.framework.clr/2006-08/msg00069.html)。

如果您的嵌入式可执行文件不是 .NET，那么我认为您必须先将其写入磁盘。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T03:18:13.080

您可能会尝试将您的 exe 注入暂停的进程，然后唤醒被劫持的进程，但这似乎是灾难的根源。

# c++ - 在 C++ 程序中嵌入数据

> ID：72616
> 
> 赞同：17
> 
> 时间：2008-09-16T14:03:58.277
> 
> 标签：c++, linux, sqlite

我有一个使用 SQLite 的 C++ 程序。我想将 SQL 查询存储在一个单独的文件中——一个纯文本文件，*而不是*源代码文件——但将该文件像资源一样嵌入到可执行文件中。

（这必须在 Linux 上运行，所以据我所知，我不能将它存储为实际资源，但如果它适用于 Windows，那将是完美的。）

有什么简单的方法可以做到这一点，或者它会有效地要求我为 Linux 编写自己的资源系统吗？（很容易，但需要更长的时间。）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-16T14:17:44.077

您可以使用 objcopy 将文件的内容绑定到您的程序可以使用的符号。例如，请参阅[此处](http://www.linuxjournal.com/content/embedding-file-executable-aka-hello-world-version-5967)了解更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T14:11:27.633

使用宏。从技术上讲，该文件将是*源代码*文件，但看起来不像这样。例子：

```
//queries.incl - SQL queries
Q(SELECT * FROM Users)
Q(INSERT [a] INTO Accounts)

//source.cpp
#define Q(query) #query,
char * queries[] = {
#include "queries.incl"
};
#undef Q 
```

稍后您可以通过同一个文件对该文件进行各种其他处理，例如您想要拥有它们的数组和哈希映射，您可以重新定义 Q 来完成另一项工作并完成它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T14:12:52.357

您始终可以编写一个小程序或脚本来将文本文件转换为头文件，并将其作为构建过程的一部分运行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T15:34:59.633

这是我们用于跨平台嵌入文件的示例。这很简单，但可能对你有用。

您可能还需要更改它在 escapeLine 函数中处理换行符的方式。

```
#include <string>
#include <iostream>
#include <fstream>
#include <cstdio>

using namespace std;

std::string escapeLine( std::string orig )
{
    string retme;
    for (unsigned int i=0; i<orig.size(); i++)
    {
        switch (orig[i])
        {
        case '\\':
            retme += "\\\\";
            break;
        case '"':
            retme += "\\\"";
            break;
        case '\n': // Strip out the final linefeed.
            break;
        default:
            retme += orig[i];
        }
    }
    retme += "\\n"; // Add an escaped linefeed to the escaped string.
    return retme;
}

int main( int argc, char ** argv )
{
    string filenamein, filenameout;

    if ( argc > 1 )
        filenamein = argv[ 1 ];
    else
    {
        // Not enough arguments
        fprintf( stderr, "Usage: %s <file to convert.mel> [ <output file name.mel> ]\n", argv[0] );
        exit( -1 );
    }

    if ( argc > 2 )
        filenameout = argv[ 2 ];
    else
    {
        string new_ending = "_mel.h";
        filenameout = filenamein;
        std::string::size_type pos;
        pos = filenameout.find( ".mel" );
        if (pos == std::string::npos)
            filenameout += new_ending;
        else
            filenameout.replace( pos, new_ending.size(), new_ending );
    }

    printf( "Converting \"%s\" to \"%s\"\n", filenamein.c_str(), filenameout.c_str() );

    ifstream filein( filenamein.c_str(), ios::in );
    ofstream fileout( filenameout.c_str(), ios::out );

    if (!filein.good())
    {
        fprintf( stderr, "Unable to open input file %s\n", filenamein.c_str() );
        exit( -2 );
    }
    if (!fileout.good())
    {
        fprintf( stderr, "Unable to open output file %s\n", filenameout.c_str() );
        exit( -3 );
    }

    // Write the file.
    fileout << "tempstr = ";

    while( filein.good() )
    {
        string buff;
        if ( getline( filein, buff ) )
        {
            fileout << "\"" << escapeLine( buff ) << "\"" << endl;
        }
    }

    fileout << ";" << endl;

    filein.close();
    fileout.close();

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T14:12:00.613

它有点难看，但你总是可以使用类似的东西：

```
常量字符 *query_foo =
#include "query_foo.txt"

常量字符 *query_bar =
#include "query_bar.txt"

```

其中 query_foo.txt 将包含引用的查询文本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T14:15:31.290

我已经看到这是通过将资源文件转换为 C 源文件来完成的，该文件只定义了一个包含十六进制格式的资源文件内容的 char 数组（以避免恶意字符的问题）。然后简单地编译这个自动生成的源文件并将其链接到项目。

实现转换器来为每个资源文件转储 C 文件应该很容易，也应该很容易编写一些外观函数来访问资源。

# list - SharePoint 内容查询 Web 部件

> ID：72624
> 
> 赞同：2
> 
> 时间：2008-09-16T14:04:30.757
> 
> 标签：list, sharepoint, moss

我有一个内容查询 Web 部件，它按内容类型对网站集进行查询。我已按内容类型对其进行分组，因此我有：

```
-- Agenda (Content Type)
----Agenda #1
----Agenda #2
-- Report (Content Type)
----Report #1
----Report #2 
```

我想显示站点的第二个分组，所以：

```
-- Agenda (Content Type)
----This Site
------Agenda #1
----That Site
------Agenda #2
-- Report (Content Type)
----This Site
------Report #1
------Report #2 
```

有谁知道实现这一目标的最佳方法？

所有最好的基兰

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T21:09:42.403

您拥有更改内容查询 Web 部件的 xslt 的完全访问权限。我建议导出 Web 部件，将内联 xslt 保存到样式库中，并将 Web 部件从使用内联 xslt 更改为使用样式库中文件的链接。这允许您使用更容易的共享点设计器编辑 xslt 文件。

# c# - 使用独立存储时“找不到文件”

> ID：72626
> 
> 赞同：5
> 
> 时间：2008-09-16T14:04:41.193
> 
> 标签：c#, .net

我将东西保存在一个独立的[存储](http://msdn.microsoft.com/en-us/library/3ak841sy.aspx)文件中（使用类 IsolatedStorageFile）。[它运行良好，当我从 GUI 层调用DAL](http://en.wikipedia.org/wiki/Data_access_layer)层中的保存和检索方法时，我可以检索保存的值。但是，当我尝试从同一项目中的另一个程序集中检索相同的设置时，它给了我一个 FileNotFoundException。我做错了什么？这是一般概念：

```
 public void Save(int number)
    {
        IsolatedStorageFile storage = IsolatedStorageFile.GetMachineStoreForAssembly();
        IsolatedStorageFileStream fileStream =
            new IsolatedStorageFileStream(filename, FileMode.OpenOrCreate, storage);

        StreamWriter writer = new StreamWriter(fileStream);
        writer.WriteLine(number);
        writer.Close();
    }

    public int Retrieve()
    {
        IsolatedStorageFile storage = IsolatedStorageFile.GetMachineStoreForAssembly();
        IsolatedStorageFileStream fileStream = new IsolatedStorageFileStream(filename, FileMode.Open, storage);

        StreamReader reader = new StreamReader(fileStream);

        int number;

        try
        {
            string line = reader.ReadLine();
            number = int.Parse(line);
        }
        finally
        {
            reader.Close();
        }

        return number;
    } 
```

我已经尝试使用所有 GetMachineStoreFor* 范围。

编辑：由于我需要几个程序集来访问文件，因此似乎不可能使用隔离存储，除非它是[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)应用程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T14:14:44.100

当您实例化 IsolatedStorageFile 时，您是否将其范围限定为 IsolatedStorageScope.Machine？

好的，现在你已经说明了你的代码风格，我已经回去重新测试方法的行为，这里是解释：

*   GetMachineStoreForAssembly() - 范围为机器和程序集标识。同一应用程序中的不同程序集将具有自己的隔离存储。
*   GetMachineStoreForDomain() - 在我看来是用词不当。*范围限定在程序集标识之上*的机器和域标识。应该有一个仅适用于 AppDomain 的选项。
*   GetMachineStoreForApplication() - 这是你要找的。我已经对其进行了测试，不同的程序集可以获取写入另一个程序集的值。唯一的问题是，*应用程序身份*必须是可验证的。在本地运行时，无法正确确定，最终会出现“无法确定调用者的应用程序身份”异常。可以通过 Click Once 部署应用程序来验证。只有这样，这种方法才能应用并达到共享隔离存储的预期效果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T15:11:55.850

保存时调用 GetMachineStoreForDomain，但检索时调用 GetMachineStoreForAssembly。

GetMachineStoreForAssembly 的范围是代码正在执行的程序集，而 GetMachineStoreForDomain 的范围是当前运行的 AppDomain 和代码正在执行的程序集。只需将这些调用更改为 GetMachineStoreForApplication，它应该可以工作。

可以在[http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragefile_members.aspx找到有关 IsolatedStorageFile 的文档](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragefile_members.aspx)

# php - 在非 Windows 机器上使用 php 处理所有版本的 MS Excel 电子表格的最佳方法是什么

> ID：72639
> 
> 赞同：1
> 
> 时间：2008-09-16T14:05:39.880
> 
> 标签：php, import-from-excel

我正在将 MS Excel 电子表格中的数据导入 php/mySQL 应用程序。几个不同的团体提供电子表格，它们的格式从 Excel 4.0 到 Excel 2007。麻烦在于找到一种技术来阅读所有版本。

更多信息：

```
 - I am currently using php-ExcelReader. 
  - A script in a language other than php that can convert Excel to CSV would be an acceptable solution. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T14:08:59.620

根据数据的性质和上传 excel 文件的各方，您可能需要考虑让他们以 .csv 格式保存数据。最终解析会容易得多。

假设这不是一个选项，一个快速的谷歌搜索出现了[http://sourceforge.net/projects/phpexcelreader/](http://sourceforge.net/projects/phpexcelreader/)这可能适合您的需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:32:00.723

开源 ETL 工具 Talend ( [http://www.talend.com](http://wwww.talend.com) ) 将生成 Java 或 Perl 代码，并将这些代码与必要的第 3 方库一起打包。

Talend 应该能够处理所有版本的 Excel 并以您需要的任何格式输出结果集（包括在需要时将其直接加载到数据库中）。

# .net-3.5 - 我应该在 WF 中使用状态机还是序列工作流？

> ID：72667
> 
> 赞同：2
> 
> 时间：2008-09-16T14:08:49.763
> 
> 标签：.net-3.5, com, interop, workflow, business-process-management

作为配置管理职责的一部分，我每周都会执行一个可重复的业务流程。流程没有改变：我将更改详细信息下载到 Excel，打开电子表格并基于宏复制详细信息，从议程模板创建 Word 文档，使用 Excel 数据更新议程，从 Word 文档创建 PDF，以及给他们发电子邮件。

这个过程很容易在序列工作流中表示，这就是我到目前为止的方式，使用 COM 自动化来自动处理 Excel 和 Word 片段。齿轮的扳手是在“创建议程”和“发送它”之间有一个人为的步骤，在其中我审查更改细节并制定有关它们的问题，这些问题被添加到议程中。我目前有一个暂停活动来暂停工作流程，同时我手动执行这部分流程。

我的问题是，我应该重写我的工作流程，使其成为一个状态机，以遵循业务流程中人机交互的最佳实践，还是暂停活动是一个合理的解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T14:29:44.890

不，我认为您不必为此工作流程使用状态机。但是，我建议更改暂停活动，因为：

> SuspendActivity 活动暂时停止当前工作流的执行。通常，您使用 SuspendActivity 活动来反映需要管理员注意的错误情况。
> 
> 当工作流实例被挂起时，会记录一个错误。您可以指定伴随错误的消息字符串，以帮助管理员使用 SuspendActivity Error 属性诊断问题。暂停的工作流实例仍然可以接收排队的消息，直到重新启动工作流。工作流实例的所有状态信息都会保存并在实例恢复时恢复（使用 Resume）。
> 
> *资料来源：[MSDN](http://msdn.microsoft.com/en-us/library/ms735708.aspx)*

在工作流（序列或状态机）中添加人工任务的典型方法是定义外部数据交换接口并使用 HandleExternalEvent 活动（可能还有 CallExternalMethod 活动）。有关详细信息，请参阅以下文章：

*   [使用 Windows Workflow Foundation 构建状态机](http://msdn.microsoft.com/en-us/magazine/cc163281.aspx)
*   [使用 Windows Workflow Foundation 的简单人工工作流](http://msdn.microsoft.com/en-us/library/aa480178.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T14:31:42.330

更新：Panos 对暂停活动提出了一个很好的观点。我同意它在工作流自动机中有不同的用途。

如果您觉得您更担心各种状态之间的工作流转换，那么状态机工作流是理想的选择。否则，顺序就好了。

您应该尝试解决的主要问题是工作流在等待人工交互（线程敏捷性）时不应占用线程。如果工作流在此期间处于空闲状态并持续存在（例如使用[SqlWorkflowPersistenceService](http://wiki.windowsworkflowfoundation.eu/default.aspx/WF/SqlWorkflowPersistenceService.html)），则应该不是问题。

# windows - 如何使用带有路径的“开始”和带有空格的命令在 Windows 中创建批处理文件

> ID：72671
> 
> 赞同：78
> 
> 时间：2008-09-16T14:09:28.950
> 
> 标签：windows, batch-file, scripting

我需要创建一个批处理文件，它在 Windows .cmd 文件中启动多个控制台应用程序。这可以使用启动命令来完成。

但是，该命令中有一条路径。我还需要传递也有空格的参数。这该怎么做？

例如批处理文件

```
start "c:\path with spaces\app.exe" param1 "param with spaces" 
```

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2008-09-16T14:18:17.663

实际上，他的例子是行不通的（虽然一开始我也认为它会）。根据 Start 命令的帮助，第一个参数是新创建的命令提示符窗口的名称，第二个和第三个应该分别是应用程序及其参数的路径。如果您在应用程序的路径之前添加另一个“”，它应该可以工作（至少它对我有用）。使用这样的东西：

```
start "" "c:\path with spaces\app.exe" param1 "param with spaces" 
```

您可以将第一个参数更改为您希望新命令提示符的标题。如果是创建的 Windows 应用程序，则不会显示命令提示符，标题也无关紧要。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-16T14:16:13.207

用撇号转义路径是正确的，但是 start 命令需要一个包含新窗口标题的参数。此参数由周围的撇号检测，因此您的应用程序不会被执行。

尝试这样的事情：

```
start "Dummy Title" "c:\path with spaces\app.exe" param1 "param with spaces" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-04-18T08:24:46.200

```
start "" "c:\path with spaces\app.exe" "C:\path parameter\param.exe" 
```

当我使用上述建议时，我得到了：

> 'c:\path' 不是内部或外部命令、可运行程序或批处理文件。

我认为第二个引号会阻止命令运行。在下面的解决方案中进行一些搜索后，可以节省我的时间：

```
start "" CALL "c:\path with spaces\app.exe" "C:\path parameter\param.exe" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-15T10:50:16.330

有趣的是，在 Windows Embedded Compact 7 中，您似乎无法指定标题字符串。第一个参数必须是命令或程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-05T11:31:24.103

你要使用这样的东西：

> 开始 /d C:\Windows\System32\calc.exe
> 
> 开始 /d "C:\Program Files\Mozilla
> 
> 火狐" firefox.exe 启动 /d
> 
> “C:\程序文件\微软
> 
> Office\Office12" EXCEL.EXE

我还建议您使用特殊的批处理文件编辑器 - [Dr.Batcher](http://www.drbatcher.com)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-16T14:13:33.043

如您的示例中那样，用引号内的空格包围路径和参数。该命令可能需要在将参数传递给它时处理引号，但这通常没什么大不了的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-10-11T10:58:14.103

我研究成功，对我来说效果很好。我的要求是使用需要从 Windows 中的批处理文件调用的 vbscript 发送电子邮件。这是我正在使用的确切命令，没有错误。

```
START C:\Windows\System32\cscript.exe "C:\Documents and Settings\akapoor\Desktop\Mail.vbs" 
```

# delphi - Delphi中是否有*SysUtils.Format*的反函数

> ID：72672
> 
> 赞同：10
> 
> 时间：2008-09-16T14:09:38.590
> 
> 标签：delphi, function, scanf

有没有人为 Delphi 编写过“UnFormat”例程？

我想象的是*SysUtils.Format的**倒数*，看起来像这样

 *UnFormat('一个数字 %n 和另一个 %n',[float1, float2]);

因此，您可以使用格式字符串将字符串解压缩为一系列变量。

我已经查看了 SysUtils 中的“格式”例程，但我从未使用过汇编，所以它对我来说毫无意义。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T14:12:51.780

这在 C 中称为 scanf，我为此做了一个类似于 Delphi 的：

```
function ScanFormat(const Input, Format: string; Args: array of Pointer): Integer;
var
  InputOffset: Integer;
  FormatOffset: Integer;
  InputChar: Char;
  FormatChar: Char;

  function _GetInputChar: Char;
  begin
    if InputOffset <= Length(Input) then
    begin
      Result := Input[InputOffset];
      Inc(InputOffset);
    end
    else
      Result := #0;
  end;

  function _PeekFormatChar: Char;
  begin
    if FormatOffset <= Length(Format) then
      Result := Format[FormatOffset]
    else
      Result := #0;
  end;

  function _GetFormatChar: Char;
  begin
    Result := _PeekFormatChar;
    if Result <> #0 then
      Inc(FormatOffset);
  end;

  function _ScanInputString(const Arg: Pointer = nil): string;
  var
    EndChar: Char;
  begin
    Result := '';
    EndChar := _PeekFormatChar;
    InputChar := _GetInputChar;
    while (InputChar > ' ')
      and (InputChar <> EndChar) do
    begin
      Result := Result + InputChar;
      InputChar := _GetInputChar;
    end;

    if InputChar <> #0 then
      Dec(InputOffset);

    if Assigned(Arg) then
      PString(Arg)^ := Result;
  end;

  function _ScanInputInteger(const Arg: Pointer): Boolean;
  var
    Value: string;
  begin
    Value := _ScanInputString;
    Result := TryStrToInt(Value, {out} PInteger(Arg)^);
  end;

  procedure _Raise;
  begin
    raise EConvertError.CreateFmt('Unknown ScanFormat character : "%s"!', [FormatChar]);
  end;

begin
  Result := 0;
  InputOffset := 1;
  FormatOffset := 1;
  FormatChar := _GetFormatChar;
  while FormatChar <> #0 do
  begin
    if FormatChar <> '%' then
    begin
      InputChar := _GetInputChar;
      if (InputChar = #0)
      or (FormatChar <> InputChar) then
        Exit;
    end
    else
    begin
      FormatChar := _GetFormatChar;
      case FormatChar of
        '%':
          if _GetInputChar <> '%' then
            Exit;
        's':
          begin
            _ScanInputString(Args[Result]);
            Inc(Result);
          end;
        'd', 'u':
          begin
            if not _ScanInputInteger(Args[Result]) then
              Exit;

            Inc(Result);
          end;
      else
        _Raise;
      end;
    end;

    FormatChar := _GetFormatChar;
  end;
end; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T20:23:55.477

我知道它往往会吓到人们，但是您可以使用正则表达式编写一个简单的函数来执行此操作

```
'a number (.*?) and another (.*?) 
```

如果您担心 reg 表达式，请访问[www.regexbuddy.com](http://www.regexbuddy.com)，您将永远不会回头。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T15:43:14.793

我倾向于使用简单的解析器来处理这个问题。我有两个函数，一个称为 NumStringParts ，它返回具有特定分隔符的字符串中“部分”的数量（在您的情况下，在空格上方），GetStrPart 从具有特定分隔符的字符串中返回特定部分。自从我的 Turbo Pascal 时代以来，这两个例程都已在许多项目中使用。

```
function NumStringParts(SourceStr,Delimiter:String):Integer;
var
  offset : integer;
  curnum : integer;
begin
  curnum := 1;
  offset := 1;
  while (offset <> 0) do
    begin
      Offset := Pos(Delimiter,SourceStr);
      if Offset <> 0 then
        begin
          Inc(CurNum);
            Delete(SourceStr,1,(Offset-1)+Length(Delimiter));
        end;
    end;
  result := CurNum;
end;

function GetStringPart(SourceStr,Delimiter:String;Num:Integer):string;
var
  offset : integer;
  CurNum : integer;
  CurPart : String;
begin
  CurNum := 1;
  Offset := 1;
  While (CurNum <= Num) and (Offset <> 0) do
    begin
      Offset := Pos(Delimiter,SourceStr);
      if Offset <> 0 then
        begin
          CurPart := Copy(SourceStr,1,Offset-1);
          Delete(SourceStr,1,(Offset-1)+Length(Delimiter));
          Inc(CurNum)
        end
      else
        CurPart := SourceStr;
    end;
  if CurNum >= Num then
    Result := CurPart
  else
    Result := '';
end; 
```

使用示例：

```
 var
    st : string;
    f1,f2 : double; 
  begin
     st := 'a number 12.35 and another 13.415';
     ShowMessage('Total String parts = '+IntToStr(NumStringParts(st,#32)));
     f1 := StrToFloatDef(GetStringPart(st,#32,3),0.0);
     f2 := StrToFloatDef(GetStringPart(st,#32,6),0.0);
     ShowMessage('Float 1 = '+FloatToStr(F1)+' and Float 2 = '+FloatToStr(F2)); 
  end; 
```

这些例程也适用于简单或严格的逗号分隔字符串。这些例程在 Delphi 2009/2010 中运行良好。

# algorithm - 如何从字符串中删除这些符号（垃圾）？

> ID：72677
> 
> 赞同：1
> 
> 时间：2008-09-16T14:10:07.170
> 
> 标签：algorithm, string, unicode

想象一下我在 C# 中有字符串：“我没看到你……”

我想删除（替换为无等）这些“Ã¢â‚¬â„¢”符号。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T15:01:26.890

那个“垃圾”看起来很像有人将 UTF-8 数据解释为 ISO 8859-1 或 Windows-1252，可能会重复。

¢ 是序列 C3 A2、E2 82 AC、E2 84 A2。

*   UTF-8 C3 A2 = U+00E2 = â
*   UTF-8 E2 82 AC = U+20AC = €</li>
*   UTF-8 E2 84 A2 = U+2122 = ™</li>

然后我们再做一次：在 Windows 1252 中，这个序列是 E2 80 99，所以字符应该是 U+2019，右单引号 (')

您可以使用字节数组、Encoding.UTF8 和 Encoding.GetEncoding(1252) 进行多次传递，以正确地将垃圾变回最初输入的内容。您将需要检查您的处理以找到 UTF-8 数据被错误地解释为 Windows-1252 的两个地方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T14:16:20.273

```
"I DonÃ¢â‚¬â„¢t see ya..".Replace( "Ã¢â‚¬â„¢", string.Empty); 
```

那个垃圾是怎么进来的？这才是真正的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T14:33:30.513

通过删除任何非拉丁字符，您将故意破坏一些国际化支持。

别忘了那个名字里有一个“â”的可怜人。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T14:29:58.417

对于处理使用标准字符编码存储在数据库中的 Windows 字符集的字符编码问题，这看起来令人不安地熟悉。我看到有人投票否决了威尔，但他说得有道理。您可能正在解决眼前的问题，但如果这是问题，字符组合是无限的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T14:34:47.220

如果你真的必须这样做，正则表达式可能是最好的解决方案。

不过，我强烈建议您考虑一下为什么必须这样做 - 至少您列出的某些不受欢迎的字符在其他语言中是完全有效且有用的，并且仅将它们过滤掉很可能会惹恼您的某些人国际用户。作为一个瑞典人，我无法强调我多么*讨厌*无法正确处理我们的 å、ä 和 ö 字符的系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T14:15:35.457

考虑 Regex.Replace(your_string, regex, "") - 这就是我使用的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T14:16:49.947

依次测试每个字符以查看它是否是有效的字母或数字字符，如果不是，则将其从字符串中删除。性格测试很简单，用...

```
char.IsLetterOrDigit; 
```

请还有其他各种，例如...

```
char.IsSymbol;
char.IsControl; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T15:29:18.243

Regex.Replace("字符串", "[^a-zA-Z ]","");

这就是您在 C# 中的做法，尽管该正则表达式 ([^a-zA-Z ]) 应该适用于大多数语言。

[编辑：忘记了正则表达式中的空格]

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T14:11:52.780

这些字符的 ASCII / 整数代码将超出正常的字母范围。查找并替换为空字符。我相信 String 有一个 Replace 方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T14:23:05.610

要么使用您不想要的东西的黑名单，要么最好使用白名单（设置）。使用白名单，您可以遍历字符串并仅将白名单中的字母复制到结果字符串中。你说删除，你这样做的方式是有两个指针，一个从 (R) 读取，一个从 (W) 写入：

```
I DonÃ¢â‚
     W  R 
```

如果逗号在您的白名单中，那么在这种情况下，您将读取逗号并将其写入 Ã 的位置，然后将两个指针都推进。UTF-8 是一种多字节编码，因此您推进指针可能不仅仅是添加到地址。

使用 C 语言是一种通过使用预定义函数（或宏）之一来获取白名单的简单方法：isalnum、isalpha、isascii、isblank、iscntrl、isdigit、isgraph、islower、isprint、ispunct、isspace、isupper、isxdigit。在这种情况下，您发送的是一个白名单功能而不是一组课程。

通常当我看到像你这样的数据时，我会寻找内存损坏，或者有证据表明我期望的编码与输入数据时使用的编码不同。

/艾伦

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-05-07T12:32:29.473

如果 String 有任何垃圾日期，这很好地删除那些垃圾日期

```
 string InputString = "This is grate kingdom¢Ã‚¬â"; 
     string replace = "Ã¢â‚¬â„¢";
     string OutputString= Regex.Replace(InputString, replace, "");

     //OutputString having the following result 
```

它对我很好，感谢您查看此评论。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-11-25T18:38:33.913

adobe 在 EXIF 转储中抛出的无关垃圾也有同样的问题。我花了一个小时寻找一个直接的答案，并尝试了许多在这里不起作用的半生不熟的建议。

这个帖子比我读过的大多数帖子都充满了深刻的探索性问题，例如“它是如何到达那里的？”、“如果有人名字中有这个字符怎么办？”、“你确定要打破国际化吗？”。

有一些令人印象深刻的博学展示，假设这些垃圾是如何到达这里的，并解释了各种字符编码方案的演变。这个人想知道如何删除它，而不是它是如何产生的或组织的标准是什么，尽管这个琐事可能很有趣。

我写了一个小程序，它给了我正确的答案。这里没有解释主要概念，而是完整的、独立的、工作的（至少在我的系统上）程序和我用来核对垃圾的输出：

```
#!/usr/local/bin/perl -w

# This runs in a dos window and shows the char, integer and hex values
# for the weird chars. Install the HEX values in the REGEXP below until
# the final test line looks normal. 
$str = 's: â€œBrian';  # Nuke the 3 werid chars in front of Brian.
@str = split(//, $str);
printf("len str '$str' = %d, scalar \@str = %d\n", 
    length $str, scalar @str);
$ii = -1;
foreach $c (@str)  {
   $ii++;
   printf("$ii) char '$c', ord=%03d, hex='%s'\n", 
       ord($c), unpack("H*", $c));
}
# Take the hex characters shown above, plug them into the below regexp
# until the junk disappears!
($s2 = $str) =~ s/[\xE2\x80\x9C]//g;  # << Insert HEX values HERE
print("S2=>$s2<\n");  # Final test

Result:
M:\new\6s-2014.1031-nef.halloween>nuke_junk.pl
len str 's: GÇ£Brian' = 11, scalar @str = 11
0) char 's', ord=115, hex='73'
1) char ':', ord=058, hex='3a'
2) char ' ', ord=032, hex='20'
3) char 'G', ord=226, hex='e2'
4) char 'Ç', ord=128, hex='80'
5) char '£', ord=156, hex='9c'
6) char 'B', ord=066, hex='42'
7) char 'r', ord=114, hex='72'
8) char 'i', ord=105, hex='69'
9) char 'a', ord=097, hex='61'
10) char 'n', ord=110, hex='6e'
S2=>s: Brian< 
```

这是正常的！！！

One other actionable, working suggestion I ran across: iconv -c -t ASCII < 6s-2014.1031-238246.halloween.exf.dif > exf.ascii.dif

# design-patterns - 这种反模式/代码气味有名称吗？

> ID：72682
> 
> 赞同：19
> 
> 时间：2008-09-16T14:10:30.087
> 
> 标签：design-patterns, anti-patterns

首先让我说我不提倡这种方法，但我最近看到了它，我想知道是否有一个名字可以用来指出有罪的一方。所以这里。

现在你有了一个方法，你想返回一个值。您*还想*返回错误代码。当然，异常是更好的选择，但无论出于何种原因，您都需要一个错误代码。记住，我在这里扮演魔鬼的拥护者。因此，您创建了一个通用类，如下所示：

```
class FunctionResult<T>
{
    public T payload;
    public int result;
} 
```

然后像这样声明你的函数：

```
FunctionResult<string> MyFunction()
{
    FunctionResult<string> result;
    //...

    return result;
} 
```

此模式的一种变体是使用枚举作为错误代码而不是字符串。现在，回到我的问题：有这个名字吗？如果有，它是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-16T14:29:08.450

我同意这不是专门的反模式。根据使用情况，它可能是一种气味。人们实际上不想使用异常是有原因的（例如，对于初学者来说，返回的错误不是“异常的”）。

在某些情况下，您希望服务返回其结果的通用模型，包括错误和良好值。这可能由将结果转换为异常或其他错误结构的低级别服务交互包装，但在服务级别，它允许服务返回结果和状态代码，而无需定义一些可能的异常结构必须跨越远程边界进行翻译。

此代码也不一定是错误：考虑一个 HTTP 响应，它包含许多不同的数据，包括状态代码以及响应的主体。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-16T14:22:29.247

它被称为“[用异常替换错误代码](http://www.refactoring.com/catalog/replaceErrorCodeWithException.html)”

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-16T14:23:16.623

好吧，这*不是*反模式。C++ 标准库利用了这一特性，.NET 甚至`FunctionResult`在 .NET 框架中提供了一个特殊的类。它被称为`Nullable`。是的，这不限于函数结果，但它可以用于这种情况，实际上在这里非常有用。如果 .NET 1.0 已经有了这个`Nullable`类，那么它肯定会被用于`NumberType.TryParse`方法，而不是`out`参数。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-16T14:28:13.133

我通常将有效负载作为（而不是 const）引用传递，并将错误代码作为返回值传递。

我是游戏开发者，我们排除异常

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-16T14:36:59.837

Konrad 是对的，C# 一直使用双重返回值。但我有点喜欢 C# 中的 TryParse、Dictionary.TryGetValue 等方法。

```
int value;
if (int.TryParse("123", out value)) {
    // use value
} 
```

代替

```
int? value = int.TryParse("123");
if (value != null) {
    // use value
} 
```

...主要是因为 Nullable 模式不能扩展到非值返回类型（即类实例）。这不适用于 Dictionary.TryGetValue()。并且 TryGetValue 比 KeyNotFoundException 更好（在调试器中没有“第一次机会异常”，可以说更有效），比 Java 的 get() 返回 null 的实践更好（如果预期 null 值怎么办），并且比必须更有效首先调用 ContainsKey()。

但这*仍然*有点麻烦——因为这看起来像 C#，所以它应该使用一个 out 参数。实例化类可能会丢失所有效率增益。

（可以是 Java，除了“字符串”类型是小写的。在 Java 中，你当然必须使用一个类来模拟双重返回值。）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T14:19:34.433

我不确定这是一个反模式。出于性能原因，或者可能使该方法可能失败的事实更加明确，我经常看到使用它而不是异常。对我来说，这似乎是个人偏好而不是反模式。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-16T15:39:02.243

我同意那些说这不是反模式的人的观点。在某些情况下，它是一种完全有效的模式。例外是针对*例外*情况，应在预期情况下使用返回值（如您的示例中）。一些领域期望类的有效和无效结果，并且这些都不应该被建模为异常。

例如，给定 X 油量，汽车可以从 A 到 B，如果可以，还剩下多少油？这种问题非常适合您提供的数据结构。预计无法从 A 到 B，因此不应使用例外。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-16T14:26:18.817

这种方法实际上比我见过的其他方法要好得多。例如，C 中的某些函数在遇到错误时会返回并且似乎成功了。判断它们失败的唯一方法是调用将获得最新错误的函数。

在我终于发现 sem_init 在 OSX 上不起作用之前，我花了几个小时试图在我的 MacBook 上调试信号量代码！它编译没有错误，运行也没有导致任何错误——但信号量不起作用，我不知道为什么。[我很同情那些将使用POSIX 信号量](http://www.csc.villanova.edu/~mdamian/threads/posixsem.html)的应用程序移植到 OSX 并且必须处理已经调试过的资源争用问题的人。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T14:13:51.747

“无法确定这是否是错误”模式怎么样。似乎如果您确实有异常但想返回部分结果，则可以将结果包装在异常中。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T14:34:09.187

如果您不想使用异常，最简洁的方法是让函数返回错误/成功代码，并采用引用或指针参数来填充结果。

我不会称其为反模式。这是一种经过充分验证的可行方法，通常比使用异常更可取。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T14:36:46.467

如果您希望您的方法偶尔会失败，但不认为这是异常情况，我更喜欢 .NET Framework 中使用的这种模式：

```
bool TryMyFunction(out FunctionResult result){    

     //...    
     result = new FunctionResult();
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-19T00:31:49.647

关于气味和反模式的辩论让我想起了“幸存者”电视节目，在那里你有各种编程结构试图在岛上互相投票。我更愿意看到“构造 X 有这样那样的优点和缺点”，而不是不断发展的关于应该做什么和不应该做什么的法令列表。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T17:03:56.690

为了捍卫反模式指定，此代码适用于以下几种方式：

1.  对象 x = MyFunction().payload; *（忽略返回结果 - 非常糟糕）*
2.  int 代码 = MyFunction().result; *（扔掉有效载荷 - 如果这是预期用途，可能没问题。）*
3.  函数结果 x = MyFunction(); //... *（一堆额外的 FunctionResult 对象和额外的代码来检查它们）*

如果您需要使用返回码，那很好。但是然后使用返回码。不要尝试在其中打包额外的有效负载。这就是*ref*和*out*参数 (C#) 的用途。可空类型可能是一个例外，但这只是因为语言中有额外的糖来支持它。

如果您仍然不同意此评估，请否决此答案（不是整个问题）。如果您确实认为这是一种反模式，那么请支持它。我们将使用此答案来了解社区的想法。

# .net - 通常最好使用哪个 - StringComparison.OrdinalIgnoreCase 或 StringComparison.InvariantCultureIgnoreCase？

> ID：72696
> 
> 赞同：188
> 
> 时间：2008-09-16T14:11:39.130
> 
> 标签：.net, vb.net, localization

我有一些这样的代码：

```
If key.Equals("search", StringComparison.OrdinalIgnoreCase) Then
    DoSomething()
End If 
```

我不关心这个案子。我应该使用`OrdinalIgnoreCase`,`InvariantCultureIgnoreCase`还是`CurrentCultureIgnoreCase`?

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2008-09-16T14:16:42.160

**[较新的 .Net Docs 现在有一个表格，可帮助您确定最适合您的情况。](https://docs.microsoft.com/en-us/dotnet/standard/base-types/best-practices-strings#choosing-a-stringcomparison-member-for-your-method-call)**

来自 MSDN 的“[在 Microsoft .NET 2.0 中使用字符串的新建议](https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms973919(v=msdn.10))”

> `InvariantCulture`总结：以前使用for 字符串比较、大小写和排序的代码所有者应该强烈考虑`String`在 Microsoft .NET 2.0 中使用一组新的重载。*具体来说，设计为与文化无关和语言无关的数据*应该开始使用新枚举的`StringComparison.Ordinal`或`StringComparison.OrdinalIgnoreCase`成员来指定重载。`StringComparison`这些强制执行类似于这样的逐字节比较`strcmp`，不仅避免了基本符号字符串的语言解释中的错误，而且提供了更好的性能。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2011-06-20T02:16:53.377

### 这一切都取决于

比较 unicode 字符串很难：

> 文本处理软件中 Unicode 字符串搜索和比较的实现必须考虑到等效代码点的存在。在没有此功能的情况下，搜索特定代码点序列的用户将无法找到具有不同但规范等效的代码点表示的其他视觉上无法区分的字形。

见：[http ://en.wikipedia.org/wiki/Unicode_equivalence](http://en.wikipedia.org/wiki/Unicode_equivalence)

* * *

如果您尝试以不区分大小写的方式比较 2 个 unicode 字符串并希望它在任何地方都能正常工作**，**那么您将遇到一个不可能的问题。

经典的例子是[土耳其语 i](http://en.wikipedia.org/wiki/Turkish_dotted_and_dotless_I)，当大写时变成 İ （注意点）

默认情况下，.Net 框架通常将[CurrentCulture](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentculture.aspx)用于与字符串相关的函数，但一个非常重要的例外`.Equals`是使用序数（逐字节）比较。

根据设计，这会导致各种字符串函数的行为因计算机文化而异。

* * *

尽管如此，有时我们想要一个“通用”、不区分大小写的比较。

例如，您可能希望字符串比较的行为方式相同，无论您的应用程序安装在哪台计算机上。

为此，我们有 3 个选项：

1.  明确设置区域性并使用 unicode 等效规则执行不区分大小写的比较。
2.  将文化设置为不变文化并使用 unicode 等效规则执行不区分大小写的比较。
3.  使用[OrdinalIgnoreCase](http://msdn.microsoft.com/en-us/library/system.stringcomparer.ordinalignorecase.aspx)，它将使用 InvariantCulture 将字符串大写，然后执行逐字节比较。

Unicode 等价规则很复杂，这意味着使用方法 1) 或 2) 比`OrdinalIgnoreCase`. `OrdinalIgnoreCase`不执行任何特殊的 unicode 规范化的事实意味着某些在计算机屏幕上以相同方式呈现的字符串*将不会*被视为相同。例如：`"\u0061\u030a"`并且`"\u00e5"`两者都呈现å。然而，在序数比较中将被认为是不同的。

您选择哪个在很大程度上取决于您正在构建的应用程序。

*   如果我正在编写一个仅供土耳其用户使用的业务线应用程序，我肯定会使用方法 1。
*   如果我只需要一个简单的“假”不区分大小写的比较，例如数据库中的列名，通常是英文，我可能会使用方法 3。

Microsoft[有一套](http://msdn.microsoft.com/en-us/library/ms973919.aspx)带有明确指导方针的建议。但是，在解决这些问题之前了解 unicode 等价的概念非常重要。

另外，请记住，OrdinalIgnoreCase 是一种[非常特殊](http://www.siao2.com/2004/12/29/344136.aspx)的野兽，它在字典方面与一些混合的排序比较。这可能会令人困惑。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T14:17:22.130

我想这取决于你的情况。由于序号比较实际上是在查看字符的数字 Unicode 值，因此当您按字母顺序排序时，它们不是最佳选择。但是，对于字符串比较，序数会快一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T14:13:00.487

这取决于您想要什么，尽管我会回避不变文化，除非您*非常*确定您永远不想本地化其他语言的代码。请改用 CurrentCulture。

此外，OrdinalIgnoreCase 应该尊重数字，这可能是也可能不是您想要的。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-07-18T19:32:51.783

非常简单的答案是，除非您使用土耳其语，否则您不需要使用 InvariantCulture。

请参阅以下链接：

[在 C# 中，ToUpper() 和 ToUpperInvariant() 有什么区别？](https://stackoverflow.com/questions/3550213/in-c-sharp-what-is-the-difference-between-toupper-and-toupperinvariant)

# sql - 将两个字段连接在一起更好，还是将它们分别与相同的常数进行比较？

> ID：72699
> 
> 赞同：2
> 
> 时间：2008-09-16T14:11:53.530
> 
> 标签：sql, join

例如哪个更好：

```
select * from t1, t2 where t1.country='US' and t2.country=t1.country and t1.id=t2.id 
```

或者

```
select * from t1, t2 where t1.country'US' and t2.country='US' and t1.id=t2.id 
```

更好的数据库工作，更快的结果。

**注意：** Sybase 的两个表上都有一个索引`country+id`。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T14:16:37.013

我认为你的问题没有一个全球性的答案。这取决于具体的查询。您必须比较两个查询的执行计划以查看是否存在显着差异。

我个人更喜欢第一种形式：

select * from t1, t2 where t1.country='US' and t2.country=t1.country and t1.id=t2.id

因为如果我想更改文字，只需要进行一项更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T14:19:09.970

这里有很多你忽略的因素在起作用。它是什么样的数据库？这些表是否已编入索引？它们是如何编入索引的？这些桌子有多大？

（过早的优化是万恶之源！）

可能是如果“t1.id”和“t2.id”被索引，数据库引擎会根据这些字段将它们连接在一起，然后使用 WHERE 子句的其余部分来过滤掉行。

它们可以被索引但非常小的表，并且都适合一页内存。在这种情况下，数据库引擎可能只是对两者进行全面扫描，而不是费心加载索引。

你只是不知道，真的，直到你尝试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:15:08.220

正确答案可能取决于您的 SQL 引擎。对于 MS SQL Server，第一种方法显然更好，因为为统计优化器提供了额外的线索，可以帮助它找到更好（更优化）的解析路径。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T14:15:18.047

我认为这取决于库和数据库引擎。每一个都会以不同的方式执行 SQL，并且不知道哪一个会被优化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T17:13:44.640

我有类似的情况，这是我采取的解决方案：

选择 * FROM t1 INNER JOIN t2 ON t1.id = t2.id AND t1.country = t2.country AND t1.country = 'US'

我注意到我的查询在这种情况下运行得更快。我假设加入常量可以节省引擎时间，因为 WHERE 子句将在最后执行。加入然后按“美国”过滤意味着您仍然从表中拉出所有其他国家/地区，然后必须过滤掉您想要的国家/地区。这个方法最后拉的记录比较少，因为它只会找到美国的记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T14:14:49.840

我倾向于只在代码中包含你的常量一次。可能有一种或另一种方式的性能优势，但它可能是如此之小，只有一个参数的维护优势胜过它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T14:15:18.750

如果您希望使查询更通用，也许为目标国家/地区替换一个参数，那么我将使用您的第一个示例，因为它只需要进行一次更改。这样就不用担心将来会出错。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T14:15:48.390

我怀疑这将取决于表格、数据和元数据。我希望我可以设计出能够以两种方式显示结果的示例 - 基准测试！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T14:16:56.280

扩展应该与任何体面的优化器等效，但这取决于您使用的数据库以及表上定义的索引。

我建议使用 EXPLAIN 功能来确定哪个表达式是最佳的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T14:51:15.120

我认为更好的 SQL 是：

select * from t1, t2 where t1.id=t2.id and t1.country ='US'

除非 t2 中的国家/地区可能与相同 id 的 t1 不同，否则无需使用第二个比较与“US”。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T15:57:06.523

我不会使用隐式内部连接，而是显式连接表。

由于您希望 id 字段和 country 字段相同，并且您提到两者都已编入索引（我假设在同一个索引中），因此我会将两列都包含在连接中，以便您可以使用索引查找而不是扫描。最后，添加您的 where 子句。

```
SELECT *
  FROM t1
  JOIN t2 ON t1.id = t2.id AND t1.country = t2.country
 WHERE t1.country = 'US' 

```

# svn - SVN 存储库可以包含/链接到外部 git 存储库吗？

> ID：72723
> 
> 赞同：6
> 
> 时间：2008-09-16T14:13:14.447
> 
> 标签：svn, git

我有一个 svn 存储库 R，它依赖于另一个存储库中的库 l。

目标是当有人签出 R 时，他们也会签出 l。我们希望 l 仍然在它自己的存储库中，以便可以在不依赖 R 的情况下更新 l。

我对外部 svn 链接了解不多，但我相信当依赖于基于 svn 的库时，可以从外部链接到它，“ext”。

如果 l 在 git 存储库中，我可以做类似的事情吗？我想保留上述目标。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T14:29:50.337

[svn:externals](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)是 svn 可以将多个存储库中的源检出到一个工作副本中的方式。但它仅用于处理 svn 存储库 - 它不知道如何签出 git 存储库。

您可能可以通过使用“git svn”之类的东西在 git 存储库中包含一个 svn 存储库来以另一种方式做到这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T14:29:18.217

我建议为 svn co 使用脚本包装器。

```
#!/bin/sh
svn co path://server/R svn-R
git clone path://server/l git-l 
```

或类似的。

# emacs - 如何在 Emacs 中获取 TextMate 样式的引号？

> ID：72732
> 
> 赞同：6
> 
> 时间：2008-09-16T14:13:58.067
> 
> 标签：emacs

在 textmate 中，当有当前选择时，我点击 " 键，选择被引号包围。同样的事情发生在其他平衡字符上，如 (、{、[ 和 '。

我是否在 Emacs 配置中遗漏了一些明显的东西，这些东西在使用瞬态标记模式时会启用类似的行为，还是我需要打破 elisp 并编写一些东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T14:18:41.703

[这个人的博客文章](http://sami.samhuri.net/2007/6/23/emacs-for-textmate-junkies)中的wrap-region.el将满足您的需求。

[Paredit](http://mumble.net/~campbell/emacs/paredit.el)将完成 TextMate 样式的引用。当您键入匹配对的一部分（引号、括号、圆括号等）时，将插入第二个部分并在它们之间移动插入点，就像 TextMate。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-28T20:13:46.423

试试[http://autopair.googlecode.com](http://autopair.googlecode.com)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-31T07:42:11.357

您应该查看这些较旧的、非常相似的问题：

[在 Emacs 中自动关闭大括号？](https://stackoverflow.com/questions/1023770/automatically-closing-braces-in-emacs/1024531#1024531)

[Emacs typeover 骨架对插入可能](https://stackoverflow.com/questions/848647/emacs-typeover-skeleton-pair-insert-maybe/849218#849218)

虽然正确的答案是上面的 Joao；我要改变我对这些问题的回答，指向自动配对。

# algorithm - 您如何根据号码检测信用卡类型？

> ID：72768
> 
> 赞同：567
> 
> 时间：2008-09-16T14:16:43.923
> 
> 标签：algorithm, language-agnostic, e-commerce

我试图弄清楚如何仅根据信用卡号码来检测信用卡的类型。有谁知道找到这个的明确，可靠的方法？

* * *

## 回答 #1

> 赞同：839
> 
> 时间：2008-09-16T14:18:30.457

信用卡/借记卡号称为**PAN**或*主帐号*。PAN 的前六位数字取自属于发行银行的**IIN**或*发行人标识号*（IIN 以前称为 BIN — 银行标识号 — 因此您可能会在某些文件中看到对该术语的引用）。这六位数字受国际标准[ISO/IEC 7812](http://en.wikipedia.org/wiki/ISO/IEC_7812)的约束，可用于根据数字确定卡的类型。

不幸的是，实际的 ISO/IEC 7812 数据库并未公开，但是，有非官方的列表，包括商业和免费的，包括[在 Wikipedia 上](http://en.wikipedia.org/wiki/Bank_card_number)。

无论如何，要从数字中检测类型，您可以使用如下所示的正则表达式：[Credit for original expressions](http://www.regular-expressions.info/creditcard.html)

**Visa：** `^4[0-9]{6,}$` Visa卡号以4开头。

**MasterCard：** `^5[1-5][0-9]{5,}|222[1-9][0-9]{3,}|22[3-9][0-9]{4,}|2[3-6][0-9]{5,}|27[01][0-9]{4,}|2720[0-9]{3,}$` 2016 年之前，MasterCard 号码以数字 51 到 55 开头，**但这只会检测 MasterCard 信用卡**；使用 MasterCard 系统发行的其他卡不属于此 IIN 范围。2016 年，他们将在 (222100-272099) 范围内添加数字。

**美国运通：** `^3[47][0-9]{5,}$`美国运通卡号以 34 或 37 开头。

**Diners Club：** `^3(?:0[0-5]|[68][0-9])[0-9]{4,}$` Diners Club 卡号以 300 到 305、36 或 38 开头。有些 Diners Club 卡以 5 开头，有 16 位数字。这些是大来卡和万事达卡的合资企业，应该像万事达卡一样处理。

**Discover：** `^6(?:011|5[0-9]{2})[0-9]{3,}$` Discover 卡号以 6011 或 65 开头。

**JCB：** `^(?:2131|1800|35[0-9]{3})[0-9]{3,}$` JCB 卡以 2131、1800 或 35 开头。

不幸的是，万事达卡系统处理的许多卡类型不在万事达卡的 IIN 范围内（数字从 51...55 开始）；最重要的案例是 Maestro 卡，其中许多是从其他银行的 IIN 范围发行的，因此遍布数字空间。因此，**最好假设任何不是您接受的其他类型的卡都必须是 MasterCard**。

**重要提示**：卡号的长度确实不同；例如，Visa 过去曾发行具有 13 位 PAN 的卡和具有 16 位 PAN 的卡。Visa 的文件目前表明它可能发布或可能已经发布了 12 到 19 位数字之间的号码。 **因此，您不应该检查卡号的长度，而是验证它至少有 7 位数字**（对于完整的 IIN 加上一个校验位，它应该与[Luhn 算法](http://en.wikipedia.org/wiki/Luhn_algorithm)预测的值匹配）。

进一步的提示：**在处理持卡人 PAN 之前，从输入中删除所有空格和标点符号**。为什么？因为按组输入数字通常*要*容易得多，类似于它们在实际信用卡正面的显示方式，即

```
4444 4444 4444 4444 
```

比正确输入要容易得多

```
4444444444444444 
```

责备用户确实没有任何好处，因为他们在这里输入了您意想不到的字符。

**这也意味着确保您的输入字段*至少有*24 个字符的空间，否则输入空格的用户将用完空间。** 我建议您使字段足够宽以显示 32 个字符并最多允许 64 个字符；这为扩展提供了充足的空间。

这是一个提供更多洞察力的图像：

**更新（2016 年）：万事达卡将从**[Ach Payment](http://achpayment.net/)开始实施新的 BIN 范围。

![信用卡验证](https://i.stack.imgur.com/Cu7PG.jpg)

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2013-10-02T14:04:21.543

在 JavaScript 中：

```
function detectCardType(number) {
    var re = {
        electron: /^(4026|417500|4405|4508|4844|4913|4917)\d+$/,
        maestro: /^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,
        dankort: /^(5019)\d+$/,
        interpayment: /^(636)\d+$/,
        unionpay: /^(62|88)\d+$/,
        visa: /^4[0-9]{12}(?:[0-9]{3})?$/,
        mastercard: /^5[1-5][0-9]{14}$/,
        amex: /^3[47][0-9]{13}$/,
        diners: /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,
        discover: /^6(?:011|5[0-9]{2})[0-9]{12}$/,
        jcb: /^(?:2131|1800|35\d{3})\d{11}$/
    }

    for(var key in re) {
        if(re[key].test(number)) {
            return key
        }
    }
} 
```

单元测试：

```
describe('CreditCard', function() {
    describe('#detectCardType', function() {

        var cards = {
            '8800000000000000': 'UNIONPAY',

            '4026000000000000': 'ELECTRON',
            '4175000000000000': 'ELECTRON',
            '4405000000000000': 'ELECTRON',
            '4508000000000000': 'ELECTRON',
            '4844000000000000': 'ELECTRON',
            '4913000000000000': 'ELECTRON',
            '4917000000000000': 'ELECTRON',

            '5019000000000000': 'DANKORT',

            '5018000000000000': 'MAESTRO',
            '5020000000000000': 'MAESTRO',
            '5038000000000000': 'MAESTRO',
            '5612000000000000': 'MAESTRO',
            '5893000000000000': 'MAESTRO',
            '6304000000000000': 'MAESTRO',
            '6759000000000000': 'MAESTRO',
            '6761000000000000': 'MAESTRO',
            '6762000000000000': 'MAESTRO',
            '6763000000000000': 'MAESTRO',
            '0604000000000000': 'MAESTRO',
            '6390000000000000': 'MAESTRO',

            '3528000000000000': 'JCB',
            '3589000000000000': 'JCB',
            '3529000000000000': 'JCB',

            '6360000000000000': 'INTERPAYMENT',

            '4916338506082832': 'VISA',
            '4556015886206505': 'VISA',
            '4539048040151731': 'VISA',
            '4024007198964305': 'VISA',
            '4716175187624512': 'VISA',

            '5280934283171080': 'MASTERCARD',
            '5456060454627409': 'MASTERCARD',
            '5331113404316994': 'MASTERCARD',
            '5259474113320034': 'MASTERCARD',
            '5442179619690834': 'MASTERCARD',

            '6011894492395579': 'DISCOVER',
            '6011388644154687': 'DISCOVER',
            '6011880085013612': 'DISCOVER',
            '6011652795433988': 'DISCOVER',
            '6011375973328347': 'DISCOVER',

            '345936346788903': 'AMEX',
            '377669501013152': 'AMEX',
            '373083634595479': 'AMEX',
            '370710819865268': 'AMEX',
            '371095063560404': 'AMEX'
        };

        Object.keys(cards).forEach(function(number) {
            it('should detect card ' + number + ' as ' + cards[number], function() {
                Basket.detectCardType(number).should.equal(cards[number]);
            });
        });
    });
}); 
```

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2014-02-07T01:21:26.007

**更新时间：2016 年 6 月 15 日**（目前作为最终解决方案）

请注意，我什至投票赞成票数最高的那个，但为了清楚起见，这些是真正有效的正则表达式，我用数千个真实的 BIN 代码对其进行了测试。**最重要的是使用起始字符串 (^) 否则它会在现实世界中给出错误的结果！**

**JCB** `^(?:2131|1800|35)[0-9]{0,}$`开头：**2131、1800、35 (3528-3589)**

**美国运通** `^3[47][0-9]{0,}$`开头：**34、37**

**Diners Club** `^3(?:0[0-59]{1}|[689])[0-9]{0,}$`开始：**300-305、309、36、38-39**

**签证** `^4[0-9]{0,}$`起始：**4**

**万事达卡** `^(5[1-5]|222[1-9]|22[3-9]|2[3-6]|27[01]|2720)[0-9]{0,}$`开头：**2221-2720、51-55**

**Maestro** `^(5[06789]|6)[0-9]{0,}$` Maestro 始终在以下范围内增长：**60-69**，以/不是其他东西开头，但无论如何，从 5 开始必须编码为万事达卡。必须在代码末尾检测到 Maestro 卡，因为其他一些卡在 60-69 范围内。请看代码。

**发现** `^(6011|65|64[4-9]|62212[6-9]|6221[3-9]|622[2-8]|6229[01]|62292[0-5])[0-9]{0,}$`发现很难编码，从：**6011、622126-622925、644-649、65开始**

在**javascript**中我使用这个函数。当您将其分配给 onkeyup 事件并尽快给出结果时，这很好。

```
function cc_brand_id(cur_val) {
    // the regular expressions check for possible matches as you type, hence the OR operators based on the number of chars
    // regexp string length {0} provided for soonest detection of beginning of the card numbers this way it could be used for BIN CODE detection also

    //JCB
    jcb_regex = new RegExp('^(?:2131|1800|35)[0-9]{0,}$'); //2131, 1800, 35 (3528-3589)
    // American Express
    amex_regex = new RegExp('^3[47][0-9]{0,}$'); //34, 37
    // Diners Club
    diners_regex = new RegExp('^3(?:0[0-59]{1}|[689])[0-9]{0,}$'); //300-305, 309, 36, 38-39
    // Visa
    visa_regex = new RegExp('^4[0-9]{0,}$'); //4
    // MasterCard
    mastercard_regex = new RegExp('^(5[1-5]|222[1-9]|22[3-9]|2[3-6]|27[01]|2720)[0-9]{0,}$'); //2221-2720, 51-55
    maestro_regex = new RegExp('^(5[06789]|6)[0-9]{0,}$'); //always growing in the range: 60-69, started with / not something else, but starting 5 must be encoded as mastercard anyway
    //Discover
    discover_regex = new RegExp('^(6011|65|64[4-9]|62212[6-9]|6221[3-9]|622[2-8]|6229[01]|62292[0-5])[0-9]{0,}$');
    ////6011, 622126-622925, 644-649, 65

    // get rid of anything but numbers
    cur_val = cur_val.replace(/\D/g, '');

    // checks per each, as their could be multiple hits
    //fix: ordering matter in detection, otherwise can give false results in rare cases
    var sel_brand = "unknown";
    if (cur_val.match(jcb_regex)) {
        sel_brand = "jcb";
    } else if (cur_val.match(amex_regex)) {
        sel_brand = "amex";
    } else if (cur_val.match(diners_regex)) {
        sel_brand = "diners_club";
    } else if (cur_val.match(visa_regex)) {
        sel_brand = "visa";
    } else if (cur_val.match(mastercard_regex)) {
        sel_brand = "mastercard";
    } else if (cur_val.match(discover_regex)) {
        sel_brand = "discover";
    } else if (cur_val.match(maestro_regex)) {
        if (cur_val[0] == '5') { //started 5 must be mastercard
            sel_brand = "mastercard";
        } else {
            sel_brand = "maestro"; //maestro is all 60-69 which is not something else, thats why this condition in the end
        }
    }

    return sel_brand;
} 
```

在这里你可以玩它：

[http://jsfiddle.net/upN3L/69/](http://jsfiddle.net/upN3L/69/)

**对于 PHP 使用这个函数，它也会检测到一些子 VISA/MC 卡：**

```
/**
  * Obtain a brand constant from a PAN
  *
  * @param string $pan               Credit card number
  * @param bool   $include_sub_types Include detection of sub visa brands
  * @return string
  */
public static function getCardBrand($pan, $include_sub_types = false)
{
    //maximum length is not fixed now, there are growing number of CCs has more numbers in length, limiting can give false negatives atm

    //these regexps accept not whole cc numbers too
    //visa
    $visa_regex = "/^4[0-9]{0,}$/";
    $vpreca_regex = "/^428485[0-9]{0,}$/";
    $postepay_regex = "/^(402360|402361|403035|417631|529948){0,}$/";
    $cartasi_regex = "/^(432917|432930|453998)[0-9]{0,}$/";
    $entropay_regex = "/^(406742|410162|431380|459061|533844|522093)[0-9]{0,}$/";
    $o2money_regex = "/^(422793|475743)[0-9]{0,}$/";

    // MasterCard
    $mastercard_regex = "/^(5[1-5]|222[1-9]|22[3-9]|2[3-6]|27[01]|2720)[0-9]{0,}$/";
    $maestro_regex = "/^(5[06789]|6)[0-9]{0,}$/";
    $kukuruza_regex = "/^525477[0-9]{0,}$/";
    $yunacard_regex = "/^541275[0-9]{0,}$/";

    // American Express
    $amex_regex = "/^3[47][0-9]{0,}$/";

    // Diners Club
    $diners_regex = "/^3(?:0[0-59]{1}|[689])[0-9]{0,}$/";

    //Discover
    $discover_regex = "/^(6011|65|64[4-9]|62212[6-9]|6221[3-9]|622[2-8]|6229[01]|62292[0-5])[0-9]{0,}$/";

    //JCB
    $jcb_regex = "/^(?:2131|1800|35)[0-9]{0,}$/";

    //ordering matter in detection, otherwise can give false results in rare cases
    if (preg_match($jcb_regex, $pan)) {
        return "jcb";
    }

    if (preg_match($amex_regex, $pan)) {
        return "amex";
    }

    if (preg_match($diners_regex, $pan)) {
        return "diners_club";
    }

    //sub visa/mastercard cards
    if ($include_sub_types) {
        if (preg_match($vpreca_regex, $pan)) {
            return "v-preca";
        }
        if (preg_match($postepay_regex, $pan)) {
            return "postepay";
        }
        if (preg_match($cartasi_regex, $pan)) {
            return "cartasi";
        }
        if (preg_match($entropay_regex, $pan)) {
            return "entropay";
        }
        if (preg_match($o2money_regex, $pan)) {
            return "o2money";
        }
        if (preg_match($kukuruza_regex, $pan)) {
            return "kukuruza";
        }
        if (preg_match($yunacard_regex, $pan)) {
            return "yunacard";
        }
    }

    if (preg_match($visa_regex, $pan)) {
        return "visa";
    }

    if (preg_match($mastercard_regex, $pan)) {
        return "mastercard";
    }

    if (preg_match($discover_regex, $pan)) {
        return "discover";
    }

    if (preg_match($maestro_regex, $pan)) {
        if ($pan[0] == '5') { //started 5 must be mastercard
            return "mastercard";
        }
        return "maestro"; //maestro is all 60-69 which is not something else, thats why this condition in the end

    }

    return "unknown"; //unknown for this system
} 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2012-12-12T14:55:41.057

```
public string GetCreditCardType(string CreditCardNumber)
{
    Regex regVisa = new Regex("^4[0-9]{12}(?:[0-9]{3})?$");
    Regex regMaster = new Regex("^5[1-5][0-9]{14}$");
    Regex regExpress = new Regex("^3[47][0-9]{13}$");
    Regex regDiners = new Regex("^3(?:0[0-5]|[68][0-9])[0-9]{11}$");
    Regex regDiscover = new Regex("^6(?:011|5[0-9]{2})[0-9]{12}$");
    Regex regJCB = new Regex("^(?:2131|1800|35\\d{3})\\d{11}$");

    if (regVisa.IsMatch(CreditCardNumber))
        return "VISA";
    else if (regMaster.IsMatch(CreditCardNumber))
        return "MASTER";
    else  if (regExpress.IsMatch(CreditCardNumber))
        return "AEXPRESS";
    else if (regDiners.IsMatch(CreditCardNumber))
        return "DINERS";
    else if (regDiscover.IsMatch(CreditCardNumber))
        return "DISCOVERS";
    else if (regJCB.IsMatch(CreditCardNumber))
        return "JCB";
    else
        return "invalid";
} 
```

这是使用 Regex , c# 检查信用卡类型的功能

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-03-09T11:21:12.957

看一下这个：

[http://www.breakpar.com/bkp/home.nsf/0/87256B280015193F87256CC70060A01B](http://www.breakingpar.com/bkp/home.nsf/0/87256B280015193F87256CC70060A01B)

```
function isValidCreditCard(type, ccnum) {
    /* Visa: length 16, prefix 4, dashes optional.
    Mastercard: length 16, prefix 51-55, dashes optional.
    Discover: length 16, prefix 6011, dashes optional.
    American Express: length 15, prefix 34 or 37.
    Diners: length 14, prefix 30, 36, or 38\. */

    var re = new Regex({
        "visa": "/^4\d{3}-?\d{4}-?\d{4}-?\d",
        "mc": "/^5[1-5]\d{2}-?\d{4}-?\d{4}-?\d{4}$/",
        "disc": "/^6011-?\d{4}-?\d{4}-?\d{4}$/",
        "amex": "/^3[47]\d{13}$/",
        "diners": "/^3[068]\d{12}$/"
    }[type.toLowerCase()])

    if (!re.test(ccnum)) return false;
    // Remove all dashes for the checksum checks to eliminate negative numbers
    ccnum = ccnum.split("-").join("");
    // Checksum ("Mod 10")
    // Add even digits in even length strings or odd digits in odd length strings.
    var checksum = 0;
    for (var i = (2 - (ccnum.length % 2)); i <= ccnum.length; i += 2) {
        checksum += parseInt(ccnum.charAt(i - 1));
    }
    // Analyze odd digits in even length strings or even digits in odd length strings.
    for (var i = (ccnum.length % 2) + 1; i < ccnum.length; i += 2) {
        var digit = parseInt(ccnum.charAt(i - 1)) * 2;
        if (digit < 10) { checksum += digit; } else { checksum += (digit - 9); }
    }
    if ((checksum % 10) == 0) return true;
    else return false;
} 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2013-03-19T12:15:48.060

最近我需要这样的功能，我正在将 Zend Framework Credit Card Validator 移植到 ruby​​。ruby gem：[https](https://github.com/Fivell/credit_card_validations) ://github.com/Fivell/credit_card_validations zend 框架：[https ://github.com/zendframework/zf2/blob/master/library/Zend/Validator/CreditCard.php](https://github.com/zendframework/zf2/blob/master/library/Zend/Validator/CreditCard.php)

他们都使用 INN 范围来检测类型。在这里您可以阅读[有关 INN 的信息](http://en.wikipedia.org/wiki/Bank_card_number)

根据这个，您可以选择检测信用卡（没有正则表达式，但声明一些关于前缀和可能长度的规则）

所以我们对最常用的卡片有下一个规则

```
########  most used brands #########

    visa: [
        {length: [13, 16], prefixes: ['4']}
    ],
    mastercard: [
        {length: [16], prefixes: ['51', '52', '53', '54', '55']}
    ],

    amex: [
        {length: [15], prefixes: ['34', '37']}
    ],
    ######## other brands ########
    diners: [
        {length: [14], prefixes: ['300', '301', '302', '303', '304', '305', '36', '38']},
    ],

    #There are Diners Club (North America) cards that begin with 5\. These are a joint venture between Diners Club and MasterCard, and are processed like a MasterCard
    # will be removed in next major version

    diners_us: [
        {length: [16], prefixes: ['54', '55']}
    ],

    discover: [
        {length: [16], prefixes: ['6011', '644', '645', '646', '647', '648',
                                  '649', '65']}
    ],

    jcb: [
        {length: [16], prefixes: ['3528', '3529', '353', '354', '355', '356', '357', '358', '1800', '2131']}
    ],

    laser: [
        {length: [16, 17, 18, 19], prefixes: ['6304', '6706', '6771']}
    ],

    solo: [
        {length: [16, 18, 19], prefixes: ['6334', '6767']}
    ],

    switch: [
        {length: [16, 18, 19], prefixes: ['633110', '633312', '633304', '633303', '633301', '633300']}

    ],

    maestro: [
        {length: [12, 13, 14, 15, 16, 17, 18, 19], prefixes: ['5010', '5011', '5012', '5013', '5014', '5015', '5016', '5017', '5018',
                                                              '502', '503', '504', '505', '506', '507', '508',
                                                              '6012', '6013', '6014', '6015', '6016', '6017', '6018', '6019',
                                                              '602', '603', '604', '605', '6060',
                                                              '677', '675', '674', '673', '672', '671', '670',
                                                              '6760', '6761', '6762', '6763', '6764', '6765', '6766', '6768', '6769']}
    ],

    # Luhn validation are skipped for union pay cards because they have unknown generation algoritm
    unionpay: [
        {length: [16, 17, 18, 19], prefixes: ['622', '624', '625', '626', '628'], skip_luhn: true}
    ],

    dankrot: [
        {length: [16], prefixes: ['5019']}
    ],

    rupay: [
        {length: [16], prefixes: ['6061', '6062', '6063', '6064', '6065', '6066', '6067', '6068', '6069', '607', '608'], skip_luhn: true}
    ]

} 
```

然后通过搜索前缀和比较长度可以检测信用卡品牌。也不要忘记 luhn 算法（在此处描述[http://en.wikipedia.org/wiki/Luhn](http://en.wikipedia.org/wiki/Luhn)）。

更新

可以在此处找到更新的规则列表[https://raw.githubusercontent.com/Fivell/credit_card_validations/master/lib/data/brands.yaml](https://raw.githubusercontent.com/Fivell/credit_card_validations/master/lib/data/brands.yaml)

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-11-22T23:20:02.573

这是codeproject 上[各种 CC 相关内容的完整 C# 或 VB 代码。](http://www.codeproject.com/Articles/20271/Ultimate-NET-Credit-Card-Utility-Class)

*   IsValidNumber
*   GetCardTypeFromNumber
*   GetCardTestNumber
*   通过卢恩测试

这篇文章已经发布了几年，没有任何负面评论。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-08-13T18:29:04.110

这是一个 php 类函数，通过 CCnumber 返回 CCtype。 [此代码不验证卡或不运行 Luhn 算法仅尝试根据此页面](http://en.wikipedia.org/wiki/Credit_card_number#Major_Industry_Identifier_.28MII.29)
中的表查找信用卡类型。基本使用CCnumber长度和CCcard前缀来确定CCcard类型。

```
<?php
class CreditcardType
{
    public static $creditcardTypes = [
        [
            'Name' => 'American Express',
            'cardLength' => [15],
            'cardPrefix' => ['34', '37'],
        ], [
            'Name' => 'Maestro',
            'cardLength' => [12, 13, 14, 15, 16, 17, 18, 19],
            'cardPrefix' => ['5018', '5020', '5038', '6304', '6759', '6761', '6763'],
        ], [
            'Name' => 'Mastercard',
            'cardLength' => [16],
            'cardPrefix' => ['51', '52', '53', '54', '55'],
        ], [
            'Name' => 'Visa',
            'cardLength' => [13, 16],
            'cardPrefix' => ['4'],
        ], [
            'Name' => 'JCB',
            'cardLength' => [16],
            'cardPrefix' => ['3528', '3529', '353', '354', '355', '356', '357', '358'],
        ], [
            'Name' => 'Discover',
            'cardLength' => [16],
            'cardPrefix' => ['6011', '622126', '622127', '622128', '622129', '62213','62214', '62215', '62216', '62217', '62218', '62219','6222', '6223', '6224', '6225', '6226', '6227', '6228','62290', '62291', '622920', '622921', '622922', '622923','622924', '622925', '644', '645', '646', '647', '648','649', '65'],
        ], [
            'Name' => 'Solo',
            'cardLength' => [16, 18, 19],
            'cardPrefix' => ['6334', '6767'],
        ], [
            'Name' => 'Unionpay',
            'cardLength' => [16, 17, 18, 19],
            'cardPrefix' => ['622126', '622127', '622128', '622129', '62213', '62214','62215', '62216', '62217', '62218', '62219', '6222', '6223','6224', '6225', '6226', '6227', '6228', '62290', '62291','622920', '622921', '622922', '622923', '622924', '622925'],
        ], [
            'Name' => 'Diners Club',
            'cardLength' => [14],
            'cardPrefix' => ['300', '301', '302', '303', '304', '305', '36'],
        ], [
            'Name' => 'Diners Club US',
            'cardLength' => [16],
            'cardPrefix' => ['54', '55'],
        ], [
            'Name' => 'Diners Club Carte Blanche',
            'cardLength' => [14],
            'cardPrefix' => ['300', '305'],
        ], [
            'Name' => 'Laser',
            'cardLength' => [16, 17, 18, 19],
            'cardPrefix' => ['6304', '6706', '6771', '6709'],
        ],
    ];

    public static function getType($CCNumber)
    {
        $CCNumber = trim($CCNumber);
        $type = 'Unknown';
        foreach (CreditcardType::$creditcardTypes as $card) {
            if (! in_array(strlen($CCNumber), $card['cardLength'])) {
                continue;
            }
            $prefixes = '/^(' . implode('|', $card['cardPrefix']) . ')/';
            if (preg_match($prefixes, $CCNumber) == 1) {
                $type = $card['Name'];
                break;
            }
        }
        return $type;
    }
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2014-03-25T10:33:22.867

紧凑的 JavaScript 版本

```
 var getCardType = function (number) {
        var cards = {
            visa: /^4[0-9]{12}(?:[0-9]{3})?$/,
            mastercard: /^5[1-5][0-9]{14}$/,
            amex: /^3[47][0-9]{13}$/,
            diners: /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,
            discover: /^6(?:011|5[0-9]{2})[0-9]{12}$/,
            jcb: /^(?:2131|1800|35\d{3})\d{11}$/
        };
        for (var card in cards) {
            if (cards[card].test(number)) {
                return card;
            }
        }
    }; 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-06-20T17:58:57.837

Anatoliy 在 PHP 中的回答：

```
 public static function detectCardType($num)
 {
    $re = array(
        "visa"       => "/^4[0-9]{12}(?:[0-9]{3})?$/",
        "mastercard" => "/^5[1-5][0-9]{14}$/",
        "amex"       => "/^3[47][0-9]{13}$/",
        "discover"   => "/^6(?:011|5[0-9]{2})[0-9]{12}$/",
    );

    if (preg_match($re['visa'],$num))
    {
        return 'visa';
    }
    else if (preg_match($re['mastercard'],$num))
    {
        return 'mastercard';
    }
    else if (preg_match($re['amex'],$num))
    {
        return 'amex';
    }
    else if (preg_match($re['discover'],$num))
    {
        return 'discover';
    }
    else
    {
        return false;
    }
 } 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-16T14:56:31.973

信用卡的第一个数字可用于近似供应商：

*   签证：49,44 或 47
*   电子签证：42、45、48、49
*   万事达卡：51
*   美国运通：34
*   食客：30、36、38
*   捷豹路虎：35

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-02-26T07:05:25.627

请勿在处理付款过程中尝试检测信用卡类型。您有拒绝有效交易的风险。

如果您需要向您的支付处理器提供信息（例如 PayPal 信用卡对象需要命名[卡类型](https://developer.paypal.com/docs/api/#store-a-credit-card)），请从可用的最少信息中猜测它，例如

```
$credit_card['pan'] = preg_replace('/[^0-9]/', '', $credit_card['pan']);
$inn = (int) mb_substr($credit_card['pan'], 0, 2);

// @see http://en.wikipedia.org/wiki/List_of_Bank_Identification_Numbers#Overview
if ($inn >= 40 && $inn <= 49) {
    $type = 'visa';
} else if ($inn >= 51 && $inn <= 55) {
    $type = 'mastercard';
} else if ($inn >= 60 && $inn <= 65) {
    $type = 'discover';
} else if ($inn >= 34 && $inn <= 37) {
    $type = 'amex';
} else {
    throw new \UnexpectedValueException('Unsupported card type.');
} 
```

这种实现（仅使用前两位数字）足以识别所有主要的（在 PayPal 的情况下是所有受支持的）卡方案。事实上，您可能希望完全跳过该例外并默认使用最流行的卡片类型。让支付网关/处理器告诉您响应您的请求时是否存在验证错误。

现实情况是您的支付网关[并不关心您提供的价值](http://qr.ae/tOcrH)。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-12-22T10:36:54.180

在卡片范围识别 (CRR) 中，使用一系列正则表达式或其他硬编码范围的算法的一个缺点是，根据我的经验，BIN/IIN 确实会随着时间而变化。卡的联合品牌是一个持续的复杂性。不同的卡收单机构/商家可能需要您以不同的方式对待同一张卡，具体取决于地理位置。

此外，在过去几年中，例如银联卡在更广泛的流通中，现有模型无法应对有时与它们所取代的更广泛范围交错的新范围。
了解您的系统需要覆盖的地理位置可能会有所帮助，因为某些范围仅限于在特定国家/地区使用。例如，范围 62 包括美国的一些 AAA 子范围，但如果您的商户基地在美国以外，您可以将所有 62 视为银联。
您可能还会被要求根据商家位置区别对待卡片。例如，将某些英国卡在国内视为借记卡，但在国际上视为信用卡。

一个主要的收单银行维护着一套非常有用的规则。例如[https://www.barclaycard.co.uk/business/files/BIN-Rules-EIRE.pdf](https://www.barclaycard.co.uk/business/files/BIN-Rules-EIRE.pdf)和[https://www.barclaycard.co.uk/business/files/BIN-Rules-UK.pdf](https://www.barclaycard.co.uk/business/files/BIN-Rules-UK.pdf)。（截至 2017 年 6 月的有效链接，感谢提供更新参考链接的用户。）但请注意，虽然这些 CRR 规则可能代表发卡领域，因为它适用于该实体收购的商家，它不包括例如标识为 CUP/UPI 的范围。

这些注释适用于磁条 (MagStripe) 或 PKE（Pan Key Entry）方案。ICC/EMV 世界的情况又有所不同。

更新：此页面上的其他答案（以及链接的 WikiPedia 页面）的 JCB 始终为 16 长。但是，在我的公司，我们有一个专门的工程师团队，他们在多个收单银行和地区对我们的 POS 设备和软件进行认证。该团队从 JCB 获得的最新认证卡包有一个 19 长 PAN 的通行证。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2016-04-07T17:54:27.407

Usman Y 的答案的 Swift 2.1 版本。使用 print 语句通过某个字符串值验证 so 调用

```
print(self.validateCardType(self.creditCardField.text!))

func validateCardType(testCard: String) -> String {

    let regVisa = "^4[0-9]{12}(?:[0-9]{3})?$"
    let regMaster = "^5[1-5][0-9]{14}$"
    let regExpress = "^3[47][0-9]{13}$"
    let regDiners = "^3(?:0[0-5]|[68][0-9])[0-9]{11}$"
    let regDiscover = "^6(?:011|5[0-9]{2})[0-9]{12}$"
    let regJCB = "^(?:2131|1800|35\\d{3})\\d{11}$"

    let regVisaTest = NSPredicate(format: "SELF MATCHES %@", regVisa)
    let regMasterTest = NSPredicate(format: "SELF MATCHES %@", regMaster)
    let regExpressTest = NSPredicate(format: "SELF MATCHES %@", regExpress)
    let regDinersTest = NSPredicate(format: "SELF MATCHES %@", regDiners)
    let regDiscoverTest = NSPredicate(format: "SELF MATCHES %@", regDiscover)
    let regJCBTest = NSPredicate(format: "SELF MATCHES %@", regJCB)

    if regVisaTest.evaluateWithObject(testCard){
        return "Visa"
    }
    else if regMasterTest.evaluateWithObject(testCard){
        return "MasterCard"
    }

    else if regExpressTest.evaluateWithObject(testCard){
        return "American Express"
    }

    else if regDinersTest.evaluateWithObject(testCard){
        return "Diners Club"
    }

    else if regDiscoverTest.evaluateWithObject(testCard){
        return "Discover"
    }

    else if regJCBTest.evaluateWithObject(testCard){
        return "JCB"
    }

    return ""

} 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2015-04-29T07:36:08.187

Stripe为卡片方案检测提供了这个奇妙的**javascript库。**让我添加一些代码片段并向您展示如何使用它。

首先将其包含到您的网页中

```
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.payment/1.2.3/jquery.payment.js " ></script> 
```

其次使用函数 cardType 来检测卡片方案。

```
$(document).ready(function() {              
            var type = $.payment.cardType("4242 4242 4242 4242"); //test card number
            console.log(type);                                   
}); 
```

以下是更多示例和演示的参考链接。

1.  [jquery.payment.js 的条纹博客](https://stripe.com/blog/jquery-payment)
2.  [Github 仓库](https://github.com/stripe/jquery.payment)

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2016-06-01T05:15:22.440

您可以快速创建一个枚举来检测信用卡类型。

```
enum CreditCardType: Int { // Enum which encapsulates different card types and method to find the type of card.

case Visa
case Master
case Amex
case Discover

func validationRegex() -> String {
    var regex = ""
    switch self {
    case .Visa:
        regex = "^4[0-9]{6,}$"

    case .Master:
        regex = "^5[1-5][0-9]{5,}$"

    case .Amex:
        regex = "^3[47][0-9]{13}$"

    case .Discover:
        regex = "^6(?:011|5[0-9]{2})[0-9]{12}$"
    }

    return regex
}

func validate(cardNumber: String) -> Bool {
    let predicate = NSPredicate(format: "SELF MATCHES %@", validationRegex())
    return predicate.evaluateWithObject(cardNumber)
}

// Method returns the credit card type for given card number
static func cardTypeForCreditCardNumber(cardNumber: String) -> CreditCardType?  {
    var creditCardType: CreditCardType?

    var index = 0
    while let cardType = CreditCardType(rawValue: index) {
        if cardType.validate(cardNumber) {
            creditCardType = cardType
            break
        } else {
            index++
        }
    }
    return creditCardType
  }
} 
```

调用方法 CreditCardType.cardTypeForCreditCardNumber("#card number") 返回 CreditCardType 枚举值。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-07-07T16:13:31.770

我使用 jQuery 的解决方案：

```
function detectCreditCardType() {
    var type = new Array;
    type[1] = '^4[0-9]{12}(?:[0-9]{3})?$';      // visa
    type[2] = '^5[1-5][0-9]{14}$';              // mastercard
    type[3] = '^6(?:011|5[0-9]{2})[0-9]{12}$';  // discover
    type[4] = '^3[47][0-9]{13}$';               // amex

    var ccnum = $('.creditcard').val().replace(/[^\d.]/g, '');
    var returntype = 0;

    $.each(type, function(idx, re) {
        var regex = new RegExp(re);
        if(regex.test(ccnum) && idx>0) {
            returntype = idx;
        }
    });

    return returntype;
} 
```

如果返回 0，则未检测到信用卡类型。

“信用卡”类应添加到信用卡输入字段。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-07-30T21:35:48.597

我搜索了很多信用卡格式和电话号码格式。找到了很多好的技巧，但没有什么真正适合我的确切愿望，所以我创建了[这段代码](http://quercusv.github.io/smartForm/)。你像这样使用它：

```
var sf = smartForm.formatCC(myInputString);
var cardType = sf.cardType; 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2020-07-17T13:52:40.017

@Anatoliy 答案的 javascript 改进

```
function getCardType (number) {
  const numberFormated = number.replace(/\D/g, '')
  var patterns = {
    VISA: /^4[0-9]{12}(?:[0-9]{3})?$/,
    MASTER: /^5[1-5][0-9]{14}$/,
    AMEX: /^3[47][0-9]{13}$/,
    ELO: /^((((636368)|(438935)|(504175)|(451416)|(636297))\d{0,10})|((5067)|(4576)|(4011))\d{0,12})$/,
    AURA: /^(5078\d{2})(\d{2})(\d{11})$/,
    JCB: /^(?:2131|1800|35\d{3})\d{11}$/,
    DINERS: /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,
    DISCOVERY: /^6(?:011|5[0-9]{2})[0-9]{12}$/,
    HIPERCARD: /^(606282\d{10}(\d{3})?)|(3841\d{15})$/,
    ELECTRON: /^(4026|417500|4405|4508|4844|4913|4917)\d+$/,
    MAESTRO: /^(5018|5020|5038|5612|5893|6304|6759|6761|6762|6763|0604|6390)\d+$/,
    DANKORT: /^(5019)\d+$/,
    INTERPAYMENT: /^(636)\d+$/,
    UNIONPAY: /^(62|88)\d+$/,
  }
  for (var key in patterns) {
    if (patterns[key].test(numberFormated)) {
      return key
    }
  }
}

console.log(getCardType("4539 5684 7526 2091"))
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2020-11-20T04:37:53.870

> **斯威夫特 5+**

```
extension String {

    func isMatch(_ Regex: String) -> Bool {

        do {
            let regex = try NSRegularExpression(pattern: Regex)
            let results = regex.matches(in: self, range: NSRange(self.startIndex..., in: self))
            return results.map {
                String(self[Range($0.range, in: self)!])
            }.count > 0
        } catch {
            return false
        }

    }

    func getCreditCardType() -> String? {

        let VISA_Regex = "^4[0-9]{6,}$"
        let MasterCard_Regex = "^5[1-5][0-9]{5,}|222[1-9][0-9]{3,}|22[3-9][0-9]{4,}|2[3-6][0-9]{5,}|27[01][0-9]{4,}|2720[0-9]{3,}$"
        let AmericanExpress_Regex = "^3[47][0-9]{5,}$"
        let DinersClub_Regex = "^3(?:0[0-5]|[68][0-9])[0-9]{4,}$"
        let Discover_Regex = "^6(?:011|5[0-9]{2})[0-9]{3,}$"
        let JCB_Regex = "^(?:2131|1800|35[0-9]{3})[0-9]{3,}$"

        if self.isMatch(VISA_Regex) {
            return "VISA"
        } else if self.isMatch(MasterCard_Regex) {
            return "MasterCard"
        } else if self.isMatch(AmericanExpress_Regex) {
            return "AmericanExpress"
        } else if self.isMatch(DinersClub_Regex) {
            return "DinersClub"
        } else if self.isMatch(Discover_Regex) {
            return "Discover"
        } else if self.isMatch(JCB_Regex) {
            return "JCB"
        } else {
            return nil
        }

    }

} 
```

> **采用。**

```
"1234123412341234".getCreditCardType() 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-07-17T19:09:34.317

```
// abobjects.com, parvez ahmad ab bulk mailer
use below script

function isValidCreditCard2(type, ccnum) {
       if (type == "Visa") {
          // Visa: length 16, prefix 4, dashes optional.
          var re = /^4\d{3}?\d{4}?\d{4}?\d{4}$/;
       } else if (type == "MasterCard") {
          // Mastercard: length 16, prefix 51-55, dashes optional.
          var re = /^5[1-5]\d{2}?\d{4}?\d{4}?\d{4}$/;
       } else if (type == "Discover") {
          // Discover: length 16, prefix 6011, dashes optional.
          var re = /^6011?\d{4}?\d{4}?\d{4}$/;
       } else if (type == "AmEx") {
          // American Express: length 15, prefix 34 or 37.
          var re = /^3[4,7]\d{13}$/;
       } else if (type == "Diners") {
          // Diners: length 14, prefix 30, 36, or 38.
          var re = /^3[0,6,8]\d{12}$/;
       }
       if (!re.test(ccnum)) return false;
       return true;
       /*
       // Remove all dashes for the checksum checks to eliminate negative numbers
       ccnum = ccnum.split("-").join("");
       // Checksum ("Mod 10")
       // Add even digits in even length strings or odd digits in odd length strings.
       var checksum = 0;
       for (var i=(2-(ccnum.length % 2)); i<=ccnum.length; i+=2) {
          checksum += parseInt(ccnum.charAt(i-1));
       }
       // Analyze odd digits in even length strings or even digits in odd length strings.
       for (var i=(ccnum.length % 2) + 1; i<ccnum.length; i+=2) {
          var digit = parseInt(ccnum.charAt(i-1)) * 2;
          if (digit < 10) { checksum += digit; } else { checksum += (digit-9); }
       }
       if ((checksum % 10) == 0) return true; else return false;
       */

    }
jQuery.validator.addMethod("isValidCreditCard", function(postalcode, element) { 
    return isValidCreditCard2($("#cardType").val(), $("#cardNum").val()); 

}, "<br>credit card is invalid");

     Type</td>
                                          <td class="text">&nbsp; <form:select path="cardType" cssclass="fields" style="border: 1px solid #D5D5D5;padding: 0px 0px 0px 0px;width: 130px;height: 22px;">
                                              <option value="SELECT">SELECT</option>
                                              <option value="MasterCard">Mastercard</option>
                                              <option value="Visa">Visa</option>
                                               <option value="AmEx">American Express</option>
                                              <option value="Discover">Discover</option>
                                            </form:select> <font color="#FF0000">*</font> 

$("#signupForm").validate({

    rules:{
       companyName:{required: true},
       address1:{required: true},
       city:{required: true},
       state:{required: true},
       zip:{required: true},
       country:{required: true},
       chkAgree:{required: true},
       confPassword:{required: true},
       lastName:{required: true},
       firstName:{required: true},
       ccAddress1:{required: true},
       ccZip:{         
           postalcode : true
       },
       phone:{required: true},
       email:{
           required: true,
           email: true
           },
       userName:{
           required: true,
           minlength: 6
           },
       password:{
           required: true,
           minlength: 6
           },          
       cardNum:{           
            isValidCreditCard : true
       }, 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-01-31T18:27:32.730

只是一点勺子喂食：

```
$("#CreditCardNumber").focusout(function () {

        var regVisa = /^4[0-9]{12}(?:[0-9]{3})?$/;
        var regMasterCard = /^5[1-5][0-9]{14}$/;
        var regAmex = /^3[47][0-9]{13}$/;
        var regDiscover = /^6(?:011|5[0-9]{2})[0-9]{12}$/;

        if (regVisa.test($(this).val())) {
            $("#CCImage").html("<img height='40px' src='@Url.Content("~/images/visa.png")'>");          

        }

        else if (regMasterCard.test($(this).val())) {
        $("#CCImage").html("<img height='40px' src='@Url.Content("~/images/mastercard.png")'>");

        }

        else if (regAmex.test($(this).val())) {

           $("#CCImage").html("<img height='40px' src='@Url.Content("~/images/amex.png")'>");

        }
         else if (regDiscover.test($(this).val())) {

           $("#CCImage").html("<img height='40px' src='@Url.Content("~/images/discover.png")'>");

        }
        else {
        $("#CCImage").html("NA");

        }

    }); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-04-27T07:12:51.583

这是一些用 Python 编写的布尔函数的示例，`True`如果根据函数名称检测到卡，则返回。

```
def is_american_express(cc_number):
    """Checks if the card is an american express. If us billing address country code, & is_amex, use vpos
    https://en.wikipedia.org/wiki/Bank_card_number#cite_note-GenCardFeatures-3
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^3[47][0-9]{13}$', cc_number))

def is_visa(cc_number):
    """Checks if the card is a visa, begins with 4 and 12 or 15 additional digits.
    :param cc_number: unicode card number
    """

    # Standard Visa is 13 or 16, debit can be 19
    if bool(re.match(r'^4', cc_number)) and len(cc_number) in [13, 16, 19]:
        return True

    return False

def is_mastercard(cc_number):
    """Checks if the card is a mastercard. Begins with 51-55 or 2221-2720 and 16 in length.
    :param cc_number: unicode card number
    """
    if len(cc_number) == 16 and cc_number.isdigit():  # Check digit, before cast to int
        return bool(re.match(r'^5[1-5]', cc_number)) or int(cc_number[:4]) in range(2221, 2721)
    return False

def is_discover(cc_number):
    """Checks if the card is discover, re would be too hard to maintain. Not a supported card.
    :param cc_number: unicode card number
    """
    if len(cc_number) == 16:
        try:
            # return bool(cc_number[:4] == '6011' or cc_number[:2] == '65' or cc_number[:6] in range(622126, 622926))
            return bool(cc_number[:4] == '6011' or cc_number[:2] == '65' or 622126 <= int(cc_number[:6]) <= 622925)
        except ValueError:
            return False
    return False

def is_jcb(cc_number):
    """Checks if the card is a jcb. Not a supported card.
    :param cc_number: unicode card number
    """
    # return bool(re.match(r'^(?:2131|1800|35\d{3})\d{11}$', cc_number))  # wikipedia
    return bool(re.match(r'^35(2[89]|[3-8][0-9])[0-9]{12}$', cc_number))  # PawelDecowski

def is_diners_club(cc_number):
    """Checks if the card is a diners club. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^3(?:0[0-6]|[68][0-9])[0-9]{11}$', cc_number))  # 0-5 = carte blance, 6 = international

def is_laser(cc_number):
    """Checks if the card is laser. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^(6304|670[69]|6771)', cc_number))

def is_maestro(cc_number):
    """Checks if the card is maestro. Not a supported card.
    :param cc_number: unicode card number
    """
    possible_lengths = [12, 13, 14, 15, 16, 17, 18, 19]
    return bool(re.match(r'^(50|5[6-9]|6[0-9])', cc_number)) and len(cc_number) in possible_lengths

# Child cards

def is_visa_electron(cc_number):
    """Child of visa. Checks if the card is a visa electron. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^(4026|417500|4508|4844|491(3|7))', cc_number)) and len(cc_number) == 16

def is_total_rewards_visa(cc_number):
    """Child of visa. Checks if the card is a Total Rewards Visa. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^41277777[0-9]{8}$', cc_number))

def is_diners_club_carte_blanche(cc_number):
    """Child card of diners. Checks if the card is a diners club carte blance. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^30[0-5][0-9]{11}$', cc_number))  # github PawelDecowski, jquery-creditcardvalidator

def is_diners_club_carte_international(cc_number):
    """Child card of diners. Checks if the card is a diners club international. Not a supported card.
    :param cc_number: unicode card number
    """
    return bool(re.match(r'^36[0-9]{12}$', cc_number))  # jquery-creditcardvalidator 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-03-08T09:49:47.953

> 卡号的前六位数字（包括初始 MII 数字）称为[发卡机构识别号](https://en.wikipedia.org/wiki/Payment_card_number#Issuer_identification_number_.28IIN.29)(IIN)。这些标识向持卡人发行卡的发卡机构。其余号码由发卡机构分配。卡号的长度是它的位数。许多发卡机构会在他们的卡上打印整个 IIN 和帐号。

基于上述事实，我想保留一段**JAVA**代码来识别卡品牌。

> 样本卡类型

```
public static final String AMERICAN_EXPRESS = "American Express";
public static final String DISCOVER = "Discover";
public static final String JCB = "JCB";
public static final String DINERS_CLUB = "Diners Club";
public static final String VISA = "Visa";
public static final String MASTERCARD = "MasterCard";
public static final String UNKNOWN = "Unknown"; 
```

> 卡前缀

```
// Based on http://en.wikipedia.org/wiki/Bank_card_number#Issuer_identification_number_.28IIN.29
public static final String[] PREFIXES_AMERICAN_EXPRESS = {"34", "37"};
public static final String[] PREFIXES_DISCOVER = {"60", "62", "64", "65"};
public static final String[] PREFIXES_JCB = {"35"};
public static final String[] PREFIXES_DINERS_CLUB = {"300", "301", "302", "303", "304", "305", "309", "36", "38", "39"};
public static final String[] PREFIXES_VISA = {"4"};
public static final String[] PREFIXES_MASTERCARD = {
        "2221", "2222", "2223", "2224", "2225", "2226", "2227", "2228", "2229",
        "223", "224", "225", "226", "227", "228", "229",
        "23", "24", "25", "26",
        "270", "271", "2720",
        "50", "51", "52", "53", "54", "55"
    }; 
```

> 检查输入号码是否有任何给定的前缀。

```
public String getBrand(String number) {

String evaluatedType;
if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_AMERICAN_EXPRESS)) {
    evaluatedType = AMERICAN_EXPRESS;
} else if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_DISCOVER)) {
    evaluatedType = DISCOVER;
} else if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_JCB)) {
    evaluatedType = JCB;
} else if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_DINERS_CLUB)) {
    evaluatedType = DINERS_CLUB;
} else if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_VISA)) {
    evaluatedType = VISA;
} else if (StripeTextUtils.hasAnyPrefix(number, PREFIXES_MASTERCARD)) {
    evaluatedType = MASTERCARD;
} else {
    evaluatedType = UNKNOWN;
}
    return evaluatedType;
} 
```

> 最后，实用程序方法

```
/**
  * Check to see if the input number has any of the given prefixes.
  *
  * @param number the number to test
  * @param prefixes the prefixes to test against
  * @return {@code true} if number begins with any of the input prefixes
*/

public static boolean hasAnyPrefix(String number, String... prefixes) {
  if (number == null) {
       return false;
  }
   for (String prefix : prefixes) {
       if (number.startsWith(prefix)) {
       return true;
    }
  }
     return false;
} 
```

**参考**

*   [条纹卡生成器](https://github.com/stripe/stripe-android/blob/master/stripe/src/main/java/com/stripe/android/model/Card.java)

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2019-10-04T18:43:22.283

试试这个 kotlin。添加正则表达式并添加到 when 语句。

```
private fun getCardType(number: String): String {

        val visa = Regex("^4[0-9]{12}(?:[0-9]{3})?$")
        val mastercard = Regex("^5[1-5][0-9]{14}$")
        val amx = Regex("^3[47][0-9]{13}$")

        return when {
            visa.matches(number) -> "Visa"
            mastercard.matches(number) -> "Mastercard"
            amx.matches(number) -> "American Express"
            else -> "Unknown"
        }
    } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-02-24T20:40:32.727

[匹配各个卡供应商](http://www.techrecite.com/credit-card-validation-regex-script-in-php-using-luhn-algorithm/)的正则表达式规则：

*   `(4\d{12}(?:\d{3})?)`签证。
*   `(5[1-5]\d{14})`万事达卡。
*   `(3[47]\d{13})`对于美国运通。
*   `((?:5020|5038|6304|6579|6761)\d{12}(?:\d\d)?)`为大师。
*   `(3(?:0[0-5]|[68][0-9])[0-9]{11})`为大来俱乐部。
*   `(6(?:011|5[0-9]{2})[0-9]{12})`为发现。
*   `(35[2-8][89]\d\d\d{10})`为 JCB。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-03-28T09:38:53.737

```
follow Luhn’s algorithm

 private  boolean validateCreditCardNumber(String str) {

        int[] ints = new int[str.length()];
        for (int i = 0; i < str.length(); i++) {
            ints[i] = Integer.parseInt(str.substring(i, i + 1));
        }
        for (int i = ints.length - 2; i >= 0; i = i - 2) {
            int j = ints[i];
            j = j * 2;
            if (j > 9) {
                j = j % 10 + 1;
            }
            ints[i] = j;
        }
        int sum = 0;
        for (int i = 0; i < ints.length; i++) {
            sum += ints[i];
        }
        if (sum % 10 == 0) {
           return true;
        } else {
            return false;
        }

    }

then call this method

Edittext mCreditCardNumberEt;

 mCreditCardNumberEt.addTextChangedListener(new TextWatcher() {
            @Override
            public void beforeTextChanged(CharSequence s, int start, int count, int after) {

            }

            @Override
            public void onTextChanged(CharSequence s, int start, int before, int count) {

             int cardcount=   s.toString().length();
                 if(cardcount>=16) {
                    boolean cardnumbervalid=   validateCreditCardNumber(s.toString());
                    if(cardnumbervalid) {
                        cardvalidtesting.setText("Valid Card");
                        cardvalidtesting.setTextColor(ContextCompat.getColor(context,R.color.green));
                    }
                    else {
                        cardvalidtesting.setText("Invalid Card");
                        cardvalidtesting.setTextColor(ContextCompat.getColor(context,R.color.red));
                    }
                }
               else if(cardcount>0 &&cardcount<16) {
                     cardvalidtesting.setText("Invalid Card");
                     cardvalidtesting.setTextColor(ContextCompat.getColor(context,R.color.red));
                }

                else {
                    cardvalidtesting.setText("");

                }

                }

            @Override
            public void afterTextChanged(Editable s) {

            }
        }); 
```

# c# - 具有托管代码问题的静态库

> ID：72769
> 
> 赞同：4
> 
> 时间：2008-09-16T14:16:47.433
> 
> 标签：c#, c++, managed

问题（简化以使事情更清楚）：

```
 extern int CallCount = 0;
    int TheFunction()
    {
        void *p = &CallCount;
        printf("Function called");
        return CallCount++;
    } 
```

2\. static.lib 链接到一个托管的 C++/CLI managed.dll 中，它包装了 TheFunction 方法：

```
 int Managed::CallLibFunc()
    {
        return TheFunction();
    } 
```

3\. 测试应用程序引用了 managed.dll 并创建了多个调用 C++/CLI 包装器的域：

```
 static void Main(string[] args)
    {
        Managed c1 = new Managed();
        int val1 = c1.CallLibFunc();
        // value is zero

        AppDomain ad = AppDomain.CreateDomain("NewDomain");
        Managed c = ad.CreateInstanceAndUnwrap(a.FullName, typeof(Managed).FullName) as Managed;
        int val2 = c.CallLibFunc();
        // value is one 
    } 
```

问题：

根据我在 Don Box 的 Essential .NET Vol1 The CLR 中所读到的内容，我希望 val2 为零，因为在调用 CreateInstanceAndUnwrap 时会加载 managed.dll/static.lib 的全新副本。我误解了正在发生的事情吗？静态库似乎不尊重 appdomain 边界，因为它是非托管代码。除了创建一个用于实例化托管的全新流程之外，还有其他方法可以解决此问题吗？

非常感谢大家！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T14:41:35.253

我的预感是，正如您所怀疑的那样，非托管 DLL 是在进程上下文中加载的，而不是在 AppDomain 的上下文中，因此非托管代码中的任何静态数据都在 AppDomain 之间共享。

[此链接](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/98cbabe0-33d6-4775-a3a7-04e71b7498dd/)显示了与您遇到相同问题的人，仍然没有 100% 验证此问题，但可能是这种情况。

[此链接](http://lambert.geek.nz/2007/05/29/unmanaged-appdomain-callback/)是关于使用 thunking 技巧从非托管代码创建回调到 AppDomain。我不确定这对您有帮助，但也许您会发现这对创建某种解决方法很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-28T18:49:57.933

打电话后

```
Managed c1 = new Managed(); 
```

您的 managed.dll 包装器将被加载到您的应用程序的主应用程序域中。直到它存在，来自 static.lib 的域非托管内容将与其他域共享。您只需确保（在每次调用之前）managed.dll 没有加载到任何应用程序域中，而不是创建单独的进程。

与之相比

```
static void Main(string[] args)
{

    {       
                AppDomain ad = AppDomain.CreateDomain("NewDomain");
                Managed c = ad.CreateInstanceAndUnwrap(a.FullName, typeof(Managed).FullName) as Managed;
                int val2 = c.CallLibFunc();
                //  Value is zero

               AppDomain.Unload(ad)
    }
    {       
                AppDomain ad = AppDomain.CreateDomain("NewDomain");
                Managed c = ad.CreateInstanceAndUnwrap(a.FullName, typeof(Managed).FullName) as Managed;
                int val2 = c.CallLibFunc();
                //  I think value is zero

               AppDomain.Unload(ad)
    }

}
` 
```

重要提示：如果您只添加一行，JIT 编译器将加载 managed.dll 并且魔法消失。

```
static void Main(string[] args)
{

    {       
                AppDomain ad = AppDomain.CreateDomain("NewDomain");
                Managed c = ad.CreateInstanceAndUnwrap(a.FullName, typeof(Managed).FullName) as Managed;
                int val2 = c.CallLibFunc();
                //  Value is zero 

               AppDomain.Unload(ad)
    }
    {       
                AppDomain ad = AppDomain.CreateDomain("NewDomain");
                Managed c = ad.CreateInstanceAndUnwrap(a.FullName, typeof(Managed).FullName) as Managed;
                int val2 = c.CallLibFunc();
                //  I think value is one

               AppDomain.Unload(ad)
    }
Managed c1 = new Managed(); 

} 
```

如果您不想依赖这些行，您可以创建另一个包装器 ManagedIsolated.dll，它将引用 managed.dll 并将在单独的域中进行每个调用，并在调用后立即卸载域。主应用程序将仅依赖于 ManagedIsolated.dll 类型，并且 Managed.dll 不会加载到主应用程序域中。

这看起来像是一个技巧，但可能对某人有用。`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:47:28.093

简而言之，也许。AppDomain 纯粹是一个托管概念。当 AppDomain 被实例化时，它不会映射到底层 DLL 的新副本中，它可以重用内存中已经存在的代码（例如，您不会期望它加载所有 System.* 程序集的新副本，对吧?)

在托管世界中，所有静态变量都由 AppDomain 限定，但正如您所指出的，这不适用于非托管世界。

您可以做一些复杂的事情，强制为每个应用程序域加载一个唯一的 managed.dll，这将导致一个新版本的静态库被带上来。例如，也许使用带有字节数组的 Assembly.Load 会起作用，但我不知道如果同一个程序集被加载两次，CLR 将如何尝试处理类型冲突。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T15:00:02.480

我不认为我们在这里解决了实际问题 -[请参阅这篇 DDJ 文章](http://www.ddj.com/windows/184405853)。

加载器优化属性的默认值为 SingleDomain，它“使 AppDomain 加载每个必要程序集代码的私有副本”。即使它是多域值之一，“每个 AppDomain 始终维护静态字段的不同副本”。

“managed.dll”（顾名思义）是一个托管程序集。static.lib 中的代码已被静态编译（作为 IL 代码）到“managed.dll”中，所以我期望与 Lenik 期望的行为相同......

...除非 static.lib 是非托管 DLL 的静态导出库。Lenik 说情况并非如此，所以我仍然不确定这里发生了什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T14:38:32.420

您是否尝试过在单独的进程中运行？静态库不应该在它自己的进程之外共享内存实例。

我知道，这可能很难管理。不过，我不确定在这种情况下您的其他选择是什么。

编辑：环顾四周后，我认为您可以使用[System.Diagnostics.Process](http://msdn.microsoft.com/en-us/library/system.diagnostics.process_members.aspx)类完成所需的一切。此时您将有很多用于通信的选项，但[.NET Remoting](http://msdn.microsoft.com/en-us/library/kwdt6w2k(VS.71).aspx)或 WCF 可能是不错且简单的选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T14:02:18.137

这是我在这个主题上找到的最好的两篇文章

*   [http://blogs.msdn.com/cbrumme/archive/2003/04/15/51317.aspx](http://blogs.msdn.com/cbrumme/archive/2003/04/15/51317.aspx)
*   [http://blogs.msdn.com/cbrumme/archive/2003/06/01/51466.aspx](http://blogs.msdn.com/cbrumme/archive/2003/06/01/51466.aspx)

重要的部分是：

> 基于 RVA 的静态字段是进程全局的。这些仅限于标量和值类型，因为我们不想让对象跨越 AppDomain 边界。这会导致各种问题，尤其是在 AppDomain 卸载期间。一些语言，如 ILASM 和 MC++，可以方便地定义基于 RVA 的静态字段。大多数语言没有。

好的，所以如果您控制 .lib 中的代码，我会尝试

```
class CallCountHolder {
   public:
     CallCountHolder(int i) : count(i) {}
     int count;
};

static CallCountHolder cc(0);
int TheFunction()
{
    printf("Function called");
    return cc.count++;
} 
```

因为他说基于 RVA 的静态字段仅限于标量和值类型。一个 int 数组也可以工作。

# sharepoint - 通过 Web Dav 界面创建 SharePoint 2007 列表项

> ID：72773
> 
> 赞同：1
> 
> 时间：2008-09-16T14:16:54.533
> 
> 标签：sharepoint

SharePoint 2007（Moss 和 Wss）通过 web dav 公开文档库，允许您通过本质上是文件系统级别的活动（例如，将文档保存到某个位置）来创建文档。

SharePoint 似乎也通过相同的 Web dav 界面公开列表，作为目录，但它们通常是空的。是否可以通过这种曝光以某种方式创建或操作列表项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T21:15:24.307

简而言之：没有。

更长的答案：有点。存储在 sharepoint 中的任何项目都在列表中，包括文件。但并非所有列表都有文件。文档库是一个列表，每个元素都是一个文件+元数据。其他列表（如公告）只是元数据。只有包含文件的列表才会通过 webdav 公开，即便如此，您也仅限于处理文件 - 无法使用 webdav (afaik) 来编辑元数据。

希望这可以帮助。

奥辛。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T04:00:58.873

不，但根据我的经验，大多数希望将 WebDAV 与某些东西说话的东西都非常希望与某种文件或文档一起工作。由于 SharePoint 中的非库列表实际上并没有关联文件（是的，它们可以有附件，但这不一样），因此实际上围绕（文档）构建的主要构造 WebDAV 是缺失的。您将从事什么创作和版本控制？

如果您正在编写自己的客户端，则可以使用[强大的 Web 服务](http://msdn.microsoft.com/en-us/library/lists.aspx)与列表交互（包括库和非库变体）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:25:10.150

同意。唯一暴露给 webdav 的是列表项的附件（或库的文档）。即使您在资源管理器中调出文件的属性，也没有列表数据的选项。

如果您正在使用 Office 2007 文档，您可以创建一个可以绑定到 sharepoint的[文档信息面板。](http://msdn.microsoft.com/en-us/library/ms550037.aspx)

# c++ - 在 Visual Studio 2005 中更改应用程序图标？

> ID：72789
> 
> 赞同：8
> 
> 时间：2008-09-16T14:17:51.800
> 
> 标签：c++, visual-studio-2005, icons, visual-c++-2005

我想为我的游戏的演示版本使用不同的图标，并且我正在使用与完整版本不同的构建配置构建演示，使用预处理器定义锁定某些内容，使用不同的图形，等有没有一种方法可以让 Visual Studio 在演示配置中为应用程序图标使用不同的图标，但继续对完整版的配置使用常规图标？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T14:25:35.883

根据[此页面](http://msdn.microsoft.com/en-us/library/aa381033(VS.85).aspx)，您可以在 *.rc 文件中使用预处理器指令。你应该写这样的东西

```
#ifdef _DEMO_VERSION_
IDR_MAINFRAME ICON "demo.ico"
#else
IDR_MAINFRAME ICON "full.ico"
#endif 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T14:25:44.730

我要做的是设置一个预构建事件（项目属性-> 配置属性-> 构建事件-> 预构建事件）。预构建事件是一个命令行。我会使用它来将适当的图标文件复制到构建图标。

例如，假设您的构建图标是“app.ico”。我会制作我的全图标“app_full.ico”和我的演示图标“app_demo.ico”。然后我将我的预构建事件设置如下：

完整模式预构建事件：

```
del app.ico | copy app_full.ico app.ico 
```

演示模式预构建事件：

```
del app.ico | copy app_demo.ico app.ico 
```

我希望这会有所帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:23:27.870

这会让你走到一半： http: [//www.codeproject.com/KB/dotnet/embedmultipleiconsdotnet.aspx](http://www.codeproject.com/KB/dotnet/embedmultipleiconsdotnet.aspx)

然后你需要找到 Win32 调用，它将从嵌入的图标列表中设置显示的图标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:24:27.963

我不知道Visual Studio中的方法，因为应用程序设置绑定到孔项目。但是一种简单的方法是使用 PreBuild 事件并将 app.demo.ico 复制到 app.ico 或将 app.release.ico 复制到 app.ico 要求键 $(ConfigurationName) 的值并引用应用程序。 ico 在你的项目目录中。

# .net - 在绑定到 DataGridView 的 DataTable 上触发更新

> ID：72791
> 
> 赞同：5
> 
> 时间：2008-09-16T14:18:00.880
> 
> 标签：.net, data-binding, forms, datagridview, datatable

在我的 .NET/Forms 应用程序中，我有一个绑定到 DataTable 的 DataGridView。用户通过双击选择 DataGridView 的一行并与应用程序进行一些交互。之后，该行的内容以编程方式更新。

当用户选择新行时，框架会自动将前一行的更改传播到 DataTable。如何从我的代码中触发此更新，以便用户不必选择新行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T00:04:09.050

我刚遇到同样的问题，在[这里](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.iscurrentrowdirty.aspx)找到了答案：

> 当用户离开该行时，控件提交所有行更改。用户还可以按 CTRL+ENTER 来提交行更改而不离开行。要以编程方式提交行更改，请调用表单的 Validate 方法。如果您的数据源是 BindingSource，您还可以调用 BindingSource.EndEdit。

调用 Validate() 对我有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T14:54:49.170

I guess it depends on what triggers the update to take place, if it is in a validation routine you could simply call that after the user clicks OK on editing the data. Your question is vague it would be easier to answer with more information. What is this interaction? Is it a dialog? What actually updates the data?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T16:24:19.517

以下是澄清这一点的过程：

1.  用户双击行
2.  应用程序从 db 中获取数据，处理获取的数据并在与 DataGridView 相同的表单上填充控件
3.  用户与控件交互并最终在同一个表单上按下应用按钮
4.  应用程序处理控件的状态，将数据写入 db 并将数据写入 DataGridView

5.  IF 用户在 DataGridView 上移动选择

6.  THEN 更改传播到绑定的 DataTable

从我的代码修改 DataGridView 后，我想立即触发 6。

# delphi - Qt 或 Delphi ...如果您要选择其中之一？

> ID：72799
> 
> 赞同：13
> 
> 时间：2008-09-16T14:18:25.527
> 
> 标签：delphi, qt

如果你在冒险进入 Delphi 领域或 Qt 领域有差异，你会选择哪一个？我知道它们不完全可比。我有 Builder C++（几乎是 Delphi）和 MFC（几乎是 Qt）的 Windows 开发经验，并有更多时间使用 Builder C++。请在分析中去掉 Qt 的跨平台能力。

我希望得到与两者合作过的人的回复，以及他或她将如何比较框架、环境等？

预先感谢您的回复。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-16T14:35:37.873

如果您在谈论 UI 框架，那么您应该将 Qt 与 VCL 进行比较，而不是 IDE（在本例中为 Delphi）。我知道我很固执，但 Delphi 是 IDE，Object-Pascal 是语言，VCL 是图形框架。

话虽如此，我认为没有任何东西可以与 VCL 的功能和简单性相媲美。Qt 很棒，但它不是 VCL。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-17T11:32:42.423

**编辑：这个答案写于*2008 年*。它可能不再那么贴切了，尽管它可能并非完全没用。与盐一起服用。**

我两者都使用过，最终选择了 Qt 路线。这些是原因：

*   奇趣科技通过电子邮件提供快速的一对一支持
*   Qt 不断创新，并定期推出强大的新功能
*   Qt 文档很棒，在极少数情况下，您可以阅读源代码
*   拥有 Qt 的源代码还可以让您在基本库中进行调试，这在很多情况下对我来说是救命稻草
*   API 非常一致且设计良好。我们已经让新人加入了这个项目，并且在一个月内他们就展示了对工具包的深入了解，并且可以非常快速地学习新课程
*   它具有与其他语言的绑定，例如。红宝石和 Python。

C++ 有点缺点，例如。编译时间、打包和集成度较低的 IDE。然而，Qt 确实让 C++ 感觉更像是一种高级语言。例如，QStrings 消除了字符串处理的所有痛苦。因此，您通常会面临 C++ 的其他问题，例如。更多错误代码，在我使用 Qt 时的经验中不太普遍。

此外，Delphi 的库比 Qt 的要多，但是由于您可以在 Qt 项目中使用 ac 或 c++ 库，并且由于 Qt 功能如此齐全，您通常不必查看任何内容，因此可以减轻这种情况更远。

对于一个新项目，我会选择 Delphi 而不是 Qt，这将是一个奇怪的情况。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-16T15:28:25.080

我会选择德尔福。当然，你问任何pascalholic，他肯定会回答同样的问题。;)

Qt 再次很好，但 VCL 感觉更精致。但这可能是我多年来使用它的工作，所以感觉很好。我对 Qt 的体验仅限于一个短暂的项目，在确定跨平台并不是真正需要之后最终在 Delphi 中重写，这要归功于[GoGlobal](http://www.resource-dynamics.com/goglobal.asp)的强大功能，它可以使任何 win32 应用程序成为 Web 应用程序，因此可以在任何平台。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-18T13:02:15.850

这实际上取决于您的需求和经验。我都使用过（尽管不得不说我真正使用的最后一个 Delphi 版本是 Delphi 6，而我目前正在使用 Qt 4.4）。

**语言**

C++ 优点：

*   C++ 更“标准”，例如你会发现更多的代码、库、示例等，你可以自由使用 STL 和 boost，而 Object Pascal 更像是一门外来语言
*   Qt 在不同平台和编译器上编译（Kylix 基于 Qt，BTW）

对象帕斯卡优点：

*   语言中内置了一些动态属性，不需要像 MOC 这样的丑陋变通方法
*   编译器针​​对该语言进行了高度优化，并且确实非常快
*   该语言没有 C++ 复杂，因此不易出错

**IDE**

Qt 优点：

*   严格来说，除了 Designer 之外，没有 Qt 的 IDE，但它可以很好地集成到您首选的 IDE（至少是 Visual Studio 和 Eclipse）中
*   与 Delphi 表单相比，设计师在布局方面做得更好（注意：这是基于 Delphi 6 的经验，当前版本可能并非如此）

德尔福优点：

*   IDE 现在真的很精致且易于使用，它明显优于 Visual Studio IMO（我没有使用 Eclipse 的经验）
*   没有第 2 点……但如果我必须将流行词“集成”分配给 Delphi IDE

**框架**

我将与其他人进行比较，因为我不知道最新的 VCL 是否足够好。我有几点意见：

*   两个框架都涵盖了大部分需要的功能
*   两者都有可用的源代码，这是 IMO 必须的
*   两者都有或多或少一致的结构 - 我更喜欢 Qt，但这取决于你的偏好（备注：我永远不会说 Qt 几乎是 MFC - 我已经使用 MFC 很长时间了，Qt 和 Delphi 都使用过 - 和 .NET ，就此而言-更好）
*   VCL 具有更多面向 DB 的功能，尤其是与可视化组件的连接
*   Qt 有更多面向绘画（2D / 3D / OpenGL）的功能

Qt IMO 的其他原因是非常好的支持和许可，但这取决于您的需求。这两个框架都有大型社区，

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T22:25:52.200

Delphi 和 Qt 之间的一个很大区别是 Qt 信号/插槽系统，这使得在对象之间创建 N 对 N 关系并避免紧密耦合变得非常容易。

我认为Delphi中不存在这样的东西（至少我以前使用它时没有这样的东西）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-14T20:24:12.607

我刚刚开始尝试使用 Qt/C++/Qt Creator，我必须承认我很惊讶这个“小可爱混蛋”在我的鼻子下面已经有很多年了，我现在才注意到它。

它（框架）看起来很整洁，功能齐全（甚至是 .NET 所缺乏的东西，例如内置的 XQuery 支持）。

似乎大多数编写的 Qt 应用程序都在处理 2D/3D/游戏。

我认为缺点只是：必须了解 C++ 以及缺乏像 QuantumGrid 这样的 DevExpress 好东西。

我正在认真考虑移植我的一个简单应用程序（像 ThumbsView 这样的图片查看器）。

它真的从同一个代码库运行。真的！

忘记 Kylix、Mono、Lazarus、Free Pascal。这个 Qt 东西在 10 次内击败了他们。

Qt Creator 与 IDE 相去甚远。但我希望将来他们会添加更强大的调试器、代码洞察和重构（至少是“重命名”）和更有意义的编译器错误。

我会认真地向没有 Pascal/C++ 经验的人推荐 Qt 学习曲线。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T14:25:22.717

我会选择Delphi，但这可能是因为我以前编写过它。似乎还有很多公司在使用它，几乎每个有 8 年以上经验的人都在某个地方遇到过它。似乎大多数程序员都可以使用它或至少学习 Pascal。更不用说较新的语言（C#）基于它（至少部分）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-18T13:13:55.977

如果您关心的是原生 Win32 速度、一流的 RAD 环境和可执行文件大小，请选择 Delphi。如果您需要一个真正的跨平台框架以及现在灵活的许可政策，并且不介意稍微臃肿的代码，请选择 QT。

我在QT/C++下移植了一个旧的Delphi程序，不得不说QT是在易用性和功耗方面最接近VCL的框架（恕我直言）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T14:21:18.517

我会选择德尔福。只是因为我有更多的经验。我认为没有其他合理的标准。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T14:26:14.743

Qt 是跨平台的，如果算上 Kylix，Delphi 就不算什么了。Lazarus 是跨平台的，但功能还不完善。

# soap - WSDL 生成工具

> ID：72829
> 
> 赞同：12
> 
> 时间：2008-09-16T14:21:31.090
> 
> 标签：soap, wsdl

谁能推荐一个好的（最好是开源的）工具来为一些肥皂网络服务创建 WSDL 文件？

我尝试过使用一些可用的 eclipse 插件，但对我的发现印象不深。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T14:56:58.273

As mentioned above, probably the easiest thing to do is use Apache CXF or Apache Axis2 to automatically generate your WSDL for you.

If you have downloaded the Java EE version of Eclipse, you should be able to create a Dynamic Web Project with the Axis2 facets. If you create a simple Java class in the project, you should be able to right-click on it, and choose Web Services->Create Web Service. That should automatically create an Axis2 service for you.

WSDL would then be available from some URL like: `http://localhost/axis/{yourservice}?WSDL`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T19:27:28.957

绕过与 WSDL 相关的所有难题的更有趣的工具之一是由 Arjen Poutsma（Spring Web 服务的首席开发人员）创建的 XSLT 脚本：

[http://blog.springframework.com/arjen/archives/2006/07/27/xslt-that-transforms-from-xsd-to-wsdl/](http://blog.springframework.com/arjen/archives/2006/07/27/xslt-that-transforms-from-xsd-to-wsdl/)

基本上，它允许您开发与所需操作（即`<BuyItem>`和`<BuyItemResponse>`）相对应的简单模式，然后从 XSD 生成所有相关联的 WSDL 废话。如果您对“合同优先”的 Web 服务感兴趣，我强烈推荐它，但是使用 WSDL 作为该合同的起点的想法会让您感到绿色。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T14:31:38.617

我厌倦了在文件系统上生成大量文件只是为了通过 SOAP 传输。现在，我将[Apache CXF](http://cxf.apache.org/)用于 WS 生产者和消费者，并让它动态处理 WSDL/存根生成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:33:26.660

取决于您使用的语言，但如果您在 Java 中很活跃，那么我建议您查看[Apache CXF](http://cxf.apache.org/)。它是一个非常可靠的框架，用于将 java 代码发布为 SOAP Web 服务。它还包括一个直接生成 WSDL 文件的工具：[java2wsdl](http://cwiki.apache.org/CXF20DOC/java-to-wsdl.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-30T13:58:43.553

可以在 www.cofiq.com 上找到作为 SAAS 解决方案的不错的工具。它的强项是数据模型存储库，可以从中生成 WSDL 和 REST JSON 并对数据模型更改进行影响分析。

# c# - 如何在C#中将名字和姓氏的第一个字母大写？

> ID：72831
> 
> 赞同：141
> 
> 时间：2008-09-16T14:21:37.017
> 
> 标签：c#, string, capitalize

有没有一种简单的方法可以将字符串的第一个字母大写并降低其余部分？有内置方法还是我需要自己制作？

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2008-09-16T14:24:58.943

`TextInfo.ToTitleCase()`将字符串的每个标记中的第一个字符大写。
如果不需要维护 Acronym Uppercasing，那么你应该包括`ToLower()`.

```
string s = "JOHN DOE";
s = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(s.ToLower());
// Produces "John Doe" 
```

如果 CurrentCulture 不可用，请使用：

```
string s = "JOHN DOE";
s = new System.Globalization.CultureInfo("en-US", false).TextInfo.ToTitleCase(s.ToLower()); 
```

有关详细说明，请参阅[MSDN 链接](http://msdn2.microsoft.com/en-us/library/system.globalization.textinfo.totitlecase.aspx)。

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2008-09-16T14:25:21.877

```
CultureInfo.CurrentCulture.TextInfo.ToTitleCase("hello world"); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2010-07-02T22:06:28.610

```
String test = "HELLO HOW ARE YOU";
string s = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(test); 
```

上面的代码不会工作......

所以把下面的代码转换为低然后应用函数

```
String test = "HELLO HOW ARE YOU";
string s = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(test.ToLower()); 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-10-22T12:17:57.100

有些情况`CultureInfo.CurrentCulture.TextInfo.ToTitleCase`无法处理，例如：撇号`'`。

```
string input = CultureInfo.CurrentCulture.TextInfo.ToTitleCase("o'reilly, m'grego, d'angelo");
// input = O'reilly, M'grego, D'angelo 
```

正**则表达式**也可用于`\b[a-zA-Z]`在单词边界之后识别单词的起始字符`\b`，然后我们只需将匹配替换为大写等效项，这要归功于以下[`Regex.Replace(string input,string pattern,MatchEvaluator evaluator)`](http://msdn.microsoft.com/fr-fr/library/vstudio/ht1sxswy%28v=vs.110%29.aspx)方法：

```
string input = "o'reilly, m'grego, d'angelo";
input = Regex.Replace(input.ToLower(), @"\b[a-zA-Z]", m => m.Value.ToUpper());
// input = O'Reilly, M'Grego, D'Angelo 
```

如果需要，可以调整正则表达式，例如，如果我们要处理和**情况**`MacDonald`，`McFry`正则表达式变为：`(?<=\b(?:mc|mac)?)[a-zA-Z]`

```
string input = "o'reilly, m'grego, d'angelo, macdonald's, mcfry";
input = Regex.Replace(input.ToLower(), @"(?<=\b(?:mc|mac)?)[a-zA-Z]", m => m.Value.ToUpper());
// input = O'Reilly, M'Grego, D'Angelo, MacDonald'S, McFry 
```

如果我们需要处理更多前缀，我们只需要修改组`(?:mc|mac)`，例如添加法语前缀`du, de`: `(?:mc|mac|du|de)`。

最后，我们可以意识到这个**正则表达式**也将匹配`MacDonald'S`最后一个的大小写，`'s`所以我们需要在**正则表达式**中处理它，并带有否定的外观`(?<!'s\b)`。最后我们有：

```
string input = "o'reilly, m'grego, d'angelo, macdonald's, mcfry";
input = Regex.Replace(input.ToLower(), @"(?<=\b(?:mc|mac)?)[a-zA-Z](?<!'s\b)", m => m.Value.ToUpper());
// input = O'Reilly, M'Grego, D'Angelo, MacDonald's, McFry 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-16T15:38:18.067

Mc 和 Mac 是美国常见的姓氏前缀，还有其他姓氏前缀。TextInfo.ToTitleCase 不处理这些情况，不应用于此目的。这是我的做法：

```
 public static string ToTitleCase(string str)
    {
        string result = str;
        if (!string.IsNullOrEmpty(str))
        {
            var words = str.Split(' ');
            for (int index = 0; index < words.Length; index++)
            {
                var s = words[index];
                if (s.Length > 0)
                {
                    words[index] = s[0].ToString().ToUpper() + s.Substring(1);
                }
            }
            result = string.Join(" ", words);
        }
        return result;
    } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-16T14:25:03.343

ToTitleCase() 应该适合你。

[http://support.microsoft.com/kb/312890](http://support.microsoft.com/kb/312890)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-16T14:26:44.120

最直接的选择是使用 .NET 中可用的[ToTitleCase](http://support.microsoft.com/kb/312890)函数，它应该在大多数时间处理名称。正如[edg](https://stackoverflow.com/questions/72831/how-do-i-capitalize-first-letter-of-first-name-and-last-name-in-c#72850)指出的那样，有一些名称不起作用，但这些名称相当罕见，因此除非您的目标是此类名称很常见的文化，否则您不必担心太多。

但是，如果您不使用 .NET 语言，那么这取决于输入的外观 - 如果您有两个单独的名字和姓氏字段，那么您可以将第一个字母大写，然后使用子串。

```
firstName = firstName.Substring(0, 1).ToUpper() + firstName.Substring(1).ToLower();
lastName = lastName.Substring(0, 1).ToUpper() + lastName.Substring(1).ToLower(); 
```

但是，如果您提供了多个名称作为同一字符串的一部分，那么您需要知道如何获取信息并相应[地对其进行拆分](http://msdn.microsoft.com/en-us/library/ms228388(VS.80).aspx)。所以如果你得到一个像“John Doe”这样的名字，你可以根据空格字符拆分字符串。如果它采用诸如“Doe, John”之类的格式，您将需要根据逗号对其进行拆分。但是，一旦将其拆分，您只需应用前面显示的代码。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-16T14:27:52.167

CultureInfo.CurrentCulture.TextInfo.ToTitleCase（“我的名字”）；

返回~我的名字

但是，如前所述，像 McFly 这样的名称仍然存在问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-01-21T13:10:20.207

我用我自己的方法来解决这个问题：

例如短语：“你好世界。你好，这是 stackoverflow 世界。” 将是“Hello World。Hello This Is The Stackoverflow World。”。正则表达式 \b （单词的开头） \w （单词的第一个字符）可以解决问题。

```
/// <summary>
/// Makes each first letter of a word uppercase. The rest will be lowercase
/// </summary>
/// <param name="Phrase"></param>
/// <returns></returns>
public static string FormatWordsWithFirstCapital(string Phrase)
{
     MatchCollection Matches = Regex.Matches(Phrase, "\\b\\w");
     Phrase = Phrase.ToLower();
     foreach (Match Match in Matches)
         Phrase = Phrase.Remove(Match.Index, 1).Insert(Match.Index, Match.Value.ToUpper());

     return Phrase;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-16T15:37:53.120

使用 ToTitleCase 的建议不适用于全大写的字符串。因此，您必须在第一个字符上调用 ToUpper，在剩余字符上调用 ToLower。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-16T16:06:45.860

这个类可以解决问题。您可以向**_prefixes**静态字符串数组添加新前缀。

```
public static class StringExtensions
{
        public static string ToProperCase( this string original )
        {
            if( String.IsNullOrEmpty( original ) )
                return original;

            string result = _properNameRx.Replace( original.ToLower( CultureInfo.CurrentCulture ), HandleWord );
            return result;
        }

        public static string WordToProperCase( this string word )
        {
            if( String.IsNullOrEmpty( word ) )
                return word;

            if( word.Length > 1 )
                return Char.ToUpper( word[0], CultureInfo.CurrentCulture ) + word.Substring( 1 );

            return word.ToUpper( CultureInfo.CurrentCulture );
        }

        private static readonly Regex _properNameRx = new Regex( @"\b(\w+)\b" );
        private static readonly string[] _prefixes = {
                                                         "mc"
                                                     };

        private static string HandleWord( Match m )
        {
            string word = m.Groups[1].Value;

            foreach( string prefix in _prefixes )
            {
                if( word.StartsWith( prefix, StringComparison.CurrentCultureIgnoreCase ) )
                    return prefix.WordToProperCase() + word.Substring( prefix.Length ).WordToProperCase();
            }

            return word.WordToProperCase();
        }
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T14:28:27.407

如果您使用 vS2k8，您可以使用扩展方法将其添加到 String 类：

```
public static string FirstLetterToUpper(this String input)
{
    return input = input.Substring(0, 1).ToUpper() + 
       input.Substring(1, input.Length - 1);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T16:08:00.990

为了解决一些突出显示的问题/问题，我建议先将字符串转换为小写，然后调用 ToTitleCase 方法。然后，您可以使用 IndexOf(" Mc") 或 IndexOf(" O\'") 来确定需要更具体注意的特殊情况。

```
inputString = inputString.ToLower();
inputString = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(inputString);
int indexOfMc = inputString.IndexOf(" Mc");
if(indexOfMc  > 0)
{
   inputString.Substring(0, indexOfMc + 3) + inputString[indexOfMc + 3].ToString().ToUpper() + inputString.Substring(indexOfMc + 4);
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-09-13T19:22:18.173

我喜欢这种方式：

```
using System.Globalization;
...
TextInfo myTi = new CultureInfo("en-Us",false).TextInfo;
string raw = "THIS IS ALL CAPS";
string firstCapOnly = myTi.ToTitleCase(raw.ToLower()); 
```

摘自这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.globalization.textinfo.totitlecase%28v=vs.100%29.aspx)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-02T11:37:49.390

希望这对您有所帮助。

```
String fName = "firstname";
String lName = "lastname";
String capitalizedFName = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(fName);
String capitalizedLName = CultureInfo.CurrentCulture.TextInfo.ToTitleCase(lName); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-11-30T06:50:31.607

```
 public static string ConvertToCaptilize(string input)
        {
            if (!string.IsNullOrEmpty(input))
            {
                string[] arrUserInput = input.Split(' ');

                // Initialize a string builder object for the output
                StringBuilder sbOutPut = new StringBuilder();

                // Loop thru each character in the string array
                foreach (string str in arrUserInput)
                {
                    if (!string.IsNullOrEmpty(str))
                    {
                        var charArray = str.ToCharArray();
                        int k = 0;
                        foreach (var cr in charArray)
                        {
                            char c;
                            c = k == 0 ? char.ToUpper(cr) : char.ToLower(cr);
                            sbOutPut.Append(c);
                            k++;
                        }

                    }
                    sbOutPut.Append(" ");
                }
                return sbOutPut.ToString();
            }
            return string.Empty;

        } 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-16T14:30:35.077

就像 edg 指出的那样，您需要一个更复杂的算法来处理特殊名称（这可能是许多地方强制所有内容大写的原因）。

像这样未经测试的 c# 应该处理您请求的简单案例：

```
public string SentenceCase(string input)
{
    return input(0, 1).ToUpper + input.Substring(1).ToLower;
} 
```

# .net - 我可以在全球范围内禁止 FX Cop 代码分析违规行为吗？

> ID：72832
> 
> 赞同：9
> 
> 时间：2008-09-16T14:21:38.967
> 
> 标签：.net, visual-studio, code-analysis

当您使用 Visual Studio 的代码分析 (FxCop) 并想要禁止显示消息时，有 3 个选项。

1.  禁止代码中的违规。
2.  抑制 GlobalSupression.cs 文件中的违规。
3.  禁用项目文件中的违规检查（通过项目 -> 属性 -> 代码分析）。

后者在签入源代码控制时很难查看，并且很难获得所有禁用违规的概览。所以我们想使用选项2。

选项 1 和 2 的问题是每次违规都会获得一条抑制线。例如：

```
[assembly: SuppressMessage("Microsoft.Design", "CA1020:AvoidNamespacesWithFewTypes", Scope = "namespace", Target = "Company.Project.Namespace2")]
[assembly: SuppressMessage("Microsoft.Design", "CA1020:AvoidNamespacesWithFewTypes", Scope = "namespace", Target = "Company.Project.Namespace1")] 
```

我们很乐意在 GlobalSuppressions.cs 中做这样的事情：

```
[assembly: SuppressMessage("Microsoft.Design", "CA1020:AvoidNamespacesWithFewTypes")] 
```

但这可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T15:07:44.863

官方不支持使用单个**SuppressMessage属性抑制多个违规行为。**显然，这是设计使然。

我同意，有时可能很烦人，但我不能说我不同意这个决定，因为这个属性是他们强迫你说“是的，我知道我在做什么”的方式，应该在根据具体情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-21T09:16:17.133

我认为自从发布并回答了这个问题以来，情况已经发生了变化。对于 Visual Studio 2010 和 2012，您可以创建自定义“规则集”文件，您可以在其中指定要禁止的代码分析规则。

[http://msdn.microsoft.com/en-us/library/dd380660.aspx](http://msdn.microsoft.com/en-us/library/dd380660.aspx)

所以我所做的是创建一个自定义规则集文件，该文件位于我的存储库源集合的顶级文件夹中，并且我在每个 Visual Studio 项目中引用该文件。这意味着我有一个中心位置可以抑制我根本无法忍受的代码分析规则。但是，如果我改变主意，或者决定重新考虑我的不良编码习惯，我可以非常简单地重新启用规则并查看我收到了多少代码分析消息。

# python - 如何在 Python 中进行相对导入？

> ID：72852
> 
> 赞同：576
> 
> 时间：2008-09-16T14:24:02.330
> 
> 标签：python, python-import, python-module

想象一下这个目录结构：

```
app/
   __init__.py
   sub1/
      __init__.py
      mod1.py
   sub2/
      __init__.py
      mod2.py 
```

我正在编码`mod1`，我需要从`mod2`. 我该怎么做？

我试过`from ..sub2 import mod2`了，但我得到了一个“尝试在非包中进行相对导入”。

我四处搜索，但只发现“`sys.path`操纵”黑客。没有干净的方法吗？

* * *

编辑：我所有`__init__.py`的目前都是空的

Edit2：我正在尝试这样做，因为 sub2 包含跨子包（，等）共享的`sub1`类`subX`。

Edit3：我正在寻找的行为与[PEP 366](http://www.python.org/dev/peps/pep-0366/)中描述的行为相同（感谢 John B）

* * *

## 回答 #1

> 赞同：368
> 
> 时间：2008-09-16T14:48:56.873

每个人似乎都想告诉你应该做什么，而不仅仅是回答问题。

问题是您通过将 mod1.py 作为参数传递给解释器来将模块作为 '__main__' 运行。

来自[PEP 328](http://www.python.org/dev/peps/pep-0328/)：

> 相对导入使用模块的 __name__ 属性来确定该模块在包层次结构中的位置。如果模块的名称不包含任何包信息（例如，它被设置为'__main__'），那么无论模块实际位于文件系统的哪个位置，相对导入都会被解析为模块是顶级模块。

在 Python 2.6 中，他们添加了相对于主模块引用模块的能力。 [PEP 366](http://python.org/dev/peps/pep-0366/)描述了这种变化。

**更新**：根据 Nick Coghlan 的说法，推荐的替代方法是使用 -m 开关在包内运行模块。

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2013-03-17T07:43:34.060

这是对我有用的解决方案：

我执行相对导入 `from ..sub2 import mod2` ，然后，如果我想运行，`mod1.py`然后我转到父目录`app`并使用 python -m 开关运行模块 as `python -m app.sub1.mod1`。

相对导入出现此问题的真正原因是相对导入通过获取`__name__`模块的属性来工作。如果模块正在直接运行，则`__name__`设置为`__main__`，并且它不包含任何有关包结构的信息。而且，这就是 python 抱怨`relative import in non-package`错误的原因。

因此，通过使用 -m 开关，您可以向 python 提供包结构信息，通过它可以成功解析相关导入。

我在做相对导入时多次遇到这个问题。而且，在阅读了所有先前的答案之后，我仍然无法弄清楚如何以一种干净的方式解决它，而无需将样板代码放入所有文件中。（虽然有些评论真的很有帮助，但感谢@ncoghlan 和@XiongChiamiov）

希望这对正在与相关进口问题作斗争的人有所帮助，因为通过 PEP 真的不好玩。

* * *

## 回答 #3

> 赞同：128
> 
> 时间：2009-01-21T12:42:11.840

```
main.py
setup.py
app/ ->
    __init__.py
    package_a/ ->
       __init__.py
       module_a.py
    package_b/ ->
       __init__.py
       module_b.py 
```

1.  你跑`python main.py`。
2.  `main.py`做：`import app.package_a.module_a`
3.  `module_a.py`做`import app.package_b.module_b`

或者 2 或 3 可以使用：`from app.package_a import module_a`

只要您`app`在 PYTHONPATH 中，它就会起作用。`main.py`那时可能在任何地方。

因此，您编写一个`setup.py`将整个应用程序包和子包复制（安装）到目标系统的 python 文件夹和`main.py`目标系统的脚本文件夹。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2011-11-19T16:05:29.897

“Guido 将包中的运行脚本视为反模式”（拒绝 [PEP-3122](http://www.python.org/dev/peps/pep-3122/)）

我花了很多时间试图找到解决方案，阅读 Stack Overflow 上的相关帖子，并对自己说“一定有更好的方法！”。好像没有。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2016-02-11T12:01:50.573

这是100％解决的：

*   应用程序/
    *   主文件
*   设置/
    *   local_settings.py

在 app/main.py 中导入 settings/local_setting.py：

主要.py：

```
import sys
sys.path.insert(0, "../settings")

try:
    from local_settings import *
except ImportError:
    print('No Import') 
```

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2013-12-08T03:19:42.223

`nosklo's`用例子解释答案

*注意：所有`__init__.py`文件都是空的。*

```
main.py
app/ ->
    __init__.py
    package_a/ ->
       __init__.py
       fun_a.py
    package_b/ ->
       __init__.py
       fun_b.py 
```

### 应用程序/package_a/fun_a.py

```
def print_a():
    print 'This is a function in dir package_a' 
```

### 应用程序/package_b/fun_b.py

```
from app.package_a.fun_a import print_a
def print_b():
    print 'This is a function in dir package_b'
    print 'going to call a function in dir package_a'
    print '-'*30
    print_a() 
```

### 主文件

```
from app.package_b import fun_b
fun_b.print_b() 
```

如果你运行`$ python main.py`它返回：

```
This is a function in dir package_b
going to call a function in dir package_a
------------------------------
This is a function in dir package_a 
```

*   main.py 做：`from app.package_b import fun_b`
*   fun_b.py 确实`from app.package_a.fun_a import print_a`

所以文件夹中的文件`package_b`使用了文件夹中的文件`package_a`，这就是你想要的。对？？

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2009-07-04T23:27:50.467

```
def import_path(fullpath):
    """ 
    Import a file with full path specification. Allows one to
    import from anywhere, something __import__ does not do. 
    """
    path, filename = os.path.split(fullpath)
    filename, ext = os.path.splitext(filename)
    sys.path.append(path)
    module = __import__(filename)
    reload(module) # Might be out of date
    del sys.path[-1]
    return module 
```

我正在使用此代码段从路径中导入模块，希望对您有所帮助

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-03-02T22:58:47.093

不幸的是，这是一个 sys.path hack，但效果很好。

我在另一层遇到了这个问题：我已经有一个指定名称的模块，但它是错误的模块。

我想做的是以下（我正在使用的模块是module3）：

```
mymodule\
   __init__.py
   mymodule1\
      __init__.py
      mymodule1_1
   mymodule2\
      __init__.py
      mymodule2_1

import mymodule.mymodule1.mymodule1_1 
```

请注意，我已经安装了 mymodule，但在我的安装中我没有“mymodule1”

我会得到一个 ImportError ，因为它试图从我安装的模块中导入。

我试图做一个 sys.path.append，但没有奏效。起作用的是**sys.path.insert**

```
if __name__ == '__main__':
    sys.path.insert(0, '../..') 
```

有点像黑客，但一切正常！所以请记住，如果您希望自己的决定**覆盖其他路径**，那么您需要使用 sys.path.insert(0, pathname) 让它工作！这对我来说是一个非常令人沮丧的症结，很多人说要对 sys.path 使用“附加”功能，但是如果您已经定义了一个模块，那将不起作用（我觉得这是非常奇怪的行为）

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2013-01-07T04:26:52.227

让我把它放在这里供我自己参考。我知道这不是好的 Python 代码，但我需要一个用于我正在处理的项目的脚本，并且我想将脚本放在一个`scripts`目录中。

```
import os.path
import sys
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))) 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2015-06-09T15:22:27.963

正如@EvgeniSergeev 在对 OP 的评论中所说，您可以从`.py`任意位置的文件中导入代码：

```
import imp

foo = imp.load_source('module.name', '/path/to/file.py')
foo.MyClass() 
```

这是取自[这个 SO answer](https://stackoverflow.com/a/67692/2071807)。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2011-09-24T19:31:57.547

看看[http://docs.python.org/whatsnew/2.5.html#pep-328-absolute-and-relative-imports](http://docs.python.org/whatsnew/2.5.html#pep-328-absolute-and-relative-imports)。你可以做

```
from .mod1 import stuff 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-06-29T17:33:27.220

来自[Python 文档](http://docs.python.org/whatsnew/2.5.html#pep-328-absolute-and-relative-imports)，

> 在 Python 2.5 中，您可以使用`from __future__ import absolute_import`指令将导入的行为切换为绝对导入。这种绝对导入行为将成为未来版本（可能是 Python 2.7）中的默认行为。一旦绝对导入成为默认值，`import string`将始终找到标准库的版本。建议用户应尽可能开始使用绝对导入，因此最好开始编写`from pkg import string`代码

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-03-17T09:20:09.027

我发现将“PYTHONPATH”环境变量设置到顶部文件夹更容易：

```
bash$ export PYTHONPATH=/PATH/TO/APP 
```

然后：

```
import sub1.func1
#...more import 
```

当然，PYTHONPATH 是“全球性的”，但它还没有给我带来麻烦。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-09-11T07:47:16.920

除了 John B 所说的之外，似乎设置`__package__`变量应该会有所帮助，而不是改变`__main__`可能会搞砸其他事情的变量。但据我测试，它并不能完全发挥应有的作用。

`sys.path`我有同样的问题，PEP 328 或 366 都没有完全解决问题，因为据我所知，到一天结束时，都需要将包的头部包含在 中。

我还应该提到，我没有找到如何格式化应该进入这些变量的字符串。是它`"package_head.subfolder.module_name"`还是什么？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-03-25T10:13:17.370

您必须将模块的路径附加到`PYTHONPATH`：

```
export PYTHONPATH="${PYTHONPATH}:/path/to/your/module/" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-11-27T20:29:26.053

类似于 Роман Арсеньев 的回答，但如果你想回到两个目录：

**返回两个目录：**

```
app/
   __init__.py
   sub1/
      __init__.py
      mod1.py          ------*
      subsub1/               |
         __init__.py   mod1 and mod4  
         mod4.py       ------|
   sub2/                     |
      __init__.py           into
      mod2.py                |
      subsub2/              mod3
         __init__.py         |
           mod3.py     <-----* 
```

**将 mod1 导入 mod3：**

```
import sys
sys.path.insert(1, '../../')

from sub1 import mod1
from sub1.subsub1 import mod 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-11-30T02:32:55.737

此方法查询并自动填充路径：

```
import os
import inspect
currentdir = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))
parentdir = os.path.dirname(currentdir)
os.sys.path.insert(1, parentdir)
# print("currentdir = ", currentdir)
# print("parentdir=", parentdir) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-03-01T22:56:03.180

一个 hacky 方法是在运行时将当前目录附加到 PATH 中，如下所示：

```
import pathlib   
import sys
sys.path.append(pathlib.Path(__file__).parent.resolve())
import file_to_import  # the actual intended import 
```

与此问题的另一个解决方案相反，它使用`pathlib`而不是`os.path`.

# backup - 如何备份 VPS 服务器？并在紧急情况下恢复它？

> ID：72858
> 
> 赞同：1
> 
> 时间：2008-09-16T14:24:47.913
> 
> 标签：backup

我有一个使用 Ubuntu Hardy 运行 3 个站点的 VPS 主机。我花了很多时间来设置它。这包括所有的安装+配置和东西。有哪些方法可以为 VPS 进行备份和恢复？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T14:34:49.123

仅备份是不够的。您应该保留对系统所做的所有配置更改的详细系统日志，以便您可以在其他地方重现您的配置。理想情况下，在本地 VM 上执行更改，然后编写脚本来自动执行这些更改，然后在实时服务器上运行这些脚本。通过避免手动配置，您的所有配置都是可重复的，因此要部署到新服务器，您只需按顺序运行所有脚本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-14T12:20:39.083

您可以尝试使用 rsynch 实现一个简单的脚本来备份您的数据 - 您需要第二台具有 Internet 访问权限的 Linux 机器并进行一些修改以确保您的备份是可靠的，以防您需要恢复 - 想想 /etc/ 设置，网站文件和您可能拥有的任何数据库。特别注意文件权限。一些托管公司在他们的计划中提供托管备份 - 您也可以研究一下，但请确保您的备份运行并远程存储 - 您不希望同样的灾难袭击您宝贵数据的所有副本。最后，如果您可以使用少量磁盘空间进行备份，您可以尝试使用[VPS Backup的免费帐户](http://ww.vps-backup.com)- 它最多可释放 5GB 的压缩数据，适用于大多数 Linux 版本，并且特别适合备份 MySQL 数据库。由于您不必为此付费，因此在您找到长期解决方案之前，这可能是一个很好的解决方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:27:37.253

这在很大程度上取决于您的主机提供什么。MediaTemple 和 Slicehost 都以象征性的费用提供快照备份。联系您的房东并询问他们是否提供这样的解决方案。

如果你的主机不提供任何东西，你总是可以定期将重要的东西备份到亚马逊的 S3 存储服务之类的东西上。

# asp.net - ASP.Net 对 IFrame 的重定向响应

> ID：72872
> 
> 赞同：2
> 
> 时间：2008-09-16T14:25:22.080
> 
> 标签：asp.net

如何将响应重定向到 IFrame？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T14:27:02.060

你的意思是从服务器端？- 你不能！

**您必须在客户端执行此操作。**

比如说，使用发送*AJAX 请求*的 javascript，然后将您的响应信息嵌入到*AJAX 响应*中。并让 javascript 读取响应并相应地更改预期框架中的页面

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T20:12:47.683

您可以通过回发来做到这一点。

像这样向 iframe 添加标签：

< iframe runat="server" id="myIframe" />

在您的服务器端代码中（按钮单击、链接单击、任何回帖）：

myIframe.attributes.add ("src", "webpage.aspx")

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:26:18.957

. . . 不完全确定您要做什么，但您通常通过 javascript 控制 iframe 的来源

# ruby-on-rails - Ruby 中的重构

> ID：72879
> 
> 赞同：15
> 
> 时间：2008-09-16T14:25:43.823
> 
> 标签：ruby-on-rails, ruby, refactoring

是否有任何程序或 IDE 支持重构 Ruby 或 RoR？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T10:49:56.680

The best refactoring tool is good test coverage. If your tests cover your code and they all past you can just make whatever changes you want and the tests will find any dependencies you have broken. This is the main reason why IDE-based refactoring tools are less prevalent in Ruby than elsewhere.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T15:05:02.343

[IntelliJ IDEA](http://www.jetbrains.com) with Ruby plugin supports some refactorings.

[alt text http://www.skavish.com/rubyrefactorings.png](http://www.skavish.com/rubyrefactorings.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T14:31:31.487

我相信 net-beans 和 eclipse 都支持在它们的“ruby 模式”中进行一些重构——emacs 代码浏览器（ECB）和用于 emacs 的各种 ruby​​ 支持工具（例如 rinari）也有一些支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-19T05:39:48.183

Aptana 有一些简单的重构工具。我经常提取到部分，他们有一个简单的快捷方式来提取东西，创建一个文件并插入对部分的正确调用。不是最神奇的，但它很有用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-06T02:33:13.117

我会大胆地说 Rubymine 在所有 RoR IDE 中拥有最好的 rails/ruby 重构。试一试，看看你自己。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T20:19:07.363

我在 netbeans 中使用了重构。我没有发现它比查找和替换有用得多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T19:16:10.530

还有来自 CodeGear 的[3rdRail](http://www.codegear.com/products/3rdrail)（来自 Delphi 的名声）。唯一的问题是它不是免费的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-12-08T07:06:24.573

你总是可以试试 RubyMine。

# soa - 异步消息（尤其是发布/订阅风格的消息）作为域服务架构是否可行，还是仅在以 SOA 为中心的环境中可行？

> ID：72895
> 
> 赞同：3
> 
> 时间：2008-09-16T14:27:26.520
> 
> 标签：soa, messaging

我一直在研究异步消息传递，我喜欢它优雅地处理某些领域中的一些问题的方式，以及它如何使领域概念更加明确。但是对于一般的领域驱动开发（至少在服务/应用程序/控制器层）来说，它是一种可行的模式，还是设计开销应该限制在基于 SOA 的场景中，比如远程服务和分布式处理？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T16:01:12.723

好问题:)。异步消息传递的主要问题是，当人们使用过程或面向对象的语言时，以异步或基于事件的方式工作通常非常棘手和复杂，程序员难以阅读和理解。如果业务逻辑以一种同步的方式构建，它通常会更简单——调用方法并立即获得结果等:)。

我的经验法则通常是在业务逻辑的微观层面上尝试使用更简单的同步编程模型；然后在宏观层面使用异步和 SEDA。

例如，提交采购订单可能只是将消息写入消息队列；但是采购订单的处理可能需要 10 个不同的步骤，所有这些步骤在高性能分布式系统中都是异步和并行的，其中许多并发进程和线程并行处理各个步骤。因此，宏观层面的布线基于一种 SEDA 方法——但在微观层面，各个 10 个步骤的代码可以主要以同步编程风格编写。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T16:11:47.970

就像许多架构和设计问题一样，答案是“视情况而定”。

根据我的经验，异步消息传递的优势在于它为设计带来的松散耦合。联轴器可以是：

*   时间 - 请求可以异步处理，有助于整体可扩展性。
*   空间 - 正如您所指出的，允许以比许多同步设计更强大的方式进行分布式处理。
*   技术——消息和队列是弥合技术差异的一种方式。

请记住，消息和队列是可以有多种实现的抽象。您不一定需要使用符合 JMS 的、事务性的、高性能的消息传递框架。正确实施后，关系数据库中的表可以充当队列，其中行作为消息。我已经看到这两种方法都取得了很好的效果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:06:44.980

我也同意@BradS 顺便说一句

顺便说一句[，这是一种从业务逻辑中隐藏中间件的方法，](http://activemq.apache.org/camel/hiding-middleware.html)同时仍然获得松散耦合和 SEDA 的好处——同时能够在各种不同的中间件技术之间轻松切换——从内存中的 SEDA 到 JMS 到 AMQP 到 JavaSpaces 到数据库，文件或 FTP 等

# python - 如何按字典的值对字典列表进行排序？

> ID：72899
> 
> 赞同：2412
> 
> 时间：2008-09-16T14:27:47.470
> 
> 标签：python, list, sorting, dictionary, data-structures

我有一个字典列表，并希望每个项目都按特定值排序。

考虑清单：

```
[{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}] 
```

按 排序时`name`，应变为：

```
[{'name':'Bart', 'age':10}, {'name':'Homer', 'age':39}] 
```

* * *

## 回答 #1

> 赞同：3133
> 
> 时间：2008-09-16T14:39:44.273

该[`sorted()`](https://docs.python.org/library/functions.html#sorted)函数接受一个`key=`参数

```
newlist = sorted(list_to_be_sorted, key=lambda d: d['name']) 
```

或者，您可以使用[`operator.itemgetter`](https://docs.python.org/library/operator.html#operator.itemgetter)而不是自己定义函数

```
from operator import itemgetter
newlist = sorted(list_to_be_sorted, key=itemgetter('name')) 
```

为了完整起见，添加`reverse=True`以降序排序

```
newlist = sorted(list_to_be_sorted, key=itemgetter('name'), reverse=True) 
```

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2008-09-16T15:18:14.417

```
import operator 
```

按 key='name' 对字典列表进行排序：

```
list_of_dicts.sort(key=operator.itemgetter('name')) 
```

按 key='age' 对字典列表进行排序：

```
list_of_dicts.sort(key=operator.itemgetter('age')) 
```

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2008-09-16T14:39:11.030

```
my_list = [{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}]

my_list.sort(lambda x,y : cmp(x['name'], y['name'])) 
```

`my_list`现在将是你想要的。

或更好：

从 Python 2.4 开始，有一个`key`参数更高效、更整洁：

```
my_list = sorted(my_list, key=lambda k: k['name']) 
```

... lambda 是，IMO，比 更容易理解`operator.itemgetter`，但你的里程可能会有所不同。

* * *

## 回答 #4

> 赞同：63
> 
> 时间：2010-05-18T15:28:11.290

如果要按多个键对列表进行排序，可以执行以下操作：

```
my_list = [{'name':'Homer', 'age':39}, {'name':'Milhouse', 'age':10}, {'name':'Bart', 'age':10} ]
sortedlist = sorted(my_list , key=lambda elem: "%02d %s" % (elem['age'], elem['name'])) 
```

这是相当骇人听闻的，因为它依赖于将值转换为单个字符串表示形式进行比较，但它对包括负数在内的数字按预期工作（尽管如果您使用数字，则需要使用零填充适当地格式化您的字符串）。

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2017-03-17T10:29:50.080

```
a = [{'name':'Homer', 'age':39}, ...]

# This changes the list a
a.sort(key=lambda k : k['name'])

# This returns a new list (a is not modified)
sorted(a, key=lambda k : k['name']) 
```

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2008-09-16T14:43:51.550

```
import operator
a_list_of_dicts.sort(key=operator.itemgetter('name')) 
```

'key' 用于按任意值排序，'itemgetter' 将该值设置为每个项目的 'name' 属性。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2008-09-16T14:36:54.953

我猜你的意思是：

```
[{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}] 
```

这将像这样排序：

```
sorted(l,cmp=lambda x,y: cmp(x['name'],y['name'])) 
```

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2013-05-27T11:21:03.357

使用 Perl 的[Schwartzian 变换](https://en.wikipedia.org/wiki/Schwartzian_transform)，

```
py = [{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}] 
```

做

```
sort_on = "name"
decorated = [(dict_[sort_on], dict_) for dict_ in py]
decorated.sort()
result = [dict_ for (key, dict_) in decorated] 
```

给

```
>>> result
[{'age': 10, 'name': 'Bart'}, {'age': 39, 'name': 'Homer'}] 
```

更多关于 Perl Schwartzian 变换：

> 在计算机科学中，Schwartzian 变换是一种 Perl 编程习惯，用于提高对项目列表进行排序的效率。当排序实际上是基于元素的某个属性（键）的排序时，此习惯用法适用于基于比较的排序，其中计算该属性是一项应执行最少次数的密集操作。Schwartzian 变换值得注意的是它不使用命名的临时数组。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2008-09-16T14:52:14.697

您可以使用自定义比较函数，也可以传入一个计算自定义排序键的函数。这通常更有效，因为每个项目只计算一次键，而比较函数会被调用更多次。

你可以这样做：

```
def mykey(adict): return adict['name']
x = [{'name': 'Homer', 'age': 39}, {'name': 'Bart', 'age':10}]
sorted(x, key=mykey) 
```

但是标准库包含一个用于获取任意对象项的通用例程：`itemgetter`. 所以试试这个：

```
from operator import itemgetter
x = [{'name': 'Homer', 'age': 39}, {'name': 'Bart', 'age':10}]
sorted(x, key=itemgetter('name')) 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2008-09-16T14:31:52.577

您必须实现自己的比较函数，该函数将按名称键的值比较字典。请参阅[PythonInfo Wiki 中的 Sorting Mini-HOW TO](http://wiki.python.org/moin/HowTo/Sorting)

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2017-07-14T03:21:08.117

有时我们需要使用`lower()`. 例如，

```
lists = [{'name':'Homer', 'age':39},
  {'name':'Bart', 'age':10},
  {'name':'abby', 'age':9}]

lists = sorted(lists, key=lambda k: k['name'])
print(lists)
# [{'name':'Bart', 'age':10}, {'name':'Homer', 'age':39}, {'name':'abby', 'age':9}]

lists = sorted(lists, key=lambda k: k['name'].lower())
print(lists)
# [ {'name':'abby', 'age':9}, {'name':'Bart', 'age':10}, {'name':'Homer', 'age':39}] 
```

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2015-01-22T17:21:17.473

这是另一种通用解决方案 - 它通过键和值对 dict 的元素进行排序。

它的优点 - 无需指定键，如果某些字典中缺少某些键，它仍然可以工作。

```
def sort_key_func(item):
    """ Helper function used to sort list of dicts

    :param item: dict
    :return: sorted list of tuples (k, v)
    """
    pairs = []
    for k, v in item.items():
        pairs.append((k, v))
    return sorted(pairs)
sorted(A, key=sort_key_func) 
```

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2016-09-01T21:21:11.583

使用[Pandas](https://en.wikipedia.org/wiki/Pandas_%28software%29)包是另一种方法，尽管它在大规模运行时比其他人提出的更传统的方法慢得多：

```
import pandas as pd

listOfDicts = [{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}]
df = pd.DataFrame(listOfDicts)
df = df.sort_values('name')
sorted_listOfDicts = df.T.to_dict().values() 
```

以下是小列表和大 (100k+) dicts 列表的一些基准值：

```
setup_large = "listOfDicts = [];\
[listOfDicts.extend(({'name':'Homer', 'age':39}, {'name':'Bart', 'age':10})) for _ in range(50000)];\
from operator import itemgetter;import pandas as pd;\
df = pd.DataFrame(listOfDicts);"

setup_small = "listOfDicts = [];\
listOfDicts.extend(({'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}));\
from operator import itemgetter;import pandas as pd;\
df = pd.DataFrame(listOfDicts);"

method1 = "newlist = sorted(listOfDicts, key=lambda k: k['name'])"
method2 = "newlist = sorted(listOfDicts, key=itemgetter('name')) "
method3 = "df = df.sort_values('name');\
sorted_listOfDicts = df.T.to_dict().values()"

import timeit
t = timeit.Timer(method1, setup_small)
print('Small Method LC: ' + str(t.timeit(100)))
t = timeit.Timer(method2, setup_small)
print('Small Method LC2: ' + str(t.timeit(100)))
t = timeit.Timer(method3, setup_small)
print('Small Method Pandas: ' + str(t.timeit(100)))

t = timeit.Timer(method1, setup_large)
print('Large Method LC: ' + str(t.timeit(100)))
t = timeit.Timer(method2, setup_large)
print('Large Method LC2: ' + str(t.timeit(100)))
t = timeit.Timer(method3, setup_large)
print('Large Method Pandas: ' + str(t.timeit(1)))

#Small Method LC: 0.000163078308105
#Small Method LC2: 0.000134944915771
#Small Method Pandas: 0.0712950229645
#Large Method LC: 0.0321750640869
#Large Method LC2: 0.0206089019775
#Large Method Pandas: 5.81405615807 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2014-04-16T07:18:21.040

假设我有一本`D`包含以下元素的字典。要排序，只需使用 key 参数`sorted`传入自定义函数，如下所示：

```
D = {'eggs': 3, 'ham': 1, 'spam': 2}
def get_count(tuple):
    return tuple[1]

sorted(D.items(), key = get_count, reverse=True)
# Or
sorted(D.items(), key = lambda x: x[1], reverse=True)  # Avoiding get_count function call 
```

看看[这个](https://wiki.python.org/moin/HowTo/Sorting/#Key_Functions)。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2017-12-19T17:31:30.943

如果您不需要 的原件`list`，您可以使用自定义键功能使用方法`dictionaries`就地修改它。`sort()`

关键功能：

```
def get_name(d):
    """ Return the value of a key in a dictionary. """

    return d["name"] 
```

`list`要排序的：

```
data_one = [{'name': 'Homer', 'age': 39}, {'name': 'Bart', 'age': 10}] 
```

就地排序：

```
data_one.sort(key=get_name) 
```

如果您需要原始的`list`，请调用`sorted()`传递给它的函数`list`和 key 函数，然后将返回的 sorted 分配`list`给一个新变量：

```
data_two = [{'name': 'Homer', 'age': 39}, {'name': 'Bart', 'age': 10}]
new_data = sorted(data_two, key=get_name) 
```

印刷`data_one`和`new_data`.

```
>>> print(data_one)
[{'name': 'Bart', 'age': 10}, {'name': 'Homer', 'age': 39}]
>>> print(new_data)
[{'name': 'Bart', 'age': 10}, {'name': 'Homer', 'age': 39}] 
```

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2019-10-01T07:24:42.577

我一直是 lambda 过滤器的忠实粉丝。但是，如果考虑时间复杂度，这不是最佳选择。

### 第一个选项

```
sorted_list = sorted(list_to_sort, key= lambda x: x['name'])
# Returns list of values 
```

### 第二种选择

```
list_to_sort.sort(key=operator.itemgetter('name'))
# Edits the list, and does not return a new list 
```

### 执行时间的快速比较

```
# First option
python3.6 -m timeit -s "list_to_sort = [{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}, {'name':'Faaa', 'age':57}, {'name':'Errr', 'age':20}]" -s "sorted_l=[]" "sorted_l = sorted(list_to_sort, key=lambda e: e['name'])" 
```

> 1000000 次循环，3 次中的最佳：每个循环 0.736 微秒

```
# Second option
python3.6 -m timeit -s "list_to_sort = [{'name':'Homer', 'age':39}, {'name':'Bart', 'age':10}, {'name':'Faaa', 'age':57}, {'name':'Errr', 'age':20}]" -s "sorted_l=[]" -s "import operator" "list_to_sort.sort(key=operator.itemgetter('name'))" 
```

> 1000000 次循环，3 次中的最佳：每个循环 0.438 微秒

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2020-01-18T16:32:05.457

如果性能是一个问题，我会使用`operator.itemgetter`而不是`lambda`内置函数比手工制作的函数执行得更快。根据我的测试，该`itemgetter`功能的执行速度似乎快了大约 20% 。`lambda`

来自[https://wiki.python.org/moin/PythonSpeed](https://wiki.python.org/moin/PythonSpeed)：

> 同样，内置函数比手动构建的等效函数运行得更快。例如，map(operator.add, v1, v2) 比 map(lambda x,y: x+y, v1, v2) 快。

这是使用`lambda`vs的排序速度的比较`itemgetter`。

```
import random
import operator

# Create a list of 100 dicts with random 8-letter names and random ages from 0 to 100.
l = [{'name': ''.join(random.choices(string.ascii_lowercase, k=8)), 'age': random.randint(0, 100)} for i in range(100)]

# Test the performance with a lambda function sorting on name
%timeit sorted(l, key=lambda x: x['name'])
13 µs ± 388 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)

# Test the performance with itemgetter sorting on name
%timeit sorted(l, key=operator.itemgetter('name'))
10.7 µs ± 38.1 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)

# Check that each technique produces the same sort order
sorted(l, key=lambda x: x['name']) == sorted(l, key=operator.itemgetter('name'))
True 
```

两种技术都以相同的顺序对列表进行排序（通过执行代码块中的最后一条语句来验证），但第一种技术要快一些。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-09-06T09:55:16.017

正如@Claudiu 在[此答案](https://stackoverflow.com/a/73465/7658051)的评论部分中向@monojohnny 指出的那样，
给出：

```
list_to_be_sorted = [
                      {'name':'Homer', 'age':39}, 
                      {'name':'Milhouse', 'age':10}, 
                      {'name':'Bart', 'age':10} 
                    ] 
```

要按键排序字典列表`'age'`，`'name'`
（如 SQL 语句中`ORDER BY age, name`），您可以使用：

```
newlist = sorted( list_to_be_sorted, key=lambda k: (k['age'], k['name']) ) 
```

或者，同样

```
import operator
newlist = sorted( list_to_be_sorted, key=operator.itemgetter('age','name') ) 
```

`print(newlist)`

> [{'name': 'Bart', 'age': 10},
> {'name': 'Milhouse', 'age': 10},
> {'name': 'Homer', 'age': 39}]

# c# - 是否可以推进枚举器并在 lambda 中获取其值？

> ID：72913
> 
> 赞同：1
> 
> 时间：2008-09-16T14:28:35.970
> 
> 标签：c#, lambda

如果我有一个 IEnumerator 变量，是否可以有一个 lambda 函数来接受它，用 MoveNext() 推进它并在每次调用它时返回当前值？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T14:36:12.427

```
e => e.MoveNext() ? e.Current : null 
```

这将推进枚举器并返回当前值，并在枚举完成时返回 null。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:33:00.593

Lambda 表达式可以包含复杂的语句，因此您可以执行以下操作：

```
Func<IEnumerator, object> f = ie => { ie.MoveNext(); return ie.Current; }; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T14:38:54.980

这是你想要的？

```
List<string> strings = new List<string>()
{
    "Hello", "I", "am", "a", "list", "of", "strings."
};
IEnumerator<string> e = strings.GetEnumerator();
Func<string> f = () => e.MoveNext() ? e.Current : null;
for (; ; )
{
    string str = f();
    if (str == null)
        break;

    Console.Write(str + " ");
} 
```

an 的要点`IEnumerator`是您已经获得了处理它的语法糖：

```
foreach (string str in strings)
    Console.Write(str + " "); 
```

在这种情况下，即使直接处理枚举器看起来也更干净：

```
while (e.MoveNext())
    Console.Write(e.Current + " "); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:40:14.210

扩展 Abe 的解决方案，您还可以使用闭包来保存对枚举器的引用：

```
var iter = ((IEnumerable<char>)"hello").GetEnumerator();

//with closure
{
    Func<object> f =
        () =>
            {
                iter.MoveNext();
                return iter.Current;
            };
    Console.WriteLine(f());
    Console.WriteLine(f());
}

//without closure
{
    Func<IEnumerator, object> f =
        ie =>
            {
                ie.MoveNext();
                return ie.Current;
            };
    Console.WriteLine(f(iter));
    Console.WriteLine(f(iter));
} 
```

# javascript - 如何使用 javascript 小书签找到选定文本块中的所有 IP 地址？

> ID：72921
> 
> 赞同：2
> 
> 时间：2008-09-16T14:29:07.983
> 
> 标签：javascript, ip-address, bookmarklet

我刚刚开始学习 javascript，所以我没有技能来弄清楚我认为是一个微不足道的问题。

我正在使用一个作为社区常见问题解答的 Wordpress 博客，并且我正在尝试整合一些工具来更轻松地管理评论。 [Internet Duct Tape 的 Greasemonkey 工具，例如 Comment Ninja](https://stackoverflow.com/users/4465/levik)，对大多数情况都有帮助，但我希望能够获得我们从中获得评论的所有 IP 地址的列表，以便跟踪趋势等。

我只想能够在评论页面上选择一堆文本，然后在 Firefox 中单击一个小书签 ( [http://bookmarklets.com](https://stackoverflow.com/users/8119/jacob) )，它会弹出一个窗口，列出在选择中找到的所有 IP 地址。

**更新：**

我将[列维克](https://stackoverflow.com/users/4465/levik)和[雅各布](https://stackoverflow.com/users/8119/jacob)的答案结合起来得出了这个结论：

```
javascript:ipAddresses=document.getSelection().match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g).join("<br>");newWindow=window.open('', 'IP Addresses in Selection', 'innerWidth=200,innerHeight=300,scrollbars');newWindow.document.write(ipAddresses) 
```

不同之处在于，我没有像列维克的回答那样发出*警告*消息，而是打开了一个类似于雅各布回答的新窗口。该*警报*不提供滚动条，这对于具有许多 IP 地址的页面来说可能是个问题。但是，与 Jacob 的解决方案不同，我需要列表是垂直的，因此我使用 levik 的提示来为连接而不是 levik 的*\n*。

感谢所有的帮助，伙计们。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T15:40:12.663

在 Firefox 中，您可以执行以下操作：

```
javascript:alert(
  document.getSelection().match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g)
  .join("\n")) 
```

这是如何工作的：

*   从浏览器获取选择文本（在 FF 中为“document.getSelection()”，在 IE 中为“document.selection.createRange().text”）
*   应用正则表达式来传输 IP 地址（如 Muerr 所建议的那样） - 这会产生一个字符串数组。
*   将此数组连接成一个由返回字符分隔的字符串
*   警报该字符串

在 IE 上获取选择的方式略有不同，但原理是一样的。要使其成为跨浏览器，您需要检查哪种方法可用。您还可以进行更复杂的输出（例如创建一个浮动 DIV 并将所有 IP 插入其中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:37:56.213

使用正则表达式检测 IP 地址。几个例子：

```
/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/
/^([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+$/ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T16:43:18.767

## 作为书签

```
javascript:document.write(document.getSelection().match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g)) 
```

只需创建一个新书签并将该 javascript 粘贴到

## 如何在 Ubiquity 中做到这一点

```
CmdUtils.CreateCommand({
    name: "findip",
    preview: function( pblock ) {
        var msg = 'IP Addresses Found<br/><br/> ';
        ips = CmdUtils.getHtmlSelection().match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g);
        if(ips){
            msg += ips.join("<br/>\n");
        }else{
            msg += 'None';
        }
        pblock.innerHTML = msg;
    },

    execute: function() {
        ips = CmdUtils.getHtmlSelection().match(/\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g);
        if(ips){
            CmdUtils.setSelection(ips.join("<br/>\n"));
        }
    }
}) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T14:34:15.753

[这](http://javascript.about.com/library/blip.htm)是一篇关于获取访问者 IP 地址的好文章。如果您愿意，您可以在他们的评论之外显示此内容，或者将其作为标签或字段包含在您的页面中，以便您以后参考。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T16:44:28.420

查看[rot13 小书签](https://www.squarefree.com/bookmarklets/pagedata.html#rot13_selection "rot13 小书签")，了解单击小书签时选择文本并执行操作（在本例中为替换）的示例。

# c++ - 用于实时图形编程的 C++ 的最佳替代方案是什么？

> ID：72931
> 
> 赞同：33
> 
> 时间：2008-09-16T14:29:50.633
> 
> 标签：c++, graphics, 3d, real-time

C++ 让我对自己的内存进行微观管理，让我输入太多（你好`std::vector<Thingy>::const_iterator it = lotsOfThingys.begin()`），并让我长时间编译感到厌烦，这让我浪费了太多时间。对于严肃的实时图形编程来说，最好的选择是什么？垃圾收集是必须的（必要时避免使用它的能力也是如此），而且速度必须与 C++ 相媲美。访问 C 库的合理故事也是必须的。

（完全披露：我对此有自己的答案，但我很想看看其他人发现什么可以替代 C++ 用于实时图形工作。）

**编辑：**感谢大家的周到答复。鉴于这个问题确实没有“正确”的答案，我不会选择任何特定的答案。此外，我只是选择我碰巧喜欢的语言作为 C++ 的替代品，这并不公平。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-16T14:34:27.360

[D 编程语言](http://www.digitalmars.com/d/2.0/comparison.html)呢？

评论中要求的一些链接：

[Win32 接口](http://www.digitalmars.com/d/2.0/windows.html)

[遗弃（多媒体库）](http://www.dsource.org/projects/derelict/)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-16T19:08:58.497

我不会丢弃 C++。事实上，我会考虑将 Boost 添加到您的 C++ 库中，这会使该语言更加实用。您的示例将变为：

```
BOOST_FOREACH( Thingy& t, lostOfThingys ) {
    // do something with 't'
} 
```

Boost 有大量的工具可以帮助 C++ 成为更好的语言。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-16T14:32:42.780

C# 是一种很好的语言，可以满足您的要求，而且它绝对适合图形，这要归功于 Microsoft 为它提供的出色工具和库（如 Visual Studio 和 XNA）的努力。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-16T14:56:24.140

Real-time + garbage collection don't match very well I'm afraid.

It's a bit hard to make any real-time response guarantees if a garbage collector can kick in at any time and spend an undefined amount of processing...

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-16T18:38:29.943

我不同意你的前提。如果使用得当，C++ 是一门很棒的语言，特别是对于像实时图形这样速度至关重要的领域。

如果您设计好系统并使用 stl 容器和智能指针，内存管理将变得容易。

`std::vector::const_iterator it = lotsOfThingys.begin())`如果你使用会变得更短

`using namespace std;
typedef vector::const_iterator ThingyConstIter;`

通过将系统分解为合理的独立模块、使用预编译头文件或使用 PIMPL 习惯用法，您可以显着缩短编译时间。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-16T17:01:58.253

对于这种编程，编译为机器代码的 Lisp 的某些变体几乎可以与 C++ 一样快。[顽皮狗](http://www.naughtydog.com/)团队创建了一个名为[Game Oriented Assembly Lisp](http://en.wikipedia.org/wiki/Game_Oriented_Assembly_Lisp)的Lisp 版本，他们用它来创建多个 AAA 游戏，包括 Jak 和 Daxter 系列。在游戏行业中，Lisp 方法的两个主要障碍是 C/C++ 开发的根深蒂固的性质（工具和人力资源都大量投资于 C/C++），以及难以找到有才华的工程师作为明星。游戏编程领域和 Lisp 语言。

行业中的许多编程团队正在转向混合方法，其中实时代码，尤其是图形和物理代码，是用 C 或 C++ 编写的，但游戏逻辑是用更高级的脚本语言完成的，它可以访问和程序员和非程序员都可以编辑。[Lua](http://www.lua.org/)和[Python](http://www.python.org/)都适用于高级脚本。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-16T15:15:31.350

也许是一种混合方法。Python 和 C++ 是一个很好的组合（例如，参见 PyGame）。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-09-17T09:35:58.757

让我们不要忘记提及新的“自动”用途：

```
auto it = lotsOfThingys.begin(); // Let the compiler figure it out.
auto it2 = lotsOfFoos.begin();
if (it==it2) // It's still strongly typed; a Thingy iter is not a Foo iter. 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-05-13T10:51:51.970

作为 3D VR 应用程序的开发人员/研究人员/教授大约 20 年，我建议没有其他选择（可能 C 除外）。减少延迟和实现实时交互的唯一方法是优化的编译语言（例如 C 或 C++），可以访问快速可靠的 3D 图形库，例如 OpenGL。虽然我同意必须编写所有代码令人沮丧，但这对于性能和优化也是必不可少的。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-16T16:00:23.690

Sometimes, looking outside the beaten path you can find a real gem. You might want to consider [PureBasic](http://www.purebasic.com) (Don't let the name mislead you). Here's some details:

PureBasic Features

*   Machine Code (Assembly) executables (FASM)
    *   In-line Assembly support
    *   No run-times needed (no DLLs needed,etc.) 1 executable file
    *   Tiny executables (as small or smaller/as fast or faster than C++ w/out the runtime)
    *   You can write DLLs
    *   Multi-thread support
    *   Full OS API support
*   Multi-platform support
    *   Windows 95-2003
    *   Linux
    *   Mac-OS X
    *   Amiga
*   2D & 3D game development
    *   DirectX
    *   OGRE
*   Generous Licensing
    *   Inexpensive (79 Euros or about $112)
    *   Life-time license (all future updates & versions included)
    *   One price for all platforms
*   External Library support
    *   3rd party DLLs
    *   User Libraries
*   On-line Support
    *   Responsive development team led by it's creator
    *   [On-line forum](http://www.purebasic.fr/english/index.php)
        *   One place for answers (don’t have to go all over the net)
        *   Huge amount of sample code (try code out while in IE with IEtool)
        *   Fast replies to questions
*   Bonus learning (alternative to learning C++)
    *   API
    *   Structures
    *   Interfaces
    *   Pointers

Visit the online forum to get a better idea of PureBasic ([http://www.purebasic.fr/english/index.php](http://www.purebasic.fr/english/index.php)) or the main site: [www.purebasic.com](http://www.purebasic.com)

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-16T19:31:24.060

我完全同意 C# 用于图形编程的说法。它具有作为托管语言的轻微缺点，并且允许垃圾收集器自由支配您的应用程序是一段时间后的帧率自杀，但是在程序生命的早期进行一些相对智能的池分配，可以避免任何实际问题。

有几个人已经提到了 XNA，它非常友好且有据可查，我也想附和这个建议。我个人将它用于我的爱好游戏项目，它对我很好。

不过，XNA 并不是唯一的选择。还有 SlimDX，它正在不断开发中，作为一种提供 DirectX 精简包装的方法，其方式与 Managed DirectX 类似（我相信，微软为了支持 XNA 而停止了它）。两者都值得研究：[http ://code.google.com/p/slimdx/](http://code.google.com/p/slimdx/)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-16T14:56:14.627

There are no true alternatives for big AAA titles, especially on the consoles. For smaller titles C# should do.

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-16T19:06:19.267

我会说 D 编程语言是一个不错的选择。您可以链接到 C 目标文件并通过 C 库与 C++ 代码交互。D 有垃圾收集、内联汇编，游戏开发者已经创建了与 SDL 和 OpenGL 库的绑定，并且还在积极开发新的游戏开发 API。我爱 D。太糟糕了，我的工作不需要它的使用。:(

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-16T15:33:48.340

C# 在这里是一个很好的答案——它有一个公平的垃圾收集（虽然你必须对它进行相当多的分析——因为现在整个内存处理已经不在你的掌控之中了，所以改变你处理事情的方式），它很简单使用，有很多例子并且有据可查。在 3D 部门，它为着色器和效果等提供全面支持——这将是我的选择。

尽管如此，C# 不如 C++ 高效，并且由于开销而速度较慢，所以如果它是速度和灵活性，可以在书中使用你喜欢的任何技巧（如果你想弄脏你的手，可以使用指针和汇编） - 坚持正如您所提到的，C++ 和代价将是编写更多代码，但可以完全控制包括内存管理在内的所有内容。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-16T19:44:51.920

如果您的目标是 Windows，C++/CLI（Microsoft 的 .NET“托管”C++ 方言）是一种有趣的可能性，特别是如果您想利用您的 C++ 经验。您可以将本机代码（例如对 C 风格库的调用）与 .NET 托管代码无缝混合，并利用 .NET GC 和库。

至于对 GC 影响“实时”性能的担忧，我认为这些往往被夸大了。多代 .NET GC 非常擅长从不花太多时间进行收集，除非您处于某种严重的低内存情况。我编写与电子衍生品交易所交互的 .NET 代码，其中时间延迟 == 很多 $$$，而且我们从未遇到过与 GC 相关的问题。几毫秒对于 GC 来说是很长很长的时间，但对于人类与软件交互，甚至是“实时”游戏来说，这不是。如果您真的需要真正的“实时”性能（用于医疗设备、过程控制等），那么无论如何您都不能使用 Windows——它只是不是实时操作系统。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-16T15:38:53.883

像 James (hopkin) 一样，对我来说，混合方法是最好的解决方案。Python 和 C++ 是一个不错的选择，但 C#/C++ 等其他风格也可以。一切都取决于您的图形上下文。对于游戏来说，XNA 是一个很好的平台（仅限 win32），在这种情况下 C#/C++ 是最好的解决方案。对于科学可视化，接受 Python/C++（如 vtk 在 python 中的绑定）。对于手机游戏 JAVA/C++ 可以工作...

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-24T05:37:53.750

我想很多游戏引擎都可以满足您的需求。例如，如果需要可移植性，则使用 SDL 或 Cairo。许多脚本语言（通常具有简单的语法和垃圾收集）绑定到这些画布。
Flash 可能是另一种选择。

我只想指出[Processing](http://processing.org/ "加工")，它是*一种开源编程语言和环境，适用于想要对图像、动画和交互进行编程的人们。*

实际上，它是对 Java 的薄包装，使它看起来像一种脚本语言：它有一个（原始的）IDE，您可以键入几行代码并点击运行，甚至无需保存文件。实际上它将代码包装在一个类周围并添加一个 main() 调用，编译它并在窗口中运行它。

很多人将它用于实时展览（VJ 等）。它具有 Java 的强大功能和局限性，但添加了许多开箱即用的漂亮包装器（库）来简化对 Java2D、OpenGL、SVG 等的访问。

不知何故，它已成为简单图形语言的模型：有几个应用程序试图模仿其他语言的处理，如 Ruby、Scala 或 Python。其中最令人印象深刻的是一个 JavaScript 实现，它使用了`canvas`在 Firefox、Safari、Opera 等中实现的组件。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-01-03T02:33:31.673

我投票 c++0x。使用 -std=c++0x 标志在 gcc-4.3+ 中已经提供了部分支持。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-11-24T10:46:42.397

Java 和 LWJGL（OpenGL 包装器）对我来说效果很好。如果您正在寻找更多像 Orge 这样的场景图类型库，请查看我们用来创建 google earth 类型应用程序的 jMonkeyEngine（参见 www.skapeworld.com）。如果您对对象创建很敏感，那么垃圾收集不是问题。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-10-05T11:03:16.867

我已经非常成功地将 C++ 用于引擎，并在顶部使用 Lua 编写的应用程序。JavaScript 也非常实用，现在最新一代的基于 JIT 的 JS 引擎已经出现（tracemonkey、V8 等）。

我认为 C++ 还会伴随我们一段时间。甚至 Tim Sweeney 还没有真正[切换到 Haskell](http://www.st.cs.uni-saarland.de/edu/seminare/2005/advanced-fp/docs/sweeny.pdf) (pdf)，AFAIK :-)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-03-17T18:03:04.017

“C”是不是太明显的答案？

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-16T16:46:12.457

如果您的目标是 PC，我认为您可以尝试 C#，或者将**Lua**嵌入到您的 C++ 应用程序中并为“高级”内容运行脚本。但是，如果您的目标是控制台，则**必须**管理自己的内存！

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-16T17:20:38.960

Objective-C 看起来很符合您的要求（带有可选 GC 的最新版本），尽管它对于我的口味来说过于动态和类似于 Smalltalk。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-16T17:21:11.827

我认为 XNA 是您最好的选择。在 .NET 框架的支持下，您只需更改 Game Studio 中的设置即可为 Windows 或 Xbox 360 平台构建。最好的是，所有工具都是免费的！

如果您决定使用 XNA，您可以使用他们的快速入门指南轻松开始 [XNA 快速入门指南](http://creators.xna.com/en-US/quickstart_main)

到目前为止，这对我来说是一次有益而有趣的经历，也是从 C++ 的内存管理中解脱出来的一个很好的突破。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-03-17T13:31:00.470

你可以看看**艾达**。没有垃圾收集器，但这种语言通常用于需要高可靠性的实时系统。这意味着您的 3D 应用程序的调试时间更短。

而且，您还可以查看**Haskell**，如果您不了解该语言的功能范式，您会觉得这种语言很奇怪，但值得您花点时间。Tim Sweeney (EPIC Inc) 正在考虑将此语言作为 C++ 的替代方案。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-16T19:01:52.133

> 垃圾收集是必须的（必要时避免使用它的能力也是如此）

您不能暂时禁用垃圾收集器。那么你需要一个确定性的垃圾收集器。但这样的野兽也确实带来了性能打击。我认为 BEA JRockit 就是这样一个野兽，然后你应该坚持使用 Java。

只是评论你的例子；typedef 是你的朋友...

```
typedef std::vector<Thingy> Thingys;
Thingys::const_iterator it = lotsOfThingys.begin() 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2010-06-18T16:59:42.787

看看 Delphi/Pascal 对象和一些例子：http: [//www.delphigamer.com](http://www.delphigamer.com)或[http://glscene.cjb.net/](http://glscene.cjb.net/)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-04-22T07:59:19.580

不要在你的追求中忽视独立的语言。Ionic Wind Software 的 Emergence BASIC 具有内置的 DirectX 9 引擎，支持 OOP 并且可以轻松地与 C 库交互。

[http://www.ionicwind.com](http://www.ionicwind.com)

詹姆士。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2009-12-23T10:14:34.590

好问题。至于“让我输入太多”，C++0x 似乎解决了大部分问题，如前所述：

auto it = lotOfThingys.begin()) // ... 推断类型，就像在 *ML VS2010beta 中已经实现了这个。

至于内存管理——为了提高效率——你必须很好地跟踪内存分配，不管有没有垃圾收集（即，制作内存池，有时重用分配的对象），这样最终你的环境是否是垃圾收集与否，无关紧要。您还必须显式调用 gc()，以防止内存碎片化。拥有一致的方式来管理内存在任何地方都很重要。RAII - 是 C++ 的杀手级功能 另一件事 - 内存只是一种资源，您仍然必须使用 GC 跟踪其他资源，因此 RIAA。

无论如何，C# - 在很多方面都是一个不错的选择，我发现它是一种非常不错的语言，尤其是能够在其中编写函数式代码的能力（可爱的 lambda -> 语法、map/select 'LINQ' 语法等），因此编写并行代码的可能性；虽然它仍然是“标准花括号”，但当您（或您的同事）需要它时。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-10-05T11:23:35.860

您的项目的最佳环境是您以最快的方式完成任务的环境。这 - 特别是对于 3D 图形 - 包括库。

根据任务的不同，您可能会逃脱一些次要的 directx 黑客攻击。然后你可以使用 .NET 和[slimdx](http://slimdx.org/)。托管语言倾向于更快地编程并且更容易调试。

也许您需要一个非常好的 3D 引擎？试试[Ogre3D](http://www.ogre3d.org)或[Irrlicht](http://irrlicht.sourceforge.net/)。你需要商业级的质量（有人可能会说 Ogre3D 提供了）——选择 Cryengine 或 Unreal。使用 Ogre3D 和 Irrlicht，您也可以使用 .NET，尽管端口并不总是最新的，并且插件不像 C++ 版本那样容易包含。对于 Cryengine/Unrealengine，我猜你不会有真正的选择。

你需要它更便携吗？[用于救援的OpenGL](http://www.opengl.org/) - 尽管您可能需要一些包装器（例如[SDL](http://www.libsdl.org)）。

你也需要一个图形用户界面吗？[wxWidgets](http://www.wxwidgets.org/)，[QT](http://qt.nokia.com/products)可能是一种可能性。

你已经有一个工具链？您的库需要能够处理文件格式。

你想写一个库吗？C / C++ 可能是一个解决方案，因为世界上大多数地方都可以使用 C / C++ 库。也许使用COM？

还有很多我没有提到的项目/库（XNA、Boost、...），如果您想创建一些不仅显示 3D 图形的程序，您可能还有其他需求（输入、声音, 网络, 人工智能, 数据库, GUI, ...)

总结一下：编程语言是实现目标的工具。必须在手头任务的背景下看待它。任务有自己的需求，这些需求可能会为您选择语言（例如，您需要某个库来获得需要很长时间编程的功能，并且您只能使用语言 X 访问该库）。

如果您需要一个几乎所有的方法：尝试 C++/CLI（可能与 C# 结合使用，以获得更简单的语法）。

# linux - 由于文件损坏，无法删除linux下的目录

> ID：72936
> 
> 赞同：3
> 
> 时间：2008-09-16T14:30:15.717
> 
> 标签：linux, sysadmin, rm

```
kt@rails-ubuntu:~/rails/ledger/releases/20080820144914/.git/hooks$ ls -al
ls: 无法访问 post-commit: 没有这样的文件或目录
ls：无法访问更新：没有这样的文件或目录
ls：无法访问更新后：没有这样的文件或目录
ls: 无法访问 commit-msg: 没有这样的文件或目录
ls: cannot access pre-rebase: No such file or directory
ls: 无法访问 post-receive: 没有这样的文件或目录
ls: 无法访问 pre-applypatch: 没有这样的文件或目录
ls: 无法访问 pre-commit: 没有这样的文件或目录
共 8 个
drwxrwxr-x 2 kt kt 4096 2008-09-09 18:10。
drwxrwxr-x 4 kt kt 4096 2008-09-09 18:10 ..
-????????? ? ? ? ? ? 提交消息
-????????? ? ? ? ? ? 提交后
-????????? ? ? ? ? ? 接收后
-????????? ? ? ? ? ? 更新后
-????????? ? ? ? ? ? 预应用补丁
-????????? ? ? ? ? ? 预提交
-????????? ? ? ? ? ? 预变基
-????????? ? ? ? ? ? 更新

```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T14:34:32.417

首先，这是您的问题，格式很好（将其括在 < pre > 标签中以获取此问题）：

```
kt@rails-ubuntu:~/rails/ledger/releases/20080820144914/.git/hooks$ ls -al
ls: 无法访问 post-commit: 没有这样的文件或目录
ls：无法访问更新：没有这样的文件或目录
ls：无法访问更新后：没有这样的文件或目录
[剪辑]
```

无论如何，您需要以单用户模式启动并运行 fsck。如果您现在无法重新启动，只需将目录移动到 /tmp 并忘记它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:36:35.763

(a) 看起来你有某种文件系统问题；我建议你运行 fsck 看看它是否找到任何东西

(b) 真的不是一个与编程相关的问题，所以这里离题了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-25T00:21:44.117

我遇到了由 Aptana Studio 多次使用 rails 引起的相同问题。长期的解决方案是避免使用 aptana 创建文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-11T13:57:22.613

我遇到了这个问题并尝试了一切。令人惊讶的是，解决方案非常简单。伙计，这就是你要做的：使用 GUI 而不是终端 1\. 将该文件夹中的所有其他文件移动到另一个名称不同的文件 2\. 将应该只有有问题的文件的包含目录移动到垃圾箱 3 清空垃圾箱

是的，就是这么简单

# javascript - 可以从 JavaScript 在 IE7 中设置选项卡焦点

> ID：72943
> 
> 赞同：1
> 
> 时间：2008-09-16T14:31:04.310
> 
> 标签：javascript, internet-explorer-7, focus

是否可以使用 window.Open 函数在 JavaScript 中启动一个新窗口，然后将焦点设置到该选项卡？

这就是我今天正在做的事情：

 `````
            var winRef = window.open(outUrl,wName,'left='+ wX +',top=' + wY + ',height=' + wH + ',width=' + wW + args);
            try {
                // Not all window types support the focus() property.
                winRef.focus();
            }
            catch (exception) {
            }

````  `窗口打开，但新选项卡没有获得焦点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T14:35:19.480

杰伊，

您正在看到设计的行为。为了限制恶意行为的机会，在选项卡式窗口中运行的脚本不能影响其他选项卡。

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/ms537636.aspx](http://msdn.microsoft.com/en-us/library/ms537636.aspx)上的面向开发人员的选项卡式浏览：

“在同一个浏览器窗口中打开多个文档的能力具有一定的实用性和安全性 [...] 活动选项卡（具有焦点的选项卡）不会受到在非活动或后台选项卡中运行的脚本的影响。”

BR。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T14:33:28.940

作为用户，除非我特别要求，否则我从不希望应用程序（或选项卡）成为焦点。出于这个原因，我已经竭尽全力防止我的浏览器（Firefox）中的选项卡成为焦点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:35:59.947

我有理由确定您不能将焦点转移到另一个选项卡上。

我的理解是这样做是为了在一定程度上限制弹出窗口和其他恶意内容窃取用户的注意力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T22:50:09.417

如果另一个“选项卡”是您的应用程序的一部分（而不是来自其他站点的内容），也许您应该将其包含在主要内容之上的弹出 div 中，而不是在单独的窗口中；这样你就可以随时控制它的焦点，停用它下面的内容（对于模态对话框），隐藏它等等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T18:06:23.413

作为用户，我不应该能够控制它的运作方式吗？

如果有一个应用程序可以通过我想要运行的此功能得到增强，我不应该能够授予域该权限吗？

只是一个想法。

# python - 如何使用 Django 创建三联表

> ID：72945
> 
> 赞同：11
> 
> 时间：2008-09-16T14:31:21.737
> 
> 标签：python, django, model-view-controller, model

使用 Django 的内置模型，如何在三个模型之间创建三重连接。

例如：

*   用户、角色和事件是模型。
*   用户有很多角色，角色也有很多用户。（多对多）
*   事件有很多用户，用户也有很多事件。（多对多）
*   但是对于任何给定的事件，任何用户可能只有一个角色。

这如何在模型中表示？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-16T22:22:52.757

**zacherates**写道：

> 我将角色建模为用户和角色之间的关联类（...）

我也推荐了这个解决方案，但您也可以使用 Django 提供的一些语法糖：[ManyToMany relationship with extra fields](http://docs.djangoproject.com/en/dev/topics/db/models/#extra-fields-on-many-to-many-relationships)。

例子：

```
class User(models.Model):
    name = models.CharField(max_length=128)

class Event(models.Model):
    name = models.CharField(max_length=128)
    members = models.ManyToManyField(User, through='Role')

    def __unicode__(self):
        return self.name

class Role(models.Model):
    person = models.ForeignKey(User)
    group = models.ForeignKey(Event)
    date_joined = models.DateField()
    invite_reason = models.CharField(max_length=64) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T14:49:20.447

我建议为此创建一个完全独立的模型。

```
class Assignment(Model):
    user = ForeignKey(User)
    role = ForeignKey(Role)
    event = ForeignKey(Event) 
```

这使您可以执行所有常见的模型操作，例如

```
user.assignment_set.filter(role__name="Chaperon")
role.assignment_set.filter(event__name="Silly Walkathon") 
```

剩下的唯一一件事就是强制执行您的一个角色每个用户每个事件的限制。您可以通过覆盖保存方法（[http://docs.djangoproject.com/en/dev/topics/db/models/#overriding-predefined-model-methods](http://docs.djangoproject.com/en/dev/topics/db/models/#overriding-predefined-model-methods)）或使用信号（[http: //docs.djangoproject.com/en/dev/topics/signals/](http://docs.djangoproject.com/en/dev/topics/signals/)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:51:09.767

我将角色建模为用户和角色之间的关联类，因此，

```
class User(models.Model):
     ...

class Event(models.Model):
     ...

class Role(models.Model):
     user = models.ForeignKey(User)
     event = models.ForeignKey(Event) 
```

并在经理或 SQL 约束中为每个事件的每个用户强制执行一个角色。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-30T00:11:45.043

在尝试为我自己的 Django 模型找到更快的三表连接时，我遇到了这个问题。默认情况下，Django 1.1 使用 INNER JOIN，这在 InnoDB 上可能很慢。对于像这样的查询：

```
def event_users(event_name):
    return User.objects.filter(roles__events__name=event_name) 
```

这可能会创建以下 SQL：

```
SELECT `user`.`id`, `user`.`name` FROM `user` INNER JOIN `roles` ON (`user`.`id` = `roles`.`user_id`) INNER JOIN `event` ON (`roles`.`event_id` = `event`.`id`) WHERE `event`.`name` = "event_name" 
```

与 LEFT JOIN 相比，INNER JOIN 可能非常慢。在 gimg1 的回答下可以找到更快的查询：[Mysql query to join three tables](https://stackoverflow.com/questions/10257433/mysql-query-to-join-three-tables#10257569)

```
SELECT `user`.`id`, `user`.`name` FROM `user`, `roles`, `event` WHERE `user`.`id` = `roles`.`user_id` AND `roles`.`event_id` = `event`.`id` AND `event`.`name` = "event_name" 
```

但是，您需要使用自定义 SQL 查询：[https ://docs.djangoproject.com/en/dev/topics/db/sql/](https://docs.djangoproject.com/en/dev/topics/db/sql/)

在这种情况下，它看起来像：

```
from django.db import connection
def event_users(event_name):
    cursor = connection.cursor()
    cursor.execute('select U.name from user U, roles R, event E' \
                   ' where U.id=R.user_id and R.event_id=E.id and E.name="%s"' % event_name)
    return [row[0] for row in cursor.fetchall()] 
```

# javascript - 如何在 Javascript 中通过 Firefox XPCOM 获取可靠的 HTTP 消息

> ID：72958
> 
> 赞同：1
> 
> 时间：2008-09-16T14:32:40.983
> 
> 标签：javascript, http, xpcom

我正在尝试使用 XPCOM 在 Firefox 上的 Javascript 中编写一个小型服务器+客户端。

为了在 Javascript 中获取 HTTP 消息，我使用了 nsIScriptableInputStream 接口。这个 f**ing 组件通过 read() 方法随机剪切消息，我无法使其可靠。

有人知道可靠地获取信息的解决方案吗？（我已经尝试过二进制流，同样失败。）

J。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:08:17.577

我在不可靠性方面遇到了同样的问题......我最终使用了 XMLHTTPRequest，当从 XPCOM 组件中使用它时，它可以进行跨站点请求。[文档](http://developer.mozilla.org/en/XMLHttpRequest)的第二部分详细介绍了如何实例化 XPCOM 版本。

如果您正在寻找服务 HTTP 请求，我会看一下[POW](https://addons.mozilla.org/en-US/firefox/addon/3002)源代码和[服务器套接字](http://www.xulplanet.com/tutorials/mozsdk/serverpush.php)的使用，它在 JavaScript 中实现了一个基本的 HTTP 服务器。另请查看[httpd.js](http://mxr.mozilla.org/mozilla/source/netwerk/test/httpserver/httpd.js)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T16:00:47.013

If you control the protocol (that is, both the client and server) I would highly recommend using Javascript/JSON for your server-to-client messages. The client can open a stream either via dynamically adding a <script> tag to the DOM. The server can then send a stream of Javascript commands like:

```
receiveMsg({type:"text", content:"this is my message"}); 
```

Then the client just needs to define a receiveMsg function. This allows you to rely on fast browser code to parse the message and determine where the end of each message is, at which point it will call your handler for you.

Even if you're working with an existing HTTP protocol and can't use JSON, is there some reason you can't use XMLHttpRequest? I would expect it to be more stable than some poorly documented Firefox-specific XPCOM interface.

--Chouser

# sql-server - 数据库的日志文件已满

> ID：72961
> 
> 赞同：9
> 
> 时间：2008-09-16T14:32:49.237
> 
> 标签：sql-server, sql-server-2000

所以我们的 SQL Server 2000 给我一个错误，“数据库的日志文件已满。备份数据库的事务日志以释放一些日志空间。”

我该如何解决这个问题而不像其他一些网站提到的那样删除日志？

附加信息：启用 AutoGrowth 启用增长 10% 并限制为 40MB。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T14:41:26.843

只是清空它：

```
backup log <dbname> with truncate_only 
```

将其保存在某处：

```
backup log <dbname> to disk='c:\somefile.bak' 
```

如果您真的不需要事务历史记录，请尝试将数据库恢复模式设置为简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T16:53:21.287

斯科特，正如您所猜测的：如果您关心您的数据，那么截断日志是一个糟糕的举动。

以下免费视频将帮助您准确了解正在发生的事情，并向您展示如何在不截断日志的情况下解决问题。（这些视频还解释了为什么这是一个如此危险的黑客攻击，以及为什么寻找其他解决方案是正确的。）

*   [SQL Server 备份揭秘](http://www.sqlservervideos.com/sqlserver-backups/backups-demystified)
*   [SQL Server 日志记录基础](http://www.sqlservervideos.com/sqlserver-backups/logging-essentials)
*   [了解备份选项](http://www.sqlservervideos.com/sqlserver-backups/backup-options)

这些视频将帮助您准确了解正在发生的事情，并向您展示是否要切换到简单恢复，或者考虑实际更改备份例程。还有一些额外的“操作指南”视频将向您展示如何设置备份以确保可用性，同时管理日志文件的大小和增长。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T14:37:25.060

我不认为在数据库在线时重命名或移动日志文件会起作用。

IMO，最简单的事情是打开数据库的属性并将其切换到简单恢复模型。然后缩小数据库，然后返回并将数据库设置为 Full Recoery 模型（或您需要的任何模型）。

更改日志记录模式会强制 SQL Server 在数据库中设置检查点，之后收缩数据库将释放多余的空间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T20:50:06.817

如果您需要恢复到最新状态或在未来做其他有趣的事情（例如日志传送），或者将数据库设置为简单模式并缩小数据文件，请定期备份您的数据库日志。

请勿复制、重命名或删除 .ldf 文件，这将破坏您的数据库，并且在您从中恢复后，您的数据可能会处于不一致的状态，从而使其无效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T14:58:12.750

我过去遇到此错误的朋友建议：

尝试

*   备份数据库。维护计划包括截断这些文件。
*   还尝试将数据库的“恢复模式”更改为*简单*（例如，而不是*完整*）

原因：由于记录的事件导致事务日志膨胀（也许您有许多事务失败并被回滚..或者服务器上的事务突然达到峰值）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T16:08:32.127

您可能需要检查相关的 SO 问题：

*   [如何清除 SQL Server 2005 数据库中的事务日志？](https://stackoverflow.com/questions/56628/how-do-you-clear-the-transaction-log-in-a-sql-server-2005-database#63070)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T14:37:09.710

好吧，您可以获取事务日志的副本，然后截断日志文件，这就是错误消息所暗示的。

如果磁盘空间已满并且您无法通过网络将日志复制到另一台计算机，则通过 USB 连接驱动器并以这种方式将其复制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T14:38:12.500

您的问题有答案：备份日志，然后将其缩小。制定维护计划，定期备份数据库，不要忘记选择“备份事务日志”。这样你就可以保持小。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T14:47:30.840

如果**是非**生产环境使用

```
dump tran <db_name> with no_log; 
```

完成此操作后，缩小日志文件以释放磁盘空间。最后将数据库恢复模式切换为简单。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T15:14:26.860

一旦您对数据库进行了完整备份，并且数据库未使用简单恢复模型，SQL Server 就会完整记录数据库上曾经执行的所有事务。这样做是为了在您丢失数据文件的灾难性故障事件中，您可以通过备份日志恢复到故障点，并且在恢复旧数据备份后，恢复日志以重播丢失的数据交易。

为防止这种情况累积，您必须备份事务日志。或者，您可以使用 BACKUP LOG 的 TRUNCATE_ONLY 或 NO_LOG 选项在当前点断开链。

如果您不需要此功能，请将恢复模式设置为简单。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-06-11T11:38:34.897

我亲爱的朋友，对于 DBA 来说，经常检查他的日志文件非常重要。因为如果有一天你不给予太多关注，它会给出这个错误。

为此，您必须定期进行备份，以便日志文件不会遇到此类错误。

除此之外，上面给出的建议是完全正确的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-16T14:34:25.597

重命名它。例如：
old-log-16-09-08.log

然后 SQL 服务器可以使用一个新的空的。

# delphi - 哪个日志库更好？

> ID：72983
> 
> 赞同：23
> 
> 时间：2008-09-16T14:34:25.037
> 
> 标签：delphi, logging

我在想; 你更喜欢哪些 Delphi 的日志库？

*   [代码站点](http://www.raize.com/devtools/codesite/)
*   [智能检测](http://www.gurock.com/products/smartinspect/)
*   [Log4Delphi](http://log4delphi.sourceforge.net/)
*   [跟踪格式](http://tracetool.sourceforge.net/)

如果您使用过不止一种，请尝试添加为什么您更喜欢其中一种的原因。

我会为这个问题添加建议以保持可读性。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-16T14:55:24.410

我使用过 Codesite，它非常棒。在一个项目中，一个文字处理器，我可以轻松地输出一百万行调试代码，所有的都是结构化的，Codesite 的自动折叠缩进输出帮助很大。对于任何你必须知道在一个不能被用户交互中断的过程“下面”真正发生了什么的任务，Codesite 真的很好。我衷心推荐它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-17T16:30:06.327

**SmartInspect**真的很有用。这是我唯一用过的。日志库很好，但控制台和远程 TCP/IP 日志将其置于首位。我认为 CodeSite 有一些类似的功能。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-04-15T12:08:41.337

看看这个开源单元的特点：http: [//blog.synopse.info/post/2011/04/14/Enhanced-logging-in-SynCommons](http://blog.synopse.info/post/2011/04/14/Enhanced-logging-in-SynCommons)

*   使用一组级别进行日志记录（不仅仅是级别的层次结构）；
*   快速、低执行开销；
*   可以加载 .map 文件符号以用于日志记录；
*   将 .map 压缩为二进制 .mab (900 KB -> 70 KB)；
*   可选择将 .map/.mab 包含到 .exe 中；
*   处理库（.ocx/.dll）；
*   带有单元名称和行号的异常记录（Delphi 或低级异常）；
*   带有单位和行号的可选堆栈跟踪；
*   方法或过程递归跟踪，带有 Enter 和 auto-Leave；
*   高分辨率时间戳，用于应用程序执行的客户端分析；
*   set/enumerates/TList/TPersistent/TObjectList/动态数组JSON序列化；
*   每个线程、旋转或全局日志记录；
*   同一进程上的多个日志文件；
*   可选的彩色控制台显示屏；
*   可选的重定向日志记录（例如到第三方库或远程服务器）；
*   日志查看器 GUI 应用程序，具有每个事件或每个线程过滤器和方法执行分析器；
*   开源，适用于 Delphi 5 到 XE6（Win32 和 Win64）。

欢迎您的反馈！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T16:49:52.450

并且不要忘记免费的开源[TraceTool](http://tracetool.sourceforge.net/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-11-12T13:49:32.307

我刚刚在 Sourceforge 页面上更新了 Log4Delphi 0.8，它汇总了过去 4 年的补丁和错误修复。

[Sourceforge Log4Delphi 下载](https://sourceforge.net/projects/log4delphi/files/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T14:36:45.327

Log4net/Log4xxx 的端口到其他语言。它是开源的、相当广泛的、流行的、背后有一个很好的社区，并且被广泛使用（例如，在 Hibernate/nHibernate 中）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-19T03:24:29.007

CodeSite 背后的一个重要价值是 Ray Kanopka 的支持。他亲自回复电子邮件和新闻组帖子，并且已经这样做了很多年。他的答案通常包含说明优秀编码习惯的代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T14:44:47.117

我没有使用 CodeSite 可能是因为我对 SmartInspect 非常满意。强烈推荐。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T15:53:11.743

我也在研究 Codesite。我过去建立了自己的，但我真的很喜欢 Codesite 中的功能。Raize 组件写得非常好，而且总是质量上乘。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-02T08:59:45.723

[Log4D](http://sourceforge.net/projects/log4d/)是另一种基于 Log4J 的实现，易于扩展和配置。

# .net - .NET Windows 窗体透明控件

> ID：72994
> 
> 赞同：15
> 
> 时间：2008-09-16T14:35:16.203
> 
> 标签：.net, winforms, user-interface

我想在[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)应用程序中模拟“Web 2.0”灯箱样式 UI 技术。也就是说，通过使窗口客户区中的所有其他内容“变暗”来引起对某些前台控件的注意。

显而易见的解决方案是创建一个控件，它只是一个部分透明的矩形，可以停靠到窗口的客户区域并带到 Z-Order 的前面。它需要像一块肮脏的玻璃一样，通过它仍然可以看到其他控件（因此继续绘制自己）。这可能吗？

我已经进行了一次很好的狩猎，并自己尝试了一些技术，但到目前为止都没有成功。如果不可能，那么另一种方法是什么？

请参阅：[http](http://www.useit.com/alertbox/application-design.html) ://www.useit.com/alertbox/application-design.html （在灯箱部分下的屏幕截图以说明我的意思。）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T14:52:19.377

你能在 .NET/C# 中做到这一点吗？

是的，你当然可以，但需要一点努力。我会推荐以下方法。创建一个没有边框或标题栏区域的顶级表单，然后通过将 TransparencyKey 和 BackColor 设置为相同的值来确保它不绘制客户区背景。所以你现在有一个什么都不画的窗口......

```
public class DarkenArea : Form
{
    public DarkenArea()
    {
        FormBorderStyle = FormBorderStyle.None;
        SizeGripStyle = SizeGripStyle.Hide;
        StartPosition = FormStartPosition.Manual;
        MaximizeBox = false;
        MinimizeBox = false;
        ShowInTaskbar = false;
        BackColor = Color.Magenta;
        TransparencyKey = Color.Magenta;
        Opacity = 0.5f;
    }
} 
```

创建此 DarkenArea 窗口并将其放置在表单的客户区域上。然后，您需要能够在不获得焦点的情况下显示窗口，因此您需要通过以下方式进行平台调用以在不激活它的情况下显示...

```
public void ShowWithoutActivate()
{
    // Show the window without activating it (i.e. do not take focus)
    PlatformInvoke.ShowWindow(this.Handle, (short)SW_SHOWNOACTIVATE);
} 
```

您需要让它实际绘制一些东西，但在要保持突出显示的控件区域中排除绘图。所以覆盖 OnPaint 处理程序并绘制黑色/蓝色或任何你想要的但不包括你想要保持明亮的区域......

```
protected override void OnPaint(PaintEventArgs e)
{
    base.OnPaint(e);
    // Do your painting here be exclude the area you want to be brighter
} 
```

最后，您需要覆盖 WndProc 以防止鼠标与窗口交互，如果用户尝试一些疯狂的事情，例如单击黑暗区域。像这样的东西...

```
protected override void WndProc(ref Message m)
{
    if (m.Msg == (int)WM_NCHITTEST)
        m.Result = (IntPtr)HTTRANSPARENT;
    else
        base.WndProc(ref m);
} 
```

这应该足以获得预期的效果。当您准备好反转效果时，您将处理 DarkenArea 实例并继续。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-04T06:12:07.390

这是一个非常酷的想法 - 我可能会使用它，所以谢谢。无论如何，我的解决方案非常简单......在当前表单上打开一个新的 50% 不透明表单，然后自定义为该表单绘制一个背景图像，矩形匹配您要突出显示的控件的边界，填充颜色透明度键。

在我的粗略样本中，我将这种形式称为“LBform”，它的实质是这样的：

```
public Rectangle ControlBounds { get; set; }
private void LBform_Load(object sender, EventArgs e)
{
    Bitmap background = new Bitmap(this.Width, this.Height);
    Graphics g = Graphics.FromImage(background);
    g.FillRectangle(Brushes.Fuchsia, this.ControlBounds);

    g.Flush();

    this.BackgroundImage = background;
    this.Invalidate();
} 
```

Color.Fuchia 是这个半透明表单的 TransparencyKey，因此您将能够看穿绘制的矩形并与主表单上其边界内的任何内容进行交互。

在我开始尝试的实验项目中，我使用了一个动态添加到表单的 UserControl，但您也可以轻松地使用表单上已有的控件。在主窗体（您正在隐藏的那个）中，我将相关代码放入按钮单击中：

```
private void button1_Click(object sender, EventArgs e)
{
    // setup user control:
    UserControl1 uc1 = new UserControl1();
    uc1.Left = (this.Width - uc1.Width) / 2;
    uc1.Top = (this.Height - uc1.Height) / 2;
    this.Controls.Add(uc1);
    uc1.BringToFront();

    // load the lightbox form:
    LBform lbform = new LBform();
    lbform.SetBounds(this.Left + 8, this.Top + 30, this.ClientRectangle.Width, this.ClientRectangle.Height);
    lbform.ControlBounds = uc1.Bounds;

    lbform.Owner = this;
    lbform.Show();
} 
```

如果您愿意，您可以按照自己的方式做一些非常基本的东西，但它只是添加用户控件，然后将灯箱表单设置在主表单上并设置 bounds 属性以在正确的位置呈现完全透明度。我的快速示例中没有处理表单拖动和关闭灯箱表单和 UserControl 之类的事情。哦，别忘了处理 Graphics 实例 - 我也把它遗漏了（已经很晚了，我真的很累）。

[这是我在 20 分钟内完成的演示](http://cid-12d219ccfc930f76.skydrive.live.com/self.aspx/Code/LightBox000.zip)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T14:40:36.380

表单本身具有`Opacity`完美的属性，但我认为大多数单独的控件都没有。你必须拥有它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T14:40:40.810

大的调光矩形很好。

另一种方法是：

滚动你自己的基 Form 类说一个会从 a`MyLightboxAwareForm`监听a 的类。然后让您的所有表单继承自.`LightboxEvent``LightboxManager``MyLightboxAwareForm`

在 any 上调用该`Show`方法时`Lightbox`，将向所有实例`LightboxManager`广播一个事件并使它们自己变暗。`LightboxShown``MyLightboxAwareForm`

这样做的好处是，正常的 Win32 表单功能将继续工作，例如当您单击其模式对话框之一时表单的任务栏闪烁或鼠标悬停/鼠标按下事件的管理仍将正常工作等。

如果你想要矩形调光风格，你可以把逻辑放在 MyLightboxAwareForm

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-22T15:39:06.213

另一个不涉及使用新 Form 的解决方案：

*   为您的容器制作图片（表单/面板/其他），
*   改变它的不透明度，
*   将其显示在新面板的背景中。
*   用那个面板填充你的容器。

现在代码...

假设我有一个名为 Frame 的 UserControl，我想在其中应用我的灯箱效果：

```
public partial class Frame : UserControl
{
    private Panel shadow = new Panel();
    private static float LIGHTBOX_OPACITY = 0.3f;

    public Frame()
    {
        InitializeComponent(); 
        shadow.Dock = DockStyle.Fill;
    }

    public void ShowLightbox()
    {
        Bitmap bmp = new Bitmap(this.Width, this.Height);
        this.pnlContainer.DrawToBitmap(bmp, new Rectangle(0, 0, this.Width, this.Height));
        shadow.BackgroundImage = SetImgOpacity(bmp, LIGHTBOX_OPACITY );
        this.Controls.Add(shadow);
        shadow.BringToFront();
    }

    // http://www.geekpedia.com/code110_Set-Image-Opacity-Using-Csharp.html
    private Image SetImgOpacity(Image imgPic, float imgOpac)
    {
        Bitmap bmpPic = new Bitmap(imgPic.Width, imgPic.Height);
        Graphics gfxPic = Graphics.FromImage(bmpPic);
        ColorMatrix cmxPic = new ColorMatrix();
        cmxPic.Matrix33 = imgOpac;
        ImageAttributes iaPic = new ImageAttributes();
        iaPic.SetColorMatrix(cmxPic, ColorMatrixFlag.Default, ColorAdjustType.Bitmap);
        gfxPic.DrawImage(imgPic, new Rectangle(0, 0, bmpPic.Width, bmpPic.Height), 0, 0, imgPic.Width, imgPic.Height, GraphicsUnit.Pixel, iaPic);
        gfxPic.Dispose();
        return bmpPic;
    }
} 
```

使用这种技术的优点是：

*   您不必处理所有鼠标事件
*   您无需管理多个表单即可与灯箱元素进行通信
*   没有覆盖 WndProc
*   您会很酷，因为您将是唯一不使用表单来实现此效果的人。

缺点主要是这种技术要慢得多，因为您必须处理整个图像才能使用 ColorMatrix 校正每个像素点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T14:48:27.157

每个表单都有“不透明度”属性。将其设置为 50%（或代码中的 0.5），这样将是半透明的。删除边框并将其最大化显示在您想要关注的表单之前。您可以更改表单的背景颜色，甚至可以为不同的效果设置背景图像。

# java - 将带有 xinclude 标记的多个 XML 文件加入到单个文件中

> ID：72996
> 
> 赞同：2
> 
> 时间：2008-09-16T14:35:18.683
> 
> 标签：java, xml, installation, xinclude, izpack

我正在 IzPack 中创建安装程序。它非常大，我已经使用 <xinclude> 和 <xfragment> 标记适当地分解了我的 XML 文件。不幸的是，当您构建安装程序时，IzPack 不会将它们组合在一起。这需要您使用安装程序打包文件，这不起作用。

我正要开始用 Java 编写一个工具来加载 XML 文件并将它们组合起来，但我不想重新发明轮子。

Java XML 库是否提供对 xinclude 的本机处理？谷歌似乎没有出现太多。

如果我必须自己写这个没什么大不了的，只是想和你们核实一下。谢谢。

用于示例目的的 XML 格式：File1.xml

```
<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<installation version="1.0">
<packs>      
    <pack name="Transaction Service" id="Transaction Service" required="no" >
        <xinclude href="example/File2.xml" />
    </pack>
</packs> 
```

文件2.xml

```
<xfragment>
    <file src="..." />
</xfragment> 
```

File2 不需要标准 XML 标头。xml 文件在构建时解析，因为它指定的资源包含在安装程序中。不包括的是实际的 XML 信息（写入文件的顺序、放置它们的位置等）

我希望生产的产品：

```
<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<installation version="1.0">
<packs>      
    <pack name="Transaction Service" id="Transaction Service" required="no" >
        <file src="..." />
    </pack>
</packs> 
```

谢谢，我现在要开始用 Java 把它搅在一起，但希望有人有一个简单的答案。

蒂姆雷诺兹

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T16:33:25.843

如果你不能让 xinclude 工作并且你正在使用 Ant，我推荐[XMLTask](http://www.oopsconsultancy.com/software/xmltask)，它是 Ant 的插件任务。它会做很多聪明的事情，包括你感兴趣的一件事——用片段构造一个 XML 文件。

例如

```
<xmltask source="templatefile.xml" dest="finalfile.xml">
  <insert path="/packs/pack[1]" position="under" file="pack1.xml"/>
</xmltask> 
```

（警告-以上是从内存中完成的，所以请查阅文档！）。

请注意，在上面，文件*pack1.xml* l 不必有根节点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T15:01:35.500

I'm not sure if java supports automatic xinclude. But you will have to use namespaces to make it work. So don't use `<xinclude ....>`, but use:

```
<xi:xinclude xmlns:xi="http://www.w3.org/2001/XInclude" href="example/File2.xml" /> 
```

Normally the included file should still contain the xml header as well. There is no requirement for it to e.g. have the same encoding.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-17T23:57:00.320

只为任何想知道的人。IzPack 使用 nanoXML 来解析所有配置文件。它没有命名空间。并且不处理 xml 包含。

为了解决我遇到的问题，我将“xinclude”等（片段/后备）元素添加到解析器内容中，以便它主要遵循 x:include 的标准（注意名称差异？）一个是正确的并且具有命名空间。另一个是一个讨厌的 hack，它假装遵循标准而不使用命名空间。

无论如何，这是很久以前的事了，现在 IzPack 使用了一个健全的 XML 解析器，并且了解您是否正确执行 xi:include 或您希望使用的任何前缀都没有问题。它是体面的 xml 解析器的标准。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-10T20:35:12.850

例如，Apache Xerces 应该支持 Xinclude，但您需要启用它。

[http://xerces.apache.org/xerces2-j/faq-xinclude.html](http://xerces.apache.org/xerces2-j/faq-xinclude.html)

```
import javax.xml.parsers.SAXParserFactory;

SAXParserFactory spf = SAXParserFactory.newInstance();
spf.setNamespaceAware(true);
spf.setXIncludeAware(true); 
```

他们的文档还说您可以将其作为一项[功能启用](http://xerces.apache.org/xerces2-j/features.html#xinclude)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-19T19:46:28.520

这现在有效：

```
<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<installation version="1.0">
<packs>      
    <pack name="Transaction Service" id="Transaction Service" required="no" >
        <xi:include href="example/File2.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    </pack>
</packs> 
```

示例/File2.xml

```
<?xml version="1.0" encoding="iso-8859-1" standalone="yes" ?>
<xfragment>
    <file src="..." />
</xfragment> 
`````***