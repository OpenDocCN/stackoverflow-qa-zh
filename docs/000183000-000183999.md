# StackOverflow 问答 000183000-000183999

# c - 自动构建 C 项目

> ID：183001
> 
> 赞同：2
> 
> 时间：2008-10-08T14:16:17.910
> 
> 标签：c, unit-testing, build-process, build-system

我正在与其他人一起开发一个免费软件（bsd 许可证）项目。我们正在寻找一个系统来检查我们的源代码 (svn) 并构建它作为测试它（使用 Check / 其他工具进行单元测试）。

它应该有一个基于网络的界面并生成报告。

我希望我们不必自己从null编写这样的系统......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T14:30:10.957

您当然不必自己编写代码 - 有很多[持续集成](http://en.wikipedia.org/wiki/Continuous_integration)系统能够从 SVN 等系统中检查源代码，并且它们通常很容易通过您自己的任务进行扩展，因此运行自定义测试脚本/程序应该不是问题。

虽然这些 CI 系统可能不是用 C 编写的，但这并不重要，因为它们只需要能够访问和编译您的源代码，无论如何他们都将使用外部编译器。

仅列出一些众所周知的 CI 工具：

*   [巡航控制](http://cruisecontrol.sourceforge.net/)
*   [哈德逊](http://hudson-ci.org/)
*   [团队城市](http://www.jetbrains.com/teamcity/)

您可能还[对 Stack Overflow 上标记为 Continuous-integration 的其他问题](https://stackoverflow.com/questions/tagged/continuous-integration)感兴趣。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T14:25:01.357

我不认为有一个构建系统能够完成所有这些任务 - 但是将它们组合起来怎么样？

[SCons](http://www.scons.org)是一个很好的构建系统，可以在每台装有[Python](http://www.python.org)的机器上运行。它甚至可以直接从[SVN](http://subversion.tigris.org/)构建。对于自动构建，您可以尝试[Buildbot](http://buildbot.net/trac)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T14:28:22.177

查看[构建机器人](http://buildbot.net/trac)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T20:03:28.583

我的投票是 CruiseControl.NET，它有你想要的一切。它是开源的，因此成本很低，并且它在 google 群组上有一个非常活跃的用户社区，可以帮助您解决问题，因为您已经习惯了它。此外，虽然基于 .NET，但使用 MONO 在 Linux 和 Mac 构建服务器上也非常好，因此您可以涵盖所有内容。

# excel - 保护 Excel 工作表的格式和大小，只允许输入

> ID：183002
> 
> 赞同：5
> 
> 时间：2008-10-08T14:16:42.060
> 
> 标签：excel

我正在创建一个 XLS 工作表，用于从用户那里收集数据。我已经使用验证限制了用户输入。为了能够轻松打印工作表，我设置了列的长度。已将相关列换行。但是我想保护工作表，以使用户不允许 1\. 更改格式 2\. 更改验证 3\. 更改列大小 用户应该被允许 1\. 输入输入值 2\. 选择值（从下拉凡适用）

保护表始终限制用户输入。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:48:34.117

关键是*在*您保护工作表后使用“允许用户编辑范围”中公开的界面。我假设您使用的是 Office 2003，因为您没有指定，因此您可以在**Tools -> Protection -> Allow Users to Edit Ranges**中找到它。

从那里应该很明显 - 您创建命名范围并基于此授予用户编辑权限。

在让用户从组合框中选择值的第二个问题上，您可以通过**Data -> Validation**控制它，然后创建一个自定义列表。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-08T14:44:46.543

通常，当您保护工作表时，您会看到一个对话框，允许您选择用户可以做什么和不可以做什么。如果您选择正确的选项，您将能够做您想做的事。

请查看[此博客文章](http://all-e-courses.blogspot.com/2008/03/protect-worksheets.html)了解更多详细信息。

# jquery - 如何在jQuery中获取对具有特定值的表行的引用

> ID：183004
> 
> 赞同：2
> 
> 时间：2008-10-08T14:17:31.543
> 
> 标签：jquery

我正在尝试使用 jQuery 突出显示表格中的一个特定行。该行将具有“活动”状态。我在网上看到了很多例子，这些例子展示了如何为交替行样式做斑马条纹。有谁知道一个 jQuery 表达式，它将根据特定列中元素的值获取一个元素？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T14:21:11.817

[在http://docs.jquery.com/Selectors](http://docs.jquery.com/Selectors)上查看“:contains”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T14:21:52.453

您可以使用其中之一：

```
$("td").contains("test"); 
```

或者

```
$("div:contains('John')"); 
```

# c# - C#谷歌地球错误

> ID：183009
> 
> 赞同：2
> 
> 时间：2008-10-08T14:18:14.503
> 
> 标签：c#, controls, google-earth-plugin

我的一个朋友在 C# 用户控件中嵌入了一个谷歌地球插件。一切正常，但是当您关闭窗口时，我们会收到“未指定错误”，并可选择继续运行脚本或不运行脚本。从我们的跟踪来看，这似乎是由 google 放置在页面上的脚本引起的。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-22T12:01:14.467

这是我的 c#/Google Earth API 集成示例，涵盖了您遇到的问题（请参阅评论） [http://fraserchapman.blogspot.com/2008/08/google-earth-plug-in-and -c.html](http://fraserchapman.blogspot.com/2008/08/google-earth-plug-in-and-c.html)

此外，这是我的另一个项目，它使用 COM Google Earth 插件类型库 (plugin_ax.dll) 转换为公共语言运行时程序集中的等效定义。它可能有一些用处。[http://fraserchapman.blogspot.com/2008/12/google-earth-plugin-control-library.html](http://fraserchapman.blogspot.com/2008/12/google-earth-plugin-control-library.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T14:41:58.123

我们现在已经在 IE 和 FF 中尝试过。工作正常。任何想法为什么错误只会在关闭时出现？我们可以以某种方式禁用它吗？这是我们的代码。

```
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<html>
<head>
    <script src="http://www.google.com/jsapi?key=ABQIAAAAzghEPRV_D0MDzTELJ4nkXBT2AlVLQD8Rz4_aVbiXesLoyhRIMBRo399nnxv9aY-fqnkVGgTgR-pTsg">
    </script>
    <script>
        google.load("earth", "1");
        var ge = null;
        var placemark;
        function init(){
            google.earth.createInstance("map3d", initCallback, failureCallback);
        }

        function initCallback(object){
            ge = object;
            ge.getWindow().setVisibility(true);
            ge.getNavigationControl().setVisibility(ge.VISIBILITY_SHOW);
            ge.getLayerRoot().enableLayerById(ge.LAYER_TERRAIN, false);

            placemark = ge.createPlacemark('');
            placemark.setName("Current Position");
            // Create style map for placemark
            var normal = ge.createIcon('');
            normal.setHref('http://maps.google.com/mapfiles/kml/paddle/red-circle.png');
            var iconNormal = ge.createStyle('');
            iconNormal.getIconStyle().setIcon(normal);
            var highlight = ge.createIcon('');
            highlight.setHref('http://maps.google.com/mapfiles/kml/paddle/red-circle.png');
            var iconHighlight = ge.createStyle('');
            iconHighlight.getIconStyle().setIcon(highlight);
            var styleMap = ge.createStyleMap('');
            styleMap.setNormalStyle(iconNormal);
            styleMap.setHighlightStyle(iconHighlight);
            placemark.setStyleSelector(styleMap);

            var options = ge.getOptions();

            options.setStatusBarVisibility(true);
            options.setScaleLegendVisibility(true);
        }

        function failureCallback(object){
            // Gracefully handle failure.
            alert("Error");
        }

        function changeViewAngle(angle){
            var lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_ABSOLUTE);
            lookAt.setTilt(angle);
            ge.getView().setAbstractView(lookAt);
        }

        function ShowMarker(){
            ge.getFeatures().appendChild(placemark);
        }

        function MoveMarker(lon, lat){
            // Create point
            var la = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
            var point = ge.createPoint('');
            point.setLatitude(lat);
            point.setLongitude(lon);
            placemark.setGeometry(point);
        }

        function HideMarker(){
            ge.getFeatures().removeChild(placemark);
        }

        function SetPosition(lon, lat, heading){
            var lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
            lookAt.setLatitude(lat);
            lookAt.setLongitude(lon);
            lookAt.setHeading(heading);
            ge.getView().setAbstractView(lookAt);
        }

        function SetAltitude(alt){
            var lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
            lookAt.set(lookAt.getLatitude(), lookAt.getLongitude(), 0, ge.ALTITUDE_RELATIVE_TO_GROUND, 0, lookAt.getTilt(), alt);
            ge.getView().setAbstractView(lookAt);
        }

        function ResizeMap(w, h){
            var map = document.getElementById('map3d_container');
            map.style.height = h;
            map.style.width = w;
        }

        function AddKML(kml){
            var parseKML = ge.parseKml(kml);
            ge.getFeatures().appendChild(parseKML);
            return ge.getFeatures().getLastChild().getName();
        }

        function RemoveKML(kmlName){
            if (ge.getFeatures().hasChildNodes()) {
                var nodes = ge.getFeatures().getChildNodes();
                for (var i = 0; i < nodes.getLength(); i++) {
                    var child = nodes.item(i);
                    if (child.getName() == kmlName) {
                        ge.getFeatures().removeChild(child);
                    }
                }
            }
        }

        function OptionsChanged(nav, status, scale, grid, map, terrain, road, border, building){
            var options = ge.getOptions();
            var form = document.options;

            if (nav) {
                ge.getNavigationControl().setVisibility(ge.VISIBILITY_SHOW);
            }
            else {
                ge.getNavigationControl().setVisibility(ge.VISIBILITY_HIDE);
            }

            options.setStatusBarVisibility(status);
            options.setScaleLegendVisibility(scale);
            options.setGridVisibility(grid);
            options.setOverviewMapVisibility(map);
            ge.getLayerRoot().enableLayerById(ge.LAYER_TERRAIN, terrain);
            ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS, road);
            ge.getLayerRoot().enableLayerById(ge.LAYER_BORDERS, border);
            ge.getLayerRoot().enableLayerById(ge.LAYER_BUILDINGS, building);
        }

    </script>
</head>
<body onload='init()'>
    <center>
        <div id='map3d_container' style='border: 1px solid silver; height: 510px; width: 767px;'>
            <DIV id=map3d style="HEIGHT: 100%">
            </DIV>
        </div>
    </center>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T17:04:44.467

我运行了示例并且在关闭选项卡时没有收到任何错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T13:46:40.350

试试这个

yourWebBrowser1.Document.Write(String.Empty);

当您关闭应用程序时。

我的问题：你能告诉我如何在 C# 应用程序中使用 AddKML(kml) 吗？通过字符串或文件路径，我都尝试了。我正在寻找一种解析kml文件的方法......

# hibernate - 休眠：比较当前和以前的记录

> ID：183013
> 
> 赞同：5
> 
> 时间：2008-10-08T14:18:43.757
> 
> 标签：hibernate, jpa, session, diff

我想将内存中 Hibernate 实体的当前值与数据库中的值进行比较：

```
HibernateSession sess = HibernateSessionFactory.getSession();
MyEntity newEntity = (MyEntity)sess.load(MyEntity.class, id);
newEntity.setProperty("new value");
MyEntity oldEntity = (MyEntity)sess.load(MyEntity.class, id);
// CODEBLOCK#1 evaluate differences between newEntity and oldEntity
sess.update(newEntity); 
```

在**CODEBLOCK#1**中，我得到了`newEntity.getProperty()="new value"`AND `oldEntity.getProperty()="new value"`（当然，我期望`oldEntity.getProperty()="old value"`的是）。实际上这两个对象在内存中是完全一样的。

我搞砸了`HibernateSessionFactory.getSession().evict(newEntity)`并试图`oldEntity=null`摆脱它（我只需要它来进行比较）：

```
HibernateSession sess = HibernateSessionFactory.getSession();
MyEntity newEntity = (MyEntity)sess.load(MyEntity.class, id);
newEntity.setProperty("new value");
HibernateSessionFactory.getSession().evict(newEntity);
MyEntity oldEntity = (MyEntity)sess.load(MyEntity.class, id);
// CODEBLOCK#1 evaluate differences between newEntity and oldEntity
oldEntity = null;
sess.update(newEntity); 
```

现在这两个实体是不同的，但我当然会感到恐惧`org.hibernate.NonUniqueObjectException: a different object with the same identifier value was already associated with the session`。

任何的想法？

**编辑：**我尝试了双会话策略；我修改了我`HibernateSessionFactory`以实现会话地图，然后......

```
Session session1 = HibernateSessionFactory.getSession(SessionKeys.DEFAULT);
Session session2 = HibernateSessionFactory.getSession(SessionKeys.ALTERNATE);
Entity newEntity = (Entity)entity;
newEntity.setNote("edited note");
Entity oldEntity = (Entity)session1.load(Entity.class, id);

System.out.println("NEW:" + newEntity.getNote());
System.out.println("OLD: " + oldEntity.getNote()); // HANGS HERE!!!

HibernateSessionFactory.closeSession(SessionKeys.ALTERNATE); 
```

我的单元测试在尝试打印 oldEntity 注释时挂起...... :-(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-09T09:42:23.967

两个简单的选择浮现在脑海：

1.  在保存 newEntity 之前驱逐 oldEntity
2.  在 oldEntity 上使用 session.merge() 将会话缓存 (newEntity) 中的版本替换为原始 (oldEntity)

**编辑**：稍微详细一点，这里的问题是 Hibernate 保持一个持久性上下文，这是作为每个会话的一部分被监视的对象。当上下文中有一个附加对象时，您不能对分离的对象（不在上下文中的对象）执行 update() 。这应该有效：

```
HibernateSession sess = ...;
MyEntity oldEntity = (MyEntity) sess.load(...);
sess.evict(oldEntity); // old is now not in the session's persistence context
MyEntity newEntity = (MyEntity) sess.load(...); // new is the only one in the context now
newEntity.setProperty("new value");
// Evaluate differences
sess.update(newEntity); // saving the one that's in the context anyway = fine 
```

应该这样：

```
HibernateSession sess = ...;
MyEntity newEntity = (MyEntity) sess.load(...);
newEntity.setProperty("new value");
sess.evict(newEntity); // otherwise load() will return the same object again from the context
MyEntity oldEntity = (MyEntity) sess.load(...); // fresh copy into the context
sess.merge(newEntity); // replaces old in the context with this one 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T17:06:13.900

使用 session.isDirty() 怎么样？JavaDoc 说该方法将回答“如果我们刷新此会话，是否会执行任何 SQL？”这个问题。当然，这只有在你有一个新的干净会话开始时才有效。另一种选择 - 只需使用两个不同的会话。

# sql - 在 Access 子报表中使用 top 子句

> ID：183016
> 
> 赞同：2
> 
> 时间：2008-10-08T14:19:51.570
> 
> 标签：sql, ms-access

我正在 Access 2003 中制作一份报告，其中包含相关记录的子报告。在子报告中，我只想要前两条记录。当我将“TOP 2”添加到子报表的查询中时，似乎在过滤链接字段之前选择了前两条记录。如何获取仅适用于相应链接字段的那些记录的前两条记录？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-03T08:21:09.120

下面的示例查询应该为每个客户返回一对最近的订单（而不是所有订单）：

```
select
    Order.ID,
    Order.Customer_ID,
    Order.PlacementDate
from
    Order
where
    Order.ID in 
        (
            select top 2
                RecentOrder.ID
            from
                Order as RecentOrder
            where
                RecentOrder.Customer_ID = Order.Customer_ID
            order by
                RecentOrder.PlacementDate Desc
        ) 
```

可以在您的子报告中使用这样的查询来避免使用临时表。

CAVEAT EMPTOR：我没有测试这个示例查询，我不知道这个查询是否适用于针对 Jet 数据库运行的报告（我们不使用 Access 来存储数据，并且我们避免了像瘟疫这样的 Access 报告:-)。但它应该针对 SQL Server。

我也不知道它在你的情况下表现如何。像往常一样，这取决于。:-)

顺便说一句，说到性能和黑客。我不会认为使用临时表是一种黑客行为。在最坏的情况下，这个技巧可以被认为是一个比报告更复杂的接口。:-) 而且使用这样的临时表实际上可能是提高性能的好方法之一。所以，不要着急把它写下来。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:03:48.520

我有两个建议：
1）将您的主字段（在父表单上）作为参数传递给查询（您也可以直接引用父表单上的字段）
2）您可以在 Access 和限制中伪造行号他们只有rownum <= 2。例如，

```
SELECT o1.order_number, o1.order_date,
    (SELECT COUNT(*) FROM orders AS o2
        WHERE o2.order_date <= o1.order_date) AS RowNum
    FROM
        orders AS o1
    ORDER BY o1.order_date 
```

（来自[http://groups.google.com/group/microsoft.public.access.queries/msg/ec562cbc51f03b6e?pli=1](http://groups.google.com/group/microsoft.public.access.queries/msg/ec562cbc51f03b6e?pli=1)）
但是，这种查询可能会返回只读记录集，因此可能不会被占用如果您需要在表单而不是报告上做同样的事情。

# ruby-on-rails - 在 Rails 生产环境中移除缓存破坏

> ID：183017
> 
> 赞同：9
> 
> 时间：2008-10-08T14:19:53.330
> 
> 标签：ruby-on-rails, deployment, caching

当我在生产模式下部署 rails 应用程序时，它会将日期时间字符串作为查询参数附加到所有静态资产 url 的末尾。这是为了防止浏览器在我重新部署应用程序后使用过时的资产缓存副本。

有没有办法让 Rails 使用自上次部署以来未更改的资产（并且**只有**未更改的资产）的旧时间戳。我想这样做是为了防止用户不得不重新下载那些没有改变的资产。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-10T18:21:32.973

Capistrano 默认情况下会触及它认为是“资产”的每个文件。正如您所说，这意味着在每次部署之后，rails 都认为每个资产都已更改，并且浏览器每次都会下载更新的版本。

您可以使用以下设置在 Capistrano 中禁用此功能

```
set :normalize_asset_timestamps, false 
```

如果您使用的是 SVN，那么文件的修改日期应该反映它们在您的存储库中最后修改的日期，所以这应该是完美的。

如果您使用的是 Apache，您可以添加类似的内容来真正让缓存为您工作。这有助于告诉浏览器依赖“缓存控制”指令，这意味着如果它知道资产被缓存，它甚至不会打扰请求它。

```
#Etags should be based on the file parameters only (default includes INode)
FileETag MTime Size  

#Rewrite stuff
RewriteEngine On  

#This sets the environment variable (is_versioned) when the URL query string
#looks like ?874353948543  or any string of digits
RewriteCond %{QUERY_STRING} ^[0-9]+$
RewriteRule ^(.*)$ $1 [env=is_versioned:true]  

<Directory /deployed-rails-app/public/ >
    Options -Indexes FollowSymLinks -MultiViews
    AllowOverride None
    Order allow,deny
    allow from all  

    #For files, force the browser to rely on cache-control directives and 
    #Rails asset timestamps by removing Etags and Last-Modified dates  

    #For all assets that aren't stamped by rails, cache them for ~ 3 hours
    Header set "Cache-Control" "max-age=10000"
    Header unset Etag
    Header unset "Last-Modified"  

    #For all assets that ARE stamped by rails, cache them for 30 days
    Header set "Cache-Control" "max-age=2592000" env=is_versioned

</Directory> 
```

我已经以这种方式设置了我的生产服务器，现在返回的访问者只执行一个请求 (Get /)，它返回动态内容并且所有资产 (~ 40 - 50) 都被缓存。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T23:48:43.107

我认为您可以使用 ENV['RAILS_ASSET_ID'] 来更改缓存清除资产 ID。不幸的是，这适用于所有资产。

但如果未设置，则使用资产的源修改时间。如果该文件自您上次使用以来没有被修改过，那应该不是问题。

如果资产 ID 在未更改的情况下发生更改，则可能是因为您的部署过程改变了修改时间，也许您可​​以考虑对其进行调整。

最后，您始终[可以使用自己的自定义方法覆盖 rails_asset_id](http://geekblog.vodpod.com/?p=88)。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T11:16:33.873

@Aupajo 我喜欢这个，但我想我可以更进一步。这里的问题是 capistrano 确实会在每次部署时创建所有文件的新副本，因此所有缓存清除字符串都会更改。但是，文件的 MD5 只会在文件内容更改时更改。

当然，生成一个MD5既昂贵又慢，但是你可以把一个文件的MD5缓存在memcache中，（keyed on the change time，好像时间变了MD5**可能**变了，但是如果时间戳没有变MD5**不会**改变

# c# - How to read sql_variant database type in C#

> ID：183018
> 
> 赞同：3
> 
> 时间：2008-10-08T14:19:59.230
> 
> 标签：c#, sql-server, database

Looking into System.Data.DbType there is no SqlVariant type there. SqlDataReader, for example, provides the GetString method for reading into string variable. What is the appropriate way to retrieve data from the database field of type sql_variant, presumably into object?

The aim is to read data stored as [sql_variant type](http://msdn.microsoft.com/en-us/library/ms173829.aspx) in database. Not to assign the value into variable of object type. I mentioned object type variable because I thing the sql_variant, if possible, would go into such type.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T14:21:45.980

If you want to put the data into a variable of type object then (simplified):

```
object result = null;
result = reader["columnNameGoesHere"]; 
```

Should do the trick.

There's also a good explanation of the various different methods of retrieving the contents of a given columns current record in [this DevHood tutorial](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=454). The summary table of data type mappings at the end may come in handy too!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-11-24T21:44:20.170

Sql_Variant 是对象类型。

[微软文档](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql-server-data-type-mappings)

# performance - Discover what process/query is using the oracle SGA

> ID：183021
> 
> 赞同：1
> 
> 时间：2008-10-08T14:20:15.797
> 
> 标签：performance, oracle, debugging, statistics, oracleinternals

I have a query to monitor SGA (non-)utilisation:

```
select sum(bytes)/1024/1024 " SGA Free " from v$sgastat where name='free memory'; 
```

That's great, but I need more detail about what exactly is using the space. Essentially, I'm looking for clues to tell me more precisely what might be wrong with this (rather large application).

`select * from v$sgastat` does not give me anything that I recognise as a developer - at least not without some pointers.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T16:22:00.107

Here's a query that I use to see pool size in the SGA

```
SELECT POOL, NAME, Round(BYTES/1024/1024,2) Mb
FROM V$SGASTAT WHERE POOL LIKE '%pool%'
order by 1,3 
```

Looks great in SQL Developer as a BAR_HORIZ_STACK chart.

All the information you need ought to be in the V$SGASTAT view. Remember that it's shared space, so it's difficult to tie usage to particular processes.

# css - 阴影文本：CSS 还是图形？

> ID：183024
> 
> 赞同：3
> 
> 时间：2008-10-08T14:21:07.760
> 
> 标签：css, localization

我有一个内部网络应用程序，页面顶部有一张图片，目前包含一些带有阴影的英文文本。我现在需要为此页面提供各种语言的本地化版本。我的主要选择是：

*   每种支持的语言都有不同的图形，包含本地化的文本。
*   使用 CSS 将本地化文本放置在普通图像上，并使用[复杂的 CSS 技术](http://www.workingwith.me.uk/articles/css/cross-browser-drop-shadows)在大多数当前浏览器中获得阴影。

还有其他选择吗？这是针对教育环境的，我无法控制学生使用的浏览器。

我确实尝试了从图形中删除阴影，并将文本移动到 HTML 的标题中，但都没有吸引力。人们说它看起来像是对当前页面的廉价仿冒，这伤害了我的自尊心。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-08T14:26:45.503

就我个人而言，我是这种视觉效果的 CSS 技术的忠实粉丝。最大的好处是您将效果处理卸载到客户端，节省带宽和内容创建时间（每个区域设置的自定义文本图像是一个大订单！），并使用户更快地下载页面。

避免它的唯一原因是，如果您绝对必须在几乎不支持 CSS 的非常旧的 (IE5) 浏览器上使用投影。

编辑：只是想到了一些事情 - 我有一些像这样的情况，我需要特定的字体或一些确切的文本效果，我使用 PHP 将带有效果的文本渲染到图像并将其缓存在服务器端。这样您就可以避免内容创建过程并获得更广泛的浏览器支持，以换取带宽和服务器 CPU 时间。如果权衡是可以接受的，那是你的决定。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T14:27:38.200

在请求服务器端为每种语言生成图像，并带有阴影。根据需要缓存它们。

如果可以使用Image Magick，可以[参考本教程](http://www.imagemagick.org/Usage/fonts/)生成文字+阴影...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T14:28:50.007

维护带有文本的图像可能会很痛苦——即使没有本地化，我也会避免它。

在选择您的选择之前，我会尝试两种选择：

*   寻找一个免费的程序来生成阴影图像，只要它检测到标题有新文本，您就可以让程序使用它
*   使用可以重复的阴影图像作为文本下方的背景图像

如果这些不起作用，我会尝试使用 CSS，但在使用它之前，您可以自己在尽可能多的浏览器中对其进行测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T14:31:50.187

好吧，Safari 支持用于阴影的专有 CSS 属性，但它在其他浏览器中不起作用。CSS3 也会有阴影（实际上只有一个用于盒子，但也许它也可以用于文本，例如当盒子有透明背景时）。

但是看到大多数浏览器到目前为止甚至没有 100% 的 CSS2 支持，我想你需要选择你的两个选项之一。当然，有一个不那么复杂的 CSS 技巧来获得阴影：

[为每个人投下阴影](http://www.designmeme.com/articles/dropshadows/)

但它们看起来不如真正的阴影好，因为它们没有模糊。此外，您需要在 HTML 中包含两次文本才能使它们起作用。

# c# - Send a list of IDs to a SQL Server stored procedure from c#

> ID：183032
> 
> 赞同：1
> 
> 时间：2008-10-08T14:22:53.917
> 
> 标签：c#, sql, stored-procedures

Is it possible to send a list of IDs to a stored procedure from c#?

```
UPDATE Germs
SET Mutated = ~Mutated
WHERE (GermID IN (ids)) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T14:32:17.037

这可能是一个肮脏的黑客，但您可以创建一个临时表，然后从您的存储过程中加入它（假设它们在同一连接期间被访问）。例如：

```
CREATE TABLE #ids (id int)
INSERT INTO #ids VALUES ('123') -- your C# code would generate all of the inserts

-- From within your stored procedure...
UPDATE g
SET Mutated = ~Mutated
FROM Germs g
JOIN #ids i ON g.GermID = i.id 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T14:39:14.133

你可以试试我所做的： -

创建一个名为 Split_String 的函数

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

CREATE FUNCTION [dbo].[Split_String] 
(   
    @MyString varchar(5000)
)
RETURNS @Results TABLE
(
    Value varchar(1000)
) 
AS
    BEGIN
        DECLARE @Pos int
        DECLARE @StrLen int
        DECLARE @MyLen int
        DECLARE @MyVal varchar
        SET @pos = 1
        SET @MyLen = 1
        WHILE @MyString <> ''
            BEGIN
                SET @MyLen = charindex(',',@MyString)   
                IF @MyLen = 0 SET @MyLen = Len(@MyString)
                INSERT @Results SELECT replace(substring(@MyString, @pos, @MyLen),',','')
                SET @MyString = SUBSTRING(@MyString,@MyLen+1,len(@MyString))
            END
        RETURN 
    END 
```

然后，当您使用 IN() 时，请按以下方式使用逗号分隔的字符串：-

```
SELECT * FROM [youDataBase].[dbo].[Split_String] (<@MyString, varchar(5000),>) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T14:26:46.000

According to [This](http://visualstudiomagazine.com/features/article.aspx?editorialsid=2438) article, you could try the Table Value Parameter.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T14:30:24.370

Yep, you can use a chunk of XML to build your list of ID's. Then you can use OPENXML and select from that record set.

Look up OPENXML, sp_preparexmldocument, sp_removexmldocument

# c# - Speeding Up C#

> ID：183033
> 
> 赞同：20
> 
> 时间：2008-10-08T14:22:59.473
> 
> 标签：c#, optimization, performance

This is really two questions, but they are so similar, and to keep it simple, I figured I'd just roll them together:

*   **Firstly**: Given an established C# project, what are some decent ways to speed it up beyond just plain in-code optimization?

*   **Secondly**: When writing a program from scratch in C#, what are some good ways to greatly improve performance?

**Please stay away from general optimization techniques unless they are *C# specific*.**

This has previously been asked for [Python](https://stackoverflow.com/questions/172720/speeding-up-python), [Perl](https://stackoverflow.com/questions/177122/speeding-up-perl), and [Java](https://stackoverflow.com/questions/179745/speeding-up-java).

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-08T14:27:12.053

Off the top of my head:

*   Replace non-generic variants of container classes by their generic counterparts
*   Cut down on boxing/unboxing. Specifically, use generics where possible and generally avoid passing value types as `object`.
*   For dialogs using many dynamic controls: suspend drawing until after inserting all controls by using `SuspendLayout`/`ResumeLayout`. This helps especially when using layout containers.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-08T14:39:18.067

不幸的是，相对较少的优化是特定于语言的。基础知识适用于各种语言：

*   根据实际负载测量性能
*   有明确的目标来指导你
*   使用好的分析器
*   相对较早地优化架构/设计
*   只有当您遇到已证实的问题时才进行微优化

当您绝对证明您需要进行微优化时，分析器往往会明确要查找的内容 - 例如避免装箱和虚拟呼叫。

哦，我能想到的一件事是 .NET 特有的：如果您需要频繁调用并且当前正在使用反射，[请将这些调用转换为 delegates](http://msmvps.com/blogs/jon_skeet/archive/2008/08/09/making-reflection-fly-and-exploring-delegates.aspx)。

编辑：建议使用泛型和 StringBuilder 等的其他答案当然是正确的。我（可能错误地）认为这些优化过于“明显”；）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-08T14:28:14.530

One simple thing is to ensure that your build configuration is set to "Release". This will enable optimizations and eliminate debugging information, making your executable smaller.

More info [on MSDN](http://msdn.microsoft.com/en-us/library/ms173083.aspx) if needed.

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-08T15:10:57.770

使用一个不错的质量分析器并确定您的瓶颈在哪里。

*然后*开始询问如何提高性能。

任何人在不了解您的绩效概况和问题领域的情况下做出任何笼统的陈述，例如“避免反思”，都应该被枪决（或至少接受再教育）。鉴于 .Net 环境的规模，谈论 C# 优化几乎毫无意义：我们在谈论 WinForms、ASP.Net、BizTalk、Workflow、SQL-CLR 吗？如果没有上下文，即使是一般性的指导原则也可能充其量是在浪费时间。

还要考虑一下“加快速度”和“提高性能”的含义。您的意思是更高的资源效率，还是更短的终端用户感知等待时间（假设有）？这些是要解决的非常不同的问题。

鉴于论坛，我觉得有必要指出 Code Complete 中对这些主题的一些很好的报道。不是 C# 特定的头脑。但这是一件好事。请记住，特定于语言的微优化很可能会包含在您正在使用的任何编译器的下一个版本中，如果 for 和 foreach 之间的区别对您来说很重要，那么您可能无论如何都在编写 C++，对吗？

[我喜欢 RedGate 的 ANTS Profiler，但我认为它可以改进]

有了这个，一些想法：

*   尽可能使用 type(SomeType) 而不是 instance.GetType()
*   使用 foreach 优先于 for
*   避免拳击
*   最多（我认为）3个字符串可以做StringA + StringB + StringC。之后，您应该使用 StringBuilder

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T14:39:35.053

*   使用 StringBuilder 而不是大量的字符串连接。字符串对象是原子的，*任何*修改（追加、向上、填充等）实际上都会生成一个全新的字符串对象，而不是修改原始对象。每个新字符串都必须被分配并最终被垃圾回收。

*   对前面陈述的概括：尝试重用对象而不是创建大量对象。分配和垃圾收集可能很容易做到，但它们会影响您的性能。

*   确保在大多数情况下使用提供的 Microsoft 库。框架提供的类通常使用您自己的 C# 代码不可用或难以访问的功能（即调用本机 Windows API）。内置库并不*总是*最有效的，但往往不是。

*   编写异步应用程序从未如此简单。查看诸如 BackgroundWorker 类之类的东西。

*   尽量不要定义结构，除非你*真的*需要它们。类实例变量每个都保存对实际实例的引用，而结构实例变量每个都保存一个单独的副本。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-08T14:58:20.710

使用组合而不是继承，限制装箱/拆箱，使用通用集合，使用 foreach 循环而不是带有计数器的 for{}，并使用标准 Dispose 模式释放资源。

优秀的书《Effective C#》中详细介绍了这些内容。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-08T15:09:38.240

分析您的代码。然后，您至少可以了解可以改进的地方。如果没有分析，您就是在黑暗中拍摄...

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-08T14:26:23.710

A lot of slowness is related to database access. Make your database queries efficient and you'll do a lot for your app.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-17T16:48:47.867

我为以下 MSDN 文章添加了书签，并发现它是一个很好的通用参考。

[提高 .NET 应用程序性能](http://msdn.microsoft.com/en-us/library/ms998530.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-06T21:54:14.790

缓存查询产生的项目：

```
private Item _myResult;
public Item Result
{
     get
     {
          if (_myResult == null)
          {
               _myResult = Database.DoQueryForResult();
          }
          return _myResult;
     }
} 
```

它是初学者经常忽略的基本技术，也是提高应用程序性能的最简单方法之一。

答案来自一个被认为是这个问题的欺骗的问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T14:25:59.700

NGEN will help with some code, but do not bank on it.

Personally, if your design is bad/slow, there is not much you can do.

The best suggestion in such a case, is to implement some form of caching of expensive tasks.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-08T14:32:52.603

我向你推荐这些书：

[有效的 C#](https://rads.stackoverflow.com/amzn/click/com/0321245660)。

[更有效的 C#](https://rads.stackoverflow.com/amzn/click/com/0321485890)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-08T14:34:07.530

不要使用过多的反射。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T14:42:50.353

使用 Ngen.exe（应随 Visual Studio 提供。）

[http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx)

> 本机映像生成器 (Ngen.exe) 是一种提高托管应用程序性能的工具。Ngen.exe 创建本机映像，这些文件包含已编译的特定于处理器的机器代码，并将它们安装到本地计算机上的本机映像缓存中。运行时可以使用缓存中的本机映像，而不是使用即时 (JIT) 编译器来编译原始程序集。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-08T14:48:10.170

除了上面列出的编码最佳实践之外，还包括在适当的时候使用 StringBuilders 和这种性质的项目。

我强烈建议使用代码分析工具，例如 RedGate 的 ANTs Profiler。我发现，在使用 Profiler 采取标准优化步骤后，我可以通过快速识别受应用程序影响最严重的代码区域来进一步优化我的代码。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-05T00:11:35.770

这适用于任何语言，而不仅仅是 C#

1.  对于现有的应用程序，在你知道是什么让它变慢之前不要做*任何事情。*恕我直言，[这是最好的方法。](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)

2.  对于新应用程序，问题在于如何教授程序员。他们被教导如何用鼹鼠丘造山。在您使用它优化了一些应用程序之后，[您](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)将熟悉我所说的“泛泛性”问题 - 一层又一层的“抽象”，而不是简单地询问问题需要什么。你能期望的最好的结果就是跟着他们跑，告诉他们他们刚刚提出的性能问题是什么，这样他们就可以在他们前进的时候把它们拿出来。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-11-17T16:43:07.987

对于 XP 和 Vista 上的 Windows 窗体：全面打开双缓冲。它确实会导致透明度问题，因此您肯定会想要测试 UI：

```
protected override System.Windows.Forms.CreateParams CreateParams { 
    get { 
        CreateParams cp = base.CreateParams; 
        cp.ExStyle = cp.ExStyle | 0x2000000; 
        return cp; 
    } 
} 
```

# wpf - WPF ComboBox 在任务窗格中使用时不会保持打开状态

> ID：183035
> 
> 赞同：2
> 
> 时间：2008-10-08T14:23:31.063
> 
> 标签：wpf, excel, interop

我对 WPF 互操作和 Excel 插件有一个奇怪的错误。我正在使用.Net 3.5 SP1。

我正在使用 Add-in Express 为 Excel 2003 创建自定义任务窗格。在该任务窗格中，我使用 ElementHost 来托管 WPF UserControl。UserControl 只包含一个带有 TextBox 和 ComboBox 的 Grid。我的问题是，虽然一切都正确显示，但 ComboBox 不会保持下拉状态，除非我将鼠标放在向下箭头上。

我认为这不一定与 Add-in Express 有关，因为当我尝试在 Excel 中无模式显示 WPF 窗口时遇到了类似的问题。

第二个问题是 ComboBox 似乎不愿意放弃焦点。如果我单击它，文本区域会变为灰色以指示它具有焦点，但我无法将焦点移动到窗口中的其他任何位置。夺取焦点的唯一方法是移动鼠标滚轮。

其他人有类似的问题，并设法解决它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-30T14:44:43.980

Add-in Express 为我调查了这个问题，结果发现它与添加到 Excel 的任务窗格的窗口样式有关。如果您关闭 Windows CreateParams 中的 WS_CHILD 标志，则组合框和其他弹出窗口将按预期工作。

他们给了我这段代码以添加到我的 ADXExcelTask​​Pane 中：

```
private const uint WS_CHILD = 0x40000000;
private const uint WS_CLIPCHILDREN = 0x02000000;
private const uint WS_CLIPSIBLINGS = 0x04000000;

private CreateParams _CreateParams = new CreateParams();
protected override CreateParams CreateParams
{
    get
    {
        _CreateParams = base.CreateParams;
        if (!DesignMode)
            _CreateParams.Style = (int)(WS_CLIPCHILDREN | WS_CLIPSIBLINGS); //| WS_CHILD

        return _CreateParams;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-04T09:31:23.397

我有同样的问题。我有一个 WPF 用户控件托管在 WinForm 用户控件中，整个是一个 Excel 插件。我使用 Visual Studio 2010 和 Excel 2007 和 Excel 2010。

我的问题是，当我在 Excel 工作表中单击一次时，AddIn 再也没有获得焦点。我找到了解决方法。

1.  在我的 WinForm 用户控件的构造函数中，我在 WPF 用户控件的事件 MouseEnter 上注册。
2.  在 MouseEnter 事件处理程序中，我将焦点放在自己身上 (this.Focus())

    ```
    public WpfContainerUserControl()
    {
        InitializeComponent();
        GpecsBrowserTabUserControl gpecBrowser = elementHost1.Child as GpecsBrowserTabUserControl;
        gpecBrowser.MouseEnter += new System.Windows.Input.MouseEventHandler(gpecBrowser_MouseEnter);
    }

    void gpecBrowser_MouseEnter(object sender, System.Windows.Input.MouseEventArgs e)
    {
        this.Focus();
    } 
    ```

# ruby - 使用 Prawn Ruby 库时的当前光标位置

> ID：183039
> 
> 赞同：9
> 
> 时间：2008-10-08T14:25:45.597
> 
> 标签：ruby, prawn

我正在使用 Prawn Ruby 库 ( [http://prawn.majesticseaacreature.com/](http://prawn.majesticseacreature.com/) ) 来生成一些 pdf 文档。我画了一张桌子没有任何问题。接下来，我想在表格之后插入一些行，用于各种人的签名。在画线之前，我想看看页面上是否有足够的剩余空间来容纳所有签名。如果没有，我将开始一个新页面并将签名行放在那里。但是，为了确定页面上是否有足够的空间，我需要知道绘制表格后当前光标位置是什么。我无法为我的生活弄清楚如何做到这一点。有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-08T14:31:16.053

当然，输入问题后，我立即弄清楚了。Document 类中的 'y' 和 'y=' 方法允许您获取和设置当前的 y 位置，这就是所有必要的。

# asp.net-mvc - 使用 ASP.Net MVC 绘制图形/水晶报表

> ID：183041
> 
> 赞同：1
> 
> 时间：2008-10-08T14:26:05.037
> 
> 标签：asp.net-mvc, model-view-controller, crystal-reports, graph

我想在 ASP.NET MVC 中将图形添加到我的用户控件中。我希望对如何解决这个问题有一些想法或指南。我四处搜索并没有找到解决此问题的有用答案。我正在考虑做水晶报告，但根据我以前的经验，它们在 ASP.NET 中表现不佳。我只想知道一些解决这个问题的方法。所以我再次尝试做的是从传递给我的用户控件的 ViewDataDictionary 向 MVC 用户控件添加图形。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:30:16.540

如果你愿意付费，你可以免费使用[谷歌图表](http://code.google.com/apis/chart/)，或者像[Dundas （非常棒）这样的东西。](http://www.dundas.com)

我希望我已经理解了你的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T15:11:50.480

我很高兴使用[JFreeChart.net](http://sourceforge.net/project/showfiles.php?group_id=151482&package_id=207833)图形系统。它是javas著名的JFreechart的一个端口/半端口。它有很多功能，输出看起来非常好。

我花了 30 分钟来制作我的第一个图表，但这主要是因为您必须为文档（而不是代码）付费，所以我正在处理样本，后来我发现这些样本已经足够了。

[屏幕截图和示例显示在这里](http://www.ujihara.jp/jbyjsharp/jfreechart/results/)

[替代文字 http://www.ujihara.jp/jbyjsharp/jfreechart/results/PieChartDemo1.png](http://www.ujihara.jp/jbyjsharp/jfreechart/results/PieChartDemo1.png)

[替代文字 http://www.ujihara.jp/jbyjsharp/jfreechart/results/RingChartDemo1.png](http://www.ujihara.jp/jbyjsharp/jfreechart/results/RingChartDemo1.png)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T14:34:06.517

Flex Charting、ChartDirector 和 Yahoo 的 Charts 都不错。Chart Director 有一个很好的支持网络，他对问题和功能要求非常敏感。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:07:30.303

您还可以查看[.dot 网络图表](http://www.dotnetcharting.com/)。我们已经在我的工作中使用它几年了，它对我们来说效果很好。我们通过各种系统在内部构建报告，到目前为止它为我们提供了很好的服务。

# python - How can I use UUIDs in SQLAlchemy?

> ID：183042
> 
> 赞同：123
> 
> 时间：2008-10-08T14:26:20.853
> 
> 标签：python, postgresql, sqlalchemy

Is there a way to define a column (primary key) as a [UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier) in [SQLAlchemy](http://www.sqlalchemy.org/) if using [PostgreSQL](http://www.postgresql.org/) (Postgres)?

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2018-03-21T04:10:23.180

sqlalchemy postgres 方言支持 UUID 列。这很容易（问题特别是postgres）——我不明白为什么其他答案都这么复杂。

这是一个例子：

```
from sqlalchemy.dialects.postgresql import UUID
from flask_sqlalchemy import SQLAlchemy
import uuid

db = SQLAlchemy()

class Foo(db.Model):
    id = db.Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4) 
```

注意不要错过将 传递`callable` `uuid.uuid4`到列定义中，而不是使用 . 调用函数本身`uuid.uuid4()`。否则，对于此类的所有实例，您将拥有相同的标量值。更多细节[在这里](https://docs.sqlalchemy.org/en/13/core/metadata.html#sqlalchemy.schema.Column.params.default)：

> 表示此列的默认值的标量、Python 可调用或 ColumnElement 表达式，如果在插入的 VALUES 子句中未指定此列，则将在插入时调用该表达式。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-05-01T17:29:48.340

[我写了这个](http://blog.sadphaeton.com/2009/01/19/sqlalchemy-recipeuuid-column.html)，域名消失了，但这是胆量....

不管我真正关心正确数据库设计的同事如何看待用于关键字段的 UUID 和 GUID。我经常发现我需要这样做。我认为它比自动增量有一些优势，值得。

在过去的几个月里，我一直在改进 UUID 列类型，我想我终于把它搞定了。

```
from sqlalchemy import types
from sqlalchemy.dialects.mysql.base import MSBinary
from sqlalchemy.schema import Column
import uuid

class UUID(types.TypeDecorator):
    impl = MSBinary
    def __init__(self):
        self.impl.length = 16
        types.TypeDecorator.__init__(self,length=self.impl.length)

    def process_bind_param(self,value,dialect=None):
        if value and isinstance(value,uuid.UUID):
            return value.bytes
        elif value and not isinstance(value,uuid.UUID):
            raise ValueError,'value %s is not a valid uuid.UUID' % value
        else:
            return None

    def process_result_value(self,value,dialect=None):
        if value:
            return uuid.UUID(bytes=value)
        else:
            return None

    def is_mutable(self):
        return False

id_column_name = "id"

def id_column():
    import uuid
    return Column(id_column_name,UUID(),primary_key=True,default=uuid.uuid4)

# Usage
my_table = Table('test',
         metadata,
         id_column(),
         Column('parent_id',
            UUID(),
            ForeignKey(table_parent.c.id))) 
```

我相信存储为二进制（16 字节）最终应该比字符串表示（36 字节？）更有效，而且似乎有迹象表明在 mysql 中索引 16 字节块应该比字符串更有效。反正我也不指望它会更糟。

我发现的一个缺点是，至少在 phpymyadmin 中，您不能编辑记录，因为它隐式地尝试为“从 id = ... 的表中选择 *”进行某种字符转换，并且存在各种显示问题。

除此之外，一切似乎都很好，所以我把它扔在那里。如果您看到明显的错误，请发表评论。我欢迎任何改进它的建议。

除非我遗漏了什么，否则如果底层数据库具有 UUID 类型，上述解决方案将起作用。如果没有，您可能会在创建表时遇到错误。我想出的解决方案最初是针对 MSSqlServer，然后最终使用了 MySql，所以我认为我的解决方案更灵活一些，因为它似乎在 mysql 和 sqlite 上运行良好。还没有打扰检查postgres。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2017-01-03T00:31:07.150

如果您对具有 UUID 值的“字符串”列感到满意，这里有一个简单的解决方案：

```
def generate_uuid():
    return str(uuid.uuid4())

class MyTable(Base):
    __tablename__ = 'my_table'

    uuid = Column(String, name="uuid", primary_key=True, default=generate_uuid) 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2015-09-01T13:20:16.400

我已经使用`UUIDType`了[`SQLAlchemy-Utils`包装](http://sqlalchemy-utils.readthedocs.org/en/latest/data_types.html#module-sqlalchemy_utils.types.uuid)中的。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2019-09-13T07:23:14.807

由于您使用的是 Postgres，这应该可以工作：

```
from app.main import db
from sqlalchemy.dialects.postgresql import UUID

class Foo(db.Model):
    id = db.Column(UUID(as_uuid=True), primary_key=True)
    name = db.Column(db.String, nullable=False) 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-06-02T18:39:59.610

这是一种基于 SQLAlchemy 文档中的[后端不可知 GUID](http://docs.sqlalchemy.org/en/rel_0_9/core/custom_types.html?highlight=guid#backend-agnostic-guid-type)的方法，但使用 BINARY 字段将 UUID 存储在非 postgresql 数据库中。

```
import uuid

from sqlalchemy.types import TypeDecorator, BINARY
from sqlalchemy.dialects.postgresql import UUID as psqlUUID

class UUID(TypeDecorator):
    """Platform-independent GUID type.

    Uses Postgresql's UUID type, otherwise uses
    BINARY(16), to store UUID.

    """
    impl = BINARY

    def load_dialect_impl(self, dialect):
        if dialect.name == 'postgresql':
            return dialect.type_descriptor(psqlUUID())
        else:
            return dialect.type_descriptor(BINARY(16))

    def process_bind_param(self, value, dialect):
        if value is None:
            return value
        else:
            if not isinstance(value, uuid.UUID):
                if isinstance(value, bytes):
                    value = uuid.UUID(bytes=value)
                elif isinstance(value, int):
                    value = uuid.UUID(int=value)
                elif isinstance(value, str):
                    value = uuid.UUID(value)
        if dialect.name == 'postgresql':
            return str(value)
        else:
            return value.bytes

    def process_result_value(self, value, dialect):
        if value is None:
            return value
        if dialect.name == 'postgresql':
            return uuid.UUID(value)
        else:
            return uuid.UUID(bytes=value) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-11-12T16:57:36.457

如果有人感兴趣，我一直在使用 Tom Willis 答案，但发现在 process_bind_param 方法中将字符串添加到 uuid.UUID 转换很有用

```
class UUID(types.TypeDecorator):
    impl = types.LargeBinary

    def __init__(self):
        self.impl.length = 16
        types.TypeDecorator.__init__(self, length=self.impl.length)

    def process_bind_param(self, value, dialect=None):
        if value and isinstance(value, uuid.UUID):
            return value.bytes
        elif value and isinstance(value, basestring):
            return uuid.UUID(value).bytes
        elif value:
            raise ValueError('value %s is not a valid uuid.UUId' % value)
        else:
            return None

    def process_result_value(self, value, dialect=None):
        if value:
            return uuid.UUID(bytes=value)
        else:
            return None

    def is_mutable(self):
        return False 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-08-31T14:06:31.510

我们可以使用`UUIDType`，

```
from sqlalchemy_utils import UUIDType
from sqlalchemy import VARCHAR,
class User(Base):
    __tablename__ = "user"
    id = Column(UUIDType(binary=False), primary_key=True, default=uuid.uuid4())
    name = Column(VARCHAR(length=30))
    first_name = Column(VARCHAR(length=30))
    last_name = Column(VARCHAR(length=30)) 
```

更多细节我们可以参考[官方文档](https://sqlalchemy-utils.readthedocs.io/en/latest/data_types.html#module-sqlalchemy_utils.types.uuid)。

* * *

## 回答 #9

> 赞同：-21
> 
> 时间：2008-10-09T18:01:58.063

您可以尝试编写[自定义类型](http://www.sqlalchemy.org/docs/05/types.html#types_custom)，例如：

```
import sqlalchemy.types as types

class UUID(types.TypeEngine):
    def get_col_spec(self):
        return "uuid"

    def bind_processor(self, dialect):
        def process(value):
            return value
        return process

    def result_processor(self, dialect):
        def process(value):
            return value
        return process

table = Table('foo', meta,
    Column('id', UUID(), primary_key=True),
) 
```

# css - CSS“模式”操作方法

> ID：183062
> 
> 赞同：8
> 
> 时间：2008-10-08T14:30:27.273
> 
> 标签：css, styling

如何建立通用元素样式、嵌套元素样式和分类元素样式的 CSS“模式”或层次结构。对于像我这样的新手来说，我查看的样式表中的信息量完全是压倒性的。与内联样式属性相比，创建一个或多个因子良好的样式表时遵循什么过程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-19T01:08:34.817

我非常喜欢通过内容或内容类型来命名我的 CSS 类，例如，包含导航“选项卡”的 <ul> 将具有 class="tabs"。包含日期的标题可以是 class="date"，或者包含前 10 个列表的有序列表可以有 class="chart"。类似地，对于 ID，可以给页面页脚 id="footer" 或网站标识 id="mainLogo"。我发现它不仅使类易于记忆，而且还鼓励适当的 CSS 级联。像 ol.chart {font-weight: bold; color: blue;} #footer ol.chart {color: green;} 可读性很强，并考虑了 CSS 选择器如何通过更具体来增加权重。

适当的缩进也是一个很大的帮助。您的 CSS 可能会增长很多，除非您想在每次向站点添加新部分或想要发布新类型的内容时重构 HTML 模板。无论您多么努力，都不可避免地需要添加一些您在原始模式中没有预料到的新规则（或例外）。Indeting 将允许您更快地扫描大型 CSS 文件。我个人的偏好是缩进选择器的具体和/或嵌套程度，如下所示：

```
 ul.tabs {
    list-style-type: none;
    }
        ul.tabs li {
        float: left;
        }
            ul.tabs li img {
            border: none;
            } 
```

这样，“父”总是在最左边，因此文本被父容器分解成块。我也喜欢将样式表分成几个部分；首先是 HTML 元素的所有选择器。我认为这些非常通用，以至于它们应该首先出现。在这里我放了“body { font-size: 77%; }”和“a { color: #FFCC00; }”等。之后我会为页面的主要框架部分放置选择器，例如“ul#mainMenu {浮动：左；}”和“div#footer {高度：4em；}”。然后是常见的对象类，“td.price { text-align: right; }”，最后是额外的小部分，如“.clear { clear: both; }”。现在这就是我喜欢这样做的方式 - 我确信有更好的方法，但它对我有用。

最后，有几个tips：

1.  充分利用级联，不要“过度分类”东西。如果你给一个 <ul> class="textNav" 那么你可以访问它的 <li>s 和他们的孩子，而无需添加任何额外的课堂作业。ul.textNav li a:hover {}
2.  不要害怕在单个对象上使用多个类。这是完全有效且非常有用的。然后，您可以控制来自多个轴的对象组的 CSS。还给对象一个 ID 添加了第三个轴。例如：

    ```
    <style>
    div.box {
    float: left;
    border: 1px solid blue;
    padding: 1em;
    }

    div.wide {
    width: 15em; 
    }

    div.narrow {
    width: 8em; 
    }

    div#oddOneOut {
    float: right;
    }
    </style>

    <div class="box wide">a wide box</div>
    <div class="box narrow">a narrow box</div>
    <div class="box wide" id="oddOneOut">an odd box</div> 
    ```

3.  为您的文档 <body> 标记（或 ID，因为应该只有一个...）赋予一个类可以为单个页面启用一些漂亮的覆盖，例如突出显示您当前所在页面的菜单项或摆脱它登录页面上多余的第二个登录表单，全部仅使用 CSS。“body.signIn div#mainMenu form.signIn {显示：无；}”

我希望您至少发现我的一些漫谈有用，并祝您的项目一切顺利！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T14:46:07.490

你可以做很多不同的事情来帮助你组织你的 CSS。例如：

*   将您的 CSS 拆分为多个文件。例如：有一个文件用于布局，一个用于文本，一个用于重置样式等。
*   注释您的 CSS 代码。
*   为什么不添加目录？
*   尝试使用像[960.gs](http://960.gs)这样的 CSS 框架来开始。

这完全取决于个人口味。但这里有一些您可能会觉得有用的链接：

*   [http://www.smashingmagazine.com/2008/08/18/7-principles-of-clean-and-optimized-css-code/](http://www.smashingmagazine.com/2008/08/18/7-principles-of-clean-and-optimized-css-code/)
*   [http://www.smashingmagazine.com/2008/05/02/improving-code-readability-with-css-styleguides/](http://www.smashingmagazine.com/2008/05/02/improving-code-readability-with-css-styleguides/)
*   [http://www.louddog.com/bloggity/2008/03/css-best-practices.php](http://www.louddog.com/bloggity/2008/03/css-best-practices.php)
*   [http://natbat.net/2008/Sep/28/css-systems/](http://natbat.net/2008/Sep/28/css-systems/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T14:55:00.780

将 CSS 视为创建 HTML 可以引用的“工具包”。以下规则将有所帮助：

*   使`class`名称明确。在大多数情况下，这意味着以可预测的方式为它们添加前缀。例如，而不是`left`，使用类似的东西`header_links_object2_left`。

*   使用`id`而不是`class` **仅**当您知道页面上**永远**只有一个对象时。再次，`id`明确。

*   考虑副作用。`margin`和`padding`、`float`和等规则`clear`都可能对其他元素产生意想不到的后果。

*   如果您的样式表要用于我的几个 HTML 编码器，请考虑为它们编写一个小而清晰的指南，指导如何编写 HTML 以匹配您的方案。保持简单，否则你会厌烦它们。

和往常一样，在多个浏览器、多个操作系统、许多不同的页面以及您能想到的任何其他异常情况下对其进行测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T14:44:06.810

将所有 CSS 声明的顺序与它们在文档层次结构中的顺序大致相同通常是一件好事。这使得未来的读者很容易看到哪些属性将被继承，因为这些类在文件中的位置更高。

此外，这与您的问题有点正交，但是如果您正在寻找一种工具来帮助您阅读 CSS 文件并查看所有内容如何变化，那么我推荐的[Firebug 再多](https://addons.mozilla.org/en-US/firefox/addon/1843)不过了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-19T01:41:12.410

我收到的最好的组织建议来自 An Event Apart 的一次演讲。

假设您将所有内容保存在一个样式表中，它基本上有五个部分：

1.  重置规则（可能和规则一样简单 `* {margin: 0; padding: 0}`，Eric Meyer 的重置或 YUI 重置）
2.  基本元素样式；这就是段落的基本排版、列表的间距等内容。
3.  通用类；这部分对我来说通常包含诸如`.error`，`.left`（我只有 80% 语义）等内容。
4.  通用布局/ID；`#content`, `#header`, 或任何您将页面剪切成的内容。
5.  页面特定规则；如果您只需要为一页或几页修改现有样式，请将唯一 ID 高高放置（正文标记通常很好）并在文档末尾扔掉您的覆盖

我不推荐使用 CSS 框架，除非你需要在 HTML 中*快速*模拟一些东西。它们太臃肿了，而且我从来没有遇到过语义对我有意义的人。当您弄清楚您的项目随着时间的推移共享哪些代码时，创建自己的“框架”是更好的做法。

阅读其他人的代码是另一回事，我祝你好运。那里有一些真正可怕的 CSS。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T14:43:02.240

年度警戒线：视情况而定。

你需要做多少造型？你需要改变几乎每一个元素的方面，还是只有几个？

我最喜欢获取此类信息的地方是[CSS Zen Garden](http://www.csszengarden.com/) & [A List Apart](http://alistapart.com/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T14:47:13.853

有两个世界：

1.  `The human editor perspective:`CSS 最容易理解的地方是，当它具有清晰的结构、良好的格式、冗长的名称、结构化的布局、颜色和排版......
2.  `The consumer perspective:`如果您的网站加载速度很快，如果它在他的浏览器中看起来很完美，那么访问者最高兴，因此 css 必须很小，在一个文件中（以节省更多连接）并包含 CSS hack 以支持所有浏览器。

我建议您从[CSS 框架](http://en.wikipedia.org/wiki/CSS_framework)开始：

*   [蓝图](http://www.blueprintcss.org/)，如果你喜欢更小的东西
*   或[YAML](http://www.yaml.de/en/)用于大而实用的

还有一个[CSS 框架列表](http://en.wikipedia.org/wiki/List_of_CSS_frameworks)...

[然后使用CSS 优化器](http://www.google.ch/search?q=css+optimizer)(pe [CSS Form.&Opti.](http://floele.flyspray.org/csstidy//css_optimiser.php) )将其成形（用于浏览器）

[您可以使用YSlow](http://developer.yahoo.com/yslow/)测量结果（未优化 <-> 优化）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T15:36:09.527

还有一些保持井井有条的技巧：

*   在每个声明中，采用您坚持的属性顺序。例如，我通常按顺序列出边距、填充、高度、宽度、边框、字体、显示/浮动/其他，以便在我的下一个技巧中更易于阅读
*   像编写任何其他代码一样编写 CSS：缩进！很容易扫描 CSS 文件中的高级元素，然后向下钻取，而不是简单地按 HTML 的源顺序。
*   具有良好类名的语义 HTML 有助于记住哪些样式适用于哪些元素。

# eclipse - 如何在 Eclipse 中自定义“剪切”的行为？

> ID：183071
> 
> 赞同：2
> 
> 时间：2008-10-08T14:31:41.980
> 
> 标签：eclipse

我的普通 IDE 是 Visual Studio，但我目前是第一次在 Eclipse 中进行一些开发。如果在任一程序中选择文本的情况下按 Ctrl-X，它会剪切文本并完全按照您的预期放置在剪贴板上。如果在 Visual Studio 中未选择文本的情况下按 Ctrl-X，则会剪切当前行。在 Eclipse 中它被忽略。有没有办法让 Eclipse 使用 Studio 的行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T15:27:17.907

我还没有找到使 Ctrl+X 上下文敏感的方法，但我确实发现您可以通过转到 Window -> Preferences -> General -> Keys 对话框将一个键绑定到“Cut Line”命令。不幸的是，这总是会切断整条线，即使您只选择了其中的一部分。也许将另一个键绑定到这个命令对你有用？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-05T21:01:50.820

[http://code.google.com/p/copycutcurrentline/](http://code.google.com/p/copycutcurrentline/)

# windows - 是否有加速 Eclipse（或通用 Windows GUI 宏工具）中重复提交的热键？

> ID：183075
> 
> 赞同：1
> 
> 时间：2008-10-08T14:33:27.687
> 
> 标签：windows, eclipse, macros, eclipse-pdt

我在 Eclipse PDT 中对 .php 文件进行了大量微小的更改，然后提交它们并在服务器上进行测试。

重复的六步提交过程变得乏味：

```
right-click
team
Commit...
click "choose previously selected comment"
select in list
click OK 
```

有谁知道加快此过程的热键或其他过程？

**更新：**有谁知道 Windows 应用程序的通用热键宏工具，它可以让我编写一个宏来为我完成这 6 次点击？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T15:56:55.133

我能做的最好的事情是为“提交”创建一个键绑定（在首选项...常规->键下）。然后你只需要点击项目并敲击一个组合键，这样就节省了整个右键->团队->提交...的过程。

如果您只想签入正在编辑的文件，则无需单击任何位置，只需按组合键，就会弹出提交对话框以提交当前文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T14:38:53.853

在 Eclipse 中，您可以选择提交一个文件或整个项目。

要提交整个项目，请右键单击资源视图中的项目，然后选择 Team->Commit。

如果您想预览更改，请选择 Team->Synchronize，这将显示哪些文件已更改，并为您提供传入和传出模式下差异的快速预览。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T14:43:08.510

在 Eclipse 的某些版本（或者 Subclipse 的某些版本——您使用的是 SVN 吗？）中，您可以单击一个工具栏按钮。它将消除提交过程的前 2 或 3 个步骤。也许您可以在工具栏编辑器（或透视编辑器，或者他们称之为的任何东西......我已经有一段时间没有使用它了）上找到该按钮。

另外，恕我直言，您不应该提交然后进行测试。如果您在本地进行测试，然后提交（并在 QA 类型系统中再次测试......），您会发现事情运行得更加顺畅。你可能已经知道了，所以我假设你不能在本地测试有一个奇怪的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-09T18:14:16.797

我发现在 Package Explorer 中右键单击项目或文件是这个重复过程中最耗时的部分。

大多数情况下，我在多个文件中进行相关更改，然后同步整个项目。通过热键加速整个过程的第一步是将组合键绑定到“与存储库同步...”。对于 OSX 上的 Eclipse 3.5，可以通过转到 Eclipse->Preferences->General->Keys 来绑定热键。然后在文本过滤器中搜索“同步”。我将控件绑定为同步。

一旦热键绑定到 Synchro... ，点击热键将同步活动编辑器中的文件，或项目资源管理器中的选定文件（如果项目资源管理器处于活动状态）。

要快速将焦点放在项目浏览器上，请在 OSX 上按 command-F6 以循环到项目浏览器。另一种方法是，如果焦点位于编辑器视图中，则点击 cmd-alt-W（显示在...），然后从弹出窗口中选择“项目资源管理器”。对不起 OSX 快捷方式。如果您查看前面提到的 Keys 区域，您应该能够找到循环视图的相关热键。

因此，我们加快了部分流程的速度，但如果能够快速选择整个项目，仍然会很不错。最简单的方法是 hack - 只需在项目资源管理器中输入项目名称即可。如果名称不够独特，请在其前面加上“Z”或其他内容，以便他们击键“z”将选择整个项目。然后点击 Synchro... 热键来同步整个项目。

好的，所以同步整个项目需要相当多的热键，就像演奏吉他和弦的进行或在铁拳中做一个甜蜜的组合一样，但老实说，热键的序列都可以在少于移动所需的时间内完成你的手给鼠标。也许将宏绑定到整个序列会使其非常方便。

# sql - 如何从同一数据管道中的另一行获取值？

> ID：183078
> 
> 赞同：1
> 
> 时间：2008-10-08T14:33:53.333
> 
> 标签：sql, sql-server, ssis

我已加载数据并完成了对数据的各种转换，问题是数据中管理着父/子关系 - 最好通过示例来解释

每行都有（列名组成）

```
row_key    parent_row_key   row_name    parent_row_name 
```

一些行有 row_key == parent_row_key （他们自己的父） 一些行与另一行相关（例如，第 25 行是第 44 行的父行）。

在这种情况下，第 25 行是第 44 行的父行。我需要将第 25 行的 row_name 放在第 44 行的 parent_row_name 中。如何查询管道中的数据以获取值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:47:13.637

您不能只使用多播拆分数据，然后对其自身进行合并连接吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T13:26:17.840

听起来像 Macola（Exact Software）处理交易的方式。在他们的情况下，将一笔交易添加到表中，并在行中包含对原始交易的引用 - 例如，如果原始交易是 1 月的购买，而 2 月有付款，则 2 月的付款将包括1 月付款中的交易编号，列中引用父项。由于没有外键关系，因此每个初始交易都会被赋予一个可以在整个系统的分类帐之间移动的 guid。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T13:07:46.813

您可以将数据写入数据库中的临时表、原始文件目标或记录集目标（取决于数据集的大小）。然后你可以再次遍历你的数据并查询你的临时数据并找到正确的父级。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-15T13:22:31.637

正如你所说

> 我已加载数据并完成了对数据的各种转换

然后我可以假设您已经在临时表或临时表中拥有所有可用数据吗？如果是这样，只需对字段进行更新就可以解决我猜的问题吗？假设暂存表中并非所有信息都可用，您可以先对暂存表中的值进行级联搜索，如果未找到任何信息，则从实际表中进行搜索。在一次更新中执行此操作很容易胜过逐行执行。（特别是如果您有适当的索引可用）

```
UPDATE staging_table
   SET parent_row_name = COALESCE(new.row_name, old.row_name, '#N/A#')
  FROM staging_table upd
  LEFT OUTER JOIN staging_table new
               ON new.row_key = upd.parent_row_key
  LEFT OUTER JOIN destination_table old
               ON old.row_key = upd.parent_row_key 
```

# eclipse - 需要帮助编写自定义 BuildListener

> ID：183083
> 
> 赞同：1
> 
> 时间：2008-10-08T14:35:10.960
> 
> 标签：eclipse, ant, eclipse-plugin

我想在构建 Eclipse 产品的无头构建过程中添加一个 BuildListener。关于如何做到这一点的文档，容我们说，有点少。我想我需要将我的自定义 jar 放入插件中，然后使用 org.eclipse.ant.core.extraClasspathEntries 扩展点使该 jar 对 Ant 可见。但是我尝试过的所有结果

```
指定为构建侦听器的 [myClass] 不是 org.apache.tools.ant.BuildListener 的实例。
```

我的类实现了 BuildListener 接口。各种帖子似乎表明这意味着我的类是由插件类加载器而不是 Ant 类加载器可见/加载的。但我认为扩展点的全部意义在于让 Ant 可以看到罐子......

谁能阐明我做错了什么？附加信息：我目前正在尝试使用 AntRunner 应用程序从 Eclipse IDE 运行此构建。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T19:02:41.590

当我有两个提供`ant.jar`.

确保您使用该`org.apache.ant`插件并且没有其他插件提供另一个`ant.jar`.

我刚刚偶然发现的另一件事：包含您的贡献的 jar 不得位于插件类路径（运行时-> 类路径）中。

请参阅[Eclipse 错误 34466](https://bugs.eclipse.org/bugs/show_bug.cgi?id=34466)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T17:11:18.147

按照此处找到的有关使用贡献的任务和类型的说明进行操作： [开发 Ant 任务](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/ant_developing.htm)和[贡献的 Ant 任务](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/ant_contributing_task.htm)

# windows - 如何判断应用程序是否为 MFC 程序？

> ID：183086
> 
> 赞同：4
> 
> 时间：2008-10-08T14:35:36.327
> 
> 标签：windows, mfc

我有一个编译好的 GUI 应用程序。我需要了解它是否使用 MFC 库进行编程。Depends.exe 不返回任何对 MFC42*.dll 的依赖关系。是否有任何工具可以获取有关可执行文件的其他信息？（如果可能的话，不仅是库，还有正在使用的编译器等。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:17:23.077

另请注意，MFC 应用程序可能已静态链接到 MFC 库而不是使用共享库 - 静态链接的 MFC 应用程序不会将 MFCXXX.dll 的依赖关系显示为 Depends 中的直接依赖关系。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T04:03:35.323

如果应用程序是使用**MFC**编写的，它通常由具有以**Afx:**字符串为前缀的**类名的窗口组成。**

 **如果您可以访问**Spy++**实用程序，则可以很容易地查询任何可执行文件的**类名**详细信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T14:39:27.893

如果您关注的应用程序动态链接到 MFC，它将依赖于 MFCXX.dll，其中 XX 是版本号。例如，我们的应用程序依赖于 MFC80.dll。

但是，如果应用程序是静态链接的，则 MFC 的所有源代码都将直接编译到应用程序中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T21:01:49.603

dumpbin 是您想要的工具，如果它是静态链接的。MFC 符号往往被命名为“...Afx...”或“...MFC...”，因此如果您看到这些符号，则可能是在使用 MFC。该实用程序还可以告诉您链接器版本、为其编译的操作系统等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T17:18:57.323

您可以检查可执行文件中是否有任何[标准 MFC 资源](http://msdn.microsoft.com/en-us/library/fy6fte8a(VS.71).aspx)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T14:53:56.257

您可以尝试在文件上运行 dumpbin 实用程序（SDK 的一部分或 VS 安装）。

如果你运行“dumpbin /exports”，你可以寻找任何有说服力的 MFC-isms。我不确定是否会有，所以测试只会确认 MFC 是静态链接的，而不是反驳它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T15:07:45.137

如果你可以运行应用程序，让它运行，然后使用 Sysinternals 工具[ProcessExplorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)查看加载的 DLL。

或者您是否需要一种程序化方式来确定应用程序是否使用 MFC？另外，我有点惊讶 Depends 没有显示您的期望。将 Depends 输出与 ProcessExplorer 进行比较，看看您能学到什么。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T18:54:48.563

Babak Farrokhi 曾经编写了一个非常方便的小程序，名为“Language 2000”，它可以扫描 exe 以查找库和框架的二进制签名。它用于检测静态链接的 MFC 程序的两个手指。不过，几年前我使用它时，该程序已经很旧了。您必须检查网络是否有更新的版本可用，或者签名是否仍然有效。谁知道！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-22T13:25:48.163

SysInternals（最近被微软收购）发布取决于。无论它是动态链接到 DLL 还是静态链接，您都会看到引用的导入/导出符号（可能因 C++ 入口点签名而损坏）。

这个工具对于检测循环引用（使用依赖树）也非常有用。在极少数情况下，当您绝对确定您导出了入口点但链接器仍然失败时，您可以检查 DLL 中的“缺失”入口点。

还有助于发现 DLL 的隐藏秘密。

# java - 用于 Java 的 Capistrano？

> ID：183091
> 
> 赞同：15
> 
> 时间：2008-10-08T14:38:49.113
> 
> 标签：java, deployment, capistrano

我是 Capistrano 的忠实粉丝，但我需要为纯 Java 商店开发一个自动部署脚本。我看过 Ant 和 Maven，它们似乎不像 Capistrano 那样适合远程管理——它们似乎更专注于简单地构建和打包应用程序。有没有更好的工具？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-08T15:08:45.307

我认为 Java Web 应用程序没有类似 Capistrano 的应用程序，但这不应该真正阻止您使用它（或 Fabric 等替代品）来部署您的应用程序。正如您已经说过的，Ant 更像是 GNU Make 的替代品，而 Maven 主要是构建/依赖管理应用程序。

由于 Java Web 应用程序由于 .war 容器较少依赖外部库，因此您可以（取决于您的应用程序服务器）使部署应用程序像运行简单的 HTTP PUT 请求一样简单。

但是如果你需要额外的步骤，到目前为止， [Fabric](http://docs.fabfile.org/en/1.4.0/index.html)对我来说效果很好，我假设 Capistrano 还提供通用的 shell 命令、put 和 get 操作。因此，如果您已经拥有的东西已经有效，我不会寻找太久的替代方案:-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-02T13:29:47.837

我认为 controltier（参见：[http](http://controltier.org) ://controltier.org ）是您正在寻找的。尽管 controltier 不需要专门用于 Java 部署。

请参阅文档摘录（请参阅：[控制层文档](http://doc36.controltier.org/wiki/ControlTier#Is_ControlTier_the_same_as_Capistrano.2C_Fabric.2C_or_Func.3F "测试")）：

> **ControlTier 是否与 Capistrano、Fabric 或 Func 相同？**
> 
> 在最基本的概念中，ControlTier、Capistrano、Fabric 和 Func 是类似的工具。我们肯定会称 Capistrano、Fabric 和 Func 为基本命令调度框架。
> 
> 但是，ControlTier 在设计上远远超出了这些其他工具所提供的功能。ControlTier 提供的自动化库和基于 Web 的工具旨在让您构建可供企业或大型 Web 运营团队使用的完全自动化系统。还有一些功能，例如错误处理和集中式日志记录，这些功能不在其他命令调度工具的范围内。
> 
> 此外，Capistrano 是一个基于 Ruby 的工具，主要关注 Ruby on Rails 社区的需求。ControlTier 虽然是用 Java 编写的，但不需要您了解 Java 即可使用它。事实上，您可以使用任何您熟悉的脚本语言（包括 ruby​​）。ControlTier 尝试尽可能保持语言和平台（Linux、Unix、Windows 等）中立。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-11T15:54:00.913

在我的工作中，我们专门使用 Capistrano 来部署我们所有的 Java 应用程序。这绝对是可能的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-20T07:46:25.593

我使用 capistrano 配方从源代码构建 dspace（一个 java webapp，它又使用 maven）：[使用 capistrano 安装 dspace](http://code.google.com/p/bungeni-dspace/wiki/InstallingDspaceUsingCapistrano)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-08-20T01:36:45.040

有趣的是，Capistrano 的 repo 想法假设您正在处理 SCM（源代码控制管理器）。服务器上的结构和应用程序的相关版本控制适用于应用程序源。这对于解释型语言是有意义的。

然而，在像 Java 这样的编译语言中，版本控制和分支是在部署之前进行的，当应用程序被编译和构建时，源代码控制系统已经被抛在后面，结果是一个版本化的 jar 或 tar 来包含应用程序。通常，此 tarball（jar + config）会发布到 Maven 工件存储库，如 Nexus 或 Artifactory。

令人惊讶的是，这个工件回购映射到 Capistrano 回购就好了。代替 SCM，我们可以将此 tarball 视为 SCM（要版本化的源）。考虑到这一点，我[为 Maven artifact repos 实现了 Capistrano SCM 插件](https://github.com/agoodno/capistrano-scm-maven)。它是新的，但工作得很好。

它将我们的 Ruby 和 Java 项目统一在一个工具上，最重要的是，它为我们的 Java 项目带来了 Capistrano 的 SSHKit 和 rake 的强大功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-15T05:30:23.120

Capistrano 可以部署所有的 Web 基础应用程序。不同语言的部署几乎相同：

1.  更新代码
2.  将代码推送到生产服务器
3.  为此部署准备配置文件
4.  重启服务器。（瘦，nginx，tomcat）

在我公司，我们使用 Capistrano 来部署 java、Vuejs、php、ruby、python 应用程序。

# asp.net - ASP.Net 中等效的 Vb6“标记”属性？

> ID：183093
> 
> 赞同：7
> 
> 时间：2008-10-08T14:39:01.890
> 
> 标签：asp.net, controls, webforms, tag-property

我在这里寻找想法和意见，而不是“真正的答案”，我猜......

回到旧的 VB6 时代，所有控件中都有一个名为“Tag”的属性，这是存储与控件相关的自定义信息的有用方法。每一个控制都有它，一切都很幸福......

现在，在 .Net 中（至少对于 WebForms），它不再存在了......

有没有人有一个很好的替代品？

我经常发现这个问题，我有不同的函数在生命周期的不同时间运行，它们用我的控件做一些事情，我想让它们保持独立，但一个应该将信息传递给另一个关于具体控制。

我可以想到一百万种替代方法（显然，从模块级字典开始），但没有一个像好的 ol' Tag 那样干净。

（注意：我知道我可以对所有控件进行子类化并改用我的版本。我宁愿不这样做）

有什么建议么？你通常如何解决这个问题？关于他们为什么首先删除这个的任何想法？

编辑：我正在寻找请求内的东西，而不是请求间的东西。我不需要这些信息仍然存在于 PostBack 上。例如，它位于 _Load 和 _PreRender 方法之间。

EDIT2：我知道我的 ASp.Net，我知道桌面和网络之间的区别，伙计们！我只是想最大限度地使用 .Net 给我的抽象。我理解权衡，相信我，假设我这样做，请回答。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T15:03:00.047

不，没有直接的等价物，但如果您使用的是框架的 v3.5，您可以使用扩展方法轻松添加此功能。例如：

```
Imports System.Runtime.CompilerServices

Public Module Extensions
  <Extension()> _
  Public Sub SetTag(ByVal ctl As Control, ByVal tagValue As String)
    If SessionTagDictionary.ContainsKey(TagName(ctl)) Then
        SessionTagDictionary(TagName(ctl)) = tagValue
    Else
        SessionTagDictionary.Add(TagName(ctl), tagValue)
    End If
  End Sub

  <Extension()> _
  Public Function GetTag(ByVal ctl As Control) As String
    If SessionTagDictionary.ContainsKey(TagName(ctl)) Then
        Return SessionTagDictionary(TagName(ctl))
    Else
        Return String.Empty
    End If
  End Function

  Private Function TagName(ByVal ctl As Control) As String
    Return ctl.Page.ClientID & "." & ctl.ClientID
  End Function

  Private Function SessionTagDictionary() As Dictionary(Of String, String)
    If HttpContext.Current.Session("TagDictionary") Is Nothing Then
        SessionTagDictionary = New Dictionary(Of String, String)
        HttpContext.Current.Session("TagDictionary") = SessionTagDictionary
    Else
        SessionTagDictionary = DirectCast(HttpContext.Current.Session("TagDictionary"), _ 
          Dictionary(Of String, String))
    End If
  End Function
End Module 
```

然后，在您的 ASP.NET 页面中，首先将您的扩展纳入范围，例如：

```
Imports WebApplication1.Extensions 
```

...然后根据需要使用您的控件：

```
TextBox1.SetTag("Test")

Label1.Text = TextBox1.GetTag 
```

稍后编辑：如果您真的，真的不想将标签存储在 Session 对象中，则可以将它们填充到您的 Viewstate 中。这当然意味着您的标签*将*在发送给用户的页面标记中公开（尽管是以模糊的形式），不幸的是，需要一些反射功能，因为页面的 ViewState 属性被标记为“受保护” ' 由于某些原因。

因此，这段代码应该仅用于娱乐目的，除非您真的*想*在代码审查期间引起人们的注意：

```
<Extension()> _
  Public Sub SetTag(ByVal ctl As Control, ByVal tagValue As String)
    ViewState.Add(ctl.ID & "_Tag", tagValue)
  End Sub

<Extension()> _
  Public Function GetTag(ByVal ctl As Control) As String
    Return ViewState(ctl.ID & "_Tag")
  End Function

Private Function ViewState() As Web.UI.StateBag
    Return HttpContext.Current.Handler.GetType.InvokeMember("ViewState", _
                Reflection.BindingFlags.GetProperty + _
                Reflection.BindingFlags.Instance + _
                Reflection.BindingFlags.NonPublic, _
                Nothing, HttpContext.Current.CurrentHandler, Nothing)
End Function 
```

最终编辑（我保证......）。这里有一种摆脱反射的方法：首先，创建一个新类以公开具有可用保护级别的 ViewState 属性，然后更改您的 Code-Behind (.aspx.vb) 类以继承它而不是 Web.UI。页面，例如：

```
Public Class PageEx
  Inherits System.Web.UI.Page

  Friend ReadOnly Property ViewStateEx() As Web.UI.StateBag
    Get
        Return MyBase.ViewState
    End Get
  End Property
End Class 
```

现在，在您的扩展模块中，您可以访问这个新定义的属性：

```
Private Function ViewState() As Web.UI.StateBag
  Return DirectCast(HttpContext.Current.Handler, PageEx).ViewStateEx
End Function 
```

仍然有点hack，但比使用反射更容易接受......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T16:41:59.193

您还可以使用复合模式而不是使用继承：

```
public class TaggedControl<TControl, TTag> : Control 
 where TControl : Control, new()
 { public TaggedControl() {this.Control= new TControl();}

   public TControl Control {get; private set;}
   public TTag     Tag     {get; set;}     

   protected override void CreateChildControls(){Controls.Add(Control);}
 }

 var textBox = new TaggedControl<TextBox, string>();
 textBox.Tag = "Test";
 label.Text  = textBox.Tag; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-04-02T21:52:59.123

我采用了 mdb 的出色解决方案，并将其移植到 C# 以满足我自己的需要。我还将标签从字符串字典更改为字符串字典，对象......因为理论上任何类型的对象都可以存储在会话中，而不仅仅是字符串：

```
using System.Collections.Generic;
using System.Web;
using System.Web.UI;

public static class Extensions
{
    public static void SetTag(this Control ctl, object tagValue)
    {
        if (ctl.SessionTagDictionary().ContainsKey(TagName(ctl)))
            ctl.SessionTagDictionary()[TagName(ctl)] = tagValue;
        else
            ctl.SessionTagDictionary().Add(TagName(ctl), tagValue);
    }

    public static object GetTag(this Control ctl)
    {
        if (ctl.SessionTagDictionary().ContainsKey(TagName(ctl)))
            return ctl.SessionTagDictionary()[TagName(ctl)];
        else
            return string.Empty;
    }

    private static string TagName(Control ctl)
    {
        return ctl.Page.ClientID + "." + ctl.ClientID;
    }

    private static Dictionary<string, object> SessionTagDictionary(this Control ctl)
    {
        Dictionary<string, object> SessionTagDictionary;
        if (HttpContext.Current.Session["TagDictionary"] == null)
        {
            SessionTagDictionary = new Dictionary<string, object>();
            HttpContext.Current.Session["TagDictionary"] = SessionTagDictionary;
        }
        else
            SessionTagDictionary = (Dictionary<string, object>)HttpContext.Current.Session["TagDictionary"];
        return SessionTagDictionary;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T14:41:50.200

您可以向某些控件添加属性，但这似乎会在呈现的控件周围添加一些讨厌的 HTML，例如`<div attrName="attrValue">`...（尽管它可能是一个跨度）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T14:43:03.160

我不确定标签属性在 VB6 中做了什么，但也许您正在寻找`Attributes`Web 控件的属性：

```
MyImgCtrl.Attributes["myCustomTagAttribute"] = "myVal"; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T14:43:47.760

您询问了 ASP.Net，但 vb6 是一种桌面语言，它的“标记”控件也是如此。用于经典 asp 的 VBScript 并没有真正的控件概念。

现在在 .Net 中，对于桌面控件，您可以使用继承，这比旧的 Tag 属性更强大。继承也适用于 Web 控件，尽管您必须小心使用它来保持状态。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-08T14:45:27.447

您可以使用 asp:Hidden 控件在帖子之间存储数据。就像意志所说，如果你失去了它的价值，那么拥有一个标签属性是没有意义的。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-08T15:06:04.907

该`Tag`属性始终是一种奇怪的疣状东西，**它**很有用，您可以从中挂出您想要的任何数据。但它不是强类型的，也没有真正实现连贯的设计。该属性本身就像一个奇怪的旋钮一样挂在控件上。他们将其保存在 WinForms 中以方便从 VB6 移植代码。新的 WPF`Control`类没有`Tag`.

使用 .NET，您拥有完整的面向对象和足够的类型多态性，因此您可以强类型化您想要与代码关联的任何额外信息，无论它是在子类中还是在`Dictionary<Control,TValue>`.

如果它在单个`Page`请求中，并且您想要一个通用解决方案，那么页面本身中每个值类型（例如，`Dictionary<Control,string>`和`Dictionary<Control,BusinessObject>`）的字典应该正是您所需要的。

# mfc - MFC 列表控件滚动显示额外的网格线

> ID：183101
> 
> 赞同：2
> 
> 时间：2008-10-08T14:40:13.820
> 
> 标签：mfc

我在带有网格线的报表视图中使用 MFC 列表控件以模糊的电子表格方式显示数据。

有时当用户在控件中垂直滚动时，会绘制额外的网格线，这看起来很糟糕。

当使用滑块或鼠标滚轮滚动时不会发生这种情况，只有在使用滚动控件底部的小向下箭头按钮时才会发生这种情况。

当列表控制窗口的大小不是精确的偶数行时，似乎会发生这种情况，因此在底部可以看到部分行。

如果我调整列表控件的大小，使部分行不可见，问题就解决了。但是，当程序在另一台计算机上运行时，它会出现，大概是因为一行所占用的像素数发生了变化。

我假设这是屏幕分辨率、字体大小和“对话框单位”之间的交互。

我想我需要在创建控件时以编程方式强制它的大小。但是什么尺寸？

我曾尝试使用 ApproximateViewRect() 方法，但我无法让它工作。也许这种方法不知道报告视图？

我想，另一种方法是创建我自己的 CListCtrl 特化并覆盖任何进行滚动的方法。这似乎需要做很多工作。

此屏幕截图显示了一个密切相关的问题，即网格线丢失

![替代文字](https://i.stack.imgur.com/K5XzV.jpg)

这是一个带有额外网格线的

![替代文字](https://i.stack.imgur.com/6pADr.jpg)

这两者之间以及它们与完美滚动的唯一区别是控件的垂直大小有几个像素不同。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T17:34:55.340

这确实是一个与“平滑滚动”相关的错误，这里有一个解决方法：

```
void CMyListCtrl::OnVScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar)
{
    __super::OnVScroll(nSBCode, nPos, pScrollBar);
    Invalidate();
    UpdateWindow();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:14:43.307

我记得这是 ListView 本身的一个错误（不仅仅是通过 MFC，而是通过通用控件）本身。一个快速的谷歌搜索似乎让很多人得出了同样的结论。我猜因为 Windows 资源管理器没有网格线，他们觉得不需要解决这个问题？我记得这要追溯到 90 年代后期。

我想诀窍是在滚动后使窗口无效 - 也许是为了响应 VSCROLL 消息？只是一个猜测。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T14:46:12.420

股票列表视图会发生这种情况，还是自定义绘制？我从未见过标准 Windows 控件的重绘问题。

也许您可以发布屏幕截图来说明问题？我想您更愿意修复重绘问题而不是精确调整控件的大小？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-08T18:58:08.497

要修复 MFC 列表控件中的此错误，您需要专门化控件，覆盖响应滚动的方法，并强制它在完成滚动后完全重绘列表。

接口头

```
class cSmoothListControl : public CListCtrl
{
public:
    DECLARE_MESSAGE_MAP()
    afx_msg void OnVScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar);
}; 
```

执行：

```
BEGIN_MESSAGE_MAP(cSmoothListControl, CListCtrl)
ON_WM_VSCROLL()
END_MESSAGE_MAP()

void cSmoothListControl::OnVScroll(UINT nSBCode, UINT nPos, CScrollBar* pScrollBar)
{
    // call base class method to do scroll
    CListCtrl::OnVScroll(nSBCode, nPos, pScrollBar);

    // force redraw to cover any mess that may be created
    Invalidate();
    UpdateWindow();
} 
```

# c++ - 是否为未使用的模板类方法生成目标代码？

> ID：183108
> 
> 赞同：14
> 
> 时间：2008-10-08T14:41:16.737
> 
> 标签：c++, templates, footprint

我有一个使用 3 个不同类型参数实例化的 C++ 模板类。有一个类只需要为其中一种类型提供的方法，并且永远不会与其他两种类型一起调用。

该方法的目标代码会生成三次（针对所有实例化模板的类型），还是只生成一次目标代码（针对实际使用的类型）？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-08T14:59:05.560

虚拟成员函数在类模板被实例化时被实例化，但非虚拟成员函数只有在它们被调用时才会被实例化。

这在 C++ 标准的 [temp.inst] 中有所介绍（在 C++11 中，这是 §14.7.1/10。在 C++14 中，它是 §14.7.1/11，在 C++17 中它是 §17.7.1/9。摘自下面的 C++17)

> 实现不应隐式实例化函数模板、变量模板、成员模板、非虚拟成员函数、成员类、类模板的静态数据成员或`constexpr`if 语句的子语句 (9.4.1) , 除非需要这样的实例化

另请注意，即使某些成员函数对于给定的模板参数不可实例化，也可以实例化类模板。例如：

```
template <class T>
class Xyzzy
{
public:
    void CallFoo() { t.foo(); }  // Invoke T::foo()
    void CallBar() { t.bar(); }  // Invoke T::bar()

private:
    T t;
};

class FooBar
{
public:
    void foo() { ... }
    void bar() { ... }
};

class BarOnly
{
public:
    void bar() { ... }
};

int main(int argc, const char** argv)
{
    Xyzzy<FooBar>  foobar;    // Xyzzy<FooBar> is instantiated
    Xyzzy<BarOnly> baronly;   // Xyzzy<BarOnly> is instantiated

    foobar.CallFoo();         // Calls FooBar::foo()
    foobar.CallBar();         // Calls FooBar::bar()

    baronly.CallBar();        // Calls BarOnly::bar()

    return 0;
} 
```

这是有效的，即使 Xyzzy::CallFoo() 是不可实例化的，因为没有 BarOnly::foo() 这样的东西。此功能通常用作模板元编程工具。

但是请注意，模板的“实例化”与生成多少目标代码没有直接关系。这将取决于您的编译器/链接器实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T18:43:25.750

我认为这取决于编译器和设置。例如，我相信 MSVC6 生成了一切，但 VS2005 没有。规范说编译器不应该，但在现实世界中，它取决于实际的编译器（例如，在 MSVC6 的 boost 中有许多变通方法）。如果启用 /opt:ref ，链接器可以删除未引用的函数（对于 VS，其他编译器存在等效选项）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T14:46:44.290

通常，是的。

编译器真正知道的是您的程序可以为每个类创建至少一个实例。但它不知道您将如何处理这些实例。所以几乎可以肯定会生成代码。

也就是说，如果所讨论的方法*不是*虚拟的，并且从未被调用，则*链接器*可以使用其正常的死代码删除功能来删除它们。所以生成（和编译）的代码不会出现在最终的 EXE 中。

此外，这在很大程度上取决于所使用的 C++ 编译器，因为它们并不完全相同。

# iphone - 如何在 iPhone 游戏中播放背景音乐？

> ID：183112
> 
> 赞同：10
> 
> 时间：2008-10-08T14:42:11.570
> 
> 标签：iphone

> **可能重复：**
> [iPhone/iPad - 循环背景音乐？](https://stackoverflow.com/questions/3631353/iphone-ipad-loop-background-music)

官方的 iphone 文档还不错，但我发现它们在这个问题上非常无用 - 我能找到的只是一个用于播放 MIDI 文件的 API，但这不是我想要的。我只想在后台播放 MP3。如果用户已经在播放他们自己的音乐，显然我不想在上面播放自己的音乐。

有没有“正确”的方法来做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-24T20:07:22.113

SDK 中的 CrashLanding 演示应用有一个 SoundEngine 类，可以播放背景音乐。

# svn - 'Un-SVN' 工作副本

> ID：183114
> 
> 赞同：47
> 
> 时间：2008-10-08T14:42:33.457
> 
> 标签：svn, tortoisesvn

我有一个文件夹是我的工作副本。如何从此文件夹中删除所有 SVN 功能？我这样做是有原因的，不知何故，包含我所有网站工作副本的主文件夹不知何故变成了工作副本本身，所以我本身就有一个工作副本。

那么，有没有一种简单的方法可以从文件夹中删除版本控制？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-08T14:45:32.670

svn export 是您要查找的命令。您可以将一组受控文件导出到非受控位置并使用它。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-08T14:44:13.297

只需删除其中的所有“.svn”文件夹即可。就是这样。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-10T01:19:01.177

如果您使用 *nix 类工具：

```
find . -type d -name .svn -print0 | xargs -0 rm -fr 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-08T14:48:09.657

如果您使用的是 TortoiseSVN，您只需在工作副本的根文件夹中单击鼠标右键，然后单击导出...即使您有未提交的更改也可以。

同样，您可以只从存储库中执行导出，它不会创建任何 .svn 文件夹。

另一种直接的方法是删除所有 .svn 文件夹，如前所述。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-08T14:44:34.263

您可以手动删除所有 .svn 文件夹（确保也为每个子文件夹执行此操作）或使用简单的实用程序，例如[Jon Gallaway 的 shell 命令](http://weblogs.asp.net/jgalloway/archive/2007/02/24/shell-command-remove-svn-folders.aspx)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-08T14:48:00.903

Windows 客户端“TortoiseSVN”具有“导出”功能。导出在不同文件夹中的其他位置创建一个副本，其中没有所有这些“.svn”文件夹。您可以从存储库或本地副本导出，并可选择包含未版本控制的文件。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-08T14:51:48.243

这个怎么样：

```
for /f "tokens=* delims=" %%i in ('dir /s /b /a:d ".svn"') do rd /s /q "%%i" 
```

递归删除所有 .svn 文件夹——

（如果导出功能不是您的选项 - 无法访问存储库等......）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-08T14:46:39.127

TortoiseSVN 能够在没有 subversion 绑定的情况下导出文件 - 右键单击​​存储库（或存储库中的目录），然后是 TortoiseSVN，然后是导出。另一种方法是删除所有文件夹中的所有 .svn 目录。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-07-25T13:57:37.193

这是一个 Windows 批处理脚本，它将从 Subversion 工作副本目录中删除所有 .svn 文件夹：

```
@echo off
rem cleanup .svn subdirs

setlocal enabledelayedexpansion

rem change to directory that this batch script resides in

if "%~1"=="" (
    echo Usage: svncleanup svn_working_copy_dir
    exit /b 1
)

echo cleaning up .svn subdirs in "%~1" ...

for /R "%~1" %%I in (.svn) do rmdir /Q /S "%%I" > NUL 2>&1 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-08T14:46:29.423

使用 TortoiseSVN，您可以右键单击拖放文件夹，然后选择“SVN 全部导出到此处”命令。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-04-23T13:53:29.107

我只是使用 Windows 资源管理器搜索“.svn”（从我的工作副本顶部开始），然后选择它找到的所有文件夹并删除它们。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-05-09T16:16:06.437

**使用 Tortoise 就地导出**

当我阅读上述所有建议时，我感到畏缩，因为我的源文件是 3GB，有许多 .svn 文件夹。

从右键单击上下文菜单中选择导出，当弹出“放置副本的位置”对话框时，**选择同一个文件夹本身**。好的。Viola 所有的源代码控制都（递归地）立即消失了。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-08T14:45:01.237

你不能只删除 .svn 子文件夹吗？

据我所知，SVN 将有关其与存储库的连接的所有内容都存储在此子文件夹中（至少在 Windows 中）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-08T14:50:04.877

正如其他人所说，删除 .svn 文件夹*将从该文件*夹中删除 SVN 功能。如果您递归地执行此操作，您将“取消 SVN”您的整个 WC，这本质上就是 export 命令所做的。我不确定它是 Tortoise、CLI SVN 二进制文件还是两者的功能，但我记得其中一个允许您进行就地导出，这实际上只是从 WC 中删除 .svn 文件夹。正常导出会在未版本化的新位置创建 WC 的副本。

# apache - 如何禁用所有 apache 虚拟主机？

> ID：183115
> 
> 赞同：15
> 
> 时间：2008-10-08T14:42:39.480
> 
> 标签：apache, virtualhost

我正在编写一个 shell 脚本来进行一些 Web 服务器配置。我需要禁用所有当前活动的虚拟主机。`a2dissite`不接受多个参数，所以我不能

```
a2dissite `ls /etc/apache2/sites-enabled` 
```

我应该使用`find`吗？手动删除符号链接是否安全`/etc/apache2/sites-enabled`？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2014-07-03T06:12:31.343

您可以执行以下操作：

```
sudo a2dissite '*' 
```

或者：

```
sudo a2dissite 
```

它会提示您选择要禁用的那些。

禁用站点后，重新启动 apache2 服务器：

```
sudo systemctl restart apache2 
```

或者只是重新加载 apache 配置而不完全重启：

```
sudo service apache2 reload 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-08T14:55:38.500

经过一番研究，我发现这`a2dissite`只是一个 shell 脚本，它基本上只是调用`rm`. 所以，和其他回复一样，我同意这样做是安全的

```
rm /etc/apache2/sites-enabled/* 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-08T14:51:14.703

你的脚本只有 Debian 吗？如果是这样，您可以安全地删除启用站点中的所有符号链接，只要所有站点都已正确写入，站点可用目录中的所有符号链接就可以工作。

例如：

```
 find /etc/apache2/sites-enabled/ -type l -exec rm -i "{}" \; 
```

将保护您免受实际在该目录中编写文件而不是符号链接的人的侵害。

（当然，从 rm 中删除 -i 以获得自动脚本）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-12-27T21:13:34.253

要删除主机文件，只需将其删除。如果您只想**禁用**该站点，请使用

```
sudo a2dissite sitename 
```

重启apache2

```
sudo /etc/init.d/apache2 reload 
```

再次从系统中完全删除（删除）它，

```
sudo rm /etc/apache2/sites-available/sitename 
```

我也会在删除文件之前先禁用它

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-08T14:51:12.193

您可以删除符号链接，或将整个目录移开。除了这些链接之外，没有特殊的数据库或其他元数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T14:52:33.780

我从不使用'a2dissite'，总是手动删除和创建 /etc/apache2/sites-enabled 中的链接，所以是的，我会说它非常安全。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-12T04:30:56.133

这是我的解决方法，第一种类型：

`# a2dissite`（键入此命令不带任何参数，它会提示您选择下一行）

> 您的选择是：**siteA siteB siteC siteD**
> 
> 您要禁用哪些站点（通配符可以）？

现在您只需复制以上所有站点列表（**siteA siteB siteC siteD**）并粘贴为您的答案，然后输入。

输出结果将是：

```
removing dangling symlink /etc/apache2/sites-enabled/siteA.conf
removing dangling symlink /etc/apache2/sites-enabled/siteB.conf
removing dangling symlink /etc/apache2/sites-enabled/siteC.conf
removing dangling symlink /etc/apache2/sites-enabled/siteD.conf 
```

这种方法将帮助我们选择性地选择应该删除或完整的站点名称的长列表。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-08T14:45:22.140

您可以编辑 httpd.conf 并删除虚拟主机的包含行（在文件底部）

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-10-08T14:52:46.790

显然，你可以安装最新的 Ubuntu ;)

# winforms - Windows 窗体：以非图形方式运行时的屏幕截图（即屏幕保护程序处于活动状态）

> ID：183118
> 
> 赞同：1
> 
> 时间：2008-10-08T14:42:53.207
> 
> 标签：winforms, testing, directx

我有一个基于 DirectX 和 Windows 窗体的图形密集型应用程序。它有一个自动化和重放框架，围绕该框架构建了一个自动化测试系统。不幸的是，当在夜间构建期间无人看管地运行测试时，显示器处于非活动状态或与屏幕保护程序绑定，并且我们的 IT 安全策略不允许我们禁用它。

所以我的问题是：有没有办法对没有显示运行的应用程序进行“屏幕”捕获？我想确保显卡已启用，以便我的渲染管道相同，但测试框架不需要关心显示的状态。

任何帮助都非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T07:28:42.880

由于您提到了渲染管道，所以我假设您使用的是 Direct3d，如果是这样，您可以保存帧的后缓冲区。我还在使用 VB.Net + MDX 时这样做了

```
Dim tempSurface As Direct3D.Surface
tempSurface = device.GetBackBuffer(0, 0, Direct3D.BackBufferType.Mono)
Direct3D.SurfaceLoader.Save(tempFilename, Direct3D.ImageFileFormat.Png, tempSurface) 
```

您可以轻松地转换为您选择的任何编程语言，它基本上是调用 Direct3d 的 API。不过，您需要将 backbuffer 和 Present 参数配置为

```
' Need to use flip to enable screen capture
presentParams.SwapEffect = Direct3D.SwapEffect.Flip 
presentParams.PresentationInterval = Direct3D.PresentInterval.One 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T15:16:40.907

安装 VM 并在其中运行应用程序。如果您正在运行屏幕保护程序，我怀疑您的视频卡甚至会为应用程序生成 GUI。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:22:07.450

如果我理解正确，您想要的只是截取特定应用程序的屏幕，而不是让结果受到可能正在运行的屏幕保护程序的影响？据我所知，只需`GetDIBits`在正确窗口的 HDC 上进行操作就可以解决问题，而不必关心屏幕保护程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-14T21:16:34.633

您可能会发现此代码非常慢，但是您可以通过设置`PresentParams.PresentFlag = PresentFlag.LockableBackBuffer`

此外，您不需要设置`PresentInterval.One`or `SwapEffect.Flip`，它们可以分别保留在 .Default 和 .Discard 。

（请注意，如果您使用多重采样，则此加速不起作用，请确保`PresentParams.Multisample = Multisample.None`。如果您有 Nvidia 卡，您仍然可以通过在 Nvidia 控制面板中设置选项来将应用程序设置覆盖为您想要的设置来获得抗锯齿！）

# sql - SQL Server 2005 中的多个随机值

> ID：183124
> 
> 赞同：2
> 
> 时间：2008-10-08T14:43:40.257
> 
> 标签：sql, sql-server, random

我需要在 SQL Server 2005 下生成多个随机值，不知何故这根本行不通

```
with Random(Value) as
(
    select rand() Value
        union all
    select rand() from Random

)select top 10 * from Random 
```

首选的解决方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:50:59.400

你有没有尝试过这样的事情（在[http://weblogs.sqlteam.com](http://weblogs.sqlteam.com/jeffs/archive/2004/11/22/2927.aspx)找到）：

```
CREATE VIEW vRandNumber
AS
SELECT RAND() as RandNumber
GO 
```

创建一个函数

```
CREATE FUNCTION RandNumber()
RETURNS float
AS
  BEGIN
     RETURN (SELECT RandNumber FROM vRandNumber)
  END
GO 
```

然后你可以像往常一样在你的选择中调用它 Select dbo.RandNumber() , * from myTable

或从他们的评论中：

```
select RAND(CAST(NEWID() AS BINARY(6))), * from myTable 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T14:45:06.323

我目前正在使用这个：

```
with Random(Value) as
(
    select rand(checksum(newid())) Value
        union all
    select rand(checksum(newid())) from Random  
)select top 10 * from Random 
```

但这似乎过于骇人听闻：S 为什么 rand 在第一个版本中没有得到重新评估？

# php - 您如何决定视图或控制器中是否有某些内容？（Zend 框架）

> ID：183131
> 
> 赞同：1
> 
> 时间：2008-10-08T14:44:19.943
> 
> 标签：php, model-view-controller, zend-framework, separation-of-concerns

您如何决定视图或控制器中是否有某些内容？

下面是一些具体的例子：

*   Zend_Captcha：控制器生成验证码并将其传递给视图还是视图生成它？
*   Zend_Alc：视图是否决定视图的一部分是否应该显示给用户，或者您是否有多个视图取决于可用的操作并且控制器选择正确的一个进行显示？
*   Zend_Session：视图是根据会话数据跟踪谁在查看它，还是由控制器解析并作为某种参数呈现给视图？

哪些组件（模型、视图或控制器）应该执行哪些操作的规则或指南是否写在我可以查看的地方？我在 Zend Framework 站点的文档中没有看到这一点。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-08T16:21:47.640

一般来说，这个问题可以适用于任何 MVC 框架。以下是我使用的指南：

1.  瘦控制器。如果可能的话，让您的控制器只在模型上调用业务逻辑并将结果传递给您的视图。

2.  视图除了视图逻辑什么都不做。做任何与视觉交互相关的事情，比如生成验证码、隐藏和显示基于 ACL 的链接。不要计算总数。不要在模型上调用逻辑。不要做业务逻辑。通常可以从视图中读取会话以隐藏和显示数据/链接。但是不要依赖它来保证安全性：让你的控制器也安全。

3.  胖模特。将尽可能多的业务逻辑放入模型中。这样，您可以在控制器之间共享它们。如果您发现自己在一个控制器中迭代模型的元素，根据某些规则重置值，或者以其他方式执行复杂的业务逻辑，那么您应该尝试找到一种方法将该逻辑放入模型层。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T14:47:41.870

对于 Capcha，您可以在视图中生成。对于 Acl，请使用视图。Zend_Session 可以被控制器和视图访问

# sql-server - 存储过程版本控制

> ID：183148
> 
> 赞同：7
> 
> 时间：2008-10-08T14:46:01.530
> 
> 标签：sql-server, svn, stored-procedures

您如何管理存储过程的修订？

我们有一个基于 SQL Server 2005 的 BI 解决方案，其中包含数百个存储过程。什么是让这些进入 Subversion 的好方法？您推荐使用哪些工具将存储过程脚本化为文件？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T14:57:07.000

毫无疑问，您可以购买大量现成的产品（我认为一些 RedGate 工具在这里可能会派上用场），以及 Visual Studio Team Suite - Database Edition。

鉴于购买的东西，为什么不考虑使用[SQL 管理对象 (SMO)？](http://msdn.microsoft.com/en-us/library/ms162169.aspx)

我编写了一些实用程序来生成 T-SQL 脚本（使用 Scripter 类），它们生成的脚本与通过 SQL Server Management Studio 生成脚本时所获得的脚本相同（它使用相同的功能）。

您可以将这样的实用程序集成到构建脚本/构建过程中，这将允许您生成脚本，然后将它们版本化并检查到源存储库中。另外，您可以将脚本批处理到单个文件中（如果需要），这比维护数百个单独的文件要好。

不久前，我写了一篇关于这种方法的[博客文章。](http://www.sanderstechnology.com/?p=9498)

查看更多关于[SMO 类 Scripter](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.scripter.aspx)

这里还有一些可能有用的条目：

[http://www.sqlteam.com/article/scripting-database-objects-using-smo-updated](http://www.sqlteam.com/article/scripting-database-objects-using-smo-updated)

[http://sqlblog.com/blogs/ben_miller/archive/2007/10/03/table-scripting-with-smo-part-1.aspx](http://sqlblog.com/blogs/ben_miller/archive/2007/10/03/table-scripting-with-smo-part-1.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T14:48:30.573

请参阅[此处](https://stackoverflow.com/questions/173/how-do-i-version-my-ms-sql-database-in-svn)和[此处](https://stackoverflow.com/questions/308/is-there-a-version-control-system-for-database-structure-changes)作为开始。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T14:51:34.297

请在此处查看[对我的 SQL Server 存储过程进行版本控制的最佳方法是什么？](https://stackoverflow.com/questions/146543/what-is-the-best-way-to-version-control-my-sql-server-stored-procedures). 可能会帮助您确定此问题的几个解决方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-08T14:51:16.857

我以前使用 Visual Studio 数据库项目来管理创建表脚本、存储过程脚本等。我很确定您可以使用 subversion 以与任何 Visual Studio 项目相同的方式管理这些文件。

我使用内置功能来编写 procs 脚本，但我确信 Redgate 会为此提供一些很好的工具。

# visual-studio - Visual Studio 和 Temp 文件夹的病毒扫描

> ID：183153
> 
> 赞同：13
> 
> 时间：2008-10-08T14:46:21.983
> 
> 标签：visual-studio, visual-studio-2008, configuration, antivirus

我们使用 Visual Studio 2008 作为我们的主要开发 IDE。我们的安全团队已将 McAfee 设置为扫描我们的 \Local Settings\Temp 文件夹中的文件。不幸的是，VS 在代码构建期间使用了这个目录，这降低了开发人员的速度。我们在这方面与安全团队陷入了僵局，想知道是否有人知道 VS 中的配置设置，我们可以将文件夹更改为写入这些临时文件的位置。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-10T14:40:41.193

使用 web.config 中编译部分的 tempDirectory 属性：

```
<compilation debug="true" tempDirectory="C:\Foo"> 
```

确保您授予 ASPNET 帐户对 C:\Foo 的写入权限（或您的 ASP.NET 工作进程正在运行的任何帐户 - 在我的情况下，它是一个域帐户）。

根据：http: [//msdn.microsoft.com/en-us/library/system.web.configuration.compilationsection.tempdirectory.aspx](http://msdn.microsoft.com/en-us/library/system.web.configuration.compilationsection.tempdirectory.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-30T06:51:13.090

您可以编写一个覆盖 %TEMP% 和 %TMP% 变量的批处理文件，然后启动 Visual Studio。当批处理文件覆盖环境变量时，它仅适用于该会话，它不会修改直接从其他批处理文件/系统启动的应用程序的 %TEMP%。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T14:58:59.400

如果您能够在盒子上调试进程，那么将调试器附加到病毒扫描程序并在命中附加断点后忘记让它运行将提高性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:29:19.370

在我的公司，我们进入“服务”屏幕并将按访问扫描程序设置为“禁用”，这会阻止它在系统启动时启动（除非他们推出更新，然后您必须再次执行此操作）。值得注意的是，您可以通过单击“停止”来暂时禁用它，但它会定期自行重启。将其设置为“禁用”可防止其重新启动。性能提高 10 倍。为了降低病毒的风险，我们对定期进行全面系统扫描非常警惕。

如果您必须使用按访问扫描仪，我认为您不需要更快的计算机。以我的经验，它总是被访问的磁盘是瓶颈。询问固态磁盘和/或条带 RAID 配置。当然，再多几个内核永远不会伤害任何人……尤其是在磁盘吞吐量如此之大的情况下，这可能是必要的。但是你需要更多的磁盘吞吐量。等等

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T14:58:01.633

也许你会抱怨很多你需要更快的电脑，因为增加的安全性会让你慢很多？准备好确凿的事实（例如“较慢的编译时间每天花费我 60 分钟”）
通常当涉及到花钱时，大多数企业会找到其他方法来解决问题。

# error-checking - 错误检查的适当数量是多少？

> ID：183158
> 
> 赞同：2
> 
> 时间：2008-10-08T14:47:12.700
> 
> 标签：error-checking

```
public void PublicMethod(FooBar fooBar)
{
    if (fooBar == null)
        throw new ArgumentNullException("fooBar", "fooBar cannot be null");

    // log the call [added:  Thanks S.Lott]
    _logger.Log("PublicMethod called with fooBar class " + fooBar.Classification);

    int action = DetermineAction();
    PrivateMethod(fooBar, action);
}

private void PrivateMethod(FooBar fooBar, int action)
{
    if (fooBar == null)
        throw new ArgumentNullException("fooBar", "fooBar cannot be null");  // Is this line superfluous?

    /*
        Do something
    */
} 
```

如果已经在公共接口上检查了输入，是否可以在私有方法中跳过这种错误检查？通常有一些经验法则可以通过......

编辑：

也许 ArgumentNullException 不是一个很好的例子，因为可以使您应该在两个级别都检查但返回不同的错误消息的参数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:50:21.600

我会说不。

*虽然在这种*情况下您确实知道它已经检查了可空性，但在两个月内，最年轻的实习生会出现并编写也调用 PrivateMethod 的 PublicMethod2，但是你瞧，他忘了检查 null。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T15:00:30.240

由于 public 方法并没有真正使用 foobar，我不确定它为什么要检查。当前的私有方法关心，但关心是私有方法的责任。实际上，私有方法的全部意义在于将所有职责委托给它。

一个方法检查它实际使用的输入；它不检查它只是通过的东西。

如果一个不同的子类具有相同的公共方法，但有一些不同的私有方法实现——一个可以容忍空值的方法——现在怎么办？您有一个公共方法现在对新子类有错误的约束。

您希望在公共方法中做的尽可能少，以便各种私有实现可以自由地做正确的事情。不要“过度检查”或“以防万一”检查。委派责任。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:10:45.933

当使用按合同设计（[http://en.wikipedia.org/wiki/Design_by_contract](http://en.wikipedia.org/wiki/Design_by_contract)）时，进行正确调用通常是客户（公共方法）的责任，即传递有效参数。在这种特殊情况下，它取决于 null 是否属于一组有效输入值，因此有 3 个选项：

1）空值是有效值：抛出异常或错误意味着违反合同，服务器（私有方法）必须处理空值并且不应该抱怨。

2) Null 是无效值，由您控制的代码传递：由服务器（私有方法）决定如何反应。显然，抛出异常是处理这种情况的更优雅的方式，但它的代价是必须在堆栈的其他地方处理该异常。异常并不是处理因编程失误导致的合同违约的最佳方式。您真的不应该在合同已经违反时抛出异常，而是在由于环境问题而无法在软件中控制的情况下无法履行时抛出异常。通过将断言插入私有方法的开头以检查参数是否为空，可以更好地处理错误。这将降低代码的复杂性，

3）然后是防御性编程（[http://en.wikipedia.org/wiki/Defensive_programming](http://en.wikipedia.org/wiki/Defensive_programming)）。在处理您无法控制的外部代码传递的参数时，您的代码的直接层需要运行偏执级别的检查并根据其与外部世界的通信合同返回错误。然后，深入到没有暴露在外部的代码层，坚持契约式编程仍然更有意义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T15:09:42.637

我会尽你所能检查一切，你永远不知道什么时候会发生你没有想到的事情。（而且它比抱歉更安全）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:32:09.757

I'd consider the answer to be "yes, do the check again" because:-

*   The private member could be reused again in the future from a different path through the code, so program defensively against that situation.
*   If you perform unit tests on private methods

My view might change if I had a static analyser that could pick this up and not flag the potential use of a null reference in the private method.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T16:05:05.147

这取决于空值是否指示方法的错误。请记住，方法也可以称为对象的消息；它们也对对象的状态进行操作。参数可以专门化发送的消息类型。

*   如果 publicMethod() 不使用参数并在 privateMethod() 使用参数时改变实例的状态，不要认为它在 publicMethod 中是错误的，而是在 privateMethod() 中做。
*   如果 publicMethod() 没有改变状态，则认为这是一个错误。

您可以将后一种情况视为为对象的内部功能提供接口。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T17:15:06.597

如果使用已经验证的输入频繁调用 PrivateMethod，并且很少使用用户输入，那么我将使用 PublicMethod/PrivateMethod 概念，不对 PrivateMethod 进行错误检查（并且 PublicMethod 除了检查参数和调用 PrivateMethod)

我还将私有方法称为 PublicMethod_impl （用于“实现”），因此很明显它是内部使用/无检查方法。

我坚持认为这种设计会导致*更*强大的应用程序，因为它迫使您考虑何时检查什么。经常检查参数的人经常陷入“我检查了一些东西，所以我检查了一切”的陷阱。

例如，一位前同事（用 C 语言编程）在使用指针之前总是检查它是否为空。一般来说，他的代码中的指针被初始化为启动并且从未改变过，因此它为空的可能性非常低。此外，指针有一个正确值和 65535 个可能的错误值，而他只是检查其中一个错误值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T14:49:56.407

至少要注释一下 PrivateMethod 必须有一个非空的 FooBar 并且 PublicMethod 会检查这个。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T14:54:38.177

您可能还想将“私有”方法标记为私有或受保护。

# javascript - 打破 JavaScript 中嵌套循环的最佳方法是什么？

> ID：183161
> 
> 赞同：562
> 
> 时间：2008-10-08T14:47:25.100
> 
> 标签：javascript, loops, nested-loops, break

打破 Javascript 中的嵌套循环的最佳方法是什么？

```
//Write the links to the page.
for (var x = 0; x < Args.length; x++)
{
   for (var Heading in Navigation.Headings)
   {
      for (var Item in Navigation.Headings[Heading])
      {
         if (Args[x] == Navigation.Headings[Heading][Item].Name)
         {
            document.write("<a href=\"" 
               + Navigation.Headings[Heading][Item].URL + "\">" 
               + Navigation.Headings[Heading][Item].Name + "</a> : ");
            break; // <---HERE, I need to break out of two loops.
         }
      }
   }
} 
```

* * *

## 回答 #1

> 赞同：1282
> 
> 时间：2008-10-08T14:53:40.720

就像 Perl，

```
loop1:
    for (var i in set1) {
loop2:
        for (var j in set2) {
loop3:
            for (var k in set3) {
                break loop2;  // breaks out of loop3 and loop2
            }
        }
    } 
```

如 EMCA-262 第 12.12 节所定义。[[MDN 文档]](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/label)

与 C 不同，这些标签只能用于[`continue`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/continue)and [`break`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/break)，因为 Javascript 没有`goto`。

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2008-10-08T14:48:12.837

将其包装在一个函数中，然后`return`.

* * *

## 回答 #3

> 赞同：98
> 
> 时间：2009-04-07T22:11:59.637

我参加聚会有点晚了，但以下是一种与语言无关的方法，它不使用 GOTO/labels 或函数包装：

```
for (var x = Set1.length; x > 0; x--)
{
   for (var y = Set2.length; y > 0; y--)
   {
      for (var z = Set3.length; z > 0; z--)
      {
          z = y = -1; // terminates second loop
          // z = y = x = -1; // terminate first loop
      }
   }
} 
```

从好的方面来说，它会自然流动，这应该会取悦非 GOTO 人群。不利的一面是，内部循环需要在终止之前完成当前迭代，因此它可能不适用于某些场景。

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2013-11-01T19:33:54.677

我意识到这是一个非常古老的话题，但由于我的标准方法还没有出现，我想我把它发布给未来的谷歌人。

```
var a, b, abort = false;
for (a = 0; a < 10 && !abort; a++) {
    for (b = 0; b < 10 && !abort; b++) {
        if (condition) {
            doSomeThing();
            abort = true;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2009-07-16T15:22:31.843

非常简单：

```
var a = [1, 2, 3];
var b = [4, 5, 6];
var breakCheck1 = false;

for (var i in a) {
    for (var j in b) {
        breakCheck1 = true;
        break;
    }
    if (breakCheck1) break;
} 
```

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2008-10-08T19:42:23.413

```
var str = "";
for (var x = 0; x < 3; x++) {
    (function() {  // here's an anonymous function
        for (var y = 0; y < 3; y++) {
            for (var z = 0; z < 3; z++) {
                // you have access to 'x' because of closures
                str += "x=" + x + "  y=" + y + "  z=" + z + "<br />";
                if (x == z && z == 2) {
                    return;
                }
            }
        }
    })();  // here, you execute your anonymous function
} 
```

怎么样？:)

* * *

## 回答 #7

> 赞同：41
> 
> 时间：2018-12-30T22:25:24.023

以下是在 JavaScript 中打破嵌套循环的五种方法：

**1) 将 parent(s) 循环设置到末尾**

```
for (i = 0; i < 5; i++)
{
    for (j = 0; j < 5; j++)
    {
        if (j === 2)
        {
            i = 5;
            break;
        }
    }
} 
```

**2) 使用标签**

```
exit_loops:
for (i = 0; i < 5; i++)
{
    for (j = 0; j < 5; j++)
    {
        if (j === 2)
            break exit_loops;
    }
} 
```

**3）使用变量**

```
var exit_loops = false;
for (i = 0; i < 5; i++)
{
    for (j = 0; j < 5; j++)
    {
        if (j === 2)
        {
            exit_loops = true;
            break;
        }
    }
    if (exit_loops)
        break;
} 
```

**4) 使用自执行功能**

```
(function()
{
    for (i = 0; i < 5; i++)
    {
        for (j = 0; j < 5; j++)
        {
             if (j === 2)
                 return;
        }
    }
})(); 
```

**5）使用常规功能**

```
function nested_loops()
{
    for (i = 0; i < 5; i++)
    {
        for (j = 0; j < 5; j++)
        {
             if (j === 2)
                 return;
        }
    }
}
nested_loops(); 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2015-05-11T01:33:57.033

完全不使用中断，不使用中止标志，也不使用额外的条件检查怎么样。`Number.MAX_VALUE`这个版本只是在满足条件时爆破循环变量（使它们成为）并强制所有循环优雅地终止。

```
// No breaks needed
for (var i = 0; i < 10; i++) {
  for (var j = 0; j < 10; j++) {
    if (condition) {
      console.log("condition met");
      i = j = Number.MAX_VALUE; // Blast the loop variables
    }
  }
} 
```

对于递减类型的嵌套循环有一个类似的答案，但这适用于递增类型的嵌套循环，而无需考虑简单循环的每个循环的终止值。

另一个例子：

```
// No breaks needed
for (var i = 0; i < 89; i++) {
  for (var j = 0; j < 1002; j++) {
    for (var k = 0; k < 16; k++) {
      for (var l = 0; l < 2382; l++) {
        if (condition) {
          console.log("condition met");
          i = j = k = l = Number.MAX_VALUE; // Blast the loop variables
        }
      }
    }
  }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-08-10T20:46:35.960

如果您使用 Coffeescript，有一个方便的“do”关键字可以更轻松地定义和立即执行匿名函数：

```
do ->
  for a in first_loop
    for b in second_loop
      if condition(...)
        return 
```

...所以你可以简单地使用“return”来摆脱循环。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-09-26T10:58:40.750

如何将循环推到极限

```
 for(var a=0; a<data_a.length; a++){
       for(var b=0; b<data_b.length; b++){
           for(var c=0; c<data_c.length; c++){
              for(var d=0; d<data_d.length; d++){
                 a =  data_a.length;
                 b =  data_b.length;
                 c =  data_b.length;
                 d =  data_d.length;
            }
         }
       }
     } 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-08-24T18:36:27.847

我想我会展示一种函数式编程方法。你可以打破嵌套的 Array.prototype.some() 和/或 Array.prototype.every() 函数，就像我的解决方案一样。这种方法的另一个好处是`Object.keys()`仅枚举对象自己的可枚举属性，而 [“for-in 循环也枚举原型链中的属性”](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys)。

接近 OP 的解决方案：

```
 Args.forEach(function (arg) {
        // This guard is not necessary,
        // since writing an empty string to document would not change it.
        if (!getAnchorTag(arg))
            return;

        document.write(getAnchorTag(arg));
    });

    function getAnchorTag (name) {
        var res = '';

        Object.keys(Navigation.Headings).some(function (Heading) {
            return Object.keys(Navigation.Headings[Heading]).some(function (Item) {
                if (name == Navigation.Headings[Heading][Item].Name) {
                    res = ("<a href=\""
                                 + Navigation.Headings[Heading][Item].URL + "\">"
                                 + Navigation.Headings[Heading][Item].Name + "</a> : ");
                    return true;
                }
            });
        });

        return res;
    } 
```

减少对标题/项目的迭代的解决方案：

```
 var remainingArgs = Args.slice(0);

    Object.keys(Navigation.Headings).some(function (Heading) {
        return Object.keys(Navigation.Headings[Heading]).some(function (Item) {
            var i = remainingArgs.indexOf(Navigation.Headings[Heading][Item].Name);

            if (i === -1)
                return;

            document.write("<a href=\""
                                         + Navigation.Headings[Heading][Item].URL + "\">"
                                         + Navigation.Headings[Heading][Item].Name + "</a> : ");
            remainingArgs.splice(i, 1);

            if (remainingArgs.length === 0)
                return true;
            }
        });
    }); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-12-14T07:19:12.217

**swilliams**之前已经提到过，但下面有一个示例（Javascript）：

```
// Function wrapping inner for loop
function CriteriaMatch(record, criteria) {
  for (var k in criteria) {
    if (!(k in record))
      return false;

    if (record[k] != criteria[k])
      return false;
  }

  return true;
}

// Outer for loop implementing continue if inner for loop returns false
var result = [];

for (var i = 0; i < _table.length; i++) {
  var r = _table[i];

  if (!CriteriaMatch(r[i], criteria))
    continue;

  result.add(r);
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-06-19T16:26:16.920

嗯，嗨到 10 岁派对？

为什么不在你的 for 中设置一些条件？

```
var condition = true
for (var i = 0 ; i < Args.length && condition ; i++) {
    for (var j = 0 ; j < Args[i].length && condition ; j++) {
        if (Args[i].obj[j] == "[condition]") {
            condition = false
        }
    }
} 
```

像这样你想停就停

在我的情况下，使用 Typescript，我们可以使用 some() 遍历数组并在满足条件时停止所以我的代码变成这样：

```
Args.some((listObj) => {
    return listObj.some((obj) => {
        return !(obj == "[condition]")
    })
}) 
```

像这样，满足条件后循环立即停止

**提醒：此代码在 TypeScript 中运行**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-01-07T02:10:43.550

上面有很多优秀的解决方案。IMO，如果您的中断条件是异常的，您可以使用 try-catch：

```
try{  
    for (var i in set1) {
        for (var j in set2) {
            for (var k in set3) {
                throw error;
            }
        }
    }
}catch (error) {

} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-09-23T12:30:04.547

分配处于比较条件的值

```
function test(){
    for(var i=0;i<10;i++)
    {
            for(var j=0;j<10;j++)
            {
                    if(somecondition)
                    {
                            //code to Break out of both loops here
                            i=10;
                            j=10;
                    }

            }
    }

    //Continue from here 
```

}

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2012-07-12T22:16:16.467

```
XXX.Validation = function() {
    var ok = false;
loop:
    do {
        for (...) {
            while (...) {
                if (...) {
                    break loop; // Exist the outermost do-while loop
                }
                if (...) {
                    continue; // skips current iteration in the while loop
                }
            }
        }
        if (...) {
            break loop;
        }
        if (...) {
            break loop;
        }
        if (...) {
            break loop;
        }
        if (...) {
            break loop;
        }
        ok = true;
        break;
    } while(true);
    CleanupAndCallbackBeforeReturning(ok);
    return ok;
}; 
```

* * *

## 回答 #17

> 赞同：-5
> 
> 时间：2016-06-23T17:59:58.490

最好的方法是 -
1）对第一个和第二个循环中使用的两个数组进行排序。
2）如果项目匹配，则打破内部循环并保持索引值。
3）当开始下一次迭代时，以保持索引值开始内循环。

# asp.net - 如何在回发之前淡出一行

> ID：183179
> 
> 赞同：0
> 
> 时间：2008-10-08T14:50:10.213
> 
> 标签：asp.net, ajax, .net-2.0

我有一个在 ASP.Net 的 DataList 中创建的表。此表包含三个文本字段，然后是一个带有编辑按钮的字段和一个带有删除按钮的字段。当一个人单击删除按钮时，它会回发，删除项目，然后再次绑定 DataList。DataList 位于 UpdatePanel 中，因此该项目会在半秒或更长时间后顺利消失，但我真正想要的是当他们按下删除按钮时该行滑出（向上），并且然后让它删除帖子上的项目。

我可以使用 jQuery 使行滑出，但回发会妨碍。你怎么处理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T15:13:25.457

您可以使用asp.net 中的[页面方法](http://www.singingeels.com/Articles/Using_Page_Methods_in_ASPNET_AJAX.aspx)向服务器发送请求，而无需进行回发。它们使用起来非常简单，当 ajax 调用完成时，你可以做任何你喜欢的效果（你会得到一个成功调用的函数）。

如果您想坚持回发，则一种解决方案如下：

```
<asp:Button id="myButton" OnClientClick="return fadeThenAllowSubmit()" ... /> 
```

在js中是这样的：

```
var allowSubmit = false;
function fadeThenAllowSubmit() {
    if (allowSubmit) return true
    // do the jquery stuff that will be completed in, let's say, 1000ms
    setTimeout(function() {
        allowSubmit = true
        $("input[id$=myButton]").click()
        allowSubmit = false
    }, 1000)
    return false
} 
```

这有点像 hack，想法是最初取消回发，做一些事情然后设置一个计时器来启用回发。这种方法的最大问题是淡入淡出效果和实际删除是独立的（如果出现错误，您仍然可以获得淡入淡出效果）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T14:58:14.907

您是否尝试过查看任何 Ajax 控件工具包项目？如果您不是非常熟悉，我相信那里有一些控件将与客户端（java）代码一起使用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:00:15.123

我会使用客户端 Javascript 手动将“不透明度”CSS 属性缩小为零，然后将元素标记为“显示：无”，然后提交回发。

我相信在 Internet Explorer 中，您需要使用“过滤器”CSS 属性来执行此操作，因为它不支持不透明度。

您可以编写一个例程来设置这两个属性，并且应该涵盖所有主要浏览器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:02:34.853

注册表单“提交”事件的处理程序。

```
$("form").submit(function() {

    // if user initiated delete action 
    // do your thing with deleted row (effects, etc.)

    // after you're done with it, submit the form from script
    // (you can queue the submission after the effect)
    // the submission from the script won't trigger this event handler

    return false; // prevent submission
} 
```

防止表单提交对于避免干扰您想要执行的效果是必要的。完成后，您可以自由地继续提交。

# hibernate - 用户类型加入休眠

> ID：183185
> 
> 赞同：2
> 
> 时间：2008-10-08T14:51:04.797
> 
> 标签：hibernate, orm

在这种情况下，是否有可能让 hibernate 为某些“正确”的价值做“正确的事情”？

```
from ClassA a, ClassB b
where a.prop = b.prop 
```

问题是 prop 是一个在连接表中具有不同表示形式的 UserType。在表 A 中，它表示为整数，在表 B 中，它表示为 char。因此 eq 测试转换为查看 1 == 'a' 或多或少，这是错误的，但由 1 或 'a' 表示的对象应该是相同的，因此它们应该比较为真。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T19:56:10.247

我认为您可以使用`<formula>`映射文件中关系上的标签来执行此操作。

例如：

```
<many-to-one name="myClassB" class="ClassB">
  <formula>--Some SQL Expression that converts between ClassA.prop and ClassB.prop</formula>
</many-to-one> 
```

我用它来关联两个表，其中一个使用整数，但将其关联到另一个表中的 char 字段。这可能不是您正在寻找的东西，但也许它会让您走上正确的轨道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T17:41:28.573

使用 SQL 表达式进行连接。这样您就可以在查询本身中显式地进行类型转换。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-08T15:40:04.777

(1) 将映射到“prop”的列的数据类型更改为相同。这将需要“让 DBA 成为你的朋友”，但会导致一致的“道具”用户类型使用。

(2)处理equals()方法中的类型差异

```
public boolean equals(Object x, Object y) throws HibernateException {
    boolean retValue = false;
    if (x == y) retValue = true;

    if (x!=null && y!=null){
        Character xChar = new Character(x);
        Character yChar = new Character(y);
        if (xChar.equals(ychar)){
            retValue = true;
        }
    }

    return retValue;
} 
```

# c - C 包装器在命令“ps”上删除用户

> ID：183190
> 
> 赞同：0
> 
> 时间：2008-10-08T14:51:23.220
> 
> 标签：c, linux, apache, console

我有一个问题，也许这里有人可以帮助我。如果我在 linux 控制台上执行“ps aux --sort user”，我有一个用户列表及其在机器上运行的进程。我的问题是如何删除用户名并**在 C 程序**中像这样打印该列表：

例如：

```
(…)
--------------------------------------------------------------------------
user: APACHE
--------------------------------------------------------------------------
3169 0.0 1.2 39752 12352 ? S 04:10 0:00 /usr/sbin/httpd
--------------------------------------------------------------------------
user: VASCO
--------------------------------------------------------------------------
23030 0.0 0.1 4648 1536 pts/1 Ss 20:02 0:00 –bash

(…) 
```

我打印用户名，然后打印他的流程......有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T14:54:18.287

```
ps aux --sort user | perl -npe 's/^(\w+)//g; if ($user ne $1) {$user=$1; print "user: " . uc($user) . "\n";}' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T14:36:44.013

你有很多选择，具体取决于你想在 C 中做多少。

最简单的是使用 system() 运行一个 shell 命令（比如我之前发布的那个）来完成所有工作。system() 实际上会生成一个 shell，因此重定向之类的操作都将像在命令行中一样工作。

如果你想避免使用 system() 你可以自己做，产生两个进程并将它们链接在一起。查找 pipe() 和 dup2()。大概是在浪费时间。

您可以运行 ps 程序并在 C 中解析其输出。 pipe() 和 dup2() 再次相关。对于实际的解析，我只是使用普通的 C 字符串处理例程来完成，因为它非常简单。显然，您可以改用正则表达式库，但我认为在这种情况下，它会导致比没有它更复杂的代码。

当然，您可以通过查看 /proc 中的文件在 C 中完成所有工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T16:03:29.083

这应该有效：

```
ps haux --sort user | perl -npe 's/^(\S+)\s+//; if ($user ne $1) {$user=$1; print "user: " . uc($user) . "\n";}' 
```

基于 bmdhacks 的回答，但有以下修复：

a）它将任何非空格计为用户名的一部分，b）它删除用户名之后的任何空格，就像您的示例输出一样，否则事情不会排列起来 c）我必须删除 g 才能得到它去工作。我认为因为 g 它可能会匹配很多次，所以 perl 没有设置 $1 因为它可能是模棱两可的。d) 将 h 添加到 ps 命令中，使其不输出标题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:53:39.040

不是您问题的真正答案，但用户名在 unix 中区分大小写，因此将它们全部大写可能不是一个好主意。如果你想让它们在视觉上脱颖而出，那么“USER: apache”会更好。

除此之外，bmdhacks 的回答很好（但不太正确）。你可以在 awk 中做类似的事情，但它会更复杂。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T10:45:19.660

I solved my problem by redirecting the stdout put and editing it.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T14:43:07.903

在 C 程序中使用 popen 并操作重定向的标准输出字符串

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T10:40:09.873

这是 linux 的命令行来实现我所说的......但这不是我想要的......我想在一些 C 程序中实现它......我必须编写 C 程序来实现它......所以我使用 fork () 创建一个执行 ps aux --sort user... 的进程，然后我想用另一个进程来控制进程和用户的打印... 对不起，如果我解释我的问题 rong。

我要运行的命令是这样的： ps aux --sort user | sort_by_user ...此选项 sort_by_user 不存在。使用命令 fork() 和 execlp() 在 C 中创建一些进程以运行该命令很简单，但在 C 中为该命令创建一些选项我没有任何想法。

# ruby-on-rails - Ruby rufus 调度程序 gem

> ID：183191
> 
> 赞同：2
> 
> 时间：2008-10-08T14:51:27.183
> 
> 标签：ruby-on-rails, ruby, scheduling

我们正在考虑在 Ruby on Rails 项目中使用 rufus-scheduler gem 来定期监控通信队列。有没有人有在 Rails 项目中使用这个 gem 的经验？有人对替代调度程序有强烈的偏好吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T23:34:42.993

我发现 cron 和 script/runner 通常就足够了，但我认为 rufus-scheduler 不会真的出错。

只要确保您正在运行的计划任务已经足够抽象，这样如果您以后决定改变对这些任务的运行方式的想法，这不是一个大问题。

如果你喜欢，我说实验并运行它。

# performance - 开发人员应该首先关注可读性还是性能？

> ID：183201
> 
> 赞同：96
> 
> 时间：2008-10-08T14:54:32.717
> 
> 标签：performance, readability

开发人员通常会面临两种解决问题的可能方法之间的选择——一种是惯用且易读的，另一种不太直观，但性能可能更好。例如，在基于 C 的语言中，有两种方法可以将数字乘以 2：

```
int SimpleMultiplyBy2(int x)
{
    return x * 2; 
} 
```

和

```
int FastMultiplyBy2(int x)
{
    return x << 1;
} 
```

对于技术和非技术读者来说，第一个版本更容易上手，但第二个版本可能表现更好，因为位移比乘法更简单。（现在，让我们假设编译器的优化器不会检测到这一点并对其进行优化，尽管这也是一个考虑因素）。

作为开发人员，最初的尝试哪个更好？

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-10-08T18:45:56.010

你错过了一个。

第一个代码是为了正确，然后是为了清楚起见（当然，这两者通常是相连的！）。最后，只有当你有真正需要的真实经验证据时，你才能考虑优化。过早的优化确实是邪恶的。优化几乎总是会花费您的时间、清晰度和可维护性。你最好确保你买的是值得的东西。

请注意，好的算法几乎总能击败本地化调优。您没有理由不能拥有正确、清晰和快速的代码。你会非常幸运地开始专注于“快速”。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-10-08T14:56:38.560

IMO 首先是明显的可读版本，直到测量性能并需要更快的版本。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-10-08T14:59:26.823

[从唐·克努特](http://en.wikiquote.org/wiki/Donald_Knuth)那里拿走

> 过早的优化是编程中万恶（或至少是大部分）的根源。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-08T14:57:34.287

可读性 100%

如果你的编译器不能为你做 "x*2" => "x <<1" 优化——换一个新的编译器！

还要记住，您的程序 99.9% 的时间都花在等待用户输入、等待数据库查询和等待网络响应上。除非您进行 20 亿次以上的操作，否则它不会引起注意。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-08T15:00:56.913

可读性肯定。除非有人抱怨，否则不要担心速度

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-08T14:58:40.197

在您给定的示例中，99.9999% 的编译器将为这两种情况生成相同的代码。这说明了我的一般规则 - 首先编写可读性和可维护性，并仅在需要时进行优化。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-08T17:12:18.100

可读性。

性能编码有它自己的一系列挑战。Joseph M. Newcomer 说[得好](http://www.codeproject.com/KB/tips/optimizationenemy.aspx)

> 优化只有在重要时才重要。当它很重要时，它很重要，但在你知道它很重要之前，不要浪费很多时间去做。即使你知道它很重要，你也需要知道它在哪里重要。如果没有性能数据，您将不知道要优化什么，并且您可能会优化错误的东西。
> 
> 结果将是晦涩难懂、难以编写、难以调试和难以维护无法解决问题的代码。因此，它具有（a）增加软件开发和软件维护成本，以及（b）根本没有性能影响的双重缺点。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-08T14:57:01.913

可读性。优化的时间是您进行 Beta 测试的时候。否则你永远不会真正知道你需要花时间做什么。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-08T14:57:23.270

我会首先考虑**可读性**。考虑到当今我们拥有的那种优化的语言和负载巨大的机器，我们以可读方式编写的大多数代码都会表现得不错。

在一些非常罕见的情况下，您很确定自己会遇到一些性能瓶颈（可能来自过去的一些糟糕经历），并且您设法找到了一些可以为您带来巨大性能优势的奇怪技巧，您可以选择那。但是您应该很好地注释该代码片段，这将有助于使其更具可读性。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-08T15:00:25.450

在这场辩论中，一个经常被忽视的因素是程序员导航、理解和修改可读性较差的代码所花费的额外时间。考虑到程序员的时间每小时花费一百美元或更多，这是一个非常实际的成本。
这种直接的额外开发成本抵消了任何性能提升。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-08T15:09:38.317

在此处添加带有解释的评论将使其可读且快速。

这实际上取决于项目的类型，以及性能的重要性。如果您正在构建一个 3D 游戏，那么通常会有很多常见的优化需要在此过程中投入其中，而且没有理由不这样做（只是不要过早得意忘形）。但是，如果您正在做一些棘手的事情，请对其发表评论，以便任何看到它的人都会知道您如何以及为什么会变得棘手。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-08T15:19:04.087

答案取决于上下文。例如，在设备驱动程序编程或游戏开发中，第二种形式是可接受的习语。在业务应用程序中，没有那么多。

最好的办法是查看代码（或类似的*成功*应用程序）以检查其他开发人员是如何做到的。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-08T15:26:45.287

两个都。您的代码应该平衡两者；可读性和性能。因为忽略其中任何一个都会影响项目的投资回报率，归根结底，这对你的老板来说才是最重要的。

可读性差会导致可维护性降低，从而导致在维护上花费更多资源，从而降低投资回报率。

糟糕的表现会导致投资和客户群减少，从而导致投资回报率降低。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-08T15:33:52.170

使用 << 将通过微优化。所以 Hoare 的（不是 Knuts）规则：

[过早的优化](http://en.wikiquote.org/wiki/C._A._R._Hoare)是万恶之源。

适用，您应该首先使用更具可读性的版本。

恕我直言，这是规则经常被误用作设计永远无法扩展或性能良好的软件的借口。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-08T14:59:46.667

代码库越大，可读性越重要。试图理解一些微小的功能并不是那么糟糕。（特别是因为示例中的方法名称为您提供了线索。）对于刚刚放弃编码的孤独天才编写的一些史诗般的超级代码并不是那么好，因为他终于看到了他能力的复杂性，而这正是他刚刚所做的为你写的，你永远不会明白。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-08T15:30:51.940

如果您担心代码的可读性，请不要犹豫，添加注释以提醒自己这样做的内容和原因。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-01-18T08:12:50.373

如果没有可读性，当你真正需要它时，将很难获得性能提升。

只有当你的程序出现问题时才应该提高性能，有很多地方会是瓶颈而不是这种语法。假设您在 << 上压缩了 1ns 的改进，但忽略了 10 分钟的 IO 时间。

此外，关于可读性，专业程序员应该能够阅读/理解计算机科学术语。例如，我们可以将方法命名为 enqueue 而不必说 putThisJobInWorkQueue。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-08T15:24:17.977

位移与乘法是一种微不足道的优化，几乎没有**任何****收获**。而且，正如已经指出的那样，您的编译器应该为您执行此操作。除此之外，增益是可以忽略的，就像运行这条指令的 CPU 一样。

 **另一方面，如果您需要执行严格的计算，您将需要正确的数据结构。但是，如果您的问题很复杂，那么找出答案就是解决方案的一部分。**例如，考虑在 1000000 个未排序对象的数组中搜索 ID 号。然后重新考虑使用二叉树或哈希图。**

但是像 n << C 这样的优化通常可以忽略不计，并且在任何时候都可以轻松更改。使代码可读不是。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-08T15:26:26.740

这取决于需要解决的任务。通常可读性更重要，但是当你首先要考虑性能时，仍然有一些任务。而且你不能在一切正常之后只花一天时间进行分析和优化，因为优化本身可能需要从头开始重写代码的足够部分。但现在并不常见。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-08T16:34:33.840

**您应该始终最大限度地优化，性能始终很重要。** 我们今天有英国媒体报道软件的原因是大多数程序员不想做优化工作。

话虽如此，您始终可以将注释放在需要澄清的巧妙编码中。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-10-08T22:01:07.113

如果你不知道你的瓶颈，那么优化是没有意义的。你可能已经让一个函数变得难以置信的高效（通常以某种程度的可读性为代价）只是发现那部分代码几乎没有运行过，或者它花费更多的时间访问磁盘或数据库，而不是你保存的小玩意。所以在你有一些东西要测量之前你不能进行微优化，然后你最好从可读性开始。但是，在设计整体架构时，您应该注意速度和可理解性，因为两者都会产生巨大的影响并且难以更改（取决于编码风格和方法）。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-09T03:35:13.320

据估计，大约 70% 的软件成本用于维护。可读性使系统更易于维护，因此降低了软件在其生命周期内的成本。

在某些情况下，性能比可读性更重要，也就是说它们很少见。

在牺牲可读性之前，想一想“我（或您的公司）是否准备好通过这样做来处理我添加到系统中的额外成本？”

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-13T08:30:37.907

我不在谷歌工作，所以我会选择邪恶的选择。（优化）

在 Jon Bentley 的“Programming Pearls”的第 6 章中，他描述了一个系统如何通过在 6 个不同的设计级别进行优化来实现 400 倍的加速。我相信，通过不关心这 6 个设计级别的性能，现代实现者可以轻松地在他们的程序中实现 2-3 个数量级的减速。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-10-13T08:55:42.130

正如几乎每个人在回答中所说的那样，我赞成**可读性**。我运行的 100 个项目中有 99 个没有严格的响应时间要求，因此这是一个简单的选择。

在开始编码之前，您应该已经知道答案。有些项目有一定的性能要求，比如“需要能够在 Y（毫秒）秒内运行任务 X”。如果是这种情况，您就有了一个要努力的目标，并且您知道何时必须进行优化。（希望）这是在项目的需求阶段确定的，而不是在编写代码时确定的。

良好的可读性和后期优化的能力是正确软件设计的结果。如果您的软件设计合理，您应该能够隔离软件的某些部分并在需要时重写它们，而不会破坏系统的其他部分。此外，我遇到的大多数真正的优化案例（忽略一些真正的低级技巧，这些都是偶然的）都是从一种算法更改为另一种算法，或者将数据缓存到内存而不是磁盘/网络。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-10-24T19:58:48.183

可读性是首要目标。

在 1970 年代，军队测试了一些当时的“新”软件开发技术（自顶向下设计、结构化编程、首席程序员团队等），以确定其中哪些技术产生了统计学上的显着差异。

唯一在发展方面产生统计学显着差异的技术是……

在程序代码中添加空白行。

那些预结构化的、预面向对象的代码中可读性的提高是这些研究中提高生产力的唯一技术。

===============

只有在整个项目经过单元测试并准备好进行检测时，才应该进行优化。你永远不知道你需要在哪里优化代码。

在 1970 年代后期 Kernigan 和 Plauger 的里程碑式著作 SOFTWARE TOOLS (1976) 和 SOFTWARE TOOLS IN PASCAL (1981) 中，展示了使用自顶向下设计创建结构化程序的方法。他们创建了文本处理程序：编辑器、搜索工具、代码预处理器。

当完成的文本格式化函数被 INSTRUMENTED 时，他们发现大部分处理时间都花在了执行文本输入和输出的三个例程中（在原书中，io 函数占用了 89% 的时间。在 pascal 书中，这些函数消耗了 55%！）

他们能够优化这三个例程，并以合理、可管理的开发时间和成本产生提高性能的结果。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-11-04T22:48:18.697

可读性第一。但比可读性更重要的是简单性，*尤其是*在数据结构方面。

我想起了一个做视觉分析程序的学生，他不明白为什么它这么慢。他只是遵循良好的编程习惯——每个像素都是一个对象，它通过向其邻居发送消息来工作......

看一下这个

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-10-08T15:11:12.697

首先写可读性，但希望读者是*程序员*。任何称职的程序员都应该知道乘法和位移之间的区别，或者能够阅读适当使用的三元运算符，能够查找并理解复杂的算法（您在评论您的代码对吗？ ）， ETC。

当然，早期的过度优化很不利于在以后需要重构时给您带来麻烦，但这并不真正适用于单个方法、代码块或语句的优化。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-10-08T15:35:55.440

我想说的是可读性。

但是在给定的示例中，我认为第二个版本已经足够可读了，因为函数的名称准确地说明了函数中发生了什么。

如果我们总是有功能告诉我们，他们做什么......

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-08T15:43:14.723

一个小时的处理器时间成本是多少？

一个小时的程序员时间成本是多少？

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-10-08T16:16:41.550

恕我直言，这两件事都无关紧要。您应该首先选择有效的代码，因为这比性能或阅读效果更重要。关于可读性：您的代码在任何情况下都应该始终是可读的。

但是，我看不出为什么代码无法读取并同时提供良好的性能。在您的示例中，第二个版本对我来说与第一个版本一样可读。什么是可读性较差的？如果程序员不知道左移与乘以 2 的幂相同，而右移与除以 2 的幂相同……那么，与一般可读性相比，您遇到的基本问题要多得多。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-10-08T19:52:02.600

优先级必须是可读性。然后是性能，如果它得到很好的评论，以便维护人员知道为什么某些东西不标准。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-10-08T22:41:18.640

大多数时候，我同意世界上大多数人的观点，即可读性**更为**重要。计算机比您想象的要快，而且只会越来越快，编译器会为您进行微优化，一旦您发现瓶颈在哪里，您就可以稍后对其进行优化。

但另一方面，有时，例如，如果您正在编写一个小程序，该程序将执行一些严重的数字运算或其他非交互式、计算密集型任务，您可能必须做出一些具有性能目标的高级设计决策心里。如果您稍后在这些情况下尝试优化慢速部分，您基本上最终会重写大部分代码。例如，您可以尝试将事物很好地封装在小类中，等等，但如果性能是一个非常高的优先级，您可能不得不满足于一个不那么好的设计，例如，不执行尽可能多的内存分配.

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-10-08T23:27:05.927

可读性。它将允许其他人（或以后的您自己）确定您要完成的工作。如果您后来发现确实需要担心性能，可读性将帮助您实现性能。

我还认为，通过专注于可读性，您实际上会得到更简单的代码，这很可能比更复杂的代码实现更好的性能。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-10-08T23:48:02.920

“性能永远重要”是不正确的。如果您受 I/O 限制，则乘法速度无关紧要。

有人说“我们今天有膨胀软件的原因是大多数程序员不想做优化工作”，这当然是真的。我们有编译器来处理这些事情。

如今，任何编译器都将转换`x*2`为`x<<1`.，如果它适合该架构的话。这是编译器比程序员更聪明的情况。

* * *

## 回答 #35

> 赞同：-4
> 
> 时间：2013-01-12T17:01:07.563

如果你要发布你的软件，你必须关心结果，而不是过程。

用户不会阅读您的代码，他们会使用您的软件，并且他们不想因不必要的长时间等待而感到沮丧。如果您的缩进并正确注释的应用程序运行缓慢或占用大量内存，他们会讨厌您。

简而言之，考虑用户，而不是你自己，所以更喜欢性能而不是可读性。

该规则的最佳示例之一是 Quake 视频游戏。它的代码结构不佳，通常难以阅读，但它可以在 1995-1996 年的 PC 上以非常高的帧速率渲染数千个多边形。如果 Carmack 更喜欢可读性而不是性能，那么 Quake 和许多其他视频游戏，包括《使命召唤》（源自 Quake 3 引擎）就不会存在。

# c++ - 如何在非托管 C++ 中捕获托管异常（来自委托）？

> ID：183209
> 
> 赞同：5
> 
> 时间：2008-10-08T14:55:34.790
> 
> 标签：c++, .net, exception, delegates, managed-c++

我有非托管 C++ 通过 Marshal::GetFunctionPointerForDelegate 提供的函数指针调用托管委托。该委托有可能引发异常。我需要能够在我的非托管 C++ 中正确处理此异常，以确保诸如指针清理之类的事情，并可能将异常重新抛出到更多托管代码中。调用堆栈类似于：

托管代码 -> 非托管 C++ -> 通过委托回调托管代码（此处可以抛出异常）。

任何人都有正确处理这种情况的指针，以便可以清理非托管代码中的资源，并且可以向启动整个调用堆栈的托管代码抛出可用异常？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T14:59:51.643

从托管代码中捕获

```
try
{
  throw gcnew InvalidOperationException();
}
catch(InvalidOperationException^ e)
{
  // Process e
  throw;
} 
```

和

```
[assembly:RuntimeCompatibility(WrapNonExceptionThrows = true)]; 
```

在您的程序集上捕获托管和非托管异常

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-10T17:32:53.217

甚至不要远程尝试让“非托管”代码意识到它必须处理 .NET 的事实。

从您的回调中返回一个非零值以表示存在错误。提供描述错误的（线程本地）全局字符串对象，以便您可以为用户检索有用的错误消息。

这可能涉及将您的委托包装到场景下的另一个函数中，该函数将捕获所有异常并返回错误代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:08:51.440

一种方法是使用 SEH，并在继续异常传播之前在异常过滤器中进行清理。但我不确定这是否过度合法，因为你会在过滤器中做很多工作。您也不会对正在传播的托管异常一无所知。

另一种方法是用您自己的托管函数包装托管委托，该托管函数捕获异常，然后引发非托管异常......然后您可以在非托管代码中捕获该异常。

当非托管代码完成清理后，使用另一个辅助托管函数重新抛出原始托管异常

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-10T17:38:03.167

与 C++ 不同，托管代码将异常表示为硬件异常。你可以使用 SEH。请记住，您总是有机会运行异常过滤器。

[http://msdn.microsoft.com/en-us/library/ms680657(v=VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms680657(v=VS.85).aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-08-15T05:30:43.347

有人告诉我...{如果变量 a&b 未在作用域过程中声明，则向量无法显示。经过一番挖掘发现循环漏洞如下--- weibull_distribution> unmanaged_code

# javascript - JavaScript 回调范围

> ID：183214
> 
> 赞同：58
> 
> 时间：2008-10-08T14:56:09.187
> 
> 标签：javascript, events, binding, scope, callback

在回调函数中引用我的对象时，我在使用普通的旧 JavaScript（无框架）时遇到了一些麻烦。

```
function foo(id) {
    this.dom = document.getElementById(id);
    this.bar = 5;
    var self = this;
    this.dom.addEventListener("click", self.onclick, false);
}

foo.prototype = {
    onclick : function() {
        this.bar = 7;
    }
}; 
```

现在，当我创建一个新对象时（在 DOM 加载后，使用 span#test）

```
var x = new foo('test'); 
```

onclick 函数中的“this”指向 span#test 而不是 foo 对象。

如何在 onclick 函数中获取对我的 foo 对象的引用？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-11T08:33:30.163

*（提取了一些隐藏在其他答案的评论中的解释）*

问题在于以下行：

```
this.dom.addEventListener("click", self.onclick, false); 
```

在这里，您传递一个函数对象以用作回调。当事件触发时，该函数被调用，但现在它与任何对象（this）都没有关联。

该问题可以通过将函数（及其对象引用）包装在闭包中来解决，如下所示：

```
this.dom.addEventListener(
  "click",
  function(event) {self.onclick(event)},
  false); 
```

因为变量 self 在创建闭包时被赋值，*所以*闭包函数会在以后调用时记住 self 变量的值。

解决这个问题的另一种方法是创建一个实用函数（并避免使用变量来绑定*this*）：

```
function bind(scope, fn) {
    return function () {
        fn.apply(scope, arguments);
    };
} 
```

更新后的代码将如下所示：

```
this.dom.addEventListener("click", bind(this, this.onclick), false); 
```

* * *

[`Function.prototype.bind`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind)是 ECMAScript 5 的一部分并提供相同的功能。所以你可以这样做：

```
this.dom.addEventListener("click", this.onclick.bind(this), false); 
```

对于还不支持 ES5 的浏览器，[MDN 提供了以下 shim](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind)：

```
if (!Function.prototype.bind) {  
  Function.prototype.bind = function (oThis) {  
    if (typeof this !== "function") {  
      // closest thing possible to the ECMAScript 5 internal IsCallable function  
      throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");  
    }  

    var aArgs = Array.prototype.slice.call(arguments, 1),   
        fToBind = this,   
        fNOP = function () {},  
        fBound = function () {  
          return fToBind.apply(this instanceof fNOP  
                                 ? this  
                                 : oThis || window,  
                               aArgs.concat(Array.prototype.slice.call(arguments)));  
        };  

    fNOP.prototype = this.prototype;  
    fBound.prototype = new fNOP();  

    return fBound;  
  };  
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-08T15:00:41.313

```
this.dom.addEventListener("click", function(event) {
    self.onclick(event)
}, false); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-01-14T09:44:27.700

For the **jQuery** users looking for a solution to this problem, you should use [jQuery.proxy](http://api.jquery.com/jQuery.proxy/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-11T09:54:00.813

解释是，`self.onclick`这并不意味着您认为它在 JavaScript 中的含义。它实际上是指`onclick`对象原型中的函数`self`（不以任何方式引用`self`自身）。

JavaScript 只有函数，没有像 C# 那样的委托，所以不可能传递一个方法和它应该作为回调应用的对象。

在回调中调用方法的唯一方法是在回调函数中自己调用它。因为 JavaScript 函数是闭包，所以它们能够访问在创建它们的范围内声明的变量。

```
var obj = ...;
function callback(){ return obj.method() };
something.bind(callback); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-27T17:27:43.767

[此处提供](http://www.mail-archive.com/jquery-en@googlegroups.com/msg82906.html)了对该问题的一个很好的解释（到目前为止，我在理解解决方案时遇到了问题）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T20:57:54.830

我写了这个插件...

我认为这会很有用

[jquery.callback](http://code.google.com/p/jquerycallback/)

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-10-08T15:10:08.177

this 是 JS 最令人困惑的地方之一：“this”变量表示最局部的对象……但函数也是对象，所以“this”指向那里。还有其他微妙的地方，但我不记得全部了。

我通常避免使用“this”，只需定义一个本地“me”变量并使用它。

# sql - 如何处理大型 SQL SERVER 批量插入？

> ID：183231
> 
> 赞同：3
> 
> 时间：2008-10-08T14:58:44.547
> 
> 标签：sql, sql-server, batch-file, insert, out-of-memory

我希望在迁移项目中执行一系列查询。要生成的脚本由分析遗留数据库的工具生成，然后生成脚本以将每个旧实体映射到适当的新记录。这些脚本对于小型实体运行良好，但有些记录有数十万条记录，生成的脚本文件约为 80 MB。

运行这些脚本的最佳方式是什么？

提示中是否有一些处理较大脚本的 SQLCMD？

我还可以将脚本分解为更小的脚本，但我不想执行数百个脚本来执行迁移。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:01:17.443

如果可能，修改导出工具以导出 BULK INSERT 兼容文件。

除此之外，您可以编写一个程序，将插入语句解析为 BULK INSERT 将接受的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:50:46.193

`BULK INSERT`使用[`BCP`传统（非`XML`）或`XML`](http://msdn.microsoft.com/en-us/library/ms191516.aspx). 它是否必须获得一个新的身份并在孩子身上使用它，而您无法摆脱使用，`SET IDENTITY INSERT ON`因为数据库设计已经发生了很大变化？如果是这样，我认为您最好使用 SSIS 或类似方法，并在分配身份后进行合并连接。您还可以使用 SSIS 或 BCP 将数据加载到 SQL 中的临时表中，然后使用常规 SQL（可能在 SQL 任务中的 SSIS 中）[使用该`OUTPUT INTO`功能来捕获身份并在 children 中使用它们](http://www.sqlteam.com/article/using-the-output-clause-to-capture-identity-values-on-multi-row-inserts)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:38:35.700

我一直在从文件选项中查看“BULK INSERT”，但看不到文件格式的任何示例。文件可以混合行格式还是必须始终以 CSV 方式保持一致？我问的原因是我在各种父/子表中都涉及到身份，这就是当前使用每行插入的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:02:53.340

听起来这会`INSERT`为每一行生成一个，这真的会很慢。如果它们也都包含在事务中，那可能会有点慢（尽管行数听起来没有那么大，以至于几乎不可能进行事务 - 就像你持有数百万行一样插入事务）。

您最好查看 ETL（DTS、SSIS、BCP 或 BULK INSERT FROM 或其他工具）来迁移数据，而不是编写每个插入的脚本。

您可以分解脚本并分部分执行（特别是如果目前它使这成为一项大事务），只需使用 PowerShell 或类似工具自动执行各个脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T15:02:59.533

只需执行脚本。我们定期运行大小为 100 兆字节的备份/恢复脚本。只需要30秒左右。

如果在这段时间内不要阻止您的服务器很重要，那么您将不得不真正将它分开一点。

还可以查看 mysqldump 的 -tab 选项，使用 TO OUTFILE 输出数据，这更有效，加载速度更快。

# visual-studio - 如何在 Visual Studio 2005 中抑制单个 BizTalk 警告

> ID：183245
> 
> 赞同：6
> 
> 时间：2008-10-08T15:00:29.757
> 
> 标签：visual-studio, warnings, biztalk, biztalk2006r2

我们目前正在使用 BizTalk 2006 R2 来构建企业集成解决方案。我们广泛使用 BizTalk 映射，但是当您在 Visual Studio 2005 中构建解决方案时，它会针对映射产生以下警告：

> 警告 双击此处显示/隐藏编译器链接。

在我看来，这些不是真正的警告，可以忽略，但我不喜欢这种策略，因为忽略警告是一个不好的习惯。

使用 \nowarn 属性似乎不是一个选项，因为该消息没有关联的数字。

此外，当使用构建脚本构建项目时，警告会消失，这表明这是 Visual Studio 的一项功能，而不是真正的编译器警告。

所以我想知道是否有办法在 Visual Studio 中抑制这种类型的警告。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-19T17:28:24.390

我不相信有办法为 BizTalk 项目抑制这些。BizTalk 大师只是学会忽略它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-20T21:52:31.293

您可以使用 /nowarn 选项来抑制警告。

请参阅[MSDN：/nowarn（抑制指定的警告）（C# 编译器选项）](http://msdn.microsoft.com/en-us/library/7f28x9z3(VS.80).aspx)。

# wpf - WPF DocumentViewer Find-function 和 FixedPage 文档

> ID：183249
> 
> 赞同：7
> 
> 时间：2008-10-08T15:01:08.007
> 
> 标签：wpf, xaml, xps, documentviewer, fixedpage

.Net 包含一个很好的控件，称为[`DocumentViewer`](http://msdn.microsoft.com/en-us/library/system.windows.controls.documentviewer.aspx). 它还提供了一个子控件，用于在加载的文档中查找文本（这至少是它应该做的）。

当插入[`FixedPage`](http://msdn.microsoft.com/en-us/library/system.windows.documents.fixeddocument.aspx)的对象作为 的文档源时`DocumentViewer`，查找功能只是找不到任何东西。甚至没有一个字母。我还没有尝试过[`FlowDocument`](http://msdn.microsoft.com/en-us/library/system.windows.documents.flowdocument.aspx)，因为文档`DocumentViewer`没有那么有用，而且网络上的资源实际上并不存在，我现在想问问 stackoverflow 社区：

让 WPF 的 Find-Function`DocumentViewer`处理`FixedPage`文档需要什么？

[顺便说一句，我不使用自`ControlTemplates`定义`DocumentViewer`]

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-13T22:18:03.177

我对 FixedDocuments 也有同样的问题。如果您将 FixedDocument 转换为 XPS 文档，那么它可以正常工作。

从 FixedDocument 在内存中创建 XPS 文档然后在 DocumentViewer 中显示的示例。

```
// Add to xaml: <DocumentViewer x:Name="documentViewer" />
// Add project references to "ReachFramework" and "System.Printing"
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Documents;
using System.IO;
using System.IO.Packaging;
using System.Windows.Xps.Packaging;

namespace WpfApplication1
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();

            // Set up demo FixedDocument containing text to be searched
            var fixedDocument = new FixedDocument();
            var pageContent = new PageContent();
            var fixedPage = new FixedPage();
            fixedPage.Children.Add(new TextBlock() { Text = "Demo document text." });
            pageContent.Child = fixedPage;
            fixedDocument.Pages.Add(pageContent);

            // Set up fresh XpsDocument
            var stream = new MemoryStream();
            var uri = new Uri("pack://document.xps");
            var package = Package.Open(stream, FileMode.Create, FileAccess.ReadWrite);
            PackageStore.AddPackage(uri, package);
            var xpsDoc = new XpsDocument(package, CompressionOption.NotCompressed, uri.AbsoluteUri);

            // Write FixedDocument to the XpsDocument
            var docWriter = XpsDocument.CreateXpsDocumentWriter(xpsDoc);
            docWriter.Write(fixedDocument);

            // Display XpsDocument in DocumentViewer
            documentViewer.Document = xpsDoc.GetFixedDocumentSequence();
        }
    }
} 
```

[![在此处输入图像描述](https://i.stack.imgur.com/wrTWu.png)](https://i.stack.imgur.com/wrTWu.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:48:51.737

我在富文本框中搜索文本时遇到了麻烦，它太慢了。我所做的是每次我想搜索时都会压缩xaml。我提高了几个数量级。

这是一个很大的解决方法，基于 Chris Anderson 的[书中](https://rads.stackoverflow.com/amzn/click/com/0321374479)的一部分。

干杯

# c# - 当我在未初始化的 char 对象属性上调用 ToString() 时返回什么？

> ID：183250
> 
> 赞同：2
> 
> 时间：2008-10-08T15:01:14.137
> 
> 标签：c#

我有一个带有一个名为 Gender 的属性的 ac# 对象，该属性被声明为一个字符。

```
private char _Gender;
public char Gender
{
    get{ return _Gender; }
    set{ _Gender = value; }

} 
```

当我调用 MyObject.Gender.ToString() 时返回/创建什么字符串？

我问是因为我正在调用一个 web 服务（它接受一个字符串而不是一个字符），所以我在传递它时正在对属性执行一个 ToString。如果未设置字符，我希望它发送一个空字符串。

然而，情况似乎并非如此，所以问题是字符串是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:02:53.917

char 的默认值是 unicode 0，所以我希望返回 "\u0000"。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T15:04:02.993

字段总是初始化为其默认值；0/false/null - 这是 0 字符，\0。

如果你想要一个空字符串，直接使用字符串 - 即“”。

您可以使用条件运算符：

```
string s = c == 0 ? "" : c.ToString(); 
```

或者，可为空的类型可能会有所帮助 - 即

```
char? c; // a field
...
string s = c.ToString(); // is ""
c = 'a';
s = c.ToString(); // is "a" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:07:37.073

char 的长度为 1，因此它永远不应返回空字符串。

如果要区分 0 和未初始化，则需要使用可为空的形式 char?。

# postback - 什么是回发？

> ID：183254
> 
> 赞同：152
> 
> 时间：2008-10-08T15:01:20.893
> 
> 标签：postback

我正在进入 Web 开发领域，并且看到了***回***发这个词。来自非基于 Web 的背景，**新的 Web 开发人员必须了解回发什么？（即它们是什么以及它们何时出现？）**

如果您想分享更多信息以帮助网络世界中的新手了解回发，我们将不胜感激。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2008-10-08T15:50:32.277

以下是针对ASP.Net初学者...

### 什么时候发生？

回发源自客户端浏览器。通常页面上的其中一个控件将由用户操作（单击按钮或更改下拉菜单等），并且此控件将启动回发。此控件的状态以及页面上的所有其他控件（称为视图状态）被**回**发到 Web 服务器。

### 发生什么了？

最常见的回发会导致 Web 服务器创建启动回发的页面的代码隐藏类的实例。然后在正常的页面生命周期内执行此页面对象，但略有不同（见下文）。如果您在页面生命周期中没有专门将用户重定向到另一个页面，则回发的最终结果将是再次显示给用户的同一页面，然后可能会发生另一个回发，依此类推。

### 为什么会这样？

Web 应用程序正在 Web 服务器上运行。为了处理用户的响应，导致应用程序状态改变，或者移动到不同的页面，你需要获取一些代码在 web 服务器上执行。实现这一点的唯一方法是收集用户当前正在处理的所有信息并将其全部发送回服务器。

**初学者需要注意的一些事情是......**

*   回发页面上的控件状态在上下文中可用。这将允许您操作页面控件或根据那里的信息重定向到另一个页面。
*   Web 表单上的控件具有事件，因此也具有事件处理程序，就像任何其他控件一样。页面生命周期的初始化部分将在导致回发的控件的事件处理程序之前执行。因此，页面的 Init 和 Load 事件处理程序中的代码将在用户单击的按钮的事件处理程序中的代码之前执行。
*   当页面在回发后执行时，“Page.IsPostBack”属性的值将设置为“true”，否则设置为“false”。
*   Ajax 和 MVC 等技术已经改变了回发的工作方式。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-08T15:02:51.543

来自[维基百科](http://en.wikipedia.org/wiki/Postback)：

> 回发是交互式网页采取的一种动作，当整个页面及其内容被发送到服务器以处理某些信息，然后服务器将同一页面回发给浏览器。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-08T15:05:05.160

扩展给出的定义，作为 Web 开发人员，您需要知道的最重要的事情是在回发之间不保存任何状态。有一些方法可以保留状态，例如 ASP.NET 中的 Session 或 Viewstate 集合，但根据经验，编写程序时可以在每次回发时重新创建状态。

这可能是桌面和基于 Web 的应用程序编程之间最大的区别，我花了几个月的时间才学会了本能地用这种方式编写。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-10-08T16:36:34.990

当网页将其数据发布回相同的脚本/dll/首先生成该页面的任何内容时，就会发生回发。

C# (asp.net) 中的示例

...

```
if (!IsPostback)
   // generate form
else
   process submitted data; 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-08T15:11:32.417

Web 开发通常涉及包含表单（`<form>`标签）的 html 页面。表单发布到 URL。您可以将给定的表单设置为发布到您想要的任何网址。**回**发是指表单回发到它自己的页面/网址。

该术语对 ASP.Net WebForms 开发人员具有特殊意义，因为它是驱动页面许多行为的主要机制——特别是“事件处理”。ASP.Net WebForms 页面只有一个几乎总是回发给自身的服务器表单，这些回发会触发服务器上称为页面生命周期的东西的执行。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-03-18T20:46:06.680

当与第 3 方 Web 服务 API 交互时，该术语也用于 Web 应用程序开发

许多 API 需要交互式和非交互式集成。通常，交互部分是使用重定向完成的（站点 1 将用户重定向到站点 2，他们在那里登录，然后被重定向回来）。非交互部分是使用“回发”或从站点 2 的服务器到站点 1 的服务器的 HTTP POST 完成的。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-08T15:03:22.010

当脚本生成一个 html 表单并且该表单的操作 http POST 回同一个表单时。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-08T15:08:43.187

回发本质上是当表单提交到您当前正在处理数据的同一页面或脚本（.php .asp 等）时，而不是将您发送到新页面。

一个示例可以是论坛上的页面 (viewpage.php)，您在其中提交评论并将其提交到同一页面 (viewpage.php)，然后您会看到它添加了新内容。

见：[http ://en.wikipedia.org/wiki/Postback](http://en.wikipedia.org/wiki/Postback)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-08T15:03:21.840

回发是导致来自客户端 Web 浏览器的页面被推回服务器的任何内容。

有很多信息在那里，搜索谷歌回发。

大多数情况下，任何 ASP 控件都会导致回发（按钮/链接单击），但有些不会，除非您告诉它们（复选框/组合框）

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-08T15:04:54.007

回发是指 HTML 表单。HTML 表单有 2 种方法：GET 和 POST。这些方法决定了数据如何通过表单从客户端发送到服务器。回发是回发到提交页面的操作。从本质上讲，它形成了从客户端到服务器再返回的完整电路。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-12-18T11:13:34.077

Yet the question is answered accurately above, but just want to share my knowledge . Postback is basically a property that we can use while doing some tasks that need us to manage the state of the page, that is either we have fired some event for e.g. a button click or if we have refreshed our page. When our page loads for the very first time , that is if we have refreshed our page, at that time postback-property is false, and after that it becomes true.

```
if(!ispostback)
{
 // do some task here
}
else
{
 //do another task here
} 
```

[http://happycodng.blogspot.in/2013/09/concept-of-postback-in.html](http://happycodng.blogspot.in/2013/09/concept-of-postback-in.html)

# oop - 将对象的副本传递给方法——谁来复制？

> ID：183277
> 
> 赞同：6
> 
> 时间：2008-10-08T15:05:54.970
> 
> 标签：oop

我有一个要在方法调用中传递的对象。假设我使用的语言只允许您通过引用传递对象，例如 Java 或 PHP。如果该方法对对象进行更改，它将影响调用者。我不希望这种情况发生。所以看起来我需要制作一个对象的副本。

我的问题是：克隆对象是谁的责任？调用者，在它调用方法之前？还是被调用者，在它改变对象之前？

编辑：澄清一下，我希望这成为该方法合同的一部分——它永远不会修改原始对象。所以看起来应该取决于制作副本的方法。但是，调用者无法免受无法正确执行此操作的方法的保护。我想这是可以接受的——唯一的其他选择似乎是将它内置到语言中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T15:09:28.910

一般来说，如果**调用者担心更改，则应制作副本**。如果调用者不关心，**则该方法应该在它需要做一些它知道不应该持续存在的事情时制作副本**。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T15:12:09.933

呼叫者，召集者。因为，有时您想对对象本身进行更改，有时对副本进行更改。

虽然，我认为被调用者修改传递的对象（至少在面向对象的语言中）是一种不好的做法。这可能会导致许多不需要的副作用。

（在您之后）编辑：在这种情况下，被调用方有责任执行合同，因此有两种选择：

*   被调用者根本不修改对象
*   或者被调用者复制对象并在之后使用该副本

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T15:12:40.713

所以你想做类似的事情

我的对象 m = 新的我的对象（）；MyObject n = MyObjectProcessor.process(m);?

对我来说，做类似 MyObject n = MyObjectProcessor.alter(m.clone()); 之类的事情似乎更简单。

很清楚谁在对谁做什么。您可以提出处理器类函数应该没有副作用的论点，即它应该在任何时候改变状态时返回一个新对象，但是（AFAIK）与函数式编程相反，在OO中并没有如此一致地遵循。

像上面这样的东西可能是无害的，只要它有明确的命名和记录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T15:13:59.463

我们可以查看 ruby​​ 以获得指导。他们使用 ! 符号表示对象已就地修改。因此，salary.add(10000) 返回一个新对象，但salary.add!(10000) 返回原始对象但已修改。通过使用本地命名约定，您可以在 Java 或 PHP 中使用相同的想法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:33:35.183

I would say the callee: it simplifies calls and caller won't have to worry for the integrity of the given objects. It is the responsibility of the callee to preserve the integrity.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T17:56:38.107

我认为调用者应该进行克隆，只是为了使命名更容易。您可以将方法命名为 Foo() 而不是 CloneBarAndFooClone()。

相比：

```
void RemoveZeroDollarPayments(Order order) 
```

对比

```
Order CloneOrderAndRemoveZeroDollarPaymentsFromClone(Order order) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T18:07:50.610

如果不更改对象是方法契约的一部分，则唯一的可能性是在方法内部制作副本。否则你就是在对你的客户撒谎。

您实际上需要修改与给定对象完全相同的对象这一事实只是一个实现细节，不应给调用者带来负担。事实上，他甚至不需要看到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T17:37:59.703

我假设你会有类似 const 声明的东西。这将是编译器强制执行的，并且比创建对象的副本更有效。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T15:08:41.830

取决于，是否有任何理由可以在您希望调用者看到更改的将来调用该方法？如果是这样，那么调用者应该制作副本。否则，被调用者应该成功。我会说第二种情况可能更常见。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-08T15:09:51.717

如果您让调用者克隆对象，它可以让您灵活地不使用副本（不先克隆它），也意味着您不必返回新对象，您只需对传入的引用进行操作.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T15:10:02.747

我的第一反应是这是调用者的责任，但我认为这实际上取决于。

这取决于两种方法之间定义的契约。进行更改的方法应明确识别该事实并让调用者做出决定。或者，进行更改的方法应明确标识它不会对传递的对象进行任何更改，然后它将负责制作副本。

# asp.net - 请等待对话框和在 asp.net 中下载文件

> ID：183279
> 
> 赞同：3
> 
> 时间：2008-10-08T15:06:31.757
> 
> 标签：asp.net

在我的 ASP.Net 应用程序中，我有一个要求，即当用户单击 UI 元素时，我们会为他们生成一个 PDF 供他们下载。目前这是通过将表单发布到 ashx 页面来实现的。该页面主要检查表单，然后执行正确的服务器端页面，该页面生成 HTML 或该页面 HTML 的 PDF 文档。

在客户端上，我提前知道我们是否要获取 PDF 或 HTML，当它是 HTML 时，我打开一个新窗口并将表单发布到该窗口，一切正常。当它是 PDF 时，我不会更改表单的目标，它会保留在当前页面上。

这是可行的，用户会看到一个保存对话框，并且当前页面不会更改或丢失。

我遇到的问题是生成 PDF 需要 1-15 秒。我想要做的是弹出一个请等待对话框。显示弹出窗口很容易，我不确定我怎么知道关闭弹出窗口？弹出窗口将是当前页面中的一个 div。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T15:10:50.017

弹出窗口可以有一个客户端计时器，用于轮询服务器以完成任务。长时间运行的服务器任务应该更新可以由轮询服务访问的数据库表或服务器缓存对象中的进度。

来自 MSDN 杂志的几篇旧文章。您应该能够在 asp.net Ajax 等较新的库中使用相同的概念。

[使用 ASP.NET 2.0 报告任务进度](http://msdn.microsoft.com/en-us/magazine/cc163553.aspx)

[使用 ASP.NET “Atlas”简化任务进度](http://msdn.microsoft.com/en-us/magazine/cc163542.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T15:07:54.780

只需在客户端放置一些 javascript 并让它显示一些动画 GIF 1-15 秒（您的选择）并在指定时间后自行关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T18:02:14.723

Gulzar 的建议是正确的。我有一个简单的启用 ajax 的 wcf 服务，它检查会话变量。我的 ashx 页面在开始处理时将变量设置为 false，然后在处理完成时设置为 true。

我认为如果客户端在我们将会话项设置为 false 之前进行检查，则可能存在竞争条件；但是，如果我们修改服务以在客户端获得即时完成响应后将会话项设置为 false，则有一些方法可以解决此问题。

技巧仍然是弄清楚客户端应该是什么间隔。如果我们将其设置为低，用户可以保存文件，然后看到仍在处理的消息。我在半秒钟和一秒钟之间争论自己。任何少于半秒的时间似乎都是不必要的。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-08T15:12:40.103

你说：

> 当它是 PDF 时，我不会更改表单的目标，它会保留在当前页面上。

如果是这种情况，则打开 PDF 时原始页面将消失。在那种情况下，我会有一个加载动画 gif 并使用 Javascript 将其打开到覆盖页面其余部分的 div 标记中。您不需要关闭它，因此不需要计时器或轮询。当页面消失时，它就会消失。

# java - 在 JAR 中包含 JAR 的类路径

> ID：183292
> 
> 赞同：142
> 
> 时间：2008-10-08T15:09:21.110
> 
> 标签：java, classpath

是否可以指定一个`classpath`包含另一个 JAR 文件中的 JAR 文件的 Java？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-10-08T15:12:05.863

如果您尝试创建一个包含您的应用程序及其所需库的 jar，有两种方法（我知道）可以做到这一点。第一个是[One-Jar](http://one-jar.sourceforge.net/)，它使用一个特殊的类加载器来允许 jar 的嵌套。第二个是[UberJar](http://classworlds.codehaus.org/uberjar.html)，（或[Shade](http://maven.apache.org/plugins/maven-shade-plugin/)），它会分解包含的库并将所有类放入顶级 jar 中。

我还应该提到 UberJar 和 Shade 分别是 Maven1 和 Maven2 的插件。如下所述，您还可以使用程序集插件（实际上它更强大，但更难正确配置）。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2010-02-24T14:43:01.457

您不想使用那些“爆炸 JAR 内容”解决方案。它们肯定会让东西更难看（因为所有东西都在同一水平上爆炸）。此外，可能存在命名冲突（如果人们使用正确的包，则不应发生，但您不能总是控制这一点）。

您想要的功能是[25 大 Sun RFE](http://bugs.sun.com/bugdatabase/top25_rfes.do)之一：[RFE 4648386](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4648386)，Sun 以其无限的智慧将其指定为低优先级。我们只能希望太阳醒来......

同时，我遇到的最佳解决方案（我希望 Sun 将其复制到 JDK 中）是使用自定义类加载器[JarClassLoader](http://www.jdotsoft.com/JarClassLoader.php)。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2014-02-14T10:49:45.710

经过一些研究，我发现了不需要 maven 或任何 3rd 方扩展/程序的方法。

您可以在清单文件中使用“类路径”。

例如：

创建清单文件 MANIFEST.MF

```
Manifest-Version: 1.0
Created-By: Bundle
Class-Path: ./custom_lib.jar
Main-Class: YourMainClass 
```

编译所有类并运行`jar cfm Testing.jar MANIFEST.MF *.class custom_lib.jar`

`c`代表 create archive `f`表示要指定 file `v`是用于详细输入 `m`表示我们将传递自定义清单文件

确保在 jar 包中包含 lib。您应该能够以正常方式运行 jar。

基于：[http ://www.ibm.com/developerworks/library/j-5things6/](http://www.ibm.com/developerworks/library/j-5things6/)

你需要的关于类路径的所有其他信息都在这里找到[吗](http://docs.oracle.com/javase/tutorial/deployment/jar/downman.html)

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2011-09-09T14:09:19.197

使用**zipgroupfileset标签（使用与****文件集**标签相同的属性）；它将解压缩目录中的所有文件并添加到您的新存档文件中。更多信息：[http ://ant.apache.org/manual/Tasks/zip.html](http://ant.apache.org/manual/Tasks/zip.html)

这是解决 jar-in-a-jar 问题的一种非常有用的方法——我知道是因为我在试图弄清楚该怎么做时搜索了这个确切的 StackOverflow 问题。如果你想将一个 jar 或一个 jar 文件夹打包到你用 Ant 构建的 jar 中，那么忘记所有这些类路径或第三方插件的东西，你所要做的就是（在 Ant 中）：

```
<jar destfile="your.jar" basedir="java/dir">
  ...
  <zipgroupfileset dir="dir/of/jars" />
</jar> 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-04-25T18:47:27.437

如果您正在使用 ant 构建（我正在使用来自 eclipse 的 ant），您可以通过告诉 ant 添加额外的 jar 文件来添加它们......如果您有一个由多人维护的项目，这不一定是最好的方法，但它可以工作对于一个人的项目，很容易。

例如，我构建 .jar 文件的目标是：

```
<jar destfile="${plugin.jar}" basedir="${plugin.build.dir}">
    <manifest>
        <attribute name="Author" value="ntg"/>
        ................................
        <attribute name="Plugin-Version" value="${version.entry.commit.revision}"/>
    </manifest>
</jar> 
```

我只是添加了一行来实现它：

```
<jar ....">
    <zipgroupfileset dir="${external-lib-dir}" includes="*.jar"/>
    <manifest>
        ................................
    </manifest>
</jar> 
```

在哪里

```
<property name="external-lib-dir" 
          value="C:\...\eclipseWorkspace\Filter\external\...\lib" /> 
```

是带有外部罐子的目录。就是这样……

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-08T15:10:45.850

并非没有编写自己的类加载器。您可以将 jars 添加到 jar 的类路径中，但它们必须位于同一位置，而不是包含在主 jar 中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-08T15:11:27.457

您需要构建一个自定义类加载器来执行此操作，或者构建一个支持此功能的第三方库。最好的办法是从运行时提取 jar 并将它们添加到类路径中（或者已经将它们添加到类路径中）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-08T17:53:43.977

我将 maven 用于我的 java 构建，它有一个名为[maven assembly plugin](http://maven.apache.org/plugins/maven-assembly-plugin/)的插件。

它可以满足您的要求，但就像其他一些建议所描述的那样-本质上是爆炸所有依赖的罐子并将它们重新组合成一个罐子

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-07-30T08:44:24.597

如果您有 eclpise IDE，您只需导出您的 JAR 并选择“将所需的库打包到生成的 JAR 中”。eclipse 会自动将所需的依赖 JAR 添加到生成的 JAR 中，并生成一些自动加载这些 JAR 的 eclipse 自定义类加载器。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-08T16:19:23.793

我正要建议提取同一级别的所有文件，然后从结果中制作一个 jar，因为包系统应该将它们整齐地分开。那将是手动方式，我想史蒂夫指出的工具会很好地做到这一点。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-10-26T15:56:58.193

Winstone 相当不错[http://blog.jayway.com/2008/11/28/executable-war-with-winstone-maven-plugin/](http://blog.jayway.com/2008/11/28/executable-war-with-winstone-maven-plugin/)。但不适用于复杂的网站。这是一种耻辱，因为只需要包含插件。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-02-20T20:13:44.173

好吧，如果您使用的是 Eclipse，那么有一个非常简单的方法。

将您的项目导出为“可运行”Jar 文件（在 Eclipse 中右键单击项目文件夹，选择“导出...”）。配置导出设置时，请务必选择“将所需库提取到生成的 Jar 中”。请记住，选择“提取...”而**不是**“打包所需的库...”。

**另外**：您必须在导出设置中选择运行配置。因此，您总是可以在某个类中创建一个空的 main() 并将其用于您的运行配置。

无论如何，它不能*保证*100% 的时间 - 因为您会注意到一条弹出消息，告诉您确保检查您包含的 Jar 文件的许可证以及不复制签名文件的一些内容。但是，我已经这样做了**多年**，从未遇到过问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-11-29T00:49:50.050

提取到 Uber-dir 对我有用，因为我们都应该使用 root:\java 并且在带有版本控制的包中拥有 outlet 代码。即ca.tecreations-1.0.0。签名没问题，因为 jar 从其下载位置完好无损。3rd 方签名完整，解压到 c:\java。这是我的项目目录。从启动器运行 java -cp c:\java Launcher

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-04T19:30:43.950

如果您使用的是 Spring Boot，您可能需要查看以下文档：[The Executable Jar Format](https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-executable-jar-format.html)

> **Java 不提供任何标准方法**来加载嵌套的 jar 文件（即，本身包含在 jar 中的 jar 文件）。如果您需要分发可以从命令行运行而无需解包的独立应用程序，这可能会出现问题。
> 
> 为了解决这个问题，许多开发人员使用**“阴影”罐子**。带阴影的 jar 将所有 jar 中的所有类打包到一个“uber jar”中。带阴影的 jar 的问题是很难看出哪些库实际上在您的应用程序中。如果在多个 jar 中使用相同的文件名（但内容不同），也可能会出现问题。**Spring Boot 采用了不同的方法，让您实际上可以直接嵌套 jar**。

Spring 文档还列出了一些*替代的单 Jar 解决方案*：

*   [Apache Maven 阴影插件](https://maven.apache.org/plugins/maven-shade-plugin/)
*   [JDotSoft JarClassLoader](http://www.jdotsoft.com/JarClassLoader.php)
*   [一罐](http://one-jar.sourceforge.net/)
*   [影子插件（Gradle）](https://imperceptiblethoughts.com/shadow/)

# jquery - 如何从后面的代码中的页面方法更新 GridView？

> ID：183310
> 
> 赞同：4
> 
> 时间：2008-10-08T15:11:33.697
> 
> 标签：jquery, web-services, json, gridview, asmx

如何从 web 方法更新 aspx 页面上的 Gridview？

这是我的代码。

```
[WebMethod]
public static string GetDate()
{

    return DateTime.Now.ToString();
} 
```

我不能使用“findcontrol”或“this”方法，所以我需要一些帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T15:32:26.850

您可以动态/以编程方式构建 GridView 控件。然后在您的 WebMethod 中，您可以调用 RenderControl() 方法来检索呈现的 GridView 控件的 HTML 内容。从 WebMethod 返回该内容并让回调 JavaScript 函数将 HTML 内容注入占位符元素的 innerHTML 属性。

另一种选择是在客户端进行数据绑定。因此，WebMethod 所要做的就是传回数据（不包括表现性标记），例如以 JSON 类型的格式。然后，您可以使用诸如[javascript 模板](http://code.google.com/p/trimpath/wiki/JavaScriptTemplates)之类的东西来呈现带有数据的网格。这种方法将 GridView 控件完全排除在外，但根据您的需要，它可能是一个可行的选择。

# asp.net-mvc - ASP.NET MVC 处理错误

> ID：183316
> 
> 赞同：111
> 
> 时间：2008-10-08T15:12:32.617
> 
> 标签：asp.net-mvc, custom-error-pages, handleerror

如何`[HandleError]`在 asp.net MVC Preview 5 中使用过滤器？
我在我的 Web.config 文件中设置了 customErrors

```
<customErrors mode="On" defaultRedirect="Error.aspx">
  <error statusCode="403" redirect="NoAccess.htm"/>
  <error statusCode="404" redirect="FileNotFound.htm"/>
</customErrors> 
```

并将 [HandleError] 放在我的控制器类上方，如下所示：

```
[HandleError]
public class DSWebsiteController: Controller
{
    [snip]
    public ActionResult CrashTest()
    {
        throw new Exception("Oh Noes!");
    }
} 
```

然后我让我的控制器从这个类继承并在它们上调用 CrashTest()。Visual Studio 在错误处停止，按 f5 继续后，我被重新路由到 Error.aspx?aspxerrorpath=/sxi.mvc/CrashTest （其中 sxi 是使用的控制器的名称。当然找不到路径，我得到了“'/' 应用程序中的服务器错误。”404。

这个站点是从预览版 3 移植到 5 版的。除了错误处理之外，一切都在运行（移植的工作并不多）。当我创建一个完整的新项目时，错误处理似乎起作用了。

想法？

**--注意--**
由于这个问题现在有超过 3K 的浏览量，我认为把我目前正在使用的（ASP.NET MVC 1.0）放入其中会是有益的。在[mvc contrib 项目](http://www.codeplex.com/MVCContrib)中，有一个名为“RescueAttribute”的出色属性，您可能也应该检查一下；）

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2008-10-10T17:29:42.560

```
[HandleError] 
```

当您仅向您的类（或您的操作方法）提供 HandleError 属性时，当发生未处理的异常时，MVC 将首先在控制器的视图文件夹中查找名为“错误”的相应视图。如果在那里找不到它，它将继续查看共享视图文件夹（默认情况下应该有一个 Error.aspx 文件）

```
[HandleError(ExceptionType = typeof(SqlException), View = "DatabaseError")]
[HandleError(ExceptionType = typeof(NullReferenceException), View = "LameErrorHandling")] 
```

您还可以使用有关您正在查找的异常类型的特定信息来堆叠其他属性。此时，您可以将错误定向到默认“错误”视图以外的特定视图。

有关更多信息，请查看[Scott Guthrie 的博客文章](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-07-22T10:38:08.223

还要注意的是没有设置http错误码为500的错误

（例如 UnauthorizedAccessException）

HandleError 过滤器不会处理。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-05-04T22:12:18.667

http错误代码为500的解决方法这是一个名为[ERROR]的属性放在一个动作上

```
public class Error: System.Web.Mvc.HandleErrorAttribute
{
    public override void OnException(System.Web.Mvc.ExceptionContext filterContext)
    {

            if (filterContext.HttpContext.IsCustomErrorEnabled)
            {
                filterContext.ExceptionHandled = true;

            }
            base.OnException(filterContext);
            //OVERRIDE THE 500 ERROR  
           filterContext.HttpContext.Response.StatusCode = 200;
    }

    private static void RaiseErrorSignal(Exception e)
    {
        var context = HttpContext.Current;
      // using.Elmah.ErrorSignal.FromContext(context).Raise(e, context);
    } 

} 
```

//例子：

```
[Error]
[HandleError]
[PopulateSiteMap(SiteMapName="Mifel1", ViewDataKey="Mifel1")]
public class ApplicationController : Controller
{
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-07-19T06:09:17.007

MVC 中的属性在**get 和 post**方法的错误处理中非常有用，它还跟踪**ajax 调用**。

在您的应用程序中创建一个基本控制器并在您的主控制器（EmployeeController）中继承它。

**公共类 EmployeeController : BaseController**

# 在基本控制器中添加以下代码。

```
/// <summary>
/// Base Controller
/// </summary>
public class BaseController : Controller
{       
    protected override void OnException(ExceptionContext filterContext)
    {
        Exception ex = filterContext.Exception;

        //Save error log in file
        if (ConfigurationManager.AppSettings["SaveErrorLog"].ToString().Trim().ToUpper() == "TRUE")
        {
            SaveErrorLog(ex, filterContext);
        }

        // if the request is AJAX return JSON else view.
        if (IsAjax(filterContext))
        {
            //Because its a exception raised after ajax invocation
            //Lets return Json
            filterContext.Result = new JsonResult()
            {
                Data = Convert.ToString(filterContext.Exception),
                JsonRequestBehavior = JsonRequestBehavior.AllowGet
            };
        }
        else
        {
            filterContext.ExceptionHandled = true;
            filterContext.HttpContext.Response.Clear();

            filterContext.Result = new ViewResult()
            {
                //Error page to load
                ViewName = "Error",
                ViewData = new ViewDataDictionary()
            };

            base.OnException(filterContext);
        }
    }

    /// <summary>
    /// Determines whether the specified filter context is ajax.
    /// </summary>
    /// <param name="filterContext">The filter context.</param>
    private bool IsAjax(ExceptionContext filterContext)
    {
        return filterContext.HttpContext.Request.Headers["X-Requested-With"] == "XMLHttpRequest";
    }

    /// <summary>
    /// Saves the error log.
    /// </summary>
    /// <param name="ex">The ex.</param>
    /// <param name="filterContext">The filter context.</param>
    void SaveErrorLog(Exception ex, ExceptionContext filterContext)
    {
        string logMessage = ex.ToString();

        string logDirectory = Server.MapPath(Url.Content("~/ErrorLog/"));

        DateTime currentDateTime = DateTime.Now;
        string currentDateTimeString = currentDateTime.ToString();
        CheckCreateLogDirectory(logDirectory);
        string logLine = BuildLogLine(currentDateTime, logMessage, filterContext);
        logDirectory = (logDirectory + "\\Log_" + LogFileName(DateTime.Now) + ".txt");

        StreamWriter streamWriter = null;
        try
        {
            streamWriter = new StreamWriter(logDirectory, true);
            streamWriter.WriteLine(logLine);
        }
        catch
        {
        }
        finally
        {
            if (streamWriter != null)
            {
                streamWriter.Close();
            }
        }
    }

    /// <summary>
    /// Checks the create log directory.
    /// </summary>
    /// <param name="logPath">The log path.</param>
    bool CheckCreateLogDirectory(string logPath)
    {
        bool loggingDirectoryExists = false;
        DirectoryInfo directoryInfo = new DirectoryInfo(logPath);
        if (directoryInfo.Exists)
        {
            loggingDirectoryExists = true;
        }
        else
        {
            try
            {
                Directory.CreateDirectory(logPath);
                loggingDirectoryExists = true;
            }
            catch
            {
            }
        }

        return loggingDirectoryExists;
    }

    /// <summary>
    /// Builds the log line.
    /// </summary>
    /// <param name="currentDateTime">The current date time.</param>
    /// <param name="logMessage">The log message.</param>
    /// <param name="filterContext">The filter context.</param>       
    string BuildLogLine(DateTime currentDateTime, string logMessage, ExceptionContext filterContext)
    {
        string controllerName = filterContext.RouteData.Values["Controller"].ToString();
        string actionName = filterContext.RouteData.Values["Action"].ToString();

        RouteValueDictionary paramList = ((System.Web.Routing.Route)(filterContext.RouteData.Route)).Defaults;
        if (paramList != null)
        {
            paramList.Remove("Controller");
            paramList.Remove("Action");
        }

        StringBuilder loglineStringBuilder = new StringBuilder();

        loglineStringBuilder.Append("Log Time : ");
        loglineStringBuilder.Append(LogFileEntryDateTime(currentDateTime));
        loglineStringBuilder.Append(System.Environment.NewLine);

        loglineStringBuilder.Append("Username : ");
        loglineStringBuilder.Append(Session["LogedInUserName"]);
        loglineStringBuilder.Append(System.Environment.NewLine);

        loglineStringBuilder.Append("ControllerName : ");
        loglineStringBuilder.Append(controllerName);
        loglineStringBuilder.Append(System.Environment.NewLine);

        loglineStringBuilder.Append("ActionName : ");
        loglineStringBuilder.Append(actionName);
        loglineStringBuilder.Append(System.Environment.NewLine);

        loglineStringBuilder.Append("----------------------------------------------------------------------------------------------------------");
        loglineStringBuilder.Append(System.Environment.NewLine);

        loglineStringBuilder.Append(logMessage);
        loglineStringBuilder.Append(System.Environment.NewLine);
        loglineStringBuilder.Append("==========================================================================================================");

        return loglineStringBuilder.ToString();
    }

    /// <summary>
    /// Logs the file entry date time.
    /// </summary>
    /// <param name="currentDateTime">The current date time.</param>
    string LogFileEntryDateTime(DateTime currentDateTime)
    {
        return currentDateTime.ToString("dd-MMM-yyyy HH:mm:ss");
    }

    /// <summary>
    /// Logs the name of the file.
    /// </summary>
    /// <param name="currentDateTime">The current date time.</param>
    string LogFileName(DateTime currentDateTime)
    {
        return currentDateTime.ToString("dd_MMM_yyyy");
    }

} 
```

=================================================

**查找目录：Root/App_Start/FilterConfig.cs**

添加以下代码：

```
/// <summary>
/// Filter Config
/// </summary>
public class FilterConfig
{
    /// <summary>
    /// Registers the global filters.
    /// </summary>
    /// <param name="filters">The filters.</param>
    public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
        filters.Add(new HandleErrorAttribute());
    }
} 
```

**跟踪 AJAX 错误：**

在布局页面加载中调用 CheckAJAXError 函数。

```
function CheckAJAXError() {
    $(document).ajaxError(function (event, jqXHR, ajaxSettings, thrownError) {

        var ex;
        if (String(thrownError).toUpperCase() == "LOGIN") {
            var url = '@Url.Action("Login", "Login")';
            window.location = url;
        }
        else if (String(jqXHR.responseText).toUpperCase().indexOf("THE DELETE STATEMENT CONFLICTED WITH THE REFERENCE CONSTRAINT") >= 0) {

            toastr.error('ReferanceExistMessage');
        }
        else if (String(thrownError).toUpperCase() == "INTERNAL SERVER ERROR") {
            ex = ajaxSettings.url;
            //var url = '@Url.Action("ErrorLog", "Home")?exurl=' + ex;
            var url = '@Url.Action("ErrorLog", "Home")';
            window.location = url;
        }
    });
}; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-08T17:32:44.910

您缺少 Error.aspx :) 在预览版 5 中，它位于您的 Views/Shared 文件夹中。只需从新的 Preview 5 项目中复制它即可。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-03-25T03:37:38.187

```
 [HandleError]
    public class ErrorController : Controller
    {        
        [AcceptVerbs(HttpVerbs.Get)]
        public ViewResult NotAuthorized()
        {
            //401
            Response.StatusCode = (int)HttpStatusCode.Unauthorized;

        return View();
    }

    [AcceptVerbs(HttpVerbs.Get)]
    public ViewResult Forbidden()
    {
        //403
        Response.StatusCode = (int)HttpStatusCode.Forbidden;

        return View();
    }

    [AcceptVerbs(HttpVerbs.Get)]
    public ViewResult NotFound()
    {
        //404
        Response.StatusCode = (int)HttpStatusCode.NotFound;
        return View();
    }

    public ViewResult ServerError()
    {
        //500
        Response.StatusCode = (int)HttpStatusCode.NotFound;
        return View();
    } 
```

}

# mysql - MYSQL：REGEXP 单引号匹配

> ID：183323
> 
> 赞同：1
> 
> 时间：2008-10-08T15:14:26.327
> 
> 标签：mysql, sql, regex, quotes

我在将 MySQL 查询中的字符串与以下正则表达式匹配时遇到问题：

我希望它匹配这个字符串：“Rue de l' Harmonie”

```
SELECT
  id,
  street_name
FROM
  street_names
WHERE
  street_name REGEXP '^(rue[a-z]+[[:blank:]])((du|de|la|des|d[\']|l[\'])[[:blank:]])*[[:<:]]HARMONIE$' 
```

任何人都可以给我一个提示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:16:11.830

开头：

```
^(rue[a-z]+ 
```

`+`要求至少有一个 az char 直接跟在rue**之后**。你可能想要`*`.

# c# - C# - 此代码无法正常运行的任何原因？

> ID：183325
> 
> 赞同：0
> 
> 时间：2008-10-08T15:14:50.600
> 
> 标签：c#

出于某种原因，第 1 节有效，但第 2 节无效。当以相反的顺序运行时（2 在 1 之前），第 1 节（从属关系）根本不运行。所有的数据都是一样的。

```
//Section 1

            UserService.DsUserAttributes dsAffiliation = us_service.GetUserAttributeDropDown(systemId, "Affiliation");
            Affiliation.DataSource = dsAffiliation.tblDropDownValues;
            Affiliation.DataTextField = "AttrValue";
            Affiliation.DataValueField = "Id";
            Affiliation.DataBind();                

//Section 2                 
            UserService.DsUserAttributes dsCountry = us_service.GetUserAttributeDropDown(systemId, "Country");
            Country.DataSource = dsCountry.tblDropDownValues;
            Country.DataTextField = "AttrValue";
            Country.DataValueField = "Id";
            Country.DataBind(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:22:36.183

看起来，要么`us_service.GetUserAttributeDropDown(systemId, "Country")`或`dsCountry.tblDropDownValues`正在抛出异常。您需要使用调试器来查看是哪个以及为什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T15:18:38.360

我想这在很大程度上取决于“国家”和“从属关系”对象......可能会发生任何事情。没有任何例外或类似的东西，远程调试这些东西非常困难^^

# java - 监控 Windows 目录大小

> ID：183338
> 
> 赞同：6
> 
> 时间：2008-10-08T15:18:58.783
> 
> 标签：java, ruby, perl, powershell, groovy

我正在寻找能够随着时间的推移监视 Windows 目录的大小和文件计数的东西。我说的是少数服务器和几千个文件夹（数百万个文件）。

要求：

*   关于 X 大小随 Y 时间增加的通知
*   在 Y 时间文件计数增加 X 的通知
*   大小和文件计数的历史图表（或至少随着时间的推移保存快照数据）
*   所有这些都在一组目录及其子目录上

我更喜欢免费的解决方案，但也希望能指出正确的方向。如果我们要自己写，我们会怎么做呢？可用的语言有 Ruby、Groovy、Java、Perl 或 PowerShell（因为我会写它）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T15:31:47.260

有几种解决方案，包括一些免费的。我合作过的一些包括：

[纳吉奥斯](http://www.nagios.org/) 和 [老大哥](http://bb4.com/)

快速谷歌搜索可能会找到更多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T15:47:17.367

您可能想看看[PolyMon](http://www.codeplex.com/polymon)，它是一个开源系统监控解决方案。它允许您以任何 .NET 语言编写自定义监视器，并允许您创建自定义 PowerShell 监视器。

它将数据存储在 SQL Server 后端并提供图形。出于您的目的，您只需要一个脚本来获取目录大小和文件数。就像是：

```
$size = 0
$count = 0
$path = '\\unc\path\to\directory\to\monitor'
get-childitem -path $path -recurse | Where-Object {$_ -is [System.IO.FileInfo]} | ForEach-Object {$size += $_.length; $count += 1} 
```

回复斯科特的评论：当然。你可以把它包装在一个while循环中

```
$ESCkey  = 27
Write-Host "Press the ESC key to stop sniffing" -foregroundcolor "CYAN"
$Running=$true

While ($Running)
    { 
         if ($host.ui.RawUi.KeyAvailable) {
         $key = $host.ui.RawUI.ReadKey("NoEcho,IncludeKeyUp,IncludeKeyDown")
            if ($key.VirtualKeyCode -eq $ESCkey) { 
             $Running=$False
            }
         #rest of function here 
        } 
```

对于 PowerShell 监视器，我不会这样做，您可以安排它定期运行，但是对于在后台运行的脚本，上述方法可以工作。您甚至可以添加一些数据库访问代码来将结果记录到数据库中，或者将其记录到文件中......无论您想要什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T18:43:15.890

您当然可以使用 PowerShell 和 WMI 完成此操作。您将需要某种数据库后端，例如 SQL Express。但我同意像 Polymon 这样的工具是更好的方法。可能会产生影响的一件事是规模问题。您需要监视 1 个服务器上的 1 个文件夹还是数百个文件夹？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T18:21:49.897

[http://sourceforge.net/projects/dirviewer/](http://sourceforge.net/projects/dirviewer/) -- DirViewer 是一个轻量级的纯java 应用程序，用于目录树视图和递归磁盘使用统计，使用JGoodies-Looks 的外观和感觉类似于Windows XP。

# groovy - Groovy 执行“cp *”shell 命令

> ID：183352
> 
> 赞同：14
> 
> 时间：2008-10-08T15:21:57.013
> 
> 标签：groovy

我想复制文本文件，并且只复制文本文件`src/`到`dst/`

```
常规：000>“cp src/*.txt dst/”.execute().text       
===>
常规：000>

```

您可以看到命令执行时没有错误，但文件`src/test.txt`没有被复制到`dst/`

这也失败了：

```
常规：000>“cp src/* dst/”.execute().text       
===>
常规：000>

```

然而...

```
"cp src/this.txt dst/".execute().text

```

作品

还，

```
"cp -R src/dst".execute().text

```

作品

为什么通配符似乎导致我的命令静默失败？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-08T18:09:17.033

感谢 tedu 让我成功了一半。

我相信他的解决方案不起作用的原因是因为“逃避”问题。

例如...

```
"sh -c 'ls'".execute()

```

作品。但...

```
“sh -c 'ls'”.execute()

```

才不是。

可能有一种方法可以在那里正确地对其进行转义，但我正在使用的解决方法是将字符串数组传递给 Runtime.getRuntime().exec

```
命令 = ["sh", "-c", "cp src/*.txt dst/"]
Runtime.getRuntime().exec((String[]) command.toArray())

```

效果很好！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T15:30:12.380

通配符扩展由 shell 执行，而不是由 cp（或 groovy）执行。您的第一个示例是尝试复制一个名为 *. 你可以让你的命令“sh -c 'cp ...'”

# arrays - 如何确定数组是否在 VB6 中初始化？

> ID：183353
> 
> 赞同：60
> 
> 时间：2008-10-08T15:22:00.477
> 
> 标签：arrays, vb6

将未标注的数组传递给 VB6 的 Ubound 函数会导致错误，因此我想在尝试检查其上限之前检查它是否已标注尺寸。我该怎么做呢？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-08T16:31:58.150

> **注意：**代码已经更新，可以在[修订历史](https://stackoverflow.com/posts/183668/revisions)中找到原始版本（不是说找到它有用）。更新后的代码不依赖于未记录的`GetMem4`函数并[正确处理](https://stackoverflow.com/questions/183353/how-do-i-determine-if-an-array-is-initialized-in-vb6#comment16951398_183668)所有类型的数组。

> **VBA 用户注意事项：**此代码适用于从未获得 x64 更新的 VB6。如果您打算将此代码用于 VBA，请参阅[https://stackoverflow.com/a/32539884/11683](https://stackoverflow.com/a/32539884/11683)了解 VBA 版本。您只需要获取`CopyMemory`声明和`pArrPtr`函数，剩下的就可以了。

我用这个：

```
Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" _
(ByRef Destination As Any, ByRef Source As Any, ByVal length As Long)

Private Const VT_BYREF As Long = &H4000&

' When declared in this way, the passed array is wrapped in a Variant/ByRef. It is not copied.
' Returns *SAFEARRAY, not **SAFEARRAY
Public Function pArrPtr(ByRef arr As Variant) As Long
  'VarType lies to you, hiding important differences. Manual VarType here.
  Dim vt As Integer
  CopyMemory ByVal VarPtr(vt), ByVal VarPtr(arr), Len(vt)

  If (vt And vbArray) <> vbArray Then
    Err.Raise 5, , "Variant must contain an array"
  End If

  'see https://msdn.microsoft.com/en-us/library/windows/desktop/ms221627%28v=vs.85%29.aspx
  If (vt And VT_BYREF) = VT_BYREF Then
    'By-ref variant array. Contains **pparray at offset 8
    CopyMemory ByVal VarPtr(pArrPtr), ByVal VarPtr(arr) + 8, Len(pArrPtr)  'pArrPtr = arr->pparray;
    CopyMemory ByVal VarPtr(pArrPtr), ByVal pArrPtr, Len(pArrPtr)          'pArrPtr = *pArrPtr;
  Else
    'Non-by-ref variant array. Contains *parray at offset 8
    CopyMemory ByVal VarPtr(pArrPtr), ByVal VarPtr(arr) + 8, Len(pArrPtr)  'pArrPtr = arr->parray;
  End If
End Function

Public Function ArrayExists(ByRef arr As Variant) As Boolean
  ArrayExists = pArrPtr(arr) <> 0
End Function 
```

用法：

```
? ArrayExists(someArray) 
```

您的代码似乎做同样的事情（测试 SAFEARRAY** 为 NULL），但在某种程度上我认为是编译器错误 :)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-08T21:02:32.847

我刚想到这个。很简单，不需要 API 调用。有什么问题吗？

```
Public Function IsArrayInitialized(arr) As Boolean

  Dim rv As Long

  On Error Resume Next

  rv = UBound(arr)
  IsArrayInitialized = (Err.Number = 0)

End Function 
```

**编辑**：我确实发现了一个与 Split 函数的行为相关的缺陷（实际上我称之为 Split 函数中的缺陷）。举个例子：

```
Dim arr() As String

arr = Split(vbNullString, ",")
Debug.Print UBound(arr) 
```

此时 Ubound(arr) 的值是多少？这是-1！因此，将此数组传递给此 IsArrayInitialized 函数将返回 true，但尝试访问 arr(0) 会导致下标超出范围错误。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-14T21:42:04.870

这就是我一起去的。这类似于 GSerg 的[answer](https://stackoverflow.com/questions/183353/how-do-i-determine-if-an-array-is-initialized-in-vb6#183668)，但使用了文档更好的 CopyMemory API 函数，并且是完全独立的（您可以只将数组而不是 ArrPtr(array) 传递给此函数）。它确实使用了微软[警告不要](http://support.microsoft.com/kb/199824)使用的 VarPtr 函数，但这是一个仅限 XP 的应用程序，它可以工作，所以我不担心。

是的，我知道这个函数会接受你扔给它的任何东西，但我会把错误检查作为练习留给读者。

```
Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" _
  (pDst As Any, pSrc As Any, ByVal ByteLen As Long)

Public Function ArrayIsInitialized(arr) As Boolean

  Dim memVal As Long

  CopyMemory memVal, ByVal VarPtr(arr) + 8, ByVal 4 'get pointer to array
  CopyMemory memVal, ByVal memVal, ByVal 4  'see if it points to an address...  
  ArrayIsInitialized = (memVal <> 0)        '...if it does, array is intialized

End Function 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-08T15:22:25.750

我找到了这个：

```
Dim someArray() As Integer

If ((Not someArray) = -1) Then
  Debug.Print "this array is NOT initialized"
End If 
```

**编辑**：RS Conley 在他的[回答](https://stackoverflow.com/questions/183353/how-do-i-determine-if-an-array-is-intialized-in-vb6#184407)中指出 (Not someArray) 有时会返回 0，因此您必须使用 ((Not someArray) = -1)。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-08T19:16:06.883

GSerg 和 Raven 的两种方法都是未记录的 hack，但由于 Visual BASIC 6 不再被开发，所以这不是问题。然而，Raven 的示例并不适用于所有机器。你必须像这样测试。

If (Not someArray) = -1 Then

在某些机器上，它会在其他一些较大的负数上返回零。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-09-24T19:31:27.523

在 VB6 中有一个名为“IsArray”的函数，但它不检查数组是否已初始化。如果您尝试在未初始化的数组上使用 UBound，您将收到错误 9 - 下标超出范围。我的方法与 S J 的方法非常相似，不同之处在于它适用于所有变量类型并具有错误处理功能。如果检查了非数组变量，您将收到错误 13 - 类型不匹配。

```
Private Function IsArray(vTemp As Variant) As Boolean
    On Error GoTo ProcError
    Dim lTmp As Long

    lTmp = UBound(vTemp) ' Error would occur here

    IsArray = True: Exit Function
ProcError:
    'If error is something other than "Subscript
    'out of range", then display the error
    If Not Err.Number = 9 Then Err.Raise (Err.Number)
End Function 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2019-10-20T12:24:40.160

由于想要在这里发表评论将发布答案。

正确答案似乎来自@raven：

```
Dim someArray() As Integer

If ((Not someArray) = -1) Then
  Debug.Print "this array is NOT initialized"
End If 
```

当文档或 Google 没有立即返回解释时，人们倾向于将其称为 hack。尽管似乎可以解释为**Not**不仅是**逻辑运算符，而且还是位运算符，因此它处理**结构的位表示，而不仅仅是布尔值。

例如，另一个按位运算在这里：

```
Dim x As Integer
x = 3 And 5 'x=1 
```

所以上面的 And 也被视为按位运算符。

此外，值得检查，即使与此没有直接关系，

> Not 运算符可以重载，这意味着当一个类或结构的操作数具有该类或结构的类型时，它可以重新定义其行为。 [重载](https://docs.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/operators-and-expressions/logical-and-bitwise-operators)

因此，Not 将数组解释为其按位表示，并且当数组为空或不同时以有符号数的形式区分输出。所以可以认为这不是黑客攻击，只是数组按位表示的文档，不是在这里暴露和利用的。

> Not 采用单个操作数并反转所有位，包括符号位，并将该值分配给结果。这意味着对于有符号的正数，不总是返回负值，对于负数，不总是返回正值或零值。 [逻辑位](https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/operators/not-operator)

之所以决定发布，是因为这提供了一种新方法，欢迎任何有权访问数组在其结构中表示方式的人进行扩展、完成或调整。因此，如果有人提供证据，它实际上并不打算让数组被 Not bitwise 处理，我们应该接受它不是一个黑客，实际上是最好的干净答案，如果他们提供或不提供任何支持这个理论，如果它是建设性的当然，欢迎对此发表评论。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-06-14T15:53:52.317

这是对 raven[答案](https://stackoverflow.com/a/184909/1449954)的修改。不使用 API。

```
Public Function IsArrayInitalized(ByRef arr() As String) As Boolean
'Return True if array is initalized
On Error GoTo errHandler 'Raise error if directory doesnot exist

  Dim temp As Long
  temp = UBound(arr)

  'Reach this point only if arr is initalized i.e. no error occured
  If temp > -1 Then IsArrayInitalized = True 'UBound is greater then -1

Exit Function
errHandler:
  'if an error occurs, this function returns False. i.e. array not initialized
End Function 
```

这个也应该在拆分功能的情况下工作。限制是您需要定义数组的类型（本例中为字符串）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-04-08T17:54:58.717

```
Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" (Destination As Any, Source As Any, ByVal Length As Long)
Private Declare Function ArrPtr Lib "msvbvm60" Alias "VarPtr" (arr() As Any) As Long

Private Type SafeArray
    cDims As Integer
    fFeatures As Integer
    cbElements As Long
    cLocks As Long
    pvData As Long
End Type

Private Function ArrayInitialized(ByVal arrayPointer As Long) As Boolean
    Dim pSafeArray As Long

    CopyMemory pSafeArray, ByVal arrayPointer, 4

    Dim tArrayDescriptor As SafeArray

    If pSafeArray Then
        CopyMemory tArrayDescriptor, ByVal pSafeArray, LenB(tArrayDescriptor)

        If tArrayDescriptor.cDims > 0 Then ArrayInitialized = True
    End If

End Function 
```

用法：

```
Private Type tUDT
    t As Long
End Type

Private Sub Form_Load()
    Dim longArrayNotDimmed() As Long
    Dim longArrayDimmed(1) As Long

    Dim stringArrayNotDimmed() As String
    Dim stringArrayDimmed(1) As String

    Dim udtArrayNotDimmed() As tUDT
    Dim udtArrayDimmed(1) As tUDT

    Dim objArrayNotDimmed() As Collection
    Dim objArrayDimmed(1) As Collection

    Debug.Print "longArrayNotDimmed " & ArrayInitialized(ArrPtr(longArrayNotDimmed))
    Debug.Print "longArrayDimmed " & ArrayInitialized(ArrPtr(longArrayDimmed))

    Debug.Print "stringArrayNotDimmed " & ArrayInitialized(ArrPtr(stringArrayNotDimmed))
    Debug.Print "stringArrayDimmed " & ArrayInitialized(ArrPtr(stringArrayDimmed))

    Debug.Print "udtArrayNotDimmed " & ArrayInitialized(ArrPtr(udtArrayNotDimmed))
    Debug.Print "udtArrayDimmed " & ArrayInitialized(ArrPtr(udtArrayDimmed))

    Debug.Print "objArrayNotDimmed " & ArrayInitialized(ArrPtr(objArrayNotDimmed))
    Debug.Print "objArrayDimmed " & ArrayInitialized(ArrPtr(objArrayDimmed))

    Unload Me
End Sub 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-01-21T22:54:23.410

当您初始化数组时，放置一个带有标志 = 1 的整数或布尔值。并在需要时查询此标志。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-04-30T20:06:55.190

根据我在这篇现有文章中阅读的所有信息，这在处理以未初始化形式开始的类型化数组时最适合我。

它使测试代码与 UBOUND 的使用保持一致，并且不需要使用错误处理来进行测试。

它依赖于基于零的数组（大多数开发都是这种情况）。

不得使用“Erase”清除阵列。使用下面列出的替代方案。

```
Dim data() as string ' creates the untestable holder.
data = Split(vbNullString, ",") ' causes array to return ubound(data) = -1
If Ubound(data)=-1 then ' has no contents
    ' do something
End If
redim preserve data(Ubound(data)+1) ' works to increase array size regardless of it being empty or not.

data = Split(vbNullString, ",") ' MUST use this to clear the array again. 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-09-22T16:20:41.497

处理此问题的最简单方法是确保在需要检查 Ubound 之前预先初始化数组。我需要一个在表单代码的（常规）区域中声明的数组。IE

```
Dim arySomeArray() As sometype 
```

然后在表单加载例程中，我重新调整了数组：

```
Private Sub Form_Load()

ReDim arySomeArray(1) As sometype 'insure that the array is initialized

End Sub 
```

这将允许在程序稍后的任何时候重新定义数组。当您发现阵列需要多大时，只需重新调整它。

```
ReDim arySomeArray(i) As sometype 'i is the size needed to hold the new data 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-01-29T03:24:48.073

对于任何声明为数组的变量，您可以通过调用 SafeArrayGetDim API 轻松检查数组是否已初始化。如果数组已初始化，则返回值将非零，否则函数返回零。

请注意，您不能将此函数用于包含数组的变体。这样做会导致编译错误（类型不匹配）。

```
Public Declare Function SafeArrayGetDim Lib "oleaut32.dll" (psa() As Any) As Long

Public Sub Main()
    Dim MyArray() As String

    Debug.Print SafeArrayGetDim(MyArray)    ' zero

    ReDim MyArray(64)
    Debug.Print SafeArrayGetDim(MyArray)    ' non-zero

    Erase MyArray
    Debug.Print SafeArrayGetDim(MyArray)    ' zero

    ReDim MyArray(31, 15, 63)
    Debug.Print SafeArrayGetDim(MyArray)    ' non-zero

    Erase MyArray
    Debug.Print SafeArrayGetDim(MyArray)    ' zero

    ReDim MyArray(127)
    Debug.Print SafeArrayGetDim(MyArray)    ' non-zero

    Dim vArray As Variant
    vArray = MyArray
    ' If you uncomment the next line, the program won't compile or run.
    'Debug.Print SafeArrayGetDim(vArray)     ' <- Type mismatch
End Sub 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T16:05:56.923

***如果***数组是字符串数组，可以使用 Join() 方法作为测试：

```
Private Sub Test()

    Dim ArrayToTest() As String

    MsgBox StringArrayCheck(ArrayToTest)     ' returns "false"

    ReDim ArrayToTest(1 To 10)

    MsgBox StringArrayCheck(ArrayToTest)     ' returns "true"

    ReDim ArrayToTest(0 To 0)

    MsgBox StringArrayCheck(ArrayToTest)     ' returns "false"

End Sub

Function StringArrayCheck(o As Variant) As Boolean

    Dim x As String

    x = Join(o)

    StringArrayCheck = (Len(x) <> 0)

End Function 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-08-12T04:14:44.907

我对 API 调用的唯一问题是从 32 位操作系统迁移到 64 位操作系统。
这适用于对象、字符串等...

```
Public Function ArrayIsInitialized(ByRef arr As Variant) As Boolean
    On Error Resume Next
    ArrayIsInitialized = False
    If UBound(arr) >= 0 Then If Err.Number = 0 Then ArrayIsInitialized = True
End Function 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-12-13T01:36:03.170

您可以使用函数解决问题，`Ubound()`通过使用 JScript 的对象检索总元素计数来检查数组是否为空`VBArray()`（适用于变体类型的数组，单维或多维）：

```
Sub Test()

    Dim a() As Variant
    Dim b As Variant
    Dim c As Long

    ' Uninitialized array of variant
    ' MsgBox UBound(a) ' gives 'Subscript out of range' error
    MsgBox GetElementsCount(a) ' 0

    ' Variant containing an empty array
    b = Array()
    MsgBox GetElementsCount(b) ' 0

    ' Any other types, eg Long or not Variant type arrays
    MsgBox GetElementsCount(c) ' -1

End Sub

Function GetElementsCount(aSample) As Long

    Static oHtmlfile As Object ' instantiate once

    If oHtmlfile Is Nothing Then
        Set oHtmlfile = CreateObject("htmlfile")
        oHtmlfile.parentWindow.execScript ("function arrlength(arr) {try {return (new VBArray(arr)).toArray().length} catch(e) {return -1}}"), "jscript"
    End If
    GetElementsCount = oHtmlfile.parentWindow.arrlength(aSample)

End Function 
```

对我来说，每个元素大约需要 0.4 mksec + 100 msec 初始化，使用 VB 6.0.9782 编译，因此 10M 个元素的数组大约需要 4.1 秒。相同的功能可以通过`ScriptControl`ActiveX 实现。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-07-12T15:55:30.757

```
If ChkArray(MyArray)=True then
   ....
End If

Public Function ChkArray(ByRef b) As Boolean
    On Error goto 1
    If UBound(b) > 0 Then ChkArray = True
End Function 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-09-14T10:08:21.677

有两种稍微不同的场景需要测试：

1.  数组已初始化（实际上它不是空指针）
2.  数组已初始化且至少有一个元素

情况 2 是必需的，例如`Split(vbNullString, ",")`返回带有and的`String`数组。以下是我可以为每个测试生成的最简单的示例代码片段：`LBound=0``UBound=-1`

```
Public Function IsInitialised(arr() As String) As Boolean
  On Error Resume Next
  IsInitialised = UBound(arr) <> 0.5
End Function

Public Function IsInitialisedAndHasElements(arr() As String) As Boolean
  On Error Resume Next
  IsInitialisedAndHasElements = UBound(arr) >= LBound(arr)
End Function 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-02-15T00:36:33.777

问题的标题询问如何确定数组是否已初始化，但是，在阅读了问题之后，看起来真正的问题是如何获取`UBound`未初始化的数组。

这是我的解决方案（针对实际问题，而不是标题）：

```
Function UBound2(Arr) As Integer
  On Error Resume Next
  UBound2 = UBound(Arr)
  If Err.Number = 9 Then UBound2 = -1
  On Error GoTo 0
End Function 
```

此函数在以下四种情况下工作，我发现前三种`Arr`是由外部 dll COM 创建的，第四种`Arr`是在未`ReDim`-ed 时发现的（这个问题的主题）：

*   `UBound(Arr)`有效，因此调用`UBound2(Arr)`会增加一些开销，但不会造成太大伤害
*   `UBound(Arr)`在定义的函数中失败`Arr`，但在内部成功`UBound2()`
*   `UBound(Arr)`在定义`Arr`和 in的函数中都失败了`UBound2()`，因此错误处理完成了工作
*   之后`Dim Arr() As Whatever`,之前`ReDim Arr(X)`

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-09-26T01:17:42.743

我在网上看到很多关于**如何判断数组是否已初始化**的建议。下面是一个函数，它将采用任何数组，检查该数组的 ubound 是什么，将数组重新调整为 ubound +1（有或没有 PRESERVER），然后返回数组的当前 ubound 是什么，没有错误。

```
Function ifuncRedimUbound(ByRef byrefArr, Optional bPreserve As Boolean)
On Error GoTo err:

1: Dim upp%:           upp% = (UBound(byrefArr) + 1)

errContinue:

If bPreserve Then
         ReDim Preserve byrefArr(upp%)
Else
         ReDim byrefArr(upp%)
End If

ifuncRedimUbound = upp%

Exit Function
err:
If err.Number = 0 Then Resume Next
    If err.Number = 9 Then ' subscript out of range (array has not been initialized yet)
             If Erl = 1 Then
                         upp% = 0
                         GoTo errContinue:
             End If
    Else
               ErrHandler.ReportError "modArray", ifuncRedimUbound, "1", err.Number, err.Description
    End If
End Function 
```

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2014-06-25T06:52:15.883

这对我有用，这有什么错误吗？

```
If IsEmpty(a) Then
    Exit Function
End If 
```

[MSDN](http://msdn.microsoft.com/en-us/library/aa445044%28v=vs.60%29.aspx)

* * *

## 回答 #22

> 赞同：-8
> 
> 时间：2008-10-08T15:28:38.263

```
Dim someArray() as Integer    

If someArray Is Nothing Then
    Debug.print "this array is not initialised"
End If 
```

# java - 在哪里（哪一层）放置实体查询方法、“持久”方法等？

> ID：183366
> 
> 赞同：1
> 
> 时间：2008-10-08T15:24:44.260
> 
> 标签：java, hibernate, jpa, ejb

我有一个带有一些 JPA/Hibernate 实体的 SEAM 应用程序。我现在想知道将我的查询和持久性方法放在哪里。

默认选择似乎将它们放在注入的会话 bean 层中

```
@PersistenceContext(...) @Inject EntityManager entityManager; 
```

但我想我宁愿拥有实体本身的方法。优点/缺点是什么？

1.  可测试性？
2.  好看吗？
3.  表现？

是否有人从实体上的方法而不是会话 bean 中获得与 EntityManager 等交互的最佳实践的链接？

最好的，安德斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:28:51.867

我没有使用 SEAM 的经验，但根据我使用 Java 项目的经验，我发现让 bean 远离持久方法是最简单的方法。我们通常做的：

*   拥有业务对象的 bean（例如“用户”和“设置”）
*   有一个可以持久化和检索这些 bean 的 DAO 层（简单的 CRUD）
*   有一个服务层，它现在知道如何处理 bean，甚至可能如何构建 bean 的聚合

这样一来，一切都非常分离，并且很容易进行单元测试。性能通常不是此设置的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T15:34:07.783

是的，这也是我之前所做的。

总的来说，我认为 EJB 非常冗长和样板化，但 SEAM 实际上有点帮助，所以这就是为什么在我当前的项目中，额外的会话 bean 层只是为了查询和持久化让我烦恼。我有一种感觉，如果我可以杀死这一层，我可以制作一个相当简洁的应用程序......

# c# - 在 C# 中取消订阅匿名方法

> ID：183367
> 
> 赞同：239
> 
> 时间：2008-10-08T15:24:46.307
> 
> 标签：c#, delegates, anonymous-methods

是否可以从事件中取消订阅匿名方法？

如果我订阅这样的事件：

```
void MyMethod()
{
    Console.WriteLine("I did it!");
}

MyEvent += MyMethod; 
```

我可以像这样取消订阅：

```
MyEvent -= MyMethod; 
```

但是，如果我使用匿名方法订阅：

```
MyEvent += delegate(){Console.WriteLine("I did it!");}; 
```

是否可以取消订阅此匿名方法？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：239
> 
> 时间：2008-10-08T15:33:38.177

```
Action myDelegate = delegate(){Console.WriteLine("I did it!");};

MyEvent += myDelegate;

// .... later

MyEvent -= myDelegate; 
```

只需保留对代表的引用即可。

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2008-10-08T15:34:51.497

一种技术是声明一个变量来保存匿名方法，然后可以在匿名方法本身内部使用该变量。这对我有用，因为所需的行为是在事件处理后取消订阅。

例子：

```
MyEventHandler foo = null;
foo = delegate(object s, MyEventArgs ev)
    {
        Console.WriteLine("I did it!");
        MyEvent -= foo;
    };
MyEvent += foo; 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-08T15:26:56.067

从记忆中看，规范明确地不保证使用匿名方法创建的委托的等效性。

如果您需要取消订阅，您应该使用“普通”方法或将委托保留在其他地方，以便您可以使用与您订阅时完全相同的委托来取消订阅。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2017-08-15T05:24:11.720

由于[C# 7.0 本地函数](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/local-functions)特性已经发布，[J c](https://stackoverflow.com/users/25837)[建议](https://stackoverflow.com/a/183417/3237954)的方法变得非常简洁。

```
void foo(object s, MyEventArgs ev)
{
    Console.WriteLine("I did it!");
    MyEvent -= foo;
};
MyEvent += foo; 
```

所以，老实说，这里没有匿名函数作为变量。但我认为在您的案例中使用它的动机可以应用于本地功能。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-07-23T01:53:51.303

在 3.0 中可以缩短为：

```
MyHandler myDelegate = ()=>Console.WriteLine("I did it!");
MyEvent += myDelegate;
...
MyEvent -= myDelegate; 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2011-06-23T23:11:50.210

您可以检测您的类，而不是保留对任何委托的引用，以便将事件的调用列表返回给调用者。基本上你可以这样写（假设 MyEvent 是在 MyClass 中声明的）：

```
public class MyClass 
{
  public event EventHandler MyEvent;

  public IEnumerable<EventHandler> GetMyEventHandlers()  
  {  
      return from d in MyEvent.GetInvocationList()  
             select (EventHandler)d;  
  }  
} 
```

因此，您可以从 MyClass 外部访问整个调用列表并取消订阅您想要的任何处理程序。例如：

```
myClass.MyEvent -= myClass.GetMyEventHandlers().Last(); 
```

我在[这里](http://www.h3mm3.com/2011/06/unsubscribing-to-events-in-c.html)写了一篇关于这种技术的完整文章。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-08T15:29:04.330

一种蹩脚的方法：

```
public class SomeClass
{
  private readonly IList<Action> _eventList = new List<Action>();

  ...

  public event Action OnDoSomething
  {
    add {
      _eventList.Add(value);
    }
    remove {
      _eventList.Remove(value);
    }
  }
} 
```

1.  覆盖事件添加/删除方法。
2.  保留这些事件处理程序的列表。
3.  需要时，将它们全部清除并重新添加其他的。

这可能不起作用或不是最有效的方法，但应该可以完成工作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-11-17T08:05:49.073

如果您希望能够控制取消订阅，那么您需要按照您接受的答案中指示的路线进行。但是，如果您只是关心在订阅类超出范围时清除引用，那么还有另一个（稍微复杂的）解决方案涉及使用弱引用。我刚刚发布了一个关于这个主题的[问题和答案。](https://stackoverflow.com/questions/1747235/weak-event-handler-model-for-use-with-lambdas/1747236#1747236)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-07-12T14:11:21.187

一个简单的解决方案：

只需将事件句柄变量作为参数传递给自身。如果您遇到由于多线程而无法访问原始创建的变量的情况，您可以使用以下方法：

```
MyEventHandler foo = null;
foo = (s, ev, mehi) => MyMethod(s, ev, foo);
MyEvent += foo;

void MyMethod(object s, MyEventArgs ev, MyEventHandler myEventHandlerInstance)
{
    MyEvent -= myEventHandlerInstance;
    Console.WriteLine("I did it!");
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-01-21T03:19:30.787

如果你想用这个委托引用一些对象，可能你可以使用 Delegate.CreateDelegate(Type, Object target, MethodInfo methodInfo) .net 考虑委托等于 target 和 methodInfo

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-13T06:40:33.820

如果最好的方法是在订阅的 eventHandler 上保留一个引用，这可以使用 Dictionary 来实现。

在此示例中，我必须使用匿名方法来包含一组 DataGridView 的 mergeColumn 参数。

使用 MergeColumn 方法并将 enable 参数设置为 true 会启用事件，而使用 false 会禁用它。

```
static Dictionary<DataGridView, PaintEventHandler> subscriptions = new Dictionary<DataGridView, PaintEventHandler>();

public static void MergeColumns(this DataGridView dg, bool enable, params ColumnGroup[] mergedColumns) {

    if(enable) {
        subscriptions[dg] = (s, e) => Dg_Paint(s, e, mergedColumns);
        dg.Paint += subscriptions[dg];
    }
    else {
        if(subscriptions.ContainsKey(dg)) {
            dg.Paint -= subscriptions[dg];
            subscriptions.Remove(dg);
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-10T22:23:32.330

有一种方法可以通过自己实现闭包而不是 lambda 表达式来解决这个问题。

假设用作捕获变量的类如下。

```
public class A
{
    public void DoSomething()
    {
        ...
    }
}

public class B
{
    public void DoSomething()
    {
        ...
    }
}

public class C
{
    public void DoSomething()
    {
        ...
    }
} 
```

这些类将用作捕获变量，因此我们将它们实例化。

```
A a = new A();
B b = new B();
C c = new C(); 
```

实现闭包类，如下所示。

```
private class EventHandlerClosure
{
    public A a;
    public B b;
    public C c;

    public event EventHandler Finished;

    public void MyMethod(object, MyEventArgs args)
    {
        a.DoSomething();
        b.DoSomething();
        c.DoSomething();
        Console.WriteLine("I did it!");

        Finished?.Invoke(this, EventArgs.Empty);
    }
} 
```

实例化闭包类，创建一个处理程序，然后订阅事件并订阅取消订阅闭包类的 Finished 事件的 lambda 表达式。

```
var closure = new EventHandlerClosure
{
    a = a,
    b = b,
    c = c
};
var handler = new MyEventHandler(closure.MyMethod);
MyEvent += handler;
closure.Finished += (s, e)
{
    MyEvent -= handler;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-07-12T01:12:14.007

我最近为一个 C# 项目发现了这个相当古老的线程，并发现所有答案都非常有用。但是，有一个方面不适用于我的特定用例 - 它们都将取消订阅事件的负担放在了订阅者身上。我知道有人可能会说这是订户的工作来处理这个问题，但这对我的项目来说是不现实的。

我对事件的主要用例是监听计时器以对动画进行排序（这是一个游戏）。在这种情况下，我使用大量匿名委托将序列链接在一​​起。存储对这些的引用不是很实用。

为了解决这个问题，我围绕一个事件创建了一个包装类，让您可以订阅单个调用。

```
internal class EventWrapper<TEventArgs> {

    private event EventHandler<TEventArgs> Event;
    private readonly HashSet<EventHandler<TEventArgs>> _subscribeOnces;

    internal EventWrapper() {
        _subscribeOnces = new HashSet<EventHandler<TEventArgs>>();
    }

    internal void Subscribe(EventHandler<TEventArgs> eventHandler) {
        Event += eventHandler;
    }

    internal void SubscribeOnce(EventHandler<TEventArgs> eventHandler) {
        _subscribeOnces.Add(eventHandler);
        Event += eventHandler;
    }

    internal void Unsubscribe(EventHandler<TEventArgs> eventHandler) {
        Event -= eventHandler;
    }

    internal void UnsubscribeAll() {
        foreach (EventHandler<TEventArgs> eventHandler in Event?.GetInvocationList()) {
            Event -= eventHandler;
        }
    }

    internal void Invoke(Object sender, TEventArgs e) {
        Event?.Invoke(sender, e);
        if(_subscribeOnces.Count > 0) {
            foreach (EventHandler<TEventArgs> eventHandler in _subscribeOnces) {
                Event -= eventHandler;
            }
            _subscribeOnces.Clear();
        }
    }

    internal void Remove() {
        UnsubscribeAll();
        _subscribeOnces.Clear();
    }
} 
```

在类中使用它的另一个好处是您可以将其设为私有并仅公开您想要的功能。例如，仅公开 SubscribeOnce（而不是订阅）方法。

```
public class MyClass {

    private EventWrapper<MyEventEventArgs> myEvent = new EventWrapper<MyEventEventArgs>();

    public void FireMyEvent() {
        myEvent.Invoke(this, new MyEventEventArgs(1000, DateTime.Now));
    }

    public void SubscribeOnce(EventHandler<MyEventEventArgs> eventHandler) {
        myEvent.SubscribeOnce(eventHandler);
    }

    public class MyEventEventArgs : EventArgs {
        public int MyInt;
        public DateTime MyDateTime;

        public MyEventEventArgs(int myInt, DateTime myDateTime) {
            MyInt = myInt;
            MyDateTime = myDateTime;
        }
    }
} 
```

这里的权衡是为每个事件创建一个实例的开销更大，但是在我的场景中 - 这是一个可接受的权衡，以确保有效地收集垃圾并且代码在订阅者端更易于维护。 [完整的例子在这里](https://dotnetfiddle.net/uTot06)。

# javascript - JavaScript 中的跨浏览器 XPath 实现

> ID：183369
> 
> 赞同：34
> 
> 时间：2008-10-08T15:25:11.797
> 
> 标签：javascript, xml, xpath

我正在寻找一个 XPath 库来查询 FF、IE、Opera 和 Safari 中的 XML 文档……但找不到。你见过吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-09-01T08:06:38.483

Google 刚刚发布了 Wicked Good XPath - 对 Cybozu Lab 著名的 JavaScript-XPath 的重写。

链接：[https ://github.com/google/wicked-good-xpath](https://github.com/google/wicked-good-xpath)

重写后的版本比原来的实现小 40%，快 30%。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T19:10:38.130

[**Google 的 AJAXSLT**](http://code.google.com/p/ajaxslt/)开源项目非常符合规定的要求。

正如他们自己的描述所说：

“AJAXSLT 是**JavaScript**中 XSLT 的实现。因为 XSLT 使用 XPath，**所以它也是 XPath 的实现，可以独立于 XSLT 使用**。这种实现的优点是，它使 XSLT 在比本机提供的更多浏览器上统一可用，并且如有必要，它可以扩展到更多的浏览器 **。AJAXSLT 对于积极争取其高级 Web 应用程序的跨浏览器兼容性的开发人员来说很有趣**。

**更新**：在 2010 年底，Michael Kay 一直在使用 GWT 将他的 Saxon XSLT 2.0 处理器编译为 Javascript（从而使其可用于所有 5 个主要浏览器）。很可能很快就会有一个轻量级的浏览器内撒克逊人。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T15:33:46.660

您可以使用[jQuery 的基本 XPath 插件](https://github.com/ilinsky/jquery-xpath)来获得 XPath 查询功能。

此外，您可以考虑阅读[有关 XPath XML 处理的这篇文章](http://blog.reindel.com/2007/09/24/jquery-and-xml-revisited/)（同样使用 jQuery）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-09-19T19:08:59.313

这就是我使用的

```
// xpath.js
// ------------------------------------------------------------------
//
// a cross-browser xpath class.
// Derived form code at http://jmvidal.cse.sc.edu/talks/javascriptxml/xpathexample.html.
//
// Tested in Chrome, IE9, and FF6.0.2
//
// Author     : Dino
// Created    : Sun Sep 18 18:39:58 2011
// Last-saved : <2011-September-19 15:07:20>
//
// ------------------------------------------------------------------

/*jshint browser:true */

(function(globalScope) {
    'use strict';

    /**
     * The first argument to this constructor is the text of the XPath expression.
     *
     * If the expression uses any XML namespaces, the second argument must
     * be a JavaScript object that maps namespace prefixes to the URLs that define
     * those namespaces.  The properties of this object are taken as prefixes, and
     * the values associated to those properties are the URLs.
     *
     * There's no way to specify a non-null default XML namespace. You need to use
     * prefixes in order to reference a non-null namespace in a query.
     *
     */

    var expr = function(xpathText, namespaces) {
        var prefix;
        this.xpathText = xpathText;    // Save the text of the expression
        this.namespaces = namespaces || null;  // And the namespace mapping

        if (document.createExpression) {
            this.xpathExpr = true;
            // I tried using a compiled xpath expression, it worked on Chrome,
            // but it did not work on FF6.0.2\.  Threw various exceptions.
            // So I punt on "compiling" the xpath and just evaluate it.
            //
            // This flag serves only to store the result of the check.
            //

                // document.createExpression(xpathText,
                // // This function is passed a
                // // namespace prefix and returns the URL.
                // function(prefix) {
                //     return namespaces[prefix];
                // });
        }
        else {
            // assume IE and convert the namespaces object into the
            // textual form that IE requires.
            this.namespaceString = "";
            if (namespaces !== null) {
                for(prefix in namespaces) {
                    // Add a space if there is already something there
                    if (this.namespaceString.length>1) this.namespaceString += ' ';
                    // And add the namespace
                    this.namespaceString += 'xmlns:' + prefix + '="' +
                        namespaces[prefix] + '"';
                }
            }
        }
    };

    /**
     * This is the getNodes() method of XPath.Expression.  It evaluates the
     * XPath expression in the specified context.  The context argument should
     * be a Document or Element object.  The return value is an array
     * or array-like object containing the nodes that match the expression.
     */
    expr.prototype.getNodes = function(xmlDomCtx) {
        var self = this, a, i,
            doc = xmlDomCtx.ownerDocument;

        // If the context doesn't have ownerDocument, it is the Document
        if (doc === null) doc = xmlDomCtx;

        if (this.xpathExpr) {
            // could not get a compiled XPathExpression to work in FF6
            // var result = this.xpathExpr.evaluate(xmlDomCtx,
            //     // This is the result type we want
            //     XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
            //     null);

            var result = doc.evaluate(this.xpathText,
                xmlDomCtx,
                function(prefix) {
                    return self.namespaces[prefix];
                },
                XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
                null);

            // Copy the results into an array.
            a = [];
            for(i = 0; i < result.snapshotLength; i++) {
                a.push(result.snapshotItem(i));
            }
            return a;
        }
        else {
            // evaluate the expression using the IE API.
            try {
                // This is IE-specific magic to specify prefix-to-URL mapping
                doc.setProperty("SelectionLanguage", "XPath");
                doc.setProperty("SelectionNamespaces", this.namespaceString);

                // In IE, the context must be an Element not a Document,
                // so if context is a document, use documentElement instead
                if (xmlDomCtx === doc) xmlDomCtx = doc.documentElement;
                // Now use the IE method selectNodes() to evaluate the expression
                return xmlDomCtx.selectNodes(this.xpathText);
            }
            catch(e2) {
                throw "XPath is not supported by this browser.";
            }
        }
    };

    /**
     * This is the getNode() method of XPath.Expression.  It evaluates the
     * XPath expression in the specified context and returns a single matching
     * node (or null if no node matches).  If more than one node matches,
     * this method returns the first one in the document.
     * The implementation differs from getNodes() only in the return type.
     */
    expr.prototype.getNode = function(xmlDomCtx) {
        var self = this,
                doc = xmlDomCtx.ownerDocument;
        if (doc === null) doc = xmlDomCtx;
        if (this.xpathExpr) {

            // could not get compiled "XPathExpression" to work in FF4
            // var result =
            //     this.xpathExpr.evaluate(xmlDomCtx,
            //     // We just want the first match
            //     XPathResult.FIRST_ORDERED_NODE_TYPE,
            //     null);

            var result = doc.evaluate(this.xpathText,
                xmlDomCtx,
                function(prefix) {
                    return self.namespaces[prefix];
                },
                XPathResult.FIRST_ORDERED_NODE_TYPE,
                null);
            return result.singleNodeValue;
        }
        else {
            try {
                doc.setProperty("SelectionLanguage", "XPath");
                doc.setProperty("SelectionNamespaces", this.namespaceString);
                if (xmlDomCtx == doc) xmlDomCtx = doc.documentElement;
                return xmlDomCtx.selectSingleNode(this.xpathText);
            }
            catch(e) {
                throw "XPath is not supported by this browser.";
            }
        }
    };

    var getNodes = function(context, xpathExpr, namespaces) {
        return (new globalScope.XPath.Expression(xpathExpr, namespaces)).getNodes(context);
    };

    var getNode  = function(context, xpathExpr, namespaces) {
        return (new globalScope.XPath.Expression(xpathExpr, namespaces)).getNode(context);
    };

    /**
     * XPath is a global object, containing three members.  The
     * Expression member is a class modelling an Xpath expression.  Use
     * it like this:
     *
     *   var xpath1 = new XPath.Expression("/kml/Document/Folder");
     *   var nodeList = xpath1.getNodes(xmldoc);
     *
     *   var xpath2 = new XPath.Expression("/a:kml/a:Document",
     *                                   { a : 'http://www.opengis.net/kml/2.2' });
     *   var node = xpath2.getNode(xmldoc);
     *
     * The getNodes() and getNode() methods are just utility methods for
     * one-time use. Example:
     *
     *   var oneNode = XPath.getNode(xmldoc, '/root/favorites');
     *
     *   var nodeList = XPath.getNodes(xmldoc, '/x:derp/x:twap', { x: 'urn:0190djksj-xx'} );
     *
     */

    // place XPath into the global scope.
    globalScope.XPath = {
        Expression : expr,
        getNodes   : getNodes,
        getNode    : getNode
    };

}(this)); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T15:52:00.573

看看[http://dev.abiss.gr/sarissa/](http://dev.abiss.gr/sarissa/)项目。他们已将大部分与 XML 相关的 API 迁移到 IE，以及评估文档对象的方法。事实上，jQuery 没有 XPath 处理器，它有一个非常简单的路径选择器，例如：/a/b/c only

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-01-31T13:56:43.907

这是 Javascript 中 XPath 的最新跨浏览器实现： [https ://github.com/andrejpavlovic/xpathjs](https://github.com/andrejpavlovic/xpathjs)

它功能齐全且经过单元测试，并具有强大的支持。最酷的部分是它还支持命名空间！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T16:01:07.450

您可能想尝试[支持](https://github.com/ilinsky/jquery-xpath)跨浏览器工作的 XPath 2.0 语法的 jQuery XPath 插件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T08:33:36.197

我不认为它允许即席查询，但您可以查看 Johann Burkard 的[XSLT jQuery 插件以](http://johannburkard.de/software/xsltjs/)获取有关如何实现 XPath 查询的灵感。我在我的[jQuery Reference](http://code.google.com/p/jquery-reference/) Dashboard 小部件中使用它，它非常可靠。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-15T08:45:54.773

您可以利用每个浏览器现有的原生 DOM 支持。为此，您必须创建自己的包装器，原因是浏览器之间的差异。你可以看看[http://dotnetcaffe.blogspot.com](http://dotnetcaffe.blogspot.com)

最好的祝福

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-22T12:21:29.187

[FormFaces](http://www.formfaces.com/)（JS 中的 XForms 实现）具有可靠的 XPath 引擎，可以轻松提取和独立使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-02-22T20:48:16.670

我认为您可以在这里使用 Cameron McCormack 的[xpath 库](http://mcc.id.au/xpathjs)。这对我来说非常有用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-11-25T18:34:57.313

另一个选项可能是[LlamaLab XPath.js](http://llamalab.com/js/xpath/)（虽然似乎有点旧）

# eclipse - 在编写 Eclipse JDT 插件时，有没有办法跟踪代码中某些字符串的外观？

> ID：183372
> 
> 赞同：1
> 
> 时间：2008-10-08T15:25:36.663
> 
> 标签：eclipse, eclipse-jdt, markers

我正在为 JDT 编写一个 Eclipse 插件。

我需要一个跟踪某些字符串或正则表达式并可能创建标记的功能。

我知道 Eclipse 已经为 //TODO 注释做到了这一点，例如（为它们创建任务标记），但我不确定我是否可以使用相同的机制。我可以自己写，但担心效率太低，而且对代码更改不够敏感。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T12:32:22.707

它不应该很复杂。将自己注册为资源侦听器或构建器，并使用 AST 解析修改后的文本文件。

# .net - Mono .NET 是否支持和编译 C++/CLI？

> ID：183377
> 
> 赞同：34
> 
> 时间：2008-10-08T15:26:37.377
> 
> 标签：.net, mono, c++-cli

Mono .NET 是否支持和编译 C++/CLI？

如果没有，你知道他们是否有支持它的计划吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-11T11:13:04.490

我们没有用于 C++/CLI 的编译器，对于非常小的用户群来说，这将是一项非常大的工作。还要考虑到 C++/CLI 规范本身就有缺陷且不可移植，因此在一般情况下能够编译它并没有多大帮助。

您可以使用 MS .NET 编译器进行编译并在具有以下限制的情况下以单声道运行：

1.  如果 C++/CLI 应用程序是纯托管的，那么可以在任何系统上使用 mono 运行（但是，为什么要使用如此丑陋的语言而不是 C#？）

2.  在其他情况下，在 windows 上使用 mono 运行（C++/CLI 应用程序通常是不可移植的，并且包含本机代码，因此它们只能在 windows 上运行，并且对于 mono 的主要目标是在 Linux 上运行托管程序无趣）

请注意，MS 本身最终会放弃 C++/CLI，所以不要在它上面投入过多并切换到 C#。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2012-01-29T10:25:46.980

Mono 最近在[CXXI](https://github.com/mono/cxxi)中的 C++ 互操作性方面取得了相当大的进步。

[从这篇文章](http://tirania.org/blog/archive/2011/Dec-19.html)中可以看出，新的 CXXI 技术允许 C#/.NET 开发人员：

*   从 C# 或任何其他 .NET 语言轻松使用现有的 C++ 类
*   从 C# 实例化 C++ 对象
*   从 C# 代码调用 C++ 类中的 C++ 方法
*   从 C# 代码调用 C++ 内联方法（前提是您的库是使用 -fkeep-inline-functions 编译的或者您提供了代理库）
*   从 C# 继承 C++ 类
*   用 C# 方法覆盖 C++ 方法
*   向 C# 代码和 C++ 公开 C++ 类或混合 C++/C# 类的实例，就好像它们是本机代码一样。

CXXI 是 Google Summer of Code 两个暑期工作的成果，旨在提高 Mono 与 C++ 语言的互操作性。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-08T15:43:34.490

Mono 能够运行由 C++/CLI 生成的“纯”程序集，即。那些不包含**任何**本机代码的。[MSDN](http://msdn.microsoft.com/en-us/library/k8d11d4s.aspx)上记录了 C++ 编译器支持的各种 /clr 选项。

目前不支持编译 C++/CLI。已经有一些关于修改 GCC 以发出 IL 的工作，但它并不完整（并且看起来不活跃）。见这篇[文章](http://www.mono-project.com/CPlusPlus)。

我不相信 Microsoft 记录了在程序集中包含本机代码的格式，因此很难支持这一点。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-07-05T16:57:52.043

这是一个非常古老的问题，几年后得到了非常有趣的答案。
截至目前，[tritao/CppSharp](https://github.com/tritao/CppSharp)是[mono/cxxi](https://github.com/mono/cxxi)开发最活跃的分支，它于 2013 年移回[mono](https://github.com/mono)存储库，并且从那时起一直在积极开发，当前的树可以在[mono/CppSharp找到](https://github.com/mono/CppSharp)

他们的自述文件在[这里](https://github.com/mono/CppSharp/blob/master/README.md)，“生成器”的功能是：

*   多个后端：C++/CLI 和 C# P/Invoke
*   多个 ABI：Itanium、MS、ARM、iOS 和 iOS64
*   多平台：Windows、OS X 和 Linux
*   虚拟表覆盖支持
*   多重继承支持
*   通过用户通行证轻松扩展语义
*   对 STL 的工作中支持（仅限 C++/CLI）
*   强类型自定义 API 和类型映射

它还带有很多很酷的 AST 东西和一个解析器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-26T05:40:48.700

[不，Mono不支持](http://www.mono-project.com/CPlusPlus)C++/CLI，并且可能永远不会支持，尽管使用 MS 编译器生成纯 IL 将允许完全托管的代码在 Mono 下运行。

作为一种互操作语言，C++/CLI 的存在使得调用非托管代码成为可能。另一种选择是使用 P/Invoke，尽管存在问题，但它有[据可查。](http://www.mono-project.com/Interop_with_Native_Libraries)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T15:13:42.950

在 Mono 2.4 上，您可以运行在带有 /clr:safe 开关的 Visual Studio 2008 下编译的 C++/CLI 应用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T15:41:53.603

去[这里](http://www.mono-project.com/Languages "这里")看看“缺少的语言”。但不能编译不代表不能*运行*。您可以使用框架 sdk 编译您​​的 C++ 代码并尝试使用单声道运行它。总之值得一试。

# html - 通过 Linq to XML 查询时如何处理任意命名空间？

> ID：183391
> 
> 赞同：19
> 
> 时间：2008-10-08T15:29:34.470
> 
> 标签：html, xml, linq, namespaces, linq-to-xml

我有一个项目，我正在使用一些特别丑陋的“实时”HTML，并使用 HTML Agility Pack 将其强制转换为正式的 XML DOM。然后我想要做的是使用 Linq to XML 查询这个，以便我可以刮出我需要的位。我正在使用[此处](http://vijay.screamingpens.com/archive/2008/05/26/linq-amp-lambda-part-3-html-agility-pack-to-linq.aspx)描述的方法将HtmlDocument 解析为 XDocument，但是在尝试对此进行查询时，我不确定如何处理命名空间。在一个特定的文档中，原始 HTML 实际上是带有以下标记的格式很差的 XHTML：

```
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"> 
```

尝试从此文档中查询时，似乎命名空间属性阻止我执行以下操作：

```
var x = xDoc.Descendants("div");
// returns null 
```

显然，对于那些“div”标签，只有 LocalName 是“div”，但正确的标签名称是命名空间加上“div”。我试图对 XML 命名空间的问题进行一些研究，似乎我可以通过这种方式查询来绕过命名空间：

```
var x = 
    (from x in xDoc.Descendants()
     where x.Name.LocalName == "div"
     select x);
// works 
```

然而，这似乎是一个相当老套的解决方案，并没有正确解决命名空间问题。据我了解，正确的 XML 文档可以包含多个名称空间，因此处理它的正确方法应该是解析出我正在查询的名称空间。有没有其他人不得不这样做？我只是让它变得复杂吗？我知道我可以通过坚持使用 HtmlDocument 并使用 XPath 查询来避免这一切，但如果可能的话，我宁愿坚持我所知道的（Linq），我也更愿意知道我没有为进一步的命名空间做准备——相关问题在路上。

在这种情况下处理命名空间的正确方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-08T15:32:10.113

使用`LocalName`应该没问题。如果您不在乎它在哪个名称空间中，我根本不会认为它是一种黑客行为。

如果你知道你想要的命名空间并且你想指定它，你可以：

```
var ns = "{http://www.w3.org/1999/xhtml}";
var x  = xDoc.Root.Descendants(ns + "div"); 
```

（[MSDN 参考](http://msdn.microsoft.com/en-us/library/bb669152.aspx)）

您还可以获得文档中使用的所有命名空间的列表：

```
var namespaces = (from x in xDoc.Root.DescendantsAndSelf()
                  select x.Name.Namespace).Distinct(); 
```

我想你可以用它来做到这一点，但它实际上并不是一个黑客：

```
var x = namespaces.SelectMany(ns=>xDoc.Root.Descendants(ns+"div")); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-06T16:57:59.540

如果您知道命名空间将由 XML 的根元素声明（通常是这种情况），您可以这样做：

```
var ns = xDoc.Root.Name.Namespace;
var x = xDoc.Descendants(ns + "div"); 
```

* * *

## 回答 #3

> 赞同：-11
> 
> 时间：2008-10-08T15:34:14.820

我认为您的 Google-fu 让您失望了：

[http://www.google.com.au/search?hl=en&q=linq+xml+namespaces](http://www.google.com.au/search?hl=en&q=linq+xml+namespaces)

# xaml - 字符串属性中的换行符

> ID：183406
> 
> 赞同：303
> 
> 时间：2008-10-08T15:32:37.833
> 
> 标签：xaml

将文本设置为属性时，如何在文本中添加换行符，即：

```
<TextBlock Text="Stuff on line1 \n Stuff on line2" /> 
```

对于我的特殊情况，将其分解为分解格式不是一种选择。我需要的是某种方式来模拟以下内容：

```
<TextBlock>
  <TextBlock.Text>
    Stuff on line1 <LineBreak/>
    Stuff on line2
  </TextBlock.Text>
<TextBlock/> 
```

* * *

## 回答 #1

> 赞同：597
> 
> 时间：2008-10-08T15:39:42.500

```
<TextBlock Text="Stuff on line1&#x0a;Stuff on line 2"/> 
```

您可以使用任何十六进制编码的值来表示文字。在这种情况下，我使用了换行符（char 10）。如果你想做“经典” `vbCrLf`，那么你可以使用`&#x0d;&#x0a;`

顺便说一句，请注意语法：它是与号、磅、字母*x*，然后是所需字符的十六进制值，最后是分号。

另外：为了完整起见，您可以绑定到已经嵌入了换行符的文本，就像后面代码中的常量或在运行时构造的变量一样。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2010-10-20T12:21:08.437

可能您可以使用属性 xml:space="preserve" 在源 XAML 中保留空格

```
<TextBlock xml:space="preserve">
Stuff on line 1
Stuff on line 2
</TextBlock> 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2010-11-02T19:01:32.697

当您需要在字符串中执行此操作时（例如：在您的资源中），您需要使用`xml:space="preserve"` *和*符号字符代码：

```
<System:String x:Key="TwoLiner" xml:space="preserve">First line&#10;Second line</System:String> 
```

或文本中的文字换行符：

```
<System:String x:Key="TwoLiner" xml:space="preserve">First line 
Second line</System:String> 
```

警告：如果您像第二个示例那样编写代码，则您插入了换行符，*或者*插入了回车和换行符，具体取决于您的操作系统和/或文本编辑器使用的行尾。例如，如果您编写它并将其从 linux 系统提交到 git，一切可能看起来都很好——但是如果有人将它克隆到 Windows，git 会将您的行尾转换为`\r\n`并取决于您的字符串的用途......可能会打破世界。

当您保留空白时，请注意这一点。如果你写这样的东西：

```
<System:String x:Key="TwoLiner" xml:space="preserve">
First line 
Second line 
</System:String> 
```

您实际上已经添加了四个换行符，可能是四个回车符，以及可能不可见的尾随空格......

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2013-07-20T11:34:50.760

您只需要删除`<TextBlock.Text>`并简单地添加您的内容，如下所示：

```
 <Grid Margin="20">
        <TextBlock TextWrapping="Wrap" TextAlignment="Justify" FontSize="17">
        <Bold FontFamily="Segoe UI Light" FontSize="70">I.R. Iran</Bold><LineBreak/>
        <Span FontSize="35">I</Span>ran or Persia, officially the <Italic>Islamic Republic of Iran</Italic>, 
        is a country in Western Asia. The country is bordered on the 
        north by Armenia, Azerbaijan and Turkmenistan, with Kazakhstan and Russia 
        to the north across the Caspian Sea.<LineBreak/>
        <Span FontSize="10">For more information about Iran see <Hyperlink NavigateUri="http://en.WikiPedia.org/wiki/Iran">WikiPedia</Hyperlink></Span>
            <LineBreak/>
            <LineBreak/>
            <Span FontSize="12">
                <Span>Is this page helpful?</Span>
                <Button Content="No"/>
                <Button Content="Yes"/>
            </Span>
    </TextBlock>
    </Grid> 
```

![在此处输入图像描述](https://i.stack.imgur.com/VRqGh.png)

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-02-12T14:54:12.090

请注意，要执行此操作，您需要在 Text 属性中执行此操作，您不能使用类似的内容

```
<TextBlock>Stuff on line1&#x0a;Stuff on line 2</TextBlock> 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2012-09-06T12:55:25.460

也许有人更喜欢

```
<TextBlock Text="{Binding StringFormat='Stuff on line1{0}Stuff on line2{0}Stuff on line3',
                          Source={x:Static s:Environment.NewLine}}" /> 
```

与`xmlns:s="clr-namespace:System;assembly=mscorlib"`.

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-02-11T17:47:10.743

对于那些已经尝试了这个问题的所有答案并且*仍然*对为什么它们都不适合你的人来说，你可能已经遇到了我遇到的问题的一种形式。

我的`TextBlock.Text`属性在一个`ToolTipService.ToolTip`元素内，它被数据绑定到一个对象的属性，该对象的数据是从 SQL 存储过程中提取的。现在，存储过程中这个特定属性的数据是从 SQL 函数中提取的。

由于没有什么对我有用，我放弃了搜索并在下面创建了转换器类：

```
public class NewLineConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        var s = string.Empty;

        if (value.IsNotNull())
        {
            s = value.ToString();

            if (s.Contains("\\r\\n"))
                s = s.Replace("\\r\\n", Environment.NewLine);

            if (s.Contains("\\n"))
                s = s.Replace("\\n", Environment.NewLine);

            if (s.Contains("&#x0a;&#x0d;"))
                s = s.Replace("&#x0a;&#x0d;", Environment.NewLine);

            if (s.Contains("&#x0a;"))
                s = s.Replace("&#x0a;", Environment.NewLine);

            if (s.Contains("&#x0d;"))
                s = s.Replace("&#x0d;", Environment.NewLine);

            if (s.Contains("&#10;&#13;"))
                s = s.Replace("&#10;&#13;", Environment.NewLine);

            if (s.Contains("&#10;"))
                s = s.Replace("&#10;", Environment.NewLine);

            if (s.Contains("&#13;"))
                s = s.Replace("&#13;", Environment.NewLine);

            if (s.Contains("<br />"))
                s = s.Replace("<br />", Environment.NewLine);

            if (s.Contains("<LineBreak />"))
                s = s.Replace("<LineBreak />", Environment.NewLine);
        }

        return s;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

我最终不得不使用[@dparker's answer](https://stackoverflow.com/a/10823343/682480)`Enivornment.NewLine`中的方法。我指示转换器查找换行符的任何可能的文本表示并将其替换为.`Environment.NewLine`

**这行得通！**

*但是，我仍然对为什么没有其他方法适用于数据绑定属性感到困惑。*

我对[@BobKing 接受的答案](https://stackoverflow.com/a/183435/682480)发表了评论：

> @BobKing - 当绑定到从 SQL 存储过程中嵌入换行符的字段时，这似乎在 ToolTipService.ToolTip 中不起作用。

他回答说：

> @CodeMaverick 如果您要绑定到嵌入了新行的文本，它们可能应该是真正的 char 10 值（或 13 值）而不是 XML 标记。这仅适用于您想在 XAML 文件中编写文字换行符。

**一个灯泡灭了！**

我进入了我的 SQL 函数，将换行符的文本表示替换为 ...

```
CHAR( 13 ) + CHAR( 10 ) 
```

...从我的`TextBlock.Text`绑定中删除了转换器，就像那样...***它起作用了！***

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2011-07-06T05:44:48.940

我发现这很有帮助，但是在将其添加到 XAML 中的“Content=...”标签时遇到了一些错误。

我在内容中有多行，后来发现即使我没有指定内容也保留了空格。所以为了解决这个问题并让它“忽略”空格，我实现了这样的。

```
<ToolTip Width="200" Style="{StaticResource ToolTip}" 
         Content="'Text Line 1' 
                   &#x0a;&#x0d;'Text Line 2' 
                   &#x0a;&#x0d;'Text Line 3'"/> 
```

希望这对其他人有帮助。

（输出是三个文本行，每行之间有一个空行。）

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-05-30T19:57:00.107

我意识到这是一个较老的问题，但只是想补充一点

> 环境.新线

如果通过代码执行此操作也可以。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2017-11-24T10:20:48.013

```
<TextBlock>
    Stuff on line1 <LineBreak/>
    Stuff on line2
</TextBlock> 
```

知道这并不重要，但您在 TextBlock 标记之间指定的内容称为内联内容并进入 TextBlock.Inlines 属性，该属性是一个 InlineCollection 并包含内联类型的项目。Inline 的子类是 Run 和 LineBreak 等。见[TextBlock.Inlines](https://msdn.microsoft.com/en-us/library/system.windows.controls.textblock.inlines)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-02-03T02:35:17.863

也不适用于

```
<TextBlock><TextBlock.Text>NO USING ABOVE TECHNIQUE HERE</TextBlock.Text> 
```

没什么大不了的，只是需要使用

```
<TextBlock Text="Cool &#x0a;Newline trick" /> 
```

反而。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-04-25T02:59:55.117

```
<TextBox 
    Name="myTextBox" 
    TextWrapping="Wrap" 
    AcceptsReturn="True" 
    VerticalScrollBarVisibility="Visible" /> 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2020-06-05T00:57:08.170

解决方案背后的代码

```
private void Button1_Click(object sender, RoutedEventArgs e)
{
    System.Text.StringBuilder myStringBuilder = new System.Text.StringBuilder();
    myStringBuilder.Append("Orange").AppendLine();
    myStringBuilder.Append("").AppendLine();
    myStringBuilder.Append("Apple").AppendLine();
    myStringBuilder.Append("Banana").AppendLine();
    myStringBuilder.Append("").AppendLine();
    myStringBuilder.Append("Plum").AppendLine();
    TextBox1.Text = myStringBuilder.ToString();
} 
```

# css - 我怎样才能让这个 div 的一部分并排放置？

> ID：183407
> 
> 赞同：0
> 
> 时间：2008-10-08T15:33:24.120
> 
> 标签：css

代码和预览：![是）我有的](https://i.stack.imgur.com/3J6CX.gif)

```
<html>
<head>
<title>Testing some CSS</title>
<style type="text/css">
.dDay {
    font-size:205%
}
.dMon {
    font-weight:bold;
    font-variant:small-caps;
    font-size:130%;
    margin-top:-.7em;
}
.detailContainer {
    vertical-align:middle;
    display:table-cell;
    padding:0em 0em 0em 1em;
}
#dContainer {
    border:1px solid green;
    display:table;
    height:3.25em;
    }
</style>
<body>
<div id="dContainer">
    <div class="dDay">31</div>
    <div class="dMon">sep</div>
    <div class="detailContainer">Test O.O</div>
</div>
</body>
</html> 
```

我的问题是：是否可以在第一个日期部分旁边放置另一个日期部分，所以它看起来像这样：[我想要什么 http://img505.imageshack.us/img505/2787/previewsp2.gif](http://img505.imageshack.us/img505/2787/previewsp2.gif)

* * *

编辑：奇怪，在我问这个问题之前我试过漂浮，但它没有用......谢谢大家：D

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T15:34:53.680

在每个 DIV 上使用 style="float:left" （直接或通过样式表）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T15:36:55.953

```
<html>
<head>
<title>Testing some CSS</title>
<style type="text/css">
.dDay {
    font-size:205%
}
.dMon {
    font-weight:bold;
    font-variant:small-caps;
    font-size:130%;
    margin-top:-.7em;
}
.detailContainer {
    vertical-align:middle;
    display:table-cell;
    padding:0em 0em 0em 1em;
}
#dContainer, #dContainer2 {
    border:1px solid green;
    display:table;
    height:3.25em;
    float: left;
    }
</style>
<body>
<div id="dContainer">
    <div class="dDay">31</div>
    <div class="dMon">sep</div>
</div>
<div id="dContainer2">
    <div class="dDay">31</div>
    <div class="dMon">sep</div>
    <div class="detailContainer">Test O.O</div>
</div>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T15:34:55.550

float:left 如果您希望块元素彼此相邻。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:36:46.093

1.  复制 dContainer 并将副本紧随其后。
2.  将 ID 和新 ID 更改为 #dContainer 样式。
3.  添加一个新的 CSS 块，它只有 #dContainer（不是新的 div）并放入“float:left;” 在块中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T15:38:39.990

```
<html>
<head>
<title>Testing some CSS</title>
<style type="text/css">
.dDay {
    font-size:205%
}
.dMon {
    font-weight:bold;
    font-variant:small-caps;
    font-size:130%;
    margin-top:-.7em;
}
.dDate {
    display:table-cell;
}
.detailContainer {
    vertical-align:middle;
    display:table-cell;
    padding-left:1em;
}
#dContainer {
    border:1px solid green;
    display:table;
    height:3.25em;
}
</style>
<body>
<div id="dContainer">
    <div class="dDate">
        <div class="dDay">31</div>
        <div class="dMon">sep</div>
    </div>
    <div class="dDate">
        <div class="dDay">31</div>
        <div class="dMon">sep</div>
    </div>
    <div class="detailContainer">Test O.O</div>
</div>
</body>
</html> 
```

[编辑] 查看其他答案：
- 浮点数当然是正确的答案，我只是按照最初的逻辑进行，实际上完成了它（制作一个真正的表格可能实际上是合乎逻辑的最后一步......）
- 注意：不在 IE (6, 7) 中看起来不错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T08:42:20.983

有什么理由不能使用 <span> 标签代替 <div> 的标签吗？这样，在没有 CSS 的情况下阅读您的页面仍然有意义。

# java - 在 Java 中使用套接字的 HTTP 1.1 持久连接

> ID：183409
> 
> 赞同：4
> 
> 时间：2008-10-08T15:33:44.913
> 
> 标签：java, http, sockets

假设我有一个 java 程序，它使用 HTTP 1.1 在服务器上发出 HTTP 请求并且不关闭连接。我提出一个请求，并读取从绑定到套接字的输入流返回的所有数据。但是，在发出第二个请求时，我没有得到服务器的响应（或者流有问题 - 它不再提供任何输入）。如果我按顺序发出请求（请求，请求，读取）它工作正常，但（请求，读取，请求，读取）没有。

有人可以对为什么会发生这种情况有所了解吗？（代码片段如下）。无论我做什么，第二个读取循环的 isr_reader.read() 只返回-1。

```
try{
        connection = new Socket("SomeServer", port);
        con_out = connection.getOutputStream();
        con_in  = connection.getInputStream();
        PrintWriter out_writer = new PrintWriter(con_out, false);
        out_writer.print("GET http://somesite HTTP/1.1\r\n");
        out_writer.print("Host: thehost\r\n");
        //out_writer.print("Content-Length: 0\r\n");
        out_writer.print("\r\n");
        out_writer.flush();

        // If we were not interpreting this data as a character stream, we might need to adjust byte ordering here.
        InputStreamReader isr_reader = new InputStreamReader(con_in);
        char[] streamBuf = new char[8192];
        int amountRead;
        StringBuilder receivedData = new StringBuilder();
        while((amountRead = isr_reader.read(streamBuf)) > 0){
            receivedData.append(streamBuf, 0, amountRead);
        }

// Response is processed here.

        if(connection != null && !connection.isClosed()){
            //System.out.println("Connection Still Open...");

        out_writer.print("GET http://someSite2\r\n");
        out_writer.print("Host: somehost\r\n");
        out_writer.print("Connection: close\r\n");
        out_writer.print("\r\n");
        out_writer.flush();

        streamBuf = new char[8192];
        amountRead = 0;
        receivedData.setLength(0);
        while((amountRead = isr_reader.read(streamBuf)) > 0 || amountRead < 1){
            if (amountRead > 0)
                receivedData.append(streamBuf, 0, amountRead);
        }
}
        // Process response here
    } 
```

对问题的回答：是的，我收到了来自服务器的分块响应。由于外部限制，我正在使用原始套接字。

为代码混乱道歉 - 我正在从内存中重写它，似乎引入了一些错误。

所以共识是我必须要么做（请求，请求，读取）并让服务器在我结束时关闭流，或者，如果我做（请求，读取，请求，读取）在我结束之前停止流，以便流*不会*关闭。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T23:04:29.683

根据您的代码，您甚至会到达处理发送第二个请求的语句的唯一时间是服务器在接收/响应第一个请求后关闭输出流（您的输入流）。

原因是您的代码应该只读取第一个响应

```
while((amountRead = isr_reader.read(streamBuf)) > 0) {
  receivedData.append(streamBuf, 0, amountRead);
} 
```

将阻塞直到服务器关闭输出流（即`read`返回时`-1`）或直到套接字上的读取超时过去。在读取超时的情况下，将引发异常，您甚至无法发送第二个请求。

HTTP 响应的问题在于，在响应结束之前，它们不会告诉您要从流中读取多少字节。这对于 HTTP 1.0 响应来说没什么大不了的，因为服务器只是在响应之后关闭连接，从而使您能够通过简单地读取所有内容直到流结束来获取响应（状态行 + 标头 + 正文）。

使用 HTTP 1.1 持久连接，您不能再简单地读取所有内容，直到流结束。您首先需要逐行读取状态行和标头，然后根据状态代码和标头（例如 Content-Length）决定读取多少字节以获得响应正文（如果它存在于全部）。如果您正确执行上述操作，您的读取操作将在连接关闭或发生超时之前完成，并且您将准确读取服务器发送的响应。这将使您能够发送下一个请求，然后以与第一个请求完全相同的方式读取第二个响应。

PS Request, request, read 可能正在“工作”，因为您的服务器支持请求管道，因此接收和处理这两个请求，因此，您将两个响应读入一个缓冲区作为您的“第一个”响应。

PPS 确保您`PrintWriter`使用的是`US-ASCII`编码。否则，根据您的系统编码，您的 HTTP 请求的请求行和标头可能格式不正确（编码错误）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-07-21T15:29:17.243

编写一个简单的符合 RFC 的 http/1.1 客户端并不是一项艰巨的任务。要解决在java中读取套接字时阻塞i/o访问的问题，您必须使用java.nio类。SocketChannels 提供了执行非阻塞 i/o 访问的可能性。

这是在持久连接上发送 HTTP 请求所必需的。

此外，nio 类将提供更好的性能。

我的压力测试给出以下结果：

*   HTTP/1.0 (java.io) -> HTTP/1.0 (java.nio) = +20% 更快

*   HTTP/1.0 (java.io) -> HTTP/1.1 (java.nio 与持久连接) = +110% 更快

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:45:43.860

确保您`Connection: keep-alive`的请求中有一个。不过，这可能是一个有争议的问题。

服务器返回什么样的响应？您是否使用分块传输？如果服务器不知道响应正文的大小，它就不能提供`Content-Length`标头，并且必须在响应正文结束时关闭连接以向客户端指示内容已经结束。在这种情况下，keep-alive 将不起作用。如果您使用 PHP、JSP 等即时生成内容，您可以启用输出缓冲、检查累积正文的大小、推送`Content-Length`标题并刷新输出缓冲区。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:55:05.620

您使用原始套接字而不是 Java 的 URL Connection 或[Commons HTTPClient](http://hc.apache.org/httpclient-3.x/)是否有特殊原因？

HTTP 不容易做到正确。我知道 Commons HTTP Client 可以像您尝试做的那样重用连接。

如果您没有使用 Sockets 的具体原因，这就是我的建议:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T08:21:01.373

编写自己的正确客户端 HTTP/1.1 实现并非易事；从历史上看，我见过的大多数尝试它的人都弄错了。他们的实现通常会忽略规范，只执行似乎与特定测试服务器一起工作的事情 - 特别是，他们通常忽略能够处理分块响应的要求。

编写自己的 HTTP 客户端可能是个坏主意，除非您有一些非常奇怪的要求。

# asp.net - ASP.NET：如何在 DataBind 期间设置控件的 css 类？

> ID：183415
> 
> 赞同：7
> 
> 时间：2008-10-08T15:34:29.173
> 
> 标签：asp.net, css

使用 asp:Repeater 生成表行：

```
<asp:repeater ID="announcementsRepeater" OnItemDataBound="announcementsRepeater_ItemDataBound" runat="Server">
   <itemtemplate>
      <tr id="announcementRow" class="announcementItem" runat="server">...</tr>
   </itemtemplate>
</asp:repeater> 
```

现在在数据绑定中，我想用不同的 css 类标记“未读”公告，以便网络人可以执行他想要区分已读和未读公告的任何样式：

```
protected void announcementsRepeater_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
   if (e.Item.ItemType != ListItemType.Item && e.Item.ItemType != ListItemType.AlternatingItem)
      return;

   // get the associated data item
   Announcement announcement = (Announcement)e.Item.DataItem;

   WebControl row = (WebControl)e.Item.FindControl("announcementRow");
      if (row != null)
         row.CssClass = row.CssClass + " announcementItemUnread";
} 
```

除了强制转换在运行时失败：

```
System.InvalidCastException occurred
  Message="Unable to cast object of type 'System.Web.UI.HtmlControls.HtmlTableRow' to type 'System.Web.UI.WebControls.WebControl'." 
```

事实证明，`HtmlTableRow`它的父层次结构不同于`WebControl`：

```
HtmlTableRow
   : HtmlContainerControl
      : HtmlControl
         : System.Web.UI.Control 
```

这最终是 WebControl 的来源

```
WebControl
   : System.Web.UI.Control 
```

所以我更改了代码以尝试使用 System.Web.UI.Control 代替：

```
Control row = (Control)e.Item.FindControl("announcementRow");
if (row != null)
   row.CssClass = row.CssClass + " announcementItemUnread"; 
```

但`Control`不包含以下定义`CssClass`：

```
'System.Web.UI.Control' does not contain a definition for 'CssClass' 
```

那么如何`<TR>`在 DataBind 期间为元素设置 css 类名？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-08T15:46:21.987

```
 HtmlControl htmlRow = (HtmlControl)row; 
   htmlRow.Attributes["class"] = htmlRow.Attributes["class"] + " announcementItemUnread"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T22:08:51.083

HtmlTableRow htmlRow = (HtmlTableRow) 行；
htmlRow.Attributes.Add("class","announcementItemUnread");

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T15:40:50.580

将其转换为 HtmlTableRow

```
HtmlTableRow row = (HtmlTableRow)e.Item.FindControl("announcementRow"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:47:05.073

为什么不在声明中绑定？

```
<tr id="announcementRow" runat="server" class="<#% functionToDetermineWhichtoShow(ItemInBoundSetToPass) %>">...</tr> 
```

# web-applications - dlinq 与 ADO.NET 实体框架

> ID：183423
> 
> 赞同：1
> 
> 时间：2008-10-08T15:36:26.577
> 
> 标签：web-applications, ado.net, dynamic-linq

我即将完成我的 web 应用程序的设计，我将它构建为一个 n 层架构，并且我提出了使用 DLinq 与 EFM 的问题。如果有人能给我一些专家建议，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T15:43:21.853

我会问一个建议的问题，“您的数据库有多大（表数）？” 您拥有的表越多，linq 变得越不友好，您就越需要更强大的 ORM 来构建自定义映射。

# cocoa - 如何更改 NSProgressIndicator 的高度？

> ID：183426
> 
> 赞同：3
> 
> 时间：2008-10-08T15:37:16.983
> 
> 标签：cocoa

默认情况下，cocoa 进度条有点胖，我想要一些更苗条的东西，比如在 Finder 复制对话框中看到的进度条。但是，Interface Builder 将`NSProgressIndicator`控件高度锁定为 20 像素，并且我的编程尝试瘦身不起作用，因为调用

```
[progressBar setControlSize:NSMiniControlSize]; 
```

和

```
[progressBar setControlSize:NSSmallControlSize]; 
```

`awakeFromNib`什么都不做，头文件中看到的暗示性外观似乎`NSProgressIndicatorThickness`没有插入我能看到的任何方法中。

有什么诀窍？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T17:26:05.577

这些电话应该奏效了。在 Interface Builder 中，在 Geometry 窗格（图标是标尺的那个）中，有一个等效的控件大小选择器，它提供“Regular”和“Small”大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-04-30T22:54:09.610

在国际文凭

1.  选择你的 NSProgressIndicator 控件
2.  在实用程序视图中选择查看效果检查器
3.  在内容过滤器中按 +
4.  选择 Lanczos 比例变换过滤器
5.  在 Scale 行中设置适当的比例值
6.  如果您只需要更改高度，也请设置纵横比

# windows - 为什么在迭代命令输出时批处理文件 FOR 失败？

> ID：183428
> 
> 赞同：6
> 
> 时间：2008-10-08T15:37:52.440
> 
> 标签：windows, batch-file, cmd

我有一个批处理文件，它使用这个习语（很多次）将注册表值读入环境变量：

```
FOR /F "tokens=2* delims=  " %%A IN ('REG QUERY "HKLM\SOFTWARE\Path\To\Key" /v ValueName') DO SET MyVariable=%%B 
```

（后面有一个制表符`delims=`）

这在数千台客户的计算机上运行良好。但在一位客户的计算机上（运行 Windows Server 2003，启用命令扩展），
它失败了，`'REG QUERY "HKLM\SOFTWARE\Path\To\Key" /v ValueName'`无法识别为内部或外部命令、可运行程序或批处理文件。`reg query`单独运行“ ”命令可以正常工作。`Reg.exe`存在于`C:\Windows\System32`.

我能够通过将代码更改为来解决该问题

```
REG QUERY "HKLM\SOFTWARE\Path\To\Key" /v ValueName > temp.txt
FOR /F "tokens=2* delims=  " %%A IN (temp.txt) DO SET MyVariable=%%B 
```

这让客户启动并运行，但我想了解问题发生的原因，以便将来避免它。

稍微偏离主要主题 - 将注册表值（字符串或 DWORD）获取到环境变量中的更直接方法也将很有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T04:08:47.870

哇，这很奇怪。

如果相同的命令在分成两行时起作用，那么我猜这与命令在 FOR 命令的子外壳中运行的方式有关。

如果你真的很想弄清楚为什么在这种特殊情况下它会死掉，你可以运行像“SET > envvars.txt”这样的命令作为 FOR 命令并将其与顶层 shell 进行比较。

或者也许从简单开始并尝试通过 CMD /C 运行 REG 命令以查看是否有任何作用？

在这里快速猜测一下，COMSPEC 和 SHELL 的值是多少？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:04:08.240

我会检查：

1.  客户在机器上的角色——他们是管理员吗？
2.  盒子上的 reg.exe 在哪里 - 路径中是否有多个 reg.exe 的副本？
3.  客户机器上的区域设置与正常工作的机器有什么区别吗？

基本上，列举这台机器和它按预期工作的机器之间的所有不同之处。包括服务包、域成员资格等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-16T00:10:34.803

我有类似的情况。就我而言，它在 COMSPEC 中的价值不高。我解决了这个问题，脚本开始按预期工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T15:47:25.667

`/F`开关需要打开命令扩展。通常默认情况下它们是打开的，但我会检查一下。在 XP 系统上，您可以打开它们做类似的事情

```
cmd /e:on 
```

或检查下的注册表

```
HKCU\Software\Microsoft\Command Processor\EnableExtensions 
```

不知道 Windows Server。

做`help for`也`help cmd`可以提供一些提示。

# java - 什么是好的跨平台 CSS 压缩器？

> ID：183434
> 
> 赞同：3
> 
> 时间：2008-10-08T15:39:08.227
> 
> 标签：java, css, compression, styling

我需要压缩我的 css 作为我的 ant 构建的一部分。我注意到 csstidy 做到了这一点，但是将它包含在我的 ant 构建中并不容易，因为我需要在不同的平台上使用不同的二进制文件。

那么，是否有人们使用的 java css 压缩器？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-08T15:41:05.337

查看[Yahoo YUI 压缩器](http://developer.yahoo.com/yui/compressor/)。

它压缩 CSS 和 Javascript，并且是用 Java 编写的。

编辑：您也应该使用某种 HTTP 压缩，*例如*mod_deflate 或 mod_gzip。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-12T14:47:17.963

我最近发布了[CSS Compressor](http://www.andy-roberts.net/coding/csscompressor)。它是 YUI Compressor 的代码分支，但添加了更多压缩增强功能，使其更类似于 csstidy，特别是在共享相同规则的分组选择器方面。显然它是 Java，可以通过命令行调用或用作您自己的 Java 应用程序中的库。

# ruby-on-rails - 为什么 Mongrel 无法选择正确的 HTTP 动词？

> ID：183443
> 
> 赞同：1
> 
> 时间：2008-10-08T15:41:43.183
> 
> 标签：ruby-on-rails, routing, mongrel

我的Rails 应用程序中有一个*非常*简单的：`routes.rb`

```
ActionController::Routing::Routes.draw do |map|
  map.resources :tags
end 
```

启动我的应用程序`script/server`并将我的浏览器指向`localhost:3000/tags/`收益率：

### ActionController::MethodNotAllowed

```
Only get and post requests are allowed. 
```

...

`script/server webrick`但是，使用 启动我的应用程序可以解决问题。

*后来*：以防万一，我在 OSX 10.5.5 上运行 Mongrel 1.1.5。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T08:57:27.460

1.  检查生成的路由是否存在“rake routes | grep tag”问题
2.  通过 tail -f log/development.log 检查正在调用的实际方法以及调用它的动词

这应该会带来任何明显的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T19:30:47.607

要检查的东西：

*   有时您需要重新启动服务器以加载新路由。
*   标签控制器存在吗？
*   TagsController 中的索引操作存在吗？

我很想在这里看到堆栈跟踪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T18:25:16.237

我已经看到旧版本的 mongrel 会发生这种情况，但 1.1.5 并不旧。当浏览器向 URL 重复发布请求时，我也看到了一些类似的问题。这是发生在这里吗？

我需要更多信息才能帮助您：您使用的是什么浏览器？你在 Firefox 上使用 firebug 插件吗？除了 MethodNotAllowed 异常，服务器日志对请求有什么说明？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T16:25:47.620

您是否检查过您的代码，例如与 form_for 相关的代码，以检查是否有任何拼写错误？当您运行 rake 路线时，一切都好吗？我之前看到过这个问题，它与 form_for 参数中的拼写错误有关。

你更新你的杂种了吗？宝石更新杂种？

你检查过你的项目日志吗？日志*.log?

问候，

胜利者

# sql - MySQL - 用于操作“UNION”的排序规则（utf8_general_ci，COERCIBLE）和（latin1_swedish_ci，IMPLICIT）的非法混合

> ID：183446
> 
> 赞同：13
> 
> 时间：2008-10-08T15:42:32.230
> 
> 标签：sql, mysql, unicode, union, collation

如何一劳永逸地修复该错误？我只想能够在 MySQL 中进行联合。

（我正在寻找一种捷径，比如让 MySQL 忽略该问题或采取最佳猜测的选项，而不是希望更改 100 个表的排序规则……至少今天不会）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T16:22:09.777

不确定 mySQL 但在 MSSQL 中，您可以更改查询中的排序规则，例如，如果您有 2 个具有不同排序规则的表并且您想加入它们，或者在您的情况下，您可以使用 crate UNION

```
select column1 from tableWithProperCollation
union all
select column1 COLLATE SQL_Latin1_General_CP1_CI_AS from tableWithDifferentCollation 
```

当然 SQL_Latin1_General_CP1_CI_AS 只是您想要“转换”为的排序规则的一个示例

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T17:36:35.853

谢谢克里斯托夫。在这种情况下，它是由在第一次选择中选择文字引起的，而不是来自任何不同的表排序规则。

具有讽刺意味的是，我是通过关注我为该问题撰写的这篇[旧博客文章来实现它的。](http://www.answermysearches.com/mysql-fixing-illegal-mix-of-collations-message/352/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-10-08T13:32:58.107

我发现一个似乎很简单的修复方法是更改​​给您带来问题的整个数据库。我认为这可能不是最好的方法，但它对我有用而且很容易。我在 MySQL 中运行这个命令：

```
ALTER DATABASE databasename COLLATE utf8_unicode_ci; 
```

# c++ - 有什么方法可以确定 Windows 中可移动驱动器的速度吗？

> ID：183447
> 
> 赞同：4
> 
> 时间：2008-10-08T15:42:51.917
> 
> 标签：c++, windows, removable-storage

有没有办法在不实际读取文件的情况下确定 Windows 中的可移动驱动器速度。如果我必须读取文件，需要读取多少才能获得半准确的速度（例如确定设备是 USB2 还是 USB1）？

**编辑**：澄清一下，USB2 和 USB1 就是一个例子。这些可能是紧凑型闪存，可能是 SSD，可能是可移动驱动器。我正在尝试尽快确定这一点，因为它对应用程序的响应能力有实际影响。

**编辑**：还应该澄清，这必须以编程方式完成。它可能会在 C++ 中完成。

**编辑**：提升答案是我一直在寻找的（尽管我没有用 C++ 编写任何 WMI）。但我需要知道我必须检查哪些属性才能确定相对速度。我不需要确切的速度（就像我所说的 USB1 和 USB2 之间的速度差异），但我需要知道它是否会是 SLLOOOOWWW。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T16:37:58.543

查询操作系统以获取有关硬件的信息，而不是尝试从数据传输时序信息中对其进行逆向工程，您可能会获得更好的结果。

例如，相同的传输速度并不一定意味着两个设备正在使用相同的技术，尽管如果您的应用程序可以使用此类信息，其他因素（例如寻道时间）会提高准确性。

为了在这项工作完成时保持应用程序响应，请尝试异步执行调用并向用户提供某种进度指示器。作为一个例子，看看[WinDirStat](http://windirstat.info/)如何处理这个进度指示（我喜欢 pac-man 动画，因为每个目录都被分析了）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T14:04:05.623

[WMI - Physical Disks Properties](http://www.computerperformance.co.uk/vbscript/wmi_disks_physical.htm)是我发现的一篇文章，它至少可以帮助你弄清楚你连接了什么。我预见事情会朝着将特定制造商和型号等同于速度的表格发展，这并不像您希望的那样简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T16:09:05.717

几兆字节，我会说。传输速度一开始可能很慢，然后随着传输的进行而加快。由于文件大小也存在差异（单个 1GB 文件的传输速度比 1GB 小文件快得多）。

最好的方法是将文件复制到设备或从设备复制文件，并计算代码需要多长时间。USB1 的速度是 11Mb/s（我认为），USB2 是 480Mb/s（注意这些是整个总线的数字，而不是每个端口，因此同一总线上的多个设备会改变实际数字）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T16:17:32.720

在 Windows 中，您可以通过从设备管理器中选择查看 ->“连接设备”来确定连接的 USB 设备是否为 USB2，然后检查该设备是否位于 USB2 控制器（USB2 增强型主机控制器）下。

请注意，这并不意味着您的设备实际上会以更高的速度运行，您仍然需要为此进行实际的吞吐量测试。Sisoft [Sandra](http://www.sisoftware.net/)基准测试软件列出了其功能列表中支持的可移动硬盘驱动器。

编辑：由于原始问题的澄清，我提交了一个新的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:23:32.740

尝试[TerraCopy](http://www.codesector.com/teracopy.php)并从设备和设备复制一个 ~400mb - 500mb 的大文件，您会看到速度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T17:23:53.117

考虑可能影响数据传输速度的因素：

*   用于将设备连接到系统的总线的速度。除非它通过 USB1 连接，否则这不太可能成为您的限制因素。
*   对于硬盘驱动器，转速和寻道时间很重要。7200 RPM 驱动器读取和写入数据块的速度比 5400 RPM 驱动器快。
*   光驱和磁驱在不使用时通常会减速，因此第一次访问将比第二次访问多几个数量级。
*   特定设备上使用的文件系统。
*   缓存数据和文件系统元数据。缓存的元数据越少，磁驱动器或光驱动器就越需要设法找出数据的位置。
*   数据访问模式。访问少量连续的大文件几乎总是比访问分散在磁盘上的大量小文件要快。
*   文件系统碎片

您可能能够根据您期望看到的设备的各种特征进行一些启发式方法，但一般来说，没有好的方法可以确定总线、媒体、文件系统和数据访问模式的特定组合的传输速度实际测量它。如果您决定进行测量，请尝试尽可能接近地模拟您的最终访问模式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-10T15:21:28.483

我[要借陈峰的](http://blogs.msdn.com/oldnewthing/)水晶球，说你真的不要这个。您可能想要使用异步 I/O。如果您在一秒钟内没有得到 I/O 的结果，您想检查发生了多少。取那个数字的倒数，你就有一个很好的估计可以引用给用户。

如果一秒钟后没有发生任何事情，您可能会感到惊讶。但即使这样也可能发生。例如，硬盘可能需要一秒钟才能启动。每秒轮询一次，直到发生某些事情。

# .net - Asp.Net 应用程序是否有任何类型的文件依赖跟踪器？

> ID：183459
> 
> 赞同：8
> 
> 时间：2008-10-08T15:46:02.940
> 
> 标签：.net, asp.net, vb.net, visual-studio-2005, .net-2.0

我有一个 Asp.Net 2.0 (VB.Net) 应用程序，我正在尝试将 Control (ASCX) 导出到另一个项目。我需要知道控件需要哪些其他文件才能工作。

有没有办法——使用 VS.Net 2005 或外部应用程序——递归地跟踪解决方案中页面或控件的依赖关系？

例如，对于这个 file: `~/Controls/SomeControl.ascx`，我想获取它依赖于运行的以下文件列表：

```
~/Controls/SomeControl.ascx
  ~/Controls/SomeControl.ascx.vb
    ~/App_Code/SomeClass.vb
      ~/App_Code/AnotherClass.vb
      ~/App_WebReferences/com/example/SomeWebService/SomeWebService.disco
      ~/App_WebReferences/com/example/SomeWebService/SomeWebService.discomap
      ~/App_WebReferences/com/example/SomeWebService/SomeWebService.wsdl
    ~/App_Code/AnotherClass.vb 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T15:27:04.483

我使用了[Assembly Binding Log Viewer (Fuslogvw.exe)](http://msdn.microsoft.com/en-us/library/ms229864(VS.80).aspx)或者 ProcMon ...

我的一位同事推荐了这个名为 Dependency Auditor 的应用程序。我没有使用它，也不一定保证它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-16T14:51:22.407

我用[AutomatedQA 的 AQTime](http://www.automatedqa.com/products/aqtime/)做这种事情。您可以查看序列图、调用图等。从那里您可以看到正在使用哪些程序集和文件。

他们提供免费试用，让您有足够的时间去做您需要做的事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-17T09:35:36.700

MZ Tools 6.0 与 Visual Studio 集成并具有“获取调用者”类型的功能。 [http://www.mztools.com/v6/mztools6.aspx](http://www.mztools.com/v6/mztools6.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-21T13:34:15.957

你试过[NDepend](http://www.ndepend.com/)吗？[反射器](http://reflectoraddins.codeplex.com/Wiki/View.aspx?title=Graph)也有一个插件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-22T08:40:04.027

没有。没有办法做到这一点。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-19T13:44:03.487

我只是将 ascx 控件移动到一个新项目并一一调试。然后，我会将它编译成一个 dll 并在不同的项目中使用它。

# user-interface - 在进度条中显示完成

> ID：183461
> 
> 赞同：1
> 
> 时间：2008-10-08T15:46:40.380
> 
> 标签：user-interface, progress-bar

在这种特殊情况下，一个过程中有 9 个自动化步骤需要不同的时间长度。我们目前在进度条的中心有一个显示百分比的数字，但它遇到了常见的走走停停问题，最高可达 33%，等待很长时间，最高可达 55%，等待更长时间，然后整理。

向用户展示此内容的最佳方式是什么？我们应该删除数字，删除整个进度条以支持 ajax 类型的圆形动画，为九个步骤添加描述性文本并检查它们还是保持原样？你怎么认为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T15:48:29.033

如果真的需要很长时间，AJAX 类型的动画可能不是一个好主意。我会选择物品清单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T15:58:40.060

进度条用于向用户保证正在发生的事情。如果您没有更详细的步骤列表，我建议您“伪造”它们。

一个基本的解决方案是运行一个计时器并缓慢增加进度，将其限制在下一个逻辑步长值。如果这些步骤花费的时间差异很大，您可以手动调整每个计时器“滴答”的增量值，具体取决于您所处的步骤。

然而，一个更好的解决方案（我曾经以这种方式实现过，但我无法发布代码:)），将是随着步骤的继续缓慢减少增量 - 所以它永远不会完全进入下一步。然后下一步到了，你有一个很好的跳跃，循环重复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:05:30.233

在某些情况下，进度条指示正在发生的事情比准确和流畅更重要。当进度条停止前进时，用户往往会感到恐慌。

如果您在一段时间内遇到栏冻结的问题，最好用通用动画替换它，以向用户保证正在发生的事情，而不必担心显示过程有多远。或者，保留进度条，但添加一些额外的动画作为安慰剂。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-04T09:28:38.530

为了扩展 Cadet Pirx 的答案，这里有一些 WinForms C# 代码。你需要一个新的`UserControl`. 在其上放置一个`ProgressBar`控件，称为`inner`. 添加以下代码：

```
public partial class ZenoProgressBar : UserControl
{
    private const int DEFAULT_FACTOR_VALUE = 10;
    private const int DEFAULT_MAXIMUM_VALUE = 100;

    public ZenoProgressBar()
    {
        InitializeComponent();

        Maximum = DEFAULT_MAXIMUM_VALUE;
        Factor = DEFAULT_FACTOR_VALUE;
    }

    /// <summary>
    /// The "speed" of the progress bar. While it will never get to
    /// the end, it uses this number to decide how much further to
    /// go each time Increment is called. For example, setting it to
    /// 2 causes half of the remaining distance to be covered.
    /// </summary>
    [DefaultValue(DEFAULT_FACTOR_VALUE)]
    public int Factor { get; set; }

    [DefaultValue(DEFAULT_MAXIMUM_VALUE)]
    public int Maximum { get; set; }

    private void ZenoProgressBar_Load(object sender, EventArgs e)
    {
        inner.Dock = DockStyle.Fill;
    }

    public void Increment()
    {
        inner.Value += (inner.Maximum - inner.Value) / Factor;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:13:35.753

我遇到了几乎完全相同的问题。我们也有 9 个步骤，所以条形图会走 11%、22% 和 33% 等，而且有些步长比其他步长。

我决定将两个较长的步骤算作两个，所以我们有 11 个步骤，所以它不那么明显，而且跳跃并不总是均匀的：9%、18%、36%、45%、54 %、72%、81%、90%，完成。步长值始终相同，但由于步长的大小不明显，所以它起作用了..

# ruby-on-rails - 编程语言“在轨道上”意味着什么？

> ID：183462
> 
> 赞同：31
> 
> 时间：2008-10-08T15:46:49.817
> 
> 标签：ruby-on-rails, ruby, grails, groovy, terminology

我目前正在使用 Groovy 和 Grails。虽然 Groovy 非常简单，因为它基本上是 Java，但我不能说我对 Grails 很熟悉。我读到 Groovy 之于 Grails 就像 Ruby 之于 Ruby on Rails，但这是什么意思？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-08T16:13:06.940

为了解决您对隐喻的困惑（尽管在您的问题下已换句话回答）：

> Groovy 之于 Grails 就像 Ruby 之于 Ruby on Rails，但这是什么意思？

Grails 是一个基于/使用 Groovy 编程语言构建的 Web 框架，它为 Groovy 做与 Rails（Ruby 的 Web 框架）为 Ruby 做的事情相同的事情。

* * *

> “在轨道上”是什么意思？

这个问题的答案归结为这些 Web 框架的本质。

这些 Web 框架（Grails & Rails）建立在“约定优于配置”的前提下，这意味着使用通用约定来开发 Web 应用程序可以带来更高的生产力和更可维护的应用程序（这是一个粗略的概括）。通过定义一个约定并坚持下去，您会发现您的应用程序很容易生成并且可以快速启动和运行。

这就是“在轨道上”对我的意义，就像火车一样。当一条新的火车路线被开发出来时，不用担心重新发明火车从一个地方到另一个地方的方式，几十年来一直通过一个惯例解决这个问题：铁路。正如火车路线上的轨道从两个位置限制其路径一样，基于约定的 Web 框架使用约定来提高应用程序开发人员的灵活性，以便他们可以专注于其应用程序的基本业务问题。

Web 框架约定的一个关键好处是，Web 框架现在可以假设应用程序的某些层如何连接在一起。在 Rails 中，通常可以假设如果一个数据库表有复数名称，则映射到该表的 ActiveRecord 类将具有相应的单数名称。因此，Rails 代码生成器可以使用数据映射信息来生成数据访问代码，例如动态查找器、迁移、延迟加载的关联遍历等。基于配置的框架中的这种数据访问代码手工编写很费力。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-09T06:06:58.507

有几个人提到了 Rails/Grails 的技术细节。一些人还提到“约定优于配置”是 Rails/Grails 中的“轨道”。这越来越接近真相了。但这只是更广泛的 Rails 哲学的一个特征，即**[固执软件](http://gettingreal.37signals.com/ch04_Make_Opinionated_Software.php)**的概念。

自以为是的软件不能只用技术术语来描述；这是一种哲学；一种精神；[一种态度](http://gettingreal.37signals.com/ch04_Make_Opinionated_Software.php)。喜欢或[讨厌它](http://tech.rufy.com/2006/11/fatal-flaw-in-opinionated-software.html)，*这*就是 Rails 的核心所在。

以下是 2005 年对 Rails 的创建者[David Heinemeier Hansson 的采访摘录：](http://www.oreillynet.com/pub/a/network/2005/08/30/ruby-rails-david-heinemeier-hansson.html)

> Rails 是固执己见的软件。它避免将旧的软件理念置于首要位置。其中一个理想是灵活性——我们应该尝试适应尽可能多的方法，我们不应该对一种开发形式的判断超过另一种。好吧，Rails 确实如此，我相信这就是它起作用的原因。
> 
> 使用 Rails，您可以在基础设施级别交换灵活性以在应用程序级别获得灵活性。如果您乐于沿着我在 Rails 中嵌入的黄金路径工作，那么您将在生产力方面获得巨大的回报，使您能够在应用程序级别上做更多、更快、更好的工作。

还有进一步[探讨主题](http://www.linuxjournal.com/article/8686)的稍后采访。

所以'on rails'是'有意见'的隐喻，这就是它被命名的原因。任何记者或作家都会告诉你，“Ruby on Rails”是押韵的事实，这是吸引人们注意力的可靠方式。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-08T16:13:03.120

我认为一个努力成为“类似rails”的框架是指几件事：

*   模型级：AR 模式的 ORM（而不是数据映射器）、迁移或一些自动化模式和模型层管理，在应用程序中处理外键（不在数据库模式中，也不使用存储过程或纯 DBMS 逻辑）

*   鼓励 TDD：为单元测试自动生成骨架，

*   连接数据库表名和模型名、控制器和视图操作以及 HTML 模板的命名约定

*   简化的路线识别和路线生成方案

*   强调 REST 架构

*   与 ajax 库集成：RJS、prototype 和 scriptaculous

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-08T15:50:43.350

[Rails](http://www.rubyonrails.org/)是一个用于开发具有数据库后端的 Web 应用程序的框架。我认为这个名字最初是一个文字游戏。火车可以把你带到一个*非常*快的地方，但仅限于铁轨去的地方。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-11T01:11:13.550

在轨道上意味着你无法控制你要去哪里。这意味着，你只能去已经铺设了铁轨的地方。任何试图去那些铺设铁轨的人没有预料到你会去的地方都会导致挫败感。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-08T15:52:37.013

这是一种汽车的表达方式。当一辆汽车的操控性非常好时，它被称为“像在铁轨上行驶一样过弯”（即它给你很好的控制）。

我不知道那是不是铁路人得这个名字的地方，但这就是我解释它的方式。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-08T18:38:29.520

非常简短的答案：约定优于配置。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T20:49:50.923

如上所述，Rails 和 Grails 为 Web 应用程序开发提供了约定——以某种方式命名您的部分并将它们放在正确的位置使您的应用程序在默认情况下运行，无需额外配置。当你想偏离约定时，你可以在那里配置你的方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-09T19:37:34.627

我不同意“在轨道上是一种关于约定优于配置的哲学”等其他评论。

尽管 rails 确实遵循这些理念，但“Ruby on Rails”是 Web 框架的名称。不多也不少。它不是指任何特定的“在轨”，它只是一个品牌名称，就像麦当劳是一个品牌名称一样。

如果其他人编写了另一个框架并将其称为“Python on Rails”，那么就会有另一个品牌名称。如果不是，“XYZ on rails”只是意味着人们感到困惑。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-05T18:00:53.973

Ruby 和 Groovy 是语言。

Ruby on Rails 是一个突破性的 webapp 框架。请参阅上面关于自以为是的软件的优秀答案。

从历史上看，Groovy webapp 框架的暂定名称是*Groovy on Rails*。然而，RoR 社区反对。团队选择了*Grails*。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T15:56:54.337

这是一个比喻，我几乎要说这需要解释。无论如何，这是 Ruby on Rails 所做的一个非常好的比喻。它使得做（去）常见的事情变得非常容易，即测试、验证、部署、MVC。

# c# - 是否有在 Windows Mobile 上用 C# 读取 JSON 的库？

> ID：183473
> 
> 赞同：10
> 
> 时间：2008-10-08T15:48:55.367
> 
> 标签：c#, json, compact-framework, json.net

我正在尝试找到一个库来解析 Windows Mobile 上 C# 上的 JSON（使用 Visual Studio 2005）。我发现允许我在 C#（litjson 和 Jayrock）中解析 JSON 的库在 Windows Mobile 上不起作用，它们需要 .NET 紧凑框架中不存在的类。有没有我忽略的图书馆？或者在这些情况下是否有另一种简单的方法来解析 JSON？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-07-05T03:16:23.250

[Json.NET](http://james.newtonking.com/projects/json-net.aspx)支持 .NET 3.5 紧凑框架。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T16:15:32.037

您是否查看过“缺失”类对现有库的实际作用？如果他们自己实现起来相当简单，那将是我的第一个建议 - 然后将结果贡献回这些项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T15:01:41.373

看[这里](http://json.org/)- 几个 C# json 库可供选择。此外，“手动”从字符串中解析 JSON 并不是那么困难。

# c# - 我需要处理临时的一次性物品吗？

> ID：183479
> 
> 赞同：4
> 
> 时间：2008-10-08T15:50:06.333
> 
> 标签：c#, .net

我有一个创建几个 IDisposable 对象的类，然后将所有这些对象传递给第 3 方库中的另一个“管理器”类。由于我在以后的调用中需要一些对象，所以我保留了对创建对象的本地字段引用，以便以后可以访问它们。当我在类上运行 FxCop 时，它说我应该实现 IDisposable，因为我保留了对一次性对象的引用。我的问题是：

1.  我应该为我的班级实施 IDisposable 吗？（还是经理的责任？）
2.  如果是这样，我应该只处理我保留引用的对象吗？或者我应该找到一种方法来处理我创建的所有对象。

### 我的代码：

```
public class MyClass  
{  
    ClassThatIsDisposable aReference;  
}

public MyClass(ManagerClass manager)  
{  
    ClassThatIsDisposable transient=new ClassThatIsDisposable();  
    manager.Add(transient);  
    aReference=new ClassThatIsDisposable();  
    manager.Add(aReference);  
}

public void LaterCall()  
{  
    areference.Method();  
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T15:59:05.160

拥有对象的类是应该处理它们的类......听起来你的经理是所有者，所以他应该处理对象。

如果您试图避免 FXCop 警告，那么一种选择是让 MyClass 每次需要使用时都向管理器请求一次性对象。这样你就不会有一个成员变量持有对它的引用。您可以让 Add() 方法返回已添加对象的密钥，然后在需要使用该密钥时使用该密钥从管理器中检索该对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T15:57:57.643

如果您创建任何一次性对象，您应该自己处理它们，或者确保将它们交给另一个负责处理的班级。

在这种情况下，我想说这真的取决于经理班要做什么。如果这可以保证它会处理添加到其中的任何内容，那么您就可以了。虽然它看起来确实有点奇怪 - 我不能说我自己使用过类似的东西。这并不是说它一定是错误/坏的，但至少值得再看看是否有任何方法可以避免这种轻微的所有权混淆。

请记住，如果管理器处理了您持有引用的对象，那么之后它可能无法使用。

# python - 这是使用 Python 获得唯一版本的文件名的最佳方法吗？

> ID：183480
> 
> 赞同：16
> 
> 时间：2008-10-08T15:50:21.557
> 
> 标签：python, filenames

仍然“潜入”Python，并想确保我没有忽略某些东西。我编写了一个脚本，从几个 zip 文件中提取文件，并将提取的文件一起保存在一个目录中。为了防止重复的文件名被覆盖，我写了这个小函数——我只是想知道是否有更好的方法来做到这一点？谢谢！

```
def unique_filename(file_name):
counter = 1
file_name_parts = os.path.splitext(file_name) # returns ('/path/file', '.ext')
while os.path.isfile(file_name): 
    file_name = file_name_parts[0] + '_' + str(counter) + file_name_parts[1]
    counter += 1
return file_name 
```

我确实*要求*文件位于单个目录中，并且在我的情况下重复编号绝对是可以接受的，所以我不是在寻找更强大的方法（我想任何指针都是受欢迎的），但只是为了确保这样做的目的是以正确的方式完成。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-08T16:13:02.637

一个问题是上述代码中存在竞争条件，因为在测试存在性和创建文件之间存在差距。这可能存在安全隐患（想想有人恶意将符号链接插入到他们无法覆盖的敏感文件，但您的程序以更高的权限运行可以）像这样的攻击就是为什么像 os.tempnam( ) 已弃用。

为了解决这个问题，最好的方法是实际尝试以这样一种方式创建文件，如果它失败，你会得到一个异常，并在成功时返回实际打开的文件对象。这可以通过传递 os.O_CREAT 和 os.O_EXCL 标志使用较低级别的 os.open 函数来完成。打开后，返回您创建的实际文件（以及可选的文件名）。例如，这是您修改为使用此方法的代码（返回 (file, filename) 元组）：

```
def unique_file(file_name):
    counter = 1
    file_name_parts = os.path.splitext(file_name) # returns ('/path/file', '.ext')
    while 1:
        try:
            fd = os.open(file_name, os.O_CREAT | os.O_EXCL | os.O_RDRW)
            return os.fdopen(fd), file_name
        except OSError:
            pass
        file_name = file_name_parts[0] + '_' + str(counter) + file_name_parts[1]
        counter += 1 
```

**[编辑]** 实际上，为您处理上述问题的更好方法可能是使用 tempfile 模块，尽管您可能会失去对命名的一些控制。这是一个使用它的例子（保持类似的界面）：

```
def unique_file(file_name):
    dirname, filename = os.path.split(file_name)
    prefix, suffix = os.path.splitext(filename)

    fd, filename = tempfile.mkstemp(suffix, prefix+"_", dirname)
    return os.fdopen(fd), filename

>>> f, filename=unique_file('/home/some_dir/foo.txt')
>>> print filename
/home/some_dir/foo_z8f_2Z.txt 
```

这种方法的唯一缺点是你总是会得到一个包含一些随机字符的文件名，因为没有尝试首先创建一个未修改的文件 (/home/some_dir/foo.txt)。您可能还想查看 tempfile.TemporaryFile 和 NamedTemporaryFile，它们将执行上述操作，并在关闭时自动从磁盘中删除。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T16:02:08.773

是的，对于可读但唯一的文件名，这是一个很好的策略。

**一个重要的变化**：你应该替换`os.path.isfile`为`os.path.lexists`! 正如现在所写的那样，如果有一个名为 /foo/bar.baz 的目录，您的程序将尝试用新文件覆盖它（这不起作用）......因为`isfile`只检查文件而不是目录。 `lexists`检查目录、符号链接等...基本上是否有任何原因无法创建文件名。

编辑：@Brian 给出了一个更好的答案，这在比赛条件方面更加安全和强大。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T16:00:51.973

两个小改动...

```
base_name, ext = os.path.splitext(file_name) 
```

你得到两个具有不同含义的结果，给它们不同的名称。

```
file_name = "%s_%d%s" % (base_name, str(counter), ext) 
```

它并没有更快或更短。但是，当您想更改文件名模式时，该模式位于一个位置，并且更易于使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T15:52:38.090

如果您想要可读的名​​称，这看起来是一个不错的解决方案。
有一些例程可以返回唯一的文件名，例如。临时文件，但它们会产生长的随机名称。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T01:07:49.497

如果你不关心可读性，uuid.uuid4() 是你的朋友。

```
import uuid

def unique_filename(prefix=None, suffix=None):
    fn = []
    if prefix: fn.extend([prefix, '-'])
    fn.append(str(uuid.uuid4()))
    if suffix: fn.extend(['.', suffix.lstrip('.')])
    return ''.join(fn) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T18:47:16.763

怎么样

```
def ensure_unique_filename(orig_file_path):    
    from time import time
    import os

    if os.path.lexists(orig_file_path):
        name, ext = os.path.splitext(orig_file_path)
        orig_file_path = name + str(time()).replace('.', '') + ext

    return orig_file_path 
```

time() 以毫秒为单位返回当前时间。结合原始文件名，即使在复杂的多线程情况下，它也相当独特。

# c# - 在 C# 中有效地缩小二维数组

> ID：183484
> 
> 赞同：2
> 
> 时间：2008-10-08T15:51:07.623
> 
> 标签：c#, .net, arrays, data-structures, multidimensional-array

在 C# 中将二维数组缩小到较小尺寸的有效方法是什么？

例如：

```
var bigArray = new object[100, 100];
var smallArray = new object[10, 10];

bigArray[0, 0] = 1;
bigArray[0, 1] = 2;
...
bigArray[99, 99] = 100000;

startRowIndex = 0;
startColumnIndex = 0;
endRowIndex = 9;
endColumnIndex = 9;

smallArray = bigArray.SomeShirnkingMethod(startRowIndex, startColumnIndex, endRowIndex, endColumnIndex); 
```

你将如何编写 SomeShrinkingMethod() ？

谢谢！

编辑：我只是想将 bigArray 的前 10 行和前 10 列放入 smallArray，但我不确定循环遍历数组是否是最有效的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T15:57:53.150

您必须创建一个所需大小的新数组（在您的代码中，您已经这样做了）并复制内容。我不确定在您的情况下“缩小”操作需要做什么。但是，您不能修改现有数组的维度。

您提出的功能有缺陷，因为它无法知道目标数组的尺寸。要么在内部传递维度和维度新数组，要么将目标数组传递给它并简单地复制内容。

### 编辑：

回应您的编辑：是的，循环将是执行此操作的合理方式，而且速度也相当快。我不知道 .NET 中可以应用于多维数组的块复制机制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:05:22.480

取决于您希望收缩功能做什么。您必须创建一个新数组并根据您的标准进行复制。我的假设是你有一个二维数组是有原因的，对吧？副本可以是琐事（找到具有非零值的下一个位置并将其放在目标中的下一个可用位置）或基于其他内容。你能提供更多信息吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-10T14:08:20.827

是的，最好的方法几乎可以肯定是遍历每个单元格，尽管可以复制每个“行”的序列。该方法需要知道要从源方格复制的方格的较低索引，以及大小（这可能在目标方格定义中隐含）。

# javascript - 将带有破折号字符的 punycode 转换为 Unicode

> ID：183485
> 
> 赞同：20
> 
> 时间：2008-10-08T15:51:48.233
> 
> 标签：javascript, unicode, punycode

我需要将 punycode 转换`NIATO-OTABD`为`nñiñatoñ`.

[前几天我在 JavaScript](http://0xcc.net/jsescape/)中找到了一个文本转换器，但是如果中间有一个破折号，那么 punycode 转换就不起作用。

有什么建议可以解决“破折号”问题吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-19T08:13:13.507

我花时间创建了下面的 punycode。它基于 RFC 3492 中的 C 代码。要将它与域名一起使用，您必须`xn--`从/从解码/编码的输入/输出中删除/添加。

从 JavaScript的`utf16-class`内部字符表示转换为 unicode 并返回是必要的。

还有一些功能可以更`ToASCII`轻松`ToUnicode`地在弱编码 IDN 和 ASCII 之间进行转换。

```
//Javascript Punycode converter derived from example in RFC3492.
//This implementation is created by some@domain.name and released into public domain
var punycode = new function Punycode() {
    // This object converts to and from puny-code used in IDN
    //
    // punycode.ToASCII ( domain )
    // 
    // Returns a puny coded representation of "domain".
    // It only converts the part of the domain name that
    // has non ASCII characters. I.e. it dosent matter if
    // you call it with a domain that already is in ASCII.
    //
    // punycode.ToUnicode (domain)
    //
    // Converts a puny-coded domain name to unicode.
    // It only converts the puny-coded parts of the domain name.
    // I.e. it dosent matter if you call it on a string
    // that already has been converted to unicode.
    //
    //
    this.utf16 = {
        // The utf16-class is necessary to convert from javascripts internal character representation to unicode and back.
        decode:function(input){
            var output = [], i=0, len=input.length,value,extra;
            while (i < len) {
                value = input.charCodeAt(i++);
                if ((value & 0xF800) === 0xD800) {
                    extra = input.charCodeAt(i++);
                    if ( ((value & 0xFC00) !== 0xD800) || ((extra & 0xFC00) !== 0xDC00) ) {
                        throw new RangeError("UTF-16(decode): Illegal UTF-16 sequence");
                    }
                    value = ((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000;
                }
                output.push(value);
            }
            return output;
        },
        encode:function(input){
            var output = [], i=0, len=input.length,value;
            while (i < len) {
                value = input[i++];
                if ( (value & 0xF800) === 0xD800 ) {
                    throw new RangeError("UTF-16(encode): Illegal UTF-16 value");
                }
                if (value > 0xFFFF) {
                    value -= 0x10000;
                    output.push(String.fromCharCode(((value >>>10) & 0x3FF) | 0xD800));
                    value = 0xDC00 | (value & 0x3FF);
                }
                output.push(String.fromCharCode(value));
            }
            return output.join("");
        }
    }

    //Default parameters
    var initial_n = 0x80;
    var initial_bias = 72;
    var delimiter = "\x2D";
    var base = 36;
    var damp = 700;
    var tmin=1;
    var tmax=26;
    var skew=38;
    var maxint = 0x7FFFFFFF;

    // decode_digit(cp) returns the numeric value of a basic code 
    // point (for use in representing integers) in the range 0 to
    // base-1, or base if cp is does not represent a value.

    function decode_digit(cp) {
        return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : base;
    }

    // encode_digit(d,flag) returns the basic code point whose value
    // (when used for representing integers) is d, which needs to be in
    // the range 0 to base-1\. The lowercase form is used unless flag is
    // nonzero, in which case the uppercase form is used. The behavior
    // is undefined if flag is nonzero and digit d has no uppercase form. 

    function encode_digit(d, flag) {
        return d + 22 + 75 * (d < 26) - ((flag != 0) << 5);
        //  0..25 map to ASCII a..z or A..Z 
        // 26..35 map to ASCII 0..9
    }
    //** Bias adaptation function **
    function adapt(delta, numpoints, firsttime ) {
        var k;
        delta = firsttime ? Math.floor(delta / damp) : (delta >> 1);
        delta += Math.floor(delta / numpoints);

        for (k = 0; delta > (((base - tmin) * tmax) >> 1); k += base) {
                delta = Math.floor(delta / ( base - tmin ));
        }
        return Math.floor(k + (base - tmin + 1) * delta / (delta + skew));
    }

    // encode_basic(bcp,flag) forces a basic code point to lowercase if flag is zero,
    // uppercase if flag is nonzero, and returns the resulting code point.
    // The code point is unchanged if it is caseless.
    // The behavior is undefined if bcp is not a basic code point.

    function encode_basic(bcp, flag) {
        bcp -= (bcp - 97 < 26) << 5;
        return bcp + ((!flag && (bcp - 65 < 26)) << 5);
    }

    // Main decode
    this.decode=function(input,preserveCase) {
        // Dont use utf16
        var output=[];
        var case_flags=[];
        var input_length = input.length;

        var n, out, i, bias, basic, j, ic, oldi, w, k, digit, t, len;

        // Initialize the state: 

        n = initial_n;
        i = 0;
        bias = initial_bias;

        // Handle the basic code points: Let basic be the number of input code 
        // points before the last delimiter, or 0 if there is none, then
        // copy the first basic code points to the output.

        basic = input.lastIndexOf(delimiter);
        if (basic < 0) basic = 0;

        for (j = 0; j < basic; ++j) {
            if(preserveCase) case_flags[output.length] = ( input.charCodeAt(j) -65 < 26);
            if ( input.charCodeAt(j) >= 0x80) {
                throw new RangeError("Illegal input >= 0x80");
            }
            output.push( input.charCodeAt(j) );
        }

        // Main decoding loop: Start just after the last delimiter if any
        // basic code points were copied; start at the beginning otherwise. 

        for (ic = basic > 0 ? basic + 1 : 0; ic < input_length; ) {

            // ic is the index of the next character to be consumed,

            // Decode a generalized variable-length integer into delta,
            // which gets added to i. The overflow checking is easier
            // if we increase i as we go, then subtract off its starting 
            // value at the end to obtain delta.
            for (oldi = i, w = 1, k = base; ; k += base) {
                    if (ic >= input_length) {
                        throw RangeError ("punycode_bad_input(1)");
                    }
                    digit = decode_digit(input.charCodeAt(ic++));

                    if (digit >= base) {
                        throw RangeError("punycode_bad_input(2)");
                    }
                    if (digit > Math.floor((maxint - i) / w)) {
                        throw RangeError ("punycode_overflow(1)");
                    }
                    i += digit * w;
                    t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;
                    if (digit < t) { break; }
                    if (w > Math.floor(maxint / (base - t))) {
                        throw RangeError("punycode_overflow(2)");
                    }
                    w *= (base - t);
            }

            out = output.length + 1;
            bias = adapt(i - oldi, out, oldi === 0);

            // i was supposed to wrap around from out to 0,
            // incrementing n each time, so we'll fix that now: 
            if ( Math.floor(i / out) > maxint - n) {
                throw RangeError("punycode_overflow(3)");
            }
            n += Math.floor( i / out ) ;
            i %= out;

            // Insert n at position i of the output: 
            // Case of last character determines uppercase flag: 
            if (preserveCase) { case_flags.splice(i, 0, input.charCodeAt(ic -1) -65 < 26);}

            output.splice(i, 0, n);
            i++;
        }
        if (preserveCase) {
            for (i = 0, len = output.length; i < len; i++) {
                if (case_flags[i]) {
                    output[i] = (String.fromCharCode(output[i]).toUpperCase()).charCodeAt(0);
                }
            }
        }
        return this.utf16.encode(output);
    };

    //** Main encode function **

    this.encode = function (input,preserveCase) {
        //** Bias adaptation function **

        var n, delta, h, b, bias, j, m, q, k, t, ijv, case_flags;

        if (preserveCase) {
            // Preserve case, step1 of 2: Get a list of the unaltered string
            case_flags = this.utf16.decode(input);
        }
        // Converts the input in UTF-16 to Unicode
        input = this.utf16.decode(input.toLowerCase());

        var input_length = input.length; // Cache the length

        if (preserveCase) {
            // Preserve case, step2 of 2: Modify the list to true/false
            for (j=0; j < input_length; j++) {
                case_flags[j] = input[j] != case_flags[j];
            }
        }

        var output=[];

        // Initialize the state: 
        n = initial_n;
        delta = 0;
        bias = initial_bias;

        // Handle the basic code points: 
        for (j = 0; j < input_length; ++j) {
            if ( input[j] < 0x80) {
                output.push(
                    String.fromCharCode(
                        case_flags ? encode_basic(input[j], case_flags[j]) : input[j]
                    )
                );
            }
        }

        h = b = output.length;

        // h is the number of code points that have been handled, b is the
        // number of basic code points 

        if (b > 0) output.push(delimiter);

        // Main encoding loop: 
        //
        while (h < input_length) {
            // All non-basic code points < n have been
            // handled already. Find the next larger one: 

            for (m = maxint, j = 0; j < input_length; ++j) {
                ijv = input[j];
                if (ijv >= n && ijv < m) m = ijv;
            }

            // Increase delta enough to advance the decoder's
            // <n,i> state to <m,0>, but guard against overflow: 

            if (m - n > Math.floor((maxint - delta) / (h + 1))) {
                throw RangeError("punycode_overflow (1)");
            }
            delta += (m - n) * (h + 1);
            n = m;

            for (j = 0; j < input_length; ++j) {
                ijv = input[j];

                if (ijv < n ) {
                    if (++delta > maxint) return Error("punycode_overflow(2)");
                }

                if (ijv == n) {
                    // Represent delta as a generalized variable-length integer: 
                    for (q = delta, k = base; ; k += base) {
                        t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;
                        if (q < t) break;
                        output.push( String.fromCharCode(encode_digit(t + (q - t) % (base - t), 0)) );
                        q = Math.floor( (q - t) / (base - t) );
                    }
                    output.push( String.fromCharCode(encode_digit(q, preserveCase && case_flags[j] ? 1:0 )));
                    bias = adapt(delta, h + 1, h == b);
                    delta = 0;
                    ++h;
                }
            }

            ++delta, ++n;
        }
        return output.join("");
    }

    this.ToASCII = function ( domain ) {
        var domain_array = domain.split(".");
        var out = [];
        for (var i=0; i < domain_array.length; ++i) {
            var s = domain_array[i];
            out.push(
                s.match(/[^A-Za-z0-9-]/) ?
                "xn--" + punycode.encode(s) :
                s
            );
        }
        return out.join(".");
    }
    this.ToUnicode = function ( domain ) {
        var domain_array = domain.split(".");
        var out = [];
        for (var i=0; i < domain_array.length; ++i) {
            var s = domain_array[i];
            out.push(
                s.match(/^xn--/) ?
                punycode.decode(s.slice(4)) :
                s
            );
        }
        return out.join(".");
    }
}(); 
```

更新许可证：
来自 RFC3492：

> 免责声明和许可
> 
> 对于整个文档或其中的任何部分（包括伪代码和 C 代码），作者不作任何保证，也不对因使用它而造成的任何损害负责。作者授予任何人不可撤销的许可，以任何方式使用、修改和分发它，但不会削弱任何其他人使用、修改和分发它的权利，前提是再分发的衍生作品不包含误导性的作者或版本信息。衍生作品无需根据类似条款获得许可。

我把我的工作放在公共领域的这个 punycode 和 utf16 中。很高兴收到一封电子邮件告诉我你在哪个项目中使用它。

# sql-server - SQL Server 错误“字符串数据，右截断”是什么意思，我该如何解决？

> ID：183488
> 
> 赞同：29
> 
> 时间：2008-10-08T15:52:11.913
> 
> 标签：sql-server, odbc

我们正在我们的网站上进行一些性能测试，我们经常收到以下错误：

```
*** 'C:\inetpub\foo.plex' log message at: 2008/10/07 13:19:58
DBD::ODBC::st execute failed: [Microsoft][SQL Native Client]String data, right truncation (SQL-22001) at C:\inetpub\foo.plex line 25. 
```

第 25 行如下：

```
SELECT DISTINCT top 20 ZIP_CODE, CITY, STATE FROM Zipcodes WHERE (ZIP_CODE like ?) OR (CITY like ?) ORDER BY ZIP_CODE 
```

最后，这是 perl 代码。

有任何想法吗？

**编辑**：这里的问题是我在 zip 文件中搜索的字符串“74523%”太长了。如果他们给出五位数，我最终只是不添加％。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-08T15:58:02.103

提供的参数`ZIP_CODE`（长度）大于`ZIP_CODE`s 列宽，或者提供的参数`CITY`（长度）大于`CITY`s 列宽。

知道为两个`?`占位符提供的值会很有趣。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2019-06-19T15:52:38.310

这是 mssql ODBC 驱动程序的一个已知问题。根据微软博客文章：

> SQLBindParameter 的 ColumnSize 参数是指 SQL 类型中的字符数，而 BufferLength 是应用程序缓冲区中的字节数。但是，如果 SQL 数据类型是 varchar(n) 或 char(n)，应用程序将参数绑定为 SQL_C_CHAR 或 SQL_C_VARCHAR，并且客户端的字符编码为 UTF-8，则可能会得到“字符串数据，右截断" 即使 ColumnSize 的值与服务器上数据类型的大小一致，驱动程序也会出错。发生此错误是因为字符编码之间的转换可能会更改数据的长度。例如，右撇号字符 (U+2019) 在 CP-1252 中编码为单字节 0x92，但在 UTF-8 中编码为 3 字节序列 0xe2 0x80 0x99。

[您可以在此处](https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/known-issues-in-this-version-of-the-driver?view=sql-server-2017)找到完整的文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-04T18:25:18.187

我通过在“？”上使用转换解决了这个问题，所以我的代码看起来像 convert(char(50),?) 并且消除了截断错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-11-22T08:13:32.637

我面临着同样的问题。所以，我创建了一个存储过程并定义了大小，如@FromDate datetime、@ToDate datetime、@BL varchar(50)

在@BL varchar(50) 中定义大小后，我没有遇到任何问题。现在它工作正常

# javascript - JavaScript 风格/优化：String.indexOf() v. Regex.test()

> ID：183496
> 
> 赞同：8
> 
> 时间：2008-10-08T15:52:59.057
> 
> 标签：javascript, regex, optimization, coding-style

我最近遇到了这段 JavaScript 代码：

```
if (",>=,<=,<>,".indexOf("," + sCompOp + ",") != -1) 
```

我很感兴趣，因为要编写这个测试，我会这样做：

```
if (/(>=|<=|<>)/.test(sCompOp)) 
```

这只是风格上的差异，还是其他代码的作者知道一些我不知道的优化？或者也许有不同的充分理由这样做，或者不使用正则表达式......？

在我看来，使用`String.indexOf()`for this 有点难以阅读（但是，我对正则表达式很满意），但是在某些情况下它可能比编写等效的正则表达式“更好”吗？

通过“更好”可能更快或更有效，（尽管显然这取决于浏览器的 JavaScript 引擎），或者我不知道的其他一些原因。任何人都可以启发我吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-08T16:27:19.953

我进行了一些测试。第一种方法稍微快一点，但即使在大量使用的情况下也不足以产生任何真正的影响......*除非*`sCompOp`可能是一个很长的字符串。因为第一种方法搜索的是一个固定长度的字符串，所以无论get多长时间它的执行时间都很稳定`sCompOp`，而第二种方法可能会遍历整个长度`sCompOp`。

此外，第二种方法可能会匹配无效字符串-“blah blah blah <= blah blah”满足测试...

鉴于您可能正在其他地方解析运算符，我怀疑任何一种极端情况都会成为问题。但即使不是这种情况，对表达式进行小的修改也可以解决这两个问题：

```
/^(>=|<=|<>)$/ 
```

* * *

### 测试代码：

```
function Time(fn, iter)
{
   var start = new Date();
   for (var i=0; i<iter; ++i)
      fn();
   var end = new Date();
   console.log(fn.toString().replace(/[\r|\n]/g, ' '), "\n : " + (end-start));
}

function IndexMethod(op)
{
   return (",>=,<=,<>,".indexOf("," + op + ",") != -1);
}

function RegexMethod(op)
{
   return /(>=|<=|<>)/.test(op);
}

function timeTests()
{
   var loopCount = 50000;

   Time(function(){IndexMethod(">=");}, loopCount);
   Time(function(){IndexMethod("<=");}, loopCount);
   Time(function(){IndexMethod("<>");}, loopCount);
   Time(function(){IndexMethod("!!");}, loopCount);
   Time(function(){IndexMethod("the quick brown foxes jumped over the lazy dogs");}, loopCount);
   Time(function(){IndexMethod("<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<");}, loopCount);

   Time(function(){RegexMethod(">=");}, loopCount);
   Time(function(){RegexMethod("<=");}, loopCount);
   Time(function(){RegexMethod("<>");}, loopCount);
   Time(function(){RegexMethod("!!");}, loopCount);
   Time(function(){RegexMethod("the quick brown foxes jumped over the lazy dogs");}, loopCount);
   Time(function(){RegexMethod("<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<");}, loopCount);
}

timeTests(); 
```

在 IE6、FF3、Chrome 0.2.149.30 中测试

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T17:04:14.700

我怀疑这是性能或优化的问题。我怀疑该代码的作者根本不熟悉或不熟悉正则表达式。还要注意逗号分隔的字符串是如何不分开以利用对象属性的——这也可能是对语言不熟悉的情况。

例如，在逗号分隔的允许运算符列表中测试运算符的另一种方法是拆分逗号分隔的允许运算符列表，并使用运算符作为属性对对象进行一次性初始化：

```
var aOps = ">=,<=,<>".split(",");
var allowableOps = {};
for (var iLoop = 0; iLoop < aOps.length; iLoop++) {
  allowableOps[aOps[iLoop]] = true;
} //for 
```

这个小的初始化开销可能会被快速查找的能力所抵消：

```
if (allowableOps[sCompOp]) { ... } 
```

当然，这最终可能会整体变慢，但可以说是一种更清洁的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T16:12:06.413

曾经可能存在明显的速度差异，但现在不再如此。我认为这是：

1.  来自 (godless) The Land Before REGEX 的遗留代码。
2.  由不了解 REGEX 或害怕它的人撰写。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T02:54:00.783

这让我想起了一些早期的基于 javascript 的`getElementsByClassName`实现。

`indexOf`比使用正则表达式快得多，但是使用的代码`indexOf`从假设开发人员将类名用空格（而不是制表符和换行符）分隔开来。公平地说，一些基于正则表达式的实现正在使用`\b`（单词边界），这与 CSS 规范不兼容（因为 CSS 允许在类名中使用连字符）。

在 IE 中使用`indexOf`to support`getElementsByClassName`确实会有所作为，因为没有更快的替代方案，并且 className 属性的底层 getter/setter 可以方便地用空格替换制表符和换行符。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T16:03:35.417

它真的是一段古老的代码吗？它可能是在正则表达式广泛用于 javascript 之前编写的。总体而言，看起来有人试图过于聪明和“优化”该语句，或者来自 C 背景并且不习惯正则表达式。使用正则表达式可能很昂贵，但字符串连接也可能很昂贵，如果它不在循环中，我会选择更容易理解的那个（对我来说，正则表达式）。

# java - 对嵌套的 try/catch 块有偏好吗？

> ID：183499
> 
> 赞同：41
> 
> 时间：2008-10-08T15:53:32.520
> 
> 标签：java, try-catch

在 Java 中使用 Readers 和 Streams 时总是让我感到困扰的一件事是该`close()`方法可能会引发异常。由于将 close 方法放在 finally 块中是个好主意，因此需要一些尴尬的情况。我通常使用这种结构：

```
FileReader fr = new FileReader("SomeFile.txt");
try {
    try {
        fr.read();
    } finally {
        fr.close();
    }
} catch(Exception e) {
    // Do exception handling
} 
```

但我也看到了这种结构：

```
FileReader fr = new FileReader("SomeFile.txt");
try {
    fr.read() 
} catch (Exception e) {
    // Do exception handling
} finally {
    try {
        fr.close();
    } catch (Exception e) {
        // Do exception handling
    }
} 
```

我更喜欢第一种构造，因为只有一个 catch 块，而且看起来更优雅。有没有理由更喜欢第二种或另一种结构？

更新：如果我指出两者都只抛出 IOExceptions 会有所不同`read`吗`close`？所以在我看来，如果读取失败，关闭也会因为同样的原因而失败。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-08T16:09:47.400

恐怕第一个例子有一个大问题，就是如果在读取时或读取后发生异常，则`finally`执行该块。到现在为止还挺好。但是如果`fr.close()`then 导致另一个异常被抛出呢？这将“胜过”第一个异常（有点像放入`return`一个`finally`块），**您将丢失有关实际导致问题**开始的所有信息。

您的 finally 块应该使用：

```
IOUtil.closeSilently(fr); 
```

此实用程序方法的作用是：

```
public static void closeSilently(Closeable c) {
    try { c.close(); } catch (Exception e) {} 
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T16:31:53.457

我总是会选择第一个例子。

如果 close 抛出异常（实际上对于 FileReader 永远不会发生），那么处理该异常的标准方法不是抛出适合调用者的异常吗？关闭异常几乎肯定胜过您在使用资源时遇到的任何问题。如果您对异常处理的想法是调用 System.err.println，则第二种方法可能更合适。

存在应该抛出多远异常的问题。应该总是重新抛出 ThreadDeath，但是 finally 中的任何异常都会阻止它。类似地，Error 应该比 RuntimeException 和 RuntimeException 比检查的异常更远。如果你真的想要，你可以编写代码来遵循这些规则，然后用“execute around”习语抽象它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T16:10:48.367

我更喜欢第二个。为什么？如果两者都`read()`抛出`close()`异常，则其中一个可能会丢失。在第一个构造中，异常 from`close()`覆盖异常 from `read()`，而在第二个构造中，异常 from`close()`被单独处理。

* * *

**从 Java 7 开始，[try-with-resources 结构](https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)使这变得更加简单。**在不关心异常的情况下阅读：

```
try (FileReader fr = new FileReader("SomeFile.txt")) {
    fr.read();
    // no need to close since the try-with-resources statement closes it automatically
} 
```

使用异常处理：

```
try (FileReader fr = new FileReader("SomeFile.txt")) {
    fr.read();
    // no need to close since the try-with-resources statement closes it automatically
} catch (IOException e) {
    // Do exception handling
    log(e);
    // If this catch block is run, the FileReader has already been closed.
    // The exception could have come from either read() or close();
    // if both threw exceptions (or if multiple resources were used and had to be closed)
    // then only one exception is thrown and the others are suppressed
    // but can still be retrieved:
    Throwable[] suppressed = e.getSuppressed(); // can be an empty array
    for (Throwable t : suppressed) {
        log(suppressed[t]);
    }
} 
```

只需要一个try-catch，所有异常都可以安全处理。如果您愿意，您仍然可以添加`finally`块，但无需关闭资源。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T16:37:27.360

如果*read*和*close*都抛出异常，则*read*的异常将隐藏在选项 1 中。因此，第二个选项做了更多的错误处理。

但是，在大多数情况下，仍会首选第一个选项。

1.  在许多情况下，您无法在它们生成的方法中处理异常，但您仍然必须将流处理封装在该操作中。
2.  尝试在代码中添加编写器，看看第二种方法有多冗长。

如果需要传递所有生成的异常，[可以做](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T15:58:33.537

据我所知，不同之处在于，在不同的层面上存在不同的例外和原因，并且

捕获（异常 e）

掩盖了这一点。多个级别的唯一目的是区分您的异常，以及您将如何处理它们：

```
try
{
  try{
   ...
  }
   catch(IOException e)
  {
  ..
  }
}
catch(Exception e)
{
  // we could read, but now something else is broken 
  ...
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T16:56:53.623

我通常会执行以下操作。首先，定义一个基于模板方法的类来处理 try/catch 混乱

```
import java.io.Closeable;
import java.io.IOException;
import java.util.LinkedList;
import java.util.List;

public abstract class AutoFileCloser {
    private static final Closeable NEW_FILE = new Closeable() {
        public void close() throws IOException {
            // do nothing
        }
    };

    // the core action code that the implementer wants to run
    protected abstract void doWork() throws Throwable;

    // track a list of closeable thingies to close when finished
    private List<Closeable> closeables_ = new LinkedList<Closeable>();

    // mark a new file
    protected void newFile() {
        closeables_.add(0, NEW_FILE);
    }

    // give the implementer a way to track things to close
    // assumes this is called in order for nested closeables,
    // inner-most to outer-most
    protected void watch(Closeable closeable) {
        closeables_.add(0, closeable);
    }

    public AutoFileCloser() {
        // a variable to track a "meaningful" exception, in case
        // a close() throws an exception
        Throwable pending = null;

        try {
            doWork(); // do the real work

        } catch (Throwable throwable) {
            pending = throwable;

        } finally {
            // close the watched streams
            boolean skip = false;
            for (Closeable closeable : closeables_) {
                if (closeable == NEW_FILE) {
                    skip = false;
                } else  if (!skip && closeable != null) {
                    try {
                        closeable.close();
                        // don't try to re-close nested closeables
                        skip = true;
                    } catch (Throwable throwable) {
                        if (pending == null) {
                            pending = throwable;
                        }
                    }
                }
            }

            // if we had a pending exception, rethrow it
            // this is necessary b/c the close can throw an
            // exception, which would remove the pending
            // status of any exception thrown in the try block
            if (pending != null) {
                if (pending instanceof RuntimeException) {
                    throw (RuntimeException) pending;
                } else {
                    throw new RuntimeException(pending);
                }
            }
        }
    }
} 
```

请注意“待处理”异常——这会处理关闭期间抛出的异常会掩盖我们可能真正关心的异常的情况。

finally 会首先尝试从任何装饰流的外部关闭，因此如果您有一个包装 FileWriter 的 BufferedWriter，我们会尝试先关闭 BuffereredWriter，如果失败，仍然尝试关闭 FileWriter 本身。

您可以按如下方式使用上述类：

```
try {
    // ...

    new AutoFileCloser() {
        @Override protected void doWork() throws Throwable {
            // declare variables for the readers and "watch" them
            FileReader fileReader = null;
            BufferedReader bufferedReader = null;
            watch(fileReader = new FileReader("somefile"));
            watch(bufferedReader = new BufferedReader(fileReader));

            // ... do something with bufferedReader

            // if you need more than one reader or writer
            newFile(); // puts a flag in the 
            FileWriter fileWriter = null;
            BufferedWriter bufferedWriter = null;
            watch(fileWriter = new FileWriter("someOtherFile"));
            watch(bufferedWriter = new BufferedWriter(fileWriter));

            // ... do something with bufferedWriter
        }
    };

    // .. other logic, maybe more AutoFileClosers

} catch (RuntimeException e) {
    // report or log the exception
} 
```

使用这种方法，您永远不必担心 try/catch/finally 会再次处理关闭文件。

如果这对您的使用来说太重了，至少考虑遵循 try/catch 和它使用的“待定”变量方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T16:27:30.797

我使用的标准约定是你不能让异常逃逸 finally 块。

这是因为如果一个异常已经在传播，那么从 finally 块中抛出的异常将胜过原始异常（因此会丢失）。

在 99% 的情况下，这不是您想要的，因为原始异常可能是您的问题的根源（任何次要异常都可能是第一个异常的副作用，但会掩盖您找到原始异常来源的能力，因此问题）。

所以你的基本代码应该是这样的：

```
try
{
    // Code
}
// Exception handling
finally
{
    // Exception handling that is garanteed not to throw.
    try
    {
         // Exception handling that may throw.
    }
    // Optional Exception handling that should not throw
    finally()
    {}
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T17:58:32.143

第二种方法。

否则，我看不到您从 FileReader 构造函数中捕获异常

[http://java.sun.com/j2se/1.5.0/docs/api/java/io/FileReader.html#FileReader(java.lang.String)](http://java.sun.com/j2se/1.5.0/docs/api/java/io/FileReader.html#FileReader(java.lang.String))

公共 FileReader（字符串文件名）抛出 FileNotFoundException

所以，我通常在 try 块中也有构造函数。finally 块在尝试关闭之前检查阅读器是否不为空。

同样的模式也适用于数据源、连接、语句、结果集。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T19:52:22.270

有时嵌套的 try-catch 不是首选项，考虑一下：

```
try{
 string s = File.Open("myfile").ReadToEnd(); // my file has a bunch of numbers
 // I want to get a total of the numbers 
 int total = 0;
 foreach(string line in s.split("\r\n")){
   try{ 
     total += int.Parse(line); 
   } catch{}
 }
catch{} 
```

这可能是一个不好的例子，但有时您需要嵌套的 try-cactch。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-08T23:43:56.437

我喜欢@Chris Marshall 的方法，但我从不喜欢看到异常被默默吞下。我认为最好记录异常，特别是如果你不顾一切地继续。

我总是使用实用程序类来处理这些常见的异常，但我会让这与他的回答略有不同。

我总是使用记录器（对我来说是 log4j）来记录错误等。

```
IOUtil.close(fr); 
```

对实用方法稍作修改：

```
public static void close(Closeable c) {
    try {
      c.close();
    } catch (Exception e) {
      logger.error("An error occurred while closing. Continuing regardless", e); 
    } 
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-04-15T00:04:43.493

在某些情况下，嵌套的 Try-Catch 是不可避免的。例如，当错误恢复代码本身可以抛出异常时。但是为了提高代码的可读性，您总是可以将嵌套块提取到它自己的方法中。查看[这篇](https://blog.srcclr.com/avoiding-nested-try-catch-in-java/)博文，了解更多关于嵌套 Try-Catch-Finally 块的示例。

# sql-server - 将 Crystal Reports 文件存储在数据库中？

> ID：183505
> 
> 赞同：5
> 
> 时间：2008-10-08T15:55:07.210
> 
> 标签：sql-server, crystal-reports, blob

我有一个 UI 前端，它与 SQL Server 数据库对话和操作，它可以做的一件事是运行关于数据库中数据的报告。

此 UI 可以安装在多台计算机上，到目前为止，我只是将报告保存在安装文件夹中，但这意味着任何时候添加新报告都必须手动复制到每个单独的 UI 安装那里。

我正在考虑将 .rpt 文件存储在数据库本身（作为 Blob）中，并有一些机制让 UI 在需要时获取它们，作为集中报告并消除此问题的一种方式。

有没有人试过这个，效果好吗？或者，如果您还没有，您能想到在继续进行此操作之前我应该​​考虑的任何事情吗？您能想到的任何提示、技巧或警告对我有帮助吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T05:28:35.603

好问题！这有点巧合，因为我们实际上只是在过去六个月内实现了这一点。

正如您所建议的，我们将 rpt 文件存储在数据库中，但在 Server 2005 中将其作为图像类型进行。它工作得很好，就数据库而言，确实没有想到任何警告。

显然，您访问此信息的方式会随着 API 的变化而变化。如果您使用的是 C#，这将转换为使用**BinaryReader**加载 rpt 文件，获取一个**字节数组**。然后可以通过存储过程等将这个**字节数组传递给数据库。**

我意识到您是在专门询问 blob 和 Server 2008 ，但这**适用于 Server 2005 和 Server 2008**。希望这能带来一点启示。

如果您需要更具体的细节，我很乐意分享！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T02:47:50.187

这是 Paul Randal 的精彩播客（他编写了 DBCC 的部分内容！），他们在其中讨论了 sql server 2008 中用于处理 blob 的新文件流功能，但他们也讨论了作为 blob 工作和不工作的文件的大小谈话的一部分。我想它会对你有所帮助。 [http://www.runasradio.com/default.aspx?showNum=74](http://www.runasradio.com/default.aspx?showNum=74)

我刚刚发现 Paul 编写的 25 页 FILESTREAM 白皮书已在 MSDN 上发布。 [http://msdn.microsoft.com/en-us/library/cc949109.aspx](http://msdn.microsoft.com/en-us/library/cc949109.aspx)。

*根据本白皮书后面引用的研究，小于 256 KB（如小部件图标）的 BLOB 最好存储在数据库中，大于 1 MB 的 BLOB 最好存储在数据库外部。对于大小在 256 KB 和 1 MB 之间的数据，更高效的存储解决方案取决于数据的读取与写入比率以及“覆盖”率。仅在数据库中存储 BLOB 数据（例如，使用 varbinary(max) 数据类型）限制为每个 BLOB 2 GB。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T15:33:49.387

好的，现在我们都可以轻松地将 BLOB 存储在 SQL SERVER、ORACLE、SQLITE、MYSQL Server 和任何其他有价值的数据库中。我想知道的是，在您从数据库中获取字节数组之后，您是如何创建报告的？

我想做同样的事情，但我唯一能想到的就是从数据库中提取文件，在 Temp 文件夹中创建一个物理文件，然后使用新文件的物理地址创建水晶报表。有没有办法从内存流或字节数组创建水晶报表？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-03-12T07:56:02.860

.RPT 文件可以通过将其类型为图像存储在数据库（sql）中。将字节数组存储到数据库中，然后将其作为流检索。（提示：将其视为图像文件。）

# c# - 领域驱动设计 - 逻辑删除

> ID：183524
> 
> 赞同：2
> 
> 时间：2008-10-08T15:59:39.603
> 
> 标签：c#, .net, nhibernate, domain-driven-design, ddd-repositories

所以，我建立了一个很好的域模型。存储库处理数据访问等等。弹出了一个新要求，表明需要使用删除记录原因。到目前为止，删除都相当简单 => Entity.Children.Remove(child)。由于我的 ORM 工具正在处理状态管理，因此没有进行内部更改跟踪。但是，我不确定如何处理这个问题。

1）我可以在父实体中保留一个已删除的子集合，并将更改跟踪从 nHibernate 中拉出并自己处理。

2）？？？？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T12:36:58.267

好的，这听起来很疯狂，我将再试一次——即使我可能会因为 nHibernate 使用不当而被打屁股。在删除之前，为什么不选择将要删除的子项（您的 id 已经正确？）并转换为您将用于将删除记录到表中的任何实体。将原因添加到实体并保存它们 - 然后继续删除。最好的部分，您可以使用通用实体，即“auditInfo”作为转换结果，并且您可以在事务中执行此操作，以便在出现故障时回滚所有内容！好吧，也许很疯狂但很有创意吧？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T18:39:04.603

您能否实现[IInterceptor 接口](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html_single/#manipulatingdata-interceptors)并覆盖 onDelete 功能以从实体中提取您需要的信息并在删除之前将其发送到记录器（当然使用 NHibernate）？

[例子](http://www.lostechies.com/blogs/rhouston/archive/2008/03/27/creating-a-timestamp-interceptor-in-nhibernate.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T01:54:33.523

如果该特定实体类型的删除相对较少，我会向实体添加一个标志以将其标记为逻辑上“已删除”，而不是实际删除该行。然后，应用程序必须在正常情况下处理这些实体的隐藏。

如果这会导致无法接受的“陈旧”行数 - 我会建议类似于 Watson 的回答。根据确切的要求，您可能会直接从应用程序的某处记录已删除的数据和一个额外的“原因”字段。从审计的角度来看，使用拦截器更透明、更令人愉悦，但单独的删除日志（表、数据库、文件）可能更简单。

# variables - 如何在命令行中传递变量时修复 DTSX 优先约束评估错误？

> ID：183527
> 
> 赞同：4
> 
> 时间：2008-10-08T16:00:48.667
> 
> 标签：variables, command-line, ssis

我有一个带有优先约束的 dtsx 包，它计算表达式和约束。约束是“成功”，表达式是“@myVariable”== 3。myVariable 是一个 int32，当在 Visual Studio 的设计 GUI 中设置时，包执行得很好。还有另外两条路径可以检查值是 1 还是 2。

但是，当我尝试从命令行运行包并为我的变量传递一个值时，它会出错，声称表达式不计算为布尔值！

**命令：**

```
dtexec /F "c:myPackage.dtsx" /SET 
\Package.Variables[User::myVariable].Properties[Value];3 
```

**错误：**

```
The expression "@myVariable == 1" must evaluate to True or False.  
Change the expression to evaluate to a Boolean value. 
```

这在 GUI 上运行良好并且微软文档声称 == （直观地）返回布尔值的事实让我非常困惑。我也试过在我的命令中用双引号将 3 括起来，但没有运气，现在我没有主意了。

有人知道发生了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-21T13:50:44.090

对不起，我花了这么长时间才回到这个线程！但`(DT_I4)@[User::myVariable] == 3`成功了。谢谢！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-22T05:45:58.813

这绝对是 dtexec 中的一个错误 - 我有一个类似的问题（通过 dtexec 命令行上的 /set 命令设置一个整数值），在包执行中进一步抱怨（输出）变量从存储的返回时类型错误程序。

省略该值的集合（无论如何都将其设置为零）修复了包执行错误。如果你真的需要这个值，不确定你会做什么——它们似乎可以作为输入参数正常工作，但当你想将它们用作输出参数并且它们不是字符串时，它们就搞砸了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T07:16:22.923

不确定它是否会导致问题，但是您使用稍微奇怪的语法来设置变量值，请尝试

```
dtexec ... /SET \Package.Variables[User::myVariable].Value;3 
```

注意我使用的是`.Value`, 而不是`.Properties[Value]`. `.Value`是Books Online推荐的官方方式。也许`.Properties[Value]`语法也恰好起作用，但改变了变量类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T03:04:24.910

这似乎是 dtexec.exe 初始版本中的一个错误。我有 9.00.3042.00 版本，就像 SQL Server 2005 SP2，安装在我的开发环境中。我们有第二台测试机器，版本为 9.00.1399.06 。我看到这个失败的唯一地方是在测试盒上。我的开发者。盒子运行完成。我向作为表达式一部分的布尔变量添加了显式类型转换 (DT_BOOL)，错误消失了。

上面的 .Value 评论也是不正确的。它应该是 .Properties[Value] ，因为变量的 Value 只是全局变量属性集合中的一个项目。这不是 C# 或 VB.net 语法。这是 SSIS 语法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T22:07:27.920

似乎是 ssis 中的一个错误，因为您通过命令行传入的值不会自动转换为配置变量的类型。SSIS 似乎将通过 cmd 行传入的值视为字符串，这会导致运行时出现问题。要么将变量更改为字符串并对其进行比较，要么使用 (DT_I4) 转换表达式。

# wcf - 具有优先级的 WCF 端点

> ID：183530
> 
> 赞同：3
> 
> 时间：2008-10-08T16:01:40.473
> 
> 标签：wcf, endpoint

我需要具有 3 个端点的 WCF 服务

1.  高的
2.  普通的
3.  低的

大多数消息将通过正常和低端点。如果出现高消息，则必须尽快处理。

有谁知道怎么做？？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T19:07:59.507

您应该看一下 MSDN 杂志上 Michele Leroux Bustamante 的这个伟大的两部分系列：

[构建 WCF 路由器，第 1 部分](http://msdn.microsoft.com/en-us/magazine/cc500646.aspx)和 [构建 WCF 路由器，第 2 部分](http://msdn.microsoft.com/en-us/magazine/cc546553.aspx)

尤其是第 1 部分，您会很感兴趣：

> 有时在客户端和目标服务之间引入中介或路由器服务以接收在它们之间流动的消息并执行其他活动（例如日志记录、***优先级路由***、在线/离线路由、负载平衡）或引入安全边界很有用. 当引入这样的中间服务时，有必要调整一些寻址和消息过滤行为以适应。

***[我的重点补充]***

[她的博客](http://www.dasblonde.net)上也有相关的[源代码](http://www.dasblonde.net/downloads/routers.zip)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T16:17:24.327

为什么不运行两个单独的端点进程，一个用于低/正常，一个用于高。如果你有能力，你甚至可以将它放在单独的（更好的？）硬件上。否则，如果您必须在单个进程中执行此操作，那么在我看来，优先队列似乎是您所需要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:46:58.980

我能想到的最简单的方法是两次部署您的服务：一次使用低/中端点，然后使用完全不同的实例使用高端点。正如 Endian 在他的回答中所说（我投票支持 BTW），您可以在物理上将它们分开，但您也可以让它们在同一个盒子上运行，即两个实例使用不同的端口。如果我必须这样做，这就是我会这样做（或真正推动）的方式。

您的另一个（不吸引人的）选项是创建一个能够处理消息并将它们放在单独的“VIP”行中的自定义通道，以及可以在服务操作时从“VIP”行中提取的相应操作行为已准备好接收消息。与第一个选项相比，这并没有真正为您买任何东西，因为您所做的只是确保您的服务在一个“集合”服务实例中运行。我猜在你的情况下，这对你没什么好处。

至于停止和重新启动服务是更高优先级的请求，有龙。如果可能的话，我会避免它。如果没有，您可能需要考虑将服务创建为 WF 工作流并使用它的一些流程启动/停止功能，但您仍然需要一些自定义通道和一些自定义行为才能使其正常工作。此时，您可能需要考虑 BizTalk。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-08T16:05:52.743

我想您必须自己实现该优先级。

如果有高优先级，您将不得不停止其他所有事情（保存其状态或其他内容）并开始做任何需要做的事情。

只是一个想法

# html - HTML div 和 span 元素有什么区别？

> ID：183532
> 
> 赞同：632
> 
> 时间：2008-10-08T16:01:44.623
> 
> 标签：html, tags

我想问一些简单的例子来说明`<div>`and的用法`<span>`。我见过他们都用`id`or来标记页面的一部分`class`，但我很想知道是否有时一个人比另一个人更受欢迎。

* * *

## 回答 #1

> 赞同：668
> 
> 时间：2008-10-08T16:03:17.943

*   `div`是[块元素](https://en.wikipedia.org/wiki/HTML_element#Block_elements)
*   `span`是一个[内联元素](https://en.wikipedia.org/wiki/HTML_element#Inline_elements)。

这意味着要在语义上使用它们，应该使用 div 来包装文档的各个部分，而应该使用 span 来包装文本、图像等的一小部分。

## 例如：

```
<div>This a large main division, with <span>a small bit</span> of spanned text!</div> 
```

### 请注意，将块级元素放置在内联元素中是非法的，因此：

```
<div>Some <span>text that <div>I want</div> to mark</span> up</div> 
```

...是非法的。

* * *

编辑：从 HTML5 开始，一些块元素可以放置在一些内联元素中。[请参阅此处](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Content_categories)的 MDN 参考以获得非常清晰的列表。以上仍然是非法的，因为`<span>`只接受短语内容，并且`<div>`是流内容。

* * *

你问了一些具体的例子，所以是从我的保龄球网站[BowlSK](http://www.bowlsk.com)中摘录的：

```
<div id="header">
  <div id="userbar">
    Hi there, <span class="username">Chris Marasti-Georg</span> |
    <a href="/edit-profile.html">Profile</a> |
    <a href="https://www.bowlsk.com/_ah/logout?...">Sign out</a>
  </div>
  <h1><a href="/">Bowl<span class="sk">SK</span></a></h1>
</div>
```

## 好吧，怎么回事？

在我的页面顶部，我有一个逻辑部分，即“标题”。由于这是一个部分，因此我使用了一个 div（具有适当的 id）。其中，我有几个部分：用户栏和实际页面标题。标题使用适当的标签，`h1`。作为一个部分的用户栏被包裹在一个`div`. 其中，用户名包含在一个 中`span`，以便我可以更改样式。如您所见，我还在`span`标题中包裹了大约 2 个字母 - 这允许我在样式表中更改它们的颜色。

另请注意，HTML5 包含一组广泛的新元素，这些元素定义了常见的页面结构，例如文章、部分、导航等。

[HTML 5 工作草案](https://dev.w3.org/html5/spec/Overview.html)的第 4.4 节列出了它们并给出了它们的用法提示。HTML5 仍然是一个有效的规范，所以还没有什么是“最终的”，但是这些元素中的任何一个是否会出现在任何地方都是非常值得怀疑的。如果您想在某些旧版本的 IE 中设置这些元素的样式，则需要使用 javascript hack - 您需要`document.createElement`在源中指定任何这些元素之前使用每个元素创建一个。有很多库可以为您解决这个问题 - 一个快速的谷歌搜索出现了[html5shiv](https://code.google.com/p/html5shiv/)。

* * *

## 回答 #2

> 赞同：432
> 
> 时间：2008-10-09T03:21:10.570

为了完整起见，我邀请您这样思考：

*   HTML 中定义了很多块元素（之前和之后的换行符），还有很多内联标签（没有换行符）。
*   但是在现代 HTML 中，所有元素都应该有*含义*：a`<p>`是段落，an`<li>`是列表项，等等，我们应该为正确的目的使用正确的标签——不像过去那样使用`<blockquote>`内容是否是引用来缩进。
*   那么，当你想做的事情没有意义*时*，你会怎么做？400px 宽的列没有*意义*，是吗？您只希望您的文本列宽 400 像素，因为这适合您的设计。
*   出于这个原因，他们在 HTML 中添加了另外两个元素：通用或无意义的元素`<div>`和`<span>`，否则，人们会重新滥用那些确实有意义的元素。

* * *

## 回答 #3

> 赞同：278
> 
> 时间：2013-10-07T18:02:53.643

这里已经有很好的详细答案，但没有视觉示例，所以这里有一个简单的说明：

![div和span的区别](https://i.stack.imgur.com/wA8PD.png)

```
<div>This is a div.</div>
<div>This is a div.</div>
<div>This is a div.</div>
<span>This is a span.</span>
<span>This is a span.</span>
<span>This is a span.</span>
```

`<div>`是块标签，`<span>`而是内联标签。

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2008-10-08T16:03:16.400

`<div>`是块级元素并且`<span>`是内联元素。

如果你想用一些内联文本做某事，这`<span>`是要走的路，因为它不会像 a`<div>`那样引入换行符。

* * *

正如其他人所指出的，其中每一个都隐含着一些语义，最重要的是 a`<div>`意味着文档中的逻辑划分，类似于文档的一部分或其他东西，a la：

```
<div id="Chapter1">
   <p>Lorem ipsum dolor sit amet, <span id="SomeSpecialText1">consectetuer adipiscing</span> elit. Duis congue vehicula purus.</p>
   <p>Nam <span id="SomeSpecialText2">eget magna nec</span> sapien fringilla euismod. Donec hendrerit.</p> 
</div> 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2008-10-08T16:08:06.500

克里斯的回答中已经提到了真正重要的区别。然而，对每个人的影响并不明显。

作为内联元素，`<span>`只能包含其他内联元素。因此下面的代码是错误的：

```
<span><p>This is a paragraph</p></span> 
```

上述代码无效。要包装块级元素，必须使用另一个块级元素（例如`<div>`）。另一方面，`<div>`只能在块级元素合法的地方使用。

此外，这些规则在 (X)HTML 中是固定的，并且*不会*因 CSS 规则的存在而改变！所以下面的代码*也是*错误的！

```
<span style="display: block"><p>Still wrong</p></span>
<span><p style="display: inline">Just as wrong</p></span> 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-03-08T19:56:46.773

“块元素”的意义是隐含的，但从未明确说明过。如果我们忽略所有的理论（理论是好的）那么下面是一个务实的比较。以下：

```
<p>This paragraph <span>has</span> a span.</p>
<p>This paragraph <div>has</div> a div.</p> 
```

产生：

```
This paragraph has a span.

This paragraph

has
a div. 
```

这表明不仅不**应该****内**联使用div ，它根本不会产生所需的效果。

 *** * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-08T16:07:38.170

如其他答案中所述，默认情况下`div`将呈现为块元素，而`span`将在其上下文中内联呈现。但两者都没有任何语义价值。它们的存在是为了让您可以将样式和身份应用于任何给定的内容。使用样式，您可以做出`div`类似 a 的行为`span`，反之亦然。

有用的样式之一`div`是`inline-block`

例子：

1.  [http://dustwell.com/div-span-inline-block.html](http://dustwell.com/div-span-inline-block.html)

2.  [CSS 显示：内联与内联块](https://stackoverflow.com/questions/9189810/css-display-inline-vs-inline-block)

在游戏网络项目中，我已经习惯`inline-block`了巨大的成功。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-08T16:09:27.777

我会说，如果你知道一点西班牙语来看看[这个页面](http://developer.mozilla.org/es/HTML/Elemento/span#div_y_span)，在哪里得到了正确的解释。

但是，一个快速的定义`div`是用于划分部分并将`span`某种样式应用于另一个块元素中的元素，例如`div`.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-05-18T06:22:11.433

div 是块元素，span 是内联元素，它的宽度取决于它自身的内容，而 div 没有

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-05-15T15:14:43.747

只是想为`span`vs的产生方式添加一些历史背景`div`

历史`span`：

> 1995 年 7 月 3 日，Benjamin CW Sittler**提出了一个通用文本容器**标签，用于将样式应用于某些文本块。除非与样式表一起使用，否则呈现是中性的。关于可读性和含义存在争议。Bert Bos 通过类属性（具有城市、人员、日期等值）提到了元素的可扩展性。**Paul Prescod 担心这两个元素都会被滥用。他反对文字提到“任何新元素都应该在旧元素上”并添加“如果我们创建一个没有语义的标签，它可以在任何地方使用而不会出错。**我们必须强制作者正确标记他们的语义文档。我们必须强制编辑器供应商在他们的界面中做出明确的选择。

[- 来源（w3 维基）](https://www.w3.org/wiki/Html/Elements/span)

从引入的 RFC 草案中`span`：

> 首先，在没有其他元素适合的情况下，需要一个通用容器来携带 LANG 和 BIDI 属性；**为此目的引入了 SPAN 元素。**

[- 来源（IETF 草案）](https://datatracker.ietf.org/doc/html/draft-ietf-html-i18n-01#page-12)

历史`div`：

> DIV 元素可用于将 HTML 文档构造为分部的层次结构。
> 
> ...
> 
> CENTER 是由 Netscape 在添加对 HTML 3.0 DIV 元素的支持之前引入的。由于其广泛部署，它保留在 HTML 3.2 中。

[HTML 3.2 规范](https://www.w3.org/TR/2018/SPSD-html32-20180315/#center)

简而言之，这两个元素都是出于对语义更通用的容器的需求。Span 被提议作为`<text>`元素样式文本的更通用替代。Div 被提议作为一种划分页面的通用方式，并且具有替换`<center>`中心对齐内容的标签的额外好处。Div 一直是块元素，因为它作为分页器的历史。Span 一直是一个内联元素，因为它最初的用途是文本样式，而今天 div 和 span 都已成为分别具有默认块和内联显示属性的通用元素。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-02-27T15:51:41.740

在 HTML 中，有一些标签可以为内容添加结构或语义。例如，`<p>`标签用于标识段落。另一个例子是`<ol>`有序列表的标签。

如上所示，当 HTML 中没有合适的标签时，通常会使用`<div>`and标签。`<span>`

该`<div>`标签用于标识文档的块级部分/分区，该文档前后都有换行符。

可以使用 div 标签的示例是页眉、页脚、导航等。但是在 HTML 5 中已经提供了这些标签。

该`<span>`标签用于标识文档的内联部分/分区。

例如，span 标签可用于向元素添加内联象形文字。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-12-03T11:50:26.150

请记住，基本上他们自己也不执行任何功能。它们**并不****仅仅通过它们的标签**来具体说明功能。

它们只能在 CSS 的帮助下进行定制。

现在来到你的问题：

SPAN 标记与一些样式一起在 html 中的一行内保持有用，比如在一个段落中。这是 HTML 中的一种行级别或语句级别。

例子：

```
<p>Am writing<span class="time">this answer</span> in my free time of my day.</p> 
```

如上所述的 DIV 标记功能只能在样式的支持下可见，可以容纳大量 HTML 代码。

DIV 是块级别

例子：

```
 <div class="large-time">
    <p>Am writing <span class="time"> this answer</span> in my free time of my day. 
    </p>
    </div> 
```

根据您的要求，两者都有自己的时间和情况。

希望答案很清楚。谢谢你。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-06-18T12:25:51.300

这很简单。

*   的使用`span`不会影响布局，因为它是内联的（`in line`（不应该混淆，因为可以包装东西））
*   use`div`影响布局，里面的内容出现在 new line( `block element`) 中，当你要添加的元素没有特殊的语义含义并且你希望它出现在 new line use中时`<div>`。

# windows - .NET SqlConnection 网卡使用

> ID：183557
> 
> 赞同：0
> 
> 时间：2008-10-08T16:06:51.463
> 
> 标签：windows, performance, networking, nic

拥有一台具有多个 NIC 的计算机，我需要以某种方式指定用于连接 SQL Server 的计算机。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T16:28:23.197

Following on from @pzycoman, SqlConnection (and SQL OLEDB/SQL Server ODBC) has no explicit connection string semantic to express the bound NIC other than to specify the destination server host address (which in turn triggers the route metrics discussion). Splitting out services or applications onto different subnets can work - but equally can also generate the utilization asymmetry similar what you see today.

Another potential option would be NIC teaming if your adapters support it. Teaming software bonds multiple NICs into a single logical channel for increased throughput with less NetOps complexity. This happens at a much lower level in the OSI and as such is transparent to your applications and services.

Teaming used to be frowned on for a number of reasons (predominantly NLB issues and driver quality), but those have been largely mitigated in the last couple of years.

As always engineering mentality will help - test *everything*.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T16:12:30.547

如果 NIC 有不同的子网，windows 应该自动通过正确的 NIC 路由请求（从命令行运行“路由打印”将显示什么被路由到哪里）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-10T12:58:39.630

Windows 网络堆栈将确定使用哪个 NIC 来访问您的数据库服务器。如果您在连接字符串中使用 sql 服务器的 netbios 名称，您可能希望将其替换为首选 nic 所在子网中的 IP 地址（或 dns 条目）。

# perl - Perl 单元测试中的分叉子进程停止证明；测试::线束退出

> ID：183560
> 
> 赞同：14
> 
> 时间：2008-10-08T16:07:34.533
> 
> 标签：perl, testing, fork, die, perl-prove

我一直在尝试使用 Perl 实用程序/模块“证明”作为某些单元测试的测试工具。单元测试比“单元”更“系统”，因为我需要分叉一些后台进程作为测试的一部分，使用以下...

```
sub SpinupMonitor{
   my $base_dir = shift;
   my $config = shift;

   my $pid = fork();
   if($pid){
      return $pid;
   }else{
      my $cmd = "$base_dir\/..\/bin\/monitor_real.pl -config $config -test";
      close STDOUT;

      exec ($cmd) or die "cannot exec test code [$cmd]\n";
   }
}

sub KillMonitor{

   my $pid = shift;

   print "Killing monitor [$pid]\n";
   kill(1,$pid);
} 
```

但是由于某种原因，当我让我的 .t 文件启动一些额外的进程时，它会导致测试工具在所有测试完成后挂在第一个 .t 文件的末尾，而不是继续到下一个文件或退出如果只有一个。

起初我想知道这是否可能是因为我正在杀死我的子进程并让它们失效。所以我加了..

```
$SIG{CHLD} = \&REAPER;
sub REAPER {
   my $pid = wait;
   $SIG{CHLD} = \&REAPER;
} 
```

到代码。但这无济于事。事实上，在封闭式检查中，结果证明我的 perl 测试文件已经退出，现在是一个已失效的进程，它是证明包装脚本没有收获它的孩子。事实上，当我在测试脚本末尾添加 die() 调用时，我得到了......

```
# Looks like your test died just after 7. 
```

所以我的脚本退出了，但由于某种原因，线束没有解开。

我确实确认，当我在测试失败时禁用它们时，肯定是我的子流程让它感到不安，而线束正确退出。

我在启动流程的方式上是否做错了什么，可能会以某种方式扰乱安全带？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-08T16:32:44.983

请注意，您不测试是否`fork()`失败。在假设“false”表示“child”之前， 您需要确保`$pid`已[定义。](http://perldoc.perl.org/functions/defined.html)

因为您`$cmd`包含 shell 元字符（空格），所以当您调用`exec()`. 当您的监视器正在运行时，有 (1) Perl、(2) 一个 child`sh -c`和 (3) 一个孙子 Perl running `monitor_real.pl`。这尤其意味着当您调用 时`KillMonitor`，您只是在杀死 shell（因为那是您拥有的 PID）而不是监视器。

您可能还对[如何分叉守护进程感兴趣？](http://perldoc.perl.org/perlfaq8.html#How-do-I-fork-a-daemon-process%3f)来自 Perl 常见问题解答。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T21:07:23.947

我假设你所有的孩子在你离开考试之前都已经退出了？因为否则，它可能会挂在 STDERR 上，这可能会混淆证明。如果您可以关闭 STDERR，或者至少重定向到父进程中的管道，那可能是您遇到的一个问题。

除此之外，我还要指出你不需要转义正斜杠，如果你没有使用 shell 元字符（空格不是 perl 的元字符 - 认为“ `*?{}()`”），你应该明确并创建一个列表：

```
use File::Spec;
my @cmd = File::Spec->catfile($basedir,
                              File::Spec->updir(),
                              qw(bin monitor_real.pl)
                             ),
          -config => $config,
          -test   =>;

close STDOUT;
close STDERR;

exec (@cmd) or die "cannot exec test code [@cmd]\n"; 
```

# linq-to-sql - Linq to SQL 的零对多关系

> ID：183567
> 
> 赞同：1
> 
> 时间：2008-10-08T16:08:43.267
> 
> 标签：linq-to-sql

我有一个用户类，它可能有也可能没有关联的部门。这是通过外键DepartmentId引用的，User表中的相关字段设置为允许空值。

当我设置“创建用户”表单并选择无部门时，SubmitChanges() 出现冲突错误：

```
The INSERT statement conflicted with the FOREIGN KEY constraint "FK_User_Department". 
```

当“部门”被选为“空白”第一个选项时，如何说服 Linq to SQL 插入 NULL？

或者，也许，Html.DropDownList 方法的“optionLabel”参数是否缺少关键字？我目前正在使用“无”，因为使用 null 或“”会导致不显示“空白选项”，我怀疑这可能是导致问题的原因。感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T16:25:51.440

通过在我的方法中添加以下内容，我找到了一个不太理想的解决方案`UsersController.Create`：

```
// Snipped UpdateModel call
if (form["User.DepartmentId"].Length == 0)
{
    createdUser.DepartmentId = null;
}
Models.User.DataContext.SubmitChanges(); 
```

当然，我更喜欢更清洁/自动的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T16:14:35.597

当没有选择部门时，您可以在部门中分配一个条目“N/A”。那么你就不会遇到外键冲突了。

# ruby - 在 Linux 上安装 newgem 时出错

> ID：183578
> 
> 赞同：5
> 
> 时间：2008-10-08T16:11:45.790
> 
> 标签：ruby, linux

我正在尝试在我的 linux 机器上安装 newgem（sudo gem install newgem），但出现以下错误：

```
Building native extensions.  This could take a while...
ERROR:  Error installing newgem:
ERROR: Failed to build gem native extension.

/usr/bin/ruby1.8 extconf.rb install newgem
extconf.rb:1:in `require': no such file to load -- mkmf (LoadError)
from extconf.rb:1

Gem files will remain installed in /usr/lib/ruby/gems/1.8/gems/RedCloth-4.0.4 for inspection.
Results logged to /usr/lib/ruby/gems/1.8/gems/RedCloth-4.0.4/ext/redcloth_scan/gem_make.out 
```

问题可能是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T17:23:04.663

`mkmf`是一个生成 Makefile 的 Ruby 模块。它应该是标准 Ruby 安装的一部分，但 Debian（和衍生产品）将其拆分到`ruby1.8-dev`包中。

`mkmf.rb`如果您在 输出的任何目录中都找不到`ruby -e'print $:.join("\n")'`，那么您应该弄清楚您需要安装什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T04:28:25.920

它可能是由它的依赖项之一引起的。我认为它不再需要所有这些依赖项。如果它仍然是一个问题，请在[http://drnic.lighthouseapp.com/projects/18881-newgem/](http://drnic.lighthouseapp.com/projects/18881-newgem/)提出一个错误，我们将看到可以删除哪些依赖项。

# sql - SQL 命令到 LINQ（透视）

> ID：183585
> 
> 赞同：3
> 
> 时间：2008-10-08T16:13:18.983
> 
> 标签：sql, linq, pivot

我正在将数据库从 MySQL（使用 ODBC）移动到 MS SQL，并且我想将 SQL 查询“翻译”到 LINQ。有人可以帮我解决这个问题（它应该为每个位置和按月分组结果的 SUM Charge 列）：

```
SELECT
sum(case when Location="Location1" then Charge else 0 end) as Location1,
sum(case when Location="Location2" then Charge else 0 end) as Location2,
sum(case when Location="Location3" then Charge else 0 end) as Location3,
MAKEDATE(YEAR(OrderTime),DAYOFYEAR(OrderTime)) AS date FROM Sales
GROUP BY YEAR(OrderTime),MONTH(OrderTime)
ORDER BY OrderTime DESC 
```

?

输出应如下所示：

```
Location1 | Location2 | Location3 | date 
```

编辑：

我尝试从这里使用 LINQ 示例：

[是否可以使用 LINQ 透视数据？](https://stackoverflow.com/questions/167304/is-it-possible-to-pivot-data-using-linq)

```
var query = context.log_sales
                            .GroupBy(c => c.OrderTime)
                            .Select(g => new
                            {
                                Date = g.Key,
                                Location1 = g.Where(c => c.Location == "Location1").Sum(c => c.Charge) ?? 0,
                                Location2 = g.Where(c => c.Location == "Location2").Sum(c => c.Charge) ?? 0
                            }).ToList(); 
```

这几乎是我所需要的。也应该按年份分组，我不知道该怎么做。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T18:03:46.517

这可能会有所帮助。

```
context.log_sales
.GroupBy(s => new {Year = OrderTime.Year, Month = OrderTime.Month})
.Select
( g => new {
  Date = new DateTime(g.Key.Year, g.Key.Month, 1),
  Location1 = g.Where(s => s.Location == "Location1").Sum(s => s.Charge),
  Location2 = g.Where(s => s.Location == "Location2").Sum(s => s.Charge),
  Location3 = g.Where(s => s.Location == "Location3").Sum(s => s.Charge),
  }
)
.OrderBy(x => x.Date); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T08:43:27.177

..您是否知道如何动态添加要选择的位置？例如来自列表/数组。

编辑：..或者可能使位置动态加载并设置应在选择之前的 Where 语句中加载哪些位置。这可能吗？

# nhibernate - 从 NHibernate 映射文件生成 C# 类的工具？

> ID：183586
> 
> 赞同：2
> 
> 时间：2008-10-08T16:13:23.947
> 
> 标签：nhibernate

有什么工具可以从 NHibernate 映射文件生成 C# 类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T20:58:26.540

在“有用的工具”下的[NHibernate 资源页面上](http://nhibernate.info/doc/nh/en/index.html#toolsetguide-s2)，列出了一些代码生成器：http: [//nhibernate.info/doc/nh/en/index.html](http://nhibernate.info/doc/nh/en/index.html#toolsetguide-s2)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-19T18:19:50.850

[NConstruct Lite](http://www.nconstruct.com/App/NConstructLite.aspx?PageId=12)生成映射文件和 C# 类 - 所有数据都从数据库（MS SQL、Oracle、Access）中读取。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-24T07:47:08.283

我写了一个小的：http: [//www.codeplex.com/EntityGenerator](http://www.codeplex.com/EntityGenerator)

目前它是一个带有配置文件的小型控制台应用程序。不是很用户友好，但它可以工作并且模板很容易定制。

仍在大力开发中，有时间我会更新它:)

# c# - Windows 窗体应用程序中异常处理的最佳实践？

> ID：183589
> 
> 赞同：119
> 
> 时间：2008-10-08T16:13:43.897
> 
> 标签：c#, winforms, exception-handling

我目前正在编写我的第一个 Windows 窗体应用程序。我现在已经阅读了几本 C# 书籍，因此我对 C# 必须处理异常的哪些语言特性有了一个相对较好的理解。它们都是非常理论化的，但是我还没有了解如何在我的应用程序中将基本概念转化为良好的异常处理模型。

有人愿意分享有关该主题的任何智慧珍珠吗？发布您看到像我这样的新手所犯的任何常见错误，以及有关以使我的应用程序更加稳定和健壮的方式处理异常的任何一般建议。

我目前正在努力解决的主要问题是：

*   我什么时候应该重新抛出异常？
*   我应该尝试使用某种中央错误处理机制吗？
*   与先发制人地测试诸如磁盘上的文件是否存在之类的事情相比，处理可能引发的异常是否会影响性能？
*   所有可执行代码都应该包含在 try-catch-finally 块中吗？
*   是否有任何时候可以接受空的 catch 块？

感谢所有建议！

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-08T16:33:12.360

A few more bits ...

You absolutely should have a centralized exception handling policy in place. This can be as simple as wrapping `Main()` in a try/catch, failing fast with a graceful error message to the user. This is the "last resort" exception handler.

Preemptive checks are always correct if feasible, but not always perfect. For example, between the code where you check for a file's existence and the next line where you open it, the file could have been deleted or some other issue may impede your access. You still need try/catch/finally in that world. Use both the preemptive check and the try/catch/finally as appropriate.

Never "swallow" an exception, except in the most well-documented cases when you are absolutely, positively sure that the exception being thrown is livable. This will almost never be the case. (And if it is, make sure you're swallowing only the *specific* exception class -- don't *ever* swallow `System.Exception`.)

When building libraries (used by your app), do not swallow exceptions, and do not be afraid to let the exceptions bubble up. Do not re-throw unless you have something useful to add. Do not ever (in C#) do this:

```
throw ex; 
```

As you will erase the call stack. If you must re-throw (which is occasionally necessary, such as when using the Exception Handling Block of Enterprise Library), use the following:

```
throw; 
```

At the end of the day, the very vast majority of exceptions thrown by a running application should be exposed somewhere. They should not be exposed to end users (as they often contain proprietary or otherwise valuable data), but rather usually logged, with administrators notified of the exception. The user can be presented with a generic dialog box, maybe with a reference number, to keep things simple.

Exception handling in .NET is more art than science. Everyone will have their favorites to share here. These are just a few of the tips I've picked up using .NET since day 1, techniques which have saved my bacon on more than one occasion. Your mileage may vary.

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-10-08T16:30:46.110

There is an excellent code [CodeProject article here](http://www.codeproject.com/Articles/9538/Exception-Handling-Best-Practices-in-NET). Here are a couple of highlights:

*   Plan for the worst*
*   Check it early
*   Don't trust external data
*   The only reliable devices are: the video, the mouse and keyboard.
*   Writes can fail, too
*   Code Safely
*   Don't throw new Exception()
*   Don't put important exception information on the Message field
*   Put a single catch (Exception ex) per thread
*   Generic Exceptions caught should be published
*   Log Exception.ToString(); never log only Exception.Message!
*   Don't catch (Exception) more than once per thread
*   Don't ever swallow exceptions
*   Cleanup code should be put in finally blocks
*   Use "using" everywhere
*   Don't return special values on error conditions
*   Don't use exceptions to indicate absence of a resource
*   Don't use exception handling as means of returning information from a method
*   Use exceptions for errors that should not be ignored
*   Don't clear the stack trace when re-throwing an exception
*   Avoid changing exceptions without adding semantic value
*   Exceptions should be marked [Serializable]
*   When in doubt, don't Assert, throw an Exception
*   Each exception class should have at least the three original constructors
*   Be careful when using the AppDomain.UnhandledException event
*   Don't reinvent the wheel
*   Don't use Unstructured Error Handling (VB.Net)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-24T20:08:32.980

请注意，Windows 窗体有它自己的异常处理机制。如果单击表单中的按钮并且其处理程序引发了处理程序中未捕获的异常，Windows 窗体将显示其自己的未处理异常对话框。

为了防止显示未处理的异常对话框并捕获此类异常以进行日志记录和/或提供您自己的错误对话框，您可以在 Main() 方法中调用 Application.Run() 之前附加到 Application.ThreadException 事件。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-10-08T18:34:54.020

到目前为止，这里发布的所有建议都很好，值得关注。

我想扩展的一件事是您的问题“与先发制人地测试诸如磁盘上的文件是否存在之类的事情相比，处理可能引发的异常是否会影响性能？”

天真的经验法则是“try/catch 块很昂贵”。事实并非如此。尝试并不昂贵。关键是系统必须创建一个异常对象并使用堆栈跟踪加载它，这很昂贵。在很多情况下，异常足够异常，可以将代码包装在 try/catch 块中。

例如，如果您要填充字典，则：

```
try
{
   dict.Add(key, value);
}
catch(KeyException)
{
} 
```

通常比这样做更快：

```
if (!dict.ContainsKey(key))
{
   dict.Add(key, value);
} 
```

对于您添加的每个项目，因为只有在添加重复键时才会引发异常。（LINQ 聚合查询执行此操作。）

在您给出的示例中，我几乎不假思索地使用 try/catch。首先，仅仅因为文件在您检查时存在并不意味着当您打开它时它就会存在，所以无论如何您都应该真正处理异常。

其次，我认为更重要的是，除非您的 a）您的进程正在打开数千个文件，并且 b）它试图打开的文件不存在的可能性并不低，否则创建异常对性能的影响不是您的事情重新注意到。一般来说，当你的程序试图打开一个文件时，它只是试图打开一个文件。在这种情况下，编写更安全的代码几乎肯定会比编写尽可能快的代码更好。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-08T16:36:19.093

Here are a few guidelines that I follow

1.  Fail-Fast: This is more of a exception generating guideline, For every assumption that you make and every parameter that you are getting into a function do a check to make sure that you're starting off with the right data and that the assumptions you're making are correct. Typical checks include, argument not null, argument in expected range etc.

2.  When rethrowing preserve stack trace - This simply translates to using throw when rethrowing instead of throw new Exception(). Alternatively if you feel that you can add more information then wrap the original exception as an inner exception. But if you're catching an exception only to log it then definitely use throw;

3.  Do not catch exceptions that you cannot handle, so don't worry about things like OutOfMemoryException because if they occur you won't be able to do much anyways.

4.  Do hook global exception handlers and make sure to log as much information as possible. For winforms hook both the appdomain and thread unhandled exception events.

5.  Performance should only be taken into consideration when you've analyzed the code and seen that it's causing a performance bottleneck, by default optimize for readability and design. So about your original question on the file existence check, I would say it depends, If you can do something about the file not being there, then yes do that check otherwise if all you're going to do is throw an exception if the file's not there then I don't see the point.

6.  There are definitely times when empty catch blocks are required, I think people who say otherwise have not worked on codebases that have evolved over several releases. But they should be commented and reviewed to make sure that they're really needed. The most typical example is developers using try/catch to convert string to integer instead of using ParseInt().

7.  If you expect the caller of your code to be able to handle error conditions then create custom exceptions that detail what the un excepected situation is and provide relevant information. Otherwise just stick to built-in exception types as much as possible.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-08T16:24:19.460

I like the philosophy of not catching anything I don't intend on handling, whatever handling means in my particular context.

I hate it when I see code such as:

```
try
{
   // some stuff is done here
}
catch
{
} 
```

I have seen this from time to time and it is quite difficult to find problems when someone 'eats' the exceptions. A coworker I had does this and it tends to end up being a contributor to a steady stream of issues.

I re-throw if there is something that my particular class needs to do in response to an exception but the problem needs to be bubbled out to however called the method where it happened.

I think code should be written proactively and that exceptions should be for exceptional situations, not to avoid testing for conditions.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-08T16:25:22.907

I'm just on my way out but will give you a brief run down on where to use exception handling. I will attempt to address your other points when I return :)

1.  Explicitly check for all known error conditions*
2.  Add a try/catch around the code if your are unsure if you were able to handle all cases
3.  Add a try/catch around the code if the .NET interface you are calling throws an exception
4.  Add a try/catch around the code if it crosses a complexity threshold for you
5.  Add a try/catch around the code if for a sanity check: You are asserting THIS SHOULD NEVER HAPPEN
6.  As a general rule, I do not use exceptions as a replacement for return codes. This is fine for .NET, but not me. I do have exceptions (hehe) to this rule though, it depends on the architecture of the application your are working on as well.

*Within reason. There is no need to check to see if say a cosmic ray hit your data causing a couple bits to get flipped. Understanding what is "reasonable" is an acquired skill for an engineer. It's hard to quantify, yet easy to intuit. That is, I can easily explain why I use a try/catch in any particular instance, yet I am hard pressed to imbue another with this same knowledge.

I for one tend to steer away from heavily exception based architectures. try/catch doesn't have a performance hit as such, the hit comes in when the exception is thrown and the code might have to walk up several levels of the call stack before something handles it.

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-08T16:38:33.707

The golden rule that have tried to stick to is handle the exception as close to the source as possible.

If you must re-throw an exception try to add to it, re-throwing a FileNotFoundException does not help much but throwing a ConfigurationFileNotFoundException will allow it to be captured and acted upon somewhere up the chain.

Another rule I try to follow is not to use try/catch as a form of program flow, so I do verify files/connections, ensure objects have been initiated, ect.. prior to using them. Try/catch should be for Exceptions, things you can not control.

As for an empty catch block, if you are doing anything of importance in the code that generated the exception you should re-throw the exception at a minimum. If there is no consequences of the code that threw the exception not running why did you write it in the first place.

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2019-01-15T15:19:16.353

您可以捕获 ThreadException 事件。

1.  在解决方案资源管理器中选择一个 Windows 应用程序项目。

2.  通过双击打开生成的 Program.cs 文件。

3.  将以下代码行添加到代码文件的顶部：

    ```
    using System.Threading; 
    ```

4.  在 Main() 方法中，添加以下内容作为方法的第一行：

    ```
    Application.ThreadException += new ThreadExceptionEventHandler(Application_ThreadException); 
    ```

5.  在 Main() 方法下面添加以下内容：

    ```
    static void Application_ThreadException(object sender, ThreadExceptionEventArgs e)
    {
        // Do logging or whatever here
        Application.Exit();
    } 
    ```

6.  添加代码以处理事件处理程序中未处理的异常。应用程序中其他任何地方未处理的任何异常都由上述代码处理。最常见的是，此代码应记录错误并向用户显示消息。

参考：[https ://blogs.msmvps.com/deborahk/global-exception-handler-winforms/](https://blogs.msmvps.com/deborahk/global-exception-handler-winforms/)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-08T16:22:38.857

Exceptions are expensive but necessary. You don't need to wrap everything in a try catch but you do need to ensure that exceptions are always caught eventually. Much of it will depend on your design.

Don't re-throw if letting the exception rise will do just as well. Never let errors pass unnoticed.

example:

```
void Main()
{
  try {
    DoStuff();
  }
  catch(Exception ex) {
    LogStuff(ex.ToString());
  }

void DoStuff() {
... Stuff ...
} 
```

If DoStuff goes wrong you'll want it to bail anyway. The exception will get thrown up to main and you'll see the train of events in the stack trace of ex.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-05T21:27:57.637

根据我的经验，当我知道我将要创建异常时，我认为捕获异常是合适的。例如，当我在一个 Web 应用程序中并且我正在执行 Response.Redirect 时，我知道我会得到一个 System.ThreadAbortException。因为这是故意的，所以我只是抓住了特定类型的东西，然后吞下它。

```
try
{
/*Doing stuff that may cause an exception*/
Response.Redirect("http:\\www.somewhereelse.com");
}
catch (ThreadAbortException tex){/*Ignore*/}
catch (Exception ex){/*HandleException*/} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-08T16:25:27.227

> When should I re-throw an exception?

Everywhere, but end user methods... like button click handlers

> Should I try to have a central error-handling mechanism of some kind?

I write a log file... pretty easy for a WinForm app

> Do handling exceptions which might be thrown have a performance hit compared with pre-emptively testing things like whether a file on disk exists?

I'm not sure about this, but I believe it is a good practice to thow exceptions... I mean you can ask whether a file exists and if it doesn't throw a FileNotFoundException

> Should all executable code be enclosed in try-catch-finally blocks?

yeap

> Are there any times when an empty catch block might be acceptable?

Yes, let's say you want to show a date, but you have no clue how that date was stores (dd/mm/yyyy, mm/dd/yyyy, etc) you try tp parse it but if it fails just keep going... if it is irrelevant to you... I would say yes, there is

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-08T16:26:04.420

The one thing I learned very quickly was to enclose **absolutely every** chunk of code that interacts with **anything** outside the flow of my program (i.e. File System, Database Calls, User Input) with try-catch blocks. Try-catch can incur a performance hit, but usually in these places in your code it won't be noticeable and it will pay for itself with safety.

I have used empty catch-blocks in places where the user might do something that isn't really "incorrect", but it can throw an exception...an example that comes to mind is in a GridView if the user DoubleCLicks the gray placeholder cell on the top-left it will fire the CellDoubleClick event, but the cell doesn't belong to a row. In that case, you *dont* really need to post a message but if you don't catch it it will throw an unhandled exception error to the user.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-08T16:38:02.243

When re-throwing an exception the key word throw by it self. This will throw the caught exception and still will be able to use stack trace to see where it came from.

```
Try
{
int a = 10 / 0;
}
catch(exception e){
//error logging
throw;
} 
```

doing this will cause the stack trace to end in the catch statement. (avoid this)

```
catch(Exception e)
// logging
throw e;
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-15T15:21:17.667

我非常同意以下规则：

*   永远不要让错误被忽视。

原因是：

*   当您第一次写下代码时，很可能您不会完全了解 3 方代码、.NET FCL 库或您的同事的最新贡献。实际上，在您充分了解每个异常可能性之前，您不能拒绝编写代码。所以
*   我经常发现我使用 try/catch(Exception ex) 只是因为我想保护自己免受未知事物的侵害，而且，正如您所注意到的，我捕获了异常，而不是更具体的异常，例如 OutOfMemoryException 等。而且，我总是抛出异常被 ForceAssert.AlwaysAssert(false, ex.ToString() ) 弹出给我（或 QA）；

ForceAssert.AlwaysAssert 是我个人的 Trace.Assert 方式，无论是否定义了 DEBUG/TRACE 宏。

开发周期可能是：我注意到丑陋的 Assert 对话框或其他人向我抱怨它，然后我回到代码并找出引发异常的原因并决定如何处理它。

通过这种方式，我可以在短时间内写下*我的代码，并保护我免受未知领域的影响，但如果发生异常情况，我总是会注意到，这样系统就变得更安全了。*

我知道你们中的许多人不会同意我的观点，因为开发人员应该知道他/她的代码的每一个细节，坦率地说，我在过去也是一个纯粹主义者。但现在我了解到，上述政策更加务实。

对于 WinForms 代码，我始终遵守的一条黄金法则是：

*   始终尝试/捕获（异常）您的事件处理程序代码

这将保护您的 UI 始终可用。

对于性能损失，性能损失仅在代码达到 catch 时发生，在没有引发实际异常的情况下执行 try 代码没有显着影响。

异常应该很少发生，否则就不是异常。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2017-03-14T11:51:00.537

你必须考虑用户。应用程序崩溃是**最后一次**用户想要的东西。因此，任何可能失败的操作都应该在 ui 级别有一个 try catch 块。没有必要在每个方法中都使用 try catch，但每次用户做某事时，它必须能够处理一般异常。这绝不能让您免于检查所有内容以防止在第一种情况下出现异常，但是没有没有错误的复杂应用程序，并且操作系统很容易添加意外问题，因此您必须预测意外并确保用户是否想要使用一个操作不会因为应用程序崩溃而丢失数据。没有必要让您的应用程序崩溃，如果您捕获异常，它将永远不会处于不确定状态，并且用户总是因崩溃而感到不便。即使异常在最顶层，不崩溃意味着用户可以快速重现异常或至少记录错误消息，从而极大地帮助您解决问题。当然，不仅仅是收到一条简单的错误消息，然后只看到 Windows 错误对话框或类似的东西。

这就是为什么您绝不能自负并认为您的应用程序没有错误，这是不能保证的。包装一些有关适当代码的 try catch 块并显示错误消息/记录错误是一项*非常小的工作。*

作为用户，每当浏览器或办公应用程序或其他任何崩溃时，我肯定会非常生气。如果异常如此之高以至于应用程序无法继续，最好显示该消息并告诉用户该做什么（重新启动，修复一些操作系统设置，报告错误等），而不是简单地崩溃，仅此而已。

# visual-studio - 为什么 Visual Studio 需要这么长时间才能删除文件

> ID：183602
> 
> 赞同：15
> 
> 时间：2008-10-08T16:15:57.183
> 
> 标签：visual-studio

为什么 Visual Studio 需要这么长时间才能从解决方案树中删除文件？该应用程序冻结并坐在那里感觉像是永恒的。

如果我先从文件系统中删除文件，然后在解决方案中删除它，它会立即发生。

我可以在某处设置一个选项来避免这种情况吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-08T17:47:43.460

我发现当我的回收站中有很多文件（1000 多个文件）时，在 Windows 资源管理器和 Visual Studio 中删除文件需要更长的时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T16:17:53.513

我发现这有时是项目规模的症状。从包含数百个文件的项目中删除一个文件可能需要 30 秒在我的（诚然慢的）工作计算机上。但是删除项目中的两个文件之一通常是即时的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T16:18:36.790

你有 Visual Studio 的版本控制插件吗？它可能正在联系服务器以确保您可以检查它...

如果不是，文件在哪里？它是本地文件还是网络上的文件？有时，如果在网络上，VS 必须检查您是否有 Windows 访问权限才能删除文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T16:31:35.517

你有安装 Resharper 吗？一旦我安装了它，它肯定会减慢我机器上的文件操作。我认为值得权衡。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T16:45:20.840

一旦文件被删除，它可能正在重建/从智能感知数据库中删除或检查项目的其余部分是否有效。或者可能只是新的 VS 有问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T16:55:33.580

如果您的项目规模很大，这可能是正常的。我们谈论的是[50-200 个项目的解决方案](https://stackoverflow.com/questions/163740/aspnet-project-size#164598)。

如果您在 PC 上安装了 R#，请尝试[禁用它](http://tech.groups.yahoo.com/group/altdotnet/message/11685)或尝试使用空回收站删除您的项目项目。

尽管我不建议这样做，但您可以尝试从所有项目目录中[删除所有 *.opt 和 *.ncb 文件](http://www.gerd-riesselmann.net/archives/2005/10/when-visual-studio-becomes-slow)，然后重新启动 Visual Studio。

# ruby-on-rails - 如何创建与 ActiveResource 对象的 ActiveRecord 关系？

> ID：183604
> 
> 赞同：5
> 
> 时间：2008-10-08T16:16:54.530
> 
> 标签：ruby-on-rails, activerecord, activeresource

假设我正在为已经拥有 People 应用程序的出版公司编写图书馆应用程序。

所以在我的图书馆应用程序中，我有

```
class Person < ActiveResource::Base
  self.site = "http://api.people.mypublisher.com/"
end 
```

现在我想`Article`为每个存储 s `Person`：

```
class Article < ActiveRecord::Base
  belongs_to :person, :as => :author
end 
```

我想我的数据库中有下表：

```
Articles
id (PK) | title (string) | body (text) | author_id (integer) 
```

`author_id`不完全是外键，因为我没有 People 表。这留下了几个问题：

1.  我如何告诉我的`Person` `ActiveResource`对象呢`has_many` `Articles`？

2.  会`Articles.find(:first).author`工作吗？`belongs_to`考虑到没有`ActiveRecord`也没有后备表，甚至会起作用吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T16:19:31.313

我想＃1的一种可能性，假设我可以让它工作，就是这样做：

```
class Person < ActiveResource::Base
  self.site = "http://api.people.mypublisher.com/"

  def articles
    Article.find(:all, :conditions => { :person_id => self.id })
  end

  def add_article(article)
    article.person_id = self.id
  end
end 
```

但它失去了**很多**东西`has_many`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-26T01:08:31.590

正如您所指出的，您放弃了很多，因为 ActiveResource 没有 ActiveRecord 所具有的关联。

您已经找到问题 #1 的答案。至于问题 #2，您的 ActiveRecord 模型文章在配置了与 ActiveResource 模型的“belongs_to”关联时应该表现得很好。也就是说 Aritcle.find(:first).author 应该返回你想要的 person 对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-17T22:37:30.923

我认为更好的解决方案是制作一个返回范围的方法。

```
class Person < ActiveResource::Base
  self.site = ..
. 
  def articles
    Article.for_person(self.id)
  end
end

class Article < ActiveRecord::Base
  named_scope :for_person, lambda { |pid| { :conditions => { :person_id => pid }}}
end 
```

# c++ - 比较函子类型与运算符<

> ID：183606
> 
> 赞同：10
> 
> 时间：2008-10-08T16:17:28.070
> 
> 标签：c++, stl, coding-style

在[Google C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)中，[运算符重载部分](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Operator_Overloading)建议不要重载*任何*运算符（“除非在罕见的特殊情况下”）。具体来说，它建议：

> 特别是，不要重载 `operator==`或`operator<`只是为了让你的类可以用作 STL 容器中的键；相反，您应该在声明容器时创建相等和比较函子类型。

我对这样的仿函数看起来有点模糊，但我的主要问题是，你*为什么*要为此编写自己的仿函数？定义`operator<`和使用标准`std::less<T>`函数不会更简单吗？使用其中一个有什么优势吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-08T16:32:55.590

除了更基本的类型之外，小于运算并不总是微不足道的，甚至相等也可能因情况而异。

想象一家航空公司想要为所有乘客分配一个登机号码的情况。这个数字反映了登机顺序（当然）。现在，是什么决定了谁先于谁？您可能只采用客户注册的顺序 - 在这种情况下，小于操作将比较签入时间。您还可以考虑客户为他们的门票支付的价格——低于现在比较门票价格。

… 等等。总而言之，`operator <`在`Passenger`类上定义一个没有意义，尽管它可能需要将乘客放在一个排序的容器中。我认为这就是谷歌所警告的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T16:54:00.150

一般来说，定义`operator<`更好更简单。

您想要使用仿函数的情况是当您需要多种方法来比较特定类型时。例如：

```
class Person;

struct CompareByHeight {
    bool operator()(const Person &a, const Person &b);
};

struct CompareByWeight {
    bool operator()(const Person &a, const Person &b);
}; 
```

在这种情况下，可能没有一个好的“默认”方式来比较和排序人们，因此不定义`operator<`和使用仿函数可能会更好。你也可以说一般人是按身高排序的，所以`operator<`只需调用`CompareByHeight`，任何需要 Person 的按体重排序的人都必须`CompareByWeight`明确使用。

很多时候，问题在于定义函子是由类的用户决定的，因此，每当需要在有序容器中使用类时，您往往会获得对同一事物的许多重新定义。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-08T16:29:05.990

好吧，根据您引用的网页，函子没有太多优势（“[操作员]可以欺骗我们的直觉，认为昂贵的操作是便宜的内置操作。”）

我的感觉是，应该努力让你尽可能地把一流的对象归类，这对我来说意味着让他们理解尽可能多的操作符。

我已经有一段时间没有写函子了，但它看起来像这样：

```
class MyClass {....}

class LessThanMyClass : std:binary_function<MyClass, MyClass, bool>
{
    public bool operator()(MyClass lhs, MyClass rhs) 
    {   return /* determine if lhs < rhs */ ; }
}

vector<MyClass> objs;
std::sort(objs.begin(), objs.end(), LessThanMyClass()); 
```

}

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-08T17:06:17.113

我可能不会像谷歌风格指南那样走得那么远。

我认为他们得到的是，当您重载`operator<`and时`operator==`，您正在为该类型的每次使用做出决定，而仿函数类型仅适用于该集合。

如果您唯一需要比较器的是将项目放入集合中，那么最好有一个专门用于该上下文的函数，而不是适用于所有上下文的运算符。

您可能希望按时间顺序对采购订单进行排序，但一般来说，按总价比较它们是有意义的。如果我们超载`operator<`比较日期以便我们可以将它们加载到集合中，我们就会引入另一个客户可能滥用我们的风险，`operator<`他们可能认为比较总价格。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T21:36:16.680

我认为未定义 operator< 背后的信息是排序是集合的属性，而不是对象的属性。相同对象的不同集合可能有不同的排序。所以你应该在指定集合的​​类型时使用一个单独的函子而不是 operator<。

但在实践中，您的许多类可能具有自然排序，这是您应用程序中集合中使用的唯一排序。在其他情况下，排序甚至可能与应用程序无关，只是集合，以便以后可以找到项目。在这些情况下，定义 operator< 非常有意义。

请记住，当我们设计对象模型时，我们只是对现实世界的一个子集进行建模。在现实世界中，可能有无数种不同的方法来对同一类的对象进行排序，但在我们正在工作的应用程序领域中，可能存在一种相关的方法。

如果代码演变为需要与第一次一样相关的第二次排序，则应重构该类以删除 operator< 并将两个排名函数放在单独的函子中。这表明没有一个排名比其他排名更重要的意图。

关于算术运算符，除非您正在实现算术类型，否则不应重载它们。

当然，每条规则都有例外。如果你不知道你是否应该例外，你可能不应该。经验将是你的向导。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-08T16:29:50.573

函子是一个带有`operator ()`. 在这种情况下，该方法将采用被比较类型的两个参数，`bool`如果第一个小于第二个，则返回结果。

编辑：以[James Curran](https://stackoverflow.com/questions/183606/comparison-functor-types-vs-operator#183653)所说的为基础，您可以在类中定义您的仿函数。因此，例如：

```
class MyClass
{
    struct LessThan : public std::binary_function<MyClass, MyClass, bool>
    {
        bool operator()(const MyClass & first, const MyClass & second) const
        {
            return first.key < second.key;
        }
    };
}; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T16:31:44.407

具有讽刺意味的是，仿函数还需要覆盖运算符（函数调用运算符 - `operator ()`），所以我不确定它们的意义是什么。

# shell - 如何比较 Bourne Shell 中的字符串？

> ID：183622
> 
> 赞同：15
> 
> 时间：2008-10-08T16:21:47.907
> 
> 标签：shell, sh, posix

我需要比较shell中的字符串：

```
var1="mtu eth0"

if [ "$var1" == "mtu *" ]
then
    # do something
fi 
```

但显然“*”在 Shell 中不起作用。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-08T16:28:27.347

使用 Unix 工具。该程序`cut`将愉快地缩短一个字符串。

```
if [ "$(echo $var1 | cut -c 4)" = "mtu " ]; 
```

...应该做你想做的事。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-08T16:27:34.527

# `bash`

最短修复：

```
if [[ "$var1" = "mtu "* ]] 
```

Bash`[[ ]]`并没有得到全局扩展，不像`[ ]`（出于历史原因，必须这样做）。

* * *

# `bash --posix`

哦，我发的太快了。Bourne shell，而不是 Bash ......

```
if [ "${var1:0:4}" == "mtu " ] 
```

`${var1:0:4}`表示 的前四个字符`$var1`。

* * *

# `/bin/sh`

啊，对不起。Bash 的 POSIX 仿真还远远不够；真正的原始 Bourne shell 没有`${var1:0:4}`. 您将需要类似 mstrobl 的解决方案。

```
if [ "$(echo "$var1" | cut -c0-4)" == "mtu " ] 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-08T16:37:45.473

您可以调用`expr`以从 Bourne Shell 脚本中将字符串与正则表达式匹配。以下似乎有效：

```
#!/bin/sh

var1="mtu eth0"

if [ "`expr \"$var1\" : \"mtu .*\"`" != "0" ];then
  echo "match"
fi 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-02T18:58:52.467

我喜欢使用 case 语句来比较字符串。

一个简单的例子是

```
case "$input"
in
  "$variable1") echo "matched the first value" 
     ;;
  "$variable2") echo "matched the second value"
     ;;
  *[a-z]*)  echo "input has letters" 
     ;;
  '')       echo "input is null!"
     ;;
   *[0-9]*)  echo "matched numbers (but I don't have letters, otherwise the letter test would have been hit first!)"
     ;;
   *) echo "Some wacky stuff in the input!"
esac 
```

我做过疯狂的事情，比如

```
case "$(cat file)"
in
  "$(cat other_file)")  echo "file and other_file are the same"
      ;;
  *)  echo "file and other_file are different"
esac 
```

这也有效，但有一些限制，例如文件不能超过几兆字节，shell 根本看不到空值，所以如果一个文件充满了空值而另一个没有，（并且两者都没有其他任何东西），这个测试不会看到两者之间有任何区别。

我不使用文件比较作为一个严肃的例子，只是一个例子说明 case 语句如何能够进行比 test 或 expr 或其他类似的 shell 表达式更灵活的字符串匹配。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-08T21:13:02.217

我会做以下事情：

```
# Removes anything but first word from "var1"
if [ "${var1%% *}" = "mtu" ] ; then ... fi 
```

或者：

```
# Tries to remove the first word if it is "mtu", checks if we removed anything
if [ "${var1#mtu }" != "$var1" ] ; then ... fi 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-08T23:58:11.360

在 Bourne shell 中，如果我想检查一个字符串是否包含另一个字符串：

```
if [  `echo ${String} | grep -c ${Substr} ` -eq 1 ] ; then 
```

用`echo ${String} | grep -c ${Substr}`两个```反引号括起来：

要检查子字符串是在开头还是结尾：

```
if [ `echo ${String} | grep -c "^${Substr}"` -eq 1 ] ; then
...
if [ `echo ${String} | grep -c "${Substr}$"` -eq 1 ] ; then 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-08T16:29:14.740

或者，作为**=~**运算符的示例：

```
if [[ "$var1" =~ "mtu *" ]] 
```

# java - JPA/Hibernate 实体类和同步的最佳实践是什么？

> ID：183629
> 
> 赞同：2
> 
> 时间：2008-10-08T16:23:38.917
> 
> 标签：java, multithreading, hibernate, jpa

我见过的大多数 JPA/Hibernate 实体 bean 类的示例似乎都没有显式同步。然而，可以在构建事务的上下文中调用这些对象的 getter/setter。并且有可能跨多个线程调用这些方法（尽管这可能是不寻常和奇怪的）。

似乎如果它是跨多个线程构建的，那么对对象状态的更改可能会丢失，这将是可悲的。

那么，省略同步是最佳实践吗？Hibernate 检测代码是否为我处理了正确的同步？

举个例子：

```
@Entity
public class Ninja {
  @Id @GeneratedValue
  private Long id;

  @Column 
  private String name;

  @Column
  private int throwingStars;

  public Ninja() {}
  public int getThrowingStars() { return throwingStars; } 
  public void addThrowingStar() { throwingStars += 1; }
} 
```

投掷星方法需要同步吗？我当然不希望我的忍者失去任何投掷的星星。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T21:15:44.957

在我看来，您永远不应该跨线程共享域对象。事实上，我通常在线程之间共享很少，因为必须保护这些数据。我已经构建了一些大型/高性能系统，并且从未违反过这条规则。如果您需要并行化工作，请这样做，但不要通过共享域对象的实例。每个线程都应该从数据库中读取数据，通过改变/创建对象对其进行操作，然后提交/回滚事务。Work pass in/out 通常应该是 value/readonly 对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T17:52:45.447

“而且有可能跨多个线程调用这些方法（尽管这可能是不寻常和奇怪的）。”

我只能代表hibernate，因为我对JPA没有太多经验。调用 set 的对象并不总是调用 get 的对象。当 Hibernate 为您加载 Object 时，它会调用 set* 方法，然后您（和您的线程）在其余时间调用 get 。

同样，当您（即您的写入器线程）修改现有对象然后再次保存它时，您需要保护对对象的访问（以便其他读取器/写入器线程不会读取脏数据）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T13:08:35.940

2 个线程的对象可能不同。假设您的线程使用会话工厂来访问数据库，那么您从会话中获得的对象应该被视为“独立”的（我相信 hibernate 会为每个 get() 创建“新鲜”对象，除非它们在会话中）。

至于你的星星问题，当两个人从数据库中获取同一行时，它是相同的，数据库“ACID”属性将确保每个操作都是原子的，所以如果你从 Thread t1 中的忍者中删除一颗星并**提交**，线程 t2 将读取 t1 的提交值。

或者，您可以要求 hibernate 将相关 ninja 的行锁定在 T1 中，这样即使 T2 请求该行，它也必须等到 T1 提交或中止。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T12:34:36.870

JPA/Hibernate 实体是 POJO。Hibernate 和任何 JPA-Provider 都不会改变运行时语义。

因此，如果您在使用简单 POJO 时遇到并发问题，您的实体也会遇到并发问题！

在我见过的所有系统中，域模型都不是线程保存的，实体实例不被多个线程访问。

但是，您可以同时拥有相同实体的多个实例。在这种情况下，同步是通过 DB 完成的。这里的模式是乐观和悲观锁定。Hibernate 和 JPA 可以帮助您实现这些模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T16:59:23.900

您的问题的最佳实践是乐观锁定：

来自 Java Persistence API (JPA) 规范（第 3.4.1 章）：

> 乐观锁定是一种技术，用于确保仅当自读取实体状态以来没有干预事务更新实体状态的数据时，才对与实体状态相对应的数据库数据进行更新。这确保了对该数据的更新或删除与数据库的当前状态一致，并且干预更新不会丢失。

您需要为您的类和数据库表中的一列添加一个 @Version 注释。

# c# - Selecting a node in virtualized TreeView with WPF

> ID：183636
> 
> 赞同：19
> 
> 时间：2008-10-08T16:25:26.807
> 
> 标签：c#, wpf, mvvm, treeview

Is there a way to select manually a node in virtualizing TreeView and then bring it into view?

The data model I'm using with my TreeView is implemented based on the VM-M-V model. Each TreeViewItem's IsSelected property is binded to a corresponing property in ViewModel. I've also created a listener for TreeView's ItemSelected event where I call BringIntoView() for the selected TreeViewItem.

The problem with this approach seems to be that the ItemSelected event won't be raised until the actual TreeViewItem is created. So with the virtualization enabled node selection won't do anything until the TreeView is scrolled enough and then it jumps "magically" to the selected node when the event is finally raised.

I'd really like to use virtualization because I have thousands of nodes in my tree and I've already seen quite impressive performance improvements when the virtualization has been enabled.

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-02-09T07:30:52.863

Estifanos Kidane 提供的链接已损坏。他可能指[的是“在虚拟化 TreeView 中更改选择”MSDN 示例](http://code.msdn.microsoft.com/Changing-selection-in-a-6a6242c8/sourcecode?fileId=18862&pathId=753647475)。但是，此示例显示了如何选择树中的节点，但使用代码隐藏而不是 MVVM 和绑定，因此当绑定的 SelectedItem 更改时，它也不会处理丢失的[SelectedItemChanged 事件。](http://msdn.microsoft.com/en-us/library/system.windows.controls.treeview.selecteditemchanged.aspx)

我能想到的唯一解决方案是打破 MVVM 模式，当绑定到 SelectedItem 属性的 ViewModel 属性发生变化时，获取 View 并调用代码隐藏方法（类似于 MSDN 示例）以确保新值实际上是在树中选择的。

这是我为处理它而编写的代码。假设您的数据项是`Node`具有`Parent`属性的类型：

```
public class Node
{
    public Node Parent { get; set; }
} 
```

我写了以下行为类：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Reflection;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Interactivity;

public class NodeTreeSelectionBehavior : Behavior<TreeView>
{
    public Node SelectedItem
    {
        get { return (Node)GetValue(SelectedItemProperty); }
        set { SetValue(SelectedItemProperty, value); }
    }

    public static readonly DependencyProperty SelectedItemProperty =
        DependencyProperty.Register("SelectedItem", typeof(Node), typeof(NodeTreeSelectionBehavior),
            new FrameworkPropertyMetadata(null, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, OnSelectedItemChanged));

    private static void OnSelectedItemChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var newNode = e.NewValue as Node;
        if (newNode == null) return;
        var behavior = (NodeTreeSelectionBehavior)d;
        var tree = behavior.AssociatedObject;

        var nodeDynasty = new List<Node> { newNode };
        var parent = newNode.Parent;
        while (parent != null)
        {
            nodeDynasty.Insert(0, parent);
            parent = parent.Parent;
        }

        var currentParent = tree as ItemsControl;
        foreach (var node in nodeDynasty)
        {
            // first try the easy way
            var newParent = currentParent.ItemContainerGenerator.ContainerFromItem(node) as TreeViewItem;
            if (newParent == null)
            {
                // if this failed, it's probably because of virtualization, and we will have to do it the hard way.
                // this code is influenced by TreeViewItem.ExpandRecursive decompiled code, and the MSDN sample at http://code.msdn.microsoft.com/Changing-selection-in-a-6a6242c8/sourcecode?fileId=18862&pathId=753647475
                // see also the question at http://stackoverflow.com/q/183636/46635
                currentParent.ApplyTemplate();
                var itemsPresenter = (ItemsPresenter)currentParent.Template.FindName("ItemsHost", currentParent);
                if (itemsPresenter != null)
                {
                    itemsPresenter.ApplyTemplate();
                }
                else
                {
                    currentParent.UpdateLayout();
                }

                var virtualizingPanel = GetItemsHost(currentParent) as VirtualizingPanel;
                CallEnsureGenerator(virtualizingPanel);
                var index = currentParent.Items.IndexOf(node);
                if (index < 0)
                {
                    throw new InvalidOperationException("Node '" + node + "' cannot be fount in container");
                }
                CallBringIndexIntoView(virtualizingPanel, index);
                newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
            }

            if (newParent == null)
            {
                throw new InvalidOperationException("Tree view item cannot be found or created for node '" + node + "'");
            }

            if (node == newNode)
            {
                newParent.IsSelected = true;
                newParent.BringIntoView();
                break;
            }

            newParent.IsExpanded = true;
            currentParent = newParent;
        }
    }

    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.SelectedItemChanged += OnTreeViewSelectedItemChanged;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.SelectedItemChanged -= OnTreeViewSelectedItemChanged;
    }

    private void OnTreeViewSelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)
    {
        SelectedItem = e.NewValue as Node;
    }

    #region Functions to get internal members using reflection

    // Some functionality we need is hidden in internal members, so we use reflection to get them

    #region ItemsControl.ItemsHost

    static readonly PropertyInfo ItemsHostPropertyInfo = typeof(ItemsControl).GetProperty("ItemsHost", BindingFlags.Instance | BindingFlags.NonPublic);

    private static Panel GetItemsHost(ItemsControl itemsControl)
    {
        Debug.Assert(itemsControl != null);
        return ItemsHostPropertyInfo.GetValue(itemsControl, null) as Panel;
    }

    #endregion ItemsControl.ItemsHost

    #region Panel.EnsureGenerator

    private static readonly MethodInfo EnsureGeneratorMethodInfo = typeof(Panel).GetMethod("EnsureGenerator", BindingFlags.Instance | BindingFlags.NonPublic);

    private static void CallEnsureGenerator(Panel panel)
    {
        Debug.Assert(panel != null);
        EnsureGeneratorMethodInfo.Invoke(panel, null);
    }

    #endregion Panel.EnsureGenerator

    #region VirtualizingPanel.BringIndexIntoView

    private static readonly MethodInfo BringIndexIntoViewMethodInfo = typeof(VirtualizingPanel).GetMethod("BringIndexIntoView", BindingFlags.Instance | BindingFlags.NonPublic);

    private static void CallBringIndexIntoView(VirtualizingPanel virtualizingPanel, int index)
    {
        Debug.Assert(virtualizingPanel != null);
        BringIndexIntoViewMethodInfo.Invoke(virtualizingPanel, new object[] { index });
    }

    #endregion VirtualizingPanel.BringIndexIntoView

    #endregion Functions to get internal members using reflection
} 
```

使用此类，您可以编写 XAML，如下所示：

```
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:local="clr-namespace:MyProject">
    <Grid>
        <TreeView ItemsSource="{Binding MyItems}"
                  ScrollViewer.CanContentScroll="True"
                  VirtualizingStackPanel.IsVirtualizing="True"
                  VirtualizingStackPanel.VirtualizationMode="Recycling">
            <i:Interaction.Behaviors>
                <local:NodeTreeSelectionBehavior SelectedItem="{Binding MySelectedItem}" />
            </i:Interaction.Behaviors>
        </TreeView>
    <Grid>
<UserControl> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-07-26T14:09:36.647

`TreeView`我通过为和创建自定义控件解决了这个`TreeViewItem`问题`VirtualizingStackPanel`。解决方案的一部分来自[http://code.msdn.microsoft.com/Changing-selection-in-a-6a6242c8](http://code.msdn.microsoft.com/Changing-selection-in-a-6a6242c8)。

每个 TreeItem（绑定项）都需要知道其父项（由 强制执行`ITreeItem`）。

```
public interface ITreeItem {
    ITreeItem Parent { get; }
    IList<ITreeItem> Children { get; }
    bool IsSelected { get; set; }
    bool IsExpanded { get; set; }
} 
```

当`IsSelected`在任何 TreeItem 上设置时，会通知视图模型并引发事件。`BringItemIntoView`视图中相应的事件监听器调用`TreeView`.

`TreeView`查找所选项目路径上的所有内容`TreeViewItems`并将它们显示在视图中。

这里是其余的代码：

```
public class SelectableVirtualizingTreeView : TreeView {
    public SelectableVirtualizingTreeView() {
        VirtualizingStackPanel.SetIsVirtualizing(this, true);
        VirtualizingStackPanel.SetVirtualizationMode(this, VirtualizationMode.Recycling);
        var panelfactory = new FrameworkElementFactory(typeof(SelectableVirtualizingStackPanel));
        panelfactory.SetValue(Panel.IsItemsHostProperty, true);
        var template = new ItemsPanelTemplate { VisualTree = panelfactory };
        ItemsPanel = template;
    }

    public void BringItemIntoView(ITreeItem treeItemViewModel) {
        if (treeItemViewModel == null) {
            return;
        }
        var stack = new Stack<ITreeItem>();
        stack.Push(treeItemViewModel);
        while (treeItemViewModel.Parent != null) {
            stack.Push(treeItemViewModel.Parent);
            treeItemViewModel = treeItemViewModel.Parent;
        }
        ItemsControl containerControl = this;
        while (stack.Count > 0) {
            var viewModel = stack.Pop();
            var treeViewItem = containerControl.ItemContainerGenerator.ContainerFromItem(viewModel);
            var virtualizingPanel = FindVisualChild<SelectableVirtualizingStackPanel>(containerControl);
            if (virtualizingPanel != null) {
                var index = viewModel.Parent != null ? viewModel.Parent.Children.IndexOf(viewModel) : Items.IndexOf(treeViewItem);
                virtualizingPanel.BringIntoView(index);
                Focus();
            }
            containerControl = (ItemsControl)treeViewItem;
        }
    }

    protected override DependencyObject GetContainerForItemOverride() {
        return new SelectableVirtualizingTreeViewItem();
    }

    protected override void PrepareContainerForItemOverride(DependencyObject element, object item) {
        base.PrepareContainerForItemOverride(element, item);
        ((TreeViewItem)element).IsExpanded = true;
    }

    private static T FindVisualChild<T>(Visual visual) where T : Visual {
        for (var i = 0; i < VisualTreeHelper.GetChildrenCount(visual); i++) {
            var child = (Visual)VisualTreeHelper.GetChild(visual, i);
            if (child == null) {
                continue;
            }
            var correctlyTyped = child as T;
            if (correctlyTyped != null) {
                return correctlyTyped;
            }
            var descendent = FindVisualChild<T>(child);
            if (descendent != null) {
                return descendent;
            }
        }
        return null;
    }
}

public class SelectableVirtualizingTreeViewItem : TreeViewItem {
    public SelectableVirtualizingTreeViewItem() {
        var panelfactory = new FrameworkElementFactory(typeof(SelectableVirtualizingStackPanel));
        panelfactory.SetValue(Panel.IsItemsHostProperty, true);
        var template = new ItemsPanelTemplate { VisualTree = panelfactory };
        ItemsPanel = template;
        SetBinding(IsSelectedProperty, new Binding("IsSelected"));
        SetBinding(IsExpandedProperty, new Binding("IsExpanded"));
    }

    protected override DependencyObject GetContainerForItemOverride() {
        return new SelectableVirtualizingTreeViewItem();
    }

    protected override void PrepareContainerForItemOverride(DependencyObject element, object item) {
        base.PrepareContainerForItemOverride(element, item);
        ((TreeViewItem)element).IsExpanded = true;
    }
}

public class SelectableVirtualizingStackPanel : VirtualizingStackPanel {
    public void BringIntoView(int index) {
        if (index < 0) {
            return;
        }
        BringIndexIntoView(index);
    }
}

public abstract class TreeItemBase : ITreeItem {
    protected TreeItemBase() {
        Children = new ObservableCollection<ITreeItem>();
    }

    public ITreeItem Parent { get; protected set; }

    public IList<ITreeItem> Children { get; protected set; }

    public abstract bool IsSelected { get; set; }

    public abstract bool IsExpanded { get; set; }

    public event EventHandler DescendantSelected;

    protected void RaiseDescendantSelected(TreeItemViewModel newItem) {
        if (Parent != null) {
            ((TreeItemViewModel)Parent).RaiseDescendantSelected(newItem);
        } else {
            var handler = DescendantSelected;
            if (handler != null) {
                handler.Invoke(newItem, EventArgs.Empty);
            }
        }
    }
}

public class MainViewModel : INotifyPropertyChanged {
    private TreeItemViewModel _selectedItem;

    public MainViewModel() {
        TreeItemViewModels = new List<TreeItemViewModel> { new TreeItemViewModel { Name = "Item" } };
        for (var i = 0; i < 30; i++) {
            TreeItemViewModels[0].AddChildInitial();
        }
        TreeItemViewModels[0].IsSelected = true;
        TreeItemViewModels[0].DescendantSelected += OnDescendantSelected;
    }

    public event EventHandler DescendantSelected;

    public event PropertyChangedEventHandler PropertyChanged;

    public List<TreeItemViewModel> TreeItemViewModels { get; private set; }

    public TreeItemViewModel SelectedItem {
        get {
            return _selectedItem;
        }
        set {
            if (_selectedItem == value) {
                return;
            }
            _selectedItem = value;
            var handler = PropertyChanged;
            if (handler != null) {
                handler.Invoke(this, new PropertyChangedEventArgs("SelectedItem"));
            }
        }
    }

    private void OnDescendantSelected(object sender, EventArgs eventArgs) {
        var handler = DescendantSelected;
        if (handler != null) {
            handler.Invoke(sender, eventArgs);
        }
    }
}

public partial class MainWindow {
    public MainWindow() {
        InitializeComponent();
        var mainViewModel = (MainViewModel)DataContext;
        mainViewModel.DescendantSelected += OnMainViewModelDescendantSelected;
    }

    private void OnAddButtonClick(object sender, RoutedEventArgs e) {
        var mainViewModel = (MainViewModel)DataContext;
        var treeItemViewModel = mainViewModel.SelectedItem;
        if (treeItemViewModel != null) {
            treeItemViewModel.AddChild();
        }
    }

    private void OnMainViewModelDescendantSelected(object sender, EventArgs eventArgs) {
        _treeView.BringItemIntoView(sender as TreeItemViewModel);
    }

    private void OnTreeViewSelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e) {
        if (e.OldValue == e.NewValue) {
            return;
        }
        var treeView = (TreeView)sender;
        var treeItemviewModel = treeView.SelectedItem as TreeItemViewModel;
        var mainViewModel = (MainViewModel)DataContext;
        mainViewModel.SelectedItem = treeItemviewModel;
    }
} 
```

在 XAML 中：

```
<controls:SelectableVirtualizingTreeView x:Name="_treeView" ItemsSource="{Binding TreeItemViewModels}" Margin="8" 
        SelectedItemChanged="OnTreeViewSelectedItemChanged">
    <controls:SelectableVirtualizingTreeView.ItemTemplate>
        <HierarchicalDataTemplate ... />
    </controls:SelectableVirtualizingTreeView.ItemTemplate>
</controls:SelectableVirtualizingTreeView> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-12T15:00:03.217

我使用附加属性来解决这个问题。

```
public class TreeViewItemBehaviour
{
    #region IsBroughtIntoViewWhenSelected

    public static bool GetIsBroughtIntoViewWhenSelected(TreeViewItem treeViewItem)
    {
        return (bool)treeViewItem.GetValue(IsBroughtIntoViewWhenSelectedProperty);
    }

    public static void SetIsBroughtIntoViewWhenSelected(
      TreeViewItem treeViewItem, bool value)
    {
        treeViewItem.SetValue(IsBroughtIntoViewWhenSelectedProperty, value);
    }

    public static readonly DependencyProperty IsBroughtIntoViewWhenSelectedProperty =
        DependencyProperty.RegisterAttached(
        "IsBroughtIntoViewWhenSelected",
        typeof(bool),
        typeof(TreeViewItemBehaviour),
        new UIPropertyMetadata(false, OnIsBroughtIntoViewWhenSelectedChanged));

    static void OnIsBroughtIntoViewWhenSelectedChanged(
      DependencyObject depObj, DependencyPropertyChangedEventArgs e)
    {
        TreeViewItem item = depObj as TreeViewItem;
        if (item == null)
            return;

        if (e.NewValue is bool == false)
            return;

        if ((bool)e.NewValue)
        {
            item.Loaded += item_Loaded;
        }
        else
        {
            item.Loaded -= item_Loaded;
        }
    }

    static void item_Loaded(object sender, RoutedEventArgs e)
    {
        TreeViewItem item = e.OriginalSource as TreeViewItem;
        if (item != null)
            item.BringIntoView();
    }

    #endregion // IsBroughtIntoViewWhenSelected

} 
```

在我的 TreeViewItem 的 XAML 样式中，我只是将属性设置为 true

```
<Setter Property="Behaviours:TreeViewItemBehaviour.IsBroughtIntoViewWhenSelected" Value="True" /> 
```

高温高压

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-09-07T08:28:03.623

如果你使用了这个（[https://stackoverflow.com/a/9206992/8559138](https://stackoverflow.com/a/9206992/8559138)）决策并且有时会得到 InvalidOperationException，你可以使用我的固定决策：

如果 newParent 为空，我会更新 currentParent 布局并再次尝试获取 ContainerFromIndex。

```
 newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
 if (newParent == null)
 {
      currentParent.UpdateLayout();
      virtualizingPanel.BringIndexIntoViewPublic(index);
      newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
 } 
```

完整的决定：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Reflection;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Interactivity;

public class NodeTreeSelectionBehavior : Behavior<TreeView>
{
    public INode SelectedItem
    {
        get { return (INode)GetValue(SelectedItemProperty); }
        set { SetValue(SelectedItemProperty, value); }
    }

    public static readonly DependencyProperty SelectedItemProperty =
        DependencyProperty.Register("SelectedItem", typeof(Node), typeof(NodeTreeSelectionBehavior),
            new FrameworkPropertyMetadata(null, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, OnSelectedItemChanged));

    private static void OnSelectedItemChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var newNode = e.NewValue as INode;
        if (newNode == null) return;
        var behavior = (NodeTreeSelectionBehavior)d;
        var tree = behavior.AssociatedObject;

        var nodeDynasty = new List<INode> { newNode };
        var parent = newNode.Parent;
        while (parent != null)
        {
            nodeDynasty.Insert(0, parent);
            parent = parent.Parent;
        }

        var currentParent = tree as ItemsControl;
        foreach (var node in nodeDynasty)
        {
            // first try the easy way
            var newParent = currentParent.ItemContainerGenerator.ContainerFromItem(node) as TreeViewItem;
            var index = 0;
            VirtualizingPanel virtualizingPanel = null;
            if (newParent == null)
            {
                // if this failed, it's probably because of virtualization, and we will have to do it the hard way.
                // this code is influenced by TreeViewItem.ExpandRecursive decompiled code, and the MSDN sample at http://code.msdn.microsoft.com/Changing-selection-in-a-6a6242c8/sourcecode?fileId=18862&pathId=753647475
                // see also the question at http://stackoverflow.com/q/183636/46635
                currentParent.ApplyTemplate();
                var itemsPresenter = (ItemsPresenter)currentParent.Template.FindName("ItemsHost", currentParent);
                if (itemsPresenter != null)
                {
                    itemsPresenter.ApplyTemplate();
                }
                else
                {
                    currentParent.UpdateLayout();
                }

                virtualizingPanel = GetItemsHost(currentParent) as VirtualizingPanel;
                CallEnsureGenerator(virtualizingPanel);
                index = currentParent.Items.IndexOf(node);
                if (index < 0)
                {
                    throw new InvalidOperationException("Node '" + node + "' cannot be fount in container");
                }
                if (virtualizingPanel != null)
                {
                    virtualizingPanel.BringIndexIntoViewPublic(index);
                }
                newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
                if (newParent == null)
                {
                    currentParent.UpdateLayout();
                    virtualizingPanel.BringIndexIntoViewPublic(index);
                    newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
                }
            }

            if (newParent == null)
            {
                  throw new InvalidOperationException("Tree view item cannot be found or created for node '" + node + "'");
            }

            if (node == newNode)
            {
                newParent.IsSelected = true;
                newParent.BringIntoView();
                break;
            }

            newParent.IsExpanded = true;
            currentParent = newParent;
        }
    }

    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.SelectedItemChanged += OnTreeViewSelectedItemChanged;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.SelectedItemChanged -= OnTreeViewSelectedItemChanged;
    }

    private void OnTreeViewSelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)
    {
        SelectedItem = e.NewValue as INode;
    }

    #region Functions to get internal members using reflection

    // Some functionality we need is hidden in internal members, so we use reflection to get them

    #region ItemsControl.ItemsHost

    static readonly PropertyInfo ItemsHostPropertyInfo = typeof(ItemsControl).GetProperty("ItemsHost", BindingFlags.Instance | BindingFlags.NonPublic);

    private static Panel GetItemsHost(ItemsControl itemsControl)
    {
        Debug.Assert(itemsControl != null);
        return ItemsHostPropertyInfo.GetValue(itemsControl, null) as Panel;
    }

    #endregion ItemsControl.ItemsHost

    #region Panel.EnsureGenerator

    private static readonly MethodInfo EnsureGeneratorMethodInfo = typeof(Panel).GetMethod("EnsureGenerator", BindingFlags.Instance | BindingFlags.NonPublic);

    private static void CallEnsureGenerator(Panel panel)
    {
        Debug.Assert(panel != null);
        EnsureGeneratorMethodInfo.Invoke(panel, null);
    }

    #endregion Panel.EnsureGenerator

    #endregion Functions to get internal members using reflection
} 
```

和 XAML：

```
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
         xmlns:local="clr-namespace:MyProject">
<Grid>
    <TreeView ItemsSource="{Binding MyItems}"
              ScrollViewer.CanContentScroll="True"
              VirtualizingStackPanel.IsVirtualizing="True"
              VirtualizingStackPanel.VirtualizationMode="Recycling">
        <i:Interaction.Behaviors>
            <local:NodeTreeSelectionBehavior SelectedItem="{Binding MySelectedItem}" />
        </i:Interaction.Behaviors>
    </TreeView>
<Grid> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:34:25.573

Here is an example taken from an [MSDN Question](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/a74f22cc-5f82-4070-9f32-c6985dbdead5/) public void ScrollToItem(int index)

```
 {

        Dispatcher.BeginInvoke(System.Windows.Threading.DispatcherPriority.Background,

            (System.Windows.Threading.DispatcherOperationCallback)delegate(object arg)

            {

                int N = fileList.Items.Count;

                if (N == 0)

                    return null;

                if (index < 0)

                {

                    fileList.ScrollIntoView(fileList.Items[0]); // scroll to first

                }

                else

                {

                    if (index < N)

                    {

                        fileList.ScrollIntoView(fileList.Items[index]); // scroll to item

                    }

                    else

                    {

                        fileList.ScrollIntoView(fileList.Items[N - 1]); // scroll to last

                    }

                }

                return null;

            }, null);

    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-07T08:55:31.747

看到最近发布了这个问题的新答案，我将把我的 0.02 美元添加到这个问题的 MVVM 纯解决方案中。

[将 perTreeViewItemViewModelBase](https://github.com/Peregrine66/PeregrinesView/blob/master/library/Peregrine.WPF.ViewModel/perTreeViewItemViewModelBase.cs)作为树视图项数据的基类，您可以使用附加属性在 TreeView 上创建可绑定的选定项属性。

```
public class perTreeViewHelper : Behavior<TreeView>
{
    public object BoundSelectedItem
    {
        get { return GetValue(BoundSelectedItemProperty); }
        set { SetValue(BoundSelectedItemProperty, value); }
    }

    public static readonly DependencyProperty BoundSelectedItemProperty =
        DependencyProperty.Register("BoundSelectedItem",
            typeof(object),
            typeof(perTreeViewHelper),
            new FrameworkPropertyMetadata(null,
                FrameworkPropertyMetadataOptions.BindsTwoWayByDefault,
                OnBoundSelectedItemChanged));

    private static void OnBoundSelectedItemChanged(DependencyObject obj, DependencyPropertyChangedEventArgs args)
    {
        var item = args.NewValue as perTreeViewItemViewModelBase;

        if (item != null)
            item.IsSelected = true;
    }

    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.SelectedItemChanged += OnTreeViewSelectedItemChanged;
    }

    protected override void OnDetaching()
    {
        AssociatedObject.SelectedItemChanged -= OnTreeViewSelectedItemChanged;
        base.OnDetaching();
    }

    private void OnTreeViewSelectedItemChanged(object obj, RoutedPropertyChangedEventArgs<object> args)
    {
        BoundSelectedItem = args.NewValue;
    }
} 
```

第二个帮助类处理将 TreeViewItems 滚动到视图中。有两种不同的情况

*   选择项目时
*   当一个项目展开时，树会滚动以显示尽可能多的子项目

请注意调度程序优先级的使用，它确保在我们尝试将它们滚动到视图之前，任何虚拟化项目都已完全形成。

```
public static class perTreeViewItemHelper
{
    public static bool GetBringSelectedItemIntoView(TreeViewItem treeViewItem)
    {
        return (bool)treeViewItem.GetValue(BringSelectedItemIntoViewProperty);
    }

    public static void SetBringSelectedItemIntoView(TreeViewItem treeViewItem, bool value)
    {
        treeViewItem.SetValue(BringSelectedItemIntoViewProperty, value);
    }

    public static readonly DependencyProperty BringSelectedItemIntoViewProperty =
        DependencyProperty.RegisterAttached(
            "BringSelectedItemIntoView",
            typeof(bool),
            typeof(perTreeViewItemHelper),
            new UIPropertyMetadata(false, BringSelectedItemIntoViewChanged));

    private static void BringSelectedItemIntoViewChanged(DependencyObject obj, DependencyPropertyChangedEventArgs args)
    {
        if (!(args.NewValue is bool))
            return;

        var item = obj as TreeViewItem;

        if (item == null)
            return;

        if ((bool)args.NewValue)
            item.Selected += OnTreeViewItemSelected;
        else
            item.Selected -= OnTreeViewItemSelected;
    }

    private static void OnTreeViewItemSelected(object sender, RoutedEventArgs e)
    {
        var item = e.OriginalSource as TreeViewItem;
        item?.BringIntoView();

        // prevent this event bubbling up to any parent nodes
        e.Handled = true;
    }

    public static bool GetBringExpandedChildrenIntoView(TreeViewItem treeViewItem)
    {
        return (bool)treeViewItem.GetValue(BringExpandedChildrenIntoViewProperty);
    }

    public static void SetBringExpandedChildrenIntoView(TreeViewItem treeViewItem, bool value)
    {
        treeViewItem.SetValue(BringExpandedChildrenIntoViewProperty, value);
    }

    public static readonly DependencyProperty BringExpandedChildrenIntoViewProperty =
        DependencyProperty.RegisterAttached(
            "BringExpandedChildrenIntoView",
            typeof(bool),
            typeof(perTreeViewItemHelper),
            new UIPropertyMetadata(false, BringExpandedChildrenIntoViewChanged));

    private static void BringExpandedChildrenIntoViewChanged(DependencyObject obj, DependencyPropertyChangedEventArgs args)
    {
        if (!(args.NewValue is bool))
            return;

        var item = obj as TreeViewItem;

        if (item == null)
            return;

        if ((bool)args.NewValue)
            item.Expanded += OnTreeViewItemExpanded;
        else
            item.Expanded -= OnTreeViewItemExpanded;
    }

    private static void OnTreeViewItemExpanded(object sender, RoutedEventArgs e)
    {
        var item = e.OriginalSource as TreeViewItem;

        if (item == null)
            return;

        // use DispatcherPriority.ContextIdle, so that we wait for all of the UI elements for any newly visible children to be created

        // first bring the last child into view
        Action action = () =>
        {
            var lastChild = item.ItemContainerGenerator.ContainerFromIndex(item.Items.Count - 1) as TreeViewItem;
            lastChild?.BringIntoView();
        };

        item.Dispatcher.BeginInvoke(action, DispatcherPriority.ContextIdle);

        // then bring the expanded item (back) into view
        action = () => { item.BringIntoView(); };
        item.Dispatcher.BeginInvoke(action, DispatcherPriority.ContextIdle);

        // prevent this event bubbling up to any parent nodes
        e.Handled = true;
    }
} 
```

这个帮助类可以包含在 TreeView 控件的样式中。

```
<Style x:Key="perExpandCollapseToggleStyle" TargetType="ToggleButton">
    <Setter Property="Focusable" Value="False" />
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="ToggleButton">
                <Grid Width="10"
                      Height="10"
                      Background="Transparent">
                    <Path x:Name="ExpanderGlyph"
                          Margin="1"
                          HorizontalAlignment="Left"
                          VerticalAlignment="Center"
                          Data="M 0,3 L 0,5 L 3,5 L 3,8 L 5,8 L 5,5 L 8,5 L 8,3 L 5,3 L 5,0 L 3,0 L 3,3 z"
                          Fill="LightGreen"
                          Stretch="None" />
                </Grid>

                <ControlTemplate.Triggers>
                    <Trigger Property="IsChecked" Value="True">
                        <Setter TargetName="ExpanderGlyph" Property="Data" Value="M 0,0 M 8,8 M 0,3 L 0,5 L 8,5 L 8,3 z" />
                        <Setter TargetName="ExpanderGlyph" Property="Fill" Value="Red" />
                    </Trigger>

                    <Trigger Property="IsEnabled" Value="False">
                        <Setter TargetName="ExpanderGlyph" Property="Fill" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>

<Style x:Key="perTreeViewItemContainerStyle"
       TargetType="{x:Type TreeViewItem}">

    <!-- Link the properties of perTreeViewItemViewModelBase to the corresponding ones on the TreeViewItem -->
    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
    <Setter Property="IsEnabled" Value="{Binding IsEnabled}" />

    <!-- Include the two "Scroll into View" behaviors -->
    <Setter Property="vhelp:perTreeViewItemHelper.BringSelectedItemIntoView" Value="True" />
    <Setter Property="vhelp:perTreeViewItemHelper.BringExpandedChildrenIntoView" Value="True" />

    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type TreeViewItem}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"
                                          MinWidth="14" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <ToggleButton x:Name="Expander"
                                  Grid.Row="0"
                                  Grid.Column="0"
                                  ClickMode="Press"
                                  IsChecked="{Binding Path=IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                  Style="{StaticResource perExpandCollapseToggleStyle}" />

                    <Border x:Name="PART_Border"
                            Grid.Row="0"
                            Grid.Column="1"
                            Padding="{TemplateBinding Padding}"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">

                        <ContentPresenter x:Name="PART_Header"
                                          Margin="0,2"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          ContentSource="Header" />

                    </Border>

                    <ItemsPresenter x:Name="ItemsHost"
                                    Grid.Row="1"
                                    Grid.Column="1" />
                </Grid>

                <ControlTemplate.Triggers>
                    <Trigger Property="IsExpanded" Value="false">
                        <Setter TargetName="ItemsHost" Property="Visibility" Value="Collapsed" />
                    </Trigger>

                    <Trigger Property="HasItems" Value="false">
                        <Setter TargetName="Expander" Property="Visibility" Value="Hidden" />
                    </Trigger>

                    <!--  Use the same colors for a selected item, whether the TreeView is focussed or not  -->
                    <Trigger Property="IsSelected" Value="true">
                        <Setter TargetName="PART_Border" Property="Background" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}" />
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.HighlightTextBrushKey}}" />
                    </Trigger>

                    <Trigger Property="IsEnabled" Value="false">
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>

<Style TargetType="{x:Type TreeView}">
    <Setter Property="ItemContainerStyle" Value="{StaticResource perTreeViewItemContainerStyle}" />
</Style> 
```

我在最近的[一篇博文](http://peregrinesview.uk/wpf-behaviors-part-2-treeview/)中对此进行了更详细的介绍。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-10-29T23:06:28.347

[@splintor 的出色答案](https://stackoverflow.com/a/9206992/1807542)的更新，使用了一些现代 C# 功能，并且没有任何反思。

```
public class Node
{
    public Node Parent { get; set; }
}

public class NodeTreeSelectionBehavior : Behavior<TreeView>
{
    public Node SelectedItem
    {
        get { return (Node)GetValue(SelectedItemProperty); }
        set { SetValue(SelectedItemProperty, value); }
    }

    public static readonly DependencyProperty SelectedItemProperty =
        DependencyProperty.Register(
            "SelectedItem",
            typeof(Node),
            typeof(NodeTreeSelectionBehavior),
            new FrameworkPropertyMetadata(null, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault, OnSelectedItemChanged));

    private static void OnSelectedItemChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (!(e.NewValue is Node newNode)) return;

        var treeView = ((NodeTreeSelectionBehavior)d).AssociatedObject;

        var ancestors = new List<Node> { newNode };
        var parent = newNode;
        while ((parent = parent.Parent) != null)
        {
            ancestors.Insert(0, parent);
        }

        var currentParent = treeView as ItemsControl;
        foreach (var node in ancestors)
        {
            // first try the easy way
            var newParent = currentParent.ItemContainerGenerator.ContainerFromItem(node) as TreeViewItem;
            if (newParent == null)
            {
                // if this failed, it's probably because of virtualization, and we will have to do it the hard way.
                // see also the question at http://stackoverflow.com/q/183636/46635
                var itemsPresenter = (ItemsPresenter)currentParent.Template.FindName("ItemsHost", currentParent);
                var virtualizingPanel = (VirtualizingPanel)VisualTreeHelper.GetChild(itemsPresenter, 0);
                var index = currentParent.Items.IndexOf(node);
                if (index < 0)
                {
                    throw new InvalidOperationException("Node '" + node + "' cannot be fount in container");
                }
                virtualizingPanel.BringIndexIntoViewPublic(index);
                newParent = currentParent.ItemContainerGenerator.ContainerFromIndex(index) as TreeViewItem;
            }

            if (newParent == null)
            {
                throw new InvalidOperationException("Tree view item cannot be found or created for node '" + node + "'");
            }

            if (node == newNode)
            {
                newParent.IsSelected = true;
                newParent.BringIntoView();
                break;
            }

            newParent.IsExpanded = true;
            currentParent = newParent;
        }
    }

    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.SelectedItemChanged += OnTreeViewSelectedItemChanged;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.SelectedItemChanged -= OnTreeViewSelectedItemChanged;
    }

    private void OnTreeViewSelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)
    {
        SelectedItem = e.NewValue as Node;
    }
} 
```

以同样的方式使用：

```
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:local="clr-namespace:MyProject">
    <Grid>
        <TreeView ItemsSource="{Binding MyItems}"
                  ScrollViewer.CanContentScroll="True"
                  VirtualizingStackPanel.IsVirtualizing="True"
                  VirtualizingStackPanel.VirtualizationMode="Recycling">
            <i:Interaction.Behaviors>
                <local:NodeTreeSelectionBehavior SelectedItem="{Binding MySelectedItem}" />
            </i:Interaction.Behaviors>
        </TreeView>
    <Grid>
<UserControl> 
```

# jquery - 让我的 ajax 更新的 div 淡入

> ID：183638
> 
> 赞同：28
> 
> 时间：2008-10-08T16:25:42.437
> 
> 标签：jquery, ajax

我有这段代码执行 ajax 调用，每次更改下拉列表时将结果加载到两个重复的 div 中。我希望将结果淡化到 div 中，以更明显地表明某些情况发生了变化，因为它是如此无缝以至于有时很难注意到变化！

```
print("$('.ajaxdropdown').change(function(){

        $.ajax({
            type: "GET",
            url: "/includes/html/gsm-tariff.php",
            data: "c_name="+escape($(this).val()),
            success: function(html){
                $("#charges-gsm").html(html);
                                    //i want to fade result into these 2 divs...
                $("#charges-gsm-faq").html(html);
                $("#charges-gsm-prices").html(html);
            }
        });
    });"); 
```

我试过附加淡入淡出方法和其他一些东西，但没有任何乐趣。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-08T16:27:10.283

您必须先`hide()`使用它，然后才能使用`fadeIn()`.

**更新：**这是您通过链接执行此操作的方法：

```
$("#charges-gsm-faq").hide().html(html).fadeIn();
$("#charges-gsm-prices").hide().html(html).fadeIn(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T16:50:27.583

您也可以让它可见并使其透明，然后将其淡化为完全不透明，使用：

```
... .css({ opacity: 0 }).fadeTo("normal",1); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-18T10:01:46.103

你必须先 hide() 才能使用 fadeIn()

以上为我工作

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-27T02:09:01.580

它适用于负载（）：

```
$('.element').load('file.html').hide().fadeIn(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-10T22:11:11.797

JQuery.ui 有很多你可以用效果做的不同的事情。你可以在这里找到它们：http: [//docs.jquery.com/Effects](http://docs.jquery.com/Effects)

# oracle - Oracle user_contraints 表的 constraint_type 列中的字母代码代表什么？

> ID：183642
> 
> 赞同：71
> 
> 时间：2008-10-08T16:26:35.103
> 
> 标签：oracle, constraints, oracleinternals

```
select distinct constraint_type from user_constraints;

C
-
C
P
R
U 
```

似乎 P 表示主键，R 表示外键，对吗？U和C是什么？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2010-08-24T00:29:04.313

来自[12cR1 文档](https://docs.oracle.com/database/121/REFRN/GUID-9C96DA92-CFE0-4A3F-9061-C5ED17B43EFE.htm)：

```
C - Check constraint on a table  
P - Primary key  
U - Unique key  
R - Referential integrity  
V - With check option, on a view  
O - With read only, on a view  
H - Hash expression  
F - Constraint that involves a REF column  
S - Supplemental logging 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-10-08T16:31:28.120

```
Code Description                Acts On Level
---------------------------------------------
C    Check on a table           Column
O    Read Only on a view        Object
P    Primary Key                Object
R    Referential (Foreign Key)  Column
U    Unique Key                 Column
V    Check Option on a view     Object 
```

# security - 如何以数字方式“签署”文档

> ID：183656
> 
> 赞同：11
> 
> 时间：2008-10-08T16:30:12.227
> 
> 标签：security, cryptography

我不喜欢纸质文件。我喜欢存储在服务器上的所有内容。如果可能，我想避免打印、签名和扫描。

**我如何从人们那里获得签名以在表格上签字并仍然保持数字化？**

签署的目的是证明某些部门已经确定了文件。这些人中的大多数都是非技术人员。

理想的情况是每个人都打开文档并输入他们的姓名并关闭文档。问题是我怎么知道弗雷德没有签下拉尔夫。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T01:41:38.617

有法律法规定义什么是数字签名（电子签名，或“电子签名”）。在美国，有一项称为“统一电子交易法”（UETA）的法案，描述了如何在法律环境中定义和使用数字签名。

基本上，可能涉及以下组件：

1.  一种电子文档，在应用签名时代表具有法律义务的表格。
2.  附加在上述文件上的数字信号（图片、声音等），用作签名，即法律上接受的批准文件的证明。（最直接的例子是将一个人的手写签名的透明图片应用到 PDF 文档上。）
3.  用于“篡改密封”文档的数字证书密钥对（经过批准的证书颁发机构的验证）。使用私钥对文档进行“签名”，法律机构可以使用公钥来验证文档的完整性。
4.  一个“保险库”系统，用于存储篡改密封的文件以供日后进行法律查询。

有人可能会争辩说，并非所有步骤都是必要的。但是，在某些行业中，第 3 步和第 4 步是法律规定所要求的，因为它们被指定用于防止伪造或欺骗。因此，步骤 3 很可能由 / 与公证人一起执行，有时与步骤 2 一起执行。

对于第 2 步和第 3 步，可在 Internet 上找到 API 和示例。Adobe PDF 的 API 可以处理这两个步骤，一些开源组件可以处理单独的步骤。使用开源组件 iTextSharp 的一个示例是 CodeProject：[使用 iTextSharp 对 PDF 文档进行电子签名](http://www.codeproject.com/KB/files/Esignature.aspx)。有关一般电子签名的更多信息，请查看维基百科页面[电子签名](http://en.wikipedia.org/wiki/Esignature)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T16:32:46.403

*Schneier 的应用密码学*中讨论了无数种方法。

您正在寻找的大部分内容都归结为数字签名算法 (DSA) - NIST 有一个，非对称加密算法可以提供，等等。

简单的方法是收集交货并阅读电子邮件收据，但这并不是万无一失的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T16:51:33.307

每个可能签署数字文档的人都需要分配给他们的公钥/私钥对，该密钥对是不可伪造的。

那么你必须找到一种方法来保证每个人的私钥的安全——那个人怎么能使用它，而没有其他人呢？目前在这个领域有很多创造性的工作正在进行。其中一些要求每个人携带必须用于签署每个文件的硬件密钥（卡、拇指驱动器等）。有时，私钥存储在数据库中，签名者必须提供密码才能对文档进行签名。

通过创建文档的散列然后使用私钥加密散列来将密钥对应用于文档。加密的哈希是“数字签名”并附加到文档中。由于除了签名者之外没有人可以使用私钥（假设），您知道签名是真实的。

您可以通过使用公钥解密哈希来验证签名，该公钥可供所有人使用。如果解密后的哈希值不匹配，那么要么是文档在签名后被修改，要么是由其他人签名的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T13:08:42.693

既然您已经澄清了您的需求，我认为最好的解决方案是：

1.  做一个网站
2.  使用密码为人们提供唯一的登录信息
3.  允许他们查看文档
4.  有一张表格，让他们勾选“我同意某某”的框

您可能还希望包含“组”的概念，以便您可以将某些文档公开给“Acme Co. Shipping Dept.”。并允许该组的任何成员签署这些文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-29T18:43:45.620

我同意，我也是一个非技术人员，但是使用电子签名签署文件并不需要成为“技术人员”。我从 Adob​​e 的授权数字签名提供商之一下载了一个软件并阅读了手册，简而言之，它说……具有法律约束力的数字签名必须具有具有法律约束力的证书 ID。IBM 站点、Misrosoft 和 Adob​​e（以及其他服务提供商网站）上提到了官方提供商。我使用了在 Adob​​e 网站上找到的一个，因为我需要对[PDF 文档进行数字签名](http://www.arx.com/information-center/PDF-signature)。一句话，使用微软供应商（不过，我相信我使用的供应商也支持 MS 软件）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T16:33:34.433

有两种方法可以回答这个问题：

*   我可以使用哪些技术手段来获取数字签名？
*   我可以使用哪种获取数字签名的方法来阻止（在此处插入内部审核流程）？

如果它们只是为了您自己的记录，那么第二个问题并不重要。否则，您组织的审计部门将有发言权。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T16:36:38.267

在这种情况下，术语“签名”的使用有点松散。这并不意味着有人使用手写签名他们的名字——这意味着让一个人留下某种数字数据来证明他们批准了该文件。

Adobe Acrobat 具有进行数字签名的能力。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T16:41:24.480

您是否可以控制与您互动的人，以便让他们创建 GPG 密钥并使用它们签署文档？如果是这样，问题就解决了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T16:43:26.787

您需要问的问题是“物理签名的用途是什么？” “数字签名”的用途与物理签名不同。物理签名几乎失去了扫描文档的所有价值。

您可能想要的只是一种让人们说“是的，我可以接受”的方式。在这种情况下，您只需要一个他们可以登录并选中复选框的网站。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-08T16:53:41.757

我们一直在研究的一件事是使用笔记本电脑上的小触摸板来获取客户签名。当您考虑它时，它与您用来签署 UPS 交付的小东西并没有太大不同。到目前为止，我们已经发现了一些浮动的 API。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T17:25:13.160

有用于将数字安全组件添加到手写签名的软件。签名是使用某种触摸板设备捕获的，并存储在文档中。然后该软件对包括签名图形在内的整个文档进行数字签名，以证明该文档在应用签名后没有更改。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-11-06T21:22:34.963

一直在寻找一个系统，我刚刚在 killstartups 上找到了 doshaker.com。它几乎可以让您按照您刚刚描述的 Neall 进行操作。

# database - 用于连接多行中所有字段值的 Firebird 存储过程

> ID：183675
> 
> 赞同：5
> 
> 时间：2008-10-08T16:32:47.120
> 
> 标签：database, stored-procedures, firebird

我的目标是编写一个存储过程，它可以将多行中的所有字段值收集到一个输出变量中（可能是 varchar(some_length)）。这可能看起来很奇怪，但我非常肯定它是我在这种情况下唯一可以使用的解决方案。我以前没有使用过 Firebird，并且存储的过程看起来与其他知名数据库系统不同。我的 Firebird 是 1.5 和方言 3（不确定是什么意思）。所以也许有人可以帮助我提供一个算法示例。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T18:24:38.907

以下过程按照您的描述进行：

```
SET TERM !!;
CREATE PROCEDURE concat_names
  RETURNS (concat VARCHAR(2000))
AS
DECLARE VARIABLE name VARCHAR(100);
BEGIN
  concat = '';
  FOR SELECT first_name || ' ' || last_name FROM employee INTO :name
  DO BEGIN
    concat = concat || name || ', ';
  END
END!!
SET TERM ;!!
EXECUTE PROCEDURE concat_names; 
```

但我质疑这种解决方案的智慧。你怎么知道 VARCHAR 对你想要的数据集中的所有行来说足够长？

运行查询以将结果逐行返回到应用程序要容易得多且安全得多。每种应用程序编程语言都有连接字符串的方法，但更重要的是它们有更灵活的方法来管理数据的增长。

顺便说一下，Firebird 和 InterBase 中的“方言”是指引入的一种兼容模式，以便为 InterBase 5.x 开发的应用程序可以与更高版本的 InterBase 和 Firebird 一起使用。那是差不多十年前的事了，AFAIK 今天不需要使用低于方言 3 的任何东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T04:18:24.840

连接时必须测试空值，这是两个字段和它们之间的分隔符的示例：

```
 CREATE PROCEDURE CONCAT(
    F1 VARCHAR(385),
    F2 VARCHAR(385),
    SEPARATOR VARCHAR(10))
RETURNS (
    RESULT VARCHAR(780))
AS
begin

  if ((:f1 is not null) and (:f1 <> '')) then
    result = :f1;

  if ((:f2 is not null) and (:f2 <> '')) then
    if ((result is not null) and (result <> '')) then
      begin
        if ((:separator is not null) and (separator <> '')) then
          result = result||separator||f2;
        else
          result = result||f2;
      end
    else
      result = f2;

  suspend;
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-31T02:28:13.723

使用 Firebird 存储过程返回多行非常简单。

不要使用：

```
execute procedure proc_name(value); 
```

而是使用：

```
select * from proc_name(value); 
```

# c# - C#集合集合？

> ID：183685
> 
> 赞同：535
> 
> 时间：2008-10-08T16:33:59.270
> 
> 标签：c#, .net, collections, set

有谁知道`Set`在 C# 中是否有与 Java 的集合相当的好东西？我知道您可以通过填充但忽略值来模拟使用 a`Dictionary`或 a的集合`HashTable`，但这不是一种非常优雅的方式。

* * *

## 回答 #1

> 赞同：426
> 
> 时间：2008-10-08T16:36:17.033

如果您使用的是 .NET 3.5，则可以使用[`HashSet<T>`](http://msdn.microsoft.com/en-us/library/bb359438.aspx). 确实，.NET 并不像 Java 那样适合集合。

[Wintellect PowerCollections](http://powercollections.codeplex.com)也可能有所帮助。

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2008-10-08T16:35:05.400

尝试[HashSet](http://msdn.microsoft.com/en-us/library/bb359438.aspx)：

> HashSet(Of T) 类提供高性能的集合操作。集合是不包含重复元素的集合，其元素没有特定的顺序......
> 
> HashSet(Of T) 对象的容量是该对象可以容纳的元素数。HashSet(Of T) 对象的容量会随着元素添加到对象中而自动增加。
> 
> [HashSet(Of T) 类基于数学集合模型，提供类似于访问Dictionary(Of TKey, TValue)](https://msdn.microsoft.com/en-us/library/xfhwa508.aspx)或[Hashtable](https://msdn.microsoft.com/en-us/library/system.collections.hashtable.aspx)集合的键的高性能集合操作。简单来说，HashSet(Of T) 类可以被认为是一个没有值的[Dictionary(Of TKey, TValue)](https://msdn.microsoft.com/en-us/library/xfhwa508.aspx)集合。
> 
> HashSet(Of T) 集合未排序且不能包含重复元素...

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2013-08-31T18:01:54.140

**如果您使用的是 .NET 4.0 或更高版本：**

如果您需要排序，请使用[`SortedSet<T>`](http://msdn.microsoft.com/en-us/library/dd412070.aspx). 否则，如果您不这样做，则使用它，[`HashSet<T>`](http://msdn.microsoft.com/en-us/library/bb359438.aspx)因为它`O(1)`用于搜索和操作操作。而`SortedSet<T>`用于`O(log n)`搜索和操作操作。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-10-08T16:36:34.897

我使用 Iesi.Collections [http://www.codeproject.com/KB/recipes/sets.aspx](http://www.codeproject.com/KB/recipes/sets.aspx)

它在很多 OSS 项目中使用过，我第一次遇到它是在 NHibernate

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-11-26T01:08:28.093

我在 a 周围使用了一个包装器`Dictionary<T, object>`，将空值存储在值中。这给了 O(1) 对键的添加、查找和删除，并且所有意图和目的都像一个集合一样。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-08T16:38:54.220

在 CodePlex 上查看[PowerCollections 。](http://www.codeplex.com/PowerCollections)除了 Set 和 OrderedSet，它还有一些其他有用的集合类型，例如 Deque、MultiDictionary、Bag、OrderedBag、OrderedDictionary 和 OrderedMultiDictionary。

如需更多收藏，还有[C5 Generic Collection Library](http://www.itu.dk/research/c5/)。

* * *

## 回答 #7

> 赞同：-6
> 
> 时间：2012-02-04T22:50:55.647

我知道这是一个旧线程，但我遇到了同样的问题，发现 HashSet 非常不可靠，因为给定相同的种子，GetHashCode() 返回不同的代码。所以，我想，为什么不直接使用 List 并像这样隐藏 add 方法

```
public class UniqueList<T> : List<T>
{
    public new void Add(T obj)
    {
        if(!Contains(obj))
        {
            base.Add(obj);
        }
    }
} 
```

由于 List 仅使用 Equals 方法来确定相等性，因此您可以在 T 类型上定义 Equals 方法以确保获得所需的结果。

# sql-server - 如何获得对 SQL Server 2005 数据库的独占访问权限以进行还原？

> ID：183686
> 
> 赞同：20
> 
> 时间：2008-10-08T16:34:02.140
> 
> 标签：sql-server, tsql

每当我在 SQL Server 中恢复数据库的备份时，都会出现以下错误：

```
Msg 3101, Level 16, State 1, Line 1
Exclusive access could not be obtained because the database is in use.
Msg 3013, Level 16, State 1, Line 1
RESTORE DATABASE is terminating abnormally. 
```

通常为了解决这个问题，我只需重新启动服务器。当我们在开发机器上的本地实例上进行开发时，这很好。但是我们有一些程序员需要访问数据库，而让每个人编写他们的更改并将它们放入[Subversion](http://en.wikipedia.org/wiki/Apache_Subversion)的后勤工作正在成为一场噩梦。不管怎样，我们简单的解决方案是把它放在办公室的共享服务器上，偶尔备份一下服务器，以防有人搞砸了数据。

好吧，我搞砸了数据，需要恢复。不幸的是，我办公室里有另一位同事正在从事另一个项目，并且正在使用相同的数据库服务器进行开发。为了更好，我想在不重新启动 SQL Server 并可能中断他的工作的情况下进行恢复。

有没有办法在 T-SQL 中编写脚本以获取独占访问或删除所有连接？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-08T16:49:50.830

您可以强制数据库脱机并断开连接：

```
EXEC sp_dboption N'yourDatabase', N'offline', N'true' 
```

或者你可以

```
ALTER DATABASE [yourDatabase] SET OFFLINE WITH
ROLLBACK AFTER 60 SECONDS 
```

回滚指定是否正在执行任何操作。在那之后，它们将被回滚。所以它提供了一些保护。

对不起，我没有思考/阅读正确。您可以重新联机并备份。在 Stack Overflow 上还有一篇关于[T-SQL](http://en.wikipedia.org/wiki/Transact-SQL)片段的帖子，用于删除所有连接而不是首先离线：*[SQL Server 的隐藏功能](https://stackoverflow.com/questions/121243/hidden-features-of-sql-server#121927)*

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-19T06:42:40.550

我发现这比离线要快得多，而且通常更好。请阅读[MSDN](http://msdn.microsoft.com/en-us/library/bb522682.aspx)中的相关内容，以便了解注意事项。如果使用 aysnc 统计信息，您也必须将其关闭。

```
-- set single user, terminate connections
ALTER DATABASE [target] SET SINGLE_USER WITH ROLLBACK IMMEDIATE
RESTORE ...
ALTER DATABASE [target] SET MULTI_USER 
```

“立即回滚”是必不可少的“终止”子句。离开它会永远等待。上面的一个更好的版本给用户交易几秒钟的时间来终止。

```
ALTER DATABASE [target] SET SINGLE_USER WITH ROLLBACK AFTER 5 
```

如果您想复制数据库文件，离线是一个好主意，这种情况在 SQL 的桌面版本中很方便。对于这种情况来说太重了。如果离线，这将是首选。[SQL 正在远离 sp_dboption](http://msdn.microsoft.com/en-us/library/ms187310.aspx)。

```
ALTER DATABASE [target] SET OFFLINE WITH ROLLBACK AFTER 5 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-08T17:39:42.163

@mattlant - 这就是我想要的。我把它带到这里，所以它在线程中。

```
Use Master
Go

Declare @dbname sysname

Set @dbname = 'name of database you want to drop connections from'

Declare @spid int
Select @spid = min(spid) from master.dbo.sysprocesses
where dbid = db_id(@dbname)
While @spid Is Not Null
Begin
        Execute ('Kill ' + @spid)
        Select @spid = min(spid) from master.dbo.sysprocesses
        where dbid = db_id(@dbname) and spid > @spid
End 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T16:47:03.003

到目前为止，这对我有用。我右键单击数据库>任务>分离...

这带来了一个屏幕，允许您查看所有活动的连接。然后，您可以通过并断开每个连接。当您点击确定时，您已经分离了数据库并需要附加数据库。右键单击数据库并选择附加，选择您的 mdf 文件并附加数据库。此时，您应该拥有恢复的独占访问权限。

**注意：**我通过从我的本地计算机连接到他的一个数据库来测试这一点，并且从服务器断开了与我的数据库的连接，并且我没有失去与他的数据库的连接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T16:44:35.613

我建议与您的同事交谈，并要求他离开数据库。（并让他意识到这个问题，因为当你恢复时他可能会丢失他所做的更改。）

这比断开他的连接或设置可能给他带来一些不便的独占访问要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T16:47:25.077

[好吧，您可以使用KILL 终止](http://msdn.microsoft.com/en-us/library/ms173730.aspx)SQL 进程和会话。

但是如果你把他当前的所有连接都删除，他不会重新打开它们吗？

您可能只需要告诉他您将从备份中恢复，因此他会停止连接一段时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T17:17:09.073

首先，除非您是当前唯一连接的人并且您具有管理员权限，否则您无法恢复数据库。您必须首先告诉您的同事您需要恢复，并要求他或她确保将备份媒体上可能没有的任何更改编写成脚本。这只是礼貌，可以防止同事杀了你。

接下来将数据库设置为单用户模式。您可以在联机丛书中查找如何执行此操作。这可以防止其他人在您执行此操作时进行连接，并让您有机会终止现有连接。进入单用户模式很重要，因为在您恢复时，其他任何人都不应该对数据库做任何事情。

然后运行还原过程。

# sql - Select Poorly Used Start and End Dates From Facility Table

> ID：183698
> 
> 赞同：2
> 
> 时间：2008-10-08T16:36:20.077
> 
> 标签：sql, db2, logic

I'm using DB2, although a solution using any flavor of SQL would likely be easy enough for me to convert.

I didn't design this database, or the application that uses the database. I haven't the power to change this application, how it works, or the data. Because it defies what I consider to be conventional use of a start and an end date, I am struggling with writing something as simple as a select for a specific point in time.

Here are the relevant/edited parts of the table:

```
OBJECTID    FACILITY_ID     START_DATE      END_DATE    FACILITY_NAME
1001        500             1/1/1980        5/1/2000    Really Old Name
1002        500             1/1/1980        1/1/2006    Old Name
1003        500             1/1/1980        null        Current Name
1004        501             1/1/1980        3/1/2008    Closed Facility Name
1004        502             1/1/1980        null        Another Current Name 
```

What I want to return, are the records which are valid for 7/1/2005:

```
OBJECTID    FACILITY_ID     START_DATE      END_DATE    FACILITY_NAME
1002        500             1/1/1980        1/1/2006    Old Name
1004        501             1/1/1980        3/1/2008    Closed Facility Name
1004        502             1/1/1980        null        Another Current Name 
```

I'm trying to avoid subselects, but understand they may be necessary. If I do need a subselect, I'd like to keep it limited to one. Looking between the start and end date doesn't work, because it doesn't return facilities which have only one record with a null end date. Adding an OR condition to include end dates which are null may return more than one record in some cases. This problem seems so simple on the service, that I must be missing a ridiculously obvious solution. Does anyone have any ideas?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T16:40:10.490

would this work:

```
SELECT * FROM table_name
WHERE START_DATE < '7/1/2005' AND (END_DATE > '7/1/2005' OR END_DATE IS NULL); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T16:40:57.133

诀窍是将结束日期合并到第二天，:) Coalesce 基本上用第二个参数替换空值。很酷的小技巧。

```
select * from TAble where START_DATE < @DATE and Coalesce(END_DATE, @DATE+1) > @DATE 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:51:41.717

取2：

```
select OBJECTID, FACILITY_ID, START_DATE, FACILITY_NAME, MIN(END_DATE) as  END_DATE
from facitities
where START_DATE <= @my_date and (@mydate <= END_DATE or END_DATE is null)
group by OBJECTID, FACILITY_ID, START_DATE, FACILITY_NAME 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T18:49:22.913

很抱歉回答我自己的问题。谢谢大家，给出的答案非常有帮助。准确地思考我想要完成的工作也很有帮助。结合给出的答案中的概念，我能够想出一些似乎可行的方法：

```
SELECT 
    * 
FROM 
    FACILITY_TABLE
WHERE 
    (END_DATE IS NULL
     AND OBJECTID NOT IN 
     (SELECT A.OBJECTID FROM FACILITY_TABLE A 
     WHERE '7/1/2005' BETWEEN A.BEGINDATE AND A.ENDDATE))
  OR 
    '7/1/2005' BETWEEN FACILITY_TABLE.START_DATE AND FACILITY_TABLE.ENDDATE 
```

由于数据使开始日期变得毫无意义，我没有包括它。如果记录从现在到那时过期，则仅返回 2005 年 7 月 1 日有效的记录，而不包括当前记录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T16:43:58.953

从你给我们的来看，这就是你想要的：

```
select * from facitities
where START_DATE <= @my_date and (@mydate <= END_DATE or END_DATE is null) 
```

但是，我怀疑您知道这一点，并且想要一些不同的东西，在这种情况下，您必须更具体地了解数据的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-24T15:41:13.647

以上略有不同：

```
select * from facilities
where @my_date between START_DATE AND COALESCE(END_DATE, CURRENT DATE) 
```

# javascript - 从 javascript 对象访问父级的父级

> ID：183702
> 
> 赞同：57
> 
> 时间：2008-10-08T16:36:52.087
> 
> 标签：javascript, oop

就像是

```
var life= {
        users : {
             guys : function(){ this.SOMETHING.mameAndDestroy(this.girls); },
             girls : function(){ this.SOMETHING.kiss(this.boys); },
        },
        mameAndDestroy : function(group){ },
        kiss : function(group){ }
}; 
```

this.SOMETHING 是我想象的格式，但可能不是。什么会退回到对象的父级？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-10-05T08:16:11.417

我只是在第一个函数中添加

```
parentThis = this; 
```

并在子功能中使用 parentThis。为什么？因为在 JavaScript 中，对象是软的。可以通过简单的赋值将新成员添加到软对象（不像 ie。Java 中的经典对象是硬对象。将新成员添加到硬对象的唯一方法是创建一个新类）更多信息在这里：[http ://www.crockford.com/javascript/inheritance.html](http://www.crockford.com/javascript/inheritance.html)

而且最后你不必杀死或摧毁物体。为什么我在这里找到：http: [//bytes.com/topic/javascript/answers/152552-javascript-destroy-object](http://bytes.com/topic/javascript/answers/152552-javascript-destroy-object)

希望这可以帮助

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2008-10-08T19:47:52.390

JavaScript 本身不提供此功能。我怀疑你甚至可以创建这种类型的功能。例如：

```
var Bobby = {name: "Bobby"};
var Dad = {name: "Dad", children: [ Bobby ]};
var Mom = {name: "Mom", children: [ Bobby ]}; 
```

鲍比属于谁？

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-08T16:45:30.167

在这种情况下，您可以使用`life`来引用父对象。或者您可以`life`在用户对象中存储对的引用。语言中没有固定值`parent`可供您使用，因为 users 只是对对象的引用，可能还有其他引用......

```
var death = { residents : life.users };
life.users.smallFurryCreaturesFromAlphaCentauri = { exist : function() {} };
// death.residents.smallFurryCreaturesFromAlphaCentauri now exists
//  - because life.users references the same object as death.residents! 
```

您可能会发现使用以下内容很有帮助：

```
function addChild(ob, childName, childOb)
{
   ob[childName] = childOb;
   childOb.parent = ob;
}

var life= {
        mameAndDestroy : function(group){ },
        kiss : function(group){ }
};

addChild(life, 'users', {
   guys : function(){ this.parent.mameAndDestroy(this.girls); },
   girls : function(){ this.parent.kiss(this.boys); },
   });

// life.users.parent now exists and points to life 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-02-05T03:18:25.263

### 关于通话：

您可以使用以下方法解决此问题[`.call()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call)：

*   必须在函数上调用`addName.call()`
*   你将它传递给你想要成为“this”的对象`addName.call({"name" : 'angela'});`
*   您可以传递可以在调用它的函数中使用的其他参数，`addName.call({"name": "angela"}, true);`其中可能`addName`接受 boolean 的参数`append`。

### 使用调用：

对于这个特定的问题，我们可以通过“父”对象`call`来覆盖`this`子对象中通常存在的对象。

### 先看我们的问题

```
var app = {
    init: function() {
        var _this = this; // so we can access the app object in other functions

        $('#thingy').click(function(){
            alert(_this.options.thingy());
        });

        $('#another').click(function(){
            alert(_this.options.getAnother());
        });
    },
    options: {
      thingy: function() {
      // PROBLEM: the this here refers to options
        return this.getThingy();
      },
      getAnother: function() {
        // PROBLEM 2: we want the this here to refer to options,
        // but thingy will need the parent object
        return 'another ' + this.thingy();
      },
    },
    getThingy: function() {
        return 'thingy';
    }
}; 
```

### 现在，这是一个解决方案使用调用

和[JSFIDDLE](https://jsfiddle.net/hL65m2ed/)看看它的工作原理。

```
var app = {
    init: function() {
        var _this = this; // so we can access the app object in other functions

        $('#thingy').click(function(){
            // SOLUTION: use call to pass _this as the 'this' used by thingy
            alert(_this.options.thingy.call(_this));
        });

        $('#another').click(function(){
            // SOLUTION 2: Use call to pass parent all the way through
            alert(_this.options.getAnother.call(_this)); 
        });
    },
    options: {
      thingy: function() {
        // SOLUTION in action, the this is the app object, not options.
        return this.getThingy(); 
      },
      getAnother: function() {
        // SOLUTION 2 in action, we can still access the options 
        // AND pass through the app object to the thingy method.
        return 'another ' + this.options.thingy.call(this); 
      },
    },
    getThingy: function() {
        return 'thingy';
    }
}; 
```

### 综上所述

`.call()`每当您在主对象的属性上使用方法时，您都可以使用：`app.options.someFunction(arg)`应该始终使用 - 调用`.call`-`app.options.someFunction.call(this, arg);`这样您就可以确保您始终可以访问对象的每个部分。它可以让您访问另一个属性的方法，例如`app.helpers.anotherFunction()`.

一个好主意是在`somefunction`, 中存储`this`一个变量`_parentThis`，所以很明显`this`反映了什么。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-08T16:43:57.190

如果我正确阅读了您的问题，那么对象通常不知道它们包含在哪里。他们不知道他们的父母是谁。要找到该信息，您必须解析父数据结构。当您谈论文档中的元素对象时，DOM 有办法为我们做到这一点，但看起来您谈论的是普通对象。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-22T22:30:09.130

干得好：

```
var life={
        users:{
             guys:function(){ life.mameAndDestroy(life.users.girls); },
             girls:function(){ life.kiss(life.users.guys); }
        },
        mameAndDestroy : function(group){ 
          alert("mameAndDestroy");
          group();
        },
        kiss : function(group){
          alert("kiss");
          //could call group() here, but would result in infinite loop
        }
};

life.users.guys();
life.users.girls(); 
```

另外，请确保“女孩”定义后没有逗号。这将导致脚本在 IE 中崩溃（只要在 IE 中的数组中的最后一项后面有逗号，它就会死掉）。

[看它运行](http://jsbin.com/icoga/edit)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-01-30T05:52:35.200

正如其他人所说，不可能直接从嵌套的孩子中查找父母。所有提议的解决方案都建议通过显式变量名称引用回父对象或父范围的各种不同方式。

[但是，如果您在父对象上使用递归ES6 代理](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy)，则可以直接遍历父对象。

我编写了一个名为[ObservableSlim](https://github.com/ElliotNB/observable-slim)的库，除其他外，它允许您从子对象向上遍历到父对象。

这是一个简单的示例（[jsFiddle 演示](https://jsfiddle.net/hp0h5g8v/)）：

```
var test = {"hello":{"foo":{"bar":"world"}}};
var proxy = ObservableSlim.create(test, true, function() { return false });

function traverseUp(childObj) {
    console.log(JSON.stringify(childObj.__getParent())); // returns test.hello: {"foo":{"bar":"world"}}
    console.log(childObj.__getParent(2)); // attempts to traverse up two levels, returns undefined because test.hello does not have a parent object
};

traverseUp(proxy.hello.foo); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-07-03T17:02:39.157

我使用了类似于单例模式的东西：

```
function myclass() = {
    var instance = this;

    this.Days = function() {
        var days = ["Piątek", "Sobota", "Niedziela"];
        return days;
    }

    this.EventTime = function(day, hours, minutes) {
        this.Day = instance.Days()[day];
        this.Hours = hours;
        this.minutes = minutes;
        this.TotalMinutes = day*24*60 + 60*hours + minutes;
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-26T15:40:11.893

我做过这样的事情，它就像一个魅力。

简单的。

PS 还有更多对象，但我只是发布了相关部分。

```
var exScript = (function (undefined) {
    function exScript() {
        this.logInfo = [];
        var that = this;
        this.logInfo.push = function(e) {
            that.logInfo[that.logInfo.length] = e;
            console.log(e);
        };
    }
})(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-17T17:57:17.887

使用以下代码，您可以访问对象的父对象：

```
var Users = function(parent) {
    this.parent = parent;
};
Users.prototype.guys = function(){ 
    this.parent.nameAndDestroy(['test-name-and-destroy']);
};
Users.prototype.girls = function(){ 
    this.parent.kiss(['test-kiss']);
};

var list = {
    users : function() {
        return new Users(this);
    },
    nameAndDestroy : function(group){ console.log(group); },
    kiss : function(group){ console.log(group); }
};

list.users().guys(); // should output ["test-name-and-destroy"]
list.users().girls(); // should output ["test-kiss"] 
```

我建议您阅读有关 javascript [Objects](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)的内容以了解如何使用 Objects，它对我帮助很大。我什至发现了我什至不知道它们存在的功能。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-12-19T16:52:43.937

如果您想在文字对象 ( `{}`) 中获取节点的所有父键，您可以这样做：

```
(function ($) {
    "use strict";

    $.defineProperties($, {
        parentKeys: {
            value: function (object) {
                var
                    traces = [],
                    queue = [{trace: [], node: object}],

                    block = function () {
                        var
                            node,
                            nodeKeys,
                            trace;

                        // clean the queue
                        queue = [];
                        return function (map) {
                            node = map.node;
                            nodeKeys = Object.keys(node);

                            nodeKeys.forEach(function (nodeKey) {
                                if (typeof node[nodeKey] == "object") {
                                    trace = map.trace.concat(nodeKey);
                                    // put on queue
                                    queue.push({trace: trace, node: node[nodeKey]});

                                    // traces.unshift(trace);
                                    traces.push(trace);
                                }
                            });
                        };
                    };

                while(true) {
                    if (queue.length) {
                        queue.forEach(block());
                    } else {
                        break;
                    }
                }

                return traces;
            },

            writable: true
        }

    });

})(Object); 
```

该算法使用`FIFO`该方法迭代图的概念`BFS`。此代码扩展了类，添加了期望 Javacript 的（哈希表 - 关联数组...）作为参数`Object`的静态方法。`parentKeys``literal Object`

我希望我有所帮助。

# c# - 在 C# 中处理视频源的资源

> ID：183739
> 
> 赞同：4
> 
> 时间：2008-10-08T16:46:43.347
> 
> 标签：c#, .net-3.5, video, video-capture, motion-detection

我开始进入一个副项目，我希望从几个小型 IP 摄像机中提取帧，也许做一些运动检测并以带有警报的形式重新显示它们。

有没有人有一些好的资源或类似的项目可以用来熟悉来龙去脉？我在 VS2008 中使用带有 SP1 的 C# 3.5

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T18:33:11.853

[在这里](http://www.codeproject.com/KB/audio-video/Motion_Detection.aspx)你可以找到一篇关于如何在图像之间进行运动检测的文章。它基于[AForge.NET](http://code.google.com/p/aforge/)库，引用他们的网站：

> AForge.NET 是一个 C# 框架，专为计算机视觉和人工智能领域的开发人员和研究人员设计 - 图像处理、神经网络、遗传算法、机器学习等。

# sql - 您如何处理关系数据库中的 m..n 关系？

> ID：183742
> 
> 赞同：17
> 
> 时间：2008-10-08T16:47:01.537
> 
> 标签：sql, database, database-design

让我们看一个例子——书籍。一本书可以有 1..n 个作者。一个作者可以有 1..m 的书。代表一本书的所有作者的好方法是什么？

我想出了一个想法来创建一个 Books 表和一个 Authors 表。Authors 表有一个主 AuthorID 键，即作者的姓名。Books 表有一个主 Book ID 和关于该书的元数据（标题、出版日期等）。但是，需要有一种方法将书籍与作者联系起来，将作者与书籍联系起来。这就是问题所在。

假设我们有鲍勃的三本书。然而，在一本书上，他以 Bob, PhD 的身份写了它。另一个他写成鲍勃博士，第三个他写成罗伯特博士。我希望能够确定这些作者实际上是同一个人但以不同的名字命名的事实。我还想将鲍勃与另一位写不同书籍的鲍勃区分开来。

现在让我们在应用程序中添加另一部分，一个跟踪感兴趣的人的 Person 表。假设 Bob 是一个有趣的人。我不仅想说这三本书的作者是 Bob，而且这个有趣的 Bob 和作者 Bob 是同一个 Bob。

那么对于这种潜在的复杂映射存在哪些策略，同时确保通过封面上的姓名识别书籍作者？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-08T16:48:35.933

添加另一个名为 BookAuthors 的表，其中包含 BookID、AuthorID 和 NameUsed 列。NameUsed 的 NULL 值意味着从作者的表中提取它。这称为交集表。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T16:54:06.110

你需要三张桌子——

1.  书
2.  作者
3.  图书作者

图书将包含图书 ID、图书标题以及您需要收集的有关图书的所有其他信息。

作者将包含作者 ID 以及其他信息，例如您需要收集的关于任何给定作者的名字、姓氏。

BookAuthors 将是一个多对多连接，包含 BookID、AuthorID 和 NameUsed。这将允许该书有零个或多个作者，一个作者可以有零个或多个书，并且可以捕获有关该关系的信息。例如，您还可以在 BookAuthor 表上有一列描述作者与该书的关系（“编辑者”、“前言者”）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-08T16:49:22.187

我认为你几乎在那里。您需要一个 Books 表、一个 Authors 表，然后是一个“authors_of_books”表，其中包含该书的主键、作者的主键和一个“被引为”文本字段，显示该特定作者在该书中是如何被引用的.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-08T16:49:44.793

这听起来像是多对多的关系，而不是一对多的关系。我认为您会希望在这两者之间使用一个表，该表允许您在其任一侧定义一对多。看一下这个...

[http://www.tekstenuitleg.net/en/articles/database_design_tutorial/8](http://www.tekstenuitleg.net/en/articles/database_design_tutorial/8)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T16:50:56.803

鉴于 Bob 博士和 Robert 博士和 Bob, PhD 都是同一个人，他们将链接到作者表中的同一行。

但是，我认为您需要的是作者链接到的人员表。您还可以将您的有趣人物表链接到它。这样，作者 Bob 和作者 Robert 以及 Interesting Bob 链接到 Person Bob。希望这是有道理的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T16:51:08.363

首先想到的是有一个链接表，可能称为 AuthorOf 将书籍与其作者联系起来。

这些列可能是 AuthorID、BookID 和 CreditAs，因此您可以区分 Bob 博士和 Bob, PhD。（以及斯蒂芬金和理查德巴赫曼等笔名）。

而且您仍然可以唯一地识别作者。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T16:51:16.427

看起来您确实想要创建一系列自定义连接表，用于将项目从一个实体关联到另一个实体。

我会从最细粒度的人开始，然后说任何作者都必须是人。我会简化这个过程。

创建一个包含人员信息和 PersonId 的人员表，将信息放入其中。

然后创建一个 BookAuthors 表，其中包含 3 列 BookId、PersonId、TitledName。这样，如果需要，您可以使用不同的名称，如果不需要，如果 TitledName 为空，您可以使用 COALESE 或类似的东西来获取默认名称。

只是一个想法..

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T16:55:25.670

您真正要问的不是您如何处理 1..n 关系，而是 n..n 关系（对于作者有效并且有很多书，一本书可以有很多作者）。

处理这个问题的经典方法是通过中间表，所以

Author 表（authorID，authorDetails） Book 表（bookID，book details） AuthorBook 表（authorID，bookID）

如果您真的很担心更改作者姓名，请使用 1..n 作者详细信息表，因此添加

AuthorDetails (authorID, itemID, authorDetails)

并从作者表中删除 authorDetails

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T16:49:37.927

对于 1..n 关系（作者有很多书，作者有很多别名）：

1.  在 Books 中放一个外键 author_id 指向作者。
2.  创建一个新表 author_aliases 来保存别名信息。
3.  将外键 alias_id 放在指向别名的 Books 中（如果作者详细信息为默认值，则可以为空）。
4.  将 author_id 外键放入 author_aliases。

如果您愿意，您可以使用中间表来链接作者和书籍，但是对于 1..n 映射，我认为这没有必要。

对于 n..m 关系（作者有很多书，书有很多作者）：

您必须使用中间连接表（author_id、alias_id、book_id）而不是 book 表中的外键。您将希望将外键从别名保留到作者（以便轻松查找作者别名，而无需浏览他们的所有书籍）。

您可以争辩说，就未来的可扩展性而言，这也是一种更好的开始方式，即使最初的规范说某些东西是 1..n 关系。您会发现给定的规范（或问题）通常是不充分的，因此您将希望以通用方式进行设计，以应对规范发生变化或澄清时。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-23T09:13:41.060

postgresql 中的一个可能实现，只是为了好玩：

```
create table books (
  book_id integer primary key,
  title varchar not null
);

create table aliases (
  alias_id integer primary key,
  alias varchar not null
);

create table books_aliases (
  book_id integer references books (book_id),
  alias_id integer references aliases (alias_id),
  primary key (book_id, alias_id)
);

create table authors (
  author_id integer primary key,
  author varchar not null,
  interesting boolean default false
);

create table aliases_authors (
  alias_id integer references aliases (alias_id),
  author_id integer references authors (author_id),
  primary key (alias_id, author_id)
);

create view books_aliases_authors as
  select * from books 
    natural join books_aliases
    natural join aliases
    natural join aliases_authors
    natural join authors; 
```

可以使用“使用”而不是自然连接：

```
create view books_aliases_authors as
  select *
    from books 
    join books_aliases using (book_id) 
    join aliases using (alias_id) 
    join aliases_authors using (alias_id) 
    join authors using (author_id); 
```

或者为 mysql 兼容性做复杂的事情（注意 mysql 还需要上面的 varchars 的显式最大长度）：

```
create view books_aliases_authors as
  select b.book_id, title, l.alias_id, alias, t.author_id, author, interesting
    from books b
    join books_aliases bl on bl.book_id = b.book_id
    join aliases l on bl.alias_id = l.alias_id
    join aliases_authors lt on lt.alias_id = l.alias_id
    join authors t on t.author_id = lt.author_id; 
```

this example doesn't use the "people" table, only an "interesting" flag to authors. please note that *nothing* changes (structurally), if you rename "authors" to "people"

# filesystems - 持久性：存储为目录树的数据树

> ID：183745
> 
> 赞同：2
> 
> 时间：2008-10-08T16:47:49.103
> 
> 标签：filesystems, persistence, tree-structure

*我想知道将内存树结构存储为目录树以实现持久性的实用性。在我的情况下，他的目标文件系统将是 ZFS，一旦创建了结构，它将不经常被多个进程访问。*

### 使用目录树作为数据树的持久性机制的性能如何？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T17:00:09.263

为了读取和写入您的树，您将在每个节点多次调用文件系统。这比你可以设计的任何健全的代码来遍历记忆图像要昂贵得多。

这是否是一种明智的方法取决于您预期的使用模式。如果在典型的代码调用中，您希望读取整个树结构，则对其进行处理，然后将其完整地写出来——最好将其编组到一个文件中。但是，如果您希望只读取/处理/改变几个节点，*而不*读取大部分树，那么遍历目录结构和执行多次查找/读取以遍历存储在单个文件中的树之间的性能差异会小得多，为了简单/清晰/避免重新发明轮子，这样做很值得做前者。此外，如果多个进程同时执行此操作，则使用基于目录的方法锁定节点和子树会变得更加容易。

请注意，对于一些常用的文件系统，打开目录条目的时间取决于目录中的条目总数。

编辑：我用 ext3 为网站的 CG​​I 后端做了类似的事情；不重新发明轮子使原型设计更快，维护更简单，读/写/锁定扩展得很好，*但是*对目录结构本身的非常频繁的更改（每秒数百次）在实际存储中效果不佳；最后，我重组了一些东西，以便经常添加/删除目录条目的目录树部分最终在 tmpfs 卷上结束 - 对我来说，这组状态可以（昂贵地）从存储在较少易失性存储中的状态中重建重启后。我对 ZFS 的经验很少，不知道您的预期使用模式，所以不知道这对您来说是否有问题。如果我现在为一个使用非常频繁的站点执行此操作，我可能会使用我自己的命名锁库来代替。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T17:04:08.057

大多数文件系统都针对访问打开的文件进行了优化，因此打开/关闭文件需要很长时间。如果树的每一片叶子都很小，那么读取/写入整个结构将花费比必要时间长很多倍的时间。

此外，大多数文件系统都有一个最小的分配块，通常在 2-8KB 左右。如果你的叶子比这小得多，你会浪费很多空间。

简而言之，你的叶子越小，这个想法就越糟糕。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:52:04.820

如果我理解正确，您正在谈论构建一个树结构，该结构将提供文件系统的代码内表示，所以我怀疑您会在开始读取树结构时产生开销，但随后的查找并且树的遍历可能比每次访问磁盘存储都要快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T17:07:08.097

可能的问题：

*   它可能对磁盘空间的使用效率低下（在许多文件系统中，目录是一个文件，因此占用了磁盘上的整个块......）
*   读/写会很慢，因为您进行了许多文件系统访问
*   文件系统可能/将对每个项目名称的长度和/或可用于名称的字符施加限制
*   其他进程很容易损坏您的数据和/或需要相当大的锁定成本
*   当使用固态“磁盘”时，这可能会导致比其他方法更多的写入并缩短媒体的寿命

底线：这可能不值得。

# file - 平面文件修复工具

> ID：183761
> 
> 赞同：3
> 
> 时间：2008-10-08T16:51:35.583
> 
> 标签：file

场景：尝试导入许多 (>100)、大 (>1M recs) 平面文件 (csv)。

问题：许多记录缺少字段分隔符。

问：是否有一个解析工具会尝试定义和验证文件并允许您进行“在线”更正？

**ETA：**我正在尝试使用 DTS 导入向导将此文件导入 MS SQL Server。错误消息给了我它中断的文件的行号。使固定; 重复。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T17:00:53.037

去过也做过。写了我自己的工具。

令人惊讶的是，有多少据称输出 CSV 的程序实际上并没有正确执行。

一个商业工具会很好，但考虑到我在 CSV 文件中遇到的各种问题（缺少分隔符、错误的分隔符值、在字段中间嵌入 CR/LF 等），我自己编写是值得的。这样，当我发现一个新问题时，我只需扩展我现有的程序来处理它。

鉴于我的倾向，我可能应该将我的昵称改为 NIH。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T16:54:15.190

我可能会在 Python（或 Perl 或 Awk）中敲出一些东西。
如果缺少分隔符，您如何知道字段在哪里？

编辑 - 我可能会阅读所有行，忽略现有的分隔符，将它们拆分为已知内容并再次写出。您只需执行一次，这将比出错并修复特定行更快、更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T17:25:45.000

如果平面文件来自同一来源，我同意编写自己的工具是最好的选择之一——文件之间的问题应该是一致的。

OTOH，如果您持续需要从不同的提供商导入数据，那么获取导入工具可能会更有效率。

自从我完成 ETL 工作以来已经快十年了，所以我无法提出任何具体的建议。

顺便说一句，是否可以重新生成平面文件？更好的解决方案是首先不要有损坏的数据，而不是事后清理它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-21T15:23:43.133

您可以尝试使用[平面文件检查器](http://www.flat-file.net)来解决这个问题。它允许您轻松拒绝格式错误的文件并识别文件有问题的行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-07T12:28:12.533

当您尝试访问数据并显示记录丢失时会弹出此类消息。Stellar File Repair 可以让您摆脱这种损坏，您可以在其中找到所有种类的软件。

# .net - 构建器、工厂方法和抽象工厂模式之间有什么区别？

> ID：183773
> 
> 赞同：12
> 
> 时间：2008-10-08T16:54:08.497
> 
> 标签：.net, design-patterns

程序接收消息列表（基本类型）。列表中的每条消息都必须根据其类型（后代类型）进行处理。但是，不同的消息需要不同的输入才能正确处理。

下面的技术叫什么？（我没有在编译器中检查过这段代码）

```
abstract class MessageProcessor
{
    public static MessageProcessor GetProcessor(Message message, DataDomain data)
    {
        if (message.GetType() == typeof(FooMessage))
        {
            return new FooMessageProcessor(message, data.Name, data.Classification);

        }
        else if (message.GetType() == typeof(BarMessage))
        {
            return new BarMessageProcessor(message, data.AccountNo, data.CreditLimit);

        }
        else
            throw new SomeException("Unrecognized type");

    }

    public abstract void Process();     
} 
```

和这个？

```
static class MessageProcessorFactory
{
    public static MessageProcessor GetProcessor(Message message, DataDomain data)
    {
        if (message.GetType() == typeof(FooMessage))
        {
            return new FooMessageProcessor(message, data.Name, data.Classification);

        }
        else if (message.GetType() == typeof(BarMessage))
        {
            return new BarMessageProcessor(message, data.AccountNo, data.CreditLimit);

        }
        else
            throw new SomeException("Unrecognized type");
    }
} 
```

如果我可以将 ProcessBuilder 类注入到 MessageProcessor（使用属性或 Setter）然后调用 Process，那么它叫什么？

什么技术是解决这个问题的最佳模式？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-08T17:11:54.903

它们都是*工厂方法*模式的例子。唯一的区别是第二个示例在其自己的静态类中具有该方法。

这将是*抽象工厂*模式的一个示例：

```
abstract class MessageProcessorFactory
 { public abstract MessageProcessor GetProcessor
                                     (Message message, DataDomain data);
 }

class FooMessageProcessorFactory :  MessageProcessorFactory
 { public override MessageProcessor GetProcessor
                                     (Message message, DataDomain data)
    { return new FooMessageProcessor(data.Name, data.Classification);
    }
 } 
```

每个 MessageProcessor 都有自己的使用多态性的工厂类。

传递 ProcessBuilder 来创建流程将是*策略*模式：

```
class MessageProcessor
 { ProcessBuilder builder;

   public MessageProcessor(ProcessBuilder builder)
    { this.builder = builder;
    }

   public void Process()
    { builder.BuildMessage();
      builder.BuildProcess();
      builder.Process();
    }
 }

var mp = new MessageProcessor(new FooProcessBuilder()); 
```

最简单的解决方案是封装工厂方法：

```
static void Process(Message msg, DataDomain data)
 { var p = getProcessor(msg.GetType());
   p.Process(msg, data);
 } 
```

如果它是少数已知类型，则可以使用一系列类型检查：

```
private static MessageProcessor getProcessor(Type msgType)
 { return   (msgType == typeof(FooMessage)) ? new FooMessageProcessor()
          : (msgType == typeof(BarMessage)) ? new BarMessageProcessor()
          :                                   new DefaultMessageProcessor();
 } 
```

否则使用字典：

```
Dictionary<Type,MessageProcessor> processors;    

private static MessageProcessor getProcessor(Type msgType) 
 { return processors[msgType];
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T21:07:56.910

在我的理解中，*工厂方法*定义了要使用的类的抽象类型，但将具体类型的创建委托给后续/实现类。 *抽象工厂*将为一组相应类的制造商定义一个接口。构建*器*的工作只是逐步构建一个对象，为调用实例提供一些控制。

# asp.net - 有多少活跃的 ASP.NET 开发人员？

> ID：183778
> 
> 赞同：0
> 
> 时间：2008-10-08T16:56:07.573
> 
> 标签：asp.net

我正在寻找有关有多少 ASP.NET 开发人员正在积极使用 ASP.NET 的指标。

如果您有指向可靠指标的链接，我将有兴趣查看它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T17:04:21.237

[http://news.netcraft.com/](http://news.netcraft.com/)

他们对网站使用的服务器类型有很好的衡量标准。你可以从那里说 Windows*可能*正在运行 asp.net 站点，但即使那样你也会猜测。

# java - 在项目中组织 JUnit 测试

> ID：183780
> 
> 赞同：38
> 
> 时间：2008-10-08T16:56:53.763
> 
> 标签：java, junit

您认为在项目中组织 JUnit 测试的最佳实践是什么，为什么？例如，您是否将测试放在他们测试的课程旁边？您是否将它们放在一个单独但并行的包结构中？您是否完全使用不同的组织策略？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-08T17:03:41.067

我使用单独但并行的包结构有几个原因。

1.  它使测试以与应用程序代码相同的方式组织。
2.  我可以轻松地仅构建应用程序文件以进行分发。
3.  测试代码仍然可以访问我的应用程序代码。
4.  它不像将测试代码与应用程序代码混合那样混乱。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T17:01:04.957

我将我的测试放在一个单独但相似/并行的包结构中。这就是 Maven 喜欢的方式，它也适用于 IDE。我喜欢这种方式，因为我没有将我的测试代码与我的应用程序代码混在一起，但我仍然可以访问包私有的东西以进行模拟和状态验证。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-08T18:09:07.673

只需使用[Maven](http://maven.apache.org)。使用 maven，您可以为项目创建默认结构：

```
mvn archetype:create -DgroupId=com.yoyodyne -DartifactId=UberApp 
```

这将创建[Maven 的标准目录布局](http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html)，其中包含单元测试和主项目的空间。使用 maven，您可以在不将其打包到 jar 的情况下运行单元测试，并且您可以构建一个仅包含您的应用程序的 jar。对于运行、测试和编译时间，您还可以有不同的类路径和不同的依赖项。

看到这里很少有人真正使用 Maven（或者至少是 Ant，尽管我更喜欢 Maven 来处理依赖项），我觉得最令人不安。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-23T14:53:20.047

我尊重 Maven 项目结构，即使我不在项目中使用 maven，只是因为我习惯了它。最佳做法是使用单独的源文件夹，它遵循与主源文件夹相同的包结构。

您的测试特定源（您编写的仅用于测试的实用程序）应该放在那里，如果您打算将它们与应用程序运行时代码一起使用，则将其移动到主源文件夹中。这个想法是很好地解耦，就像你通过分离持久性和控制来分解效率一样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T17:24:55.877

正如蜥蜴比尔所说，

它有助于拥有一个并行结构，以便 1）我可以发布 src.zip 或 src.tar.gz 并省略单元测试 2）在版本控制系统级别，您可以挂钩谁更改源代码以及谁仅更改单元测试

“缺点”
如果源测试和单元测试都在同一个包中，则无法密封 JAR 文件（意思是，在准备 .JAR 并密封之前，您需要删除单元测试）

# javascript - 在用户向下滚动时加载内容

> ID：183782
> 
> 赞同：4
> 
> 时间：2008-10-08T16:59:24.540
> 
> 标签：javascript, html, ajax, scroll

我正在构建一个博客类型的页面，我想在用户向下滚动时将项目加载到页面中，就像 Google Reader 或 Soup.io 一样。您将如何实现这种效果？我已经看到了一些读取页面高度的示例，甚至在窗口上附加了一个 onScroll ，这样当用户向下滚动时，我们可以测试他们是否向下滚动到足以保证加载更多项目的程度。Soup.io 的实现似乎在您向下滚动时删除了旧项目，这样浏览器就不会处理越来越大的 DOM 树。哪些 javascript 库最适合这项任务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T17:10:15.080

Unspace 有一篇文章演示了此功能：[Endless Pageless: No More Next Page](https://web.archive.org/web/20071009004156/http://unspace.ca/discover/pageless/)。他们的演示页面在[这里](https://web.archive.org/web/20071009004258/http://unspace.ca/livefilter)（已死，供参考）。

此特定示例使用 RoR 和[Prototype。](http://www.prototypejs.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-12T10:03:54.107

你这个 jquery 例子[http://webdeveloperplus.com/jquery/create-a-dynamic-scrolling-content-box-using-ajax/](http://webdeveloperplus.com/jquery/create-a-dynamic-scrolling-content-box-using-ajax/)

# php - 通过 PHP 登录到文件或登录到 MySQL 数据库 - 哪个更快？

> ID：183783
> 
> 赞同：11
> 
> 时间：2008-10-08T16:59:44.257
> 
> 标签：php, mysql

我有一个数据库驱动的网站，提供大约 50,000 个页面。

我想跟踪每个网页/记录点击。我将通过创建日志来做到这一点，然后每天对日志进行一次批处理。我不关心如何进行批处理，只关心最快的记录方式。

您将如何记录，您认为哪个更快：

a) 使用 PHP 追加到文本日志文件的末尾。

b) 使用 MySQL INSERT INTO 非索引日志表。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-08T17:25:09.760

1.  写入文件。旋转日志。

2.  按计划将文件批量加载到数据库中。

选择这种架构有很多很多的原因——易于扩展（写入许多日志，将它们加载到数据库），不依赖数据库中的 SPOF（如果出现问题，您只需积累一段时间的日志） ，在加载时进行清理和非平凡解析的能力，而不会增加生产服务器的负担，等等。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T17:20:04.513

[您可以使用log4php](http://logging.apache.org/log4php/)尝试两种方式，它支持：

*   通过 xml 和属性文件进行配置（与 log4j 的结构相同）。
*   File、RollingFile、DailyFile、Echo、Console、Mail、PEAR::Db、PHP 错误、Syslog 或 NT 事件和 Socket 附加程序。
*   简单、TTCC、模式、Html 和 Xml 布局。
*   嵌套 (NDC) 和映射 (MDC) 诊断上下文。
*   可切换的内部调试。

关于登录文件，您可以通过缓冲写入请求来提高性能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-08T17:12:50.127

我会在 MySQL 中使用延迟插入。这样您就不必等待插入完成。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-08T17:10:09.900

使用数据库——这是唯一明智的选择。即使它需要更长的时间。一旦你从日志文件开始，那么你就处于一个会给你带来痛苦的轨道上——例如移动服务器、文件权限、排除负载平衡等......

如果您打开了数据库，那么我认为插入单行可能会更快。

然而，与所有这些性能相关的唯一方法是编写一个简单的测试并测量它......

更新：我已经做了一个快速测试——如果你必须打开和关闭文件，使用 10,000 行测试它的速度大致相同或更慢：

但是，当您开始让多个进程执行此操作时，它会变慢，如下所示。这是有 10 个并发进程（所有时间以秒为单位）

```
DB time: 2.1695
DB time: 2.3869
DB time: 2.4305
DB time: 2.5864
DB time: 2.7465
DB time: 3.0182
DB time: 3.1451
DB time: 3.3298
DB time: 3.4483
DB time: 3.7812
File open time: 0.1538
File open time: 0.5478
File open time: 0.7252
File open time: 3.0453
File open time: 4.2661
File open time: 4.4247
File open time: 4.5484
File open time: 4.6319
File open time: 4.6501
File open time: 4.6646
Open close file time: 11.3647
Open close file time: 12.2849
Open close file time: 18.4093
Open close file time: 18.4202
Open close file time: 21.2621
Open close file time: 22.7267
Open close file time: 23.4597
Open close file time: 25.6293
Open close file time: 26.1119
Open close file time: 29.1471

function debug($d)
{
    static $start_time = NULL;
    static $start_code_line = 0;

    if( $start_time === NULL )
    {
        $start_time = time() + microtime();
        $start_code_line = $code_line;
        return 0;
    }

    printf("$d time: %.4f\n", (time() + microtime() - $start_time));
    $fp = @fopen('dbg.txt','a');
    fprintf($fp,"$d time: %.4f\n", (time() + microtime() - $start_time));
    fclose($fp);

    $start_time = time() + microtime();
    $start_code_line = $code_line;
}

function tfile()
{
    $fp = @fopen('t1.txt','a');
    for ($i=0;$i<10000;$i++)
    {
        $txt = $i."How would you log, which do you think is quicker:How would you log, which do you think is quicker:";
        fwrite($fp,$txt);
    }
    fclose($fp);
}
function tfile_openclose()
{
    for ($i=0;$i<10000;$i++)
    {
        $fp = @fopen('t1.txt','a');
        $txt = $i."How would you log, which do you think is quicker:How would you log, which do you think is quicker:";
        fwrite($fp,$txt);
        fclose($fp);
    }
}

function tdb()
{
    $db = mysql_connect('localhost','tremweb','zzxxcc');

    $select_db = mysql_select_db('scratch');

    if (!$select_db) 
        die('Error selecting database.');

    for ($i=0;$i<10000;$i++)
    {
        $txt = $i."How would you log, which do you think is quicker:How would you log, which do you think is quicker:";
        mysql_query("INSERT INTO tlog values('".$txt."')");
    }
}

debug("");

tfile();
debug("File open");

tfile_openclose();
debug("Open close file");

tdb();
debug("DB"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-08T17:08:16.143

我相信平面文件的写入速度会更快。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-08T19:24:52.093

你应该试试[SQLite](http://www.sqlite.org/)。它将为您提供写入文件的速度以及数据库的功能。

*   [php.net: sqlite2 扩展](http://www.php.net/manual/en/book.sqlite.php)
*   [php.net: sqlite3 类](http://www.php.net/manual/en/book.sqlite3.php)
*   [pdo 提供了一个 SQLite 驱动程序](http://www.php.net/manual/en/book.pdo.php)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-08T19:32:27.677

几年前，我在 C++ 用户杂志上阅读了一篇关于登录性能的文章。无论您使用数据库还是文件，最好的办法是在您需要查看日志时（并且更有可能）将未格式化的数据写入有意义的数据中。日志记录的绝大部分成本是格式化写入目标的字符串，并且大部分时间都浪费了 - 日志永远不会被读取。

如果对您有用，我可以挖掘文章参考。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T18:05:34.483

我做过类似的事情。我将每条记录记录到一个单独的文件中，然后我有一个批处理过程来抓取文件，将它们放入一个 tar 文件并将它们上传到中央日志服务器（在我的例子中，S3 :)）。

我为每个日志条目生成随机文件名。我这样做是为了避免锁定文件以进行轮换。以这种方式存档/删除真的很容易。

我使用 json 作为我的日志格式，而不是典型的以空格分隔的日志文件。这使得将来更容易解析和添加字段。这也意味着我更容易为每个文件编写一个条目，而不是为每个文件附加多个记录。

我还使用 log4php+syslog-ng 来实时集中日志记录。我有 log4php 日志到 syslog，然后将日志转发到我的中央服务器。这在较大的集群上非常有用。需要注意的是，系统日志消息有长度限制，因此您可能会冒着截断较长消息的风险。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-08T17:10:55.937

我建议您使用一些测试用例来测试两者。

我会假设一个平面文件会更快，b / c这就是数据库正在做的事情 - 它只是将它写入文件。我能想到的唯一优势是如果数据库可以同时运行，你可能会得到更好的结果。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-08T19:35:43.193

如果您使用基于文件的日志记录或基于数据库的日志记录，您最大的性能损失将是文件/表锁定。基本上，如果客户端 A 和客户端 B 在相对较短的时间范围内连接，客户端 B 会卡住等待释放命中文件/表上的锁，然后再继续。

基于文件的机制的问题在于，文件锁定对于确保您的点击不会被破坏至关重要。解决这个问题的唯一方法是实现一个队列来延迟写入文件。

使用数据库日志记录，您至少可以执行以下操作 [使用 MyISAM 的 MySQL]：

```
INSERT DELAYED INTO `hits` ... 
```

见[12.2.5.2。插入延迟语法](http://dev.mysql.com/doc/refman/5.1/en/insert-delayed.html)以获取更多信息。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T17:09:42.320

进入文件会更快，但进入数据库会更好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-08T17:15:26.877

一切都取决于您的基础架构和限制。如果磁盘很慢，写入也会很慢。如果 SQL 服务器被请求滞后，插入会很慢。平面文件可能是最好的方法，但我会编写您的代码或使用现有代码 (PEAR::Log)，以便您可以随意更改提供程序和存储方法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-08T17:37:10.093

几点考虑：

1.  您认为您希望将日志数据与数据库中的其他数据连接起来吗？如果是这样，数据库插入的开销可能是合理的，因此可以轻松利用现有关系。
2.  将数据记录在数据库中是否可以让您大大减少要记录的数据量（由于数据库中的现有关系）？例如，用户活动数据库中的日志可能只是一个包含用户 ID、活动 ID 和时间戳的表。文件中如此精简的日志文件将不适合人类阅读。根据您的需要，您需要在日志文件中至少捕获一些用户数据，以确保它本身是有用的和人类可读的。
3.  您是否有机会在前端或通过管理工具利用这些日志数据？如果是这样，数据库写入可能更可取。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T17:44:30.923

正如其他人所提到的 - 这取决于很多事情，例如流量、磁盘速度等。您必须测试这两种情况。

在测试 MySQL 时，同时尝试 MyISAM 和 INNODB。理论上，Innodb 的性能会更好，因为它具有行级锁定。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-08T18:21:35.810

如果这是针对数据库驱动的站点，为什么不直接使用 Apache 或 IIS 的内置日志记录功能，以及合适的报告工具，例如[AWSStats](http://awstats.sourceforge.net/)等等，总有[Google Analytics](http://www.google.com/analytics/)

AWStats 和网络服务器日志记录是我的偏好——无论如何你基本上都是免费获得的——即使你没有进行流量分析，你仍然可以考虑自己解析 Apache 访问日志文件以进行任何批处理。

# c++ - C / C++ 编译器警告：您是清理所有代码以删除它们还是保留它们？

> ID：183788
> 
> 赞同：66
> 
> 时间：2008-10-08T17:01:18.390
> 
> 标签：c++, c, compiler-construction, warnings

我参与过许多项目，在这些项目中，其他人给了我要更新的代码。我经常编译它并收到大约 1,000 多个编译器警告。当我看到编译器警告时，它们让我觉得很脏，所以我的首要任务是清理代码并将它们全部删除。通常我会发现十几个问题，比如未初始化的变量。

我不明白为什么人们将它们留在里面并且没有完全干净的编译而没有警告。我错过了什么吗？有什么正当理由让他们离开吗？有什么恐怖故事可以分享吗？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-10-08T17:05:04.263

我会清理任何警告。即使你知道是无害的（如果存在这样的事情）也会给编译代码的人留下不好的印象。

如果我不得不编写其他人的代码，这是我会寻找的“臭”标志之一。

如果不是真正的错误或潜在的未来问题，那将是马虎的迹象

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-10-08T17:09:09.933

清理它们，即使它们并不表示真正的问题。**否则，如果出现表明确实**存在问题的警告，您将无法通过所有噪音看到它。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-10-08T17:06:58.063

在我的工作中，将警告视为错误的编译器设置已打开。所以，没有警告，否则它不会编译:)

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-08T17:25:01.680

我同意最好消除所有警告。如果您收到数以千计的警告，您应该优先考虑您的修复。

开始将编译器设置为最低警告级别。这些警告应该是最重要的。当这些都是固定的，增加你的警告级别并重复，直到你达到最高警告级别。然后设置您的编译选项，以便将警告视为错误。

如果您发现您怀疑可以安全忽略的警告，请进行一些研究以验证您的理论。只有这样才能禁用它，并且只能以尽可能最小的方式禁用。大多数编译器都有`#pragma`指令，可以仅对文件的一部分禁用/启用警告。这是一个 Visual C++ 示例：

```
typedef struct _X * X; // from external header, not 64-bit portable

#pragma warning( push )
#pragma warning( disable: 4312 ) // 64-bit portability warning
X x = reinterpret_cast< X >( 0xDDDDDDDD ); // we know X not 64-bit portable
#pragma warning( pop ) 
```

请注意，这只会禁用单行代码的警告。使用此方法还允许您在将来对代码进行简单的文本搜索以进行更改。

或者，您通常可以为单个文件或所有文件禁用特定警告。恕我直言，这是危险的，应该只是最后的手段。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-08T17:41:01.723

**如果可能**的话，把它们清理干净。但是，在多平台/多编译器代码库上（我曾经研究过一个在 7 个不同操作系统上使用 6 个不同编译器编译的代码库），但这并不总是可能的。我见过编译器*出错*的情况（Itanium 上的 HP-UX aCC，我在看着你），但这确实很少见。正如其他人指出的那样，您可以在这种情况下禁用警告。

很多时候，这个版本的编译器中的警告可能会在下一个版本中变成错误（从 gcc 3.x 升级到 4.x 的任何人都应该熟悉它），所以现在清理它。

一些编译器会发出非常有用的警告，在某些情况下会成为问题——Visual C++ 2005 和 2008 可以警告您关于 64 位问题，这在当今是一个巨大的好处。如果您有任何迁移到 64 位的计划，只需清除这些警告就会大大减少您的移植时间。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-08T18:37:33.700

在某些情况下，我会在代码中留下警告，或者清理它们是不可行的（尽管我确实删除了我可以删除的警告）。例如：

*   如果您正在做某事，并且您知道它需要更多的工作/关注，请留下警告以表明这可能是适当的
*   如果您使用 /clr 编译 C++，则会出现一些关于导致生成本机代码的警告；当无法在功能上更改代码库时，抑制所有这些警告可能很麻烦
*   当您不了解修复程序的作用时清除警告。我已经用 PC-Lint 警告做了几次，最终引入了错误。如果您不知道更改的确切效果是什么（例如：C 样式强制转换以消除警告），请不要这样做。找出警告，或者不理会代码是我的建议。

无论如何，这些都是我想不到的，留下警告可能是合适的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-08T17:08:02.243

最糟糕的是，当您编写新代码时，很难知道您是否不小心引入了更多警告，因为有太多警告，您无论如何都忽略它们。

将它们全部清理干净的问题在于，您可能需要也可能不需要时间。但是，是的，通常你应该尽可能多地清理。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-08T19:18:57.440

因为没有时间修复它们而在代码中留下警告就像因为早上没有足够的时间而不刷牙一样。这是代码卫生的基本问题。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-08T17:07:18.283

始终清理您的警告。如果您有特定情况知道警告是可以的，则仅针对该实例禁止它。

虽然有些警告可能是良性的，但大多数都表明代码存在真正的问题。

如果您不清理所有警告，那么警告列表将继续增长，真正的问题案例将在警告噪音的海洋中消失。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-08T17:08:01.230

一个真正优秀的程序员的特征之一是糟糕的代码让他们反胃。

我努力让我的所有代码不仅编译器干净，而且在我的 IDE 内部也干净，设置为相当挑剔的水平。如果我比该工具更了解，有时我需要抑制警告实例，但至少它也可以用作文档。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-08T20:28:33.663

我总是启用所有警告，然后将我的项目设置为在有任何警告时停止构建。

如果有警告，那么你需要检查每一个，以确保没有问题。一遍又一遍地这样做是浪费时间。不这样做意味着将导致错误潜入您的代码。

有一些方法可以删除警告（例如#pragma argsused）。

让编译器完成工作。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-08T19:16:32.470

我曾使用过许多嵌入式系统，其中的警告会导致不稳定、崩溃或内存损坏。除非您知道警告是无害的，否则应该对其进行处理。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-08T17:16:36.533

警告是并且应该被视为错误。如果您的编码不够好，无法摆脱警告，那么您可能不应该编码。在我的小组中，我们决定将所有警告都强制为错误。它完全结束了这个讨论，真的，恕我直言，提高了代码质量。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T17:06:21.030

我不喜欢警告。我尽可能地删除它们。
有时，当面临完成工作的压力时，我会留下一些。不过我很少离开他们。我觉得你很脏，如果还有的话。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-08T17:07:46.770

我工作的代码库有超过 4000 个警告。其中一些是合法问题。我们从来没有时间去修复它们，也没有重构其他损坏的东西......部分原因是代码太旧了，它早于标准化的 C++。我们只能在 VC++ 6 中编译。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-08T17:18:07.263

如果需要，请始终清除所有警告或明确禁止它们。编译时警告的默认设置应该尽可能高（例如 VS 上的级别 4）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-08T23:02:03.230

我的老板创建了一些我现在维护的代码。他使用编译器标志来隐藏他的贬损警告。

当我有时间时，我会尽我所能清理并清理。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-11T16:28:00.377

我尝试编译具有相当高级别警告的代码并将它们全部清理掉，除了“有符号/无符号比较”警告，我确信我应该修复但永远不会被打扰。

简短版本：在 g++ 中，我使用“-Wextra -Wno-sign-compare”并删除所有消息。

# c# - 您将如何使用 LINQ 进行“不在”查询？

> ID：183791
> 
> 赞同：334
> 
> 时间：2008-10-08T17:01:40.930
> 
> 标签：c#, linq

我有两个集合`Email`在两个集合中都有属性。我需要获取`Email`第二个列表中不存在的第一个列表中的项目列表。对于 SQL，我只会使用“not in”，但我不知道 LINQ 中的等价物。这是怎么做的？

到目前为止，我有一个加入，比如......

```
var matches = from item1 in list1
join item2 in list2 on item1.Email equals item2.Email
select new { Email = list1.Email }; 
```

但是我不能加入，因为我需要差异并且加入会失败。我相信我需要某种使用包含或存在的方法。我只是还没有找到一个例子来做到这一点。

* * *

## 回答 #1

> 赞同：352
> 
> 时间：2008-10-08T17:06:51.763

您需要 except 运算符。

```
var answer = list1.Except(list2); 
```

这里有更好的解释：[https ://docs.microsoft.com/archive/blogs/charlie/linq-farm-more-on-set-operators](https://docs.microsoft.com/archive/blogs/charlie/linq-farm-more-on-set-operators)

**注意：**此技术仅适用于原始类型，因为您必须实现[IEqualityComparer](https://docs.microsoft.com/dotnet/api/system.collections.generic.iequalitycomparer-1)才能将该`Except`方法用于复杂类型。

* * *

## 回答 #2

> 赞同：328
> 
> 时间：2008-10-08T17:05:00.690

我不知道这是否会帮助你但是..

```
NorthwindDataContext dc = new NorthwindDataContext();    
dc.Log = Console.Out;

var query =    
    from c in dc.Customers    
    where !(from o in dc.Orders    
            select o.CustomerID)    
           .Contains(c.CustomerID)    
    select c;

foreach (var c in query) Console.WriteLine( c ); 
```

来自[Marco Russo](https://web.archive.org/web/20110805143247/http://introducinglinq.com/blogs/marcorusso/default.aspx)[的 LINQ to SQL 中的 NOT IN](https://web.archive.org/web/20120321161927/https://www.programminglinq.com/blogs/marcorusso/archive/2008/01/14/the-not-in-clause-in-linq-to-sql.aspx)子句

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2010-08-02T16:15:20.040

对于从一组内存对象开始并查询数据库的人，我发现这是最好的方法：

```
var itemIds = inMemoryList.Select(x => x.Id).ToArray();
var otherObjects = context.ItemList.Where(x => !itemIds.Contains(x.Id)); 
```

这会在 SQL 中生成一个不错的`WHERE ... IN (...)`子句。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2008-10-08T17:50:41.470

> 第二个列表中不存在电子邮件的第一个列表中的项目。

```
from item1 in List1
where !(list2.Any(item2 => item2.Email == item1.Email))
select item1; 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2014-12-16T05:25:59.607

您可以使用 Where 和 Any 的组合来查找 not in：

```
var NotInRecord =list1.Where(p => !list2.Any(p2 => p2.Email  == p.Email)); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-08-02T16:08:10.387

在使用[ADO.NET Entity Framework](http://en.wikipedia.org/wiki/ADO.NET_Entity_Framework)的情况下，EchoStorm 的解决方案也可以完美运行。但我花了几分钟才把头绕过去。假设您有一个数据库上下文 dc，并且想要在表 x 中查找未在表 y 中链接的行，完整的答案答案如下所示：

```
var linked =
  from x in dc.X
  from y in dc.Y
  where x.MyProperty == y.MyProperty
  select x;
var notLinked =
  dc.X.Except(linked); 
```

作为对 Andy 评论的回应，是的，一个 LINQ 查询中可以有两个 from。这是一个完整的工作示例，使用列表。每个类 Foo 和 Bar 都有一个 Id。Foo 通过 Foo.BarId 有一个对 Bar 的“外键”引用。程序选择所有未链接到相应 Bar 的 Foo。

```
class Program
{
    static void Main(string[] args)
    {
        // Creates some foos
        List<Foo> fooList = new List<Foo>();
        fooList.Add(new Foo { Id = 1, BarId = 11 });
        fooList.Add(new Foo { Id = 2, BarId = 12 });
        fooList.Add(new Foo { Id = 3, BarId = 13 });
        fooList.Add(new Foo { Id = 4, BarId = 14 });
        fooList.Add(new Foo { Id = 5, BarId = -1 });
        fooList.Add(new Foo { Id = 6, BarId = -1 });
        fooList.Add(new Foo { Id = 7, BarId = -1 });

        // Create some bars
        List<Bar> barList = new List<Bar>();
        barList.Add(new Bar { Id = 11 });
        barList.Add(new Bar { Id = 12 });
        barList.Add(new Bar { Id = 13 });
        barList.Add(new Bar { Id = 14 });
        barList.Add(new Bar { Id = 15 });
        barList.Add(new Bar { Id = 16 });
        barList.Add(new Bar { Id = 17 });

        var linked = from foo in fooList
                     from bar in barList
                     where foo.BarId == bar.Id
                     select foo;
        var notLinked = fooList.Except(linked);
        foreach (Foo item in notLinked)
        {
            Console.WriteLine(
                String.Format(
                "Foo.Id: {0} | Bar.Id: {1}",
                item.Id, item.BarId));
        }
        Console.WriteLine("Any key to continue...");
        Console.ReadKey();
    }
}

class Foo
{
    public int Id { get; set; }
    public int BarId { get; set; }
}

class Bar
{
    public int Id { get; set; }
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-08-30T11:08:56.830

您可以将这两个集合放在两个不同的列表中，例如 list1 和 list2。

然后就写

```
list1.RemoveAll(Item => list2.Contains(Item)); 
```

这将起作用。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-08-28T08:52:00.523

也可以使用`All()`

```
var notInList = list1.Where(p => list2.All(p2 => p2.Email != p.Email)); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-08T17:05:20.720

```
var secondEmails = (from item in list2
                    select new { Email = item.Email }
                   ).ToList();

var matches = from item in list1
              where !secondEmails.Contains(item.Email)
              select new {Email = item.Email}; 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-08T18:47:10.670

虽然`Except`是答案的一部分，但不是全部答案。默认情况下，`Except`（像几个 LINQ 运算符一样）对引用类型进行引用比较。要按对象中的值进行比较，您必须

*   在您的类型中实现`IEquatable<T>`，或
*   在你的类型中覆盖`Equals`和`GetHashCode`，或者
*   `IEqualityComparer<T>`传入为您的类型实现的类型的实例

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-08T17:08:13.537

为简单起见，使用 List 的示例。

```
List<int> list1 = new List<int>();
// fill data
List<int> list2 = new List<int>();
// fill data

var results = from i in list1
              where !list2.Contains(i)
              select i;

foreach (var result in results)
    Console.WriteLine(result.ToString()); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-12-12T12:13:43.120

对于还想`IN`在 C# 中使用类似 SQL 的运算符的任何人，请下载此包：

> Mshwf.NiceLinq

它有`In`和`NotIn`方法：

```
var result = list1.In(x => x.Email, list2.Select(z => z.Email)); 
```

即使你可以这样使用它

```
var result = list1.In(x => x.Email, "a@b.com", "b@c.com", "c@d.com"); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-09-24T12:08:24.313

或者，您可以这样做：

```
var result = list1.Where(p => list2.All(x => x.Id != p.Id)); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-09-17T12:40:25.437

我没有使用[LINQ to Entities](http://en.wikipedia.org/wiki/ADO.NET_Entity_Framework#LINQ_to_Entities)对此进行测试：

```
NorthwindDataContext dc = new NorthwindDataContext();    
dc.Log = Console.Out;

var query =    
    from c in dc.Customers 
    where !dc.Orders.Any(o => o.CustomerID == c.CustomerID)   
    select c; 
```

或者：

```
NorthwindDataContext dc = new NorthwindDataContext();    
dc.Log = Console.Out;

var query =    
    from c in dc.Customers 
    where dc.Orders.All(o => o.CustomerID != c.CustomerID)   
    select c;

foreach (var c in query) 
    Console.WriteLine( c ); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-23T11:33:09.980

如果组为空，您不能进行外部联接，仅从第一个列表中选择项目吗？就像是：

```
Dim result = (From a In list1
              Group Join b In list2 
                  On a.Value Equals b.Value 
                  Into grp = Group
              Where Not grp.Any
              Select a) 
```

我不确定这是否会以任何有效的方式与实体框架一起工作。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-07-22T15:25:53.197

```
 DynamicWebsiteEntities db = new DynamicWebsiteEntities();
    var data = (from dt_sub in db.Subjects_Details
                                //Sub Query - 1
                            let sub_s_g = (from sg in db.Subjects_In_Group
                                           where sg.GroupId == groupId
                                           select sg.SubjectId)
                            //Where Cause
                            where !sub_s_g.Contains(dt_sub.Id) && dt_sub.IsLanguage == false
                            //Order By Cause
                            orderby dt_sub.Subject_Name

                            select dt_sub)
                           .AsEnumerable();

                                SelectList multiSelect = new SelectList(data, "Id", "Subject_Name", selectedValue);

    //======================================OR===========================================

    var data = (from dt_sub in db.Subjects_Details

                            //Where Cause
                            where !(from sg in db.Subjects_In_Group
                                           where sg.GroupId == groupId
                                           select sg.SubjectId).Contains(dt_sub.Id) && dt_sub.IsLanguage == false

                            //Order By Cause
                            orderby dt_sub.Subject_Name

                            select dt_sub)

                           .AsEnumerable(); 
```

# java - 如何判断 URL 参数是否需要用 Java 编码

> ID：183830
> 
> 赞同：3
> 
> 时间：2008-10-08T17:10:16.030
> 
> 标签：java, url, encoding

我正在编写一个 Java 应用程序，它接受可能编码或未编码的 URL 参数值。我需要一种简单的方法来判断我是否需要对参数字符串进行编码。

换句话说，我想要一个函数`boolean needsEncoding(String param)`，如果我传入字符串“foo@test.com”，它将返回 true，如果传入“foo%40test.com”，它将返回 false。这个想法的问题在于这是模棱两可的。我怎么知道后一个字符串中的“%”符号是否应该被编码？处理此问题的一种方法是修改我的合同 - 要求客户端传入未编码的字符串，以便我知道我总是需要对它们进行编码。想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T17:10:47.853

我想我会把它作为一个建议的答案，以便人们可以投票：

处理此问题的一种方法是修改我的合同 - 要求客户端传入未编码的字符串，以便我知道我总是需要对它们进行编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:22:22.497

如何解码字符串并检查原始字符串和解码字符串之间的所有差异是否都是有效的 url 实体。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T20:15:46.547

您可以`java.net.URLDecoder`在输入上使用并通过比较输入和输出字符串值来查看它是否发生变化。查看[Javadocs](http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLDecoder.html)，`URLDecoder`它描述了它应用于输入字符串以确定它是否需要 URL 解码的业务逻辑。

如果你必须得到一个`boolean`结果并且不想产生试图解码来得到那个`boolean`结果的开销，你总是可以破解打开`URLDecoder`类的源代码并使用它使用的相同的业务逻辑来确定是否需要 URL 解码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T17:16:09.980

标志字符串已被 URL 编码：

1.  没有空格，但有很多加号。
2.  所有百分号后跟两位数字。
3.  其中没有 a..b、A..B、0..9、“.”、“_”、“-”、“*”、“%”和“+”之外的字符。

但是我认为更改合同是这里推荐的操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-08T18:29:37.637

这是我处理这个问题的正常方法。首先，由于 + 是一个烦人的特殊情况，我不允许它作为编码的一部分。如果他们输入一个加号，那就是一个加号，如果他们想要一个空间，他们可以按键盘底部的那个大条。（是的，我已将其作为某些合同的一部分）。但实际上，当您为客户努力工作时，您可以将其解释清楚，以至于他们不必担心自己对其进行编码。

然后我重写`java.net.URLDecoder.decode`以删除'+'案例。（实际上只是剪切和粘贴到我用于该项目的任何实用程序类中，然后删除约 4 行）。

然后对于我得到的所有东西，我只是通过解码器运行它，然后是编码器。如果已编码，这将对其进行解码和重新编码，如果未编码，则对其进行编码。几年前我从某人那里得到了这个提示，不记得应该给予谁适当的信任。

所以我最终得到：

```
String properlyencodedstring = 
java.net.URLEncoder.encode(LocalDecoder.localdecode(someformdatastring),"UTF-8"); 
```

这可能需要调整的唯一时间是在需要输入和处理具有大量 url 组的数据的情况下，我改变我的假设，使用`input type="url"`（对于旧浏览器使用某种 javascript polyfill），并预处理`.replaceAll("+", " ")`，因为在这种情况下不允许输入任何空格。（而且很可能，`java.net.URI`无论如何都要使用）

# cross-browser - 浏览器支持哪些图形文件格式？

> ID：183831
> 
> 赞同：51
> 
> 时间：2008-10-08T17:10:23.020
> 
> 标签：cross-browser, image-formats

JPEG、GIF 和 PNG 可以使用 img 标签显示，并且适用于所有浏览器，object 元素可用于显示指定其 MIME 类型的图像，但在大多数浏览器中 img 或 object 标签支持哪些其他图形格式，无需安装插件？（TIF、SVG、PCX、PICT 等。）

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-08T17:15:40.667

维基百科上有一个很好的[图表](http://en.wikipedia.org/wiki/Comparison_of_web_browsers#Image_format_support)，列出了常见的图像类型及其浏览器的支持。

您列出的文件类型（jpg、gif 和 png）似乎是几乎所有浏览器都支持的主要格式，尽管有一些警告：

> Internet Explorer 支持 PNG 图像，但无法正确显示带有伽马校正或颜色校正的图像。版本 7 之前的 Internet Explorer 版本在没有额外编码的情况下无法正确显示带有 alpha 通道（用于透明度）的图像

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T17:14:12.153

BMP 在任何地方都可以使用。

但是对于网络工作，您可能应该坚持您在问题中列出的三个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T17:12:55.417

直到 2006 年，IE 都不能正确处理使用 alpha 通道的 PNG，而 Firefox 和其他（几乎）符合标准的浏览器却可以。从我的 apache 日志来看，仍然有很多 IE 6。

# .net - .NET Regex 平衡组表达式 - 不平衡时匹配

> ID：183846
> 
> 赞同：1
> 
> 时间：2008-10-08T17:14:45.990
> 
> 标签：.net, regex

[.NET 平衡组正则表达式](http://blog.stevenlevithan.com/archives/balancing-groups)让我头疼。我有这个字符串我想匹配：

```
other stuff blah blah....
                    {
                        stuff stuff
                        {key:
                            stuff
                            stuff
                        }
                    } more stuff..... 
```

这是我的正则表达式：

```
[^{}]*                      # anything that isn't { }
\{                          # starting with {
(?>                         # atomic group: throw away backtracks on exit
    [^{}]+
  |
    \{(?:\w+:)?(?<DEPTH>)   # on matching { plus optional "word:" push stack  
  |
    \}(?<-DEPTH>)           # on matching } pop stack
)*
(?(DEPTH)(?!))              # if depth unbalanced, fail match
\}                          # ending with }
[^{}]*                      # anything that isn't { } 
```

所以，我试图匹配平衡花括号，其中一些左花括号有一个可选单词，后跟一个冒号。上面的正则表达式匹配我的示例字符串，但如果我删除一个花括号，（即“不平衡它）：

```
 other stuff blah blah....
                    {
                        stuff stuff
                        {key:
                            stuff
                            stuff

                    } more stuff..... 
```

......它仍然匹配！

谁能告诉我如何修复我的正则表达式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T17:55:17.203

您是否检查过它在第二种情况下匹配的内容？由于您没有任何锚点，我认为引擎会在第一个“{”之后开始匹配。从那里，直到结束，字符串匹配。

Try surrounding the pattern with \A and \z.

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-08T17:23:23.273

不是要杀人，而是你试图用正则表达式做的事情让你难以置信，因为这根本不可能。正则表达式是一类有限自动机，没有足够的状态来执行递归/嵌套匹配。您需要某种上下文无关的语法才能使其正常工作。

有一些正则表达式引擎确实支持递归的概念。不过，这些并不是严格意义上的正则表达式。你能告诉我们你正在使用什么引擎，因为它可能有一个递归函数可以帮助解决这个问题。

# sql-server - 可以在两个集群之间的 MS SQLServer 上设置数据库镜像吗

> ID：183849
> 
> 赞同：1
> 
> 时间：2008-10-08T17:15:10.170
> 
> 标签：sql-server, database, cluster-computing, mirroring

使用 Microsoft SQL Server 的数据库镜像功能，是否可以在两个集群之间进行镜像？MSDN 中的所有示例都显示了一个拓扑，该拓扑指示主体服务器和镜像服务器都使用单个服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T17:48:30.697

至少在 2005 年和 2008 年，答案是[肯定](http://www.microsoft.com/technet/prodtechnol/sql/2005/dbmirfaq.mspx#EXB)的。我个人没有集群方面的经验，所以我没有关于如何设置它或在你做完之后要注意什么的提示。

# python - '/' 和 '//' 用于除法时有什么区别？

> ID：183853
> 
> 赞同：538
> 
> 时间：2008-10-08T17:16:35.830
> 
> 标签：python, math, syntax, operators, floor-division

使用一个比另一个有好处吗？在 Python 2 中，它们似乎都返回相同的结果：

```
>>> 6/3
2
>>> 6//3
2 
```

* * *

## 回答 #1

> 赞同：734
> 
> 时间：2008-10-08T17:21:37.910

在 Python 3.x 中，`5 / 2`将返回`2.5`并将`5 // 2`返回`2`. 前者是浮点除法，后者是***地板除法***，有时也称为***整数除法***。

在 Python 2.2 或更高版本的 2.x 行中，整数没有区别，除非您执行 a `from __future__ import division`，这会导致 Python 2.x 采用 3.x 行为。

不管以后的导入，`5.0 // 2`都会返回`2.0`，因为那是楼层划分的运算结果。

*[您可以在PEP 238：更改除法运算](https://docs.python.org/whatsnew/2.2.html#pep-238-changing-the-division-operator)*符中找到详细说明。

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2012-07-22T21:50:35.450

### Python 2.x 说明：

为了澄清 Python 2.x 行，`/`既不是地板划分也不是真正的划分。

`/`**当两个**args都为时是地板除法`int`，但当***任何***一个 args 都是时是真正的除法`float`。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-08T17:19:59.410

`//`实现“地板分割”，无论您的类型如何。所以 `1.0/2.0`会给予，`0.5`但两者都会给予。`1/2``1//2``1.0//2.0``0`

有关详细信息，请参阅*[PEP 238：更改除法运算符](https://docs.python.org/whatsnew/2.2.html#pep-238-changing-the-division-operator)*。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2016-07-24T12:39:19.667

**/** → 浮点除法

**//** → 楼层划分

让我们看看 Python 2.7 和 Python 3.5 中的一些示例。

**Python 2.7.10 与 Python 3.5**

```
print (2/3)  ----> 0                   Python 2.7
print (2/3)  ----> 0.6666666666666666  Python 3.5 
```

**Python 2.7.10 与 Python 3.5**

```
print (4/2)  ----> 2         Python 2.7
print (4/2)  ----> 2.0       Python 3.5 
```

现在，如果您希望（在 Python 2.7 中）与 Python 3.5 中的输出相同，可以执行以下操作：

**Python 2.7.10**

```
from __future__ import division
print (2/3)  ----> 0.6666666666666666   # Python 2.7
print (4/2)  ----> 2.0                  # Python 2.7 
```

而Python 2.7 和 Python 3.5 中的*楼层*除法没有任何区别。

```
138.93//3 ---> 46.0        # Python 2.7
138.93//3 ---> 46.0        # Python 3.5
4//3      ---> 1           # Python 2.7
4//3      ---> 1           # Python 3.5 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-11-09T23:55:18.570

正如大家已经回答的那样，`//`是楼层划分。

为什么这很重要，这`//`是在所有 Python 2.2 版本（包括 Python 3.x 版本）中明确地划分。

的行为`/`可以根据以下情况改变：

*   是否主动`__future__`导入（模块本地）
*   Python 命令行选项，`-Q old`或者`-Q new`

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-03-18T18:23:48.113

```
>>> print 5.0 / 2
2.5

>>> print 5.0 // 2
2.0 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-02-05T14:27:48.270

Python 2.7 和其他即将发布的 Python 版本：

*   除法 ( `/`)

将左手操作数除以右手操作数

例子：`4 / 2 = 2`

*   楼层划分 ( `//`)

操作数的除法，其结果是除去小数点后的数字的商。但如果其中一个操作数为负数，则结果为下限，即从零四舍五入（向负无穷大）：

示例：`9//2 = 4`和`9.0//2.0 = 4.0`, `-11//3 = -4`,`-11.0//3 = -4.0`

`/`部门和`//`楼层部门运营商都以类似的方式运作。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-08T17:19:15.887

`//`是楼层划分。它总是会给你结果的整数下限。另一个是“常规”划分。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-08T17:19:42.953

双斜线 ,`//`是地板除法：

```
>>> 7//3
2 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-06-06T02:27:01.320

前面的答案很好。我想补充一点。直到某些值，它们都导致相同的商。在那个楼层除法运算符 ( `//`) 工作正常但除法 ( `/`) 运算符之后：

```
>>> int(755349677599789174 / 2) # Wrong answer
377674838799894592 
```

```
>>> 755349677599789174 // 2     # Correct answer
377674838799894587 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-06-03T15:26:43.160

等式的答案四舍五入到下一个较小的整数或以 .0 作为小数点的浮点数。

```
>>>print 5//2
2
>>> print 5.0//2
2.0
>>>print 5//2.0
2.0
>>>print 5.0//2.0
2.0 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-07-29T15:43:39.810

## 概括

*   x//y :**精确**整数除法
*   int(x/y) OR math.floor(x/y)：**不精确的**整数除法（但几乎正确）
*   x/y：浮点除法（失去意义）

## 卓越的计算结果

```
import math
N = 1004291331219602346 # huge number 

print(N//100) #=> 10042913312196023 is correct answer
print(math.floor(N/100)) #=> 10042913312196024 is wrong answer
print(math.ceil(N/100)) #=> 10042913312196024 is wrong answer
print(int(N/100)) #=> 10042913312196024 is wrong answer 
```

## 考虑

我想到了评价`int(x/y)`。
首先，Python 计算表达式`x/y`并得到 INEXACT 浮点数 z。
其次，Python 评估表达式`int(z)`。
当重要性的损失不容忽视时，我们会得到错误的结果。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-03-23T19:15:38.297

*   `//`是楼层划分。它总是会给你结果的底值。
*   另一个`/`是浮点除法。

`/`以下是和之间的区别`//`；我已经在 Python 3.7.2 中运行了这些算术运算。

```
>>> print (11 / 3)
3.6666666666666665

>>> print (11 // 3)
3

>>> print (11.3 / 3)
3.7666666666666667

>>> print (11.3 // 3)
3.0 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-02-13T20:25:01.043

**Python 3.x 说明**

只是为了补充一些以前的答案。

重要的是要注意：

> a // b

*   是**楼师**。如：

    > 数学.floor(a/b)

*   不是**int除法**。如：

    > 整数（a/b）

*   不是**四舍五入到 0 浮点除法**。如：

    > 圆形(a/b,0)

因此，当涉及到正数和负数时，行为方式是不同的，如下例所示：

1 // 2 为 0，如：

> 数学.地板（1/2）

-1 // 2 是 -1，如：

> 数学.地板（-1/2）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-03-27T19:01:12.310

### [蟒蛇 3](https://docs.python.org/3/library/stdtypes.html#typesnumeric)

> | 手术 | 结果 | 笔记 |
> | --- | --- | --- |
> | `x / y` | *x*和*y*的商 |  |
> | `x // y` | *x*和*y*的底商 | (1) |
> 
> 笔记：
> 
> 1.  也称为整数除法。结果值是一个整数，尽管结果的类型不一定是 int。结果总是向负无穷大四舍五入：`1//2`is `0`、`(-1)//2`is `-1`、`1//(-2)`is`-1`和`(-1)//(-2)`is `0`。

### [蟒蛇2](https://docs.python.org/2/library/stdtypes.html#typesnumeric)

> | 手术 | 结果 | 笔记 |
> | --- | --- | --- |
> | `x / y` | *x*和*y*的商 | (1) |
> | `x // y` | *x*和*y*的（下限）商 | (4)(5) |
> 
> 笔记：
> 
> 1\. 对于（普通或长）整数除法，结果是整数。结果总是向负无穷大四舍五入：1/2 为 0，(-1)/2 为 -1，1/(-2) 为 -1，(-1)/(-2) 为 0。请注意如果任一操作数是长整数，则无论数值如何，结果都是长整数。
> 
> | 4.*自 2.3 版后已弃用：*[`divmod()`](https://docs.python.org/2/library/functions.html#divmod)不再为复数定义底除法运算符、模运算符和函数。[`abs()`](https://docs.python.org/2/library/functions.html#abs)相反，如果合适，请使用该函数转换为浮点数。 |
> | --- |
> 
> 5\. 也称为整数除法。结果值是一个整数，尽管结果的类型不一定是 int。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-11-09T22:27:34.480

`5.0//2`结果是`2.0`，而不是`2`，因为运算符的返回值的**返回类型**`//`遵循 Python 强制（类型转换）规则。

Python 促进将较低数据类型（整数）转换为较高数据类型（浮点数）以避免数据丢失。

# c# - 我该如何 LINQify 这个？

> ID：183856
> 
> 赞同：3
> 
> 时间：2008-10-08T17:17:22.037
> 
> 标签：c#, .net, linq

有没有办法使用 LINQ 清理这种类型的循环？

```
 List<Car> result;
  List<string> makes;
  List<string> models;

  for (int i = 0; i < makes.Count() && i < models.Count(); i++)
  {
    result.Add(new Car() { Make = makes[i], Model = models[i] });
  } 
```

基本上，我正在寻找某种方法将多个单个字段数组整理成由这些字段组成的单个对象数组。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T17:26:06.280

你可以`Enumerable.Range`像这样使用：

```
List<Car> result = Enumerable.Range(0, Math.Min(makes.Count, models.Count))
    .Select(i => new Car { Make = makes[i], Model = models[i] }).ToList(); 
```

如果`makes`并且`models`总是包含相同数量的项目，您可以使用更紧凑的语法：

```
List<Car> result = makes.Select((make, i) => new Car { Make = make, Model = models[i] }).ToList(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T18:19:23.287

听起来您确实需要一个新的 LINQ 运算符 - 一个未包含在 LINQ 中的运算符，有点意外：Zip。它基本上需要两个可枚举并返回一个可枚举的配对条目，直到一个或另一个原始序列完成。

我没有类似的东西，但如果你有兴趣，写起来应该不会花太长时间。生成的代码将类似于：

```
List<Car> cars = makes.Zip(models)
                      .Select(pair => new Car(pair.First, pair.Second))
                      .ToList(); 
```

如果您对此感兴趣，请告诉我，我将在[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)中对其进行编码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T18:10:45.800

根据您需要对这些数组编写 LINQ 查询的频率，可能值得构建一个包装数组和实现的类`IEnumerable<Car>`。然后您的代码如下所示：

```
IEnumerable<Car> cars = new MyClass(makes, models);
var result = from cars... 
```

构建它并不是特别复杂；它只是分布在两个类中的四个简单方法（好吧，六个，如果你计算构造函数）（你还需要实现`IEnumerator<Car>`）。

这种方法使您不必在所有 LINQ 查询中嵌入实现细节。此外，如果您从未这样做过，这确实值得学习。舒适地实施`IEnumerable<T>`显着扩展了您可以轻松使用 LINQ 的事物的空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T15:42:30.183

```
List<Car> result = makes
                   .Take(model.Count)
                   .Select((make, index) => new Car {Make = make, Model = models[index]}); 
```

请注意，即使品牌和型号的长度不同，这也有效。

# asp.net - 在 VS 2008 嵌套母版页中包含对 JavaScript 的相对引用的首选方式

> ID：183859
> 
> 赞同：7
> 
> 时间：2008-10-08T17:18:19.993
> 
> 标签：asp.net, javascript, master-pages, relative-path, nested

我们的基本 Masterpage 有如下内容

```
 <head runat="server">
   <title></title>

   <script type="text/javascript" src="<%= Page.ResolveClientURL("~/javascript/actions.js")%>"></script>
   <script type="text/javascript" src="<%= Page.ResolveClientURL("~/javascript/jquery/jquery-1.2.6.min.js")%>"></script>
   <asp:contentplaceholder id="cph_htmlhead" runat="server">

   </asp:contentplaceholder>
  </head> 
```

如果此 Masterpage 是 ASPX 页面的 Masterpage，则一切正常。

如果这个 Masterpage 是子 Masterpage 的 Masterpage，然后一个新的 ASPX 页面使用子 Masterpage，因为它是 MasterPage，我们看到：

“”应用程序中的服务器错误。

无法修改 Controls 集合，因为该控件包含代码块（即 <% ... %>）。

**在基本 Masterpage 中包含全局资源（Javascript/CSS）的首选方法是什么，保留波浪号（~）样式的相对路径？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-08T21:11:43.797

使用 ScriptManager 服务器控件：

```
 <asp:ScriptManager ID="myScriptManager" runat="server">
    <Scripts>
      <asp:ScriptReference Path = "~/javascript/actions.js" /> 
      <asp:ScriptReference Path = "~/javascript/jquery/jquery-1.2.6.min.js" />
    </Scripts>
  </asp:ScriptManager> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-08T17:31:20.823

你有没有尝试过：

```
<script type="text/javascript" src='<%= Page.ResolveClientUrl("~/javascript/actions.js") %>'></script> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T17:23:58.530

根据[ScottGu](http://weblogs.asp.net/scottgu/archive/2006/12/19/tip-trick-how-to-run-a-root-site-with-the-local-web-server-using-vs-2005-sp1.aspx)，

要利用的一个技巧是 head runat="server" 控件提供的相对路径修复支持。您可以在 Master Pages 中使用它来轻松引用在整个项目中重复使用的 .CSS 样式表（无论项目是根引用还是子应用程序）：

然后，head 控件的路径修复功能将采用相对 .CSS 样式表路径，并在运行时正确输出样式表的绝对路径，无论它是根引用的网站还是子应用程序的一部分。

# c# - C# 中的图像捕获

> ID：183881
> 
> 赞同：5
> 
> 时间：2008-10-08T17:24:28.390
> 
> 标签：c#, image, webcam, image-capture

我正在做一个家庭项目，该项目涉及将图像与图像数据库进行比较（使用象限 - 或左右 - 直方图方法）。我想知道我对网络摄像头或其他图像捕获设备的选择是什么：

*   易于使用 Windows SDK（特别是 [DirectShow](http://msdn.microsoft.com/en-us/library/ms783323(VS.85).aspx)，我计划与 C# 一起使用）
*   拥有适用于 64 位和 32 位 Windows Vista（和 Server 2008）的驱动程序

我问的主要是为了避免其他人在使用网络摄像头时可能遇到的陷阱，并查看是否有其他可用的图像捕获设备（或 C# 可用 API）我应该查看。我怀疑任何旧的网络摄像头都可以，但我宁愿安全也不要后悔。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T22:05:23.377

如果您只想要图像，许多网络摄像头都支持 TWAIN - 您可以使用此代码与 .NET 一起使用

[http://www.codeproject.com/KB/dotnet/twaindotnet.aspx](http://www.codeproject.com/KB/dotnet/twaindotnet.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T12:33:00.563

我正在用网络摄像头做一些非常相似的事情，并发现罗技和微软品牌的网络摄像头与 DirectShow 配合得很好。

我还发现许多新的网络摄像头不支持 twain，并且 WIA 对进行实时捕获的支持已在 Vista 中删除，并且在 2000 年不存在，因此 Directshow 似乎是唯一可以跨操作系统可靠工作的东西.

# compiler-construction - 有趣的编译器项目

> ID：183882
> 
> 赞同：26
> 
> 时间：2008-10-08T17:24:44.473
> 
> 标签：compiler-construction

我目前正在为未来 8 周内完成的研究生级编译器课程选择一个项目。我想做一些与优化相关的事情，因为我以前在该领域工作不多，但该领域的任何事情都是公平的。

你做过的最有趣的编译器相关项目是什么？你从中学到最多的是什么？

* * *

**编辑：**谢谢大家的好建议。我很抱歉这么久没有更新这个。

我最终做的项目是在 LLVM 上进行简单的自动向量化优化。LLVM 有向量类型，但似乎没有任何方法可以在不支持前端的情况下利用它们。此优化将普通标量代码转换为矢量代码。

由于自动矢量化是一个相当难以实现的优化，我们尽可能地限制了我们的范围。首先，为了在代码中展示指令级并行性，我们寻找符合我们标准的单块循环，然后将它们展开特定次数，以便它们可以方便地向量化。然后，我们实现了Larsen 和 Amarasinghe在[Exploiting Superword Level Parallelism with Multimedia Instruction Sets中提出的打包算法。](http://groups.csail.mit.edu/cag/slp/SLarsen-SM.pdf)

即使是这种优化的简化版本也相当复杂。有很多限制；例如，您不想向量化一个存在于循环之外的变量，因为程序的其余部分希望它是标量的。在过去的几周里，我们投入了很多时间。不过这个项目很有趣，我们学到了很多东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-08T18:16:48.923

在 8 周的时间范围内，您需要小心“范围蔓延”。那是不要太雄心勃勃，尤其是。如果这个项目包括编译器构造的其他方面（词法分析/解析），或者如果您仍在学习工具（调试器、yacc）和中间数据结构（DAG）。

也就是说，我的第一个建议是尝试一些实时变量分析。算法已经很成熟了，所以你几乎只需要针对你的数据结构等进行编码。

这将使您可以进行有限形式的死代码删除。也就是说，如果您检测到一个变量已声明但从未使用过，请不要为它分配空间。如果您检测到一个值已设置但从未读取，请不要生成该集合。

实时变量分析也可以帮助进行寄存器分配，因此如果有时间，您也可以解决这个问题，并且您应该能够重新使用为死代码删除构建的一些内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T18:37:47.773

几年前，我为我公司生产的产品设计了一个 DSL 并编写了编译器。DSL 使用了声明性规则、事件驱动逻辑和组合继承的奇怪组合。这是一个非常有趣的项目，我学到了很多东西。

它真的激起了我对解析器和编译器的兴趣，所以我试图跟上编译器技术有趣的新发展。

关于优化，这是我去年读过的一篇有趣的文章：

[http://theory.stanford.edu/~aiken/publications/papers/asplos06.pdf](http://theory.stanford.edu/~aiken/publications/papers/asplos06.pdf)

在本文中，作者描述了一种自动发现窥视孔优化的技术（超过了几个流行的 C++ 编译器后端的性能），而无需专家编写一堆特殊情况的代码。他们的技术使用无监督学习算法来发现高价值的窥视孔替代品。

读完之后，我想到他们的方法可以通过为算法提供一个“机器描述”来增强，其中列出了目标处理器架构支持的所有指令（及其主要效果和副作用）。然后，求解器可以更容易地找到这些序列，而不是使用蛮力方法来找到等效的指令序列。

机器学习算法仍将使用经验观察来确定最有效的指令序列（因为缓存效果、微操作和流水线几乎需要经验时序数据），但可以使用代数定理证明器来预测结果等效性，操作机器说明。

在论文中，他们讨论了他们的优化器如何只能发现两个或三个指令的窥孔替换序列（因为否则，蛮力搜索将花费太长时间并消耗太多内存）。将智能求解器放在算法中的正确位置可以使其能够处理更长的替换序列。

Anyhoo...当你完成那个项目时告诉我！别忘了在“致谢”部分提及我！！;-)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-08T17:33:27.107

我认为编写自己的简单嵌入式脚本语言是我做过的最有趣的编译器相关项目之一。它教会了我从设计到概念的整个过程的各个方面，并且由于我是从头开始做的，所以我可以根据需要将其变得简单或复杂，这使我能够在没有很多噪音的情况下理解概念，即修改已建立的项目可能有。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-08T17:56:47.030

如果您对优化感兴趣，使用 SSE 和 MMX 指令集的循环向量化可能会很有趣。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-08T17:53:44.820

对于学习编译器，端到端进行是最好的主意。使用简单的后端机器，而不是 x86，而是选择一些简单的机器，如准系统 MIPS。我的本科编译器项目针对的是 PDP-11 模拟器，这是一个很好的目标，因为它让事情变得非常简单。多亏了一些示例代码，我们可以在大约四个星期内完成一个简单的命令式语言编译器。在 C 中！

今天，有了像机器学习这样强大的语言，编译器应该会容易得多。

你做什么应该取决于你的兴趣。如果是优化，找到一些你需要关心的简单框架。

我认为今天最富有成果的领域是为线程目标编译或即时编译。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-08T19:06:07.387

寻求帮助 Shed Skin 项目，该项目将 Python 编译为 C++。我想在夏天，有人发出求助电话。确定改进 C++ 编译的方法将为 python 程序提供惊人的优化！

[http://code.google.com/p/shedskin/](http://code.google.com/p/shedskin/)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-08T17:43:57.710

我曾经写过一种编程语言和一个虚拟机来运行它。该语言能够与 16 位 Windows 上的 DLL（这是在 OLE 自动化之前）中包含的专门编写的函数进行接口。

从头到尾的整个过程让我对一门语言的两端都有了很好的理解。当时我读过各种编译器书籍（例如臭名昭​​著的 Dragon 书籍），但直到我写了一些具体的东西，它才真正沉入其中。现在，多年过去了，我所做的工作让我对 Java VM 和 CLR 等工作有了更丰富的认识和理解。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-08T18:04:40.350

在我本科的编译器课程中，我们首先从头开始为类似 Pascal 的语言编写了一个递归下降（自上而下）解析器：词法分析器，解析器，一切。

大约在学期中途，我们转向了解析器/扫描器生成器，例如 lex/yacc 或 flex/bison。我们构建了一个编译器，它将我们的 Pascal 子集编译为我们给定的堆栈机器的汇编（堆栈机器非常简单，但原理仍然相同）。

如果您对编译器感兴趣，我不能高度推荐[Dragon Book](http://en.wikipedia.org/wiki/Dragon_book)。它旨在用于 1 个学期的本科课程，下半部分用作研究生课程，涵盖了您可能希望的所有理论和优化。连乔尔[都喜欢](http://www.joelonsoftware.com/items/2006/09/01b.html)。=)

干杯

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-08T18:08:47.363

考虑现有动态类型语言的类型推断。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-08T18:51:58.757

除了“龙书”的建议之外，我还强烈推荐 Steven S. Muchnick 的“Advanced Compiler Design & Implementation”，它侧重于中间表示、代码生成和优化技术。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-08T19:24:37.240

这是另一个想法......虽然它仍然有点模糊：

大多数优化是在编译时完成的（除了在运行时优化的 JIT 编译器）。但是在链接时和安装时也有很多优化机会。

我对一个平台的想法特别感兴趣，在这个平台上你直到安装时才需要链接。但是在安装时链接过程中，您会采取积极的优化策略，因为您了解有关机器架构的大量详细信息，并且可以做出更微妙和更明智的优化决策。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-08T18:00:20.953

循环检测和参数化展开应该足够困难以使其变得有趣。不是很性感，但在 8 周内变得太性感会让你沉沦。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-08T18:26:49.713

您可以为 IronScheme 编写一个优化器，因为它目前可以很好地打击所有内容，除了一些“内在”功能。 `:)`

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-08T18:45:53.013

其他有趣的项目可能包括：

*   向开源 Sun JVM 添加尾调用优化。

*   将命名返回值优化 (NRVO) 添加到 Python 或 Ruby VM。

*   为您最喜欢的目标添加即时正则表达式到字节码的编译（.Net 已经有了它。我很确定 Java 没有。）

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-08T18:49:35.020

虽然编写自己的语言是一项有趣且传统的学术活动，但已经有太多实施不佳的编译器相关项目。此外，8 周的时间不足以完成一个完整的语言实现。

如果您对“与优化相关的东西”感兴趣，请选择一种已经存在的语言或 VM，并针对性能、大小或两者进行优化。这将避免您不得不重新发明整个语言实现，让您专注于优化问题，将产生对其他人有用的产品，而不仅仅是另一个学术练习，甚至可以用于找工作。

我相信 Parrot 字节码解释器和各种 .Net Iron 语言解析器甚至可以从简单的优化中受益。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-01-06T20:13:16.013

我在自己的教学中“早在何时”就做到了这一点。我不会像其他事情那样强调优化，比如类型推断或 JIT 或字节编码或对象格式/调试支持。

专注于优化并没有什么坏处，只要你也传达出它远没有人们想象的那么重要。仅在代码中很重要：

*   在调用堆栈底部的紧密循环中运行（即没有显式或隐式调用函数）
*   实际上占据了应用程序时间的很大一部分（即，如果代码很少运行，优化它不会有太大帮助）。

这只是编译器将看到的所有代码的一小部分。

编辑：可悲的是，我无法逃避使用 Fortran 编译器，它们无情地扰乱代码，使其非常难以调试，同时对性能产生 epsilon 影响。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-06T19:52:00.377

使用启发式测试自动生成内联代码以权衡大小/速度。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-10-22T01:35:21.190

B::CC perl 编译器将受益于添加和分析类型。我只是还没有足够的时间。

最近时间充裕。[http://blogs.perl.org/users/rurban/2011/02/use-types.html](http://blogs.perl.org/users/rurban/2011/02/use-types.html)

# visual-studio - 调试停止后 VS 2k8 不释放文件句柄：无法将文件 X 复制到输出目录，因为它正被另一个进程使用

> ID：183887
> 
> 赞同：6
> 
> 时间：2008-10-08T17:25:39.167
> 
> 标签：visual-studio, visual-studio-2008

每隔一段时间，通常当我停止在我们的 UI 程序集中调试时，我会收到以下错误，需要重新启动 Visual Studio 2008，这会扼杀我的工作效率：

> 错误 13 无法将文件 [UI 程序集] 复制到 [输出目录]。该进程无法访问文件 [输出目录][UI 程序集]，因为它正被另一个进程使用。

重新启动后，我收到此错误：

> 错误 1 ​​找不到元数据文件 [RELEASE 文件夹中的实用程序功能程序集]。

我觉得这真的很奇怪，因为我们从不使用 Release 配置。

我在 Windows Vista 上使用 VS 2k8 SP1。

我知道是 VS 调试器没有通过使用句柄实用程序（以前来自 Sysinternals）释放其文件句柄。该进程是 devenv.exe。

我已经尝试关闭并重新打开解决方案。没用。只有完整的 VS2k8 重启才有效。

我尝试添加预构建事件，以按照[此处](http://forums.msdn.microsoft.com/en-US/vbide/thread/cd12f3c7-de96-4353-adce-23975e30933f/)所述移动文件，但这不起作用，因为 Windows 无法删除文件，原因与它无法替换它的原因相同：它有一个打开的句柄。

我什至尝试使用上述 handle.exe 工具手动关闭句柄，然后尝试预构建事件。Visual Studio 显然不知道它的句柄已被关闭，因为 VS 构建失败，但 handle.exe 显示有问题的文件上没有打开的文件句柄。

作为记录，这是我运行的加载项：

*   锐利器 4
*   智能贴纸 2008
*   模拟隔离器
*   测试驱动.NET 2.13.2184

我还为这个项目使用了 Developer Express 控件，所以这也可能与它有关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T17:31:49.607

我在 VS2005 和 VS2008 中遇到过类似的问题，没有安装任何插件或项目中没有任何第三方控件。我找到的唯一解决方案是关闭 Visual Studio 并重新打开它。这是一个非常间歇性的问题，虽然很烦人，但似乎无法最终解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-15T05:07:47.403

你可以试试这个预构建事件脚本：

如果存在 "$(TargetPath).locked" del "$(TargetPath).locked" 如果不存在 "$(TargetPath).locked" move "$(TargetPath)" "$(TargetPath).locked"

有些人报告说它解决了这个问题。

更新：

你有没有机会在你的.config（或machine.config？）中有*这个：*

```
<hostingEnvironment shadowCopyBinAssemblies="false"/> 
```

似乎这会在构建问题期间创建（或可能只是加剧）原始“无法复制”。当然，我只是将该设置添加到我的项目中，因为在调试 ASP.NET 无法隐藏/复制 DLL 时出现错误。然而，事后看来，这个问题比锁定问题更容易处理。对于影子/复制问题，您只需要构建然后等待几秒钟。这有点烦人，但肯定比每次要进行构建时都必须重新启动 Visual Studio 问题更小！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-23T11:03:25.627

在与 xp 或 vista 的兼容模式下启动 Visual Studio 应用程序解决了我的环境（win7 64 位）中的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T17:37:15.320

有[解锁](http://www.emptyloop.com/unlocker/)工具可以帮助您解决一些麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T17:44:40.563

我们在构建项目时遇到了与 VS2002 类似的问题。当我们升级到 VS2005 时，我们通过将我们的应用程序构建到一个公共构建文件夹（即 {SolutionRoot}\Build）来修复它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T21:45:04.023

我开始注意到，在执行 Application.Idle 期间调用的方法时，它似乎更有可能发生（并且可能只发生）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:16:11.170

出于某种原因，这似乎可以通过更改程序集的输出名称以匹配默认命名空间来解决。

我通过[https://connect.microsoft.com/VisualStudio/feedback/Workaround.aspx?FeedbackID=114694](https://connect.microsoft.com/VisualStudio/feedback/Workaround.aspx?FeedbackID=114694)找到了这个解决方法。预构建脚本选项有效，但前提是程序集已经存在。如果您进行清洁/构建，它将无法正常工作。

# version-control - 用于集中存储和发布 perl 脚本和“小工具”的技术？

> ID：183896
> 
> 赞同：3
> 
> 时间：2008-10-08T17:28:37.537
> 
> 标签：version-control, catalog

**我的问题：**

开发团队使用的许多（>100）工具都是“家庭”编写的。它们有时是一个 perl 脚本，或者一个“网页”，或者只是一些执行几个小功能的东西。我需要找到一种方法（作为我“负责工具的中层经理”工作的一部分）将这些收集到一个目录中。这些工具都没有以任何方式“产品化”。

我需要能够以某种方式衡量每个工具的使用情况。上传或提交工具应该是一个简单的练习，下载工具也是如此。必须有版本管理和控制。

有没有一种技术可以集中存储和发布这些小工具？

有没有人在其他公司有过这种不切实际的冒险经历？

补充问题...

什么样的过程检查是合适的？您是否有针对服务器上的工具的审查委员会？

我想确保我们不会因脚本而产生意外后果。我还想确保识别和维护“业务关键”集。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T17:33:54.767

我们使用 SVN 的 Web 可访问前端来进行“现场开发”脚本、自定义和小工具。

**另外**
我现在使用的是`trac`绑定到`svn`我的网络服务器上的一个实例。我不知道[trac](http://trac.edgewall.org/)是否也处理签入代码 - 我正在运行的版本没有。

我之前提到的前端是在我以前工作的地方使用的，我不知道它到底是什么。

# c++ - C++ 中的前向引用或声明

> ID：183898
> 
> 赞同：4
> 
> 时间：2008-10-08T17:29:19.097
> 
> 标签：c++, syntax, forward-declaration

如何在 C++ 中进行前向引用/声明以避免循环头文件引用？

我在头文件中有#ifndef 保护，但记忆告诉我我需要这个前向引用的东西——我以前用过 >< 但不记得怎么用了。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-08T17:32:04.287

您预先声明了该类而不包括它。例如：

```
//#include "Foo.h" // including Foo.h causes circular reference
class Foo;

class Bar
{
...
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T22:45:32.733

我相信您所说的正确术语是“前向声明”。“前向引用”会有点混乱。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-08T17:33:19.743

如果您有#ifndef 保护，您将不会获得循环头文件引用。这才是重点。

前向引用用于避免仅通过指针或引用使用的对象的#include(ing) 头文件。但是，在这种情况下，您并没有解决循环引用问题，您只是在练习良好的设计并将 .h 文件与其不需要知道的细节解耦。

# windows - 如何从 Windows 资源管理器启动 PowerShell？

> ID：183901
> 
> 赞同：287
> 
> 时间：2008-10-08T17:30:16.240
> 
> 标签：windows, powershell

有没有办法从 Windows 资源管理器在特定文件夹中启动 PowerShell，例如右键单击文件夹并具有“在此文件夹中打开 PowerShell”之类的选项？

每天第一次运行 MSBuild 时，必须将目录更改为我的项目文件夹，这真的很烦人。

* * *

## 回答 #1

> 赞同：558
> 
> 时间：2011-07-06T15:47:40.827

在 Windows 资源管理器中，只需转到顶部的地址栏（键盘快捷键：`Alt`+`D`或`Ctrl`+ `L`），然后键入`powershell`or`powershell_ise`并按`Enter`。PowerShell 命令窗口将打开当前目录。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-10-08T17:44:12.700

只是作为一个技巧反向添加，在 PowerShell 提示符下，您可以执行以下操作：

```
ii . 
```

或者

```
start . 
```

在当前目录中打开 Windows 资源管理器窗口。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2013-06-25T09:03:34.170

如果您使用的是 Windows 8 或更高版本，则可以简单地使用内置*文件*→ “打开 Windows PowerShell”。

或`Alt`+`F`后跟`R`.

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2014-07-07T06:06:29.360

作为上述答案的替代方案，它要求您每次都键入 PowerShell 命令 ( *powershell.exe* )，您可以创建一个上下文菜单条目，就像使用“**在此处打开命令窗口**”上下文菜单一样。

这些命令存在三个注册表项。每个键控制不同 Windows 资源管理器对象的上下文菜单。第一个是你问的那个：

*   **HKCR\Directory\Background\shell** - 这是资源管理器窗口本身的上下文菜单（即在未选择任何项目时显示的上下文菜单，例如在窗口的空白区域中单击鼠标右键时）。
*   **HKCR\Directory\shell** - 这是 Windows 资源管理器中文件夹的上下文菜单。
*   **HKCR\Drive\shell** - 这是 Windows 资源管理器根目录中驱动器图标的上下文菜单。

对于这些注册表项中的每一个，您都可以添加一个子项，该子项会将“在此处打开 PowerShell 窗口”命令添加到上下文菜单中，就像您拥有“在此处打开命令窗口”上下文菜单一样。

这是我的**OpenPowerShellHere.reg**文件的副本，该文件将命令放在每个资源管理器对象、窗口背景、文件夹和驱动器图标的上下文菜单中：

```
Windows Registry Editor Version 5.00

;
; Add context menu entry to Windows Explorer background
;
[HKEY_CLASSES_ROOT\Directory\Background\shell\powershell]
@="Open PowerShell window here"
"NoWorkingDirectory"=""

[HKEY_CLASSES_ROOT\Directory\Background\shell\powershell\command]
@="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'"

;
; Add context menu entry to Windows Explorer folders
;
[HKEY_CLASSES_ROOT\Directory\shell\powershell]
@="Open PowerShell window here"
"NoWorkingDirectory"=""

[HKEY_CLASSES_ROOT\Directory\shell\powershell\command]
@="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'"

;
; Add context menu entry to Windows Explorer drive icons
;
[HKEY_CLASSES_ROOT\Drive\shell\powershell]
@="Open PowerShell window here"
"NoWorkingDirectory"=""

[HKEY_CLASSES_ROOT\Drive\shell\powershell\command]
@="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'" 
```

因此，使用您最喜欢的文本编辑器，打开一个名为**OpenPowerShellHere.reg**的新文件。复制上面代码的***确切***文本，将其粘贴到新文件中，然后保存。（我会包含该文件的副本，但我无法确定附件是否可能。）如果您想从其中一个条目中*排除*该命令，只需用分号注释掉相应的部分。我的评论向您展示了每个部分。

保存文件后，双击它运行它。当它询问时，告诉它继续。一旦你运行它，上下文菜单条目就会出现！

这是我的资源管理器窗口上下文菜单。我已经突出显示了控制台和 PowerShell 命令。如您所见，您还可以添加上下文菜单条目来运行提升的命令窗口，即*以管理员身份运行*。

![资源管理器上下文菜单中的 PowerShell 条目](https://i.stack.imgur.com/aAR1T.png)

**注意**：上下文菜单条目根据其注册表项按字母顺序显示。提升的命令外壳的键名是“ *runas* ”，这就是它出现在 PowerShell 条目之后的原因。

**注意**：如果您打开了资源管理器窗口，您可能需要将其关闭并重新打开以使更改生效。

**注意**：在 Windows 7 中，`HKCR\Directory\Shell`如果您使用资源管理器一侧的工具包，则无法使用

（即单击库标题下的文档）

您必须使用导航`Computer -> C: -> to -> Some -> Target -> Directory`

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2008-10-08T17:40:40.400

您可以从此处下载 inf 文件 - 在此处[介绍 PowerShell 提示](http://www.hanselman.com/blog/IntroducingPowerShellPromptHere.aspx)

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2016-12-13T11:05:27.503

在 Windows 10 中，非管理员和管理员都可以通过菜单栏找到命令提示符和 powershell 提示符。这些选项会将其文件夹设置为资源管理器中当前选择的文件夹。

至少对于瑞典语版本，powershell 是用`Alt` `F+I`. 对于管理员 powershell，它是`Alt` `F+S+P`.

[![Windows Powershell 菜单](https://i.stack.imgur.com/Ac8S8.png)](https://i.stack.imgur.com/Ac8S8.png)

如果这些不是正确的字符，您可以按住`Alt`键查看正确的字符。每个步骤的菜单项上都会有一个字符。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2020-03-02T03:46:56.780

Windows 10 让它变得更容易。您可以：

*   `SHIFT`+`Mouse Right Click`在一个文件夹上，你会得到一个菜单项`Open PowerShell window here`。

或者您可以：

*   `File`-> `Open Windows PowerShell`。

**为了奖金......**

如果您`Mouse Right Click`在`File`->上`Open Windows PowerShell`，那么您可以`Add to Quick Access Toolbar`：

[![在此处输入图像描述](https://i.stack.imgur.com/G5QAG.png)](https://i.stack.imgur.com/G5QAG.png)

这在这里放了一个方便的图标：

[![在此处输入图像描述](https://i.stack.imgur.com/YIBBm.png)](https://i.stack.imgur.com/YIBBm.png)

现在您只需单击该图标即可。:)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2019-07-01T13:53:36.397

我很惊讶没有人给出这个答案，这是最简单的一个。（必须是年份。）

只需 Shift + 右键单击​​资源管理器。然后您可以“在此处打开 PowerShell 窗口”。

默认情况下，它可能设置为命令提示符。如果是这样，您可以在 Windows 10 设置中更改此设置：转到个性化 -> 任务栏并启用“当我右键单击开始按钮或按 Windows 键+X 时，在菜单中将命令提示符替换为 Windows PowerShell”。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-10-14T01:08:44.317

我想让这个上下文菜单只有在*右键单击*并**按住**“SHIFT”时才能工作，这就是内置的“在此处打开命令窗口”上下文菜单的工作方式。

然而，提供的解决方案都没有这样做，所以我不得不滚动我自己的`.reg`文件 - 复制下面的文件，将其另存为`power-shell-here-on-shift.reg`并双击它。

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Directory\shell\powershell]
@="Open PowerShell here"
"NoWorkingDirectory"=""
"Extended"=""

[HKEY_CLASSES_ROOT\Directory\shell\powershell\command]
@="C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%L'" 
```

![在按住 shift 并按右键的同时在此处打开电源外壳](https://i.stack.imgur.com/daHsy.png)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-08T17:33:59.883

试试[PowerShell PowerToy ...它为](http://technet.microsoft.com/en-us/magazine/cc162321.aspx)*Open PowerShell Here*添加了一个上下文菜单项。

或者，您可以创建一个打开 PowerShell 的快捷方式，其中 Start In 文件夹是您的 Projects 文件夹。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2016-11-10T20:53:47.537

在较新的版本中，当您在空白处`Shift`+时，默认情况下，Windows 10 在上下文菜单中具有“在此处打开 PowerShell 窗口”，无论如何您现在应该使用[Windows 终端](https://github.com/microsoft/terminal)。`Mouse Right Click`

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-05T16:31:47.863

为 SVN 制作工具的家伙制作了一个 Windows Explorer 扩展，它至少会打开一个命令提示符窗口。

我还没有尝试过，所以我不知道它是否会做 PowerShell，但我想与我的 Stack Overflow 兄弟分享爱：

[http://tools.tortoisesvn.net/StExBar](http://tools.tortoisesvn.net/StExBar)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-12-27T18:26:11.140

在 Windows 8.1 和 Server 2012 R2 中更容易。

这样做一次：右键单击任务栏，选择属性。在导航选项卡中，**当我右键单击左下角或按 Windows 键+X 时，打开菜单中的 [✓] Replace Command Prompt with Windows PowerShell**。

然后，只要您需要 PowerShell 提示符，请点击`Win+X`, `I`。（或者`Win+X`，`A`对于管理员 PowerShell 提示符）

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-07-10T16:35:34.620

另一种选择是 Michael Murgolo 在 TechNet 上的出色 Elevation PowerToys，网址为[http://technet.microsoft.com/en-us/magazine/2008.06.elevation.aspx](http://technet.microsoft.com/en-us/magazine/2008.06.elevation.aspx)。

它们包括 PowerShell Prompt Here 和 PowerShell Prompt Here as Administrator。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-01-18T10:21:40.573

通过在下面添加注册表项，在 Windows 10 中，我设法在我的上下文菜单中获得了[Open PowerShell Here](http://i.stack.imgur.com/oiEfp.png)选项。`SHIFT + RClick`只需将这些复制到空白记事本文件中，然后另存为`.reg`文件并运行文件以添加密钥，它应该可以从那里开始工作。其中一些其他答案说要将密钥添加到**HKCR\Directory\shell**但我发现它只适用于进入**HKLM\SOFTWARE\Classes\Directory\shell的密钥**

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\background\shell\powershell]
"Extended"=""
"NoWorkingDirectory"=""
@="Open PowerShell here"
"Icon"="%SystemRoot%\\system32\\WindowsPowerShell\\v1.0\\powershell.exe"

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\background\shell\powershell\command]
@="C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'"

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\shell\powershell]
@="Open PowerShell here"
"Extended"=""
"Icon"="%SystemRoot%\\system32\\WindowsPowerShell\\v1.0\\powershell.exe"
"NoWorkingDirectory"=""

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Directory\shell\powershell\command]
@="C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'" 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-09-24T11:53:29.073

一种相当简单的替代方法是通过快捷方式调用 PowerShell。有一个标记为“开始于”的快捷方式属性，说明调用快捷方式时要使用的目录（文件夹）。

如果 Start In 框为空，则表示使用当前目录。

当您第一次以通常的方式创建 PowerShell 的快捷方式时，开始在框中指定主目录。如果你把 start in 框空白，你现在有一个 powershell 的快捷方式，可以在当前目录中打开 PS，不管是什么。

如果您现在将此快捷方式复制到目标目录，并使用资源管理器调用它，您将启动一个指向目标目录的 PS。

这个问题已经有一个公认的答案，但我将其作为另一种方式提供。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-11-08T02:41:52.830

```
New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT
if(-not (Test-Path -Path "HKCR:\Directory\shell\$KeyName"))
{
    Try
    {
        New-Item -itemType String "HKCR:\Directory\shell\$KeyName" -value "Open PowerShell in this Folder" -ErrorAction Stop
        New-Item -itemType String "HKCR:\Directory\shell\$KeyName\command" -value "$env:SystemRoot\system32\WindowsPowerShell\v1.0\powershell.exe -noexit -command Set-Location '%V'" -ErrorAction Stop
        Write-Host "Successfully!"
     }
     Catch
     {
         Write-Error $_.Exception.Message
     }
}
else
{
    Write-Warning "The specified key name already exists. Type another name and try again."
} 
```

[您可以从如何从 Windows 资源管理器启动 PowerShell](https://gallery.technet.microsoft.com/How-to-start-PowerShell-4953b7ba)下载详细脚本

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-06-24T14:55:43.947

## 对于自动热键用户，这是我正在使用的一个片段

按下 时，它会打开 PowerShell 窗口`Ctrl-Alt-T`。（用Win10测试）

如果您的“活动窗口”是 Windows Explorer 窗口，则 PowerShell 在*当前文件夹*中打开。否则，只需在某个*默认文件夹*中打开 PowerShell 。

用法： 1) 安装 AutoHotkey，并将其复制粘贴到 myscript.ahk 2) 替换`<DefaultPath>`为您选择的路径。3) 运行脚本。

```
; Ctrl-Alt-T opens PowerShell in the current folder, if using Windows Explorer. Otherwise, just open the Powershell.
^!T::
if WinActive("ahk_class CabinetWClass") and WinActive("ahk_exe explorer.exe")
{
    KeyWait Control
    KeyWait Alt
    Send {Ctrl down}l{Ctrl up}
    Send powershell{Enter}
}
else
{
    psScript =
    (
    cd 'C:\<DefaultPath>'
    ls
    )
    Run "%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe" -NoExit -Command &{%psScript%}
}
return 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-09-16T15:33:10.630

我创建了一个完全自动化的解决方案来添加 PS 和 CMD 上下文项。只需运行 set_registry.cmd ，当在文件夹或某个打开的文件夹中单击 RMB 时，它将更新注册表以添加两个按钮： [![在此处输入图像描述](https://i.stack.imgur.com/7fO0w.jpg)](https://i.stack.imgur.com/7fO0w.jpg)

这会将注册表项的所有者更改为管理员并添加上下文菜单
[更改注册表以启用 PS 和 CWD 上下文菜单](https://github.com/beliaev-maksim/cmd_ps_windows_registry)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-05-11T15:03:57.013

只有这在 Windows 10 上对我有用......

使用以下内容创建一个名为 PowershellHereContextMenu.reg 的文件，右键单击它并“合并”。

```
Windows Registry Editor Version 5.00

;
; Add context menu entry to Windows Explorer folders
;
[HKEY_CLASSES_ROOT\Directory\shell\powershellmenu]
@="PowerShell Here"

[HKEY_CLASSES_ROOT\Directory\shell\powershellmenu\command]
@="C:\\\\Windows\\\\system32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%L'"

;
; Add context menu entry to Windows Explorer background
;
[HKEY_CLASSES_ROOT\Directory\Background\shell\powershellmenu]
@="PowerShell Here"
"NoWorkingDirectory"=""

[HKEY_CLASSES_ROOT\Directory\Background\shell\powershellmenu\command]
@="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'"

;
; Add context menu entry to Windows Explorer drive icons
;
[HKEY_CLASSES_ROOT\Drive\shell\powershellmenu]
@="PowerShell Here"
"NoWorkingDirectory"=""

[HKEY_CLASSES_ROOT\Drive\shell\powershellmenu\command]
@="C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoExit -Command Set-Location -LiteralPath '%V'" 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-10-28T05:55:52.287

在文件资源管理器的任何位置以管理员身份运行 PowerShell 转到该文件夹​​并使用快捷方式“alt + f + s + a”在该特定文件夹位置以管理员身份打开 powershell

# c# - 如何确定从 Silverlight 2.0 (RC0) 中的 URI 成功加载的图像？

> ID：183904
> 
> 赞同：1
> 
> 时间：2008-10-08T17:30:54.100
> 
> 标签：c#, wpf, silverlight-2.0

在下面的代码中：

```
Image img = new Image();
img.Source = new BitmapImage(new Uri("http://someURL/somefilename.jpg", UriKind.Absolute)); 
```

如何确定图像是否成功加载（当有有效的 URI 时）？即，URI 是有效格式，但文件可能不存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T18:12:21.897

`Image`有一个`ImageFailed`事件。

`BitmapSource`(base for `BitmapImage`) 有一个`IsDownloading`属性，还有`DownloadProgress`, `DownloadCompleted`, 和`DownloadFailed`events。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T21:26:57.027

如果您运行上面的示例代码（使用有效的 url 但无效的图像文件），您将抛出异常：

```
Error: Sys.InvalidOperationException: ImageError error #4001 in control 'Xaml1': AG_E_NETWORK_ERROR 
```

因此，如果您将代码包装在 try/catch 块中，您可以确定图像是否加载了属性。

# c# - 如何将 Unicode 转义序列转换为 .NET 字符串中的 Unicode 字符？

> ID：183907
> 
> 赞同：33
> 
> 时间：2008-10-08T17:32:01.290
> 
> 标签：c#, .net, unicode

假设您已将文本文件加载到字符串中，并且您希望将所有 Unicode 转义转换为字符串中的实际 Unicode 字符。

例子：

> “以下是 Unicode '\u2320' 中整数字符的上半部分，这是下半部分 '\U2321'。”

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-08T17:32:18.420

答案很简单，并且适用于至少几千个字符的字符串。

示例 1：

```
Regex  rx = new Regex( @"\\[uU]([0-9A-F]{4})" );
result = rx.Replace( result, match => ((char) Int32.Parse(match.Value.Substring(2), NumberStyles.HexNumber)).ToString() ); 
```

示例 2：

```
Regex  rx = new Regex( @"\\[uU]([0-9A-F]{4})" );
result = rx.Replace( result, delegate (Match match) { return ((char) Int32.Parse(match.Value.Substring(2), NumberStyles.HexNumber)).ToString(); } ); 
```

第一个示例显示了使用 lambda 表达式 (C# 3.0) 进行的替换，第二个示例使用了应与 C# 2.0 一起使用的委托。

为了分解这里发生的事情，首先我们创建一个正则表达式：

```
new Regex( @"\\[uU]([0-9A-F]{4})" ); 
```

然后我们使用字符串“result”和一个匿名方法（第一个示例中的 lambda 表达式和第二个示例中的委托 - 委托也可以是常规方法）调用 Replace()，该方法转换字符串中找到的每个正则表达式.

Unicode 转义是这样处理的：

```
((char) Int32.Parse(match.Value.Substring(2), NumberStyles.HexNumber)).ToString(); }); 
```

获取表示转义数字部分的字符串（跳过前两个字符）。

```
match.Value.Substring(2) 
```

使用 Int32.Parse() 解析该字符串，该字符串采用 Parse() 函数应该期望的字符串和数字格式，在这种情况下是十六进制数字。

```
NumberStyles.HexNumber 
```

然后我们将结果数字转换为 Unicode 字符：

```
(char) 
```

最后，我们在 Unicode 字符上调用 ToString()，它为我们提供了它的字符串表示形式，即传递回 Replace() 的值：

```
.ToString() 
```

注意：您可以使用匹配参数的 GroupCollection 和正则表达式中的子表达式来仅捕获数字 ('2320')，而不是使用 Substring 调用获取要转换的文本，但这更复杂且可读性较差。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-20T18:54:36.130

再重构一点：

```
Regex regex = new Regex (@"\\U([0-9A-F]{4})", RegexOptions.IgnoreCase);
string line = "...";
line = regex.Replace (line, match => ((char)int.Parse (match.Groups[1].Value,
  NumberStyles.HexNumber)).ToString ()); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-10-30T15:36:12.573

这是 VB.NET 的等价物：

```
Dim rx As New RegularExpressions.Regex("\\[uU]([0-9A-Fa-f]{4})")
result = rx.Replace(result, Function(match) CChar(ChrW(Int32.Parse(match.Value.Substring(2), Globalization.NumberStyles.HexNumber))).ToString()) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-04T14:25:11.640

我认为您最好将小写字母添加到正则表达式中。它对我来说效果更好。

```
Regex rx = new Regex(@"\\[uU]([0-9A-Fa-f]{4})");
result = rx.Replace(result, match => ((char) Int32.Parse(match.Value.Substring(2), NumberStyles.HexNumber)).ToString()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-12-02T10:22:04.287

将`UnicodeExtensions.cs`类添加到您的项目中：

```
public static class UnicodeExtensions
{
    private static readonly Regex Regex = new Regex(@"\\[uU]([0-9A-Fa-f]{4})");

    public static string UnescapeUnicode(this string str)
    {
        return Regex.Replace(str,
            match => ((char) int.Parse(match.Value.Substring(2),
                NumberStyles.HexNumber)).ToString());
    }
} 
```

用法：

```
var test = "\\u0074\\u0068\\u0069\\u0073 \\u0069\\u0073 \\u0074\\u0065\\u0073\\u0074\\u002e";
var output = test.UnescapeUnicode();   // output is => this is test. 
```

# php - 如何从 $_POST 获取键值？

> ID：183914
> 
> 赞同：21
> 
> 时间：2008-10-08T17:33:08.153
> 
> 标签：php, arrays

```
echo $_POST["name"]; //returns the value a user typed into the "name" field 
```

我希望能够返回密钥的文本。在此示例中，我想返回文本“名称”。我可以这样做吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-08T18:18:53.613

$_POST 只是一个普通的关联数组，所以你也可以像这样循环整个事情：

```
foreach($_POST as $key=>$value)
{
  echo "$key=$value";
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-08T17:34:38.057

假设这是 PHP，请查看 array_keys() 函数。

[http://us2.php.net/array_keys](http://us2.php.net/array_keys)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-07-16T11:45:32.907

@Tim：`)`失踪了。所以应该是：

```
while( list( $field, $value ) = each( $_POST )) {
   echo "<p>" . $field . " = " . $value . "</p>\n";
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-04T08:50:41.197

```
while( list( $field, $value ) = each( $_POST )) {
   echo "<p>" . $field . " = " . $value . "</p>\n";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-15T10:55:10.670

```
foreach($_POST as $rvar)
{
 $rvarkey=key($_POST)
 $$rvarkey=mysql_real_escape_string($rvar);
}

it creates variables having the name of the request parameters which is pretty awesome. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T17:33:41.427

```
array_keys($_POST) 
```

[手动的](http://de.php.net/array_keys)

# php - 使用 mod_rewrite RewriteRule 重写所有查询以不需要 .php 扩展名

> ID：183921
> 
> 赞同：6
> 
> 时间：2008-10-08T17:34:08.900
> 
> 标签：php, url, mod-rewrite, friendly-url

我想要所有的查询

```
http://mysite.com/something/otherthing?foo=bar&x=y 
```

改写为

```
http://mysite.com/something/otherthing.php?foo=bar&x=y 
```

换句话说，只需将 .php 扩展名设为可选，普遍适用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-20T19:57:26.847

我会这样做。基本上，如果文件不存在，请尝试将 .php 添加到其中。

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)$ $1.php [QSA,L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:49:09.477

这有效：

```
RewriteCond %{QUERY_STRING} ^.+$
RewriteRule ^/?([^/\.]+)$ /$1.php [L] 
```

这个想法是确保有一个查询字符串（问号加东西），如果有，检查问号之前的东西是否没有扩展名，如果有，附加.php。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T19:49:42.697

如果您可以更改 httpd.conf 和内容，您还可以输入：

```
ForceType application/x-httpd-php 
```

在文件中，因为它将强制所有调用的路径都是 PHP 文件。我认为这也适用于查询字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T17:37:27.753

就像是...

```
RewriteRule /something/(.+)?(.+) /something/$1.php?$2 
```

可能会工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-10T07:00:53.437

仅匹配没有扩展名的路径：

```
RewriteRule ^(([^/]+/+)*[^\.]+)$ $1.php 
```

编辑：在我的测试中，查询字符串会自动传递。如果没有，您可以改用它：

```
RewriteCond %{QUERY_STRING} ^(.*)$
RewriteRule ^(([^/]+/+)*[^\.]+)$ $1.php?%1 
```

# c# - 编译器无法转换受约束的泛型类型

> ID：183923
> 
> 赞同：2
> 
> 时间：2008-10-08T17:34:28.417
> 
> 标签：c#, generics, casting, constraints

我有一个具有通用类型“G”的类

在我的班级模型中，我有

```
public class DetailElement : ElementDefinition 
```

假设我有这样的方法

```
 public void DoSomething<G>(G generic)
            where G : ElementDefinition
        {
            if (generic is DetailElement)
            {
                ((DetailElement)generic).DescEN = "Hello people"; //line 1
                //////
                ElementDefinition element = generic;
                ((DetailElement)element).DescEN = "Hello again"; //line 3
                //////
                (generic as DetailElement).DescEN = "Howdy"; //line 5
            }
            else
            {
                //do other stuff
            }
        } 
```

编译器在第 1 行报告一个错误：

```
Cannot convert type 'G' to 'DetailElement' 
```

但是第 3 行工作正常。我可以通过执行第 5 行中编写的代码来解决这个问题。

**我想知道的是为什么编译器会在第 1 行报告错误，而不是在第 3 行报告错误，因为据我所知，它们是相同的。**

编辑：恐怕我可能会遗漏一些重要的框架逻辑

edit2：虽然编译器错误的解决方案很重要，但我的问题是为什么编译器在第 1 行而不是在第 3 行报告错误。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T17:43:16.527

如果`G`被限制为`DetailElement`( `where G : DetailElement`)，那么您可以继续`G`转换为 ElementDefinition，即“ `(ElementDefinition) generic`”。但是因为`G`可能是运行时`ElementDefinition`以外`DetailElement`的另一个子类，所以它不允许在类型未知且无法验证的编译时使用它。

**在第 3 行中，您从中转换的类型*已知*为 an `ElementDefinition`，因此您所做的只是 up-cast**。编译器不知道它是否会在运行时成功转换，但它会在那里信任你。编译器对泛型不太信任。

第*`as`*5 行中的运算符也可能返回 null 并且编译器不会静态检查类型以查看它在这种情况下是否安全。您可以使用`as`任何*类型*，而不仅仅是与`ElementDefinition`.

从*[我可以转换到泛型类型参数和从泛型类型参数转换吗？](http://msdn.microsoft.com/en-us/library/aa479858.aspx#bestpractices_topic5 "泛型常见问题解答：最佳实践")*在 MSDN 上：

> 编译器只允许您将泛型类型参数隐式转换为对象或约束指定的类型。
> 
> 这种隐式转换当然是类型安全的，因为在编译时会发现任何不兼容性。
> 
> 编译器将允许您将泛型类型参数显式转换为任何接口，但不能转换为类：
> 
> ```
>  interface ISomeInterface {...}
>    class SomeClass {...}
>    class MyClass<T> 
>     {
>       void SomeMethod(T t)
>        {
>          ISomeInterface obj1 = (ISomeInterface)t;//Compiles
>          SomeClass      obj2 = (SomeClass)t;     //Does not compile
>        }
>     } 
> ```
> 
> 但是，您可以使用临时对象变量强制将泛型类型参数强制转换为任何其他类型
> 
> ```
>  void SomeMethod<T>(T t) 
>   { object temp = t;
>     MyOtherClass obj = (MyOtherClass)temp;  
>   } 
> ```
> 
> 不用说，这种显式转换是危险的，因为如果使用的具体类型而不是泛型类型参数不是从您显式转换为的类型派生的，它可能会在运行时引发异常。
> 
> `is`一个更好的方法是使用or运算符，而不是冒着抛出异常的风险`as`。如果`is`泛型类型参数是查询类型，则运算符返回 true，`as`如果类型兼容，则执行强制转换，否则返回 null。
> 
> ```
> public void SomeMethod(T t)
>  {
>    if(t is int) {...}
> 
>    string str = t as string;
>    if(str != null) {...}
>  } 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:42:38.010

您的 where 子句不应该是“where G : DetailElement”吗？

在您编写的代码中，DetailElement 是 ElementDefinition，但 ElementDefinition 不一定是 DetailElement。所以隐式转换是非法的。

您是否可以将其他类型的 ElementDefinition 传递给此方法？如果是这样，当您尝试将它们转换为 DetailElement 实例时，它们将引发异常。

编辑：

好的，既然您已经更改了代码清单，我可以看到您正在检查类型以确保在输入该代码块之前它确实是一个 DetailElement。不幸的是，事实是你不能隐式地向下转型，即使你已经自己检查了类型。我认为您真的应该在块的开头使用“as”关键字：

```
DetailElement detail = generic as DetailElement;
if (detail == null) {
   // process other types of ElementDefinition
} else {
   // process DetailElement objects
} 
```

更好的是，为什么不使用多态性让每种 ElementDefinition 定义自己的 DoSomething 方法，让 CLR 为您处理类型检查和方法调用？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T19:13:26.220

通常，向上转换是一种代码味道。您可以通过方法重载来避免它。试试这个：

```
public void DoSomething(DetailElement detailElement)
{
    // do DetailElement specific stuff
}

public void DoSomething<G>(G elementDefinition)
    where G : ElementDefinition
{
    // do generic ElementDefinition stuff
} 
```

然后，您可以使用以下代码来利用方法重载：

```
DetailElement foo = new DetailElement();

DoSomething(foo); // calls the non-generic method
DoSomething((ElementDefinition) foo); // calls the generic method 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T18:37:55.510

如果您有很多担心的 ElementDefinitions，这将导致更多的代码，但可能是您将得到的不涉及的最巧妙的代码，那就是胡说八道。

```
 public void DoSomething<G>(G generic)
        where G : ElementDefinition
    {
        DetailElement detail = generic as DetailElement;
        if (detail != null)
        {
            detail.DescEN = "Hello people";
        }
        else
        {
            //do other stuff
        }
    } 
```

当我需要此类信息时，我在临时对象变量中使用了另一种可能的解决方案。

```
DetailElement detail = (DetailElement)(object)generic; 
```

它有效，但 as 形式可能是最好的。

# winapi - 哪些 Win32 API 可用于查找打开给定文件的进程？

> ID：183925
> 
> 赞同：12
> 
> 时间：2008-10-08T17:34:51.003
> 
> 标签：winapi, api, file

如果我读取或写入文件并收到 33 或 32 错误，我想记录一条消息，其中包含打开文件的其他进程的名称。必须有一个 Win32 API 我可以用来获取此信息。Process Explorer 显示它。当然，Process Explorer 也有关于内存中所有进程的信息。我宁愿在不询问所有进程的情况下找到罪魁祸首。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T17:46:09.220

[这](http://www.codeguru.com/Cpp/W-P/system/processesmodules/article.php/c2827/)似乎做你想做的事。

显然它使用了一些隐藏的 API，例如`NtQueryInformationProcess`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:50:11.253

[SysInternals 的 Handle 程序也能做到这一点](http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)，但我不知道怎么做。我认为没有一个记录在案的 API 可以做到这一点。我认为您必须遍历进程，枚举进程中的每个句柄，然后确定与该句柄关联的文件名。

# php - 如何让 PHP 为每个用户自动创建子域？

> ID：183928
> 
> 赞同：171
> 
> 时间：2008-10-08T17:36:51.827
> 
> 标签：php, subdomain

如何创建像[http://user.mywebsite.com](http://user.mywebsite.com)这样的子域？我必须以某种方式访问​​ htaccess 吗？实际上是否可以通过纯 php 代码创建它，或者我需要使用一些外部脚本服务器端语言？

对于那些回答的人：那么，我应该问我的主机是否提供某种 DNS 访问？

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2008-10-08T17:49:38.540

您正在寻找创建自定义**A 记录**。

我很确定您可以在指定 A 记录时使用通配符，这样您就可以执行以下操作：

```
*.mywebsite.com       IN  A       127.0.0.1 
```

*127.0.0.1 将是您的网络服务器的 IP 地址。实际添加记录的方法取决于您的主机。*

* * *

如果可以的话，像[http://mywebsite.com/user](http://mywebsite.com/user)那样设置会容易得多。

然后您可以添加一个如下所示的 .htaccess 文件：

```
Options +FollowSymLinks

RewriteEngine On
RewriteRule ^([aA-zZ])$  dostuff.php?username=$1 
```

*在上面，用户名仅限于字符 az*

* * *

获取子域的重写规则如下所示：

```
RewriteCond %{HTTP_HOST} ^(^.*)\.mywebsite.com
RewriteRule (.*)  dostuff.php?username=%1 
```

* * *

但是，您实际上并不需要任何重写规则。HTTP_HOST 标头在 PHP 中也可用，因此您已经可以获取它，例如

```
$username = strtok($_SERVER['HTTP_HOST'], "."); 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2010-09-01T11:22:17.587

您所追求的功能称为[通配符子域](http://www.google.com.au/search?sourceid=chrome&ie=UTF-8&q=wildcard+subdomains)。它允许您不必为每个子域设置 DNS，而是使用 apache 重写进行重定向。[你可以在这里](http://steinsoft.net/static/archive/2014/steinsoft.net/index5d37.html?site=Programming/Articles/apachewildcarddomain)找到一个不错的教程，但是那里有成千上万的教程。这是该教程中的必要代码：

```
<VirtualHost 111.22.33.55>
    DocumentRoot /www/subdomain
    ServerName www.domain.tld
    ServerAlias *.domain.tld
</VirtualHost> 
```

然而，由于它需要使用 VirtualHosts，它必须在服务器的 httpd.conf 文件中设置，而不是本地的 .htaccess。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-08T18:39:01.093

我做的和马克有点不同。我传递整个域并在 php.ini 中获取子域。

```
RewriteCond {REQUEST_URI} !\.(png|gif|jpg)$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ /index.php?uri=$1&hostName=%{HTTP_HOST} 
```

这会忽略图像并将其他所有内容映射到我的 index.php 文件。所以如果我去

```
http://fred.mywebsite.com/album/Dance/now 
```

我回来

```
http://fred.mywebsite.com/index.php?uri=album/Dance/now&hostName=fred.mywebsite.com 
```

然后在我的 index.php 代码中，我只是将我的用户名从主机名中分离出来。这给了我漂亮漂亮的 SEO URL。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-03-02T15:12:17.457

我们像上面解释的那样设置通配符 DNS。所以记录是 *.yourname.com

然后所有的子域实际上都去同一个地方，但是 PHP 将每个子域视为不同的帐户。

我们使用以下代码：

```
$url=$_SERVER["REQUEST_URI"];
$account=str_replace(".yourdomain.com","",$url); 
```

此代码只是将`$account`变量设置为与子域相同。然后，您可以根据他们的帐户检索他们的文件和其他信息。

这可能不如他们上面列出的方法那么有效，但是如果您无权访问 BIND 和/或有限的 .htaccess，则此方法应该可以工作（只要您的主机将为您设置通配符）。

我们实际上使用这种方法连接到客户数据库以用于多公司电子商务应用程序，但它也可能对您有用。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-08T23:02:46.723

[当您可以使用Apache 大规模虚拟主机](http://httpd.apache.org/docs/2.0/vhosts/mass.html)时，不要对 .htaccess 文件大惊小怪。

从文档中：

> `#include part of the server name in the filenames VirtualDocumentRoot /www/hosts/%2/docs`

在某种程度上，这与您的问题相反：每个“子域”都是用户。如果用户不存在，则会收到 404。

唯一的缺点是环境变量`DOCUMENT_ROOT`没有正确设置为*used*子目录，而是de htconfig中默认的document_root。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-12-23T19:55:07.697

用于子域和多域 Web 应用程序的简单 PHP 解决方案

步骤 1\. 为您要服务“example.org”的域（或域）提供 DNS A 记录作为“*”

```
A record => *.example.org
A record => *.example.net 
```

步骤 2\. 在用户注册或更改登录时检查登录的唯一性。此外，避免在这些登录中出现点。

步骤 3\. 然后检查查询

```
 // Request was http://qwerty.example.org
        $q = explode('.', $_SERVER['HTTP_HOST']);
        /*
            We get following array
            Array
            (
                [0] => qwerty
                [1] => example
                [2] => org
            )
        */

        // Step 4.
        // If second piece of array exists, request was for 
        // SUBDOMAIN which is stored in zero-piece $q[0]
        // otherwise it was for DOMAIN

        if(isset($q[2])) {
            // Find stuff in database for login $q[0] or here it is "qwerty"
            // Use $q[1] to check which domain is asked if u serve multiple domains
        }

?> 
```

此解决方案可能服务于不同的域

```
qwerty.example.org
qwerty.example.net 

johnsmith.somecompany.com
paulsmith.somecompany.com 
```

如果您需要在不同服务的不同域上使用相同的昵称，您可能需要在注册登录时存储域的用户选择。

```
smith.example.org // Show info about John Smith
smith.example.net // Show info about Paul Smith 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-08T17:40:01.057

除了在您的 WWW 服务器上更改配置以处理新的子域之外，您的代码还需要更改您的 DNS 记录。因此，除非您正在运行自己的 BIND（或类似的），否则您需要弄清楚如何访问您的名称服务器提供商的配置。如果他们不提供某种 API，这可能会变得很棘手。

更新：是的，我会与您的注册商核实他们是否也提供名称服务器服务（通常是这种情况）。我以前从未探索过这个选项，但我怀疑大多数消费者注册商都没有。我在 Google 上搜索了 GoDaddy API 和 GoDaddy DNS API，但无法打开任何东西，所以我想最好的选择是查看您的提供商的在线帮助，如果这不能回答问题，请稍等他们的支持人员。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-08T17:40:48.170

您可以 [可能] 重写 URL，但是可以：您必须控制您的 DNS 设置，以便在添加用户时获得自己的子域。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-04-06T18:51:11.207

这可以在`.htaccess`您的服务器配置为允许通配符子域的情况下实现。我在 JustHost 中通过创建一个手动命名的 subomain`*`并指定一个名为 subdomains 的文件夹作为通配符子域的文档根目录来实现这一点。将此添加到您的`.htaccess`文件中：

```
RewriteEngine On
RewriteCond %{HTTP_HOST} !^www\.website\.com$
RewriteCond %{HTTP_HOST} ^(\w+)\.website\.com$
RewriteCond %{REQUEST_URI}:%1 !^/([^/]+)/([^:]*):\1
RewriteRule ^(.*)$ /%1/$1 [QSA] 
```

最后，为您的子域创建一个文件夹并放置子域文件。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-08-13T10:40:31.057

我只是想补充一点，如果您使用 CloudFlare（免费），您可以使用他们的 API 轻松管理您的 dns。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-06T13:05:55.753

> 使用 PHP 和 Htaccess 创建动态子域

# (1) 根目录.htaccess

该文件将[http://www.yourwebsite.com](http://www.yourwebsite.com)重定向到[http://yourwebsite.com](http://yourwebsite.com)以供主页使用。所有子域重定向到 yourwebsite_folder

```
RewriteEngine On

RewriteCond %{HTTP_HOST} ^www.yourwebsite.com
RewriteRule (.*) http://yourwebsite.com/$1 [R=301,L]

RewriteCond %{HTTP_HOST} ^yourwebsite\.com $
RewriteCond %{REQUEST_URI} !^/yourwebsite_folder/
RewriteRule (.*) /yourwebsite_folder/$1

RewriteCond %{HTTP_HOST} ^(^.*)\.yourwebsite.com
RewriteCond %{REQUEST_URI} !^/yourwebsite_folder/
RewriteRule (.*) /yourwebsite_folder/$1 
```

# (2) 内部文件夹 .htaccess

此文件正在重写子域 url。

[http://yourwebsite.com/index.php?siteName=9lessons](http://yourwebsite.com/index.php?siteName=9lessons) 到 [http://9lessons.yourwebsite.com](http://9lessons.yourwebsite.com)

```
Options +FollowSymLinks
RewriteEngine On

RewriteBase /

RewriteRule ^([aA-zZ])$ index.php?siteName=$1
RewriteCond %{HTTP_HOST} ^(^.*)\.yourwebsite.com
RewriteRule (.*) index.php?siteName=%1 
```

更多 .htaccess 提示：[Htaccess 文件教程和提示。](https://www.9lessons.info/2013/11/htaccess-file-tutorial-and-tips.html)

# 索引.php

该文件包含简单的 PHP 代码，使用正则表达式验证子域值。

```
<?php
$siteName='';
if($_GET['siteName'] )
{
$sitePostName=$_GET['siteName'];
$siteNameCheck = preg_match('~^[A-Za-z0-9_]{3,20}$~i', $sitePostName);
   if($siteNameCheck)
   {
     //Do something. Eg: Connect database and validate the siteName.
   }
   else
  {
    header("Location: http://yourwebsite.com/404.php");
   }
}
?>
//HTML Code
<!DOCTYPE html>
<html>
<head>
<title>Project Title</title>
</head>
<body>
<?php if($siteNameCheck) { ?>
//Home Page
<?php } else { ?>
//Redirect to Subdomain Page.
<?php } ?>
</body>
</html> 
```

# 没有子域文件夹

如果您使用根目录 (htdocs/public_html) 作为项目目录，请使用以下 .htaccess 文件。

```
Options +FollowSymLinks
RewriteEngine On

RewriteBase /

RewriteCond %{HTTP_HOST} ^www.yourwebsite.com
RewriteRule (.*) http://yourwebsite.com/$1 [R=301,L]

RewriteRule ^([aA-zZ])$ index.php?siteName=$1
RewriteCond %{HTTP_HOST} ^(^.*)\.yourwebsite.com
RewriteRule (.*) index.php?siteName=%1 
```

# php - 为什么我的 PHP 会话会死掉？为什么我不能恢复它们？

> ID：183932
> 
> 赞同：2
> 
> 时间：2008-10-08T17:37:52.370
> 
> 标签：php, session, paypal

我有一个使用 PHP 和 PayPal API 的应用程序。获得付款的基本方式是，您对 PayPal 进行 Web 服务调用以获取令牌，然后使用该令牌执行浏览器重定向到 PayPal 以供用户付款。确认付款详细信息后，PayPal 将重定向回您最初在服务调用中设置的 URL。

这一切都有效，每天都有数百万人使用它，等等。

奇怪的是，当 PayPal 重定向回来时，PHP 会话消失了。这是一个[有据可查的问题](http://www.paypaldeveloper.com/pdn/board/message?board.id=sandbox&thread.id=8672)。

第一个问题：为什么会这样？两个页面都在同一个域上，都使用 HTTPS。该会话适用于所有请求，直到 PayPal 重定向回来。

链接的论坛线程建议了一种解决方法，将会话 ID 保留在 PayPal 请求中，然后稍后检索它并恢复会话。很好，只是它似乎不起作用。

我可以添加一些日志语句：

```
log(session_id()); 
```

在各种重定向之前和之后。从 PayPal 回来时，我记录了更多信息。

```
log("session id is " . session_id());
$session_id = get_session_id_from_paypal();
log("setting it back to " . $session_id);
session_id($session_id);
session_start();
log("session id is now " . session_id()); 
```

结果完全不是我所期望的：

> `session_id`是 fc8f459a186a3f4695ff9ac71b563825
> 将其设置回 82460dcf8c8ddd538466e7cb89712e72
> `session_id`现在是 360ba3fd99d233e0735397278d2b2e55

第二个问题：为什么会话 id 根本不是我设置的？我究竟做错了什么？或者，至少，为什么没有会话变量返回？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T19:21:54.627

只是一个想法...

您是否已`session.referer_check`设置为您的主机？默认值为空字符串，但它可能已被更改......当页面从 PayPal“返回”时，php 将丢弃会话信息。

您可以`session.referer_check`使用 phpinfo() 检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T17:59:35.197

你能做一个 phpinfo() 并判断 session.auto_start 是否为真吗？

# c# - 以编程方式将 ScriptManager 添加到页面？

> ID：183950
> 
> 赞同：28
> 
> 时间：2008-10-08T17:42:59.880
> 
> 标签：c#, sharepoint-2007, web-parts, scriptmanager

我正在开发一个我想在其中公开 AJAX 功能的 WebPart（它将在 SharePoint 环境中使用，尽管它不使用对象模型）。由于环境的性质，将脚本管理器直接添加到页面是不是一个选项，因此必须以编程方式添加。我试图将 ScriptManager 控件添加到我的 webpart 代码中的页面。

```
protected override void CreateChildControls()
{
    if (ScriptManager.GetCurrent(Page) == null)
    {
        ScriptManager sMgr = new ScriptManager();
        // Ensure the ScriptManager is the first control.
        Page.Form.Controls.AddAt(0, sMgr); 
    }
} 
```

但是，执行此代码时，我收到以下错误消息：

> “在 DataBind、Init、Load、PreRender 或 Unload 阶段不能修改控件集合。”

是否有另一种方法可以将 ScriptManager 从 WebPart 添加到页面，或者我是否必须将 ScriptManager 添加到将使用 WebPart 的每个页面（或母版页）？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-08T18:48:59.140

通过使用 Page 的 Init 事件，我能够让它工作：

```
protected override void OnInit(EventArgs e)
{
    Page.Init += delegate(object sender, EventArgs e_Init)
                 {
                     if (ScriptManager.GetCurrent(Page) == null)
                     {
                         ScriptManager sMgr = new ScriptManager();
                         Page.Form.Controls.AddAt(0, sMgr);
                     }
                 };
    base.OnInit(e);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-11-19T05:05:40.910

我和你们其他人有同样的基本问题。我正在创建一个自定义 ascx 控件，并且希望能够不用担心调用页面是否声明了 scriptmanager。我通过将以下内容添加到 ascx contorl 本身来解决这些问题。

**到 ascx 页面 -**

`<asp:PlaceHolder runat="server" ID="phScriptManager"></asp:PlaceHolder>`

在更新面板本身 -`oninit="updatePanel1_Init"`

**到 ascx.cs 文件 -**

```
protected void updatePanel1_Init(object sender, EventArgs e)
{
     if (ScriptManager.GetCurrent(this.Page) == null)
     {
         ScriptManager sManager = new ScriptManager();
         sManager.ID = "sManager_" + DateTime.Now.Ticks;
         phScriptManager.Controls.AddAt(0, sManager);
     }
} 
```

感谢这个线程中让我开始的所有其他人。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-05T23:27:33.127

我已经做到了，并且有效。为控件创建一个占位符：

```
<asp:PlaceHolder ID="WebGridPlaceholder" runat="server" >
</asp:PlaceHolder> 
```

然后您可以在 CreateChildControls 中执行此操作：

```
ScriptManager aSM = new ScriptManager();
aSM.ID = "GridScriptManager";
WebGridPlaceholder.Controls.Add(aSM); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-09-17T20:55:09.040

我在使用自定义 ascx 服务器控件时遇到了这个问题。我尝试了许多解决方案，包括将脚本添加到控件的 OnInit 事件（直到它检查 ScriptManager 控件之后才会执行）、在控件上的服务器标记内添加逻辑，以及在每个其他事件中添加内容。不好。我最终构建了一个继承自 ScriptManagerProxy 的控件，然后使用 ktrauberman 的一段代码，稍作修改，在需要时添加一个 ScriptManager：

```
 public class ProxiedScriptManager : ScriptManagerProxy
  {
    protected override void OnInit(EventArgs e)
    {
      //double check for script-manager, if one doesn't exist, 
      //then create one and add it to the page
      if (ScriptManager.GetCurrent(this.Page) == null)
      {
        ScriptManager sManager = new ScriptManager();
        sManager.ID = "sManager_" + DateTime.Now.Ticks;
        Controls.AddAt(0, sManager);
      }

      base.OnInit(e);
    }
  } 
```

那是为我做的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-11T17:57:17.843

这是我可以让我的更新面板在 sharepoint 2007 / 2010 兼容的 webpart 中工作的唯一方法。我们使用带有脚本管理器的 2010 母版页，但没有使用 2007 版母版页。

.ascx

```
<asp:PlaceHolder ID="sMgr_place" runat="server" />
<asp:UpdatePanel runat="server" OnInit="updatePanel_Init"><ContentTemplate>
...
</ContentTemplate></asp:UpdatePanel> 
```

.ascx.cs

```
public void updatePanel_Init(object sender, EventArgs e)
{
    if (ScriptManager.GetCurrent(Page) == null)
    {
        ScriptManager sMgr = new ScriptManager();
        sMgr.EnablePartialRendering = true;
        sMgr_place.Controls.Add(sMgr);
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-02-14T18:32:28.957

我在包含更新面板的自定义 Web 控件 (.cs) 中使用了此代码。

```
protected override void OnInit(EventArgs e)
{
    //...
    if (ScriptManager.GetCurrent(this.Page) == null)
    {
        ScriptManager scriptManager = new ScriptManager();
        scriptManager.ID = "scriptManager_" + DateTime.Now.Ticks;
        Controls.AddAt(0, scriptManager);
    }
    //...
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T02:33:44.287

我遇到了类似的问题，发现最好的方法是将全局 ScriptManager 添加到母版页，然后在后面的代码中添加：

```
ScriptManager.GetCurrent(Page).Services.Add(new ServiceReference(virtualPath)); 
```

# visual-studio-2008 - 如何在不安装 SQL Business Intelligence Development Studio 2005 的情况下让 Visual Studio 2008 编辑 SSRS 2005 报告项目？

> ID：183953
> 
> 赞同：12
> 
> 时间：2008-10-08T17:43:42.110
> 
> 标签：visual-studio-2008, sql-server-2005, reporting-services, report

我正在尝试确定如何使用 Visual Studio 2008 打开/编辑现有 SQL Server Reporting Services (SSRS) 2005 报告项目 (.rptproj) 和报告 (.rdl)，*而*无需安装 SQL Business Intelligence Development Studio (BIDS) 2005 .

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-08T19:21:13.240

你不能。检查此[论坛帖子](http://social.msdn.microsoft.com/forums/en-US/sqlreportingservices/thread/9a7a78a0-bf5c-458a-9cb0-bc82004501f7)，其中有 Microsoft 的回复。

> 是的，这是一个积极的决定，即 2008 年设计环境不支持持续向后兼容，而是单向升级。这不是一个随意的决定，可以理解它如何产生影响。

您可以阅读整个帖子，了解有关为什么无法将 VS2008 用于 SSRS 2005 项目的更多详细信息。很烦人，但我想我能理解他们为什么必须做出这个决定。我现在在我的开发机器上安装 VS2005 的唯一原因是用于 Reporting Services 项目，因为我们公司不会很快升级到 SQL Server 2008。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-17T19:36:08.223

这太荒谬了。

我们这里还在运行 SQL2005，近期没有升级的计划。鉴于经济状况，我们没有大量的现金流用于服务器升级而没有真正的充分理由。

开发人员已经能够升级到 Visual Studio 2008，但我们仍然必须在我们的机器上保留 VS2005，以便我们可以编辑旧的 SSRS 和 SSIS 包。

有一次，我们有一些开发人员在他们的机器上安装了三个版本的 Visual Studio。等不及 Visual Studio 2010 看看他们在那个版本中遗漏了什么，也许我们可以在我们的机器上拥有四个版本。这一点都不傻！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T17:51:04.810

我不确定是否可以使用 VS2008 编辑 SSRS 项目，但我知道您可以使用 SQL Server 2008 报表设计器。您也可以创建新报告和编辑旧报告。一旦您在设计器中打开它们，它将自动升级。

[http://windowsitpro.com/article/articleid/98925/sql-server-2008s-report-designer-preview.html](http://windowsitpro.com/article/articleid/98925/sql-server-2008s-report-designer-preview.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T18:04:12.753

您只是无法访问 VS2005 的副本吗？如果是这样，您可以尝试在[VS2005 Exrpess](http://www.microsoft.com/express/2005/download/default.aspx)中打开项目。不确定它是否会起作用，因为我还没有做过或没有要测试的 SSRS 项目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-04-23T11:20:22.253

```
.rptproj porject not installed error message displaying during open report project. 
```

解决方案：转到**控制面板**-> 右键单击**​​ SQl Server 2005 设置**-> 更改 ->从此设置中**安装缺少的功能**

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-06-16T19:13:27.033

哇，如果购买 VS2008 在默认情况下为您提供所有以前版本的权利，这将更容易接受。

哦，好吧，互联网、eula、企业贪婪和其他美国发明万岁……

# oracle - 什么是 Oracle KGL 模拟器？

> ID：183963
> 
> 赞同：0
> 
> 时间：2008-10-08T17:47:18.233
> 
> 标签：oracle, debugging, oracleinternals

这个叫做 KGL SIMULATOR 的东西是什么？应用程序开发人员如何管理它的内存利用率？

问题的背景是我偶尔会遇到以下错误，并且想大致了解什么在使用这个堆空间？

> ORA-04031: 无法分配 4032 字节的共享内存 ("shared pool","select text from > view$ where...","sga heap(3,0)","kglsim heap")

我通过谷歌阅读了论坛帖子，暗示 kglsim 与 KGL SIMULATOR 有关，但没有该组件的定义，也没有给开发人员的任何提示。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T02:02:12.783

KGL=Kernel General Library 缓存管理器，顾名思义，它处理库对象，例如游标、缓存的存储对象定义（PL/SQL 存储过程、表定义等）。

如果缓存比当前大，KGL 模拟器用于估计缓存的好处。一般的想法是，当刷新库缓存对象时，它的哈希值（以及其他一些信息）仍然保留在 KGL 模拟器哈希表中。这存储了在内存中但被清除的对象的历史记录。

当加载一个库缓存对象（这意味着库缓存中没有现有的此类对象）时，Oracle 会检查 KGL 模拟器哈希表以查看其中是否存在具有匹配哈希值的对象。如果找到匹配的对象，则意味着所需的对象过去曾在缓存中，但由于空间压力而被刷新。

如果缓存更大（感谢 KGL 模拟器历史记录）并知道对象重新加载花费了多少时间，Oracle 可以预测多少响应时间本来是可以避免的，使用该信息可以避免多少库缓存对象（重新）加载如果共享池更大，则保存实例范围。这可以从 v$library_cache_advice 看出。

无论如何，这个错误可能是由受害者会话引发的，因为共享池空间不足。换句话说，其他人可能已经用完了所有内存（或所有足够大的块），因此 KGL sim 的分配失败。

v$sgastat 将是解决 ORA-4031 错误的第一点，您需要确定共享池中有多少可用内存（以及谁在使用大部分内存）。

-- Tanel Poder [http://blog.tanelpoder.com](http://blog.tanelpoder.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T13:57:02.393

我发现 KGL 代表“内核通用库”。

您的问题可能是 Oracle 中的内存泄漏。您可能应该打开一个 Oracle 支持的案例。

# jquery - Microsoft JSON 对象序列化是否与“正常”序列化不同？

> ID：183986
> 
> 赞同：1
> 
> 时间：2008-10-08T17:55:03.600
> 
> 标签：jquery, json

我记得听说微软必须为其 AJAX 框架实现 JSON 序列化的方式与大多数其他库不同。这是真的？如果是这样，它有什么不同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T18:00:49.517

我不确定其他任何事情，但我确实读到了他们必须做的一些修补才能使日期/时间工作（见[帖子](http://weblogs.asp.net/bleroy/archive/2008/01/18/dates-and-json.aspx)）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T23:45:04.657

有几个不同之处，两者都与安全性有关。首先是他们的 web 服务默认只接受 http POST。这样做是为了防止 JSON 劫持。您可以禁用此功能，并[在此处](http://weblogs.asp.net/scottgu/archive/2007/04/04/json-hijacking-and-how-asp-net-ajax-1-0-mitigates-these-attacks.aspx)了解更多信息。

第二个区别与返回的数据有关。如果您通过使用 [WebMethod] 属性装饰静态对象来在代码隐藏中创建 Web 服务，则返回的 JSON 将包装在对象 naemd 'd' 中。这是为了防止[JSON 数组构造函数攻击](http://www.google.com/search?q=JSON+array+object+constructor+attack)。

是的，虽然这些代表了正确的事情 (tm)，但它们会使与第三方库的交互变得困难。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T10:44:57.663

正如@Chris 所说，除了 Dates 的处理方式之外，没有什么特别的。JSON 规范没有将日期序列化的本地方式。

如果您的 JSON 字符串中没有返回任何日期，您可以使用您想要的任何*反序列化器*。MS AJAX 很好，因为它确实有办法首先验证 JSON 字符串是否有效。

# c++ - 在取消引用指针的地址上设置 Visual Studio 2005 中的数据断点

> ID：183991
> 
> 赞同：4
> 
> 时间：2008-10-08T17:55:41.680
> 
> 标签：c++, c, visual-studio-2005, debugging

我想知道是否有办法执行以下操作：我有一个包含一个成员的结构，该成员是指向内核分配的内存块的指针，当我将结构传递给 API 函数时（结构是 WAVEHDR，成员是保留字段。*）*

我可以在保留成员的值上设置数据断点——这本身并不是很有帮助。当断点被命中时，我想做的是取消引用存储在*reserved*中的指针，并在该指针指向的内存上设置一个新的数据断点。当该内存设置为已知值时，我希望 VisualStudio 中断。

我知道如何从宏设置断点，以及如何让 Visual Studio 在断点被击中时调用该宏，但我不知道是否可以将指针值传递给宏以便它可以设置断点在正确的地址上。UI 没有提供一种方法来做到这一点。

宏有没有办法访问有关正在运行的程序的信息，并执行诸如评估全局变量或其他表达式之类的事情？如果我可以从宏中以编程方式访问正在运行的代码（在断点期间），我可以完成我想要做的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T20:04:44.837

宏可以评估您在监视窗口中可以评估的任何内容：

```
 Dim e As EnvDTE.Expression

    e = DTE.Debugger.GetExpression("<my expression>", True)

    If e.IsValidValue Then
        ... use e.Value to do something
    End If 
```

您在 e.Value 中返回的值正是您将在监视窗口中看到的字符串，因此您可能必须将其拆开。您还可以使用 Expression 对象上的许多其他属性。请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/envdte.expression(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T19:31:28.117

我不确定这是否可能。我知道有条件断点，但这需要提前知道内存地址......

条件中断对话框中类似于 *p == 0xADDRESS 的内容。******