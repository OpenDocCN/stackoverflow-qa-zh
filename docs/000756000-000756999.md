# StackOverflow 问答 000756000-000756999

# xlink - 用于 XBRL 或 XLINK 的 .NET 库

> ID：756013
> 
> 赞同：3
> 
> 时间：2009-04-16T12:59:07.097
> 
> 标签：xlink, xbrl

有谁知道我可以用来处理 XBRL 或 XLINK 文档的好的 .NET 库吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T14:18:33.270

[Gepsio：.NET 的 XBRL 文档对象模型](http://gepsio.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-09T23:05:16.837

我会改用[Altova XML 库](http://www.altova.com/altovaxml.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-30T11:09:41.210

有[GEPSIO](https://gepsio.codeplex.com/)开源项目。但是，GEPSIO 并不支持所有 XBRL 规范，只支持 XBRL 2.1（甚至这似乎不完整）。

还有另一个支持所有规范的商业 XBRL .NET API：[AMANA XBRL 引擎](https://amana-consulting.de/en/xbrlengine.html)

请参阅 xbrl.org 上的“工具和服务”官方列表。

# .net - 自定义 Web 控件，无法识别 ITemplate

> ID：756021
> 
> 赞同：1
> 
> 时间：2009-04-16T13:02:36.667
> 
> 标签：.net, visual-studio, custom-server-controls, itemplate

希望是一个简单的，我创建了一个扩展 System.Web.UI.WebControls.Repeater 的自定义中继器控件。我已向此控件添加了两个 ITemplate 属性，并在需要时以所需的方式添加它们。一切工作正常，但我在 Visual Studio 中遇到了识别这些新模板的问题。

当我将转发器添加到页面时，例如：

```
<my:Repeater ID="rpt" runat="server" NewProperty="This works!">
    <NewTemplate>The contents go here...</NewTemplate>
</my:repeater> 
```

一切正常（哇！），当我添加我添加的属性“NewProperty”时，可以在 Visual Studio 的 Intellisense 中按预期看到（哇！）。令人烦恼的是，虽然新的 ITemplate 无法通过 Intellisense 获得，但我必须从他们在那里的知识中回忆起这一点（嘘！）。新模板还带有“问题”下划线，并带有以下消息：

> *验证（XHTML 1.0 过渡）：不支持元素“newtemplate”。*

无论如何，这都不是一个主要问题，因为当编译自定义中继器时，模板会按照它们的需要运行，这更像是一个很烦人的问题，需要解决。

谢谢你的帮助！

史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:08:37.370

XHTML 要求元素名称以小写字母开头。HTML 不区分大小写，而 XHTML 是。

来源：[http ://www.w3.org/TR/xhtml1/#h-4.2](http://www.w3.org/TR/xhtml1/#h-4.2)

为了使该属性可见，您需要将 PersistenceMode 属性添加到您的 ITemplate 属性，如下所示：

```
[PersistenceMode(PersistenceMode.InnerProperty)]
public ITemplate NewTemplate
{
   get;
   set;
} 
```

# c# - 测试 Powershell 脚本的正确性

> ID：756022
> 
> 赞同：5
> 
> 时间：2009-04-16T13:02:43.827
> 
> 标签：c#, powershell, scripting, syntax-checking

他们无论如何都是在不执行powershell脚本的情况下测试它的正确性。我知道你可以在 unix 中做类似的事情，但找不到 powershell 的等价物。

基本上我拥有的是一个脚本存储库，其中每个脚本都与规则相关联。如果触发规则，则脚本将执行，但我需要确保脚本有效，然后再将其放入存储库。

谢谢。

嗨，好吧，不幸的是 -whatif 命令是不够的。它是我想从 C# 运行时引擎检查的脚本的语法，如果引擎规则触发，它会触发脚本。在脚本触发之前，我将规则中的 IList 值写入其中，然后触发它。但是我需要确保它在语法上是正确的，否则我将不得不依靠规则编写器来确保它们是正确的，这是我做不到的，因为很多人会编写规则，只有一个 duff 脚本会带来发动机停机。我不能这样做，因为引擎是为六西格玛正常运行时间而设计的企业级产品。

我认为这样做的方法是使用它，这是一个 v2 库。

[http://msdn.microsoft.com/en-us/library/system.management.automation.parseexception(VS.85).aspx](http://msdn.microsoft.com/en-us/library/system.management.automation.parseexception(VS.85).aspx)

我认为有一种方法可以创建一个 ScriptBlock 并在它周围放置一个 try catch 来捕获 ParseException。有人可以告诉我该怎么做。这正在成为一个真正的挑战。

谢谢。

嘿，好吧，我与 MS 中的一个人（他是 sharepoint pm）进行了交谈，他与其中一个 powershell 人员交谈，他告诉我在 powershell v1 中没有真正的方法可以在不执行的情况下检查脚本的语法。所以我猜 -whatif 标志是最接近的，但不幸的是它不是静态检查器。好消息是，在 v2 中，有一种方法可以通过 Automation.PsParser 类 Tokenize 成员对输入流进行标记。这将根据 PS 语法对脚本进行标记，因此如果它是废话，它就是废话脚本。问题是 v2 还没有发布日期。

感谢帮助。鲍勃。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T13:12:55.863

你想要的东西是 prolly [whatif / confirm](http://www.computerperformance.co.uk/powershell/powershell_whatif_confirm.htm)。它直接来自 Unix 世界。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T13:07:15.487

那么，您是在要求功能正确性还是语法正确性？

从功能上讲，您需要创建一个测试用例和环境来进行测试。

从语法上讲，您正在寻找用于 powershell 的静态代码检查器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T13:51:28.610

许多 PowerShell 命令提供**-whatif**参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T16:35:51.450

我认为您需要量化“有效”对您意味着什么。这是一个模棱两可的术语，可能意味着很多事情。

如果您的意思是 perl 的语法检查，那么 PowerShell 脚本没有完全等效的 PowerShell V1。我也不确定 V2 中是否有任何内容。

您给出的描述听起来像是您想要的不仅仅是语法/“它将运行”类型检查。就像@JoHannes Rossell 所说，这不是微不足道的，而且对你正在做的事情非常具体。

前面提到的其他答案中的“whatif/confirm”方法仅适用于 PowerShell cmdlet，不适用于脚本。它们显示了该 cmdlet 会做什么，而不是语法检查。

詹姆士

# jar - weblogic.jndi.WLInitialContextFactory 类在哪里？

> ID：756029
> 
> 赞同：13
> 
> 时间：2009-04-16T13:05:35.957
> 
> 标签：jar, weblogic, jndi

尝试执行我的 jar 文件时出现异常：

```
javax.naming.NoInitialContextException: Cannot instantiate class: weblogic.jndi.WLInitialContextFactory 
[Root exception is java.lang.ClassNotFoundException: weblogic.jndi.WLInitialContextFactory] 
```

我想这是类路径上某种缺失的库。谁能告诉我缺少哪个 jar 文件？我在任何地方都找不到类 weblogic.jndi.WLInitialContextFactory ...

谢谢！

PS：我已经包含了 weblogic 10.0 jar。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-28T09:46:42.707

检查您的 server/lib/ 文件夹以找到 wliclient.jar。

使用 Weblogic 12.1.3，您可以在此处找到它：
`${INSTALL_DIR}/inventory/wlserver/server/lib/wlclient.jar`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-03T14:05:45.893

*步骤1：*

去`E:\weblogic81\user_projects\domains\mydomain`。然后输入`Setenv`命令。如下

```
E:\weblogic81\user_projects\domains\mydomain>setenv 
```

*第2步：*

`Weblogic.jar`您的客户端应用程序需要该文件。它可能包含在以下路径`E:\weblogic81\weblogic81\server\lib\weblogic.jar`中。因此设置此文件夹的类路径或将此 weblogic.jar 文件复制到您的应用程序文件夹中，以便您的应用程序首先可以使用 weblogic.jar 文件。

```
E:\weblogic81\user_projects\domains\mydomain>set CLASSPATH=%CLASSPATH%;E:\weblogic81\weblogic81\server\lib;. 
```

*第 3 步：*

如上所示，在命令提示符中转到域文件夹并设置类路径。为了不打扰其他类路径，请将类路径设置为：

```
set CLASSPATH=%CLASSPATH%;E:\weblogic81\weblogic81\server\lib;. 
```

这里 ( `.`) 点表示将类路径设置为当前目录。

*第4步：*

类路径设置后运行命令STARTWEBLOGIC如下：

```
E:\weblogic81\user_projects\domains\mydomain>STARTWEBLOGIC 
```

*第 5 步：*

不要登录到 weblogic 服务器。如果您已经登录，只需注销并在 myeclipse 或其他一些 IDE 中编写以下代码。

*第 6 步：*

```
package directory.service;
import java.util.*;
import weblogic.jndi.*;
import java.io.FileInputStream;
import javax.naming.*;
public class GetInitContext {

    /**
     * @param args
     */

    public static void main(String[] args) {

        try{
        weblogic.jndi.Environment env=new weblogic.jndi.Environment();
    weblogic.jndi.Environment environment = new weblogic.jndi.Environment();
        environment.setInitialContextFactory(
          weblogic.jndi.Environment.DEFAULT_INITIAL_CONTEXT_FACTORY);
        env.setProviderUrl("t3://localhost:7001");
        env.setSecurityPrincipal("agni");
        env.setSecurityCredentials("agnidevam");
        Context context=env.getInitialContext();
        System.out.println("got the initial context for weblogic server---> "+context);
        context.createSubcontext("sone");
        context.bind("agni one",new Integer(10));
        context.createSubcontext("sone/sctwo");
        context.bind("agni two",new Integer(20));
        context.createSubcontext("sone/sctwo/scthree");
        context.bind("agni three",new Integer(30));
        System.out.println("subcontex object created please check in admin server for more details");

        }
        catch(Exception e){
            System.out.println("file inputstream exception  ---> "+e);
        }
    }

} 
```

*第 7 步：*

执行上面的代码，登录weblogic，右键`myserver>view jndi tree>`找到绑定​​的对象信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-08T15:00:46.170

Check the following tag in your build.xml

property name="WLS_HOME" value="${env.WLS_HOME}"

where WLS_HOME=c:\weblogic\wls\wlserver if running on windows i kept trying to run a simple hello world program and it kept throwing

*run:

```
 [echo] Executing client class  
 [java] javax.naming.NoInitialContextException: Cannot instantiate class: weblogic.jndi.WLInitialContextFactory [Root exception is java.lang.ClassNotFoundException: weblogic.jndi.WLInitialContextFactory]* 
```

once i changed the above mentioned tag it in the build.xml it worked fine

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-03-03T09:07:04.673

看起来您正在 WLS 之外进行 JNDI 查找。

您需要使用 wlfulclient.jar，或者如果您的机器安装了 WLS，则添加到您的类路径项目：WL_HOME/server/lib/weblogic.jar

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-02-26T22:36:45.450

我遇到了同样的问题，现在已经解决了:)

修复方法是，转到 WebLogic 服务器并导航到 /Oracle/Middleware/wlserver_10.3/server/lib/ 并执行以下命令。

命令：java -jar wljarbuilder.jar -profile wlfullclient5

上面的命令创建了一个 jar 文件，其中包含 WebLogic 服务器 /lib 文件夹中的所有 jar 文件，并将其放置在您的客户端 java 代码构建路径 Eclipse 和 craetes 可运行 JAR 文件中，并将这个 wlfullclient5.jar 文件也放置在 server/lib 文件夹中。

希望这可以帮助！如果您有任何问题，请告诉我。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-05-05T07:29:50.450

添加 wlserver/server/lib/weblogic.jar 就足够了。我测试它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-28T15:53:57.243

in version 12c it is located in weblogic-classes.jar in your lib directory:

C:\wls1213\wlserver\server\lib

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-07T00:29:30.017

它被打包在你的 server/lib 下的 weblogic.jar 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-07-29T02:38:03.233

我遇到了此处所述的问题，并且通过修复`WL_HOME`环境变量设法解决了问题。

在我的情况下，`wlserver_10.3`文件夹被移动到另一个驱动器（从`D`到`E`）并且进行磁盘“迁移”的人忘记将 WL_HOME 值更改为`PATH\TO\Oracle\Middleware\wlserver_10.3\common\bin`

通过修复`wlserver_10.3`我能够`JAR's`在 WebLogic上部署的路径

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-17T15:56:24.213

对于`WLS 12.2`，其中 WL_HOME 是 WebLogic 安装的 BEA 主目录

（默认`WL_HOME`为`Middleware\Oracle_Home\wlserver`）

```
%WL_HOME%\server\lib\wlclient.jar
%WL_HOME%\server\lib\wls-api.jar 
%WL_HOME%\server\lib\wls-api-part.jar 
%WL_HOME%\server\lib\wlthint3client.jar 
```

所有这些库都包含：`jar: weblogic\jndi\WLInitialContextFactory.class`

请参阅 WLS 文档：[https ://docs.oracle.com/en/middleware/fusion-middleware/weblogic-server/12.2.1.4/wlprg/overview.html#GUID-FC14CC53-DE49-456F-B54C-D73CC6DBF818](https://docs.oracle.com/en/middleware/fusion-middleware/weblogic-server/12.2.1.4/wlprg/overview.html#GUID-FC14CC53-DE49-456F-B54C-D73CC6DBF818)

# c# - 使用程序集中的 Web 应用程序版本号 (ASP.NET/C#)

> ID：756031
> 
> 赞同：56
> 
> 时间：2009-04-16T13:06:35.487
> 
> 标签：c#, .net, asp.net, reflection, assemblies

如何在引用的程序集中获取调用 Web 应用程序的版本号？

我试过使用 System.Reflection.Assembly.GetCallingAssembly().GetName() 但它只是给了我动态编译的程序集（返回版本号 0.0.0.0）。

**更新：就我而言，我需要一个不需要引用回 Web 应用程序程序集中的类的解决方案。下面杰森的回答（标记为已接受）满足了这一要求——这里提交的许多其他人都没有。**

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2011-01-26T10:21:54.197

这是我使用的一些代码，它支持从 Web 或非 Web 应用程序获取应用程序的“主”程序集，然后您可以使用 GetName().Version 来获取版本。

它首先为非 Web 应用程序尝试 GetEntryAssembly()。这在 ASP.NET 下返回 null。然后它查看 HttpContext.Current 以确定这是否是一个 Web 应用程序。然后它使用当前 HttpHandler 的类型 - 但如果调用是从 ASPX 页面进行的，则此类型的程序集可能是生成的 ASP.NET 程序集，因此它会遍历 HttpHandler 的 BaseType 链，直到找到不在其中的类型ASP.NET 为其生成的类型（“ASP”）使用的命名空间。这通常是主程序集中的一种类型（例如，代码隐藏文件中的页面）。然后我们可以使用该类型的程序集。如果所有其他方法都失败，则回退到 GetExecutingAssembly()。

这种方法仍然存在潜在问题，但它适用于我们的应用程序。

```
 private const string AspNetNamespace = "ASP";

    private static Assembly getApplicationAssembly()
    {
        // Try the EntryAssembly, this doesn't work for ASP.NET classic pipeline (untested on integrated)
        Assembly ass = Assembly.GetEntryAssembly();

        // Look for web application assembly
        HttpContext ctx = HttpContext.Current;
        if (ctx != null)
            ass = getWebApplicationAssembly(ctx);

        // Fallback to executing assembly
        return ass ?? (Assembly.GetExecutingAssembly());
    }

    private static Assembly getWebApplicationAssembly(HttpContext context)
    {
        Guard.AgainstNullArgument(context);

        object app = context.ApplicationInstance;
        if (app == null) return null;

        Type type = app.GetType();
        while (type != null && type != typeof(object) && type.Namespace == AspNetNamespace)
            type = type.BaseType;

        return type.Assembly;
    } 
```

更新：我已将此代码汇总到[GitHub](https://github.com/laazyj/ApplicationAssemblyUtility)和[NuGet](https://nuget.org/packages/ApplicationAssemblyUtility)上的一个小项目中。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-11-02T06:55:07.180

我发现获取“主”程序集（而不是动态程序集）版本的最简单的单行方法是：

```
typeof(MyMainClass).Assembly.GetName().Version 
```

使用您的顶级类，它不太可能“改变其含义”或作为重构工作的一部分被替换，如`MyMainClass`. 您知道这个类是在哪个程序集中定义的，并且不会再混淆版本号的来源。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-04-16T13:10:04.700

我更喜欢 Web.Config 来存储站点的当前版本。

您还可以尝试在 Web 应用程序根目录中创建一个 AssemblyInfo.cs 文件，该文件具有以下内容：

```
using System.Reflection;
using System.Runtime.CompilerServices;
...
[assembly: AssemblyVersion("1.0.*")]
... 
```

然后通过如下代码访问该值：

```
System.Reflection.Assembly.GetExecutingAssembly() 
```

这是有关 AssemblyInfo 类的更多[信息。](https://msdn.microsoft.com/en-us/library/microsoft.visualbasic.applicationservices.assemblyinfo%28v=vs.110%29.aspx)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-01-07T21:05:49.317

添加到已经发布的响应者中。为了在 ASP.Net Web 应用程序中获取程序集版本，您需要在代码隐藏文件中放置一个方法，类似于：

```
protected string GetApplicationVersion() {
    return System.Reflection.Assembly.GetExecutingAssembly().GetName().Version.ToString();
} 
```

在你想要显示版本号的 ASPX 页面中，只需放置：

```
<%= GetApplicationVersion() %> 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-08-27T20:16:55.850

以防万一有人仍然感兴趣；这应该可以解决问题，并且应该比仅仅使用`BaseType`of`ApplicationInstance`来实现 Global.asax 更安全。

Global.asax 始终与 AssemblyInfo.cs 中的程序集属性编译到相同的程序集中，因此这应该适用于定义 Global.asax 的所有 Web 应用程序。

对于那些没有定义自己的 Global.asax 的人，它将回退到生成`global_asax`类型的版本，始终为 0.0.0.0，对于不是 Web 应用程序的应用程序，它根本不返回任何版本.

奖金; 使用`BuildManager`该类*不需要*活动`HttpContext`实例，这意味着您也应该能够从应用程序启动代码中使用它。

```
public static Version GetHttpApplicationVersion() {
  Type lBase = typeof(HttpApplication);
  Type lType = BuildManager.GetGlobalAsaxType();

  if (lBase.IsAssignableFrom(lType))
  {
    while (lType.BaseType != lBase) { lType = lType.BaseType; }
    return lType.Assembly.GetName().Version;
  }
  else
  {
    return null;
  }
} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-01-24T15:26:41.293

HttpContext.Current.ApplicationInstance 派生自 global.asax.cs 中的类。您可以执行以下操作

```
 var instance = HttpContext.Current.ApplicationInstance;
 Assembly asm = instance.GetType().BaseType.Assembly;
 System.Version asmVersion = asm.GetName().Version; 
```

它适用于 ASP.NET (ASPX) 和 ASP.NET MVC

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-10-18T14:33:41.743

我遇到了类似的问题，并认为您可能会发现该解决方案很有用。

我需要从自定义服务器控件报告当前应用程序版本（Web 应用程序项目），其中服务器控件包含在不同的库中。问题是“最简单的”装配吸气剂没有提供正确的装配。

*   `Assembly.GetExecutingAssembly()`返回包含控件的程序集；不是应用程序程序集。
*   `Assembly.GetCallingAssembly()`根据我在调用树中的位置返回不同的程序集；通常是 System.Web，有时是包含控件的程序集。
*   `Assembly.GetEntryAssembly()`返回`null`。
*   `new StackTrace().GetFrames()[idx].GetMethod().DeclaringType.Assembly`在 index 处的堆栈跟踪中检索帧的组装`idx`；然而，除了不优雅、昂贵且容易在帧索引上计算错误之外，堆栈跟踪可能*不包含*对应用程序程序集的任何调用。
*   `Assembly.GetAssembly(Page.GetType())`给我打分`App_Web_@#$@#$%@`包含动态生成的页面的程序集。当然，动态页面从我的应用程序程序集中继承了一个类，因此导致了最终的解决方案：

* * *

```
Assembly.GetAssembly(Page.GetType().BaseType) 
```

使用手头的程序集引用，您可以通过其名称钻取到版本：

```
var version = Assembly.GetAssembly(Page.GetType().BaseType)
                      .GetName()
                      .Version; 
```

* * *

现在，此解决方案有效，因为我从应用程序程序集中引用了一个类型。我们不使用任何*不*从后面的代码继承的页面，因此它恰好对我们有效，但如果您的组织的编码实践不同，您的里程可能会有所不同。

快乐编码！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-08-25T08:40:33.630

```
Version version = new Version(Application.ProductVersion);
string message = version.ToString(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-10T18:37:47.710

这里的一些信息：[http ://www.velocityreviews.com/forums/showpost.php?p=487050&postcount=8](http://www.velocityreviews.com/forums/showpost.php?p=487050&postcount=8)

> 在 asp.net 2.0 中，每个页面都内置在自己的程序集中，因此只有 AssemblyInfo.cs 内置的 dll 才会返回正确答案。只需向 AssemblyInfo.cs 添加一个返回版本信息的静态方法，然后从您的其他页面调用此方法。
> 
> -- 布鲁斯 (sqlwork.com)

但我写了一个简单的方法来做到这一点：

```
 public static string GetSystemVersion(HttpServerUtility server)
    {
        System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
        doc.Load(server.MapPath("~/web.config"));
        System.Xml.XmlNamespaceManager ns = new System.Xml.XmlNamespaceManager(doc.NameTable);
        ns.AddNamespace("bla", "http://schemas.microsoft.com/.NetConfiguration/v2.0");

        System.Xml.XmlNode node = doc.SelectSingleNode("/bla:configuration/bla:system.web/bla:authentication/bla:forms[@name]", ns);

        string projectName = "";
        if (node != null && node.Attributes != null && node.Attributes.GetNamedItem("name") != null)
            projectName = node.Attributes.GetNamedItem("name").Value; //in my case, that value is identical to the project name (projetname.dll)
        else
            return "";

        Assembly assembly = Assembly.Load(projectName);
        return assembly.GetName().Version.ToString();
    } 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-25T17:26:49.923

如果您正在从 Web 控件中查找此内容，则一种技巧是查找代码隐藏页面的类型（即，从 System.Web.UI.Page 继承的类）。这通常在消费者的网络组件中。

```
Type current, last;
current = Page.GetType();
do
{
    last = current;
    current = current.BaseType;
} while (current != null && current != typeof(System.Web.UI.Page));
return last; 
```

我希望有更好的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-01-04T12:46:44.037

该问题指出**没有参考**（实例），它没有（最初）说不了解 Web 应用程序类型。

**编辑**OP 澄清说是的，他们确实不需要知道调用 Web 程序集中的类型，所以答案是合适的。但是，我会认真考虑重构这样的解决方案，以便将版本传递到另一个程序集中。

对于这种情况下的大多数人，如果您知道自定义 HttpApplication 类型：

```
 typeof(MyHttpApplication).Assembly.GetName().Version 
```

如果您只有动态生成的类型：

```
 typeof(DynamiclyGeneratedTypeFromWebApp).BaseType.Assembly.GetName().Version 
```

停止投票给我这个答案:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-08-28T03:22:11.743

所以，我必须从引用的 dll 中获取程序集。

在 asp.NET MVC/WebAPI 世界中，总会有至少一个类继承自`System.Web.HttpWebApplication`. 下面的实现搜索该类。

```
using System;
using System.Linq;

static Assembly GetWebAssembly() => AppDomain.CurrentDomain.GetAssemblies().FirstOrDefault(a => a.GetExportedTypes().Any(t => t.BaseType?.FullName == "System.Web.HttpApplication")); 
```

上面的使用`System.Linq`是为了找到那个关系，但是这也可以在没有的情况下实现。

首先，我们获取所有加载的程序集

```
AppDomain.CurrentDomain.GetAssemblies() 
```

然后，通过 , 枚举`IEnumerable<Assembly>`并获取直接位于程序集中的所有类型。

```
a.GetExportedTypes() 
```

然后，查看是否有任何类型继承自`System.Web.HttpWebApplication`

```
t.BaseType?.FullName == "System.Web.HttpApplication" 
```

在我的实现中，我确保这个代码只会被调用一次，但如果不能保证，我会在一个`Lazy<T>`或其他缓存的延迟加载实现中高度包装它，因为继续执行盲搜索相当昂贵。

```
using System;
using System.Linq;

// original method
private static Assembly GetWebAssembly() => AppDomain.CurrentDomain.GetAssemblies().FirstOrDefault(a => a.GetExportedTypes().Any(t => t.BaseType?.FullName == "System.Web.HttpApplication"));

// lazy load implementation
private static Lazy<Assembly> _webAssembly = new Lazy<Assembly>(GetWebAssembly);
public static Assembly WebAssembly { get => _webAssembly.Value; } 
```

# c# - c# wpf datagrid中选择所有复选框的代码

> ID：756033
> 
> 赞同：8
> 
> 时间：2009-04-16T13:07:47.763
> 
> 标签：c#, wpf, .net-3.5, datagrid, checkbox

我需要一些 c# 代码来选择/取消选择 WPF 3.5 框架中数据网格中的所有复选框。我想通过单击网格中的单个标题复选框来执行此操作。

请帮忙。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-22T02:43:07.593

这可以以声明方式完成。下面为每一行创建一个复选框列，并且可以切换行选择。可以单击复选框列的标题以选择所有行。

**xaml 中的相关部分**

```
<Window x:Class="Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:toolkit="http://schemas.microsoft.com/wpf/2008/toolkit">
    <toolkit:DataGrid Name="dataGrid" 
     ItemsSource="{Binding}" AutoGenerateColumns="True" 
     SelectionMode="Extended" CanResizeRows="False">
    <toolkit:DataGrid.RowHeaderTemplate>
       <DataTemplate>
           <Grid>
               <CheckBox IsChecked="{
                  Binding Path=IsSelected, 
                  Mode=TwoWay, 
                  RelativeSource={RelativeSource FindAncestor, 
                  AncestorType={x:Type toolkit:DataGridRow}}}"
            />
           </Grid>
       </DataTemplate>
    </toolkit:DataGrid.RowHeaderTemplate>
    </toolkit:DataGrid>
</Window> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-05T05:09:03.233

这是我们在 .Net 4.0 XAML 文件中使用的示例数据网格：

```
<DataGrid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Name="dgMissingNames" ItemsSource="{Binding Path=TheMissingChildren}" Style="{StaticResource NameListGrid}" SelectionChanged="DataGrid_SelectionChanged">
    <DataGrid.Columns>
        <DataGridTemplateColumn CellStyle="{StaticResource NameListCol}">
            <DataGridTemplateColumn.HeaderTemplate>
                <DataTemplate>
                    <CheckBox Checked="CheckBox_Checked" Unchecked="CheckBox_Unchecked" />
                </DataTemplate>                            
            </DataGridTemplateColumn.HeaderTemplate>
            <DataGridTemplateColumn.CellTemplate>                        
                <DataTemplate>
                    <CheckBox IsChecked="{Binding Path=Checked, UpdateSourceTrigger=PropertyChanged}" Name="theCheckbox"/>
                </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>                            
        </DataGridTemplateColumn>
        <DataGridTextColumn Binding="{Binding Path=SKU}" Header="Album" CellStyle="{StaticResource NameListCol}"/>
        <DataGridTextColumn Binding="{Binding Path=Name}" Header="Name" CellStyle="{StaticResource NameListCol}"/>
        <DataGridTextColumn Binding="{Binding Path=Pronunciation}" Header="Pronunciation" CellStyle="{StaticResource NameListCol}"/>
    </DataGrid.Columns>
</DataGrid> 
```

这是代码隐藏：

```
private void HeadCheck(object sender, RoutedEventArgs e, bool IsChecked)
{
    foreach (CheckedMusicFile mf in TheMissingChildren)
    {
        mf.Checked = IsChecked;
    }
    dgMissingNames.Items.Refresh();
}

private void CheckBox_Checked(object sender, RoutedEventArgs e)
{
    HeadCheck(sender, e, true);
}

private void CheckBox_Unchecked(object sender, RoutedEventArgs e)
{
    HeadCheck(sender, e, false);
} 
```

TheMissingChildren 是一个简单的对象结构，具有一些字符串属性和一个 ischecked 布尔值。

HTH。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T14:07:27.057

This is based on someone else's source that I can't recall, but we use it to help find visual children of a type. It may not be the most efficient use for this scenario but it might help get you on the right track.

```
 public static childItem FindVisualChild<childItem>(DependencyObject obj) where childItem : DependencyObject
    {
        for (int i = 0; i < VisualTreeHelper.GetChildrenCount(obj); i++)
        {
            DependencyObject child = VisualTreeHelper.GetChild(obj, i);
            if (child != null && child is childItem)
                return (childItem)child;

            childItem childOfChild = FindVisualChild<childItem>(child);
            if (childOfChild != null)
                return childOfChild;
        }
        return null;
    } 
```

[Edit 4.16.09] Based on that, try out this method. Should find all CheckBoxes and change the state as provided, callable from your event handler on the Checked/Unchecked events.

```
 public static void CheckAllBoxes(DependencyObject obj, bool isChecked)
    {
        for (int i = 0; i < VisualTreeHelper.GetChildrenCount(obj); i++)
        {
            // If a checkbox, change IsChecked and continue.
            if (obj is CheckBox)
            {
                ((CheckBox) obj).IsChecked = isChecked;
                continue;
            }

            DependencyObject child = VisualTreeHelper.GetChild(obj, i);
            CheckAllBoxes(child, isChecked);
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T20:22:13.307

我会在 WPF 中使用新的数据绑定功能。为所有复选框的 IsChecked 属性提供单向绑定，绑定源是主复选框的 IsChecked 属性。

另一种选择是使用触发器

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-04T13:50:00.507

```
DataColumn dt = null;            
        for (int i = 0; i < dataGrid.Columns.Count; i++)
        {

     dt = new DataColumn("Column Name");

            dt.DataType = typeof(Boolean);
            dt.DefaultValue = false;
             dataTable.Add(dt);
        }

dataGied.DataContext = dataTable;

<Custom:DataGrid x:Name="dataGrid" AutoGenerateColumns="True" ItemsSource="{Binding}" /> 
```

好吧，这只是一个粗略的想法，希望这可行

# sql - 检索当前和最近的先前值 (Oracle)

> ID：756036
> 
> 赞同：2
> 
> 时间：2009-04-16T13:09:12.470
> 
> 标签：sql, oracle

我面临一个我花了很多时间试图解决的问题，虽然我有一个解决方案，但它很笨重并且涉及 pl/sql 处理，我想知道其他人可能会想出什么。

我正在使用一个数据集，每次更改记录时都会创建一个新行，从而维护历史记录。然后最新版本会显示在我们的应用程序中。考虑一个包含以下数据的表：

```
个人 ID 姓氏 Address_line1 Effective_Start_Date Effective_End_Date
4913 琼斯 1 第一街 02 年 8 月 3 日 2012 年 12 月 31 日
4913 Cross 1 First Street 01-feb-02 02-aug-02
4913 Cross 86 Green Avenue 01-mar-01 31-jan-02
4913 Cross 87 Devonshire Road 01-jan-90 28-feb-02

```

作为报告的一部分，我需要提取在给定日期之间发生变化的详细信息。例如，假设我想提取当前`address_line1`和上一个`address_line1`以及更改日期（`effective_start_date`添加新地址时）。需要注意的是，如果其他列数据发生变化，这也会创建一个新行。例如，在上面的示例中，`last_name`地址更改后发生了更改。

不幸的是，查询必须是通用的，以便它可以作为报告的一部分运行，即不必明确指定有效的开始和结束日期。

希望一切都说得通。希望你们都还在我身边。因此，鉴于上面的数据集，我希望在我的报告中看到以下结果：

```
个人 ID 姓 Address_line1 Prev_Address_line1 新地址行 1 的生效开始日期
4913 琼斯 1 第一街 86 绿色大道 02 年 2 月 1 日

```

我的方法涉及使用 pl/sql 处理并循环大量记录，但我想知道这是否可以在单个 sql 查询中完成。

有没有人知道这是否可以只使用 sql 来完成？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:13:28.107

```
SELECT  personID, surname, address_line1,
        LAG(address_line1) OVER (PARTITION BY personID ORDER BY effectiveDate) AS prev_address_line1
FROM    mytable
WHERE   personID = :myid
ORDER BY
        effectiveDate 
```

要返回最后一个有效值，请使用：

```
SELECT  *
FROM    (
        SELECT  personID, surname, address_line1,
                LAG(address_line1) OVER (PARTITION BY personID ORDER BY effectiveDate) AS prev_address_line1,
                ROW_NUMBER() OVER (PARTITION BY personID ORDER BY effectiveDate DESC) AS rn,
        FROM    mytable
        WHERE   personID = :myid
        )
WHERE   rn = 1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T19:58:13.863

不完全理解您的问题。

> 作为报告的一部分，我需要提取在给定日期之间发生变化的详细信息。

相对

> 不幸的是，查询必须是通用的，以便它可以作为报告的一部分运行，即不必明确指定有效的开始和结束日期。

1) 您的报告是否提供开始日期和结束日期，并查找范围内的更改？2) 或者您是否正在寻找所有更改的一般报告，没有日期限制？

还

假设在您运行报告的一组日期内更改了姓氏。

1）在您的预期结果中，您是否完全忽略了 Last_Name 已更改的事实

2）或者那会是您报告中的另一行。

类型的

```
Person ID  Surname  Prev_Surname   Effective_Start_date_of_New Surname
4913       Jones    Cross          03-aug-02 
```

3）或者更复杂的是您将在一行中捕获所有更改。

```
Person ID  Surname  Prev_Surname   Effective_Start_date_of_New Surname Address_line1   Prev_Address_line1  Effective_Start_date_of_New_Address_Line_1 
4913       Jones    Cross          03-aug-02                           1 First Street  86 Green Avenue     01-feb-02 
```

对于显示每次更改的报告，以及以前的名称和地址值。尝试这个。您可以通过外部选择选择最后一个更改并选择 Change_rank =1

```
SELECT   PERSON_ID, CHANGED, NEW_VAL, OLD_VAL, EFFECTIVE_START_DATE
        -- The Rank just lets you pick by order of change incase you only want the last change, or last 2 changes
         ,RANK () OVER (ORDER BY EFFECTIVE_START_DATE DESC) CHANGE_RANK
    FROM (
          -- A select over Partition for each column where Old_val and New_Val need to be retrieved.
          -- In this Select the Address Column and Changed Address Are retrieved.
          SELECT PERSON_ID, 'ADDRESS_LINE1 CHANGE' CHANGED, ADDRESS_LINE1 NEW_VAL
                ,LEAD (ADDRESS_LINE1) OVER (PARTITION BY PERSON_ID ORDER BY EFFECTIVE_START_DATE DESC) AS OLD_VAL
                ,EFFECTIVE_START_DATE
            FROM TMP_RM_TEST
           -- Usually You want to run a report for a period,  Or remove this entire filter
          WHERE  EFFECTIVE_START_DATE BETWEEN TO_DATE (:REPORT_START_DATE, 'YYYYMMDD')
                                          AND TO_DATE (:REPORT_END_DATE, 'YYYYMMDD')
          UNION
          -- In this Select the Name Column and Changed Name Are retrieved.
          SELECT PERSON_ID, 'LAST_NAME CHANGE' CHANGED, LAST_NAME NEW_VAL
                ,LEAD (LAST_NAME) OVER (PARTITION BY PERSON_ID ORDER BY EFFECTIVE_START_DATE DESC) AS OLD_VAL
                ,EFFECTIVE_START_DATE
            FROM TMP_RM_TEST
           WHERE EFFECTIVE_START_DATE BETWEEN TO_DATE (:REPORT_START_DATE, 'YYYYMMDD')
                                          AND TO_DATE (:REPORT_END_DATE, 'YYYYMMDD') )
   -- Since the Partition By lists all changes over Person_ID, Irrespective of whether the Column changed, Filter to Remove Lines where no change was made to the Coloumn monitored
WHERE    NEW_VAL <> OLD_VAL
ORDER BY CHANGE_RANK 
```

# vb.net - VB.NET 如何释放打开的文件？

> ID：756039
> 
> 赞同：1
> 
> 时间：2009-04-16T13:09:31.533
> 
> 标签：vb.net

我正在打开一个名为 tempImage.jpg 的文件并将其显示在 PictureBox 中的表单上。然后我单击一个名为 Clear 的按钮，并使用 PictureBox2.Image = Nothing 从 PictureBox 中删除该文件，但是我无法删除该文件，因为它被锁定打开。我怎样才能释放它以便我可以删除它？我正在使用 VB.NET 和一个表单应用程序。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T13:13:28.467

当您使用时，`PictureBox2.Image = Nothing`您正在等待垃圾收集器在释放资源之前完成资​​源。你想立即释放它，所以你需要处理图像：

```
Image tmp = PictureBox2.Image
PictureBox2.Image = Nothing
tmp.Dispose() 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T13:12:59.980

如果您使用 Image.FromFile，则需要在图像上调用 .Dispose()。当你去清理它时，做一些类似的事情......

```
Image currentImage = pictureBox.Image

pictureBox.Image = Nothing

currentImage.Dispose() 
```

这将释放文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T13:39:42.897

控制文件

```
 'to use the image
    Dim fs As New IO.FileStream("c:\foopic.jpg", IO.FileMode.Open, IO.FileAccess.Read)
    PictureBox1.Image = Image.FromStream(fs)

    'to release the image
    PictureBox1.Image = Nothing
    fs.Close() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T17:24:05.763

是否有等效于在 vb.net 中使用

这就是我在 C# 中所做的

```
using( filestream fs = new filestream)
{

//whatever you want to do in here

}

//closes after your done 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T10:40:52.543

因为我还不能评论（没有足够的经验点），这是对上述“是否有等效于在 vb.net 中使用”的答案

是的，在 .Net 2.0 及更高版本中，您可以使用“使用”。但是，在 .Net 1.0 和 1.1 中，您需要处理 finally 块中的对象

```
 Dim fs As System.IO.FileStream = Nothing
    Try
        'Do stuff
    Finally
        'Always check to make sure the object isnt nothing (to avoid nullreference exceptions)
        If fs IsNot Nothing Then
            fs.Close()
            fs = Nothing
        End If
    End Try 
```

在 finally 块中添加流的关闭确保它无论如何都会被关闭（与打开连接相反，在流关闭之前一行代码在下面轰炸，并且流保持打开并锁定文件)

# javascript - 如何挑选以特定字符串开头的类

> ID：756043
> 
> 赞同：1
> 
> 时间：2009-04-16T13:10:50.877
> 
> 标签：javascript, jquery

这可能很难解释，但我需要一种方法来遍历我已经选择的一堆元素，并为每个元素找到以单词“icon”开头的类。所以例如我可能有以下元素

```
<div class="button iconStar"></div>
<div class="button iconPlus"></div>
<div class="button iconLeft"></div>
<div class="button iconRight"></div>
<div class="button iconUp"></div>
<div class="button iconDown"></div> 
```

所以，我首先选择元素并循环遍历它们......

```
$(".button").each(function(){
    // Some code here

}); 
```

现在，我可以将以下代码放入循环中...

```
if ($(this).hasClass("iconStar")){
    $(this).append("<IMG SRC='Images/star.gif'>");

} 
```

然后我将不得不为每个可能的图标重复这一点，这似乎非常低效。

我想在“每个”循环中做的只是循环遍历 $(this) 拥有的所有类，并挑选出以 ICON 开头的类，然后使用它来附加图像。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:31:16.223

如果您不打算将类与图像相关联，我建议不要使用类。（*这将是最正确的方法*）我会做的是在 rel 标签中放置一个指向图像的链接。

这可以满足您的要求，并且仍将验证为有效的 css。

```
<div class="button" rel="images/star.jpg">iconStar</div>
<div class="button" rel="images/plus.jpg">iconPlus</div>
<div class="button" rel="images/left.jpg">iconLeft</div>
<div class="button" rel="images/right.jpg">iconRight</div>
<div class="button" rel="images/up.jpg">iconUp</div>
<div class="button" rel="images/down.jpg">iconDown</div>
<script>
 $('.button').each(function() {
   $(this).append("<img src='"+$(this).attr('rel')+"'>");
 });
</script> 
```

请参阅此处的示例：http: [//jsbin.com/acasu](http://jsbin.com/acasu)

注意，如果你使用很多小图像，你会想要使用[CSS Sprites](http://www.alistapart.com/articles/sprites)。因为它将大大提高您页面的性能。

如果您绝对必须按照您建议的方式进行操作，您可以执行以下操作：

```
$(".button[class^='button icon']").each(function() {
   var iconSrc = $(this).attr('class').substr("button icon".length)
   $(this).append("<img src='/images/"+iconSrc+".jpg'>");
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:14:50.677

尝试使用这个选择器：

```
$(".button[class^='button icon']") 
```

这应该只选择具有类按钮的元素，并且还有一个以“图标”开头的类。

当然，这个选择器还假设你的 CSS 类总是首先以“button”而不是“icon”开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:38:33.160

对于每个元素，获取类属性的值，用''分割，取第二部分并调用图像。

从我的头顶

```
$(".button[class^='button icon']").each(function (el) {
    classStr = el.className;
    classes = classStr.split(' ');
    image = 'images/' + classes[1] + '.jpg';
}); 
```

不完全确定语法，有点生疏！

# c# - 使用 C# 截取任何外部应用程序的屏幕截图

> ID：756044
> 
> 赞同：3
> 
> 时间：2009-04-16T13:12:23.117
> 
> 标签：c#, opengl, windows-xp, directx, screenshot

我们有一个 C# (WPF) 应用程序，我们想在其中截取我们启动的任意应用程序的屏幕截图（即，我们有一个对我们启动的进程的引用）。应用程序可能被最小化或在其他窗口后面，但我们仍然只想要单个应用程序的图像，而不是重叠像素。

[我知道使用 BitBlt 或PrintWindow](http://delphi.about.com/od/delphitips2008/qt/print_window.htm)的典型 P/Invoke 解决方案大部分时间都可以工作，但在处理直接绘制到图形设备的 DirectX 或 OpenGL 应用程序时，这些解决方案会失败（我只得到黑色/透明像素）。我发现这篇[文章](http://spazzarama.wordpress.com/2009/02/07/screencapture-with-direct3d/)是关于从 C# 中截取 Direct3D 应用程序的屏幕截图，所以我想我已经涵盖了这个案例。

所以我的问题是：

1.  我将如何为 OpenGL 应用程序执行此操作？
2.  确定要使用的适当方法（PW/DX/GL）的最简单方法是什么？
3.  有没有一种通用的方法可以做到这一点？

对于#2，我是否只能检查可执行文件加载的模块并查看是否加载了 DirectX 或 OpenGL DLL/Assembly？

这只需要在 Windows XP 上运行（不是跨平台的，如果有此应用程序，也不会很快进入 Vista/7）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T20:37:20.610

对1的回答：在OpenGL中，可以调用glReadBuffer和glReadPixels来获取屏幕位图。但是，这很慢（因此您不会在每一帧都重复调用它），并且当 GL 窗口与另一个应用程序/窗口重叠时，您也可能会遇到问题。正确的方法是使用[pbuffer](http://www.opengl.org/registry/specs/ARB/wgl_pbuffer.txt)来“渲染到纹理”（google it） 。

想法 2：如果你有窗口句柄，你也许可以得到它所具有的[pixelformatdescriptor](http://msdn.microsoft.com/en-us/library/dd368826(VS.85).aspx)结构并检查它。虽然从未尝试过。

For 3：顺便说一句，我认为没有一种通用的方法可以做到这一点而没有任何问题..

# c# - Windows 应用程序出错

> ID：756046
> 
> 赞同：2
> 
> 时间：2009-04-16T13:12:44.070
> 
> 标签：c#, .net

.NET Windows 窗体和 WPF 应用程序中是否有任何全局事件，相当于 ASP.NET - Global.aspx 中的 On_Error？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:20:58.463

正如其他人所提到的，您可以使用[Application.ThreadException](http://www.pluralsight.com/community/blogs/craig/archive/2004/06/13/1455.aspx)

对于用户友好的异常处理，请查看此[链接](http://www.codeproject.com/KB/exception/ExceptionHandling.aspx)。

```
[STAThread] static void Main() {
  Application.ThreadException += new System.Threading.ThreadExceptionEventHandler(Application_ThreadException);
  Application.Run(new Form1());
}

private void button1_Click(object sender, System.EventArgs e) {
  throw new Exception("Whoops"); 
}

private static void Application_ThreadException(object sender, System.Threading.ThreadExceptionEventArgs e) {
  MessageBox.Show(e.Exception.Message); 
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T13:13:13.757

```
Application.ThreadException 
```

每当发生未处理的异常时都会引发此事件。

我主要订阅此事件，并且在事件处理程序中，我记录已发生的异常，或显示一个消息框，显示出现问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T13:24:02.653

基本上有两个选项可以全局捕获未处理的异常：

*   `Application.ThreadException`对于`Windows.Forms`（正如其他人已经指出的那样）
*   `AppDomain.CurrentDomain.UnhandledException`

以下示例程序展示了如何`UnhandledException`在 C# 中使用事件：

```
class Program
{
    static void Main(string[] args)
    {
        AppDomain.CurrentDomain.UnhandledException += new UnhandledExceptionEventHandler(CurrentDomain_UnhandledException);
    }

    static void CurrentDomain_UnhandledException(object sender, UnhandledExceptionEventArgs e)
    {
        Exception ex = (Exception)e.ExceptionObject;
        Console.WriteLine("Unhandled exception!!");
        Console.WriteLine(ex.InnerException.Message);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T13:27:36.450

除了 Application.ThreadException，您还应该处理 AppDomain.CurrentDoman.UnhandledException。我的 program.cs 文件之一的相关片段如下所示：

```
Application.ThreadException += new ThreadExceptionEventHandler(AppExceptionHandler.Application_ThreadException);
Application.SetUnhandledExceptionMode(UnhandledExceptionMode.CatchException);
AppDomain.CurrentDomain.UnhandledException += new UnhandledExceptionEventHandler(AppExceptionHandler.CurrentDomain_UnhandledException); 
```

编辑添加：这是一篇[很好的文章](http://www.switchonthecode.com/tutorials/csharp-tutorial-dealing-with-unhandled-exceptions)，可以进一步解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T13:30:14.137

对于 ASP.NET 和 WinForms 应用程序，都有 AppDomain UnhandledException 事件：

```
AddHandler AppDomain.CurrentDomain.UnhandledException, AddressOf UnhandledException 
```

在此处理程序中，您可以执行所需的任何自定义日志记录/恢复：

```
Private Sub UnhandledException(ByVal sender As Object, ByVal e As System.UnhandledExceptionEventArgs)
    Console.WriteLine(vbCrLf & "Unhandled exception:" & vbCrLf & e.ExceptionObject.ToString)
End Sub 
```

请注意，在这种情况下，您*没有*捕获或处理异常：您只是收到通知事件。除非您在事件处理程序中结束应用程序，否则异常将传播到更高级别的故障处理程序，对于 WinForms 应用程序，该处理程序通常位于操作系统中，导致熟悉的“此应用程序具有...”崩溃对话框。

# c# - 使用 Linq 加载数据表 - 将 C# 转换为 VB.Net

> ID：756050
> 
> 赞同：1
> 
> 时间：2009-04-16T13:13:12.960
> 
> 标签：c#, .net, vb.net, linq, datatable

[我在http://www.erictobia.com/2009/02/21/LoadADataTableWithLINQ.aspx](http://www.erictobia.com/2009/02/21/LoadADataTableWithLINQ.aspx) 上找到了以下示例 不幸的是，我在 VB 中需要它，并且它使用了一些我和自动代码转换器都不认识的结构。任何人都知道这应该如何用 VB.Net 编写？（问题点是“select new {...”）

```
PeopleDataSet ds = new PeopleDataSet();
using (PeopleDataContext context = new PeopleDataContext())
{
    (from p in context.Persons
     select new
                {
                    Row = ds.Person.AddPersonRow(p.Id, p.FirstName, p.LastName)
                }).ToList();

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:19:32.647

在我看来是为了使用 LINQ 而使用 LINQ 的情况。

仅针对每个上下文。人员

```
For Each p As Person In context.Persons
   ds.Person.AddPersonRow(p.Id, p.FirstName, p.LastName)
Next 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T13:24:54.290

安东尼给出了正确的答案。但是，为了记录：该`new { … }`构造可以在 VB 中表示如下：

```
Dim result = From p As Person in context.Persons _
             Select New With { _
                 .Row = ds.Person.AddPersonRow(p.Id, p.FirstName, p.LastName) _
             } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-19T09:49:54.840

```
 tbl_EmployeeDetail obj_empdetails = new tbl_EmployeeDetail();
                obj_empdetails = Connection.obj_EmployeeDataClassesDataContext.tbl_EmployeeDetails.Single(m => m.EmployeeID == Convert.ToInt32(int_EmpID));
                obj_empdetails.FirstName = str_FirstName;
                obj_empdetails.LastName = str_LastName;
                obj_empdetails.DateOfJoining = dt_DateOfJoining;
                obj_empdetails.DepartmentID = int_DepartmentID;
                obj_empdetails.Designation = str_Designation;
                obj_empdetails.ExperienceInMonths = int_ExperienceInMonths;
                obj_empdetails.salary = dec_Salary;
                Connection.obj_EmployeeDataClassesDataContext.SubmitChanges(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-03T10:42:30.897

命名空间 TestBLL { 公共静态类 ConvertToDataTable { #region "将 ObjectArray 转换为数据表"

```
 /// <summary>
    /// Method to Convert Datatable from object Array.
    /// </summary>
    /// <param name="array"></param>
    /// <returns></returns>
    public static DataTable ConvertToDatatable(this Object[] array)
    {

        PropertyInfo[] properties = array.GetType().GetElementType().GetProperties();
        DataTable dt = CreateDataTable(properties);
        if (array.Length != 0)
        {
            foreach (object o in array)
                FillData(properties, dt, o);
        }
        return dt;
    }

    /// <summary>
    /// Method To Create total column of datatable.
    /// </summary>
    /// <param name="properties"></param>
    /// <returns></returns>
    private static DataTable CreateDataTable(PropertyInfo[] properties)
    {
        DataTable dt = new DataTable();
        DataColumn dc = null;
        foreach (PropertyInfo pi in properties)
        {
            dc = new DataColumn();
            dc.ColumnName = pi.Name;
            //dc.DataType = pi.PropertyType;
            dt.Columns.Add(dc);
        }
        return dt;
    }

    /// <summary>
    /// Method for Fill data in DataTable.
    /// </summary>
    /// <param name="properties"></param>
    /// <param name="dt"></param>        
    private static void FillData(PropertyInfo[] properties, DataTable dt, Object o)
    {
        DataRow dr = dt.NewRow();
        foreach (PropertyInfo pi in properties)
        {
            dr[pi.Name] = pi.GetValue(o, null);
        }
        dt.Rows.Add(dr);
    }

    #endregion

} 
```

}

# c# - 列出字符串/整数的所有排列

> ID：756055
> 
> 赞同：182
> 
> 时间：2009-04-16T13:13:39.293
> 
> 标签：c#, algorithm, permutation

编程面试中的一项常见任务（尽管不是根据我的面试经验）是获取一个字符串或整数并列出所有可能的排列。

有没有一个例子说明这是如何完成的以及解决这个问题背后的逻辑？

我看过一些代码片段，但它们没有得到很好的评论/解释，因此很难理解。

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2009-04-16T13:22:28.210

首先：它当然闻起来像*递归*！

既然你也想知道原理，那我尽量用人的语言来解释。我认为递归在大多数时候都很容易。你只需要掌握两个步骤：

1.  第一步
2.  所有其他步骤（都具有相同的逻辑）

用**人类语言**：

> 简而言之：
> 
> 1.  1个元素的排列是一个元素。
>     
> 2.  一组元素的排列是每个元素的列表，与其他元素的每个排列连接。
>     
> 
> ***例子：***
> 
> 如果集合只有一个元素 ->
> 将其返回。
> **烫发（一）->一**
> 
> 如果集合有两个字符：对于其中的每个元素：返回元素，并添加其余元素的排列，如下所示：
> 
> *烫发（ab）->*
> 
> a + 烫发(b) -> **ab**
> 
> b +烫发（a）-> **ba**
> 
> 进一步：对于集合中的每个字符：返回一个字符，与 > 集合的其余部分的排列连接
> 
> 烫发（abc）->
> 
> a + perm(bc) --> **abc** , **acb**
> 
> b + perm(ac) --> **bac** , **bca**
> 
> c + perm(ab) --> **出租车**，**cba**
> 
> 烫发（abc...z）-->
> 
> a + 烫发(...), b + 烫发(....)
> ....

我在[http://www.programmersheaven.com/mb/Algorithms/369713/369713/permutation-algorithm-help/上找到了](http://www.programmersheaven.com/mb/Algorithms/369713/369713/permutation-algorithm-help/)**伪代码**：

```
makePermutations(permutation) {
  if (length permutation < required length) {
    for (i = min digit to max digit) {
      if (i not in permutation) {
        makePermutations(permutation+i)
      }
    }
  }
  else {
    add permutation to list
  }
} 
```

**C＃**

好的，还有更详细的内容（因为它被标记为 c#），来自[http://radio.weblogs.com/0111551/stories/2002/10/14/permutations.html](http://radio.weblogs.com/0111551/stories/2002/10/14/permutations.html)：相当冗长，但我决定复制它无论如何，所以帖子不依赖于原件。

> 该函数接受一个字符串，并写下该确切字符串的所有可能排列，例如，如果提供了“ABC”，则应该溢出：

ABC、ACB、BAC、BCA、CAB、CBA。

代码：

```
class Program
{
    private static void Swap(ref char a, ref char b)
    {
        if (a == b) return;

        var temp = a;
        a = b;
        b = temp;
    }

    public static void GetPer(char[] list)
    {
        int x = list.Length - 1;
        GetPer(list, 0, x);
    }

    private static void GetPer(char[] list, int k, int m)
    {
        if (k == m)
        {
            Console.Write(list);
        }
        else
            for (int i = k; i <= m; i++)
            {
                   Swap(ref list[k], ref list[i]);
                   GetPer(list, k + 1, m);
                   Swap(ref list[k], ref list[i]);
            }
    }

    static void Main()
    {
        string str = "sagiv";
        char[] arr = str.ToCharArray();
        GetPer(arr);
    }
} 
```

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2012-05-17T04:54:32.867

如果允许使用 LINQ，则只需两行代码。请[在此处](https://stackoverflow.com/a/10629938/1251423)查看我的答案。

**编辑**

这是我的通用函数，它可以从 T 列表中返回所有排列（不是组合）：

```
static IEnumerable<IEnumerable<T>>
    GetPermutations<T>(IEnumerable<T> list, int length)
{
    if (length == 1) return list.Select(t => new T[] { t });

    return GetPermutations(list, length - 1)
        .SelectMany(t => list.Where(e => !t.Contains(e)),
            (t1, t2) => t1.Concat(new T[] { t2 }));
} 
```

例子：

```
IEnumerable<IEnumerable<int>> result =
    GetPermutations(Enumerable.Range(1, 3), 3); 
```

输出 - 整数列表列表：

```
{1,2,3} {1,3,2} {2,1,3} {2,3,1} {3,1,2} {3,2,1} 
```

由于此函数使用 LINQ，因此它需要 .net 3.5 或更高版本。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2014-02-18T03:11:27.690

在这里，我找到了解决方案。它是用 Java 编写的，但我已将其转换为 C#。我希望它会帮助你。

![在此处输入图像描述](https://i.stack.imgur.com/F0lDq.jpg)

这是 C# 中的代码：

```
static void Main(string[] args)
{
    string str = "ABC";
    char[] charArry = str.ToCharArray();
    Permute(charArry, 0, 2);
    Console.ReadKey();
}

static void Permute(char[] arry, int i, int n)
{
    int j;
    if (i==n)
        Console.WriteLine(arry);
    else
    {
        for(j = i; j <=n; j++)
        {
            Swap(ref arry[i],ref arry[j]);
            Permute(arry,i+1,n);
            Swap(ref arry[i], ref arry[j]); //backtrack
        }
    }
}

static void Swap(ref char a, ref char b)
{
    char tmp;
    tmp = a;
    a=b;
    b = tmp;
} 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2015-09-12T23:47:19.577

**递归**不是必需的，[这里](https://stackoverflow.com/a/1506337/1486443)有关于这个解决方案的好信息。

```
var values1 = new[] { 1, 2, 3, 4, 5 };

foreach (var permutation in values1.GetPermutations())
{
    Console.WriteLine(string.Join(", ", permutation));
}

var values2 = new[] { 'a', 'b', 'c', 'd', 'e' };

foreach (var permutation in values2.GetPermutations())
{
    Console.WriteLine(string.Join(", ", permutation));
}

Console.ReadLine(); 
```

我多年来一直使用这种算法，它具有**O(N)** *时间*和*空间*复杂度来计算每个**排列**。

```
public static class SomeExtensions
{
    public static IEnumerable<IEnumerable<T>> GetPermutations<T>(this IEnumerable<T> enumerable)
    {
        var array = enumerable as T[] ?? enumerable.ToArray();

        var factorials = Enumerable.Range(0, array.Length + 1)
            .Select(Factorial)
            .ToArray();

        for (var i = 0L; i < factorials[array.Length]; i++)
        {
            var sequence = GenerateSequence(i, array.Length - 1, factorials);

            yield return GeneratePermutation(array, sequence);
        }
    }

    private static IEnumerable<T> GeneratePermutation<T>(T[] array, IReadOnlyList<int> sequence)
    {
        var clone = (T[]) array.Clone();

        for (int i = 0; i < clone.Length - 1; i++)
        {
            Swap(ref clone[i], ref clone[i + sequence[i]]);
        }

        return clone;
    }

    private static int[] GenerateSequence(long number, int size, IReadOnlyList<long> factorials)
    {
        var sequence = new int[size];

        for (var j = 0; j < sequence.Length; j++)
        {
            var facto = factorials[sequence.Length - j];

            sequence[j] = (int)(number / facto);
            number = (int)(number % facto);
        }

        return sequence;
    }

    static void Swap<T>(ref T a, ref T b)
    {
        T temp = a;
        a = b;
        b = temp;
    }

    private static long Factorial(int n)
    {
        long result = n;

        for (int i = 1; i < n; i++)
        {
            result = result * i;
        }

        return result;
    }
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2018-05-07T17:23:21.683

```
class Program
{
    public static void Main(string[] args)
    {
        Permutation("abc");
    }

    static void Permutation(string rest, string prefix = "")
    {
        if (string.IsNullOrEmpty(rest)) Console.WriteLine(prefix);

        // Each letter has a chance to be permutated
        for (int i = 0; i < rest.Length; i++)
        {                
            Permutation(rest.Remove(i, 1), prefix + rest[i]);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-10-23T00:44:50.447

C# 中稍作修改的版本，可在 ANY 类型的数组中产生所需的排列。

```
 // USAGE: create an array of any type, and call Permutations()
    var vals = new[] {"a", "bb", "ccc"};
    foreach (var v in Permutations(vals))
        Console.WriteLine(string.Join(",", v)); // Print values separated by comma

public static IEnumerable<T[]> Permutations<T>(T[] values, int fromInd = 0)
{
    if (fromInd + 1 == values.Length)
        yield return values;
    else
    {
        foreach (var v in Permutations(values, fromInd + 1))
            yield return v;

        for (var i = fromInd + 1; i < values.Length; i++)
        {
            SwapValues(values, fromInd, i);
            foreach (var v in Permutations(values, fromInd + 1))
                yield return v;
            SwapValues(values, fromInd, i);
        }
    }
}

private static void SwapValues<T>(T[] values, int pos1, int pos2)
{
    if (pos1 != pos2)
    {
        T tmp = values[pos1];
        values[pos1] = values[pos2];
        values[pos2] = tmp;
    }
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-04-16T13:25:08.173

首先，集合有排列，而不是字符串或整数，所以我假设你的意思是“字符串中的字符集”。

请注意，一组大小为 n 的集合有 n! n-排列。

以下伪代码（来自 Wikipedia），以 k = 1...n 调用！将给出所有排列：

```
function permutation(k, s) {
    for j = 2 to length(s) {
        swap s[(k mod j) + 1] with s[j]; // note that our array is indexed starting at 1
        k := k / j; // integer division cuts off the remainder
    }
    return s;
} 
```

这是等效的 Python 代码（用于基于 0 的数组索引）：

```
def permutation(k, s):
    r = s[:]
    for j in range(2, len(s)+1):
        r[j-1], r[k%j] = r[k%j], r[j-1]
        k = k/j+1
    return r 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2015-05-18T20:23:29.230

我喜欢*FBryant87*方法，因为它很简单。不幸的是，它确实像许多其他“解决方案”一样不提供所有排列或例如整数，如果它包含多次相同的数字。以656123为例。该行：

```
var tail = chars.Except(new List<char>(){c}); 
```

使用 except 将导致所有出现的事件都被删除，即当 c = 6 时，两个数字被删除，我们只剩下例如 5123。由于我尝试的解决方案都没有解决这个问题，我决定尝试通过 FBryant87 自己解决*它*代码作为基础。这就是我想出的：

```
private static List<string> FindPermutations(string set)
    {
        var output = new List<string>();
        if (set.Length == 1)
        {
            output.Add(set);
        }
        else
        {
            foreach (var c in set)
            {
                // Remove one occurrence of the char (not all)
                var tail = set.Remove(set.IndexOf(c), 1);
                foreach (var tailPerms in FindPermutations(tail))
                {
                    output.Add(c + tailPerms);
                }
            }
        }
        return output;
    } 
```

我只是使用 .Remove 和 .IndexOf 删除第一个发现的事件。似乎至少可以按我的预期工作。我相信它可以变得更聪明。

不过需要注意的一点是：结果列表可能包含重复项，因此请确保您要么让方法返回例如 HashSet，要么在返回后使用您喜欢的任何方法删除重复项。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-16T14:46:52.533

这是一个纯函数式 F# 实现：

```
 let factorial i =
    let rec fact n x =
        match n with
        | 0 -> 1
        | 1 -> x
        | _ -> fact (n-1) (x*n)
    fact i 1

let swap (arr:'a array) i j = [| for k in 0..(arr.Length-1) -> if k = i then arr.[j] elif k = j then arr.[i] else arr.[k] |]

let rec permutation (k:int,j:int) (r:'a array) =
    if j = (r.Length + 1) then r
    else permutation (k/j+1, j+1) (swap r (j-1) (k%j))

let permutations (source:'a array) = seq { for k = 0 to (source |> Array.length |> factorial) - 1 do yield permutation (k,2) source } 
```

通过更改交换以利用 CLR 数组的可变特性可以大大提高性能，但是这种实现对于源数组是线程安全的，并且在某些情况下可能是可取的。此外，对于超过 16 个元素的数组，必须将 int 替换为具有更高/任意精度的类型，因为阶乘 17 会导致 int32 溢出。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-07-04T00:50:33.863

这是一个易于理解的置换函数，可将字符串和整数作为输入。有了这个**你甚至可以设置你的输出长度**（在正常情况下它等于输入长度）

***细绳***

```
 static ICollection<string> result;

    public static ICollection<string> GetAllPermutations(string str, int outputLength)
    {
        result = new List<string>();
        MakePermutations(str.ToCharArray(), string.Empty, outputLength);
        return result;
    }

    private static void MakePermutations(
       char[] possibleArray,//all chars extracted from input
       string permutation,
       int outputLength//the length of output)
    {
         if (permutation.Length < outputLength)
         {
             for (int i = 0; i < possibleArray.Length; i++)
             {
                 var tempList = possibleArray.ToList<char>();
                 tempList.RemoveAt(i);
                 MakePermutations(tempList.ToArray(), 
                      string.Concat(permutation, possibleArray[i]), outputLength);
             }
         }
         else if (!result.Contains(permutation))
            result.Add(permutation);
    } 
```

对于***Integer***，只需更改调用者方法，*MakePermutations()*保持不变：

```
 public static ICollection<int> GetAllPermutations(int input, int outputLength)
    {
        result = new List<string>();
        MakePermutations(input.ToString().ToCharArray(), string.Empty, outputLength);
        return result.Select(m => int.Parse(m)).ToList<int>();
    } 
```

示例 1：GetAllPermutations("abc",3); “abc” “acb” “bac” “bca” “cab” “cba”

示例 2：GetAllPermutations("abcd",2); “ab” “ac” “ad” “ba” “bc” “bd” “ca” “cb” “cd” “da” “db” “dc”

示例 3：GetAllPermutations(486,2)；48 46 84 86 64 68

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-10-20T15:16:32.633

这是使用递归的 c# 中的简单解决方案，

```
void Main()
{
    string word = "abc";
    WordPermuatation("",word);
}

void WordPermuatation(string prefix, string word)
{
    int n = word.Length;
    if (n == 0) { Console.WriteLine(prefix); }
    else
    {
        for (int i = 0; i < n; i++)
        {
            WordPermuatation(prefix + word[i],word.Substring(0, i) + word.Substring(i + 1, n - (i+1)));
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2019-11-12T21:15:56.540

基于@Peter 的解决方案，这里有一个版本，它声明了一个简单的 LINQ 风格的`Permutations()`扩展方法，适用于任何`IEnumerable<T>`.

用法（以字符串字符为例）：

```
foreach (var permutation in "abc".Permutations())
{
    Console.WriteLine(string.Join(", ", permutation));
} 
```

输出：

```
a, b, c
a, c, b
b, a, c
b, c, a
c, b, a
c, a, b 
```

或在任何其他集合类型上：

```
foreach (var permutation in (new[] { "Apples", "Oranges", "Pears"}).Permutations())
{
    Console.WriteLine(string.Join(", ", permutation));
} 
```

输出：

```
Apples, Oranges, Pears
Apples, Pears, Oranges
Oranges, Apples, Pears
Oranges, Pears, Apples
Pears, Oranges, Apples
Pears, Apples, Oranges 
```

```
using System;
using System.Collections.Generic;
using System.Linq;

public static class PermutationExtension
{
    public static IEnumerable<T[]> Permutations<T>(this IEnumerable<T> source)
    {
        var sourceArray = source.ToArray();
        var results = new List<T[]>();
        Permute(sourceArray, 0, sourceArray.Length - 1, results);
        return results;
    }

    private static void Swap<T>(ref T a, ref T b)
    {
        T tmp = a;
        a = b;
        b = tmp;
    }

    private static void Permute<T>(T[] elements, int recursionDepth, int maxDepth, ICollection<T[]> results)
    {
        if (recursionDepth == maxDepth)
        {
            results.Add(elements.ToArray());
            return;
        }

        for (var i = recursionDepth; i <= maxDepth; i++)
        {
            Swap(ref elements[recursionDepth], ref elements[i]);
            Permute(elements, recursionDepth + 1, maxDepth, results);
            Swap(ref elements[recursionDepth], ref elements[i]);
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-12-19T20:09:19.527

这是将打印所有排列的函数。这个函数实现了peter解释的逻辑。

```
public class Permutation
{
    //http://www.java2s.com/Tutorial/Java/0100__Class-Definition/RecursivemethodtofindallpermutationsofaString.htm

    public static void permuteString(String beginningString, String endingString)
    {           

        if (endingString.Length <= 1)
            Console.WriteLine(beginningString + endingString);
        else
            for (int i = 0; i < endingString.Length; i++)
            {

                String newString = endingString.Substring(0, i) + endingString.Substring(i + 1);

                permuteString(beginningString + endingString.ElementAt(i), newString);

            }
    }
}

    static void Main(string[] args)
    {

        Permutation.permuteString(String.Empty, "abc");
        Console.ReadLine();

    } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-09-22T08:29:58.610

下面是我对 permutation 的实现。不要介意变量名，因为我这样做是为了好玩:)

```
class combinations
{
    static void Main()
    {

        string choice = "y";
        do
        {
            try
            {
                Console.WriteLine("Enter word :");
                string abc = Console.ReadLine().ToString();
                Console.WriteLine("Combinatins for word :");
                List<string> final = comb(abc);
                int count = 1;
                foreach (string s in final)
                {
                    Console.WriteLine("{0} --> {1}", count++, s);
                }
                Console.WriteLine("Do you wish to continue(y/n)?");
                choice = Console.ReadLine().ToString();
            }
            catch (Exception exc)
            {
                Console.WriteLine(exc);
            }
        } while (choice == "y" || choice == "Y");
    }

    static string swap(string test)
    {
        return swap(0, 1, test);
    }

    static List<string> comb(string test)
    {
        List<string> sec = new List<string>();
        List<string> first = new List<string>();
        if (test.Length == 1) first.Add(test);
        else if (test.Length == 2) { first.Add(test); first.Add(swap(test)); }
        else if (test.Length > 2)
        {
            sec = generateWords(test);
            foreach (string s in sec)
            {
                string init = s.Substring(0, 1);
                string restOfbody = s.Substring(1, s.Length - 1);

                List<string> third = comb(restOfbody);
                foreach (string s1 in third)
                {
                    if (!first.Contains(init + s1)) first.Add(init + s1);
                }

            }
        }

        return first;
    }

    static string ShiftBack(string abc)
    {
        char[] arr = abc.ToCharArray();
        char temp = arr[0];
        string wrd = string.Empty;
        for (int i = 1; i < arr.Length; i++)
        {
            wrd += arr[i];
        }

        wrd += temp;
        return wrd;
    }

    static List<string> generateWords(string test)
    {
        List<string> final = new List<string>();
        if (test.Length == 1)
            final.Add(test);
        else
        {
            final.Add(test);
            string holdString = test;
            while (final.Count < test.Length)
            {
                holdString = ShiftBack(holdString);
                final.Add(holdString);
            }
        }

        return final;
    }

    static string swap(int currentPosition, int targetPosition, string temp)
    {
        char[] arr = temp.ToCharArray();
        char t = arr[currentPosition];
        arr[currentPosition] = arr[targetPosition];
        arr[targetPosition] = t;
        string word = string.Empty;
        for (int i = 0; i < arr.Length; i++)
        {
            word += arr[i];

        }

        return word;

    }
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-08-19T15:08:37.000

这是我写的一个高级示例，它说明了彼得给出的**人类语言解释：**

```
 public List<string> FindPermutations(string input)
    {
        if (input.Length == 1)
            return new List<string> { input };
        var perms = new List<string>();
        foreach (var c in input)
        {
            var others = input.Remove(input.IndexOf(c), 1);
            perms.AddRange(FindPermutations(others).Select(perm => c + perm));
        }
        return perms;
    } 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-08-16T17:28:09.103

这是我的解决方案，我很容易理解

```
class ClassicPermutationProblem
{
    ClassicPermutationProblem() { }

    private static void PopulatePosition<T>(List<List<T>> finalList, List<T> list, List<T> temp, int position)
    {
         foreach (T element in list)
         {
             List<T> currentTemp = temp.ToList();
             if (!currentTemp.Contains(element))
                currentTemp.Add(element);
             else
                continue;

             if (position == list.Count)
                finalList.Add(currentTemp);
             else
                PopulatePosition(finalList, list, currentTemp, position + 1);
        }
    }

    public static List<List<int>> GetPermutations(List<int> list)
    {
        List<List<int>> results = new List<List<int>>();
        PopulatePosition(results, list, new List<int>(), 1);
        return results;
     }
}

static void Main(string[] args)
{
    List<List<int>> results = ClassicPermutationProblem.GetPermutations(new List<int>() { 1, 2, 3 });
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-04-14T21:20:51.897

如果性能和内存是一个问题，我建议这种非常有效的实现。根据[Wikipedia 中的 Heap 算法](https://en.wikipedia.org/wiki/Heap%27s_algorithm)，应该是最快的。希望它能满足您的需要:-)！

就像将此与 10 的 Linq 实现进行比较！（包括代码）：

*   这：36288000 个项目在 235 毫秒内
*   Linq：50051 毫秒内 36288000 个项目

    ```
    using System;
    using System.Collections.Generic;
    using System.Diagnostics;
    using System.Linq;
    using System.Runtime.CompilerServices;
    using System.Text;

    namespace WpfPermutations
    {
        /// <summary>
        /// EO: 2016-04-14
        /// Generator of all permutations of an array of anything.
        /// Base on Heap's Algorithm. See: https://en.wikipedia.org/wiki/Heap%27s_algorithm#cite_note-3
        /// </summary>
        public static class Permutations
        {
            /// <summary>
            /// Heap's algorithm to find all pmermutations. Non recursive, more efficient.
            /// </summary>
            /// <param name="items">Items to permute in each possible ways</param>
            /// <param name="funcExecuteAndTellIfShouldStop"></param>
            /// <returns>Return true if cancelled</returns> 
            public static bool ForAllPermutation<T>(T[] items, Func<T[], bool> funcExecuteAndTellIfShouldStop)
            {
                int countOfItem = items.Length;

                if (countOfItem <= 1)
                {
                    return funcExecuteAndTellIfShouldStop(items);
                }

                var indexes = new int[countOfItem];
                for (int i = 0; i < countOfItem; i++)
                {
                    indexes[i] = 0;
                }

                if (funcExecuteAndTellIfShouldStop(items))
                {
                    return true;
                }

                for (int i = 1; i < countOfItem;)
                {
                    if (indexes[i] < i)
                    { // On the web there is an implementation with a multiplication which should be less efficient.
                        if ((i & 1) == 1) // if (i % 2 == 1)  ... more efficient ??? At least the same.
                        {
                            Swap(ref items[i], ref items[indexes[i]]);
                        }
                        else
                        {
                            Swap(ref items[i], ref items[0]);
                        }

                        if (funcExecuteAndTellIfShouldStop(items))
                        {
                            return true;
                        }

                        indexes[i]++;
                        i = 1;
                    }
                    else
                    {
                        indexes[i++] = 0;
                    }
                }

                return false;
            }

            /// <summary>
            /// This function is to show a linq way but is far less efficient
            /// </summary>
            /// <typeparam name="T"></typeparam>
            /// <param name="list"></param>
            /// <param name="length"></param>
            /// <returns></returns>
            static IEnumerable<IEnumerable<T>> GetPermutations<T>(IEnumerable<T> list, int length)
            {
                if (length == 1) return list.Select(t => new T[] { t });

                return GetPermutations(list, length - 1)
                    .SelectMany(t => list.Where(e => !t.Contains(e)),
                        (t1, t2) => t1.Concat(new T[] { t2 }));
            }

            /// <summary>
            /// Swap 2 elements of same type
            /// </summary>
            /// <typeparam name="T"></typeparam>
            /// <param name="a"></param>
            /// <param name="b"></param>
            [MethodImpl(MethodImplOptions.AggressiveInlining)]
            static void Swap<T>(ref T a, ref T b)
            {
                T temp = a;
                a = b;
                b = temp;
            }

            /// <summary>
            /// Func to show how to call. It does a little test for an array of 4 items.
            /// </summary>
            public static void Test()
            {
                ForAllPermutation("123".ToCharArray(), (vals) =>
                {
                    Debug.Print(String.Join("", vals));
                    return false;
                });

                int[] values = new int[] { 0, 1, 2, 4 };

                Debug.Print("Non Linq");
                ForAllPermutation(values, (vals) =>
                {
                    Debug.Print(String.Join("", vals));
                    return false;
                });

                Debug.Print("Linq");
                foreach(var v in GetPermutations(values, values.Length))
                {
                    Debug.Print(String.Join("", v));
                }

                // Performance
                int count = 0;

                values = new int[10];
                for(int n = 0; n < values.Length; n++)
                {
                    values[n] = n;
                }

                Stopwatch stopWatch = new Stopwatch();
                stopWatch.Reset();
                stopWatch.Start();

                ForAllPermutation(values, (vals) =>
                {
                    foreach(var v in vals)
                    {
                        count++;
                    }
                    return false;
                });

                stopWatch.Stop();
                Debug.Print($"Non Linq {count} items in {stopWatch.ElapsedMilliseconds} millisecs");

                count = 0;
                stopWatch.Reset();
                stopWatch.Start();

                foreach (var vals in GetPermutations(values, values.Length))
                {
                    foreach (var v in vals)
                    {
                        count++;
                    }
                }

                stopWatch.Stop();
                Debug.Print($"Linq {count} items in {stopWatch.ElapsedMilliseconds} millisecs");

            }
        }
    } 
    ```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-01-13T02:55:48.740

这是我在 JavaScript (NodeJS) 中的解决方案。主要思想是我们一次取一个元素，从字符串中“删除”它，改变其余字符，然后在前面插入元素。

```
function perms (string) {
  if (string.length == 0) {
    return [];
  }
  if (string.length == 1) {
    return [string];
  }
  var list = [];
  for(var i = 0; i < string.length; i++) {
    var invariant = string[i];
    var rest = string.substr(0, i) + string.substr(i + 1);
    var newPerms = perms(rest);
    for (var j = 0; j < newPerms.length; j++) {
      list.push(invariant + newPerms[j]);
    }
  }
  return list;
}

module.exports = perms; 
```

以下是测试：

```
require('should');
var permutations = require('../src/perms');

describe('permutations', function () {
  it('should permute ""', function () {
    permutations('').should.eql([]);
  })

  it('should permute "1"', function () {
    permutations('1').should.eql(['1']);
  })

  it('should permute "12"', function () {
    permutations('12').should.eql(['12', '21']);
  })

  it('should permute "123"', function () {
    var expected = ['123', '132', '321', '213', '231', '312'];
    var actual = permutations('123');
    expected.forEach(function (e) {
      actual.should.containEql(e);
    })
  })

  it('should permute "1234"', function () {
    // Wolfram Alpha FTW!
    var expected = ['1234', '1243', '1324', '1342', '1423', '1432', '2134', '2143', '2314', '2341', '2413', '2431', '3124', '3142', '3214', '3241', '3412', '3421', '4123', '4132'];
    var actual = permutations('1234');
    expected.forEach(function (e) {
      actual.should.containEql(e);
    })
  })
}) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-02-22T19:00:50.487

这是我能想到的最简单的解决方案：

```
let rec distribute e = function
  | [] -> [[e]]
  | x::xs' as xs -> (e::xs)::[for xs in distribute e xs' -> x::xs]

let permute xs = Seq.fold (fun ps x -> List.collect (distribute x) ps) [[]] xs 
```

该`distribute`函数接受一个新元素`e`和一个`n`-element 列表，并返回一个列表列表，`n+1`每个列表都`e`插入到不同的位置。例如，`10`在列表的四个可能位置中的每一个插入`[1;2;3]`：

```
> distribute 10 [1..3];;
val it : int list list =
  [[10; 1; 2; 3]; [1; 10; 2; 3]; [1; 2; 10; 3]; [1; 2; 3; 10]] 
```

该`permute`函数依次折叠每个元素，分布在迄今为止累积的排列上，最终形成所有排列。例如，列表的 6 个排列`[1;2;3]`：

```
> permute [1;2;3];;
val it : int list list =
  [[3; 2; 1]; [2; 3; 1]; [2; 1; 3]; [3; 1; 2]; [1; 3; 2]; [1; 2; 3]] 
```

将 更改`fold`为 a`scan`以保留中间累加器可以阐明排列是如何一次生成一个元素的：

```
> Seq.scan (fun ps x -> List.collect (distribute x) ps) [[]] [1..3];;
val it : seq<int list list> =
  seq
    [[[]]; [[1]]; [[2; 1]; [1; 2]];
     [[3; 2; 1]; [2; 3; 1]; [2; 1; 3]; [3; 1; 2]; [1; 3; 2]; [1; 2; 3]]] 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-04-24T07:39:36.833

列出字符串的排列。当字符重复时避免重复：

```
using System;
using System.Collections;

class Permutation{
  static IEnumerable Permutations(string word){
    if (word == null || word.Length <= 1) {
      yield return word;
      yield break;
    }

    char firstChar = word[0];
    foreach( string subPermute in Permutations (word.Substring (1)) ) {
      int indexOfFirstChar = subPermute.IndexOf (firstChar);
      if (indexOfFirstChar == -1) indexOfFirstChar = subPermute.Length;

      for( int index = 0; index <= indexOfFirstChar; index++ )
        yield return subPermute.Insert (index, new string (firstChar, 1));
    }
  }

  static void Main(){
    foreach( var permutation in Permutations ("aab") )
      Console.WriteLine (permutation);
  }
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-12-31T11:09:36.700

```
 //Generic C# Method
            private static List<T[]> GetPerms<T>(T[] input, int startIndex = 0)
            {
                var perms = new List<T[]>();

                var l = input.Length - 1;

                if (l == startIndex)
                    perms.Add(input);
                else
                {

                    for (int i = startIndex; i <= l; i++)
                    {
                        var copy = input.ToArray(); //make copy

                        var temp = copy[startIndex];

                        copy[startIndex] = copy[i];
                        copy[i] = temp;

                        perms.AddRange(GetPerms(copy, startIndex + 1));

                    }
                }

                return perms;
            }

            //usages
            char[] charArray = new char[] { 'A', 'B', 'C' };
            var charPerms = GetPerms(charArray);

            string[] stringArray = new string[] { "Orange", "Mango", "Apple" };
            var stringPerms = GetPerms(stringArray);

            int[] intArray = new int[] { 1, 2, 3 };
            var intPerms = GetPerms(intArray); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-08-12T07:28:53.033

这是递归打印所有排列的函数。

```
public void Permutations(string input, StringBuilder sb)
    {
        if (sb.Length == input.Length)
        {
            Console.WriteLine(sb.ToString());
            return;
        }

        char[] inChar = input.ToCharArray();

        for (int i = 0; i < input.Length; i++)
        {
            if (!sb.ToString().Contains(inChar[i]))
            {
                sb.Append(inChar[i]);
                Permutations(input, sb);    
                RemoveChar(sb, inChar[i]);
            }
        }
    }

private bool RemoveChar(StringBuilder input, char toRemove)
    {
        int index = input.ToString().IndexOf(toRemove);
        if (index >= 0)
        {
            input.Remove(index, 1);
            return true;
        }
        return false;
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-02-23T03:35:51.603

```
class Permutation
{
    public static List<string> Permutate(string seed, List<string> lstsList)
    {
        loopCounter = 0;
        // string s="\w{0,2}";
        var lstStrs = PermuateRecursive(seed);

        Trace.WriteLine("Loop counter :" + loopCounter);
        return lstStrs;
    }

    // Recursive function to find permutation
    private static List<string> PermuateRecursive(string seed)
    {
        List<string> lstStrs = new List<string>();

        if (seed.Length > 2)
        {
            for (int i = 0; i < seed.Length; i++)
            {
                str = Swap(seed, 0, i);

                PermuateRecursive(str.Substring(1, str.Length - 1)).ForEach(
                    s =>
                    {
                        lstStrs.Add(str[0] + s);
                        loopCounter++;
                    });
                ;
            }
        }
        else
        {
            lstStrs.Add(seed);
            lstStrs.Add(Swap(seed, 0, 1));
        }
        return lstStrs;
    }
    //Loop counter variable to count total number of loop execution in various functions
    private static int loopCounter = 0;

    //Non recursive  version of permuation function
    public static List<string> Permutate(string seed)
    {
        loopCounter = 0;
        List<string> strList = new List<string>();
        strList.Add(seed);
        for (int i = 0; i < seed.Length; i++)
        {
            int count = strList.Count;
            for (int j = i + 1; j < seed.Length; j++)
            {
                for (int k = 0; k < count; k++)
                {
                    strList.Add(Swap(strList[k], i, j));
                    loopCounter++;
                }
            }
        }
        Trace.WriteLine("Loop counter :" + loopCounter);
        return strList;
    }

    private static string Swap(string seed, int p, int p2)
    {
        Char[] chars = seed.ToCharArray();
        char temp = chars[p2];
        chars[p2] = chars[p];
        chars[p] = temp;
        return new string(chars);
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-04-18T04:22:42.777

这是一个稍微简化的 C# 答案。

```
public static void StringPermutationsDemo()
{
    strBldr = new StringBuilder();

    string result = Permute("ABCD".ToCharArray(), 0);
    MessageBox.Show(result);
}     

static string Permute(char[] elementsList, int startIndex)
{
    if (startIndex == elementsList.Length)
    {
        foreach (char element in elementsList)
        {
            strBldr.Append(" " + element);
        }
        strBldr.AppendLine("");
    }
    else
    {
        for (int tempIndex = startIndex; tempIndex <= elementsList.Length - 1; tempIndex++)
        {
            Swap(ref elementsList[startIndex], ref elementsList[tempIndex]);

            Permute(elementsList, (startIndex + 1));

            Swap(ref elementsList[startIndex], ref elementsList[tempIndex]);
        }
    }

    return strBldr.ToString();
}

static void Swap(ref char Char1, ref char Char2)
{
    char tempElement = Char1;
    Char1 = Char2;
    Char2 = tempElement;
} 
```

输出：

```
1 2 3
1 3 2

2 1 3
2 3 1

3 2 1
3 1 2 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-07-05T21:40:47.630

这是提到的算法的另一种实现。

```
public class Program
{
    public static void Main(string[] args)
    {
        string str = "abcefgh";
        var astr = new Permutation().GenerateFor(str);
        Console.WriteLine(astr.Length);
        foreach(var a in astr)
        {
            Console.WriteLine(a);
        }
        //a.ForEach(Console.WriteLine);
    }
}

class Permutation
{
    public string[] GenerateFor(string s)
    {  

        if(s.Length == 1)
        {

            return new []{s}; 
        }

        else if(s.Length == 2)
        {

            return new []{s[1].ToString()+s[0].ToString(),s[0].ToString()+s[1].ToString()};

        }

        var comb = new List<string>();

        foreach(var c in s)
        {

            string cStr = c.ToString();

            var sToProcess = s.Replace(cStr,"");
            if (!string.IsNullOrEmpty(sToProcess) && sToProcess.Length>0)
            {
                var conCatStr = GenerateFor(sToProcess);

                foreach(var a in conCatStr)
                {
                    comb.Add(c.ToString()+a);
                }

            }
        }
        return comb.ToArray();

    }
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-10-10T10:59:39.237

## *基于鹏阳* [答案](https://stackoverflow.com/questions/756055/listing-all-permutations-of-a-string-integer/10630026#10630026)的基础/修订

灵感来自[permutations-in-javascript](https://stackoverflow.com/questions/9960908/permutations-in-javascript/30551462#30551462)

> c#版本*`FunctionalPermutations`*应该是这个

```
static IEnumerable<IEnumerable<T>> FunctionalPermutations<T>(IEnumerable<T> elements, int length)
    {
        if (length < 2) return elements.Select(t => new T[] { t });
        /* Pengyang answser..
          return _recur_(list, length - 1).SelectMany(t => list.Where(e => !t.Contains(e)),(t1, t2) => t1.Concat(new T[] { t2 }));
        */
        return elements.SelectMany((element_i, i) => 
          FunctionalPermutations(elements.Take(i).Concat(elements.Skip(i + 1)), length - 1)
            .Select(sub_ei => new[] { element_i }.Concat(sub_ei)));
    } 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-01-22T14:13:13.157

我希望这就足够了：

```
using System;

public class Program
{
    public static void Main()
    {
        //Example using word cat
        permute("cat");

    }

static void permute(string word){
    for(int i=0; i < word.Length; i++){
        char start = word[0];
        for(int j=1; j < word.Length; j++){
            string left = word.Substring(1,j-1);
            string right = word.Substring(j);
            Console.WriteLine(start+right+left);
        }
        if(i+1 < word.Length){
            word = wordChange(word, i + 1);
        }

    }
}

static string wordChange(string word, int index){
    string newWord = "";
    for(int i=0; i<word.Length; i++){
        if(i== 0)
            newWord += word[index];
        else if(i== index)
            newWord += word[0];
        else
            newWord += word[i];
    }
    return newWord;
} 
```

输出：

```
cat
cta
act
atc
tca
tac 
```

# java - 在执行遗留代码的 java jvm 中会发生什么，该代码因语言更改而无效

> ID：756061
> 
> 赞同：4
> 
> 时间：2009-04-16T13:16:11.393
> 
> 标签：java

假设您有旧版 java 代码，它不能被最新版本的 java 编译。例如

```
public class ProviderUnavailableException extends Exception {

    private int cause;

    public int getCause(){
        return cause;
    }
    // rest of implementation
} 
```

回到 Java 1.3 的时候，这段代码是有效的。

在 Java 1.4 中，Throwable 类“重新定义”了方法 getCause()。它看起来像这样：

```
public Throwable getCause() 
```

现在遗留代码无效（因为'int'不是'Throwable'的子类型）但不会导致运行时问题。还是在某些情况下会发生这种情况？

回到编译时间，编译器生成字节码以仅在该类中处理方法 getCause 的执行，因此“知道”不必调用任何超类，这是否正确？

编辑

我用“javap -c”检查了遗留代码的字节码。

```
 public int getCause();
    Code: 
     0: aload_0
     1: getfield #2; //Field _cause:I
     4: ireturn 
```

所以它正在返回本地字段。对我来说似乎没问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:27:07.590

在字节码中，方法通过其名称、参数类型和返回类型来引用。所以这两种方法是完全不同的。

在字节码表示法中，您的 1.3 方法将是（我认为）：

```
getCause()J 
```

而新的 1.4 方法是：

```
getCause()Ljava/lang/Throwable; 
```

您可以使用`javap -s`.

协变返回类型实际上是在编译时由 javac 使用合成桥接方法实现的。它们没有运行时支持。因此，如果您`Object run()`使用`String run()`javac 覆盖，将在派生类中创建两个方法，并`Object run()`调用`String run()`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T08:39:57.513

首先，签名更改不是语言更改。更新库不是 java 语言的语法或功能更改。您的问题与运行时后期如何绑定方法有关。最简单的验证方法是模拟相同的问题 USO g 你的类替换你自己的。

# oracle - 为什么数据库触发器在 oracle DB 中无效？

> ID：756065
> 
> 赞同：0
> 
> 时间：2009-04-16T13:17:39.017
> 
> 标签：oracle, triggers

我手动创建了一个触发器（通过将另一个 oracle 数据库中的 SQL 粘贴到管理控制台中），它自动增加表的主键，当我在对象浏览器中查看触发器时，触发器被列为无效。

为什么会这样？

这是重新创建触发器的 SQL：

```
CREATE OR REPLACE TRIGGER  "BI_AGENTEVENTDATA" 
  before insert on "AGENTEVENTDATA"               
  for each row  
begin   
    select "AGENTEVENTDATA_SEQ".nextval into :NEW.ID from dual; 
end; ;
/
ALTER TRIGGER  "BI_AGENTEVENTDATA" ENABLE
/ 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:21:02.457

您确定该序列存在并且可以被触发器使用吗？

试试这个：

```
select sequence_name from user_sequences; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:23:35.493

尝试不带 " 的触发器。换句话说：

```
CREATE OR REPLACE TRIGGER  "BI_AGENTEVENTDATA" 
  before insert on "AGENTEVENTDATA"               
  for each row  
begin   
    select AGENTEVENTDATA_SEQ.nextval into :NEW.ID from dual; 
end; ;
/
ALTER TRIGGER  "BI_AGENTEVENTDATA" ENABLE
/ 
```

# asp.net - 浏览器 IP 地址

> ID：756067
> 
> 赞同：1
> 
> 时间：2009-04-16T13:19:11.307
> 
> 标签：asp.net, ruby, ip-address

我有 2 个应用程序

1 Ruby（不是我写的。我对 Ruby 一无所知）和其他 ASP.Net

Ruby 应用程序确定用户的 IP 地址（我被告知“使用在“HTTP_X_FORWARDED”中找到的第一个 IP）并将其哈希版本传递给 ASP.Net 应用程序。

然后，ASP.Net 应用程序再次确定客户端的 IP 地址（使用 Request.UserHostAddress）并对值进行哈希处理。

然后比较哈希。

通常，这些哈希值对于我们所有的客户都是相同的（如您所料）。

但是，我们有 1 个新客户，但情况并非如此……

他工作场所的每台计算机显然都会产生不相等的哈希值

怎么会这样？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:22:59.100

这取决于他们正在通过的代理。

[X-Forwarded-For 标头](http://en.wikipedia.org/wiki/X-Forwarded-For)的Wikipedia 页面在这方面提供了丰富的信息。

如果您希望哈希匹配，您应该从同一个标头中获取数据。[`UserHostAddress`](http://msdn.microsoft.com/en-us/library/system.web.httprequest.userhostaddress.aspx)由 REMOTE_ADDR 服务器变量确定（我相信）。

# apache-flex - Flex - 垂直定位水平 HBox 的子项

> ID：756079
> 
> 赞同：2
> 
> 时间：2009-04-16T13:22:04.140
> 
> 标签：apache-flex, actionscript-3, alignment, hbox

我有一个自定义的 HBox ......

公共类 MyBar 扩展 HBox {

```
public function MyBar() {
super();

this.height = 65;
this.percentWidth = 100;

var newButton:Button = new Button();
//..... 
newButton.y = 20;

var spacer1:Spacer = new Spacer();
spacer1.percentWidth = 50;

var spacer2:Spacer = new Spacer();
spacer2.percentWidth = 50;

this.addChild(spacer1);
this.addChild(newButton);
this.addChild(spacer2);

} 
```

}

这会在 HBox 的中心显示一个按钮，但该按钮与 Box 的顶部对齐，我希望它位于中心。

我确信我之前已经像设置 y 值一样简单地进行过这项工作。但现在似乎没有工作。我正在使用 SDK 3.3

任何人都知道为什么我在这方面遇到困难？

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T13:29:43.933

设置 y 不起作用，因为 HBox 控制 y 位置。如果您希望将所有按钮放置在 HBox 的中间，则需要将 verticalAlign 设置为 middle

在代码中

```
setStyle("verticalAlign", "middle"); 
```

# sql - 如何从临时表中检索字段名称 (SQL Server 2008)

> ID：756080
> 
> 赞同：73
> 
> 时间：2009-04-16T13:22:08.460
> 
> 标签：sql, sql-server, sql-server-2008, temp-tables

我正在使用 SQL Server 2008。假设我创建了一个像这样的临时表：

```
create table #MyTempTable (col1 int,col2 varchar(10)) 
```

如何动态检索字段列表？我想看到这样的东西：

```
Fields:
col1
col2 
```

我正在考虑查询 sys.columns 但它似乎没有存储有关临时表的任何信息。有任何想法吗？

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2009-04-16T13:27:18.510

```
select * from tempdb.sys.columns where object_id =
object_id('tempdb..#mytemptable'); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-04-16T13:27:19.417

```
select * 
from tempdb.INFORMATION_SCHEMA.COLUMNS
where table_name like '#MyTempTable%' 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-06-13T22:17:26.903

要使用 information_schema 并且不与其他会话发生冲突：

```
select * 
from tempdb.INFORMATION_SCHEMA.COLUMNS
where table_name =
    object_name(
        object_id('tempdb..#test'),
        (select database_id from sys.databases where name = 'tempdb')) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-16T13:26:07.267

临时表在“tempdb”中定义，表名是“mangled”。

这个查询应该可以解决问题：

```
select c.*
from tempdb.sys.columns c
inner join tempdb.sys.tables t ON c.object_id = t.object_id
where t.name like '#MyTempTable%' 
```

马克

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-24T05:55:55.450

你也可以通过以下方式做到这一点..

```
create table #test (a int, b char(1))

select * From #test

exec tempdb..sp_columns '#test' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-27T13:54:35.083

安东尼

试试下面的。它会给你预期的输出

```
select c.name as Fields from 
tempdb.sys.columns c
    inner join tempdb.sys.tables t
 ON c.object_id = t.object_id
where t.name like '#MyTempTable%' 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-09T13:50:23.547

```
select * 
from tempdb.INFORMATION_SCHEMA.COLUMNS 
where TABLE_NAME=OBJECT_NAME(OBJECT_ID('#table')) 
```

# ant - Lisp 中的 Ant（或 NAnt）

> ID：756090
> 
> 赞同：6
> 
> 时间：2009-04-16T13:23:27.087
> 
> 标签：ant, lisp

在他的文章[The Nature of Lisp](http://www.defmacro.org/ramblings/lisp.html "Lisp 的本质")中，Slava Akhmechet 以 Ant/NAnt 为例向人们介绍了 lisp。lisp 中是否有 Ant/NAnt 的实现？在哪里可以使用实际的 lisp 代码而不是 xml 来定义事物？我不得不处理创建 NAnt 的添加，并希望有一种方法可以绕过 xml 系统，就像 Slava 展示的那样。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T16:33:54.013

**Ant**是一个解释用某种 XML 语言编写的命令的程序。正如 justinhj 在他的回答中提到的那样，您可以使用一些 XML 解析器（如提到的 XMLisp）并将 XML 描述转换为某种 Lisp 数据，然后在 Lisp 中编写其他代码。您还需要重新实现一些 Ant 解释。

在 Lisp 中不需要 Ant 中的许多原始内容。Lisp 中内置了一些文件操作（删除文件、重命名文件、探测文件，...）。有些缺失并且需要实现 - 或者您可以使用现有库之一。另请注意，您可以将 Lisp 文件加载到 Lisp 并执行代码 - 还有 REPL - 所以它已经带有交互式前端（与 Java 不同）。

Common Lisp 中更高级别的构建系统通常实现称为“ **SYSTEM** ”的抽象。其中有几个。**自卫队**是一种流行的选择，但还有其他选择。一个系统有子系统和文件。一个系统也有几个选项。它的组件也有选项。一个系统要么具有组件的结构描述，要么具有依赖关系的描述，要么具有“动作”及其依赖关系的一种描述。通常，这些东西是以面向对象的方式实现的，您可以将“动作”实现为 Lisp（通用）函数。Lisp 还带来了像 COMPILE-FILE 这样的函数，它将使用 Lisp 编译器来编译文件。如果你的代码有，比如说，C 文件——你需要调用一个 C 编译器——通常通过一些允许调用外部程序的实现特定的函数（这里是 C 编译器）。

正如 dmitry-vk 所提到的，ASDF[是](http://www.cliki.net/asdf)一种流行的选择。LispWorks 提供[Common Defsystem](http://www.lispworks.com/documentation/lw51/LWUG/html/lwuser-241.htm#pgfId-884853)。Allegro CL 有自己的 DEFSYSTEM。它的[DEFSYSTEM 手册](http://www.franz.com/support/documentation/current/doc/defsystem.htm)也描述了如何扩展它。

所有的 Lisp 解决方案都使用某种**Lisp 语法**（不是 XML 语法），通常通过宏来实现来描述系统。一旦将其读入 Lisp，它就会变成数据表示 - 通常带有系统、模块等的 CLOS 实例。然后这些操作也是 Lisp 函数。然后一些高阶函数遍历组件图/树并执行必要的操作。其他一些工具遍历组件图/树并返回操作的表示 - 然后是建议的**计划**- 然后用户可以让 Lisp 执行整个计划或计划的一部分。

在 Lisp 机器上，一个简单的系统描述如下所示：

```
(sct:defsystem scigraph
    (:default-pathname "sys:scigraph;"
     :required-systems "DWIM")
   (:serial "package" "copy" "dump" "duplicate" "random"
            "menu-tools" "basic-classes" "draw" "mouse"
            "color" "basic-graph" "graph-mixins" "axis"
            "moving-object" "symbol" "graph-data" "legend"
            "graph-classes" "present" "annotations" "annotated-graph"
            "contour" "equation" "popup-accept" "popup-accept-methods"
            "duplicate-methods" "frame" "export" "demo-frame")) 
```

上面定义了一个系统 SCIGRAPH，所有文件都应该按串行顺序编译和加载。

现在我可以看到 Lisp Machine 会做什么来更新编译的代码：

```
命令：编译系统（系统 [默认 Scigraph]） Scigraph（关键字）
                        :Simulate (编译 [默认是]) 是

  构建 Scigraph 最新版本的计划以供编译
      操作是：
  编译 RJNXP:>软件>scigraph>scigraph>popup-accept-methods.lisp.newest
  加载 RJNXP:>软件>scigraph>scigraph>popup-accept-methods.ibin.newest

```

它会编译一个文件并加载它——到目前为止，我已经加载了软件并只更改了这个文件。

对于 ASDF，请参阅 CLIKI 页面上提到的文档 - 它的工作方式有点不同。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T17:49:09.447

Stuart Halloway 即将出版的《[Clojure 编程》一书贯穿整本书的](http://www.pragprog.com/titles/shcloj/programming-clojure)[Lancet](http://github.com/stuarthalloway/lancet/tree/master)作为示例应用程序的构建。Lancet 是一个 Clojure 构建系统，它（可选）直接与 Ant 集成。源代码和示例[可用](http://github.com/stuarthalloway/lancet/tree/master)。

如果您只想使用 Lisp 代码生成 Ant XML 文件，您可以使用类似Clojure的[clj-html或 Common Lisp](http://github.com/mmcgrana/clj-html/tree/master)[的 CL-WHO](http://www.weitz.de/cl-who/)。从 Lisp s-exps 生成 XML 既有趣又简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T14:06:21.210

也许您可以在 lisp 中定义事物，并在将它们传递给 NAnt 时将它们转换为 XML。

像[XMLisp](http://www.agentsheets.com/lisp/XMLisp/)这样的东西可以更容易地在两种表示之间来回切换。

编辑：实际上，[xml-emitter](http://www.cliki.net/xml-emitter)会更有意义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T14:27:30.050

Common Lisp 的 ASDF（Another System Definition Facility）类似于 Make/Ant（但不是完全类似的——它旨在构建 lisp 程序，而不是像 make 或 ant 这样的通用系统）。它可以通过 Lisp 代码进行扩展（子类化系统、组件、向系统添加操作）。例如，有一个 asdf-ecs 扩展允许将 C 源文件包含（和编译）到系统中。

# c - 如何在 NPAPI C 插件中获取 NPP 实例

> ID：756095
> 
> 赞同：2
> 
> 时间：2009-04-16T13:24:23.540
> 
> 标签：c, plugins, npapi

我用 C 编写了一个 NPAPI 插件，它需要调用[NPN_Invoke](https://developer.mozilla.org/en/NPN_Invoke)函数（为了调用 JavaScript 函数）。

但是 NPN_Invoke() 将[NPP](https://developer.mozilla.org/En/NPP)实例作为参数。

只有 NP_New() 和 NP_Destroy() 函数才能通过 NPP 实例。我如何获得这个 NPP 实例？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-22T23:45:28.070

最好的方法实际上是使用字段扩展 NPObject 以保存关联的 NPP 实例，并为您的 NPClass 定义提供分配/解除分配功能。然后，您可以将 NPObject 转换为您的子类型以访问实际的 NPP 实例。

我*不*建议按照上面的建议在全局级别（NP_GetEntryPoints 等）执行此操作，因为可能会加载您的插件的多个实例 - 甚至可能在同一页面上 - 并且您要确保调用正确的一。不幸的是，那里似乎有很多示例代码，其中一些随机实例只是保存在全局变量中，并尽可能地更新。

例如，假设 C++，您需要扩展 NPObject：

```
struct MyNPObject : public NPObject {
  NPP npp_;
  explicit MyNPObject(NPP npp) : npp_(npp) {}
}; 
```

然后您的 NPClass 定义将需要分配和解除分配定义：

```
static NPClass obj_Class = {
  NP_CLASS_STRUCT_VERSION,
  &obj_allocate,
  &obj_deallocate,
  NULL,
  &obj_hasMethod,
  &obj_invoke,
  ... 
```

可以这样实现：

```
static NPObject* obj_allocate(NPP npp, NPClass *aClass)
{
  return new MyNPObject(npp);
}

static void obj_deallocate(NPObject *obj)
{
  delete obj;
} 
```

当您需要调用 NP_Invoke 时，假设您有 NPObject*（例如，在 obj_invoke 内部），您只需低调：

```
MyNPObject* myObj = reinterpret_cast<MyNPObject*>(obj);
g_browser->invoke(myObj->npp, ...) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-24T11:22:43.090

在 NP_GetEntryPoints 中定义你自己的 NP_yourNew 函数，现在当 NP_New 之后框架用实例调用你的 NP_yourNew 时。当您的回调刚刚被调用时，可以保存该实例。

# ruby-on-rails - 您会为 Rails 推荐任何选项卡式导航插件或宝石吗？

> ID：756098
> 
> 赞同：1
> 
> 时间：2009-04-16T13:24:50.170
> 
> 标签：ruby-on-rails, navigation

我要开发一个 Rails 应用程序，设计人员希望将选项卡作为界面/导航的一部分（可能它会包含嵌套选项卡）。

有什么地方你会推荐我看，因为我想这一切都已经完成了。

谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:33:53.253

看看这个 可以放入 Ruby On Rails 应用程序的[小部件集合。](http://wiki.github.com/paolodona/rails-widgets)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-05-12T19:11:15.123

为了这个目的，我创建了[tabulous gem 。](https://github.com/techiferous/tabulous)

# iphone - 如何以编程方式获取 iPhone 的序列号？

> ID：756101
> 
> 赞同：10
> 
> 时间：2009-04-16T13:25:07.097
> 
> 标签：iphone, objective-c

我想知道我的 iPhone 使用我的应用程序的序列号。我在下面写了代码。

```
- (NSString*)getSerialNumber
{
 CFTypeRef serialNumberAsCFString;

 io_service_t platformExpert = IOServiceGetMatchingService(kIOMasterPortDefault, IOServiceMatching("IOPlatformExpertDevice"));

 if (platformExpert)
 {
     serialNumberAsCFString = IORegistryEntryCreateCFProperty(platformExpert, CFSTR(kIOPlatformUUIDKey), kCFAllocatorDefault, 0);
 }

 IOObjectRelease(platformExpert);

 NSString *serial = [[NSString alloc] initWithFormat:@"%@",serialNumberAsCFString];

    NSLog(@"serail no==>%@",serialNumberAsCFString);
    NSLog(@"serail no==>%@",serial);
} 
```

为什么我仍然得到错误的序列号？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-08T08:56:13.643

`IORegistryEntryCreateCFProperty`您应该将from的参数 2 更改`CFSTR (kIOPlatformUUIDKey)`为`CFSTR (kIOPlatformSerialNumberKey)`。然后您将获得正确的序列号（长度为 11 个字符）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T14:42:29.843

你在链接 IOKit 框架吗？

试试

```
id getValue(NSString *iosearch); 
```

功能，可在

[http://blogs.oreilly.com/iphone/2008/08/retrieving-device-information.html](http://blogs.oreilly.com/iphone/2008/08/retrieving-device-information.html)

您还可以使用 UIDevice 类来检索其他有用的信息例如，您可以：

```
NSString *id = [[UIDevice currentDevice] uniqueIdentifier]; 
```

其他有用的属性如下：

```
 name  
  systemName    
  systemVersion  
  model  
  localizedModel 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-06T12:58:55.643

准备在 UIDevice 上使用类别：[UIDevice+serialNumber](http://gist.github.com/566994)。不确定这是否会在 App Store 上被接受。

# java - scrollPane 在应该显示 editorPane (html) 时随机保持灰色

> ID：756105
> 
> 赞同：1
> 
> 时间：2009-04-16T13:25:36.113
> 
> 标签：java, swing, jeditorpane

由于某种原因，我的 HTML 页面没有 100% 显示在屏幕上，这对我来说似乎是一个时间问题。如果我删除滚动窗格并仅使用 EditorPane 就可以了。

我应该在下面添加什么样的代码来强制 Java 小程序屏幕重绘/刷新，我可以以某种方式等到所有图像都真正加载好了吗？目前，在 GUI 上显示文本后会稍微绘制图像。
（当我最小化+最大化窗口时，灰色消失并出现丢失的文本。）

我使用 SynchronousHTMLEditorKit 作为 m_editorPane.setEditorKitForContentType

```
private JEditorPane m_editorPane = new JTextPane();
private JScrollPane m_scrollPane = new JScrollPane();
....
JEditorPane.registerEditorKitForContentType( "text/html", "SynchronousHTMLEditorKit" );
m_editorPane.setEditorKitForContentType( "text/html", new SynchronousHTMLEditorKit() );
 m_editorPane.setPage(ResourceLoader.getURLforDataFile(file));
 m_scrollPane.getViewport().add(m_editorPane);
 m_scrollPane.validate();
 m_scrollPane.repaint(); <-- does not seem to solve this

add(m_scrollPane);
///    add(  m_editorPane) <-- this WORKS !! 
```

`SynchronousHTMLEditorKit`定义为：

```
public class SynchronousHTMLEditorKit extends HTMLEditorKit {
    public Document createDefaultDocument(){
        HTMLDocument doc = (HTMLDocument)(super.createDefaultDocument());
        doc.setAsynchronousLoadPriority(-1); //do synchronous load
        return doc;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:10:29.467

Try moving the validate and repaint calls to the bottom, after the add, and call them on the container, not the scrollpane

```
add(m_scrollPane);
validate();
repaint(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:05:46.547

What happens if you don't use a `SynchronousHTMLEditorKit`? Your code works perfectly for me without it.

# com - 带有 ATL 版本控制的 COM

> ID：756108
> 
> 赞同：1
> 
> 时间：2009-04-16T13:26:22.693
> 
> 标签：com, atl

我的 Visual Studio 2008 ATL 项目有一个在多个位置定义版本号的控件。IDL 文件：

```
uuid(56CD4ADB-B72D-4BF8-B5AC-6CA320EAD27D),
version(1.0),
helpstring("MyProject 1.0 Type Library") 
```

控件的头文件：

```
 class ATL_NO_VTABLE CMyControl :
        public CComObjectRootEx<CComSingleThreadModel>,
        public IDispatchImpl<IMyControl, 
             &IID_IMyControl, &LIBID_MyProjectLib, 
             /*wMajor =*/ 1, /*wMinor =*/ 0>,
            ... 
```

还有一个 rgs 文件：

```
MyCompany.MyProject.MyControl.1 = s 'MyControl Class' 
```

这些版本号之间有什么关系？当我想发布版本 2 时，是否要增加所有 3？为什么注册表脚本中的版本只有 1 而没有 1.0？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:28:20.207

您应该查看 Larry Osterman 关于 COM 和最小注册表的系列。它应该对这些数字的实际作用有所了解

*   [http://blogs.msdn.com/larryosterman/archive/2006/01/11/511647.aspx](http://blogs.msdn.com/larryosterman/archive/2006/01/11/511647.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2006/01/10/511279.aspx](http://blogs.msdn.com/larryosterman/archive/2006/01/10/511279.aspx)
*   [http://blogs.msdn.com/larryosterman/archive/2006/01/05/509731.aspx](http://blogs.msdn.com/larryosterman/archive/2006/01/05/509731.aspx)

# c++ - delete 如何处理指针常量？

> ID：756109
> 
> 赞同：8
> 
> 时间：2009-04-16T13:27:02.443
> 
> 标签：c++, delete-operator

我正在阅读这个问题[Deleting a const pointer](https://stackoverflow.com/questions/755196/deleting-a-const-pointer)并想了解更多关于`delete`行为的信息。现在，根据我的理解：

`delete expression`分两步工作：

1.  调用析构函数
2.  `free()`然后通过调用 operator delete释放内存（通常通过调用）。

`operator delete`接受一个`void*`. 作为测试程序的一部分，我重载`operator delete`并发现它`operator delete`不接受`const`指针。

由于 operator delete 不接受 const 指针，并且 delete 在内部调用 operator delete，所以[删除 const 指针是](https://stackoverflow.com/questions/755196/deleting-a-const-pointer)如何工作的？

`delete`内部使用 const_cast 吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T13:45:46.453

const_cast 并没有真正做任何事情——它是一种抑制编译器抱怨对象的常量性的方法。*delete*关键字是一个编译器构造，编译器知道在这种情况下要做什么并且不关心指针的 const 性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T13:42:02.297

正如[这个答案](https://stackoverflow.com/questions/755196/deleting-a-const-pointer/755224#755224)所说，`delete`它不像其他任何方法，而是破坏对象的语言的一部分。`const`-ness 与可破坏性无关。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T13:53:00.243

> 运算符 delete 接受 void*。作为测试程序的一部分，我重载了 operator delete 并发现 operator delete 不接受 const 指针。

你是怎么尝试的？**它**当然接受 const 指针：

```
#include <memory>

int main() {
    void* const px = 0;
    delete px;
    ::operator delete(px);
} 
```

此代码是正确的，可以编译（尽管带有合理的警告）并执行。

**编辑**：阅读原始文章——你不是在谈论一个 const 指针，而是*一个指向 的指针`const`*，这是别的东西。那里描述了这必须起作用的原因。至于它为什么起作用：其他人已经说过了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T13:47:02.863

`delete`是一个可以重载的运算符。它将指针作为参数，并释放内存，可能使用`free`. 无论指针是否存在，编译器都允许这样做`const`。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-05-04T02:44:49.360

`delete`只是调用以释放指针指向的内存，它不会更改指针的值或对象的值。因此，与指向的指针或对象的 -ness`delete`无关。`const`

# excel - VB / VBA StrComp 或 =

> ID：756118
> 
> 赞同：7
> 
> 时间：2009-04-16T13:27:59.570
> 
> 标签：excel, string-comparison, vba

如果有的话，使用的好处是什么

```
If StrComp(strVal1, strVal2, vbTextCompare) = 0 Then 
```

而不是使用

```
If strVal1 = strVal2 Then 
```

如果`Option Compare Text`设置在模块级别，有什么区别吗？

我知道 StrComp 处理空场景和 <> 场景，我只对 strVal1 和 strVal2 分配了非空有效字符串的情况感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:32:19.403

由于 StrComp 正在比较字符串（带有文化信息），因此大写和小写不关心......（所以 Hello 与 hello 相同）。在 = 的情况下，会有不同（就像使用二进制比较一样）。如果选项比较文本处于模块级别，则没有区别（但您应该使用 StrComp 以防其他人删除它）...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T13:32:20.167

> 如果`Option Compare Text`设置在模块级别，有什么区别吗？

不，它只是提供了更细粒度的控制（没有模块级策略承诺）。但是，如果您*可以*做出这样的承诺，请`x = y`选择以下选项：更少的代码总是更好的代码。

# .net - 如何追踪 log4net 问题

> ID：756125
> 
> 赞同：202
> 
> 时间：2009-04-16T13:30:00.987
> 
> 标签：.net, logging, log4net

我一直都在使用 log4net，但我从未想过的一件事是如何判断内部发生了什么。例如，我的项目中有一个控制台附加程序和一个数据库附加程序。我对数据库和代码进行了一些更改，现在数据库附加程序不再工作了。我最终会弄清楚为什么，但如果我能看到 log4net 内部发生了什么，那将有很大帮助。

log4net 是否会生成任何类型的输出，我可以查看这些输出来尝试确定问题的根源？

* * *

## 回答 #1

> 赞同：309
> 
> 时间：2009-04-16T13:59:36.607

首先，您必须在应用程序配置文件中设置此值：

```
<configuration>
   <appSettings>
      <add key="log4net.Internal.Debug" value="true"/>
   </appSettings>
</configuration> 
```

然后，要确定要保存输出的文件，可以在同一个 .config 文件中添加以下代码：

```
<configuration>
...

<system.diagnostics>
    <trace autoflush="true">
        <listeners>
            <add 
                name="textWriterTraceListener" 
                type="System.Diagnostics.TextWriterTraceListener" 
                initializeData="C:\tmp\log4net.txt" />
        </listeners>
    </trace>
</system.diagnostics>

...
</configuration> 
```

您可以在“如何启用 log4net 内部调试？”下找到更详细的说明。在[log4net 常见问题页面](https://logging.apache.org/log4net/release/faq.html#internalDebug)中。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2016-03-04T18:40:42.517

如果您使用的是 log4net 配置文件，您还可以通过将顶部节点更改为：

```
<log4net debug="true"> 
```

一旦重新加载配置并假设您的跟踪侦听器设置正确，这将起作用。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2016-02-08T16:38:30.940

除了上述答案之外，您还可以使用这一行来实时查看日志，而不是使用 c:\tmp\log4net.txt 输出。

```
log4net.Util.LogLog.InternalDebugging = true; 
```

例如，在控制台应用程序中，您可以添加它，然后实时观察输出。在小型测试工具中调试 log4net 以查看您正在测试的 appender 发生了什么非常有用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-12-08T14:55:23.637

确保您的入口点所在的根应用程序将某些内容记录到 log4net。给它以下之一：

```
private static ILog logger = LogManager.GetLogger(typeof(Program));
static void Main(string[] args)
{
    logger.InfoFormat("{0} v.{1} started.", Assembly.GetExecutingAssembly().GetName().Name, Assembly.GetExecutingAssembly().GetName().Version.ToString()); 
```

在 2.0.8 中，我遇到了一个有趣的情况。我创建了一个库项目和一个测试 exe 项目来演示它的功能。库项目被设置为使用 Log4net，就像 exe 项目一样。exe 项目使用 assemblyinfo 属性来注册配置，但我没有得到控制台或日志文件的日志输出。当我打开 log4net 内部调试日志时，我收到了一些写入控制台的内部消息，但仍然没有我的正常日志。没有报告错误。当我将上面的代码添加到我的程序中时，这一切都开始了。Log4net 否则设置正确。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-10-26T10:33:38.763

如果内部日志没有为您提供足够的信息，那么构建和调试[源代码](https://logging.apache.org/log4net/download_log4net.cgi)非常容易。如果您不想将其与您的开发项目混为一谈，请添加一个简单的控制台应用程序，该应用程序仅记录一条消息，将您的项目复制`log4net.config`到此应用程序，然后调试相关类。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-11-30T15:13:28.860

在 log4net 2.0.8 中，似乎不可能在单独的 DLL 中使用 log4net 进行日志记录。如果我尝试这样做，结果会很奇怪：不再执行日志记录。并且使用调试选项初始化 log4net 没有显示错误。

就像 K0D4 说的，你应该在你的主模块中有一个对 log4net 的引用，并且它应该在程序开始时调用一次，一切都很好。

在 log4net 的下一个版本中，这个 bug 可能会被修复。

# security - 命令“cat /tmp/dir/:0”有什么作用？

> ID：756133
> 
> 赞同：1
> 
> 时间：2009-04-16T13:31:51.980
> 
> 标签：security, bash, x11

当我执行上面的命令时，X11 打开了。我很困惑。我跑了吗？我怎么能确定我在看东西时没有运行任何程序？我真的很讨厌读取文本文件可能会执行程序的想法。如何使程序在运行简单的 cat 命令或类似命令时执行可编程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T13:39:07.187

如果你跑

```
file /tmp/:0 
```

您应该看到这不是一个普通的“文本”文件，而是一个套接字。`ls`因此别名

```
ls -F 
```

将有助于在您的 shell 中自动识别此类文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T16:05:52.130

这听起来像 OSX 10.5 的行为。

launchd 侦听套接字“/tmp/launch-xxxxxx/:0”。DISPLAY 变量设置为告诉 X 应用程序写入该套接字。当 X 应用程序打开套接字时，launchd 会自动启动 'X11.app' 为应用程序提供显示。

cat'ing 套接字打开它并触发 X11.app。我认为默认情况下没有配置该行为的任何其他实例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T13:39:35.080

machine:0 是 X 显示（“机器”上的第一个显示）
我从未见过 /tmp/:0 但可能是您的机器已配置为所有不匹配的机器名称都映射到 localhost。您还没有执行任何操作，X 服务器只会尝试将 cat 发送的任何命令解释为 X 指令。这就像对 http 地址做 cat

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T13:50:50.887

这个`:0`东西是一个引用 X 服务器的套接字。程序使用这个套接字与 X 服务器通信（例如绘制一个窗口）。从此套接字读取以某种方式导致服务器激活。在您执行此命令之前，X 服务器必须已经在运行。

# oracle - Oracle - OCI 查询超时

> ID：756137
> 
> 赞同：3
> 
> 时间：2009-04-16T13:32:31.213
> 
> 标签：oracle, timeout, prepared-statement, oracle-call-interface

有什么方法可以设置 Oracle OCI 调用的超时时间（例如 OCIStmtExecute）？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:37:48.643

自己没有办法提供`OCI`。

您可以创建一个`Timer`并发出一个`OCIBreak()`超时。

`OCIBreak()`是线程安全和信号安全的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-30T12:31:02.917

可以在 oracle 服务器端设置超时，但不能通过任何 OCI API。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2011-08-25T20:32:10.790

PHP 的 OCI 模块可以按照这个注释来做：

[http://www.php.net/manual/en/function.oci-connect.php#84144](http://www.php.net/manual/en/function.oci-connect.php#84144)

# c# - 如何从 XmlNode 中删除文本？

> ID：756144
> 
> 赞同：0
> 
> 时间：2009-04-16T13:34:38.900
> 
> 标签：c#, xml

假设，我有一个 XmlNode：

```
<A>1</A> 
```

如何从中删除文本，所以我得到：

```
<A /> 
```

代替：

```
<A></A> 
```

下面是一个单元测试，它显示了我到目前为止所做的尝试。

```
 [Test]
  public void RemoveXmlTextTest()
  {
     string xmlString = @"<B><A>1</A></B>";         
     XmlDocument doc = new XmlDocument();
     doc.LoadXml(xmlString);
     XmlNode testNode = doc.SelectSingleNode("//A");

     //1\. Set innerText to string.Empty - not working
     //testNode.InnerText = String.Empty;

     //2\. Call removeAll - not working         
     //testNode.RemoveAll();

     //3\. testNode has one child with name '#text' - remove it - not working
     //testNode.RemoveChild(testNode.FirstChild);

     //4\. Replace node with a new empty one - working but extremally ugly :(
     //All references to testNode still points to the old one !!!!
     testNode.ParentNode.ReplaceChild(doc.CreateElement(testNode.Name), testNode);

     //Is there some better way to do it?

     testNode = doc.SelectSingleNode("//A");
     Assert.AreEqual("<A />", testNode.OuterXml);
  } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:38:59.577

您是否尝试过设置[`XmlElement.IsEmpty`](http://msdn.microsoft.com/en-us/library/system.xml.xmlelement.isempty.aspx)为true？

（显然这意味着强制转换为`XmlElement`，但这是问题有意义的唯一情况。）

# unix - 哪些文件可以控制您网站的可见性？

> ID：756146
> 
> 赞同：2
> 
> 时间：2009-04-16T13:34:49.990
> 
> 标签：unix, permissions, filesystems, chmod

我在 uni 向我的用户帐户运行以下命令

```
chmod -R 700 * 
```

然后，我跑

```
chmod -R 755 public_html 
```

当我浏览它时，我的主页仍然是“禁止的”。

**我的用户帐户的权限**

```
4 drwx------  5 Newbie staff 4096 2008-12-19 12:39 Desktop
4 drwx------ 10 Newbie staff 4096 2009-04-16 02:28 Documents
4 drwx------  4 Newbie staff 4096 2008-11-28 20:48 irclogs
4 -rwx------  1 Newbie staff 1686 2008-09-10 16:00 kieli
4 drwxr-xr-x  3 Newbie www  4096 2009-04-16 02:14 public_html
4 drwx------  2 Newbie staff 4096 2008-09-01 08:43 Templates
4 drwx------  4 Newbie staff 4096 2008-12-21 03:15 tmp
4 drwx------  7 Newbie staff 4096 2008-09-03 21:39 Windows
4 drwx------  4 Newbie staff 4096 2008-10-03 16:29 workspace 
```

**public_html 中文件的权限**

```
 4 -rwxr-xr-x 1 newbie staff   3414 2009-04-15 02:23 index.html
  4 -rwxr-xr-x 1 newbie staff   2219 2008-09-16 10:46 index.html~
144 -rwxr-xr-x 1 newbie staff 140120 2009-04-14 22:16 jquery.js
  4 -rwxr-xr-x 1 newbie staff    699 2009-04-15 01:05 template.css 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T13:35:42.657

目录中有索引文件吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T13:41:01.257

好吧，您的第二个 chmod 似乎运行得不是很好，因为您的 public_html 目录是模式 744，而不是 755。

您还需要使您的主目录可以被 Web 服务器“浏览”；www 用户需要对该目录的执行权限。 `chmod o+x .`可能是你最好的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T13:55:51.593

您还需要对 public_html 中的文件授予执行权限。在您授予权限 chmod -R 755 public_html 的语句中，授予的权限仍然只有 744。因此也要授予执行权限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T18:13:21.213

我发现了另一个错误。

我的用户文件夹的权限为 700。我将其更改为 701。

我现在可以看到我的网站了。似乎需要701。

# c# - 多表 LinqToSql 聚合函数

> ID：756148
> 
> 赞同：1
> 
> 时间：2009-04-16T13:35:38.303
> 
> 标签：c#, linq-to-sql

我花了很长时间来正确地查询这个问题，所以我希望 StackOverflow 可以为我指明正确的方向。

我有三张桌子：

*   区域（TerritoryId、TerritoryName 等）
*   UserTerritories（只是一个动名词）
*   用户（用户 ID、用户名、状态 ID）

我需要获取所有拥有一个或多个用户的区域，其 StatusId 为（比如说）3。

我真正能够编译的只是连接所有表:(

```
IEnumerable<Territory> territories = (from t in db.Territories
                                      join uXt in db.User_x_Territories on t.TerritoryId equals uXt.UserID into tJoin
                                      from uXt in tJoin.DefaultIfEmpty()
                                      join u in db.Users on uXt.UserID equals u.Id into uJoin
                                      from u in uJoin.DefaultIfEmpty()
                                      select t); 
```

谁能帮我吗？我在网上能找到的都是相当基本的例子。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T13:53:15.140

```
var territories = context.Territories
    .Where(t=> t.UserTerritories.Any(ut=>ut.User.StatusId == 3)); 
```

它的工作原理如下：)

只需获取符合所需条件的地区，即拥有状态 id 为 3 的任何用户。使用关系简化了许多查询。

**更新：**如果您更喜欢查询语法

```
var territories = from t in context.Territories
                  where t.UserTerritories.Any(ut=>ut.User.StatusId == 3))
                  select t; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T13:47:23.533

试一试...

```
(from u in users where u.StatusId==3 
    join ut in userTerritories on u.UserId equals ut.UserId 
    join t in territories on ut.TerritoryId equals t.TerritoryId 
    group t by t into gg select gg.Key) 
```

# tfs - 如何撤消来自非托管工作区的 tfs 更改？

> ID：756151
> 
> 赞同：1
> 
> 时间：2009-04-16T13:36:05.620
> 
> 标签：tfs, workspace, undo, unlock

我有一个永远丢失的工作空间。我从这个工作区签出了一些文件。我想解锁它们，但我不能。我试着做：

```
TF UNDO $/MyProject/MyFolder/MyFile.cs /WORKSPACE:LOST;user /s:http://mysite:8080 
```

但我收到了这条信息：

> 工作区丢失；用户不在这台计算机上。在托管该工作区的计算机上运行 get（如果撤消了编辑，则获取所有内容）以使用在服务器上所做的更改对其进行更新。

是否存在撤消由不可用工作区签出的文件（**不是每个文件）的任何方法？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T14:29:41.310

如果工作区丢失，那么我会删除它。删除它会撤消在其中所做的任何更改。

```
tf workspace /delete WorkspaceName;WorkspaceOwner 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-02T07:10:24.070

只要您拥有适当的权限，我认为@BubbleSort 的这个答案中的方法应该可以工作：[https](https://stackoverflow.com/a/17870318/1982894) ://stackoverflow.com/a/17870318/1982894 他使用了 TFS 2012，我已经在 TFS 2010 中对其进行了测试也在那里工作。

复制答案以方便参考：

> （注意：我安装了 TFS 电动工具，所以如果您没有看到所描述的选项，您可能需要安装它们 。http: [//visualstudiogallery.msdn.microsoft.com/b1ef7eb2-e084-4cb8-9bc7-06c3bad9148f](http://visualstudiogallery.msdn.microsoft.com/b1ef7eb2-e084-4cb8-9bc7-06c3bad9148f) ）
> 
> 如果您以团队项目管理员（或至少具有“撤消其他用户的更改”访问权限的人）身份访问源代码管理资源管理器，您可以在 Visual Studio 2012 中执行以下操作以清除锁定和签出。
> 
> 1.  从源代码管理资源管理器中找到包含锁定文件的文件夹。
> 2.  右键单击并选择**查找**，然后**按状态查找...**
> 3.  出现“在源代码管理中查找”窗口
> 4.  单击**查找**按钮
> 5.  应出现“在源代码管理中查找”选项卡，显示已签出的文件
> 6.  右键单击要解锁的文件
> 7.  从上下文菜单中选择**撤消...**
> 8.  出现一个确认对话框。单击**是**按钮。
> 9.  该文件应该从“在源代码管理中查找”窗口中消失。
> 
> 该文件现在已解锁。

# linux - linux发行版中的boost版本

> ID：756152
> 
> 赞同：0
> 
> 时间：2009-04-16T13:36:15.103
> 
> 标签：linux, boost, fedora

有谁知道为什么 fedora 10（我会说是一个非常现代的 linux 发行版）仍然附带 boost 版本 1.34，而最新版本是 1.38 的原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T13:42:18.647

操作系统很少附带最新版本的任何东西。这*不仅仅是*将最新版本的 X 与操作系统打包的问题，​​因为依赖于 X 的所有其他部分都必须使用新版本进行测试。纸上的兼容性并不总是意味着现实中的兼容性——可能而且将会有惊喜。

这就是为什么 Debian 的稳定版本有时会包含几乎古老的软件。古老但稳定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T13:38:53.600

可能是因为人们不愿意参与并帮助保持软件包的最新状态。

提示提示。

如果有什么安慰的话，Ubuntu Jaunty 看起来将有 1.37 ......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T13:42:43.827

我的猜测是他们发布了一个有点旧的库，因为它仍然可以工作，而且他们不想测试新版本。Distos 通常落后于大多数软件包的一两个版本。此外，Fedora 10 发布时还没有 1.38。对于 Fedora 11，他们可能会发布更新的版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T22:24:02.937

可能他们没有依赖于 libboost > 1.34 的软件包。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T21:50:13.830

不知道 Fedora，但 Debian/testing 在去年的大部分时间里都停留在 1.35，而他们让 Lenny 发布。[与此同时，boost在 7 个月内](http://sourceforge.net/project/showfiles.php?group_id=7586&package_id=8041)快速发布了 1.36、1.37 和 1.38 。

我不认为这有什么大不了的。材料加速发布通常处于非常稳定的“完成”状态，而不是正在进行中的工作。如果您在 1.3x 中使用某些东西，那么您不太可能遇到需要更高版本来修复的错误。如果您绝对想要他们发布的一些新库，那么从源代码构建 /usr/local 版本并不是那么繁重。

# c# - 如何在 C# 中使用“param”来获取这个示例？

> ID：756156
> 
> 赞同：1
> 
> 时间：2009-04-16T13:37:42.980
> 
> 标签：c#, lambda

我试图从 RelayCommand 示例中了解这一行中**param参数的含义和用法：**

```
return new RelayCommand(param => MessageBox.Show("It worked.")); 
```

首先，我了解“param”参数**与“params”关键字无关**，这是正确的吗？

```
public int Add(params int[] list)
{
  int sum = 0;
  foreach (int i in list)
    sum += i;
  return sum;
} 
```

其次，**我必须添加什么样的委托代码**才能使以下示例正常工作？

```
using System;
using System.Collections.Generic;

namespace TestParam222
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("The total is {0}.", Tools.GetTest(param => 23));
            Console.ReadLine();
        }
    }

    class Tools
    {
        public static string GetTest(List<int> integers)
        {
            return "ok";
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T13:40:38.323

`param`不是关键字。它是示例中 lambda 表达式的参数。您需要使您的方法采用委托或表达式树，例如

```
using System;
using System.Collections.Generic;

namespace TestParam222
{
  class Program
  {
    static void Main(string[] args)
    {
      Console.WriteLine("The total is {0}.", Tools.GetTest(param => 23));
      Console.ReadLine();
    }
  }

  class Tools
  {
    public static string GetTest(Func<int, int> integers)
    {
      return "ok";
    }
  }
} 
```

`Func<int,int>`实际上可能是*任何* `Func<T,int>`（或`Func<T,long>`等），因为您的 lambda 表达式不会在`param`任何地方使用。或者它可以是一个`Expression<Func<int,int>>`等。

我建议您阅读 lambda 表达式以获取更多详细信息，例如在任何这些 SO 问题中：

*   [你能解释一下 lambda 表达式吗](https://stackoverflow.com/questions/187414/can-you-explain-lambda-expressions-closed)
*   [什么是 lambda](https://stackoverflow.com/questions/150129/what-is-a-lambda)
*   [C# lambda 表达式，我为什么要使用它](https://stackoverflow.com/questions/167343/c-lambda-expression-why-should-i-use-this)

# resharper - 如何修复更锐利的换行缩进

> ID：756161
> 
> 赞同：9
> 
> 时间：2009-04-16T13:38:05.287
> 
> 标签：resharper

Resharper 似乎发疯了，并且在没有缩进的情况下换行，即他们正在拥抱边缘。这种丑陋让我撕下我的衬衫并变得疯狂。

```
 else
                {
                    gridView1.SetRowCellValue(gridView1.FocusedRowHandle, "PRIORITY",
polcvgSetCollection.Max(p => p.PRIORITY) + 1);                
                } 
```

看到从支架中弹出的线。那真令人恶心。

任何人都可以帮助解决这个问题吗？我查看了 Resharper->Options->Line Breaks 的设置，但找不到哪个可以修复它。干杯。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-17T16:38:58.577

这可能是 Visual Studio 的自动换行而不是 Resharper 设置吗？尝试关闭 VS 的包装：

工具 - 选项 - 文本编辑器 - 所有语言 - 自动换行

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-05-07T17:39:04.027

对于 Resharper 8.2

> Resharper > Options > Code Editing > C# > Formatting Style > Line Breaks and Wrapping > 取消选中 Wrap long lines

锐化选项 ![锐化选项](https://i.stack.imgur.com/FOsfx.png)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-17T10:20:58.893

查看 Resharper->Options->C#->Formating Style->Other->Indentation。

这可能是您正在寻找的选项。

# asp.net - ASP.Net 错误代码 128

> ID：756167
> 
> 赞同：0
> 
> 时间：2009-04-16T13:39:40.667
> 
> 标签：asp.net, publishing

我有一个在我的开发机器上运行良好的 ASP.Net 应用程序，但是，当发布到服务器时，我收到了这个错误

编译器错误消息：编译器失败，错误代码为 128。

我不知道为什么会发生这种情况我认为它可能与服务器上缓存的 dll 有关，有没有办法清除这个缓存？

任何帮助将不胜感激，谢谢。

**编辑**

¿ IIS 重置将重置其他 IIS 应用程序？我们在同一个 IIS 服务器上运行其他应用程序。我认为它会所以我不认为这是一个解决方案

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T13:43:01.343

您可以尝试在命令提示符窗口中运行以下命令：

```
iisreset 
```

# java - Java 网络编程。关于插座的问题

> ID：756169
> 
> 赞同：3
> 
> 时间：2009-04-16T13:39:45.267
> 
> 标签：java, networking, sockets

我有一个服务器，并且有 2 个客户端通过 TCP 连接到它。这些客户端不断地向服务器发送信息。这是一个代理服务器，它中继它从客户端接收到的消息。但它必须交替传递消息。即来自客户端A的消息，然后来自客户端B的消息，然后是A，然后是B，依此类推。我可以通过检查消息的来源来实现这一点，然后交替中继消息并忽略来自同一客户端的连续消息。

但是，如果任何客户端断开连接或不发送消息，我也不希望服务器陷入困境。如果发生这种情况，代理将继续永远等待来自客户端的某些消息，该客户端现在已断开连接（或由于某种原因未发送消息）。在这种情况下，我希望服务器从唯一连接的客户端中继消息。

相反，我在想这样的事情是否可行。如果我从同一个客户端收到 2 条连续消息，我想检查是否读取了另一个客户端以向我发送消息。我的问题是是否可以从其他客户端的套接字检查是否有消息缓冲并准备好发送。在这种情况下，可以忽略来自同一客户端的连续消息，而是首先发送来自另一个客户端的消息。（我已经检查过了。）

这可能吗？希望我已经清楚地问了这个问题。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T15:05:25.857

我正在阅读这个问题：

你有：

1台服务器

2个客户

您的服务器从客户端 1 和 2 获取消息并转发它们。

客户端是不同的生产者，这意味着他们发送的消息可能不同。您想要的是从您的服务器交替发送来自客户端的消息，但如果客户端已丢失，则不要“等待”。

在这种情况下，我建议您在服务器中有两个队列（client1queue 和 client2queue）。

您必须在两个单独的线程中从套接字读取，并且当消息进入时将其添加到相应的队列中。client1Socket -> client1queue client2Socket -> client2queue

然后，在第三个线程中，让服务器转发消息，交替从 client1queue 和 client2queue 拉出这些消息。

如果队列为空，要解决“不等待”的问题，只需跳过该队列的“转”。这可确保以尽可能快的速度发送所有消息，同时仍能传递所有消息。缺点是它仅在准备好发送消息时才会交替。当然，您可以让它等待 X 数量以查看是否有消息发送给另一个队列，但我不明白如果系统应该工作而不管客户端状态如何，您为什么想要这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:10:15.100

您可以使用 setSoTimeout() 方法将套接字上的读取超时设置为较短的时间（例如一秒钟或您想要等待每个客户端的任何时间）；这样，当您从客户端 A 收到第二条消息时，您可以从客户端 B 的套接字中读取（），如果您收到 SocketTimeoutException，那么您可以处理 A 的消息。

但是你必须修改你当前的代码来捕捉你从套接字读取时可能得到的任何 SocketTimeoutExceptions。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T14:34:04.997

问题是：要测试客户端是否被丢弃，您必须对套接字进行读取，但是，Java 的 Socket 类不允许异步读取套接字。因此，如果您在没有设置超时设置的情况下进行读取，并且没有发送任何内容，则应用程序将持有进程人质等待读取某些内容。

所以，在你实例化你的套接字之后，你需要使用： Socket.setSoTimeout(int) 在它超时之前给它一段时间来“等待”。将会发生的情况是，每次尝试读取时都会超时，如果读取返回 -1，您就知道客户端已断开连接。

```
 Socket clientSocket=theServerSocket.accept();
    clientSocket.setSoTimeout(1);
    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));

while(serverIsRunning){
       try{
           if(bufferedReader.read()==-1){
                  logger.info("The server has disconnected!");
                  //Do whatever clean up you need, ect
           }
       }
       catch (SocketTimeoutException e){
           //the server is still running, yay?!
       }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:33:42.220

出于我将在下面解释的原因，我只会将有趣的事件视为消息（或消息的一部分）是否已到达您的服务器。所以：

*   有一个线程从每个客户端读取数据，就像你可能已经得到的那样
*   有*另一个*线程进行消息整理
*   在以下情况下让客户端线程向消息整理线程发出信号： 新消息的第一部分到达；当来自客户端的消息完成时（此时，它将实际消息传递给整理线程）
*   然后，如果您的整理线程没有“消息的第一部分已到达”的初始信号，则将其视为“客户端尚未准备好发送消息”。

您*可能*希望像另一位发帖人所建议的那样在套接字上设置超时，尽管使用这种线程模型，我认为这并不重要——这实际上取决于您要实施的策略。

您询问客户的其他建议是可能的，但这可能不是您真正想要的解决方案。您向客户打开另一个频道询问“您刚刚发送了一些数据吗”。但是，如果客户有，而你没有得到它，那么一般来说，有些事情出了问题，不清楚这些知识是否会对你有很大帮助。或者它可能会说“不”，然后就在那一刻发送数据。客户的其他渠道是否有效？如果客户说它发送了一些东西，你怎么知道它是即将到达还是已经“丢失”并且永远不会到达......？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T14:38:47.700

我正在考虑这样做的方式是：如果我从客户端 A 收到 2 条连续消息，我将获得连接到客户端 B 的套接字的 inputStream。然后在 inputStream 上调用 available() 方法并查看是否有任何可用字节读书。如果有字节要读取，则从客户端 B 的套接字读取。否则从客户端 A 中继消息（第二个连续消息）。

对此有何评论。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T15:04:33.223

如果客户端 A 在客户端 B 发送消息之前发送了第二条消息，您是否打印出来自客户端 A 的第二条消息？在这种情况下，它根本不是真正的交替，您只是按照它们到达的顺序打印到达的任何消息。或者，您是否想稍等一下，看看是否有消息从客户端 B 到达？

我认为无论哪种方式，除了“主”线程之外​​，您都需要为每个客户端运行一个单独的线程。每个客户端线程不断尝试从其各自的客户端读取消息，该客户端会阻塞直到收到消息。当一个套接字线程接收到一条消息时，它会将它放到 a`SynchronousQueue`中，其中所有三个线程都有一个实例。此操作将阻塞，`put`直到主线程调用`take`.`SynchronousQueue`

主线程可以简单地循环并调用`take`. `SynchronousQueue`这将阻塞，直到其中一个客户端线程调用`put`。

如果你想做交替消息，你可以有两个`SynchronousQueue`s，每个客户端一个。你想在你的主循环中引入一些延迟，让两个客户端都有机会在转发之前编写他们的消息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T01:50:24.127

我会在 javadoc 中查找 available() 方法。它不会做你认为它会做的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T08:49:41.780

你有两个不同的问题：

1）从多个客户端读取消息，不阻塞。

2）以公平的方式将消息写入输出。

如果您为每个客户端套接字使用单独的线程，则可以解决第一个问题。如果你有很多客户端，你可以考虑使用非阻塞 io 使用 SocketChannel 和一个 Selector。

请记住，根据网络和套接字选项，TCP/IP 流可能会在每个读取操作中传递几个或仅部分消息，因此您必须注意这一点。

第二个问题可以通过为每个客户端保留一个队列来解决，或者可能使用优先级队列并根据客户端的活动为每条消息附加一个优先级。

# linux - 如何从共享库中导出符号

> ID：756174
> 
> 赞同：5
> 
> 时间：2009-04-16T13:40:57.793
> 
> 标签：linux, shared-libraries, arm, cross-compiling, rvds

我使用 Windows 主机上的 RVDS 编译器使用目标代码文件（C 源代码）创建了一个共享库 ( `*.so`) 。`*.o`

我将此共享对象与一个应用程序（`gcc`用于 Linux 主机上的 ARM 目标）链接并获得一个可执行文件，该可执行文件在运行时会产生分段错误。（我知道我必须调试它！）

如果我创建一个具有相同源文件的静态库，而不是创建共享库，然后与应用程序链接，然后执行应用程序，它可以按预期正常工作。

所以我的问题是：

1.  我是否需要使用某些结构在我的源文件中显式导出符号（导出到应用程序的函数）或任何其他符号，以便在与应用程序链接时正常工作？需要什么，我该怎么做？

2.  共享库是如何工作的？即，函数将被加载和运行的地址，将在创建库时在库中给出。应用程序（`main()`）如何解析要执行库函数的地址？

3.  静态库是如何工作的，即在静态库的情况下，这个地址规范和解析是如何发生的？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T14:32:49.460

这是它在 linux 上的工作方式：

1）不，你不需要做任何事情。但是，您可以使用 gcc`-fvisibility`命令行参数限制导出变量，并使用可见性属性显式标记导出的条目。

2) 可执行文件将具有它导入的所有函数的表（这些都是具有默认可见性的函数）。加载器/链接器将在运行之前选择一个地址来加载库并填充此表，对这些函数的调用是间接调用。（请注意，这也适用于共享对象）

3) 静态链接是在链接时执行的（在你编译之后）。实际地址在程序集中被替换，它们是直接调用。

注意：有一种叫做 PIC（位置无关代码）的东西。AFAIK，这处理对同一共享对象中的数据/函数的引用，因此链接器在加载库时不需要覆盖库的一半代码，因为代码不会对其进行任何绝对引用自己的数据。你可以尝试一下。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-02T03:22:26.037

1.  您不需要使用 导出符号`gcc`，因为它默认导出所有符号；但是，RVDS 可能会也可能不会这样做。检查您的 RVDS 编译器文档（尝试将其配置为“[可重定位 ELF](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0206g/Babjaihe.html) ”输出？）

2.  Linux 上的共享库必须是可重定位的，因为基地址是在运行时确定的。生成与位置无关的代码是理想的，因为它减少了重新定位库所需的工作量。如果您的库不可重定位，*它将*崩溃（换句话说，在创建动态库之前不要从目标文件中删除重定位信息）。在选择基地址并重新定位内部引用后，符号在运行时被解析为地址。

3.  对于静态库，所有符号解析、重定位和加载地址分配都在编译时发生。

我唯一的猜测是，你的编译器输出的代码在运行时是不可重定位的。对我来说，在不破坏静态库的情况下如何发生这种情况是一个谜，不过......

如果您直接从 RVDS 生成静态库和共享库，一种选择是尝试将该静态库转换为共享库：

```
gcc -shared -o libfoo.so libfoo.a 
```

如果这有帮助，那么 RVDS 的共享库链接器（或其配置）可能已损坏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-20T05:23:25.167

你知道坠机的原因吗？

如果您正在动态加载共享库（例如 via `dlopen()`），一种可能性是您假设库加载正常，而它没有加载，然后尝试通过空指针执行函数。

# sql - 有语法错误加入 3 个表

> ID：756177
> 
> 赞同：0
> 
> 时间：2009-04-16T13:42:04.717
> 
> 标签：sql, ms-access

我正在尝试使用以下 sql 语句加入 3 个表

```
Select 
    Sum(OrderDetail_table.Price * orderDetail_table.quantity) as totalPrice,
    item_table.GLacct 
from 
    OrderDetail_table 
    left outer join order_table on 
        orderDetail_table.orderID = order_table.orderid 
    left outer join item_table on 
        item_table.itemID = orderDetail_table.itemID 
where 
    Order_table.invoiceDate = #01/31/2009# 
group by 
    item_table.glacct 
```

我收到的错误消息是：

“查询表达式 'orderDetail_table.OrderID = order_table.orderid 中的语法错误（缺少运算符）在 item_table.itemID = orderDetail_table.itemID' 上左外连接 item_table。”

任何帮助，将不胜感激。谢谢

我希望它总是返回 orderDetail_table.price * orderDetail_table.quantity 的总和，orderDEtail_table.ItemID 可能没有 item_table.GLAcct

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T13:48:33.280

由于 OrderDetail 表始终是 Order 的一部分，并且每个详细信息始终引用一个 Item，因此您可以将 LEFT OUTER JOIN 替换为 INNER JOIN。特别是，因为 WHERE 和 GROUP BY 子句都引用了可选表。

错误信息到底是什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:51:23.367

试试括号：

```
Select
    Sum(OrderDetail_table.Price * orderDetail_table.quantity) as totalPrice,
    item_table.GLacct 
from
     (OrderDetail_table
     left outer join order_table on
         orderDetail_table.orderID = order_table.orderid)
     left outer join item_table on
         item_table.itemID = orderDetail_table.itemID
where
     Order_table.invoiceDate = #01/31/2009#
group by
     item_table.glacct 
```

# python - '例外例外：'上的pylint警告

> ID：756180
> 
> 赞同：24
> 
> 时间：2009-04-16T13:42:24.497
> 
> 标签：python, pylint

对于这样的块：

```
try:
    #some stuff
except Exception:
    pass 
```

pylint 引发警告 W0703 'Catch "Exception"'。为什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-16T13:44:45.817

通常不捕获根异常对象，而不是捕获更具体的对象（例如 IOException）被认为是一种很好的做法。

考虑是否发生内存不足异常 - 简单地使用“pass”不会让您的程序处于良好状态。

几乎唯一一次您应该捕获 Exception 是在程序的顶层，您可以（尝试）记录它，显示错误并尽可能优雅地退出。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-11T22:37:07.453

最好只捕获非常窄的类型。“异常”太笼统了——您最终不仅会捕获您计划的错误，还会捕获其他错误，这可能会掩盖代码中的错误，如果它们根本没有被捕获或可能会更快地诊断出来由单个非常高级的异常处理程序更好地处理。

话虽如此，从 Python2.6 开始，捕获 Exception 变得更加合理，因为您不想捕获的所有异常（SystemExit、KeyboardInterrupt）不再继承自 Exception。相反，它们从一个常见的 BaseException 继承。这样做是为了使捕获 Exception 相对无害，因为它是如此常见的习语。

有关详细信息和未来计划，请参阅[PEP 3110](http://www.python.org/dev/peps/pep-3110/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T13:45:33.240

因为它认为你抓的太多了。这是正确的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T13:46:09.450

当某些事情发生时引发异常......异常。程序终止通常是一件好事。

您可能想忽略一些例外情况，但 IMO 没有充分的理由捕捉这样的基类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-15T23:51:56.323

像 Greg 的回答一样，'Exception' 是一个基类，异常应该从这个类派生，另见[exceptions.Exception](http://docs.python.org/library/exceptions.html#exceptions.Exception)。

这里有一个非常有用的**[pydocs](http://docs.python.org/c-api/exceptions.html#standard-exceptions)****中的错误列表**

还要注意非常方便的回溯模块，它允许您找出异常发生的位置。仅使用 'except: ...' 将向您显示在您的情况下最好使用的错误。例如，试试这个代码（切换评论），也许你会接受它：

```
import traceback
#absent = 'nothing'
try:
    something = absent
except  NameError:
    traceback.print_exc()
else:
    print("you get here only when you uncomment 'absent'") 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-03T07:37:11.870

捕获异常（不重新引发）有两个非常糟糕的副作用：错误被吃掉，所以你丢失了堆栈跟踪，而且 ctrl-c （或者你操作系统上的任何中断键）也会在这里处理。

此类程序的典型行为是它们要么无法停止，要么 ctrl-c 导致控制流向前跳过（到异常处理程序），然后继续。然后要么代码不能被中断，要么你需要敲击 ctrl-c 让它停止。

# xml - 如何导入包含具有自定义命名空间的元素的 XML 外部实体？

> ID：756186
> 
> 赞同：2
> 
> 时间：2009-04-16T13:45:10.513
> 
> 标签：xml, xml-namespaces

试图在这里帮助一个朋友......有一些输出是由一个将xml节点输出到文件中的外部工具生成的。他需要使这个 xml 格式正确并在其上应用 xsl 样式表。

所以我们有 b.xml（由该工具生成）和 Encomp.xml，它们将 b.xml 的内容作为这样的 XML 外部实体导入（如果您想尝试，请在同一文件夹中创建 3 个 xml 文件）

**压缩文件**

```
<?xml version="1.0"  encoding="utf-8"?>

<!DOCTYPE document [ <!ENTITY data SYSTEM 'b.xml'>]>
<Root-Element xmlns:log="http://log4net.sourceforge.net/">
    &data;
</Root-Element> 
```

**b.xml**

```
<log:MyNode Name="Node1"/>
<log:MyNode Name="Node2"/>
<log:MyNode Name="Node3"/> 
```

**一个.xml**

```
<MyNode Name="Node1"/>
<MyNode Name="Node2"/> 
```

现在的问题是这种方法适用于 a.xml 之类的内容（其中节点没有使用名称空间限定），但不适用于 b.xml。

我的猜测是，命名空间可能在 DOCTYPE 行未定义，它仅在下一行声明。我怎样才能让它工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:50:45.023

b.xml 需要包含属性`xmlns:log="http://log4net.sourceforge.net/"`

**编辑**：实际上这并不能真正解决任何问题，底线是 DTD 无论如何都不理解 xmlns 声明和别名。因此，您最终会遇到其他错误。

# c# - 移动应用程序下载站点

> ID：756189
> 
> 赞同：0
> 
> 时间：2009-04-16T13:45:46.563
> 
> 标签：c#, asp.net-mvc

我们有一个我创建的 CMS，它运行良好，但现在我想将移动二进制（安装程序）文件的下载移动到 CMS。它们当前是从另一台服务器流式传输的。

我能看到的唯一解决方案是将哪些文件在哪些文件夹等中作为 Xml 文档的索引，并使用 Linq2Xml 检索文件并将它们流式传输到移动浏览器。我真的不想为此使用数据库。我正在考虑将下载门户升级到 MVC，因为它具有通过指定字节 []、文件名和 mime 将文件直接流式传输到浏览器的内置功能。

有更好的建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T14:21:17.023

直接从 MVC 控制器提供文件非常简单。这是我之前准备的一个，因为它是：

```
[RequiresAuthentication]
public ActionResult Download(int clientAreaId, string fileName)
{
    CheckRequiredFolderPermissions(clientAreaId);

    // Get the folder details for the client area
    var db = new DbDataContext();
    var clientArea = db.ClientAreas.FirstOrDefault(c => c.ID == clientAreaId);

    string decodedFileName = Server.UrlDecode(fileName);
    string virtualPath = "~/" + ConfigurationManager.AppSettings["UploadsDirectory"] + "/" + clientArea.Folder + "/" + decodedFileName;

    return new DownloadResult { VirtualPath = virtualPath, FileDownloadName = decodedFileName };
} 
```

实际上，您可能需要做更多的工作来确定要交付的文件（或者，更有可能，做一些完全不同的事情），但我只是将其简化为基础知识，作为显示有趣返回位的示例。

DownloadResult 是一个自定义的 ActionResult：

```
public class DownloadResult : ActionResult
{
    public DownloadResult()
    {
    }

    public DownloadResult(string virtualPath)
    {
        VirtualPath = virtualPath;
    }

    public string VirtualPath { get; set; }

    public string FileDownloadName { get; set; }

    public override void ExecuteResult(ControllerContext context)
    {
        if (!String.IsNullOrEmpty(FileDownloadName))
        {
            context.HttpContext.Response.AddHeader("Content-type",
                                                   "application/force-download");
            context.HttpContext.Response.AddHeader("Content-disposition",
                                                   "attachment; filename=\"" + FileDownloadName + "\"");
        }

        string filePath = context.HttpContext.Server.MapPath(VirtualPath);
        context.HttpContext.Response.TransmitFile(filePath);
    }
} 
```

# wordpress - 如何创建 wordpress 插件 - 每日报价 - 来自外部网站的报价

> ID：756191
> 
> 赞同：1
> 
> 时间：2009-04-16T13:46:55.377
> 
> 标签：wordpress, plugins

我想创建将显示“每日报价”的 wordpress 插件。我有一个包含大量报价的外部网站，我想在我的 wordpress 报价插件中使用它们。

有人告诉我 wordpress 不允许你使用 iframe。到目前为止，我看到的随机 Wordpress 引号插件只是显示手动插入的引号，而不是来自某些外部网站的引号。

编辑：我的网站正在使用 asp.net，并且那里有一个 rss 提要。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:49:08.333

我会解析报价网站的 RSS 提要（假设它有一个）并以这种方式显示报价。您应该能够使用 WordPress 的原生 RSS 支持来执行此操作。[在这里](http://www.darrenhoyt.com/2008/01/29/publishing-external-rss-headlines-to-your-wordpress-site/)查看一篇关于它的文章。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T13:54:20.023

Wordpress 站点有一个很好的[插件指南](http://codex.wordpress.org/Writing_a_Plugin)，它将解释基础知识，并提供到其他示例/教程站点的链接。

要收集“每日报价”，您有几个选择。首先也是最简单的方法是通过他们的 RSS 提要获取报价（如果有的话）。然后，一个简单的脚本将允许您将其放置在您想要的位置。

如果该站点不提供 RSS 提要，则您需要实现某种屏幕抓取脚本来抓取您想要的页面的相关部分。你没有提到你想使用什么语言，但是有很多不同语言的屏幕抓取工具。

*   [Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)非常适合 Python
*   [hpricot](http://wiki.github.com/why/hpricot)在 Ruby 中效果很好

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T03:54:48.530

如果您创建（或找到）一些可以获取所需信息的 php 代码，您可以创建一个小部件以在您的网站上以小部件的形式显示它。您可以使用 widgetifyr.com 将 php 代码包装在它为您创建的小部件中。创建小部件后，您可以像使用任何其他小部件一样在您的网站上使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-09-22T17:22:02.713

每日报价插件首先需要外部报价来源。即每天都会提供新报价的 RSS 提要或 json 或 XML 报价源。

接下来你需要学习 wordpress 的小部件开发，下面的参考资料将帮助你入门。

最后，一旦您掌握了基本知识，就很容易在 wordpress 中开发 PHP 脚本来渲染每天轮换的报价。

如需指导，您可以查看 wordpress 插件存储库中存在的著名的 Quote of the day 插件。

但不建议在未经他们许可的情况下使用来自任何其他网站的报价单。

下面是一些很好的链接和教程，它们还提供指向其他资源和教程站点的链接。

[http://codex.wordpress.org/Writing_a_Plugin](http://codex.wordpress.org/Writing_a_Plugin)

[https://wordpress.org/plugins/quote-of-the-day-itslum/](https://wordpress.org/plugins/quote-of-the-day-itslum/)

[http://www.darrenhoyt.com/2008/01/29/publishing-external-rss-headlines-to-your-wordpress-site/](http://www.darrenhoyt.com/2008/01/29/publishing-external-rss-headlines-to-your-wordpress-site/)

# c - 生成站点地图的最有效算法？

> ID：756201
> 
> 赞同：0
> 
> 时间：2009-04-16T13:48:56.120
> 
> 标签：c, xml, algorithm, sitemap

..给定一个 URL 作为输入（C 编程语言）。（来自 sitemap.org 的站点地图规范）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T03:03:44.287

正如 apphacker 的评论中所述，我们真的不知道您要做什么。如果您打算只从 html 网站上抓取链接，那么我会推荐某种词法扫描生成器：比如 flex。

如果您将网站 url 作为输入，那么您将需要使用一些网络代码来阅读网页。如果您对 C 中的网络一无所知，那么我建议您搜索 beej 的指南并从那里开始。

如果您只是按照标签的建议获得一个直接的 XML 文件，那么如果您绝对必须使用 C，我会再次推荐 flex。如果您不必使用 C，那么我会推荐 Perl 或 Python；他们可能更适合这份工作。

无论哪种方式，我们都需要您向我们提供更多信息，但我希望这对现在有所帮助。

# asp.net-mvc - 在 ASP.NET MVC 中实现分页的简单方法是什么？

> ID：756204
> 
> 赞同：0
> 
> 时间：2009-04-16T13:49:14.137
> 
> 标签：asp.net-mvc

作为 ASP.NET MVC 的新手，我想知道分页的简单方法。数据是 IQueryable 类型。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T14:26:02.833

我一直在使用[这种 PagedList 类型](http://www.squaredroot.com/post/2008/07/08/PagedList-Strikes-Back.aspx)，最初由 Rob Conery 开发，并由 Troy Goode 增强。我什至编写[了扩展方法，使其可以与 jqGrid 一起使用](http://blogs.teamb.com/craigstuntz/2009/04/15/38212/)。为了纯粹的易用性，我认为你不会击败它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T13:52:21.400

```
var dataPage = data.Skip(pageNumber * pageSize - pageSize).Take(pageSize); 
```

要了解 ASP.NET MVC 的基本技巧，我建议阅读[Scott Guthrie 的免费 Professional ASP.NET MVC 1.0 Book Chapter 1](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

# spring-mvc - 如何将 Struts 应用程序迁移到 Spring 中？

> ID：756207
> 
> 赞同：0
> 
> 时间：2009-04-16T13:50:01.157
> 
> 标签：spring-mvc, struts

如何将 Struts 应用程序迁移到 Spring 中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:25:45.953

检查 struts2spring-mvc-plugin。[http://code.google.com/p/struts2springmvc/](http://code.google.com/p/struts2springmvc/)

# java - oracle jdbc驱动版本疯狂

> ID：756208
> 
> 赞同：19
> 
> 时间：2009-04-16T13:50:03.450
> 
> 标签：java, sql, oracle, jdbc, ora-01722

为什么 Oracle 为每个（！）数据库版本提供不同（！）版本的 JDBC 驱动程序，例如 ojdbc14.jar？
这些文件都有不同的大小，因此可能有不同的内容。

背景：
我们在保存数据时收到一个随机且看似不可重现的错误，说“无效数字”（我们猜测它是时间戳）。但这不是任何特定的陈述。大多数时候，它保存得很好。一个月一次，看似无害的声明就会失败。

所以我仔细查看了 Oracle 的下载站点，发现尽管文件共享相同的名称，但没有一个文件大小匹配。

我们的产品在客户维护的数据库上运行，即客户运行的任何版本和补丁都是如此。
那么我们使用什么驱动呢？最新的（Oracle 11g）——尽管它通常是~~9i 和~~10g 数据库？

他们为什么不将所有版本链接到同一个“一个驱动程序适合所有人”文件？
或者是否存在细微的差异会导致我们的随机错误等影响？

编辑：我误解了 9i 数据库。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-16T13:56:56.037

请参阅 [http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-faq-090281.html#02_02上的兼容性矩阵](http://www.oracle.com/technetwork/database/enterprise-edition/jdbc-faq-090281.html#02_02)

另请注意，时间戳数据类型仅在 Oracle 10 之后才可用。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2018-02-15T13:01:12.233

ojdbc14.jar、ojdbc5.jar、ojdbc6.jar、ojdbc7.jar 和 ojdbc8.jar 中的数字指的是使用的 Java 编译器的版本。每个版本的 Java 都带有新的 JDBC API，因此这些数字对于了解预期内容很有用。例如在 Java 8 中，有一个新方法`executeLargeUpdate`. `java.sql.PreparedStatement`此方法将在 ojdbc8.jar 中实现，但不在 ojdbc7.jar 中实现。此外，如果您的运行时使用 Java 7，那么您知道您不能使用 ojdbc8.jar，否则您会遇到`java.lang.UnsupportedClassVersionError`错误。这就是 Oracle 在 jar 名称中包含这些数字的原因。另请注意，如果您想知道 jar 来自哪个 Oracle 数据库版本，您可以运行`java -jar ojdbc8.jar`. 数据库和驱动程序都向后兼容（最多 1 个主要版本），因此，即使建议这样做，您也不必在两个层上使用相同版本的产品。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T17:08:51.883

当我们将 Oracle 数据库从 8.1.7 升级到 10.2.0 时，我能够使用相同的 Oracle jdbc 驱动程序 (ojdbc14.jar)。所以他们的jdbc驱动同时支持好几个版本。当然，有些驱动程序可能有问题，但计划是同时支持更多版本。

# regex - RedirectMatch 和正则表达式 Tomfoolery

> ID：756216
> 
> 赞同：2
> 
> 时间：2009-04-16T13:52:05.817
> 
> 标签：regex, apache, .htaccess

我正在尝试将对 /library/ 的所有请求重定向到外部 URL，除非请求 .pdf 文件。例如 www.mysite.com/library/section 应该重定向到 www.externalsite.com 但 www.mysite.com/library/docs/some_pdf.pdf 应该提供 PDF 文件而不需要重定向。这是我所拥有的：

```
RedirectMatch permanent /library/!(.*\.pdf) http://www.externalsite.com/ 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T13:58:49.230

试试这个：

```
RedirectMatch permanent /library/(?!.*\.pdf) http://www.externalsite.com/ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T15:58:13.880

您可能想要匹配整个路径而不是子字符串：

```
RedirectMatch permanent ^/library/(?!.*\.pdf)$ ... 
```

# asp.net - 在 ASP.NET 的另一个 UpdatePanel 中使用 TargetControl 调用模式弹出窗口

> ID：756220
> 
> 赞同：2
> 
> 时间：2009-04-16T13:53:06.170
> 
> 标签：asp.net, asp.net-ajax, ajaxcontroltoolkit, modalpopupextender

我正在尝试调用 Modal Popup，但 TargetControl 与 ModalPopupExtender 所在的 UpdatePanel 不同。

这是代码：

```
<asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Conditional">
    <ContentTemplate>
        <asp:LinkButton ID="LinkButton1" runat="server">LinkButton</asp:LinkButton>
    </ContentTemplate>
</asp:UpdatePanel>
<asp:UpdatePanel ID="UpdatePanel2" runat="server"  UpdateMode="Conditional">
    <ContentTemplate>
        <asp:Panel ID="Panel1" runat="server">
        Test
        </asp:Panel>
        <cc1:ModalPopupExtender ID="Panel1_ModalPopupExtender" runat="server" 
            DynamicServicePath="" Enabled="True" TargetControlID="LinkButton1" PopupControlID="Panel1">
        </cc1:ModalPopupExtender>
    </ContentTemplate>
</asp:UpdatePanel> 
```

当我运行页面时出现错误“扩展程序不能位于与其扩展的控件不同的 UpdatePanel 中。” 显示。

我试图在 UpdatePanel2 中放置一个 Triggers 语句，但没有任何变化：

```
<Triggers>
        <asp:AsyncPostBackTrigger ControlID="LinkButton1" EventName="Click" />
    </Triggers> 
```

有可能这样做吗？谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T14:04:16.177

Move the extender to the first update panel:

```
 <asp:UpdatePanel ID="UpdatePanel1" runat="server" UpdateMode="Conditional">
    <ContentTemplate>
        <asp:LinkButton ID="LinkButton1" runat="server">LinkButton</asp:LinkButton>
                <ajaxToolkit:ModalPopupExtender ID="Panel1_ModalPopupExtender" runat="server" 
            DynamicServicePath="" Enabled="True" TargetControlID="LinkButton1" PopupControlID="Panel1">
        </ajaxToolkit:ModalPopupExtender>

    </ContentTemplate>
</asp:UpdatePanel>
<asp:UpdatePanel ID="UpdatePanel2" runat="server"  UpdateMode="Conditional">
    <ContentTemplate>
        <asp:Panel ID="Panel1" runat="server">
        Test
        </asp:Panel>
    </ContentTemplate>
</asp:UpdatePanel> 
```

# c++ - 如何在 main 中调用链表数组？

> ID：756222
> 
> 赞同：0
> 
> 时间：2009-04-16T13:53:17.513
> 
> 标签：c++

我这里有一个类，其中包含其他类汽车示例的链接列表

```
class transportation
{
    private;
     int id;
     list <car> *cars;
     int keyval;
    public :
      set()
      {
      }

      void setTransportation(int ids, list <car> *carss, int keyvals)
      {
          id=ids;
          cars[keyvals]=carss[keyvals];
          keyval=keyvals;
      }

      list <car> *getCars()
      {
          return cars;  // I have to accessed cars list to be modified in my main
                        // is this how I do it ?????
       } 
```

以上只是我的代码的摘录。我要做的是在 main 中设置汽车列表，因此我将在 main 中调用 setTransportation 并传入汽车列表以建立汽车链表。我在 setTransportation 上做对了吗？由于我必须为列表汽车数组动态分配内存，我该如何在我的主要功能中做到这一点？

```
int main()
{
    car bmw;
    transportation *ptr=new transportation;
    list <car> carList[100];
    list <transportation> transportationList;

   //other code
      if (i == 0) {
     bmw.setCar(iseq,type);
     carList[k].push_back(bmw);
     list <car> *inputList = (*ptr).getCars(); // is this how I accessed list from 
     inputList[k]=new list <car> [k];            // list class???
     (*ptr).setTransportation(iid,carList,k);
     transportationList.push_back((*ptr));
     k++;
     } 
```

任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:41:01.463

您的示例中有大量有问题的代码。我想指出其中的一些，以确保您的代码的含义实际上反映了您的意图。

```
 list <car> *cars; 
```

这是一个指向汽车列表的指针。可能不需要指针

```
 list <car> carList[100]; 
```

这是“汽车对象列表的 100 个元素数组”。您可能认为您正在制作“100 个元素长的汽车对象列表”，但事实并非如此。

```
 inputList[k]=new list <car> [k]; 
```

我认为这会创建一个新的列表对象数组“k”元素，并将其分配给“inputList”的第 k 个元素。

总而言之，指针的使用非常可疑。如果我判断错误并且这些实际上是故意的，请原谅我。遵循其他答案的建议以消除指针的使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:05:22.867

Take a look at [iterators](http://www.cplusplus.com/reference/std/iterator/).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T16:25:20.133

在 setTransportation 中，您可以传入对 std::list 的引用并将所有汽车从前一个列表复制到后者。

这是通过迭代器（请参阅[grahams](https://stackoverflow.com/questions/756222/how-do-i-call-array-of-linked-list-in-main/756267#756267)答案）和插入方法完成的。

例子：

```
std::list<car> cars();
// Fill cars with values.
std::list<car> otherCars(); // We could use copy-constructor here but not relevant.
otherCars.insert(otherCars.begin(), cars.begin(), cars.end()); // First argument is the position where you want to insert the values. 
```

因此 setTransportation 可能如下所示：

```
setTransportation(int id, const std::list<car> &cars, int keyvals)
{
    id = id;
    this->cars.insert(this->cars.begin(), cars.begin(), cars.end());
    keyvals = keyvals;
} 
```

请注意，您必须将运输中的“汽车”类型更改为“std::list< car >”而不是“std::list< car > *”，后者是指向汽车列表的指针。

*如果您有“使用命名空间标准；” 在文件的顶部，您不需要列表< T > 前面的 std::-prefix。*

# c# - 你能像在 C# 中一样优雅地编写置换函数吗？

> ID：756223
> 
> 赞同：5
> 
> 时间：2009-04-16T13:53:49.977
> 
> 标签：c#, python, algorithm

我非常喜欢这个 6 行解决方案，并试图在 C# 中复制它。基本上，它置换数组的元素：

```
def permute(xs, pre=[]):
  if len(xs) == 0:
     yield pre
  for i, x in enumerate(xs):
     for y in permute(xs[:i] + xs[i+1:], pre + [x]):
        yield y 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T14:13:01.583

Well, it probably isn't how I'd write it, but:

```
static IEnumerable<T[]> Permute<T>(this T[] xs, params T[] pre) {
    if (xs.Length == 0) yield return pre;
    for (int i = 0; i < xs.Length; i++) {
        foreach (T[] y in Permute(xs.Take(i).Union(xs.Skip(i+1)).ToArray(), pre.Union(new[] { xs[i] }).ToArray())) {
            yield return y;
        }
    }
} 
```

* * *

Re your comment; I'm not *entirely* clear on the question; if you mean "why is this useful?" - among other things, there are a range of brute-force scenarios where you would want to try different permutations - for example, for small ordering problems like travelling sales person (that aren't big enough to warrant a more sophisticated solution), you might want to check whether it is best to go {base,A,B,C,base}, {base,A,C,B,base},{base,B,A,C,base}, etc.

If you mean "how would I use this method?" - untested, but something like:

```
int[] values = {1,2,3};
foreach(int[] perm in values.Permute()) {
   WriteArray(perm);
}

void WriteArray<T>(T[] values) {
    StringBuilder sb = new StringBuilder();
    foreach(T value in values) {
        sb.Append(value).Append(", ");
    }
    Console.WriteLine(sb);
} 
```

If you mean "how does it work?" - iterator blocks (`yield return`) are a complex subject in themselves - Jon has a free chapter (6) [in his book](http://www.manning.com/skeet/), though. The rest of the code is very much like your original question - just using LINQ to provide the moral equivalent of `+` (for arrays).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:06:45.077

C# has a yield keyword that I imagine works pretty much the same as what your python code is doing, so it shouldn't be too hard to get a mostly direct translation.

However this is a recursive solution, so for all it's brevity it's sub-optimal. I don't personally understand all the math involved, but for good efficient mathematical permutations you want to use [factoradics](http://en.wikipedia.org/wiki/Factoradic). This article should help:
[http://msdn.microsoft.com/en-us/library/aa302371.aspx](http://msdn.microsoft.com/en-us/library/aa302371.aspx)

[Update]: The other answer brings up a good point: if you're just using permutations to do a shuffle there are still better options available. Specifically, the [Knuth/Fisher-Yates](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle) [shuffle](http://www.codinghorror.com/blog/archives/001015.html).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:18:06.237

虽然您不能在保持简洁的同时移植它，但您可以非常接近。

```
public static class IEnumerableExtensions
{
  public static IEnumerable<IEnumerable<T>> Permutations<T>(this IEnumerable<T> source)
  {
    if (source == null)
      throw new ArgumentNullException("source");

    return PermutationsImpl(source, new T[0]);
  }

  private static IEnumerable<IEnumerable<T>> PermutationsImpl<T>(IEnumerable<T> source, IEnumerable<T> prefix)
  {
    if (source.Count() == 0)
      yield return prefix;

    foreach (var x in source)
      foreach (var permutation in PermutationsImpl(source.Except(new T[] { x }),
                                                   prefix.Union(new T[] { x }))))
        yield return permutation;
  }
} 
```

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2009-04-16T14:04:50.230

Not entirely to the point I must admit after some comments, but the code below can be used to generate a random permutation of a finite sequence. It's a variation of the [Fisher-Yates shuffle algorithm](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle). The example uses a sequence of `int`'s but you can use any `Enumerable<T>` of course.

```
var ints = Enumerable.Range(0, 51);
var shuffledInts = ints.OrderBy(a => Guid.NewGuid()); 
```

You order by a random value (in this case a `Guid`) which essentially permutates your list. Whether [NewGuid](http://msdn.microsoft.com/en-us/library/system.guid.newguid.aspx) is a good source of randomness is debatable, but it's an elegant and compact solution (albeit for another problem then the question was actually about).

Taken from [Jeff Atwood (Coding Horror)](http://www.codinghorror.com/blog/archives/001008.html).

# asp.net - ASP.Net 文本框验证

> ID：756232
> 
> 赞同：0
> 
> 时间：2009-04-16T13:56:32.590
> 
> 标签：asp.net, validation

我有 2 个文本框控件，将在其中输入日期值。我想要它，以便如果在其中一个文本框中输入日期，则需要另一个文本框。

这可能是一个真正的菜鸟问题，但任何帮助将不胜感激。

提前致谢。

编辑：只是为了澄清一点。我使用比较验证器来检查输入到文本框中的值是否是日期，所以这不是问题。问题是我想要一些验证，以便如果将一个值输入到一个文本框中，则需要另一个值。否则，如果两个文本框都为空，则两者都不需要。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:11:26.750

好吧，你可以做两件事之一。首先，正如丹麦人所说，使用 textbox1 的 textchanged 属性将 validator2 的 Enabled 属性相应地设置为 true 或 false。只需确保将 textbox1 的 autopostback 属性设置为 true。如果您将它包装在更新面板中，这样看起来会更好，这样用户就不必看到自动回发。

另一种选择是使用自定义验证器控件，您可以在其中在 ServerValidate() 事件中编写验证逻辑。然后，您可以检查 textbox1 中输入的文本是否为日期，然后相应地验证 textbox2。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:10:31.387

如果您使用的是内置的验证控件，您可以`txtDate2`在 Page_Load 方法中根据`txtDate1`.

```
protected void Page_Load(object sender, EventArgs e)
{
   dateValidator2.Enabled != String.IsNullOrEmpty(txtDate.Text);
} 
```

在你的 aspx 文件中；

```
<asp:RequiredFieldValidator ID="dateValidator2" Enabled="false" runat="server" ErrorMessage="Some message"></asp:RequiredFieldValidator> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:06:17.653

为文本框 2 保留一个禁用的必填字段验证器。在 textbox1 的 textchanged 事件中启用它。确保在事件中检查 textbox1 中文本的长度，因为即使用户删除了在 textbox1 中输入的文本，也会触发 TextChanged 事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:36:50.013

如果你想要最好的用户体验，这个验证应该在客户端完成。

RequiredFieldValidator 控件实际上会生成 javascript 代码以在客户端执行验证，但它没有您正在寻找的“两者或无”功能。

因此，最好的解决方案是自己编写 javascript。有许多框架可以使这更容易。我建议使用 jQuery。

# c# - C#：引发继承的事件

> ID：756237
> 
> 赞同：147
> 
> 时间：2009-04-16T13:58:48.747
> 
> 标签：c#, events, inheritance

我有一个包含以下事件的基类：

```
public event EventHandler Loading;
public event EventHandler Finished; 
```

在从这个基类继承的类中，我尝试引发事件：

```
this.Loading(this, new EventHandler()); // All we care about is which object is loading. 
```

我收到以下错误：

*事件 'BaseClass.Loading' 只能出现在 += 或 -= (BaseClass') 的左侧*

我假设我不能像其他继承成员一样访问这些事件？

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2009-04-16T14:01:38.240

你必须做的是：

在您的基类（您已在其中声明事件）中，创建可用于引发事件的受保护方法：

```
public class MyClass
{
   public event EventHandler Loading;
   public event EventHandler Finished;

   protected virtual void OnLoading(EventArgs e)
   {
       EventHandler handler = Loading;
       if( handler != null )
       {
           handler(this, e);
       }
   }

   protected virtual void OnFinished(EventArgs e)
   {
       EventHandler handler = Finished;
       if( handler != null )
       {
           handler(this, e);
       }
   }
} 
```

（请注意，您可能应该更改这些方法，以检查是否必须调用事件处理程序）。

然后，在从这个基类继承的类中，您可以调用 OnFinished 或 OnLoading 方法来引发事件：

```
public AnotherClass : MyClass
{
    public void DoSomeStuff()
    {
        ...
        OnLoading(EventArgs.Empty);
        ...
        OnFinished(EventArgs.Empty);
    }
} 
```

* * *

## 回答 #2

> 赞同：131
> 
> 时间：2009-04-16T14:05:18.077

您只能访问声明类中的事件，因为 .NET 在实际保存委托的幕后创建私有实例变量。这样做..

```
public event EventHandler MyPropertyChanged; 
```

实际上是这样做的；

```
private EventHandler myPropertyChangedDelegate;

public event EventHandler MyPropertyChanged
{
    add { myPropertyChangedDelegate += value; }
    remove { myPropertyChangedDelegate -= value; }
} 
```

并这样做...

```
MyPropertyChanged(this, EventArgs.Empty); 
```

其实这是……

```
myPropertyChangedDelegate(this, EventArgs.Empty); 
```

因此，您（显然）只能从声明类中访问私有委托实例变量。

约定是在声明类中提供类似的东西..

```
protected virtual void OnMyPropertyChanged(EventArgs e)
{
    EventHandler invoker = MyPropertyChanged;

    if(invoker != null) invoker(this, e);
} 
```

然后，您可以`OnMyPropertyChanged(EventArgs.Empty)`从该类中的任何位置或继承层次结构下的任何位置调用以调用该事件。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-16T14:01:08.790

> 我假设我不能像其他继承成员一样访问这些事件？

恰恰。习惯上为基类中的每个事件提供受保护的函数，以启用从继承的类中引发`OnXyz`。`RaiseXyz`例如：

```
public event EventHandler Loading;

protected virtual void OnLoading() {
    EventHandler handler = Loading;
    if (handler != null)
        handler(this, EventArgs.Empty);
} 
```

在继承的类中调用：

```
OnLoading(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-20T14:24:03.990

您可以尝试这种方式，它适用于我：

```
public delegate void MyEventHaldler(object sender, EventArgs e);

public class B
{
    public virtual event MyEventHaldler MyEvent;
    protected override void OnChanged(EventArgs e)
    {
        if (MyEvent != null)
            MyEvent(this, e);
    }
}

public class D : B
{
    public override event MyEventHaldler MyEvent;
    protected override void OnChanged(EventArgs e)
    {
        if (MyEvent != null)
            MyEvent(this, e);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-18T15:14:39.310

不要复活旧线程，但如果有人在看，我所做的是

```
protected EventHandler myPropertyChangedDelegate;

public event EventHandler MyPropertyChanged
{
    add { myPropertyChangedDelegate += value; }
    remove { myPropertyChangedDelegate -= value; }
} 
```

这使您可以在派生类中继承事件，这样您就可以在无需包装方法的情况下调用它，同时保持 += 语法。我想如果你这样做了，你仍然可以使用包装方法来做到这一点

```
public event EventHandler MyPropertyChanged
{
   add { AddDelegate(value); }
   remove { RemoveDelegate(value); }
} 
```

# sql-server-2005 - 给出布尔结果的 T-SQL 过程

> ID：756240
> 
> 赞同：6
> 
> 时间：2009-04-16T13:59:22.770
> 
> 标签：sql-server-2005, tsql

我正在为 T-SQL 过程而苦苦挣扎，希望您能提供帮助。

我需要知道是否

1.  给定 ID 的表中存在一行
2.  如果一个（或多个）确实存在，那么最新的一个将另一个 ID 设置为 5。

所以我们需要从中取出行的第一个表有两个相关的 ID：CaseID 和 LocationID，它们都是整数。第二个表有 1 个称为 StateID 的相关 ID。

目前，我可以获取该行是否存在于表部分中，但是一旦我尝试执行任何操作，企业管理器就会在 END 语句之前给出语法错误。

```
CREATE PROCEDURE [dbo].[HasActiveCase] 
(
    @LocationID INTEGER
)

AS

DECLARE @CaseID AS INTEGER
SELECT @CaseID=CaseID FROM dbo.Cases WHERE @LocationID=LocationID

SELECT CASE WHEN 
    @CaseID IS NULL 
THEN 
    0
ELSE  
    -- do something here to check CaseEvents.StateID is not 5 (closed)
END
GO 
```

可能有一种方法可以在 JOIN 或其他东西中获得我需要的东西，但我在这里是一个完整的新手。

**检查 StateID 不是 5 并将结果作为真/假返回的最简单（理解）方法是什么？**（我知道 SQLServer 没有布尔类型，但有一个 Bit 类型。）

还有一个风格问题：ID 中的值有一个与之关联的文本字段——例如 CaseEvents.StateID 有文本“已关闭”。**我应该将值作为 ID 返回，然后在代码中替换 ID，还是返回 ID 已替换为文本的对象？**一个集合中返回的结果永远不会超过 20 或 30 个，并且表格永远不会很大，因为需要 5 年才能获得 2000 个结果。

**注意**：不能使用 linq（或任何其他 .NETty），因为这将从 VB6 程序中调用。

**更新**：

一次只能打开 1 个案例，因此只有最近的项目是相关的。

可能出现的情况是：

1.  从来没有开过任何案子。这应该返回 0。
2.  一个案子之前已经立案，但现在已经结案。这也应该返回 0。
3.  存在已打开的案例。这应该返回 1。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T14:08:43.233

我认为这个查询会做你正在寻找的；请注意，您现有的查询有一个错误，即如果存在多个案例，它将仅检查初始查询选择的任何案例是否已关闭（当然，只有在可能有多个案例时才适用分配到特定位置）。

```
SELECT @CaseID = dbo.Cases.CaseID
FROM dbo.Cases
    JOIN dbo.CaseEvents ON dbo.Cases.CaseEventID = dbo.CaseEvents.CaseEventID
WHERE @LocationID = dbo.Cases.LocationID
    AND 5 != dbo.CaseEvents.StateID

SELECT CASE WHEN @CaseID IS NULL THEN CAST(0 AS BIT) ELSE CAST(1 AS BIT) END AS CaseExists 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T14:03:39.110

检查这是否适合您。已编辑

```
CREATE PROCEDURE [dbo].[HasActiveCase] 
(
    @LocationID INTEGER
)

AS BEGIN
    DECLARE @CaseID AS INTEGER
    SELECT @CaseID = CaseID FROM dbo.Cases WHERE @LocationID=LocationID

    SELECT CASE WHEN 
        @CaseID IS NULL 
    THEN 0
    ELSE CASE WHEN (SELECT COUNT(*) FROM CaseEvents WHERE StateID <> 5) > 0 THEN 0 ELSE 1 END
    END
END
GO 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T14:14:08.227

解决这个问题的方法很多，这里有一个：

```
CREATE PROCEDURE [dbo].[HasActiveCase] 
(
    @LocationID INTEGER
)

AS

DECLARE @CaseID AS INTEGER
SELECT @CaseID=CaseID FROM dbo.Cases WHERE @LocationID=LocationID

if (@CaseId IS NULL)
BEGIN
    SELECT 0
END
ELSE if EXISTS ( SELECT * FROM CaseEvents WHERE StatusId=5 and CaseId=@CaseId)
BEGIN
    SELECT 1
END
ELSE
BEGIN
    SELECT 0
END
GO 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T14:09:57.270

这也可能有效：

```
CREATE PROCEDURE [dbo].[HasActiveCase] 
(
    @LocationID INTEGER
)

AS 
    IF EXISTS (SELECT CaseID FROM dbo.Cases WHERE @LocationID=LocationID)
    BEGIN
        IF EXISTS (SELECT * FROM CaseEvents WHERE StateID <> 5)
        SELECT 1 ELSE SELECT 0
    END
    ELSE
    SELECT 0

GO 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T14:13:38.633

试试这个：

```
 Select Case When Exists 
      (Select * From CaseEvents
       Where CaseId =
           (Select CaseID From Cases 
            Where LocationId = @Location)
       And StateId = 5)  -- Or <> 5 I'm not sure which you want here
      Then 1 Else 0 End 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-08-10T14:54:51.747

```
create procedure abc (id int)
as
declare @count int
begin
select @count=count(anycolumn) from table
where id=@id
if @count>0
return 1
else 
return 0
end 
```

# sql-server-2008 - SQL Server 2008 文件流错误

> ID：756251
> 
> 赞同：1
> 
> 时间：2009-04-16T14:02:31.033
> 
> 标签：sql-server-2008, filestream, updates

在我的本地 Windows XP 机器上，我无法再使用 FILESTREAM 创建数据库。

[替代文字 http://img379.imageshack.us/img379/9899/errorv.jpg](http://img379.imageshack.us/img379/9899/errorv.jpg)

此错误是由 MS 的以下安全更新之一引起的：

*   KB952004
*   KB923561
*   KB961373
*   KB956572
*   KB959426
*   KB960863

有人知道如何在不删除安全更新的情况下解决问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-23T17:48:59.727

遇到了同样的问题。终于从[http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=435855](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=435855)找到了解决方法。您必须以不同于网络服务的用户身份运行 sql server 服务。这可能会在以后引起其他问题……但至少可以创建启用 FILESTREAM 的数据库，我们可以继续创建表和数据并学习这个新功能。

# asp.net - 在 Page.Load 事件执行其工作时显示等待图像？

> ID：756252
> 
> 赞同：1
> 
> 时间：2009-04-16T14:02:40.143
> 
> 标签：asp.net

我有一个页面在页面加载时执行了很多方法.. 一些 ping 关闭并抓取一些外部页面并剥离内容以显示等.. 等等..

问题是这可能需要几秒钟的时间，页面只是挂起，而这一切都在后台进行......我希望能够显示带有动画 GIF 的页面，上面写着“正在工作”或其他内容...... . 并且仍然在后台页面加载中的方法正在填充 GridView 或其他任何内容，并且何时准备好显示结果？有任何想法吗？我必须使用 Udate 面板或其他东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T14:29:35.523

是的，我会让页面呈现，然后在 javascript 中粘贴一些东西来触发 AJAX 事件。在 AJAX 调用期间，显示一个等待的 div。当它回来时，让等待的 div 消失。您可以手动执行此操作，也可以使用 MS AJAX。IMO，最简单的方法是使用 MS AJAX。以下是我会尝试的方法（不由自主地）：

```
<asp:UpdateProgress id="uprogMain" runat="server">
  <ProgressTemplate>
    <div style="position: absolute; left: 100px; top: 100px; z-index: 1000; background-color: White;">
      Put some stuff here!
    </div>
  </ProgressTemplate>
</asp:UpdateProgress>
<asp:LinkButton id="btnGetLotsOfStuff" />
<asp:UpdatePanel id="upMain" runat="server">
  <Triggers>
    <asp:AsyncPostbackTrigger ControlID="btnGetLotsOfStuff" />
  </Triggers>
  <ContentTemplate>
    <div id="divResults" runat="server">
      <!-- This is where your time-intensive methods put their returned data -->
    </div>
  </ContentTemplate>
</asp:UpdatePanel> 
```

在您的 HTML 页面的末尾放置一个`<script>`标签，用于执行此操作：

```
<script type="text/javascript" language="javascript">
__doPostBack('btnGetLotsOfStuff', '');
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:12:15.313

带有 updateprogress 的 asp.net ajax 面板可能会满足您的需求，因为在 Page_load 期间根本没有向浏览器发送任何内容。

另一种选择是在导致回发的元素上显示通过 javascript 触发的 div 覆盖。当页面呈现时（在 page_load 和所有繁重的处理之后），div 覆盖将消失。jQuery 将是一个很好的库来查看这种类型的覆盖。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:06:16.997

# 编辑

我道歉，我完全误解了这个问题。我以为您在谈论浏览器中文档上的加载事件，而不是服务器端加载事件。我的错。

我原来的答案如下：

如果您的 html 定义一个 div 覆盖您要隐藏的区域。在其中放置您的请稍候消息和图标。

在页面加载的最后将 div 设置为显示，无。这将隐藏显示其背后内容的消息。您可能也希望绝对定位此 div，它不应该是您隐藏的内容的父级（否则，当您将 div 的显示设置为无时，您会隐藏内容）。

# java - kodo/jdo/FatalInternalException?

> ID：756258
> 
> 赞同：-1
> 
> 时间：2009-04-16T14:04:03.383
> 
> 标签：java, exception, jndi

Does anyone have an idea why this error happens or where I can get the JAR file which contains this class?

```
Caused by: java.lang.NoClassDefFoundError: kodo/jdo/FatalInternalException
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:164)
        at $Proxy0.<clinit>(Unknown Source)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:494)
        at java.lang.reflect.Proxy.newProxyInstance(Proxy.java:588)
        at weblogic.iiop.ProxyDesc.readResolve(ProxyDesc.java:45)
        ... 45 more 
```

My application uses `wlclient.jar` to perform a `JNDI` lookup... Thanks!

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-14T16:33:51.263

use weblogic.jar instead of wlcient.jar

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T20:36:44.317

这应该在名为 kodo* 的 jar 中（例如 -jdo-）。这个 jar 应该在你的类路径中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:19:17.013

您可以为此使用[jarFinder](http://www.jarfinder.com/index.php/java/search/~FatalInternalException~)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T05:57:21.833

我的类路径中有一个 jdo-* 文件，但它包含错误的类：

```
javax/jdo/JDOFatalInternalException.class 
```

该包以 javax 而不是 kodo 开头，并且类名以 JDO 为前缀...

# ios - Objective-C 中的字符串比较与 isEqualToString

> ID：756261
> 
> 赞同：0
> 
> 时间：2009-04-16T14:04:29.483
> 
> 标签：ios, objective-c, nsstring, string-comparison

我有一行代码导致“EXC_BAD_ACCESS”错误。该行代码如下（格式化为一行，为便于阅读去掉了嵌套代码）。

```
if (![sendData isEqualToString:@"-"]){ ... } 
```

实际错误发生在 IF 线上。奇怪的是，如果我在该行上放置一个断点，则 NSString 称为 sendData（显示为 NSCFString，其值为“-”，不带引号）。为什么这会导致错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:19:45.687

要解决这个问题，您必须在所有回调方法中设置断点。

问题很简单，代码试图访问它找不到的内存。

找到那行代码更难，因为回调不是按顺序调用的。

1.  添加更多断点
2.  添加更多 NSLog(..)
3.  考虑捕获异常（参见[在objective-c/cocoa 中抛出异常](https://stackoverflow.com/questions/324284/how-to-throw-an-exception-in-objective-c-cocoa/324301)）

* * *

从控制台输出：

```
Attaching to program: `/Users/rjstelling/Library/Application Support/iPhone Simulator/User/Applications/C04A40BB-1D98-402E-BBEF-37E6FB860089/TwoViewApp.app/TwoViewApp', process 24032.
Re-enabling shared library breakpoint 1
2009-04-16 16:16:45.830 TwoViewApp[24032:20b] stream event 1
2009-04-16 16:16:45.831 TwoViewApp[24032:20b] on input stream
2009-04-16 16:16:45.831 TwoViewApp[24032:20b] stream event 1
2009-04-16 16:16:45.832 TwoViewApp[24032:20b] on output stream
2009-04-16 16:16:45.832 TwoViewApp[24032:20b] stream event 4
2009-04-16 16:16:45.832 TwoViewApp[24032:20b] on output stream
2009-04-16 16:16:45.833 TwoViewApp[24032:20b] stream has space open
(gdb) continue
2009-04-16 16:17:06.405 TwoViewApp[24032:20b] We made it - ok!
2009-04-16 16:17:06.406 TwoViewApp[24032:20b] stream event 2
2009-04-16 16:17:06.406 TwoViewApp[24032:20b] on input stream
2009-04-16 16:17:06.407 TwoViewApp[24032:20b] Processing: +OK CONN PinkNotes® Plus Master v5.00.26 Beta (v4 compatible)
:tPNPStr
2009-04-16 16:17:06.407 TwoViewApp[24032:20b] SendData= USER (null):tPNPStr
Current language:  auto; currently objective-c
Program received signal:  “EXC_BAD_ACCESS”.
(gdb) 
```

问题发生在某个地方或之后`ProcessData`，我认为这是一个回调。尝试在 TwoViewAppAppDelegate.m 的第 157 行附近放置一个断点

* * *

`EXC_BAD_ACCESS`如果您添加，则不是该行导致：

```
else
{
    NSLog(@"We made it - ok!");
} 
```

对于 if() 语句，您可以看到它通过`if ( ![sendData isEqualToString:@"-"] ){...}`

当您从方法调用返回时会发生错误。

* * *

好的，您的评论可能会有所帮助：

如果您使用`@"My string"`编译器创建字符串，如果它们具有相同的内容，它们会将它们映射到*相同*的内存，即：

```
NSString *var1 = @"string1";
NSString *anotherstring = @"string1";
NSString *morestringivars = @"string1"; 
```

都将指向相同的内存空间。

这可能会有所帮助，但我不确定如何？也许您可以发布更多代码，以便我可以在我的设置上运行它。

* * *

请记住，在 iPhone 上的事件周期开始时会创建一个自动释放池。

因此，最好在将 sendData 分配给 ivar 后立即在 sendData 上调用 autorelease。

```
...

[sendData autorelease];

... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:07:52.517

听起来您正试图向内存已被释放的对象发送消息。确保您遵循[Cocoa 内存管理编程指南中](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/index.html)讨论的正确内存管理技术。解决方法可能是`[sendData retain]`在释放之前的某个时间点添加 a，但要了解它的工作原理，您必须阅读上述指南。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T21:27:19.687

在发布后将您的对象设置为 nil 以防止在向不可用对象发送消息时崩溃。

# c# - 如何使用 VB.net 或 C# 以面向对象的方式跨插入管理数据库连接和事务？

> ID：756276
> 
> 赞同：1
> 
> 时间：2009-04-16T14:07:21.473
> 
> 标签：c#, vb.net, oop, database-connection

我现在在我的编程开发中，我试图利用面向对象的设计，而不是我一直在做的按钮程序背后的基本功能。

在当前项目中，我正在重复、复制和粘贴 sql server 插入代码并将其迁移到具有属性、方法等的类...

我遇到的一个问题是如何保持与数据库的低连接，同时跨多个对象进行插入，从而跨多个表。

以一种程序方式，我一直在使用 ADO.net 事务写入一个表，然后根据插入的记录的 ID，将附加信息写入另一个表——在第二个作业完成之前不关闭连接。我使用事务，所以如果后面的插入失败，第一次插入可以撤消，并使用 try、catch、finally 关闭连接，无论连接成功还是失败。

您如何在面向对象的世界中处理这个问题？

编辑：感谢大家的回答。我得到它。这是另一个问题，也有助于我澄清：[ASP.NET/ADO.NET：处理 .NET 对象内的许多数据库连接？](https://stackoverflow.com/questions/334729/asp-net-ado-net-handling-many-database-connections-inside-a-net-object)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T14:11:11.057

嗯，差别不大。

您的“对象”（我假设您的意思是您正在使用类；这些类的实例代表您的业务领域中的“项目”），不应该关心这些事务。也就是说，他们不应该知道交易，他们不应该负责处理交易。

事务应该由另一个对象发起和处理。某种“经理”。此类启动、提交和回滚事务。
您将在您的应用程序中使用此管理器，例如，在您的表单中。
对我来说，这是处理事务的唯一正确方法，因为您的应用程序知道“上下文”。您的应用程序知道您必须对数据库执行多少次往返，应用程序知道事务应该持续多长时间。你的对象不知道这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:10:00.233

至于管理连接，不要。.Net 将为您保留一个池，并有效地回收它们。试图自己回收它们实际上会损害性能。

除此之外，听起来您做得对，插入，获取 ID，在该范围内使用相同的连接再次插入。

# vb.net - VB.NET 如何检查 PictureBox 是否包含图像？

> ID：756284
> 
> 赞同：3
> 
> 时间：2009-04-16T14:08:51.080
> 
> 标签：vb.net

我正在使用 VB.NET 表单应用程序，我需要检查 PictureBox 当前是否有图像。我该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-16T14:11:55.410

```
If Not pictureBox.Image is Nothing Then
    //do stuff here
Else
    //do other stuff
End If 
```

# ibm-midrange - RPGLE (PROCPTR) 中的过程指针

> ID：756290
> 
> 赞同：2
> 
> 时间：2009-04-16T14:10:06.613
> 
> 标签：ibm-midrange, rpgle

任何人都可以提供这些有趣的使用示例吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2017-04-28T13:06:02.620

举一个实际的例子，这可以在实现回调时使用。可以在 C 中的 qsort() 函数中找到一个常见的回调。是的，您可以从 ILERPG 中调用它。

qsort()的`C`规范是：

```
#include <stdlib.h>
void qsort(void *base, size_t num, size_t width,
           int(*compare)(const void *key, const void *element)); 
```

`RPGLE`原型看起来像：

```
dcl-pr qsort      ExtName('qsort');
  array           Pointer value;
  num             Uns(10) value;
  width           Uns(10) value;
  compare         Pointer(*proc) value;
end-pr; 
```

这是一个使用 qsort() 的简单程序：

```
 ctl-opt DftActGrp(*No) Actgrp(*New);

   dcl-pr qsort     ExtProc('qsort');
     array          Pointer value;
     num            Uns(10) value;
     width          Uns(10) value;
     compare        Pointer(*Proc) value;
   end-pr;

   dcl-s strings    Varchar(10) Dim(20);

   strings(1) = 'Does';
   strings(2) = 'this';
   strings(3) = 'array';
   strings(4) = 'sort';
   strings(5) = 'properly?';

   qsort(%addr(strings): 5: %size(strings): %paddr(compareStrings));

   dsply strings(1);
   dsply strings(2);
   dsply strings(3);
   dsply strings(4);
   dsply strings(5);

   return;

   dcl-proc compareStrings;
     dcl-pi *n Int(10);
       key      Like(strings);
       element  Like(strings);
     end-pi;

     dcl-s result    Int(10);

     if key < element;
       result = -1;
     elseif key = element;
       result = 0;
     else;
       result = 1;
     endif;

     return result;
   end-proc; 
```

如果你运行它，输出将是：

```
DSPLY  array    
DSPLY  properly?
DSPLY  sort     
DSPLY  this     
DSPLY  Does 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-28T20:25:35.090

朱朱马，

对于一个简单的示例，您可以使用它来实现一些面向对象的样式过程，例如 Draw。通过将 Circle_Draw 或 Square_Draw 的适当 %PADDR 分配给 Draw 过程指针，您可以为 Circle 调用 Circle_Draw 过程或为 Square 调用 Square_Draw 过程。当调用 Draw 过程指针时，您隐藏了正在调用的过程（Circle_Draw 或 Square_Draw）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-04-04T16:39:30.757

我已经使用过程指针将搜索假脱机文件的逻辑封装到它自己的名为`SPLFFUNC`for 的服务程序中，以便更容易地对其进行迭代。

在调用程序中，您可以使用如下代码：

```
ForEachSPLF(%paddr(ProcessSPLA0100) :                                 
         'SPLA0100'   :          // desired format, can be SPLF0100, SPLF0300, or SPLA0100                
         *BLANKS      :          // filter for all user names     
         ToUpper(SendQueue)    : // out queue                     
         ToUpper(SendQueueLib) : // out queue library             
         *BLANKS      :          // filter for all form types     
         *BLANKS      );         // filter for any user data 
```

和

```
P ProcessSPLA0100...                                          
P                 B                                           
D                 PI                                          
D  SPLA                               LIKEDS(SPLA0100)     

P                 E 
```

对于每个匹配请求标准的假脱机文件，将调用一次指向的过程。这使您可以返回惰性可枚举而不是数组。我喜欢这个，因为它是可重用的，它不受特定大小的数组的限制（因为我不知道要分配多少），而且它的内存占用要小得多，因为你一次只存储一个数据结构。这大致相当于您在 C# 等语言中使用 lambda 所做的事情。由于指向的过程可以访问客户端程序中的任何全局变量，它关闭它们以执行客户端程序的实际工作。

服务程序中的代码处理调用 API、读取用户空间对象等所有血腥细节。因此可以将这些细节排除在客户端程序之外。

请注意，RPG 不为这种技术提供编译类型类型检查，因此您必须确保您请求的格式和指向过程中定义的数据结构匹配。

服务计划：

```
 H NOMAIN
 H DEBUG(*YES)
 H THREAD(*SERIALIZE)
 H BNDDIR('ERRFUNC')
 H OPTION(*SrcStmt:*NoDebugIO)
 H TEXT('Services for looping through spooled files')

 * To compile:
 *
 * CRTRPGMOD MODULE(QGPL/SPLFFUNC) SRCFILE(QGPL/QRPGLESRC)
 *
 * CRTSRVPGM SRVPGM(QGPL/SPLFFUNC) EXPORT(*SRCFILE)

 /copy QRPGLESRC,SPLFFUNCPR
 /copy QRPGLESRC,ERRFUNCPR

 ********************************************************************

 P ForEachSPLF     B                   EXPORT
 D                 PI
 D  ExecProcedure                  *   VALUE PROCPTR
 D  Format                       10A   VALUE
 D  UserName                     10A   VALUE
 D  OutQueue                     10A   VALUE
 D  OutQueueLib                  10A   VALUE
 D  FormType                     10A   VALUE
 D  UserData                     10A   VALUE

 D CrtUserSpace    PR                  EXTPGM('QUSCRTUS')
 D                               20A   CONST                                Name
 D                               10A   CONST                                Attribute
 D                               10I 0 CONST                                Intial size
 D                                1A   CONST                                Initial value
 D                               10A   CONST                                Authority
 D                               50A   CONST                                Text
 D                               10A   CONST OPTIONS(*nopass)               Replace existing
 D                            32767A   OPTIONS(*varsize:*nopass)            Error feedback

 D GetPointer      PR                  EXTPGM('QUSPTRUS')
 D                               20A   CONST                                User space name
 D                                 *                                        Pointer
 D                            32767A   OPTIONS(*varsize:*nopass)            Error feedback

 D DltUserSpace    PR                  EXTPGM('QUSDLTUS')
 D  QUSPTRUS                     20A   CONST                                User space name
 D                            32767A   OPTIONS(*varsize:*nopass)            Error feedback

 /copy qsysinc/qrpglesrc,qusec

 D ListSplFiles    PR                  EXTPGM('QUSLSPL')
 D                               20A   CONST                                userspace library
 D                                8A   CONST                                format
 D                               10A   CONST                                user name
 D                               20A   CONST                                output queue
 D                               10A   CONST                                form type
 D                               10A   CONST                                user data
 D                            32767A   OPTIONS(*varsize:*nopass)

 D GetSplfAttrib   PR                  EXTPGM('QUSRSPLA')
 D  receiver                           LIKEDS(SPLA0100)                     receiver structure
 D                               10I 0 CONST                                receiver length
 D                                8A   CONST                                format
 D                               26A   CONST                                qualified job name
 D                               16A   CONST                                internal job ID
 D                               16A   CONST                                internal SPLF ID
 D                               10A   CONST                                file name
 D                               10I 0 CONST                                file number
 D                            32767A   OPTIONS(*varsize:*nopass)

 *      Generic header format 0100
 D GenericHeader   DS                  BASED(UserSpacePointer) QUALIFIED
 D   ListOffset                  10I 0 OVERLAY(GenericHeader:125)
 D   ListCount                   10I 0 OVERLAY(GenericHeader:133)
 D   ListEachSize                10I 0 OVERLAY(GenericHeader:137)

 D SPLF1           DS                  LIKEDS(SPLF0100) BASED(FieldPointer)
 D SPLF3           DS                  LIKEDS(SPLF0300) BASED(FieldPointer)
 D SPLA1           DS                  LIKEDS(SPLA0100)
 D I               S              5I 0
 D SpaceName       S             20A
 D FileNum         S             10I 0 INZ(0)
 D reqFormat       S             10A

 D ptrSPLF0100     S               *   PROCPTR
 D procSPLF0100    PR                  EXTPROC(ptrSPLF0100)
 D  SPLF                               LIKEDS(SPLF0100)

 D ptrSPLF0300     S               *   PROCPTR
 D procSPLF0300    PR                  EXTPROC(ptrSPLF0300)
 D  SPLF                               LIKEDS(SPLF0300)

 D ptrSPLA0100     S               *   PROCPTR
 D procSPLA0100    PR                  EXTPROC(ptrSPLA0100)
 D  SPLF                               LIKEDS(SPLA0100)

 * Validate Parameters

 ptrSPLF0100 = ExecProcedure;
 ptrSPLF0300 = ExecProcedure;
 ptrSPLA0100 = ExecProcedure;
 IF Format <> 'SPLF0100' AND Format <> 'SPLF0300' AND
    Format <> 'SPLA0100';
   ThrowError('Spooled file information format must be -
   ''SPLF0100'', ''SPLF0300'', or ''SPLA0100''.');
 ENDIF;
 IF OutQueue = *BLANKS;
   OutQueue = '*ALL';
   OutQueueLib = *BLANKS;
 ELSE;
   IF OutQueueLib = *BLANKS;
     OutQueueLib = '*LIBL';
   ENDIF;
 ENDIF;
 IF UserName = *BLANKS;
   UserName = '*ALL';
 ENDIF;
 IF FormType = *BLANKS;
   FormType = '*ALL';
 ENDIF;
 IF UserData = *BLANKS;
   UserData = '*ALL';
 ENDIF;

 * To view this user space object:
 *
 * DSPF STMF('/QSYS.lib/QTEMP.lib/@SPOOLSPC.usrspc')
 *   or
 * DMPOBJ OBJ(QTEMP/@SPOOLSPC) OBJTYPE(*USRSPC)

 SpaceName = '@SPOOLSPC QTEMP';
 CrtUserSpace(SpaceName : '' : 131072 : x'00' :
             '*ALL':'List of spooled files':'*YES':QUSEC);

 *  DSPLY ('ListSplFiles' + SpaceName + Format + UserName);
 *  DSPLY (OutQueue + OutQueueLib + FormType + UserData);
 IF Format = 'SPLF0300';
   reqFormat = Format;
 ELSE;
   reqFormat = 'SPLF0100';
 ENDIF;
 ListSplFiles(SpaceName : reqFormat : UserName :
              OutQueue + OutQueueLib : FormType : UserData : QUSEC);

 GetPointer(SpaceName : UserSpacePointer) ;

 FOR I = 1 to GenericHeader.ListCount ;
   FieldPointer = UserSpacePointer
                + GenericHeader.ListOffset
                + (GenericHeader.ListEachSize * (I - 1)) ;

   IF Format = 'SPLF0100';
     procSPLF0100(SPLF1);
   ELSEIF Format = 'SPLF0300';
     procSPLF0300(SPLF3);
   ELSEIF Format = 'SPLA0100';
     GetSplfAttrib(SPLA1 : %size(SPLA1) : 'SPLA0100' : '*INT' :
                   SPLF1.InternalJobID : SPLF1.InternalSplID :
                   '*INT' :  FileNum : QUSEC);
     procSPLA0100(SPLA1);
   ENDIF; 
 ENDFOR;
 DltUserSpace(SpaceName : QUSEC) ;
 RETURN;

 P                 E 
```

服务程序原型：

```
 D ForEachSPLF     PR                  EXTPROC('ForEachSPLF')
 D  ExecProcedure                  *   VALUE PROCPTR
 D  Format                       10A   VALUE
 D  UserName                     10A   VALUE
 D  OutQueue                     10A   VALUE
 D  OutQueueLib                  10A   VALUE
 D  FormType                     10A   VALUE
 D  UserData                     10A   VALUE

 ********************************************************************

 D SPLF0100        DS                  TEMPLATE QUALIFIED INZ
 D  UserName                     10A   OVERLAY(SPLF0100:1)
 D  OutQName                     10A   OVERLAY(SPLF0100:11)
 D  OutQLibrary                  10A   OVERLAY(SPLF0100:21)
 D  FormType                     10A   OVERLAY(SPLF0100:31)
 D  UserSpecData                 10A   OVERLAY(SPLF0100:41)
 D  InternalJobID                16A   OVERLAY(SPLF0100:51)
 D  InternalSplID                16A   OVERLAY(SPLF0100:67)
 D  Reserved                      2A   OVERLAY(SPLF0100:83)
 D  AuxStorage                   10I 0 OVERLAY(SPLF0100:85)

 ********************************************************************

 D SPLF0300        DS                  TEMPLATE QUALIFIED INZ
 D  JobName                      10A   OVERLAY(SPLF0300:1)
 D  UserName                     10A   OVERLAY(SPLF0300:11)
 D  JobNumber                     6A   OVERLAY(SPLF0300:21)
 D  FileName                     10A   OVERLAY(SPLF0300:27)
 D  FileNumber                    9B 0 OVERLAY(SPLF0300:37)
 D  FileStatus                    9B 0 OVERLAY(SPLF0300:41)
 D  DateCreated                   7A   OVERLAY(SPLF0300:45)
 D  TimeCreated                   6A   OVERLAY(SPLF0300:52)
 D  Schedule                      1A   OVERLAY(SPLF0300:58)
 D  FileSysName                  10A   OVERLAY(SPLF0300:59)
 D  UserData                     10A   OVERLAY(SPLF0300:69)
 D  FormType                     10A   OVERLAY(SPLF0300:79)
 D  OutQName                     10A   OVERLAY(SPLF0300:89)
 D  OutQLibrary                  10A   OVERLAY(SPLF0300:99)
 D  AuxStorePool                  9B 0 OVERLAY(SPLF0300:109)
 D  Size                          9B 0 OVERLAY(SPLF0300:113)
 D  SizeMult                      9B 0 OVERLAY(SPLF0300:117)
 D  Pages                         9B 0 OVERLAY(SPLF0300:121)
 D  CopiesLeft                    9B 0 OVERLAY(SPLF0300:125)
 D  Priority                      1A   OVERLAY(SPLF0300:129)
 D  Reserved                      3A   OVERLAY(SPLF0300:130)
 D  InterPrintID                  9B 0 OVERLAY(SPLF0300:133)

 ********************************************************************

 D SPLA0100        DS                  TEMPLATE QUALIFIED INZ
 D  BytesReturned                10I 0 OVERLAY(SPLA0100:1)
 D  BytesAvail                   10I 0 OVERLAY(SPLA0100:5)
 D  InternalJobID                16A   OVERLAY(SPLA0100:9)
 D  InternalSplID                16A   OVERLAY(SPLA0100:25)
 D  JobName                      10A   OVERLAY(SPLA0100:41)
 D  UserName                     10A   OVERLAY(SPLA0100:51)
 D  JobNumber                     6A   OVERLAY(SPLA0100:61)
 D  FileName                     10A   OVERLAY(SPLA0100:67)
 D  FileNumber                   10I 0 OVERLAY(SPLA0100:77)
 D  FormType                     10A   OVERLAY(SPLA0100:81)
 D  UserData                     10A   OVERLAY(SPLA0100:91)
 D  Status                       10A   OVERLAY(SPLA0100:101)
 D  FileAvailable                10A   OVERLAY(SPLA0100:111)
 D  HoldBefore                   10A   OVERLAY(SPLA0100:121)
 D  SaveAfter                    10A   OVERLAY(SPLA0100:131)
 D  TotalPages                   10I 0 OVERLAY(SPLA0100:141)
 D  PageWritten                  10I 0 OVERLAY(SPLA0100:145)
 D  StartingPage                 10I 0 OVERLAY(SPLA0100:149)
 D  EndingPage                   10I 0 OVERLAY(SPLA0100:153)
 D  LastPagePrint                10I 0 OVERLAY(SPLA0100:157)
 D  Restart                      10I 0 OVERLAY(SPLA0100:161)
 D  TotalCopies                  10I 0 OVERLAY(SPLA0100:165)
 D  CopiesLeft                   10I 0 OVERLAY(SPLA0100:169)
 D  LinesPerInch                 10I 0 OVERLAY(SPLA0100:173)
 D  CharsPerInch                 10I 0 OVERLAY(SPLA0100:177)
 D  OutPriority                   2A   OVERLAY(SPLA0100:181)
 D  OutQueueName                 10A   OVERLAY(SPLA0100:183)
 D  OutQueueLib                  10A   OVERLAY(SPLA0100:193)
 D  DateCreated                   7A   OVERLAY(SPLA0100:203)
 D  TimeCreated                   6A   OVERLAY(SPLA0100:210)
 D  DeviceFileName...
 D                               10A   OVERLAY(SPLA0100:216)
 D  DeviceFileLib                10A   OVERLAY(SPLA0100:226)
 D  ProgramName                  10A   OVERLAY(SPLA0100:236)
 D  ProgramLib                   10A   OVERLAY(SPLA0100:246)
 D  AccountingCde                15A   OVERLAY(SPLA0100:256)
 D  PrintText                    30A   OVERLAY(SPLA0100:271)
 D  RecordLength                 10I 0 OVERLAY(SPLA0100:301)
 D  MaxRecords                   10I 0 OVERLAY(SPLA0100:305)
 D  DeviceType                   10A   OVERLAY(SPLA0100:309)
 D  PrinterType                  10A   OVERLAY(SPLA0100:319)
 D  DocumentName                 12A   OVERLAY(SPLA0100:329)
 D  FolderName                   64A   OVERLAY(SPLA0100:341)
 D  Sys36ProcName                 8A   OVERLAY(SPLA0100:405)
 D  PrintFidelity                10A   OVERLAY(SPLA0100:413)
 D  ReplaceUnprintable...
 D                                1A   OVERLAY(SPLA0100:423)
 D  ReplacementChar...
 D                                1A   OVERLAY(SPLA0100:424)
 D  PageLength                   10I 0 OVERLAY(SPLA0100:425)
 D  PageWidth                    10I 0 OVERLAY(SPLA0100:429)
 D  NumSeparators                10I 0 OVERLAY(SPLA0100:433)
 D  OverflowLine                 10I 0 OVERLAY(SPLA0100:437)
 D  MultiByteData                10A   OVERLAY(SPLA0100:441)
 D  DBCSExtenChar                10A   OVERLAY(SPLA0100:451)
 D  DBCSShiftOut                 10A   OVERLAY(SPLA0100:461)
 D  DBCSCharRot                  10A   OVERLAY(SPLA0100:471)
 D  DBCSCPI                      10I 0 OVERLAY(SPLA0100:481)
 D  GraphCharSet                 10A   OVERLAY(SPLA0100:485)
 D  CodePage                     10A   OVERLAY(SPLA0100:495)
 D  FormDefName                  10A   OVERLAY(SPLA0100:505)
 D  FormDefLib                   10A   OVERLAY(SPLA0100:515)
 D  SourceDrawer                 10I 0 OVERLAY(SPLA0100:525)
 D  PrinterFont                  10A   OVERLAY(SPLA0100:529)
 D  Sys36SPLFID                   6A   OVERLAY(SPLA0100:539)
 D  PageRotation                 10I 0 OVERLAY(SPLA0100:545)
 D  Justification                10I 0 OVERLAY(SPLA0100:549)
 D  PrintDuplex                  10A   OVERLAY(SPLA0100:553)
 D  FoldRecords                  10A   OVERLAY(SPLA0100:563)
 D  ControlChar                  10A   OVERLAY(SPLA0100:573)
 D  AlignForms                   10A   OVERLAY(SPLA0100:583)
 D  PrintQuality                 10A   OVERLAY(SPLA0100:593)
 D  FormFeed                     10A   OVERLAY(SPLA0100:603)
 D  VolumesArray                 71A   OVERLAY(SPLA0100:613)
 D  FileLabelID                  17A   OVERLAY(SPLA0100:684)
 D  ExchangeType                 10A   OVERLAY(SPLA0100:701)
 D  CharacterCode                10A   OVERLAY(SPLA0100:711)
 D  TotalRecords                 10I 0 OVERLAY(SPLA0100:721)
 D  PagesPerSide                 10I 0 OVERLAY(SPLA0100:725)
 D  FrontOvlName                 10A   OVERLAY(SPLA0100:729)
 D  FrontOvlLib                  10A   OVERLAY(SPLA0100:739)
 D  FrontOvlOffsetDown...
 D                               15P 5 OVERLAY(SPLA0100:749)
 D  FrontOvlOffsetAcross...
 D                               15P 5 OVERLAY(SPLA0100:757)
 D  BackOvlName                  10A   OVERLAY(SPLA0100:765)
 D  BackOvlLib                   10A   OVERLAY(SPLA0100:775)
 D  BackOvlOffsetDown...
 D                               15P 5 OVERLAY(SPLA0100:785)
 D  BackOvlOffsetAcross...
 D                               15P 5 OVERLAY(SPLA0100:793)
 D  UnitOfMeasure                10A   OVERLAY(SPLA0100:801)
 D  PageDefName                  10A   OVERLAY(SPLA0100:811)
 D  PageDefLib                   10A   OVERLAY(SPLA0100:821)
 D  LineSpacing                  10A   OVERLAY(SPLA0100:831)
 D  PointSize                    15P 5 OVERLAY(SPLA0100:841)
 D  FrontMarginOffsetDown...
 D                               15P 5 OVERLAY(SPLA0100:849)
 D  FrontMarginOffsetAcross...
 D                               15P 5 OVERLAY(SPLA0100:857)
 D  BackMarginOffsetDown...
 D                               15P 5 OVERLAY(SPLA0100:865)
 D  BackMarginOffsetAcross...
 D                               15P 5 OVERLAY(SPLA0100:873)
 D  LengthOfPage                 15P 5 OVERLAY(SPLA0100:881)
 D  WidthOfPage                  15P 5 OVERLAY(SPLA0100:889)
 D  MeasurementMethod...
 D                               10A   OVERLAY(SPLA0100:897)
 D  AFPResource                   1A   OVERLAY(SPLA0100:907)
 D  CharSetName                  10A   OVERLAY(SPLA0100:908)
 D  CharSetLib                   10A   OVERLAY(SPLA0100:918)
 D  CodePageName                 10A   OVERLAY(SPLA0100:928)
 D  CodePageLib                  10A   OVERLAY(SPLA0100:938)
 D  CodedFontName                10A   OVERLAY(SPLA0100:948)
 D  CodedFontLib                 10A   OVERLAY(SPLA0100:958)
 D  DBCSFontName                 10A   OVERLAY(SPLA0100:968)
 D  DBCSFontLib                  10A   OVERLAY(SPLA0100:978)
 D  UserDefFile                  10A   OVERLAY(SPLA0100:988)
 D  ReduceOutput                 10A   OVERLAY(SPLA0100:998)
 D  ConstBackOvl                  1A   OVERLAY(SPLA0100:1008)
 D  OutputBin                    10I 0 OVERLAY(SPLA0100:1009)
 D  CCSID                        10I 0 OVERLAY(SPLA0100:1013)
 D  UserDefText                 100A   OVERLAY(SPLA0100:1017)
 D  CreatedSystem                 8A   OVERLAY(SPLA0100:1117)
 D  CreatedID                     8A   OVERLAY(SPLA0100:1125)
 D  CreatedUser                  10A   OVERLAY(SPLA0100:1133)
 D                                2A   OVERLAY(SPLA0100:1143)
 D  OffsetUserDef                10I 0 OVERLAY(SPLA0100:1145)
 D  NumberUserDef                10I 0 OVERLAY(SPLA0100:1149)
 D  LengthUserDef                10I 0 OVERLAY(SPLA0100:1153)
 D  UsrDefData                  255A   OVERLAY(SPLA0100:1157)
 D  UsrDefObjName                10A   OVERLAY(SPLA0100:1412)
 D  UsrDefObjLib                 10A   OVERLAY(SPLA0100:1422)
 D  UsrObjType                   10A   OVERLAY(SPLA0100:1432)
 D                                3A   OVERLAY(SPLA0100:1442)
 D  CharSetPtSz                  15P 5 OVERLAY(SPLA0100:1445)
 D  CodedFontPtSz                15P 5 OVERLAY(SPLA0100:1453)
 D  DBCSFontPtSz                 15P 5 OVERLAY(SPLA0100:1461)
 D  AuxStorPool                  10I 0 OVERLAY(SPLA0100:1469)
 D  SPLFSize                     10I 0 OVERLAY(SPLA0100:1473)
 D  SPLFSizeMult                 10I 0 OVERLAY(SPLA0100:1477)
 D  IPJobID                      10I 0 OVERLAY(SPLA0100:1481)
 D  SPLFSecurity                  1A   OVERLAY(SPLA0100:1485)
 D  SPLFAuthent                   1A   OVERLAY(SPLA0100:1486)
 D  WriterDateBeg                 7A   OVERLAY(SPLA0100:1487)
 D  WriterTimeBeg                 6A   OVERLAY(SPLA0100:1494)
 D  WriterDateEnd                 7A   OVERLAY(SPLA0100:1500)
 D  WriterTimeEnd                 6A   OVERLAY(SPLA0100:1507)
 D  JobSysName                    8A   OVERLAY(SPLA0100:1513)
 D  AuxStorPoolDv                10A   OVERLAY(SPLA0100:1521)
 D  ExpireDate                    7A   OVERLAY(SPLA0100:1531) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-18T16:11:02.730

例如，CEEHDLR/CEEHDLU (un) 为当前堆栈（入口）帧注册一个用户编写的条件处理程序。

# asp.net-mvc - 如何使用 activedirectorymembershipprovider 在 asp.net mvc 应用程序中实现角色层次结构

> ID：756299
> 
> 赞同：6
> 
> 时间：2009-04-16T14:11:47.173
> 
> 标签：asp.net-mvc, active-directory, asp.net-membership

在我的 asp.net mvc 应用程序中，我使用的是 activedirectorymembershipprovider。在活动目录中，为了简单起见，我创建了几个角色（组），类似于“普通”和“管理员”。

我目前正在通过获取 httpcontext 的 IPrincipal 并调用 User.IsInRole(nameOfRoleGoesHere); 来查询用户是否在角色中。

我正在寻找的行为是让我能够询问用户是否处于“管理员”角色，然后隐式询问用户是否处于该角色之下的所有角色（在这种情况下，角色“正常”将低于“管理员”）。由于我的角色主要是垂直的（如果这有意义的话），这种角色继承似乎对我的应用程序目前有意义。

我怎样才能得到这种行为——我必须实现一些自定义逻辑，允许我请求角色“管理员”，但抽象出实际上在幕后的活动目录中请求“普通”和“管理员”——或者是否有可能活动目录中的结构组以某种方式自动给我这种行为？

对于我对 asp.net、活动目录和 .net 安全性的任何严重误解，我深表歉意——我是新手，正在试验。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T23:42:01.813

AD 支持一个组是另一个组成员的概念吗？

所以你可以有以下内容：

**用户：** Anne、Bob、Charlie、Douglas、Elliot、Fred 和 George。

**角色：**普通、编辑、管理员

然后在将每个组定义为：

**管理员**有以下成员：乔治

**编辑**有以下成员：“Admin”、Douglas、Elliot

**Normal**有以下成员：“Editor”、“Admin”、Anne、Bob、Charlie

因此，您知道 George 是 Normal、Editor 和 Admin 的成员，因为 Admin 的所有成员都包含在这些组中，而 Douglas 只是 Editor 和 Normal 的成员，而 Anne 只是普通用户，AD 会说“*是的，乔治是普通用户*”，如果你问的话。

**但是：**没有（据我所知）官方的、MS 支持的 ActiveDirectory **RoleProvider**可以使用正确的 AD 角色填充 RolesPrinciple - [CodePlex 上有几个像这样的一个，](http://adrp.codeplex.com/)你定义为你的角色提供者?

默认的 ASP.NET 角色提供程序不支持角色层次结构，因此您需要：

1.  将用户置于他们有权访问的每个角色中，并且只检查您感兴趣的角色。
2.  将用户置于他们可以访问的最强大的角色中，然后检查每个应该有权访问的角色。
3.  编写/查找支持层次结构的[角色提供程序](http://msdn.microsoft.com/en-us/library/8fw7xh74.aspx)- 如果用户处于更高阶角色，只需返回 true。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:15:27.427

Active Directory 在成员资格方面确实没有层次结构的概念。用户是一个、几个、多个组的成员——但仅此而已。他是“管理员”组的成员——是或否。他也可能是 A 组、B 组、F 组和 M 组的成员 - 但没有您正在寻找的真正的“角色层次结构”。

我想，在我看来，在某种程度上，能够组合任意数量的组成员资格可能比具有层次结构更加灵活和可靠。

马克

# jquery - ASP.NET MVC 中的条带表行（不使用 jQuery 或等效项）

> ID：756310
> 
> 赞同：10
> 
> 时间：2009-04-16T14:13:13.707
> 
> 标签：jquery, asp.net-mvc

当使用 ASP.NET WebForms [ListView 控件](http://msdn.microsoft.com/en-us/library/bb398790.aspx)在 HTML 表格中显示数据时，我使用以下技术来“条带化”表格行：

```
<ItemTemplate>
    <tr class="<%# Container.DisplayIndex % 2 == 0 ? "" : "alternate" %>">
        <!-- table cells in here -->
    </tr>
</ItemTemplate> 
```

使用以下 CSS：

```
tr.alternate
{
    background-color: #EFF5FB;
} 
```

我刚刚浏览了 ASP.NET MVC[电影数据库应用程序教程](http://www.asp.net/learn/mvc/tutorial-21-cs.aspx)，了解到在 MVC 领域表行可以（必须？）构造如下：

```
<% foreach (var item in Model) { %>
    <tr>
        <td>
            <%= Html.Encode(item.Title) %>
        </td>
        <!-- and so on for the rest of the table cells... -->
    </tr>
<% } %> 
```

我可以在此代码中添加什么来对表格的行进行条带化？

注意：我知道这可以[使用 jQuery 完成](http://blog.jquery.com/2006/10/18/zebra-table-showdown/)，我想知道它是否可以通过其他方式完成。

## 编辑

如果您认为 jQuery（或等效）是最好或最合适的帖子，我很想知道为什么。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-17T17:07:34.937

另一个不涉及 lambdas 并且比你工作的更干净的选项可能是这个......

```
<% int i=0; foreach (var item in Model) { %>
    <tr class="<%= i++ % 2 == 0 ? "alternate" : "" %>">
        <td>
            <%= Html.Encode(item.Title) %>
        </td>
        <!-- and so on for the rest of the table cells... -->
    </tr>
<% } %> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T14:31:05.520

扩展方法呢？

```
public static void Alternate<T>(this IEnumerable<T> items, Action<T, bool> action)
{
    bool state = false;
    foreach (T item in items)
        action(item, state = !state);
} 
```

这样你就可以说：

```
<% movies.Alternate((movie, alt) => { %>
  <tr class="<%= alt ? "alternate" : "" %>">
    <td>
        <%= Html.Encode(movie.Title) %>
    </td>
    <!-- and so on for the rest of the table cells... -->
  </tr>
<% }); %> 
```

编辑，另外，如果你想要索引，你可以使用这样的扩展方法：

```
public static void Each<T>(this IEnumerable<T> items, Action<T, int> action)
{
    int state = 0;
    foreach (T item in items)
        action(item, state++);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-10T16:37:58.963

这个怎么样：

```
<% foreach (var item in Model.Alternating("alternate","") { %>
<tr class="<%= item.ClassName %>">
    <td>
        <%= Html.Encode(item.Model.Title) %>
    </td>
    <!-- and so on for the rest of the table cells... -->
</tr>
<% } %> 
```

它使用这种扩展方法：

```
 public class AlternatingItem<T> 
  {
   public string ClassName { get; set; }
   public T Model { get; set; }
  }
  public static IEnumerable<AlternatingItem<T>> Alternating<T>(this IEnumerable<T> model, string oddString, string evenString) 
  {
   int i = 0;
   var query = from x in model
      let c = i++ % 2 == 0 ? oddString : evenString
      select new AlternatingItem<T>() { ClassName = c, Model = x };
   return query;
  } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-30T08:26:37.697

如果您在例如 .NET Core 中使用 Razor，则此代码有效：

```
@for (int i = 0; i < Model.Stuff.Count; i++)
{
    <tr style="background: @(i % 2 == 0 ? "#f5f5f5" : string.Empty)">
        <td>
            @Model.Stuff[i].Name
        </td>
    </tr>
} 
```

# vb.net - 如何创建只显示 NotifyIcon 的 WinForm 应用程序？

> ID：756312
> 
> 赞同：0
> 
> 时间：2009-04-16T14:13:35.593
> 
> 标签：vb.net, notifyicon

我很确定我以前做过这个，但我不记得我是如何/在哪里找到如何做到这一点的。

我创建了一个新的 WinForm 应用程序，然后将通知图标拖到我的设计器上。我在 Form1.vb 文件中为 NotifyIcon 的行为编写了我想要的功能。

我想我记得一些关于向项目添加模块，并将项目设置为启动上述模块而不是表单......但我无法弄清楚/回忆如何保留我编码到 Form1 中的功能。动词。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T14:21:54.370

你试过[这个](http://social.msdn.microsoft.com/forums/en-US/Vsexpressvcs/thread/bc4556d5-3cb4-458b-96be-6f51c68700fd/)吗？[（谷歌](http://www.google.com/search?hl=en&q=c%23+notifyicon+no+form&btnG=Search)上的第一个结果，我想我过去也用过）

# c# - Tab control + DataGridView in WinForms

> ID：756313
> 
> 赞同：2
> 
> 时间：2009-04-16T14:13:35.607
> 
> 标签：c#, winforms, user-interface

I have multiple results sets coming back from a server request against a datasource. I want to organise these with a WinForms tabPage for each result set, on a single tabControl. I am displaying the data in a DataGridView, but want to avoid having a DataGridView instance on each tabPage - I'd rather intercept the "switching to new tab page" message, and load up the appropriate results set from my local cache. Is there an easy/obvious way to do this?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:20:54.920

像往常一样创建一个选项卡控件，然后在其上放置一个 DataGridView（确保不要将其放在选项卡页内）。

订阅 SelectedIndexChanged 事件并在事件触发时重新加载数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:20:35.683

你为什么想做这个？您将失去每个结果集的可设计性（除非它们都是相同的结构）并且必须自己管理所有这些。

# xml - Scala XML serialization

> ID：756317
> 
> 赞同：7
> 
> 时间：2009-04-16T14:14:20.207
> 
> 标签：xml, serialization, scala

Seeing the power of Scala, I wonder if an arbitrary object graph could be serialized and deserialized to/from XML using built-in Scala language features and libraries (e.g. without XMLEncoder, XStream or JAXB). Unfortunately, I haven't found such a solution. What could you advise?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-09-10T05:42:35.810

我不知道“是否可以使用内置的 Scala 语言功能和库对任意对象图进行序列化和反序列化到 XML 或从 XML 反序列化”，但由于 Scala 中有一些对 XML 的本机支持，所以我会提到它们。更多细节可以在 Ch 中找到。[Programming in Scala 中](http://www.artima.com/shop/programming_in_scala)的 26篇名为 Working with XML：

> 本章介绍 Scala 对 XML 的支持。在讨论了一般的半结构化数据之后，它展示了 Scala 中用于操作 XML 的基本功能：如何使用 XML 文字创建节点，如何将 XML 保存和加载到文件中，以及如何使用查询方法和模式匹配来拆分 XML 节点.

为了快速总结本章，我将引用一些关键点。

*   Scala 包括对处理 XML 的特殊支持。
*   Scala 允许您在表达式有效的任何地方输入 XML 作为文字。
*   您可以通过使用花括号 ({}) 作为转义来在 XML 文字中间评估 Scala 代码。

因此，您可以编写如下内容：

```
val foo = <a> {3 + 4} </a> 
```

以上评估为`scala.xml.Elem = <a> 7 </a>`。

*   如果要通过标签名称查找子元素，只需`\`使用标签名称调用即可。
*   `\\`您可以使用而不是运算符进行“深度搜索”并查看子子元素等`\`。

这本书有一个抽象类的序列化和反序列化的例子，但它是手写的：

```
abstract class CCTherm {
  val description: String
  val yearMade: Int

  def toXML =
    <cctherm>
      <description>{description}</description>
      <yearMade>{yearMade}</yearMade>
    </cctherm>

  def fromXML(node: scala.xml.Node): CCTherm =
    new CCTherm {
      val description = (node \ "description").text
      val yearMade    = (node \ "yearMade").text.toInt
    }    
} 
```

更多信息可以在名为[scala.xml](http://burak.emir.googlepages.com/scalaxbook.docbk.html)的草稿书中找到。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T15:07:04.027

afaik没有这样的事情。但你可能想看看[sbinary](http://code.google.com/p/sbinary/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-15T15:48:36.950

在包 net.liftweb.json, 对象 xml 中，我找到了以下函数：

```
def toXml(json: JValue): NodeSeq = {
    def toXml(name: String, json: JValue): NodeSeq = json match {
      case JObject(fields) => new XmlNode(name, fields flatMap { f => toXml(f.name, f.value) })
      case JArray(xs) => xs flatMap { v => toXml(name, v) }
      case JField(n, v) => new XmlNode(name, toXml(n, v))
      case JInt(x) => new XmlElem(name, x.toString)
      case JDouble(x) => new XmlElem(name, x.toString)
      case JString(x) => new XmlElem(name, x)
      case JBool(x) => new XmlElem(name, x.toString)
      case JNull => new XmlElem(name, "null")
      case JNothing => Text("")
    }

    json match {
      case JField(n, v) => toXml(n, v)
      case JObject(fields) => fields flatMap { f => toXml(f.name, f.value) }
      case x => toXml("root", x)
    }
  } 
```

有一个提取包，它具有将至少案例类转换为 JSON 的功能。与 toXml 一起，这可能会将许多数据类型转换为 XML。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-23T19:50:38.753

就“建议”而言，我们一直在使用本地库来处理许多快速而肮脏的配置文件。主要优点是“解析”代码用于添加漂亮的错误消息。像这样：

```
val xml = xml.XML.load( source )

val required = ( xml \ "value" ).firstOption match {
    case None => error( "The value element is missing, or should I be a default?" )
    case Some( req ) => req
} 
```

这是我通常使用 XStream 之类的东西的地方，所以它不是一个大开关。我不确定您是否可以使用库在反序列化框架上获得错误消息+默认处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T21:10:46.030

Scala 的原生类库中没有任何内容。但是不乏能够做到这一点的 Java 库。

# asp.net - 关于 ASP.net 中的数据列表

> ID：756324
> 
> 赞同：0
> 
> 时间：2009-04-16T14:16:16.210
> 
> 标签：asp.net

数据列表和网格视图有什么区别

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T14:18:04.740

`GridView`比 . 有更多的花里胡哨`DataList`。最基本的区别是您应该编写自己的模板以使用`DataList`. `GridView`自动为您提供表格数据模板和更多开箱即用的功能。经验法则是，`GridView`在需要时使用。如果您愿意更彻底地自定义它们`DataList`，请使用和其他更可自定义的控件。`Repeater`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:25:04.097

数据列表更多地用于以不同布局显示数据，例如带有图像的公司电话簿，您希望使列水平而不是像表格格式那样垂直。数据列表的缺点是您无法轻松编辑数据，这意味着可以完成，但您必须编写自己的程序才能完成。使用gridview，它全部内置用于编辑。

[这是.net http://msdn.microsoft.com/en-us/library/ms228214(vs.80).aspx](http://msdn.microsoft.com/en-us/library/ms228214(vs.80).aspx)中每个数据绑定控件的一个很好的解释

# jquery - 使 JQuery UI Dialog 自动增长或缩小以适应其内容

> ID：756325
> 
> 赞同：133
> 
> 时间：2009-04-16T14:16:40.607
> 
> 标签：jquery, jquery-ui, jquery-ui-dialog

我有一个显示表单的 JQuery UI 对话框弹出窗口。通过选择表单上的某些选项，新选项将出现在表单中，使其变得更高。这可能会导致主页面有滚动条而 JQuery UI 对话框有滚动条的情况。这种两个滚动条的场景对用户来说是难看和混乱的。

如何使 JQuery UI 对话框增长（并可能缩小）以始终适合其内容而不显示滚动条？我希望只有主页上的滚动条可见。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-04-19T04:47:45.883

**更新：**从 jQuery UI 1.8 开始，工作解决方案（如第二条评论中所述）是使用：

```
width: 'auto' 
```

* * *

使用 autoResize:true 选项。我将说明：

```
 <div id="whatup">
    <div id="inside">Hi there.</div>
  </div>
   <script>
     $('#whatup').dialog(
      "resize", "auto"
     );
     $('#whatup').dialog();
     setTimeout(function() {
        $('#inside').append("Hello!<br>");
        setTimeout(arguments.callee, 1000);
      }, 1000);
   </script> 
```

这是一个工作示例：http: [//jsbin.com/ubowa](http://jsbin.com/ubowa)

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-04-16T14:42:40.453

答案是设置

```
autoResize:true 
```

创建对话框时的属性。为了使它起作用，您不能为对话框设置任何高度。因此，如果您在其创建者方法中或通过任何样式为对话框设置固定高度（以像素为单位），则 autoResize 属性将不起作用。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2013-06-05T03:25:15.370

这适用于 jQuery UI v1.10.3

```
$("selector").dialog({height:'auto', width:'auto'}); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-11-06T09:13:08.077

我使用了以下对我来说很好的属性：

```
$('#selector').dialog({
     minHeight: 'auto'
}); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-12-07T13:57:03.843

高度支持自动。

宽度不！

要进行某种自动获取您正在显示的 div 的大小，然后设置窗口。

在 C# 代码中..

```
TheDiv.Style["width"] = "200px";

    private void setWindowSize(int width, int height)
    {
        string widthScript =    "$('.dialogDiv').dialog('option', 'width', "    +   width   +");";
        string heightScript =   "$('.dialogDiv').dialog('option', 'height', "   +   height  + ");";

        ScriptManager.RegisterStartupScript(this.Page, this.GetType(),
            "scriptDOWINDOWSIZE",
            "<script type='text/javascript'>"
            + widthScript
            + heightScript +
            "</script>", false);
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-06-25T23:02:50.317

如果您需要它在 IE7 中工作，则不能使用[未记录、有缺陷和不受支持](http://bugs.jqueryui.com/ticket/4437#comment:9) `{'width':'auto'}`的选项。相反，将以下内容添加到您的`.dialog()`:

```
'open': function(){ $(this).dialog('option', 'width', this.scrollWidth) } 
```

是否`.scrollWidth`包含右侧填充取决于浏览器（Firefox 与 Chrome 不同），因此您可以在 中添加主观“足够好”的像素数`.scrollWidth`，或者用您自己的宽度计算函数替换它。

您可能希望包括`width: 0`在您的`.dialog()`选项中，因为这种方法永远不会减少宽度，只会增加它。

经测试可在 IE7、IE8、IE9、IE10、IE11、Firefox 30、Chrome 35 和 Opera 22 中运行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-31T05:35:34.577

```
var w = $('#dialogText').text().length;

$("#dialog").dialog('option', 'width', (w * 10)); 
```

做了我需要做的事情来调整对话框的宽度。

# java - 共享串口（Modem协议+拨号器）

> ID：756326
> 
> 赞同：1
> 
> 时间：2009-04-16T14:16:46.257
> 
> 标签：java, serial-port, protocols, modem, file-transfer

我想用这段代码用 Xmodem 发送档案：[http ://www.java2s.com/Code/Java/Network-Protocol/JModemsimplecommunicationsprogram.htm](http://www.java2s.com/Code/Java/Network-Protocol/JModemsimplecommunicationsprogram.htm)

在这种情况下，我想在两台计算机之间建立拨号连接并发送二进制文件。但是这段代码不允许我在设置端口之后和传输文件之前设置要拨打的电话号码。有没有办法与另一个拨打电话号码的应用程序共享端口？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:23:43.493

你不能在连接串口后通过串口线发送普通的旧调制解调器命令吗？

因此，连接后，发送 ATDT 后跟电话号码。然后等待“连接”响应字符串（或错误响应）。然后发送文件。

见：[http ://en.wikipedia.org/wiki/Hayes_command_set](http://en.wikipedia.org/wiki/Hayes_command_set)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T18:08:03.443

如果您不想修改 JModem 程序，那么为什么不使用一个成熟的通讯程序来提供您需要的所有功能呢？（曾经有很多，但现在想到的是 kermit）。这比试图让两个不同的程序一起工作更容易。

如果您是 Java 程序员，那么请按照 RoccoD 的建议，修改 JModem 代码以拨打号码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-14T15:21:01.960

在 unix 或 linux 中这不是问题 - 只需同时打开所有程序的串行端口。您也可以使用聊天或期望。

在 Windows 中你需要多路复用数据流的服务器

# .net - 在 .NET 中存储稀疏矩阵的最佳方法

> ID：756329
> 
> 赞同：12
> 
> 时间：2009-04-16T14:18:06.253
> 
> 标签：.net, performance, sparse-matrix

我们有一个存储稀疏矩阵的应用程序。该矩阵的条目主要存在于矩阵的主对角线周围。我想知道是否有任何有效的算法（或现有的库）可以有效地处理这种稀疏矩阵？优选地，这将是一个通用实现，其中每个矩阵条目可以是用户定义的类型。

针对问题/回复进行编辑：

当我说主要围绕主对角线时，我的意思是大多数矩阵的特征将是大多数条目都聚集在主对角线之外，但是靠近对角线的地方可能有零值，远离对角线的地方可能有非零值对角线。我想要对这里的“大多数”情况有效的东西。

我会用这个做什么？我需要能够有效地访问行中的所有值或列中的所有值。存储的值将是布尔值。一个例子是：

1.  对于一行中的所有真值，foreach 列出现一个真值，将该列的所有条目设置为某个值
2.  对于一行中的所有错误值，将条目设置为某事

这都是以前用链表完成的，但实现起来非常混乱。我希望使用稀疏矩阵可以改进算法，但事实证明很难找到“正确”类型的稀疏矩阵算法。

ps 感谢您迄今为止的回复

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T15:04:19.247

您可以使用基于单元格的 [row,col] 的索引。由于数据在对角线上，将行索引和相关列索引与数据一起存储的典型方法不是最佳的。这是一些您可以用来执行此操作的代码：

```
 public class SparseMatrix<T>
    {
        public int Width { get; private set; }
        public int Height { get; private set; }
        public long Size { get; private set; }

        private Dictionary<long, T> _cells = new Dictionary<long, T>();

        public SparseMatrix(int w, int h)
        {
            this.Width = w;
            this.Height = h;
            this.Size = w * h;
        }

        public bool IsCellEmpty(int row, int col)
        {
            long index = row * Width + col;
            return _cells.ContainsKey(index);
        }

        public T this[int row, int col]
        {
            get
            {
                long index = row * Width + col;
                T result;
                _cells.TryGetValue(index, out result);
                return result;
            }
            set
            {
                long index = row * Width + col;
                _cells[index] = value;
            }
        }
    }

    static void Main()
    {
        var sm = new SparseMatrix<int>(512, 512);
        sm[42, 42] = 42;
        int val1 = sm[13, 13];
        int val2 = sm[42, 42];

        Console.WriteLine("VAL1 = " + val1); // prints out 0
        Console.WriteLine("VAL2 = " + val2); // prints out 42

        Console.ReadLine();
    } 
```

请注意，当 T 是结构时，您可能必须调用 IsCellEmpty，因为获取单元格的内容不会为空，并且将具有该类型的默认值。您还可以扩展代码以根据`Size`属性和`_cells.Count`.

编辑：

好吧，如果您对速度感兴趣，您可以权衡空间与速度。与其只有一本字典，不如拥有三本！它使您的空间增加了三倍，但它使以您想要的任何方式进行枚举变得非常容易。这是一些新的代码，表明：

```
 public class SparseMatrix<T>
    {
        public int Width { get; private set; }
        public int Height { get; private set; }
        public long MaxSize { get; private set; }
        public long Count { get { return _cells.Count; } }

        private Dictionary<long, T> _cells = new Dictionary<long, T>();

        private Dictionary<int, Dictionary<int, T>> _rows = 
            new Dictionary<int, Dictionary<int, T>>();

        private Dictionary<int, Dictionary<int, T>> _columns = 
            new Dictionary<int, Dictionary<int, T>>();

        public SparseMatrix(int w, int h)
        {
            this.Width = w;
            this.Height = h;
            this.MaxSize = w * h;
        }

        public bool IsCellEmpty(int row, int col)
        {
            long index = row * Width + col;
            return _cells.ContainsKey(index);
        }

        public T this[int row, int col]
        {
            get
            {
                long index = row * Width + col;
                T result;
                _cells.TryGetValue(index, out result);
                return result;
            }
            set
            {
                long index = row * Width + col;
                _cells[index] = value;

                UpdateValue(col, row, _columns, value);
                UpdateValue(row, col, _rows, value);
            }
        }

        private void UpdateValue(int index1, int index2, 
            Dictionary<int, Dictionary<int, T>> parent, T value)
        {
            Dictionary<int, T> dict;
            if (!parent.TryGetValue(index1, out dict))
            {
                parent[index2] = dict = new Dictionary<int, T>();
            }
            dict[index2] = value;
        }
    } 
```

如果要遍历所有条目，请使用`_cells`. 如果您想要给定列的所有行，请使用`_columns`. 如果您想要给定行中的所有列，请使用`_rows`.

如果您想按排序顺序进行迭代，您可以开始将 LINQ 添加到组合中和/或使用带有封装条目的内部类的排序列表（它必须存储行或列并实现`IComparable<T>`排序才能工作） .

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T14:25:47.857

我想一个`Dictionary<int, Dictionary<int, object >>`就足够了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T14:25:12.570

我没有使用它，但[Nmath Matrix](http://www.centerspace.net/products.php?page=2)处理这些（不是免费的）。

此外，[.NET 的极限优化数值库](http://www.extremeoptimization.com/VectorMatrixFeatures.aspx)（不是免费的）。

这是一个免费的：[Math.NET 项目](http://mathnet.opensourcedotnet.info/)（特别是[MathNet.Numerics.LinearAlgebra.Sparse 命名空间](http://nmath.sourceforge.net/doc/numerics/MathNet.Numerics.LinearAlgebra.Sparse.html)）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T14:48:18.690

这里有两个问题：

*   “主要围绕主对角线”太模糊了。如果元素位于带中，则使用带本身的带状存储，作为偏离主对角线的向量。如果元素随机分散在主对角线附近，则要么使用带状形式，其中可能在带状部中包含一些零，要么使用纯稀疏形式，仅存储元素及其在数组中的位置。

*   你将如何处理矩阵？如果您的目标仅仅是高效存储，那么带状表单将是高效的，可以快速访问任何元素。如果您将使用矩阵进行线性代数，但不会超过矩阵*向量的乘积，那么带状形式仍然可以出色地工作。如果您使用矩阵*矩阵乘法或矩阵分解，其中填充成为问题，那么纯稀疏形式可能更合适。例如，两个带状矩阵的乘积将有额外的带，因此两个三对角矩阵的乘积将是五对角矩阵。对于因式分解，重新排序有时有助于最小化填充。（AMD 是一种选择，Approximate Minimum Degree permutation，但还有其他方案。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T14:33:47.807

这是通用[数据结构模式](http://netlib.org/linalg/html_templates/node90.html)的列表。每种都有其优点和缺点，并且适用于出现稀疏矩阵的稍微不同类型的问题。您可能希望在现有数据结构（例如 List<> 和 Dictionary<> ）之上实现它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T14:30:01.497

我认为这可以通过使用一个持有普通数组的类来完成，保存在矩阵行之间应用的水平偏移量并定义一行的条带，例如有效条目的数量。因此，对于仅定义对角线和两个相邻元素的大型矩阵，您将创建一个 3 * 行数的数组并将 3 存储为条带宽度。偏移量取决于矩阵的大小。

我不知道有什么免费的已经这样做了。

# javascript - 使用 Javascript 向地图添加图钉

> ID：756332
> 
> 赞同：1
> 
> 时间：2009-04-16T14:19:25.750
> 
> 标签：javascript, virtual-earth

我如何能够通过单击鼠标来放置图钉？鉴于这是代码：

```
function AddPushpin()
  {
      var shape = new VEShape(VEShapeType.Pushpin, **map.GetCenter()**);
      shape.SetTitle('sample');
      shape.SetDescription('This is shape number '+pinid);
      pinid++;
      map.AddShape(shape);
  } 
```

它指向中心..

您对如何将图像添加到图钉悬停有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T21:30:44.843

Here's an example that adds a pushpin during the OnClick event of the Map, and sets the Shape's Photo URL to display an image within the InfoxBox.

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.2&mkt=en-US"></script>
    <script type="text/javascript">
    var map = null;

    function GetMap()
    {
        map = new VEMap("myMap");
        map.LoadMap();

        // Attach the OnClick event
        map.AttachEvent("onclick", OnClick_Handler);

        // You could Dettach the OnClick event like this
        //map.DetachEvent("onclick", OnClick_Handler);
    }

    function OnClick_Handler(e){
        // "sender" is the VEMap that raised the event
        // "e" is the VE Map Event Object

        // Get the Lat/Long where the Mouse was clicked
        var pushpinLocation = map.PixelToLatLong(new VEPixel(e.mapX, e.mapY));

        // Create the Pushpin Shape
        var s = new VEShape(VEShapeType.Pushpin, pushpinLocation);
        s.SetTitle("test pushpin");
        s.SetDescription("test description");

        s.SetPhotoURL("http://i.stackoverflow.com/Content/Img/stackoverflow-logo-250.png");

        // Plot a Shape at the Clicked location
        map.AddShape(s);
    }
    </script>
</head>
    <body onload="GetMap();">
        <div id='myMap' style="position:relative; width:400px; height:400px;"></div>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:35:55.523

看看[这篇文章](http://www.viawindowslive.com/Articles/VirtualEarth/CreatingYourFirstVirtualEarthv2PagePart1.aspx)...

```
function InitMap ()
{
// add code to init your map....

// attach the onclick event...
map.AttachEvent("onclick", MouseClick);

}

function MouseClick(e)
    {
        map.AddPushpin('pin', 
        e.view.latlong.latitude, 
        e.view.latlong.longitude,
        88,
        34,
        'pin',
        'MyPin',
        1);  
    } 
```

# url - 是否有一种半标准的方式将 URL 与 IRC 用户相关联？

> ID：756343
> 
> 赞同：3
> 
> 时间：2009-04-16T14:21:52.780
> 
> 标签：url, irc, rfc

我正在做一些身份整合，所以我在互联网上的不同位置向我提供 URL。我在 IRC 上非常活跃，所以这自然让我想知道是否有办法提供指向我的 IRC 存在的链接。

这导致我找到[http://www.w3.org/Addressing/draft-mirashi-url-irc-01.txt](http://www.w3.org/Addressing/draft-mirashi-url-irc-01.txt)这似乎是用于将 URL 与 IRC 关联的 RFC 草案，这表明我会

irc://irc.freenode.net/DRMacIver,isnick

这似乎有点蹩脚的一面。此外，这个 RFC 草案已经彻底过期（1997 年 2 月 28 日）。另一方面，它似乎至少在 chatzilla 中实现了：

[http://www.mozilla.org/projects/rt-messaging/chatzilla/irc-urls.html](http://www.mozilla.org/projects/rt-messaging/chatzilla/irc-urls.html)

那么有人知道是否有替代 RFC 和/或任何其他事实上的标准吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:48:13.543

我多年来一直是 IRC 用户，但我从未听说过任何允许您这样做的标准（除了您提到的 RFC）。

我一直发现 IRC 是一个非常棘手的地方来跟踪用户，因为设置保镖和轻松更改您的身份是一件如此简单的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-18T12:51:42.260

有一个较新的草案[https://datatracker.ietf.org/doc/html/draft-butcher-irc-url-04](https://datatracker.ietf.org/doc/html/draft-butcher-irc-url-04)看起来基本相同，除了使用 isuser 而不是 isnick。似乎 isnick 得到了更广泛的支持，因此使用它可能会更好。

# c# - 如何将 WebService 添加到 C# WinForm？

> ID：756345
> 
> 赞同：4
> 
> 时间：2009-04-16T14:22:10.097
> 
> 标签：c#, winforms, web-services

如何将 Webservice 添加到 WinForm ？

我没有这个选项，为什么？

提前致谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T14:25:38.200

你的意思是你想使用一个网络服务？或托管网络服务？

如果您想使用 Web 服务，请按照 billb 的建议添加 WebReference。

如果要托管 Web 服务，则无法托管 ASMX Web 服务。但是，可以托管 WCF Web 服务。

（示例不包括任何错误处理或您想要的东西。）

声明你的合同

```
[ServiceContract]
public interface  IWebGui
{
    [OperationContract]
    [WebGet(UriTemplate= "/")]
    Stream GetGrid();
} 
```

执行你的合同

```
[ServiceBehavior(InstanceContextMode=InstanceContextMode.Single)]
public class WebGui : IWebGui
{

    public Stream GetGrid()
    {

        string output = "test";

        MemoryStream ms = new MemoryStream(System.Text.Encoding.UTF8.GetBytes(output));
        WebOperationContext.Current.OutgoingResponse.ContentType = "text/html";
        return ms;
    }

} 
```

然后启动一个 WebServiceHost 来服务调用

```
 WebGui webGui = new WebGui();

        host = new WebServiceHost(webGui, new Uri("http://localhost:" + Port));
        var bindings = new WebHttpBinding();

        host.AddServiceEndpoint(typeof(IWebGui), bindings, "");
        host.Open(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-11-24T10:16:39.643

### 按着这些次序

1.  右键单击 Visual Studio 中的项目
2.  选择添加 Web 参考
3.  输入网址并继续

### 当您没有看到该选项时

1.  右键单击 Visual Studio 中的项目
2.  选择添加服务参考
3.  按“高级”按钮
4.  按“添加网络参考”按钮
5.  输入网址并继续

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T14:23:50.030

在 Visual Studio 中右键单击项目时，选择添加 Web 引用。然后，您可以在 WinForm 中实例化 Web 引用。

# c# - DataTable 中的 DataRow 状态问题

> ID：756347
> 
> 赞同：0
> 
> 时间：2009-04-16T14:22:26.757
> 
> 标签：c#, .net, datatable, rowstate

我对使用 DataTable 有一个非常奇怪的要求。我有一个包含一些列的数据表。Nwo 每当数据表中的任何 DataRow 发生任何变化时；然后将 DataRow 的状态设置为已修改。那没问题。但是对于一个特殊的专栏，我不想要这种行为。我希望此特定列的任何行中的任何更改都不应更改数据行的状态。请帮我解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:36:23.213

我不是这里的专家，但是我认为您不能禁止触发该事件。

但是，您可以更改处理此事件的方式。类似于“如果修改后的单元格在 XXX 列上则离开；否则继续事件处理”。

希望能帮助到你，

# security - '寻找 。-exec chmod 700 "{}" \;' 禁止网站

> ID：756353
> 
> 赞同：0
> 
> 时间：2009-04-16T14:23:52.867
> 
> 标签：security, permissions

我一直在阅读有关[设计安全性的](http://en.wikipedia.org/wiki/Security_by_design)内容。我注意到最低权限级别的提示。所以我对我的垃圾文件做了上面的代码。不幸的是，垃圾文件夹似乎包含一些服务器文件。一些网站被禁止。该文件夹包含诸如“Mail”、“dev”和“Public”之类的内容。丢弃它们的原因是它们是空的。

这些文件位于 CS 部门的服务器中。没有特殊的 CMS 或类似的东西。在运行“chmod 644 some_files”之前，我很想问问你的意见。

> 为什么这些网站被禁止？最低权限级别是多少？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T14:32:43.503

可能的最低权限级别当然是 000。但这没有多大意义。

*   `600 rw-------` 对于私人文件
*   `700 rwx------` 对于私有目录
*   `711 rwx--x--x` 对于具有公共文件但无权列出目录的目录
*   `644 rw-r--r--` 对于公开可读的文件
*   `755 rwxr-xr-x` 对于公开可读的目录

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:30:26.253

Web 服务器通常以与“真实”用户不同的用户 ID 运行。因此，您可以使其他任何人都无法读取“真实”用户文件，并且网络服务器也无法读取它们。这就是为什么 744 是 Web 服务器需要查看的文件的更好权限集的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:29:54.273

被禁止的文件夹的所有者很可能不是可用文件夹的所有者。运行文件或其组的用户必须对文件/文件夹具有读取（有时是可执行）权限。由于您删除了对组和世界的读、写和可执行权限，除了文件的所有者之外，没有人可以运行它们。

TLDR：文件/文件夹的所有者错误。chown 纠正用户。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T21:34:27.963

**您的问题：**您的用户帐户没有对世界其他地方的执行权限。

**解决方案：** 您需要为您的用户文件夹设置权限 701。您也可以将它们设置为 711。它是包含您的 public_html 等的文件夹。

然后，检查你的public_html是否有755的权限。同样，public_html中的内容也应该是755。

# sql - 如何以编程方式将非身份列更改为身份一？

> ID：756354
> 
> 赞同：3
> 
> 时间：2009-04-16T14:23:53.850
> 
> 标签：sql, sql-server, sql-server-2005, tsql, identity

我有一个列 ID 为标识一的表。接下来，我创建新的非标识列 new_ID 并使用 ID 列 + 1 中的值对其进行更新。像这样：

```
new_ID = ID + 1 
```

接下来，我删除 ID 列并将 new_ID 重命名为“ID”。

以及如何在这个新列“ID”上设置身份？

我想以编程方式执行此操作！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T14:35:09.940

据我所知，您必须创建一个临时表，其中 ID 字段创建为 IDENTITY，然后从原始表中复制所有数据。最后，删除原始表并重命名临时表。这是一个表（名为*TestTable*）的示例，该表仅包含一个字段，称为 ID（整数，非 IDENTITY）：

```
BEGIN TRANSACTION
GO
CREATE TABLE dbo.Tmp_TestTable
    (
    ID int NOT NULL IDENTITY (1, 1)
    )  ON [PRIMARY]
GO
SET IDENTITY_INSERT dbo.Tmp_TestTable ON
GO
IF EXISTS(SELECT * FROM dbo.TestTable)
     EXEC('INSERT INTO dbo.Tmp_TestTable (ID)
        SELECT ID FROM dbo.TestTable WITH (HOLDLOCK TABLOCKX)')
GO
SET IDENTITY_INSERT dbo.Tmp_TestTable OFF
GO
DROP TABLE dbo.TestTable
GO
EXECUTE sp_rename N'dbo.Tmp_TestTable', N'TestTable', 'OBJECT' 
GO
COMMIT 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T14:37:31.947

看起来 SQL Mobile 支持更改列标识，但在 SQL Server 2005 上不喜欢 BOL 中的示例。

因此，您的选择是使用标识列创建一个新的临时表，然后打开标识插入：

```
Create Table Tmp_MyTable ( Id int identity....)

SET IDENTITY_INSERT dbo.Tmp_Category ON

INSERT Into Tmp_MyTable (...)
Select From MyTable ....

Drop Table myTable

EXECUTE sp_rename N'dbo.Tmp_MyTable', N'MyTable', 'OBJECT' 
```

此外，您可以尝试首先将该列添加为标识列，然后打开标识插入。然后删除原始列。但我不确定这是否可行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T14:33:52.907

估计你的任务运气不太好......

在表设计中，您应该能够进入属性并在身份规范下将（是身份）更改为是并分配列主键（如果它以前具有主键）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T05:28:03.277

来自 SqlServerCentral.com

[从非身份更改为身份，反之亦然](http://www.sqlservercentral.com/articles/T-SQL/61979/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T14:37:07.017

Identity 是在创建表或在 alter table 语句中添加新列时设置的属性。您不能更改该列并将其设置为标识，并且在同一个表中不可能有两个标识列。

根据表的大小，是否可以简单地创建一个新表？复制旧的模式，然后使用 SET IDENTITY_INSERT ON 用旧的模式填充新的身份列。

# java - Eclipse 中没有响应：文件->导入->现有项目到工作区

> ID：756357
> 
> 赞同：4
> 
> 时间：2009-04-16T14:24:27.937
> 
> 标签：java, eclipse, gwt, import

我正在尝试按照以下说明将其中一个 GWT 示例导入 Eclipse。但是当我浏览到包含“Hello”示例的目录并取消选中“将项目复制到工作区”时，“完成”按钮显示为灰色，阻止我完成导入。任何想法为什么？

> -- 选项 A：将您的项目导入 Eclipse（推荐）-
> 
> 如果您使用 Eclipse，您可以简单地将生成的项目导入 Eclipse。我们已经针对 Eclipse 3.3 和 3.4 进行了测试。以后的版本可能也可以工作，早期的版本可能不行。
> 
> 在 Eclipse 中，转到 File 菜单并选择：
> 
> 文件 -> 导入... -> 现有项目到工作区
> 
> 浏览到包含此文件的目录，选择“Hello”。如果选中，请务必取消选中“将项目复制到工作区”。单击完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:31:33.067

我有同样的问题，但发现[了这个](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/da884d3bcd5c950d/67ad4c450d8824d1?lnk=raot)：

> 我刚刚在 Eclipse 3.4 上试过这个 1）创建一个名为“Showcase”的项目文件>新建>项目
> 
> 2）导入Showcase文件右键项目名称
> 
> > Import File System From Directory（浏览到您的 Eclipse 示例安装） Showcase（在左侧面板中选择目录）Into folder（Showcase 应该是默认值）
> 
> 这会将源代码导入您的工作区。使用 build.xml 构建项目。构建将失败，因为 gwt-servlet.jar 位于共享目录中，该目录不会通过此方法引入项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-20T14:28:12.313

我也遇到了这个问题，但使用以下步骤解决了这个问题。

首先打开命令提示符并使用 cd 命令进入项目文件夹。

然后在那里执行这个命令。确保在执行此操作之前安装 apache ant。

```
ant eclipse.generate 
```

这将生成 .classpath 和 .project 文件

现在您可以像往常一样将项目导入工作区。文件->导入->常规->现有项目

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-23T17:06:56.030

要将示例从 Android SDK 导入 Eclipse，请执行以下操作：

1.  点击文件->新建->新建Android项目
2.  选择“从现有样本创建项目”
3.  选择您的构建目标（Android API 级别）
4.  选择所需的示例应用程序。
5.  结束。

这对 Eclipse 3.5.2 有效。

顺便说一句：先前答案中的链接已损坏。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-07-05T12:17:21.473

导入后右键项目->Goolge->web toolkit setting->点击yes复选框，然后作为web应用程序运行！

# windows - 如何手动读/写.exe机器码？

> ID：756367
> 
> 赞同：14
> 
> 时间：2009-04-16T14:26:28.027
> 
> 标签：windows, winapi, operating-system, exe, executable

我不太熟悉编译器的魔法。*对我*来说，将人类可读的代码（或不可读的汇编指令）转换为机器代码的行为是火箭科学与巫术的结合。

我将把这个问题的主题缩小到 Win32 可执行文件 (.exe)。当我在专门的查看器中打开这些文件时，我可以发现分散在各个地方的字符串（通常每个字符 16b），但其余的只是垃圾。我想不可读的部分（大部分）是机器代码（或者可能是资源，例如图像等......）。

是否有任何直接读取机器代码的方法？将 exe 作为文件流打开并逐字节读取，如何将这些单独的字节转换为汇编？*这些指令字节*和汇编指令之间是否有直接的映射？

.exe是怎么写的？每条指令四个字节？更多的？较少的？我注意到一些应用程序可以像这样创建可执行文件：例如，在 ACD See 中，您可以将一系列图像导出到幻灯片中。但这不一定是 SWF 幻灯片，ACD See 也能够生成可执行的演示文稿。这是怎么做的？

我如何理解 EXE 文件中发生的事情？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-16T14:33:34.937

[OllyDbg](http://www.ollydbg.de/)是一个很棒的工具，它可以将 EXE 反汇编成可读的指令，并允许您一个接一个地执行指令。它还告诉您程序使用了哪些 API 函数，如果可能，它提供的参数（只要在堆栈上找到参数）。

一般来说，CPU指令的长度是可变的，有些是一个字节，有些是两个，有些是三个，有些是四个等。这主要取决于指令期望的数据类型。有些指令是通用的，例如“mov”，它告诉 CPU 将数据从 CPU 寄存器移动到内存中的某个位置，反之亦然。实际上，有许多不同的“mov”指令，用于处理 8 位、16 位、32 位数据的指令，用于从不同寄存器移动数据的指令等等。

您可以阅读 Paul Carter 博士的[PC 汇编语言教程](http://www.drpaulcarter.com/cs/)，这是一本免费的入门级书籍，介绍了汇编以及 Intel 386 CPU 如何运行。其中大部分甚至适用于现代消费级英特尔 CPU。

EXE 格式特定于 Windows。入口点（即第一条可执行指令）通常位于 EXE 文件中的相同位置。一下子解释起来有点困难，但是我提供的资源应该至少可以帮助治愈您的一些好奇心！:)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T14:30:57.890

您需要一个反汇编程序，它将机器代码转换为汇编语言。此[Wikipedia 链接](http://en.wikibooks.org/wiki/X86_Disassembly/Disassemblers_and_Decompilers)描述了该过程并提供了免费反汇编程序的链接。当然，正如你所说的你不懂汇编语言，这可能不是很丰富 - 你到底想在这里做什么？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T14:36:02.153

你看到的可执行文件是微软的PE（Portable Executable）格式。它本质上是一个容器，它包含一些有关程序的操作系统特定数据，并且程序数据本身分为几个部分。例如代码、资源、静态数据存储在单独的部分中。

该部分的格式取决于其中的内容。代码部分根据可执行目标体系结构保存机器代码。在最常见的情况下，这是用于 Microsoft PE 二进制文件的 Intel x86 或 AMD-64（与 EM64T 相同）。机器代码的格式是 CISC，起源于 8086 和更早版本。CISC的重要方面是它的指令大小不是恒定的，您必须从正确的位置开始阅读才能从中获得有价值的东西。英特尔发布了关于 x86/x64 指令集的优秀手册。

您可以使用反汇编程序直接查看机器代码。结合手册，您大部分时间都可以猜出源代码。

然后是 MSIL EXE：包含 Microsoft 中间语言的 .NET 可执行文件，它们不包含特定于机器的代码，而是 .NET CIL 代码。ECMA 上提供了相关规范。

这些可以使用反射器等工具进行查看。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-16T14:38:33.037

EXE 文件的内容在[Portable Executable](http://en.wikipedia.org/wiki/Portable_Executable)中描述。它包含有关如何加载文件的代码、数据和 OS 指令。

机器代码和程序集之间存在 1:1 映射。反汇编程序将执行相反的操作。

i386 上的每条指令没有固定的字节数。有些是单个字节，有些更长。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-16T14:29:23.137

您可以从命令行使用调试，但这很难。

```
C:\WINDOWS>debug taskman.exe
-u
0D69:0000 0E            PUSH    CS
0D69:0001 1F            POP     DS
0D69:0002 BA0E00        MOV     DX,000E
0D69:0005 B409          MOV     AH,09
0D69:0007 CD21          INT     21
0D69:0009 B8014C        MOV     AX,4C01
0D69:000C CD21          INT     21
0D69:000E 54            PUSH    SP
0D69:000F 68            DB      68
0D69:0010 69            DB      69
0D69:0011 7320          JNB     0033
0D69:0013 7072          JO      0087
0D69:0015 6F            DB      6F
0D69:0016 67            DB      67
0D69:0017 7261          JB      007A
0D69:0019 6D            DB      6D
0D69:001A 206361        AND     [BP+DI+61],AH
0D69:001D 6E            DB      6E
0D69:001E 6E            DB      6E
0D69:001F 6F            DB      6F 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T14:35:59.360

MSDN上的[win32 exe格式](http://msdn.microsoft.com/en-us/library/ms809762.aspx)

我建议使用一些 Windows C 源代码并在 Visual Studio 中构建并开始调试它。切换到反汇编视图并单步执行命令。您可以看到 C 代码是如何被编译成机器代码的 - 并观看它一步一步地运行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-16T14:50:56.533

如果它看起来对你来说很陌生，我认为调试器或反汇编器不会有帮助——你需要先学习汇编程序；研究处理器的架构（可从 Intel 下载大量文档）。然后由于大多数机器代码是由编译器生成的，因此您需要了解编译器如何生成代码 - 编写大量小程序然后反汇编它们以查看您的 C/C++ 变成了什么的最简单方法。

几本书可以帮助您理解：-

*   [倒车](http://www.amazon.co.uk/Reversing-Secrets-Engineering-Eldad-Eilam/dp/0764574817)
*   [黑客=剥削的艺术](http://www.amazon.co.uk/Hacking-Art-Exploitation-Jon-Erickson/dp/1593271441)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-16T16:53:56.257

就这个问题而言，还有人读过CD 21之类的东西吗？

我记得 Sandra Bullock 在一个节目中，实际上是在阅读一屏十六进制数字并弄清楚程序的作用。有点像当前版本的阅读矩阵代码。

如果你确实读过 CD 21 之类的东西，你如何记住不同的组合？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-08T13:58:32.807

为了得到一个想法，在一些有趣的代码上设置一个断点，然后转到 CPU 窗口。

如果您对更多内容感兴趣，使用 -al 参数使用 Free Pascal 编译短片段会更容易。

FPC 允许使用 -A 参数以多种汇编器格式（TASM、MASM、GAS）输出生成的汇编器，并且您可以在注释（和更多）中交错显示原始帕斯卡代码，以便于交叉引用。

因为它是编译器生成的汇编程序，而不是从反汇编的 .exe 汇编程序，所以它更具符号性且更易于理解。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-09-25T05:15:38.370

熟悉低级组装（我的意思是低级组装，而不是“宏”和那头公牛）可能是必须的。如果您真的想直接阅读原始机器代码本身，通常您会使用十六进制编辑器。然而，为了理解指令的作用，大多数人会使用反汇编程序将其转换为适当的汇编指令。如果您是少数想要了解机器语言本身的人之一，我认为您会想要[英特尔® 64 和 IA-32 架构软件开发人员手册](http://www.intel.com/products/processor/manuals/)。**第 2 卷**专门介绍了指令集，它与您关于如何阅读机器代码本身以及汇编与它的关系的查询有关。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-16T17:59:37.613

你的好奇心和你的理解水平正是我曾经的位置。我**强烈**推荐[Code: The Hidden Language of Computer Hardware and Software](https://rads.stackoverflow.com/amzn/click/com/0735611319)。这不会回答你在这里提出的所有问题，但它会揭示计算机的一些完全黑魔法的方面。这是一本厚厚的书，但可读性很高。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-17T18:55:34.083

ACD See 可能利用了 .EXE 文件不对文件长度或超出文件预期部分长度的任何内容进行错误检查这一事实。因此，您可以制作一个 .EXE 文件，该文件将打开其自身并将超出给定点的所有内容作为数据加载。这很有用，因为您可以制作一个适用于给定数据集的 .EXE，只需在适当编写的 .EXE 末尾添加该数据即可

（我不知道 ACD See 到底是什么，所以请多加注意，但我*知道*有些*程序*是这样生成的。）

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2019-01-19T19:26:27.333

每条指令都以机器代码形式保存在 cpu 内的特殊内存区域中。EARLY INTEL 书籍中给出了指令的机器码，因此应该尝试获取此类书籍以便理解这一点。显然，今天机器代码不容易获得。一个可以将十六进制反转为机器代码的程序会很好。或者手动做_!! 乏味

# database - 在一列数据中存储多个员工 ID

> ID：756370
> 
> 赞同：1
> 
> 时间：2009-04-16T14:27:24.140
> 
> 标签：database, data-storage

Web 应用程序是用带有 MSSQL 后端的经典 ASP 编写的。在此特定页面上，管理员可以选择 1 名或任何/所有员工来分配项目。我试图找出一种简单的方法来将分配给它的人员的员工 ID 存储在一个列中。

员工列表是从另一个表生成的，并且可以是动态的（解雇或雇用），因此我希望程序足够灵活，可以根据这些表更改进行更改。

基本上需要知道如何将多个人分配给以后可以在不同页面或从不同查询中调用的项目。

对不起，n00bish 的问题，但谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T14:30:26.457

**不要在一列中存储多个 ID！**使用现有表的主键和要存储的单个 ID 创建另一个表。然后，您可以在这个新表中插入多行，创建 1:m（一对多）关系。例如，让我们看一个订单表：

```
order:
    order_id
    order_date 
```

我有一个产品表...

```
product:
    product_id
    product_name 
```

现在，您可以继续在订单中添加一个列，让您在订单中列出产品，但这将是一种糟糕的形式。你想要的是类似..

```
order_item:
    order_item_id
    order_id
    product_id
    quantity
    unit_price 
```

然后，您可以执行联接以获取特定订单的所有产品...

```
select
    product.*

from orders 

inner join order_item on order_item.order_id = order.order_id
inner join product on product.product_id = order_item.product_id

where orders.order_id = 5 
```

这是一个示例 order_id 为 5，这将按该顺序获取所有产品。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T14:31:38.560

You need to create another table that stores these values such as. So this new table would store one row for each ID, and then link back to the original record with the original records ID.

# theory - 如果所需的资产无法加载，您应该怎么做？

> ID：756374
> 
> 赞同：0
> 
> 时间：2009-04-16T14:28:16.557
> 
> 标签：theory

我的程序在 Flex 中，但对于我提出的问题并不重要。好的，我需要加载一个 XML 文件才能让应用程序正常工作。如果我在加载 xml 文件时捕获 IOError，我应该如何处理？应用程序需要它或者应用程序没用，所以我应该继续重试错误，还是应该通知用户稍后再试？你会怎么办？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T14:31:01.337

询问用户要做什么 - 重试或失败，失败意味着应用程序将关闭。如果有意义，请给用户一个浏览资源的机会。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:32:12.833

这实际上取决于文件的性质。如果您知道该文件将同时存在，那么等待该文件的创建可能是有意义的（尽管这似乎是一个穷人的网络模型）。但是，在应用程序在没有资源的情况下无用的情况下，我会失败且无法恢复，并向用户提供有意义的错误消息，并将一些调试代码记录到文件中，以便用户稍后提交以供开发人员调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:30:32.930

像 GMail - 两者都做。当发生错误或超时时通知用户，同时继续尝试。

```
Loading is taking longer than expected, retrying - please wait... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:32:11.367

通知用户 XML 不可用，并为用户提供重试加载 XML、查找另一个 XML 或退出应用程序的可能性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T14:37:51.710

我认为您不应该多次尝试页面有明显的滞后。这实际上取决于被访问的文件是否由第三方控制，以及它是否通常会在很长一段时间内失败，或者只是说一秒钟。

# java - 如何从groovy覆盖java方法

> ID：756379
> 
> 赞同：8
> 
> 时间：2009-04-16T14:29:23.293
> 
> 标签：java, groovy

我有一个 groovy 类，它能够将其输出写入`StringWriter`- （通过`setStringWriter`方法）。

在java中，我将使用以下代码：

```
filter.setStringWriter(new StringWriter(){
   @Override
   public void write(String string){
       // do something with the string
   }
}); 
```

对于 Groovy，我被告知要使用闭包，但我尝试了以下方法，但没有成功：

```
def s =  {String line -> print line} as StringWriter
filter.setStringWriter(s) 
```

或者

```
filter.setStringWriter{String line -> print line} 
```

我该如何去做，或者甚至有可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T14:51:17.873

以下[链接](http://groovy.codehaus.org/Groovy+way+to+implement+interfaces)提供了一个线索，尽管它只提到了接口。

以下适用于 Groovy 1.6.1：

```
def s =  [ write: { String line -> print line} ] as StringWriter
filter.setStringWriter(s) 
```

# javascript - 书签等到加载 Javascript

> ID：756382
> 
> 赞同：20
> 
> 时间：2009-04-16T14:29:30.140
> 
> 标签：javascript, jquery, bookmarklet

我有一个加载 jQuery 和其他一些 js 库的书签。

我如何能：

*   等到我正在使用的 javascript 库可用/加载。如果我在完成加载之前尝试使用脚本，例如在加载之前使用带有 jQ​​uery 的 $ 函数，则会引发未定义的异常。
*   确保我加载的小书签不会被缓存（不使用服务器标头，或者显然，这是一个 javascript 文件：*元标记*）

有人知道动态添加的 javascript 的 onload 是否在 IE 中有效吗？[（与这篇文章](http://answers.google.com/answers/threadview?id=595949)相矛盾）

对这些问题最简单、最干净的解决方案是什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-16T14:57:29.980

这取决于您实际加载 jQuery 的方式。如果要将脚本元素附加到页面，则可以使用 jQuery 用于动态加载脚本的相同技术。

**编辑**：我做了功课，实际上从 jQuery 代码中提取了一个 loadScript 函数，以便在您的书签中使用。它实际上可能对许多人（包括我）有用。

```
function loadScript(url, callback)
{
    var head = document.getElementsByTagName("head")[0];
    var script = document.createElement("script");
    script.src = url;

    // Attach handlers for all browsers
    var done = false;
    script.onload = script.onreadystatechange = function()
    {
        if( !done && ( !this.readyState 
                    || this.readyState == "loaded" 
                    || this.readyState == "complete") )
        {
            done = true;

            // Continue your code
            callback();

            // Handle memory leak in IE
            script.onload = script.onreadystatechange = null;
            head.removeChild( script );
        }
    };

    head.appendChild(script);
}

// Usage: 
// This code loads jQuery and executes some code when jQuery is loaded
loadScript("https://code.jquery.com/jquery-latest.js", function()
{
    $('my_element').hide();
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:39:34.687

要回答您的第一个问题：Javascript 是按顺序解释的，因此在加载库之前，任何后续的小书签代码都不会执行（假设库被成功解释 - 没有语法错误）。

为了防止文件被缓存，您可以附加一个无意义的查询字符串...

```
url = 'jquery.js?x=' + new Date().getTime(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-04T07:01:50.283

我注意到在 Chrome 中，当使用@Vincent Robert 的技术时，加载脚本的顺序是不确定的。在这种情况下，稍作修改会有所帮助：

```
 (function() {
    var callback = function() {
        // Do you work
    };
        // check for our library existence
    if (typeof (MyLib) == 'undefined') {
        var sources = [
                'http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js',
            'https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js',
            'https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js',
            'http://myhost.com/javascripts/mylib.min.js'];

        var loadNextScript = function() {
            if (sources.length > 0) {
                var script = document.createElement('script');
                script.src = sources.shift();
                document.body.appendChild(script);

                var done = false;
                script.onload = script.onreadystatechange = function() {
                    if (!done
                            && (!this.readyState || this.readyState == "loaded" || this.readyState == "complete")) {
                        done = true;

                        // Handle memory leak in IE
                        script.onload = script.onreadystatechange = null;

                        loadNextScript();
                    }
                }
            } else {
                callback();
            }
        }
        loadNextScript();

    } else {
        callback();
    }
})(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:48:27.943

[我对此](http://www.hunlock.com/blogs/Howto_Dynamically_Insert_Javascript_And_CSS)有了更深入的了解，但并非完全如此。如果有一个离散的小书签示例来演示如何避免缓存，那就太好了。

# c# - ParseStatementList 不适用于有效的 SQL 语句

> ID：756384
> 
> 赞同：1
> 
> 时间：2009-04-16T14:29:37.567
> 
> 标签：c#, .net, sql, parsing

我正在尝试使用 TSql100Parser.ParseStatementList 方法以编程方式解析 sql 语句并提取对象名称。这来自 Microsoft.Data.Schema.ScriptDom.Sql 命名空间。这是代码：

```
string sql = "CREATE VIEW testView AS SELECT * from testTable";
var parser = new TSql100Parser(false);
StatementList parsedStatements; IList errrors;

using (TextReader reader = new StringReader(sql)) 
{ 
       parsedStatements = parser.ParseStatementList(reader, out errors);
} 
```

ParseStatementList 方法返回 null，并将两个错误插入到错误列表中。错误是“CREATE 附近的语法无效”和“VIEW 附近的语法无效”。这很奇怪，因为 TSql100.Parse 方法成功解析了相同的 sql 语句。同样奇怪的是，上面的代码成功解析了SQL“DROP VIEW testView”

任何想法为什么它不会解析我的视图创建sql？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-23T17:35:16.297

ParseStatementList is used for parsing statements that can be in a batch or in the body of a stored procedure. Statements like CREATE VIEW (as well as CREATE/ALTER proc, trigger, function, etc). must be the only statement in the batch and thus can't be contained inside any other type of StatementList. These statements will only be parsed in the grammar rules for batches, and so ParseStatementList does not recognize them.

Why do you want to use ParseStatementList instead of Parse or ParseBatch here?

# algorithm - 检测数据变化的最佳哈希函数？

> ID：756407
> 
> 赞同：10
> 
> 时间：2009-04-16T14:33:00.380
> 
> 标签：algorithm, hash, dataset

我们有一个定价数据集，可以更改包含的值或记录数。与值的变化相比，添加或删除的记录数量很少。数据集通常有 50 到 500 个项目，具有 8 个属性。

我们目前使用 AJAX 返回表示数据集的 JSON 结构，并使用此结构更新网页，使用新值并在必要时删除或添加项目。

我们使用两个哈希值发出请求，一个用于值，另一个用于记录。这些是与 JSON 结构一起返回的 MD5 哈希，将与以下请求一起发送。如果哈希值发生变化，我们知道我们需要一个新的 JSON 结构，否则只会返回哈希值以节省带宽并消除不必要的客户端处理。

由于 MD5 通常与加密一起使用，因此仅检测数据更改的哈希算法是最佳选择吗？

我们可以检测到值的更改并更新以及检测添加或删除的项目并相应地操作页面 DOM 有哪些替代方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T14:37:24.630

MD5 是一种合理的算法来检测一组数据的变化。但是，如果您不关心加密属性，并且非常关心算法的性能，您可以使用更简单的校验和风格的算法，该算法并非旨在加密安全。（尽管近年来发现了 MD5 的弱点，但它仍被设计为加密安全，因此所做的工作比您的场景所需的要多）。

但是，如果您对 MD5 的计算性能感到满意，我会坚持使用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T14:47:47.600

MD5就好了。如果它的性能太低，您可以尝试快速校验和算法，例如[Adler-32](http://en.wikipedia.org/wiki/Adler32)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:43:28.063

你所做的对我来说听起来不错。

如果服务器端容量很便宜并且最小化网络使用率至关重要，您可以让服务器记住每个客户端的最后一个数据集是什么，并仅发送每个请求的差异（作为插入、删除和编辑的列表） . 如果您首先对数据行进行排序，则可以使用诸如 by 使用的差分算法相当有效地计算这些差异`diff`。

这种方法对网络中断很敏感——如果客户端没有收到一个响应，错误就会累积。然而，这可以通过让客户端在每个请求中发送 MD5 哈希来解决：如果它与服务器期望的不同，则将发送整个列表而不是更改列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:14:22.560

我同意乔纳森关于 MD5 的回答。至于检测更改的替代方法，如果您愿意在服务器上存储（或已经存储）最近更改的时间/日期，您可以将其来回传递给客户端。您完全避免了计算，甚至可以使用大部分现有代码。

--
bmb

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-16T14:39:15.123

我认为任何常用的散列函数都会做你想做的事——提供实体的唯一表示。

对于您要解决的问题，我的解决方案是拥有一个记录所有更改的后端表。不是更改本身，而是已更改行的标识符。定期回调到服务器并获取所有已更改对象的列表，并使用它来决定客户端需要更新/删除/添加哪些行。

# forms - ColdFusion 自动选择选项

> ID：756410
> 
> 赞同：3
> 
> 时间：2009-04-16T14:33:23.250
> 
> 标签：forms, coldfusion

在回发时为选择/选项元素自动设置选定项目的最佳方法是什么？这是我们目前的做法：

```
<select id="grade" name="grade">
  <option value="A"<cfif form.grade = 'A'> selected="selected"</cfif>>A</option>
  <option value="B"<cfif form.grade = 'B'> selected="selected"</cfif>>B</option> 
  <option value="C"<cfif form.grade = 'C'> selected="selected"</cfif>>C</option> 
  <option value="D"<cfif form.grade = 'D'> selected="selected"</cfif>>D</option> 
  <option value="F"<cfif form.grade = 'F'> selected="selected"</cfif>>F</option>
</select> 
```

使用 ColdFusion 是否有更清洁或更简单的方法？提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T12:40:25.203

在我看来，最好的方法之一是使用 CFSelect：

```
<cfquery name="getGrades" datasource="#application.dsn#">
  select gradeLetter from Grades
</cfquery>

<cfselect
  name="grade"
  query="getGrades"
  display="gradeLetter"
  value="gradeLetter"
  selected="#form.grade#" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T17:28:06.253

像这样：

```
<cfsavecontent variable="GradeOptions">
A:A
B:B
C:C
D:D
F:F
</cfsavecontent>

<select id="grade" name="grade">
    <cfloop index="CurOpt" list="#trim(GradeOptions)#" delimiters="#Chr(10)#">
        <option value="#ListFirst(CurOpt,':')#"<cfif form.grade EQ ListFirst(CurOpt,':')> selected="selected"</cfif>>#ListRest(CurOpt,':')#</option>
    </cfloop>
</select> 
```

假设您始终拥有单独的 value:label 信息 - 如果您的 value 和 label 始终相同，您可以这样做：

```
<cfsavecontent variable="GradeOptions">
A
B
C
D
F
</cfsavecontent>

<select id="grade" name="grade">
    <cfloop index="CurOpt" list="#trim(GradeOptions)#" delimiters="#Chr(10)#">
        <option<cfif form.grade EQ CurOpt> selected="selected"</cfif>>#CurOpt#</option>
    </cfloop>
</select> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:31:39.347

您也可以使用结构数组来执行此操作。

```
<cfparam name="form.grade" default="C">
<cfset mydata = [{grade="A",value="A"},{grade="B",value="B"},{grade="C",value="C"},{grade="D",value="D"},{grade="F",value="F"}]>
<cfoutput>
<select id="grade" name="grade">
    <cfloop array="#mydata#" index="i">
        <option value="#i['value']#"<cfif form.grade EQ i['grade']> selected="selected"</cfif>>#i['value']#</option>
    </cfloop>
</select>
</cfoutput> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T20:30:22.913

使用带有函数的cfscript

```
<cfscript>
Function setSelected(val1, val2){
    if (val1 EQ val2)
    {
        Return 'selected="selected"';
    } 
    else 
    {
        Return '';
    }
}
</cfscript>
<select id="grade" name="grade">
  <option value="A" #setSelected('A', form.grade)#>A</option>
  <option value="B" #setSelected('B', form.grade)#>B</option> 
  <option value="C" #setSelected('C', form.grade)#>C</option> 
  <option value="D" #setSelected('D', form.grade)#>D</option> 
  <option value="F" #setSelected('F', form.grade)#>F</option>
</select> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T18:54:46.153

那这个呢？

```
<cfparam name="form.grade" default="A">
<cfoutput>
<select id="grade" name="grade">
<cfloop index="code" from="65" to="90">
    <option value="#Chr(code)#"<cfif form.grade EQ Chr(code)> selected="selected"</cfif>>#Chr(code)#</option>
</cfloop>
</select>
</cfoutput> 
```

有点棘手，是的:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T22:24:56.960

您知道，这样说可能不受欢迎，但是您最初在问题中概述的解决方案是最好的。

这很简单，很容易看到正在做的事情，而不是为了变得棘手而试图变得棘手。

有时你只需要戴上手套

[http://thedailywtf.com/Articles/The_Complicator_0x27_s_Gloves.aspx](http://thedailywtf.com/Articles/The_Complicator_0x27_s_Gloves.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T22:41:23.787

为了扩展我的其他答案，您应该做的是通过将成绩存储在数据库中并使用类似于以下内容的代码，将数据与界面正确分离：

```
<cfset GradeOptions = Grades.readAvailable() />

<select id="grade" name="grade">
    <cfloop query="GradeOptions">
        <option value="#GradeCode#"
            <cfif Form.Grade EQ GradeCode>selected="selected</cfif>
            >#GradeCode# - #GradeDesc#</option>
    </cfloop>
</select> 
```

（同样，如果只将成绩视为单个字母，则可以在简单的列表/数组中提供值而不是查询。）

关键是，你可以在不改变界面的情况下改变你的成绩结构，同样更新界面也不需要你知道成绩是多少。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T05:03:42.320

老实说，我看不出其中任何一个比您的初始通行证的更正版本更好（下）

```
 <select id="grade" name="grade">
      <option value="A"<cfif form.grade EQ "A"> selected </cfif> >A</option>
      <option value="B"<cfif form.grade EQ "B"> selected </cfif> >B</option> 
      <option value="C"<cfif form.grade EQ "C"> selected </cfif> >C</option> 
      <option value="D"<cfif form.grade EQ "D"> selected </cfif> >D</option> 
      <option value="F"<cfif form.grade EQ "F"> selected </cfif> >F</option>
   </select> 
```

它简单、干净且易于理解。

如果您只是觉得需要更流畅并且要进行大量 UI 操作，请在 jQuery 上投入一些时间。研究 Ray Camden 的[jQuery 和 CF 帖子](http://www.coldfusionjedi.com/index.cfm/jQuery)以及 Ben Nadel 的[Javascript 和 CF 帖子](http://www.bennadel.com/blog/tags/6-Javascript-DHTML-blog-entries.htm)，很快这将成为第二天性……

```
<script type="text/javascript">                                         
  jQuery(document).ready(function() {
     $("#grade option[value='<CFOUTPUT>#FORM.Grade#</CFOUTPUT>']")
      .attr('selected', 'selected');
  });
</script>

<select id="grade" name="grade">
  <option value="A">A</option>
  <option value="B">B</option> 
  <option value="C">C</option> 
  <option value="D">D</option> 
  <option value="F">F</option>
</select> 
```

当然，它看起来比这里的其他一些选项更古怪，但在解决 CF 不擅长的问题方面非常强大（相信我，它很快就会变得有意义，你会想知道你是如何编写客户端 UI 代码的）没有它）。

学习任何流行的 JavaScript 库，您的 ColdFusion 客户端代码将变得更加优雅和强大。

# java - 如何在Java中将十进制小数转换为二进制？

> ID：756430
> 
> 赞同：1
> 
> 时间：2009-04-16T14:37:58.373
> 
> 标签：java, binary, decimal

我需要将基数 10 中的 0.5 转换为基数 2 (0.1)。我试过使用

```
Double.doubleToRawLongBits(0.5) 
```

它返回`4602678819172646912`我猜是十六进制的，但对我来说没有意义。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T14:51:26.547

编号 4602678819172646912 为 dec，十六进制为 0x3fe0000000000000。要拆除它：

```
 3   |   F   |   E   |  0 ...
0 0 1 1 1 1 1 1 1 1 1 0 0 ...
s|  exponent         |  mantissa 
```

s 是符号位，exponent 是移动了 2^9 的指数（因此这个指数意味着 -1），尾数是数字 1.xxx 的 xxx 部分（隐含 1.）。因此，这个数字是 1.000...*2^-1，也就是 0.5。

请注意，这仅描述“正常”数字，因此没有零、非规范、NaN 或无穷大

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T15:39:57.387

将您的数字乘以 2^n，转换为 BigInteger，转换为*二进制*字符串，在位置 n（从右到左）添加一个小数点。

示例（快速和 ++dirty）：

```
private static String convert(double number) {
    int n = 10;  // constant?
    BigDecimal bd = new BigDecimal(number);
    BigDecimal mult = new BigDecimal(2).pow(n);
    bd = bd.multiply(mult);
    BigInteger bi = bd.toBigInteger();
    StringBuilder str = new StringBuilder(bi.toString(2));
    while (str.length() < n+1) {  // +1 for leading zero
        str.insert(0, "0");
    }
    str.insert(str.length()-n, ".");
    return str.toString();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T14:45:57.463

这是十进制的`0x3FE0_0000_0000_0000`。尾数是 3FE 之后的零列表（编码符号和指数）。这就是您要查找的内容，因为零之前的 0.1 是隐含的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T02:35:58.370

要将十进制字符串转换为浮点二进制还是二进制字符串？如果是前者，只需使用 valueOf(); 如果是后者，使用 valueOf() 后跟 toString() 或 printf()。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-04-16T14:56:36.503

0.1 不是 0.5 的二进制表示

Java 将使用 IEEE 754 表示 0.5，如[Java Language Specification](http://java.sun.com/docs/books/jls/second_edition/html/typesValues.doc.html#9208)中所指定。`BigInteger.valueOf(Double.doubleToRawLongBits(0.5)).toByteArray()`正如 Java 在内部所做的那样，将为您提供 0.5 的每字节表示。

# ruby - 将红宝石哈希转换为数组的最佳方法是什么

> ID：756431
> 
> 赞同：5
> 
> 时间：2009-04-16T14:38:26.750
> 
> 标签：ruby, arrays, hash

我有一个看起来像这样的红宝石哈希

```
{ "stuff_attributes" => {
     "1" => {"foo" => "bar", "baz" => "quux"}, 
     "2" => {"foo" => "bar", "baz" => "quux"} 
   }
} 
```

我想把它变成一个看起来像这样的哈希

```
{ "stuff_attributes" => [
    { "foo" => "bar", "baz" => "quux"},
    { "foo" => "bar", "baz" => "quux"}
  ]
} 
```

我还需要保留键的数字顺序，并且键的数量是可变的。上面是超级简化的，但我在底部包含了一个真实的例子。最好的方法是什么？

附言

它还需要递归

就递归而言，这是我们可以假设的：

1) 需要操作的键将匹配 /_attributes$/ 2) 散列将有许多其他键不匹配 /_attributes$/ 3) 散列内的键将始终是数字 4) _attributes 散列可以处于任何其他键下的任何散列级别

这个散列实际上是控制器中创建操作的参数散列。这是需要使用此例程解析的内容的真实示例。

```
{
    "commit"=>"Save", 
    "tdsheet"=>{
    "team_id"=>"43", 
    "title"=>"", 
    "performing_org_id"=>"10", 
    "tdsinitneed_attributes"=>{ 
        "0"=>{
            "title"=>"", 
            "need_date"=>"", 
            "description"=>"", 
            "expected_providing_organization_id"=>"41"
            }, 
        "1"=>{
            "title"=>"", 
            "need_date"=>"", 
            "description"=>"", 
            "expected_providing_organization_id"=>"41"
            }
        }, 
        "level_two_studycollection_id"=>"27", 
        "plan_attributes"=>{
            "0"=>{
                "start_date"=>"", "end_date"=>""
            }
        }, 
        "dataitem_attributes"=>{
            "0"=>{
                "title"=>"", 
                "description"=>"", 
                "plan_attributes"=>{
                    "0"=>{
                        "start_date"=>"", 
                        "end_date"=>""
                        }
                    }
                }, 
            "1"=>{
                "title"=>"", 
                "description"=>"", 
                "plan_attributes"=>{
                    "0"=>{
                        "start_date"=>"", 
                        "end_date"=>""
                        }
                    }
                }
            }
        }, 
    "action"=>"create", 
    "studycollection_level"=>"", 
    "controller"=>"tdsheets"
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T15:24:05.177

请注意，在转换之前测试所有键是否都是数字可能会很长......

```
def array_from_hash(h)
  return h unless h.is_a? Hash

  all_numbers = h.keys.all? { |k| k.to_i.to_s == k }
  if all_numbers
    h.keys.sort_by{ |k| k.to_i }.map{ |i| array_from_hash(h[i]) }
  else
    h.each do |k, v|
      h[k] = array_from_hash(v)
    end
  end
end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T14:48:24.370

如果我们可以假设所有键实际上都是可以干净地转换为整数的字符串，那么以下应该可以工作：

```
# "hash" here refers to the main hash in your example, since you didn't name it
stuff_hash = hash["stuff"]
hash["stuff"] = stuff_hash.keys.sort_by {|key| key.to_i}.map {|key| stuff_hash[key]} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-10-05T08:22:40.383

冒昧地说，我发布了一个与文森特罗伯特非常相似的代码示例。

这是`Hash`用方法修补类`.to_array`。

```
 class Hash
   def to_array(h = self)
     return h unless h.is_a? Hash
     if h.keys.all? { |k| k.to_i.to_s == k } # all keys are numbers so make an array.
       h.keys.sort_by{ |k| k.to_i }.map{ |i| self.to_array(h[i]) }
     else
       h.each do |k, v|
         h[k] = self.to_array(v)
       end
     end
   end
 end 
```

它使使用更加方便。

# java - 仍未找到 buildpath-jar 中的类

> ID：756437
> 
> 赞同：0
> 
> 时间：2009-04-16T14:39:58.557
> 
> 标签：java, eclipse-rcp

我正在开发一个 Eclipse 插件 rcp，但遇到了 NoClassDefFoundError

```
线程“Thread-7”中的异常 java.lang.NoClassDefFoundError: org/jdom/input/SAXBuilder  
    在 org.geonames.WebService.search(WebService.java:783)  
    在 geo.GeocoderGeonames$SearchThread.run(GeocoderGeonames.java:119)  
引起：java.lang.ClassNotFoundException：org.jdom.input.SAXBuilder  
    在 org.eclipse.osgi.framework.internal.core.BundleLoader.findClassInternal(BundleLoader.java:483)  
    在 org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:399)  
    在 org.eclipse.osgi.framework.internal.core.BundleLoader.findClass(BundleLoader.java:387)  
    在 org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:87)  
    在 java.lang.ClassLoader.loadClass（未知来源）  
    在 java.lang.ClassLoader.loadClassInternal（未知来源）  
    ... 2 更多

```

据说找不到的类在我添加到构建路径的 jar 中。当正在运行的应用程序输入需要此类的代码时，我没有得到任何编译错误等只有这个异常......

还有其他地方我需要添加罐子吗

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:48:26.680

阅读[此](http://www.eclipsezone.com/articles/eclipse-vms/)内容后，将 jar 添加到 MANIFEST.MF，从而解决了问题。据我了解，eclipse启动了几个类加载器，它们只看到MANIFEST.MF告诉他们看到的内容并忽略了构建路径......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:46:16.917

你是如何运行你的插件的？您可能需要将 JAR 添加到 VM 参数中的类路径中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:59:51.440

根据我们的经验，a`NoClassDefFoundError`有时意味着找到了多个版本的类，因为`ClassNotFoundException`如果找不到类，通常也会抛出一个。

您的情况（XML解析器）的另一个原因可能是带有认可的类。您是直接导入 jdom 类还是类似 org.w3c ...？如果是这样，请查看 Java 的“认可类”系统，这是我最近遇到的。

# .net - 使用 /clr:safe 编译 C++ 项目以启用单元测试有什么缺点？

> ID：756439
> 
> 赞同：1
> 
> 时间：2009-04-16T14:40:48.973
> 
> 标签：.net, c++, unit-testing, nunit

我想向我们的 C++ 产品介绍单元测试，并想研究尝试使用基于 CLR 的单元测试的利弊。我读过，如果您使用 /clr:safe 选项进行编译，则可以调用现有的 C++ 代码。

我严格来说是一个 .NET 开发人员，所以我不知道这将如何影响我们的代码库。在我尝试将其介绍给 C++ 团队之前，我应该了解什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T14:50:18.327

这根本行不通。C++ 代码**不会**在 /clr:safe 下编译；几乎每一行都会出错。/clr:safe 为您提供一种基本上不与 C++ 共享数据类型的语言。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:17:48.907

/clr:safe 将允许您使用“C++.NET”，这可能与“C++”团队使用的不同。除非他们愿意重新编码以使用“.NET C++”（对于初学者来说，它具有用于“堆上的新对象”的 ^ 运算符），否则他们的东西将无法工作。

# javascript - 使用 jQuery 的编程挑战

> ID：756443
> 
> 赞同：3
> 
> 时间：2009-04-16T14:41:21.500
> 
> 标签：javascript, jquery

这是对上一个问题的跟进，该问题似乎使人们感到困惑，因此我将对其进行一些净化。这是一些标记。

```
<div class="button width120 height30 iconLeft colorRed"></div>
<div class="button width180 height20 iconPlus colorBlue"></div>
<div class="button width200 height10 iconStar colorGreen"></div>
<div class="button width110 height60 iconBack colorOrange"></div> 
```

挑战是填写下面的代码。

```
$(".button").each(function(){

    // Get the width from the class

    // Get the height from the class

    // Get the icon from the class

    // Get the color from the class

}); 
```

现在，我知道你不应该以这种方式使用类，所以我不是在寻找替代方法，这是一个实验，我很想知道是否可以这样做。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T14:51:18.730

就像是：

```
$(".button").each(function(){
    var classNames = $(this).attr('class').split(' ');
    var width, height;
    for(int i = 0; i < classNames.length; i++) {
        var className = classNames[i];
        if(className.indexOf('width') > -1) {
            width = className.substring(5, className.length - 1);
        } else if(className.indexOf('height') > -1) {
            height = className.substring(6, className.length - 1);
        } // etc. etc.
    }
}); 
```

还是我误解了你的要求？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T16:05:17.653

这是一个糟糕的主意，但既然你似乎已经知道了，下面是代码：

```
$(".button").each( function() {
  var width, height, color, icon;
  $.each( $(this).attr('class').split(), function( cls ) {
    if( cls.match("^width") ) { width = cls.split('width').pop(); }
    else if( cls.match("^height") ) { height = cls.split('height').pop(); }
    else if( cls.match("^icon") ) { icon = cls.split('icon').pop(); }
    else if( cls.match("^color") ) { color = cls.split('color').pop(); }
  } );
  console.log( "width: " + width );
  console.log( "height: " + height );
  console.log( "icon: " + icon );
  console.log( "color: " + color );
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T15:51:11.323

我发现这个答案看起来非常强大......

```
$(".button").each(function(el){
    classStr = el.className;
    classes = classStr.split(' ');

    // Loop through classes and find the one that starts with icon

}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T16:17:44.707

```
$(".button").each( function() {
    var classStr = this.className;
    var classes = {}
    classStr.replace( /(width|height|icon|color)([a-z0-9]+)/gi,
        function( str, key, val ) {
            classes[key] = val;
        }
    );
    console.log( classes );
});

/*
 * {
 *     width:  '120',
 *     height: '30',
 *     icon:   'Left',
 *     color:  'Red'
 * }
 */ 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T16:04:23.193

我喜欢以愚蠢的方式解决一些挑战。:D 这是一个非常不优雅、低效且不是很安全的解决方案。但我写得很开心。

```
<!doctype html>
<html>

  <head>

    <script src="jquery/jquery-1.3.2.min.js"></script>
    <script>
      $(function () {
        $(".button").each(function(){
          var div = $(this)
          div.css({"border":"1px solid black"});
          var classes = div.attr('class').split(' ').slice(1);
          classes.forEach( function (element) {
            div.append(/(width|height)(\d+)|(icon|color)(\S+)/.exec(element).filter(function (element) {return !!element} ).slice(1).join(": ").concat("<br>" ) )
          })
        })
      });

    </script>
  </head>
  <body>
    <div class="button width120 height30 iconLeft colorRed"></div>
    <div class="button width180 height20 iconPlus colorBlue"></div>
    <div class="button width200 height10 iconStar colorGreen"></div>
    <div class="button width110 height60 iconBack colorOrange"></div>

  </body>

</html> 
```

哦，它不适用于每个浏览器。;)

# c# - 如何在不发送消息的情况下测试我的电子邮件设置？

> ID：756448
> 
> 赞同：3
> 
> 时间：2009-04-16T14:42:33.727
> 
> 标签：c#, email, c#-3.0

作为我的应用程序配置过程的一部分，我有一个健全性检查器来验证所有用户提供的数据。这包括应用程序用来发送电子邮件的电子邮件服务器设置。

我想对这些设置进行简单的完整性检查，而无需实际发送任何电子邮件。如果它可以支持所有标准风格的 SMTP 设置，包括那些带有身份验证/ssl/等的设置，那就太好了。

它不需要详尽无遗，但覆盖范围越广越好。

目前我所做的只是验证我可以在给定端口上打开到给定服务器的连接。更深一点的东西会很好。

注意：我*不是*要验证电子邮件地址——这与这个问题无关。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T14:49:25.303

您只需打开与用户提供的服务器和端口的原始连接并执行

```
HELO Server.Domain.Com
Mail From: validaccount@domain.com 
```

查看您是否收到有效的 HELO 响应和发件人 OK 响应（如果启用了 smtp 身份验证）。

与直接通过 telnet 连接到服务器时所做的相同。

[http://www.petri.co.il/test_smtp_service.htm](http://www.petri.co.il/test_smtp_service.htm)

这也可能有用

[http://qmail.jms1.net/test-auth.shtml](http://qmail.jms1.net/test-auth.shtml)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:49:15.443

我敢肯定，更聪明、更有资格的人会提出更好的答案。但是，乍一看，我想说的是，如果不实际发送电子邮件，您就无法验证*成功*发送电子邮件的能力。

但是，如果您想自动化该过程，您可以拥有一个“MyApp_SanityCheck@gmail.com”（或您的本地域）地址。

然后，您可以创建一个监视该电子邮件地址的监视程序应用程序，或者只是一个简单的应用程序，它以编程方式与该电子邮件地址交互并检查是否在 X 分钟内收到了电子邮件。通过这种方式，您可以 100% 确定电子邮件能够发送出去。此链接显示[如何以编程方式检查 gmail 地址](http://yellowduckguy.spaces.live.com/blog/cns!DA380C13569E8907!225.entry)。

重要说明：如果您的应用程序正在发送外部电子邮件，那么最好使用外部电子邮件地址，因为您的服务器可能无法发送外部电子邮件，但内部电子邮件可以正常发送，在这种情况下，您的健全性检查会发出误报。

# javascript - 如何使用 jQuery 判断网站访问者以前是否访问过该网站？

> ID：756450
> 
> 赞同：5
> 
> 时间：2009-04-16T14:42:42.747
> 
> 标签：javascript, jquery, cookies

我想为第一次访问我的网站的访问者创建一个带有消息的 div 容器。访问者将阅读它并单击“隐藏”按钮将其永久消失。

这是怎么做到的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T14:46:34.857

为 jQuery使用[Cookie 插件怎么样？](http://plugins.jquery.com/project/Cookie)

```
$.cookie('the_cookie', 'the_value'); // Create a session cookie ("the_cookie") and set its value to "the_value"
$.cookie('chocolate_chip_cookie', 'the_value', { // create a cookie with all available options
    expires: 7, // expires in seven days
    path: '/', // accessible from the whole site...
    domain: 'jquery.com',
    secure: true // ...but only on a secure connection
});
$.cookie('the_cookie', null); // delete the session cookie 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:47:12.873

您可以通过以下方式完成此操作：

1.  设置 cookie。
2.  将状态存储在会话中。

您可以 1\. 使用 JavaScript，也可以使用 PHP。2\. 只能在服务器端使用例如 PHP 来完成。

本教程可能会有所帮助： [http ://www.shopdev.co.uk/blog/cookies-with-jquery-designing-collapsible-layouts/](http://www.shopdev.co.uk/blog/cookies-with-jquery-designing-collapsible-layouts/)

# c# - 使用 SSIS DataFlowTask 从平面文件源以编程方式派生的列

> ID：756455
> 
> 赞同：3
> 
> 时间：2009-04-16T14:44:11.103
> 
> 标签：c#, sql-server, vb.net, ssis

此使用 OLEDB 源的代码将填充其下方的 OutputColumnCollection，使用平面文件源的代码将不会填充 OutputColumnCollection。

## 为什么不？

```
 Microsoft.SqlServer.Dts.Runtime.Application a = new Microsoft.SqlServer.Dts.Runtime.Application();
        String SSISPackageFilePath;
        SSISPackageFilePath = "Package Name"; 

        Package pkg = new Package();
        MainPipe dataFlow;

        //oledb source
        ConnectionManager conMgrSource = pkg.Connections.Add("OLEDB");
        conMgrSource.ConnectionString = "Data Source=Steve;Initial Catalog=Scrambler;Provider=SQLNCLI.1;Integrated Security=SSPI;Auto Translate=False;";

        // set the standardized name on source
        conMgrSource.Name = "ConnectionSource";

        ConnectionManager conMgrDestination = pkg.Connections.Add("OLEDB");
        conMgrDestination.Name = "OLEDBConnectionDestination";
        conMgrDestination.ConnectionString = "Data Source=server;Initial Catalog=Scrambler;Provider=SQLNCLI.1;Integrated Security=SSPI;Auto Translate=False;";

        Executable exe = pkg.Executables.Add("DTS.Pipeline.1");

        TaskHost th = exe as TaskHost;
        th.Name = "DynamicDataFlowTask";
        dataFlow = th.InnerObject as MainPipe;

        IDTSComponentMetaDataCollection90 metadataCollection = dataFlow.ComponentMetaDataCollection;
        IDTSComponentMetaData90 Source = dataFlow.ComponentMetaDataCollection.New();
        Source.Name = "Source";
        //sql server
        //-------
        Source.ComponentClassID = "DTSAdapter.OLEDBSource.1";
        //-------

        IDTSComponentMetaData90 OLEDBDestination = dataFlow.ComponentMetaDataCollection.New();
        OLEDBDestination.Name = "OLEDBDestination";
        OLEDBDestination.ComponentClassID = "DTSAdapter.OLEDBDestination.1";

        // Get the design time instance of the component.
        CManagedComponentWrapper InstanceSource = Source.Instantiate();
        // Initialize the component
        InstanceSource.ProvideComponentProperties();
        // Specify the connection manager.
        if (Source.RuntimeConnectionCollection.Count > 0)
        {
            Source.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(pkg.Connections["ConnectionSource"]);
            Source.RuntimeConnectionCollection[0].ConnectionManagerID = pkg.Connections["ConnectionSource"].ID;
        }

        //sql server
        InstanceSource.SetComponentProperty("OpenRowset", SourceTableNameInternal);
        InstanceSource.SetComponentProperty("AccessMode", 0);

        //reinitialize the component 
        InstanceSource.AcquireConnections(null);
        InstanceSource.ReinitializeMetaData();
        InstanceSource.ReleaseConnections();

        // Get the design time instance of the component.
        CManagedComponentWrapper InstanceDestination = OLEDBDestination.Instantiate();
        // Initialize the component
        InstanceDestination.ProvideComponentProperties();
        // Specify the connection manager.
        if (OLEDBDestination.RuntimeConnectionCollection.Count > 0)
        {
            OLEDBDestination.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(pkg.Connections["OLEDBConnectionDestination"]);
            OLEDBDestination.RuntimeConnectionCollection[0].ConnectionManagerID = pkg.Connections["OLEDBConnectionDestination"].ID;
        }

        InstanceDestination.SetComponentProperty("OpenRowset", DestinationTableNameInternal);
        InstanceDestination.SetComponentProperty("AccessMode", 0);

        //reinitialize the component 
        InstanceDestination.AcquireConnections(null);
        InstanceDestination.ReinitializeMetaData();
        InstanceDestination.ReleaseConnections();

        //map the columns
        IDTSPath90 path = dataFlow.PathCollection.New();
        path.AttachPathAndPropagateNotifications(**Source.OutputCollection[0]**, OLEDBDestination.InputCollection[0]); 
```

* * *

// Source.OutPutCollection[0].OutputColumnCollection 包含数据源的列。下面，为 Flatfile 源更改的相同代码不起作用。

* * *

```
 Microsoft.SqlServer.Dts.Runtime.Application a = new Microsoft.SqlServer.Dts.Runtime.Application();
        String SSISPackageFilePath;
        SSISPackageFilePath = PackageNameInternal; 

        if (File.Exists(SSISPackageFilePath))
            File.Delete(SSISPackageFilePath);

        Package pkg = new Package();
        MainPipe dataFlow;

        // csv source
        ConnectionManager conMgrSource = pkg.Connections.Add("FLATFILE");
        conMgrSource.ConnectionString = @"c:\temp\test.txt";
        conMgrSource.Properties["ColumnNamesInFirstDataRow"].SetValue(conMgrSource, true);
        conMgrSource.Properties["FileUsageType"].SetValue(conMgrSource, Microsoft.SqlServer.Dts.Runtime.Wrapper.DTSFileConnectionUsageType.DTSFCU_FILEEXISTS);
        conMgrSource.Properties["Format"].SetValue(conMgrSource, "Delimited");
        conMgrSource.Properties["RowDelimiter"].SetValue(conMgrSource, "{CR}{LF}");
        conMgrSource.Properties["HeaderRowDelimiter"].SetValue(conMgrSource, "{CR}{LF}");

        // set the standardized name on source
        conMgrSource.Name = "ConnectionSource";

        ConnectionManager conMgrDestination = pkg.Connections.Add("OLEDB");
        conMgrDestination.Name = "OLEDBConnectionDestination";
        conMgrDestination.ConnectionString = "Data Source=server;Initial Catalog=Scrambler;Provider=SQLNCLI.1;Integrated Security=SSPI;Auto Translate=False;";

        Executable exe = pkg.Executables.Add("DTS.Pipeline.1");

        TaskHost th = exe as TaskHost;
        th.Name = "DynamicDataFlowTask";
        dataFlow = th.InnerObject as MainPipe;

        IDTSComponentMetaDataCollection90 metadataCollection = dataFlow.ComponentMetaDataCollection;
        IDTSComponentMetaData90 Source = dataFlow.ComponentMetaDataCollection.New();
        Source.Name = "Source";

        //csv
        //-------
        Source.ComponentClassID = "DTSAdapter.FlatFileSource.1";
        // Get native flat file connection 
        // customize delimiters through the columns collection
        //RuntimeWrapper.IDTSConnectionManagerFlatFile90 connectionFlatFile = conMgrSource.InnerObject as RuntimeWrapper.IDTSConnectionManagerFlatFile90;
        //foreach (RuntimeWrapper.IDTSConnectionManagerFlatFileColumns90 col in connectionFlatFile.Columns)
        //{
        //                    
        //}
        //-------

        IDTSComponentMetaData90 OLEDBDestination = dataFlow.ComponentMetaDataCollection.New();
        OLEDBDestination.Name = "OLEDBDestination";
        OLEDBDestination.ComponentClassID = "DTSAdapter.OLEDBDestination.1";

        // Get the design time instance of the component.
        CManagedComponentWrapper InstanceSource = Source.Instantiate();
        // Initialize the component
        InstanceSource.ProvideComponentProperties();
        // Specify the connection manager.
        if (Source.RuntimeConnectionCollection.Count > 0)
        {
            Source.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(pkg.Connections["ConnectionSource"]);
            Source.RuntimeConnectionCollection[0].ConnectionManagerID = pkg.Connections["ConnectionSource"].ID;
        }

        //reinitialize the component 
        InstanceSource.AcquireConnections(null);
        InstanceSource.ReinitializeMetaData();
        InstanceSource.ReleaseConnections();

        // Get the design time instance of the component.
        CManagedComponentWrapper InstanceDestination = OLEDBDestination.Instantiate();
        // Initialize the component
        InstanceDestination.ProvideComponentProperties();
        // Specify the connection manager.
        if (OLEDBDestination.RuntimeConnectionCollection.Count > 0)
        {
            OLEDBDestination.RuntimeConnectionCollection[0].ConnectionManager = DtsConvert.ToConnectionManager90(pkg.Connections["OLEDBConnectionDestination"]);
            OLEDBDestination.RuntimeConnectionCollection[0].ConnectionManagerID = pkg.Connections["OLEDBConnectionDestination"].ID;
        }

        //reinitialize the component 
        InstanceDestination.AcquireConnections(null);
        InstanceDestination.ReinitializeMetaData();
        InstanceDestination.ReleaseConnections();

        //map the columns
        IDTSPath90 path = dataFlow.PathCollection.New();
        path.AttachPathAndPropagateNotifications(**Source.OutputCollection[0]**, OLEDBDestination.InputCollection[0]); 
```

* * *

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T17:52:48.287

由于数据类型不匹配，我在使用带有平面文件的 SSIS 进行输入和 sql 输出时遇到了问题。首先检查以确保它不是像这样简单的东西。

此外，您在帖子中没有包含太多关于出了什么问题的信息，所以我很难判断它是数据库问题还是您遇到了什么样的错误？您是否尝试过使用 SSIS gui 而不是以编程方式执行此操作？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-05T20:35:22.900

你现在可能已经解决了这个问题...... :) 如果是这样，请告诉我们。

在平面文件版本中，缺少目标连接分配后的以下行。这可能没有多大帮助（因为您的输入列丢失了），但让我们修复它，看看我们得到了什么错误......

```
InstanceDestination.SetComponentProperty("OpenRowset", 
DestinationTableNameInternal);        

InstanceDestination.SetComponentProperty("AccessMode", 0); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-26T08:56:02.373

这段代码是错误的：

```
conMgrSource.Properties["RowDelimiter"].SetValue(conMgrSource, "{CR}{LF}");
conMgrSource.Properties["HeaderRowDelimiter"].SetValue(conMgrSource, "{CR}{LF}"); 
```

此代码工作正常：

```
conMgrSource.Properties["HeaderRowDelimiter"].SetValue(conMgrSource, "\r\n"); 
```

# .net - Environment.TickCount() 的经过时间 - 避免换行

> ID：756462
> 
> 赞同：1
> 
> 时间：2009-04-16T14:45:30.087
> 
> 标签：.net, vb.net, rollover, gettickcount

绝对值是否保护以下代码不被`Environment.TickCount`包装？

```
If Math.Abs((Environment.TickCount And Int32.MaxValue) - StartTime) >= Interval Then
    StartTime = Environment.TickCount And Int32.MaxValue ' set up next interval
    ...
    ...
    ...
End If 
```

有没有更好的方法来防止`Environment.TickCount`环绕？

（这是 .NET 1.1。）

*编辑*- 根据 Microsoft [Environment.TickCount](http://msdn.microsoft.com/en-us/library/system.environment.tickcount.aspx)帮助修改代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-11-29T18:41:37.007

避免包装问题很容易，只要您要测量的时间跨度不超过 24.8 天（任何更长的时间都不能用有符号整数表示）。在 C# 中：

```
int start = Environment.TickCount;
DoLongRunningOperation();
int elapsedTime = Environment.TickCount - start; 
```

我对 VB.NET 不是很熟悉，但只要您使用未经检查的数学，这将起作用并且您不必担心换行。

例如，如果 Environment.TickCount 从 2147483600 回绕到 -2147483596，则无关紧要。您仍然可以计算它们之间的差异，即 100 毫秒。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-08-17T12:11:47.373

因为我正在研究这个并偶然发现了这个页面，所以我将分享一个我制作的小基准。

运行代码时，忽略每个测试的前 1000 个结果（用于预热）。也忽略“ignore:”之后打印的数字。它只是为了确保没有进行会影响结果的编译器优化。

我的电脑上的结果：

```
Test1 1000000: 7ms - Environment.TickCount
Test2 1000000: 1392ms - DateTime.Now.Ticks
Test3 1000000: 933ms - 秒表.ElapsedMilliseconds

```

DateTime.Now.Ticks （测试 2）和[Stopwatch.ElapsedMilliseconds （测试 3）](https://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.elapsedmilliseconds(v=vs.110).aspx)[都比](https://msdn.microsoft.com/en-us/library/system.datetime.ticks(v=vs.110).aspx)[Environment.TickCount](https://msdn.microsoft.com/en-us/library/system.environment.tickcount(v=vs.110).aspx) （测试 1）慢得多，但除非您执行大量计算，否则不足以引起注意。例如，我正在对此进行调查，因为我需要一种廉价的方式来在紧张的游戏循环中获得时间。

我认为我的解决方案必须类似于（未经测试）：

```
var elapsed = Environment.TickCount - start;
if (elapsed < 0)
   elapsed = Int32.MaxValue - start + Environment.TickCount; 
```

基准代码：

```
void Main()
{
    Test1(1000);
    Test1(1000000);
    Test2(1000);
    Test2(1000000);
    Test3(1000);
    Test3(1000000);
}

void Test1(int c) {
    var sw = new Stopwatch();
    sw.Start();
    long sum = 0;
    for (var i = 0; i < c; i++)
    {
        sum += Environment.TickCount;
    }
    sw.Stop();
    Console.WriteLine("Test1 " + c + ": " + sw.ElapsedMilliseconds + "ms   (ignore: " + sum + ")");}

void Test2(int c) {
    var sw = new Stopwatch();
    sw.Start();
    long sum = 0;
    for (var i = 0; i < c; i++)
    {
        sum += DateTime.Now.Ticks;
    }
    sw.Stop();
    Console.WriteLine("Test2 " + c + ": " + sw.ElapsedMilliseconds + "ms   (ignore: " + sum + ")");
}
void Test3(int c) {
    var sw = new Stopwatch();
    sw.Start();
    long sum = 0;
    var stopwatch = new Stopwatch();
    stopwatch.Start();
    for (var i = 0; i < c; i++)
    {
        sum += stopwatch.ElapsedMilliseconds;
    }
    sw.Stop();
    Console.WriteLine("Test3 " + c + ": " + sw.ElapsedMilliseconds + "ms   (ignore: " + sum + ")");
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-29T18:47:05.297

只需使用[秒表](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)：

```
Stopwatch stopWatch = new Stopwatch();
stopWatch.Start();
Thread.Sleep(10000);
stopWatch.Stop();
// Get the elapsed time as a TimeSpan value.
TimeSpan ts = stopWatch.Elapsed; 
```

它将返回一个 int64 而不是 int32。另外它更容易理解。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T14:52:15.890

我不确定你想要完成什么。看起来您正在尝试检测是否发生了特定的时间间隔，如果发生了，请执行一些特定的逻辑。

如果您为此目的使用 Environment.TickCount，这可能会给您带来无穷无尽的痛苦。正如您所指出的，这个值可以并且将大约每 25 天包装一次。没有办法防止这种情况发生，如果您尝试这样做，您最终会在代码中遇到错误。

相反，为什么不执行以下操作：

*   使用实际的 Timer 进行事件的内部和执行
*   将 StartTime 存储为 DateTime（或 VB 中的 Date）值。这个值的范围要长得多。您的应用程序不太可能运行足够长的时间以使该值回绕（操作系统将需要在此之前很久重新启动:)）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T14:57:13.227

根据您的准确性，您为什么不使用：

```
DateTime.Now.Ticks 
```

这个 Ticks 没有包装。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T15:01:36.757

您的代码很可能无法正常工作。如果应用程序要在 Vista 或更新的 Windows 版本上运行，可以使用[GetTickCount64](http://msdn.microsoft.com/en-us/library/ms724411.aspx)，但我认为情况并非如此，因为您使用的是 .NET 1.1。

您的代码不应检查间隔是否相等，因为这可能会出错。使用 Int64 来存储刻度，将最后处理的刻度存储在一个变量中，如果这个变量大于新刻度值，那么你有一个换行并且需要增加你的总刻度基数（Int64） - 假设你每 12 天检查一次蜱虫的频率超过 1 次...... ;)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-05-03T18:16:51.677

对于大多数用途，秒表是最合适的选择。Environment.TickCount 仅在以下情况下才有意义：

1.  时间测量本身所需的时间对时间至关重要，您需要最佳性能，因为您必须测量数百万次或数十亿次。这里 Tickcount 有优势，因为它可以约为。比 Stopwatch() 快 20-25 倍（在我的 i7 机器上测量）。

2.  但你不需要测量比 1 毫秒更精确

3.  您确定您不必计算超过 24 天，因为这是最大值。TickCount 的 32 位 int （翻转）时间。

通常情况**并非**如此，至少第 1 点无关紧要。秒表（通常测量精度至少高出约 1000 倍（微秒范围或更佳））通常是最合适的选择。

除了 .ElapsedMilliseconds 你还可以使用静态方法
`Stopwatch.GetTimestamp();`

原因如下：在我的旧 i7 上循环调用 Stopwatch 1000 万次需要 1.3 秒。GetTickCount64 稍微快一点，只需要 1 秒多一点。**所以选择一个，不必为 32 位的东西而苦恼。**

当然，给定的性能只是一个（我的）硬件的近似值，可能会有所不同。

但微软表示要尽一切努力使秒表（性能计数器）在所有系统上都达到最佳状态。似乎不太可能有人轻易击败：

[https://msdn.microsoft.com/en-us/library/windows/desktop/dn553408%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396#Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_](https://msdn.microsoft.com/en-us/library/windows/desktop/dn553408%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396#Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_)

语录：

“QPC 精度是否会受到电源管理或 Turbo Boost 技术引起的处理器频率变化的影响？不会。如果处理器具有不变的 TSC，则 QPC 不会受到这些变化的影响。[...]”

“QPC 在多处理器系统、多核系统和超线程系统上是否可靠工作？是的

如何确定和验证 QPC 在我的机器上工作？您无需执行此类检查。[...]“

尽管如此，阅读提供了许多更详细的信息，尤其是硬件和 Windows 版本的性能差异。但这可能是最重要的，如果您需要 Windows 不适合并且肯定不是最适合的实时性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-24T04:16:07.213

我假设 StartTime 是一个正符号整数；我假设您之前做过 StartTime = (Environment.TickCount And Int32.MaxValue)。

`Abs()` *不能解决*问题。如果 Interval < 12.43 天，则代码将正确计时，而 StartTime 较小​​。但有时，每当 StartTime > (24.86 days - Interval) 时，测试将比应有的更早通过，即 (TickCount And Int32.MaxValue) 翻转为 0 的那一刻。此外，如果 Interval > 12.43 天 AND (TickCount并且 Int32.MaxValue) 接近 12.43 天，测试永远不会通过。

做`Environment.TickCount And Int32.MaxValue`没有必要，也没有帮助。它生成一个正符号整数 32，表示以毫秒为单位的时间，每 24.86 天环绕到 0。替代方案更难理解，但它们可以让您毫无困难地进行长达 49.71 天的时间间隔。原始`Environment.TickCount`数据在 24.86 天后和每 49.71 天后环绕到 Int32.MinValue。强制转换`unchecked((Uint32)Environment.TickCount)`生成一个 [正] 无符号整数 32，表示以毫秒为单位的时间，每 49.71 天回绕到 0。（因为`Environment.TickCount`调用了 Windows 函数 GetTickCount()，它返回一个 DWORD (UInt32)，并将其未经检查地强制转换为 Int32。）

的环绕`Environment.TickCount`不会影响经过时间的测量。未经检查的减法总是给出正确的结果。

您可以将经过时间计算为带符号的 int32（-24.86 到 +24.86 天），如果您比较独立时间或可能混合未来和过去，则更有用；或 unsigned int32（0 到 +49.71 天）。您可以将 T0 捕获为有符号 int32 或无符号 int32；它对结果没有影响。如果 T0 或经过的时间未签名，则只需要 [unchecked] 强制转换；带有签名的 T0 和签名的经过时间，您不需要演员表。

捕获已签名的 T0：（C#）

```
...
int iT0 = Environment.TickCount;  // T0 is NOW.
...
iElapsed = unchecked(Environment.TickCount - iT0)  // -24.81 to +24.81 days
uiElapsed = unchecked((uint)Environment.TickCount - (uint)iT0)  // 0 to +49.71 days
if (uiElapsed >= uiTimeLimit)  // IF time expired,
{
    iT0 = Environment.TickCount;  // For the next interval, new T0 is NOW.
    ...
} 
```

捕获未签名的 T0（我的偏好；`Environment.TickCount`不应该被签名）：

```
...
uint uiT0 = unchecked((uint)Environment.TickCount);  // T0 is NOW.
...
iElapsed = unchecked(Environment.TickCount - (int)uiT0)  // -24.81 to +24.81 days
uiElapsed = unchecked((uint)Environment.TickCount - uiT0)  // 0 to +49.71 days
if (uiElapsed >= uiTimeLimit)  // IF time expired,
{
    uiT0 = unchecked((uint)Environment.TickCount);  // For the next interval, new T0 is NOW.
    ...
} 
```

如果您的 TimeLimit 接近环绕限制（24.81 或 49.71 天），则时间可能会在未通过测​​试的情况下到期。您必须在 Elapsed >= TimeLimit 时至少测试一次。（如果您不确定测试的频率是否足够高，您可以在 Elapsed 上添加一个备份测试。如果 Elapsed 减少，它已经结束，所以时间必须到了。）

=====

对于超过 49.71 天的时间间隔，您可以计算 uiElapsed 回绕的次数，也可以计算`Environment.TickCount`回绕的次数。您可以将计数器组合成一个 64 位值，进行模拟`GetTickCount64()`（仅在 Windows Vista 和更新版本中可用）。64 位值具有全范围（2.92 亿年）和全分辨率（1 毫秒）。或者，您可以制作一个 32 位值，其范围和/或分辨率有所降低。检查换行的代码必须至少每 49.71 天执行一次，以确保未检测到换行。

```
uint uiTickCountPrev = 0;
uint uiTickWrap = 0;
Int64 TickCount64;
...
uiTickCount = unchecked((uint)Environment.TickCount)  // 0 to +49.71 days
if (uiTickCount < uiTickCountPrev)  // IF uiElapsed decreased,
    uiWrapcount++;  count that uiElapsed wrapped.
uiElapsedPrev = uiElapsed;  // Save the previous value.
TickCount64 = (Int64)uiTickWrap << 32 + (Int64)uiTickCount; 
```

笔记：

`Environment.TickCount`给出自启动以来的时间，以毫秒为单位，分辨率为 10-16 毫秒。

未经检查的**Int32**差异给出了时间差，-24.81 到 +24.81 天，带有环绕。未经检查的 32 位整数减法溢出并回绕到正确的值。的标志`Environment.TickCount`从不重要。示例，由一个环绕：`iBase = Environment.TickCount`gets `Int32.MaxValue`; 一个滴答声后，`Environment.TickCount`换行到`Int32.MinValue`; 并`unchecked(Environment.TickCount - iBase)`产生 1。

未经检查的**UInt32**差异给出了时间差，0 到 +49.71 天，带有环绕。（经过的时间永远不会是负数，因此这是更好的选择。）无符号 32 位整数的未经检查的减法溢出并回绕到正确的值。示例，由一个环绕：`iBase = Environment.TickCount`gets `UInt32.MaxValue`; 一个滴答声后，`Environment.TickCount`换行到`UInt32.MinValue`; 并`unchecked(Environment.TickCount - iBase)`产生 1。

# javascript - 具有单个文本字段的 HTML 表单 + 防止 Internet Explorer 中的回发

> ID：756466
> 
> 赞同：2
> 
> 时间：2009-04-16T14:46:37.493
> 
> 标签：javascript, internet-explorer, dom-events, autopostback

我注意到 IE 中有一个相当奇怪的行为。

我有一个带有单个输入文本字段和一个提交按钮的 HTML 表单

在提交单击时，我需要执行一个客户端 JavaScript 函数来执行必要的操作。

现在，当我想阻止文本字段中的回发时（按回车键）。

我添加了一个按键 JavaScript 函数，如下所示：

```
<input type=text onkeypress="return OnEnterKeyPress(event)" />

 function OnEnterKeyPress(event) {
            var keyNum = 0;
            if (window.event) // IE
            {
                keyNum = event.keyCode;
            }
            else if (event.which) // Netscape/Firefox/Opera
            {
                keyNum = event.which;
            }
            else return true;  
            if (keyNum == 13) // Enter Key pressed, then start search, else do nothing.
            {
                OnButtonClick();
                return false;
            }
            else
                return true;
        } 
```

奇怪的是，这不起作用。

* * *

但是如果我将文本字段传递给函数：

```
<input type=text onkeypress="return OnEnterKeyPress(this,event);" />

 function OnEnterKeyPress(thisForm,event) {
            var keyNum = 0;
            if (window.event) // IE
            {
                keyNum = event.keyCode;
            }
            else if (event.which) // Netscape/Firefox/Opera
            {
                keyNum = event.which;
            }
            else return true;  
            if (keyNum == 13) // Enter Key pressed, then start search, else do nothing.
            {
                OnButtonClick();
                return false;
            }
            else
                return true;
        } 
```

我能够防止回发。

谁能确认这里到底发生了什么？

HTML 表单只有一个文本框和一个提交按钮。

提交时执行的 JavaScript 函数的结果输出显示在单独 div 的 HTML 文本区域中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T02:22:09.713

找到了解决此问题的方法。

我刚刚发现在 IE 中，如果在一个表单中只有一个文本字段和一个提交按钮，则按 Enter 会导致表单提交。但是，如果有多个文本框，IE 不会在输入时自动回发表单，而是触发按钮的 onclick 事件。

所以我在表单中引入了一个隐藏的文本字段，一切都很神奇。我什至不需要处理文本字段的 onkeypress 事件。

```
<Form>
    <input type="text" />
    <input type="text" style="display:none"/>
    <input type="submit" onClick="callPageMethod();return false;"/>
</Form> 
```

这对我来说非常有效！

这在 FF 中不是问题，因为直接按 Enter 会导致调用提交按钮的 onclick 事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-22T21:34:57.577

您好，您也可以禁用默认行为。

```
jQuery('#yourInput').keydown(function (e) {
  if (e.keyCode == 13) {
    e.preventDefault();
  }
}); 
```

干杯!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:53:36.277

在用于通过 javascript 提交表单的 onsubmit 中返回 false。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:40:37.853

必须与您尚未发布的其他代码进行一些交互。您的代码在两种变体中都为我停止了表单提交，没有理由不应该这样做。

但是捕获 Enter 按键很难正确执行，并且可能会像其他任何事情一样烦人。几乎总是有更好的方法。

例如，正如 altCognito 建议的那样，让“form.onsubmit”返回 false，因此表单永远不会提交以响应用户交互。此外，如果您将 AJAX 代码（假设这是您正在执行的操作）放在 onsubmit 处理程序中而不是 onclick 按钮上，您还可以使其按 Enter 与单击提交按钮具有相同的效果，即用户通常会期望。

如果您不希望这样，似乎根本没有理由包含 <form> 元素。如果您从不期望浏览器将它们提交到任何地方，那么仅将输入元素单独放置是完全有效的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-03T14:00:17.120

刚刚来到这里是因为至少有 IE 7 和 8 的相关观察：

如果表单上只有一个文本输入和一个提交按钮，并且用户按下返回键，IE 将不会在请求中包含提交按钮的名称/值对。Insead，只有文本输入的值会在那里。

如果我添加另一个文本输入，则会发布文本输入和提交按钮的参数。第二个文本输入甚至可以隐藏：`<input type="text" style="display:none"/>`

所以这与事件*无关*，而是与简单的表单提交有关。

它发生在 GET 和 POST 上。向表单添加选择元素不会改变行为。 - 很奇怪。

# sql-server - 在 SQL Server 中有效地添加列

> ID：756470
> 
> 赞同：1
> 
> 时间：2009-04-16T14:47:31.127
> 
> 标签：sql-server, database, performance, indexing, nullable

我想将一个整数列添加到具有大量行和许多索引的表中（它是一个数据仓库事实表）。

为了使行宽尽可能窄，此表中的所有列都定义为非空。所以我希望新列不为空，默认为零。

根据经验，添加此列将需要一些时间，可能是因为数据库需要使用填充值的新列重写所有行。这大概会涉及更新聚集索引和所有非聚集索引。

所以我应该在添加列之前删除所有索引，然后重新创建它们。或者有没有更简单的方法来做到这一点？

另外我真的不明白为什么添加一个可以为空的列要快得多。为什么这不涉及重写记录并为每一行翻转一个额外的 Is Null 位。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T15:23:26.630

这将需要更新聚集索引，是的 -毕竟这是表数据**。**

但我不明白为什么必须更新任何非聚集索引 - 您的新列不会成为任何非聚集索引的成员。

此外，我看不出在这种情况下删除和重新创建索引会对您有什么好处。如果您从另一个表或数据库批量加载数百万现有行 - 是的，那么它可能会更快（由于 INSERT 更快） - 但添加列并不会真正受到任何索引或约束的影响，我不认为。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:38:08.893

“而且我真的不明白为什么添加一个可以为空的列要快得多。为什么这不涉及重写记录并为每一行翻转一个额外的 Is Null 位。”

添加可为空的列只会更改表的定义。个人记录不受影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:17:49.810

SQL Server 是一个面向行的数据库。这与面向列的数据库形成对比。这意味着在 SQL Server 中，给定行的所有数据都存储在磁盘上。让我们举个例子：

假设您有一个包含 3 列的 Customer 表，FirstName、MiddleInitial 和 LastName。然后，假设此表中有 Jabba T. Hutt、Dennis T. Menace 和 George W. Bush 的 3 条记录。

在面向行的数据库（如 SQL Server）中，记录将按如下方式存储在磁盘上：

> 贾巴，T，赫特；丹尼斯，T，威胁；乔治，W，布什；

相反，面向列的数据库会将记录存储在磁盘上，如下所示：

> 贾巴、丹尼斯、乔治；T、T、W；赫特威胁，布什；

列组合在一起而不是行。

现在，当您在面向行的数据库（例如 SQL Server）中向表中添加一列时，必须将每列的新数据插入到现有行旁边，从而转移需要大量读/写的行操作。因此，如果您要为默认为“先生”的客户前缀插入一个新列，您会得到：

> 贾巴先生，T，赫特先生；丹尼斯先生，T，威胁；乔治、W、布什先生；

如您所见，所有原始数据都已向右移动。另一方面，当您插入一个默认为 NULL 的新列时，不必将新数据放入现有行中。因此，移位更少，需要更少的磁盘读/写操作。

当然，这是对磁盘上实际情况的过度简化。在处理索引、页面等时，还有其他一些事情需要考虑。但是，它应该可以帮助您了解情况。

**为了澄清起见**，我根本不建议您迁移到面向列的数据库，我只是将这些信息放在那里以帮助解释面向行的含义。

# php - 单元测试 Zend 控制器 - 我如何测试视图中设置的内容

> ID：756486
> 
> 赞同：2
> 
> 时间：2009-04-16T14:50:17.687
> 
> 标签：php, unit-testing, zend-framework, simpletest

在 Zend 中，模型被添加到视图中：

```
//In a controller
public function indexAction() {
  //Do some work and get a model
  $this->view->model = $model;    
} 
```

我们可以轻松地检查视图中是否存在“模型”（我为此使用了 simpletest）：

```
//In a unit test
  public function testModelIsSetInView() {
    //Call the controllers index action
    $this->assertTrue(isset($this->controller->view->model));
  } 
```

但是，测试“值”也不起作用：

```
//In a unit test
  public function testModelValue() {
    //Call the controllers index action

    //Both of these return null, though I'd like to access them!
    $this->assertNull($this->controller->view->model);
    $this->assertNull($this->controller->view->__get('model'));
  } 
```

如何获得（或至少测试）控制器已设置有效模型？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T14:56:42.430

[http://www.contentwithstyle.co.uk/content/unit-testing-controllers-with-zend-framework](http://www.contentwithstyle.co.uk/content/unit-testing-controllers-with-zend-framework)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:31:06.347

因此，解决方案（至少是目前计划的）是制作一个实现 Zend_View_Interface 的可测试视图。这将包括一个“get”方法，该方法返回传递给“__set”的对象。然后我们将连接控制器以在测试引导过程中使用此视图。

由于这可能不是最佳方法，我仍然很想听听其他有潜在解决方案的人的意见。

# c - HMAC-SHA1 的 Objective-C 示例代码

> ID：756492
> 
> 赞同：63
> 
> 时间：2009-04-16T14:50:48.047
> 
> 标签：c, objective-c, sha1, hmac

我需要在 Objective C 中生成 HMAC-SHA1。但我没有找到任何可行的方法。我尝试了 CommonCrypto，使用 CCHMAC，但没有用。我需要生成一个 hmac 并在生成 HOTP 编号之后。

有人在Objective C或C中有任何示例代码吗？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-04-16T14:59:46.837

以下是使用 SHA-256 生成 HMAC 的方法：

```
NSString *key;
NSString *data;

const char *cKey  = [key cStringUsingEncoding:NSASCIIStringEncoding];
const char *cData = [data cStringUsingEncoding:NSASCIIStringEncoding];

unsigned char cHMAC[CC_SHA256_DIGEST_LENGTH];

CCHmac(kCCHmacAlgSHA256, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

NSData *HMAC = [[NSData alloc] initWithBytes:cHMAC
                                      length:sizeof(cHMAC)];

NSString *hash = [HMAC base64Encoding]; 
```

我不知道 HOTP 库，但如果我没记错的话，该算法非常简单。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2012-08-28T11:04:01.020

这是生成**HMAC-SHA1 base64 的**方法。

您需要将 Base64.h 和 Base64.m 添加到您的项目中。你可以从[这里](http://www.koders.com/objectivec/fid5B401E9524F8DD92E9D88BE860B1683BB02CE1C1.aspx?s=md5)得到它。

如果你使用 ARC，它会在 Base64.m 中显示一些错误。找到类似这样的行

```
return [[[self alloc] initWithBase64String:base64String] autorelease]; 
```

你需要的是删除自动释放部分。最终结果应如下所示：

```
return [[self alloc] initWithBase64String:base64String]; 
```

现在在您的一般项目中导入“Base64.h”和以下代码

```
#import "Base64.h"
#include <CommonCrypto/CommonDigest.h>
#include <CommonCrypto/CommonHMAC.h>

- (NSString *)hmacsha1:(NSString *)data secret:(NSString *)key {

    const char *cKey  = [key cStringUsingEncoding:NSASCIIStringEncoding];
    const char *cData = [data cStringUsingEncoding:NSASCIIStringEncoding];

    unsigned char cHMAC[CC_SHA1_DIGEST_LENGTH];

    CCHmac(kCCHmacAlgSHA1, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

    NSData *HMAC = [[NSData alloc] initWithBytes:cHMAC length:sizeof(cHMAC)];

    NSString *hash = [HMAC base64String];

    return hash;
} 
```

和

```
NSLog(@"Hash: %@", hash); 
```

你会得到类似的东西：

```
ghVEjPvxwLN1lBi0Jh46VpIchOc= 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2013-05-09T09:41:56.280

这是完整的解决方案，无需任何额外的库或 hack：

```
+(NSString *)hmac:(NSString *)plainText withKey:(NSString *)key
{
    const char *cKey  = [key cStringUsingEncoding:NSASCIIStringEncoding];
    const char *cData = [plainText cStringUsingEncoding:NSASCIIStringEncoding];

    unsigned char cHMAC[CC_SHA256_DIGEST_LENGTH];

    CCHmac(kCCHmacAlgSHA256, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

    NSData *HMACData = [[NSData alloc] initWithBytes:cHMAC length:sizeof(cHMAC)];

    const unsigned char *buffer = (const unsigned char *)[HMACData bytes];
    NSString *HMAC = [NSMutableString stringWithCapacity:HMACData.length * 2];

    for (int i = 0; i < HMACData.length; ++i)
        HMAC = [HMAC stringByAppendingFormat:@"%02lx", (unsigned long)buffer[i]];

    return HMAC;
} 
```

您不必包含任何第三方 base64 库，因为它已经编码。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-11-27T19:12:52.017

这在不使用自定义协议的情况下工作，使用来自 [http://cocoawithlove.com/2009/07/hashvalue-object-for-holding-md5-and.html的一些代码](http://cocoawithlove.com/2009/07/hashvalue-object-for-holding-md5-and.html)

哈希SHA256.h

```
#import <Foundation/Foundation.h>
#import <CommonCrypto/CommonDigest.h>

@interface HashSHA256 : NSObject {

}

 - (NSString *) hashedValue :(NSString *) key andData: (NSString *) data ; 

@end 
```

哈希SHA256.m

```
#import "HashSHA256.h"

#import <CommonCrypto/CommonHMAC.h>

@implementation HashSHA256

- (NSString *) hashedValue :(NSString *) key andData: (NSString *) data {

    const char *cKey  = [key cStringUsingEncoding:NSUTF8StringEncoding];
    const char *cData = [data cStringUsingEncoding:NSUTF8StringEncoding];
    unsigned char cHMAC[CC_SHA256_DIGEST_LENGTH];
    CCHmac(kCCHmacAlgSHA256, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

    NSString *hash;

    NSMutableString* output = [NSMutableString   stringWithCapacity:CC_SHA256_DIGEST_LENGTH * 2];

    for(int i = 0; i < CC_SHA256_DIGEST_LENGTH; i++)
        [output appendFormat:@"%02x", cHMAC[i]];
    hash = output;
    return hash;

}

@end 
```

用法：

```
- (NSString *) encodePassword: (NSString *) myPassword {
    HashSHA256 * hashSHA256 = [[HashSHA256 alloc] init];   
    NSString * result = [hashSHA256 hashedValue:mySecretSalt andData:myPassword];       
    return result;       
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-10-10T17:40:14.580

这是在没有外部文件返回十六进制字符串的情况下执行此操作的方法：

```
-(NSString *)hmac:(NSString *)plaintext withKey:(NSString *)key
{
    const char *cKey  = [key cStringUsingEncoding:NSASCIIStringEncoding];
    const char *cData = [plaintext cStringUsingEncoding:NSASCIIStringEncoding];
    unsigned char cHMAC[CC_SHA1_DIGEST_LENGTH];
    CCHmac(kCCHmacAlgSHA1, cKey, strlen(cKey), cData, strlen(cData), cHMAC);
    NSData *HMACData = [NSData dataWithBytes:cHMAC length:sizeof(cHMAC)];
    const unsigned char *buffer = (const unsigned char *)[HMACData bytes];
    NSMutableString *HMAC = [NSMutableString stringWithCapacity:HMACData.length * 2];
    for (int i = 0; i < HMACData.length; ++i){
        [HMAC appendFormat:@"%02x", buffer[i]];
     }
   return HMAC;
} 
```

它在 xCode 5 和 iOS 7 中进行了测试并且工作正常！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-12T09:40:33.520

我花了一整天，试图将生成的哈希（字节）转换为可读数据。我使用了上面答案中的base64编码解决方案，它对我来说根本不起作用（顺便说一句，你需要一个外部.h才能使用我拥有的base64编码）。

所以我所做的是这个（没有外部.h也可以完美运行）：

```
CCHmac(kCCHmacAlgSHA256, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

// Now convert to NSData structure to make it usable again
NSData *out = [NSData dataWithBytes:cHMAC length:CC_SHA256_DIGEST_LENGTH];

// description converts to hex but puts <> around it and spaces every 4 bytes
NSString *hash = [out description];
hash = [hash stringByReplacingOccurrencesOfString:@" " withString:@""];
hash = [hash stringByReplacingOccurrencesOfString:@"<" withString:@""];
hash = [hash stringByReplacingOccurrencesOfString:@">" withString:@""];
// hash is now a string with just the 40char hash value in it
NSLog(@"%@",hash); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-11-08T04:39:30.680

出于兴趣，为什么要创建（unsigned char cHMAC）然后转换为（NSData），然后将其转换为（NSMutableString），然后最终转换为（HexString）？

您可以通过切割中间人（即完全没有 NSData 和 NSMutableString，更快更好的性能）来更快地做到这一点，也可以将 (unsigned char) 更改为 (uint8_t [])，毕竟它们都是十六进制数组！，以下：

```
-(NSString *)hmac:(NSString *)plaintext withKey:(NSString *)key
{
const char *cKey  = [key cStringUsingEncoding:NSASCIIStringEncoding];
const char *cData = [plaintext cStringUsingEncoding:NSASCIIStringEncoding];

uint8_t cHMAC[CC_SHA1_DIGEST_LENGTH];

CCHmac(kCCHmacAlgSHA1, cKey, strlen(cKey), cData, strlen(cData), cHMAC);

NSString *Hash1 = @"";
for (int i=0; i< CC_SHA1_DIGEST_LENGTH; i++)
{
    Hash1 = [Hash1 stringByAppendingString:[NSString stringWithFormat:@"%02X", cHMAC[i]]];
}
return Hash1;
} 
```

我希望这有帮助，

问候

海德·萨蒂

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T15:23:20.093

你看过 Jens Alfke 的新[MyCrypto](http://mooseyard.com/projects/MYCrypto/)课程吗？

[他的博客上](http://mooseyard.com/Jens/2009/04/mycrypto-library-now-alpha-testing/)有一些示例代码。

# c# - LINQ - 分组和聚合

> ID：756503
> 
> 赞同：2
> 
> 时间：2009-04-16T14:52:05.390
> 
> 标签：c#, linq

如果我有这 3 个课程：

```
class Student { int id; string name; }
class Course { int id; string name; }
class Enrolment { int studentId; int courseId; DateTime enrolmentDate; } 
```

然后使用这个：

```
IEnumerable<Course> FindCoursesForStudent(Student student)
{
    return from enrolment in Enrolments 
           where enrolment.studentId == student.id
           join course in Courses
              on enrolment.courseId equals course.id
           select course;
} 
```

我可以列出学生注册的所有课程。

但是，如果学生多次注册一门课程，我将如何只显示每门课程的最新注册？

我假设我需要按课程分组并过滤 enrolmentDate = Max(enrolmentDate) 或类似的东西？

[（如果这看起来很熟悉，那是因为它是我之前的 LINQ 问题](https://stackoverflow.com/questions/752051/beginner-linq-question)的后续内容。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T15:08:31.653

```
Enumerable<Course> FindCoursesForStudent(Student student)
{
    return from enrolment in Enrolments 
           where enrolment.studentId == student.id
           && enrolment.enrolmentDate == (from ed in Enrolments 
           where ed.enrolmentDate == enrolment.enrolmentDate 
           select ed.enrolmentDate).Max()
           join course in Courses
              on enrolment.courseId equals course.id
           select course;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:12:07.980

要获得学生参加的每门课程的最新注册，我会使用以下内容：

```
 IEnumerable<Enrolment> FindCoursesForStudent(Student student) {
        return from enrolment in Enrolments
               where enrolment.studentId == student.id
               group enrolment by enrolment.courseId into gp
               select gp.OrderBy(e => e.enrolmentDate).First();
    } 
```

这是你要求的吗？

# windows - 当人们在 Windows 上更改时钟时是否有 API 事件？

> ID：756506
> 
> 赞同：3
> 
> 时间：2009-04-16T14:52:18.930
> 
> 标签：windows, winapi

我想知道每次用户更改 Windows 中的时间时是否会触发某种系统事件。我知道有一种方法可以在 Windows 的 EventLog 中启用此功能，但我一直在寻找一种以编程方式响应此事件的方法（例如使用 Windows API）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T14:55:50.093

每当系统时间发生变化时，都会发送WM_TIMECHANGE[消息](http://msdn.microsoft.com/en-us/library/ms725498.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T14:56:20.387

我不确定您是在使用托管代码还是本机代码。但是，如果您正在使用托管代码，则可以在 SystemEvents 类上使用 TimeChanged 事件。

[Microsoft.Win32.SystemEvents.TimeChanged](http://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.timechanged.aspx)

# java - Hibernate：删除集合中元素的最佳方法

> ID：756513
> 
> 赞同：20
> 
> 时间：2009-04-16T14:54:02.360
> 
> 标签：java, hibernate

我在使用 Hibernate 时经常遇到的一个问题是拥有一个我想要针对实体 (myEntity) 持久存在的对象列表（称为 listA），但必须首先将它们与实体上的现有列表进行比较并删除那些不是在列表 A 中。

执行此操作的简单方法是清除实体上的列表并将所有 listA 添加到实体中，但是我经常必须在删除元素之前对元素执行一些验证 - 例如。检查是否允许此用户删除它们。

我目前的方法感觉很尴尬：

```
//Delete the elements that have been removed
//Use toArray to avoid ConcurrentModificationException
for(ObjectA a : myEntity.getObjectAList().toArray(new ObjectA[myEntity.getObjectAList().size()])) {
    if(!listA.contains(a)) {

        //Check if this element can be deleted
        if(canDelete(a)) {
            entityManager.remove(a);
            myEntity.getObjectAList().remove(a);
        }
    }
}

//Add the elements that don't already exist
for(ObjectA a : listA) {
    if(!myEntity.getObjectAList().contains(a)) {
        myEntity.getObjectAList().add(a);
    }
} 
```

有改进的余地吗？

谢谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2011-05-13T01:41:03.850

我知道这个问题已经很老了，但是我遇到了同样的问题，我认为给出的答案还不够。因此，您只需将属性添加`"orphanRemoval=true"`到映射注释即可获得您想要的确切结果。孤儿删除以这种方式工作（如“使用 GlassFish 3 开始 Java EE 6 平台”一书的第 136 页中所述：

“[...] 当客户被删除或关系被破坏时，代码将自动删除地址实体（通过将地址属性设置为空或通过以一对多的方式**从集合中删除子实体**案子）”。

也就是说，如果您从使用孤立删除映射的集合中删除一个项目，然后合并该实体，则该项目也将被删除。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-16T14:58:21.990

尝试使用：

```
myEntity.getObjectAList().removeAll(listA); 
```

这只会保留尚未在 listA 中的对象。

此外，如果您将来需要手动执行此类操作，请使用迭代器：

```
Iterator<?> it = myEntitiy.getObjectAList().iterator();
while (it.hasNext())
{
    ...
} 
```

然后 it.next() 将为您提供数组中的下一项，并且 it.remove() 将为您删除 next() 的最后一个值，如果您继续循环，则不会给出异常。

如果您还需要在循环时添加新值，请考虑使用 listIterator() 代替。

# reporting-services - 通过一个存储过程在报表服务器中使用更多数据集

> ID：756519
> 
> 赞同：1
> 
> 时间：2009-04-16T14:56:26.457
> 
> 标签：reporting-services, ssrs-2008

我最近部署了很多报告。所以我保持代码和版本清晰易懂，我希望每个报告都有一个存储过程。大多数时候，我需要为一份报告提供更多数据集。我是否有可能在报告 SSRS 中拥有一个以上的数据集，以便只为该报告调用一个存储过程。（我正在使用托管在 Sql Report Server 2008 上的远程报告）。

我使用熟悉的 Issue whit 示例控制台应用程序，使用一个存储过程从 SQL 创建多个 CSV 文件。代码片段看起来像这样：

```
 SqlConnection conn = new SqlConnection(strConn); 
        SqlCommand command = new SqlCommand("sp_ado_pos_data", conn);
        command.CommandType = CommandType.StoredProcedure;
        command.Parameters.Add("@skl_id", SqlDbType.Int).Value = 158;
        SqlDataAdapter adapter = new SqlDataAdapter(command);
        DataSet ds = new DataSet();
        adapter.Fill(ds);
        for (int i = 0; i < ds.Tables.Count; i++)
        {
            string datoteka  = (string.Format(@"{0}tablea{1}.csv", direktorij, i));
            DataTable tabela = ds.Tables[i];  
            //Here I fill datasets with multiple results from one stored proc.
            CreateCSVFile(tabela,datoteka );
            Console.WriteLine("Generišem tabelu {0}", datoteka);
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T12:03:31.330

对于通过默认报表查看器呈现的标准报表，这似乎是不可能的——SSRS 会忽略来自多结果集源的除第一个结果集之外的所有结果集。

但是，根据[这篇文章](http://www.c-sharpcorner.com/UploadFile/robo60/StandaloneRDLCReports11142007183516PM/StandaloneRDLCReports.aspx)，似乎可以在独立报告（.rdlc 扩展名）中使用。我不确定这是否意味着，使用自定义报告查看器，标准 .rdl 报告可以以类似的方式进行配置。

# java - 用于忽略 JUnit 测试的 FindBugs 过滤器文件

> ID：756523
> 
> 赞同：16
> 
> 时间：2009-04-16T14:56:53.337
> 
> 标签：java, ant, junit, findbugs

我需要为我的 findbugs ant 脚本设置一个过滤器文件，它只扫描 src/* 文件而不是 test/* 文件。

检查所有类同时忽略名称中带有“test”的任何文件名或包名的语法是什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-16T16:00:29.413

FindBugs 实际上是扫描已编译的类文件，而不是`sourcePath`. 如果要将 src/* 和 test/* 文件编译到不同的目录，则可以只使用嵌套`<class...>`元素。

```
<findbugs home="${findbugs.dir}" output="xml:withMessages" 
    outputFile="${findbugs.report.xml}" jvmargs="-Xmx256M" 
    effort="max" projectName="${ant.project.name}" 
    auxClasspathRef="findbugs.classpath" 
    sourcePath="${src.dir}">
  <class location="${src.classes.dir}"/>
</findbugs> 
```

如果 src/* 和 test/* 都编译到一个目录中，那将不起作用。在这种情况下，请使用[过滤器文件](http://findbugs.sourceforge.net/manual/filter.html)并排除与测试对应的包或类名。

```
<findbugs home="${findbugs.dir}" output="xml:withMessages" 
    outputFile="${findbugs.report.xml}" jvmargs="-Xmx256M" 
    effort="max" projectName="${ant.project.name}" 
    auxClasspathRef="findbugs.classpath" 
    sourcePath="${src.dir}"
    excludefilter="exclude.xml">
  <class location="${classes.dir}"/>
</findbugs> 
```

`exclude.xml`看起来像：

```
<FindBugsFilter>
  <Match>
    <Class name="~.*Test$"/>
  </Match>
  <Match>
    <Package name="~test\..*"/>
  </Match>
</FindBugsFilter> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-06-12T03:29:17.590

顺便说一句，用 FindBugs 覆盖单元测试也是一个**好主意。**没有理由对测试使用较低的质量标准。测试中的错误就是这样，错误。

当然，如果您第一次运行 FindBugs，可能会有很多错误报告，但是如果您注意它们，错误计数会随着时间的推移而下降。

# python - Elixir 事件处理程序

> ID：756529
> 
> 赞同：0
> 
> 时间：2009-04-16T14:57:49.573
> 
> 标签：python, pylons, python-elixir

我想使用 Elixir 的 @after_insert 装饰器，但我无法访问模型中的 Session。由于我将自动提交设置为 False，因此我无法在事件处理程序中提交任何更改。有没有最佳实践来处理这个问题？

我用来构建模型、数据库连接等的代码大多是从文档中删除的。

所需的方法：

```
class Artefact(Entity):
[...]
    @after_insert
    def make_signature(self):
        self.signature = '%s-%s' % (self.artefact_type.title.upper()[:3], self.id) 
```

所有 Session 初始化都在同一目录中的**init .py 中完成。**

当我然后打电话时：

```
Session.update(self)
Session.commit() 
```

我收到 Session 未定义的错误。任何的想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T10:28:56.457

你导入了Session吗？

`from packagename import Session`

在模型文件的顶部应该可以解决问题。Packagename 是目录名称。

# dns - 基于 DNS 的策略，用于在服务器关闭时显示漂亮的“当前离线”页面

> ID：756532
> 
> 赞同：10
> 
> 时间：2009-04-16T14:58:36.420
> 
> 标签：dns, user-experience

当服务器关闭时，如何使站点自动显示一个漂亮的“当前离线”页面（我的意思是，整个服务器都关闭并且请求无法到达 IIS）

手动更改 DNS 不是一种选择。

**编辑：**我正在寻找某种 DNS 技巧来重定向到其他服务器，以防主服务器出现故障。我可以对 DNS 进行永久性更改，但不能在服务器出现故障时手动更改。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T15:14:17.817

我使用[DNSMadeEasy](http://www.dnsmadeeasy.com/index.html)的正常运行时间服务取得了巨大成功。实际上，他们将 DNS TTL 设置为非常低的数字（5 分钟）。他们负责 ping 您的服务器。

如果发生中断，DNS 查询会被定向到辅助 IP。在 DNS 要求有限的小商店中“热备件”的绝佳选择。我已经使用它们 3 年了，没有一分钟的停机时间。

**编辑：**

这允许地理上冗余的故障转移，而提议的 NLB 解决方案没有解决这个问题。如果网络连接断开，标准 NLB 配置中的两台服务器都将无法访问。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T15:03:25.910

某些服务器需要发出“当前离线页面”，因此如果您的服务器完全关闭，则必须有其他服务器为文件提供服务，因此您可以设置一个服务器集群（即使只是2）当第一个关闭时，第二个配置为仅返回“当前离线页面”。备份第一台服务器后，您可以安全地关闭第二台服务器（因为服务器 1 将承担所有负载）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T09:42:06.857

您可能需要第二台具有 100% 正常运行时间的服务器，然后添加某种故障转移负载平衡器。到它，如果主服务器在线重定向到它，如果它没有重定向到它本身，则显示一个页面说服务器已关闭

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T15:03:09.903

我相信如果服务器宕机了，你也无能为力。该请求将发送~~404~~网络错误，因为当 Web 地址解析为 IP 时，所请求的 IP 不存在（因为服务器已关闭）。如果您无法更改 DNS 条目，那么客户端浏览器将继续点击 xxx.xxx.xxx.xxx 并且永远不会得到响应。

如果服务器已启动，但网站已关闭，您可以选择。

**编辑**

您的编辑提到您可以永久更改 IP。但是您仍然需要两个服务器设置才能实现您所说的。您可以将 DNS 定向到能够将请求定向到当前处于活动状态的服务器的负载均衡器。但是，这仍然需要 DNS 指向的服务器 100% 的正常运行时间。

无论如何，如果 DNS 指向的服务器（您必须控制它以重定向流量）已关闭，那么所有请求都将收到~~404~~网络错误。

**编辑**感谢布赖恩指出我的 404 错误错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T16:00:11.893

说真的，DNS**不是**服务器负载平衡或故障转移的正确答案。太多系统（包括存根客户端和 ISP 递归解析）将缓存记录的时间长于指定的 TTL。

如果两台服务器在同一个网络上，则使用路由协议通过让两台服务器向网络提供相同的 IP 地址来实现故障转移，但故障转移服务器仅在检测到（假定的）活动服务器时才会接管离线。

如果服务器是 Unix，这很容易通过在每台服务器上运行 Quagga，然后使用 OSPF 作为本地路由协议来完成。我个人将它用于冗余系统实际上位于另一个数据中心的热备用服务器，尽管它通过直接链接连接到主数据中心。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-03-28T15:29:06.410

Certain DNS providers, such as AWS's Route 53, have a health-check option, which can be used to re-route to a static page. AWS has a [how-to guide on setting this up](https://aws.amazon.com/blogs/aws/create-a-backup-website-using-route-53-dns-failover-and-s3-website-hosting/).

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T15:03:18.873

我在想如果站点是负载平衡的，负载平衡器本身会检测到它试图将客户端重定向到的 Web 服务器已关闭，因此它会将用户发送到备份服务器，并带有指示技术问题的消息。

除此之外.....

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T15:14:57.660

我唯一能想到的就是控制调用页面。显然，这在所有情况下都不起作用......但是如果您知道对该服务器的大部分点击将来自特定来源，那么您可以将 java 脚本测试添加到源，并重定向到“服务器关闭" 在不同服务器上生成的页面。

但是，如果您试图处理来自所有来源的所有命中（其中一些是您无法控制的），那么我认为您不走运。正如其他人所说 - 当服务器关闭时，浏览器在尝试连接时会收到 404 错误。

...也许在两者之间有一种方法可以检测服务器返回的 404 错误并将其替换为“服务器已关闭”网页。您需要在服务器和 Web 客户端之间安装 HTML 防火墙或其他一些中间网络设备。

# iphone - 横向模式下的 tabBarController 和 navigationControllers，第二集

> ID：756536
> 
> 赞同：6
> 
> 时间：2009-04-16T14:59:30.613
> 
> 标签：iphone, uiviewcontroller, uitabbarcontroller, landscape

我有一个 UITabBarController，每个选项卡处理一个不同的 UIViewController，它根据需要推送堆栈新控制器。在其中两个选项卡中，当到达特定控制器时，我需要旋转 iPhone 并在横向模式下可视化视图的能力。经过一番挣扎后，我发现必须将 UITabBarController 子类化以覆盖 shouldAutorotateToInterfaceOrientation。但是，如果我在实现中简单地返回 YES，则会出现以下不良副作用：

旋转 iPhone 时，每个选项卡中的每个控制器都会自动进入横向模式。

即使在每个控制器中覆盖 shouldAutorotateToInterfaceOrientation 以返回 NO 也不起作用：当 iPhone 旋转时，控制器处于横向模式。

我在子类 UITabBarController 中实现了 shouldAutorotateToInterfaceOrientation 如下：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation
{
    if([self selectedIndex] == 0 || [self selectedIndex] == 3)
        return YES;

    return NO;
} 
```

这样只有我感兴趣的两个选项卡才能真正获得对横向模式的支持。有没有办法支持特定选项卡堆栈上特定控制器的横向模式？

我试过了，但没有成功，比如

（BOOL）应该自动旋转到接口方向：（UI接口方向）接口方向{

```
if([self selectedIndex] == 0 || [self selectedIndex] == 3)
{   
   if ([[self selectedViewController] isKindOfClass: [landscapeModeViewController class]])
           return YES;
    }

     return NO; 
```

}

另外，我尝试使用委托方法 didSelectViewController，但没有成功。任何帮助是极大的赞赏。谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-31T10:43:29.763

这是 UITabBarController 的扩展，它将调用委托给`shouldAutorotateToInterfaceOrientation`当前选定的子控制器。使用这个扩展，你不再需要继承 UITabBarController 并且你可以`shouldAutorotateToInterfaceOrientation`像人们期望的那样在你的控制器中使用。

UITabBarController+Autorotate.h:

```
#import <UIKit/UIKit.h>

@interface UITabBarController (Autorotate)
@end 
```

UITabBarController+Autorotate.m:

```
#import "UITabBarController+Autorotate.h"

@implementation UITabBarController (Autorotate)

- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
    UIViewController *controller = self.selectedViewController;
    if ([controller isKindOfClass:[UINavigationController class]])
        controller = [(UINavigationController *)controller visibleViewController];
    return [controller shouldAutorotateToInterfaceOrientation:interfaceOrientation];
}

@end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T13:34:26.287

这对我有用：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
    if(self.selectedIndex == 0 && [[[self.viewControllers objectAtIndex:0] visibleViewController] isKindOfClass:[MyViewController class]])
        return YES;
    else
        return NO;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-12T23:20:37.337

我已经可以使用它一段时间了（从我的应用程序的标签栏控制器）没有问题：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
     return [self.selectedViewController shouldAutorotateToInterfaceOrientation:interfaceOrientation];
} 
```

这样，在适当的 VC 中，我们可以进行*真正的*检查，在本例中是针对照片库视图（还有什么？）：

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
    // Return YES for supported orientations
    return (interfaceOrientation != UIInterfaceOrientationPortraitUpsideDown);
} 
```

对于给定的导航控制器，我的画廊视图甚至不在堆栈顶部。它仍然被调用。

唉，我刚刚发现，当 VC 潜伏在**MoreViewController**中（而不是四个主要选项卡）时，这*并不能很好地工作。*在这种情况下，我的画廊 VC 永远不会被调用。我认为这是因为我一直在调用的 VC 实际上是所选选项卡中的导航控制器，*然后*它将内容传播到适当的 VC，在本例中是我的照片库 VC。但是对于 More VC 来说，事情并没有那么顺利...... aaaand 事情从那里轮流走下坡路。:\

 ***我尝试使用 Andreas 的修改（请参阅此线程的其他地方），但无济于事。欢迎提供线索！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-09T20:11:31.270

在使用 UITabBarController 时，我遇到了与您相同的问题。我需要控制哪些 UIViewController 可以旋转，哪些不可以。我的主要问题是更多选项卡。我不希望 MORE 选项卡中包含的任何 UIViewController 旋转。

我的解决方案是创建自己的 UITabBarController，我称之为 MyTabBarController：

```
@interface MyTabBarController : UITabBarController <UITabBarDelegate> {

} 
```

然后我实现了 shouldAutorotateToInterfaceOrientation 方法：

```
@implementation MyTabBarController

- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
 UIViewController *controller = [self selectedViewController];

 if ((controller == [self moreNavigationController]) || ([self selectedIndex] == 4))
 {
  return interfaceOrientation == UIInterfaceOrientationPortrait;
 }

 return [controller shouldAutorotateToInterfaceOrientation:interfaceOrientation];
}

@end 
```

我需要发现是否选择了更多选项卡。这是一个两步过程；当最初选择 MORE 选项卡时，API 返回一个大于 4 的 selectedIndex，因此我需要将所选控制器与 moreNavigationController 进行比较。

如果从 MORE 选项卡中选择了 UIViewController，则 selectedIndex 最终为 4，但 selectedController 不再是 moreNavigationController，而是选择了 UIViewController。

if ( **(controller == [self moreNavigationController]) || ([self selectedIndex] == 4))**解决了这个问题。

现在，当我运行我的应用程序时，我的 MORE 选项卡中的 UIViewControllers 不会旋转。我希望这将帮助其他遇到与我相同的问题的开发人员。

埃米利奥

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-04T09:40:48.937

从我在这里和其他地方看到的情况来看，我已经拼凑了一个使用该方法的解决方案，`shouldAutorotate`因为旧的`shouldAutorotateToInterfaceOrientation`已被弃用。

我已将它放在 UITabBarController 的类别中。**我非常希望这是可以接受的！**

```
// call to method shouldAutorotate replaces call to method shouldAutorotateToInterfaceOrientation (deprecated)
-(BOOL)shouldAutorotate
{ // check whether selected view controller should autorotate    
  UIViewController *controller = self.selectedViewController;
  if ([controller isKindOfClass:[UINavigationController class]])
    { // in case it is a navigation controller: get visible view of that
      controller = [(UINavigationController *)controller visibleViewController];
    }
  return [controller shouldAutorotate];
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-04T23:37:07.033

谢谢你，谢谢你，谢谢你。弄清楚如何做到这一点已经有 2 天了。当你有一个带有导航控制器的 tabBarController 时，这是我对你所有的巨大帮助的看法。

-(BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {

```
UIViewController *controller = self.selectedViewController;
if ([controller isKindOfClass:[UINavigationController class]])
    controller = [(UINavigationController *)controller visibleViewController];

if([controller isKindOfClass:[LOCviewcontroller class]])
    return YES;
else
    if([controller isKindOfClass:[personWebSiteView class]])
        return YES;
else return NO; 
```

}

任何对新手编码器代码的批评总是受到赞赏......杰克

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-18T07:35:56.633

继承 UITabBarController 真的可以吗（如上面接受的答案中所建议的那样）？

我知道 Apples 说过类似“你永远不应该继承 UITabBarController 或 UINavigationController”之类的话——还是我误解了？

反正; 我找到[了本教程](http://www.iphonedevcentral.com/create-uitabbarcontroller/)，他们将 UIViewController 子类化，并在其中放置了 UITabBarController。

# drupal - 如何在 Drupal 中显示节点列表和单个节点的详细信息

> ID：756540
> 
> 赞同：0
> 
> 时间：2009-04-16T15:00:11.003
> 
> 标签：drupal, drupal-6

我想要一个显示节点列表的页面（我可以使用 Views 模块完成此部分），然后还在列表下方显示单个节点的详细信息。理想情况下，当单击列表中的节点时，详细信息将通过 Ajax 更新，但重新加载页面就可以开始了。

我刚开始接触 Drupal，我可以做的事情的级别数量有点压倒性。例如，这应该是底部带有自定义块的视图页面吗？一个有两个块的页面（一个用于列表，一个用于项目）？如果是这样，他们将如何传达节点 ID？是否已经有一个模块可以为我做到这一点？也许我应该编写自己的模块？等等。如果对 Drupal 有更好的一般理解的人可以指出我正确的方向，我将不胜感激。

**编辑：** 感谢到目前为止的答案，我认为他们指出我错过了原始问题中的一个重要细节。所以，一些更多的细节：

我希望这个页面有效地成为用户的主页。因此，我的视图仅限于显示他们创建的节点。编辑默认节点页面会给我在用户登录时将用户发送到哪个节点的问题（我猜这可能是可能的），并且还意味着我可能无法查看该节点而不查看该视图？

我一直在尝试另一种方法，即使用一些 PHP 创建包含视图（称为 user_home）的页面节点。我还设置了视图控件为列表中的每个节点创建一个链接，并在该链接中包含节点 ID，例如[http://localhost/drupal-6.10/?q=node/13/12](http://localhost/drupal-6.10/?q=node/13/12)（其中 13 是节点我创建的页面的 ID 和 12 是列表中项目的节点 ID）。

```
<?php
//output the user_home view
print views_embed_view('user_home', $display_id = 'default');
?>
<br/>
<hr/>
<br/>
<?php
$queryparam = $_GET["q"];
// find the second /
$index = strpos($queryparam, '/');
$index = strpos($queryparam, '/', $index + 1);
$displayNodeId = substr($queryparam, $index + 1);
$displayNodeId = (int)$displayNodeId;

if ($displayNodeId > 0)
{
  $displayNode = node_load($displayNodeId);
  print node_view($displayNode);
}
?> 
```

现在，这可行，但我确信他们是一种更友好/兼容的做事方式（并且查询字符串解析是一个讨厌的黑客）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T08:07:57.793

对此的规范解决方案是在“内容顶部区域”中使用块，在内容区域中使用完整节点。

实现这一点的最基本方法是简单地正常显示节点页面，并使用具有内容顶部区域的主题（Garland 没有，Zen classic 有），创建一个包含您想要的列表的 Views 块并将其放置在其中地区。您可以使用路径作为 View 的参数，因此其内容可以取决于当前显示的节点。然后，定义块的可见性以仅匹配您想要的条件，可能仅显示在节点页面上，或者可能显示在特定内容类型的节点页面上。为此，对块使用 PHP 可见性模式，并执行类似的操作

```
// Filter args for safety
if ((arg(0) == 'node') && is_numeric(arg(1)) {
  $node = node_load(arg(1);
  return is_object($node) && ($node->type == 'the_content_type_i_want');
}
else {
  return FALSE;
} 
```

这样，该块将仅在您需要时显示。

如果您的主题没有此功能，面板为您提供了一种划分页面并将视图放置在一个面板中并将完整节点放置在另一个面板中的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-03T09:02:36.063

自定义寻呼机可能适合您。 [http://drupal.org/project/custom_pagers](http://drupal.org/project/custom_pagers)

您首先为寻呼机创建一个视图；这可以是某个用户的所有帖子或您想要的任何内容——它与任何其他视图一样灵活。

您不需要像标准寻呼机（和默认）那样提供前向链接 - 使用 custom_pagers 您可以获得一个包含视图中所有节点的 $nav_array 变量。

有了它，您应该能够创建一个表或链接列表。

[根据节点标题生成二级菜单](https://stackoverflow.com/questions/3985759/generating-secondary-menu-based-on-node-titles)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:25:07.547

我会这样做如下。为您的视图块设置**页面特定的可见性设置**，节点列表仅显示在该节点上，[Pathauto](http://drupal.org/project/pathauto)模块在这里也可以帮助管理一堆节点路径。

# c# - 通过构造函数在 IoC 中强制执行依赖关系？

> ID：756541
> 
> 赞同：9
> 
> 时间：2009-04-16T15:00:30.470
> 
> 标签：c#, interface, dependency-injection, inversion-of-control, abstract-class

我试图接受使用 IoC/依赖注入，同时对合同而不是特定类进行编程。我面临的困境是以下之间的紧张关系：

1.  **为 IoC 进行接口编程**：我从 IoC 开始，严重依赖接口。从 Spring 的示例项目来看，接口是使用 IoC 进行合约编程时要走的路。

2.  （**...虽然抽象类通常更**受欢迎：[接口的主要缺点是在允许 API 的演变方面，它们的灵活性远低于类](http://en.csharp-online.net/.NET_Type_Design_Guidelines%E2%80%94Choosing_Between_Class_and_Interface)）

3.  **一定要通过构造函数显式地显示类依赖关系** 我的直觉是，将依赖关系传递给类的构造函数是一种很好的编程习惯。实际上，这*是*依赖注入。

4.  **...除非您不能在接口/抽象类中强制执行构造函数签名**：接口或抽象类都不允许定义构造函数签名[（轻松/优雅）](https://stackoverflow.com/questions/619856/interface-defining-a-constructor-signature)。另请参阅[框架设计指南第 4.4 节：](http://msdn.microsoft.com/en-us/library/ms229047.aspx) **不要**在抽象类型中定义公共或受保护的内部构造函数。...仅当用户需要创建该类型的实例时，构造函数才应该是公共的。

这个问题与之前的stackoverflow问题有关：[定义构造函数签名的接口？](https://stackoverflow.com/questions/619856/interface-defining-a-constructor-signature)

但我的问题是：

由于您不能在 C# 接口/抽象类中定义构造函数，正如上面的问题所问的那样，在实际层面上：

**您如何将此与[通过构造函数传递依赖](http://msdn.microsoft.com/en-us/library/ms229060.aspx)**项的明智做法相协调？

编辑：谢谢你的答案。我希望对在这种情况下我*应该做什么有所了解。*只是不使用构造函数参数？使用某种具有依赖关系的 Init() 方法？Edit2：感谢您的出色回答，非常有帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T22:26:26.363

我一直认为用（编造的）例子更容易解释......

假设您有一个 ICustomerRepository 接口、一个 IShoppingCartRepository 接口和一个 ICheckout 接口。您有这些接口的具体实现 - CustomerRepository、ShoppingCartRepository 和 CheckoutService。

您的 CheckoutService 具体类有一个构造函数，它接受一个 ICustomerRepository 和一个 IShoppingCartRepository - 例如

```
public CheckoutService(ICustomerRepository customerRepository, IShoppingCartRepository shoppingCartRepository)
{
  // Set fields for use in some methods later...
  _customerRepository = customerRepository;
  _shoppingCartRepository = shoppingCartRepository;
} 
```

然后，当您想要一个 ICheckoutService 实现来做一些工作时，您告诉您的 IoC 容器它应该为每种接口类型使用哪个具体类，并要求它为您构建一个 ICheckoutService。您的 IoC 容器将为您构建类，将正确的具体类注入到 CheckoutService 的构造函数中。它还将在此处的类层次结构中一直构建依赖关系，因此，例如，如果您的 ShoppingCartRepository 在构造函数中采用 IDatabaseSession 接口，那么您的 IoC 容器也会注入该依赖关系，只要您告诉它要使用哪个具体类为您的 IDatabaseService。

以下是您在配置（例如）[StructureMap](http://structuremap.sourceforge.net/Default.htm)作为您的 IoC 容器时可能使用的一些代码（此代码通常在应用程序启动期间调用）：

```
public class AppRegistry : Registry
{
  public AppRegistry()
  {
    ForRequestedType<ICheckoutService>().TheDefaultIsConcreteType<CheckoutService>();
    ForRequestedType<ICustomerRepository>().TheDefaultIsConcreteType<CustomerRepository>();
    // etc...
  }
} 
```

然后，要建立一个 ICheckoutService 实例并准备好使用，并将所有依赖项传递给您的构造函数，您将使用如下内容：

```
var checkoutService = ObjectFactory.GetInstance<ICheckoutService>(); 
```

我希望这是有道理的！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:06:53.343

您的 IoC 容器必须从具体类型构造一个对象，即使您传递的是一个接口。您的构造函数不是行为或状态契约，因此它不属于接口或抽象类的公共成员。

构造函数是一个实现细节，因此您不需要将其定义与具体类分开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:07:58.097

您不能在接口中定义构造函数签名。无论如何，这没有任何意义，因为接口不应该强制执行实现的构造方式。

抽象类虽然确实可以有构造函数。它们必须受到保护，因为公共构造函数也没有意义。它们只能由具体的子类调用。

IoC 原则规定，与其让 A 类知道并实例化 B 类，不如将对 IB 的引用传递给 A 的构造函数。然后 A 不需要知道 B 类，因此您可以轻松替换 B 类与 IB 的其他一些实现。

由于您要传入 B 类的已实例化对象，因此 IB 接口不需要具有构造函数签名。

# visual-c++ - 字符串插入错误 C++

> ID：756542
> 
> 赞同：0
> 
> 时间：2009-04-16T15:00:45.043
> 
> 标签：visual-c++

```
WordChosenDuplicate.insert(0,WordChosen.length," _ ");
    cout <<WordChosenDuplicate<< endl; 
```

尝试运行此代码时出现以下错误

```
error C3867: 'std::basic_string<_Elem,_Traits,_Ax>::length': function call missing argument list; use '&std::basic_string<_Elem,_Traits,_Ax>::length' to create a pointer to member c:\documents and settings\main\my documents\uni\2nd year\tp2\hangman\hangman\hangman.cpp    119 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T15:03:16.050

这是一个功能：`std::string::length()`

请阅读网上提供的手册以及您之前问题的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:04:59.883

你需要使用WordChosen.length()。添加括号，这是一个方法调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:10:00.697

```
for (int f = 0; f <= WordChosen.length()-1;f++)
    {

         WordChosenDuplicate.insert(0,(WordChosen.length(),"_ "));

    }

    cout <<WordChosenDuplicate<< endl; 
```

谢谢大家得到答案。

# math - 在坐标上添加距离

> ID：756544
> 
> 赞同：3
> 
> 时间：2009-04-16T15:01:10.173
> 
> 标签：math

我有一个单位向量、一个距离和一个坐标，我想通过将距离添加到给定方向的坐标上来计算新坐标。我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T15:03:33.367

将向量乘以距离，然后将结果向量添加到该点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T15:05:32.987

这是一些伪代码，假设您使用的是笛卡尔坐标。

```
new_coord.x = distance * unit.x + coord.x
new_coord.y = distance * unit.y + coord.y 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T15:03:33.053

如果使用单位向量，则表示距离为 1 的向量。您可以找到坐标 bij 将所有坐标乘以距离。

```
V = V unit * distance

V unit = (1/2 sqrt(3), 1/2)
distance = 6

==>

V = (3 sqrt(3), 3) 
```

# c - C语言中关于函数指针的一个问题

> ID：756545
> 
> 赞同：6
> 
> 时间：2009-04-16T15:01:27.473
> 
> 标签：c, pointers, casting, function-pointers

有以下声明：

```
void qsort(void *lineptr[], int left, int right, int (*comp)(void *, void *));
int numcmp(char *, char *);
int strcmp(char *s, char *t); 
```

然后，在程序的某处有以下调用：

```
 qsort((void**) lineptr, 0, nlines-1, 
                    (int (*)(void*,void*))(numeric ? numcmp : strcmp)); 
```

（忽略前三个参数和`numeric`）。

请问这是什么：

```
(int (*)(void*,void*))(numeric ? numcmp : strcmp) 
```

我知道这`qsort`是期望一个“指向函数的指针，它获取两个`void`指针并返回一个`int`”，因为它是第四个参数，但是上面写的内容如何满足呢？在我看来，这像是某种演员表，因为它由两个括号组成，但那将是一个非常奇怪的演员表。因为它接受一个函数并使该函数成为“指向函数的指针，该函数获取两个`void`指针并返回一个`int`”。这是没有意义的。
（我在这里遵循了一个规则，即*`type`*变量前括号中的类型将变量提升为该类型）。

所以我想我弄错了，也许有人可以告诉我如何阅读这个，顺序是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T15:09:10.810

你在这里错过了诀窍 - 部分

```
(numeric ? numcmp : strcmp) 
```

正在使用三元运算符来选择在 qsort 中调用*哪个*函数。如果数据是数字，则使用 numcmp。如果没有，它使用 strcmp。一个更具可读性的实现如下所示：

```
int (*comparison_function)(void*,void*) = 
    (int (*)(void*,void*))(numeric ? numcmp : strcmp);
qsort((void**) lineptr, 0, nlines-1, comparison_function); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T15:09:21.497

这里发生的事情确实是一个演员表。让我们暂时忽略三进制并假设始终使用 numcmp。出于这个问题的目的，函数可以充当 C 中的函数指针。因此，如果您查看 numeric 的类型，它实际上是

```
(int (*)(int*,int*)) 
```

为了在 qsort 中正确使用它，它需要有 void 参数。因为这里的类型在参数和返回类型方面都具有相同的大小，所以可以用 on 代替另一个。所需要的只是使编译器满意的强制转换。

```
(int (*)(void*,void*))(numcmp ) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T16:54:54.303

正如其他人指出的那样，对于

```
(int (*)(void*,void*))(numeric ? numcmp : strcmp) 
```

那么以下是类型转换

```
(int (*)(void*,void*)) 
```

表达式是

```
(numeric ? numcmp : strcmp) 
```

* * *

C 声明可能很难阅读，但可以学习。方法是从内部开始，然后向右走一步，然后向左走一步，向外继续向右，向左，向右，向左等直到完成。在对括号内的所有内容进行评估之前，您不能越过括号外。例如对于上面的类型转换，`(*)`表示这是一个指针。指针是括号内唯一的东西，所以我们评估它外面的右侧。`(void*,void*)`表示它是一个指向具有两个指针参数的函数的指针。最后`int`表示函数的返回类型。外括号使其成为类型转换。更新：两篇更详细[的文章：顺时针/螺旋规则](http://c-faq.com/decl/spiral.anderson.html)和[阅读 C 声明：迷惑者指南](http://www.ericgiguere.com/articles/reading-c-declarations.html).

然而，好消息是，虽然上面的知识非常有用，**但有一个非常简单的作弊方法**：*cdecl*程序可以将 C 语言转换为英文描述，反之亦然：

```
cdecl> explain (int (*)(void*,void*))
cast unknown_name into pointer to function (pointer to void, pointer to void) returning int
cdecl> declare my_var as array 5 of pointer to int
int *my_var[5]
cdecl> 
```

* * *

练习：什么样的变量是`i`？

```
int *(*(*i)[])(int *) 
```

如果您的机器上没有安装 cdecl，请在[rot13](http://en.wikipedia.org/wiki/ROT13)中回答（但您确实应该！）：

```
pqrpy> rkcynva vag *(*(*v)[])(vag *)
qrpyner v nf cbvagre gb neenl bs cbvagre gb shapgvba (cbvagre gb vag) ergheavat cbvagre gb vag
pqrpy> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-16T15:17:13.947

您可以在没有函数指针转换的情况下执行此操作。[方法](http://c-faq.com/lib/qsort2.html)如下。以我的经验，在大多数地方，如果你使用演员表，你就做错了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-16T16:02:47.363

请注意，标准定义`qsort()`包括`const`：

```
void qsort(void *base, size_t nmemb, size_t size,
           int (*compar)(const void *, const void *)); 
```

请注意，字符串比较器有两个 ' `char **`' 值，而不是 ' `char *`' 值。

我编写了比较器，以便在调用代码中不需要强制转换：

```
#include <stdlib.h>    /* qsort() */
#include <string.h>    /* strcmp() */

int num_cmp(const void *v1, const void *v2)
{
    int i1 = *(const int *)v1;
    int i2 = *(const int *)v2;
    if (i1 < i2)
        return -1;
    else if (i1 > i2)
        return +1;
    else
        return 0;
}

int str_cmp(const void *v1, const void *v2)
{
    const char *s1 = *(const char **)v1;
    const char *s2 = *(const char **)v2;
    return(strcmp(s1, s2));
} 
```

强迫人们使用你的函数在代码中编写强制转换是丑陋的。不。

我写的两个函数符合标准要求的函数原型`qsort()`。不带括号的函数名等价于指向函数的指针。

您会发现在较旧的代码或由在较旧的编译器上长大的人编写的代码中，指向函数的指针使用以下符号：

```
result = (*pointer_to_function)(arg1, arg2, ...); 
```

在现代风格中，它是这样写的：

```
result = pointer_to_function(arg1, arg2, ...); 
```

就个人而言，我发现显式取消引用更清晰，但并非所有人都同意。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-16T16:56:49.137

**编写该代码片段的人试图过于聪明**。在他的脑海中，他可能认为通过制作一个聪明的“单线”，他正在成为一名优秀的程序员。**实际上，他正在编写的代码可读性较差，并且长期使用起来令人讨厌**，应该以更明显的形式重写，类似于 Harper Shelby 的代码。

记住 Brian Kernighan 的格言：

> 首先，调试的难度是编写代码的两倍。因此，如果您尽可能巧妙地编写代码，那么根据定义，您还不够聪明，无法对其进行调试。

* * *

我在硬实时截止日期的情况下进行了大量性能关键编码......我仍然没有看到适合密集单线的地方。

我什至弄乱了编译和检查 asm 以查看 one-liner 是否具有更好的编译 asm 实现，但从未发现 one-liner 值得。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T15:56:16.350

我可能会这样读：

```
typedef int (*PFNCMP)(void *, void *);

PFNCMP comparison_function;

if (numeric)
{
    comparison_function =  numcmp;
}
else
{
    comparison_function = strcmp;
}

qsort((void**) lineptr, 0, nlines-1, comparison_function); 
```

问题中的示例有一个明确的案例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T15:07:59.517

我认为你的逻辑是正确的。它确实是“指向函数的指针，它获取两个 void 指针并返回一个 int”，这是方法签名所需的类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T15:13:55.057

`numcmp`和都是`strcmp`指向函数的指针，该函数将两个`char*`作为参数并返回一个`int`. 该`qsort`例程需要一个指向函数的指针，该函数接受两个`void*`作为参数并返回一个`int`. 因此演员阵容。这是安全的，因为`void*`充当通用指针。现在，继续阅读声明：让我们来看看*你* `strcmp`的声明：

```
 int strcmp(char *, char *); 
```

编译器`strcmp`实际上按原样读取它：

```
 int (strcmp)(char *, char *) 
```

一个函数（在大多数情况下衰减为指向函数的指针），它接受两个`char *`参数。因此指针的类型`strcmp`是：

```
 int (*)(char *, char *) 
```

因此，当您需要转换另一个函数以与您兼容时，`strcmp`您将使用上述作为转换为的*类型*。

同样，由于`qsort`' 的比较器参数需要两个`void *`s ，因此是奇数演员！

# javascript - 在 jQuery 中使用 bind() 和 each() 分配事件处理程序的区别？

> ID：756547
> 
> 赞同：2
> 
> 时间：2009-04-16T15:01:47.520
> 
> 标签：javascript, jquery, function, bind, each

有人可以告诉我使用 bind() 分配事件处理程序有什么区别：

```
$(function () {
    $('someElement')
        .bind('mouseover', function (e) {
            $(this).css({
                //change color
            });
        })
        .bind('mouseout', function (e) {
            $(this).css({
                //return to previous state

            });
        })
        .bind('click', function (e) {
            $(this).css({
                //do smth.
            });
        })
}); 
```

使用 each() 完成相同的任务：

```
$('someElement').each(function () {
    $(this).mouseover(function () {
        $(this).css({/*change color*/ })
            .mouseout(function () {
                $(this).css({/*return to previous state*/ });
            });
    });
}); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T15:15:44.710

从您提供的示例中，我认为您实际上是在问使用“绑定”方法和“事件”方法之间有什么区别（如果有的话）。

例如，有什么区别：

```
$('.some_element').bind('click',function() { /* do stuff */ }); 
```

... 还有这个？

```
$('.some_element').click(function() { /* do stuff */ }); 
```

答案是真的没关系。这是一个偏好问题。事件方法在语法上更简单，涉及的输入更少，但是，据我所知，确实没有任何区别。我更喜欢使用绑定方法，因为如果您需要将多个事件附加到同一个操作，您可以使用速记事件绑定。它还使您更容易理解何时/是否需要“取消绑定”事件。

请参阅此处：[.bind 和其他事件之间的区别](https://stackoverflow.com/questions/562548/jquery-difference-between-bind-and-other-events)

但是，从实际的问题来看，“'each' 方法和 'bind' 方法有什么区别”......好吧，那是完全不同的野兽。

你永远不应该真正使用 'each' 方法来附加事件，因为 'bind' 和 'event' 方法使用更快的*CSS*选择器引擎（在 jQuery 的情况下，它使用 Sizzle 引擎）。

几乎没有（或从来没有）这样的情况：

```
$('.some_element').each(function() { $(this).click(function() { /* do something */ }); }); 
```

...比这更好：

```
$('.some_element').bind('click',function() { /* do stuff */ }); 
```

# c++ - 检查多态性中的实变量类型（C++）

> ID：756549
> 
> 赞同：2
> 
> 时间：2009-04-16T15:02:11.810
> 
> 标签：c++, polymorphism, typechecking

假设我们有一个类 A 和类 B 和 C 继承自它。然后我们创建一个对 A 的引用数组，并用 B 和 C 填充它。现在我们决定要消除所有的 C。有没有一种方法可以检查数组的每个字段真正拥有的类型，而无需执行诸如 returnType() 函数之类的冗余操作？

编辑：将“A 的数组”固定为“A 的引用数组”。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-16T15:03:07.657

您不能创建一个 As 数组并用 Bs 和 Cs 填充它 - 它们将被切成
As。您可以创建一个指向 A 的指针数组，您可以在其中填充指向 B 的指针和指向 C 的指针。

要在这种情况下检查某物的类型 - 使用动态转换：

```
 // create B or C randomly
    A * a = rand() % 2 ? new B : new C;

    if ( dynamic_cast <B *> ( a ) ) {
        // it's a B 
    }
    else {
        // it isn't (must be C in this case)
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T15:09:35.847

理想情况下，您想弄清楚是什么功能使您不希望 Cs 出现在其中。然后添加一个暴露该属性的虚函数。这样，当您添加也具有相同不需要的属性的 D 类时，事情将继续正常运行。

```
class A
{
public:
    virtual bool IsFrobbable() { return true; }
};

class B : public A
{
};

class C : public A
{
public:
    virtual bool IsFrobbable() { return false; }
};

int main()
{
     vector<A *> vA;
     vA.push_back(new A());
     vA.push_back(new B());
     vA.push_back(new C());

     vA.erase(remove_if(vA.begin(), vA.end(), not1(mem_fun(&A::IsFrobbable))));
     // Now go ahead and frob everything that's left
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:06:13.967

您将无法在其中存储 B。编译器会呻吟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:07:41.843

这仅在 A 的数组实际上是指向 A 的*指针*数组时才有效，否则您将遇到切片问题。

至于手头的问题，你最好给 A 一个虚函数 getClassName，并在子类中适当地覆盖它，然后使用结果来提供你想要的行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T15:20:29.273

在 C++ 中创建引用数组是不可能的。

但是，可以创建指向 的指针数组`A`。在这种情况下，如果`A`声明了至少 1 个虚函数，您可以使用 C++ 的运行时类型推断 (RTTI) 机制来做您想做的事情：

```
A* arr[10];

fill_with_as_bs_and_cs(arr);

for (int i = 0; i < 10; ++i) {
    if (dynamic_cast<C*>(arr[i])) {
        arr[i] = 0;   // You can't really "remove" things from an array...
    }
} 
```

然而，这不是最容易维护的方法——任何时候你需要区分 a`C`和 an`A`时，你都需要使用这个`if`测试，如果你最终派生了更多的类`A`并且你还需要区别对待*它们*，你将需要更新代码中执行此“类型测试”的每个位置。随着您的代码库变得越来越大，很快就会很容易错过一些地方。

通常，根据需要使用在每个类中重写的虚函数更易于维护。在这种特殊情况下，确定应该从数组中删除的所有派生类对象共享的*一般标准*`A`是什么——假设一个对象如果是*blargable*则应该被删除——然后编写一个虚函数`bool isBlargable()`，并测试*相反*。

# python - Python中的多个元组到两对元组？

> ID：756550
> 
> 赞同：12
> 
> 时间：2009-04-16T15:02:38.407
> 
> 标签：python, data-structures, tuples

拆分这个的最好方法是什么：

```
tuple = ('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h') 
```

进入这个：

```
tuples = [('a', 'b'), ('c', 'd'), ('e', 'f'), ('g', 'h')] 
```

假设输入总是有偶数个值。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-16T15:10:52.787

`zip()`是你的朋友：

```
t = ('a', 'b', 'c', 'd', 'e', 'f', 'g', 'h')
zip(t[::2], t[1::2]) 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-16T15:07:24.777

```
[(tuple[a], tuple[a+1]) for a in range(0,len(tuple),2)] 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-16T15:36:04.353

或者，使用（`itertools`参见[配方](http://docs.python.org/library/itertools.html#recipes)`grouper`）：

```
from itertools import izip
def group2(iterable):
   args = [iter(iterable)] * 2
   return izip(*args)

tuples = [ab for ab in group2(tuple)] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-27T16:05:25.037

我根据[Peter Hoffmann 的回答](https://stackoverflow.com/a/756580/117870)呈现这段代码，作为对[dfa 评论的回应](https://stackoverflow.com/questions/756550/17899786#comment568676_756602)。

无论您的元组是否具有偶数个元素，都可以保证工作。

```
[(tup[i], tup[i+1]) for i in range(0, (len(tup)/2)*2, 2)] 
```

range 参数计算小于或等于元组长度的`(len(tup)/2)*2`最大偶数，因此无论元组是否具有偶数个元素，都可以保证工作。

该方法的结果将是一个列表。可以使用该`tuple()`函数将其转换为元组。

**样本：**

```
def inPairs(tup):
    return [(tup[i], tup[i+1]) for i in range(0, (len(tup)/2)*2, 2)]

# odd number of elements
print("Odd Set")
odd = range(5)
print(odd)
po = inPairs(odd)
print(po)

# even number of elements
print("Even Set")
even = range(4)
print(even)
pe = inPairs(even)
print(pe) 
```

输出

```
奇数集
[0, 1, 2, 3, 4]
[(0, 1), (2, 3)]
偶数集
[0, 1, 2, 3]
[(0, 1), (2, 3)]

```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-16T15:35:14.853

这是任何大小块的通用配方，如果它可能不总是 2：

```
def chunk(seq, n):
    return [seq[i:i+n] for i in range(0, len(seq), n)]

chunks= chunk(tuples, 2) 
```

或者，如果您喜欢迭代器：

```
def iterchunk(iterable, n):
    it= iter(iterable)
    while True:
        chunk= []
        try:
            for i in range(n):
                chunk.append(it.next())
        except StopIteration:
            break
        finally:
            if len(chunk)!=0:
                yield tuple(chunk) 
```

# java - 包含文件可以从另一个包含文件调用函数吗？

> ID：756551
> 
> 赞同：2
> 
> 时间：2009-04-16T15:02:52.307
> 
> 标签：java, jsp, include

我是使用 jsp 的新手。
场景是*所有*jsp 页面将*始终*包含**包含文件 A**。其中一些页面需要调用**包含文件 B**中的函数。我的问题是，我可以从**包含文件 A**中的函数调用**包含文件 B**中的函数吗？

维基百科说：

> 就好像包含文件的内容被直接粘贴到原始文件中一样。

这让我认为这是允许的，尽管我不确定这是否是一个好的做法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T23:08:46.433

是的，您绝对可以从包含文件 B 调用包含文件 A 中的函数。

您可能希望考虑使用 EL/JSTL 而不是 scriptlet。

# command-line - 命令行中的蓝牙

> ID：756555
> 
> 赞同：9
> 
> 时间：2009-04-16T15:03:13.647
> 
> 标签：command-line, cross-platform, bluetooth, platform-agnostic

如何从命令行通过蓝牙访问另一台设备/机器上的文件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-11-21T19:24:56.173

There is [Bluetooth Command Line Tools](http://bluetoothinstaller.com/bct) suite for Windows. This suite of tools contains a **btftp** utility that allows you to exchanges files with remote Bluetooth devices.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T15:28:27.570

在 debian 包中，有`bluez-utils`包。它包含几个命令行工具：

*   hcitool：配置蓝牙连接。例如`$ hcitool dev`将列出设备
*   hciconfig：配置蓝牙设备。找到设备后，您可以对其进行配置。

它们可能存在用于从/向蓝牙设备发送、接收等的命令。

# oracle - Oracle中表名的最大长度是多少？

> ID：756558
> 
> 赞同：212
> 
> 时间：2009-04-16T15:03:19.827
> 
> 标签：oracle, name-length

Oracle中表名和列名的最大长度是多少？

* * *

## 回答 #1

> 赞同：312
> 
> 时间：2009-04-16T15:05:07.620

在[Oracle 12.2](http://docs.oracle.com/database/122/REFRN/ALL_OBJECTS.htm#REFRN20146)及更高版本中，最大对象名称长度为 128 个字节。

在[Oracle 12.1](https://docs.oracle.com/database/121/SQLRF/sql_elements008.htm#SQLRF00223)及以下版本中，最大对象名称长度为 30 个字节。

* * *

## 回答 #2

> 赞同：243
> 
> 时间：2009-04-16T16:10:40.353

## 教人钓鱼

注意数据类型和大小

```
>describe all_tab_columns

VIEW all_tab_columns

Name                                      Null?    Type                        
 ----------------------------------------- -------- ----------------------------
 OWNER                                     NOT NULL VARCHAR2(30)                
 TABLE_NAME                                NOT NULL VARCHAR2(30)                
 COLUMN_NAME                               NOT NULL VARCHAR2(30)                
 DATA_TYPE                                          VARCHAR2(106)               
 DATA_TYPE_MOD                                      VARCHAR2(3)                 
 DATA_TYPE_OWNER                                    VARCHAR2(30)                
 DATA_LENGTH                               NOT NULL NUMBER                      
 DATA_PRECISION                                     NUMBER                      
 DATA_SCALE                                         NUMBER                      
 NULLABLE                                           VARCHAR2(1)                 
 COLUMN_ID                                          NUMBER                      
 DEFAULT_LENGTH                                     NUMBER                      
 DATA_DEFAULT                                       LONG                        
 NUM_DISTINCT                                       NUMBER                      
 LOW_VALUE                                          RAW(32)                     
 HIGH_VALUE                                         RAW(32)                     
 DENSITY                                            NUMBER                      
 NUM_NULLS                                          NUMBER                      
 NUM_BUCKETS                                        NUMBER                      
 LAST_ANALYZED                                      DATE                        
 SAMPLE_SIZE                                        NUMBER                      
 CHARACTER_SET_NAME                                 VARCHAR2(44)                
 CHAR_COL_DECL_LENGTH                               NUMBER                      
 GLOBAL_STATS                                       VARCHAR2(3)                 
 USER_STATS                                         VARCHAR2(3)                 
 AVG_COL_LEN                                        NUMBER                      
 CHAR_LENGTH                                        NUMBER                      
 CHAR_USED                                          VARCHAR2(1)                 
 V80_FMT_IMAGE                                      VARCHAR2(3)                 
 DATA_UPGRADED                                      VARCHAR2(3)                 
 HISTOGRAM                                          VARCHAR2(15) 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-17T09:35:12.277

描述 all_tab_columns

将显示 TABLE_NAME VARCHAR2(30)

注意 VARCHAR2(30) 表示 30 个字节的限制，而不是 30 个字符的限制，因此如果您的数据库配置/设置为使用多字节字符集，则可能会有所不同。

麦克风

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-09-10T09:06:49.117

是的，但只要你使用 ASCII 字符，即使是多字节字符集仍然会限制正好 30 个字符......所以除非你想把心和微笑的猫放进去，否则你的数据库名称就很好......

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-10-12T15:39:00.657

更新：如上所述，在 Oracle 12.2 及更高版本中，最大对象名称长度现在为 128 字节。

这篇文章的其余部分适用于 Oracle 12.1 及更低版本：当时的限制是 30 个字符（实际上是字节）。

但不要相信我的话；自己试试这个（在 Oracle 12.1 或更低版本上）：

```
SQL> create table I23456789012345678901234567890 (my_id number);

Table created.

SQL> create table I234567890123456789012345678901(my_id number);

ERROR at line 1:

ORA-00972: identifier is too long 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-16T20:10:40.230

模式对象命名规则也可能有一些用处：

[http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#sthref723](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#sthref723)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-07-27T16:48:49.763

在 上`Oracle 12.2`，您可以使用内置常量，`ORA_MAX_NAME_LEN`设置为 128 字节（根据 12.2），之前`Oracle 12.1`最大大小为 30 字节。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T15:04:53.113

在我正在处理的 10g 数据库中，我知道表名最多为 30 个字符。无法告诉您列名长度是多少（但我知道它> 30）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-21T05:38:12.800

最大名称大小为 30 个字符，因为数据字典只允许存储 30 个字节

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-08T09:31:49.497

Oracle 数据库对象名称的最大长度为**30 个字节**。

对象名称规则： [http ://docs.oracle.com/database/121/SQLRF/sql_elements008.htm](http://docs.oracle.com/database/121/SQLRF/sql_elements008.htm)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-06-06T08:50:45.593

我正在开发 Oracle 12c 12.1。但是，它似乎不允许列/表名称超过 30 个字符。

通读一个提到 30 个字节的 oracle 页面。 [https://docs.oracle.com/database/121/SQLRF/sql_elements008.htm#SQLRF00223](https://docs.oracle.com/database/121/SQLRF/sql_elements008.htm#SQLRF00223)

在 12c 中，虽然 all_tab_columns 确实为 Table_Name 说 VARCHAR2(128)，但它不允许超过 30 个字节的名称。

发现另一篇关于 12c R2 的文章，似乎允许最多 128 个字符。 [https://community.oracle.com/ideas/3338](https://community.oracle.com/ideas/3338)

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2016-04-08T11:00:53.580

表名和列名的最大长度为 128 个字节或 128 个字符。此限制适用于使用 sybase 数据库用户。我彻底验证了这个答案，所以我自信地发布了这个答案。

# java - 排除特殊字符的正则表达式

> ID：756567
> 
> 赞同：40
> 
> 时间：2009-04-16T15:04:54.347
> 
> 标签：java, regex

我很难想出一个正则表达式，它基本上会将某些特殊字符列入黑名单。

我需要使用它来验证输入字段中的数据（在 Java Web 应用程序中）。我们希望允许用户输入任何数字、字母（我们需要包括重音字符，例如法语或德语）和一些特殊字符，例如'-。等等

如何将 <>%$ 等字符列入黑名单？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-16T15:11:30.680

我只是将字符列入白名单。

```
^[a-zA-Z0-9äöüÄÖÜ]*$ 
```

使用正则表达式构建黑名单同样简单，但您可能需要添加更多字符 - unicode 中有很多中文符号......;）

```
^[^<>%$]*$ 
```

表达式 [^(many characters here)] 只匹配未列出的任何字符。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-16T15:15:29.577

要排除某些字符（<、>、% 和 $），您可以制作如下正则表达式：

```
[<>%\$] 
```

此正则表达式将匹配所有包含黑名单字符的输入。括号定义了一个字符类，并且在美元符号之前需要 \ ，因为美元符号在正则表达式中具有特殊含义。

要将更多字符添加到黑名单中，只需将它们插入括号中即可；顺序无所谓。

根据一些[Java 正则表达式文档](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)，您可以像这样使用表达式：

```
Pattern p = Pattern.compile("[<>%\$]");
Matcher m = p.matcher(unsafeInputString);
if (m.matches())
{
    // Invalid input: reject it, or remove/change the offending characters.
}
else
{
    // Valid input.
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-11-27T23:37:58.530

即使在 2009 年，似乎也有太多人对 WORLDWIDE 网络设计所涉及的内容知之甚少。在 2015 年，除非针对特定国家进行设计，否则黑名单是容纳大量可能有效字符的唯一方法。

然后需要根据需要数据的目的是非法的来选择要列入黑名单的字符。

但是，有时需要分解需求并分别处理每个需求。前瞻是您的朋友。这些部分以`(?=)`正数和`(?!)`负数为界，并有效地成为 AND 块，因为当块被处理时，如果没有失败，正则表达式处理器将从下一个块的文本开始处开始。实际上，每个前瞻块前面都会有`^`，如果它的模式是贪婪的，则包含到`$`. 甚至古老的 VB6/VBA (Office) 5.5 正则表达式引擎也支持前瞻。

因此，要构建完整的正则表达式，请从前瞻块开始，然后在最终的`$`.

例如，要限制字符的总数，比如在 3 到 15 之间（包括 3 到 15），请从正向预读块开始`(?=^.{3,15}$)`。请注意，这需要它自己的`^`并`$`确保它涵盖所有文本。

现在，虽然您可能希望允许 _ 和 -，但您可能不想以它们开始或结束，所以添加两个负前瞻块，`(?!^[_-].+)`用于开始和`(?!.+[_-]$)`结束。

如果您不想要多个`_`and `-`，请添加`(?!.*[_-]{2,})`. 这也将排除`_-`和`-_`序列。

如果没有更多的前瞻块，则在 之前添加黑名单块`$`，例如`[^<>[\]{\}|\\\/^~%# :;,$%?\0-\cZ]+`，其中`\0-\cZ`不包括空字符和控制字符，包括 NL ( `\n`) 和 CR ( `\r`)。final`+`确保所有文本都被贪婪地包含在内。

在 Unicode 域中，很可能还需要排除其他代码点或块，但肯定比必须包含在白名单中的所有块少得多。

以上所有内容的整个正则表达式将是

```
(?=^.{3,15}$)(?!^[_-].+)(?!.+[_-]$)(?!.*[_-]{2,})[^<>[\]{}|\\\/^~%# :;,$%?\0-\cZ]+$ 
```

[您可以在https://regex101.com/](https://regex101.com/)上实时查看 pcre (php)、javascript 和 python 正则表达式引擎。我不知道 java 正则表达式在哪里适合，但您可能需要修改正则表达式以适应它的特性。

如果您想包含空格，但不包含`_`，只需在正则表达式中的每个位置交换它们。

该技术最有用的应用是`pattern`HTML`input`字段的属性，其中需要单个表达式，失败返回 false，从而使字段无效，允许`input:invalid`css 突出显示它，并停止提交的表单。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-01-24T13:06:11.607

对于 ASCII 字符，非字母数字和下划线的所有内容的否定集：

```
/[^\W]/g 
```

对于电子邮件或用户名验证，我使用了以下允许 4 个标准特殊字符的表达式 - _ 。@

```
/^[-.@_a-z0-9]+$/gi 
```

对于严格的仅字母数字表达式，请使用：

```
/^[a-z0-9]+$/gi 
```

测试@ [RegExr.com](https://regexr.com)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-16T15:07:39.253

通常最好将您允许的字符列入白名单，而不是将您不允许的字符列入黑名单。无论是从安全的角度来看，还是从易于实施的角度来看。

如果你确实走黑名单路线，这里有一个例子，但要注意，语法并不简单。

[http://groups.google.com/group/regex/browse_thread/thread/0795c1b958561a07](http://groups.google.com/group/regex/browse_thread/thread/0795c1b958561a07)

如果您想将所有重音字符列入白名单，也许使用 unicode 范围会有所帮助？看看这个链接。

[http://www.regular-expressions.info/unicode.html](http://www.regular-expressions.info/unicode.html)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-16T15:11:37.887

我想这取决于您所针对的语言。一般来说，这样的事情应该有效：

```
[^<>%$] 
```

" `[]`" 构造定义了一个字符类，它将匹配任何列出的字符。将“ `^`”作为第一个字符会否定匹配，即：除列出的字符之外的任何字符。

您可能需要转义“ `[]`”中的某些字符，具体取决于您使用的语言/正则表达式引擎。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-16T15:09:43.023

您真的想将特定字符列入黑名单还是将允许的字符列入白名单？

我假设您实际上想要后者。这非常简单（将任何其他符号添加到`[\-]`组中的白名单）：

```
^(?:\p{L}\p{M}*|[\-])*$ 
```

编辑：使用评论输入优化模式

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T18:58:06.303

为什么你认为正则表达式是最好的工具？如果您的目的是检测字符串中是否存在非法字符，那么在循环中测试每个字符将比构造正则表达式更简单、更有效。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-30T16:56:02.367

这是所有法语口音字符：àÀâÂäÄáÁéÉèÈêÊëËìÌîÎïÏòÒôÔöÖùÙûÛüÜçÇ'ñ</p>

我会用谷歌搜索德国重音字符的列表。没有那么多。你应该能够得到它们。

对于 URL，我将重音 URL 替换为常规字母，如下所示：

```
string beforeConversion = "àÀâÂäÄáÁéÉèÈêÊëËìÌîÎïÏòÒôÔöÖùÙûÛüÜçÇ’ñ";
string afterConversion = "aAaAaAaAeEeEeEeEiIiIiIoOoOoOuUuUuUcC'n";
for (int i = 0; i < beforeConversion.Length; i++) {

     cleaned = Regex.Replace(cleaned, beforeConversion[i].ToString(), afterConversion[i].ToString());
} 
```

请注意，可能有一种更有效的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-16T15:14:02.903

我强烈怀疑，列出允许的字符与不允许的字符列表会更容易——一旦你有了这个列表，正则表达式的语法就会变得非常简单。所以把我作为“白名单”的另一票。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-12T09:19:47.853

用这个

```
^(?=[a-zA-Z0-9~@#$^*()_+=[\]{}|\\,.?: -]*$)(?!.*[<>'"/;`%]) 
```

# .net - 如何命名一个接口的集合？

> ID：756575
> 
> 赞同：0
> 
> 时间：2009-04-16T15:06:50.440
> 
> 标签：.net, collections, interface, naming-conventions

情况如下。

```
public interface IFoo { }

public abstract class FooBase : IFoo { } 
```

`IFoo`现在我需要一个带有一些附加方法的集合。

```
public class IFooCollection : List<IFoo>
{
   public void UsefullMethod() { }
} 
```

问题是它`IFooCollection`看起来像一个接口，而它是一个类。选项如下。

1.  保留它`IFooCollection`——我不喜欢这个，因为它看起来像一个界面。
2.  命名它`FooCollection`- 我不喜欢这个，因为它不是 foos 的集合。
3.  把它变成`FooBaseCollection`因为`IFoo`派生自的所有实现`FooBase`——我不喜欢这样，因为这可能不会永远正确。
4.  根本不要创建类，而是提供扩展方法，`IList<IFoo>`因为只有一个完整的方法 - 我不喜欢这样，因为更改代码是因为你找不到类的名称......是的，这很讨厌。
5.  我没有想到或忘记写下来的东西 - 我希望我会喜欢它！

那你会怎么做？有没有我错过的命名约定？我们基本上使用这个[Microsoft .NET Library Standards](http://msdn.microsoft.com/en-us/library/xzf533w0(VS.71)(loband).aspx)。

**更新**

该代码不会被广泛使用——它只是在一个 GUI 工具中，用于将一些数据放入服务器。所以我不关心将这些方法与其他集合一起使用或忽略这些方法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T15:11:29.103

我喜欢`FooCollection`你有一个概念对象“Foo”的集合，即使没有实际的`Foo`类或接口。`IFoo`即使没有`Foo`类，这也符合“Foo”的接口。`SpecialFoo`即使没有`Foo`课程，也会是一种特殊的“Foo”。

我绝对同意这`IFooCollection`是错误的，因为隐含的接口。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T15:18:23.430

FooCollection - 'Foo' 并不明显，因为 Foo 没有意义，因此很难概念化。尝试使用“真实的”类/接口名称，它更有意义 - 例如

```
public class ErrorHandlerCollection : List<IErrorHandler>
{
  public void PublishErrors(){//...}
} 
```

这是有道理的，因为 ErrorHandlerCollection 是错误处理程序的集合。任何实现 IErrorHandler 的东西都是错误处理程序，因此 ErrorHandlerCollection 中的任何东西都是错误处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:11:32.737

实际上，我更喜欢 #4 而不是构建自己的集合类型，因为最终用户会想要将他们的 IFoo 实现对象填充到他们自己的列表和其他集合中。这样，这些集合将按预期工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:11:53.487

您确实已经确定了大多数选择。

我能想到的唯一另外一个是 CollectionOfIFoo，但这不符合约定。

我可能会选择 IFooCollection。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T15:17:38.547

就个人而言，我喜欢使用扩展方法的想法。如果您担心人们能够轻松找到扩展方法，只需将它们放在与 IFoo 接口相同的代码文件中的静态类中。或者在同一命名空间中的单独文件中创建一个“IFooExtensions”类，以便在人们查看“IFoo”时轻松发现

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T15:21:28.850

IMO #2 是正确的命名，但我也建议使用 FooList，因为您是从列表中派生的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-17T11:43:27.743

怎么样`CollectionOfIFoo`？

就个人而言，我不喜欢在接口前加上“I”前缀的约定——它基本上是一种不好的匈牙利符号形式，这就是为什么它不好的一个例子。

# asp.net - Linq 从中选择化合物

> ID：756592
> 
> 赞同：0
> 
> 时间：2009-04-16T15:08:49.983
> 
> 标签：asp.net, vb.net, linq

我正在尝试使用 linq 组件选择。我发现以下查询不返回任何元素：

```
 Dim q = From s In d.GetChildRows("DossierSinistri") _
                    From i In s.GetChildRows("DossierIncarichi") _
                    Select s 
```

而以下是：

```
 Dim q = From s In d.GetChildRows("DossierSinistri") _
                    Select s 
```

有什么帮助吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T15:19:29.183

为了让显而易见的事情消失，您是否尝试过“ `Select i`”而不是“ `Select s`”？

# junit - 作为 XP 计划任务运行每晚构建 - 类路径问题

> ID：756603
> 
> 赞同：2
> 
> 时间：2009-04-16T15:10:55.237
> 
> 标签：junit, classpath, nightly-build

我在我的计算机上运行 JUnit 每晚构建作为 Windows XP 中的计划任务。我的应用程序使用 Jaxb，因此一些测试需要使用系统类路径引用 xsd 模式。当我不在计算机上时运行夜间构建时，我收到如下错误：

***java.lang.Exception：无法从类路径加载架构 mySchema.xsd***

但是，当我手动运行构建时，我没有收到这样的错误。我的模式位置的环境变量是*系统*变量，而不是用户变量，所以我不知道是什么导致了这个错误。这个错误可能是什么原因？

**编辑：**像哈德逊这样的替代品不是我想要的。我正在寻求上述技术的解决方案（作为计划任务运行的批处理文件）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:16:00.980

您应该查看[Hudson](http://hudson-ci.org/)或[Cruise Control](http://cruisecontrol.sourceforge.net/)。两者都易于设置，并将通过更多报告、控制和改进的可用性为您解决此类问题。您将花费更少的时间调查构建问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:26:32.020

我怀疑您的工作目录与您期望的不同（而不是具体的类路径变量）。如果您以用户或系统任务的身份运行此计划任务，这并不是很明显。无论哪种情况，都值得找出任务运行的确切位置。

也就是说，虽然我曾经使用 Windows XP 计划任务设置自动构建（就像您现在所做的那样），但我们目前使用[CruiseControl](http://cruisecontrol.sourceforge.net/)。概括地说，这与您正在做的事情（定期运行构建）没有太大区别，但它[增加了您的灵活性](http://cruisecontrol.sourceforge.net/main/configxml.html)。在这里，CruiseControl 最有价值的功能是检测已提交的更改并仅在*那时*运行构建。现在，我们在提交后 10 分钟内发现了损坏的构建、损坏的单元测试等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T16:13:42.500

[hudson](http://hudson-ci.org/)是另一个持续集成引擎，设置起来非常简单：

[哈德逊提供以下功能](http://wiki.hudson-ci.org/display/HUDSON/Meet+Hudson)：

*   易于安装：只需 java -jar hudson.war，或将其部署在 servlet 容器中。无需额外安装，无需数据库。
*   易于配置：Hudson 可以完全从其友好的 Web GUI 进行配置，具有广泛的即时错误检查和内联帮助。不再需要手动调整 XML，但如果您愿意，也可以这样做。
*   变更集支持：Hudson 可以生成从 CVS/Subversion/Mercurial 对构建所做的更改列表。这也以相当有效的方式完成，以减少存储库的负载。
*   永久链接：Hudson 为您的大部分页面提供了清晰可读的 URL，包括一些永久链接链接“最新构建”/“最新成功构建”，以便可以轻松地从其他地方链接它们。
*   RSS/E-mail/IM 集成：通过 RSS 或电子邮件监控构建结果，以获取有关失败的实时通知。
*   事后标记：可以在构建完成后很长时间对构建进行标记 JUnit/TestNG 测试报告：JUnit 测试报告可以制表、汇总和显示历史信息，例如何时开始中断等。绘制历史趋势成图表。
*   分布式构建：Hudson 可以将构建/测试负载分布到多台计算机。这使您可以充分利用位于开发人员办公桌下方的闲置工作站。文件指纹：Hudson 可以跟踪哪个构建生成了哪些 jar，以及哪个构建使用了哪个版本的 jar，等等。这甚至适用于在 Hudson 之外生成的 jar，并且非常适合项目跟踪依赖关系。
*   插件支持：Hudson 可以通过 3rd 方插件进行扩展。您可以编写插件以使 Hudson 支持您的团队使用的工具/流程。

# c++ - 在 win32 上编译 idl 文件时出现 midl 错误 2025（midl 不喜欢 string<40>）

> ID：756611
> 
> 赞同：1
> 
> 时间：2009-04-16T15:11:33.253
> 
> 标签：c++, idl, ace, tao, ace-tao

我用 linux 工具编译的 idl 文件很好，但是当我尝试使用 midl 编译时出现错误

```
error MIDL2025 : syntax error : expecting a declarator or * near "<" 
```

该行是：

```
typedef string<40>      somestring; 
```

这是非标准的idl，还是我错过了什么？midl 是否有允许此操作的开关？

我希望我能早点设置赏金...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T13:59:24.670

我的错。它是 ACE/TAO 特定的。有一个 tao_idl.exe idl 编译器/处理器。我将用 ACE TAO 标记这个问题

# c# - 使用 WCF 序列化 linq 实体

> ID：756619
> 
> 赞同：2
> 
> 时间：2009-04-16T15:12:32.643
> 
> 标签：c#, wcf, linq-to-sql

我正在通过 WCF 序列化一个 linq 对象。dbml 设置为单向序列化。

我的对象非常简单：Budget 有一个 BudgetLineItems 集合。每个 BudgetLineItem 都有一个 ItemCateogry。

Budget/BudgetLineItems 可以很好地序列化。但是，每个 BudgetLineItem 上的 ItemCateogry 都没有。我注意到默认情况下，linq 没有在 ItemCategory 上为每个 BudgetLineItem 添加 [DataMember]。我手动添加了它，还使用 ​​[IgnoreDataMember] 删除了 ItemCategory 实体上任何可能的循环引用。然而，不是运气。

问题：

1.  默认情况下，wcf 可以序列化多对一关系，还是我只是缺少一些东西？我知道对于每个 BudgetLineItem 重复的 ItemCategory 数据，序列化数据会相当多余，但这很好。

2.  我需要为此做一个自定义 DataContractSerializer 吗？

** 编辑 ** 实际上，这确实有效（添加 [DataMember]），我只是没有更新客户端上的服务引用（duh）。

新问题：有没有办法告诉 linqtosql 设计者在设计者生成的实体上维护那些 [DataMember] 和 [IgnoreDataMember] 字段？否则我每次保存 dbml 时都需要更新它们。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T06:12:21.313

哇，您成功地为 WCF 序列化了 LINQ 2 SQL 对象？

当我尝试这个时（非常不情愿，请参阅下面的原因）它真的倒下了，我的 L2S 实体中有指向子级的关系，然后子级指向父级，显然在枚举构建 WCF 对象时，它无法以这种方式无限遍历树，[据我所知]它导致了溢出异常，所以我基本上说的是，如果你走这条路要小心！

跟进 Michael 的帖子，我建议将您的 WCF 对象转换为 POCO（自定义模型表示）。我很高兴上述方法不起作用，因为我总是更喜欢制作一个自定义 WCF 对象，它传输一个干净的数据子集，正是 WCF 请求需要的，然后它不包含一堆多余的数据跨数据发送，我相信你的 L2S 实体有很多。我尝试直接通过网络发送我的 L2S 数据的实际原因是因为我必须制作一个使用某些“规则”的引擎，这些规则存储在大约 4 个具有关系的数据库表的关联中，并且维护一个单独的数据库表是不可行的WCF 对象。

所以最后我最终做的是扩展自定义代码生成类以包含带有 [DataContext] 的 Wcf.cs，然后为 L2S 类 -> WCF 自定义类的属性克隆属性。

它最终完美运行，这是[我在博客上使用的克隆程序](http://goneale.wordpress.com/2009/02/16/cloning-object-properties-via-reflection/)。

我对此感到满意，并且不认为涉及不良做法。希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:42:46.237

您不应该使用 WCF 发送 linq 实体。而是制作您自己的业务数据模型并通过网络发送这些数据模型。如果您更改了数据库，您不想更改与您的服务连接的每个程序

# python - 如何在 Python/Bash/AWK 中使用二进制转换？

> ID：756630
> 
> 赞同：1
> 
> 时间：2009-04-16T15:14:46.083
> 
> 标签：python, bash, binary, awk

我是二进制转换的新手。我每天都使用 Python、Bash 和 AWK。

我想看看二进制转换在这些语言中的应用。例如，我对您在工作中通过它解决的问题感兴趣。

**在 Python/Bash/AWK 中，你在哪里使用二进制转换？**

我想看看代码示例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T15:36:17.597

在命令行上使用 Python 将二进制数字字符串转换为数字：

```
binary=00001111
DECIMAL=$(python -c "print int('$BINARY', 2)")
echo $decimal 
```

请参阅[int 函数](http://docs.python.org/library/functions.html#int)的文档。

哦，等等，我误读了这个问题，你想知道转换为二进制会得到什么。好吧，这取决于“转换为二进制”的含义。假设我想存储一个包含一百万个整数的文件。整数将介于 0 和 32,000 之间。如果我将它们存储为文本，则每个数字最多需要两个字节（一位数字和一个分隔符），最坏的情况是六个字节（五位数字和一个分隔符），每个数字的平均大小为 4.6 个字节（请参阅数学评论）。我也没有简单的方法来选择第 15 个数字。如果我将它们存储为 16 位整数（二进制），每个数字将占用两个字节，我可以通过`seek`'ing to offset找到第 15 个数字`2*(15-1)`并读取两个字节。此外，当我对基于文本的版本进行数学运算时，我（或我的语言）必须首先将字符串转换为数字，而二进制版本已经是 16 位数字。

所以，简而言之，你使用二进制类型来

1.  节省空间
2.  具有一致的记录大小
3.  加快程序

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T15:45:12.053

在 shell 中，很好地使用[`dc`](https://stackoverflow.com/questions/750606/what-technologies-are-you-using-even-though-they-are-embarassingly-out-of-date/750620#750620)：

```
echo 2i 00001111 pq | dc 
```

2i 表示：*输入数字的基数是 2*。

pq 表示：*打印和退出*。

另一种方式是：

```
echo 2o 15 pq | dc 
```

我不记得在现实世界中使用过这个功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-06T17:35:53.217

在较新版本的 Python 中，存在`bin()`我认为采用 int 并返回二进制文字、形式`0b011010`或其他形式的函数。

# glib - gtkmm：从其他线程更新 gui？

> ID：756656
> 
> 赞同：0
> 
> 时间：2009-04-16T15:23:04.743
> 
> 标签：glib, gtkmm

我正在使用 gtkmm（和 glibmm），我想从另一个线程更新 GUI。我已经按照上的例子

[http://www.gtkmm.org/docs/glibmm-2.4/docs/reference/html/thread_2dispatcher_8cc-example.html#_a1](http://www.gtkmm.org/docs/glibmm-2.4/docs/reference/html/thread_2dispatcher_8cc-example.html#_a1)

但我有两个问题：

*   不是 Glib::MainLoop 接收事件，而是 Gtk::Main （运行我的窗口）是否可以接受信号？

*   我可以以某种方式使用带参数的 .connect() 函数吗？我知道使用 SigCX 是可能的，但我认为那里的语法有点讨厌。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:23:36.313

您可以让 Glib::MainLoop 接收事件，然后将其分派给 Gtk::Main。

我相信连接自定义参数的唯一方法是使用 sigc::bind。

例如，假设您想传入一个整数，以及一个指向相关小部件的指针：

```
pWidget->signal_foo().connect( 
            sigc::bind<int, Gtk::SomeWidget*>( 
                sigc::mem_fun( *this, &Bar::OnFooBar ), i, pWidget ) ); 
```

# python - 如何从两个Listbox中同时选择？

> ID：756662
> 
> 赞同：22
> 
> 时间：2009-04-16T15:24:17.313
> 
> 标签：python, listbox, tkinter

```
from Tkinter import *

master = Tk()

listbox = Listbox(master)
listbox.pack()
listbox.insert(END, "a list entry")

for item in ["one", "two", "three", "four"]:
    listbox.insert(END, item)

listbox2 = Listbox(master)
listbox2.pack()
listbox2.insert(END, "a list entry")

for item in ["one", "two", "three", "four"]:
    listbox2.insert(END, item)

master.mainloop() 
```

上面的代码创建了一个`tkinter`带有两个列表框的窗口。但是，如果您想从两者中检索值，则会出现问题，因为一旦您在其中一个中选择了一个值，它就会取消选择您在另一个中选择的任何内容。

这只是开发人员必须忍受的限制吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-16T16:11:42.537

简短的回答：将`exportselection`所有列表框小部件的属性值设置为 False 或零。

从列表框小部件[的 pythonware 概述](http://www-acc.kek.jp/WWW-ACC-exp/KEKB/control/Activity/Python/TkIntro/introduction/listbox.htm)：

> 默认情况下，选择会导出到 X 选择机制。如果屏幕上有多个列表框，这对于可怜的用户来说真的很糟糕。如果他在一个列表框中选择了一些东西，然后又在另一个列表框中选择了一些东西，那么原来的选择就会被清除。在这种情况下禁用此机制通常是个好主意。在以下示例中，在同一个对话框中使用了三个列表框：
> 
> ```
> b1 = Listbox(exportselection=0)
> for item in families:
>     b1.insert(END, item)
> 
> b2 = Listbox(exportselection=0)
> for item in fonts:
>     b2.insert(END, item)
> 
> b3 = Listbox(exportselection=0)
> for item in styles:
>     b3.insert(END, item) 
> ```

tk 小部件的权威文档基于 Tcl 语言而不是 python，但很容易翻译成 python。该`exportselection`属性可以在[标准选项手册页上](http://tcl.tk/man/tcl8.5/TkCmd/options.htm#M-exportselection)找到。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T16:01:56.647

`exportselection=0`定义列表框时似乎可以解决此问题。

# sql - [master] 上的 GRANT 是否会传播给其他数据库？

> ID：756663
> 
> 赞同：0
> 
> 时间：2009-04-16T15:24:20.200
> 
> 标签：sql, sql-server, sql-server-2005, scripting, permissions

好的，我正在尝试在 SQL Server 2005 的另一个实例上创建一个“空”版本的数据库。为此，我使用脚本向导创建一个大脚本来创建所有表、视图、SP 等。 ，添加一些用户，并为他们授予权限。现在，在脚本的权限部分，我有（除其他外）

```
use [master]
GO
GRANT CREATE VIEW to [myUser]
GO
...
use [prodDb]
GO
GRANT REFERENCES on [tblMyTable] to [myUser]
GO
... 
```

请记住，这是向导生成的脚本。我想弄清楚的是，“使用 master ... GRANT CREATE VIEW”是否应该允许 myUser 在 prodDb 中创建视图？这是我的理解——我是说“myUser 可以在此实例上的任何数据库中创建视图”——但我认为当我尝试允许 myUser 在 prodDb 中创建视图时出现权限错误。当我在 SQL Server 管理器中查看 prodDb 的权限时，权限是正确的，但是我正在执行生成的脚本的目标系统没有 SQL Server 管理器，我不确定如何检查每个用户的权限在命令行的给定对象上（显然，当我尝试行使这些权限时的错误是一个很大的提示）。

这是脚本向导中的错误吗？我应该取消 Master 级别的权限并仅在 per-DB 级别授予它们吗？如果有任何区别，这是针对永远不会联网的独立系统上的本地应用程序。

ETA：好的，那么为什么脚本向导没有为 prodDb 编写正确的 GRANT 语句？我的意思是，如果我查看 prodDb 上 myUser 的当前权限，他们可以创建视图。但是，如果我从命令行在新的 SQL Server 实例上运行脚本，myUser 将无法在 prodDb 上创建视图。我可以手动解决这个问题，但是每次我重新运行脚本向导时都必须记住这一点非常烦人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T15:40:35.840

我的理解是，对 Master 的更改不会传播到其他数据库，它只是系统范围对象（例如用户、系统存储过程和存在的其他数据库列表）的支撑地。

对模型的更改*将*传播到更改后创建的新数据库，但不会传播到现有数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:42:52.230

“idforstackoverflow”是完全正确的：

*   Master可以说是“系统”数据库
*   另一方面，“模型”是新数据库的模板。对模型的更改将在创建时传播**到新数据库**- 现有数据库不受这些更改的影响

马克

# emacs - 在定义通用模式中将正则表达式匹配为关键字

> ID：756666
> 
> 赞同：4
> 
> 时间：2009-04-16T15:25:00.527
> 
> 标签：emacs, elisp

我正在尝试使用define-generic-mode为emacs编写一个新模式。我发现了一些教程，它们展示了如何添加关键字（作为字符串），然后将其突出显示。是否可以为 define-generic-mode 提供一个正则表达式，以便它可以突出显示与该关键字匹配的任何内容？

我想要一种模式，其中与 15/01/09 形式的日期匹配的任何内容都以不同的字体显示（最好带下划线，但我会接受不同的颜色）。

有任何想法吗？

罗宾

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T16:25:11.177

这是一个示例，`define-generic-mode`该示例设置正则表达式以使用自定义面孔对所有日期进行字体化，并选择一些属性作为示例：

```
(make-face 'my-date-face)
(set-face-attribute 'my-date-face nil :underline t)
(set-face-attribute 'my-date-face nil :family "times")
(set-face-attribute 'my-date-face nil :slant 'normal)
(set-face-attribute 'my-date-face nil :height '340)

(define-generic-mode my-date-mode
  nil
  nil 
  '(("\\([0-9]+/[0-9]+/[0-9]+\\)"
     (1 'my-date-face)))
  nil
  nil) 
```

Oh, and obviously, set the mode by `M-x my-date-mode`. This can be done automatically via the auto-mode-alist (5th argument to `define-generic-mode`).

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T16:08:59.877

例如，使用 font-lock-add-keywords 以在主要模式下突出显示 FIXME、TODO 和 XXX 作为警告：

```
 (dolist (mode '(c-mode
    java-mode
    cperl-mode
    html-mode-hook
    css-mode-hook
    emacs-lisp-mode))
            (font-lock-add-keywords mode 
          '(("\\(XXX\\|FIXME\\|TODO\\)" 
             1 font-lock-warning-face prepend)))) 
```

# excel - 将文本转换为数字

> ID：756680
> 
> 赞同：0
> 
> 时间：2009-04-16T15:29:03.107
> 
> 标签：excel, vba

大家早，

今天我想出了用 VBA 代码自动将文本转换为数字的新任务。例如 '1233 需要转换为 1233 和 (1234) 需要转换为 -1234 没有任何人为干扰。一些建议非常有帮助。

问候，贾比尔·阿里

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T15:57:15.440

使用[VALUE()](http://office.microsoft.com/en-us/excel/HP100625831033.aspx)函数。

另外，从[这里](http://www.contextures.com/xlDataEntry03.html)：

```
Sub ConvertToNumbers() 
  Cells.SpecialCells(xlCellTypeLastCell) _
    .Offset(1, 1).Copy
  Selection.PasteSpecial Paste:=xlPasteValues, _
     Operation:=xlPasteSpecialOperationAdd
  With Selection
     .VerticalAlignment = xlTop
     .WrapText = False
  End With
  Selection.EntireColumn.AutoFit
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:37:39.967

误解了你的问题，我很抱歉。

这对我有用，即使在 excel 之外：

```
Function numConv(num As String) As Double

    If Mid(num, 1, 1) = "(" And Mid(num, (Len(num)), 1) = ")" Then
        num = Replace(num, "(", "")
        num = Replace(num, ")", "")
        numConv = val(num) * -1
    Else
        numConv = val(num)
    End If

End Function 
```

# c# - 用于读取公共常量和静态字段/属性的流利表达式助手

> ID：756682
> 
> 赞同：0
> 
> 时间：2009-04-16T15:29:31.030
> 
> 标签：c#, .net, c#-3.0

有谁知道如何编写 ExpressionHelper.GetName 方法，以便我可以使用反射和 C# 3.0 获取公共静态/常量属性或字段的名称

因此对于

```
static class B
{
  public const string Field = "mittens";
  public static string Prop = "the kitten";
} 
```

以下断言将起作用（语法显然不起作用）

```
Assert.AreEqual(ExpressionHelper.GetName(B.Field),"Field");
Assert.AreEqual(ExpressionHelper.GetName(B.Prop),"Prop"); 
```

重要的是当有人更改这些字段/道具时会出现编译时错误。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:40:45.607

LINQ 超越查询一文[：强类型反射](http://weblogs.asp.net/cazzu/archive/2006/07/06/Linq-beyond-queries_3A00_-strong_2D00_typed-reflection_2100_.aspx)可以提供一个解决方案。我几个月前读过它——所以我现在不能提供一个明确的解决方案。但可能会有所帮助。

# c - 使用winsock获取本地主机的内容

> ID：756684
> 
> 赞同：0
> 
> 时间：2009-04-16T15:30:27.457
> 
> 标签：c, winsock

嘿！我正在尝试连接到我的本地主机和那里的索引页面。但每次我尝试我都会得到：

```
Dados -> HTTP/1.1 400 Bad Request Date: Thu, 16 Apr 2009 15:25:41 GMT Server: Apache/2.2.10 (Win32) PHP/5.2.8 Content-Length: 226 Connection: close Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"> <html><head> <title>400 Bad Request</title> </head><body> <h1>Bad Request</h1> <p>Your browser sent a request that this server could not understand.<br /> </p> </body></html> 
```

☺</p>

这是我的代码：

```
#define WIN32_LEAN_AND_MEAN

#include <stdio.h>
#include <stdlib.h>
#include <winsock2.h>

int main()
{
    WSADATA WsaDat;

    if(WSAStartup(MAKEWORD(2,0),&WsaDat)!=0)
    {
        printf("Winsock error - Winsock initialization failed\r\n");
        WSACleanup();
        system("PAUSE");
        return 0;
    }

    SOCKET Socket = socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);

    if(Socket==INVALID_SOCKET)
    {
        printf("Winsock error - Socket creation Failed!\r\n");
        WSACleanup();
        system("PAUSE");
        return 0;
    }

    struct hostent *host;
    if((host=gethostbyname("localhost"))==NULL)      
    {
        printf("Failed to resolve hostname.\r\n");
        WSACleanup();
        return 0;
    }

    printf("Resolveu o hostname\r\n");
    SOCKADDR_IN SockAddr;
    SockAddr.sin_port= htons(80);
    SockAddr.sin_family= AF_INET;
    SockAddr.sin_addr.s_addr= *((unsigned long*)host->h_addr);

    if(connect(Socket,(SOCKADDR*)(&SockAddr),sizeof(SockAddr))!=0)
    {
        printf("Failed to establish connection with server\r\n");
        WSACleanup();
        system("PAUSE");
        return 0;
    }

    char get[] = {
                    "GET / HTTP/1.1\n"
                    "From: bla@ble\n"
                    "User-Agent: HTTPTool/1.0\n"
                    "\n"
                };
    send(Socket,get, strlen(get),0);

    printf("Ligou-se\r\n");
    char buffer[1000];
    int nDataLength = recv(Socket,buffer,1000,0);
    printf("Dados -> %s",buffer);

    shutdown(socket,SD_SEND);

    closesocket(socket);

    WSACleanup();

    return 0;
} 
```

有什么遗漏吗？我正在关注一个教程，这基本上就是他们那里的代码。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:33:18.510

[HTTP 1.1](http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4)需要一个`Host: localhost`标头 - 添加此标头或使用 HTTP 1.0

此外，标题由 分隔`\r\n`，而不仅仅是`\n`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T22:15:58.407

It might be easier to try just using HTTP/1.0, which you don't need to specify the extra values:

char get[] = { "GET / HTTP/1.0\r\n" };

Should work everywhere...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T23:54:24.313

正如 RoBorg 所说，您的 get 字符串应该是：

```
 char get[] = {
                "GET / HTTP/1.1\r\n"
                "Host: localhost\r\n"
                "From: bla@ble\r\n"
                "User-Agent: HTTPTool/1.0\r\n"
                "\r\n"
            }; 
```

如果您要连接到除 localhost 之外的其他站点，则必须更新“主机”字段（通常是主机名、IP 地址或 www 有效）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T14:49:36.910

您可能还想尝试使用**WinInet**来满足您的客户端 Http 需求，而不仅仅是套接字。

许多人通过代理连接到网络服务——也就是说，他们自己的计算机无法访问网络，但它可以访问附近的计算机（代理）来转发请求。您的套接字代码不处理代理，但 WinInet API 会自动为您处理。

[作为一个老式的网络人，我讨厌这些设备——它们基本上没有很好地实现路由器]

同样，您可能希望有一天将您的服务器切换到 https：你会花很多时间更新你的套接字代码来处理这个问题，但是 WinInet 再次为你做这件事。

[注：我在微软工作]

# postgresql - PostgreSQL 函数返回多个结果集

> ID：756689
> 
> 赞同：22
> 
> 时间：2009-04-16T15:31:16.113
> 
> 标签：postgresql, plpgsql

是否可以从 Postgres 函数返回多个结果集，例如在 MSSQL 中：

```
CREATE PROCEDURE test

AS

SELECT * FROM first_table

SELECT * FROM second_table 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-10-13T00:47:18.423

**自 PostgreSQL 8.3 以来**就出现了一种更简单的方法：

```
CREATE FUNCTION test()
  RETURNS SETOF first_table AS
$func$
BEGIN

RETURN QUERY
SELECT * FROM first_table;

RETURN QUERY
SELECT * FROM second_table;   -- has to return same rowtype as first_table!

END
$func$ LANGUAGE plpgsql; 
```

称呼：

```
SELECT * FROM test(); 
```

两个结果集都附加到从函数返回的单个集中。
参见[手册`RETURN QUERY`](https://www.postgresql.org/docs/current/plpgsql-control-structures.html#PLPGSQL-STATEMENTS-RETURNING)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T15:42:15.633

```
CREATE OR REPLACE FUNCTION "pr_GetCustomersAndOrders"()
RETURNS SETOF refcursor AS
$BODY$DECLARE
customerRC refcursor;
orderRC refcursor;
BEGIN
open customerRC FOR
SELECT * FROM customers;
RETURN NEXT customerRC;

open orderRC FOR
SELECT * FROM orders;
RETURN NEXT orderRC;
RETURN;
END;$BODY$
LANGUAGE 'plpgsql' VOLATILE;
ALTER FUNCTION "pr_GetCustomersAndOrders"() OWNER TO postgres; 
```

Iow 使用 refcursors :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-08-04T10:49:49.863

```
CREATE OR REPLACE FUNCTION public.TestReturnMultipleTales
( 
 param_coid integer, 
 ref1 refcursor,
 ref2 refcursor
)
RETURNS SETOF refcursor 
LANGUAGE 'plpgsql'
COST 100
VOLATILE PARALLEL UNSAFE
ROWS 1000

AS $BODY$
DECLARE

BEGIN
  OPEN ref1 FOR SELECT * FROM dbo.tbl1 WHERE coid = param_coid;
  RETURN NEXT ref1;

  OPEN ref2 FOR SELECT * FROM dbo.tbl2 LIMIT 5;
  RETURN NEXT ref2;
END;
$BODY$;

USE IN pgSQL Query:- 

BEGIN;
    SELECT football_players.show_cities_multiple(123456, 'Ref1', 'Ref2');
    FETCH ALL IN "Ref1";
    FETCH ALL IN "Ref2";
COMMIT;

SELECT football_players.show_cities_multiple(123456, 'Ref1', 'Ref2');
FETCH ALL IN "Ref1";

SELECT football_players.show_cities_multiple(123456, 'Ref1', 'Ref2');
FETCH ALL IN "Ref2"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:43:09.453

如果`first_table`和`second_table`具有相同的布局，您也可以只使用

```
SELECT * FROM first_table WHERE ...
UNION ALL
SELECT * FROM second_table WHERE ... 
```

**[编辑：感谢评论者（他的名字可能不是“null”:)）指出这`UNION ALL`比`UNION`.]**

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-16T15:40:08.227

是的。

例子：

```
test=# create function x () returns setof integer language plpgsql as $$ begin return next 1; return next 2; end $$;
CREATE FUNCTION
test=# select * from x();
 x 
---
 1
 2
(2 rows) 
```

您当然可以为返回的类型使用现有的表/视图或自定义类型。

使用语言 SQL 的示例：

```
test=# create table customer (name varchar, birth_date date);
CREATE TABLE
test=# create function y () returns setof customer language sql as $$ 
select * from customer
union all
select * from customer
$$;
CREATE FUNCTION
test=# insert into customer values ('joe', now()::date);
INSERT 0 1
test=# insert into customer values ('jill', now()::date);
INSERT 0 1
test=# select * from y();
 name | birth_date 
------+------------
 joe  | 2009-04-16
 jill | 2009-04-16
 joe  | 2009-04-16
 jill | 2009-04-16
(4 rows) 
```

[请参阅此处获取文档](http://www.postgresql.org/docs/current/interactive/sql-createfunction.html)

# jquery - 在一个 HTML 元素上应用多个 CSS 类 (jQuery addClass)

> ID：756697
> 
> 赞同：2
> 
> 时间：2009-04-16T15:34:19.507
> 
> 标签：jquery, html, css

鉴于此 HTML：

```
<html>
<head>
  <style type="text/css">
    tr.Class1
    {
      background-color: Blue;
    }
    .Class2
    {
      background-color: Red;
    }
  </style>
</head>
<body>
  <table>
    <tr id="tr1">
      <td>Row 1</td>
    </tr>
    <tr id="tr2">
      <td>Row 2</td>
    </tr>
  </table>
</body>
</html> 
```

下面是脚本部分。当我点击第一行时会发生什么？它会保持蓝色，还是会变成红色？如果它仍然是蓝色的，我如何让它变成红色而不是从行中删除 Class1 类（这样我可以稍后删除 Class2 类并且该行将恢复到原来的蓝色）？

```
<script type="text/javascript" language="javascript">

  $(document).ready(function() {
    $("#tr1").addClass("Class1");

    $("tr").click(function() {
      /* clicked tr's should use the Class2 class to indicate selection, but only one should be selected at a time */

      $(".Class2").removeClass("Class2");
      $(this).addClass("Class2");
    });
  });

</script> 
```

**编辑** 我应该说 - 我试过这个，但它没有按预期工作（在 FireFox 或 IE 中）。到底是怎么回事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:37:03.510

它应该变成红色...这就是为什么它被称为*级联*样式表...新添加的属性会覆盖旧的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:43:28.533

Mozilla[在这里](https://developer.mozilla.org/En/Common_CSS_Questions)说：

> 如果在两个规则中声明了相同的属性，则首先通过特异性解决冲突，然后根据 CSS 声明的顺序。类属性中的类顺序不相关。

但这不是我得到的行为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T16:00:29.770

试试这个：

```
 $("tr").click(function() {
  /* clicked tr's should use the Class2 class to indicate selection, but only one  should be selected at a time */

  $(".Class2").removeClass("Class2");
  $(this).toggleClass("Class1");
  $(this).addClass("Class2");
  $(this).toggleClass("Class1");
}); 
```

我不知道它是否会起作用，但也许它会给你更多的问题。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-16T17:09:15.847

弄清楚了。我举的例子有点不正确。CSS实际上看起来像：

```
tr.Class1
{
  background-color: Blue;
}
.Class2
{
  background-color: Red;
} 
```

因此，最具体的规则适用，就像 Mozilla 在[这里](https://developer.mozilla.org/En/Common_CSS_Questions)告诉我的那样：

> 如果在两个规则中声明了相同的属性，则首先通过特异性解决冲突，然后根据 CSS 声明的顺序。类属性中的类顺序不相关。

# sql - 多个数据库的计数语句问题

> ID：756711
> 
> 赞同：1
> 
> 时间：2009-04-16T15:38:33.833
> 
> 标签：sql

**对不起大家。看来我是个笨蛋！当我针对实时数据库和我的测试数据库运行查询时，查询工作正常......必须更加注意那些东西！**

我对下面显示的语句有疑问。如果我对一个数据库（没有 DBCATALOG.dbo）运行它，它工作正常，所以没有问题。当我尝试按原样运行该语句时，我在“<”附近得到一个不正确的语法。我还尝试使用一种工具为我们所有的数据库创建一个联合（参见第二条语句）。这会导致对象名称无效错误（无效对象名称“TF7-User-Demo-ScheduledRestore-03.dbo.LinkedDocumentFolderTable”、无效对象名称“TF7-TestDatabase-ScheduledRestore.dbo.LinkedDocumentFolderTable”等）。它似乎与 .[dbo] 相关联，但我只是不知道是什么导致了问题。我在书中找不到任何说明无法跨多个数据库执行计数的内容……。

```
SELECT CNT=COUNT(*)
FROM <DBCATALOG>.[dbo].[LinkedDocumentFolderTable]
WHERE IsUnmanagedFolder = 1

SELECT 'TF7-User-Demo-ScheduledRestore-03' AS DBCatalog, * FROM(SELECT COUNT(*)
FROM [TF7-User-Demo-ScheduledRestore-03].[dbo].[LinkedDocumentFolderTable]
WHERE IsUnmanagedFolder = 1)rsOne

UNION ALL

SELECT 'TF7-TestDatabase-ScheduledRestore' AS DBCatalog, * FROM(SELECT COUNT(*)
FROM [TF7-TestDatabase-ScheduledRestore].[dbo].[LinkedDocumentFolderTable]
WHERE IsUnmanagedFolder = 1)rsOne 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:46:56.963

你的语法似乎很奇怪。接下来试试：

```
SELECT 'TF7-User-Demo-ScheduledRestore-03' AS DBCatalog, COUNT(*) 
FROM [TF7-User-Demo-ScheduledRestore-03].[dbo].[LinkedDocumentFolderTable] 
WHERE IsUnmanagedFolder = 1 
```

您是否还设置了所有必要的权限？（我最好不要问，你在同一台服务器上是否有像 TF7-User-Demo-ScheduledRestore-03 这样的数据库？）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:44:37.313

我不完全确定您实际上要做什么，但是那些角 (< >) 和方 ([ ]) 括号在查询中无效。

您使用的是哪个数据库引擎？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:47:41.113

SQL Server 的引用标识符是您在其他地方使用的括号（“[”和“]”），而不是“<”和“>”，所以我猜这就是你收到第一个错误的原因。

数据库实际上是否命名为 TF7-User-Demo-ScheduledRestore-03 等？

此外，在从子查询中进行选择时，您需要确保子查询中的所有列都具有别名（如果它们还没有列名）。例如：

```
(SELECT COUNT(*) AS my_count) 
```

# .net - ASP.Net AJAX 没有创建 Javascript 类型

> ID：756712
> 
> 赞同：0
> 
> 时间：2009-04-16T15:38:46.407
> 
> 标签：.net, asp.net, asp.net-ajax, .net-2.0

我正在使用 ASP.Net AJAX，并在我的应用程序中创建了一个 Web 服务。该服务有一种方法 (AddWatchedFolder)，它采用 Name.Space.WatchedFolder 作为唯一参数。问题是，即使我已将服务添加到 ScriptManager，ASP.Net AJAX 也不会为 Name.Space.WatchedFolder 生成 javascript 类型。

我能够将参数类型更改为字符串，它工作得很好，但我不能将该业务对象用作参数，因为我不能从 javascript 创建它。

类 (Name.Space.WatchedFolder) 存在于单独的类库项目中，如果这有什么不同的话。

任何想法如何让它发挥作用？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-25T06:44:00.537

这就是 ASP.NET Ajax 的工作原理。您可以尝试将您的对象作为匿名 javascript 对象传递。JavaScript 序列化程序很可能会设法从提供的 JSON 中解析出您的自定义对象。这是一些代码：

ASMX：

```
[WebMethod]
public void MyMethod(MyObject arg)
{
   return arg.Property1 + arg.Property2;
} 
```

JavaScript：

```
var arg = { Property1 : "One", Property2 : "Two" };
MyNameSpace.MyService.MyMethod(arg); 
```

# c# - .Net Web 服务内存压力错误

> ID：756713
> 
> 赞同：1
> 
> 时间：2009-04-16T15:39:04.657
> 
> 标签：c#, web-services, memory-management, assemblies, clr

我有一个我想在我的一个网站上使用的网络服务。当我调用 Web 服务（在 C# 中创建）时，在尝试执行作为程序集创建的 SP 的几行中出现错误。此 Web 服务适用于我们的开发环境，但不能实时运行。我们的 live 和 dev 环境在同一台服务器上运行，但数据库不同。

错误是：

Sql 异常：由于内存压力，无法初始化公共语言运行时 (CLR) v2.0.50727。请在地址窗口扩展 (AWE) 模式下重新启动 SQL Server 以使用 CLR 集成功能。

在 live 和 dev 上都启用了 CLR。没有使用临时表。我相信它已经处于 AWE 模式。WSE 安装在服务器上，我使用的是 .Net 2.0

我试图在 Web 服务中调用的 SP 将字符串作为参数并返回一个字节 []。

Web 服务有大小限制吗？

有什么建议么？

编辑：我们正在使用 MSSQL 2005

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:31:41.007

老板不得不增加系统可用的 ram 数量，因为其中大部分都专用于 sql server。这解决了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:42:50.517

如果该过程在您的开发服务器上运行，我不得不说这不是系统的限制，因为它清楚地证明了工作。

恐怕这可能是在比较配置的每个盒子上爬过两个系统（IIS 和 SQL Server）的情况。我认为您收到的错误消息表明生产盒上未启用 AWE 模式，因此这是首先要检查的。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:43:06.800

此错误与 Web 服务无关，它是来自 Sql Server 的错误。如果您尝试在 Sql Management Studio 中运行 SP，您会看到同样的错误吗？

# php - 使用一个 GData 日历查询加载多个事件源

> ID：756714
> 
> 赞同：2
> 
> 时间：2009-04-16T15:39:17.497
> 
> 标签：php, zend-framework, rest, calendar, gdata-api

所以，我的问题是这样的......

我正在为我公司的 Intranet 门户构建一个简单的日历模块。我们使用 Google（适用于您的域的应用程序）日历，我想让员工能够在一个日历中查看他们订阅的所有提要 - 就像在真正的 Google 日历上一样！

我不只是使用他们提供的小工具的原因是因为我们想要一个单周视图。他们的小工具目前仅提供整月和“周议程”视图。所以，我们想要一个基本上看起来像完整日历中的一行（周）的周视图。我们已经制作了这样一个界面，现在我们只需要填充它。

我可以让它与一个提要一起工作。哎呀，我什至可以让它与用户订阅的所有提要一起工作。问题在于它是*sslllooowwwww*。据我所知，我可以从一个人订阅的每个提要中获取所有事件的唯一方法是循环浏览他们的提要列表并重新调用 Google 来询问*每个提要*的事件。嗯，很自然，如果一个人订阅了 12 个订阅源……这将需要很长时间。

可以帮助解决速度问题的一个想法是将结果存储在我们的数据库中，并为我们的 100 个提要中的每一个不时更新它。但是，这可能会减慢我们的服务器速度，因为由于提要的数量和检索每个提要所需的时间，它基本上会不断地查询谷歌。

**问题：** 有没有办法从提要列表中查询所有事件，而不是单独查询每个事件？任何帮助将不胜感激。

顺便说一句，我正在使用 PHP 和 Zend Gdata 独立库。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T17:15:00.317

我研究了这样做的技术，并发现了一种有趣的方法，人们正在使用[Yahoo Pipes](http://pipes.yahoo.com/pipes/ "雅虎管道")。查看[OUseful.info](http://ouseful.wordpress.com/2008/12/06/merging-several-calendar-ical-feeds-with-yahoo-pipes/ "OUseful.info")和[bavatuesdays](http://bavatuesdays.com/aggregating-google-calendars/ "巴瓦星期二")了解详细信息。我不确定这是否一定会解决您的速度问题。

如果我在 Java 中执行此操作，我将使用执行程序同时处理所有用户的提要请求。

也许您可以使用 ETags 和缓存来做一些事情？在[Google 日历 API 开发人员指南的](http://code.google.com/apis/calendar/docs/2.0/developers_guide_protocol.html "Google Calendar API Developer's Guide")[这一部分](http://code.google.com/apis/calendar/docs/2.0/developers_guide_protocol.html#RetrievingAllCalendars "谷歌日历 API 开发者指南")中，它显示了为用户日历列表中的每个条目返回的 etag 属性。该值可用于缓存日历。每当特定日历的 etag 发生变化时，都需要使用新请求刷新日历。这可以为您节省相当多的带宽。希望 Zend GData API 将这些元素公开给客户端代码。

# c# - StringDictionary 作为一个普通的静态列表？

> ID：756723
> 
> 赞同：2
> 
> 时间：2009-04-16T15:41:00.440
> 
> 标签：c#, stringdictionary

我想做的是有一个项目级的静态字典，这样我就可以从我的代码中的任何地方访问一个列表。

到目前为止，我想出了这个解决方案，一个带有公共属性的公共静态类：

```
public static class Common
{
    public static StringDictionary Domains
    {
        get
        {
            StringDictionary list = new StringDictionary();

            list.Add("212", "Location A");
            list.Add("555", "Location B");
            list.Add("747", "Location C");
            list.Add("000", "Location D");

            return list;
        }
    }
} 
```

我以这种方式使用（我用它来替换gridview中单元格的内容）：

```
if (Common.Domains.ContainsKey(e.Row.Cells[5].Text))
{
    e.Row.Cells[5].Text = Common.Domains[e.Row.Cells[5].Text];
}
else
{
    e.Row.Cells[5].Text = "n/a";
} 
```

但我不知道这是否是一个有效的解决方案，和/或是否有其他（更好的）方法可以做到这一点......有人可以给出提示吗？

在此先感谢，安德里亚。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T15:44:41.853

您可能不想在每次访问该属性时都重新创建该列表。将构造移动到静态构造函数中：

```
public static class Common
{
    private static StringDictionary _domains;
    static Common()
    {
        _domains = new StringDictionary();
        _domains.Add("212", "Location A");
        _domains.Add("555", "Location B");
        _domains.Add("747", "Location C");
        _domains.Add("000", "Location D");
    }
    public static StringDictionary Domains
    {
        get
        {
            return _domains;
        }
    }
} 
```

您应该知道，返回的字典不是只读的。所以这个类的客户端可以修改集合（例如添加/删除一些条目）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:44:24.350

每次你上车时，你的字典都会重新加载`Domains`

`list`配置一个静态构造函数，它将加载实例字典的只读静态副本并将其存储在内存中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:47:11.330

考虑改用单例模式：

[http://en.wikipedia.org/wiki/Singleton_pattern](http://en.wikipedia.org/wiki/Singleton_pattern)

这不是必须的，因为每个程序都有自己的特殊需求，我只建议您阅读此模式并重新考虑您的设计。

如果您的程序是多线程的，您可能想检查 StringDictionary 是否是线程安全的，如果它不是线程安全的（并且您的程序是多线程的），您应该为您的类添加一些同步机制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T19:24:38.687

@Jeff Fritz 在他的回答中是正确的，但我只想添加更多关于该字段在多个线程之间的共享访问。*StringDictionary*仅对读操作是线程安全的，而不是写操作，因此您需要注意不要在没有适当锁定的情况下修改此集合，并且您还需要在迭代集合时锁定该集合。

迭代：

```
lock(Common.Domains) {
    foreach(var domain in Common.Domains) {
    }
} 
```

要在静态构造函数*之外*添加域：

```
lock(Common.Domains) {
    Common.Domains.Add("111", "Location 3");
} 
```

通常，在通过静态字段共享非只读集合时，我会非常小心，以免修改该字段。您可能希望将*StringDictionary改为**ReadOnlyCollection*并将字段标记为“只读” ：

```
public static readonly ReadOnlyCollection<Pair<string, string>> domains 
```

你不会得到 O(1) 查找，但我假设这个集合会非常小，所以无论如何这都无关紧要。

# active-directory - DirectoryServices.AccountManagement“旧”密码在密码更改后仍然有效

> ID：756726
> 
> 赞同：6
> 
> 时间：2009-04-16T15:41:35.387
> 
> 标签：active-directory, directoryservices, account-management

在 Active Directory 中重置用户密码后，如果用户尝试使用旧密码登录，则以下代码验证为 True：

```
Dim up As UserPrincipal = GetAdUser(objContext, arg_strBA, arg_strUsername)

If up IsNot Nothing Then

    Dim valid As Boolean = up.Context.ValidateCredentials(
    up.UserPrincipalName, arg_strPassword, ContextOptions.Negotiate)

    If (valid) Then strReturn = up.SamAccountName

End If 
```

我们正在使用以下代码重置密码：

```
Dim objUser As New DirectoryEntry(arg_strLDAPPath)

If Not objUser Is Nothing Then
    objUser.AuthenticationType = AuthenticationTypes.Secure

    objUser.Invoke("SetPassword", arg_strNewPW)
    objUser.CommitChanges()
end if 
```

密码重置工作正常，用户可以使用他们的新密码登录，但他们的旧密码不应该仍然有效。

当上述 ValidateCredentials 适用于旧密码时，我们将凭据分配给 Web 服务调用，然后失败并出现“401：未授权”错误。

有人见过这样的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-02-06T10:33:22.437

这个问题与代码无关，但听到的罪魁祸首是活动目录......

请参阅[http://support.microsoft.com/kb/906305](http://support.microsoft.com/kb/906305)以获取解决方案...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:13:41.947

[我在这里](http://social.microsoft.com/Forums/ko-KR/netfxbcl/thread/7f6bec13-99d2-4523-847b-e667a156e075)找到了答案

从链接...

“但是，重要的是 ContextOption*不*确保仅使用 Kerberos。事实证明，在某些情况下（例如，如果您指定 AD 而不是本地，并且您有足够最新的服务器），无论如何代码都会选择进行协商。从这个意义上说，指定 Sealing 可能意味着它将使用 Kerberos，但不一定是唯一的。真正重要的旗帜被埋在它下面的好几层。在幕后，这个方法最终会建立一个 LdapConnection，为连接设置网络凭据，设置 AuthType（重要的实际标志！），最后调用 Bind() 方法。LdapConnection.Bind() 方法使用指定的凭据与其中一台 AD 服务器建立经过身份验证的连接。问题是当 PrincipalContext.ValidateCredentials 设置这个调用（在你的场景中）时，它*始终*设置 AuthType = Negotiate。在这种情况下，实际上 Kerberos 确实被使用了，但最终失败了，但系统回退到 NTLM。”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-01T17:59:19.130

这个作品 - 请参阅下面的解决方案 - 如果您觉得这有帮助，请告诉我，因为我们的商店对这是否是一个好的解决方案存在分歧。

以下是Active Directory允许旧密码更改后工作的解决方案。我非常希望收到有关接受此解决方案的反馈，因为它在登录身份验证期间使用 ChangePassword。这是一件奇怪的事情，但它确实有效。目前我们的商店没有使用这个解决方案，所以如果有人能告诉我他们是否正在使用它，那将不胜感激。

谢谢Ch

Active Directory 和旧密码返回有效（15 分钟到 +- 小时）。这在调用 SetPassword 或 ChangePassword 时发生。

历史：

我发现这被称为 AD 的“功能”，并且在设计上内置于 AD 中，因此当用户更改密码时，存在一种宽限期，允许使用这些密码的所有资源转移到新的资源。

支持 AD 知道最新密码这一概念的 AD 的一个示例是更改 PC 上的登录密码——在这种情况下，计算机将不允许旧密码登录。虽然我没有这个问题的答案（除了微软必须让它工作），但我认为这并不像 PC 所涉及的那样简单，而且它也有密码。

显示 AD 中的密码更改如何持续一段时间的一个示例可能是：

使用从 Windows 7 PC 到 Windows Server 2008 R2 机器的远程桌面。从 Windows 安全框登录，然后出现，单击确定框，单击确定，您已登录。现在将您用于远程的用户的密码更改为框（不同于您的柯克曼用户？？），注销并登录再次使用旧密码（在 15 分钟到一个小时 +- 的时间范围内）。旧密码将使您通过 Windows 安全框并进入 OK 框。当您单击确定时，它将失败。如果您从远程桌面重新开始并尝试输入错误密码，您将被阻止在 Windows 安全框并显示“登录尝试失败”消息。时间限制到期后，您将无法使用旧密码通过 Windows 安全框。（确保每次都从远程桌面开始，不要切换用户，这将按预期运行，这也表明 PC 以某种方式参与）。至少它没有用户登录 - 但这确实表明（似乎是 AD）在某个级别允许旧密码在某个级别进行身份验证。

研究：我发现了很多对这个问题的引用，只有一个潜在的解决方案，到目前为止我还无法确定我们是否可以实现它（这是对严格通过 Kerberos 调用而不是 NTLM 的引用，这并不像它可能会根据文档和我的研究出现）。我发现了很多关于如何在 .NET 中与 AD 交互的链接，但没有实际的 AD 手册。

SOLUTION SOLUTION SOLUTION - 如果您需要 SOLUTION SOLUTION，请阅读此部分！！！目前：我发现（在测试期间偶然发现）对 AD 的 ChangePassword 调用不允许传递给它的 OldPassword 成功地将密码更改为新密码。我认为这个有效的测试实际上并不为人所知，因为我没有找到任何关于它正在使用的参考。我实际上还没有找到任何解决这个问题的方法。一天凌晨 3:00，我意识到我可以利用 ChangePassword 的这种用法来解决这个问题——至少是一种我们可以立即使用的变通方法，直到我们可以确定更好的方法。

首先，我检查一切是否有效，然后 AD 返回密码有效。然后使用旧密码和新密码作为用户提供的密码（两者相同）调用 ChangePassword（用户名、旧密码、新密码）。我知道会发生两种结果之一（可能是三种，但违反密码策略会阻止它成功）。OldPassword 是好的并且我们失败是因为没有满足密码策略（历史，新密码不能是最后 N 个密码之一），或者我们失败是因为 Old Password 不正确（两者都作为异常错误返回，消息中带有文本）。我们检查最后一个条件，如果旧密码无效，我们不会让用户登录。

未来：也许第二双眼睛会有所帮助。
我认为解决方案是模拟或 Kerberos。我没有成功地找到足够的解决方案。很明显，AD 可以区分旧密码，因为 ChangePassword 可以做到这一点。我们正在做的是安全的核心，所以并不是所有的东西都是开放的（比如在 AD 中查看密码历史的能力，我还没有找到访问它的方法）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:43:37.143

您是否考虑到 AD 需要在整个网络中传播此类更改所需的长达 15 分钟的时间？

马克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T15:45:55.967

我假设您是在客户端计算机上执行的 ValidateCredentials。如果是这种情况，则它缓存了旧的（成功的）密码。这样做是为了让用户能够在 Active Directory 脱机或无法访问时登录。传播更改需要一些时间。

如果您想解决这个问题，您应该在身份验证时使用为 Web 服务提供服务的服务器而不是本地客户端计算机进行身份验证。

# c# - 覆盖 WebControl 上的控件集合

> ID：756740
> 
> 赞同：2
> 
> 时间：2009-04-16T15:44:13.960
> 
> 标签：c#, asp.net, controls, custom-server-controls

我正在尝试覆盖从 WebControl 继承的控件的 Controls 集合，以便当用户向 WebControl 添加控件时，我可以在它之前和之后放置按钮，并将其放入自己的包装器中。像这样的东西：

```
protected override ControlCollection Controls
{
    EnsureChildControls();
    return this._panel.Controls;
} 
```

但是，当我这样做时，子控件的视图状态由于某种原因没有得到维护。有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T15:58:14.207

ViewState 是与控件树并行构建的对象图，因此这些更改往往会产生您所描述的副作用。可以说您实际上是在劫持 Controls 对象并赋予它不同的含义，这并不是真正的覆盖意图。相反，覆盖是为了提供不同的机制来实现相同的含义或意图。*“我的一个孩子的*孩子控制”与*“我的孩子控制”*不同。

有更好的方法来完成你所描述的。一种可能是在您的控件上显式公开一个属性，该属性是用户应将其控件添加到的“区域”。如果目的是让它成为一个复杂的控件，它有一个可定制的区域，那么就暴露那个区域。

# batch-file - 来自批处理脚本的非模态通知框

> ID：756752
> 
> 赞同：1
> 
> 时间：2009-04-16T15:47:09.833
> 
> 标签：batch-file, notifications, alerts

我想要一个名为批处理文件的非模态警报框。目前我正在使用 vbscript 创建一个模态警报框：

```
>usermessage.vbs ECHO WScript.Echo^( "Generating report - this may take a moment." ^)
WSCRIPT.EXE usermessage.vbs 
```

但我想继续执行脚本（生成报告）而不等待用户交互。我怎样才能做到这一点？我不在乎它是否是 vbscript - 我只希望它在我的批处理脚本中工作（在 Windows XP 中）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-25T01:43:24.190

对当前技巧没有新要求的简单答案是使用`start`命令将脚本与批处理文件执行分离。

这可能看起来像：

```
>usermessage.vbs ECHO WScript.Echo^("生成报告 - 这可能需要一点时间。" ^)
启动 WSCRIPT.EXE usermessage.vbs
echo 这段文字代表了写报告的辛勤工作

```

唯一的区别是`start`用于运行`wscript`。这确实存在缺陷，即它会在当前目录中留下一个临时文件，并且最终需要手动关闭该框。

这两个问题都很容易处理：

```
@echo 关闭
设置本地
设置 msg="%TMP%\tempmsg.vbs"
ECHO WScript.Echo^("正在生成报告 - 这可能需要一点时间。" ^) >%msg%
启动 WSCRIPT.EXE /I /T:15 %msg%
echo 这段文字代表了写报告的辛勤工作
ping -n 5 127.0.0.1 >NULL
删除 %msg% >NUL 2>&1

```

在这里，我将临时脚本移到`%TMP%`文件夹中，并记住在完成后将其删除。我使用了一个`echo`和一个`ping`命令来浪费一些时间来演示一个长时间的进程运行。而且，我使用`/I`和`/T`选项来`wscript`确保脚本以“交互方式”运行并设置允许脚本运行的最长时间。

`@echo off`并`setlocal`使其在命令提示符下运行时看起来更干净，并防止它在提示符环境中留下名称 `%msg% 。

**编辑：** Johannes Rössel`setlocal`在评论中的批评是不正确的。如果在命令提示符下调用它，则没有`setlocal`变量 msg 将对提示符以及从该提示符启动的其他批处理文件和程序可见。`setlocal`如果一个人实际上编写的不仅仅是一次性脚本，那么使用隔离批处理文件中的局部变量是一种很好的做法。

这很容易证明：

```
C:> 输入 seta.bat
@set A=SomeValue

C：>设置A
ALLUSERSPROFILE=C:\Documents and Settings\所有用户
APPDATA=C:\Documents and Settings\Ross\Application Data

C:> seta.bat

C：>设置A
A=某个值
ALLUSERSPROFILE=C:\Documents and Settings\所有用户
APPDATA=C:\Documents and Settings\Ross\Application Data

C:>

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-11-11T19:54:18.867

我在同样的问题上苦苦挣扎，我有一个 VBScript 需要弹出一个消息框，但不能停止并继续。我想在一段时间后关闭。这对我有用。本质上，一个 vbscript 创建另一个 vbscript 文件，然后使用 shellexecute 执行该消息框文件，超时时间为 15 秒。

```
Set wshShell = CreateObject( "WScript.Shell" )
tmpPath = wshShell.ExpandEnvironmentStrings( "%TMP%" )
set wshShell = Nothing

msgFile = tmpPath & "\tempmsg.vbs"
Set fs = CreateObject("Scripting.FileSystemObject")
Set objFile = fs.CreateTextFile(msgFile,True)
objFile.Write "MsgBox " & chr(34) & "It worked!" & chr(34) & vbCrLf
objFile.Close
Set fs = Nothing

dim objShell
set objShell = CreateObject("shell.application")
objShell.ShellExecute "cscript.exe", "/I /T:15 " & (char34) & msgFile & chr(34), "", "open", 0
set objShell = Nothing 
```

# sql - SQL 更新 - 里面的一切 ()

> ID：756755
> 
> 赞同：2
> 
> 时间：2009-04-16T15:47:26.837
> 
> 标签：sql, sql-server, tsql, sql-server-2008

我有一列数据包含以下格式的字符串：

```
blablablabla(XYZ) 
```

我想丢弃 () 之外的所有内容 - 以及括号本身 - 并使用 () 内的值设置更新该字段。这意味着，在这种特殊情况下，“blablabla”将被丢弃，并且该条目将仅包含 XYZ。

我知道我必须使用 SQL UPDATE，但我不确定如何正确构建 where 条件。

非常感谢，哈尔

编辑：我忘了说它是在 SQL Server 2008 中。谢谢大家的回答，它们都有效（我测试过）。太糟糕了，我无法将所有标记都标记为正确。我真的很惊讶，答案都这么快。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T15:52:34.640

在`MySQL`：

```
UPDATE  mytable
SET     column = SUBSTRING(column, INSTR(column, '(') + 1, INSTR(column, ')') - INSTR(column, '(') - 1)
WHERE   column RLIKE ('\\(.*\\)') 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T15:56:33.367

这假设*恰好有一*对*正确嵌套*的括号（并且是 T-SQL 语法）：

```
DECLARE @bla VARCHAR(50)
SET @bla = 'blablablabla(XYZ)asdsdsad'

SELECT SUBSTRING(
         @bla, 
         CHARINDEX('(', @bla) + 1, 
         CHARINDEX(')', @bla) - CHARINDEX('(', @bla) - 1
       ) 
```

产量：

```
'XYZ' 
```

* * *

编辑：这会检查各种格式错误的字符串，并且可以在 WHERE 子句中使用（例如`WHERE ... <> 'no match'`）：

```
SELECT
  CASE 
    WHEN 
      /* check for '(' and ')' */
      CHARINDEX('(', @bla) > 0 AND CHARINDEX(')', @bla) > CHARINDEX('(', @bla)
      /* check for 'bla(bla(XYZ)bla' */
      AND CHARINDEX('(', @bla, CHARINDEX('(', @bla) + 1) = 0
      /* check for 'bla(XYZ)bla)bla' */
      AND CHARINDEX(')', @bla, CHARINDEX(')', @bla) + 1) = 0
    THEN SUBSTRING(@bla, 
          CHARINDEX('(', @bla) + 1, 
          CHARINDEX(')', @bla) - CHARINDEX('(', @bla) - 1
        ) 
    ELSE 'no match'
  END 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T15:57:08.827

MSSQL 解决方案。您正在寻找的功能是 CharIndex 简单表称为 test 包含一列称为 [name]

插入条目的代码

```
INSERT INTO TEST (name) VALUES ('SomeString(test1)')
INSERT INTO TEST (name) VALUES ('test2')
INSERT INTO TEST (name) VALUES ('SomeOtherString(test3)')
INSERT INTO TEST (name) VALUES ('test4') 
```

查找相关条目的 SQL 代码

```
SELECT *, 
    charindex('(', name), 
    charindex(')', name),
    substring(
        name,
        charindex('(', name) + 1,
        charindex(')', name) - charindex('(', name) - 1
    )
FROM 
    TEST 
WHERE 
    name like '%(%)%' 
```

用于更新条目的 SQL 代码

```
UPDATE 
    TEST
SET
    name = substring(
        name,
        charindex('(', name) + 1,
        charindex(')', name) - charindex('(', name) - 1
    )
WHERE
    name like '%(%)%' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T15:57:42.587

对于 sql 服务器

```
declare @x  varchar(100)

set @X= 'fgjfkfgkjz(12345)'
set @X= '()'
set @X= '(1234)'
set @X= 'fgjfkfgkjz()dfddf'
set @X= 'fgjfkfgkjz(123)dfddf'

PRINT '>>'+SUBSTRING(@x,CHARINDEX('(',@x)+1,CHARINDEX(')',@x)-(CHARINDEX('(',@x))-1)+'<<' 
```

更新命令：

```
UPDATE YourTable
    SET YourColumn=SUBSTRING(YourColumn,CHARINDEX('(',YourColumn)+1,CHARINDEX(')',YourColumn)-(CHARINDEX('(',YourColumn))-1)
    WHERE xxx=yyy 
```

# bash - bash 别名中的多个命令

> ID：756756
> 
> 赞同：260
> 
> 时间：2009-04-16T15:47:33.467
> 
> 标签：bash, configuration

我想定义一个连续运行以下两个命令的别名。

```
gnome-screensaver
gnome-screensaver-command --lock 
```

现在我已经添加了

```
alias lock='gnome-screensaver-command --lock' 
```

到我的 .bashrc 但由于我经常锁定我的工作站，因此只需键入一个命令会更容易。

* * *

## 回答 #1

> 赞同：473
> 
> 时间：2009-04-16T15:51:10.417

尝试：

```
alias lock='gnome-screensaver; gnome-screensaver-command --lock' 
```

或者

```
lock() {
    gnome-screensaver
    gnome-screensaver-command --lock
} 
```

在你的 .bashrc

第二种解决方案允许您使用参数。

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2009-04-17T02:42:07.200

其他答案充分回答了这个问题，但是您的示例看起来第二个命令取决于第一个命令是否成功退出。您可能想在别名 中尝试[短路评估：](http://en.wikipedia.org/wiki/Short-circuit_evaluation)

```
alias lock='gnome-screensaver && gnome-screensaver-command --lock' 
```

现在，除非第一个命令成功，否则甚至不会尝试第二个命令。[此SO question](https://stackoverflow.com/questions/89154/benefits-of-using-short-circuit-evaluation)中描述了对短路评估的更好描述。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-16T17:15:33.833

别名用于*别名*命令名称。除此之外的任何事情都应该用函数来完成。

```
alias ll='ls -l' # The ll command is an alias for ls -l 
```

别名是仍然与原始名称相关联的名称。 `ll`只是一种稍微具体的`ls`.

```
d() {
    if exists colordiff; then
        colordiff -ur "$@"
    elif exists diff; then
        diff -ur "$@"
    elif exists comm; then
        comm -3 "$1" "$2"
    fi | less
} 
```

函数是具有内部逻辑的新命令。它不仅仅是对另一个命令的重命名。它执行内部操作。

从技术上讲，Bash shell 语言中的别名在功能上非常有限，以至于它们非常不适合涉及多个**命令**的任何事情。使用它们对单个命令进行小改动，仅此而已。

由于目的是创建一个新命令来执行内部将在其他命令中解析的操作，因此唯一正确的答案是在此处使用函数：

```
lock() {
    gnome-screensaver
    gnome-screensaver-command --lock
} 
```

在这样的场景中使用别名会遇到很多问题。与作为命令执行的函数相反，别名被扩展为当前命令，当将此别名“命令”与其他命令组合时，这将导致非常意想不到的问题。它们也不适用于脚本。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-16T15:50:32.463

这不起作用吗？

```
alias whatever='gnome-screensaver ; gnome-screensaver-command --lock' 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-16T15:50:54.380

这将一个接一个地运行 2 个命令：

```
alias lock='gnome-screensaver ; gnome-screensaver-command --lock' 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-04-22T16:59:49.447

将我的 2 美分添加到 11 岁的讨论中试试这个：

`alias lock="gnome-screensaver \gnome-screensaver-command --lock"`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-05-21T21:02:55.443

将此功能添加到您`~/.bashrc`的终端并重新启动终端或运行`source ~/.bashrc`

```
function lock() {
    gnome-screensaver
    gnome-screensaver-command --lock
} 
```

这样，只要您`lock`在终端中输入，这两个命令就会运行。

在您的特定情况下，创建一个`alias`可能有效，但我不推荐它。直觉上，我们会认为别名的值与您在终端中输入值的运行方式相同。然而事实并非如此：

> 关于别名的定义和使用的规则有些混乱。

和

> 对于几乎所有目的，shell 函数都比别名更受欢迎。

因此，除非必须，否则不要使用别名。 [https://ss64.com/bash/alias.html](https://ss64.com/bash/alias.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-16T15:51:09.747

所以使用分号：

```
alias lock='gnome-screensaver; gnome-screen-saver-command --lock' 
```

如果您想为第一个命令提供参数，这将无法正常工作。或者，在 $HOME/bin 目录中创建一个简单的脚本。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-05-24T23:58:54.853

```
function lock() {
    gnome-screensaver
    gnome-screensaver-command --lock
} 
```

以上在 bash 中对我来说完美翻译为：

```
bottom() {
    clear
    printf '\n%.0s' {1..100}
}
alias c="bottom" 
```

* * *

我想要做的就是清除屏幕（`c` [别名](/questions/tagged/alias "显示标记为“别名”的问题")）并让 bash 提示出现在底部，而不是终端窗口的顶部。我很久以前就解决了这个问题（太久以前......忘记了我做了什么），但现在我已经把这个函数放在了 .bash_profile 中，它已经开始比赛了！现在，我也在执行该功能，以便在我打开一个新术语时。窗口，提示，并且只有提示，出现在底部。非常感谢您的建议。我不确定我是想念这种东西还是想念得到报酬……可能两者兼而有之。:-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-07-22T15:07:35.913

在 Windows 上，`Git\etc\bash.bashrc` 我使用（在文件末尾）

```
a(){
    git add $1  
    git status
} 
```

然后在 git bash 中简单地写

```
$ a Config/ 
```

# c# - 将多个 lambda 函数与高效执行相结合

> ID：756758
> 
> 赞同：3
> 
> 时间：2009-04-16T15:47:49.597
> 
> 标签：c#, lambda

我正在尝试使用 lambda 函数的组合创建一个动态过滤器。但是 lambda 函数的数量可能会根据用户应用的不同过滤器的数量而有所不同。

我想要这样的东西

```
//images is a List<ImageInfo>
var result1 = images
.Where(image => image.Bytes < 1000)
.Where(image => image.Height < 100)
.Where(image => image.Width < 100); 
```

高度过滤器仅适用于通过字节过滤器的那些图像。并且宽度过滤器仅适用于通过高度过滤器的那些图像。

但是，用户如何打开和关闭过滤器的动态方式不允许我创建单个 lambda 函数。

相反，我将创建一个 lambda 函数列表，然后需要将它们应用到图像列表中。所以我最终会得到这样的东西；多个单独的 lambda 函数。

```
var filter1 = images.Where(image => image.Bytes < 1000);
var filter2 = images.Where(image => image.Height < 100);
var filter3 = images.Where(image => image.Width < 100); 
```

如何将多个 lambda 函数连接在一起以获得过滤图像的最终列表？

我做了这个

```
var result = filter1.Intersect<ImageInfo>(filter2).Intersect<ImageInfo>(filter3); 
```

但是每个过滤器都会遍历主图像列表以获取其图像子集，然后进行交集计算，这会占用过多的 CPU。

所以我正在寻找的是一种获取任意 lambda 函数列表（表达式......无论如何）并以我展示的第一个示例的方式执行的方式加入它们的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T16:03:50.480

好的，怎么样：

```
static Func<T, bool> CombineWithAnd<T>(IEnumerable<Func<T, bool>> filters)
{
    return x =>
    {
        foreach (var filter in filters)
        {
            if (!filter(x))
            {
                return false;
            }
        }
        return true;
    };
} 
```

这就是你所追求的吗？基本上，它捕获了 lambda 表达式中的一组过滤器，并在使用返回的 lambda 时一个接一个地应用它们（通过短路）。显然你也可以用“或”的方式做同样的事情：

```
static Func<T, bool> CombineWithOr<T>(IEnumerable<Func<T, bool>> filters)
{
    return x =>
    {
        foreach (var filter in filters)
        {
            if (filter(x))
            {
                return true;
            }
        }
        return false;
    };
} 
```

请注意，如果在调用方法后修改了过滤器集合（例如，它是 a`List<T>`并且您添加了一个新过滤器），则返回的“组合”过滤器将反映这些更改。如果您不想要这种行为，请添加：

```
filters = filters.ToList(); 
```

作为方法的第一行，有效地取一个副本。请注意，委托是不可变的，因此您无需担心*它们*会发生变化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:38:41.333

哦太好了！你非常接近，但足够接近让我得到答案。要应用所有过滤器，`return true`需要移出 foreach 循环（如下所示）。但是，是的，这正是我正在寻找的。

一个问题，或评论。这个函数真正让我印象深刻的是 x 变量。我必须运行和调试代码才能确定 x 将是 type `<T>`。我以前从未见过没有类型或 var 声明的变量，这真的让我很震惊。你能解释一下允许变量 x 没有任何声明的 C# 规则吗？

顺便说一句，非常优雅的解决方案。

```
static Func<T, bool> CombineWithAnd<T>(IEnumerable<Func<T, bool>> filters)
{
    return x =>
    {
        foreach (var filter in filters)
        {
            if (!filter(x))
            {
                return false;
            }
        }
        return true;
    };
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T19:04:21.297

对于它的价值，你不需要使用循环。（在 Python 中，因为我没有使用过 C# :)

```
def conjoin(filter1, filter2):
    return lambda x: filter1(x) and filter2(x)

def conjoin_list(filters):
    return reduce(conjoin, filters) 
```

[（相当于 C# 中的 reduce 函数，在此处称为 fold。）](http://strangelights.com/blog/archive/2005/08/12/1198.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T15:53:42.253

你为什么不像第一个例子一样一个接一个地应用函数呢？

您的过滤器的签名为

```
Func<IEnumerable<ImageInfo>, IEnumerable<ImageInfo>> 
```

所以只需将每个过滤器应用于最后一个过滤器的结果？

像这样？

```
IEnumerable<ImageInfo> filtered = images;

if(filterByBytes)
    filtered = filtered.Where(image => image.Bytes < 1000);

if(filterByHeight)
    filtered = filtered.Where(image => image.Height < 100);

if(filterByWidth)
    filtered = filtered.Where(image => image.Width < 100); 
```

编辑回复：评论，从我的脑海中浮出水面，就像......

```
List<Func<IEnumerable<ImageInfo>, IEnumerable<ImageInfo>>> lambdas = new List<Func<IEnumerable<ImageInfo>, IEnumerable<ImageInfo>>>();

lambdas.add(x => x.Where(image => image.Bytes < 1000));
lambdas.add(x => x.Where(image => image.Height < 100));
lambdas.add(x => x.Where(image => image.Width < 100));

foreach(var lambda in lambdas)
    images = lamdba.Invoke(images); 
```

# regex - 如何使用正则表达式解析此 Amazon 错误报告？

> ID：756760
> 
> 赞同：0
> 
> 时间：2009-04-16T15:48:16.850
> 
> 标签：regex, amazon

当您向亚马逊提交产品提要时，它将返回一个错误报告，其中包含对不匹配产品的建议，如下所示：

```
18 998 8042 错误“SKU '998'ASIN B0001FSZ6K 'item_name' 商户值：'Promax Nutrition Promax Bar - Mocha Blast' 亚马逊目录值：'Promax Bars, Mocha Blast 12 bar'。ASIN B00024D3HQ 'manufacturer' 商户值：'Promax Nutrition 亚马逊目录价值：'PROMAX' 'item_name' 商家价值：'Promax Nutrition Promax Bar - Mocha Blast' 亚马逊目录价值：'Promax Gourmet Bar Mocha Blast 12 条'。

```

在此示例中，“商家价值：”是提交的内容，“亚马逊目录价值：”是紧密匹配的。

我正在尝试提取这些值，以便我们可以调整我们的提要提交并重新发送错误的项目。我已经破解了这个正则表达式：

```
(Merchant value\:) (')(.+?)(')( Amazon catalog value\: )(')(.+?)(ASIN) 
```

这几乎可以工作。我可以拉第 3 组和第 7 组，并拥有我的价值观……有时。不幸的是，一些建议看起来像：

```
Merchant value: 'Barleans' Amazon catalog value: 'Barlean's Organic Oils' 
```

所以滴答声会破坏比赛。我假设我可以将结束匹配更改为“'”并忽略“'s”，但我不确定我的正则表达式是否有效，而且我知道它很容易在极端情况下中断。

**编辑**以澄清：

我试图获得的数据是：

SKU（第一个示例中为 998）然后对于每个建议：字段（商品名称或制造商）我们的价值亚马逊的建议价值

所以它会像：

998 | 商品名 | Promax Nutrition Promax 酒吧 - 摩卡咖啡 | Promax Bars, Mocha Blast 12 酒吧

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:32:42.563

# tcp - TCP网络数据包什么时候会在应用层分片？

> ID：756765
> 
> 赞同：37
> 
> 时间：2009-04-16T15:49:49.500
> 
> 标签：tcp, network-programming, packet

TCP 数据包何时会在应用层分片？当一个应用程序发送一个 TCP 数据包时，应用程序层的接收者会收到两个或多个数据包中的数据包吗？如果是，是什么条件导致数据包被分割。似乎一个数据包在达到 1500 字节的以太网（在网络层）限制之前不会被分段。但是，由于网络层会在将数据包发送到下一层之前重新组装这些碎片，因此该碎片对于应用层的接收者来说是透明的，对吧？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-16T16:05:29.790

当它遇到 MTU 低于数据包大小的网络设备时，它将被拆分。大多数以太网设备是 1500，但它通常可以更小，例如 1492，如果该以太网由于额外的路由信息​​而通过 PPPoE (DSL)，如果添加第二层，例如 Windows Internet 连接共享，它甚至会更低。而拨号一般是576！

一般来说，尽管您应该记住*TCP 不是数据包协议*。它使用最底层的数据包通过 IP 传输，但就任何 TCP 堆栈的接口而言，它是一个流协议，不需要为您提供与发送或接收的物理数据包的 1:1 关系（例如，大多数堆栈将保留消息直到某个时间段到期，或者有足够的消息来最大化给定 MTU 的 IP 数据包的大小）

例如，如果您发送了两个“数据包”（调用您的发送函数两次），接收程序可能只收到 1 个“数据包”（接收 TCP 堆栈可能将它们组合在一起）。如果您通过 TCP 实现消息类型协议，则应在每条消息的开头包含一个标头（或其他一些标头/页脚机制），以便接收方可以将 TCP 流拆分回单独的消息，无论是当消息分两部分接收，或者当多个消息作为一个块接收时。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-16T16:06:52.533

分片对 TCP 应用程序应该是透明的。请记住，TCP 是一种流协议：您得到的是数据流，而不是数据包！如果您基于完整数据包的概念构建应用程序，那么您将遇到问题，除非您添加一个抽象层来组装来自流的整个数据包，然后将数据包传递给应用程序。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-04-20T20:50:59.117

这个问题做了一个不正确的假设——TCP 不会将数据包传送到它的端点，而是发送一个字节流（八位字节）。如果应用程序将两个字符串写入 TCP，它可能会在另一端作为一个字符串传递；同样，一个字符串可以作为两个（或更多）字符串传递到另一端。

[RFC 793](http://www.faqs.org/rfcs/rfc793.html)，第 1.5 节：

> “通过将一些八位组打包成段以通过互联网系统传输，TCP 能够在其用户之间的每个方向上传输连续的八位组流。”

关键词是八位字节（字节）**的连续流。**

[RFC 793](http://www.faqs.org/rfcs/rfc793.html)，第 2.8 节：

> “推送功能和段边界之间没有必然的关系。任何特定段中的数据可能是单个 SEND 调用的结果，全部或部分，或多个 SEND 调用的结果。”

2.8 节的全部内容都是相关的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-16T15:59:22.567

在应用层，有很多原因导致整个 1500 字节可能无法显示一次读取。内部操作系统和 TCP 堆栈中的各种因素可能会导致应用程序在一次读取调用中获取一些字节，而在下一次读取调用中获取一些字节。是的，TCP 堆栈必须在发送数据包之前重新组装数据包，但这并不意味着您的应用程序会一次性获得所有数据（很可能会一次读取，但不能保证一口气读完）。

TCP 试图通过错误检查、自动重新发送等来保证字节的有序传递，等等。把它想象成应用层的管道，不要太纠结于堆栈实际上是如何通过网络发送它的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T15:53:09.290

如果一个数据包超过了网络设备的最大[MTU](http://en.wikipedia.org/wiki/Maximum_transmission_unit)，它将被分成多个数据包。（注意大多数设备设置为 1500 字节，但这不是必需的。）

数据包的重建对应用程序应该是完全透明的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T15:54:54.933

不同的网段可以有不同的 MTU 值。在这种情况下，可能会出现碎片。有关详细信息，请参阅[TCP 最大段大小](http://en.wikipedia.org/wiki/Transmission_Control_Protocol#Maximum_segment_size)

这种（去）碎片化发生在 TCP 层。在应用层没有更多的数据包。TCP 向应用程序提供一个连续的数据流。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-06T06:44:19.513

“应用层”一个 TCP 数据包（嗯，真的是分段；TCP 在它自己的层不知道数据包）永远不会分段，因为它不存在。应用层是您将数据视为字节流的地方，可靠且有序地传递。

如果您不考虑它，那么您可能以错误的方式处理某些事情。然而，这并不是说在此之上可能没有一层，例如，通过这个可靠的有序字节流传递的消息序列。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-04-28T23:36:03.937

[此](http://blog.netherlabs.nl/articles/2009/01/18/the-ultimate-so_linger-page-or-why-is-my-tcp-not-reliable)页面是有关其他人提出的一些问题的良好信息来源，即需要基于应用程序协议在应用程序协议上进行数据封装在您描述的意义上不是很权威，但它有示例并且来自一些网络编程中的大牌。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T15:53:30.660

正确 - 了解这一点的最有用的方法是使用[Wireshark](http://www.wireshark.org/)，这是一个非常宝贵的工具。花点时间弄清楚 - 救了我好几次，并提供了一个很好的现实检查

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-16T15:52:47.357

如果一个 3000 字节的数据包进入默认 MTU 大小为 1500（对于以太网）的以太网网络，它将被分成两个长度为 1500 字节的数据包。这是我唯一能想到的。

Wireshark 是检查这一点的最佳选择。我已经使用了一段时间并且印象深刻

# sql - 在 SQL Server 2005 的比较测试中处理空值

> ID：756777
> 
> 赞同：1
> 
> 时间：2009-04-16T15:51:52.100
> 
> 标签：sql, sql-server, tsql

我今天正在编写一个存储过程，我遇到了一个问题，如果其中一个值为 null（无论是来自`SELECT`语句还是传入的参数），我的表达式将评估为 false，而它应该评估为真的。

```
SET ANSI_NULLS ON;
DECLARE @1 INT;
DECLARE @2 INT;
DECLARE @3 INT;
DECLARE @4 INT;

SET @1 = 1;
SET @2 = NULL;
SET @3 = 3;
SET @4 = 3;

IF ((@1 <> @2) OR (@3 <> @4))
   BEGIN
     SELECT 1;
   END
ELSE
   BEGIN
     SELECT 2;
   END
SELECT @1, @2, @3, @4 
```

回报：

```
2

1, NULL, 3, 3 
```

我希望它会返回：

```
1

1, NULL, 3, 3 
```

我知道我错过了一些简单的东西，有人知道它是什么吗？

### 相关问题

> [SQL：为什么在此子句中`NULL`过滤掉值？`WHERE`](https://stackoverflow.com/questions/683627/sql-why-are-null-values-filtered-out-within-this-where-clause/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T15:55:51.450

处理此问题的一种方法是您可以将您的`NULL`值包装在一个已知的意外值中，即`-1`：

```
IF ((ISNULL(@1, -1) <> ISNULL(@2, -1)) OR (ISNULL(@3, -1) <> ISNULL(@4, -1)))
   BEGIN
     SELECT 1;
   END
ELSE
   BEGIN
     SELECT 2;
   END 
```

显然，如果`-1`有可能，则使用不同的数字。如果没有不可能的值，那么您将不得不使用`CASE`语句。

`NULL`将值分配给“安全”值的简洁方法如下：

> `SET @1 = ISNULL(@1, -1)`

这允许条件测试代码保持“整洁”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T15:56:05.163

任何涉及 NULL 的比较都将评估为 NULL 而不是 True 或 False。因此，您的代码的 ELSE 块被执行。因为虽然 Null 与 False 不同，但它绝对与 True 不同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T15:57:57.827

是的，空值是一种痛苦。处理它们的几种方法。其中一些是 MS-SQL 特定的函数：

方法1：对所有选项都非常明确

```
IF ((@1 <> @2) 
OR (@1 is NULL AND @1 IS NOT NULL)
OR (@1 is NOT NULL AND @1 IS NULL)
OR (@3 <> @4)
OR (@3 is NULL AND @4 IS NOT NULL)
OR (@3 is NOT NULL AND @4 IS NULL)) 
```

方法 2：使用函数将 null 更改为您知道不匹配的其他内容：

```
IF ((IsNull(@1,-1) <> IsNull(@2,-1) 
OR (IsNull(@3,-1) <> IsNull(@4,-1)) 
```

有时第一个选项更好，因为它更明确。第二个具有将 NULL 与 NULL 匹配的副作用。

编辑：如果您想提前设置它们，只需执行

```
SET @1 = IsNull(@1,-1); 
```

如果为空，则将其设置为-1。如果没有，它将不理会它。根据我的方法 2，我认为在函数内部执行此操作更清洁。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T17:27:34.693

这是一种没有功能的方法，也可能更容易阅读。（当我看到一堆 NULL 测试函数靠在一起时，我的眼睛开始交叉。）

```
IF (@1 IS NULL AND @2 IS NULL) OR (@1 = @2)
BEGIN
    IF (@3 IS NULL AND @4 IS NULL) OR (@3 = @4) 
    BEGIN
        SELECT 2
    END
    ELSE
    BEGIN
        SELECT 1
    END
END
ELSE
BEGIN
    SELECT 1
END 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T19:46:20.447

如果您想更加困惑，请尝试运行相反的测试，如下所示：

```
SET ANSI_NULLS ON;
DECLARE @1 INT;
DECLARE @2 INT;
DECLARE @3 INT;
DECLARE @4 INT;
SET @1 = 1;
SET @2 = NULL;
SET @3 = 3;
SET @4 = 3;
IF ((@1 = @2) AND (@3 = @4))
   BEGIN     SELECT 1;
   ENDELSE   
   BEGIN     SELECT 2;   
   END
SELECT @1, @2, @3, @4 
```

结果不会是您对先前实验的期望。

原因是 SQL 在评估可能包含 NULL 的表达式时会涉及复杂的三值逻辑。

NULL = 3 不正确。它也不是 FALSE。它是空的。NULL = NULL 不是 TRUE。它也不是 FALSE。它是空的。

这很容易混淆。避免混淆的最佳方法是将所有关键数据限制为 NOT NULL。但是，要求可能会阻止您这样做，在这种情况下，您只需要弄清楚 3 值逻辑，SQL 风格。

不要让我为这一点辩护。

（在某些环境中，对于非 TRUE 或 FALSE 的结果，使用 UNKNOWN 代替 NULL。）

# flash - 从 html 里面传递字符串 into Actionscript I have a flash movie that is being used for several websites. On each site I would like to specify a different XML file inside the markup. How do I grab that string and use it in ActionScript? 问问题 问问题 2009-04-16T15:53:06.887 874 次 This question shows research effort; it is useful and clear 1 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. I have a flash movie that is being used for several websites. On each site I would like to specify a different XML file inside the markup. How do I grab that string and use it in ActionScript? in markup i want to do this: <object ... <param name=FlashVars value="urlXML=myXML.xml" /> </object> in actionscript 3.0, im trying to do this: var urlXML=_root.urlXML; Currently when I do this, I get an error in output saying 'access of undefined property...' How am i supposed to grab that string? Note: Adobe KB article FlashVars must be assigned in both the OBJECT and EMBED tags in order to work on all browsers. flashactionscript-3variables 4 4 回答 4 This answer is useful 1 That isn't how you access FlashVars in AS3\. You need the root loaderInfo's parameter property, that houses any FlashVars that were tacked on. var urlXML: String = root.loaderInfo.parameters.urlXML; 于 2009-04-16T20:08:08.770 回答 This answer is useful 0 My first response... so here goes: I have a small video player application I developed for McGill University Alumni. You can see it here: http://www.alumni.mcgill.ca/esol/holiday/2008/flash.php?giftCode=123456 It picks up a 'Gift Code' from the URL but you can always hard-code your .xml file. Here are the object and embed (s) I use: <embed src="mcgill_annual_fund200903.swf**?giftCode=<?php echo $giftCode; ?>**" quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" width="680" height="550"></embed> And with the .js embed script: <script type="text/javascript"> AC_FL_RunContent( 'codebase','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0','width','680','height','550','src','mcgill_annual_fund200903**?giftCode=**','quality','high','pluginspage','http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash','movie','mcgill_annual_fund200903?giftCode=','wmode','transparent' ); //end AC code And then to retrieve the info in AS3: //get the giftCode var gCode:String; var giftCode:String; function loaderComplete(lEvent:Event){ gCode = loaderInfo.loaderURL; giftCode = gCode.substr((gCode.indexOf("?giftCode=")+10)); //giftCodeTxt.text= giftCode; } 于 2009-04-18T23:34:48.320 回答 This answer is useful 0 注意：Adobe 知识库 文章 FlashVars 必须在 OBJECT 和 EMBED 标记中分配，以便在所有浏览器上工作。 于 2009-04-16T16:00:49.037 回答 This answer is useful -1 It should just be there--you don't need the _root. See this. 于 2009-04-16T16:00:54.793 回答 Related 1 java - Swing：JScrollPane 导致渲染问题 3 android - 如何膨胀自定义视图类？ 2 string - 什么样的编码器编码这样的字符串？ 2 xml - XSLT - 用于组合两个函数的内连接类型命令 1 iphone - 可达性是否/可以不断更新互联网连接状态？ 1 javascript - 将 Sequelize 连接到使用 Homebrew 安装的 Postgres 2 c++ - 布尔值被初始化为真，即使构造函数被传递为假 1 javascript - 使用 angular.module 创建控制器有什么好处（如果有的话）？ 1 android - Android 意图发送电子邮件，显示电子邮件帐户以外的资源 3 python - 如果互联网出现故障，请重新启动 python 脚本 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：756782
> 
> 赞同：1
> 
> 时间：
> 
> 标签：flash, actionscript-3, variables

I have a flash movie that is being used for several websites. On each site I would like to specify a different XML file inside the markup. How do I grab that string and use it in ActionScript?

in markup i want to do this:

```
<object ...
   <param name=FlashVars value="urlXML=myXML.xml" />
</object> 
```

in actionscript 3.0, im trying to do this:

```
var urlXML=_root.urlXML; 
```

Currently when I do this, I get an error in output saying 'access of undefined property...' How am i supposed to grab that string?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:08:08.770

That isn't how you access FlashVars in AS3\. You need the root loaderInfo's parameter property, that houses any FlashVars that were tacked on.

```
 var urlXML: String = root.loaderInfo.parameters.urlXML; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T23:34:48.320

My first response... so here goes:

I have a small video player application I developed for McGill University Alumni. You can see it here: [http://www.alumni.mcgill.ca/esol/holiday/2008/flash.php?giftCode=123456](http://www.alumni.mcgill.ca/esol/holiday/2008/flash.php?giftCode=123456) It picks up a 'Gift Code' from the URL but you can always hard-code your .xml file.

Here are the object and embed (s) I use:

```
<embed src="mcgill_annual_fund200903.swf**?giftCode=<?php echo $giftCode; ?>**" quality="high" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" width="680" height="550"></embed> 
```

And with the .js embed script:

```
<script type="text/javascript"> 
```

AC_FL_RunContent( 'codebase','[http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0](http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0)','width','680','height','550','src','mcgill_annual_fund200903**?giftCode=**','quality','high','pluginspage','[http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash](http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash)','movie','mcgill_annual_fund200903?giftCode=','wmode','transparent' ); //end AC code

And then to retrieve the info in AS3:

```
//get the giftCode
var gCode:String;
var giftCode:String;
function loaderComplete(lEvent:Event){
    gCode = loaderInfo.loaderURL;
    giftCode = gCode.substr((gCode.indexOf("?giftCode=")+10));
    //giftCodeTxt.text= giftCode;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T16:00:49.037

注意：Adobe 知识库 [文章](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_16417)

> FlashVars 必须在 OBJECT 和 EMBED 标记中分配，以便在所有浏览器上工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-16T16:00:54.793

It should just be there--you don't need the _root. See [this](http://blog.circlecube.com/2008/05/22/flashvar-tutorial/).

# javascript - Javascript 捕获密钥

> ID：756786
> 
> 赞同：6
> 
> 时间：2009-04-16T15:53:31.707
> 
> 标签：javascript

我正在尝试使用 javascript 从文本区域捕获输入键。问题是，虽然我能够发现按下了“回车”键，但我无法避免它进入 textarea。我不希望在文本区域中显示回车键，即“\n”。

关于如何实现这一目标的任何建议？

谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T15:56:13.867

尝试将此函数设置为文本区域的 onKeyDown 事件：

前任： `onkeydown="javascript:return fnIgnoreEnter(event);"`

```
function fnIgnoreEnter(thisEvent) {
  if (thisEvent.keyCode == 13) { // enter key
    return false; // do nothing
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-09-05T21:20:08.667

更新和更清洁：使用`event.key`而不是`event.keyCode`. **没有更多的任意数字代码！**

```
function onEvent(event) {
    if (event.key === "Enter") {
        return false;
    }
}; 
```

[Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key)

[支持的浏览器](http://caniuse.com/#feat=keyboardevent-key)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T16:35:18.860

即使您阻止输入按钮，他们仍然可以粘贴换行符。这将阻止输入按钮，并删除任何进入的换行符和回车符（仅在 FF 上尝试过，并且对此进行了最少的考虑 - 它可能无法在 Safari 或 IE 上按原样工作）。

```
<textarea rows="20" cols="50" onkeydown="return ignoreEnter(event);" onkeyup="noEnter(this);"></textarea>
<script type="text/javascript">
function ignoreEnter( event ) {
 return thisEvent.keyCode != 13; // enter key
}

function noEnter( e ) {
 e.value = e.value.replace(/\n/g,'');
 e.value = e.value.replace(/\r/g,'');
}
</script> 
```

# java - Java PriorityQueue 去除任意元素的性能

> ID：756790
> 
> 赞同：7
> 
> 时间：2009-04-16T15:53:56.620
> 
> 标签：java, performance, collections, queue

假设我有一个 java PriorityQueue（java 实现为堆），我根据某些标准对其进行迭代以删除元素：

```
PriorityQueue q = new PriorityQueue();
...
Iterator it = q.iterator();
while(it.hasNext()){
    if( someCriterion(it.next()) )
        it.remove();
} 
```

每个 remove() 操作需要多长时间？我不确定是 O(log(n)) 还是 O(1)。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T15:58:53.067

~~如果您使用的是 Sun 实现，则它是`O(log(n))`.~~ 从[Javadocs](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html)：

> 实现说明：此实现为入队和出队方法（ `offer`、`poll`和）提供 O(log(n)) 时间；和 方法的线性时间；检索方法（、和）的固定时间。`remove()``add``remove(Object)``contains(Object)``peek``element``size`

其他实现可能具有不同的复杂性。

* * *

**编辑：** Javadocs 没有涵盖使用迭代器删除元素的性能，所以我不得不查找源代码。这都与 Sun 的实现相关，并且可能在 Apple 的版本、GNU Classpath 等方面有所不同。 Sun 的源代码可[在此处](http://download.java.net/jdk6/)获得；它也包含在 JDK 中，因此您可能已经安装了它。

在`PriorityQueue`的迭代器中，默认情况`remove()`是调用`PriorityQueue.removeAt(lastRet)`，其中`lastRet`是最后一次返回的索引`next()`。`removeAt()`似乎是`O(log(n))`最坏的情况（它可能必须筛选队列，但不必迭代）。

但是，有时会发生不好的事情。从以下评论`removeAt()`：

```
/**
 * Removes the ith element from queue.
 *
 * Normally this method leaves the elements at up to i-1,
 * inclusive, untouched.  Under these circumstances, it returns
 * null.  Occasionally, in order to maintain the heap invariant,
 * it must swap a later element of the list with one earlier than
 * i.  Under these circumstances, this method returns the element
 * that was previously at the end of the list and is now at some
 * position before i. This fact is used by iterator.remove so as to
 * avoid missing traversing elements.
 */ 
```

当返回一个非空元素时`removeAt()`，迭代器将它添加到一个特殊的队列中供以后使用：当迭代器用完队列中的元素时，它会遍历这个特殊的队列。当`remove()`在迭代的第二阶段调用时，迭代器调用`PriorityQueue.removeEq(lastRetElt)`，其中`lastRetElt`是从特殊队列返回的最后一个元素。`removeEq`被迫使用线性搜索来找到要删除的正确元素，这使得`O(n)`. 但是它可以使用`==`而不是检查元素`.equals()`，因此它的常数因子低于`PriorityQueue.remove(Object)`。

因此，换句话说，使用迭代器删除在技术上是`O(n)`，但实际上它应该比`remove(Object)`.

# javascript - 如何修改 ActiveXObject JS 构造函数？

> ID：756792
> 
> 赞同：5
> 
> 时间：2009-04-16T15:54:02.423
> 
> 标签：javascript, ajax, binding, proxy

我需要包装一个 IE ajax 请求，以便在它发生时通知我。即我需要知道何时调用 open ：

var xhr = new ActiveXObject("Microsoft.XMLHTTP");

这样做的唯一方法（我认为）是实现 ActiveXObject 构造函数来代理对真实构造函数/对象的打开调用。你能帮我做吗？

另外：我不需要创建实际的 xhr 对象，所以请不要告诉我使用 X 框架，因为它很容易。

我只需要知道何时在 MS xhr 对象上调用**open （不是由我的代码）。**

非常感谢你！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T16:45:18.473

由于 OP 发布了一个类似的问题，并且我发布了一个恰好适合*这个*问题的答案，他让我链接到我的答案，而不是在这里重复。

*   问：[在 javascript 中扩展 ActiveXObject](https://stackoverflow.com/questions/797960/extending-an-activexobject-in-javascript)
*   A:[一个插入式透明包装`MSXML2.XMLHTTP`](https://stackoverflow.com/questions/797960/extending-an-activexobject-in-javascript/798611#798611)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:53:06.540

也许你可以尝试这样的事情：

```
XMLHttpRequest.prototype.real_open = XMLHttpRequest.prototype.open;

var your_open_method = function(sMethod, sUrl, bAsync, sUser, sPassword) { 
  alert('an XHR request has been made!');
  this.real_open(sMethod, sUrl, bAsync, sUser, sPassword); 
} 

XMLHttpRequest.prototype.open = your_open_method; 
```

当然，您可以拥有自己的跟踪代码，而不是警报。我试过了，它适用于“普通 javascript”请求以及使用 jquery 发出的请求。我认为无论用于提出请求的框架如何，它都应该起作用。

**编辑 4 月 21 日** 我真的不知道如何扩展 ActiveXObject。我的猜测是这样的事情应该有效：

```
XHR = new ActiveXObject("Microsoft.XMLHTTP");
var XHR.prototype.old_open = XHR.prototype.open;
var new_open = function(sMethod, sUrl, bAsync, sUser, sPassword) { 
  alert('an IE XHR request has been made!');
  this.old_open(sMethod, sUrl, bAsync, sUser, sPassword); 
} 

XHR.prototype.open = new_open; 
```

不幸的是（或者可能没有）我没有 IE，所以我无法测试它。但是试一试，让我知道它是否成功了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T14:09:23.980

没有什么“为了得到真实的对象”它是真实的对象！

听起来你正在寻找这个家伙正在做的事情......

[http://www.adobepress.com/articles/article.asp?p=439600](http://www.adobepress.com/articles/article.asp?p=439600)

```
document.write("<script type=\"text/javascript\" src=\"js/HTTP.js\"></script>");

function Ajax()
{
  this.toString = function() { return "Ajax"; }
  this.http = new HTTP();

  this.makeRequest = function(_method, _url, _callbackMethod)
  {
    this.request = (window.XMLHttpRequest)? new XMLHttpRequest(): new ActiveXObject("MSXML2.XMLHTTP");
    this.request.onreadystatechange = _callbackMethod;
    this.request.open(_method, _url, true);
    this.request.send(_url);
  }

  this.checkReadyState = function(_id, _1, _2, _3)
  {
    switch(this.request.readyState)
    {
      case 1:
        document.getElementById(_id).innerHTML = _1;
        break;
      case 2:
        document.getElementById(_id).innerHTML = _2;
        break;
      case 3:
        document.getElementById(_id).innerHTML = _3;
        break;
      case 4:
        return this.http.status(this.request.status);
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T14:36:47.613

这一直对我有用。

```
var xmlHttp;

function yourajaxfunction(str)
{ 
   xmlHttp=GetXmlHttpObject();
   if (xmlHttp==null){
      alert ("Browser does not support HTTP Request");
      return;
   }

   var url="yourserversidecodefile.php";
   url=url+"?q="+str;

   xmlHttp.onreadystatechange=stateChanged;
   xmlHttp.open("GET", url, true);
   xmlHttp.send(null);
}

function stateChanged() { 
   if (xmlHttp.readyState==4 || xmlHttp.readyState=="complete"){ 
      document.getElementById("txtHint").innerHTML=xmlHttp.responseText;
   } 
}

function GetXmlHttpObject(){
   var xmlHttp=null;

   try {
      // Firefox, Opera 8.0+, Safari
      xmlHttp=new XMLHttpRequest();
   }
   catch (E1) {
      //Internet Explorer
      try {
         xmlHttp=new ActiveXObject("Msxml2.XMLHTTP");
      }
      catch (E2) {
         xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
   }

   return xmlHttp;
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-16T16:09:44.663

我建议您将[jQuery](http://jquery.com/)用于 AJAX 。它非常小但非常灵活和快速的框架。在此处查看[文档](http://docs.jquery.com/Ajax)。

# c# - 使用 C# Express 版本的 Compact Framework 开发

> ID：756795
> 
> 赞同：3
> 
> 时间：2009-04-16T15:55:01.110
> 
> 标签：c#, compact-framework, visual-studio-express

我想知道是否可以使用 C# Express 版本进行 Compact Framework 开发。我做了一些谷歌搜索，但我找不到一个挑衅的答案。我已经安装了 C# Express，但没有可供选择用于“智能设备”开发的项目模板。我将继续搜索，但我希望 stackoverflow 社区能够帮助查找此信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T15:59:56.543

我不认为这是可能的，至少不是直接的，因为 C# Express 版本被削弱为仅支持基本项目并且不允许插件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-29T17:21:44.627

要进行 CF 开发，您需要运行时和编译器。这些作品附带以下内容：

*   Visual Studio 2003 Professional 或更高版本
*   Visual Studio 2005 标准版或更高版本
*   Visual Studio 2008 Professional 或更高版本

Microsoft 尚未宣布您在版本 10 中需要什么级别的 Studio 才能拥有智能设备功能（我们一直在推动低成本或免费版本）。也就是说，您仍然可以使用以下程序之一以相当低的成本进入 Studio：

*   [授权 ISV](https://partner.microsoft.com/40011351)
*   [梦想火花](http://www.dreamspark.com)
*   [商务火花](http://www.microsoft.com/bizspark)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T16:07:52.170

您必须使用像 ShapDevelop 这样的第三方 IDE。Visual Studio Express Editions 不支持 Compact Framework，但即使有这些支持也可能是不稳定的。

嗯...基于此链接，它可能只工作了几周：
[http ://wiki.sharpdevelop.net/Default.aspx?Page=CompactFrameworkDevelopment&AspxAutoDetectCookieSupport=1](http://wiki.sharpdevelop.net/Default.aspx?Page=CompactFrameworkDevelopment&AspxAutoDetectCookieSupport=1)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-23T05:38:29.417

是的，这是可能的——即使是视觉形式设计。您只需将 .NET CF 程序集下载到 PC，然后手动构建项目，禁用默认程序集并使用 /r: 命令开关加载 CF 程序集。

使用谷歌，这种方法在一篇文章中有更好的描述。

最好的问候——幽灵。

# javascript - 返回包含 HTML 和 JavaScript 的 PartialView

> ID：756797
> 
> 赞同：3
> 
> 时间：2009-04-16T15:55:33.323
> 
> 标签：javascript, asp.net-mvc, ajax

我正在进行 AJAX 调用（使用 jQuery）来检索`PartialView`. 除了 HTML，我还想发回 View 正在显示的对象的 JSON 表示。我一直在使用的糟糕方法是将属性作为隐藏输入嵌入到 HTML 中，这很快就会变得笨拙并且紧密耦合了太多东西。

我可以在`<script>`HTML 之后的标签中发送 JavaScript，但我真的很讨厌将这些东西分开。看起来像这样：

```
<%@ Control Language="C#" AutoEventWireup="true" Inherits="System.Web.Mvc.ViewUserControl<Person>" %>
<div class="person">
  First Name: <%= Html.TextBox("FirstName", Model.FirstName) %>
  Last Name: <%= Html.TextBox("LastName", Model.LastName) %>
</div>
<script type="text/javascript">
  // JsonSerialized object goes here
</script> 
```

我考虑的另一个选择是对返回的操作进行第二次 AJAX 调用`JsonResult`，但这也感觉像是糟糕的设计。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T22:50:56.370

我想我找到了一个很好的方法来做到这一点，只需将其包装`JSON`在`HtmlHelper`扩展中即可。这是课程：

```
using System.Web.Script.Serialization;

public static class JsonExtensions {
    public static string Json(this HtmlHelper html, string variableName) {
        return Json(html, variableName, html.ViewData.Model);
    }

    public static string Json(this HtmlHelper html, string variableName, object model) {
        TagBuilder tag = new TagBuilder("script");
        tag.Attributes.Add("type", "text/javascript");
        JavaScriptSerializer jsonSerializer = new JavaScriptSerializer();
        tag.InnerHtml = "var " + variableName + " = " + jsonSerializer.Serialize(model) + ";";
        return tag.ToString();
    }
} 
```

你通过以下方式调用它：

```
<%= Html.Json("foo") %>
<%= Html.Json("bar", Model.Something) %> 
```

我能想到的一个问题是它不是一个完全*完美*的分离。您仍然在技术上将 JavaScript 放入 HTML 中。*但是*，它并没有对服务器进行额外的调用，而且 IDE 中的标记仍然非常干净。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:05:45.063

可能不是你会得到的最优雅的答案，但只是把它扔在那里：

您可以从您的操作方法中返回纯 json，

看起来像这样的东西：

```
{
    Html: "<div class=\"person\"> etc...",
    Json: { // your object here
          }
} 
```

在你的控制器中，你需要这样的东西来渲染你的视图：

```
var existingContext = HttpContext.Current;
var writer = new StringWriter();
var response = new HttpResponse(writer);
var httpContext = new HttpContext(existingContext.Request, response);

var viewResult = myAction(bla);

HttpContext.Current = httpContext;

viewResult.ExecuteResult(this.ControllerContext)

HttpContext.Current = existingContext;
var viewAsHtml = writer.ToString(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-19T07:54:32.330

与 Andrew 相同的解决方案，但可能有点 MVC'ish ......

创建一个继承自 ViewPage 的新类。覆盖其 Render 方法以呈现页面本身，然后将其填充到 Andrew 建议的输出中。这样所有的黑客攻击都发生在应该发生的 Render 方法中。

现在，您创建的每个视图都更改了行：

```
<%@ Page Title="" Language="C#" Inherits="System.Web.Mvc.ViewPage<MyModel>" %> 
```

和

```
<%@ Page Title="" Language="C#" Inherits="CustomViewPage<MyModel>" %> 
```

我自己没有检查它，但我想它应该可以工作。如果您愿意，我可以尝试构建它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T15:22:27.943

```
public static string RenderPartialToString(string controlName, object viewData, object model, System.Web.Routing.RequestContext viewContext)
            {

                ViewDataDictionary vd = new ViewDataDictionary(viewData);
                ViewPage vp = new ViewPage { ViewData = vd };

                vp.ViewData = vd;
                vp.ViewData.Model = model;
                vp.ViewContext = new ViewContext();
                vp.Url = new UrlHelper(viewContext);

                Control control = vp.LoadControl(controlName);

                vp.Controls.Add(control);

                StringBuilder sb = new StringBuilder();

                using (StringWriter sw = new StringWriter(sb))
                {

                    using (HtmlTextWriter tw = new HtmlTextWriter(sw))
                    {

                        vp.RenderControl(tw);

                    }

                }

                return sb.ToString();

            } 
```

# php - 关于 Google 安全浏览 API

> ID：756800
> 
> 赞同：5
> 
> 时间：2009-04-16T15:56:09.483
> 
> 标签：php, javascript, firefox

有谁知道如何使用 Google 安全浏览 API。

我使用 API 密钥从谷歌安全浏览器下载了整个恶意软件和网络钓鱼更新，并尝试比较可疑站点的哈希值（php 中的 md5_file 方法），但没有成功。我还尝试比较可疑站点 url 的哈希值（php 中的 md5 方法）。

我在这里做错了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T16:00:08.977

您需要使用网站网址的规范版本。规范化算法与示例一起在[https://developers.google.com/safe-browsing/v4/urls-hashing#canonicalization](https://developers.google.com/safe-browsing/v4/urls-hashing#canonicalization)上正式记录。另外，我认为根据您对 url 的操作，可能需要使用 url 的后缀或前缀。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-09-29T06:42:13.070

另外，请查看[BrightCloud 网络过滤 API](http://bcws.brightcloud.com)。它使用起来更简单一些（REST Web 界面）。它更好，但确实要花钱（它仍然很实惠）。

（FWIW - 我是 BrightCloud 的创始人。）

# jquery - jquery为属性过滤器动态添加值？

> ID：756805
> 
> 赞同：0
> 
> 时间：2009-04-16T15:56:43.150
> 
> 标签：jquery, core

我有像这样的属性过滤器 $('input[name="email"]');

我想创建一个带参数的函数，其中将包含属性名称..像这样：

```
function test(id_new){
     var var_name = $("input[name='"+id_new+"']:checked").val();
    alert(var_name);
} 
```

但是这段代码不起作用，有什么解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:00:42.313

您使用的是哪个版本的 jQuery？我假设1.3。

尝试删除属性选择器中的单引号：

```
function test(id_new){
     var var_name = $("input[name="+id_new+"]:checked").val();
    alert(var_name);
} 
```

# c# - 如何获取委托的这个工作示例示例以将 lambda 语法作为参数传递？

> ID：756808
> 
> 赞同：0
> 
> 时间：2009-04-16T15:57:33.960
> 
> 标签：c#, lambda

我试图在下面的代码中制作我自己可以理解的 RelayCommand 方法的示例：

```
return new RelayCommand(p => MessageBox.Show("It worked.")); 
```

构造函数是这样的：

```
public RelayCommand(Action<object> execute, Predicate<object> canExecute)
{
    if (execute == null)
        throw new ArgumentNullException("execute");

    _execute = execute;
    _canExecute = canExecute;
} 
```

在[我的最后一个问题](https://stackoverflow.com/questions/756156/how-can-i-get-this-example-using-param-in-c-to-work/756173#756173)中，Jon Skeet 为我指出了正确的方向，因此我可以得到一个示例（如下），它可以满足我的需求（传递一些方法名称，如上面的 MessageBox.Show）。但问题是，为了让它工作，我必须去掉所有的 lambda 语法（Action、Predicate 等），这是我想要理解的。

有没有办法改变工作示例，使其执行相同的功能，但使用 lambda 语法作为参数，如下面注释掉的行中所示？

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestLambda24
{
    class Program
    {
        static void Main(string[] args)
        {
            int[] numbers = { 6, 3, 7, 4, 8 };

            //Console.WriteLine("The addition result is {0}.", Tools.ProcessNumbers(p => Tools.AddNumbers, numbers));
            Console.WriteLine("The addition result is {0}.", Tools.ProcessNumbers(Tools.AddNumbers, numbers));

            //Console.WriteLine("The multiplication result is {0}.", Tools.ProcessNumbers(p => Tools.MultiplyNumbers, numbers));
            Console.WriteLine("The multiplication result is {0}.", Tools.ProcessNumbers(Tools.MultiplyNumbers, numbers));

            Console.ReadLine();
        }
    }

    class Tools
    {
        public static int ProcessNumbers(Func<int[], int> theMethod, int[] integers)
        {
            return theMethod(integers);
        }

        public static int AddNumbers(int[] numbers)
        {
            int result = 0;
            foreach (int i in numbers)
            {
                result += i;
            }
            return result;
        }

        public static int MultiplyNumbers(int[] numbers)
        {
            int result = 1;
            foreach (int i in numbers)
            {
                result *= i;
            }
            return result;
        }
    }

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:01:18.427

好吧，你*可以*这样做：

```
static void Main(string[] args)
{
    int[] numbers = { 6, 3, 7, 4, 8 };

    Console.WriteLine("The addition result is {0}.",
        Tools.ProcessNumbers(p => Tools.AddNumbers(p), numbers));

    Console.WriteLine("The multiplication result is {0}.",
        Tools.ProcessNumbers(p => Tools.MultiplyNumbers(p), numbers));

    Console.ReadLine();
} 
```

换句话说，“给定一个数字数组，调用 AddNumbers（或 MultiplyNumbers）并传入数组，然后返回结果”。

但是，当您可以只使用方法组时，这样做是毫无意义的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-06T05:50:35.010

乔恩说了什么（惊喜，惊喜！）

使用 lambdas 的全部意义在于动态创建函数，因此您不必静态声明它们。例如，

`Console.WriteLine("Mult value is {0}", Tools.ProcessNumbers(num => num.Aggregate(1, (i, j) => i*j), numbers));`

Aggreagte() 是一种扩展方法，（对于我使用的重载）采用种子值和函数。

它首先将种子保存为累加器。然后，对于系列中的每个元素，它使用当前累加器和系列中的当前值调用给定函数，并将结果存储在累加器中（将传递给下一个元素）。最终返回值作为整体结果返回。

换句话说，它与您的手卷版本*完全相同*，除了它允许您传入“结果”的初始值以及要在循环内调用的代码。

# linq - LINQ 条件组

> ID：756827
> 
> 赞同：16
> 
> 时间：2009-04-16T16:00:57.647
> 
> 标签：linq, grouping

是否可以使用条件组子句编写 LINQ 语句？这基本上是我想要做的：

```
bool someFlag = false;

var result = from t in tableName
   group t by new { (someFlag ? 0 : t.FieldA), t.FieldB } into g
   select g; 
```

所以基本上如果 someFlag 设置为 true，我只想按 FieldB 分组，但如果它是 false，我想按 FieldA 和 FieldB 分组。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-16T16:24:52.177

同事帮我解决了：

```
bool someFlag = false;
var result = from t in tableName
   group t by new { FieldA = (someFlag ? 0 : t.FieldA), t.FieldB } into g
   select g; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:33:33.577

如果您`someFlag`不是依赖于迭代器当前元素的变量，那么我认为您可以通过编写以下代码使您的代码更具可读性。

```
bool someFlag = false;
var result = someFlag ?
     (from t in tableName group t by t.FieldA into g select g) :
     (from t in tableName group t by t.FieldB into g select g); 
```

诚然，它稍长一些，但在我看来，它的目的要明显得多。

为了稍微简化您刚刚发布的代码：

```
bool someFlag = false;
var result = from t in tableName
   group t by (someFlag ? t.FieldA : t.FieldB) into g
   select g; 
```

...或者我在这里错过了什么？

# html - 子窗口中的变量未从父窗口接收值

> ID：756840
> 
> 赞同：0
> 
> 时间：2009-04-16T16:04:59.307
> 
> 标签：html, vbscript, parent-child

在一个 html 页面中，我创建了一个子窗口来执行一些过滤（选择打印机，以及要在报告上打印哪些部分）。为了在子窗口中显示部件选择，我需要从父窗口调用 GetParts 函数并将记录集返回给子窗口。这里有一些代码可以提供帮助：

从子窗口->

```
Sub LoadParts(frmRptFilter)
Dim sql
Dim oParts
Set oParts = CreateObject("ADODB.Recordset")
oParts.Fields.Append "Part", adBSTR , 30
oParts.Open
oParts = window.opener.GetParts(oParts) 'Since oParts was passed as a parameter I did not believe this to be necessary, but when it didn't work as expected I tried returning it this way....didn't work either
'more code follows 
```

在父窗口中 ->

```
Function GetParts(oParts)
Dim sql

sql = "SELECT Job.Part_Number FROM Job RIGHT JOIN Packlist_Detail ON Packlist_Detail.Job = Job.Job "_
    & "WHERE Packlist_Detail.Packlist LIKE '" & sPL & "'"

CloseRS(oRS)
oRS.Open sql, oConn, adOpenStatic, adLockReadOnly

oRS.MoveFirst

If Not (oRS.BOF AND oRS.EOF) Then
    Do while not oRS.EOF
        oParts.AddNew
        oParts("Part").Value = oRS(0)
        oParts.Update
        oRS.MoveNext
    Loop 
End If

'GetParts = oParts 'Since oParts was passed as a parameter I did not believe this to be necessary, but when it didn't work as expected I tried returning it this way....didn't work either
End Function 
```

我为一个软件编写报告，该软件需要我创建包含水晶报告对象的过滤器和报告 html 页面。我编写这些报告的软件限制了我在数据库连接等方面的能力。所以我不得不这样。

因此，我验证了父窗口中的 oParts 已正确填充。它做了什么！我只是无法将它填充到我的子窗口中。所以问题是，我如何在子窗口中取回一个值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T17:34:22.773

试试这个
子窗口

```
 Set oParts = window.opener.GetParts(oParts) 
```

父窗口

```
 Set GetParts = oParts 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T18:39:25.987

测试仪101：

尝试您所说的在父函数中出现错误：Object required 'oParts'

看到这一点，我在其中定义了 oParts 记录集：

```
Set oParts = CreateObject("ADODB.Recordset")
oParts.Fields.Append "Part", adBSTR , 30
oParts.Open 
```

现在一切都很棒。

所以这个问题的真正答案是Tester101的答案加上在父函数中返回子窗口的记录集的定义。

谢谢Tester101！！！！

# date - （日历）一天中的时间不返回正确的时间

> ID：756844
> 
> 赞同：1
> 
> 时间：2009-04-16T16:05:47.747
> 
> 标签：date, java-me

`Calendar.getInstance(TimeZone.getTimeZone("GMT+1")).get(Calendar.HOUR_OF_DAY)`是一个小时“慢”，（可能是因为他们没有检测到夏令时 +1 小时。）在 J2SE 中，有很多可用的时区（欧洲/布达佩斯也是，它工作得很好），但在 J2ME 中有只有 GTM 和 UTC。
我怎样才能得到“正确”的时间？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T16:10:59.527

您已要求“GMT+1”，这是一个*固定*时区 - 不应用夏令时。如果您需要应用夏令时并且 J2ME 不提供任何 DST 时区，您将不得不自己解决这个逻辑:(

（换句话说，听起来 J2ME 行为正确，但它不支持您想要的功能。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:35:34.520

我已经`TimeZone.getDefault()`在我的手机上尝试过，它有效:)（但在模拟器上，这个小时“慢”了 2 小时：S）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T16:11:52.740

我刚刚遇到了一个完全不同的应用程序的问题-它是一个移动应用程序，但结果证明这是我的思维方式的范式问题，根本不是程序问题......我想知道这是否是同一个问题有。

目前英格兰是英国夏令时，所以人们通常认为格林威治标准时间是它目前在英格兰的时间......这并不总是格林威治标准时间。BST 是 GMT+1，这（取决于您的位置以及您是否使用夏令时）可能会导致问题。如果 GMT 落后一天，这也会影响日期。

例如，我目前在多伦多，目前是 GMT-4，但比伦敦晚 5 小时，这让我很困惑。我认为更令人困惑的是我*来自*英国，所以我自动将时间视为 GMT-5，但并非总是如此。伦敦时间目前是 GMT+1，我们是 London-5，实际上是 GMT-4。

# c++ - 模板化的类是否继承传递给它们的类的成员？（特别是 std::vector）

> ID：756848
> 
> 赞同：3
> 
> 时间：2009-04-16T16:06:55.043
> 
> 标签：c++, vector

我有一个关于向量的问题：

如果我有一个 std::vector<MyClass> 这个向量是否会“继承” MyClass 成员函数？如果不是，那么在循环中单独处理 MyClass 成员的最佳方法是什么？我是否必须在每次迭代时创建一个新的类对象并将当前向量迭代器分配给它？

```
class MyClass
{
    public:
        void setMembers(std::string &string, int &num)
        {
            mystring = string;
            number = num;
        }
        string printString() { return mystring; }
        int printNumber() { return number; }

    private:
        std::string mystring;
        int number;
};

    MyClass test;
    std::vector<MyClass> vector;

    std::string string = "Test 1";
    int a = 3;

    test.setMembers(string,a);
    vector.push_back(test);

    for(unsigned int i = 0; i<vector.size(); i++) {
        cout << "Vector #" <<  << endl;
        // does vector inherit member functions here?
        cout << "mystring is: " << vector.printString()<< endl;
        cout << "number is  : " << vector.printNumber() << endl;
    } 
```

非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T16:10:17.797

不，实例 std::vector 不会继承您的成员变量。但是，向量中的对象确实具有可以通过 operator[] 访问的那些成员。

```
for (size_t i = 0; i < vector.size(); i++) {
    cout << "Vector #" << i << endl;
    cout << "mystring is: " << vector[i].printString() << endl;
    cout << "number is  : " << vector[i].printNumber() << endl;
} 
```

注意我们现在说vector[i]，它返回一个MyClass 类型的值，它有成员函数printString() 和printNumber()。

您应该重新阅读有关继承的章节。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T16:49:00.403

您问题的第一部分已经被其他人回答了。没有任何形式的继承发生。向量表现为向量，仅此而已。

有两种操作数组的方法。第一个（显而易见的）是通过一个 for 循环，就像你说的：

```
for(size_t i = 0; i<vector.size(); i++) { // technically, you should use size_t here, since that is the type returned by vector.size()
    cout << "Element #" <<  << endl; // We're iterating through the elements contained in the vector, so printing "Vector #" doesn't make sense. There is only one vector
    cout << "mystring is: " << vector[i].printString()<< endl; // [i] to access the i'th element contained in the vector
    cout << "number is  : " << vector[i].printNumber() << endl;
} 
```

另一种方法是使用标准库中定义的算法。作为对这些的介绍，我将把它分成几个步骤。首先，每个容器还定义了一个迭代器类型。迭代器在概念上类似于指向容器中某个位置的指针。因此`vector[i].printString()`，您可以在任何给定迭代器指向的元素上调用 printString() 而不是 。（假设一个迭代器叫做`iter`，语法是`iter->printString()`）

这样做的原因是它允许一种通用且通用的方式来遍历容器。因为列表、向量、双端队列和所有其他容器类型都提供了迭代器，并且这些迭代器使用相同的语法，所以您的代码可以采用一对迭代器，表示您要处理的元素范围的开始和结束，然后无论底层容器类型如何，相同的代码都将起作用。

所以首先，让我们使用循环再次运行容器，但这次使用迭代器：

```
forstd::vector<MyClass> current = vector.begin(); current != vector.end(); ++current) {
    cout << "mystring is: " << current->printString() << endl;
    cout << "number is  : " << current->printNumber() << endl;
} 
```

到目前为止并没有很大的改进，尽管它确实消除了`i`索引变量，这通常不是必需的，除非作为循环计数器。begin/end) 函数返回一个迭代器，该迭代器指向容器中的第一个元素，另一个指向迭代器*末尾*的元素。因此，当我们向前移动第一个迭代器时，我们知道当它等于结束迭代器时我们已经到达终点。这样，两个迭代器就可以表示任意范围的元素。

现在我们有了迭代器，我们可以使用很多其他技巧。C++ 标准库带有许多用于处理元素序列的算法。它们位于`<algorithm>`标题中。

让我们入门的一个简单方法是`std::for_each`，它几乎是 for 循环的替代品。它只是一个带有两个迭代器的函数，表示它应该处理的元素的范围，以及它应该对每个迭代器执行的操作。所以要调用它，我们需要定义这样一个动作：

```
void Print(const MyClass& obj) {
    cout << "mystring is: " << obj.printString() << endl;
    cout << "number is  : " << obj.printNumber() << endl;
} 
```

就这样。一个以元素类型为参数的函数，可以做任何需要做的事情。现在我们可以调用`for_each`：

```
std::for_each(vector.begin(), vector.end(), Print); 
```

如果您需要经常这样做，它可以节省大量的打字时间。Print 函数只需定义一次，然后每个 for 循环都可以替换为这样的单行。

迭代器的另一个好技巧是它们不必代表整个范围。我们可以跳过前五个元素：

```
std::for_each(vector.begin() + 5, vector.end(), Print); 
```

或者只取前三个元素：

```
std::for_each(vector.begin(), vector.begin()+3, Print); 
```

或您能想到的任何其他操作。还有一些算法，例如复制（从一个迭代器范围复制到另一个）：

```
std::copy(vector.begin(), vector.end(), dest.begin()); 
```

并且`dest`也可以是任何类型的迭代器，它不一定是向量迭代器，因为源是。事实上，如果你想直接打印出内容，我们甚至可以直接复制到 std::cout （不幸的是，由于 MyClass 没有定义`operator <<`，这会导致错误。）

要解决 std::cout 的这个小问题，我们可以使用`std::transform`，它对每个对象应用一些转换，然后将结果放入输出序列中。由于我们不能直接打印出 MyClass 对象，我们可以将其转换为*可以*打印出来的字符串：

```
std::string ToString(const MyClass& obj) {
  return std::string("mystring is: " + obj.printString() + "\nnumber is  :" << obj.printNumber() + "\n";
} 
```

同样，相当简单的代码。我们只需创建一个函数，它接受一个 MyClass 对象，并构建一个具有所需输出的字符串。所以让我们直接把它复制到std::cout：

```
std::transform(vector.begin(), vector.end(), std::ostream_iterator(std::cout), ToString); 
```

`std::ostream_iterator`创建一个特殊的输出流迭代器 out`std::cout`以允许它用作迭代器。再一次，实际的“对向量中的所有内容执行此操作”代码变成了一行。要执行的实际操作在其他地方定义一次，因此不必弄乱代码。

因此，虽然 for 循环是处理容器中元素序列的显而易见的方式，但从长远来看，迭代器通常是更好的解决方案。它们提供了更多的灵活性，甚至大大简化了您的代码。

如果你现在更喜欢坚持使用 for 循环，我不会责怪你，因为它们更容易理解。我只是想告诉你它们不是 C++ 中的“终极”答案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T16:12:07.620

向量没有从其类继承任何内容，但成员是该类的成员。

假设你有`std::vector<MyClass> v;`，并且实际上有一些成员加入（看起来你对 .push_back() 没问题）。

现在，您可以通过以下方式调用 MyClass 函数：

```
for (int i = 0; i < v.length(); ++v)
   v[i].printString(); 
```

或者

```
for (std::vector<MyClass>::const_iterator i = v.begin(); i != v.end(); ++i)
   i->PrintString(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T16:15:15.977

从“是/有一个”的角度考虑它向量不是一个“MyClass”它有一个“MyClass”（实际上它有 0 个或多个 MyClass），但重要的是它不是一个MyClass，它只是存储它们

您放入向量中的每个对象都保留在那里，您可以按位置引用每个对象（就好像它是 MyClass 对象的数组一样）

```
for(unsigned int i = 0; i<vector.size(); i++) {
    cout << "Vector #" <<  << endl;
    // does vector inherit member functions here?
    cout << "mystring is: " << vector[i].printString()<< endl;
    cout << "number is  : " << vector[i].printNumber() << endl;
} 
```

然而，惯例是使用迭代器，它“像”指向存储对象的指针，例如

```
for(std::vector<MyClass>::iterator i = vector.begin(); i != vector.end(); ++i) {
    cout << "Vector #" <<  << endl;
    // does vector inherit member functions here?
    cout << "mystring is: " << i->printString()<< endl;
    cout << "number is  : " << i->printNumber() << endl;
} 
```

希望这有助于澄清事情。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T16:09:27.613

不，Vector 是您的类类型对象周围的容器。您需要使用 operator[] 或 at() 成员函数来索引您的向量以访问您的类对象。然后你可以在你的对象上调用这些函数。

例如

v[i].printString();

或者

v.at(i).pringString();

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T16:11:47.233

不，向量不会“继承”类的成员。如果你想对向量的每个元素做一些事情，使用迭代器：

```
for(vector<MyClass>::iterator i=vector.begin();i!=vector.end();i++) {
    cout << "mystring is: " << i->printString() << endl;
    cout << "number is  : " << i->printNumber() << endl;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T16:09:20.560

不，不是的。您需要访问集合的每个成员：

```
cout << "Vector #" <<  << endl;
for( unsigned int i = 0; i <vector.size(); i++) {
    cout << "mystring at " << i << " is "  << vector[i].printString()<< endl;
    cout << "number at " << i << " is " << vector[i].printNumber() << endl;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T16:10:29.637

不，向量就像一个数组；它是它所拥有的东西的集合，而不是它所拥有的东西的子类。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T16:53:52.233

不，`std::vector<MyClass>`不继承 的成员，`MyClass`但您可以使用 STL 和 boost 的工具对向量执行操作，而无需为您需要的每个操作显式编码迭代。
这是一些示例代码：

```
#include <vector>
#include <algorithm>
#include <boost/bind.hpp>

struct Bla
{
    Bla(int i = 0) : m_i(i) {}

    void print() { printf("%d ", m_i); }
    void printAdd(int a) { printf("%d ", m_i +  a); }

    Bla add(int a) { return Bla(m_i + a); }
    int geti() { return m_i; }

    int m_i;
};

void printInt(int i)
{
    printf("%d ", i);
}

int main(int argc, char *argv[])
{
    std::vector<Bla> bla;
    bla.push_back(Bla(1));
    bla.push_back(Bla(2));

    // print the elements in the vector
    std::for_each(bla.begin(), bla.end(), boost::mem_fn(&Bla::print));
    printf("\n");
    // a complex operation on the vector requiring an additional argument for the call
    std::for_each(bla.begin(), bla.end(), boost::bind(&Bla::printAdd, _1, 10));
    printf("\n");

    // extract a single member from the vector into a second vector
    std::vector<int> result;
    result.resize(bla.size());
    std::transform(bla.begin(), bla.end(), result.begin(), boost::bind(&Bla::geti, _1));
    // print the result
    std::for_each(result.begin(), result.end(), &printInt);
    printf("\n");

    // transform the vector into a different vector using a complex function that requires an argument.
    std::vector<Bla> result2;
    result2.resize(bla.size());
    std::transform(bla.begin(), bla.end(), result2.begin(), boost::bind(&Bla::add, _1, 10));
    std::for_each(result2.begin(), result2.end(), boost::mem_fn(&Bla::print));
    printf("\n");

    return 0;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-16T16:23:09.450

感谢所有的答案！事实证明它比我想象的要容易，而且现在很有意义。

我不应该使用继承这个词，因为它的意思完全不同。

无论如何，你所有的答案都有很大帮助。非常感谢你！

# design-patterns - DDD - 领域模型、服务和存储库之间的依赖关系

> ID：756849
> 
> 赞同：17
> 
> 时间：2009-04-16T16:07:18.850
> 
> 标签：design-patterns, architecture, domain-driven-design

只是想知道其他人如何分层他们的架构。假设我的图层如下：

领域层
--Product --ProductService
（小鬼应该进入这一层吗？）
--IProductService
--IProductRepository

基础设施层
--ProductRepository（我的域中的 IProductRepository 的 Imp）

现在，当创建新产品时，我需要通过调用 ProductService.GetNextProductId() 方法来分配产品 ID。

因为该服务依赖于存储库，所以我使用 IProductRepository 接口设置了 ProductService ctor，该接口可以稍后注入。像这样的东西：

```
 public class ProductService : IProductService
    {
        private IProductRepository _repository;

        public ProductService(IProductRepository repository)
        {
            _repository = repository;
        }

        public long GetNextProductId()
        {
            return _repository.GetNextProductId();
        }
    } 
```

我的问题是，当我在 Product Class 中使用该服务时，我在实例化新的 ProductService 类时引用了 ctor 中的存储库。在 DDD 中，有这样的参考是一个很大的禁忌。我什至不确定我的产品域类是否设置正确以调用该服务，有人可以建议：

```
public class Product : Entity
    {
        private ProductService _svc;
        private IProductRepository _repository;

        public Product(string name, Address address) //It doesnt seem right to put parm for IProductRepository in the ctor?
            : base(_svc.GetNextProductId) // This is where i pass the id
        {
            // where to create an instance of IProductRepository?
        }
    } 
```

我怎样才能优雅地解决这个设计问题？我愿意听取经验丰富的 DDD'ers 的建议

编辑：

谢谢你的评论。我还怀疑是否应该从 Product Class 调用该服务。我还没有使用工厂模式，因为对象的构造仍然很简单。我不觉得它需要工厂方法吗？

我很困惑...如果我的 Product 类需要来自服务的一些其他数据，例如 GetSystemDateTime() （我知道，不好的例子但试图演示非 db 调用），则将 ProductId 放在一边，该服务方法将在哪里调用？

DDD 中的服务是逻辑转储，其中的逻辑不是域对象的自然属性，对吧？那么它是如何粘合在一起的呢？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-17T13:38:42.537

最后一点，DDD 中的服务是放置我所说的“尴尬”逻辑的地方。如果您有某种类型的逻辑或工作流程依赖于其他实体，则这种逻辑通常不“适合”域对象本身。示例：如果我的业务对象上有一个方法来执行某种类型的验证，则服务类可能会执行此方法（仍然在其类中保留与实体相关的实际验证逻辑）

我经常提到的另一个非常好的例子是资金转移方法。您不会将帐户对象从一个对象转移到另一个对象，而是您将拥有一项服务，该服务采用“to”帐户和“from”帐户。然后在服务内部，您将调用“来自”帐户的提款方法和“至”帐户的存款方法。如果您尝试将其放在帐户实体本身中，那会感觉很尴尬。

[可以在此处](http://deepfriedbytes.com/podcast/episode-6-talking-domain-driven-design-with-david-laribee-part-1/)找到深入讨论这个主题的精彩播客。David Laribee 做得非常好，现在只解释了 DDD 的“如何”但“为什么”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-16T16:28:59.873

您的域模型不应引用 ProductService 或 IProductRepository。如果您创建一个新产品，它必须通过工厂创建 - 工厂可以使用 ProductService 来获取产品 ID。

实际上，我会使用适当的接口包装 ProductService，例如 IProductIdGeneratorService，以便您可以使用 IoC 容器将其注入工厂。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-04-30T20:22:34.400

以下是我将如何构建您的问题。我相信这也是推荐的 DDD 方式。

```
public class ProductService : IProductService // Application Service class, used by outside components like UI, WCF, HTTP Services, other Bounded Contexts, etc.
{
    private readonly IProductRepository _prodRepository;
    private readonly IStoreRepository _storeRepository;

    public ProductService(IProductRepository prodRepository, IStoreRepository storeRepository) // Injected dependencies DI
    {
        if(prodRepository == null) throw new NullArgumentException("Prod Repo is required."); // guard
        if(storeRepository == null) throw new NullArgumentException("Store Repo is required."); // guard

        _prodRepository = prodRepository;
        _storeRepository = storeRepository;
    }

    public void AddProductToStore(string name, Address address, StoreId storeId) //An exposed API method related to Product that is a part of your Application Service. Address and StoreId are value objects.
    {
        Store store = _storeRepository.GetBy(storeId);
        IProductIdGenerator productIdGenerator = new ProductIdGenerator(_prodRepository);
        Product product = Product.MakeNew(name, address, productIdGenerator);
    }

    ... // Rest of API
}

public class Product : Entity
{
    public static MakeNew(string name, Address address, IProductIdGenerator productIdGenerator) // Factory to make construction behaviour more explicit
    {
        return new Product(name, address, productIdGenerator);
    }

    protected Product(string name, Address address, IProductIdGenerator productIdGenerator)
        : base(productIdGenerator.GetNextProductId())
    {
        Name = name;
        Address = address;
    }

    ... // Rest of Product methods, properties and fields
}

public class ProductIdGenerator : IProductIdGenerator
{
    private IProductRepository _repository;

    public ProductIdGenerator(IProductRepository repository)
    {
        _repository = repository;
    }

    public long GetNextProductId()
    {
        return _repository.GetNextProductId();
    }
}

public interface IProductIdGenerator
{
    long GetNextProductId();
} 
```

基本上，ProductService 是您的应用程序服务的一部分，即需要使用您的域或跨越其边界的所有内容的入口和出口点。它负责将每个用例委托给可以处理它的适当组件，并在需要许多组件来完成用例时在所有这些组件之间进行协调。

产品是您的 AggregateRoot 和您域中的实体。它负责规定捕获您企业领域的通用语言的合同。因此，就其本身而言，这意味着您的领域有一个产品的概念，其中包含数据和行为，无论您公开暴露的数据和行为都必须是泛在语言的概念。它的字段不应该有域模型之外的外部依赖，所以没有服务。但是，它的方法可以将域服务作为参数来帮助它执行行为逻辑。

ProductIdGenerator 是此类域服务的一个示例。领域服务封装了跨越实体自身边界的行为逻辑。因此，如果您的逻辑需要其他聚合根或外部服务，如存储库、文件系统、密码学等。基本上，任何您无法从实体内部锻炼的逻辑，无需其他任何东西，您可能需要域服务。如果逻辑是 englobing 并且在概念上看起来可能并不真正属于您的实体上的方法，这表明您可能需要一个全新的应用程序服务用例，或者您在设计中错过了一个实体。也可以直接从应用程序服务中使用域服务，以非双重分派的方式。这有点类似于 C# 扩展方法与普通静态方法。

===========回答您的编辑问题================

> 我还怀疑是否应该从 Product Class 调用该服务。

如果通过方法参数将域服务作为临时引用传递，则可以从产品类调用域服务。绝不应从 Product 类中调用应用程序服务。

> 我还没有使用工厂模式，因为对象的构造仍然很简单。我不觉得它需要工厂方法吗？

这取决于您期望什么会花费您更多时间，即使您没有多个构造逻辑，现在也可以创建工厂，或者稍后进行重构。我认为对于不需要以多种方式构建的实体来说，这是不值得的。作为[维基百科](http://en.wikipedia.org/wiki/Factory_%28object-oriented_programming%29#Descriptive_names)解释说，工厂用于使每个构造函数所做的事情更加明确和可区分。在我的示例中，MakeNew 工厂解释了 Entity 的这种特殊构造的用途：创建新产品。你可以有更多的工厂，比如 MakeExisting、MakeSample、MakeDeprecated 等。这些工厂中的每一个都会创建一个产品，但目的不同，方式也略有不同。如果没有工厂，所有这些构造函数都将被命名为 Product()，并且很难知道哪个构造函数用于什么以及做什么。缺点是当你扩展你的实体时工厂更难使用，子实体不能使用父工厂来创建一个孩子，这就是为什么我倾向于在构造函数中做所有的构造逻辑，并且只使用工厂给他们取个好听的名字。

> 我很困惑...如果我的 Product 类需要来自服务的一些其他数据，例如 GetSystemDateTime() （我知道，不好的例子，但试图演示非 db 调用），将 ProductId 放在一边，该服务方法将在哪里调用？

假设您认为 Date 实现是基础架构的一个细节。您将围绕它创建一个抽象以在您的应用程序中使用。它将从一个接口开始，可能类似于 IDateTimeProvider。该接口将有一个 GetSystemDateTime() 方法。

您的应用程序服务可以自由地实例化 IDateTimeProvider 并随时调用其方法，而不是将结果传递给聚合、实体、域服务或其他任何需要它的东西。

您的域服务可以自由地持有对 IDateTimeProvider 作为类字段的引用，但它不应创建实例本身。它要么通过依赖注入接收它，要么通过服务定位器请求它。

最后，您的实体和聚合根和值对象可以自由调用 GetSystemDateTime() 和 IDateTimeProvider 的其他方法，但不能直接调用。它需要通过双重分派，您将给它一个域服务作为其中一个方法的参数，并且它将使用该域服务来查询它想要的信息，或执行它需要的行为。它还可以将自己传递回域服务，域服务将在其中进行查询和设置。

如果您认为您的 IDateTimeProvider 实际上是一个域服务，作为通用语言的一部分，那么您的实体和聚合根可以直接在其上调用方法，它只是不能将其作为类字段引用，而是本地的方法参数的变量很好。

> DDD 中的服务是逻辑转储，其中的逻辑不是域对象的自然属性，对吧？那么它是如何粘合在一起的呢？

我认为我的整个答案已经很清楚了。基本上，你有 3 种可能性来粘合它们（至少我现在能想到的）。

1) 应用服务实例化一个领域服务，调用它的方法，并将结果返回值传递给其他需要它的东西（repo、实体、聚合根、值对象、另一个领域服务、工厂等）。

2) 域服务由应用程序域实例化，并作为参数传递给将使用它的方法。无论使用什么，都不会永久引用它，它只是一个局部变量。

3) 域服务由应用程序域实例化，并作为参数传递给将使用它的方法。无论使用它，都使用双重调度以非依赖方式使用域服务。这意味着它将对自身的引用传递给域服务的方法，如 DomainService.DoSomething(this, name, Address)。

希望这可以帮助。如果我做错了什么或违反了 DDD 的最佳实践，欢迎发表评论。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T16:46:42.857

如果我正确理解您的问题，您声明您的 Product 类正在调用 ProductService 类。它不应该。您应该在负责创建和配置产品的工厂类中执行此操作。您调用此方法的位置还可能取决于您何时想要发布 ProductId：我们可能有类似的情况，因为我们需要从项目的旧会计系统中获取一个数字。我推迟获得数字，直到项目持续存在，这样我们就不会浪费任何数字或有差距。如果您处于类似情况，您可能希望在存储库保存方法中发出 ProductId，而不是在创建对象时发出。

顺便说一句，您真的认为您将拥有多个 ProductService 或 ProductRepository 吗？如果不是，那么我就不会为接口而烦恼。

编辑添加：

我建议从小处着手并保持简单，从两个类开始，Product 和 ProductServices。ProductServices 将执行所有服务，包括工厂和存储库，因为您可以将它们视为专业服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-12T16:16:54.000

与 Marcelo 一致，您可能应该首先确定产品 ID 是否真的是一个领域模型概念。如果业务用户从不使用或不知道产品 ID，通常通过名称、编号、SKU 或由名称 + 维度组成的自然产品 ID 来引用产品，那么这就是领域模型应该注意的。

话虽如此，假设产品 ID 是数据库中的自动编号字段，我是这样构建 DDD 项目的：

**Project.Business**（领域模型）

没有引用，因此不依赖任何东西。

```
public class Product : Entity
{
    private Product(string name, Address address)
    {
        //set values.
    }

    //Factory method, even for simple ctor is used for encapsulation so we don't have 
    //to publically expose the constructor.  What if we needed more than just a couple           
    //of value objects?
    public static CreateNewProduct(string name, Address address) 
    {
        return new Product(name, address);
    }

    public static GetAddress(string address, string city, string state, string zip) { }
}

public interface IProductRepository : IEnumerable<Product>
{
    void Add(Product product);
    //The following methods are extraneous, but included for completion sake.
    int IndexOf(Product product);
    Product this[int index] { get; set; }
} 
```

**项目实施**

```
public SqlProductRepository : List<ProductDataModel>, IProductRepository
{
    public SqlProductRepository(string sqlConnectionString) { }

    public void Add(Product product)
    {
        //Get new Id and save the product to the db.
    }

    public int IndexOf(Product product)
    {
        //Get the index of the base class and convert to business object.
    }

    public Product this[int index]
    {
        get { //find instance based on index and return; }
        set { //find product ID based on index and save the passed in Business object to the database under that ID. }
    }
} 
```

**Project.ApplicationName**（表示层）

```
public class Application
{
    IProductRepository repository = new SqlProductRepository(SqlConnectionString);

    protected void Save_Click(object sender, EventArgs e)
    {
        Product newProduct = Product.CreateNewProduct(name, Product.GetAddress(address,city,state,zip));
        repository.Add(newProduct);
    }
} 
```

如有必要，您可能有：

**Project.Services**（在自身和表示层之间使用 DTO 的应用程序服务层）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-12T13:23:27.257

为什么在内存中创建产品时需要产品 id？通常，产品 ID 是在您在存储库中创建产品时设置的。

看看下面的代码：

var id1 = _repository.GetNextProductId(); var id2 = _repository.GetNextProductId();

它会返回两个不同的产品ID吗？

如果答案是肯定的，那么它是安全的（但仍然很尴尬）；如果答案是否定的，那么您将遇到一个大问题；

# security - 医疗应用的安全要求

> ID：756850
> 
> 赞同：6
> 
> 时间：2009-04-16T16:07:30.190
> 
> 标签：security, requirements, medical

我正在研究医疗应用程序的编码要求，但找不到任何有用/结构化的东西。基本上，我正在寻找带有安全要求列表的结构化（如果可能是 XML 文件）文档。例如他们应该使用什么样的加密，默认情况下应该禁用应用程序的哪些功能，应该存储哪些日志信息以及如何存储它等等。

当然，不同的应用程序和公司的要求可能会有所不同，我只需要一些一般信息，如果可能的话，对于美国。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T16:11:56.093

对于美国，您可以查看面向 Web 程序员的[HIPAA 指南。](http://www.hipaaguide.net/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T16:10:05.020

HL7 是您所需要的。

一些链接：

[http://aurora.regenstrief.org/security/](http://aurora.regenstrief.org/security/)

[http://www.hl7.org.au/docs/HL7-Sec.htm](http://www.hl7.org.au/docs/HL7-Sec.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-19T00:41:55.897

此外，考虑支持 OWASP 前十名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-29T04:19:59.720

对于您的医疗应用，它们是否特定于图像？如果是这样，您可以参考 DICOM 3.0 标准。

这里有一些章节供参考（使用什么样的加密算法，应该去识别哪个部分等..）

*   [第 15 部分安全配置文件](ftp://medical.nema.org/medical/dicom/2009/09_15pu.pdf) [ftp://medical.nema.org/medical/dicom/2009/09_15pu.pdf](ftp://medical.nema.org/medical/dicom/2009/09_15pu.pdf)
*   [增刊51 媒体安全](ftp://medical.nema.org/medical/dicom/final/sup51_ft.pdf) [ftp://medical.nema.org/medical/dicom/final/sup51_ft.pdf](ftp://medical.nema.org/medical/dicom/final/sup51_ft.pdf)
*   [Supp 86 结构化报告的数字签名](ftp://medical.nema.org/medical/dicom/final/sup86_ft2.pdf)

# sql-server-2005 - 运行 sp_executesql 查询需要参数 @statement

> ID：756855
> 
> 赞同：2
> 
> 时间：2009-04-16T16:08:43.980
> 
> 标签：sql-server-2005, stored-procedures

我不确定如何解决此错误：

*过程或函数“sp_executesql”需要未提供的参数“@statement”。*

对于这个查询：

```
DECLARE @a INT 
DECLARE @b VARCHAR 
SET @a = 1

WHILE @a < 30
BEGIN
set @b = @a  
exec sp_executesql update source_temp set pmt_90_day = pmt_90_day + convert(money,'trans_total_'+@b)+N'
    N'where convert(datetime,'effective_date_'+@b)+N' <= dateadd(day,90,ORSA_CHARGE_OFF_DATE)
    and DRC_FLAG_'+@b = 'C'''

SET @a = @a + 1
END 
```

另外，您能帮我理解 N' 的正确用法，以及它是否在此语句中正确执行。

感谢你的协助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:16:35.613

“sp_executesql”存储过程需要单个字符串参数@statement 来执行。

你的字符串在这里完全不正常......你需要在任何“固定”字符串部分前加上 N'......' 以使它们成为 Unicode 字符串，但这绝对不是这里的情况。

我想你可能想试试这个：

```
DECLARE @a INT 
DECLARE @b VARCHAR(2)

SET @a = 1

DECLARE @statement NVARCHAR(500)

WHILE @a < 30
BEGIN
    SET @b = CAST(@a AS VARCHAR(2))

    SET @statement = 
        N'update source_temp set pmt_90_day = pmt_90_day + ' + 
             'convert(money, ''trans_total_' + @b + ''') ' + 
             'where convert(datetime, ''effective_date_' + @b + ''')' +
             ' <= DATEADD(DAY, 90, ORSA_CHARGE_OFF_DATE) ' +
             'and DRC_FLAG_' + @b + ' = ''C'''

    exec sp_executesql @statement

    SET @a = @a + 1
END 
```

这行得通并且做你期望它做的事情吗？

说明： N'.........' 分隔包含 SQL 语句的整个字符串。必须复制（“转义”）内部的任何撇号。我希望我正确理解了你的逻辑。

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:21:40.377

sp 需要一个字符串类型的变量，而不是 SQL 语句。用单引号把你的 SQL 包起来：

```
 exec sp_executesql 'some SQL statement'; 
```

当你这样做时，通过用两个单引号替换每个单引号来转义语句中的任何单引号：

```
exec sp_executesql 'select 'AB' from dual';  -- wrong

exec sp_executesql 'select ''AB'' from dual';  -- right 
```

我不知道是什么`N`。你认为那是什么？它是某种类型的角色集吗？为什么你认为这是必要的？

# nhibernate - 将 Nhibernate.Search 与 Nhibernate 2 集成

> ID：756860
> 
> 赞同：3
> 
> 时间：2009-04-16T16:09:39.203
> 
> 标签：nhibernate, nhibernate.search

我刚刚花了一整天的时间试图让 NHibernate.Search 与 NHibernate 2.0 一起工作，很抱歉我仍然没有管理它。我遇到了[此处](https://stackoverflow.com/questions/426151/nhibrnate-search-with-nhibernate-v2)发布的问题并下载了该帖子链接的 dll，但是该示例使用搜索拦截器而不是 EventListeners，我认为这是更新的做事方式。似乎可用的信息很少，我能找到的东西很难理解，并且与其他信息相矛盾。

在这一点上，我对整个事情感到非常沮丧，并且正在认真考虑编写我自己的 Nhibernate 和 Lucene 集成（或者可能是另一个索引库）。目前，NHibernate.Search 似乎还远未成熟到足以让我考虑使用它，我会更自在地维护自己的更简化的库。

我想知道的是，是否有明确的方式使用 NHibernate.Search 和 NHibernate 2，以及在生产环境中使用它是否可行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-17T15:00:14.853

为了设置 EventListeners，您需要在初始化 NHibernate 时添加以下代码：

```
NHibernate.Cfg.Configuration cfg = new NHibernate.Cfg.Configuration();
//Load configuration

//Add NHibernate.Search listeners
cfg.SetListener(NHibernate.Event.ListenerType.PostUpdate, new FullTextIndexEventListener());
cfg.SetListener(NHibernate.Event.ListenerType.PostInsert, new FullTextIndexEventListener());
cfg.SetListener(NHibernate.Event.ListenerType.PostDelete, new FullTextIndexEventListener());

var factory = cfg.BuildSessionFactory(); 
```

您的 web.config/app.config 文件必须更改以包含以下内容：

```
<configuration>

    <configSections>
        <section name="hibernate-configuration" type="NHibernate.Cfg.ConfigurationSectionHandler, NHibernate" requirePermission="false"/>
        <section name="nhs-configuration" type="NHibernate.Search.Cfg.ConfigurationSectionHandler, NHibernate.Search" requirePermission="false"/>
    </configSections>

    <!-- NHibernate.Search -->
    <nhs-configuration xmlns='urn:nhs-configuration-1.0'>
        <search-factory>
            <property name='hibernate.search.default.directory_provider'>NHibernate.Search.Store.FSDirectoryProvider, NHibernate.Search</property>

            <property name='hibernate.search.default.indexBase'>PATH TO LUCENE.NET STORE</property>

            <property name='hibernate.search.indexing_strategy'>event</property>
        </search-factory>
    </nhs-configuration>

    <appSettings>
        <add key="Lucene.Net.lockdir" value="SAME PATH AS ABOVE" />
    </appSettings>

    ... 
```

最后：当您创建 ISession 实例时，请记住使用此代码来获取 IFullTextSession。

```
IFullTextSession session = Search.CreateFullTextSession(factory.OpenSession()); 
```

这应该适用于 Lucene 2.0 和 NHibernate 2.0。

# memory - “a”堆和“the”堆之间有什么关系？

> ID：756861
> 
> 赞同：42
> 
> 时间：2009-04-16T16:09:43.070
> 
> 标签：memory, heap, heap-memory, definition

堆是一种树数据结构，其中较高级别的树总是包含比较低级别更大（或更少，如果它是这样设置的话）的值。“该”堆是程序可用于动态分配的一堆空闲 RAM。它们都被称为“堆”，但一个与另一个有什么关系？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-16T16:25:24.453

老实说，没什么。我想*堆*这个词只是简单地使用它的日常（非技术）用法，并作为相当好的类比分别应用于这两个概念。

在第一种情况下（树数据结构的含义），描述*堆*是最合适的，因为“更大”的对象被放置在树的更高位置（其中“更大”由任意键函数确定） - 即有一种堆积较小的物体放在较大的物体上（或较大的物体放在上面，取决于您的想法）。这就是我的解释；最先将*堆*这个名字应用到这个数据结构上的人都认为这是一个合适的名字，但它只是卡住了。

在第二种情况下（RAM 块），堆的名称可能更明显一些。“堆”在这里只是“以高度任意顺序排列的大量事物的集合”，这似乎与动态分配的内存块一样适用于常见用法。

无论如何，我不会担心你可以在这两个想法之间得出抽象的隐喻相似性。完全分开对待它们，在任何情况下都不会出错。

**编辑：**似乎基于树的数据结构的名称*可能*来自抽象代数[堆](http://en.wikipedia.org/wiki/Heap_(mathematics))，这在计算机科学中相当普遍。但是，我不想确认或否认这一点......

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T16:16:17.267

请参阅此站点，以探索用于内存免费存储的[“堆”名称的起源。](https://stackoverflow.com/questions/660855/what-is-the-origin-of-the-term-heap-for-the-free-store)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-16T16:11:51.413

他们两个名字一样，就是这样。
那里的“堆”从未被安排为实际的堆数据结构。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T18:18:13.357

堆（数据结构）是这样调用的，因为如果你绘制它，它看起来像一个堆。堆（内存）被称为堆，因为它以某种方式组织但不完全。您在堆上积累数据，但其中可能存在漏洞和违规行为。就好像你把文件放在一堆一样。有时你会从底部移除一个。这有一种堆的形式，即以某种方式组织但不完全。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T16:11:26.000

他们……同名！而已。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T16:12:07.403

两者之间唯一的关系就是“堆”这个名字。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-22T12:41:59.607

使问题进一步复杂化：在某些系统（例如 Microsoft Windows）上，在内存分配意义上存在多个“堆”。[“The ”](http://msdn.microsoft.com/en-us/library/aa366569.aspx)*堆只是[*默认*](http://msdn.microsoft.com/en-us/library/aa366569.aspx)[堆](http://msdn.microsoft.com/en-us/library/aa366569.aspx)。但是，如果您调用[`HeapAlloc()`](http://msdn.microsoft.com/en-us/library/aa366597.aspx)，您可以从您想要子分配的内存分配中选择。*

 ** * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T16:11:51.053

没有什么。没有关系。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T16:17:41.587

来自 answers.com 的定义

堆：一组放置或抛出的东西，一个在另一个之上：一堆放在角落里的脏破布。

由于以无序的方式扔东西的概念形象，这只是基本的命名。正如其他海报指出的那样，堆不是作为堆数据结构组织的。这取决于系统库中的内存分配例程（例如检查 malloc 的工作方式）

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2022-02-17T01:40:25.347

堆是一种数据结构，它实际上是具有一些额外属性的完整二叉树。有两种类型的堆：

1.  最小堆
2.  最大堆

在最小堆中，根在树中具有最低值，当您弹出根时，下一个最低元素位于顶部。要将树转换为堆，我们使用 heapify 算法。它也被称为 C++ 中的优先级队列。通常作为一个有竞争力的程序员，我们将 STL 函数用于堆，这样我们就不必从头开始创建堆。最大堆正好相反，最大堆在根。通常使用堆，因为它具有 O(logN) 时间复杂度来删除和插入元素，因此甚至可以在 10^6 之类的严格约束下工作。

现在我可以理解你在内存中的堆和堆数据结构之间的混淆，但它们是完全不同的东西。数据结构中的堆只是存储数据的一种方式。

# sql - Postgres - 返回两个数组的交集的函数？

> ID：756871
> 
> 赞同：54
> 
> 时间：2009-04-16T16:10:56.047
> 
> 标签：sql, postgresql

在 postgresql 中，如果两个数组有共同的成员，即它们重叠，则可以使用 && 运算符返回 t (true)。是否有一个函数/运算符可以返回这些常见成员是什么？

即这样的东西

```
select arrray_intersection(ARRAY[1, 4, 2], ARRAY[2, 3]);
ARRAY[2] 
```

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2011-04-29T16:18:22.120

[自 8.4 以来，Postgres 中有一些有用的内置](http://www.depesz.com/index.php/2008/11/14/waiting-for-84-array-aggregate-and-array-unpacker/)函数，它们使[第一个答案中的函数](https://stackoverflow.com/questions/756871/postgres-function-to-return-the-intersection-of-2-arrays/756923#756923)更容易并且可能更快（这就是 EXPLAIN 告诉我的，无论如何：“（成本 = 0.00..0.07 行 = 1 宽度 = 64）”对于这个查询 vs . "(cost=0.00..60.02 rows=1 width=64)" 为原来的）。

简化的代码是：

```
SELECT ARRAY
    (
        SELECT UNNEST(a1)
        INTERSECT
        SELECT UNNEST(a2)
    )
FROM  (
        SELECT  array['two', 'four', 'six'] AS a1
              , array['four', 'six', 'eight'] AS a2
      ) q; 
```

是的，你可以把它变成一个函数：

```
CREATE FUNCTION array_intersect(anyarray, anyarray)
  RETURNS anyarray
  language sql
as $FUNCTION$
    SELECT ARRAY(
        SELECT UNNEST($1)
        INTERSECT
        SELECT UNNEST($2)
    );
$FUNCTION$; 
```

你可以称之为

```
SELECT array_intersect(array['two', 'four', 'six']
                     , array['four', 'six', 'eight']); 
```

但是您也可以将其称为内联：

```
 SELECT array(select unnest(array['two', 'four', 'six']) intersect
              select unnest(array['four', 'six', 'eight'])); 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-04-16T16:17:20.573

尝试`&`代替`&&`

有关更多信息，请参阅[PostgreSQL 文档](http://www.postgresql.org/docs/current/static/intarray.html)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-10-10T21:20:00.430

另一种方法..

```
SELECT ARRAY( SELECT * FROM UNNEST( $1 ) WHERE UNNEST = ANY( $2 ) ); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-05-24T16:52:09.027

如果您不介意安装扩展，则[intarray 扩展](https://www.postgresql.org/docs/current/static/intarray.html)为`&`操作员提供了执行此操作的功能，正如@dwc 指出的那样：

```
SELECT ARRAY[1, 4, 2] & ARRAY[2, 3]; 
```

退货`{2}`。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-17T09:12:28.433

您可以使用此功能：

```
CREATE OR REPLACE FUNCTION intersection(anyarray, anyarray) RETURNS anyarray as $$
SELECT ARRAY(
    SELECT $1[i]
    FROM generate_series( array_lower($1, 1), array_upper($1, 1) ) i
    WHERE ARRAY[$1[i]] && $2
);
$$ language sql; 
```

它应该适用于任何类型的数组，您可以像这样使用它：

```
SELECT intersection('{4,2,6}'::INT4[], '{2,3,4}'::INT4[]); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-16T16:23:57.453

```
SELECT  ARRAY
        (
        SELECT  a1[s]
        FROM    generate_series(array_lower(a1, 1), array_upper(a1, 1)) s
        INTERSECT
        SELECT  a2[s]
        FROM    generate_series(array_lower(a2, 1), array_upper(a2, 1)) s
        )
FROM    (
        SELECT  array['two', 'four', 'six'] AS a1, array['four', 'six', 'eight'] AS a2
        ) q 
```

也适用于非整数数组。

# java - 在 Java 应用程序中分析内存使用情况的最佳方法是什么？

> ID：756873
> 
> 赞同：24
> 
> 时间：2009-04-16T16:11:23.690
> 
> 标签：java, memory, profiling, profile

我意识到之前在 SO 上已经问过类似的问题，但让我准确描述一下我需要做什么：

我有一组运行命令行 java 应用程序的测试，我想向它们添加内存分析。我看到的一种选择是向我的应用程序添加代码（可能使用 3rd 方工具/库），以提供内存快照。另一种选择是使用第三方工具为我管理/检测我的应用程序和 JVM（理想情况下不需要我更改代码）。我正在考虑类似 Valgrind 的东西，但适用于 Java。如果可能的话，也开源。

我真正想做的是设置内存测试，以便定期（比如说每秒）监视我的内存使用情况，并将其转储到文本文件中。这样我就可以看到内存使用量是否随时间波动/增加/减少。我还可以计算最大和最小峰值。

这里有人做过这样的事吗？

提前致谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-16T16:16:12.603

使用 JProfiler 之类的东西，您需要做的就是向 JVM 添加某些参数。它使用 JVMTI。

我认为您应该阅读分析器以及它们可以为您做什么。我还建议阅读 JVMTI。

JVMTM 工具接口 (JVM TI) 是一种供工具使用的新本机编程接口。它提供了一种检查状态和控制在 Java 虚拟机 (JVM) 中运行的应用程序执行的方法。JVM TI 支持需要访问 JVM 状态的所有工具，包括但不限于：分析、调试、监控、线程分析和覆盖分析工具。

注意：JVM TI 取代了 Java 虚拟机分析器接口 (JVMPI) 和 Java 虚拟机调试接口 (JVMDI)。JVMPI 和 JVMDI 将在 J2SETM 的下一个主要版本中删除。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T16:30:21.697

[Yourkit](http://www.yourkit.com/overview/index.jsp)也有一个相当不错的分析器

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T16:24:31.537

你检查过吗

[VisualVM](https://visualvm.github.io/download.html)和[Eclipse-Callisto](http://www.onjava.com/pub/a/onjava/2006/08/16/profiling-with-eclipse-callisto.html?page=1)？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T17:43:54.030

一个好的起点是查看您的 JVM 是否支持“java -Xrunhprof”，因为这可以生成堆分析信息，而不会使您的场景更加复杂。

请参阅[http://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html](http://docs.oracle.com/javase/7/docs/technotes/samples/hprof.html)

你可能会发现这足以让你开始。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T16:31:38.573

一些分析器（例如[yourkit）](http://yourkit.com/)具有用于跟踪内存分配的 API。这里的另一个选择是监控工具，例如[jxinsight](http://www.jinspired.com/products/jxinsight/) 或[glassbox](http://www.glassbox.com/glassbox/Home.html)或[jamon](http://jamonapi.sourceforge.net/)

对于分析堆转储，[Eclipse 内存分析器](http://www.eclipse.org/mat/)是您可以获得的最佳工具。它是免费和开源的，因此您可以根据需要自动分析堆转储。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-17T15:26:28.563

我在 Eclipse 中开发，但我身边有 Netbeans 可以使用其出色的 Profiler。与一些商业产品相比，它是有限的，但仍然足以发现大多数瓶颈

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-26T10:40:12.377

您可以使用**jrcmd**，它是 JRockit JVM 附带的命令行实用程序。如果你知道 Java 进程的 pid，你可以这样做：

```
JROCKIt_HOME\bin\jrcmd <pid> print_object_summary 
```

它会给你：

```
31.8% 3198k    41907   -137k [C
11.9% 1196k      300     +0k [B
11.4% 1151k    49118     +6k java/lang/String
 6.1% 612k     5604     +0k java/lang/Class
 4.3% 431k     2388     +0k [I
 3.5% 353k    15097     +0k java/util/HashMap$Entry
 ... 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T16:36:17.983

除了上述答案之外，几年前我还喜欢使用 profiler。不知道这是否有帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-03-11T14:36:36.850

我推荐 dynaTrace 生产版。分析内存应用程序的惊人工具。低开销和 100% 的已执行事务。

# ruby-on-rails - 如何使控制台中的视图缓存片段过期？

> ID：756888
> 
> 赞同：18
> 
> 时间：2009-04-16T16:14:37.240
> 
> 标签：ruby-on-rails, ruby, caching, actionview

就像是

```
Rails.cache.delete('site_search_form') 
```

似乎不起作用。这可能吗？谢谢。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-08T05:12:44.873

ActionController::Base.new.expire_fragment(key)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T16:44:04.847

缓存片段条目的创建键与您使用 Rails.cache 访问的键稍有不同。

改为使用`expire_fragment`（您可以将其发送到控制器）：[http ://api.rubyonrails.org/classes/ActionController/Caching/Fragments.html#M000438](https://api.rubyonrails.org/v4.2/classes/ActionController/Caching/Fragments.html#method-i-expire_fragment)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-06-14T14:45:25.530

```
Rails.cache.delete "views/site_search_form" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-26T17:24:56.067

在 Rails 5 中，我采取了以下步骤来破坏缓存，而无需使用`skip_digest: true`. 我们的问题是更改 I18n 字符串的值不会反映在计算的缓存摘要中，因此缓存不会自动被破坏。

这是定义缓存块的视图：

```
/ views/layouts/_footer.html.slim
- cache :footer do
  span= t('shared.footer') 
```

然后在rails控制台中我运行：

```
fragment = ActionController::Base.new.view_context.cache_fragment_name(:footer, virtual_path: 'layouts/_footer.html.slim')
ActionController::Base.new.expire_fragment(fragment) 
```

`cache_fragment_name`将根据`virtual_path`关键字参数计算出摘要。

# python - 使用正则表达式匹配 HTML 中的一对注释

> ID：756898
> 
> 赞同：1
> 
> 时间：2009-04-16T16:17:03.180
> 
> 标签：python, regex, unit-testing, mako

我有一个看起来像这样的 mako 模板：

```
% if staff:
    <!-- begin staff -->
    ...
    <!-- end staff -->
% endif 
```

这样，如果我将工作人员变量作为 True 传递，那么应该会出现这些注释。我正在尝试使用如下所示的正则表达式来测试它：

```
re.search('<!-- begin staff -->.*<!-- end staff -->', text) 
```

我已验证评论出现在 HTML 输出中，但正则表达式不匹配。我什至尝试通过 re.escape放置评论（`<!-- begin staff -->`和），但仍然没有运气。`<!-- end staff -->`我究竟做错了什么？

或者有没有更好的方法来运行这个测试？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T16:21:01.017

默认情况下`.`不匹配换行符 - 您需要添加`re.DOTALL`选项。

```
re.search('<!-- begin staff -->.*<!-- end staff -->', text, re.DOTALL) 
```

如果您有多个员工部分，您可能还希望使匹配不贪心：

```
re.search('<!-- begin staff -->.*?<!-- end staff -->', text, re.DOTALL) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:22:47.237

[请改用HTMLParser](http://docs.python.org/library/htmlparser.html)之类的 HTML Parser 。请参阅[您能否提供一些示例，说明为什么使用正则表达式难以解析 XML 和 HTML？](https://stackoverflow.com/questions/701166/can-you-provide-some-examples-of-why-it-is-hard-to-parse-xml-and-html-with-a-rege)为什么。

# php - PHPMailer 和 SMTP：从远程服务器发送的邮件从不显示，在本地机器上工作正常

> ID：756899
> 
> 赞同：1
> 
> 时间：2009-04-16T16:17:13.023
> 
> 标签：php, linux, smtp, phpmailer

我有一个使用 PHPMailer 发送电子邮件的脚本。电子邮件通过直接 SMTP 连接发送到远程邮件服务器。问题是，虽然当我在本地机器上运行脚本时一切似乎都很好，但当脚本在我们的实时站点上使用同一个远程 SMTP 服务器运行时，电子邮件永远不会通过。令人好奇的是，它似乎曾在某个时间点起作用，并且最近决定它不再起作用了。

有哪些潜在的失败点？我无权访问有问题的 SMTP 服务器，因此我无法在不提交支持票的情况下检查其日志文件，虽然我刚刚获得了对发送电子邮件的 Web 服务器的 sudo 访问权限，但我不太确定我在寻找要通过的日志文件等方面的内容。

FWIW，我的本地机器运行的是 Ubuntu 8.10，而远程机器运行的是 Red Hat Enterprise Linux ES 版本 4（Nahant Update 1），所以版本有点不同，但我真正想要的是关于我应该在哪里寻找问题的一些指示。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:27:21.110

您如何登录您的实时站点，尝试打开与远程 SMTP 服务器的原始会话，并尝试使用原始 SMTP 命令发送电子邮件？这样做将有助于缩小问题的可能原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T16:19:48.133

远程机器是否在防火墙后面？如果是，它可能会阻止电子邮件的发送。或者您的 SMTP 服务器不允许来自远程服务器的访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T16:28:37.580

*   机器是否在防火墙后面？
*   SMTP 服务器是否配置为阻止某些主机，或者只允许某些主机？
*   SMTP 服务器是否只需要对某些网络进行身份验证？

您应该研究调试 PHPMailer，它应该能够提供原始 SMTP 请求和响应，您可以查看它们是否有任何问题。

# caching - 强制浏览器缓存对 Castle MonoRail 操作的请求？

> ID：756905
> 
> 赞同：1
> 
> 时间：2009-04-16T16:18:47.853
> 
> 标签：caching, http-headers, castle-monorail

在我们的项目中，我们有一大堆小的 css/js 文件，所以当我们构建视图时，我们会发现自己编写了很多`<link>`或`<script>`标签，迫使浏览器对我们的 css/js 内容提出许多请求。为了解决这个问题，我们开始寻找一种方法让服务器将所有这些都支持到一个请求中，该请求将与操作关联的每个 css 文件或每个 js 文件转储到响应中。

无需过多介绍，我们创建了一个 Helper 类，它接受文件、连接它们并呈现如下标签：

`<script type="text/javascript" src="/content/js15628453.rails"></script>`

ContentController 然后有一个默认操作，它使用“js15628453”来查找 Helper 存储连接文件的位置并将其输出。这真的很好用。

然而，正如 Firebug 报告的那样，浏览器总是向“/content/js15628453.rails”发送请求以获取连接文件，尽管 URL 始终相同并且响应始终相同。我已经尝试了所有类型的 HTTP `Cache-Control`、`Expires`、`Last-Modified`等标头组合，但还没有得到 Firebug 报告的从缓存中加载的内容。

为什么浏览器会忽略这些标头？有没有其他选项我可以尝试强制它被缓存？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T22:35:32.363

好吧，我想通了，所以为了那些可能在搜索引擎中找到这个的人的利益，我会继续回答我自己的问题。

基本上，我必须自己编写逻辑来设置 304 状态：

```
DateTime lastModified = // some date
string ifModifiedSince = Request.Headers["If-Modified-Since"];
if ( ifModifiedSince != null )
{
    var requestDate = DateTime.Parse( ifModifiedSince );
    if ( requestDate <= lastModified )
    {
        CancelView();
        Response.StatusCode = 304;
        return;
    }
}

Response.CachePolicy.SetLastModified( lastModified );

// Logic to write the file to the OutputStream 
```

我错误地假设浏览器只会使用它的缓存副本，如果它存在并且没有过期，而它显然需要询问服务器它的缓存副本是否仍然有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T20:33:46.977

@Tinister：实际上，您要做的是处理条件GET，即-当Get请求确实从客户端发送到服务器时，询问“您是否有比X更新的东西”，如果没有，服务器会说304。您确实避免了服务器生成 js 和 js 内容的流量，但是请求的成本（即 - 从浏览器向服务器发送 http 请求）仍然存在。这些东西由 Last-Modified/IfMOdifiedThen 标头（一个用于响应，一个用于请求）和/或 ETAG 标头处理。

缓存是另一回事——即当浏览器决定根本不发出 GET 请求时。它由“Expires”标头或 Cache-control 标头管理。

您可能在某处设置了 Cache-Control 标头，它使客户端忽略“过期”。尝试设置“max-age 360​​0”或类似的东西，看看请求是否被缓存（忘记FB - 而是设置断点或登录服务器以确保它没有被调用）

话虽如此 - 在处理 js/css 文件时 - 您可能不需要*实际*的缓存。那是因为如果浏览器确实决定缓存，比如说一个星期，那么你不能强迫它重新加载一个新版本。因此，如果您将新版本部署到服务器，客户端将在一周过去之前看到它，无论新资源的新时间（oe etag）是什么 - 因为它甚至不会发出条件 GET 请求.

一种解决方案（如果您真的想减轻网络压力）是设置缓存的最长时间（比如一年），并且当资源更改时，您更改 URI（按原样 - 添加任意查询字符串值）。这将强制浏览器重新加载新的 js 资源，并且不再打扰服务器，至少在下一次更新 + 下一个资源 URI 之前

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T21:46:26.830

我注意到，至少 firefox 在计算它是否甚至处理 HEAD 请求以检查“未修改”（304）响应代码时似乎使用了初始请求中的“最后修改”标记。

拥有一个非常旧的“最后修改”时间戳似乎会导致它不检查文件的任何新版本，除非明确要求。

但是，我不会严重依赖它。

# c++ - 初始化后可以调整 C++ 数组的大小吗？

> ID：756906
> 
> 赞同：9
> 
> 时间：2009-04-16T16:18:47.887
> 
> 标签：c++, arrays, resize, sizeof

我正在学习编程，而 C++ 是我的第一语言。不要费心用指针给我看——我还不明白它们，在我有更多空闲时间来做这件事之前不会打扰。

```
 int mergeSort()
{
    const int n = 9;
    int originalarray[n] = {1, 3, 5, 7, 9, 2, 4, 6, 8};

    const int halfelements = (sizeof(originalarray) / sizeof(int)) / 2;
    int farray[halfelements];
    int sarray[halfelements];

    for (int i = 0; i < halfelements; i++) {
        farray[i] = originalarray[i];
    }

    for (int i = halfelements, x = 0; i < (halfelements * 2); i++, x++) {
        sarray[x] = originalarray[i];
    } 
```

我被分配了一个合并排序算法（我没有上课——只是和几个帮助我的朋友一起学习），解释了算法，但没有解释实现。我想重写它，以便它适用于奇数和偶数整数。我尝试添加此代码：

```
if ((n % 2) != 0) int farray[halfelements + 1]; 
```

这样我就可以使用相同的整数来迭代两个后续数组。sizeof(farray) 显示为 16 个字节或 4 个整数。所以它没有调整大小。我想知道 - 初始化后是否可以调整数组大小？

编辑：我将如何实现向量？我不明白如何在循环中使用迭代器来迭代和复制值。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-16T16:20:47.990

C++ 数组的大小是固定的。

如果您需要“可调整大小的数组”，则需要使用[std::vector](http://en.wikipedia.org/wiki/Vector_(STL))而不是数组。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T16:45:51.317

我的建议更强烈：`std::vector<>`除非您有充分的理由使用 C 样式数组，否则请使用 (et. al.)。由于您正在学习 C++，我怀疑您是否有这样的原因：**使用`std::vector<>`**.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T17:26:53.587

我也会推荐`std::vector`。但是，如果您被数组困住，您可以随时`malloc`使用内存，然后`realloc`如果您需要使数组更大。

在 SO 上进行搜索，有关于`malloc`和的信息`realloc`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T16:21:09.690

如果要调整数组的大小，可能需要使用可以自动调整大小的向量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T16:52:17.277

您可以像在数组中一样将 [] 运算符与向量一起使用。您可以使用类似这样的向量来实现这一点（如果您想使用更多向量方法）：

```
#include <vector>

const int halfelements = originalarray.size()/2; //use size to get size
vector <int> farray(halfelements);
vector <int> farray(halfelements);

for (int i = 0; i < halfelements; i++) {
    farray.push_back(originalarray[i]); //adds element at i to the end of vector
}

for (int i = halfelements, x = 0; i < (halfelements * 2); i++, x++) {
    sarray.push_back(originalarray[i]);
} 
```

您还可以使用 .at(index) 将边界检查添加到向量访问。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T17:23:18.947

如果您想知道为什么您的第一个想法已编译但似乎不起作用：

当您在 if 语句中省略大括号时：

```
if ((n % 2) != 0) int farray[halfelements + 1]; 
```

就像您使用它们一样：

```
if ((n % 2) != 0) {
  int farray[halfelements + 1];
} 
```

所以它正在制作一个正确大小的“farray”——然后它立即超出范围并消失了，你只剩下原始的了。

# objective-c - 这是一个objective-c内存泄漏吗？

> ID：756908
> 
> 赞同：2
> 
> 时间：2009-04-16T16:19:45.387
> 
> 标签：objective-c, cocoa, memory-leaks

我知道，如果您执行以下操作，您肯定会发生内存泄漏：

```
id foo = [[NSObject alloc] init];
foo = nil; 
```

但是，如果你使用 self.foo，一个带有保留的属性呢？而您的代码如下所示：

```
foo = [[NSObject alloc] init];
self.foo = nil; 
```

这仍然是内存泄漏，因为访问器在将内存设置为 nil 之前先释放内存？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T16:32:08.773

`self.foo = nil`将转化为

```
[nil retain]
[foo release]
foo = nil 
```

这里没有内存泄漏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:32:21.973

不，第二个例子不是内存泄漏。事实上，这就是我在方法中处理`retain`属性的`dealloc`方式。它只是清洁了很多。

你唯一需要注意的是确保不要写

```
self.foo = [[NSObject alloc] init]; 
```

否则，您将双重保留该对象并最终导致内存泄漏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:00:30.140

到目前为止，所有答案都假设第二个示例第一行中的“<code>foo”是`foo`属性后面的实例变量。这是默认行为。

如果`foo`第一行分配给的 是一个局部变量，那么该`foo`属性是无关紧要的，并且您将泄漏该对象，除非您稍后在该方法中释放它。

如果`foo`是一个实例变量，但该`foo`属性实际上由不同的实例变量支持，或者根本没有实例变量，那么 (a) 您正在编写难以维护的代码，并且 (b) 它可能是泄漏。

最后，呼应前面的答案：如果`foo`是支持属性的实例变量`foo`，那么这不是泄漏，因为`setFoo:`您在第二行中调用的方法将释放您在`foo`第一行中放入实例变量中的对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T16:40:34.947

属性使您的代码看起来像赋值，但实际上它们与您可能在 Obj-C 2.0 之前自己编写的传统访问器方法相同。使用属性 O​​bj-C 只是在幕后为您生成访问器方法，而不是使用您在声明中指定的关键字（假设您使用 @synthesize 并且无论如何都不编写自己的访问器方法）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T16:57:34.830

不，没有内存泄漏。第二个示例中的代码在逻辑上等同于

```
foo = [[NSObject alloc] init];
[nil retain];
[foo release];
foo = nil; 
```

因为@synthesized setter 在逻辑上等价于

```
- (void)setFoo:(id)newFoo {
  [newFoo retain];
  [foo release];
  foo = newFoo;
} 
```

值得注意的是，`foo`直接设置可能不是您想要在 init 方法之外执行的操作。如果您`foo`直接分配一个值，您将绕过自动 KVO 通知（您必须将您的分配包装成一`willChangeValueForKey:/didChangeValueForKey:`对）*并且*如果它覆盖该`setFoo:`方法，您会破坏任何子类的行为，期望所有修改`foo`都通过设置器。

您直接`foo`在 init 方法中分配，因为该`setFoo:`方法或子类的覆盖`setFoo:`方法可能有副作用或取决于实例的完全初始化。

同样，出于同样的原因，您将使用`[foo release]`而不是`self.foo = nil;`在`-dealloc`方法中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T16:37:54.063

我不这么认为，因为这样做`self.foo = nil`实际上是在使用 setter 并免费获得内存管理。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-01T20:09:14.813

因为似乎没有其他人注意到：***可能*****有泄漏。**

 *我假设`foo`它既是 ivar 又是`retain`属性：

```
@interface Foo : NSObject {
  NSObject * foo;
}
@property (nonatomic, retain) NSObject * foo;
@end 
```

假设您的代码如下所示：

```
-(void)bar {
  foo = [[NSObject alloc] init];
  self.foo = nil;
} 
```

这本身不会泄漏*，前提`foo`是从零开始*。这并不意味着它不会泄漏——假设您添加了更多代码：

```
-(void)baz {
  self.foo = [[NSObject new] autorelease];
}

-(void)fubar {
  [self baz];
  [self bar];
} 
```

类似的东西`foo = [[Foo alloc] init]`在 -methods 中通常是安全的，`init`因为它假定您只调用其中一个，因此`foo`保证`nil`最初是这样的。在其他任何地方，您都必须更加小心。

```
// Use assertions so it crashes debug builds if it's already set
assert(!foo);
foo = [[NSObject alloc] init];
self.foo = nil;

// Or release explicitly.
[foo release];
foo = [[NSObject alloc] init];
self.foo = nil;

// Or just use the setter, which will do the "right thing".
// This is particularly relevant for "copy" or "assign" accessors.
self.foo = [[[NSObject alloc] init] autorelease];
self.foo = nil; 
```

# c# - 为什么我的静态方法隐藏了我的实例方法？

> ID：756917
> 
> 赞同：6
> 
> 时间：2009-04-16T16:22:12.137
> 
> 标签：c#, .net

下面的代码是否应该给出警告？

```
class Foo { public void Do() { /*...*/ } /*...*/ }
class Bar : Foo { public static void Do()  { /*...*/ } /*...*/ } 
```

它给：

> “警告 CS0108：'Bar.Do()' 隐藏继承的成员 'Foo.Do()'。如果打算隐藏，请使用 new 关键字。”

如果我对代码进行更改：

```
class Foo { public static void Do() { /*...*/ } /*...*/ }
class Bar : Foo { public void Do()  { /*...*/ } /*...*/ } 
```

我得到同样的警告。

但是，如果我进行以下更改，警告就会消失。

```
class Foo { public void Do() { /*...*/ } /*...*/ }
class Bar : Foo { new public static void Do() { /*...*/ } /*...*/ } 
```

让我做一个进一步的改变：

```
class Foo { public void Do() { /*...*/ } /*...*/ }
class Bar : Foo { 
    new public static void Do() 
    { new Bar().Do();/*...*/ } /*...*/ 
} 
```

这不会编译：

> “错误 CS0176：无法使用实例引用访问成员 'Bar.Do()'；改为使用类型名称对其进行限定。”

因此，我无法通过静态方法的实例引用访问我的继承方法！

其背后的逻辑是什么？还是我在某个地方打错字了？

当我试图为从“表单”派生的表单定义静态方法“显示”时，我遇到了这个问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T16:36:17.563

你认为错误在哪里？有警告的事实是绝对正确的。从 C# 3.0 规范，第 10.3.4 节：

> 类成员声明允许声明与继承成员具有相同名称或签名的成员。发生这种情况时，就说派生类成员隐藏了基类成员。隐藏继承的成员不被视为错误，但它确实会导致编译器发出警告。为了抑制警告，派生类成员的声明可以包括一个新的修饰符，以指示派生成员旨在隐藏基成员。

您的方法调用失败的事实更微妙，但这基本上是因为成员查找算法选择了静态方法，然后使用了第 7.5.5.1 节的这一部分：

> 执行所选最佳方法的最终验证：
> 
> 该方法在方法组的上下文中进行验证：如果最佳方法是静态方法，则方法组必须是由简单名称或通过类型的成员访问产生的。如果最好的方法是实例方法，那么方法组必须是由简单名称、通过变量或值的成员访问或基本访问产生的。如果这些要求都不满足，则会发生编译时错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:24:57.607

不，这完全有道理。这按预期工作：

```
using System;
using System.Collections.Generic;

class Foo { public void Do() { /*...*/ } /*...*/ }
class Bar : Foo { 
    new public static void Do() 
    { ((Foo)new Bar()).Do();/*...*/ } /*...*/ 
} 
```

那是因为编译器假定你有一个 Bar 类型，然后找到静态成员。通过将其转换为 Foo（顺便说一句，它是免费的），您可以让它在 Foo() 的元数据中查找，一切都很好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T16:26:26.370

试试这个：

```
 new public static void Do()
        { 
            ((Foo)new Bar()).Do(); 
        } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-18T20:06:35.013

你应该可以通过调用 base.Do() 而不是 Bar().Do() 来调用它

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T16:26:31.597

在您的最终代码示例中，Bar.Do() 声明中的 new 关键字意味着您打算隐藏 Foo.Do()。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T16:27:48.567

出于好奇，你为什么要这样做？似乎您可能以错误的方式解决您的解决方案。

上面的代码似乎可以正常工作，并且编译器消息会告诉您问题所在。

# silverlight - Silverlight StackPanel 溢出检测

> ID：756918
> 
> 赞同：0
> 
> 时间：2009-04-16T16:22:15.770
> 
> 标签：silverlight, silverlight-2.0, stackpanel

还没有开始这个，但我知道我必须在接下来的几周内解决它..

我正在 Silverlight 2 中创建一个简单的单行工具栏（带按钮的水平 StackPanel），并且需要检测浏览器的宽度何时开始与按钮发生冲突。

碰撞时，我将显示一个“溢出”指示器，该指示器附加到下拉菜单并将碰撞按钮移动到那里。

和IE工具栏一模一样。。

有任何想法吗？

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T19:24:34.210

您可以尝试将 Silverlight 代码中的事件连接到浏览器的调整大小事件：

```
void Page_Loaded(object sender, RoutedEventArgs e)
{
  System.Windows.Browser.HtmlPage.Window.AttachEvent("resize", BrowserResized);
}

void BrowserResized(object sender, System.Windows.Browser.HtmlEventArgs e)
{
  //TODO: things
} 
```

我找到了这个链接（[这里](http://www.jeff.wilcox.name/2008/06/browserscreeninformation/)），它讨论了从 Silverlight 2 中获取实际浏览器大小。

也许有一种更简单的方法，但乍一看，这似乎可行。

# c# - WinForms 中的进度条

> ID：756932
> 
> 赞同：2
> 
> 时间：2009-04-16T16:26:51.750
> 
> 标签：c#, .net, winforms

我需要在两个表单之间插入一个进度条，当我单击按钮打开一个窗口时我有一个主表单我需要等待加载最后一个窗口（'因为最后一个表单上有很多图片要下载）我决定使用进度条来显示打开请求的窗口的剩余时间。现在我不知道如何在代码中实现此功能（这是我第一次使用进度条）。你有什么建议可以帮助我解决这个功能吗？感谢您的关注。

PS .对不起我的英语不好

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T16:33:57.583

这是一个简单的例子......

您应该知道的 ProgressBar 类只有三个成员。最大值、最小值和值属性。

您可以使用 ProgressBar 构造函数创建进度条控件。

```
this.progressBar1 = new System.WinForms.ProgressBar(); 
```

创建进度条的实例后，您可以使用 ProgressBar 的 Minimum 和 Maximum 属性设置进度条的范围。

```
progressBar1.Maximum = 200;
progressBar1.Manimum=0; 
```

Step 属性用于设置进度条中的步骤数。

```
progressBar1.Step=20; 
```

Value 属性用于设置状态栏的当前值。

```
protected void displayProgress (object sender, System.EventArgs e)

{

    if (progressBar1.Value >= 200 )

    {

        progressBar1.Value = 0;

        return;
    }

    progressBar1.Value += 20;

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T16:37:28.310

我建议在您的 Winforms 应用程序中实现[BackgroundWorker对象。](http://msdn.microsoft.com/en-us/library/8xs8549b(loband).aspx)

这将提供一种简单的多线程方法来执行处理密集型操作，而不会锁定您的应用程序。您可以将它与 ProgressBar 结合使用，或者您甚至可以设置自己的流程指示器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T22:22:50.990

如果您知道新窗口将下载多少张图片，则实现进度条相当容易。

只需在 Visual Studio 的表单设计器中将进度条放在表单的某个位置即可。现在您可以在代码中使用进度条，如下所示：

```
MyProgressBar.Minimum = 0;
MyProgressBar.Maximum = TotalPicturesToDownload;

for (int i = 1; i<= TotalPicturesToDownload; i++)
{
//Do whatever necessary to download picture nr i
//....

//Update the progressBar
MyProgressBar.Increment(1);

} 
```

就像已经提到的那样，建议不要在 UI 线程中执行此操作，而是在单独的线程中执行此操作（例如使用 BackGroundWorker），否则您的表单可能会冻结并使您的进度条无法更新。

# .net - (.NET/C#/winforms) 在带有图形的表单上绘制时出现伪影

> ID：756933
> 
> 赞同：1
> 
> 时间：2009-04-16T16:27:00.300
> 
> 标签：.net, winforms, graphics, gdi+, doublebuffered

我的目标是移动使用 Graphics 对象的方法绘制的可视元素在没有闪烁或伪影的情况下（在 .NET 3.5 中）在 Form 上移动。我可以通过使用自动双缓冲（将 Form 的 DoubleBuffered 属性设置为 true）或自己实现后缓冲来成功实现无闪烁移动。然而，我正在努力寻找一种方法来使用这两种方法，而不会显示清晰可见的伪影。

使用自动双缓冲时，页面撕裂效果很明显。在我的 60Hz LCD 的多达 3 次刷新过程中，似乎后台缓冲区正在缓慢地、逐步地​​从上到下复制到表单中。

当我自己实现双缓冲时（有关详细信息，请参阅代码块），它看起来好像后台缓冲区被复制到表单的速度足够快，不会发生页面撕裂。然而，有时会出现另一种类型的伪影。下面的代码允许您使用箭头键在窗体上左右移动白色背景上的蓝色矩形，应该将效果再现为一系列水平的白色带，这些带有时会出现在矩形的左右边缘就像它被移动一样。

```
public partial class Form1 : Form {
    int x;
    Bitmap buffer;

    public Form1() {
        InitializeComponent();
        buffer = new Bitmap(Width, Height);
    }

    private void Form1_Paint(object sender, PaintEventArgs e) {
        Graphics g = Graphics.FromImage(buffer);
        g.Clear(Color.FromArgb(255, 255, 255));
        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
        g.FillRectangle(Brushes.Blue, x, 0, 100, 500);
        e.Graphics.DrawImageUnscaled(buffer, 0, 0);
    }

    protected override void OnPaintBackground(PaintEventArgs pevent) {
        //Don't allow the background to paint
    }

    private void Form1_KeyDown(object sender, KeyEventArgs e) {
        const int scrollSpeed = 20;
        if(e.KeyData == Keys.Left) {
            x -= scrollSpeed;
            Refresh();
        }
        else {
            if(e.KeyData == Keys.Right) {
                x += scrollSpeed;
                Refresh();
            }
        }
    }
} 
```

if（其他人能够重现效果）{
    我做错了什么，可能
    在绘画代码中触发了某种竞争条件，或者
    这只是我必须
    忍受的运行时行为？
}
else {
    这可能是我的显卡的特性或
    显示驱动程序有问题吗？
}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:34:46.770

了解加速 2D 操作的显卡通常会加速 GDI，而不是 GDI+，这可能很重要。我认为使用 GDI 位图并使用 GDI 方法（例如通过 p/invoke）直接绘制它会使事情变得更快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:44:40.227

每当我完成双缓冲时，我都会确保在 Paint 事件中没有渲染代码；事件中唯一的代码是从缓冲区复制到屏幕。

尝试将渲染代码移动到它自己的函数中，然后使区域无效（在本例中为表单）：

```
RenderScene()
Invalidate() 
```

看看是否有帮助。为了更好地衡量，覆盖 OnResize 以调整缓冲区的大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T17:33:22.060

除了 overslacked 所说的使用之外`Invalidate`，您还不需要抗锯齿来填充没有应用变换的矩形。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T16:41:12.340

当按下一个键并释放时，它实际上看起来“很好”（尽管如果你按住键，在下一步移动时会有一点撕裂会自行解决）。

我在 Vista 上使用 ATI x1300 和 Intel e6400。也许处理速度或您的视频卡是一个问题？

编辑：上面说的是，我同意其他人的观点，如果你正在寻找快速的话，GDI+ 不是要走的路。DirectX 或使用 Windows API 可能是要走的路。

# sql-server - SQL Server 整个数据库 csv 导出

> ID：756936
> 
> 赞同：0
> 
> 时间：2009-04-16T16:27:45.883
> 
> 标签：sql-server, export, dts

我的客户雇用的一位顾问要求以 csv 格式导出我们的一个 SQL Server 2000 数据库中所有表的前 n 行（大约 30 或 40），包括第一行的列名。该数据库有大约 100 个表，所以我不想手动执行此操作。

任何人都可以推荐可以快速执行此操作的脚本、工具或其他方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T16:42:02.527

从企业经理那里试试这个

```
EXEC sp_MSForEachTable 'SELECT top 30 * from ?' 
```

这将为您提供*当前*数据库中每个表的前 30 条记录。您可以将结果输出到文本文件

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:32:50.630

您可能会使用 SQL Server 2000 的 DTS（数据转换服务）并将所有内容导出到 Excel 工作表中，不是吗？

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:08:31.293

如果它们不是相关的行，前 30 行将毫无用处。如果他不打算将它们用作测试数据（如果客户表在作为订单表的前 30 行中具有不同的客户 ID，他也不能），那么为什么不直接给他模式呢？

还要警惕向某人提供真实数据以用于开发目的。

# linq - ContextSwitchDeadLock SQLCE LINQ 查询

> ID：756938
> 
> 赞同：1
> 
> 时间：2009-04-16T16:28:20.360
> 
> 标签：linq

有没有人在你的程序执行中**随机遇到**这样的“ContextSwitchDeadLock”异常？

我有一个针对 SQL CE 源的查询 linq，一个非常简单的

```
From Entry in DataContext.Resources Select Entry Where Entry.Key = Key 
```

-Key 是字符串类型。

在我查询之后，每当我尝试迭代结果时，程序都会卡在 foreach Next... 一段时间后，它会响应一个对话框，告诉我 ContextSwitchDeadlock。

我对此没有答案。谷歌也没有；这太随机了，无法调试。它发生在我其他时候，我没有解决它，我只是使用 ADO 解决它。但是我真的厌倦了在不知道到底发生了什么以及我做错了什么的情况下得到这个错误。

任何帮助将非常感激

问候

哈维尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-27T02:01:02.907

是的！经过多次谷歌搜索，我发现了这篇文章，它似乎在谈论相同的行为（尽管我没有——也许你没有——使用 Xceed 的网格）：

[http://xceed.com/CS/forums/thread/20710.aspx](http://xceed.com/CS/forums/thread/20710.aspx)

Xceed 查找了该问题，并认为这是由于 LINQ 使用的 SqlCeConnection 存在问题。这里有一张票，MS 说它已在 SQL Server Compact 的下一版本中修复（我认为他们的意思是 3.5 SP2，目前处于测试阶段）：

[https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=411912&wa=wsignin1.0](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=411912&wa=wsignin1.0)

我还没有在测试版中尝试过，但是当我切换到 SQL Server Express 2008 时，我确实看到问题消失了。

# c# - 验证列表是否正确排序的 lambda 表达式

> ID：756939
> 
> 赞同：2
> 
> 时间：2009-04-16T16:28:31.187
> 
> 标签：c#, linq, lambda

我想编写一个 lambda 表达式来验证列表是否正确排序。我有一个列表，其中一个人具有 Name 属性，例如：

```
IList<Person> people = new List<Person>();
people.Add(new Person(){ Name = "Alan"});
people.Add(new Person(){ Name = "Bob"});
people.Add(new Person(){ Name = "Chris"}); 
```

我正在尝试测试该列表是否按 Name 属性排序为 ASC。所以我想要类似的东西

```
Assert.That(people.All(....), "list of person not ordered correctly"); 
```

如何编写一个 lambda 来检查列表中的每个人的名称是否小于列表中的下一个人的名称？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T16:45:39.537

这是 Jared 解决方案的替代方案 - 几乎相同，但使用 foreach 循环和布尔变量来检查这是否是第一次迭代。我通常发现这比手动迭代更容易：

```
public static bool IsOrdered<T>(this IEnumerable<T> source)
{
  var comparer = Comparer<T>.Default;
  T previous = default(T);
  bool first = true;

  foreach (T element in source)
  {
      if (!first && comparer.Compare(previous, element) > 0)
      {
          return false;
      }
      first = false;
      previous = element;
  }
  return true;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T16:37:22.100

我不相信目前有任何 LINQ 运算符涵盖这种情况。但是，您可以编写一个 IsOrdered 方法来完成这项工作。例如。

```
public static bool IsOrdered<T>(this IEnumerable<T> enumerable) {
  var comparer = Comparer<T>.Default;
  using ( var e = enumerable.GetEnumerator() ) {
    if ( !e.MoveNext() ) {
      return true;
    }
    var previous = e.Current;
    while (e.MoveNext()) {
      if ( comparer.Compare(previous, e.Current) > 0) {
        return false;
      }
      previous = e.Current;
    }
    return true;
  }
} 
```

然后您可以使用以下内容来验证您的列表：

```
var isOrdered = people.Select(x => x.Name).IsOrdered(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-13T15:03:22.830

我知道这是一个老问题，但我有一个使用 Linq 的非常好的解决方案：

```
people.Zip(people.OrderBy(p => p.Name), (a, b) => a == b).All(eq => eq); 
```

基本上，您正在将一个序列与有序序列合并，并投影一个 bool 值，指示两个条目是否相等：

```
"Alan"  -- "Alan"  => true
"Bob"   -- "Bob"   => true
"Chris" -- "Chris" => true 
```

然后用`All`你询问集合中的所有项目是否都是`true`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-31T06:08:34.260

关于什么：

```
people.SequenceEqual( people.OrderBy( x=>x.Name ) ); 
```

SequenceEqual() 从 3.5 开始可用 如果要确认没有重复项，可以在 OrderBy() 之后添加 Distinct()。

# asp.net-mvc - ASP.NET MVC 应用程序的令人费解的行为

> ID：756944
> 
> 赞同：0
> 
> 时间：2009-04-16T16:30:00.357
> 
> 标签：asp.net-mvc, html-helper

我的索引视图上有一个简单的搜索页面，带有一个下拉列表和一个文本框。我想记住用户对下拉菜单的偏好，所以我将它存储在一个表中并根据需要检索它。这是控制器功能：

```
Function Index(ByVal lob As String, ByVal filter As String) As ActionResult
    If If(lob, "") = "" Then
        lob = GetUserPreferenceLob()
    End If
    ViewData("lob") = New SelectList(GetLobValues(), "Value", "Text", lob)
    ViewData("message") = lob
    Return View()
End Function 
```

视图如下所示：

```
<% Using Html.BeginForm()%>
Line of Business:
<%=Html.DropDownList("lob", Nothing, New With {.onchange = "document.forms[0].submit()"})%>
Search:
<%=Html.TextBox("filter")%>
<img src="..." alt="Search" onclick="document.forms[0].submit()" />
<%=ViewData("message")%>
<% End Using%> 
```

当我启动应用程序（这是默认页面）时，它成功加载列表并选择用户的项目。但是，如果我导航到该页面，例如通过页面上其他位置的链接，它会加载列表但默认选择第一项。我已经运行了调试器，它总是通过 Index 函数，并且根据“消息”输出，它总是传递要选择的正确值，那么为什么这种情况没有在列表中选择正确的条目呢？

**更新：**我在表单上还有其他数据，这些数据取决于下拉列表中的选定值。通过链接导航到页面时，页面的其余部分的行为就像选择了适当的项目一样，但下拉菜单默认位于顶部。换句话说，如果我的下拉列表有值“A”、“B”和“C”，并且我选择“C”，然后单击重新加载页面的链接，下拉列表显示“A”，但其余部分该页面具有“C”的数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:34:28.957

您是否在点击页面链接后尝试刷新页面。它可能是本地缓存的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T16:47:02.997

可能是缓存...

[在此处](https://stackoverflow.com/questions/533867/whats-the-best-method-for-forcing-cache-expiration-in-asp-net)查看此相关线程（堆栈溢出）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T07:48:27.343

我对 TextBoxes 有一个非常相似的问题：

在我的页面上，我使用 Html.TextBox("Attribute", Model.Attribute) 呈现一个文本框。用户在此文本框中输入一个值，然后按下一个按钮。在执行的代码中，我为模型的属性计算一个新值，然后再次渲染视图。Html.TextBox("Attribute", Model.Attribute) 仍然显示用户输入的值，而 Html.Encode(Model.Attribute) 显示来自模型的正确值。

似乎 Html.TextBox 更喜欢显示用户输入的值而不是模型中程序员修改的值。因此，Html.TextBox 似乎没有显示其第二个输入参数的值，而是显示 ViewData.ModelState["Atrribute"].Value.RawValue。

所以我只是在往返中更改视图状态和模型。

# c# - 如何获取活动的 Excel 实例？

> ID：756951
> 
> 赞同：3
> 
> 时间：2009-04-16T16:32:30.707
> 
> 标签：c#, excel

我有一个 C# 应用程序，此应用程序根据用户需求将信息粘贴到 excel 中，背后的逻辑是这样的，如果没有运行 excel 实例，它会创建一个并粘贴到该实例。

如果只有一个实例在运行，它会尝试获取该实例并使用它。这是我用来这样做的代码：

```
Guid _guid;
CLSIDFromProgID("Excel.Application", out _guid);
if (_guid == Guid.Empty) {...}
IntPtr _ptr = new IntPtr();
GetActiveObject(ref _guid, _ptr, out objApp);
```

到目前为止一切正常，但我遇到的问题是当有多个 excel 实例运行时，我想获取 Excel 的活动实例，但目前我只能获取我打开的第一个实例，它根据我阅读的内容，是在运行对象表中注册的第一个实例。

有没有办法“询问”一个excel实例是否是活动实例并因此使用它？或者我怎样才能获得活动实例？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T16:38:38.867

有关获取或启动 Excel 的所有可能性，请参阅 Andrew Whitechapel 的这篇博文：

> [以编程方式启动 Office 应用程序](http://blogs.msdn.com/andreww/archive/2008/11/30/starting-or-connecting-to-office-apps.aspx)

如果您可以获得“活动”Excel 实例的窗口句柄，您可能想尝试一下`AccessibleObjectFromWindow`，这将使您能够访问 OM。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2016-02-24T18:17:54.487

我创建了一个类，它可以遍历所有正在运行的 Excel 实例，并通过 Hwnd、ProcessID 或 Process 对象进行查找。它还具有返回“活动”实例（根据 Marshal 类）的属性，该实例是双击 Excel 文件图标将在其中打开的实例，以及最顶部的实例，即顶部的实例- 大多数窗口。

代码如下，但请查看此链接以获取更多说明。

[http://www.codeproject.com/Tips/1080611/Get-a-Collection-of-All-Running-Excel-Instances](http://www.codeproject.com/Tips/1080611/Get-a-Collection-of-All-Running-Excel-Instances)

这尚未在所有版本的 Excel 或 Windows 上进行测试。

* * *

代码：

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Runtime.InteropServices;

//Don't add the entire interop namespace, it will introduce some naming conflicts.
using xlApp = Microsoft.Office.Interop.Excel.Application;
using xlWin = Microsoft.Office.Interop.Excel.Window;

namespace ExcelExtensions {

    /// <summary>
    /// Collection of currently running Excel instances.
    /// </summary>
    public class ExcelAppCollection : IEnumerable<xlApp>  {

        #region Constructors

        /// <summary>Initializes a new instance of the 
        /// <see cref="ExcelAppCollection"/> class.</summary>
        /// <param name="sessionID">Windows sessionID to filter instances by.
        /// If not assigned, uses current session.</param>
        public ExcelAppCollection (Int32? sessionID = null) {
            if (sessionID.HasValue && sessionID.Value < -1)
                throw new ArgumentOutOfRangeException("sessionID");

            this.SessionID = sessionID
                ?? Process.GetCurrentProcess().SessionId;
        }

        #endregion

        #region Properties

        /// <summary>Gets the Windows sessionID used to filter instances.
        /// If -1, uses instances from all sessions.</summary>
        /// <value>The sessionID.</value>
        public Int32 SessionID { get; private set; }

        #endregion

        #region Accessors

        /// <summary>Gets the Application associated with a given process.</summary>
        /// <param name="process">The process.</param>
        /// <returns>Application associated with process.</returns>
        /// <exception cref="System.ArgumentNullException">process</exception>
        public xlApp FromProcess(Process process) {
            if (process == null)
                throw new ArgumentNullException("process");
            return InnerFromProcess(process);
        }

        /// <summary>Gets the Application associated with a given processID.</summary>
        /// <param name="processID">The process identifier.</param>
        /// <returns>Application associated with processID.</returns>
        public xlApp FromProcessID(Int32 processID) {
            try {
                return FromProcess(Process.GetProcessById(processID));
            }
            catch (ArgumentException) {
                return null;
            }
        }

        /// <summary>Get the Application associated with a given window handle.</summary>
        /// <param name="mainHandle">The window handle.</param>
        /// <returns>Application associated with window handle.</returns>
        public xlApp FromMainWindowHandle(Int32 mainHandle) {
            return InnerFromHandle(ChildHandleFromMainHandle(mainHandle));
        }

        /// <summary>Gets the main instance. </summary>
        /// <remarks>This is the oldest running instance.
        /// It will be used if an Excel file is double-clicked in Explorer, etc.</remarks>
        public xlApp PrimaryInstance {
            get {
                try {
                    return Marshal.GetActiveObject(MarshalName) as xlApp;
                }
                catch (COMException) {
                    return null;
                }
            }
        }

        /// <summary>Gets the top most instance.</summary>
        /// <value>The top most instance.</value>
        public xlApp TopMostInstance {
            get {
                var topMost = GetProcesses() //All Excel processes
                    .Select(p => p.MainWindowHandle) //All Excel main window handles
                    .Select(h => new { h = h, z = GetWindowZ(h) }) //Get (handle, z) pair per instance
                    .Where(x => x.z > 0) //Filter hidden instances
                    .OrderBy(x => x.z) //Sort by z value
                    .First(); //Lowest z value

                return FromMainWindowHandle(topMost.h.ToInt32());
            }
        }

        #endregion

        #region Methods

        /// <summary>Returns an enumerator that iterates through the collection.</summary>
        /// <returns>
        /// A <see cref="T:System.Collections.Generic.IEnumerator`1" /> 
        /// that can be used to iterate through the collection.
        /// </returns>
        public IEnumerator<xlApp> GetEnumerator() {
            foreach (var p in GetProcesses())
                yield return FromProcess(p);
        }
        IEnumerator IEnumerable.GetEnumerator() { return GetEnumerator(); }

        /// <summary>Gets all Excel processes in the current session.</summary>
        /// <returns>Collection of all Excel processing in the current session.</returns>
        public IEnumerable<Process> GetProcesses() {

            IEnumerable<Process> result = Process.GetProcessesByName(ProcessName);

            if (this.SessionID >= 0)
                result = result.Where(p => p.SessionId == SessionID);

            return result;
        }

        #endregion

    //--------Implementation

        #region Methods

            private static xlApp InnerFromProcess(Process p) {
                return InnerFromHandle(ChildHandleFromMainHandle(p.MainWindowHandle.ToInt32()));
            }

            private static Int32 ChildHandleFromMainHandle(Int32 mainHandle) {
                Int32 handle = 0;
                EnumChildWindows(mainHandle, EnumChildFunc, ref handle);
                return handle;
            }

            private static xlApp InnerFromHandle(Int32 handle) {
                xlWin win = null;
                Int32 hr = AccessibleObjectFromWindow(handle, DW_OBJECTID, rrid.ToByteArray(), ref win);
                return win.Application;
            }

            private static Int32 GetWindowZ(IntPtr handle) {
                var z = 0;
                for (IntPtr h = handle; h != IntPtr.Zero; h = GetWindow(h, GW_HWNDPREV))
                    z++;
                return z;
            }

            private static Boolean EnumChildFunc(Int32 hwndChild, ref Int32 lParam) { 
                var buf = new StringBuilder(128); 
                GetClassName(hwndChild, buf, 128); 
                if (buf.ToString() == ComClassName) { 
                    lParam = hwndChild; 
                    return false; 
                } 
                return true; 
            }

            #endregion

            #region Extern Methods

            [DllImport("Oleacc.dll")] 
            private static extern Int32 AccessibleObjectFromWindow(
                Int32 hwnd, UInt32 dwObjectID, Byte[] riid, ref xlWin ptr); 

            [DllImport("User32.dll")] 
            private static extern Boolean EnumChildWindows(
                Int32 hWndParent, EnumChildCallback lpEnumFunc, ref Int32 lParam); 

            [DllImport("User32.dll")] 
            private static extern Int32 GetClassName(
                Int32 hWnd, StringBuilder lpClassName, Int32 nMaxCount); 

            [DllImport("User32.dll")] 
            private static extern IntPtr GetWindow(IntPtr hWnd, UInt32 uCmd);

            #endregion

            #region Constants & delegates

            private const String MarshalName = "Excel.Application";

            private const String ProcessName = "EXCEL";

            private const String ComClassName = "EXCEL7";

            private const UInt32 DW_OBJECTID = 0xFFFFFFF0;

            private const UInt32 GW_HWNDPREV = 3;
            //3 = GW_HWNDPREV
            //The retrieved handle identifies the window above the specified window in the Z order.
            //If the specified window is a topmost window, the handle identifies a topmost window.
            //If the specified window is a top-level window, the handle identifies a top-level window.
            //If the specified window is a child window, the handle identifies a sibling window.

            private static Guid rrid = new Guid("{00020400-0000-0000-C000-000000000046}");

            private delegate Boolean EnumChildCallback(Int32 hwnd, ref Int32 lParam);
            #endregion
        }
    } 
```

# c# - C#中泛型类的算术运算符重载

> ID：756954
> 
> 赞同：32
> 
> 时间：2009-04-16T16:33:19.583
> 
> 标签：c#, generics, operator-overloading, math, primitive-types

给定一个通用类定义，例如

```
public class ConstrainedNumber<T> :
    IEquatable<ConstrainedNumber<T>>,
    IEquatable<T>,
    IComparable<ConstrainedNumber<T>>,
    IComparable<T>,
    IComparable where T:struct, IComparable, IComparable<T>, IEquatable<T> 
```

如何为它定义算术运算符？

以下无法编译，因为“+”运算符不能应用于类型“T”和“T”：

```
public static T operator +( ConstrainedNumber<T> x, ConstrainedNumber<T> y)
{
    return x._value + y._value;
} 
```

如您所见，泛型“T”受“where”关键字的约束，但我需要对具有算术运算符（IArithmetic？）的数字类型进行约束。

'T' 将是一个原始数字类型，例如 int、float 等。这些类型是否存在 'where' 约束？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-16T16:42:28.983

我认为您能做的最好的事情就是`IConvertible`用作约束并执行以下操作：

```
 public static operator T +(T x, T y)
    where T: IConvertible
{
    var type = typeof(T);
    if (type == typeof(String) ||
        type == typeof(DateTime)) throw new ArgumentException(String.Format("The type {0} is not supported", type.FullName), "T");

    try { return (T)(Object)(x.ToDouble(NumberFormatInfo.CurrentInfo) + y.ToDouble(NumberFormatInfo.CurrentInfo)); }
    catch(Exception ex) { throw new ApplicationException("The operation failed.", ex); }
} 
```

不过，这不会阻止某人传入 String 或 DateTime，因此您可能需要进行一些手动检查 - 但 IConvertible 应该让您足够接近，并允许您进行操作。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-16T16:37:51.350

不幸的是，没有办法将泛型参数限制为整数类型（**编辑：**我猜“算术类型”可能是一个更好的词，因为这不仅仅与整数有关）。

能够做这样的事情会很好：

```
where T : integral // or "arithmetical" depending on how pedantic you are 
```

或者

```
where T : IArithmetic 
```

我建议您阅读我们自己的 Marc Gravell 和 Jon Skeet 的[通用运算符。](http://www.yoda.arachsys.com/csharp/genericoperators.html)它解释了为什么这是一个如此困难的问题以及可以采取哪些措施来解决它。

> .NET 2.0 将泛型引入 .NET 世界，为现有问题的许多优雅解决方案打开了大门。通用约束可用于将类型参数限制为已知接口等，以确保访问功能 - 或者对于简单的相等/不等式测试，Comparer.Default 和 EqualityComparer.Default 单例分别实现 IComparer 和 IEqualityComparer（允许我们对元素进行排序例如，无需了解有关“T”的任何信息）。
> 
> 尽管如此，在运营商方面仍然存在很大差距。因为运算符被声明为静态方法，所以没有所有数字类型都实现的 IMath 或类似的等效接口；事实上，运营商的灵活性会让这很难以有意义的方式实现。更糟糕的是：**许多基本类型的运算符甚至不作为运算符存在；相反，有直接的 IL 方法。**[强调我的]为了使情况更加复杂，Nullable<> 需要“提升运算符”的概念，其中内部“T”描述适用于可空类型的运算符 - 但这是作为语言特性实现的，并且是不是由运行时提供的（使反射更有趣）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-10-24T20:42:31.753

在 C# 4.0 中，您可以使用[dynamic](http://msdn.microsoft.com/en-us/library/dd264736.aspx)来绕过这个限制。我查看了您的代码，并设法生成了一个工作（尽管已缩减）版本：

```
 public class ConstrainedNumber<T> where T : struct, IComparable, IComparable<T>, IEquatable<T>
    {
        private T _value;

        public ConstrainedNumber(T value)
        {
            _value = value;
        }

        public static T operator +(ConstrainedNumber<T> x, ConstrainedNumber<T> y)
        {
            return (dynamic)x._value + y._value;
        }
    } 
```

还有一个小测试程序：

```
class Program
{
    static void Main(string[] args)
    {
        ConstrainedNumber<int> one = new ConstrainedNumber<int>(10);
        ConstrainedNumber<int> two = new ConstrainedNumber<int>(5);
        var three = one + two;
        Debug.Assert(three == 15);
        Console.ReadLine();
    }
} 
```

享受！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-16T16:38:18.167

不，这不起作用。但是有一些关于如何解决问题的建议。我做了以下事情（使用网络上不同来源的一些想法）：

```
public delegate TResult BinaryOperator<TLeft, TRight, TResult>(TLeft left, TRight right);

/// <summary>
/// Provide efficient generic access to either native or static operators for the given type combination.
/// </summary>
/// <typeparam name="TLeft">The type of the left operand.</typeparam>
/// <typeparam name="TRight">The type of the right operand.</typeparam>
/// <typeparam name="TResult">The type of the result value.</typeparam>
/// <remarks>Inspired by Keith Farmer's code on CodeProject:<br/>http://www.codeproject.com/KB/cs/genericoperators.aspx</remarks>
public static class Operator<TLeft, TRight, TResult> {
    private static BinaryOperator<TLeft, TRight, TResult> addition;
    private static BinaryOperator<TLeft, TRight, TResult> bitwiseAnd;
    private static BinaryOperator<TLeft, TRight, TResult> bitwiseOr;
    private static BinaryOperator<TLeft, TRight, TResult> division;
    private static BinaryOperator<TLeft, TRight, TResult> exclusiveOr;
    private static BinaryOperator<TLeft, TRight, TResult> leftShift;
    private static BinaryOperator<TLeft, TRight, TResult> modulus;
    private static BinaryOperator<TLeft, TRight, TResult> multiply;
    private static BinaryOperator<TLeft, TRight, TResult> rightShift;
    private static BinaryOperator<TLeft, TRight, TResult> subtraction;

    /// <summary>
    /// Gets the addition operator + (either native or "op_Addition").
    /// </summary>
    /// <value>The addition operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> Addition {
        get {
            if (addition == null) {
                addition = CreateOperator("op_Addition", OpCodes.Add);
            }
            return addition;
        }
    }

    /// <summary>
    /// Gets the modulus operator % (either native or "op_Modulus").
    /// </summary>
    /// <value>The modulus operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> Modulus {
        get {
            if (modulus == null) {
                modulus = CreateOperator("op_Modulus", OpCodes.Rem);
            }
            return modulus;
        }
    }

    /// <summary>
    /// Gets the exclusive or operator ^ (either native or "op_ExclusiveOr").
    /// </summary>
    /// <value>The exclusive or operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> ExclusiveOr {
        get {
            if (exclusiveOr == null) {
                exclusiveOr = CreateOperator("op_ExclusiveOr", OpCodes.Xor);
            }
            return exclusiveOr;
        }
    }

    /// <summary>
    /// Gets the bitwise and operator &amp; (either native or "op_BitwiseAnd").
    /// </summary>
    /// <value>The bitwise and operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> BitwiseAnd {
        get {
            if (bitwiseAnd == null) {
                bitwiseAnd = CreateOperator("op_BitwiseAnd", OpCodes.And);
            }
            return bitwiseAnd;
        }
    }

    /// <summary>
    /// Gets the division operator / (either native or "op_Division").
    /// </summary>
    /// <value>The division operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> Division {
        get {
            if (division == null) {
                division = CreateOperator("op_Division", OpCodes.Div);
            }
            return division;
        }
    }

    /// <summary>
    /// Gets the multiplication operator * (either native or "op_Multiply").
    /// </summary>
    /// <value>The multiplication operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> Multiply {
        get {
            if (multiply == null) {
                multiply = CreateOperator("op_Multiply", OpCodes.Mul);
            }
            return multiply;
        }
    }

    /// <summary>
    /// Gets the bitwise or operator | (either native or "op_BitwiseOr").
    /// </summary>
    /// <value>The bitwise or operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> BitwiseOr {
        get {
            if (bitwiseOr == null) {
                bitwiseOr = CreateOperator("op_BitwiseOr", OpCodes.Or);
            }
            return bitwiseOr;
        }
    }

    /// <summary>
    /// Gets the left shift operator &lt;&lt; (either native or "op_LeftShift").
    /// </summary>
    /// <value>The left shift operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> LeftShift {
        get {
            if (leftShift == null) {
                leftShift = CreateOperator("op_LeftShift", OpCodes.Shl);
            }
            return leftShift;
        }
    }

    /// <summary>
    /// Gets the right shift operator &gt;&gt; (either native or "op_RightShift").
    /// </summary>
    /// <value>The right shift operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> RightShift {
        get {
            if (rightShift == null) {
                rightShift = CreateOperator("op_RightShift", OpCodes.Shr);
            }
            return rightShift;
        }
    }

    /// <summary>
    /// Gets the subtraction operator - (either native or "op_Addition").
    /// </summary>
    /// <value>The subtraction operator.</value>
    public static BinaryOperator<TLeft, TRight, TResult> Subtraction {
        get {
            if (subtraction == null) {
                subtraction = CreateOperator("op_Subtraction", OpCodes.Sub);
            }
            return subtraction;
        }
    }

    private static BinaryOperator<TLeft, TRight, TResult> CreateOperator(string operatorName, OpCode opCode) {
        if (operatorName == null) {
            throw new ArgumentNullException("operatorName");
        }
        bool isPrimitive = true;
        bool isLeftNullable;
        bool isRightNullable = false;
        Type leftType = typeof(TLeft);
        Type rightType = typeof(TRight);
        MethodInfo operatorMethod = LookupOperatorMethod(ref leftType, operatorName, ref isPrimitive, out isLeftNullable) ??
                                    LookupOperatorMethod(ref rightType, operatorName, ref isPrimitive, out isRightNullable);
        DynamicMethod method = new DynamicMethod(string.Format("{0}:{1}:{2}:{3}", operatorName, typeof(TLeft).FullName, typeof(TRight).FullName, typeof(TResult).FullName), typeof(TResult),
                                                 new Type[] {typeof(TLeft), typeof(TRight)});
        Debug.WriteLine(method.Name, "Generating operator method");
        ILGenerator generator = method.GetILGenerator();
        if (isPrimitive) {
            Debug.WriteLine("Primitives using opcode", "Emitting operator code");
            generator.Emit(OpCodes.Ldarg_0);
            if (isLeftNullable) {
                generator.EmitCall(OpCodes.Call, typeof(TLeft).GetMethod("op_Explicit", BindingFlags.Public|BindingFlags.Static), null);
            }
            IlTypeHelper.ILType stackType = IlTypeHelper.EmitWidening(generator, IlTypeHelper.GetILType(leftType), IlTypeHelper.GetILType(rightType));
            generator.Emit(OpCodes.Ldarg_1);
            if (isRightNullable) {
                generator.EmitCall(OpCodes.Call, typeof(TRight).GetMethod("op_Explicit", BindingFlags.Public | BindingFlags.Static), null);
            }
            stackType = IlTypeHelper.EmitWidening(generator, IlTypeHelper.GetILType(rightType), stackType);
            generator.Emit(opCode);
            if (typeof(TResult) == typeof(object)) {
                generator.Emit(OpCodes.Box, IlTypeHelper.GetPrimitiveType(stackType));
            } else {
                Type resultType = typeof(TResult);
                if (IsNullable(ref resultType)) {
                    generator.Emit(OpCodes.Newobj, typeof(TResult).GetConstructor(new Type[] {resultType}));
                } else {
                    IlTypeHelper.EmitExplicit(generator, stackType, IlTypeHelper.GetILType(resultType));
                }
            }
        } else if (operatorMethod != null) {
            Debug.WriteLine("Call to static operator method", "Emitting operator code");
            generator.Emit(OpCodes.Ldarg_0);
            generator.Emit(OpCodes.Ldarg_1);
            generator.EmitCall(OpCodes.Call, operatorMethod, null);
            if (typeof(TResult).IsPrimitive && operatorMethod.ReturnType.IsPrimitive) {
                IlTypeHelper.EmitExplicit(generator, IlTypeHelper.GetILType(operatorMethod.ReturnType), IlTypeHelper.GetILType(typeof(TResult)));
            } else if (!typeof(TResult).IsAssignableFrom(operatorMethod.ReturnType)) {
                Debug.WriteLine("Conversion to return type", "Emitting operator code");
                generator.Emit(OpCodes.Ldtoken, typeof(TResult));
                generator.EmitCall(OpCodes.Call, typeof(Type).GetMethod("GetTypeFromHandle", new Type[] {typeof(RuntimeTypeHandle)}), null);
                generator.EmitCall(OpCodes.Call, typeof(Convert).GetMethod("ChangeType", new Type[] {typeof(object), typeof(Type)}), null);
            }
        } else {
            Debug.WriteLine("Throw NotSupportedException", "Emitting operator code");
            generator.ThrowException(typeof(NotSupportedException));
        }
        generator.Emit(OpCodes.Ret);
        return (BinaryOperator<TLeft, TRight, TResult>)method.CreateDelegate(typeof(BinaryOperator<TLeft, TRight, TResult>));
    }

    private static bool IsNullable(ref Type type) {
        if (type.IsGenericType && (type.GetGenericTypeDefinition() == typeof(Nullable<>))) {
            type = type.GetGenericArguments()[0];
            return true;
        }
        return false;
    }

    private static MethodInfo LookupOperatorMethod(ref Type type, string operatorName, ref bool isPrimitive, out bool isNullable) {
        isNullable = IsNullable(ref type);
        if (!type.IsPrimitive) {
            isPrimitive = false;
            foreach (MethodInfo methodInfo in type.GetMethods(BindingFlags.Static|BindingFlags.Public)) {
                if (methodInfo.Name == operatorName) {
                    bool isMatch = true;
                    foreach (ParameterInfo parameterInfo in methodInfo.GetParameters()) {
                        switch (parameterInfo.Position) {
                        case 0:
                            if (parameterInfo.ParameterType != typeof(TLeft)) {
                                isMatch = false;
                            }
                            break;
                        case 1:
                            if (parameterInfo.ParameterType != typeof(TRight)) {
                                isMatch = false;
                            }
                            break;
                        default:
                            isMatch = false;
                            break;
                        }
                    }
                    if (isMatch) {
                        if (typeof(TResult).IsAssignableFrom(methodInfo.ReturnType) || typeof(IConvertible).IsAssignableFrom(methodInfo.ReturnType)) {
                            return methodInfo; // full signature match
                        }
                    }
                }
            }
        }
        return null;
    }
}

internal static class IlTypeHelper {
    [Flags]
    public enum ILType {
        None = 0,
        Unsigned = 1,
        B8 = 2,
        B16 = 4,
        B32 = 8,
        B64 = 16,
        Real = 32,
        I1 = B8, // 2
        U1 = B8|Unsigned, // 3
        I2 = B16, // 4
        U2 = B16|Unsigned, // 5
        I4 = B32, // 8
        U4 = B32|Unsigned, // 9
        I8 = B64, //16
        U8 = B64|Unsigned, //17
        R4 = B32|Real, //40
        R8 = B64|Real //48
    }

    public static ILType GetILType(Type type) {
        if (type == null) {
            throw new ArgumentNullException("type");
        }
        if (!type.IsPrimitive) {
            throw new ArgumentException("IL native operations requires primitive types", "type");
        }
        if (type == typeof(double)) {
            return ILType.R8;
        }
        if (type == typeof(float)) {
            return ILType.R4;
        }
        if (type == typeof(ulong)) {
            return ILType.U8;
        }
        if (type == typeof(long)) {
            return ILType.I8;
        }
        if (type == typeof(uint)) {
            return ILType.U4;
        }
        if (type == typeof(int)) {
            return ILType.I4;
        }
        if (type == typeof(short)) {
            return ILType.U2;
        }
        if (type == typeof(ushort)) {
            return ILType.I2;
        }
        if (type == typeof(byte)) {
            return ILType.U1;
        }
        if (type == typeof(sbyte)) {
            return ILType.I1;
        }
        return ILType.None;
    }

    public static Type GetPrimitiveType(ILType iLType) {
        switch (iLType) {
        case ILType.R8:
            return typeof(double);
        case ILType.R4:
            return typeof(float);
        case ILType.U8:
            return typeof(ulong);
        case ILType.I8:
            return typeof(long);
        case ILType.U4:
            return typeof(uint);
        case ILType.I4:
            return typeof(int);
        case ILType.U2:
            return typeof(short);
        case ILType.I2:
            return typeof(ushort);
        case ILType.U1:
            return typeof(byte);
        case ILType.I1:
            return typeof(sbyte);
        }
        throw new ArgumentOutOfRangeException("iLType");
    }

    public static ILType EmitWidening(ILGenerator generator, ILType onStackIL, ILType otherIL) {
        if (generator == null) {
            throw new ArgumentNullException("generator");
        }
        if (onStackIL == ILType.None) {
            throw new ArgumentException("Stack needs a value", "onStackIL");
        }
        if (onStackIL < ILType.I8) {
            onStackIL = ILType.I8;
        }
        if ((onStackIL < otherIL) && (onStackIL != ILType.R4)) {
            switch (otherIL) {
            case ILType.R4:
            case ILType.R8:
                if ((onStackIL&ILType.Unsigned) == ILType.Unsigned) {
                    generator.Emit(OpCodes.Conv_R_Un);
                } else if (onStackIL != ILType.R4) {
                    generator.Emit(OpCodes.Conv_R8);
                } else {
                    return ILType.R4;
                }
                return ILType.R8;
            case ILType.U8:
            case ILType.I8:
                if ((onStackIL&ILType.Unsigned) == ILType.Unsigned) {
                    generator.Emit(OpCodes.Conv_U8);
                    return ILType.U8;
                }
                if (onStackIL != ILType.I8) {
                    generator.Emit(OpCodes.Conv_I8);
                }
                return ILType.I8;
            }
        }
        return onStackIL;
    }

    public static void EmitExplicit(ILGenerator generator, ILType onStackIL, ILType otherIL) {
        if (otherIL != onStackIL) {
            switch (otherIL) {
            case ILType.I1:
                generator.Emit(OpCodes.Conv_I1);
                break;
            case ILType.I2:
                generator.Emit(OpCodes.Conv_I2);
                break;
            case ILType.I4:
                generator.Emit(OpCodes.Conv_I4);
                break;
            case ILType.I8:
                generator.Emit(OpCodes.Conv_I8);
                break;
            case ILType.U1:
                generator.Emit(OpCodes.Conv_U1);
                break;
            case ILType.U2:
                generator.Emit(OpCodes.Conv_U2);
                break;
            case ILType.U4:
                generator.Emit(OpCodes.Conv_U4);
                break;
            case ILType.U8:
                generator.Emit(OpCodes.Conv_U8);
                break;
            case ILType.R4:
                generator.Emit(OpCodes.Conv_R4);
                break;
            case ILType.R8:
                generator.Emit(OpCodes.Conv_R8);
                break;
            }
        }
    }
} 
```

像这样使用： int i = Operator.Addition(3, 5);

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T17:44:37.633

没有可用的限制，但有一种方法可以解决这个问题：

```
public static T operator -(T foo, T bar)
{
    return (T)System.Convert.ChangeType(
            System.Convert.ToDecimal(foo)
                -
            System.Convert.ToDecimal(bar),
                typeof(T));
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-13T13:31:37.443

如果您没有使用太多用作通用参数的类型并且想要进行编译时检查，那么您可以使用类似于 Lucero 的解决方案的解决方案。

### 基类

```
public class Arithmetic<T>
{
    protected static readonly Func<T, T, T> OP_ADD;
    protected static readonly Func<T, T, T> OP_MUL;
    protected static readonly Func<T, T, T> OP_SUB;
    /* Define all operators you need here */

    static Arithmetic()
    {
        Arithmetic<Single>.OP_ADD = (x, y) => x + y;
        Arithmetic<Single>.OP_MUL = (x, y) => x * y;
        Arithmetic<Single>.OP_SUB = (x, y) => x - y;

        Arithmetic<Double>.OP_ADD = (x, y) => x + y;
        Arithmetic<Double>.OP_MUL = (x, y) => x * y;
        Arithmetic<Double>.OP_SUB = (x, y) => x - y;

        /* This could also be generated by a tool */
    }
} 
```

### 用法

```
public class Vector2<T> : Arithmetic<T>
{
    public T X;
    public T Y;

    public static Vector2<T> operator +(Vector2<T> a, Vector2<T> b)
    {
        return new Vector2<T>()
        {
            X = OP_ADD(a.X, b.X),
            Y = OP_ADD(a.Y, b.Y)
        };
    }
    public static Vector2<T> operator -(Vector2<T> a, Vector2<T> b)
    {
        return new Vector2<T>()
        {
            X = OP_SUB(a.X, b.X),
            Y = OP_SUB(a.Y, b.Y)
        };
    }
    public static Vector2<T> operator *(Vector2<T> a, Vector2<T> b)
    {
        return new Vector2<T>()
        {
            X = OP_MUL(a.X, b.X),
            Y = OP_MUL(a.Y, b.Y)
        };
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-16T16:38:20.927

.Net 泛型当前不支持表示支持运算符。

这是一个经常被要求的功能。

它可以半解决（参见 [MiscUtils](http://www.yoda.arachsys.com/csharp/miscutil/usage/genericoperators.html)）但这不会给你你想要的语法

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-19T12:52:55.307

我只是在看了这里之后才这样做的。Vector4<T> 类包含 4 个 T 类型的数字/轴，具有通常的向量数学。只需添加 2 个隐式操作即可在十进制之间进行转换。这可能与您将要获得的一样不冗长，但正如您所指出的那样，它更精确，因此比它需要的更重。和你们一样，我希望有一个 INumeric 或其他东西！

```
 public static Vector4<T> operator +(Vector4<T> a, Vector4<T> b)
{
    Vector4<Decimal> A = a;
    Vector4<Decimal> B = b;

    var result = new Vector4<Decimal>(A.X + B.X, A.Y + B.Y, A.Z + B.Z, A.W + B.W);

    return result;
}

public static implicit operator Vector4<Decimal>(Vector4<T> v)
{
    return new Vector4<Decimal>(
        Convert.ToDecimal(v.X), 
        Convert.ToDecimal(v.Y), 
        Convert.ToDecimal(v.Z), 
        Convert.ToDecimal(v.W));
}

public static implicit operator Vector4<T>(Vector4<Decimal> v)
{
    return new Vector4<T>(
        (T)Convert.ChangeType(v.X, typeof(T)), 
        (T)Convert.ChangeType(v.Y, typeof(T)), 
        (T)Convert.ChangeType(v.Z, typeof(T)), 
        (T)Convert.ChangeType(v.W, typeof(T)));
} 

```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-10-17T06:57:48.310

这个朋友怎么样（使用 RTTI 和对象类）

```
class MyMath
{
    public static T Add<T>(T a, T b) where T: struct
    {
        switch (typeof(T).Name)
        {
            case "Int32":
                return (T) (object)((int)(object)a + (int)(object)b);
            case "Double":
                return (T)(object)((double)(object)a + (double)(object)b);
            default:
                return default(T);
        }
    }
}

class Program
{
    public static int Main()
    {
        Console.WriteLine(MyMath.Add<double>(3.6, 2.12));
        return 0;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-16T16:38:06.623

不幸的是，这是不可能的，因为没有`IArithmetic`（如您所说）为整数定义接口。您可以将这些原始类型包装在实现此类接口的类中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-16T17:23:28.900

我已经看到了一些涉及表达式树的潜在解决方案，其中操作符表达式是手动创建的。

它并不完美，因为您丢失了编译时验证，但它可能会为您解决问题。

[这](http://www.yoda.arachsys.com/csharp/genericoperators.html)是一篇关于此的文章。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-04T15:26:12.633

如果我不得不做这样的事情，我可能会按照以下方式处理它

```
public class ConstrainedNumber<T>
{
    private T Value { get; }
    public ConstrainedNumber(T value)
    {
        Value = value;
    }

    private static Func<ConstrainedNumber<T>, ConstrainedNumber<T>, T> _addFunc; // Cache the delegate
    public static ConstrainedNumber<T> operator+(ConstrainedNumber<T> left, ConstrainedNumber<T> right)
    {
        var adder = _addFunc;
        if (adder == null)
        {
            ParameterExpression lhs = Expression.Parameter(typeof(ConstrainedNumber<T>));
            ParameterExpression rhs = Expression.Parameter(typeof(ConstrainedNumber<T>));
            _addFunc = adder = Expression.Lambda<Func<ConstrainedNumber<T>, ConstrainedNumber<T>, T>>(
                Expression.Add(
                    Expression.Property(lhs, nameof(Value)),
                    Expression.Property(lhs, nameof(Value))
                    ),
                lhs,
                rhs).Compile();
        }
        return new ConstrainedNumber<T>(adder(left, right));
    }
} 
```

最终结果有点像该`dynamic`方法的最终结果，实际上最终会在内部执行类似的操作，但开销更大，并且应该适用于`T`算术原语或为其`+`定义了运算符的任何操作. 该`dynamic`方法处理方式不同的一种情况是，它会起作用，`string`而这不起作用。这是好事还是坏事取决于用例，但如果需要，`string`可能是特殊情况。

# iphone - 挂断智能手机后记录通话

> ID：756962
> 
> 赞同：2
> 
> 时间：2009-04-16T16:34:29.017
> 
> 标签：iphone, android, api, blackberry, palm-os

在各种智能手机 API/SDK 中，我想知道是否可以在用户挂机后提示他们是否要记录电话。最基本的功能是在拨打或接听电话后，电话会询问

您想记录来自 555-555-5555 的通话吗？
是 | 没有 | 从来没有这个号码

（然后它可能会将用户带到一个小表单，然后将信息发布到网络服务）

业务用途适用于拥有公司电话并需要跟踪账单的律师。

[这与Accessing the iPhone's Call log with the iPhone SDK](https://stackoverflow.com/questions/341622/accessing-the-iphones-call-log-with-the-iphone-sdk)有点不同。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T17:16:24.283

在 Android 手机上，您可以注册一个[PhoneStateListener](http://developer.android.com/reference/android/telephony/PhoneStateListener.html)以接收有关何时挂断电话的通知，并通过您希望的任何方法记录该号码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T16:49:44.053

黑莓有开箱即用的呼叫记录功能。Blackberry Enterprise Server 激活单元将日志与服务器同步。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T05:15:45.763

在 iPhone 上，***没办法。***
苹果将​​不得不允许（不寒而栗）后台应用程序。

注意：弹片是对的，如果你越狱你的手机并在后台运行你的程序，你也许可以使用一些私有 API 来监控手机状态。

# sql - Access 数据库表中字段名称中的短划线

> ID：756972
> 
> 赞同：1
> 
> 时间：2009-04-16T16:36:50.993
> 
> 标签：sql, database, ms-access, database-design

我在从我的 ms-access 数据库中检索字段时遇到问题。

表名是 TEST，字段名之一是 HD-TEST

当我做：

SELECT * from TEST where TEST.HD-TEST='H' 然后我执行查询，ms-access 向我显示一个对话框，需要参数 HD。

你知道可能是什么原因吗？

非常感谢。亲切的问候。何塞马。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T16:40:36.930

尝试在列名的开头和结尾添加括号（未经测试，但在 SQL Server 中有效）：

```
SELECT * from TEST where TEST.[HD-TEST]='H' 
```

# c# - 在 VC++（本机）中可以完成哪些 VC# 无法完成的任务？

> ID：756984
> 
> 赞同：9
> 
> 时间：2009-04-16T16:39:10.693
> 
> 标签：c#, c++, visual-c++

在 VC++（本机）中可以完成哪些 VC# 无法完成的任务？

据我所知，唯一值得使用 VC++ native 的事情是当您需要自己管理内存而不是 CLR 垃圾收集器时，我也没有看到这样做的目的（但那是稍后要问的另一个问题） .

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T16:54:56.910

跨平台开发。是的，Mono 存在，并且 Java*更*容易预测它在更多平台上的功能完全相同，您可以找到适用于几乎任何平台的 C/C++ 编译器，而您无法使用 C#。

还链接到第 3 方库，虽然我确信有一种方法可以在 C# 中利用它们，但您将能够利用它们而无需在 C++ 中进行互操作（编组等）。

编辑：最后一件事：可靠的内存管理。是的，您可以使用`dispose()`, 和`try-finally`，但是没有什么比知道内存从堆栈中弹出时消失了。通过 RAII 等技术，当您使用构造良好的类时，您将知道您的类何时释放资源，而不是等待 GC 发生。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-16T16:44:50.383

使用 P/Invoke，在 .NET 中几乎没有什么是*不可能的（最明显的是设备驱动程序）。*

还有一些事情是建议*不要使用 .NET*（例如 shell 扩展，它会被加载到打开文件对话框¹的任何进程中）。

最后，如果可能的话，在 .NET 中有些事情会更加困难（例如，创建一个聚合 FTM 的 COM 组件）。

¹如果该进程已经在使用不同版本的 .NET，这可能会产生问题。这应该在未来随着 .NET 4 能够支持运行时的并行实例而得到缓解。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T16:52:36.213

我不确定您是在谈论语言功能还是应用程序。我的回答是针对应用程序/组件。

真的，只有两件事你不能在 C# 中做，而你可以在 C++ 中做。

*   您不能使用 C# 或任何其他 .Net 语言为只接受本机组件的系统编写组件
*   您不能使用 C# 或任何其他 .Net 语言来更改 CLR 不允许自定义的 CCW 的某些属性

这里最值得注意的项目是设备驱动程序。这是一个只接受原生组件的框架，无法插入托管组件。

对于其他一切，在 C# 中可以像在 C++ 中一样做同样的事情。在很多情况下，您根本不想这样做，而本机解决方案更好。例如，可以通过不安全代码或 IntPtr 在 C# 中管理和操作内存。这几乎没有那么容易，而且通常没有理由。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-16T16:42:06.380

您不能为一个编写设备驱动程序。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-16T19:54:35.073

我认为有几点很重要：

你可以用 C#/C++/Java/Python/Lisp 或几乎任何其他语言做任何事情，最后它们都图灵完备了`;)`……问题是它适合你的需要吗？

1.  C#有一个**很大**且极其重要的限制……它只能运行**一个**单一平台的 Windows……（Mono 还不够[成熟](http://art-blog.no-ip.info/cppcms/blog/post/27)）。
2.  在许多应用程序中，GC 只是浪费资源，在下一个 gc 周期之前无法让您占用 1/2 内存的应用程序：游戏、数据库、视频音频处理和许多其他关键任务应用程序。
3.  实时应用程序（同样是游戏、视频处理等）。非确定性 GC 让他们的生活变得更加艰难。

事实上，大多数桌面应用程序：Web 浏览器、文字处理器、桌面环境本身（如 Windows Explorer、KDE ​​或 Gnome）都是用编译语言编写的，并仔细考虑了资源……否则，它们将只是可怕的臃肿应用程序。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-16T16:50:22.443

尽管在 C# 中可以在 Windows XP 中编写 shell 扩展，但在 Vista 和 Windows 7 中编写 shell 扩展几乎是不可能的。Shell 扩展和命名空间扩展（以及使用新属性系统的任何其他内容）（kindof）必须在 C++ 中完成除非你很*痛苦*。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-16T16:55:32.900

有两个明显的答案：

*   没有 .NET 框架，VC# 永远无法运行。本机 C++ 可以。这在某些领域可能是必要的（其他人提到了设备驱动程序，但更常见的示例可能只是未安装 .NET 框架的客户端。也许您正在分发应用程序并且您知道并非所有客户都愿意安装.NET，因此如果您制作的应用程序无需依赖 .NET 即可正常运行，您的销售额将会上升。或者您可能正在某些移动设备上工作，其中 .NET CF 占用的几兆字节是不合理的. 或使用 .NET 的外壳扩展可能会给用户带来讨厌的问题。
*   而且 VC# 永远不能使用 C++ 语言特性。本机 C++ 可以。（当然，托管 C++ 也可以，但这是一个不同的问题）。信不信由你，在 C++ 中可以更方便或更优雅地完成一些事情。只有在使用 C++ 编程时才能访问它们。

但是，系统调用没有问题。p/invoke 让您可以在 C# 中执行这些操作，几乎与在 C++ 中一样容易。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-16T16:50:59.633

*   内联汇编器
*   您不能将 C++ 库与类一起使用（P/Invoke 只能用于函数 AFAIK）
*   您不能将回调与 P/Invoke 一起使用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T16:45:55.823

特别是 C# 和一般的 .NET 是否可以自编译（这不是巨魔，我真的不知道）？如果没有，您可以使用 VC++ 编写 C# 和 .NET，但不能使用 C# 来完成相同的工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-16T16:46:32.127

这是在开玩笑，但它也是对您问题的回答……在 VC++ 中，您可以比在 VC# 中更严重地搞砸事情。并不是说你不能在 VC# 中把事情搞砸，但总的来说，你可以在 VC++ 中更轻松、更彻底地搞砸。

再一次，有点舌头，但也回答了你的问题。也许不是您所希望的，但是... :-)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-16T18:05:56.613

还有硬实时应用程序。不能使用任何带有 GC 的语言，以防它决定在代码的时间受限部分进行收集。Java 因甚至不允许您尝试而臭名昭著（因此 EULA 关于不将其用于“旨在用于任何核设施的设计、建造、运营或维护”的软件

*（是的，我知道他们已经为实时系统制作了 Java 的修改版本）。*

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-16T16:47:31.110

例如，如果翻译现有库的头文件比放弃现有托管库更难，那么使用 C++ 是有意义的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-17T09:56:56.657

主要区别在于：

*   C++ 是一种核心语言，您可以使用它来构建**独立**程序。这些程序直接与操作系统通信，而不是其他任何东西。C++ 编译器几乎适用于所有平台（操作系统）。

*   C# 是一种符合 CLS 的语言。如果没有 CLI 引擎（.NET Framework、Mono 等），用 C# 编写的程序就无法启动。用 C# 编写的程序与 .NET 框架和操作系统进行通信。你中间有个男人。像所有服务人员一样，这个人可以提供帮助，但会造成额外的麻烦。如果你想移植，中间有一个不同的人等。并非所有平台都存在 CLI 实现。

在我看来，每一个额外的框架都是额外的问题来源。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-17T13:59:08.277

使用 SSE 指令似乎就是其中一种情况。一些 .NET 运行时将使用一些 SSE 指令，具体取决于您的代码。但在 VC++ 中，您可以直接使用 SSE 内在函数。因此，如果您正在编写多媒体代码，您可能需要 C++。（大概 C++/CLI 也可以工作）

# c# - 从线程单线程单元线程中声明资源/内存

> ID：756985
> 
> 赞同：2
> 
> 时间：2009-04-16T16:40:18.973
> 
> 标签：c#, multithreading, try-catch-finally

我正在使用以下单线程公寓。我无法从线程对象中回收内存/其他资源。Actullay 我想将我的线程包裹在 try catch 和 fianlly 块中。try 和 catch 完成了。但我不确定 finally 块。我需要在 finally 块中调用什么代码、属性或函数。

```
System.Threading.Thread myThread = null;
    try 
    {
        myThread = new System.Threading.Thread(functionAddressETC)
        myThread .SetApartmentState(System.Threading.ApartmentState.STA);
        myThread .Start();
        myThread .Join();
    }
catch(Exception ex)
{}
finally
{
   // I need help in finally block. I need to reclaim all my resources
   //what function do i need to call here??????
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T16:51:12.410

GC 将回收内存，终结器将释放本机资源。确保这些过程发生的唯一方法是确保不再引用您不再需要的对象。

一个线程除了它的堆栈之外没有任何自己的内存/资源，这将通过关闭线程的连接来清理（除非你有一些东西弄乱了复制本机线程句柄：在这种情况下，当最后一个句柄关闭时）。

# visual-studio-2008 - Visual Studio 项目 GUIDS

> ID：756988
> 
> 赞同：1
> 
> 时间：2009-04-16T16:41:05.883
> 
> 标签：visual-studio-2008, sharepoint

从这个问题开始......

[“您如何从现有的 Visual Studio 项目中区分 Visual Studio 项目类型”](https://stackoverflow.com/questions/660790/how-do-you-tell-the-visual-studio-project-type-from-an-existing-visual-studio-pro)

如何将项目 guid 添加到我的 csproj 文件中，以使我能够添加其他类型的表单/控件。

例如，我创建了一个类项目解决方案，并希望能够将 Web 表单和 Web 用户控件添加到项目中。

我参加了一次演讲，演讲者表明这是可能的，但他没有提供任何进一步的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:59:34.450

这很容易。只需编辑 Web 项目。添加必要的 guid，如我的帖子[How to Hack a Class Library Project into a Web Application Project](http://www.dotnetmafia.com/blogs/dotnettipoftheday/archive/2008/02/22/how-to-hack-a-class-library-project-into-a-web-application-project.aspx)中所示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:46:39.097

关闭项目，在文本或 XML 编辑器中打开项目文件，然后手动添加 guid。

（保留原件，需要尝试几次才能正确。）

# vba - 使用 VBA 解析 MS Word 文档中的文本

> ID：756990
> 
> 赞同：5
> 
> 时间：2009-04-16T16:41:32.417
> 
> 标签：vba, parsing, ms-word

我希望有人可以帮助使用 MS Word 宏。

基本上，我有一个 MS Word 文档，其中列出了几个文本文件和每个文件中感兴趣的特定页面。

文件格式类似于：

```
textdocument1.txt 第 6、12 页 - 问题 1
textdocument2.txt 第 5 页 - 问题 1
                               第 13、17 页 - 第 3 期
textdocument3.txt 第 10 页

```

我想将每一行作为字符串读入我的宏中。

然后遍历它来识别文件名。有了文件名，我就可以打开文件，转到页码，然后复制我需要的数据。

但我被困在第 1 步，如何将行捕获到 MS Word 宏中的字符串中？

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T17:02:15.147

以下代码应该可以帮助您入门：

```
Public Sub ParseLines()
    Dim singleLine As Paragraph
    Dim lineText As String

    For Each singleLine In ActiveDocument.Paragraphs
        lineText = singleLine.Range.Text

        '// parse the text here...

    Next singleLine
End Sub 
```

[我在这篇文章](http://visualbasic.ittoolbox.com/groups/technical-functional/vb-vba-l/vba-to-read-line-by-line-from-word-document-1822258)中找到了基本算法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T17:00:06.633

如果您的 word 文档列出了所有这样的文本文件：

```
<name>{tab}<page ref>{newline}
<name>{tab}<page ref>{newline}
<name>{tab}<page ref>{newline} 
```

然后所有行都在[Paragraphs 集合](http://msdn.microsoft.com/en-us/library/bb178832.aspx)中可用。您可以通过一个简单的循环来`For Each`循环：

```
Dim p As Paragraph

For Each p In ActiveDocument.Paragraphs
  Debug.Print p.Range.Text
Next p 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-23T02:00:13.877

每行

```
Public Sub ParseDoc()

    Dim doc As Document
    Set doc = ActiveDocument
    Dim paras As Paragraphs
    Set paras = doc.Paragraphs
    Dim para As Paragraph
    Dim sents As Sentences
    Dim sent As Range
    For Each para In paras

        Set sents = para.Range.Sentences
        For Each sent In sents
            Debug.Print sent.Text
        Next

    Next

End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-12-13T14:22:36.330

如果文本是其他包含特殊字符或其他语言的文本，则上述代码将不起作用这是我在执行的一项任务中提出的解决方案

```
 Dim para As Paragraph
    Dim sentence() As String
    For Each para In ActiveDocument.Paragraphs
          sentence() = Split(para.Range.Text, Chr(11))
            For i = 0 To UBound(sentence)
                  Msgbox(sentence(i))
            next i
    next 
```

# linq-to-sql - 重命名 DataContext 的属性后停止 LINQ to SQL

> ID：756993
> 
> 赞同：2
> 
> 时间：2009-04-16T16:42:22.230
> 
> 标签：linq-to-sql, .net-3.5, rename

我的数据上下文中有一个名为 Proveedor 的实体。为数据上下文生成一个名为 Proveedors 的属性，以表示 Proveedor 的集合。我将它重命名为 Proveedores，这是西班牙语的正确拼写。但是，一旦我对模型（与 Proveedor 实体无关）进行任何操作并重建它，它就会再次将其重命名为 Proveedors。

我不想关闭复数只是希望它停止重命名我的重命名:)

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:49:07.220

当您对数据模型 dbml 文件进行更改时，Linq to SQL 类将完全从头开始生成。您对类文件所做的任何修改都将被覆盖。

更改复数规则必须通过更改代码生成来完成，但我不知道这是否可能。

* * *

您可以通过右键单击 dbml 设计器窗口中的表并选择属性来更改生成的名称。有一个名为“名称”的字段，您应该可以使用它定义自定义名称。

另外：这与这个特定问题没有直接关系，但是如果您想对生成的类添加修改，它们被定义为部分类。所以你可以通过创建一个单独的部分类来为类添加方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T16:48:40.840

你在哪里改名？如果您更改生成的 C# 代码，它将像您所看到的那样被覆盖。

您需要在 dbml 文件中更改它。打开那个文件。选择属性，然后打开属性面板并在那里进行更改。

# actionscript-3 - 在动作脚本 3 中使用命中测试弹跳球

> ID：756994
> 
> 赞同：0
> 
> 时间：2009-04-16T16:42:25.550
> 
> 标签：actionscript-3, bounce, hittest

我有这段代码可以让球弹跳，但我正在寻找的是从地面发射子弹，一旦它们击中球，它们应该向上弹回。目标是不让球落地。我敢肯定这以前已经做过，但我想我太笨了，无法弄清楚。

编码：

```
package {

public class ball extends MovieClip {

    var timer:Number=0;
    var initialPos:Number=0;
    var finalPos:Number=0;
    var currentPos:Number=0;
    var initialSpeed:Number=0;

    function ball() {

        startFallingBall();
    }

    function moveBallDown(e:Event) {
        timer+=1;

        this.y = initialPos + .5 *(timer * timer);
        checkBottomBoundary();
    }

    function moveBallUp(e:Event) {
        timer+=1;

        var posA=this.y;

        this.y = currentPos - initialSpeed*timer + .5*(timer * timer);

        var posB=this.y;

        checkTopBoundary(posA, posB);
    }

    function checkBottomBoundary() {
        if (this.y+this.height>stage.stageHeight) {
            finalPos=this.y;

            stopFallingBall();
        }
    }

    function checkTopBoundary(firstPos:Number, secondPos:Number) {
        if (secondPos>firstPos) {
            stopRisingBall();
            startFallingBall();
        }
    }

    function startFallingBall() {
        timer=0;
        initialPos=this.y;
        this.addEventListener(Event.ENTER_FRAME, moveBallDown);
    }

    function stopFallingBall() {
        this.removeEventListener(Event.ENTER_FRAME, moveBallDown);

        if (finalPos-initialPos<.1*this.height) {
            stopRisingBall();
        } else {
            startRisingBall();
        }
    }

    function startRisingBall() {
        initialSpeed=Math.sqrt(Math.abs(finalPos-initialPos));
        timer=0;

        currentPos=this.y;

        this.addEventListener(Event.ENTER_FRAME, moveBallUp);
    }

    function stopRisingBall() {
        this.removeEventListener(Event.ENTER_FRAME, moveBallUp);
    }

    function stopEverything() {
        this.removeEventListener(Event.ENTER_FRAME, moveBallUp);
        this.removeEventListener(Event.ENTER_FRAME, moveBallDown);
    }
} 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T20:05:43.643

一个简单的方法是使用 DisplayObject 的 hitTestObject。这会检查重叠。你当然可以自己写一些更高级的东西。

对于每个游戏更新，您检查是否有任何子弹击中球，如果击中则采取行动。您还应该考虑分离游戏逻辑和显示更新。研究使用定时器。

```
package {
    public class BallGame extends Sprite
    {
        private var ball:Ball;
        private var bullets:Array;

        public function BallGame() {
            addEventListener(Event.ENTER_FRAME, checkCollision);
            addEventListener(MouseEvent.CLICK, fireBullet);
        }

        private function fireBullet(e:MouseEvent):void {
            // adds a fired bullet to an array so we can loop over all bullets
            bullets.push(new Bullet());
        }

        private function checkCollision(e:Event):void {
            // loops through all bullets in play
            for each(var bullet:Bullet in bullets) {
                // check if the bullet is inside the ball
                if (ball.hitTestObject(bullet)) {
                    // the bullet hit the ball
                    ball.startRisingBall();

                    // TODO: remove the bullet :)
                }
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T20:02:20.547

有一个用于执行 hittest 的功能，您可以在此处阅读：http: [//livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/DisplayObject.html#hitTestObject()](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/DisplayObject.html#hitTestObject())

虽然对于圆来说，如果你知道半径就很容易了，如果中心之间的距离小于它们的半径之和；他们互相接触。

但是通过查看您的代码，您应该正确地重写整个事情。球真的不应该在内部处理碰撞和运动逻辑。它应该只有一个位置和速度向量，而运动和碰撞逻辑应该在其他类中。

至于反应的代码，这取决于你想要它有多复杂。可以是简单地翻转速度向量的 y 部分，也可以是相当复杂的数学。

这方面有很多教程和示例，我认为您最好在谷歌上找到一些并使用它。然后自己写。*****