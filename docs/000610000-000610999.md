# StackOverflow 问答 000610000-000610999

# unit-testing - 了解单元测试约束和 NUnit 语法助手

> ID：610001
> 
> 赞同：2
> 
> 时间：2009-03-04T10:24:18.410
> 
> 标签：unit-testing, nunit, constraints

我和一位同事正在开始一个新项目并尝试充分利用 TDD。我们仍在弄清楚单元测试的所有概念，并且到目前为止主要基于其他示例。

我的同事最近对 NUnit 语法助手的观点提出了质疑，我正在努力解释它们的好处（因为我自己并不真正理解它，除了我的直觉说它们很好！）。这是一个示例断言：

```
Assert.That(product.IsValid(), Is.False); 
```

对我来说，这完全有道理，我们说我们期望 的`product.IsValid()`值为`false`。另一方面，我的同事希望我们简单地写：

```
Assert.That(!product.IsValid()); 
```

他对他说这更有意义，他可以更容易地阅读。

到目前为止，我们唯一能达成共识的是，当前者的测试失败时，你可能会得到更有帮助的输出，但我认为必须有更好的解释。我查找了一些关于语法助手的信息（[http://nunit.com/blogs/?p=44](http://nunit.com/blogs/?p=44)），它们是有道理的，但除了它们“感觉”正确之外，我并不完全理解约束的概念.

我想知道是否有人可以解释为什么我们使用约束的概念，以及为什么他们改进了上面的单元测试示例？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T10:48:54.733

我认为这主要与声明的纯英文阅读有关。

第一个读

> 断言产品有效是假的

第二个读

> 断言非产品是有效的

我个人觉得第一个更容易处理。我认为这完全取决于偏好。一些扩展方法很有趣，但可以让你做这样的断言：

```
product.IsValid().IsFalse(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T11:14:03.330

我可以看到你的版本比你的同事好。但是，我仍然至少对以下内容感到满意：

```
Assert.IsFalse(product.IsValid()); 
```

如果你能让我相信`Assert.That`语法比上述语法有客观的好处，我会很感兴趣:)这很可能只是习惯的力量，但我可以很容易地阅读“我们在做什么样的断言？现在什么我们是在断言它吗？” 风格。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T19:03:28.960

都是糖。在内部，它们被转换为约束。

来自实用单元测试，第 37 页：

“NUnit 2.4 引入了一种新的断言风格，它的程序性稍差，并允许更面向对象的底层实现。......例如：

```
Assert.That(actual, Is.EqualTo(expected)); 
```

转换为：

```
Assert.That(actual, new EqualConstraint(expected));" 
```

使用约束还允许您从约束继承并创建自己的自定义约束，同时保持一致的语法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-27T05:13:42.260

我不喜欢 Assert.That，特别是它最常见的场景（比较两个对象的相等性）明显比“经典” Assert.AreEqual() 语法差。

另一方面，我超级喜欢 MSpec NUnit 扩展。我建议您检查它们（或查看 SpecUnit 扩展，或 NBehave 扩展，或 N *Behave* Spec*Unit 扩展，我认为它们都是相同的）。

# oracle10g - 由于我不需要更多 4gb 的数据存储，我可以将 oracle express 用于我的 Web 应用程序吗？

> ID：610004
> 
> 赞同：0
> 
> 时间：2009-03-04T10:24:44.493
> 
> 标签：oracle10g

我正在开发一个小型 Web 应用程序，它的数据大小是恒定的。即数据剂量随着日期/用户增长。

我想知道我是否可以将 Oracle Express 用于此应用程序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T10:34:11.647

[http://www.oracle.com/technology/software/htdocs/xe_lic_prod.html](http://www.oracle.com/technology/software/htdocs/xe_lic_prod.html)

```
Any use of the Oracle Database Express Edition is subject to the following limitations; 
1\. Express Edition is limited to a single instance on any server; 
2\. Express Edition may be installed on a multiple CPU server, 
  but may only be executed on one processor in any server; 
3\. Express Edition may only be used to support up to 4GB of user data 
  (not including Express Edition system data); 
4\. Express Edition may use up to 1 GB RAM of available memory. 
```

所以我会说，是的。

Oracle 自己会强制执行这些限制吗？如果不是，如何限制实例仅在一个 CPU 上运行？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T11:10:34.633

我认为 Oracle 的局限性非常深。我在 Oracle 的经验表明，他们通过销售咨询来赚钱，为此他们不会记录他们的产品。如果您想进行非默认安装或一些花哨的配置，预计会有一段时间。

为什么不选择：

MySql、MS SQL Express 还是 Postgre SQL？

它们都是免费的，并且限制较少。如果您使用 ASP.NET 或 Java 或 PHP 开发您的站点，那么所有这些都是有意义的。Postgre SQL 可能是目前最强大的*免费*数据库引擎之一。

如果你想变得非常酷和灵活，可以使用像 (N)Hibernate 或 Linq 这样的 ORM。这将抽象您使用的数据库，以便您以后可以轻松地更改数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T14:57:24.690

在不知道您需要的所有事情的细节的情况下，我的回复将反映出这一点。

仅举几例： 1\. 有多少用户将连接到该数据库？2\. 是 CPU 还是 IO 绑定系统？3\. 您需要哪些数据库功能？

Oracle Express 很可能会处理您模糊的当前需求。您最有可能首先遇到的问题是您的数据是否超过 4GB。我不会假设您的数据会保持不变，很少有事情会保持不变。每次达到 4GB 数据限制或必须将数据移动到新数据库时处理清除数据的痛苦不值得让您首先使用它的免费营销钩子。如果您不打算为 Oracle 许可证付费，那么最好使用开源数据库，例如 PostgreSQL 甚至 MySQL，这些数据库不会对软件进行人为限制，并且谁的许可证将始终免费。我个人会选择 PostgreSQL。

我发现 Oracle Express 是一个很好的工具，可以在我的笔记本电脑上快速安装 Oracle 以供学习。尽管很多人可能会这样做，但我不会将它用于生产中的任何东西。

这些是我的想法，不知道您的所有要求。

是的，Oracle 强制执行 Thilo 之前在软件中声明的限制。

# c# - 绑定 TextBlock Linq ToSql 和 WPF

> ID：610013
> 
> 赞同：0
> 
> 时间：2009-03-04T10:26:20.043
> 
> 标签：c#, .net, wpf, linq-to-sql

我有一个带有用户名和密码的登录窗口，可以在用户通过身份验证之后在软件中访问我想在下一个窗口（软件的主窗口）中显示在 TextBlock 中通过身份验证的用户的名称......我显示了一个代码片段我的登录窗口：

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
    }

    public bool ValidateApplicationUser(string userName, string password)
    {
      {
            var AuthContext = new DataClasses1DataContext();
            var query = from c in  AuthContext.Users
                        where (c.Username == userName.ToLower() && c.Password == password.ToLower())
                        select c;

            if(query.Count() != 0 )
            {
                return true;
            }

            return false;
        }
    }

    private void mahhh(object sender, RoutedEventArgs e)
    {
        bool authenticated = true;
        {
            if (usernameTextBox.Text !="" && passwordTextBox.Text != "")
            {
                authenticated = ValidateApplicationUser(usernameTextBox.Text , passwordTextBox.Text);
            }
        }
        if (!authenticated)
        {
            MessageBox.Show("Invalid login. Try again.");
        }
        else
        {
            MessageBox.Show("Congradulations! You're a valid user!");
            MainWindow c = new MainWindow();
            c.ShowDialog();
        }
    }
} 
```

如果我在 MainWindow 中使用用户名“Marc”进行身份验证，我将在 TextBlock 中显示用户名“Marc”，但我不知道我成功了吗？我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T14:23:11.967

我认为您的代码中有一些错误（它将允许记录空字段），它必须像：

```
 bool authenticated = true;
    {
        if (usernameTextBox.Text !="" && passwordTextBox.Text != "")
        {
            authenticated = ValidateApplicationUser(usernameTextBox.Text , passwordTextBox.Text);
        }

    }
    if (!authenticated || usernameTextBox.Text == "" || passwordTextBox.Text == "")
    {
        MessageBox.Show("Invalid login. Try again.");
    }
    else
    {
        MessageBox.Show("Congradulations! You're a valid user!");
        MainWindow c = new MainWindow();
        c.ShowDialog();

    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T09:07:15.713

简单地说，像这样将 UserName 传递给主窗口的构造函数

```
MainWindow c = New MainWindow(usernameTextBox.Text); 
```

在主窗口的构造函数中接收变量中的值并用它做任何你想做的事情，就像这样

```
private String _userName;

public MainWindow(string userName)
{ 
    _userName = userName
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T13:49:27.490

将公共变量/属性添加到您的 MainWindow 类

```
public string Username { get; set; } 
```

现在您可以设置属性

```
MessageBox.Show("Congradulations! You're a valid user!");
MainWindow c = new MainWindow();
c.Username = usernameTextBox.Text;
c.ShowDialog(); 
```

并在您的 MainWindow 中使用它

```
MainWindow_Loaded(..) {      
   MessageBox.Show("You are " + Username);
} 
```

# flash - Flex 3 和 flash 插件错误

> ID：610014
> 
> 赞同：0
> 
> 时间：2009-03-04T10:26:52.227
> 
> 标签：flash, plugins, flex3

我使用 Flex Builder 构建了一个 flex 3 应用程序。然后我将其嵌入到门户应用程序中，但在安装 Flash Player 时遇到问题

当我在 Firefox 或 IE6（未安装 Flash）中加载我的应用程序时，我会收到一条消息，我的 flex 应用程序应该在哪里，

（“需要附加插件才能在此页面上显示所有媒体”）

当我单击安装插件时，我收到另一个错误：

（未知插件（应用程序/八位字节流））。

该插件没有加载，我留下了挂起。如果我然后去手动安装 Flash 插件，该应用程序可以正常工作，但我不希望其他用户遇到这种困难。有人有什么建议吗？我使用 Flex Builder 3 构建项目

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T10:34:35.360

此页面上的 Flash 是否有效，或者您是否得到相同的提示？ [http://www.adobe.com/products/flashplayer/](http://www.adobe.com/products/flashplayer/)

如果你得到同样的提示，不要让浏览器安装插件。而是使用该页面上的下载链接并手动安装 Flash 播放器，最好是作为具有管理权限的用户。

重新启动您的机器，然后重试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T12:35:24.273

尝试使用[SWFObject](http://code.google.com/p/swfobject/)将您的 flash 对象嵌入到网页中。在替代内容部分（您会明白我的意思，只需查看文档），输入以下内容：

```
<a href="http://www.adobe.com/go/getflashplayer"><img border="0"
src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" 
alt="Get Adobe Flash player" /></a> 
```

SWFObject 也应该处理安装了 Flash 播放器的情况，但它的版本对于您的应用程序来说太低了。

# sharepoint - 是否可以将新闻组导入 TFS 讨论？

> ID：610016
> 
> 赞同：0
> 
> 时间：2009-03-04T10:27:49.120
> 
> 标签：sharepoint, tfs

我们正在考虑改用 TFS 和基于 SharePoint 的 TFS 门户。我们已经在各种系统中获得了现有信息，如果我们可以将这些信息整合到 TFS 门户中，那将是非常有利的。

我想知道是否有任何工具/方法可以将数据导入 TFS。我对导入感兴趣的是：

*   新闻组 - 可用于 TFS 讨论。
*   Fogbugz - 可以放入 TFS 工作项中。（对不起乔尔）
*   一个TWiki

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T10:32:34.710

鉴于将历史从一个 TFS 存储库导入另一个存储库非常困难，我怀疑导入其他类型的数据也同样困难。

另一方面，有一个[不错的 API](http://msdn.microsoft.com/en-us/library/bb130146.aspx)，所以自己写东西应该不难。

查看[Rob Caron 的博客](http://blogs.msdn.com/robcaron/)和[TFS API 示例](http://www.tfsexamples.com/default.aspx?AspxAutoDetectCookieSupport=1)站点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:40:14.173

只是一个小小的澄清。没有 TFS 讨论组。TFS 使用 SharePoint WSS 作为协作工具。因此，如果您搜索将内容导入 WSS 讨论的任何工具，您可能会找到更好的结果。您还可以找到可以安装在 WSS 站点上的第三方讨论 Web 部件。

# asp.net - Visual Basic - 在函数调用中返回“this”

> ID：610021
> 
> 赞同：1
> 
> 时间：2009-03-04T10:30:14.823
> 
> 标签：asp.net, vb.net, class, function

我在一个类中有一个函数，我想返回该类本身，但是“返回这个”在 VB 中似乎无效。

我正在使用 ASP.NET v1.1，如果这有什么不同？

示例（极其简化）代码如下：

```
Public Class Cart

    Private sItems As String

    Public Function addItem(ByVal itemName As String) As Cart
        sItems = sItems + "|" + itemName + "|"
        Return THIS
    End Function

End Class 
```

任何帮助将不胜感激。非常感谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T10:31:53.900

在 VB 中 Me 是关键字，对于您所在的课程，请尝试

```
Public Class Cart
    Private sItems As String

    Public Function addItem(ByVal itemName As String) As Cart
        sItems = sItems + "|" + itemName + "|"        
        Return Me
    End Function

End Class 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T10:37:41.313

只是有点迂腐的说法

您正在返回 Class 类型的实例，而不是返回类类型本身。

this 和 Me 指的是当前实例或对象，而不是 this.GetType() 的类定义

# c# - 我在哪里可以找到 CLI 规范？

> ID：610026
> 
> 赞同：0
> 
> 时间：2009-03-04T10:31:44.447
> 
> 标签：c#, .net, specifications

我正在寻找 CLI 规范。在哪里可以找到下载？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T10:33:34.053

我想你在[ECMA 335](http://www.ecma-international.org/publications/standards/Ecma-335.htm)之后。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T10:34:29.823

为什么不问谷歌？

[http://www.ecma-international.org/publications/standards/Ecma-335.htm](http://www.ecma-international.org/publications/standards/Ecma-335.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T10:37:00.127

[这里](http://msdn.microsoft.com/en-us/netframework/aa569283.aspx)有一整套 C# 和 CLI 规范文档。

# asp.net - ASP.NET：管理全球资源的最佳方式？

> ID：610028
> 
> 赞同：0
> 
> 时间：2009-03-04T10:31:56.037
> 
> 标签：asp.net

我有几个电子邮件模板，我想将每个模板存储在一个单独的文件中。我想避免每次需要它们时都从光盘中读取它们。ASP.NET 中是否有任何内置结构可以在需要时自动加载它们并在整个应用程序中共享这些资源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T11:25:55.347

您可以将电子邮件存储在应用程序字典或缓存或资源文件中，但从长远来看，我发现根据文件的大小、文件的数量和使用频率，通常最好只阅读每次都从磁盘上。这样您就不会阻塞内存，也不必拥有任何缓存代码。

如果文件很小并且您只需要时不时地从磁盘中读取它。如果您只有几个模板并且一直需要它们，那么请选择其他建议之一。（如果模板是纯文本，我会使用资源文件而不是重新发明轮子，但如果您需要复杂的模板，您可能需要其他东西）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T10:34:55.937

您可以使用`Cache`or`Application`对象。

此外，对于简单的任务，一个简单的`static`字段就足够了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T10:35:17.357

您可以在 Web 应用程序中创建 Global_Resources 文件夹并将全局资源文件放在那里。（*.resx 文件）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T10:38:46.630

[ASP.NET 缓存](http://msdn.microsoft.com/en-us/kb/kb00323290.aspx)非常适合您的问题。

您也可以使用[Enterprise Library Caching Block](http://msdn.microsoft.com/en-us/library/cc309502.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T10:42:57.213

```
System.Web.HttpApplicationState 
```

# php - RSA加密/解密兼容Javascript和PHP

> ID：610048
> 
> 赞同：8
> 
> 时间：2009-03-04T10:38:14.073
> 
> 标签：php, javascript, rsa

我想用 Javascript 加密，然后用 PHP 解密。Javascript 和 PHP 有 RSA 实现，但它们不兼容。我无法在 PHP 中正确解密我用 Javascript 加密的内容。

有谁知道可以同时使用 Javascript 和 PHP 的库/代码？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-06-06T21:20:13.067

试试下面这个简单的例子。

它使用开源的 javascript 库[https://github.com/ziyan/javascript-rsa](https://github.com/ziyan/javascript-rsa)

HTML/JAVASCRIPT：

```
<script language="JavaScript" type="text/javascript" src="jsbn.js"></script>
<script language="JavaScript" type="text/javascript" src="rsa.js"></script>

<script language="JavaScript">

    function encryptData(){

        //Don't forget to escape the lines:
        var pem="-----BEGIN PUBLIC KEY-----\
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDfmlc2EgrdhvakQApmLCDOgP0n\
NERInBheMh7J/r5aU8PUAIpGXET/8+kOGI1dSYjoux80AuHvkWp1EeHfMwC/SZ9t\
6rF4sYqV5Lj9t32ELbh2VNbE/7QEVZnXRi5GdhozBZtS1gJHM2/Q+iToyh5dfTaA\
U8bTnLEPMNC1h3qcUQIDAQAB\
-----END PUBLIC KEY-----";

        var key = RSA.getPublicKey(pem);

        element=document.getElementById('password');
        element.value=RSA.encrypt(element.value, key);
    }
</script>

<form method='POST' id='txtAuth' onsubmit='encryptData()'>
    <input type='text' name='username'/>
    <input type='password' name='password' id='password' placeholder="password"/>
    <input name='submit' type='submit' value='Submit'>
</form> 
```

PHP：

```
<?php

if (isset($_POST['password'])) {

    //Load private key:
    $private = "-----BEGIN RSA PRIVATE KEY-----
    MIICXAIBAAKBgQDfmlc2EgrdhvakQApmLCDOgP0nNERInBheMh7J/r5aU8PUAIpG
    XET/8+kOGI1dSYjoux80AuHvkWp1EeHfMwC/SZ9t6rF4sYqV5Lj9t32ELbh2VNbE
    /7QEVZnXRi5GdhozBZtS1gJHM2/Q+iToyh5dfTaAU8bTnLEPMNC1h3qcUQIDAQAB
    AoGAcbh6UFqewgnpGKIlZ89bpAsANVckv1T8I7QT6qGvyBrABut7Z8t3oEE5r1yX
    UPGcOtkoRniM1h276ex9VtoGr09sUn7duoLiEsp8aip7p7SB3X6XXWJ9K733co6C
    dpXotfO0zMnv8l3O9h4pHrrBkmWDBEKbUeuE9Zz7uy6mFAECQQDygylLjzX+2rvm
    FYd5ejSaLEeK17AiuT29LNPRHWLu6a0zl923299FCyHLasFgbeuLRCW0LMCs2SKE
    Y+cIWMSRAkEA7AnzWjby8j8efjvUwIWh/L5YJyWlSgYKlR0zdgKxxUy9+i1MGRkn
    m81NLYza4JLvb8/qjUtvw92Zcppxb7E7wQJAIuQWC+X12c30nLzaOfMIIGpgfKxd
    jhFivZX2f66frkn2fmbKIorCy7c3TIH2gn4uFmJenlaV/ghbe/q3oa7L0QJAFP19
    ipRAXpKGX6tqbAR2N0emBzUt0btfzYrfPKtYq7b7XfgRQFogT5aeOmLARCBM8qCG
    tzHyKnTWZH6ff9M/AQJBAIToUPachXPhDyOpDBcBliRNsowZcw4Yln8CnLqgS9H5
    Ya8iBJilFm2UlcXfpUOk9bhBTbgFp+Bv6BZ2Alag7pY=
    -----END RSA PRIVATE KEY-----";
    if (!$privateKey = openssl_pkey_get_private($private)) die('Loading Private Key failed');

    //Decrypt
    $decrypted_text = "";
    if (!openssl_private_decrypt(base64_decode($_POST['password']), $decrypted_text, $privateKey)) die('Failed to decrypt data');

    //Decrypted :) 
    var_dump($decrypted_text);

    //Free key
    openssl_free_key($privateKey);
}
?> 
```

享受！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-20T22:14:15.050

这是一个 JavaScript RSA 加密库： http: [//www.ohdave.com/rsa/](http://www.ohdave.com/rsa/)

而且我认为您可以使用此类来解密生成的加密字符串-http: [//www.phpclasses.org/browse/package/4121.html](http://www.phpclasses.org/browse/package/4121.html)

让我知道您是否设法一起完成这项工作，因为我自己正在研究这个主题（实际上我发现这篇文章自己正在寻找这个答案：P）。

编辑：看，我也发现了这个 - [http://www.sematopia.com/?p=275](http://www.sematopia.com/?p=275) - 似乎也与前两个有关......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T10:45:39.763

如果您将服务器设置为使用 SSL，那么您可以使用 https 通过 ajax 进行加密传输。这可能是在 javascript 和 php 之间加密数据的最佳方式。如果您想自己制作，那么您很有可能会在某个地方搞砸，并且系统将不安全。

谷歌了解如何为您的服务器设置 https。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T10:49:39.847

我假设您有正当理由这样做，而不是自己做 https，所以我想说，如果您坚持标准，您应该能够使用支持这些标准的任何技术轻松解密：即它应该可以工作

例如，如果您以 PKCS#7 格式加密数据，请确保您的 php 库知道输入数据是 PKCS#7。

还要确保您的加密密钥在服务器和客户端之间没有被打乱。您是否尝试使用您的 javascript 库解密您的数据？

希望这可以帮助...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T13:09:55.953

也许您可以通过将您用于 js 和 php 的代码放入其中来提供帮助。

另外，也许您可​​以更具体地说明为什么需要使用 js 和 php。也许您只能在使用 js 的地方使用 php 和 AJAX（查询相同的 php 函数）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-27T01:17:56.497

我不是一个自吹自擂的人，但我在 github.com 上有一个项目可以执行此功能。

在服务器上生成私钥，公钥和 pkcs#7 证书也从私钥派生。公钥被发送到客户端，此时与指定表单相关联的每个表单元素在提交到服务器之前都被加密。

它与 OpenSSL 100% 兼容，因为它使用 PHP OpenSSL 扩展来生成、加密和解密数据。

[https://github.com/jas-/jQuery.pidCrypt/](https://github.com/jas-/jQuery.pidCrypt/)

这个项目不如 PGP 安全，因为 JavaScript 在表单数据发送到服务器之前不会对电子邮件进行签名和加密，但是要加密和/或签名的表单数据在发送之前使用 RSA 公钥加密进行加密到服务器。

同样，该项目在身份验证和电子邮件签名方面并不完整，但对于使用公钥的普通表单加密，它工作得很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-26T21:43:09.743

我找到了这个 jsencrypt 库（[http://travistidwell.com/jsencrypt](http://travistidwell.com/jsencrypt)），经过 2 天的尝试，我得到了我的解决方案。

我遇到的唯一问题是当我发送长文本时。这是因为根据定义，RSA 支持长度有限的字符串。

[https://security.stackexchange.com/questions/33434/rsa-maximum-bytes-to-encrypt-comparison-to-aes-in-terms-of-security/33445#33445](https://security.stackexchange.com/questions/33434/rsa-maximum-bytes-to-encrypt-comparison-to-aes-in-terms-of-security/33445#33445)

> 由 PKCS#1 定义的 RSA 对大小有限的“消息”进行加密。使用常用的“v1.5 padding”和 2048 位 RSA 密钥，可以用 RSA 加密的最大数据大小为 245 字节。不再。

即如果我使用 1024 的 private_key_bits 我可以发送

```
"José compró en Perú una vieja zampoña. Excusándose, Sofía tiró su whisky al desagüe de la banqueta." 
```

再也没有了。如果我使用 512 的 private_key_bits 我可以发送

```
"José compró en Perú una vieja zampoña. Excusánd" 
```

再也没有了。

在长字符串 JavaScript 控制台报告：“对于 RSA 来说消息太长”

然后，如果你想加密长字符串，你必须在 javascript 加密之前和在 php 上解密加入和解压缩之后压缩和拆分它们，我认为 zlib 是一个很好的拆分/加入解决方案，因为它在 javascript 和 php 上受支持。

我的工作代码如下：

```
<?php
    //------------------------------------------------------------
    // Global Settings.
    //------------------------------------------------------------
    ini_set('display_errors', 1);
    error_reporting(E_ALL);
    $directorio = "/path/to/key/directory/apache/writable/";
    $nombre_base = "llaves_php";

    //------------------------------------------------------------
    // Initialization.
    //------------------------------------------------------------
    $encabezado_html = "";
    $cuerpo_html = "";

    //------------------------------------------------------------
    // Loading keys
    //------------------------------------------------------------
    list($privateKey, $pubKey) =
        cargar_llaves_RSA($directorio, $nombre_base);

    //------------------------------------------------------------
    // Form that uses javascript to encrypt data.
    // (it uses only the public key)
    //------------------------------------------------------------
    $librerias_html = "
        <script type='text/javascript'
                src='https://ajax.googleapis.com/ajax/libs/".
                    "jquery/3.2.1/jquery.min.js'></script>
        <script type='text/javascript'
                src='lib/jsencrypt.js'></script>
        ";

    $pubKey_html = htmlentities($pubKey);
    $datos_html = "
        <h2>Cifrando con Javascript</h2>
        <input type='text' id='mensaje' />
        <br />
        <button id='ENVIAR'>Enviar</button>
        <br />
        <textarea id='pubkey' style='display: none;'>".
        $pubKey_html.
        "</textarea>
        <script type='text/javascript'>
            $('#ENVIAR').click(function () {
                var codificador = new JSEncrypt();
                codificador.setKey($('#pubkey').val());
                var cifrado = codificador.encrypt($('#mensaje').val());
                window.open('?mensaje=' + encodeURIComponent(cifrado)
                           , '_top');
            });
        </script>
        ";

    //------------------------------------------------------------
    // Decrypting using php (it uses only the privateKey)
    //------------------------------------------------------------
    if (isset($_REQUEST['mensaje'])) {
        openssl_private_decrypt( base64_decode($_REQUEST['mensaje'])
                               , $descifrado
                               , $privateKey);
        $datos_html.= "
            <h2>Descifrando con PHP</h2>
            ".$descifrado."
            ";
    }

    //------------------------------------------------------------
    // HTML DISPLAY
    //------------------------------------------------------------
    $encabezado_html.= "<title>Receptor de mensaje cifrado</title>"
                     . $librerias_html;

    $cuerpo_html.= $datos_html;

    $contenido = "<head>$encabezado_html</head><body>$cuerpo_html</body>";
    $contenido = "<html>$contenido</html>";
    print $contenido;

//============================================================
//============================================================
// Functions
//============================================================
//============================================================

    //------------------------------------------------------------
    function cargar_llaves_RSA($directorio, $nombre_base) {
    //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // PROPÓSITO: Genera o carga desde archivos las llaves RSA
    // ENTRADAS:
    // $directorio: Directorio donde se encuentran los archivos.
    // $nombre_base: Nombre, sin extensión, de los archivos con
    //               las llaves.
    // SALIDAS:
    //------------------------------------------------------------
        if (  !file_exists($directorio.$nombre_base.".crt")
           || !file_exists($directorio.$nombre_base.".pub")) {
            list($privateKey, $pubKey) = crear_llaves_RSA($directorio.$nombre_base);
        } else {
            //------------------------------------------------------------
            // CARGA DE LLAVES RSA ARCHIVADAS
            //------------------------------------------------------------
            $privateKey = file_get_contents($directorio.$nombre_base.".crt");
        if (!$privKey = openssl_pkey_get_private($privateKey))
            die('Loading Private Key failed');
            $pubKey  = file_get_contents($directorio.$nombre_base.".pub");
        }

    return array($privateKey, $pubKey);
    }

    //------------------------------------------------------------
    function crear_llaves_RSA($ruta_base) {
    //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // PROPÓSITO:
    // generacion de llaves RSA en php
    // ENTRADAS:
    // $ruta_base: Ruta de los archivos a generar sin extensión.
    // SALIDAS:
    // Se generarán dos archivos, uno con la llave privada con
    // extensión .crt, el otro con llave pública con extensión
    // .pub; la función retorna tanto la llave pública como la
    // privada en un arreglo.
    //------------------------------------------------------------
        $config = array(
            "private_key_bits" => 1024,
            "private_key_type" => OPENSSL_KEYTYPE_RSA,
        );

        $llavePrivadaCruda = openssl_pkey_new($config);
        openssl_pkey_export_to_file($llavePrivadaCruda, $ruta_base.".crt");
        $privateKey = file_get_contents($ruta_base.".crt");
        openssl_pkey_export($llavePrivadaCruda, $privKey);

        $pubKeyData = openssl_pkey_get_details($llavePrivadaCruda);
        $pubKey = $pubKeyData["key"];
        file_put_contents($ruta_base.".pub", $pubKey);
        openssl_free_key($llavePrivadaCruda);

    return array($privateKey, $pubKey);
    }

    //------------------------------------------------------------
    function Mostrar($valor) {
    //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // PROPÓSITO: Genera el código HTML para presentar una
    // variable embebida en la página.
    // ENTRADAS:
    // $valor: el valor a presentar.
    // SALIDAS: código html que permite visualizar la variable.
    //------------------------------------------------------------
        $retorno = htmlentities(stripslashes(var_export($valor, true)));
        $retorno = "<pre>$retorno</pre>";
        return $retorno;
    }

?> 
```

目录树必须如下所示：

```
├── script.php
└── lib
    └── jsencrypt.js 
```

以及一个可在公共区域之外由 php 写入的目录，名为

```
/path/to/key/directory/apache/writable/ 
```

* * *

# oracle - 是否可以通过 Oracle 中的绑定变量引用列名？

> ID：610056
> 
> 赞同：5
> 
> 时间：2009-03-04T10:42:16.513
> 
> 标签：oracle, data-binding, jdbc, sql-order-by

我试图在与 Oracle 数据库通信的应用程序中引用列名来排序查询。我想使用绑定变量，以便我可以动态更改查询的顺序。

我遇到的问题是数据库似乎忽略了按列排序。

有谁知道是否有通过绑定变量引用数据库列的特定方法，或者是否有可能？

例如我的查询是

```
SELECT * FROM PERSON ORDER BY :1 
```

（`:1`将绑定到哪里`PERSON.NAME`）查询未按字母顺序返回结果，我担心数据库将其解释为：-

```
SELECT * FROM PERSON ORDER BY 'PERSON.NAME' 
```

这显然行不通。

任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T10:46:27.813

不可以。您不能将绑定变量用于表名或列名。

需要此信息来创建执行计划。例如，如果不知道您要订购什么，就不可能弄清楚要使用什么索引。

当您的程序创建列名时，您必须直接将列名插入到 SQL 语句中，而不是绑定变量。假设您对 SQL 注入采取了预防措施，那么这没有任何不利之处。

**更新：**如果你真的想跳过篮球，你可能会做类似的事情

```
order by decode(?, 'colA', colA, 'colB', colB) 
```

但这很愚蠢。而且慢。不。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T15:54:25.653

当您使用 JDBC 时。您可以将代码重写为没有绑定变量的内容。这样，您还可以动态更改 order-by，例如：

```
String query = "SELECT * FROM PERS ";
if (condition1){
  query = query+ " order by name ";
// insert more if/else or case statements
} else {
  query = query+ " order by other_column ";
}
Statement select = conn.createStatement();
ResultSet result = select.executeQuery(query); 
```

甚至：

```
String columnName = getColumnName(input);
Statement select = conn.createStatement();
ResultSet result = select.executeQuery("SELECT * FROM PERS ORDER BY "+columnName); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T07:23:12.440

```
ResultSet result = select.executeQuery(
    "SELECT * FROM PERS ORDER BY " + columnName
); 
```

将始终是数据库的**新**语句。
这意味着，就像 Thilo 已经解释的那样，不可能“重新排序”已经绑定、计算、准备、解析的语句。在您的应用程序中一遍又一遍地使用此结果集时，唯一会随着时间变化的是呈现的顺序，请尝试在您的客户端代码中对结果集进行排序。
否则，动态 SQL 很好，但会占用大量空间。

# c - 在 AIX 上构建和打包的最佳实践

> ID：610060
> 
> 赞同：1
> 
> 时间：2009-03-04T10:45:08.237
> 
> 标签：c, compilation, aix

有谁知道我在哪里可以找到一些在 AIX 上构建和打包 C 应用程序的最佳实践指南。

我正在使用 xlc 编译器和 make。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T16:02:57.563

也许[在这里](http://publibn.boulder.ibm.com/doc_link/en_US/a_doc_lib/aixprggd/genprogc/pkging_sw4_install.htm)？

# asp.net - ASP.NET Page.OnLoad 执行两次

> ID：610061
> 
> 赞同：7
> 
> 时间：2009-03-04T10:45:27.690
> 
> 标签：asp.net

任何人都知道 Page.OnLoad() 何时以及为什么在 ASP.NET 生命周期中执行两次？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T10:47:13.053

该页面上的 URL 是否有一个带有空白字符串的 IMAGE 元素？

这个以前抓过很多人:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T10:50:22.640

确保您没有任何标签，如 <img src="#"> 或 <img src="">，这会使 IIS 加载页面两次。这是一个经典。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T10:49:15.357

您是否已在代码中`AutoEventWireUp`设置`true`并附加了事件处理程序？这是一个常见的原因。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-02-09T09:08:29.527

另一种可能性是启用了 Visual Studio 浏览器链接。要找出导致问题的原因，您可以检查 Request 对象。

![](https://media-www-asp.azureedge.net/media/4418333/browserlink11.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T10:53:19.417

您是否有任何将 AutoPostBack 设置为 true 的控件？这将导致重新创建 Page 对象，因此 PageLoad 方法将再次执行。

# java - JSP 与 Velocity 哪个更好？

> ID：610062
> 
> 赞同：34
> 
> 时间：2009-03-04T10:45:33.633
> 
> 标签：java, jsp, velocity

JSP 和速度之间哪个更好 - 性能 - 易于使用 - 易于创建可重用组件 - 开源 3rd 方的可用性 - IDE 支持

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-23T12:03:03.070

@Vartec：我不认为“视图与业务逻辑的严格分离”是jsp中不存在的速度特性。您可以在 jsp 中（或多或少）做业务逻辑，但完全不推荐。但我同意你关于语法的观点。

**表现**

JSP 被编译成 Java，所以我不认为速度更快。（我自己没有做过基准测试）

**便于使用**

对于设计师：velocity 对于程序员：（恕我直言）jsp，因为它更接近代码

**易于创建可重用组件**

JSP 有很多组件 Velocity 本身没有组件（不是面向组件的）

**开源第 3 方的可用性**

我见过比速度更多的项目使用 JSP 或 JSP 相关技术。也许是因为速度真的很低...... :-)

**IDE 支持**

jsp有很多工具。特别是 eclipse jboss 插件/工具套件有一个很好的 jsp 编辑器。

Velocity 的插件大多不是功能性的或非常基本的（如果你有语法高亮，你会很幸运）

**更新** 如果您现在正在寻找模板引擎，我建议您看看 thymeleaf。它相对于速度来说是相当轻量级的，可以用几行代码来模板化一些基于文本的模板，或者用作一个全功能的模板引擎，例如在 web 应用程序中。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-04T10:59:05.893

速度优势：

*   视图与业务逻辑严格分离
*   图形设计师可以理解的简单语法

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-12-29T19:15:14.423

以下是关于 Freemarker，但比较可能仍然相关。

在这两种技术发展的这一点上，选择其中一种的主要原因似乎是：

1.  您需要一些特定的东西，它在一个而不是另一个
2.  您想阻止视图开发人员将 Java scriptlet 放入 JSP 页面
3.  您的开发人员在其中一个方面比在另一个方面更舒服

似乎影响不大的原因：

1.  速度。一个典型的 Java EE 应用程序中有很多层，它们的影响比视图渲染器可能花费的几毫秒或多或少要大得多。事实上，如果我的应用程序表现不佳，这可能是我要处理的最后一层。
2.  IDE 支持。JBoss Tools 提供了 Freemarker 编辑器，而 JSP 工具是众所周知的。
3.  句法。由于 EL 和 JSTL，JSP 2 和 Freemarker 对于许多基本操作具有几乎相同的语法。

自由标记示例：

```
<#list foos as foo>
  <tr>
     <td>${foo.field1}</td>
     <td>${foo.field2}</td>
     <td>
        <#list foo.childObjects as child>
           <#if child.name == 'bar'>
              ${child.value}
           </#if>
        </#list>
     </td>
  </tr>
</#list> 
```

JSP-EL-JSTL 示例：

```
<c:forEach items="${foos}" var="foo">
  <tr>
     <td>${foo.field1}</td>
     <td>${foo.field2}</td>
     <td>
        <c:forEach items="${foo.childObjects}" var="child">
           <c:if test="${child.name == 'bar'}">
              ${child.value}
           </c:if>
        </c:if>
     </td>
  </tr>
</c:forEach> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-04T10:51:19.347

速度甚至更好的[FreeMarker](http://freemarker.sourceforge.net/)。在 JSP 中，您不能[对 pojo 层次结构进行运行时调度，](http://blog.cherouvim.com/runtime-dispatching-freemarker-macros-for-pojo-views/)并且所有内容都是静态类型的，这很痛苦。此外，如果您创建了许多 JSP2.0 自定义标签（比如超过 100-150 个），那么由于 Jasper 无法有效地解决依赖关系，您的开发-部署周期将大大减慢。

另一方面，JSP 有很好的工具支持。

慢 JSP 编译参考：

[http://www.mailinglistarchive.com/users@tomcat.apache.org/msg10786.html](http://www.mailinglistarchive.com/users@tomcat.apache.org/msg10786.html)

[http://marc.info/?l=tomcat-dev&m=119377083422720&w=2](http://marc.info/?l=tomcat-dev&m=119377083422720&w=2)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-04T10:55:35.217

我将专注于使用模板引擎，因为这是我最有经验的。

这取决于你真正想做什么。Servlet 与 Velocity（或 FreeMarker）的结合提供了很好的逻辑和表示分离。模板更难测试，因为您需要评估模板才能判断 HTML（或其他任何输出格式）是否正确。对于 JSP，这可以在您选择的 IDE 中完成。

模板的最大优点是您可以将它们完全存储在应用程序之外，甚至可以在应用程序运行时更新它们。尽管热部署非常接近，但这一点用 JSP 做起来有点困难。

可以使用模板引擎的包含功能创建可重用组件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-13T05:56:37.977

从工程师的角度来看，上述 Velocity 的优势遗漏了一些非常重要的事情：

*   视图与业务逻辑的严格分离（如上）
*   图形设计师可以理解的简单语法（如上）
*   紧凑的代码，稍后重新访问不是一场噩梦，请参阅 [示例链接](http://velocity.apache.org/engine/releases/velocity-1.4/casestudy1.html)
*   非 servlet 容器部署意味着在任何地方都可以轻松部署

与 JSP 相比，最后两个确实使 Velocity 有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-19T11:16:12.943

我不知道 Velocity 是否能够在各个方面与 JSP 竞争，但 Velocity 更快、更容易。如果是复杂的网页，Velocity 的效率会提高 35% 到 45%，它可能会降低，但仍然会提高 5%比JSP。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-28T07:43:19.123

Velocity 更好 它适用于许多应用领域 它为模板设计者提供了一个简单、清晰的语法 它为开发者提供了一个简单的编程模型 由于模板和代码是分开的，您可以独立开发和维护它们 Velocity 引擎可以轻松集成到任何Java 应用程序环境，尤其是 servlets Velocity 使模板能够访问上下文中数据对象的任何公共方法

# delphi - GDIPlus.dll 访问冲突错误

> ID：610066
> 
> 赞同：1
> 
> 时间：2009-03-04T10:46:37.953
> 
> 标签：delphi, gdi+, delphi-2006

我收到一个访问冲突错误，指出“模块 gdiplus.dll 中地址 4EC842CD 的访问冲突”。使用的语言： - Delphi 10，Borland Studio 2006 环境： - Windows XP 我有一个应用程序，我在 Delphi 中使用文件打开对话框，这有助于用户从系统的任何位置打开某种类型的文件。默认情况下，它显示默认路径中该类型文件的列表。现在，当我单击应用程序中的“打开”按钮时，它会显示“文件打开”对话框，并帮助用户从系统的任何位置打开该特定类型的文件，但它会给出错误说明“模块 gdiplus 中地址 4EC842CD 的访问冲突.dll”。这是一个随机错误，并非每台 PC 都会出现。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T10:54:11.663

这看起来像问题吗：[microsoft kb 901026](http://support.microsoft.com/?scid=kb;en-us;901026&x=20&y=13)？
在您的系统上寻找损坏的字体可能......

# .net - 如何将方法描述的 XML 注释保存在单独的文件中？

> ID：610070
> 
> 赞同：1
> 
> 时间：2009-03-04T10:47:46.233
> 
> 标签：.net, xml-documentation

这个问题源于这个问题 [Code documentation how much is too much?](https://stackoverflow.com/questions/288298/code-documentation-how-much-is-too-much)

答案之一是将您的 xml 文档保存在单独的文件中。我真的很喜欢这个答案，因为当我查看代码时，文档的冗长令人讨厌，另一方面，在通过智​​能感知搜索正确的方法或发布文档时，冗长很有用。

答案是使用包含标签

```
/// <include file="Documentation/XML/YourClass.xml" path="//documentation/members[@name='YourClass']/*"/> 
```

这里还有一篇关于包含标签的 MSDN 文章[。](http://msdn.microsoft.com/en-us/library/9h8dy30z(VS.71).aspx)

我想出了如何保留摘要信息，但我不知道也找不到如何将方法文档放在那里。（这比课程摘要本身更重要。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T17:48:58.223

答案很简单。读取生成的 xml 文件。他们给出了分离的 xml 文件应该是什么样子的想法。

读取生成的 xml 文件以及如何描述方法（使用参数等）：

```
<member name="M:BitFactory.Logging.Logger.DoLog(BitFactory.Logging.LogEntry)">
    <summary>
    Really log aLogEntry. (We are past filtering at this point.)
    Subclasses might want to do something more interesting and override this method.
    </summary>
    <param name="aLogEntry">The LogEntry to log</param>
    <returns>true upon success, false upon failure.</returns>
</member> 
```

T、M、F 前缀类型、方法、字段。

# c# - 使用 GetHashCode 来“保护”用户密码

> ID：610080
> 
> 赞同：3
> 
> 时间：2009-03-04T10:51:04.917
> 
> 标签：c#, .net, security, cryptography

我工作的公司签订了一份大型订单处理系统的支持合同。作为初始系统审核的一部分，我注意到存储在数据库中的密码实际上是密码的哈希码。

本质上：

```
string pwd = "some pasword";
string securePwd = pwd.GetHashCode(); 
```

我的问题是，这有多安全？

我对此感到不舒服，但我对 GetHashCode 的工作原理知之甚少。我更喜欢使用像 MD5 哈希这样的东西，但如果我在浪费时间，那么我不会打扰。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T10:55:00.913

您应该使用加盐的、加密的强哈希，例如`SHA256Managed`.

Jeff Attwood 有一些关于这个主题的好帖子：

[彩虹哈希破解](http://www.codinghorror.com/blog/archives/000949.html)

[您可能错误地存储了密码](http://www.codinghorror.com/blog/archives/000953.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T10:58:09.563

它不仅不安全，而且可能会发生变化：

[http://netrsc.blogspot.com/2008/08/getashcode-differs-on-systems.html](http://netrsc.blogspot.com/2008/08/gethashcode-differs-on-systems.html)

GetHashValue 为给定输入返回的值在过去发生了变化。

无法保证在应用程序的不同执行之间它甚至是相同的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T10:54:19.977

`GetHashCode`返回一个 32 位整数作为哈希值。考虑到[生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)，由于碰撞概率相对较高，它不是一个足够长的哈希值，即使它被明确设计为抗碰撞，但事实并非如此。

您应该选择 SHA256 或其他旨在处理此类任务的加密安全哈希函数。

要存储密码，仅使用简单的哈希函数是不够的。您应该为每个用户添加一些随机的“盐”并迭代足够多的时间，这样蛮力的计算成本就会很高。因此，您应该使用具有大量迭代的bcrypt、 [scrypt 、PBKDF2 之类的东西。](http://en.wikipedia.org/wiki/Scrypt)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T11:37:59.873

我建议改用[BCrypt](http://derekslager.com/blog/posts/2007/10/bcrypt-dotnet-strong-password-hashing-for-dotnet-and-mono.ashx)。正如其他人已经说过的那样，使用 GetHashCode 作为密码并不是一个好主意。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T10:59:13.337

GetHashCode 绝对不是为了以这种方式使用而设计的，因为实现不保证不同对象的不同哈希返回。这意味着潜在的多个密码可能会产生相同的哈希值。也不保证在不同版本的 .NET 框架上返回相同的哈希值，这意味着升级可能会为相同的字符串生成不同的哈希值，从而使您的密码无法使用。

建议您在推送时使用加盐哈希甚至 MD5。您可以轻松地将其切换到[Security.Cryptography](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx)命名空间中的内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T11:21:20.023

正如其他人所说，GetHashCode 不是为您想要做的事情而设计的。有[一篇关于如何安全处理用户密码的非常好的文章](https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2007/july/enough-with-the-rainbow-tables-what-you-need-to-know-about-secure-password-schemes/)。

总结这篇文章，您需要使用相对较慢的自适应散列方案，例如[bcrypt](http://www.usenix.org/events/usenix99/provos/provos_html/node1.html)，或者[斯坦福安全远程密码协议](http://srp.stanford.edu/design.html)。我建议前者。当然，您还应该使用盐。

# c# - 如何使用现有的 ToolStripRenderer 绘制托管的 NumericUpDown？

> ID：610085
> 
> 赞同：2
> 
> 时间：2009-03-04T10:52:15.303
> 
> 标签：c#, .net, winforms, toolstrip, paint

我有一个控件，它在 a 中托管 a`NumericUpDown`并`ToolStripControlHost`公开了`NumericUpDown`的属性。从功能上讲，这很好，但是当它放在 a 上时，它在视觉上与其他s`ToolStrip`不匹配。`ToolStripItem`

我想使用`ToolStrip`现有的 's`ToolStripRenderer`以类似于控件上的`ToolStripComboBox`es 的方式绘制控件。我对创建自定义`ToolStripRenderer`来执行此操作不感兴趣，因为我希望使用该控件的其他人能够将它与他们选择的任何渲染器一起使用。

我已经尝试在托管控件类和托管控件类中覆盖`OnPaint`并`OnPaintBackground`使用渲染器的绘图方法，但我所能实现的就是在边缘周围有一个未绘制的区域；旋转按钮仍然使用系统主题绘制。

如何`NumericUpDown`使用现有的绘制托管`ToolStripRenderer`？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T11:04:42.510

NumericUpDown 类实际上只是作为 GDI 的一部分存在的公共控件类的包装器。底层公共控件将根据是否为应用程序启用视觉样式以两种方式之一绘制自身。要覆盖绘图，您需要自己执行所有绘图。您不能告诉控件您只想覆盖按钮或边框。

自己完成所有的绘图比听起来要困难得多。抱歉，我无法提供简单的解决方案，但我认为没有简单的解决方案。

# eclipse - 在 Eclipse 中，如何在不破坏项目的情况下将所有源文件移动到不同的文件夹？

> ID：610096
> 
> 赞同：2
> 
> 时间：2009-03-04T10:55:22.597
> 
> 标签：eclipse, svn, macos, project, fdt

我在 Mac 上的一个文件夹中创建了我的 ActionScript 源文件（我通常使用 Windows），并设法制作了一个可以看到它们的 Eclipse/FDT 项目。

我现在需要将它们移动到现有项目的 svn checkout 中，以使它们处于源代码控制之下。

在不丢失项目中所有引用的情况下，我无法弄清楚你是如何做到这一点的。

我是 Eclipse 新手，并不真正了解任何术语（例如工作区）。Eclipse 有项目文件还是全部隐藏？项目文件可以移动吗？

帮助我stackoverflow，你是我唯一的希望。

更新：从 FDT Flash Explorer 窗口中，我似乎只能在存在的项目中移动文件/文件夹。我应该先在我想要的地方创建一个新项目吗？

我应该从 Eclipse 中还是从文件系统中移动它们？之后我需要设置一个新的工作空间吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T11:02:29.490

项目文件夹有 2 个隐藏文件：.project 和 .classpath，其中包含项目的所有信息。您只需要将这些文件与您的项目文件一起复制。

例如，您在workspace/myproject/ 中有一个项目文件夹，并且您想将其添加到checkout svn 文件夹中，您只需将完整的文件夹内容复制到checkout，然后将所有文件添加到svn（包括项目隐藏的），最后提交。

从现在开始，当您从该 svn 结帐时，您将拥有 eclipse 项目文件，因此您需要做的就是创建新项目，然后选择表示您已经有一个包含源文件的项目文件夹的选项（我m 不在 Eclipse IDE 附近准确地说明步骤，但它是这样的）。然后，Eclipse 将使用您之前定义的所有设置导入项目。

我希望这能回答你的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T11:00:13.100

尝试重构您的项目。右键单击要移动的文件夹，然后选择 Refactor->Move。不知道这是否会解决您的问题，但它会尝试根据移动更改所有项目中的引用。

# actionscript - ActionScript - 如何按名称寻址实例？

> ID：610097
> 
> 赞同：2
> 
> 时间：2009-03-04T10:55:22.610
> 
> 标签：actionscript, button, instance, tabs

我是动作脚本的新手，我有以下问题：我有全局变量 tabName 和一个按钮，它改变了它的值，就像这样：

```
on(release){
    _root.tabName = this._name;
} 
```

现在我想使用字符串变量tabName来处理舞台上的窗帘实例来编辑它的属性（实际上，我想控制，选择tabcontrol上的哪个选项卡）。

是否有类似 getInstanceByName 或类似功能的东西？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T12:41:33.697

您可以简单地使用：

```
_root[tabName] 
```

使用包含在变量 tabName 中的实例名称访问影片剪辑。

当然，这是针对位于根目录中的剪辑。你也可以对movieclips中的moviclips做同样的事情：

```
_root.knownMovieClip[stringVariable] 
```

# clickonce - ClickOnce 和安全性

> ID：610102
> 
> 赞同：4
> 
> 时间：2009-03-04T10:58:41.887
> 
> 标签：clickonce

我在一家生产商业产品的公司工作，我们目前正在尝试提供一种解决方案，使我们的一些大客户能够通过 ClickOnce 分发我们应用程序的客户端。

目的是我们的客户将 ClickOnce 安装部署到网络共享，然后通过电子邮件或其他方式向客户发送指向应用程序清单的链接。

我们已经能够成功地将 ClickOnce 安装的生产集成到我们的自动构建中（使用 Mage 命令行工具），然后我们可以在客户端计算机上成功运行实际安装。然而，在安装和启动之后，我们的应用程序在运行时抛出一个 SecurityException，因为它被拒绝访问 FileIOPermission。我们的应用程序需要 FullTrust 权限，但似乎如果执行程序集的 CodeBase 位置是网络共享，则您只被授予 LocalIntranet 权限（不包括 FileIOPermission）。

这里有一篇文章似乎表明这是一个很常见的问题：http: [//blogs.msdn.com/shawnfa/archive/2004/12/30/344554.aspx](http://blogs.msdn.com/shawnfa/archive/2004/12/30/344554.aspx)

本文提供了一种使用 CasPol 工具的解决方法，但我们必须在部署环境中的每台客户端计算机上运行它。这本身并不是一个真正的问题，更重要的是您需要客户端计算机上的管理员权限才能执行使用 CasPol 工具所做的事情，而我们客户环境中的大多数客户端都没有这些权限。

同一博客上还发表了一篇文章，似乎暗示随着 .NET 3.5 SP1 的发布，运行 CasPol 修复程序的需求已经得到缓解：http: [//blogs.msdn.com/shawnfa/archive/2008/ 05/12/fulltrust-on-the-localintranet.aspx](http://blogs.msdn.com/shawnfa/archive/2008/05/12/fulltrust-on-the-localintranet.aspx)

但是，我修改了我们的应用程序以专门针对框架的 SP1 版本，如本文所述：http: [//msdn.microsoft.com/en-us/library/bb398202.aspx#](http://msdn.microsoft.com/en-us/library/bb398202.aspx#)

这样做之后，我们仍然遇到了同样的 SecurityException。所以我随后应用了文章中详述的一些特定的 SP1 ClickOnce 设置，但仍然没有乐趣。如果我直接从发布网络共享启动应用程序，我被授予权限，似乎只有在 ClickOnce 的上下文中我们才被拒绝。

有没有其他人遇到过类似的问题？我会认为如果框架的 SP1 版本中存在与这些权限相关的问题，其他人会在我们之前注意到它，因为我们甚至还没有发布 ClickOnce 解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-17T11:13:29.157

我想我在 .NET 4.0 上遇到过类似的问题，午餐时出现安全异常。我找到的解决方案是使用经过批准的证书（不是 Visual Studio 为您的项目生成的默认证书）对清单进行数字签名。

这是 ClickOnce 部署清单上的一个已知“错误”（或设计使然）。

你的项目签了吗？

# sql-server - SQL Server 备份/恢复与分离/附加

> ID：610113
> 
> 赞同：36
> 
> 时间：2009-03-04T11:02:51.657
> 
> 标签：sql-server, backup, restore

我有一个包含最新数据的数据库，我想将数据库内容复制到其他一些服务器中。由于非技术原因，我无法直接使用复制功能或同步功能同步到其他 SQL Server 实例。

现在，我有两个解决方案，我想了解每个解决方案的优缺点。谢谢！

解决方案1：分离包含最新数据的源数据库，然后复制到需要最新数据的目标服务器，并在目标服务器上附加数据库；

方案二：对整个数据库的源服务器进行全量备份，然后将数据复制到目的服务器，在目的服务器端进行全量恢复。

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-04T11:08:25.793

分离/附加选项通常比执行备份更快，因为它不必创建新文件。因此，从服务器 A 到服务器 B 的时间几乎是纯粹的文件复制时间。

备份/恢复选项允许您执行完整备份、恢复该备份，然后执行差异备份，这意味着您可以减少两者之间的停机时间。

如果您要进行数据复制，这是否意味着您希望数据库在两个位置都可以正常工作？在这种情况下，您可能需要备份/恢复选项，因为这将使当前数据库完全正常运行。

编辑：只是为了澄清几点。停机时间是指，如果您将数据库从一台服务器迁移到另一台服务器，通常会在传输过程中阻止人们使用它。因此，从服务器 A 上的“停止”点到服务器 B 上的“开始”点，这可以被认为是停机时间。否则，在传输过程中对服务器 A 上的数据库执行的任何操作都不会复制到服务器 B 上。

关于“创建新文件”。如果分离数据库，您可以立即复制 MDF 文件。它已经准备好被复制了。但是，如果您执行备份，则必须等待创建 .BAK 文件，然后将其移动到新位置以进行还原。同样，这一切都归结为这是快照副本或迁移。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-09-17T14:18:56.940

备份和恢复更有意义，即使您可能会从分离附加选项中多花几分钟时间。在分离之前，您必须使原始数据库脱机（断开所有人的连接），然后数据库在您重新连接之前不可用。您还必须跟踪所有文件，而通过备份将所有文件分组。使用最新版本的 SQL Server，备份会被压缩。

只是为了纠正一些事情：数据库备份和差异备份不会截断日志，也不会破坏日志链。

此外，COPY_ONLY 功能只对差异基础很重要，对 LOG 不重要。假设日志链中没有中断，则可以从任何备份开始按顺序应用所有日志备份。存档点略有不同，但我看不出重要的地方。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T11:10:41.123

解决方案 2 将是我的选择……主要是因为它不会在源数据库上造成任何停机时间。我能看到的唯一缺点是，根据数据库恢复模型，事务日志将被截断，这意味着如果您想从事务日志中恢复任何数据，您将被塞满，您必须使用备份文件。

编辑：找到一个不错的链接；[http://sql-server-performance.com/Community/forums/p/5838/35573.aspx](http://sql-server-performance.com/Community/forums/p/5838/35573.aspx)

# svn - CentOS 安装 mod_dav_svn

> ID：610115
> 
> 赞同：4
> 
> 时间：2009-03-04T11:03:10.970
> 
> 标签：svn, installation, dependencies, centos

我正在尝试在 centos 5 VPS 上安装颠覆。我设法安装了颠覆，但是当我尝试这样做时，`yum install mod_dav_svn`我收到了这个错误：

> 错误：缺少依赖项：包 mod_dav_svn 需要 httpd-mmn = 20051115

经过大量谷歌搜索后，我读到您需要 Apache 2.2（我以前有 2.0），所以我用 Apache 2.2 重新编译了服务器，但我仍然遇到同样的错误。我想提一下，我用 mod_dav 扩展重新编译了它。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-04-22T00:40:09.240

`$ find / -name "yum.conf"`

`$ nano /etc/yum.conf`

从此行中删除 httpd*：

`exclude=apache* bind-chroot courier* dovecot* exim* filesystem httpd* mod_ssl* mydns* mysql* nsd* perl* php* proftpd* pure-ftpd* ruby* spamassassin* squirrelmail*`

保存并关闭 yum.conf，安装 mod_dav_svn

`yum install mod_dav_svn`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T14:58:41.943

httpd-mmn 通常为每个 >= 2.0 的版本附带 apache 包，
问题是 http* 在 yum 排除列表中，这让 yum 认为它没有安装。从排除列表中删除它可以解决问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T11:19:51.133

尽管我没有专门使用 mod_dav_svn RPM - [Summersoft ，但我将这些 subversion 二进制文件用于 CentOS5](http://the.earth.li/pub/subversion/summersoft.fay.ar.us/pub/subversion/latest/rhel-5/i386/)

我还注意到 CentOS 5 提供的 subversion rpms 是通过安装 httpd 提供的。也许您的 yum 配置有问题？

# .net - 反射还是动态方法？

> ID：610116
> 
> 赞同：2
> 
> 时间：2009-03-04T11:03:33.620
> 
> 标签：.net, nhibernate, reflection, dynamicmethod

我在几个项目中使用过 NHibernbate，现在也了解了更多的 ORM。据我了解，NHibernate 在运行时使用映射文件将 Class 动态绑定到 Datalayer。

我的问题是，这种后期绑定是如何完成的？我的意思是，使用哪种方法，“反射”或“动态方法”？

如果它使用反射，是否有任何使用 DynamicMethod 的 ORM？并提供更好的性能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T11:44:31.783

从 NHibernate 2.1 开始，[代理工厂是可插入](http://nhforge.org/blogs/nhibernate/archive/2008/11/09/nh2-1-0-bytecode-providers.aspx)的。以下是一些支持的代理提供程序：

*   Castle.DynamicProxy
*   林福
*   春天.NET

所以代理实际上将不在 NHibernate 的职责范围内，这个问题的答案真的取决于选择的代理工厂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T11:38:30.213

NHibernate 使用 Castle.DynamicProxy，它在底层使用 DynamicMethods。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T12:43:22.400

ORM 实例化实体的确切方式并不是评估其整体性能的好方法。

# version-control - Team Foundation Server 2008 源代码管理中的第 3 方控件文件夹

> ID：610123
> 
> 赞同：1
> 
> 时间：2009-03-04T11:09:01.657
> 
> 标签：version-control, tfs

我正在设置一个新的 TFS 2008 服务器，我们将要迁移到（从 VSS），并且我正在尝试布局源代码控制存储库。

阅读问题后[如何组织版本控制存储库？](https://stackoverflow.com/questions/222827)我正在尝试以类似的方式组织我的文件夹。

我想创建一个名为 3rd Party Tools 或类似工具的顶级文件夹，但从源代码管理资源管理器看来我无法在顶级文件夹创建一个文件夹，例如 $/3rd Party

我真的必须为此创建一个新的团队项目吗？有没有我可以使用的空白模板，而不必从内置的 Agile 或 CMMI 模板中挑选？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T03:41:58.443

我真的不认为这是可能的，但我找不到任何官方文件这么说。仅供参考 - 我们创建了一个名为“CommonUtils”的团队项目，然后在其中存储共享库等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T11:34:29.087

如果您无法在 下创建第二个根`$/`，您可以创建一个通用根“ `{MyCompany projects}`”，您将在其下创建：

*   "{第三方}`",
*   "{Project1}`",
*   “{项目2}`”

此 SO 问题中的更多详细信息：[Team Foundation Server Source Control Structure](https://stackoverflow.com/questions/381020/team-foundation-server-source-control-structure)。

总体思路是将所有相关项目保持在一个参考之下，共享一组通用的第三方库。

# php - DOMXML, PHP4 => PHP5

> ID：610124
> 
> 赞同：2
> 
> 时间：2009-03-04T11:09:09.833
> 
> 标签：php, dom

我有一个在使用 DOMXML 的 PHP4 的服务器上运行的脚本。现在我必须将站点（包括脚本）迁移到运行 PHP5 的新服务器上，看来 DOMXML 不再正常工作了。有没有简单的方法来解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T11:14:03.223

在 PHP5 中，DOMXML 被 DOM 取代：

[http://www.php.net/manual/ref.dom.php](http://www.php.net/manual/ref.dom.php)

对于迁移检查此页面：

[http://alexandre.alapetite.net/doc-alex/domxml-php4-php5/index.en.html](http://alexandre.alapetite.net/doc-alex/domxml-php4-php5/index.en.html)

# performance - IronPython 内存使用情况

> ID：610128
> 
> 赞同：2
> 
> 时间：2009-03-04T11:11:19.483
> 
> 标签：performance, ironpython

我在基于 ac# 的 WebService 中托管 IronPython，以便能够提供自定义扩展脚本。但是，我发现当我通过在循环中重复执行 web 服务进行简单的负载测试时，内存使用量急剧增加。

IronPython-1.1 在它的对象上实现了 IDisposable，这样你就可以在它们完成后处理它们。基于 DLR 的新 IronPython-2 引擎没有这样的概念。

据我了解，每次您在 ScriptEngine 中执行脚本时，都会在 appdomain 中注入一个新程序集并且无法卸载。

有没有办法解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T17:28:45.520

每次运行 IronPython 脚本时，您都可以尝试创建一个新的 AppDomain。尽管无法从内存中卸载程序集，但您可以卸载 AppDomain，这将允许您将注入的程序集从内存中取出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:03:57.887

您需要禁用优化的代码生成：

```
var runtime = Python.CreateRuntime();
var engine = runtime.GetEngine("py");
PythonCompilerOptions pco = (PythonCompilerOptions)engine.GetCompilerOptions();
pco.Module &= ~ModuleOptions.Optimized;

// this shouldn't leak now
while(true) {
   var code = engine.CreateScriptSourceFromString("1.0+2.0").Compile(pco);
   code.Execute();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T04:03:28.460

事实证明，在 aspnet_wp 达到大约 500mb 之后，垃圾收集器就会启动并清理掉这些乱七八糟的东西。然后内存使用量下降到大约 20mb 并在负载测试期间再次稳定地开始增加。所以没有这样的内存“泄漏”。

# c - 使用 strcmp 进行比较

> ID：610131
> 
> 赞同：3
> 
> 时间：2009-03-04T11:12:14.473
> 
> 标签：c, strcmp

使用 gcc C99 编译

我正在尝试使用字符串比较来比较 2 个字符串。但是，我似乎在 strcmp 行上得到了堆栈转储。

**属性将包含这些，所以我正在寻找框架类型。

```
[name] [time] [type] [time]
[name] [callref] [type] [string]
[name] [port] [type] [int16]
[name] [frametype] [type] [int16] 
```

这是正确的比较方法。

非常感谢您的任何建议，

```
void g_start_element(void *data, const char *element, const char **attribute)
{
    for(i = 0; attribute[i]; i++)
    {
    /* Only interested in the frametype */
        if(strcmp(attribute[i], "frametype") == 0)
        {
            /* do some work here */
        }

     }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T11:18:37.657

您需要有一个空字符串才能终止 for 循环：

```
[name] [time] [type] [time]
[name] [callref] [type] [string]
[name] [port] [type] [int16]
[name] [frametype] [type] [int16]
null 
```

如果没有这个，for 循环将不会终止，并且当您调用 strcmp 时，您最终会得到指向垃圾的属性 [i]。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T11:19:28.810

1.  属性数组是如何初始化的？NULL 元素可能已滑入。
2.  此外，数组元素必须以 NULL 结尾。
3.  您可以考虑使用[strncmp()](http://www.cplusplus.com/reference/clibrary/cstring/strncmp.html)作为 strcmp() 的更安全替代方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T11:19:35.597

一路添加日志记录并转储所有属性和索引器值。这将有助于确定出了什么问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T11:19:41.087

您的输入数组 ( `attribute`) 是否以 NULL 结尾？您没有将它列为存在，但代码需要它，否则它只会进入随机内存，这是段错误的一个很好的原因。

插入要比较的索引和/或属性的打印，以查看它在终止方面的行为是否符合您的预期。

不太确定问题的字符串比较部分......如果输入包含那些方括号等，那么您将永远找不到任何东西，因为您正在查看每个字符串的开头。尝试`strstr()`如果是这种情况，它会找到子字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T11:37:56.393

此代码的上下文是 expat 解析 -[请参阅此帖子](https://stackoverflow.com/questions/609376/geting-xml-data-using-xml-parser-expat)。属性数组是交替的名称和值，以单个 0 终止。

除非您正在寻找名称或值等于您的测试字符串的任何属性（这有点不寻常），否则您的代码应该将 i 增加 2 而不是 1 - 这样它就会同时遍历名称和值。

您应该比较属性 [i] 以匹配名称，或比较属性 [i+1] 以匹配值。

不要假设属性将按任何特定顺序排列。目前您只查看属性[1](https://stackoverflow.com/questions/609376/geting-xml-data-using-xml-parser-expat)，它是返回的第一个属性的值。如果有多个属性，它们可以按任意顺序返回。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T11:21:47.773

除了不被空终止，为什么不使用 strncmp() ？:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T11:59:34.580

我会添加一个检查 NULL 所以你有

```
if(attribute[1] != NULL && strcmp("frametype", attribute[1]) == 0) 
```

因此，您没有取消引用 NULL 指针。

# symfony1 - 如何在 Symfony 中为不同的模块设置不同的模板布局

> ID：610133
> 
> 赞同：17
> 
> 时间：2009-03-04T11:14:00.133
> 
> 标签：symfony1

如何在 Symfony 中为不同的模块设置不同的模板布局？

我有一个由登录屏幕和成员部分组成的银行应用程序。因此，当用户访问我的网站时，他会看到一个登录屏幕。登录后，他将被重定向到会员部分，他可以做任何银行业务。

那么，如何为登录界面和会员区的页面设置不同的布局呢？Symfony 似乎`frontend/templates/layout.php`用作所有页面的模板。是否可以定义不同的布局？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-05T10:25:27.607

是的，您可以为每个视图定义单独的布局（或完全禁用布局）。为此，您必须在模块的 /config 目录中创建（或编辑，如果您已经拥有它）view.yml 文件。您可以定义要用于模块的所有视图或单独用于每个视图的布局。例如：

```
#in /apps/my_app/modules/my_module/config/view.yml

#this will apply custom_layout to all views of the module
all:
  layout: custom_layout

#this will apply login_layout to the loginSuccess view
loginSuccess:
  layout: login_layout

#disable layout for this view
homeSuccess:
  has_layout: false 
```

在所有情况下，布局都是应用程序 /templates 目录中的文件（附加 .php）。如果您没有在模块的视图配置文件中定义任何布局指令，则将使用默认布局。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-03-24T11:47:58.123

或者，如果您在内部操作，则可以简单地使用：

```
$this->setLayout('name_file_layout_without_extension'); 
```

在您可以处理您在模块内使用的模板之后。

# php - 服务器时间的差异

> ID：610138
> 
> 赞同：0
> 
> 时间：2009-03-04T11:16:37.037
> 
> 标签：php, api, datetime, sms

我正在开发一个网站，它将检索已发送到网关的 SMS 消息。网关通过 API 访问，请求格式如下：

```
http://www.smsgateway.com/?login=myusername&password=mypassword&lasttime=1236164238 
```

请注意，我必须跟踪上次下载消息的时间 - 只有在该时间之后收到的消息才会返回。

问题是服务器之间有大约5分钟的时间差！这是正在发生的事情：

->用户发送短信；网关服务器在上午 11 点为其添加时间戳（假设实际时间是上午 10 点 55 分）

-> 我的服务器请求从 10.56 开始发送的所有消息 - 接收上述消息并将其添加到数据库

->我的服务器请求从 10.58 开始发送的所有消息 - 接收上述消息并再次添加它，因为它的时间戳是上午 11 点

->我的服务器在 11:00 发送另一个请求 - 接收消息并再次将其添加到数据库中

所以我的问题是一条原始消息被接收了 3 次。

更改我的服务器时间是可行的，但不是远程服务器。

如何在不检查消息是否已在数据库中的情况下处理此问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T11:21:53.437

当您收到从 10.56 开始发送的消息时，请检查最后一条消息时间：假设上午 11:00，然后下一个呼叫仅在上午 11:00 发送，因为您已经收到了服务器时间上午 11:00。这样你可以减少你的投票。当服务器的时间处于相反状态时，即使这也适用。

即）检查最后一条消息的时间：

在下一次轮询中检查上一条消息的时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T11:34:17.293

您的基本设置是活泼的，即使您使两个服务器的时钟保持同步，您也会丢失或加倍共享时间戳的消息（取决于时间戳分辨率和消息流量，这些消息可能很多也可能很少）。

您将需要不同的 API 来访问消息，或者您必须通过请求消息来请求重叠消息，`latest_processed_timestamp - 1`并整理出您身边的重复消息。

# ms-word - 带图像的 Word 文档 文件大小

> ID：610151
> 
> 赞同：-2
> 
> 时间：2009-03-04T11:20:41.130
> 
> 标签：ms-word, ms-office, office-2007

我实际上是将屏幕截图放入 MS Word 文档中。当我保存文档时，不确定正在考虑哪种格式的图像。文档的大小变得非常大。MS word中是否有任何选项可以将文档保存为较小的文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T11:26:08.327

虽然这不是与编程相关的问题，但我会尝试回答*我认为*是您的问题。

保存在 Word 中的所有图像都以其原始分辨率和原始大小存储，无论在 Word 本身中执行的任何大小调整/裁剪如何。如果要减小文件大小，请在将图像插入 Word 文档之前从外部裁剪/压缩图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T11:41:26.837

查看 Word Tips 网站，例如

[http://www.klariti.com/microsoft-word/Reduce-Microsoft-Word-File-Size3.shtml](http://www.klariti.com/microsoft-word/Reduce-Microsoft-Word-File-Size3.shtml)

并应用解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T11:33:53.377

我用来减小大小的一种快速技术是通过“开始”菜单>“运行”打开 MSPaint ...并在其中复制屏幕截图。然后您可以将文件另存为 JPG，并通过访问“插入”>“图片”>“来自文件”将 JPG 插入到 Word 文档中。

# .net - 如何从部分受信任的 .NET 应用程序中刷新任务栏？

> ID：610164
> 
> 赞同：1
> 
> 时间：2009-03-04T11:27:27.247
> 
> 标签：.net, pinvoke, code-access-security, partial-trust, flashwindowex

我想刷新任务栏（[例如这里描述的](https://stackoverflow.com/questions/73162/how-to-make-the-taskbar-blink-my-application-like-messenger-does-when-a-new-messa)），但我不能在我的应用程序运行的安全上下文中[P/Invoke](http://en.wikipedia.org/wiki/Platform_Invocation_Services) [FlashWindowEx](http://msdn.microsoft.com/en-us/library/ms679347%28VS.85,printer%29.aspx)（或其他任何东西）。

还有其他方法可以让任务栏闪烁吗？如果没有，我有哪些选择来吸引用户的注意力？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-23T15:19:31.107

恐怕没有其他方法可以使窗口从部分受信任的代码中闪烁。您也不能将表格提升到前面，因为没有办法像这样窃取焦点。您也不能使用 NotifyIcon，甚至是来自部分信任的 MessageBox，所以您似乎不走运。

这是[您在 WinForms 中不能做的事情的列表](http://msdn.microsoft.com/en-us/library/6a02zsfd(VS.80).aspx)。

看起来你唯一的选择是找到一种方法来提升你的代码的权限（也许让它签名并要求用户信任你的证书）。除此之外，只需等到用户点击您的应用！

# linux - Bourne Shell 中的刷新输出

> ID：610165
> 
> 赞同：2
> 
> 时间：2009-03-04T11:27:28.820
> 
> 标签：linux, shell, upstart

我在 Upstart 脚本中使用 echo 来记录事情：

```
script
    echo "main: some data" >> log
end script

post-start script
    echo "post-start: another data" >> log
end script 
```

现在这两个并行运行，所以在日志中我经常看到：

```
main: post-start: some data another data 
```

这不是关键，所以我不会采用适当的同步，但我想我会打开自动刷新以至少减少这种影响。有没有简单的方法可以做到这一点？

更新：是的，冲洗不能正确修复它，但我已经看到它在一定程度上有助于这种情况，这就是我在这种情况下所需要的。只是不知道在Shell中怎么做

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-31T01:50:35.887

我通常使用尾随`|grep -F --line-buffered ''`作为一种廉价且可靠的方式来强制行缓冲。还有`sponge`来自*moreutils*的延迟所有输出，直到输入完成并关闭。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:54:59.887

尝试改变：

```
回显“文本”

```

至：

```
猫 << EOF
文本
EOF

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T11:32:05.503

为什么你认为冲洗会有所帮助？echo 完成的写入包含换行符，因此如果第一个脚本在第二个脚本之前运行完成，则换行符已经在那里。

在输出中它不是，这表明第二个脚本在第一个脚本完成之前运行，因此交错了它们的输出。

冲洗对此无济于事，这是一个“适当的”并行竞争条件。

# c# - 在调用 CreateChildControls 之前在控件上设置属性

> ID：610169
> 
> 赞同：1
> 
> 时间：2009-03-04T11:30:19.033
> 
> 标签：c#, .net, asp.net

我试图在调用控件的 CreateChildControls 方法之前在自定义 Web 控件上设置一个属性。原因是，在那里执行了很多逻辑，这取决于相关属性的值。我可以直接使用 HTML 中的显式值设置属性，并且它会及时获取，但这对我没有用，因为它需要基于服务器端变量。

棘手的一点是，EnsureChildControls 方法是从控件的“CONTENTS”属性的 getter 调用的，该属性对应于 ASPX 文件中的标签。例如;

```
<myControl>
<content>
...
</content>
</myControl> 
```

据我所知，这反过来会触发重写的 CreateChildControls 方法，并且在没有我尝试设置的属性的正确值的情况下执行逻辑。

我想要解决的是，在我的页面的 ASP.NET 生命周期中，我可以在哪里设置我的属性，以便在 .NET 访问我的控件的“CONTENT”属性的 getter 之前设置它？

我已经在父页面上尝试过 OnPreInit，但是在控件上的 CreateChildControls 之后仍然被击中。我也不想改变控件本身，因为它是一个通用控件，我不想针对这种特殊情况对其进行特殊处理。

任何人都有任何想法可以设置我的属性值，以便按照我想要实现的顺序获取它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T14:16:28.690

根据我的测试，如果不修改这种情况下的 Web 控件是不可能的。解析 Web 表单时，在 html 中定义的所有控件都是在 TemplateControl.FrameworkInitialize 方法期间创建的，这包括调用任何内部属性的 get 访问器。不幸的是，FrameworkInitialize 在 ProcessRequest 期间被调用，它在 ProcessRequestMain 之前，它控制页面生命周期的其余部分。

您可以覆盖 FrameworkInitialize，但只能在 Web 控件创建之前或设置属性为时已晚之后才能访问它。

在尝试破译页面生命周期时，我一直发现[这张图片非常有用。](http://codebetter.com/blogs/raymond.lewallen/archive/2005/03/10/59583.aspx "Asp.Net 页面生命周期")

# iphone - 标签栏上的 iPhone 未读计数

> ID：610172
> 
> 赞同：6
> 
> 时间：2009-03-04T11:32:15.627
> 
> 标签：iphone, cocoa-touch, email, sms, tabbar

在 Cocoa Touch 上实现 TabBar 图标上的未读计数的最佳方法是什么？

我想模仿 SMS 或 Mail 应用程序的行为，向我的应用程序的用户显示未读消息计数，并带有一个包含数字的红点。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-04T11:48:03.513

您要查找的属性称为徽章。您可以通过执行以下操作来设置它：

```
self.tabBarItem.badgeValue = @"1"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:39:36.600

你看过：setApplicationBadgeNumber？

```
[[UIApplication sharedApplication] setApplicationBadgeNumber:int]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-28T13:49:46.483

对于当前视图，我使用：

```
self.navigationController.tabBarItem.badgeValue = @"5"; 
```

# c# - 在运行时向 Gridview 动态添加行

> ID：610175
> 
> 赞同：2
> 
> 时间：2009-03-04T11:33:16.437
> 
> 标签：c#, asp.net, datagrid

是否可以在运行时向 gridview 添加一行？我需要添加一个默认行（有时），然后根据绑定行中的值在绑定行之后添加一个临时行。

```
gridView.DataSource = source;
/// Create a new Default Row here
gridview.DataBind(); 
```

和

```
OnDataBound(object sender, DataGridEventArgs e)
//evaluate each row and if certain criteria add a new row. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T12:14:45.917

[这](http://blog.falafel.com/2007/04/12/DynamicallyAddRowsToAGridView.aspx)可能会解决您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T12:20:59.863

在数据绑定之前确定是否需要添加其他行会更容易。

# c# - 打印 WebBrowser 控件内容

> ID：610183
> 
> 赞同：4
> 
> 时间：2009-03-04T11:35:48.740
> 
> 标签：c#, .net, printing

我对在 .NET 中打印完全陌生。我想打印一个显示在 WebBrowser 控件中的页面。我怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T11:39:39.417

MSDN 有一篇关于此的文章，但是他们的代码示例演示了如何使用 WebBrowser 控件打印网页而不显示它。：

[如何：使用 WebBrowser 控件进行打印](http://msdn.microsoft.com/en-us/library/b0wes9a3.aspx)

C#代码：

```
private void PrintHelpPage()
{
    // Create a WebBrowser instance. 
    WebBrowser webBrowserForPrinting = new WebBrowser();

    // Add an event handler that prints the document after it loads.
    webBrowserForPrinting.DocumentCompleted +=
        new WebBrowserDocumentCompletedEventHandler(PrintDocument);

    // Set the Url property to load the document.
    webBrowserForPrinting.Url = new Uri(@"\\myshare\help.html");
}

private void PrintDocument(object sender,
    WebBrowserDocumentCompletedEventArgs e)
{
    // Print the document now that it is fully loaded.
    ((WebBrowser)sender).Print();

    // Dispose the WebBrowser now that the task is complete. 
    ((WebBrowser)sender).Dispose();
} 
```

# windows-mobile - Windows mobile 或 CE 设备上的 GDI 性能

> ID：610185
> 
> 赞同：2
> 
> 时间：2009-03-04T11:36:13.857
> 
> 标签：windows-mobile, profiling, windows-ce, gdi

我有一个使用大量矢量图形的 Windows CE 应用程序，而且在某些地方速度很慢。我目前正在使用 GDI 通过位图进行渲染以实现无闪烁刷新。通常，我在大型 3d 地图的一部分上进行窗口化。在某些设备上（例如 166mhz SH4），对于大型数据集，刷新时间为 3-5 秒，这会变慢。我的问题是这个；

*   有没有人比较过 Windows mobile 与 Win32 上图形操作的相对速度。换句话说，假设我们只查看 GDI 调用，则来自适用于 WinCE 版本的软件的 Win32 版本的分析结果。

*   有没有人尝试过在 WinCE 平台（C++ 应用程序）上进行板载分析，如果是，使用什么工具。

*   有谁知道在 Windows CE 上提高绘图速度的任何方法。我目前正在根据[上一个问题](https://stackoverflow.com/questions/203847/fast-library-to-replace-cdc-vector-graphics)的反馈查看 FastGraph ，但这是一个稍微长期的解决方案。糟糕的是，尽管如此，我正在为即将发布的版本寻找更快的实现方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-08-14T10:43:04.093

在 Windows CE 6.0 之前 - 因此包括所有 Windows Mobile/Windows Embedded Handheld 版本 - 图形代码是在另一个进程 (GWES.EXE) 中实现的，每次进行 GDI 调用时都需要跨进程调用。CE 5.x 的跨进程调用比在桌面上便宜得多，但仍然比普通函数调用或内核模式调用更昂贵。

在桌面上，GDI 从 NT 4.0 开始以内核模式实现。在最初的 NT 3.1 中，它就像 CE 模型，跨进程调用。为了减轻跨进程调用或用户/内核模式切换的开销，桌面 GDI 会在用户模式端对操作进行批处理，直到您执行需要它来刷新队列的操作——比如选择不同的笔或画笔，或者使用一个的遗留函数返回的东西不是`BOOL`- 或者缓冲区已满，或者您通过调用显式刷新它`GdiFlush`。

Windows CE 没有这种批处理功能——所有调用都会导致直接调用 GWES 进程，从而使其速度变慢。您可以通过在每次通话中做尽可能多的工作来缓解它。如果您需要复杂的线，请考虑折线而不是单独的 MoveToEx/LineTo 调用。尝试只触摸每个像素一次而不是渲染重叠的对象，并利用无效区域仅绘制需要重新绘制的屏幕部分（使用`GetUpdateRgn`或`GetUpdateRect`但在调用之前执行它`BeginPaint`，这标志着该区域有效）。

CE 图形加速模型是相当基本的，基于位块。它不支持 Windows 2000 型桌面设备驱动程序支持的更多功能。是否有任何加速功能取决于硬件是否甚至有加速芯片——许多设备会使用嵌入在应用处理器中的 LCD 控制器，它通常不做任何加速。

您可以通过禁用批处理来模拟 CE 在桌面上的行为，使用`GdiSetBatchLimit`将限制设置为 1。还可以考虑使用 SVGA 图形驱动程序禁用加速。在 Windows Vista 或 Windows 7 上，如果您使用 Aero 环境，则不会加速 GDI，所有操作都在软件中实现，尽管 Windows 7 添加了一些新的 bit-blit 硬件加速功能。

Windows CE 6.0 有一个新的内核和进程模型，它将 GDI 移动到与桌面 Windows（Vista 之前）一样的内核模式，因此调用 GDI 函数的成本应该会略微降低。仍然没有批处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T05:57:05.413

我对图形方面的知识并不多，但从经验来看，如果你想在某些特定的硬件相关的事情上做得更快，那么你越接近“金属”，你就能越快（而且越难！ ）。所以你可以考虑使用[Direct Draw](http://msdn.microsoft.com/en-us/library/aa917136.aspx)或[Direct 3D](http://msdn.microsoft.com/en-us/library/aa921056.aspx)（尽管我认为他们正在放弃 D3D 并转向 WM7 的 OpenGL ES）。您可能想了解游戏开发人员的使用方式。

关于 Profiles 的问题，我没有找到任何东西，但我确实建立了[自己的](https://stackoverflow.com/questions/256291/code-profiling-performance-analysis-tools-for-windows-ce-mobile).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T12:22:11.887

我已经做了很多此类基准测试，WinCE 上的 GDI 操作比常规 Win32 慢，但仅与 WinCE 设备上较慢的处理器成比例。换句话说，在 WinCE 中使用 GDI 似乎没有任何额外的性能影响。

抱歉，我没有你最后两个问题的答案。

# javascript - 检测div的位置

> ID：610188
> 
> 赞同：3
> 
> 时间：2009-03-04T11:36:48.690
> 
> 标签：javascript, html

我创建了一个小游戏，其中一些块围绕主 div 移动。也持有 div 的鼠标（我已将光标的位置分配给该 div）。

我只想追踪光标 div 是否在块上移动（那些也是 div）。如果是这样，那么游戏就结束了。

如何检测块或光标 div 是否相互移动？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T11:53:11.723

如果您使用 jQuery，您可以使用以下方法找到 div 的左侧、顶部、宽度和高度：

```
$(myDiv).offset().left
$(myDiv).offset().top
myDiv.offsetWidth
myDiv.offsetHeight 
```

使用这些来计算每个 div 的左、右、上和下。如果满足以下条件，则两个 div 会相互重叠：

```
left1 < right2 && left2 < right1 && top1 < bottom2 && top2 < bottom1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T11:52:23.113

这不是使用纯 javascript 的简单任务，因为您必须跟踪 div 的祖先并对相对位置求和，直到找到绝对定位的 div。

另一方面，对于 jQuery 或 Prototype 等 javascript 库，此任务非常简单。例如，在 jQuery 中，[`$(myDiv).offset()`](http://docs.jquery.com/CSS)返回 div 相对于文档的位置。

如果您还包括[jQuery UI](http://docs.jquery.com/UI/)，并使您的主 div 成为“可拖动的”，而所有其他 div 为“可放置的”，那么您所需要的只是连接[Droppable 的 over 事件](http://docs.jquery.com/UI/API/1.7/Droppable#events)，以便在主 div 被拖动到另一个时得到通知。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T11:53:43.767

您正在谈论的概念称为[碰撞检测](http://en.wikipedia.org/wiki/Collision_detection)。

很简单，您需要获取 div 的边界，然后遍历所有块以查看它们是否重叠。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T11:57:57.157

getBoundingClientRect()

John Resig 在这里有一篇很棒的文章：[getBoundingClientRect is Awesome](http://ejohn.org/blog/getboundingclientrect-is-awesome/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T13:25:23.873

如果你不想使用 jQuery，你可以从这里复制/粘贴（LGPL 代码）；[http://code.google.com/p/ra-ajax/source/browse/trunk/Ra/Js/Ra.js](http://code.google.com/p/ra-ajax/source/browse/trunk/Ra/Js/Ra.js)

寻找的地方是第 1 行的“绝对化”功能。220，它在while循环中递归地计算“祖先节点”的大小。

贴在这里供参考；

```
var valueT = this.offsetTop  || 0;
var valueL = this.offsetLeft  || 0;
var el = this.offsetParent;

while (el) {
  Ra.extend(el, Ra.Element.prototype);
  if( el.tagName == 'BODY' ) {
    break;
  }
  var pos = el.getStyle('position');
  if( pos == 'relative' || pos == 'absolute') {
    break;
  }
  valueT += el.offsetTop  || 0;
  valueL += el.offsetLeft || 0;
  el = el.offsetParent;
} 
```

这里的“this”是一个 DOM 元素...

但是我怀疑你所拥有的是绝对定位的 div 在另一个具有 position:relative 的 div 中，在这种情况下你可以使用；

```
var y = parseInt(myElement.style.top, 10);
var x = parseInt(myElement.style.left, 10); 
```

这将比执行“偏移循环”快几个数量级......

# iphone - 在 iPhone 上计算像素大小

> ID：610193
> 
> 赞同：11
> 
> 时间：2009-03-04T11:38:04.413
> 
> 标签：iphone, graphics, screen

iPhone SDK 中有没有办法计算单个像素的大小（以毫米为单位）？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-07-16T16:53:17.713

**回答有关像素大小的问题：**

**iPhone 和 iPod Touch 上的像素大小**

1.  **较早的 iPhone**（iPhone 4 之前）Apple iPhone 技术规格说：480 x 320 像素分辨率，**每英寸 163 像素**(ppi)。大约每像素 0.006135 英寸或每像素 0.1558282 毫米。

2.  前三代 iPod touch 声明相同的 163 ppi。

3.  **iPhone 4** 规格称分辨率为 960 x 640 像素，分辨率为326 **ppi**。所以像素宽度是 1 英寸/每英寸 326 像素或大约每像素 0.003067 英寸或每像素 0.0779 毫米。您使用点，而不是像素。编辑：正如奥拉夫评论中所述，像素实际上是可寻址的，使用半点。

4.  第四代**iPod touch**（2010 年 9 月）的 [规格](http://www.apple.com/ipodtouch/specs.html "Apple - iPod Touch - 技术规格")与 iPhone 4 相同，分辨率为 960 x 640 像素，**326 ppi**

5.  **iPhone 4S** （2011年10 月）在分辨率方面与 iPhone 4 相同。

6.  **iPhone 5** （2012年9 月）规格显示 1136 x 640 像素分辨率，**326 ppi**。像素大小不变。屏幕对角线为 4 英寸。

7.  **iPhone 5C**和**iPhone 5S** （2013年9 月）具有与 iPhone 5 相同的分辨率、像素大小和对角线。

8.  **iPhone 6** 4.7 英寸（2014 年 9 月） 规格[为](http://www.apple.com/iphone-6/specs/ "Apple - iPhone - 技术规格")1334 x 750 像素分辨率，**每英寸 326 像素 (ppi)**。像素大小从 4、4S、5 5s 不变。

9.  **iPhone 6 Plus** 5.5 英寸（2014 年 9 月） 规格[为](http://www.apple.com/iphone-6/specs/ "Apple - iPhone - 技术规格")1920 x 1080 像素分辨率，**每英寸 401 像素 (ppi)**。像素大小约小 20%。像素宽度为 1 英寸/每英寸 401 像素或大约每像素 0.002494 英寸或每像素 0.06334 毫米。

**iPad 上的像素大小**

1.  **iPad 1**和**2**是 9.7 英寸（对角线）显示屏，按照 iPad 规格，分辨率为 1024 x 768 像素，分辨率为132 ppi **。**这大约是每像素 0.0075758 英寸或每像素 0.1924 毫米。
2.  新款**iPad**（2012 年 3 月）是一款 9.7 英寸（对角线）显示屏，分辨率为 2048 x 1536 像素，分辨率为**264 ppi** ，符合当前[iPad 规格](http://www.apple.com/ipad/specs/ "Apple - iPad 规格")。这大约是每像素 0.0037879 英寸或每像素 0.09621 毫米。

4.  **iPad Mini** （第1 代 - 2012 年 10 月）是一款 7.9 英寸（对角线）显示屏，分辨率为 1024 x 768 像素，分辨率为**163 ppi**，符合原始 iPad mini 规格。这大约是每像素 0.006135 英寸或每像素 0.156 毫米。

6.  **iPad Mini 2** （ 第2 代 - 2013 年 10 月）是一款 7.9 英寸（对角线）显示屏，分辨率为 2048 x 1536 像素，分辨率为**326 ppi**，符合当前[iPad mini 规格](http://www.apple.com/ipad-mini/specs/ "Apple - iPad mini 规格")。这大约是每像素 0.0030675 英寸或每像素 0.0779 毫米。

8.  **iPad Air 2** （2014 年10 月）和**iPad Mini 3**（2014 年 10 月）与这些产品的先前版本具有相同的分辨率、像素大小和对角线。

    [iPad Air 与 iPad Air 2、iPad Mini、iPad 2 和 iPad3 的比较。](http://www.apple.com/ipad/compare/ "Apple 比较新 iPad 和 iPad 2 的规格")

您不需要让 iPhone SDK 计算单个像素的大小。一种选择是[确定您正在运行什么](https://stackoverflow.com/questions/3028434/how-can-i-determine-programmatically-that-my-app-is-running-on-an-iphone-ipad-or)，然后选择所需的毫米尺寸。

带有 3.5 英寸（对角线）显示屏的 iPhone（直到并包括 4S）/iPod Touch 屏幕尺寸并不完全是 2" x 3"。它们比那小一点。iPhone 5 有一个 4 英寸（对角线）显示屏。

**提问者可能真正需要的是：分数。** 请参阅上一个答案的卸妆评论。坐标以点而不是像素为单位指定。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-04T11:44:03.993

好吧，像素的大小是一个常数。当前 iPhone 或 iPod touch 的屏幕尺寸为 2" x 3" (50.8 mm x 76.2 mm)，分辨率为 320 x 480 像素。

50.8 / 320（或 76.2 / 480）=> **1 个像素的大小为 0.15875 mm x 0.15875 mm**

# linq-to-entities - 跨多个数据库的 ADO.Net 实体框架

> ID：610197
> 
> 赞同：6
> 
> 时间：2009-03-04T11:39:23.333
> 
> 标签：linq-to-entities

[在 Linq2Sql 中，您只需将数据库名称添加到源即可将数据上下文连接到多个数据库](https://stackoverflow.com/questions/352949/linq-across-multiple-databases)。

有没有办法在 Linq 2 Entities / ADO.net Entity Framework 中实现这一点？可以将某处的数据库名称添加到表名中吗？

我试图将“架构”从 dbo 更改为*MyDatabase.dbo*，但 EF 将其封装到

```
SELECT FROM [MyDatabase.dbo].[MyTable] 
```

将 'Schema' 更改为*'MyDatabase].[dbo'*之类的诡计将被转义为

```
SELECT FROM [MyDatabase]].[dbo].[MyTable] 
```

（注意这两个`]]`。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T13:10:15.440

首先，[这不是官方支持](http://social.msdn.microsoft.com/Forums/en-US/adodotnetentityframework/thread/cad06147-2168-4c20-ac23-98f32987b126/)的。

您链接到 LINQ to SQL 的答案只是使用数据库服务器执行异构查询的能力。我不明白为什么这对实体框架不起作用，因为它是数据库服务器功能，而不是任何一个框架的功能。换句话说，LINQ to SQL 仍在处理连接，就好像只涉及一个数据库服务器一样。但是请记住，并非所有数据库服务器都可以做到这一点。

至于要在 EDMX 中更改什么，请在“SSDL 内容”部分中查找 EntitySet 节点的 Schema 属性。

关于此技术的一个警告是，当您从数据库更新模型时，存储模型将被清除并从头开始替换。因此，您需要重新应用这些更改。这在 LINQ to SQL 中不是问题，因为 LINQ to SQL 根本不支持来自数据库的自动更新。

更好的选择可能是在引用另一个数据库的数据库中创建一个 VIEW 并映射该视图，而不是直接映射表和另一个数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-23T18:36:41.210

如果您的数据库支持 SQL 同义词，您可以将两个数据库定义合并到一个文件中。我最近这样做了，如果你有兴趣，我会[在这里发布我是如何做到的。](http://rachel53461.wordpress.com/2011/05/22/tricking-ef-to-span-multiple-databases/)

基本上，您在指向 databaseB 的 databaseA 上创建同义词，为每个数据库创建一个单独的 edmx 文件，然后运行脚本将 edmx 文件合并到一个文件中，该文件连接到具有同义词设置的任何数据库。

# python - 雅虎管道、simplejson 和斜杠

> ID：610205
> 
> 赞同：0
> 
> 时间：2009-03-04T11:42:25.900
> 
> 标签：python, yahoo-pipes, simplejson

我试图使用[http://www.javarants.com/2008/04/13/using-google-app-engine-to-extend-yahoo-pipes/](http://www.javarants.com/2008/04/13/using-google-app-engine-to-extend-yahoo-pipes/)作为灵感，但我在输出时遇到了一些麻烦。

在使用控制台和 App Engine“django util simplejson”进行测试时，这一点很明显：

```
/cygdrive/c/Program Files/Google/google_appengine/lib/django
$ python
Python 2.5.2 (r252:60911, Dec  2 2008, 09:26:14) 
[GCC 3.4.4 (cygming special, gdc 0.12, using dmd 0.125)] on cygwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from django.utils import simplejson as json
>>> json.dumps('/')
'"\\/"'
>>> json.dumps('http://stackoverflow.com')
'"http:\\/\\/stackoverflow.com" 
```

[据我所知，](http://microformats.org/wiki/json)这是可以的行为：

> 在 JSON 中，只有反斜杠、双引号和 ASCII 控制字符需要转义。正斜杠可以像下面的 URL 示例那样被转义，但不是必须的。

但是当输入回 yahoopipes 时，它们不会“取消转义”输出，并且我所有的 url 和 html 都不起作用。

我真的应该做一个

```
self.response.out.write(json.dumps(obj).replace('\\/','/')) 
```

?

==== 编辑 ===

令我大吃一惊的是，我看到从 simplejson 网站下载的最新 simplejson 并没有做“斜线”的东西 :( 所以真正的问题是应用引擎 django.util.simplejson 版本？

=== 再次编辑 ===

现在我在跟踪器中为它创建了一个问题：[http ://code.google.com/p/googleappengine/issues/detail?id=1128](http://code.google.com/p/googleappengine/issues/detail?id=1128)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-24T14:53:50.653

这里没什么可看的。票在那里，但就我所见，仅此而已

# git - 如何从 Git 中的特定修订中检索单个文件？

> ID：610208
> 
> 赞同：952
> 
> 时间：2009-03-04T11:43:13.107
> 
> 标签：git, single-file

我有一个 Git 存储库，我想看看几个月前一些文件的样子。我在那个日期找到了修订版；它是`27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8`。我需要查看一个文件的外观，并将其另存为（“新”）文件。

我设法使用 来查看该文件`gitk`，但它没有保存它的选项。我尝试使用命令行工具，我得到的最接近的是：

```
git-show 27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8 my_file.txt 
```

但是，此命令显示差异，而不是文件内容。我知道我以后可以使用类似的东西`PAGER=cat`并将输出重定向到文件，但我不知道如何获取实际的文件内容。

基本上，我正在寻找类似**svn cat**的东西。

* * *

## 回答 #1

> 赞同：877
> 
> 时间：2009-03-04T12:22:46.363

## 使用`git show`

要完成您自己的答案，语法确实是

```
git show object
git show $REV:$FILE
git show somebranch:from/the/root/myfile.txt
git show HEAD^^^:test/test.py 
```

该命令采用通常的修订风格，这意味着您可以使用以下任何一种：

1.  分支名称（由[ash](https://stackoverflow.com/users/17708/ash)[建议](https://stackoverflow.com/review/suggested-edits/3041393)）
2.  `HEAD`+ x`^`字符数
3.  给定修订版的 SHA1 哈希
4.  给定 SHA1 哈希的前几个（可能是 5 个）字符

**提示**请务必记住，在使用“ `git show`”时，**始终指定从存储库根目录开始的路径**，而不是当前目录位置。

（尽管[Mike Morearty](https://stackoverflow.com/users/179675/mike-morearty)提到，至少在 git 1.7.5.4 中，您可以通过将“ `./`”放在路径的开头来指定相对路径。例如：

```
git show HEAD^^:./test.py 
```

)

## 使用`git restore`

使用 Git 2.23+（2019 年 8 月），您还可以使用**[`git restore`](https://git-scm.com/docs/git-restore)** which 替换[令人困惑的`git checkout`命令](https://stackoverflow.com/a/57066202/6309)

```
git restore -s <SHA1>     -- afile
git restore -s somebranch -- afile 
```

这将仅在工作树上恢复**“源”（`-s`）**提交 SHA1 或分支中存在的文件`somebranch`。
要恢复索引：

```
git restore -s <SHA1> -SW -- afile 
```

( `-SW`: 缩写`--staged --worktree`)

* * *

正如[starwarswii](https://stackoverflow.com/users/3249197/starwarswii)[的评论](https://stackoverflow.com/questions/610208/how-to-retrieve-a-single-file-from-a-specific-revision-in-git/610315#comment120557219_610315)中所指出的那样

> 它允许您将内容通过管道传输到文件中，如果您只想快速比较提交中的文件，这非常有用。
> 
> 例如，您可以这样做：
> 
> ```
> git show 1234:path/to/file.txt > new.txt 
> git show 1234~:path/to/file.txt > old.txt 
> ```
> 
> 然后比较它们。

* * *

## 使用低级 git 管道命令

在 git1.5.x 之前，这是通过一些管道完成的：

`git ls-tree <rev>`
在提交中显示一个或多个“blob”对象的列表

`git cat-file blob <file-SHA1>`
cat 文件，因为它已在特定修订版中提交（类似于 svn cat）。用于`git ls-tree`检索给定文件 sha1 的值

```
git cat-file -p $(git-ls-tree $REV $file | cut -d " " -f 3 | cut -f 1):: 
```

`git-ls-tree`列出了`$file`在修订中的对象 ID `$REV`，这被从输出中删除并用作 的参数`git-cat-file`，它应该真正被调用`git-cat-object`，并且只是将该对象转储到`stdout`.

* * *

注意：从 Git 2.11（2016 年第四季度）开始，您可以将内容过滤器应用于`git cat-file`输出。

请参阅 [Johannes Schindelin (](https://github.com/dscho) [)的提交](https://github.com/dscho)[3214594](https://github.com/git/git/commit/321459439e19517c412cab1cfbb64a2749f272c9)、 提交[7bcf341](https://github.com/git/git/commit/7bcf341453572a227036afec76bdab451b798870) （ 2016 年 9 月 9 日）、 [提交 7bcf341](https://github.com/git/git/commit/7bcf341453572a227036afec76bdab451b798870)（2016 年 9 月 9 日）和 [提交 b9e62f6](https://github.com/git/git/commit/b9e62f60115c75c5be5de593862925c8b8d7e683)、 [提交 16dcc29](https://github.com/git/git/commit/16dcc2992b80d30f99c41fd7cc858e9d1c9dbca3)（2016 年 8 月 24 日） 。^(（由)^([Junio C Hamano 合并](https://github.com/gitster))^([——](https://github.com/gitster))^在^([提交 7889ed2](https://github.com/git/git/commit/7889ed25ac709624446b0b4d887dd3633e81f44a))^(中，2016 年 9 月 21 日）)[`dscho`](https://github.com/dscho)
^([`gitster`](https://github.com/gitster))

```
git config diff.txt.textconv "tr A-Za-z N-ZA-Mn-za-m <"
git cat-file --textconv --batch 
```

注意：“ `git cat-file --textconv`”最近（2017 年）开始出现段错误，已在 Git 2.15（2017 年第四季度）中更正

请参阅[Jeff King (](https://github.com/peff) [)](https://github.com/peff)[提交的 cc0ea7c](https://github.com/git/git/commit/cc0ea7c9e5c3d3bf9623415737b595c9d26b9b6d) (2017 年 9 月 21 日) 。^(（由)^([Junio C Hamano 合并](https://github.com/gitster))^([——](https://github.com/gitster))^在^([提交 bfbc2fc](https://github.com/git/git/commit/bfbc2fccfdff0fe189337de67e16fc132b8ee2a5))^(中，2017 年 9 月 28 日）)[`peff`](https://github.com/peff)
^([`gitster`](https://github.com/gitster))

* * *

## 回答 #2

> 赞同：536
> 
> 时间：2010-11-18T19:41:15.470

如果您希望使用先前提交或不同分支中的文件内容**替换/覆盖**当前分支中的文件内容，可以使用以下命令执行此操作：

```
git checkout 08618129e66127921fbfcbc205a06153c92622fe path/to/file.txt 
```

或者

```
git checkout mybranchname path/to/file.txt 
```

然后，您必须提交这些更改才能使它们在当前分支中生效。

* * *

## 回答 #3

> 赞同：159
> 
> 时间：2009-03-04T11:46:35.593

您需要提供文件的完整路径：

```
git show 27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8:full/repo/path/to/my_file.txt 
```

* * *

## 回答 #4

> 赞同：125
> 
> 时间：2015-07-07T13:55:10.950

最**简单**的方法是写：

```
git show HASH:file/path/name.ext > some_new_name.ext 
```

在哪里：

*   **HASH**是 Git 修订版 SHA-1 哈希数
*   **file/path/name.ext**是您要查找的文件的名称
*   **some_new_name.ext**是保存旧文件的路径和名称

### 例子

```
git show 27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8:my_file.txt > my_file.txt.OLD 
```

这会将修订版**27cf8e中的****my_file.txt**保存为名为**my_file.txt.OLD的新文件**

 ****它使用 Git 2.4.5 进行了测试。

如果要**检索已删除**的文件，可以使用`HASH~1`（在指定 HASH 之前提交一次）。

例子：

```
git show 27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8~1:deleted_file.txt > deleted_file.txt 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-03-02T16:17:24.793

在 Windows 中，使用 Git Bash：

*   在您的工作区中，将 dir 更改为文件所在的文件夹
*   `git show cab485c83b53d56846eb883babaaf4dff2f2cc46:./your_file.ext > old.ext`

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2019-09-28T19:42:48.537

```
git checkout {SHA1} -- filename 
```

此命令从特定提交中获取复制的文件。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-01-01T16:56:44.750

并将其很好地转储到文件中（至少在 Windows 上）-Git Bash：

```
$ echo "`git show 60d8bdfc:src/services/LocationMonitor.java`" >> LM_60d8bdfc.java 
```

引号是必需的`"`，因此它保留换行符。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2020-09-13T23:58:58.313

除了其他答案列出的所有选项之外，您还可以使用感兴趣`git reset`的 Git 对象（哈希、分支、`HEAD~x`...、标签等）和文件路径：

```
git reset <hash> /path/to/file 
```

在您的示例中：

```
git reset 27cf8e8 my_file.txt 
```

这样做是它将在索引`my_file.txt`中的提交时恢复到其版本，`27cf8e8`同时在工作目录中保持不变（因此在其当前版本中）。

从那里开始，事情很容易：

*   您可以将文件的两个版本与`git diff --cached my_file.txt`
*   如果您决定不喜欢旧版本的文件`git restore --staged file.txt`（或在 Git v2.23 之前），您可以删除旧版本的文件`git reset file.txt`
*   `git commit -m "Restore version of file.txt from 27cf8e8"`您可以使用and恢复旧版本`git restore file.txt`（或者，在 Git v2.23 之前，`git checkout -- file.txt`）
*   `git add -p file.txt`您可以通过运行（然后`git commit`和）将更新从旧版本添加到新版本`git restore file.txt`。

最后，如果您运行，您甚至可以在第一步中以交互方式选择要重置的块：

```
git reset -p 27cf8e8 my_file.txt 
```

因此`git reset`，使用路径为您提供了很大的灵活性来检索文件的特定版本以与其当前签出的版本进行比较，如果您选择这样做，则可以完全或仅将某些大块恢复到该版本。

* * *

**编辑：**我刚刚意识到我没有回答您的问题，因为您想要的不是差异或检索部分或全部旧版本的简单方法，而只是检索`cat`该版本。

当然，您仍然可以在使用以下命令重置文件后执行此操作：

```
git show :file.txt 
```

输出到标准输出或

```
git show :file.txt > file_at_27cf8e8.txt 
```

但是，如果这就是您想要的，那么按照其他人的建议`git show`直接运行`git show 27cf8e8:file.txt`当然要直接得多。

我将留下这个答案，因为`git show`直接运行可以让你立即获得那个旧版本，但是如果你想用它做一些事情，那么从那里这样做并不像你重置那个版本那样方便在索引中。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-07-24T02:34:05.370

这将帮助您在不指定路径的情况下在提交之间获取所有已删除的文件，这在删除大量文件时很有用。

```
git diff --name-only --diff-filter=D $commit~1 $commit | xargs git checkout $commit~1 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-12-23T11:42:54.813

`git show $REV:$FILE`正如其他人已经指出的那样使用可能是正确的答案。我发布了另一个答案，因为当我尝试这种方法时，有时我会从 git 收到以下错误：

```
fatal: path 'link/foo' exists on disk, but not in 'HEAD' 
```

当文件路径的一部分是符号链接时，就会出现问题。在这些情况下，该`git show $REV:$FILE`方法将**不起作用**。重现步骤：

```
$ git init .
$ mkdir test
$ echo hello > test/foo
$ ln -s test link
$ git add .
$ git commit -m "initial commit"
$ cat link/foo
hello
$ git show HEAD:link/foo
fatal: path 'link/foo' exists on disk, but not in 'HEAD' 
```

问题是，像`realpath`这样的实用程序在这里没有帮助，因为符号链接可能不再存在于当前提交中。我不知道一个好的通用解决方案。就我而言，我知道符号链接只能存在于路径的第一个组件中，所以我通过使用该`git show $REV:$FILE`方法两次解决了这个问题。这是有效的，因为当`git show $REV:$FILE`在符号链接上使用时，它的目标会被打印出来：

```
$ git show HEAD:link
test 
```

而对于目录，该命令将输出一个标题，然后是目录内容：

```
$ git show HEAD:test
tree HEAD:test

foo 
```

因此，就我而言，我只是检查了第一次调用的输出，`git show $REV:$FILE`如果它只有一行，那么我将路径的第一个组件替换为通过 git 解析符号链接的结果。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-07-22T15:05:16.167

通过检出先前的提交和复制文件从先前的提交中获取文件。

*   注意你在哪个分支：git branch
*   签出您想要的上一个提交：`git checkout 27cf8e84bb88e24ae4b4b3df2b77aab91a3735d8`
*   将您想要的文件复制到临时位置
*   签出您开始的分支： `git checkout theBranchYouNoted`
*   复制您放置在临时位置的文件
*   将您的更改提交到 git：`git commit -m "added file ?? from previous commit"`

# sql - 如何将 xlsx 文件导入 Sql server 2000

> ID：610227
> 
> 赞同：0
> 
> 时间：2009-03-04T11:50:44.040
> 
> 标签：sql, sql-server

最近我搬到了 Office 2007。我试图使用导入和导出数据工具将 excel 文件导入 sql server 2000，该工具将数据源作为 excel 97 - 2000，但是在导入 xlsx 文件时，我收到错误“错误源 Microsoft Jet 数据库引擎"，外部表不是预期的格式。你能告诉我如何使用导入和导出数据工具将 office excel 文件 xlsx 导入 sql server 2000。

感谢您的及时评论

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T02:17:02.497

假设 DTS 支持，您可以使用 OLEDB 连接。好久没用了，记不太清了。连接看起来像这样：Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\myFolder\myExcel2007file.xlsx;Extended Properties="Excel 12.0 Xml;HDR=YES";

如果您的 DTS 服务器没有安装 Office，您需要安装驱动程序： http: [//www.microsoft.com/downloads/details.aspx?familyid=7554F536-8C28-4598-9B72 -EF94E038C891&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-22T07:10:35.063

简单的方法是使用Access 2007创建一个Access Project连接SQL 2000，然后通过Access 2007 Project导入Excel 2007数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T01:47:03.647

当您有一个小于 65536 行的电子表格时，将文档保存为 97-2003 格式很好，如果不是，则使用 GordonB 的链接有效

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-04T11:57:38.047

您总是可以将其保存为 97-2000 格式的 XLS 文件

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-04T14:50:03.810

我同意“schooner”，将 Excel 2007 导入 SQL 2K 的最简单方法是将 excel 文档保存为 97-2003 格式。

# .net - 登录协议

> ID：610229
> 
> 赞同：1
> 
> 时间：2009-03-04T11:52:02.443
> 
> 标签：.net, security, login

我应该如何设计一个更安全的登录协议，就像我现在拥有的那样

1.  客户端连接并发送他的用户名

2.  服务器为用户发送盐（总是相同的）

3.  客户端将盐添加到密码哈希中并将其发送到服务器

这样密码一直被隐藏，但它并不能阻止黑客复制哈希，如果他可以过来并在他收到密码后发送它......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T12:00:41.473

将安全性留给更高级别的协议（SSH、SSL）并保持简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T11:56:41.933

*如果服务器只接受最初用该盐挑战的连接上*的盐渍密码，那么黑客将不得不继续连接，直到他得到与他看到的哈希相同的盐。我并不是说这是理想的（并且 Diffie-Hellman 密钥交换和完全加密的身份验证可能更安全，尽管除非你小心，否则仍然容易受到中间人攻击）但我认为简单的调整至少是有益的。

再说一次，我不是安全专家，可以说你不应该听取任何非专家的安全建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T12:28:10.657

安全很难。

不要推出自己的登录协议，要么使用[现有的经过验证](http://en.wikipedia.org/wiki/Challenge-response_authentication)的协议，要么通过加密（SSH、SSL ......）连接做一些简单而强大的事情。那里有很多可靠的协议的强大的插入式实现，以及由于轮子的有缺陷的重新发明而导致系统失败的许多例子——如果登录保护了任何重要的东西，那就没有任何借口了。

也就是说，如果您的目的是学习设计此类算法，我强烈推荐 Bruce Schneier 的“[应用密码学](http://www.amazon.co.uk/Applied-Cryptography-Protocols-Algorithms-Source/dp/0471117099)”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T12:08:13.327

第 2 步似乎是更大的弱点。如果您可以确保服务器发送“足够大”的盐并且永远不会发送相同的盐，两次（我怀疑一小部分像样的随机数，加上一个递增的计数器，那么散列可能就足够了，但我无法证明它是），这可能就足够了。或者，按照 ssg 的指导，将整个事情封装在 SSL 会话中。

# c - C strcpy() - 邪恶？

> ID：610238
> 
> 赞同：22
> 
> 时间：2009-03-04T11:54:30.193
> 
> 标签：c, memcpy, strcpy

有些人似乎认为 C 的`strcpy()`功能是坏的或邪恶的。虽然我承认通常最好使用它`strncpy()`来避免缓冲区溢出，但以下（`strdup()`对于那些没有幸运拥有它的人的函数实现）安全地使用`strcpy()`并且*永远不*应该溢出：

```
char *strdup(const char *s1)
{
  char *s2 = malloc(strlen(s1)+1);
  if(s2 == NULL)
  {
    return NULL;
  }
  strcpy(s2, s1);
  return s2;
} 
```

`*s2`保证有足够的空间来存储`*s1`，并且 using 使`strcpy()`我们不必将`strlen()`结果存储在另一个函数中，以便以后用作`strncpy()`. 然而有些人用`strncpy()`，甚至编写这个函数`memcpy()`，它们都需要一个长度参数。我想知道人们对此有何看法。如果您认为`strcpy()`在某些情况下是安全的，请说出来。如果您有充分的理由不在`strcpy()`这种情况下使用，请给出 - 我想知道为什么在这种情况下使用它可能会`strncpy()`更好`memcpy()`。如果您认为`strcpy()`还可以，但不在这里，请解释。

基本上，我只是想知道为什么有些人`memcpy()`在其他人使用而其他人使用时`strcpy()`使用 plain `strncpy()`。是否有任何逻辑比三个更喜欢一个（忽略前两个的缓冲区检查）？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-04T17:08:36.973

`memcpy`可以更快`strcpy`，`strncpy`因为它不必将每个复制的字节与 '\0' 进行比较，并且因为它已经知道复制对象的长度。它可以用[Duff 的 device](http://en.wikipedia.org/wiki/Duff%27s_device)以类似的方式实现，或者使用一次复制几个字节的汇编指令，如 movsw 和 movsd

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-04T12:24:09.637

我在[这里](http://www.lysator.liu.se/c/rat/d11.html)遵守规则。让我引用它

> `strncpy`最初被引入 C 库以处理结构中的固定长度名称字段，例如目录条目。此类字段的使用方式与字符串不同：对于最大长度字段，尾随 null 是不必要的，并且将较短名称的尾随字节设置为 null 可确保有效的逐字段比较。strncpy 的起源并不是“有界 strcpy”，委员会更愿意承认现有的做法，而不是改变功能以更好地适应这种用途。

`'\0'`出于这个原因，如果您点击`n`not found a`'\0'`从源字符串到目前为止，您将不会在字符串中得到尾随。很容易误用它（当然，如果你知道这个陷阱，你可以避免它）。正如引用所说，它不是设计为有界的strcpy。如果没有必要，我宁愿不使用它。在您的情况下，显然没有必要使用它，并且您证明了这一点。那为什么要使用它？

而且一般来说，编程代码也是为了减少冗余。如果你知道你有一个包含“n”个字符的字符串，为什么要告诉复制函数复制最大`n`字符？你做冗余检查。它与性能无关，但更多的是关于一致的代码。读者会问自己，有什么`strcpy`办法可以跨越`n`字符，这使得有必要限制复制，只是为了阅读手册，在这种情况下*不会发生*这种情况。代码的读者之间开始出现混乱。

为了合理使用`mem-`, `str-`or `strn-`，我在上面的链接文档中选择了它们：

`mem-`当我想复制原始字节时，比如结构的字节。

`str-`复制空终止字符串时 - 仅当 100% 不会发生溢出时。

`strn-`当复制一个空终止的字符串到一定长度时，用零填充剩余的字节。在大多数情况下，可能不是我想要的。尾随零填充很容易忘记这一事实，但正如上面引用所解释的那样，这是设计使然。所以，我只需编写我自己的复制字符的小循环，添加一个尾随`'\0'`：

```
char * sstrcpy(char *dst, char const *src, size_t n) {
    char *ret = dst;
    while(n-- > 0) {
        if((*dst++ = *src++) == '\0')
            return ret;
    }
    *dst++ = '\0';
    return ret;
} 
```

只有几行完全符合我的要求。如果我想要“原始速度”，我仍然可以寻找一个可移植和优化的实现来完成这个*有界的 strcpy*工作。与往常一样，先配置文件，然后再弄乱它。

后来，C 有了处理宽字符的函数，称为`wcs-`and `wcsn-`(for `C99`)。我也会使用它们。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-04T12:10:09.437

人们使用 strncpy 而不是 strcpy 的原因是因为字符串并不总是以 null 结尾，而且很容易溢出缓冲区（您使用 strcpy 为字符串分配的空间）并覆盖一些不相关的内存位。

使用 strcpy 可能会发生这种**情况**，使用 strncpy**永远不会**发生这种情况。这就是为什么 strcpy 被认为是不安全的。邪恶可能有点强。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-04T12:52:34.500

坦率地说，如果您在 C 中进行大量字符串处理，您不应该问自己是否应该使用`strcpy`or`strncpy`或`memcpy`。您应该找到或编写一个提供更高级别抽象的字符串库。例如，跟踪每个字符串的长度，为您分配内存，并提供您需要的所有字符串操作。

这几乎肯定会保证您很少犯通常与 C 字符串处理相关的错误，例如缓冲区溢出、忘记用 NUL 字节终止字符串等等。

该库可能具有以下功能：

```
typedef struct MyString MyString;
MyString *mystring_new(const char *c_str);
MyString *mystring_new_from_buffer(const void *p, size_t len);
void mystring_free(MyString *s);
size_t mystring_len(MyString *s);
int mystring_char_at(MyString *s, size_t offset);
MyString *mystring_cat(MyString *s1, ...); /* NULL terminated list */
MyString *mystring_copy_substring(MyString *s, size_t start, size_t max_chars);
MyString *mystring_find(MyString *s, MyString *pattern);
size_t mystring_find_char(MyString *s, int c);
void mystring_copy_out(void *output, MyString *s, size_t max_chars);
int mystring_write_to_fd(int fd, MyString *s);
int mystring_write_to_file(FILE *f, MyString *s); 
```

我为[Kannel 项目](http://kannel.org/)编写了一个，请参阅 gwlib/octstr.h 文件。它让我们的生活变得更加简单。另一方面，这样的库编写起来相当简单，因此您可以为自己编写一个，即使只是作为练习。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-05T05:10:02.730

没有人提到[`strlcpy`](http://en.wikipedia.org/wiki/Strlcpy)，[由 Todd C. Miller 和 Theo de Raadt 开发](http://www.gratisoft.us/todd/papers/strlcpy.html)。正如他们在论文中所说：

> 最常见的误解是 `strncpy()`NUL 终止目标字符串。但是，这仅在源字符串的长度小于 size 参数时才成立。在将可能具有任意长度的用户输入复制到固定大小的缓冲区中时，这可能会出现问题。在这种情况下使用最安全的方法 `strncpy()`是传递它比目标字符串的大小小一，然后手动终止该字符串。这样你就可以保证总是有一个以 NUL 结尾的目标字符串。

`strlcpy`使用;有反对意见。维基百科页面注意到

> Drepper 认为，这`strlcpy`使得 `strlcat`截断错误更容易被程序员忽略，因此可能引入的错误多于删除的错误。[*](http://en.wikipedia.org/wiki/Strlcpy#cite_note-libc-alpha-discussion-1-1)

但是，我相信这只会迫使知道自己在做什么的人除了手动调整`strncpy`. 使用`strlcpy`可以更容易地避免缓冲区溢出，因为您未能 NULL 终止您的缓冲区。

另请注意，`strlcpy`glibc 或 Microsoft 的库中缺少不应成为使用的障碍；您可以`strlcpy`在任何 BSD 发行版中找到源代码和朋友，并且该许可证可能对您的商业/非商业项目很友好。请参阅顶部的评论`strlcpy.c`。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-04T12:06:49.647

我个人的心态是，如果代码可以被证明是有效的——并且做得这么快——那是完全可以接受的。也就是说，如果代码很简单，因此显然是正确的，那就没问题了。

但是，您的假设似乎是，当您的函数正在执行时，没有其他线程会修改`s1`. 如果此函数在成功分配内存（并因此调用`strlen`）后被中断，字符串会增长，并且由于复制到 NULL 字节**而**出现缓冲区溢出情况，会发生什么情况。`strcpy`

以下可能会更好：

```
char *
strdup(const char *s1) {
  int s1_len = strlen(s1);
  char *s2 = malloc(s1_len+1);
  if(s2 == NULL) {
    return NULL;
  }

  strncpy(s2, s1, s1_len);
  return s2;
} 
```

现在，字符串可以通过你自己的过错而增长，你是安全的。结果不会是重复，但也不会是任何疯狂的溢出。

*您提供的代码实际上*是错误的可能性非常低（如果您在不支持任何线程的环境中工作，则几乎不存在，如果不是不存在的话）。这只是需要考虑的事情。

**ETA**：这是一个稍微好一点的实现：

```
char *
strdup(const char *s1, int *retnum) {
  int s1_len = strlen(s1);
  char *s2 = malloc(s1_len+1);
  if(s2 == NULL) {
    return NULL;
  }

  strncpy(s2, s1, s1_len);
  retnum = s1_len;
  return s2;
} 
```

那里正在返回字符数。你也可以：

```
char *
strdup(const char *s1) {
  int s1_len = strlen(s1);
  char *s2 = malloc(s1_len+1);
  if(s2 == NULL) {
    return NULL;
  }

  strncpy(s2, s1, s1_len);
  s2[s1_len+1] = '\0';
  return s2;
} 
```

这将以一个`NUL`字节终止它。无论哪种方式都比我最初快速组合的方式要好。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-04T12:15:29.550

我同意。我建议不`strncpy()`要这样做，因为它总是会将您的输出填充到指定的长度。这是一个历史性的决定，我认为这真的很不幸，因为它严重恶化了性能。

考虑这样的代码：

```
char buf[128];
strncpy(buf, "foo", sizeof buf); 
```

这不会将预期的四个字符写入`buf`，而是写入“foo”，后跟 125 个零字符。例如，如果您正在收集大量短字符串，这将意味着您的实际性能远低于预期。

如果可用，我更喜欢使用`snprintf()`，将上面的内容写成：

```
snprintf(buf, sizeof buf, "foo"); 
```

如果改为复制非常量字符串，则可以这样完成：

```
snprintf(buf, sizeof buf, "%s", input); 
```

这很重要，因为如果`input`包含 % 字符`snprintf()`会解释它们，打开整个货架的蠕虫罐头。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-04T13:14:12.747

我认为 strncpy 也是邪恶的。

为了真正保护自己免受此类编程错误的影响，您需要确保无法编写 (a) 看起来不错并且 (b) 超出缓冲区的代码。

这意味着您需要一个真正的字符串抽象，它不透明地存储缓冲区和容量，将它们永远绑定在一起，并检查边界。否则，您最终会在整个商店中传递字符串及其容量。一旦你得到真正的字符串操作，比如修改字符串的中间，几乎很容易将错误的长度传递给 strncpy（尤其是 strncat），就像用太小的目标调用 strcpy 一样容易。

当然，您可能仍然会问在实现该抽象时是否使用 strncpy 或 strcpy：如果您完全了解它的作用，则 strncpy 在那里更安全。但在字符串处理应用程序代码中，依靠 strncpy 来防止缓冲区溢出就像戴了半个避孕套。

因此，您的 strdup-replacement 可能看起来像这样（更改定义顺序以使您保持悬念）：

```
string *string_dup(const string *s1) {
    string *s2 = string_alloc(string_len(s1));
    if (s2 != NULL) {
        string_set(s2,s1);
    }
    return s2;
}

static inline size_t string_len(const string *s) {
    return strlen(s->data);
}

static inline void string_set(string *dest, const string *src) {
    // potential (but unlikely) performance issue: strncpy 0-fills dest,
    // even if the src is very short. We may wish to optimise
    // by switching to memcpy later. But strncpy is better here than
    // strcpy, because it means we can use string_set even when
    // the length of src is unknown.
    strncpy(dest->data, src->data, dest->capacity);
}

string *string_alloc(size_t maxlen) {
    if (maxlen > SIZE_MAX - sizeof(string) - 1) return NULL;
    string *self = malloc(sizeof(string) + maxlen + 1);
    if (self != NULL) {
        // empty string
        self->data[0] = '\0';
        // strncpy doesn't NUL-terminate if it prevents overflow, 
        // so exclude the NUL-terminator from the capacity, set it now,
        // and it can never be overwritten.
        self->capacity = maxlen;
        self->data[maxlen] = '\0';
    }
    return self;
}

typedef struct string {
    size_t capacity;
    char data[0];
} string; 
```

这些字符串抽象的问题在于，没有人可以就其中一个达成一致（例如，上面评论中提到的 strncpy 的特质是好是坏，在创建子字符串时是否需要共享缓冲区的不可变和/或写时复制字符串， ETC）。因此，尽管理论上您应该只从货架上取下一个，但最终每个项目都可以有一个。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-03-04T12:07:43.310

当人们这样使用它时，邪恶就来了（尽管下面是超级简化的）：

```
void BadFunction(char *input)
{
    char buffer[1024]; //surely this will **always** be enough

    strcpy(buffer, input);

    ...
} 
```

这是经常发生的令人惊讶的情况。

但是，是的，在为目标缓冲区分配内存并且已经使用 strlen 查找长度的任何情况下，strcpy 都与 strncpy 一样好。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-04T12:01:48.037

`memcpy`如果我已经计算了长度，我倾向于使用，尽管`strcpy`通常针对机器字进行优化，但感觉您应该为库提供尽可能多的信息，以便它可以使用最优化的复制机制。

但是对于您给出的示例，没关系-如果它会失败，它将在初始状态`strlen`，因此 strncpy 在安全方面不会给您带来任何好处（并且可能`strncpy`会更慢，因为它必须同时检查边界和对于 nul)，以及`memcpy`和之间的任何区别`strcpy`都不值得投机地更改代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-04T11:59:59.367

strlen 找到最后一个空终止位置。

但实际上缓冲区不是空终止的。

这就是人们使用不同功能的原因。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-09T06:48:28.340

```
char* dupstr(char* str)
{
   int full_len; // includes null terminator
   char* ret;
   char* s = str;

#ifdef _DEBUG
   if (! str)
      toss("arg 1 null", __WHENCE__);
#endif

   full_len = strlen(s) + 1;
   if (! (ret = (char*) malloc(full_len)))
      toss("out of memory", __WHENCE__);
   memcpy(ret, s, full_len); // already know len, so strcpy() would be slower

   return ret;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T12:16:20.280

好吧，strcpy() 并不像 strdup() 那样邪恶——至少 strcpy() 是标准 C 的一部分。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-04T12:49:56.627

在您描述的情况下， strcpy 是一个不错的选择。只有当 s1 没有以 '\0' 结尾时，这个 strdup 才会遇到麻烦。

我会添加一条评论，说明为什么 strcpy 没有问题，以防止其他人（以及一年后的你自己）对它的正确性感到疑惑太久。

strncpy 通常看起来很安全，但可能会给您带来麻烦。如果源“字符串”比 count 短，它会用 '\0' 填充目标，直到达到 count。这可能对性能不利。如果源字符串长于 count，strncpy 不会将 '\0' 附加到目标。当您期望以 '\0' 结尾的“字符串”时，这势必会给您带来麻烦。所以 strncpy 也应该谨慎使用！

如果我不使用 '\0' 终止的字符串，我只会使用 memcpy，但这似乎是一个品味问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-09-27T22:07:31.897

```
char *strdup(const char *s1)
{
  char *s2 = malloc(strlen(s1)+1);
  if(s2 == NULL)
  {
    return NULL;
  }
  strcpy(s2, s1);
  return s2;
} 
```

问题：

1.  s1 未终止，strlen 导致访问未分配内存，程序崩溃。
2.  s1 未终止，strlen 不会导致从应用程序的另一部分访问未分配的内存访问内存。它被返回给用户（安全问题）或由程序的另一部分解析（出现 heisenbug）。
3.  s1 未终止，strlen 导致系统无法满足的 malloc，返回 NULL。strcpy 传递 NULL，程序崩溃。
4.  s1 未终止，strlen 导致 malloc 非常大，系统分配了太多内存来执行手头的任务，变得不稳定。
5.  在最好的情况下，代码效率低下，strlen 需要访问字符串中的每个元素。

可能还有其他问题......看，空终止并不总是一个坏主意。在某些情况下，为了计算效率或减少存储需求，它是有意义的。

对于编写通用代码，例如业务逻辑，它有意义吗？不。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-04-21T17:02:34.093

这个答案使用`size_t`and`memcpy()`快速简单`strdup()`。

最好使用 type `size_t`，因为它是从 and 中返回和`strlen()`使用的类型。 不是这些操作的正确类型。`malloc()``memcpy()``int`

`memcpy()`很少比`strcpy()`或`strncpy()`通常快得多。

```
// Assumption: `s1` points to a C string.
char *strdup(const char *s1) {
  size_t size = strlen(s1) + 1;
  char *s2 = malloc(size);
  if(s2 != NULL) {
    memcpy(s2, s1, size);
  }
  return s2;
} 
```

§7.1.1 1 “*字符串*是由第一个空字符终止并包括第一个空字符的连续字符序列。......”

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-03-04T13:54:51.917

您的代码非常低效，因为它两次遍历字符串来复制它。

一旦进入 strlen()。

然后再次在 strcpy() 中。

而且您不会检查 s1 是否为 NULL。

将长度存储在一些额外的变量中几乎没有任何成本，而对每个字符串运行两次以复制它是一个大罪。

# architecture - 容错软件架构

> ID：610242
> 
> 赞同：13
> 
> 时间：2009-03-04T11:55:36.040
> 
> 标签：architecture, fault-tolerance

我正在寻找一些关于容错软件架构的好文章。我可以请一些建议。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T12:31:55.063

我找到了[“放开它！”](http://www.pragprog.com/titles/mnee/release-it) 成为优秀的读物。

> 在 Release It! 中，Michael T. Nygard 向您展示了如何针对将面临的严酷现实设计和构建您的应用程序。您将学习如何设计您的应用程序以实现最长的正常运行时间、性能和投资回报。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-04T12:46:24.247

[软件可靠性工程手册，](http://www.cse.cuhk.edu.hk/~lyu/book/reliability/)您可以阅读 pdf。软件可靠性的主要原则之一是容错。

看看[第 14 章容错软件](http://www.cse.cuhk.edu.hk/~lyu/book/reliability/pdf/Chap_14.pdf)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T12:47:12.873

链接转储！:)

这些是我在研究冗余的某个方面时得到的一些想法（或仅用于术语检查）的一些在线内容。

*   [分布式系统的容错技术](http://www-128.ibm.com/developerworks/rational/library/114.html)(IBM DeveloperWorks)
*   [了解容错分布式系统](http://portal.acm.org/citation.cfm?id=102801)(ACM)
*   [软件控制的容错](http://portal.acm.org/citation.cfm?id=1113841.1113843)(ACM)
*   [拜占庭容错](http://en.wikipedia.org/wiki/Byzantine_Fault_Tolerance)（维基百科）
*   [容错设计](http://en.wikipedia.org/wiki/Fault-tolerant_design)（维基百科）
*   [容错](http://en.wikipedia.org/wiki/Fault-tolerance)（维基百科）

ACM 需要会员资格。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T12:19:27.277

由于有多种方法可以在软件中实现容错，因此很难在一篇文章中对其进行总结。这些原则涉及桌面、服务器应用程序和/或 SOA。还有多种方法，我们已经在不知道的情况下遵循了其中的一些方法；例如异常处理。尝试在一篇文章中深入研究所有概念将是一项艰巨的壮举。你可以在谷歌上通过简单的搜索找到很多文章。

对于我的 FYP，我研究了操作系统范围的自我修复系统。我遵循了 Sun Solaris 10 架构和 IBM 的自主计算研究 ( [http://www.research.ibm.com/autonomic/](http://www.research.ibm.com/autonomic/) )。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-03T02:42:13.317

这篇关于[软件故障处理技术](http://www.eventhelix.com/realtimemantra/SoftwareFaultTolerance.htm)的文章涵盖了以下主题：

*   超时
*   审计
*   异常处理
*   任务回滚
*   增量重启
*   表决

# c++ - 我必须在哪里以及为什么要放置“模板”和“类型名称”关键字？

> ID：610245
> 
> 赞同：1276
> 
> 时间：2009-03-04T11:56:16.583
> 
> 标签：c++, templates, typename, c++-faq, dependent-name

`typename`在模板中，我必须在哪里以及为什么必须放置`template`依赖名称？
究竟什么是从属名称？

我有以下代码：

```
template <typename T, typename Tail> // Tail will be a UnionNode too.
struct UnionNode : public Tail {
    // ...
    template<typename U> struct inUnion {
        // Q: where to add typename/template here?
        typedef Tail::inUnion<U> dummy; 
    };
    template< > struct inUnion<T> {
    };
};
template <typename T> // For the last node Tn.
struct UnionNode<T, void> {
    // ...
    template<typename U> struct inUnion {
        char fail[ -2 + (sizeof(U)%2) ]; // Cannot be instantiated for any U
    };
    template< > struct inUnion<T> {
    };
}; 
```

我遇到的问题是`typedef Tail::inUnion<U> dummy`在线。我相当肯定这`inUnion`是一个从属名称，VC++ 对此感到窒息是完全正确的。
我也知道我应该能够添加`template`某个地方来告诉编译器 inUnion 是一个模板 ID。但具体在哪里？然后它应该假设 inUnion 是一个类模板，即`inUnion<U>`命名一个类型而不是一个函数吗？

* * *

## 回答 #1

> 赞同：1311
> 
> 时间：2009-03-05T00:27:57.213

（请参阅[此处了解我的 C++11 答案](https://stackoverflow.com/a/17579889/4561887)）

为了解析 C++ 程序，编译器需要知道某些名称是否是类型。以下示例说明：

```
t * f; 
```

这应该如何解析？对于许多语言，编译器不需要知道名称的含义就可以解析并且基本上知道一行代码的作用。然而，在 C++ 中，上述内容可能会产生截然不同的解释，具体取决于`t`含义。如果它是一个类型，那么它将是一个指针的声明`f`。但是，如果它不是一个类型，它将是一个乘法。所以 C++ 标准在第 (3/7) 段中说：

> 一些名称表示类型或模板。通常，无论何时遇到一个名称，在继续解析包含它的程序之前，都必须确定该名称是否表示这些实体之一。确定这一点的过程称为名称查找。

`t::x`如果`t`引用模板类型参数，编译器将如何找出名称所指的内容？`x`可以是可以相乘的静态 int 数据成员，也可以同样可以是可以屈服于声明的嵌套类或 typedef。**如果名称具有此属性——在知道实际模板参数之前无法查找它——那么它被称为*依赖名称*（它“依赖于”模板参数）。**

您可能会建议等到用户实例化模板：

> *让我们等到用户实例化模板，然后再找出真正的含义`t::x * f;`。*

这将起作用，并且实际上被标准允许作为一种可能的实施方法。这些编译器基本上将模板的文本复制到内部缓冲区中，并且只有在需要实例化时，它们才会解析模板并可能检测定义中的错误。但是，与其用模板作者的错误来打扰模板的用户（可怜的同事！），其他实现选择在实例化之前尽早检查模板并在定义中尽快给出错误。

所以必须有一种方法告诉编译器某些名称是类型，而某些名称不是。

## “类型名”关键字

答案是：*我们*决定编译器应该如何解析它。如果`t::x`是一个依赖名称，那么我们需要在它前面加上前缀，`typename`告诉编译器以某种方式解析它。该标准在 (14.6/2) 处说：

> 在模板声明或定义中使用并且依赖于模板参数的名称被假定为不命名类型，除非适用的名称查找找到类型名称或该名称由关键字 typename 限定。

有许多名称`typename`是不必要的，因为编译器可以通过模板定义中适用的名称查找来确定如何解析构造本身 - 例如使用`T *f;`, when`T`是类型模板参数。但是`t::x * f;`要成为一个声明，它必须写成`typename t::x *f;`. 如果省略关键字并且名称被视为非类型，但当实例化发现它表示类型时，编译器会发出通常的错误消息。有时，错误因此在定义时给出：

```
// t::x is taken as non-type, but as an expression the following misses an
// operator between the two names or a semicolon separating them.
t::x f; 
```

*该语法`typename`只允许在限定名称之前*- 因此，如果它们这样做，则始终知道非限定名称引用类型是理所当然的。

正如介绍性文本所暗示的，对于表示模板的名称也存在类似的问题。

## “模板”关键字

还记得上面的初始报价以及标准如何要求对模板进行特殊处理吗？让我们看下面这个看似无辜的例子：

```
boost::function< int() > f; 
```

对于人类读者来说，这可能看起来很明显。对于编译器来说不是这样。`boost::function`想象一下and的以下任意定义`f`：

```
namespace boost { int function = 0; }
int main() { 
  int f = 0;
  boost::function< int() > f; 
} 
```

这实际上是一个有效的*表达*！它使用小于运算符`boost::function`与零 ( `int()`) 进行比较，然后使用大于运算符将结果`bool`与进行比较`f`。但是您可能很清楚，`boost::function` [在现实生活中](http://www.boost.org/doc/libs/1_54_0/doc/html/function.html)是一个模板，所以编译器知道 (14.2/3)：

> 在名称查找 (3.4) 发现一个名称是一个模板名称后，如果这个名称后跟一个 <，则 < 总是被视为模板参数列表的开头，而不是一个名称后跟 less-比运营商。

现在我们又回到了与 相同的问题`typename`。如果我们在解析代码时还不知道名称是否是模板怎么办？我们需要`template`在模板名称之前插入，如`14.2/4`. 这看起来像：

```
t::template f<int>(); // call a function template 
```

模板名称不仅可以出现在 a 之后`::`，还可以出现在 a 之后`->`或`.`在类成员访问中。您还需要在此处插入关键字：

```
this->template f<int>(); // call a function template 
```

* * *

## 依赖项

对于那些在书架上有厚厚的标准书并且想知道我到底在说什么的人，我会谈谈标准中是如何规定的。

在模板声明中，某些构造具有不同的含义，具体取决于您用于实例化模板的模板参数：表达式可能具有不同的类型或值，变量可能具有不同的类型，或者函数调用可能最终调用不同的函数。这种结构通常被认为*依赖*于模板参数。

该标准通过构造是否依赖来精确定义规则。它将它们分成逻辑上不同的组：一个捕获类型，另一个捕获表达式。表达式可能取决于它们的值和/或它们的类型。所以我们有，附加了典型的例子：

*   依赖类型（例如：类型模板参数`T`）
*   与值相关的表达式（例如：非类型模板参数`N`）
*   类型相关的表达式（例如：转换为类型模板参数`(T)0`）

大多数规则都是直观的，并且是递归构建的：例如，构造为`T[N]`依赖类型的类型如果`N`是值依赖表达式或`T`依赖类型。`(14.6.2/1`关于依赖类型、`(14.6.2.2)`类型依赖表达式和`(14.6.2.3)`值依赖表达式的详细信息可以在 ) 部分中阅读。

### 从属名称

该标准有点不清楚究竟*什么*是*从属名称*。在简单的阅读中（你知道，最不意外的原则），它定义为*依赖名称*的所有内容都是下面函数名称的特例。但是由于显然`T::x`还需要在实例化上下文中查找，它也需要是一个依赖名称（幸运的是，从 C++14 中期开始，委员会已经开始研究如何修复这个令人困惑的定义）。

为了避免这个问题，我对标准文本进行了简单的解释。在所有表示依赖类型或表达式的结构中，它们的一个子集表示名称。因此，这些名称是“从属名称”。一个名字可以有不同的形式——标准说：

> 名称是标识符 (2.11)、operator-function-id (13.5)、conversion-function-id (12.3.2) 或 template-id (14.2) 的使用，表示实体或标签 (6.6.4, 6.1)

标识符只是一个简单的字符/数字序列，而接下来的两个是`operator +`and`operator type`形式。最后一种形式是`template-name <argument list>`。所有这些都是名称，并且按照标准中的传统用法，名称还可以包含限定符，说明应该在哪个名称空间或类中查找名称。

值相关表达式`1 + N`不是名称，而是名称`N`。作为名称的所有依赖结构的子集称为*依赖名称*。然而，函数名称在模板的不同实例中可能具有不同的含义，但不幸的是，它并没有被这个一般规则所捕获。

### 依赖函数名

不是本文主要关注的问题，但仍然值得一提：函数名称是一个单独处理的异常。标识符函数名称不依赖于它本身，而是依赖于调用中使用的类型依赖的参数表达式。在示例`f((T)0)`中，`f`是从属名称。在标准中，这在`(14.6.2/1)`.

## 附加说明和示例

在足够多的情况下，我们需要`typename`和`template`。您的代码应如下所示

```
template <typename T, typename Tail>
struct UnionNode : public Tail {
    // ...
    template<typename U> struct inUnion {
        typedef typename Tail::template inUnion<U> dummy;
    };
    // ...
}; 
```

关键字`template`不必总是出现在名称的最后部分。它可以出现在用作作用域的类名之前的中间，如下例所示

```
typename t::template iterator<int>::value_type v; 
```

在某些情况下，关键字是被禁止的，详情如下

*   在依赖基类的名字上你是不允许写的`typename`。假定给定的名称是类类型名称。对于基类列表和构造函数初始化列表中的名称都是如此：

    ```
     template <typename T>
     struct derive_from_Has_type : /* typename */ SomeBase<T>::type 
     { }; 
    ```

*   在 using-declarations 中，不能`template`在 last 之后使用`::`，并且 C++ 委员会[表示](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_closed.html#109)不要制定解决方案。

    ```
     template <typename T>
     struct derive_from_Has_type : SomeBase<T> {
        using SomeBase<T>::template type; // error
        using typename SomeBase<T>::type; // typename *is* allowed
     }; 
    ```

* * *

## 回答 #2

> 赞同：155
> 
> 时间：2013-07-10T20:02:50.770

## C++11

### 问题

虽然 C++03 中关于何时需要的规则`typename`并且`template`在很大程度上是合理的，但它的表述有一个令人讨厌的缺点

```
template<typename T>
struct A {
  typedef int result_type;

  void f() {
    // error, "this" is dependent, "template" keyword needed
    this->g<float>();

    // OK
    g<float>();

    // error, "A<T>" is dependent, "typename" keyword needed
    A<T>::result_type n1;

    // OK
    result_type n2; 
  }

  template<typename U>
  void g();
}; 
```

可以看出，我们需要消歧关键字，即使编译器可以完美地找出自己`A::result_type`只能是`int`（因此是一种类型），并且`this->g`只能是`g`稍后声明的成员模板（即使在`A`某处显式专门化，那也会不会影响该模板中的代码，因此其含义不会受到以后的特殊化`A`!) 的影响。

### 当前实例化

为了改善这种情况，在 C++11 中，语言会跟踪类型何时引用封闭模板。要知道，该类型必须是使用某种形式的名称形成的，也就是它自己的名称（在上面，`A`, `A<T>`, `::A<T>`）。由这种名称引用的类型称为*当前实例化*。如果形成名称的类型是成员/嵌套类（然后，`A::NestedClass`并且`A`都是当前实例化），则可能有多种类型都是当前实例化。

基于这个概念，如果发现**,**`CurrentInstantiation::Foo`和`Foo`（`CurrentInstantiationTyped->Foo`例如`A *a = this; a->Foo`）是*当前实例化* 的类的成员或其非依赖基类之一（只需执行立即查找名称）。

 **如果限定符是当前实例化的成员，则不再需要关键字`typename`and 。`template`这里要记住的一个关键点是它`A<T>`仍然*是*一个依赖于类型的名称（毕竟`T`也是依赖于类型的）。But `A<T>::result_type`is known to be a type - 编译器会“神奇地”研究这种依赖类型来解决这个问题。

```
struct B {
  typedef int result_type;
};

template<typename T>
struct C { }; // could be specialized!

template<typename T>
struct D : B, C<T> {
  void f() {
    // OK, member of current instantiation!
    // A::result_type is not dependent: int
    D::result_type r1;

    // error, not a member of the current instantiation
    D::questionable_type r2;

    // OK for now - relying on C<T> to provide it
    // But not a member of the current instantiation
    typename D::questionable_type r3;        
  }
}; 
```

这令人印象深刻，但我们能做得更好吗？该语言甚至更进一步，*要求*`D::result_type`在实例化时再次查找实现`D::f`（即使它在定义时已经找到了它的含义）。当现在查找结果不同或导致歧义时，程序格式错误，必须给出诊断。想象一下如果我们这样定义会发生`C`什么

```
template<>
struct C<int> {
  typedef bool result_type;
  typedef int questionable_type;
}; 
```

实例化时需要编译器来捕获错误`D<int>::f`。因此，您将获得两全其美：“延迟”查找在您遇到依赖基类问题时保护您，以及“立即”查找让您从`typename`和`template`.

### 未知专业

在 的代码中`D`，名称`typename D::questionable_type`不是当前实例化的成员。相反，该语言将其标记为*未知专业的成员*。特别是，当您正在执行`DependentTypeName::Foo`或者`DependentTypedName->Foo`依赖类型*不是*当前实例化（在这种情况下编译器可以放弃并说“我们稍后会看看`Foo`是什么）或者它*是*当前实例化并且在它或其非依赖基类中找不到名称，并且还有依赖基类。

想象一下如果我们`h`在上面定义的`A`类模板中有一个成员函数会发生什么

```
void h() {
  typename A<T>::questionable_type x;
} 
```

在 C++03 中，该语言允许捕获此错误，因为永远不会有有效的方法来实例化`A<T>::h`（无论您给出什么参数`T`）。在 C++11 中，该语言现在有进一步的检查，以便为编译器提供更多实现此规则的理由。由于`A`没有依赖的基类，并且`A`没有声明 member `questionable_type`，因此该名称`A<T>::questionable_type`既不*是*当前实例化的成员，*也不是*未知专业的成员。在这种情况下，该代码应该无法在实例化时有效编译，因此该语言禁止限定符是当前实例化的名称既不是未知特化的成员也不是当前实例化的成员（但是，这种违规仍然不需要诊断）。

### 例子和琐事

[您可以在此答案](https://stackoverflow.com/a/14005063/34509)上尝试此知识，并查看上述定义在实际示例中是否对您有意义（在该答案中重复的细节略少）。

C++11 规则使以下有效的 C++03 代码格式错误（这不是 C++ 委员会的意图，但可能不会被修复）

```
struct B { void f(); };
struct A : virtual B { void f(); };

template<typename T>
struct C : virtual B, T {
  void g() { this->f(); }
};

int main() { 
  C<A> c; c.g(); 
} 
```

这个有效的 C++03 代码将在实例化时绑定`this->f`，`A::f`一切都很好。然而，C++11 立即将其绑定到`B::f`并在实例化时需要仔细检查，检查查找是否仍然匹配。然而，当实例化时`C<A>::g`，[Dominance Rule](http://en.wikipedia.org/wiki/Dominance_(C%2B%2B))适用并且查找会`A::f`代替。

* * *

## 回答 #3

> 赞同：119
> 
> 时间：2014-06-07T20:28:32.803

> **前言**
> 
> 这篇文章旨在成为[litb 文章的](https://stackoverflow.com/questions/610245/where-and-why-do-i-have-to-put-the-template-and-typename-keywords/17579889#17579889)*易于阅读*的替代品。

> 根本目的是相同的；对“什么时候？”的解释 “为什么？” `typename`并且`template`必须应用。

* * *

# `typename`和的目的是`template`什么？

`typename`并且`template`在声明模板时以外的情况下可用。

在*C++*中的某些上下文中，必须明确告诉编译器如何处理名称，所有这些上下文都有一个共同点；它们至少依赖于一个*template-parameter*。

我们将此类名称称为解释中可能存在歧义的名称，例如：“*从属名称*”。

这篇文章将解释*dependent-names*和两个关键字之间的关系。

* * *

## 一个片段说超过 1000 个单词

尝试向您自己、朋友或您的猫解释以下*函数模板中发生的事情；**标记为 ( A* )的语句中发生了什么？

```
template<class T> void f_tmpl () { T::foo * x; /* <-- (A) */ } 
```

它可能不像人们想象的那么容易，更具体地说，评估 ( *A* ) 的结果很大程度上*取决于*作为模板参数传递的类型的定义`T`。

不同`T`的 s 可以极大地改变所涉及的语义。

```
struct X { typedef int       foo;       }; /* (C) --> */ f_tmpl<X> ();
struct Y { static  int const foo = 123; }; /* (D) --> */ f_tmpl<Y> (); 
```

**两种不同的场景**：

*   如果我们用类型*X*实例化函数模板，如在 ( *C* ) 中，我们将声明一个名为*x的**指向 int 的指针*，但是；

**   *如果我们用类型Y*实例化模板，如 ( *D* )，则 ( *A* ) 将由一个表达式组成，该表达式计算*123*乘以某个已声明的变量*x*的乘积。* 

 ** * *

## 基本原理

C++ 标准关心我们的安全和幸福，至少在这种情况下是这样。

为了防止实现可能遭受令人讨厌的意外，标准要求我们通过在我们希望将名称视为*类型名称*或*模板的任何地方**明确说明意图来解决**依赖名称*的歧义。*身份证*。

 ***如果没有说明，则*从属名称*将被视为变量或函数。

* * *

## 如何处理依赖名称？

如果这是一部好莱坞电影，*从属名字*将是通过身体接触传播的疾病，立即影响其宿主使其混乱。可能会导致不正确的人，erhm..程序的混乱。

*从属名称*是直接或间接依赖于*模板参数*的**任何**名称。

 *```
template<class T> void g_tmpl () {
   SomeTrait<T>::type                   foo; // (E), ill-formed
   SomeTrait<T>::NestedTrait<int>::type bar; // (F), ill-formed
   foo.data<int> ();                         // (G), ill-formed    
} 
```

我们在上面的代码片段中有四个*从属*名称：

*   **E** )
    *   **“类型”**取决于 的实例化`SomeTrait<T>`，其中包括`T`和；
*   **F** )
    *   **"NestedTrait"**是一个*template-id*，取决于`SomeTrait<T>`, 和;
    *   ***( F* )末尾的**“类型”**取决于*NestedTrait*，它取决于`SomeTrait<T>`, 和；**

***   **G** )
    *   **"data"**看起来像一个*成员函数模板*，间接地是一个*从属名称*，因为*foo*的类型取决于`SomeTrait<T>`.**

 **如果编译器将*依赖名称*解释为变量/函数，则语句 ( *E* )、( *F* ) 或 ( *G* ) 均无效（如前所述，如果我们没有明确说明会发生这种情况）。

 *### 解决方案

为了`g_tmpl`有一个有效的定义，我们必须明确地告诉编译器我们期望一个类型在（*E*）中，一个*模板ID*和一个*类型*在（*F*）中，一个*模板ID*在（*G*）中。

```
template<class T> void g_tmpl () {
   typename SomeTrait<T>::type foo;                            // (G), legal
   typename SomeTrait<T>::template NestedTrait<int>::type bar; // (H), legal
   foo.template data<int> ();                                  // (I), legal
} 
```

每次*名称*表示类型时，**所有涉及的** *名称*都必须是*类型名称*或*名称空间*，考虑到这一点，很容易看出我们在完全*限定名称*`typename`的开头应用。

 *`template`然而，在这方面是不同的，因为没有办法得出这样的结论；*“哦，这是一个模板，那么这个其他的东西也必须是一个模板”*。这意味着我们直接在我们想要处理的任何*名称*`template`前面应用。

 ** * *

## 我可以将*关键字*放在任何名称的前面吗？

> “*我可以坚持在任何名字`typename`前面`template`吗？我不想担心它们出现的上下文......* ” -`Some C++ Developer`

标准中的规则规定，只要您处理*限定名称*( *K* )，您就可以应用关键字，但如果名称不*限定*，则应用程序格式错误 ( *L* )。

```
namespace N {
  template<class T>
  struct X { };
} 
```

```
 N::         X<int> a; // ...  legal
typename N::template X<int> b; // (K), legal
typename template    X<int> c; // (L), ill-formed 
```

^(**注意**：应用`typename`或`template`在不需要的情况下不被视为良好做法；仅仅因为您可以做某事，并不意味着您应该做某事。)

此外，在某些情况下`typename`和`template`被**明确**禁止：

*   **指定类继承的基时**

    写在派生类的*base-specifier-list*中的每个名称都已被视为*type-name*，显式指定`typename`既不正确，又是多余的。

    ```
     // .------- the base-specifier-list
      template<class T> // v
      struct Derived      : typename SomeTrait<T>::type /* <- ill-formed */ {
        ...
      }; 
    ```

*   **当*模板 ID*是派生类的*using 指令中引用的模板 ID 时***

    ```
     struct Base {
        template<class T>
        struct type { };
      };

      struct Derived : Base {
        using Base::template type; // ill-formed
        using Base::type;          // legal
      }; 
    ```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2014-06-06T22:23:21.637

[*该答案旨在回答（部分）标题问题的简短而甜蜜的答案。如果您想要更详细的答案来解释为什么必须将它们放在那里，请转到[此处](https://stackoverflow.com/a/613132/1381108)。*]

* * *

放置`typename`关键字的一般规则主要是当您使用模板参数并且想要访问嵌套`typedef`或使用别名时，例如：

```
template<typename T>
struct test {
    using type = T; // no typename required
    using underlying_type = typename T::type // typename required
}; 
```

请注意，这也适用于元函数或采用通用模板参数的东西。但是，如果提供的模板参数是显式类型，则不必指定`typename`，例如：

```
template<typename T>
struct test {
    // typename required
    using type = typename std::conditional<true, const T&, T&&>::type;
    // no typename required
    using integer = std::conditional<true, int, float>::type;
}; 
```

添加限定符的一般规则`template`大多相似，除了它们通常涉及本身模板化的结构/类的模板化成员函数（静态或其他），例如：

鉴于此结构和功能：

```
template<typename T>
struct test {
    template<typename U>
    void get() const {
        std::cout << "get\n";
    }
};

template<typename T>
void func(const test<T>& t) {
    t.get<int>(); // error
} 
```

尝试`t.get<int>()`从函数内部访问将导致错误：

```
main.cpp:13:11: error: expected primary-expression before 'int'
     t.get<int>();
           ^
main.cpp:13:11: error: expected ';' before 'int' 
```

因此，在这种情况下，您需要`template`事先使用关键字并像这样调用它：

`t.template get<int>()`

这样编译器将正确解析它而不是`t.get < int`.

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-03-04T13:37:47.963

```
typedef typename Tail::inUnion<U> dummy; 
```

但是，我不确定您对 inUnion 的实施是否正确。如果我理解正确，这个类不应该被实例化，因此“失败”选项卡永远不会失败。也许最好用一个简单的布尔值来指示类型是否在联合中。

```
template <typename T, typename TypeList> struct Contains;

template <typename T, typename Head, typename Tail>
struct Contains<T, UnionNode<Head, Tail> >
{
    enum { result = Contains<T, Tail>::result };
};

template <typename T, typename Tail>
struct Contains<T, UnionNode<T, Tail> >
{
    enum { result = true };
};

template <typename T>
struct Contains<T, void>
{
    enum { result = false };
}; 
```

PS：看看[Boost::Variant](http://www.boost.org/doc/libs/1_38_0/doc/html/variant.html)

PS2：看看[typelists](http://www.ddj.com/cpp/184403813)，尤其是在 Andrei Alexandrescu 的书：Modern C++ Design

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2021-04-25T07:23:32.900

## C++20 又名 C++2a

如本[提案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0634r3.html)所述，C++20 / C++2a 进一步放宽了对`typename`关键字的要求。特别是，`typename`现在可以在所有那些地方省略，在语法上只有一个类型是合法的。因此，如果未知标记必须是类型，C++20 实际上会将其视为类型。不过，为了向后兼容，`typename`可能仍会使用。

特别是，大多数`using`和`typedef`声明现在可以不用`typename`. `typename`也可以在方法返回类型（包括尾随返回类型）的声明、方法和 lambda 参数的声明以及 、 和 的类型参数中`static_cast`省略。`const_cast``dynamic_cast``reinterpret_cast`

一个值得注意的例外，`typename`仍然需要，是在用户或库定义模板的实例化参数列表中：即使该特定参数被声明为类型，`typename`关键字仍然是必需的。所以`static_cast<A::B>(arg)`在 C++20 中是合法的，但是`my_template_class<A::B>(arg)`如果 A 是一个依赖范围并且`my_template_class`需要一个类型，那么它的格式不正确。

几个例子：

```
class A { public: typedef int type; static const int val { 1 }; };
class B { public: typedef float type; static const int val { 2 }; };
template<typename T> class C {};
template<int I> class D {};
template<typename T> class X {
    T::type v;                                  // OK
    T::type f(T::type arg) { return arg; }      // OK
    T::type g(double arg) { return static_cast<T::type>(arg); } // OK
    // C<T::type> c1;                           // error
    D<T::val> d;                                // OK (as has always been)
    C<typename T::type> c2;                     // OK (old style)
    typedef T::type mytype;                     // OK
    using mytypeagain = T::type;                // OK
    C<mytype> c3;                               // OK (via typedef / using)
};
X<A> xa;
X<B> xb; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-08-11T12:20:50.773

我将 JLBorges 对来自 cplusplus.com 的类似问题逐字逐句地给出了出色的[回答](http://www.cplusplus.com/forum/general/122765/#msg669061)，因为这是我读过的关于该主题的最简洁的解释。

> 在我们编写的模板中，可以使用两种名称——从属名称和非从属名称。依赖名称是依赖于模板参数的名称；无论模板参数是什么，非依赖名称都具有相同的含义。
> 
> 例如：
> 
> ```
> template< typename T > void foo( T& x, std::string str, int count )
> {
>     // these names are looked up during the second phase
>     // when foo is instantiated and the type T is known
>     x.size(); // dependant name (non-type)
>     T::instance_count ; // dependant name (non-type)
>     typename T::iterator i ; // dependant name (type)
>       
>     // during the first phase, 
>     // T::instance_count is treated as a non-type (this is the default)
>     // the typename keyword specifies that T::iterator is to be treated as a type.
> 
>     // these names are looked up during the first phase
>     std::string::size_type s ; // non-dependant name (type)
>     std::string::npos ; // non-dependant name (non-type)
>     str.empty() ; // non-dependant name (non-type)
>     count ; // non-dependant name (non-type)
> } 
> ```
> 
> 对于模板的每个不同实例化，从属名称所指的内容可能有所不同。因此，C++ 模板受制于“两阶段名称查找”。当最初解析模板时（在任何实例化发生之前），编译器会查找非依赖名称。当模板的特定实例化发生时，模板参数是已知的，编译器会查找相关名称。
> 
> 在第一阶段，解析器需要知道依赖名称是类型的名称还是非类型的名称。默认情况下，从属名称假定为非类型的名称。从属名称之前的 typename 关键字指定它是类型的名称。

* * *

**概括**

仅在模板声明和定义中使用关键字 typename，前提是您具有引用类型并依赖于模板参数的限定名称。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-05-15T00:07:02.690

依赖名称是依赖于模板参数的名称，我们需要指示编译器以便在实际启动它们之前正确编译模板类/函数。

*   typename -> 告诉编译器依赖的名字是一个实际的类型

    ```
    template <class T>
    struct DependentType
    {
      typename T::type a;
      using Type=typename T::type;
    }; 
    ```

*   template -> 告诉编译器依赖的名字是一个模板函数/类

    ```
    template <class T>
    struct DependentTemplate
    {
      // template function
      template <class U>
      static void func() {}

      // template class
      template <class U>
      struct ClassName{};
    };

    template <class T1, class T2>
    void foo()
    {
      // 3 ways to call a dependent template function
      DependentTemplate<T1>::template func<T2>();
      DependentTemplate<T1>().template func<T2>();
      (new DependentTemplate<T1>())->template func<T2>();

      // You need both typename and template to reference a dependent template class
      typename DependentTemplate<T1>::template ClassName<T2> obj;
      using Type=typename DependentTemplate<T1>::template ClassName<T2>;
    } 
    ```

# c# - 实例化“AS”关键字

> ID：610253
> 
> 赞同：2
> 
> 时间：2009-03-04T11:59:04.020
> 
> 标签：c#, json, keyword, boxing, unboxing

我最近开始使用 JSON 和 ExtJs 框架，并且在示例中遇到了以下代码。

我们使用以下方法从前端检索信息：

```
object updatedConfig = JavaScriptConvert.DeserializeObject(Request["dataForm"]); 
```

然后在示例中，他们执行以下操作：

```
JavaScriptObject jsObj = updatedConfig as JavaScriptObject; 
```

我以前从未见过像这样使用“as”关键字。这只是将 updatedConfig 变量显式装箱为 JavaScriptObject 的另一种形式，还是我对此不了解？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T12:02:41.887

这被称为安全演员表。它的作用是尝试从一种类型转换为另一种类型，如果转换失败，它会返回`null`而不是抛出`InvalidCastException`.

实际上有两个单独的 IL 指令来处理 " `as`" 强制转换和普通静态强制转换之间的差异。以下 C# 代码包含两种类型的转换：

```
using System;

class Program
{
    static void Main()
    {
        Object o = null;

        String s0 = (String)o;
        String s1 = o as String;
    }
} 
```

第一次转换使用`castclass`IL 指令，第二次转换使用`isinst`指令。

有关更详细的说明，请参阅[CLR 中的 Casting vs using the 'as' 关键字。](https://stackoverflow.com/questions/496096/casting-vs-using-the-as-keyword-in-the-clr)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T12:02:34.853

[as 关键字](http://msdn.microsoft.com/en-us/library/cscsdfbt(VS.71).aspx)是在 C# 中转换对象的一种更安全的方法。

```
SomeType a = obj as SomeType; 
```

意味着 if`obj`是 type `SomeType`，`obj`将被强制转换为该类型。如果`obj`为 null 或不是 type `SomeType`，则 a 将为 null。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T12:18:18.747

as 关键字的另一个优点是，如果无法转换类型，它将引发编译时异常，而 as (cast) 直到运行时才会中断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T12:56:24.083

此外，重要的是要记住“as”在引用中而不是在对象本身中运行。这就是为什么它可以返回 null 而不是抛出异常，因为对象将保持不变。这就是为什么您只能在引用类型上执行此操作。

通常没那么重要，但是如果你实现了一个强制转换函数（就像[MSDN](http://msdn.microsoft.com/en-us/library/xhbhezf4.aspx)中的这里），它*不会*被 as 操作符调用。

所以，as 操作符对于“上下移动继承层次”很有用：如果你有一个 Person 类，你可以这样做： Person p = new Person(); ojbect o = p 作为对象；p = o 作为人；但在所有情况下，内存中的对象都不会以任何方式被修改，只是对它的引用。

希望有帮助

# wpf - 如何向 XAML 窗口添加多个资源？

> ID：610259
> 
> 赞同：21
> 
> 时间：2009-03-04T12:00:44.203
> 
> 标签：wpf, xaml, resources

我现在有一个小问题，我不知道如何解决它。我想向一个窗口添加两个资源。一个是 XAML 文件样式资源，另一个是 ValueConverter 类。

如果我一次只使用一种资源，它们都可以工作：

```
 <Window.Resources>
    <ResourceDictionary Source="Resources\MyStyles.xaml" />
 <Window.Resources> 
```

或者

```
<Window.Resources>
    <local:MarginConverter x:Key="adjustMargin"/>
</Window.Resources> 
```

但如果我尝试这样的事情：

```
<Window.Resources>
    <local:MarginConverter x:Key="adjustMargin"/>
    <ResourceDictionary Source="Resources\MyStyles.xaml" />
</Window.Resources> 
```

我收到消息资源已设置，无法设置两次。

我不知道如何完成这项工作。有没有类似资源组的东西？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-04T12:09:56.113

```
<Window.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="Resources\MyStyles.xaml" />
        </ResourceDictionary.MergedDictionaries>

        <local:MarginConverter x:Key="adjustMargin"/>
    </ResourceDictionary>
</Window.Resources> 
```

# c++ - 使用 win32 API 在 C++ 文件中查找和替换字符串标记

> ID：610269
> 
> 赞同：2
> 
> 时间：2009-03-04T12:04:41.773
> 
> 标签：c++, winapi, string

我正在尝试找到一种方法，用另一个字符串替换文件中字符串标记的所有实例。

如何使用 win32 API 在 C++ 中执行此操作？

在其他语言中，这很容易做到，但在 C++ 中，我只是迷路了。

编辑：在某些情况下，这是针对 WiX 自定义操作。所以可移植性不是主要优先事项，只是最简单的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T12:09:43.463

如果文件适合内存 - 它更简单。调用 OpenFile() 打开文件，调用 GetFileSize() 确定文件大小，分配足够的内存，调用 ReadFile() 读取文件，然后调用 CloseFile。在内存中进行替换（使用 strstr() 或类似函数），然后再次使用 OpenFile()、WriteFile()、CloseFile()。

如果文件很大 - 创建一个临时文件并分块读取源文件并将过滤后的文本写入临时文件，然后调用 DeleteFile() 删除原始文件并调用 MoveFile() 移动过滤后的文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T12:10:08.657

您可以使用[Boost.Regex](http://www.boost.org/doc/libs/1_38_0/libs/regex/doc/html/index.html)库，它应该类似于您在其他平台上找到的大多数功能。

它会像这样工作：

在此[示例](http://flavio.castelli.name/regexp-with-boost)中，您将了解如何替换匹配模式的字符串。

```
#include <boost/regex.hpp>
#include <string>

int main()
{
    boost::regex pattern ("b.lug",boost::regex_constants::icase|boost::regex_constants::perl);
    std::string stringa ("Searching for bolug");
    std::string replace ("BgLug");
    std::string newString;

    newString = boost::regex_replace (stringa, pattern, replace);

    printf("The new string is: |%s|\n",newString.c_str());

    return 0;
} 
```

但是您当然必须添加文件读/写。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T13:00:51.560

根据Sharptooth的解决方案，我敲了一些C代码来对文件进行查找和替换。我使用 stdio 调用（strlen、strstr、strcpy 和 strcat）来进行字符串操作（而不是 win32 调用），所以你唯一的依赖是 C 运行时间。

这当然不是我在生产系统中使用的代码。我会使用工具包字符串操作库中的东西来使这个更干净（而不是使用固定长度的缓冲区）。我可能不会使用 boost，我不喜欢开销。但是我想您可能会喜欢一个仅包含基础知识的示例（注意，这会将更改的缓冲区写入 .temp）。

```
#include <stdio.h>

#define BUF_LEN 2048

int findAndReplace (const char * file, const char * find, const char * replace)
{
    int replaceCount = 0;
    FILE * f = fopen (file, "rt");

    if (strstr(replace, find))
        return 0; // replacing blah with stuff_blah_stuff

    unsigned int findLen = strlen (find);
    char tempFile [BUF_LEN];
    strcpy (tempFile, file);
    strcat (tempFile, ".temp");
    FILE * writeF = fopen (tempFile, "wt");

    if (!f || !writeF)
        return 0;

    printf ("Processing %s - %s to %s\n", file, find, replace);

    char lineBuf [BUF_LEN];
    memset (lineBuf, 0, BUF_LEN);
    char tempLineBuf [BUF_LEN];
    memset (tempLineBuf, 0, BUF_LEN);

    // read each line of the file
    while (fgets (lineBuf, BUF_LEN, f))
    {
        // get the position of find in the line buffer
        char * pos = strstr (lineBuf, find);
        while (pos)
        {
            strncpy (tempLineBuf, lineBuf, pos - lineBuf);
            strcat (tempLineBuf, replace);
            strcat (tempLineBuf, pos + findLen);
            replaceCount++;

            // replace the current buf with the replaced buffer
            strncpy (lineBuf, tempLineBuf, BUF_LEN);
            memset (tempLineBuf, 0, BUF_LEN);

            pos = strstr (lineBuf, find);
        }

        printf ("writing new line %s\n", lineBuf);
        fputs (lineBuf, writeF);
    }

    fclose (f);
    fclose (writeF);

    return replaceCount;
}

int main ()
{
    printf ("Made %d replacements\n", findAndReplace ("blah.txt", "marker", "testing_blah"));
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T12:50:48.653

为什么必须使用 Win32 API？使用直接 C++ 很容易，我不会通过添加人为约束来混淆这个问题。只需打开您的输入文件，打开一个输出文件，然后从您的输入中读取一行。虽然您没有在输入文件中点击 EOF，但请使用正则表达式来查找您的令牌。如果找到它，请将其替换为您的文本。将该行写入输出文件。从输入中读取另一行。当您在输入上获得 EOF 时，将其关闭。确保任何挂起的输出都从输出缓冲区中刷新。关闭输出文件。完毕。

# macos - 在 Mac 上编程时，您是否使用原始（德语）苹果键盘/键盘布局？

> ID：610270
> 
> 赞同：5
> 
> 时间：2009-03-04T12:05:01.587
> 
> 标签：macos

我是一名程序员，使用不同的语言/格式（Java、Python、XML、HTML、Objective-C 等）。有时我必须在 Mac 上工作，而且我对用于编程的德语键盘布局不太满意。

有没有人有同样的问题，如果有，你是怎么解决的？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2018-06-10T16:29:00.217

**[EurKEY](https://eurkey.steffen.bruentjen.eu)**具有美国标准布局（非常适合编程）的所有优点，并结合了访问大多数西欧字符的简便方法。例如，您会得到带有 + 的德语 ö`AltGr`，+`o`的 ß。`AltGr``s`

它适用于 Linux、Mac 和 Windows，并且是免费的。较新的 Linux 发行版已经包含它（xkeyboard-config 2.12）。

[![EurKEY 布局](https://i.stack.imgur.com/V0Ehr.png)](https://i.stack.imgur.com/V0Ehr.png)

请注意，我是 EurKEY 的作者。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T12:08:02.140

我最近在英国实习，并利用这个机会切换到英文键盘布局。切换几乎完全简单，我可以衷心推荐它，特别是因为您仍然可以在英语键盘布局上很好地键入德语变音符号（Alt+u，然后 a/o/u 键入相应的变音符号；Alt+s 键入“ ß”）。

用于编程的键更容易获得，尤其是“<code>[]”和“<code>{}”（它们都在“<code>ü”和“<code>+”上）。此外，“<code>/”和“<code>\”的位置更好。我唯一**讨厌**的是“<code>+”键的位置，因为它需要shift键！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T13:05:48.413

相关悲伤故事：我经常对键盘布局不满意（尤其是 CapsLock、Ctrl、Apple 键上的位置，这在 Mac 和 Dell 上是不同的，我必须同时使用），但我发现我绝对无法处理 (软件）键盘布局与实际硬件键帽上打印的内容不对应。

我想我可以处理一个没有任何键帽的键盘，但是一旦他们不说他们做了什么，我就会非常意识到我的打字并且完全搞砸了。

由于没有使用真正的程序员友好型 USB 键盘，我被操作系统/硬件供应商认为对我有益的东西所困。

**更新：**坐在我面前办公桌前的那个人用星条旗盖住了他的键盘，正在*打字*……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T14:02:19.770

[您可以从http://www.daskeyboard.com](http://www.daskeyboard.com)获得空白键盘

我已经关注了一段时间了。

# c# - WPF 框架元素

> ID：610271
> 
> 赞同：0
> 
> 时间：2009-03-04T12:05:32.350
> 
> 标签：c#, .net, wpf, frameworkelement

我是 WPF 编程模型的新手。我有几个疑问：

1.  XAML（在 XBAP 应用程序中）中的 Page 标记是否属于 类型`FrameworkElement`？

2.  如果我有一个子元素，可以说页面内的框架。我在另一个程序集中的函数中传递了该框架元素。现在我尝试从 Frame 控件的 Parent 属性导航回 Page 我无法获得对 Page 的引用？有什么想法吗？

* * *

我在另一个程序集中使用的函数来获取子控件的父页面

```
Page getTopParent(FrameworkElement f) 
{ 
    FrameworkElement ct = f; 

    while (true) 
    { 
        if (ct is Page) 
        { 
            break; 
        } 

        ct = (FrameworkElement)
        ct.Parent; 
    } 
    return ct as Page; 
} 
```

* * *

```
Please find example XAML 
```

</DataTrigger> </DataTemplate.Triggers>-->

```
 </TabControl.ItemTemplate>
        <TabControl.ContentTemplate>
            <DataTemplate>
                <StackPanel HorizontalAlignment="Left">
                    <Frame Name="tabContent" Height="520" Width="820" local:WebBrowserBehavior.Source="{Binding Path=CurrentPage}" ContentRendered="tabItem_contentRendered"/>
                </StackPanel>
            </DataTemplate>
        </TabControl.ContentTemplate>
    </TabControl>
    <StackPanel Orientation="Horizontal" Name="taskBar" Height="34" VerticalAlignment="Bottom">
        <Button Height="23" Name="helpButton" Width="43" Content="Help" Click="helpButton_Click"/>
    </StackPanel>
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T12:17:14.210

1.  是的，[`Page`](http://msdn.microsoft.com/en-us/library/system.windows.controls.page.aspx)继承自`FrameworkElement`.
2.  有时上树并不像简单地检查父级那样容易，尤其是在您使用模板的情况下。如果您使用的是模板，则需要使用该`Parent`属性向上爬树，直到它为空。然后，使用该[`TemplatedParent`](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.templatedparent.aspx)属性。您可以使用两者的组合来向上走逻辑树。话虽如此，WPF 为这种场景提供了帮助方法。退房[`LogicalTreeHelper.GetParent`](http://msdn.microsoft.com/en-us/library/system.windows.logicaltreehelper.getparent.aspx)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-04T12:16:41.357

1.  是的，就像 XAML 中的其他所有内容一样。去[这里](http://msdn.microsoft.com/en-us/library/system.windows.controls.page.aspx)查看官方文档。

# c# - 如何在运行时创建 WPF 对话框？

> ID：610289
> 
> 赞同：0
> 
> 时间：2009-03-04T12:11:24.753
> 
> 标签：c#, .net, wpf

我当前的项目在运行时通过 WPF 创建 UI。一切正常。唯一的问题是全局 WPF 模板由于某种原因被忽略。

我们创建了一个附加到主窗体的皮肤，因此被所有 xaml 创建的 UI 元素使用。

我自己的代码只是动态创建这样的项目：

```
var textBox = new TextBox();
parentControl.Controls.Add(textBox); 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T12:37:24.067

如果您的皮肤被添加到主窗口的资源字典中，子窗口将无法看到这些皮肤。您需要将皮肤移动到 App.xaml。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T12:19:21.553

我假设您的意思是某些东西的外观和感觉被忽略了。你可以再详细一点吗？

通常，如果元素的默认样式/模板被“忽略”，则意味着您正在做一些事情来覆盖默认值。

# c# - 如何从 web.sitemap 和 Telerik 菜单中将字符串替换为资源文件以在 asp.net(c#) 中支持多语言

> ID：610293
> 
> 赞同：-4
> 
> 时间：2009-03-04T12:15:16.367
> 
> 标签：c#, asp.net

我的 web.sitemap 是

```
<?xml version="1.0" encoding="utf-8" ?>
<siteMap  xmlns="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0"  >
  <siteMapNode url="~/Index.aspx?id=Home" title="Dashboard" description="">
    <!-- Catalog Management-->
    <siteMapNode url="~/Index.aspx?id=CategoryHome&amp;category=CatalogManagement" title="Catalog Management" description="">
      <siteMapNode url="~/Index.aspx?id=ProductManager" title="Products" description="">
        <siteMapNode url="~/Index.aspx?id=EditProduct" title="Add Product" description="" />
      </siteMapNode>
      <siteMapNode url="~/Index.aspx?id=Attributes" title="Variations" description="">
        <siteMapNode url="~/Index.aspx?id=AddEditVariation" title="Add/Edit Variations" description="" />
      </siteMapNode>
      <siteMapNode url="~/Index.aspx?id=GiftCertificateManager" title="Generate Gift Cards" description="" />
      <siteMapNode url="~/Index.aspx?id=DepartmentManager" title="Departments" description="">
        <siteMapNode url="~/Index.aspx?id=AddEditDepartment" title="Add/Edit Department" description=""/>
      </siteMapNode>
      <siteMapNode url="~/Index.aspx?id=ManufacturerManager" title="Manufacturers" description="" >
        <siteMapNode url="~/Index.aspx?id=AddEditManufacturer" title="Add Manufacturer" description="" />
      </siteMapNode>
      <siteMapNode url="~/Index.aspx?id=WarehouseManager" title="Warehouses" description="">
        <siteMapNode url="~/Index.aspx?id=EditWarehouse" title="Add Warehouse" description="" />
      </siteMapNode>
    </siteMapNode> 
```

Telerik 菜单还有一个 XML

```
<?xml version="1.0" encoding="utf-8" ?>
<PanelItems>
  <PanelItem Text="Dashboard" NavigateUrl="../Index.aspx?id=Home"></PanelItem>
  <PanelItem Text="Catalog Management" NavigateUrl="../Index.aspx?id=CategoryHome&amp;category=CatalogManagement">                  <!--  -->
    <PanelItem Text="Products" NavigateUrl="../Index.aspx?id=ProductManager"/>                          <!-- Product Manager -->
    <PanelItem Text="Variations" NavigateUrl="../Index.aspx?id=Attributes"/>
    <PanelItem Text="Generate Gift Cards" NavigateUrl="../Index.aspx?id=GiftCertificateManager"/>       <!-- Gift Certificate Manager -->
    <PanelItem Text="Departments" NavigateUrl="../Index.aspx?id=DepartmentManager"/>                    <!-- Department Manager -->
    <PanelItem Text="Manufacturers" NavigateUrl="../Index.aspx?id=ManufacturerManager"/>                <!-- Manufacturer Manager -->
    <PanelItem Text="Warehouses" NavigateUrl="../Index.aspx?id=WarehouseManager"/>                      <!-- Warehouse Manager -->
  </PanelItem>
  <PanelItem Text="Customer Management" NavigateUrl="../Index.aspx?id=CategoryHome&amp;category=CustomerManagement">                <!--  -->
    <PanelItem Text="Customers" NavigateUrl="../Index.aspx?id=CustomerManager" />
    <PanelItem Text="Export Subscribers" NavigateUrl="../Index.aspx?id=ExportSubscriptions"/>           <!-- Export Subscribers -->
  </PanelItem>
  <PanelItem Text="Order Management" NavigateUrl="../Index.aspx?id=CategoryHome&amp;category=OrderManagement">                      <!--  -->
    <PanelItem Text="Orders" NavigateUrl="../Index.aspx?id=FindOrders" />                               <!-- Find Orders -->
    <PanelItem Text="Shopping Carts" NavigateUrl="../Index.aspx?id=CartView"/>                          <!-- View Cart -->
    <PanelItem Text="Wish Lists" NavigateUrl="../Index.aspx?id=ViewWishList"/>                          <!-- View Wish List -->
  </PanelItem> 
```

还有一个问题是我正在为 5 个菜单使用 5 个资源文件

如何将 XML 转换为资源

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T04:11:42.040

我不知道我是否完全理解这个问题。如果您想使用这些 XML，而不是将它们与您的应用程序一起部署以将它们作为程序集中的资源，那么您需要执行以下操作：

*   在解决方案资源管理器中选择文件
*   打开属性窗口 (F4)
*   在构建操作中设置嵌入式资源

现在，您的 XML 作为资源嵌入到您的程序集中。现在的问题是如何访问它。为此，请使用以下代码：

```
Assembly assembly = Assembly.GetExecutingAssembly();
Stream stream = assembly.GetManifestResourceStream("<default namespace.>MyFile.xml");
StreamReader streamReader = new StreamReader(stream);
// now process the stream the way you want -- for example streamReader.ReadToEnd() to get it as a text 
```

有一篇很好的 CodeProject 文章，叫做[Embedded resources](http://www.codeproject.com/KB/dotnet/embeddedresources.aspx)。

# c# - 从 C# 中的另一个窗体监听主窗体中的事件

> ID：610313
> 
> 赞同：2
> 
> 时间：2009-03-04T12:22:24.867
> 
> 标签：c#, .net, winforms, event-handling

我有一个具有主窗体并使用事件处理程序来处理传入数据并反映主窗体上各种控件的更改的应用程序。这工作正常。

我在申请中还有另一个表格。在任何给定时间都可以运行第二种形式的多个实例。

我想做的是让第二个表单的每个实例在主表单中监听事件处理程序，并更新其第二个表单实例上的控件。

我该怎么做？

这是一些示例代码。我想从 the_timer_Tick 事件处理程序中获取信息来更新 SecondaryForm 的每个实例。

```
public partial class Form1 : Form
{
    Timer the_timer = new Timer();
    public Form1()
    {
        InitializeComponent();
    }

    private void button1_Click(object sender, EventArgs e)
    {
        the_timer.Tick += new EventHandler(the_timer_Tick);
        the_timer.Interval = 2000;
        the_timer.Enabled = true;
    }

    void the_timer_Tick(object sender, EventArgs e)
    {
        // I would like code in here to update all instances of SecondaryForm
        // that happen to be open now.
        MessageBox.Show("Timer ticked");
    }

    private void stop_timer_button_Click(object sender, EventArgs e)
    {
        the_timer.Enabled = false;
    }

    private void start_form_button_Click(object sender, EventArgs e)
    {
        SecondaryForm new_form = new SecondaryForm();
        new_form.Show();
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T12:26:30.130

```
class SecondForm
{
  private FirstForm firstForm;

  public SecondForm()
  {
    InitializeComponent();
    // this means unregistering on form closing, uncomment if is necessary (anonymous delegate)
    //this.Form_Closing += delegate { firstForm.SomeEvent -= SecondForm_SomeMethod; };
  }

  public SecondaryForm(FirstForm form) : this()
  {
    this.firstForm = form; 
    firstForm.Timer.Tick += new EventHandler(Timer_Tick);
  }

  // make it public in case of external event handlers registration
  private void Timer_Tick(object sender, EventArgs e)
  {
    // now you can access firstForm or it's timer here
  }
}

class FirstForm
{
  public Timer Timer
  {
    get
    {
      return this.the_timerl
    }
  }

  public FirstForm()
  {
    InitializeComponent();
  }

  private void Button_Click(object sender, EventArgs e)
  {
    new SecondForm(this).ShowDialog(); // in case of internal event handlers registration (in constructor)
    // or
    SecondForm secondForm = new SecondForm(this);
    the_timer.Tick += new EventHandler(secondForm.Timer_tick); // that method must be public
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T13:22:50.683

考虑使用松散耦合的事件。这将允许您以这样一种方式耦合类，使它们不必直接相互了解。Unity 应用程序块带有一个名为[EventBroker](http://msdn.microsoft.com/en-us/library/ff650784.aspx)的扩展，它使这变得非常简单。

这里有一点糖：

```
public static class EVENTS
{
    public const string UPDATE_TICKED = "event://Form1/Ticked";
}

public partial class Form1 : Form
{
    [Publishes(EVENTS.UPDATE_TICKED)]
    public event EventHandler Ticked; 

    void the_timer_Tick(object sender, EventArgs e)
    {
        // I would like code in here to update all instances of SecondaryForm
        // that happen to be open now.
        MessageBox.Show("Timer ticked");
        OnTicked();
    }

    protected virtual void OnTicked()
    {
        if (Ticked == null) return;
        Ticked(this, e);
    }
}

public partial class SecondaryForm : Form
{
    [SubscribesTo(EVENTS.UPDATE_TICKED)]
    private void Form1_Ticked(object sender, EventHandler e)
    {
        // code to handle tick in SecondaryForm
    }
} 
```

现在，如果您使用 Unity 构建这两个类，它们将自动连接在一起。

**更新**

较新的解决方案使用消息总线来处理松散耦合的事件。请参阅[http://masstransit-project.com/](http://masstransit-project.com/)或[http://nimbusapi.github.io/](http://nimbusapi.github.io/)作为示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T12:28:12.153

我想你可以让 SecondaryForm 在构造函数中接受父表单，并在构造函数中添加一个事件处理程序。

```
private void start_form_button_Click(object sender, EventArgs e)
{
    SecondaryForm new_form = new SecondaryForm(this);
    new_form.Show();
} 
```

在 SecondaryForm.cs 中：

```
public SecondaryForm(ISomeView parentView)
{
    parentView.SomeEvent += .....
} 
```

# java - JSP中将struts ognl值与scriptlet值进行比较

> ID：610320
> 
> 赞同：1
> 
> 时间：2009-03-04T12:25:14.237
> 
> 标签：java, jsp, struts, ognl

我必须将其与如下值进行比较：

```
${page_id } ---- <% out.print(a); %>

<c:if test="${page_id != a}"> 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T20:59:10.070

假设“a”是一个 scriptlet 变量。El 表达式映射到范围内的页面/请求/会话/应用程序属性。

${page_id} 大约相当于 pageContext.findAttribute("page_id");

为了能够比较它们，你需要让它们进入同一个空间。一种方法是使用 scriptlet 代码：

```
<% pageContext.setAttribute("a", a); %> 
```

您现在应该能够将 ${a} 作为 EL 表达式进行访问。不是首选解决方案，因为它使用 scriptlet 代码（在 JSP 中要避免的事情）当然可能有更好的方法。这一切都取决于“a”的值首先来自哪里。

# java - 如何使用 Java 的 String.replaceAll 方法替换加号

> ID：610333
> 
> 赞同：51
> 
> 时间：2009-03-04T12:29:46.910
> 
> 标签：java, regex

加号 (+) 作为`replaceAll`String 类中 Java 方法的第一个参数（即要替换的字符串）的正确正则表达式是什么？我无法正确使用语法。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-03-04T12:36:32.883

您需要转义`+`正则表达式，使用`\`.

但是，Java 使用 String 参数来构造正则表达式，该正则表达式`\`用于自己的转义序列。所以你必须逃避它`\`自己：

```
"\\+" 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-04T16:43:58.560

如有疑问，让 java 为您完成工作：

```
myStr.replaceAll(Pattern.quote("+"), replaceStr); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-04T12:35:18.907

您需要使用 \ 转义 +，并且因为 \ 本身是 Java 字符串中的特殊字符，您需要使用另一个 \ 对其进行转义。

因此，您的正则表达式字符串将在 Java 代码中定义为“\\+”。

即这个例子：

```
String test = "ABCD+EFGH";
test = test.replaceAll("\\+", "-");
System.out.println(test); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-19T09:47:55.157

其他人已经说明了正确的方法：

1.  转义`+`as`\\+`
2.  使用`Pattern.quote`转义所有正则表达式元字符的方法。

您可以使用的另一种方法是将 放在`+`字符类中。许多正则表达式元字符（`.`,`*`等`+`）在字符类中按字面意思处理。

所以你也可以这样做：

```
orgStr.replaceAll("[+]",replaceStr); 
```

[**Ideone 链接**](http://www.ideone.com/C5g4G)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-19T08:28:53.000

如果您想要一个简单的字符串查找和替换（即您不需要正则表达式），使用[来自 Apache Commons 的 StringUtils](http://commons.apache.org/lang/api/org/apache/commons/lang/StringUtils.html#replace(java.lang.String,%20java.lang.String,%20java.lang.String))可能更简单，这将允许您编写：

```
mystr = StringUtils.replace(mystr, "+", "plus"); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-11-28T16:34:45.797

假设您要替换`-`为`\\\-`，请使用：

```
 text.replaceAll("-", "\\\\\\\\-"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-21T14:49:57.370

```
String str="Hello+Hello";   
str=str.replaceAll("\\+","-");
System.out.println(str); 
```

或者

```
String str="Hello+Hello";   
str=str.replace(Pattern.quote(str),"_");
System.out.println(str); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-06-14T19:24:48.273

用不确定的重复次数替换多个“+”怎么样？

示例：测试+测试+测试+1234

(+) 或 [+] 似乎选择单个文字字符但重复。

# rhino-mocks - 是否可以在 RhinoMocks 中的 Expect.Call 期间设置对象的属性值？

> ID：610334
> 
> 赞同：2
> 
> 时间：2009-03-04T12:30:29.310
> 
> 标签：rhino-mocks

我有一个方法，只有在特定对象的属性设置为 false 时才应调用该方法。这是它的初始值。第一次调用后，该属性设置为 true，确保调用只进行一次。

但是，当我模拟执行此更改的类时，模拟对象不会更改底层对象的属性。

有没有办法强制改变对象的属性以响应期望得到满足？

类似于...的东西

```
Expect.Call(mockedObject.TestMethod(underlyingObject)).NowDoThis(delegate() { underlyingObject.Processed = true; }); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T12:38:40.100

是的，

而不是你的 NowDoThis() 调用尝试 Do()

* * *

终于回家了，所以我可以尝试一些代码。

诀窍是将匿名委托转换为派生自 System.Delegate 的类型 Action（类型 MethodInvoker 也应该工作，但该类型仅在 System.Windows.Forms 中可用）

这是代码。我更喜欢 rhino mocks AAA 语法。让我知道是否必须将其转换为 Expect.Call 语法。我也在使用 xunit.net，[Fact] 只是意味着 [Test]

```
public interface Thingie
{
    bool Flag { get; set; }
    void DoSomething();
}

[Fact]
public void Test()
{
    var thingie = MockRepository.GenerateStub<Thingie>();

    thingie.Stub(x => x.DoSomething()).Do((Action) delegate { thingie.Flag = true; });

    Assert.False(thingie.Flag);

    thingie.DoSomething();

    Assert.True(thingie.Flag);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T14:51:06.247

假设 mockedObject 实际上是一个模拟对象，您可以在调用测试方法后简单地为您的属性设置一个返回值：

```
bool isProcessed = false;
Expect.Call(mockedObject.TestMethod(underlyingObject))
   .Do(new Action(() => isProcessed = true));

SetupResult.For(mockedObject.Processed).Return(isProcessed); 
```

# .net - .NET webservice 的性能提示/提示提供来自 sql server 的信息

> ID：610335
> 
> 赞同：0
> 
> 时间：2009-03-04T12:30:39.607
> 
> 标签：.net, sql-server, performance, web-services, debugging

我有一个相当简单的 web 服务，它从 sql server 公开数据。它将用于在 2 个不同的数据库（SQL Server 和 Lotus Notes）之间同步数据。我们正处于测试 web 服务的阶段，并以 20 req./min. 进行轮询，前 2 分钟一切正常，但在第二分钟之后，我们遇到了异常，显然是连接（到数据库) 无法打开（超时）。

你对做什么或在哪里看有什么提示/建议吗？Web 服务已使用 C#/.NET 进行编程，与 db 的连接在（Web 服务）对象的构造期间打开，并在对象被释放时关闭。

我曾考虑使用 global.asax 来“共享”连接，但经过一番谷歌搜索后，我发现大多数人认为这是一个坏主意，我正在寻找不同的解决方案。

附言。服务是同步池化的，没有2个请求同时存在

-edit-（在关于池的前 2 个回答之后）这是当前代码：

```
public class DataService : System.Web.Services.WebService
{
    private SqlConnection conn = new SqlConnection("Data Source=ip;database=database;uid=user;pwd=secret;");
    public DataService () 
    {
            try
            {
                conn.Open();

            }
            catch (Exception dbconn)
            {
                throw new SoapException("Couldn't open connection to database:" + dbconn.Message + " More info at: " + dbconn.HelpLink, errorCode);
            }
            //Uncomment the following line if using designed components 
            //InitializeComponent(); 
    }
    ~DataService()
    {
         conn.Close();
    }
    [WebMethod(Description="Gets all Person changes(from last week)")]
    public Person[] GetPerson()
    { 
            Person[] Personen = null;
            SqlCommand sqlcmd = conn.CreateCommand();

            sqlcmd.CommandText = "SELECT * FROM Person";
            SqlDataReader Rows = sqlcmd.ExecuteReader();
            while (Rows.Read())
            {
                    //doSomething
            }

            Rows.Close();
            return Personen;
    } 
```

}

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T12:36:16.300

听起来你已经用尽了连接池——最好的选择是用 using 块来包装你的 SQL 调用，这样松散地：

```
using( SqlConnection con = new SqlConnection( "MyConnectionString" ) )
{
    con.Open();

    using( SqlCommand cmd = new SqlCommand( "MyStoredProcedure", con ) )
    {
        // Do stuff with the Command
    }
} 
```

这将允许您同时处理与连接池大小相同数量的请求。

因此，您编辑后的代码变为：

```
public class DataService : System.Web.Services.WebService
{
    [WebMethod(Description="Gets all Person changes(from last week)")]
    public Person[] GetPerson()
    { 
        Person[] Personen = null;

        using( SqlConnection conn = new SqlConnection("Data Source=ip;database=database;uid=user;pwd=secret;") )
        {
            using( SqlCommand sqlcmd = conn.CreateCommand() )
            {
                sqlcmd.CommandText = "SELECT * FROM Person";
                SqlDataReader Rows = sqlcmd.ExecuteReader( CommandBehavior.CloseConnection ); // This will close the DB connection ASAP
                while (Rows.Read())
                {
                    //doSomething
                }

                Rows.Close();
            }
        }

        return Personen;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T12:44:44.893

请参阅此链接[Best Practices for Using ADO.NET](http://msdn.microsoft.com/en-us/library/ms971481.aspx)，您将在其中找到指向[SQL Server Connection Pooling (ADO.NET)](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)的链接- 确保您确实正确使用了连接池。

# javascript - 检索所选文本 在 element In the following: <select id="test"> <option value="1">Test One</option> <option value="2">Test Two</option> </select> How can I get the text of the selected option (i.e. "Tes

> ID：610336
> 
> 赞同：165
> 
> 时间：2009-03-04T12:30:42.773
> 
> 标签：javascript, html, dom

* * *

## 回答 #1

> 赞同：264
> 
> 时间：2009-03-04T12:33:35.137

```
function getSelectedText(elementId) {
    var elt = document.getElementById(elementId);

    if (elt.selectedIndex == -1)
        return null;

    return elt.options[elt.selectedIndex].text;
}

var text = getSelectedText('test'); 
```

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2010-08-31T23:53:46.737

如果您使用 jQuery，那么您可以编写以下代码：

```
$("#selectId option:selected").html(); 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2011-11-16T10:30:30.880

```
document.getElementById('test').options[document.getElementById('test').selectedIndex].text; 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2013-05-15T02:07:43.573

在 HTML5 下，您可以这样做：

```
document.getElementById('test').selectedOptions[0].text 
```

MDN 在[https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement/selectedOptions](https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement/selectedOptions)的文档表明完全跨浏览器支持（至少截至 2017 年 12 月），包括 Chrome、Firefox、Edge 和移动浏览器，但不包括 Internet Explorer。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2013-08-15T09:02:37.987

```
selectElement.options[selectElement.selectedIndex].text; 
```

参考：

*   options 集合，selectedIndex 属性：[HTML DOM 选择对象](http://www.w3schools.com/jsref/dom_obj_select.asp)
*   text 属性：[HTML DOM 选项对象](http://www.w3schools.com/jsref/dom_obj_option.asp)
*   正是这个问题的答案：[Option text Property](http://www.w3schools.com/jsref/prop_option_text.asp)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-04T12:33:09.133

该`options`属性包含所有`<options>`-从那里您可以查看`.text`

```
document.getElementById('test').options[0].text == 'Text One' 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-07-22T06:46:39.897

您可以使用`selectedIndex`检索当前选择的`option`：

```
el = document.getElementById('elemId')
selectedText = el.options[el.selectedIndex].text 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-02-19T09:54:32.837

this.options[this.selectedIndex].innerText

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-09-02T19:10:19.720

使用选择列表对象，来标识它自己的选择选项索引。从那里 - 获取该索引的内部 HTML。现在您有了该选项的文本字符串。

```
<select onchange="alert(this.options[this.selectedIndex].innerHTML);">
       <option value="">Select Actions</option>
       <option value="1">Print PDF</option>
       <option value="2">Send Message</option>
       <option value="3">Request Review</option>
       <option value="4">Other Possible Actions</option>
    </select> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-07-30T22:10:21.853

如果您找到此线程并想知道如何通过事件获取选定的选项文本，这里是示例代码：

```
alert(event.target.options[event.target.selectedIndex].text); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-08-03T14:49:16.523

选择[`:checked`](https://developer.mozilla.org/en-US/docs/Web/CSS/:checked)器可用于[`document.querySelector`](https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector)检索选定的选项。

```
let selectedText = document.querySelector('#selectId option:checked').text;
// or
let selectedText = document.querySelector('#selectId')
      .querySelector('option:checked').text; 
```

```
document.querySelector('button').addEventListener('click', function(e) {
  console.log(document.querySelector('#selectId option:checked').text);
});
```

```
<select id="selectId">
  <option>a</option>
  <option>b</option>
  <option>c</option>
</select>
<button>
Get selected text
</button>
```

对于带有[`multiple`](https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/multiple)属性的select元素，[`document.querySelectorAll`](https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll)可以用来获取所有选中的选项。

```
let selectedText = [...document.querySelectorAll('#selectId option:checked')]
   .map(o => o.text); 
```

```
document.querySelector('button').addEventListener('click', function(e) {
  let selectedText = [...document.querySelectorAll('#selectId option:checked')]
                      .map(o => o.text);
  console.log(selectedText);
});
```

```
<select id="selectId" multiple>
  <option>a</option>
  <option>b</option>
  <option>c</option>
</select>
<button>
Get selected text
</button>
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-03-15T12:51:36.330

与 @artur 类似，只是没有 jQuery，使用纯 javascript：

// 使用@Sean-bright 的“elt”变量

```
var selection=elt.options[elt.selectedIndex].innerHTML; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-27T01:45:30.520

这很简单。在 javascript 中，任何带有 ID 的东西都不需要`document.queryselector`，或者`$('#test')`您可以只使用 test.id 。然后，您只需遍历 javascript 中的 selectedOptions 即可，您可以将其添加到新数组中，并根据需要使用该数据。

```
let selectedItems = [];
for ( var i = 0; i < test.selectedOptions.length; i++) {
    selectedItems.push(test.selectedOptions[i].text);
} 
```

还

```
// if you want values
selectedItems.push(test.selectedOptions[i].value); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-09-10T13:55:22.823

简单，简单的方法：

```
const select = document.getElementById('selectID');
const selectedOption = [...select.options].find(option => option.selected).text; 
```

# vb.net - 是否可以返回对象接口的数组而不是对象？

> ID：610339
> 
> 赞同：0
> 
> 时间：2009-03-04T12:31:47.373
> 
> 标签：vb.net, web-services, interface, asmx

我有一个界面，描述了我的应用程序中的一个专门列表......

```
Public Interface IAlphabeticListItem

    Property StartingLetter() As String
    Property DetailsList() As Generic.List(Of DetailsData)

End Interface 
```

多个对象实现了这个接口，但我想在 web 服务中返回它们，而不是作为底层对象，而是作为接口。

```
<WebMethod()> _
Public Function GetCategoryList(...) As Generic.List(Of IAlphabeticListItem)

    ...

End Function 
```

可悲的是，这会导致异常

无法序列化接口 IAlphabeticListItem。

异常详细信息：System.NotSupportedException：无法序列化接口 IAlphabeticListItem。

有没有办法使接口可序列化，或者我是否必须将我的每个对象转换为实现接口的具体类，然后返回该类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T12:43:48.450

我现在没有时间测试它，但是在 C# 中你可以扩展接口，所以我想你可以在 VB.NET 中做到这一点。

只需让 IAlphabeticListItem 扩展 ISerializable

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:38:30.237

是和不是。您不能直接公开用于 XML 序列化的泛型类，因为它不受支持。但是，您可以在同一个集合上公开一个非通用接口并对其进行序列化。该博客详细介绍了如何使这项工作

[http://srtsolutions.com/blogs/billwagner/archive/2006/11/20/xml-serialization-and-generic-interfaces.aspx](http://srtsolutions.com/blogs/billwagner/archive/2006/11/20/xml-serialization-and-generic-interfaces.aspx)

# wpf - WPF ListBox - 获取 UIElement 而不是 SelectedItem

> ID：610343
> 
> 赞同：14
> 
> 时间：2009-03-04T12:33:09.583
> 
> 标签：wpf, listbox, datatemplate, selecteditem, uielement

我创建了`ListBox`一个`DataTemplate`as `Itemtemplate`。但是，有没有一种简单的方法可以访问生成的代码`UIElement`而不是`SelectedItem`代码隐藏？

当我访问时`SelectedItem`，我只是从我的 `ItemsSource`集合中获取选定的对象。有没有办法访问`UIElement`（即`DataTemplate`与绑定对象一起生成的元素）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T17:26:20.720

您正在寻找[ItemContainerGenerator](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.itemscontrol.itemcontainergenerator)属性。每个`ItemsSource`都有一个[ItemContainerGenerator](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.itemcontainergenerator)实例。此类具有您可能感兴趣的以下方法：[ContainerFromItem(object instance)](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.itemcontainergenerator.containerfromitem)。

一旦您掌握了`ListBoxItem`，您就可以继续浏览逻辑和可视化树。查看[Logical Tree Helper](http://msdn.microsoft.com/en-us/library/system.windows.logicaltreehelper.aspx)和[Visual Tree Helper](http://msdn.microsoft.com/en-us/library/system.windows.media.visualtreehelper.aspx)。

就像安迪在评论中所说的那样，仅仅因为该项目存在于您的收藏中并不意味着已经为它生成了一个容器。任何类型的虚拟化面板场景都会引发这个问题；UIElements 将在不同的项目中重复使用。也要小心。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-08-02T03:57:37.120

**大小*，*安迪*和*博德克*是绝对正确的。*

 **以下是我如何能够使用其句柄检索列表框的选定项目的文本框。

```
var container = listboxSaveList.ItemContainerGenerator.ContainerFromItem(listboxSaveList.SelectedItem) as FrameworkElement;
if (container != null)
{
    ContentPresenter queueListBoxItemCP = VisualTreeWalker.FindVisualChild<ContentPresenter>(container);
    if (queueListBoxItemCP == null)
        return;

    DataTemplate dataTemplate = queueListBoxItemCP.ContentTemplate;

    TextBox tbxTitle = (TextBox)dataTemplate.FindName("tbxTitle", queueListBoxItemCP);
    tbxTitle.Focus();
} 
```

（注意：这里，VisualTreeWalker 是我自己对 VisualTreeHelper 的包装器，其中暴露了各种有用的功能）

# batch-file - 交互式批处理文件

> ID：610345
> 
> 赞同：2
> 
> 时间：2009-03-04T12:34:31.327
> 
> 标签：batch-file, dos

如何处理交互式批处理文件？

例如。，

你要继续吗？[是/否]

如果'y'转到标签1

否则转到标签2

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T12:41:27.537

您可以使用 SET 命令。以下是与您上面的伪代码等效的 DOS 命令：

```
set /p choice=Do you want to continue? [y/n]
if '%choice%'=='Y' goto label1
goto label2 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T12:43:23.803

使用选择命令，您可以指定一组有效字符和一条消息：

```
choice /C YN /M "Do you want to continue?"
if errorlevel 2 goto labelno
if errorlevel 1 goto labelyes 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-08-10T23:40:13.760

我知道一种方法（如@user3093687 发布）

```
set /p choice=Do you want to continue? (y,n)
if /I %choice%==y goto Label2
if /I %choice%==n goto exit

:Label2
Cls
echo You chose yes

:exit
exit 
```

批处理文件第二行和第三行中的 /I 使其不区分大小写并忽略特殊字符（例如 Y 和 y 都将被读取为 y.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-10T22:04:37.260

set /p 选择=你想继续吗？[y/n] if "%choice%" == "y" (goto label1) else goto label2

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-13T15:50:26.477

我喜欢你们大多数人的答案，但我最想做的是（例如，这段代码是我的组织方式。

```
:Label1
@echo off
color (any color)
title (anything here)

set /p choice=Do you want to continue? [y/n]
IF %choice% == y goto Label2
IF %choice% == n exit

:Label2
cls
echo you chose Yes. 
```

# reference - AWK 的最佳参考/婴儿床单

> ID：610348
> 
> 赞同：1
> 
> 时间：2009-03-04T12:35:32.387
> 
> 标签：reference, awk, gawk

在一系列类似的问题中，您见过的最好的 AWK 参考资料是什么？

如果真的没有（我还没有找到圣杯），也许我们可以在一个单独的问题中编译一个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:13:42.653

[Aho、Kernighan 和 Weinberger的 AWK 编程语言](http://www.amazon.co.uk/AWK-Programming-Language-Alfred-Aho/dp/020107981X)是最好的。作者名字的首字母应该告诉你为什么......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T15:11:23.870

我会推荐Arnold *Robbins的**《Effective AWK Programming* 》 。[您可以在此处](http://www.gnu.org/software/gawk/manual/gawk.pdf)获得免费的 pdf 副本。

 ** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:18:55.480

[这个参考卡片 PDF](http://www.cs.mtsu.edu/~neal/awkcard.pdf)对于婴儿床单来说非常全面，但它足够简洁，可以让您快速找到所需的内容。它还包括有关 mawk 和 gawk 实现的信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T13:05:00.553

每当我需要了解有关 AWK 的信息时，我总是会去我的[UNIX in a Nutshell](http://oreilly.com/catalog/unixnut3/chapter/ch11.html)副本。[现在我看到在 Nutshell book](https://rads.stackoverflow.com/amzn/click/com/1565922255) and [pocket guide](https://rads.stackoverflow.com/amzn/click/com/0596003528)中有一个 SED/AWK 。前者足以满足我的需要。后面两个没用过。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T12:04:55.530

我发现这个网站很有用（它还没有让我失望）：

[http://www.grymoire.com/Unix/Awk.html](http://www.grymoire.com/Unix/Awk.html)

我还发现这个食谱风格的网站非常鼓舞人心：

[http://student.northpark.edu/pemente/awk/awk1line.txt](http://student.northpark.edu/pemente/awk/awk1line.txt)

希望这些帮助。

# java - 多个 Java 项目和重构

> ID：610350
> 
> 赞同：4
> 
> 时间：2009-03-04T12:35:47.050
> 
> 标签：java, refactoring, packages, packaging

我最近加入了一个使用多个不同项目的项目。许多这些项目相互依赖，使用库中包含的另一个项目的 JAR 文件，因此无论何时更改一个项目，您都必须知道哪个其他项目使用它并更新它们。我想让这变得更容易，并且正在考虑将所有这些 java 代码合并到单独的包中的一个项目中。是否可以这样做，然后只在 jar 中部署一些包。我不想只部署其中的一部分，但如果可能的话，我已经被解雇了。

有没有更好的方法来处理这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T12:46:30.677

### 方法 1：使用 Hudson

如果您使用像[Hudson](http://hudson-ci.org/)这样的持续集成服务器，那么您可以配置上游/下游项目（请参阅[术语](http://wiki.hudson-ci.org/display/HUDSON/Terminology)）。

> 一个项目可以有一个或多个下游项目。如果当前项目构建成功，则将下游项目添加到构建队列中。即使当前项目不稳定（默认为关闭），也可以设置它应该将下游项目添加到调用队列中。

这意味着，如果有人将某些代码签入到一个项目中，那么如果它破坏了其他构建，至少你会得到早期警告。

### 方法二：使用 Maven

如果项目不是太复杂，那么也许您可以创建一个主项目，并将这些子项目作为该项目的子模块。然而，将项目改造成 Maven 喜欢的形式可能非常棘手。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T12:43:12.383

如果您使用 Eclipse（或任何体面的 IDE），您可以使一个项目依赖于另一个项目，并在您的 SVN 中提供该配置方面，并在您的构建脚本中假设检查。

请注意，如果一个项目依赖于另一个项目的某个版本，则 Jar 文件是一种更简单的管理方式。重大重构可能立即意味着在所有其他项目中进行大量工作来修复问题，而您可以根据需要将新 jar 放入每个项目，然后进行迁移工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T12:47:06.027

我想这可能完全取决于具体的项目，但我认为我会将所有项目分开。这有助于保持整个系统松散耦合。您可以使用诸如[maven](http://maven.apache.org/)之类的工具来帮助管理项目之间的所有依赖关系。像这样管理依赖项是 Maven 的主要优势之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T13:17:10.087

使用 Ant 作为您的构建工具，您可以以任何您想要的方式打包您的项目。但是，将部分代码保留在分发之外似乎很容易出错；您可能会不小心遗漏了必要的课程（大概，您的所有课程都是必需的）。

关于将代码保存在不同的项目中，我有一个宽松的指导方针。将更改的代码一起保存在同一个项目中，并将其打包到自己的 jar 文件中。当您的某些代码可以分解为更改频率低于主应用程序的实用程序库时，此方法效果最佳。

例如，您可能有一个应用程序，其中您从 Web 服务 WSDL 生成了 Web 服务客户端类（使用类似 Axis 库的东西）。Web 服务接口可能不会经常更改，因此您不希望在主应用程序构建中一直重复执行重新生成步骤。为这部分创建一个单独的项目，以便您只需在 WSDL 更改时重新创建 Web 服务客户端类。创建一个单独的 jar 并在您的主应用程序中使用它。这种风格还允许其他项目重用这些实用模块。

遵循这种风格时，您应该在 jar 清单中放置一个版本号，以便您可以跟踪哪些应用程序正在使用您的模块的哪些版本。根据您想要采取的程度，您还可以在 jar 中保留一个文本文件，详细说明每个修订版发生的更改（很像开源库）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T12:45:42.300

一切皆有可能（几年前我们也遇到过同样的情况）。它的难易程度取决于您的 IDE（重构、合并、组织新项目）和构建工具（部署）。我们使用 IDEA 作为 IDE，使用 Ant 作为构建工具，这并不难。一个星期天（没有人工作+提交），2 个人在一台电脑上。

我不确定你的意思

> “仅部署 jar 中的一些包”

我认为您将在运行时需要所有这些，不是吗？据我了解，它们相互依赖。

# php - PHP.ini 不起作用

> ID：610353
> 
> 赞同：1
> 
> 时间：2009-03-04T12:36:46.300
> 
> 标签：php, configuration

我打开记事本，在其中插入 3 行，将其保存为 php.ini，并将其上传到 public_html 中，但我仍然收到需要先关闭魔术引号的错误。三行的语法如下：

```
magic_quotes_gpc = 0 
magic_quotes_runtime = 0 
magic_quotes_sybase = 0 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T12:39:48.757

使用[`phpinfo()`](http://www.php.net/manual/en/function.phpinfo.php)函数查看`php.ini`您实际使用的文件

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T12:45:44.220

您也可以在[`.htaccess`配置文件](http://httpd.apache.org/docs/2.2/howto/htaccess.html)中更改这些设置：

```
php_flag magic_quotes_gpc off
php_flag magic_quotes_runtime off
php_flag magic_quotes_sybase off 
```

请参阅[PHP：如何更改配置设置](http://docs.php.net/manual/en/configuration.changes.php#configuration.changes.apache)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T12:51:08.620

大多数托管公司允许您定义本地 ini 文件。检查他们的支持页面，看看你应该把你的 php.ini 文件放在哪里，以便 php 引擎读取它。如果他们有这个选项，您不必担心重新启动服务器。

如果您找不到任何有关它的信息，请使用以下代码创建一个页面：

```
<?php phpinfo(); ?> 
```

并查找名为“配置文件（php.ini）路径”的属性。这是您应该放置文件的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T12:40:07.133

它不应该放在 public_html 文件夹中……它应该放在您的 PHP 安装文件夹中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T12:43:13.383

Php.ini 通常不在 public_html 中。如果您无法访问您的真实 php.ini，请尝试编写

```
php_flag magic_quotes_gpc off 
```

在 .htaccess 文件中（在 public_html 中）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T12:50:01.947

大多数托管公司不会让您使用 php.ini，除非您从他们那里租用专用服务器。在那，您可以尝试页面 php.ini 设置，如下所示：

```
ini_set("magic_quotes_gpc", "0");
ini_set("magic_quotes_runtime", "0"); 
ini_set("magic_quotes_sybase", "0"); 
```

如果这不起作用，那么您将不得不询问您的托管公司。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-18T06:43:23.090

在 CentOS 8 上运行

```
service php-fpm restart 
```

读取编辑后的 ​​php.ini 文件

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-04T12:40:00.737

好吧，你必须改变你的主要 php.ini，我认为它不在 public_html 中。此外，为了查看更改，您必须重新启动 php 引擎。

# c++ - IP_HDRINCL 有问题吗？

> ID：610356
> 
> 赞同：0
> 
> 时间：2009-03-04T12:38:04.207
> 
> 标签：c++, c, sockets, network-programming

我已经问过这个关于原始 IP 数据包实现的问题。但我没有得到任何解决方案。

### 我的代码：

```
if((s = WSASocket(AF_INET, SOCK_RAW, IPPROTO_TCP, 0, 0, 0))==SOCKET_ERROR) // Socket 
    {
        printf("Creation of raw socket failed.");
        return 0;
    }
if(setsockopt(s, IPPROTO_IP, IP_HDRINCL, (char *)&optval, sizeof(optval))==SOCKET_ERROR)
    {
        printf("failed to set socket in raw mode.");
        return 0;
    }
if((sendto(s ,(char *) buf , sizeof(IPV4_HDR)+sizeof(TCP_HDR) + payload, 0,(SOCKADDR *)&dest, sizeof(dest)))==SOCKET_ERROR)
    {
    printf("Error sending Packet : %d",WSAGetLastError());
    break;
    } 
```

### 错误：

WSAGetLastError() 返回 10022：

### 描述：

向 setsockopt (Wsapiref_94aa.asp) 函数提供了无效参数（例如，指定无效级别的参数）。有时，它也指套接字的当前状态，例如，在未侦听的套接字上调用accept (Wsapiref_13aq.asp)。

### 评论：

但我已经设置了正确的选项值和大小。

我究竟做错了什么？我正在使用 Windows XP (SP3)。在 setsocketopt 中，我为该程序尝试了 IP_OPTIONS，它工作正常，并且它也发送 IP 数据包。但在虚幻中，它为每个 IP 数据包生成来自目的地的 ICMP 数据包。

我怎样才能解决这个问题？

**源代码**：

//原始tcp数据包制作器

```
#include "stdio.h"
#include "winsock2.h"
#include "ws2tcpip.h"  //IP_HDRINCL is here
#include "conio.h"

typedef struct ip_hdr
{
    unsigned char  ip_header_len:4;  // 4-bit header length (in 32-bit words) normally=5 (Means 20 Bytes may be 24 also)
    unsigned char  ip_version   :4;  // 4-bit IPv4 version
    unsigned char  ip_tos;           // IP type of service
    unsigned short ip_total_length;  // Total length
    unsigned short ip_id;            // Unique identifier 

    unsigned char  ip_frag_offset   :5;        // Fragment offset field

    unsigned char  ip_more_fragment :1;
    unsigned char  ip_dont_fragment :1;
    unsigned char  ip_reserved_zero :1;

    unsigned char  ip_frag_offset1;    //fragment offset

    unsigned char  ip_ttl;           // Time to live
    unsigned char  ip_protocol;      // Protocol(TCP,UDP etc)
    unsigned short ip_checksum;      // IP checksum
    unsigned int   ip_srcaddr;       // Source address
    unsigned int   ip_destaddr;      // Source address
}   IPV4_HDR, *PIPV4_HDR, FAR * LPIPV4_HDR;

// TCP header
typedef struct tcp_header 
{ 
    unsigned short source_port;  // source port 
    unsigned short dest_port;    // destination port 
    unsigned int   sequence;     // sequence number - 32 bits 
    unsigned int   acknowledge;  // acknowledgement number - 32 bits 

    unsigned char  ns   :1;          //Nonce Sum Flag Added in RFC 3540.
    unsigned char  reserved_part1:3; //according to rfc
    unsigned char  data_offset:4;    /*The number of 32-bit words in the TCP header. 
                                       This indicates where the data begins. 
                                       The length of the TCP header is always a multiple 
                                       of 32 bits.*/

    unsigned char  fin  :1;      //Finish Flag
    unsigned char  syn  :1;      //Synchronise Flag
    unsigned char  rst  :1;      //Reset Flag
    unsigned char  psh  :1;      //Push Flag 
    unsigned char  ack  :1;      //Acknowledgement Flag 
    unsigned char  urg  :1;      //Urgent Flag

    unsigned char  ecn  :1;      //ECN-Echo Flag
    unsigned char  cwr  :1;      //Congestion Window Reduced Flag

    ////////////////////////////////

    unsigned short window;  // window 
    unsigned short checksum;  // checksum 
    unsigned short urgent_pointer;  // urgent pointer 
}   TCP_HDR , *PTCP_HDR , FAR * LPTCP_HDR , TCPHeader , TCP_HEADER;

int main()
{
    char host[100],buf[1000],*data=NULL,source_ip[20]; //buf is the complete packet
    SOCKET s;
    int k=1;

    IPV4_HDR *v4hdr=NULL;
    TCP_HDR  *tcphdr=NULL;

    int payload=512 ;
    int optval= 1;
    SOCKADDR_IN dest;
    hostent *server;

    //Initialise Winsock
    WSADATA wsock;
    printf("\nInitialising Winsock...");
    if (WSAStartup(MAKEWORD(2,2),&wsock) != 0)
    {
        fprintf(stderr,"WSAStartup() failed");
        exit(EXIT_FAILURE); 
    } 
    printf("Initialised successfully.");
    ////////////////////////////////////////////////

    //Create Raw TCP Packet
    printf("\nCreating Raw TCP Socket...");
    if((s = WSASocket(AF_INET, SOCK_RAW, IPPROTO_TCP, 0, 0, 0))==SOCKET_ERROR)
    {
        printf("Creation of raw socket failed.");
        return 0;
    }
    printf("Raw TCP Socket Created successfully.");
    ////////////////////////////////////////////////

    //Put Socket in RAW Mode.
    printf("\nSetting the socket in RAW mode...");
    if(setsockopt(s, IPPROTO_IP, IP_HDRINCL, (char *)&optval, sizeof(optval))==SOCKET_ERROR)
    {
        printf("failed to set socket in raw mode.");
        return 0;
    }
    printf("Successful.");
    ////////////////////////////////////////////////
    //Target Hostname
    printf("\nEnter hostname : ");
    gets(host);
    printf("\nResolving Hostname...");
    if((server=gethostbyname(host))==0)
    {
        printf("Unable to resolve.");
        return 0;
    }
    dest.sin_family = AF_INET;
    dest.sin_port   = htons(8888);  //your destination port
    memcpy(&dest.sin_addr.s_addr,server->h_addr,server->h_length);
    printf("Resolved.");
    /////////////////////////////////////////////////

    printf("\nEnter Source IP : ");
    gets(source_ip);

    v4hdr = (IPV4_HDR *)buf;  //lets point to the ip header portion
    v4hdr->ip_version=4;
    v4hdr->ip_header_len=5;
    v4hdr->ip_tos    = 0;
    v4hdr->ip_total_length = htons ( sizeof(IPV4_HDR) + sizeof(TCP_HDR) + payload );
    v4hdr->ip_id     = htons(2);
    v4hdr->ip_frag_offset = 0;
    v4hdr->ip_frag_offset1 = 0;
    v4hdr->ip_reserved_zero = 0;
    v4hdr->ip_dont_fragment = 1;
    v4hdr->ip_more_fragment = 0;
    v4hdr->ip_ttl    = 8;
    v4hdr->ip_protocol = IPPROTO_TCP;
    v4hdr->ip_srcaddr  = inet_addr(source_ip);
    v4hdr->ip_destaddr = inet_addr(inet_ntoa(dest.sin_addr));
    v4hdr->ip_checksum = 0;

    tcphdr = (TCP_HDR *)&buf[sizeof(IPV4_HDR)]; //get the pointer to the tcp header in the packet

    tcphdr->source_port = htons(1234);
    tcphdr->dest_port = htons(8888);

    tcphdr->cwr=0;
    tcphdr->ecn=1;
    tcphdr->urg=0;
    tcphdr->ack=0;
    tcphdr->psh=0;
    tcphdr->rst=1;
    tcphdr->syn=0;
    tcphdr->fin=0;
    tcphdr->ns=1;

    tcphdr->checksum = 0;

    // Initialize the TCP payload to some rubbish
    data = &buf[sizeof(IPV4_HDR) + sizeof(TCP_HDR)];
    memset(data, '^', payload);

    printf("\nSending packet...\n");

    while(!_kbhit())
    {
        printf("  %d  packets send\r",k++);
        if((sendto(s ,(char *) buf , sizeof(IPV4_HDR)+sizeof(TCP_HDR) + payload, 0,(SOCKADDR *)&dest, sizeof(dest)))==SOCKET_ERROR)
        {
        printf("Error sending Packet : %d",WSAGetLastError());
        break;
        }
    }
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-06-07T22:20:36.667

您不能在 Windows 中的原始 tcp 套接字上发送数据。

从[这里](http://msdn.microsoft.com/en-us/library/ms740548%28v=vs.85%29.aspx)：

“原始套接字的限制

在 Windows 7、Windows Vista、带有 Service Pack 2 (SP2) 的 Windows XP 和带有 Service Pack 3 (SP3) 的 Windows XP 上，通过原始套接字发送流量的能力受到以下几种方式的限制：

*   TCP 数据不能通过原始套接字发送。

*   无法通过原始套接字发送具有无效源地址的 UDP 数据报。任何传出 UDP 数据报的 IP 源地址必须存在于网络接口上，否则数据报将被丢弃。进行此更改是为了限制恶意代码创建分布式拒绝服务攻击的能力，并限制发送欺骗数据包（具有伪造源 IP 地址的 TCP/IP 数据包）的能力。

*   不允许使用 IPPROTO_TCP 协议的原始套接字调用绑定函数。"

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T14:29:27.433

好吧，看来您没有要发送的交易对手。

您已经创建了套接字并设置了它的选项，但是您需要侦听传入连接 ( `bind()`+ `accept()`) 或`connect()`其他方。

错误描述：`Sometimes, it also refers to the current state of the sockets`- 我想这是你的情况。您的套接字未处于连接状态，因此`sendto()`无效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-07T20:25:44.737

顺便说一句，作为参考，有一个关于'optval'的讨论，无论是bool还是int。显然 'int' 是更好的选择，但我已经看到了很多带有 bool 的例子。

[win32中设置IP_HDRINCL为setsockopt函数](https://stackoverflow.com/questions/1115511/set-ip-hdrincl-to-setsockopt-function-in-win32)

我使用了“bool”，我的程序在 Windows XP 上运行良好。现在它在 Win 7 上不起作用，错误代码为 10022。

# apache-flex - 使用 mxmlc ant 任务时如何包含其他编译器参数？

> ID：610386
> 
> 赞同：3
> 
> 时间：2009-03-04T12:46:29.223
> 
> 标签：apache-flex, ant, service, mxmlc

Flex Builder 允许在属性下的编译器选项中设置额外的编译器参数。它设置论点；

`-services ".../services-config.xml"`

使用ant任务mxmlc时有没有办法设置相同的参数？

干杯，

麦克风

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T15:31:41.840

从来没听说过。

如果您仍然无法在文档中找到它，您可以随时使用带有子节点的任务。

例子：

```
<exec executable="${mxmlc.exe}" dir="${basedir}">
    <arg line="-source-path '${flex2sdk.locale.dir}'" />
    <arg line="-locale en_US" />
</exec> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T18:29:39.977

您应该能够将其设置为 mxmlc 任务的属性：

```
<mxmlc services="../services-config.xml"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-30T14:21:05.263

我在 ant 任务中无法使用 services 属性时遇到了同样的问题，因此我添加了解决问题的选项：

```
 <mxmlc file="path" output="path to output" >
       <compiler.services>${path-to-services}</compiler.services>
       <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>
       <source-path path-element="${FLEX_HOME}/frameworks"/>
       <compiler.debug>false</compiler.debug>
       <compiler.context-root>/PATWeb</compiler.context-root>
 </mxmlc> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-17T20:52:06.770

这是通过以下方式完成的：

```
<target name="compileApp">
<mxmlc file="src/app.mxml" 
...other options
services="[path to your services-config.xml]" 
context-root="[path to where your gateway file is]">
...
</target> 
```

这就是我们当前构建 mxml 应用程序的方式……这意味着 Christophe 是正确的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-14T00:53:39.947

大多数编译器选项都可用作`mxmlc`任务的属性或标记，但是缺少一些选项，或者以某种意想不到的方式工作。最糟糕的是，flex Ant 任务缺乏适当的文档。有时我发现这样做更容易：

```
<mxmlc file="Main.as" output="bin/app.swf">
    <load-config filename="${FLEX_HOME}/flex-config.xml" />
    <load-config filename="build/config.xml" />
</mxmlc> 
```

然后在 build/config.xml 中指定我想要的所有选项，至少语法[记录得更好](http://help.adobe.com/en_US/flex/using/WS2db454920e96a9e51e63e3d11c0bf67670-7ff2.html)，并且您始终可以使用`flex-config.xml`或`air-config.xml`从您的 SDK 作为（注释良好的）示例。

# c++ - 比 C++ 更快的语言

> ID：610396
> 
> 赞同：23
> 
> 时间：2009-03-04T12:50:23.787
> 
> 标签：c++, programming-languages, performance

据说 Blitz++ 提供了*接近 Fortran 的性能*。

对于同等任务，Fortran 实际上是否比常规 C++ 更快？

其他具有出色运行时性能的 HL 语言呢？我听说过一些语言在某些任务上超过了 C++……Objective Caml、Java、D……

我猜 GC 可以使很多代码*更快*，因为它消除了在堆栈周围过度复制的需要？（假设代码*不是*为了性能而编写的）

我是出于好奇而问的——我一直认为 C++ 几乎是无与伦比的，除非有专家 ASM 编码。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-03-04T13:06:06.463

对于纯数字代码，Fortran 比 C++ 更快且几乎总是更好。Fortran 速度更快的原因有很多。它是最古老的编译语言（在优化编译器方面有很多知识）。它仍然是数值计算的语言，因此许多编译器供应商以销售优化编译器为生。还有其他更多的技术原因。Fortran（至少是 Fortran77）没有指针，因此不存在困扰该域中 C/C++ 语言的别名问题。许多高性能库仍然使用 Fortran 编码，历史悠久（> 30 年）。C 或 C++ 都没有任何好的数组构造（C 级别太低，C++ 的数组库与地球上的编译器一样多，它们彼此不兼容，从而阻止了经过良好测试的快速代码池）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-04T14:39:21.387

fortran 是否比 c++ 快是一个讨论问题。有人说是，有人说不是；我不会进入那个。这取决于编译器、运行它的架构、算法的实现……等等。

与 C 相比， fortran*的*一大优势在于实现这些算法所需的时间。这使得它非常适合任何类型的数值计算。我将仅说明与 C 相比的一些明显优势：

*   基于 1 的数组索引（在实现更大的模型时非常有用，您不必考虑它，只需*FORmula TRANslate*
*   有一个幂运算符 ( `**`) （*天哪，谁的想法是幂函数会做？而不是运算符？！*）
*   它有，我想说对当前市场上所有语言的多维数组的最佳支持（而且它似乎不会这么快改变）——`A(1,2)`就像在数学中一样
*   更不用说避免循环 - A=B*C 将数组相乘（几乎像 matlab 语法与*编译速度*）
*   它具有内置*于语言*中的并行功能（检查这个新标准）
*   很容易与 C、python 等语言连接，因此您可以在 fortran 中进行繁重的计算，而 .. 无论如何... 使用您选择的语言，如果您愿意的话
*   完全向后兼容（因为整个 F77 是 F90 的子集），因此您可以使用整个世纪的编码
*   *非常非常便携*（这可能不适用于某些编译器扩展，但总的来说它就像一个魅力）
*   面向问题的解决社区（因为 fortran 用户通常不是 cs，而是数学、物理、工程师……没有编程的人，而是有解决问题经验的人，他们对*您的*问题的了解可能会非常有帮助）

我现在想不出其他任何事情，所以必须这样做。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-04T13:13:40.890

Blitz++ 与之竞争的不是 Fortran 语言，而是 Fortran 数学库中的几个世纪的工作。在某种程度上，该语言有所帮助：一种较旧的语言有更多的时间来优化编译器（而且，让我们面对现实吧，C++ 是最复杂的语言之一）。另一方面，像[Blitz++](http://www.oonumerics.org/blitz/)和[uBLAS](http://www.boost.org/doc/libs/1_38_0/libs/numeric/ublas/doc/overview.htm)这样的高级 C++ 库允许你比相对低级的 Fortran 代码更清楚地陈述你的意图，并允许全新的编译时优化类。

但是，始终有效地使用任何库都需要开发人员非常熟悉语言、库**和**数学。您通常可以通过改进这三个中的任何一个来获得更快的代码......

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-04T13:08:24.243

FORTAN 在数组处理方面通常比 C++ 快，因为语言实现数组的方式不同 - FORTRAN 不允许数组元素的别名，而 C++ 允许。这使得 FORTRAN 编译器的工作更容易。此外，FORTRAN 有许多非常成熟的数学库，这些库已经研究了近 50 年——C++ 并没有出现那么久！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T12:57:44.330

这在很大程度上取决于编译器、程序员、它是否具有 gc 并且可能变化太大。如果将其直接编译为机器代码，则期望其性能比大多数情况下的解释更好，但是在您获得 asm 速度之前，可能进行的优化是有限的。

如果有人说 fortran 稍微快一点，你会用那种方式编写一个新项目吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-04T13:16:33.553

c++ 的问题是它非常接近硬件级别。事实上，您可以在硬件级别进行编程（通过汇编块）。一般来说，c++ 编译器在优化方面做得很好（为了获得巨大的速度提升，启用“链接时间代码生成”以允许在不同的 cpp 文件之间内联函数），但如果你了解硬件并拥有专有技术，您可以在汇编中编写一些运行速度更快的函数（尽管有时，您无法击败编译器）。

您还可以实现自己的内存管理器（这是许多其他高级语言不允许的），因此您可以为您的特定任务自定义它们（也许大多数分配将是 32 字节或更少，那么您可以只是有一个巨大的 32 字节缓冲区列表，您可以在 O(1) 时间内分配/取消分配）。我相信 c++ 可以击败任何其他语言，只要您完全了解编译器和您正在使用的硬件。其中大部分归结为您使用的算法比其他任何东西都多。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-08T22:31:20.253

当您加载此页面时，您必须使用一些奇怪的托管 XML 解析器。:)

我们不断地分析代码并且收益是一致的（这不是天真的 C++，它只是带有嘘声的现代 C++）。它始终如一地将任何 CLR 实现铺平了至少 2 倍，通常是 5 倍或更多。比 Java 时代快 20 倍左右要好一点，但您仍然可以找到好的实例，并简单地消除所有 System.Object 膨胀，并将其明显击败。

托管开发人员没有得到的一件事是硬件架构反对任何 VM 和对象根方法的扩展。你必须亲眼看到它才能相信它，坚持住，启动浏览器并转到像 Silverlight 这样的“瘦”虚拟机。您会惊讶于它的速度有多慢和 CPU 饥饿。

二，任何性能的数据库应用程序的启动，是托管数据库与本机数据库。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T13:05:02.940

通常是算法而不是语言决定了你最终会达到的性能范围。

在这个范围内，优化编译器通常可以生成比大多数汇编编码器更好的代码。

[过早的优化是万恶之源](http://en.wikipedia.org/wiki/Optimization_(computer_science))

这可能是每个人都可以鹦鹉学舌的“常识”，但我认为这可能是因为它是正确的。我等待相反的具体证据。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-04T13:33:15.773

C# 比 C++ 快得多 - 在 C# 中，我可以用编写 C++ 的十分之一时间编写 XML 解析器和数据处理器。

哦，你是说执行速度吗？

即便如此，如果从编写第一行代码到第一次执行代码结束这段时间，C# 仍然可能比 C++ 快。

[这是一篇](http://blogs.msdn.com/jonathanh/archive/2005/05/20/optimizing-managed-c-vs-native-c-code.aspx)关于将 C++ 程序转换为 C# 以及使 C++ 比 C# 更快所需的努力的非常有趣的文章。

因此，如果考虑到开发速度，几乎任何东西都能胜过 C++。

好的，为了解决 OP 的运行时唯一性能要求：**这不是语言，而是**决定运行时性能的语言的实现。我可以编写一个 C++ 编译器来生成可以想象的最慢的代码，但它仍然是 C++。理论上也可以为 Java 编写一个针对 IA32 指令而不是 Java VM 字节码的编译器，从而提高运行时速度。

代码的性能将取决于语言优势与代码要求之间的匹配度。例如，由于 C++ 内存分配策略过于笼统，一个执行大量内存分配/释放的程序在幼稚的 C++ 程序（即使用默认内存分配器）中表现不佳，而 C# 的基于 GC 的分配器可以执行得更好（因为上面的链接显示）。字符串操作在 C++ 中很慢，但在 php、perl 等语言中却很快。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-08T05:14:47.950

在实际应用中，D 有时会比 C++ 更快，主要是因为垃圾收集的存在有助于避免使用智能指针时 RAII 和引用计数的开销。对于分配大量具有重要生命周期的小对象的程序，垃圾收集可能比 C++ 风格的内存管理更快。此外，D 的内置数组允许编译器在某些情况下执行比编译器不理解的 C++ 的 STL 向量更好的优化。此外，D2 支持不可变数据和纯函数注释，最近的 DMD2 版本在此基础上进行了优化。D 的创建者 Walter Bright 用 D 和 C++ 编写了一个 JavaScript 解释器，据他说，D 版本更快。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T13:09:19.980

这一切都取决于编译器，例如 Stalin Scheme 编译器，它几乎胜过 Debian 微型基准测试套件中的所有语言，但他们是否提到了编译时间？

不，我怀疑（我以前没有使用过斯大林）为基准编译（我在最大努力水平下进行所有优化）除了最小的代码片段之外的任何东西都需要很长时间。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-04T13:13:28.537

编译语言的性能是一个无用的概念：重要的是编译器的质量，即它能够应用哪些优化。例如，通常（但并非总是）英特尔 C++ 编译器生成的代码性能优于 g++。那么如何衡量 C++ 的性能呢？

语言语义的用处在于程序员让编译器创建最佳输出是多么容易。例如，并行化 Fortran 代码通常比 C 代码更容易，这就是为什么 Fortran 仍然大量用于高性能计算（例如气候模拟）的原因。

* * *

正如问题和一些答案提到的汇编程序：这里也是如此，它只是另一种编译语言，因此本质上并不“更快”。汇编程序和其他语言之间的区别在于，程序员（理想情况下对程序有绝对的了解）负责所有优化，而不是将其中一些优化委托给“愚蠢的”编译器。

例如，汇编器中的函数调用可以使用寄存器来传递参数并且不需要创建不必要的堆栈帧，但是一个好的编译器也可以做到这一点（想想内联或快速调用）。使用汇编程序的缺点是性能更好的算法更难实现（想想线性搜索与二进制搜索、哈希表查找......）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T13:16:21.493

如果代码*不是为了性能而编写的，*那么[C# 比 C++ 快](http://blogs.msdn.com/ricom/archive/2005/05/10/performance-quiz-6-chinese-english-dictionary-reader.aspx)。

必要的免责声明：**所有基准都是邪恶的。**

这是[支持 C++](http://shootout.alioth.debian.org/gp4/benchmark.php?test=all&lang=gpp&lang2=csharp&box=1)的基准。

以上两个链接表明我们可以找到 C++ 比 C# 更快的情况，反之亦然。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-08T05:30:42.780

比 C++ 做得更好主要是为了让编译器理解程序员的意思。这方面的一个例子可能是任何语言的编译器推断代码区域独立于其输入并且仅在编译时计算结果值的实例。

另一个例子是 C# 如何生成一些非常高性能的代码，仅仅是因为编译器知道特定的咒语“意味着”什么，并且可以巧妙地使用产生最高性能的实现，其中将同一程序音译成 C++ 会导致不必要的分配/删除循环（被模板隐藏），因为编译器正在处理一般情况而不是这段代码给出的特定情况。

最后一个例子可能是 C 的 Brook/Cuda 改编版，它是为不再那么奇特的奇特硬件而设计的。该语言支持映射到正在编译的非冯诺依曼硬件的确切原语（内核函数）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-08T22:24:22.283

这就是您使用托管浏览器的原因吗？因为它更快。或托管操作系统，因为它更快。不，等一下，它是 SQL 数据库。等等，它一定是你在玩的游戏。停，肯定有一段数字代码 Java和Csharp坦白用没用。顺便说一句，您必须检查您的虚拟机是用什么编写的，以渣根语言并说它很慢。

真是个误解，但嘿，给我看一个快速托管的应用程序，这样我们都可以开怀大笑。VS？开发办公室？

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-09T14:59:08.740

啊...好老问题 - 哪个编译器可以更快地编写代码？

1.  它只在实际花费大量时间在调用堆栈底部的代码中很重要，即不包含函数调用的热点，例如矩阵求逆等。

2.  （由 1 暗示）它只在编译器实际看到的代码中很重要。如果您的程序计数器将所有时间都花在您不构建的第 3 方库中，那没关系。

3.  在重要的代码中，这一切都归结为哪个编译器使 ASM 更好，这在很大程度上取决于源代码编写得有多聪明或有多愚蠢。

有了所有这些变量，很难区分好的编译器。

但是，如前所述，如果您有很多 Fortran 代码要编译，请不要重新编写它。

# nlp - 查找与特定单词相关的单词（特别是物理对象）

> ID：610399
> 
> 赞同：18
> 
> 时间：2009-03-04T12:51:25.530
> 
> 标签：nlp, semantics, wordnet

我正在尝试查找与单个单词相关的单词（特别是物理对象）。例如：

**网球**：网球拍、网球、网球鞋

**斯诺克**：斯诺克球杆、斯诺克球、粉笔

**国际象棋**：棋盘、棋子

**书柜**：书

我曾尝试使用 WordNet，特别是 meronym 语义关系；但是，这种方法并不一致，如下结果所示：

**网球**：发球、截击、脚误、设定点、回球、优势

**斯诺克**：*没什么*

**国际象棋**：国际象棋移动，棋盘（其自身的meronym关系显示“正方形”和“对角线”）

**书柜**：搁板

最终将需要对术语进行加权，但现在这并不是一个真正的问题。

有人对如何做到这一点有任何建议吗？

* * *

只是更新：最终混合使用了 Jeff 和 StompChicken 的答案。

从 Wikipedia 检索到的信息质量非常好，特别是如何（不出所料）有这么多相关信息（与一些不存在诸如“博客”和“ipod”之类的术语的语料库相比）。

维基百科的结果范围是最好的部分。该软件能够匹配以下术语（为简洁起见，列表被删减）：

*   高尔夫：[球、铁、发球台、球包、球杆]
*   摄影：[相机，胶卷，照片，艺术，图像]
*   钓鱼：[鱼，网，钩，陷阱，诱饵，诱饵，竿]

最大的问题是将某些词归类为物理人工制品；默认 WordNet 不是可靠的资源，因为其中不存在许多术语（例如“ipod”，甚至“蹦床”）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-04T16:09:04.900

我认为您要的是概念之间语义关系的来源。为此，我可以想到多种方法：

1.  **[语义相似性算法](http://en.wikipedia.org/wiki/Semantic_similarity)**。这些算法通常在 Wordnet 中对关系执行树遍历，以得出两个术语相关程度的实值分数。这些将受到 WordNet 对您感兴趣的概念的建模程度的限制[。WordNet::Similarity](http://www.d.umn.edu/~tpederse/similarity.html)（用 Perl 编写）非常好。
2.  **尝试使用[OpenCyc](http://www.cyc.com/cyc/opencyc/overview)作为知识库**。OpenCyc 是 Cyc 的开源版本，Cyc 是一个非常庞大的“真实世界”事实知识库。它应该有比 WordNet 更丰富的语义关系集。但是，我从来没有使用过 OpenCyc，所以我不能说它有多完整，或者它是多么容易使用。
3.  **n-gram 频率分析**。正如杰夫·莫泽所说。一种数据驱动的方法，可以从大量数据中“发现”关系，但通常会产生嘈杂的结果。
4.  **[潜在语义分析](http://en.wikipedia.org/wiki/Latent_semantic_analysis)**。一种类似于 n-gram 频率分析的数据驱动方法，可以找到语义相关的词集。

[...]

从你说你想做的事情来看，我认为最后两个选项更有可能成功。如果关系不在 Wordnet 中，那么语义相似性将不起作用，并且 OpenCyc 似乎对[斯诺克](http://sw.opencyc.org/concept/Mx4rwEu0nZwpEbGdrcN5Y29ycA)了解不多，除了它存在的事实。

我认为结合使用 n-gram 和 LSA（或类似的东西）将是一个好主意。N-gram 频率会找到与您的目标概念紧密结合的概念（例如网球），而 LSA 会找到在同一个句子/文档中提到的相关概念（例如 net、service）。此外，如果您只对名词感兴趣，则将输出过滤为仅包含名词或名词短语（通过使用[词性标记器](http://en.wikipedia.org/wiki/Part-of-speech_tagging)）可能会改善结果。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T13:10:43.177

在第一种情况下，您可能正在寻找n = 2 的[n-gram](http://googleresearch.blogspot.com/2006/08/all-our-n-gram-are-belong-to-you.html)。您可以从 Google 等地方获取它们，或者从[所有 Wikipedia](http://download.wikimedia.org/backup-index.html)中创建您自己的。

有关更多信息，请查看[这个相关的 Stack Overflow 问题](https://stackoverflow.com/questions/571932/building-or-finding-a-relevant-terms-suggestion-feature/573286#573286)。

# html - 无法使 3 列布局在 IE7 的列表中工作

> ID：610401
> 
> 赞同：0
> 
> 时间：2009-03-04T12:52:02.003
> 
> 标签：html, css

我正在尝试在列表项中创建一个液体 3 列区域。为了实现这一点，我使用了具有 3 个元素的标准方法，其中前两个是侧面，左右浮动，第三个是内容，应该位于两者之间。以下 HTML 在 Firefox 中运行良好，但在 IE7 中无法正确呈现 - 内容呈现在两个浮动元素下方。任何想法是什么问题？

```
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <style>
        *
        {
            margin: 0;
            padding: 0;
            border: 0;
        }
        span
        {
            display:block;
        }
        .corner
        {
            width: 12px;
            height: 12px;
        }
        .tl
        {
            float: left;
        }

        .tr
        {
            float: right;
        }
        .fill
        {
            margin: 0px 12px;
        }
    </style>
  </head>
  <body>
    <ul>
      <li>
        <span class="tl corner">a</span>
        <span class="tr corner">b</span>
        <span class="fill">text text text</span>
      </li>
    </ul>
  </body>
</html> 
```

请注意，用 div 替换跨度会产生相同的效果。我也尝试过各种 DocTypes，但都没有运气。它在列表之外工作正常，因此问题似乎是使用列表所固有的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:37:39.757

在 IE 看​​来，你正试图一个接一个地塞进线路，但前两个已经占据了它们的空间，FLOATing 离开了，这使得 LI 中的最后一个 SPAN 为下一个级别而战，这在 IE 中看起来像下面的下一个级别。

由于最后一个 SPAN 没有浮动，这也是它被敲到下一个级别的原因。

此外，SPAN 是内联样式，而不是块级元素。如果您仍想尝试在 LI 元素中设置样式，则应将 SPAN 替换为 DIV。

您还应该使用完整的 DOCTYPE，以便浏览器知道如何呈现页面。否则他们将默认为怪癖模式，丑陋且到处都是。

但更好的策略是在 LI 之外和 DIV 设置中创建这个 3 列的浮点数。

阅读有关创建 3 列布局的[CSSplay](http://www.cssplay.co.uk/layouts/three-column-layouts.html)或[Max Design 。](http://css.maxdesign.com.au/floatutorial/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T13:07:33.870

没有看到标记就很难说什么，但是为什么不把两个应该浮动的元素放在内容元素中呢？您必须在内容元素上使用一些填充进行调整，但这应该可以完成工作。再说一次，不太清楚你的意思。如果您向我们提供更多标记，则更容易分辨。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:52:42.403

中心块的两侧应有边距，为浮动块留出空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T14:20:56.393

答案是将跨度包装在块级元素（例如 div）中，并将溢出设置为隐藏。示例来自对第二个 CSSplay 示例的更深入了解。

# c# - 如何防止我的 Timer 在其回调执行之前收集 GC？

> ID：610402
> 
> 赞同：0
> 
> 时间：2009-03-04T12:52:07.573
> 
> 标签：c#

我需要创建一堆计时器作为局部变量来执行以下操作：

```
void Foo()
{
    Timer t = new Timer(myTimerCallback,null,1000,Timeout.Infinite);
} 
```

不幸的是，其中一些在 1 秒后调用 myTimerCallback 之前被 GC 收集。由于我有这么多定时器，不可能将它们存储在私有静态成员中。而且也很难找到放置 GC.Keeplive(t) 的地方。

我怎样才能让每个计时器在死前做他们的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T12:53:53.683

最好的办法是将它们存储在一个成员变量中，然后在不再需要它们时将它们丢弃。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T12:54:55.460

将它们存储在成员中，例如`List<Timer>`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T12:57:49.353

为什么无法存储它们？也许您可以在他们的工作完成后将它们从该集合中删除？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T13:07:01.220

重要的是看到 GC.KeepAlive() 不能解决你的问题。这只是将对象的生命周期延长到语句。只要计时器需要保持活动状态，您就必须循环或阻塞。另请注意，局部变量中引用的生命周期在 Debug 构建中是不同的。JIT 使它们保持生命，直到方法结束以允许手表工作。产生棘手的“在调试中工作，在发布模式下不起作用”的问题。

您必须保留对计时器对象的生命引用。这通常是通过类中的一个字段来完成的。生命周期要求现在传递给类对象，只要需要计时器，它就需要保持活动状态。通常不是问题。如果是，您必须将引用设为静态。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T13:49:34.657

您可以将它们存储在集合中以保留引用，并在事件方法中从集合中删除引用。我认为您需要使用 state 参数来标识集合中的计时器（传递对计时器的引用或集合中的键作为“新计时器”语句中的状态参数）。

请注意，回调函数在其他线程上执行，因此您将/可能同时运行多个回调函数。使用锁定来确保添加/删除引用是安全的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-12T12:22:27.737

# A. System.Threading vs System.Timers

值得指出的是，保留参考问题是特定于`System.Threading.Timer`而不是`System.Timers.Timer`.

* * *

# B. Threading.Timer的Timer(TimerCallback callback)构造函数

这不是您问题的解决方案，但我认为它仍然与该主题相关。

`System.Threading.Timer`的`Timer(TimerCallback callback)`构造函数（不采用 the`dueTime`和其他构造函数的构造函数）使用`this`这`state`意味着计时器将保留对自身的引用，这意味着它将在垃圾收集中幸存下来。

```
public Timer(TimerCallback callback)
{
    (...)
    TimerSetup(callback, this, (UInt32)dueTime, (UInt32)period, ref stackMark);
} 
```

## 例子

计时器'C'是使用创建的`Timer(TimerCallback callback)`，它只是不断追求`GC.Collect()`。

### 输出

```
A
B
C
A
B
C
GC Collected
B
C
C
B
B
C 
```

### 代码

```
class TimerExperiment
{
    System.Threading.Timer timerB;

    public TimerExperiment()
    {
        StartTimer("A"); // Not keeping this timer
        timerB = StartTimer("B"); // Keeping this timer
        StartTimer2("C"); // Not keeping this timer
    }

    static System.Threading.Timer StartTimer(string name) {
        return new System.Threading.Timer(_ =>
        {
            Console.WriteLine($"{name}");
        }, null, dueTime: Delay(name), period: TimeSpan.FromSeconds(1));
    }

    static System.Threading.Timer StartTimer2(string name)
    {
        //Create the timer using the constructor which only takes the callback
        var t = new System.Threading.Timer( _ => Console.WriteLine($"{name}"));
        t.Change(dueTime: Delay(name), period: TimeSpan.FromSeconds(1));
        return t;
    }

    static TimeSpan Delay(string name) 
            => TimeSpan.FromMilliseconds(Convert.ToInt64(name[0])*10);

}

class Program
{
    static async Task Main(string[] args)
    {
        var withTimers = new TimerExperiment();

        await Task.Delay(TimeSpan.FromSeconds(2));
        GC.Collect();
        Console.WriteLine("GC Collected");
        Console.ReadLine();
    }
} 
```

# python - 使用“期望”方法捕获 Python 异常？

> ID：610403
> 
> 赞同：1
> 
> 时间：2009-03-04T12:52:33.657
> 
> 标签：python

```
import sys
try:
        file = open("words.txt")
expect(IOError):

if file:
    print "%s" % file
else:
    print "Cant the %s file" % "words.txt" 
```

这给了我一个错误-

```
File "main.py", line 4 
    expect(IOError):
    SyntaxError: invaild syntax 
```

我出了什么问题/你如何解决这个问题

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T12:54:46.413

实际上，它是例外情况：

例如：

```
except IOError:
    print "Error opening file!" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T12:58:38.463

我假设您正在尝试处理异常。在这种情况下，请使用**except**，而不是**expect**。在任何情况下 except**都不是函数**，而是在错误处理代码块之前。使用文件时，您可能需要查看**with 语句**和**try-except-finally**。对您的代码的更正是-

```
import sys
try:
        file = open("words.txt")
except IOError:
      #Handle error
      pass
if file:
    print "%s" % file
else:
    print "Cant the %s file" % "words.txt" 
```

我希望这有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T12:55:52.510

是`except`。读[这个](http://docs.python.org/tutorial/index.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T12:57:38.840

我想你正在寻找[except](http://docs.python.org/reference/compound_stmts.html#except)。python 教程的[错误处理](http://docs.python.org/tutorial/errors.html)部分很好地解释了这一点。

-约翰

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T13:05:25.873

```
 >>> try:
...     f = open('words.txt')
... except IOError:
...     print "Cant the %s file" % "words.txt"
... else:
...     print "%s" % f 

```

# javascript - JavaScript 等价于 printf/String.Format

> ID：610406
> 
> 赞同：2258
> 
> 时间：2009-03-04T12:53:02.017
> 
> 标签：javascript, printf, string.format

我正在寻找与 C/PHP`printf()`或 C#/Java 程序员`String.Format()`（`IFormatProvider`对于 .NET）相当的好的 JavaScript。

我现在的基本要求是数字的千位分隔符格式，但是处理大量组合（包括日期）的东西会很好。

我意识到微软的[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)库提供了一个版本`String.Format()`，但我们不想要该框架的全部开销。

* * *

## 回答 #1

> 赞同：1469
> 
> 时间：2011-01-12T20:02:34.957

基于先前建议的解决方案：

```
// First, checks if it isn't implemented yet.
if (!String.prototype.format) {
  String.prototype.format = function() {
    var args = arguments;
    return this.replace(/{(\d+)}/g, function(match, number) { 
      return typeof args[number] != 'undefined'
        ? args[number]
        : match
      ;
    });
  };
} 
```

`"{0} is dead, but {1} is alive! {0} {2}".format("ASP", "ASP.NET")`

输出

> ASP 已死，但 ASP.NET 还活着！ASP {2}

* * *

如果您不想修改`String`的原型：

```
if (!String.format) {
  String.format = function(format) {
    var args = Array.prototype.slice.call(arguments, 1);
    return format.replace(/{(\d+)}/g, function(match, number) { 
      return typeof args[number] != 'undefined'
        ? args[number] 
        : match
      ;
    });
  };
} 
```

给你更熟悉的：

`String.format('{0} is dead, but {1} is alive! {0} {2}', 'ASP', 'ASP.NET');`

结果相同：

> ASP 已死，但 ASP.NET 还活着！ASP {2}

* * *

## 回答 #2

> 赞同：1462
> 
> 时间：2009-03-04T12:55:22.293

## 当前的 JavaScript

从 ES6 开始，您可以使用模板字符串：

```
let soMany = 10;
console.log(`This is ${soMany} times easier!`);
// "This is 10 times easier! 
```

有关详细信息，请参阅下面的 Kim 的[回答](https://stackoverflow.com/a/32202320/2430448)。

* * *

## 较旧的答案

为 JavaScript尝试[sprintf()](https://github.com/alexei/sprintf.js)。

* * *

如果你真的想自己做一个简单的格式化方法，不要连续做替换，而是同时做。

因为当先前替换的替换字符串也包含如下格式序列时，提到的大多数其他建议都会失败：

```
"{0}{1}".format("{1}", "{0}") 
```

通常你会期望输出是，`{1}{0}`但实际输出是`{1}{1}`. [所以像恐惧噬菌体的建议](https://stackoverflow.com/questions/610406/javascript-printf-string-format/4673436#4673436)那样做一个同时替换。

* * *

## 回答 #3

> 赞同：585
> 
> 时间：2013-08-14T14:20:15.503

这很有趣，因为 Stack Overflow 实际上有自己的`String`原型格式化函数，称为`formatUnicorn`. 尝试一下！进入控制台并输入如下内容：

```
"Hello, {name}, are you feeling {adjective}?".formatUnicorn({name:"Gabriel", adjective: "OK"}); 
```

![萤火虫](https://i.stack.imgur.com/jYeIc.png)

你得到这个输出：

`Hello, Gabriel, are you feeling OK?`

您可以使用对象、数组和字符串作为参数！我得到了它的代码并对其进行了修改以产生一个新版本`String.prototype.format`：

```
String.prototype.formatUnicorn = String.prototype.formatUnicorn ||
function () {
    "use strict";
    var str = this.toString();
    if (arguments.length) {
        var t = typeof arguments[0];
        var key;
        var args = ("string" === t || "number" === t) ?
            Array.prototype.slice.call(arguments)
            : arguments[0];

        for (key in args) {
            str = str.replace(new RegExp("\\{" + key + "\\}", "gi"), args[key]);
        }
    }

    return str;
}; 
```

请注意这个聪明的`Array.prototype.slice.call(arguments)`调用——这意味着如果您输入字符串或数字的参数，而不是单个 JSON 样式的对象，您将[`String.Format`](https://msdn.microsoft.com/en-us/library/system.string.format(v=vs.110).aspx#Starting)几乎完全得到 C# 的行为。

```
"a{0}bcd{1}ef".formatUnicorn("FOO", "BAR"); // yields "aFOObcdBARef" 
```

那是因为`Array`'s`slice`将强制`arguments`进入 a 中的任何内容`Array`，无论它最初是否`key`为`"\\{0\\}"`对于您的第一个正则表达式模式）。

整洁的。

* * *

## 回答 #4

> 赞同：337
> 
> 时间：2011-08-12T14:12:11.767

# JavaScript 中的数字格式

我来到这个问题页面，希望找到如何在 JavaScript 中**格式化数字**，而无需引入另一个库。这是我发现的：

## 舍入浮点数

JavaScript 中的等价物`sprintf("%.2f", num)`似乎是`num.toFixed(2)`，格式`num`为小数点后 2 位，四舍五入（但请参阅`Math.round`下面的@ars265 评论）。

```
(12.345).toFixed(2); // returns "12.35" (rounding!)
(12.3).toFixed(2); // returns "12.30" (zero padding) 
```

## 指数形式

的等价物`sprintf("%.2e", num)`是`num.toExponential(2)`。

```
(33333).toExponential(2); // "3.33e+4" 
```

## 十六进制和其他基数

要以 B 为底打印数字，请尝试`num.toString(B)`. JavaScript 支持从 2 到 36 的自动转换（此外，一些浏览器[对 base64 编码的支持有限](https://developer.mozilla.org/en-US/docs/DOM/window.btoa)）。

```
(3735928559).toString(16); // to base 16: "deadbeef"
parseInt("deadbeef", 16); // from base 16: 3735928559 
```

## 参考页

[JS数字格式化快速教程](http://www.mredkj.com/javascript/numberFormat.html)

[toFixed() 的 Mozilla 参考页面](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number/toFixed)（带有 toPrecision()、toExponential()、toLocaleString()、...的链接）

* * *

## 回答 #5

> 赞同：283
> 
> 时间：2015-08-25T11:03:03.077

从 ES6 开始，您可以使用**模板字符串**：

```
let soMany = 10;
console.log(`This is ${soMany} times easier!`);
// "This is 10 times easier! 
```

请注意，模板字符串被**反引号 ` 包围，**而不是（单）引号。

了解更多信息：

[https://developers.google.com/web/updates/2015/01/ES6-Template-Strings](https://developers.google.com/web/updates/2015/01/ES6-Template-Strings)

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings)

*注意：检查 mozilla 站点以查找支持的浏览器列表。*

* * *

## 回答 #6

> 赞同：179
> 
> 时间：2010-11-23T12:41:40.710

jsxt, 芝宝

这个选项更适合。

```
String.prototype.format = function() {
    var formatted = this;
    for (var i = 0; i < arguments.length; i++) {
        var regexp = new RegExp('\\{'+i+'\\}', 'gi');
        formatted = formatted.replace(regexp, arguments[i]);
    }
    return formatted;
}; 
```

使用此选项，我可以替换如下字符串：

```
'The {0} is dead. Don\'t code {0}. Code {1} that is open source!'.format('ASP', 'PHP'); 
```

使用您的代码，第二个 {0} 不会被替换。;)

* * *

## 回答 #7

> 赞同：117
> 
> 时间：2010-08-16T11:52:16.673

我使用这个简单的功能：

```
String.prototype.format = function() {
    var formatted = this;
    for( var arg in arguments ) {
        formatted = formatted.replace("{" + arg + "}", arguments[arg]);
    }
    return formatted;
}; 
```

这与 string.format 非常相似：

```
"{0} is dead, but {1} is alive!".format("ASP", "ASP.NET") 
```

* * *

## 回答 #8

> 赞同：97
> 
> 时间：2014-04-15T14:59:03.747

对于[Node.js](http://en.wikipedia.org/wiki/Node.js)用户，[`util.format`](https://nodejs.org/api/util.html#utilformatformat-args)它具有类似 printf 的功能：

```
util.format("%s world", "Hello") 
```

* * *

## 回答 #9

> 赞同：60
> 
> 时间：2015-06-23T16:08:11.647

我很惊讶没有人使用[`reduce`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce)，这是一个原生的简洁而强大的 JavaScript 功能。

## ES6 (EcmaScript2015)

```
String.prototype.format = function() {
  return [...arguments].reduce((p,c) => p.replace(/%s/,c), this);
};

console.log('Is that a %s or a %s?... No, it\'s %s!'.format('plane', 'bird', 'SOman'));
```

## < ES6

```
function interpolate(theString, argumentArray) {
    var regex = /%s/;
    var _r=function(p,c){return p.replace(regex,c);}
    return argumentArray.reduce(_r, theString);
}

interpolate("%s, %s and %s", ["Me", "myself", "I"]); // "Me, myself and I" 
```

这个怎么运作：

> *reduce*对累加器和数组中的每个元素（从左到右）应用一个函数，以将其减少为单个值。

```
var _r= function(p,c){return p.replace(/%s/,c)};

console.log(
  ["a", "b", "c"].reduce(_r, "[%s], [%s] and [%s]") + '\n',
  [1, 2, 3].reduce(_r, "%s+%s=%s") + '\n',
  ["cool", 1337, "stuff"].reduce(_r, "%s %s %s")
);
```

* * *

## 回答 #10

> 赞同：53
> 
> 时间：2011-01-25T16:13:19.333

这是 sprintf 在 JavaScript 中的*最小*实现：它只执行“%s”和“%d”，但我为它留出了扩展空间。它对 OP 没用，但其他偶然发现来自 Google 的线程的人可能会从中受益。

```
function sprintf() {
    var args = arguments,
    string = args[0],
    i = 1;
    return string.replace(/%((%)|s|d)/g, function (m) {
        // m is the matched format, e.g. %s, %d
        var val = null;
        if (m[2]) {
            val = m[2];
        } else {
            val = args[i];
            // A switch statement so that the formatter can be extended. Default is %s
            switch (m) {
                case '%d':
                    val = parseFloat(val);
                    if (isNaN(val)) {
                        val = 0;
                    }
                    break;
            }
            i++;
        }
        return val;
    });
} 
```

例子：

```
alert(sprintf('Latitude: %s, Longitude: %s, Count: %d', 41.847, -87.661, 'two'));
// Expected output: Latitude: 41.847, Longitude: -87.661, Count: 0 
```

与之前回复中的类似解决方案相比，这个解决方案一次性完成所有替换*，*因此它不会替换先前替换值的部分。

* * *

## 回答 #11

> 赞同：32
> 
> 时间：2010-10-14T11:05:48.747

JavaScript 程序员可以在[https://github.com/ildar-shaimordanov/jsxt/blob/master/js/String.js](https://github.com/ildar-shaimordanov/jsxt/blob/master/js/String.js)使用 String.prototype.sprintf 。下面是例子：

```
var d = new Date();
var dateStr = '%02d:%02d:%02d'.sprintf(
    d.getHours(), 
    d.getMinutes(), 
    d.getSeconds()); 
```

* * *

## 回答 #12

> 赞同：26
> 
> 时间：2013-03-10T20:49:42.377

添加到`zippoxer`的答案，我使用这个功能：

```
String.prototype.format = function () {
    var a = this, b;
    for (b in arguments) {
        a = a.replace(/%[a-z]/, arguments[b]);
    }
    return a; // Make chainable
};

var s = 'Hello %s The magic number is %d.';
s.format('world!', 12); // Hello World! The magic number is 12. 
```

我也有一个非原型版本，我更经常使用它的类似 Java 的语法：

```
function format() {
    var a, b, c;
    a = arguments[0];
    b = [];
    for(c = 1; c < arguments.length; c++){
        b.push(arguments[c]);
    }
    for (c in b) {
        a = a.replace(/%[a-z]/, b[c]);
    }
    return a;
}
format('%d ducks, 55 %s', 12, 'cats'); // 12 ducks, 55 cats 
```

## ES 2015 更新

ES 2015 中所有很酷的新东西使这变得容易多了：

```
function format(fmt, ...args){
    return fmt
        .split("%%")
        .reduce((aggregate, chunk, i) =>
            aggregate + chunk + (args[i] || ""), "");
}

format("Hello %%! I ate %% apples today.", "World", 44);
// "Hello World, I ate 44 apples today." 
```

我想，因为这和旧的一样，实际上并没有解析字母，所以它还不如只使用一个 token `%%`。这样做的好处是显而易见并且不会使使用单个`%`. 但是，如果`%%`出于某种原因需要，则需要将其替换为自身：

```
format("I love percentage signs! %%", "%%");
// "I love percentage signs! %%" 
```

* * *

## 回答 #13

> 赞同：25
> 
> 时间：2012-11-18T11:32:30.583

我想分享我对“问题”的解决方案。我没有重新发明轮子，而是试图根据 JavaScript 已经做的事情找到解决方案。优点是，您可以免费获得所有隐式转换。设置 String 的原型属性 $ 给出了一个非常好的和紧凑的语法（见下面的例子）。这可能不是最有效的方法，但在大多数情况下处理输出它不必进行超级优化。

```
String.form = function(str, arr) {
    var i = -1;
    function callback(exp, p0, p1, p2, p3, p4) {
        if (exp=='%%') return '%';
        if (arr[++i]===undefined) return undefined;
        exp  = p2 ? parseInt(p2.substr(1)) : undefined;
        var base = p3 ? parseInt(p3.substr(1)) : undefined;
        var val;
        switch (p4) {
            case 's': val = arr[i]; break;
            case 'c': val = arr[i][0]; break;
            case 'f': val = parseFloat(arr[i]).toFixed(exp); break;
            case 'p': val = parseFloat(arr[i]).toPrecision(exp); break;
            case 'e': val = parseFloat(arr[i]).toExponential(exp); break;
            case 'x': val = parseInt(arr[i]).toString(base?base:16); break;
            case 'd': val = parseFloat(parseInt(arr[i], base?base:10).toPrecision(exp)).toFixed(0); break;
        }
        val = typeof(val)=='object' ? JSON.stringify(val) : val.toString(base);
        var sz = parseInt(p1); /* padding size */
        var ch = p1 && p1[0]=='0' ? '0' : ' '; /* isnull? */
        while (val.length<sz) val = p0 !== undefined ? val+ch : ch+val; /* isminus? */
       return val;
    }
    var regex = /%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;
    return str.replace(regex, callback);
}

String.prototype.$ = function() {
    return String.form(this, Array.prototype.slice.call(arguments));
} 
```

这里有一些例子：

```
String.format("%s %s", [ "This is a string", 11 ])
console.log("%s %s".$("This is a string", 11))
var arr = [ "12.3", 13.6 ]; console.log("Array: %s".$(arr));
var obj = { test:"test", id:12 }; console.log("Object: %s".$(obj));
console.log("%c", "Test");
console.log("%5d".$(12)); // '   12'
console.log("%05d".$(12)); // '00012'
console.log("%-5d".$(12)); // '12   '
console.log("%5.2d".$(123)); // '  120'
console.log("%5.2f".$(1.1)); // ' 1.10'
console.log("%10.2e".$(1.1)); // '   1.10e+0'
console.log("%5.3p".$(1.12345)); // ' 1.12'
console.log("%5x".$(45054)); // ' affe'
console.log("%20#2x".$("45054")); // '    1010111111111110'
console.log("%6#2d".$("111")); // '     7'
console.log("%6#16d".$("affe")); // ' 45054' 
```

* * *

## 回答 #14

> 赞同：21
> 
> 时间：2010-09-01T18:05:24.200

+1 Zippo，但函数体需要如下所示，否则它会在每次迭代时附加当前字符串：

```
String.prototype.format = function() {
    var formatted = this;
    for (var arg in arguments) {
        formatted = formatted.replace("{" + arg + "}", arguments[arg]);
    }
    return formatted;
}; 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2009-03-04T13:04:30.930

我将添加我自问以来发现的自己的发现：

*   [number_format（千位分隔符/货币格式）](http://locutus.io/php/strings/number_format/index.html)
*   [sprintf（与上述作者相同）](http://locutus.io/php/strings/sprintf/index.html)

可悲的是，似乎 sprintf 不能像.NET 的字符串格式那样处理千位分隔符格式。

* * *

## 回答 #16

> 赞同：14
> 
> 时间：2009-09-27T08:36:00.703

我为 JavaScript 使用了一个名为[String.format](http://www.masterdata.se/r/string_format_for_javascript/)的小型库，它支持大多数格式字符串功能（包括数字和日期的格式），并使用 .NET 语法。脚本本身小于 4 kB，因此不会产生太多开销。

* * *

## 回答 #17

> 赞同：13
> 
> 时间：2009-03-04T13:10:59.337

如果您希望处理千位分隔符，您应该真正使用 JavaScript [Number](http://www.hunlock.com/blogs/The_Complete_Javascript_Number_Reference)类中的 toLocaleString()，因为它将为用户区域格式化字符串。

JavaScript [Date](http://www.hunlock.com/blogs/Javascript_Dates-The_Complete_Reference)类可以格式化本地化的日期和时间。

* * *

## 回答 #18

> 赞同：13
> 
> 时间：2011-12-11T10:59:49.807

十分优雅：

```
String.prototype.format = function (){
    var args = arguments;
    return this.replace(/\{\{|\}\}|\{(\d+)\}/g, function (curlyBrack, index) {
        return ((curlyBrack == "{{") ? "{" : ((curlyBrack == "}}") ? "}" : args[index]));
    });
};

// Usage:
"{0}{1}".format("{1}", "{0}") 
```

信贷去~~[（断开的链接）](http://technoblogia.net/2011/11/08/%D7%98%D7%99%D7%A4-%D7%A4%D7%95%D7%A0%D7%A7%D7%A6%D7%99%D7%99%D7%AA-%D7%A2%D7%96%D7%A8-%D7%91-javascript-%D7%9C%D7%A2%D7%99%D7%A6%D7%95%D7%91-%D7%9E%D7%97%D7%A8%D7%95%D7%96%D7%95%D7%AA/)~~ [https://gist.github.com/0i0/1519811](https://gist.github.com/0i0/1519811)

* * *

## 回答 #19

> 赞同：12
> 
> 时间：2021-10-26T06:31:04.653

# 3种不同的方式来[格式化javascript字符串](https://www.tutorialstonight.com/javascript-string-format.php)

通过用变量值替换占位符来格式化字符串有 3 种不同的方法。

1.  使用模板文字（反引号``）

    ```
    let name = 'John';
    let age = 30;
    // using backticks
    console.log(`${name} is ${age} years old.`);
    // John is 30 years old.
    ```

2.  使用串联

```
let name = 'John';
let age = 30;
// using concatenation
console.log(name + ' is ' + age + ' years old.');
// John is 30 years old.
```

3.  创建自己的格式功能

```
String.prototype.format = function () {
  var args = arguments;
  return this.replace(/{([0-9]+)}/g, function (match, index) {
    // check if the argument is there
    return typeof args[index] == 'undefined' ? match : args[index];
  });
};

console.log('{0} is {1} years old.'.format('John', 30));
```

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2009-03-04T12:55:53.070

JavaScript 有“sprintf”，您可以在[http://www.webtoolkit.info/javascript-sprintf.html](http://www.webtoolkit.info/javascript-sprintf.html)找到。

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2011-04-15T12:25:52.100

PHPJS[项目](http://phpjs.org/)为许多 PHP 函数编写了 JavaScript 实现。由于 PHP 的`sprintf()`功能与 C 的基本相同`printf()`，[因此它们的 JavaScript 实现](http://phpjs.org/functions/sprintf)应该可以满足您的需求。

* * *

## 回答 #22

> 赞同：9
> 
> 时间：2014-03-27T13:19:15.850

我用这个：

```
String.prototype.format = function() {
    var newStr = this, i = 0;
    while (/%s/.test(newStr))
        newStr = newStr.replace("%s", arguments[i++])

    return newStr;
} 
```

然后我称之为：

```
"<h1>%s</h1><p>%s</p>".format("Header", "Just a test!"); 
```

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2014-05-07T13:03:42.717

我有一个非常接近彼得的解决方案，但它处理数字和对象的情况。

```
if (!String.prototype.format) {
  String.prototype.format = function() {
    var args;
    args = arguments;
    if (args.length === 1 && args[0] !== null && typeof args[0] === 'object') {
      args = args[0];
    }
    return this.replace(/{([^}]*)}/g, function(match, key) {
      return (typeof args[key] !== "undefined" ? args[key] : match);
    });
  };
} 
```

也许处理所有深度案例可能会更好，但对于我的需要，这很好。

```
"This is an example from {name}".format({name:"Blaine"});
"This is an example from {0}".format("Blaine"); 
```

[PS：如果您在AngularJS](http://en.wikipedia.org/wiki/AngularJS)等模板框架中使用翻译，此功能非常酷：

```
<h1> {{('hello-message'|translate).format(user)}} <h1>
<h1> {{('hello-by-name'|translate).format( user ? user.name : 'You' )}} <h1> 
```

en.json 类似于

```
{
    "hello-message": "Hello {name}, welcome.",
    "hello-by-name": "Hello {0}, welcome."
} 
```

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2012-10-11T15:40:03.133

一个略有不同的版本，我更喜欢的版本（这个使用 {xxx} 标记而不是 {0} 编号的参数，这更加自我记录并且更适合本地化）：

```
String.prototype.format = function(tokens) {
  var formatted = this;
  for (var token in tokens)
    if (tokens.hasOwnProperty(token))
      formatted = formatted.replace(RegExp("{" + token + "}", "g"), tokens[token]);
  return formatted;
}; 
```

一个变化是：

```
 var formatted = l(this); 
```

首先调用 l() 本地化函数。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2015-12-08T14:18:22.337

对于基本格式：

```
var template = jQuery.validator.format("{0} is not a valid value");
var result = template("abc"); 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2012-06-01T06:44:25.043

[我在这里](https://github.com/tracker1/core-js/blob/master/js-extensions/100-String.format.js)有一个稍长的 JavaScript 格式化程序...

您可以通过多种方式进行格式化：

*   `String.format(input, args0, arg1, ...)`
*   `String.format(input, obj)`
*   `"literal".format(arg0, arg1, ...)`
*   `"literal".format(obj)`

此外，如果您说 ObjectBase.prototype.format （例如使用[DateJS](http://www.datejs.com/)），它将使用它。

例子...

```
var input = "numbered args ({0}-{1}-{2}-{3})";
console.log(String.format(input, "first", 2, new Date()));
//Outputs "numbered args (first-2-Thu May 31 2012...Time)-{3})"

console.log(input.format("first", 2, new Date()));
//Outputs "numbered args(first-2-Thu May 31 2012...Time)-{3})"

console.log(input.format(
    "object properties ({first}-{second}-{third:yyyy-MM-dd}-{fourth})"
    ,{
        'first':'first'
        ,'second':2
        ,'third':new Date() //assumes Date.prototype.format method
    }
));
//Outputs "object properties (first-2-2012-05-31-{3})" 
```

我还使用了 .asFormat 的别名，并进行了一些检测，以防已经存在 string.format（例如使用 MS Ajax Toolkit（我讨厌那个库）。

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2015-01-20T09:15:57.020

以防万一有人需要一个函数来防止污染全局范围，这里有一个函数可以做同样的事情：

```
 function _format (str, arr) {
    return str.replace(/{(\d+)}/g, function (match, number) {
      return typeof arr[number] != 'undefined' ? arr[number] : match;
    });
  }; 
```

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2015-01-23T04:47:21.613

对于喜欢[Node.JS](http://nodejs.org)及其[`util.format`](http://nodejs.org/api/util.html#util_util_format_format)特性的人，我刚刚将其提取到其原生 JavaScript 形式中（仅包含 util.format 使用的函数）：

```
exports = {};

function isString(arg) {
    return typeof arg === 'string';
}
function isNull(arg) {
    return arg === null;
}
function isObject(arg) {
    return typeof arg === 'object' && arg !== null;
}
function isBoolean(arg) {
    return typeof arg === 'boolean';
}
function isUndefined(arg) {
    return arg === void 0;
}
function stylizeNoColor(str, styleType) {
    return str;
}
function stylizeWithColor(str, styleType) {
    var style = inspect.styles[styleType];

    if (style) {
        return '\u001b[' + inspect.colors[style][0] + 'm' + str +
            '\u001b[' + inspect.colors[style][3] + 'm';
    } else {
        return str;
    }
}
function isFunction(arg) {
    return typeof arg === 'function';
}
function isNumber(arg) {
    return typeof arg === 'number';
}
function isSymbol(arg) {
    return typeof arg === 'symbol';
}
function formatPrimitive(ctx, value) {
    if (isUndefined(value))
        return ctx.stylize('undefined', 'undefined');
    if (isString(value)) {
        var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '')
                .replace(/'/g, "\\'")
                .replace(/\\"/g, '"') + '\'';
        return ctx.stylize(simple, 'string');
    }
    if (isNumber(value)) {
        // Format -0 as '-0'. Strict equality won't distinguish 0 from -0,
        // so instead we use the fact that 1 / -0 < 0 whereas 1 / 0 > 0 .
        if (value === 0 && 1 / value < 0)
            return ctx.stylize('-0', 'number');
        return ctx.stylize('' + value, 'number');
    }
    if (isBoolean(value))
        return ctx.stylize('' + value, 'boolean');
    // For some reason typeof null is "object", so special case here.
    if (isNull(value))
        return ctx.stylize('null', 'null');
    // es6 symbol primitive
    if (isSymbol(value))
        return ctx.stylize(value.toString(), 'symbol');
}
function arrayToHash(array) {
    var hash = {};

    array.forEach(function (val, idx) {
        hash[val] = true;
    });

    return hash;
}
function objectToString(o) {
    return Object.prototype.toString.call(o);
}
function isDate(d) {
    return isObject(d) && objectToString(d) === '[object Date]';
}
function isError(e) {
    return isObject(e) &&
        (objectToString(e) === '[object Error]' || e instanceof Error);
}
function isRegExp(re) {
    return isObject(re) && objectToString(re) === '[object RegExp]';
}
function formatError(value) {
    return '[' + Error.prototype.toString.call(value) + ']';
}
function formatPrimitiveNoColor(ctx, value) {
    var stylize = ctx.stylize;
    ctx.stylize = stylizeNoColor;
    var str = formatPrimitive(ctx, value);
    ctx.stylize = stylize;
    return str;
}
function isArray(ar) {
    return Array.isArray(ar);
}
function hasOwnProperty(obj, prop) {
    return Object.prototype.hasOwnProperty.call(obj, prop);
}
function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {
    var name, str, desc;
    desc = Object.getOwnPropertyDescriptor(value, key) || {value: value[key]};
    if (desc.get) {
        if (desc.set) {
            str = ctx.stylize('[Getter/Setter]', 'special');
        } else {
            str = ctx.stylize('[Getter]', 'special');
        }
    } else {
        if (desc.set) {
            str = ctx.stylize('[Setter]', 'special');
        }
    }
    if (!hasOwnProperty(visibleKeys, key)) {
        name = '[' + key + ']';
    }
    if (!str) {
        if (ctx.seen.indexOf(desc.value) < 0) {
            if (isNull(recurseTimes)) {
                str = formatValue(ctx, desc.value, null);
            } else {
                str = formatValue(ctx, desc.value, recurseTimes - 1);
            }
            if (str.indexOf('\n') > -1) {
                if (array) {
                    str = str.split('\n').map(function (line) {
                        return '  ' + line;
                    }).join('\n').substr(2);
                } else {
                    str = '\n' + str.split('\n').map(function (line) {
                        return '   ' + line;
                    }).join('\n');
                }
            }
        } else {
            str = ctx.stylize('[Circular]', 'special');
        }
    }
    if (isUndefined(name)) {
        if (array && key.match(/^\d+$/)) {
            return str;
        }
        name = JSON.stringify('' + key);
        if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) {
            name = name.substr(1, name.length - 2);
            name = ctx.stylize(name, 'name');
        } else {
            name = name.replace(/'/g, "\\'")
                .replace(/\\"/g, '"')
                .replace(/(^"|"$)/g, "'")
                .replace(/\\\\/g, '\\');
            name = ctx.stylize(name, 'string');
        }
    }

    return name + ': ' + str;
}
function formatArray(ctx, value, recurseTimes, visibleKeys, keys) {
    var output = [];
    for (var i = 0, l = value.length; i < l; ++i) {
        if (hasOwnProperty(value, String(i))) {
            output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
                String(i), true));
        } else {
            output.push('');
        }
    }
    keys.forEach(function (key) {
        if (!key.match(/^\d+$/)) {
            output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
                key, true));
        }
    });
    return output;
}
function reduceToSingleString(output, base, braces) {
    var length = output.reduce(function (prev, cur) {
        return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
    }, 0);

    if (length > 60) {
        return braces[0] +
            (base === '' ? '' : base + '\n ') +
            ' ' +
            output.join(',\n  ') +
            ' ' +
            braces[1];
    }

    return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
}
function formatValue(ctx, value, recurseTimes) {
    // Provide a hook for user-specified inspect functions.
    // Check that value is an object with an inspect function on it
    if (ctx.customInspect &&
        value &&
        isFunction(value.inspect) &&
            // Filter out the util module, it's inspect function is special
        value.inspect !== exports.inspect &&
            // Also filter out any prototype objects using the circular check.
        !(value.constructor && value.constructor.prototype === value)) {
        var ret = value.inspect(recurseTimes, ctx);
        if (!isString(ret)) {
            ret = formatValue(ctx, ret, recurseTimes);
        }
        return ret;
    }

    // Primitive types cannot have properties
    var primitive = formatPrimitive(ctx, value);
    if (primitive) {
        return primitive;
    }

    // Look up the keys of the object.
    var keys = Object.keys(value);
    var visibleKeys = arrayToHash(keys);

    if (ctx.showHidden) {
        keys = Object.getOwnPropertyNames(value);
    }

    // This could be a boxed primitive (new String(), etc.), check valueOf()
    // NOTE: Avoid calling `valueOf` on `Date` instance because it will return
    // a number which, when object has some additional user-stored `keys`,
    // will be printed out.
    var formatted;
    var raw = value;
    try {
        // the .valueOf() call can fail for a multitude of reasons
        if (!isDate(value))
            raw = value.valueOf();
    } catch (e) {
        // ignore...
    }

    if (isString(raw)) {
        // for boxed Strings, we have to remove the 0-n indexed entries,
        // since they just noisey up the output and are redundant
        keys = keys.filter(function (key) {
            return !(key >= 0 && key < raw.length);
        });
    }

    // Some type of object without properties can be shortcutted.
    if (keys.length === 0) {
        if (isFunction(value)) {
            var name = value.name ? ': ' + value.name : '';
            return ctx.stylize('[Function' + name + ']', 'special');
        }
        if (isRegExp(value)) {
            return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
        }
        if (isDate(value)) {
            return ctx.stylize(Date.prototype.toString.call(value), 'date');
        }
        if (isError(value)) {
            return formatError(value);
        }
        // now check the `raw` value to handle boxed primitives
        if (isString(raw)) {
            formatted = formatPrimitiveNoColor(ctx, raw);
            return ctx.stylize('[String: ' + formatted + ']', 'string');
        }
        if (isNumber(raw)) {
            formatted = formatPrimitiveNoColor(ctx, raw);
            return ctx.stylize('[Number: ' + formatted + ']', 'number');
        }
        if (isBoolean(raw)) {
            formatted = formatPrimitiveNoColor(ctx, raw);
            return ctx.stylize('[Boolean: ' + formatted + ']', 'boolean');
        }
    }

    var base = '', array = false, braces = ['{', '}'];

    // Make Array say that they are Array
    if (isArray(value)) {
        array = true;
        braces = ['[', ']'];
    }

    // Make functions say that they are functions
    if (isFunction(value)) {
        var n = value.name ? ': ' + value.name : '';
        base = ' [Function' + n + ']';
    }

    // Make RegExps say that they are RegExps
    if (isRegExp(value)) {
        base = ' ' + RegExp.prototype.toString.call(value);
    }

    // Make dates with properties first say the date
    if (isDate(value)) {
        base = ' ' + Date.prototype.toUTCString.call(value);
    }

    // Make error with message first say the error
    if (isError(value)) {
        base = ' ' + formatError(value);
    }

    // Make boxed primitive Strings look like such
    if (isString(raw)) {
        formatted = formatPrimitiveNoColor(ctx, raw);
        base = ' ' + '[String: ' + formatted + ']';
    }

    // Make boxed primitive Numbers look like such
    if (isNumber(raw)) {
        formatted = formatPrimitiveNoColor(ctx, raw);
        base = ' ' + '[Number: ' + formatted + ']';
    }

    // Make boxed primitive Booleans look like such
    if (isBoolean(raw)) {
        formatted = formatPrimitiveNoColor(ctx, raw);
        base = ' ' + '[Boolean: ' + formatted + ']';
    }

    if (keys.length === 0 && (!array || value.length === 0)) {
        return braces[0] + base + braces[1];
    }

    if (recurseTimes < 0) {
        if (isRegExp(value)) {
            return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
        } else {
            return ctx.stylize('[Object]', 'special');
        }
    }

    ctx.seen.push(value);

    var output;
    if (array) {
        output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
    } else {
        output = keys.map(function (key) {
            return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
        });
    }

    ctx.seen.pop();

    return reduceToSingleString(output, base, braces);
}
function inspect(obj, opts) {
    // default options
    var ctx = {
        seen: [],
        stylize: stylizeNoColor
    };
    // legacy...
    if (arguments.length >= 3) ctx.depth = arguments[2];
    if (arguments.length >= 4) ctx.colors = arguments[3];
    if (isBoolean(opts)) {
        // legacy...
        ctx.showHidden = opts;
    } else if (opts) {
        // got an "options" object
        exports._extend(ctx, opts);
    }
    // set default options
    if (isUndefined(ctx.showHidden)) ctx.showHidden = false;
    if (isUndefined(ctx.depth)) ctx.depth = 2;
    if (isUndefined(ctx.colors)) ctx.colors = false;
    if (isUndefined(ctx.customInspect)) ctx.customInspect = true;
    if (ctx.colors) ctx.stylize = stylizeWithColor;
    return formatValue(ctx, obj, ctx.depth);
}
exports.inspect = inspect;

// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics
inspect.colors = {
    'bold': [1, 22],
    'italic': [3, 23],
    'underline': [4, 24],
    'inverse': [7, 27],
    'white': [37, 39],
    'grey': [90, 39],
    'black': [30, 39],
    'blue': [34, 39],
    'cyan': [36, 39],
    'green': [32, 39],
    'magenta': [35, 39],
    'red': [31, 39],
    'yellow': [33, 39]
};

// Don't use 'blue' not visible on cmd.exe
inspect.styles = {
    'special': 'cyan',
    'number': 'yellow',
    'boolean': 'yellow',
    'undefined': 'grey',
    'null': 'bold',
    'string': 'green',
    'symbol': 'green',
    'date': 'magenta',
    // "name": intentionally not styling
    'regexp': 'red'
};

var formatRegExp = /%[sdj%]/g;
exports.format = function (f) {
    if (!isString(f)) {
        var objects = [];
        for (var j = 0; j < arguments.length; j++) {
            objects.push(inspect(arguments[j]));
        }
        return objects.join(' ');
    }

    var i = 1;
    var args = arguments;
    var len = args.length;
    var str = String(f).replace(formatRegExp, function (x) {
        if (x === '%%') return '%';
        if (i >= len) return x;
        switch (x) {
            case '%s':
                return String(args[i++]);
            case '%d':
                return Number(args[i++]);
            case '%j':
                try {
                    return JSON.stringify(args[i++]);
                } catch (_) {
                    return '[Circular]';
                }
            default:
                return x;
        }
    });
    for (var x = args[i]; i < len; x = args[++i]) {
        if (isNull(x) || !isObject(x)) {
            str += ' ' + x;
        } else {
            str += ' ' + inspect(x);
        }
    }
    return str;
}; 
```

收获自：[https ://github.com/joyent/node/blob/master/lib/util.js](https://github.com/joyent/node/blob/master/lib/util.js)

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2019-06-13T08:04:28.877

我们可以为 Typescript 使用一个简单的轻量级[String.Format](https://github.com/sevensc/typescript-string-operations#stringformat)字符串操作库。

**字符串格式（）：**

```
var id = image.GetId()
String.Format("image_{0}.jpg", id)
output: "image_2db5da20-1c5d-4f1a-8fd4-b41e34c8c5b5.jpg"; 
```

**说明符的字符串格式：**

```
var value = String.Format("{0:L}", "APPLE"); //output "apple"

value = String.Format("{0:U}", "apple"); // output "APPLE"

value = String.Format("{0:d}", "2017-01-23 00:00"); //output "23.01.2017"

value = String.Format("{0:s}", "21.03.2017 22:15:01") //output "2017-03-21T22:15:01"

value = String.Format("{0:n}", 1000000);
//output "1.000.000"

value = String.Format("{0:00}", 1);
//output "01" 
```

**对象的字符串格式，包括说明符：**

```
var fruit = new Fruit();
fruit.type = "apple";
fruit.color = "RED";
fruit.shippingDate = new Date(2018, 1, 1);
fruit.amount = 10000;

String.Format("the {type:U} is {color:L} shipped on {shippingDate:s} with an amount of {amount:n}", fruit);
// output: the APPLE is red shipped on 2018-01-01 with an amount of 10.000 
```

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2018-04-24T07:44:01.870

使用[Lodash](https://lodash.com/)，您可以获得模板功能：

使用 ES 模板文字分隔符作为“插值”分隔符。通过替换“插值”分隔符禁用支持。

```
var compiled = _.template('hello ${ user }!');
compiled({ 'user': 'pebbles' });
// => 'hello pebbles! 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2014-07-24T20:05:27.353

我没有在列表中看到[pyformat](https://www.npmjs.org/package/pyformat)所以我想我会把它扔进去：

```
console.log(pyformat( 'The {} {} jumped over the {}'
                , ['brown' ,'fox' ,'foobar']
                ))
console.log(pyformat('The {0} {1} jumped over the {1}'
                , ['brown' ,'fox' ,'foobar']
                ))
console.log(pyformat('The {color} {animal} jumped over the {thing}'
                , [] ,{color: 'brown' ,animal: 'fox' ,thing: 'foobaz'}
                )) 
```

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2020-03-23T17:46:59.953

**另一个建议是您使用字符串模板：**

```
const getPathDadosCidades = (id: string) =>  `/clientes/${id}`

const getPathDadosCidades = (id: string, role: string) =>  `/clientes/${id}/roles/${role}` 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2012-10-10T07:53:36.660

我没有看到`String.format`变体：

```
String.format = function (string) {
    var args = Array.prototype.slice.call(arguments, 1, arguments.length);
    return string.replace(/{(\d+)}/g, function (match, number) {
        return typeof args[number] != "undefined" ? args[number] : match;
    });
}; 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2013-02-01T05:40:12.720

用于 jQuery.ajax() 成功函数。仅传递一个参数并将字符串替换为该对象的属性作为 {propertyName}：

```
String.prototype.format = function () {
    var formatted = this;
    for (var prop in arguments[0]) {
        var regexp = new RegExp('\\{' + prop + '\\}', 'gi');
        formatted = formatted.replace(regexp, arguments[0][prop]);
    }
    return formatted;
}; 
```

例子：

```
var userInfo = ("Email: {Email} - Phone: {Phone}").format({ Email: "someone@somewhere.com", Phone: "123-123-1234" }); 
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2013-03-04T19:26:59.880

使用 sprintf.js - 可以制作一个漂亮的小格式

```
String.prototype.format = function(){
    var _args = arguments 
    Array.prototype.unshift.apply(_args,[this])
    return sprintf.apply(undefined,_args)
}   
// this gives you:
"{%1$s}{%2$s}".format("1", "0")
// {1}{0} 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2016-01-02T22:07:13.693

```
/**
 * Format string by replacing placeholders with value from element with
 * corresponsing index in `replacementArray`.
 * Replaces are made simultaneously, so that replacement values like
 * '{1}' will not mess up the function.
 *
 * Example 1:
 * ('{2} {1} {0}', ['three', 'two' ,'one']) -> 'one two three'
 *
 * Example 2:
 * ('{0}{1}', ['{1}', '{0}']) -> '{1}{0}'
 */
function stringFormat(formatString, replacementArray) {
    return formatString.replace(
        /\{(\d+)\}/g, // Matches placeholders, e.g. '{1}'
        function formatStringReplacer(match, placeholderIndex) {
            // Convert String to Number
            placeholderIndex = Number(placeholderIndex);

            // Make sure that index is within replacement array bounds
            if (placeholderIndex < 0 ||
                placeholderIndex > replacementArray.length - 1
            ) {
                return placeholderIndex;
            }

            // Replace placeholder with value from replacement array
            return replacementArray[placeholderIndex];
        }
    );
} 
```

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2011-06-13T16:16:44.060

`arg`功能：

```
/**
 * Qt stil arg()
 * var scr = "<div id='%1' class='%2'></div>".arg("mydiv").arg("mydivClass");
 */
String.prototype.arg = function() {
    var signIndex = this.indexOf("%");
    var result = this;
    if (signIndex > -1 && arguments.length > 0) {
        var argNumber = this.charAt(signIndex + 1);
        var _arg = "%"+argNumber;
        var argCount = this.split(_arg);
        for (var itemIndex = 0; itemIndex < argCount.length; itemIndex++) {
            result = result.replace(_arg, arguments[0]);
        }
    }
    return result;
} 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2011-07-20T12:56:24.550

[jQuery Globalize](https://github.com/jquery/globalize)项目中也有`Globalize.format`jQuery UI 的官方全球化服务。当您需要文化感知格式时，它很好。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2013-08-01T18:14:20.963

我需要一个可以以用户喜欢的方式格式化价格（以美分给出）的函数，棘手的部分是格式由用户指定——我不希望我的用户理解类似 printf 的语法, 或正则表达式等。我的解决方案有点类似于 Basic 中使用的解决方案，因此用户只需用 # 位标记数字，例如：

```
simple_format(1234567,"$ ###,###,###.##")
"$ 12,345.67"
simple_format(1234567,"### ### ###,## pln")
"12 345,67 pln" 
```

我相信这很容易被用户理解，并且很容易实现：

```
function simple_format(integer,format){
  var text = "";
  for(var i=format.length;i--;){
    if(format[i]=='#'){
      text = (integer%10) + text;
      integer=Math.floor(integer/10);
      if(integer==0){
        return format.substr(0,i).replace(/#(.*#)?/,"")+text;
      }
    }else{
      text = format[i] + text;
    }
  }
  return text;
} 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2019-05-10T12:30:43.343

```
String.prototype.format = function(){
    var final = String(this);
    for(let i=0; i<arguments.length;i++){
        final = final.replace(`%s${i+1}`, arguments[i])
    }
    return final || ''
}

console.log(("hello %s2 how %s3 you %s1").format('hi', 'hello', 'how'));
```

```
<h1 id="text">

</h1>
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2020-03-03T22:29:05.487

在打字稿中创建一个名为的文件并将`format.ts`其导入您需要使用格式的任何内容。

```
// contents of format.ts

interface String {
  format(...args: any[]): string;
}

if (!String.prototype.format) {
  String.prototype.format = function() {
    let a = this;
    let b: any;
    // tslint:disable-next-line: forin
    for (b in arguments) {
      a = a.replace(/%[a-z]/, arguments[b]);
    }
    return a;
  };
} 
```

要格式化字符串，请使用以下代码：

```
import './format';

console.log('Hello, %s!'.format('World')); 
```

## 例子

```
String.prototype.format = function() {
  let a = this;
  let b;
  for (b in arguments) {
    a = a.replace(/%[a-z]/, arguments[b]);
  }
  return a;
};

console.log('Hello, %s!'.format('World'));
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2020-09-18T07:19:19.327

如果您只需要使用**%s 说明符格式化字符串**

```
function _sprintf(message){
    const regexp = RegExp('%s','g');
    let match;
    let index = 1;
    while((match = regexp.exec(message)) !== null) {
        let replacement = arguments[index];
        if (replacement) {
            let messageToArray = message.split('');
            messageToArray.splice(match.index, regexp.lastIndex - match.index, replacement);
            message = messageToArray.join('');
            index++;
        } else {
            break;
        }
    }

    return message;
}

_sprintf("my name is %s, my age is %s", "bob", 50); // my name is bob, my age is 50 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2021-06-18T18:06:23.120

现在，有一个名为[**locutus**](https://www.npmjs.com/package/locutus)的包，它可以将其他语言的功能翻译成 Javascript，例如 php、python、ruby 等。

```
const printf = require('locutus/php/strings/printf')
printf('Hello world'); 
```

你可以试试这个游乐场[代码盒](https://codesandbox.io/s/admiring-napier-quyz5?file=/src/index.js)

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2021-09-06T11:00:48.363

好的，所以首先我们将设置一些要使用的变量：

```
 const date = new Date();

    const locale = 'en-us';

    const wDay   = date.toLocaleString(locale, {weekday: 'short'});
    const month  = date.toLocaleString(locale, {month: 'long'});
    const year   = date.toLocaleString(locale, {year: 'numeric'});
    const minute = date.toLocaleString(locale, {minute: 'numeric'});
    const [hour, ap] = date.toLocaleString(locale, {hour: 'numeric', hour12:true}).split(' ');

    let mDay = date.toLocaleString(locale, {day: 'numeric'});

    switch(mDay % 10)
    {
        case 1:  mDay += 'st'; break;
        case 2:  mDay += 'nd'; break;
        case 3:  mDay += 'rd'; break;
        default: mDay += 'th'; break;
    } 
```

现在我们已经掌握了所有这些，我们可以像这样格式化一个字符串：

```
 const formatter = (...a) => `${a[0]}, the ${a[1]} of ${a[2]} ${a[3]} at ${a[4]}:${a[5]} ${a[6]}`;
    const formatted = formatter(wDay, mDay, month, year, hour, minute, ap); 
```

我们甚至可以为“格式化程序”函数使用命名参数：

```
 const formatter = (wDay, mDay, month, year, hour, minute, ap) => `${wDay}, the ${mDay} of ${month} ${year} at ${hour}:${minute} ${ap}`;
    const formatted = formatter(wDay, mDay, month, year, hour, minute, ap); 
```

如果你注意到，上面的 JS 模板都是回调的结果。如果上面的整段代码被封装在一个预期返回格式化日期的函数中，那么不难想象如何以相同的方式构造一个任意的“格式化程序”函数，该函数可以从外部传入。

**tl; dr 如果将模板文字放在回调中并使用 args 作为替换，则可以重用模板文字。**

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2012-09-29T11:53:32.883

这个适用于 {0}、{1} 和 {}。

```
String.prototype.format = function format()
{                                                                                                               
  var msg = this;
  for(var i in arguments)
    msg = msg.replace(/\{\}/,arguments[i]).replace(new RegExp('\\{'+i+'\\}','g'),arguments[i]);
  return msg;
} 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2012-12-04T07:08:50.837

你可以使用这个功能

```
 String.prototype.format = function (args) {
            var str = this;
            return str.replace(String.prototype.format.regex, function(item) {
                var intVal = parseInt(item.substring(1, item.length - 1));
                var replace;
                if (intVal >= 0) {
                    replace = args[intVal];
                } else if (intVal === -1) {
                    replace = "{";
                } else if (intVal === -2) {
                    replace = "}";
                } else {
                    replace = "";
                }
                return replace;
            });
        };
        String.prototype.format.regex = new RegExp("{-?[0-9]+}", "g");

        // Sample usage.
        var str = "She {1} {0}{2} by the {0}{3}. {-1}^_^{-2}";
        str = str.format(["sea", "sells", "shells", "shore"]);
        alert(str); 
```

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2013-04-01T15:18:58.987

[bobjs](http://www.bobjs.com)可以这样做：

```
var sFormat = "My name is {0} and I am {1} years old."; 
var result = bob.string.formatString(sFormat, "Bob", 29); 
console.log(result); 
//output: 
//========== 
// My name is Bob and I am 29 years old. 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2013-04-24T19:18:16.647

```
String.prototype.repeat = function(n) { 
    return new Array(++n).join(this); 
};

String.prototype.pad = function(requiredLength, paddingStr, paddingType) {    
    var n = requiredLength - this.length; 

    if (n) {
        paddingType = paddingType ? paddingType.toLowerCase() : '';
        paddingStr = paddingStr || ' ';
        paddingStr = paddingStr.repeat( Math.ceil(n / paddingStr.length) ).substr(0, n);

        if (paddingType == 'both') {
            n /= 2;
            return paddingStr.substr( 0, Math.ceil(n) ) + this + paddingStr.substr( 0, Math.floor(n) );
        }   

        if (paddingType == 'left') {
            return paddingStr + this;
        }

        return this + paddingStr;
    } 

    return this; 
}; 

// синтаксис аналогичен printf
// 'Привет, %s!'.format('мир') -> "Привет, мир!"
// '%.1s.%.1s. %s'.format('Иван', 'Иванович', 'Иванов') -> "И.И. Иванов"
String.prototype.format = function() {
    var i = 0, 
        params = arguments;

    return this.replace(/%(?:%|(?:(|[+-]+)(|0|'.+?)([1-9]\d*)?(?:\.([1-9]\d*))?)?(s|d|f))/g, function(match, sign, padding, width, precision, type) {
        if (match == '%%') { 
            return '%'; 
        }

        var v = params[i++];

        if (type == 'd') { 
            v = Math.round(v); 
        }
        else if (type == 'f') {
            v = v.toFixed(precision ? precision : 6);
        }

        if (/\+/.test(sign) && v > 0) {
            v = '+' + v;
        }

        v += '';

        if (type != 'f' && precision) {
            v = v.substr(0, precision);
        }

        if (width) {
            v = v.pad(width, padding == '' ? ' ' : padding[0] == "'" ? padding.substr(1) : padding, /-/.test(sign) ? 'right' : 'left'); 
        }

        return v;
    });
};

// this.name = 'Вася';
// console.log( 'Привет, ${name}!'.template(this) );
// "Привет, Вася!"
String.prototype.template = function(context) {
    return this.replace(/\$\{(.*?)\}/g, function(match, name) {
        return context[name];
    });
}; 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2015-01-11T19:00:56.227

`Java` `String.format`我开始将（实际上是新的 Formatter().format()）移植到 javascript。初始版本可在以下位置获得：

[https://github.com/RobAu/javascript.string.format](https://github.com/RobAu/javascript.string.format)

您可以简单地添加 javscript 和调用`StringFormat.format("%.2f", [2.4]);`等。

请注意它还没有完成，但欢迎反馈:)

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2016-01-24T14:26:35.200

这不是 ; 的完全重复`sprintf`。但是，它相似且更强大：[https ://github.com/anywhichway/stringformatter](https://github.com/anywhichway/stringformatter)

使用此库的格式表达式采用嵌入式 Javascript 对象的形式，例如

```
format("I have {number: {currency: "$", precision:2}}.",50.2); 
```

将返回`"I have $50.20."`。

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2019-12-16T05:51:16.037

```
export function stringFormate (str: string, ...args: string[]) {
     return args.reduce((acc, curr, i) => acc.replace(new RegExp("\\{" + i + "\\}", 'g'), curr), str);
} 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2020-09-02T15:49:55.750

不是世界上最推荐的功能，但它确实有效。

如果您需要 sprintf，只需复制并粘贴相同的功能并更改`return console.log(sb)`为`return sb`.

```
printf = function(s, /*args...*/) {
    a = arguments;
    al = a.length;

    if (al <= 1) return -2;
    if (al >= 2 && s.toLowerCase().search(/%[a-z]/) == -1) return -1;

    sb = s;
    for (i = 1; i <= al - 1; i++) {
        sb = sb.replace(/%[a-z]/, a[i]);
    }

    return console.log(sb);
}

var someString = "Hello %s\nIt's %s:%s %s now.\nThe day is %s\n";
printf(someString, "StackOverflowUser", "5", "48", "PM", "beautiful");
```

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2020-10-16T03:20:41.827

**JavaScript 中的sprintf()**函数模拟为**Vue 过滤器**和**String.prototype.format()**扩展：

```
/**
 * Returns a formatted string.
 *
 * @param template
 * @param values
 * @return string
 */
String.format = function (template, ...values) {
    let i = -1;

    function callback(exp, p0, p1, p2, p3, p4) {
        if (exp === '%%') return '%';
        if (values[++i] === undefined) return undefined;

        exp = p2 ? parseInt(p2.substr(1)) : undefined;

        let base = p3 ? parseInt(p3.substr(1)) : undefined;
        let val;

        switch (p4) {
            case 's': val = values[i]; break;
            case 'c': val = values[i][0]; break;
            case 'f': val = parseFloat(values[i]).toFixed(exp); break;
            case 'p': val = parseFloat(values[i]).toPrecision(exp); break;
            case 'e': val = parseFloat(values[i]).toExponential(exp); break;
            case 'x': val = parseInt(values[i]).toString(base ? base : 16); break;
            case 'd': val = parseFloat(parseInt(values[i], base ? base : 10).toPrecision(exp)).toFixed(0); break;
        }
        val = typeof (val) == 'object' ? JSON.stringify(val) : val.toString(base);
        let sz = parseInt(p1); /* padding size */
        let ch = p1 && p1[0] === '0' ? '0' : ' '; /* isnull? */

        while (val.length < sz) val = p0 !== undefined ? val + ch : ch + val; /* isminus? */

        return val;
    }

    let regex = /%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;

    return template.replace(regex, callback);
}

String.prototype.format = function() {
    return String.format(this, ...arguments);
}

const StringFormat = {
    install: (Vue, options) => {
        Vue.filter('format', function () {
            return String.format(...arguments);
        });
    },
};

export default StringFormat; 
```

原始答案：[JavaScript 等价于 printf/String.Format](https://stackoverflow.com/questions/610406/javascript-equivalent-to-printf-string-format/13439711#13439711)

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2021-03-12T09:21:37.870

如果您需要 printf，请使用[printf](https://www.npmjs.com/package/printf)

看起来 90% 的评论者从未使用过格式比 %d 更复杂的 printf。我想知道他们如何输出，例如，货币价值？

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2022-02-09T11:24:28.783

我使用模板文字方法，如下所示：

```
export const messages = {
  foo: (arg1, arg2) => `Hello ${arg1} ${arg2}`,
  bar: (arg1) => `Hello ${arg1}`,
} 
```

从文件中：

```
console.log(messages.foo('Bar', 'World'))
console.log(messages.bar('Foo')) 
```

* * *

## 回答 #56

> 赞同：-1
> 
> 时间：2013-05-29T10:28:18.453

这是CoffeeScript的[https://stackoverflow.com/a/4673436/1258486的实现。](https://stackoverflow.com/a/4673436/1258486)

[https://gist.github.com/eces/5669361](https://gist.github.com/eces/5669361)

```
if String.prototype.format is undefined
  String.prototype.format = () ->
    _arguments = arguments
    this.replace /{(\d+)}/g, (match, number) ->
      if typeof _arguments[number] isnt 'undefined' then _arguments[number] else match 
```

# visual-studio-2008 - VS2008中的自动汇编版本号管理

> ID：610414
> 
> 赞同：13
> 
> 时间：2009-03-04T12:55:13.977
> 
> 标签：visual-studio-2008, assemblies

我有一个用 c# 编写的带有许多程序集的 VS2008 项目。我想要一种简单的方法来管理所有不同程序集之间的版本号，以及一种自动增加内部版本号并将其保存到每个程序集的版本号中的方法。

我猜这是大多数项目的问题，所以大概以前已经解决了？

关于如何简化项目版本资源管理的任何建议？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-04T13:01:22.963

我在解决方案级别使用 .cs 文件，该文件由解决方案中的所有项目链接，其中包含以下几行：

```
using System.Reflection;
[assembly : AssemblyVersion("1.2.3.*")] 
```

并确保`AssemblyFileVersion`从项目中的 AssemblyInfo 文件中删除该属性。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-04T13:01:21.700

将文件放入解决方案中，称为“SolutionInfo.cs”（我假设 C#，也可以在 VB 中工作）。在此放置您共有的所有属性。开始`AssemblyVersionAttribute`。

然后在每个项目*链接*中通过选择将现有项目添加到每个项目，而不是单击添加，使用下拉列表添加为链接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T13:22:20.777

我们在解决方案级别有一个 AssemblyInfoGlobal.cs 文件，就像其他答案一样。然后，作为构建脚本的一部分，我们有一个小应用程序，它采用 CruiseControl.net 定义的 CCNetLabel（并使用 defaultLabeller 生成标签）并签出全局文件，修改版本号，然后将全局文件重新签入.

我们的一些项目有多个解决方案，因此全局文件位于目录结构中的解决方案级别之上，足够高，以至于需要它的所有内容都在它之下。

然后我们还会更新部署项目的版本号——这些版本号可以在 VDProj 文件中找到，但我不确定你会在快速版本中找到这些版本号——我认为这是一个完整的 Professional 升级功能。有些项目有十几个部署项目，但没有简单的方法将版本号从 VDPROJ 文件本身外部化。（或者有吗？）

然后构建发生，这意味着构建的所有输出具有完全相同的版本号，在任何时候我们都可以从 MSI 或程序集获取版本，并且我们确切地知道用于构建该输出的源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-03T18:07:17.353

> `using System.Reflection; [assembly : AssemblyVersion("1.2.3.*")]`

只是对此的评论，自动生成的版本号循环。因此，如果您希望能够对昨天的构建版本具有 1.2.3.X 版本，其中 X < X 今天的构建版本，那么这不是要走的路。

实现这个用途

```
[assembly : AssemblyVersion("1.2.*")] 
```

这将为您提供 1.2.XY 版本，其中今天的 XY 组合比昨天大。我猜XY分别是日期和时间的函数

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T13:00:22.937

您可以编写自定义 MSBuild 任务来执行此操作。看看[这个方法](http://weblogs.asp.net/bradleyb/archive/2005/12/02/432150.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T13:01:38.080

您可以在 AssemblyInfo.cs 中使用星号：

```
// Version information
[assembly: AssemblyVersion( "1.0.*" )] 
```

它会自动增加您的版本号。为了在所有程序集之间共享一个号码......我不确定，但也许您在共享文件中使用了提到的属性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T13:25:26.293

我已经使用 svnversion [**MSBuild 社区任务**](http://msbuildtasks.tigris.org/) 来做这样的事情，我按照[**这里**](http://blog.tfanshteyn.com/2006/10/msbuild-community-tasks.html)的说明进行操作虽然我这样做的方式不跨越多个程序集。

# database - 您是否应该在使用外部系统之前对其进行测试？

> ID：610421
> 
> 赞同：2
> 
> 时间：2009-03-04T12:56:19.747
> 
> 标签：database, web-services, language-agnostic, testing

**注意：**这不适用于单元测试或集成测试。这是在应用程序运行时使用的。

我正在开发一个与多个后端系统通信的系统，该系统可以分为三种类型

*   关系型数据库
*   SOAP 或 WCF 服务
*   文件系统（网络共享）

由于这将在其中运行的环境，无法保证其中任何一个将在运行时可用。事实上，它们中的一些看起来很脆弱，一天会掉很多次:(

想法是在实际代码之前运行一小段测试代码。如果出现问题，则保持请求并轮询，直到目标系统可用为止。测试可能会在代码中重新运行，以检查它在逻辑点是否仍然可用。最终目标是拥有一个非常稳定的系统，无论它与之通信的系统是否稳定（或缺乏稳定性）。

我对这个设计的问题是：

1.  是否存在重大问题？（在测试完成和代码运行之间可能会失败的小事情是可以理解的）
2.  有没有更好的方法来实现这种设计？
3.  使用传统的异常处理和/或事务会更好吗？

**更新**

*   系统需要以协调的方式与后端系统通信。
*   该系统本质上是非常异步的，因此使用排队技术之类的东西很好。
*   即使一个或多个后端系统关闭，系统也必须运行，因为其他系统可能已启动并且可以处理某些信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:15:27.937

无论如何，您*都将*需要传统的异常处理，因为正如您所指出的，在您最后一次检查和实际请求之间总是有可能失败。所以我真的认为你找到的任何解决方案都应该尝试与之顺利交互。

您并没有说明这些易碎资源是否需要以某种协调方式进行交互，这表明您可能应该使用某种事务管理器来执行此操作。我不相信你想在应用程序代码中进入事务管理的步法来满足大多数需求。

有时我还看到人们使用 AOP 将重试逻辑封装到失败的后端系统（例如由于超时问题）。谨慎使用这可能是一个不错的解决方案。

在某些情况下，您还可以使用消息队列技术来缓解不稳定的后端。例如，您可以将消息队列作为事务的一部分提交，并且仅在成功时才从队列中弹出。但是这种设计通常只有在您能够使用异步过程时才有可能。

和往常一样，只有从根本上解决问题，才能实现*真正的稳定。*我在大型机 TCP/IP 堆栈中修复了一个 25 年前的错误，因为我们超出了它，所以这*是*可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:03:11.477

Microsoft Smartclient 框架提供了一个 ConnectionMonitor 类。应该易于使用或复制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T23:03:18.290

我们解决此类问题的方法是在启动我们的主应用程序之前运行一个非常基本的“健全性测试器”。这是胖客户端，因此我们可以在每次应用启动时运行测试。这个健全性测试将出去检查数据库可用性和外部网络（extranet）访问等内容，它也可以扩展到做 web 服务。

如果出现故障，会通知用户，并且至关重要的是，还会向支持/开发团队发送一封电子邮件。这些电子邮件很快变得笨拙，因为创建了这么多，但我们随后设置了过滤器，所以我们知道什么时候发生了真正糟糕的事情。总体而言，该方法运行良好，我们最大的胜利是能够在用户输入数据之前告诉用户系统已关闭，并在漫长的过程中完成了一部分。他们非常喜欢它。

在技​​术层面上，理智是用 C# 编写的，它以传统方式使用异常处理，而不是找到它正在寻找的问题。sanity 程序本身就变成了一个迷你应用程序，它独立于主应用程序。如果我再次这样做，我会使用日志框架来捕获问题，这比我们的硬编码方法更灵活。

# html - 如何使用 css 在跨度包含的两个元素之间打断？

> ID：610423
> 
> 赞同：0
> 
> 时间：2009-03-04T12:56:47.250
> 
> 标签：html, css

我有以下 HTML：

```
<form action="http://localhost:2689/" method="post">
    <span>
        <label for="SearchBag.PowerSearchKeys" id="Label1"> Key words</label>
        <input id="SearchBag.PowerSearchKeys" name="SearchBag.PowerSearchKeys" type="text" value="" />             
        <button id="powerSearchSubmitButton"  class="fancySubmitButton" type="submit"><span><em>Search</em></span></button>
        <a href="Search.mvc/EmptyAdvancedSearch" id="advancedSearchLinkButton"  class="fancyLinkButton"><span><em>Advanced</em></span></a>
    </span>        
</form> 
```

表单的内容需要以宽度为中心（在本例中为 100%）。
锚点需要直接位于按钮下方。

因为一张图片可以说一千个字，这是我出色的绘画艺术技巧的结果：

[![替代文字](https://i.stack.imgur.com/BAd2q.jpg)](https://i.stack.imgur.com/BAd2q.jpg)
[（来源：[telnet.be](http://users.telenet.be/boersnoes/layOut.jpg)）]

整个区块应该以网页为中心。

**--EDIT--**
因为所有控件的内容在长度上变化很大，所以我不能给任何元素任何宽度规格（甚至不是%）。此外，过度估计宽度会在元素之间留下令人困惑的空白。这也不是想要的效果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:13:09.737

尝试在您想要单独一行的每个元素上设置“显示：块”。您可能还需要使用边距和填充以使它们居中（例如 margin-left: 50%; padding-left: -[1/2 width of element]）和 text-align: center。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T14:19:14.680

为什么不在标签 ( ) 之前插入一个中断，
然后将其右对齐？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:01:46.100

我通常浮动表单元素（左），如果我想将下一个元素放在新行上，我使用 clear:left。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T13:45:23.217

我会用语义正确性替换`<span>`（`<fieldset>`我不认为 span 在功能方面会给表格带来很多好处），并对其应用一些样式以`fieldset`适应

```
fieldset {
    text-align: center;
    width: 100%;
    position: relative;
} 
```

我无法确定这是否会正确排列锚点和按钮，但由于`fieldset`已经`position: relative`设置，如果需要，您可以相对轻松地定位东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-25T15:05:02.777

尽管我不想这么说，但在这种情况下，可能会考虑使用表格。但我会尝试定位——我 [在 JSbin做了一个快速而肮脏的解决方案](http://jsbin.com/izewu4/2)

基本上，您将表单放入一个元素中，将其居中`text-align`并制作容器`position: relative`。然后，您使用链接中的 id 将其绝对定位为参考父级。但它仅在父元素是内联元素时才有效。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-04T13:21:19.327

除非您更改其显示属性（并且您不应该），否则该`span`元素应该是内联元素，这意味着它存在于文本流中。将块级元素放在内联元素中并不是一个好主意。

你还有很多无关的标签。而不是这个：

```
<button id="powerSearchSubmitButton" class="fancySubmitButton" type="submit">
    <span><em>Search</em></span>
</button> 
```

为什么不这样做：

```
<button id="powerSearchSubmitButton" class="fancySubmitButton" type="submit">
    Search
</button> 
```

`span`什么都不做，可以`em`通过 CSS 模拟：

```
.fancySubmitButton { font-style: italic }` 
```

这是我要做的：

```
<form>
    <label for="SearchBag.PowerSearchKeys" id="Label1">Key words</label>
    <input id="SearchBag.PowerSearchKeys" name="SearchBag.PowerSearchKeys" type="text" value="" />             
    <button id="powerSearchSubmitButton"  class="fancySubmitButton" type="submit">Search</button>
    <a href="Search.mvc/EmptyAdvancedSearch" id="advancedSearchLinkButton"  class="fancyLinkButton">Advanced</a>
</form> 
```

使用 CSS：

```
form {
    text-align: center;
}
.fancySubmitButton, .fancyLinkButton {
    font-style: italic;
}
.fancyLinkButton {
    display: block;  /* this will put it on its own line */
} 
```

快速回复评论：给“fancyLinkBut​​ton”类提供一些东西*并不*意味着它有圆角。无论如何，如果你想在某些元素上加圆角，我仍然会避免使用无关的标记。如果您使用的任何实现都需要更多包装器元素，那么应该通过 Javascript 添加这些包装器元素。请记住，mozilla 和 webkit 已经支持 CSS 圆角 - 最终 IE 也将支持，并且您将能够轻松更改您的单个 javascript 函数，而不是通过 HTML 来查找任何不需要跨度的地方。

# .net - 检查是否安装了 XP Service Pack 3（和 .net 3.5）的代码

> ID：610428
> 
> 赞同：2
> 
> 时间：2009-03-04T12:57:48.683
> 
> 标签：.net, .net-3.5, servicepacks

我想编写一个程序（在 vb.net 中）来检查客户配置以确保他们......

*   运行 XP Service Pack 3
*   运行 .Net 3.0 或更高版本。
*   如果他们没有运行 .Net 3.5 或更高版本，请给他们一个警告。

或者

*   运行 Vista Service Pack 1。

我该怎么做？有一个 stackoverflow 问题询问如何判断安装了哪个版本的 .NET，但是如何测试安装了哪个 O/S 和 O/S 服务包？

[如何检测安装了哪些 .NET Framework 版本和服务包？](https://stackoverflow.com/questions/199080/how-to-detect-what-net-framework-versions-and-service-packs-are-installed)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T13:02:36.330

我不完全知道 Windows XP SP 3 的版本号（但应该很容易为您查找），但您可以通过以下方式获取版本字符串。

```
 Console.WriteLine(Environment.Version); // CLR version
Console.WriteLine(Environment.OSVersion.VersionString); // OS version string
Console.WriteLine(Environment.OSVersion.ServicePack); // OS SP string

Version requiredVersion = new Version(5, 1, 2600, 0); // Should be XP Prof. with Service Pack 2 (any revision)
if (Environment.OSVersion.Version.Major >= requiredVersion.Major
  && Environment.OSVersion.Version.Minor >= requiredVersion.Minor
  && Environment.OSVersion.Version.Build >= requiredVersion.Build)
{
    // You are running at least Windows XP Prof. with Service Pack 2 or above!
} 
```

确定是否安装了 .NET Framework 3.5 并不容易，因为 3.5 版本只是基于 2.0 的插件。但您可以检查文件夹“C:\WINDOWS\Microsoft.NET\Framework\v3.5”是否存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T13:04:13.690

查看 Microsoft 的这篇文章[如何确定 Visual Basic .NET 或 Visual Basic 2005 中的操作系统服务包级别](http://support.microsoft.com/kb/304722/EN-US/)

# django - Django MPTT - 树过滤

> ID：610438
> 
> 赞同：1
> 
> 时间：2009-03-04T13:00:42.827
> 
> 标签：django, tree, django-templates, plpgsql, django-mptt

我正在使用 MPTT 的模板标签来呈现我的流派树。

```
 {% for genre, structure in genres|tree_info %}
      {% if tree.new_level %}<ul><li>{% else %}</li><li>{% endif %}
         {{ genre.name }}
      {% for level in tree.closed_levels %}</li></ul>{% endfor %}
   {% endfor %} 
```

问题是，我的`genre`对象具有`is_visible`应该受到尊重的属性。

```
 def is_visible(self):  
       if self.is_root_node() or not self.visibility:
           return self.visibility                          
       for parent in self.get_ancestors():
           if not parent.visibility:      
               return False                                    
       return True 
```

实现这一目标的最聪明、最干净的方法是什么？

* * *

**附加信息**

我需要正确生成 (X)HTML 列表嵌套。我已经定义了用于继承可见性检查的 SQL 函数。

```
CREATE OR REPLACE function get_genre_parent_id( _genre_id int )
RETURNS INTEGER AS $$
DECLARE 
    _parent_id INTEGER;
    _genre_id ALIAS FOR $1;    
BEGIN
    SELECT parent_id INTO _parent_id
    FROM product_productgenre
    WHERE id = _genre_id;

    RETURN _parent_id;

END;
$$  LANGUAGE plpgsql;

CREATE OR REPLACE function is_genre_visible( _genre_id int )
RETURNS BOOLEAN AS $$
DECLARE 
    _visible BOOLEAN;
    _genre_id ALIAS FOR $1;    
BEGIN
    SELECT visibility INTO _visible
    FROM product_productgenre
    WHERE id = _genre_id;

    RETURN _visible;

END;
$$  LANGUAGE plpgsql;

CREATE OR REPLACE function is_genre_branch_visible( _genre_id int )
RETURNS BOOLEAN AS $$
DECLARE 
    visible BOOLEAN;
    _genre_id ALIAS FOR $1;
    _temp_genre_id INTEGER;
BEGIN
    visible = true;
    _temp_genre_id := _genre_id;
    -- checking for our own genre
    IF NOT is_genre_visible(_temp_genre_id) THEN
        RETURN false;
    END IF;
    -- iterating through all parent genres
    WHILE get_genre_parent_id(_temp_genre_id) IS NOT NULL LOOP
        _temp_genre_id = get_genre_parent_id(_temp_genre_id);
        IF NOT is_genre_visible(_temp_genre_id) THEN
            RETURN false;
        END IF;
    END LOOP;

    RETURN visible;

END;
$$  LANGUAGE plpgsql; 
```

并尝试覆盖`full_tree_for_model`标记以使其使用自定义管理器，这只是`is_genre_branch_visible(genre_id)`向 QuerySet 添加了额外的内容。~~但是订购出了点问题，无法真正弄清楚。~~

~~加~~它有效，但我不喜欢这种方法，对我来说感觉很丑。

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-03-04T16:58:29.337

嗯，一个简单的

```
{% if genre.is_visible %} 
```

就在for循环里面应该做的伎俩:)

# java - Eclipse Maven 插件无法创建 groovy-maven-archetype 项目

> ID：610442
> 
> 赞同：3
> 
> 时间：2009-03-04T13:01:22.887
> 
> 标签：java, eclipse, maven-2, groovy, plexus

我已经从 Sonatype 安装了 Maven for Eclipse 插件。

（更新站点： http: [//m2eclipse.sonatype.org/update/](http://m2eclipse.sonatype.org/update/)）

我正在创建一个 Maven 项目，并选择使用它`groovy-maven-archetype`作为我的起点。

但是，在进行到一半时，我看到：

```
04/03/09 12:52:28 GMT: [FATAL ERROR] 
org.codehaus.mojo.groovy.stubgen.GenerateStubsMojo#execute()
caused a linkage error (java.lang.NoSuchMethodError). Check the realms:

... snip ...

Realm ID: plexus.core

org.codehaus.plexus.PlexusContainer.createChildContainer
(Ljava/lang/String;Ljava/util/List;Ljava/util/Map;)
Lorg/codehaus/plexus/PlexusContainer; 
```

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-31T21:33:31.863

在命令提示符下，输入： `mvn archetype:generate` 然后，选择`40`(gmaven-archetype-basic) 然后，按照提示进行操作。一旦你有一个 Maven 项目，你可以通过说启用[Eclipse](http://maven.apache.org/plugins/maven-eclipse-plugin/)支持： `mvn eclipse:eclipse`

您可以阅读[构建 Groovy 项目](http://docs.codehaus.org/display/GMAVEN/Building+Groovy+Projects)以获取更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-27T03:39:18.770

目前，让 Groovy-Eclipse、gmaven 和 Eclipse 一起工作似乎相当棘手。`mvn archetype:generate`正如 AWhitford 所提到的，[一旦](http://contraptionsforprogramming.blogspot.com/2009/12/getting-gmaven-to-play-nicely-with.html)您创建了一个使用.

GMaven 为 Java 文件创建的存根会干扰 Groovy-Eclipse，因此该页面上有关注释掉存根创建的部分。但是，我使用了相关错误（[GMAVEN-61](http://jira.codehaus.org/browse/GMAVEN-61)）的评论中提到的方法，并为 gmaven 插件创建了多个执行，如下所示：

```
 <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.groovy.maven</groupId>
        <artifactId>gmaven-plugin</artifactId>
        <version>1.0-rc-3</version>
        <!-- http://jira.codehaus.org/browse/GMAVEN-61 -->
        <executions>
          <execution>
            <id>default-cli</id>
            <goals>
              <goal>compile</goal>
              <goal>testCompile</goal>
            </goals>
          </execution>
          <execution>
            <id>stubsonly</id>
            <goals>
              <goal>generateStubs</goal>
              <goal>generateTestStubs</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build> 
```

我仍然不确定这对于纯 Maven 的使用以及在 Eclipse 中是否都是干净的，但它至少让我停止了花费数小时试图让任何东西工作并让我在我的实际项目中编码.

[Groovy-Eclipse](http://groovy.codehaus.org/Eclipse+Plugin)和GMaven文档非常[适合](http://docs.codehaus.org/display/GMAVEN/Building+Groovy+Projects)阅读背景信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-21T06:37:50.460

对我来说似乎是一个版本控制问题。你确定你使用了所有正确版本的罐子吗？

# java - 为什么通过实例调用静态方法不是 Java 编译器的错误？

> ID：610458
> 
> 赞同：79
> 
> 时间：2009-03-04T13:05:38.523
> 
> 标签：java, static, methods

我相信你们都知道我的意思 - 代码如：

```
Thread thread = new Thread();
int activeCount = thread.activeCount(); 
```

引发编译器警告。为什么不是错误？

**编辑：**

需要明确的是：问题与线程无关。我意识到在讨论这个问题时经常会给出 Thread 示例，因为它们有可能真的把事情搞砸了。但真正的问题是，这种用法*总是*无稽之谈，你不能（有能力）写出这样的电话并认真对待。这种类型的方法调用的任何例子都是愚蠢的。这是另一个：

```
String hello = "hello";
String number123AsString = hello.valueOf(123); 
```

这使它看起来好像每个 String 实例都带有一个“String valueOf(int i)”方法。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-04T13:57:45.230

基本上我认为 Java 设计者在设计语言时犯了一个错误，由于涉及的兼容性问题，现在修复它为时已晚。是的，它会导致非常误导的代码。是的，你应该避免它。是的，您应该确保您的 IDE 配置为将其视为错误，IMO。如果您自己设计过一种语言，请记住它作为要避免的事情的一个例子:)

只是为了回应 DJClayworth 的观点，以下是 C# 中允许的内容：

```
public class Foo
{
    public static void Bar()
    {
    }
}

public class Abc
{
    public void Test()
    {
        // Static methods in the same class and base classes
        // (and outer classes) are available, with no
        // qualification
        Def();

        // Static methods in other classes are available via
        // the class name
        Foo.Bar();

        Abc abc = new Abc();

        // This would *not* be legal. It being legal has no benefit,
        // and just allows misleading code
        // abc.Def();
    }

    public static void Def()
    {
    }
} 
```

为什么我认为它具有误导性？因为如果我查看代码，`someVariable.SomeMethod()`我希望它*使用`someVariable`*. 如果`SomeMethod()`是静态方法，则该期望无效；代码在欺骗我。这怎么可能是*好事*？

奇怪的是，Java 不允许您使用可能未初始化的变量来调用静态方法，尽管事实上它要使用的唯一信息是变量的声明类型。这是一个不一致和无益的混乱。为什么允许？

编辑：此编辑是对 Clayton 的回答的回应，该回答声称它允许继承静态方法。它没有。静态方法不是多态的。这是一个简短但完整的程序来证明：

```
class Base
{
    static void foo()
    {
        System.out.println("Base.foo()");
    }
}

class Derived extends Base
{
    static void foo()
    {
        System.out.println("Derived.foo()");
    }
}

public class Test
{
    public static void main(String[] args)
    {
        Base b = new Derived();
        b.foo(); // Prints "Base.foo()"
        b = null;
        b.foo(); // Still prints "Base.foo()"
    }
} 
```

如您所见， 的执行时间值`b`被完全忽略。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-04T13:46:47.597

为什么它应该是一个错误？该实例可以访问所有静态方法。静态方法不能改变实例的状态（试图改变*是*编译错误）。

您给出的著名示例的问题非常特定于*线程*，而不是静态方法调用。看起来好像您正在获取`activeCount()`引用的线程`thread`，但实际上您正在获取调用线程的计数。这是您作为程序员所犯的逻辑错误。在这种情况下，发出警告是编译器应该做的事情。注意警告并修复代码由您决定。

编辑：我意识到该语言的语法是*允许*您编写误导性代码的原因，但请记住编译器及其警告也是该语言的一部分。该语言允许你做一些编译器认为可疑的事情，但它会给你警告以确保你知道它可能会导致问题。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-04T13:08:31.683

他们不能再让它成为一个错误，因为所有的代码都已经存在了。

我同意你，这应该是一个错误。也许应该有一个选项/配置文件供编译器将一些警告升级为错误。

**更新：**当他们在 1.4 中引入*assert*关键字时，它与旧代码有类似的潜在兼容性问题，他们[仅在您将源模式显式设置为 "1.4" 时才](http://java.sun.com/j2se/1.4.2/docs/guide/lang/assert.html#compatibility)使其可用。我想人们可以在新的源模式“java 7”中使其成为错误。但我怀疑他们会这样做，考虑到它会引起的所有麻烦。正如其他人所指出的，防止您编写令人困惑的代码并不是绝对必要的。在这一点上，对 Java 的语言更改应仅限于严格必要的范围内。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-04T13:08:09.703

简短的回答 - 语言允许，所以它不是错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T13:13:02.220

可能对于使这不是错误的相同逻辑：

```
public class X
{
    public static void foo()
    {
    }

    public void bar()
    {
        foo(); // no need to do X.foo();
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-04T13:23:08.917

从编译器的角度来看，真正重要的是它能够解析符号。在静态方法的情况下，它需要知道要在哪个类中查找它——因为它不与任何特定对象相关联。Java 的设计者显然决定，既然他们可以确定一个对象的类，他们也可以从该对象的任何实例解析该对象的任何静态方法的类。他们选择允许这一点——也许是被@TofuBeer 的观察所左右——给程序员一些便利。其他语言设计者做出了不同的选择。我可能会落入后者阵营，但这对我来说没什么大不了的。我可能会允许@TofuBeer 提到的用法，

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-04T18:47:10.793

这不是错误，因为它是规范的一部分，但您显然是在询问基本原理，我们都可以猜到。

我的猜测是，它的根源实际上是允许类中的方法调用同一个类中的静态方法而没有麻烦。由于调用 x() 是合法的（即使没有 self 类名），调用 this.x() 也应该是合法的，因此通过任何对象调用也是合法的。

这也有助于鼓励用户在不更改状态的情况下将私有函数转换为静态。

此外，编译器通常会尽量避免声明错误，因为这不可能导致直接错误。由于静态方法不会更改状态或关心调用对象，因此不会导致实际错误（只是混淆）以允许这样做。一个警告就够了。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-04T20:02:39.083

实例变量引用的目的只是提供包含静态的类型。如果您查看通过 instance.staticMethod 或 EnclosureClass.staticMethod 调用静态的字节码会产生相同的调用静态方法字节码。不会出现对该实例的引用。

答案也是为什么它在那里，它就是这样。只要你使用类。而不是通过实例，您将有助于避免将来的混乱。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-04T13:12:10.350

可能您可以在 IDE 中更改它（在 Eclipse Preferences -> Java -> Compiler -> Errors/Warnings 中）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T13:12:51.173

没有它的选择。在 java 中（像许多其他语言一样），您可以通过类名或该类的实例对象访问类的所有静态成员。这将取决于您和您的案例和软件解决方案，您应该使用哪一个来提高可读性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-02-28T08:50:54.893

这是一个相当古老的话题，但仍然是最新的，并且在今天带来了更大的影响。正如 Jon 所提到的，这可能只是 Java 的设计者一开始就犯的一个错误。但我无法想象它会对安全产生影响。

许多程序员都知道 Apache Velocity，灵活而强大的模板引擎。它非常强大，它允许为模板提供一组命名对象——严格地认为是编程语言中的对象（最初是 Java）。这些对象可以像编程语言一样从模板中访问，例如 Java 的 String 实例可以与它的所有公共字段、属性和方法一起使用

```
$input.isEmpty() 
```

其中*input*是一个*String*，直接通过 JVM 运行并向 Velocity 解析器的输出返回*true*或*false ）。*到现在为止还挺好。

但是在 Java 中，所有对象都继承自*Object*，因此我们的最终用户也可以将其放入模板中

```
$input.getClass() 
```

获取*String*类的实例。

并且有了这个引用，他们还可以在这个上调用一个**静态**方法*forName(String)*

```
$input.getClass().forName("java.io.FileDescriptor") 
```

使用任何类名并将其用于 Web 服务器帐户可以做的任何事情（污损、窃取数据库内容、检查配置文件……）

此处以某种方式（在特定上下文中）描述了此漏洞：[https ://github.com/veracode-research/solr-injection#7-cve-2019-17558-rce-via-velocity-template-by-_s00py](https://github.com/veracode-research/solr-injection#7-cve-2019-17558-rce-via-velocity-template-by-_s00py)

如果禁止从类实例的引用调用静态方法，那将是不可能的。

我并不是说某个特定的编程框架比另一个更好，但我只是想进行比较。有一个用于 .NET 的 Apache Velocity 端口。在 C# 中，不可能仅从实例的引用中调用静态方法，这使得像这样的利用无用：

```
$input.GetType().GetType("System.IO.FileStream, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089") 
```

* * *

## 回答 #12

> 赞同：-9
> 
> 时间：2009-03-04T20:33:46.403

我只考虑这个：

```
instanceVar.staticMethod(); 
```

作为这个的简写：

```
instanceVar.getClass().staticMethod(); 
```

如果您总是必须这样做：

```
SomeClass.staticMethod(); 
```

那么您将无法利用静态方法的继承。

也就是说，通过实例调用静态方法，您不需要知道该实例在编译时是什么具体类，只需知道它在继承链的某处实现了 staticMethod() 。

编辑：这个答案是错误的。详情见评论。

# algorithm - 在多边形内查找轴对齐的矩形

> ID：610462
> 
> 赞同：19
> 
> 时间：2009-03-04T13:06:10.177
> 
> 标签：algorithm, geometry, polygon, rectangles

我正在寻找一种好的算法来在（不一定是凸的）多边形内找到一个轴对齐的矩形。最大矩形会很好，但不是必需的 - 任何可以找到“相当好的”矩形的算法都可以。

多边形也可能有孔，但任何指向仅适用于凸多边形或简单多边形的算法的指针也会有所帮助。

在我的实现中，边的相交测试相当便宜，但“多边形中的点”测试很昂贵，因此理想情况下应该尽量减少。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T14:41:36.810

[http://cgm.cs.mcgill.ca/~athens/cs507/Projects/2003/DanielSud/](http://cgm.cs.mcgill.ca/~athens/cs507/Projects/2003/DanielSud/)
有一个凸算法，参考资料可能值得一看。
不确定它是否可以扩展到非凸的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-10T16:07:10.130

一种解决方案是将凹多边形拆分为凸段，然后使用 cobbal 的链接。

由于您确实有两个不同的基本问题，您是否考虑过命中测试问题的其他替代方案，例如使用 BSP 树？您可以通过在多边形上放置一个网格并为每个网格正方形构建一个 BSP 树来进一步加快速度。还是每片叶子最多有一个边的kd树？

编辑：我将详细介绍 kd-tree（出于无聊，即使它可能对任何人都有用）：

kd-trees 具有以下属性：

1.  它们是二进制的
2.  每个非叶节点沿垂直于轴的平面分割空间，每个子节点一侧。例如 root 将空间分成 x < x0 和 x >= x0
3.  树级别沿不同的轴轮流拆分，例如，级别 0（根）垂直于 X 拆分，级别 1 -> Y 等。

要将其用于多边形命中检测，请按如下方式构建树：

1.  选择一个要分割的顶点。（对于平衡的树，最好靠近中间的地方）。
2.  将其他顶点拆分为两组，一组用于拆分的任一侧。上面的顶点不进入任何一组。
3.  将边缘也放入集合中。与分割线相交的任何边都进入两组。
4.  从上述组中递归地构造孩子。

如果选择合适的分割顶点，树的深度应该接近 log(N)，其中 N 是顶点的数量。每个叶节点最多有一条边通过它。要进行命中检测：

1.  找到该点落入的叶子。
2.  如果叶子中有边缘，请比较指向它。如果不是，则该点是在内部还是外部应该很明显（在构建树时将此信息存储在此类叶子中）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T13:09:21.150

仅供参考，到目前为止，我所拥有的只是蛮力：制作一个网格，对于网格上的点，如果它们在多边形内，则通过依次扩展每个角或边直到它碰到边来制作一系列矩形。然后只选择最大的。

最简单（并且非常有效）的优化只是在检查网格点是否不包含在已构建的矩形之一中后测试它是否在多边形中，因为“矩形中的点”检查速度非常快。

由于显而易见的原因，这相当缓慢且不准确，更不用说不雅了:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-30T13:53:45.880

使用耳夹怎么样？您可以在每个三角形中找到最大的轴对齐矩形。然后你可以尝试加入三角形并重新计算你的矩形。

# java - 尝试使用 Apache POI-HSSF 读取 MS Excel 文件时出现 IndexOutOfBoundsException

> ID：610466
> 
> 赞同：0
> 
> 时间：2009-03-04T13:07:12.390
> 
> 标签：java, excel, apache-poi, poi-hssf

在尝试使用[POI-HSSF v3.2](http://poi.apache.org/spreadsheet/index.html)解析 MS Excel 文件时，我收到了 IndexOutOfBoundsException。我试图阅读的电子表格不是空的，它是使用 MS Excel 2003 创建的，POI 包中包含的 BiffViewer 解析它没有问题。

我的代码如下：

```
package src;

import java.io.*;
import org.apache.poi.hssf.record.*;
import org.apache.poi.hssf.eventusermodel.*;

class Excel implements HSSFListener
{
    public static void main (String[] args) throws Exception
    {
        FileInputStream stream = new FileInputStream("c:\\temp\\a.xls");

        HSSFEventFactory f = new HSSFEventFactory();

        HSSFRequest req = new HSSFRequest();

        req.addListenerForAllRecords(new Excel());

        f.processEvents(req,stream);

        stream.close();
    }

    public void processRecord (Record r)
    {
        System.out.println(r);
    }
} 
```

这是我得到的堆栈跟踪：

[org.apache.poi.hssf.record.RecordInputStream 的 java.io.FileInputStream.read(FileInputStream.java:199) 的 java.io.FileInputStream.readBytes(Native Method) 的线程“main”java.lang.IndexOutOfBoundsException 中的异常.nextRecord(RecordInputStream.java:106) 在 org.apache.poi.hssf.eventusermodel.HSSFRecordStream.getNextRecord(HSSFRecordStream.java:128) 在 org.apache.poi.hssf.eventusermodel.HSSFRecordStream.nextRecord(HSSFRecordStream.java:93) ) 在 org.apache.poi.hssf.eventusermodel.HSSFEventFactory.processEvents(HSSFEventFactory.java:98) 在 src.Excel.main( Excel.java:21)]

非常感谢！我知道，我很懒惰，本可以自己查看 POI 源，但是，希望这里有人能够迅速指出我在代码中所做的任何愚蠢的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T17:01:24.760

谜底解开，获取输入流的正确方法如下

```
FileInputStream file   = new FileInputStream("c:\\temp\\a.xls");
POIFSFileSystem poifs  = new POIFSFileSystem(file);
InputStream     stream = poifs.createDocumentInputStream("Workbook"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-05T13:38:57.913

```
FileInputStream stream =
   new FileInputStream("abcd.xls");  
  HSSFEventFactory f = new HSSFEventFactory(); 
  HSSFRequest req = new HSSFRequest(); 
  req.addListenerForAllRecords(new Excel());  
  Workbook wb;
  wb = new HSSFWorkbook(stream); 
  Sheet sheet=wb.getSheet("abcd11042009");
  int rows=sheet.getPhysicalNumberOfRows();
  Row headerRow;
  Cell cell;
  for(int i=0;i<rows;i++)
  {
    headerRow= sheet.getRow(i);

    cell = headerRow.getCell(1);
    System.out.println("Doing..."+ cell.getStringCellValue());
  } 
```

# django - 适合我的测试用例在 Django 中属于非应用程序的位置

> ID：610470
> 
> 赞同：1
> 
> 时间：2009-03-04T13:08:18.300
> 
> 标签：django, testing

我已经在 Django 中建立了我的网站。和任何其他 django 项目一样，我在项目根目录和一些特殊文件夹中都有应用程序（扩展名也称为自定义 django 命令扩展名）。使用应用程序，我们对测试用例没有任何问题。应用程序目录中的“tests.py”将是解决方案。但是对于一个特殊的文件夹（不是应用程序或没有models.py），我应该在哪里放置测试用例。我尝试将 tests.py 放在扩展目录中，它说该目录不是模型并且无法运行测试。我该如何解决这个问题？如何正确放置与非应用程序相关的测试用例？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T13:50:59.990

我认为将它们放在`tests/`项目级别的目录中会起作用。

如果由于某种原因它没有，则尝试`models.py`在您的扩展目录中创建一个空目录。

# html - 查找和替换 HTML 标签

> ID：610473
> 
> 赞同：15
> 
> 时间：2009-03-04T13:08:58.267
> 
> 标签：html, ruby, string, parsing, nokogiri

我有以下 HTML：

```
<html>
<body>
<h1>Foo</h1>
<p>The quick brown fox.</p>
<h1>Bar</h1>
<p>Jumps over the lazy dog.</p>
</body>
</html> 
```

我想将其更改为以下 HTML：

```
<html>
<body>
<p class="title">Foo</p>
<p>The quick brown fox.</p>
<p class="title">Bar</p>
<p>Jumps over the lazy dog.</p>
</body>
</html> 
```

如何查找和替换某些 HTML 标签？我可以使用[Nokogiri](http://nokogiri.rubyforge.org/nokogiri/)宝石。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-04T13:53:44.773

试试这个：

```
require 'nokogiri'

html_text = "<html><body><h1>Foo</h1><p>The quick brown fox.</p><h1>Bar</h1><p>Jumps over the lazy dog.</p></body></html>"

frag = Nokogiri::HTML(html_text)
frag.xpath("//h1").each { |div|  div.name= "p"; div.set_attribute("class" , "title") } 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-04T14:01:11.730

似乎这样工作正常：

```
require 'rubygems'
require 'nokogiri'

markup = Nokogiri::HTML.parse(<<-somehtml)
<html>
<body>
<h1>Foo</h1>
<p>The quick brown fox.</p>
<h1>Bar</h1>
<p>Jumps over the lazy dog.</p>
</body>
</html>
somehtml

markup.css('h1').each do |el|
  el.name = 'p'
  el.set_attribute('class','title')
end

puts markup.to_html
# >> <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
# >> <html><body>
# >> <p class="title">Foo</p>
# >> <p>The quick brown fox.</p>
# >> <p class="title">Bar</p>
# >> <p>Jumps over the lazy dog.</p>
# >> </body></html> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-04T14:06:25.757

```
#!/usr/bin/env ruby
require 'rubygems'
gem 'nokogiri', '~> 1.2.1'
require 'nokogiri'

doc = Nokogiri::HTML.parse <<-HERE
  <html>
    <body>
      <h1>Foo</h1>
      <p>The quick brown fox.</p>
      <h1>Bar</h1>
      <p>Jumps over the lazy dog.</p>
    </body>
  </html>
HERE

doc.search('h1').each do |heading|
  heading.name = 'p'
  heading['class'] = 'title'
end

puts doc.to_html 
```

# asp.net - ASP.NET 有相当于 VB 的 InputBox 功能吗？

> ID：610474
> 
> 赞同：0
> 
> 时间：2009-03-04T13:09:07.190
> 
> 标签：asp.net, vb.net, inputbox

VB 有一个 InputBox() 函数，它会提示用户输入单个值，然后单击 OK。

ASP.NET 中是否有并行功能，可以让浏览器弹出某种输入框以返回单个值？

如果没有，你建议我如何实现这个效果？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T13:19:28.350

您可以在 JavaScript 中执行此操作

```
var result = prompt("Question", "Default text");
document.getElementById("HiddenInputBox").value = result;
document.HiddenForm.submit(); 
```

但大多数网络应用程序似乎使用屏幕表单和模拟模式对话框（淡出和禁用屏幕的其余部分）

jQuery 是你的朋友，试试[simplemodal](http://www.ericmmartin.com/projects/simplemodal/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T13:12:47.367

有关更多功能，请查看 asp.net ajax 控件工具包，特别是模态弹出框控件。

[http://www.asp.net/ajax/](http://www.asp.net/ajax/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T13:11:03.860

是的 - 使用`prompt()`javascript 函数。

```
var x = prompt("enter a value"); 
```

# php - 将结果绑定到 php 数组中

> ID：610483
> 
> 赞同：2
> 
> 时间：2009-03-04T13:12:16.683
> 
> 标签：php, mysql, mysqli, prepared-statement

我正在尝试使用以下代码从查询中获取结果并将其显示在`tes.php`页面中。

### db.inc.php

```
<?php
function db_connect()
{
    $handle=new mysqli('localhost','rekandoa','rekandoa','rekandoa');
 if (!$handle)
{
       return false;
   }
return $handle;
}

function get_member()
{
    $handle=db_connect();
$sql="Select email,nama,alamat,kota,propinsi from users where email=?";
    $stmt=$handle->prepare($sql);
  $mail='yonghan79@gmail.com';
    $stmt->bind_param("s",$mail); 
 $stmt->execute();
  $stmt->bind_result($email,$nama,$alamat,$kota,$propinsi);
  $result=$stmt->fetch();
    return $result;
}
?> 
```

### 测试文件

```
<?php
error_reporting(E_ALL & ~E_NOTICE);
include('db.inc.php');
$w=get_member();
echo $w['member_id'];
echo '<br>';
echo $w['email'];
echo '<br>';
echo $w['status'];
echo '<br>';
?> 
```

我没有收到错误消息，但没有显示结果，它只是一个空白页。

我做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T13:39:06.837

```
$stmt->bind_result($email,$nama,$alamat,$kota,$propinsi); 
```

上述行将确保结果存储在您提供的变量中。该[`fetch()`函数](http://de.php.net/manual/en/mysqli-stmt.fetch.php)返回`TRUE`或`FALSE`- 查询是否成功，而不是实际结果。你需要类似的东西

```
return array(
    'email'    => $email,
    'nama'     => $nama,
    'alamat'   => $alamat,
    'kota'     => $kota,
    'propinsi' => $propinsi); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:38:01.253

fetch() 本身不返回一个数组，它返回一个布尔值，指示它是否有一行。因此你可以这样做：

```
while($stmt->fetch()) {
     //$email,$nama,$alamat,$kota,$propinsi are now filled
} 
```

动态地将值绑定到一个数组中（与 soulmerge 的解决方案不同）需要更多的技巧。我创建了一个[数据库类](http://forum.swiftirc.net/viewtopic.php?f=44&t=14482&p=130087&hilit=database#p130087)来做这件事。它充当 mysqli 准备语句的包装器，以将结果作为对象返回，其中选择列充当对象的属性。如果您将强制转换为类中的对象，它将根据需要返回数组。

# php - 确定经纬度圆和球体上的圆是否重叠

> ID：610496
> 
> 赞同：1
> 
> 时间：2009-03-04T13:14:43.603
> 
> 标签：php, mysql, google-maps, geocoding

我正在使用 PHP 作为服务器脚本语言和 MySQL 作为数据库创建一个具有地理邻近搜索功能的应用程序。

考虑一种情况：

我们有特定的一组对象，这些对象具有与各个对象相关联的纬度和经度位置。在指定位置详细信息（如国家和/或城市）以及 KM 中的范围/半径时，我们使用 MySQL 查询获取位于该半径/范围内的对象，例如：

```
SELECT [columns] 
FROM [column] 
WHERE 1=1 
AND 3963.191 * 
    ACOS(
    (SIN(PI() * [latitude] / 180) * SIN(PI() * [column].latitude / 180)) + 
    (COS(PI() * [latitude] /180) * cos(PI() * [column].latitude / 180) * COS(PI() * [column].longitude / 180 - PI() * [longitude] / 180)) ) 
    <= 10 
```

以上计算将给出距离地球上国家/城市中心点 10 公里范围内的对象。

现在假设我有一个对象（带有纬度和经度）不在这 10 公里的区域内，但例如距离地球上的国家/城市中心点 15 公里。该对象的服务范围为 10 KM（提供服务范围为 10 KM 区域）。

现在的问题是，如果我正在寻找距国家/城市中心点 10 公里范围内的对象，那么服务范围为 10 公里的对象（距国家/城市中心点 15 公里）也应包括在搜索中。

我怎样才能使它成为可能？我有国家/城市中心纬度、长坐标、范围/半径（我们必须在其中找出对象）和具有交付半径的对象（例如 10 公里）及其相应的坐标。

你能指导我如何使用 PHP、MySQL 做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T13:20:56.740

使用 MySQL 空间扩展 [http://dev.mysql.com/doc/refman/5.1/en/spatial-extensions.html](http://dev.mysql.com/doc/refman/5.1/en/spatial-extensions.html)

另一方面，如果您只想识别与给定圆相交的其他圆，它们将是所有这些圆，因为圆心之间的距离小于半径之和。换句话说，假设您的原始点和范围由三元组 ( *x [0]* , *y [0]* , *r [0]* ) 给出，您需要所有 ( *x [n]* , *y [n]* , *r [n]* )

√(( *x [0]* - *x [n]* )² + ( *y [0]* - *y [n]* )²) ≤ *r [0]* + *r [n]*

# javascript - 如何控制 WMD 编辑器中允许的 HTML 标签？

> ID：610499
> 
> 赞同：1
> 
> 时间：2009-03-04T13:15:29.840
> 
> 标签：javascript, html, css, wmd, wysiwym

我正在尝试以某种方式设置用户可以在[我的站点的](http://forumsr.gxopen.com)[WMD 编辑器](http://wmd-editor.com/)中使用的有效 HTML 标记和属性。例如，我想禁止用户直接设置字体大小、颜色、字体等，这与默认设置输入类似：

```
<span style="font-size: 45px; color:#FF0000">Some intrusive text here</span>. 
```

我认为实现这一点的方法是通过“wmd_options”，但我没有找到任何关于此的文档或参考，因为“选项演示”似乎是唯一的公共文档，它没有显示我应该如何做我上面描述的。

我已经向 support@attacklab.net 发送了同样的问题，但没有得到任何回复。由于 stackoverflow 使用此编辑器，因此有人阅读此内容，或者[Jeff](https://stackoverflow.com/users/1/jeff-atwood)知道答案；）

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T19:40:00.907

我知道您想知道如何通过[wmd 编辑器](http://wmd-editor.com)完成此操作，但您肯定意识到 javascript 编辑器不会阻止人们这样做。

如果您想知道一些标签是如何在[stackoverflow](http://stackoverflow.com)上的服务器上被剥离的，您可能想看看[这个](http://refactormycode.com/codes/333-sanitize-html)。

# php - 数组作为对象

> ID：610500
> 
> 赞同：0
> 
> 时间：2009-03-04T13:15:30.137
> 
> 标签：php, oop, class

我有一种方法可以让我将数组用作对象吗？

我的主类中有以下代码

```
function  __construct()
{
        require 'config.php';
        $this->config = new PHPSO_Config();
} 
```

PHPSO_Config 类看起来像这样

```
class PHPSO_Config
{
    /**
     * The administrators email address
     */
    var $adminEmail = 'user@domain.tld'; //I'm using this email to test
} 
```

那么我可以完成同样的事情并能够在不创建第二个类的情况下将配置变量作为对象访问吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T13:21:13.277

您可以使用将数组转换为对象

```
$myObject = (object) $myarray; 
```

因此以下应该有效（未经测试）：

```
function  __construct()
{
        require 'config.php';
        $this->config = (object) array("username" => "root");
} 
```

然后 $class->config->username 应该可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:26:42.670

您可以使用[PHP5 重载](http://uk.php.net/manual/en/language.oop5.overloading.php)来使您的类看起来具有配置类提供的属性，例如：

```
class MyClass
{
    private $config;

    function  __construct()
    {
        require 'config.php';
        $this->config = new PHPSO_Config();
    }

    public function __get($name) {
        if (property_exists($this->config, $name)) {
            return $this->config->$name;
        }
        return null;
} 
```

然后做这样的事情：

```
$config=new MyClass;
echo $config->adminEmail; 
```

将导致看到内部配置类的 adminEmail 成员变量。

这几乎是一种[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)，可以在运行时选择一个类的运行时实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:23:01.367

我不确定您到底想要什么，但您可以将数组转换为对象。确保您不使用数字索引，因为它们不能正常工作；

```
$config = array('adminEmail' => 'user@domain.tld');
$this->config = (object)$config; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T16:13:52.737

也许我在这里遗漏了一些东西，但是您是否尝试用数组替换配置类，然后将其转换为对象？对我来说听起来有点疯狂。我只会有一个配置类，它的设计方式更好。

最好不要在应该有课程的地方制作数组。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-04T13:20:41.047

嗯是的

我个人会使用一种技术：

您可以创建一个文件调用任何您想要的（即 config.php），然后将其写入其中，例如：

每当您想使用这些信息时，您只需输入“require_once“config.php”；” 在 index.php 中的代码上方，所有定义都将在该页面中。例如，您可以通过键入 $DB_SERVER 来读取数据库服务器名称。

如果我是你，我会坚持使用它，因为你可以在项目中的任何地方使用它，并且只需从一个文件维护它，这让生活更轻松。

# sql-server-2005 - 使用 DataAdapter 进行批量更新的问题

> ID：610505
> 
> 赞同：0
> 
> 时间：2009-03-04T13:16:49.697
> 
> 标签：sql-server-2005, ado.net, .net-2.0

我正在使用批量更新更新sql server 2005数据库，如下图

```
 cmd = new SqlCommand("update Table1 set column1 = @column1 where EmpNo = @EmpNo", con);
                cmd.Parameters.Add(new SqlParameter("@column1", SqlDbType.VarChar));
                cmd.Parameters["@column1"].SourceVersion = DataRowVersion.Current;
                cmd.Parameters["@column1"].SourceColumn = "Column";

                cmd.Parameters.Add(new SqlParameter("@EmpNo", SqlDbType.Int));
                cmd.Parameters["@EmpNo"].SourceVersion = DataRowVersion.Current;
                cmd.Parameters["@EmpNo"].SourceColumn = "EmpNo";

                cmd.UpdatedRowSource = UpdateRowSource.None;

                sqlDa = new SqlDataAdapter();
                con.Open();
                sqlDa.UpdateCommand =cmd;
                sqlDa.UpdateBatchSize = 10;
                sqlDa.Update(dt);

                con.Close(); 
```

但是数据没有更新。我无法弄清楚问题是什么。感谢任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T14:32:07.240

我建议您在发出更新命令之前查看 dt。确保有些行的 RowState 为已更新或已添加。如果没有，您的（我假设）DataTable 中没有任何内容可以更新到数据库。

另外，请尝试删除 .SourceVersion 属性集操作。

如果一切正常，请在发出 .Update 之前对数据库进行跟踪。

这些只是尝试的几个第一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-19T13:12:33.920

SqlDataAdapter 方法

使用 (SqlCommand insertCommand=new SqlCommand(

“插入 BulkLoadTable（FieldA，FieldB）值（@FieldA，@FieldB）”，连接））

{ insertCommand.Parameters.Add("@FieldA", SqlDbType.VarChar, 10, "FieldA");

```
insertCommand.Parameters.Add("@FieldB", SqlDbType.Int, 4, "FieldB");
// Setting UpdatedRowSource is important if you want to batch up the inserts
insertCommand.UpdatedRowSource = UpdateRowSource.None;
using (SqlDataAdapter insertAdapter = new SqlDataAdapter())
{
    insertAdapter.InsertCommand = insertCommand;
    // How many records to send to the database in one go (all of them)
    insertAdapter.UpdateBatchSize = myDataTable.Rows.Count;

    // Send the inserts to the database
    insertAdapter.Update(myDataTable);                   
} 
```

}

# java - Java 世界中是否有类似 CherryPy 或 Cerise 的东西？

> ID：610516
> 
> 赞同：2
> 
> 时间：2009-03-04T13:21:36.003
> 
> 标签：java, python

[CherryPy](http://www.cherrypy.org/)和[Cerise](http://cerise.rubyforge.org/)是两个小框架，只实现了 Web 框架的准系统，我喜欢它们的简单性：事实上，我认为如果 Classic ASP 以这种方式实现（并且几乎*不需要*VBScript）我可以解决为此，从此过上了幸福的生活。

但现在我生活在 Java 世界的边缘，想知道是否有类似于这两个框架的东西，并且不会试图夺走你的控制权。我的要求是他们有一个：

*   将 url 映射到方法（如 CherryPy、Django、Cerise、Rails 等）的调度程序

*   如果它有一个简单但功能强大的模板语言（a la JSP/ASP），并且在关注点分离方面不太虔诚

*   如果它有某种有助于验证表单的库，则可以加分

谢谢

--

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:27:23.400

[条纹](http://www.stripesframework.org/display/stripes/Home)

方法的 URL，检查，表单验证，检查。功能强大，但除非您需要，否则不会妨碍您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T21:10:29.683

[OOWeb](http://ooweb.sourceforge.net/tutorial.html)，本质上是 CherryPy 的一个端口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:29:01.510

Groovy 和[Grails](http://www.grails.org)。如果您喜欢 MVC，甚至有一个用 Java/JVM 编写的现有库，那么这就是您正在寻找的工具！

> Grails 旨在将“按惯例编码”范式引入 Groovy。它是一个利用 Groovy 语言并补充 Java Web 开发的开源 Web 应用程序框架。您可以将 Grails 用作隐藏所有配置细节或集成 Java 业务逻辑的独立开发环境。Grails 旨在使开发尽可能简单，因此应该吸引广泛的开发人员，而不仅仅是来自 Java 社区的开发人员。

# animation - 在哪里下载很酷的动画进行测试？

> ID：610529
> 
> 赞同：5
> 
> 时间：2009-03-04T13:25:19.770
> 
> 标签：animation, testing

我正在寻找一些可以下载一些短片（5-20​​ 秒）的网站，用于测试视频导入例程。

有没有人有一些 wmv、mpeg、mov 等的数据源？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:42:13.257

Youtube，并用 ffmpeg 转换

或者电影预告片经常在mov（imdb：[http](http://www.imdb.com/Sections/Trailers/) ://www.imdb.com/Sections/Trailers/ ）

或游戏预告片、gamershell / gamespot / ...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T01:56:06.503

[http://www.open-video.org/](http://www.open-video.org/)

[http://www.archive.org/](http://www.archive.org/)

[http://reefvid.org/](http://reefvid.org/)

或者只是用数码摄像机（或数码相机）拍摄一些短视频，然后将它们导入您的计算机。

您可以将[http://www.zamzar.com/](http://www.zamzar.com/)上的视频文件从任何格式转换为任何格式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T13:48:51.680

几天前我正在寻找这个，这是我找到的最好的一个：

[http://www.jhepple.com/support/sample_movies1.htm](http://www.jhepple.com/support/sample_movies1.htm)

16 个不同的文件（两个原始样本），尺寸相当小，涵盖了大多数流行格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T13:42:35.360

[MetaCafe](http://www.metacafe.com/)允许您下载视频。我有一些用于测试的剪辑，这些剪辑是从那里下载的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T04:27:31.240

一些高清剪辑：

*   [http://www.microsoft.com/windows/windowsmedia/musicandvideo/hdvideo/contentshowcase.aspx](http://www.microsoft.com/windows/windowsmedia/musicandvideo/hdvideo/contentshowcase.aspx) - Windows Media 音频和视频 9 系列，1080p WMV 文件
*   [http://www.apple.com/quicktime/guide/hd/](http://www.apple.com/quicktime/guide/hd/) - Quicktime 容器中的 H.264
*   [http://www.w6rz.net/](http://www.w6rz.net/) MPEG-2 传输流测试模式

# html - 什么时候我应该使用什么图像类型？GIF、JPG 还是 PNG？

> ID：610530
> 
> 赞同：8
> 
> 时间：2009-03-04T13:25:23.360
> 
> 标签：html, image

我正在尝试为自己创建一个个人主页，以了解有关网页设计（JavaScript、使用 Photo Shop 等）的更多信息。我计划在左侧有一个图形菜单，顶部有一个横幅，还有一个“照片”部分，我可以在其中显示我拍摄的各种照片的照片。

然而，当我查看其他做类似事情的网站时，我看到一些使用 GIF，一些使用 JPG，还有一些甚至使用 PNG。这些有什么区别吗？我应该为网站上使用的图形图像使用 GIF 并为我的照片使用 JPG 吗？我应该把所有东西都做成PNG吗？

* * *

**完全重复：**

*   [PNG vs. GIF vs. JPEG vs. SVG - 什么时候最好使用？](https://stackoverflow.com/q/2336522/199700)
*   [网站图像格式：为正确的任务选择正确的格式。](https://stackoverflow.com/questions/392635/website-image-formats-choosing-the-right-format-for-the-right-task)
*   [小型网站图片的格式是什么？GIF 还是 PNG？](https://stackoverflow.com/questions/115818/which-format-for-small-website-images-gif-or-png/115838)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-04T13:30:18.557

解释它的 XKCD 风格漫画：

![替代文字](https://i.stack.imgur.com/XeIwO.png)

[http://lbrandy.com/blog/2008/10/my-first-and-last-webcomic/](http://lbrandy.com/blog/2008/10/my-first-and-last-webcomic/)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-04T13:43:39.447

**在以下情况下应使用**PNG ：****

 ***   您需要透明度（1 位或 alpha 透明度）
*   无损压缩效果很好（例如图表或徽标，或计算机生成的图像）

**在以下情况下应使用**JPEG ：****

 ***   无损压缩效果不好（比如照片）

**GIF**应该在以下情况下：

*   PNG 不可用，例如在非常旧的软件或浏览器上
*   动画是必要的

尽管存在相反的神话，但 PNG 在大多数方面都优于 GIF。PNG除了动画之外，可以支持GIF的所有图像模式，并且在使用相同的图像模式时，PNG由于其DEFLATE算法优于LZW，因此具有更好的压缩率。PNG 还具有 GIF 无法做到的其他模式，例如 24 位颜色和 alpha 透明度，但这是您需要小心的地方：如果您忘记转换为调色板模式，您的 PNG 图像可能会以 24 位颜色保存这将占用更多空间。

PNG 模式包括（这只是一小部分）

*   2 到 256 色的调色板颜色（如 GIF）
*   调色板颜色 2 到 256 色，带透明色（如 GIF）
*   真彩色（24 位彩色）
*   带 Alpha 通道的真彩色（24 位颜色 + 8 位 Alpha 透明度）

为了在 Web 上使用 PNG 进行最佳压缩，请使用调色板模式。如果您发现 PNG 文件比等效的 GIF 文件大，那么您将 PNG 保存为 24 位颜色，并将 GIF 保存为调色板模式（因为 GIF 始终处于调色板模式）。尝试先转换为调色板模式。

PNG 还具有其他模式，例如具有 alpha 透明度的调色板颜色。此类模式无法在 Photoshop 中创建，但其他应用程序可以创建它们。

*2013 年编辑：删除了一堆关于 IE6 兼容性的内容。*

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-04T13:31:39.100

对照片使用 JPG，对除照片以外的所有内容使用 PNG。GIF 并不是一个非常好的格式，PNG 可以在大多数应用程序的压缩和质量上完全取代它，但有时会存在兼容性问题，不确定这些问题是否已在所有当前的网络浏览器中得到解决。GIF 基本上可以被所有东西读取，所以这时候它就非常有用了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-04T13:33:11.810

对于按钮、图标、徽标，请使用 PNG。仅当您需要小动画图像时才使用 GIF。

PNG 可以做 GIF 所能做的所有事情（除了动画，甚至 APNG 中的动画），并且几乎总是应该更小。如果 PNG 不小于 GIF，那么您的软件可能保存效果不佳 - 寻找 PNG 优化程序，例如 PNGOUT 和 pngnq。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-04T13:40:43.963

GIF有问题：

*   它仅支持多达 256 种颜色。
*   它使用专利的压缩算法。

但它确实有一个优势：

*   它可以用来显示动画

JPEG 可以具有比 PNG/GIF 更高的压缩率，但正如上面的卡通所示，它是有损的。它最适合用于压缩伪影不明显的图像，例如照片。

将图像组合成纹理并使用 CSS 解包它们会略微减小大小并减少服务器请求的数量。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-04T13:36:52.583

取决于您要创建的内容。通常，对于您的 Web 图形，请使用 PNG。对于照片，JPG很好。24 位 PNG 支持 alpha 透明度，所以如果你想使用“真彩色”alpha 透明度，那真的是你唯一的选择。8 位 PNG 比 GIF 更好、更小，并且具有与 GIF（索引颜色托盘）几乎相同的透明度设置，因此没有理由再使用 GIF（除非您正在制作...喘不过气来...动画 gif ？）。请记住，PNG 格式是无损压缩，因此压缩后的 JPG 看起来会更好看。要记住的一件事是，在 Internet Explorer 6 及更低版本中支持 PNG 可能会很痛苦，但有很多变通方法。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-04T13:38:20.677

GIF - 无损、小，但仅限于 256 色，并且具有一位透明度（透明或不透明）

JPEG - 更大，没有小的颜色限制，有损。最适合拍照。

PNG - 无损，更好的透明度（alpha 通道），但 IE6 不正确支持 alpha，只是进行了特殊修复（[在此处修复](http://homepage.ntlworld.com/bobosola/pnghowto.htm)）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T13:28:43.273

GIF 最适合具有大量纯色的图像 - JPEG 适合具有大量颜色变化的图像（编辑：谢谢，cletus）。PNG 是一种较新的格式，通常比 JPEG 或 GIF 更好 - 特别是对于屏幕截图。

见[http://www.ou.edu/class/digitalmedia/articles/CompressionMethods_Gif_Jpeg_PNG.html](http://www.ou.edu/class/digitalmedia/articles/CompressionMethods_Gif_Jpeg_PNG.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T13:32:59.660

一般来说，jpeg 更适合照片，而 gif 更适合图形对象，例如按钮或渲染的字母。png 在这两个方面都很好，但是这种讨论往往会变得有点宗教化，因为如果您开发一个读取/写入 gif 或 jpeg 的程序，则需要支付许可费，而 png 是免费的。

区别主要在于压缩，gif 获得较小的按钮文件大小，jpeg 获得照片。

我最好的建议是使用所有三种格式提供的不同压缩选项，并亲自查看要用于哪个目的的压缩选项。

哦，因为这主要与文件大小有关：看看您是否可以从具有低带宽连接的计算机上测试您的主页。这样，如果您根本需要担心压缩，您就会有一种感觉；-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T13:35:12.243

从历史上看，GIF 最先出现，然后是 JPG，然后是 PNG。

GIF 对于具有相同颜色的大面积区域（例如白色背景）的图像非常有效，因为 RLL 编码可以很好地压缩这一点。然而，GIF 是专利技术 (Unisys)，使用越来越少。颜色深度限制为 256 种颜色（我认为）。

JPG 和 PNG 适用于大多数应用程序，但对于非常简单的图形，文件会比 GIF 大。GIF 可以处理透明度和动画。

编辑：你是对的 - 专利于 2006 年 10 月 1 日到期。

# c - sprintf() 的可定制实现

> ID：610534
> 
> 赞同：3
> 
> 时间：2009-03-04T13:26:12.797
> 
> 标签：c, printf

谁能指出我可以根据自己的需要自定义的源代码文件或在 C 中具有良好、可重用的 sprintf() 实现的包？

关于我为什么需要它的解释：字符串在我的代码中不是以空结尾的（二进制兼容）。因此 sprintf("%s") 是无用的，除非我修复代码以了解如何呈现字符串。

感谢 quinmars 指出有办法通过 %s 打印字符串而不会被空终止。虽然它现在解决了需求，但我最终将需要 sprintf（或 snprintf）实现来实现使用变体的更高级别的功能。在到目前为止提到的其他内容中，在我看来 SQLite 实现是最好的。感谢 Doug Currie 指出这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T14:09:31.240

我没有尝试过，因为我这里没有编译器，但是阅读手册页，看起来你可以为 '%s' 传递一个精度：

> ...如果给出了精度，则不需要存在空字符；如果未指定精度或大于数组的大小，则数组必须包含终止 NUL 字符。

那么你有没有尝试过做类似的事情？

```
snprintf(buffer, sizeof(buffer), "%.*s", bstring_len, bstring); 
```

如前所述，我没有对其进行测试，如果它有效，那么它当然只有在字符串中没有 '\0'-byte 时才有效。

**编辑：**我现在已经测试过了，它可以工作了！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T13:28:29.497

你真的应该在寻找 snprintf （sprintf 尊重输出缓冲区大小）；谷歌建议[http://www.ijs.si/software/snprintf/](http://www.ijs.si/software/snprintf/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T13:56:21.723

作为 SQLite 的一部分，[这里](http://www.sqlite.org/cvstrac/rlog?f=sqlite/src/printf.c)有一个很好的公共领域实现。

我同意 Dickon Reed 的观点，即您需要 snprintf，它包含在 SQLite 版本中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T11:16:11.290

我已经使用[了这些](http://www.menie.org/georges/embedded/)家伙的源代码。它体积小、易于理解且易于修改（与 glib 和 libc 不同）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T13:41:31.933

根据此链接- [http://www.programmingforums.org/thread12049.html](http://www.programmingforums.org/thread12049.html)：

> 如果你有完整的 gcc 发行版，C 库（glib 或 libc）的源代码是附带的子目录之一。

所以你可以在那里查看。我不知道这会有多大帮助...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T13:46:24.277

我想修改 sprintf 的唯一原因是扩展它，而扩展它的唯一原因是当您正在编写某种解析器时。

如果您正在寻找为诸如编码语言、XML 或任何具有语法的东西创建解析器，我建议您查看 Lexers 和 Parser Generators（最常用的两个是[Flex](http://en.wikipedia.org/wiki/Flex_lexical_analyser)和[Bison](http://en.wikipedia.org/wiki/GNU_bison)），它们几乎可以为您编写极其复​​杂的解析器代码（尽管工具本身有些复杂）。

否则，您可以在 Visual Studio 附带的源文件中找到它的代码（至少 2005 和 2008，其他人可能拥有它，但那两个肯定有）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T16:10:40.577

glibc 的 snprintf 可通过钩子/处理程序机制进行自定义

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T14:10:27.050

只是一个想法......示例：

```
#include <stdio.h>
#include <string.h>
#include <stdarg.h>

int sprintf(char * str, const char * format, ... )    
{// Here you can redfine your input before continuing to compy with standard inputs
    va_list args;
    va_start(args, format);
    vsprintf(str,format, args);// This still uses standaes formating
    va_end(args);
    return 0;// Before return you can redefine it back if you want...
}
int main (void)
{
    char h[20];
    sprintf(h,"hei %d ",10);
    printf("t %s\n",h);
    getchar();
    return 0;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T17:05:44.407

查看 Hanson 的[C 接口：实现和技术](https://rads.stackoverflow.com/amzn/click/com/0201498413)。这是一本有趣的书，因为它是使用 Knuth 的[文学编程](https://rads.stackoverflow.com/amzn/click/com/0937073806)技术编写的，并且它特别包含了一个基于`snprintf()`.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-08-06T17:34:46.750

[Marco Paland](https://github.com/mpaland/printf)设计了一个小型实现，我在[这个存储库](https://github.com/eyalroz/printf)中几乎完成了一些问题。完整的 C99 sprintf/vsprintf/etc 大约需要 720 行代码。与[sqlite](https://github.com/sqlite/sqlite/tree/master/src)的 3993 相比（尽管 SQLite 可以使用更少；它包含这个`sqliteint.h`标题和很多不相关的东西。）

# asp.net - 用于查看由 ASP.NET 生成的 HTML 源的免费软件插件？

> ID：610539
> 
> 赞同：1
> 
> 时间：2009-03-04T13:27:29.937
> 
> 标签：asp.net, html, plugins, view-source

是否有任何免费软件插件可以帮助我查看由 ASP.NET 生成的 HTML 源代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T13:33:57.020

微软的 Fiddler2 for IE

或 FireFox 的 Firebug

有了这些，您可以看到由 ASP.NET 生成的真实源代码，而不是浏览器“查看源代码”菜单选项中显示的损坏源代码

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:29:07.623

您可以使用'菜单`View Source`下的 Internet Explorer 按钮。`Edit`Firefox 在`View`菜单下有类似的东西。

编辑：如果您正在寻找应用程序的源代码，无论您做什么，都无法看到。服务器只向客户端发送它希望客户端看到的内容。对于 ASP.NET，这意味着您将看到 ASP.NET 生成的控件 ID 等。如果您想在没有网络浏览器的情况下自行执行此操作，请尝试[Wget](http://www.gnu.org/software/wget/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T13:32:41.423

[Internet Explorer 开发人员工具栏](http://www.microsoft.com/en-us/download/details.aspx?id=18359)具有许多功能。Firefox的[Web Developer](https://addons.mozilla.org/en-US/firefox/addon/60)插件看起来很漂亮。[这](http://www.howtogeek.com/howto/internet/firefox/easily-view-source-of-included-files-in-firefox/)是使用另一个 FireFox 附加组件的演练。

如果您只是为了查看源代码，我熟悉的所有浏览器都内置了该功能。[Internet Explorer](http://support.microsoft.com/kb/176222)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T13:31:13.720

您不必查看该功能何时已内置到几乎每个网络浏览器中。查看源代码是一项标准功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T13:46:53.760

为 Firefox安装[Web Developer](https://addons.mozilla.org/en-US/firefox/addon/60)扩展将让您查看“生成的”源代码（即，它包括客户端 javascript 等对 html 所做的更改）。否则，任何浏览器中可用的标准“查看源代码”选项就足够了。

# asp.net - 在 Global.asax 上使用 IHttpModule

> ID：610556
> 
> 赞同：5
> 
> 时间：2009-03-04T13:31:24.873
> 
> 标签：asp.net, vb.net, global-asax, ihttpmodule

我被赋予了重写我们的异常处理系统的激动人心的任务。虽然我会声明从应用程序范围的角度处理异常不是我们想要的，但通常情况下，当我们的团队人手不足时，我们需要推出大量工作，这是不可避免的，所以请不要燃烧此处异常处理的全球化解决方案:)

我已经很好地寻找存在哪些常见的解决方案。目前，我们使用 Global.asax 和 Application_Error 事件来执行 Server.GetLastError() ，它被置于会话状态，然后调用重定向到另一个页面，然后检索会话数据并以人类可读的格式输出。重定向还调用一个 sproc，它会仔细审核错误信息，这些信息是 a) 通过电子邮件发送给开发人员和 b) 从只有开发人员可以查看的网页查看。

我见过的做事的新方法是使用 IHttpModule 接口，使用 App_Code 中的一个类来做一些事情（这是我的快速实现）

```
Imports Microsoft.VisualBasic

Public Class ErrorModule : Implements IHttpModule

  Public Sub Dispose() Implements System.Web.IHttpModule.Dispose
    ' Not used
  End Sub

  Public Sub Init(ByVal context As System.Web.HttpApplication) Implements System.Web.IHttpModule.Init
    AddHandler context.Error, AddressOf context_Error
  End Sub

  Public Sub context_Error(ByVal sender As Object, ByVal e As EventArgs)
    Dim ex As Exception = HttpContext.Current.Server.GetLastError

    ' do something with the error
    ' call the stored procedure
    ' redirect the user to the error page

    HttpContext.Current.Server.ClearError()
    HttpContext.Current.Response.Redirect("index.htm")

  End Sub
End Class 
```

我的问题是，与使用 Global.asax 事件相比，此解决方案有什么好处？此外，将数据交给错误页面的最佳方式是什么？

*编辑：*顺便说一句，上面的代码确实有效；）

**编辑：**另外，HttpModule 是如何在幕后工作的？它只是在应用程序启动时将错误事件注册到该特定功能吗？

**更新：**

经过进一步调查，在使用 IHttpModule 接口时，获取会话数据似乎非常非常混乱。我认为 MS 的 HttpModule 还不够成熟，无法在我们的特定场景中使用——除非有特定于会话数据的事件，否则我们无法使用它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T13:34:33.960

使用模块具有易于移除的优点，禁用它所需要做的就是从配置中的 <httpModules> 中移除它。

就您的数据而言，请尝试使用[Server.Transfer](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.transfer.aspx)或[Server.RewritePath](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.rewritepath.aspx) - 这将保留所有当前数据（包括最后一个服务器错误）。

如果由于某种原因它清除了最后一个错误，您可以在传输/重写之前将错误保存到[HttpContext.Items](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx)，然后再检索它。

**编辑：**响应您的编辑，IHttpModule 附加到其[IHttpModule.Init](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.init.aspx)实现中的任何适当事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:33:50.517

`HttpModule`基本上和`Global.asax`. 它被设计为一个更可重用和独立的事件处理模块。

# .net - TimeSpan.FromSeconds(-1.0) 和 double.NaN

> ID：610562
> 
> 赞同：2
> 
> 时间：2009-03-04T13:32:56.227
> 
> 标签：.net, debugging, timespan

我们正在构建一个 WPF 应用程序，并看到一些随机且非常奇怪的行为，这些行为似乎源自 BCL 内部。我们正在使用以下堆栈跟踪捕获未处理的异常：

```
[ArgumentException], 
"TimeSpan does not accept floating point Not-a-Number values."
   at System.TimeSpan.Interval(Double value, Int32 scale)
   at System.Windows.Threading.Dispatcher.Invoke(DispatcherPriority priority, Delegate method, Object arg)
   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)
   at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG& msg)
   at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)
   at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)
   at System.Windows.Threading.Dispatcher.Run()
   at System.Windows.Application.RunDispatcher(Object ignore)
   at System.Windows.Application.RunInternal(Window window)
   at System.Windows.Application.Run(Window window) 
```

现在，如果我们相信 Reflector 调用方法 (Dispatcher.Invoke) 调用

```
...,TimeSpan.FromSeconds(-1.0),... 
```

这会引发 Argument 异常，因为传入的参数在 double.IsNaN 上返回 true。这显然没有任何意义，至少可以说，我们觉得这非常令人费解。

我们无法在任何较小的样本中重现此行为，因此我们正在寻找方法在我们的完整应用程序中确定此问题的原因（以及其他看似相关的 TimeSpan 异常，这些异常也会引发）。我们有很多问题希望有人可以帮助我们，因为我们在谷歌上搜索这样的事情没有运气

*   有没有人看到过这种行为或识别出这些症状
*   是什么导致了基础数学中这些看似随机的行为，我们是否以某种方式破坏了堆栈或堆？
*   我们能否以某种方式在 TimeSpan.Interval 中调试 IL（也许是 WinDbg？）并打破并检查堆栈/堆以验证值？

我们的应用程序的数据量很大，有大量数据被异步获取和大量数据绑定，但是从我们能够获得的堆栈跟踪中，我们没有看到任何确凿的证据。

只是为了澄清这个问题：是否有人以前见过所描述的行为，识别出症状或对我们如何调试情况有意见？

想法，评论，想法，建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T15:56:45.007

关于堆栈跟踪的快速说明，如果方法调用符合某些要求，则可以内联。有关更多信息，请阅读[http://blogs.msdn.com/ericgu/archive/2004/01/29/64717.aspx](http://blogs.msdn.com/ericgu/archive/2004/01/29/64717.aspx)

Dispatcher.Invoke 调用的 IL 代码：

```
L_0002: ldc.r8 -1
L_000b: call valuetype [mscorlib]System.TimeSpan [mscorlib]System.TimeSpan::FromMilliseconds(float64) 
```

我的测试代码，C#：

```
double d = -1.0;
TimeSpan t = TimeSpan.FromMilliseconds(d); 
```

这将成为以下 IL 代码：

```
L_0001: ldc.r8 -1
L_000a: stloc.0 
L_000b: ldloc.0 
L_000c: call valuetype [mscorlib]System.TimeSpan [mscorlib]System.TimeSpan::FromMilliseconds(float64) 
```

即使将完全相同的值传递给 TimeSpan.FromMilliseconds，我也无法重复您的问题

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T13:35:50.183

我不确定我是否正确理解了您的问题，但我认为 -1.0 不是 NaN。

编辑（解决实际问题）：您可以下载 .NET Framework 符号并通过它们进行调试，以查看传递给的变量的实际值`TimeSpan.FromSeconds`以及可能发生的其他任何事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T14:08:09.123

```
1.0/0 
```

=> ~~NaN~~正无穷大

在想`0/0.0` ：|

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T14:29:39.350

是否有可能很多堆栈跟踪正在被优化，并且你有一些代码在那里做一些没有显示的时间跨度的事情。

编辑：

在反射器中，我看到 Dispatcher.Invoke 调用 Timespan.FromMilliseconds 调用 Timespan.Interval。但是在堆栈跟踪中我们只看到 Dispatcher.Invoke 和 Timespan.Interval 所以 Timespan.FromMilliseconds 被排除在堆栈跟踪之外。如果我们假设方法可以被排除在堆栈跟踪之外，那么可能有一条完全不同的路径到 Timespan.Interval。说：

 `````
Dispatcher.Invoke
Dispatcher.InvokeImpl
Dispatcher.BeginInvoke
- Call into your code or somewhere else in BCL -
Timespan.Interval

````  `如果控制流是 Dispatcher.Invoker->Timepan.FromMilliseconds -> Timespan.Interval 那么我会开始怀疑 JIT 编译错误或预先运行的本机代码的某种损坏。

这是有关如何查看 JIT 生成的代码的页面：http: [//blogs.msdn.com/vancem/archive/2006/02/20/535807.aspx](http://blogs.msdn.com/vancem/archive/2006/02/20/535807.aspx)

# perl - 为什么 Perl 抱怨我的 Win32::OLE 脚本中的裸词？

> ID：610586
> 
> 赞同：3
> 
> 时间：2009-03-04T13:40:59.717
> 
> 标签：perl, warnings, bareword

```
#___ FIND LAST ROW/COLUMN WITH DATA
my $row = $Sheet1 -> UsedRange -> Find(
     {      What => "*", 
            SearchDirection => xlPrevious,  
            SearchOrder => xlByRows
      })-> {Row}; 
```

错误：

```
Bareword "xlByRows" not allowed while "strict subs" in use. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T15:11:44.257

您必须将其放在`use Win32::OLE::Const 'Microsoft Excel';`程序的顶部才能正确导入常量。

看看这个[Perl Monks 页面](http://www.perlmonks.org/?node_id=153486)。它似乎涵盖了您遇到的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T15:18:26.410

请参阅[Win32::OLE::Const 的 CPAN 文档](http://search.cpan.org/perldoc/Win32::OLE::Const)

你需要：

```
use Win32::OLE::Const 'Microsoft Excel'; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T13:42:22.990

xlByRows 不是一个常数，你应该把它放在引号中。除非它是由 OLE 对象导出的常量，在这种情况下，您需要使用 Win32::OLE::Const 或类似方法将其导入命名空间。

# refactoring - 我什么时候应该破坏一个函数？

> ID：610588
> 
> 赞同：7
> 
> 时间：2009-03-04T13:41:09.920
> 
> 标签：refactoring

将长函数分解为主要函数和辅助函数是谨慎的做法。

我知道只会调用模块外部的主要功能，但它的长度可能会被证明是令人生畏的。

教科书对行数有限制，但我觉得这太死板了。

PS 我正在用 Python 编程，需要处理传入的消息。该函数返回一个包含消息的元组，但采用 Python 的内部数据类型。因此，您可以看到每种消息类型的一些独立代码。

**重复的问题**

[什么时候函数太长？](https://stackoverflow.com/questions/475675/when-is-a-function-too-long)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T13:44:30.847

我不喜欢将一个函数不必要地分解为多个函数。这不是一件难事——如果有些事情看起来像是不同的逻辑单元，那么一定要把它们分开并单独考虑。但是不要仅仅为了“每个函数一页”或“每个函数 N 行”之类的指导方针而将事情分开。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T13:47:40.763

我认为你需要从问题的另一端解决这个问题。自下而上思考。确定尽可能小的工作单元，然后开始以这种方式编写代码。当您自上而下编写代码并且不保持结构化方法时，您只会遇到意大利面条代码问题。

如果您已经有了意大利面条式代码并且需要重构，那么您几乎必须重新开始。分解现有的意大利面条代码可能比重写它更多的工作，结果可能没有那么好。

我认为方法中的代码行数也不应该有一个硬数字，但是写得好的代码中没有超过 5 到 10 行在较低层和 20 到 30 行在业务逻辑中的方法. 给你某种指标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T13:43:38.090

一个好的经验法则是，如果它不适合单个屏幕，则值得*考虑*将其拆分。但只有在拆分它有意义的情况下，一些长函数是完全可读的，并且仅仅为了它而将它们分成多个函数是没有任何意义的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T13:52:08.257

切勿编写打印在折叠纸上时比您高的函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T15:23:55.213

我喜欢这样的经验法则，即如果您能想出一个与域相关的*好名称，您应该拆分子功能。*

当某人不必查找子功能的定义就可以理解顶级功能时，您可能已经获得了净收益。（但是当你把它分解得太远时，你的名字开始指代你的实现工件而不是域）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T13:45:10.113

我最近正在和一个朋友讨论这个问题。他建议重构以分离关注点，我必须说我必须同意。也就是说，一个函数应该做一件事，如果它做不止一件事，就把它拆分。如果不是，就让它在一起，拆分一个功能是没有意义的，只是让它混淆了含义。毕竟，函数是做一件事的代码块！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T13:47:00.547

行数的限制通常是不切实际的，因为它不能很好地考虑可读性。最好尝试将只有几个输入和几个输出的代码行分开，并使其成为一个单独的函数。这并不总是可能的——那么明智的做法是让代码保持原样，而不是为了重构而重构。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T13:58:39.147

好吧，因为我用 Python 编码，所以我可以自由地在函数内部编写函数，这与 C、C++ 或 Java 不同。我觉得这是一个更好的选择。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-04T08:42:11.427

它没有指定。但是线应该尽可能低。但是您可以遵循 30 的角色。我会在需要时在我的 PHP 脚本中遵循这一点。

**第 30 条规则：**

Martin Lippert 和 Stephen Roock 在大型软件项目中重构的“30 条规则”：

*   方法的平均代码行数不应超过 30 行。

*   一个类平均应包含少于 30 个方法。

*   一个包/库不应包含超过 30 个类。

*   子系统应避免超过 30 个包。

*   超过 30 个子系统的系统可能会产生问题。

如果一个元素包含超过 30 个子元素，则很可能存在严重问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T13:47:30.343

如果它可以节省总行数或总处理时间，我个人会破坏一个函数。

如果我每个主要功能只运行一次助手，我不会打扰

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T13:47:43.383

关键是原则上最好有专门的功能。但是在哪里设置限制很大程度上取决于 1）某些语言的“通常”编程风格。（可以观察到，面向对象的语言往往比 C 之类的语言更短 2）这取决于您的编程方式。每个硬限制都必须受到质疑。恕我直言。总的来说，程序可能会有一些“自然”分布 3）我认为一个人应该记住的是，一个函数应该做某项任务，例如一些用于解析它的函数通常比只设置某个字段的函数长得多在一个结构中。或者回过头来考虑一下 Windows API 中的事件循环的外观。所以这一切都表明长方法可能有充分的理由......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-04T13:48:14.723

如果有独立的代码（在您的情况下，每种消息类型的具体情况）这些区域应该被打破。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-04T13:49:59.010

大小无关紧要。以我的大小来判断我吗？- 尤达

您主要关心的是可读性、简单性和可维护性。一个好的指标是，如果您需要编写注释来解释函数的一部分，那么该部分是单独函数的良好候选者。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-04T13:51:09.867

将长函数分解为其组成部分的原因有很多。最重要的是：

*   可读性
*   可维护性
*   代码清晰度/意图

一些简单的功能不能分解成更小的部分而不会对列出的目标产生负面影响，因此没有硬性规定。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-03-04T13:50:15.903

如果您没有编写它并且它已经在生产中：永远！如果你打破它，你很可能会打破它，就这么简单。

如果您正在编写它并且您不确定，那么屏幕上的规则就像其他人所说的那样。

# java - 是否有构建在 Hibernate 之上的 ActiveRecord 模式的 java 实现，类似于 Castle Windsor？

> ID：610590
> 
> 赞同：12
> 
> 时间：2009-03-04T13:41:51.057
> 
> 标签：java, hibernate, orm, activerecord

我正在寻找建立在 Hibernate 之上的 ActiveRecord 模式的 Java 实现。

在.Net 中有一个开源项目[Castle Windsor ActiveRecord](http://www.castleproject.org/activerecord/)，它在NHibernate 之上实现了ActiveRecord 模式。

我正在寻找类似的东西，除了坐在 Java 的 NIBerate 持久性框架之上。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-07-19T20:27:42.950

我发布了一个名为 ActiveJDBC 的项目：http: [//javalite.io/](http://javalite.io/)。这就是你要找的

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-15T07:56:15.777

我会说[GORM 是一种更好的与 Java 一起使用的模式，而不是 ActiveRecord](http://nathan.crause.name/entries/programming/grails-first-impressions-%E2%80%93-gorm-vs-activerecord)。ActiveRecord 最终需要比 GORM 更多的工作和更多的编码。据我所知，Django 遵循 GORM 模型而不是 AR 模型，因此该模型可能值得研究，特别是考虑到 Java 可能不会像 Ruby 那样适用于动态 getter 和 setter（除非你开始钻研动态生成字节码，但你的编译器和 IDE 不太喜欢那样）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T13:49:49.947

好吧，Grails 中的 GORM 不能与 Grails 分离——至少在 1.1 版发布之前。坦率地说，GORM 和 AR 之间几乎没有区别（例如：在 Grails 中，您对域对象进行建模，而 GORM 将推断数据库结构，而在 AR 中，一方面有表，另一方面有对象） . 哦，还有一个区别是 GORM 有很多怪癖。注意我没有说错误...

无论如何，这是关于 stackoverflow 的另一篇类似文章，可能涵盖您所追求的内容： [Java 中的 ActiveRecord 模式是否像 Ruby 中的那样实现？](https://stackoverflow.com/questions/548861/is-there-an-implementation-of-the-activerecord-pattern-in-java-like-the-one-from)

干杯，

罗洛

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-08T06:08:45.767

实际上，我一直在研究类似 AR 的 Java 框架，第一篇博客：http: [//igorpolevoy.blogspot.com/](http://igorpolevoy.blogspot.com/) 干杯，igor

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T13:44:20.943

Groovy / Grails 中的 GORM？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-14T21:13:02.763

Scooter Framework 有一个非常类似于 Ruby on Rails 的 ActiveRecord 实现：[http ://www.scooterframework.com/](http://www.scooterframework.com/)

# java - SQL：带有绑定变量的批处理语句

> ID：610593
> 
> 赞同：1
> 
> 时间：2009-03-04T13:42:33.257
> 
> 标签：java, jdbc

我希望减少应用程序中的往返次数以提高性能。我想使用`PreparedStatement`s 来获得众多好处。

这是我想出的一个例子..概括了细节..

```
 Class.forName( "..Driver" );
  Connection connection = DriverManager.getConnection( .. );      
  PreparedStatement statement = connection.prepareStatement( "UPDATE Table SET XmlData = ? WHERE SomeGUID = ?; INSERT INTO SomeTable ( Col1,Col2 ) VALUES ( ?, ? )" );

  try{ 
     statement.setString( 1, "<XmlData></XmlData>" );
     statement.setString( 2, "32ABD5-438B0-.." );
     statement.setString( 3, "ABC" );
     statement.setString( 4, "XYZ" );
     statement.execute();
     connection.commit();
  }
  catch {
     connection.rollback();
  }
  finally {
     statement.close();
     connection.close();
  } 
```

*（同样，这不是实际代码，只是一个简化示例）*

一般来说，我试图在单个语句中执行多个插入/更新语句以减少往返流量。这是一种有效的方法还是有更可接受的方法？

我可以为单个事务处理数千个语句。我可能会将语句分割成大小合理的块，以防止单个语句执行超时。

我将支持多个数据库供应商，但将使用 ANSI SQL，因此应该没有问题。如果需要，我可以利用 DAL 的智能。所以，这不是问题。

任何提示/建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T13:58:05.293

这是 Oracle 的 JDBC 手册中的一个示例。这被描述为“标准”（非 Oracle 特定）方法。

```
PreparedStatement pstmt = 
          conn.prepareStatement("INSERT INTO employees VALUES(?, ?)");

pstmt.setInt(1, 2000);
pstmt.setString(2, "Milo Mumford");
pstmt.addBatch();

pstmt.setInt(1, 3000);
pstmt.setString(2, "Sulu Simpson");
pstmt.addBatch();
...
int[] updateCounts = pstmt.executeBatch(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T02:10:32.053

顺便说一句，如果你担心性能，你应该考虑使用一个连接池包，比如[dbcp](http://commons.apache.org/dbcp/)，它也支持 PreparedStatement 池。 [c3p0](http://sourceforge.net/projects/c3p0)也很受欢迎，但我没有任何经验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T13:56:37.887

`PreparedStatement``addBatch`支持使用和批量提交具有不同参数的相同语句`executebatch`。我认为没有一种以跨数据库平台方式执行多个参数化语句的好方法。传统上，这将由 [evil] 存储过程处理。

# php - 帮助我将长值（以十六进制表示）转换回日期/时间

> ID：610603
> 
> 赞同：0
> 
> 时间：2009-03-04T13:45:15.340
> 
> 标签：php, datetime, hex, long-integer

我有一个日期值，我被告知是 8 个字节，一个“长”（又名 int64）值，并转换为十六进制：

```
60f347d15798c901 
```

如何使用 PHP 将这个和类似的值转换为时间/日期？

将其转换为十进制给我： 96 243 71 209 87 152 201 1

更多信息：原始值是 C# DateTime，应该表示大约 2 或 3 周前的时间/日期。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T14:56:37.697

我找到[了另一个参考](http://www.digital-detective.co.uk/freetools/decode.asp)，它可能指向一些更相关的信息。在这种情况下，注册表中使用的 Windows 日期和时间。显然，这些也存储为 64 位值。

这看起来更有帮助，因为它提到以 C?01 结尾是此类日期的指示符。请注意，这是小端序（即右侧的最高有效字节），因此 hexdec() 的字节顺序错误，而不会一次将它们反转 2 个十六进制数字（即，从最右边的 2 个十六进制数字开始，然后是接下来的两个，等等）。

而且，根据[这个消息来源](http://social.microsoft.com/Forums/en-US/vblanguage/thread/9a663255-94c8-426e-8aed-571ab97f4fe1)，

> 一个滴答表示一百纳秒或百万分之一秒。此属性的值表示自 0001 年 1 月 1 日午夜 12:00:00 以来经过的 100 纳秒间隔数，它表示。

不幸的是，PHP 无法处理 64 位整数，这可能会让您感到困惑。它的最大值为 32 位。浮点数会有所帮助，但这并不能阻止 hexdec() 本身仅处理整数。所以做这个数学可能很复杂；您可能仍需要将其分成两部分，然后通过将更重要的值转换为浮点数并将其乘以 2^32 将它们组合成浮点数，也将其转换为浮点数。 *为 64 位硬件构建的 PHP 可能没有此限制，但我不确定。*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T17:56:34.830

（感谢 thomasrutter 的帖子，它给了我 Windows 文件时间时代）：

给定的日期似乎是 Windows 64 位 little-endian 文件日期时间，60 f3 47 d1 57 98 c9 01，相当于四字 01c99857d147f360，整数为 128801567297500000

这是“自公元 1601 年 1 月 1 日 (CE) 协调世界时 (UTC) 午夜 12:00 以来经过的 100 纳秒间隔数”

转换后，它给出了 Thu, 26 February 2009 21:18:49 UTC

示例代码：

```
<?php

    // strip non-hex characters
    function hexstring($str) {
        $hex = array(
            '0'=>'0',   '1'=>'1',   '2'=>'2',   '3'=>'3',   '4'=>'4',
            '5'=>'5',   '6'=>'6',   '7'=>'7',   '8'=>'8',   '9'=>'9',
            'a'=>'a',   'b'=>'b',   'c'=>'c',   'd'=>'d',   'e'=>'e',   'f'=>'f',
            'A'=>'a',   'B'=>'b',   'C'=>'c',   'D'=>'d',   'E'=>'e',   'F'=>'f'
        );

        $t = '';
        $len = strlen($str);
        for ($i=0; $i<$len; ++$i) {
            $ch = $str[$i];
            if (isset($hex[$ch]))
                $t .= $hex[$ch];
        }

        return $t;
    }

    // swap little-endian to big-endian
    function flip_endian($str) {
        // make sure #digits is even
        if ( strlen($str) & 1 )
            $str = '0' . $str;

        $t = '';
        for ($i = strlen($str)-2; $i >= 0; $i-=2)
            $t .= substr($str, $i, 2);

        return $t;
    }

    // convert hex string to BC-int
    function hex_to_bcint($str) {
        $hex = array(
            '0'=>'0',   '1'=>'1',   '2'=>'2',   '3'=>'3',   '4'=>'4',
            '5'=>'5',   '6'=>'6',   '7'=>'7',   '8'=>'8',   '9'=>'9',
            'a'=>'10',  'b'=>'11',  'c'=>'12',  'd'=>'13',  'e'=>'14',  'f'=>'15',
            'A'=>'10',  'B'=>'11',  'C'=>'12',  'D'=>'13',  'E'=>'14',  'F'=>'15'
        );

        $bci = '0';
        $len = strlen($str);
        for ($i=0; $i<$len; ++$i) {
            $bci = bcmul($bci, '16');

            $ch = $str[$i];
            if (isset($hex[$ch]))
                $bci = bcadd($bci, $hex[$ch]);
        }

        return $bci;
    }

    // WARNING! range clipping
    //   Windows date time has range from 29000 BC to 29000 AD
    //   Unix time only has range from 1901 AD to 2038 AD
    // WARNING! loss of accuracy
    //   Windows date time has accuracy to 0.0000001s
    //   Unix time only has accuracy to 1.0s
    function win64_to_unix($bci) {
        // Unix epoch as a Windows file date-time value
        $magicnum = '116444735995904000';

        $t = bcsub($bci, $magicnum);    // Cast to Unix epoch
        $t = bcdiv($t, '10000000', 0);  // Convert from ticks to seconds

        return $t;
    }

// get input
$dtval = isset($_GET["dt"]) ? strval($_GET["dt"]) : "0";
$dtval = hexstring($dtval);         // strip non-hex chars

// convert to quadword
$dtval = substr($dtval, 0, 16);     // clip overlength string
$dtval = str_pad($dtval, 16, '0');  // pad underlength string
$quad = flip_endian($dtval);

// convert to int
$win64_datetime = hex_to_bcint($quad);

// convert to Unix timestamp value
$unix_datetime = win64_to_unix($win64_datetime);

?><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Windows datetime test code</title>
</head>

    <form method="get">
        <label>Datetime value: <input name="dt" type="text" value="<?php echo $dtval; ?>"/></label>
        <input type="submit" />
    </form>
    <hr />
    Result:
        Quad: <?php echo $quad; ?><br />
        Int: <?php echo $win64_datetime; ?><br />
        Unix timestamp: <?php echo $unix_datetime; ?><br />
        Date: <?php echo date("D, d F Y H:i:s e", $unix_datetime); ?><br />
<body>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T13:47:10.250

您给出的值是 36 个十六进制数字，即 18 个字节。那*不是*`Int64`转换为十六进制。

回到给你解释格式的人那里，让他们这次告诉你真相：)

编辑：好的，下一步：找出这个数字的实际含义。自 1970 年以来的蜱虫？公元 1 年以来的米利斯？你知道你的示例字符串是什么意思吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T13:56:57.527

我相信您可以将其转换为十进制整数，`hexdec().` 这将是您可以使用的时间戳`date().`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T14:01:32.353

如果它与[此处描述的 64 位十六进制 NTP 时间戳](http://commons.apache.org/net/apidocs/org/apache/commons/net/ntp/TimeStamp.html)类型相同，那么您应该将十六进制字符串一分为二，也就是说，想象前 8 个十六进制数字和其他 8 个数字之间的分隔符。

使用 hexdec() 将前半部分（前 32 位的值）转换为整数，该整数将是 Unix 时间戳格式的日期值（自 1970 年 1 月 1 日 GMT 以来的秒数），然后您可以在 date() 函数中使用， ETC。

第二部分是小数部分，如果您需要小于一秒的精度（虽然没有多少应用程序这样做，PHP 的内置日期和时间函数除了 microtime() 之外没有），这很有用。您还可以使用 hexdec() 将其转换为十进制。

# sql-server - 跨多个数据库查找表 SQL SERVER 2005

> ID：610609
> 
> 赞同：9
> 
> 时间：2009-03-04T13:46:47.397
> 
> 标签：sql-server, tsql, sql-server-2005, ssms

我将表导出到服务器，但找不到该表。也许我没有放置正确的目标数据库。如果我的服务器有多个数据库，而不打开每个数据库，如何找到此表？

我使用 MS Sql Server Management Studio 2008。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T13:57:31.143

粗糙和肮脏，但它会完成这项工作。

```
-- Instructions. Replace "table_name_here" with actual table name
sp_MSforeachdb 'USE ?
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N''[table_name_here]'') AND OBJECTPROPERTY(id, N''IsUserTable'') = 1)
BEGIN
  PRINT ''Found in db ?''
END' 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-03-19T21:37:54.933

单程

```
SELECT  DISTINCT DB_NAME(database_id) 
FROM [sys].[dm_db_index_operational_stats](NULL,NULL,NULL,NULL)
WHERE OBJECT_NAME(object_id,database_id) = 'table_name' 
```

或者，如果您有理由相信它会`dbo`在任何数据库的模式中

```
SELECT name
FROM   sys.databases
WHERE  CASE
         WHEN state_desc = 'ONLINE' 
              THEN OBJECT_ID(QUOTENAME(name) + '.[dbo].[table_name]', 'U')
       END IS NOT NULL 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-12T22:36:12.073

基于上面 Martin Smith 的回答，但概括为一个视图，以提供一种跨数据库版本的 sys.tables -

```
CREATE VIEW ListTablesAllDBs

AS

SELECT 
    DB_NAME(database_id) as DBName,
    OBJECT_SCHEMA_NAME(object_id,database_id) as SchemaName,
    OBJECT_NAME(object_id,database_id) as TableName
FROM
    [sys].[dm_db_index_operational_stats](NULL,NULL,NULL,NULL) 
```

现在，如果我能想出一种方法来为列做同样的事情就好了......

编辑 - 忽略这一点，发现它有时会完全错过表格。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-17T20:29:21.310

为了避免那些不知道如何命名数据库的“超级用户”的人头疼，进行了一些小的澄清：

```
EXEC sp_MSForEachDB '
USE [?]
IF OBJECT_ID(''mytable'') IS NOT NULL AND
   OBJECTPROPERTY(OBJECT_ID(''mytable''), ''IsTable'') = 1
PRINT ''Found here: ?''' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T13:54:46.737

```
select 'select * from '+name+'.sys.tables where name=
        ''[yourtable]'';' from sys.databases 
```

而不是 [yourtable]，键入缺少的表的名称，然后再次运行结果。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T14:02:01.307

```
EXEC sp_MSForEachDB '
USE ? 
IF OBJECT_ID(''mytable'') IS NOT NULL AND
   OBJECTPROPERTY(OBJECT_ID(''mytable''), ''IsTable'') = 1
    PRINT ''?''
' 
```

# makefile - 向 Makefile 添加注释

> ID：610623
> 
> 赞同：15
> 
> 时间：2009-03-04T13:48:39.450
> 
> 标签：makefile

如何在 a 中添加注释（带回显）`Makefile`以便在运行时打印它们？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-04T14:45:20.173

你应该使用

```
target:
     @echo "Building!" 
```

注意`@`，它告诉 Make 不要显示命令本身。如果没有这个，输出将如下所示：

```
echo "Building!"
Building! 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-11-06T22:38:44.930

或者，由于 Make 只是将规则中的任何内容推送到 bash，因此您可以只使用磅来让 bash 将其视为注释。

```
Rule:  Dependencies
    # Your Comment
    Command 
```

将输出

```
$ make Rule
    # Your Comment
    Command 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T13:50:10.443

由于 makefile 主要包含在构建特定目标时要运行的命令，我会说你只使用它：`echo`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T13:52:34.917

```
all :
    echo "Building!"
    $(CC) $(OBJECTS) $(LPATH) $(LIBS) -o $(PROGRAM) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T14:04:19.117

Visual C++ nmake 具有[`!message text...`](http://msdn.microsoft.com/en-us/library/7y32zxwh.aspx)预处理指令。我没有使用过 GNU make，所以如果它有它，我不会，但快速搜索显示它有这个[`$(info text...)`](http://www.gnu.org/software/make/manual/make.html#Make-Control-Functions)功能。

在命令块内，您可以使用`echo`.

# java - 检查某个异常类型是否是嵌套异常中的原因（原因等）的最佳方法？

> ID：610628
> 
> 赞同：37
> 
> 时间：2009-03-04T13:49:52.957
> 
> 标签：java, spring, exception, exception-handling, nested-exceptions

我正在编写一些 JUnit 测试来验证是否`MyCustomException`引发了类型异常。但是，此异常多次包装在其他异常中，例如 InvocationTargetException，而 InvocationTargetException 又被包装在 RuntimeException 中。

确定 MyCustomException 是否以某种方式导致我实际捕获的异常的最佳方法是什么？我想做这样的事情（见下划线）：

```
 try {
    doSomethingPotentiallyExceptional();
    fail("Expected an exception.");
} catch (RuntimeException e) {
     if (!e.原由(MyCustomException.class)
        fail("Expected a different kind of exception.");
} 
```

我想避免调用`getCause()`一些“层”深，以及类似的丑陋解决方法。有没有更好的方法？

（显然，Spring 有[NestedRuntimeException.contains(Class)](http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/core/NestedRuntimeException.html)，它可以满足我的要求 - 但我没有使用 Spring。）

**关闭：** 好的，我想真的没有绕过实用方法:-) 感谢所有回复的人！

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2015-03-25T10:17:09.620

如果您使用的是[Apache Commons Lang](https://commons.apache.org/proper/commons-lang/javadocs/api-3.1/org/apache/commons/lang3/exception/ExceptionUtils.html#indexOfThrowable%28java.lang.Throwable,%20java.lang.Class%29)，那么您可以使用以下内容：

(1) 当原因应该是指定的类型时

```
if (ExceptionUtils.indexOfThrowable(exception, ExpectedException.class) != -1) {
    // exception is or has a cause of type ExpectedException.class
} 
```

(2) 当原因应该是指定类型或其子类类型时

```
if (ExceptionUtils.indexOfType(exception, ExpectedException.class) != -1) {
    // exception is or has a cause of type ExpectedException.class or its subclass
} 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-04T14:05:32.060

为什么要避免`getCause`。当然，您可以为自己编写一个执行任务的方法，例如：

```
public static boolean isCause(
    Class<? extends Throwable> expected,
    Throwable exc
) {
   return expected.isInstance(exc) || (
       exc != null && isCause(expected, exc.getCause())
   );
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-04T13:59:54.477

我认为您别无选择，只能通过 getCause 层调用。如果您查看您提到的 Spring NestedRuntimeException 的源代码，那就是它的实现方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T14:32:14.807

模仿是最真诚的奉承。 [基于对源的快速检查](http://fisheye1.atlassian.com/browse/springframework/spring/src/org/springframework/core/NestedRuntimeException.java?r=MAIN)，这正是 NestedRuntimeException 所做的：

```
/**
 * Check whether this exception contains an exception of the given type:
 * either it is of the given class itself or it contains a nested cause
 * of the given type.
 * @param exType the exception type to look for
 * @return whether there is a nested exception of the specified type
 */
public boolean contains(Class exType) {
    if (exType == null) {
        return false;
    }
    if (exType.isInstance(this)) {
        return true;
    }
    Throwable cause = getCause();
    if (cause == this) {
        return false;
    }
    if (cause instanceof NestedRuntimeException) {
        return ((NestedRuntimeException) cause).contains(exType);
    }
    else {
        while (cause != null) {
            if (exType.isInstance(cause)) {
                return true;
            }
            if (cause.getCause() == cause) {
                break;
            }
            cause = cause.getCause();
        }
        return false;
    }
} 
```

**警告**：以上是 2009 年 3 月 4 日的代码，所以，如果你真的想知道 Spring 现在在做什么，你应该研究现在存在的代码（无论何时）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T14:06:13.933

好吧，我认为如果不调用`getCause()`. 如果您认为这样做很难实现一个**实用程序**类：

```
public class ExceptionUtils {
     public static boolean wasCausedBy(Throwable e, Class<? extends Throwable>) {
         // call getCause() until it returns null or finds the exception
     }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-07-21T18:41:26.760

您可以使用番石榴做到这一点：

```
FluentIterable.from(Throwables.getCausalChain(e))
                        .filter(Predicates.instanceOf(ConstraintViolationException.class))
                        .first()
                        .isPresent(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-07-18T20:28:03.873

基于 Patrick Boos 的回答：如果您使用 Apache Commons Lang 3，您可以检查：

**indexOfThrowable** ：返回与异常链中指定类（**完全**）匹配的第一个 Throwable 的（从零开始的）索引。**指定类的子类不匹配**

```
if (ExceptionUtils.indexOfThrowable(e, clazz) != -1) {
    // your code
} 
```

或者

**indexOfType** ：返回与异常链中指定的**类或子类**匹配的第一个 Throwable 的（从零开始的）索引。**指定类的子类匹配**

```
if (ExceptionUtils.indexOfType(e, clazz) != -1) {
    // your code
} 
```

Java 8 的多种类型的示例：

```
Class<? extends Throwable>[] classes = {...}
boolean match = Arrays.stream(classes)
            .anyMatch(clazz -> ExceptionUtils.indexOfType(e, clazz) != -1); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-11-04T02:39:55.053

您可以使用`ExceptionUtils.hasCause(ex, type)`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-09-14T11:30:09.690

如果感兴趣的异常绝对是“根本”原因，`assertj`则可以在另一个地方进行`getRootCause`检查，尽管从今天的源头来看，它似乎在其他答案中讨论了可能的无限循环问题。

# delphi - 我在哪里可以找到免费/开源的 Delphi 多媒体组件？

> ID：610638
> 
> 赞同：3
> 
> 时间：2009-03-04T13:51:05.060
> 
> 标签：delphi, components, multimedia, vlc, codec

我在一个项目中，我必须能够播放几乎音频/视频文件（格式）。

### 要求：

### 视频：

*   .dat (vcd & svcd)
*   .vob (DVD)
*   .rmvb（真实媒体）
*   .mp4 (mpeg4/x264/h264)
*   .wmv/.asf（Windows 媒体）
*   .avi (xvid/divx/mpeg2等...)
*   .mkv（matroska，可选）

    ### 声音的：

*   .mp3（你可能知道这个）

*   .ogg (vorbis)
*   .wma（Windows 媒体）
*   .wav（波）

我已经安装了上述所有编解码器，并且在我的系统上完美运行（使用 WMP 10、Media Player Classic Home Cinema、VLC 和 Zoom Player 进行了尝试）。

而且我已经尝试过基本的 TMediaPlayer 但不能在 .avi 之外的其他视频上工作，然后我抓取 DSPack 但它不能播放 .avi (xvid/divx) 或 .mkv，我抓取 VLC 但它只给了我更令人头疼，因为它只是 ActiveX 包装器（没有纯 vcl 组件）。

有人可以建议另一个组件吗？免费或开源将是首选。

编辑：我已经解决了 DSPack 的问题，看起来我必须始终使用 FDDShow 来使用 DSPack 播放视频。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T16:14:28.367

您可以导入 WMP 10 ActiveX 控件（Component->Import Component 菜单项），然后将 WMP 嵌入到您的应用程序中。

由于它是操作系统的一部分，因此没有比这更免费的了；如果你可以运行你的 Delphi 应用程序，那么操作系统就在那里。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T21:12:30.943

DSPack 将成为我的建议。我不确定您在使用 DivX 时遇到了什么问题 - 我多年来一直使用免费的 DivX 编解码器和基于 DSPack 的程序。FFDShow 看起来也是一个很有前途的解决方案，尽管我遇到了某些类型文件的播放质量问题（撕裂、低帧速率、长时间播放时不稳定等）。视频硬件和驱动程序也很重要，除非您提供完整的硬件、软件和图像包，否则程序的用户可能会在播放的主观接受度（对他们）方面遇到不同的问题。请记住这一点 - 编解码器版本很重要，驱动程序版本很重要，而且无论制造商怎么说，某些硬件都无法正常工作。

# ms-access - 用于访问的 OpenEdge ODBC

> ID：610645
> 
> 赞同：0
> 
> 时间：2009-03-04T13:52:16.167
> 
> 标签：ms-access, openedge, progress-db

我无法更新对新 ODBC 驱动程序的访问中的链接。我相信 OpenEDge 10.1C 没有与 Access 握手。dns 会将外部数据导入 excel。错误是“错误（-7748）此错误没有消息”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-25T15:18:08.260

大多数涉及 SQL 和 Progress 的“奇怪”错误是 Progress 将*所有*数据存储为可变长度的结果。此外，大多数 Progress 数据库中的大部分数据都是由 4GL 程序创建、更新和操作的，而这些程序对 SQL 关于列宽的想法既不了解也不敏感。

当您尝试使用 SQL 查询 Progress 数据库时遇到奇怪错误时，您的第一道防线应该是运行**dbtool**（在 db 服务器上）以修复任何可能的 SQL 宽度问题。只需运行 dbtool（在 Progress "bin" 目录中找到，如果操作系统是 UNIX，则使用 $DLC/bin/dbtool，如果您正在运行 Windows，则使用 "proenv" 获取命令提示符，然后使用 %DLC%\bin\dbtool）和选择选项 2。如果您经常遇到问题，您可能需要编写脚本并自动运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-03-29T16:06:35.473

进度 ODBC 错误 -7748 可以通过添加注册表项来解决。[此讨论](http://www.progresstalk.com/showthread.php?114231-WorkArounds2-8192)解释了解决方法及其作用。

本质上，注册表项：

```
HKEY_CURRENT_USER\Software\ODBC\ODBC.INI\[Your data source name] 
```

应该是一个名为“Workarounds2”的字符串值条目，其值应设置为 8192。

请参阅： http: [//media.datadirect.com/download/docs/odbc/allodbc/index.html#page/odbc/workaround-options.html](http://media.datadirect.com/download/docs/odbc/allodbc/index.html#page/odbc/workaround-options.html)

# sql-server - 对于设置为合并复制推送订阅者的 SQL Server 2005 数据库，是否也可以使用与发布者相同的数据库？

> ID：610651
> 
> 赞同：3
> 
> 时间：2009-03-04T13:53:32.653
> 
> 标签：sql-server, replication

我们在不同办公室的数据库之间设置了合并（推送）复制。每个数据库都承载着完整的数据集，因此每个办公室的用户只需要连接到他们办公室的数据库服务器。当用户想要离开现场时，他们需要将一部分数据提取到本地（在用户的笔记本电脑上）SQL Express 数据库。是否可以使用 SQL Server 2005 复制从订阅者数据库之一中提取此子集，然后再将其本地更改复制回来？

**编辑**：我们不希望区域办事处的用户针对我们的主要发布者数据库进行复制，而是针对订阅者数据库进行复制。因此，每个订阅者都必须充当该办公室中用户的发布者（甚至可能使用事务复制而不是合并复制）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T14:15:48.213

是的，但是使非现场用户的 SQL Server 2005 Express Edition 成为合并复制订阅者（即指向您的分发服务器）。

[参考](http://msdn.microsoft.com/en-us/library/ms151819(SQL.90).aspx)。

# svn - 服务器故障后从目录备份中恢复 svn

> ID：610652
> 
> 赞同：4
> 
> 时间：2009-03-04T13:53:35.880
> 
> 标签：svn, visualsvn, visualsvn-server, code-migration

托管我们的 svn 服务器的机器出现故障。我们能够恢复`C:\Repositories\`目录。我们如何将其迁移到新主机？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T13:56:09.587

只需在新服务器上正常安装 svn，将存储库目录复制到新服务器，然后将 svn 指向包含存储库的目录。

# silverlight - Silverlight 网络摄像头

> ID：610655
> 
> 赞同：5
> 
> 时间：2009-03-04T13:53:55.193
> 
> 标签：silverlight, webcam

是否可以在 Silverlight 中访问网络摄像头

据我所知，在 Silverlight 1.0 中是不可能的，但是 2.0...3.0...4.0 呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-26T15:48:41.187

现在可以在 Silverlight 4.0 中使用。开发者预览版可在[http://silverlight.net/getstarted/silverlight-4-beta/获得](http://silverlight.net/getstarted/silverlight-4-beta/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T14:05:45.743

恐怕 Silverlight 2.0 中不提供网络摄像头支持。您可能希望在未来的版本中添加它，但现在没有简单的方法来做到这一点...... 说到这里，有些人已经发明了各种黑客，这些黑客使用其他技术与 Silverlight 相结合来从网络摄像头捕获视频。它们通常涉及与 Flash 的接口，当然它完全能够利用网络摄像头。看[这篇文章](http://jonas.follesoe.no/PermaLink,guid,7f8857dc-5f37-4a8a-bd35-fd4b624af45b.aspx)举个例子（包括源代码）。这不是一个很好的解决方案（至少在我看来），并且在浏览器/平台上可能不是 100% 稳定的，但我认为这是你现在能得到的最好的解决方案。如果您真的想在 Silverlight 3.0 中看到支持，也许您应该直接向 Microsoft 提交反馈（尽管它肯定在其他地方提到过，所以它可能已经在待办事项列表上）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-04T17:31:28.103

Silverlight 4 支持网络摄像头。要捕获图像，您可以使用[www.glo6.com/camera1.aspx](http://www.glo6.com/camera1.aspx) 它将编码的图像保存到 Web 服务器。如果需要运动跟踪，请定期保存图像，然后将它们在您的服务器上与其他应用程序进行比较。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-09T02:34:18.233

我询问了 Silverlight 团队的一位成员，他们何时会推出网络摄像头支持，他实际上说：“我们只能说这是 Silverlight 4.0 的一个非常高的优先级。” 也就是说，它还没有正式宣布，所以在微软宣布之前我不会指望它。

我在生产代码中使用了 Silverlight -> JavaScript -> Flash hack，虽然它确实有效，但效果不佳。除此之外，让 Flash 相机与 Silverlight UI 保持同步是一件很痛苦的事情。例如，相机显示在 SL 子窗口控件的顶部，当然，它不遵守剪辑规则，例如，它应该在列表框中滚动到视线之外。动画也是 PITA。这一切皆有可能，只是速度缓慢且令人不快，而且比 MS 仅支持 Silverlight 中的网络摄像头的工作量要多几个数量级。

# mysql - 按日、周、月、年保存统计数据的数据库结构

> ID：610679
> 
> 赞同：14
> 
> 时间：2009-03-04T13:59:03.153
> 
> 标签：mysql, database, database-design

我必须按天、周、月和年为网站收集用户活动的统计数据。我是数据库设计阶段，我想正确地完成这个阶段，因为它会让我的编码生活更轻松。

我所要做的只是在每次活动发生时将数据库中的字段值增加 1。这样我就可以按每天、每周、每月和每年调出日期。我的数据库应该如何构建？抱歉，如果这对大多数人来说是一个简单的问题。如果这种结构可以扩展，这样它就可以被其他类别分解，那也很棒。

遇到麻烦的一点是每个月都由更多的天组成，而这些天每个日历年都在变化。

感谢大家的任何帮助或指导。

其他信息：Linux机器，使用PHP和MySQL

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-04T14:06:54.493

每次活动发生时，只需在表中插入一行，而不是更新每天、每周的计数，如下所示：

```
insert into activities (activity_date, activity_info) 
values (CURRENT_TIMESTAMP, 'whatever'); 
```

现在您的报告非常简单，例如：

```
select count(*) from activities
where activity_date between '2008-01-01' and '2008-01-07'; 
```

或者

```
select YEARWEEK(`activity_date`) as theweek, count(*)
group by theweek 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T14:07:53.117

您可以只将记录添加到表中，`SELECT`然后使用聚合函数。

如果由于某种原因您需要保留汇总统计信息，您可以使用：

```
CREATE TABLE aggregates (type VARCHAR(20), part VARCHAR(10) NOT NULL PRIMARY KEY, activity INT)

INSERT INTO aggregates (type, part, activity)
VALUES ('year', SUBSTRING(SYSDATE(), 1, 4), 1)
ON DUPLICATE KEY UPDATE activity = activity + 1

INSERT INTO aggregates (type, part, activity)
VALUES ('month', SUBSTRING(SYSDATE(), 1, 7), 1)
ON DUPLICATE KEY UPDATE activity = activity + 1

INSERT INTO aggregates (type, part, activity)
VALUES ('day', SUBSTRING(SYSDATE(), 1, 10), 1)
ON DUPLICATE KEY UPDATE activity = activity + 1 
```

这将自动更新现有行并在需要时插入不存在的行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T14:09:26.670

1.  事件表：id、活动 id、日期时间、用户 ID。
2.  用户表：id、用户名等
3.  活动表：id、活动名称等

当事件发生时，只需在事件中输入一个新行。然后您可以分析事件，但可以操纵时间、日期、用户、活动等。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T14:12:15.790

首先，您可能会想象一个表，因为这将是最标准化的形式。该表将简单地为您收到的每个命中提供一个条目，每一行包含该命中的日期/时间。

现在，通过这种方式，为了获得每小时、每天、每周等的统计信息，查询很简单，但您的数据库将不得不做一些非常繁重的查询工作。特别是，进行求和、计数或平均的查询将需要获取所有相关行。

您可以通过预先计算第二个表中所需的计数并确保定期将该表同步到第一个表来解决此问题。问题是，您将负责自己保持缓存同步。

这可能涉及每小时排一排。如果您每天最多只能获取 24 行，那么执行一天或一个月的查询仍然会快很多。

您的另一个建议是从一开始就对其进行聚合，永远不要将每个点击存储为一行。你可能会像以前一样，每小时排一排。每次点击都会将相关小时的行增加一。您只会将数据放在一个位置，并且已经很好地总结了。

我建议按小时而不是按天的原因是，这仍然为您提供支持多个时区的选项。如果您的粒度仅为当天，则您没有该选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T14:20:03.447

Tony Andrews 的回答是最简单的，但是有时在数据仓库应用程序中会使用雪花结构：一张表记录所有活动，一张表记录每天的活动，另一个记录每月的活动，第三张记录每年的活动。使用这种结构，可以非常有效地计算任意两个日期之间的活动。 [https://en.wikipedia.org/wiki/Snowflake_schema](https://en.wikipedia.org/wiki/Snowflake_schema)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T15:17:31.607

使用星型模式设计。（或者也许是雪花设计）。

[星型设计](https://stackoverflow.com/questions/110032/star-schema-design)

您最终将为每个新活动插入事实表。请参阅托尼的建议。

您将需要至少两个维度表，一个用于用户，一个用于时间范围。可能会有活动类型的维度，甚至可能有位置的维度。这取决于你想对数据做什么。

您的问题与时间框架维度表有关。我们称之为“年鉴”。选择粒度。再说一天吧。年历将每天有一排。主键可以是日期。您的事实表应该包含这个主键作为外键，以使连接更容易。（无论您是否将其声明为外键都没有关系。这只会影响更新过程中的引用完整性。）

在年鉴中包含您能想到的每个报告期的列。周、月、季度、年等。您甚至可以包括与您公司自己的日历相关的报告期。

这是一篇比较 ER 和 DM 的文章。我很不寻常，因为我喜欢这两种方法，为适当的任务选择适当的方法。

[http://www.dbmsmag.com/9510d05.html](http://www.dbmsmag.com/9510d05.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-02T05:09:03.497

您的问题与时间框架维度表有关。我们称之为“年鉴”。选择粒度。再说一天吧。年历将每天有一排。主键可以是日期。您的事实表应该包含这个主键作为外键，以使连接更容易。（无论您是否将其声明为外键都没有关系。这只会影响更新过程中的引用完整性。）

# algorithm - Common Lisp 中的线性递归列表差分函数

> ID：610680
> 
> 赞同：2
> 
> 时间：2009-03-04T13:59:49.673
> 
> 标签：algorithm, recursion, lisp, common-lisp

我正在阅读[本](http://www.cs.sfu.ca/CC/310/pwfong/Lisp/1/tutorial1.html)教程以获得乐趣，但被他说的最后一句话卡住了，“练习：给出联合和差异的线性递归实现。” （用于列表）

联盟，没有汗水。

差异，汗水。

尝试看起来像这样。. .

```
(defun list-diff (L1 L2)
  (cond
    ((null L1) L2) 
    ((null (member (first L1) L2)) (cons (first L1) (list-diff (rest L1) L2)))
    (t (list-diff (rest L1) L2))
  )
) 
```

现在，它返回 L1 中所有不在 L2 中的元素，但它只返回所有 L2（显然）。同样，如果我将第 3 行中的 L2 更改为“nil”，那么它只会返回不在 L2 中的所有 L1，但不返回 L2。

我对变通方法的尝试看起来并不递归，当它们出现时，我最终会遇到堆栈溢出（就像我尝试在某处调用 (list-diff L2 L1) 一样）。

他的任何其他练习，例如列表交集，只需要遍历 L1 的元素。在这里，我想从 L2 中删除关键元素，或者运行 (list-diff L2 L1) 然后合并两者的结果，但这不再是真正的线性递归了。

想法？

（不是家庭作业，真的。我只是想尝试看看一些 LISP 以获得乐趣。）

编辑：根据响应正确执行此操作的功能是：

```
(defun list-diff (L1 L2)
  (cond
    ((null L1) nil)
    ((null (member (first L1) L2)) (cons (first L1) (list-diff (rest L1) L2)))
    (t (list-diff (rest L1) L2))
  )
) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:18:33.667

[集合差分](http://mathworld.wolfram.com/SetDifference.html)操作 L1\L2被定义为所有元素 e 使得 e 在 L1 中但 e 不在 L2 中。所以在我看来你的第二次尝试实际上是正确的：

> 同样，如果我将第 3 行中的 L2 更改为“nil”，那么它只会返回不在 L2 中的所有 L1，但不返回 L2。

看起来您正在尝试计算[对称差异](http://mathworld.wolfram.com/SymmetricDifference.html)，尽管我不清楚这是练习所要求的。

如果你想聪明一点，你可以将第三个列表传递给函数作为累加器。当 L1 有元素时，将第一个元素推入累加器（并递归调用） when `(null (member (first L1) L2))`。当 L1 为空时，根据累加器列表检查 L2 的元素，做同样的事情。当 L1 和 L2 为空时，返回累加器列表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T14:50:52.763

在 Lisp 中，这是“设置差异”的定义：

```
set-difference list1 list2 &key (test #'eql) test-not (key #'identity)
   Function
   Returns a list of elements of list1 that do not appear in list2\. 
```

那是您修改后的实现：

```
(defun list-diff (L1 L2)
  (cond
    ((null L1) L1)
    ((member (first L1) L2) (list-diff (rest L1) L2))
    (t (cons (first l1) (list-diff (rest l1) l2))))) 
```

# c++ - .bss 部分零初始化变量是否占用 elf 文件中的空间？

> ID：610682
> 
> 赞同：46
> 
> 时间：2009-03-04T14:00:48.157
> 
> 标签：c++, storage, elf, segments

如果我理解正确，`.bss`ELF 文件中的部分用于为零初始化变量分配空间。我们的工具链生成 ELF 文件，因此我的问题是：该`.bss`部分实际上是否必须包含所有这些零？这似乎是一种可怕的空间浪费，例如，当我分配一个全局 10 兆字节的数组时，它会在 ELF 文件中产生 10 兆字节的零。我在这里看错了什么？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-03-04T14:21:19.933

自从我与 ELF 合作以来已经有一段时间了。但我想我仍然记得这些东西。不，它实际上不包含那些零。如果你查看一个 ELF 文件程序头，你会看到每个头都有两个数字：一个是文件的大小。另一个是在虚拟内存 ( `readelf -l ./a.out`) 中分配时该部分的大小：

```
Program Headers:
  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
  PHDR           0x000034 0x08048034 0x08048034 0x000e0 0x000e0 R E 0x4
  INTERP         0x000114 0x08048114 0x08048114 0x00013 0x00013 R   0x1
      [Requesting program interpreter: /lib/ld-linux.so.2]
  LOAD           0x000000 0x08048000 0x08048000 0x00454 0x00454 R E 0x1000
  LOAD           0x000454 0x08049454 0x08049454 0x00104 0x61bac RW  0x1000
  DYNAMIC        0x000468 0x08049468 0x08049468 0x000d0 0x000d0 RW  0x4
  NOTE           0x000128 0x08048128 0x08048128 0x00020 0x00020 R   0x4
  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4 
```

类型`LOAD`的标头是在加载文件以执行时复制到虚拟内存中的标头。其他标头包含其他信息，例如所需的共享库。如您所见，包含该部分（第二个）的标题的`FileSize`和`MemSiz`显着不同：`bss``LOAD`

```
0x00104 (file-size) 0x61bac (mem-size) 
```

对于此示例代码：

```
int a[100000];
int main() { } 
```

ELF 规范说，内存大小大于文件大小的段的部分只是在虚拟内存中用零填充。第二个`LOAD`标头的段到段映射如下：

```
03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss 
```

所以那里也有一些其他的部分。对于 C++ 构造函数/析构函数。Java 也是如此。然后它包含该`.dynamic`部分的副本和其他对动态链接有用的东西（我相信这是包含所需共享库的地方）。之后`.data`包含初始化的全局变量和局部静态变量的部分。最后，该`.bss`部分出现，在加载时用零填充，因为文件大小没有覆盖它。

`-M`顺便说一句，您可以使用链接器选项查看特定符号将被放置到哪个输出部分。对于 gcc，您`-Wl,-M`可以将选项传递给链接器。上面的例子表明`a`是在`.bss`. 它可以帮助您验证未初始化的对象是否真的最终出现在`.bss`而不是其他地方：

```
.bss            0x08049560    0x61aa0
 [many input .o files...]
 *(COMMON) 
 *fill*         0x08049568       0x18 00
 COMMON         0x08049580    0x61a80 /tmp/cc2GT6nS.o
                0x08049580                a
                0x080ab000                . = ALIGN ((. != 0x0)?0x4:0x1) 
                0x080ab000                . = ALIGN (0x4) 
                0x080ab000                . = ALIGN (0x4) 
                0x080ab000                _end = . 
```

默认情况下，GCC 将未初始化的全局变量保留在 COMMON 部分中，以与旧编译器兼容，允许在程序中定义两次全局变量而不会出现多个定义错误。用于`-fno-common`使 GCC 将 .bss 部分用于目标文件（对最终链接的可执行文件没有影响，因为正如您所见，它无论如何都会进入 .bss 输出部分。这由*链接器脚本*控制。显示它与`ld -verbose`）。但这不应该吓到你，这只是一个内部细节。请参阅 gcc 的联机帮助页。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-04T14:28:53.753

ELF 文件中的`.bss`部分用于**未以编程方式初始化**但保证在运行时设置为零的静态数据。这里有一个小例子来解释这个区别。

```
int main() {
    static int bss_test1[100];
    static int bss_test2[100] = {0};
    return 0;
} 
```

在这种情况下，由于它未初始化，因此`bss_test1`被放入。但是与一堆零一起放入该段中。运行时加载器基本上分配为 保留的空间量，并在任何用户态代码开始执行之前将其清零。`.bss``bss_test2``.data``.bss`

您可以使用 、 或类似实用程序查看`objdump`差异`nm`：

```
moozletoots$ objdump -t a.out | grep bss_test
08049780 l     O .bss   00000190              bss_test1.3
080494c0 l     O .data  00000190              bss_test2.4 
```

这通常是嵌入式开发人员遇到的第一个*惊喜……永远不要显式地将静态初始化为零。*运行时加载器（通常）会处理这个问题。一旦您明确初始化任何内容，您就是在告诉编译器/链接器将数据包含在可执行映像中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T14:19:26.770

`.bss`节不存储在可执行文件中。在最常见的部分（`.text`、`.data`、`.bss`）中，只有`.text`（实际代码）和`.data`（初始化数据）存在于 ELF 文件中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T17:38:19.317

没错，.bss 在文件中实际上并不存在，而只是存在有关其大小的信息，以便动态加载程序为应用程序分配 .bss 部分。由于拇指规则只有 LOAD，TLS Segment 为应用程序获取内存，其余用于动态加载程序。

关于静态可执行文件，在可执行文件中也给了 bss 部分空间

没有加载程序的嵌入式应用程序很常见。

苏曼

# windows-mobile - 以编程方式连接到 Windows Mobile 上的蓝牙耳机

> ID：610698
> 
> 赞同：1
> 
> 时间：2009-03-04T14:05:05.837
> 
> 标签：windows-mobile, bluetooth

在 Windows Mobile 5.0 设备上，我有一个 MFC C++ kiosk 应用程序，它应该以编程方式连接到 3 个蓝牙耳机之一并打开一个双向音频连接到它。

设备已经知道耳机，它只是应该以编程方式完成的切换和连接部分。

我该怎么做？

我知道线程[如何以编程方式在 WM 中“通过蓝牙连接”？](https://stackoverflow.com/questions/467524/how-to-connect-via-bluetooth-in-wm-programmatically)但希望有一种适用于 C++ 的方法。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T12:58:15.087

对于 Windows Mobile，有两个主要的蓝牙堆栈可用：Widcomm 蓝牙堆栈和微软的蓝牙堆栈。这两个都提供了一个原生 API，你可以在谷歌上搜索它们的使用示例。

我想 32feet.NET 库所做的是在这些之上提供一个通用接口。您可以尝试查看来源以了解这是如何完成的。

如果您只需要在单个设备上运行您的应用程序，那么您可以找到正在使用的蓝牙堆栈和代码。这将是一个更容易但不便携的解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T23:11:13.853

我将开始在 MSDN Windows Mobile 5.0 文档中查找[Blue Tooth APIS](http://msdn.microsoft.com/en-us/library/ms847080.aspx)。

将音频设备更改为蓝牙设备可能是硬位。根据您尝试切换的应用程序，您可能希望查看[Waveform Audio for Windows Mobile-based Devices API](http://msdn.microsoft.com/en-us/library/ms880439.aspx)。

从来没有做过上述任何事情，我不能说它是否足够，但它应该让你开始。

# asp.net - 如何在 AJAX 调用中从 Web 服务重定向到登录页面？

> ID：610699
> 
> 赞同：0
> 
> 时间：2009-03-04T14:05:11.330
> 
> 标签：asp.net, ajax, web-services, authentication, redirect

我正在使用 jQuery 调用 Web 服务 (*.asmx) 方法。Web 服务使用 FormsAuthentication 来确定调用用户是否经过身份验证。我无法从 web 方法返回重定向状态代码，例如

```
[WebMethod(EnableSession=true)]
public Dictionary<string, object> GetArchivedFiles(int pageSize, int page)
{
    if(HttpContext.Current.User.Identity.IsAuthenticated && Session["UserId"] != null)
        // Do some computing and return a Dictionary.       

    // Method will fall through here if the user is not authenticated.
    HttpContext.Current.Response.StatusCode = (int) HttpStatusCode.Unauthorized;
    return null;
} 
```

重定向不起作用，执行此操作时我总是收到 500 Internal Server Error。我尝试了不同的代码。去这里的推荐方式是什么？我需要从 JavaScript 读取重定向信息并加载新页面（或者可能显示登录控制 AJAX 方式）。

我实际上得到了一个 JSON 对象，如下所示：

```
{"Message":"Authentication failed.","StackTrace":null,"ExceptionType":"System.InvalidOperationException"
} 
```

我尝试运行调试器，但没有显示输入任何方法。如您所见，StackTrace 为空...

当在 Fiddler 中作为标准 POST 请求（不是 XMLHttpRequest）调用时，它实际上会返回一个异常：

```
HTTP/1.1 500 Internal Server Error
Server: ASP.NET Development Server/9.0.0.0
Date: Wed, 04 Mar 2009 14:46:02 GMT
X-AspNet-Version: 2.0.50727
Cache-Control: private
Content-Type: text/plain; charset=utf-8
Content-Length: 1739
Connection: Close

System.NotSupportedException: The type System.Collections.Generic.Dictionary`2[[System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.Object, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]] is not supported because it implements IDictionary.
   at System.Xml.Serialization.TypeScope.GetDefaultIndexer(Type type, String memberInfo)
   at System.Xml.Serialization.TypeScope.ImportTypeDesc(Type type, MemberInfo memberInfo, Boolean directReference)
   at System.Xml.Serialization.TypeScope.GetTypeDesc(Type type, MemberInfo source, Boolean directReference, Boolean throwOnError)
   at System.Xml.Serialization.ModelScope.GetTypeModel(Type type, Boolean directReference)
   at System.Xml.Serialization.XmlReflectionImporter.ImportTypeMapping(Type type, XmlRootAttribute root, String defaultNamespace)
   at System.Xml.Serialization.XmlReflectionImporter.ImportTypeMapping(Type type, XmlRootAttribute root)
   at System.Web.Services.Protocols.XmlReturn.GetInitializers(LogicalMethodInfo[] methodInfos)
   at System.Web.Services.Protocols.XmlReturnWriter.GetInitializers(LogicalMethodInfo[] methodInfos)
   at System.Web.Services.Protocols.MimeFormatter.GetInitializers(Type type, LogicalMethodInfo[] methodInfos)
   at System.Web.Services.Protocols.HttpServerType..ctor(Type type)
   at System.Web.Services.Protocols.HttpServerProtocol.Initialize()
   at System.Web.Services.Protocols.ServerProtocol.SetContext(Type type, HttpContext context, HttpRequest request, HttpResponse response)
   at System.Web.Services.Protocols.ServerProtocolFactory.Create(Type type, HttpContext context, HttpRequest request, HttpResponse response, Boolean& abortProcessing) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T14:07:02.823

您不应从 Web 服务重定向。它应该返回一个值来指示您是否应该重定向（*这可能是一个单独的`Authenticate`方法，它返回 a `string`，如果它为 null，则表示它已通过身份验证，如果不是，它将包含重定向 URL*）然后在 javascript 中，您可以通过设置`window.location`属性检查返回值并适当地重定向。

顺便说一句，对 Web 服务的访问不应该需要身份验证。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T14:21:35.220

我没有专门使用 asp.net 的经验，但总的来说，我喜欢使用具有“成功”、“内容”、“错误类型”等属性的 ajaxResponse 对象。在这种情况下，需要登录的响应将成功为“false”，错误类型为“login”，或者您选择的任何内容。然后，javascript 代码根据这些属性决定如何处理返回的对象，向用户显示登录表单或重定向到新页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T07:46:21.490

我所做的是完全摆脱状态码，然后返回`null`。如果没有文件，则方法返回一个空列表，总页数为 0。但如果用户未通过身份验证，则返回`null`，在这种情况下，我使用`window.location`将浏览器重定向到登录页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T14:09:51.427

在 Web 服务中引发异常。在调用者中捕获它并根据需要重定向。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-18T11:38:58.067

事实上，如果你发给 web 服务的帖子（不管是否是 ajax）包含一个值为 "application/json; charset=utf-8" 的 "Content-Type" 标头，那么 ASMX 堆栈将向您发送一个带有 json 格式的字符串除了通常您期望的包含状态代码 401（未经授权）的假定重定向之外，但是，如果您不发送任何内容类型标头，您将得到一个浏览器重定向到登录页面作为响应，状态代码 OK 并使用 ajax，您将获得登录页面 html 作为响应。

希望这有助于澄清。

问候

# c# - 验证 TextBox 中的文本更改

> ID：610710
> 
> 赞同：9
> 
> 时间：2009-03-04T14:08:00.043
> 
> 标签：c#, .net, winforms, validation, textbox

我已经在我的 WinForm 中的文本框上实现了验证规则，并且效果很好。但是，它仅在我退出该字段时检查验证。我希望它在框中输入任何内容以及每次内容更改时立即进行检查。我还希望它在 WinForm 打开后立即检查验证。

我记得最近通过设置一些事件和诸如此类的东西来做到这一点，但我似乎不记得是如何做到的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:36:45.917

如果您使用数据绑定，请转到文本框的属性。打开顶部的（DataBindings），点击（Advanced）属性，会出现三个点（...）点击那些。出现高级数据绑定屏幕。对于绑定的 TextBox 的每个属性，在您的情况下`Text`，您可以设置数据绑定以及验证何时应该使用组合框“启动” `Data Source Update mode`。如果您将其设置为`OnPropertyChanged`，它将在您键入时重新评估（默认值`OnValidation`仅在您选项卡时更新）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T14:11:46.413

文本更改事件

将来您可以在 MSDN 库中找到所有事件，这是[TextBox 类参考](http://msdn.microsoft.com/en-us/library/system.windows.forms.textbox(VS.80).aspx)：

[http://msdn.microsoft.com/en-us/library/system.windows.forms.textbox(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.textbox(VS.80).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T14:09:45.950

您应该检查 KeyPress 或 KeyDown 事件，而不仅仅是您的 TextChanged 事件。

这是直接来自[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keypress.aspx)的 C# 示例：

```
// Boolean flag used to determine when a character other than a number is entered.
private bool nonNumberEntered = false;

// Handle the KeyDown event to determine the type of character entered into the control.
private void textBox1_KeyDown(object sender, System.Windows.Forms.KeyEventArgs e)
{
    // Initialize the flag to false.
    nonNumberEntered = false;

    // Determine whether the keystroke is a number from the top of the keyboard.
    if (e.KeyCode < Keys.D0 || e.KeyCode > Keys.D9)
    {
        // Determine whether the keystroke is a number from the keypad.
        if (e.KeyCode < Keys.NumPad0 || e.KeyCode > Keys.NumPad9)
        {
            // Determine whether the keystroke is a backspace.
            if(e.KeyCode != Keys.Back)
            {
                // A non-numerical keystroke was pressed.
                // Set the flag to true and evaluate in KeyPress event.
                nonNumberEntered = true;
            }
        }
    }
    //If shift key was pressed, it's not a number.
    if (Control.ModifierKeys == Keys.Shift) {
        nonNumberEntered = true;
    }
}

// This event occurs after the KeyDown event and can be used to prevent
// characters from entering the control.
private void textBox1_KeyPress(object sender, System.Windows.Forms.KeyPressEventArgs e)
{
    // Check for the flag being set in the KeyDown event.
    if (nonNumberEntered == true)
    {
        // Stop the character from being entered into the control since it is non-numerical.
        e.Handled = true;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T14:12:56.567

如果没有完成，您的数据将如何有效？即用户键入一个数字，您尝试将其验证为日期？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T14:44:10.580

将文本框绑定到 bindingSource 时，转到 Advanced 并选择验证类型
“On Property Changed”。这将在每次按键时将您的数据传播到您的实体。 **[这是屏幕截图](http://picasaweb.google.ru/lh/photo/LdwVyjt3-h6T2Rpv3lGMEA?feat=directlink)**

# ruby-on-rails - 无法通过页面缓存更新模型

> ID：610716
> 
> 赞同：1
> 
> 时间：2009-03-04T14:09:09.323
> 
> 标签：ruby-on-rails, caching

我对 Rails 页面缓存机制有一个非常基本的理解问题。

在 Rails 2.0.5 应用程序上，我使用了大量整页缓存，一切正常，apache 以极快的速度提供页面。

到目前为止，所有内容都在管理部分处理，缓存清扫器运行良好。

但是我现在已经向用户开放了一些部分的版本，这些用户不通过“admin”命名空间，而是通过常规路由。

问题是，似乎在执行更新时，它们不会通过“put”操作进入 mongrel，而是我只是获取缓存页面（数据库中没有操作，没有 flash 消息，什么都没有...... )

我觉得我在这里错过了一些东西，是否可以将页面缓存与常规 REST 路由一起使用？还是我的 mongrel/apache 配置有问题？

编辑：

感谢您的回答，但这不是我的意思，整页缓存机制工作正常，我在管理控制器中有专门的清扫器来刷新页面。

我的问题是（或者我认为是）当模型通过常规控制器更新时，表单被提交到缓存页面而不是适当的操作。

在表格中

/pages/1-hello/edit
表单应该使用“/pages/1-hello”上的“put”方法发布

但我相信它会进入缓存页面'/pages/1-hello.html'并被视为常规获取......

当我提交表单时，我只看到显示操作，没有闪烁消息，没有更新。然后我删除了公共目录中的缓存文件，再次提交表单，突然一切正常......

我阅读了“rails way”中的缓存部分和 railsenvy.com 上的教程，但我从未见过任何提及缓存页面会带来此类问题的内容......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T23:08:52.670

You're probably caching too much of the page. If you're caching the entire page and then altering the contents of that page via a put action, the page won't register the change unless you clear the cache explicitly.

If you have a copy 'The Rails Way', some great examples are given to expire pages so that they are reloaded on the next load.

More or less, you have to do something like the following within your create action:

```
expire_page :action => 'index' 
```

You can also create an observer to observe your model and expire the cache without needing to explicitly call it after a create or update action.

Hope that helps.

# c# - c# Compact Framework 不支持 Math.Sinh 异常

> ID：610727
> 
> 赞同：0
> 
> 时间：2009-03-04T14:10:42.017
> 
> 标签：c#, math, compact-framework

我正在开发**Compact Framework 2.0 SP1**，当我尝试使用**Math.Sinh**时，它会抛出一个*不支持的异常*

如果我不能使用这个功能，还有其他选择吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T14:17:19.630

```
sinh(x) = (e^x - e^-x) / 2 
```

[见维基百科](http://en.wikipedia.org/wiki/Hyperbolic_trigonometric_function)

所以你应该能够编写自己的函数！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T14:33:58.577

我们使用[OpenNETCF](http://www.opennetcf.com/FreeSoftware/tabid/84/Default.aspx)来访问 Compact Framework 不支持的许多 API。Math 包只是其中之一。事实上，OpenNETCF 确实支持 Sinh 函数。

```
OpenNETCF.Math2.Sinh(angle: double) 
```

如果您使用 Compact Framework 进行了大量工作，[OpenNETCF 智能设备框架](http://www.opennetcf.com/Default.aspx?tabid=91)会非常有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T14:15:19.107

例如，看一下 Math.Sin 的 PInvoke 签名，我怀疑 Sinh 会出现在移动设备上，但只是没有映射/导入到 CF 中以保存一个或 2 个字节。

# java - 什么是构建自动化软件（例如 Ant）？

> ID：610732
> 
> 赞同：22
> 
> 时间：2009-03-04T14:11:21.237
> 
> 标签：java, ant, build-process

我经常看到 ant 的参考，但我不明白它的确切含义是什么？据我所知，它应该编译你的项目，但我不能通过单击运行->在 Eclipse 中运行来做到这一点吗？

编辑：我想我应该改写我的问题。我已经知道 ant 是一个“构建自动化软件”，我的问题是，构建自动化到底是什么？我认为你应该测试你的应用程序，当它运行时，你点击 Eclipse 中的“构建”按钮或通过命令行 java，它会生成一个 .jar 文件吗？那么为什么你需要“自动化”这个过程呢？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-04T21:24:48.480

> *我已经知道 ant 是一个“构建自动化软件”，我的问题是，构建自动化到底是什么？我认为你应该测试你的应用程序，当它运行时，你点击 Eclipse 中的“构建”按钮或通过命令行 java，它会生成一个 .jar 文件吗？那么为什么你需要“自动化”这个过程呢？*

并不是所有的 Java 开发都是通过 eclipse 完成的，也不是所有的 jars 都可以从命令行构建（或者应该从命令行构建）。

您可能需要额外运行测试用例、单元测试和许多其他过程。

ant 所做的是提供一种机制来自动化所有这些工作（因此您不必每次都这样做），也许您可​​以在每天下午 6 点调用这个 ant 脚本

例如，在某些项目中，需要每日构建，以下是可能用 ant 自动化的任务，因此它们可以在没有人工干预的情况下运行。

*   连接到颠覆服务器。
*   下载/更新最新版本
*   编译应用程序
*   运行测试用例
*   打包应用程序（在 jar、war、ear 或其他中）
*   将此构建二进制文件提交给颠覆。
*   在远程服务器中安装应用程序
*   重启服务器
*   发送一封包含工作摘要的电子邮件。

当然，对于其他项目来说，这太过分了，但对于其他一些项目来说却非常有帮助。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-04T14:15:21.243

[rogeriopvl](https://stackoverflow.com/questions/610732/what-is-ant-used-for-in-java/610738#610738)是绝对正确的，但是要回答您的“我不能通过单击运行-> 在 Eclipse 中运行来做到这一点吗？” 问题：这对于您自己进行的项目来说很好，并且不需要在多个环境中进行可重复的、可编写脚本的构建。

但是，如果您正在开发一个开源项目，或者需要能够在构建服务器等上构建的专业软件，那么要求运行特定的 IDE 并不是一个好主意。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-04T15:46:30.290

Ant 用于自动化构建过程，但构建过程通常不仅仅是编译。Ant 具有可用于执行各种有用功能的“任务”。您可以通过编写一个 java 类并告诉 ant 在哪里可以找到它来创建自己的任务来做任何事情。然后，您可以混合和匹配这些任务以创建将执行一组任务的目标。

您还可以设置一个动态环境来构建您的应用程序。您可以设置属性文件来保存可在构建过程中使用的变量，即保存文件路径、类路径等。这对于区分部署路径、数据库实例等的测试和生产构建非常有用。可能会改变。Ant还包括流量控制（if等）

我见过蚂蚁做的一些事情：

*   编译代码
*   使用版本控制检查最新版本或标记正在构建的版本
*   运行 sql 脚本来构建或重建测试数据库
*   从外部资源复制文件以包含在项目中
*   将代码捆绑到 jar、war 或 ear 文件中
*   将 Web 应用程序部署到应用程序服务器
*   重启应用服务器
*   执行测试套件
*   静态分析，即[CheckStyle](http://checkstyle.sourceforge.net/)或[PMD](http://pmd.sourceforge.net/)
*   向团队发送电子邮件以提醒他们构建。
*   根据构建中的信息生成文件。
    *   示例：我的应用程序中有一个 jsp，它只显示版本/构建信息。它是在我运行构建时由 ant 生成的，生产运营团队在部署应用程序时会检查此页面，以确保他们部署了正确的构建。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-04T14:45:13.433

在许多较大的公司（可能还有一些较小的公司）中，您会发现生产代码*不是由开发它的人构建的*。相反，开发人员可以将他们的代码签入源代码存储库并对其进行标记。然后他们将此标签交给构建团队。

构建团队在一个单独的（干净的）区域——可能在一些无头服务器（即没有 GUI）上——然后检查代码并运行构建脚本。构建脚本将**完全独立于桌面环境/IDE**。

这确保了任何一个开发人员的计算机上发生的任何事情都不会“污染”构建。（或者，更有可能的是，系统工作不需要任何外部源代码控制！）

因此，您使用的大多数软件永远不会**从**开发人员的桌面构建。

PS。您可能还想看看[持续集成的想法](http://en.wikipedia.org/wiki/Continuous_Integration)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-04T15:43:07.723

简短的回答是，Ant 是创建独立于任何开发人员可能使用的任何特定工具的完整项目构建的好方法。如果没有独立的构建，事情可能会很快变得混乱——尤其是对于大型项目团队。

现在长答案......我已经被带入了几个项目，没有任何独立构建的感觉。在一个项目中，有一个不是开发人员的人负责构建和部署软件。他创建了 147 个单独的 Windows 批处理文件来编译每个 EJB、每个 servlet 和每个客户端组件。此构建没有错误检查。所有日志消息，包括错误消息都进入标准输出。他可以通过阅读此日志来手动识别哪些异常或打印的消息是正常的，哪些消息是错误的。他还必须部署他刚刚构建的这个软件。部署同样复杂，因为有多个负载平衡层。每个模块都必须手动放置在正确的位置，并设置选项以匹配下游和上游层。使用这种方法构建和部署这个软件至少花了他 3 天的时间。当然，只有这样，任何人才能确定构建是否“有效”。通常，在这段时间之后，所有的程序员都会争先恐后地调试构建。程序员会说我的模块在我的 IDE 中运行良好。我只是像这样单击运行，看到了吗？

事实上，各个软件模块通常都可以工作，但构建和部署却非常低效。同样糟糕的是，任何人将构建部署到多个环境都同样困难。管理层会说，好的，您现在可以在我们的回归测试环境中使用此构建。现在在这个其他环境中部署相同的构建，以便销售人员可以演示即将推出的软件。这应该很简单，但也至少需要 2 天，然后是“调试构建”期。构建和部署从来都不是简单和准确的。这确实减慢了项目的速度。

无论如何，我们用完整的基于 Ant 的构建和部署机制替换了整个过程。最终结果是可以在 30 分钟内创建和部署一个完整的构建，完全自动化。管理构建和部署的 QA 人员可以保留一张白板，说明哪个环境部署了哪个构建以及哪个组正在使用该环境。这是旧系统无法实现的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-04T14:13:24.460

Ant 用于自动化软件构建过程：

[http://en.wikipedia.org/wiki/Apache_Ant](http://en.wikipedia.org/wiki/Apache_Ant)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-04T14:21:18.530

Ant 允许 CRISP（完整、可重复、信息丰富、可调度、可移植）构建。您可以在Mike Clark 的[演示文稿和他的著作](http://www.denverjug.org/meetings/files/200410_automation.pdf)[Pragmatic Project Automation](http://www.pragprog.com/titles/auto/pragmatic-project-automation)中找到有关它的重要信息。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-04T14:16:05.250

Ant 是一种构建工具，类似于 makefile（尽管在 XML 中具有非常不同的语法）。如果您只使用 Eclipse，那么坚持下去就可以了，并且您始终可以将 Ant 构建文件转换为 Eclipse 项目（如果我没记错的话，Eclipse 的启动配置相当于 Ant 的构建目标）。

如果您想部署应用程序的源代码并允许其他人轻松构建或设置它，那么使用 Ant 实现自动化可能不是一个坏主意。但对于用户来说，这通常不是一致的体验，或者至少我还没有看到关于应该有什么目标以及到目前为止做什么的共识。

Ant 也可以用于常规的自动化构建（您不会希望每晚都在 Eclipse 中运行，对吧？:-)）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-04T16:07:20.740

如果你身边有一个，我想你会从[CITCON](http://citconf.com/)（持续集成和测试会议）中获益良多。您可以与很多人谈论自动化应用于构建和测试软件的好处。

基本上，人们使用 Ant（与其他工具）来自动化他们希望在提交后发生的所有事情。这种自动化的基本优势是更快、更好和更便宜。

**更快**，因为事情会立即发生，而无需等待人类解决。

**更好**，因为计算机真的很擅长每次都以同样的方式做同样的事情。（人类往往会对此感到厌烦。）

**更便宜**，因为您的错误更少，并且发生的错误被更快地发现，因此修复成本更低。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T14:17:33.110

您还指的是“[**导出 ant buildfile**](https://stackoverflow.com/questions/429907/eclipse-ant-and-custom-tasks) ”。

如果您编写自己的 Ant 脚本来在 eclipse 之外构建应用程序，则可以编写自己的目标，使用[Ant 任务](https://stackoverflow.com/questions/429907/eclipse-ant-and-custom-tasks)委托给生成的*build.xml*。

此外，您可以手动或自动配置**项目的“构建器”**（`project properties » Builders`）以在构建项目时运行您想要的任何脚本（ant 或其他）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T20:48:32.763

Joel (Spolsky) 有[一篇](http://www.joelonsoftware.com/articles/fog0000000043.html)关于“乔尔测试”的精彩文章。他们中的许多人围绕着能够经常、快速和可靠地完成重要的事情。其中之一就是你的构建。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-03-04T14:13:59.420

Eclipse 使用 ant 来构建、运行、部署……

“Ant 是一个基于 Java 的构建工具。理论上，它有点像 Make，没有 Make 的皱纹，并且具有纯 Java 代码的完全可移植性。” （来自[链接文本](http://ant.apache.org/faq.html#what-is-ant)

# svn - Subversion 1.5 的性能很糟糕吗？

> ID：610734
> 
> 赞同：6
> 
> 时间：2009-03-04T14:11:58.753
> 
> 标签：svn

我们一直在做一个项目，每个人都在主干上工作。该项目已经到了我们的开发团队不断壮大的地步，我们终于开始进行客户端发布（一切都很好）。因此，为了帮助协调所有这些，我们开始遵循 SVN 分支/合并等最佳实践。

我们面临的问题是合并需要超过 20 分钟，并且经常会因“对等连接重置”或“PROPFIND”错误而失败。分支和合并非常痛苦，几乎无法使用。我们只有大约 1000 个文件左右，而且我们经常合并不到 20 个文件，而且仍然需要 20 分钟。我们正在使用 Apache 访问 SVN。

我的问题是，这是典型的还是我们配置有问题？您的 SVN 存储库有多大，合并需要多长时间？

**编辑**：服务器通过 Internet 访问，我们有一些相当大的二进制文件，我们使用 Mac、Linux 和 Windows 客户端。没有我们所知道的互联网或网络问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-04T18:18:45.463

这是由于 Apache，请参阅 Stack Overflow 问题“ [Svnserve VS mod_dav_svn](https://stackoverflow.com/questions/502585) ”。

回顾一下：

> 似乎不太为人所知的是，使用的服务器变体的选择——Apache Subversion mod_dav_svn 模块或独立的 svnserve 服务器——对测量和感知的颠覆性能有很大影响。通常 svnserve 比 Apache mod_dav_svn 快得多 ...... 最显着的性能损失是在针对 mod_dav_svn 服务器的 svn 日志和 svn 合并操作期间测量的 - 你会注意到更差的 svn 日志性能立即，例如。使用 Eclipse Subversion 插件 Subclipse。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T16:01:15.847

**完全披露：**我与拉夫一起工作，我会告诉他不要将我的答案标记为已选择，这样看起来我们不会以某种方式设置它来玩弄系统。我当然会喜欢你的支持:)

我们最近在工作中尝试了一些可能加快速度的方法，我想在 Stack Overflow 上捕捉它。我不确定它是否对你有用，但它看起来对我们有用。

## 的背景

1.  我们的存储库最初是一个 1.4 服务器。
2.  它被转储并重新加载到 1.5 服务器中
3.  在转储和加载期间， /svn/Projects/Project[A|B|C] 形式的主存储库被移动到许多较小的存储库 /svn/projectA ， /svn/projectB

## 更多症状

1.  'svn merge' 喜欢随机文件和更改属性。我们有一个测试脚本文件夹（大约 100 个），出于某种原因，其中 3-5 个*随机*更改了属性（prop 是 svn:mergeinfo）。
2.  尽管目录结构和名称更改发生在*很久*以前，但 apache 日志显示 /svn/Projects/ProjectA 在进行合并时的 propgets 和历史查询。
3.  查看一些项目的 svn:mergeinfo 发现了一些奇怪的事情：一些一直存在的文件显示了一些标签的“标签”祖先，但不是全部，其中一些有原始 svn 路径和新路径的祖先，有时是 5 + 路径和存储库布局。
4.  我注意到另一位使用 TortoiseSVN（我使用 OSX 命令行）的员工正在检查“忽略祖先”框，与我的相比，他的合并具有“正确”的 apache 日志。他的合并似乎也开始得更快。

虽然所有这些可能都是完全正常的，但它们听起来肯定不像我预期的那样。

## 我们做了什么

1.  尝试将尽可能多的大型、相对静态的二进制文件移出主代码文件夹。这样，开发分支就不需要克隆它们。
2.  从每个文件中删除了 svn:mergeinfo 属性。我们编写了一个 shell 脚本来执行此操作并让它运行。

## 善后

Larf 创建了一个 dev 分支，几天后尝试将主干合并到他的分支中。以前，这种类型的合并似乎会在开始合并之前停止 13 分钟以上。现在，它几乎立即开始并在 < 4 分钟内完成。

在将代码合并到其他旧分支方面，我们可能会自食其果（因为我们删除了 svn:mergeinfo），但这种情况很少发生，我们愿意冒险改进 dev 分支合并时间（以及所有分支向前）。此外，我们目前正在进行每月发布/分支，因此下一个将在它们上设置正确的 svn:mergeinfo 属性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T15:21:37.900

这本身就是一个网络问题，而不是一个颠覆问题。我曾经有过它，不记得我做了什么来解决它，但快速谷歌搜索表明它并不少见。需要检查的一些事项：

1.  你有代理吗？
2.  你在使用像 Tortoise 这样的 GUI 客户端吗？（如果是这样，请尝试使用命令行进行相同的操作）

我假设你可以做到`svn ls`并且`svn co`没有问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T15:59:51.833

你的文件有多大？二进制还是文本？大型二进制文件会在服务器上产生大量负载。

此外，“对等连接重置”表示服务器端出现问题。您是否检查过服务器的负载，检查过日志是否有错误？

您是否对其他网络应用程序（浏览器、访问网络共享）有问题？这表明网络本身有问题。

我正在*Internet*上的服务器上访问一个大型存储库（> 100'000 个文件） ，更新最多需要几分钟！不过，那是在 Linux 上。在本地收集文件不是 Windows 的强项......

[编辑] 你的问题是大的二进制文件。服务器在尝试生成 xdelta 时可能会耗尽处理时间或内存。我建议你阅读这篇文章：[性能调优 Subversion](http://www.ibm.com/developerworks/java/library/j-svnbins.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T15:06:12.307

我们拥有超过一千个文件，并且始终合并大量有冲突的已更改文件。我从未真正为合并计时，但如果它花费的时间超过几分钟，我会感到惊讶。也许是时候放些热水了，但还不足以泡一杯合适的茶！

相对于您的客户端计算机，我们的存储库位于何处？您是否能够排除任何其他连接问题？

另外，我可能应该补充一点，我们通过 SSH 使用 svnserve。我们一直认为我们可以通过使用 Apache 访问 SVN 而不是 SSH 来加快速度。也许我们错了！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T15:09:10.893

可能值得获取存储库的副本并使用 svnserve 进行快速测试，以查看它是否更快。总体而言，它可能不是适合您的解决方案，但它可能表明瓶颈在哪里。

在 1.5 中，合并需要获取所有内容的 svn:mergeinfo 属性——这是对每个文件的另一个 Web 调用，而 apache 服务从未以速度快而著称。

我们使用 svnserve，一个 svn ls -R 刚刚在大约 40 个项目中返回了超过 600,000 个文件。我从来没有注意到合并是特别慢的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-09T01:55:27.157

这是集中式模型最终会遇到的问题，也是 BitKeeper、Git、Bzr 和 Mercurial 等系统背后的激励因素之一。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T12:12:18.533

当我们在 Subversion 中存储大量二进制文件（许多 25 MB+ 大小）时，我们遇到了类似的情况。我们在执行 Apache 服务停止/启动后观察到，性能立即提高，然后在接下来的一周内缓慢下降。因此，我们编写了一个脚本，每天执行一次 Apache 服务停止/启动。这显着改善了事情。

我不确定这是否是您面临的问题的正确解决方案。但可能值得一试。

# internet-explorer-7 - 有没有人经历过 sIFR (436) 在 IE7 中消失，然后在调整浏览器大小时返回？

> ID：610736
> 
> 赞同：0
> 
> 时间：2009-03-04T14:12:44.307
> 
> 标签：internet-explorer-7, sifr

有没有人经历过 sIFR (436) 在 IE7 中消失，然后在调整浏览器大小时返回？

这只发生在 sIFR 436 上。

谢谢，威尔逊

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T14:39:37.550

通过使用绝对位置而不是相对位置来修复。相对似乎是这里更好的定位，但无论如何，它奏效了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T11:07:27.660

对我来说，它适用于 position:absolute; 以及宽度：100%；

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T10:33:44.570

我找到了一个解决方案：您需要在包含 sifr 将要操作的元素的 css 文件中专门设置一个“高度”属性。例如，假设您将 h2 和 h3 标签转换为 sifr，您需要确保它们具有类似 h3 { height:20px; } 在你的 css 文件中。

# delphi - D2009 更快的 CompareText 实现

> ID：610739
> 
> 赞同：3
> 
> 时间：2009-03-04T14:13:24.803
> 
> 标签：delphi, string, performance, delphi-2009, hashmap

我在我的程序中广泛使用哈希映射数据结构。我正在使用 Barry Kelly 在 Codegear 论坛上发布的哈希映射实现。该实现在内部使用 RTL 的 CompareText 函数。分析让我意识到在 SysUtils CompareText 函数上花费了很多时间。

我看了看

[快码网站](http://fastcode.sourceforge.net/)

并找到了一些更快的 CompareText 实现。不幸的是，它们似乎不适用于 D2009 及其 unicode 字符串。

现在的问题是：是否有类似的更快的版本支持 D2009 字符串？在使用哈希映射时，CompareText 函数似乎被调用了很多（至少在我当前使用的实现中），所以很少的性能改进真的会产生影响。或者那里提供的实现也适用于 unicode 字符串？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T17:16:59.073

许多 FastCode 函数可能会在 Delphi 2009 中编译并看起来工作得很好，但它们并不适合所有输入。在汇编器中实现的那些将失败，因为它们假设字符每个只有一个字节。在 Delphi 中实现的效果会好一些，但有时它们仍然会返回不正确的结果，因为旧`CompareText`的“不区分大小写”的概念是基于 ASCII 而新的概念应该基于 Unicode。除了大小写之外，哪些字符被视为相同的规则对于Unicode 与它们对于 ASCII的规则有*很大不同。*

Andreas 在下面的评论中说 Unicode`CompareText`仍然使用 ASCII 大小写比较规则，因此一些 FastCode 函数应该可以正常工作。在使用它们之前检查它们以确保它们没有做出任何字符大小的假设。我似乎记得*一些*FastCode 函数已经被合并到 Delphi RTL 中。我不知道是否`CompareText`是其中之一。

如果您`CompareText`在哈希表中调用了很多，那么这表明您的哈希表做得不是很好。`CompareText`仅当您要搜索的事物的哈希在哈希表中指定为非空存储桶时才应被调用。从那里开始，哈希表通常会使用线性搜索在桶中找到正确的项目，并且`CompareText`在搜索过程中它会调用每个项目。不知道你用的那个是不是这样。

您可以通过使用不同的散列函数来解决这个问题，该函数将其结果更均匀地分布在可用的存储桶上。如果您的桶已经被均匀填充，那么您可能需要更多桶（然后确保哈希函数仍然均匀分布在*该*数字上）。

如果您使用的 hash-map 类是基于 的`TBucketList`，那么桶存储还有改进的空间。该类不会计算整个输入的哈希值。*它仅*使用输入来确定要使用的存储桶。如果该类还跟踪为字符串计算的完整哈希，那么线性搜索期间的比较可能会更快。只需比较哈希，并且仅在哈希完全匹配时才比较字符串。（对于 256 桶桶列表，支持的最大大小，只有一个字节的输入决定桶，其余字节被忽略。）[我之前写过`TBucketList`这里。](https://stackoverflow.com/questions/547879/how-to-judge-number-of-buckets-for-tbucketlist/548298#548298)

# fluent-nhibernate - 如何使用流利的 nhibernate 设置 generate_statistics = true

> ID：610742
> 
> 赞同：24
> 
> 时间：2009-03-04T14:14:07.237
> 
> 标签：fluent-nhibernate

据我了解，我需要以这个结束

```
<property name="hibernate.generate_statistics">true</property> 
```

关于会话工厂配置，但我不知道如何使用流利的 nhibernate 来做到这一点。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-04T16:14:16.837

```
Configuration.ExposeConfiguration(c => c.SetProperty("generate_statistics", "true")); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-08-09T10:39:11.373

在 NHibernate 3 中避免使用字符串：

```
Configuration.ExposeConfiguration(c => c.SetProperty(NHibernate.Cfg.Environment.GenerateStatistics, "true")); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-04T17:08:46.880

根据您配置 Fluent NHibernate 的方式，[数据库配置](http://wiki.fluentnhibernate.org/show/DatabaseConfiguration)有一个`Raw`方法可以用来指定我们尚未实现的设置。

```
SQLiteConfiguration.Standard
  .Raw("hibernate.generate_statistics", "true"); 
```

# c# - 在 C# 中使用递归

> ID：610743
> 
> 赞同：16
> 
> 时间：2009-03-04T14:14:11.447
> 
> 标签：c#, recursion, stack-overflow

在使用递归时是否有任何一般规则来避免stackoverflows？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-04T14:18:24.557

您能够递归多少次取决于：

*   堆栈大小（通常为 1MB IIRC，但二进制文件可以手动编辑；我不建议这样做）
*   每个级别的递归使用多少堆栈（例如，具有 10 个未捕获的`Guid`局部变量的方法将比没有任何局部变量的方法占用更多的堆栈）
*   您正在使用的 JIT - 有时 JIT*会*使用尾递归，有时则不会。规则很复杂，我不记得了。（[David Broman 从 2007 年开始发表博客文章](https://web.archive.org/web/20190110160434/https://blogs.msdn.microsoft.com/davbr/2007/06/20/enter-leave-tailcall-hooks-part-2-tall-tales-of-tail-calls)，以及[同一作者/日期的 MSDN 页面](http://blogs.msdn.com/davbr/pages/tail-call-jit-conditions.aspx)，但它们现在可能已经过时了。）

如何避免堆栈溢出？不要递归太远 :) 如果你不能合理地确定你的递归会在不走很远的情况下终止（我会担心“超过 10”，尽管这很安全）然后重写它以避免递归。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-04T14:21:42.193

这实际上取决于您使用的递归算法。如果它是简单的递归，你可以这样做：

```
public int CalculateSomethingRecursively(int someNumber)
{
    return doSomethingRecursively(someNumber, 0);
}

private int doSomethingRecursively(int someNumber, int level)
{
    if (level >= MAX_LEVEL || !shouldKeepCalculating(someNumber))
        return someNumber;
    return doSomethingRecursively(someNumber, level + 1);
} 
```

值得注意的是，这种方法实际上只在递归级别可以定义为逻辑限制的情况下才有用。如果这不可能发生（例如分而治之的算法），您将必须决定如何平衡简单性、性能和资源限制。在这些情况下，一旦达到任意预定义的限制，您可能必须在方法之间切换。我在快速排序算法中使用的一种有效方法是将其作为列表总大小的比率。在这种情况下，逻辑限制是条件不再最优的结果。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-04T14:16:40.023

我不知道有任何**硬性设置**可以避免堆栈溢出。我个人尽量确保 -
1\. 我的基本情况是正确的。
2\. 代码在某个时候达到了基本情况。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T14:16:58.023

如果您发现自己生成了这么多堆栈帧，您可能需要考虑将递归展开为循环。

特别是如果您正在执行多级递归（A->B->C->A->B...），您可能会发现可以将其中一个级别提取到循环中并为自己节省一些内存。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-04T14:18:26.570

正常的限制，如果在连续调用之间的堆栈上没有多少剩余的话，大约是 15000-25000 层深。如果您使用的是 IIS 6+，则为 25%。

大多数递归算法都可以迭代表示。

有多种方法可以增加分配的堆栈空间，但我宁愿让你先找到一个迭代版本。:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T14:16:16.590

除了有一个合理的堆栈大小并确保你分而治之，这样你就可以不断地处理一个较小的问题，而不是真的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T14:22:11.927

我只是想到了尾递归，但事实证明，C# 不支持它。但是 .Net-Framework 似乎支持它：

[http://blogs.msdn.com/abhinaba/archive/2007/07/27/tail-recursion-on-net.aspx](http://blogs.msdn.com/abhinaba/archive/2007/07/27/tail-recursion-on-net.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T15:00:15.440

如果您在默认 CLR 下运行，则线程的默认堆栈大小为 1 MB。但是，其他主机可能会改变这一点。例如，ASP 主机将默认值更改为 256 KB。这意味着您的代码可能在 VS 下运行良好，但在将其部署到真实托管环境时会中断。

幸运的是，当您使用正确的构造函数创建新线程时，您可以指定堆栈大小。根据我的经验，很少有必要，但我见过一个案例，这是解决方案。

您可以编辑二进制文件本身的 PE 标头以更改默认大小。如果您想更改主线程的大小，这很有用。否则，我建议在创建线程时使用适当的构造函数。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-28T11:25:33.210

[我在这里](http://www.thebestcsharpprogrammerintheworld.com/blogs/dynamic-foreach-forget-about-it-use-a-recursive-function%20.aspx)写了一篇关于这个的短文。基本上，我传递了一个名为 depth 的可选参数，每次深入它时都会给它加 1。在递归方法中，我检查一个值的深度。如果它大于我设置的值，我会抛出异常。该值（阈值）将取决于您的应用程序需求。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T14:29:29.430

请记住，如果您必须询问系统限制，那么您可能做错了什么。

因此，如果您认为在正常操作中可能会出现堆栈溢出，那么您需要考虑一种不同的方法来解决问题。

将递归函数转换为迭代函数并不难，尤其是在 C# 具有 Generic::Stack 集合的情况下。使用 Stack 类型将使用的内存移动到程序的堆而不是堆栈中。这为您提供了存储递归数据的完整地址范围。如果这还不够，将数据分页到磁盘并不太难。但如果你到了这个阶段，我会认真考虑其他解决方案。

# sharepoint - 将基于 Sharepoint XML 的要求导入 HP Quality Center

> ID：610749
> 
> 赞同：0
> 
> 时间：2009-03-04T14:15:47.263
> 
> 标签：sharepoint, hp-quality-center

我们正在考虑从 Sharepoint 2003 迁移到 HP Quality Center 以获取我们的需求跟踪系统。有没有办法将我们当前的 Sharepoint 要求和用户故事导入 HP 质量中心？

是否有人对 HP 质量中心有任何问题/成功

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T14:27:19.420

有用于将 Word 或 Excel 中的需求导入 QC 的插件，或者您也可以使用 QC 的 OTA API 创建自定义脚本，以将数据从 Sharepoint 导入 QC。

# statistics - 在比较年度销售额时考虑闰年

> ID：610752
> 
> 赞同：3
> 
> 时间：2009-03-04T14:16:11.583
> 
> 标签：statistics, leap-year

我正在编写一个程序，显示从财政年度开始到当前日期的当年销售额，与前一年的同一日期范围相比。

我的问题是，我需要为闰年付出什么努力？

更新：

好的，他们想要它，就像我说的（比较去年到同一日期）但是如果今天是非闰年，去年是，今天是 2 月 28 日，与去年到 29 日相比。或者，如果今天是 2 月 29 日，则与去年的 28 日相比。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T14:20:04.740

这让我觉得这是一个商业决定。根据业务类型，额外的一天可能无关紧要。否则，我想您可以将其视为“一年中的前 n 天”，而不是“1 月 1 日至 X 日”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T14:35:23.300

这是一个想法，但就像其他人所说的那样，它可能基于您的特定域。

1.  考虑 1 个“标准化”年 = 365.242199 天，计算所有的闰年（谷歌说）
2.  根据当年的实际天数计算您一年中每天的平均销售额
3.  将其放大或缩小到每 365.242199 天的销售额

所以例如

> ```
>  2007 = $4000 in sales.
>    There's 365 days in 2007, so avg sale per day = $10.96
>    Multpiplying times num days in a normalized year (365.242199) 
>       gives you $4003.05 normalized sales 
> ```

您可以将其直接与 2008 年的类似计算进行比较，

> ```
>  2008 = $5000 in sales.
>    There's 366 days in 2008, so avg sale per day = $13.66
>    Multpiplying times num days in a normalized year (365.242199) 
>       gives you $4975.655 normalized sales for 2008! 
> ```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T14:38:50.157

您可以缩小闰年值以考虑额外的一天。

因此，如果您将平年的 9 月 1 日与闰年的 9 月 1 日进行比较，您会这样做：

```
if(year == leapyear && day > 28Feb)
    Convert date to dayOfYear
    leapYearValue *= dayOfYear / (dayOfYear + 1) 
```

不过，这确实应该在规范中。

# c# - 如何在运行时计算代码的校验和？

> ID：610758
> 
> 赞同：2
> 
> 时间：2009-03-04T14:16:59.367
> 
> 标签：c#, .net, checksum

我有一个在机器上运行的 C#.NET 应用程序。如何在运行时计算整个代码的校验和？

### 笔记：

我不想计算正在使用的图像的校验和，而是实际的代码部分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T14:29:53.313

我只会使用[代码签名](http://www.wintellect.com/cs/blogs/jrobbins/archive/2007/12/21/code-signing-it-s-cheaper-and-easier-than-you-thought.aspx)，但如果您真的想推出自己的解决方案（这可能是个坏主意。代码签名是一件好事），您可以使用反射来查看 IL 代码并基于此计算校验和。这不是一个很好的解决方案，并且可能会导致一些奇怪的错误，所以请为自己省点麻烦并使用代码签名。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T14:33:13.103

我从来没有用过这个，但是：

使用反射，您可以导航到[GetILAsByteArray](http://msdn.microsoft.com/en-us/library/system.reflection.methodbody.getilasbytearray.aspx)并执行校验和（每个方法）。

但我认为使用代码签名或 Assembly.GetExecutingAssembly 然后对 .dll 或 .exe 进行校验和会容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T14:28:17.640

在运行时，您无权访问原始编写的源代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T06:21:19.983

您的程序集上的一个强大的名称可以做到这一点 - 但您必须相信它正在像宣传的那样工作。您要解决的确切问题是什么？

# workflow - 处理 InfoPath 表单

> ID：610759
> 
> 赞同：0
> 
> 时间：2009-03-04T14:17:00.583
> 
> 标签：workflow, infopath

我有一个需要工作流的 InfoPath 表单。该表单是从 BizTalk 中的 cXML 架构构建的，然后放入表单库以进行工作流。用户打开 infopath 表单，查看并选择以下选项之一：重新提交、存档、升级等。

我的问题是如何最好地工作？您是否有表单上的按钮更新状态/操作字段，并让工作流监听 onChange 事件？

您可以更新库上的属性，而不是表单上的字段吗？例如，如果状态不是表单架构的一部分，而是文档库中的一列。

你们通常如何做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T07:11:53.253

您不一定需要为表单库创建事件侦听器。SharePoint 工作流可以配置为仅在库中的文档被修改时启动。

希望有帮助。

-灰

# iis - 在分布式方法中使用 Global.asax，即网络花园

> ID：610760
> 
> 赞同：0
> 
> 时间：2009-03-04T14:17:11.410
> 
> 标签：iis, .net-2.0, global-asax, application-pool

我了解跨多个应用程序池使用应用程序状态和会话状态的局限性，即它们不能共享。Global.asax 文件是每个应用程序池创建的单个实例，还是驻留在 IIS 中所有应用程序池共有的更高级别？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T14:27:16.347

Global.asax（它只是 HttpApplication 的一个类文件）包含在站点所在的任何应用程序池中。就像您站点中的任何其他类一样。如果您使用网络园艺，则适用于应用程序/会话状态的相同规则适用于 global.asax 中的代码。换句话说，如果您在 4 个处理器上运行，当处理器 1、2 和 3 忙碌时，并且 #4 接受它的第一个请求，那么 global.asax 中的任何代码（事件处理程序等）都将被执行.

# visual-c++ - Visual C++ 2008 中的异常行为？

> ID：610766
> 
> 赞同：1
> 
> 时间：2009-03-04T14:18:24.043
> 
> 标签：visual-c++

起初我以为我要疯了，但现在我知道我没有。我只用了Visual C++ 2008 Express Edition几个星期，但我发现我遇到了一个我无法解决的问题，但第二天回到程序我发现问题已经消失了。

比如我上次用VC++的时候Build不能输出一个exe文件，但是今天就没有问题了。

有没有其他人发现这个？我喜欢VC++，但我只是一个初学者，我不知道VC++什么时候愚蠢，什么时候是我！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T14:23:39.630

我之前有过 Visual Studio 的表演。通常它只涉及整个应用程序间歇性挂起。重新启动应用程序通常可以解决问题。

如果这不能解决问题，您可以尝试检查构建日志以查看发生了什么，如果您还没有的话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T14:43:38.477

Visual Studio 根据正常开发或调试模式更改菜单项。

所以你不能在调试时构建你的 exe 或做一些其他的事情。不幸的是，有时您只是忘记了您仍然在某个地方打开了调试会话。

按 Shift-F5 可以解决此问题。

# asp.net - GridView 控件中的图像方向

> ID：610771
> 
> 赞同：0
> 
> 时间：2009-03-04T14:18:39.020
> 
> 标签：asp.net, gridview, image, .net-2.0, image-manipulation

我希望有人可以帮助我解决关于 ASP.Net 2.0 中的图像和 GridView 控件的问题。

我正在尝试将相册应用程序放在一起作为学习练习，它使用带有两列的 GridView 控件。第一列将根据我正在使用的数据库中保存的 URL 显示图像（使用图像列类型），而第二列将显示有关图像的一些详细信息，例如日期、时间、位置、人员等。

目前这似乎可以正常工作，但是所有图像的大小都相同，无论它们的方向如何（人像\风景），这意味着只有一些照片正确显示并且没有全部被压碎。有没有办法调整图像列的属性，以便它始终根据其方向正确显示照片？还是在保持图像外观的同时缩小尺寸？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T14:20:42.120

您可以查询图像属性，然后相应地更改您的图片容器。这需要在 RowDataBound 事件中完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T15:11:11.310

我对我假设您正在使用的 ImageField 列类型没有经验。

您当然可以只使用 TemplateField 和 img 标签（不指定宽度或高度）来解决这个问题。

```
<asp:TemplateField>
    <ItemTemplate>
        <img src='<%# Bind("URLFromDB") %>' runat="server" />
    </ItemTemplate>
</asp:TemplateField> 
```

# java - 我想在当前目录中运行 scons 命令。我如何在 Java 中做到这一点？

> ID：610773
> 
> 赞同：2
> 
> 时间：2009-03-04T14:18:52.590
> 
> 标签：java, command-line

我正在使用 Java 来自动化构建。我想在执行构建**的当前目录**中运行“scons”命令。我怎样才能用Java做到这一点？我试过了

`Runtime.getRuntime().exec(CurrentDir + commandString)`

这没有用。任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T14:22:00.353

您必须使用 Java 5 API [ProcessBuilder](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/ProcessBuilder.html)来更改新进程的当前目录。

# iphone - AppStore，如果您的应用获得批准会怎样？

> ID：610777
> 
> 赞同：3
> 
> 时间：2009-03-04T14:19:55.897
> 
> 标签：iphone, app-store

所以我正在开发一个必须在网站启动的同一天发布的应用程序。因为我们无法准确控制应用程序何时获得批准，所以我现在将其提交批准。

但那会发生什么？是自动在应用商店吗？我们可以（或者我们..）暂停申请吗..我们什么时候需要为它定价，您提出批准的日期或获得批准的日期..

有什么我们应该知道的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T14:26:29.437

您可以在将应用程序上传到 Apple 以供批准时设置“发布日期”。一旦您的应用获得批准，它将在该日期之前发布。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-04T14:23:29.193

我猜一旦它被批准，它将被添加到商店中。这不应被解释为“Google It”的答案，但我强烈建议实际联系 Apple 支持并直接从他们那里得到低调。

# sharepoint - Sharepoint 工作流在首次运行时失败，但在手动运行时成功

> ID：610790
> 
> 赞同：2
> 
> 时间：2009-03-04T14:21:55.440
> 
> 标签：sharepoint, sharepoint-2007, sharepoint-api

我们正在使用一个 infopath 表单，当它提交时应该触发一个自定义的 .NET 工作流。基本上，表单中的信息用于创建新的共享点站点。我看到的情况是工作流第一次运行（提交表单后自动运行），工作流出错。当我在失败后立即手动运行工作流时，工作流运行良好。

```
this.workflowProperties.Item["Client Name"] 
```

我已将问题调试到上面的行，其中 workflowProperties 的类型为 Microsoft.SharePoint.Workflow.SPWorkflowActivationProperties。工作流第一次运行时，上面列出的属性（以及所有其他属性）为空。第二次运行时，客户端名称属性应该是（从 infopath 表单填充）。

另一个重要的信息是，这个工作流程在一年多的时间里运行良好，几周前突然开始无法正常工作，没有什么特别的原因。上个月我们遇到了一些权限问题，但我看不出这与工作流程问题有什么关系。我登录的用户是网站集管理员。我使用同一用户手动启动工作流程（成功）。我不认为工作流以登录的用户身份运行（当它在表单提交时自动运行时）。

整个情况的另一个有趣的问题是：应用程序总共使用了 3 个自定义工作流。2 个是在 Visual Studio 中制作的——其中一个工作正常，另一个显示上述行为。最后一个是在共享点设计器中制作的，但失败了。

在这一点上，我愿意尝试任何事情。我在开发服务器上（将确切的症状显示为生产），所以我可以尝试任何事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T14:31:44.557

我猜这与设置字段值的提交操作异步触发的工作流有关。您可以尝试从列表中显式获取项目，而不是使用工作流属性中的项目。类似于以下内容：

```
SPListItem l_item = 
      workflowProperties.Item.List.Items.GetItemById(
                 workflowProperties.Item.Id
      ); 
```

我不确定，但可能值得一试。

要记住的另一件事是，`SPContext.Current`如果从 EventReceiver 调用该对象将为 null，但如果手动调用该对象将是有效的。听起来这不是问题，但它仍然需要注意。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-25T21:55:51.293

如果 InfoPath 表单是从 Vista 或 Win 7 计算机提交的，您可能会遇到为 InfoPath 表单中的字段获取 NULL 值的问题。尝试添加大约 10 秒的延迟活动，看看您是否能够从 InfoPath 获取字段的值。

有关详细信息，请参阅此链接：[为什么我的 SharePoint 工作流在客户端运行 Vista 或 Windows 7 时失败？](https://stackoverflow.com/questions/2044200/why-does-my-sharepoint-workflow-fail-when-the-client-is-running-vista-or-windows)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T14:46:25.183

尝试查看您的 SharePoint 日志。

它们位于 LOGS 文件夹中的 12-Hive 下 - 打开最新的并在其中查找带有“工作流基础架构”的内容，也许这可以为您指明正确的方向。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T14:35:47.547

“解决方案”是进行导出并转移到新服务器。基本上只需使用 STSADM 进行导出操作，然后在新服务器上导入相同的文件。

看：

[http://sharepointdogs.wordpress.com/2008/07/30/content-migration-or-backuprestore-in-moss-2007/](http://sharepointdogs.wordpress.com/2008/07/30/content-migration-or-backuprestore-in-moss-2007/)

我在这个问题上与 Microsoft 支持人员通了几个小时的电话 - 我建议可能遇到此问题的其他任何人转移到新服务器。

# sql - 有没有办法在 SQL 语句中将 IN 与 LIKE 结合起来？

> ID：610796
> 
> 赞同：7
> 
> 时间：2009-03-04T14:23:23.157
> 
> 标签：sql

如果可能的话，我正在尝试找到一种方法来一起使用 IN 和 LIKE 。我想要完成的是将一个子查询拉入一个数据列表到一个 IN 语句中。问题是数据列表包含通配符。有没有办法做到这一点？

只是我很好奇的东西。

```
Example of data in the 2 tables

Parent table

ID    Office_Code   Employee_Name
1     GG234         Tom
2     GG654         Bill
3     PQ123         Chris

Second table

ID    Code_Wildcard
1     GG%
2     PQ% 
```

* * *

澄清说明（通过第三方）

由于我看到几个似乎没有解决 Ziltoid 问题的回答，我想我试着澄清一下我认为他的意思。

在 SQL 中，“ `WHERE col IN (1,2,3)`”大致相当于“ `WHERE col = 1 OR col = 2 OR col = 3`”。

他正在寻找我将伪编码为的东西

```
 WHERE col IN_LIKE ('A%', 'TH%E', '%C') 
```

这大致相当于

```
 WHERE col LIKE 'A%' OR col LIKE 'TH%E' OR col LIKE '%C' 
```

正则表达式的答案似乎最接近；其余的似乎离题了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T16:11:55.190

我不确定您使用的是哪个数据库，但是使用 Oracle，您可以通过在 FROM 子句中为子查询设置别名而不是在 IN 子句中使用它来完成等效的操作。使用您的示例：

```
select p.*
from
  (select code_wildcard
   from second
   where id = 1) s
  join parent p
      on p.office_code like s.code_wildcard 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T14:27:38.733

在`MySQL`中，使用`REGEXP`：

```
WHERE field1 REGEXP('(value1)|(value2)|(value3)') 
```

同样在`Oracle`：

```
WHERE REGEXP_LIKE(field1, '(value1)|(value2)|(value3)') 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T14:26:58.703

你的意思是这样的：

```
select * FROM table where column IN (
   SELECT column from table where column like '%%'
) 
```

真的应该这样写：

```
SELECT * FROM table where column like '%%' 
```

当您必须基于一组您在主查询中不需要的逻辑来提取记录时，使用子选择查询非常有用。

就像是：

```
SELECT * FROM TableA WHERE TableA_IdColumn IN 
(
     SELECT TableA_IdColumn FROM TableB WHERE TableA_IDColumn like '%%'
) 
```

更新问题：

您不能将 IN 语句与 like 语句结合使用：

您必须执行三个不同的类似语句来搜索各种通配符。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T14:26:51.060

您可以使用 LIKE 语句来获取 ID 列表，然后在 IN 语句中使用它。

但是不能直接把IN和LIKE结合起来。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-04T15:33:45.203

也许是这样的？

```
SELECT DISTINCT
     my_column
FROM
     My_Table T
INNER JOIN My_List_Of_Value V ON
     T.my_column LIKE '%' + V.search_value + '%' 
```

在这个例子中，为了简单起见，我使用了一个包含值的表，但您可以轻松地将其更改为子查询。如果您有一个大列表（如数万个），那么性能可能会很粗糙。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T21:37:41.570

```
select *
  from parent
 where exists( select *
                 from second
                where office_code like trim( code_wildcard ) ); 
```

修剪 code_wildcard 以防它有尾随空格。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-04T14:29:18.260

您可以在子查询中执行 Like 部分吗？

Select * From TableA Where X in (Select A from TableB where B Like '%123%')

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T14:29:49.163

tsql 具有用于启用全文搜索的表的[contains语句。](http://msdn.microsoft.com/en-us/library/ms187787(SQL.90).aspx)

```
CONTAINS(Description, '"sea*" OR "bread*"') 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T15:54:48.383

如果我正确阅读了问题，我们希望所有父行的 Office_code 与“第二”表中的任何 Code_Wildcard 匹配。

至少在 Oracle 中，这个查询实现了：

```
SELECT * 
FROM parent, second 
WHERE office_code LIKE code_wildcard; 
```

我错过了什么吗？

# visual-studio-2008 - VS 安装崩溃和烧伤

> ID：610799
> 
> 赞同：0
> 
> 时间：2009-03-04T14:25:04.683
> 
> 标签：visual-studio-2008

我以前从未见过这种情况。请有人能帮我解释一下。我刚刚从 MSDN DVD 完成了 Vista Business 64、Firefox、VS 2008 SP1 的全新安装。在安装的后期——我没看所以没看到什么时候——我突然看到一屏*失败*。

错误日志中的第一条消息是：

```
setup.exe: [2] ISetupComponent::Pre/Post/Install() failed in ISetupManager::InternalInstallManager() with HRESULT -2147023293 
```

谷歌产生的相关结果非常非常少。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T14:33:08.937

根据我的发现，HRESULT -2147023293 与未在 Vista 中正确注册的 dll 有关。我已经很久没有这样做了，但是您可能想要做的是尝试以管理员身份运行安装程序（右键单击 setup.exe，以管理员身份运行命令）。

[http://forums.techarena.in/vista-administration/1039438.htm](http://forums.techarena.in/vista-administration/1039438.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T22:54:22.523

我在安装 Vista 后直接完成了此操作，无需重新启动。重启和 39 次更新后，我再次运行安装，一切正常。

# svn - 使文件夹不受 SVN 管理

> ID：610809
> 
> 赞同：5
> 
> 时间：2009-03-04T14:28:05.563
> 
> 标签：svn

是否可以从存储库中删除文件夹，就像它不会从每个用户的本地存储库中删除一样？

在我的例子中，有一个名为 'config' 的目录旨在进行版本控制。现在我们决定从版本控制中删除该目录，但将其保留在每台个人计算机上（顺便将其添加到 svn:ignore）。问题是，如果我使用“svn delete”删除该目录 - 它将从每个人的计算机中删除，我不希望这样。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:48:54.423

我知道的唯一方法是将其保存在您自己的工作副本中：

```
svn delete --keep-local 
```

你被卡住了，因为你不能忽略版本控制的文件。

如果它*真的很*重要并且您使用 TortoiseSVN，那么您可以分两个阶段执行操作 - 创建客户端更新前挂钩以导出目录（或文件），然后在更新后（在 svn:ignore 添加后到工作副本）再次复制目录或文件。

听起来像一个正确的 PITA，恕我直言，您最好发送一封电子邮件解释情况并在提交之前提前通知导出*配置。*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T14:33:28.297

一旦目录不受版本控制，您将需要在目录上添加 svn:ignore；但为了让它脱离版本控制，我认为你必须 svn:delete 它，让每个开发人员将其复制出来，删除 .svn 目录，进行更新，然后将其复制回来。

[这个相关的问题](https://stackoverflow.com/questions/542065/svn-remove-file-from-repository-without-deleting-local-copy)也可能有所帮助。

# php - 棘手的问题：如何从多个正则表达式中排序结果

> ID：610815
> 
> 赞同：2
> 
> 时间：2009-03-04T14:28:40.447
> 
> 标签：php, regex

我目前在一个 preg_match 中使用 3 个不同的正则表达式，使用 or 符号 | 将它们分开。这完美地工作。但是，第一个和第二个正则表达式具有相同类型的输出。例如 [0] 源文本 [1] 数量 [2] 名称 - 但是最后一个，因为它使用不同的源文本排列导致：[0] 源文本 [1] 名称 [2] 数量。

```
 preg_match('/^Guo (\d+) Cars @(\w+)|^AV (\d+) Cars @(\w+)|^@(\w+) (\d+) [#]?av/i', $source, $output); 
```

由于`Name`可以是数字，因此我无法进行简单的检查以查看它是否为数字。有没有办法可以切换正则表达式中的顺序或识别它也匹配哪个正则表达式。速度在这里至关重要，所以我不想使用 3 个单独的 preg_match 语句（以及更多语句）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T14:45:27.363

您可以使用命名的捕获组：

```
preg_match('/^Guo (?P<number_amount>\d+) Cars @(?P<name>\w+)|^AV (?P<number_amount>\d+) Cars @(?P<name>\w+)|^@(?P<name>\w+) (?P<number_amount>\d+) [#]?av/i', $source, $output); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T14:47:25.020

三个独立的正则表达式不必更慢。一条大语句将意味着正则表达式引擎的大量回溯。正则表达式优化的关键是让引擎尽快失效。您是否进行了一些基准测试以将它们分开？

在您的情况下，您可以使用[PCRE](http://en.wikipedia.org/wiki/Perl_Compatible_Regular_Expressions)的命名捕获`(?<name>match something here)`并替换为`${name}`而不是`\1`. 我不是 100% 确定这适用于`preg_replace`. 不过，我知道`preg_match`正确地存储命名捕获。

PCRE 需要使用`PCRE_DUPNAMES`选项进行编译，以便在您的情况下（如在 RoBorg 的帖子中）有用。我不确定 PHP 编译的 PCRE DLL 文件是否设置了该选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T14:53:53.367

我不知道什么版本的 PCRE 支持[重复的子模式编号语法`(?| … )`](http://www.pcre.org/pcre.txt#line=3890)。但是试试这个正则表达式：

```
/^(?|Guo (\d+) Cars @(\w+)|AV (\d+) Cars @(\w+)|@(\w+) (\d+) #?av)/i 
```

所以：

```
$source = '@abc 123 av';
preg_match('/^(?|Guo (\\d+) Cars @(\\w+)|AV (\\d+) Cars @(\\w+)|@(\\w+) (\\d+) #?av)/i', $source, $output);
var_dump($output); 
```

# .net - beforefieldinit 标志有什么作用？

> ID：610818
> 
> 赞同：85
> 
> 时间：2009-03-04T14:29:27.167
> 
> 标签：.net, cil

beforefieldinit 标志有什么作用？当我查看班级的 IL 时，我看到了这个标志，但我不知道这个标志实际上在做什么？

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2009-03-04T14:33:58.747

请参阅[我](http://csharpindepth.com/Articles/General/Beforefieldinit.aspx)关于这个问题的文章。

基本上，`beforefieldinit`意味着“可以在引用任何静态字段之前的任何时候初始化类型。” *从理论上讲*，这意味着它可以*非常延迟地*初始化——如果你调用一个不涉及任何字段的静态方法，JIT 就不需要初始化类型。

*实际上*，这意味着该类的初始化*时间比其他情况要早-可以在**可能*使用它的第一个方法开始时对其进行初始化。将此与*未*`beforefieldinit`应用于它们的类型进行比较，其中类型初始化必须在第一次实际使用之前立即*发生*。

所以，假设我们有：

```
public static void DoSomething(bool which)
{
    if (which)
    {
        FirstType.Foo();
    }
    else
    {
        SecondType.Bar();
    }
} 
```

如果这两种类型都`beforefieldinit`应用于它们（在 C# 中默认情况下它们会应用，除非该类型具有静态构造函数），那么它们*都*将在方法开始时被初始化`DoSomething`（通常 - 不能保证）。如果他们没有，`beforefieldinit`那么只有*其中一个*会被初始化，基于标志。

这就是为什么在[实现单例模式](http://csharpindepth.com/Articles/General/Singleton.aspx)时通常使用静态构造函数（甚至是空的构造函数！）的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-07-04T13:26:10.417

看来4.6会改

[https://github.com/dotnet/coreclr/issues/1193](https://github.com/dotnet/coreclr/issues/1193)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-03-14T17:50:54.787

如果标记为 BeforeFieldInit，则该类型的初始化方法在第一次访问为该类型定义的任何静态字段时或之前的某个时间执行。

如果未标记 BeforeFieldInit，则在第一次访问该类型的任何静态或实例字段或首次调用该类型的任何静态、实例或虚拟方法时执行该类型的初始化方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-02-10T11:01:43.293

当类型声明显式静态构造函数时，即时 (JIT) 编译器会对该类型的每个静态方法和实例构造函数添加检查，以确保先前调用了静态构造函数。当访问任何静态成员或创建该类型的实例时，将触发静态初始化。但是，如果您声明该类型的变量但不使用它，则不会触发静态初始化，这在初始化更改全局状态时可能很重要。

**当所有静态数据都内联初始化并且未声明显式静态构造函数时，Microsoft 中间语言 (MSIL) 编译器将`beforefieldinit`标志和用于初始化静态数据的隐式静态构造函数添加到 MSIL 类型定义。**

当 JIT 编译器遇到 beforefieldinit 标志时，大多数时候不会添加静态构造函数检查。静态初始化保证在访问任何静态字段之前的某个时间发生，但不会在调用静态方法或实例构造函数之前发生。请注意，静态初始化可以在声明该类型的变量后的任何时间发生。

静态构造函数检查会降低性能。通常静态构造函数仅用于初始化静态字段，在这种情况下，您必须确保静态初始化发生在第一次访问静态字段之前。beforefieldinit 行为适用于这些和大多数其他类型。仅当静态初始化影响全局状态并且以下情况之一为真时才不合适：

对全局状态的影响是昂贵的，如果不使用该类型，则不需要。

无需访问该类型的任何静态字段即可访问全局状态效果。

有关更多信息 [https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca1810](https://docs.microsoft.com/en-us/dotnet/fundamentals/code-analysis/quality-rules/ca1810)

# php - dojo.xhrPost 不发送任何数据

> ID：610821
> 
> 赞同：1
> 
> 时间：2009-03-04T14:29:36.810
> 
> 标签：php, ajax, zend-framework, dojo

我刚刚进入 Dojo，想尝试一个简单的 AJAX Post，就像Dojo 网站上的[示例一样。](http://dojotoolkit.org/book/dojo-book-0-9/hello-world-tutorial)

这是 HTML/JS：

```
<form method="POST" id="addProjectForm">
<dl>
    <dt>Project Name:</dt>
        <dd><input dojoType="dijit.form.TextBox" id="projectName"></dd>
    <dt>Project Description:</dt>
        <dd><textarea dojoType="dijit.form.Textarea" id="projectDescription" style="width: 300px; height: 100px"></textarea></dd>
</dl>

<button dojoType="dijit.form.Button" style="float: right">
    Save Project
    <script type="dojo/method" event="onClick">
        dojo.xhrPost({
            url: '/projects/add/',
            load: function(data, ioArgs) {
                alert(data);
            },
            error: function(data, ioArgs) {
                alert('There was an error');
            },
            form: 'addProjectForm'
        });
    </script>
</button>
</form> 
```

在后端我有以下内容：

```
class ProjectsController extends Zend_Controller_Action
{
public function addAction()
{
    $this->_helper->layout->disableLayout();
    $this->_helper->viewRenderer->setNoRender(true);

    $projectName    = $this->_request->getParam('projectName');
    $description    = $this->_request->getParam('projectDescription');

    print_r($_POST);
}
} 
```

当我单击“保存项目”按钮时，我得到一个 JS 警报框，其中包含空数组的 php 输出，因此没有任何信息被发布。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T16:50:26.737

这是因为一个愚蠢的错误。我没有在任何表单元素上设置名称，只有 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-12T08:46:47.580

由于我昨晚一直在玩通过 Dojo 发布数据，所以我要说一点。

*dojo.xhrPost()*似乎只在 Dojo Toolkit 的最后一个版本中工作，当使用以前的版本时，如果你想处理 POST 数据后服务器给你的响应，你会被锁定到*dojo.io.iframe.send() 。*文档对此有点不清楚。

# struts - 在 WebSphere 的 J2EE/Struts 应用程序中删除不必要的空格

> ID：610827
> 
> 赞同：2
> 
> 时间：2009-03-04T14:30:39.847
> 
> 标签：struts, websphere, jstl, whitespace

有没有人熟悉使用标记库（如 JSTL）产生的删除空白的技术？我知道您可以[通过`trimSpaces`初始化参数](http://forums.sun.com/thread.jspa?threadID=556549)在 Tomcat 中执行此操作，但是在 WebSphere App Server 中执行此类操作的人是否有类似的经验？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T02:20:26.330

[http://raibledesigns.com/rd/entry/trim_spaces_in_your_jsp1](http://raibledesigns.com/rd/entry/trim_spaces_in_your_jsp1)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T20:38:35.627

如果您使用的是 JSP 规范的 2.1 或更高版本，您可以简单地在您的 JSP 中包含以下指令，该指令将在通过网络发送结果有效负载之前去除空格：

```
<%@ page trimDirectiveWhitespaces="true" %> 
```

# sql - 从 Select/Inner Join 语句返回的错误

> ID：610838
> 
> 赞同：0
> 
> 时间：2009-03-04T14:34:02.400
> 
> 标签：sql, sql-server

当我尝试运行以下语句时，返回错误消息：服务器：消息 208，级别 16，状态 1，第 1 行无效的对象名称“vendortofaultypeitemsmap”。

SQL 帮助指示当“引用了不存在的对象”时出现此消息。如果我运行 *select * from vendortofaulttypeitemsmap*，该表确实存在并返回值。有人可以帮我查明导致错误消息的以下语句有什么问题吗？提前致谢。

```
select 
    vendortofaulttypeitemsmap.vendorid, 
    vendortofaulttypeitemsmap.faultypeitemguid,
    guid_faulttypeitems.faulttypeitemname,
    vendortoworkactionmap.workactionitemguid, 
    guid_workactionitem.workactionitemname
from vendortofaultypeitemsmap
    inner join guid_faulttypeitems on
    vendortofaulttypeitemsmap.faultypeitemguid=
        guid_faulttypeitems.faultypeitemguid
    inner join guid_workactionitem on
    vendortoworkactionmap.workactionitemguid=   
        guid_workactionitem.workactionitemguid
where vendortofaulttypeitemsmap.vendorid=45 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-04T14:37:08.147

你错过了一个't' vendortofaultTypeitemsmap。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T14:36:44.357

你有一个错字。它是 vendortofaulttypeitemsmap 或 vendortofaulttypeitemsmap。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T14:39:23.150

每次都写出这些表名很容易出现拼写错误。使用表别名来简化整个事情，并将其更改为：

```
select v.VendorID, v.FaultTypeItemGUID, f.FaultTypeItemName, 
       v.WorkActionItemGUID, w.WorkActionItemName 
from VendorToFaultTypeItemsMap v
inner join GUID_FaultTypeItems f on v.FaultTypeItemGUID = g.FaultTypeItemGUID 
inner join GUID_WorkActionItem w on v.WorkActionItemGUID = w.WorkActionItemGUID
where v.VendorID = 45 
```

对于这样的长名称，使用混合大小写还可以帮助您更轻松地发现问题（假设您的数据库未设置为区分大小写）。

# linux - 如何以编程方式创建新的 cron 作业？

> ID：610839
> 
> 赞同：145
> 
> 时间：2009-03-04T14:34:08.373
> 
> 标签：linux, unix, cron

我希望能够以编程方式添加新的 cron 作业，最好的方法是什么？

根据[我的研究](http://drupal.org/node/175106)，似乎我可以转储当前的 crontab，然后附加一个新的，将其管道返回到 crontab：

```
(crontab -l ; echo "0 * * * * wget -O - -q http://www.example.com/cron.php") | crontab - 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2009-03-04T14:38:40.920

如果您以 root 身份运行，最好的方法是将文件放入 /etc/cron.d

如果您使用包管理器来打包您的软件，您可以简单地将文件放在该目录中，并且它们被解释为好像它们是 crontabs，但带有一个额外的用户名字段，例如：

文件名：`/etc/cron.d/per_minute`

内容： `* * * * * root /bin/sh /home/root/script.sh`

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2012-11-13T04:49:18.073

OP 的解决方案有一个错误，它可能允许添加两次条目，使用下面来修复。

```
(crontab -l ; echo "0 * * * * your_command") | sort - | uniq - | crontab - 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2014-07-22T16:14:28.930

向 cron 添加内容

```
(crontab -l ; echo "0 * * * * hupChannel.sh") 2>&1 | grep -v "no crontab" | sort | uniq | crontab - 
```

从 cron 中删除它

```
(crontab -l ; echo "0 * * * * hupChannel.sh") 2>&1 | grep -v "no crontab" | grep -v hupChannel.sh |  sort | uniq | crontab - 
```

希望能帮助某人

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-06-13T13:49:25.447

这里的大多数解决方案都是为 crontab 添加行。如果您需要更多控制，您将希望能够控制 crontab 的全部内容。

您可以使用管道非常优雅地做到这一点。

要完全重写 crontab，请执行

```
echo "2 2 2 2 2 /bin/echo foobar" |crontab - 
```

这应该很容易与此处描述的其他答案相结合，例如

```
crontab -l | <something> | tee |crontab - 
```

或者，如果您在文件中有内容，那就更简单了

```
cat <file> |crontab - 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-04T14:44:20.033

如果您打算在运行一次的情况下只做一些事情，请查看[“at”](http://linux.about.com/library/cmd/blcmdl1_at.htm)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-06-17T14:15:01.767

只需将编辑器更改为 tee 命令：

```
export EDITOR="tee"
echo "0 * * * * /bin/echo 'Hello World'" | crontab -e 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-07-31T11:32:14.773

假设您的 crontab 中已经有一个条目，那么下面的命令应该工作得比较好。请注意，该`$CMD`变量仅用于可读性。在过滤重复之前排序很重要，因为`uniq`仅适用于相邻行。

```
CMD='wget -O - -q http://www.example.com/cron.php"'
(crontab -l ; echo "0 * * * * $CMD") | sort | uniq | crontab - 
```

如果您当前有一个空的 crontab，您将收到以下错误到 st​​derr：

```
no crontab for user 
```

如果你想避免这种情况，你可以增加一点复杂性添加做这样的事情：

```
(crontab -l ; echo "0 * * * * $CMD") 2>&1 | sed "s/no crontab for $(whoami)//"  | sort | uniq | crontab - 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-04-17T19:28:50.523

这是另一种单行方式，可避免重复

```
(crontab -l 2>/dev/null | fgrep -v "*/1 *  *  *  * your_command"; echo "*/1 *  *  *  * your_command") | crontab - 
```

这是一种回答 JohnZ 并避免`no crontab for user`消息的方法，或者如果您需要在`set -eu`类型环境中操作并且不能让任何东西返回失败（在这种情况下，该`2>/dev/null`部分是可选的）：

```
( (crontab -l 2>/dev/null || echo "")  ; echo "0 * * * * your_command") | sort -u - | crontab - 
```

或者，如果您想拆分内容以使其更具可读性：

```
new_job="0 * * * * your_command"
preceding_cron_jobs=$(crontab -l || echo "")
(echo "$preceding_cron_jobs" ; echo "$new_job") | sort - | uniq - | crontab - 
```

或者可以选择删除对 your_command 的任何引用（例如：如果时间表已更改，您只希望它曾经 cron'ed 一次）。在这种情况下，我们不再需要`uniq`（额外的好处，插入顺序也被保留）：

```
new_job="0 * * * * your_command"
preceding_cron_jobs=$(crontab -l || echo "")
preceding_cron_jobs=$(echo "$preceding_cron_jobs" | grep -v your_command )
(echo "$preceding_cron_jobs" ; echo "$new_job") | crontab - 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-06T10:41:51.067

man crontab 也很有用：

克朗塔布(1)

姓名

```
 crontab - manipulate per-user crontabs (Dillon's Cron) 
```

概要

```
 crontab file [-u user] - replace crontab from file

   crontab - [-u user] - replace crontab from stdin

   crontab -l [user] - list crontab for user 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-07-24T16:00:23.250

添加到 JohnZ 的答案中，如果您是 sudoer，以下是作为 root 进行调度的语法：

```
(sudo crontab -l ; echo "0 * * * * your_command") | sort - | uniq - | sudo crontab - 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-07-14T00:32:11.593

```
function cronjob_exists($command){

    $cronjob_exists=false;

    exec('crontab -l', $crontab);

    if(isset($crontab)&&is_array($crontab)){

        $crontab = array_flip($crontab);

        if(isset($crontab[$command])){

            $cronjob_exists=true;

        }

    }
    return $cronjob_exists;
}

function append_cronjob($command){

    if(is_string($command)&&!empty($command)&&cronjob_exists($command)===FALSE){

        //add job to crontab
        exec('echo -e "`crontab -l`\n'.$command.'" | crontab -', $output);

    }

    return $output;
}

    append_cronjob('* * * * * curl -s http://localhost/cron/test.php'); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-11-11T11:43:22.423

这将检查以确保您的命令在添加之前不存在。

```
crontab -l 2>/dev/null | grep -q '/path/to/script' || echo "5 * * * * /path/to/script" | crontab - 
```

干杯。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-06T10:39:28.623

您也可以将任务添加到 /etc/cron.*/

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-08-19T10:33:27.583

将stdout 插入`crontab`并没有在 macOS 上为我安装新的 crontab，所以我找到了这个解决方案，`tee`在子 shell 中使用编辑器：

```
(EDITOR=tee && (crontab -l ; echo "@daily ~/my-script.sh" ) | uniq - | crontab -e) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-10-21T14:29:57.087

如果您希望任务以用户身份运行：

```
crontab -l | { cat; echo "@weekly what_you_want_to_execute"; } | crontab - 
```

如果您希望任务以特权运行：

```
sudo crontab -l | { cat; echo "@weekly what_you_want_to_execute"; } | sudo crontab - 
```

并检查任务（有或没有'sudo'）：

```
crontab -l | sed '/^$/d; /#/d' 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-09-23T09:42:29.613

以下是我在脚本中使用的内容

1.

```
(2>/dev/null crontab -l ; echo "0 3 * * * /usr/local/bin/certbot-auto renew") | crontab - 
```

```
cat <(crontab -l 2>/dev/null) <(echo "0 3 * * * /usr/local/bin/certbot-auto renew") | crontab - 
```

#写出当前的crontab

```
crontab -l > mycron 2>/dev/null 
```

#echo 新的 cron 到 cron 文件中

```
echo "0 3 * * * /usr/local/bin/certbot-auto renew" >> mycron 
```

#安装新的cron文件

```
crontab mycron

rm mycron 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-05T21:08:39.790

为了在将来更改命令时具有灵活性，您可以这样做（最适合使用更新脚本）

```
MARK=SOME_UNIQUE_MARK_TEXT
LINE="This is the command # $MARK"
# NOTE: I'm using -e because I might want to avoid weird bash expansions for '*' or '$' and place:
# \x2A instead of *
# \x24 instead of $
( crontab -l | grep -v $MARK ; echo -e "0 * * * *" $LINE ) | crontab - 
```

通过这种方式，我可以更新不再用于当前目的的旧 crontab 命令。

基本上我得到了当前的 crontab，我删除了包含 MARK ( `grep -v`) 的行，并通过将它附加到 crontab 文件的末尾来替换它`echo -e`。在这种特殊情况下，我希望它每小时在第 0 分钟执行一次，从[这里](https://crontab.guru/#0_*_*_*_*)`0 * * * *`可以看出。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2009-03-04T14:36:41.580

您也可以直接编辑 cron 表文本文件，但您的解决方案似乎完全可以接受。

* * *

## 回答 #19

> 赞同：-28
> 
> 时间：2009-03-04T14:38:42.357

它对我来说总是很有效。

您应该考虑一个稍微复杂一点的脚本，它可以做三件事。

1.  附加一个 crontab 行；确保它不存在。在它已经存在时添加是不好的。

2.  删除 crontab 行。如果它不存在，也许只有警告。

3.  结合以上两个特性来替换 crontab 行。

# javascript - 如何在 JavaScript 中测试变量是否具有值？

> ID：610842
> 
> 赞同：7
> 
> 时间：2009-03-04T14:35:30.040
> 
> 标签：javascript

我想测试一个 JavaScript 变量是否有值。

```
var splitarr =  mystring.split( " " );
aparam = splitarr [0]
anotherparam = splitarr [1]
//.... etc 
```

但是字符串可能没有足够的条目，所以稍后我想对其进行测试。

```
if ( anotherparm /* contains a value */ ) 
```

我该怎么做呢？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-04T14:39:53.850

```
 if (typeof anotherparm == "undefined") 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T15:03:07.150

一个空字符串在 JavaScript 中的计算结果为 FALSE，所以你可以这样做：

```
if (anotherparam) {...} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T14:37:58.303

您可以通过以下方式检查字符串中的字符数：

```
var string_length = anotherparm.length; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T14:54:01.680

一般来说，它是一个灰色区域......你所说的“有价值”是什么意思？值`null`和`undefined`是您可以分配给变量的合法值...

String 函数`split()`总是返回一个数组，因此使用`length`结果的属性来确定存在哪些索引。超出范围的索引将具有值`undefined`。

但从技术上（在 的上下文之外`String.split()`）你可以这样做：

```
js>z = ['a','b','c',undefined,null,1,2,3]
a,b,c,,,1,2,3
js>typeof z[3]
undefined
js>z[3] === undefined
true
js>z[3] === null
false
js>typeof z[4]
object
js>z[4] === undefined
false
js>z[4] === null
true 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T15:00:57.747

一个技巧是`or`如果变量不存在，则使用运算符定义一个值。如果您正在寻找布尔值“ `true`”或“ `false`” ，请不要使用它

```
var splitarr =  mystring.split( " " );
aparam = splitarr [0]||''
anotherparam = splitarr [1]||'' 
```

这可以防止在变量不存在时引发错误，并允许您将其设置为默认值或您选择的任何值。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T04:05:59.577

上面有这么多答案，你会知道如何检查变量的值，所以我不会重复。

但是，您尝试编写的逻辑可能最好用不同的方法编写，即通过查看拆分数组的长度而不是将数组的内容分配给变量然后检查。

即`if(splitarr.length < 2)`显然`anotherparam`肯定是“不包含价值”。

所以，与其做，

```
if(anotherparam /* contains a value */ )
{
   //dostuff
} 
```

你可以做，

```
if(splitarr.length >= 2)
{
   //dostuff
} 
```

# model-view-controller - 下拉列表值未从 SelectList 中设置，传递给 ViewData 中的视图

> ID：610844
> 
> 赞同：0
> 
> 时间：2009-03-04T14:36:06.200
> 
> 标签：model-view-controller, drop-down-menu, null, viewdata, selectlist

我正在尝试填充办公室位置（文本）和地址（值）的下拉列表当显示页面后在浏览器中查看我的页面源时，我可以看到选择（下拉列表）选项值都是“”。这是我的代码。我正在使用 LinqToSql 数据上下文调用来获取 SelectList 的数据。在调试器中，我可以看到从我的调用返回的列表确实包含我需要的地址和办公地点。我的模型数据上下文代码：

```
public partial class uls_dbDataContext
{
    public List<office_location> GetOfficeLocations()
    {
        return office_locations.ToList();
    }
} 
```

我的控制器代码：

```
 public ActionResult Directions()
    {
        uls_dbDataContext ulsdb_dc = new uls_dbDataContext();

        ViewData["OfficeLocations"] = new SelectList(ulsdb_dc.GetOfficeLocations(),"location_address", "location_name");

        ViewData["Title"] = "Directions";

        return View();
    } 
```

我的视图代码： <%= Html.DropDownList("locations", (SelectList)ViewData["OfficeLocations"])%>

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T15:02:48.013

我必须从预览版 4 升级到 MVC RC2。它解决了下拉列表问题并解决了我的问题。

# jquery - 如何将自定义回调函数附加到 jquery 自动完成扩展？

> ID：610847
> 
> 赞同：5
> 
> 时间：2009-03-04T14:36:20.473
> 
> 标签：jquery, autocomplete, callback

我正在使用 Dylan Verheul、Dan G. Switzer、Anjesh Tuladhar、Jörn Zaefferer 的 jquery autocomplete 1.0.2 扩展。当从自动完成控件中调用 .show() 和 .hide() 时，我正在尝试执行我自己的回调函数。我还没有找到任何方法让它真正识别我的回调函数。如果有人熟悉此控件并可以提供帮助，我将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T16:01:44.137

抱歉，我对你的问题没有任何简单的答案，我检查了插件源代码，没有找到任何机制让你想要你想要的。我认为您必须自己更新此插件才能使其按您的意愿工作。

这个想法是将你的回调添加到`options`参数中，然后让插件使用这些回调。首先，您必须修改插件代码。转到创建负责显示/隐藏自动完成控件的类的函数：

```
$.Autocompleter.Select = function (options, input, select, config) { 
```

如果向下滚动，您可以看到该函数返回一个带有`show()`和`hide()`方法的对象。您可以添加以下代码：

```
hide: function() {
    ...
    options.showCallback && options.showCallback(); // Invoke callback function if set
},
...
show: function() {
    ...
    options.hideCallback && options.hideCallback(); // Invoke callback function if set
}, 
```

最后，当您创建自动完成时，您应该将回调添加到您的选项中：

```
$("#myTextBox").autocomplete("http://...",
{
    showCallback : function() { /* do what you want here */ },
    hideCallback : function() { /* do what you want here */ }
}); 
```

根本没有经过测试，这只是一个快速而肮脏的解决方案。我希望这有帮助。

# c# - 扩展方法何时中断？

> ID：610870
> 
> 赞同：12
> 
> 时间：2009-03-04T14:42:33.673
> 
> 标签：c#, .net, extension-methods

我们目前正在讨论 .NET 中的扩展方法是否不好。或者在什么情况下扩展方法会引入难以发现的错误或以任何其他方式出现意外行为。

我们想出了：

*   为不受您控制的类型编写扩展方法（例如，使用 GetTotalSize() 扩展 DirectoryInfo 等）是不好的，因为 API 的所有者可能会引入隐藏我们扩展的方法 - 并且可能有不同的边缘情况. 例如，如果由于隐藏而不再使用扩展方法，则在扩展方法中测试 null 将自动转换为 NullReferenceException。

问题：

*   除了“隐藏”之外，还有其他我们没有想到的危险情况吗？

编辑：

另一个非常危险的情况。假设你有一个扩展方法：

```
namespace Example.ExtensionMethods
{
    public static class Extension
    {
        public static int Conflict(this TestMe obj)
        {
            return -1;
        }
    }
} 
```

并使用它：

```
namespace Example.ExtensionMethods.Conflict.Test
{
    [TestFixture]
    public class ConflictExtensionTest
    {
        [Test]
        public void ConflictTest()
        {
            TestMe me = new TestMe();
            int result = me.Conflict();
            Assert.That(result, Is.EqualTo(-1));
        }
    }
} 
```

请注意，您使用它的名称空间更长。

现在你用这个引用一个dll：

```
namespace Example.ExtensionMethods.Conflict
{
    public static class ConflictExtension
    {
        public static int Conflict(this TestMe obj)
        {
            return 1;
        }
    }
} 
```

你的测试将失败！它将在没有编译器错误的情况下编译。它**只会失败**。您甚至不必指定“使用 Example.ExtensionMethods.Conflict”。编译器将遍历命名空间名称并在 Example.ExtensionMethods.Extension 之前找到 Example.ExtensionMethods.Conflict.ConflictExtension 并将使用它**而不会抱怨不明确的扩展方法**。哦，恐怖！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T14:46:29.547

一些好奇心：

*   可以在`null`实例上调用扩展方法；这可能会令人困惑（但有时很有用）
*   如果他们有不同的意图，“隐藏”问题是一个大问题
*   同样，您可能会从 2 个不同的命名空间中获得具有相同名称的不同扩展方法；如果您只有两个命名空间*之一*，这可能会导致不一致的行为（取决于哪个）...
*   ...但是如果有人在您的代码使用的第二个命名空间中添加*类似*（相同签名）的扩展方法，它将在编译时中断（不明确）

（**编辑**）当然，还有“ `Nullable<T>`/ `new()`”炸弹（[见这里](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-or-net/194671#194671)）......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T15:02:58.757

我不同意，扩展方法的全部意义在于将您的成员添加到黑盒类中。与其他所有事物一样，存在陷阱，您必须注意命名、实施并了解方法的优先顺序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T14:52:51.200

我们刚刚在[MoreLINQ](http://code.google.com/p/morelinq/)项目中发现了一个缺陷：如果您编写一个通用扩展方法，则无法确保它适用于所有类型。我们有一个带有这个签名的方法：

```
public static IEnumerable<T> Concat<T>(this T head, IEnumerable<T> tail) 
```

您不能将其用于：

```
"foo".Concat(new [] { "tail" }); 
```

因为`string.Concat`方法...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T12:36:47.670

我使用 Ruby on Rails 的时间几乎与使用 C# 的时间一样长。Ruby 允许您执行类似于新扩展方法的操作。当然，如果有人将方法命名为相同，则存在潜在的问题，但是能够将方法添加到封闭类的优势远远超过潜在的劣势（这可能是由糟糕的设计或糟糕的计划造成的）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-30T17:31:52.690

确保扩展方法不与其他方法（扩展或其他方法）冲突的一件事是将[FxCop](http://www.microsoft.com/downloads/details.aspx?familyid=9AEAA970-F281-4FB0-ABA1-D59D7ED09772&displaylang=en)与诸如[防止重复扩展方法签名](http://www.mssoftwareconsulting.com/msswc/blog/post/Prevent-Duplicate-Extension-Method-Signatures.aspx)之类的规则一起使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-04T14:50:46.743

.Net 调用的扩展方法也是一种有限的[MonkeyPatching](https://blog.codinghorror.com/monkeypatching-for-humans/)形式（尝试忽略其中的 php 咆哮）。

那应该为您的讨论提供一些材料。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T14:53:40.213

首先，我认为您的措辞有点误导。我认为您在谈论“类型”而不是“对象”。

其次，扩展方法的一大优势是你可以为你无法控制的类型添加特性。如果你控制了类型，为什么不直接修改类型而不是依赖扩展方法呢？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-05-17T17:33:23.007

我们在我的团队中采取的态度是扩展方法非常有用，以至于您实际上无法禁止它们，但又非常危险（主要是因为隐藏问题），因此您必须保持谨慎。所以我们决定所有扩展方法名称都必须加上前缀`X`（例如，我们有一堆`XInit...()`方法可以以有用的方式初始化控件）。这样 a) 命名冲突的可能性降低了 b) 程序员知道他使用的是扩展方法而不是类方法。

# sql-server - 如何避免 MSDTC？

> ID：610871
> 
> 赞同：3
> 
> 时间：2009-03-04T14:42:39.350
> 
> 标签：sql-server, linq-to-entities

也许这只是一个愚蠢的想法，这就是为什么我把它扔在这里：

我正在创建一个应用程序，使用一个数据库存储基本数据和当前数据（客户、文章、库存、未结发票……），每年使用一个数据库存储存档数据（旧发票、库存移动……）。

只有一个讨厌的小问题：MSDTC。大多数事务只涉及一个数据库，但少数事务涉及当前数据库和一个归档年份。由于所有数据库都在同一台服务器上退出，因此这可能是跨两个数据库的简单事务。

然而，Linq to entity 迫使我为每个数据库创建一个单独的连接，而这里 MSDTC 启动，要求 a) 安装 b) 确实减慢了整个过程。

恼人的！

有没有办法让两个 ADO.Net 实体框架模型使用相同的连接，两者都有自己的当前数据库？

我已经尝试[在 EF Schema 中指定数据库，但 EF 不喜欢这样并阻止它。](https://stackoverflow.com/questions/610197/ado-net-entity-framework-across-multiple-databases)

很烦人。也许我应该将所有表移动到一个数据库中，但是当尝试分离数据以进行备份和加速时，这会很痛苦。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T15:20:50.867

尝试在您的连接上调用 ChangeDatabase。如果您使用多个连接，则始终会涉及 MSDTC。即使是一个数据库。所以我可以建议始终保持一个连接并通过这种方法更改数据库。

希望这可以帮助。

# memory - Web 服务器容量规划：更多内核与更多内存

> ID：610872
> 
> 赞同：3
> 
> 时间：2009-03-04T14:42:46.200
> 
> 标签：memory, windows-server-2008, multicore, capacity-planning

我们有一个很快需要部署的 ASP.NET 项目（大约 40 个 Web 表单、50 个表、相当标准的 IO 内容，并注意尽可能减少）。系统上将有大约 100 个并发用户，但任何时候只有大约 20 个用户会对其进行攻击。我们最初将在 32 位的 Windows Server 2008 上部署它。

在考虑生产服务器规格时，我们应该更担心的是，获得更多内核和更少内存（例如 4 核和 4mb）还是更多内存和更少内核（2 核和 8mb）？

升级到 Windows Server 64 位是否有助于提高内存利用率？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:46:08.203

32 位 Windows Server 只能寻址约 3gb 的内存。获得 64 位、2 核和 4GB。或者，如果钱不是问题，请购买 8 个内核和 24GB。关键是永远不要猜测。如果你猜你就错了。监控内存压力和cpu负载，并根据需要购买更多/升级。试图猜测性能瓶颈是什么是不可能的，也是愚蠢的。*唯一*的方法就是根据它来衡量、衡量、衡量和回应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T19:48:12.610

未包含的一项重要信息是数据库将保存多少数据以及每个用户将使用多少数据。这将决定您需要多少缓存，以及它是否都适合缓存，或者您是否会更多地访问磁盘。

利用率？仅当您要使用 > 3.5GB 的内存时。如果同时有 20 个活动用户，您将需要所有 4 个内核和一个相当大的缓存，因为您最不想要的是一个活动用户数据从缓存中刷新以加载另一个活动用户数据，只需要访问磁盘在他们采取下一步行动时获取第一个用户数据，从缓存中发送另一个活动用户数据......（阅读：抖动）。

# asp.net-mvc - ASP.NET MVC AJAX 日历

> ID：610873
> 
> 赞同：5
> 
> 时间：2009-03-04T14:43:02.737
> 
> 标签：asp.net-mvc, ajax, calendar

我目前正在学习 ASP.NET MVC，并且我遵循了 Stephen Walther 的教程：[ASP.NET MVC Tip #36 – Create a Popup Calendar Helper](http://stephenwalther.com/blog/archive/2008/08/22/asp-net-mvc-tip-36-create-a-popup-calendar-helper.aspx)。

日历正在工作，但我想将日期格式更改为 dd/mm/yyyy。

您还可以在顶部添加箭头，以便可以按年和月更改日历吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-04T15:01:10.180

我知道这可能是出于学习目的，但已经存在一个很好的解决方案：[JQuery UI Datepicker](http://jqueryui.com/demos/datepicker/)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2018-03-01T07:26:52.223

索引.cs

```
[DataType(DataType.Date)]
public string StartDate { get; set; } 
```

索引.cshtml

```
@Html.EditorFor(m => m.StartDate) 
```

# jquery - jQuery 是否像 Mootools 那样拥有自己的 OOP 语法？

> ID：610874
> 
> 赞同：1
> 
> 时间：2009-03-04T14:43:08.803
> 
> 标签：jquery, oop, events

我有一个旧项目，我正在恢复它，它大量使用了我编写的 Javascript/moo 工具事件控制器，以及我编写的一些 Javascript OOP 组件。它非常注重模式和基于 OOP。组件也很好地解耦。

jQuery 有这样的特性吗？如果是这样，它们是什么？

谢谢你，安德鲁·J·李尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-08-06T16:16:25.933

jQuery 没有像暴露 DOM 那样暴露原型继承的 API。

查看[http://moo4q.com](http://moo4q.com)。

Moo4q 提供了一个下载，其中包括 jQuery、14k 的 MooTools 用于继承，以及一个 Class mutator，用于使用您的 MooTools 类自动扩展 jQuery 原型。换句话说，使用 MooTools 构建和组织代码，使用 jQuery 操作 DOM。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T19:15:56.807

jQuery 更侧重于函数式编程风格（如 JavaScript 本身）。就我个人而言，我发现添加“传统”OOP 功能既丑陋又毫无意义。有很多方法可以在 JavaScript 中获得相同的好处，例如，查看它的原型继承风格。

简而言之，没有:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T14:49:15.920

jQuery 使用[插件架构](http://docs.jquery.com/Plugins/Authoring)，这对于开发可重用和解耦的组件非常有用。无论是向公众发布代码还是用于私人项目，这种模式都非常有用。

话虽如此，jQuery 也是 javascript！这意味着您可以使用其他集成了 jQuery 功能的 javascript 设计模式。

# svn - centos 5上的mod_dav_svn加载错误

> ID：610876
> 
> 赞同：0
> 
> 时间：2009-03-04T14:43:57.867
> 
> 标签：svn, installation, mod-dav-svn

我正在尝试在 centos VPS 上安装 subversion。我设法安装了 subversion 和 mod_dav_svn，现在我正在尝试配置它们。

我编辑了 httpd.conf 并添加了以下行：

```
LoadModule dav_svn_module modules/mod_dav_svn.so
LoadModule authz_svn_module modules/mod_authz_svn.so 
```

但这会在重新启动时使 apache 崩溃：

> httpd：/usr/local/apache/conf/httpd.conf 的第 1 行语法错误：/usr/local/apache/conf/includes/pre_main_global.conf 的第 1 行语法错误：无法加载 /usr/local/apache /modules/mod_dav_svn.so 进入服务器：/usr/lib64/libsvn_fs_base-1.so.0：未定义符号：db_create

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T16:15:38.380

[http://www.centos.org/modules/newbb/viewtopic.php?topic_id=14586](http://www.centos.org/modules/newbb/viewtopic.php?topic_id=14586)：

> 此错误意味着您正在将 mod_dav_svn 加载到您的 httpd 中，但您没有加载 mod_dav。尝试将以下行添加到您的 httpd.conf 模块部分：
> 
> LoadModule dav_module 模块/mod_dav.so

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T20:25:18.543

我设法修复了错误。这不是因为没有加载 dav_module，我忘了提到我已经运行 httpd - M 来查看加载的模块并且加载了 mod_dav。

问题出在 Berkeley DB 包上，

我找到的解决方案在这里解释： [FIX UNDEFINED SYMBOL: DB_CREATE ISSUE WITH MOD SVN DAV AND APACHE 2](http://www.orangecoat.com/how-to/fix-undefined-symbol-dbcreate-issue-with-mod-svn-dav-and-apache-2)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-26T05:24:36.133

请自行添加这些配置条目。不要只是从某个地方复制和粘贴。我遇到了同样的问题并手动添加条目解决了这个问题。

# python - 如何知道一个对象是否在 Python 中有一个属性

> ID：610883
> 
> 赞同：2134
> 
> 时间：2009-03-04T14:45:59.233
> 
> 标签：python, attributes

Python中有没有办法确定对象是否具有某些属性？例如：

```
>>> a = SomeClass()
>>> a.someProperty = value
>>> a.property
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: SomeClass instance has no attribute 'property' 
```

在使用之前如何判断是否`a`具有该属性？`property`

* * *

## 回答 #1

> 赞同：3024
> 
> 时间：2009-03-04T14:48:43.737

尝试[`hasattr()`](https://docs.python.org/3/library/functions.html#hasattr)：

```
if hasattr(a, 'property'):
    a.property 
```

请参阅下面[的 zweiterlinde 的回答](https://stackoverflow.com/a/610923/117030)，他提供了关于请求宽恕的好建议！一个非常pythonic的方法！

python 中的一般做法是，如果该属性可能大部分时间都存在，只需调用它并让异常传播，或者使用 try/except 块捕获它。这可能会比`hasattr`. 如果该属性可能大部分时间都不存在，或者您不确定，那么使用`hasattr`可能比反复陷入异常块更快。

* * *

## 回答 #2

> 赞同：763
> 
> 时间：2009-03-04T14:56:28.897

正如[Jarret Hardie](https://stackoverflow.com/questions/610883/how-to-know-if-an-object-has-an-attribute-in-python/610893#610893)回答`hasattr`的那样，会成功的。不过，我想补充一点，Python 社区中的许多人建议采用“更容易请求宽恕而不是许可”（EAFP）而不是“在跳跃之前先看”（LBYL）的策略。请参阅这些参考资料：

[EAFP vs LBYL（回复：到目前为止有点失望）](http://web.archive.org/web/20070929122422/http://mail.python.org/pipermail/python-list/2003-May/205182.html)
[EAFP vs. LBYL @Code Like a Pythonista: Idiomatic Python](https://web.archive.org/web/20180411011411/http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html#eafp-vs-lbyl)

IE：

```
try:
    doStuff(a.property)
except AttributeError:
    otherStuff() 
```

...首选：

```
if hasattr(a, 'property'):
    doStuff(a.property)
else:
    otherStuff() 
```

* * *

## 回答 #3

> 赞同：596
> 
> 时间：2009-03-04T17:54:29.657

您可以使用`hasattr()`或 catch `AttributeError`，但如果您真的只想要具有默认值的属性值（如果它不存在），那么最好的选择就是使用[`getattr()`](https://docs.python.org/library/functions.html#getattr)：

```
getattr(a, 'property', 'default value') 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-03-04T14:52:26.443

我认为您正在寻找的是**hasattr**。但是，如果您想检测**python 属性**，我会推荐这样的东西-

```
try:
    getattr(someObject, 'someProperty')         
except AttributeError:
    print "Doesn't exist"
else
    print "Exists" 
```

这里的缺点是属性`__get__`代码中的属性错误也会被捕获。

否则，做-

```
if hasattr(someObject, 'someProp'):
    #Access someProp/ set someProp
    pass 
```

文档：[http ://docs.python.org/library/functions.html](http://docs.python.org/library/functions.html)
**警告：**
我推荐的原因是 hasattr 不检测属性。
链接： http: [//mail.python.org/pipermail/python-dev/2005-December/058498.html](http://mail.python.org/pipermail/python-dev/2005-December/058498.html)

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2009-03-04T14:56:26.637

根据 pydoc， hasattr(obj, prop) 只需调用 getattr(obj, prop) 并捕获异常。因此，使用 try 语句包装属性访问并捕获 AttributeError 与预先使用 hasattr() 一样有效。

```
a = SomeClass()
try:
    return a.fake_prop
except AttributeError:
    return default_value 
```

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2016-08-26T13:04:30.680

我想建议避免这种情况：

```
try:
    doStuff(a.property)
except AttributeError:
    otherStuff() 
```

用户@jpalecek 提到它：如果`AttributeError`出现在里面`doStuff()`，你就迷路了。

也许这种方法更好：

```
try:
    val = a.property
except AttributeError:
    otherStuff()
else:
    doStuff(val) 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2017-06-22T06:32:28.697

**编辑**：这种方法有严重的局限性。如果对象是**可迭代**的，它应该可以工作。请检查下面的评论。

如果您像我一样使用**Python 3.6**或更高版本，则有一个方便的替代方法来检查对象是否具有特定属性：

```
if 'attr1' in obj1:
    print("attr1 = {}".format(obj1["attr1"])) 
```

但是，我不确定哪个是目前最好的方法。使用`hasattr()`，使用`getattr()`或使用`in`。欢迎评论。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-03-04T15:41:04.110

根据情况，您可以检查您拥有`isinstance`什么样的对象，然后使用相应的属性。随着 Python 2.6/3.0 中[抽象基类](http://www.python.org/dev/peps/pep-3119/)的引入，这种方法也变得更加强大（基本上 ABC 允许更复杂的鸭子类型）。

一种有用的情况是，如果两个不同的对象具有同名但含义不同的属性。使用 only`hasattr`可能会导致奇怪的错误。

一个很好的例子是迭代器和可迭代对象之间的区别（参见[这个](https://stackoverflow.com/questions/709084/how-to-tell-the-difference-between-an-iterator-and-an-iterable)问题）。`__iter__`迭代器和可迭代对象中的方法名称相同，但语义完全不同！所以`hasattr`是没用的，但`isinstance`与 ABC 一起提供了一个干净的解决方案。

但是，我同意在大多数情况下，该`hasattr`方法（在其他答案中描述）是最合适的解决方案。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2016-12-30T07:49:41.750

希望你期待 hasattr()，但尽量避免 hasattr()，请更喜欢 getattr()。getattr() 比 hasattr() 快

**使用 hasattr()：**

```
 if hasattr(a, 'property'):
     print a.property 
```

**同样在这里我使用 getattr 来获取属性，如果没有属性它返回 none**

```
 property = getattr(a,"property",None)
    if property:
        print property 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2021-06-23T16:04:32.557

对于字典以外的对象：

```
if hasattr(a, 'property'):
    a.property 
```

对于字典，`hasattr()`将不起作用。

很多人都说要`has_key()`用于字典，但它已经贬值了。所以对于字典，你必须使用`has_attr()`

```
if a.has_attr('property'):
    a['property'] 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2019-05-25T04:00:52.523

这是一个非常直观的方法：

```
if 'property' in dir(a):
    a.property 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2020-05-28T12:15:31.263

`hasattr()`是正确的答案。我要补充的是，`hasattr()`它也可以很好地与[assert](https://docs.python.org/3/reference/simple_stmts.html#grammar-token-assert-stmt)结合使用（避免不必要`if`的语句并使代码更具可读性）：

```
assert hasattr(a, 'property'), 'object lacks property' 
print(a.property) 
```

如果缺少该属性，程序将退出`AssertionError`并打印出提供的错误消息（`object lacks property`在这种情况下）。

[如关于 SO](https://stackoverflow.com/a/945135/4858818)的另一个答案所述：

> 断言应该用于测试不应该发生的情况。目的是在程序状态损坏的情况下尽早崩溃。

通常情况下，当一个属性丢失，然后`assert`是非常合适的。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-03-13T01:42:27.630

这非常简单，只需使用`dir(`*object*`)`
这将返回对象的每个可用函数和属性的列表。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-03-09T15:54:44.927

`object`您可以使用`hasattr`内置方法检查是否包含属性。

例如，如果您的对象是`a`并且您想要检查属性`stuff`

```
>>> class a:
...     stuff = "something"
... 
>>> hasattr(a,'stuff')
True
>>> hasattr(a,'other_stuff')
False 
```

方法签名本身`hasattr(object, name) -> bool`意味着如果`object`具有传递给第二个参数的**属性**`hasattr`，而不是它给出布尔值`True`或`False`根据`name`对象中属性的存在。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-08-14T00:52:31.730

另一种可能的选择，但这取决于您*之前*的意思：

```
undefined = object()

class Widget:

    def __init__(self):
        self.bar = 1

    def zoom(self):
        print("zoom!")

a = Widget()

bar = getattr(a, "bar", undefined)
if bar is not undefined:
    print("bar:%s" % (bar))

foo = getattr(a, "foo", undefined)
if foo is not undefined:
    print("foo:%s" % (foo))

zoom = getattr(a, "zoom", undefined)
if zoom is not undefined:
    zoom() 
```

输出：

```
bar:1
zoom! 
```

这使您甚至可以检查无值属性。

但！要非常小心，不要意外实例化和比较`undefined`多个位置，因为`is`在这种情况下永远不会起作用。

### 更新：

由于我在上一段中警告过，有多个从不匹配的未定义，我最近稍微修改了这个模式：

`undefined = NotImplemented`

`NotImplemented`，不要与 混淆`NotImplementedError`，是一个内置的：它半匹配 JS 的意图，`undefined`你可以在任何地方重用它的定义，它总是匹配的。缺点是它在布尔值中是“真实的”，并且在日志和堆栈跟踪中看起来很奇怪（但是当你知道它只出现在这个上下文中时你很快就会克服它）。

# java - 适用于 NetBeans 的 GhostDoc

> ID：610884
> 
> 赞同：1
> 
> 时间：2009-03-04T14:46:03.867
> 
> 标签：java, netbeans

有人知道用于 NetBeans IDE 的类似于 GhostDoc 的产品吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T15:37:18.317

内置在 Javadoc 函数中的 Netbeans 可以完成其中的一些工作。右键单击 java 文件并选择工具，然后分析 javadoc。这将检查、修复和添加带有标签的 Javadoc 注释。

[Netbeans 插件门户](http://plugins.netbeans.org/PluginPortal/faces/MainPage.jsp)是否出现了什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T17:04:04.783

[Triemax Jalopy](http://www.triemax.com/products/jalopy/)可以做到这一点，以及非常酷的代码格式。

# asp.net-mvc - 在 MVC 中扩展 WebFormView

> ID：610890
> 
> 赞同：0
> 
> 时间：2009-03-04T14:48:09.090
> 
> 标签：asp.net-mvc, viewengine

我想扩展 WebFormViewEngine 以便我可以执行一些后处理 - 我希望它完成它的工作，然后将 Html 交给我，这样我就可以对其进行最后的润色。它需要作为 View/ViewEngine 完成，因为我需要访问 ViewData。

不幸的是，似乎没有办法从 WebFormView 中取回 Html，也没有办法将自定义 HtmlTextWriter 交给 WebFormView 或 ViewPage。

当然有办法做到这一点？不？

利特尔查瓦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T02:45:18.193

您可以使用操作过滤器来执行此操作。在 asp.net/mvc 上查看[本教程。](http://www.asp.net/LEARN/mvc/tutorial-14-cs.aspx)您想使用 ResultsFilter。

作为替代方案，您可以覆盖 Controller 的虚拟 OnResultExecuted 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-24T09:00:56.457

您可以通过重写 WebFormView 类的 Render 方法在视图呈现之前捕获输出接收器。诀窍是输出接收器不是 System.IO.TextWriter 编写器，而是 viewContext 的 Writer 属性。此外，您必须扩展 WebFormViewEngine 以返回您的视图。

```
public class MyViewEngine : WebFormViewEngine
{
    protected override IView CreatePartialView(ControllerContext controllerContext, string partialPath)
    {
        return new MyView(partialPath, null);
    }

    protected override IView CreateView(ControllerContext controllerContext, string viewPath, string masterPath)
    {
        return new MyView(viewPath, masterPath);
    }
}    

public class MyView : WebFormView
{
    public MyView(string inViewPath, string inMasterPath) : base(inViewPath, inMasterPath) { }
    public MyView(string inViewPath) : base(inViewPath) { }

    public override void Render(ViewContext viewContext, System.IO.TextWriter writer)
    {
        //make a switch to custom output receiver
        var oldWriter = viewContext.Writer;
        viewContext.Writer = new System.IO.StringWriter();
        base.Render(viewContext, null);
        viewContext.Writer.Close();

        //get output html
        var html = ((System.IO.StringWriter)viewContext.Writer).GetStringBuilder();

        //perform processing
        html.Replace('a', 'b');

        //retransmit output
        viewContext.Writer = oldWriter;
        viewContext.Writer.Write(html);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T18:26:50.687

好的，我以前从未这样做过，但我查看了反射器和 MVC 组件。看起来好像您可以使用您的对象扩展 ViewPage 和 ViewPage 和 ViewMasterPage 对象。在您自己的对象中，您可以覆盖渲染方法并获取 HtmlTextWriter 的句柄。然后把它传给基地，让它做这件事。像这样的东西（这是未经测试的，只是理论上的，可能有更多的方法需要覆盖。）我建议使用反射器来看看它现在是如何完成的，甚至是像 Spark 这样的其他视图引擎是如何做到的。

```
public class MyPage : ViewPage
{
    protected override void Render(System.Web.UI.HtmlTextWriter writer)
    {
        //Do custom stuff here
        base.Render(writer);
    }
}
public class MyPage<TModel> : MyPage where TModel : class
{
} 
```

# django - django 内连接查询

> ID：610891
> 
> 赞同：2
> 
> 时间：2009-03-04T14:48:10.040
> 
> 标签：django, inner-join

我正在使用 django 并且很难掌握如何进行复杂的查询

这是我的模型

```
class TankJournal(models.Model):
    user = models.ForeignKey(User)
    tank = models.ForeignKey(TankProfile)
    ts = models.DateTimeField(auto_now=True)
    title = models.CharField(max_length=50)
    body = models.TextField()

    class Meta:
        ordering = ('-ts',)
        get_latest_by = 'ts' 
```

我需要提取给定坦克对象的用户名。

用户对象是 django 内置的对象。谢谢！

编辑：

我试过这个

```
print User.objects.filter(tankjournal__tank__exact=id) 
```

它似乎不只是拉出 id.. 并拉出 tankjournal 中的所有内容并将其与 tank 对象匹配

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:59:53.617

如果你已经有了你的*坦克*对象，你应该能够做到：

```
tank.user.username 
```

为了减少数据库查询，您可能需要考虑使用 [select_related()](http://docs.djangoproject.com/en/dev/ref/models/querysets/)，例如

```
tanks = TankJournal.objects.all().select_related()
for tank in tanks:
    username = tank.user.username 
```

如果您有特定的坦克 ID，则：

```
tank = TankJournal.objects.select_related().get(id=123456)
username = tank.user.username 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T15:01:10.290

我可能误解了您的问题，但请求`User.objects.filter()`将返回用户对象列表，而不是用户 ID。你写的在技术上看起来是正确的。

但请记住，您拥有的模型在 TankProfile 对象和 TankJournal 之间建立了一对多的关系。换句话说，一个 TankProfile 可以与多个 TankJournal 相关联，因此可以与多个用户相关联。鉴于此，您的查询正在做正确的事情，返回多个用户。

# python - 为游戏地图（在 Python 中）构建有向图的好策略是什么？

> ID：610892
> 
> 赞同：9
> 
> 时间：2009-03-04T14:48:19.650
> 
> 标签：python, graph, procedural-generation

我正在用 Python 开发一个程序生成的游戏世界。世界的结构将类似于 MUD/MUSH 范式，房间和出口排列为有向图（房间是节点，出口是边）。（请注意，这*不一定*是无环图，尽管我愿意考虑无环解决方案。）

对于世界生成算法，不同类型的房间将通过每个房间的“标签”属性（一组字符串）来区分。一旦它们被实例化，就可以通过标签（单标签、标签交集、标签联合、最佳候选）来查询和选择房间。

我将使用模板对象和工厂方法的美化系统创建特定类型的房间——我认为这里的细节并不重要，因为当前的实现可能会改变以匹配所选的策略。（例如，可以将标签和标签查询添加到房间模板系统。）

例如，我将拥有以下类型的房间：

```
side_street, main_street, 广场, 酒吧, 酒店, 餐厅, 商店, 办公室
```

最后，问题是：实例化和安排这些房间以创建可能对应于给定规则的图形的好策略是什么？

一些规则可能包括：每 10,000 人拥有一个广场；`main_street`连接到`plaza`; `side_street`连接到`main_street`或`side_street`；`hotel`青睐`main_street`或`plaza`联系，并相应地接收更多标签；等等

如果建议的策略能够实现数据驱动的实施，则可以加分。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T15:41:51.253

首先，你需要一些位置感。您的各种对象占用了一些坐标空间。

你必须决定这些不同的事情有多规律。在简单的情况下，您可以将它们作为简单的矩形（或矩形实体）放入坐标空间中，以使位置更易于规划。

如果这些东西是不规则的——而且是密集的——生命就会更加复杂。

定义地图以包含位置。每个位置都有一个坐标跨度；如果您使用简单的矩形，那么每个位置都可以有一个 (left, top, right, bottom) 元组。

您的地图将需要方​​法来确定谁居住在给定空间中，以及与该空间相邻的事物等。

然后，您可以使用已确定的一组固定位置对其进行单元测试，这些位置都可以放入地图中，并通过一些基本的完整性检查，以检查非冲突、相邻等。

* * *

其次，你需要一种“迷宫发生器”。简单连接的迷宫很容易生成为折叠到给定空间中的树结构。

迷宫/树有一个“根”节点，它将成为迷宫的中心。不一定是您空间的物理中心，但根节点将是迷宫结构的中间。

理想情况下，该节点的一个分支包含一个通向整个空间的“入口”。

该节点的另一个分支包含整个空间的一个“出口”。

有人可以从入口走到出口，一路走来走去很多“死胡同”的地方。

为根节点选择一种空间。将其放入您的地图空间。

这将有 1 - *n 个*入口，每个入口都是具有根节点和 1 - *n 个*入口的子树。正是这种多入口业务使树木自然适合这种结构。此外，一棵适当的树总是连接良好，因为您永远不会有无法到达的孤立部分。

您将 - 递归地 - 从根节点扇出，选择位置并将它们放入可用空间。

对此进行单元测试以确保它可以很好地填充空间。

* * *

您的其余要求是对迷宫生成器选择位置的方式进行微调。

最简单的是有一个权重表和随机选择表。选择一个随机数，将其与权重进行比较，以查看识别出哪种位置。

* * *

您对空间的定义可以是 2D 或 3D——两者都非常合理。对于奖励积分，请考虑如何实现用六边形而不是正方形平铺的 2D 空间。

这个“几何”可以是各种算法的**策略**插件。如果你可以用六边形 2D 代替方形 2D，那么你的 OO 设计已经做得很好了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-04T22:20:48.253

查看关于[MUD 连接器](http://www.mudconnector.com)的讨论- 在“高级编码和设计”（或类似的）论坛中有一些关于世界布局和生成以及不同类型的坐标/导航系统的精彩讨论。

# java - SSL通信，到底有多难？

> ID：610896
> 
> 赞同：0
> 
> 时间：2009-03-04T14:49:06.373
> 
> 标签：java, ssl, certificate, private, main

我在我的 PC 上运行了一个 Java 主应用程序，它可以将 XML 数据发送到一个 serverlet 并接收回 XML 数据。 [http://iamt.wisconsin.gov/IAM-WiEntUser/WiEntUserService?xml=](http://iamt.wisconsin.gov/IAM-WiEntUser/WiEntUserService?xml=)

我可以使用IE 和 Firefox 中的[https://iamt.wisconsin.gov/IAM-WiEntUser/WiEntUserService?xml=](https://iamt.wisconsin.gov/IAM-WiEntUser/WiEntUserService?xml=)因为他们允许我加载私有证书。

我想使用 Java 主应用程序中的 https，因为某些数据很敏感。我得到一个带有 MSG=unkown 证书的 IOException。好的，这是有道理的，Java 不知道私有证书。

我希望它会像告诉 Java 信任 FireFox 证书一样简单。System.setProperty("javax.net.ssl.trustStore", "C:/Documents and Settings/kendajm/Application Data/Mozilla/Firefox/Profiles/6f8ggdi7.default/cert8.db"); 但这给出了一个带有 MSG=Invalid keystore 格式的 IOException。

SSL通信，到底有多难？我花了八个小时试图找出如何做到这一点。似乎这很容易，以至于没有记录或非常困难，而且没有人有一个很好的例子。

帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T15:42:05.620

默认情况下，Mozilla cert8.db 密钥存储格式不可读（尽管可以“插入”一个可以解析它的提供程序。）将证书导入默认支持的密钥存储是最简单的。

首先，您需要一份证书副本。

在 Firefox 中，访问相关页面。单击窗口右下角状态栏上的“锁定”图标。在出现的对话框中，单击“查看证书”按钮。将出现一个新对话框；选择其“详细信息”选项卡。单击窗口底部的“导出”按钮，将证书保存到文件中（使用 DER 或 PEM 格式）。

现在，您需要将证书转换为 Java 使用的密钥存储格式。

使用 JDK 的`keytool`实用程序：

```
keytool -import -keystore mykeystore.jks -alias iamt -file iamt.wisconsin.gov
```

当提示输入密码时，请选择一个新密码，以便稍后验证密钥库中的证书没有被篡改。接下来`keytool`会提示你是否信任新证书——输入yes！您应该有一个名为“mykeystore.jks”（或您选择的任何内容）的新 Java 密钥存储文件。

现在，运行您的程序，将您的新密钥存储文件指定为“javax.net.ssl.trustStore”属性的值。

* * *

顺便说一句，我注意到您正在`XMLEncoder`从服务返回 Java Beans 输出。这种“Long Term Persistence”格式是 JDK 中一个被忽视的瑰宝，但解析不受信任的内容并不安全。使用这种语法，可以在 JVM 中调用任何方法进行解析。这有点像带有不受信任的 JSON 的“eval”。因此，如果我正在实现一个客户端服务，我可能不愿意在没有大量额外工作的情况下解析来自服务的结果以将解析“沙盒”为不受信任的代码。而且我假设服务解析请求中的相同格式，这对服务器同样危险。

* * *

当您询问有关错误消息的问题时，最好发布整个消息，包括堆栈跟踪（除非它实际上是一个`java.lang.StackOverflowError`！）。它对您来说可能毫无意义，但它通常具有立即发现问题所需的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T14:53:52.913

据我了解，问题在于 Java 不会接受自签名证书。如果我错了，请纠正我！

您是否尝试过使用[Commons-HttpClient](http://hc.apache.org/httpclient-3.x/)？这有更多选项，并且在[此页面上](http://hc.apache.org/httpclient-3.x/sslguide.html)有接受自签名证书的指南。另请参阅[此示例代码](http://svn.apache.org/viewvc/httpcomponents/oac.hc3x/trunk/src/contrib/org/apache/commons/httpclient/contrib/ssl/EasySSLProtocolSocketFactory.java?view=markup)

编辑：这里有关于如何将证书导入 Java 的指南[-](http://brian.pontarelli.com/2008/07/26/java-ssl-and-self-signed-certificates/)显然，您需要在运行 Java 应用程序的每台机器上执行此操作。HttpClient 选项可能更灵活，具体取决于您的需要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T14:58:50.560

一旦我使用 keytool 在 Java 中正确注册了自签名证书，我就能够使用它。

请参阅本指南：http: [//java.sun.com/j2se/1.4.2/docs/tooldocs/windows/keytool.html](http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/keytool.html)

本质上，您： 1\. 创建自签名证书 2\. 将其导出到文件 3\. 将其导入默认密钥库

但是，您尝试与之集成的政府网站可能会拒绝此类自签名证书。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T17:35:55.440

1.  从 IE 将证书导出为 Base-64 编码的 X.509 (.CER)
2.  在导出的证书上运行 keytool。提供 trustStore 文件和密码。对信任问题回答“是”。keytool -import -v -trustcacerts -alias IamtCert -file C:\Work\IAM\Acceptance\IamAcceptanceCertificate.cer -keystore N:\WEB\DEG\Ca​​Cert.dat
3.  添加两行代码。System.setProperty("javax.net.ssl.trustStore","N:\WEB\DEG\Ca​​Cert.dat"); System.setProperty("javax.net.ssl.trustStorePassword","xxxxxx");

一旦你知道该怎么做就不难了。其余代码保持不变。（Servlet 有另一种验证调用者的方法，不涉及证书。）

```
 urlAddress += encodedXmlData;
    URL  url = null;
    HttpURLConnection connection = null;
    StringBuffer result = new StringBuffer();
    try {
        url = new URL( urlAddress );
        connection = (HttpURLConnection)url.openConnection();
    }
    catch( IOException ioe ) {
        System.out.println(classMethod+": IOException: URL Msg="+ioe.getMessage() );
        return(null);
    }           
    connection.setDoInput(true);    // Default value.
    connection.setDoOutput(true);   // Not the default value.
    connection.setUseCaches(false); // Not the default value.
    try {
        connection.setRequestMethod("POST");  // Large pay load.
    }
    catch( ProtocolException pe ){
        System.out.println(classMethod+": ProtocolException: URL Msg="+pe.getMessage() );
        return(null);
    }
    // If true, this URL is being examined in a context in which it makes
    // sense to allow user interactions such as popping up an 
    // authentication dialog.
    connection.setAllowUserInteraction(false);
    try {
        connection.connect();
        BufferedReader bufferedReader = new BufferedReader( new
                InputStreamReader( connection.getInputStream() ) );

        // Retrieve the response
        String inputLine = null;
        while ( (inputLine = bufferedReader.readLine() ) != null ) {
            if ( inputLine.indexOf("</void>") > -1 ) inputLine+='\n';
            result.append(inputLine);
        }
        bufferedReader.close();
        connection.disconnect();
    }
    catch( IOException ioe) {
        System.out.println(classMethod+": IOException: Read Msg="+ioe.getMessage() );
        return(null);
    } 
```

# soap - 可能使用格式错误的故障消息？

> ID：610902
> 
> 赞同：1
> 
> 时间：2009-03-04T14:50:12.860
> 
> 标签：soap, wcf-client

我有一个 WCF 客户端与我无法控制的未知服务器实现进行通信。这个客户端工作正常，只是不喜欢，看起来是，格式不正确的 SOAP 错误消息。我收到的消息如下所示：

```
<soap:信封 xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">   
    <soap:Header>...</soap:Header>  
    <肥皂：身体>  
        <soap:故障>  
            <soap:faultcode>soap:Client</soap:faultcode>  
            <soap:faultstring>...</soap:faultstring>  
            <soap:detail>...</soap:detail>  
        </soap:故障>  
    </肥皂：身体>  
</soap:信封>  

```

我相信根据soap模式，子元素不应该被限定并且看起来像：

```
<soap:信封 xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">   
    <soap:Header>...</soap:Header>  
    <肥皂：身体>  
        <soap:故障>  
            <faultcode>soap:客户端</faultcode>  
            <故障字符串>...</故障字符串>  
            <详细>...</详细>  
        </soap:故障>  
    </肥皂：身体>
</soap:信封>

```

有什么我可以配置或覆盖的东西，以便我可以使用以后一种格式到达的消息，以便我可以使用错误消息而不是 xml 异常？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T22:48:21.127

我不记得我是如何偶然发现消息检查器的，但它是我如何解决我的问题的。

[这篇](http://msdn.microsoft.com/en-us/library/aa717047.aspx)和[这篇](http://blogs.msdn.com/kaevans/archive/2008/01/08/modify-message-content-with-wcf.aspx)文章为创建检查器提供了基础，以下是检查器的核心：

```
public void AfterReceiveReply(ref Message reply, object correlationState)
{
    if (!reply.IsFault)
        返回;

    var 文档 = 新的 XmlDocument();

    document.Load(reply.GetReaderAtBodyContents());

    var navigator = document.CreateNavigator();
    var manager = new XmlNamespaceManager(navigator.NameTable);

    manager.AddNamespace("soap", "http://schemas.xmlsoap.org/soap/envelope/");

    var it = navigator.Select("//soap:Fault", manager);

    if (it.MoveNext() && it.Current.HasChildren && it.Current.MoveToChild(XPathNodeType.Element))
    {
        做
        {
            var c = it.Current;

            if (string.IsNullOrEmpty(c.Prefix))
                继续;

            c.ReplaceSelf("<" + c.LocalName + ">" + c.InnerXml + "</" + c.LocalName + ">");

            /// 我们可能想要记录包含在细节元素中的细节，
            /// 它不会在引发的 FaultException 中报告。

        } 而 (it.Current.MoveToNext());
    }

    var reader = XmlDictionaryReader.CreateDictionaryReader(new XmlNodeReader(document));

    reader.MoveToStartElement();

    var fixedReply = Message.CreateMessage(reply.Version, null, reader);

    fixedReply.Headers.CopyHeadersFrom(reply.Headers);
    fixedReply.Properties.CopyProperties(reply.Properties);

    回复 = 固定回复；
}

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T15:00:26.000

看起来有问题的应用程序正在使用自定义（并且实现不佳）的 SOAP 库。下面的文章可能会有所帮助（到目前为止，我还没有处理这个问题，因为我在一个纯 .Net 商店）。

[http://msdn.microsoft.com/en-us/library/ms733721.aspx](http://msdn.microsoft.com/en-us/library/ms733721.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-06T18:57:50.453

请注意，System.Web.Services.Protocols.SoapHttpClientProtocol 类似乎*比*WCF 更能容忍格式错误的故障响应。

这有时被称为 ASMX 服务协议。这也可能是一个可以考虑的选择。

霍华德霍夫曼

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-15T14:47:08.910

```
} catch (SoapFaultClientException e) {
    log.error(e);
    SoapFaultDetail soapFaultDetail = e.getSoapFault().getFaultDetail();
    SoapFaultDetailElement detailElementChild = (SoapFaultDetailElement) soapFaultDetail.getDetailEntries().next();
    Source detailSource = detailElementChild.getSource();

    try {
        Object detail = (JAXBElement<SearchResponse>) getWebServiceTemplate().getUnmarshaller().unmarshal(detailSource);
//                throw new SoapFaultWithDetailException(detail);

    } catch (IOException e1) {
        throw new IllegalArgumentException("cannot unmarshal SOAP fault detail object: " + soapFaultDetail.getSource());
    }

} 
```

# macos - 在 Leopard 中设置 $DISPLAY 的配置文件是什么？

> ID：610911
> 
> 赞同：0
> 
> 时间：2009-03-04T14:53:51.633
> 
> 标签：macos, x11, osx-leopard

据此，为了[在](http://homepage.mac.com/sao1/X11/ "mac.com 关于 X11 的文章")Leopard 中获得最佳结果，我的 $DISPLAY 变量应该以`/tmp/launchd`. 唉，我的 $DISPLAY 变量是`/tmp/launch-aLhnOW/:0`

我没有在其中任何一个中设置 $DISPLAY ...

*   /私人/等/个人资料
*   /私人/等/bashrc
*   ~/.bash_profile
*   ~/.profile

...所以我怀疑 X11 正在读取其他一些配置文件。有什么建议么？

我特别需要确保它**没有**设置在任何地方。根据链接的文章：

> 从 Dock 启动 X11.app 会给你两个图标，将其设置为自动启动也是一个禁忌，如果你在任何配置文件中设置了 DISPLAY，你会遇到灾难。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-09T17:56:42.120

我认为你的`DISPLAY`变量看起来不错。我不认为它是由配置文件设置的。

通常你有一个启动配置文件，例如`/System/Library/LaunchAgents/org.x.startx.plist`. 这包含一个部分：

```
 <key>Sockets</key>
            <dict>
                    <key>:0</key>
                            <dict>
                                    <key>SecureSocketWithKey</key>
                                            <string>DISPLAY</string>
                            </dict>
            </dict> 
```

我相信这会导致 launchd 打开一个套接字并将`DISPLAY`变量设置为其路径。当程序接触到这个套接字时，`startx`由 launchd 调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-04T15:03:56.617

您应该可以在`~/.MacOSX/environment.plist`文件中设置它。详细信息可以在[这里](http://developer.apple.com/qa/qa2001/qa1067.html)找到。

# c++ - 翻转布尔值的最简单方法？

> ID：610916
> 
> 赞同：138
> 
> 时间：2009-03-04T14:54:23.940
> 
> 标签：c++, c, boolean, boolean-logic

我只想根据它已经是什么来翻转一个布尔值。如果它是真的 - 让它成为假的。如果它是假的 - 让它成为真的。

这是我的代码摘录：

```
switch(wParam) {

case VK_F11:
  if (flipVal == true) {
     flipVal = false;
  } else {
    flipVal = true;
  }
break;

case VK_F12:
  if (otherVal == true) {
     otherValVal = false;
  } else {
    otherVal = true;
  }
break;

default:
break;
} 
```

* * *

## 回答 #1

> 赞同：383
> 
> 时间：2009-03-04T14:55:26.467

您可以像这样翻转一个值：

```
myVal = !myVal; 
```

因此您的代码将缩短为：

```
switch(wParam) {
    case VK_F11:
    flipVal = !flipVal;
    break;

    case VK_F12:
    otherVal = !otherVal;
    break;

    default:
    break;
} 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2009-03-04T16:56:11.667

显然你需要一个工厂模式！

```
KeyFactory keyFactory = new KeyFactory();
KeyObj keyObj = keyFactory.getKeyObj(wParam);
keyObj.doStuff();

class VK_F11 extends KeyObj {
   boolean val;
   public void doStuff() {
      val = !val;
   }
}

class VK_F12 extends KeyObj {
   boolean val;
   public void doStuff() {
      val = !val;
   }
}

class KeyFactory {
   public KeyObj getKeyObj(int param) {
      switch(param) {
         case VK_F11:
            return new VK_F11();
         case VK_F12:
            return new VK_F12();
      }
      throw new KeyNotFoundException("Key " + param + " was not found!");
   }
} 
```

:D

```
</sarcasm> 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2014-03-21T16:46:39.267

我发现的最简单的解决方案：

```
x ^= true; 
```

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2009-03-04T16:55:44.337

如果您知道值是 0 或 1，则可以执行`flipval ^= 1`.

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-04T16:58:35.827

仅供参考 - 如果您的必填字段不是整数，而是较大类型中的一位，请改用“xor”运算符：

```
int flags;

int flag_a = 0x01;
int flag_b = 0x02;
int flag_c = 0x04;

/* I want to flip 'flag_b' without touching 'flag_a' or 'flag_c' */
flags ^= flag_b;

/* I want to set 'flag_b' */
flags |= flag_b;

/* I want to clear (or 'reset') 'flag_b' */
flags &= ~flag_b;

/* I want to test 'flag_b' */
bool b_is_set = (flags & flag_b) != 0; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-05T07:56:17.450

这似乎是一个免费的所有人......呵呵。这是另一个变体，我想它比我推荐的生产代码更属于“聪明”类别：

```
flipVal ^= (wParam == VK_F11);
otherVal ^= (wParam == VK_F12); 
```

我想它的优点是：

*   非常简洁
*   不需要分支

一个同样明显的缺点是

*   非常简洁

这与@korona 使用 ?: 的解决方案很接近，但更进一步。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2012-03-07T20:34:36.893

只是因为没有列出我最喜欢的切换布尔值的奇数球方式......

```
bool x = true;
x = x == false; 
```

也可以。:)

（是的`x = !x;`更清晰，更容易阅读）

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-03-04T16:00:15.903

codegolf'ish 解决方案更像是：

```
flipVal = (wParam == VK_F11) ? !flipVal : flipVal;
otherVal = (wParam == VK_F12) ? !otherVal : otherVal; 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-08-31T17:36:05.017

```
flipVal ^= 1; 
```

同样适用

```
otherVal 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-04T15:25:48.640

我更喜欢 John T 的解决方案，但如果你想全部使用代码，你的陈述在逻辑上会简化为：

```
//if key is down, toggle the boolean, else leave it alone.
flipVal = ((wParam==VK_F11) && !flipVal) || (!(wParam==VK_F11) && flipVal);
if(wParam==VK_F11) Break;

//if key is down, toggle the boolean, else leave it alone.
otherVal = ((wParam==VK_F12) && !otherVal) || (!(wParam==VK_F12) && otherVal);
if(wParam==VK_F12) Break; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-04T17:14:50.437

显然，您需要一个灵活的解决方案来支持伪装成布尔值的类型。以下允许：

```
template<typename T>    bool Flip(const T& t); 
```

然后，您可以将其专门用于可能假装为布尔值的不同类型。例如：

```
template<>  bool Flip<bool>(const bool& b)  { return !b; }
template<>  bool Flip<int>(const int& i)    { return !(i == 0); } 
```

使用此构造的示例：

```
if(Flip(false))  { printf("flipped false\n"); }
if(!Flip(true))  { printf("flipped true\n"); }

if(Flip(0))  { printf("flipped 0\n"); }
if(!Flip(1)) { printf("flipped 1\n"); } 
```

不，我不是认真的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-01-02T21:10:55.157

对于值为 0 和 1 的整数，您可以尝试：

```
value = abs(value - 1); 
```

C中的MWE：

```
#include <stdio.h>
#include <stdlib.h>
int main()
{
        printf("Hello, World!\n");
        int value = 0;
        int i;
        for (i=0; i<10; i++)
        {
                value = abs(value -1);
                printf("%d\n", value);
        }
        return 0;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-02-23T23:30:30.030

只是因为我喜欢质疑代码。我建议您也可以通过执行以下操作来使用三元：

例子：

```
bool flipValue = false;
bool bShouldFlip = true;
flipValue = bShouldFlip ? !flipValue : flipValue; 
```

# visual-studio-2005 - 在 VS 2005 IDE 中为 NUnit 集成编写插件

> ID：610917
> 
> 赞同：1
> 
> 时间：2009-03-04T14:54:28.217
> 
> 标签：visual-studio-2005, nunit

我开始为 Visual Studio 2005 编写一个将 NUnit 与 IDE 集成的加载项。关于我应该如何以及从哪里开始的任何想法？我对插件的工作方式有一个基本的了解。

我相信我需要知道这种类型的集成的 NUnit API。我在哪里可以找到足够的资源来实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T15:10:49.923

您可以尝试的一些资源：

1.  [Monodevelop](http://monodevelop.com/Main_Page)有 NUnit 插件。[通过阅读源代码](http://anonsvn.mono-project.com/viewvc/trunk/monodevelop/main/src/addins/NUnit/)，您可以阅读很多关于如何与 NUnit API 通信的信息，尤其是如果它更多地用于学习目的。

2.  NUnit GUI 是开源的，因此您可以看到它如何与 NUnit 运行程序等交互。它只是一个包装器，应该包含您需要的所有功能。

3.  [NUnit](http://www.nunit.org/)的人反应迅速，如果您订阅他们的[邮件列表](http://groups.google.com/group/nunit-discuss)，他们将帮助您找到合适的 API。

4.  有很多关于如何为 VS 创建插件的文章，这里有[一篇](http://www.c-sharpcorner.com/UploadFile/satisharveti/VSAdd-ins03022009064839AM/VSAdd-ins.aspx)（你可以通过 google 找到更多）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-29T22:22:07.280

您可以查看 Visual nUnit for VS 2008 项目 - 它的开源并与 VS 2008 很好地集成 - [http://www.bubblecloud.org/visualnunit](http://www.bubblecloud.org/visualnunit)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T15:23:48.287

我想为 MBUnit 添加一个插件，我认为它几乎是 nUnit 功能的超集。[api 文档](http://www.gallio.org/api/html/index.html)看起来不错。

# java - GUI创建代码布局理论？

> ID：610918
> 
> 赞同：3
> 
> 时间：2009-03-04T14:54:45.767
> 
> 标签：java, user-interface, swing

这个问题与其说是“如何创建 gui”，不如说是“在哪里创建 gui”。

我有一些 Java 代码可以检查以确保所需的驱动程序到位：

```
public boolean confirmDrivers() { 
       /* some logic */ 
       return someDriver.exists();
} 
```

它被称为：

```
if (confirmDrivers()) {
       createGUI();              
} 
```

在 createGUI() 中为某些按钮定义动作监听器是不是一个坏主意？它似乎不合适，因为该函数主要是分配（即 - myButton.setToolTipText("hay guyz click here!"); ），并且侦听器包含次要逻辑（主要是调用包含逻辑的其他函数。

只是好奇其他人在这种情况下会做什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T14:58:37.067

将 GUI 完全从业务逻辑中分离出来。将 GUI 包装为它自己的类，并在构造函数中附加动作侦听器，并可能传入处理实际业务逻辑的任何内容。像这样的东西：

```
if (confirmDrivers()) {
    new GUI(someBusinessLogicController);
} 
```

# mysql - SQL Server 和 MySQL 中最大可用表数

> ID：610920
> 
> 赞同：7
> 
> 时间：2009-03-04T14:56:12.813
> 
> 标签：mysql, sql-server, performance

我知道在 SQL Server 中，数据库中“对象”的最大数量略高于 20 亿。对象包含表、视图、存储过程、索引等。我一点也不担心超过 20 亿个物体。但是，我想知道的是，SQL Server 是否会因拥有大量表而导致性能下降。您添加的每个表是否都有性能影响，或者基本上没有区别（假设数据量恒定）。有没有人有使用具有数千个表的数据库的经验？我也想知道关于 MySQL 的问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-04T15:12:57.453

没有区别，假设数据量不变。

由于诸如减少维护窗口（较小的索引重建）、拥有只读文件组等的能力，实际上可能是一种收益。

性能由查询和索引（在最基本的级别）决定：不是对象的数量

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-23T03:41:18.270

就最大表数而言，我有一个包含 200 万个表的数据库。根本没有性能受到影响。我的桌子每张大约 15MB。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T15:14:58.760

我怀疑 SQL Server 在处理数千个表时会出现性能问题，但我肯定会。

不过，我在 SQL Server 中处理过包含数百个表的数据库，没有任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T15:32:46.517

SQl Server 可能会因为使用包含许多列的表而不是拆分相关表（即使是具有一对一关系的表）而遭受更大的性能损失。另外，当您要输入的数据超过您可以为列存储的字节数时，宽表可能会出现问题。例如，您可以创建一个可能存储 10000 个字节的表，但您仍然只能存储 8060 个字节。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-27T14:43:51.133

根据我的经验，我认为桌子的数量不会影响性能。但是你应该能够证明为什么你在数据库中有这么多表。那是因为数据库端有这么多表也会影响服务器端开发人员的工作。

IMO 如果您根据功能划分表，那么您不能让开发人员的生活变得轻松，但也可以在您的应用程序中获得性能提升，因为您有固定的表，您可以从其中获取所需的数据。

假设您需要存储销售、购买、收据和付款详细信息。它们都具有相同的表结构，然后您可以将它们单独存储在单独的表中，而不是将它们存储在单个表中。有了这些，您可以获得单表中销售的所有详细信息，以及在其单表中购买的所有详细信息。因此它可以帮助改善应用程序数据库层的响应时间，这是所有 Web 层中最慢的组件之一......！！！当然，我们通过 SQL 查询来提高数据库的性能，但是这样的结构也可以间接地帮助您提高数据库的性能。

# html - Javascript禁用最佳实践？

> ID：610931
> 
> 赞同：9
> 
> 时间：2009-03-04T14:58:55.240
> 
> 标签：html, cross-browser, javascript

如果用户禁用了 Javascript，我想知道是否有人优化他们的网页以获得一些友好的行为。在这种情况下是否有任何技巧可以提供一些伪脚本行为？我说的是基本的东西，比如在新窗口中打开链接。我想如果没有 Javascript，你仍然可以做很多事情。在某些情况下，拥有可以依赖的某些功能的页面可能会很方便。有什么做法吗？

编辑：到目前为止很好的答案！人们会介意包含一些示例代码（来吧，HTML 太简单了！），因为我认为我还没有在 SO 上看到过这样的问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-04T15:02:46.527

我有时会做的是将需要 Javascript 的功能设置为不显示，然后使用 Javascript 使它们显示。这样，没有 Javascript 的人就不会看到他们无法使用的功能。然后将替代功能放入`<noscript>`标签中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-04T15:43:37.380

要在新窗口中打开链接，您可以使用 target="_blank"

```
<a href="http://www.google.com" target="_blank">Google</a> 
```

在我工作的地方，我们使用登录页面来确保（在一定程度上）他们在进入应用程序之前启用了 Javascript...

```
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <title>Please Wait...</title>
  </head>
  <body>
    <h1>Please Wait....</h1>
    <noscript><h1>You need a JavaScript-enabled browser to use this application!</h1></noscript>
    <script type="text/javascript">
      <!--
        location.href = "FrontPage.aspx";
      // -->
    </script>
  </body>
</html> 
```

此外，我经常对[CSS 的强大功能](http://www.cssplay.co.uk/menu/)感到惊讶。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T15:38:29.547

Stackoverflow 很好地处理了这个问题。该网站完全可以在没有 Javascript 的情况下使用，可以提出问题并回答问题。投票等高级功能不起作用。

您必须在您愿意花费的时间使网站在没有 Javascript 的情况下可用，以及必须工作的功能数量之间找到一个折衷方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T16:17:14.727

“我想你仍然可以在没有 Javascript 的情况下做很多事情” - 有趣的是，不久前我们在没有 javascript 的情况下做了*所有事情。*

最好的方法是所谓的“渐进增强”。原则是制作一些无需 JavaScript 即可工作的东西，然后通过将 JavaScript 绑定到对象来对附加行为进行“分层”。像 jQuery 这样的库使这变得简单，因为它们支持 CSS 样式的选择器。这样你就可以像应用 CSS 一样应用 JS 行为（好吧，有点夸张）。

需要考虑一下什么是好的基线以及应该如何更改页面。

通常，真正的额外工作是在服务器端，您可能必须拥有多个请求处理系统。在一个小小的回应中解决这个问题有点大！

此外，值得考虑的是用户不使用 JavaScript 的原因和原因。 如果您有兴趣[，这是我不久前写的关于该主题的内容。](http://blogs.conchango.com/marcusalexander/archive/2008/09/18/who-are-the-non-javascript-users-anyway.aspx)

**一个例子？** 拿一些简单的东西，例如。当用户将鼠标悬停在表单字段上时，您希望通过表单字段显示漂亮的“工具提示”。在 HTML 中，这些可以（例如）标记为段落：

```
<label for="username">User name</label><input type="text" id="username" />
<p>Username must be between 6-8 characters</p> 
```

对于非 JS 用户，提示可以简单地显示为一个漂亮的段落。所以你用 CSS 来设置它的样式。为 JS 用户提供额外的 CSS，默认隐藏段落。所以：2套CSS，一套覆盖另一套。

非JS：

```
form p {
    margin: 10px 0 0 0;
    border-bottom: 1px solid grey;
} 
```

js：

```
form p {
    position: absolute; display: none;
    width: 180px;
    background-image: url(nice-bubble.gif);
    padding: 10px;
} 
```

如何在 JS/非 JS 情况下应用 CSS 取决于您。有很多选择。就我个人而言，我喜欢在 CSS 中为 JS 编写代码，并在标签中有一个 noscript.css 变体（即向后工作）。这不是有效的 XHTML，但效果很好。

然后，有一些 JS 来查找元素并管理工具提示的显示代码。例如：

```
$(document).ready(function() {
    $('form input').focus(function() {...display paragraph...});
    // etc;
}) 
```

那是假代码，但你明白了。您最终得到的是 1 组 HTML，带有 2 个演示文稿和其他行为，并且没有 JS 纠缠在您的 HTML 本身中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-04T15:02:25.467

您可以使用 <noscript> 标签创建超链接，目标为 _blank 以打开新窗口。

这对 SEO 也有好处，因此像 Google 和 Yahoo! 这样的搜索引擎！可以识别和抓取您网页中的链接。

<noscript> 也可以为那些禁用 js 的浏览器提供正常的功能。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-04T16:04:31.650

当您使用 Javascript 从链接打开窗口时，可以将其设置为透明，以便在禁用 Javascript 时返回到链接的原始行为：

```
<a href="http://www.guffa.com" target="_blank" onclick="window.open(this.href,this.target,'width=900,height=700');return false;">Guffa</a> 
```

如果启用了 Javascript，onclick 事件将捕获点击并打开一个窗口，然后它从事件中返回 false，以便不跟随链接。如果 Jasvascript 被禁用，将改为跟随链接。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T21:17:48.870

禁用 Javascript 的人也可能会修剪 CSS、Java 和其他“演示”功能，以节省低功率浏览器的处理能力。（例如，网络电话或较旧型号的计算机。）您可以通过向服务器添加简单的功能来缓解这种情况，就像他们在 CGI 时代所做的那样（[此处为随机介绍](http://hoohoo.ncsa.uiuc.edu/cgi/intro.html)）。在这种情况下，您的服务器可以将非 JS 用户重定向到 GET/POST 页面版本。我也会使响应尽可能简单和朴素，因为您可能会输出到一个小屏幕。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-04T21:27:24.293

jQuery really helps. A lot of the time with big JavaScript plugins, (tabs, tooltips, etc...) you write your markup in a very semantic way.

Example: The tabs plug-in requires that you create anchored divs, i.e.

```
<a href="#Preferences">Preferences</a>
<a href="#Tools">Tools</a>
<div id="Preferences">
   blah
</div>
<div id="Tools">
   bar
</div> 
```

This makes sense semantically, and without the tabs plug-in, you get some functionality. When you have javascript and jquery-tabs enabled, though, you get a really nice, rich interface.

This is really just progressive enhancement, as some others have noted. Write semantic markup, enhance it with CSS, then enhance it with Javascript. You should end up with something that works for everybody, even lynx users.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-04T15:45:44.193

[这是一个问题](https://stackoverflow.com/questions/373818/whats-with-those-do-not-use-javascript-people/374122#374122)（[和另一个](https://stackoverflow.com/questions/155615/is-it-reasonable-to-assume-my-visitors-have-javascript-enabled)问题），它对构建一个优雅地处理禁用 JavaScript 的站点有很多（不同的）意见。

# sql-server - 如何使用 TOP 检索查询的总行数

> ID：610932
> 
> 赞同：5
> 
> 时间：2009-03-04T14:58:56.707
> 
> 标签：sql-server, count, pagination, aggregate

我有一个 SQL Server 2008 查询

```
SELECT TOP 10 *
FROM T
WHERE ...
ORDER BY ... 
```

我还想获得总行数。obious的方法是进行第二次查询

```
SELECT COUNT(*)
FROM T
WHERE ...
ORDER BY ... 
```

有没有有效的方法？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T15:07:40.960

你想要第二个查询吗？

```
SELECT TOP 10
    *, foo.bar
FROM
    T
    CROSS JOIN
    (SELECT COUNT(*) AS bar FROM T WHERE ...) foo
WHERE
    ...
ORDER BY
    ... 
```

或者

```
DECLARE @bar int
SELECT @bar = COUNT(*) AS bar FROM T WHERE ...
SELECT TOP 10
    *, @bar
FROM
    T
    CROSS JOIN
    (SELECT COUNT(*) AS bar FROM T WHERE ...) foo
WHERE
    ...
ORDER BY
    ... 
```

或（编辑：使用 WITH）

```
WITH cTotal AS
(
    SELECT COUNT(*) AS bar FROM T WHERE ...)
)
SELECT TOP 10
    *, cTotal .bar
FROM
    T
WHERE
    ...
ORDER BY
    ... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-07-27T22:09:16.460

这个答案中的内容似乎有效：

[https://stackoverflow.com/a/19125458/16241](https://stackoverflow.com/a/19125458/16241)

基本上你做一个：

```
SELECT top 100 YourColumns, TotalCount = Count(*) Over()
From YourTable
Where SomeValue = 32 
```

TotalCount 将具有总行数。它虽然列在每一行。

When I tested this the query plan showed the table only being hit once.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T15:01:30.507

也从第二个查询中删除 ORDER BY 子句。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T15:03:27.710

不。

`SQL Server`不保存`COUNT(*)`在元数据中`MyISAM`，它每次都计算它。

**更新：**如果您需要估算，可以使用统计元数据：

```
SELECT  rows
FROM    dbo.sysindexes
WHERE   name = @primary_key, 
```

`@primary_key`您的表的主键名称在哪里。

这将返回`COUNT(*)`上次统计更新的数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T15:17:01.517

```
SELECT     TOP (2) *,
           (SELECT COUNT(*) AS Expr1 FROM T) AS C
FROM         T 
```

# c++ - 为什么要使用'extern "C++"'？

> ID：610934
> 
> 赞同：77
> 
> 时间：2009-03-04T14:59:39.013
> 
> 标签：c++, c

在[本文](http://msdn.microsoft.com/en-us/library/0603949d(VS.80).aspx)中，关键字 extern 后面可以跟“C”或“C++”。为什么要使用'extern "C++"'？实用吗？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-03-04T15:02:45.543

语言允许：

```
extern "C" {
  #include "foo.h"
} 
```

如果 foo.h 包含需要 C++ 链接的内容怎么办？

```
 void f_plain(const char *);
    extern "C++" void f_fancy(const std::string &); 
```

这就是让链接器满意的方式。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-04T15:10:42.670

没有真正的理由使用`extern "C++"`. 它只是明确了作为隐式默认值的链接。如果您有一个类，其中某些成员具有外部“C”链接，您可能希望明确声明其他成员是外部“C++”。

请注意，C++ 标准在语法上定义`extern "anystring"`. 它只赋予`extern "C"`和正式的含义`extern "C++"`。编译器供应商可以自由定义`extern "Pascal"`，甚至可以自由定义`extern "COM+"`。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-04T15:20:46.733

我不确定你为什么需要这样做，但根据 Sun 的[这篇](http://www.astro.louisville.edu/moore/software/xmccd/archive/xmccd-4.2.1/xmccd-4.2.1/docs/cpp/mixing_c_and_cpp.txt)文章，你可以在 extern "C" 块内使用 extern "C++" 来指定一组 "C" 函数中的某些函数具有本机 C++ 链接。

```
extern "C" {
    void f();             // C linkage
    extern "C++" {
        void g();         // C++ linkage
        extern "C" void h(); // C linkage
        void g2();        // C++ linkage
    }
    extern "C++" void k();// C++ linkage
    void m();             // C linkage
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-04T15:16:33.653

两种猜测：

*   如果你在一个`extern "C"`块中，你可以通过指定一个嵌套的`extern "C++"`.
*   它保留`C++`链接，因为它是定义 C++ 的文档。`C++`谁比语言本身更适合定义语言联系。它还提供了完整性。与 相同的处理`signed/unsigned`。

阅读[这个](https://stackoverflow.com/questions/592160/static-vs-extern-c/592205#592205)解释`extern "LanguageName"`（即GCC有`extern "Java"`）的答案。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-11-12T15:49:43.897

外部“C”被许多人回答。extern "C++" 的用例是在 C 函数中调用 C++ 库函数时。相关的子用例是将 C++ 库与具有主函数的 C 源代码链接时。查看此[wiki 页面](http://en.wikipedia.org/wiki/Compatibility_of_C_and_C++#Linking_C_and_C.2B.2B_code)以获取更多详细信息：

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-04T15:03:47.820

C 和 C++ 使用不同的[名称修饰规则](http://en.wikipedia.org/wiki/Name_mangling)。本质上，extern "C" 告诉 C++ 编译器将函数命名为 C 命名的函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T15:11:53.883

这指定要使用的链接约定。大多数语言都知道如何与“C”样式函数链接。

在两种情况下你需要这个：

*   AC - 或其他语言 - 程序调用用 C++ 编写的函数
*   调用用 C 编写的函数的 C++ 程序

例子 ：

```
// declared in function.h
void f1(void); 
```

您的 C 代码 - 实际上其他语言能够与 C 函数链接 - 将无法链接到它，因为对象表中的名称将使用 C++ 约定。

如果你写

```
extern "C" void f1(void); 
```

现在链接有效，因为它使用 C 约定。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T15:17:41.233

我使用 extern "C" 的 #1 原因是为了避免 C++ 的名称修改规则。如果您使用 .Net 语言并希望 PInvoke 进入特定的本机函数，这一点非常重要。这样做的唯一方法是禁用名称修改。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-09T13:55:10.447

回答第二个问题，“实用吗？”：

在标准头文件（如`<cmath>`.

想象一个只有头文件的库 Xh，它是用 C++ 和 C 的公共子集编写的，旨在用于两种语言。为了 C++ 用户的利益，Xh 包括`<cmath>`，而不是`<math.h>`. 不过，这对 C 用户来说是行不通的，如果作者没有把`<cmath>`所有东西都夹在`extern "C++" {`...中`}`。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-04T15:03:40.767

简短的回答是您可以使用 extern C 告诉编译器不要使用名称修饰。这意味着您可以将同一项目中的 C 和 C++ 代码链接在一起。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-03-04T15:09:00.537

extern "C" 用于表示 C++ 函数应该具有 C 链接。这意味着依赖于实现，但通常它会关闭 C++ 名称修饰（以及因此重载和严格的类型检查）。当你有一个想要从 C 代码调用的 C++ 函数时，你可以使用它：

```
extern "C" void Foo();   // can be called easily from C 
```

至于 extern "C++"，我从未在实际代码中见过它，尽管 C++ 标准允许这样做。我想这是一个无操作。

# asp.net - ASP.Net 缓存是否在不同用户会话之间共享？

> ID：610938
> 
> 赞同：11
> 
> 时间：2009-03-04T15:00:19.543
> 
> 标签：asp.net, caching

如果我执行以下操作，则在页面中：

> 缓存["key"] = myObject;

该缓存对象是否可用于其他用户的请求？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-04T15:02:52.533

是的。缓存是应用程序级别的，所有用户都在同一个应用程序中。

如果您需要每用户缓存，您可以使用会话，但这并不完全相同。缓存允许框架以与会话不同的方式自动使项目过期。如果您希望基于每个用户的缓存行为（不一定是一个好主意），您可以将用户的 ID 构建到主缓存的密钥的一部分中。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-04T15:06:37.140

是的，它适用于同一服务器上的所有用户。但是，如果您正在运行一个场，则它仅对使用将数据添加到缓存的服务器的用户可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T20:30:10.163

缓存适用于每个 AppDomain。像 web Applicaiton 这样的单个应用程序通常保留在单个 AppDomain 中。但是缓存不能在 Web 应用程序和 Web 服务之间共享。

# php - 在没有 libxml2 的情况下安装 PHP 5

> ID：610940
> 
> 赞同：7
> 
> 时间：2009-03-04T15:00:45.330
> 
> 标签：php, libxml2

我正在尝试将 PHP 5 的副本安装到学校计算机上的主目录中。问题是，每当我尝试时，它都会抱怨我的 libxml2 副本太旧而无法工作。

有什么方法可以在**不**升级 libxml2 的情况下安装它，因为我没有升级权限。

有什么建议么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-04T15:29:56.897

或者，您可以在您的主目录中安装 libxml 并通过配置您安装它的位置，即

```
--with-libxml-dir=<your local install> 
```

安装 libxml 时，您只需使用`--prefix=`configure 选项来指示您不想进行系统安装。

假设您编译了 cli 客户端（并且当前用户和 apache 用户的 lib 搜索路径相同），您检查是否链接了正确的 lib：

```
# ldd /usr/bin/php
linux-vdso.so.1 =>  (0x00007ffff71ff000)
libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00000030f3c00000)
libedit.so.0 => /usr/lib64/libedit.so.0 (0x00000030e8000000)
libncurses.so.5 => /lib64/libncurses.so.5 (0x00000030f7400000)
libgmp.so.3 => /usr/lib64/libgmp.so.3 (0x00000030e7800000)
libbz2.so.1 => /lib64/libbz2.so.1 (0x00000030f7800000)
libz.so.1 => /lib64/libz.so.1 (0x00000030e6c00000)
libpcre.so.0 => /lib64/libpcre.so.0 (0x00000030f9400000)
librt.so.1 => /lib64/librt.so.1 (0x00000030e7000000)
libm.so.6 => /lib64/libm.so.6 (0x00000030e5c00000)
libdl.so.2 => /lib64/libdl.so.2 (0x00000030e6400000)
libnsl.so.1 => /lib64/libnsl.so.1 (0x00000030f6800000)
libxml2.so.2 => /usr/lib64/libxml2.so.2 (0x00000030f2400000))
libssl.so.10 => /usr/lib64/libssl.so.10 (0x00000030f3000000)
libcrypto.so.10 => /usr/lib64/libcrypto.so.10 (0x00000030eb400000)
libc.so.6 => /lib64/libc.so.6 (0x00000030e6000000)
libresolv.so.2 => /lib64/libresolv.so.2 (0x00000030e7c00000)
libfreebl3.so => /lib64/libfreebl3.so (0x00000030f3800000)
libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00000030f7c00000)
libpthread.so.0 => /lib64/libpthread.so.0 (0x00000030e6800000)
/lib64/ld-linux-x86-64.so.2 (0x00000030e5800000) 
```

libxml 列在库列表的中间。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-04T15:07:26.267

如果您不需要 xml 支持，只需按照[本页](http://php.mirrors.ilisys.com.au/manual/en/configure.php)所述禁用它：

```
--disable-libxml --disable-dom --disable-simplexml --disable-xml --disable-xmlreader --disable-xmlwriter --without-pear 
```

另一方面，您可以尝试编译较新版本的 libxml 而无需安装它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-04T15:07:08.043

[在PHP 配置文档](http://php.mirrors.ilisys.com.au/manual/en/configure.php)的讨论中有一些关于这个问题的讨论。你可以禁用 XML 特性来避免这些问题，但是你会失去很多有用的特性： `--disable-libxml --disable-dom --disable-simplexml --disable-xml --disable-xmlreader --disable-xmlwriter --without-pear`

大多数评论强烈建议这是一个坏主意。我建议尝试弄清楚如何升级 xmllib。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-26T00:53:23.050

安装[xmltools](http://www.phpclasses.org/package/7224-PHP-Parse-and-validate-XML-documents.html)怎么样？

# sql - 如何在没有 ORDER BY 的情况下对 UNION 中的条目进行排序？

> ID：610945
> 
> 赞同：20
> 
> 时间：2009-03-04T15:01:31.803
> 
> 标签：sql, sql-order-by, union

我如何确定我的结果集会有`a`第一和`b`第二？这将帮助我解决一个棘手的订购问题。

这是我正在做的一个简化示例：

```
SELECT a FROM A LIMIT 1 
UNION 
SELECT b FROM B LIMIT 1; 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-04T15:09:23.563

```
SELECT col
FROM 
   (
       SELECT a col, 0 ordinal FROM A LIMIT 1
       UNION ALL
       SELECT b, 1 FROM B LIMIT 1
   ) t
ORDER BY ordinal 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-04T15:08:17.200

我不认为顺序是有保证的，至少在所有 DBMS 中都没有。

我过去为控制 UNION 中的顺序所做的工作是：

```
(SELECT a, 0 AS Foo FROM A LIMIT 1)
UNION
(SELECT b, 1 AS Foo FROM B LIMIT 1)
ORDER BY Foo 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-04T15:11:45.927

您的结果集`UNION`将消除不同的值。

我在文档中找不到任何证据，但根据`10`多年的经验，我可以说这`UNION ALL`确实保持了秩序，至少在`Oracle`.

但是，如果您正在建造核电站或类似的东西，请不要依赖这个。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-04T15:05:49.890

不，SQL 查询中的结果顺序**仅**由 ORDER BY 子句控制。在某些情况下，您可能碰巧看到没有 ORDER BY 子句的有序结果，但这是偶然的（例如，优化器当前查询计划的副作用）并且不能保证。

棘手的订购问题是什么？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-04T15:05:37.707

我知道对于甲骨文来说，没有办法保证哪个会在没有订单的情况下先出来。问题是，如果您尝试它，即使在大多数情况下运行它，它也可能以正确的顺序出现。但是一旦你在生产中依赖它，它就会出错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-04T15:09:22.080

我本来不会想到的，因为数据库很可能需要为 UNION 执行 ORDER BY。

UNION ALL 的行为可能不同，但 YMMV。

* * *

## 回答 #7

> 赞同：-6
> 
> 时间：2009-03-04T15:11:34.307

简短的回答是肯定的，你会得到 A 然后 B。

# haskell - 您是否发现仍然需要可以更改的变量，如果需要，为什么？

> ID：610956
> 
> 赞同：33
> 
> 时间：2009-03-04T15:03:21.923
> 
> 标签：haskell, variables, functional-programming, ssa, modern-languages

我听到的反对函数式语言的一个论点是，单一赋值编码太难了，或者至少比“普通”编程困难得多。

但是通过我的代码，我意识到我真的没有很多（任何？）使用模式，如果你用一种相当现代的语言编写的话，这些模式不能用单一的赋值形式来编写。

那么在一次调用范围内变化的变量的用例是什么？请记住，在这种情况下，循环索引、参数和其他在调用*之间*变化的范围绑定值不是多重赋值（除非您出于某种原因*必须*在正文中更改它们），并假设您正在编写一些东西远远高于汇编语言级别，您可以在其中编写诸如

```
values.sum 
```

或（如果未提供总和）

```
function collection.sum --> inject(zero, function (v,t) --> t+v ) 
```

和

```
x = if a > b then a else b 
```

或者

```
n = case s 
  /^\d*$/ : s.to_int
  ''      : 0
  '*'     : a.length
  '?'     : a.length.random
  else    fail "I don't know how many you want" 
```

当您需要时，并有列表推导、地图/收集等可用。

您是否发现在这样的环境中您仍然想要/需要可变变量，如果是，那是为了什么？

澄清一下，我不是要求背诵对 SSA 表格的反对意见，而是要求这些反对意见适用的具体示例。我正在寻找带有可变变量的清晰简洁的代码，没有它们就无法编写。

到目前为止我最喜欢的例子（以及我期望的最好的反对意见）：

1.  Paul Johnson 的[Fisher-Yates 算法](https://stackoverflow.com/questions/610956/do-you-find-you-still-need-variable-you-can-change-and-if-so-why/622128#622128)答案，当您包含大 O 约束时，它非常强大。但是，正如 catulahoops 指出的那样，big-O 问题与 SSA 问题无关，而是与可变数据类型有关，并且将这些放在一边，算法可以在 SSA 中相当清楚地编写：

    ```
     shuffle(Lst) ->
         array:to_list(shuffle(array:from_list(Lst), erlang:length(Lst) - 1)).
     shuffle(Array, 0) -> Array;
     shuffle(Array, N) ->
         K = random:uniform(N) - 1,
         Ek = array:get(K, Array),
         En = array:get(N, Array),
         shuffle(array:set(K, En, array:set(N, Ek, Array)), N-1). 
    ```

2.  jpalecek 的[多边形面积](https://stackoverflow.com/questions/610956/do-you-find-you-still-need-variable-you-can-change-and-if-so-why/622057#622057)示例：

    ```
    def area(figure : List[Point]) : Float = {
      if(figure.empty) return 0
      val last = figure(0)
      var first= figure(0)
      val ret = 0
      for (pt <- figure) {
        ret+=crossprod(last - first, pt - first)
        last = pt
      }
      ret
    } 
    ```

    这可能仍然写成：

    ```
    def area(figure : List[Point]) : Float = {
        if figure.length < 3
            0
          else
            var a = figure(0)
            var b = figure(1)
            var c = figure(2)
            if figure.length == 3
                magnitude(crossproduct(b-a,c-a))
              else 
                foldLeft((0,a,b))(figure.rest)) { 
                   ((t,a,b),c) => (t+area([a,b,c]),a,c)
                   } 
    ```

    或者，由于有些人反对这个公式的密度，它可以被改写：

    ```
    def area([])    = 0.0   # An empty figure has no area
    def area([_])   = 0.0   # ...nor does a point
    def area([_,_]) = 0.0   # ...or a line segment
    def area([a,b,c]) =     # The area of a triangle can be found directly
        magnitude(crossproduct(b-a,c-a))
    def area(figure) =      # For larger figures, reduce to triangles and sum
        as_triangles(figure).collect(area).sum

    def as_triangles([])      = []  # No triangles without at least three points
    def as_triangles([_])     = []
    def as_triangles([_,_])   = []
    def as_triangles([a,b,c | rest) = [[a,b,c] | as_triangles([a,c | rest])] 
    ```

3.  Princess 关于用不可变结构实现 O(1) 队列的困难的观点很有趣（并且很可能为一个令人信服的例子提供基础），但正如所述，它基本上是关于数据结构的可变性，而不是直接关于多重分配问题.

4.  我对埃拉托色尼筛法的答案很感兴趣，但不相信。在他引用的论文中给出的合适的 big-O，提取尽可能多的素数生成器在使用或不使用 SSA 的情况下看起来都不容易正确实现。

* * *

嗯，谢谢大家的尝试。由于大多数答案要么是 1）基于可变数据结构，而不是基于单一赋值，以及 2）它们是关于单一赋值形式的，因此本领域技术人员很容易反驳，我将从我的演讲和/或重组中划出界限（也许可以将其作为讨论主题作为备用，以防万一我在时间用完之前用完了单词）。

再次感谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-07T16:57:12.903

我遇到的最困难的问题是洗牌。[Fisher-Yates](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle)算法（有时也称为 Knuth 算法）涉及遍历列表，将每个项目与随机的其他项目交换。该算法是 O(n)，众所周知并且长期以来被证明是正确的（在某些应用程序中是一个重要属性）。但它需要可变数组。

这并不是说您不能在函数式程序中进行改组。Oleg Kiselyov 曾[写过这](http://okmij.org/ftp/Haskell/perfect-shuffle.txt)方面的文章。但如果我正确理解他，功能改组是 O(n . log n) 因为它通过构建二叉树来工作。

当然，如果我需要在 Haskell 中编写 Fisher-Yates 算法，我只需将它放在[ST monad](http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Monad-ST.html)中，它可以让您将涉及[可变数组](http://www.haskell.org/ghc/docs/latest/html/libraries/array/Data-Array-ST.html)的算法封装在一个不错的纯函数中，如下所示：

```
-- | Implementation of the random swap algorithm for shuffling.  Reads a list
-- into a mutable ST array, shuffles it in place, and reads out the result
-- as a list.

module Data.Shuffle (shuffle) where

import Control.Monad
import Control.Monad.ST
import Data.Array.ST
import Data.STRef
import System.Random

-- | Shuffle a value based on a random seed.
shuffle :: (RandomGen g) => g -> [a] -> [a]
shuffle _ [] = []
shuffle g xs = 
    runST $ do
      sg <- newSTRef g
      let n = length xs
      v <- newListArray (1, n) xs
      mapM_ (shuffle1 sg v) [1..n]
      getElems v

-- Internal function to swap element i with a random element at or above it.
shuffle1 :: (RandomGen g) => STRef s g -> STArray s Int a -> Int -> ST s ()
shuffle1 sg v i = do
  (_, n) <- getBounds v
  r <- getRnd sg $ randomR (i, n)
  when (r /= i) $ do
    vi <- readArray v i
    vr <- readArray v r
    writeArray v i vr
    writeArray v r vi

-- Internal function for using random numbers
getRnd :: (RandomGen g) => STRef s g -> (g -> (a, g)) -> ST s a
getRnd sg f = do
  g1 <- readSTRef sg
  let (v, g2) = f g1
  writeSTRef sg g2
  return v 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-04T15:18:15.210

如果您想进行学术论证，那么在技术上当然没有必要多次分配变量。证明是所有代码都可以用[SSA（单一静态分配）](http://en.wikipedia.org/wiki/Static_single_assignment_form)形式表示。事实上，这是对多种静态和动态分析最有用的形式。

同时，我们并非都以 SSA 形式编写代码是有原因的：

1.  以这种方式编写代码通常需要更多语句（或更多行代码）。简洁是有价值的。
2.  它几乎总是效率较低。是的，我知道您在谈论高级语言——一个公平的范围界定——但即使在远离汇编的 Java 和 C# 世界中，速度也很重要。很少有应用程序与速度无关。
3.  这并不容易理解。尽管 SSA 在数学意义上“更简单”，但它更抽象于常识，这在现实世界的编程中很重要。如果你必须非常聪明才能理解它，那么它在整个编程中就没有立足之地。

即使在上面的示例中，也很容易戳洞。接受你的`case`陈述。如果有一个决定是否`'*'`允许的管理选项，以及一个单独的决定是否允许的选项`'?'`怎么办？此外，整数大小写不允许为零，除非用户具有允许它的系统权限。

这是一个带有分支和条件的更真实的示例。你能把它写成一个单一的“声明”吗？如果是这样，您的“陈述”真的与许多单独的陈述不同吗？如果没有，您需要多少个临时只写变量？这种情况是否比只有一个变量好得多？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-05T00:12:51.900

我从来没有发现过这样的案例。虽然您总是可以发明新名称，例如转换为 SSA 形式，但我实际上发现每个值都有自己的名称是很容易和自然的。像 Haskell 这样的语言给了我很多关于命名哪些值的选择，以及两个不同的位置来放置名称绑定（`let`和`where`）。我发现单一作业形式很自然，一点也不难。

我偶尔会错过能够在堆上拥有指向可变对象的指针。但是这些东西没有名字，所以不是同一个反对。（而且我还发现，当我在堆上使用可变对象时，我往往会写更多的错误！）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-10T17:03:53.830

我认为您会发现最高效的语言允许您混合函数式和命令式风格，例如 OCaml 和 F#。

在大多数情况下，我可以编写很简单的代码，即“将 x 映射到 y，将 y 减少到 z”。在 95% 的情况下，函数式编程简化了我的代码，但在一个领域，不变性表现出了它的优势：

**易于实现和不可变堆栈与不可变队列之间的巨大差异。**

堆栈很容易，并且与持久性很好地融合在一起，队列很荒谬。

不可变队列的最[常见实现](http://blogs.msdn.com/ericlippert/archive/2007/12/10/immutability-in-c-part-four-an-immutable-queue.aspx)使用一个或多个内部堆栈和堆栈轮换。好处是这些队列*大部分时间*都在 O(1) 中运行，但有些操作会在 O(n) 中运行。如果您在应用程序中依赖持久性，那么原则上每个操作都可能在 O(n) 中运行。当您需要实时（或至少一致）性能时，这些队列并不好。

Chris Okasaki 在[他的书中](https://rads.stackoverflow.com/amzn/click/com/0521663504)提供了不可变队列的实现，他们使用惰性来实现所有操作的 O(1)。它是一个非常聪明、相当简洁的实时队列实现——但它需要深入了解其底层实现细节，而且它仍然比不可变堆栈复杂一个数量级。

相反，我可以使用可变链表编写堆栈和队列，这些链表在所有操作中以恒定时间运行，生成的代码将非常简单。

* * *

关于多边形的面积，很容易将其转换为函数形式。假设我们有一个像这样的 Vector 模块：

```
module Vector =
    type point =
        { x : float; y : float}
        with
            static member ( + ) ((p1 : point), (p2 : point)) =
                { x = p1.x + p2.x;
                  y = p1.y + p2.y;}

            static member ( * ) ((p : point), (scalar : float)) =
                { x = p.x * scalar;
                  y = p.y * scalar;}

            static member ( - ) ((p1 : point), (p2 : point)) = 
                { x = p1.x - p2.x;
                  y = p1.y - p2.y;}

    let empty = { x = 0.; y = 0.;}
    let to_tuple2 (p : point) = (p.x, p.y)
    let from_tuple2 (x, y) = { x = x; y = y;}
    let crossproduct (p1 : point) (p2 : point) =
        { x = p1.x * p2.y; y = -p1.y * p2.x } 
```

我们可以使用一些元组魔法来定义我们的区域函数：

```
let area (figure : point list) =
    figure
    |> Seq.map to_tuple2
    |> Seq.fold
        (fun (sum, (a, b)) (c, d) -> (sum + a*d - b*c, (c, d) ) )
        (0., to_tuple2 (List.hd figure))
    |> fun (sum, _) -> abs(sum) / 2.0 
```

或者我们可以使用叉积代替

```
let area2 (figure : point list) =
    figure
    |> Seq.fold
        (fun (acc, prev) cur -> (acc + (crossproduct prev cur), cur))
        (empty, List.hd figure)
    |> fun (acc, _) -> abs(acc.x + acc.y) / 2.0 
```

我没有发现任何一个功能不可读。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-08T09:41:50.790

该混洗算法使用单个赋值来实现是微不足道的，实际上它与将迭代重写为尾递归的命令式解决方案完全相同。（Erlang，因为我可以比 Haskell 更快地编写它。）

```
 shuffle(Lst) ->
     array:to_list(shuffle(array:from_list(Lst), erlang:length(Lst) - 1)).

 shuffle(Array, 0) -> Array;
 shuffle(Array, N) ->
     K = random:uniform(N) - 1,
     Ek = array:get(K, Array),
     En = array:get(N, Array),
     shuffle(array:set(K, En, array:set(N, Ek, Array)), N-1). 
```

如果这些数组操作的效率是一个问题，那么这是一个关于可变数据结构的问题，与单次赋值无关。

你不会得到这个问题的答案，因为没有例子存在。这只是对这种风格的熟悉程度的问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-04T17:28:57.563

回应杰森——

```
function forbidden_input?(s)
    (s = '?' and not administration.qmark_ok) ||
    (s = '*' and not administration.stat_ok)  ||
    (s = '0' and not 'root node visible' in system.permissions_for(current_user))

n = if forbidden_input?(s)
    fail "'" + s + "' is not allowed."
  else
    case s
      /^\d*$/ : s.to_int
      ''      : 0
      '*'     : a.length
      '?'     : a.length.random
      else    fail "I don't know how many you want" 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-07T16:15:52.550

我会错过非纯函数式语言的作业。主要是因为它们阻碍了循环的有用性。示例（斯卡拉）：

```
def quant[A](x : List[A], q : A) = {
  var tmp : A=0
  for (el <- x) { tmp+= el; if(tmp > q) return el; }
  // throw exception here, there is no prefix of the list with sum > q
} 
```

这应该计算列表的分位数，注意`tmp`多次分配的累加器。

一个类似的例子是：

```
def area(figure : List[Point]) : Float = {
  if(figure.empty) return 0
  val last = figure(0)
  var first= figure(0)
  val ret = 0
  for (pt <- figure) {
    ret+=crossprod(last - first, pt - first)
    last = pt
  }
  ret
} 
```

主要注意`last`变量。

可以在元组上使用 fold 重写这些示例以避免多次分配，但这实际上无助于可读性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T15:30:04.190

本地（方法）变量当然*不必*分配两次。但即使在函数式编程中重新分配变量也是允许的。它正在*改变*（部分）不允许的值。正如 dsimcha 已经回答的那样，对于非常大的结构（可能位于应用程序的根目录），替换整个结构对我来说似乎不可行。想想看。应用程序的状态最终都包含在应用程序的入口点方法中。如果绝对没有状态可以在不被替换的情况下改变，那么您必须在每次击键时重新启动应用程序。:(

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-07T17:19:24.083

如果您有一个构建惰性列表/树然后再次对其进行缩减的函数，则函数式编译器可能能够使用[deforestation](http://en.wikipedia.org/wiki/Deforestation_(computer_science))对其进行优化。

如果它很棘手，它可能不会。那么你有点不走运，性能和内存明智，除非你可以迭代和使用可变变量。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-09T16:16:58.723

感谢 Church-Turing Thesis，我们知道任何可以用图灵完备语言编写的东西都可以用***任何***图灵完备语言编写。所以，当你开始着手时，如果你足够努力的话，在 Lisp 中没有什么是你在 C# 中做不到的，反之亦然。（更重要的是，无论如何，在大多数情况下，任何一种都会被编译成 x86 机器语言。）

所以，你的问题的答案是：没有这样的情况。所有的情况下，人类更容易用一种范式/语言或另一种来理解——这里的理解容易程度与培训和经验有关。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-18T01:59:13.427

也许这里的主要问题是语言循环的风格。在我们使用递归的语言中，任何在循环过程中发生变化的值都会在再次调用函数时重新绑定。在块中使用迭代器的语言（例如，Smalltalk 和 Ruby 的`inject`方法）往往是相似的，尽管 Ruby 中的许多人仍然会使用`each`可变变量 over `inject`。

另一方面，当您使用`while`and对循环进行编码时，当您可以将多个参数传递给执行循环一次迭代的代码块时，您无法轻松地自动重新绑定变量，因此不可变变量`for`会比较不方便。

在 Haskell 中工作是研究可变变量必要性的一种非常好的方法，因为默认值是不可变的，但可变变量是可用的（如`IORefs`、`MVars`等）。我最近呢，呃，自己也是这样“调查”的，得出了如下结论。

1.  在绝大多数情况下，可变变量不是必需的，没有它们我很高兴。

2.  对于线程间通信，可变变量是必不可少的，原因很明显。（这是 Haskell 特有的；在最低级别使用消息传递的运行时系统当然不需要它们。）但是，这种使用非常少见，因此不必使用函数来读取和写入它们（`readIORef fooRef val`等等）。很大的负担。

3.  我在单个线程中使用了可变变量，因为它似乎使某些事情变得更容易，但后来我后悔了，因为我意识到很难推断存储在那里的值发生了什么。（有几个不同的函数在操纵这个值。）这有点让人大开眼界。在典型的温水锅里的青蛙风格中，我没有意识到 Haskell 让我能够轻松地推理值的使用，直到我遇到了一个我过去如何使用它们的例子.

所以这些天来，我已经相当坚定地站在不可变变量的一边。

由于之前对这个问题的回答混淆了这些东西，我觉得有必要在这里非常有力地指出，这个问题与纯度和函数式编程都是正交的。例如，我认为 Ruby 将受益于具有单赋值局部变量，尽管可能需要对语言进行一些其他更改，例如添加尾递归，以使其真正方便。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-04T15:06:59.823

当您需要对大型数据结构进行小的更改时怎么办？您真的不想每次修改几个元素时都复制整个数组或大类。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-07T15:34:02.667

除了现在你指出来，我还没有真正考虑过这一点。

实际上，我尝试不下意识地使用多个作业。

这是我在python中谈论的一个例子

```
start = self.offset%n
if start:
    start = n-start 
```

以这种方式编写以避免不必要的额外模数或减法。这与 bignum 样式的长整数一起使用，因此它是值得优化的。不过，关于它的事情是它确实是一个单一的任务。

我根本不会错过多项任务。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-13T12:11:18.020

我知道您要求的代码确实显示了可变变量的好处。我希望我能提供它。但正如之前所指出的——没有不能用两种方式表达的问题。尤其是因为您指出 jpalecek 的多边形示例区域可以用折叠算法编写（恕我直言，这更加混乱，并将问题带到不同程度的复杂性）-这让我想知道为什么您要降低可变性所以难的。因此，我将尝试提出共同点以及不可变和可变数据共存的论点。

在我看来，这个问题有点忽略了要点。我知道我们程序员倾向于喜欢干净和简单的东西，但我们有时会错过混合也是可能的。这可能就是为什么在关于不变性的讨论中很少有人采取中间立场的原因。我只是想知道为什么，因为让我们面对现实吧——**不变性是**抽象各种问题的好工具。但有时它是一种**巨大的痛苦**。有时它只是太约束了。仅这一点就让我停下来想一想——我们真的想放松可变性吗？真的是非此即彼吗？难道我们不能达成**一些共同点吗？**不变性什么时候可以帮助我更快地实现我的目标，可变性什么时候可以帮助我实现目标？**哪种解决方案更易于阅读和维护？**（对我来说哪个是最大的问题）

很多这些问题都受到程序员的品味和他们习惯于编程的影响。所以我将关注通常是大多数支持不变性论点的中心的一个方面 - 并行性：

围绕不变性的争论经常被引入并行性。我处理过需要 100 多个 CPU 在合理时间内解决的问题。它教会了我一件非常重要的事情：大多数时候并行处理数据图实际上并不是最有效的并行化方式。它肯定会受益匪浅，但不平衡是该问题空间中的一个真正问题。因此，通常并行处理多个可变图并使用不可变消息交换信息会更有效。这意味着，当我知道图是孤立的，我没有向外界透露它时，我想以我能想到的最简洁的方式对其进行操作。这通常涉及改变数据。但是在对数据进行这些操作之后，我想向全世界开放数据——如果数据是可变的，这就是我通常会有点紧张的地方。因为程序的其他部分可能会破坏数据，状态变得无效，......因为在向世界开放之后，数据通常确实会进入并行世界。

因此，现实世界的并行程序通常具有在确定的单线程操作中使用数据图的区域 - 因为它们根本不为外界所知 - 以及它们可能涉及多线程操作的区域（希望只是提供未被操纵的数据） . 在这些多线程部分中，我们从不希望它们改变——处理过时的数据比处理不一致的数据更好。这可以通过不变性的概念来保​​证。

这让我得出了一个简单的结论：对我来说真正的问题是，我所熟悉的编程语言中没有一种允许我说：**“在这一点之后，整个数据结构将是不可变的”**和**“给我一个可变的副本这个不可变的数据结构在这里，请验证只有我可以看到可变副本”**。现在我必须自己通过翻转只读位或类似的东西来保证它。如果我们可以让编译器支持它，它不仅可以保证我在翻转所述位后没有做任何愚蠢的事情，而且它实际上可以帮助编译器进行以前无法做到的各种优化。另外 - 对于更熟悉命令式编程模型的程序员来说，该语言仍然很有吸引力。

所以总结一下。恕我直言**，程序通常有充分的理由同时使用数据图的不可变和可变表示**。我认为数据在**默认情况下应该是不可变的**，编译器应该强制执行这一点——但我们应该有**私有可变表示的概念**，因为自然存在多线程永远无法到达的领域——并且可读性和可维护性可以受益于更多命令式结构。

# c# - winforms 面板 vs java swing 面板

> ID：610962
> 
> 赞同：1
> 
> 时间：2009-03-04T15:05:26.490
> 
> 标签：c#, java, winforms, swing, jpanel

在 java swing 中，我可以将面板插入面板等，而不必为我的应用程序的每个视图构建一个全新的窗口，或者在删除和添加控件时弄乱。

有一个面板类 sin C# 但是我看不到任何创建“面板表单”的方法，或者基本上只是表单设计器中的一个表单，即面板及其内容。

那我该怎么做，并像使用 java swing 一样工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T15:20:14.377

通常我只是将不同的表单停靠在彼此之间，在父窗口上将 IsMdiContainer 属性设置为 true。然后我使用以下函数创建我停靠的子表单：

```
static class FormUtil
{
    static public void showForm(Form sender, Control reciever)
    {
        sender.ControlBox = false;
        sender.FormBorderStyle = FormBorderStyle.None;
        sender.ShowInTaskbar = false;
        sender.TopLevel = false;
        sender.Visible = true;
        sender.Dock = DockStyle.Fill;

        reciever.Controls.Clear(); //clear panel first
        reciever.Controls.Add(sender);
    }

} 
```

然后，每当我需要将表单停靠在父表单的面板内时，我都会这样做：

```
FormUtil.showForm(new SomeForm(), this.splitContainer1.Panel1); 
```

这允许我将一些表单创建委托给不同的设计师。对我来说就像一个魅力，喜欢听听是否有更好的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-04T15:19:33.507

实际上，您可以使用面板控件并将其 Dock 属性设置为 Fill。这样，您的面板将成为表单的整个画布。然后，您可以根据需要通过代码或表单设计器添加子面板。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T13:36:45.723

用户控件的概念基本上为您提供了类似设计器表面的面板，更不用说您可以创建原子表单（可以重用）并将它们注册为可继承，这样您也可以提供继承。

# c# - 我的 DDD 工厂类中应该使用哪些方法？

> ID：610965
> 
> 赞同：13
> 
> 时间：2009-03-04T15:06:10.573
> 
> 标签：c#, design-patterns, dns, domain-driven-design, factory

我很难理解我的工厂类在我的 DDD 项目中应该做什么。是的，工厂应该用于创建对象，但它到底应该做什么。考虑以下工厂类：

```
 public class ProductFactory
    {
        private static IProductRepository _repository;

        public static Product CreateProduct()
        {
            return new Product();
        }

        public static Product CreateProduct()
        {
            //What else would go here?
        }

        public static Product GetProductById(int productId)
        {
            //Should i be making a direct call to the respoitory from here? 
            Greener.Domain.Product.Product p = _repository.GetProductById(productId);
            return p;
        }
    } 
```

我应该从工厂内直接调用存储库吗？

从数据库中检索数据时，我应该如何管理对象创建？

我需要什么来完成这个课程，我应该有什么其他方法？

我应该使用这个类从域和存储库中创建产品对象吗？

请帮忙！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-04T15:50:59.500

> 我应该从工厂内直接调用存储库吗？

不，不要在检索东西时使用工厂，只有在第一次创建工厂时才使用工厂。

> 从数据库中检索数据时，我应该如何管理对象创建？

如果对象的初始创建需要，则将该数据传递到工厂。

> 我需要什么来完成这个课程，我应该有什么其他方法？

许多工厂甚至不是单独的类，它们只是提供对象创建的方法。如果您觉得它只是要调用无参数构造函数，您可以将工厂方法折叠到另一个类中。

> 我应该使用这个类从域和存储库中创建产品对象吗？

存储库用于获取（在某种意义上创建）现有对象，工厂是您第一次创建对象。

最初，许多工厂除了调用构造函数外不会做太多事情。但是一旦你开始重构和/或创建更大的对象层次结构，工厂就会变得更加相关。

**解释和例子：**

例如，在我正在处理的项目中，我有一个 excel 处理器基类和许多实现该基类的子类。我使用工厂来获取正确的工厂，然后在其上调用方法，不知道返回了哪个子类。（注意：我更改了一些变量名称并删除/更改了很多代码）

处理器基类：

```
public abstract class ExcelProcessor
{
      public abstract Result Process(string ExcelFile);
} 
```

处理器子类之一：

```
public class CompanyAExcelProcessor : ExcelProcessor
{
     public override Result Process(string ExcelFile)
     {
      //cool stuff
     }
} 
```

工厂：

```
 public static ExcelProcessor CreateExcelProcessor(int CompanyId, int CurrentUserId)
 {
      CompanyEnum company = GetCompanyEnum(CompanyId);
      switch (company)
      {
           case CompanyEnum.CompanyA:
                return new CompanyAExcelProcessor();
           case CompanyEnum.CompanyB:
                return new CompanyBExcelProcessor();
           case CompanyEnum.CompanyC:
                return new CompanyCExcelProcessor(CurrentUserId);
           //etc...
      }
 } 
```

用法：

```
ExcelProcessor processor = CreateExcelProcessor(12, 34);
processor.Process(); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T08:54:23.330

注意，实例化一个新对象有两个原因：**创建**它并从数据库中**重新水化它。**

第一种情况由工厂处理。您可以提供多种方法来在工厂上创建对象。工厂方法应该返回有效的对象，因此您可以将参数传递给这些方法以提供所需的信息。

工厂方法也可以根据参数选择实际类型进行实例化。

您不应将其与从数据库中补水混为一谈。这种实例化应该从数据行中获取值并用它实例化对象。我通常将其称为**数据构建器**而不是**工厂**。

主要区别在于工厂将实例化具有新标识的对象，而数据构建器将实例化具有现有标识的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-04T15:39:37.093

您工厂的 Create 方法中应该包含的内容是将一个全新的新对象置于 VALID 状态所必需的。

现在，对于某些对象，这意味着您不会做任何事情，除了这个：

```
public Product Create()
{
   return new Product();
} 
```

但是，您可能有业务规则、默认设置或其他要在创建对象时强制执行的要求。在这种情况下，您可以将该逻辑放入该方法中。

这也是工厂优势的一部分。您现在只有一个地方可以存放该特殊逻辑，并且只有一个地方可以创建新对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T15:20:41.820

我个人会在以下几种情况下使用工厂：

1）其他地方控制着这个工厂返回什么类型的对象（即它可以根据情况返回对象。例如，当我测试时返回一个存根对象，当我不是时返回一个实际的实现（这显然是更多的反转控制/依赖注入问题 - 但如果您还不想将容器添加到项目中））。

2) 我有相当复杂的对象，它们具有容器、依赖项、其他关系等，需要仔细构建它们以避免创建空引用或无意义的引用。例如，如果我有一个 Schedule 对象，我可能需要设置一些开始、结束日期字段 - 如果检索、确定这些日期的逻辑足够复杂，我可能不希望调用类知道它，而只是调用默认工厂方法创建了计划对象。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-04T15:19:38.250

在上面给出的示例中，我对您的工厂和存储库之间的区别有点不清楚。我想知道您是否不应该简单地将 CreateProduct 作为方法添加到存储库中，并使用 DI 将存储库推送到需要它的代码中？如果工厂什么都不*做*，等等......

或者，如果您只是希望它充当全局注册的存储库，可能类似于：

```
public static IFooRepository Default {get;private set;}
public static void SetRepository(IFooRepository repository) {
    Default = repository;
} 
```

（在我看来，在这种情况下将“集合”分开似乎更清楚，但您不必同意）

并让来电者使用`var product = YourFactory.Default.CreateProduct();`等

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T15:22:39.720

@ThinkBeforeCoding - 在@m4bwav 的示例中，工厂从辅助方法获取有效 ID，但它没有在任何地方的持久层中创建新记录。但是，如果我使用数据库自​​动生成的标识列作为我的标识，那么工厂似乎必须调用存储库来进行初始对象创建。你能评论哪种方法是“正确的”吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-27T14:25:34.557

在构建器中，您可以拥有任何需要在实体上强制不变量的逻辑，一个使用 Java 作为开发语言的小例子......

我有一个用户实体，它有一个用户名、一个密码和一个电子邮件，所有属性都是必需的，所以我有：

```
public class User {
    private String username;
    private String password;
    private String email:

    /**
     * @throws IllegalArgumentException if the username is null, the password is null or the
     * email is null.
     */
    public User(final String theUsername, final String thePassword, final String theEmail) {
        Validate.notNull(theUsername);
        Validate.notNull(thePassword);
        Validate.notNull(theEmail);

        this.username = theUsername;
        this.password = thePassword;
        this.email = theEmail;
    }

    // Getters / Setters / equal / hashCode / toString
} 
```

然后我有 UserBuilder：

```
public class UserBuilder {
    private String username;
    private String password;
    private String email;

    public UserBuilder withUsername(final String theUsername) {
        Validate.notNull(theUsername);

        this.username = theUsername;

        return this;
    }

    public UserBuilder withPassword(final String thePassword) {
        Validate.notNull(thePassword);

        this.password = thePassword;

        return this;
    }

    public UserBuilder withEmail(final String theEmail) {
        Validate.notNull(theEmail);

        this.email = theEmail;

        return this;
    }

    public User build() {
        User user = new User(this.username, this.password, this.email);

        return user;
    }
} 
```

您可以像这样使用构建器：

```
UserBuilder builder = new UserBuilder();

try {
    User user = builder.withUsername("pmviva").withPassword("My Nifty Password").withEmail("pmviva@somehost.com").build();
} catch (IllegalArgument exception) {
    // Tried to create the user with invalid arguments
} 
```

工厂的唯一目的是创建对象的有效实例。为了不重复创建和水合代码，您可以让存储库从数据库中查询行集，并将对象的创建委托给传递行集数据的构建器。

希望这可以帮助

谢谢巴勃罗

# html - 查看内的所有链接

> ID：610970
> 
> 赞同：1
> 
> 时间：2009-03-04T15:06:51.570
> 
> 标签：html, css

我正在尝试使每个 h1 标题右侧的“查看全部”链接更小。

```
.view-all a:link,
.view-all a:visited {
    text-size:.5em;
}

<h1>Student Activities <span class="view-all">
<a href="/student_activities/calendar/" title="view all">
view all</a></span></h1> 
```

对于我做错了什么，我们将不胜感激。

这一切都在`<div class="content-body"></div>`

如果有更好的方法可以做到这一点，请告诉我。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T15:08:55.670

改用字体大小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-04T15:09:27.010

该属性是字体大小，而不是文本大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-04T15:11:02.887

```
.view-all a:link,
.view-all a:visited {
    font-size:.5em;
}

<h1>Student Activities <span class="view-all">
<a href="/student_activities/calendar/" title="view all">
view all</a></span></h1> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T15:14:57.417

6 of 1, 1/2 打在另一个我想 - 但你可以`<h1>`用 a 伪造标签，`<span>`然后将链接放在它旁边`<span>`

```
.veiew-all 
{
 font-size:18pt;
}
<div class="content-body">
    <span class="view-all">Sutdent activities</span>
    <a class="link" href="/student_activities/calendar">view all</a>
</div> 
```

不知何故，这对我来说似乎更干净。如果它很糟糕，有人告诉我为什么。

# java - 你能在Java中得到一个变量的先前值吗？

> ID：610976
> 
> 赞同：6
> 
> 时间：2009-03-04T15:08:25.670
> 
> 标签：java, variables

假设方式有一个变量（假设是 String Str）并且 Str 的值以“”开头，然后当一些代码运行时，它被设置为“test”，然后在代码中的其他地方再次更改为“tester”。现在在程序中，我想找出 Str 的先前值是什么。这在Java中可能吗？

所以我是说变量被改变了两次，你想在它第二次改变之前找出 Str 是什么。因此，在上面的示例中，Str 的最新值将是“tester”，但我想找出在此之前的 Str 是什么（假设你不知道它在更改为 tester 之前是什么）在这种情况下，我想成为能够发现 Str 是“测试”。

是否有可能在 Java 中做到这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-04T15:09:15.373

不，这是不可能的，您必须先保存以前的值，然后再更改它以执行您的要求。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-04T15:13:46.437

不是作为语言的母语部分，不。不过，您可以编写一个 setter 来在 String 更改时保存当前（以前的？）值。

```
private String str;
private String prev;

setStr(String s)
{
    prev = str;
    str = s;
} 
```

然后只需为`prev`.

当然，这个解决方案依赖于你**总是**使用 setter 来改变`str`.

此外，正如[deworde](https://stackoverflow.com/questions/610976/can-you-get-the-previous-value-of-a-variable-in-java/611178#611178)指出的那样，如果您的程序不需要这些信息，那么您不应该修改程序来保存它。如果您出于调试目的需要这些信息，您可以在 IDE 的调试器中设置一个监视。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-04T16:33:04.423

简单的回答，不。

但是，您可以使用：

### AOP

AOP 框架，例如[AspectJ](http://www.eclipse.org/aspectj/)可以拦截对变量的赋值。

请参阅[AspectJ 切入点参考](http://www.eclipse.org/aspectj/doc/released/progguide/quick.html#quick-pointcuts)

### [JavaBeans](http://java.sun.com/javase/technologies/desktop/javabeans/index.jsp)属性更改支持

您可以使用标准的 JavaBean setter、getter 来封装您的字段。然后，您可以在 bean 上注册侦听器以侦听属性更改，甚至否决该更改。

有关更多信息，请参阅[JavaBean 规范](http://java.sun.com/javase/technologies/desktop/javabeans/docs/spec.html)。

监听器示例：

```
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.beans.PropertyVetoException;
import java.beans.VetoableChangeListener;

public class MyBeanListener implements PropertyChangeListener,
        VetoableChangeListener {

    @Override
    public void propertyChange(PropertyChangeEvent evt) {
        System.out.printf("Notifed of property changed event: %s => %s%n", evt
                .getOldValue(), evt.getNewValue());

    }

    @Override
    public void vetoableChange(PropertyChangeEvent evt)
            throws PropertyVetoException {
        System.out.printf("Notified of vetoable change event: %s => %s%n", evt
                .getOldValue(), evt.getNewValue());
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-04T15:46:01.680

如果您确实对此有强烈需求，可以使用以下代码：

```
public class Main 
{
    public static void main(final String[] argv) 
    {
        SavedValue<Integer> i;

        i = new SavedValue<Integer>();
        i.set(7);
        System.out.println(i.get());
        System.out.println(i.getOld());
    }
}

class SavedValue<T>
{
    private T oldValue;
    private T value;

    void set(final T val)
    {
        oldValue = value;
        value    = val;
    }

    T get()
    {
        return (value);
    }

    T getOld()
    {
        return (oldValue);
    }
} 
```

也许你可以解释为什么你想要旧的价值？如果我们知道你为什么想要它，我相信我们可以给你更好的答案。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-04T16:45:25.750

你已经得到了两个简单的答案：

*   不，Java 本身不允许这样做
*   您可以使用设置器并实现一种机制来保留旧值

但是到目前为止我还没有看到第三个：

应该可以在 AspectJ 中编写一个触发分配的 Aspect。因此，如果没有实际的 setter，它将具有与 setter 类似的效果。如果您正在使用不想或无法更改的代码，这可能是一个选项。

请注意，虽然 AspectJ 不是 Java，但结果是普通字节码，因此它应该与大多数环境兼容。

当然，您可以使用 CGLIB 来代替 AspectJ。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-04T15:51:18.703

看起来您正在使用它进行调试，对吗？

Visual Studio 或任何体面的调试器都应该允许您在每次设置值时打印该值的跟踪，只需在所有设置值的调用之前和之后放置一个“跟踪点”即可。

您只需更改普通断点的属性以打印语句而不是停止执行。在 VS2005 中，这是通过以下方式完成的：

*   调出断点窗口
*   右键单击断点
*   选择“当击中...”选项。
*   选择“打印信息”并输入信息
*   确保仍选择“继续执行”。

这通常会在调试时显着减慢程序的速度，因此对于时间相关的调试几乎没有用处；但它仍然允许我遵循变量的状态（ABCDFEGH ...）

当然，如果您*确实*想停止执行，只需转储一个正常的断点即可。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-04-13T08:19:12.647

您可以尝试使用堆栈数据结构。它将以正确的顺序保留所有先前的值。您可以实现自己的或使用 java Collections 之一：

```
Deque<Integer> stack = new ArrayDeque<Integer>(); 
```

每次设置变量时，将其放入堆栈中（通过其他答案中提到的 setter 或 AOP）。这样，您将能够访问所有以前的值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-04T15:13:05.753

确实，这是不可能的。您必须创建自己的 String 类，该类具有某种内存来实现这一点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-04T15:15:29.833

除了 Stefan 所说的，我建议使用某种包含所有历史值的 List 结构。

当您想更改值时，只需在列表末尾添加一个新值即可。当你想获取当前值时，只需查看最后一个值即可。如果要查看以前的值，请从列表末尾开始。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-04T15:15:50.207

如果你能找到程序以前的状态，就永远不会有任何垃圾需要收集，程序很快就会耗尽内存。

对于特定变量，您可以使用 LIFO 堆栈。您将推送到堆栈而不是分配。而不是阅读变量，你会偷看。可以检查堆栈的内容以查找历史值。

另一种方法是使用[instrumentation](http://java.sun.com/javase/6/docs/api/java/lang/instrument/package-summary.html)。这使您能够以足够的技巧和耐心重写字节码来做任何您想做的事情。

也许你想退后一点，看看你真正想要实现的目标。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-04T15:18:58.530

我不知道想要这样做的原因，但我猜它是某种调试。

如果您使用的是 eclipse，则可以设置在变量更改时触发的断点。这可能会实现我假设你想要达到的目标。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-07-19T08:06:20.417

你听说过吉夫吗？它允许在调试中向后步进，所以这部分回答了你的问题在这里阅读：[http ://www.cse.buffalo.edu/jive/](http://www.cse.buffalo.edu/jive/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-05-19T08:45:31.927

这实际上可以使用称为历史调试器的东西来实现，它是通过检测字节码来实现的，以便记录对变量的任何分配。

谷歌比尔刘易斯历史调试器就是一个例子。请注意，该软件的大部分都处于您所说的“初始测试版”阶段。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-07-04T14:01:16.293

是的！！更改值时，仅更改特定对象的值。见前：

```
 class Test{
int a=100; //original value 
 Test(int b){
    this.a=b;
 }
 Test(){
 }
void print(){
 System.out.println(a);
}
 public static void main(String args[]){
     Test t=new Test(9);
     Test t2=new Test();
     t.print();      //output: 9
     t2.print();     //output: 100 
 }
} 
```

# opengl - OpenGL：纹理反馈？

> ID：610978
> 
> 赞同：1
> 
> 时间：2009-03-04T15:08:38.837
> 
> 标签：opengl, textures

我有一个渲染设置，我在其中写入附加到纹理的帧缓冲区对象，并且渲染本身也使用我正在渲染的纹理。
这通常是个好主意吗？这里可能涉及一些我可能不知道的奇怪问题吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-04T15:22:06.340

这将导致未定义的行为，这意味着它可能会与任何未来的驱动程序版本中断，并且在不同的硬件上表现不同。为了安全起见，您永远不应该渲染到当前绑定的纹理（即可能同时读取和写入的纹理——这实际上是问题所在）。尝试制作纹理的副本，然后进行渲染。

查看[规范](http://www.opengl.org/registry/specs/EXT/framebuffer_object.txt)，特别是第 4.4.3 节“当绑定纹理对象的图像也附加到帧缓冲区时的渲染”

# debugging - 调试已部署的 AIR 应用程序

> ID：610986
> 
> 赞同：0
> 
> 时间：2009-03-04T15:10:08.147
> 
> 标签：debugging, air

是否可以像在 Java 中一样将调试器附加到 AIR 进程？对我来说，调试必须在生产中完成的 AIR 应用程序的最佳选择是什么（由于某些集成问题，在 FlexBuilder 中不起作用）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-14T22:20:10.680

有一个名为[De MonsterDebugger](http://demonsterdebugger.com/)的新调试器。一堆博客文章提到它很有前途，因此可能值得一试。

还要补充一点：对于日志记录，您可以使用 Flex 框架日志记录 API 创建自定义 ILoggingTarget 实现，该实现写入 XML 套接字或文件。

> ID：610995
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# wpf - 在 ComboBox 中选择 Nullable 类型

> ID：610998
> 
> 赞同：1
> 
> 时间：2009-03-04T15:13:02.023
> 
> 标签：wpf, combobox

我的问题很简单。我想在先前绑定的组合框中选择一个可为空的类型。

请帮我。

PS：请不要提供与修改我的数据、插入可为空的继承者或任何相关的任何解决方法。有没有直接的方法来实现这一点？？？

我知道可能有很多人与之抗争。

我向你们致以最诚挚的问候，特别是这个神奇网站的创建者。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T16:27:17.323

这已经在[这里](https://stackoverflow.com/questions/518579/why-cant-i-select-a-null-value-in-a-combobox)和[这里](https://stackoverflow.com/questions/422078/datatemplate-with-targetnullvalue-in-a-listbox)被问过了。没有找到真正的解决方案，但也许答案可能对您有所帮助。``***********************