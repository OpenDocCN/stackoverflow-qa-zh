# StackOverflow 问答 000007000-000007999

# c# - 多核文本文件解析

> ID：7015
> 
> 赞同：10
> 
> 时间：2008-08-10T03:07:39.157
> 
> 标签：c#, multithreading

我有一台四核机器，想编写一些代码来解析一个利用所有四核的文本文件。文本文件基本上每行包含一条记录。

多线程不是我的强项，所以我想知道是否有人可以给我一些我可以用来以最佳方式解析文件的模式。

我的第一个想法是将所有行读入某种队列，然后启动线程以将行从队列中拉出并处理它们，但这意味着队列必须存在于内存中，而且这些文件相当大，所以我我不那么热衷于这个想法。

我的下一个想法是拥有某种控制器，它将读取一行并为其分配一个线程来解析，但我不确定如果线程处理行的速度比它可以更快，控制器是否最终会成为瓶颈阅读并分配它们。

我知道可能还有比这两个更简单的解决方案，但目前我只是没有看到它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-10T03:19:36.623

我会同意你原来的想法。如果您担心队列可能会变得太大，请为它实现一个缓冲区（即如果超过 100 行则停止读取文件，如果它低于 20 行则重新开始读取。您需要进行一些测试找到最佳障碍）。使任何线程都可能成为“读取器线程”，因为它必须锁定队列才能拉出一个项目，它还可以检查“低缓冲区”是否已被击中并再次开始读取。当它这样做时，其他线程可以读出队列的其余部分。

或者，如果您愿意，让一个读取器线程将这些行分配给其他三个*处理器*线程（通过它们自己的队列）并实施[工作窃取策略](http://portal.acm.org/citation.cfm?doid=324133.324234)。我从来没有这样做过，所以我不知道这有多难。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-10T05:21:43.567

Mark 的回答是更简单、更优雅的解决方案。如果没有必要，为什么要构建具有线程间通信的复杂程序？产生 4 个线程。每个线程计算文件大小/4 以确定它的起点（和终点）。然后每个线程可以完全独立地工作。

添加一个特殊线程来处理读取的*唯一*原因是，如果您希望某些行需要很长时间来处理*，并且*您希望这些行聚集在文件的单个部分中。在不需要时添加线程间通信是一个*非常糟糕的主意*。您大大增加了引入意外瓶颈和/或同步错误的机会。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-10T04:41:43.367

这将消除单线程读取的瓶颈：

```
open file
for each thread n=0,1,2,3:
    seek to file offset 1/n*filesize
    scan to next complete line
    process all lines in your part of the file 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-10T03:43:22.720

我的经验是使用 Java，而不是 C#，如果这些解决方案不适用，我深表歉意。

我能想到的直接解决方案是拥有一个运行 3 个线程的执行程序（例如，使用 ）。对于从输入文件中读取的每一行/记录，在执行器上启动一个作业（使用）。执行器将为您排队请求，并在 3 个线程之间分配。[`Executors`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Executors.html)`.newFixedThreadPool`[`ExecutorService`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ExecutorService.html)`.submit`

可能存在更好的解决方案，但希望能够完成这项工作。:-)

ETA：听起来很像 Wolfbyte 的第二个解决方案。:-)

ETA2：[`System.Threading.ThreadPool`](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)在 .NET 中听起来像是一个非常相似的想法。我从未使用过它，但它可能值得你花时间！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T05:04:40.607

由于瓶颈通常在处理中，而不是在处理文件时的读取中，所以我会采用[生产者-消费者](http://www.ddj.com/architect/184401751)模式。为了避免锁定，我会查看无锁定列表。由于您使用的是 C#，因此您可以查看 Julian Bucknall 的[Lock-Free List](http://www.boyet.com/Articles/LockfreeFreeList.html)代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T00:02:20.607

@lomaxx

> @Derek & Mark：我希望有办法接受 2 个答案。我最终将不得不使用 Wolfbyte 的解决方案，因为如果我将文件拆分为 n 个部分，则线程可能会遇到一批“慢”事务，但是如果我正在处理每个进程的文件保证需要等量的处理，那么我真的很喜欢您的解决方案，即只需将文件拆分为块并将每个块分配给一个线程并完成它。

不用担心。如果集群“慢”事务是一个问题，那么排队解决方案就是要走的路。根据平均事务的快慢，您可能还想考虑一次将多行分配给每个工作人员。这将减少同步开销。同样，您可能需要优化缓冲区大小。当然，这两个都是优化，您可能只应该在分析之后进行。（如果它不是瓶颈，那么担心同步是没有意义的。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T04:27:08.297

如果您正在解析的文本由重复的字符串和标记组成，请将文件分成块，并且对于每个块，您可以让一个线程将其预解析为由关键字、“标点符号”、ID 字符串和值组成的标记。字符串比较和查找可能非常昂贵，如果不必进行字符串查找和比较，将其传递给多个工作线程可以加速代码的纯逻辑/语义部分。

然后可以将预解析的数据块（您已经完成所有字符串比较并“标记化”它）传递给实际查看标记化数据的语义和排序的代码部分。

此外，您提到您担心占用大量内存的文件大小。您可以采取一些措施来减少内存预算。

将文件拆分成块并解析它。一次只读入与您正在处理的块一样多的块，再加上一些用于“预读”的块，因此当您在处理一个块之前，您不会在磁盘上停顿，然后再进入下一个块。

或者，可以对大文件进行内存映射并“按需”加载。如果处理文件的线程比 CPU 多（通常线程 = 1.5-2X CPU 是需求分页应用程序的一个好数字），为内存映射文件在 IO 上停止的线程将自动从操作系统停止，直到它们内存已准备就绪，其他线程将继续处理。

# xna - 在视频游戏中绘制可换肤“按钮”的最佳方式是什么？

> ID：7017
> 
> 赞同：-1
> 
> 时间：2008-08-10T03:11:27.997
> 
> 标签：xna, button, skins

我正在寻找有关如何在游戏应用程序中绘制可换肤“按钮”的想法。如果我为按钮背景使用固定的精灵非矢量图像，那么我无法轻松调整按钮的大小。如果我编写代码来绘制一个可调整大小的按钮（就像绘制 Windows 按钮一样），那么程序员就必须参与进来——这会使蒙皮变得困难。另一种选择是将按钮分成 9 个较小的图像 (3x3) 并将它们全部拉伸——有点像圆角在 HTML 中完成。

还有另一种“更简单”的方法吗？最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-28T15:22:00.337

如果你真的想做到这一点，做到这一点的方法是使用纹理坐标。就像您在 HTML 中使用表格制作可拉伸的按钮/面板设计一样，您只需定义角、顶部可拉伸区域、底部可拉伸区域、侧面可拉伸区域以及中间的 UV 坐标。

有关在 XNA 引擎中实现的示例（尽管它是一个闭源引擎），请参见： [http ://www.flatredball.com/frb/docs/index.php?title=SpriteFrame_Tutorial](http://www.flatredball.com/frb/docs/index.php?title=SpriteFrame_Tutorial)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-10T17:42:34.650

是的。我正在做一个编辑器。它是一种用于 XNA 的类似 XAML 的语言（或类似 OpenLaszlo，如果您愿意的话）。所以按钮可以由编辑器调整大小。按钮也可以通过样式表调整大小。

我想你是对的，在实际设计中，按钮很可能都是相同的大小。但即使在窗口的应用程序中，有时您也需要使按钮更宽以容纳文本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-24T12:49:17.160

着色器应该是可能的。您可能必须进行纹素查找，但它会减少复杂 UI 中三角形的数量。

# javascript - 带有隐藏按钮的登录脚本

> ID：7031
> 
> 赞同：23
> 
> 时间：2008-08-10T04:00:06.773
> 
> 标签：javascript, php

我一直在使用 PHP 和 JavaScript 来构建我父亲的网站。他想在他的网站中加入一个登录系统，而我使用 PHP 设计了该系统。我的问题是如果该人已登录，我如何显示按钮？

**例如 -**您有*主页*、*产品*、*关于我们*和*联系方式*。如果用户登录，我希望有*Dealer*、*Distributor*和其他信息的按钮。所以我将有*Home*、*Products*、*About Us*、*Contacts*、 Dealer （如果经销商登录）、*Distributor*（如果经销商登录）等等向前。

JavaScript 会是这样做的好方法，还是 PHP 会，或者两者兼而有之？使用 JavaScript 显示和隐藏按钮，使用 PHP 检查显示哪些按钮。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-10T07:59:22.890

关于安全性，**您不能相信来自客户端的内容**：

*   访问者可以看到您的所有代码（HTML 和 Javascript，而不是 PHP）并尝试一些东西
*   访问者甚至可能不会使用浏览器；使用脚本发送请求非常容易

这意味着隐藏按钮是良好的用户界面设计（因为如果您未登录，则无法使用它们）。但这不是安全功能。安全功能在服务器上检查访问者是否在需要它的每个操作之前登录。

如果您不打算显示按钮，则将 HTML 和图像发送到浏览器然后使用 Javascript 隐藏它们是没有用的。我会用PHP检查。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-11T01:35:58.187

在您的菜单文件或 w/e 中，您输入：

```
<? require 'auth.php' ?>
<ul>
    <li><a href="">Home</a></li>
    <li><a href="">Products</a></li>
    <? if( loggedin() ): ?><li><a href="">Secret area</a></li><? endif; ?>
</ul> 
```

然后在需要身份验证的页面中执行以下操作：

```
<?php 
    require 'auth.php';
    require_login();
?> 
```

其中 auth.php 可能包含：

```
<?php
    function loggedin(){
        return isset( $_SESSION['loggedin'] );
    }

    function require_login(){
        if( !loggedin() ){
            header( 'Location: /login.php?referrer='.$_SERVER['REQUEST_URI'] );
            exit;
        }
    }
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-10T04:02:56.520

如果您使用 javascript 隐藏按钮，则会在应用程序中打开一个安全漏洞。恶意用户可以禁用 javascript 或应用他们自己的一些来绕过您的安全。

我建议使用 PHP 来选择是否呈现按钮。我经常在.NET 中这样做。

每当他们尝试使用受限按钮时，您应该能够检查用户在服务器端的访问权限。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-11T01:23:45.187

我们在工作中所做的是有一个库，它提供了诸如检查用户是否登录之类的功能。例如：

```
<?php
require_once 'Auth.php';
// output some html
if (isLoggedIn()) {
    echo 'html for logged in user';
}
// rest of html 
```

对于只有经过身份验证的用户才能看到的页面，控制器会检查他们是否已登录，如果没有，则将他们重定向到登录页面。

```
<?php
public function viewCustomer($customerId) {
    if (!isLoggedIn())
        redirectToLoginPage();
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-25T18:32:29.000

Christian Lescuyer 所写的一切都是正确的。但是请注意，他说的是“我愿意”而不是“你应该”。选择并不那么容易。

首先，安全性不是选择的问题。执行操作时，您应该对服务器进行安全检查。哪个代码决定显示/隐藏导致该操作的按钮是无关紧要的。

这让我们在 Javascript 中执行显示/隐藏逻辑只有一个缺点——发送给用户的 HTML 比必要的要大。这可能没什么大不了的。

不过，在 PHP 中显示/隐藏逻辑确实有一个缺点。所需的 PHP 代码通常是[标签汤](http://www.codinghorror.com/blog/archives/001155.html)。Akira 的代码提供了一个很好的例子来说明它通常是如何完成的。

相应的 Javascript 代码可能看起来像这样：

```
if (logged())
{
    elementSecretArea.style.display = "list-item";
} 
```

（假设可以隐藏的元素默认具有 display:none ）。

这种风格也允许很好的“Ajax”场景：用户看到一个没有秘密区域的页面，输入密码，看到秘密区域都没有刷新页面。

所以，如果你已经有一个脚本在你的文档加载时运行，我会认真考虑在那里有显示/隐藏逻辑。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-18T18:50:19.703

基本上，您的菜单在 html 中，例如在最后一项`<ul> <li>Home</li> </ul>`之后添加 php的列表：`</li>`

```
<?php
  if($session-logged_in) {    
?>

<li>My Account</li>

<?php  
  }
?> 
```

# javascript - JavaScript 中的图形可视化库

> ID：7034
> 
> 赞同：523
> 
> 时间：2008-08-10T04:07:52.423
> 
> 标签：javascript, jquery, data-structures, graph-layout

我有一个表示有向图的数据结构，我想在 HTML 页面上动态呈现它。这些图通常只有几个节点，可能是最上端的十个节点，所以我的猜测是性能不会有什么大不了的。理想情况下，我希望能够将它与 jQuery 挂钩，以便用户可以通过拖动节点来手动调整布局。

注意：我不是在寻找图表库。

* * *

## 回答 #1

> 赞同：971
> 
> 时间：2010-03-02T19:48:15.093

我刚刚把你可能要找的东西放在一起：http: [//www.graphdracula.net](http://www.graphdracula.net)

它是带有定向图形布局的 JavaScript、SVG，您甚至可以拖动节点。仍然需要一些调整，但完全可用。您可以使用如下 JavaScript 代码轻松创建节点和边：

```
var g = new Graph();
g.addEdge("strawberry", "cherry");
g.addEdge("cherry", "apple");
g.addEdge("id34", "cherry"); 
```

我使用了前面提到的 Raphael JS 库（graffle 示例）以及一些我在网上找到的基于力的图形布局算法的代码（一切都是开源的，MIT 许可证）。如果您有任何意见或需要某个功能，我可以实现它，请问！

* * *

您可能还想看看其他项目！以下是两个元比较：

*   [SocialCompare](http://socialcompare.com/en/comparison/javascript-graphs-and-charts-libraries)有一个广泛的库列表，“节点/边缘图”行将过滤图形可视化库。

*   DataVisualization.ch 评估了许多库，包括节点/图形库。不幸的是，没有直接链接，因此您必须过滤“图表”：[![选择数据Visualization.ch](https://i.stack.imgur.com/o4lwD.jpg)](http://selection.datavisualization.ch/)

以下是类似项目的列表（这里已经提到了一些）：

### 纯 JavaScript 库

*   [vis.js](http://visjs.org/#gallery)支持多种类型的网络/边缘图，以及时间线和 2D/3D 图表。自动布局、自动集群、弹性物理引擎、移动友好、键盘导航、分层布局、动画等。[麻省理工学院](https://github.com/almende/vis)由一家专门研究自组织网络的荷兰公司许可和开发。

*   [Cytoscape.js](http://js.cytoscape.org) - 具有移动支持的交互式图形分析和可视化，遵循 jQuery 约定。由 NIH 资助并由[@maxkfranz](https://stackoverflow.com/users/947225/maxkfranz)在几所大学和其他组织的帮助下开发（见[下面他的回答）。](https://stackoverflow.com/a/10319429/1269037)

*   [JavaScript InfoVis Toolkit](http://thejit.org/demos.html) - Jit，一个交互式、多用途的图形绘制和布局框架。例如参见[双曲树](http://philogb.github.io/jit/static/v20/Docs/files/Visualizations/Hypertree-js.html)。由 Twitter dataviz 建筑师[Nicolas Garcia Belmonte](http://www.sencha.com/conference/session/sencha-charting-visualization)建造， 2010 年[被 Sencha 收购](http://philogb.github.io/infovis/)。

*   [D3.js](http://d3js.org/)强大的多功能 JS 可视化库，Protovis 的继承者。请参阅[力导向图](http://bl.ocks.org/mbostock/4062045)示例，以及[图库](https://github.com/mbostock/d3/wiki/Gallery)中的其他图示例。

*   [Plotly 的](https://plot.ly./)JS 可视化库使用 D3.js 与 JS、Python、R 和 MATLAB 绑定。[请参阅此处](https://plot.ly/ipython-notebooks/bioinformatics/#In-[54])的 IPython 中的 nexworkx 示例、[此处](https://plot.ly/ipython-notebooks/network-graphs/)的人机交互示例和[JS Embed API](https://github.com/plotly/Embed-API)。

*   [sigma.js](http://sigmajs.org/)用于绘制图形的轻量级但功能强大的库

*   [用于创建交互式连接图的jsPlumb](http://jsplumbtoolkit.com/) jQuery 插件

*   [Springy](http://getspringy.com/) - 一种力导向的图形布局算法

*   [Processing.js](http://processingjs.org/)处理库的 Javascript 端口，作者：John Resig

*   [JS Graph It](http://js-graph-it.sourceforge.net/) - 通过直线连接的拖放框。线的最小自动布局。

*   [RaphaelJS 的 Graffle](http://raphaeljs.com/graffle.html) - 通用多用途矢量绘图库的交互式图形示例。RaphaelJS 不能自动布局节点；为此，您将需要另一个库。

*   [JointJS Core](http://www.jointjs.com/demos) - David Durman 的 MPL 许可开源图表库。它可用于创建静态图表或完全交互式图表工具和应用程序构建器。在支持 SVG 的浏览器中工作。核心包中不包含布局算法

*   [mxGraph](https://github.com/jgraph/mxgraph)以前的商业 HTML 5 图表库，现在在 Apache v2.0 下可用。mxGraph 是 draw.io 中使用的基础[库](https://www.draw.io?splash=0)。

### 商业图书馆

*   [GoJS](http://gojs.net/latest/index.html)交互式图形绘制和布局库

*   [yFiles for HTML](http://www.yworks.com/yfileshtml)商业图形绘制和布局库

*   [KeyLines](http://keylines.com/) Commercial JS 网络可视化工具包

*   [ZoomCharts](https://zoomcharts.com)商业多用途可视化库

*   [Syncfusion JavaScript Diagram](https://www.syncfusion.com/javascript-ui-controls/diagram)用于绘图和可视化的商业图表库。

### 废弃的图书馆

*   [Cytoscape Web](http://cytoscapeweb.cytoscape.org/)可嵌入 JS 网络查看器（未计划新功能；由 Cytoscape.js 成功）

*   用于 Graphviz 图形的[Canviz](http://code.google.com/p/canviz/) JS**渲染器。**[2013 年 9 月放弃](https://code.google.com/p/canviz/source/list)。

*   [arbor.js](http://arborjs.org/)复杂的图形，具有漂亮的物理效果和令人眼花缭乱的效果。2012 年 5 月废弃。存在几个[半维护的](https://github.com/samizdatco/arbor/issues/56#issuecomment-62842532)分叉。

*   [jssvggraph](http://github.com/jackrusher/jssvggraph) “最简单的力导向图布局算法，实现为使用 SVG 对象的 Javascript 库”。2012 年放弃。

*   [jsdot](https://code.google.com/p/jsdot/)客户端图形绘制应用程序。[2011年放弃](https://code.google.com/p/jsdot/source/list)。

*   [Protovis](http://vis.stanford.edu/protovis/ex/force.html)可视化图形工具包 (JavaScript)。替换为 d3。

*   [用于连接和关系的Moo Wheel](http://labs.unwieldy.net/moowheel/) Interactive JS 表示 (2008)

*   [JSViz](http://www.jsviz.org/) 2007 时代的图形可视化脚本

*   [JavaScript 的dagre](https://github.com/cpettitt/dagre)图形布局

### 非 Javascript 库

*   [Graphviz](http://www.graphviz.org/)复杂的图形可视化语言

    *   Graphviz 已在此处使用 Emscripten 编译为 Javascript，并[在此处](https://github.com/mdaines/viz.js/)提供[在线交互式演示](http://mdaines.github.io/viz.js/)
*   [Flare](http://flare.prefuse.org/)美丽而强大的基于 Flash 的图形绘制

*   [NodeBox](http://nodebox.net/code/index.php/Graph) Python 图形可视化

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2012-04-25T16:05:05.280

*免责声明：我是 Cytoscape.js 的开发者*

Cytoscape.js 是一个 HTML5 图形可视化库。该 API 非常复杂并遵循 jQuery 约定，包括

*   用于查询和过滤的选择器（`cy.elements("node[weight >= 50].someClass")`如您所愿），
*   链接（例如`cy.nodes().unselect().trigger("mycustomevent")`），
*   用于绑定事件的类 jQuery 函数，
*   元素作为集合（就像 jQuery 有 HTMLDomElements 的集合），
*   可扩展性（可以添加自定义布局、UI、核心和集合功能等），
*   和更多。

如果你正在考虑用图表构建一个严肃的 web 应用程序，你至少应该考虑 Cytoscape.js。它是免费和开源的：

[http://js.cytoscape.org](http://js.cytoscape.org)

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-08-15T22:31:06.360

[JsVIS](http://www.jsviz.org)相当不错，但是对于较大的图表来说速度很慢，并且自 2007 年以来已被放弃。

[prefuse](https://github.com/prefuse/Prefuse)是一组用于在 Java 中创建丰富的交互式数据可视化的软件工具。[flare](https://github.com/prefuse/Flare) 是一个 ActionScript 库，用于创建在 Adob​​e Flash Player 中运行的可视化，自 2012 年以来被废弃。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-01-07T11:00:49.737

在商业场景中，一个严肃的竞争者肯定是[yFiles for HTML](https://www.yworks.com/yfileshtml)：

它提供：

*   轻松*导入*自定义数据（[这个交互式在线演示](http://live.yworks.com/yfiles-for-html/2.0/databinding/graphbuilder/index.html)似乎几乎完全符合 OP 的要求）
*   通过用户手势创建和操作图表的交互式编辑（参见完整的[编辑器](https://www.yworks.com/products/yed-live)）
*   用于自定义库的各个方面的巨大[编程 API](http://docs.yworks.com/yfileshtml/)
*   支持*分组*和*嵌套*（交互式以及通过布局算法）
*   不依赖于特定的 UI 工具包，但支持*集成*到几乎任何现有的 Javascript 工具包中（请参阅[“集成”演示](http://live.yworks.com/yfiles-for-html/2.0/#integration)）
*   自动布局（各种样式，如“分层”、“有机”、“正交”、“树”、“圆形”、“径向”等）
*   自动复杂的边缘路由（带避障的正交和有机边缘路由）
*   增量和部分布局（添加和删除元素，仅略微或根本不更改图表的其余部分）
*   支持分组和嵌套（交互式以及通过布局算法）
*   [图分析算法](http://live.yworks.com/yfiles-for-html/2.0/#analysis)的实现（路径、中心性、网络流等）
*   使用 HTML 5 技术，如 SVG+CSS 和 Canvas 以及现代 Javascript，利用属性和其他更多 ES5 和 ES6 功能（但出于同样的原因，无法在 IE 8 及更低版本中运行）。
*   使用可以使用 UMD 加载器按需加载的模块化 API

这是一个示例渲染，显示了大多数请求的功能：

![BPMN 演示创建的示例渲染的屏幕截图。](https://i.stack.imgur.com/9RrCz.png)

全面披露：我在 yWorks 工作，但在 Stackoverflow 上我不代表我的雇主。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-04-03T17:01:09.063

正如 guruz 提到的，[JIT](http://philogb.github.io/jit/)有几个可爱的图形/树布局，包括非常吸引人的 RGraph 和 HyperTree 可视化。

另外，我刚刚[在 github 上建立了一个超级简单的基于 SVG 的实现](http://github.com/jackrusher/jssvggraph)（无依赖关系，~125 LOC），对于现代浏览器中显示的小图来说应该足够好。

# linux - 如何在 linux 中显示来自 bash 脚本的 GUI 消息框？

> ID：7035
> 
> 赞同：170
> 
> 时间：2008-08-10T04:07:55.043
> 
> 标签：linux, bash, scripting, ubuntu, gtk

我正在 Ubuntu linux 下编写一些小 bash 脚本。我希望能够从 GUI 运行它们，而无需终端窗口来输入任何输入或查看任何输出。

到目前为止，唯一需要的输入是 sudo 的密码 - 而 gksudo 处理得很好。但是我还没有找到一种简单的方法来显示消息框。是否有某种“gkmessage”命令可用？我更喜欢默认 Ubuntu 安装中存在的东西，但我不介意在必要时安装新包。

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2013-01-20T06:58:38.433

如果您使用的是~~Ubuntu~~许多发行版，则该`notify-send`命令将在右上角抛出那些漂亮的易腐烂通知之一。像这样：

`notify-send "My name is bash and I rock da house"`

美丽的！

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2008-08-10T06:40:47.603

我相信[Zenity](http://live.gnome.org/Zenity)会做你想做的事。它是专门为从命令行显示 GTK 对话框而设计的，它以[Ubuntu 软件包](http://packages.ubuntu.com/hardy/zenity)的形式提供。

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2014-01-28T14:48:46.917

每个人都提到zenity，似乎还有很多其他的。一个混合但有趣的列表位于[http://alternativeto.net/software/zenity/](http://alternativeto.net/software/zenity/)

首先，一个 Zenity 的例子，具有文本格式标记、窗口标题、按钮标签。

```
zenity \
--info \
--text="<span size=\"xx-large\">Time is $(date +%Hh%M).</span>\n\nGet your <b>coffee</b>." \
--title="Coffee time" \
--ok-label="Sip" 
```

## gxmessage

```
gxmessage "my text" 
```

## xmessage

`xmessage`非常古老，因此它很稳定，并且可能在所有使用 X 的发行版中都可用（因为它与 X 一起发行）。它可以通过 X 资源进行定制，对于那些已经使用 Linux 或 Unix 足够长的时间来了解它的含义的人（`.Xdefaults`任何人？）。

```
xmessage -buttons Ok:0,"Not sure":1,Cancel:2 -default Ok -nearmouse "Is xmessage enough for the job ?" -timeout 10 
```

## kdialog（KDE 工具）

```
kdialog --error "Some error occurred" 
```

## 在 PPA 中

[YAD：Zenity On Steroids [从 Shell 脚本显示图形对话框] ~ Web Upd8：Ubuntu / Linux 博客](http://www.webupd8.org/2010/12/yad-zenity-on-steroids-display.html)。似乎不会自动调整对话框大小。

```
echo My text | yad \
--text-info \
--width=400 \
--height=200 
```

一个更大的例子

```
yad \
--title="Desktop entry editor" \
--text="Simple desktop entry editor" \
--form \
--field="Type:CB" \
--field="Name" \
--field="Generic name" \
--field="Comment" \
--field="Command:FL" \
--field="Icon" \
--field="In terminal:CHK" \
--field="Startup notify:CHK" "Application" "Name" "Generic name" "This is the comment" "/usr/bin/yad" "yad" FALSE TRUE \
--button="WebUpd8:2" \
--button="gtk-ok:0" \
--button="gtk-cancel:1" 
```

## 其他不在 Ubuntu 标准存储库中的

*   壳贵
*   对话
*   gtk对话框

## 题外话（终端）

```
whiptail --msgbox "my text" 10 20
dialog --msgbox "my text" 10 20 
```

随意编辑。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-08-05T18:49:22.233

zenity**应用**程序似乎是您正在寻找的。

要从**zenity**获取输入，您可以指定一个变量并将**zenity --entry**的输出保存到其中。它看起来像这样：

```
my_variable=$(zenity --entry) 
```

如果您现在查看 my_variable 中的值**，**它将是在 zenity 弹出条目对话框中输入的任何内容。

如果您想就用户（或您）应在对话框中输入的内容给出某种提示，请添加带有所需标签的**--text开关。**它看起来像这样：

```
my_variable=$(zenity --entry --text="What's my variable:") 
```

Zenity 有许多其他适用于特定任务的不错的选项，因此您可能还想使用**zenity --help**来查看这些选项。一个例子是**--calendar**选项，它让您从图形日历中选择一个日期。

```
my_date=$(zenity --calendar) 
```

根据用户点击的内容，它给出了一个格式良好的日期：

```
echo ${my_date} 
```

给出：

> 2009 年 8 月 5 日

还有滑块选择器、错误、列表等选项。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2008-08-10T04:26:16.863

我找到了[xmessage](https://linux.die.net/man/1/xmessage)命令，这已经足够好了。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2017-02-08T23:43:45.867

`alert`似乎`notify-send`是同一件事。我`notify-send`用于非输入消息，因为它不会窃取焦点，而且我找不到阻止 zenity 等这样做的方法。

例如

```
# This will display message and then disappear after a delay:
notify-send "job complete"

# This will display message and stay on-screen until clicked:
notify-send -u critical "job complete" 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-11-09T03:44:31.433

如果没有其他东西存在。您可以启动一个 xterm 并在其中回显，如下所示：

```
 xterm -e bash -c 'echo "this is the message";echo;echo -n "press enter to continue "; stty sane -echo;answer=$( while ! head -c 1;do true ;done);' 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-08-10T04:34:36.627

这是一个小 Tcl 脚本，它会做你想做的事。Wish 解释器应该默认安装在 Ubuntu 上。

```
#!/usr/bin/wish
pack [label .msg -text [lindex $argv 0]]
pack [entry .ent]
bind .ent <KeyPress-Return> { puts [.ent get]; destroy . }
focus .ent 
```

像这样称呼它：

```
myanswer=`gui-prompt "type your answer and press enter"` 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-17T00:26:46.780

还有`dialog`和KDE版本`kdialog`。 `dialog`由 slackware 使用，因此它可能不会立即在其他发行版上可用。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-03-10T15:30:00.537

**Ubuntu的警报**怎么样。它可以在任何操作完成后使用它来提醒它完成，如果操作完成错误，甚至会显示红色十字图标

```
ls -la; alert 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-17T02:18:16.280

[Zenity](http://live.gnome.org/Zenity)确实是我认为您正在寻找的确切工具。

或者

```
zenity --help 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-12-22T22:23:43.700

您可以使用[shellmarks](https://github.com/shannah/shellmarks)在运行 shell 脚本之前显示一个 GUI 对话框，这将允许用户输入将放置在环境中的数据。

```
#!/bin/bash
echo "Hello ${name}"
exit 0
---
[name]
  type="text"
  label="Please enter your name"
  required=true 
```

运行脚本：

```
shellmarks hello.sh 
```

[![Shellmarks 对话框](https://i.stack.imgur.com/Gnjyq.png)](https://i.stack.imgur.com/Gnjyq.png)

如果在框中输入“Steve”并按运行，输出将是

```
Hello Steve 
```

披露：我是 Shellmarks 的作者

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-17T02:13:53.420

Kdialog 和 dialog 都不错，但我推荐 Zenity。快速、简单、更好看的 xmessage 或对话框。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-12-26T02:38:14.990

我喜欢我在[script-dialog](https://github.com/lunarcloud/script-dialog)中看到的内容。它打勾了我所有的盒子，加上一些：

*   弹出 GUI 框，但有文本模式回退
*   支持各种 sudo 变体（gksudo、kde-sudo、...）
*   可以在终端窗口中重新启动

事实上，它是 kdialog、zenity、dialog、whiptail 和自定义后备的包装器。

缺点是它没有 CLI，而是作为 bash 脚本的源代码。

# c# - C#中的字符串和字符串有什么区别？

> ID：7074
> 
> 赞同：7151
> 
> 时间：2008-08-10T07:18:02.320
> 
> 标签：c#, .net, string, types, alias

示例（*注意大小写*）：

```
string s = "Hello world!";
String s = "Hello world!"; 
```

每种的使用指南是什么？有什么区别？

* * *

## 回答 #1

> 赞同：6728
> 
> 时间：2008-08-10T07:22:02.030

[`string`](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/string)是 C# 中的别名[`System.String`](https://docs.microsoft.com/en-us/dotnet/api/system.string)。
所以从技术上讲，没有区别。这就像[`int` *对* `System.Int32`](https://stackoverflow.com/questions/62503/c-int-or-int32-should-i-care)..

就准则而言，通常建议在`string`您引用对象的任何时候使用。

例如

```
string place = "world"; 
```

`String`同样，如果您需要专门引用该类，我认为通常建议使用它。

例如

```
string greet = String.Format("Hello {0}!", place); 
```

## [这是微软在他们的例子](https://docs.microsoft.com/en-us/dotnet/api/system.string.format#examples)中倾向于使用的风格。

看来这方面的指导可能已经改变，因为[StyleCop](https://github.com/StyleCop)现在强制使用 C# 特定别名。

* * *

## 回答 #2

> 赞同：3689
> 
> 时间：2008-10-18T18:52:13.807

只是为了完整起见，这里是相关信息的大脑转储......

正如其他人所指出的，`string`是 的别名`System.String`。假设您的代码使用`String`编译为`System.String`（即您没有针对其他具有不同`String`类型的命名空间的 using 指令），它们编译为相同的代码，因此在执行时没有任何区别。这只是 C# 中的别名之一。完整列表是：

```
object:  System.Object
string:  System.String
bool:    System.Boolean
byte:    System.Byte
sbyte:   System.SByte
short:   System.Int16
ushort:  System.UInt16
int:     System.Int32
uint:    System.UInt32
long:    System.Int64
ulong:   System.UInt64
float:   System.Single
double:  System.Double
decimal: System.Decimal
char:    System.Char 
```

除了`string`and `object`，别名都是值类型。`decimal`是值类型，但不是 CLR 中的原始类型。唯一没有别名的原始类型是`System.IntPtr`.

在规范中，值类型别名被称为“简单类型”。字面量可用于每个简单类型的常量值；没有其他值类型具有可用的文字形式。（将此与 VB 进行比较，它允许`DateTime`文字，并且也有一个别名。）

在一种情况下，您*必须*使用别名：显式指定枚举的基础类型时。例如：

```
public enum Foo : UInt32 {} // Invalid
public enum Bar : uint   {} // Valid 
```

这只是规范定义枚举声明的方式的问题 - 冒号后面的部分必须是*整数类型*`sbyte`产生，它是, `byte`, `short`, `ushort`, `int`, `uint`, `long`, `ulong`, ...的一个标记，`char`而不是*类型*产生例如，由变量声明使用。它不表示任何其他差异。

最后，当谈到使用时：我个人在任何地方都使用别名来实现，但任何 API 都使用 CLR 类型。就实施而言，您使用哪种方式真的无关紧要 - 团队之间的一致性很好，但没有其他人会在意。另一方面，如果您在 API 中引用一个类型，那么您必须以一种语言中立的方式进行，这一点非常重要。被调用的方法`ReadInt32`是明确的，而被调用的方法`ReadInt`需要解释。例如，调用者可能正在使用一种为 定义`int`别名的语言`Int16`。.NET 框架设计者遵循了这种模式，很好的例子在`BitConverter`,`BinaryReader`和`Convert`类中。

* * *

## 回答 #3

> 赞同：791
> 
> 时间：2008-10-18T17:25:45.573

`String`代表`System.String`，它是一个 .NET Framework 类型。是C# 语言中 .**`string`的别名**`System.String`。它们都被编译成**`System.String`IL**（中间语言），所以没有区别。选择你喜欢的并使用它。如果您使用 C# 编写代码，我更喜欢它，`string`因为它是 C# 类型别名，并且为 C# 程序员所熟知。

我可以对**( `int`, `System.Int32`)**等说同样的话。

* * *

## 回答 #4

> 赞同：557
> 
> 时间：2008-08-15T23:00:44.410

我听说过在 C# 中使用提供的类型别名的最佳答案来自 Jeffrey Richter 在他的著作[CLR Via C#](https://rads.stackoverflow.com/amzn/click/com/0735621632)中。以下是他的3个理由：

> *   我看到许多开发人员感到困惑，不知道在他们的代码中使用**字符串**还是**字符串。**因为在 C# 中，字符串（关键字）完全映射到 System.String（FCL 类型），所以没有区别，都可以使用。
> *   在 C# 中，**long**映射到**System.Int64**，但在不同的编程语言中，**long**可以映射到**Int16**或**Int32**。事实上，C++/CLI 实际上将 long 视为**Int32**。如果他或她习惯于使用不同的编程语言进行编程，那么阅读一种语言的源代码的人很容易误解代码的意图。事实上，大多数语言甚至不会将**long**视为关键字，也不会编译使用它的代码。
> *   FCL 有许多将类型名称作为其方法名称的一部分的方法。例如，**BinaryReader**类型提供诸如**ReadBoolean**、**ReadInt32**、**ReadSingle**等方法，而**System.Convert**类型提供诸如**ToBoolean**、**ToInt32**、**ToSingle**等方法。虽然写下面的代码是合法的，但是有float的那一行对我来说感觉很不自然，而且看不出这行是否正确：

```
BinaryReader br = new BinaryReader(...);
float val  = br.ReadSingle(); // OK, but feels unnatural
Single val = br.ReadSingle(); // OK and feels good 
```

所以你有它。我认为这些都是非常好的观点。然而，我发现自己没有在自己的代码中使用 Jeffrey 的建议。也许我太拘泥于我的 C# 世界，但我最终试图让我的代码看起来像框架代码。

* * *

## 回答 #5

> 赞同：495
> 
> 时间：2009-02-24T05:14:10.860

`string`是一个保留字，但`String`只是一个类名。这意味着它`string`本身不能用作变量名。

如果出于某种原因你想要一个名为*string*的变量，你只会看到这些编译中的第一个：

```
StringBuilder String = new StringBuilder();  // compiles
StringBuilder string = new StringBuilder();  // doesn't compile 
```

如果你真的想要一个名为*string*的变量名，你可以使用`@`它作为前缀：

```
StringBuilder @string = new StringBuilder(); 
```

另一个关键区别：Stack Overflow 以不同的方式突出显示它们。

* * *

## 回答 #6

> 赞同：434
> 
> 时间：2008-08-27T18:21:37.670

**有一个区别**`String`-没有`using System;`事先就不能使用。

* * *

## 回答 #7

> 赞同：337
> 
> 时间：2008-10-19T01:04:57.860

上面已经介绍过了；但是，您不能`string`在反射中使用；你必须使用`String`.

* * *

## 回答 #8

> 赞同：293
> 
> 时间：2008-08-10T07:26:14.783

`System.String`是 .NET 字符串类 - 在 C#`string`中是别名`System.String`- 所以在使用中它们是相同的。

至于指导方针，我不会陷入困境，只使用你喜欢的任何一个 - 生活中有更重要的事情，无论如何代码都是一样的。

如果您发现自己构建的系统需要指定您正在使用的整数的大小并因此倾向于使用`Int16`, `Int32`,等`UInt16`，`UInt32`那么使用起来可能看起来更自然`String`- 当在不同的 .net 语言之间移动时它可能会让事情更容易理解——否则我会使用字符串和整数。

* * *

## 回答 #9

> 赞同：233
> 
> 时间：2008-09-03T18:58:07.977

`.NET`出于格式化原因， 我更喜欢大写的类型（而不是别名）。这些`.NET`类型的颜色与其他对象类型相同（毕竟值类型是正确的对象）。

条件和控制关键字（如`if`、`switch`和`return`）是小写的，颜色为深蓝色（默认情况下）。我宁愿没有使用和格式的分歧。

考虑：

```
String someString; 
string anotherString; 
```

* * *

## 回答 #10

> 赞同：210
> 
> 时间：2008-10-18T16:50:05.007

`string`并且`String`在所有方面都是相同的（除了大写的“S”）。两种方式都没有性能影响。

`string`由于语法突出显示，大多数项目中首选小写

* * *

## 回答 #11

> 赞同：205
> 
> 时间：2009-03-17T20:29:13.253

C# 是一种与 CLR 一起使用的语言。

**`string`**是 C# 中的一种类型。

**`System.String`**是 CLR 中的一种类型。

当您将 C# 与 CLR 一起使用时，**`string`**将映射到**`System.String`**.

理论上，您可以实现生成 Java 字节码的 C# 编译器。为了与 Java 运行时库进行互操作，此编译器的合理实现可能会映射**`string`**到。**`java.lang.String`**

* * *

## 回答 #12

> 赞同：203
> 
> 时间：2014-01-15T18:03:23.657

[这段 YouTube](http://www.youtube.com/watch?v=ikqUUIg8gmk)视频实际上展示了它们的不同之处。

但现在是一个很长的文字答案。

当我们谈论`.NET`有两种不同的东西时，一种是框架，另一种是使用该框架`.NET`的语言（`C#`等）。`VB.NET`

![在此处输入图像描述](https://i.stack.imgur.com/jQUcj.png)

“ `System.String`”又名“String”（大写“S”）是一种`.NET`框架数据类型，而“string”是一种`C#`数据类型。

![在此处输入图像描述](https://i.stack.imgur.com/tKhjh.png)

简而言之，“字符串”是“字符串”的别名（相同的东西用不同的名称称呼）。所以从技术上讲，下面的两个代码语句都会给出相同的输出。

```
String s = "I am String"; 
```

或者

```
string s = "I am String"; 
```

同样，其他 C# 数据类型也有别名，如下所示：

object: `System.Object`, string: `System.String`, bool: `System.Boolean`, byte: `System.Byte`, sbyte: `System.SByte`, short:`System.Int16`等等。

**现在从程序员的角度来看一个百万美元的问题：那么什么时候使用“String”和“string”？**

避免混淆的第一件事是始终如一地使用其中一个。但是从最佳实践的角度来看，当您进行变量声明时，最好使用“string”（小“s”），当您将其用作类名时，首选“String”（大写“S”）。

在下面的代码中，左侧是一个变量声明，它是使用“字符串”声明的。在右侧，我们正在调用一个方法，因此“String”更合理。

```
string s = String.ToUpper() ; 
```

* * *

## 回答 #13

> 赞同：183
> 
> 时间：2008-08-10T07:27:55.060

小写`string`是`System.String`. 它们在`C#`.

关于您应该使用系统类型（`System.Int32`、`System.String`等）还是`C# aliases`（`int`、等）类型存在争议`string`。我个人认为您应该使用`C# aliases`，但这只是我个人的偏好。

* * *

## 回答 #14

> 赞同：166
> 
> 时间：2008-10-18T16:50:48.110

`string`只是`System.String`. 编译器会对它们一视同仁。

唯一实际的区别是您提到的语法突出显示，`using System`如果您使用`String`.

* * *

## 回答 #15

> 赞同：153
> 
> 时间：2008-10-18T18:26:20.520

两者都是一样的。但从编码指南的角度来看，最好使用`string`而不是`String`. 这是开发人员通常使用的。例如，`Int32`我们使用`int`as `int`is alias to而不是使用`Int32`

仅供参考“关键字字符串只是预定义类的别名`System.String`。” - C# 语言规范 4.2.3 [http://msdn2.microsoft.com/En-US/library/aa691153.aspx](http://msdn2.microsoft.com/En-US/library/aa691153.aspx)

* * *

## 回答 #16

> 赞同：128
> 
> 时间：2008-10-19T01:15:31.570

正如其他人所说，他们是一样的。默认情况下，StyleCop 规则将强制您将其`string`用作 C# 代码样式最佳实践，除非在引用`System.String`静态函数时，例如`String.Format`, `String.Join`,`String.Concat`等...

* * *

## 回答 #17

> 赞同：116
> 
> 时间：2015-01-15T14:21:22.810

6 年零 5 个月后的新答案（拖延）。

While`string`是一个保留的 C# 关键字，始终具有固定的含义，`String`它只是一个可以引用任何内容的普通*标识符。*根据当前类型的成员，当前命名空间和应用的`using`指令及其位置，`String`可以是不同于`global::System.String`.

我将提供*`using`指令无济于事*的两个示例。

* * *

首先，when`String`是当前类型的***值***（或局部变量）：

```
class MySequence<TElement>
{
  public IEnumerable<TElement> String { get; set; }

  void Example()
  {
    var test = String.Format("Hello {0}.", DateTime.Today.DayOfWeek);
  }
} 
```

上面的代码不会编译，因为`IEnumerable<>`没有一个名为 的非静态成员`Format`，也没有应用扩展方法。在上述情况下，仍然可以`String`在其他情况下使用*类型*是语法上唯一的可能性。例如`String local = "Hi mum!";`可能没问题（取决于命名空间和`using`指令）。

更糟糕的是：说`String.Concat(someSequence)`可能（取决于`using`s）去 Linq 扩展方法`Enumerable.Concat`。它不会转到静态方法`string.Concat`。

* * *

其次，when`String`是另一种***类型***，嵌套在当前类型中：

```
class MyPiano
{
  protected class String
  {
  }

  void Example()
  {
    var test1 = String.Format("Hello {0}.", DateTime.Today.DayOfWeek);
    String test2 = "Goodbye";
  }
} 
```

该方法中的任何语句都`Example`无法编译。这里`String`总是一根钢琴[弦](http://en.wikipedia.org/wiki/String_(music))，`MyPiano.String`。`static`它上不存在（或不存在）成员（或`Format`从其基类继承）。并且该值`"Goodbye"`无法转换为它。

* * *

## 回答 #18

> 赞同：105
> 
> 时间：2008-09-22T19:40:08.533

使用系统类型可以更容易地在 C# 和 VB.Net 之间进行移植，如果你喜欢这种东西的话。

* * *

## 回答 #19

> 赞同：94
> 
> 时间：2011-05-31T11:20:21.507

正如 Jon Skeet 所提到的，与其他程序员中似乎很常见的做法相比，我更喜欢`String`，`string`只是为了强调`String`引用类型这一事实。

* * *

## 回答 #20

> 赞同：87
> 
> 时间：2011-10-21T01:10:10.410

`string`是 的别名（或简写）`System.String`。这意味着，通过键入`string`我们的意思是`System.String`. 您可以在 think link 中阅读更多内容：['string' 是 System.String 的别名/简写。](http://www.jeeshenlee.com/2011/10/difference-between-string-and.html)

* * *

## 回答 #21

> 赞同：85
> 
> 时间：2011-01-28T10:08:57.343

我只想将此添加到来自 Ritchers 书中的 lfousts 答案中：

> C# 语言规范指出，“就风格而言，使用关键字优于使用完整的系统类型名称。” 我不同意语言规范；我更喜欢使用 FCL 类型名称并完全避免使用原始类型名称。事实上，我希望编译器甚至不提供原始类型名称，而是强制开发人员使用 FCL 类型名称。以下是我的理由：
> 
> *   我看到许多开发人员感到困惑，不知道在他们的代码中使用**字符串** 还是**字符串。**因为在 C# 中**字符串**（一个关键字）完全映射到 **System.String**（一个 FCL 类型），所以没有区别，都可以使用。同样，我听到一些开发人员说，当应用程序在 32 位操作系统上运行时， **int**表示 32 位整数，而当应用程序在 64 位操作系统上运行时，它表示 64 位整数。这种说法是绝对错误的：在 C# 中，一个**int**总是映射到**System.Int32**，因此它表示一个 32 位整数，而不管代码运行在什么操作系统上。如果程序员会使用**Int32**在他们的代码中，那么这种潜在的混淆也被消除了。
>     
>     
> *   在 C# 中，**long**映射到**System.Int64**，但在不同的编程语言中，**long** 可以映射到**Int16**或**Int32**。事实上，C++/CLI 确实将**long**视为**Int32**。如果他或她习惯于使用不同的编程语言进行编程，那么阅读一种语言的源代码的人很容易误解代码的意图。事实上，大多数语言甚至不会将**long**视为关键字，也不会编译使用它的代码。
>     
>     
> *   FCL 有许多将类型名称作为其方法名称的一部分的方法。例如，**BinaryReader**类型提供诸如**ReadBoolean**、**ReadInt32**、 **ReadSingle**等方法，而**System.Convert**类型提供诸如 **ToBoolean**、**ToInt32**、**ToSingle**等方法。虽然写下面的代码是合法的，但是有**float**的那一行对我来说感觉很不自然，而且看不出这行是否正确：
>     
>     
>     
>     ```
>     BinaryReader br = new BinaryReader(...);
>     float val = br.ReadSingle(); // OK, but feels unnatural
>     Single val = br.ReadSingle(); // OK and feels good 
>     ```
>     
>     
> *   许多专门使用 C# 的程序员往往忘记了可以使用其他编程语言来对抗 CLR，因此，C# 主义潜入类库代码中。例如，微软的 FCL 几乎完全是用 C# 编写的，FCL 团队的开发人员现在已经在库中引入了诸如 **Array**的**GetLongLength**之类的方法，它返回一个**Int64**值，在 C# 中是**long**但在其他语言中没有（如 C++ /CLI）。另一个例子是**System.Linq.Enumerable**的 **LongCount**方法。

在我阅读完整的段落之前，我没有得到他的意见。

* * *

## 回答 #22

> 赞同：75
> 
> 时间：2008-08-18T17:58:11.917

这是一个约定俗成的问题，真的。 `string`只是看起来更像 C/C++ 风格。一般约定是使用您选择的语言提供的任何快捷方式（int/Int for `Int32`）。这也适用于“对象” `decimal`。

从理论上讲，这可能有助于将代码移植到某些未来的 64 位标准中，其中“int”可能意味着`Int64`，但这不是重点，我希望任何升级向导都可以更改任何`int`引用以`Int32`确保安全。

* * *

## 回答 #23

> 赞同：75
> 
> 时间：2012-01-14T22:51:51.313

String( `System.String`) 是基类库中的一个类。string（小写）是 C# 中的保留作品，是 System.String 的别名。Int32 与 int 的情况类似`Boolean vs. bool`。这些 C# 语言特定的关键字使您能够以类似于 C 的样式声明原语。

* * *

## 回答 #24

> 赞同：71
> 
> 时间：2011-04-25T06:06:45.847

`String`不是关键字，可以用作标识符，`string`而是关键字，不能用作标识符。从功能的角度来看，两者都是相同的。

* * *

## 回答 #25

> 赞同：70
> 
> 时间：2012-08-24T15:22:47.460

迟到：我 100% 的时间都使用 CLR 类型（好吧，除非*被迫*使用 C# 类型，但我不记得上次是什么时候）。

根据 Ritchie 的 CLR 书籍，我最初是在几年前开始这样做的。对我来说，所有 CLR 语言最终都必须能够支持一组 CLR 类型是有道理的，因此自己使用 CLR 类型可以提供更清晰、可能更“可重用”的代码。

现在我已经这样做了多年，这是一种习惯，我喜欢 VS 为 CLR 类型显示的颜色。

唯一真正令人沮丧的是自动完成使用 C# 类型，所以我最终重新键入自动生成的类型来指定 CLR 类型。

另外，现在，当我看到“int”或“string”时，我觉得它真的很不对劲，就像我在看 1970 年代的 C 代码一样。

* * *

## 回答 #26

> 赞同：66
> 
> 时间：2019-04-11T08:39:47.030

[@JaredPar](https://stackoverflow.com/users/23283/jaredpar)（C# 编译器的开发人员和多产的 SO 用户！）就这个问题写了一篇[很棒的博客文章。](http://blog.paranoidcoding.com/2019/04/08/string-vs-String-is-not-about-style.html)我认为值得在这里分享。这是对我们主题的一个很好的看法。

> # `string`vs.`String`不是风格辩论

> [...]

> 该关键字`string`在 C# 中具有具体含义。它是`System.String`存在于核心运行时程序集中的类型。运行时本质上理解这种类型，并提供开发人员期望的 .NET 中字符串的功能。它的存在对 C# 至关重要，如果该类型不存在，编译器将在尝试解析一行代码之前退出。因此`string`，在 C# 代码中具有精确、明确的含义。

> 尽管标识符`String`在 C# 中没有具体含义。它是一个标识符，它通过所有名称查找规则，例如`Widget`，`Student`等......它可以绑定到字符串，也可以绑定到另一个程序集中的类型，其目的可能与 . 完全不同`string`。更糟糕的是，它可以以这样的方式定义，例如`String s = "hello"`; 继续编译。

> ```
> class TricksterString { 
>   void Example() {
>     String s = "Hello World"; // Okay but probably not what you expect.
>   }
> }
> 
> class String {
>   public static implicit operator String(string s) => null;
> } 
> ```
> 
> 的实际含义`String`将始终取决于名称解析。这意味着它取决于项目中的所有源文件以及所有引用程序集中定义的所有类型。简而言之，它需要相当多的上下文才能*知道*它的含义。
> 
> 确实，在绝大多数情况下`String`，`string`会绑定到相同的类型。但是使用`String`仍然意味着开发人员将他们的程序留给只有一个正确答案的地方进行解释。当`String`确实绑定到错误的类型时，它可能会让开发人员调试数小时，在编译器团队中提交错误，并且通常会浪费使用`string`.
> 
> 可视化差异的另一种方法是使用此示例：
> 
> ```
> string s1 = 42; // Errors 100% of the time  
> String s2 = 42; // Might error, might not, depends on the code 
> ```
> 
> 许多人会争辩说，虽然这是技术上准确的信息，但使用`String`仍然很好，因为代码库会定义这种名称的类型非常罕见。或者什么时候`String`定义它是一个糟糕的代码库的标志。

> [...]

> 您会看到它`String`是为许多完全有效的目的而定义的：反射帮助器、序列化库、词法分析器、协议等……对于这些库中的任何一个，`String`vs.都会`string`产生实际后果，具体取决于代码的使用位置。

> 所以请记住，当你看到`String`与`string`辩论的时候，这是关于语义的，而不是风格。选择字符串为您的代码库赋予了清晰的意义。选择`String`并没有错，但它为未来的惊喜敞开了大门。

注意：出于存档原因，我复制/粘贴了大部分博客文章。我忽略了一些部分，所以如果可以的话，我建议你跳过并阅读[博客文章。](http://blog.paranoidcoding.com/2019/04/08/string-vs-String-is-not-about-style.html)

* * *

## 回答 #27

> 赞同：53
> 
> 时间：2012-01-14T22:47:05.243

没有区别。

C# 关键字`string`映射到 .NET 类型`System.String`- 它是一个遵循语言命名约定的别名。

同样，`int`映射到`System.Int32`。

* * *

## 回答 #28

> 赞同：50
> 
> 时间：2013-11-01T15:21:42.430

[Daniel Solis 的书中](https://www.goodreads.com/book/show/14975275-illustrated-c-2012)引用了这个问题。

> 所有预定义类型都直接映射到基础 .NET 类型。C# 类型名称（字符串）只是 .NET 类型（String 或 System.String）的别名，因此在语法上使用 .NET 名称可以正常工作，尽管不鼓励这样做。在 C# 程序中，您应该使用 C# 名称而不是 .NET 名称。

* * *

## 回答 #29

> 赞同：44
> 
> 时间：2012-10-08T08:22:11.047

是的，它们之间没有区别，就像`bool`and一样`Boolean`。

* * *

## 回答 #30

> 赞同：44
> 
> 时间：2014-06-11T05:26:14.650

**string**是关键字，不能使用 string 作为标识符。

**字符串**不是关键字，您可以将其用作标识符：

**例子**

```
string String = "I am a string"; 
```

除了关键字问题之外，关键字`string` 是别名 `System.String`，两者完全相同。

```
 typeof(string) == typeof(String) == typeof(System.String) 
```

* * *

## 回答 #31

> 赞同：36
> 
> 时间：2011-08-24T09:25:55.013

两者之间没有区别 -`string`但是，在考虑其他开发人员的源代码时，它似乎是首选选项。

* * *

## 回答 #32

> 赞同：28
> 
> 时间：2012-10-03T10:52:15.897

一个没有在其他地方提到的更喜欢帕斯卡案例的论点`String`：

`System.String`是一个引用类型，并且*引用类型的名称按照约定是帕斯卡大小写*。

* * *

## 回答 #33

> 赞同：25
> 
> 时间：2015-04-07T10:30:13.427

两者都是一样的。区别在于你如何使用它。约定是，

**s**字符串用于变量

**S** string 用于调用其他 String 类方法

像：

```
string fName = "John";
string lName = "Smith";

string fullName = String.Concat(fName,lName);

if (String.IsNullOrEmpty(fName))
{
  Console.WriteLine("Enter first name");
} 
```

* * *

## 回答 #34

> 赞同：22
> 
> 时间：2014-03-07T13:09:55.307

几乎没有区别

C# 关键字字符串映射到 .NET 类型 System.String - 它是一个遵循语言命名约定的别名。

* * *

## 回答 #35

> 赞同：22
> 
> 时间：2018-01-18T13:40:59.227

`string`和之间有一个实际区别`String`。

```
nameof(String); // compiles
nameof(string); // doesn't compile 
```

这是因为`string`is 是一个关键字（在这种情况下是别名），而`String`is 是一个类型。

其他别名也是如此。

```
| Alias     | Type             |
|-----------|------------------|
|  bool     |  System.Boolean  |
|  byte     |  System.Byte     |
|  sbyte    |  System.SByte    |
|  char     |  System.Char     |
|  decimal  |  System.Decimal  |
|  double   |  System.Double   |
|  float    |  System.Single   |
|  int      |  System.Int32    |
|  uint     |  System.UInt32   |
|  long     |  System.Int64    |
|  ulong    |  System.UInt64   |
|  object   |  System.Object   |
|  short    |  System.Int16    |
|  ushort   |  System.UInt16   |
|  string   |  System.String   | 
```

* * *

## 回答 #36

> 赞同：16
> 
> 时间：2015-10-01T17:43:01.330

`string`如果真正看到and之间没有区别是有用的`System.String`：

```
var method1 = typeof(MyClass).GetMethod("TestString1").GetMethodBody().GetILAsByteArray();
var method2 = typeof(MyClass).GetMethod("TestString2").GetMethodBody().GetILAsByteArray();

//...

public string TestString1()
{
    string str = "Hello World!";
    return str;
}

public string TestString2()
{
    String str = "Hello World!";
    return str;
} 
```

两者都产生完全相同的 IL 字节数组：

```
[ 0, 114, 107, 0, 0, 112, 10, 6, 11, 43, 0, 7, 42 ] 
```

* * *

## 回答 #37

> 赞同：15
> 
> 时间：2018-01-05T19:52:48.743

在 C# 中，string 是 System.String (String) 的简写版本。它们基本上是同一个意思。

`bool`和和一样`Boolean`，差别不大。。

* * *

## 回答 #38

> 赞同：14
> 
> 时间：2012-10-04T10:37:21.247

`String`指的是一个字符串对象，它带有用于操作包含的字符串的各种函数。

`string`指原始类型

在 C# 中，它们都编译为 String，但在其他语言中，它们不会，因此如果要处理 String 对象，则应使用 String；如果要处理文字，则应使用 string。

* * *

## 回答 #39

> 赞同：14
> 
> 时间：2014-12-30T13:43:08.630

您不需要使用**导入**命名空间（使用`System`;），`string`因为它是`System.String`.

要了解有关别名的更多信息，您可以查看此[链接](https://www.codeproject.com/Articles/11856/C-Aliases)。

* * *

## 回答 #40

> 赞同：13
> 
> 时间：2018-02-08T08:28:39.130

首先，两者`string`&`String`不一样。有一个区别： `String`不是关键字，可以用作标识符，`string`而是关键字，不能用作标识符。

我试图用不同的例子来解释：首先，当我`string s;` 进入 Visual Studio 并将鼠标悬停在它上面时，我得到（没有颜色）：
[![字符串定义](https://i.stack.imgur.com/wHzSk.jpg)](https://i.stack.imgur.com/wHzSk.jpg)

那说字符串是`System.String`，对吗？该文档位于[https://msdn.microsoft.com/en-us/library/362314fe.aspx](https://msdn.microsoft.com/en-us/library/362314fe.aspx)。第二句说“string 是 .NET Framework 中 String 的别名。”。

* * *

## 回答 #41

> 赞同：10
> 
> 时间：2016-06-04T11:20:00.133

老实说，在实践中，`System.String`和之间通常没有区别`string`。

C# 中的所有类型都是对象，并且都派生自`System.Object`类。一个区别是 string 是 C# 关键字，`String`您可以将其用作变量名。`System.String`是这种类型的常规 .NET 名称，字符串是方便的 C# 名称。`System.String`这是一个简单的程序，它展示了和 字符串之间的区别。

```
string a = new string(new char[] { 'x', 'y', 'z' });
string b = new String(new char[] { 'x', 'y', 'z' });
String c = new string(new char[] { 'x', 'y', 'z' });
String d = new String(new char[] { 'x', 'y', 'z' });
MessageBox.Show((a.GetType() == typeof(String) && a.GetType() == typeof(string)).ToString()); // shows true
MessageBox.Show((b.GetType() == typeof(String) && b.GetType() == typeof(string)).ToString()); // shows true
MessageBox.Show((c.GetType() == typeof(String) && c.GetType() == typeof(string)).ToString()); // shows true
MessageBox.Show((d.GetType() == typeof(String) && d.GetType() == typeof(string)).ToString()); // shows true 
```

@JonSkeet 在我的编译器中

```
public enum Foo : UInt32 { } 
```

正在工作中。我有 Visual Studio 2015 社区。

* * *

## 回答 #42

> 赞同：10
> 
> 时间：2018-02-01T13:13:54.170

杰弗里·里希特写道：

> 另一种思考方式是 C# 编译器自动假定您`using`在所有源代码文件中都有以下指令：

```
using int = System.Int32;
using uint = System.UInt32;
using string = System.String;
... 
```

> 我看到许多开发人员感到困惑，不知道在他们的代码中使用字符串还是字符串。因为在 C# 中字符串（一个关键字）完全映射到 System.String（一个 FCL 类型），**所以没有区别**，都可以使用。

* * *

## 回答 #43

> 赞同：9
> 
> 时间：2014-05-20T14:34:27.217

**String：** String 对象被称为不可变（只读），因为它的值一旦创建就无法修改。看似修改 String 对象的方法实际上会返回一个包含修改的新 String 对象。如果需要修改类字符串对象的实际内容

**string：**字符串类型表示零个或多个 Unicode 字符的序列。string 是 .NET Framework 中 String 的别名。`string`是内在的 C# 数据类型，并且是系统提供的类型“System.String”的别名。C# 规范指出，作为样式问题，关键字 ( **string** ) 优先于完整的系统类型名称（System.String 或 String）。虽然 string 是一种引用类型，但相等运算符（== 和 !=）被定义为比较字符串对象的值，而不是引用。这使得对字符串相等性的测试更加直观。例如：

**字符串和字符串的区别：**

*   `string`通常用于声明，而用于`String`访问静态字符串方法
*   您可以使用`'string'`使用预定义类型的声明字段、属性等`'string'`，因为 C# 规范告诉我这是很好的风格。
*   您可以使用`'String'`系统定义的方法，例如 String.Compare 等。它们最初是在 'System.String' 上定义的，而不是在 'string' 上。`'string'`在这种情况下只是一个别名。
*   您也可以`'String'`在与其他系统通信时使用或“System.Int32”，尤其是在它们符合 CLR 的情况下。即 - 如果我从其他地方获取数据，我会将其反序列化为 System.Int32 而不是“int”，如果定义的来源不是 C# 系统。

* * *

## 回答 #44

> 赞同：9
> 
> 时间：2016-01-20T10:53:01.127

两者没有区别。您可以在代码中使用它们中的任何一个。

`System.String``mscorlib`是在命名空间中定义的类（引用类型）`System`。换句话说，`System.String`是`CLR`.

`string`是关键字`C#`

* * *

## 回答 #45

> 赞同：8
> 
> 时间：2014-07-26T15:40:38.650

在**MSDN 文档**的上下文中，`String`类的文档与**[BCL](http://msdn.microsoft.com/en-us/library/system.string%28v=vs.110%29.aspx)**中的任何其他数据类型（*例如*, `XmlReader`）一样。`StreamReader`

并且`string`被记录为关键字（C# 参考）或任何基本的 C# 语言结构（*例如*, `for`, `while`, `default`）。

**[参考](http://msdn.microsoft.com/en-us/library/362314fe.aspx)**。

* * *

## 回答 #46

> 赞同：8
> 
> 时间：2015-12-28T09:03:50.273

正如所指出的，它们是同一件事，`string`只是`String`.

对于它的价值，我使用字符串来声明类型——变量、属性、返回值和参数。这与其他系统类型的使用一致 -`int, bool, var`等（尽管`Int32`并且`Boolean`也是正确的）。

我`String`在使用 String 类的静态方法时使用，例如`String.Split()`或`String.IsNullOrEmpty()`. 我觉得这更有意义，因为方法属于一个类，这与我使用其他静态方法的方式是一致的。

* * *

## 回答 #47

> 赞同：8
> 
> 时间：2017-03-25T05:04:01.083

`string`如果您这样写，则等于`System.String`在 VS2015 中：

```
System.String str; 
```

编译器将显示潜在的修复以优化它，并且在应用该修复后它将看起来像这样

```
string str; 
```

* * *

## 回答 #48

> 赞同：8
> 
> 时间：2017-10-18T15:11:41.370

我更喜欢使用`string`这种类型，因为我不希望语​​法荧光笔将它与所有其他类混合在一起。虽然它是一个类，但它更像是一个基元，因此我认为不同的高亮颜色是合适的。

如果您右键单击`string`关键字并`Go to definition`从上下文菜单中选择，它将带您进入`String`课程 - 它只是语法糖，但它提高了 imo 的可读性。

* * *

## 回答 #49

> 赞同：8
> 
> 时间：2017-11-10T11:34:20.007

字符串是用于表示文本的**字符**的*顺序集合。*

**String 对象**是表示字符串的 System.Char 对象的*顺序集合；*一个 System.Char 对象对应一个 UTF-16 代码单元。

String 对象的值是 System.Char 对象的顺序集合的内容，并且该值是不可变的（即，它是只读的）。

有关字符串不变性的详细信息，请参阅 msdn 中的不变性和 StringBuilder 类部分。

内存中 String 对象的最大大小为 2GB，即大约 10 亿个字符。

注意：答案是从 msdn 帮助部分中提取的。您可以在备注部分下[的 msdn 字符串类](https://msdn.microsoft.com/en-us/library/system.string(v=vs.110).aspx)主题中查看完整内容

* * *

## 回答 #50

> 赞同：8
> 
> 时间：2018-01-12T09:19:47.253

`string`是 的简称[`System.String`](https://msdn.microsoft.com/en-us/library/system.string(v=vs.110).aspx)。 `String`或者`System.String`是字符串的名称`CTS(Common Type System)`。

* * *

## 回答 #51

> 赞同：7
> 
> 时间：2014-06-20T03:55:31.367

据我所知，`string`这只是 , 的别名，而, , ...`System.String`也存在类似的别名.`bool``object``int``string``System;``System.String`

关于哪个最好用，我想这是一个品味问题。我个人更喜欢`string`，但我这不是宗教问题。

* * *

## 回答 #52

> 赞同：7
> 
> 时间：2016-12-11T00:38:13.490

**String** : 代表一个类

**string** : 代表一个别名

> 这只是 microsoft 的编码约定。

* * *

## 回答 #53

> 赞同：7
> 
> 时间：2018-07-12T01:35:36.687

如您所知`string`，它只是`System.String`. 但是我应该使用什么？这只是个人喜好。

就我而言，我喜欢使用`string`而不是使用`System.String`，因为`String`需要命名空间`using System;`或全名`System.String`。

所以我相信别名 `string`是为了简单而创建的，我喜欢它！

* * *

## 回答 #54

> 赞同：7
> 
> 时间：2018-07-22T16:30:30.873

string 是`System.String`. 唯一的区别是您不需要引用`System.String`命名空间。所以使用字符串比使用字符串更好。

* * *

## 回答 #55

> 赞同：7
> 
> 时间：2018-12-01T17:44:23.683

使用 C# 关键字声明变量是常见的做法。事实上，每种 C# 类型在 .NET 中都有对应的。再举一个例子，C# 中的 short 和 int 映射到 .NET 中的 Int16 和 Int32。因此，从技术上讲，字符串和字符串之间没有区别，但在 C# 中，字符串是 .NET 框架中 String 类的别名。

* * *

## 回答 #56

> 赞同：6
> 
> 时间：2014-06-11T11:15:56.003

string 是.NET Framework中[String](http://msdn.microsoft.com/en-us/library/system.string.aspx)的别名。

“字符串”实际上在哪里`System.String.`

我想说它们是可以互换的，你应该在何时何地使用其中一个没有区别。

最好与您使用的那个保持一致。

对于它的价值，我使用`string`声明类型——变量、属性、返回值和参数。这与其他系统类型的使用一致 -`int, bool, var`等（尽管`Int32`并且`Boolean`也是正确的）。

我在使用 String 类的静态方法时使用 String，例如`String.Split()`或`String.IsNullOrEmpty()`. 我觉得这更有意义，因为方法属于一个类，这与我使用其他静态方法的方式是一致的。

* * *

## 回答 #57

> 赞同：6
> 
> 时间：2018-10-16T17:32:14.500

`String`是 的类`string`。如果您`System`从 using 语句中删除命名空间，您会看到它`String`已经消失但`string`仍然存在。`string`是字符串的关键字。像 所以关键字只是一些使用类的词。这些关键字是由 C# 指定的（所以是 Microsoft，因为 C# 是 Microsoft 的）。简而言之，没有区别。使用. 那没关系。他们是一样的。
`int and Int32
short and Int16
long and Int64`
`string or String`

* * *

## 回答 #58

> 赞同：5
> 
> 时间：2019-05-14T15:15:12.957

用 string 声明一个字符串变量，但在访问其静态成员之一时使用 String 类：

```
String.Format() 
```

多变的

```
string name = ""; 
```

* * *

## 回答 #59

> 赞同：5
> 
> 时间：2019-06-25T12:06:44.463

以上基本都是对的。可以检查一下。只写一个简短的方法

```
public static void Main()
{
    var s = "a string";
} 
```

编译它并打开`.exe`以`ildasm`查看

```
.method private hidebysig static void  Main(string[] args) cil managed
{
  .entrypoint
  // Code size       8 (0x8)
  .maxstack  1
  .locals init ([0] string s)
  IL_0000:  nop
  IL_0001:  ldstr      "a string"
  IL_0006:  stloc.0
  IL_0007:  ret
} // end of method Program::Main 
```

然后更改`var`为`string`and `String`，编译，打开`ildasm`并查看`IL`并没有改变。它还显示语言的创建者只`string`在定义变量时更喜欢（剧透：在调用他们喜欢的成员时`String`）。

* * *

## 回答 #60

> 赞同：4
> 
> 时间：2021-03-01T20:12:00.677

`string`C#和`String`C#之间没有重大区别。

`String`是 System 命名空间中 .NET 框架中的一个类。完全限定名称是`System.String`. 小写字符串是 的别名`System.String`。

但建议`string`在声明变量时使用，例如：

```
string str = "Hello"; 
```

我们可以`String`在使用任何内置方法的同时使用字符串，例如`String.IsNullOrEmpty()`.

这两者之间的另一个区别是在使用之前`String`我们必须在cs文件中导入系统名称空间，并且`string`可以直接使用。

* * *

## 回答 #61

> 赞同：3
> 
> 时间：2019-07-02T05:44:28.613

字符串与字符串的图像结果[www.javatpoint.com](http://www.javatpoint.com) 在 C# 中，是.NET 框架`string`中类的别名。`String`事实上，每种 C# 类型在 .NET 中都有对应的。
**另一个小区别**是，如果使用`String`类，则需要导入命名空间，而使用关键字`System`时则不必导入命名空间`string`

* * *

## 回答 #62

> 赞同：3
> 
> 时间：2019-08-16T14:11:33.877

有很多人（例如 Jeffrey Richter 在他的《[CLR Via C#](https://stackoverflow.com/questions/7074/what-is-the-difference-between-string-and-string-in-c/12863#12863) 》一书中）说`System.String`and `string`， and 和`System.Int32`and之间没有区别`int`，但是我们必须更深入地区分，才能真正从这个问题中榨取汁液，这样我们才能得到所有它的营养价值（编写更好的代码）。

A. 他们是一样的...

1.  给编译器。
2.  给开发商。（我们知道 #1 并最终实现自动驾驶。）

B. 它们在 Famework 和非 C# 上下文中是不同的。不同的...

1.  到非 C# 的其他语言
2.  在优化的 CIL（是 MSIL）上下文（.NET VM 汇编语言）中
3.  在面向平台的上下文中——.NET Framework 或 Mono 或任何 CIL 类型区域
4.  在一本针对多种 .NET 语言（如 VB.NET、F# 等）的书中

所以，真正的答案是，仅仅因为 C# 必须与其他语言共同拥有 .NET 空间，这个问题才存在。

C. 总结...

您在仅限 C# 的目标受众中使用`string`and和其他 C# 类型（询问问题，谁将阅读此代码或使用此库）。`int`对于您的内部公司，如果您只使用 C#，那么请坚持使用 C# 类型。

...并且您在多语言或框架目标受众中使用`System.String`和`System.Int32`（当 C# 不是唯一的受众时）。对于您的内部组织，如果您还使用 VB.NET 或 F# 或任何其他 .NET 语言，或者开发库以供可能的客户使用，那么您应该在这些上下文中使用“Frameworky”类型，以便每个人都能理解您的界面，无论他们来自哪个宇宙。（无论如何，克林贡语是为了什么`System.String`？）

HTH。

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2021-12-18T17:20:06.827

本质上， C#和C#**之间没有区别。** `string``String`

`String`是 .NET 框架中 System 命名空间下的一个类`System.String`，而小写字母`string`是 .NET 的别名`System.String`。

记录这两种类型的全名可以证明这一点

```
string s1= "hello there 1";
String s2 = "hello there 2";

Console.WriteLine(s1.GetType().FullName); // System.String
Console.WriteLine(s2.GetType().FullName); // System.String 
```

建议使用`string`over，`String`但这确实是一个选择问题。大多数开发人员使用`string`在 C# 中声明变量并使用`System.String`类来使用任何内置的字符串方法，例如，`String.IsNullOrEmpty()`方法。

# c - 什么时候应该在嵌入式系统中使用类型抽象

> ID：7084
> 
> 赞同：20
> 
> 时间：2008-08-10T07:50:54.250
> 
> 标签：c, embedded

我曾在许多不同的嵌入式系统上工作过。他们都使用`typedef`s （或`#defines`）来表示诸如`UINT32`.

这是一种很好的技术，因为它可以让程序员了解类型的大小，并使您更加意识到溢出等的机会。

但是在某些系统上，您知道编译器和处理器在项目的整个生命周期内都不会改变。

那么，什么会影响您创建和执行项目特定类型的决定呢？

编辑我想我设法失去了我的问题的要点，也许真的是两个。

使用嵌入式编程，您可能需要特定大小的接口类型，并且还需要处理受限资源，例如 RAM。这是无法避免的，但您可以选择使用编译器中的基本类型。

对于其他一切，类型的重要性较低。
您需要小心不要导致溢出，并且可能需要注意寄存器和堆栈的使用。这可能会导致你`UINT16`，`UCHAR`。但是，使用诸如`UCHAR`可以添加编译器“绒毛”之类的类型。因为寄存器通常较大，一些编译器可能会添加代码以强制将结果转换为类型。

```
我++；
```

可以变成

```
添加 REG,1
与 REG，0xFF
```

这是不必要的。

所以我认为我的问题应该是：-

考虑到嵌入式软件的限制，对于一个需要很多人参与的项目来说，最好的策略是什么——并不是所有的人都具有相同的经验水平。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-08-17T19:15:31.027

我很少使用类型抽象。以下是我的论点，按主观性递增的顺序排列：

1.  在您希望它们适合寄存器的意义上，局部变量与结构成员和数组不同。在 32b/64b 目标上，`int16_t`与本地 int 相比，本地可以使代码变慢，因为编译器必须根据`int16_t`. 虽然 C99 定义了一个`intfast_t`typedef，但 AFAIK 一个普通的 int 也可以放入寄存器中，而且它肯定是一个较短的名称。

2.  喜欢这些 typedef 的组织几乎总是以其中的几个结尾（`INT32, int32_t, INT32_T`无限）。因此，在某种程度上，使用内置类型的组织最好只有一组名称。我希望人们使用来自 stdint.h 或 windows.h 或任何现有的类型定义；当目标没有那个 .h 文件时，添加一个文件有多难？

3.  typedef 理论上可以帮助可移植性，但我从来没有从它们那里得到任何东西。是否有一个有用的系统可以从 32b 目标移植到 16b 目标？是否有一个 16b 系统可以轻松移植到 32b 目标？此外，如果大多数 var 是整数，您实际上会从新目标上的 32 位中获得一些东西，但如果它们是`int16_t`，你不会。而那些难以移植的地方，无论如何都需要人工检查；在你尝试一个端口之前，你不知道它们在哪里。现在，如果有人认为如果你到处都有 typedef 就可以很容易地移植东西——当移植时，很少有系统会发生这种情况，请编写一个脚本来转换代码库中的所有名称。这应该根据“不需要人工检查”的逻辑来工作，并将努力推迟到它真正带来好处的时间点。

4.  现在，如果可移植性可能是 typedef 的理论优势，那么*可读性*肯定会付诸东流。看看 stdint.h: `{int,uint}{max,fast,least}{8,16,32,64}_t`。种类很多。一个程序有很多变量；真的那么容易理解哪些需要`int_fast16_t`，哪些需要`uint_least32_t`吗？我们在它们之间默默地转换了多少次，使它们完全没有意义？（我特别喜欢 BOOL/Bool/eBool/boolean/bool/int 转换。由一个有秩序的组织编写的每个程序都需要 typedefs）。

5.  当然，在 C++ 中，我们可以通过在模板类实例中使用重载运算符和其他内容包装数字来使类型系统更加严格。这意味着您现在将收到格式为“class Number<int,Least,32> has no operator+ overload for argument of type class Number<unsigned long long,Fast,64>, Candidate are...”形式的错误消息。也不要称其为“可读性”。您正确实现这些包装类的机会是微乎其微的，而且大多数时候您将等待无数模板实例化编译。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-10T09:03:24.057

C99 标准有许多标准大小的整数类型。如果您可以使用支持 C99 的编译器（gcc 支持），您会在其中找到这些，`<stdint.h>`并且可以在您的项目中使用它们。

此外，在嵌入式项目中，将类型用作一种“安全网”来处理诸如单位转换之类的事情尤其重要。如果您可以使用 C++，我知道有一些“单元”库可以让您在由 C++ 类型系统（通过模板）定义的物理单元中工作，这些单元被编译为对底层标量类型的操作。例如，这些库不允许您将 a 添加`distance_t`到 a `mass_t`，因为单位不对齐；你实际上会得到一个编译器错误。

即使您不能使用 C++ 或其他允许您以这种方式编写代码的语言，您至少可以使用 C 类型系统来帮助您通过肉眼捕捉到类似的错误。（这实际上是 Simonyi 的匈牙利表示法的初衷。）仅仅因为编译器不会因为在 a 中添加 a 而对你大喊大叫，`meter_t`并不`gram_t`意味着你不应该使用这样的类型。那时，代码审查在发现单元错误方面会更有效率。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-11T04:29:28.650

我的观点是，如果您依赖于最小/最大/特定大小**，不要**仅仅假设（比如说）an`unsigned int`是 32 个字节 -`uint32_t`而是使用（假设您的编译器支持 C99）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-20T14:12:16.360

我喜欢使用 stdint.h 类型来专门定义系统 API，因为它们明确说明了项目的大小。早在 Palm OS 的旧时代，系统 API 是使用一堆从非常经典的 Mac OS 继承而来的“Word”和“SWord”之类的虚无缥缈的类型来定义的。他们进行了清理，改为使用 Int16，它使 API 更易于新手理解，尤其是该系统上奇怪的 16 位指针问题。当他们设计 Palm OS Cobalt 时，他们再次更改了这些名称以匹配 stdint.h 的名称，使其更加清晰并减少了他们必须管理的 typedef 数量。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-24T14:48:54.007

我相信 MISRA 标准建议（要求？）使用 typedef。

从个人的角度来看，使用 typedefs 不会混淆某些类型的大小（以位/字节为单位）。我已经看到主要开发人员尝试使用标准类型（例如 int）和使用自定义类型（例如 UINT32）进行两种开发方式。

如果代码不可移植，那么使用 typedefs 几乎没有什么*真正的*好处，*但是*，如果像我一样，您可以同时使用两种类型的软件（可移植和固定环境），那么保持标准并使用定制类型会很有用。至少就像你说的那样，程序员非常清楚他们正在使用多少内存。另一个需要考虑的因素是你有多“确定”代码不会被移植到另一个环境？我已经看到处理器特定的代码必须被翻译，因为硬件工程师突然不得不更换电路板，这不是一个好的情况，但由于自定义类型定义，它可能会更糟！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-10T08:11:40.730

一致性、便利性和可读性。“UINT32”比“unsigned long long”更具可读性和可写性，这对于某些系统来说是等价的。

此外，编译器和处理器可能在一个项目的生命周期内是固定的，但来自该项目的代码可能会在另一个项目中找到新的生命。在这种情况下，具有一致的数据类型非常方便。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-10T16:43:56.180

如果您的嵌入式系统在某种程度上是一个***安全关键系统***（或类似系统），强烈*建议*（如果不需要）在普通类型上使用 typedef。

作为*传统知识。*之前说过，**MISRA-C**有一个（建议）规则来这样做：

> **规则 6.3（建议）：** 应该使用指示大小和符号的 typedef 来代替基本的数字类型。

*（来自 MISRA-C 2004；这是 MISRA-C 1998 的规则 #13 (adv)）*

* * *

这也适用于该领域的 C++；例如。[JSF C++ 编码标准](http://www.stroustrup.com/JSF-AV-rules.pdf)：

> **AV 规则 209**将创建一个 UniversalTypes 文件来定义供开发人员使用的所有标准类型。类型包括：[uint16、int16、uint32_t 等]

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-06-20T10:07:49.380

使用`<stdint.h>`使您的代码更便于在 PC 上进行单元测试。

当你对所有东西都进行了测试时，它可能会咬你一口，但它仍然会在你的目标系统上中断，因为 an`int`突然只有 16 位长。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-14T03:23:24.137

也许我很奇怪，但我使用 ub、ui、ul、sb、si 和 sl 作为我的整数类型。也许 16 位的“i”看起来有点过时，但我更喜欢 ui/si 的外观而不是 uw/sw。

# cross-browser - 使用 CSS 创建圆角

> ID：7089
> 
> 赞同：257
> 
> 时间：2008-08-10T08:08:21.657
> 
> 标签：cross-browser, rounded-corners, css

如何使用 CSS 创建圆角？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-08-10T08:27:50.540

由于引入了 CSS3，使用 CSS 添加圆角的最佳方法是使用`border-radius`属性。您可以[阅读该属性的规范](http://www.w3.org/TR/css3-background/#the-border-radius)，或在 MDN 上获取一些[有用的实现信息](https://developer.mozilla.org/en-US/docs/Web/CSS/border-radius)：

如果您使用的浏览器[未](http://fmbip.com/litmus/) [实现](http://css3test.com/) `border-radius`（Chrome pre-v4、Firefox pre-v4、IE8、Opera pre-v10.5、Safari pre-v5），那么下面的链接详细介绍了一大堆不同的方法。找到一个适合你的网站和编码风格的，然后就可以了。

1.  [CSS 设计：创建自定义角和边框](http://www.alistapart.com/articles/customcorners/)
2.  [CSS圆角'综述'](http://www.smileycat.com/miaow/archives/000044.php)
3.  [使用 CSS 的 25 种圆角技术](http://www.cssjuice.com/25-rounded-corners-techniques-with-css/)

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-08-10T08:28:52.100

我在创建 Stack Overflow 的早期就看到了这一点，找不到*任何*创建圆角的方法，这不会让我觉得我只是穿过下水道。

[CSS3 确实最终定义](http://24ways.org/2006/rounded-corner-boxes-the-css3-way)了

```
border-radius: 
```

这正是您希望它工作的方式。虽然这在最新版本的 Safari 和 Firefox 中可以正常工作，但在 IE7（我不认为在 IE8 中）或 Opera 中根本不行。

与此同时，它一直是黑客攻击。我很想听听其他人认为目前在 IE7、FF2/3、Safari3 和 Opera 9.5 上执行此操作的最干净的方法。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-07-13T18:20:00.087

如果浏览器不支持，我通常只使用 css 得到圆角，他们会看到带有平角的内容。如果圆角对您的站点不是那么重要，您可以使用下面的这些行。

如果您想使用具有相同半径的所有角，这是一种简单的方法：

```
.my_rounded_corners{
   -webkit-border-radius: 5px;
           border-radius: 5px;
} 
```

但如果你想控制每个角落，这很好：

```
.my_rounded_corners{
    border: 1px solid #ccc;

    /* each value for each corner clockwise starting from top left */
    -webkit-border-radius: 10px 3px 0 20px;
            border-radius: 10px 3px 0 20px;
} 
```

正如您在每组中看到的那样，您具有特定于浏览器的样式，并且在第四行中，我们以标准方式声明，我们假设将来其他人（希望 IE 也是）决定实现该功能以使我们的样式也为他们准备好。

正如其他答案所述，这在 Firefox、Safari、Camino、Chrome 上运行良好。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-07-27T10:58:15.043

If you're interested in creating corners in IE then this may be of use - [http://css3pie.com/](http://css3pie.com/)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-08-10T08:51:29.167

我建议使用背景图片。其他方式则不太好：没有抗锯齿和无意义的标记。这里不是使用 JavaScript 的地方。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-03-13T20:47:18.733

正如 Brajeshwar 所说：使用`border-radius`css3 选择器。至此，您可以分别申请`-moz-border-radius`和`-webkit-border-radius`用于基于 Mozilla 和 Webkit 的浏览器。

那么，Internet Explorer 会发生什么？微软有很多行为让 Internet Explorer 有一些额外的功能并获得更多的技能。

此处：从CSS 中的值`.htc`获取的行为文件。例如。`round-corners``border-radius`

```
div.box {
    background-color: yellow; 
    border: 1px solid red; 
    border-radius: 5px; 
    behavior: url(corners.htc);
} 
```

当然，行为选择器不是一个有效的选择器，但是你可以把它放在一个不同的带有条件注释的 css 文件中（仅适用于 IE）。

行为[HTC 文件](http://www.htmlremix.com/files/20080924-border-radius.zip)

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-21T12:41:10.407

由于在较新版本的 Firefox、Safari 和 Chrome 中实现了对 CSS3 的支持，因此查看“Border Radius”也将有所帮助。

```
-moz-border-radius: 10px;  
-webkit-border-radius: 10px;  
border-radius: 10px; 
```

与任何其他 CSS 简写一样，上面的内容也可以用扩展格式编写，从而实现 topleft、topright 等不同的 Border Radius。

```
-moz-border-radius-topleft: 10px;  
-moz-border-radius-topright: 7px;  
-moz-border-radius-bottomleft: 5px;  
-moz-border-radius-bottomright: 3px;  
-webkit-border-top-right-radius: 10px;  
-webkit-border-top-left-radius: 7px;  
-webkit-border-bottom-left-radius: 5px;  
-webkit-border-bottom-right-radius: 3px; 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-08-12T20:01:45.490

jQuery 是我个人处理这个问题的方式。css 支持很少，图像太繁琐，能够在 jQuery 中选择想要圆角的元素对我来说非常有意义，尽管有些人无疑会反对。我最近在这里的一个项目中使用了一个插件：http://web.archive.org/web/20111120191231/http://plugins.jquery.com:80 [/ project/jquery-roundcorners-canvas](http://web.archive.org/web/20111120191231/http://plugins.jquery.com:80/project/jquery-roundcorners-canvas)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-08-11T17:23:09.197

总是有 JavaScript 方式（参见其他答案），但由于它是纯粹的样式，我有点反对使用客户端脚本来实现这一点。

我更喜欢的方式（尽管它有其局限性）是使用 4 个圆角图像，您将使用 CSS 将它们定位在框的 4 个角中：

```
<div class="Rounded">
  <!-- content -->
  <div class="RoundedCorner RoundedCorner-TopLeft"></div>
  <div class="RoundedCorner RoundedCorner-TopRight"></div>
  <div class="RoundedCorner RoundedCorner-BottomRight"></div>
  <div class="RoundedCorner RoundedCorner-BottomLeft"></div>
</div> 
```

* * *

```
/********************************
* Rounded styling
********************************/

.Rounded {
  position: relative;
}

.Rounded .RoundedCorner {
  position: absolute;
  background-image: url('SpriteSheet.png');
  background-repeat: no-repeat;
  overflow: hidden;

  /* Size of the rounded corner images */
  height: 5px;
  width: 5px;
}

.Rounded .RoundedCorner-TopLeft {
  top: 0;
  left: 0;

  /* No background position change (or maybe depending on your sprite sheet) */
}

.Rounded .RoundedCorner-TopRight {
  top: 0;
  right: 0;

  /* Move the sprite sheet to show the appropriate image */
  background-position: -5px 0;
}

/* Hack for IE6 */
* html .Rounded .RoundedCorner-TopRight {
  right: -1px;
}

.Rounded .RoundedCorner-BottomLeft {
  bottom: 0;
  left: 0;

  /* Move the sprite sheet to show the appropriate image */
  background-position: 0 -5px;
}

/* Hack for IE6 */
* html .Rounded .RoundedCorner-BottomLeft {
  bottom: -20px;
}

.Rounded .RoundedCorner-BottomRight {
  bottom: 0;
  right: 0;

  /* Move the sprite sheet to show the appropriate image */
  background-position: -5px -5px;
}

/* Hack for IE6 */
* html .Rounded .RoundedCorner-BottomRight {
  bottom: -20px;
  right: -1px;
} 
```

如前所述，它有其局限性（圆角框后面的背景应该是纯色的，否则角与背景不匹配），但它适用于其他任何东西。

* * *

**更新：**通过使用精灵表改进了实现。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-16T23:47:47.147

这是我最近做的一个 HTML/js/css 解决方案。IE 中的绝对定位存在 1px 舍入误差，因此您希望容器的宽度为偶数个像素，但它非常干净。

HTML：

```
<div class="s">Content</div> 
```

jQuery：

```
$("div.s")
.wrapInner("<div class='s-iwrap'><div class='s-iwrap2'>")
.prepend('<div class="tr"/><div class="tl"/><div class="br"/><div class="bl"/>'); 
```

CSS：

```
/*rounded corner orange box - no title*/
.s {
    position: relative;
    margin: 0 auto 15px;
    zoom: 1;
}

.s-iwrap {
    border: 1px solid #FF9933;
}

.s-iwrap2 {
    margin: 12px;
}

.s .br,.s .bl, .s .tl, .s .tr {
    background: url(css/images/orange_corners_sprite.png) no-repeat;
    line-height: 1px;
    font-size: 1px;
    width: 9px;
    height: 9px;
    position: absolute;
}

.s .br {
    bottom: 0;
    right: 0;
    background-position: bottom right;
}

.s .bl {
    bottom: 0;
    left: 0;
    background-position: bottom left;
}

.s .tl {
    top: 0;
    left: 0;
    background-position: top left;
}

.s .tr {
    top: 0;
    right: 0;
    background-position: top right;
} 
```

图片只有 18 像素宽，所有 4 个角都挤在一起。看起来像一个圆圈。

注意：您不需要第二个内包装，但我喜欢在内包装上使用边距，以便段落和标题的边距仍然保持边距折叠。您也可以跳过 jquery，只需将内部包装器放在 html 中。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-05-05T03:50:41.100

在 Safari、Chrome、Firefox > 2、IE > 8 和 Konquerer（可能还有其他）中，您可以使用该`border-radius`属性在 CSS 中执行此操作。由于它还不是规范的正式部分，请使用供应商特定的前缀......

### 例子

```
#round-my-corners-please {
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 20px;
} 
```

JavaScript 解决方案通常会添加一堆小`div`s 以使其看起来圆润，或者它们使用边框和负边距来制作 1px 的凹角。有些人可能还会在 IE 中使用 SVG。

IMO，CSS方式更好，因为它很容易，并且会在不支持它的浏览器中优雅地降级。当然，这只是客户端在不支持的浏览器（例如 IE < 9）中不强制执行它们的情况。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-09-21T10:17:04.243

我个人最喜欢这个解决方案，它是一个 .htc，允许 IE 呈现弯曲的边框。

[http://www.htmlremix.com/css/curved-corner-border-radius-cross-browser](http://www.htmlremix.com/css/curved-corner-border-radius-cross-browser)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-30T05:40:27.837

为了表明圆角工作的复杂程度，甚至[雅虎也不鼓励](http://developer.yahoo.com/yui/container/)使用圆角（参见第一个项目符号点）！诚然，他们在那篇文章中只讨论了 1 个像素的圆角，但有趣的是，即使是一家拥有他们专业知识的公司也得出结论，他们大部分时间都[很难让他们工作](http://developer.yahoo.com/yui/container/1pxRoundedCornersIE.html)。

如果您的设计可以在没有它们的情况下生存，那是最简单的解决方案。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-03T18:23:58.980

当然，如果它是一个固定的宽度，使用 CSS 就超级容易，而且一点也不令人反感或费力。当你需要它在两个方向上扩展时，事情就会变得不稳定。一些解决方案有大量的 div 堆叠在一起以实现它。

我的解决方案是告诉设计师，如果他们想使用圆角（暂时），它需要是一个固定的宽度。设计师喜欢圆角（我也喜欢），所以我认为这是一个合理的折衷方案。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-27T20:16:35.290

[Ruzee Borders](http://www.ruzee.com/blog/ruzeeborders/)是我发现的唯一一个基于 Javascript 的抗锯齿圆角解决方案，适用于所有主要浏览器（Firefox 2/3、Chrome、Safari 3、IE6/7/8），并且也是唯一一个在以下情况下有效的解决方案圆角元素和父元素都包含背景图像。它也做边界、阴影和发光。

较新的[RUZEE.ShadedBorder](http://www.ruzee.com/blog/shadedborder)是另一种选择，但它不支持从 CSS 获取样式信息。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-19T09:46:00.310

没有“最好”的方法；有些方法对您有用，也有些方法无效。话虽如此，我在这里发表了一篇关于创建基于 CSS+Image 的流畅圆角技术的文章：

[使用 CSS 和图像的圆角盒子 - 第 2 部分](http://salman-w.blogspot.com/2009/10/box-with-round-corners-using-css-and.html)

这个技巧的概述是使用嵌套的 DIV 和背景图像重复和定位。对于固定宽度布局（固定宽度可拉伸高度），您需要三个 DIV 和三个图像。对于流体宽度布局（可拉伸的宽度和高度），您需要九个 DIV 和九个图像。有些人可能认为它太复杂了，但恕我直言，它是有史以来最简洁的解决方案。没有黑客，没有 JavaScript。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-04-21T21:17:43.043

如果您要使用边框半径解决方案，有这个很棒的网站可以生成 css，使其适用于 safari/chrome/FF。

Anyway, I think your design should not depend on the rounded corner, and if you look at Twitter, they just say F**** to IE and opera users. Rounded corners is a nice to have, and I'm personally ok keeping this for the cool users who don't use IE :).

Now of course it's not the opinion of the clients. Here is the link : [http://border-radius.com/](http://border-radius.com/)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-03-31T13:15:40.773

To addition of htc solutions mention above, here're another solutions and examples to reach [rounded corners in IE](http://starikovs.com/2010/08/24/css3-rounded-corners/).

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-08-22T12:41:23.597

不久前我写了一篇关于此的博客文章，因此有关更多信息，[请参见此处](http://www.kibbee.ca/Blog/viewComments.php?blogid=354)

```
<div class="item_with_border">
    <div class="border_top_left"></div>
    <div class="border_top_right"></div>
    <div class="border_bottom_left"></div>
    <div class="border_bottom_right"></div>
    This is the text that is displayed
</div>

<style>
    div.item_with_border
    {
        border: 1px solid #FFF;
        postion: relative;
    }
    div.item_with_border > div.border_top_left
    {
        background-image: url(topleft.png);
        position: absolute;
        top: -1px;
        left: -1px;     
        width: 30px;
        height: 30px;
        z-index: 2;
    }
    div.item_with_border > div.border_top_right
    {
        background-image: url(topright.png);
        position: absolute;
        top: -1px;
        right: -1px;        
        width: 30px;
        height: 30px;
        z-index: 2;
    }
    div.item_with_border > div.border_bottom_left
    {
        background-image: url(bottomleft.png);
        position: absolute;
        bottom: -1px;
        left: -1px;     
        width: 30px;
        height: 30px;
        z-index: 2;
    }
    div.item_with_border > div.border_bottom_right
    {
        background-image: url(bottomright.png);
        position: absolute;
        bottom: -1px;
        right: -1px;        
        width: 30px;
        height: 30px;
        z-index: 2;
    }   
</style> 
```

它工作得很好。不需要 Javascript，只需要 CSS 和 HTML。用最少的 HTML 干扰其他东西。它与 Mono 发布的内容非常相似，但不包含任何 IE 6 特定的 hack，并且在检查后似乎根本不起作用。另外，另一个技巧是使每个角落图像的内部部分透明，这样它就不会阻挡角落附近的文本。外部不能是透明的，这样它就可以覆盖非圆形 div 的边框。

此外，一旦 CSS3 得到广泛的border-radius 支持，这将是官方制作圆角的最佳方式。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-08-31T12:34:38.177

不要使用 CSS，jQuery 已经被多次提及。如果您需要完全控制元素的背景和边框，请尝试使用[jQuery Background Canvas Plugin 。](http://www.maierhofer.de/en/open-source/jquery-background-canvas-plugin.aspx)它在背景中放置一个 HTML5 Canvas 元素，并允许您绘制所需的每个背景或边框。圆角、渐变等。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-08-31T12:43:04.127

Opera 还不支持边界半径（显然它将在版本 10 之后的版本中）。同时，您可以[使用 CSS 设置 SVG 背景来创建类似的效果](http://dev.opera.com/articles/view/new-development-techniques-using-opera-k/)。

# c# - C# 静态构造函数线程安全吗？

> ID：7095
> 
> 赞同：258
> 
> 时间：2008-08-10T08:23:55.573
> 
> 标签：c#, multithreading, singleton

换句话说，这个 Singleton 实现线程是否安全：

```
public class Singleton
{
    private static Singleton instance;

    private Singleton() { }

    static Singleton()
    {
        instance = new Singleton();
    }

    public static Singleton Instance
    {
        get { return instance; }
    }
} 
```

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2008-08-10T08:46:48.413

在创建任何类的实例或访问任何静态成员之前，静态构造函数保证在每个应用程序域中只运行一次。[https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors)

所示的实现对于初始构造是线程安全的，也就是说，构造 Singleton 对象不需要锁定或空测试。但是，这并不意味着实例的任何使用都会被同步。有多种方法可以做到这一点；我在下面展示了一个。

```
public class Singleton
{
    private static Singleton instance;
    // Added a static mutex for synchronising use of instance.
    private static System.Threading.Mutex mutex;
    private Singleton() { }
    static Singleton()
    {
        instance = new Singleton();
        mutex = new System.Threading.Mutex();
    }

    public static Singleton Acquire()
    {
        mutex.WaitOne();
        return instance;
    }

    // Each call to Acquire() requires a call to Release()
    public static void Release()
    {
        mutex.ReleaseMutex();
    }
} 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2008-12-02T22:46:03.103

虽然所有这些答案都给出了相同的一般答案，但有一个警告。

请记住，泛型类的所有潜在派生都被编译为单独的类型。因此，在为泛型类型实现静态构造函数时要小心。

```
class MyObject<T>
{
    static MyObject() 
    {
       //this code will get executed for each T.
    }
} 
```

编辑：

这是演示：

```
static void Main(string[] args)
{
    var obj = new Foo<object>();
    var obj2 = new Foo<string>();
}

public class Foo<T>
{
    static Foo()
    {
         System.Diagnostics.Debug.WriteLine(String.Format("Hit {0}", typeof(T).ToString()));        
    }
} 
```

在控制台中：

```
Hit System.Object
Hit System.String 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-08-10T08:46:52.577

使用静态构造函数实际上*是*线程安全的。静态构造函数保证只执行一次。

[来自 C# 语言规范](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/classes#static-constructors)：

> 类的静态构造函数在给定的应用程序域中最多执行一次。静态构造函数的执行由在应用程序域中发生的以下第一个事件触发：
> 
> *   类的一个实例被创建。
> *   类的任何静态成员都被引用。

所以是的，您可以相信您的单例将被正确实例化。

Zooba 提出了一个很好的观点（也比我早了 15 秒！）静态构造函数不能保证对单例的线程安全共享访问。这将需要以另一种方式处理。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-11-23T19:34:05.087

这是 C# 单例上上述 MSDN 页面的 Cliffnotes 版本：

始终使用以下模式，您不会出错：

```
public sealed class Singleton
{
   private static readonly Singleton instance = new Singleton();

   private Singleton(){}

   public static Singleton Instance
   {
      get 
      {
         return instance; 
      }
   }
} 
```

除了明显的单例特性之外，它还免费为您提供了这两件事（相对于 C++ 中的单例）：

1.  惰性构造（如果从未调用过，则不构造）
2.  同步

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-10T08:48:33.697

静态构造函数保证每个 App Domain 只触发一次，所以你的方法应该没问题。但是，它在功能上与更简洁的内联版本没有什么不同：

```
private static readonly Singleton instance = new Singleton(); 
```

当您懒惰地初始化事物时，线程安全是一个更大的问题。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2017-01-01T06:37:26.187

静态构造函数将在任何线程被允许访问该类**之前****完成**运行。

 **```
 private class InitializerTest
    {
        static private int _x;
        static public string Status()
        {
            return "_x = " + _x;
        }
        static InitializerTest()
        {
            System.Diagnostics.Debug.WriteLine("InitializerTest() starting.");
            _x = 1;
            Thread.Sleep(3000);
            _x = 2;
            System.Diagnostics.Debug.WriteLine("InitializerTest() finished.");
        }
    }

    private void ClassInitializerInThread()
    {
        System.Diagnostics.Debug.WriteLine(Thread.CurrentThread.GetHashCode() + ": ClassInitializerInThread() starting.");
        string status = InitializerTest.Status();
        System.Diagnostics.Debug.WriteLine(Thread.CurrentThread.GetHashCode() + ": ClassInitializerInThread() status = " + status);
    }

    private void classInitializerButton_Click(object sender, EventArgs e)
    {
        new Thread(ClassInitializerInThread).Start();
        new Thread(ClassInitializerInThread).Start();
        new Thread(ClassInitializerInThread).Start();
    } 
```

上面的代码产生了下面的结果。

```
10: ClassInitializerInThread() starting.
11: ClassInitializerInThread() starting.
12: ClassInitializerInThread() starting.
InitializerTest() starting.
InitializerTest() finished.
11: ClassInitializerInThread() status = _x = 2
The thread 0x2650 has exited with code 0 (0x0).
10: ClassInitializerInThread() status = _x = 2
The thread 0x1f50 has exited with code 0 (0x0).
12: ClassInitializerInThread() status = _x = 2
The thread 0x73c has exited with code 0 (0x0). 
```

即使静态构造函数需要很长时间才能运行，其他线程也会停止并等待。所有线程都读取在静态构造函数底部设置的 _x 的值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-10T08:45:57.977

[公共语言基础设施规范](http://www.ecma-international.org/publications/standards/Ecma-335.htm)保证“类型初始化程序应为任何给定类型只运行一次，除非用户代码显式调用。” （第 9.5.3.1 节。）因此，除非您在松散调用 Singleton::.cctor 上有一些古怪的 IL（不太可能），否则您的静态构造函数将在使用 Singleton 类型之前只运行一次，只会创建一个 Singleton 实例，并且您的 Instance 属性是线程安全的。

请注意，如果 Singleton 的构造函数访问 Instance 属性（甚至是间接访问），则 Instance 属性将为 null。您可以做的最好的事情是检测何时发生这种情况并引发异常，方法是检查属性访问器中的实例是否为非空。静态构造函数完成后，Instance 属性将非空。

正如[Zoomba 的回答](https://stackoverflow.com/questions/7095#7105)指出的那样，您需要使 Singleton 可以安全地从多个线程访问，或者围绕使用单例实例实施锁定机制。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-02T12:37:43.320

只是为了迂腐，但没有静态构造函数之类的东西，而是静态类型初始化器，[这里有一个循环静态构造函数依赖的小](http://1024strongoxen.blogspot.com/2009/11/there-is-no-such-thing-as-c-static.html)演示，说明了这一点。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-03-25T12:19:27.570

尽管其他答案大多是正确的，但静态构造函数还有另一个警告。

根据[ECMA-335 公共语言基础设施](http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-335.pdf) 的第*II.10.5.3.3 节的竞争和死锁*

> 除非从类型初始化程序（直接或间接）调用的某些代码显式调用阻塞操作，否则单独的类型初始化不应造成死锁。

以下代码导致死锁

```
using System.Threading;
class MyClass
{
    static void Main() { /* Won’t run... the static constructor deadlocks */  }

    static MyClass()
    {
        Thread thread = new Thread(arg => { });
        thread.Start();
        thread.Join();
    }
} 
```

原作者是 Igor Ostrovsky，请在[此处](https://devblogs.microsoft.com/pfxteam/static-constructor-deadlocks/ "静态构造函数死锁")查看他的帖子。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-10T23:38:26.520

静态构造函数保证是线程安全的。另外，请查看 DeveloperZen 上关于 Singleton 的讨论：http://web.archive.org/web/20160404231134/http: [//www.developerzen.com/2007/07/15/whats-wrong-with-this-code -1-讨论/](http://web.archive.org/web/20160404231134/http://www.developerzen.com/2007/07/15/whats-wrong-with-this-code-1-discussion/)

# javascript - 在 Internet Explorer 和 Safari 中调试 JavaScript

> ID：7118
> 
> 赞同：18
> 
> 时间：2008-08-10T09:07:19.853
> 
> 标签：javascript, internet-explorer, safari

目前，我真的没有在 Internet Explorer 和[Safari](http://en.wikipedia.org/wiki/Safari_%28web_browser%29)中调试 JavaScript 的好方法。在 Firefox 中，您可以使用[Firebug 的](http://en.wikipedia.org/wiki/Firebug) [日志记录功能](http://getfirebug.com/logging.html)和[命令行功能](http://getfirebug.com/commandline.html)。但是，当我转移到其他浏览器时，这对我没有帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-10T09:24:56.197

对于 Safari，您需要通过首选项启用“开发”菜单（在 Safari 3.1 中；请参阅[Apple 的 Safari 开发常见问题解答中的条目](http://developer.apple.com/internet/safari/faq.html#anchor14)）或通过

```
$ defaults write com.apple.Safari IncludeDebugMenu 1 
```

在 Mac OS X 的终端上。然后从 Develop 菜单中选择 Show Web Inspector 并单击 Console 链接。您的脚本可以使用 window.console.log 写入控制台。

对于 Internet Explorer，Visual Studio 确实是最好的脚本调试器，但如果您没有 Visual Studio，Microsoft 脚本调试器也可以。[IE 团队博客上的这篇文章将](http://blogs.msdn.com/ie/archive/2004/10/26/247912.aspx "Internet Explorer 中的脚本调试")引导您完成安装并连接到 Internet Explorer。

Internet Explorer 8[看起来](http://www.west-wind.com/weblog/posts/271352.aspx)将有一个非常漂亮的脚本调试器，所以如果您真的很喜欢冒险，您可以安装 Internet Explorer 8 测试版并试一试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-10T15:37:25.993

这是@John 所指的适用于 IE、Safari 和 Opera[的 Firebug Lite 。](http://getfirebug.com/lite.html "萤火虫精简版")

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-10T09:20:22.790

IE 博客上的一篇文章*[Internet Explorer](http://blogs.msdn.com/ie/archive/2004/10/26/247912.aspx)*中的脚本调试解释了 Internet Explorer 中脚本调试的不同选项。

这是关于在 Safari 中调试 JavaScript的[Apple 开发人员常见问题解答。](http://developer.apple.com/internet/safari/faq.html#anchor14)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-10T09:24:08.993

Safari 3.0 和 3.1 包括[Drosera](http://trac.webkit.org/wiki/Drosera "茅膏菜") JavaScript 调试器，您可以按照该链接中的说明在 Mac 上启用它。还有 Safari [Web Inspector](http://trac.webkit.org/wiki/Web%20Inspector "Safari 网络检查器") ..

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T15:10:19.697

Visual Studio 2005 具有脚本资源管理器（在“调试”>“Windows”菜单下）。它显示了当前可调试的所有脚本内容的树。以前我通过 IE 的 View > Script Debugger 菜单闯入调试器，但我发现 Script Explorer 是获得我想要的更快的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T11:58:34.110

我在 Internet Explorer 中调试 JavaScript 的最佳方法是通过**Microsoft Script Editor**。调试器功能齐全，非常易于使用。

下面的文章介绍了如何安装和配置**Microsoft 脚本编辑器**。

[操作方法：在 Internet Explorer 中调试 JavaScript](http://web.archive.org/web/20100522094920/http://www.jonathanboutelle.com:80/mt/archives/2006/01/howto_debug_jav.html)

对于 Safari，抱歉没有答案...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-10T14:39:56.780

现在有一个[Firebug Lite](http://getfirebug.com/lite.html)可以在 Internet Explorer、Safari 和 Opera 等其他浏览器上运行。它确实有一组有限的命令，并且不像 Firefox 中的版本那样功能齐全。

如果您在[Visual Studio 2008中使用](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008)[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET) ，还将在 Internet Explorer 中调试 JavaScript。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-12T11:36:59.753

Safari 3.1 不需要任何神奇的命令行首选项——首选项窗口的高级选项卡有一个启用开发菜单复选框。也就是说，如果您可以使用 webkit nightlies ( [http://nightly.webkit.org](http://nightly.webkit.org) )，您可能最好这样做，因为开发人员工具得到了极大的改进，并且您可以更轻松地提交错误报告，请求您想要的功能:D

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-04-04T17:56:35.807

有关如何在 Safari 中调试的完整文档，请参阅[面向 Web 开发人员的 Safari 用户指南的](http://developer.apple.com/safari/library/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/1Introduction/Introduction.html)[调试](http://developer.apple.com/safari/library/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/DebuggingYourWebsite/DebuggingYourWebsite.html#//apple_ref/doc/uid/TP40007874-CH8-SW2)章节。（在大多数情况下，它与 Firebug 的 API 相同。）

在 IE 中，您可以使用[IE Dev Tools](http://www.microsoft.com/downloads/details.aspx?familyid=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en)，但我更喜欢[Firebug Lite](http://getfirebug.com/firebuglite)，正如其他人提到的那样。

# svn - 与 Subversion 1.5（和 1.4 服务器）的合并非常慢

> ID：7173
> 
> 赞同：8
> 
> 时间：2008-08-10T12:11:24.443
> 
> 标签：svn

我在本地从 subversion 1.4 切换到 1.5，我们的服务器仍然运行 1.4。从那时起，每次合并都需要很长时间才能执行。只需要几秒钟的时间现在大约需要 5-10 分钟（或更多）。命令行客户端和乌龟没有区别（所以我们讲windows版本）。

其他人有这种奇怪的现象吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T12:04:16.913

升级到 1.5.3（当它结束时）将显着加快您的合并。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-10T18:07:54.707

SVN 1.5 引入了自动合并跟踪的概念，虽然我认为它需要一个 1.5 的服务器和客户端。有关详细信息，请参阅[Apache Subversion 1.5 发行说明](http://subversion.apache.org/docs/release-notes/1.5.html#merge-tracking)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T13:41:11.570

上周末我们对合并进行了一些性能分析，发现了两个严重的性能问题。其中一个是非常特定于 Windows 的，并且在合并时比所需的速度慢得多，而另一个是使用的网络连接类型。（现有知识的重用太少）

这些修复和其他一些进一步增强合并性能的修复将在 Subversion 1.5.3 中提供，预计将在本周末发布。

[编辑：此性能增强位于假设您的服务器为 1.5+ 的代码路径中]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-10T12:17:17.487

我们在尝试通过客户端将大量文件添加到存储库时遇到了问题，我假设当我们杀死崩溃的客户端时在服务器上创建了孤立进程。我们也必须终止服务器进程并重新启动颠覆服务（我们将 SVN 作为 Windows 服务运行）。我们的 SVN 机器是专用的，所以我们实际上只是重新启动了机器，一切都恢复了正常。

# sharepoint - How can I improve the edit-compile-test loop when developing a SharePoint workflow?

> ID：7174
> 
> 赞同：4
> 
> 时间：2008-08-10T12:12:09.213
> 
> 标签：sharepoint, workflow

Recently I had to develop a SharePoint workflow, and I found the experience quite honestly the most painful programming task I've ever had to tackle. One big problem I had was the problems I encountered when I had to step through it in the debugger.

There's an article on how to debug a SharePoint workflow [here](http://www.andrewconnell.com/blog/archive/2008/06/11/SharePoint-Debugging-and-Logging-Tips-and-Tricks.aspx) that tells you how to set breakpoints etc. This involves copying the .pdb file into the GAC alongside the .dll file containing your workflow. You have to do this from a command prompt (or a batch file) because Windows Explorer doesn't let you view the relevant subdirectory of c:\windows\assembly.

However, if you do this, the next time you try to deploy the workflow from within Visual Studio, it complains that it can't be deployed because "the file may not be signed" and if you attempt to copy the new version of the dll into the GAC, it tells you that the .dll file is locked.

I've found that some of the time, you can get round this by doing an iisreset, but on other occasions you have to restart Visual Studio and there have been frequent times when I've even had to reboot the computer altogether because some mystery process has locked the file. When I don't use the debugger, on the other hand, everything works just fine.

Does anyone know of a simpler way of debugging workflows than this?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-04T17:56:48.630

I've got a lot faster developing SharePoint-Solutions in general (not only Workflows) when i started using [WSPBuilder](http://www.codeplex.com/wspbuilder). WSPBuilder has a Visual Studio Addin called WSPBuilder Extensions and in my opinion the WSPBuilder Extensions do a better job than the infamous [Windows SharePoint Services 3.0 Tools: Visual Studio 2008 Extensions, Version 1.2](http://www.microsoft.com/downloads/details.aspx?FamilyID=7bf65b28-06e2-4e87-9bad-086e32185e68&displaylang=en). Thanks to the WSPBuilder Menu deploy/upgrade/uninstall of a solution is just one click away!

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T19:41:26.890

The SharePoint team is currently working on MOSS extensions for VS 2008 which will allow this type of functionality. This was available in VS 2005 with MOSS extensions, but has to be run off Windows Server with a full MOSS installation and the correct permissions set.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-12T13:37:32.693

One thing that would really help is if the SharePoint team provided interfaces for the SP-specific workflow services needed to run SP workflows. This would allow you to mock those interfaces and run the workflows outside of SP proper. AFAIK, you can't do that today.

I've personally found SharePoint extremely painful to develop against... not just with workflows, but overall. I understand the administrative wins and the end user productivity, but it's a fairly dreadful experience for Joe .NET Developer.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-22T12:59:21.463

As for speeding up the IIS reset, Andrew Connell has some tips here as well [http://www.andrewconnell.com/blog/archive/2006/08/21/3882.aspx](http://www.andrewconnell.com/blog/archive/2006/08/21/3882.aspx)

This brought my IIS reset time from 10+ seconds down to less than 2 seconds.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-02T18:58:49.170

I'm not sure you need to get the pdb file into the GAC. (At least, the fix I'm about to describe works just fine for debugging SharePoint web parts in VS2005, which have a similar problem.)

There's a checkbox marked "Enable Just My Code (Managed Only)" in Tools-->Options-->Debugging; if you uncheck it, then Visual Studio will happily load your pdb's from the bin\Debug folder where it built them. Probably. Can't hurt to try, anyhow...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-07T21:39:48.210

Check out [STSDev](http://www.codeplex.com/stsdev) on CodePlex by SharePoint MVPs like Ted Pattison, Andrew Connell, Scot Hillier, and more.

> STSDEV is a proof-of-concept utility application which demonstrates how to generate Visual Studio project files and solution files to facilitate the development and deployment of templates and components for the SharePoint 2007 platform including Windows SharePoint Services 3.0 (WSS) and Microsoft Office SharePoint Server 2007 (MOSS). Note that the current version of the stsdev utility only supports creating projects with the C# programming language.

Keith

# .net - .NET 中的动画

> ID：7180
> 
> 赞同：6
> 
> 时间：2008-08-10T12:39:20.830
> 
> 标签：.net, animation

使用 .NET 执行动画的好方法是什么？

如果可能的话，我宁愿不使用 Flash，所以我正在寻找可以在我正在制作的新网站上实现不同类型动画的方法的建议。

新网站是为魔术师准备的，所以我想提供动画按钮（卡片翻转等）并嵌入视频。是否可以在不使用 Flash 的情况下做到这一点，或者这是唯一真正的解决方案？我想让它尽可能地跨平台和标准。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-10T13:01:37.680

如果您想在网络上使用 .NET 制作动画，[Silverlight是一个显而易见的选择。](http://silverlight.net/Default.aspx)它可能无法覆盖所有平台，但可以在 IE 和 FireFox 以及 Mac 上运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T14:28:08.550

查看用于动画的[jQuery](http://jquery.com/)跨浏览器 JavaScript 库（它在 Stack Overflow 上使用）。它的参考可以在[http://visualjquery.com/1.1.2.html](http://visualjquery.com/1.1.2.html)找到。

不幸的是，没有 Flash、Silverlight 或其他插件的跨系统视频支持是有限的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-10T12:47:25.570

如果您想避免使用 Flash，JavaScript 可能是要走的路。检查这个：[http ://www.webreference.com/programming/javascript/java_anim/](http://www.webreference.com/programming/javascript/java_anim/)

但是，它不适用于嵌入式视频，因此您只能使用 Flash（或 Silverlight 或[QuickTime](http://en.wikipedia.org/wiki/QuickTime)）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-10T19:38:34.133

Silverlight 是答案，Moonlight 将是 linux 的等价物并很快可用。我们已经对月光进行了一些 beta 测试，发现它在我们所做的大部分 Silverlight 工作中相当稳定。

# svn - 使用 SVN 设置持续集成

> ID：7190
> 
> 赞同：10
> 
> 时间：2008-08-10T13:09:13.780
> 
> 标签：svn, continuous-integration

您会推荐哪些工具来设置 CI 以使用 SVN 进行源代码控制来构建和部署基于 DotNetNuke 构建的多个网站？

我们目前正在考虑配置 Cruise Control 以使用 NAnt、NUnit、NCover 和 Trac 作为测试用例。还有哪些其他组合值得研究？

我们可以完全控制我们的开发环境，因此在这里使用某种形式的 CI 是肯定的，但我也想说服我们的生产服务团队，他们可以使用这些工具可靠地部署到系统测试、uat 甚至生产环境。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-27T12:15:44.227

看看[哈德逊](http://hudson-ci.org/)。它是高度可定制的，而且，恕我直言，比 CruiseControl 更容易。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-10T15:34:37.620

我们将 CruiseControl 与 NUnit、NCover、FxCop、SVN 和一些我们自己编写的用于生成报告的自定义工具一起使用。在我看来，它已被证明（在过去几年中）是一个很好的组合。

令人沮丧的是，MS 将其*所有*集成工具都限制为 VSTS。它的测试框架和 NUnit 一样好，但是你不能使用它的代码覆盖工具或其他任何东西。

我会检查 XNuit - 它看起来很有前途（但目前缺乏 UI）。

我们自动化夜间构建，您可以自动化 UAT 和手动测试构建，但我不确定我们是否想要自动化发布到我们的生产服务器。即使有任何变化都足够重要，以至于无论如何都必须有人监视它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-10T14:01:31.460

我想看看 Team City [http://www.jetbrains.com/teamcity/index.html](http://www.jetbrains.com/teamcity/index.html) 我知道有些人正在研究这个，他们说得很好。

我的公司构建过程是在 FinalBuilder 中完成的，所以我很快就会查看他们的服务器。

CC 非常好，因为您可以让一个 CC 服务器监控另一台 CC 服务器，这样您就可以设置类似的东西 - 当您的构建服务器上的构建完成时，您的测试服务器将唤醒，启动虚拟机并部署您的应用程序。类似的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-10T19:35:18.010

Microsoft 通过将其包含在 Visual Studio 2008 Professional 中并允许从安装了 Framework 3.5 的命令行运行测试来放松对测试平台的限制。我们最近为一个客户做了一个交叉，到目前为止，他们已经能够在不需要 NUnit 的情况下运行所有​​测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-25T16:40:22.763

我们使用 CruiseControl.NET 运行 msbuild 脚本。Msbuild 负责在每次提交、编译和运行 FxCop 和 NCover/NUnit 时从 SVN 进行更新。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-03T22:25:28.307

我建议你看看 NAnt + NUnit ( + NCover) + TeamCity with SVN for your build system。实际上，[Pete W 的想法书中](http://www.acceptedeclectic.com/2008/05/visualsvn-teamcity-nant-sql-server.html)有一篇非常好的文章描述了这种配置（对不起，这个链接已经不存在了！）

# c++ - Nintendo DS Homebrew 中的 Alpha 混合精灵

> ID：7209
> 
> 赞同：9
> 
> 时间：2008-08-10T14:49:10.723
> 
> 标签：c++, c, nintendo-ds

我正在尝试将精灵和背景与[devkitPro](http://www.devkitpro.org/)（包括 libnds、libarm 等）进行 alpha 混合。

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T08:39:44.120

作为一般参考，我曾经写过一篇关于该问题[的小型博客文章。](http://sylvainhb.blogspot.com/2006/09/alpha-blending.html)基本上，您首先必须定义哪个图层与哪个其他图层进行 alpha 混合。AFAIK，

*   源图层必须在目标图层上方才能显示一些混合。这意味着源层的优先级在数值上应该低于目标层的优先级。
*   源层是半透明的，目标层是要被看到的（是的，我觉得这很混乱）。

对于[精灵，具体来说](http://sylvainhb.blogspot.com/2011/09/oam-alpha.html)，您可以通过 3 种方法来实现 alpha 混合，具体取决于您需要什么以及您“准备支付”的费用：

*   您可以通过打开来使所有精灵都具有一些 alpha 混合`BLEND_SRC_SPRITE`...`REG_BLDCNT[_SUB]`不是那么有用。
*   您可以使用 有选择地打开某些精灵的混合`ATTR0_TYPE_BLENDED`。所有精灵（和图层）的混合级别将相同
*   位图类型的精灵使用直接颜色（绕过调色板），所以`ATTR2_PALETTE()`GBA 精灵的字段没用，已经被回收到`ATTR2_ALPHA`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-14T00:32:58.377

DS 上的精灵可以使用[混合控制寄存器](http://www.coranac.com/tonc/text/gfx.htm#sec-blend)进行 alpha 混合。TONC 提供了在主屏幕上进行混合所需的信息，因为寄存器位置是相同的。子屏幕上的 Alpha 混合使用相同的过程，在 1000h 偏移处使用不同的寄存器。

您将看到的寄存器是`REG_BLDMOD`, `REG_COLV`, 和`REG_COLY`用于主屏幕和`REG_BLDMOD_SUB`, `REG_COLV_SUB`, 和`REG_COLY_SUB`用于子屏幕。

另请记住，您必须[更改精灵的图形模式](http://www.coranac.com/tonc/text/regobj.htm#sec-oam-entry)才能启用每个精灵的混合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T16:45:39.677

我已经*很久*没有进行任何 GBA 编程了，但我记得，DS 支持 GBA 支持的大部分（如果不是全部）东西。[此](http://www.coranac.com/tonc/text/gfx.htm)链接有一节介绍如何为 GBA 进行 alpha 混合（第 13.2 节）。我不知道是否有特定于 DS 的方法，但这应该适合你。

# sql - 将 mysql 数据库转换为 sqlite 数据库的最佳方法是什么？

> ID：7211
> 
> 赞同：21
> 
> 时间：2008-08-10T15:03:20.383
> 
> 标签：sql, mysql, database, sqlite

我目前有一个相对较小（4 或 5 个表，5000 行）的 MySQL 数据库，我想将其转换为 sqlite 数据库。由于我可能不得不不止一次地这样做，如果有人能推荐任何有用的工具，或者至少是任何易于复制的方法，我将不胜感激。

（我对所涉及的数据库/机器拥有完全的管理员访问权限。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-10T19:25:58.200

我不得不做几次类似的事情。对我来说最简单的方法是编写一个从一个数据源中提取并为新数据源生成输出的脚本。只需对`SELECT *`当前数据库中的每个表进行查询，然后将所有行转储到`INSERT INTO`新数据库的查询中。您可以将其转储到文件中，也可以将其直接通过管道传输到数据库前端。

它并不漂亮，但老实说，漂亮似乎几乎不是此类事情的主要关注点。这种技术写起来很快，而且很有效。这些是我对此类事情的主要标准。

你可能也想看看[这个线程](http://www.perlmonks.org/index.pl?node_id=150476)。看起来有几个人基本上已经把你需要的东西放在一起了。不过，我并没有深入研究它，所以不能保证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T15:25:27.500

只要 MySQL 转储文件不超过[SQLite](http://www.sqlite.org/lang.html)查询语言，您应该能够相当轻松地迁移：

```
 tgl@moto~$ mysqldump old-database > old-database-dump.sql
 tgl@moto~$ sqlite3 -init old-database-dump.sql new-database 
```

我自己没有试过这个。

*更新：*

看起来您需要对 MySQL 转储进行几次编辑。我会使用 sed 或[Google。](http://www.perlmonks.org/index.pl?node_id=150476)

只是注释语法、auto_increment & TYPE= 声明和转义字符不同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-14T07:13:30.000

以下是转换器列表：

*   [http://www.sqlite.org/cvstrac/wiki?p=ConverterTools](http://www.sqlite.org/cvstrac/wiki?p=ConverterTools)

* * *

另一种效果很好但很少被提及的替代方法是：使用 ORM 类为您抽象出特定的数据库差异。例如，您可以在 PHP ( [RedBean](http://www.redbeanphp.com) )、Python (Django 的 ORM 层、[Storm](https://storm.canonical.com/)、[SqlAlchemy](http://www.sqlalchemy.org) )、Ruby on Rails ( [ActiveRecord](http://ar.rubyonrails.org/) )、Cocoa ( [CoreData](http://developer.apple.com/technologies/mac/data-management.html) )中获得这些

即你可以这样做：

1.  使用 ORM 类从源数据库加载数据。
2.  将数据存储在内存中或序列化到磁盘。
3.  使用 ORM 类将数据存储到源数据库中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-10T15:23:55.693

如果只是几个表，您可能可以用您喜欢的脚本语言编写脚本，并在阅读所有回复或找到合适的工具之前完成所有工作。我愿意。:)

# apache-flex - 是否可以在不继承类的情况下向非动态 ActionScript 3 类添加行为？

> ID：7212
> 
> 赞同：5
> 
> 时间：2008-08-10T15:05:33.140
> 
> 标签：apache-flex, actionscript-3, extension-methods

我想做的是如下所示：

```
FooClass.prototype.method = function():String
{
    return "Something";
}

var foo:FooClass = new FooClass();
foo.method(); 
```

也就是说，我想用一个方法来扩展一个生成的类，而不是通过继承，而是通过原型。

该类是从 WSDL 生成的，它不是动态类，我不想接触生成的代码，因为无论如何它都会被覆盖。

长话短说，我希望在道德上等同于 C# 3:s 的 AS3 扩展方法。

编辑：我接受了 aib 的回答，因为它最符合我的要求——尽管经过进一步思考，它并不能真正解决我的问题，但这是我提出错误问题的错。:) 另外，upmods 的好建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T14:31:44.300

是的，这样的事情是可能的。

实际上，您的示例非常接近解决方案。

尝试

```
foo["method"](); 
```

代替

```
foo.method(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-14T10:55:50.283

@Theo：您将如何解释在 3.0.0.477 中使用默认 flex-config.xml (<strict>true</strict>) 甚至传递给 mxmlc 的 -compiler.strict 参数的以下工作？

Foo.as：

```
package
{
    public class Foo
    {
        public var foo:String;

        public function Foo()
        {
            foo = "foo!";
        }
    }
} 
```

footest.as:

```
package
{
    import flash.display.Sprite;

    public class footest extends Sprite
    {
        public function footest()
        {
            Foo.prototype.method = function():String
            {
                return "Something";
            }

            var foo:Foo = new Foo();
            trace(foo["method"]());
        }
    }
} 
```

请注意，OP 说继承是不可接受的，修改生成的代码也是如此。（如果不是这样，在类定义中添加“动态”可能是最简单的解决方案。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T16:07:33.617

根据您的课程有多少方法，这可能有效：

实际班级：

```
public class SampleClass
{
    public function SampleClass()
    {
    }

    public function method1():void {
        Alert.show("Hi");
    } 
```

快速包装：

```
var actualClass:SampleClass = new SampleClass();

var QuickWrapper:Object = {
    ref: actualClass,
    method1: function():void {
        this.ref.method1();
    },
    method2: function():void {
        Alert.show("Hello!");
    }   
};

QuickWrapper.method1();
QuickWrapper.method2(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T15:38:07.253

不幸的是，@aib 不正确。假设严格模式（默认编译器模式）不可能在 ActionScript 3 中修改非动态类类型的原型。我什至不确定在非严格模式下是否可行。

包装一个选项吗？基本上，您创建一个类，该类采用您从 Web 服务获得的对象之一，并将所有方法调用转发给该对象，但也有自己的方法：

```
public class FooWrapper extends Foo {

    private var wrappedFoo : Foo;

    public function FooWrapper( foo : Foo ) {
        wrappedFoo = foo;
    }

    override public function methodFromFoo( ) : void {
        wrappedFoo.methodFromFoo();
    }

    override public function anotherMethodFromFoo( ) : void {
        wrappedFoo.anotherMethodFromFoo();
    }

    public function newMethodNotOnFoo( ) : String {
        return "Hello world!"
    }

} 
```

当您想使用 a`Foo`时，还需要额外的方法，您需要将`Foo`实例包装在 a 中`FooWrapper`并使用该对象。

这不是最方便的解决方案，有很多输入，如果生成的代码发生更改，您必须`FooWrapper`手动更改类，但除非您可以修改生成的代码以包含您想要的方法或使类动态我不不知道怎么做。

另一种解决方案是在您的构建过程中添加一个修改生成类的源的步骤。我假设您已经有一个从 WSDL 生成代码的步骤，所以您可以做的是在插入您需要的方法之后添加一个步骤。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T20:09:30.463

Monkey patching 是一个（不优雅的）选项。

例如，假设您不喜欢 Flex 3 SpriteAsset.as 返回的默认边框度量 [7,7,7,7]（与 flex 2 不同）这一事实。要解决此问题，您可以：

1.  创建 SpriteAsset.as 的副本并将其添加到您的项目中 /mx/core/SpriteAsset.as
2.  编辑您的本地副本以解决您发现的任何问题
3.  运行你的应用程序

谷歌“ [flex monkey patch](http://www.google.com/search?q=flex+monkey+patch) ”获取更多示例和说明。

# apache - Resin 网络服务器上的用户认证

> ID：7214
> 
> 赞同：2
> 
> 时间：2008-08-10T15:10:41.820
> 
> 标签：apache, configuration, webserver, resin, caucho

我目前的任务是用配置替换`Apache`+ `Resin`Java Web 服务器`Resin-only`。

目前在我们的 apache 设置中，我们使用 .htaccess 和一个小型用户数据库在目录级别提供密码。

有谁知道`Resin`作为 Web 服务器使用时的等效设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-10T16:41:23.897

参见“[树脂鉴定](http://www.caucho.com/resin-3.0/security/authentication.xtp)”

与 apache 最接近的 .htaccess 是使用 XmlAuthenticator 配置基本身份验证。您需要将您的 htpasswd 文件转换为树脂使用的 XML 格式。

按照“快速入门”部分，你会得到你想要的。

# vb.net - 更改滚动条的宽度

> ID：7224
> 
> 赞同：7
> 
> 时间：2008-08-10T15:48:24.083
> 
> 标签：vb.net, scrollbar

是否可以更改表单上滚动条的宽度。这个应用程序是用于触摸屏的，它有点太窄了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T01:24:00.240

这是一个 Windows 窗体应用程序？通过调整我的滚动条控件的“宽度”属性，我能够制作一个非常厚实的滚动条。

![胖滚动条](https://i.stack.imgur.com/k6PAf.png)

您的滚动条是您可以编程访问的东西吗（即它是您添加到表单的控件）？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-10T15:48:41.070

滚动条的宽度由 Windows 控制。您可以在显示属性中调整滚动条宽度，它将影响终端上的所有窗口。

# .net - 通过 POP3 自动检查退回的电子邮件？

> ID：7231
> 
> 赞同：10
> 
> 时间：2008-08-10T16:16:15.370
> 
> 标签：.net, email, pop3, email-bounces

任何人都可以推荐用于检查退回电子邮件和退回原因的软件或 .NET 库吗？我收到退回的电子邮件到我可以阅读的 pop3 帐户。

我需要它来保持我的用户数据库免受无效电子邮件地址的影响，并希望自动执行此操作（将用户标记为无效电子邮件）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-11T03:38:55.647

我做了很多工作来处理退回邮件和不同类型的邮件。如果您想绝对确定您查看的电子邮件确实是特定类型的退回邮件，我强烈建议您使用一个好的过滤器。我曾与[Boogie Tools](http://www.boogietools.com/)合作过，而且效果很好。它可以让您知道它是什么类型的反弹，硬的、软的、瞬态的，或者是否有人试图取消订阅。它有多个 API，包括 .Net，我发现它很容易上手。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T17:28:50.200

使用 TcpClient 很容易做到。打开服务器：

```
TcpClient tcpClient = new TcpClient();
tcpClient.Connect(POP3Server, POP3Port);
NetworkStream stream = tcpClient.GetStream(); 
```

阅读欢迎信息：

```
int read = stream.Read(inBuffer, 0, inBuffer.Length);
string response = Encoding.ASCII.GetString(inBuffer, 0, read);
if (response.IndexOf("+OK") != 0) throw new ...; 
```

写回服务器：

```
byte[] outBuffer = Encoding.ASCII.GetBytes("USER " + account + "\r\n");
stream.Write(outBuffer, 0, outBuffer.Length); 
```

发送 USER 命令。您需要登录，然后才能开始获取消息 - 请参阅 POP3 [RFC](http://www.faqs.org/rfcs/rfc1939.html)以获取完整的命令列表。如果您不想自己动手，请查看这篇[CodeProject 文章](http://www.codeproject.com/KB/IP/despop3client.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-11T02:22:13.990

正如[abfo 所说](https://stackoverflow.com/questions/7231/automatically-check-bounced-emails-via-pop3#7249)，POP3 协议非常简单，获取消息是轻而易举的事。解析消息以获取故障更加困难，并且可靠地解析出导致失败的电子邮件以及失败的原因非常困难。问题是退回邮件没有标准格式，默认格式因 MTA 而异。然后，站点管理员可以调整故障原因，使其更难识别，并且站点管理员可以修改故障消息模板，这几乎是不可能的。

看看您是否可以找到一个 .NET 邮件列表管理器，以及是否可以重新调整退回处理代码的用途。如果做不到这一点，请查看您是否可以更改发送消息的工具，以从唯一（且可逆）的信封发件人（我认为它被称为VERP？）发送每封电子邮件。这样您就不需要扫描电子邮件的正文，您可以通过检查失败消息的收件人地址来判断哪个收件人失败了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T08:43:18.963

感谢您的回答，太好了！我自己做了一些研究，发现[ListNanny](http://www.advancedintellect.com/product.aspx?listnanny) - 使用起来也超级简单，并告诉你反弹的类型。会写一些概念证明，看看我更喜欢哪一个......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T19:58:06.970

你的问题让我意识到我要使用的 Wordpress Newsletter 插件没有退回管理，我也需要一些东西。

我环顾了一会儿，最终选择了免费和开源的[PHPlist 通讯管理器](http://www.phplist.com/)。

他们详细描述[了处理退回的设置，](http://docs.phplist.com/PhpListConfigBounces)并且他们确实具有实验性的[高级退回处理功能](http://docs.phplist.com/AdvancedBounceHandlingInfo)，可让您完全按照您想要的方式自定义退回处理。

Evem 如果您决定不使用 PHPlist，那么阅读他们的做法对您来说将是有用的信息。

# sql-server - 以兼容级别 80 运行 SQL Server 2005 数据库是否会对性能产生负面影响？

> ID：7237
> 
> 赞同：11
> 
> 时间：2008-08-10T16:46:12.640
> 
> 标签：sql-server, database

我们的软件必须能够在 SQL Server 2000 和 2005 上运行。为了简化开发，我们以兼容级别 80 运行 SQL Server 2005 数据库。但是，在某些情况下，SQL 2005 上的数据库性能似乎比 SQL 2000 上慢（我们尚未使用基准确认这一点）。将兼容级别升级到 90 会提高 SQL 2005 服务器的性能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:46:25.677

我想我在某处读到，SQL Server 2005 数据库引擎应该比 SQL Server 2000 引擎快 30%。可能是，您必须在兼容模式 90 下运行数据库才能获得这些好处。

但是我偶然发现了两种情况，与 mssql 2000 相比，使用 mssql 2005 时性能会急剧下降：

1.  参数嗅探：当使用存储过程时，sql server 会在此时计算出一个执行计划，你首先调用该过程。执行计划取决于为该调用提供的参数值。在我们的例子中，通常需要大约 10 秒的程序在 mssql 2005 下运行了几个小时。看看[这里](http://furrukhbaig.wordpress.com/category/parameter-sniffing/)和[这里](http://www.microsoft.com/technet/prodtechnol/sql/2005/qrystats.mspx)。

2.  使用分布式查询时，mssql 2005 对远程服务器上的排序顺序的假设有所不同。默认行为是，服务器将查询中涉及的整个远程表复制到本地 tempdb，然后在本地执行连接。解决方法是使用 OPENQUERY，您可以在其中准确控制从远程服务器传输的结果集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T16:59:30.227

在您将数据库移至 2005 年之后，您是否

使用全面扫描更新统计信息？重建索引？

首先尝试，然后再次检查性能

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-10T17:01:28.523

仅供参考，如果您运行兼容级别 90，则不再支持某些内容，例如旧式外连接`(*= and =*)`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-28T20:33:29.747

您是否在查询中使用**子选择**？

根据我的经验，在 SQL Server 2000 上运行良好的带有子选择的 SELECT 语句可以在 SQL Server 2005 上爬行（它可能慢 10 倍！）。

做一个实验——重新编写一个查询以消除子选择，看看它的性能如何变化。

# c# - 任何人都知道缺少枚举通用约束的好方法吗？

> ID：7244
> 
> 赞同：92
> 
> 时间：2008-08-10T17:14:10.260
> 
> 标签：c#, .net, enums, flags

我想做的是这样的：我有带有组合标记值的枚举。

```
public static class EnumExtension
{
    public static bool IsSet<T>( this T input, T matchTo ) 
        where T:enum //the constraint I want that doesn't exist in C#3
    {    
        return (input & matchTo) != 0;
    }
} 
```

那么我可以这样做：

```
MyEnum tester = MyEnum.FlagA | MyEnum.FlagB

if( tester.IsSet( MyEnum.FlagA ) )
    //act on flag a 
```

不幸的是，C# 的泛型 where 约束没有枚举限制，只有类和结构。C# 不将枚举视为结构（即使它们是值类型），因此我无法添加这样的扩展类型。

有谁知道解决方法？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-09-11T09:12:34.137

**编辑：这现在是 UnconstrainedMelody 的 0.0.0.2 版。**

（根据我[关于枚举约束的博客文章](http://codeblog.jonskeet.uk/2009/09/10/generic-constraints-for-enums-and-delegates/)中的要求。为了一个独立的答案，我在下面包含了基本事实。）

最好的解决方案是等我把它包含在[UnconstrainedMelody](https://github.com/jskeet/unconstrained-melody) ¹中。这是一个库，它采用带有“假”约束的 C# 代码，例如

```
where T : struct, IEnumConstraint 
```

并将其变成

```
where T : struct, System.Enum 
```

通过后期构建步骤。

编写起来应该不会太难`IsSet`……尽管同时满足`Int64`基于 - 和 -`UInt64`的标志可能是棘手的部分。（我闻到了一些辅助方法的出现，基本上允许我将任何标志枚举视为具有基本类型`UInt64`。）

如果你打电话给你，你希望行为是什么

```
tester.IsSet(MyFlags.A | MyFlags.C) 
```

? 它是否应该检查是否设置了*所有*指定的标志？那将是我的期望。

我会在今晚回家的路上尝试这样做......我希望快速了解有用的枚举方法，以使库快速达到可用标准，然后放松一下。

编辑：顺便说一句，我不确定`IsSet`这个名字。选项：

*   包括
*   包含
*   HasFlag（或 HasFlags）
*   IsSet（当然是一个选项）

欢迎提出想法。我敢肯定，无论如何，一切都将是一成不变的……

* * *

¹或者作为补丁提交，当然...

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2018-05-11T09:33:08.660

从 C# 7.3 开始，现在有一种添加枚举约束的内置方法：

```
public class UsingEnum<T> where T : System.Enum { } 
```

来源：[https ://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/where-generic-type-constraint](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/where-generic-type-constraint)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-08-10T22:53:05.613

达伦，如果类型是特定的枚举，那将起作用 - 要使一般枚举起作用，您必须将它们转换为整数（或更可能是 uint）来进行布尔数学运算：

```
public static bool IsSet( this Enum input, Enum matchTo )
{
    return ( Convert.ToUInt32( input ) & Convert.ToUInt32( matchTo ) ) != 0;
} 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-09-13T02:41:25.597

实际上，这是可能的，但有一个丑陋的把戏。但是，它不能用于扩展方法。

```
public abstract class Enums<Temp> where Temp : class {
    public static TEnum Parse<TEnum>(string name) where TEnum : struct, Temp {
        return (TEnum)Enum.Parse(typeof(TEnum), name); 
    }
}
public abstract class Enums : Enums<Enum> { }

Enums.IsSet<DateTimeKind>("Local") 
```

如果需要，您可以使用 as 提供私有`Enums<Temp>`构造函数和公共嵌套抽象继承类，以防止非枚举的继承版本。`Temp``Enum`

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2018-05-18T13:04:18.990

从 C# 7.3 开始，您可以对泛型类型使用 Enum 约束：

```
public static TEnum Parse<TEnum>(string value) where TEnum : Enum
{
    return (TEnum) Enum.Parse(typeof(TEnum), value);
} 
```

如果要使用 Nullable 枚举，则必须保留原始结构约束：

```
public static TEnum? TryParse<TEnum>(string value) where TEnum : struct, Enum
{
    if( Enum.TryParse(value, out TEnum res) )
        return res;
    else
        return null;
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-07-20T07:11:35.043

您可以使用 IL Weaving 和[ExtraConstraints实现此目的](https://github.com/Fody/ExtraConstraints)

**允许您编写此代码**

```
public class Sample
{
    public void MethodWithDelegateConstraint<[DelegateConstraint] T> ()
    {        
    }
    public void MethodWithEnumConstraint<[EnumConstraint] T>()
    {
    }
} 
```

**什么被编译**

```
public class Sample
{
    public void MethodWithDelegateConstraint<T>() where T: Delegate
    {
    }

    public void MethodWithEnumConstraint<T>() where T: struct, Enum
    {
    }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-11-20T11:08:24.343

这不能回答最初的问题，但现在 .NET 4 中有一个名为[Enum.HasFlag](http://msdn.microsoft.com/en-us/library/system.enum.hasflag%28VS.100%29.aspx)的方法可以执行您在示例中尝试执行的操作

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-07-27T14:02:01.490

我这样做的方式是放置一个结构约束，然后在运行时检查 T 是一个枚举。这并不能完全消除问题，但确实在一定程度上减少了问题

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-17T04:51:38.663

使用您的原始代码，您还可以在方法内部使用反射来测试 T 是一个枚举：

```
public static class EnumExtension
{
    public static bool IsSet<T>( this T input, T matchTo )
    {
        if (!typeof(T).IsEnum)
        {
            throw new ArgumentException("Must be an enum", "input");
        }
        return (input & matchTo) != 0;
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-13T03:57:16.527

这是我刚刚编写的一些代码，它们似乎可以按照您的意愿工作，而无需做任何太疯狂的事情。它不仅限于设置为标志的枚举，但如果需要，总可以进行检查。

```
public static class EnumExtensions
{
    public static bool ContainsFlag(this Enum source, Enum flag)
    {
        var sourceValue = ToUInt64(source);
        var flagValue = ToUInt64(flag);

        return (sourceValue & flagValue) == flagValue;
    }

    public static bool ContainsAnyFlag(this Enum source, params Enum[] flags)
    {
        var sourceValue = ToUInt64(source);

        foreach (var flag in flags)
        {
            var flagValue = ToUInt64(flag);

            if ((sourceValue & flagValue) == flagValue)
            {
                return true;
            }
        }

        return false;
    }

    // found in the Enum class as an internal method
    private static ulong ToUInt64(object value)
    {
        switch (Convert.GetTypeCode(value))
        {
            case TypeCode.SByte:
            case TypeCode.Int16:
            case TypeCode.Int32:
            case TypeCode.Int64:
                return (ulong)Convert.ToInt64(value, CultureInfo.InvariantCulture);

            case TypeCode.Byte:
            case TypeCode.UInt16:
            case TypeCode.UInt32:
            case TypeCode.UInt64:
                return Convert.ToUInt64(value, CultureInfo.InvariantCulture);
        }

        throw new InvalidOperationException("Unknown enum type.");
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-03-18T07:49:08.703

我只是想将 Enum 添加为通用约束。

虽然这只是一个很小的辅助方法，[`ExtraConstraints`](https://www.github.com/Fody/ExtraConstraints)但对我来说开销有点太大了。

我决定只创建一个`struct`约束并为`IsEnum`. 为了将变量从 T 转换为 Enum，我首先将其转换为对象。

```
 public static Converter<T, string> CreateConverter<T>() where T : struct
    {
        if (!typeof(T).IsEnum) throw new ArgumentException("Given Type is not an Enum");
        return new Converter<T, string>(x => ((Enum)(object)x).GetEnumDescription());
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-12-22T08:42:06.460

如果有人需要通用 IsSet（可以改进开箱即用的创建），或者字符串到 Enum onfly 转换（使用下面介绍的 EnumConstraint）：

```
 public class TestClass
  { }

  public struct TestStruct
  { }

  public enum TestEnum
  {
    e1,    
    e2,
    e3
  }

  public static class TestEnumConstraintExtenssion
  {

    public static bool IsSet<TEnum>(this TEnum _this, TEnum flag)
      where TEnum : struct
    {
      return (((uint)Convert.ChangeType(_this, typeof(uint))) & ((uint)Convert.ChangeType(flag, typeof(uint)))) == ((uint)Convert.ChangeType(flag, typeof(uint)));
    }

    //public static TestClass ToTestClass(this string _this)
    //{
    //  // #generates compile error  (so no missuse)
    //  return EnumConstraint.TryParse<TestClass>(_this);
    //}

    //public static TestStruct ToTestStruct(this string _this)
    //{
    //  // #generates compile error  (so no missuse)
    //  return EnumConstraint.TryParse<TestStruct>(_this);
    //}

    public static TestEnum ToTestEnum(this string _this)
    {
      // #enum type works just fine (coding constraint to Enum type)
      return EnumConstraint.TryParse<TestEnum>(_this);
    }

    public static void TestAll()
    {
      TestEnum t1 = "e3".ToTestEnum();
      TestEnum t2 = "e2".ToTestEnum();
      TestEnum t3 = "non existing".ToTestEnum(); // default(TestEnum) for non existing 

      bool b1 = t3.IsSet(TestEnum.e1); // you can ommit type
      bool b2 = t3.IsSet<TestEnum>(TestEnum.e2); // you can specify explicite type

      TestStruct t;
      // #generates compile error (so no missuse)
      //bool b3 = t.IsSet<TestEnum>(TestEnum.e1);

    }

  } 
```

如果有人仍然需要 example hot 来创建 Enum 编码约束：

```
using System;

/// <summary>
/// would be same as EnumConstraint_T&lt;Enum>Parse&lt;EnumType>("Normal"),
/// but writen like this it abuses constrain inheritence on System.Enum.
/// </summary>
public class EnumConstraint : EnumConstraint_T<Enum>
{

}

/// <summary>
/// provides ability to constrain TEnum to System.Enum abusing constrain inheritence
/// </summary>
/// <typeparam name="TClass">should be System.Enum</typeparam>
public abstract class EnumConstraint_T<TClass>
  where TClass : class
{

  public static TEnum Parse<TEnum>(string value)
    where TEnum : TClass
  {
    return (TEnum)Enum.Parse(typeof(TEnum), value);
  }

  public static bool TryParse<TEnum>(string value, out TEnum evalue)
    where TEnum : struct, TClass // struct is required to ignore non nullable type error
  {
    evalue = default(TEnum);
    return Enum.TryParse<TEnum>(value, out evalue);
  }

  public static TEnum TryParse<TEnum>(string value, TEnum defaultValue = default(TEnum))
    where TEnum : struct, TClass // struct is required to ignore non nullable type error
  {    
    Enum.TryParse<TEnum>(value, out defaultValue);
    return defaultValue;
  }

  public static TEnum Parse<TEnum>(string value, TEnum defaultValue = default(TEnum))
    where TEnum : struct, TClass // struct is required to ignore non nullable type error
  {
    TEnum result;
    if (Enum.TryParse<TEnum>(value, out result))
      return result;
    return defaultValue;
  }

  public static TEnum Parse<TEnum>(ushort value)
  {
    return (TEnum)(object)value;
  }

  public static sbyte to_i1<TEnum>(TEnum value)
  {
    return (sbyte)(object)Convert.ChangeType(value, typeof(sbyte));
  }

  public static byte to_u1<TEnum>(TEnum value)
  {
    return (byte)(object)Convert.ChangeType(value, typeof(byte));
  }

  public static short to_i2<TEnum>(TEnum value)
  {
    return (short)(object)Convert.ChangeType(value, typeof(short));
  }

  public static ushort to_u2<TEnum>(TEnum value)
  {
    return (ushort)(object)Convert.ChangeType(value, typeof(ushort));
  }

  public static int to_i4<TEnum>(TEnum value)
  {
    return (int)(object)Convert.ChangeType(value, typeof(int));
  }

  public static uint to_u4<TEnum>(TEnum value)
  {
    return (uint)(object)Convert.ChangeType(value, typeof(uint));
  }

} 
```

希望这可以帮助某人。

# algorithm - 谜题：查找最大矩形（最大矩形问题）

> ID：7245
> 
> 赞同：41
> 
> 时间：2008-08-10T17:16:55.137
> 
> 标签：algorithm, language-agnostic, math, geometry

找到适合空白空间的最大面积矩形的最有效算法是什么？

假设屏幕看起来像这样（'#' 表示填充区域）：

```
....................
..............######
##..................
.................###
.................###
#####...............
#####...............
#####............... 
```

一个可能的解决方案是：

```
....................
..............######
##...++++++++++++...
.....++++++++++++###
.....++++++++++++###
#####++++++++++++...
#####++++++++++++...
#####++++++++++++... 
```

通常我会喜欢找出解决方案。虽然这一次我想避免浪费时间自己摸索，因为这对我正在从事的项目有实际用途。有众所周知的解决方案吗？

**Shog9**写道：

> 您的输入是一个数组（正如其他响应所暗示的那样），还是一个任意大小、定位的矩形形式的遮挡列表（在处理窗口位置时可能是窗口系统中的情况）？

是的，我有一个结构可以跟踪放置在屏幕上的一组窗口。我还有一个网格，它跟踪每个边缘之间的所有区域，无论它们是空的还是填充的，以及它们的左边缘或上边缘的像素位置。我认为有一些修改的形式可以利用这个属性。你知道吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2013-11-18T02:20:58.353

我是 Dobb 博士那篇文章的作者，偶尔​​会被问到有关实现的问题。这是一个简单的C语言：

```
#include <assert.h>
#include <stdio.h>
#include <stdlib.h>

typedef struct {
  int one;
  int two;
} Pair;

Pair best_ll = { 0, 0 };
Pair best_ur = { -1, -1 };
int best_area = 0;

int *c; /* Cache */
Pair *s; /* Stack */
int top = 0; /* Top of stack */

void push(int a, int b) {
  s[top].one = a;
  s[top].two = b;
  ++top;
}

void pop(int *a, int *b) {
  --top;
  *a = s[top].one;
  *b = s[top].two;
}

int M, N; /* Dimension of input; M is length of a row. */

void update_cache() {
  int m;
  char b;
  for (m = 0; m!=M; ++m) {
    scanf(" %c", &b);
    fprintf(stderr, " %c", b);
    if (b=='0') {
      c[m] = 0;
    } else { ++c[m]; }
  }
  fprintf(stderr, "\n");
}

int main() {
  int m, n;
  scanf("%d %d", &M, &N);
  fprintf(stderr, "Reading %dx%d array (1 row == %d elements)\n", M, N, M);
  c = (int*)malloc((M+1)*sizeof(int));
  s = (Pair*)malloc((M+1)*sizeof(Pair));
  for (m = 0; m!=M+1; ++m) { c[m] = s[m].one = s[m].two = 0; }
  /* Main algorithm: */
  for (n = 0; n!=N; ++n) {
    int open_width = 0;
    update_cache();
    for (m = 0; m!=M+1; ++m) {
      if (c[m]>open_width) { /* Open new rectangle? */
        push(m, open_width);
        open_width = c[m];
      } else /* "else" optional here */
      if (c[m]<open_width) { /* Close rectangle(s)? */
        int m0, w0, area;
        do {
          pop(&m0, &w0);
          area = open_width*(m-m0);
          if (area>best_area) {
            best_area = area;
            best_ll.one = m0; best_ll.two = n;
            best_ur.one = m-1; best_ur.two = n-open_width+1;
          }
          open_width = w0;
        } while (c[m]<open_width);
        open_width = c[m];
        if (open_width!=0) {
          push(m0, w0);
        }
      }
    }
  }
  fprintf(stderr, "The maximal rectangle has area %d.\n", best_area);
  fprintf(stderr, "Location: [col=%d, row=%d] to [col=%d, row=%d]\n",
                  best_ll.one+1, best_ll.two+1, best_ur.one+1, best_ur.two+1);
  return 0;
} 
```

它从控制台获取输入。例如，您可以通过管道将此文件传递给它：

```
16 12
0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 1 1 0 0 0 0 0 0 0 0 1 0 0 0
0 0 0 1 1 0 0 1 0 0 0 1 1 0 1 0
0 0 0 1 1 0 1 1 1 0 1 1 1 0 1 0
0 0 0 0 1 1 * * * * * * 0 0 1 0
0 0 0 0 0 0 * * * * * * 0 0 1 0
0 0 0 0 0 0 1 1 0 1 1 1 1 1 1 0
0 0 1 0 0 0 0 1 0 0 1 1 1 0 1 0 
0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 
0 0 0 1 1 1 0 0 0 0 0 0 0 0 0 0
0 0 0 0 1 1 0 0 0 0 1 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 
```

在打印其输入后，它将输出：

```
The maximal rectangle has area 12.
Location: [col=7, row=6] to [col=12, row=5] 
```

上面的实现当然没有什么花哨的，但它与 Dobb 博士文章中的解释非常接近，应该很容易翻译成任何需要的东西。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-08-10T17:44:35.237

@lassevk

我找到了来自 DDJ 的参考文章：[最大矩形问题](http://www.ddj.com/184410529)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2019-04-17T00:51:38.053

我是 LeetCode 上的[最大矩形解决方案](https://leetcode.com/problems/maximal-rectangle/solution/)的作者，这是这个答案的基础。

由于基于堆栈的解决方案已经在其他答案中讨论过，我想提出一个`O(NM)`源自用户[morrischen2008](https://leetcode.com/morrischen2008/)的最佳动态编程解决方案。

**直觉**

想象一个算法，我们通过执行以下操作为每个点计算一个矩形：

*   通过向上迭代直到达到填充区域来查找矩形的最大高度

*   通过向左和向右向外迭代直到不适应矩形最大高度的高度来找到矩形的最大宽度

例如找到由黄点定义的矩形： [![在此处输入图像描述](https://i.stack.imgur.com/gmkcw.gif)](https://i.stack.imgur.com/gmkcw.gif)

我们知道最大矩形必须是以这种方式构造的矩形之一（最大矩形必须在其底部有一个点，下一个填充正方形的*高度*高于该点）。

对于每个点，我们定义一些变量：

`h`- 该点定义的矩形的高度

`l`- 由该点定义的矩形的左边界

`r`- 由该点定义的矩形的右边界

这三个变量唯一地定义了该点的矩形。我们可以用 计算这个矩形的面积`h * (r - l)`。所有这些领域的全球最大值是我们的结果。

使用动态规划，我们可以使用前一行中每个点的 、 和 来计算`h`线性`l`时间内下一行中每个点的、和。`r``h``l``r`

**算法**

给定行，我们通过定义三个数组 - 、和来`matrix[i]`跟踪行中每个点的`h`、和。`l``r``height``left``right`

`height[j]`将对应于 的高度`matrix[i][j]`，以此类推，以此类推。

现在的问题变成了如何更新每个数组。

> `height`

`h`定义为从我们的点开始的一行中连续未填充空间的数量。如果有新空间，我们会增加，如果空间已满，我们将其设置为零（我们使用“1”表示空白空间，“0”表示已填充空间）。

```
new_height[j] = old_height[j] + 1 if row[j] == '1' else 0 
```

> `left`：

考虑是什么导致我们的矩形左边界发生变化。由于当前行中出现的所有填充空间实例都已被考虑到当前版本中`left`，唯一影响我们的`left`是如果我们在当前行中遇到填充空间。

结果我们可以定义：

```
new_left[j] = max(old_left[j], cur_left) 
```

`cur_left`比我们遇到的最右边的填充空间大一。当我们向左“展开”矩形时，我们知道它不能展开超过那个点，否则它会跑到填充的空间中。

> `right`：

在这里，我们可以重用我们的推理`left`并定义：

```
new_right[j] = min(old_right[j], cur_right) 
```

`cur_right`是我们遇到的最左边出现的填充空间。

**执行**

```
def maximalRectangle(matrix):
    if not matrix: return 0

    m = len(matrix)
    n = len(matrix[0])

    left = [0] * n # initialize left as the leftmost boundary possible
    right = [n] * n # initialize right as the rightmost boundary possible
    height = [0] * n

    maxarea = 0

    for i in range(m):

        cur_left, cur_right = 0, n
        # update height
        for j in range(n):
            if matrix[i][j] == '1': height[j] += 1
            else: height[j] = 0
        # update left
        for j in range(n):
            if matrix[i][j] == '1': left[j] = max(left[j], cur_left)
            else:
                left[j] = 0
                cur_left = j + 1
        # update right
        for j in range(n-1, -1, -1):
            if matrix[i][j] == '1': right[j] = min(right[j], cur_right)
            else:
                right[j] = n
                cur_right = j
        # update the area
        for j in range(n):
            maxarea = max(maxarea, height[j] * (right[j] - left[j]))

    return maxarea 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-06-23T14:19:57.130

我用Java实现了Dobbs的解决方案。

没有任何保证。

```
package com.test;

import java.util.Stack;

public class Test {

    public static void main(String[] args) {
        boolean[][] test2 = new boolean[][] { new boolean[] { false, true, true, false },
                new boolean[] { false, true, true, false }, new boolean[] { false, true, true, false },
                new boolean[] { false, true, false, false } };
        solution(test2);
    }

    private static class Point {
        public Point(int x, int y) {
            this.x = x;
            this.y = y;
        }

        public int x;
        public int y;
    }

    public static int[] updateCache(int[] cache, boolean[] matrixRow, int MaxX) {
        for (int m = 0; m < MaxX; m++) {
            if (!matrixRow[m]) {
                cache[m] = 0;
            } else {
                cache[m]++;
            }
        }
        return cache;
    }

    public static void solution(boolean[][] matrix) {
        Point best_ll = new Point(0, 0);
        Point best_ur = new Point(-1, -1);
        int best_area = 0;

        final int MaxX = matrix[0].length;
        final int MaxY = matrix.length;

        Stack<Point> stack = new Stack<Point>();
        int[] cache = new int[MaxX + 1];

        for (int m = 0; m != MaxX + 1; m++) {
            cache[m] = 0;
        }

        for (int n = 0; n != MaxY; n++) {
            int openWidth = 0;
            cache = updateCache(cache, matrix[n], MaxX);
            for (int m = 0; m != MaxX + 1; m++) {
                if (cache[m] > openWidth) {
                    stack.push(new Point(m, openWidth));
                    openWidth = cache[m];
                } else if (cache[m] < openWidth) {
                    int area;
                    Point p;
                    do {
                        p = stack.pop();
                        area = openWidth * (m - p.x);
                        if (area > best_area) {
                            best_area = area;
                            best_ll.x = p.x;
                            best_ll.y = n;
                            best_ur.x = m - 1;
                            best_ur.y = n - openWidth + 1;
                        }
                        openWidth = p.y;
                    } while (cache[m] < openWidth);
                    openWidth = cache[m];
                    if (openWidth != 0) {
                        stack.push(p);
                    }
                }
            }
        }

        System.out.printf("The maximal rectangle has area %d.\n", best_area);
        System.out.printf("Location: [col=%d, row=%d] to [col=%d, row=%d]\n", best_ll.x + 1, best_ll.y + 1,
                best_ur.x + 1, best_ur.y + 1);
    }

} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-10T17:30:04.190

@lassevk

```
 // 4\. Outer double-for-loop to consider all possible positions 
    //    for topleft corner. 
    for (int i=0; i < M; i++) {
      for (int j=0; j < N; j++) {

        // 2.1 With (i,j) as topleft, consider all possible bottom-right corners. 

        for (int a=i; a < M; a++) {
          for (int b=j; b < N; b++) { 
```

哈哈... O(m2 n2).. 这可能是我想出的。

我看到他们继续开发优化...看起来不错，我会读一读。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-18T18:56:40.203

用纯 Javascript 实现基于堆栈的算法（具有线性时间复杂度）：

```
function maxRectangle(mask) {
  var best = {area: 0}
  const width = mask[0].length
  const depth = Array(width).fill(0)
  for (var y = 0; y < mask.length; y++) {
    const ranges = Array()
    for (var x = 0; x < width; x++) {
      const d = depth[x] = mask[y][x] ? depth[x] + 1 : 0
      if (!ranges.length || ranges[ranges.length - 1].height < d) {
        ranges.push({left: x, height: d})
      } else {
        for (var j = ranges.length - 1; j >= 0 && ranges[j].height >= d; j--) {
          const {left, height} = ranges[j]
          const area = (x - left) * height
          if (area > best.area) {
            best = {area, left, top: y + 1 - height, right: x, bottom: y + 1}
          }
        }
        ranges.splice(j+2)
        ranges[j+1].height = d
      }
    }
  }
  return best;
}

var example = [
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],
[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]

console.log(maxRectangle(example))
```

# unit-testing - 如何让初级程序员写测试？

> ID：7252
> 
> 赞同：109
> 
> 时间：2008-08-10T17:34:46.630
> 
> 标签：unit-testing, testing

我们有一个初级程序员，他根本没有编写足够的测试。
我必须每两个小时唠叨他一次，“你写过考试吗？”
我们尝试过：

*   表明设计变得更简单
*   展示它可以防止缺陷
*   让它成为一种自我的事情，只说糟糕的程序员不会
*   这个周末有 2 个团队成员必须来上班，因为他的代码有一个 NULL 引用，而他没有测试它

我的工作需要高质量的稳定代码，而且通常每个人都“明白”并且没有必要推动测试。我们知道我们可以让他编写测试，但我们都知道有用的测试是在你投入其中时编写的。

你知道更多的动机吗？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-08-10T18:17:34.983

这是*最难做的事情*之一。让你的人*得到它*。

有时，帮助初级程序员“掌握”并从高级程序员那里学习正确技术的最佳方法之一就是进行一些结对编程。

试试这个：在即将到来的项目中，将初级人员与你自己或另一位高级程序员配对。他们应该一起工作，轮流“开车”（在他们的键盘上打字）和“指导”（看着司机的肩膀，边走边指出建议、错误等）。这似乎是一种资源浪费，但你会发现：

1.  这些人一起可以快速生成更高质量的代码。
2.  如果您的初级人员学到了足够的知识，可以在高级人员的指导下沿着正确的道路“得到它”（例如，“好的，现在在我们继续之前，让我们在测试中编写此功能。”）这将非常值得您提供资源致力于它。

也许你的团队中也有人提供了 Kate Rhodes 的[单元测试 101](http://www.masukomi.org/talks/unit_testing/index.html#1)演示文稿，我认为这是让人们对测试感到兴奋的好方法，如果交付得好的话。

您可以做的另一件事是让您的 Jr. Devs 练习[保龄球游戏 Kata](http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata)，这将帮助他们学习测试驱动开发。它在 java 中，但可以很容易地适应任何语言。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-08-10T22:59:14.383

在每次提交之前进行代码审查（即使是 1 分钟“我已经更改了这个变量名”），并且作为代码审查的一部分，审查任何单元测试。

在测试到位之前，不要在提交上签字。

（另外——如果他的工作没有经过测试——为什么一开始就在生产环境中？如果没有经过测试，不要让它进来，那么你就不必在周末工作）

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-08-22T15:46:16.663

对于我自己，我已经开始坚持将我发现和修复的每一个错误都表达为一个测试：

1.  “嗯，这样不对……”
2.  发现可能的问题
3.  写个测试，显示代码失败
4.  解决问题
5.  显示新代码通过
6.  如果原始问题仍然存在，则循环

即使在敲打东西的时候，我也会尝试这样做，而且我几乎在同一时间完成了，只是已经有了部分测试套件。

（我并不生活在商业编程环境中，并且通常是唯一一个从事特定项目的编码人员。）

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-08-11T02:07:46.593

想象一下，我是一个模拟程序员，名叫... Marco。想象一下，我不久前刚从学校毕业，从来没有真正需要写过测试。想象一下，我在一家没有真正执行或要求这样做的公司工作。好的？好的！现在想象一下，该公司正在转向使用测试，他们正试图让我参与其中。我会对到目前为止提到的项目做出一些刻薄的反应，就好像我没有对此进行任何研究一样。

让我们从创建者开始：

> 表明设计变得更简单。

怎样才能写得更多，让事情变得更简单。我现在必须密切关注获得更多案件等。如果你问我，这会让事情变得更加复杂。给我详细的信息。

> 展示它可以防止缺陷。

我知道。这就是为什么它们被称为测试。我的代码很好，我检查了它是否有问题，所以我看不出这些测试有什么帮助。

> 让它成为一种自负的事情，说只有糟糕的程序员才不会。

哦，所以你认为我是一个糟糕的程序员，只是因为我没有做太多常用的测试。我被侮辱了，对你很生气。我宁愿得到帮助和支持，而不是空谈。

> @[贾斯汀标准](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7274)：在新项目开始时，将初级人员与您自己或其他高级程序员配对。

哦，这非常重要，以至于将花费资源确保我了解事情是如何完成的，并在事情如何完成方面帮助我。这很有帮助，我可能会开始做更多。

> @Justin [Standard](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7274)：阅读Kate Rhodes 的[单元测试 101](http://www.masukomi.org/talks/unit_testing_talk_2/index.xul?data=slide_data.txt#page1)演示文稿。

啊，那是一个有趣的演示，它让我想到了测试。它敲定了一些我应该考虑的观点，它可能会稍微改变我的观点。

我希望看到更多引人入胜的文章和其他工具来帮助我坚持认为这是做事的正确方式。

> @Dominic [Cooney](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7276)：花点时间分享一下测试技巧。

啊，这有助于我了解对技术的期望，它在我的知识包里放了更多的东西，我可能会再次使用。

> @Dominic [Cooney](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7276)：回答问题、例子和书籍。

有一个重要的人（人）来回答问题很有帮助，它可能会让我更有可能尝试。好的例子很棒，它给了我一些目标，以及一些可供参考的东西。与此直接相关的书籍是很好的参考。

> @[亚当海尔](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7265)：惊喜评论。

说什么，你突然出现了我完全没有准备好的东西。我对此感到不舒服，但会尽力而为。我现在会对再次出现这种情况感到害怕和轻微的担心，谢谢。然而，恐吓策略可能奏效了，但它确实是有代价的。但是，如果没有其他方法，这可能只是需要的推动。

> @ [Rytmis](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7267)：项目只有在有测试用例时才被认为已完成。

哦，有趣。我知道我现在真的必须这样做，否则我什么也做不了。这是有道理的。

> @jmorris [：](https://stackoverflow.com/questions/7252/how-to-make-junior-programmers-write-tests#7259)摆脱/牺牲。

*瞪眼，瞪眼，瞪眼*——我有机会学习，在支持和帮助下，我可以成为团队中非常重要和功能性的一员。这是我现在的障碍之一，但不会持续太久。但是，如果我只是不明白，我明白我会去的。我想我会得到它。

* * *

最后，我团队的支持在这一切中起了很大的作用。让一个人花时间提供帮助，让我开始养成好习惯总是受欢迎的。然后，之后有一个良好的支持网络会很棒。以后有人来几次，检查一些代码，看看一切是如何进行的，而不是在审查本身，而是作为一次友好的访问，总是会很感激的。

推理、准备、教学、跟进、支持。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-08-10T18:00:35.830

我注意到很多程序员在理性的层面上看到了测试的价值。如果您听说过诸如“是的，我知道我应该对此进行测试，但我确实需要快速完成此操作”之类的话，那么您就会明白我的意思了。然而，在情感层面上，他们觉得只有在编写真正的代码时才能完成某些事情。

因此，目标应该是以某种方式让他们了解测试实际上是衡量某事“完成”时间的**唯一**方法，从而赋予他们编写测试的内在动力。

不过，恐怕这比它应该做的要难得多。你会听到很多借口，比如“我真的很着急，我稍后会重写/重构它，然后添加测试”——当然，后续行动永远不会发生，因为令人惊讶的是，他们'*下周 一样 忙*.

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-08-10T19:53:27.427

这是我要做的：

*   第一次出去……“我们要一起做这个项目。我写测试，你写代码。注意我是怎么写测试的，因为这就是我们做事的方式就在这里，这就是我对你的期望。”

*   之后……“你完成了？太好了！首先让我们看看推动你开发的测试。哦，没有测试？让我知道什么时候完成，我们将重新安排查看你的代码。如果你'如果需要帮助来制定测试，请告诉我，我会帮助你的。”

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-24T14:25:49.117

他已经在这样做了。真的。他只是没有写下来。不服气？观看他完成标准开发周期：

*   写一段代码
*   编译它
*   跑看看它做了什么
*   写下一段代码

第三步是测试。他已经进行了测试，他只是手动进行。问他这个问题：“你怎么知道明天的代码仍然有效？” 他会回答：“就是这么少的代码！”

问：“下周怎么样？”

当他没有得到答案时，问：“你希望你的程序如何告诉你，当一个改变破坏了昨天工作的东西？”

这就是自动单元测试的全部意义所在。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-08-14T00:28:04.143

作为一名初级程序员，我仍在努力养成编写测试的习惯。显然，养成新习惯并不容易，但考虑到什么能让这对我有用，我必须 +1 关于代码审查和指导/结对编程的评论。

可能还值得强调测试的长期目的：确保昨天有效的东西今天、下周和下个月仍然有效。我之所以这么说，是因为在浏览答案时，我没有看到提到的内容。

在进行代码审查时（如果您决定这样做），请确保您的年轻开发人员知道这不是要让他失望，而是要让*代码变得更好。*因为这样他的信心就不太可能受到损害。这很重要。另一方面，知道自己知之甚少也是如此。

当然，我真的什么都不知道。但我希望这些话是有用的。

> 编辑：[[贾斯汀标准](https://stackoverflow.com/users/92/justin-standard)]
> 
> 不要让自己失望，你要说的几乎是正确的。
> 
> 关于代码审查的观点：您会发现不仅初级开发人员会在此过程中学习，审查者也会学习。如果你把它变成一个协作过程，代码审查中的每个人都会知道。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-08-10T17:58:14.057

坦率地说，如果你不得不付出*那么*多努力让他做某事，那么你可能不得不接受这样的想法，即他可能不适合球队，可能需要离开。现在，这并不一定意味着解雇他……这可能意味着在公司中找到更适合他的技能的其他地方。但如果没有其他地方......你知道该怎么做。

我假设他也是一个相当新的员工（< 1 年）并且可能最近离开学校......在这种情况下，他可能不习惯在公司环境中如何运作。像我们大多数人在大学里可以逃脱的事情。

如果是这种情况，我发现的一件事是进行一种“惊喜新员工审查”。如果你以前从来没有做过也没关系……他不会知道的。让他坐下，告诉他你要检查他的表现并向他展示一些真实的数字……拿你的正常审查表（你确实有一个正式的审查过程，对吗？），如果你愿意，可以改变标题，这样看起来官员并向他展示他的立场。如果你在一个非常正式的环境中向他展示不做测试会对他的表现评级产生不利影响，而不是仅仅“唠叨”他，他希望能明白这一点。你必须向他表明他的行为实际上会影响他，无论是明智的还是其他的。

我知道，你可能不想这样做，因为这不是官方的……但我认为你有理由这样做，而且这可能比解雇他并招募新人要便宜得多。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-08-18T19:42:34.357

作为一名初级程序员，我认为 Id 揭示了当我发现自己处于与你的初级程序员类似情况时的感受。

当我刚从大学出来时，我发现它严重地让我无法应对现实世界。是的，我知道一些 JAVA 基础知识和一些哲学（不要问），但仅此而已。当我第一次得到我的工作时，至少可以说有点令人生畏。让我告诉你，我可能是周围最大的牛仔之一，我会拼凑一些没有评论/测试/文档的小错误修复/算法，然后将其发送出去。

我很幸运能够在一位善良且*非常有*耐心的高级程序员的监督下。对我来说幸运的是，他决定和我坐下来，花 1 到 2 周的时间来检查我被破解的代码。他会解释我哪里出错了，c 和指针的细节（男孩这样做让我感到困惑！）。我们设法在大约一周内编写了一个相当不错的类/模块。我只能说，如果高级开发人员没有花时间帮助我走上正确的道路，我可能不会坚持很长时间。

令人高兴的是，两年后，我希望我的一些同事甚至会认为我是一个普通的程序员。

带回家积分

1.  大多数大学都非常不擅长让学生为现实世界做好准备
2.  配对编程真的帮助了我。这并不是说它会帮助每个人，但它对我有用。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-18T01:05:51.377

如果这是您关心的问题，请将它们分配给不需要“高质量稳定代码”的项目并让 jr. 开发商失败。让他们成为“周末进来”修复错误的人。多吃午饭，谈论软件开发实践（不是讲座，而是讨论）。随着时间的推移，他们将获得并发展最佳实践来完成分配给他们的任务。

谁知道呢，他们甚至可能想出比你的团队目前使用的技术更好的东西。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-08-10T17:49:22.873

如果初级程序员或任何人没有看到测试的价值，那么就很难让他们去做......时期。

我会让初级程序员牺牲他们的周末来修复错误。他的行为（或缺乏行为）不会直接影响他。此外，请明确指出，如果他不提高自己的测试技能，他将不会看到晋升和/或加薪。

最后，即使有你所有的帮助、鼓励和指导，他也可能不适合你的团队，所以让他去找一个能做到的人吧。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-08-11T00:35:42.693

我赞同 RodeoClown 关于代码审查每个提交的评论。一旦他完成了几次，他就会养成测试东西的习惯。

我不知道你是否需要阻止这样的提交。在我的工作场所，每个人都可以免费提交所有内容，所有 SVN 提交消息（带有差异）都会通过电子邮件发送给团队。

注意：如果您打算这样做，您*真的*需要[Thunderbird colour-diffs 插件。](https://addons.mozilla.org/en-US/thunderbird/addon/4268)

我的老板或我自己（两个“高级”编码人员）最终会阅读提交，如果有任何诸如“你忘记添加单元测试”之类的东西，我们只需轻扫一封电子邮件或去和那个人聊天，解释他们为什么需要的单元测试或其他什么。鼓励其他人也阅读提交，因为这是查看正在发生的事情的好方法，但初级开发人员不会发表太多评论。

您可以通过定期说诸如“嘿，鲍勃，你看到我今天早上所做的提交了吗？我发现了一个巧妙的技巧，你可以做任何事情，阅读提交并查看这个怎么运作！”

注意：我们有 2 名“高级”开发人员和 3 名初级开发人员。这可能无法扩展，或者您可能需要与更多开发人员一起调整流程。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-08-13T19:20:30.470

教导他/她是他/她的导师的责任。你教他/她如何测试的效果如何。你和他结对编程吗？Junior 很可能不知道如何为 xyz 设置一个好的测试。

作为一名刚毕业的大三学生，他知道许多概念。一些技巧。一些经验。但归根结底，所有的青少年都是有潜力的。几乎他们开发的每一个功能，都会有他们以前从未做过的新东西。当然，Junior 可能已经为课堂上的一个项目做了一个简单的状态模式，打开和关闭“门”，但从来没有在现实世界中应用这些模式。

他/她只会和你教得一样好。如果他们能够“得到它”，您认为他们首先会担任初级职位吗？

以我的经验，初级人员被雇用并承担与高级人员几乎相同的责任，但只是报酬较低，然后当他们开始步履蹒跚时就被忽视了。如果我看起来很痛苦，请原谅我，因为我是。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-08-29T18:55:24.813

1.  使代码覆盖率成为评论的一部分。
2.  将“编写暴露错误的测试”作为修复错误的先决条件。
3.  在签入代码之前需要一定程度的覆盖率。
4.  找一本关于测试驱动开发的好书，用它来展示测试优先如何加速开发。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-11-07T07:13:08.083

许多心理学和有用的“指导”技巧，但老实说，这只是归结为“如果你明天还想有工作就写测试”。

你可以用任何你认为合适的术语来表达它，苛刻的或柔和的，没关系。但事实是，程序员并不仅仅是把代码放在一起并签入——他们得到报酬是仔细地把代码放在一起，然后把测试放在一起，然后测试他们的代码，然后把整个东西都签进去。（至少根据您的描述，听起来就是这样。）

因此，如果有人要拒绝做他们的工作，请向他们解释他们明天可以待在家里，然后你会雇用一个会做这项工作的人。

再一次，如果你认为有必要，你可以温和地做这一切，但很多人只需要*在现实世界*中狠狠地一记耳光，你会给他们一个帮助。

祝你好运。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-02-24T14:35:34.600

暂时将他的工作描述更改为仅编写测试和维护测试。我听说许多公司在刚开始时会为没有经验的新人这样做一段时间。

此外，在他担任该角色时提出挑战：编写将 a) 在当前代码上失败 a) 满足软件要求的测试。希望这会让他创建一些可靠而彻底的测试（改进项目），并让他在重新集成到核心开发时更好地编写测试。

编辑>满足软件的要求，这意味着当代码从未打算或不需要考虑该测试用例时，他不仅仅是编写测试来故意破坏代码。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-08-10T18:19:17.727

如果您的同事缺乏编写测试的经验，那么他或她可能难以在超出简单情况的情况下进行测试，这表明测试不充分。这是我会尝试的：

*   花一些时间与您的同事分享测试技术，例如依赖注入、寻找边缘案例等。
*   提供回答有关测试的问题。
*   对测试进行代码审查一段时间。请您的同事回顾您所做的更改，这些更改堪称良好测试的典范。查看他们的评论，看看他们是否真的在阅读和理解您的测试代码。
*   如果有些书特别适合您团队的测试理念，请给他或她一份。如果您的代码审查反馈或讨论参考了这本书，这可能会有所帮助，以便他或她有一个线程可以接受和关注。

我不会特别强调羞耻/内疚的因素。值得指出的是，测试是一种被广泛采用的良好实践，编写和维护良好的测试是一种职业礼貌，因此您的团队成员不需要在周末工作，但我不会强调这些点。

如果你真的需要“变得强硬”，那就建立一个公正的制度；没有人喜欢觉得自己被孤立了。例如，您的团队可能需要代码来维持一定水平的测试覆盖率（可以玩游戏，但至少可以自动化）；需要新代码进行测试；要求审查人员在进行代码审查时考虑测试的质量；等等。建立该系统应该来自团队的共识。如果您仔细地缓和讨论，您可能会发现其他根本原因，您的同事的测试不是您所期望的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-08-13T19:34:12.707

@jsmorris

我曾经让高级开发人员和“架构师”在电子邮件中斥责我和一名测试人员（这是我大学毕业后的第一份工作），因为我没有熬夜并在前一天晚上完成了如此“简单”的任务。我们一整天都在忙，晚上 7 点就叫停了，我从那天中午 11 点开始就一直在吃午饭，并且至少两次纠缠我们团队的每个成员寻求帮助。

我回应并抄送团队：“我对你失望了一个月了。我从来没有得到团队的帮助。如果你需要我，我会在街对面的咖啡店。我是抱歉，我无法调试几乎所有东西都依赖的 12 参数、800 行方法。”

在咖啡店冷静了一个小时后，我回到办公室，抓起我的垃圾离开了。几天后，他们打电话给我，问我是否进来，我说我会，但我有一个面试，也许明天。

“那你辞职了？”

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-08-29T19:19:31.150

在您的源存储库中：在每次提交之前使用钩子（例如 SVN 的预提交钩子）

在该挂钩中，检查每种方法是否存在至少一个用例。使用可以通过预提交挂钩轻松实施的单元测试组织约定。

在集成服务器上编译所有内容并使用测试覆盖率工具定期检查测试覆盖率。如果代码的测试覆盖率不是 100%，请阻止开发人员的任何提交。他应该向您发送覆盖 100% 代码的测试用例。

只有自动检查才能在项目中很好地扩展。您无法手动检查所有内容。

开发人员应该有办法检查他的测试用例是否覆盖了 100% 的代码。那样的话，如果他没有提交 100% 测试过的代码，那是他自己的错，而不是“哎呀，对不起，我忘了”的错。

记住：人们永远不会做你期望的事情，他们总是做你检查的事情。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-11-07T08:58:15.360

首先，就像这里的大多数受访者指出的那样，如果这个人没有看到测试的价值，那么你就无能为力了，而且你已经指出你不能解雇这个人。但是，这里不能选择失败，那么您**可以**做的几件事呢？

如果您的组织足够大，可以拥有超过 6 名开发人员，我强烈建议您设立一个质量保证部门（即使只有一个人开始）。理想情况下，您应该有 1 名测试人员与 3-5 名开发人员的比例。关于程序员的事情是......他们是程序员，而不是测试人员。我还没有采访过正式教授过适当 QA 技术的程序员。

大多数组织都会将测试角色分配给新员工，即对代码接触最少的人——理想情况下，应该将高级开发人员转移到 QA 角色，因为他们有代码经验，并且（希望）已经对可能出现的代码异味和故障点形成了第六感。

此外，犯错误的程序员可能不会发现缺陷，因为它通常不是语法错误（那些在编译中被发现），而是一个逻辑错误——当他们编写代码时，同样的逻辑也在起作用在他们编写代码时进行测试。不要让开发代码的人测试该代码——他们会发现比其他人更少的错误。

在你的情况下，如果你能负担得起重定向的工作量，让这个新人成为你的 QA 团队的第一个成员。让他阅读“现实世界中的软件测试：改进过程”，因为他显然需要在新角色中接受一些培训。如果他不喜欢它，他会退出，你的问题还是解决了。

一个稍微不那么报复性的方法是让这个人做他们擅长的事情（我假设这个人被录用是因为他们实际上能够胜任工作的编程部分），并聘请一两个测试员进行测试（大学生通常有实习或“合作”条款，喜欢曝光，而且价格便宜）

旁注：最终，您会希望 QA 团队向 QA 主管报告，或者至少不向软件开发经理报告，因为让 QA 团队向主要目标是完成产品的经理报告是一种冲突兴趣。

如果您的组织少于 6 人，或者您无法创建一个新团队，我推荐配对编程 (PP)。我不是所有极限编程技术的完全转换者，但我绝对是配对编程的信徒。但是，配对编程团队的两个成员都必须专心致志，否则根本行不通。他们必须遵循两条规则：检查员必须完全理解屏幕上正在编码的内容，或者他必须要求编码员进行解释；编码员只能编码他能解释的东西——不能容忍“你会看到”或“相信我”或挥手。

如果你的团队有能力，我只推荐 PP，因为就像测试一样，再多的欢呼或威胁都无法说服几个自负的内向者在他们不自在的情况下一起工作。但是，我发现在编写详细的功能规范和进行代码审查与配对编程之间，PP 通常会胜出。

如果 PP 不适合您，那么 TDD 是您最好的选择，但前提是从字面上理解。测试驱动开发意味着您首先编写测试，运行测试以证明它们确实失败了，然后编写最简单的代码使其工作。现在的权衡是您（应该）拥有数千个测试的集合，这些测试也是代码，并且与生产代码一样可能包含错误。老实说，我不是 TDD 的忠实拥护者，主要是因为这个原因，但它适用于许多宁愿编写测试脚本而不是测试用例文档的开发人员——有些测试总比没有好。将 TDD 与 PP 结合起来，可以提高测试覆盖率并减少脚本中的错误。

如果所有其他方法都失败了，让程序员相当于一个发誓的罐子——每次程序员破坏构建时，他们必须将 20 美元、50 美元、100 美元（无论对你的员工来说是什么痛苦的东西）放入一个你最喜欢的罐子里（注册！）慈善。在他们付钱之前，避开他们:)

除了开玩笑，让你的程序员编写测试的最好方法是不要让他编程。如果您想要程序员，请雇用程序员——如果您想要测试，请雇用测试员。12 年前，我作为一名初级程序员开始做测试，它变成了我的职业道路，我不会用它来换取任何东西。一个经过适当培养并被赋予改进软件的权力和任务的坚实 QA 部门与最初编写软件的开发人员一样有价值。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-08-13T23:55:44.737

根据您的评论，“表明设计变得更简单”，我假设你们练习 TDD。事后进行代码审查是行不通的。TDD 的全部内容在于它是一种设计，而不是一种测试哲学。如果他没有将测试作为设计的一部分编写，那么您将不会从事后编写测试中获得很多好处——尤其是从初级开发人员那里。他最终会遗漏很多极端情况，他的代码仍然很糟糕。

你最好的选择是让一位**非常**有耐心的高级开发人员和他坐在一起，做一些结对编程。坚持下去，直到他学会为止。或者不学习，在这种情况下，您需要将他重新分配给他更适合的任务，因为您最终只会让您真正的开发人员感到沮丧。

并非每个人都具有相同水平的才能和/或动力。开发团队，甚至是敏捷团队，都是由“A 团队”和“B 团队”的人组成的。A-Team 成员负责构建解决方案、编写所有重要的生产代码并与企业主沟通——所有这些工作都需要跳出框框思考。B 团队处理诸如配置管理、编写脚本、修复蹩脚的错误和进行维护工作之类的事情——所有这些工作都有严格的程序，对失败的影响很小。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-08-18T20:12:24.687

这可能有点无情，但你描述情况的方式听起来你需要解雇这个人。或者至少说清楚：拒绝遵循内部开发实践（包括编写测试）*和*检查其他人必须清理的错误代码最终会让你被解雇。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-08-27T03:52:11.673

初级工程师/程序员不需要花费大量时间来设计和执行测试脚本的主要原因是因为大多数 CS 认证并不严格要求这一点，因此其他工程领域将在大学课程中进一步涵盖，例如设计模式。

以我的经验，让初级专业人员养成习惯的最佳方法是明确地将其作为流程的一部分。也就是说，在估算一次迭代应该花费的时间时，设计、编写和/或执行案例的时间应该包含在这个时间估算中。

最后，审查测试脚本设计应该是设计审查的一部分，并且应该在代码审查中审查实际代码。这使得程序员有责任对他/她编写的每一行代码进行适当的测试，而高级工程师和同行则有责任对编写的代码和测试提供反馈和指导。

# linux - 如何设置公钥认证？

> ID：7260
> 
> 赞同：62
> 
> 时间：2008-08-10T17:50:11.467
> 
> 标签：linux, ssh, private-key, public-key

如何为 SSH 设置公钥身份验证？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-08-12T18:13:37.127

如果您安装了 SSH，您应该能够运行..

```
ssh-keygen 
```

然后完成这些步骤，您将拥有两个文件，`id_rsa`并且`id_rsa.pub`（第一个是您的私钥，第二个是您的公钥 - 您复制到远程机器的那个）

然后，连接到您要登录的远程计算机，在文件中`~/.ssh/authorized_keys`添加该文件的内容`id_rsa.pub`。

哦，还有`chmod 600`所有`id_rsa*`文件（本地和远程），所以没有其他用户可以读取它们：

```
chmod 600 ~/.ssh/id_rsa* 
```

同样，确保远程`~/.ssh/authorized_keys`文件`chmod 600`也是：

```
chmod 600 ~/.ssh/authorized_keys 
```

然后，当你这样做时`ssh remote.machine`，它应该要求你输入密钥的密码，而不是远程机器。

* * *

为了更好地使用，您可以使用`ssh-agent`将解密的密钥保存在内存中 - 这意味着您不必每次都输入密钥对的密码。要启动代理，请运行（包括反引号，用于评估`ssh-agent`命令的输出）

```
`ssh-agent` 
```

在某些发行版上，ssh-agent 会自动启动。如果你运行`echo $SSH_AUTH_SOCK`它并且它显示了一个路径（可能在 /tmp/ 中）它已经设置好了，所以你可以跳过前面的命令。

然后添加你的密钥，你做

```
ssh-add ~/.ssh/id_rsa 
```

并输入您的密码。它会一直存储到您将其删除（使用`ssh-add -D`从代理中删除所有密钥的命令）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-11T02:01:00.040

对于 Windows [，这](http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter8.html)是一个很好的介绍和指南

这里有一些适用于 linux 以外的系统的好 ssh 代理。

*   窗户 -[选美](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)
*   OS X - [SSH钥匙串](http://www.askbjoernhansen.com/2005/01/07/sshkeychain_ssh.html)

# java - 如何在不传递 ID 的情况下识别在哪个 Java Applet 上下文中运行？

> ID：7269
> 
> 赞同：8
> 
> 时间：2008-08-10T18:06:04.820
> 
> 标签：java, swing, applet

我是一个开发相当大的 Swing Java Applet 的团队的一员。我们的大部分代码都是遗留的，并且有大量的单例引用。我们将所有这些都捆绑到一个“应用程序上下文”单例中。我们现在需要创建某种方法来分离共享上下文（在当前显示的所有小程序之间共享）和非共享上下文（特定于当前显示的每个小程序）。

但是，我们没有在调用单例的每个位置都有一个 ID，我们也不想将 ID 传播到所有位置。识别我们在哪个小程序上下文中运行的最简单方法是什么？（我试过弄乱类加载器、线程组、线程ID......到目前为止，我找不到任何可以让我识别调用来源的东西）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-05T21:13:10.303

单身人士是邪恶的，你期待什么？;)

也许最全面的方法是将大部分小程序加载到不同的类加载器中（使用 java.net.URLClassLoader.newInstance）。然后使用 Wea​​kHashMap 将类加载器与小程序相关联。如果您可以将大部分代码拆分为一个公共类加载器（作为每个小程序类加载器的父级）和普通小程序代码库，那会更快但工作量更大。

其他黑客：

如果您有权访问任何组件，则可以重复使用 Component.getParent 或 SwingUtilities.getRoot。

如果您在每个applet 实例线程中，那么您可以设置一个ThreadLocal。

在 EDT 中，您可以从队列 (java.awt.EventQueue.getCurrentEvent()) 中读取当前事件，并可能从中找到一个组件。或者，使用重写的 dispatchEvent 方法推送 EventQueue。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T12:32:02.480

如果我理解正确，这个想法是为每个调用者对象或“上下文”获取不同的“单例”对象。您可以做的一件事是创建一个线程局部全局变量，您可以在其中写入当前上下文的 ID。（这可以通过 AOP 完成。）然后在单例 getter 中，从线程本地获取上下文 ID，以用作调用上下文的正确“单例”实例的键。

关于 AOP，在 applet 中使用它应该没有问题，因为根据您的切入点，建议在编译时编织，并将 JAR 添加到运行时依赖项中。因此，在运行时不应保留任何 AOP 的特殊证据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T20:06:28.070

**@Hugo 关于线程本地：**

我想到了那个解决方案。然而，从实验中我发现这种方法存在两个问题：

1.  共享线程（服务器连接等）是有问题的。这可以通过特别注意这些线程来解决（它们都在我的控制之下，并且几乎与遗留代码隔离）。
2.  EDT 线程在所有小程序之间共享。我没有找到一种方法来强制为每个小程序创建一个新的 EDT 线程。这意味着 EDT 的 threadlocal 将在 applet 之间共享。这个我不知道如何解决。建议？

# language-agnostic - 计算无限质数的方法

> ID：7272
> 
> 赞同：3
> 
> 时间：2008-08-10T18:11:08.100
> 
> 标签：language-agnostic, primes

好吧，所以也许我不应该把这个问题缩小太多......我已经看过关于[找到前 10000 个素数的最有效方法](https://stackoverflow.com/questions/622/most-efficient-code-for-the-first-10000-prime-numbers)的帖子。我正在寻找**所有可能的方法**。目标是为素性测试提供一站式服务。任何和所有人们知道的寻找素数的测试都是受欢迎的。

所以：

*   **求素数有哪些不同的方法？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T06:30:04.750

一些素数检验仅适用于某些数字，例如，[Lucas-Lehmer](http://en.wikipedia.org/wiki/Lucas%E2%80%93Lehmer_test_for_Mersenne_numbers)检验仅适用于梅森数。

大多数用于大数的素数测试只能告诉您某个数字“可能是素数”（或者，如果该数字未通过测试，则它绝对**不是**素数）。通常你可以继续这个算法，直到你有一个非常高的概率是素数。

看看[这个页面](http://en.wikipedia.org/wiki/Pseudoprime)，尤其是它的“另见”部分。

[我认为米勒-拉宾测试](http://en.wikipedia.org/wiki/Miller-Rabin_test)是最好的测试之一。在其标准形式中，它为您提供可能的素数 - 尽管已经表明，如果您将测试应用于 3.4*10^14 以下的数字，并且它通过每个参数 2、3、5、7、11、13 的测试而17，它*绝对*是素数。

[AKS 测试](http://en.wikipedia.org/wiki/AKS_primality_test)是第一个确定性的、经过验证的、通用的多项式时间测试。然而，据我所知，它的最佳实现比其他测试要慢，除非输入大得离谱。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T18:17:41.770

[埃拉托色尼筛法](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)是一个不错的算法：

> 1.  取正整数列表 2 到任何给定的上限。
> 2.  取出列表中的下一个项目（第一次迭代中的 2 个）并从列表中删除它的所有倍数（除了第一个）。
> 3.  重复第二步，直到达到给定的天花板。
> 4.  您的列表现在完全由素数组成。

这个算法有一个功能限制，因为它用内存交换速度。当生成非常大的素数列表时，所需的内存容量会猛增。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-10T18:26:43.063

对于给定的整数，我知道的最快的素数检查是：

> 1.  **取一个 2 到整数**的平方根的列表。
> 2.  遍历列表，取**整数**/**当前数的余数**
>     
>     > 1.  如果列表中任何数字的余数为零，则该整数不是素数。
>     > 2.  如果列表中所有数字的余数都不为零，则整数是素数。

它使用的内存[比埃拉托色尼筛法](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)要少得多，而且对于单个数字通常更快。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-11T01:42:41.170

@akdom 对我的问题：

根据我之前的建议，循环可以正常工作，您无需进行任何计算即可确定数字是否为偶数；在您的循环中，只需跳过每个偶数，如下所示：

```
//Assuming theInteger is the number to be tested for primality.
// Check if theInteger is divisible by 2\.  If not, run this loop.
//  This loop skips all even numbers.
for( int i = 3; i < sqrt(theInteger); i + 2) 
{
    if( theInteger % i == 0) 
    {
       //getting here denotes that theInteger is not prime 
       // somehow indicate that some number, i, divides it and break
       break;
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-11T02:31:36.093

罗格斯大学的一名研究生最近发现了一个[产生素数的递归关系](http://www.cs.uwaterloo.ca/journals/JIS/VOL11/Rowland/rowland21.html)。其连续数字的差异将产生质数或 1。

```
a(1) = 7
a(n) = a(n-1) + gcd(n,a(n-1)). 
```

它产生了很多需要过滤掉的废话。Benoit Cloitre 也有这个重复执行类似任务：

```
b(1) = 1
b(n) = b(n-1) + lcm(n,b(n-1)) 
```

那么连续数之比减一 [b(n)/b(n-1)-1] 是素数。可以在[Recursivity](http://recursed.blogspot.com/2008/07/rutgers-graduate-student-finds-new.html)阅读所有这些的完整说明。

对于筛子，您可以使用轮子而不是每次都添加一个轮子来做得更好，请查看[改进的增量素数筛子](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.52.835)。这是一个轮子的例子。让我们看一下要忽略的数字 2 和 5。他们的轮子是 [2,4,2,2]。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-10T19:58:38.587

在使用从 2 到整数根的列表的算法中，您可以通过仅测试 2 之后的奇数来提高性能。也就是说，您的列表只需要包含 2 和从 3 到整数平方根的所有奇数. 这将循环次数减少了一半，而不会增加任何复杂性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-10T20:18:27.690

@theprise

如果我想使用递增循环而不是实例化列表（大量数字的内存问题......），那么不构建列表的好方法是什么？

对给定整数 (X % 3) 进行整除性检查似乎并不比仅检查正常数 (N % X) 便宜。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-08-10T22:47:08.340

如果您想找到一种生成素数的方法，这已在上一个[问题](https://stackoverflow.com/questions/622/most-efficient-code-for-the-first-10000-prime-numbers#2753)中介绍过。

# xml - 对 XML 文档中的换行敏感是“坏习惯”吗？

> ID：7277
> 
> 赞同：8
> 
> 时间：2008-08-10T18:20:38.130
> 
> 标签：xml, xslt, xhtml, whitespace, line-breaks

我正在生成一些 XML 文档，当涉及到地址部分时，我的片段如下所示：

```
<Address>15 Sample St
Example Bay
Some Country</Address> 
```

我用于将其转换为 XHTML 的 XSLT 有一些时髦的递归模板，可以将字符串中的换行符转换为 <br/> 标签。

这一切都很好；但是在 XML 文档中依赖换行符是否被认为是“不好的做法”？如果是这样，是否建议我改为这样做？

```
<Address><Line>15 Sample St</Line>
<Line>Example Bay</Line>
<Line>Some Country</Line></Address> 
```

似乎用这样的标签包裹我的文本可能是多行的每个地方真的很尴尬..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-10T19:05:08.930

依赖换行符通常被认为是不好的做法，因为它是区分数据的一种脆弱方式。虽然大多数 XML 处理器会保留您在 XML 中放入的任何空格，但不能保证。

真正的问题是，大多数将 XML 输出为可读格式的应用程序都认为 XML 中的所有空格都是可互换的，并且可能会将这些换行符折叠成一个空格。这就是为什么您的 XSLT 必须跳过这些障碍才能正确呈现数据的原因。使用“br”标签将大大简化转换。

另一个潜在的问题是，如果您在 XML 编辑器中打开您的 XML 文档并漂亮地打印它，您很可能会丢失这些换行符。

如果您继续使用换行符，请确保将 xml:space="preserve" 属性添加到“地址”。（如果您使用的是 DTD，您可以在 DTD 中执行此操作。）

**一些建议阅读**

*   [XML.com 的一篇文章](http://www.xml.com/pub/a/2001/11/07/whitespace.html)说：

> XML 应用程序似乎常常对空白采取一种漫不经心的态度，因为关于 XML 文档中空白无关紧要的位置的规则有时使这些应用程序可以自由地在某些位置添加或删除空白。

*   [有关空白的 XSL 列表帖子的集合](http://www.dpawson.co.uk/xsl/sect2/N8321.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-10T21:24:24.200

如何使用属性来存储数据，而不是文本节点：

```
<Address Street="15 Sample St" City="Example Bay" State="" Country="Some Country"/> 
```

我知道属性与文本节点的使用是一个经常争论的话题，但我 95% 的时间都坚持使用属性，并且没有因此而遇到任何麻烦。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-24T14:40:11.673

很少有人说 CDATA 块将允许您保留换行符。这是错误的。CDATA 部分只会将标记作为字符数据处理，它们**不会**改变换行处理。

```
<Address>15 Sample St
Example Bay
Some Country</Address> 
```

完全一样

```
<Address><![CDATA[15 Sample St
Example Bay
Some Country]]></Address> 
```

唯一的区别是不同的 API 如何报告这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-10T18:29:36.380

我认为唯一真正的问题是它使 XML 更难阅读。例如

```
<Something>
    <Contains>
        <An>
            <Address>15 Sample St
Example Bay
Some Country</Address>
        </An>
    </Contains>
</Something> 
```

如果漂亮的 XML 不是问题，我可能不会担心它，只要它可以工作。如果需要考虑漂亮的 XML，我会将显式换行符转换为`<br />`标签或`\n`在将它们嵌入 XML 之前。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-10T18:43:21.220

这取决于您如何阅读和编写 XML。

如果 XML 是自动生成的——如果换行符或明确的**\n**标志被解析成——那么就没有什么可担心的了。您的输入中可能没有任何其他 XML，因此完全不弄乱 XML 会更干净。

如果标签是手动处理的，如果你问我，换行仍然更干净。

例外情况是，如果您使用 DOM 从 XML 中获取某些结构。在那种情况下，换行符显然是邪恶的，因为它们不能正确地代表层次结构。不过，听起来层次结构与您的应用程序无关，因此换行听起来就足够了。

如果 XML 看起来很糟糕（尤其是在自动生成时），[Tidy](http://tidy.sourceforge.net/)可以提供帮助，尽管它与 HTML 相比与 XML 相比更有效。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T13:12:35.817

这可能是一个有点欺骗性的例子，因为在这种情况下地址有点非规范化。然而，这是一个合理的权衡，因为地址字段难以规范化。如果您让换行符携带重要信息，那么您就是在不规范化并使邮局解释换行符的含义。

我会说通常这不是一个大问题，但在这种情况下，我认为 Line 标签是最正确的，因为它明确表明您实际上并没有解释这些线条在不同文化中可能意味着什么。（请记住，大多数输入地址的表格都有邮政编码等，以及地址行 1 和 2。）

带有行标签的尴尬伴随着普通的 XML，并且在编码恐怖方面引起了很多争论。[http://www.codinghorror.com/blog/archives/001139.html](http://www.codinghorror.com/blog/archives/001139.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-19T21:49:34.273

XML 规范对[空格](http://www.w3.org/TR/xml/#sec-white-space)和[换行以及回车有一些特别的](http://www.w3.org/TR/xml/#sec-line-ends)规定。因此，如果您将自己限制为真正的换行符（x0A），您应该没问题。然而，许多编辑工具会重新格式化 XML 以“更好地呈现”，并且可能会去掉特殊的语法。比“<line></line>”的想法更健壮、更简洁的方法是简单地使用命名空间并嵌入 XHTML 内容，例如：

```
<Address xmlns="http://www.w3.org/1999/xhtml">15 Sample St<br />Example Bay<br />Some Country</Address> 
```

当涉及到标准词汇表时，无需重新发明轮子。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-10T20:41:55.100

我看不出`<Line>`标签有什么问题。
显然，数据的可视化对您很重要，重要到足以将其保留在您的数据中（通过第一个示例中的换行符）。美好的。那就真的留着吧，不要靠“魔法”来为你留着。保留您以后需要的每一点数据，并且无法从已保存的数据部分完美推断，即使它是可视化数据（换行符和其他格式）也要保留。您的用户（另一位开发人员的最终用户）花时间根据自己的喜好格式化该数据 - 要么告诉他（输入附近的 API 文档/文本）你不打算保留它，要么 - 只是保留它。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-08-10T18:26:24.590

是的，我认为使用[CDATA](http://en.wikipedia.org/wiki/CDATA)块可以保护空白。尽管某些解析器 API 允许您保留空格。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-08-10T19:36:55.557

您真正应该做的是将您的 XML 转换为保留空白的格式。

因此，与其寻求用 <br /> 替换 \n，不如将整个块包装在 <pre>

这样，您的地址在功能上被保留（无论是否包含换行符），并且 XSTL 可以选择是否在结果中保留空白。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-08-10T20:35:18.577

我建议您应该添加`<br/>`换行符或使用换行符实体 -`&#x000D;`

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-08-10T21:13:23.630

如果您需要保留换行符，请使用 CDATA 块，正如[tweakt 所说](https://stackoverflow.com/questions/7277/is-it-bad-practice-to-be-sensitive-to-linebreaks-in-xml-documents#7280)

否则当心。大多数情况下，XML 软件会保留换行符，但有时它们不会，而且你真的不想依赖那些只是巧合的东西

# theory - 什么是图灵完备？

> ID：7284
> 
> 赞同：629
> 
> 时间：2008-08-10T18:41:02.300
> 
> 标签：theory, turing-machines, turing-complete

“图灵完备”的表达是什么意思？

你能给出一个简单的解释，而不涉及太多的理论细节吗？

* * *

## 回答 #1

> 赞同：454
> 
> 时间：2008-08-10T20:10:48.687

这是最简短的解释：

图灵完备系统是指可以编写程序并找到答案的系统（尽管不保证运行时或内存）。

所以，如果有人说“我的新东西是图灵完备”，这意味着原则上（尽管通常不是在实践中）它可以用来解决任何计算问题。

有时这是个笑话……一个人用 vi 写了一个图灵机模拟器，所以可以说 vi 是世界上唯一需要的计算引擎。

* * *

## 回答 #2

> 赞同：277
> 
> 时间：2016-05-16T05:17:26.823

**这是最简单的解释**

Alan Turing 创造了一台可以接收程序、运行该程序并显示一些结果的机器。但随后他不得不为不同的程序创建不同的机器。所以他创造了“通用图灵机”，它可以接受任何程序并运行它。

编程语言类似于那些机器（尽管是虚拟的）。他们接受程序并运行它们。现在，一种编程语言被称为“图灵完备”，如果它可以运行图灵机在足够的时间和内存下可以运行的任何程序（与语言无关）。

例如：假设有一个程序需要 10 个数字并将它们相加。图灵机可以很容易地运行这个程序。但是现在想象一下，由于某种原因，您的编程语言无法执行相同的加法。这将使其“图灵不完整”（可以这么说）。另一方面，如果它可以运行通用图灵机可以运行的任何程序，那么它就是图灵完备的。

大多数现代编程语言（例如 Java、JavaScript、Perl 等）都是图灵完备的，因为它们都实现了运行程序所需的所有功能，例如加法、乘法、if-else 条件、返回语句、存储/检索/擦除方法数据等。

更新：您可以在我的博文中了解更多信息：[“JavaScript 是图灵完备的”——解释](https://medium.freecodecamp.com/javascript-is-turing-complete-explained-41a34287d263#.6t0b2w66p)

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2009-10-22T23:45:42.453

## 非正式定义

图灵完备的语言是一种可以执行任何计算的语言。[Church-Turing Thesis](https://en.wikipedia.org/wiki/Church%E2%80%93Turing_thesis)指出，任何可执行的计算都可以由图灵机完成。[图灵机](https://en.wikipedia.org/wiki/Turing_machine)是一台具有无限随机存取存储器和有限“程序”的机器，该程序指示它应该何时读取、写入和在该内存中移动，何时应该以特定结果终止，以及下一步应该做什么。图灵机的输入在它启动之前被放入它的内存中。

## 可以使语言不是图灵完整的事情

**图灵机可以根据它在内存中看到的内容做出决定**——仅支持`+`、`-`、`*`和`/`整数的“语言”不是图灵完备的，因为它无法根据输入做出选择，但图灵机可以。

**图灵机可以永远运行**——如果我们使用 Java、Javascript 或 Python 并删除执行任何类型的循环、GOTO 或函数调用的能力，它就不是图灵完整的，因为它不能执行任意计算永远不会结束。[Coq](https://en.wikipedia.org/wiki/Coq)是一个定理证明器，它不能表达不终止的程序，所以它不是图灵完备的。

**图灵机可以使用无限内存**- 一种与 Java 完全相同但一旦使用超过 4 GB 内存就会终止的语言不会是图灵完整的，因为图灵机可以使用无限内存。这就是为什么我们实际上无法*构建*图灵机，但 Java 仍然是图灵完备的语言，因为 Java*语言*没有限制它使用无限内存。这是正则表达式不是图灵完备的原因之一。

**图灵机具有随机存取内存**——一种只允许您通过内存`push`和`pop`对堆栈进行操作的语言不会是图灵完备的。如果我有一种“语言”，它读取一个字符串*一次*并且只能通过从堆栈中推送和弹出来使用内存，它可以告诉我`(`字符串中的每个人以后是否都有自己的内容，方法是在看到时`)`推送并在看到`(`时弹出`)`。但是，它不能告诉我以后是否每个`(`人都有自己的*，*`)`以后每个人都有自己的（请注意，符合此标准但不符合）。图灵机可以使用它的随机存取存储器来跟踪' 和*`[``]``([)]``([]]``()``[]`是分开的，但是这种只有堆栈的语言不能。*

 ***图灵机可以模拟任何其他图灵机**-当给定适当的“程序”时，图灵机可以采用另一台图灵机的“程序”并在任意输入上对其进行模拟。如果你有一种被禁止实现 Python 解释器的语言，那它就不是图灵完备的。

## 图灵完备语言示例

如果您的语言具有无限的随机存取内存、条件执行和某种形式的重复执行，那么它可能是图灵完备的。还有更多奇特的系统仍然可以实现图灵机所能做到的一切，这也使它们图灵完备：

*   无类型 lambda 演算
*   康威的人生游戏
*   C++ 模板
*   序言

* * *

## 回答 #4

> 赞同：86
> 
> 时间：2008-08-10T18:59:06.460

来自[维基百科](http://en.wikipedia.org/wiki/Turing_completeness)：

> 以艾伦·图灵命名的图灵完备性具有重要意义，因为迄今为止先进的计算设备的每一个合理设计都可以由通用图灵机模拟——这一观察已被称为 Church-Turing 论点。因此，可以作为通用图灵机的机器原则上可以执行任何其他可编程计算机能够执行的任何计算。然而，这与为机器编写程序所需的努力、机器执行计算所需的时间或机器可能拥有的与计算无关的任何能力无关。
> 
> 虽然真正的图灵完备机器在物理上很可能是不可能的，因为它们需要无限的存储空间，但图灵完备性通常被松散地归因于物理机器或编程语言，如果它们具有无限的存储空间，它们将是通用的。从这个意义上说，所有现代计算机都是图灵完备的。

我不知道你怎么能比这更非技术性，除了说“图灵完整意味着'能够在足够的时间和空间下回答可计算的问题'”。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-11-27T04:03:15.853

从根本上说，图灵完备性是一个简洁的要求，即无限递归。

甚至不受记忆的限制。

我独立地想到了这一点，但[这里是](http://lambda-the-ultimate.org/node/2846#comment-42117)对断言的一些讨论。[我对 LSP 的定义](https://stackoverflow.com/q/8279878)提供了更多的上下文。

这里的其他答案并没有直接定义图灵完备性的基本本质。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-05-18T17:09:11.900

图灵完备意味着它至少和[图灵机](http://en.wikipedia.org/wiki/Turing_machine)一样强大。这意味着可以由图灵机计算的任何东西都可以由图灵完备系统计算。

还没有人找到比图灵机更强大的系统。所以，就目前而言，说一个系统是图灵完备的就等于说这个系统和任何已知的计算系统一样强大（参见[Church-Turing Thesis](https://en.wikipedia.org/wiki/Church%E2%80%93Turing_thesis)）。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-08-08T22:50:53.040

用最简单的术语来说，图灵完备的系统可以解决任何可能的计算问题。

关键要求之一是暂存器大小不受限制，并且可以回退以访问对暂存器的先前写入。

因此实际上没有系统是图灵完备的。

相反，一些系统通过对无限内存建模并执行任何可能适合系统内存的计算来近似图灵完备性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-20T07:23:29.867

我认为“图灵完备”概念的重要性在于识别计算机（不一定是机械/电气“计算机”）的能力，该计算机可以将其过程解构为“简单”指令，由越来越简单的指令组成指令，通用机器可以解释然后执行。

我强烈推荐带注释的图灵

@Mark我认为您要解释的是通用图灵机和图灵完备的描述之间的混合。

从实际意义上讲，图灵完备的东西是一种机器/过程/计算，可以编写和表示为程序，由通用机器（台式计算机）执行。尽管正如其他人所提到的，它没有考虑时间或存储。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-02-18T13:08:15.720

来自 Brasilford 教授在此[视频](https://youtu.be/RPQD7-AOjMI)中解释的超级简短摘要。

图灵完备 ≅ 做图灵机能做的任何事情。

1.  它**有条件分支**（即“if 语句”）。此外，暗示“去”，从而允许循环。

2.  它获得程序所需**的任意数量的内存**（例如足够长的磁带）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-10T17:47:05.353

我们称一种语言为图灵完备的当且仅当 (1) 它可由图灵机判定，但 (2) 不能由比图灵机能力差的任何事物判定。例如，字母表 {a, b} 上的回文语言可由图灵机判定，但也可由下推自动机判定；所以，这种语言不是图灵完备的。真正图灵完备的语言——需要图灵机的全部计算能力的语言——非常罕见。也许是字符串 xyz 的语言，其中 x 是数字，y 是图灵机，z 是初始磁带配置，并且 y 在不到 x 的时间内停止在 z 上！步骤 - 也许符合条件（尽管需要显示！）

一个常见的不精确用法混淆了图灵完备性和图灵等效性。图灵等价性是指计算系统可以模拟并且可以由图灵机模拟的属性。例如，我们可以说 Java 是一种图灵等效的编程语言，因为您可以用 Java 编写图灵机模拟器，并且因为您可以定义一个图灵机来模拟 Java 程序的执行。根据 Church-Turing 论文，图灵机可以执行任何有效的计算，因此 Turing 等价意味着系统尽可能有能力（如果 Church-Turing 论文是真的！）

Turing equivalence is a much more mainstream concern that true Turing completeness; this and the fact that "complete" is shorter than "equivalent" may explain why "Turing-complete" is so often misused to mean Turing-equivalent, but I digress.

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-10-26T20:12:17.857

在大多数程序员熟悉的实用语言术语中，检测图灵完整性的常用方法是该语言是否允许或允许模拟嵌套的无界 while 语句（与具有固定上限的 Pascal 式语句相反）。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2020-03-18T20:18:20.763

图灵机要求任何程序都可以执行条件测试。这是根本。

考虑一个播放器钢琴卷。自动钢琴可以演奏一首高度复杂的音乐，但音乐中从来没有任何条件逻辑。它**不是**图灵完备的。

条件逻辑既是图灵完备机器的威力，也是危险。

保证钢琴卷帘每次都停止。TM 没有这样的保证。这被称为“停机问题”。</p>

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-10-05T23:18:19.903

正如[韦伦弗林所说](https://stackoverflow.com/questions/7284/what-is-turing-complete/878771#878771)：

> 图灵完备意味着它至少和图灵机一样强大。

我认为这是不正确的，如果一个系统与图灵机一样强大，那么它就是图灵完备的，即机器完成的每个计算都可以由系统完成，而且系统完成的每个计算也可以由图灵机完成.

* * *

## 回答 #14

> 赞同：-9
> 
> 时间：2012-12-15T18:33:53.127

关系数据库是否可以输入地点和道路的纬度和经度，并计算它们之间的最短路径 - 不。这是一个表明 SQL 不是图灵完备的问题。

但是 C++ 可以做到，并且可以解决任何问题。就是这样。

# unit-testing - 您如何测试/更改未经测试和不可测试的代码？

> ID：7287
> 
> 赞同：9
> 
> 时间：2008-08-10T18:49:53.920
> 
> 标签：unit-testing, refactoring, legacy

最近我不得不在旧系统上更改一些代码，其中并非所有代码都有单元测试。
在进行更改之前，我想编写测试，但是每个类都创建了很多依赖项和其他反模式，这使得测试变得非常困难。
显然，我想重构代码以使其更易于测试、编写测试然后更改它。
你会这样做吗？或者您是否会花费大量时间编写难以编写的测试，这些测试将在重构完成后大部分被删除？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-10T19:22:36.943

首先，[这是一篇很棒的文章，其中包含有关单元测试的提示](http://devver.net/blog/2008/07/tips-for-unit-testing/)。其次，我发现避免对旧代码进行大量更改的好方法是稍微重构它，直到您可以对其进行测试。一种简单的方法是保护私有成员，然后覆盖受保护的字段。

例如，假设您有一个在构造函数期间从数据库加载一些内容的类。在这种情况下，您不能只覆盖受保护的方法，而是可以将数据库逻辑提取到受保护的字段，然后在测试中覆盖它。

```
public class MyClass {
    public MyClass() {
        // undesirable DB logic
    }
} 
```

变成

```
public class MyClass {
    public MyClass() {
        loadFromDB();
    }

    protected void loadFromDB() {
        // undesirable DB logic
    }
} 
```

然后你的测试看起来像这样：

```
public class MyClassTest {
    public void testSomething() {
        MyClass myClass = new MyClassWrapper();
        // test it
    }

    private static class MyClassWrapper extends MyClass {
        @Override
        protected void loadFromDB() {
            // some mock logic
        }
    }
} 
```

这是一个不好的例子，因为你可以在这种情况下使用 DBUnit，但实际上我最近在类似的情况下这样做了，因为我想测试一些与正在加载的数据完全无关的功能，所以它非常有效。我还发现这样的成员暴露在其他类似的情况下很有用，在这些情况下，我需要摆脱一些长期存在于类中的依赖关系。

但是，如果您正在编写框架，我会建议您不要使用此解决方案，除非您真的不介意将成员公开给框架的用户。

这有点骇人听闻，但我发现它非常有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-10T22:55:03.973

@valters

我不同意您的说法，即测试不应破坏构建。测试应该表明应用程序没有为所测试的功能引入新的错误（并且发现的错误表明缺少测试）。

如果测试没有破坏构建，那么您很容易遇到新代码破坏构建并且暂时不知道的情况，即使测试覆盖了它。失败的测试应该是一个危险信号，必须修复测试或代码。

此外，允许测试不破坏构建将导致失败率缓慢上升，以至于您不再拥有一组可靠的回归测试。

如果测试经常中断的问题，这可能表明测试的编写方式过于脆弱（依赖于可能发生变化的资源，例如没有正确使用 DB Unit 的数据库，或外部 Web 服务）这应该被嘲笑），或者这可能表明团队中有开发人员没有给予测试适当的关注。

我坚信应该尽快修复失败的测试，就像修复无法尽快编译的代码一样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-10T20:28:24.347

我不确定你为什么会说一旦重构完成，单元测试就会被删除。实际上，您的单元测试套件应该在主构建之后运行（您可以创建一个单独的“测试”构建，它只是在构建主产品之后运行单元测试）。然后，您将立即查看一件中的更改是否会破坏其他子系统中的测试。请注意，这与在构建期间运行测试有点不同（正如一些人可能提倡的那样） - 一些有限的测试在构建期间很有用，但通常仅仅因为某些单元测试失败而“崩溃”构建是没有生产力的。

如果您正在编写 Java（可能是），请查看[http://www.easymock.org/](http://www.easymock.org/) - 可能有助于减少测试目的的耦合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-30T16:44:52.060

我已经阅读了有效地使用遗留代码，并且我同意它对于处理“不可测试”的代码非常有用。

有些技术只适用于编译语言（我正在研究“旧”PHP 应用程序），但我想说本书的大部分内容适用于任何语言。

重构书籍有时会假设代码在重构之前处于半理想或“维护意识”状态，但我工作的系统并不理想，并且被开发为“边走边学”应用程序，或作为某些所用技术的第一个应用程序（我不怪最初的开发人员，因为我是他们中的一员），所以根本没有测试，代码有时很乱。本书解决了这种情况，而其他重构书籍通常不会（嗯，没有到这种程度）。

我应该提一下，我没有从本书的编辑和作者那里收到任何钱；），但我觉得这很有趣，因为遗留代码领域缺乏资源（尤其是我的语言法语，但那是另一个故事）。

# windows-mobile - Compact Framework 的 Zip 库选项？

> ID：7348
> 
> 赞同：9
> 
> 时间：2008-08-10T21:00:14.173
> 
> 标签：windows-mobile, compact-framework, zip, components

我的要求：

*   支持 .NET Compact Framework 2.0 和 Windows Mobile 6.0 设备。
*   只需将内容解压到存储卡上的目录即可。不需要创建 zip 文件。
*   必须能够在企业/商业软件中使用。
*   可以是开源的，但没有 GPL 或其他病毒许可。

我看过[Xceed Zip for CF](http://xceed.com/Zip_NET_CF_Intro.html)库。还有哪些其他选择？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-23T05:35:12.110

从 v1.7 开始，DotNetZip 发行版现在包括一个专门为 .NET Compact Framework 构建的版本，可以是 v2.0 或 v3.5。 [http://www.codeplex.com/DotNetZip/Release/ProjectReleases.aspx](http://www.codeplex.com/DotNetZip/Release/ProjectReleases.aspx)。它大约是 70k DLL。它执行压缩、解压缩、压缩编辑、密码、ZIP64、unicode、流等。

DotNetZip 是 100% 托管代码、开源和免费/免费使用。它也非常简单易行。

```
 try
  {
      using (var zip1 = Ionic.Zip.ZipFile.Read(zipToUnpack))
      {
          foreach (var entry in zip1)
          {
              entry.Extract(dir, ExtractExistingFileAction.OverwriteSilently);
          }
      }
  }
  catch (Exception ex)
  {
      MessageBox.Show("Exception! " + ex);
  } 
```

源分发中包含一个示例应用程序，可解压缩到存储卡。

[CF-Unzipper 应用程序 http://www.freeimagehosting.net/uploads/ce5ad6a964.png](http://www.freeimagehosting.net/uploads/ce5ad6a964.png)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-10T21:04:56.690

看看#ziplib (www.icsharpcode.com)。它是 GPL，但您可以在封闭源代码的商业应用程序中使用它。他们没有在他们的页面上具体说明如何将它与 Compact Framework 一起使用，因此您必须自己对其进行测试（也就是说，它是纯 C#，没有任何外部依赖项，因此它的可能性有点大工作）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T00:58:27.170

这看起来对您来说可能是一个不错的选择： http: [//www.codeplex.com/DotNetZip](http://www.codeplex.com/DotNetZip)。它看起来很小，有源代码并且有一个非常开放的许可证（MS-PL）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-16T01:27:44.303

看起来您需要的是来自 OpenNETCF 基金会的 zlibCE。你可以在这里得到它：http: [//opennetcf.com/FreeSoftware/zlibCE/tabid/245/Default.aspx](http://opennetcf.com/FreeSoftware/zlibCE/tabid/245/Default.aspx)

它是 linux [zlib](http://en.wikipedia.org/wiki/Zlib)库到 CE 的一个端口。它的核心是本机 dll，但现在它们还提供 .NET 包装器以及所有源代码。

我以前在项目中使用过它，它表现得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T16:33:49.100

我将 Resco MobileForms 工具包用于各种功能：[http ://www.resco.net/developer/mobileformstoolkit/overview.aspx](http://www.resco.net/developer/mobileformstoolkit/overview.aspx)

它包括一个很好的 ZIP 库。

# php - 用 PHP 编辑 PDF？

> ID：7364
> 
> 赞同：86
> 
> 时间：2008-08-10T21:58:24.913
> 
> 标签：php, pdf

有谁知道用 PHP 编辑 PDF 的好方法？最好是开源/零许可成本的方法。:)

我正在考虑打开 PDF 文件，替换 PDF 中的文本，然后写出 PDF 的修改版本？

在前端

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-08-11T00:49:58.077

如果您采用“填空”方法，您可以将文本精确定位在页面上所需的任何位置。因此，将缺少的文本添加到文档中相对容易（如果不是有点乏味的话）。以 Zend 框架为例：

```
<?php
require_once 'Zend/Pdf.php';

$pdf = Zend_Pdf::load('blank.pdf');
$page = $pdf->pages[0];
$font = Zend_Pdf_Font::fontWithName(Zend_Pdf_Font::FONT_HELVETICA);
$page->setFont($font, 12);
$page->drawText('Hello world!', 72, 720);
$pdf->save('zend.pdf'); 
```

如果您尝试替换内联内容，例如“[占位符字符串]”，它会变得更加复杂。虽然技术上可行，但您可能会弄乱页面的布局。

PDF 文档由一组原始绘图操作组成：此处的线条、此处的图像、此处的文本块等。它不包含有关这些原始布局意图的任何信息。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2010-11-15T12:31:15.320

有一个免费且易于使用的 PDF 类来创建 PDF 文档。它被称为[FPDF](http://www.fpdf.org/)。结合 FPDI ( [http://www.setasign.de/products/pdf-php-solutions/fpdi](http://www.setasign.de/products/pdf-php-solutions/fpdi) ) 甚至可以编辑 PDF 文档。下面的代码展示了如何使用 FPDF 和 FPDI 来使用用户数据填充现有的礼券。

```
require_once('fpdf.php'); 
require_once('fpdi.php'); 
$pdf = new FPDI();

$pdf->AddPage(); 

$pdf->setSourceFile('gift_coupon.pdf'); 
// import page 1 
$tplIdx = $this->pdf->importPage(1); 
//use the imported page and place it at point 0,0; calculate width and height
//automaticallay and ajust the page size to the size of the imported page 
$this->pdf->useTemplate($tplIdx, 0, 0, 0, 0, true); 

// now write some text above the imported page 
$this->pdf->SetFont('Arial', '', '13'); 
$this->pdf->SetTextColor(0,0,0);
//set position in pdf document
$this->pdf->SetXY(20, 20);
//first parameter defines the line height
$this->pdf->Write(0, 'gift code');
//force the browser to download the output
$this->pdf->Output('gift_coupon_generated.pdf', 'D'); 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-08-27T09:59:34.070

如果您需要非常简单的 PDF，那么 Zend 或[FPDF](http://www.fpdf.org/)就可以了。但是，我发现与它们一起工作很困难且令人沮丧。此外，由于 API 的工作方式，没有很好的方法将内容与表示与业务逻辑分开。

出于这个原因，我使用[dompdf](https://github.com/dompdf/dompdf)，它会自动将 HTML 和 CSS 转换为 PDF 文档。您可以像布置 HTML 页面一样布置模板并使用标准 HTML 语法。您甚至可以包含外部 CSS 文件。该库并不完美，并且非常复杂的标记或 css 有时会被破坏，但我还没有发现其他任何可以正常工作的东西。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-10T23:16:39.123

Zend Framework 可以加载和编辑现有的 PDF 文件。我认为它也支持修订。

我用它在项目中创建文档，效果很好。从来没有编辑过。

[在这里](https://web.archive.org/web/20120822101532/http://framework.zend.com:80/manual/en/zend.pdf.create.html)查看文档

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T22:46:40.497

不知道这是否是一个选项，但它的工作方式与 Zend 的 pdf 库非常相似，但您不需要加载一堆额外的代码（zend 框架）。它只是扩展了 FPDF。

[http://www.setasign.de/products/pdf-php-solutions/fpdi/](http://www.setasign.de/products/pdf-php-solutions/fpdi/)

在这里你基本上可以做同样的事情。加载 PDF，覆盖它，然后保存到新的 PDF。在 FPDI 中，您基本上将 PDF 作为图像插入，因此您可以在其上放置您想要的任何内容。

但同样，它使用 FPDF，所以如果你不想使用它，那么它就行不通。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-21T16:15:39.893

PHP 中的 PDF/pdflib 扩展文档很少（在 bugs.php.net 中已注明） - 我建议您使用 Zend 库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-29T12:38:35.323

Tcpdf 也是一个很好的在 php 中生成 pdf 的库 [http://www.tcpdf.org/](http://www.tcpdf.org/)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-08-10T22:41:00.023

我们使用[pdflib](http://www.pdflib.com/pdflib-gmbh/)从我们的 rails 应用程序创建 PDF 文件。它具有 PHP 和大量其他语言的绑定。

我们使用商业版，但他们也有[免费/开源版本](http://www.pdflib.com/download/pdflib-family/pdflib-lite/)，但有一些限制。

不幸的是，这只允许创建 PDF。

如果您想打开和“编辑”现有文件，pdflib 确实提供[了一个产品可以做到这一点](http://www.pdflib.com/products/pdflib-family/pdi/)，但[要花很多钱](https://www.pdflib.com/buy/online-shop/pdflib-pdflib-pdi-pps/)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-10-21T05:49:12.943

```
<?php

//getting new instance
$pdfFile = new_pdf();

PDF_open_file($pdfFile, " ");

//document info
pdf_set_info($pdfFile, "Auther", "Ahmed Elbshry");
pdf_set_info($pdfFile, "Creator", "Ahmed Elbshry");
pdf_set_info($pdfFile, "Title", "PDFlib");
pdf_set_info($pdfFile, "Subject", "Using PDFlib");

//starting our page and define the width and highet of the document
pdf_begin_page($pdfFile, 595, 842);

//check if Arial font is found, or exit
if($font = PDF_findfont($pdfFile, "Arial", "winansi", 1)) {
    PDF_setfont($pdfFile, $font, 12);
} else {
    echo ("Font Not Found!");
    PDF_end_page($pdfFile);
    PDF_close($pdfFile);
    PDF_delete($pdfFile);
    exit();
}

//start writing from the point 50,780
PDF_show_xy($pdfFile, "This Text In Arial Font", 50, 780);
PDF_end_page($pdfFile);
PDF_close($pdfFile);

//store the pdf document in $pdf
$pdf = PDF_get_buffer($pdfFile);
//get  the len to tell the browser about it
$pdflen = strlen($pdfFile);

//telling the browser about the pdf document
header("Content-type: application/pdf");
header("Content-length: $pdflen");
header("Content-Disposition: inline; filename=phpMade.pdf");
//output the document
print($pdf);
//delete the object
PDF_delete($pdfFile);
?> 
```

# c# - Visual Studio - 继承控件的新“默认”属性值

> ID：7367
> 
> 赞同：11
> 
> 时间：2008-08-10T22:06:49.670
> 
> 标签：c#, .net, vb.net, visual-studio

我正在寻求帮助，为 Visual Studio 中的继承控件设置新的默认属性值：

```
class NewCombo : System.Windows.Forms.ComboBox
{
  public NewCombo() { DropDownItems = 50; }
} 
```

问题是基类属性`DropDownItems`设置了一个“默认”属性，该属性是一个不同的值（不是 50）。结果，当我将控件拖到窗体上时，设计器文件会得到一个明确的`mycontrol.DropDownItems = 50;`行。

起初，这无关紧要。但是，如果稍后我将继承的类更改为`DropDownItems = 45;`在构造函数中，这不会影响任何表单上的任何控件，因为所有这些设计器文件中仍然具有硬编码的值 50。重点是将价值设置在一个地方，这样我就可以应对客户改变主意。

显然，如果我在子类中创建自己的自定义属性，我可以给它自己的设计器默认属性，无论我想要什么。但在这里我想更改基础属性的默认值。有没有办法将 Visual Studio 属性应用于基类成员？还是有其他解决方法可以获得我想要的结果？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-10T23:11:39.133

在您的派生类中，您需要覆盖（或使用*新*的阴影）有问题的属性，然后重新应用默认值属性。

# c - 如何避免重新定义 VERSION、PACKAGE 等

> ID：7398
> 
> 赞同：9
> 
> 时间：2008-08-10T23:10:53.190
> 
> 标签：c, linux, unix, autoconf, automake

我还没有看到任何与 GNU autoconf/automake 构建相关的问题，但我希望至少你们中的一些人熟悉它。开始：

我有一个项目（我称之为 myproject），其中包括另一个项目（供应商）。供应商项目是由其他人维护的独立项目。包含这样的项目相当[简单](http://www.gnu.org/software/autoconf/manual/autoconf.html#Subdirectories)，但在这种情况下有一个小问题：每个项目都生成自己的`config.h`文件，每个文件都定义了标准宏，例如 PACKAGE、VERSION 等。这意味着，在构建期间，当供应商正在构建，我收到很多这样的错误：

```
... warning: "VERSION" redefined
... warning: this is the location of the previous definition
... warning: "PACKAGE" redefined
... warning: this is the location of the previous definition 
```

这些只是警告，至少目前是这样，但我想摆脱它们。我能够通过 Google 搜索找到的唯一相关信息是automake 邮件列表上的[这个](http://sourceware.org/ml/automake/2004-03/msg00130.html)线程，这并不是很多帮助。还有其他人有更好的想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-25T21:52:23.997

一些注意事项：

*   你没有提到如何`config.h`包含 - 带引号或尖括号。有关差异的更多信息，请参阅[this other question](https://stackoverflow.com/questions/21593/what-is-the-difference-between-include-filename-and-include-filename)。简而言之，`config.h`通常包含在引号中，而不是尖括号中，这应该使预处理器更喜欢`config.h`来自项目自己的目录（这通常是您想要的）
*   你说一个子项目应该包括封闭项目的`config.h`通常这根本不是你想要的。该子项目是独立的，它的 PACKAGE 和 VERSION 应该是该子项目的一个，而不是你的。例如，如果您在 xmlreader 项目中包含 libxml，您仍然希望使用 PACKAGE libxml 和 VERSION（无论 libxml 版本是什么）编译 libxml 代码。
*   `config.h`从公共标头中包含通常是一个大错误。`config.h`始终对您的项目或子项目是私有的，并且应该只包含在 .c 文件中。因此，如果您的供应商的文档说要包含他们的“vendor.h”并且该公共标头`config.h`以某种方式包含，那么这是不行的。同样，如果您的项目是一个库，请不要`config.h`在公开安装的标头中包含任何地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-12T20:18:22.180

这绝对是一个黑客，但我对自动生成的`config.h`文件进行了后处理：

```
sed -e 's/.*PACKAGE_.*//' < config.h > config.h.sed && mv config.h.sed config.h 
```

这在我们的构建环境中是可以容忍的，但我会对更清洁的方式感兴趣。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T16:16:56.203

事实证明，在我的案例中有一个非常简单的解决方案。供应商项目将多个头文件收集到一个单一的头文件中，然后`#include`由供应商源进行 d。但是构建整体标头的 make 规则意外地包含了生成的`config.h`. 整体标头中存在 PACKAGE、VERSION 等配置变量是导致重新定义警告的原因。事实证明，供应商的`config.h`无关紧要，因为“config.h”总是解析为`$(top_builddir)/config.h`.

我相信这是它应该工作的方式。默认情况下，子项目应该包含封闭项目`config.h`而不是它自己的，除非子项目明确包含它自己的，或者操纵 INCLUDE 路径以使其自己的目录位于之前`$(top_builddir)`，或者像我的情况一样操纵头文件。

# unit-testing - 你用什么来对你的 Web UI 进行单元测试？

> ID：7440
> 
> 赞同：35
> 
> 时间：2008-08-11T00:05:36.590
> 
> 标签：unit-testing, user-interface, selenium

我目前工作的公司正在使用[Selenium](http://selenium.openqa.org/)对我们的用户界面进行联合测试。你用什么来对你的 Web UI 进行单元测试，你觉得它有多有效？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-18T12:54:04.887

我是 Selenium 的忠实粉丝。正如某些评论所提到的那样，说“对您的 web ui 进行单元测试”并不完全准确。但是，我确实发现 Selenium 对于在 UI 上执行这些验收和健全性测试非常有用。

一个很好的入门方法是使用 Selenium IDE 作为开发的一部分。即，只需在开发时打开 IDE 并在开发时编写测试以减少开发时间。（不必手动通过 UI 来测试您正在处理的任何内容，只需点击一个按钮，Selenium IDE 就会为您处理好。这非常节省时间！）

我的大多数主要用例场景都有 Selenium RC 测试来支持它们。您不能真正将它们视为 xUnit 框架的单元测试，但它们是针对非常特定功能的测试。它们写起来很快（特别是如果你实现了登录或设置测试用例等常用方法），运行速度很快，并且提供了一个非常紧密的反馈循环。在这些意义上，Selenium RC 测试与单元测试非常*相似。*

我认为，与其他任何事情一样，如果您努力正确地学习测试工具（例如 Selenium），您的努力将会得到回报。您提到您的公司已经使用 Selenium 进行 UI 测试。这很棒。使用它。如果您发现 Selenium 难以使用或令人困惑，请坚持使用。一旦你稍微学习了 API，学习曲线真的不是那么陡峭。

如果我正在开发一个 Web 应用程序，我很少会在没有 Selenium RC 测试来支持它的情况下编写大量代码。这就是我发现 Selenium 的效果。:) （希望这能回答你的问题..）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-21T18:46:18.563

我们在我的工作地点使用 Watin，我们是一家 .net 商店，所以这个解决方案很有意义。我们实际上是从 Watir（最初的 ruby​​ 实现）开始的，然后又切换了。到目前为止，这对我们来说是一个很好的解决方案

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-11T02:52:41.637

好吧，如果您正确地设计了应用程序，那么无论如何您都不会在 UI 中包含大量逻辑。将实际完成的工作分离到与 UI 分开的单元中，然后对其进行测试更有意义。

如果这样做，那么 UI 中的唯一代码将是调用后端的代码，因此只需测试后端就足够了。

我过去（在我的工作中）使用过 NUnit ASP，如果你坚持对你的 UI 进行单元测试，我强烈建议你使用除 NUnit ASP 之外的任何东西。使用起来很痛苦，即使是最细微的 UI 更改（即使测试的主题实际上并没有改变），测试也往往会失效（需要修改）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-11T01:12:54.350

我们正在使用 QuickTestPro。到目前为止它是有效的，但是浏览器的选择是有限的。最好的部分是能够记录浏览器的活动，并将其转换为一组可编写脚本的步骤。还有一个不错的 .Net 插件，因此如果您需要为测试的不同阶段执行任何验证代码，您可以在程序集中编写方法并从脚本中调用它们。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-11T03:43:10.863

我们使用[JSunit](https://github.com/pivotal/jsunit)进行单元测试已经有一段时间了……它可能与您所说的测试类型不同，但它非常适合确保您的 JavaScript 按预期工作。

你在浏览器中运行它，它可以在 Ant 构建中设置为自动在一堆平台上的一堆浏览器上远程运行（这样你就可以确保你的代码是跨浏览器的，并确保逻辑是正确的）。

我不认为它取代了 Selenium，但它很好地补充了它。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-19T12:15:47.923

我们使用 Visual Studio 2008 测试版。

**优点：** 非常擅长捕捉用户交互

捕获 Ajax 调用

将用户输入映射到数据库、XML 或 CSV 文件非常容易

捕获的测试可以转换为 C# 以获得更多控制

相同的测试可用于负载测试和代码覆盖率

**缺点：**

VS2008 测试版是与普通开发版分开的 SKU，这意味着额外的费用

您可能对 Microsoft 过敏 ;-)

我们在项目中非常有效地使用了它，但是在保持测试最新方面需要付出很多努力，每次更改屏幕时都可能需要重新录制测试

我们倾向于保持测试简短而清晰，做一件事然后离开，而不是在一次测试中记录 10 分钟的点击次数。

**我们有一些标准的 UI 测试类型：**

**菜单测试：**以特定用户（或用户类型/角色）身份登录并确保所有必需的菜单项都可用

**验证测试：**打开页面点击保存，不输入任何数据，确保出现所有验证警告。一次填写一个必填字段，并检查警告消息是否在应有的时候消失。

**搜索测试：**使用数据库或数据文件中的数据进行搜索，并确保搜索返回正确的数据

**数据输入测试：**从数据文件创建新记录，清理数据库以允许测试多次运行

UI 测试非常耗时，但在发布新版本之前通过数百次测试所获得的舒适感是无价的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-11T01:11:07.833

我们使用 Selenium Core，但正在逐渐切换到更好且更易于管理的 Selenium RC。我们编写了许多自定义代码来使测试在我们的持续集成服务器上运行，其中一些在并行套件中运行得更快。

您会发现一件事是 Selenium 似乎在每次测试时都会重新启动浏览器（您可以将其设置为不这样做，但这样做时我们遇到了内存问题）。这在 Firefox 中可能会很慢，但在 IE 中并不算太糟糕（有一次我感谢比尔盖茨的操作系统集成）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-23T19:55:38.803

我用过[WATIR](http://wtr.rubyforge.org/)，非常好。我喜欢它，因为它是 Ruby 并且允许测试交互性、可用元素和源代码解析。我已经有一段时间没有使用它了，但我认为它会变得更好。

据说它被移植到 Firefox 和 Safari，但这已经发生了一段时间。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-08-29T21:54:08.347

查看[Canoo Web 测试](http://webtest.canoo.com/webtest/manual/WebTestHome.html)。它是开源的，建立在 ANT 框架之上。

我花了一些时间在软件 QA 研究生课程中使用它，它似乎是一个非常强大的测试工具。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-06T12:48:59.320

[Selenium Grid](http://selenium-grid.openqa.org/)可以在多台机器上并行运行您的 Web 测试，这可以加快 Web 测试过程

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-06T13:02:50.300

我主要使用[CubicTest](http://cubictest.openqa.org)，这是一个 Eclipse 插件，可让您以图形方式定义测试。它可以通过多个库导出/运行测试，包括 watir 和 selenium。大多数人只是使用 Selenium 跑步者。

全面披露：我是开发人员之一，所以我有点偏见:)

在这里仔细看看：[cubictest.openqa.org](http://cubictest.openqa.org/)

-埃伦德

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-16T14:10:27.700

Selenium 用于集成测试，而不是单元测试。这是一个微妙但重要的区别。我通常看到的用法是检查构建的完整性。即，进行登录测试、（例如）提交故事、发表评论等的测试。

这个想法是，您正在测试以查看整个系统是否在部署之前协同工作，而不是让用户发现您的站点已损坏。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-30T04:32:46.793

我们目前使用[Silk4J](http://microfocus.com/products/silk/silktest/index.aspx) - 一种以 Java 为中心的方法来测试 Web UI。它可以测试 Flash、Flex、AIR、Silver Light、Win32、HTML 和其他一些应用程序。

由于 Silk4J 可以控制 Win32 应用程序，因此它可以直接控制浏览器对话框，这比 Selenium 可以控制的功能高出一步，对于下载提示特别有用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-11T23:28:19.247

我们使用[WatiN](http://watin.sourceforge.net/)进行系统测试，使用[QUnit](http://docs.jquery.com/QUnit)进行 JavaScript 单元测试。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-07-21T04:38:30.137

[Molybdenum](http://www.molyb.org/confluence/display/molyb/Home "钼")建立在 Selenium 之上，并具有一些附加功能。

# php - 来自 Gallery2 的 RSS 提要

> ID：7470
> 
> 赞同：2
> 
> 时间：2008-08-11T01:32:16.090
> 
> 标签：php, web-applications

[在与Gallery2](http://gallery.menalto.com/) [RSS 模块](http://codex.gallery2.org/Gallery2:Modules:rss)打了几个小时后，我只收到消息“尚未定义任何提要”，我放弃了。根据[Google 搜索“尚未定义任何提要”](http://www.google.com/search?q=%22no+feeds+have+yet+been+defined%22)，这是一个很常见的问题。你有什么让 Gallery2 RSS 模块正常工作的提示和/或技巧吗？或者对于试图调试这个 PHP 应用程序问题的相对 PHP 无知的开发人员的任何提示？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-11T01:33:20.080

我对这个问题的最终（希望是临时的）解决方案是一个 Python CGI 脚本。我的脚本适用于任何可能觉得它有用的人（尽管这完全是一个 hack）。

```
#!/usr/bin/python
"""A CGI script to produce an RSS feed of top-level Gallery2 albums."""

#import cgi
#import cgitb; cgitb.enable()
from time import gmtime, strftime
import MySQLdb

ALBUM_QUERY = '''
    select g_id, g_title, g_originationTimestamp
    from g_Item
    where g_canContainChildren = 1 
    order by g_originationTimestamp desc
    limit 0, 20
    '''

RSS_TEMPLATE = '''Content-Type: text/xml

<?xml version="1.0"?>
<rss version="2.0">
  <channel>
    <title>TITLE</title>
    <link>http://example.com/gallery2/main.php</link>
    <description>DESCRIPTION</description>
    <ttl>1440</ttl>
%s
  </channel>
</rss>
'''

ITEM_TEMPLATE = '''
    <item>
      <title>%s</title>
      <link>http://example.com/gallery2/main.php?g2_itemId=%s</link>
      <description>%s</description>
      <pubDate>%s</pubDate>
    </item>
'''

def to_item(row):
    item_id = row[0]
    title = row[1]
    date = strftime("%a, %d %b %Y %H:%M:%S GMT", gmtime(row[2]))
    return ITEM_TEMPLATE % (title, item_id, title, date)

conn = MySQLdb.connect(host = "HOST",
                       user = "USER",
                       passwd = "PASSWORD",
                       db = "DATABASE")
curs = conn.cursor()
curs.execute(ALBUM_QUERY)
print RSS_TEMPLATE % ''.join([ to_item(row) for row in curs.fetchall() ])
curs.close() 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-14T15:50:25.007

好吧，我不确定这对您有帮助，但这里有一个非常简单的 RSS，它在另一个主题中作为解决方案提出：

[PHP RSS 生成器](https://stackoverflow.com/questions/82872/php-rss-builder#84601)

# wpf - WPF 数据绑定

> ID：7472
> 
> 赞同：11
> 
> 时间：2008-08-11T01:34:34.773
> 
> 标签：wpf, data-binding

谁能给我指出一个好的资源（或给我一个线索）来告诉我如何对 WPF 中的控件（组合框、列表框等）进行数据绑定？当我所有的 WinForms 优点都被拿走时，我有点不知所措，而且我一开始也不是那么聪明......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T01:38:49.727

我为 WPF 数据绑定找到的最佳资源是[Bea Costa 的博客](http://www.beacosta.com)。从第一篇文章开始并向前阅读。这很棒。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T01:40:55.993

在后面的代码中——将列表框的 DataContext 设置为您要绑定到的集合。

```
private void OnInit(object sender, EventArgs e)
{
  //myDataSet is some IEnumerable 

  // myListBox is a ListBox control.
  // Set the DataContext of the ListBox to myDataSet
  myListBox.DataContext = myDataSet;
} 
```

在 XAML 中，Listbox 可以使用“绑定”语法声明它绑定到哪些属性。

```
<ListBox Name="myListBox" Height="200"
  ItemsSource="{Binding Path=BookTable}"
  ItemTemplate  ="{StaticResource BookItemTemplate}"/> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T01:45:45.297

我发现[Windows Client .Net](http://windowsclient.net/learn/videos_wpf.aspx)上的教程视频同样棒极了。[Dot Net Rocks TV](http://web.archive.org/web/20190214014927/http://www.dnrtv.com:80/default.aspx?showNum=101)前段时间也报道过。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-11T04:36:48.790

还有一些链接，以防万一以上还不够：

[Windows Presentation Foundation - 数据绑定操作方法主题](http://msdn.microsoft.com/en-us/library/ms752039.aspx)
- 来自 MSDN 的大约 30 篇“操作方法”文章。
“本节中的主题描述了如何使用数据绑定将元素绑定到来自各种数据源的数据，这些数据以公共语言运行时 (CLR) 对象和 XML 的形式出现。”

[一步一步地走向 WPF 数据绑定](http://www.codeproject.com/KB/WPF/MovingTowardWpfBinding.aspx)
- WPF 大师[Josh Smith](http://joshsmithonwpf.wordpress.com/)
“这篇文章解释了 WPF 数据绑定的绝对基础知识。它展示了如何执行相同简单任务的四种不同方式。每次迭代都更接近最紧凑的，可以仅实现 XAML。本文适用于没有 WPF 数据绑定经验的人。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-11T05:51:39.093

这是 MSDN 的另一个很好的资源：[数据绑定概述](http://msdn.microsoft.com/en-us/library/ms752347.aspx)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-29T14:42:47.757

您需要做三件事：

1.  将 ComboBox 的 ItemsSource 绑定到选项列表。
2.  将 SelectedItem 绑定到保存选择的属性。
3.  将 ComboBox.ItemTemplate 设置为 ComboBoxItem 的 DataTemplate。

因此，例如，如果您的数据上下文对象是一个拥有电子邮件地址的人，并且您想选择他们的主要地址，那么您可能有具有这些签名的类：

```
public class EmailAddress
{
    public string AddressAsString { get; set; }
}

public class Person
{
    public IEnumerable<EmailAddress> EmailAddresses { get; }
    public EmailAddress MainEmailAddress { get; set; }
} 
```

然后你可以像这样创建组合框：

```
<ComboBox ItemsSource="{Binding EmailAddresses}" SelectedItem="{Binding MainEmailAddress}">
    <ComboBox.ItemTemplate>
        <DataTemplate>
            <ComboBoxItem Content="{Binding AddressAsString}"/>
        </DataTemplate>
    </ComboBox.ItemTemplate>
</ComboBox> 
```

现在您需要在 Person 和 EmailAddress 中实现 INotifyPropertyChanged。对于 EmailAddresses 集合，您可以使用 ObjservableCollection 支持它。

或者作为替代方案，您可以使用[Update Controls .NET](http://codeplex.com/updatecontrols)。这是一个替代数据绑定的开源项目，不需要 INotifyPropertyChanged。您可以使用任何有意义的集合来支持 EmailAddresses 属性。XAML 的工作方式与上述相同，只是您导入 UpdateControls.XAML 命名空间并将 {Binding ...} 替换为 {u:Update ...}。

# javascript - 如何使用原型自动调整文本区域的大小？

> ID：7477
> 
> 赞同：128
> 
> 时间：2008-08-11T01:43:13.493
> 
> 标签：javascript, html, css, textarea, prototypejs

我目前正在为我工​​作的公司开发一个内部销售应用程序，并且我有一个允许用户更改收货地址的表单。

现在我认为它看起来会更好，如果我用于主要地址详细信息的文本区域只会占用其中的文本区域，并在文本更改时自动调整大小。

这是它目前的截图。

![ISO 地址](https://i.stack.imgur.com/XK48E.png)

有任何想法吗？

* * *

@克里斯

一个很好的观点，但我希望它调整大小是有原因的。我希望它占用的区域是其中包含的信息的区域。正如您在屏幕截图中看到的，如果我有一个固定的文本区域，它会占用相当多的垂直空间。

我可以减少字体，但我需要地址大且可读。现在我可以减小文本区域的大小，但是对于地址行需要 3 或 4 行（一个需要 5 行）的人，我会遇到问题。需要让用户使用滚动条是一个主要的禁忌。

我想我应该更具体一点。我在垂直调整大小之后，宽度并不重要。唯一会发生的问题是，当窗口宽度太小时（如屏幕截图所示）时，ISO 编号（大的“1”）会被推送到地址下方。

这不是噱头；它是关于拥有一个用户可以编辑的文本字段，它不会占用不必要的空间，但会显示其中的所有文本。

虽然如果有人想出另一种方法来解决这个问题，我也愿意接受。

* * *

我稍微修改了代码，因为它的行为有点奇怪。我将其更改为在 keyup 时激活，因为它不会考虑刚刚输入的字符。

```
resizeIt = function() {
  var str = $('iso_address').value;
  var cols = $('iso_address').cols;
  var linecount = 0;

  $A(str.split("\n")).each(function(l) {
    linecount += 1 + Math.floor(l.length / cols); // Take into account long lines
  })

  $('iso_address').rows = linecount;
}; 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-08-11T04:49:33.930

当你在人们的墙上写字时，Facebook 会这样做，但只会垂直调整大小。

由于自动换行、长线等原因，水平调整大小让我觉得一团糟，但垂直调整大小似乎相当安全和美好。

我认识的使用 Facebook 的新手都没有提到过任何关于它的事情或感到困惑。我会用这个作为轶事证据说'继续，实施它'。

[使用Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)来做一些 JavaScript 代码（因为这是我所熟悉的）：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <script src="http://www.google.com/jsapi"></script>
        <script language="javascript">
            google.load('prototype', '1.6.0.2');
        </script>
    </head>

    <body>
        <textarea id="text-area" rows="1" cols="50"></textarea>

        <script type="text/javascript" language="javascript">
            resizeIt = function() {
              var str = $('text-area').value;
              var cols = $('text-area').cols;

              var linecount = 0;
              $A(str.split("\n")).each( function(l) {
                  linecount += Math.ceil( l.length / cols ); // Take into account long lines
              })
              $('text-area').rows = linecount + 1;
            };

            // You could attach to keyUp, etc. if keydown doesn't work
            Event.observe('text-area', 'keydown', resizeIt );

            resizeIt(); //Initial on load
        </script>
    </body>
</html> 
```

PS：很明显，这段 JavaScript 代码非常幼稚，没有经过很好的测试，你可能不想在包含小说的文本框上使用它，但你明白了。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2010-01-09T06:57:46.283

其中一些答案的一个改进是让 CSS 做更多的工作。

基本路线似乎是：

1.  创建一个容器元素来保存`textarea`和隐藏`div`
2.  使用 Javascript，保持's 的内容与' `textarea`s 同步`div`
3.  让浏览器完成计算那个 div 高度的工作
4.  因为浏览器处理隐藏的渲染/调整大小`div`，我们避免显式设置`textarea`的高度。

```
document.addEventListener('DOMContentLoaded', () => {
    textArea.addEventListener('change', autosize, false)
    textArea.addEventListener('keydown', autosize, false)
    textArea.addEventListener('keyup', autosize, false)
    autosize()
}, false)

function autosize() {
    // Copy textarea contents to div browser will calculate correct height
    // of copy, which will make overall container taller, which will make
    // textarea taller.
    textCopy.innerHTML = textArea.value.replace(/\n/g, '<br/>')
}
```

```
html, body, textarea {
    font-family: sans-serif;
    font-size: 14px;
}

.textarea-container {
    position: relative;
}

.textarea-container > div, .textarea-container > textarea {
    word-wrap: break-word; /* make sure the div and the textarea wrap words in the same way */
    box-sizing: border-box;
    padding: 2px;
    width: 100%;
}

.textarea-container > textarea {
    overflow: hidden;
    position: absolute;
    height: 100%;
}

.textarea-container > div {
    padding-bottom: 1.5em; /* A bit more than one additional line of text. */ 
    visibility: hidden;
}
```

```
<div class="textarea-container">
    <textarea id="textArea"></textarea>
    <div id="textCopy"></div>
</div>
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-08-11T15:41:42.800

这是另一种自动调整文本区域大小的技术。

*   使用像素高度而不是行高：如果使用比例字体，则更准确地处理换行。
*   接受 ID 或元素作为输入
*   接受可选的最大高度参数 - 如果您不想让文本区域超过一定大小（将其全部保留在屏幕上，避免破坏布局等），这很有用
*   在 Firefox 3 和[Internet Explorer 6上测试](http://en.wikipedia.org/wiki/Internet_Explorer_6)

**代码：（** 普通的 JavaScript）

```
function FitToContent(id, maxHeight)
{
   var text = id && id.style ? id : document.getElementById(id);
   if (!text)
      return;

   /* Accounts for rows being deleted, pixel value may need adjusting */
   if (text.clientHeight == text.scrollHeight) {
      text.style.height = "30px";
   }

   var adjustedHeight = text.clientHeight;
   if (!maxHeight || maxHeight > adjustedHeight)
   {
      adjustedHeight = Math.max(text.scrollHeight, adjustedHeight);
      if (maxHeight)
         adjustedHeight = Math.min(maxHeight, adjustedHeight);
      if (adjustedHeight > text.clientHeight)
         text.style.height = adjustedHeight + "px";
   }
} 
```

**演示：（** 使用 jQuery，我现在正在输入的文本区域上的目标 - 如果您安装了[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)，请将两个示例粘贴到控制台并在此页面上进行测试）

```
$("#post-text").keyup(function()
{
   FitToContent(this, document.documentElement.clientHeight)
}); 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2013-05-18T02:12:02.467

可能是最短的解决方案：

```
jQuery(document).ready(function(){
    jQuery("#textArea").on("keydown keyup", function(){
        this.style.height = "1px";
        this.style.height = (this.scrollHeight) + "px"; 
    });
}); 
```

这样你就不需要任何隐藏的 div 或类似的东西。

注意：您可能需要`this.style.height = (this.scrollHeight) + "px";`根据您对 textarea 的样式（行高、填充和那种东西）进行调整。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-06-04T03:25:16.560

这是调整文本区域大小的**原型**版本，它不依赖于文本区域中的列数。这是一种优越的技术，因为它允许您通过 CSS 控制文本区域以及具有可变宽度的文本区域。此外，此版本显示剩余的字符数。虽然没有要求，但它是一个非常有用的功能，如果不需要，很容易删除。

```
//inspired by: http://github.com/jaz303/jquery-grab-bag/blob/63d7e445b09698272b2923cb081878fd145b5e3d/javascripts/jquery.autogrow-textarea.js
if (window.Widget == undefined) window.Widget = {}; 

Widget.Textarea = Class.create({
  initialize: function(textarea, options)
  {
    this.textarea = $(textarea);
    this.options = $H({
      'min_height' : 30,
      'max_length' : 400
    }).update(options);

    this.textarea.observe('keyup', this.refresh.bind(this));

    this._shadow = new Element('div').setStyle({
      lineHeight : this.textarea.getStyle('lineHeight'),
      fontSize : this.textarea.getStyle('fontSize'),
      fontFamily : this.textarea.getStyle('fontFamily'),
      position : 'absolute',
      top: '-10000px',
      left: '-10000px',
      width: this.textarea.getWidth() + 'px'
    });
    this.textarea.insert({ after: this._shadow });

    this._remainingCharacters = new Element('p').addClassName('remainingCharacters');
    this.textarea.insert({after: this._remainingCharacters});  
    this.refresh();  
  },

  refresh: function()
  { 
    this._shadow.update($F(this.textarea).replace(/\n/g, '<br/>'));
    this.textarea.setStyle({
      height: Math.max(parseInt(this._shadow.getHeight()) + parseInt(this.textarea.getStyle('lineHeight').replace('px', '')), this.options.get('min_height')) + 'px'
    });

    var remaining = this.options.get('max_length') - $F(this.textarea).length;
    this._remainingCharacters.update(Math.abs(remaining)  + ' characters ' + (remaining > 0 ? 'remaining' : 'over the limit'));
  }
}); 
```

通过调用创建小部件`new Widget.Textarea('element_id')`。默认选项可以通过将它们作为对象传递来覆盖，例如`new Widget.Textarea('element_id', { max_length: 600, min_height: 50})`. 如果要为页面上的所有文本区域创建它，请执行以下操作：

```
Event.observe(window, 'load', function() {
  $$('textarea').each(function(textarea) {
    new Widget.Textarea(textarea);
  });   
}); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-08-04T21:23:26.500

这是一个解决方案`JQuery`：

```
$(document).ready(function() {
    var $abc = $("#abc");
    $abc.css("height", $abc.attr("scrollHeight"));
}) 
```

`abc`是一个`teaxtarea`。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-07-01T11:53:20.833

检查以下链接：http: [//james.padolsey.com/javascript/jquery-plugin-autoresize/](http://james.padolsey.com/javascript/jquery-plugin-autoresize/)

```
$(document).ready(function () {
    $('.ExpandableTextCSS').autoResize({
        // On resize:
        onResize: function () {
            $(this).css({ opacity: 0.8 });
        },
        // After resize:
        animateCallback: function () {
            $(this).css({ opacity: 1 });
        },
        // Quite slow animation:
        animateDuration: 300,
        // More extra space:
        extraSpace:20,
        //Textarea height limit
        limit:10
    });
}); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-16T01:07:19.390

只是重新审视一下，我已经让它变得更整洁了（尽管对[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework) / JavaScript 满瓶的人可以建议改进？）。

```
var TextAreaResize = Class.create();
TextAreaResize.prototype = {
  initialize: function(element, options) {
    element = $(element);
    this.element = element;

    this.options = Object.extend(
      {},
      options || {});

    Event.observe(this.element, 'keyup',
      this.onKeyUp.bindAsEventListener(this));
    this.onKeyUp();
  },

  onKeyUp: function() {
    // We need this variable because "this" changes in the scope of the
    // function below.
    var cols = this.element.cols;

    var linecount = 0;
    $A(this.element.value.split("\n")).each(function(l) {
      // We take long lines into account via the cols divide.
      linecount += 1 + Math.floor(l.length / cols);
    })

    this.element.rows = linecount;
  }
} 
```

只需调用：

```
new TextAreaResize('textarea_id_name_here'); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-03-05T19:40:06.563

我做了一些很容易的事情。首先，我将 TextArea 放入 DIV。其次，我调用了`ready`这个脚本的函数。

```
<div id="divTable">
  <textarea ID="txt" Rows="1" TextMode="MultiLine" />
</div>

$(document).ready(function () {
  var heightTextArea = $('#txt').height();
  var divTable = document.getElementById('divTable');
  $('#txt').attr('rows', parseInt(parseInt(divTable .style.height) / parseInt(altoFila)));
}); 
```

简单的。它是 div 渲染后的最大高度，除以一行的 TextArea 的高度。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-03T19:08:58.713

我自己需要这个功能，但这里没有一个能像我需要的那样工作。

所以我使用了 Orion 的代码并对其进行了更改。

我添加了一个最小高度，这样在破坏时它不会变得太小。

```
function resizeIt( id, maxHeight, minHeight ) {
    var text = id && id.style ? id : document.getElementById(id);
    var str = text.value;
    var cols = text.cols;
    var linecount = 0;
    var arStr = str.split( "\n" );
    $(arStr).each(function(s) {
        linecount = linecount + 1 + Math.floor(arStr[s].length / cols); // take into account long lines
    });
    linecount++;
    linecount = Math.max(minHeight, linecount);
    linecount = Math.min(maxHeight, linecount);
    text.rows = linecount;
}; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-09-11T16:11:58.183

就像@memical 的回答一样。

但是我发现了一些改进。您可以使用 jQuery`height()`函数。但要注意 padding-top 和 padding-bottom 像素。否则你的 textarea 会增长太快。

```
$(document).ready(function() {
  $textarea = $("#my-textarea");

  // There is some diff between scrollheight and height:
  //    padding-top and padding-bottom
  var diff = $textarea.prop("scrollHeight") - $textarea.height();
  $textarea.live("keyup", function() {
    var height = $textarea.prop("scrollHeight") - diff;
    $textarea.height(height);
  });
}); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-03-28T16:12:52.663

我不使用 jQuery 的解决方案（因为有时它们不必是相同的东西）如下。虽然它只在[Internet Explorer 7](http://en.wikipedia.org/wiki/Internet_Explorer_7)中进行了测试，但社区可以指出所有错误的原因：

```
textarea.onkeyup = function () { this.style.height = this.scrollHeight + 'px'; } 
```

到目前为止，我真的很喜欢它的工作方式，而且我不关心其他浏览器，所以我可能会将它应用于我所有的文本区域：

```
// Make all textareas auto-resize vertically
var textareas = document.getElementsByTagName('textarea');

for (i = 0; i<textareas.length; i++)
{
    // Retain textarea's starting height as its minimum height
    textareas[i].minHeight = textareas[i].offsetHeight;

    textareas[i].onkeyup = function () {
        this.style.height = Math.max(this.scrollHeight, this.minHeight) + 'px';
    }
    textareas[i].onkeyup(); // Trigger once to set initial height
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-11-30T14:39:24.403

这是 Jeremy 在 6 月 4 日发布的 Prototype 小部件的扩展：

如果您在 textareas 中使用限制，它会阻止用户输入更多字符。它检查是否还有字符。如果用户将文本复制到 textarea 中，则文本会被最大程度地截断。长度：

```
/**
 * Prototype Widget: Textarea
 * Automatically resizes a textarea and displays the number of remaining chars
 * 
 * From: http://stackoverflow.com/questions/7477/autosizing-textarea
 * Inspired by: http://github.com/jaz303/jquery-grab-bag/blob/63d7e445b09698272b2923cb081878fd145b5e3d/javascripts/jquery.autogrow-textarea.js
 */
if (window.Widget == undefined) window.Widget = {}; 

Widget.Textarea = Class.create({
  initialize: function(textarea, options){
    this.textarea = $(textarea);
    this.options = $H({
      'min_height' : 30,
      'max_length' : 400
    }).update(options);

    this.textarea.observe('keyup', this.refresh.bind(this));

    this._shadow = new Element('div').setStyle({
      lineHeight : this.textarea.getStyle('lineHeight'),
      fontSize : this.textarea.getStyle('fontSize'),
      fontFamily : this.textarea.getStyle('fontFamily'),
      position : 'absolute',
      top: '-10000px',
      left: '-10000px',
      width: this.textarea.getWidth() + 'px'
    });
    this.textarea.insert({ after: this._shadow });

    this._remainingCharacters = new Element('p').addClassName('remainingCharacters');
    this.textarea.insert({after: this._remainingCharacters});  
    this.refresh();  
  },

  refresh: function(){ 
    this._shadow.update($F(this.textarea).replace(/\n/g, '<br/>'));
    this.textarea.setStyle({
      height: Math.max(parseInt(this._shadow.getHeight()) + parseInt(this.textarea.getStyle('lineHeight').replace('px', '')), this.options.get('min_height')) + 'px'
    });

    // Keep the text/character count inside the limits:
    if($F(this.textarea).length > this.options.get('max_length')){
      text = $F(this.textarea).substring(0, this.options.get('max_length'));
        this.textarea.value = text;
        return false;
    }

    var remaining = this.options.get('max_length') - $F(this.textarea).length;
    this._remainingCharacters.update(Math.abs(remaining)  + ' characters remaining'));
  }
}); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-01-12T04:07:41.960

Internet Explorer、Safari、Chrome 和[Opera](http://en.wikipedia.org/wiki/Opera_%28web_browser%29)用户需要记住在 CSS 中明确设置行高值。我做了一个样式表，为所有文本框设置初始属性，如下所示。

```
<style>
    TEXTAREA { line-height: 14px; font-size: 12px; font-family: arial }
</style> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-06-22T15:26:39.307

这是我刚刚在 jQuery 中编写的一个函数 - 您可以将其移植到[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)，但它们不支持 jQuery 的“活跃性”，因此 Ajax 请求添加的元素将不会响应。

此版本不仅会扩展，而且还会在按下删除或退格键时收缩。

这个版本依赖于 jQuery 1.4.2。

享受 ;）

[http://pastebin.com/SUKeBtnx](http://pastebin.com/SUKeBtnx)

用法：

```
$("#sometextarea").textareacontrol(); 
```

或（例如任何 jQuery 选择器）

```
$("textarea").textareacontrol(); 
```

它在[Internet Explorer 7](http://en.wikipedia.org/wiki/Internet_Explorer_7) / [Internet Explorer 8](http://en.wikipedia.org/wiki/Internet_Explorer_8)、Firefox 3.5 和 Chrome 上进行了测试。一切正常。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-01-04T17:28:40.010

[@memical](https://stackoverflow.com/questions/7477/autosizing-textarea#3409937)有一个很棒的解决方案，可以使用 jQuery 在页面加载时设置 textarea 的高度，但是对于我的应用程序，我希望能够在用户添加更多内容时增加 textarea 的高度。我使用以下内容构建了 memical 的解决方案：

```
$(document).ready(function() {
    var $textarea = $("p.body textarea");
    $textarea.css("height", ($textarea.attr("scrollHeight") + 20));
    $textarea.keyup(function(){
        var current_height = $textarea.css("height").replace("px", "")*1;
        if (current_height + 5 <= $textarea.attr("scrollHeight")) {
            $textarea.css("height", ($textarea.attr("scrollHeight") + 20));
        }
    });
}); 
```

它不是很流畅，但也不是面向客户端的应用程序，所以流畅度并不重要。（如果这是面向客户端的，我可能会使用自动调整大小的 jQuery 插件。）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-02-22T19:21:05.573

使用 ASP.NET，只需执行以下操作：

```
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Automatic Resize TextBox</title>
        <script type="text/javascript">
            function setHeight(txtarea) {
                txtarea.style.height = txtdesc.scrollHeight + "px";
            }
        </script>
    </head>

    <body>
        <form id="form1" runat="server">
            <asp:TextBox ID="txtarea" runat= "server" TextMode="MultiLine"  onkeyup="setHeight(this);" onkeydown="setHeight(this);" />
        </form>
    </body>
</html> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-06-13T22:26:22.117

对于那些为 IE 编码并遇到此问题的人。IE 有一个小技巧，使它成为 100% CSS。

```
<TEXTAREA style="overflow: visible;" cols="100" ....></TEXTAREA> 
```

您甚至可以为 rows="n" 提供一个值，IE 将忽略该值，但其他浏览器将使用该值。我真的很讨厌实现 IE hack 的编码，但是这个非常有帮助。它可能仅适用于 Quirks 模式。

# c++ - 如何制作图形用户界面？

> ID：7489
> 
> 赞同：8
> 
> 时间：2008-08-11T02:50:09.113
> 
> 标签：c++, user-interface

我已经为 Nintendo DS 制作了 GUI 系统的许多不同的单独部分，例如按钮、文本框和选择框，但我需要一种将这些类包含在一个 Gui 类中的方法，以便我可以将所有内容都绘制到屏幕上一次，并一次检查所有按钮以检查是否有任何按钮被按下。我的问题是将所有类（例如按钮和文本框）组织到一个 GUI 类中的最佳方法是什么？

这是我想到的一种方法，但似乎不对：

**编辑：**我正在使用 C++。

```
class Gui {
    public:
        void update_all();
        void draw_all() const;
        int add_button(Button *button); // Returns button id
        void remove_button(int button_id);
    private:
        Button *buttons[10];
        int num_buttons;
} 
```

这段代码有一些问题，但我只是想让你知道我想要什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-16T22:05:03.323

这个问题与我要发布的问题非常相似，只有我的问题是针对索尼 PSP 编程的。

我一直在玩弄一些东西，我已经查阅了一些书籍和[VTM](http://www.3dbuzz.com/xcart/product.php?productid=30&cat=12&page=1)，到目前为止，这是一个简单的 ui 系统的粗略想法。

```
class uiElement()
{
    ...
    virtual void Update() = 0;
    virtual void Draw() = 0;
    ...
}

class uiButton() public : uiElement
{
    ...
    virtual void Update();
    virtual void Draw();
    ...
}

class uiTextbox() public : uiElement
{
    ...
    virtual void Update();
    virtual void Draw();
    ...
}

... // Other ui Elements

class uiWindow()
{
    ...
    void Update();
    void Draw();

    void AddElement(uiElement *Element);
    void RemoveElement(uiElement *Element);

    std::list <uiElement*> Elements;

    ...
}

void uiWindow::Update()
{
    ...
    for (list <uiElement*>::iterator it = Elements.begin(); it != Elements.end(); it++ )
        it->Update();
    ...
}

void uiWindow::Draw()
{
    ...
    for (list <uiElement*>::iterator it = Elements.begin(); it != Elements.end(); it++ )
        it->Draw();
    ...
} 
```

原理是创建一个窗口并为其添加 ui 元素，并从各自的 main 函数中调用 draw 和 update 方法。

我还没有任何工作，因为我在绘制代码方面有问题。在 PC 和 PSP 上使用不同的 API，我正在查看 OpenGL 和 psp gu 的一些包装器代码。

希望这可以帮助。

东西2k

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T17:39:53.867

对于任何感兴趣的人，这是我的开源、BSD 许可的 DS GUI 工具包：

[http://www.sourceforge.net/projects/woopsi](http://www.sourceforge.net/projects/woopsi)

thing2k 的答案非常好，但我强烈建议在基 uiElement 类中包含包含子 UI 元素的代码。这是我在 Woopsi 中遵循的模式。

如果您在基类中*不*支持这一点，那么当您尝试实现比文本框和按钮更复杂的任何东西时，您将遇到重大问题。例如：

*   选项卡栏可以建模为多个按钮，它们组合在一起形成一个父 UI 元素，强制选择互斥；
*   单选按钮组（同上）；
*   滚动条可以表示为滑块/装订线元素和向上/向下按钮；
*   滚动列表可以表示为一个容器和多个选项 UI 元素。

此外，值得记住的是 DS 有一个 66MHz CPU 和 4MB RAM，用于存储和执行程序（DS ROM 在运行之前被加载到 RAM 中）。你真的应该把它当作一个嵌入式系统，这意味着 STL 已经过时了。我从 Woopsi 中删除了 STL，并设法节省了 0.5MB。以台式机标准衡量并不多，但这是 STL 垃圾消耗的 DS 总可用内存的 1/8。

我已经在我的博客上详细介绍了编写 UI 的整个过程：

[http://ant.simianzombie.com/blog](http://ant.simianzombie.com/blog)

它包括对我提出的用于重绘屏幕的两种算法的描述，这是创建 GUI 中最棘手的部分（一个只是将矩形拆分并记住可见区域；另一个使用 BSP 树，它更有效且更容易了解），优化技巧等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T04:11:02.087

要记住的一种有用策略可能是[复合模式](http://en.wikipedia.org/wiki/Composite_pattern)。在较低级别上，它可能允许您在构建后更轻松地处理所有 GUI 对象（和对象集合）。但我不知道 GUI 框架设计涉及什么，因此可以在现有项目的源代码中找到一般灵感。[WxWidgets](http://www.wxwidgets.org/downloads/)是一个提供源代码的跨平台 GUI 框架。祝你的项目好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T04:21:49.663

我认为看看其他 GUI 工具包的做法将是一个很好的起点。对于 C++ 示例，我听到了很多关于[Qt](http://trolltech.com/products/qt/)的好消息。不过我个人没有用过。当然还有尼克提到的 WxWidgets。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T23:35:57.870

就像您建议的那样，我编写了一个非常简单的 GUI。我让它在 Windows、Linux 和 Macintosh 上运行。它也应该相对容易地移植到任何系统，如 PSP 或 DS。

它是开源的，LGPL，在这里：

[http://code.google.com/p/kgui/](http://code.google.com/p/kgui/)

# web-applications - 对 Web 应用程序执行压力测试？

> ID：7492
> 
> 赞同：247
> 
> 时间：2008-08-11T03:00:26.957
> 
> 标签：web-applications, stress-testing, performance, webapplicationstresstool, pylot

过去，我使用 Microsoft Web Application Stress Tool 和 Pylot 对 Web 应用程序进行压力测试。我编写了一个简单的主页、登录脚本和站点演练（在电子商务站点中将一些商品添加到购物车并结帐）。

与少数开发人员一起努力访问主页几乎总是会发现一个主要问题。更多的可扩展性问题将在第二阶段出现，甚至更多——在发布之后。

我使用的工具的 URL 是 Microsoft Homer（又名[Microsoft Web Application Stress Tool](http://www.microsoft.com/downloads/details.aspx?familyid=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en)）和[Pylot](https://code.google.com/archive/p/pylt/)。

这些工具生成的报告对我来说从来没有多大意义，我会花很多时间试图弄清楚该站点能够支持哪种并发负载。这总是值得的，因为总是会出现最愚蠢的错误和瓶颈（例如，Web 服务器配置错误）。

你做了什么，你使用了什么工具，你的方法取得了什么成功？我最感兴趣的部分是提出某种有意义的公式，用于根据压力测试应用程序报告的数字计算应用程序可以支持的并发用户数。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-09-18T13:24:55.903

[**这是对JMeter**](http://jakarta.apache.org/jmeter/)的另一票。

JMeter 是一个开源负载测试工具，用 Java 编写。它能够测试许多不同的服务器类型（例如，Web、Web 服务、数据库，几乎所有使用请求的东西）。

然而，一旦你开始进行复杂的测试，它确实有一个陡峭的学习曲线，但它是非常值得的。您可以快速启动并运行，并且取决于您想要进行哪种压力测试，这可能没问题。

优点：

*   来自 Apache 项目的开源/免费工具（有助于购买）
*   掌握核心概念后，易于上手，易于使用。（即，如何创建请求、如何创建断言、如何使用变量等）。
*   非常可扩展。我已经在 11 台机器上运行了测试，在服务器上产生了近一百万次点击/小时的负载。设置比我预期的*要*容易得多。
*   拥有活跃的社区和良好的资源来帮助您启动和运行。首先阅读教程并玩一会儿。

缺点：

*   UI 是用 Swing 编写的。（啊！）
*   JMeter 通过解析服务器返回的响应文本来工作。因此，如果您希望验证任何类型的 javascript 行为，那么您就不走运了。
*   非程序员的学习曲线很陡峭。如果您熟悉正则表达式，那么您已经走在了前面。
*   支持论坛中有大量（*插入咒骂*）白痴提出愚蠢的问题，如果他们粗略地看一下文档，这些问题很容易解决。（“如何使用 JMeter 对我的 Windows GUI 进行压力测试”经常出现）。
*   报告“开箱即用”还有很多不足之处，特别是对于较大的测试。在我上面提到的测试中，我最终不得不编写一个快速控制台应用程序来执行一些“xml-logfile”到“html”的转换。不过那是几年前的事了，所以很可能不再需要这样做。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-08-11T03:27:15.250

我用过[The Grinder](http://grinder.sourceforge.net/)。它是开源的，非常易于使用且非常可配置。它基于 Java，并使用 Jython 编写脚本。我们针对一个 .NET Web 应用程序运行它，所以不要认为它是一个仅限 Java 的工具（就其本质而言，任何 Web 压力工具都不应该与它使用的平台绑定）。

我们用它做了一些巧妙的事情......我们是一个基于网络的电信应用程序，所以我设置的一个很酷的用途是通过我们的网络应用程序模仿拨号，然后使用我们拥有的自动应答工具（基本上是一个教程Microsoft 的应用程序连接到他们的 RTC LCS 服务器...这是 Microsoft Office Communicator 在本地网络上连接的...然后修改为仅自动接听电话）。然后，这使我们可以使用它而不是昂贵的电话工具，称为 The Hammer（或类似的东西）。

无论如何，我们还使用该工具查看了我们的应用程序在高负载下的运行情况，它在发现瓶颈方面非常有效。该工具已内置报告以显示请求需要多长时间，但我们从未使用过它。日志还可以存储所有响应和诸如此类的东西，或自定义日志记录。

我强烈推荐这个工具，对价格非常有用......但希望用它做一些自定义设置（它有一个内置的代理来记录脚本，但它可能需要自定义来捕获像会话这样的东西......我知道我必须对其进行自定义以利用每个线程的唯一会话）。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-02-17T04:49:54.923

这次聚会有点晚了。我同意[Pylot](https://qatestingtools.com/testing-tool/pylt)是目前最好的新兴开源工具。它使用简单，并且由一位伟人 ( [Corey Goldberg](http://www.goldb.org) ) 积极开发。作为[OpenQA](http://openqa.org)的创始人，我也很高兴 Pylot 现在列在我们的主页上并使用我们的一些基础设施（即论坛）。

然而，我最近还认为负载测试的整个概念是有缺陷的：模拟 HTTP 流量，应用程序变得如此复杂，是一件很痛苦的事情。这就是我创建商业工具 BrowserMob 的原因。这是一个[外部负载测试服务](http://browsermob.com)，在回放负载时使用[Selenium来控制真实的 Web 浏览器。](http://seleniumhq.org)

这种方法显然需要比**普通**负载测试技术更多的硬件，但是当您使用云计算时，硬件实际上非常便宜。这样做的一个很好的副作用是脚本编写比正常的负载测试要容易得多**。**您无需执行任何高级正则表达式匹配（如 JMeter 要求）来提取 cookie、.NET 会话状态、Ajax 请求参数等。由于您使用的是真正的浏览器，它们只会做它们应该做的事情。

很抱歉公然推销一个商业产品，但希望这个概念对某些人来说很有趣，并且至少让他们在您可以访问一堆额外硬件时考虑一些新的方法来处理负载测试！

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-08-11T04:26:42.353

我用过[JMeter](https://jmeter.apache.org/)。除了测试 Web 服务器之外，您还可以测试数据库后端、消息服务和电子邮件服务器。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-04-19T05:05:46.463

[ab](https://httpd.apache.org/docs/2.2/programs/ab.html)、[siege](https://www.joedog.org/siege-home/)、[tsung](http://tsung.erlang-projects.org/user_manual/)、[httperf](https://github.com/httperf/httperf)、[Trample](https://github.com/jamesgolick/trample)、 Pylot 、[request-log-analyzer](http://request-log-analyzer.com/)、[perftools](https://github.com/gperftools/gperftools)

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-01-02T22:08:22.133

对于基于 Web 的服务，请查看[loader.io](http://loader.io/)。

概括：

> loader.io 是一项免费的负载测试服务，可让您使用数千个并发连接对您的 web-apps/apis 进行压力测试。

他们也有一个[API](https://api.loader.io/docs)。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2013-03-28T23:52:34.397

由于这个问题仍然悬而未决，我不妨权衡一下。

好消息是，在过去 5 年左右的时间里，开源工具已经真正成熟并在该领域起飞，坏消息是其中有很多。

以下是我的想法：-

Jmeter vs磨床

Jmeter 由 XML 样式规范驱动，该规范是通过 GUI 构建的。

Grinder 在多线程 Java 框架中使用 Jython 脚本，因此更面向程序员。

这两种工具都将处理 HTTP 和 HTTPS，并有一个代理记录器来帮助您入门。这两种工具都使用控制器模型来驱动多个测试代理，因此可扩展性不是问题（允许访问云）。

哪个更好：-

当您遇到更复杂的 url 重写、关联、为每个虚拟用户提供唯一数据以及模拟第一次或返回用户（通过操作 HTTP 标头）的脚本要求时，这两种工具的学习曲线都非常陡峭，因此很难调用。

也就是说，我将从 Jmeter 开始，因为这个工具有大量的追随者，并且网上有很多使用这个工具的示例和教程。如果您遇到“路障”，那是您无法使用 Jmeter“轻松”完成的事情，然后看看 Grinder。好消息是这两个工具都具有相同的 Java 要求，并且“混合搭配”解决方案并非不可能。

添加一些新东西——运行多个 Selenium WebDriver 实例的无头浏览器。

这是一种相对较新的方法，因为它依赖于现在可以从云中配置的资源的可用性。使用这种方法，一个 Selenium (WebDriver) 脚本被采用并在多个线程中的无头浏览器（即 WebDriver = New HtmlUnitDriver()）驱动程序中运行。

根据经验，可以从 Amazon M1 小型实例执行大约 25 个“无头浏览器”实例。

这意味着当您将功能测试脚本重新调整为性能测试脚本时，所有相关性、url 重写问题都会消失。

与 Grinder 或 Jmeter 等 HTTP 驱动程序相比，由于需要更多 VM 来驱动负载，因此可扩展性受到影响。也就是说，如果您希望以每小时 1.20 美元的成本驱动 500 个虚拟用户，那么使用 20 个 Amazon 小型实例（每个小时 6 美分）可以为您提供非常接近真实用户体验的负载。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2010-08-23T09:58:24.570

对于简单的使用，我更喜欢 ab(apache benchmark) 和围攻，稍后需要一个，因为 ab 不支持 cookie 并且会从动态站点创建无休止的会话。

两者都很容易上手：

```
ab -c n -t 30 url

siege -b -c n -t 30s url 
```

siege 可以运行更多的 url。

最后一个围攻版本在siegerc中打开冗长，这很烦人。您只能通过编辑该文件（`/usr/local/etc/siegerc`）来禁用它。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-05-07T22:03:18.237

此外，还有一个很棒的开源纯 python 分布式和可扩展的[locust](http://locust.io/)框架，它使用[greenlets](http://greenlet.readthedocs.org/en/latest/)。它非常适合模拟大量同时使用的用户。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-11-23T16:44:43.827

我们最近开始使用 Gatling 进行负载测试。我强烈建议尝试使用此工具进行负载测试。我们过去使用过 SOASTA 和 JMETER。我们考虑加特林的主要原因如下：

*   记录器记录场景
*   与 Jmeter 线程模型相比，使用 Akka 和 Netty 可以提供更好的性能
*   与 Jmeter XML 相比，DSL Scala 非常易于维护
*   易于编写测试，不要害怕它是否是 scala。
*   报告

让我举个简单的例子来使用 Gatling Code 编写代码：

```
// your code starts here  
val scn = scenario("Scenario")  
     .exec(http("Page")
     .get("http://example.com")) 
// injecting 100 user enter code here's on above scenario.   
setUp(scn.inject(atOnceUsers(100))) 
```

但是，您可以使其尽可能复杂。Gatling 的突出特点之一是报告非常详细。

以下是一些链接：
[Gatling](http://gatling.io/docs/1.5.6/index.html)
[Gatling 教程](https://developer.gooddata.com/how-we-do/performance-testing)

我最近发表了演讲，您可以在这里进行演讲：
[https ://docs.google.com/viewer?url=http%3A%2F%2Ffiles.meetup.com%2F3872152%2FExploring-Load-Testing-with -加特林.pdf](https://docs.google.com/viewer?url=http%3A%2F%2Ffiles.meetup.com%2F3872152%2FExploring-Load-Testing-with-Gatling.pdf)

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-01-05T21:33:32.110

这是一个老问题，但我认为更新的解决方案值得一提。结帐 LoadImpact：[http](http://www.loadimpact.com) ://www.loadimpact.com 。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-30T01:07:12.063

我试过[WebLoad](http://www.radview.com/)它是一个非常简洁的工具。它带有测试脚本 IDE，允许您在网站上记录用户操作。它还会在您的 Web 服务器上执行压力测试时绘制图表。试试看，我强烈推荐它。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-11-01T03:03:38.703

Blaze Meter 有一个 chrome 扩展，用于记录会话并将它们导出到 JMeter（当前需要登录）。您还可以选择付钱给他们在他们的 JMeter 服务器集群上运行它（他们的定价似乎比我刚刚停止使用的 LoadImpact 好得多）：

*   [BlazeMeter Chrome 扩展](https://chrome.google.com/webstore/detail/blazemeter-the-load-testi/mbopgmdnpcbohhpnfglgohlbhfongabi?hl=en)
*   [关于它的博客条目](http://community.blazemeter.com/knowledgebase/articles/231479-chrome-extension)

我和他们没有任何联系，我只是喜欢他们服务的外观，虽然我还没有使用过付费版本。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-09-03T09:24:55.350

尝试了这里提到的所有内容，我发现 [curl-loader](http://curl-loader.sourceforge.net/doc/faq.html)最适合我的目的。非常简单的界面，实时监控，有用的统计数据，我从中构建了性能图表。libcurl 的所有功能都包括在内。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-06-22T01:38:28.007

您大约一年前问过这个问题，我不知道您是否还在寻找另一种对您的网站进行基准测试的方法。然而，由于这个问题仍未被标记为已解决，我想建议免费的[网络服务 LoadImpact](http://www.loadimpact.com)（顺便说一句。不附属）。刚刚通过 twitter 获得了这个链接，并想分享这个发现。它们创建了一个合理的良好概览，并且多花几块钱，您就可以获得“完全影响模式”。这可能听起来很奇怪，但祝你好运推动和制动你的服务:)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-08-28T19:38:25.400

我发现[IBM Page Detailer](http://www.alphaworks.ibm.com/tech/pagedetailer)也是一个有趣的工具。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-15T20:39:37.367

我用过[openSTA](http://www.opensta.org/)。

这允许记录与网站的会话，然后通过相对简单的脚本语言进行回放。

您可以轻松地测试 Web 服务并编写自己的脚本。

它允许您以任何您想要的方式将脚本放在测试中，并配置迭代次数、每次迭代中的用户数、引入每个新用户的加速时间以及每次迭代之间的延迟。将来也可以安排测试。

它是开源和免费的。

它会生成许多报告，这些报告可以保存到电子表格中。然后，我们使用数据透视表轻松分析和绘制结果。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-28T15:37:22.533

我们使用提到的 Microsoft 工具 - Microsoft Web Application Stress Tool。这是我用过的最简单的工具。它在许多方面受到限制，包括只能在手动创建的测试中访问端口 80。但是，它的易用性意味着它实际上被使用了。

我们使用包括 OpenSTA 和链接检查蜘蛛在内的其他工具来补充此工具的负载。

从我最初的评估来看，JMeter 看起来不错，我希望将它包含在我们未来的持续集成中。但是，JMeter 的推出很复杂且不容易。

我建议就解释 MS 压力工具结果提出另一个问题。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-12-08T21:28:44.787

Visual Studio 测试版 2010（2008 也不错）。这是一个非常简单而强大的工具，可以用来创建 Web/负载测试。

在 Windows 服务器上使用此工具的好处是，您可以集成访问报告中的所有 perfmon 服务器统计信息。真的很有用。

另一个好处是，使用 Visual Studio 项目，您可以集成一个“性能会话”，它将分析您网站的代码执行情况。

如果您从 Windows 服务器提供网页，这是最好的工具。

然而，使用多台机器对应用程序进行负载测试需要单独且昂贵的许可证。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-08-17T21:01:34.420

这里提到了很多很好的工具。我想知道工具是否可以回答以下问题：“您如何对 Web 应用程序进行压力测试？” 这些工具并没有真正提供一种对 Web 应用程序施加压力的方法。这是我所知道的：

压力测试显示了 Web 应用程序在为越来越多的用户提供响应时如何失败。压力测试显示 Web 应用程序在失败时如何运行。当今的大多数 Web 应用程序——尤其是社交/移动 Web 应用程序——都是服务的集成。例如，当 Facebook 在 2011 年 5 月中断时，您无法登录 Pepsi.com 的 Web 应用程序。该应用程序并没有完全失败，只是其正常功能的很大一部分对用户不可用。

性能测试表明 Web 应用程序能够独立于同时使用该应用程序的用户数量来维持响应时间。例如，一个每秒处理 10 个事务和 10 个并发用户的应用程序应该每秒处理 20 个事务和 20 个用户。如果应用程序每秒处理的事务少于 20 个，则响应时间会越来越长，并且应用程序无法实现线性可扩展性。

此外，在上面的示例中，每秒事务计数应该仅是测试用例/工作流的成功操作。故障通常发生在较短的时间跨度内，并且会使 TPS 测量过于乐观。故障对于压力和性能测试很重要，因为它们也会在应用程序上产生负载。

[我在http://www.pushtotest.com/pushtotest-testmaker-6-methodology](http://www.pushtotest.com/pushtotest-testmaker-6-methodology)的 TestMaker 用户指南中编写了 PushToTest 方法。TestMaker 有两种版本：开源 (GPL) 社区版和 TestMaker 企业版（具有强大专业支持的商业版。）

-坦率

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2012-07-15T14:39:35.453

我们开发了一个流程，将负载和性能测量视为头等大事 - 正如您所说，将其留到项目结束往往会导致失望......

因此，在开发过程中，我们包括了非常基本的多用户测试（使用 selenium），它检查基本的疯狂问题，如会话管理中断、明显的并发问题和明显的资源争用问题。不平凡的项目在持续集成过程中包含此内容，因此我们会收到非常定期的反馈。

对于没有极端性能要求的项目，我们在测试中包括基本的性能测试；通常，我们使用 BadBoy 编写测试脚本，并将它们导入 JMeter，替换登录详细信息和其他特定于线程的内容。然后我们将这些提升到服务器每秒处理 100 个请求的水平；如果响应时间小于 1 秒，通常就足够了。我们开始并继续我们的生活。

对于性能要求极高的项目，我们仍然使用 BadBoy 和 JMeter，但投入了大量精力来了解我们测试平台上的服务器（通常是 Web 和数据库服务器）的瓶颈。有一个用于分析 Microsoft 事件日志的好[工具，](http://pal.codeplex.com/)它对此有很大帮助。我们通常会发现意想不到的瓶颈，如果可能，我们会对其进行优化；这为我们提供了一个在“1 个 Web 服务器，1 个数据库服务器”上尽可能快的应用程序。然后，我们通常会部署到我们的目标基础设施，并使用“云中的 Jmeter”服务之一来大规模地重新运行测试。

同样，PAL 报告有助于分析测试期间发生的情况——您经常会在生产环境中看到截然不同的瓶颈。

关键是要确保您不仅要运行压力测试，还要收集了解应用程序性能所需的信息。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-12-29T05:43:25.380

看看 LoadBooster ( [https://www.loadbooster.com](https://www.loadbooster.com) )。它利用无头脚本浏览器 PhantomJS/CasperJs 来测试网站。Phantomjs 将解析和渲染每个页面，执行客户端脚本。无头浏览器方法更容易编写测试场景以支持复杂的 AJAX 重型 Web 2.0 应用程序，浏览器导航、鼠标单击和击键进入浏览器或等待 DOM 中存在元素。LoadBooster 也支持 selenium HTML 脚本。

免责声明：我为 LoadBooster 工作。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-09-30T21:21:12.673

试试[ZebraTester](https://www.zebratester.com/)，它比 jMeter 更容易使用。我已经使用 jMeter 很长时间了，但是负载测试的总设置时间一直是个问题。尽管 ZebraTester 不是开源的，但我在过去六个月中节省的时间弥补了这一点。他们还有一个 SaaS 门户，可用于使用负载生成器快速运行测试。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-08-11T03:31:52.167

还有一点需要注意的是，对于我们的 Web 应用程序，我发现由于线程之间对锁的争用，我们遇到了巨大的性能问题......所以道德是非常仔细地考虑锁定方案。我们最终让工作线程使用异步 http 处理程序来限制过多的请求，否则应用程序将不堪重负并崩溃和烧毁。这意味着可能会堆积大量积压，但至少该网站会保持运行。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-08-21T10:34:39.620

看看[TestComplete](http://www.automatedqa.com/products/testcomplete/tc_lss_testing.asp)。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-20T22:09:00.017

我支持opensta的建议。我只想补充一点，它允许您使用 SMTP 监控您正在测试的服务器。我们会跟踪处理器负载、使用的内存、发送的再见等。唯一的缺点是，如果您发现一些问题并想要进行修复，它依赖于几个不再跟上的开源库，因此需要进行编译源版本比大多数 OSS 更棘手。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-02-03T10:55:07.573

我玩过JMeter。一种认为它无法测试的是 ASP.NET Webforms。视图状态打破了我的测试。我不知道为什么，但是有几个工具不能正确处理视图状态。我目前的项目是 ASP.NET MVC，JMeter 可以很好地配合它。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2012-12-11T01:22:17.917

冒着被指责无耻自我推销的风险，我想指出，在我寻求免费负载测试工具的过程中，我阅读了这篇文章： http: [//www.devcurry.com/2010/07/10-free-工具加载压力测试your.html](http://www.devcurry.com/2010/07/10-free-tools-to-loadstress-test-your.html)

要么我无法获得我想要的吞吐量，要么我无法获得我想要的灵活性。并且我想在测试后分析中轻松汇总多个负载测试生成主机的结果。

我尝试了列表中的每一个工具，但令我沮丧的是，它们都没有完成我想做的事情。所以我建立了一个并分享它。

这是：http: [//sourceforge.net/projects/loadmonger](http://sourceforge.net/projects/loadmonger)

PS：熟悉城市俚语的人不会对这个名字进行冷嘲热讽。我不是，但现在稍微更世俗了。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2012-11-13T10:32:48.667

[我使用FunkLoad](http://funkload.nuxeo.org/)取得了不错的成绩：

*   易于编写用户交互脚本
*   报告很清楚
*   可以监控服务器负载

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-06-28T13:37:29.150

我也投票给**jMeter**，我想在@PeterBernier 答案中添加一些引号。

> 负载测试回答的主要问题是我的 Web 应用程序可以支持多少并发用户？为了得到正确的答案， **负载测试应该尽可能接近真实的应用程序使用情况**。

请记住，**jMeter**有许多构建块**Logical Controllers**，**Config Elements**，**Pre Processors**，**Listeners** ，...可以帮助您。

您可以使用 jMeter 模拟现实世界的情况，例如，您可以：

1.  `concurrent resource download`通过配置 ( , `browser cache`, `http headers`, `setting request time out`, `cookie management`, `https support`, `encoding`, `ajax support`,... )将 jMeter 配置为真正的浏览器
2.  配置 jMeter 以生成用户请求（通过定义`number of users per second`, `ramp-up time`, `scheduling`,...）
3.  使用 jMeter 配置大量客户端，进行分布式负载测试。
4.  处理响应以查找服务器在测试期间是否正确响应。（例如`assert`响应在其中查找文本）

请考虑：

*   在几分钟内使用 jMeter 开始一个真正的 Web 应用程序测试很容易。jMeter 有一个非常简单的工具，可以记录您的测试场景（称为`HTTP(S) Test Script Recorder`）。
*   [jMeter 在http://jmeter-plugins.org](http://jmeter-plugins.org)有很多插件。
*   jMeter UI 是基于 swing 的，并且在 jMeter 3.2 中进行了很好的更改。另一方面，请考虑 JMeter GUI 应该只用于测试和调试。在 GUI 模式下使用它进行实际测试并不是一个好习惯。[https://www.blazemeter.com/blog/5-ways-launch-jmeter-test-without-using-jmeter-gui](https://www.blazemeter.com/blog/5-ways-launch-jmeter-test-without-using-jmeter-gui)。配置和测试您的场景并在非 gui 模式下运行它。
*   在 jMeter（称为`listeners`）中有很多显示工具的报告，但并不意味着在测试期间打开。您必须运行测试并生成报告（`.jtl`文件）。然后你必须使用这些工具来分析结果。请查看[https://www.blazemeter.com/blog/jmeter-listeners-part-1-basic-display-formats](https://www.blazemeter.com/blog/jmeter-listeners-part-1-basic-display-formats)或[https://www.tutorialspoint.com/jmeter/jmeter_listeners.htm](https://www.tutorialspoint.com/jmeter/jmeter_listeners.htm)。

[https://www.blazemeter.com/jmeter](https://www.blazemeter.com/jmeter)有非常好的实用信息，可以帮助您配置测试环境。

# c# - Linq to objects - 选择第一个对象

> ID：7503
> 
> 赞同：12
> 
> 时间：2008-08-11T03:54:43.947
> 
> 标签：c#, linq, linq-to-objects

我对 linq 几乎一无所知。

我正在这样做：

```
var apps = from app in Process.GetProcesses()
    where app.ProcessName.Contains( "MyAppName" ) && app.MainWindowHandle != IntPtr.Zero
    select app; 
```

这让我得到了符合该标准的所有正在运行的进程。

但我不知道如何获得第一个。我可以在网上找到的例子似乎暗示我必须这样做

```
var matchedApp = (from app in Process.GetProcesses()
    where app.ProcessName.Contains( "MyAppName" ) && app.MainWindowHandle != IntPtr.Zero
    select app).First(); 
```

这让我觉得有点难看，如果没有匹配的进程也会抛出异常。有没有更好的办法？

**更新**

我实际上是在尝试找到第一个匹配的项目，然后调用`SetForegroundWindow`它

我想出了这个解决方案，它也让我觉得丑陋和可怕，但比上面的要好。有任何想法吗？

```
var unused = from app in Process.GetProcesses()
    where app.ProcessName.Contains( "MyAppName" ) && app.MainWindowHandle != IntPtr.Zero
    select SetForegroundWindow( app.MainWindowHandle ); // side-effects in linq-query is technically bad I guess 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-11T04:25:07.333

@FryHard FirstOrDefault 将起作用，但请记住，如果没有找到它，它会返回 null。此代码未经测试，但应该接近您想要的：

```
var app = Process.GetProcesses().FirstOrDefault(p => p.ProcessName.Contains("MyAppName") && p.MainWindowHandle != IntPtr.Zero);

if (app == null)
    return;

SetForegroundWindow(app.MainWindowHandle); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-11-18T22:54:00.053

不要像 ICR 所说的*那样*使用。将遍历以找出它有多少项目。在这种情况下，由于进程不多，性能损失可能可以忽略不计，但这是一个坏习惯。仅在您的查询只对*结果数量感兴趣时使用。*几乎从来都不是一个好主意。`Count()``Count()``IEnumerable``Count()` *`Count`*

 *FryHard 的回答存在几个问题。首先，由于[延迟执行](http://devlicio.us/blogs/derik_whittaker/archive/2008/04/07/linq-and-delayed-execution.aspx "Derik Whittaker 谈 LINQ 的延迟执行")，您最终将执行两次 LINQ 查询，一次获取结果数，一次获取`FirstOrDefault`. `FirstOrDefault`其次，检查计数后没有任何理由使用。因为它可以返回 null，所以你不应该在不检查 null 的情况下使用它。要么做`apps.First().MainWindowHandle`要么：

```
var app = apps.FirstOrDefault();

if (app != null)
    SetForegroundWindow(app.MainWindowHandle); 
```

这就是为什么最好的解决方案是马克的，毫无疑问。这是使用 LINQ 获得所需内容的最有效和最稳定的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T04:20:38.260

假设在您的第一个示例应用程序中是一个 IEnumerable，您可以使用 .Count 和 .FirstOrDefault 属性来获取要传递给 SetForegroundWindow 的单个项目。

```
var apps = from app in Process.GetProcesses()
where app.ProcessName.Contains( "MyAppName" ) && app.MainWindowHandle != IntPtr.Zero
select app;

if (apps.Count > 0)
{
    SetForegroundWindow(apps.FirstOrDefault().MainWindowHandle );
} 
```

# sql - 在 SQL Server 中删除一组表

> ID：7517
> 
> 赞同：7
> 
> 时间：2008-08-11T04:32:01.000
> 
> 标签：sql, sql-server, database

有没有一种简单的方法可以在 SQL Server 中删除一组相互关联的表？理想情况下，我想避免担心他们被丢弃的顺序，因为我知道整个团队都会在流程结束时消失。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-25T07:40:42.033

冒着听起来很愚蠢的风险，我不相信 SQL Server 支持删除/级联语法。我认为您可以配置删除规则来执行级联删除（[http://msdn.microsoft.com/en-us/library/ms152507.aspx](http://msdn.microsoft.com/en-us/library/ms152507.aspx)），但据我所知，SQL Server 的诀窍就是运行对于您要删除的每个表，您的删除查询一次，然后检查它是否有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-25T07:18:16.000

一种不同的方法可能是：首先摆脱约束，然后一次性删除表。

换句话说，每个约束都有一个 DROP CONSTRAINT，然后每个表都有一个 DROP TABLE；在这一点上，执行顺序应该不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T15:54:13.157

这需要您可以在[Database Journal中找到的](http://www.databasejournal.com/img/usr_sp_drop_constraints.sql)**sp___drop___constraints**脚本：

```
sp_MSforeachtable @command1="print 'disabling constraints: ?'", @command2="sp_drop_constraints @tablename=?"
GO
sp_MSforeachtable @command1="print 'dropping: ?'", @command2="DROP TABLE ?"
GO 
```

**注意**这一点 - 显然 - 如果您打算删除数据库中的所有表，所以要小心

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T05:19:48.547

我无权访问 SQL Server 来测试这个，但是如何：

```
DROP TABLE IF EXISTS table1, table2, table3 CASCADE; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-16T20:00:05.243

我不确定 Derek 的方法是否有效。您尚未将其标记为最佳答案。

如果不是：我猜使用 SQL Server 2005 应该是可能的。
他们在那里引入了异常（我还没有使用过）。因此，删除表，捕获异常，如果发生异常并尝试下一个表，直到它们都消失。
如果需要，您可以将表列表存储在临时表中并使用游标遍历它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-25T07:08:17.587

我最终使用 Apache 的[ddlutils](http://db.apache.org/ddlutils/)为我执行删除操作，这在我的情况下进行了整理，尽管仅在 sql server 中有效的解决方案会简单得多。

@Derek Park，我不知道你可以在那里用逗号分隔表格，所以这很方便，但它似乎并没有像预期的那样工作。Nether IF EXISTS 或 CASCADE 似乎都被 sql server 识别，并且运行`drop table X, Y, Z`似乎只有在它们应该按照规定的顺序删除时才有效。

另请参阅[http://msdn.microsoft.com/en-us/library/ms173790.aspx](http://msdn.microsoft.com/en-us/library/ms173790.aspx)，其中描述了删除表语法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-25T07:15:24.637

阻止您以任何顺序删除表的是表之间的外键依赖关系。所以在你开始之前摆脱FK。

1.  使用 INFORMATION_SCHEMA 系统视图，检索与这些表中的任何一个相关的所有外键的列表
2.  删除这些外键中的每一个
3.  现在您应该能够使用您想要的任何顺序删除所有表。

# c++ - 内存管理、堆损坏和 C++

> ID：7525
> 
> 赞同：20
> 
> 时间：2008-08-11T04:52:50.800
> 
> 标签：c++, memory, stack, heap-memory

所以，我需要一些帮助。我正在使用 C++ 开发一个项目。但是，我想我已经设法破坏了我的堆。这是基于我将 an 添加`std::string`到一个类并为它分配另一个值的事实`std::string`：

```
std::string hello = "Hello, world.\n";
/* exampleString = "Hello, world.\n" would work fine. */
exampleString = hello; 
```

我的系统因堆栈转储而崩溃。所以基本上我需要**停下**来检查我所有的代码和内存管理的东西，找出我搞砸的地方。代码库仍然很小（大约 1000 行），所以这很容易做到。

尽管如此，我还是对这种东西感到头疼，所以我想我会把它扔在那里。我在 Linux 系统上使用`valgrind`，虽然不完全知道我在做什么，但它确实报告了`std::string`' 的析构函数是无效的。我不得不承认从谷歌搜索中得到了“堆损坏”这个词；任何关于这类东西的通用文章也将不胜感激。

（在之前`rm -rf ProjectDir`，在 C# 中再次执行：D）

编辑：我还没有说清楚，但我要的是诊断这类内存问题的建议。我知道 std::string 的东西是正确的，所以这是我做过的事情（或者是一个错误，但 Select 没有问题）。我确信我可以检查我编写的代码，你们非常聪明的人很快就会发现问题，但我想将这种代码分析添加到我的“工具箱”中，就像它一样。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-08-11T11:59:25.777

这些是可能解决问题的相对便宜的机制：

1.  密切关注我的[堆损坏问题](https://stackoverflow.com/questions/1069/heap-corruption-under-win32-how-to-locate)- 我正在更新答案，因为他们已经摆脱了。第一个是平衡`new[]`和`delete[]`，但你已经这样做了。
2.  给[valgrind](http://valgrind.org/)更多的尝试；这是一个很好的工具，我只希望它在 Windows 下可用。我只将您的程序减慢了大约一半，这与 Windows 等效程序相比已经相当不错了。
3.  考虑使用[Google 性能工具](http://code.google.com/p/google-perftools/)作为 malloc/new 的替代品。
4.  您是否已清除所有目标文件并重新开始？也许您的制作文件是......“次优”
5.  你`assert()`的代码还不够。没看过怎么知道？就像使用牙线一样，`assert()`他们的代码中没有人足够。为您的对象添加一个验证函数，并在方法开始和方法结束时调用它。
6.  你在[编译 -wall](http://gcc.gnu.org/onlinedocs/gcc-4.3.0/cpp/Invocation.html#Invocation)吗？如果没有，请这样做。
7.  给自己找一个 lint 工具，比如[PC-Lint](http://www.gimpel.com/)。像您这样的小应用程序可能适合[PC-lint 演示](http://gimpel-online.com/cgi-bin/genPage.py?srcFile=diy.cpp&cgiScript=analyseCode.py&title=Blank+Slate+(C%2B%2B)+&intro=An+empty+page+in+which+to+write+your+own+C%2B%2B+code.&compilerOption=co-gcc.lnt+co-gnu3.lnt&includeOption=%7B%7BquotedIncludeOption%7D%7D)页面，这意味着您无需购买！
8.  检查您在删除指针后是否将指针清空。没有人喜欢悬空指针。与已声明但未分配的指针相同的演出。
9.  停止使用数组。请改用[向量](http://en.wikipedia.org/wiki/Vector_(STL))。
10.  不要使用原始指针。使用[智能指针](http://en.wikipedia.org/wiki/Smart_pointer)。不要使用`auto_ptr`！那东西……令人惊讶；它的语义很奇怪。取而代之的是，选择[Boost 智能指针](http://www.boost.org/doc/libs/1_35_0/libs/smart_ptr/smart_ptr.htm)之一，或[Loki 库中的](http://en.wikipedia.org/wiki/Loki_(C%2B%2B))某个东西。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T13:06:18.773

我们曾经有一个错误，它避开了所有常规技术，valgrind，purify 等。崩溃只发生在具有大量内存的机器上，并且只发生在大型输入数据集上。

最终，我们使用调试器观察点对其进行了跟踪。我将尝试在这里描述该过程：

1）查找故障原因。从您的示例代码中可以看出，“exampleString”的内存已损坏，因此无法写入。让我们继续这个假设。

2）在使用或修改“exampleString”没有任何问题的最后一个已知位置设置断点。

3) 为“exampleString”的数据成员添加一个观察点。使用我的 g++ 版本，字符串存储在`_M_dataplus._M_p`. 我们想知道这个数据成员什么时候改变。用于此的 GDB 技术是：

```
(gdb) p &exampleString._M_dataplus._M_p
$3 = (char **) 0xbfccc2d8
(gdb)  watch *$3
Hardware watchpoint 1: *$3 
```

我显然在这里使用带有 g++ 和 gdb 的 linux，但我相信大多数调试器都可以使用内存观察点。

4) 继续直到触发观察点：

```
Continuing.
Hardware watchpoint 2: *$3

Old value = 0xb7ec2604 ""
New value = 0x804a014 ""
0xb7e70a1c in std::string::_M_mutate () from /usr/lib/libstdc++.so.6
(gdb) where 
```

gdb`where`命令将给出一个回溯，显示导致修改的原因。这是一个完全合法的修改，在这种情况下继续 - 或者如果你很幸运，这将是由于内存损坏而导致的修改。在后一种情况下，您现在应该能够查看*真正*导致问题的代码并希望修复它。

The cause of our bug was an array access with a negative index. The index was the result of a cast of a pointer to an 'int' modulos the size of the array. The bug was missed by valgrind et al. as the memory addresses allocated when running under those tools was never "`> MAX_INT`" and so never resulted in a negative index.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-11T06:20:21.810

哦，如果你想知道如何调试问题，那很简单。首先，得到一只死鸡。然后，[开始摇晃它](http://c2.com/cgi/wiki?VoodooChickenCoding)。

说真的，我还没有找到一种一致的方法来追踪这些类型的错误。因为有很多潜在的问题，所以没有一个简单的清单可以通过。但是，我会推荐以下内容：

1.  熟悉调试器。
2.  开始在调试器中四处游荡，看看是否能找到任何看起来可疑的东西。尤其要检查在线期间发生的情况`exampleString = hello;`。
3.  检查以确保它确实`exampleString = hello;`在线崩溃，而不是在退出某些封闭块时（这可能导致析构函数触发）。
4.  检查您可能正在做的任何指针魔术。指针算术、强制转换等。
5.  检查所有分配和解除分配以确保它们匹配（没有双重解除分配）。
6.  确保您没有返回任何指向堆栈上对象的引用或指针。

还有很多其他的东西可以尝试。我相信其他一些人也会提出想法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-11T06:49:15.777

一些开始的地方：

如果您在 Windows 上，并且使用 Visual C++6（我希望上帝这些天仍然没有人使用它），那么 std::string 的实现不是线程安全的，并且可能导致这种事情。

[这是我发现的一篇文章，它解释了内存泄漏和损坏的许多常见原因。](http://www.yolinux.com/TUTORIALS/C++MemoryCorruptionAndMemoryLeaks.html)

在我以前的工作场所，我们使用 Compuware Boundschecker 来帮助解决这个问题。它是商业的并且非常昂贵，因此可能不是一个选择。

这是几个可能有用的免费库

[http://www.codeguru.com/cpp/misc/misc/memory/article.php/c3745/](http://www.codeguru.com/cpp/misc/misc/memory/article.php/c3745/)

[http://www.codeproject.com/KB/cpp/MemLeakDetect.aspx](http://www.codeproject.com/KB/cpp/MemLeakDetect.aspx)

希望有帮助。内存损坏是一个糟糕的地方！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T05:31:27.213

这可能是堆损坏，但也可能是堆栈损坏。吉姆是对的。我们真的需要更多的上下文。这两行来源并不能单独告诉我们太多。可能有很多原因导致这种情况（这是 C/C++ 的真正乐趣）。

如果您愿意发布您的代码，您甚至可以将所有代码放在服务器上并发布链接。我相信您会以这种方式获得更多建议（其中一些无疑与您的问题无关）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T05:38:47.090

如我所见，您的代码没有错误。正如已经说过的，需要更多的上下文。

如果您还没有尝试过，请安装 gdb（gcc 调试器）并使用 -g 编译程序。这将编译 gdb 可以使用的调试符号。安装 gdb 后，使用程序 (gdb <your_program>) 运行它。[这](http://web.archive.org/web/20130512080834/http://www.cs.vassar.edu:80/%7Ecs331/gdbtutorial.html)是使用 gdb 的有用备忘。

为产生错误的函数设置断点，并查看 exampleString 的值是什么。对传递给 exampleString 的任何参数也执行相同的操作。这至少应该告诉您 std::strings 是否有效。

[我发现这篇文章](https://stackoverflow.com/questions/5727/understanding-pointers)的答案是关于指针的一个很好的指南。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-11T06:01:25.610

该代码只是我的程序失败的一个示例（它被分配在堆栈上，Jim）。我实际上并不是在寻找“我做错了什么”，而是“我如何诊断我做错了什么”。教一个人钓鱼等等。虽然看了这个问题，但我还没有说得足够清楚。感谢上帝的编辑功能。:')

另外，我实际上修复了 std::string 问题。如何？通过用向量替换它，编译，然后再次替换字符串。它*一直*在那里崩溃，即使它……也不能修复。那里有一些讨厌的东西，我不确定是什么。不过，我确实想检查一下我在堆上手动分配内存的一次：

```
 this->map = new Area*[largestY + 1];
 for (int i = 0; i < largestY + 1; i++) {
     this->map[i] = new Area[largestX + 1];
 } 
```

并删除它：

```
for (int i = 0; i < largestY + 1; i++) {
    delete [] this->map[i];
}
delete [] this->map; 
```

我以前没有用 C++ 分配过二维数组。它似乎工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-11T06:26:06.853

> 另外，我实际上修复了 std::string 问题。如何？通过用向量替换它，编译，然后再次替换字符串。它一直在那里崩溃，即使它……也不能修复。那里有一些讨厌的东西，我不确定是什么。

听起来你真的对它动摇了。如果您不知道它*为什么*现在可以工作，那么它仍然是坏的，并且几乎可以保证以后会再次咬您（在您增加了更多复杂性之后）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-11T07:24:10.137

运行净化。

这是一个近乎神奇的工具，当你破坏你不应该接触的内存时，它会报告，不释放东西而泄漏内存，双重释放等等。

它在机器代码级别工作，因此您甚至不必拥有源代码。

我参加过的最愉快的供应商电话会议之一是当 Purify 在他们的代码中发现内存泄漏时，我们能够问，“您是否可能没有在您的函数 foo() 中释放内存”并听到他们的声音中充满了惊讶。

他们认为我们是在调试神，但后来我们让他们知道了秘密，这样他们就可以在我们不得不使用他们的代码之前运行 Purify。:-)

[http://www-306.ibm.com/software/awdtools/purify/unix/](http://www-306.ibm.com/software/awdtools/purify/unix/)

（它相当昂贵，但他们有免费的 eval 下载）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-11T08:34:56.407

我经常使用的调试技术之一（除了最奇怪的情况）是分而治之。如果您的程序当前因某些特定错误而失败，则以某种方式将其分成两半，看看它是否仍然有相同的错误。显然，诀窍是决定在哪里划分你的程序！

您给出的示例没有显示足够的上下文来确定错误可能在哪里。如果其他人要尝试您的示例，它将正常工作。所以，在你的程序中，尽量删除你没有向我们展示的额外内容，然后看看它是否有效。如果是这样，则一次添加一些其他代码，直到它开始失败。那么，你刚刚添加的东西可能就是问题所在。

请注意，如果您的程序是多线程的，那么您可能会遇到更大的问题。如果没有，那么您应该能够以这种方式缩小范围。祝你好运！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-21T19:18:44.040

除了 Boundschecker 或 Purify 之类的工具之外，解决此类问题的最佳选择是真正擅长阅读代码并熟悉您正在处理的代码。

内存损坏是最难解决的问题之一，通常这些类型的问题可以通过在调试器中花费数小时/数天并注意到诸如“嘿，指针 X 被删除后正在使用！”之类的东西来解决。

如果它有帮助，那么随着经验的积累，你会变得更好。

您为数组分配的内存看起来是正确的，但请确保您也检查了访问数组的所有位置。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-11T05:18:52.683

据我所知，您的代码是正确的。假设 exampleString 是具有您描述的类范围的 std::string ，您应该能够以这种方式初始化/分配它。也许还有其他问题？也许一段实际代码将有助于将其置于上下文中。

问题：exampleString 是指向使用 new 创建的字符串对象的指针吗？

# sql-server - SQL Server 2008 compatibility with SQL Server 2005

> ID：7535
> 
> 赞同：15
> 
> 时间：2008-08-11T05:16:13.047
> 
> 标签：sql-server, sql-server-2008, sql-server-2005

What is the best way to use SQL Server 2008 as a development database, but ensure that the database is compatible with SQL Server 2005?

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-08-11T05:35:06.177

This can be done via SQL Enterprise Manager or like this:

```
ALTER DATABASE <database> 
SET COMPATIBILITY_LEVEL = { 80 | 90 | 100 } 
```

Use 90 for 2005 compatibility.

This replaces the functionality used for previous releases, the stored procedure *sp_dbcmptlevel*.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-02T09:42:18.180

You can set the database compatibility level, but there is no guarantee that this will cover all your bases. For example the new data types will be available on the SQL 2008 system, but they won't be available on the SQL 2005 server.

The only way to guarantee that everything will work from Dev to Prod is to put SQL 2005 in development.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:12:41.223

Don't forget that there are also behavioral differences between the two versions, and something on 2008 may perform differently (and insufficiently) than 2005 all other things equal - this will obviously depend on a lot of factors about your data and application.

You're better off developing against the lowest common denominator and testing against the newer versions.

# java - java.math.MathContext 的使用

> ID：7539
> 
> 赞同：60
> 
> 时间：2008-08-11T05:23:02.427
> 
> 标签：java, math, bigdecimal, mathcontext

最近我尝试理解**java.math.MathContext**的使用但未能正确理解。是否用于四舍五入`java.math.BigDecimal`。如果是，为什么不四舍五入十进制数字，甚至尾数部分。

从 API 文档中，我了解到它遵循和规范中指定的标准，`ANSI X3.274-1996`但`ANSI X3.274-1996/AM 1-2000`我没有让它们在线阅读。

如果您对此有任何想法，请告诉我。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2010-11-16T12:55:27.560

要仅舍入 BigDecimal 的小数部分，请查看该`BigDecimal.setScale(int newScale, int roundingMode)`方法。

例如，将小数点后三位数字更改为两位数，然后四舍五入：

```
BigDecimal original = new BigDecimal("1.235");
BigDecimal scaled = original.setScale(2, BigDecimal.ROUND_HALF_UP); 
```

结果是一个值为 1.24 的 BigDecimal（由于向上舍入规则）

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-08-11T06:06:48.483

@jatan

> 谢谢你的回答。这说得通。您能否在 BigDecimal#round 方法的上下文中解释一下 MathContext。

`BigDecimal.round()` *与*任何其他`BigDecimal`方法相比，没有什么特别之处。在所有情况下，`MathContext`指定有效位数和舍入技术。基本上，每个[`MathContext`](http://java.sun.com/j2se/1.5.0/docs/api/java/math/MathContext.html). 有精度，也有[`RoundingMode`](http://java.sun.com/j2se/1.5.0/docs/api/java/math/RoundingMode.html).

精度再次指定有效位数。因此，如果您指定`123`为一个数字，并要求 2 个有效数字，您将得到`120`. 如果你用科学记数法来思考可能会更清楚。

`123`将采用`1.23e2`科学计数法。如果您只保留 2 位有效数字，那么您会得到`1.2e2`或`120`。通过减少有效数字的数量，我们可以降低指定数字的精度。

该`RoundingMode`部分指定了我们应该如何处理精度损失。要重用该示例，如果您使用`123`作为数字，并要求 2 个有效数字，则您降低了精度。使用`RoundingMode`of `HALF_UP`（默认模式），`123`将变为`120`. 使用`RoundingMode`of `CEILING`，您将获得`130`.

例如：

```
System.out.println(new BigDecimal("123.4",
                   new MathContext(4,RoundingMode.HALF_UP)));
System.out.println(new BigDecimal("123.4",
                   new MathContext(2,RoundingMode.HALF_UP)));
System.out.println(new BigDecimal("123.4",
                   new MathContext(2,RoundingMode.CEILING)));
System.out.println(new BigDecimal("123.4",
                   new MathContext(1,RoundingMode.CEILING))); 
```

输出：

```
123.4
1.2E+2
1.3E+2
2E+2 
```

您可以看到精度和舍入模式都会影响输出。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2014-04-10T13:06:56.220

我想在这里补充几个例子。我在以前的答案中没有找到它们，但我发现它们对于那些可能用**小数位数误导****有效数字**的人很有用。假设，我们有这样的上下文：

 **```
MathContext MATH_CTX = new MathContext(3, RoundingMode.HALF_UP); 
```

对于此代码：

```
BigDecimal d1 = new BigDecimal(1234.4, MATH_CTX);
System.out.println(d1); 
```

很明显，您的结果`1.23E+3`正如上面所说的那样。第一位有效数字是 123...

但是在这种情况下：

```
BigDecimal d2 = new BigDecimal(0.000000454770054, MATH_CTX);
System.out.println(d2); 
```

您的数字**不会在逗号后四舍五入到 3 位**- 对于某些人来说，它可能不直观且值得强调。相反，它将被舍入到**前 3 位有效数字**，在本例中为“4 5 4”。所以上面的代码会导致`4.55E-7`而不是`0.000`像人们所期望的那样。

类似的例子：

```
BigDecimal d3 = new BigDecimal(0.001000045477, MATH_CTX);
 System.out.println(d3);  // 0.00100

BigDecimal d4 = new BigDecimal(0.200000477, MATH_CTX);
 System.out.println(d4);   // 0.200

BigDecimal d5 = new BigDecimal(0.000000004, MATH_CTX);
    System.out.println(d5); //4.00E-9 
```

我希望这个明显但相关的例子会有所帮助......

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-11T05:44:00.747

如果我对您的理解正确，听起来您希望 MathContext 控制小数点后应保留多少位数。那不是它的用途。它指定要保留的位数，*总计*。因此，如果您指定需要 3 个有效数字，这就是您将得到的全部。

例如，这个：

```
System.out.println(new BigDecimal("1234567890.123456789",
                   new MathContext(20)));

System.out.println(new BigDecimal("1234567890.123456789",
                   new MathContext(10)));

System.out.println(new BigDecimal("1234567890.123456789",
                   new MathContext(5))); 
```

将输出：

```
1234567890.123456789
1234567890
1.2346E+9 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-11T05:45:35.173

这不是为了好玩。实际上我找到了一些在线示例，其中说明了使用`MathContext`来舍入存储在 BigDecimal 中的金额/数字。

例如，

如果`MathContext`配置为具有`precision = 2`和`rounding mode = ROUND_HALF_EVEN`

`BigDecimal Number = 0.5294`，*四舍五入*为**0.53**

所以我认为这是一种较新的技术，并将其用于舍入目的。然而，它变成了噩梦，因为它甚至开始舍入数字的 mentissa 部分。

例如，

`Number = 1.5294`四舍五入为`1.5`

`Number = 10.5294`四舍五入为`10`

`Number = 101.5294`四舍五入为`100`

.... 等等

所以这不是我期望的舍入行为（因为精度 = 2）。

它似乎有一些逻辑，因为从模式我可以说它需要数字的前两位（因为精度为 2），然后附加 0 直到没有。位数变得与未四舍五入的数量相同（查看 101.5294 的示例 ...）

# javascript - Firefox 3 中的某种 JavaScript 任务管理器？

> ID：7540
> 
> 赞同：11
> 
> 时间：2008-08-11T05:24:33.593
> 
> 标签：javascript, firefox, memory, cpu

最近我在 Ubuntu Hardy Heron 上遇到了 Firefox 3 的问题。

我将单击一个链接，它会挂起一段时间。我不知道它是 Firefox 3 中的错误还是运行过多客户端 JavaScript 的页面，但我想尝试调试一下。

所以，我的问题是“有没有办法为 Firefox 3 提供某种进程浏览器或任务管理器之类的东西？”

我希望能够通过该页面上的 JavaScript（或页面中导致 CPU/内存使用的任何内容）查看哪些选项卡正在使用我的处理器的百分比。

有人知道这样做的插件或类似的东西吗？有没有其他人以另一种方式进行过这种检查？

我知道 FireBug，但我无法想象如何使用它来确定哪个选项卡正在使用大量资源。

有什么建议或见解吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-11T06:35:58.160

这可能是[令人敬畏的 firefox3 fsync "bug"](http://shaver.off.net/diary/2008/05/25/fsyncers-and-curveballs/)，这是一大堆失败。

总之

*   Firefox3 将其书签和历史记录保存在 SQLite 数据库中
*   每次加载页面时，它都会多次写入该数据库
*   SQLite 非常关心您不会丢失书签，因此每次写入时，都会指示内核将其数据库文件刷新到磁盘并确保它已完全写入
*   许多 linux 变体，当被告知要像这样刷新时，会刷新每个文件。如果您有后台任务执行任何类型的磁盘密集型工作，这可能需要一分钟或更长时间。
*   当刷新发生时，内核让 firefox 等待，从而锁定 UI。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-02T08:37:30.710

> 所以，我的问题是，有没有办法为 Firefox 3 提供某种进程浏览器或任务管理器之类的东西？

由于 Firefox 的构建方式，目前这是不可能的。但是新的 Internet Explorer 8 Beta 2 和刚刚发布的 Google Chrome 浏览器正朝着这个方向发展，所以我想 Firefox 也会朝着这个方向发展。

这是来自 Mozilla 的 John Resig 和 jQuery 在该主题上声名鹊起的帖子（ [Google Chrome 进程管理器）。](http://ejohn.org/blog/google-chrome-process-manager/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T15:42:35.903

Firefox 没有“进程浏览器”之类的工具；但是有带有分析模式的[https://developer.mozilla.org/en-US/docs/Archive/Mozilla/Venkman](https://developer.mozilla.org/en-US/docs/Archive/Mozilla/Venkman)，您可以使用它来查看 chrome 花费的时间（意思是非内容，不是网页) 脚本。

从我所读到的内容来看，DTrace 也可能对这类事情有用，但它需要创建自定义构建并可能向源添加额外的探针。我自己还没玩过。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-20T03:47:03.833

对此进行了[彻底的讨论](http://shaver.off.net/diary/2008/05/25/fsyncers-and-curveballs/)，解释了影响 FF 3.0 之前版本的所有与 fsync 相关的问题。一般来说，从那以后我也没有看到过这种行为，如果您的系统也没有执行 IO 密集型任务，那么它真的不应该是一个问题。Firebug/Venkman 是很好的调试器，但如果为别人的代码 IMO 找出这类问题，他们会很痛苦。

不过，我也希望有一种简单的方法可以通过选项卡查看 Firefox 中的 CPU 利用率，因为我经常发现自己的 FF 占用了 100% 的 CPU，但不知道是哪个部分导致了问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-23T08:12:50.263

[XUL Profiler](https://addons.mozilla.org/en-US/firefox/addon/9954)是一个很棒的扩展，它可以指出扩展和客户端 JS 在 CPU 方面的问题。它不适用于每个选项卡，而是每个脚本（或左右）。您通常可以手动将这些 .js 脚本与您的选项卡或扩展名关联起来。

还值得一提的是，谷歌浏览器内置了一个非常好的任务管理器，可以为每个选项卡、扩展程序和插件提供内存和 CPU 使用率。

> [XUL Profiler] 是一个 Javascript 分析器。它以图表的形式显示每种方法中经过的时间，以及重绘浏览器画布区域以帮助追踪消耗 CPU 的代码块。
> 
> 跟踪 XUL 和页面上下文中的所有 JS 调用和绘制事件。构建动态显示正在重绘的画布区域的动画。

从 FF 3.6.10 开始，它不再是最新的，因为它不再被标记为兼容。但它仍然有效，您可以覆盖与同样出色的[MR Tech Toolkit 扩展](https://addons.mozilla.org/en-US/firefox/addon/mr-tech-toolkit/ "MR 技术工具包扩展")的不兼容性。

# wcf - 保护 REST API/Web 服务的最佳实践

> ID：7551
> 
> 赞同：836
> 
> 时间：2008-08-11T05:44:42.803
> 
> 标签：wcf, security, rest, authorization, rest-security

在设计 REST API 或服务时，是否有任何既定的最佳实践来处理安全性（身份验证、授权、身份管理）？

在构建 SOAP API 时，您可以将 WS-Security 作为指南，并且有很多关于该主题的文献。我发现有关保护 REST 端点的信息较少。

虽然我理解 REST 故意没有类似于 WS-* 的规范，但我希望已经出现了最佳实践或推荐模式。

任何讨论或相关文件的链接将不胜感激。如果这很重要，我们将使用带有 POX/JSON 序列化消息的 WCF，用于使用 .NET Framework 的 v3.5 构建的 REST API/服务。

* * *

## 回答 #1

> 赞同：302
> 
> 时间：2008-08-11T08:45:13.343

正如tweakt 所说，Amazon S3 是一个很好的模型。他们的请求签名确实具有一些功能（例如包含时间戳），有助于防止意外和恶意请求重放。

HTTP Basic 的好处是几乎所有的 HTTP 库都支持它。当然，在这种情况下，您将需要 SSL，因为通过网络发送明文密码几乎是一件坏事。在使用 SSL 时，Basic 比 Digest 更可取，因为即使调用者已经知道需要凭据，Digest 也需要额外的往返来交换 nonce 值。使用 Basic，调用者只需在第一次发送凭据。

一旦确定了客户端的身份，授权实际上只是一个实现问题。但是，您可以将授权委托给具有现有授权模型的其他组件。同样，Basic 的好处是您的服务器最终得到了客户端密码的纯文本副本，您可以根据需要简单地将其传递给基础架构中的另一个组件。

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2008-08-11T06:07:03.680

除了 HTTP，REST 没有其他标准。那里已经建立了 REST 服务。我建议你看看它们，感受一下它们是如何工作的。

例如，我们在开发自己的 S3 REST 服务时借鉴了很多想法。但是我们选择不使用基于请求签名的更高级的安全模型。更简单的方法是基于 SSL 的 HTTP Basic auth。你必须决定什么最适合你的情况。

另外，我强烈推荐O'reilly的[RESTful Web Services一书。](http://oreilly.com/catalog/9780596529260/)它解释了核心概念并提供了一些最佳实践。您通常可以采用他们提供的模型并将其映射到您自己的应用程序。

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2008-09-18T02:55:07.493

您可能还想看看[OAuth](http://oauth.net/)，这是一种新兴的开放协议，用于基于令牌的授权，专门针对 http api。

[它与flickr](http://www.flickr.com/services/api/)采用的方法非常相似，并且[记住了牛奶](http://www.rememberthemilk.com/services/api/)“rest” api（不一定是 restful api 的好例子，而是基于 token 方法的好例子）。

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2017-11-08T20:29:14.780

在[Github](https://github.com/shieldfy/API-Security-Checklist)上有一个很棒的清单：

**验证**

*   不要在身份验证、令牌生成、密码存储中重新发明轮子。使用标准。

*   在登录中使用`Max Retry`和监禁功能。

*   对所有敏感数据使用加密。

**JWT（JSON 网络令牌）**

*   使用随机的复杂密钥（JWT Secret）使暴力破解令牌变得非常困难。

*   不要从有效载荷中提取算法。在后端强制算法（HS256 或 RS256）。

*   使令牌到期 ( `TTL`, `RTTL`) 尽可能短。

*   不要在`JWT`有效载荷中存储敏感数据，它很容易被解码。

**身份验证**

*   始终验证`redirect_uri`服务器端以仅允许列入白名单的 URL。

*   始终尝试交换代码而不是令牌（不允许`response_type=token`）。

*   使用带有随机散列的状态参数来防止`CSRF`身份`OAuth`验证过程。

*   定义默认范围，并验证每个应用程序的范围参数。

**使用权**

*   限制请求（限制）以避免 DDoS / 暴力攻击。

*   在服务器端使用 HTTPS 来避免 MITM（中间人攻击）

*   使用`HSTS`带有 SSL 的标头来避免 SSL Strip 攻击。

**输入**

*   根据操作使用正确的 HTTP 方法：（`GET`读取）、`POST`（创建）、`PUT/PATCH`（替换/更新）和`DELETE`（删除记录），`405 Method Not Allowed`如果请求的方法不适合请求的资源，则响应。

*   验证请求`Accept`标头上的内容类型（内容协商）以仅允许您支持的格式（例如`application/xml`，`application/json`等），`406 Not Acceptable`如果不匹配，则以响应响应。

*   在您接受时验证已`content-type`发布的数据（例如`application/x-www-form-urlencoded`、`multipart/form-data`、`application/json`等）。

*   验证用户输入以避免常见漏洞（例如 XSS、SQL 注入、远程代码执行等）。

*   不要在 URL 中使用任何敏感数据（凭据、密码、安全令牌或 API 密钥），而是使用标准`Authorization`标头。

*   使用 API Gateway 服务来启用缓存、`Rate Limit`策略（例如配额、Spike Arrest、并发速率限制）并动态部署 API 资源。

**加工**

*   检查是否所有端点都受到身份验证的保护，以避免身份验证过程中断。

*   应避免使用用户自己的资源 ID。使用 /me/orders 而不是 /user/654321/orders。

*   不要自动增加 ID。请改用 UUID。

*   如果您正在解析 XML 文件，请确保未启用实体解析以避免 XXE（XML 外部实体攻击）。

*   如果您正在解析 XML 文件，请确保未启用实体扩展，以避免通过指数实体扩展攻击引发的 Billion Laughs/XML 炸弹。

*   使用 CDN 进行文件上传。

*   如果您正在处理大量数据，请尽可能使用Workers和Queues在后台处理并快速返回响应以避免HTTP阻塞。

*   不要忘记关闭**调试**模式。

**输出**

*   发送`X-Content-Type-Options: nosniff`标头。

*   发送`X-Frame-Options: deny`标头。

*   发送`Content-Security-Policy: default-src 'none'`标头。

*   删除指纹标头 - `X-Powered-By`、`Server`等`X-AspNet-Version`。

*   强制`content-type`您的响应，如果您返回，`application/json`那么您的响应内容类型为`application/json`.

*   不要返回敏感数据，如凭据、密码、安全令牌。

*   根据操作完成返回正确的状态码。（例如`200 OK`, `400 Bad Request`, `401 Unauthorized`,`405 Method Not Allowed`等）。

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2009-09-25T19:39:38.080

我有点惊讶尚未提及带有客户端证书的 SSL。当然，这种方法只有在您可以依靠证书识别的用户社区时才真正有用。但是许多政府/公司确实将它们发给了他们的用户。用户不必担心创建另一个用户名/密码组合，并且在每个连接上都建立了身份，因此与服务器的通信可以完全是无状态的，不需要用户会话。（不暗示提到的任何/所有其他解决方案都需要会话）

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2013-09-24T22:22:33.730

这些答案中的每个人都忽略了真正的访问控制/授权。

例如，如果您的 REST API/Web 服务是关于发布/获取医疗记录的，您可能需要定义访问控制策略，了解谁可以访问数据以及在什么情况下访问数据。例如：

*   医生可以获取与他们有护理关系的患者的病历
*   没有人可以在练习时间以外发布医疗数据（例如 9 到 5 点）
*   最终用户可以获取他们拥有的医疗记录或他们作为监护人的患者的医疗记录
*   护士可以更新与护士属于同一单位的患者的病历。

为了定义和实现这些细粒度的授权，您需要使用一种名为 XACML 的基于属性的访问控制语言，即可扩展访问控制标记语言。

此处的其他标准适用于以下内容：

*   OAuth：身份证。联合和授权委托，例如让一个服务代表我代表另一个服务（Facebook 可以发布到我的 Twitter）
*   SAML：身份联合/Web SSO。SAML 非常关注用户是谁。
*   WS-Security / WS-* 标准：这些标准侧重于 SOAP 服务之间的通信。它们特定于应用程序级消息传递格式 (SOAP)，它们处理消息传递的各个方面，例如可靠性、安全性、机密性、完整性、原子性、事件……没有一个涉及访问控制，所有这些都特定于 SOAP。

XACML 与技术无关。它可以应用于 Java 应用程序、.NET、Python、Ruby... Web 服务、REST API 等。

以下是有趣的资源：

*   OASIS XACML[网站](http://oasis-open.org/committees/tc_home.php?wg_abbrev=xacml)
*   [NIST ABAC](http://csrc.nist.gov/projects/abac/)标准

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2009-01-09T21:25:56.060

我已经使用过几次 OAuth，并且还使用了一些其他方法（BASIC/DIGEST）。我全心全意地建议 OAuth。以下链接是我见过的关于使用 OAuth 的最佳教程：

[http://hueniverse.com/oauth/guide/](http://hueniverse.com/oauth/guide/)

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2008-09-18T20:53:16.903

我遇到过的关于与 REST 相关的安全性的最佳帖子之一已在[1 RainDrop 结束](http://1raindrop.typepad.com/1_raindrop/2006/12/rest_security_o.html)。MySpace API 还使用 OAuth 来保证安全性，您可以完全访问 RestChess 代码中的自定义通道，我对此进行了很多探索。这是在 Mix 上演示的，你可以在[这里](http://blogs.msdn.com/vbertocci/archive/2008/03/10/wcf-rest-at-mix08-the-tale-of-myspace-apis.aspx)找到帖子。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-09-17T20:30:10.570

感谢您的出色建议。我们最终使用自定义 HTTP 标头将身份令牌从客户端传递到服务，以准备将我们的 RESTful API 与即将推出的 Microsoft 采尔马特身份框架集成。我在这里描述了问题[和](http://www.thefreakparade.com/2008/09/flowing-identity-from-a-client-to-a-service-when-using-restful-wcf-part-2-a-solution/)[我们](http://www.thefreakparade.com/2008/09/flowing-identity-from-a-client-to-a-service-when-using-restful-wcf-part-1-the-problem/)的解决方案。我还接受了[tweakt](https://stackoverflow.com/questions/7551/best-practices-for-securing-a-rest-api-web-service#7562)的建议并购买了[RESTful Web Services——](http://oreilly.com/catalog/9780596529260/)如果你正在构建任何类型的RESTful API，这是一本非常好的书。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2014-02-24T18:41:39.710

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-03-14T00:59:38.470

我会推荐 OAuth 2/3。[您可以在http://oauth.net/2/](http://oauth.net/2/)找到更多信息

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2012-05-15T10:36:28.137

我搜索了很多关于 restful ws 安全性的内容，最后我们还通过 cookie 从客户端到服务器使用令牌来验证请求。我使用 spring security 来授权服务中的请求，因为我必须根据已经在 DB 中的指定安全策略对每个请求进行身份验证和授权。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-11-21T14:19:04.320

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2012-10-12T08:22:50.130

REST 本身没有提供安全标准，但像 OAuth 和 SAML 这样的东西正在迅速成为这个领域的标准。但是，身份验证和授权只是您需要考虑的一小部分。许多与 Web 应用程序相关的已知漏洞非常适用于 REST API。您必须考虑输入验证、会话破解、不适当的错误消息、内部员工漏洞等。这是一个很大的课题。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-03-01T01:04:58.197

我想添加（与 stinkeymatt 一致），最简单的解决方案是将 SSL 证书添加到您的站点。换句话说，请确保您的网址是 HTTPS://。这将涵盖您的运输安全（物有所值）。使用 RESTful url，想法是保持简单（与 WS* 安全/SAML 不同），您可以使用[oAuth2/openID 连接](https://github.com/thinktecture/Thinktecture.AuthorizationServer)甚至基本身份验证（在简单的情况下）。但是您仍然需要 SSL/HTTPS。请在此处检查 ASP.NET Web API 2 安全性：[http](http://www.asp.net/web-api/overview/security) ://www.asp.net/web-api/overview/security （文章和视频）

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-07-17T15:08:57.343

正如@Nathan 最终得到的是一个简单的 HTTP 标头，有些人说 OAuth2 和客户端 SSL 证书。它的要点是……您的 REST API 不必处理安全性，因为这实际上应该超出 API 的范围。

相反，应该在其之上放置一个安全层，无论是 Web 代理后面的 HTTP Header（一种常见的方法，如 SiteMinder、Zermatt 甚至 Apache HTTPd），还是像 OAuth 2 一样复杂。

关键是请求应该在没有任何最终用户交互的情况下工作。所需要做的就是确保与 REST API 的连接经过身份验证。在 Java EE 中，我们有一个`userPrincipal`可以在`HttpServletRequest`. 它还在部署描述符中进行管理，即 URL 模式可以是安全的，因此 REST API 代码不再需要检查。

在 WCF 世界中，我将使用它`ServiceSecurityContext.Current`来获取当前的安全上下文。您需要将应用程序配置为需要身份验证。

我上面的陈述有一个例外，那就是使用随机数来防止重播（可能是攻击或某人只是提交了两次相同的数据）。那部分只能在应用层处理。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-10-06T06:05:08.970

对于 Web 应用程序安全，您应该查看 OWASP ( [https://www.owasp.org/index.php/Main_Page](https://www.owasp.org/index.php/Main_Page) )，它为各种安全攻击提供了备忘单。您可以采用尽可能多的措施来保护您的应用程序。关于 API 安全性（授权、身份验证、身份管理），已经提到了多种方法（Basic、Digest 和 OAuth）。OAuth1.0存在漏洞，所以可以使用OAuth1.0a（OAuth2.0由于规范问题没有被广泛采用）

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-08-11T21:51:08.757

已经有一段时间了，但这个问题仍然是相关的，尽管答案可能已经改变了一点。

API 网关将是一种灵活且高度可配置的解决方案。[我对KONG](http://getkong.org)进行了相当多的测试和使用，并且非常喜欢我所看到的。KONG 提供了自己的管理 REST API，您可以使用它来管理用户。

[Express-gateway.io](http://express-gateway.io)是更新的，也是一个 API 网关。

# events - Column Tree Model doesn't expand node after EXPAND_NO_CHILDREN event

> ID：7558
> 
> 赞同：2
> 
> 时间：2008-08-11T06:00:22.333
> 
> 标签：events, treeview, abap

I am displaying a list of items using a SAP ABAP column tree model, basically a tree of folder and files, with columns.

I want to load the sub-nodes of folders dynamically, so I'm using the EXPAND_NO_CHILDREN event which is firing correctly.

Unfortunately, after I add the new nodes and items to the tree, the folder is automatically collapsing again, requiring a second click to view the sub-nodes. Do I need to call a method when handling the event so that the folder stays open, or am I doing something else wrong?

```
* Set up event handling.
  LS_EVENT-EVENTID  = CL_ITEM_TREE_CONTROL=>EVENTID_EXPAND_NO_CHILDREN.
  LS_EVENT-APPL_EVENT = GC_X.
  APPEND LS_EVENT TO LT_EVENTS.
  CALL METHOD GO_MODEL->SET_REGISTERED_EVENTS
    EXPORTING
      EVENTS                    = LT_EVENTS
    EXCEPTIONS
      ILLEGAL_EVENT_COMBINATION = 1
      UNKNOWN_EVENT             = 2.
  SET HANDLER GO_APPLICATION->HANDLE_EXPAND_NO_CHILDREN
    FOR GO_MODEL.

...

* Add new data to tree.
  CALL METHOD GO_MODEL->ADD_NODES
    EXPORTING
      NODE_TABLE = PTI_NODES[]
    EXCEPTIONS
      ERROR_IN_NODE_TABLE = 1.

  CALL METHOD GO_MODEL->ADD_ITEMS
    EXPORTING
      ITEM_TABLE = PTI_ITEMS[]
    EXCEPTIONS
      NODE_NOT_FOUND = 1
      ERROR_IN_ITEM_TABLE = 2. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-18T04:07:19.173

自从我玩 SAP 已经有一段时间了，但是当我遇到困难时，我总是发现 SAP 库特别有用……

我设法为你想出了这个：http: [//help.sap.com/saphelp_nw04/helpdata/en/47/aa7a18c80a11d3a6f90000e83dd863/frameset.htm](http://help.sap.com/saphelp_nw04/helpdata/en/47/aa7a18c80a11d3a6f90000e83dd863/frameset.htm)，具体来说：

> *当您向树模型添加新节点时，将标志 ITEMSINCOM 设置为“X”。
> 这会通知树模型您要按需加载该节点的项目。*

希望能帮助到你？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T14:13:09.137

你的代码看起来不错，

`ADD_NODES_AND_ITEMS`如果我要添加节点和项目，我会自己使用该方法；）

除此之外，在添加项目/节点后尝试调用`EXPAND_NODE`，看看是否有帮助。

# sql-server - 在 Sql Server 维护计划中重组索引与重建索引

> ID：7579
> 
> 赞同：41
> 
> 时间：2008-08-11T07:02:46.483
> 
> 标签：sql-server, rebuild, maintenance-plan, reorganize

在更好的 SQL Server 数据库的 SSW 规则中有一个完整的数据库维护计划的示例：[SSW](http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterSQLServerDatabases.aspx#MaintenancePlan)。在示例中，他们同时运行 Reorganize Index、Rebuild Index 和 Update Statistics。这有什么意义吗？我认为 Reorganize Index 是 Rebuild Index 的一个快速但效率较低的版本？并且索引重建也会自动更新统计信息（至少在聚集索引上）。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-08-11T07:44:54.637

重组和重建是不同的事情。

重组：它是索引的碎片整理。获取现有索引并对现有页面进行碎片整理。但是，如果页面不是连续的，它们会像以前一样保持不变。只有页面的内容在变化。

重建：实际上它删除索引并从头开始重建它。这意味着您将获得一个全新的索引，其中包含碎片整理和连续页面。

此外，通过rebuild，您可以更改分区或文件组，但通过reorganize，您不仅可以对整个索引进行碎片整理，还可以对索引的一个分区进行碎片整理。

更新统计信息在聚集索引上是自动的，但不是在非聚集索引上。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2016-01-27T10:39:28.347

在考虑维护索引之前，重要的是要回答两个主要问题：

1.  碎片化程度如何？
2.  什么是适当的行动？重组还是重建？

如本文所述[http://solutioncenter.apexsql.com/why-when-and-how-to-rebuild-and-reorganize-sql-server-indexes/](http://solutioncenter.apexsql.com/why-when-and-how-to-rebuild-and-reorganize-sql-server-indexes/)，并帮助您确定是否应该执行索引重建或指数重组，请理解以下内容：

*   索引重组是 SQL Server 遍历现有索引并清理它的过程。索引重建是一个繁重的过程，其中索引被删除，然后以全新的结构从头开始重新创建，没有所有堆积的碎片和空白页面。

*   虽然索引重组是一种纯粹的清理操作，它使系统状态保持原样，而不会锁定受影响的表和视图，但重建过程会在整个重建期间锁定受影响的表，这可能会导致长时间停机，这在一些环境。考虑到这一点，很明显，索引重建是一个具有“更强”解决方案的过程，但它带来了代价——可能会在受影响的索引表上长时间锁定。

另一方面，索引重组是一个“轻量级”的过程，它将以一种不太有效的方式解决碎片——因为清理过的索引总是仅次于完全从头开始制作的新索引。但是从效率的角度来看，重组索引要好得多，因为它在操作过程中不会锁定受影响的索引表。

上述文章还解释了如何使用 SSMS、T-SQL（在表中重组/重建索引）和名为 ApexSQL Backup 的第 3 方工具来重组和重建索引。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-02-24T01:49:11.527

在相同的索引上执行 a`REORGANIZE`然后 a是没有意义的，因为执行.`REBUILD``REORGANIZE``REBUILD`

更糟糕的是，在 SSW 的维护计划图中，它执行了`SHRINK`第一个操作，将索引碎片化，这是它释放空间方式的副作用。然后在操作`REBUILD`期间再次为数据库文件分配更多空间作为工作空间`REBUILD`。

*   `REORGANIZE`是一种联机操作，它使用很少的额外工作空间逐页对聚集或非聚集索引中的叶页进行碎片整理。

*   `REBUILD`在 Enterprise 版本中是联机操作，在其他版本中是脱机操作，并且再次使用与索引大小一样多的额外工作空间。它创建索引的新副本，然后删除旧的副本，从而消除碎片。默认情况下，作为此操作的一部分重新计算统计信息，但可以禁用。

有关详细信息，请参阅[重组和重建索引](http://msdn.microsoft.com/en-us/library/ms189858.aspx)。

不要将`SHRINK`except 与`TRUNCATEONLY`选项一起使用，即使文件会再次增长，那么您应该认真考虑是否有必要：

[sqlservercentral_SHRINKFILE](http://www.sqlservercentral.com/articles/SHRINKFILE/71414/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-03T06:36:13.970

在对索引进行重组时，如果索引分布在两个或多个物理文件中，则数据只会在数据文件中进行碎片整理。页面不会从一个数据文件移动到另一个数据文件。

当索引在单个文件中时，reorg 和 reindex 将具有相同的最终结果。

有时重组会更快，有时重建索引会更快，具体取决于索引的碎片程度。索引的碎片越少，重组就会越快，碎片越多，重组的速度就越慢，但重组的速度就越快。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-08-11T09:17:41.640

正是[比里](https://stackoverflow.com/questions/7579/reorganise-index-vs-rebuild-index-in-sql-server-maintenance-plan?sort=Votes#7595)所说的。以下是我将如何重新索引整个数据库：

```
EXEC [sp_MSforeachtable] @command1="RAISERROR('DBCC DBREINDEX(''?'') ...',10,1) WITH NOWAIT DBCC DBREINDEX('?')" 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-09-25T11:37:54.327

我用这个SP

```
CREATE PROCEDURE dbo.[IndexRebuild]
AS 
DECLARE @TableName NVARCHAR(500);
DECLARE @SQLIndex NVARCHAR(MAX);
DECLARE @RowCount INT;
DECLARE @Counter INT;

DECLARE @IndexAnalysis TABLE
    (
      AnalysisID INT IDENTITY(1, 1)
                     NOT NULL
                     PRIMARY KEY ,
      TableName NVARCHAR(500) ,
      SQLText NVARCHAR(MAX) ,
      IndexDepth INT ,
      AvgFragmentationInPercent FLOAT ,
      FragmentCount BIGINT ,
      AvgFragmentSizeInPages FLOAT ,
      PageCount BIGINT
    )

BEGIN
    INSERT  INTO @IndexAnalysis
            SELECT  [objects].name ,
                    'ALTER INDEX [' + [indexes].name + '] ON ['
                    + [schemas].name + '].[' + [objects].name + '] '
                    + ( CASE WHEN (   [dm_db_index_physical_stats].avg_fragmentation_in_percent >= 20
                                    AND [dm_db_index_physical_stats].avg_fragmentation_in_percent < 40
                                  ) THEN 'REORGANIZE'
                             WHEN [dm_db_index_physical_stats].avg_fragmentation_in_percent > = 40
                             THEN 'REBUILD'
                        END ) AS zSQL ,
                    [dm_db_index_physical_stats].index_depth ,
                    [dm_db_index_physical_stats].avg_fragmentation_in_percent ,
                    [dm_db_index_physical_stats].fragment_count ,
                    [dm_db_index_physical_stats].avg_fragment_size_in_pages ,
                    [dm_db_index_physical_stats].page_count
            FROM    [sys].[dm_db_index_physical_stats](DB_ID(), NULL, NULL,
                                                       NULL, 'LIMITED') AS   [dm_db_index_physical_stats]
                    INNER JOIN [sys].[objects] AS [objects] ON (   [dm_db_index_physical_stats].[object_id] = [objects].[object_id] )
                    INNER JOIN [sys].[schemas] AS [schemas] ON ( [objects].[schema_id]  = [schemas].[schema_id] )
                    INNER JOIN [sys].[indexes] AS [indexes] ON (  [dm_db_index_physical_stats].[object_id] = [indexes].[object_id]
                                                          AND  [dm_db_index_physical_stats].index_id = [indexes].index_id
                                                          )
            WHERE   index_type_desc <> 'HEAP'
                    AND [dm_db_index_physical_stats].avg_fragmentation_in_percent > 20
END

SELECT  @RowCount = COUNT(AnalysisID)
FROM    @IndexAnalysis

SET @Counter = 1
WHILE @Counter <= @RowCount 
    BEGIN

        SELECT  @SQLIndex = SQLText
        FROM    @IndexAnalysis
        WHERE   AnalysisID = @Counter

        EXECUTE sp_executesql @SQLIndex

        SET @Counter = @Counter + 1

    END
 GO 
```

并创建一个每周执行此 SP 的作业。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-06-26T05:56:20.200

更好的是：

```
EXEC sp_MSforeachtable 'ALTER INDEX ALL ON ? REINDEX' 
```

或者

```
EXEC sp_MSforeachtable 'ALTER INDEX ALL ON ? REORGANIZE' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-01-28T22:39:06.860

我在网络上进行了研究，发现了一些不错的文章。我在下面编写了函数和脚本，用于重组、重新创建或重建数据库中的所有索引。

首先，您可能需要阅读[这篇文章](http://blogs.technet.com/b/sql_server_isv/archive/2010/10/18/index-fragmentation-if-it-isn-t-broke-don-t-fix-it.aspx)以了解为什么我们不只是重新创建所有索引。

其次，我们需要一个函数来为索引构建创建脚本。所以[这篇文章](https://gallery.technet.microsoft.com/scriptcenter/SQL-Server-Generate-Index-fa790441)可能会有所帮助。我也在下面分享工作功能。

最后一步制作一个while循环来查找和组织数据库中的所有索引。[该视频](https://www.youtube.com/watch?v=-awkG4vt0Xo)是制作此视频的绝佳示例。

功能：

```
create function GetIndexCreateScript(
    @index_name nvarchar(100)
) 
returns nvarchar(max)
as
begin

declare @Return   varchar(max)

SELECT @Return = ' CREATE ' + 
    CASE WHEN I.is_unique = 1 THEN ' UNIQUE ' ELSE '' END  +  
    I.type_desc COLLATE DATABASE_DEFAULT +' INDEX ' +   
    I.name  + ' ON '  +  
    Schema_name(T.Schema_id)+'.'+T.name + ' ( ' + 
    KeyColumns + ' )  ' + 
    ISNULL(' INCLUDE ('+IncludedColumns+' ) ','') + 
    ISNULL(' WHERE  '+I.Filter_definition,'') + ' WITH ( ' + 
    CASE WHEN I.is_padded = 1 THEN ' PAD_INDEX = ON ' ELSE ' PAD_INDEX = OFF ' END + ','  + 
    'FILLFACTOR = '+CONVERT(CHAR(5),CASE WHEN I.Fill_factor = 0 THEN 100 ELSE I.Fill_factor END) + ','  + 
    -- default value 
    'SORT_IN_TEMPDB = OFF '  + ','  + 
    CASE WHEN I.ignore_dup_key = 1 THEN ' IGNORE_DUP_KEY = ON ' ELSE ' IGNORE_DUP_KEY = OFF ' END + ','  + 
    CASE WHEN ST.no_recompute = 0 THEN ' STATISTICS_NORECOMPUTE = OFF ' ELSE ' STATISTICS_NORECOMPUTE = ON ' END + ','  + 
    -- default value  
    ' DROP_EXISTING = ON '  + ','  + 
    -- default value  
    ' ONLINE = OFF '  + ','  + 
   CASE WHEN I.allow_row_locks = 1 THEN ' ALLOW_ROW_LOCKS = ON ' ELSE ' ALLOW_ROW_LOCKS = OFF ' END + ','  + 
   CASE WHEN I.allow_page_locks = 1 THEN ' ALLOW_PAGE_LOCKS = ON ' ELSE ' ALLOW_PAGE_LOCKS = OFF ' END  + ' ) ON [' + 
   DS.name + ' ] '  
FROM sys.indexes I   
 JOIN sys.tables T ON T.Object_id = I.Object_id    
 JOIN sys.sysindexes SI ON I.Object_id = SI.id AND I.index_id = SI.indid   
 JOIN (SELECT * FROM (  
    SELECT IC2.object_id , IC2.index_id ,  
        STUFF((SELECT ' , ' + C.name + CASE WHEN MAX(CONVERT(INT,IC1.is_descending_key)) = 1 THEN ' DESC ' ELSE ' ASC ' END 
    FROM sys.index_columns IC1  
    JOIN Sys.columns C   
       ON C.object_id = IC1.object_id   
       AND C.column_id = IC1.column_id   
       AND IC1.is_included_column = 0  
    WHERE IC1.object_id = IC2.object_id   
       AND IC1.index_id = IC2.index_id   
    GROUP BY IC1.object_id,C.name,index_id  
    ORDER BY MAX(IC1.key_ordinal)  
       FOR XML PATH('')), 1, 2, '') KeyColumns   
    FROM sys.index_columns IC2   
    --WHERE IC2.Object_id = object_id('Person.Address') --Comment for all tables  
    GROUP BY IC2.object_id ,IC2.index_id) tmp3 )tmp4   
  ON I.object_id = tmp4.object_id AND I.Index_id = tmp4.index_id  
 JOIN sys.stats ST ON ST.object_id = I.object_id AND ST.stats_id = I.index_id   
 JOIN sys.data_spaces DS ON I.data_space_id=DS.data_space_id   
 JOIN sys.filegroups FG ON I.data_space_id=FG.data_space_id   
 LEFT JOIN (SELECT * FROM (   
    SELECT IC2.object_id , IC2.index_id ,   
        STUFF((SELECT ' , ' + C.name  
    FROM sys.index_columns IC1   
    JOIN Sys.columns C    
       ON C.object_id = IC1.object_id    
       AND C.column_id = IC1.column_id    
       AND IC1.is_included_column = 1   
    WHERE IC1.object_id = IC2.object_id    
       AND IC1.index_id = IC2.index_id    
    GROUP BY IC1.object_id,C.name,index_id   
       FOR XML PATH('')), 1, 2, '') IncludedColumns    
   FROM sys.index_columns IC2    
   --WHERE IC2.Object_id = object_id('Person.Address') --Comment for all tables   
   GROUP BY IC2.object_id ,IC2.index_id) tmp1   
   WHERE IncludedColumns IS NOT NULL ) tmp2    
ON tmp2.object_id = I.object_id AND tmp2.index_id = I.index_id   
WHERE I.is_primary_key = 0 AND I.is_unique_constraint = 0 
AND I.[name] = @index_name

return @Return

end 
```

Sql一会儿：

```
declare @RebuildIndex Table(
    IndexId int identity(1,1),
    IndexName varchar(100),
    TableSchema varchar(50),
    TableName varchar(100),
    Fragmentation decimal(18,2)
)

insert into @RebuildIndex (IndexName,TableSchema,TableName,Fragmentation)
SELECT 
    B.[name] as 'IndexName', 
    Schema_Name(O.[schema_id]) as 'TableSchema',
    OBJECT_NAME(A.[object_id]) as 'TableName',
    A.[avg_fragmentation_in_percent] Fragmentation
FROM sys.dm_db_index_physical_stats(db_id(),NULL,NULL,NULL,'LIMITED') A 
INNER JOIN sys.indexes B ON A.[object_id] = B.[object_id] and A.index_id = B.index_id  
INNER JOIN sys.objects O ON O.[object_id] = B.[object_id]  
 where B.[name] is not null and B.is_primary_key = 0 AND B.is_unique_constraint = 0 and A.[avg_fragmentation_in_percent] >= 5  

--select * from @RebuildIndex

 declare @begin int = 1
 declare @max int
 select @max = Max(IndexId) from @RebuildIndex
 declare @IndexName varchar(100), @TableSchema varchar(50), @TableName varchar(100) , @Fragmentation decimal(18,2)

 while @begin <= @max
 begin

    Select @IndexName = IndexName from @RebuildIndex where IndexId = @begin
    select @TableSchema = TableSchema  from @RebuildIndex where IndexId = @begin
    select @TableName = TableName  from @RebuildIndex where IndexId = @begin 
    select @Fragmentation = Fragmentation  from @RebuildIndex where IndexId = @begin 

    declare @sql nvarchar(max)
    if @Fragmentation < 31
    begin
        set @sql = 'ALTER INDEX ['+@IndexName+'] ON ['+@TableSchema+'].['+@TableName+'] REORGANIZE WITH ( LOB_COMPACTION = ON )'
        print 'Reorganized Index ' + @IndexName + ' for ' + @TableName + ' Fragmentation was ' + convert(nvarchar(18),@Fragmentation)
    end
    else
    begin
        set @sql = (select dbo.GetIndexCreateScript(@IndexName))
        if(@sql is not null)
        begin
            print 'Recreated Index ' + @IndexName + ' for ' + @TableName + ' Fragmentation was ' + convert(nvarchar(18),@Fragmentation)
        end 
        else
        begin
            set @sql = 'ALTER INDEX ['+@IndexName+'] ON ['+@TableSchema+'].['+@TableName+'] REBUILD PARTITION = ALL WITH (ONLINE = ON)'
            print 'Rebuilded Index ' + @IndexName + ' for ' + @TableName + ' Fragmentation was ' + convert(nvarchar(18),@Fragmentation)
        end
    end

    execute(@sql)

    set @begin = @begin+1

end 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-03T17:52:09.930

我的两分钱......此方法遵循技术网上概述的规范：[http ://technet.microsoft.com/en-us/library/ms189858(v=sql.105).aspx](http://technet.microsoft.com/en-us/library/ms189858(v=sql.105).aspx)

```
USE [MyDbName]
GO

SET ANSI_NULLS OFF
GO

SET QUOTED_IDENTIFIER OFF
GO

CREATE PROCEDURE [maintenance].[IndexFragmentationCleanup]
AS
DECLARE @reIndexRequest VARCHAR(1000)

DECLARE reIndexList CURSOR
FOR
SELECT INDEX_PROCESS
FROM (
    SELECT CASE 
            WHEN avg_fragmentation_in_percent BETWEEN 5
                    AND 30
                THEN 'ALTER INDEX [' + i.NAME + '] ON [' + t.NAME + '] REORGANIZE;'
            WHEN avg_fragmentation_in_percent > 30
                THEN 'ALTER INDEX [' + i.NAME + '] ON [' + t.NAME + '] REBUILD with(ONLINE=ON);'
            END AS INDEX_PROCESS
        ,avg_fragmentation_in_percent
        ,t.NAME
    FROM sys.dm_db_index_physical_stats(NULL, NULL, NULL, NULL, NULL) AS a
    INNER JOIN sys.indexes AS i ON a.object_id = i.object_id
        AND a.index_id = i.index_id
    INNER JOIN sys.tables t ON t.object_id = i.object_id
    WHERE i.NAME IS NOT NULL
    ) PROCESS
WHERE PROCESS.INDEX_PROCESS IS NOT NULL
ORDER BY avg_fragmentation_in_percent DESC

OPEN reIndexList

FETCH NEXT
FROM reIndexList
INTO @reIndexRequest

WHILE @@FETCH_STATUS = 0
BEGIN
    BEGIN TRY

        PRINT @reIndexRequest;

        EXEC (@reIndexRequest);

    END TRY

    BEGIN CATCH
        DECLARE @ErrorMessage NVARCHAR(4000);
        DECLARE @ErrorSeverity INT;
        DECLARE @ErrorState INT;

        SELECT @ErrorMessage = 'UNABLE TO CLEAN UP INDEX WITH: ' + @reIndexRequest + ': MESSAGE GIVEN: ' + ERROR_MESSAGE()
            ,@ErrorSeverity = 9 
            ,@ErrorState = ERROR_STATE();

    END CATCH;

    FETCH NEXT
    FROM reIndexList
    INTO @reIndexRequest
END

CLOSE reIndexList;

DEALLOCATE reIndexList;

RETURN 0

GO 
```

# c# - 如何通过代码生成 WPF 控件

> ID：7586
> 
> 赞同：8
> 
> 时间：2008-08-11T07:26:46.903
> 
> 标签：c#, .net, wpf, xaml

我试图了解 XAML，并认为我会尝试编写一些代码。

尝试添加具有 6 x 6 列定义的网格，然后将文本块添加到其中一个网格单元中。我似乎无法引用我想要的单元格。网格上没有我也可以添加文本块的方法。只有 grid.children.add(object)，没有 Cell 定义。

XAML：

```
<Page x:Class="WPF_Tester.Page1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Page1"
    Loaded="Page_Loaded">

</Page> 
```

C＃：

```
private void Page_Loaded(object sender, RoutedEventArgs e)
{
    //create the structure
    Grid g = new Grid();
    g.ShowGridLines = true;
    g.Visibility = Visibility.Visible;

    //add columns
    for (int i = 0; i < 6; ++i)
    {
        ColumnDefinition cd = new ColumnDefinition();
        cd.Name = "Column" + i.ToString();

        g.ColumnDefinitions.Add(cd);
    }
    //add rows
    for (int i = 0; i < 6; ++i)
    {
        RowDefinition rd = new RowDefinition();
        rd.Name = "Row" + i.ToString();

        g.RowDefinitions.Add(rd);
    }
    TextBlock tb = new TextBlock();
    tb.Text = "Hello World";

    g.Children.Add(tb);
} 
```

**更新**

这是令人毛骨悚然的一点：

*   在 XP 上使用 VS2008 Pro

*   WPFbrowser 项目模板（3.5 验证）

我没有得到自动完成的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-11T07:37:24.713

WPF 使用了一种叫做[附加属性](http://msdn.microsoft.com/en-us/library/ms749011.aspx)的时髦东西。因此，在您的 XAML 中，您可能会这样写：

```
<TextBlock Grid.Row="0" Grid.Column="0" /> 
```

这将有效地将 TextBlock 移动到网格的单元格 (0,0) 中。

在代码中，这看起来有点奇怪。我相信它会是这样的：

```
g.Children.Add(tb);
Grid.SetRow(tb, 0);
Grid.SetColumn(tb, 0); 
```

看看上面的链接 - 附加属性使 XAML 中的事情变得非常容易，也许以牺牲直观的代码为代价。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T07:39:44.490

单元格位置是一个附加属性 - 该值属于 TextBlock 而不是 Grid。但是，由于属性本身属于 Grid，因此您需要使用属性定义字段或提供的静态函数。

```
TextBlock tb = new TextBlock();
//
// Locate tb in the second row, third column.
// Row and column indices are zero-indexed, so this
// equates to row 1, column 2.
//
Grid.SetRow(tb, 1);
Grid.SetColumn(tb, 2); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T07:39:52.757

使用 Grid 类的附加属性。

在 C# 中：

```
Grid.SetRow( cell, rownumber )
```

在 XAML 中：

```
<TextBlock Grid.Row="1" />
```

另外，如果您不使用动态网格，我建议您使用 XAML 标记语言。我知道，它有一个学习曲线，但是一旦你掌握了它，它就会容易得多，特别是如果你要使用 ControlTemplates 和 DataTemplates！;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-01T18:18:54.957

这是一些示例

```
Grid grid = new Grid();

// Set the column and row definitions
grid.ColumnDefinitions.Add(new ColumnDefinition() {
     Width = new GridLength(1, GridUnitType.Auto) });
grid.ColumnDefinitions.Add(new ColumnDefinition() {
     Width = new GridLength(1, GridUnitType.Star) });
grid.RowDefinitions.Add(new RowDefinition() {
     Height = new GridLength(1, GridUnitType.Auto) });
grid.RowDefinitions.Add(new RowDefinition() {
     Height = new GridLength(1, GridUnitType.Auto) });

// Row 0
TextBlock tbFirstNameLabel = new TextBlock() { Text = "First Name: "};
TextBlock tbFirstName = new TextBlock() { Text = "John"};

grid.Children.Add(tbFirstNameLabel ); // Add to the grid
Grid.SetRow(tbFirstNameLabel , 0); // Specify row for previous grid addition
Grid.SetColumn(tbFirstNameLabel , 0); // Specity column for previous grid addition

grid.Children.Add(tbFirstName ); // Add to the grid
Grid.SetRow(tbFirstName , 0);  // Specify row for previous grid addition
Grid.SetColumn(tbFirstName , 1); // Specity column for previous grid addition

// Row 1
TextBlock tbLastNameLabel = new TextBlock() { Text = "Last Name: "};
TextBlock tbLastName = new TextBlock() { Text = "Smith"};

grid.Children.Add(tbLastNameLabel ); // Add to the grid
Grid.SetRow(tbLastNameLabel , 1);  // Specify row for previous grid addition
Grid.SetColumn(tbLastNameLabel , 0); // Specity column for previous grid addition

grid.Children.Add(tbLastName ); // Add to the grid
Grid.SetRow(tbLastName , 1);  // Specify row for previous grid addition
Grid.SetColumn(tbLastName , 1); // Specity column for previous grid addition 
```

# javascript - 我可以使用 JavaScript 创建客户端电子邮件吗？

> ID：7592
> 
> 赞同：19
> 
> 时间：2008-08-11T07:39:51.433
> 
> 标签：javascript, email

我想创建一个客户端邮件创建者网页。我知道在 html 表单中使用 mailto 操作的问题（不是标准的，客户端上没有设置默认邮件应用程序）。但是网页不是很重要，他们也不是很在意。

mailto 操作创建的邮件具有以下语法：

> 主题：未定义的主题
> 主体：
> 
> 参数 1=值 1
> 参数 2=值 2
> 。
> .
> .
> 参数=值

我可以像这样使用 JavaScript 来格式化邮件吗？

> 主题：XXXXX
> 
> 正文：Value1；Value2；Value3...ValueN

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-08-11T09:45:17.873

我们在项目中使用的是一个弹出窗口，它打开一个 mailto: 链接，这是我们发现在默认邮件客户端中撰写邮件的唯一方法，该客户端适用于所有邮件客户端（至少我们所有的客户端都使用过）。

```
var addresses = "";//between the speech mark goes the receptient. Seperate addresses with a ;
var body = ""//write the message text between the speech marks or put a variable in the place of the speech marks
var subject = ""//between the speech marks goes the subject of the message
var href = "mailto:" + addresses + "?"
         + "subject=" + subject + "&"
         + "body=" + body;
var wndMail;
wndMail = window.open(href, "_blank", "scrollbars=yes,resizable=yes,width=10,height=10");
if(wndMail)
{
    wndMail.close();    
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-11T08:29:27.650

通过浏览器发送邮件时，您或多或少只有两种选择。

1.  制作一个接受用户输入的页面，并允许他们通过您的网络服务器发送邮件。为此，您需要某种服务器端脚本。
2.  使用 mailto: 链接触发打开用户注册的邮件客户端。这有你提到的明显缺陷，并且不太灵活。虽然它需要更少的工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-11T08:48:39.017

仅使用 javascript，这是**不可能的**。
Javascript 不打算做这样的事情，并且在它可以与除了它所在的网络浏览器之外的任何东西交互的方式上被严重削弱（有充分的理由！）。

想一想：垃圾邮件发送者使用客户端 javascript 编写网站，该网站会自动向数千个随机电子邮件地址发送邮件。如果人们应该去那个站点，他们都将参与分布式群发邮件骗局，使用他们自己的计算机......不需要感染或用户交互！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-01-30T11:18:33.853

您可以创建一个 mailto-link 并使用 javascript 触发它：

```
 var mail = "mailto:buddy@mail.com?subject=New Mail&body=Mail text body";  
  var mlink = document.createElement('a');
  mlink.setAttribute('href', mail);
  mlink.click(); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-08-11T07:50:53.953

您是否有理由不能将数据发送到处理发送邮件的页面？以大多数语言发送电子邮件非常容易，因此除非有充分的理由将其推送到客户端，否则我会推荐该路线。

# java - 我应该如何构建一个 Java 应用程序，我应该把我的类放在哪里？

> ID：7596
> 
> 赞同：42
> 
> 时间：2008-08-11T07:45:20.050
> 
> 标签：java, architecture

首先，我知道如何构建一个 Java 应用程序。但我一直很困惑我的课应该放在哪里。有人支持以严格的面向领域的方式组织包，其他人则按层分开。

我自己一直有问题

*   命名，
*   放置

所以，

1.  您将域特定常量放在哪里（以及此类的最佳名称是什么）？
2.  您将基础设施和特定领域的东西的类放在哪里（例如，我有一个 FileStorageStrategy 类，它将文件存储在数据库中，或者存储在数据库中）？
3.  在哪里放置异常？
4.  有什么标准可以参考吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-08-16T19:06:10.267

我真的很喜欢 Maven 的[标准目录布局](http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html "小号")。

对我来说，其中一个关键想法是拥有两个源代码根——一个用于生产代码，一个用于测试代码，如下所示：

```
MyProject/src/main/java/com/acme/Widget.java
MyProject/src/test/java/com/acme/WidgetTest.java 
```

（这里， src/main/java 和 src/test/java 都是源根）。

好处：

*   您的测试对您的测试类具有包（或“默认”）级别的访问权限。
*   通过将 src/test/java 作为源根目录，您可以轻松地将生产源代码打包到 JAR 中。

关于类放置和包的一条经验法则：

一般来说，结构良好的项目将没有[循环依赖](http://en.wikipedia.org/wiki/Circular_dependency)。了解它们什么时候不好（以及什么时候不好[）](http://beust.com/weblog/archives/000208.html)，并考虑使用[JDepend](http://www.google.ca/search?q=JDepend&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)或[SonarJ](http://www.hello2morrow.com/products/sonargraph)之类的工具来帮助您消除它们。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-08-12T08:00:18.707

我非常喜欢有组织的资源，所以我总是创建以下目录结构：

```
/src - for your packages & classes
/test - for unit tests
/docs - for documentation, generated and manually edited
/lib - 3rd party libraries
/etc - unrelated stuff
/bin (or /classes) - compiled classes, output of your compile
/dist - for distribution packages, hopefully auto generated by a build system 
```

在 /src 中，我使用默认的 Java 模式：以您的域 (org.yourdomain.yourprojectname) 开头的包名称和反映您使用该类创建的 OOP 方面的类名称（请参阅其他评论者）。*util*、*model*、*view*、*events*等常见包名称也很有用。

我倾向于将特定主题的常量放在自己的类中，例如*SessionConstants*或*ServiceConstants*在域类的同一个包中。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-15T20:43:40.430

在我工作的地方，我们使用的是 Maven 2，我们的项目有一个非常好的原型。目标是获得良好的关注点分离，因此我们定义了一个使用多个模块的项目结构（每个应用程序“层”一个）： - 通用：其他层使用的通用代码（例如，i18n） - 实体：域实体 - 存储库：此模块包含 daos 接口和实现 - services-intf：服务的接口（例如，UserService，...） - services-impl：服务的实现（例如，UserServiceImpl） - Web：关于Web 内容（例如，css、jsps、jsf 页面，...） - ws：Web 服务

每个模块都有自己的依赖项（例如，存储库可能有 jpa），有些是项目范围的（因此它们属于公共模块）。不同项目模块之间的依赖关系清楚地将事物分开（例如，Web 层依赖于服务层但不知道存储库层）。

每个模块都有自己的基础包，例如如果应用程序包是“com.foo.bar”，那么我们有：

```
com.foo.bar.common
com.foo.bar.entities
com.foo.bar.repositories
com.foo.bar.services
com.foo.bar.services.impl
... 
```

每个模块都尊重标准的 Maven 项目结构：

```
 src\
   ..main\java
     ...\resources
   ..test\java
     ...\resources 
```

给定层的单元测试很容易在 \src\test 下找到它们的位置...所有特定于域的东西都放在实体模块中。现在像 FileStorageStrategy 这样的东西应该进入存储库模块，因为我们不需要确切地知道实现是什么。在服务层，我们只知道存储库接口，并不关心具体的实现是什么（关注点分离）。

这种方法有多个优点：

*   清晰的关注点分离
*   每个模块都可以打包为 jar（或者 web 模块中的 war），因此可以更轻松地重用代码（例如，我们可以将模块安装在 maven 存储库中并在另一个项目中重用）
*   项目各部分的最大独立性

我知道这并不能回答你所有的问题，但我认为这可以让你走上正确的道路，并且可能对其他人有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-11T08:00:58.830

类名应该始终是描述性的和不言自明的。如果您的类有多个责任域，那么它们可能应该被重构。

对于您的包裹也是如此。它们应按职责范围分组。每个域都有它自己的例外。

一般来说，直到它变得压倒性和臃肿的程度之前不要出汗。然后坐下来不要编码，只需重构类，定期编译以确保一切正常。然后像以前一样继续。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-11T08:24:02.950

使用包将相关功能组合在一起。

通常你的包树的顶部是你的域名倒转（`com.domain.subdomain`）以保证唯一性，然后通常会有你的应用程序的包。然后按相关区域细分，所以你`FileStorageStrategy`可能会进入，比如说，，`com.domain.subdomain.myapp.storage`然后可能会有特定的实现/子类/在`com.domain.subdomain.myapp.storage.file`and中`com.domain.subdomain.myapp.storage.database`。这些名称可能会很长，但`import`将它们都放在文件的顶部，IDE 也可以帮助管理它。

异常通常与抛出它们的类在同一个包中，所以如果你有，比如说，`FileStorageException`它会和`FileStorageStrategy`. 同样，定义常量的接口将在同一个包中。

实际上没有任何标准，只需使用常识，如果一切都变得太混乱，请重构！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-03T12:21:37.760

我发现对单元测试非常有帮助的一件事是拥有一个 myApp/src/ 和 myApp/test_src/ 目录。这样，我可以将单元测试与它们测试的类放在相同的包中，而且在准备生产安装时可以轻松排除测试用例。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-04T13:40:54.440

简短的回答：根据模块绘制您的系统架构，并排绘制，每个模块垂直切成层（例如视图、模型、持久性）。然后使用类似*com.mycompany.myapp.somemodule.somelayer*的结构，例如*com.mycompany.myapp.client.view*或*com.mycompany.myapp.server.model*。

[在模块化编程](http://en.wikipedia.org/wiki/Modular*programming)的老式计算机科学意义上，为应用程序*模块*使用顶层包应该是显而易见的。然而，在我参与的大多数项目中，我们最终忘记了这样做，并最终得到一堆没有顶层结构的包。这种反模式通常将自己显示为诸如“侦听器”或“操作”之类的包，这些包将原本不相关的类分组，因为它们碰巧实现了相同的接口。

在模块或小型应用程序中，为应用程序层使用包。可能的软件包包括以下内容，具体取决于架构：

*   *com.mycompany.myapp.view*
*   *com.mycompany.myapp.model*
*   *com.mycompany.myapp.services*
*   *com.mycompany.myapp.rules*
*   *com.mycompany.myapp.persistence*（或数据访问层的“dao”）
*   *com.mycompany.myapp.util*（注意这个被当作'misc'使用）

在这些层的每一层中，如果有很多类，按类型对类进行分组是很自然的。这里一个常见的反模式是不必要地引入过多的包和子包的级别，使得每个包中只有几个类。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-12T03:36:32.123

我认为保持简单，不要过度思考。不要过度抽象和分层。只要保持整洁，随着它的增长，重构它是微不足道的。IDE 的最佳功能之一是重构，所以为什么不利用它来节省脑力来解决与应用程序相关的问题，而不是像代码组织这样的元问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-11T23:25:44.503

我过去做过的一件事——如果我要扩展课程，我会尝试遵循他们的约定。例如，在使用 Spring Framework 时，我会将 MVC 控制器类放在一个名为 com.mydomain.myapp.web.servlet.mvc 的包中。如果我不扩展某些东西，我只会选择最简单的东西。com.mydomain.domain 用于域对象（尽管如果你有大量的域对象，这个包可能会有点笨拙）。对于特定领域的常量，我实际上将它们作为公共常量放在最相关的类中。例如，如果我有一个“Member”类并且有一个最大成员名称长度常量，我将它放在 Member 类中。一些商店制作了一个单独的常量类，但我看不到将不相关的数字和字符串集中到一个类中的价值。一世' 已经看到其他一些商店试图通过创建单独的常量类来解决这个问题，但这似乎是在浪费时间，结果也太混乱了。使用这种设置，一个有多个开发人员的大型项目将在各处复制常量。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-12T01:28:23.287

我喜欢将我的课程分解成相互关联的包。

例如： 用于数据库相关调用的**模型**

**查看**处理您所见内容的课程

**控制**核心功能类

**使用**任何杂项。使用的类（通常是静态函数）

等等

# web-services - Where can I find some good WS-Security introductions and tutorials?

> ID：7603
> 
> 赞同：5
> 
> 时间：2008-08-11T08:10:27.423
> 
> 标签：web-services, ws-security

Can anyone point me to some decent introductions to WS-Security?

I'm looking for tutorials or something that provide a fairly gentle introduction to the subject, though I don't mind if it assumes basic knowledge of web services and SOAP. Most of the stuff I've seen so far is very technical and you need a lot of complex, detailed background knowledge to understand it properly.

We have to implement a web service in PHP and one or more clients in .NET, so resources covering both would be much appreciated.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-11T08:20:01.007

I think the best introduction to the (any) subject are some good examples.
[This article](http://www.codeproject.com/KB/webservices/WS-Security.aspx) at codeProject gives a fairly easy to follow guide trough web service security for a .NET application.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T16:07:21.377

几个月前，我不得不给自己上 WS-Security 速成课程，这里有一些我觉得很有帮助的链接：

[http://www.ibm.com/developerworks/webservices/library/ws-security.html](http://www.ibm.com/developerworks/webservices/library/ws-security.html)

[http://www.devx.com/security/Article/15634](http://www.devx.com/security/Article/15634)

[http://www.devx.com/Java/Article/28816](http://www.devx.com/Java/Article/28816)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T03:22:13.120

查看[Kirk Evans 的博客](http://blogs.msdn.com/kaevans/archive/2006/01/29/518931.aspx)，因为它处理 .NET Framework 2.0+ 而不是[Sven](https://stackoverflow.com/users/46/sven)链接的旧 .NET Framework 1.0 。

Evans 博客上的实现向后兼容运行 .NET Frameowrk 1.0 的客户端。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-02T06:55:20.790

[您可以在WSO2 Online Library](http://wso2.org/library)中找到一些关于 WS-Security 和[Apache Rampart](http://ws.apache.org/rampart/)（开源 WS-Security 实现）的好文章。

[WSO2 WSF/PHP](http://wso2.org/downloads/wsf/php)是一个 PHP Web 服务扩展，它支持 WS-Security 并且还与 .NET Web 服务/客户端无缝互操作。

# c++ - Testing a function that throws on failure

> ID：7614
> 
> 赞同：1
> 
> 时间：2008-08-11T08:36:39.460
> 
> 标签：c++, unit-testing, tdd

What is the best way of testing a function that throws on failure? Or testing a function that is fairly immune to failure?

For instance; I have a `I/O Completion Port` class that throws in the constructor if it can't initialise the port correctly. This uses the `Win32` function of `CreateIoCompletionPort` in the initialiser list. If the handle isn't set correctly - a non-null value - then the constructor will throw an exception. I have never seen this function fail.

I am pretty certain that this (and other functions like it in my code) if they fail will behave correctly, the code is 50 lines long including white-space, so my questions are

a) is it worth testing that it will throw
b) and if it is worth testing, how to?
c) should simple wrapper classes as these be unit-tested?

For b) I thought about overriding `CreateIoCompletionPort` and passing the values through. In the unit test override it and cause it to return 0 when a certain value is passed in. However since this is used in the constructor then this needs to be static. Does this seem valid or not?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-11T09:30:32.643

If you are doing this in .NET, there is an ExpectedException attribute that you can add to your test:

```
[Test, ExpectedException(typeof(SpecificException), "Exception's specific message")]
public void TestWhichHasException()
{
    CallMethodThatThrowsSpecificException();
} 
```

Test will pass if the exception of that type and with the specified message is thrown. The attribute has other overloads including having InnerExceptions, etc.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T08:57:26.097

It is definitely worthwhile to test failure conditions, both that your class properly throws an exception when you want it to and that exceptions are handled properly in the class.

This can easily be done if you are acting on an object passed in to the constructor... just pass in a mock. If not, I tend to prefer to have the functionality moved to a protected method, and override the protected method to evoke my failure case. I will use Java as an example, but it should be easy enough to port the ideas to a C# case:

```
public class MyClass {
    public MyClass() throws MyClassException {
        // Whatever, including a call to invokeCreateIoCompletionPort
    }

    protected int invokeCreateIoCompletionPort(String str, int i) {
        return StaticClass.createIoCompletionPort(str, i);
    }
}

public class MyTest {
    public void myTest() {
        try {
            new MyClass();
            fail("MyClassException was not thrown!");
        } catch (MyClassException e) {
        }
    }

    private static class MyClassWrapper extends MyClass {
        @Override
        protected int invokeCreateIoCompletionPort(String str, int i) {
            throw new ExpectedException();
        }
    }
} 
```

As you can see, it is pretty easy to test whether an exception is being thrown by the constructor or method you are testing, and it is also pretty easy to inject an exception from an external class that can throw an exception. Sorry I'm not using your actual method, I just used the name to illustrate how it sounded like you are using it, and how I would test the cases it sounded you wanted to test.

Basically, any API details you expose can usually be tested, and if you want to KNOW that exceptional cases work as they should, you probably will want to test it.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T08:57:54.270

You should consider writing your code in such a way that you can mock your I/O completion port. Make an interface/abstract class that exposes the methods you need on the I/O object, and write and test implementation that does things like it's supposed to (and an option to simulate failure perhaps).

AFAIK it's a common practice to mock external resources when unit testing, to minimize dependencies.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-18T13:00:41.670

对我来说听起来像 C++。您需要一个接缝来模拟 Win32 函数。例如，在您的类中，您将创建一个受保护的方法`CreateIoCompletionPort()`，该方法调用`::CreateIoCompletionPort()`并为您的测试创建一个从您的 I/O Completion Port 类派生的类，并覆盖`CreateIoCompletionPort()`除了 return 之外什么都不做`NULL`。您的生产类的行为仍与设计时一样，但您现在可以模拟`CreateIoCompletionPort()`函数中的故障。

这项技术来自 Michael Feathers 的书“有效地使用遗留代码”。

# c - C中的移位运算符（<<，>>）是算术还是逻辑？

> ID：7622
> 
> 赞同：157
> 
> 时间：2008-08-11T08:55:13.277
> 
> 标签：c, binary, bit-manipulation, bit-shift

在 C 中，移位运算符 ( `<<`, `>>`) 是算术还是逻辑？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-08-11T09:16:34.607

左移时，算术移位和逻辑移位没有区别。右移时，移位的类型取决于要移位的值的类型。

（作为不熟悉差异的读者的背景，“逻辑”右移 1 位会将所有位向右移动，并用 0 填充最左边的位。“算术”移位将原始值留在最左边的位. 处理负数时，差异变得很重要。）

当移位无符号值时，C 中的 >> 运算符是逻辑移位。移位有符号值时，>> 运算符是算术移位。

例如，假设一台 32 位机器：

```
signed int x1 = 5;
assert((x1 >> 1) == 2);
signed int x2 = -5;
assert((x2 >> 1) == -3);
unsigned int x3 = (unsigned int)-5;
assert((x3 >> 1) == 0x7FFFFFFD); 
```

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-08-11T09:18:29.533

根据[K&R 第 2 版](https://rads.stackoverflow.com/amzn/click/com/0131103628)，有符号值的右移结果取决于实现。

[Wikipedia](http://en.wikipedia.org/wiki/Arithmetic_shift)说 C/C++“通常”对有符号值实现算术移位。

基本上你需要测试你的编译器或者不依赖它。我对当前 MS C++ 编译器的 VS2008 帮助说他们的编译器进行了算术移位。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2014-03-29T18:01:30.280

# TL;博士

考虑`i`和`n`分别是移位运算符的左操作数和右操作数；的类型`i`，在整数提升之后，是`T`。假设`n`在`[0, sizeof(i) * CHAR_BIT)`- 否则未定义 - 我们有这些情况：

```
| Direction  |   Type   | Value (i) | Result                   |
| ---------- | -------- | --------- | ------------------------ |
| Right (>>) | unsigned |    ≥ 0    | −∞ ← (i ÷ 2ⁿ)            |
| Right      | signed   |    ≥ 0    | −∞ ← (i ÷ 2ⁿ)            |
| Right      | signed   |    < 0    | Implementation-defined†  |
| Left  (<<) | unsigned |    ≥ 0    | (i * 2ⁿ) % (T_MAX + 1)   |
| Left       | signed   |    ≥ 0    | (i * 2ⁿ) ‡               |
| Left       | signed   |    < 0    | Undefined                | 
```

^(† 大多数编译器将其实现为算术移位)
^(‡ 如果值溢出结果类型 T 则未定义；我的提升类型)

* * *

# 换档

首先是从数学角度来看逻辑和算术移位之间的区别，无需担心数据类型大小。逻辑移位总是用零填充丢弃的位，而算术移位仅在左移时用零填充，但对于右移，它复制 MSB 从而保留操作数的符号（假设负值[的二进制补码编码）。](http://en.wikipedia.org/wiki/Two%27s_complement)

换句话说，逻辑移位将移位的操作数视为只是一个位流并移动它们，而不用担心结果值的符号。算术移位将其视为（有符号）数字，并在进行移位时保留符号。

一个数 X 乘以 n 的算术左移相当于将 X 乘以 2 ^n，因此相当于逻辑左移；逻辑转换也会给出相同的结果，因为 MSB 无论如何都会落到最后，并且没有什么可保留的。

仅当 X 为非负数时，数字 X 乘以 n 的算术右移等效于 X 除以 2 ^(n ！)整数除法只不过是数学除法并向 0 ( [trunc )](http://en.cppreference.com/w/c/numeric/math/trunc)[舍](http://en.wikipedia.org/wiki/Rounding#Rounding_to_integer)入。

对于由二进制补码编码表示的负数，右移 n 位具有数学上将其除以 2 ^n并向 -∞ ( [floor](http://en.cppreference.com/w/c/numeric/math/floor) ) 舍入的效果；因此，对于非负值和负值，右移是不同的。

> 对于 X ≥ 0，X >> n = X / 2 ^n = trunc(X ÷ 2 ^n )
> 
> 对于 X < 0, X >> n = floor(X ÷ 2 ^n )

其中`÷`是数学除法，`/`是整数除法。让我们看一个例子：

> 37) [10] = 100101) [2]
> 
> 37 ÷ 2 = 18.5
> 
> 37 / 2 = 18 (18.5 向 0 舍入) = 10010) [2] [算术右移的结果]
> 
> -37) [10] = 11011011) [2]（考虑二进制补码，8 位表示）
> 
> -37 ÷ 2 = -18.5
> 
> -37 / 2 = -18（向 0 舍入 18.5）= 11101110) [2] [不是算术右移的结果]
> 
> -37 >> 1 = -19（向 -∞ 舍入 18.5）= 11101101）[2] [算术右移的结果]

正如[Guy Steele 所指出的](http://dspace.mit.edu/bitstream/handle/1721.1/6090/AIM-378.pdf)，这种差异导致[了不止一个编译器出现错误](http://en.wikipedia.org/wiki/Arithmetic_shift)。这里非负（数学）可以映射为无符号和有符号的非负值（C）；两者都被视为相同，并且通过整数除法将它们右移。

所以逻辑和算术在左移中是等价的，对于非负值在右移中是等价的；它们不同之处在于负值的右移。

## 操作数和结果类型

*标准 C99 §6.5.7*：

> 每个操作数都应具有整数类型。
> 
> 对每个操作数执行整数提升。结果的类型是提升的左操作数的类型。如果右操作数的值为负数或大于或等于提升的左操作数的宽度，则行为未定义。

```
short E1 = 1, E2 = 3;
int R = E1 << E2; 
```

在上面的代码片段中，两个操作数都变成了`int`（由于整数提升）；如果`E2`为负数，`E2 ≥ sizeof(int) * CHAR_BIT`则操作未定义。这是因为移位多于可用位肯定会溢出。已`R`声明为`short`，`int`移位操作的结果将隐式转换为`short`; 缩小转换，如果值在目标类型中不可表示，则可能导致实现定义的行为。

# 左移

> E1 << E2 的结果是 E1 左移 E2 位位置；空出的位用零填充。如果 E1 具有无符号类型，则结果的值是 E1×2 ^(E2)，比结果类型中可表示的最大值多模一减少。如果 E1 有带符号类型且非负值，并且 E1×2 ^(E2)在结果类型中是可表示的，那么这就是结果值；否则，行为未定义。

由于两者的左移相同，因此空出的位只需用零填充。然后它指出，对于无符号和有符号类型，它都是算术移位。我将其解释为算术移位，因为逻辑移位不关心位表示的值，它只是将其视为位流；^(但是该标准不是根据位来讨论的，而是根据 E1 与 2 E2)的乘积所获得的值来定义它。

**这里需要注意的是，对于有符号类型，该值应该是非负的，并且结果值应该可以在结果类型中表示。否则操作是未定义的。**结果类型将是应用积分提升后的 E1 类型，而不是目标（将保存结果的变量）类型。结果值被隐式转换为目标类型；如果它在该类型中不可表示，则转换是实现定义的（C99 §6.3.1.3/3）。

**如果 E1 是带负值的有符号类型，则左移行为未定义。**这是一个容易被忽视的未定义行为的简单途径。

# 右移

> E1 >> E2 的结果是 E1 右移 E2 位位置。如果 E1 具有无符号类型或 E1 具有带符号类型和非负值，则结果的值是 E1/2 ^(E2)的商的整数部分。如果 E1 具有带符号类型和负值，则结果值是实现定义的。

无符号和有符号非负值的右移非常简单；空位用零填充。**对于有符号负值，右移的结果是实现定义的。**也就是说，像 GCC 和[Visual C++](http://en.wikipedia.org/wiki/Visual_C%2B%2B#32-bit_versions)这样的大多数实现都通过保留符号位将右移实现为算术移位。

# 结论

`>>>`与 Java 不同，Java除了通常的`>>`and之外还有一个用于逻辑移位的特殊运算符`<<`，C 和 C++ 仅具有算术移位，其中一些区域未定义和实现定义。我认为它们是算术的原因是由于标准措辞数学上的操作，而不是将移位的操作数视为位流；这也许就是为什么它将这些区域保留为未定义/实现定义而不是仅仅将所有情况定义为逻辑转变的原因。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-08-13T17:20:06.173

就您获得的转变类型而言，重要的是您正在转变的价值的类型。一个典型的错误来源是当您将文字转换为掩码位时。例如，如果您想删除无符号整数的最左侧位，则可以尝试将其作为掩码：

```
~0 >> 1 
```

不幸的是，这会给你带来麻烦，因为掩码的所有位都会被设置，因为被移位的值 (~0) 是有符号的，因此会执行算术移位。相反，您希望通过将值显式声明为无符号来强制进行逻辑转换，即通过执行以下操作：

```
~0U >> 1; 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2010-03-17T16:13:08.063

以下是保证 C 中 int 的逻辑右移和算术右移的函数：

```
int logicalRightShift(int x, int n) {
    return (unsigned)x >> n;
}
int arithmeticRightShift(int x, int n) {
    if (x < 0 && n > 0)
        return x >> n | ~(~0U >> n);
    else
        return x >> n;
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-09-06T06:09:47.267

当你这样做时 - 左移 1 你乘以 2 - 右移 1 你除以 2

```
 x = 5
 x >> 1
 x = 2 ( x=5/2)

 x = 5
 x << 1
 x = 10 (x=5*2) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-11T09:18:52.247

好吧，我[在维基百科上查了一下](http://en.wikipedia.org/wiki/Logical_shift)，他们有这样的说法：

> 然而，C 只有一个右移运算符 >>。许多 C 编译器根据要移位的整数类型来选择执行哪个右移；通常有符号整数使用算术移位进行移位，无符号整数使用逻辑移位进行移位。

所以听起来这取决于你的编译器。同样在那篇文章中，请注意左移对于算术和逻辑是相同的。我建议在边界情况下使用一些有符号和无符号数字（当然是高位集）做一个简单的测试，看看你的编译器上的结果是什么。我还建议避免依赖它是一个或另一个，因为 C 似乎没有标准，至少如果它是合理的并且可以避免这种依赖。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-14T00:15:02.687

[gcc](/questions/tagged/gcc "显示标记为“gcc”的问题")通常对无符号变量使用逻辑移位，对有符号变量使用左移。算术右移是真正重要的，因为它将符号扩展变量。

[gcc](/questions/tagged/gcc "显示标记为“gcc”的问题")将在适用时使用它，因为其他编译器可能会这样做。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-03-30T11:04:44.570

左移`<<`

这在某种程度上很容易，并且每当您使用移位运算符时，它始终是按位运算，因此我们不能将它与双精度和浮点运算一起使用。每当我们左移一位零时，它总是被添加到最低有效位 ( `LSB`)。

但是在右移中，`>>`我们必须遵循一个附加规则，该规则称为“符号位复制”。“符号位复制”的含义是，如果最高有效位`MSB`（`MSB`如果前一位为 1，则该位为零，然后在移位后再次为 1。此规则不适用于左移。

右移最重要的例子，如果你将任何负数右移，然后在一些移位之后，值最终达到零，然后在此之后，如果将这个 -1 移位任意次数，值将保持不变。请检查。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-02-09T14:44:45.137

海合会

1.  for -ve -> 算术移位

2.  对于 +ve -> 逻辑移位

* * *

## 回答 #11

> 赞同：-9
> 
> 时间：2013-11-14T12:48:39.437

根据许多[c](/questions/tagged/c "显示标记为“c”的问题")编译器：

1.  `<<`是算术左移或按位左移。
2.  `>>`是算术右移或按位右移。

# vb.net - VB.NET 私 有字段的命名约定

> ID：7642
> 
> 赞同：23
> 
> 时间：2008-08-11T09:41:11.373
> 
> 标签：vb.net, convention

在 VB.NET 中命名私有字段是否有官方约定？例如，如果我有一个名为“Foo”的属性，我通常将私有字段称为“_Foo”。这似乎在[官方指南](http://msdn.microsoft.com/en-us/library/ms229012.aspx)中不受欢迎：

“不要为字段名称使用前缀。例如，不要使用 g_ 或 s_ 来区分静态字段和非静态字段。”

在 C# 中，您可以调用私有字段“foo”、属性“Foo”，并在构造函数中将私有字段称为“this.foo”。由于 VB.NET 不区分大小写，因此您不能这样做 - 有什么建议吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-11T09:45:27.967

我仍然在 VB 中将 _ 前缀用于私有字段，因此我将 _foo 作为私有字段，将 Foo 作为属性。我也为 c# 以及我编写的几乎所有代码执行此操作。一般来说，我不会太拘泥于“什么是正确的做法”，因为没有真正的“正确”方法（尽管有一些非常糟糕的方法），而是关心始终如一地做这件事。

归根结底，与使用任何“正确”约定相比，保持一致将使您的代码更具可读性和可维护性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-06-10T12:10:12.510

这是个人偏好，尽管有*一些*区别得到了广泛的支持。即使在 C# 中，我也不认为有一种广泛使用的约定。

[杰夫普罗西斯](https://web.archive.org/web/20110727211715/http://wintellect.com/TechnicalBioDetail.aspx?Tech=5)说

> 作为个人喜好的问题，我通常在私有字段前加上下划线 [在 C# 中] ...这种约定在 .NET 框架中使用得非常多，但并未自始至终使用。

来自 。[NET Framework 设计指南](https://rads.stackoverflow.com/amzn/click/com/0321545613)第 2 版第 73 页。

[杰弗里·里希特](https://web.archive.org/web/20130315155154/http://www.wintellect.com/cs/blogs/jeffreyr/default.aspx)说

> 我将所有字段设为私有，并在实例字段前面加上“m_”，在静态字段前面加上“s_”[在 C# 中]

来自 。[NET Framework 设计指南](https://rads.stackoverflow.com/amzn/click/com/0321545613)第 2 版第 47 页。Anthony Moore（[BCL 团队](https://docs.microsoft.com/en-us/archive/blogs/bclteam/a-brief-history-of-datetime-follow-up-anthony-moore)）也认为使用“m_”和“s_”值得考虑，第 48 页。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T09:46:46.480

官方指导方针就是——指导方针。你总是可以绕过他们。话虽如此，我们通常在 C# 和 VB.NET 中为字段添加下划线*前缀*。这种约定很常见（显然，官方指南被忽略了）。

然后可以在没有“me”关键字的情况下引用私有字段（“this”关键字用于 C# :)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-28T18:36:15.347

您链接的设计指南特别声明它们仅适用于静态公共和受保护字段。设计指南主要侧重于设计公共 API；您对私人会员的处理取决于您自己。我不是很肯定，但我相对有信心在编译器检查 CLS 合规性时不会考虑私有成员，因为只有公共/受保护成员才能参与其中（想法是，“如果有人使用的语言不允许 _ 字符尝试使用您的库？”如果成员是私有的，答案是“没什么，用户不必使用这些成员。”但如果成员是公开的，您就有麻烦了。 )

就是说，我要补充一下回声室，并指出无论你做什么，保持一致很重要。我的雇主要求 C# 和 VB 中的私有字段都以 _ 为前缀，因为我们都遵循这个约定，所以很容易使用其他人编写的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-29T20:55:31.463

在 VB.NET 4.0 中，你们中的大多数人可能知道不需要为属性声明显式编写 getter 和 setter，如下所示：

```
Public Property Foo As String
Public Property Foo2 As String 
```

VB 自动创建名为_Foo 和_Foo2 的私有成员变量。似乎微软和 VS 团队已经采用了 _ 约定，所以我认为它没有问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-11T09:48:17.100

我认为没有正式的命名约定，但我看到微软在 Microsoft.VisualBasic dll 中使用 m_ （通过反射器）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-12T15:57:52.753

> 我仍然在 VB 中将 _ 前缀用于私有字段，因此我将 _foo 作为私有字段，将 Foo 作为属性。我也为 c# 以及我编写的几乎所有代码执行此操作。一般来说，我不会太拘泥于“什么是正确的做法”，因为没有真正的“正确”方法（尽管有一些非常糟糕的方法），而是关心始终如一地做这件事。

我没有找到比“_”更好的澄清和一致性。缺点包括：

*   [不符合 CLS](http://msdn.microsoft.com/en-us/library/y9a1wfdd(VS.71).aspx)
*   当 VB 在我的 IDE 上绘制水平线时往往会迷路

我通过在编辑器中关闭这些来绕过这些线路，并尽量不要过多考虑 CLS 合规性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-11T13:05:11.790

我同意@lomaxx，在整个团队中保持一致比拥有*正确*的约定更重要。

不过，这里有几个很好的地方可以获得编码约定的想法和指导：

1.  [Francesco Balena的 Microsoft Visual Basic 和 Visual C# 开发人员实用指南和最佳实践](http://www.dotnet2themax.com/PracticalGuidelines.aspx)是一本很好的书，它解决了许多这些问题。
2.  [IDesign 编码标准](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=0&tabid=1)（用于 C# 和 WCF）
3.  .NET Framework[源代码](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)（在 VS2008 中）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-11T19:00:39.140

我更喜欢对私有字段使用下划线前缀。我使用小写首字母作为方法参数。我遵循为方法使用小写驼峰式参数的准则，我认为这比私有字段的命名更重要，因为它是类 API 的一部分。. 例如

```
Public Class Class1

    Private _foo As String
    Public Property Foo() As String
        Get
            Return _foo
        End Get
        Set(ByVal value As String)
            _foo = value
        End Set
    End Property

    Public Sub New(ByVal foo As String)
        _foo = foo
    End Sub

End Class 
```

使用此模式，您将不会与 C# 或 VB.NET 中的私有字段和构造函数参数有任何命名冲突。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-05T18:11:53.670

我同意最重要的不是一个人使用什么风格，而是它是一致的。

话虽如此，私有字段的新 MS/.NET 样式往往是 _fooVar（下划线后跟驼峰式名称）

# perl - 如何从 Perl 中的数组中删除重复项？

> ID：7651
> 
> 赞同：166
> 
> 时间：2008-08-11T10:04:32.093
> 
> 标签：perl, arrays, unique, duplicates

我在 Perl 中有一个数组：

```
my @my_array = ("one","two","three","two","three"); 
```

如何从数组中删除重复项？

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2008-08-11T10:16:22.770

你可以像[perlfaq4](http://perldoc.perl.org/perlfaq4.html#How-can-I-remove-duplicate-elements-from-a-list-or-array%3f)中演示的那样做这样的事情：

```
sub uniq {
    my %seen;
    grep !$seen{$_}++, @_;
}

my @array = qw(one two three two three);
my @filtered = uniq(@array);

print "@filtered\n"; 
```

输出：

```
one two three 
```

如果要使用模块，请尝试以下`uniq`功能[`List::MoreUtils`](https://metacpan.org/pod/List::MoreUtils)

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2008-08-11T14:27:46.150

Perl 文档附带了一组很好的常见问题解答。您的问题经常被问到：

```
% perldoc -q duplicate 
```

从上述命令的输出中复制并粘贴的答案如下所示：

* * *

在 /usr/local/lib/perl5/5.10.0/pods/perlfaq4.pod 中找到

**如何从列表或数组中删除重复元素？** （由布赖恩·d·福伊提供）

使用哈希。当您想到“唯一”或“重复”这些词时，请考虑“哈希键”。

如果您不关心元素的顺序，您可以创建哈希然后提取键。如何创建散列并不重要：只是使用“键”来获取唯一元素。

```
 my %hash   = map { $_, 1 } @array;
   # or a hash slice: @hash{ @array } = ();
   # or a foreach: $hash{$_} = 1 foreach ( @array );

   my @unique = keys %hash; 
```

如果您想使用模块，请尝试“List::MoreUtils”中的“uniq”功能。在列表上下文中，它返回唯一元素，保留它们在列表中的顺序。在标量上下文中，它返回唯一元素的数量。

```
 use List::MoreUtils qw(uniq);

   my @unique = uniq( 1, 2, 3, 4, 4, 5, 6, 5, 7 ); # 1,2,3,4,5,6,7
   my $unique = uniq( 1, 2, 3, 4, 4, 5, 6, 5, 7 ); # 7 
```

您还可以浏览每个元素并跳过您以前见过的元素。使用哈希来跟踪。循环第一次看到一个元素时，该元素在 %Seen 中没有键。“next”语句创建键并立即使用它的值，即“undef”，因此循环继续“push”并增加该键的值。下一次循环看到同一个元素时，它的键存在于哈希中，并且该键的值为真（因为它不是 0 或“undef”），所以下一次跳过该迭代并且循环转到下一个元素。

```
 my @unique = ();
   my %seen   = ();

   foreach my $elem ( @array )
   {
     next if $seen{ $elem }++;
     push @unique, $elem;
   } 
```

您可以使用 grep 更简短地编写此代码，它执行相同的操作。

```
 my %seen = ();
   my @unique = grep { ! $seen{ $_ }++ } @array; 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-08-31T10:01:18.683

从 CPAN安装[List::MoreUtils](http://search.cpan.org/dist/List-MoreUtils/)

然后在您的代码中：

```
use strict;
use warnings;
use List::MoreUtils qw(uniq);

my @dup_list = qw(1 1 1 2 3 4 4);

my @uniq_list = uniq(@dup_list); 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-08-11T10:18:45.090

我通常的做法是：

```
my %unique = ();
foreach my $item (@myarray)
{
    $unique{$item} ++;
}
my @myuniquearray = keys %unique; 
```

如果您使用哈希并将项目添加到哈希中。您还可以知道每个项目在列表中出现了多少次。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-11-09T21:23:25.667

可以用一个简单的 Perl 单行来完成。

```
my @in=qw(1 3 4  6 2 4  3 2 6  3 2 3 4 4 3 2 5 5 32 3); #Sample data 
my @out=keys %{{ map{$_=>1}@in}}; # Perform PFM
print join ' ', sort{$a<=>$b} @out;# Print data back out sorted and in order. 
```

PFM 块执行以下操作：

输入的数据`@in`被送入`map`. `map`构建一个匿名哈希。 `keys`从哈希中提取并输入`@out`

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-05-09T15:29:44.307

# 方法一：使用哈希

逻辑：散列只能有唯一的键，因此遍历数组，为数组的每个元素分配任何值，保持元素作为该散列的键。哈希的返回键，它是你唯一的数组。

```
my @unique = keys {map {$_ => 1} @array}; 
```

# 方法 2：扩展方法 1 以实现可重用性

如果我们应该在代码中多次使用此功能，最好创建一个子程序。

```
sub get_unique {
    my %seen;
    grep !$seen{$_}++, @_;
}
my @unique = get_unique(@array); 
```

# 方法三：使用模块`List::MoreUtils`

```
use List::MoreUtils qw(uniq);
my @unique = uniq(@array); 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-10-23T16:18:36.777

变量`@array`是具有重复元素的列表

```
%seen=();
@unique = grep { ! $seen{$_} ++ } @array; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-23T23:35:59.633

最后一张还不错 我只是稍微调整一下：

```
my @arr;
my @uniqarr;

foreach my $var ( @arr ){
  if ( ! grep( /$var/, @uniqarr ) ){
     push( @uniqarr, $var );
  }
} 
```

我认为这可能是最易读的方式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-02T00:38:37.720

以前的答案几乎总结了完成此任务的可能方法。

但是，我建议对那些*不*关心重复*计数*但关心顺序的人*进行修改。*

```
my @record = qw( yeah I mean uh right right uh yeah so well right I maybe );
my %record;
print grep !$record{$_} && ++$record{$_}, @record; 
```

请注意，先前建议的`grep !$seen{$_}++ ...`增量`$seen{$_}`在否定之前，因此无论是否已经存在增量都会发生`%seen`。但是，上述内容在为真时会短路`$record{$_}`，从而将曾经听到的内容“关闭`%record`”。

你也可以选择这种荒谬，它利用了自动激活和哈希键的存在：

```
...
grep !(exists $record{$_} || undef $record{$_}), @record; 
```

然而，这可能会导致一些混乱。

如果你既不关心订单也不关心重复计数，你可以使用哈希切片和我刚刚提到的技巧进行另一个黑客攻击：

```
...
undef @record{@record};
keys %record; # your record, now probably scrambled but at least deduped 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-05-26T01:56:44.987

试试这个，似乎 uniq 函数需要一个排序列表才能正常工作。

```
use strict;

# Helper function to remove duplicates in a list.
sub uniq {
  my %seen;
  grep !$seen{$_}++, @_;
}

my @teststrings = ("one", "two", "three", "one");

my @filtered = uniq @teststrings;
print "uniq: @filtered\n";
my @sorted = sort @teststrings;
print "sort: @sorted\n";
my @sortedfiltered = uniq sort @teststrings;
print "uniq sort : @sortedfiltered\n"; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-30T09:47:16.577

使用唯一哈希键的概念：

```
my @array  = ("a","b","c","b","a","d","c","a","d");
my %hash   = map { $_ => 1 } @array;
my @unique = keys %hash;
print "@unique","\n"; 
```

输出：acbd

# database - 没有 Linq 时像 Linq 一样查询

> ID：7652
> 
> 赞同：3
> 
> 时间：2008-08-11T10:04:50.483
> 
> 标签：database, linq, orm

我有一个我目前正在处理的项目，但它目前只支持 .net 框架 2.0。我喜欢 linq，但由于框架版本的原因，我无法使用它。我想要的不是事物的 ORM 方面，而是 Linq 的“可查询性”（甚至是一个词吗？）。

到目前为止，最接近的是[llblgen](http://www.llblgen.com/defaultgeneric.aspx)，但如果有更轻的重量可以为我做查询，那就更好了。

我还查看了[NHibernate](http://www.hibernate.org/343.html)，它看起来可以接近我想要的，但它的学习曲线非常陡峭，并且映射文件不会让我过于兴奋。

如果有人知道可以为我提供与 Linq 类似的查询界面（或者更好的是，如何让 Linq 在 .net 2.0 框架上工作），我真的很想听听。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T12:20:36.327

看看这个：

[http://www.albahari.com/nutshell/linqbridge.html](http://www.albahari.com/nutshell/linqbridge.html)

Linq 是几个不同的东西，我不能 100% 确定你想要哪些位，但以上内容可能在某些方面有用。如果你还没有关于 Linq 的书（我猜你没有），那么我发现“Linq In Action”很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T18:12:28.800

您可能想查看[Subsonic](http://subsonicproject.com/)。它是一个使用 ActiveRecord 模式的 ORM。我很确定它的大部分功能都适用于 .NET Framework 2.0。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T18:48:02.643

呼应 Lance 所说的 - SubSonic 查询语言有一个流畅的界面，它不如 LINQ 漂亮，但给您一些好处（编译时检查、智能感知等）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-27T20:12:55.140

LinqBridge 在 .NET 2.0 下运行良好，您可以获得所有 Linq 扩展和查询语言。您需要 VS 2008 才能使用它，但您已经知道这一点。

但是，Linq 它不是 ORM。这是一种查询语法。如果要使用 Linq 查询数据库，则需要 .NET 3.5。这是因为 2.0 没有提供将 Linq 代码转换为您喜欢的数据库查询语言所需的机制。

换句话说，如果您需要 ORM，*LinqBridge 不会帮助您*。您需要查看提供的其他一些建议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T10:09:27.153

有一种方法可以在 .NET 2.0 框架中引用 LINQ，但我必须警告您，它*可能*违反框架的使用条款/EULA：

[.NET 2.0 运行时上的 LINQ](https://stackoverflow.com/questions/2138/linq-on-the-net-20-runtime#2146)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T10:15:49.933

首先。让 linq 本身在 2.0 上工作是不可能的。它是可能的，但实际上不是在测试环境之外做的事情。

就其中的 ORM/动态查询部分而言，您可以获得的最接近的是 imho SubSonic，我会推荐给任何陷入 C# 2.0 的人

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-11T14:21:19.843

LinqBridge 看起来是个不错的起点，因为我有 VS2008，我只需要编译并部署到 .net 2.0 服务器。

我看过 SubSonic，它也是一个有趣的替代方案，但 linqbridge 似乎提供了更合适的选择，所以我不必去学习新的 ORM / 查询语法。

# java - WGS84 到 Google 地图位置和返回的 Java 代码

> ID：7661
> 
> 赞同：10
> 
> 时间：2008-08-11T10:23:48.763
> 
> 标签：java, google-maps, mapping, wgs84

搜索一些示例代码，用于将 WGS84 坐标系中的点转换为谷歌地图中的地图位置（像素位置），也支持缩放级别。

如果代码有很好的注释，那么它也可以是其他语言。

您也可以将我指向一个开源 Java 项目 :)

找到的一些资源：

[OpenLayer](http://trac.openlayers.org/browser/trunk/openlayers/lib/OpenLayers/Layer)实现。

[JOSM](http://josm.openstreetmap.de/browser/trunk/src/org/openstreetmap/josm/data/projection)项目

来自 JH LABS 的优秀[Java 地图投影库。](https://github.com/OSUCartography/JMapProjLib)这是一个纯 java PROJ.4 端口。从 WGS84 投影到米。从那里将米转换为平铺像素非常简单。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-28T15:17:00.740

mapki.com 上[的 Java 平铺实用程序代码（谷歌地图开发人员的绝佳资源）](http://web.archive.org/web/20110809084551/http://mapki.com/wiki/Tile_utility_code_in_Java)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-03T17:58:56.957

以下是 JavaSCript 中的函数......摘自 OpenLayers

```
function toMercator (lon, lat) {
  var x = lon * 20037508.34 / 180;
  var y = Math.log(Math.tan((90 + lat) * Math.PI / 360)) / (Math.PI / 180);
  y = y * 20037508.34 / 180;

  return [x, y];
  }

function inverseMercator (x, y) {
  var lon = (x / 20037508.34) * 180;
  var lat = (y / 20037508.34) * 180;

  lat = 180/Math.PI * (2 * Math.atan(Math.exp(lat * Math.PI / 180)) - Math.PI / 2);

  return [lon, lat];
  } 
```

转换为 Java 相当简单

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T11:29:18.113

[GeoTools](http://web.archive.org/web/20090810085708/http://geotools.codehaus.org:80/)有代码可以在你能想象到的任何坐标系之间进行转换，其中还有谷歌地图。它也是开源的。然而，还应该指出的是，GeoTools 是一个**大型**库，所以如果您正在寻找一些小、快速和简单的东西，那么它可能不是正确的选择。

如果您还要进行其他 GIS/坐标转换等，我强烈推荐它。

如果您使用 GeoTools 或类似工具，您可能还想知道 Google 地图坐标系称为 EPSG 3785。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-08T14:18:44.130

我将它移植到 PHP - 这是代码，如果有人需要它：

对墨卡托：

```
$lon = ($lon * 20037508.34) / 180;
$lat = log(tan((90 + $lat) * M_PI / 360)) / (M_PI / 180);
$lat = $lat * 20037508.34 / 180; 
```

从墨卡托：

```
$lon = ($lon / 20037508.34) * 180;
$lat = ($lat / 20037508.34) * 180;
$lat = 180/M_PI * (2 * atan(exp($lat * M_PI / 180)) - M_PI / 2); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-31T19:10:39.517

```
/*
 * Utility functions to transform between wgs84 and google projection coordinates
 * Derived from openmap http://openmap.bbn.com/
 */

public class MercatorTransform {
    public final static double NORTH_POLE = 90.0;
    public final static double SOUTH_POLE = -NORTH_POLE;
    public final static double DATELINE = 180.0;
    public final static double LON_RANGE = 360.0;

    final public static transient double wgs84_earthEquatorialRadiusMeters_D = 6378137.0;
    private static double latfac = wgs84_earthEquatorialRadiusMeters_D;
    private static double lonfac = wgs84_earthEquatorialRadiusMeters_D;

    final public static transient double HALF_PI_D = Math.PI / 2.0d;

    /**
     * Returns google projection coordinates from wgs84 lat,long coordinates
     */
    public static double[] forward(double lat, double lon) {

        lat = normalizeLatitude(lat);
        lon = wrapLongitude(lon);

        double latrad = Math.toRadians(lat);
        double lonrad = Math.toRadians(lon);

        double lat_m = latfac * Math.log(Math.tan(((latrad + HALF_PI_D) / 2d)));
        double lon_m = lonfac * lonrad;

        double[] x = { lon_m, lat_m };
        return x;
    }

    /**
     * Returns wgs84 lat,long coordinates from google projection coordinates
     */
    public static float[] inverse(float lon_m, float lat_m) {
        double latrad = (2d * Math.atan(Math.exp(lat_m / latfac))) - HALF_PI_D;
        double lonrad = lon_m / lonfac;

        double lat = Math.toDegrees(latrad);
        double lon = Math.toDegrees(lonrad);

        lat = normalizeLatitude(lat);
        lon = wrapLongitude(lon);
        float[] x = { (float) lat, (float) lon };

        return x;
    }

    private static double wrapLongitude(double lon) {
        if ((lon < -DATELINE) || (lon > DATELINE)) {
            lon += DATELINE;
            lon = lon % LON_RANGE;
            lon = (lon < 0) ? DATELINE + lon : -DATELINE + lon;
        }
        return lon;
    }

    private static double normalizeLatitude(double lat) {
        if (lat > NORTH_POLE) {
            lat = NORTH_POLE;
        }
        if (lat < SOUTH_POLE) {
            lat = SOUTH_POLE;
        }
        return lat;
    }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T10:58:11.080

有人从 Google Maps 中获取了 javascript 代码并将其移植到 python：[gmerc.py](http://code.google.com/p/gheat/source/browse/trunk/__/lib/python/gmerc.py)

我用过这个，效果很好。

# database - 数据库、表和列的命名约定？

> ID：7662
> 
> 赞同：855
> 
> 时间：2008-08-11T10:27:22.780
> 
> 标签：database, database-design, language-agnostic, naming-conventions

每当我设计数据库时，我总是想知道是否有最好的方法来命名我的数据库中的项目。我经常问自己以下问题：

1.  表名应该是复数吗？
2.  列名应该是单数吗？
3.  我应该为表或列添加前缀吗？
4.  我应该在命名项目时使用任何大小写吗？

是否有任何推荐的准则来命名数据库中的项目？

* * *

## 回答 #1

> 赞同：362
> 
> 时间：2008-08-11T12:39:37.817

我建议查看 Microsoft 的 SQL Server 示例数据库： [https ://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks](https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks)

AdventureWorks 示例使用非常清晰且一致的命名约定，该约定使用架构名称来组织数据库对象。

1.  表的单数名称
2.  列的单数名称
3.  表前缀的模式名称（例如：SchemeName.TableName）
4.  帕斯卡套管（又名上驼峰壳）

* * *

## 回答 #2

> 赞同：335
> 
> 时间：2010-01-22T16:07:18.463

这里迟到的答案，但简而言之：

1.  **复数表名：**我的*偏好*是复数
2.  **单列名称：**是
3.  **前缀表或列：**

*   *表格*：*通常*最好没有前缀。
*   *列*：没有。

4.  **在命名项目时使用任何大小写：** PascalCase 用于表和列。

阐述：

(1)***你必须做什么。*** 很少有事情你*必须*每次都以某种方式做，但也有一些。

*   使用“[singularOfTableName]ID”格式命名您的**主键。**也就是说，无论您的表名是*Customer*还是*Customers*，主键都应该是*CustomerID*。
*   此外，**外键*必须***在不同的表**中以一致的方式命名。**殴打不这样做的人应该是合法的。我会提出，虽然定义的外键约束*通常*很重要，但一致的外键命名*总是*很重要
*   您的数据库必须有**内部约定**。尽管在后面的部分中您会看到我非常灵活，但*在*数据库中命名必须非常一致。无论您的客户表称为“*客户*”还是“*客户*”，都没有您在同一数据库中以相同方式执行此操作重要。你可以掷硬币来决定如何使用下划线，但你*必须继续以同样的方式使用它们*。如果你不这样做，你就是一个应该自卑的坏人。

(2)***你可能应该做什么。***

*   表示不同表上相同类型数据的字段*应*命名相同。不要在一张桌子上使用 Zip，在另一张桌子上使用 ZipCode。
*   要分隔表名或列名中的单词，请使用 PascalCasing。使用 camelCasing 本质上不会有问题，但这不是惯例，而且看起来很有趣。稍后我将讨论下划线。（您可能不会像过去那样使用 ALLCAPS。OBNOXIOUSTABLE.ANNOYING_COLUMN 在 20 年前的 DB2 中还可以，但现在不行。）
*   不要人为地缩短或缩写单词。名字长而清晰总比短而混乱好。超短名称是更黑暗、更野蛮时代的遗留物。Cus_AddRef。那到底是什么？保管收件人参考？客户额外退款？自定义地址推荐？

(3)***你应该考虑什么。***

*   我真的认为您应该为表格使用复数名称；有些人认为奇异。阅读其他地方的论点。但是，列名应该是单数的。即使您使用复数表名，表示其他表组合的表也可能是单数。例如，如果您有一个*Promotions*和一个*Items*表，则表示作为促销一部分的项目的表可能是 Promotions_Items，但我认为它也可能是 Promotion_Items（反映一对多关系）。
*   始终如一地使用下划线并用于特定目的。使用 PascalCasing 时，一般表名应该足够清晰；您不需要下划线来分隔单词。保存下划线（a）表示关联表或（b）作为前缀，我将在下一个项目符号中解决。
*   前缀既不好也不坏。这*通常*不是最好的。在您的第一个或两个数据库中，我不建议对表格的一般主题分组使用前缀。表格最终无法轻松适应您的类别，并且实际上会使查找表格*变得更加困难。*凭借经验，您可以计划和应用一个利大于弊的前缀方案。我曾经在一个数据库中工作过，其中数据表以*tbl*开头，以*ctbl*配置表，以*vew*、proc 的*sp*和 udf 的*fn开头的视图*，以及其他一些人；它一丝不苟，始终如一地应用，所以效果还不错。你唯一需要前缀的时候是当你有真正独立的解决方案时，由于某种原因驻留在同一个数据库中；为它们添加前缀对于对表进行分组非常有帮助。前缀也适用于特殊情况，例如您想要突出的临时表。
*   您很少（如果有的话）想要为列添加前缀。

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2008-08-11T10:49:03.687

好的，因为我们正在权衡意见：

我相信表名应该是复数。表是实体的集合（表）。每行代表一个实体，表格代表集合。所以我会称一个 Person 实体表 People（或 Persons，无论你喜欢什么）。

对于那些喜欢在查询中看到单数“实体名称”的人，这就是我使用表别名的目的：

```
SELECT person.Name
FROM People person 
```

有点像 LINQ 的“从人中选择人名”。

至于 2、3 和 4，我同意@Lars。

* * *

## 回答 #4

> 赞同：78
> 
> 时间：2008-08-11T12:24:17.647

我在一个拥有三个 DBA 的数据库支持团队中工作，我们考虑过的选项是：

1.  任何命名标准都比没有标准好。
2.  没有“一个真正”的标准，我们都有自己的喜好
3.  如果已有标准，请使用它。不要创建另一个标准或混淆现有标准。

我们对表使用单数名称。表格往往以系统名称（或其首字母缩写词）作为前缀。如果系统复杂，这很有用，因为您可以更改前缀以将表按逻辑分组（即 reg_customer、reg_booking 和 regadmin_limits）。

对于字段，我们希望字段名称包含表的前缀/acryonm（即 cust_address1），我们也更喜欢使用一组标准的后缀（_id 表示 PK，_cd 表示“代码”，_nm 表示“名称"，_nb 表示“数字”，_dt 表示“日期”）。

外键字段的名称应与主键字段的名称相同。

IE

```
SELECT cust_nm, cust_add1, booking_dt
FROM reg_customer
INNER JOIN reg_booking
ON reg_customer.cust_id = reg_booking.cust_id 
```

在开发新项目时，我建议您写出所有首选的实体名称、前缀和首字母缩略词，并将此文档提供给您的开发人员。然后，当他们决定创建一个新表时，他们可以参考文档而不是“猜测”应该调用什么表和字段。

* * *

## 回答 #5

> 赞同：53
> 
> 时间：2008-08-11T10:35:10.643

1.  不可以。表应该以其所代表的实体命名。人，而不是人是您如何指代其中一条记录所代表的人。
2.  再次，同样的事情。FirstName 列确实不应该称为 FirstNames。这完全取决于您想用该列表示什么。
3.  不。
4.  是的。为清楚起见。如果您需要像“FirstName”这样的列，则使用大小写会更容易阅读。

行。那是我的 0.02 美元

* * *

## 回答 #6

> 赞同：36
> 
> 时间：2008-10-23T10:45:02.153

我也赞成 ISO/IEC 11179 风格的命名约定，并指出它们是指导方针而不是规定性的。

请参阅[Wikipedia 上的数据元素名称](http://en.wikipedia.org/wiki/Data_element_name)：

“表是实体的集合，并遵循集合命名准则。理想情况下，使用一个集合名称：例如，Personnel。复数也是正确的：Employees。不正确的名称包括：Employee、tblEmployee 和 EmployeeTable。”

与往常一样，规则也有例外，例如始终只有一行的表可能会更好地使用单数名称，例如配置表。一致性至关重要：检查您的商店是否有惯例，如果有，请遵守；如果你不喜欢它，那么做一个商业案例来改变它，而不是成为独行侠。

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2013-04-29T19:26:10.883

我一直听到这样的论点，即一张桌子是否多元化完全取决于个人品味，没有最佳实践。我不相信这是真的，尤其是作为一名程序员而不是 DBA。据我所知，除了“这对我来说很有意义，因为它是对象的集合”之外，没有任何正当理由将表名复数，而通过使用单数表名可以在代码中获得合法收益。例如：

1.  它避免了由复数歧义引起的错误和错误。程序员并不完全以其拼写专业知识而闻名，并且将某些单词复数会令人困惑。例如，复数词是以“es”结尾还是只是“s”？是人还是人？当您与大型团队一起处理项目时，这可能会成为一个问题。例如，团队成员使用不正确的方法来复数他创建的表的实例。当我与此表交互时，它已在我无权访问或修复所需时间太长的代码中全部使用。结果是我每次使用时都必须记住拼错表格。与此非常相似的事情发生在我身上。您可以让团队的每个成员更轻松地始终如一地轻松使用确切的，正确的表名没有错误或必须一直查找表名，更好。单数版本在团队环境中更容易处理。

2.  如果您使用单数版本的表名并在主键前面加上表名，您现在可以轻松地通过主键确定表名，反之亦然，仅通过代码即可。您可以得到一个包含表名的变量，将“Id”连接到末尾，您现在可以通过代码获得表的主键，而无需进行额外的查询。或者，您可以从主键末尾截去“Id”，以通过代码确定表名。如果您使用没有表名的“id”作为主键，那么您无法通过代码从主键中确定表名。此外，大多数将表名复数并在 PK 列前加上表名的人在 PK 中使用单数形式的表名（例如 statuses 和 status_id），

3.  如果您将表名设为单数，则可以让它们与它们所代表的类名匹配。再一次，这可以简化代码并允许您做一些非常简洁的事情，例如通过只有表名来实例化一个类。它还只是使您的代码更加一致，从而导致...

4.  如果您将表名设为单数，则可以使您的命名方案在每个位置都保持一致、有条理且易于维护。您知道，在代码中的每个实例中，无论是列名、类名还是表名，它都是完全相同的名称。这使您可以进行全局搜索以查看使用数据的任何地方。当您将表名复数时，在某些情况下您将使用该表名的单数版本（它变成的类，在主键中）。没有某些情况下您的数据被称为复数而某些情况下被称为单数是有意义的。

To sum it up, if you pluralize your table names you are losing all sorts of advantages in making your code smarter and easier to handle. There may even be cases where you have to have lookup tables/arrays to convert your table names to object or local code names you could have avoided. Singular table names, though perhaps feeling a little weird at first, offer significant advantages over pluralized names and I believe are best practice.

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2010-03-26T13:58:16.517

我们的偏好：

1.  表名应该是复数吗？
    绝不。它是一个集合的论点是有道理的，但你永远不知道表将包含什么（0,1 或许多项目）。复数规则使命名不必要地复杂。1 栋房子，2 栋房子，老鼠对老鼠，人对人，我们甚至没有看过任何其他语言。

    `Update person set property = 'value'`作用于表中的每个人。
    `Select * from person where person.name = 'Greg'`返回人员行的集合/行集。

2.  列名应该是单数吗？
    通常，是的，除非您违反规范化规则。

3.  我应该为表或列添加前缀吗？
    主要是平台偏好。我们更喜欢在列前加上表名。我们不为表添加前缀，但我们为视图 (v_) 和 stored_procedures（sp_ 或 f_（函数））添加前缀。这有助于想要尝试更新 v_person.age 的人，这实际上是视图中的计算字段（无论如何都无法更新）。

    这也是避免关键字冲突的好方法（delivery.from 中断，但 delivery_from 没有）。

    它确实使代码更加冗长，但通常有助于提高可读性。

    `bob = new person()`
    `bob.person_name = 'Bob'`
    `bob.person_dob = '1958-12-21'`
    ... 非常易读和明确。这可能会失控：

    `customer.customer_customer_type_id`

    表示客户和 customer_type 表之间的关系，表示 customer_type 表 (customer_type_id) 上的主键，如果您在调试查询时看到“customer_customer_type_id”，您会立即知道它来自哪里（客户表）。

    或者您在 customer_type 和 customer_category 之间有 MM 关系（只有某些类型可用于某些类别）

    `customer_category_customer_type_id`

    ...长边有点（！）。

4.  我应该在命名项目时使用任何大小写吗？是的 - 小写:)，带下划线。这些是非常易读和跨平台的。加上上面的3，它也很有意义。

    不过，其中大部分都是偏好。- 只要您保持一致，任何必须阅读它的人都应该可以预测。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2008-08-11T13:13:58.747

看看 ISO 11179-5：命名和识别原则你可以在这里得到它：http: [//metadata-standards.org/11179/#11179-5](http://metadata-standards.org/11179/#11179-5)

我在这里写了一段时间的博客：[ISO-11179 Naming Conventions](http://sqlservercode.blogspot.com/2006/11/iso-11179-naming-conventions.html)

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2011-09-02T22:19:26.930

我知道这已经很晚了，并且这个问题已经得到了很好的回答，但是我想就#3 关于列名的前缀提出我的意见。

**所有列都应该使用一个前缀来命名，该前缀对于定义它们的表来说是唯一的。**

例如，给定表“customer”和“address”，让我们分别使用前缀“cust”和“addr”。“客户”将包含“cust_id”、“cust_name”等。“地址”将包含“addr_id”、“addr_cust_id”（FK 回客户）、“addr_street”等。

当我第一次看到这个标准时，我坚决反对它。我讨厌这个主意。我无法忍受所有额外的打字和冗余的想法。现在我已经有足够的经验了，我再也不会回去了。

这样做的结果是数据库模式中的所有列都是唯一的。这样做有一个主要好处，它胜过所有反对它的论点（当然，在我看来）：

**您可以搜索整个代码库并可靠地找到涉及特定列的每一行代码。**

＃1的好处是非常巨大的。我可以弃用一个列，并确切知道需要更新哪些文件，然后才能安全地从架构中删除该列。我可以更改列的含义并确切知道需要重构哪些代码。或者我可以简单地判断列中的数据是否正在系统的特定部分中使用。我数不清有多少次把一个潜在的巨大项目变成一个简单的项目，也数不清我们在开发工作中节省的时间。

另一个相对较小的好处是，您只需在进行自联接时使用表别名：

```
SELECT cust_id, cust_name, addr_street, addr_city, addr_state
    FROM customer
        INNER JOIN address ON addr_cust_id = cust_id
    WHERE cust_name LIKE 'J%'; 
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2008-08-11T11:27:56.230

我对这些的看法是：

1) 不，表名应该是单数。

虽然对于简单的选择 ( `select * from Orders`) 似乎有意义，但对于 OO 等效项 ( `Orders x = new Orders`) 来说意义不大。

数据库中的表实际上是该实体的集合，一旦您使用集合逻辑，它就更有意义：

```
select Orders.*
from Orders inner join Products
    on Orders.Key = Products.Key 
```

最后一行，连接的实际逻辑，看起来与复数表名混淆。

我不确定是否总是使用别名（正如马特建议的那样）可以解决这个问题。

2) 它们应该是单数的，因为它们只拥有 1 个属性

3) 从不，如果列名不明确（如上所示，它们都有一个名为 [Key] 的列），则表的名称（或其别名）可以很好地区分它们。您希望查询输入快速且简单 - 前缀会增加不必要的复杂性。

4) 无论你想要什么，我都会推荐 CapitalCase

我认为没有一套绝对的指导方针。

只要您选择的任何内容在应用程序或数据库中都是一致的，我认为这并不重要。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2008-08-11T15:23:32.027

在我看来：

1.  表名应该是复数。
2.  列名应该是单数。
3.  不。
4.  CamelCase（我的首选）或 underscore_separated 用于表名和列名。

然而，就像已经提到的那样，任何约定都比没有约定好。无论您选择如何做，都要记录下来，以便将来的修改遵循相同的约定。

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2008-08-11T11:14:11.937

我认为您和您的团队将给出每个问题的最佳答案。有一个命名约定比命名约定的精确程度要重要得多。

由于没有正确的答案，您应该花一些时间（但不要太多）并选择自己的约定，并且 -*这*是重要的部分 - 坚持下去。

当然，最好在这方面寻求一些有关标准的信息，这就是您所要求的，但不要担心或担心您可能得到的不同答案的数量：选择一个看起来更适合您的答案。

以防万一，这是我的答案：

1.  是的。表是一组*记录*、*教师*或*演员*，所以...复数。
2.  是的。
3.  我不使用它们。
4.  我经常使用的数据库——Firebird——将所有内容都保持为大写，所以没关系。无论如何，当我编程时，我会以更容易阅读的方式编写名称，例如*releaseYear*。

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2008-08-11T11:24:50.823

1.  绝对保持表名单数，人而不是人
    2.  同样在这里
    3.  不，我见过一些可怕的前缀，甚至表明正在处理的是表 (tbl_) 或用户存储过程 (usp_)。这后跟数据库名称......不要这样做！
    4.  是的。我倾向于 PascalCase 我所有的表名

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2008-08-11T12:27:27.670

命名约定允许开发团队在项目的核心设计可发现性和可维护性。

一个好的命名约定需要时间来发展，但一旦到位，它就可以让团队使用一种共同的语言向前发展。一个好的命名约定随着项目的发展而有机地发展。一个好的命名约定可以轻松应对软件生命周期中最长和最重要阶段的变化——生产中的服务管理。

以下是我的回答：

1.  是的，例如，当表名指代一组*交易*、*证券*或*交易对手*时，表名应该是复数。
2.  是的。
3.  是的。SQL 表以 tb_ 为前缀，视图以 vw_ 为前缀，存储过程以 usp_ 为前缀，触发器以 tg_ 为前缀，后跟数据库名称。
4.  列名应为小写，并用下划线分隔。

命名很困难，但在每个组织中都有可以命名事物的人，并且在每个软件团队中都应该有人负责命名标准，并确保像*sec_id*、*sec_value*和*security_id*这样的命名问题在进入项目之前得到早期解决.

那么好的命名约定和标准的基本原则是什么：-

*   使用您的客户和您的解决方案领域的语言
*   具有描述性
*   始终如一
*   消除歧义、反映和重构
*   除非每个人都清楚，否则不要使用缩写
*   不要使用 SQL 保留关键字作为列名

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2008-10-22T17:05:31.713

这是一个提供一些选择的链接。我正在寻找一个我可以遵循的简单规范，而不是不得不依赖一个部分定义的规范。

[http://justinsomnia.org/writings/naming_conventions.html](http://justinsomnia.org/writings/naming_conventions.html)

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2010-01-22T23:19:44.657

```
SELECT 
   UserID, FirstName, MiddleInitial, LastName
FROM Users
ORDER BY LastName 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-06-25T10:18:06.923

表名应始终为单数，因为它们代表一组对象。正如你所说的herd 来指定一群羊，或者flock 来指定一群鸟。不需要复数。当表名由两个名称组成并且命名约定是复数时，很难知道复数名称应该是第一个词还是第二个词或两者兼而有之。这是逻辑——Object.instance，而不是objects.instance。或 TableName.column，而不是 TableNames.column(s)。Microsoft SQL 不区分大小写，如果表名由两个或多个名称组成，则如果使用大写字母来分隔表或列名，则更容易阅读表名。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2011-09-24T13:08:53.873

**表名：**它应该是单数的，因为它是一个单数实体，代表一个真实世界的对象，而不是单数的对象。

**列名：**它应该是单数的，只有当它表示它将保持一个原子值并确认归一化理论时。但是，如果有 n 个相同类型的属性，则它们应该以 1、2、...、n 等为后缀。

Prefixing Tables / Columns：这是一个很大的话题，稍后会讨论。

外壳：应该是骆驼壳

我的朋友，**Patrick Karcher**，我请求你不要写任何可能冒犯别人的东西，正如你所写的，“•此外，外键在不同的表中必须一致命名。殴打不这样做的人应该是合法的做这个。”。我的朋友帕特里克我从来没有犯过这个错误，但我写的是一般性的。如果他们一起计划为此打败你怎么办？:)

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2012-12-03T09:11:42.430

聚会很晚了，但我仍然想加两分钱关于列前缀

对于列使用 table_column（或 tableColumn）命名标准似乎有两个主要论据，两者都基于列名本身在整个数据库中将是唯一的这一事实：

1) 您不必一直在查询中指定表名和/或列别名

2）您可以轻松地在整个代码中搜索列名

我认为这两个论点都有缺陷。在不使用前缀的情况下解决这两个问题很容易。这是我的建议：

**始终在 SQL 中使用表名。例如，始终使用 table.column 而不是 column。**

它显然解决了 2)，因为您现在可以只搜索 table.column 而不是 table_column。

但我能听到你尖叫，它是如何解决的 1)？正是为了避免这种情况。是的，确实如此，但解决方案存在严重缺陷。为什么？好吧，前缀解决方案归结为：
为了避免在有歧义时必须指定 table.column，您将所有列命名为 table_column！
但这意味着您从现在开始每次指定列时都必须写入列名。但是，如果您无论如何都必须这样做，那么始终显式编写 table.column 有什么好处？确切地说，没有任何好处，输入的字符数完全相同。

编辑：是的，我知道用前缀命名列会强制正确使用，而我的方法依赖于程序员

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2011-05-05T06:08:50.227

[基本数据库命名约定（和样式）](http://justinsomnia.org/2003/04/essential-database-naming-conventions-and-style/)（单击此处获取更多详细说明）

表名选择简短、明确的名称，使用不超过一两个词来区分表 便于命名唯一字段名以及查找和链接表给表提供单数名称，从不复数（更新：我仍然同意给出的原因对于这个约定，但大多数人真的很喜欢复数表名，所以我已经软化了我的立场）......请点击上面的链接

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2011-06-26T19:18:57.333

表名单数。假设您正在模拟某人与其地址之间的关系。例如，如果您正在阅读数据模型，您会更喜欢“每个人可能住在 0,1 或多个地址”。或“每个人可能住在 0,1 或多个地址。” 我认为更容易使地址多元化，而不是必须将人重新表述为人。加上集体名词通常与单数形式不同。

* * *

## 回答 #23

> 赞同：-4
> 
> 时间：2008-08-11T11:46:05.617

```
 --Example SQL

CREATE TABLE D001_Students
(
    StudentID INTEGER CONSTRAINT nnD001_STID NOT NULL,
    ChristianName NVARCHAR(255) CONSTRAINT nnD001_CHNA NOT NULL,
    Surname NVARCHAR(255) CONSTRAINT nnD001_SURN NOT NULL,
    CONSTRAINT pkD001 PRIMARY KEY(StudentID)
);

CREATE INDEX idxD001_STID on D001_Students;

CREATE TABLE D002_Classes
(
    ClassID INTEGER CONSTRAINT nnD002_CLID NOT NULL,
    StudentID INTEGER CONSTRAINT nnD002_STID NOT NULL,
    ClassName NVARCHAR(255) CONSTRAINT nnD002_CLNA NOT NULL,
    CONSTRAINT pkD001 PRIMARY KEY(ClassID, StudentID),
    CONSTRAINT fkD001_STID FOREIGN KEY(StudentID) 
        REFERENCES D001_Students(StudentID)
);

CREATE INDEX idxD002_CLID on D002_Classes;

CREATE VIEW V001_StudentClasses
(
    SELECT
        D001.ChristianName,
        D001.Surname,
        D002.ClassName
    FROM
        D001_Students D001
            INNER JOIN
        D002_Classes D002
            ON
        D001.StudentID = D002.StudentID
); 
```

这些是我被教导的约定，但您应该适应开发软管使用的任何内容。

1.  复数。它是实体的集合。
2.  是的。属性是实体的单一属性的表示。
3.  是的，前缀表名允许轻松跟踪所有约束索引和表别名的命名。
4.  表名和列名的 Pascal Case，索引和约束的前缀 + ALL 大写。

# c++ - Windows C++：如何重定向 stderr 以调用 fprintf？

> ID：7664
> 
> 赞同：6
> 
> 时间：2008-08-11T10:38:51.570
> 
> 标签：c++, windows, redirect

我正在将**BSD**项目中现有的 C++ 代码包装在我们自己的自定义包装器中，并且我希望通过尽可能少的更改将其集成到我们的代码中。此代码用于`fprintf`打印到**stderr**以记录/报告错误。

我想将其重定向到同一进程中的另一个位置。在**Unix**上，我使用 a`socketpair`和 a完成了此操作`thread`：套接字的一端是我发送**stderr**的地方（通过对 的调用`dup2`），另一端在线程中进行监视，然后我可以在其中处理输出。

**这在Windows**上不起作用，因为套接字与文件句柄不同。

我在网上找到的所有文档都显示了如何重定向子进程的输出，这不是我想要的。如何在写入输出时在同一进程中重定向**stderr**以获取某种回调？（在你这么说之前，我已经尝试过`SetStdHandle`但找不到任何方法来完成这项工作）......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-11T11:05:37.820

您可以在 Windows 上使用类似的技术，您只需要对相同的概念使用不同的词。:) 这篇文章： http: [//msdn.microsoft.com/en-us/library/ms682499.aspx](http://msdn.microsoft.com/en-us/library/ms682499.aspx)使用 win32 管道来处理来自另一个进程的 I/O，你只需要对同一个进程中的线程做同样的事情过程。当然，在您的情况下，从流程中的任何位置到 stderr 的所有输出都将重定向到您的消费者。

实际上，您可能需要的其他难题是[_fdopen](http://msdn.microsoft.com/en-us/library/dye30d82(VS.80).aspx)和[_open_osfhandle](http://msdn.microsoft.com/en-us/library/bdts1c9x(VS.71).aspx)。事实上，这是我多年前发布的一些[代码中的一个相关示例：](http://hewgill.com/pilot/copilot/)

```
DWORD CALLBACK DoDebugThread(void *)
{
    AllocConsole();
    SetConsoleTitle("Copilot Debugger");
    // The following is a really disgusting hack to make stdin and stdout attach
    // to the newly created console using the MSVC++ libraries. I hope other
    // operating systems don't need this kind of kludge.. :)
    stdout->_file = _open_osfhandle((long)GetStdHandle(STD_OUTPUT_HANDLE), _O_TEXT);
    stdin->_file  = _open_osfhandle((long)GetStdHandle(STD_INPUT_HANDLE), _O_TEXT);
    debug();
    stdout->_file = -1;
    stdin->_file  = -1;
    FreeConsole();
    CPU_run();
    return 0;
} 
```

在这种情况下，主进程是一个 GUI 进程，它根本不以 stdio 句柄开始。它打开一个控制台，然后将正确的句柄推入 stdout 和 stdin，以便 debug() 函数（设计为 stdio 交互函数）可以与新创建的控制台交互。您应该能够打开一些管道并执行相同的操作来重定向 stderr。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T11:39:21.853

您必须记住，MSVCRT 所称的“操作系统句柄”不是 Win32 句柄，而是添加的另一层句柄只是为了让您感到困惑。MSVCRT 尝试模拟 Unix 句柄编号，其中`stdin`= 0、`stdout`= 1、`stderr`= 2 等等。Win32 句柄的编号不同，并且它们的值总是恰好是 4 的倍数。打开管道并正确配置所有句柄将需要让你的手变得凌乱。可能需要使用 MSVCRT 源代码和调试器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T08:52:53.360

您提到您不想将命名管道用于内部使用；可能值得指出的是[CreatePipe()](http://msdn.microsoft.com/en-us/library/aa365152(VS.85).aspx)的文档指出，*“匿名管道是使用具有唯一名称的命名管道实现的。因此，您通常可以将匿名管道的句柄传递给需要命名的句柄的函数。管道。”* 所以，我建议你只写一个函数，用正确的异步读取设置创建一个类似的管道。我倾向于使用 GUID 作为字符串（使用`CoCreateGUID()`and生成`StringFromIID()`）给我一个唯一的名称，然后使用重叠 I/O 的正确设置创建命名管道的服务器端和客户端（有关此的更多详细信息和代码，这里： [http://www.lenholgate.com/blog/2008/02/process-management-using-jobs-on-windows.html](http://www.lenholgate.com/blog/2008/02/process-management-using-jobs-on-windows.html)）。

一旦我连接了一些代码，我必须使用重叠 I/O 和 I/O 完成端口来读取文件，然后，我只会在数据到达时收到数据的异步通知......但是，我那里有大量经过良好测试的库代码，这一切都发生了......

可能可以设置命名管道，然后只需对`OVERLAPPED`结构中的事件进行重叠读取，然后检查事件以查看数据是否可用……尽管如此，我没有任何可用的代码。

# bash - 如何解析 shell 脚本中的符号链接

> ID：7665
> 
> 赞同：241
> 
> 时间：2008-08-11T10:40:41.363
> 
> 标签：bash, shell, scripting, symlink

给定一个绝对或相对路径（在类 Unix 系统中），我想在解析任何中间符号链接后确定目标的完整路径。同时解决 ~username 符号的奖励积分。

如果目标是一个目录，则可以将 chdir() 放入该目录，然后调用 getcwd()，但我真的想从 shell 脚本中执行此操作，而不是编写 C 帮助程序。不幸的是，shell 倾向于尝试对用户隐藏符号链接的存在（这是 OS X 上的 bash）：

```
$ ls -ld foo bar
drwxr-xr-x   2 greg  greg  68 Aug 11 22:36 bar
lrwxr-xr-x   1 greg  greg   3 Aug 11 22:36 foo -> bar
$ cd foo
$ pwd
/Users/greg/tmp/foo
$ 
```

我想要的是一个函数 resolve()，这样当从上面示例中的 tmp 目录执行时，resolve("foo") == "/Users/greg/tmp/bar"。

* * *

## 回答 #1

> 赞同：436
> 
> 时间：2008-09-04T00:33:45.160

```
readlink -f "$path" 
```

^(编者注：以上内容适用于*GNU* `readlink`和*FreeBSD/PC-BSD/OpenBSD* `readlink`，但*不适*用于 OS X 10.11。
*GNU* `readlink`提供了额外的相关选项，例如`-m`无论最终目标是否存在，都可以解析符号链接。)

请注意，自 GNU coreutils 8.15 (2012-01-06) 以来，有一个可用的**realpath**程序，它比上述程序不那么钝且更灵活。它还与同名的 FreeBSD 实用程序兼容。它还包括在两个文件之间生成相对路径的功能。

```
realpath $path 
```

* * *

[下面的管理员添加来自[halloleo](/users/65889/halloleo)的评论—<a href="/users/65889/danorton">danorton]

对于 Mac OS X（至少 10.11.x），使用`readlink`不带`-f`选项：

```
readlink $path 
```

^(编者注：这不会*递归*解析符号链接，因此不会报告*最终*目标；`a`例如，给定指向 的符号链接`b`，而后者又指向`c`，这只会报告`b`（并且不会确保它作为*绝对路径*输出）。
在 OS X 上使用以下`perl`命令来填补缺失`readlink -f`功能的空白：
`perl -MCwd -le 'print Cwd::abs_path(shift)' "$path"`)

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2008-08-11T10:48:19.260

根据标准，`pwd -P`应该返回已解析符号链接的路径。

C 函数`char *getcwd(char *buf, size_t size)`from`unistd.h`应该具有相同的行为。

[获取](http://www.opengroup.org/onlinepubs/009695399/functions/getcwd.html) [密码](http://www.opengroup.org/onlinepubs/009695399/utilities/pwd.html)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-30T14:54:59.073

如果您只想要目录，“pwd -P”似乎可以工作，但如果由于某种原因您想要实际可执行文件的名称，我认为这没有帮助。这是我的解决方案：

```
#!/bin/bash

# get the absolute path of the executable
SELF_PATH=$(cd -P -- "$(dirname -- "$0")" && pwd -P) && SELF_PATH=$SELF_PATH/$(basename -- "$0")

# resolve symlinks
while [[ -h $SELF_PATH ]]; do
    # 1) cd to directory of the symlink
    # 2) cd to the directory of where the symlink points
    # 3) get the pwd
    # 4) append the basename
    DIR=$(dirname -- "$SELF_PATH")
    SYM=$(readlink "$SELF_PATH")
    SELF_PATH=$(cd "$DIR" && cd "$(dirname -- "$SYM")" && pwd)/$(basename -- "$SYM")
done 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-12-04T23:39:05.553

我的最爱之一是`realpath foo`

```
realpath - 返回规范化的绝对​​路径名

realpath 扩展所有符号链接并解析对“/./”、“/../”和额外“/”字符的引用，这些字符在由 path 命名的空终止字符串中和
       将规范化的绝对​​路径名存储在由resolved_pa​​th 命名的大小为PATH_MAX 的缓冲区中。生成的路径将没有符号链接，“/./”或
       '/../' 组件。

```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-07-09T14:34:38.377

```
readlink -e [filepath] 
```

似乎正是您所要求的 - 它接受任意路径，解析所有符号链接，并返回“真实”路径 - 它是可能所有系统都已经拥有的“标准 *nix”

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-09-13T10:52:44.777

其他方式：

```
# Gets the real path of a link, following all links
myreadlink() { [ ! -h "$1" ] && echo "$1" || (local link="$(expr "$(command ls -ld -- "$1")" : '.*-> \(.*\)$')"; cd $(dirname $1); myreadlink "$link" | sed "s|^\([^/].*\)\$|$(dirname $1)/\1|"); }

# Returns the absolute path to a command, maybe in $PATH (which) or not. If not found, returns the same
whereis() { echo $1 | sed "s|^\([^/].*/.*\)|$(pwd)/\1|;s|^\([^/]*\)$|$(which -- $1)|;s|^$|$1|"; } 

# Returns the realpath of a called command.
whereis_realpath() { local SCRIPT_PATH=$(whereis $1); myreadlink ${SCRIPT_PATH} | sed "s|^\([^/].*\)\$|$(dirname ${SCRIPT_PATH})/\1|"; } 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-11-14T07:47:17.713

将一些给定的解决方案放在一起，知道 readlink 在大多数系统上都可用，但需要不同的参数，这对我在 OSX 和 Debian 上很有效。我不确定 BSD 系统。也许条件只需要从 OSX`[[ $OSTYPE != darwin* ]]`中排除。`-f`

```
#!/bin/bash
MY_DIR=$( cd $(dirname $(readlink `[[ $OSTYPE == linux* ]] && echo "-f"` $0)) ; pwd -P)
echo "$MY_DIR" 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-01-30T03:57:48.270

以下是如何使用内联 Perl 脚本在 MacOS/Unix 中获取文件的实际路径：

```
FILE=$(perl -e "use Cwd qw(abs_path); print abs_path('$0')") 
```

同样，要获取符号链接文件的目录：

```
DIR=$(perl -e "use Cwd qw(abs_path); use File::Basename; print dirname(abs_path('$0'))") 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-08-11T11:17:23.803

常见的 shell 脚本通常必须找到它们的“主”目录，即使它们被作为符号链接调用也是如此。因此，脚本必须从 $0 中找到它们的“真实”位置。

```
cat `mvn` 
```

在我的系统上打印一个包含以下内容的脚本，这应该是您需要的一个很好的提示。

```
if [ -z "$M2_HOME" ] ; then
  ## resolve links - $0 may be a link to maven's home
  PRG="$0"

  # need this for relative symlinks
  while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
      PRG="$link"
    else
      PRG="`dirname "$PRG"`/$link"
    fi
  done

  saveddir=`pwd`

  M2_HOME=`dirname "$PRG"`/..

  # make it fully qualified
  M2_HOME=`cd "$M2_HOME" && pwd` 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-06-28T18:00:47.407

您的路径是目录，还是文件？如果是目录，很简单：

```
(cd "$DIR"; pwd -P) 
```

但是，如果它可能是一个文件，那么这将不起作用：

```
DIR=$(cd $(dirname "$FILE"); pwd -P); echo "${DIR}/$(readlink "$FILE")" 
```

因为符号链接可能会解析为相对路径或完整路径。

在脚本上，我需要找到真实路径，以便我可以引用配置或与其一起安装的其他脚本，我使用这个：

```
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
done 
```

您可以设置`SOURCE`为任何文件路径。基本上，只要路径是符号链接，它就会解析该符号链接。诀窍在于循环的最后一行。如果解析的符号链接是绝对的，它将使用它作为`SOURCE`. 但是，如果它是相对的，它会在前面加上`DIR`它，通过我第一次描述的简单技巧将它解析为一个真实的位置。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-04-10T14:52:57.620

```
function realpath {
    local r=$1; local t=$(readlink $r)
    while [ $t ]; do
        r=$(cd $(dirname $r) && cd $(dirname $t) && pwd -P)/$(basename $t)
        t=$(readlink $r)
    done
    echo $r
}

#example usage
SCRIPT_PARENT_DIR=$(dirname $(realpath "$0"))/.. 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-10-21T18:39:18.077

^(注意：我相信这是一个可靠的、便携的、现成的解决方案，正因为如此，它总是*很冗长*。)

下面是一个**完全兼容 POSIX 的脚本/函数**，因此它是**跨平台的**（也适用于 macOS，但从 10.12 (Sierra) 开始`readlink`仍不支持`-f`）-它仅使用[POSIX shell 语言功能](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#)和仅与 POSIX 兼容的实用程序调用.

它是GNU （的更严格版本）的**可移植实现`readlink -e`**`readlink -f`。

您可以**使用****、****和****中****的*****函数*****运行*脚本*`sh`**或获取函数：***`bash``ksh``zsh`***

 *例如，在脚本中，您可以按如下方式使用它来获取运行脚本的真实原始目录，并解析符号链接：

```
trueScriptDir=$(dirname -- "$(rreadlink "$0")") 
```

* * *

**`rreadlink`脚本/函数定义：**

^(代码改编自[这个答案](https://stackoverflow.com/a/1116890/45375)的感激之情。
我还在[这里](https://github.com/mklement0/rreadlink)`bash`创建了一个基于 - 的独立实用程序版本，如果您安装了 Node.js，您可以使用它进行安装。
`npm install rreadlink -g`)

```
#!/bin/sh

# SYNOPSIS
#   rreadlink <fileOrDirPath>
# DESCRIPTION
#   Resolves <fileOrDirPath> to its ultimate target, if it is a symlink, and
#   prints its canonical path. If it is not a symlink, its own canonical path
#   is printed.
#   A broken symlink causes an error that reports the non-existent target.
# LIMITATIONS
#   - Won't work with filenames with embedded newlines or filenames containing 
#     the string ' -> '.
# COMPATIBILITY
#   This is a fully POSIX-compliant implementation of what GNU readlink's
#    -e option does.
# EXAMPLE
#   In a shell script, use the following to get that script's true directory of origin:
#     trueScriptDir=$(dirname -- "$(rreadlink "$0")")
rreadlink() ( # Execute the function in a *subshell* to localize variables and the effect of `cd`.

  target=$1 fname= targetDir= CDPATH=

  # Try to make the execution environment as predictable as possible:
  # All commands below are invoked via `command`, so we must make sure that
  # `command` itself is not redefined as an alias or shell function.
  # (Note that command is too inconsistent across shells, so we don't use it.)
  # `command` is a *builtin* in bash, dash, ksh, zsh, and some platforms do not 
  # even have an external utility version of it (e.g, Ubuntu).
  # `command` bypasses aliases and shell functions and also finds builtins 
  # in bash, dash, and ksh. In zsh, option POSIX_BUILTINS must be turned on for
  # that to happen.
  { \unalias command; \unset -f command; } >/dev/null 2>&1
  [ -n "$ZSH_VERSION" ] && options[POSIX_BUILTINS]=on # make zsh find *builtins* with `command` too.

  while :; do # Resolve potential symlinks until the ultimate target is found.
      [ -L "$target" ] || [ -e "$target" ] || { command printf '%s\n' "ERROR: '$target' does not exist." >&2; return 1; }
      command cd "$(command dirname -- "$target")" # Change to target dir; necessary for correct resolution of target path.
      fname=$(command basename -- "$target") # Extract filename.
      [ "$fname" = '/' ] && fname='' # !! curiously, `basename /` returns '/'
      if [ -L "$fname" ]; then
        # Extract [next] target path, which may be defined
        # *relative* to the symlink's own directory.
        # Note: We parse `ls -l` output to find the symlink target
        #       which is the only POSIX-compliant, albeit somewhat fragile, way.
        target=$(command ls -l "$fname")
        target=${target#* -> }
        continue # Resolve [next] symlink target.
      fi
      break # Ultimate target reached.
  done
  targetDir=$(command pwd -P) # Get canonical dir. path
  # Output the ultimate target's canonical path.
  # Note that we manually resolve paths ending in /. and /.. to make sure we have a normalized path.
  if [ "$fname" = '.' ]; then
    command printf '%s\n' "${targetDir%/}"
  elif  [ "$fname" = '..' ]; then
    # Caveat: something like /var/.. will resolve to /private (assuming /var@ -> /private/var), i.e. the '..' is applied
    # AFTER canonicalization.
    command printf '%s\n' "$(command dirname -- "${targetDir}")"
  else
    command printf '%s\n' "${targetDir%/}/$fname"
  fi
)

rreadlink "$@" 
```

* * *

**安全性的切线：**

[jarno](https://stackoverflow.com/users/4414935/jarno)参考确保 builtin`command`不会被同名的别名或 shell 函数遮蔽的函数，在评论中询问：

> 如果`unalias`or`unset`和`[`被设置为别名或 shell 函数怎么办？

`rreadlink`确保其具有其原始含义的动机`command`是使用它绕过（良性）*便利*别名和函数，这些别名和函数通常用于隐藏交互式 shell 中的标准命令，例如重新定义`ls`以包含最喜欢的选项。

我认为可以肯定地说，除非您处理的是不受信任的恶意环境，否则不必担心`unalias`或`unset`- 或者，就此而言，`while`, `do`, ... - 被重新定义不是问题。

函数必须依赖*某些东西*才能具有其原始含义和行为 - 没有办法解决这个问题。
类似 POSIX 的 shell 允许重新定义内置函数甚至语言关键字，这*本质上*是一种安全风险（而且编写偏执的代码通常很困难）。

具体解决您的疑虑：

该功能依赖于`unalias`并`unset`具有其本来的含义。以改变其行为的方式将它们重新定义为*shell 函数*将是一个问题。重新定义为*别名*不一定是一个问题，因为*引用*（部分）命令名称（例如，`\unalias`）会绕过别名。

但是，引用*不是*shell*关键字*( `while`, `for`, `if`, `do`, ...) 的选项，虽然 shell 关键字确实优先于 shell*函数*，但 in`bash`和`zsh`别名具有最高优先级，因此要防止 shell 关键字重新定义，您必须`unalias`运行它们的名称（尽管在*非交互式* `bash`shell（例如脚本）中，别名默认情况下*不会*扩展 - 仅当`shopt -s expand_aliases`首先显式调用时）。

为了确保`unalias`- 作为内置 - 具有其原始含义，您必须首先使用`\unset`它，这需要`unset`具有其原始含义：

`unset`是一个 shell *builtin*，所以为了确保它被这样调用，你必须确保它本身没有被重新定义为一个*function*。虽然您可以通过引用绕过别名表单，但不能绕过 shell 函数表单 - catch 22。

因此，除非您可以依赖`unset`它的原始含义，否则据我所知，没有保证可以防御所有恶意重新定义。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-08-23T00:49:39.200

这是 Bash 中的符号链接解析器，无论链接是目录还是非目录，它都可以工作：

```
function readlinks {(
  set -o errexit -o nounset
  declare n=0 limit=1024 link="$1"

  # If it's a directory, just skip all this.
  if cd "$link" 2>/dev/null
  then
    pwd -P
    return 0
  fi

  # Resolve until we are out of links (or recurse too deep).
  while [[ -L $link ]] && [[ $n -lt $limit ]]
  do
    cd "$(dirname -- "$link")"
    n=$((n + 1))
    link="$(readlink -- "${link##*/}")"
  done
  cd "$(dirname -- "$link")"

  if [[ $n -ge $limit ]]
  then
    echo "Recursion limit ($limit) exceeded." >&2
    return 2
  fi

  printf '%s/%s\n' "$(pwd -P)" "${link##*/}"
)} 
```

请注意，所有的`cd`和`set`东西都发生在一个子shell中。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2020-02-19T21:01:22.317

如果不能使用 pwd（例如从不同位置调用脚本），请使用 realpath（带或不带 dirname）：

```
$(dirname $(realpath $PATH_TO_BE_RESOLVED)) 
```

通过（多个）符号链接调用或直接调用脚本时都有效 - 从任何位置。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-08-08T08:50:18.657

为了解决 Mac 不兼容问题，我想出了

```
echo `php -r "echo realpath('foo');"` 
```

不是很好但跨操作系统

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-08-29T02:41:42.760

试试这个：

```
cd $(dirname $([ -L $0 ] && readlink -f $0 || echo $0)) 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-12-24T21:06:54.627

由于这些年来我遇到过很多次，而这一次我需要一个可以在 OSX 和 linux 上使用的纯 bash 便携版本，我继续写了一个：

活版在这里：

[https://github.com/keen99/shell-functions/tree/master/resolve_path](https://github.com/keen99/shell-functions/tree/master/resolve_path)

但为了如此，这是当前版本（我觉得它已经过很好的测试......但我愿意接受反馈！）

让它适用于普通的 bourne shell (sh) 可能并不难，但我没有尝试......我太喜欢 $FUNCNAME 了。:)

```
#!/bin/bash

resolve_path() {
    #I'm bash only, please!
    # usage:  resolve_path <a file or directory> 
    # follows symlinks and relative paths, returns a full real path
    #
    local owd="$PWD"
    #echo "$FUNCNAME for $1" >&2
    local opath="$1"
    local npath=""
    local obase=$(basename "$opath")
    local odir=$(dirname "$opath")
    if [[ -L "$opath" ]]
    then
    #it's a link.
    #file or directory, we want to cd into it's dir
        cd $odir
    #then extract where the link points.
        npath=$(readlink "$obase")
        #have to -L BEFORE we -f, because -f includes -L :(
        if [[ -L $npath ]]
         then
        #the link points to another symlink, so go follow that.
            resolve_path "$npath"
            #and finish out early, we're done.
            return $?
            #done
        elif [[ -f $npath ]]
        #the link points to a file.
         then
            #get the dir for the new file
            nbase=$(basename $npath)
            npath=$(dirname $npath)
            cd "$npath"
            ndir=$(pwd -P)
            retval=0
            #done
        elif [[ -d $npath ]]
         then
        #the link points to a directory.
            cd "$npath"
            ndir=$(pwd -P)
            retval=0
            #done
        else
            echo "$FUNCNAME: ERROR: unknown condition inside link!!" >&2
            echo "opath [[ $opath ]]" >&2
            echo "npath [[ $npath ]]" >&2
            return 1
        fi
    else
        if ! [[ -e "$opath" ]]
         then
            echo "$FUNCNAME: $opath: No such file or directory" >&2
            return 1
            #and break early
        elif [[ -d "$opath" ]]
         then 
            cd "$opath"
            ndir=$(pwd -P)
            retval=0
            #done
        elif [[ -f "$opath" ]]
         then
            cd $odir
            ndir=$(pwd -P)
            nbase=$(basename "$opath")
            retval=0
            #done
        else
            echo "$FUNCNAME: ERROR: unknown condition outside link!!" >&2
            echo "opath [[ $opath ]]" >&2
            return 1
        fi
    fi
    #now assemble our output
    echo -n "$ndir"
    if [[ "x${nbase:=}" != "x" ]]
     then
        echo "/$nbase"
    else 
        echo
    fi
    #now return to where we were
    cd "$owd"
    return $retval
} 
```

这是一个经典的例子，感谢 brew：

```
%% ls -l `which mvn`
lrwxr-xr-x  1 draistrick  502  29 Dec 17 10:50 /usr/local/bin/mvn@ -> ../Cellar/maven/3.2.3/bin/mvn 
```

使用此函数，它将返回 -real- 路径：

```
%% cat test.sh
#!/bin/bash
. resolve_path.inc
echo
echo "relative symlinked path:"
which mvn
echo
echo "and the real path:"
resolve_path `which mvn`

%% test.sh

relative symlinked path:
/usr/local/bin/mvn

and the real path:
/usr/local/Cellar/maven/3.2.3/libexec/bin/mvn 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-01-14T10:32:08.340

在这里，我提出了一个我认为是跨平台（至少是 Linux 和 macOS）的解决方案，以解决目前对我来说效果很好的答案。

```
crosspath()
{
    local ref="$1"
    if [ -x "$(which realpath)" ]; then
        path="$(realpath "$ref")"
    else
        path="$(readlink -f "$ref" 2> /dev/null)"
        if [ $? -gt 0 ]; then
            if [ -x "$(which readlink)" ]; then
                if [ ! -z "$(readlink "$ref")" ]; then
                    ref="$(readlink "$ref")"
                fi
            else
                echo "realpath and readlink not available. The following may not be the final path." 1>&2
            fi
            if [ -d "$ref" ]; then
                path="$(cd "$ref"; pwd -P)"
            else
                path="$(cd $(dirname "$ref"); pwd -P)/$(basename "$ref")"
            fi
        fi
    fi
    echo "$path"
} 
```

这是一个 macOS（仅？）解决方案。可能更适合原始问题。

```
mac_realpath()
{
    local ref="$1"
    if [[ ! -z "$(readlink "$ref")" ]]; then
        ref="$(readlink "$1")"
    fi
    if [[ -d "$ref" ]]; then
        echo "$(cd "$ref"; pwd -P)"
    else
        echo "$(cd $(dirname "$ref"); pwd -P)/$(basename "$ref")"
    fi
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-09-03T14:01:43.880

我在这里 Bash 的回答[：如何获得符号链接的真实路径？](https://stackoverflow.com/questions/29789204/bash-how-to-get-real-path-of-a-symlink/55254754#55254754)

但简而言之，在脚本中非常方便：

```
script_home=$( dirname $(realpath "$0") )
echo Original script home: $script_home 
```

这些是 GNU coreutils 的一部分，适用于 Linux 系统。

为了测试一切，我们将符号链接放入 /home/test2/，修改一些额外的东西并从根目录运行/调用它：

```
/$ /home/test2/symlink
/home/test
Original script home: /home/test 
```

在哪里

```
Original script is: /home/test/realscript.sh
Called script is: /home/test2/symlink 
```

# flash - 构建 Flash 视频播放器的最佳实践

> ID：7674
> 
> 赞同：5
> 
> 时间：2008-08-11T11:17:36.547
> 
> 标签：flash, video

我们有一个我维护的基于 Flash 的定制视频播放器，它需要支持前置广告，理想情况下需要支持渐进式视频播放和流式传输，具体取决于服务器切换。

我一直在使用 flvPlayback 组件，但发现自己有点超出我的深度。是否有任何好的教程或资源来了解 netstream 和 flvPlayback 之间的区别？或者是另一部分的一部分？谷歌搜索没有成功。

对于前贴片广告，我们可能会使用 DART In-Stream，这是我觉得我正在失去对构建这个东西的最佳方式的控制的部分原因。

任何有关最佳实践的帮助或最受赞赏的链接 - ta！

编辑 - 更新：我手工编写了一个播放器，并且或多或少地完成了它需要做的所有事情，但最终我们确实在大约六个月后跨所有网络资产迁移到了 JW Player。它非常可靠且得到很好的支持，它与 DART 系统很好地集成在一起，设计人员发现它很容易换肤。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-12T15:44:27.193

我肯定会看看 JW Flash Media Player：

[http://www.jeroenwijering.com/?item=JW_FLV_Player](http://www.jeroenwijering.com/?item=JW_FLV_Player)

它是开源的，我发现源代码非常干净且易于理解，它还支持播放列表。我不知道 DART In-Stream 的东西，但也许你可以“创造性地使用”播放列表功能来实现这一点？

源代码可在此处获得：

[http://code.jeroenwijering.com/trac/](http://code.jeroenwijering.com/trac/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-28T18:58:05.390

我已经使用 FLVPlayBack 组件有一段时间了，虽然它有一些怪癖，但我发现它非常通用，无需编写大量代码。我发现的唯一大缺点是，如果您尝试流式传输不存在的文件，则播放状态将保持“正在加载”并且永远不会解析 - 那时，您无法加载其他任何内容，它将永远保持加载状态。

尽管它应该可以很好地处理这些内容，但听起来您正在做的事情-任何默认控制栏都将处理您的渐进式或流式视频的状态，并且它具有一些很酷的隐藏式字幕功能可以启动。

至于文档 - Adob​​e 的 LiveDocs 真的很有帮助：

[http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/video/FLVPlayback.html](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/video/FLVPlayback.html)

虽然不能谈论 DART 的东西 - 从来没有处理过它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T13:43:34.583

我不太喜欢 flvPlayback 组件，它很难在实现方面进行明智的处理，而且很难很好地处理皮肤，而且它也很臃肿。所以我会选择使用上面迈克尔推荐的 JW Flash Media Player，或者完全使用我自己的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T12:43:18.067

如果你有兴趣编写自己的视频播放器，你应该拿起下面的书；学习 ActionScript 3 [http://www.learningactionscript3.com/](http://www.learningactionscript3.com/)。它将使您对 AS3 有一个很好的了解，并且还有一章专门用于创建您自己的基本 Flash 播放器，然后您可以在此基础上进行构建。

# sql-server - Replicating between SQL Server 2005 and SQL Server Compact Edition

> ID：7676
> 
> 赞同：2
> 
> 时间：2008-08-11T11:23:05.490
> 
> 标签：sql-server

Can it be done and if so, how?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T12:38:43.530

You can also check out [Sync Services for Sql Server and Compact edition](http://web.archive.org/web/20101217051859/http://keithelder.net/blog/archive/2007/09/23/Sync-Services-for-SQL-Server-Compact-Edition-3.5-in-Visual.aspx). The benefit of Sync Services is that you don't need a replication server or IIS and you can also sync between compact edition databases. This method involves writing a fair bit more code and is fairly involved, but I'd recommend looking into it as a lightweight service.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T11:59:47.553

You can use Merge Replication. Theres a tutorial here [SQL Server Compact 3.5 How-to Tutorials](http://msdn.microsoft.com/en-us/sqlserver/bb219480.aspx) (Number 5).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T01:22:41.157

当然复制是可能的，如果你不怕弄脏你的手，[同步服务也是可能的。](http://msdn.microsoft.com/sync)这取决于您需要的详细信息：

*   有时连接的应用程序需要只读缓存：同步服务
*   有时连接的应用程序希望具有部分或全部更新能力：同步服务
*   具有多个需要对数据进行读/写访问的工作站的远程站点：如果您可以获得足够稳定的安全网络连接，则进行复制，否则请根据此处的示例查看扩展 Syn 服务以使用 SQL Express（或完整的 SQL Server）：[同步使用 SQL Express](http://blogs.msdn.com/sync/archive/2008/06/24/sample-sql-express-client-synchronization-using-sync-services-for-ado-net.aspx)

如果您只想要一个 SQL CE 数据库并且您正在使用 SQL 2008 服务器，那么 Visual Studio 2008 SP1 中的向导将为您完成所有工作，如果您想要双向，您只需添加 1 行代码支持。如果您无法升级，那么使用 SQL 2005 将需要更多的工作，并且只有在您至少拥有 SP2 时才可靠。

我正在进行一个项目，该项目需要多个站点在每个站点有时可能会失去与总部的连接的环境中拥有一个数据子集，我们已经设法让同步服务与 SQL 一起工作总部的 2008 和每个站点的 SQL Express 2008 具有完整的更改跟踪（2008 功能），并且运行良好。它确实需要合理数量的代码（C# 和 SQL），因此我们使用了一些非常智能的模板来提供帮助。意识到。

也许你可以用更多细节来完善你的问题？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T16:30:34.870

由于预算限制，我认为它必须采用 beta 测试者的方法，我尝试按照指南进行操作，但似乎无法使其正常工作。在我花时间让它工作之前，我只是确认一下，可以在 SqlServer 2005 和 Compact Edition 之间进行复制吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-12T00:04:39.307

> 我只是确认一下，SqlServer 2005 和 Compact Edition 之间的复制可以做到吗？

是的，它绝对可以使用合并复制或同步服务来完成

# java - 测试序列化编码

> ID：7681
> 
> 赞同：9
> 
> 时间：2008-08-11T11:33:01.930
> 
> 标签：java, xml, string, serialization, encoding

验证/测试文本字符串是否被序列化为具有特定编码的字节数组的最佳方法是什么？

就我而言，我想验证 XML 结构是否被序列化为具有可变字符长度的 UTF-8 编码的字节数组。例如，我目前的丑陋程序是在序列化之前将一个已知需要两个字节的字符注入结构中，然后用 ASCII 字符替换两个字节的字符并比较序列化的数组长度。这应该产生两个序列化数组，其中包含两字节字符的数组的长度应该是 +1。

另外，如果该解决方案对 Java 来说很优雅。我想不出任何优雅的方式来寻找字节数组中的字节序列。（可用于在 UTF-8 中寻找表示所需字符表示的已知字节序列。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-11T11:46:40.030

也许您可以使用已知编码反序列化字节数组，并确保 (a) 它不会引发任何异常，以及 (b) 反序列化为原始字符串。从您对场景的描述看来，您可能没有现成的原始字符串。有没有办法创造它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T12:05:03.427

那挺好的。没错，我没有原始字符串，因为我正在测试一个将 XML 文档创建为字节数组的模块。我没有考虑反序列化为具有预期编码的字符串。那会成功的。

# algorithm - Merge Sort a Linked List

> ID：7685
> 
> 赞同：53
> 
> 时间：2008-08-11T11:43:27.230
> 
> 标签：algorithm, sorting, linked-list, mergesort

I was recently brushing up on some fundamentals and found merge sorting a linked list to be a pretty good challenge. If you have a good implementation then show it off here.

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2011-11-23T06:46:38.353

想知道为什么它应该是一个很大的挑战，正如这里所说，这里是一个简单的 Java 实现，没有任何“聪明的技巧”。

```
//The main function
public static Node merge_sort(Node head) 
{
    if(head == null || head.next == null) 
        return head;

    Node middle = getMiddle(head);      //get the middle of the list
    Node left_head = head;
    Node right_head = middle.next; 
    middle.next = null;             //split the list into two halfs

    return merge(merge_sort(left_head), merge_sort(right_head));  //recurse on that
}

//Merge subroutine to merge two sorted lists
public static Node merge(Node a, Node b)
{
    Node dummyHead = new Node();
    for(Node current  = dummyHead; a != null && b != null; current = current.next;)
    {
        if(a.data <= b.data) 
        {
            current.next = a; 
            a = a.next; 
        }
        else
        { 
            current.next = b;
            b = b.next; 
        }

    }
    dummyHead.next = (a == null) ? b : a;
    return dummyHead.next;
}

//Finding the middle element of the list for splitting
public static Node getMiddle(Node head)
{
    if(head == null) 
        return head;

    Node slow = head, fast = head;

    while(fast.next != null && fast.next.next != null)
    {
        slow = slow.next;
        fast = fast.next.next;
    }
    return slow;
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-06-13T14:29:29.877

一个更简单/更清晰的实现可能是递归实现，从中 NLog(N) 执行时间更加清晰。

```
typedef struct _aList {
    struct _aList* next;
    struct _aList* prev; // Optional.
    // some data
} aList;

aList* merge_sort_list_recursive(aList *list,int (*compare)(aList *one,aList *two))
{
    // Trivial case.
    if (!list || !list->next)
        return list;

    aList *right = list,
          *temp  = list,
          *last  = list,
          *result = 0,
          *next   = 0,
          *tail   = 0;

    // Find halfway through the list (by running two pointers, one at twice the speed of the other).
    while (temp && temp->next)
    {
        last = right;
        right = right->next;
        temp = temp->next->next;
    }

    // Break the list in two. (prev pointers are broken here, but we fix later)
    last->next = 0;

    // Recurse on the two smaller lists:
    list = merge_sort_list_recursive(list, compare);
    right = merge_sort_list_recursive(right, compare);

    // Merge:
    while (list || right)
    {
        // Take from empty lists, or compare:
        if (!right) {
            next = list;
            list = list->next;
        } else if (!list) {
            next = right;
            right = right->next;
        } else if (compare(list, right) < 0) {
            next = list;
            list = list->next;
        } else {
            next = right;
            right = right->next;
        }
        if (!result) {
            result=next;
        } else {
            tail->next=next;
        }
        next->prev = tail;  // Optional.
        tail = next;
    }
    return result;
} 
```

注意：这对递归有 Log(N) 存储要求。性能应该与我发布的其他策略大致相当。这里有一个潜在的优化，通过运行合并循环 while (list && right)，并简单地附加剩余的列表（因为我们并不真正关心列表的结尾；知道它们已合并就足够了）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-06-13T13:53:46.487

很大程度上基于以下优秀代码： http: [//www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html](http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html)

稍微修剪一下，整理一下：

```
 typedef struct _aList {
    struct _aList* next;
    struct _aList* prev; // Optional.
       // some data
} aList;

aList *merge_sort_list(aList *list,int (*compare)(aList *one,aList *two))
{
    int listSize=1,numMerges,leftSize,rightSize;
    aList *tail,*left,*right,*next;
    if (!list || !list->next) return list;  // Trivial case

    do { // For each power of two<=list length
        numMerges=0,left=list;tail=list=0; // Start at the start

        while (left) { // Do this list_len/listSize times:
            numMerges++,right=left,leftSize=0,rightSize=listSize;
            // Cut list into two halves (but don't overrun)
            while (right && leftSize<listSize) leftSize++,right=right->next;
            // Run through the lists appending onto what we have so far.
            while (leftSize>0 || (rightSize>0 && right)) {
                // Left empty, take right OR Right empty, take left, OR compare.
                if (!leftSize)                  {next=right;right=right->next;rightSize--;}
                else if (!rightSize || !right)  {next=left;left=left->next;leftSize--;}
                else if (compare(left,right)<0) {next=left;left=left->next;leftSize--;}
                else                            {next=right;right=right->next;rightSize--;}
                // Update pointers to keep track of where we are:
                if (tail) tail->next=next;  else list=next;
                // Sort prev pointer
                next->prev=tail; // Optional.
                tail=next;          
            }
            // Right is now AFTER the list we just sorted, so start the next sort there.
            left=right;
        }
        // Terminate the list, double the list-sort size.
        tail->next=0,listSize<<=1;
    } while (numMerges>1); // If we only did one merge, then we just sorted the whole list.
    return list;
} 
```

注意：这是 O(NLog(N)) 保证的，并且使用 O(1) 资源（没有递归，没有堆栈，什么都没有）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-11T13:57:59.063

One interesting way is to maintain a stack, and only merge if the list on the stack has the same number of elements, and otherwise push the list, until you run out of elements in the incoming list, and then merge up the stack.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-27T03:02:15.093

我一直痴迷于优化这个算法的混乱，下面是我最终得出的结论。Internet 和 StackOverflow 上的许多其他代码都非常糟糕。有些人试图获得列表的中间点，进行递归，对剩余节点进行多个循环，维护大量事物的数量 - 所有这些都是不必要的。MergeSort 自然适合链表，算法可以很漂亮和紧凑，但要达到那种状态并非易事。

据我所知，下面的代码维护最少数量的变量和算法所需的最少逻辑步骤（即不使代码不可维护/不可读）。但是，我没有尝试最小化 LOC 并保留尽可能多的空白以保持可读性。我已经通过相当严格的单元测试测试了这段代码。

请注意，此答案结合了其他答案[https://stackoverflow.com/a/3032462/207661](https://stackoverflow.com/a/3032462/207661)中的一些技术。虽然代码在 C# 中，但转换为 C++、Java 等应该很简单。

```
SingleListNode<T> SortLinkedList<T>(SingleListNode<T> head) where T : IComparable<T>
{
    int blockSize = 1, blockCount;
    do
    {
        //Maintain two lists pointing to two blocks, left and right
        SingleListNode<T> left = head, right = head, tail = null;
        head = null; //Start a new list
        blockCount = 0;

        //Walk through entire list in blocks of size blockCount
        while (left != null)
        {
            blockCount++;

            //Advance right to start of next block, measure size of left list while doing so
            int leftSize = 0, rightSize = blockSize;
            for (;leftSize < blockSize && right != null; ++leftSize)
                right = right.Next;

            //Merge two list until their individual ends
            bool leftEmpty = leftSize == 0, rightEmpty = rightSize == 0 || right == null;
            while (!leftEmpty || !rightEmpty)
            {
                SingleListNode<T> smaller;
                //Using <= instead of < gives us sort stability
                if (rightEmpty || (!leftEmpty && left.Value.CompareTo(right.Value) <= 0))
                {
                    smaller = left; left = left.Next; --leftSize;
                    leftEmpty = leftSize == 0;
                }
                else
                {
                    smaller = right; right = right.Next; --rightSize;
                    rightEmpty = rightSize == 0 || right == null;
                }

                //Update new list
                if (tail != null)
                    tail.Next = smaller;
                else
                    head = smaller;
                tail = smaller;
            }

            //right now points to next block for left
            left = right;
        }

        //terminate new list, take care of case when input list is null
        if (tail != null)
            tail.Next = null;

        //Lg n iterations
        blockSize <<= 1;

    } while (blockCount > 1);

    return head;
} 
```

**兴趣点**

*   对于需要的 1 列表的空列表等情况，没有特殊处理。这些案例“有效”。
*   许多“标准”算法文本有两个循环来遍历剩余元素，以处理一个列表比另一个列表短的情况。上面的代码消除了对它的需要。
*   我们确保排序是稳定的
*   作为热点的内部while循环平均每次迭代评估3个表达式，我认为这是最低限度的。

更新：@ideasman42 已将[上述代码翻译为 C/C++](https://gist.github.com/ideasman42/5921b0edfc6aa41a9ce0)，并附有修复注释和更多改进的建议。上面的代码现在是最新的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-04T09:22:26.480

最简单的是来自 [Gonnet + Baeza Yates Handbook of Algorithms](http://www.dcc.uchile.cl/~rbaeza/handbook/algs/4/421.sort.p.html)。你用你想要的排序元素的数量来调用它，它递归地被二等分，直到它达到一个大小为一列表的请求，然后你只需剥离原始列表的前面。这些都被合并成一个完整大小的排序列表。

[请注意，第一篇文章中基于堆栈的很酷的称为 Online Mergesort，它在 Knuth Vol 3 的练习中得到了最少的提及]

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-07-15T10:06:25.030

这是一个替代的递归版本。这不需要沿着列表进行拆分：我们提供一个指向头元素（不是排序的一部分）的指针和一个长度，递归函数返回一个指向排序列表末尾的指针。

```
element* mergesort(element *head,long lengtho)
{ 
  long count1=(lengtho/2), count2=(lengtho-count1);
  element *next1,*next2,*tail1,*tail2,*tail;
  if (lengtho<=1) return head->next;  /* Trivial case. */

  tail1 = mergesort(head,count1);
  tail2 = mergesort(tail1,count2);
  tail=head;
  next1 = head->next;
  next2 = tail1->next;
  tail1->next = tail2->next; /* in case this ends up as the tail */
  while (1) {
    if(cmp(next1,next2)<=0) {
      tail->next=next1; tail=next1;
      if(--count1==0) { tail->next=next2; return tail2; }
      next1=next1->next;
    } else {
      tail->next=next2; tail=next2;
      if(--count2==0) { tail->next=next1; return tail1; }
      next2=next2->next;
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-11-24T17:17:07.087

我决定在这里测试这些示例，以及另一种方法，最初由 Jonathan Cunningham 在 Pop-11 中编写。我用 C# 编写了所有方法，并与一系列不同的列表大小进行了比较。我比较了 Raja R Harinath 的 Mono eglib 方法、Shital Shah 的 C# 代码、Jayadev 的 Java 方法、David Gamble 的递归和非递归版本、Ed Wynn 的第一个 C 代码（这与我的示例数据集崩溃了，我没有调试）和坎宁安的版本。完整代码在这里：[https](https://gist.github.com/314e572808f29adb0e41.git) ://gist.github.com/314e572808f29adb0e41.git 。

Mono eglib 基于与 Cunningham 类似的想法并且具有相当的速度，除非列表恰好已经排序，在这种情况下，Cunningham 的方法要快得多（如果它部分排序，eglib 会稍微快一些）。eglib 代码使用一个固定的表来保存合并排序递归，而 Cunningham 的方法通过使用递增级别的递归来工作 - 所以它开始使用不递归，然后是 1-deep recursion，然后是 2-deep recursion 等等，根据进行排序需要多少步骤。我发现 Cunningham 代码更容易理解，并且没有猜测要制作多大的递归表，所以它得到了我的投票。我从这个页面尝试的其他方法慢了两倍或更多。

这是 Pop-11 排序的 C# 端口：

```
/// <summary>
/// Sort a linked list in place. Returns the sorted list.
/// Originally by Jonathan Cunningham in Pop-11, May 1981.
/// Ported to C# by Jon Meyer.
/// </summary>
public class ListSorter<T> where T : IComparable<T> {
    SingleListNode<T> workNode = new SingleListNode<T>(default(T));
    SingleListNode<T> list;

    /// <summary>
    /// Sorts a linked list. Returns the sorted list.
    /// </summary>
    public SingleListNode<T> Sort(SingleListNode<T> head) {
        if (head == null) throw new NullReferenceException("head");
        list = head;

        var run = GetRun(); // get first run
        // As we progress, we increase the recursion depth. 
        var n = 1;
        while (list != null) {
            var run2 = GetSequence(n);
            run = Merge(run, run2);
            n++;
        }
        return run;
    }

    // Get the longest run of ordered elements from list.
    // The run is returned, and list is updated to point to the
    // first out-of-order element.
    SingleListNode<T> GetRun() {
        var run = list; // the return result is the original list
        var prevNode = list;
        var prevItem = list.Value;

        list = list.Next; // advance to the next item
        while (list != null) {
            var comp = prevItem.CompareTo(list.Value);
            if (comp > 0) {
                // reached end of sequence
                prevNode.Next = null;
                break;
            }
            prevItem = list.Value;
            prevNode = list;
            list = list.Next;
        }
        return run;
    }

    // Generates a sequence of Merge and GetRun() operations.
    // If n is 1, returns GetRun()
    // If n is 2, returns Merge(GetRun(), GetRun())
    // If n is 3, returns Merge(Merge(GetRun(), GetRun()),
    //                          Merge(GetRun(), GetRun()))
    // and so on.
    SingleListNode<T> GetSequence(int n) {
        if (n < 2) {
            return GetRun();
        } else {
            n--;
            var run1 = GetSequence(n);
            if (list == null) return run1;
            var run2 = GetSequence(n);
            return Merge(run1, run2);
        }
    }

    // Given two ordered lists this returns a list that is the
    // result of merging the two lists in-place (modifying the pairs
    // in list1 and list2).
    SingleListNode<T> Merge(SingleListNode<T> list1, SingleListNode<T> list2) {
        // we reuse a single work node to hold the result.
        // Simplifies the number of test cases in the code below.
        var prevNode = workNode;
        while (true) {
            if (list1.Value.CompareTo(list2.Value) <= 0) {
                // list1 goes first
                prevNode.Next = list1;
                prevNode = list1;
                if ((list1 = list1.Next) == null) {
                    // reached end of list1 - join list2 to prevNode
                    prevNode.Next = list2;
                    break;
                }
            } else {        // same but for list2
                prevNode.Next = list2;
                prevNode = list2;
                if ((list2 = list2.Next) == null) {
                    prevNode.Next = list1;
                    break;
                }
            }
        }

        // the result is in the back of the workNode
        return workNode.Next;
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-07-14T19:15:54.240

这是我对 Knuth 的“列表合并排序”的实现（来自 TAOCP 第 3 卷的算法 5.2.4L，第 2 版）。我会在最后添加一些评论，但这里是一个摘要：

在随机输入上，它的运行速度比 Simon Tatham 的代码快一点（参见 Dave Gamble 的非递归答案，带有链接），但比 Dave Gamble 的递归代码慢一点。这比任何一个都更难理解。至少在我的实现中，它要求每个元素都有两个指向元素的指针。（另一种方法是一个指针和一个布尔标志。）因此，这可能不是一种有用的方法。然而，一个独特的点是，如果输入有很长的一段已经排序，它会运行得非常快。

```
element *knuthsort(element *list)
{ /* This is my attempt at implementing Knuth's Algorithm 5.2.4L "List merge sort"
     from Vol.3 of TAOCP, 2nd ed. */
  element *p, *pnext, *q, *qnext, head1, head2, *s, *t;
  if(!list) return NULL;

L1: /* This is the clever L1 from exercise 12, p.167, solution p.647\. */
  head1.next=list;
  t=&head2;
  for(p=list, pnext=p->next; pnext; p=pnext, pnext=p->next) {
    if( cmp(p,pnext) > 0 ) { t->next=NULL; t->spare=pnext; t=p; }
  }
  t->next=NULL; t->spare=NULL; p->spare=NULL;
  head2.next=head2.spare;

L2: /* begin a new pass: */
  t=&head2;
  q=t->next;
  if(!q) return head1.next;
  s=&head1;
  p=s->next;

L3: /* compare: */
  if( cmp(p,q) > 0 ) goto L6;
L4: /* add p onto the current end, s: */
  if(s->next) s->next=p; else s->spare=p;
  s=p;
  if(p->next) { p=p->next; goto L3; } 
  else p=p->spare;
L5: /* complete the sublist by adding q and all its successors: */
  s->next=q; s=t;
  for(qnext=q->next; qnext; q=qnext, qnext=q->next);
  t=q; q=q->spare;
  goto L8;
L6: /* add q onto the current end, s: */
  if(s->next) s->next=q; else s->spare=q;
  s=q;
  if(q->next) { q=q->next; goto L3; } 
  else q=q->spare;
L7: /* complete the sublist by adding p and all its successors: */
  s->next=p;
  s=t;
  for(pnext=p->next; pnext; p=pnext, pnext=p->next);
  t=p; p=p->spare;
L8: /* is this end of the pass? */
  if(q) goto L3;
  if(s->next) s->next=p; else s->spare=p;
  t->next=NULL; t->spare=NULL;
  goto L2;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-08-15T05:34:58.650

[mono eglib](https://raw.github.com/mono/mono/3baee55f958f6695d812ade649a407c2e920c19e/eglib/src/sort.frag.h)中有一个非递归链表合并排序。

基本思想是各种合并的控制循环平行于二进制整数的按位递增。有*O(n)*次合并将*n 个*节点“插入”到合并树中，这些合并的等级对应于递增的二进制数字。使用这个类比，只有合并树的*O(log n)*个节点需要物化到一个临时保存数组中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-11-29T20:47:50.073

链表的非递归合并排序的另一个示例，其中函数不是类的一部分。此示例代码和 HP / Microsoft`std::list::sort`都使用相同的基本算法。自下而上、非递归、合并排序，它使用一个小的（26 到 32）指针数组，指向列表的第一个节点，其中`array[i]`0 或指向大小为 2 的 i 次幂的列表。在我的系统 Intel 2600K 3.4ghz 上，它可以在大约 1 秒内将 400 万个具有 32 位无符号整数的节点排序为数据。

```
NODE * MergeLists(NODE *, NODE *); /* prototype */

/* sort a list using array of pointers to list       */
/* aList[i] == NULL or ptr to list with 2^i nodes    */

#define NUMLISTS 32             /* number of lists */
NODE * SortList(NODE *pList)
{
NODE * aList[NUMLISTS];         /* array of lists */
NODE * pNode;
NODE * pNext;
int i;
    if(pList == NULL)           /* check for empty list */
        return NULL;
    for(i = 0; i < NUMLISTS; i++)   /* init array */
        aList[i] = NULL;
    pNode = pList;              /* merge nodes into array */
    while(pNode != NULL){
        pNext = pNode->next;
        pNode->next = NULL;
        for(i = 0; (i < NUMLISTS) && (aList[i] != NULL); i++){
            pNode = MergeLists(aList[i], pNode);
            aList[i] = NULL;
        }
        if(i == NUMLISTS)   /* don't go beyond end of array */
            i--;
        aList[i] = pNode;
        pNode = pNext;
    }
    pNode = NULL;           /* merge array into one list */
    for(i = 0; i < NUMLISTS; i++)
        pNode = MergeLists(aList[i], pNode);
    return pNode;
}

/* merge two already sorted lists                    */
/* compare uses pSrc2 < pSrc1 to follow the STL rule */
/*   of only using < and not <=                      */
NODE * MergeLists(NODE *pSrc1, NODE *pSrc2)
{
NODE *pDst = NULL;          /* destination head ptr */
NODE **ppDst = &pDst;       /* ptr to head or prev->next */
    if(pSrc1 == NULL)
        return pSrc2;
    if(pSrc2 == NULL)
        return pSrc1;
    while(1){
        if(pSrc2->data < pSrc1->data){  /* if src2 < src1 */
            *ppDst = pSrc2;
            pSrc2 = *(ppDst = &(pSrc2->next));
            if(pSrc2 == NULL){
                *ppDst = pSrc1;
                break;
            }
        } else {                        /* src1 <= src2 */
            *ppDst = pSrc1;
            pSrc1 = *(ppDst = &(pSrc1->next));
            if(pSrc1 == NULL){
                *ppDst = pSrc2;
                break;
            }
        }
    }
    return pDst;
} 
```

* * *

Visual Studio 2015 更改`std::list::sort`为基于迭代器而不是列表，并且还更改为自上而下的合并排序，这需要扫描的开销。我最初认为需要切换到自上而下才能与迭代器一起使用，但是当再次询问时，我对此进行了调查并确定不需要切换到较慢的自上而下方法，并且可以使用自下而上实现相同的基于迭代器的逻辑。此链接中的答案解释了这一点，并提供了一个独立的示例以及`std::list::sort()`包含文件“列表”中 VS2019 的替代品。

[`std::list<>::sort()` - 为什么突然切换到自上而下的策略？](https://stackoverflow.com/questions/40622430/stdlistsort-why-the-sudden-switch-to-top-down-strategy/40629882#40629882)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-04T09:06:14.603

一个经过测试的工作`C++`版本的单链表，**基于最高投票的答案**。

**单链表.h：**

```
#pragma once
#include <stdexcept>
#include <iostream>
#include <initializer_list>
namespace ythlearn{
    template<typename T>
    class Linkedlist{
    public:
        class Node{
        public:
            Node* next;
            T elem;
        };
        Node head;
        int _size;
    public:
        Linkedlist(){
            head.next = nullptr;            
            _size = 0;
        }

        Linkedlist(std::initializer_list<T> init_list){
            head.next = nullptr;            
            _size = 0;
            for(auto s = init_list.begin(); s!=init_list.end(); s++){
                push_left(*s);
            }
        }

        int size(){
            return _size;
        }

        bool isEmpty(){
            return size() == 0;
        }

        bool isSorted(){
            Node* n_ptr = head.next;
            while(n_ptr->next != nullptr){
                if(n_ptr->elem > n_ptr->next->elem)
                    return false;
                n_ptr = n_ptr->next;
            }
            return true;
        }

        Linkedlist& push_left(T elem){
            Node* n = new Node;
            n->elem = elem;
            n->next = head.next;
            head.next = n;
            ++_size;
            return *this;
        }

        void print(){
                Node* loopPtr = head.next;
                while(loopPtr != nullptr){
                    std::cout << loopPtr->elem << " ";
                    loopPtr = loopPtr->next;
                }
                std::cout << std::endl;
        }

        void call_merge(){
            head.next = merge_sort(head.next);
        }

        Node* merge_sort(Node* n){
            if(n == nullptr || n->next == nullptr)
                return n;
            Node* middle = getMiddle(n);
            Node* left_head = n;
            Node* right_head = middle->next;
            middle->next = nullptr;
            return merge(merge_sort(left_head), merge_sort(right_head));
        }

        Node* getMiddle(Node* n){
            if(n == nullptr)
                return n;
            Node* slow, *fast;
            slow = fast = n;
            while(fast->next != nullptr && fast->next->next != nullptr){
                slow = slow->next;
                fast = fast->next->next;
            }
            return slow;
        }

        Node* merge(Node* a, Node* b){
            Node dummyHead;
            Node* current = &dummyHead;
            while(a != nullptr && b != nullptr){
                if(a->elem < b->elem){
                    current->next = a;
                    a = a->next;
                }else{
                    current->next = b;
                    b = b->next;
                }
                current = current->next;
            }
            current->next = (a == nullptr) ? b : a;
            return dummyHead.next;
        }

        Linkedlist(const Linkedlist&) = delete;
        Linkedlist& operator=(const Linkedlist&) const = delete;
        ~Linkedlist(){
            Node* node_to_delete;
            Node* ptr = head.next;
            while(ptr != nullptr){
                node_to_delete = ptr;
                ptr = ptr->next;
                delete node_to_delete;
            }

        }

    };
} 
```

**主.cpp：**

```
#include <iostream>
#include <cassert>
#include "singlelinkedlist.h"
using namespace std;
using namespace ythlearn;

int main(){
    Linkedlist<int> l = {3,6,-5,222,495,-129,0};
    l.print();
    l.call_merge();
    l.print();
    assert(l.isSorted());
    return 0;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-05-21T14:42:56.170

**最简单的Java实现：**

> 时间复杂度：O(nLogn) n = 节点数。链表的每次迭代都会使已排序的较小链表的大小加倍。例如，在第一次迭代之后，链表将被分成两半。第二次迭代后，链表将被分成四半。它将继续排序到链表的大小。这将使小链表的大小增加 O(logn) 倍才能达到原始链表的大小。nlogn 中的 n 存在是因为链表的每次迭代所花费的时间与原始链表中的节点数成正比。

```
class Node {
    int data;
    Node next;
    Node(int d) {
        data = d;
    }
}

class LinkedList {
    Node head;
    public Node mergesort(Node head) {
          if(head == null || head.next == null) return head;
          Node middle = middle(head), middle_next = middle.next;
          middle.next = null;
          Node left = mergesort(head), right = mergesort(middle_next), node = merge(left, right);
          return node;
    } 

    public Node merge(Node first, Node second) {
          Node node = null;
          if (first == null) return second;
          else if (second == null) return first;
          else if (first.data <= second.data) {
              node = first;
              node.next = merge(first.next, second);

          } else {
              node = second;
              node.next = merge(first, second.next);
          }
          return node;
    }

    public Node middle(Node head) {
          if (head == null) return head;
          Node second = head, first = head.next;
          while(first != null) {
              first = first.next;
              if (first != null) {
                 second = second.next;
                 first = first.next;
              }
          }
          return second;
    }

} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-07-28T20:13:13.660

这是使用**Swift Programming Language**的解决方案。

```
//Main MergeSort Function
func mergeSort(head: Node?) -> Node? {
   guard let head = head else { return nil }
   guard let _ = head.next else { return head }

   let middle = getMiddle(head: head)
   let left = head
   let right = middle.next

   middle.next = nil

   return merge(left: mergeSort(head: left), right: mergeSort(head: right))
}

//Merge Function
func merge(left: Node?, right: Node?) -> Node? {

   guard let left = left, let right = right else { return nil}

   let dummyHead: Node = Node(value: 0)

   var current: Node? = dummyHead
   var currentLeft: Node? = left
   var currentRight: Node? = right

   while currentLeft != nil && currentRight != nil {
       if currentLeft!.value < currentRight!.value {
        current?.next = currentLeft
        currentLeft = currentLeft!.next
       } else {
        current?.next = currentRight
        currentRight = currentRight!.next
       }
       current = current?.next
   }

   if currentLeft != nil {
        current?.next = currentLeft
   }

   if currentRight != nil {
        current?.next = currentRight
   }

   return dummyHead.next!
} 
```

这是**节点类**和**getMiddle 方法**

```
class Node { 
    //Node Class which takes Integers as value
    var value: Int
    var next: Node?

    init(value: Int) {
        self.value = value
    }
}

func getMiddle(head: Node) -> Node {
    guard let nextNode = head.next else { return head }

    var slow: Node = head
    var fast: Node? = head

    while fast?.next?.next != nil {
        slow = slow.next!
        fast = fast!.next?.next
    }

    return slow
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-08-14T00:08:49.237

我在这里没有看到任何 C++ 解决方案。所以，就这样吧。希望它可以帮助某人。

```
class Solution {
public:
    ListNode *merge(ListNode *left, ListNode *right){
        ListNode *head = NULL, *temp = NULL;
        // Find which one is the head node for the merged list
        if(left->val <= right->val){
            head = left, temp = left;
            left = left->next;
        }
        else{
            head = right, temp = right;
            right = right->next;
        }
        while(left && right){
            if(left->val <= right->val){
                temp->next = left;
                temp = left;
                left = left->next;
            }
            else{
                temp->next = right;
                temp = right;
                right = right->next;
            }
        }
        // If some elements still left in the left or the right list
        if(left)
            temp->next = left;
        if(right)
            temp->next = right;
        return head;
    }

    ListNode* sortList(ListNode* head){
        if(!head || !head->next)
            return head;

        // Find the length of the list
        int length = 0;
        ListNode *temp = head;
        while(temp){
            length++;
            temp = temp->next;
        }
        // Reset temp
        temp = head;
        // Store half of it in left and the other half in right
        // Create two lists and sort them
        ListNode *left = temp, *prev = NULL;
        int i = 0, mid = length / 2;
        // Left list
        while(i < mid){
            prev = temp;
            temp = temp->next;
            i++;
        }
        // The end of the left list should point to NULL
        if(prev)
            prev->next = NULL;
        // Right list
        ListNode  *right = temp;
        // Sort left list
        ListNode *sortedLeft = sortList(left);
        // Sort right list
        ListNode *sortedRight = sortList(right);
        // Merge them
        ListNode *sortedList = merge(sortedLeft, sortedRight);
        return sortedList;
    }
}; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-05-21T09:11:49.400

这是整个代码段，展示了我们如何在 java 中创建链接列表并使用合并排序对其进行排序。我在 MergeNode 类中创建节点，还有另一个 MergesortLinklist 类，其中有划分和合并逻辑。

```
class MergeNode {
    Object value;
    MergeNode next;

    MergeNode(Object val) {
        value = val;
        next = null;

    }

    MergeNode() {
        value = null;
        next = null;

    }

    public Object getValue() {
        return value;
    }

    public void setValue(Object value) {
        this.value = value;
    }

    public MergeNode getNext() {
        return next;
    }

    public void setNext(MergeNode next) {
        this.next = next;
    }

    @Override
    public String toString() {
        return "MergeNode [value=" + value + ", next=" + next + "]";
    }

}

public class MergesortLinkList {
    MergeNode head;
    static int totalnode;

    public MergeNode getHead() {
        return head;
    }

    public void setHead(MergeNode head) {
        this.head = head;
    }

    MergeNode add(int i) {
        // TODO Auto-generated method stub
        if (head == null) {
            head = new MergeNode(i);
            // System.out.println("head value is  "+head);
            return head;

        }
        MergeNode temp = head;

        while (temp.next != null) {
            temp = temp.next;
        }
        temp.next = new MergeNode(i);
        return head;

    }

    MergeNode mergesort(MergeNode nl1) {
        // TODO Auto-generated method stub

        if (nl1.next == null) {
            return nl1;
        }

        int counter = 0;

        MergeNode temp = nl1;

        while (temp != null) {
            counter++;
            temp = temp.next;

        }
        System.out.println("total nodes  " + counter);

        int middle = (counter - 1) / 2;

        temp = nl1;
        MergeNode left = nl1, right = nl1;
        int leftindex = 0, rightindex = 0;

        if (middle == leftindex) {
            right = left.next;
        }
        while (leftindex < middle) {

            leftindex++;
            left = left.next;
            right = left.next;
        }

        left.next = null;
        left = nl1;

        System.out.println(left.toString());
        System.out.println(right.toString());

        MergeNode p1 = mergesort(left);
        MergeNode p2 = mergesort(right);

        MergeNode node = merge(p1, p2);

        return node;

    }

    MergeNode merge(MergeNode p1, MergeNode p2) {
        // TODO Auto-generated method stub

        MergeNode L = p1;
        MergeNode R = p2;

        int Lcount = 0, Rcount = 0;

        MergeNode tempnode = null;

        while (L != null && R != null) {

            int val1 = (int) L.value;

            int val2 = (int) R.value;

            if (val1 > val2) {

                if (tempnode == null) {
                    tempnode = new MergeNode(val2);
                    R = R.next;
                } else {

                    MergeNode store = tempnode;

                    while (store.next != null) {
                        store = store.next;
                    }
                    store.next = new MergeNode(val2);

                    R = R.next;
                }

            } else {
                if (tempnode == null) {
                    tempnode = new MergeNode(val1);
                    L = L.next;
                } else {

                    MergeNode store = tempnode;

                    while (store.next != null) {
                        store = store.next;
                    }
                    store.next = new MergeNode(val1);

                    L = L.next;
                }

            }

        }

        MergeNode handle = tempnode;

        while (L != null) {

            while (handle.next != null) {

                handle = handle.next;

            }
            handle.next = L;

            L = null;

        }

        // Copy remaining elements of L[] if any
        while (R != null) {
            while (handle.next != null) {

                handle = handle.next;

            }
            handle.next = R;

            R = null;

        }

        System.out.println("----------------sorted value-----------");
        System.out.println(tempnode.toString());
        return tempnode;
    }

    public static void main(String[] args) {
        MergesortLinkList objsort = new MergesortLinkList();
        MergeNode n1 = objsort.add(9);
        MergeNode n2 = objsort.add(7);
        MergeNode n3 = objsort.add(6);
        MergeNode n4 = objsort.add(87);
        MergeNode n5 = objsort.add(16);
        MergeNode n6 = objsort.add(81);

        MergeNode n7 = objsort.add(21);
        MergeNode n8 = objsort.add(16);

        MergeNode n9 = objsort.add(99);
        MergeNode n10 = objsort.add(31);

        MergeNode val = objsort.mergesort(n1);

        System.out.println("===============sorted values=====================");
        while (val != null) {
            System.out.println(" value is  " + val.value);
            val = val.next;
        }
    }

} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-01-29T08:53:56.517

嘿，我知道这是一个有点晚的答案，但得到了一个快速简单的答案。

代码在 F# 中，但可以使用任何语言。由于这是 ML 家族中一种不常见的语言，我将给出一些提高可读性的要点。F# 是通过制表完成的嵌套。函数（嵌套部分）中的最后一行代码是返回值。(x, y) 是一个元组，x::xs 是一个头部 x 和尾部 xs 的列表（其中 xs 可以为空），|> 将最后一行的结果作为一个管道它作为它右边表达式的参数(可读性增强) 和 last (fun args -> some expression) 是一个 lambda 函数。

```
// split the list into a singleton list
let split list = List.map (fun x -> [x]) lst

// takes to list and merge them into a sorted list
let sort lst1 lst2 =
   // nested function to hide accumulator
   let rec s acc pair =
       match pair with
       // empty list case, return the sorted list
       | [], [] -> List.rev acc
       | xs, [] | [], xs ->
          // one empty list case, 
          // append the rest of xs onto acc and return the sorted list
          List.fold (fun ys y -> y :: ys) acc xs
          |> List.rev
       // general case
       | x::xs, y::ys ->
          match x < y with
          | true -> // cons x onto the accumulator
              s (x::acc) (xs,y::ys)
          | _ ->
              // cons y onto the accumulator
              s (y::acc) (x::xs,ys)

    s [] (lst1, lst2)  

let msort lst =
  let rec merge acc lst =
      match lst with
      | [] ->
          match acc with
          | [] -> [] // empty list case
          | _ -> merge [] acc
      | x :: [] -> // single list case (x is a list)
         match acc with
         | [] -> x // since acc are empty there are only x left, hence x are the sorted list.
         | _ -> merge [] (x::acc) // still need merging.
       | x1 :: x2 :: xs ->
           // merge the lists x1 and x2 and add them to the acummulator. recursiv call
           merge (sort x1 x2 :: acc) xs

   // return part
   split list // expand to singleton list list
   |> merge [] // merge and sort recursively. 
```

重要的是要注意这是完全尾递归的，因此没有堆栈溢出的可能性，并且通过首先将列表扩展为单例列表，我们可以降低最坏成本的常数因子。由于合并正在处理列表列表，我们可以递归地合并和排序内部列表，直到我们到达所有内部列表都被排序到一个列表中的固定点，然后我们返回该列表，因此从一个列表列表折叠到一个列表再次。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-01-01T14:35:25.403

这是链表上合并排序的Java实现：

> *   时间复杂度：O(n.logn)
> *   空间复杂度：O(1) - 链表上的合并排序实现避免了通常与算法相关的 O(n) 辅助存储成本

```
class Solution
{
    public ListNode mergeSortList(ListNode head) 
    {
        if(head == null || head.next == null)
            return head;

        ListNode mid = getMid(head), second_head = mid.next; mid.next = null;

        return merge(mergeSortList(head), mergeSortList(second_head));
    }

    private ListNode merge(ListNode head1, ListNode head2)
    {
        ListNode result = new ListNode(0), current = result;

        while(head1 != null && head2 != null)
        {
            if(head1.val < head2.val)
            {
                current.next = head1;
                head1 = head1.next;
            }
            else
            {
                current.next = head2;
                head2 = head2.next;
            }
            current = current.next;
        }

        if(head1 != null) current.next = head1;
        if(head2 != null) current.next = head2;

        return result.next;
    }

    private ListNode getMid(ListNode head)
    {
        ListNode slow = head, fast = head.next;

        while(fast != null && fast.next != null)
        {
            slow = slow.next;
            fast = fast.next.next;
        }
        return slow;
    }
} 
```

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2011-07-07T09:25:05.940

```
public int[] msort(int[] a) {
    if (a.Length > 1) {
        int min = a.Length / 2;
        int max = min;

        int[] b = new int[min];
        int[] c = new int[max]; // dividing main array into two half arrays
        for (int i = 0; i < min; i++) {
            b[i] = a[i];
        }

        for (int i = min; i < min + max; i++) {
            c[i - min] = a[i];
        }

        b = msort(b);
        c = msort(c);

        int x = 0;
        int y = 0;
        int z = 0;

        while (b.Length != y && c.Length != z) {
            if (b[y] < c[z]) {
                a[x] = b[y];
                //r--
                x++;
                y++;
            } else {
                a[x] = c[z];
                x++;
                z++;
            }
        }

        while (b.Length != y) {
            a[x] = b[y];
            x++;
            y++;
        }

        while (c.Length != z) {
            a[x] = c[z];
            x++;
            z++;
        }
    }

    return a;
} 
```

# sql-server - 如何在 SQL Server 上启用 MSDTC？

> ID：7694
> 
> 赞同：114
> 
> 时间：2008-08-11T11:57:17.480
> 
> 标签：sql-server, msdtc

这甚至是一个有效的问题吗？我有一个使用 MSTDC 的 .NET Windows 应用程序，它抛出异常：

> System.Transactions.TransactionManagerCommunicationException：分布式事务管理器 (MSDTC) 的网络访问已被禁用。请使用组件服务管理工具在 MSDTC 的安全配置中启用 DTC 进行网络访问---> System.Runtime.InteropServices.COMException (0x8004D024)：事务管理器已禁用对远程/网络事务的支持。（来自 HRESULT 的异常：0x8004D024）在 System.Transactions.Oletx.IDtcProxyShimFactory.ReceiveTransaction（UInt32 propgationTokenSize，Byte[] propgationToken，IntPtr managedIdentifier，Guid& transactionIdentifier，OletxTransactionIsolationLevel&isolationLevel，ITransactionShim&transactionShim）......

我按照[Kbalertz 指南](https://support.microsoft.com/en-us/kb/883960)在安装了应用程序的 PC 上启用了 MSDTC，但仍然出现错误。

我想知道这是不是数据库问题？如果是这样，我该如何解决？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2014-12-03T04:54:01.903

将此用于 Windows Server 2008 r2 和 Windows Server 2012 R2

1.  单击**开始**，单击**运行**，键入**dcomcnfg**，然后单击**确定**以打开**组件服务**。

2.  在控制台树中，单击展开**Component Services**，单击展开**Computers**，单击展开**My Computer**，单击展开**Distributed Transaction Coordinator**，然后单击**Local DTC**。

3.  右键单击**本地 DTC**，然后单击**属性**以显示**本地 DTC 属性**对话框。

4.  单击**安全**选项卡。

5.  选中**“网络 DTC 访问”**复选框。

6.  最后选中**“允许入站”**和**“允许出站”**复选框。

7.  单击**应用**，**确定**。

8.  将弹出一条有关**重新启动**服务的消息。

9.  单击**确定**，仅此而已。

参考：[https ://msdn.microsoft.com/en-us/library/dd327979.aspx](https://msdn.microsoft.com/en-us/library/dd327979.aspx)

**注意：**有时本地计算机或服务器上的网络防火墙可能会中断您的连接，因此请确保为 **“允许入站”**和**“允许出站”**连接创建规则`C:\Windows\System32\msdtc.exe`

* * *

## 回答 #2

> 赞同：104
> 
> 时间：2008-08-11T12:10:05.363

你甚至需要MSDTC吗？您遇到的升级通常是由在单个 TransactionScope 中创建多个连接引起的。

如果您确实需要它，那么您需要按照错误消息中的说明启用它。在 XP 上：

*   转到管理工具 -> 组件服务
*   展开组件服务 -> 计算机 ->
*   右键单击 -> 属性 -> MSDTC 选项卡
*   点击安全配置按钮

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-01-26T08:49:42.470

我发现最好的调试方法是使用名为[DTCPing的微软工具](http://www.microsoft.com/downloads/details.aspx?familyid=5E325025-4DCD-4658-A549-1D549AC17644&displaylang=en)

1.  将文件复制到服务器（DB）和客户端（应用程序服务器/客户端 pc）
    *   在服务器和客户端启动它
    *   在服务器端：填写客户端 netbios 计算机名并尝试建立 DTC 连接
    *   重新启动两个应用程序。
    *   在客户端：填写服务器 netbios 计算机名并尝试建立 DTC 连接

我在旧公司网络中遇到了问题，我有一些提示：

*   如果您收到错误消息“Gethostbyname failed”，则表示计算机无法通过其**netbios 名称**找到另一台计算机。例如，服务器可以解析和 ping 客户端，但这适用于 DNS 级别。不在 netbios 查找级别。使用 WINS 服务器或更改 LMHOST（脏）将解决此问题。
*   如果您收到错误“拒绝访问”，则安全设置不匹配。您应该比较 msdtc 的安全选项卡并让服务器和客户端匹配。要查看的另一件事是[RestrictRemoteClients](http://technet.microsoft.com/en-us/library/aa995844.aspx)值。根据您的操作系统版本，更重要的是 Service Pack，此值可能会有所不同。
*   其他连接问题：
    *   服务器和客户端之间的防火墙必须允许通过端口 135 进行通信。更重要的是，可以从两个站点启动连接（我公司的防火墙人员遇到了很多问题，因为他们认为只有服务器会打开连接到那个端口）
    *   该协议返回一个随机端口以连接到真正的事务通信。防火墙人不喜欢这样，他们喜欢将端口限制在一定范围内。[您可以使用如何配置 RPC 动态端口分配以与防火墙一起](http://support.microsoft.com/?kbid=154596)使用中所述的键将 RPC 动态端口生成限制在特定范围内。

根据我的经验，如果 DTCPing 能够设置从客户端启动并从服务器启动的 DTC 连接，那么您的事务就不再是问题了。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-06-03T07:35:51.723

也可以[在这里](http://geekswithblogs.net/narent/archive/2006/10/09/93544.aspx)查看如何从控制面板的 services.msc 中打开 MSDTC。

> 在触发器所在的服务器上，您需要开启 MSDTC 服务。您可以通过单击开始 > 设置 > 控制面板 > 管理工具 > 服务来实现。找到名为“分布式事务协调器”的服务并右键单击（在其上并选择）> 开始。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-11T12:04:11.523

必须在服务器和客户端这两个系统上启用 MSDTC。
此外，请确保系统之间没有阻止 RPC 的防火墙。
[DTCTest](http://www.sqldev.net/misc/DTCTest.htm)是一个不错的应用程序，可以帮助您解决任何其他问题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-11T23:02:13.597

@担，

> 我不需要为事务启用 msdtc 吗？

仅分布式事务 - 涉及多个连接的事务。确保您只在事务中打开一个连接并且它不会升级 - 性能也会好得多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-05-07T04:01:29.170

MSDTC 可以使用 MsDtc PowerShell 模块进行配置，例如：

```
# Import the module
Import-Module -Name MsDtc

# Set the DTC config
$dtcNetworkSetting = @{
    DtcName                           = 'Local'
    AuthenticationLevel               = 'NoAuth'
    InboundTransactionsEnabled        = $true
    OutboundTransactionsEnabled       = $true
    RemoteClientAccessEnabled         = $true
    RemoteAdministrationAccessEnabled = $true
    XATransactionsEnabled             = $false
    LUTransactionsEnabled             = $true
}
Set-DtcNetworkSetting @dtcNetworkSetting

# Restart the MsDtc service
Get-Service -Name MsDtc | Restart-Service 
```

在将支持分布式事务（即运行 MSDTC 服务的地方）的每台机器上运行。

# internet-explorer-8 - IE8 溢出：具有最大高度的自动

> ID：7707
> 
> 赞同：56
> 
> 时间：2008-08-11T12:18:02.150
> 
> 标签：internet-explorer-8, overflow, css

我有一个可能包含大量数据的元素，但我不希望它破坏页面布局，所以我设置`max-height: 100px`and `overflow:auto`，希望在内容不适合时出现滚动条。

在 Firefox 和 IE7 中一切正常，但 IE8 表现得好像`overflow:hidden`存在而不是`overflow:auto`.

我试过`overflow:scroll`了，仍然没有帮助，IE8只是截断内容而不显示滚动条。`max-height`将声明更改为`height`使溢出工作正常，它是`max-height`and的组合`overflow:auto`破坏了事情。

这也被记录为[IE8 的最终发布版本中的官方错误](http://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=408759)

有解决方法吗？现在我求助于使用`height`而不是`max-height`，但如果没有太多数据，它会留下大量空白空间。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-05-19T08:34:12.627

这是一个非常讨厌的错误，因为它严重影响了 Stack Overflow 上的`<pre>`代码块，其中包含`max-height:600`和`width:auto`.

它在 IE8 的最终版本中被记录为一个错误，没有修复。

[http://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=408759](http://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=408759)

有一个非常非常 hacky 的 CSS 解决方法：

[http://my.opera.com/dbloom/blog/2009/03/11/css-hack-for-ie8-standards-mode](http://my.opera.com/dbloom/blog/2009/03/11/css-hack-for-ie8-standards-mode)

```
/*
SUPER nasty IE8 hack to deal with this bug
*/
pre 
{
    max-height: none\9 
} 
```

当然还有其他人提到的条件 CSS，但我不喜欢这样，因为这意味着您在每个页面请求中都提供了额外的 HTML 垃圾。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-11T13:26:05.067

```
{
overflow:auto
} 
```

尝试 div 溢出：自动

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-20T22:15:05.493

我看到这被记录为 RC1 中的一个固定错误。但是我发现了一个似乎会导致硬断言渲染失败的变体。在嵌套表中涉及这两种样式。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Test</title>
    <style type="text/css">
    .calendarBody
    {
        overflow: scroll;
        max-height: 500px;
    }
    </style>
</head>
<body>
    <table>
    <tbody>
        <tr>
        <td>
            This is a cell in the outer table.
        <div class="calendarBody">
            <table>
                <tbody>
                <tr>
                    <td>
                    This is a cell in the inner table.
                </td>
                    </tr>
            </tbody>
                </table>
        </div>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-03T10:00:08.507

```
{max-height:200px, Overflow:auto} 
```

感谢 Srinivas Tamada，上面的代码确实对我有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-05T10:27:17.823

# 重现：

（这会使整个页面崩溃。）

```
<HTML>
<HEAD>
    <META content="IE=8" http-equiv="X-UA-Compatible"/>
</HEAD>

<BODY>
    look:

    <TABLE width="100%">
        <TR>
            <TD>
                <TABLE width="100%">
                    <TR>
                        <TD>
                            <DIV style="overflow-y: scroll; max-height: 100px;">
                                X
                            </DIV>
                        </TD>
                    </TR>
                </TABLE>
            </TD>
        </TR>
    </TABLE>
</BODY>
</HTML> 
```

（虽然这很好用......）

```
<HTML>
<HEAD>
    <META content="IE=8" http-equiv="X-UA-Compatible"/>
</HEAD>

<BODY>
    look:

    <TABLE width="100%">
        <TR>
            <TD>
                <TABLE width="100%">
                    <TR>
                        <TD>
                            <DIV style="overflow-y: scroll; max-height: 100px;">
                                The quick brown fox
                            </DIV>
                        </TD>
                    </TR>
                </TABLE>
            </TD>
        </TR>
    </TABLE>
</BODY>
</HTML> 
```

（而且，疯狂地，这样做也是如此。[div 中根本没有内容。]）

```
<HTML>
<HEAD>
    <META content="IE=8" http-equiv="X-UA-Compatible"/>
</HEAD>

<BODY>
    look:

    <TABLE width="100%">
        <TR>
            <TD>
                <TABLE width="100%">
                    <TR>
                        <TD>
                            <DIV style="overflow-y: scroll; max-height: 100px;">
                            </DIV>
                        </TD>
                    </TR>
                </TABLE>
            </TD>
        </TR>
    </TABLE>
</BODY>
</HTML> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-08-18T18:57:37.927

类似的情况，一个由 js 设置 maxHeight 的 pre 元素以适应分配的空间，宽度 100%，自动溢出。如果内容比 maxHeight 短并且也适合水平，我们很好。如果您调整窗口大小以使内容不再水平放置，则会出现一个水平滚动条，但元素的高度会立即跳到最大的 maxHeight，而不管内容的高度如何。

尝试了 Jeff 提到的各种形式的 css hack，但没有发现任何不是 js 错误参数错误的东西。

我能找到的最好的方法是为 ie8 选择你的毒药：要么降低 maxHeight 限制，所以元素可以是任何高度（最适合我的情况），或者设置高度而不是 maxHeight，所以即使内容本身也是如此，它总是那么高矮得多。很不理想。在 ie9 中，古怪的行为消失了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-11-01T07:47:06.217

只设置最大高度，不要设置溢出。这样，如果内容大于最大高度，它将显示滚动条，如果内容小于最大高度，它将缩小。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-11-17T17:40:20.983

我发现了这个： [https ://perishablepress.com/maximum-and-minimum-height-and-width-in-internet-explorer/](https://perishablepress.com/maximum-and-minimum-height-and-width-in-internet-explorer/)

> 此方法已在 IE6 中得到验证，在 IE5 中也应该可以使用。只需更改值以满足您的需要（带有解释性注释的代码）。在此示例中，我们将 IE 和所有符合标准的浏览器的最大高度设置为 333px 1：
> 
> `* html div#division { height: expression( this.scrollHeight > 332 ? "333px" : "auto" ); /* sets max-height for IE */ }`

这对我来说非常有用，所以我决定分享这个。

# c# - 为 .NET TextBox 捕获 MouseDown 事件

> ID：7719
> 
> 赞同：1
> 
> 时间：2008-08-11T12:36:20.350
> 
> 标签：c#, .net, events, windows-mobile

是否有任何方法可以从 .NET 2.0 TextBox 控件中捕获 MouseDown？我知道继承的 Control 类有事件，但它没有在 TextBox 中公开。有没有办法覆盖事件处理程序？

我还尝试了 OpenNETCF TextBox2 控件，它确实暴露了 MouseDown 事件，但无论我做什么，它都不会触发处理程序。

有什么建议么？

* * *

> 你有什么样的疯狂移动设备，有鼠标？:)

是的，windows mobile 没有真正的鼠标，但您误认为 Windows Mobile .NET 不支持鼠标事件。屏幕上的单击或移动仍被视为“鼠标”事件。这样做是为了让代码可以轻松地从完整的 Windows 移植过来。这不是 Windows Mobile 特定的问题。Windows 上的 TextBox 控件也没有本机鼠标事件。在这种情况下，我只是碰巧使用了 Windows Mobile。

编辑：附带说明...由于 Windows Mobile 是由 WindowsCE 核心构建的，该核心通常用于嵌入式桌面系统和 Slim Terminal Services 客户端或“WinTerms”，它支持硬件鼠标并且已经使用了很长时间。大多数设备只是没有可以插入的端口。

* * *

> 根据 .Net Framework，支持 TextBox 上的 MouseDown 事件处理程序。当您尝试运行代码时会发生什么？

实际上，那只是因为它从“Control”继承它，就像*所有*其他 Form 控件一样。但是，它在 TextBox 类中被覆盖（并且我相信已更改为私有）。所以它不会出现在 Visual Studio 的 IntelliSense 中。

但是，您实际上可以编写代码：

```
textBox1.MouseDown += new System.Windows.Forms.MouseEventHandler(this.textBox1_MouseDown); 
```

它会编译并运行得很好，唯一的问题是当您点击 TextBox 控件时不会触发 textBox1_MouseDown() 。我认为这是因为事件在内部被覆盖。我什至不想在内部更改事件中发生的事情，我只想将我自己的事件处理程序添加到该事件中，这样我就可以像处理任何其他事件一样触发一些自定义代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-10T14:38:56.423

我知道这个答案已经晚了，但希望它最终对找到这个答案的人有用。另外，我自己也没有完全想出来。我相信我最初在 OpenNETCF 板上找到了大部分信息，但下面输入的内容是从我的一个应用程序中提取的。

您可以通过实现 OpenNETCF.Windows.Forms.IMessageFilter 接口并将其附加到应用程序的消息过滤器来获取 mousedown 事件。

```
静态类程序{
    公共静态 MouseUpDownFilter mudFilter = new MouseUpDownfilter();
    公共静态无效主要（）{
        Application2.AddMessageFilter(mudFilter);
        Application2.Run(new MainForm());
    }
}

```

这就是实现 MouseUpDownFilter 的方法：

```
公共类 MouseUpDownFilter : IMessageFilter {
    列表控制列表 = 新列表（）；

    公共无效WatchControl（控制buttonToWatch）{
        ControlList.Add(buttonToWatch);
    }

    公共事件 MouseEventHandler MouseUp；
    公共事件 MouseEventHandler MouseDown;

    公共布尔 PreFilterMessage（参考 Microsoft.WindowsCE.Forms.Message m）{
        常量 int WM_LBUTTONDOWN = 0x0201;
        常量 int WM_LBUTTONUP = 0x0202;

        // 如果消息代码不是我们感兴趣的代码之一
        // 那么我们可以在这里停下来
        if (m.Msg != WM_LBUTTONDOWN && m.Msg != WM_LBUTTONDOWN) {
            返回假；
        }

        // 查看控件是否为被监视按钮
        foreach (ControlList 中的控制 c) {
            if (m.HWnd == c.Handle) {
                int i = (int)m.LParam;
                诠释 x = 我 & 0xFFFF;
                int y = (i >> 16) & 0xFFFF;
                MouseEventArgs args = new MouseEventArgs(MouseButtons.Left, 1, x, y, 0);

                if (m.Msg == WM_LBUTTONDOWN)
                    MouseDown(c, args);
                别的
                    MouseUp(c, args);

                // 返回 true 表示我们已经处理了这条消息
                返回真；
            }
        }
        返回假；
    }
}

```

现在，此 MouseUpDownFilter 将在监视控件（例如您的文本框）上发生时触发 MouseUp/MouseDown 事件。要使用此过滤器，您需要添加一些监视控件并分配给它可能在表单的加载事件中触发的事件：

```
私人无效MainForm_Load（对象发送者，EventArgs e）{
    Program.mudFilter.WatchControl(this.textBox1);
    Program.mudFilter.MouseDown += new MouseEventHandler(mudFilter_MouseDown);
    Program.mudFilter.MouseUp += new MouseEventHandler(mudFilter_MouseUp);
}

void mudFilter_MouseDown（对象发送者，MouseEventArgs e）{
    如果（发件人 == textBox1）{
        // 在 textBox1 鼠标按下事件中做你想做的事情 :)
    }

}

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T13:54:46.793

根据 .Net Framework，支持[TextBox 上的 MouseDown 事件处理](http://www.csharpfriends.com/quickstart/aspplus/samples/classbrowser/cs/classbrowser.aspx?assembly=System.Windows.Forms,%20Version=1.0.5000.0,%20Culture=neutral,%20PublicKeyToken=b77a5c561934e089&namespace=System.Windows.Forms&class=TextBox)程序。当您尝试运行代码时会发生什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T14:02:17.387

很公平。您可能比我更了解 Windows Mobile。:) 我刚开始为它编程。但在常规 WinForms 中，您可以随心所欲地覆盖 OnXxx 事件处理程序方法。快速浏览一下带有 CF 的 Reflector 会发现，Control、TextBoxBase 和 TextBox 不会阻止您覆盖 OnMouseDown 事件处理程序。

你试过这个吗？：

```
public class MyTextBox : TextBox
{
    public MyTextBox()
    {
    }

    protected override void OnMouseDown(MouseEventArgs e)
    {
        //do something specific here
        base.OnMouseDown(e);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T14:45:05.957

看起来你是对的。真可惜。没有 MouseOver 事件。

但是，始终适用于 .NET 的一种备用方法是 P/Invoke。已经有人花时间为 .NET CF TextBox 做这件事了。我在 CodeProject 上找到了这个：

[http://www.codeproject.com/KB/cs/TextBox_subclassing.aspx](http://www.codeproject.com/KB/cs/TextBox_subclassing.aspx)

希望这可以帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-19T13:45:09.630

是否有您可以捕获的“OnEnter”事件？

当您进入文本框以及通过点击/单击它输入文本框时，它可能也会捕获，但如果这不是问题，那么这可能是一个更直接的解决方法

# java - 为 Windows/Linux 桌面打包 Java 应用程序

> ID：7720
> 
> 赞同：39
> 
> 时间：2008-08-11T12:37:50.503
> 
> 标签：java, windows, swt, executable, software-distribution

我正在使用用于 GUI 呈现的 Eclipse SWT 库用 Java 编写桌面应用程序。我认为 SWT 帮助 Java 克服桌面上接受的最大障碍：即为 Java 应用程序提供一个一致的、响应式的界面，看起来就像属于你桌面上的任何其他应用程序一样。但是，我觉得打包一个应用程序仍然是一个问题。

OS X 原生提供了一种将 Java 应用程序包装在原生应用程序包中的简单机制，但是为 Windows/Linux 生成一个不需要用户运行丑陋的批处理文件或单击 .jar 的应用程序仍然很麻烦。可能这在 Linux 上不是这样的问题，用户可能更精通技术，但在 Windows 上，我希望有一个常规的 .exe 供他/她运行。

有没有人使用过任何用于 Java 的 .exe 生成工具？我尝试过 JSmooth，但遇到了各种问题。在我破解 Visual Studio 并推出自己的解决方案之前，是否有更好的解决方案？

**编辑：** 我也许应该提到我无法在商业解决方案上花很多钱。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-29T18:16:22.020

为了跟进 pauxu 的回答，我在我的一个项目中使用了 launch4j 和 NSIS，并认为展示我如何使用它们会很有帮助。这就是我正在为 Windows 做的事情。顺便说一句，我正在为 Mac 创建 .app 和 .dmg，但还没有弄清楚要为 Linux 做什么。

## launch4j 和 NSIS 的项目副本

在我的项目中，我有一个“vendor”目录，在它下面有一个“launch4j”和“nsis”目录。每个应用程序中都有一份安装副本。我发现将副本复制到项目中更容易，而不是强迫其他人安装这两种产品并设置某种环境变量来指向每个产品。

## 脚本文件

我的项目中还有一个“脚本”目录，其中包含我项目的各种配置/脚本文件。首先是 launch4j.xml 文件：

```
<launch4jConfig>
  <dontWrapJar>true</dontWrapJar>
  <headerType>gui</headerType>
  <jar>rpgam.jar</jar>
  <outfile>rpgam.exe</outfile>
  <errTitle></errTitle>
  <cmdLine></cmdLine>
  <chdir>.</chdir>
  <priority>normal</priority>
  <downloadUrl>http://www.rpgaudiomixer.com/</downloadUrl>
  <supportUrl></supportUrl>
  <customProcName>false</customProcName>
  <stayAlive>false</stayAlive>
  <manifest></manifest>
  <icon></icon>
  <jre>
    <path></path>
    <minVersion>1.5.0</minVersion>
    <maxVersion></maxVersion>
    <jdkPreference>preferJre</jdkPreference>
  </jre>
  <splash>
    <file>..\images\splash.bmp</file>
    <waitForWindow>true</waitForWindow>
    <timeout>60</timeout>
    <timeoutErr>true</timeoutErr>
  </splash>
</launch4jConfig> 
```

然后是 NSIS 脚本 rpgam-setup.nsis。它可以使用 VERSION 参数来帮助命名文件。

```
; The name of the installer
Name "RPG Audio Mixer"

!ifndef VERSION
    !define VERSION A.B.C
!endif

; The file to write
outfile "..\dist\installers\windows\rpgam-${VERSION}.exe"

; The default installation directory
InstallDir "$PROGRAMFILES\RPG Audio Mixer"

; Registry key to check for directory (so if you install again, it will 
; overwrite the old one automatically)
InstallDirRegKey HKLM "Software\RPG_Audio_Mixer" "Install_Dir"

# create a default section.
section "RPG Audio Mixer"

    SectionIn RO

    ; Set output path to the installation directory.
    SetOutPath $INSTDIR
    File /r "..\dist\layout\windows\"

    ; Write the installation path into the registry
    WriteRegStr HKLM SOFTWARE\RPG_Audio_Mixer "Install_Dir" "$INSTDIR"

    ; Write the uninstall keys for Windows
    WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\RPGAudioMixer" "DisplayName" "RPG Audio Mixer"
    WriteRegStr HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\RPGAudioMixer" "UninstallString" '"$INSTDIR\uninstall.exe"'
    WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\RPGAudioMixer" "NoModify" 1
    WriteRegDWORD HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\RPGAudioMixer" "NoRepair" 1
    WriteUninstaller "uninstall.exe"

    ; read the value from the registry into the $0 register
    ;readRegStr $0 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment" CurrentVersion

    ; print the results in a popup message box
    ;messageBox MB_OK "version: $0"

sectionEnd

Section "Start Menu Shortcuts"
  CreateDirectory "$SMPROGRAMS\RPG Audio Mixer"
  CreateShortCut "$SMPROGRAMS\RPG Audio Mixer\Uninstall.lnk" "$INSTDIR\uninstall.exe" "" "$INSTDIR\uninstall.exe" 0
  CreateShortCut "$SMPROGRAMS\RPG AUdio Mixer\RPG Audio Mixer.lnk" "$INSTDIR\rpgam.exe" "" "$INSTDIR\rpgam.exe" 0
SectionEnd

Section "Uninstall"

    ; Remove registry keys
    DeleteRegKey HKLM "Software\Microsoft\Windows\CurrentVersion\Uninstall\RPGAudioMixer"
    DeleteRegKey HKLM SOFTWARE\RPG_Audio_Mixer

    ; Remove files and uninstaller
    Delete $INSTDIR\rpgam.exe
    Delete $INSTDIR\uninstall.exe

    ; Remove shortcuts, if any
    Delete "$SMPROGRAMS\RPG Audio Mixer\*.*"

    ; Remove directories used
    RMDir "$SMPROGRAMS\RPG Audio Mixer"
    RMDir "$INSTDIR"

SectionEnd 
```

## 蚂蚁集成

我的 Ant 构建文件 (build.xml) 中有一些目标来处理上述问题。首先我打电话给 Ant 来导入 launch4j 的 Ant 任务：

```
<property name="launch4j.dir" location="vendor/launch4j" />
<taskdef name="launch4j" 
    classname="net.sf.launch4j.ant.Launch4jTask"
    classpath="${launch4j.dir}/launch4j.jar:${launch4j.dir}/lib/xstream.jar" /> 
```

然后我有一个简单的目标来创建包装器可执行文件：

```
<target name="executable-windows" depends="jar" description="Create Windows executable (EXE)">
    <launch4j configFile="scripts/launch4j.xml" outfile="${exeFile}" />
</target> 
```

制作安装程序的另一个目标：

```
<target name="installer-windows" depends="executable-windows" description="Create the installer for Windows (EXE)">
    <!-- Lay out files needed for building the installer -->
    <mkdir dir="${windowsLayoutDirectory}" />
    <copy file="${jarFile}" todir="${windowsLayoutDirectory}" />
    <copy todir="${windowsLayoutDirectory}/lib">
        <fileset dir="${libraryDirectory}" />
        <fileset dir="${windowsLibraryDirectory}" />
    </copy>
    <copy todir="${windowsLayoutDirectory}/icons">
         <fileset dir="${iconsDirectory}" />
    </copy>
    <copy todir="${windowsLayoutDirectory}" file="${exeFile}" />

    <mkdir dir="${windowsInstallerDirectory}" />

    <!-- Build the installer using NSIS -->
    <exec executable="vendor/nsis/makensis.exe">
        <arg value="/DVERSION=${version}" />
        <arg value="scripts/rpgam-setup.nsi" />
    </exec>
</target> 
```

上半部分只是将安装程序所需的文件复制到一个临时位置，后半部分执行使用所有文件来制作安装程序的脚本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T17:05:46.967

在我的公司，我们使用[Launch4J](http://launch4j.sourceforge.net/)创建 exe 文件，使用[NSIS](http://nsis.sourceforge.net/)创建安装程序和 SWT 应用程序。

我们已经在几个商业应用中使用了它多年，并且这对工作正常。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-12T08:05:53.500

也许你应该看看[IzPack](http://izpack.org/)。几年前我创建了一个非常好的安装程序，我敢打赌他们仍在改进它。它允许安装文档、二进制文件和可点击的链接来启动应用程序*IIRC*。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-25T21:27:34.087

我使用免费的[Launch4J](http://launch4j.sourceforge.net/)在 Windows 上为我的 Java 程序创建了一个自定义启动器。结合免费的[NSIS 安装程序](http://nsis.sourceforge.net/Main_Page)，您可以为您的 Windows 用户构建一个不错的软件包。

**编辑：**没有看到您使用 SWT。不知道它是否也适用于 SWT，因为我在我的应用程序中只使用了 Swing。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-12T08:15:51.093

您是否考虑过用 C/C++ 编写一个小程序，该程序只需调用[`CreateProcess`](http://msdn.microsoft.com/en-us/library/ms682425.aspx)以使用 jar（或类）文件启动 java VM？

您可以获得[Visual C++ Express](http://www.microsoft.com/express/vc/)并很容易地组合启动程序。这也可以很容易地添加一个友好的图标。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-16T20:22:59.130

考虑将您的应用程序转换为[Eclipse RCP](http://wiki.eclipse.org/index.php/Rich_Client_Platform)。它是用[SWT](http://eclipse.org/swt)编写的，Eclipse IDE 包含为所有主要平台生成可执行文件的打包工具。对于 Windows，它可以生成一个 zip 文件或包含您的代码的文件夹。对于常见的安装体验，我会使用 NSIS。eclipse 上实际上有一个[包生成器](http://wiki.eclipse.org/Eclipse_RCP_Installer/Packages_Generator)项目，用于为 eclipse 支持的所有平台创建通用安装程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-11T13:48:31.593

您是否考虑过[Java Web Start](http://java.sun.com/javase/technologies/desktop/javawebstart/index.jsp)？ [这](http://www.ibm.com/developerworks/opensource/library/os-jws/)是专门用于使用 Java Web Start 部署 SWT 应用程序的教程。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-11T12:59:04.550

[安装 4J](http://www.ej-technologies.com/products/install4j/overview.html)。不是免费的，但值得。试一试

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-05-10T15:24:15.007

您现在可以通过 Netbeans 做到这一点！这真的很简单，而且效果很好。在 Netbeans 网站上查看[本教程。](https://netbeans.org/kb/docs/java/native_pkg.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-11T13:09:20.330

我经历了同样的事情，发现所有的免费选项都不是很好。看来你要自己写了。我很想看看是否有人有免费/便宜的选择

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-12T08:55:33.150

我正在考虑的另一个选择：Eclipse 没有从头开始编写本机启动器，而是附带了它自己的启动器的源代码，这也许可以重新用于我的应用程序。

遗憾的是 Sun 从未在 JDK 中包含任何类似的东西。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T19:17:14.810

又投了一票 Launch4J，今天早上刚写了一个 ant 任务来集成我的一个项目。似乎工作得很好

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-28T07:52:07.767

我过去使用过 JSmooth，现在仍然很幸运。UI 有很多错误，但我只用它来构建配置文件一次，然后我从 Ant 构建。

您在使用 JSmooth 时遇到什么问题？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T10:24:35.910

JSMooth 在生产环境中为我们工作得非常好，我首先使用 one-jar (fat jar plugin to eclipse) 生成了一个 jar，然后用 JSmooth 包装它。

（请注意，我想要一个单一文件的免安装分发，如果需要，它可以提示安装 JRE）。

它运行得非常好，我以为没有人在使用它:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-18T12:49:56.297

您可能想尝试我们的工具[BitRock InstallBuilder](http://bitrock.com)。虽然它是一个原生应用程序，但我们的很多客户都使用它来打包桌面 Java 应用程序。如果您捆绑 JRE 并创建启动器等，用户甚至不需要知道他们正在安装 Java 应用程序。它是跨平台的，因此您可以为 Windows 和 Mac（以及 Linux、Solaris 等）生成安装程序。就像另一篇文章中提到的 install4j 工具一样，它是一个商业工具，*但*我们有开源项目的免费许可证和特别折扣对于 microISV / 小型企业等，只需给我们发送电子邮件。还想强调这是一个安装工具，因此如果您只寻找单个文件可执行文件，它将无法满足您的需求。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-31T20:32:33.607

在我的公司中，我们将 launch4J 和 NSIS 用于 windows 发行版，将 jdeb 用于 Debian 发行版，并将 Java Web Start 用于一般操作系统。这工作得很好。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-03-27T06:47:56.027

请尝试[InstallJammer](http://www.installjammer.com/)。我用过的最好的。免费且功能强大。足以供个人和商业使用。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-08-25T06:17:01.043

您是否考虑过高级安装程序？

我已经多次使用它，特别是在 Windows 和 Mac 上。不需要脚本或 Ant。所有图形用户界面。非常简单易懂。不是免费的，但值得每一分钱。

- 以管理员身份启动
- 文件关联
- 自定义安装主题 + 内置主题
- 带有 JRE 的软件包
- 安装位置
- 本地启动画面实施
- 您可以创建服务和安装事件
- 先决条件
- JRE 最低版本和最高版本

还有更多。并且不要让它扭曲，我与这些家伙没有任何联系......他们的应用程序真是太棒了。

# flash - What are the options for delivering Flash video?

> ID：7726
> 
> 赞同：3
> 
> 时间：2008-08-11T12:40:01.140
> 
> 标签：flash, video

I'd like a concise introduction to the different options.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T12:42:33.413

From [Wikipedia](http://en.wikipedia.org/wiki/Flash_video)

> > **Embedded in an SWF file** using the Flash authoring tool (supported in Flash Player 6 and later). The entire file must be transferred before playback can begin. Changing the video requires rebuilding the SWF file.[citation needed]
> > 
> > **Progressive download via HTTP** (supported in Flash Player 7 and later). This method uses ActionScript to include an externally hosted Flash Video file client-side for playback. Progressive download has several advantages, including buffering, use of generic HTTP servers, and the ability to reuse a single SWF player for multiple Flash Video sources. Flash Player 8 includes support for random access within video files using the partial download functionality of HTTP, sometimes this is referred to as streaming. However, unlike streaming using RTMP, HTTP "streaming" does not support real-time broadcasting. Streaming via HTTP requires a custom player and the injection of specific Flash Video metadata containing the exact starting position in bytes and timecode of each keyframe. Using this specific information, a custom Flash Video player can request any part of the Flash Video file starting at a specified keyframe. For example, Google Video and Youtube support progressive downloading and can seek to any part of the video before buffering is complete. The server-side part of this "HTTP pseudo-streaming" method is fairly simple to implement, for example in PHP, as an Apache HTTPD module, or a lighttpd module. Rich Media Project provides players and Flash components compatible with "HTTP pseudo-streaming" method.
> > 
> > **Streamed via RTMP to the Flash Player** using the Flash Media Server (formerly called Flash Communication Server), VCS, ElectroServer, Wowza Pro or the open source Red5 server. As of April 2008, there are four stream recorders available for this protocol, re-encoding screencast software excluded.

There is a useful introduction from Adobe here: [Flash video learning guide](http://www.adobe.com/devnet/flash/articles/video_guide_02.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T13:11:49.030

You can stream FLV videos using a simple player like [JW FLV Media Player](http://www.jeroenwijering.com/?item=JW_FLV_Player). It supports several streaming methods, playlists etc. It's actively developed, and I have found it to be the best solution for streaming flash video.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-20T16:05:25.803

除了 yoavf 的回答，您还可以使用 haxevideo 作为开源 rtmp 视频流服务器。

# windows - 如何在 OpenGL 中显示 unicode 文本？

> ID：7737
> 
> 赞同：6
> 
> 时间：2008-08-11T12:50:43.787
> 
> 标签：windows, opengl, unicode

有没有一种在 Windows 下的 opengl 中显示 unicode 文本的好方法？例如，当您必须处理不同的语言时。最常见的方法如

```
#define FONTLISTRANGE 128
GLuint list;
list = glGenLists(FONTLISTRANGE);
wglUseFontBitmapsW(hDC, 0, FONTLISTRANGE, list); 
```

只是不会这样做，因为您无法为所有 unicode 字符创建足够的列表。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-23T15:06:20.917

您还应该查看[FTGL 库](http://sourceforge.net/projects/ftgl/)。

> FTGL 是一个免费的跨平台开源 C++ 库，它使用 Freetype2 来简化 OpenGL 应用程序中的渲染字体。FTGL 支持位图、像素图、纹理图、轮廓、多边形网格和挤压多边形渲染模式。

这个项目已经休眠了一段时间，但最近又回到了开发中。我还没有更新我的项目以使用最新版本，但你应该检查一下。

它允许通过[FreeType](http://freetype.sourceforge.net/index2.html)字体库使用任何 True Type 字体。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-16T12:10:04.727

我推荐阅读这个[OpenGL 字体教程](http://dmedia.dprogramming.com/?n=Tutorials.TextRendering1)。它适用于 D 编程语言，但它很好地介绍了实现字形缓存系统以使用 OpenGL 呈现文本所涉及的各种问题。本教程涵盖了 Unicode 合规性、抗锯齿和字距调整技术。

D 对于任何了解 C++ 的人来说都非常容易理解，并且文章的大部分内容都是关于一般技术，而不是实现语言。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-26T15:05:20.090

我推荐上面已经推荐的 FTGL，但是我自己实现了一个 freetype/OpenGL 渲染器，并认为如果你想自己重新发明这个轮子，你可能会发现代码很方便。不过，我真的推荐 FTGL，它使用起来少了很多麻烦。:)

```
* glTextRender class by Semi Essessi
 *
 * FreeType2 empowered text renderer
 *
 */

#include "glTextRender.h"
#include "jEngine.h"

#include "glSystem.h"

#include "jMath.h"
#include "jProfiler.h"
#include "log.h"

#include <windows.h>

FT_Library glTextRender::ftLib = 0;

//TODO::maybe fix this so it use wchar_t for the filename
glTextRender::glTextRender(jEngine* j, const char* fontName, int size = 12)
{
#ifdef _DEBUG
    jProfiler profiler = jProfiler(L"glTextRender::glTextRender");
#endif
    char fontName2[1024];
    memset(fontName2,0,sizeof(char)*1024);
    sprintf(fontName2,"fonts\\%s",fontName);

    if(!ftLib)
    {
#ifdef _DEBUG
        wchar_t fn[128];
        mbstowcs(fn,fontName,strlen(fontName)+1);
        LogWriteLine(L"\x25CB\x25CB\x25CF Font: %s was requested before FreeType was initialised", fn);
#endif
        return;
    }

    // constructor code for glTextRender
    e=j;

    gl = j->gl;

    red=green=blue=alpha=1.0f;

    face = 0;

    // remember that for some weird reason below font size 7 everything gets scrambled up
    height = max(6,(int)floorf((float)size*((float)gl->getHeight())*0.001666667f));
    aHeight = ((float)height)/((float)gl->getHeight());

    setPosition(0.0f,0.0f);

    // look in base fonts dir
    if(FT_New_Face(ftLib, fontName2, 0, &face ))
    {
        // if we dont have it look in windows fonts dir
        char buf[1024];
        GetWindowsDirectoryA(buf,1024);
        strcat(buf, "\\fonts\\");
        strcat(buf, fontName);

        if(FT_New_Face(ftLib, buf, 0, &face ))
        {
            //TODO::check in mod fonts directory
#ifdef _DEBUG
            wchar_t fn[128];
            mbstowcs(fn,fontName,strlen(fontName)+1);
            LogWriteLine(L"\x25CB\x25CB\x25CF Request for font: %s has failed", fn);
#endif
            face = 0;
            return;
        }
    }

    // FreeType uses 64x size and 72dpi for default
    // doubling size for ms 
    FT_Set_Char_Size(face, mulPow2(height,7), mulPow2(height,7), 96, 96);

    // set up cache table and then generate the first 256 chars and the console prompt character
    for(int i=0;i<65536;i++) 
    {
        cached[i]=false;
        width[i]=0.0f;
    }

    for(unsigned short i = 0; i < 256; i++) getChar((wchar_t)i);
    getChar(CHAR_PROMPT);

#ifdef _DEBUG
    wchar_t fn[128];
    mbstowcs(fn,fontName,strlen(fontName)+1);
    LogWriteLine(L"\x25CB\x25CB\x25CF Font: %s loaded OK", fn);
#endif
}

glTextRender::~glTextRender()
{
    // destructor code for glTextRender
    for(int i=0;i<65536;i++)
    {
        if(cached[i])
        {
            glDeleteLists(listID[i],1);
            glDeleteTextures(1,&(texID[i]));
        }
    }

    // TODO:: work out stupid freetype crashz0rs
    try
    {
        static int foo = 0;
        if(face && foo < 1)
        {
            foo++;
            FT_Done_Face(face);
            face = 0;
        }
    }
    catch(...)
    {
        face = 0;
    }
}

// return true if init works, or if already initialised
bool glTextRender::initFreeType()
{
    if(!ftLib)
    {
        if(!FT_Init_FreeType(&ftLib)) return true;
        else return false;
    } else return true;
}

void glTextRender::shutdownFreeType()
{
    if(ftLib)
    {
        FT_Done_FreeType(ftLib);
        ftLib = 0;
    }
}

void glTextRender::print(const wchar_t* str)
{
    // store old stuff to set start position
    glPushAttrib(GL_TRANSFORM_BIT);
    // get viewport size
    GLint viewport[4];
    glGetIntegerv(GL_VIEWPORT, viewport);

    glMatrixMode(GL_PROJECTION);
    glPushMatrix();
    glLoadIdentity();

    gluOrtho2D(viewport[0],viewport[2],viewport[1],viewport[3]);
    glPopAttrib();

    float color[4];
    glGetFloatv(GL_CURRENT_COLOR, color);

    glPushAttrib(GL_LIST_BIT | GL_CURRENT_BIT  | GL_ENABLE_BIT | GL_TRANSFORM_BIT); 
    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glLoadIdentity();

    glEnable(GL_TEXTURE_2D);
    //glDisable(GL_DEPTH_TEST);

    // set blending for AA
    glEnable(GL_BLEND);
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);

    glTranslatef(xPos,yPos,0.0f);

    glColor4f(red,green,blue,alpha);

    // call display lists to render text
    glListBase(0u);
    for(unsigned int i=0;i<wcslen(str);i++) glCallList(getChar(str[i]));

    // restore old states
    glMatrixMode(GL_MODELVIEW);
    glPopMatrix();
    glPopAttrib();

    glColor4fv(color);

    glPushAttrib(GL_TRANSFORM_BIT);
    glMatrixMode(GL_PROJECTION);
    glPopMatrix();
    glPopAttrib();
}

void glTextRender::printf(const wchar_t* str, ...)
{
    if(!str) return;

    wchar_t*    buf = 0;
    va_list  parg;
    va_start(parg, str);

    // allocate buffer
    int len = (_vscwprintf(str, parg)+1);
    buf = new wchar_t[len];
    if(!buf) return;
    vswprintf(buf, str, parg);
    va_end(parg);

    print(buf);

    delete[] buf;
}

GLuint glTextRender::getChar(const wchar_t c)
{
    int i = (int)c;

    if(cached[i]) return listID[i];

    // load glyph and get bitmap
    if(FT_Load_Glyph(face, FT_Get_Char_Index(face, i), FT_LOAD_DEFAULT )) return 0;

    FT_Glyph glyph;
    if(FT_Get_Glyph(face->glyph, &glyph)) return 0;

    FT_Glyph_To_Bitmap(&glyph, FT_RENDER_MODE_NORMAL, 0, 1);

    FT_BitmapGlyph bitmapGlyph = (FT_BitmapGlyph)glyph;
    FT_Bitmap& bitmap = bitmapGlyph->bitmap;

    int w = roundPow2(bitmap.width);
    int h = roundPow2(bitmap.rows);

    // convert to texture in memory
    GLubyte* texture = new GLubyte[2*w*h];

    for(int j=0;j<h;j++)
    {
        bool cond = j>=bitmap.rows;

        for(int k=0;k<w;k++)
        {
                texture[2*(k+j*w)] = 0xFFu;
                texture[2*(k+j*w)+1] = ((k>=bitmap.width)||cond) ? 0x0u : bitmap.buffer[k+bitmap.width*j];
        }
    }

    // store char width and adjust max height
    // note .5f
    float ih = 1.0f/((float)gl->getHeight());
    width[i] = ((float)divPow2(face->glyph->advance.x, 7))*ih;
    aHeight = max(aHeight,(.5f*(float)bitmap.rows)*ih);

    glPushAttrib(GL_LIST_BIT | GL_CURRENT_BIT  | GL_ENABLE_BIT | GL_TRANSFORM_BIT);

    // create gl texture
    glGenTextures(1, &(texID[i]));

    glEnable(GL_TEXTURE_2D);

    glBindTexture(GL_TEXTURE_2D, texID[i]);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP);

    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA8, w, h, 0, GL_LUMINANCE_ALPHA, GL_UNSIGNED_BYTE, texture);

    glPopAttrib();

    delete[] texture;

    // create display list
    listID[i] = glGenLists(1);

    glNewList(listID[i], GL_COMPILE);

    glBindTexture(GL_TEXTURE_2D, texID[i]);

    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();

    // adjust position to account for texture padding
    glTranslatef(.5f*(float)bitmapGlyph->left, 0.0f, 0.0f);
    glTranslatef(0.0f, .5f*(float)(bitmapGlyph->top-bitmap.rows), 0.0f);

    // work out texcoords
    float tx=((float)bitmap.width)/((float)w);
    float ty=((float)bitmap.rows)/((float)h);

    // render
    // note .5f
    glBegin(GL_QUADS);
        glTexCoord2f(0.0f, 0.0f);
        glVertex2f(0.0f, .5f*(float)bitmap.rows);
        glTexCoord2f(0.0f, ty);
        glVertex2f(0.0f, 0.0f);
        glTexCoord2f(tx, ty);
        glVertex2f(.5f*(float)bitmap.width, 0.0f);
        glTexCoord2f(tx, 0.0f);
        glVertex2f(.5f*(float)bitmap.width, .5f*(float)bitmap.rows);
    glEnd();

    glPopMatrix();

    // move position for the next character
    // note extra div 2
    glTranslatef((float)divPow2(face->glyph->advance.x, 7), 0.0f, 0.0f);

    glEndList();

    // char is succesfully cached for next time
    cached[i] = true;

    return listID[i];
}

void glTextRender::setPosition(float x, float y)
{
    float fac = ((float)gl->getHeight());
    xPos = fac*x+FONT_BORDER_PIXELS; yPos = fac*(1-y)-(float)height-FONT_BORDER_PIXELS;
}

float glTextRender::getAdjustedWidth(const wchar_t* str)
{
    float w = 0.0f;

    for(unsigned int i=0;i<wcslen(str);i++)
    {
        if(cached[str[i]]) w+=width[str[i]];
        else
        {
            getChar(str[i]);
            w+=width[str[i]];
        }
    }

    return w;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-11T12:56:41.603

你可能不得不在纹理内存中生成你自己的“字形缓存”，可能会使用某种 LRU 策略来避免破坏所有纹理内存。不像您当前的方法那么简单，但可能是考虑到 unicode 字符数量的唯一方法

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-12-01T09:26:22.077

您应该考虑使用 Unicode 渲染库（例如[Pango](http://en.wikipedia.org/wiki/Pango)）将内容渲染为位图，并将该位图放在屏幕上或纹理中。

渲染 unicode 文本并不简单。所以你不能简单地加载 64K 矩形字形并使用它。

字符可能重叠。例如在这个笑脸中：

( ͡° ͜ʖ ͡°)

一些代码点在前一个字符上堆叠重音符号。考虑这个[值得注意的帖子的](https://stackoverflow.com/a/1732454/58805)摘录：

> ......他的com̡e̶s, ̕h̵i​s un̨ho͞ly radiańcé detro҉ifying all enli̍̈́̂̈́ghtenment, HTML tags lea͠ki̧n͘g fr̶ǫm ̡yo​͟ur eye͢s̸ ̛l̕ik͏e 液体的痛苦，re̸gular 表达的歌声 解析男人的声音sp​在这里我可以看到它你能看到吗我的脸ᵒ神没有no no ono̼oonθ停止一个*̶̶͑̾̾͑̾̾g͇̫͛͆̾ͫ̑͆l͖͉̗̩̳̟̍ͫͥͨeəs͎a̧͈͖r̽̾̈͒͑enootrè̑ͧ̌aͨləzaəlgə是to͇̹̺ɲ̴ȳ̳th̘ë͖̉p̯͍̭o̚n̐y̡h̸̡̪̯ͨ͊̽̅̾ȩ̬̩̾͛ͪ̈͘p̯͍̭o̚nm̖͊̒ͪͩͬ̚̚͜ȇ̴̟̟͙̞ͩ͌͝s̨̥̫͎̭ͯ̿̔

如果你真的想正确地渲染 Unicode，你也应该能够正确地渲染这个。

更新：查看了这个 Pango 引擎，香蕉、大猩猩和整个丛林都是如此。首先它依赖于 Glib，因为它使用 GObjects，其次它不能直接渲染到字节缓冲区中。它具有 Cario 和 FreeType 后端，因此您必须使用其中之一来渲染文本并最终将其导出为位图。到目前为止，这看起来不太好。

除此之外，如果要将结果存储在纹理中，请`pango_layout_get_pixel_extents`在设置文本后使用以获取要呈现文本的矩形的大小。墨迹矩形是包含整个文本的矩形，它的左上位置是相对于逻辑矩形左上的位置。（逻辑矩形的底线是基线）。希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T15:44:54.443

Queso GLC 非常适合这个，我用它在 3D 中渲染中文和西里尔字符。

[http://quesoglc.sourceforge.net/](http://quesoglc.sourceforge.net/)

它附带的 Unicode 文本示例应该可以帮助您入门。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-11T16:54:04.997

您还可以按语言对字符进行分组。根据需要加载每个语言表，当需要切换语言时，卸载之前的语言表并加载新的语言表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-08-04T08:31:03.300

标题栏中支持 Unicode。我刚刚在 Mac 上试过这个，它应该也可以在其他地方工作。如果您有（比如说）一些导入的数据，包括文本标签，并且一些标签可能只包含 unicode，您可以添加一个工具来在标题栏中回显标签。

这不是一个很好的解决方案，但它很容易做到。

# .net - xaml 中的值绑定语法是什么？

> ID：7758
> 
> 赞同：2
> 
> 时间：2008-08-11T13:09:08.693
> 
> 标签：.net, wpf, silverlight, xaml, binding

我正在全面了解 WPF 中的绑定。不过，我在调试 xaml 中的解析错误时遇到了很多麻烦。有人能告诉我这个小块有什么问题吗？：

```
<Border Name="TrackBackground"
    Margin="0"
    CornerRadius="2"                     
    Grid.Row="1"
    Grid.Column="1"
    Background="BlanchedAlmond"
    BorderThickness="1"
    Height="{TemplateBinding Height}">

    <Canvas Name="PART_Track" Background="DarkSalmon" Grid.Row="1" Grid.Column="1">
        <Thumb Name="ThumbKnob" Height="{Binding ElementName=Part_Track, Path=Height, Mode=OneWay}" />
    </Canvas>
</Border> 
```

破坏的是数据绑定。`InvalidAttributeValue`当我尝试运行它时，我得到了ThumbKnob.Height 的异常。我知道我一定错过了一些基本的东西。所以填上我吧，堆垛机，我的感激之情将是无限的。

* * *

更改 ElementName 没有帮助。我必须有其他我没有得到的东西。

我应该提到我正在 Silverlight 中对此进行测试。我从 Internet Explorer 中得到的确切消息是：

`XamlParseException: Invalid attribute value for property Height.`

整个事情都在 ControlTemplate 中。我正在制作一个滑块控件，只是为了自学这些概念。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T04:33:00.357

Silverlight 不支持 Binding 的 ElementName 属性。

您会注意到，如果您进入后面的代码或在类资源管理器中检查 Binding 对象，它没有名为 ElementName 的属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-11T13:56:55.617

我通常用来调试数据绑定的是添加一个转换器，我可以在 VS.NET 中设置断点。

所以绑定将是这样的：

```
{Binding ElementName=PART_Track, Path=Height, Mode=OneWay, Converter={StaticResources DebugConverter}} 
```

然后转换器可以是 IValueConverter 的空实现，在 Convert 方法中设置断点并查看 Height 设置为...

不要忘记将您的转换器添加到您的资源中......

也许价值是 NaN ？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T14:58:21.593

嗯，在这一点上 WPF 和 Silverlight 之间可能存在很大差异。

我似乎没有任何问题，甚至在 WPF 窗口中编译和运行此示例：

```
<Slider Width="400" Height="20">
    <Slider.Template>
        <ControlTemplate>
            <Border Name="TrackBackground"
                Margin="0"
                CornerRadius="2"                     
                Grid.Row="1"
                Grid.Column="1"
                Background="BlanchedAlmond"
                BorderThickness="1">

                <Canvas x:Name="PART_Track" Background="DarkSalmon" Grid.Row="1" Grid.Column="1">
                    <Thumb Name="ThumbKnob" Height="{Binding ElementName=PART_Track, Path=Height, Mode=OneWay}" />
                </Canvas>
            </Border>
        </ControlTemplate>
    </Slider.Template>
</Slider> 
```

也许 Silverlight 在 Thumb 类中的属性较少......

[http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.thumb.aspx](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.thumb.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-12T12:00:26.977

好的，这是交易：

在silverlight 中，您不能以声明方式将值从一个UI 元素绑定到另一个。我在这里尝试做的唯一方法是在 C# 代码中。

我昨天有一个参考，但现在我想你只需要相信我的话:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T13:26:38.393

首先它的外壳问题...

改变

```
Part_Track
```

到

```
PART_Track
```

这将解决您的绑定错误..

但我不认为这是你想要做的..

您可以使用 Grid 而不是画布，Thumb 会自动调整大小。Canvas 并没有真正的高度，因为它并不真正关心它的孩子的高度......

希望这可以帮助...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T13:35:27.550

顺便说一句，模板中有边框吗？

因为如果边框不在模板（ControlTemplate 或 DataTemplate）中，则不需要 TemplateBinding

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-17T22:44:50.493

Silverlight 3 现在包括 ElementName 绑定...

# asp.net - 使用 JavaScript 更改 ASP.NET 标签的可见性

> ID：7773
> 
> 赞同：33
> 
> 时间：2008-08-11T13:24:19.037
> 
> 标签：asp.net, javascript

我有一个 ASP.NET 页面，其中有一个不可见的 asp:button。我无法使用 JavaScript 将其变为可见，因为它没有呈现到页面上。

我能做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-08-11T13:28:55.470

如果您需要在客户端对其进行操作，则不能在服务器端使用 Visible 属性。相反，将其 CSS 显示样式设置为“无”。例如：

```
<asp:Label runat="server" id="Label1" style="display: none;" /> 
```

然后，您可以通过以下方式使其在客户端可见：

```
document.getElementById('Label1').style.display = 'inherit'; 
```

您可以使用以下命令再次隐藏它：

```
document.getElementById('Label1').style.display = 'none'; 
```

请记住，在实践中，ClientID 可能比“Label1”更复杂。您需要将 ClientID 与 getElementById 一起使用，而不是服务器端 ID（如果它们不同）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-11T13:55:29.630

试试这个。

```
<asp:Button id="myButton" runat="server" style="display:none" Text="Click Me" />

<script type="text/javascript">
    function ShowButton() {
        var buttonID = '<%= myButton.ClientID %>';
        var button = document.getElementById(buttonID);
        if(button) { button.style.display = 'inherit'; }
    }
</script> 
```

不要使用服务器端代码来执行此操作，因为这需要回发。您可以设置一个隐藏按钮的 CSS 属性，而不是使用 Visibility="false"。然后，在 javascript 中，只要您想再次显示该按钮，就将该属性切换回来。

使用 ClientID 是因为如果按钮位于命名容器控件内，它可能与服务器 ID 不同。其中包括各种面板。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-11T14:13:11.763

继续**戴夫·沃德**所说的话：

*   您不能将*Visible*属性设置为 false，因为不会呈现控件。
*   您应该使用*Style*属性将其*显示*设置为*none*。

* * *

**页面/控件设计**

```
<asp:Label runat="server" ID="Label1" Style="display: none;" />

<asp:Button runat="server" ID="Button1" /> 
```

* * *

**背后的代码**

在加载部分的某处：

```
Label label1 = (Label)FindControl("Label1");
((Label)FindControl("Button1")).OnClientClick = "ToggleVisibility('" + label1.ClientID + "')"; 
```

* * *

**Javascript 文件**

```
function ToggleVisibility(elementID)
{
    var element = document.getElementByID(elementID);

    if (element.style.display = 'none')
    {
        element.style.display = 'inherit';
    }
    else
    {
        element.style.display = 'none';
    }
} 
```

* * *

当然，如果您不想切换而只是显示按钮/标签，则相应地调整 javascript 方法。

这里重要的一点是，您需要将有关`ClientID`要在客户端操作的控件的信息发送到 javascript 文件，或者设置全局变量或通过函数参数，如我的示例所示。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-19T14:41:24.277

当你做这样的事情时，你需要警惕[XSS ：](http://en.wikipedia.org/wiki/Cross-site_scripting)

```
document.getElementById('<%= Label1.ClientID %>').style.display 
```

在这种情况下，没有人能够篡改 Label1 的 ClientID，但为了安全起见，您可能希望通过[AntiXss 库的](http://www.microsoft.com/downloads/details.aspx?familyid=EFB9C819-53FF-4F82-BFAF-E11625130C25&displaylang=en)方法之一传递它的值：

```
document.getElementById('<%= AntiXss.JavaScriptEncode(Label1.ClientID) %>').style.display 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-02-10T22:36:52.633

这是我发现的最简单的方法：

```
 BtnUpload.Style.Add("display", "none");
        FileUploader.Style.Add("display", "none");
        BtnAccept.Style.Add("display", "inherit");
        BtnClear.Style.Add("display", "inherit"); 
```

我在 Else 中有相反的情况，所以它也处理显示它们。这可以在页面的加载中进行，也可以在刷新页面上的控件的方法中进行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T13:29:38.700

如果您等到页面加载完毕，然后将按钮的显示设置为无，那应该可以。然后你可以让它在以后可见。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-11T13:32:43.343

确保 Visible 属性设置为 true，否则控件不会呈现到页面。然后你可以使用脚本来操作它。

# java - 我想推荐一本关于 Eclipse 的富客户端平台 (RCP) 的书

> ID：7779
> 
> 赞同：11
> 
> 时间：2008-08-11T13:30:21.850
> 
> 标签：java, eclipse, rcp, myeclipse

我已经阅读了亚马逊上的几篇评论，有些书似乎已经过时了。我目前使用的是使用 Eclipse 3.3 的 MyEclipse 6.5。我很想听听那些有学习 RCP 经验的人的意见，以及他们开始使用的参考资料。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-26T14:17:10.447

我从事 Eclipse RCP 开发已经快 2 年了。刚开始时，我想要一本书来寻求帮助，许多人告诉我，使用 Eclipse 最好使用[Eclipsepedia](http://wiki.eclipse.org/index.php/Rich_Client_Platform)和 Google。

但是，我从 D'Anjou 等人的“ [The Java Developer's Guide to Eclipse](https://rads.stackoverflow.com/amzn/click/com/0321305027) ”开始，当我需要更好的起点或好的参考资料时，我仍然会参考它。它现在可能有点过时了，但是非常透彻并且真正解释了 Eclipse 框架的工作原理。就像任何事情一样，如果您已经弄清楚了支持它的框架是如何工作的，那么 RCP 并不难掌握，并且您将从代码中获得更多的好处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T19:22:11.547

我同意 Thomas Owens 关于“ [Eclipse 富客户端平台：设计、编码和打包 Java(TM) 应用程序](https://rads.stackoverflow.com/amzn/click/com/0321334612)”的观点，并将“ [Eclipse：构建商业质量插件](https://rads.stackoverflow.com/amzn/click/com/032142672X)”添加到相当过时但仍然有些有用的书籍列表中在 Eclipse RCP 上。尽管后者对富客户端平台的介绍不多，但它解释了很多关于 Eclipse 插件体系结构的知识，这对于 RCP 应用程序的开发人员来说是有用的知识。

自从这两本书出版以来，Eclipse RCP 平台已经有了很多改进，所以我真的希望这些书的新版本很快就会出版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T13:37:15.423

虽然我没有亲身经历，但我的几个朋友做过 Eclipse RCP 开发，他们使用了《[Eclipse Rich Client Platform: Designing, Coding, and Packaging Java(TM) Applications](https://rads.stackoverflow.com/amzn/click/com/0321334612)》一书。他们似乎很喜欢它，我自己看了看，它似乎很有用。如果我打算在 Eclipse 上进行 RCP 开发，我可能会得到这本书。

澄清一下——这本书是面向 Eclipse 3.1 的，由于我自己没有做过任何 RCP 开发，我不确定有多少变化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-22T13:34:56.083

近期发布：

[Eric Clayberg 和 Dan Rubel 的《eclipse 插件》第三版](https://rads.stackoverflow.com/amzn/click/com/0321553462)

[Vladimir Silva 的实用 Eclipse 富客户端平台项目](https://rads.stackoverflow.com/amzn/click/com/1430218274)r=1-1

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-18T15:19:12.223

我发现很多书都缺乏深度。至少不足以证明他们的价格是合理的。你可以在网上找到很多教程，这些教程涵盖了这些书籍的功能以及更多内容。它们通常也没有书籍那么过时。

我真的很喜欢 Lars Vogel 的教程：[http ://www.vogella.com/eclipse.html](http://www.vogella.com/eclipse.html)

它们简短易懂，有足够的图片和材料让你继续前进。有了基本的了解之后，再去google就可以了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T13:42:12.560

我读了Thomas 推荐的这[本书](https://rads.stackoverflow.com/amzn/click/com/0321334612)，它真的很值得一读，虽然不是很最新。

# xml - 如何将 XML 文档分成三份（或者甚至更好，分成 n 份）？

> ID：7846
> 
> 赞同：7
> 
> 时间：2008-08-11T15:04:21.363
> 
> 标签：xml

我想使用我熟悉的语言 - Java、C#、Ruby、PHP、C/C++，尽管任何语言或伪代码的示例都非常受欢迎。

将大型 XML 文档拆分为仍然是有效 XML 的较小部分的最佳方法是什么？出于我的目的，我需要将它们分成大约三分之一或四分之一，但为了提供示例，将它们分成 n 个组件会很好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T22:57:37.637

使用 DOM 解析 XML 文档无法扩展。

这个[Groovy](http://groovy.codehaus.org/)脚本使用 StAX（XML 流 API）在顶级元素（与根文档的第一个子元素共享相同的 QName）之间拆分 XML 文档。它非常快，可以处理任意大型文档，并且在您要将大型批处理文件拆分为较小的部分时非常有用。

需要 Java 6 上的 Groovy 或CLASSPATH 中的 StAX API 和实现，例如[Woodstox](http://woodstox.codehaus.org/)

```
import javax.xml.stream.*

pieces = 5
input = "input.xml"
output = "output_%04d.xml"
eventFactory = XMLEventFactory.newInstance()
fileNumber = elementCount = 0

def createEventReader() {
    reader = XMLInputFactory.newInstance().createXMLEventReader(new FileInputStream(input))
    start = reader.next()
    root = reader.nextTag()
    firstChild = reader.nextTag()
    return reader
}

def createNextEventWriter () {
    println "Writing to '${filename = String.format(output, ++fileNumber)}'"
    writer = XMLOutputFactory.newInstance().createXMLEventWriter(new FileOutputStream(filename), start.characterEncodingScheme)
    writer.add(start)
    writer.add(root)
    return writer
}

elements = createEventReader().findAll { it.startElement && it.name == firstChild.name }.size()
println "Splitting ${elements} <${firstChild.name.localPart}> elements into ${pieces} pieces"
chunkSize = elements / pieces
writer = createNextEventWriter()
writer.add(firstChild)
createEventReader().each { 
    if (it.startElement && it.name == firstChild.name) {
        if (++elementCount > chunkSize) {
            writer.add(eventFactory.createEndDocument())
            writer.flush()
            writer = createNextEventWriter()
            elementCount = 0
        }
    }
    writer.add(it)
}
writer.flush() 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T15:13:14.107

当然，您总是可以提取顶级元素（这是否是您想要的粒度取决于您）。在 C# 中，您将使用 XmlDocument 类。例如，如果您的 XML 文件看起来像这样：

```
<Document>
  <Piece>
     Some text
  </Piece>
  <Piece>
     Some other text
  </Piece>
</Document> 
```

然后你会使用这样的代码来提取所有的片段：

```
XmlDocument doc = new XmlDocument();
doc.Load("<path to xml file>");
XmlNodeList nl = doc.GetElementsByTagName("Piece");
foreach (XmlNode n in nl)
{
    // Do something with each Piece node
} 
```

获得节点后，您可以在代码中对它们进行处理，或者您可以将节点的整个文本传输到它自己的 XML 文档中并对其进行操作，就好像它是一个独立的 XML 片段一样（包括保存它）回磁盘等）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T15:31:11.183

正如 DannySmurf 在这里提到的，这完全是关于 xml 文档的结构。
如果您只有两个巨大的“顶级”标签，那么将很难将其拆分为既可以将其重新合并在一起，又可以将其作为有效 xml 逐个读取的方式。

给定一个包含很多单独部分的文档，例如 DannySmurfs 示例中的文档，它应该相当容易。
伪 C# 中的一些粗略代码：

```
int nrOfPieces = 5;
XmlDocument xmlOriginal = some input parameter..

// construct the list we need, and fill it with XmlDocuments..
var xmlList = new List<XmlDocument>();
for (int i = 0; i < nrOfPieces ; i++)
{
    var xmlDoc = new XmlDocument();
    xmlDoc.ChildNodes.Add(new XmlNode(xmlOriginal.FistNode.Name));
    xmlList.Add(xmlDoc);
}

var nodeList = xmlOriginal.GetElementsByTagName("Piece")M
// Copy the nodes from the original into the pieces..
for (int i = 0; i < nodeList .Count; i++)
{
    var xmlDoc = xmlList[i % nrOfPieces];
    var nodeToCopy = nodeList[i].Clone();
    xmlDoc.FirstNode.ChildNodes.Add(nodeToCopy);
} 
```

这应该为您提供具有正确 xml 的 n 文档以及将它们重新合并在一起的可能性。
但同样，它取决于 xml 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-11T15:28:08.990

这更像是评论而不是答案，但不会：

```
XmlDocument doc = new XmlDocument();
doc.Load("path"); 
```

一次读取整个文件？只是想我应该提出这一点，因为从托马斯的问题来看，他担心读取大文件并想打破这个过程..

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T15:33:56.733

它会一次读取整个文件。但是，根据我的经验，如果您只是在读取文件、进行一些处理（即分解它）然后继续您的工作，那么 XmlDocument 将很快完成它的创建/读取/收集周期，以至于可能没关系。

当然，这取决于“大”文件是什么。如果它是一个 30 MB 的 XML 文件（我认为它对于 XML 文件来说很大），它可能不会有任何区别。如果它是一个 500 MB 的 XML 文件，那么在没有大量 RAM 的系统上使用 XmlDocument 将变得非常有问题（但是，在这种情况下，我认为使用 XmlReader 手动选择文件的时间会更重要障碍）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T13:13:02.860

看起来您正在使用 C# 和 .NET 3.5。我遇到过一些帖子，这些帖子建议在带有 XmlReader 的文件流上使用 yield 类型的算法。

这里有几篇博客文章可以帮助您开始这条道路：

*   [使用 Linq 流式传输到 SQL 第 1 部分](http://blogs.msdn.com/xmlteam/archive/2007/03/05/streaming-with-linq-to-xml-part-1.aspx)
*   [使用 Linq To SQL 流式传输第 2 部分](http://blogs.msdn.com/xmlteam/archive/2007/03/24/streaming-with-linq-to-xml-part-2.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T13:24:18.263

不确定您正在执行哪种类型的处理，但是对于非常大的 XML，我一直是基于事件的处理的粉丝。也许这是我的 Java 背景，但我真的很喜欢 SAX。您需要进行自己的状态管理，但是一旦您完成了这些，它就会成为解析 XML 的一种非常有效的方法。

[http://saxdotnet.sourceforge.net/](http://saxdotnet.sourceforge.net/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T13:31:30.663

我要和youphoric一起去这个。对于非常大的文件，SAX（或任何其他流解析器）将在处理中提供很大帮助。使用 DOM，您可以只收集顶级节点，但您仍然必须解析整个文档才能做到这一点……使用流式解析器和基于事件的处理可以让您“跳过”您不感兴趣的节点；使处理速度更快。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T15:40:43.223

如果您对 Perl 不完全过敏，那么[XML::Twig](http://search.cpan.org/dist/XML-Twig/ "模块的 CPAN 页面")附带了一个名为 [xml_split](http://search.cpan.org/dist/XML-Twig/tools/xml_split/xml_split "xml_split 文档")的工具，它可以拆分文档，生成格式良好的 XML 部分。您可以在树的级别、大小或 XPath 表达式上进行拆分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-19T16:24:58.840

我制作了一个 YouTube 视频，展示[了如何](http://www.youtube.com/watch?v=9ANBa9i5LhM)使用[foxe （来自](http://www.firstobject.com/dn_editor.htm)[Firstobject](http://www.firstobject.com/about.htm)的免费 XML 编辑器）拆分 XML 文件，而不管输入和输出文件的大小如何，只使用少量内存。

此 CMarkup XML 读取器（拉式解析器）和 XML 写入器解决方案的内存使用量取决于从输入文件单独传输到输出文件的子文档的大小，或 16 KB 的最小块大小。

```
分裂（）
{
  CMarkup xmlInput、xmlOutput；
  xmlInput.Open("50MB.xml", MDF_READFILE);
  int nObjectCount = 0, nFileCount = 0;
  而 ( xmlInput.FindElem("//ACT") )
  {
    如果（nObjectCount == 0）
    {
      ++n文件计数；
      xmlOutput.Open("piece" + nFileCount + ".xml", MDF_WRITEFILE );
      xmlOutput.AddElem("root");
      xmlOutput.IntoElem();
    }
    xmlOutput.AddSubDoc(xmlInput.GetSubDoc());
    ++n对象计数；
    如果（nObjectCount == 5）
    {
      xmlOutput.Close();
      nObjectCount = 0;
    }
  }
  如果（nObjectCount）
    xmlOutput.Close();
  xmlInput.Close();
  返回 nFileCount；
}
```

# php - 什么是 PHP 安全模式 GID？

> ID：7851
> 
> 赞同：8
> 
> 时间：2008-08-11T15:12:53.903
> 
> 标签：php, unix

根据safe_mode_gid 上的[PHP 安全模式文档：](http://uk3.php.net/features.safe-mode)

> 默认情况下，安全模式在打开文件时会进行 UID 比较检查。如果您想将此放宽为 GID 比较，请打开 safe_mode_gid。是否使用 UID (FALSE) 或 GID (TRUE) 检查文件访问。

对于在 Web 服务器上运行的 PHP 脚本，UID（用户标识符）检查和 GID（组标识符）检查有什么区别？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-11T16:05:07.310

这只会让您在 Web 服务器设置方面更加灵活。使用 safe_mode_gid，您应该能够为系统上的每个用户运行单独的 PHP/httpd 进程，但只要它们都作为同一个组 (GID) 和共享文件运行，则让每个进程能够读取一些共享文件归该组所有。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-28T01:46:35.883

例如，网络服务器用户名和组是**apache:www**，

如果您设置检查 UID，则 php 进程将只能访问用户**apache**拥有的任何文件。因此，如果您的系统上运行着另一个网络服务器，例如用户名和组为**tomcat:www**的 tomcat，则 php 将无法访问由 tomcat 进程创建的任何文件，因为它归**tomcat**用户所有。

但是如果你改用 GID 检查，tomcat 进程创建的文件将可以被 php 进程读取，因为它们属于同一个**www**组

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T15:30:23.667

安全模式 UID 检查用于防止用户访问其他人的文件。GID 用于防止 GROUP 用户访问其他 GROUPS 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-23T11:48:18.083

大多数答案并不完全正确或详细...不要忘记`safe_mode`检查 SCRIPT 的所有者是否与您要访问的文件的所有者匹配。它与 httpd 用户：组无关。

例如，您的 httpd 可以运行为`apache:daemon`，您的脚本由`some_user:users`和您要写入的文件所拥有`some_other_user:users`。

如果您不激活`safe_mode_gid`，脚本将无法访问该文件，因为用户不匹配。

这是脚本创建文件夹然后尝试在该文件夹中创建文件时的常见现象。

文件夹创建成功，因为父文件夹与创建它的脚本属于同一用户（很可能是由“some_user”上传的）。

但是，创建的文件夹现在归 httpd 用户所有，比方说`apache:daemon`

如果`safe_mode`处于活动状态，您将无法在此文件夹中创建文件，因为脚本所有者 ( `some_user`) 与文件夹所有者 ( ) 不匹配`apache`。

即使您激活`safe_mode_gid`，它也不会起作用，因为脚本组是“用户”，而文件夹组是“守护进程”。

最好的解决方案是为 ftp 用户和 httpd 设置相同的组。不要忘记您还必须允许对“可写”文件夹上的组进行写访问，这不太安全，因为由于您的所有用户都在同一个组中，因此 httpd 进程可以访问其他用户的文件，因为您激活了`safe_mode_gid`.

实际上，您应该结合`safe_mode_gid`+`open_basedir`并将用户的主页设置为`open_basedire`值以避免这种情况。

高温高压

# ruby-on-rails - 为什么所有 Active Record 都讨厌？

> ID：7864
> 
> 赞同：103
> 
> 时间：2008-08-11T15:30:30.313
> 
> 标签：ruby-on-rails, design-patterns, oop, activerecord

随着我对 OOP 的了解越来越多，并开始实施各种设计模式，我不断回想起人们讨厌[Active Record](http://en.wikipedia.org/wiki/Active_record_pattern)的案例。

通常，人们说它不能很好地扩展（以 Twitter 为例）——但没有人真正解释***为什么***它不能很好地扩展；和/或如何在没有缺点的情况下实现 AR 的优点（通过类似但不同的模式？）

希望这不会变成一场关于设计模式的圣战——我想知道的只是****具体**** Active Record 出了什么问题。

如果它不能很好地扩展，为什么不呢？

它还有什么其他问题？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-08-11T21:02:03.870

有[ActiveRecord 设计模式](http://en.wikipedia.org/wiki/Active_record_pattern)和[ActiveRecord Rails ORM 库](http://api.rubyonrails.com/classes/ActiveRecord/Base.html)，还有大量针对 .NET 和其他语言的仿制品。

这些都是不同的东西。他们大多遵循该设计模式，但以许多不同的方式对其进行扩展和修改，因此在有人说“ActiveRecord 糟透了”之前，需要通过说“哪个 ActiveRecord，有堆？”来限定它。

我只熟悉 Rails 的 ActiveRecord，我会尝试解决在使用它的上下文中提出的所有投诉。

> @布拉姆
> 
> 我在 Active Records 中看到的问题是，它总是只有一张表

代码：

```
class Person
    belongs_to :company
end
people = Person.find(:all, :include => :company ) 
```

这会生成带有 的 SQL `LEFT JOIN companies on companies.id = person.company_id`，并自动生成关联的 Company 对象，因此您可以这样做`people.first.company`，并且不需要访问数据库，因为数据已经存在。

> @pix0r
> 
> Active Record 的固有问题是自动生成和执行数据库查询以填充对象和修改数据库记录

代码：

```
person = Person.find_by_sql("giant complicated sql query") 
```

不鼓励这样做，因为它很丑陋，但是对于您只需要简单地编写原始 SQL 的情况，它很容易完成。

> @蒂姆沙利文
> 
> ...并且您选择了模型的几个实例，您基本上是在执行“select * from ...”

代码：

```
people = Person.find(:all, :select=>'name, id') 
```

这只会从数据库中选择名称和 ID 列，映射对象中的所有其他“属性”都将为零，除非您手动重新加载该对象，等等。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-08-26T18:10:08.283

我一直发现 ActiveRecord 适用于模型相对扁平的基于 CRUD 的快速应用程序（例如，没有很多类层次结构）。但是，对于具有复杂 OO 层次结构的应用程序，[DataMapper](http://martinfowler.com/eaaCatalog/dataMapper.html)可能是更好的解决方案。虽然 ActiveRecord 假设表和数据对象之间的比率为 1:1，但这种关系在更复杂的域中变得笨拙。在他[关于模式的书中](http://martinfowler.com/eaaCatalog/)，Martin Fowler 指出 ActiveRecord 在您的模型相当复杂的情况下往往会崩溃，并建议使用[DataMapper](http://martinfowler.com/eaaCatalog/dataMapper.html)作为替代方案。

我发现这在实践中是正确的。在您的域中有很多继承的情况下，将继承映射到 RDBMS 比映射关联或组合更难。

我这样做的方式是让控制器通过这些 DataMapper（或“服务层”）类访问“域”对象。这些并不直接反映数据库，而是充当某些现实世界对象的 OO 表示。假设您的域中有一个 User 类，并且需要在检索该 User 对象时已经加载了对其他对象的引用或集合。数据可能来自许多不同的表，而 ActiveRecord 模式可能会使其变得非常困难。

例如，您的控制器代码通过调用 UserMapper.getUser() 方法的 API 来检索用户对象，而不是直接加载用户对象并使用 ActiveRecord 样式 API 访问数据。正是该映射器负责从它们各自的表中加载任何关联的对象，并将完成的用户“域”对象返回给调用者。

本质上，您只是添加了另一层抽象来使代码更易于管理。无论您的 DataMapper 类是否包含原始的自定义 SQL，还是对数据抽象层 API 的调用，甚至是自己访问 ActiveRecord 模式，对于接收良好的填充用户对象的控制器代码来说都无关紧要。

无论如何，我就是这样做的。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-22T21:35:07.883

我认为人们为什么“讨厌” ActiveRecord 和它的“错误”之间可能有一组非常不同的原因。

在讨厌的问题上，对任何与 Rails 相关的东西都有很多毒液。至于它有什么问题，它很可能就像所有技术一样，在某些情况下它是一个不错的选择，也存在有更好选择的情况。在我的经验中，如果你不能利用 Rails ActiveRecord 的大部分特性，那就是数据库的结构很糟糕。如果您在没有主键的情况下访问数据，并且违反了第一范式，其中需要大量存储过程来访问数据，那么您最好使用更多只是 SQL 包装器的东西。如果您的数据库结构相对较好，ActiveRecord 可以让您利用它。

添加到回复评论者的主题，这些评论者说 ActiveRecord 中的事情很困难，并带有代码片段 rejoinder

> @Sam McAfee 假设您的域中有一个 User 类，并且需要在检索该 User 对象时已经加载了对其他对象的引用或集合。数据可能来自许多不同的表，而 ActiveRecord 模式可能会使其变得非常困难。

```
user = User.find(id, :include => ["posts", "comments"])
first_post = user.posts.first
first_comment = user.comments.first 
```

通过使用 include 选项，ActiveRecord 允许您覆盖默认的延迟加载行为。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-11-27T09:02:16.343

我漫长而迟到的回答，甚至不完整，但很好地解释了为什么我讨厌这种模式，意见甚至一些情绪：

1) 短版：Active Record在数据库和应用程序代码之间创建了一个“**强绑定”的“****薄层**” 。这没有解决任何逻辑问题，没有任何问题，根本没有问题。恕我直言，它不提供任何值，除了程序员的一些**语法糖**（然后可能使用“对象语法”来访问关系数据库中存在的一些数据）。为程序员创造一些舒适的努力应该（恕我直言......）更好地投资于低级数据库访问工具，例如一些简单，容易，简单和类似方法的变体（当然，概念和优雅随着使用的语言）。****`hash_map get_record( string id_value, string table_name, string id_column_name="id" )`****

 ****2) 长版本：在我对事物进行“概念控制”的任何数据库驱动项目中，我避免使用 AR，这很好。我通常构建一个**分层架构**（你迟早会把你的软件分层，至少在大中型项目中是这样）：

A1) 数据库本身、表、关系，如果 DBMS 允许的话，甚至是一些逻辑（MySQL 现在也成熟了）

A2）很多时候，不仅仅是一个数据存储：文件系统（数据库中的 blob 并不总是一个好的决定......），遗留系统（想象自己“如何”访问它们，可能有很多种类......但就是这样不是重点……）

B）数据库访问层（在这个级别，工具方法，帮助轻松访问数据库中的数据非常受欢迎，但AR在这里没有提供任何价值，除了一些语法糖）

C) 应用对象层：“应用对象”有时是数据库中表格的简单行，但大多数时候它们无论如何都是**复合**对象，并且附加了一些更高的逻辑，因此在这个级别上投入时间在 AR 对象上显然是无用的，浪费了宝贵的编码人员时间，因为这些对象的“真正价值”、“更高逻辑”需要在 AR 对象之上实现，无论如何——无论有无 AR！而且，例如，为什么要抽象“日志条目对象”？应用程序逻辑代码编写它们，但它应该具有更新或删除它们的能力吗？听起来很傻，并且`App::Log("I am a log message")`比使用更容易一些数量级`le=new LogEntry(); le.time=now(); le.text="I am a log message"; le.Insert();`. 例如：在您的应用程序的日志视图中使用“日志条目对象”将适用于 100、1000 甚至 10000 条日志行，但迟早您将不得不优化 - 我敢打赌，在大多数情况下，您只会在你的应用程序逻辑中使用那个漂亮的小 SQL SELECT 语句（这完全打破了 AR 的想法......），而不是将那个小语句包装在刚性固定的 AR 想法框架中，并使用大量代码包装和隐藏它。您浪费在编写和/或构建 AR 代码上的时间本可以投入到一个更智能的界面上，用于阅读日志条目列表（很多很多方面，没有限制）。编码人员应该**敢于发明新的抽象**来实现适合预期应用程序的应用程序逻辑，而**不是愚蠢地重新实现愚蠢的模式**，第一眼就很好听！

D）应用程序逻辑 - 实现交互对象的逻辑以及应用程序逻辑对象的创建，删除和列出（！）（不，这些任务很少应该锚定在应用程序逻辑对象本身：你桌子上的纸是否告诉你办公室里所有其他工作表的名称和位置？忘记列出对象的“静态”方法，这很愚蠢，这是一个糟糕的折衷方案，旨在使人类的思维方式适合 [some-not-all-AR-framework-like -]AR 思维）

E) 用户界面——嗯，我将在下面几行中写的内容非常、非常、非常主观，但根据我的经验，基于 AR 构建的项目经常忽略应用程序的 UI 部分——时间浪费在创建晦涩的抽象上. 最后，这样的应用程序浪费了编码人员的大量时间，感觉就像是编码人员为编码人员提供的应用程序，内部和外部都倾向于技术。编码员感觉很好（努力工作终于完成，一切都完成并正确，根据纸上的概念......），客户“只需要了解它需要那样”，因为那是“专业”......好的，对不起，我离题了;-)

好吧，诚然，这一切都是主观的，但这是我的经验（Ruby on Rails 除外，它可能会有所不同，而且我对这种方法的实践经验为零）。

在付费项目中，我经常听到需要从创建一些“活动记录”对象作为更高级别应用程序逻辑的构建块开始。以我的经验，这**通常很明显**是客户（大多数情况下是软件开发公司）没有一个好的概念，一个大的观点，一个产品最终应该是什么的概述的某种借口。那些客户在僵化的框架下思考（“十年前的项目运行良好......”），他们可能会充实实体，他们可能会定义实体关系，他们可能会分解数据关系并定义基本的应用程序逻辑，但随后他们就停止了把它交给你，认为这就是你所需要的……他们往往缺乏一个完整的应用程序逻辑、用户界面、可用性等概念……他们缺乏大视野，他们缺乏对应用程序的热爱。细节，他们希望你遵循 AR 的方式，因为.. 好吧，为什么，它在几年前的那个项目中起作用，它让人们忙碌而沉默？我不知道。但“细节” 把男人和男孩分开，或者..原来的广告口号是怎样的？;-)

经过多年（十年积极开发经验），每当客户提到“活动记录模式”时，我的警钟就会响起。我学会了试着让他们**回到那个重要的概念阶段**，让他们三思而后行，试着让他们展示他们的概念弱点，或者如果他们没有辨别力就完全避免他们（最后，你知道，一个客户还没有知道它想要什么，甚至可能认为它知道但不知道，或者试图免费将概念工作外化给我，这花费了我许多宝贵的时间、几天、几周和几个月的时间，生命太短了......）。

所以，最后：这就是为什么我讨厌那种愚蠢的“主动记录模式”，我会并且会尽可能避免它。

**编辑**：我什至称之为无模式。它不能解决任何问题（模式并不意味着创建语法糖）。它产生了许多问题：所有问题的根源（在此处的许多答案中都提到了......）是，**它只是将**旧的、开发良好且功能强大的 SQL 隐藏在一个受模式定义极其有限的接口后面。

这种模式用语法糖代替了灵活性！

想一想，AR 为你解决了哪些问题？

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-08-25T09:42:35.590

有些消息让我感到困惑。一些答案将指向“ORM”与“SQL”或类似的东西。

事实上，AR 只是一种简化的编程模式，您可以在其中利用域对象来编写数据库访问代码。

这些对象通常具有业务属性（bean 的属性）和一些行为（通常对这些属性起作用的方法）。

AR 只是对与数据库相关的任务说“向这些域对象添加一些方法”。

而且我不得不说，从我的观点和经验来看，我不喜欢这种模式。

乍一看，它听起来不错。一些现代 Java 工具（如 Spring Roo）使用这种模式。

对我来说，真正的问题在于 OOP 问题。AR 模式迫使您以某种方式将对象的依赖项添加到基础设施对象。这些基础设施对象让领域对象通过 AR 建议的方法查询数据库。

我一直说，两个层次是项目成功的关键。服务层（业务逻辑驻留或可以通过某种远程技术导出，例如 Web 服务）和领域层。在我看来，如果我们为解析 AR 模式的领域层对象添加一些依赖项（不是真正需要的），我们的领域对象将更难与其他层或（罕见的）外部应用程序共享。

AR 的 Spring Roo 实现很有趣，因为它不依赖于对象本身，而是依赖于一些 AspectJ 文件。但是，如果以后您不想使用 Roo 并且必须重构项目，AR 方法将直接在您的域对象中实现。

另一个角度来看。想象一下，我们不使用关系数据库来存储我们的对象。例如，假设应用程序将我们的域对象存储在 NoSQL 数据库中或仅存储在 XML 文件中。我们会在我们的领域对象中实现执行这些任务的方法吗？我不这么认为（例如，在 XM 的情况下，我们会将与 XML 相关的依赖项添加到我们的域对象中......我认为真的很难过）。那么为什么我们必须在领域对象中实现关系数据库方法，就像 Ar 模式所说的那样？

总而言之，AR 模式听起来更简单，适合小型和简单的应用程序。但是，当我们有复杂的大型应用程序时，我认为经典的分层架构是一种更好的方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-26T19:19:25.370

> 问题是关于 Active Record 设计模式。不是 orm 工具。

最初的问题是用 rails 标记的，是指使用 Ruby on Rails 构建的 Twitter。Rails 中的 ActiveRecord 框架是 Fowler 的 Active Record 设计模式的实现。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-11T16:22:52.967

关于 Active Record 的投诉，我看到的主要内容是，当您围绕表格创建模型并选择模型的多个实例时，您基本上是在执行“select * from ...”。这对于编辑记录或显示记录很好，但是如果您想显示数据库中所有联系人的城市列表，您可以执行“从...中选择城市”并且只获取城市. 使用 Active Record 执行此操作需要您选择所有列，但仅使用 City。

当然，不同的实现会以不同的方式处理这个问题。尽管如此，这是一个问题。

现在，您可以通过为您正在尝试做的特定事情创建一个新模型来解决这个问题，但有些人会争辩说这比收益更多的努力。

我，我挖掘 Active Record。:-)

高温高压

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-26T18:31:26.623

尽管关于 SQL 优化的所有其他评论肯定是有效的，但我对活动记录模式的主要抱怨是它通常会导致[阻抗不匹配](http://en.wikipedia.org/wiki/Object-relational_impedance_mismatch)。我喜欢保持我的域干净并正确封装，活动记录模式通常会破坏所有希望。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-11T19:50:26.293

我喜欢 SubSonic 只做一栏的方式。
任何一个

```
DataBaseTable.GetList(DataBaseTable.Columns.ColumnYouWant) 
```

， 或者：

```
Query q = DataBaseTable.CreateQuery()
               .WHERE(DataBaseTable.Columns.ColumnToFilterOn,value);
q.SelectList = DataBaseTable.Columns.ColumnYouWant;
q.Load(); 
```

但是在延迟加载方面，Linq 仍然是王者。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-11T21:14:48.870

@BlaM：有时我刚刚为连接结果实现了一个活动记录。不一定总是关系表 <--> Active Record。为什么不是“加入语句的结果”<--> Active Record？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-06-13T07:26:16.290

我将谈论 Active Record 作为一种设计模式，我没有见过 ROR。

一些开发人员讨厌 Active Record，因为他们阅读了有关编写干净整洁代码的智能书籍，这些书籍指出 Active Record 违反单一责任原则，违反 DDD 规则，即域对象应该是持久无知的，以及此类书籍中的许多其他规则.

Active Record 中的第二件事域对象往往与数据库是一对一的，这可能被认为是某些系统（主要是 n 层）的限制。

那只是抽象的东西，我还没有看到 ruby​​ on rails 实际实现这种模式。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-11T16:46:14.917

我在 Active Records 中看到的问题是，它总是只有**一张**表。没关系，只要您真的只使用那一张表，但在大多数情况下，当您使用数据时，您会在某处进行某种联接。

是的，就性能而言，**连接**通常比**不连接**更差，但**连接** *通常*比**“假”连接**更好，方法是首先读取整个表 A，然后使用获得的信息来读取和过滤表 B。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-15T14:32:24.233

ActiveRecord 的问题在于它自动为您生成的查询可能会导致性能问题。

您最终会使用一些不直观的技巧来优化查询，这让您想知道首先手动编写查询是否会更省时。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-20T13:39:29.437

尝试做一个多对多的多态关系。没那么容易。特别是当您不使用 STI 时。

# asp.net - 删除 Loginview 顶部的栏以进行格式化

> ID：7873
> 
> 赞同：1
> 
> 时间：2008-08-11T15:37:30.983
> 
> 标签：asp.net, webforms

我正在使用 a 制作一个网络表单`LoginView`，问题是因为该控件包含一个灰色条，告诉您它是什么类型的控件，它会正确格式化页面（它`LoginView1`位于顶部）。

有没有办法把它隐藏起来，`LoginView`因为它`contentPlaceholder`做得很好。

我发现您可以删除 ID，但这似乎是一种 hack，因为它会停止程序访问

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-11T23:03:23.970

我可能误解了你的问题，但是......

只有当您在 IDE 的“设计视图”中查看页面时（您使用的是 Visual Studio 吗？），“告诉您它是什么类型的控件”的“灰色条”才会显示。
运行页面后，此标签将不可见。

当您在“设计视图”中查看具有动态/服务器端内容的页面时，“看起来不正确”的页面很常见。

当页面没有填充动态内容时，诸如您正在谈论的标签/灰色条之类的小东西可以帮助您在页面上工作。

因此，我发现 99.9% 的时间我在 IDE 中使用“源视图”，因为随着您的页面内容变得更加动态，“设计视图”变得更加无用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T15:50:05.950

我不知道有一个属性可以控制它（在 MSDN 上找不到），但我认为您可以遍历 LoginView 的 Controls 属性并隐藏该面板/标签/任何内容。

# c++ - 如何在 C++ 中打开文件？

> ID：7880
> 
> 赞同：37
> 
> 时间：2008-08-11T15:50:51.660
> 
> 标签：c++, file, io

我想以 C++ 方式打开一个文件进行阅读。我需要能够做到：

*   文本文件，这将涉及某种读取行功能。

*   二进制文件，这将提供一种将原始数据读入`char*`缓冲区的方法。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-08-11T15:59:48.303

[`ifstream`](http://en.cppreference.com/w/cpp/io/basic_ifstream)如果您只想阅读，则需要使用 an （使用 an`ofstream`来写入，或`fstream`两者都使用 an）。

要以文本模式打开文件，请执行以下操作：

```
ifstream in("filename.ext", ios_base::in); // the in flag is optional 
```

要以二进制模式打开文件，您只需添加“二进制”标志。

```
ifstream in2("filename2.ext", ios_base::in | ios_base::binary ); 
```

使用该[`ifstream.read()`](http://en.cppreference.com/w/cpp/io/basic_istream/read)函数读取一个字符块（以二进制或文本模式）。使用该[`getline()`](http://en.cppreference.com/w/cpp/string/basic_string/getline)函数（它是全局的）来读取整行。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-08-11T15:58:06.980

有三种方法可以做到这一点，具体取决于您的需要。您可以使用老式的 C 方式并调用`fopen`/ `fread`/ `fclose`，或者您可以使用 C++ fstream 工具 ( `ifstream`/ `ofstream`)，或者如果您使用 MFC，请使用`CFile`类，它提供了完成实际文件操作的函数。

所有这些都适用于文本和二进制文件，尽管没有一个具有特定的 readline 功能。在这种情况下，您最有可能做的是使用 fstream 类（fstream.h）并使用流运算符（<< 和 >>）或 read 函数来读/写文本块：

```
int nsize = 10;
std::vector<char> somedata(nsize);
ifstream myfile;
myfile.open("<path to file>");
myfile.read(somedata.data(), nsize);
myfile.close(); 
```

请注意，如果您使用的是 Visual Studio 2005 或更高版本，则可能无法使用传统的 fstream（有一个新的 Microsoft 实现，它略有不同，但完成相同的事情）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-12-14T13:12:21.917

要每行打开和读取文本文件行，您可以使用以下命令：

```
// define your file name
string file_name = "data.txt";

// attach an input stream to the wanted file
ifstream input_stream(file_name);

// check stream status
if (!input_stream) cerr << "Can't open input file!";

// file contents  
vector<string> text;

// one line
string line;

// extract all the text from the input file
while (getline(input_stream, line)) {

    // store each line in the vector
    text.push_back(line);
} 
```

要打开和读取二进制文件，您需要在输入流中显式声明读取格式为二进制，并使用流成员函数读取没有显式解释的内存[`read()`](http://www.cplusplus.com/reference/istream/istream/read/)：

```
// define your file name
string file_name = "binary_data.bin";

// attach an input stream to the wanted file
ifstream input_stream(file_name, ios::binary);

// check stream status
if (!input_stream) cerr << "Can't open input file!";

// use function that explicitly specifies the amount of block memory read 
int memory_size = 10;

// allocate 10 bytes of memory on heap
char* dynamic_buffer = new char[memory_size];

// read 10 bytes and store in dynamic_buffer
file_name.read(dynamic_buffer, memory_size); 
```

执行此操作时，您需要`#include`标题：`<iostream>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-03-29T19:04:35.590

```
#include <iostream>
#include <fstream>
using namespace std;

int main () {
  ofstream file;
  file.open ("codebind.txt");
  file << "Please writr this text to a file.\n this text is written using C++\n";
  file.close();
  return 0;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-07-17T22:31:22.497

```
#include <iostream>
#include <fstream>
using namespace std;

void main()
{
    ifstream in_stream; // fstream command to initiate "in_stream" as a command.
    char filename[31]; // variable for "filename".
    cout << "Enter file name to open :: "; // asks user for input for "filename".
    cin.getline(filename, 30); // this gets the line from input for "filename".
    in_stream.open(filename); // this in_stream (fstream) the "filename" to open.
    if (in_stream.fail())
    {
        cout << "Could not open file to read.""\n"; // if the open file fails.
        return;
    }
    //.....the rest of the text goes beneath......
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-26T12:34:32.250

按照步骤，

1.  包括头文件或名称空间以访问 File 类。
2.  制作文件类对象取决于您的 IDE 平台（即 CFile、QFile、fstream）。
3.  现在您可以轻松地找到打开/读取/关闭/getline 或其他任何文件的类方法。

> ```
> CFile/QFile/ifstream m_file;
> m_file.Open(path,Other parameter/mood to open file); 
> ```

要读取文件，您必须制作缓冲区或字符串来保存数据，并且可以在 read() 方法中传递该变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-13T08:54:48.390

```
**#include<fstream> //to use file
#include<string>  //to use getline
using namespace std;
int main(){
ifstream file;
string str;
file.open("path the file" , ios::binary | ios::in);
while(true){
   getline(file , str);
   if(file.fail())
       break;
   cout<<str;
}
}** 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2018-03-29T20:15:06.727

```
#include <fstream>

ifstream infile;
infile.open(**file path**);
while(!infile.eof())
{
   getline(infile,data);
}
infile.close(); 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-08-11T16:07:31.330

fstream 很棒，但我会更深入地介绍一下[RAII](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)。

一个经典示例的问题是您被迫自己关闭文件，这意味着您将不得不将您的架构弯曲到这个需要。RAII 利用 C++ 中的自动析构函数调用为您关闭文件。

**更新**：似乎 std::fstream 已经实现了 RAII，所以下面的代码没用。我将把它留在这里，作为 RAII 的一个例子。

```
class FileOpener
{
public:
    FileOpener(std::fstream& file, const char* fileName): m_file(file)
    { 
        m_file.open(fileName); 
    }
    ~FileOpeneer()
    { 
        file.close(); 
    }

private:
    std::fstream& m_file;
}; 
```

您现在可以像这样在代码中使用此类：

```
int nsize = 10;
char *somedata;
ifstream myfile;
FileOpener opener(myfile, "<path to file>");
myfile.read(somedata,nsize);
// myfile is closed automatically when opener destructor is called 
```

了解 RAII 的工作原理可以为您省去一些麻烦和一些主要的内存管理错误。

# tsql - 测试 T-SQL 中的不等式

> ID：7884
> 
> 赞同：47
> 
> 时间：2008-08-11T15:56:42.973
> 
> 标签：tsql, indexing, inequality

我刚刚在 WHERE 子句中遇到了这个问题：

```
AND NOT (t.id = @id) 
```

这与以下相比如何：

```
AND t.id != @id 
```

或与：

```
AND t.id <> @id 
```

我总是自己写后者，但显然其他人的想法不同。一个会比另一个表现更好吗？我知道使用`<>`或`!=`会破坏使用我可能拥有的索引的任何希望，但*肯定*上面的第一种方法会遇到同样的问题吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-08-11T16:02:43.710

这3个将获得相同的确切执行计划

```
declare @id varchar(40)
select @id = '172-32-1176'

select * from authors
where au_id <> @id

select * from authors
where au_id != @id

select * from authors
where not (au_id = @id) 
```

当然，这也取决于索引本身的选择性。我自己总是使用 au_id <> @id

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-08-11T16:01:42.200

请注意，!= 运算符不是标准 SQL。如果您希望您的代码可移植（也就是说，如果您关心的话），请改用 <>。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-05-20T15:25:54.903

#### 需要考虑的等于 null 的逻辑风险

当存在 null 并且未知值被视为 a 时，相等运算符生成一个未知值`false`。 `Not (unknown)`还在`unknown`。

在下面的示例中，我将询问一对夫妇`(a1, b1)`是否等于`(a2, b2)`。请注意，每列有 3 个值`0`：`1`和`NULL`。

```
DECLARE @t table (a1 bit, a2 bit, b1 bit, b2 bit)

Insert into @t (a1 , a2, b1, b2) 
values( 0 , 0 , 0 , NULL )

select 
a1,a2,b1,b2,
case when (
    (a1=a2 or (a1 is null and a2 is null))
and (b1=b2 or (b1 is null and b2 is null))
)
then 
'Equal'
end,
case when not (
    (a1=a2 or (a1 is null and a2 is null))
and (b1=b2 or (b1 is null and b2 is null))
)
then 
'Not Equal'
end,
case when (
    (a1<>a2 or (a1 is null and a2 is not null) or (a1 is not null and a2 is null))
or (b1<>b2 or (b1 is null and b2 is not null) or (b1 is not null and b2 is null))
)
then 
'Different'
end
from @t 
```

请注意，在这里，我们期望的结果是：

*   等于为空
*   不等于不等于
*   不一样才能不一样

但相反，我们得到另一个结果

*   Equal 是 null - 我们所期望的。
*   **不等于为空？？？**
*   不同就是不同——我们所期望的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-11T15:58:48.507

不会对性能造成影响，两种说法都是完全平等的。

高温高压

# perl - 你如何在 Perl 中创建对象？

> ID：7885
> 
> 赞同：12
> 
> 时间：2008-08-11T15:57:35.047
> 
> 标签：perl, oop, syntax

Perl 具有 OOP 特性，但它们很少使用。如何创建和使用带有方法和属性的 Perl 对象？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-08-12T10:54:25.360

你绝对应该看看[`Moose`](http://search.cpan.org/perldoc?Moose)。

```
package Point;
use Moose; # automatically turns on strict and warnings

has 'x' => (is => 'rw', isa => 'Int');
has 'y' => (is => 'rw', isa => 'Int');

sub clear {
    my $self = shift;
    $self->x(0);
    $self->y(0);
} 
```

Moose 免费为您提供（除其他外）构造函数、访问器方法和类型检查！

因此，在您的代码中，您可以：

```
my $p = Point->new({x=>10 , y=>20}); # Free constructor
$p->x(15);     # Free setter
print $p->x(); # Free getter
$p->clear();
$p->x(15.5);   # FAILS! Free type check. 
```

一个好的起点是[`Moose::Manual`](http://search.cpan.org/perldoc?Moose::Manual)和[`Moose::Cookbook`](http://search.cpan.org/perldoc?Moose::Cookbook)

如果您只需要基本的东西，您也可以使用[`Mouse`](http://search.cpan.org/perldoc?Mouse)它，它不完整，但没有大部分编译时间损失。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T19:02:42.350

[驼鹿](http://search.cpan.org/dist/Moose)，绝对的。

```
package Person;
use Moose;
has age => ( isa => Int, is => 'rw'); 
has name => ( isa => Str, is => 'rw'); 
1; 
```

马上，你就有了一个免费的 new() 方法，以及你刚刚用 'has' 定义的属性的访问器方法。所以，你可以说：

```
my $person = Person->new();
$person->age(34);
$person->name('Mike');
print $person->name, "\n"; 
```

等等。不仅如此，您的访问器方法还可以免费进行类型检查（您可以定义自己的类型以及标准类型）。此外，您还可以获得用于子类化的“扩展”、用于角色/特征的“与”以及所有其他很棒的东西，让您可以继续编写良好的健壮可维护的 OO 代码的真正工作。

TMTOWTDI，但这一个有效。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-31T11:45:00.960

目前，每当我想要对象时，我都会使用[Object::InsideOut](http://search.cpan.org/dist/Object-InsideOut/ "对象::InsideOut")，它非常好，并且会为您提供比标准的祝福哈希对象更多的功能。话虽如此，如果我开始一个新项目，我会认真考虑 Moose。

虽然阅读官方 PERL 文档很好，但我**不**建议尝试扮演您自己的对象框架，或使用散列构建对象，这很容易采取简单的道路并将“峰值”直接放入对象“私有”变量中完全打破封装，当你想重构对象时，这会回来咬你。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-15T14:10:39.953

Perl 对象不仅仅是祝福的哈希值。他们是有福的参考。它们可以（并且通常是）有福的散列引用，但它们也可以很容易地成为有福的标量或数组引用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-11T17:12:07.800

[CPAN网站](http://search.cpan.org/dist/perl/pod/perltoot.pod)上的官方教程很好。

CodeProject上还有一篇名为[Camel POOP的好文章。](http://www.codeproject.com/KB/perl/camel_poop.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-07-26T22:50:21.463

如果你想在 Perl 中做 OO，我强烈建议你看看 Moose。但是，如果您不了解 Perl 中的 OO 是什么意思，它就不是很有用。为了更好地理解 Perl OO 如何在底层工作，我在我的博客上写了一个概述：http: [//augustinalareina.wordpress.com/2010/06/06/an-introduction-to-object-orientated-perl/](http://augustinalareina.wordpress.com/2010/06/06/an-introduction-to-object-oriented-perl/)

从数据结构的角度来看，对象是具有一些额外功能的引用。解释器知道将这些特殊引用视为对象，因为它们已被关键字“bless”“祝福”。Blessed 引用包含一个标志，表明它们是一个对象。本质上，这意味着您可以在它们上定义和调用方法。

例如，如果您创建了一个基本的 hashref，这将不起作用： $hashref->foo();

但是如果你创建了一个祝福的 hashref（又名对象），这确实有效： $blessed_hashref->foo();

Moose 是 Perl 中 OOP 的一个优秀模块，因为它创建了一个可执行的 OO 层并自动处理访问器方法，因此您不必定义一堆 getter 和 setter。如果您有兴趣使用 Devel::Peak 查看 Perl 解释器如何存储对象，请点击我在上面发布的博客条目的链接。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-01T03:22:45.230

一方面，每个类都是一个包；[您通过设置包变量@ISA](http://perldoc.perl.org/perltoot.html#Inheritance)（最好在编译时）来建立（如果需要，多个）继承；[您使用bless](http://perldoc.perl.org/functions/bless.html) (REFERENCE [, CLASSNAME])从现有数据（通常但不总是，用于存储实例变量的匿名哈希）创建对象；你调用像 $obj->methodname(@ARGS) 这样的对象方法和像 "CLASSNAME"->methodname(@ARGS) 这样的类方法。可以使用[mro](http://search.cpan.org/perldoc/mro)更改多重继承方法解析顺序。

因为这有点简约并且不强制封装，所以有许多不同的模块提供更多或不同的功能。

# svn - 如何让 Subversion (SVN) 在签到时发送电子邮件？

> ID：7913
> 
> 赞同：52
> 
> 时间：2008-08-11T16:27:55.703
> 
> 标签：svn, hook, post-commit, post-commit-hook

我一直发现签入（提交）邮件对于跟踪其他人在代码库/存储库中所做的工作非常有用。如何设置 SVN 以在每次提交时通过电子邮件发送分发列表？

我在 Windows 上运行客户端，在 Linux 上运行 Apache Subversion 服务器。不过，下面针对各种平台的答案可能对其他人有用。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-08-11T16:35:18.887

您使用[提交后挂钩](http://svnbook.red-bean.com/en/1.7/svn.reposadmin.create.html#svn.reposadmin.create.hooks)。这是一个[指南](http://builddeploy.blogspot.com/2008/01/implementing-subversion-post-commit.html)。

这是一个在每次提交后发送电子邮件的示例 Ruby 脚本：[commit-email.rb](http://svn.apache.org/repos/asf/subversion/trunk/tools/hook-scripts/commit-email.rb)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-08-11T16:48:56.877

看看独立的[Subversion 通知](http://sourceforge.net/projects/svn-notify/)工具**（仅限 Windows！）** 它可以在提交时发送电子邮件等等！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T16:34:31.027

您需要熟悉[存储库挂钩](http://svnbook.red-bean.com/en/1.7/svn-book.html#svn.ref.reposhooks "Subversion Book：存储库挂钩")，尤其是[提交后挂钩](http://www.petefreitag.com/item/244.cfm "使用 Subversion 挂钩发送构建电子邮件")。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-09T11:19:15.043

VisualSVN Server 有有用的提交电子邮件通知钩子`VisualSVNServerHooks.exe`。它支持彩色差异，并且只有在提交影响特定存储库路径时才能发送提交通知。

请参阅[“在 VisualSVN 服务器中配置电子邮件通知”](http://www.visualsvn.com/support/topic/00018/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-12-13T22:04:50.383

1) 使用 sudo apt-get 在 svn 服务器上安装 svnnotify

2）使用你的 repo 的 post-commit 钩子（阅读 svn 网站上的 post-commit hooks）

3) 打开提交后挂钩文件并粘贴以下代码以使用 smtp 服务器发送电子邮件。使用 smtp 很简单，因为您不需要配置 sendmail。

4）确保在\（换行符）之后没有多余的空格。

```
#!/bin/sh

REPOS="$1"
REV="$2"
TO="xyz@yah.com" # who will receive the notifications
FROM="hello@goog.com" # what will be in "FROM" fields

 /usr/bin/svnnotify \

--repos-path "$REPOS" \
--revision "$REV" \
--to $TO \
--from $FROM \
--reply-to $FROM \
--smtp "YOUR.SMTP.MAIL.COM" \
--subject-prefix "[svn commit]" \
--attach-diff -a \
--header 'Message generated on Subversion Check-in.' \
--footer 'OpenSource Team. ' \
--svnlook "/usr/local/bin/svnlook" \
--handler HTML::ColorDiff # make diff pretty 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T16:38:34.323

什么平台？

在 Mac OS XI 上已安装[msmtp](http://msmtp.sourceforge.net/)并在存储库的挂钩下创建了一个提交后脚本。需要为`svn`（或`www`）用户设置 .msmtprc 文件。

```
REPOS="`echo $1 | sed 's/\/{root of repository}//g'` "
REV="$2"
MSG=`/usr/local/bin/svn log -v -r HEAD https://localhost$REPOS`

/usr/local/bin/msmtp {list of recipients} <<EOF
Subject: SVN-Commit $REPOS#$REV
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 8Bit

$MSG
EOF 
```

制作`{root of repository}`并`{list of recipients}`针对您的需求。注意我使用了 UTF-8，因为我们在瑞典有一些特殊字符 (åäö)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-11T17:32:03.763

[这里](https://stackoverflow.com/questions/6155/common-types-of-subversion-hooks#6359)有一个关于提交后挂钩的相关问题。就个人而言，我更喜欢向可以从中获取 RSS 提要的内容发送消息，因为每次提交的电子邮件会很快使我的收件箱超载。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-11T22:22:55.767

在 RSS 提要上借调 @Matt [Miller 。](https://stackoverflow.com/questions/7913/how-do-i-make-subversion-svn-send-email-on-checkins#7986)

[有一个名为WebSVN](http://websvn.tigris.org/)的有用工具，它提供每个存储库和单个分支/标签/文件夹的 RSS 提要以及完整的提交消息。它也是一个很棒的 Web 界面，可以快速查看文件历史记录和提交/差异，而无需运行更新并打开您选择的编辑器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-11T22:31:32.193

正如其他人所说，'什么平台'。在 Windows 上，我使用了“blat”，这是一个免费的命令行 SMTP 邮件程序，以及一个提交后和另一个批处理文件。

后提交看起来像这样：（只需调用另一个批处理文件）

```
 call d:\subversion\repos\rts\hooks\mail %1 %2 
```

mail.bat 看起来像这样：

```
copy d:\subversion\repos\RTS\hooks\Commitmsg.txt %temp%\commit.txt
copy d:\subversion\repos\RTS\hooks\subjbase.txt %temp%\subject.txt
svnlook info -r %2 %1 >> %temp%\commit.txt
echo Revision %2 >> %temp%\commit.txt
svnlook changed -r %2 %1 >> %temp%\commit.txt
svnlook author -r %2 %1 >> %temp%\subject.txt
c:\utils\blat %temp%\commit.txt -t <me@my.email.com> -sf %temp%\subject.txt -server ServerName -f "SVN Admin <svn@my.email.com>" -noh2 
```

编写 SVN 钩子的最大问题是您可能基本上没有环境设置 - 没有 exe 路径，没有临时路径等。尽管在最近的 SVN 构建中这可能有所改进。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-25T20:46:24.203

我使用类似于这个的提交后[脚本](http://gurge.com/blog/2006/09/10/subversion-post-commit-email-hook-in-ruby/)。

它发送了一封漂亮的 HTML 电子邮件。我对其进行了一些更新，其中突出显示了以红色删除的代码并突出显示了以蓝色添加的代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T04:59:25.083

你可以使用[buildbot](http://buildbot.net)。这是一个可以在签到时采取任意操作的工具。这是一个功能齐全的持续集成系统，但如果您只需要电子邮件，它当然可以处理。它具有适用于包括 SVN 在内的各种 SCM 的插件。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-08-17T20:26:34.123

在您的特定颠覆分支的“钩子”目录中，有 9 个模板文件可以帮助您入门。

关键点：subversion 在重命名之前不会执行任何文件。要让 post-commit.tmpl 在 unix 下执行，请将其重命名为“post-commit”。在 Windows 下，将其重命名为“post-commit.bat”或“post-commit.exe”。如果文件名为“post-commit.tmpl”或“post-commit.sh”等，Subversion 将**不会执行该文件。**

此外，请确保该文件可由运行 subversion 的同一用户执行。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-05-30T10:04:47.500

我在 Linux 服务器上分 3 步完成：

1.  创建一个邮件列表 ( `svn-notify@xy.com`) 并将人员添加到列表中。

2.  编辑`/path_to_your_svn/svn/hooks/svn-notify/mailer.conf`

    *   to_addr = svn-notify@xy.com
    *   from_addr = %(作者)s@xy.com
    *   commit_subject_prefix =[XY-SVN]
3.  将此行添加到您的`/path_to_your_svn/svn/hooks/post-commit`文件中：
    `/path_to_your_svn/svn/hooks/svn-notify/mailer.py commit "$REPOS" "$REV" /path_to_your_svn/svn/hooks/svn-notify/mailer.conf`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-11T16:39:47.363

Subversion 源代码中包含一个用 Perl 编写的（大）示例（可以在[此处查看](http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/commit-email.pl.in)）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-27T03:26:04.437

还有[SVNMailer](http://opensource.perlig.de/svnmailer/)，它可以在 Linux 上运行。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-06-19T06:01:11.833

检查[这里描述的](http://tkurek.blogspot.com/2013/05/svn-email-notifications-svn-mod-email_21.html)**svn-mod-email**包。**svn-mod-email**是一个强大的SVN 电子邮件通知管理工具，它以 Debian 存档的形式提供。它易于安装、配置和使用。

 **# mysql - 从 MySQL 中的字符串中删除引号和逗号

> ID：7917
> 
> 赞同：16
> 
> 时间：2008-08-11T16:28:57.683
> 
> 标签：mysql, regex, string

我正在从`CSV`文件中导入一些数据，以及大于`1000`变成的数字`1,100`等。

从中删除引号和逗号以便我可以将其放入`int`字段的好方法是什么？

**编辑：**

数据实际上已经在 MySQL 表中，所以我需要能够使用 SQL。很抱歉混淆了。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-08-11T20:35:49.773

我的猜测是，因为数据能够导入该字段实际上是 varchar 或某些字符字段，因为导入数字字段可能会失败。这是一个测试用例，我只运行了一个 MySQL、SQL 解决方案。

1.  该表只是一个单列 (alpha)，它是一个 varchar。

    ```
    mysql> desc t;

    +-------+-------------+------+-----+---------+-------+
    | Field | Type        | Null | Key | Default | Extra |
    +-------+-------------+------+-----+---------+-------+
    | alpha | varchar(15) | YES  |     | NULL    |       | 
    +-------+-------------+------+-----+---------+-------+ 
    ```

2.  添加记录

    ```
    mysql> insert into t values('"1,000,000"');
    Query OK, 1 row affected (0.00 sec)

    mysql> select * from t;

    +-------------+
    | alpha       |
    +-------------+
    | "1,000,000" | 
    +-------------+ 
    ```

3.  更新声明。

    ```
    mysql> update t set alpha = replace( replace(alpha, ',', ''), '"', '' );
    Query OK, 1 row affected (0.00 sec)
    Rows matched: 1  Changed: 1  Warnings: 0

    mysql> select * from t;

    +---------+
    | alpha   |
    +---------+
    | 1000000 | 
    +---------+ 
    ```

所以最后我使用的语句是：

```
UPDATE table
   SET field_name = replace( replace(field_name, ',', ''), '"', '' ); 
```

我查看了[MySQL 文档](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_replace)，看起来我无法执行正则表达式 find*和 replace*。尽管您可以像[Eldila](https://stackoverflow.com/questions/7917/remove-quotes-and-commas-from-a-string-in-mysql#8135)一样使用正则表达式进行查找，然后使用替代解决方案进行替换。

* * *

还要小心，`s/"(\d+),(\d+)"/$1$2/`因为如果数字多于一个逗号，例如“1,000,000”，您将要进行全局替换（在 perl 中是`s///g`）。但即使使用全局替换，替换也会从您上次停止的地方开始（除非 perl 不同），并且会错过所有其他逗号分隔的组。一个可能的解决方案是使第一个 (\d+) 像这样可选`s/(\d+)?,(\d+)/$1$2/g`，在这种情况下，我需要第二个查找和替换来去除引号。

这里有一些正则表达式仅作用于字符串“1,000,000”的 ruby​​ 示例，请注意字符串中没有双引号，这只是数字本身的字符串。

```
>> "1,000,000".sub( /(\d+),(\d+)/, '\1\2' )
# => "1000,000"  
>> "1,000,000".gsub( /(\d+),(\d+)/, '\1\2' )
# => "1000,000"  
>> "1,000,000".gsub( /(\d+)?,(\d+)/, '\1\2' )
# => "1000000"  
>> "1,000,000".gsub( /[,"]/, '' )
# => "1000000"  
>> "1,000,000".gsub( /[^0-9]/, '' )
# => "1000000" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T19:21:10.113

这是正则表达式的一个很好的例子。您可以在导入之前（更容易）或稍后在 SQL 导入接受这些字符时（几乎不那么容易）对数据运行查找和替换。但无论哪种情况，您都可以使用多种方法进行查找和替换，无论是编辑器、脚本语言、GUI 程序等。请记住，您将要查找和替换*所有*坏字符。

查找逗号和引号（假设只有双引号）的典型正则表达式是：（*黑名单）*

```
/[,"]/ 
```

或者，如果您发现将来可能会发生变化，则此正则表达式会匹配除数字或小数点以外的任何内容。*（白名单）*

```
/[^0-9\.]/ 
```

上面的人讨论的是，我们并不知道您的 CSV 文件中的所有数据。听起来您想从 CSV 文件中的所有数字中删除逗号和引号。但是因为我们不知道 CSV 文件中还有什么，所以我们要确保我们不会损坏其他数据。只是盲目地进行查找/替换可能会影响文件的其他部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-11T16:44:23.923

你可以使用这个 perl 命令。

```
Perl -lne 's/[,|"]//; print' file.txt > newfile.txt 
```

您可能需要稍微尝试一下，但它应该可以解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T16:50:12.773

这是PHP的方式：

```
$stripped = str_replace(array(',', '"'), '', $value); 
```

[链接到 W3Schools 页面](http://w3schools.com/php/func_string_str_replace.asp)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T17:42:48.377

我的命令确实删除了所有 ',' 和 '"'。

为了更严格地转换 sting "1,000"，您将需要以下命令。

```
Perl -lne 's/"(\d+),(\d+)"/$1$2/; print' file.txt > newfile.txt 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T18:24:42.050

实际上，nlucaroni，您的情况不太正确。你的例子不包括双引号，所以

```
id,age,name,...
1,23,phil, 
```

不会匹配我的正则表达式。它需要格式“XXX,XXX”。我想不出什么时候会不正确匹配的例子。

以下所有示例都不会在正则表达式中包含分隔符：

> ```
> "111,111",234
> 234,"111,111"
> "111,111","111,111" 
> ```

如果您能想到一个反例，请告诉我。

干杯!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-11T19:45:44.667

更改后的问题的解决方案基本相同。

您必须使用正则表达式 where 子句运行选择查询。

类似的东西

```
Select *
  FROM SOMETABLE
  WHERE SOMEFIELD REGEXP '"(\d+),(\d+)"' 
```

对于这些行中的每一行，您希望执行以下正则表达式替换 s/"(\d+),(\d+)"/$1$2/ 然后使用新值更新字段。

请 Joseph Pecoraro 认真并在对任何文件或数据库进行大规模更改之前进行备份。因为每当您执行正则表达式时，如果您遗漏了某些情况，您可能会严重混淆数据。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-08-11T17:14:04.097

Daniel 和 Eldila 的回答有一个问题：他们删除了整个文件中的所有引号和逗号。

当我必须做这样的事情时，我通常会首先用制表符替换所有分隔引号和（通常）分号。

*   *搜索：* “;”
*   *替换：* \t

因为我知道我的受影响值将在哪一列中，所以我再进行一次搜索和替换：

*   *搜索：* ^([\t]+)\t([\t]+)\t([0-9]+),([0-9]+)\t
*   *替换：* \1\t\2\t\3\4\t

...给定带逗号的值在第三列中。

您需要以“^”开头，以确保它从行首开始。然后，您重复 ([0-9]+)\t 的频率，因为您只想按原样保留列。

([0-9]+),([0-9]+) 搜索有一个数字，然后是逗号，然后是另一个数字的值。

在替换字符串中，我们使用 \1 和 \2 来保留编辑行中的值，用 \t（制表符）分隔它们。然后我们把 \3\4 （中间没有制表符）放在数字的两个组成部分，不带逗号。之后的所有值都将保持不变。

如果您需要文件使用分号来分隔元素，则可以继续并用分号替换选项卡。但是，如果您省略引号，则必须确保文本值本身不包含任何分号。这就是为什么我更喜欢使用 TAB 作为列分隔符。

我通常在支持 RegExp 的普通文本编辑器 (EditPlus) 中执行此操作，但相同的 regexp 可用于任何编程语言。

# tsql - 在 T-SQL 中查询表锁定方案

> ID：7933
> 
> 赞同：3
> 
> 时间：2008-08-11T16:41:47.487
> 
> 标签：tsql, sysobjects

是否有一些方法可以查询系统表以确定哪些表正在使用哪些锁定方案？我查看了**sysobjects**中的列，但没有跳出任何内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-11T16:44:54.483

啊，只是个白痴：

```
SELECT    name, lockscheme(name)
FROM      sysobjects
WHERE     type="U"
ORDER BY  name 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-11T16:44:29.493

查看 syslockinfo 和 syslocks 系统表，您还可以运行 sp_lock proc

# html - 如何解决IE6中的选择重叠错误？

> ID：7937
> 
> 赞同：28
> 
> 时间：2008-08-11T16:45:10.363
> 
> 标签：html, css, internet-explorer-6, html-select

使用 IE 时，不能将绝对定位的 div 放在选择输入元素上。这是因为 select 元素被认为是一个 ActiveX 对象，并且位于页面中每个 HTML 元素的顶部。

我已经看到人们在打开弹出 div 时隐藏了选择，这会导致控件消失的非常糟糕的用户体验。

FogBugz 实际上有一个非常聪明的解决方案（在 v6 之前），可以在显示弹出窗口时将每个选择变成文本框。这解决了错误并欺骗了用户的眼睛，但行为并不完美。

另一个解决方案是在 FogBugz 6 中，他们不再使用选择元素并在任何地方重新编码。

我目前使用的最后一个解决方案是弄乱 IE 渲染引擎，并强制它也将绝对定位的元素渲染`<div>`为 ActiveX 元素，以确保它可以存在于选择元素之上。这是通过在`<iframe>`内部放置一个不可见的`<div>`并使用以下样式来实现的：

```
#MyDiv iframe
{
    position: absolute;
    z-index: -1;
    filter: mask();
    border: 0;
    margin: 0;
    padding: 0;
    top: 0;
    left: 0;
    width: 9999px;
    height: 9999px;
    overflow: hidden;
} 
```

有没有人有比这个更好的解决方案？

编辑：这个问题的目的是提供更多信息，因为它是一个真正的问题。我发现这个`<iframe>`技巧是一个很好的解决方案，但我仍在寻找改进，比如删除这个会降低可访问性的*丑陋无用标签*。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-16T16:06:35.840

我不知道比 iframe 更好的东西

但我确实想到，这可以通过查找几个变量来添加到 JS 中

1.  即 6
2.  高 Z-Index（如果您将 div 浮动在上方，则往往必须设置 z-index）
3.  一个盒子元素

然后一个查找这些项目并添加 iframe 层的脚本将是一个很好的解决方案

保罗

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T21:41:18.963

感谢 iframe hack 解决方案。它很丑，但仍然很优雅。:)

只是一个评论。如果您碰巧通过 SSL 运行您的网站，则虚拟 iframe 标记需要指定 src，否则 IE6 会发出安全警告。

例子：

```
    <iframe src="javascript:false;"></iframe>

```

我看到有些人建议将 src 设置为 blank.html ......但我更喜欢 javascript 方式。去搞清楚。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-11T17:00:44.437

据我所知，只有两个选项，其中更好的是提到的 iframe 用法。另一个是在显示叠加层时隐藏所有选择，从而导致更奇怪的用户体验。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-03T16:53:41.417

试试这个插件[http://docs.jquery.com/Plugins/bgiframe](http://docs.jquery.com/Plugins/bgiframe)，它应该可以工作！

用法：`$('.your-dropdown-menu').bgiframe();`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T16:48:03.557

我不认为有。我试图在我的工作中解决这个问题。隐藏选择控件是我们能想到的最好的方法（作为一个拥有大量受众的公司商店，用户体验通常不会影响 PM 的决策）。

从我在寻找解决方案时可以在线收集的信息来看，没有好的解决方案。我喜欢 FogBugz 解决方案（许多知名网站都采用相同的方法，例如 Facebook），这实际上是我在自己的项目中使用的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-11T17:07:30.647

我对选择框和 Flash 做同样的事情。

使用叠加层时，隐藏会穿透的底层对象。这不是很好，但它有效。您可以在显示叠加层之前使用 JavaScript 隐藏元素，然后在完成后再次显示它们。

除非绝对必要，否则我尽量不要乱用 iframe。

在覆盖期间使用标签或文本框而不是选择框的技巧很巧妙。我将来可能会使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-20T09:44:09.367

Mootools 有一个使用 iframe 的很好的解决方案，称为 iframeshim。

不值得为此包含 lib，但如果您的项目中有它，您应该知道存在“iframeshim”插件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-30T15:48:10.697

有一个简单直接的 jquery 插件，叫做 bgiframe。开发人员创建它的唯一目的是在 ie6 中解决此问题。

我最近使用过，它就像一个魅力。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-06-02T13:58:21.247

隐藏选择元素时，通过设置“可见性：隐藏”而不是显示：无来隐藏它们，否则浏览器将重新排列文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-21T01:54:53.893

我通过在显示对话框或覆盖时使用 CSS 隐藏选择组件来解决此问题：

> 选择[i].style.visibility = "隐藏";

```
function showOverlay() {
    el = document.getElementById("overlay");
    el.style.visibility = "visible";
    selects = document.getElementsByTagName("select");
    for (var i = 0; i < selects.length; i++) {
        selects[i].style.visibility = "hidden";
    }
}

function hideOverlay() {
    el = document.getElementById("overlay");
    el.style.visibility = "hidden";
    var selects = document.getElementsByTagName("select");
    for (var i = 0; i < selects.length; i++) {
        selects[i].style.visibility = "visible";
    }
} 
```

# css - W3C XHTML/CSS 验证在完成工作时有多重要？

> ID：7940
> 
> 赞同：15
> 
> 时间：2008-08-11T16:46:28.567
> 
> 标签：css, validation, xhtml, cross-browser, w3c

尽管这些天我一直在努力进行完整的验证，但我经常想知道这是否是在浪费时间。如果代码运行并且在所有浏览器中看起来都一样（我使用 browsershots.org 进行验证），那么我是否需要更进一步，或者我只是过于肛门？

创建代码时，您将代码保持在什么级别：

a) 你自己 b) 你的客户

PS Jeff 和公司，为什么堆栈溢出不验证？:)

**编辑：一些很好的见解，我认为，因为我一直如此痴迷于有效，所以我编程知道什么会导致问题，什么不会，所以我比那些先创建网站然后再创建网站的人处于更好的位置“回去解决验证问题”**

**我想我可能会发布另一个关于堆栈溢出的问题；“你是边走边验证还是完成后再回去验证？” 因为这似乎是这个问题的去向**

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-11T16:50:32.867

a) 必须看起来一样

b) 尽可能符合标准，但又不至于妨碍完成工作

在您可以永久访问代码的情况下，我认为标准合规性并不那么重要，因为如果出现问题，您始终可以更改代码。如果您没有永久访问权限（即，您在代码上签字并成为其他人的责任），最好尽可能符合标准，以尽量减少以后的维护麻烦......即使您永远不必再次处理代码，您的声誉会持续存在并且可以传递给其他潜在客户，并且许多团队喜欢将出现的问题归咎于以前的开发人员。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-11T16:52:57.743

我认为这是一个你应该尽可能地努力使用[稳健性原则](http://en.wikipedia.org/wiki/Postel%27s_law)的领域（这对于任何编码领域都是很好的建议）。仅仅因为某些东西今天有效并不意味着它明天也会有效：如果您依赖于特定的 HTML/CSS hack，或者即使您在发布严格有效的代码方面有点松懈，浏览器的下一次迭代可能会很好休息。一旦以正确的方式进行操作可以最大限度地减少这个问题（尽管不能完全缓解它）。

不过，这里有一定的实用主义元素。我当然会尽我所能让客户的网站有效，但我愿意在自己的空间中承担更多风险。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-11T16:55:02.483

我认为只有“技术”人才真正关心“100% 符合标准”。我通常的页面消费者（= 用户）不在乎“菜单边框图片元素”是否没有 alt 属性。

我通常只是确保我没有看到任何明显的错误（所有标签都关闭，所有小写，引号中的属性，...），但如果它在 IE 和 FF 上看起来不错，那就是我所关心的。我真的不在乎我是否在任何 HTML 标记中使用了非标准属性，这样页面就不会针对 DTD 进行验证——只要我获得了我想要获得的视觉结果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-02-05T11:28:13.633

为了理解**为什么**验证很重要，需要了解[浏览器](http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/)在其不同层的工作方式，以及从 Web 浏览器的角度了解 Web 的历史。

您提供给浏览器的 HTML 由浏览器按照 DOM 进行解释，DOM 是一个将整个页面映射为节点层次结构的应用程序编程接口。*该树*的每个部分 都是一种包含不同类型数据的节点。DOM（文档对象模型）是必要的，因为早期 Web 浏览器（Netscape、IE...）实现的 HTML 页面的多样性允许在不重新加载网页的情况下更改网页的外观和内容。为了保持 Web 的跨平台特性，W3C 想要修复这些浏览器的不同实现，提出了 DOM。

DOM 支持成为大多数 Web 浏览器供应商的重中之重，并且一直在努力改进对每个版本的支持。所以，它奏效了。

DOM 是 Web 浏览器启动的最基本步骤。它的主要流程是：

1.  解析 HTML 以构建 DOM 树
2.  渲染树构造
3.  渲染树的布局
4.  绘制渲染树

第 1 步给出了**内容树**，其中标签转换为 DOM 节点。第 2 步给出了包含样式信息的**渲染树**。

那么，**为什么**验证很重要：因为**内容树**和**渲染树**是 Web 浏览器开始工作的基础。它们定义得越明确，对 Web 浏览器就越好。

最终，DOM 也是 JavaScript 事件的基础。因此，它的验证也有助于交互层。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-11T16:55:52.793

我知道这并不能回答您的全部问题，但值得考虑的是，通过使用完全有效的 html，您可以确保您的网站在**未来**尚未发布的网络浏览器中正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T20:08:39.843

我的方法往往是确保我可以在所有页面上完全验证，但是我仍然将页面作为 text/html 而不是 application/xhtml+xml 发送，因此在我错过某些内容的情况下不会出现丑陋的 XML 错误。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-12T20:49:23.367

对我来说，如果我的代码通过验证，我觉得我做得很好。看到 w3c 页面上的绿色复选框让我有点头晕。至于 b 组，他们通常只关心它在浏览器中的外观和工作方式是否相同。他们唯一的地方我发现这是不正确的，是政府部门。它们不仅需要通过 w3c 进行完整验证，还需要通过 ADA 测试（基本上使用屏幕阅读器听起来如何）。

ps 当我说政府部门时，我是指加利福尼亚州和其中的几个县。除了他们之外，我没有与其他政府团体打交道的经验。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-11T16:52:01.193

我认为验证是一个很好的试金石，可以测试你是否正确地做事，所以如果只有一些小问题，为什么不修复它们并确保你的网站至少能被浏览器正确理解（即使他们是否因其他原因以不同的方式呈现事物）？

OTOH，对于大多数项目来说，验证似乎是一件令人头疼的事情，如果你可以让事情跨浏览器工作，那么仅仅在验证上花费额外的一天/一周+是不值得的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-11T07:37:22.987

除了验证器本身非常积极之外，当他们在使用 -moz- 或 -webkit 或 -o- 时标记错误或警告时，即使用浏览器特定的限定词。他们还希望您指定 0px 而不是 0 或其他单位 零是零，无论验证器要检查的单位是什么！

只需尝试验证 WordPress 211 style.css 它会抛出 140 个奇怪的错误，这些错误都是上述性质的，或者验证器正在从解析错误中恢复

如果您无法从谷壳中分拣出小麦，验证器将毫无用处！！！

我们需要能够识别浏览器特定资格条款的验证器！

# sql-server - SQL Server 恢复状态

> ID：7954
> 
> 赞同：7
> 
> 时间：2008-08-11T16:59:35.047
> 
> 标签：sql-server, backup

还原 SQL Server 数据库时，我注意到有 3 种不同的恢复状态可供选择：

*   使用恢复还原
*   无恢复还原
*   用待机恢复

我一直将其保留为默认值，但它们都是什么意思？

（最好用外行的话）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-11T18:10:27.133

门杀手，

简单来说（而不是从 SQLBOL 中复制粘贴），这样您就可以理解这些概念：

RESTORE WITH RECOVERY 使用备份媒体文件（例如 fulldata.bak）将数据库恢复到创建备份文件的时间。如果您想及时返回以将数据库恢复到较早的状态（例如在开发系统时），这非常有用。

如果您想将数据库恢复到最新的数据，（例如，如果您正在执行系统灾难恢复并且您不能丢失任何数据），那么您希望恢复该备份，然后恢复自该备份以来创建的所有事务日志。这是您使用 RESTORE NORECOVERY 的时候。它将允许您将以后的事务日志恢复到故障点（只要您拥有它们）。

RECOVERY WITH STANDBY 是能够将数据库恢复到部分日期（如上面的 NORECOVERY），但允许数据库仍以只读方式使用。新的事务日志仍然可以应用于数据库以使其保持最新（备用服务器）。当恢复完整数据库以使系统恢复运行需要很长时间时，请使用此选项。（即，如果您有一个需要 16 小时才能恢复的多 TB 数据库，但可以每 15 分钟接收一次事务日志更新）。

这有点像一个镜像服务器——但没有将“每一笔交易”实时发送到备份服务器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-04-06T02:58:33.377

您可以将 Microsoft SQL Server 数据库设置为 NORECOVERY、RECOVERY 或 STANDBY 模式。

RECOVERY 是数据库的正常和通常状态，用户可以在其中连接和访问数据库（假设他们设置了适当的权限）。

NORECOVERY 允许数据库管理员恢复其他备份文件，例如差异或事务备份。当数据库处于此状态时，用户无法连接或访问此数据库。

STANDBY 与 NORECOVERY 状态几乎相同，但是它允许用户以 READONLY 访问方式连接或访问数据库。所以用户只能对数据库运行 SELECT 命令。这在日志传送中经常用于报告目的。唯一的缺点是当数据库中有用户在运行查询时，SQL Server 或 DBA 无法恢复额外的备份文件。因此，如果您有很多用户一直在访问数据库，那么复制可能会落后。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-11T17:03:21.343

来自在线书籍，我认为您阅读后很清楚

**NORECOVERY**

指示还原操作不回滚任何未提交的事务。如果必须应用另一个事务日志，则必须指定 NORECOVERY 或 STANDBY 选项。如果未指定 NORECOVERY、RECOVERY 或 STANDBY，则 RECOVERY 为默认值。

SQL Server 要求在还原数据库备份和多个事务日志或需要多个 RESTORE 语句（例如，完整数据库备份后跟差异数据库备份）时，除最后一个 RESTORE 语句之外的所有语句都使用 WITH NORECOVERY 选项。

注意 指定 NORECOVERY 选项时，数据库在此中间、未恢复状态下不可用。

当与文件或文件组恢复操作一起使用时，NORECOVERY 强制数据库在恢复操作后保持在恢复状态。这在以下任何一种情况下都很有用：

正在运行恢复脚本，并且始终应用日志。

使用了一系列文件恢复，并且数据库不打算在两个恢复操作之间可用。

**恢复**

指示还原操作回滚任何未提交的事务。在恢复过程之后，数据库就可以使用了。

如果计划了后续的 RESTORE 操作（RESTORE LOG 或 RESTORE DATABASE 从差异），则应指定 NORECOVERY 或 STANDBY。

如果未指定 NORECOVERY、RECOVERY 或 STANDBY，则 RECOVERY 为默认值。从早期版本的 SQL Server 还原备份集时，可能需要升级数据库。指定 WITH RECOVERY 时会自动执行此升级。有关详细信息，请参阅事务日志备份。

**待机**= undo_file_name

指定撤消文件名，以便可以撤消恢复效果。撤消文件所需的大小取决于未提交事务导致的撤消操作量。如果未指定 NORECOVERY、RECOVERY 或 STANDBY，则 RECOVERY 为默认值。

STANDBY 允许在事务日志恢复之间启动数据库以进行只读访问，并且可以与热备用服务器情况或特殊恢复情况一起使用，在这些情况下，在日志恢复之间检查数据库很有用。

如果指定的撤消文件名不存在，SQL Server 将创建它。如果文件确实存在，SQL Server 将覆盖它。

同一撤消文件可用于同一数据库的连续恢复。有关详细信息，请参阅使用备用服务器。

重要 如果包含指定撤消文件名的驱动器上的可用磁盘空间已用完，则还原操作将停止。

当需要升级数据库时，不允许使用 STANDBY。

# c - 在 C 中解码 printf 语句（Printf Primer）

> ID：7981
> 
> 赞同：4
> 
> 时间：2008-08-11T17:28:56.610
> 
> 标签：c, qt, printf, qstring

我正在努力将 1998 年的一些旧代码带到 21 世纪。该过程的第一步是将 printf 语句转换为[QString](http://qt-project.org/doc/qt-4.8/qstring.html)变量。不管我回头看多少次 printf ，我总是最终忘记一件事或另一件事。所以，为了好玩，让我们一起解码它，为了过去的缘故，并在此过程中为 Stackoverflow 创建第一个小**“printf Primer”**。

在代码中，我遇到了这个小宝石，

```
printf("%4u\t%016.1f\t%04X\t%02X\t%1c\t%1c\t%4s", a, b, c, d, e, f, g); 
```

变量 a、b、c、d、e、f、g 将如何格式化？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-11T18:11:45.697

丹尼基本上是对的。

一种。无符号十进制，最少 4 个字符，空格填充
b. 浮点数，小数点前最少 16 位（填充 0），小数点后 1 位
c. 十六进制，最少 4 个字符，0 填充，字母以大写形式打印
d. 同上，但最少 2 个字符
e. e 假定为 int，转换为 unsigned char 并打印
f。与例如相同
。这可能是一个错字， 4 没有效果。如果是“%.4s”，则最多打印字符串中的 4 个字符。有趣的是，在这种情况下，字符串不需要以空值结尾。

编辑：[jj33在上面](https://stackoverflow.com/users/430/jj33)[的](https://stackoverflow.com/questions/7981/decoding-printf-statements-in-c-printf-primer#8051)b 和 g 中指出 2 个错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-11T18:19:57.943

@ [Jason Day](https://stackoverflow.com/questions/7981/decoding-printf-statements-in-c-printf-primer#8035)，如果字符少于 4 个，我认为最后 %4s 中的 4 很重要。如果超过 4 个您是对的，则 %4s 和 %s 将是相同的，但 g 中少于 4 个字符的 %s 将左对齐，而 %4s 在 4 个字符字段中将右对齐。

b 实际上是整个字段的至少 16 个字符，包括我认为的小数点和小数点后的单个数字（16 个总字符与 18 个总字符）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-18T00:24:53.160

这是我的 printf 入门： [http ://www.pixelbeat.org/programming/gcc/format_specs.html](http://www.pixelbeat.org/programming/gcc/format_specs.html)

我总是用 -Wall 和 gcc 编译，它会警告提供的 printf 格式和变量之间的任何不匹配。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-11T18:38:58.233

@jj33，你是绝对正确的，在这两个方面。

```
#include <stdio.h>

int main(int argc, char *argv[]) {
    char *s = "Hello, World";
    char *s2 = "he";

    printf("4s: '%4s'\n", s);
    printf(".4s: '%.4s'\n", s);
    printf("4s2: '%4s'\n", s2);
    printf(".4s2: '%.4s'\n", s2);

    return 0;
}

$ gcc -o foo foo.c
$ ./foo
4s: 'Hello, World'
.4s: 'Hell'
4s2: '  he'
.4s2: 'he' 
```

接得好！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T17:33:50.843

一种。十进制，四位有效数字

湾。没有把握

C。十六进制，最少 4 个字符

d。也是十六进制，最少 2 个字符

e. 1 个字符

F。字符串，最少 4 个

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-20T19:25:49.987

您真正需要的是一个工具，它采用 printf() 语句中的格式字符串并将它们转换为等效的基于 QString 的函数调用。
有人愿意将他的自由软件捐赠时间花在开发这样的工具上吗？

*包含此类工具源代码的自由软件托管服务的 URL 占位符*

# c# - 从 .NET 服务打印

> ID：7990
> 
> 赞同：23
> 
> 时间：2008-08-11T17:37:27.310
> 
> 标签：c#, .net, windows-services, printing

我现在正在处理一个项目，该项目涉及从另一个应用程序接收消息，格式化该消息的内容并将其发送到打印机。选择的技术是 C# windows 服务。我想，输出可以称为报告，但报告引擎不是必需的。一个简单的模板引擎，如 StringTemplate，甚至输出 HTML 的 XSLT 都可以。我遇到的问题是找到一种从服务打印这种输出的免费方法。由于它*似乎*可以工作，我正在使用 Microsoft 的 RDLC 制作一个原型，填充本地报告，然后将其作为图像呈现到内存流中，然后我将打印出来。问题是：

*   多页打印将是一个大麻烦。
*   仍然必须使用 PrintDocument 来打印内存流，这在 Windows 服务中不受支持（尽管它可能有效 - 原型还没有那么远）
*   如果遇到的数据发生变化，我必须更改数据集和数据被反序列化到的类。坏坏坏。

有没有人不得不远程做这样的事情？有什么建议吗？我已经发布了一个关于在没有用户输入的情况下打印 HTML 的问题，在浪费了大约 3 天之后，我得出的结论是它无法完成，至少不能使用任何免费提供的工具。

感谢所有帮助。

编辑：我们使用 .NET 框架的 2.0 版。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-08-11T19:20:29.707

相信我，与购买第三方组件相比，您将花费更多的钱来为此搜索/开发解决方案。不要重新发明轮子并寻求付费解决方案。

打印是一个复杂的问题，我希望看到为此添加更好的框架支持的那一天。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-11T19:01:49.170

从 Windows 服务打印真的很痛苦。它似乎工作......有时......但最后它不时崩溃或抛出异常，没有任何明确的原因。真是没救了。官方甚至[不支持](http://msdn.microsoft.com/en-us/library/system.drawing.printing(VS.80).aspx)它，没有任何解释，也没有任何替代解决方案的建议。

最近，我遇到了这个问题，经过几次不成功的尝试和实验，我终于有了两个可行的解决方案：

*   使用 Win32 API（例如在 C/C++ 中）编写您自己的打印 DLL，然后通过 P/Invoke 从您的服务中使用它（工作正常）
*   编写您自己的打印 COM+ 组件，然后从您的服务中使用它。我最近成功地选择了这个解决方案（但它是第三方 COM+ 组件，不是自己编写的）它也工作得很好。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-07T14:21:02.707

我已经做到了。这是A *的痛苦。问题是打印需要 GDI 引擎就位，这通常意味着您必须拥有桌面，该桌面仅在您登录时加载。如果您尝试从服务器上的服务执行此操作，那么你通常没有登录。

因此，首先您不能以普通服务用户身份运行，而是以具有交互式登录权限的真实用户身份运行。然后你必须调整服务注册表项（我现在忘记了，如果你真的感兴趣，我必须找到今晚我可以做的代码）。最后，你必须祈祷。

您最大的长期头痛将是打印驱动程序。如果您在没有登录用户的情况下作为服务运行，则某些打印驱动程序喜欢不时弹出对话框。当您的打印机碳粉用完时会发生什么？还是缺纸？驱动程序可能会弹出一个永远不会看到的对话框，并因为没有人登录而阻塞了打印机队列！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-07T14:08:40.157

要回答您的第一个问题，这可能是相当直接的，具体取决于数据。我们有多种基于服务的应用程序可以完全满足您的要求。通常，我们解析传入的文件并将我们自己的 Postscript 或 PCL 包裹在它周围。如果您的布局相当简单，那么您可以使用一些非常基本的 PCL 代码对其进行包装，以提供您想要的字体/打印布局（我很乐意在此离线为您提供一些指导）。

如果您有一个打印就绪文件，您可以将其发送到共享的 UNC 打印机、直接发送到本地安装的打印机，甚至发送到设备的 IP（RAW 或 LPR 类型数据）。

但是，如果您要使用 PDF 路径，最简单的方法是将 PDF 输出发送到支持直接 PDF 打印的打印机（现在很多人都这样做了）。在这种情况下，您只需将 PDF 发送到设备并打印出来。

另一种选择是启动[Ghostscript](http://pages.cs.wisc.edu/~ghost/)，它应该可以免费满足您的需求（检查许可，因为它们有几个不同的版本，一些 GNU，一些 GPL 等）并使用它内置的打印功能或简单地转换为 Postscript 并发送到装置。我在服务应用程序中使用过 Ghostscript 很多次，但不是一个超级粉丝，因为您基本上是在运行命令行应用程序来进行转换。话虽这么说，它是一个稳定的应用程序，确实倾向于优雅地失败

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-11T22:08:57.963

从服务打印是个坏主意。网络打印机是“按用户”连接的。您可以将服务标记为以特定用户身份运行，但我认为这是一种不好的安全做法。您也许可以连接到本地打印机，但在走这条路线之前我仍然会犹豫。

最好的选择是让服务存储数据并让用户启动的应用程序通过向服务请求数据来进行打印。或存储数据的公共位置，如数据库。

如果您需要定期打印数据，请通过任务计划程序设置任务事件。从服务启动进程需要知道用户名和密码，这也是不好的安全做法。

至于打印本身，使用第三方工具生成报告将是最简单的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T17:46:52.220

这可能不是您想要的，但是如果我需要快速而肮脏地进行此操作，我会：

1.  创建一个单独的 WPF 应用程序（这样我就可以使用内置的文档处理）
2.  为服务提供与桌面交互的能力（请注意，您实际上不必在桌面上显示任何内容，也无需登录即可使用）
3.  让服务运行应用程序，并为其提供要打印的数据。

您可能还可以通过从服务运行的 Web 浏览器进行打印（尽管我建议您构建自己的 shell IE，而不是使用完整的浏览器）。

对于更详细（也是免费）的解决方案，您最好的选择可能是自己手动格式化文档（使用 GDI+ 为您进行布局）。这是乏味的、容易出错的、耗时的，并且在开发过程中浪费了大量的纸张，但也让您可以最大程度地控制打印机的内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T14:26:15.283

如果您可以输出到发布脚本，一些打印机将打印任何通过 FTP 传输到其上某个目录的内容。

我们用它来克服我们大学向我们公开的打印学分，但如果您的服务输出到 ps，那么您可以将 ps 文件通过 ftp 传输到打印机。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-27T19:13:02.763

We are using [DevExpress' XtraReports](http://www.devexpress.com/Products/NET/Reporting/) to print from a service without any problems. Their report model is similar to that of Windows Forms, so you could dynamically insert text elements and then issue the print command.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-11T20:38:25.293

我认为我们将走第三方路线。我喜欢 XSL -> HTML -> PDF -> 打印机流程... Winnovative 的[HTML 到 PDF](http://www.winnovative-software.com/)在第一部分看起来不错，但我遇到了一个寻找好的 PDF 打印解决方案的障碍...有什么建议吗？理想情况下，许可证将基于开发人员，而不是基于部署的运行时。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-21T13:09:55.247

在回答您有关 PDF 打印的问题时，我还没有找到一个优雅的解决方案。我正在向 Adob​​e 发出“shell”，这是不可靠的，并且需要用户始终登录。为了解决这个特定问题，我要求将我们处理的文件（发票）格式化为多页 Tiff 文件，而不是使用本机 .NET 打印功能进行拆分和打印。Adobe 的立场似乎是“让用户在 Adob​​e Reader 中查看文件，他们可以点击打印”。无用。

我仍然热衷于找到一种生成可以从 Web 服务器输出的高质量报告的好方法……

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-14T22:25:34.577

根据 Yann Trevin 的回复，MS 不支持使用 System.Drawing.Printing 进行打印。但是，您也许可以使用新的、基于 WPF 的 System.Printing（我*认为*）

# c# - Graphics.DrawString() 的文本输出居中

> ID：7991
> 
> 赞同：69
> 
> 时间：2008-08-11T17:37:57.107
> 
> 标签：c#, graphics, compact-framework

我正在使用 .NETCF (Windows Mobile)`Graphics`类和将`DrawString()`单个字符呈现到屏幕上的方法。

问题是我似乎无法将其正确居中。无论我为字符串渲染位置的 Y 坐标设置什么，它总是低于该值，并且文本大小越大 Y 偏移量越大。

例如，在文本大小为 12 时，偏移量约为 4，但在 32 时，偏移量约为 10。

我希望角色垂直占据它正在绘制的大部分矩形并水平居中。这是我的基本代码。`this`正在引用它被绘制的用户控件。

```
Graphics g = this.CreateGraphics();

float padx = ((float)this.Size.Width) * (0.05F);
float pady = ((float)this.Size.Height) * (0.05F);

float width = ((float)this.Size.Width) - 2 * padx;
float height = ((float)this.Size.Height) - 2 * pady;

float emSize = height;

g.DrawString(letter, new Font(FontFamily.GenericSansSerif, emSize, FontStyle.Regular),
            new SolidBrush(Color.Black), padx, pady); 
```

是的，我知道我可以使用标签控件并使用它来设置居中，但我确实需要使用`Graphics`类手动执行此操作。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-08-25T17:49:38.463

我想为 StringFormat 对象添加另一票。您可以简单地使用它来指定“中心，中心”，文本将在矩形或提供的点中居中绘制：

```
StringFormat format = new StringFormat();
format.LineAlignment = StringAlignment.Center;
format.Alignment = StringAlignment.Center; 
```

然而，在 CF 中存在一个问题。如果您对这两个值都使用 Center，那么它会关闭 TextWrapping。不知道为什么会发生这种情况，这似乎是 CF 的一个错误。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2008-10-13T13:15:08.237

要对齐文本，请使用以下命令：

```
StringFormat sf = new StringFormat();
sf.LineAlignment = StringAlignment.Center;
sf.Alignment = StringAlignment.Center;
e.Graphics.DrawString("My String", this.Font, Brushes.Black, ClientRectangle, sf); 
```

请注意，此处的文本在给定的范围内对齐。在此示例中，这是 ClientRectangle。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-08-11T19:03:59.803

通过结合我得到的建议，我想出了这个：

```
 private void DrawLetter()
    {
        Graphics g = this.CreateGraphics();

        float width = ((float)this.ClientRectangle.Width);
        float height = ((float)this.ClientRectangle.Width);

        float emSize = height;

        Font font = new Font(FontFamily.GenericSansSerif, emSize, FontStyle.Regular);

        font = FindBestFitFont(g, letter.ToString(), font, this.ClientRectangle.Size);

        SizeF size = g.MeasureString(letter.ToString(), font);
        g.DrawString(letter, font, new SolidBrush(Color.Black), (width-size.Width)/2, 0);

    }

    private Font FindBestFitFont(Graphics g, String text, Font font, Size proposedSize)
    {
        // Compute actual size, shrink if needed
        while (true)
        {
            SizeF size = g.MeasureString(text, font);

            // It fits, back out
            if (size.Height <= proposedSize.Height &&
                 size.Width <= proposedSize.Width) { return font; }

            // Try a smaller font (90% of old size)
            Font oldFont = font;
            font = new Font(font.Name, (float)(font.Size * .9), font.Style);
            oldFont.Dispose();
        }
    } 
```

到目前为止，这完美无缺。

我唯一要更改的是将 FindBestFitFont() 调用移至 OnResize() 事件，这样我就不会在每次绘制字母时都调用它。只有在控件大小发生变化时才需要调用它。为了完整起见，我只是将它包含在函数中。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-08-11T18:22:16.223

要绘制居中文本：

```
TextRenderer.DrawText(g, "my text", Font, Bounds, ForeColor, BackColor, 
  TextFormatFlags.HorizontalCenter | 
  TextFormatFlags.VerticalCenter |
  TextFormatFlags.GlyphOverhangPadding); 
```

确定填充区域的最佳字体大小有点困难。我发现一个可行的方法是反复试验：从大字体开始，然后反复测量字符串并缩小字体直到适合为止。

```
Font FindBestFitFont(Graphics g, String text, Font font, 
  Size proposedSize, TextFormatFlags flags)
{ 
  // Compute actual size, shrink if needed
  while (true)
  {
    Size size = TextRenderer.MeasureText(g, text, font, proposedSize, flags);

    // It fits, back out
    if ( size.Height <= proposedSize.Height && 
         size.Width <= proposedSize.Width) { return font; }

    // Try a smaller font (90% of old size)
    Font oldFont = font;
    font = new Font(font.FontFamily, (float)(font.Size * .9)); 
    oldFont.Dispose();
  }
} 
```

您可以将其用作：

```
Font bestFitFont = FindBestFitFont(g, text, someBigFont, sizeToFitIn, flags);
// Then do your drawing using the bestFitFont
// Don't forget to dispose the font (if/when needed) 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-11T17:50:41.217

这是一些代码。这假定您在窗体或 UserControl 上执行此操作。

```
Graphics g = this.CreateGraphics();
SizeF size = g.MeasureString("string to measure");

int nLeft = Convert.ToInt32((this.ClientRectangle.Width / 2) - (size.Width / 2));
int nTop = Convert.ToInt32((this.ClientRectangle.Height / 2) - (size.Height / 2)); 
```

从您的帖子中，听起来 ClientRectangle 部分（例如，您没有使用它）是给您带来困难的原因。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-11T17:49:31.623

您可以使用`StringFormat`传递给`DrawString`方法的对象实例来使文本居中。

请参阅[Graphics.DrawString 方法](http://msdn.microsoft.com/en-us/library/21kdfbzs.aspx)和[StringFormat 类](http://msdn.microsoft.com/en-us/library/system.drawing.stringformat.aspx)。*************