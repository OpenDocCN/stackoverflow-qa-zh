# StackOverflow 问答 000827000-000827999

# .net - 如何让 .NET 首先在本地文件夹中而不是 GAC 中查找程序集？

> ID：827002
> 
> 赞同：7
> 
> 时间：2009-05-05T21:36:12.833
> 
> 标签：.net, asp.net, assemblies, gac

据我了解，.NET 运行时总是会先在 GAC 中查找引用的程序集，然后再在本地文件夹中查找。Web.Config 中是否有会颠倒此顺序的设置？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-05T21:37:27.137

不，这是不可能实现的。如果 GAC 中存在与您的程序中引用的版本相同的 DLL，CLR 将**始终**选择这个。无法覆盖此行为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T21:42:35.970

更多信息。[在这个 SO 线程](https://stackoverflow.com/questions/267693/how-can-i-force-net-to-use-a-local-copy-of-an-assembly-thats-in-the-gac)中的变通方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T21:38:56.710

我不确定是否有某些东西实际上会颠倒搜索顺序，但根据您的要求，您可能希望查看[程序集绑定重定向](http://msdn.microsoft.com/en-us/library/2fc472t2(vs.71).aspx)，它可以让您对加载哪些版本的程序集有很大的控制权。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T21:47:25.490

JaredPar 是对的——GAC**总是**会首先获得大会的轮询。但是，如果您像我一样，希望 DLL 存在于 GAC 中并且仍然可以调试，您可以添加一个构建脚本来将您的 .pdb 文件转储到与 GAC 中的程序集相同的文件夹中（它将位于C:\windows\assembly\gac_msil\assembly.name_[公钥令牌]）。

# asp.net - 提交按钮不会触发服务器端代码

> ID：827005
> 
> 赞同：1
> 
> 时间：2009-05-05T21:36:34.190
> 
> 标签：asp.net, jquery, validation, submit, breakpoints

这个问题说明了一切。我有一个使用 jquery 的 asp.net 页面。起初，当我单击提交按钮时，它会显示对象预期错误。我运行了萤火虫，它显示了按钮的 onClientClick 添加的“返回验证（）”函数的错误。

```
 <script type="text/javascript">
    $(document).ready(function() {
        // add custom validation methods
        $.validator.addMethod('phone', function(value, el, params) {
            return this.optional(el) || /^[0-9,+,(), ,]{1,}(,[0-9]+){0,}$/.test(value);
        }, 'Please enter a valid phone number');

        $.validator.addMethod('numbers', function(value, el, params) {
            return this.optional(el) || /^[0-9]+$/.test(value);
        }, 'Invalid entry. Only Numeric is allowed.');

        $.validator.addMethod('domainurl', function(value, el, params) {
            return this.optional(el) || /^(http\:\/\/(?:www\.)?[a-zA-Z0-9]+(?:(?:\-|_)[a-zA-Z0-9]+)*(?:\.[a-zA-Z0-9]+(?:(?:\-|_)[a-zA-Z0-9]+)*)*\.[a-zA-Z]{2,4}(?:\/)?)$/.test(value);
        }, 'Please enter a valid domain url');

        $.validator.addMethod('selectone', function(value, element) {
            return this.optional(element) || (value.indexOf("none") == -1);
        }, 'Please select an option.');

        $("#form1").validate({
            debug: true,
            rules: {
                txt_name: {
                    required: true,
                    minlength: 2
                },
                txt_cmp: {
                    required: true,
                    minlength: 2
                },
                txt_tel1: {
                    phone: true,
                    required: true,
                    minlength: 3

                },
                txt_tel2: {
                    phone: true,
                    required: false,
                    minlength: 3

                },
                txt_mob: {
                    phone: true,
                    required: false,
                    minlength: 9

                },
                txt_email: {
                    required: true,
                    email: true
                },

                txt_domname: {
                    required: true,
                    domainurl: true
                },

                radiobt_domain: "required",

                ddl_yremail: {
                    required: true,
                    selectone: true
                },
                ddl_email: {
                    required: true,
                    selectone: true
                },

                txt_space: {
                    required: true,
                    numbers: true

                },
                txt_calfr: {
                    required: true
                },
                txt_calto: {
                    required: true
                }  

        },
        messages: {
            txt_name: {
                required: "This field is required",
                minLength: "Please enter a valid name"
            },
            txt_cmp: {
                required: "This field is required",
                minLength: "Please enter a valid commpany name"
            },
            txt_tel1: {
                required: "This field is required",
                minLength: "Please enter a valid telephone number"

            },
            txt_tel2: {
                minLength: "Please enter a valid telephone number"
            },
            txt_mob: {
                minLength: "Please enter a valid mobile number"

            },
            txt_email: {
                email: "Please enter a valid email address",
                required: "This field is required"
            },

            txt_domname: {
                required: "This field is required"
            },
            radiobt_domain: "Select the Hosting Type"
        }

    });
});
</script> 
```

我删除了它，现在提交按钮仍然不起作用。服务器端代码未执行。它没有显示任何错误。我不知道是什么问题。

* * *

我已经在这里发布了代码：[object expected - jquery](https://stackoverflow.com/questions/819801/object-expected-jquery)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T21:51:22.657

**编辑：**看到代码后。即使在您删除按钮中对 Validate() 的调用后表单仍未提交的原因是因为您有 debug:true，这会阻止表单提交。将其更改为 debug: false ，它将提交。

```
 $("#form1").validate({
            debug: false,
            ..... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T21:56:53.627

我相信您的问题是表单提交不起作用，因为您有 javascript 解析错误。您能否检查 Firebug 控制台以查看页面加载时是否发生任何错误。任何 javascript 错误都可能会破坏表单提交过程。

看看你之前的问题，我猜你可能没有包含验证插件，因为 validate 没有定义。此错误可能仍在发生，并且页面上的其余 javascript - 包括所有 ASP.NET 添加的 javascript 可能无法解析。

你有验证插件的脚本吗？它看起来像这样：

```
 <script type="text/javascript" src="..../jquery.validate.js"></script> 
```

# c++ - SQLite - 预分配数据库大小

> ID：827010
> 
> 赞同：4
> 
> 时间：2009-05-05T21:38:33.763
> 
> 标签：c++, sqlite, embedded

有没有办法将我的 SQLite 数据库预先分配到一定的大小？目前我正在添加和删除一些记录，并希望在创建时避免这种开销。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-01-27T20:12:58.353

最快的方法是使用 zero_blob 函数：

**例子：**

Y:> **sqlite3 large.sqlite**
SQLite 版本 3.7.4
输入“.help”获取说明
输入以“;”结尾的 SQL 语句
sqlite>**创建大表 (a)** ;
sqlite>**插入大值 (zeroblob(1024*1024));**
sqlite>**删除表大；**
sqlite> **.q**

Y:> **dir large.sqlite**
驱动器 Y 中的卷是个人
卷序列号是 365D-6110

Y的目录：\

2011 年 1 月 27 日下午 12:10 1,054,720 large.sqlite

* * *

**注意：**正如凯尔在他的评论中正确指出的那样：

每个 blob 的大小是有限制的，因此如果您希望数据库大于 ~1GB，则可能需要插入多个 blob。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T22:16:52.423

有一个技巧 - 将一堆数据插入数据库，直到数据库大小达到您想要的大小，然后删除数据。这有效，因为：

> “当一个对象（表、索引或触发器）从数据库中删除时，它会留下空白空间。这个空白空间将在下次向数据库添加新信息时重新使用。但与此同时，数据库文件可能大于严格必要的。”

当然，这不是最可靠的方法。（此外，您需要确保禁用 auto_vacuum 才能使其正常工作）。您可以在这里了解更多信息 - [http://www.sqlite.org/lang_vacuum.html](http://www.sqlite.org/lang_vacuum.html)

# c - 指针数组的长度

> ID：827013
> 
> 赞同：3
> 
> 时间：2009-05-05T21:39:49.457
> 
> 标签：c, arrays, pointers

如果我有一个像 char **lines 这样的指针数组，我如何确定它的长度？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-05T21:43:22.677

你不能。您必须手动跟踪数组的长度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-05T21:44:31.113

你不能可靠。

有时，有一个标记结束的空指针 - 这是有时使用的一种约定。更多时候，您需要被告知长度。

但是没有确定长度的万无一失的方法。您必须以某种方式知道（或被告知）长度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T21:43:22.350

那不是指针数组，而是指向指针的指针。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T21:53:31.077

这取决于数据。如果没有关联的计数，它可能是一个以 NULL 结尾的列表。

```
char** lines = mysteryfunction();
for ( ;*lines;lines++ ) { 
    printf( "%s\n", *list ); 
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-12-17T20:27:13.873

## 获取指向数组的指针的长度

```
char *array[]={"welcome","to","India"};

length=sizeof(array)/sizeof(array[0]); 
```

输出：

> 3

***我们可以通过除（指向数组的指针的大小***除以单个的大小）来获得长度

 *因为没有预定义的函数来获取数组的长度..

# objective-c - 如何限制 NSTextField 文本长度并始终保持大写？

> ID：827014
> 
> 赞同：26
> 
> 时间：2009-05-05T21:39:51.653
> 
> 标签：objective-c, cocoa, user-interface, nstextfield

需要有一个 NSTextField，文本限制为最多 4 个字符，并始终以大写形式显示，但无法找到实现此目的的好方法。我试图通过与验证方法的绑定来做到这一点，但只有当控件失去第一响应者时才会调用验证，这并不好。

我暂时通过观察文本字段上的通知 NSControlTextDidChangeNotification 并让它调用该方法来使其工作：

```
- (void)textDidChange:(NSNotification*)notification {
  NSTextField* textField = [notification object];
  NSString* value = [textField stringValue];
  if ([value length] > 4) {
    [textField setStringValue:[[value uppercaseString] substringWithRange:NSMakeRange(0, 4)]];
  } else {
    [textField setStringValue:[value uppercaseString]];
  }
} 
```

但这肯定不是最好的方法。有更好的建议吗？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-06T14:56:59.383

我按照 Graham Lee 的建议做了，效果很好，这是自定义格式化程序代码：

更新：添加了 Dave Gallagher 报告的修复。谢谢！

```
@interface CustomTextFieldFormatter : NSFormatter {
  int maxLength;
}
- (void)setMaximumLength:(int)len;
- (int)maximumLength;

@end

@implementation CustomTextFieldFormatter

- (id)init {

   if(self = [super init]){

      maxLength = INT_MAX;
   }

  return self;
}

- (void)setMaximumLength:(int)len {
  maxLength = len;
}

- (int)maximumLength {
  return maxLength;
}

- (NSString *)stringForObjectValue:(id)object {
  return (NSString *)object;
}

- (BOOL)getObjectValue:(id *)object forString:(NSString *)string errorDescription:(NSString **)error {
  *object = string;
  return YES;
}

- (BOOL)isPartialStringValid:(NSString **)partialStringPtr
   proposedSelectedRange:(NSRangePointer)proposedSelRangePtr
          originalString:(NSString *)origString
   originalSelectedRange:(NSRange)origSelRange
        errorDescription:(NSString **)error {
    if ([*partialStringPtr length] > maxLength) {
        return NO;
    }

    if (![*partialStringPtr isEqual:[*partialStringPtr uppercaseString]]) {
      *partialStringPtr = [*partialStringPtr uppercaseString];
      return NO;
    }

    return YES;
}

- (NSAttributedString *)attributedStringForObjectValue:(id)anObject withDefaultAttributes:(NSDictionary *)attributes {
  return nil;
}

@end 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-05T22:30:55.557

您是否尝试过附加自定义`NSFormatter`子类？

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-05-03T02:14:18.387

在上面我评论的例子中，这很糟糕：

```
// Don't use:
- (BOOL)isPartialStringValid:(NSString *)partialString
            newEditingString:(NSString **)newString
            errorDescription:(NSString **)error
{
    if ((int)[partialString length] > maxLength)
    {
        *newString = nil;
        return NO;
    }
} 
```

改用这个（或类似的东西）：

```
// Good to use:
- (BOOL)isPartialStringValid:(NSString **)partialStringPtr
       proposedSelectedRange:(NSRangePointer)proposedSelRangePtr
              originalString:(NSString *)origString
       originalSelectedRange:(NSRange)origSelRange
            errorDescription:(NSString **)error
{
    int size = [*partialStringPtr length];
    if ( size > maxLength )
    {
        return NO;
    }
    return YES;
} 
```

两者都是 NSFormatter 方法。第一个有问题。假设您将文本输入限制为 10 个字符。如果您将字符一个接一个地输入到 NSTextField 中，它会正常工作并防止用户超过 10 个字符。

但是，如果用户要将一个 25 个字符的字符串**粘贴**到文本字段中，将会发生如下情况：

1) 用户将粘贴到 TextField

2) TextField 将接受字符串

3) TextField 会将格式化程序应用于 25 长度字符串中的“最后一个”字符

4) Formatter 对 25 长字符串中的“最后一个”字符进行处理，忽略其余部分

5) TextField 最终会包含 25 个字符，即使它限制为 10 个。

这是因为，我相信，第一种方法只适用于输入到 NSTextField 中的“最后一个字符”。上面显示的第二种方法适用于输入到 NSTextField 中的“所有字符”。所以它不受“粘贴”漏洞的影响。

我刚刚发现这个试图破坏我的应用程序，并且不是 NSFormatter 专家，所以如果我错了，请纠正我。非常感谢你**carlosb**发布这个例子。它帮助了很多！:)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-10-28T12:48:56.457

这个实现采用了上面评论过的几个建议。值得注意的是，它可以在不断更新绑定的情况下正常工作。

此外：

1.  它正确地实现了粘贴。

2.  它包括一些关于如何在不进一步子类化的情况下在 nib 中有效使用类的注释。

编码：

```
@interface BPPlainTextFormatter : NSFormatter {
    NSInteger _maxLength;
}

/*

 Set the maximum string length. 

 Note that to use this class within a Nib:
 1\. Add an NSFormatter as a Custom Formatter.
 2\. In the Identity inspector set the Class to BPPlainTextFormatter
 3\. In user defined attributes add Key Path: maxLength Type: Number Value: 30

 Note that rather than attaching formatter instances to individual cells they
 can be positioned in the nib Objects section and referenced by numerous controls.
 A name, such as Plain Text Formatter 100, can  be used to identify the formatters max length.

 */
@property NSInteger maxLength;

@end

@implementation BPPlainTextFormatter
@synthesize maxLength = _maxLength;

- (id)init
{
    if(self = [super init]){
        self.maxLength = INT_MAX;
    }

    return self;
}

- (id)initWithCoder:(NSCoder *)aDecoder
{
    // support Nib based initialisation
    self = [super initWithCoder:aDecoder];
    if (self) {
        self.maxLength = INT_MAX;
    }

    return self;
}

#pragma mark -
#pragma mark Textual Representation of Cell Content

- (NSString *)stringForObjectValue:(id)object
{
    NSString *stringValue = nil;
    if ([object isKindOfClass:[NSString class]]) {

        // A new NSString is perhaps not required here
        // but generically a new object would be generated
        stringValue = [NSString stringWithString:object];
    }

    return stringValue;
}

#pragma mark -
#pragma mark Object Equivalent to Textual Representation

- (BOOL)getObjectValue:(id *)object forString:(NSString *)string errorDescription:(NSString **)error
{
    BOOL valid = YES;

    // Be sure to generate a new object here or binding woe ensues
    // when continuously updating bindings are enabled.
    *object = [NSString stringWithString:string];

    return valid;
}

#pragma mark -
#pragma mark Dynamic Cell Editing

- (BOOL)isPartialStringValid:(NSString **)partialStringPtr
       proposedSelectedRange:(NSRangePointer)proposedSelRangePtr
              originalString:(NSString *)origString
       originalSelectedRange:(NSRange)origSelRange
            errorDescription:(NSString **)error
{
    BOOL valid = YES;

    NSString *proposedString = *partialStringPtr;
    if ([proposedString length] > self.maxLength) {

        // The original string has been modified by one or more characters (via pasting).
        // Either way compute how much of the proposed string can be accommodated.
        NSInteger origLength = origString.length;
        NSInteger insertLength = self.maxLength - origLength;

        // If a range is selected then characters in that range will be removed
        // so adjust the insert length accordingly
        insertLength += origSelRange.length;

        // Get the string components
        NSString *prefix = [origString substringToIndex:origSelRange.location];
        NSString *suffix = [origString substringFromIndex:origSelRange.location + origSelRange.length];
        NSString *insert = [proposedString substringWithRange:NSMakeRange(origSelRange.location, insertLength)];

#ifdef _TRACE

        NSLog(@"Original string: %@", origString);
        NSLog(@"Original selection location: %u length %u", origSelRange.location, origSelRange.length);

        NSLog(@"Proposed string: %@", proposedString);
        NSLog(@"Proposed selection location: %u length %u", proposedSelRangePtr->location, proposedSelRangePtr->length);

        NSLog(@"Prefix: %@", prefix);
        NSLog(@"Suffix: %@", suffix);
        NSLog(@"Insert: %@", insert);
#endif

        // Assemble the final string
        *partialStringPtr = [[NSString stringWithFormat:@"%@%@%@", prefix, insert, suffix] uppercaseString];

        // Fix-up the proposed selection range
        proposedSelRangePtr->location = origSelRange.location + insertLength;
        proposedSelRangePtr->length = 0;

#ifdef _TRACE

        NSLog(@"Final string: %@", *partialStringPtr);
        NSLog(@"Final selection location: %u length %u", proposedSelRangePtr->location, proposedSelRangePtr->length);

#endif
        valid = NO;
    }

    return valid;
}

@end 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-11-19T22:21:27.120

我需要一个 Formatter 来将 Swift 4 转换为大写。作为参考，我将其包含在此处：

```
import Foundation

class UppercaseFormatter : Formatter {

    override func string(for obj: Any?) -> String? {
        if let stringValue = obj as? String {
            return stringValue.uppercased()
        }
        return nil
    }

    override func getObjectValue(_ obj: AutoreleasingUnsafeMutablePointer<AnyObject?>?, for string: String, errorDescription error: AutoreleasingUnsafeMutablePointer<NSString?>?) -> Bool {
        obj?.pointee = string as AnyObject
        return true
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-04-28T08:01:23.063

斯威夫特版本的[卡洛斯巴博萨](https://stackoverflow.com/a/830019/4290759)回答，如果有人需要它。

使用示例：

```
myTextField.formatter = CustomTextFieldFormatter(maxLength: 10, isUppercased: true) 
```

* * *

```
class CustomTextFieldFormatter: Formatter {
    var maxLength: UInt
    var isUppercased: Bool

    init(maxLength: UInt, isUppercased: Bool) {
        self.maxLength = maxLength
        self.isUppercased = isUppercased
        super.init()
    }

    required init?(coder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    override func string(for obj: Any?) -> String? {
        return obj as? String
    }

    override func getObjectValue(_ obj: AutoreleasingUnsafeMutablePointer<AnyObject?>?, for string: String, errorDescription error: AutoreleasingUnsafeMutablePointer<NSString?>?) -> Bool {
        obj?.pointee = string as AnyObject
        return true
    }

    override func isPartialStringValid(_ partialStringPtr: AutoreleasingUnsafeMutablePointer<NSString>, proposedSelectedRange proposedSelRangePtr: NSRangePointer?, originalString origString: String, originalSelectedRange origSelRange: NSRange, errorDescription error: AutoreleasingUnsafeMutablePointer<NSString?>?) -> Bool {

        if partialStringPtr.pointee.length > maxLength {
            return false
        }

        if isUppercased && partialStringPtr.pointee != partialStringPtr.pointee.uppercased as NSString {
            partialStringPtr.pointee = partialStringPtr.pointee.uppercased as NSString
            return false
        }

        return true
    }

    override func attributedString(for obj: Any, withDefaultAttributes attrs: [NSAttributedString.Key : Any]? = nil) -> NSAttributedString? {
        return nil
    }
} 
```

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-05-06T01:03:23.367

Graham Lee 建议的自定义 NSFormatter 是最好的方法。

一个简单的组合是将您的视图控制器设置为文本字段的委托，然后阻止任何涉及非大写或长度超过 4 的编辑：

```
- (BOOL)textField:(UITextField *)textField
    shouldChangeCharactersInRange:(NSRange)range
    replacementString:(NSString *)string
{
    NSMutableString *newValue = [[textField.text mutableCopy] autorelease];
    [newValue replaceCharactersInRange:range withString:string];

    NSCharacterSet *nonUppercase =
        [[NSCharacterSet uppercaseLetterCharacterSet] invertedSet];
    if ([newValue length] > 4 ||
        [newValue rangeOfCharacterFromSet:nonUppercase].location !=
            NSNotFound)
    {
       return NO;
    }

    return YES;
} 
```

# .net - .NET 数组的最大大小

> ID：827015
> 
> 赞同：3
> 
> 时间：2009-05-05T21:40:04.557
> 
> 标签：.net, arrays

并不是说我需要这样做，但我想了解它是如何工作/不起作用的。我用谷歌搜索了很多数组的最大长度，但实际上找不到任何东西。

```
long[] hugeArray = new long[long.MaxValue];

//No exceptions
Console.WriteLine("Init");

//Overflow exception
Console.WriteLine(hugeArray.LongLength.ToString());

hugeArray = new long[int.MaxValue];

//OutOfMemoryException
Console.WriteLine( hugeArray.Length.ToString()); 
```

而且我想一个后续问题是，如果有限制并且我在该限制之外进行初始化，为什么仅在使用时创建时没有例外？这是编译器应该捕获的东西吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-05T21:56:08.510

The underlying IL opcodes for arrays deal with `IntPtr` (known as **native int** in the IL documentation):

*   `newarr` creates an array, and accepts an `IntPtr`
*   `ldelem`并`stelem`读取和写入元素，它们使用`IntPtr`索引
*   `ldlen`返回一个数组的长度，它返回一个无符号的`IntPtr`

我预计 32 位平台上 2^31-1 和 64 位平台上 2^63-1 的元素数量有理论上的限制。

但是，我只是在我的 64 位 PC 上尝试了此代码，并且`OutOfMemoryException`在第一次分配时得到了一个，因此显然实际限制更小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T21:53:21.497

According to [SpankyJ](http://blogs.msdn.com/joshwil/archive/2005/08/10/450202.aspx), .NET 2.0 at least had a limit of 2 GB per array. 8 bytes (sizeof long) * ~2^31 = 16 gigabytes (not to mention the actual memory required). As for the Overflow, I agree with marcc that is probably because arrays are expected to be int-indexed (see e.g. [this method](http://msdn.microsoft.com/en-us/library/zb3cfh7k.aspx) Though I'm a bit uncertain regarding this, as [this overload](http://msdn.microsoft.com/en-us/library/1z8w3at5.aspx) takes an array of Int64 lengths. This may be an extension only available in later versions.

Overall, though, this is mostly a theoretical issue. Anyone actually relying on this is likely doing something wrong.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T21:44:05.357

数组的索引是一个 int，而不是 long。所以，我想技术上新的 long[int.MaxValue] 将是最大值。但是，如果您确实内存不足，您仍然可以得到您所看到的 OutOfMemoryException。你是在 32 位操作系统上运行它吗？没有设置最大长度，除了索引值是 int，而不是 long。

# c++ - 字符串函数 (C/C++) 和安全隐患的非一错误

> ID：827016
> 
> 赞同：3
> 
> 时间：2009-05-05T21:40:19.267
> 
> 标签：c++, c, security

所以这段代码有一个错误：

```
void foo (const char * str) {
     char buffer[64];

     strncpy(buffer, str, sizeof(buffer));
     buffer[sizeof(buffer)] = '\0';

     printf("whoa: %s", buffer);
} 
```

如果她弄清楚函数 foo() 的工作原理，恶意攻击者能做什么？基本上，这段代码容易受到什么样的安全潜在问题的影响？

我个人认为攻击者在这种情况下真的什么都做不了，但我听说*他们*可以做很多事情，即使他们被限制在 1 个字节的范围内。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-05T21:45:28.443

我在这里看到的唯一一个错误是这一行：

```
buffer[sizeof(buffer)] = '\0'; 
```

这就是你在说的吗？我不是这些事情的专家，所以也许我忽略了一些东西，但由于唯一会被写入错误字节的是零，我认为可能性非常有限。攻击者无法控制那里写入的内容。很可能它只会导致崩溃，但它也可能导致大量其他奇怪的行为，所有这些都特定于您的应用程序。我在这里看不到任何代码注入漏洞，除非此错误导致您的应用程序暴露另一个此类漏洞，该漏洞将用作实际攻击的载体。

再一次，带着一粒盐……

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T21:47:14.273

阅读[Shell Coder's Handbook 2nd Edition](https://rads.stackoverflow.com/amzn/click/com/0764544683)以获取大量信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T21:53:41.030

**免责声明**：这是从我刚刚做的一些研究中推断出来的知识，不应被视为福音。

它会用空字节覆盖部分或全部已保存的帧指针——这是调用函数用来抵消其内存访问的参考点。因此，此时调用函数的内存操作将转到不同的位置。我不知道那个位置会是什么，但你不想访问错误的内存。我不会说你可以做任何事情，但你也许可以做一些事情。

我怎么知道这个（真的，我是怎么**推断出来**的）？ Aleph One[为乐趣和利润而粉碎堆栈。](http://insecure.org/stf/smashstack.html)它已经很老了，我不知道 Windows 或编译器是否改变了堆栈的行为方式以避免这些问题。但这是一个起点。

> 示例1.c：
> 
> * * *
> 
> ```
> void function(int a, int b, int c) {
>    char buffer1[5];
>    char buffer2[10];
> }
> 
> void main() {
>   function(1,2,3);
> } 
> ```
> 
> * * *
> 
> 为了理解程序调用 function() 的作用，我们使用 gcc 编译它，使用 -S 开关生成汇编代码输出： $ gcc -S -o example1.s example1.c
> 
> 通过查看汇编语言输出，我们看到对 function() 的调用被转换为：
> 
> ```
>  pushl $3
>      pushl $2
>      pushl $1
>      call function 
> ```
> 
> 这会将函数的 3 个参数向后推入堆栈，并调用 function()。指令“调用”会将指令指针 (IP) 压入堆栈。我们将保存的 IP 称为返回地址 (RET)。在函数中完成的第一件事是过程序言：
> 
> ```
>  pushl %ebp
>      movl %esp,%ebp
>      subl $20,%esp 
> ```
> 
> 这会将帧指针 EBP 推入堆栈。然后它将当前 SP 复制到 EBP 上，使其成为新的 FP 指针。我们将保存的 FP 指针称为 SFP。然后它通过从 SP 中减去局部变量的大小来为局部变量分配空间。
> 
> 我们必须记住，内存只能以字长的倍数寻址。在我们的例子中，一个字是 4 个字节，或 32 位。所以我们的 5 字节缓冲区将占用 8 个字节（2 个字）的内存，而我们的 10 字节缓冲区将占用 12 个字节（3 个字）的内存。这就是 SP 被减去 20 的原因。考虑到这一点，当调用 function() 时，我们的堆栈看起来像这样（每个空格代表一个字节）：
> 
> ```
> bottom of                                                            top of
> memory                                                               memory
>            buffer2       buffer1   sfp   ret   a     b     c
> <------   [            ][        ][    ][    ][    ][    ][    ]
> 
> top of                                                            bottom of
> stack                                                                 stack 
> ```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T22:51:42.513

> 如果她弄清楚函数 foo() 的工作原理，恶意攻击者能做什么？基本上，这段代码容易受到什么样的安全潜在问题的影响？

这可能不是一个可以很容易地出于安全目的被利用的错误的最佳示例，尽管它可以通过使用 64 个字符或更长的字符串来潜在地使代码崩溃。

虽然它肯定是一个错误，它会在数组（堆栈上）之后立即用单个零字节破坏地址，但黑客没有简单的方法将数据注入损坏的区域。调用 printf() 函数会将参数压入堆栈，并可能清除写入数组边界之外的零，并导致可能未终止的字符串被传递给 printf。

然而，如果不深入了解 printf 中发生的事情（并且需要利用 printf 和 foo），黑客将很难做任何事情，而不是让你的代码崩溃。

FWIW，这是使用警告进行编译或使用`strncpy_s`既尊重缓冲区大小又包括终止 null 的函数的一个很好的理由，即使复制的字符串大于缓冲区也是如此。使用`strncpy_s`, 行 " `buffer[sizeof(buffer)] = '\0';`" 甚至没有必要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T01:56:05.283

问题是[您无权写入 array 之后的项目](http://gcc.gnu.org/onlinedocs/libstdc++/manual/bk01pt08ch19s02.html)。当您要求 64 个字符作为缓冲区时，系统需要为您提供至少 64 个字节。系统给你更多的东西是正常的——在这种情况下，内存属于你，在实践中没有问题——但甚至数组后面的第一个字节也可能属于“其他人”。

那么如果你覆盖它会发生什么？如果“其他人”实际上在您的程序中（可能在不同的结构或线程中），操作系统可能不会注意到您践踏了该数据，但其他结构或线程可能会。没有人知道那里应该有哪些数据，或者践踏它会如何影响事情。

在这种情况下，您在堆栈上分配了缓冲区，这意味着（1）其他人是您，实际上是您当前的堆栈帧，并且（2）它不在另一个线程中（但可能会影响当前堆栈中的其他局部变量框架）。

# .net - 在 .NET 中反序列化以空字符结尾的字符串的最佳方法是什么？

> ID：827020
> 
> 赞同：2
> 
> 时间：2009-05-05T21:41:02.183
> 
> 标签：.net, binaryreader

我正在从我的网络连接中读取一条消息，该消息被序列化为一系列以空字符结尾的字符串（和其他二进制数据）

我可以使用 BinaryReader 一次读取一个字符，直到找到 NULL。

有没有更有效的方法仍然简单？我期望字符串长度小于 64 个字符，但它们可能会更长。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-05T22:08:50.197

我认为逐字节读取是一个合理的选择，但我会使用[BufferedStream](http://msdn.microsoft.com/en-us/library/system.io.bufferedstream.aspx)来最小化底层流上的 IO。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T21:45:10.847

将整个内容读入字符串，然后使用 String.Split 拆分空值。

请记住，字符串在 .NET 中不是以 null 结尾的。

# dynamic-languages - 动态语言和变量分配

> ID：827022
> 
> 赞同：1
> 
> 时间：2009-05-05T21:41:23.960
> 
> 标签：dynamic-languages

动态语言如何决定为变量分配多少内存？例如。编译器如何在没有太多内存开销的情况下将 variable= 5 更改为 variable ="xxx" ？它什么时候使用硬件堆栈，什么时候使用内存堆？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T21:58:12.623

编译器为每个变量分配足够的内存来保存指针以及语言运行时所需的任何元数据。**但我认为您的意思是要询问为每个对象**分配了多少内存。在这种情况下，答案是它取决于对象的类型。当一个变量被分配给不同的对象时，与该变量关联的指针会改变它所指向的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T22:34:16.173

当然，答案因语言而异——托管的动态语言和较低级别的实现语言。适用于 Perl 的内容不一定适用于 Python，适用于 Tcl 的内容也不一定适用于 Java 或 LISP 或......好吧，它们是否算作动态语言。

在 Perl 中，有一个名为 SV（标量变量）的 C 级结构，它包含不同版本的变量值的不同存储。这些通常是基于堆的；字符串的存储总是以堆为基础的，尽管从未转换为字符串的纯数值可能位于严格位于堆栈上的 SV 中。在 Perl 中，这些东西是引用计数的（并且是 mortalized 或 immortalized 以及各种其他有趣的术语）。更复杂的类型（AV、HV、RV 等）基于 SV。

# perl - 如何从 URL 中提取域？

> ID：827024
> 
> 赞同：11
> 
> 时间：2009-05-05T21:41:38.110
> 
> 标签：perl

如何从 URL 中提取域？有 Perl 模块吗？我找不到任何东西。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-05T21:46:36.147

[URI](http://search.cpan.org/perldoc?URI)模块可以以一种很好的面向对象的方式为您解析 URI。要获取域部分：

```
my $url = URI->new( "http://www.stackoverflow.com/" );
my $domain = $url->host;
print $domain; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T21:46:11.017

也许[Regexp::Common:URI](http://search.cpan.org/~abigail/Regexp-Common-2.122/lib/Regexp/Common/URI/http.pm)？

更新：frido 建议的[URI听起来更好？](http://search.cpan.org/dist/URI/URI.pm)

# reflection - 有人将 Silverlight.FX 与 Silverlight 3 一起使用吗？

> ID：827034
> 
> 赞同：0
> 
> 时间：2009-05-05T21:43:41.957
> 
> 标签：reflection, silverlight-3.0, silverlight.fx

我开始研究[Nikhil Kothari 的 Silverlight.FX，](http://www.nikhilk.net/SilverlightFX.aspx)用我们的 Silverlight 3 项目替换 Prism/Unity。

到目前为止，我喜欢代码布局和结构。它看起来经过深思熟虑。

但是由于 System.Reflection.AmbiguousMatchException，我无法让很多样本正常工作。还有人看到这个吗？我不应该将此框架与 Silverlight 3 一起使用吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-31T11:57:32.030

嗯，这是避免问题，而不是解决问题。看起来问题要深得多，任何使用从 Effect 基类派生的类的东西都被破坏了。这使得 Silverlight FX 的使用非常无聊。

我过去曾尝试使用该库，但遇到了问题。虽然 Nikhil Kothari 在他所做的事情和他的技术能力方面令人惊叹，但我发现他对解决问题的反应并不快（顺便说一句，有人已经在他的博客上发布了这个问题，但没有他的回应）。我不希望这听起来像是在敲响 Nikhil，这只是在将开源用于实际项目时需要考虑的事情。

我当然希望有人能弄清楚这些类是怎么回事，我已经花了很多时间调试，但没有解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T14:18:20.147

我使用 Silverlight 3 的框架没有问题。引用预构建的 dll 适用于我的项目，但我没有尝试自己编译源代码。您是否尝试过使用 dll？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T00:23:29.703

经过一些繁重的调试后，这个错误即将到来，因为我相信 Nikhil 使用的一些类名现在在 Silverlight 3 beta 1 中。在 TaskList 示例中，ListView 的 DataTemplate 有一个 HoverEffect

```
<fxeffects:ColorFill FillColor="#406795D1" Duration="0:0:0.25"/> 
```

这是导致我看到的所有问题的原因。删除它消除了 AmbiguousMatchException。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-19T21:27:36.330

我使用最新版本的库（针对 SL3 构建的 3.1）尝试了 Amazon Store 示例和 TaskList 示例，示例似乎工作正常，包括 ColorFill 效果。

我确实将 Effect 类重命名为 AnimationEffect ，如果您尝试重新编译源代码，您需要避免出现模棱两可的 API 编译错误......但预编译的二进制文件会很好。不知道我明白为什么你会遇到运行时反射问题。

抱歉，我知道没有立即看到响应/修复可能会令人沮丧，但是发生的事情太多了，尤其是。在发布之前。我希望拥有周围的源代码至少可以让您调试/闯入，因此至少有一个不会被完全阻止。是的，我意识到它不是最理想的，但同时它是现实，正如诺姆指出的那样...... :-(

# c# - c#.net循环线程堆栈溢出

> ID：827037
> 
> 赞同：1
> 
> 时间：2009-05-05T21:43:56.247
> 
> 标签：c#, .net, winforms, multithreading

我正在尝试在后台运行一项任务，检查数据库中表中的许多记录，如果自上次检查以来该数字发生了变化，请获取这些记录并对其进行一些处理。

使用以下代码，大约两个小时后我得到了堆栈溢出。应用程序在这段时间内什么都不做，只是检查，没有作业被添加到数据库中。

```
private Thread threadTask = null;
private int recordCount = 0;

private void threadTask_Start()
{
    if (threadTask == null) {
        threadTask = new Thread(taskCheck);
        threadTask.Start();
    }
}

private void taskCheck()
{
     int recordCountNew = GetDBRecordCound();
     if (recordCountNew != recordCount)
     {
         taskDo();
         recordCount = recordCountNew; // Reset the local count for the next loop
     }
     else
         Thread.Sleep(1000); // Give the thread a quick break

     taskCheck();          
}

private void taskDo()
{
    // get the top DB record and handle it
    // delete this record from the db
} 
```

`taskCheck()`当它溢出时，调用堆栈中有大量的。我猜在 taskCheck() 完成之前 taskCheck() 永远不会完成，因此溢出，因此它们都保留在堆栈中。这显然不是解决这个问题的正确方法，那是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-05T21:49:14.550

你得到一个堆栈溢出，因为在 taskCheck 结束时，你再次调用 taskCheck。您永远不会退出函数 taskCheck，您最终只会越来越多地调用，直到堆栈溢出。你应该做的是在 taskCheck 中有一个 while 循环：

```
private void taskCheck()
{
   while(true)
   {
       int recordCountNew = GetDBRecordCound();
       if (recordCountNew != recordCount)
       {
           taskDo();
           recordCount = recordCountNew; // Reset the local count for the next loop
       }
       else
           Thread.Sleep(1000); // Give the thread a quick break
   }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T21:49:00.383

我假设你在哪里有 task_Check()，你实际上是指 taskCheck()（反之亦然）。也就是说，您正在[递归地](http://en.wikipedia.org/wiki/Recursion_(computer_science))调用 taskCheck() 方法。避免在这里讨论架构，您可以删除该调用并让 threadTask_Start() 在 while 循环中重复一次该过程。

# iphone - 所有 javascript 库都可以与 Iphone 一起使用吗？Aptana 问题

> ID：827041
> 
> 赞同：0
> 
> 时间：2009-05-05T21:44:06.513
> 
> 标签：iphone, aptana, javascript

我正在尝试使用 Aptana 构建一个 iPhone *Web*应用程序。我从来没有使用过Aptana。我下载了 iphone 支持并开始了一个新项目。它现在询问我是否要导入一个 javascript 库并列出“大的”。iPhone 的 Safari 能否使用这些，特别是 jquery？我看到 jquery 有一个特殊的 iphone 库，所以我的猜测是否定的。

我应该告诉它使用 jquery（或其他库）还是应该手动下载特殊的 iphone javascript 子集并尝试将其集成到我的项目中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T21:55:33.770

据我所知，JQuery 应该可以在 iPhone 上正常工作。您正在谈论的特定库必须是附加的，以利用 iPhone 独有的功能，例如能够处理显示方向事件或可能使用 webkit css 动画扩展。

尽管您需要小心处理事件，因为 iPhone 上大多数与鼠标相关的事件的行为与您的预期略有不同。PPK 的这个演讲提供了一些关于它的线索：

[http://yuiblog.com/blog/2009/04/27/video-ppk-jsevents/](http://yuiblog.com/blog/2009/04/27/video-ppk-jsevents/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T21:56:20.523

是的，iphone 应该运行 jquery 就好了。javascript 支持非常强大。尽管您可能想查看一些 iPhone 特定的库。我忘记了他们的名字。`iUI`我认为？

# zend-framework - 复选框的自定义 Zend 错误消息

> ID：827048
> 
> 赞同：4
> 
> 时间：2009-05-05T21:45:20.533
> 
> 标签：zend-framework, validation

我在基于 Zend 的站点中有一个表单，其中包含必需的“条款和条件”复选框。

我设置了一条自定义消息，上面写着“您必须同意条款和条件”。

但是，因为复选框是“presence='required'”，它返回

```
Field 'terms' is required by rule 'terms', but the field is missing 
```

这是 Zend 框架中定义的这个常量：

```
self::MISSING_MESSAGE     => "Field '%field%' is required by rule '%rule%', but the field is missing", 
```

我可以编辑此常量，但这会更改所有必需复选框的错误报告。

我如何影响此特定案例的错误报告？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-05T22:26:24.087

如果您使用的是，`Zend_Form_Element_Checkbox`您可以自定义[验证器](http://zendframework.com/manual/en/zend.validate.introduction.html#zend.validate.introduction.messages)[上的错误消息`Zend_Validate`](http://zendframework.com/manual/en/zend.validate.introduction.html#zend.validate.introduction.messages)。

```
$form->addElement('checkbox', 'terms', array(
  'label'=>'Terms and Services',
  'uncheckedValue'=> '',
  'checkedValue' => 'I Agree',
  'validators' => array(
    // array($validator, $breakOnChainFailure, $options)
    array('notEmpty', true, array(
      'messages' => array(
        'isEmpty'=>'You must agree to the terms'
      )
    ))
   ),
   'required'=>true,
); 
```

您要确保未选中的值为“空白”并且该字段为“必填”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T21:56:35.437

您可以像这样覆盖默认消息：

```
$options = array(
                'missingMessage' => "Field '%field%' is required by rule '%rule%', dawg!"
            ); 
```

进而：

```
$input = new Zend_Filter_Input($filters, $validators, $myData); 
```

**或者**

```
$input = new Zend_Filter_Input($filters, $validators, $myData);
$input->setOptions($options); 
```

...最后：

```
if ($input->hasInvalid() || $input->hasMissing()) {
  $messages = $input->getMessages();
} 
```

`Zend_Filter_Input` [它在手册](http://framework.zend.com/manual/en/zend.filter.input.html)页上提到。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-05-23T18:09:31.357

在@gnarf 回答之后，对于那些可能以稍微不同的方式设置表单字段的人（比如我），您还可以执行以下操作：

```
$agree_tc_and_privacy = new Zend_Form_Element_Checkbox('agree_tc_and_privacy');
$agree_tc_and_privacy
->setLabel("My T&Cs Agreement text ...")
->addValidator('NotEmpty', false, array('messages' => 'You must and agree...'))
->setRequired(true)
->setOptions(
    array(
        'uncheckedValue'=> '', //important as explained by gnarf above
        'checkedValue' => '1',
    )
);
$this->addElement($agree_tc_and_privacy); 
```

# xml - 具有相同名称但属性值不同的元素序列的 XML 模式？

> ID：827051
> 
> 赞同：7
> 
> 时间：2009-05-05T21:45:53.857
> 
> 标签：xml, xsd

如何为这样的实例文​​档指定 XML 模式：

```
<productinfo>
  <!-- other stuff -->
  <informationset type="Manufacturer">
    <!-- content not relevant -->
  </informationset>
  <informationset type="Ingredients">
    <!-- content not relevant -->
  </informationset>
</productinfo> 
```

也就是说，一个包含两个“信息集”子序列的“productinfo”元素，第一个具有`@type="Manufacturer"`，第二个具有`@type="Ingredients"`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T23:04:29.767

**注意**，正如 Serge 指出的那样，这个答案是不正确的。

*使用xerces*进行测试会出现此错误：[cos-element-consistent](http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/structures.html#cos-element-consistent)`type.xsd:3:21: cos-element-consistent: Error for type '#AnonType_productinfo'. Multiple elements with name 'informationset', with different types, appear in the model group.`的规范中有更多详细信息。

但是有一个解决方案，类似于下面 Marc 的答案，但仍然使用类型。如果它们在由其他类型扩展的超类型的 minOccurs/maxOccurs 列表中，则可能会多次出现具有不同类型的相同内容。也就是说，就像 java 或 C# 中的多态类列表一样。这克服了上述问题，因为虽然该元素名称可以在 xml 中出现多次，但它在 xsd 中只出现一次。

这是示例 xsd 和 xml -这次使用*xerces进行了测试！：*

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="productinfo">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="informationset" type="supertype" minOccurs="2" maxOccurs="2"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="supertype">
  </xs:complexType>

  <xs:complexType name="Manufacturer">
    <xs:complexContent>
      <xs:extension base="supertype">
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>

  <xs:complexType name="Ingredients">
    <xs:complexContent>
      <xs:extension base="supertype">
      </xs:extension>
    </xs:complexContent>
  </xs:complexType>

</xs:schema>

<productinfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <informationset xsi:type="Manufacturer"></informationset>
  <informationset xsi:type="Ingredients"></informationset>
</productinfo> 
```

注意：您无法控制不同类型的*顺序*，或者每种类型出现的次数（每种可能出现一次、多次或根本不出现）——就像 java 或 C# 中的多态类列表一样。但是您至少可以指定整个列表的确切长度（如果您愿意）。

例如，我将上面的示例限制为恰好两个元素，但没有设置顺序（即*制造商*可能是第一个，或者*成分*可能是第一个）；并且未设置重复次数（即它们都可以是*Manufacturer*，或两者都为*Ingredients*，或各自之一）。

* * *

您可以使用 XML Schema *type*，如下所示：

```
<productinfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <informationset xsi:type="Manufacturer"></informationset>
  <informationset xsi:type="Ingredients"></informationset>
</productinfo> 
```

XSD 为每一种定义了单独的复杂类型：

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="productinfo">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="informationset" type="Manufacturer"/>
        <xs:element name="informationset" type="Ingredients"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="Manufacturer">
  </xs:complexType>
  <xs:complexType name="Ingredients">
  </xs:complexType>
</xs:schema> 
```

这是`xsi:type`. 一般来说，不要以为可以在同名元素中指定属性具有不同的值，因为它们是同一个元素的不同定义。

我不是 100% 清楚确切的原因 - 有人知道规范的相关部分吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T05:14:37.647

您可以尝试这样的事情 - 为您的“informationSet”元素创建一个单独的 complexType，并将属性限制为有效字符串列表：

```
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" 
           xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="productinfo">
    <xs:complexType>
      <xs:sequence>
        <xs:element maxOccurs="unbounded" 
                    name="informationset" type="informationSetType" />
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="informationSetType">
    <xs:simpleContent>
      <xs:extension base="xs:string">
        <xs:attribute name="type" type="validAttributeType" use="required" />
      </xs:extension>
    </xs:simpleContent>
  </xs:complexType>

  <xs:simpleType name="validAttributeType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="Manufacturer" />
      <xs:enumeration value="Ingredients" />
    </xs:restriction>
  </xs:simpleType>
</xs:schema> 
```

当然，如果您愿意，您可以扩展该有效属性名称列表 - 只需将更多元素添加到限制枚举列表中。

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-09-22T12:40:46.890

### 使用断言模式组件

感谢**XML Schema 1.1**，有一种方法可以强制执行您的要求，而无需将`xsi`命名空间和 hack 多态性导入 XML 文档。XML Schema 1.1 带来了两个新组件，[**断言**](http://www.w3.org/TR/xmlschema11-1/#cAssertions)和[**类型选择**](http://www.w3.org/TR/xmlschema11-1/#cTypeAlternative)，提供`xs:assert`和`xs:alternative`元素。它们有一个`@test`属性，其中条件和约束被指定为**XPath 2.0 表达式**。

* * *

尽管`xs:alternative`显然是为了解决您的问题，但就我而言，我还没有成功地根据元素的位置分配替代类型。（*模式解析器对节点上下文的理解似乎与我基于经过验证的 XML 文档结构所期望的不同。*）

* * *

**无论如何**，您可以使用以下命令强制执行您的约束`xs:assert`：

```
<xs:element name="productinfo">
  <xs:complexType>
    <xs:sequence minOccurs="2" maxOccurs="unbounded">
      <xs:element name="informationset">
        <xs:complexType>
          <xs:attribute name="type" use="required">
            <xs:simpleType>
              <xs:restriction base="xs:string">
                <xs:enumeration value="Manufacturer" />
                <xs:enumeration value="Ingredients" />
              </xs:restriction>
            </xs:simpleType>
          </xs:attribute>
        </xs:complexType>
      </xs:element>
    </xs:sequence>
    <xs:assert test="informationset[1]/@type='Manufacturer'" xpathDefaultNamespace="##targetNamespace"/>
    <xs:assert test="informationset[2]/@type='Ingredients'" xpathDefaultNamespace="##targetNamespace"/>
  </xs:complexType>
</xs:element> 
```

`@xpathDefaultNamespace`如果您的架构的命名空间为空，则可能不需要使用属性，但如果您的架构定义了一个，则*必须*将其设置为`##targetNamespace`，否则对元素名称的评估将失败。

> **注意：**显然，要使其工作，必须使用支持 XML Schema 1.1 的验证器。例如，使用 OxygenXML 时，您只需在*XML / XML Parser / XML Schema*首选项页面中将默认 XML 模式版本设置为 1.1。使用 Xerces 作为验证器时，必须激活一个[附加功能](https://stackoverflow.com/a/25191506/1933494)`http://apache.org/xml/features/validation/cta-full-xpath-checking`： . 否则它将无法评估您提出的大部分 XPath，因为默认情况下它使用的子集不足。

* * *

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-10T10:10:59.117

在VS中，报错：**同名同作用域的元素必须具有相同的类型。**
我觉得 XSD 不能满足你的要求，你可以尝试从另一个方向解决它。例如，使用 xslt 来验证 XML。XSLT 是基于 xpath 和基于规则的，它可以检查 xml 中的每个地方。
XSD + XSLT 是一个很好的解决方案，XSD 用于模式检查，XSLT 用于信息检查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-28T07:38:05.707

可能是[http://xsd.stylusstudio.com/2001Aug/post03013.htm](http://xsd.stylusstudio.com/2001Aug/post03013.htm)是您正在寻找的。

# php - 如何访问未出现在 $_SERVER 中的请求标头？

> ID：827060
> 
> 赞同：16
> 
> 时间：2009-05-05T21:47:27.643
> 
> 标签：php, http, http-headers

我正在尝试在 PHP 中创建一个 REST API，并且我想实现一个类似于 Amazon 的 S3 方法的身份验证方案。这涉及在请求中设置自定义“授权”标头。

我原以为我可以使用 $_SERVER['HTTP_AUTHORIZATION'] 访问标头，但在 var_dump($_SERVER) 中找不到它。apache_request_headers() 函数可以解决我的问题，但是我的主机将 PHP 实现为 CGI，所以它不可用。

还有另一种方法可以访问 PHP 中的完整请求标头吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-05T21:56:43.050

你需要做一些`mod_rewrite`魔法才能让你的标题越过 CGI 障碍，就像这样：

```
RewriteEngine on
RewriteRule .? - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

<?php
    $auth = $_SERVER['HTTP_AUTHORIZATION'];
?> 
```

请注意，如果您将`mod_rewrite`其用于其他目的，它最终可能是`$_SERVER['REDIRECT_HTTP_AUTHORIZATION']`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-05T21:59:04.103

尝试

```
$_ENV['HTTP_AUTHORIZATION'] 
```

当使用 CGI 接口而不是 Apache 模块接口时，HTTP 标头应可用作环境变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T21:56:31.460

有一个很棒的 PECL 扩展，它允许各种与 HTTP 相关的访问。[PECL_HTTP](http://pecl.php.net/package/pecl_http)，更具体地说是[http://php.net/http](http://php.net/http)和[http://php.net/manual/en/function.http-get-request-headers.php](http://php.net/manual/en/function.http-get-request-headers.php)。

# asp.net - 如何在没有主题的情况下使用 Sitefinity？

> ID：827065
> 
> 赞同：1
> 
> 时间：2009-05-05T21:48:28.670
> 
> 标签：asp.net, themes, sitefinity

我们正在建立一个网站，并且对创建多个主题没有兴趣。我们打算简单地使用普通的旧 CSS 和 XHTML 标记。

有什么合理的方法可以抛弃 Sitefinity 中的主题概念吗？或者我们最好的选择是简单地创建一个单一的、简约的主题并保留它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T04:36:16.090

创建一个主主题 (~/App_Themes/Default)，然后将目录留空。您仍将主题应用到您的 Sitefinity 页面和模板，但该主题不会有任何与之关联的 CSS 文件，因此它与没有主题相同。

希望这会有所帮助。

# windows-services - 如何判断进程是否由服务控制管理器运行

> ID：827067
> 
> 赞同：5
> 
> 时间：2009-05-05T21:49:13.880
> 
> 标签：windows-services

我有一些用 C# 编写的 Windows 服务，如果传递了特定参数，我已经设置为支持从命令行作为控制台应用程序运行。效果很好，但我希望能够检测到应用程序是由服务控制管理器运行还是从命令行运行。

有什么方法可以在运行时判断我的应用程序是否由 SCM 启动？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T22:34:22.367

[如果进程在 SCM 下运行， Environment.UserInteractive](http://msdn.microsoft.com/en-us/library/system.environment.userinteractive.aspx)将返回 false。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T21:56:49.493

SCM 将调用您的 OnStart 方法，因此您可以标记该事件并确保当您从命令行运行时，您不会调用 OnStart。或者，您可以检查启动参数以查看应用程序是如何启动的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-30T21:25:11.090

在 C 中，该函数`StartServiceCtrlDispatcher()`将失败并显示`ERROR_FAILED_SERVICE_CONTROLLER_CONNECT`. 这是 C 中最好的方法，想知道 C# 是否公开了这些？

> ERROR_FAILED_SERVICE_CONTROLLER_CONNECT
> 
> 如果程序作为控制台应用程序而不是作为服务运行，则会返回此错误。如果程序将作为控制台应用程序运行以进行调试，请对其进行结构化，以便在返回此错误时不调用特定于服务的代码。

# php - 在 facebook 调用中调用未定义的方法来调用 publishUserAction

> ID：827069
> 
> 赞同：1
> 
> 时间：2009-05-05T21:49:17.590
> 
> 标签：php, facebook

我在我的服务器上使用 PHP 客户端（通过 FBML 连接）得到以下信息。我已经包含了适当的 php 文件（facebook 等）

```
Fatal error: 
     Call to undefined method FacebookRestClient::feed_publishUserAction() 
      in ..../index.php on line 50 
```

我正在尝试使用[给出的示例](http://wiki.developers.facebook.com/index.php/Feed.publishUserAction#Example_Requests)。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T22:19:08.347

您可能想快速浏览/grep 浏览您的 Facebook API 文件 (facebookapi_php5_restlib.php) 并确保该`feed_publishUserAction()`方法存在。也许您正在使用旧版本的 API 库？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-16T03:37:34.733

天哪，我找到了答案

因为 facebook.com 为您提供的 facebookapi_php5_restlib.php 是一个过时的狗屎

即，您将无法在 facebookapi_php5_restlib.php 文件中找到单词 feed_publishUserAction

但是，来自[这个 facebook wiki 页面](http://wiki.developers.facebook.com/index.php/Demos)的[官方 facebook 笑脸演示](http://svn.facebook.com/svnroot/platform/samples/packages/smiley.tar.gz)包含更完整的 facebookapi_php5_restlib.php 以及 feed_publishUserAction 函数

您想向 facebook 开发人员展示哪根手指？

# java - 使用 java、xml 和 spring 学习/实现 Web 服务的最佳书籍/教程

> ID：827071
> 
> 赞同：11
> 
> 时间：2009-05-05T21:49:43.970
> 
> 标签：java, xml, spring

我是网络服务的新手。使用 java、xml 和 spring 学习 web 服务实现的好方法是什么？有没有什么好书可以很好地涵盖这个主题？或者，是否有任何在线资源、教程等？

另外，有什么好的项目可以理解这个动手操作？

有什么建议>？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:56:32.343

我最初是在没有书籍的情况下学习 Web 服务概念的，所以我的观点可能有偏见，但我认为书籍在一开始不会有太大帮助。一旦你达到需要学习安全、SOA 等的中间状态，也许书籍会有所帮助。

我需要让一名实习生快速了解 Web 服务，因此我让他使用 Web 服务作为业务逻辑层，并在其下使用 SQL Server 来实现两人的[黑白棋](http://en.wikipedia.org/wiki/Reversi)游戏。UI 层是命中服务的桌面可执行文件。

您可以使用 Axis2 和 Swing 执行类似的操作。一旦您构建了第一个 UI，您就可以尝试使用 .NET/Ruby/jQuery 或其他方式使用相同的服务来演示互操作性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T23:10:28.427

![Spring in Action 第二版封面](https://www.manning.com/walls3/walls3_cover150.jpg)

[Spring in Action Second Edition](http://www.manning.com/walls3/)提供了大量有关使用 Spring 和 Web 服务的信息以及示例。无论如何，它对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T21:54:48.203

我从未读过这篇文章，但它在亚马逊上有很好的评论：[Java Web Services: Up and Running](https://rads.stackoverflow.com/amzn/click/com/059652112X)

[替代文字 http://ecx.images-amazon.com/images/I/51OXWAyftOL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51OXWAyftOL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T21:56:41.070

我拥有这本书但还没有读过：[SOA Using Java Web Services](https://rads.stackoverflow.com/amzn/click/com/0130449687)

[![替代文字](https://i.stack.imgur.com/NuZh7.jpg)](https://i.stack.imgur.com/NuZh7.jpg)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T22:23:16.027

Java SOA Cookbook 非常好——但它并没有真正涵盖 Spring。

Spring Recipes 这本书很好地解释了如何在春季做事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T12:46:31.927

我发现书没问题，但最后我使用了 Spring Web 服务，这真是轻而易举。强烈推荐参考手册。它很好地介绍了 Spring Web 服务采用契约优先方法所采用的方法以及推荐它的原因。

[http://static.springframework.org/spring-ws/sites/1.5/reference/html/index.html](http://static.springframework.org/spring-ws/sites/1.5/reference/html/index.html)

干杯。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T01:28:15.513

某些 IDE 具有 Web 服务向导和项目，可指导您设置服务。它们可能不是自己了​​解 Web 服务的好方法，但您会接触到一些可以帮助您建立词汇表和起点的关键术语和想法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-14T22:58:49.657

您不需要 spring 或 XML 来执行 Web 服务。只需一个简单的 jetty 和 stringtemplate 就可以让您专注于 java 和 web 服务的东西，并允许您在 ide 中轻松地重构您的代码。

我希望被春季狂热分子否决，但老实说，这是你想做的事！

# asp.net-mvc - 使用 Spring.net 进行 xVal 验证

> ID：827091
> 
> 赞同：1
> 
> 时间：2009-05-05T21:56:01.787
> 
> 标签：asp.net-mvc, spring.net, xval

我已经开始使用 xVal 作为 ASP.Net MVC 应用程序的验证框架。我使用 Spring.Net IoC 容器将应用程序保存在一起。

我已按照[Steve Sanderson](http://blog.codeville.net/category/aspnet/)博客上的说明让服务器端验证正常工作。但是当我尝试让客户端工作时，我得到以下运行时异常：

```
Spring.Objects.Factory.NoSuchObjectDefinitionException was unhandled by user code 
```

Message="没有定义名为“脚本”的对象：找不到对象 [脚本] 的定义”

我认为这是因为 Site.Masterpage 中有以下代码：

```
<script type="text/javascript" src="<%= ResolveUrl("~/Scripts/jquery-1.2.6.js")%>"></script>
<script type="text/javascript" src="<%= ResolveUrl("~/Scripts/jquery.validate.js")%>"></script>
<script type="text/javascript" src="<%= ResolveUrl("~/Scripts/xVal.jquery.validate.js")%>"></script> 
```

正在尝试使用 Spring 解决 ~/Scripts/ 。

我如何让 Spring 来应对这个问题（即配置 XML 中的内容），或者我在 Site.Master 中进行哪些更改以使这种情况不会发生？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T09:01:42.577

哎呀，在史蒂夫的帮助下，我找到了答案。不要盲目地从网上复制和粘贴示例，我的脚本文件夹中有 jquery-1.3.2.js，而不是 1.2.6。通过将 Site.Master 文件中的引用更改为正确的版本号，一切都开始工作了。

# php - PHP 社区的现状如何？

> ID：827104
> 
> 赞同：15
> 
> 时间：2009-05-05T21:58:27.897
> 
> 标签：php

PHP 5 于 2004 年问世。PHP 5.2 于 2006 年底上线。从那时起，除了 PHP 5.3 的增量错误版本和 beta 版本外，什么都没有。从那时起已经两年半了，尽管 PHP 5.3 确实包含了一些有趣的新特性，但它们并没有*那么具有*革命性。

我已经使用 PHP 七年了，但最近开始感觉社区出现了严重问题。对于社区，我指的并不是整个 PHP 社区（过去几年我们在框架开发方面取得了很大进展），而是相对而言进行所有实际开发的小组。我指的是新闻组名称 php.internals 通常称为的内容。

就我个人而言，我从来都不是这个小组的积极贡献者，但我前段时间读的比较仔细，我的印象是内部冲突和摩擦很多，这阻碍了进步。许多想法和建议没有经过认真考虑就被打掉了，因为有很多“业力”的人不喜欢它，而当达成协议时，它似乎是没有人真正喜欢的妥协。一个很好的例子是命名空间分隔符的选择：“\”，似乎每个人都不喜欢这个选择。

只是我，还是冲突和紧张从内部摧毁了 PHP？PHP 是否存在我理解的在开源项目中很常见的管理问题？你如何处理这些类型的问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T04:47:33.797

我已经用 PHP 编程了 10 年的大部分时间。长期以来，我一直对 PHP 的各种限制感到恼火（糟糕的引用处理和完全缺乏指针，以及非常混乱和不一致的库），我决定切换到 Python 和 wsgi。让我感到兴奋的是使用反斜杠作为分隔符的新命名空间。

Zend 并没有真正尝试改进他们的产品，而是不断地在产品上添加新的东西，而这种产品从来没有像今天这样使用过。

我做这一切都知道我基本上是在扔掉多年的工作.. 但我觉得 PHP 的未来不是很好.. 也很糟糕，我花了 3 年时间开发一个我在许多网站上使用的 PHP 框架已创建。超过 70,000 行代码现已过时。:(

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-06T05:55:37.877

您预计语言变化的速度和频率有多快？我猜 C++ 已经完全死了，因为它们已经 10 年没有更新了。Perl 6 是永远的毁灭公爵，对吧？

Python：2000 年为 2.0，2008 年为 2.6。这是一个 12-15 个月的周期。PHP：2004 年为 5.0，2009 年为 PHP 5.3。这是一个 15-18 个月的周期。Java：1996 年为 1.0，2008 年为 1.6。这是一个 18-24 个月的周期

语言发展是困难的。快速完成并不会让事情变得更容易。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T06:14:28.720

我认为现在是时候分叉 PHP 并创建一个 PHP-Lite 版本了。每个长期运行的开源项目都会达到那个阶段。看看 Netscape，它变得臃肿并被抛弃，直到有人出现并创建了一个精简版的 FireFox。MySQL 也是如此。如果有人也为 PHP 这样做，那就太好了，只是为了保存它。

# perl - 如何对值是数组引用的 Perl 哈希进行排序？

> ID：827105
> 
> 赞同：3
> 
> 时间：2009-05-05T21:58:47.617
> 
> 标签：perl, sorting, hash, reference, perl-data-structures

嘿，我只是想知道是否有一个很酷的“一个衬里”可以对我的哈希保存数组引用进行排序。所以我的哈希中有一堆键/值，例如：

```
$DataBase{$key} = \@value; 
```

但是我想按`array[0]`元素对哈希进行排序。然后循环遍历它们。我有这个开始：

```
foreach my $key (sort {$DataBase{$a} cmp $DataBase{$b} } keys %DataBase) 
```

但这显然只是通过数组的指针值对我的哈希进行排序。它不一定是“一行”，但我希望有一个不涉及重建哈希的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-05T22:01:41.227

```
foreach my $key (sort {$DataBase{$a}->[0] cmp $DataBase{$b}->[0] } keys %DataBase) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T22:44:12.093

作为记录（您可能来自 C 背景），Perl 没有指针，但[引用](http://oreilly.com/catalog/advperl/excerpt/ch01.html)：

> Perl [...] 允许您创建匿名数据结构，并支持一种称为“引用”的基本数据类型，它大致等同于 C 指针。正如 C 指针可以指向数据和过程一样，Perl 的引用可以引用常规数据类型（标量、数组和散列）和其他实体，例如子例程、类型球和文件句柄。与 C 不同，它们不允许您窥视和戳原始内存位置。

类似，但不一样。

C。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T05:27:20.010

我认为您问的基本问题与[如何在 Perl 中按键对哈希值进行排序？](https://stackoverflow.com/questions/743167/how-can-i-sort-a-hash-of-hashes-by-key-in-perl/). 我在 Perl FAQ 中的回答向您展示了如何以您喜欢的任何方式对哈希进行排序。

# jquery - jQuery 多次点击处理程序..如何确保触发顺序？

> ID：827107
> 
> 赞同：1
> 
> 时间：2009-05-05T21:59:16.133
> 
> 标签：jquery, event-handling, live

我有 2 个单击处理程序绑定到这样的元素：

在包含我要绑定的控件的文件中，我有第一个处理程序，它执行一些特定于该控件的功能

```
$("#mycontrol").live("click", function() { alert("foo"); }); 
```

在使用该控件的主页中，我有另一个处理程序绑定到该元素以实现页面特定功能

```
$("#mycontrol").live("click", function() { alert("bar"); }); 
```

我使用“live”，因为 AJAX 调用一直在更改控件，因此将重新注册处理程序。但是我需要一种方法，以便“foo”始终在“bar”之前发生……有什么建议吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-05T22:05:03.577

怎么样：

```
$("#mycontrol").live("click", doFooBar);

function doFooBar() {
    alert("foo");
    alert("bar");
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-05T22:05:40.360

尝试将点击事件合二为一：

```
function foo() { alert("foo"); }
function bar() { alert("bar"); }
$("#mycontrol").live("click", function(){ foo.call(this); bar.call(this); }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T22:08:18.827

您可以执行以下操作：

```
var arrEventHandlers = [];

function registerClickEvent(fnCallback)
{
    arrEventHandlers.push(fnCallback);
}

registerClickEvent (function () { alert ("Foo"); });
registerClickEvent (function () { alert ("Bar"); });

function clickHandler ()
{
    for (var i = 0, size = arrEventHandlers.length; i < size; i++)
    {
        arrEventHandlers[i].apply (...);
    }
}

$("#mycontrol").live("click", clickHandler); 
```

# sql - 如何加快 Oracle 中的 row_number？

> ID：827108
> 
> 赞同：11
> 
> 时间：2009-05-05T21:59:21.700
> 
> 标签：sql, oracle, oracle10g, row-number

我有一个看起来像这样的 SQL 查询：

```
SELECT * FROM(
    SELECT
        ...,
        row_number() OVER(ORDER BY ID) rn
    FROM
        ...
) WHERE rn between :start and :end 
```

本质上，是 ORDER BY 部分让事情变慢了。如果我要删除它，EXPLAIN 成本会下降一个数量级（超过 1000 倍）。我试过这个：

```
SELECT 
    ...
FROM
    ...
WHERE
    rownum between :start and :end 
```

但这并没有给出正确的结果。有什么简单的方法可以加快速度吗？还是我必须花更多时间使用 EXPLAIN 工具？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-06T14:53:14.197

`ROW_NUMBER`中是相当低效的`Oracle`。

有关性能详细信息，请参阅我博客中的文章：

*   [**甲骨文：ROW_NUMBER 与 ROWNUM**](http://explainextended.com/2009/05/06/oracle-row_number-vs-rownum/)

对于您的特定查询，我建议您将其替换为`ROWNUM`并确保使用索引：

```
SELECT  *
FROM    (
        SELECT  /*+ INDEX_ASC(t index_on_column) NOPARALLEL_INDEX(t index_on_column) */
                t.*, ROWNUM AS rn
        FROM    table t
        ORDER BY
                column
        )
WHERE rn >= :start
      AND rownum <= :end - :start + 1 
```

此查询将使用`COUNT STOPKEY`

还要确保您`column`不可为空，或添加`WHERE column IS NOT NULL`条件。

否则索引不能用于检索所有值。

请注意，您不能在`ROWNUM BETWEEN :start and :end`没有子查询的情况下使用。

`ROWNUM`总是最后分配并最后检查，这样`ROWNUM`总是按顺序排列，没有间隙。

如果使用`ROWNUM BETWEEN 10 and 20`，则满足所有其他条件的第一行将成为返回的候选者，临时分配`ROWNUM = 1`并通过 的测试`ROWNUM BETWEEN 10 AND 20`。

然后下一行将是候选人，分配`ROWNUM = 1`和失败等，所以，最后，根本不会返回任何行。

这应该通过将`ROWNUM`'s 放入子查询来解决。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-05T23:12:05.007

对我来说看起来像是一个分页查询。

从这篇 ASKTOM 文章（大约 90% 的页面下方）：

[对于这些分页查询，您需要按唯一的顺序进行排序，以便每次都将 ROW_NUMBER 确定性地分配给行。](http://www.oracle.com/technology/oramag/oracle/07-jan/o17asktom.html "AskTom 分页")

此外，您的查询也不尽相同，因此我不确定将一个与另一个的成本进行比较有什么好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T22:04:30.910

您的 ORDER BY 列是否已编入索引？如果不是，那是一个很好的起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T23:25:46.360

部分问题是“开始”到“结束”的跨度有多大以及它们“居住”的地方。假设您在表中有一百万行，并且您想要第 567,890 到 567,900 行，那么您将不得不接受这样一个事实，即它需要遍历整个表，几乎所有这些都按 id 排序，并计算出哪些行属于该范围。

简而言之，这是很多工作，这就是优化器付出高成本的原因。

这也不是索引可以提供多大帮助的东西。索引会给出顺序，但充其量只是给你一个开始的地方，然后你继续阅读，直到你到达第 567,900 个条目。

如果您一次向最终用户展示 10 个项目，那么实际上可能值得从数据库中获取前 100 个项目，然后让应用程序将这 100 个项目分成十个块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T22:53:07.440

花更多时间使用 EXPLAIN PLAN 工具。如果您看到 TABLE SCAN，您需要更改您的查询。

你的询问对我来说毫无意义。查询 ROWID 似乎是自找麻烦。该查询中没有关系信息。这是您遇到问题的真实查询还是您为说明问题而编造的示例？

# java - postgresql 查询中的大结果集

> ID：827110
> 
> 赞同：6
> 
> 时间：2009-05-05T21:59:37.350
> 
> 标签：java, spring, postgresql, jdbc, spring-jdbc

我正在对 postgresql 数据库中的表运行查询。数据库位于远程计算机上。[该表有大约 30 个使用 postgresql分区功能](http://www.postgresql.org/docs/8.3/interactive/ddl-partitioning.html)的子表。

该查询将返回一个大的结果集，大约 180 万行。

在我的代码中，我使用 spring jdbc 支持，方法[JdbcTemplate.query](http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html)，但我的[RowCallbackHandler](http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/RowCallbackHandler.html)没有被调用。

我最好的猜测是 postgresql jdbc 驱动程序（我使用版本 8.3-603.jdbc4）在调用我的代码之前将结果累积到内存中。我认为[fetchSize 配置](http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/jdbc/core/JdbcTemplate.html#setFetchSize(int))可以控制这一点，但我试过了，没有任何改变。我按照 postgresql 手册的[推荐](http://jdbc.postgresql.org/documentation/83/query.html#fetchsize-example)这样做了。

当我使用 Oracle XE 时，此查询运行良好。但是我正在尝试迁移到 postgresql，因为分区功能在 Oracle XE 中不可用。

我的环境：

*   PostgreSQL 8.3
*   Windows Server 2008 企业版 64 位
*   JRE 1.6 64 位
*   春天 2.5.6
*   Postgresql JDBC 驱动程序 8.3-603

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T00:50:03.383

为了使用游标检索数据，除了设置获取大小之外，您还必须设置 ResultSet.TYPE_FORWARD_ONLY 的 ResultSet 类型（默认值）并自动提交为 false。这在您链接到的文档中被引用，但您没有明确提到您执行了这些步骤。

小心 PostgreSQL 的分区方案。它确实对优化器做了非常可怕的事情，并且可能会导致不应该出现的大量性能问题（取决于您的数据的具体情况）。无论如何，您的行只有 180 万行吗？鉴于它已被适当索引，没有理由仅根据大小对其进行分区。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T22:50:11.453

我敢打赌，您的应用程序中没有一个客户端同时需要 180 万行。您应该想出一种明智的方法将结果分成更小的部分，并让用户有机会迭代它们。

这就是谷歌所做的。当您进行搜索时，可能会有数百万次点击，但它们一次返回 25 页，并认为您会在第一页找到您想要的内容。

如果它不是客户端，并且正在以某种方式处理结果，我建议让数据库处理所有这些行并简单地返回结果。仅仅为了在中间层进行计算而返回 180 万行是没有意义的。

如果这些都不适用，那么你就有一个真正的问题。是时候重新考虑一下了。

在阅读了后面的回复之后，我觉得这更像是一个报告解决方案，应该批量处理或实时计算并存储在不属于事务系统的表中。将 180 万行带到计算移动平均线的中间层是无法扩展的。

我建议重新定位自己 - 开始将其视为报告解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T04:12:05.433

[fetchSize 属性按照postgres 手册](http://jdbc.postgresql.org/documentation/83/query.html#fetchsize-example)中的描述工作。

我的错误是我将 auto commit = false 设置为来自连接池的连接，该连接不是准备好的语句使用的连接。

感谢所有的反馈。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-08-12T18:39:51.440

我做了上面的所有事情，但我需要最后一点：确保调用包含在事务中并将事务设置为只读，这样就不需要回滚状态。

我添加了这个：`@Transactional(readOnly = true)`

干杯。

# sql-server - 使用 SQL Server 从跨服务器插入中获取最后一个 ID

> ID：827118
> 
> 赞同：3
> 
> 时间：2009-05-05T22:03:56.840
> 
> 标签：sql-server, tsql

我正在运行跨服务器插入

```
INSERT INTO server.database.dbo.table (Field) VALUES('test') 
```

之后，我需要获取最后插入的 id。但是，当我运行 scope_identity 函数时，我没有从外部服务器获取最新的 id。

```
SELECT @ID=SCOPE_IDENTITY() 
```

如何从跨服务器插入中检索最后一个 id？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T22:08:46.420

来自[http://msdn.microsoft.com/en-us/library/ms187342.aspx](http://msdn.microsoft.com/en-us/library/ms187342.aspx)

> @@IDENTITY 函数的作用域是执行它的本地服务器上的当前会话。此功能不能应用于远程或链接服务器。要在不同的服务器上获取标识值，请在该远程或链接服务器上执行存储过程，并让该存储过程（在远程或链接服务器的上下文中执行）收集标识值并将其返回给调用连接在本地服务器上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T22:09:50.287

我很确定您将不得不将 INSERT 包装在远程链接服务器上的存储过程中，并让存储过程返回 IDENTITY 列值。

参考： [http://msdn.microsoft.com/en-us/library/ms187342.aspx](http://msdn.microsoft.com/en-us/library/ms187342.aspx)

# sql - 如何估计 Oracle 索引的大小？

> ID：827123
> 
> 赞同：11
> 
> 时间：2009-05-05T22:06:08.847
> 
> 标签：sql, oracle

我正在考虑向 Oracle 表添加索引，但我想先估计索引构建后的大小（我不需要精确的大小 - 只是一个估计值。）

假设我可以访问有关表的所有元数据（行数、列数、列数据类型等），我可以执行任意 Oracle SQL 查询以获取有关表当前状态的附加数据，并且我知道我希望索引定义是什么，我如何估计这个大小？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-05T22:11:51.967

您可以使用这些[Oracle 容量规划和规模调整电子表格](http://www.rampant-books.com/download_sizing_spreadsheets.htm)。

对于不那么成熟的事情，如果您只想返回信封类型[对索引的粗略估计](http://forums.oracle.com/forums/thread.jspa?threadID=575619)：

> 计算组成索引键的每一列的平均大小，并将列加一个 rowid 并为索引行标题添加 2 个字节以获得平均行大小。现在只为索引的 pctfree 值添加一点，以得出开销因子，对于 10 的 pctfree，可能是 1.125。
> 
> 索引表行数 X 平均行长度 X 1.125
> 
> 注意 - 如果索引包含可为空的列，则每个表行可能不会出现在索引中。在 90% 的列为空的单列索引上，只有 10% 会进入索引。
> 
> 将估计值与表空间范围分配方法进行比较，并在必要时调整最终答案。
> 
> 此外，随着索引变得更大，更大的开销因子可能会更好，因为索引的数据越多，支持索引结构所需的分支块就越多，并且计算实际上只是叶块的数字。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-02-21T16:14:08.253

`explain plan`您可以通过运行on create index 语句来估计索引的大小：

```
create table t as
  select rownum r 
  from   dual 
  connect by level <= 1000000;

explain plan for
  create index i on t (r);

select * 
from   table(dbms_xplan.display(null, null, 'BASIC +NOTE'));

PLAN_TABLE_OUTPUT                                                                                                                         
--------------------------------------------------------------------------------------------------------------------------------------------
Plan hash value: 1744693673                                                                                                                 

---------------------------------------                                                                                                     
| Id  | Operation              | Name |                                                                                                     
---------------------------------------                                                                                                     
|   0 | CREATE INDEX STATEMENT |      |                                                                                                     
|   1 |  INDEX BUILD NON UNIQUE| I    |                                                                                                     
|   2 |   SORT CREATE INDEX    |      |                                                                                                     
|   3 |    TABLE ACCESS FULL   | T    |                                                                                                     
---------------------------------------                                                                                                     

Note                                                                                                                                        
-----                                                                                                                                       
   - estimated index size: 4194K bytes 
```

查看底部的“注释”部分：**预计索引大小：4194K 字节**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-08-09T11:21:38.937

从版本 10gR2 开始，您可以使用`DBMS_SPACE.CREATE_INDEX_COST`

```
DBMS_SPACE.CREATE_INDEX_COST (
   ddl             IN    VARCHAR2,
   used_bytes      OUT   NUMBER,
   alloc_bytes     OUT   NUMBER,
   plan_table      IN    VARCHAR2 DEFAULT NULL); 
```

来自文档：“此过程确定在现有表上创建索引的成本。输入是将用于创建索引的 DDL 语句。该过程将输出创建索引所需的存储空间。”

请参阅[https://docs.oracle.com/database/121/ARPLS/d_space.htm#ARPLS68101](https://docs.oracle.com/database/121/ARPLS/d_space.htm#ARPLS68101)

**示例**（也在[sqlfiddle](http://sqlfiddle.com/#!4/9e089/7 "sqlfiddle")）：

```
DECLARE 
 ub NUMBER; 
 ab NUMBER; 
BEGIN 
 DBMS_SPACE.CREATE_INDEX_COST (
    ddl             => 'CREATE INDEX x_1 ON t1 (a,b,c) TABLESPACE users',
    used_bytes      => ub,
    alloc_bytes     => ab
   );
 DBMS_OUTPUT.PUT_LINE('Used MBytes: ' || ROUND(ub/1024/1024)); 
 DBMS_OUTPUT.PUT_LINE('Alloc MBytes: ' || ROUND(ab/1024/1024)); 
END; 
/ 
```

输出：

```
Used MBytes: 1
Alloc MBytes: 2 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-02-27T09:24:28.653

下面的 SQL 查询可用于了解oracle 中表占用的估计[索引大小。](https://orahow.com/check-index-on-a-table-and-size-in-oracle/)

```
SELECT (row_size_in_bytes * cnt_of_rows)/1000/1000/1000 index_size_in_GB
FROM
(
  SELECT table_name ,
         (sum (column_length) / 1048576) * 1000000 row_size_in_bytes
  FROM   user_ind_columns
  WHERE  table_name=UPPER('&Enter_Table_Name')
  GROUP  BY table_name
) A,
(SELECT count(1) cnt_of_rows FROM &Enter_Table_Name ); 
```

# asp.net - UpdatePanel 和 UpdateProgress 不起作用

> ID：827124
> 
> 赞同：0
> 
> 时间：2009-05-05T22:06:46.880
> 
> 标签：asp.net, javascript, silverlight

如果我使用： OnSelectedIndexChanged 像这样：

```
<asp:DropDownList ID="ddl1" AutoPostBack="true"  OnSelectedIndexChanged="Test_SelectedIndexChanged" runat="server"></asp:DropDownList> 
```

UpdatePanel 和 UpdateProgress 正常工作，这意味着它显示了我的小 gif 等。

但是，一旦我将其更改为调用 javascript 代码，如下所示：

```
<asp:DropDownList ID="ddl1" AutoPostBack="true" onchange="selectValues()" runat="server"></asp:DropDownList> 
```

它停止工作。进度不显示。现在，在有人问我为什么要这样做之前，这是因为我需要在托管代码中调用一些脚本。它与银光有关。

有没有人有解决这个问题的方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-05T10:03:23.043

如果您的更新面板没有刷新，更新进度控件将不会运行。如果您尝试更新某些内容而不调用更新面板的更新（即使用您自己的 JS），那么 updateprogress 将不起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T22:15:38.713

我猜这是因为进度与 UpdatePanel 何时更新有关。

当您从列表中选择时，您的第二个下拉菜单是否会触发更新面板？

您可能必须在下拉列表中添加一个 OnSelectedIndexChanged 事件，该事件不会触发更新面板。

您可以在您的 SelectValues() 函数中添加一些 javascript 以显示进度面板，我相信它只是一个带有图像的 div，您可以使用 javascript 将 css 更改为可见。

希望有帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T16:35:37.087

我认为您的 javascript 返回错误值。因此，下拉选择索引更改事件的服务器端事件不会触发，因为它不会回发整个页面。

# visual-studio - 如何在 Visual Studio 中显示我的项目包含多少行代码？

> ID：827127
> 
> 赞同：21
> 
> 时间：2009-05-05T22:08:17.407
> 
> 标签：visual-studio, code-metrics

> **可能重复：**
> [如何计算 Visual Studio 解决方案中的代码行数？](https://stackoverflow.com/questions/1244729/how-do-you-count-the-lines-of-code-in-a-visual-studio-solution)

如何在 Visual Studio 2008 Professional SP1 中显示代码指标窗口？我正在查看我的项目用于学校的总代码行数，但我找不到。

帮助文件说去查看->其他窗口->代码指标，但是这个选项对我不可用。我还尝试在解决方案资源管理器中右键单击该项目以查看是否有选项但没有。

这个功能的神话独角兽在哪里？如果 Pro 版本没有此功能，是否有人找到一种简单的外部方法来自动计算所有 .cs 文件中的行数？

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2010-01-06T16:15:05.723

您不需要第三方工具，只需按`CTRL`+ `SHIFT`+ `F`，然后在弹出的窗口中选择“使用正则表达式”。使用这个正则表达式：

```
^:b*[^:b#/]+.*$ 
```

[对于 Visual Studio 2012](https://stackoverflow.com/questions/827127/how-do-i-show-how-many-lines-of-code-my-project-contains-in-visual-studio#comment21041084_2014322)及更高版本，正则表达式为：

```
^(?([^\r\n])\s)*[^\s+?/]+[^\n]*$ 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-05T22:17:46.057

Code Metrics 仅在 Visual Studio 2008 的 Team System 版本中可用。如果您有 Express Edition、Standard 或 Professional，那么您就不走运了。

在此处查看评论和屏幕截图：

*   [http://blogs.msdn.com/fxcop/archive/2007/10/03/new-for-visual-studio-2008-code-metrics.aspx](http://blogs.msdn.com/fxcop/archive/2007/10/03/new-for-visual-studio-2008-code-metrics.aspx)
*   [http://blogs.msdn.com/somasegar/archive/2007/10/04/code-analysis-features-in-vs-2008.aspx](http://blogs.msdn.com/somasegar/archive/2007/10/04/code-analysis-features-in-vs-2008.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-05T22:26:51.543

DPack 执行此操作。安装后，只需转到*工具 -> DPack -> 解决方案统计*...。

[http://www.usysware.com/dpack/](http://www.usysware.com/dpack/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-05T23:22:19.427

我的 VS2008 中没有这个功能，所以几个月前我实现了一个快速而肮脏的 Windows 应用程序，它计算 C# 文件中 CRLF 的数量。当然，这会计算空行和 VS 生成的文件中的行，但是通过一些调整，我相信你可以让它生成一个很好的计数。这是 Windows 窗体中的操作代码；dlgFolder 控件是 FolderBrowserDialog 控件：

```
if (dlgFolder.ShowDialog() == DialogResult.OK)
{
   int totalLines = 0;
   string[] fileList = Directory.GetFiles(dlgFolder.SelectedPath, "*.cs",    SearchOption.AllDirectories);

   for (int x = 0; x < fileList.Length; x++)
   {
      string[] sourceCodeLines = File.ReadAllLines(fileList[x]);
      totalLines += sourceCodeLines.Length;    
   }

   MessageBox.Show(String.Format("There are {0} lines of C# code in the folder{1}",
totalLines.ToString(), dlgFolder.SelectedPath));
} 
```

# c# - C# Outlook 2007 - 如何直接从我的插件访问附件内容？

> ID：827131
> 
> 赞同：3
> 
> 时间：2009-05-05T22:09:09.650
> 
> 标签：c#, outlook, outlook-2007

我正在尝试解析基于文本的文件附件（txt、doc 等）。但是，我似乎无法获取二进制信息本身。我可以获取文件名，我可以将文件保存到某个临时文件夹并从那里打开它，但这似乎很乱。

有什么方法可以访问附件的内容而不保存它，阅读它，然后删除它还是我只是在追我的尾巴？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T10:29:45.017

Redemption 将在这里为您提供帮助，SafeMailItem.Attachments 集合具有 Attachment 对象，该对象具有属性“AsText”签出

[http://www.dimastr.com/redemption/](http://www.dimastr.com/redemption/)

76梅尔

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-08-03T02:38:28.937

您可以使用 Microsoft 架构获取附件的内容 -

```
 private void GetAttachmentContent(Attachments attachments)
    {
        foreach (Attachment attachment in attachments)
        {
            //microsoft schema to get the attachment content
            string AttachSchema = "http://schemas.microsoft.com/mapi/proptag/0x37010102";
            byte[] filebyte = (byte[])attachment.PropertyAccessor.GetProperty(AttachSchema);
        }
    } 
```

您需要参考：代码文件中的 Microsoft.CSharp.dll

# visual-studio - 您如何在源代码管理中处理 VS.net sln 和 proj 文件？

> ID：827139
> 
> 赞同：3
> 
> 时间：2009-05-05T22:10:41.317
> 
> 标签：visual-studio, version-control

我希望这符合编程相关的条件，因为它涉及如何构建项目。

因为我一直使用 VS.net 的网站模型，所以我从来没有解决方案和项目文件，并且将所有内容都放入源代码管理中效果很好。我知道我网站目录中的所有内容都是我网站所需要的。

现在我使用的是 asp.net MVC，它只有一个项目模型，所以现在我有了这些解决方案和项目文件。如果我一个人处理它很好，但是一旦其他人开始从项目中添加/删除文件，我们的解决方案文件就会变得混乱，人们最终不得不获取最新的解决方案文件，看看有什么改变，然后添加回来/删除他们文件并再次签入解决方案文件。这已经成为一个问题，因为有时人们没有意识到解决方案文件已更改，他们进行了其他更改，然后当他们检查其他人对其文件进行更新的所有内容时，他们发现他们的文件已从项目中消失（尽管仍然在磁盘上）。

这是正常的吗？有没有办法构建一个项目，这样我们就不需要签入解决方案和项目文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:41:37.840

您的开发人员没有正确使用 TFS。您应该打开多个签出，并且每个人在签入时都需要小心正确地合并他们的更改。TFS 会提示您这样做，并且接受默认值几乎总是正确的做法。

有一两个开发人员从未得到它的情况并不少见，您可能不得不时不时地帮助他们。但是每个在团队中工作的程序员都需要学习如何正确使用源代码控制工具。如果他们不能做到这一点，他们就不应该编写软件。

[编辑] 如果您直接签入 *.sln 文件，而不是选择“将解决方案添加到源代码管理”，我想到您可能会遇到这些问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T22:18:54.353

TFS 多次签出往往会发生这种情况。从 VSS 到 TFS 可能很难掌握，因为 VSS 允许一个人一次检出文件。自动合并在大多数情况下应该对您有用，但有几条规则可以减轻痛苦：

1.  尽早并经常签入（如果您添加删除或重命名文件，请立即签入，即使它是空白持有人）
2.  在您签入之前，请先获取最新信息，这将要求您在本地解决冲突

尝试设置持续集成，以便开发人员始终了解 buidl 的状态以及是否可以签入/签出。

在我们当前的项目开始时，我们有点痛苦，但当我们遵循上述规则时，它很快就安定下来了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T22:18:54.790

我认为这不正常-您使用什么进行源代码控制？听起来开发人员不尊重其他人所做的更改——在没有先合并的情况下签入。

我知道在项目的早期，当添加和删除大量文件时，跟上可能是个问题 - 您需要检查项目文件，添加文件，然后签入新文件和项目，这样其他开发者也可以更新它。您可能会在一个解决方案中拥有多个项目文件 - 也许一个临时解决方案是为每个开发人员拥有一个“持有”项目，然后定期清理它们 - 尽管这些类型的临时修复确实有成为永久性的趋势。

我不知道如何设置不在源代码管理中的项目文件，但我想您可以创建一个生成它们的脚本。

经历过这些之后，关键是开发人员之间的尊重和良好的沟通。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-05T22:57:47.957

就个人而言，我认为对项目和解决方案文件进行更改需要整个开发团队的纪律和清晰（易于理解）的规则。这些文件（.sln、.*proj）是您项目的瓶颈，任何错误或不一致都会导致您的团队停机。变革需要经过深思熟虑、计划和执行。

它们必须通过源代码控制（您已经在使用，非常棒）来保护它们，并且您的团队成员应该在只进行他们需要的更改的基础上工作，而不是长时间签出项目或解决方案文件。

如果您允许多个（共享）签出，则在覆盖其他用户的更改方面可能会出现问题。根据您的源代码控制机制，可能需要人们手动合并更改。就个人而言，我会要求人们在合并时相互协商他们的项目/解决方案更改（这并不总是能够实现）。

如果您使用 TFS，第三个选项是搁置功能。如果有人需要在本地进行更改，他们可以搁置更改并稍后合并。

最后，另一种策略是尝试将您的解决方案构建为尽可能模块化——这样人们就分散了，在不同的项目上工作，并且（理想情况下）不必在太多公共领域重叠。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-05T23:14:37.323

正如人们所提到的，我不确定您是否使用 TFS，但是如果您是（或者如果您正在使用具有类似功能的源代码控制），您可以将其设置为 sln 和 csproj 文件是排他锁定并且无法被合并。

我们已经与相当大的团队一起完成了这项工作，虽然它会导致一些初始问题，因为人们从长远来看已经习惯了它，但它已经解决了许多以前导致问题的问题。本质上，您将长期合并问题/复杂性换成短期编译/签入问题，我们发现这是一个很好的权衡。

一旦您将其设置为强制排他签出并且不合并，您就可以让您的开发团队习惯这样一个事实，即他们应该尽可能短地锁定 sln 和 proj 文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-05T23:05:38.627

总是检查他们。

在签入新版本之前，请始终签出最新版本（如果可能，请合并），确保您的更改存在。

如果您的源代码控制不需要特殊操作即可从旧版本签入，请获取不同的源代码控制。

# php - 将 parse_str 用于可选函数参数与数组相比有优势吗？

> ID：827140
> 
> 赞同：1
> 
> 时间：2009-05-05T22:10:54.467
> 
> 标签：php, optional-parameters, function-parameter

我碰巧对 WordPress 博客进行了一些更改，并注意到他们使用`parse_str`( [http://php.net/parse_str](http://php.net/parse_str) ) 来解析并将其可选参数设置为函数。

我想知道这是否比发送数组有优势？

例子：

带数组：

```
$blahOptions = array(
    'option_1' => true,
);
BlahArray($blahOptions);
function BlahArray($options = array()) {
    $defaults = array(
        'option_1' => false,
        'option_2' => 'blah',
    );
    // this would probably be in a function to be used everywhere
    foreach ($defaults as $defaultOption => $defaultValue) {
        if (!isset($options[$defaultOption])) $options[$defaultOption] = $defaultValue;
    }
} 
```

与`parse_str`：

```
$blahOptions = 'option_1=1';
BlahString($blahOptions);
function BlahString($options = '') {
    $defaults = array(
        'option_1' => false,
        'option_2' => 'blah',
    );
    parse_str($options, $defaults);
    $options = $defaults;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-05T22:25:57.457

不，这似乎是一种传递函数参数参数的荒谬方式。如果您需要重新创建 $_GET 或 $_POST 变量或类似的东西，我可以理解它，但是对于函数的参数？那是代码的味道。

他们应该使用数组，然后使用[extract()](http://www.php.net/extract)代替。我以前使用过 Wordpress，我的建议是让代码保持一定的距离。它不是模型编程的示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T22:21:36.593

不，缺点多于优点。

当您使用单个字符串时，您只需传递字符串值。使用数组，您可以使用每种 PHP 数据类型，并且每个元素的值类型彼此独立。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T22:22:38.260

使用 parse_str，您可以潜在地从 URL 中删除查询字符串，并且该函数将起作用。如果您使用数组，并且想要使用查询字符串，则必须在调用函数之前将所有内容枚举到数组中。

我并不完全相信这是最好的方法，但我知道它如何增加一点灵活性。

# domain-driven-design - DDD 为不同的上下文边界保存“相同”实体

> ID：827145
> 
> 赞同：4
> 
> 时间：2009-05-05T22:12:08.473
> 
> 标签：domain-driven-design

这只是一个例子。

假设您有 2 个实体用于 2 个不同的上下文边界。第一个上下文是 SkillContexter，实体是“Player”，具有 3 个属性：Id、Name 和 SkillLevel。在另一个上下文（Contactcontext）中，实体是“玩家”并具有 3 个属性：Id、Name 和 EMail。

如何将这些实体持久保存到数据库中？我只想要一张桌子（玩家）而不是两张桌子（PlayerContact，PlayerSkill）。我应该为玩家提供两个不同的存储库，将不同的上下文实体保存到同一张表中吗？或者我应该有一个“主”玩家实体来保存我需要保存的所有属性，以便我创建一个名为 PlayerMaster 的新实体，它有 4 个属性：Id、Name、EMail 和 SkillLevel？

第一个解决方案为我提供了更多存储库，第二个解决方案让我创建了一个“技术”实体，其唯一目的是将数据保存到数据库中，这感觉真的不对，还是有更好的解决方案我错过了？

你们是怎么解决的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T01:06:37.010

当我第一次开始使用 DDD 时，我也与上下文 + 域 + 模块 + 模型的事物组织作斗争。

DDD 的真正目的是作为构建领域模型的指南。一旦我停止尝试对上下文和边界进行子组织，并开始思考实体之间真正共享的内容 - 事情就开始更好地融合在一起。

我实际上不使用上下文，除非它是一个完全不同的应用程序（app = context）。只是我的偏好。但是，我确实有只共享代码中通用的基本抽象和接口的模块（IRepository、IComponent 等）。问题是，DDD 说模块可以在模块之间共享实体——但是，只能在非常有限的范围内（你真的不想经常这样做）。

考虑到这一点，我将摆脱使用上下文并转向“我真正想要完成什么，这些模型有什么共同点）。这就是我的想法，阅读你的问题（如果我理解他们的话）。

```
Person() is a base entity.  It has ID and Name.

PlayerSkill() is a Value Object, that is 
accessable from Person().PlayerSkill.

Contact() is an entity that inherits Person(), 
so it inherits ID and Name, and has additional Contact properties you want. 
```

现在，我刚刚撕毁了你的域名。我知道。

您也可以使用混合方法：

```
Person() is a base entity.  It has ID and Name.

Player() inherits Person(), applies Skill()
and other VOs.

Contact() inherits Person(), applies Address()
and other VOs. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T00:10:45.863

我不太清楚你所说的上下文边界是什么意思，所以我的回答可能是错误的。

两个 Player 实体是否代表同一个物理实体（人）？如果是这样，那么我将创建一个具有所有四个属性的 Player 实体，并将它们的数据存储在一个表中。

# asp.net - jQuery Autocomplete 在 AutoPostBack 上丢失文本

> ID：827147
> 
> 赞同：3
> 
> 时间：2009-05-05T22:12:23.417
> 
> 标签：asp.net, jquery, webforms, autocomplete, autopostback

我在 ASP.Net Webform 上有一个 jQuery Autocomplete 字段，到目前为止一切都很好。我还有一个 DropDownList，我需要使用 AutoPostBack 触发 onSelectedIndexChanged。

当我更改我的代码以执行 AutoPostBack 时，带有 jQ​​uery AutoComplete 的文本字段返回空白。但是，如果我查看页面的来源，则文本位于文本字段中。如果我现在发布表单，该页面将发回一个空白字段。我的 Google-Fu 在这方面很弱，因为我想不出任何解决方法。

有没有人遇到过这样的问题，自动完成字段在 AutoPostBack 上被空白，你是如何解决的？

如果真的有必要，我可以发布代码，但由于公司政策，我需要先清理很多代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T23:53:05.827

自动完成字段是如何初始化的？是否在从服务器加载页面时或通过 document.ready 上的自动完成 jQuery 插件设置为空字符串？

如果插件的源代码在 document.ready 上将文本框设置为空字符串，请尝试以下操作：

```
// Store current textbox value in a var
var temp = $('#mytextbox').val();

// Initialize the autocomplete plugin (winging it on the syntax)
$('#mytextbox').autocomplete();

// Reset the value of the textbox.
$('#mytextbox').val(temp); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-31T19:42:30.020

如果您使用 jQuery Autocomplete 插件 1.1，* 修订：$Id：jquery.autocomplete.js 15 2009-08-22 10:30:27Z joern.zaefferer $

在选项中添加“autoPostBackSelection: false” 例如：

```
$.Autocompleter.defaults = {
    inputClass: "ac_input",
    resultsClass: "ac_results",
    loadingClass: "ac_loading",
    minChars: 1,
    delay: 400,
    autoPostBackSelection: false,
    ... 
```

之后，将其添加到 "return true;" 函数末尾的 "selectCurrent() 之前。

```
if (options.autoPostBackSelection == true) {
        __doPostBack($input.id, "");
      } 
```

例子：

> 函数 selectCurrent() { ... if (options.autoPostBackSelection == true) { __doPostBack($input.id, ""); } 返回真；}

# iphone - 在单击 iPhone 按钮时在 Safari 中打开 URL

> ID：827148
> 
> 赞同：2
> 
> 时间：2009-05-05T22:13:51.400
> 
> 标签：iphone

我想在我的 iPhone 应用程序中添加一个按钮，单击该按钮将在 iPhone 上的 safari 中打开一个 URL（我的应用程序将终止对吗？）

谢谢。

赖汉

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-05T22:23:29.740

你需要`- (BOOL)openURL:(NSURL *)url`在`UIApplication`.

`UIApplication`是一个单例，所以你的代码看起来像这样：

```
NSURL *url;
[[UIApplication sharedApplication] openURL:url]; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T22:15:51.193

如果您只是在 Safari 中打开，您的应用程序将关闭。

但是，您可以使用 WebView 控件将 Web 浏览器嵌入到您的应用程序中。这样你的应用程序就不会终止。

# .net - 如何从网页中找到的不完整 URL 形成完整的 URL？

> ID：827157
> 
> 赞同：1
> 
> 时间：2009-05-05T22:16:28.323
> 
> 标签：.net, asp.net, url, hyperlink, resolve

我可以检索网页的文本，比如说[https://stackoverflow.com/questions](https://stackoverflow.com/questions) 和一些真实的和虚构的链接：

```
    /问题
    /标签
    /questions?sort=votes
    /questions?sort=active
    随机页面.aspx
    ../coolhomepage.aspx

```

知道我的原始页面是[https://stackoverflow.com/questions](https://stackoverflow.com/questions) .Net 中有没有办法解决指向此的链接？

```
    https://stackoverflow.com/questions
    https://stackoverflow.com/tags
    https://stackoverflow.com/questions?sort=votes
    https://stackoverflow.com/questions?sort=active
    https://stackoverflow.com/questions/randompage.aspx
    https://stackoverflow.com/coolhomepage.aspx

```

有点像浏览器足够聪明地解析链接的方式。

=========================== 更新 - 使用大卫的解决方案：

```
    '正则表达式匹配所有 <a ... /a> 链接
    Dim myRegEx As New Regex("\<\s*a (?# Find opening <a tag) " & _
                             ".+?href\s*=\s*['""] (?# Then all to href=' or "" ) " & _
                             "(?<href>.*?)['""] (?# Then all to the next ' or "") " & _
                             ".*?\> (?# 然后全部到 > ) " & _
                             "(?<name>.*?)\<\s*/a\s*\> (?# Then all to </a> ) ", _
                             RegexOptions.IgnoreCase 或 _
                             RegexOptions.IgnorePatternWhitespace 或 _
                             正则表达式选项。多行）

    'MatchCollection 保存所有匹配的链接
    将 myMatchCollection 调暗为 MatchCollection
    myMatchCollection = myRegEx.Matches(Me._RawPageText)

    '遍历所有匹配并评估 href 属性的值。
    For i As Integer = 0 To myMatchCollection.Count - 1
        将 thisLink 调暗为 String = ""
        thisLink = myMatchCollection(i).Groups("href").Value()
        '这会检查 Javascript 和 Mailto 链接。
        '这并不完整。还有其他要检查的，我只是还没有遇到过。
        如果 thisLink.ToLower.StartsWith("javascript") 那么
            thisLink = "JAVASCRIPT:" & thisLink
        ElseIf thisLink.ToLower.StartsWith("mailto") Then
            thisLink = "MAILTO:" & thisLink
        别的
            将 baseUri 调暗为新 Uri(Me.URL)

            If Not thisLink.ToLower.StartsWith("http") Then
                '这是一个部分 URL，所以我们假设它是相对于我们的原始 URL
                将 myUri 调暗为新 Uri(baseUri, thisLink)
                thisLink = "相对本地链接：已解决：" & myUri.ToString() & " ORIGINAL: " & thisLink
            别的
                '链接以 HTTP 开头，确定是基本主机的一部分还是在主机之外。
                将 ThisUri 调暗为新的 Uri(thisLink)
                如果 ThisUri.Host.ToLower = baseUri.Host.ToLower Then
                    thisLink = "内部完整链接：" & thisLink
                别的
                    thisLink = "外部链接：" & thisLink
                万一
            万一

        万一

        '我将找到的链接存储到 Generic.List(Of String)
        '此链接添加了描述性文本。
        'TODO：使集合仅包含唯一的内部链接。
        Me._Links.Add(thisLink)
    下一个

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T22:25:24.853

你的意思是这样吗？

```
Uri baseUri = new Uri("http://www.contoso.com");
Uri myUri = new Uri(baseUri, "catalog/shownew.htm");

Console.WriteLine(myUri.ToString()); 
```

样本来自[http://msdn.microsoft.com/en-us/library/9hst1w91.aspx](http://msdn.microsoft.com/en-us/library/9hst1w91.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T22:19:37.020

如果你的意思是服务器端，你可以使用`ResolveUrl()`：

```
string url = ResolveUrl("~/questions"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T22:20:52.087

在这种情况下，我不明白您所说的“解决”是什么意思，但您可以尝试插入一个基本的 html 元素。既然您询问浏览器将如何处理它。

“`<base>`标签为页面上的所有链接指定默认地址或默认目标。”

[http://www.w3schools.com/TAGS/tag_base.asp](http://www.w3schools.com/TAGS/tag_base.asp)

# visual-studio - MSI 分发的问题

> ID：827161
> 
> 赞同：0
> 
> 时间：2009-05-05T22:17:39.990
> 
> 标签：visual-studio, windows-installer

所以我正在继续测试并发布对我的应用程序的更改，我遇到了一个我不确定如何处理的痛点。

首先，我的应用程序使用 SQL Server CE 数据库来存储信息，并且我需要能够对此数据库进行更改，因此我创建了一个内部更新进程，该进程在应用程序运行时运行以确保数据库是最新的.

此内部更新过程的关键是另一个名为 DBUpdates.sdf 的 SDF 文件，其中包含需要应用的所有数据库模式更改。

我遇到的问题是我创建的 MSI 发行版不会覆盖这个文件。似乎当 SQL Server CE 打开此文件时，它会更改文件的修改日期/时间。这是 MSI 进程的标志，表明文件已更改，并且不应覆盖文件。现在我看到我的数据库更改没有被应用，因为 MSI 进程认为用户已经更改了这个文件。

在这一点上，我有点难过。我正计划使用 MSI 发行版，但也许我不能。你怎么看？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-05T22:39:10.687

将您的 .sdf 作为嵌入式资源存储在可执行文件中，然后将其提取到磁盘上的临时位置（根据需要）并执行更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T23:47:45.093

如果您需要强制安装文件，则使用 MSI 的未版本化文件可能有点难以处理。您可以看到这个先前的问题，对于一些想法，[如何将版本号添加到 .msi 中的 Access 文件](https://stackoverflow.com/questions/102374/how-to-add-a-version-number-to-an-access-file-in-a-msi)。

该问题包含指向此博客文章的链接[http://blogs.msdn.com/astebner/archive/2005/08/30/458295.aspx](http://blogs.msdn.com/astebner/archive/2005/08/30/458295.aspx)，这表明了我更喜欢处理此问题的方式。将 .sdf 文件添加为可执行文件组件的一部分。这样做的缺点是，如果有人删除了 .sdf 文件，而不是您的可执行文件，我认为修复应用程序不会解决这个问题。如果您使用 Visual Studio 创建 MSI 文件，那么这可能是一个难以实施的解决方案。在这种情况下，我强烈建议您查看 WIX。这是一个更好的 MSI 构建系统。

# sql - 从“无限”动态控件将值输入数据库

> ID：827175
> 
> 赞同：0
> 
> 时间：2009-05-05T22:22:37.293
> 
> 标签：sql, asp.net, database, controls

有一个显示 1-10 的下拉菜单，用户可以从中选择他想要的文本框数量 - 如果他选择无限制，它会向他显示一个文本框，他在其中输入他想要的确切文本框数量。如果他输入 40，它会显示 40 个在运行时创建的文本框。

我的问题是，如何将 40 或“他输入的任何数字”文本框中的数据输入 MS SQL 数据库。我无法动态创建列名，这太乏味和混乱了。有什么办法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T23:10:23.247

当您创建文本框时，您可以给它们顺序 ID，然后在回发时遍历它们，将值写入数据库。

例如：

```
/// <Summary>
///  This would be fired when the user enters the number of textboxes
///  the want and click the 'Create Textboxes' button.
/// </Summary>
protected void CreateTextBoxes_Click(object sender, EventArgs e)
{
    // Check how many textboxes the user wants
    int count = Convert.ToInt32(CountTextBox.Text);

    // Generate the number of textboxes requested
    // and add them to the page
    for (int i=0; i < count; i++)
    {
        // Create the textbox
        TextBox textbox = new Textbox();

        // Set the ID so we can access it later
        textbox.ID = "TextBox_" + i;

        // Add the textbox to the panel
        TextBoxPanel.Controls.Add(textbox);
    }
}

/// <Summary>
///  This would be fired when the user has entered values in the textboxes
///  and clicked the Save button to save the values to the database.
/// </Summary>
protected void SaveButton_Click(object sender, EventArgs e)
{
    // Check how many textboxes the user created
    int count = Convert.ToInt32(CountTextBox.Text);

    // Loop through them
    for (int i=0; i < count; i++)
    {
         // Get the TextBox
         TextBox textbox = (TextBox) FindControl("TextBox_" + i);

         // Get the value
         string val = textbox.Text;

         // Insert into DB
         SaveValueToDatabase(val);
    }
] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T23:38:49.997

您所拥有的是该页面上的任何内容与评论或描述或其他内容之间的一对多关系。您不应该在数据库中将此建模为 text_box_1、text_box_2 等。相反，它应该是：

```
CREATE TABLE Some_Entity
(
    some_entity_id  INT NOT NULL,
    CONSTRAINT PK_Some_Entity PRIMARY KEY CLUSTERED (some_entity_id)
)
GO

CREATE TABLE Some_Entity_Comments
(
    some_entity_id  INT     NOT NULL,
    comment_number  INT     NOT NULL,
    comments        VARCHAR(1000)   NOT NULL,
    CONSTRAINT PK_Some_Entity_Comments
         PRIMARY KEY CLUSTERED (some_entity_id, comment_number),
    CONSTRAINT FK_Some_Entity_Comments_Some_Entity
         FOREIGN KEY (some_entity_id) REFERENCES Some_Entity (some_entity_id)
)
GO 
```

完成后，您可以使用类似于 Mun 编写的代码来处理前端的事情。您只需将文本框索引作为comment_number 传递。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T03:14:26.483

您是否考虑将数据作为 XML 字段存储在数据库中？

如果你有 40 多个文本框，你可以有一个简单的模式来存储它们，例如：

```
<YourData>
    <TextBox ID="TextBox1">Value1</TextBox>
    <TextBox ID="TextBox2">Value2</TextBox>
    <TextBox ID="TextBox3">Value3</TextBox>
    ... etc ...
</YourData> 
```

数据库中不需要动态字段。您还应该将架构存储在某处。这是存储动态数据的好方法，这些数据可以随记录而变化。

# ruby-on-rails - 在 Rails 中，如何从视图中输出动作的名称？

> ID：827177
> 
> 赞同：3
> 
> 时间：2009-05-05T22:22:57.433
> 
> 标签：ruby-on-rails, controller, model-view-controller

如果我从创建操作中渲染更新操作，“更新”视图（即 update.html.erb）是否有办法知道哪个操作渲染了它。我希望更新视图在创建操作渲染它时打印出操作名称“create”，并在更新操作渲染它时打印出单词“update”。问题是渲染似乎将控制权推迟到调用的操作，因此出于所有意图和目的，更新视图始终认为它来自更新操作。

```
class CtrlController < ApplicationController

  def create
    render(:action=>"update")
  end

  def read
  end

  def update
  end

  def delete
  end 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-05T22:24:15.823

参数[：动作]

您可能需要将渲染线更新为

```
render :template => "ctrl/update" 
```

# subsonic - 使用存储过程的亚音速寻呼

> ID：827186
> 
> 赞同：1
> 
> 时间：2009-05-05T22:24:26.493
> 
> 标签：subsonic

我看过使用亚音速的寻呼视频 [http://subsonicproject.com/querying/webcast-using-paging/](http://subsonicproject.com/querying/webcast-using-paging/)

我正在调用存储过程来检索数据。我可以使用分页吗？请给我几个样品。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:41:00.787

您需要将分页添加到您的存储过程。完成此操作的方法因您使用的数据库而异。我将捕获分页查询生成的 SQL，将该 SQL 复制到新的存储过程中，添加页码和页面大小的参数，然后访问新创建的存储过程的存储过程代理方法。

# smalltalk - 什么文件类型以 BOSS 7 开头？

> ID：827191
> 
> 赞同：4
> 
> 时间：2009-05-05T22:26:47.330
> 
> 标签：smalltalk, file-type

我正在查看 90 年代初期生成的一些文件。其中一个似乎包含对以某种二进制格式打包在许多大文件中的数据的引用。

文件的前六个字节是 0x42 0x4f 0x53 0x53 0x20 0x37 拼写 BOSS 7。

我对各种文件类型信息来源的搜索，包括 /usr/share/file/magic 没有发现任何东西。有谁知道可能使用什么软件来生成以这些字节开头的文件？有关文件布局的任何信息都会很棒。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T23:02:33.860

看起来该文件可能是由 VisualWorks Smalltalk 生成的：

> [BOSS 7.5]
> 
> 包含二进制对象流服务，它支持对象（包括代码）与文件的高效存储和检索。
> 
> 请注意，对于代码存储，包裹系统现在取代了 BOSS。

我尝试使用[http://www.cincomsmalltalk.com/](http://www.cincomsmalltalk.com/)提供的 IDE 加载文件，它生成了一个有意义的异常：

```
标识符 MediaCollectionDictionary 没有绑定
```

该文件确实包含：

```
    媒体收藏词典
    媒体收藏*
    呼叫MediaVehDict2

```

等等，这意味着，如果我现在可以弄清楚其余文件的作用并学习足够的 SmallTalk，我就可以解开这个烂摊子。

**当然，我不确定这个分析是否正确。**所以，如果您有任何其他想法，请告诉我。谢谢你。

*很久以后：*所以，我最初的评估似乎是正确的。我得到了一些关于 comp.lang.smalltalk 的有用提示：[http ://groups.google.com/group/comp.lang.smalltalk/browse_thread/thread/5d55d857e2f80158#](http://groups.google.com/group/comp.lang.smalltalk/browse_thread/thread/5d55d857e2f80158#)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T16:03:33.017

[在comp.lang.smalltalk](http://groups.google.com/group/comp.lang.smalltalk/topics?lnk=srg&hl=en&ie=UTF-8&pli=1)上提问

[在vwnc 邮件列表](http://www.cincomsmalltalk.com/CincomSmalltalkWiki/VisualWorks+Online+Communities)上询问

# asp.net - 如何在 .Net 中测试字符串（网页）的标记有效性？

> ID：827195
> 
> 赞同：1
> 
> 时间：2009-05-05T22:28:22.257
> 
> 标签：asp.net, validation, testing, markup, doctype

我写了一个 VB.Net 页面来浏览我的网站。它将 HttpWebResponse 存储在一个字符串中。如何在 .Net 中验证页面的标记有效性？- 类似于 W3 的 validate by direct input 选项。我正在寻找可以识别 DOCTYPE、验证它是或否并返回我可以显示的故障列表的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:32:17.240

以下是有关如何做到这一点的一些信息：**[Validate XHTML in C#](http://dotnetperls.com/Content/XHTML-Validator.aspx)**（如果需要，您应该将其翻译成 VB.NET）。

还有一个**[验证器模块](http://www.thejoyofcode.com/XHTML_Validator_For_All.aspx)**可供下载。唯一的缺点是必须将字符串保存到物理 html 文件中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T23:27:10.523

W3C 有一个[实验性 API](http://validator.w3.org/docs/api.html)，可以接受可能有用的代码片段，还有其他[3rd 方 Web 服务](http://search.cpan.org/dist/WebService-Validator-HTML-W3C/)（尽管我不确定它们是否可以接受片段）。

恐怕我自己曾经使用过这些，所以我无法评论它们的有效性......

# c++ - C++ 中的虚拟默认析构函数

> ID：827196
> 
> 赞同：22
> 
> 时间：2009-05-05T22:28:24.470
> 
> 标签：c++, virtual-destructor

我有大量继承自基类（标准）的继承类（标准）。这`criterion`是代码

```
class criterion
{
public:
    virtual unsigned __int32 getPriorityClass() const = 0;
    virtual BOOL include(fileData &file) const = 0;
    virtual void reorderTree() = 0;
    virtual unsigned int directoryCheck(const std::wstring& directory) const = 0;
    virtual std::wstring debugTree() const = 0;
}; 
```

从这个派生类的一些例子：

```
class fastFilter : public criterion
{
public:
    void reorderTree() {};
    unsigned int  directoryCheck(const std::wstring& /*directory*/) const { return DIRECTORY_DONTCARE; };
    unsigned __int32 getPriorityClass() const { return PRIORITY_FAST_FILTER; };
};

class isArchive : public fastFilter
{
public:
    BOOL include(fileData &file) const
    {
        return file.getArchive();
    }
    std::wstring debugTree() const
    {
        return std::wstring(L"+ ISARCHIVE\n");
    };
}; 
```

由于我这里根本没有析构函数，但这应该是一个基类，我是否需要插入一个空的虚拟析构函数，即像这样？：

```
virtual void ~criterion() = 0; 
```

如果需要该虚拟析构函数声明，是否所有中间类也需要一个？即上面的fastFilter是否也需要一个虚拟析构函数？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-05-05T22:31:50.593

是的 - 基类需要一个虚拟析构函数，即使它是空的。如果不这样做，那么当某些东西`delete`通过基指针/引用作为派生对象时，派生对象的成员对象将没有机会正确地销毁自己。

派生类不需要声明或定义自己的析构函数，除非它们需要默认析构函数行为以外的东西。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-05-05T22:32:19.017

建议插入：

```
virtual ~criterion() {} 
```

从 C++11 开始，您可以使用`= default;`而不是空 body `{}`。

这是为了避免从基类的指针中删除问题。否则你会泄漏内存，因为派生类的析构函数不会被调用。

```
criterion *c = new fastFilter();
delete c; // leaks 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-05-05T22:34:01.570

您不需要使析构函数抽象，只需给它一个空实现：

```
virtual ~criterion() { } 
```

这样，您不必在每个子类中都强制实现它，但它们中的每个子类仍然会有一个（继承的）虚拟析构函数。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-06T04:34:34.123

与其他人已经回答的一个小变化：

代替

```
virtual void ~criterion() = 0; 
```

所需的版本是：

```
 virtual ~criterion() {}  //Note: Removed void as destructors not allowed 
                             //  a return type 
```

要了解有关虚拟析构函数的更多信息，请查看常见问题解答中的此链接[我的析构函数何时应该是虚拟的？](http://www.parashift.com/c++-faq-lite/virtual-functions.html#faq-20.7)

# cookies - 在 Pylons 中处理 cookie 的好方法是什么？

> ID：827197
> 
> 赞同：4
> 
> 时间：2009-05-05T22:29:40.443
> 
> 标签：cookies, pylons, wsgi

我已经看到一些参考资料说有 WSGI 中间件可以做到这一点，但我对处理 cookie 的 WSGI 中间件的选择知之甚少。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-05T22:46:48.843

pylons (0.9.7) 不需要任何特别的东西，一切都是开箱即用的：

```
from pylons import request, response

#set a cookie
response.set_cookie( cookiename , some_string, max_age=180*24*3600 )

#read a cookie
request.cookies.get( cookiename )

#remove a cookie
request.cookies.pop( cookiename, None ) 
```

Pylons 使用[Webob](http://pythonpaste.org/webob/) (request, response) 是 (webob.Request, webob.Response) 对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-28T13:20:32.760

上面的 .pop 应该是

```
response.delete_cookie('cookie_name') 
```

# .net - 使用 LINQtoSQL 获取随机行

> ID：827199
> 
> 赞同：3
> 
> 时间：2009-05-05T22:30:32.390
> 
> 标签：.net, linq, linq-to-sql

有没有办法使用 LINQToSQL 从表中返回随机行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-05T22:36:36.370

是的，在表的计数范围内生成一个随机数，然后 Skip() 该数字，Take(1) 然后返回结果序列的第一个元素。就像是

```
var R = new Random();
var ToSkip = R.Next(0, ctx.Customers.Count);

return ctx.Customers.Skip(ToSkip).Take(1).First(); 
```

但这有点难看。是否存在需要在 SQL 表中获取随机行的实际要求？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T22:35:05.063

您可以使用随机数并`Skip()`到达该行：

```
int randomNum = 10; // <-- determined by your favorite RNG
var row = mydb.Objects.Skip(randomNum).Take(1); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T22:35:14.283

从未尝试过，但我怀疑以下将完成工作

```
Random rnd = new Random();

int count = db.MyTable.Count();
int skip = rnd.Next(count);

var row = (from r in db.MyTable
           select r).Skip(skip).Take(1); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T22:35:45.017

我会尝试类似的东西：

```
query.Skip(rand.Next()).Take(1).FirstOrDefault(); 
```

`rand`初始化为返回特定范围之间的数字。

一定要检查 null 作为返回值，以防生成的随机数大于行数（当然你也可以将它的上限初始化为行数）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T22:37:45.820

技术上：

```
var randomRow = (from rows in db.Table
  select shipper).First(); 
```

因为您永远无法确定行顺序，除非您指定 order by 子句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-10T11:32:12.270

您可以让 LinqToSQL 生成使用 SQL Server NEWID() 函数的 SQL。这是我的实现：

```
namespace Data    // change to whatever the namespace of your DataContext is, or remove
{
    /// <summary>
    /// Add RANDOM() extension to the Data context...
    /// </summary>
    partial class DefaultDataContext  // change to the name of your DataContext
    {
        [System.Data.Linq.Mapping.Function(Name = "NEWID", IsComposable = true)]
        public Guid Random()
        {
            // this code is not actually executed, it simply provides a way to access 
            // T-SQL "NEWID()" function from Linq to SQL
            throw new NotImplementedException();
        }
    }
} 
```

用法示例，从数据库中提取随机产品：

```
var product = (from p in db.Products     // our DataContext instance is called db here
               orderby db.Random()
               select p).FirstOrDefault() 
```

# c# - ASP.NET - 如何在之后/之前剥离查询字符串？从 ASPX 参数传递？

> ID：827216
> 
> 赞同：0
> 
> 时间：2009-05-05T22:35:50.040
> 
> 标签：c#, asp.net

我想解析 aspx 页面中的值，在 ? 然后呢？那么，允许我解析它的 C# 函数是什么？

我想做类似的事情：

```
var pageType = parameter.trimBefore?();

var pageString = parameter.trimAfter?(); 
```

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-05T22:38:57.877

`Request.QueryString`并且`Request.Uri`应该在没有字符串操作的情况下为您提供这些值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T22:37:40.783

在字符串中尝试拆分方法。在这种情况下，您提供分隔符 ?，该方法会将字符串划分为字符之前和字符之后的字符串。

```
String[] urlComponents = myUrl.Split('?') 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T22:39:34.053

使用 HttpContext.Current.Request 对象？您可以从中获取路径信息和 QueryString 信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T22:51:18.597

[Request.Url](http://msdn.microsoft.com/en-us/library/system.web.httprequest.url.aspx)会给你一个[Uri](http://msdn.microsoft.com/en-us/library/system.uri.aspx)对象 - 遗憾的是这不会给你你想要的查询字符串的权力。

像[Request.Url.Segments](http://msdn.microsoft.com/en-us/library/system.uri.segments.aspx)这样的东西会给你一个集合之前的所有部分？

然后使用[Request.QueryString](http://msdn.microsoft.com/en-us/library/system.web.httprequest.querystring.aspx)将为您提供查询字符串值的[名称-值集合](http://msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection.aspx)- 请记住，某些查询字符串元素可以包含多个逗号分隔值，这就是文档中的示例具有内部循环的原因。

# java - 有使用 H2 数据库的实际经验吗？

> ID：827220
> 
> 赞同：20
> 
> 时间：2009-05-05T22:37:02.297
> 
> 标签：java, database, h2

[有没有人对H2 数据库](http://www.h2database.com/html/main.html)有任何实际经验？我感兴趣的是：

*   表现
*   稳定
*   错误

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-09-24T15:31:06.283

我们使用 H2 作为一个非常大的基于 RCP/Eclipse 的设计工具的存储引擎。该工具本身已经在一些数据量大的项目中使用了 2 年多，所以我们已经非常彻底地强调了 H2。

我们对其他 Java 可嵌入数据库引擎进行了相当深入的分析，并选择了 H2。总的来说，我认为我们对此非常满意。我们几乎没有遇到过稳定性问题，但是，正如 zvikico 所说，开发团队反应迅速。

虽然性能不错，但有时您需要手动进行一些优化。如果您习惯使用为您进行大量此类优化的企业级数据库，则可能会有所改变。如果您遇到缓慢的查询以查看它在做什么，我建议您使用 EXPLAIN 命令。很多时候，您可以切换 JOIN 语句以强制它更有效地使用索引。

所以，简而言之，向我竖起大拇指！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-06T05:20:37.350

我将它用作[nWire](http://www.nwiresoftware.com/)的基础，这是一个用于 Java 代码探索的 Eclipse 插件。它作为 Java 进程的一部分以嵌入式模式工作，而不是作为服务器。

总的来说，它非常稳定。我现在使用 H2 已经很长时间了：我在早期遇到了一些错误，但现在已经有一段时间没有发生了。开发商的反应也很好。

关于性能：非常好。您可以在网站上查看测试。我没有机会将它与其他工具进行比较，但我对它非常满意。在最近的版本中，打开大型数据库确实需要更多时间，但这个问题似乎也得到了解决。

其他一些优点：

*   非常简单的分发：只有一个 JAR。
*   嵌入式 Web 控制台对于快速访问数据库非常有用。它被证明是一个有价值的开发工具。
*   响应迅速的社区支持，尤其是来自开发团队的支持。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-06-28T17:53:59.740

我在一些非常繁重的服务器应用程序中使用 H2，有几百万条记录。H2 的表现非常出色。不过，与往常一样，您需要考虑对索引的使用。我以前是 MySQL 的长期用户，用过几个企业级数据库，但 H2 只是比传统的重量级数据库更小、更快、更容易使用。它也成为我们在[Tynamo.org的首选数据库](http://tynamo.org)

# flash - Flash 电影在 IE 中不显示

> ID：827224
> 
> 赞同：1
> 
> 时间：2009-05-05T22:37:48.037
> 
> 标签：flash, internet-explorer

我有一个在 FF、Opera、Safari 中运行良好但在 IE 中运行良好的 Flash 电影。当我右键单击现在坐在那里的空白框时，我什至没有得到通常显示的 Flash 菜单。

有人可以看看[链接文本吗](http://rants-group.com/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T22:57:59.190

尝试以下操作：

1.

在

```
<PARAM NAME="wmode" VALUE="transparent> 
```

在透明末尾添加缺少的引号：

```
<PARAM NAME="wmode" VALUE="transparent"> 
```

* * *

2.

在

```
<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" 
codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"
WIDTH="350" HEIGHT="309" id="flashslide" ALIGN=""> 
```

将宽度和高度设置为 2000：

```
<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" 
codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0"
WIDTH="2000" HEIGHT="2000" id="flashslide" ALIGN=""> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T23:14:24.610

进一步说明：

在您的代码中，您使用两种不同的方法来嵌入 Flash 电影：

1.  通过`<object ...>...</object>`
2.  通过`<embed ...>...</embed>`

这样做的危险是，当您更改重要设置时，您只更改了一种变体，而忘记了另一种。

在存在两种可用变体的情况下，浏览器必须选择它想要使用的数据：来自“对象”的数据或来自“嵌入”的数据。

Firefox、Safari、Opera 等似乎更喜欢嵌入变体，而 IE 更喜欢对象变体。

我建议删除“嵌入”变体，只使用“对象”变体。这是根据 HTML 4 标准的正确变体。出于兼容性原因，仅浏览器支持嵌入变体。

# .net - 如何为 WinForms 应用程序在单个文件中存储大量图像？

> ID：827225
> 
> 赞同：1
> 
> 时间：2009-05-05T22:37:49.550
> 
> 标签：.net, winforms, image, filesystems

我有一个 .net WinForms 2.0 应用程序，目前有一个包含大约 3000 张图像的图像库。目前我正在使用 SQLite 并将所有图像存储为具有唯一 Id 的 BLOB，这使得事情变得容易检索。

这样做的好处是最终用户不必担心安装程序会在他们的计算机上解压缩大量图像，并且在进行更新时，我可以推出一个文件供用户下载，这是一个全新的副本一切。文件往往相当大（目前约为 60 兆），但最终用户已经习惯了，并且该应用程序还为拨号用户提供了“无图像”模式。

所有这一切的一个缺点是生成库有时会有点棘手。数据必须转换为二进制格式，我必须确保相应的 Id 正确链接。生成库的作业也需要一段时间才能运行。

我正在升级应用程序，我想知道是否有更好的方法来做到这一点。我仍然希望保留单一文件方法，以便于向用户发送更新并保持计算机上的占用空间更小。是否有某种我可以使用/创建的“便携式文件系统”或资源库，可以让我轻松地从中插入/检索图像，而不必有一个数据库供应用程序与之交互？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:42:26.403

resx 文件（编译为资源 dll）？或者更简单 - 一个 zip 文件？也许使用#ZipLib。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T22:54:06.110

7zip 还有一个你也可以使用的库，看[这个](https://stackoverflow.com/questions/505190/net-deflatestream-4gb-limit/505263#505263)

您还可以将要提供的图像移出 Web 服务器并让客户端在本地缓存图像，然后让客户端定期检查更新的图像，这样就只需要下载所需的图像。

您还可以为拨号用户提供低分辨率版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:04:10.953

我在类似情况下使用了 ImageList 控件和 AddStrip 方法。然后我有一个包含所有图像的巨大 PNG 文件。这对图标非常有用，但不适用于其他类型的资源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T23:14:05.530

根据您的情况，可以使用自定义 ISAM 类型文件。

整体文件布局将是：

```
----------------
| 计数 | 整数 |
----------------
| 索引 |
----------
| 图片 |
----------

```

索引格式

```
----------------
| 偏移 | 整数 |
----------------
| 尺寸 | 整数 |
--------------------------
| 描述 | 字符(50) |
--------------------------
| 编号 | 整数 |
----------------

```

计数将是一个包含文件中图像数量的整数。索引将包含 (offset, size) 对，描述文件中要查找的偏移量以及从该偏移量开始读取的字节数。

这种格式的一个缺点是替换现有图片需要重建文件。

可以将固定长度的元数据（如描述和 ID）放在标题中。

（如果您将索引保存在 RAM 中，这种疯狂方法的一个好处可能是访问速度。）

# java - 最佳语言工具

> ID：827227
> 
> 赞同：1
> 
> 时间：2009-05-05T22:37:58.207
> 
> 标签：java

我最近在听一个播客（可能是这样 - 不记得了），当时受访者说 Java 如此成功和流行的原因之一是工具。

使用优秀的 FOSS 编辑器，例如 Eclipse、NetBeans。Cobertura、Find Bugs 等指标工具、Maven 和 ANT 等构建工具……我必须同意

我已经完成了相当多的 .NET 并且这些工具还可以。问题似乎是在工具方面没有 Java 那样的深度。FOSS 的东西似乎非常有限。

我的问题：是否有任何现代语言具有更好的社区和工具来完成工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T22:53:52.413

不要忘记 Perl 的[CPAN](http://www.cpan.org)，它包含大量一流的代码，例如[分析器](http://search.cpan.org/~timb/Devel-NYTProf-2.09/lib/Devel/NYTProf.pm)、[ide](http://search.cpan.org/~szabgab/Padre-0.34/lib/Padre.pm)和[现代面向对象系统](http://search.cpan.org/~drolsky/Moose-0.77/lib/Moose.pm)。

C。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T22:47:29.557

当然，有emacs和vi！

说真的，尽管一些 Java 工具很棒，但它们的许多功能对于其他语言/环境来说毫无意义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T22:46:32.867

如果您正在寻找具有良好工具和库支持的 Java 和 C# 以外的语言，我认为下一个最受支持的语言是 Ruby。但是，我相信对 Ruby 的工具、库和社区支持远远少于 Java 或 C#。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T22:50:32.220

也许是 PHP 甚至是 python

# c++ - 什么是 STL？

> ID：827236
> 
> 赞同：27
> 
> 时间：2009-05-05T22:41:13.020
> 
> 标签：c++, stl

我不是 C++ 程序员，很难理解网站上给出的解释。我不了解容器或迭代器，也没有计划在不久的将来学习 C++。所以通俗地说：什么是 STL，它能为我做什么？它与 Python 标准库或 glibc 之类的东西相比如何？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-05-05T23:43:51.683

要了解 STL，您至少必须了解 C++ 的某些方面。我会尽力解释。结构看似简单。该库的亮点在于如何使用它来简化许多复杂的任务。不过，我将坚持一些非常简单的例子，因为其他任何事情都可能会使不懂 C++ 的人感到困惑，而且因为我不想写小说。;)

首先，一些历史。STL（标准模板库）是单独开发的，然后提交给 C++ 标准委员会审议，让他们可以选择将其采用到语言中。但它不是作为 C++ 标准的一部分开发的，因此，它的设计风格与 C++ 标准库的其余部分非常不同。如果我记得我的古老历史，标准委员会也花了很长时间才了解 STL 并习惯了它。刚开始看到它的时候，他们并不太热衷，但过了一段时间，他们才意识到它的强大和精心设计。因此，它被采用到语言中。这一切都发生在 1990 年代后期，当时该语言正在接近 ISO 标准化。

在其核心，STL 提供了您期望的标准库的最基本功能：存储数据序列的能力，以及处理这些序列的能力。

所有其他语言的标准库中都有一个集合/容器部分，其中包含动态数组（在 Java 中称为数组列表，在 C# 中称为列表，在 C++ 中称为向量）、链表、字典和其他常见数据结构的实现。

它们通常还提供一些机制来遍历这些结构。（例如，枚举器或迭代器）

STL 在 C++ 中提供了相同的功能，但以一种异常优雅的方式实现，并带有一些有趣的抽象。

STL 被干净地分成三个独立的组件：

*   容器（如上所述，每种语言都有这些。Arrays、ArrayList、Dictionary、Set、LinkedList 等。任何可以存储对象集合的数据结构都是 C++ 中的容器）
*   算法（每种语言都以*某种*形式具有这些算法。算法是用于处理元素序列的函数。）现在，假设序列是一个容器。这有点简化，但我们会做到这一点。算法有广泛的用途，从`for_each()`允许您将函数应用于序列中的每个元素的函数，或将`transform()`函数应用于每个元素并将结果存储到单独序列中的相关函数（非常类似于地图函数式语言中的操作）或累积（类似于函数式语言中的折叠），还包括排序或搜索函数，以及允许您复制整个序列的函数。
*   最后，将容器和算法结合在一起的粘合剂：迭代器。正如我上面所说的，序列（这是算法工作的）与容器并不完全相同。容器中的元素固然构成一个序列，但容器中的前五个元素也是一个序列。或者容器中的每个其他元素都是一个序列。直接从文件流中读取的数据也可以被视为一个序列。即使是动态生成的数据（例如，斐波那契数列）也可以被视为一系列值。序列不必映射到容器，甚至不必映射到内存中存在的数据，尽管这是最常见的用途。

请注意，这三个领域之间没有重叠。容器存储（并拥有）数据，并产生迭代器。迭代器允许您检查、修改和遍历数据。算法在迭代器范围内运行

从概念上讲，迭代器有两个功能。它指向一些数据，它可以按顺序移动（根据迭代器的类型，可能会有不同的移动操作。几乎所有的迭代器都可以移动到下一个元素。有些也可以移动到前一个，有些可以前后跳跃任意距离）。如果您熟悉 C，这听起来很像指针，这绝非巧合。迭代器被建模为指针的泛化，实际上，指针也是有效的迭代器。所有 STL 算法都适用于指针以及“真正的”迭代器。

这意味着任何数据序列都可以由一对迭代器表示：第一个迭代器指向序列中的第一个元素，第二个迭代器指向序列*末尾*的一个元素。

这允许在循环中遍历序列的相当简单的语法：

```
std::vector<int> container;
for (iter it = container.begin(); it != container.end(); ++it)
{
  // perform some operations on the iterator (it) or the element it points to (*it)
  ++(*it); // increment the value the iterator points to
} 
```

或者我们可以将算法应用于序列：

```
std::sort(container.begin(), container.end()); 
```

请注意，排序函数不知道也不关心它正在处理向量。它传递了两个迭代器，它们可以是任何类型。它们可以是指向数组、链表迭代器或任何其他有效迭代器类型的普通指针。

我们可以通过提供我们自己的比较函数（任何接受两个值并在第一个严格小于另一个时返回 true 的函数）来概括排序函数

```
// sort in descending order, by passing in a custom comparer which uses greater than instead of less than
bool greater(int lhs, int rhs) { return lhs > rhs; }
std::sort(container.begin(), container.end(), greater); 
```

当然，我们也可以只对向量的前五个元素进行排序：

```
std::sort(container.begin(), container.begin()+5); 
```

begin() 和 end() 函数只是从容器中获取迭代器的便捷函数。我们不必直接使用它们。

另一个不错的技巧是流也可以泛化为迭代器。因此，让我们从文件中读取所有整数，然后将它们复制到数组中（当然，数组是纯 C 类型，因此它们不是适当的容器并且没有迭代器。但是指针可以正常工作）

```
int arr[1024];
std::ifstream file("something.txt");
// (note, this assumes <= 1024 integers are read)
std::copy(std::istream_iterator<int>(file) // create an iterator pointing to the current position in the file stream
        , std::istream_iterator<int>() // and our "end" iterator. When we reach the end of the stream, testing the two iterators for equality will yield true, and so the operation will halt
        , arr); 
```

STL 的独特之处在于它的灵活性和可扩展性。它与 C 代码干净利落地互操作（指针是合法的迭代器），它可以简单轻松地扩展（如果你愿意，你可以编写自己的迭代器类型。大多数算法采用比较器的自定义谓词，就像我在上面展示的那样，并且你可以定义自己的容器。也就是说，STL的三个支柱中的每一个都可以被覆盖或扩展，所以可以说STL更多的是一种设计策略。即使你正在使用你也可以编写STL代码您自己的容器、迭代器和算法。由于这三个支柱中的每一个都与其他支柱完全分离，因此与大多数其他语言中这三个职责混合并由同一类共享的大多数其他语言相比，它们可以更容易地交换出去。算法不*知道*它所操作的序列存储在哪个容器中（如果有的话）。它只知道可以取消引用它传递的迭代器以访问数据本身。容器不必支持所有标准算法。它只需要能够生成一对迭代器，然后所有功能都是免费的。

比较一下，比如说，Java，每个集合类都必须实现自己的搜索、自己的排序、自己的一切。在 C++ 中，我们只需要 find() 的一种实现。它需要两个迭代器和要查找的值，并遍历序列查找值。因此，它适用于任何容器类型，甚至是我自己定义的容器类型。

STL 的另一个显着特点是使用它时性能损失几乎为零。C++ 模板都在编译时被替换，生成的代码可以像您在 C 中手工编写所有内容一样积极优化。上面的排序函数会失去一些性能，因为我将函数指针作为我的自定义比较器传递给它，通常不能内联，但如果我们这样定义它可以修复：

```
struct greater {
    bool operator()(int lhs, int rhs) { return lhs > rhs; }
};
std::sort(container.begin(), container.end(), greater()); 
```

现在我们不再传递函数指针，而是传递一个对象。*并且可以*内联成员函数（例如 operator()） 。所以这个排序函数将和你用 C 手工编码的任何东西一样有效。

再一次，它甚至不必为排序函数增加任何复杂性。事实上， sort 恰好有两个重载。一种采用比较器功能，另一种则不采用。

排序函数不需要知道它是传递函数指针还是对象。只要语法“X(a, b)”有效，其中 X 是它作为比较器传递的值，a，b 是要比较的元素，排序函数的相同实现就可以工作。而且因为我的`greater`对象重载了 operator()，所以该语法对这个对象和我们之前传递的函数指针都是有效的。通过利用这样的技巧，STL 代码免费获得了很多功能。由于 C++ 模板的工作方式，函数的相同实现适用于非常不同的参数类型。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-05T22:46:23.023

STL 是标准模板库。它是 C++ 标准库的子集。

STL 提供了有用的算法和容器的通用实现。

容器提供了在程序中存储数据的任何简单方法，然后在该数据上查找、排序和执行其他计算。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-04-24T12:09:21.913

[标准模板库](http://en.wikipedia.org/wiki/Standard_Template_Library)是在 C++ 标准化之前用 C++ 编写的库。它包括很酷的东西，比如排序算法和容器（以及使用这些特性的迭代器）。

[C++ 标准库](http://en.wikipedia.org/wiki/C++_Standard_Library)的一部分，在 1998 年标准化时，是基于 STL 的一部分；它已经进化了（通过 2003 标准，尤其是现在使用 C++0x）。

*   C++ 标准库由各种编译器供应商（和他们的朋友）实现，并附带您最喜欢的工具链。
*   您*实际上*可能会使用它：STL 现在几乎已经过时了。

[请注意，许多程序员（包括一些多产的书籍作者）[仍然](https://stackoverflow.com/questions/5205491/whats-this-stl-vs-c-standard-library-fight-all-about)出于习惯使用术语“STL”来指代 C++ 标准库（或最初基于 STL 的部分），即使这是不正确的。只要您*知道*技术上的区别，就可以了。]

希望这可以帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-05T22:45:54.647

如果您不是 C++ 程序员，标准模板库的实现对您来说毫无价值。然而，这些想法超越了任何编程语言。

它是一个数据结构库（例如，地图、列表、向量等）。它包括用于抽象遍历这些数据结构的迭代器，以及对它们进行操作的算法。其他语言也使用这些想法，所以如果你用一种语言学习它们，他们就会熟悉其他语言。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-05T22:47:38.310

STL 是标准模板库。它是您可以使用的函数和类库。它具有基础计算机科学的许多基本算法和数据结构。如果您打算继续使用 C++，则应该计划学习此资源库或其他资源库。

该代码被世界各地的许多人使用，因此您可以放心，该代码经过了良好的测试和众所周知。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-05T22:46:06.130

它是一个使某些事情变得更容易的库，例如字符串操作、向量、链表等。STL 将使您不必编写一些较低级别的代码，让您更专注于应用程序代码。

# c# - 泛型类和泛型方法

> ID：827240
> 
> 赞同：1
> 
> 时间：2009-05-05T22:42:14.733
> 
> 标签：c#, generics

```
class test <T> where T : class
{
    public void Write<T>()
    {
        Console.Write(typeof(T).FullName);
    }
} 
```

在上面的类中，可以为类（`test<string> Test = new test<string>`）传递一个字符串，然后为方法传递一个int？如果是这样，输出是什么？如果不是，这会导致什么问题？尽管经常使用泛型（在我自己的类中）和泛型集合，但我实际上并没有尝试过。

我编写/查看泛型类的方式如下：

```
class <T> where T : class
{
    public T Write()
    {
        Console.Write(T.ToString());
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T22:46:32.557

正如它最初写的那样，你不能。为了在类的不同点使用不同的类型，你必须有多个泛型参数。可以在方法级别定义不同的方法并让您的样品正常工作

```
class Test<T> where T : class {
  public void Write<U>(U arg1) {
    Console.WriteLine(arg1.ToString());
  }
} 
```

用法

```
var t = new Test<string>();
t.Write(42); 
```

正如斯科特指出的那样，您可以使用相同的命名参数。虽然这样做会引起警告，一般来说会让人感到困惑。为当前范围内的所有泛型参数使用不同的名称会更加简洁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T22:45:16.927

您将希望在方法中单独声明一个类型变量到类 -

```
class Test<T> where T : class {

    public void Method<U>(U val) {
        Console.WriteLine(typeof(U).FullName);
    }

} 
```

# iphone - 我可以使用公共 getter 和私有 setter 创建属性吗？

> ID：827242
> 
> 赞同：14
> 
> 时间：2009-05-05T22:42:55.280
> 
> 标签：iphone, objective-c, cocoa

我想为我的实例变量使用属性，但在很多情况下，我只希望类本身能够访问设置器。我希望我能做这样的事情：

富.h：

```
@interface Foo {
  NSString *bar;
}
@property (readonly) NSString *bar;
@end 
```

Foo.m:

```
#import "Foo.h"

@interface Foo ()
@property (copy) NSString *bar;
@end

@implementation Foo
@synthesize bar;
@end 
```

但这会产生警告：

```
Foo.m:4: warning: property ‘bar’ attribute in ‘Foo’ class continuation does not match class ‘Foo’ property 
```

我可以看到它在抱怨什么，但它似乎仍然是一个有用的成语。有没有其他方法可以在不编写我自己的设置器的情况下完成此任务？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-05T23:05:47.843

您的方法是正确的，但`@property bar`类扩展中的重新声明必须与原始声明匹配，但 readwrite 与 readonly 除外。所以这将起作用：

Foo.h

```
@interface Foo {
  NSString *bar;
}
@property (copy,readonly) NSString *bar;
@end 
```

Foo.m:

```
#import "Foo.h"

@interface Foo ()
@property (copy,readwrite) NSString *bar;
@end

@implementation Foo
@synthesize bar;
@end 
```

（回想一下，默认值是`assign`用于属性，而不是`copy`）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-05T02:45:26.423

当 Barry 说“默认为属性保留”时，他的意思是应该像这样指定保留：

```
@property (retain) NSDate *endDate; 
```

如果他们像这样离开：

```
@property NSDate *endDate; 
```

assign 由编译器假定。

# java - ArrayList 的用处 。清除（）？

> ID：827243
> 
> 赞同：5
> 
> 时间：2009-05-05T22:43:31.300
> 
> 标签：java, memory-management, arraylist

我正在查看 Java 文档，发现了 ArrayLists 的 clear() 方法。

与简单地将新的 ArrayList 对象重新分配给变量相比，这样做有什么用？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-05T22:45:15.413

因为可能对一个列表有多个引用，所以清除它可能比重新分配所有引用更可取和/或更实用。

如果您大量清空数组（例如，在一个大循环内），那么创建大量临时对象是没有意义的。当然，垃圾收集器最终会清理它们，但如果您不必这样做，那么浪费资源是没有意义的。

而且因为清除列表比创建新列表要少。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T00:25:32.363

您可能有一个最终字段（类变量）`List`：

```
private final List<Thing> things = ... 
```

在课堂上的某个地方你想清除（删除所有）东西。由于`things`是最终的，因此无法重新分配。此外，您可能不想重新分配新的 List 实例，因为您已经实例化了一个完美的 List 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-05T23:09:48.397

`java.util.ArrayList`想象一下在整个代码中有多个相同引用的情况。创建列表的新实例并分配给所有变量几乎是不可能或非常困难的。但是`java.util.ArrayList.clear()`有诀窍！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T00:31:31.070

如果您的目标是真正清除，则清除的费用比创建新对象的费用要少。

Reassigning a reference doesn't clear the object. The assumption is that if there are no other references to it, it would be reclaimed by the GC relatively soon. Otherwise, you just got yourself a mess.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-06T02:00:48.143

In addition to the reasons mentioned, clearing a list is often more semantically correct than creating a new one. If your desired outcome is a cleared list, the action you should take is to clear the list, not create a new list.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-05T22:48:36.497

clear() 不会重新分配新对象，因此对性能的影响较小。

# sharepoint - 共享点特权

> ID：827244
> 
> 赞同：1
> 
> 时间：2009-05-05T22:43:53.373
> 
> 标签：sharepoint, sharepoint-2007

签入文档时，我在`ItemCheckingInEvent`. 在 Dev 中，没有问题。我部署了应用程序，结果发现我没有足够的权限来读取配置文件。我的代码读取配置文件来创建 WCF 代理。真正的问题是，如果我使用该函数，如何从我的函数中获得回报`SPSecurity.RunWithElevatedPrivileges`？

例如：

```
SPSecurity.RunWithElevatedPrivileges(delegate()
{

      // exec service call

});

// need data from service call here 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T03:33:03.083

只需在提升的委托之前声明您的工作对象，并将其分配到内部：

```
object myServiceData = null;

SPSecurity.RunWithElevatedPrivileges(delegate()
{
      myServiceData = DoServiceStuff();
});

//do things with myServiceData 
```

# c# - C# - 从两个 Int32 生成一个 Int64

> ID：827252
> 
> 赞同：14
> 
> 时间：2009-05-05T22:45:38.783
> 
> 标签：c#

c# 中是否有一个函数需要两个 32 位整数 (int) 并返回一个 64 位整数 (long)？

听起来应该有一个简单的方法来做到这一点，但我找不到解决方案。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-05T22:48:51.020

尝试以下

```
public long MakeLong(int left, int right) {
  //implicit conversion of left to a long
  long res = left;

  //shift the bits creating an empty space on the right
  // ex: 0x0000CFFF becomes 0xCFFF0000
  res = (res << 32);

  //combine the bits on the right with the previous value
  // ex: 0xCFFF0000 | 0x0000ABCD becomes 0xCFFFABCD
  res = res | (long)(uint)right; //uint first to prevent loss of signed bit

  //return the combined result
  return res;
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2015-10-25T01:46:59.620

只是为了清楚起见......虽然接受的答案似乎确实可以正常工作。提出的所有一种衬里似乎都不能产生准确的结果。

**这是一个可以工作的班轮：**

```
long correct = (long)left << 32 | (long)(uint)right; 
```

**这是一些代码，您可以自己测试一下：**

```
long original = 1979205471486323557L;
int left = (int)(original >> 32);
int right = (int)(original & 0xffffffffL);

long correct = (long)left << 32 | (long)(uint)right;

long incorrect1 = (long)(((long)left << 32) | (long)right);
long incorrect2 = ((Int64)left << 32 | right);
long incorrect3 = (long)(left * uint.MaxValue) + right;
long incorrect4 = (long)(left * 0x100000000) + right;

Console.WriteLine(original == correct);
Console.WriteLine(original == incorrect1);
Console.WriteLine(original == incorrect2);
Console.WriteLine(original == incorrect3);
Console.WriteLine(original == incorrect4); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-05T22:49:11.457

尝试

```
(long)(((long)i1 << 32) | (long)i2) 
```

这会将第一个 int 向左移动 32 位（一个 int 的长度），然后在第二个 int 中进行 ors，因此您最终会将两个 int 连接在一起。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-12-20T18:24:57.667

小心符号位。这是一个快速的 ulong 解决方案，它也不能从 little endian 移植到 big endian：

```
 var a = 123;
    var b = -123;

    unsafe
    {
        ulong result = *(uint*)&a;

        result <<= 32;
        result |= *(uint*)&b;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T22:49:54.560

这应该可以解决问题

```
((Int64) a << 32 | b) 
```

Int32的位置`a`和`b`位置。尽管您可能想检查最高位会发生什么。或者只是把它放在一个“ `unchecked`{...}”块中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-05T23:11:40.060

一定要小心这样的玩弄，因为你会在小端/大端机器上遇到问题（exp Mono 平台并不总是小端）。另外，您必须处理符号扩展。在数学上，以下是相同的，但处理符号扩展并且与平台无关。

```
return (long)( high * uint.MaxValue ) + low; 
```

在运行时 jitted 将导致类似于 bit twiddling 的性能。这是解释型语言的优点之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-04-03T14:19:27.470

当 i2 < 0 时出现问题 - 将设置高 32 位（0xFFFFFFFF，1xxx...二进制） - thecoop 错误
最好是 (Int64)(((UInt64)i1 << 32) | (UInt32) i2)

或者简单的 C++ 方式

```
public static unsafe UInt64 MakeLong(UInt32 low, UInt32 high)
{
    UInt64 retVal;
    UInt32* ptr = (UInt32*)&retVal;
    *ptr++ = low;
    *ptr = high;
    return retVal;
}

UInt64 retVal;
unsafe
{
    UInt32* ptr = (UInt32*)&retVal;
    *ptr++ = low;
    *ptr = high;
} 
```

但是在这里找到了最好的解决方案;-)
[StructLayout(LayoutKind.Explicit)]
[FieldOffset()]
[https://stackoverflow.com/questions/12898591](https://stackoverflow.com/questions/12898591)
（即使没有不安全）无论如何 FieldOffset 适用于每个项目，所以你必须分别指定每一半的位置并记住负数是零补码，所以例如。低 <0 和高 >0 没有意义 - 例如 -1,0 可能会将 Int64 设为 4294967295。

# .net - .Net 数据库查询选项除了 Linq

> ID：827277
> 
> 赞同：0
> 
> 时间：2009-05-05T22:50:50.860
> 
> 标签：.net, database

最近我在 Linq 中做了很多实现，突然想到，尽管它很棒，但我还没有真正探索任何其他选择。

有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-05T22:54:28.060

好吧，SQL 是一个完美的选择。

但是，我认为您可能正在寻找类似[ADO.NET Entity Framework](http://www.microsoft.com/sqlserver/2008/en/us/ado-net-entity.aspx)的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T22:53:05.660

你试过[亚音速](http://subsonicproject.com/)吗？

它执行 linq、代码生成和一些流畅的查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T22:54:51.350

[Subsonic](http://subsonicproject.com/)、[NHibernate](https://www.hibernate.org/343.html)（别忘了看看[Fluent NHibernate](http://fluentnhibernate.org/)）、[Typed DataSets](http://msdn.microsoft.com/en-us/library/esbykkzb(VS.71).aspx)（恶心）、[MS Entity Framework](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)和[iBatis](http://ibatis.apache.org/dotnetdownloads.cgi)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T22:55:01.070

[NHibernate](https://www.hibernate.org/343.html)是另一个很好的 ORM。或[实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T23:00:20.527

除了其他答案：

*   [Codesmith 模板](http://www.codesmithtools.com/)，
*   企业[库（4.0）](http://www.codeplex.com/entlib)（特别是数据访问块）..
*   带有 ADO 的存储过程..
*   [德克拉里特](http://www.deklarit.com/)
*   [网络层](http://nettiers.com/)

# .net - winform中网络浏览器中的flash问题

> ID：827280
> 
> 赞同：1
> 
> 时间：2009-05-05T22:51:22.933
> 
> 标签：.net, winforms, flash, webbrowser-control

我有一个最奇怪的问题（但不是所有的编程问题都很奇怪吗？）。我有一个包含 webbrowser 对象的 winform，该对象可以打开一个带有 flash 的网站。这个 winform 在触摸屏电脑上运行（我找不到品牌或型号）。

这是我所知道的：

*   通过我的 winform 中的 webbrowser 对象访问的网站中嵌入的 flash 对象无法正常运行
*   所说的 Flash 对象只会对它们的第一次“点击”做出反应。所以网站打开了，如果我点击一个按钮，那个按钮就可以工作，但之后在 flash 对象中没有任何工作。如果我的第一次“点击”错过了一个按钮，那么之后就没有任何效果了。
*   试图“点击”一个 Flash 按钮的响应与将鼠标悬停在按钮上的响应相同
*   这不是触摸屏的触摸部分的问题，因为使用鼠标也会给出相同的无法正常工作的响应
*   这不是网页的问题，因为我可以在同一台计算机上打开资源管理器并从那里很好地浏览网页
*   该程序也可以在我的个人计算机上 100% 正常运行，因此它不应该是程序的错
*   如果不是触摸屏故障，也不是程序故障，我现在不能责怪任何事情。
*   完全相同的程序在我们的旧触摸屏上 100% 运行（它还有*其他*问题，所以我们不得不摆脱它）。
*   哦，同样，在winform的网络浏览器中浏览一个“普通”网页也可以。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-01T07:15:51.680

我在开发 Windows 应用程序时也遇到了同样的问题。
创建一个用户定义的控件，如下所示：

```
// CREATE A CLASS AND INHERITS TO WEBBROWSER CLASS
public partial class ucWebBrowser : WebBrowser
{
     public ucWebBrowser()
     {
        InitializeComponent();
     }

     protected override void WndProc(ref Message m)
     {
         switch (m.Msg)
         {
            case 0x021:
            case 0x201:
            case 0x204:
            case 0x207:
                base.DefWndProc(ref m);
            return;
        }
        base.WndProc(ref m);
    }
} 
```

现在您可以在工具箱列表中看到此控件。现在单击并将此控件拖动到您的 winform 而不是 webbrowser 控件上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-19T21:01:44.747

我们遇到了类似的错误，唯一的解决方案是确保在客户端计算机上至少安装了 .NET 2.0 的服务包 1。

# visual-studio - 如何自定义 VS 2008 数据库项模板？

> ID：827291
> 
> 赞同：1
> 
> 时间：2009-05-05T22:54:58.293
> 
> 标签：visual-studio, visual-studio-2008, code-templates

尽管 MSDN 中有一组信息丰富的页面描述了用于代码项目（项目和项）的 Visual Studio 模板，但似乎没有关于数据库项目的内容。如果我错了，请引导我朝着正确的方向前进。我有 VS2008 专业版。

无论如何，我的问题与新的数据库项目有关。目前，该文件夹

C:\Program Files\Microsoft Visual Studio 9.0\Common7\Tools\Templates\Database Project Items

包含 6 个模板文件和另一个文件 NewDataItems.vsdir，它似乎有助于控制 VS 如何使用这 6 个模板。我想为存储过程创建一个新模板，我注意到如果我只是复制默认模板并用新名称修改它，它确实会显示在“添加新项目”对话框中，但它不使用相同的图标作为其他项目。它确实有效，但我不禁想知道我是否适当地修改了 NewDataItems.vsdir 文件以包含它，我可以让它看起来与对话框中的其他项目相同。这是文件的内容：

```
New Stored Procedure Script.sql|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6306|30|#6307|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1052| |#6320
New View Script.sql|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6308|60|#6309|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1051| |#6320
New Table Script.sql|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6310|40|#6311|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1050| |#6320
New SQL Script.sql|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6319|10|#6314|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1054| |#6320
New Trigger Script.sql|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6312|50|#6313|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1053| |#6320
New Query.dtq|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|#6321|20|#6315|{220A4C17-7E7C-4663-BBCC-5E607C6543CD}|1057| |#6322 
```

我不清楚这个文件的各种元素应该是什么意思，但看起来编号项目（#6308、30、1052 等）可能控制对话框中演示的某些方面。有人可以解释这个文件的元素以及如何进行更改和添加吗？

此外，默认模板 New Stored Procedure Script.sql 实际上在对话框中显示为“Stored Procedure Script”。如果我将新的存储过程脚本复制并粘贴为特殊存储过程脚本.SQL而不会做任何事情，那么一个带有不同原始显示的图标的新项目，而且选择并添加到项目中时进入项目。但是如何使图标与默认图标相同，以及如何使对话框中的项目名称由我选择而不是文件名？回复报价

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:30:48.893

这应该回答你的问题：http: [//msdn.microsoft.com/en-us/library/bb166192.aspx](http://msdn.microsoft.com/en-us/library/bb166192.aspx)（模板目录描述（.Vsdir）文件）

# javascript - 如何使用 jQuery 获取所有 ID？

> ID：827294
> 
> 赞同：74
> 
> 时间：2009-05-05T22:55:53.500
> 
> 标签：javascript, jquery

我正在尝试收集一个扇区中的 id 列表（数组）

```
<div id="mydiv">
 <span id='span1'>
 <span id='span2'>
</div>

$("#mydiv").find("span"); 
```

给了我一个 jQuery 对象，但不是一个真正的数组；

我可以

```
var array = jQuery.makeArray($("#mydiv").find("span")); 
```

然后使用 for 循环将 id 属性放入另一个数组

或者我可以

```
$("#mydiv").find("span").each(function(){}); //but i cannot really get the id and assign it to an array that is not with in the scope?(or can I) 
```

无论如何，我只是想看看 jQuery 中是否有一个速记来做到这一点；

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-05-05T23:02:39.473

> //但我无法真正获取 id 并将其分配给不在范围内的数组？（或者我可以）

是的你可以！

```
var IDs = [];
$("#mydiv").find("span").each(function(){ IDs.push(this.id); }); 
```

这就是[闭包](https://stackoverflow.com/questions/tagged/closures%20javascript)的美妙之处。

请注意，虽然您在正确的轨道上，[但 sighohwell](https://stackoverflow.com/questions/827294/how-to-get-all-of-the-ids-with-jquery/827320#827320)和[cletus](https://stackoverflow.com/questions/827294/how-to-get-all-of-the-ids-with-jquery/827329#827329)都指出了更可靠和更简洁的方法来实现这一点，利用[属性过滤器](http://docs.jquery.com/Selectors/attributeHas#attribute)（将匹配的元素限制为具有 ID 的元素）和 jQuery 的内置[`map()`](https://api.jquery.com/jQuery.map/)函数：

```
var IDs = $("#mydiv span[id]")         // find spans with ID attribute
  .map(function() { return this.id; }) // convert to set of IDs
  .get(); // convert to instance of Array (optional) 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-05-05T23:04:37.490

.get() 方法将从 jQuery 对象返回一个数组。此外，您可以在调用 get() 之前使用 .map 投影到某些东西

```
var idarray = $("#myDiv")
             .find("span") //Find the spans
             .map(function() { return this.id; }) //Project Ids
             .get(); //ToArray 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-05-05T23:07:29.730

我的建议？

```
var arr = $.map($("#mydiv [id]"), function(n, i) {
  return n.id;
}); 
```

你也可以这样做：

```
var arr = $.map($("#mydiv span"), function(n, i) { 
```

或者

```
var arr = $.map($("#mydiv span[id]"), function(n, i) { 
```

甚至只是：

```
var arr = $("#mydiv [id]").map(function() {
  return this.id;
}); 
```

基本上方法很多。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-05T23:03:05.310

我能想到的回答这个问题的最好方法是制作一个自定义 jquery 插件来做到这一点：

```
jQuery.fn.getIdArray = function() {
  var ret = [];
  $('[id]', this).each(function() {
    ret.push(this.id);
  });
  return ret;
}; 
```

然后做类似的事情

```
var array = $("#mydiv").getIdArray(); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-12-15T09:21:07.407

这是一个迟到的答案，但现在有一个简单的方法。当前版本的 jquery 允许您搜索属性是否存在。例如

```
$('[id]') 
```

如果他们有 id，会给你所有的元素。如果您想要所有以 id 开头的跨度，`span`您可以使用

```
$('span[id^="span"]') 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-05T23:01:32.130

不是*真正的*数组，但 objs 都是 javascript 中的关联数组。

我选择不使用带有 [] 和 [].push 的真实数组，因为从技术上讲，您可以在一个页面上拥有多个 ID，即使这样做是不正确的。所以只是另一种选择，以防某些 html 重复 ID

```
$(function() {

       var oArr = {};
       $("*[id]").each(function() {
           var id = $(this).attr('id');
           if (!oArr[id]) oArr[id] = true;
       });

       for (var prop in oArr)
           alert(prop);

   }); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-05-22T15:26:00.040

HTML

```
<div id="mydiv">
 <span id='span1'>
 <span id='span2'>
</div> 
```

jQuery

```
var IDs = [];
$("#mydiv").find("span").each(function(){ IDs.push($(this).attr("id")); }); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-08-22T14:28:44.453

您可以获取特定标签的 id 并将其发送到另一个元素。举个例子：

```
$("input").map(function() {
    $( "textarea" ).append(this.id+"\n");
}); 
```

它将获取所有输入 id 并将其发送到 textarea。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-07-28T12:56:46.237

```
for(i=1;i<13;i++)     
{

   alert($("#tdt"+i).val());  

} 
```

# python - D-Bus 和 HAL 的单元测试？

> ID：827295
> 
> 赞同：2
> 
> 时间：2009-05-05T22:56:01.067
> 
> 标签：python, unit-testing, dbus, hal

如何测试一种与本地 D-Bus 进行交互（访问 HAL 对象）的方法？

测试的结果会因运行测试的系统而异，所以我不知道如何提供方法可靠的输入。

顺便说一句，我正在使用 Python。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:31:36.130

如果您不能模拟环境，那么您可能无法编写测试。如果您通过一个对象访问 HAL/D-Bus，并且您为您的测试提供了一个模拟实例，那么应该可以从模拟实现模拟您的测试的必要输入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-03T02:46:07.730

也可以为测试创建一个临时的 D-Bus 总线，并模拟您的程序在测试代码中使用的任何服务。您可以将此方法用于作为 D-Bus 服务、D-Bus 客户端或两者的程序。缺点是总线设置有点毛茸茸。在例如 Telepathy Gabble 中有[执行此操作](http://git.collabora.co.uk/?p=telepathy-gabble.git;a=tree;f=tests/twisted/tools)的代码。

# windows - Direct2D 是否有任何可用的性能测试？

> ID：827298
> 
> 赞同：3
> 
> 时间：2009-05-05T22:56:55.480
> 
> 标签：windows, gdi+, gdi, direct2d

我对绘制基元性能（CAD、GIS 等）特别感兴趣，但与 GDI/GDI+ 的任何速度比较都会非常有趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T23:26:48.263

为什么不直接输入一些代码来输出测试运行所用的时间，然后您可以比较各种方法的性能。

# iphone - iPhone 应用程序 - 一个视图如何调用另一个视图中的方法？

> ID：827301
> 
> 赞同：1
> 
> 时间：2009-05-05T22:58:25.490
> 
> 标签：iphone, objective-c, uiwebview, message

我正在制作一个简单的标签栏 iPhone 应用程序。它有两个选项卡，一个带有 UIWebView，另一个带有几个用于保存设置的文本字段，以及一个用于保存设置的按钮。

我想要做的是在用户单击设置选项卡/视图上的保存时重新加载 UIWebView。我已经保存了设置，我只需要弄清楚如何进行调用以使 UIWebView 自行刷新。

我对视图如何将消息发送到另一个视图感到困惑。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T06:19:20.407

您在 UITabBarController 框架内使用这两个视图的事实与问题的核心无关；也就是说，您希望应用程序的一部分被告知另一部分发生了某些事情。这样做的典型方法是使用 KVO，或者像这样使用 NSNotificationCenter：

```
// Register interest in finding out when the settings are changed
[[NSNotificationCenter defaultCenter] addObserver:myWebViewController 
    selector:@selector(refreshWebView:) name:@"settingsSaved" object:nil];

// Notify interested parties that the settings have changed
[[NSNotificationCenter defaultCenter] postNotificationName:@"settingsSaved" object:nil]; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-05T23:04:28.440

我所做的是让他们通过 AppDelegate 相互交谈。

例如：

View1 将具有以下功能：

```
MyAppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];
    [appDelegate myFunction]; 
```

MyAppDelegate 有一个名为 myFunction 的函数，它要么做某事，要么调用：

```
[viewController myViewFunction]; 
```

我已经建立了一个非常好的系统来加载多个视图（并且来回导航，就好像它们是不同的屏幕一样）。我只是没有时间写这篇文章并将其发布到 pushplay.net——但我会在接下来的几天内尝试这样做......

===

编辑：好的，我已经发布了我所拥有的。任何意见将不胜感激。

[http://pushplay.net/blog_detail.php?id=27](http://pushplay.net/blog_detail.php?id=27)

我理解下面的评论者在说什么，但我还没有看到一个基于多个视图控制器需要在彼此之间导航的无缝工作的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T06:20:42.497

它取决于特定应用程序的复杂性和该应用程序中的对象模型：

*   如果视图是相关的并且消息仅与视图相关，那么它们可以直接相互发送消息。例如，视图可以（并且应该）直接向其子视图发送消息，并且它们可以直接向其父视图发送消息。

*   如果他们的视图不相关但显示有关相同信息的数据，则您应该通过 viewController 代理消息 - 这正是您拥有视图控制器的原因。

*   如果您有一个具有强大 MVC 架构的复杂应用程序，则应通过更新模型对象并通过其 viewController 将其级联到视图来间接完成通信。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T06:51:06.713

在这种情况下，您最好让您的应用程序委托在应用程序启动时将持有 Web 视图的控制器分配为您的其他视图控制器的委托 - 考虑使用协议使其干净，但对于简单的事情，您总是可以将委托类型声明为您的 Web 视图持有视图控制器。

通知也是一个好主意，没有什么任务对他们来说太小了——但你应该知道，在诸如 dealloc 之类的地方取消订阅通知很重要。对于标签栏视图控制器的顶层，这并不重要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T04:45:06.990

您始终可以在标签视图控制器中设置一个指向 Web 视图的实例变量。只需将其设置为 IBOutlet，将其连接到 Interface Builder，然后在实例变量上调用您的方法。

.h 文件：

```
IBOutlet UIWebView *webView;

@property (nonatomic, retain) UIWebView *webView; 
```

.m 文件：

```
@synthesize webView;

//Then later in your method
[webView refresh]; //or however you do it 
```

问候，

凯尔

# php - 如何从我的 apache 上的 PHP 页面调用 Perl？

> ID：827302
> 
> 赞同：2
> 
> 时间：2009-05-05T23:00:10.353
> 
> 标签：php, perl, cgi

我和我的朋友正在为一系列游戏创建一个日志解析器。我们用 PHP/MySQL 编写了前端（Web），用 Perl 编写了解析器（当然也使用了 MySQL）。现在我们在让这两者进行交流时遇到了问题。

我们不想做的就是：一个在线管理页面，您可以在其中拥有“解析”按钮。当您单击它时，一个 Perl 脚本应该启动。就像“exec("perl /home/www/Init.pm -f games_mp.log")。

这可能吗？请记住，它应该很容易设置。

我们已经尝试了从 system/exec 到 .htaccess 的所有方法，但似乎没有什么是开箱即用的。根本不工作。

建议？

拉卡 =)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:04:48.517

为什么不运行 Perl 脚本，就好像它们是使用 mod_perl 来自 jQuery 的网页一样？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T23:02:47.510

我敢打赌你会遇到路径错误。尝试提供 Perl 可执行文件的完整路径。例如：

```
exec("/usr/bin/perl /home/www/Init.pm -f games_mp.log") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:28:59.070

我很抱歉地说没有简单的方法来设置它。不同的服务器带有不同的默认 apache 配置。

您可能想要做的是在服务器配置、虚拟主机配置、目录配置中添加以下行，或者，如果设置正确，还可以添加 .htaccess。

`AddHandler cgi-script .cgi .pl .pm`

您的用户还需要适当地 chmod 和 chown 文件。

问题是，这听起来像是一个长期运行的过程。如果是这样，那么运行 Web 浏览器可能需要很长时间才能完成。如果是这种情况，您可能希望设置某种作业队列，并每隔 5 分钟左右有一个基于此的 cron 脚本执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T00:36:10.623

在 PHP 中，很多事情都依赖于配置。尝试调查它，因为可以禁用许多运算符。

检查 Perl 程序是否具有正确的权限。尝试从命令行运行你的 Perl 程序。

# django - 如何处理模板继承中的变量

> ID：827305
> 
> 赞同：0
> 
> 时间：2009-05-05T23:00:28.107
> 
> 标签：django, django-templates

我只想在子模板中定义body标签的id属性。第一个解决方案完美运行：

base.html：

```
[body{% block bodyid %}{% endblock %}] 
```

child.html:

```
{% block bodyid %} id="myId"{% endblock %} 
```

简单又酷！但我不喜欢在每个子模板中都指向 id="myId" 。我只想将值“myId”发送到父模板，并将其放入 id="...."。所以，我发明了这个方法：

base.html：

```
[body{% block bodyid %} id={{ bodyid }}{% endblock %}] 
```

child.html:

```
{% block bodyid %}
    {% with 'myId' as bodyid %}
        {{ block.super }}
    {% endwith %}
{% endblock %} 
```

但是比较第一个解决方案是可怕和乏味的。有什么好的方法可以做到这一点吗？

这个问题比管理 bodyId 更深。我想，我尝试通过标准django模板的继承来寻找和组织子模板系统。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:08:45.373

在基本模板中：

```
<body id="{% block bodyid %}{% endblock %}"> 
```

在子模板中：

```
{% block bodyid %}myId{% endblock %} 
```

如果我正确理解您的问题，这应该足以实现您想要的；仅将实际 ID ( `myId`) 发送到基本模板。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T00:03:13.760

如果您愿意，您可以通过您的代码进行设置 - 以便您的 id 是您的上下文对象的一部分，因此不需要在子模板中输入，只需在调用它们的视图中输入。

然后，您可以告诉您的基本模板从上下文对象中获取 id，或者只使用模板语法：

```
<body id="{{ body_id }}"> 
```

当然这里是个人喜好，这取决于您的模板和视图的结构，但它是我这样做的方式。

# ios - 禁用 UITextField 的自动更正

> ID：827310
> 
> 赞同：70
> 
> 时间：2009-05-05T23:02:33.827
> 
> 标签：ios, objective-c, uitextfield

当我尝试在我的 iPhone 应用程序 ( `UITextfield`) 中编辑文本时，它会自动更正我的输入。

你能告诉我如何禁用它吗？

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2009-05-05T23:11:48.970

```
UITextField* f = [[UITextField alloc] init];
f.autocorrectionType = UITextAutocorrectionTypeNo; 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2015-05-14T23:40:37.753

## 斯威夫特版本

我来到这里寻找 Swift 版本：

```
myInput.autocorrectionType = .No 
```

另请阅读[@MaikelS的答案](https://stackoverflow.com/a/7239975/1664443)

**斯威夫特 3.0**

```
textField.autocorrectionType = .no 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-05-05T23:10:10.423

您可以使用该`UITextInputTraits`协议来实现此目的：

```
myInput.autoCorrectionType = UITextAutocorrectionTypeNo; 
```

有关更多详细信息，请参见[此处](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITextInputTraits_Protocol/Reference/UITextInputTraits.html#//apple_ref/occ/intfp/UITextInputTraits/autocorrectionType)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-08-30T07:30:58.823

Interface Builder 也有一个下拉字段来禁用它。由于您更有可能在界面构建器中创建文本字段，因此请在此处查找。您可以在“更正”旁边的属性检查器中找到它。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-12-29T16:42:16.330

您还可以通过选择“属性检查器”在情节提要中进行设置，在“更正”下，您可以选择：“默认”、“是”和“否” [![在此处输入图像描述](https://i.stack.imgur.com/WOs5W.png)](https://i.stack.imgur.com/WOs5W.png) [![在此处输入图像描述](https://i.stack.imgur.com/jMvJP.png)](https://i.stack.imgur.com/jMvJP.png)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-09-10T07:14:15.630

```
+ (void)disableAutoCorrectionsForTextfieldsAndTextViewGlobally {
  static dispatch_once_t onceToken;
  dispatch_once(&onceToken, ^{
    struct objc_method_description autocorrectionTypeMethodDescription =
        protocol_getMethodDescription(@protocol(UITextInputTraits),
                                      @selector(autocorrectionType), NO, YES);
    IMP noAutocorrectionTypeIMP_TEXT_FIELD =
        imp_implementationWithBlock(^(UITextField *_self) {
          return UITextAutocorrectionTypeNo;
        });
    IMP noAutocorrectionTypeIMP_TEXT_VIEW =
        imp_implementationWithBlock(^(UITextView *_self) {
          return UITextAutocorrectionTypeNo;
        });
    class_replaceMethod([UITextField class], @selector(autocorrectionType),
                        noAutocorrectionTypeIMP_TEXT_FIELD,
                        autocorrectionTypeMethodDescription.types);
    class_replaceMethod([UITextView class], @selector(autocorrectionType),
                        noAutocorrectionTypeIMP_TEXT_VIEW,
                        autocorrectionTypeMethodDescription.types);
  });
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-03-25T08:36:08.047

在 SwiftUI 中，您可以使用`.disableAutocorrection(true)`修饰符。

Hiere 是一个真实的例子：

```
VStack {
    TextField("title", text: $LoginModel.email)
        .autocapitalization(.none)
        .disableAutocorrection(true)
        .foregroundColor(.white)
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-23T12:32:44.627

斯威夫特 5：

这就是我在项目中实现电子邮件地址字段的方式

```
private let emailTextField: UITextField = {
    let tf = CustomTextField(placeholder: "Email address")
    tf.keyboardType = .emailAddress
    tf.autocorrectionType = .no        //disable auto correction
    tf.autocapitalizationType = .none   //disable default capitalization
    return tf
}() 
```

CustomTextField 是我的扩展类（这里不重要）

# delphi - 主/细节行为

> ID：827319
> 
> 赞同：1
> 
> 时间：2009-05-05T23:04:36.240
> 
> 标签：delphi, dataset

我使用Delphi 7 + Zeos + MySQL，当我尝试发布主表时遇到问题，首先发布详细信息数据集，在数据库中引发引用完整性异常，'因为详细信息表需要主表的ID。

我可以恢复这种行为吗？我可以在详细信息之前保留主表吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-15T07:58:43.500

我认为这只是`TDataSet`工作方式。如果您有未过帐的详细记录，请掌握。如果我没记错的话`Post`，他们会强迫他们这样做。`Post`

所以我猜你有类似的东西：

```
tblMaster.Insert;
tblMaster.FieldByName('foo').Value := 'foo';
tblDetail.Insert;
tblDetail.FieldByName('bar').Value := 'bar';
tblMaster.Post; // error!
tblDetail.Post; 
```

您应该可以通过先发布 master 来解决此问题：

```
tblMaster.Insert;
tblMaster.FieldByName('foo').Value := 'foo';
tblMaster.Post;
tblDetail.Insert;
tblDetail.FieldByName('bar').Value := 'bar';
tblDetail.Post; 
```

# c# - 非螺纹锁定互斥体

> ID：827323
> 
> 赞同：0
> 
> 时间：2009-05-05T23:05:41.760
> 
> 标签：c#, multithreading, locking, mutex

这是[这个](https://stackoverflow.com/questions/804356/extra-process-file-locks/)问题的一个分支，但删除了一些限制。

我有一个需要管理文件锁定的系统。我需要能够在一个线程中锁定文件（共享读锁定），然后在另一个线程中解锁。更准确地说，我无法确定它将在哪个线程中解锁，或者即使创建线程仍然存在。

我还需要排他写锁定来配合这个，但这都在同一个线程中。

[.NET Mutex](http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx)不起作用，因为它在创建线程退出时会做额外的事情

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T23:09:56.120

也许是一个计数为 1的（命名的）[信号量？](http://msdn.microsoft.com/en-us/library/system.threading.semaphore.aspx)`WaitOne`锁定，`Release`解锁？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:15:25.043

您链接到的问题是跨越进程边界，但从我读到的内容来看，您只是跨越线程......考虑到这一点，我认为 Jeff Richter 的 ReaderWriterGate 类可能很适合您的问题。它允许您控制对共享资源的访问并将对该资源的访问请求排队。它似乎没有任何线程关联，因此如果您不跨越进程边界，它可能是您的解决方案。

这是一篇关于该类的文章的链接... [并发事务](http://msdn.microsoft.com/en-us/magazine/cc163532.aspx)，您可以[从这里下载 PowerThreading 库](http://www.wintellect.com/PowerThreading.aspx)

如果您的情况非常简单（除了从一个线程锁定并从另一个线程释放），我不明白为什么您不能使用.NET 中的内置[ReaderWriterLock](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx)（尽管 PowerThreading 库中的那个应该很多快点）。[Monitor 类](http://msdn.microsoft.com/en-us/library/system.threading.monitor.aspx)没有线程关联，可以从任何上下文访问，因此取决于您如何使用它，这可能是您最直接的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:49:26.367

听起来像一个*旋转门*问题。您需要管理第一个锁定文件的阅读器和最后一个解锁文件的阅读器。您可以使用信号量来实现这一点。您可以通过让旋转栅门在有作家等待时拒绝读者来优先考虑作家。

# macos - Mac 有什么好的十六进制编辑器/查看器？

> ID：827326
> 
> 赞同：164
> 
> 时间：2009-05-05T23:05:58.920
> 
> 标签：macos, hex, hex-editors

Mac 有什么好的十六进制编辑器/查看器？我使用 xxd 来查看 hexdumps，我认为它可以反向使用来进行编辑。但我真正想要的是一个真正的十六进制编辑器。

* * *

## 回答 #1

> 赞同：333
> 
> 时间：2009-05-05T23:22:47.943

要查看文件，请运行：

```
xxd filename | less 
```

要将 Vim 用作十六进制编辑器：

1.  在 Vim 中打开文件。
2.  运行 `:%!xxd`（将缓冲区转换为十六进制）
3.  编辑。
4.  运行`:%!xxd -r`（逆变换）
5.  节省。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2012-04-19T21:57:02.473

1.  使用 Xcode 打开文件并按 Command + Shift + J
2.  右键单击左窗格中的文件名
3.  打开为 -> 十六进制

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-05-05T23:07:53.270

我得到的一项建议是[Hex Fiend](http://ridiculousfish.com/hexfiend/)。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2010-11-05T19:12:37.113

在[http://www.synalysis.net/](http://www.synalysis.net/)你可以得到我正在为 Mac 开发的十六进制编辑器 - Synalyze It!。它的价格为 7 欧元 / 40 欧元（专业版），并提供了一些额外的功能，如直方图、增量搜索、对许多文本编码的支持以及文件格式的“语法”的交互式定义。

语法有助于解释文件并为十六进制视图着色以便于分析。

![合成它！](https://i.stack.imgur.com/8f1oP.png)

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-05-05T23:08:18.527

我最近开始使用[0xED](https://www.suavetech.com/0xed/0xed.html)，并且非常喜欢它。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-05-05T23:10:16.883

可能有更好的选择，但我使用[TextWrangler](http://www.barebones.com/products/TextWrangler/)进行基本的十六进制编辑。文件 -> 十六进制转储文件

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-06T00:22:09.270

我喜欢的是[HexEdit](http://hexedit.sourceforge.net/)快速且易于使用

# php - 我可以像在 PHP 中一样找到正在运行 Web 服务器的用户吗？

> ID：827327
> 
> 赞同：6
> 
> 时间：2009-05-05T23:06:32.320
> 
> 标签：php, apache

我正在用 PHP 编写一个简单的 Web 应用程序，该应用程序需要对服务器上的目录具有写访问权限，如果该目录不可写，我想显示一条错误消息，说明将目录的所有者设置为网络服务器的任何人作为（例如www-data，nobody）运行，但由于大多数人不知道这一点，因此能够告诉他们将目录分配给谁会很好。是否可以从 PHP 中找到它？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-05T23:16:15.450

```
<?php
  echo exec('whoami');
?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T23:11:49.577

我使用的快速而肮脏的技巧是将文件写入`/tmp/`. 它应该由 PHP 进程使用的用户和组创建。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-05T23:13:35.377

如果在 linux/unix 上：

```
<?php
$temp = tmpfile();
print_r(posix_getpwuid(fileowner($temp)));
?> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-05T23:34:01.223

在 Unix 平台上，如果安装或编译了 posix 扩展，即使在安全模式下，此解决方案也可以工作。

```
$user = posix_getpwuid(posix_geteuid());
echo $user['name']; 
```

文档在[这里](http://php.net/manual/en/function.posix-getpwuid.php)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-05T23:08:49.630

查看[shell_exec()](http://www.php.net/shell_exec)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-05T23:09:19.490

如果你可以运行一些 bash，你可以使用`whoami`或者你可以在`/proc`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T23:13:28.513

该错误消息在 Windows 服务器环境中分崩离析。“请确保 Web 服务器对目录具有写入权限”可能是更好的错误消息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-26T18:00:14.943

在某些服务器中使用`echo exec('whoami');`或 不返回任何内容，但在每种情况下，您都可以使用[get_current_user](http://php.net/manual/en/function.get-current-user.php)`exec('whoami',$out); echo $out;` 获取当前用户

```
<?php
echo get_current_user();
?> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-29T05:16:37.067

我没有要测试的 Windows 系统 - 但在 Unix-likes 下，[get_current_user()](https://www.php.net/manual/en/function.get-current-user.php)返回预期的用户名（运行 Web 服务器的用户）。

# drupal - 这个用于 Drupal 的 gmail 联系人导入器脚本有什么问题？

> ID：827343
> 
> 赞同：0
> 
> 时间：2009-05-05T23:10:37.957
> 
> 标签：drupal, open-source, gmail, import-contacts

Drupal 有一个 gmail 联系人导入器模块，它已经非常接近工作了大约 7 个月了。我没有调试问题的能力，维护者消失了，我认为这是一个重要的工作。所以我求助于 StackOverflow。

问题：当您填写您的凭据并告诉脚本带回您的联系人时，默认情况下它会拉入 25。这很好。

当您告诉它通过更改您查询的 URL 来查找更多联系人时：

```
http://www.google.com/m8/feeds/contacts/default/thin 
```

对此：

```
http://www.google.com/m8/feeds/contacts/default/thin?max-results=1000 
```

您收到以下致命错误：

> 致命错误：在第 97 行调用`getAttribute()`非对象上的成员函数`path/to/site/sites/all/modules/dcl_importer/scripts/importGData.class.php`

这是脚本：

```
class GDataMailer {
    static $url_ClientLogin = 'https://www.google.com/accounts/ClientLogin';
    static $url_Feed = 'http://www.google.com/m8/feeds/contacts/default/thin?max-results=65535';

    function newCurlSession($URL, $auth = null) {
        $curl = curl_init();

        $opts = array(
            CURLOPT_URL => $URL,
            CURLOPT_REFERER => '',
            CURLOPT_SSL_VERIFYPEER => false,
            CURLOPT_SSL_VERIFYHOST => true,
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_FOLLOWLOCATION => true,
        );
        if (null != $auth) {
            $opts[CURLOPT_HTTPHEADER] = array(
               'Authorization: GoogleLogin auth='.$auth,
            );
        }
        curl_setopt_array($curl, $opts);
        return $curl;
    }

    function useCurlForPost($curl, $params) {
        curl_setopt($curl, CURLOPT_POST, true);
        curl_setopt($curl, CURLOPT_POSTFIELDS, $params);
        return $curl;
    }

    function getAuthToken($login, $password) {
        $curl = $this->useCurlForPost($this->newCurlSession(self::$url_ClientLogin), array(
           'accountType' => 'HOSTED_OR_GOOGLE',
           'Email' => $login,
           'Passwd' => $password,
           'service' => 'cp',
           'source' => 'Drupal-Contact-Importer',
        ));
        $resp = curl_exec($curl);

        // Look for the important stuff:
        preg_match_all('/Auth=([^\s]*)/si', $resp, $matches);
        if (isset($matches[1][0])) {
            return $matches[1][0];
        } else {
           return false;
        }
    }

    function getAddressbook($login, $password) {
        // check if username and password was given:
        if ((isset($login) && trim($login)=="") || (isset($password) && trim($password)==""))
        {
            $args = func_get_args();
            drupal_set_message('Incorrect login information given: '.print_r($args, true), 'error');
            return false;
        }

        // Get the GData auth token:
        $auth = $this->getAuthToken($login, $password);
        if (false === $auth) {
            drupal_set_message('Login failed', 'error');
            return false;
        }        

        $curl = $this->newCurlSession(self::$url_Feed, $auth);
        $data = curl_exec($curl);

        $doc = new DOMDocument();
        $doc->loadXML($data);
        $path = new DOMXPath($doc);
        $path->registerNamespace('a', 'http://www.w3.org/2005/Atom');
        $path->registerNamespace('gd', 'http://schemas.google.com/g/2005');
        $nodes = $path->query('//a:entry');
        $num = $nodes->length;

        $contacts = array();
        for ($x = 0; $x < $num; $x++) {
            $entry = $nodes->item($x);
            $tnodes = $path->query('a:title', $entry);
            $nnode = $tnodes->item(0);
            $name = $nnode->textContent;
            $enodes = $path->query('gd:email', $entry);
            $mnode = $enodes->item(0);
            $email = $mnode->getAttribute('address');
            // NOTE: Keep in mind that $mnode->getAttribute('rel') tells you what kind of email it is.
            // NOTE: Also remember that there can be multiple emails per entry!
            if (empty($name)) {
                $contacts[] = $email;
            } else {
                $contacts[$name] = $email;
            }
        }        

        return $contacts;
    }
} 
```

97 号线是`$email = $mnode->getAttribute('address');`接近尽头的那条线。

我可以在这里更改什么以不再出现该错误并使其适用于 Drupal 社区？我想提取一个人的所有联系人列表，而不仅仅是 25 个。我认为如果我发送的号码足够高，它就会足够接近可以通过。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T18:16:37.127

在不直接测试的情况下，我会尝试用以下代码替换第 96 - 104 行：

```
$mnode = $enodes->item(0);
if (isset($mnode) && is_object($mnode)) {
    $email = $mnode->getAttribute('address');
    // NOTE: Keep in mind that $mnode->getAttribute('rel') tells you what kind of email it is.
    // NOTE: Also remember that there can be multiple emails per entry!
    if (!empty($email)) {
        if (empty($name)) {
            $contacts[] = $email;
        } else {
            $contacts[$name] = $email;
        }
    }
} 
```

gd:email 是根据[Google Data API](http://code.google.com/apis/gdata/elements.html#gdEmail)的可选元素。它在 Gmail 的实现中也是可选的。您正在使用的模块假定它存在并且当它不存在时失败。

根据注释：注释，每个联系人的多个电子邮件地址仍未处理。

# git - 在新存储库上推送源主错误

> ID：827351
> 
> 赞同：185
> 
> 时间：2009-05-05T23:13:57.340
> 
> 标签：git, github

我刚开始在 github 上使用 git。我按照他们的指示在最后一步遇到了错误。我正在检查当前不受源代码控制的现有目录（大约一周前的项目）。除此之外，我的用例应该很正常。

这是正在发生的事情：

```
$ git push origin master
error: src refspec master does not match any.
fatal: The remote end hung up unexpectedly
error: failed to push some refs to 'git@github.com:{username}/{projectname}.git' 
```

Github 的使用说明：

```
Global setup:

  Download and install Git
  git config --global user.name "Your Name"
  git config --global user.email {username}@gmail.com

Next steps:

  mkdir projectname
  cd projectname
  git init
  touch README
  git add README
  git commit -m 'first commit'
  git remote add origin git@github.com:{username}/{projectname}.git
  git push origin master 
```

* * *

## 回答 #1

> 赞同：191
> 
> 时间：2009-11-14T02:17:21.673

我遇到了同样的问题，然后因为我实际上没有添加我的项目文件而打了自己一巴掌。

```
git add -A
git commit -am "message"
git push origin master 
```

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2009-05-06T06:32:16.150

错误消息导致您的本地存储库中没有`master`分支的结论。要么推送你的主开发分支（`git push origin my-local-master:master`它将`master`在 github 上重命名）或先提交。您不能推送完全空的存储库。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-06-29T09:55:31.220

我遇到过同样的问题。我删除了 .git 文件夹，然后按照以下命令

1.  `$ git init`
2.  `$ git add .`
3.  `$ git remote add origin git@gitorious.org:project/project.git`
4.  `$ git commit -m "Initial version"`
5.  `$ git push origin master`

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-11-22T12:01:39.270

我有同样的问题。它解决了我的问题。如果你初始化你的 git 。你必须在终端上做

1)`git add .`

2)`git commit -m "first commit"`

用于发送到 bitbucket

3)`git push -u origin --all # pushes up the repo and its refs for the first time`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-04-09T22:21:02.493

我在创建我的第一个 Git 存储库时遇到了同样的问题。我在 Git 源远程创建中有一个错字 - 结果我没有大写我的存储库的名称。

```
 git remote add origin git@github.com:Odd-engine 
```

首先，我使用删除了旧遥控器

```
git remote rm origin 
```

然后我重新创建了来源，确保我的来源名称的输入方式与我的来源的拼写方式完全相同。

```
git remote add origin git@github.com:Odd-Engine 
```

没有更多的错误！:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-08-13T12:59:45.343

我遇到了同样的错误，因为 Bombe 说我的配置中没有名为 master 的本地分支，尽管`git branch`确实列出了一个名为 master 的分支......

要修复它，只需将其添加到您的 .git/config

```
[branch "master"]
    remote = origin
    merge = refs/heads/master 
```

有点老套，但可以完成工作

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-09-09T18:22:08.770

确保你在一个分支上，至少在 master 分支上

类型：

```
git branch 
```

你应该看到：

ubuntu-user:~/git/turmeric-releng$ git 分支

```
* (no branch)
master 
```

然后输入：

```
git checkout master 
```

那么您的所有更改都将适合主分支（或您选择的分支）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-15T22:01:01.260

```
error: failed to push some refs to 'git@github.com:{username}/{projectname}.git' 
```

除非您概括错误消息，否则看起来您确实将`git@github.com:{username}/{projectname}.git`其作为远程 Git 存储库。您应该填写`{username}`您的 GitHub 用户名和`{projectname}`项目名称。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-01-29T21:45:16.713

为了真正解决这个问题，我使用以下命令将我的所有文件暂存到提交。

```
$ git add .
$ git commit -m 'Your message here'
$ git push origin master 
```

我遇到的问题是 git add 中的 -u 命令实际上并没有添加新文件，并且我的 git 安装不支持 git add -A 命令。因此，正如在这个线程中提到的，我试图暂存的提交是空的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-23T22:20:39.063

看起来这个问题已经有很多答案了，但我会权衡我的，因为我还没有看到任何解决我遇到的问题的方法。

我在一个全新的 github 存储库上也遇到了这个错误。事实证明，我从中推送的用户没有推送访问权限。出于某种原因，这会导致“错误：找不到存储库”错误，而不是某种访问错误。

无论如何，我希望这可以帮助遇到同样问题的可怜的灵魂。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-16T05:49:41.290

我解决了我的问题....

不知道问题是什么，但使用 gitx 接口提交我的暂存文件，然后......

```
$ git push origin master 
```

**工作...**

我有同样的问题...

在 bort 模板文件中创建了一个新文件夹...

```
$ git commit -m 'first commit'

$ git remote add origin git@github.com:eltonstewart/band-of-strangers.git

$ git push origin master 
```

然后我得到同样的错误......

> 错误：src refspec master 不匹配任何内容。
> 致命：远程端意外挂断
> 错误：未能将一些参考资料推送到“git@github.com:eltonstewart/band-of-strangers.git”

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-04-25T06:34:39.810

```
cd  app 

git init 

git status 

touch  test 

git add . 

git commit  -a  -m"message to log " 

git commit  -a  -m "message to log" 

git remote add origin 

 git remote add origin git@git.google.net:cherry 

git push origin master:refs/heads/master

git clone git@git.google.net:cherry test1 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-05-26T20:07:43.703

一分钟前有同样的问题，然后修复它

在 github 中创建一个名为 wordpress 的存储库...

```
cd wordpress
git init
git add -A
git commit -am “WordPress 3.1.3″ or any message
git remote add origin git@github.com:{username}/wordpress.git
git push -u origin master 
```

这应该可以解决 refspec 问题

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-04T17:59:29.660

我有同样的问题。我错误地在小写的机器中创建了目录。一旦改变了案例，问题就解决了（但浪费了我的 1.5 小时 :( ）检查你的目录名称和远程 repo 名称是否相同。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-12-18T01:05:33.713

这也可能发生，因为 github 最近将默认分支从“master”重命名为“main”（[https://github.com/github/renaming](https://github.com/github/renaming)），所以如果你刚刚在 github 上创建了一个新的存储库，请使用`git push origin main`而不是`git push origin master`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-03-06T23:20:00.703

我错误地在 - 之后放了一个空格，所以我有 -m 而不是 -m 只是要寻找的东西。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-03-07T10:33:47.363

我认为在旧版本的 git 中，您应该首先提交至少一个文件，然后您可以再次“推送 origin master”。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-03-13T21:20:45.030

太好了..它的空目录问题只有别的。我通过在每个目录中创建一个二进制文件然后添加它们来解决我的问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-03-28T16:28:36.303

初始添加和提交就像一个魅力。我想这只是理解 Git 在存储库中管理项目的方法的问题。

之后，我设法毫不费力地立即推送我的数据。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-06-13T23:46:25.930

我刚刚遇到这个问题，这似乎是由于我**没有**在默认提交消息上方添加自定义提交消息引起的（我想，为什么要写“初始提交”，当它在 Git 生成的文本中清楚地说明了同样的事情时在它下面）。

当我删除 .git 目录、为 Git 重新初始化项目目录、重新添加 GitHub 远程、将所有文件添加到新阶段、在自动生成的消息上方使用个人消息提交并推送到时，问题解决了起源/主人。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-09-06T22:30:16.177

当您在 Github 上创建存储库时，它会将 README.md 文件添加到存储库中，并且由于该文件可能不在您的本地目录中，或者它可能具有不同的内容，所以 git push 会失败。为了解决我所做的问题：

```
git pull origin master
git push origin master 
```

这次它起作用了，因为我有 README.md 文件。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-10-10T16:35:37.150

在第一次提交之前，尝试添加一些文件，如 readme.txt。如果不存在，这将“强制”远程 repo 创建分支 master。它对我有用。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-02-16T13:03:42.153

这是一个非常古老的问题，但对于像我这样最终会来到这里的所有新人来说。此解决方案仅适用于

```
error: src refspec master does not match any. 
```

创建新仓库的错误

您需要添加您的

```
git config user.email "your email"
git config user.name "name" 
```

仅在添加电子邮件和名称后将文件添加到 git 并提交

```
git add .
git commit -m "message" 
```

它会像魅力一样工作

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-02-16T04:48:59.393

我也有这个错误，我提交了一个不推送空项目的承诺，就像很多人一样，但不起作用

问题是 ssl，你把下一个

> git config --system http.sslverify false

之后一切正常:)

> git push 起源大师

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-09-12T10:54:02.733

我遇到了同样的问题/错误。我正在做`git push -u origin master`而不是我刚刚做了`git push origin master`并且它起作用了。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-09-15T17:38:31.450

转到控制面板-> 管理您的凭据并删除 github 凭据（如果有）。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-07-07T20:29:56.413

撞旧线。

如果您在 Github 上使用 a`Readme`或 a创建了存储库`.gitignore`，则可能必须使用远程 master 重新定位本地 master。因为，如果您使用的是项目脚手架工具，例如 create-app，它会为您创建这些文件，并且远程 master 需要在您推送之前与您的本地同步。

如果您在 Github 上创建一个空存储库，那么您可以简单地推送。

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2015-02-24T08:53:36.437

我有同样的问题，一些用户已经回答了这个问题。在推送之前，您必须进行第一次提交。现在，对于新用户，我创建了一系列简单的步骤。在此之前，您需要安装 git 并在命令行中运行：

*   git config user.email “你的邮箱”
*   git config 用户名“名称”

创建远程仓库的步骤（我使用dropbox作为远程仓库）：

```
1\. create a directory in Dropbox (or on your remote server)
2\. go to the Dropbox dir (remote server dir)
3\. type git command: git init --bare
4\. on your local drive create your local directory
5\. go to local directory
6\. type git command: git init
7\. add initial files, by typing git command:: git add <filename> 
8\. type git command: git commit -a -m "initial version" (if you don't commit you can't do the initial push
9\. type git command: git remote add name <path to Dropbox/remote server> 
10\. git push name brach (for first commit the branch should be master) 
```

# windows - 在 Windows 中，如何比较两个文件并仅返回第二个文件中缺少的、最初存在于第一个文件中的记录？

> ID：827358
> 
> 赞同：2
> 
> 时间：2009-05-05T23:17:15.307
> 
> 标签：windows, perl, sorting, diff, batch-file

我们定期从外部来源接收 CSV 文件，我们几乎无法控制。这些文件是完整的当前记录集；但是，自上次以来已删除的任何记录都不存在。我们想比较这两个文件并创建一个单独的已删除记录文件，以便我们可以对它们进行一些额外的处理。在另一个领域的应用程序中，我们有一个开箱即用的商业排序包 (CoSort)；但是，我们在这里无权访问它。不过，卷并没有那么大，而且似乎这是标准或免费工具可以很容易地处理的东西。理想情况下，这将采用 Windows 批处理文件的形式，但 Perl 或 awk 解决方案也可以。示例输入文件：

上一个文件：

```
X_KEY,X_NAME,X_ATTRIBUTE
123,Name 123,ATT X
111,Name 111,ATT X
777,Name 777,ATT Y 
```

传入文件：

```
X_KEY,X_NAME,X_ATTRIBUTE
777,Name 777,ATT Y
123,Name 123,ATT CHANGED 
```

生成的文件至少应为：

```
111,Name 111 
```

但是，如果删除记录的属性也通过，那很好。

到目前为止，我有一个批处理文件，它使用免费软件 CMSort 对两个文件进行排序，减去标题记录，以使某些类型的 diff 过程更容易：

```
REM Sort Previous File, Skip Header

C:\Software\CMSort\cmsort.exe /H=1 x_previous.txt x_previous_sorted.txt

REM Sort Incoming File, Skip Header

G:\Software\CMSort\cmsort.exe /H=1 x_incoming.txt x_incoming_sorted.txt 
```

但是“比较并仅显示第一个文件中丢失的记录”位让我望而却步。部分复杂性是许多属性可以在留下的记录之间发生变化，因此它不是纯粹的差异。然而，它感觉就像一个专门的 diff 命令——仅限于检查关键字段，而不是整个记录。不过，我似乎无法使语法正确。想法？记录数不应超过 50k 记录。

注意：如果这是 SQL 并且数据位于表中，我们可以使用[EXCEPT 运算符](http://msdn.microsoft.com/en-us/library/ms188055.aspx)，但在这种情况下将数据移动到数据库不是一种选择。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T00:00:38.760

```
diff a.input b.input | grep ^[\>] 
```

[http://gnuwin32.sourceforge.net/packages/diffutils.htm](http://gnuwin32.sourceforge.net/packages/diffutils.htm)

[http://gnuwin32.sourceforge.net/packages/grep.htm](http://gnuwin32.sourceforge.net/packages/grep.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T23:40:22.550

如果我要在 perl 中执行此操作，我将只使用几个哈希值，

```
 #!/usr/bin/perl -w                                                                                                           
use strict;
use warnings;

my %orig; my %new; my %changed;

open(F1,"<$ARGV[0]")||die"Couldn't open $ARGV[0]: $!\n";
while(<F1>){
    chomp;
    @_ = split(/,/);
    $orig{$_[0]} = $_;
}
close(F1);

open(F2,"<$ARGV[1]")||die"Couldn't open $ARGV[1]: $!\n";
while(<F2>){
    chomp;
    @_ = split(/,/);
    if($orig{$_[0]}){
        if($orig{$_[0]} ne $_){
            $changed{$_[0]} = $orig{$_[0]}."||".$_;
        }
        delete $orig{$_[0]};
    }else{
        $new{$_[0]} = $_;
    }
}
close(F2);

print "Deleted:\n";
print map{$orig{$_}."\n"} sort {$b<=>$a} keys %orig;
print "Added:\n";
print map{$new{$_}."\n"} sort {$b<=>$a} keys %new;
print "Changed:\n";
print map{$changed{$_}."\n"} sort {$b<=>$a} keys %changed; 
```

假设您的文本示例在文件 f1.txt 和 f2.txt 中，

```
 kettle$ ./compare.pl f1.txt f2.txt

Deleted:
111,Name 111,ATT X
Added:
Changed:
123,Name 123,ATT X||123,Name 123,ATT CHANGED 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-05T23:41:27.230

```
#!/usr/bin/perl

use strict;
use warnings;

@ARGV == 2 or die "mycompare oldfile newfile\n";

my ($oldfile, $newfile) = @ARGV;

my %newrecords;

open my $new, '<', $newfile
    or die "Cannot open '$newfile':$!";

scalar <$new>; # skip header

while ( my $line = <$new> ) {
    next unless $line =~ /\S/;
    my ($record) = split /,/, $line;
    $newrecords{ $record } = 1;
}

close $new;

open my $old, '<', $oldfile
    or die "Cannot open '$oldfile': $!";

scalar <$old>; # skip header

while ( my $line = <$old> ) {
    next unless $line =~ /\S/;
    my ($record) = split /,/, $line;
    print $line unless exists $newrecords{ $record };
}

close $new;

__END__

C:Temp> mycompare old.csv new.csv
111,Name 111,ATT X 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T23:34:30.833

编写一个小型控制台应用程序并不难，它会遍历第一个文件，解析出键并检查第二个文件中与键匹配的行，然后创建第三个文件。我想我是说这似乎是一个很好的案例。:) 顺便说一下，这是一个 O(mn) 操作，其中 m，n 是文件 1 和文件 2 的大小，所以它可能不会很快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-05T23:51:36.423

我会使用`diff`，如果不能直接使用，请通过 cygwin 使用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T00:56:51.027

很久以前，我曾在一个略微相似的系统上工作过（事实上，令人痛苦的是接近 20 年前）。数据存储在数据库中，传入的数据必须与前一周的数据进行比较。数据中有74列数据，其中一些采用“上一个代码，上一个日期”对的形式（几个周期）。因此，一组合法的更改是：

```
Old:
name1:  value1        date1:  2000-01-01
name2:  value2        date2:  1995-05-31
name3:  value3        date3:  1990-10-13

New:
name1:  New Name      date1:  2009-03-31
name2:  Other Name    date2:  2005-04-12
name3:  value1        date3:  2000-01-01 
```

在这种情况下，“name1，date1”变成了“name3，date3”；似乎在过去某个时间发生了中间名称更改，以及最近的名称更改。有关名称更改的情报可能会延迟。找出以前的共同点和全新的东西是很困难的。确实，整个过程很棘手。

我实际上开发了一个双语自我再生程序来管理这些东西。源代码的顶部利用了主要语言 (Informix 4GL) 中的注释符号，它使用了 shell 样式的 #...eol 注释和 {...} 注释（后者能够分布在多行中。当然，这也是一个用于 I/O 重定向的 shell 构造。所以，我将生成 I4GL 代码的 shell 脚本嵌入到 { ... } 注释中，并且代码是从定义 70 的表中生成的+ 列以及如何处理每个列。随着时间的推移，这节省了很多打字时间。h

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T14:37:36.950

CPAN还提供了[Algorithm::Diff](http://search.cpan.org/perldoc?Algorithm::Diff)。

# html - 将每个 HTML 元素推开，不管它们的位置如何

> ID：827361
> 
> 赞同：1
> 
> 时间：2009-05-05T23:18:09.547
> 
> 标签：html, css

我正在开发一个应用程序，我们将应用程序的小部件插入网站正文的底部。我们这样做是为了固定小部件的位置，底部：0。无论您在网站的哪个位置，小部件都会持续存在；也就是说，它位于视口的底部。问题是小部件覆盖了网站底部的元素。

有什么方法可以将网站的内容向上推送，而不管其内容的定位（例如位置和浮动属性），这样我们的小部件将永远不会覆盖网站上的任何内容？由于小部件的“位置：固定”，它打破了正常布局，因此放置边距或填充顶部不会做任何事情。

我尝试了临时解决方案，在小部件本身之前添加一个 div，它是小部件的高度，因此它将所有东西都推到一边。但是，如果网站本身有浮动或底部定位的元素，无论如何这些都会被掩盖。

**更新：**感谢所有答案。最后，我几乎放弃了这项任务，因为它似乎是特定于站点的，并且该小部件旨在通过`<script>`. 我想我应该事先说的。

**更新 2：**最后一个答案解决了它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:23:42.107

您也许可以在 body 中添加一个 padding-bottom，它等于您的 position: fixed 元素的高度。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-22T02:50:38.423

在**jQuery**中：

```
$('html').height( $(document).height() + numerical_height_of_your_widget ); 
```

这基本上将 html 标记的高度设置为内容高度的总和（通过 jQuery 的神奇 $(document).height() 和任何位置的高度：您要添加的*固定*元素（在这种情况下，您的小部件）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:20:52.490

`<body>`您是否尝试过将小部件插入标签的最底部？它将位于页面底部，不需要位置：固定。它不会涵盖任何内容，因为它会遵循正常流程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-05T23:23:57.550

您必须继续使用 widged absolute 的定位，并为内容放置一个 div 并添加一个等于或大于 widged 高度的 margin-bottom。

我猜那会奏效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T00:02:12.373

创建一个与页面高度一致的空白边距：

```
<style>
#content {width: 80%;
          margin-left: 18%; /* to create a gutter between content and widget 
                               and to allow for borders and such */
}

#widget {width: 18%;
         position: fixed;
         bottom: 0;
         left: 0;
         padding: 0.5%;
         border-top: 1px solid #ccc;
         border-right: 1px solid #ccc;
}

</style>

...

<div id="content">

    <p>All of the branding, headers and content goes in this wrapper div.</p>

</div>

<div id="widget">

    <p>Widget goes here.</p>

</div>

... 
```

我认为应该工作。主要是因为它为小部件创建了一个滑入的列。注意：您可能需要允许小屏幕，因此可能创建一些不被推下的小部件的方法，或者至少接受一个优雅的弃用。

# wpf - 像 Visual Studio 选项卡一样样式化 WPF 选项卡

> ID：827363
> 
> 赞同：2
> 
> 时间：2009-05-05T23:20:18.777
> 
> 标签：wpf, tabs

在 WPF 中，是否可以将 WPF TabControl 设置为类似于 Visual Studio 中的样式？

而不是这个：（普通标签）

[![替代文字](https://i.stack.imgur.com/t5F7b.png)](https://i.stack.imgur.com/t5F7b.png)

我会更喜欢这个：（样式标签）

[![替代文字](https://i.stack.imgur.com/anMpF.png)](https://i.stack.imgur.com/anMpF.png)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T01:42:45.160

这绝对是可能的，通过使用 ControlTemplate。有关TabControl ControlTemplate 的示例，请参阅[此 MSDN 条目。](http://msdn.microsoft.com/en-us/library/ms754137.aspx)您可以以此为起点。祝你好运！

# delphi - 从 TcxDBColorCombobox 中删除系统颜色

> ID：827364
> 
> 赞同：1
> 
> 时间：2009-05-05T23:20:27.247
> 
> 标签：delphi, colors, devexpress, systemcolors

我有一个**TcxDBColorCombobox**并且我希望下拉列表不包括像 clBtnFace 这样的系统颜色**，**所以它只包括像**clRed**这样的颜色。此外，我希望它包含**clWindow**和**clWindowText**，但如有必要，我可以将它们添加为自定义颜色。该过程应该与**TcxColorCombobox**相同。我相信我最终会弄清楚的，但我想我会看看其他人是否有经验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:25:35.643

```
Properties.PrepareList := cxplHTML4; 
```

# javascript - 在 JavaScript 中使用 URL 的 GET 参数

> ID：827368
> 
> 赞同：43
> 
> 时间：2009-05-05T23:22:32.483
> 
> 标签：javascript, url, get

如果我在一个页面上，例如

[http://somesite.com/somepage.php?param1=asdf](http://somesite.com/somepage.php?param1=asdf)

在该页面的 JavaScript 中，我想为 URL 的 GET 部分中的参数值设置一个变量。

所以在 JavaScript 中：

```
<script>
   param1var = ...   // ... would be replaced with the code to get asdf from URI
</script> 
```

会是什么？

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-05-05T23:25:18.017

这是一些**[示例代码](http://www.zrinity.com/developers/code_samples/code.cfm/CodeID/59/JavaScript/Get_Query_String_variables_in_JavaScript)**。

```
<script>
var param1var = getQueryVariable("param1");

function getQueryVariable(variable) {
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
    if (pair[0] == variable) {
      return pair[1];
    }
  } 
  alert('Query Variable ' + variable + ' not found');
}
</script> 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-05T23:30:50.000

您可以获得位置对象的“搜索”部分 - 然后将其解析出来。

```
var matches = /param1=([^&#=]*)/.exec(window.location.search);
var param1 = matches[1]; 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-04-25T11:20:05.477

我做了这个 gnarf 解决方案的变体，所以调用和结果类似于 PHP：

```
function S_GET(id){
    var a = new RegExp(id+"=([^&#=]*)");
    return decodeURIComponent(a.exec(window.location.search)[1]);
} 
```

但是由于在函数中调用会减慢进程，因此最好将其用作全局：

`window['`*var_name* `'] = decodeURIComponent( /`*var_in_get*`=([^&#=]*)/.exec(window.location.search)[1] );`

**更新**

由于我仍在学习 JS，因此我在更多的 JS 行为中创建了一个更好的答案：

```
Url = {
    get get(){
        var vars= {};
        if(window.location.search.length!==0)
            window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value){
                key=decodeURIComponent(key);
                if(typeof vars[key]==="undefined") {vars[key]= decodeURIComponent(value);}
                else {vars[key]= [].concat(vars[key], decodeURIComponent(value));}
            });
        return vars;
    }
}; 
```

这允许仅使用`Url.get`.

*示例* url`?param1=param1Value&param2=param2Value` 可以这样调用：

```
Url.get.param1 //"param1Value"
Url.get.param2 //"param2Value" 
```

这是一个片段：

```
// URL GET params
url = "?a=2&a=3&b=2&a=4";

Url = {
    get get(){
        var vars= {};
        if(url.length!==0)
            url.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value){
                key=decodeURIComponent(key);
                if(typeof vars[key]==="undefined") {vars[key]= decodeURIComponent(value);}
                else {vars[key]= [].concat(vars[key], decodeURIComponent(value));}
            });
        return vars;
    }
};

document.querySelector('log').innerHTML = JSON.stringify(Url.get);
```

```
<log></log>
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-05T23:30:39.937

从我的编程档案中：

```
function querystring(key) {
   var re=new RegExp('(?:\\?|&)'+key+'=(.*?)(?=&|$)','gi');
   var r=[], m;
   while ((m=re.exec(document.location.search)) != null) r[r.length]=m[1];
   return r;
} 
```

如果该值不存在，则返回一个空数组。
如果值存在，则返回一个数组，其中包含一项，即值。
如果存在同名的多个值，则返回一个包含每个值的数组。

例子：

```
var param1var = querystring("param1")[0];

document.write(querystring("name"));

if (querystring('id')=='42') alert('We apoligize for the inconvenience.');

if (querystring('button').length>0) alert(querystring('info')); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-28T09:56:46.563

这是您可以在 Coffee Script 中执行此操作的方法（如果有人感兴趣的话）。

```
decodeURIComponent( v.split( "=" )[1] ) if decodeURIComponent( v.split( "=" )[0] ) == name for v in window.location.search.substring( 1 ).split( "&" ) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-09T00:40:31.190

**编辑：** *不要这样做我决定把它留在这里作为你不应该做的一个例子*

实际上，您不需要做任何特别的事情。您可以将 JavaScript 和 PHP 混合在一起，将 PHP 中的变量直接导入 JavaScript。

```
var param1val = '<?php echo $_GET['param1'] ?>'; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T23:25:06.143

使用jQuery？我以前用过这个： [http](http://projects.allmarkedup.com/jquery_url_parser/) ://projects.allmarkedup.com/jquery_url_parser/ 效果很好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-05T23:30:10.000

这看起来不错：

```
function gup( name ){
   name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
   var regexS = "[\\?&]"+name+"=([^&#]*)";
   var regex = new RegExp( regexS );
   var results = regex.exec( window.location.href );
   if( results == null )
      return "";
   else
      return results[1];
} 
```

来自[http://www.netlobo.com/url_query_string_javascript.html](http://www.netlobo.com/url_query_string_javascript.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-12-23T22:42:24.520

这是 JSLint 喜欢的一个版本：

```
/*jslint browser: true */
var GET = {};
(function (input) {
    'use strict';
    if (input.length > 1) {
        var param = input.slice(1).replace(/\+/g, ' ').split('&'),
            plength = param.length,
            tmp,
            p;

        for (p = 0; p < plength; p += 1) {
            tmp = param[p].split('=');
            GET[decodeURIComponent(tmp[0])] = decodeURIComponent(tmp[1]);
        }
    }
}(window.location.search));

window.alert(JSON.stringify(GET)); 
```

或者，如果您需要支持一个键的多个值，例如。?key=value1&key=value2 你可以使用这个：

```
/*jslint browser: true */
var GET = {};
(function (input) {
    'use strict';
    if (input.length > 1) {
        var params = input.slice(1).replace(/\+/g, ' ').split('&'),
            plength = params.length,
            tmp,
            key,
            val,
            obj,
            p;

        for (p = 0; p < plength; p += 1) {
            tmp = params[p].split('=');
            key = decodeURIComponent(tmp[0]);
            val = decodeURIComponent(tmp[1]);
            if (GET.hasOwnProperty(key)) {
                obj = GET[key];
                if (obj.constructor === Array) {
                    obj.push(val);
                } else {
                    GET[key] = [obj, val];
                }
            } else {
                GET[key] = val;
            }
        }
    }
}(window.location.search));

window.alert(JSON.stringify(GET)); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-03-31T21:35:26.857

你可以使用这个功能

```
function getParmFromUrl(url, parm) {
    var re = new RegExp(".*[?&]" + parm + "=([^&]+)(&|$)");
    var match = url.match(re);
    return(match ? match[1] : "");
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-06-18T17:01:40.440

如果您已经在运行一个 php 页面，那么

php位：

```
 $json   =   json_encode($_REQUEST, JSON_FORCE_OBJECT);
    print "<script>var getVars = $json;</script>"; 
```

js位：

```
 var param1var = getVars.param1var; 
```

但是对于 Html 页面，Jose Basilio 的解决方案对我来说看起来不错。

祝你好运！

# python - 有没有办法列出所有可用的 Windows 驱动器？

> ID：827371
> 
> 赞同：56
> 
> 时间：2009-05-05T23:23:47.177
> 
> 标签：python, windows

Python中有没有办法列出Windows系统中所有当前正在使用的驱动器号？

（我的 Google-fu 似乎让我失望了）

`C++`等效项：枚举 Windows 中所有可用的[驱动器号](https://stackoverflow.com/questions/286534/enumerating-all-available-drive-letters-in-windows)

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-05-05T23:32:57.327

```
import win32api

drives = win32api.GetLogicalDriveStrings()
drives = drives.split('\000')[:-1]
print drives 
```

改编自： http: [//www.faqts.com/knowledge_base/view.phtml/aid/4670](http://www.faqts.com/knowledge_base/view.phtml/aid/4670)

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2009-05-05T23:33:19.557

如果这对您很重要，则无需使用任何外部库：

```
import string
from ctypes import windll

def get_drives():
    drives = []
    bitmask = windll.kernel32.GetLogicalDrives()
    for letter in string.uppercase:
        if bitmask & 1:
            drives.append(letter)
        bitmask >>= 1

    return drives

if __name__ == '__main__':
    print get_drives()     # On my PC, this prints ['A', 'C', 'D', 'F', 'H'] 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2015-12-09T19:26:32.163

在谷歌上找到了这个解决方案，对原来的稍作修改。看起来很pythonic，不需要任何“异国情调”的进口

```
import os, string
available_drives = ['%s:' % d for d in string.ascii_uppercase if os.path.exists('%s:' % d)] 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-05-06T00:05:22.383

这些看起来像更好的答案。这是我的hackish cruft

```
import os, re
re.findall(r"[A-Z]+:.*$",os.popen("mountvol /").read(),re.MULTILINE) 
```

对[RichieHindle](https://stackoverflow.com/a/827398/65696)的回答稍作评论；它并不是真的更好，但你可以让 Windows 来完成提出实际字母的工作

```
>>> import ctypes
>>> buff_size = ctypes.windll.kernel32.GetLogicalDriveStringsW(0,None)
>>> buff = ctypes.create_string_buffer(buff_size*2)
>>> ctypes.windll.kernel32.GetLogicalDriveStringsW(buff_size,buff)
8
>>> filter(None, buff.raw.decode('utf-16-le').split(u'\0'))
[u'C:\\', u'D:\\'] 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-06-11T08:14:47.757

我写了这段代码：

```
import os
drives = [ chr(x) + ":" for x in range(65,91) if os.path.exists(chr(x) + ":") ] 
```

它基于@Barmaley 的回答，但具有不使用该`string` 模块的优点，以防您不想使用它。它也适用于我的系统，与@SingleNegationElimination 的回答不同。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-05-06T00:10:02.450

[Microsoft Script Repository](https://gallery.technet.microsoft.com/ScriptCenter/?persist=True)包含这个可能会有所帮助的[秘诀。](https://gallery.technet.microsoft.com/scriptcenter/488836b0-84e9-4c0c-b2cf-dd19f6e70f74)不过，我没有 Windows 机器来测试它，所以我不确定您是否想要“名称”、“系统名称”、“卷名”或其他名称。

```
import win32com.client 
strComputer = "." 
objWMIService = win32com.client.Dispatch("WbemScripting.SWbemLocator") 
objSWbemServices = objWMIService.ConnectServer(strComputer,"root\cimv2") 
colItems = objSWbemServices.ExecQuery("Select * from Win32_LogicalDisk") 
for objItem in colItems: 
    print "Access: ", objItem.Access 
    print "Availability: ", objItem.Availability 
    print "Block Size: ", objItem.BlockSize 
    print "Caption: ", objItem.Caption 
    print "Compressed: ", objItem.Compressed 
    print "Config Manager Error Code: ", objItem.ConfigManagerErrorCode 
    print "Config Manager User Config: ", objItem.ConfigManagerUserConfig 
    print "Creation Class Name: ", objItem.CreationClassName 
    print "Description: ", objItem.Description 
    print "Device ID: ", objItem.DeviceID 
    print "Drive Type: ", objItem.DriveType 
    print "Error Cleared: ", objItem.ErrorCleared 
    print "Error Description: ", objItem.ErrorDescription 
    print "Error Methodology: ", objItem.ErrorMethodology 
    print "File System: ", objItem.FileSystem 
    print "Free Space: ", objItem.FreeSpace 
    print "Install Date: ", objItem.InstallDate 
    print "Last Error Code: ", objItem.LastErrorCode 
    print "Maximum Component Length: ", objItem.MaximumComponentLength 
    print "Media Type: ", objItem.MediaType 
    print "Name: ", objItem.Name 
    print "Number Of Blocks: ", objItem.NumberOfBlocks 
    print "PNP Device ID: ", objItem.PNPDeviceID 
    z = objItem.PowerManagementCapabilities 
    if z is None: 
        a = 1 
    else: 
        for x in z: 
            print "Power Management Capabilities: ", x 
    print "Power Management Supported: ", objItem.PowerManagementSupported 
    print "Provider Name: ", objItem.ProviderName 
    print "Purpose: ", objItem.Purpose 
    print "Quotas Disabled: ", objItem.QuotasDisabled 
    print "Quotas Incomplete: ", objItem.QuotasIncomplete 
    print "Quotas Rebuilding: ", objItem.QuotasRebuilding 
    print "Size: ", objItem.Size 
    print "Status: ", objItem.Status 
    print "Status Info: ", objItem.StatusInfo 
    print "Supports Disk Quotas: ", objItem.SupportsDiskQuotas 
    print "Supports File-Based Compression: ", objItem.SupportsFileBasedCompression 
    print "System Creation Class Name: ", objItem.SystemCreationClassName 
    print "System Name: ", objItem.SystemName 
    print "Volume Dirty: ", objItem.VolumeDirty 
    print "Volume Name: ", objItem.VolumeName 
    print "Volume Serial Number: ", objItem.VolumeSerialNumber 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2018-12-04T06:58:59.427

如果您只想列出磁盘上的驱动器而不是映射的网络驱动器，这是另一个很好的解决方案。如果您想按不同的属性进行过滤，只需打印 drps。

```
import psutil
drps = psutil.disk_partitions()
drives = [dp.device for dp in drps if dp.fstype == 'NTFS'] 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-09-08T07:00:49.087

在 Windows 上，您可以执行 os.popen

```
import os
print os.popen("fsutil fsinfo drives").readlines() 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-07-26T07:54:16.743

基于@RichieHindle 的更优解决方案

```
def get_drives():
    drives = []
    bitmask = windll.kernel32.GetLogicalDrives()
    letter = ord('A')
    while bitmask > 0:
        if bitmask & 1:
            drives.append(chr(letter) + ':\\')
        bitmask >>= 1
        letter += 1

    return drives 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-11-25T17:15:32.857

这是一个更简单的版本，没有安装任何额外的模块或任何功能。由于驱动器号不能超出 A 和 Z，因此您可以搜索每个字母表是否有可用路径，如下所示：

```
>>> import os
>>> for drive_letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ':
        if os.path.exists(f'{drive_letter}:'):
            print(f'{drive_letter}:')
        else:
            pass 
```

单线：

```
>>> import os
>>> [f'{d}:' for d in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' if os.path.exists(f'{d}:')]
['C:', 'D:'] 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-11-28T03:17:47.270

这是我的高性能方法（可能更高）：

```
>>> from string import ascii_uppercase
>>> reverse_alphabet = ascii_uppercase[::-1]
>>> from ctypes import windll # Windows only
>>> GLD = windll.kernel32.GetLogicalDisk
>>> drives = ['%s:/'%reverse_alphabet[i] for i,v in enumerate(bin(GLD())[2:]) if v=='1'] 
```

没有人真正使用 python 的执行功能......

是的，我没有遵循 Windows 标准路径约定（'\\'）......
在我使用 python 的所有岁月中，我在任何使用路径的地方都没有遇到任何问题，并且在我的程式。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-06-04T01:06:33.983

此代码将返回驱动器名称和字母列表，例如：

['Gateway(C:)', 'EOS_DIGITAL(L:)', 'Music Archive(O:)']

它只使用标准库。它建立在我上面发现的一些想法之上。如果磁盘驱动器是空的，windll.kernel32.GetVolumeInformationW() 返回 0，例如没有磁盘的 CD rom。此代码未列出这些空驱动器。

这 2 行捕获所有驱动器的字母：

```
bitmask = (bin(windll.kernel32.GetLogicalDrives())[2:])[::-1]  # strip off leading 0b and reverse
drive_letters = [ascii_uppercase[i] + ':/' for i, v in enumerate(bitmask) if v == '1'] 
```

这是完整的例程：

```
from ctypes import windll, create_unicode_buffer, c_wchar_p, sizeof
from string import ascii_uppercase

def get_win_drive_names():
    volumeNameBuffer = create_unicode_buffer(1024)
    fileSystemNameBuffer = create_unicode_buffer(1024)
    serial_number = None
    max_component_length = None
    file_system_flags = None
    drive_names = []
    #  Get the drive letters, then use the letters to get the drive names
    bitmask = (bin(windll.kernel32.GetLogicalDrives())[2:])[::-1]  # strip off leading 0b and reverse
    drive_letters = [ascii_uppercase[i] + ':/' for i, v in enumerate(bitmask) if v == '1']

    for d in drive_letters:
        rc = windll.kernel32.GetVolumeInformationW(c_wchar_p(d), volumeNameBuffer, sizeof(volumeNameBuffer),
                                                   serial_number, max_component_length, file_system_flags,
                                                   fileSystemNameBuffer, sizeof(fileSystemNameBuffer))
        if rc:
            drive_names.append(f'{volumeNameBuffer.value}({d[:2]})')  # disk_name(C:)
    return drive_names 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-07-08T16:55:12.730

这将有助于在 Windows 操作系统中找到有效的驱动器

```
import os
import string
drive = string.ascii_uppercase
valid_drives = []
for each_drive in drive:
    if os.path.exist(each_drive+":\\"):
       print(each_drive)
       valid_drives.append(each_drive+":\\")
print(valid_drives) 
```

输出将是

```
C
D
E
['C:\\','D:\\','E:\\'] 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-05-02T15:23:21.803

由于我的笔记本领域没有安装 win32api，因此我使用 wmic 使用了此解决方案：

```
import subprocess
import string

#define alphabet
alphabet = []
for i in string.ascii_uppercase:
    alphabet.append(i + ':')

#get letters that are mounted somewhere
mounted_letters = subprocess.Popen("wmic logicaldisk get name", shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
#erase mounted letters from alphabet in nested loop
for line in mounted_letters.stdout.readlines():
    if "Name" in line:
        continue
    for letter in alphabet:
        if letter in line:
            print 'Deleting letter %s from free alphabet %s' % letter
            alphabet.pop(alphabet.index(letter))

print alphabet 
```

或者，您可以像这个更简单的解决方案一样从两个列表中获得差异（在将 wmic 子进程作为mounted_letters 启动之后）：

```
#get output to list
mounted_letters_list = []
for line in mounted_letters.stdout.readlines():
    if "Name" in line:
        continue
    mounted_letters_list.append(line.strip())

rest = list(set(alphabet) - set(mounted_letters_list))
rest.sort()
print rest 
```

两种解决方案都同样快，但我想 set list 出于某种原因更好，对吧？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-09-09T19:49:42.710

作为类似任务的一部分，我还需要获取一个空闲驱动器号。我决定我想要最高可用的字母。我首先用更惯用的方式把它写出来，然后把它压缩成一个 1-liner，看看它是否仍然有意义。与列表推导一样棒的是，我喜欢这样的集合： `unused=set(alphabet)-set(used)`而不是必须做`unused = [a for a in aphabet if a not in used]`. 酷的东西！

```
def get_used_drive_letters():
    drives = win32api.GetLogicalDriveStrings()
    drives = drives.split('\000')[:-1]
    letters = [d[0] for d in drives]
    return letters

def get_unused_drive_letters():
    alphabet = map(chr, range(ord('A'), ord('Z')+1))
    used = get_used_drive_letters()
    unused = list(set(alphabet)-set(used))
    return unused

def get_highest_unused_drive_letter():
    unused = get_unused_drive_letters()
    highest = list(reversed(sorted(unused)))[0]
    return highest 
```

一个班轮：

```
def get_drive():
    highest = sorted(list(set(map(chr, range(ord('A'), ord('Z')+1))) -
                          set(win32api.GetLogicalDriveStrings().split(':\\\000')[:-1])))[-1] 
```

我还选择了使用 map/range/ord/chr 而不是使用字符串的字母表，因为部分字符串已被弃用。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-03-11T11:34:21.470

如果您不想担心跨平台问题，包括跨 Python 平台（如 Pypy）的问题，并且希望在运行时更新驱动器时使用一些具有良好性能的东西：

```
>>> from os.path import exists
>>> from sys import platform
>>> drives = ''.join( l for l in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' if exists('%s:/'%l) ) if platform=='win32' else ''
>>> drives
'CZ' 
```

这是我对这段代码的性能测试：

```
4000 iterations; threshold of min + 250ns:
__________________________________________________________________________________________________________code___|_______min______|_______max______|_______avg______|_efficiency
⡇⠀⠀⢀⠀⠀⠀⠀⠀⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⣷⣷⣶⣼⣶⣴⣴⣤⣤⣧⣤⣤⣠⣠⣤⣤⣶⣤⣤⣄⣠⣦⣤⣠⣤⣤⣤⣤⣄⣠⣤⣠⣤⣤⣠⣤⣤⣤⣤⣤⣤⣄⣤⣤⣄⣤⣄⣤⣠⣀⣀⣤⣄⣤⢀⣀⢀⣠⣠⣀⣀⣤⣀⣠
    drives = ''.join( l for l in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' if exists('%s:/'%l) ) if platform=='win32' else '' |      290.049ns |     1975.975ns |      349.911ns |  82.892% 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-09-19T20:55:52.670

如果您只想要每个驱动器的字母，您可以：

```
from win32.win32api import GetLogicalDriveStrings

drives = [drive for drive in GetLogicalDriveStrings()[0]] 
```

# windows-mobile - System.Drawing.Imaging.ColorMap 等效于 .NET Compact Framework

> ID：827372
> 
> 赞同：1
> 
> 时间：2009-05-05T23:23:54.587
> 
> 标签：windows-mobile, compact-framework, system.drawing

我需要在 .NET Compact Framework 中使用 ColorMap 对象，但据我所知它不可用。

需要一些关于如何最好地解决此限制的想法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-22T15:34:36.030

在msdn论坛中讨论过（我现在还不允许添加链接，但是你可以在网上很容易地找到它）.net紧凑框架不支持这个类。建议改用手动重新着色或使用 Reflector 从 .net 框架获取 ColorMap 代码并将其用于您的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-29T21:43:00.630

本机 IBitmapImage 对象确实有一个 get/setpalette 方法，但我不知道这是否是您正在寻找的。

请参阅：http: [//msdn.microsoft.com/en-us/library/aa911323 (v=MSDN.10).aspx](http://msdn.microsoft.com/en-us/library/aa911323(v=MSDN.10).aspx)

# django - 如何使用 OR 运算符创建与 SQL 查询等效的 Django 查询集？

> ID：827384
> 
> 赞同：6
> 
> 时间：2009-05-05T23:28:02.190
> 
> 标签：django, django-models

在 Django 中，我知道使用`filter`多个参数会被翻译成 SQL`AND`子句。来自 Django 书：

> 您可以将多个参数传递给 filter() 以进一步缩小范围：
> 
> ```
> >>> Publisher.objects.filter(country="U.S.A.", state_province="CA")
> [<Publisher: Apress>] 
> ```
> 
> 这些多个参数被翻译成 SQL AND 子句。因此，代码片段中的示例转换为以下内容：
> 
> ```
> SELECT id, name, address, city, state_province, country, website
> FROM books_publisher
> WHERE country = 'U.S.A.'
> AND state_province = 'CA'; 
> ```

如何创建一个被翻译成 SQL`OR`子句的 Django 查询集？例如：

```
SELECT id, name, address, city, state_province, country, website
FROM books_publisher
WHERE state_province = 'AZ'
OR state_province = 'CA'; 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-05T23:32:05.583

使用 django.db.models 中可用的 Q 运算符

IE：

```
from django.db.models import Q
Publisher.objects.filter(Q(state_province="CA") | Q(state_province="AZ")) 
```

在这里查看文档：http: [//docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects](http://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects)

# c++ - C++ 中 bool 的默认值

> ID：827393
> 
> 赞同：14
> 
> 时间：2009-05-05T23:31:53.633
> 
> 标签：c++, boolean

我正在用 C++ 重新设计一个类构造函数，并需要它来捕获一个未指定的布尔值。我对所有其他参数都使用了默认值，但据我了解，布尔只能初始化为真或假。由于这两种情况在课堂上都有意义，我应该如何处理检查默认值的变化？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-05T23:40:59.010

现实是你不能这样做。布尔值具有真或假的值，如果您没有初始化它，那么它是随机的真或假，在程序的每次运行或该类的分配中可能不同。

如果您需要具有更多选项的类型，请定义一个枚举。

```
typedef enum MyBool {
    TRUE,
    FALSE,
    FILENOTFOUND
} MyBool; 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-06T08:33:50.723

*三态布尔是通往黑暗面的道路。三态布尔会导致愤怒。愤怒导致仇恨。仇恨导致痛苦。*

* * *

**最好不要使用三态布尔值。**

相反，使用一个额外的布尔值来判断第一个布尔值是否“已初始化”（或者更好的是，“已知”）。

```
class Prisoner : public Person
{

  ...

  bool is_veredict_known;
  bool is_guilty;
} 
```

如果判决还不知道，您无法判断 Prisoner 是否真的有罪，但您的代码可以区分不同的情况。当然，宪法保证 is_guilty 的默认值应该是假的，但是，仍然...... :)

顺便说一句，类不变量应该包括：

```
assert(is_veredict_known || !is_guilty); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-05T23:39:03.320

听起来你想要[boost::tribool](http://www.boost.org/doc/libs/1_39_0/doc/html/tribool.html)或者[boost::optional<bool>](http://www.boost.org/doc/libs/1_39_0/libs/optional/doc/html/boost_optional/a_note_about_optional_bool_.html)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-05T23:36:30.657

如果这就是您所需要的，请创建一个表示可能尚未初始化的值的概念的值。

```
template <typename T>
struct Maybe {
  Maybe() : m_hasValue(false) {}
  bool HasValue() const { return m_hasValue; }
  T& Value() { ThrowIfFalse(m_hasValue); return m_value; }
  const T& Value() const { ThrowIfFalse(m_hasValue); return m_value; }
  void SetValue( _In_ const T& value) { m_value = value; m_hasValue = true; }
private:
  bool m_hasValue;
  T m_value;
}; 
```

现在你可以代表你需要的所有 3 个状态。

```
class SomeType { 
  ...
  Maybe<bool> m_myBool;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-05T23:38:11.933

在 C++ 中，a`bool`只是一位信息，要么是 0，要么是 1。由于要表示三种可能的状态，因此还需要一位信息。有两种通用技术：

1.  使用另一个`bool`值来指示该值是否为“默认”，或者
2.  使用具有三个值的枚举类型来指示（默认、真、假）。

我可能会选择选项1。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-11-22T15:21:14.343

使用巨大的 boost::optional。不仅对于布尔值，而且对于您使用了一些脏的未初始化值的所有其他地方。它的使用如下：

```
void function(optional<int> value) {
   if (value)
      std::cout << "value is defined: " << value.get() << "\n";
   else
      std::cout << "value is not defined\n";
} 
```

这是一个返回可选的函数示例：

```
struct MapClass {
   map<string,int> m_map;

   optional<int> getValue(string key) {
      optional<int> result = none;
      if (m_map.find(key) != m_map.end())
         result = m_map[key];
      return result;
   }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-09-02T22:29:50.737

```
struct Bool { //guaranteed initialized bool
    bool v;

    Bool() : v(false) {}
    operator bool() const { return v; }
    bool& operator=(const bool val){ return v = val; }
}; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-05T23:37:51.230

您可以有一个单独的私有成员来指示 bool 值是否已实际初始化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-05T23:37:05.103

我不是很明白，但我会尝试...

当您有一个未指定某些值的聚合初始值设定项时，将应用默认值。在这种情况下，bool 的默认值为 false。在一个类中，“默认”值将是未初始化的，这意味着它可以是任何值，并且可以从运行到运行更改。

如果您对 bool 是否已更改感兴趣，最好的选择是使用默认为 false 的第二个 bool 来跟踪它，或者使用表示 3 种可能状态的枚举。如果你真的想要 3 个状态，你真的不想要一个布尔值。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-06T13:42:14.370

你真的不能。您能否提供第二个构造函数，例如：

```
class MyClass {
  public:
    MyClass(bool bFlag); // <-- not default
    MyClass(void);       // <-- default
}; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-05T23:42:51.767

使用枚举代替布尔值。例如，控制魔法等级：

```
enum {
    MY_ENUM_NO_MAGIC,
    MY_ENUM_SOME_MAGIC,
    MY_ENUM_MORE_MAGIC
} MagicLevel; 
```

然后让你的构造函数接受一个参数`MagicLevel magic = MY_ENUM_NO_MAGIC`。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-22T15:28:56.873

```
class aclass
{
    <stuff> lots of other things
    bool mybool
    bool ismyboolinit

    void setmybool(bool b)
    {
        mybool = b;
        ismyboolinit = true;
    }

} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-10-07T18:03:15.297

好吧，如果您使用函数和类，只需重载它们。

IE：

```
 class thing
{
  public:
   void f1(bool); // bool input
   void f1(int = 3); // default with out bool being known
  private:
   // stuff
};     
void thing::f1 (bool hasAFace)
{
  if(hasAFace)
   f1(0);
  if(!hasAFace)
   f1(1);

}

void thing::f1 (int tri)
{
  bool actionTime;
  if(tri == 1)
    actionTime = true;
   else if(tri == 0)
    actionTime = false;
   else
    //input defualt action here.
} 
```

// 你去吧。此外，您不需要有一个可以只使用重载函数的类。

# asp.net-mvc - 使用 MVCContrib 网格进行编辑

> ID：827395
> 
> 赞同：12
> 
> 时间：2009-05-05T23:32:09.700
> 
> 标签：asp.net-mvc, mvccontrib

我刚开始在一个测试项目中使用 MVCContrib 网格。我很难找到有关如何使用它进行编辑/更新/删除的信息。

任何人都可以向我指出有关如何将行置于编辑模式的信息，或者如果该网格没有这样的东西，请讨论在 MVC 中编辑列表数据的最佳实践。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-16T16:23:56.753

您可以通过自定义单元格的呈现方式来添加编辑模式呈现。我正在使用以下扩展方法：

```
public static IGridColumn<T> Action<T>( this IGridColumn<T> column, Func<T, string> viewAction, Func<T, string> editAction, Func<T,bool> editMode )
{
   column.CustomItemRenderer = ( context, item ) => context.Writer.Write( "<td>" + ( editMode( item ) ? editAction( item ) : viewAction( item ) ) + "</td>" );
   return column;
} 
```

这允许您指定列在视图模式和编辑模式下的呈现方式。模式是使用第三个操作确定的，对于您要编辑的行，该操作应该评估为真。

在视图中使用它看起来像这样：

```
<%= Html.Grid( Model.Items ).Columns( column => {
     column.For( x => x.Name ).Action(
        item => Html.ActionLink( item.Name, "SomeAction" ), 
        item => Html.TextBox( "Item.Name", item.Name ),
        item => ( Model.SelectedItem == item ) );
    } )
    .Empty("No items found.")
%> 
```

您可以使用相同的模式在单元格中呈现操作链接（编辑、应用、取消等）。如果要一次编辑多行，请确保字段名称是唯一的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-06T00:18:11.977

看起来 MVCContrib 是一种从模型对象集合构造 HTML 表的简单方法。它似乎没有任何能力将一行置于类似于 WebForms GridView 的编辑/更新/删除“模式”。

但是，看起来您可以随心所欲地处理该功能。如果您想转到单独的页面进行编辑模式，只需将链接放在具有该行 ID 的列中。以下内容直接取自： http: [//www.jeremyskinner.co.uk/2009/03/01/mvccontrib-grid-part-5-the-action-syntax/](http://www.jeremyskinner.co.uk/2009/03/01/mvccontrib-grid-part-5-the-action-syntax/)

```
<% Html.Grid(Model).Columns(column => {
            column.For(x => x.Id).Named("Person ID");
            column.For(x => x.Name);
            column.For(x => x.Gender);
            column.For(x => x.DateOfBirth);
                column.For("View Person").Named("").Action(p => { %>
                     <td style="font-weight:bold">
                    <%= Html.ActionLink("View Person", "Show", new { id = p.Id })%>
                 </td>
                <% });
        }).RowStart((p,row)  => {     
             if (row.IsAlternate) { %>
                   <tr style="background-color:#CCDDCC">
             <%  }  else  { %>
                 <tr>
             <% }
    }).Render(); %> 
```

在这里，他们似乎想要将用户定向到 View Person 页面：`<%= Html.ActionLink("View Person", "Show", new { id = p.Id })%>`。

祝你好运，编码愉快。

# gtk - 哪个是 GTK 应用程序的最佳 GUI 设计器？

> ID：827396
> 
> 赞同：12
> 
> 时间：2009-05-05T23:32:17.703
> 
> 标签：gtk, gui-designer

我想要一个可视化的 GUI 设计器，它会以 GtkBuilder 使用的格式生成 XML 输出。Glade 似乎是最强大的，尽管 Gazpacho 更轻量级。Stetic（包含在 MonoDevelop 中）似乎不错，但我不相信它支持 GtkBuilder。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-05T23:40:25.407

上次我尝试使用 Gazpacho 时——诚然，几个月前，所以它可能有所改进——它几乎无法使用。不断崩溃[1]，无法设置一些重要的小部件属性，最重要的是，无法加载其最终输出。我最终只使用 Glade，保存到 .glade 文件，然后手动转换为 GtkBuilder。我听说 Glade 的 GtkBuilder 输出在最近的版本中更好，所以你可以跳过第二步和第三步。

如果您决定使用 Glade，请确保使用 Glade 3——它比旧版本好得多。

[1] 是的，我知道它是用 Python 编写的。不，我不知道他们是如何成功开发出如此不稳定的 Python 应用程序的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-05T23:40:17.293

我一直使用 Glade，很好的 XML 输出。虽然我最近没有做很多，所以也许现在有更好的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-28T20:36:22.330

你可以试试 Glade + [kiwi-gtk](https://pypi.python.org/pypi/kiwi-gtk)。它非常快！如果您对 gtk 和 kiwi 有疑问，请在[twitter](https://twitter.com/MarceloMaiaa)上给我发一个收件箱。

# business-logic - 我应该将我的 SqlDataReader 代码放在哪个部分？

> ID：827401
> 
> 赞同：0
> 
> 时间：2009-05-05T23:34:31.537
> 
> 标签：business-logic, data-access-layer

我对 c# 相当陌生，正在尝试编写一个 n 层 Web 应用程序。为了确保我将逻辑和代码放在正确的位置，我只是有一个关于将代码放在哪里的问题。

我有三个主要部分：

1.  DataAccess 代码 - 在我的 App_Code 文件夹中名为“BusinessLogic”的文件夹中。

2.  业务逻辑代码 - 在我的 App_Code 文件夹中名为“DataAccess”的文件夹中。

3.  表示层 - 所有的 UI

例如，如果我需要编写一个 SqlDataReader 来从我的数据库中检索记录，我将在哪里实际编写代码？在 BLL 或 DAL 中？

IE 从表示层我调用 BLL 代码。

```
ContentBLL content = new ContentBLL();
//some code to call the BLL layer... 
```

这是我开始感到困惑的地方。在我调用的业务层逻辑层中，我是在此处编写 SqlDataReader 代码，还是再创建一个步骤并在数据访问级别编写 SQlDataReader 代码。

IE 在 BLL 中我应该添加一个名为 DAL 的方法吗？例如

```
public static ContentBLL GetPageContent(intID)
{
return ContentDAL.GetItem(ID)
} 
```

然后在我的 DAL 中，我有一种方法来执行实际的 SqlDataReader EG

```
public static ContentBLL GetItem(int id)
{
//return the SqlDataReader code...
} 
```

我一直在尝试从 asp.net 网站上的教程中学习，但是对于教程中的 DAL，他们使用数据集代替。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:40:57.557

我的典型方法是我开玩笑地称之为 2.5 层方法。

在这种方法中，我使用以下方法：

```
 Presentation Layer

                Businesss Object Layer / Data Serialization

                Database Service Layer 
```

业务层中的每个业务对象都有一个接受 IDataReader 的构造函数。然后读取此读取器以填充对象。

数据库层包含所有数据库访问请求并返回阅读器。

虽然这不像某些人想要的那样纯粹，但替代方法是制作愚蠢的容器类来编组层之间的数据，我更喜欢只使用 IDataReader。

此外，通过使用 IDataReader 而不是 SqlDataReader，我仍然与我的 DAL 松散耦合，并且可以实现任何形式的持久性，而不仅仅是 SQLServer。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T23:42:19.817

在我看来，这听起来像是过度设计的经典案例。

我不会争辩在学习阶段需要一点过度设计的事实，但我认为如果在任何时候它会产生更多的混乱，你需要退后一步并重新考虑你的方法。

尝试更多地了解 ASP.NET，不要对语义过于紧张。如果您保持开放的心态并允许重构您的代码，您可能能够自己给出问题的答案。

# asp.net-mvc - ASP.NET MVC 分页 - 将复杂类型传递回控制器？

> ID：827408
> 
> 赞同：1
> 
> 时间：2009-05-05T23:38:07.987
> 
> 标签：asp.net-mvc, paging

我目前正在开发一个相当简单的 MVC 应用程序，它允许用户输入一些搜索数据，获取结果列表，然后查看每个项目等。一切进展顺利，但是我现在正在尝试实现分页但是有一些麻烦。

我的搜索表单使用 HTTP GET，请求执行以下操作：

```
public ActionResult Results(PropertySearchData data, int? page)
{
    ...
    IEnumerable<Property> search = mService.SearchProperties(data);

    ViewData["SearchData"] = data;
    return View("Results", "Site", search.ToPagedList(page ?? 0, 20));
    ...
} 
```

从这里我从传递到我的视图中的 IEnumerable 集合中构建我的结果表。此外，我使用 ViewData 保存搜索参数，以便在用户请求不同页面时传递它们。

例如，要进入第一页，我想使用如下内容：

```
Html.ActionLink("First", "Results", new { data = ViewData["SearchData"], page = 1 }) 
```

但是，当这个链接生成时，我的链接是沿着

```
/Results?data=PropertySearchData&page=1 
```

如果我完全删除 'page' 参数，并将 ViewData["SearchData"] 作为我的路由值传递，我的链接会按照我的意愿生成（即 PropertySearchData 的每个成员都作为查询字符串通过模型绑定传递功能。我猜这是因为模型绑定只有在您指定单一类型时才能正常工作？

我可以看到为什么这不起作用的几个原因；我遇到的麻烦是想出一种“好”的方式来做我想做的事情。我知道我在这里一定缺乏重要的理解，所以如果我能得到一些关于如何解决这个问题的指示，将不胜感激。

请注意，我真的想坚持使用 HTTP GET（因为这是一个搜索结果页面）。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:48:22.970

因为`data`or`ViewData["SearchData"]`是`PropertySearchData`我猜测的实例，它`Html.ActionLink`正在调用`ToString()`它并且没有给出您期望的结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T00:01:39.630

问题是辅助方法只是尽力从你给它的东西中生成一些东西，这是一个具有两个属性的对象：数据和页面。

要获取页码，您可以使用路由值字典（这可能是在后台完成的操作）并使用接受 IDictionary 的覆盖：-

```
//In some HtmlHelper extension method or something 
var searchCriteria = new RouteValueDictionary(ViewData["searchData"]);
searchCriteria.Add("page", 1);

return Html.ActionLink("First", "Results", searchCriteria) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T23:13:30.133

创建 HtmlHelper 扩展方法不是解决此问题的最佳方法。它不会添加一般功能，只会增加更多（视觉）混乱......

Html.ActionLink 的 routeValues 重载需要一个对象或 RouteValueCollection (IDictionary)。您现在正在使用对象重载（因为新的 {} 构造函数是一个匿名对象）。

您可以使用以下内容创建正确的 routeValues 参数：

```
new RouteValueCollection(ViewData["SearchData"]) { { "page", 1 } } 
```

这将使用当前搜索数据初始化一个新的 RouteValueCollection，然后使用新值添加“页面”键（如果它存在于搜索数据中，则覆盖）。

# sharepoint - 为什么我的自定义 ContentType 功能在激活时出错？

> ID：827414
> 
> 赞同：1
> 
> 时间：2009-05-05T23:39:14.630
> 
> 标签：sharepoint, content-type

我正在为 SharePoint 2007 创建一个自定义 ContentType 作为网站集范围内的功能。当我尝试激活该功能时，我得到一个只有这个线索的错误页面：“值不在预期范围内”

这是我的 XML 文件 feature.xml：

```
<?xml version="1.0" encoding="utf-8"?>
<!--Created by STSDEV at 5/5/2009 5:11:40 PM-->
<Feature
  Id="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
  Title="Custom Document Content Type"
  Description="Custom Document Content Type"
  Version="1.0.0.0"
  Scope="Site"
  Hidden="false"
  ImageUrl="CustomDocumentContentType\Image.gif" 
  xmlns="http://schemas.microsoft.com/sharepoint/">
  <ElementManifests>
    <ElementManifest
      Location="CustomDocumentContentType.xml" />
  </ElementManifests>
</Feature> 
```

和 CustomDocumentContentType.xml：

```
<!--<?xml version="1.0" encoding="utf-8"?>-->
<!--Created by STSDEV at 5/5/2009 5:11:40 PM-->
<Elements xmlns="http://schemas.microsoft.com/sharepoint/">
   <ContentType ID="0X010100YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY"
               Name="Custom Document Content Type"
               Group ="Custom Document Content Types"
               Description="Custom Document Content Type inherits from Document"
               Version="0">
    <FieldRefs>
    </FieldRefs>
  </ContentType>             
</Elements> 
```

谢谢你，
基思

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T23:42:57.490

我想出了这个。

这条线，`<ContentType ID="0X010100YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY"`

应该`<ContentType ID="0x010100YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY"`

ID 中的“X”应为小写。

基思

# python - 我的 python web 应用程序应该对所有字符串使用 unicode 吗？

> ID：827415
> 
> 赞同：6
> 
> 时间：2009-05-05T23:39:38.403
> 
> 标签：python, django, web-applications, unicode, pylons

我看到一些框架，比如 Django，到处都在使用 unicode，所以这似乎是个好主意。

另一方面，让所有这些额外的 'u' 到处飘荡似乎是一种巨大的痛苦。

如果我不这样做会有什么问题？

如果我这样做会出现任何问题吗？

我现在使用 Pylons 作为我的框架。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-05T23:55:49.237

您可以通过执行以下操作避免`u''`在 python 2.6 中出现：

```
from __future__ import unicode_literals 
```

这将`'string literals'`成为 unicode 对象，就像在 python 3 中一样；

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-05T23:43:40.657

在 Python 3 中，所有字符串都是 Unicode。因此，您可以通过在需要的任何地方使用`u''`字符串来为此做好准备，然后当您最终使用该`2to3`工具升级到 Python 3 时，所有`u`s 都会消失。而且您将处于更好的位置，因为您已经使用 Unicode 字符串测试了您的代码。

请参阅[文本与。数据而不是 Unicode Vs。8 位](http://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit)了解更多信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T11:29:45.373

> 如果我不这样做会有什么问题？

我是居住在日本的西方人，所以我亲眼目睹了使用非 ASCII 字符需要什么。如果您不使用 Unicode 字符串，问题在于您的代码会让世界上使用 AZ 以外的任何其他内容的地区感到沮丧。我们公司非常沮丧地让某些网络软件在不把它弄得一团糟的情况下做日文字符。

说英语的人需要付出一点努力才能体会到 Unicode 的伟大之处，但要让计算机可以访问所有文化和语言确实是一项了不起的工作。

“陷阱”：

1.  确保您的输出网页正确说明使用的编码（例如使用内容编码标头），然后在输出时正确编码所有 Unicode 字符串。Python 3 Unicode 字符串是一个很好的改进来做到这一点。

2.  使用 Unicode 字符串做所有事情，并且只在最后时刻转换为特定的编码，当做输出时。其他语言，例如 PHP，在以 UTF-8 形式处理 Unicode 时容易出现错误。假设您必须截断 Unicode 字符串。如果它在内部采用 UTF-8 格式，则存在中途截断多字节字符的风险，从而导致垃圾输出。Python 在内部使用 Unicode 字符串使得这些错误更难犯。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-17T19:52:32.567

在内部使用 Unicode 是避免非 ASCII 字符问题的好方法。在应用程序的边界进行转换（将传入数据转换为 unicode，将传出数据转换为 UTF-8 或其他）。Pylons 可以在许多情况下为您进行转换：例如，控制器可以安全地返回 unicode 字符串；SQLAlchemy 模型可以声明 Unicode 列。

关于源代码中的字符串文字：通常不需要 u 前缀。您可以安全地将包含 ASCII 的 str 对象与 unicode 对象混合。只需确保所有字符串文字都是纯 ASCII 或 u"unicode"。

# c# - 静态关键字是什么意思？

> ID：827424
> 
> 赞同：11
> 
> 时间：2009-05-05T23:42:04.340
> 
> 标签：c#

我是 C# 初学者。我发现有两种方法可以编写代码并输出相同的结果。你能解释一下它们之间的区别吗？什么时候使用#1 和#2？

## `#1`

```
class Program
{
    static void Main()
    {
        Program min = new Program();
        Console.WriteLine(min.isMin(1, 2));
        Console.ReadLine();
    }

    int isMin(int value1, int value2)
    {
        int Min;
        return Min = Math.Min(value1, value2);
    }
} 
```

## `#2`

```
class Program2
{
    static void Main()
    {
        Console.WriteLine(isMin(1, 2));
        Console.ReadLine();
    }

    static int isMin(int value1, int value2)
    {
        int Min;
        return Min = Math.Min(value1, value2);
    }
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-05T23:46:45.437

#1 和 #2 的区别在于 #1 中 isMin 是类 Program 的实例成员函数，因此您必须创建 Program 类的实例

```
 Program min = new Program() 
```

然后才调用实例成员函数isMin：

```
 min.isMin(..) 
```

#2中isMin是Program类的静态成员函数，由于Main也是同一个类的静态成员函数，所以可以在Main函数中直接调用isMin。

两者都是有效的。静态函数 Main 是程序的“入口点”，这意味着它首先被执行。剩下的只是面向对象的语义。

**编辑**

似乎为了更好地说明这一点，一个例子应该是有序的。

下面的两个程序在显示将程序逻辑封装到对象和替代使用静态函数之间的差异的预期目的之外毫无用处。

该程序定义了两个操作并将处理两个数字（示例中为 10 和 25）。当程序运行时，它将跟踪其操作到一个日志文件（每个数字一个）。想象一下，这两个操作可以被更严肃的算法代替，并且这两个数字可以被一系列更有用的输入数据代替，这是很有用的。

```
//The instance-based version:
class Program
{
    private System.IO.StreamWriter _logStream;
    private int _originalNumber;
    private int _currentNumber;

    public Program(int number, string logFilePath)
    {
        _originalNumber = number;
        _currentNumber = number;
        try
        {                
            _logStream = new System.IO.StreamWriter(logFilePath, true);
            _logStream.WriteLine("Starting Program for {0}", _originalNumber);
        }
        catch
        {
            _logStream = null;
        }
    }
    public void Add(int operand)
    {
        if (_logStream != null)
            _logStream.WriteLine("For {0}: Adding {1} to {2}", _originalNumber, operand, _currentNumber);
        _currentNumber += operand;
    }
    public void Subtract(int operand)
    {
        if (_logStream != null)
            _logStream.WriteLine("For {0}: Subtracting {1} from {2}", _originalNumber, operand, _currentNumber);
        _currentNumber -= operand;            
    }
    public void Finish()
    {            
        Console.WriteLine("Program finished. {0} --> {1}", _originalNumber, _currentNumber);
        if (_logStream != null)
        {
            _logStream.WriteLine("Program finished. {0} --> {1}", _originalNumber, _currentNumber);
            _logStream.Close();
            _logStream = null;
        }
    }

    static void Main(string[] args)
    {
        Program p = new Program(10, "log-for-10.txt");
        Program q = new Program(25, "log-for-25.txt");

        p.Add(3);         // p._currentNumber = p._currentNumber + 3;
        p.Subtract(7);    // p._currentNumber = p._currentNumber - 7;
        q.Add(15);        // q._currentNumber = q._currentNumber + 15;
        q.Subtract(20);   // q._currentNumber = q._currentNumber - 20;
        q.Subtract(3);    // q._currentNumber = q._currentNumber - 3;

        p.Finish();       // display original number and final result for p
        q.Finish();       // display original number and final result for q
    }
} 
```

以下是同一程序的基于静态函数的实现。注意我们必须如何“携带我们的状态”进出每个操作，以及 Main 函数如何需要“记住”哪些数据与哪个函数调用一起使用。

```
class Program
{
    private static int Add(int number, int operand, int originalNumber, System.IO.StreamWriter logFile)
    {
        if (logFile != null)
            logFile.WriteLine("For {0}: Adding {1} to {2}", originalNumber, operand, number);
        return (number + operand);
    }
    private static int Subtract(int number, int operand, int originalNumber, System.IO.StreamWriter logFile)
    {
        if (logFile != null)
            logFile.WriteLine("For {0}: Subtracting {1} from {2}", originalNumber, operand, number);
        return (number - operand);
    }
    private static void Finish(int number, int originalNumber, System.IO.StreamWriter logFile)
    {
        Console.WriteLine("Program finished. {0} --> {1}", originalNumber, number);
        if (logFile != null)
        {
            logFile.WriteLine("Program finished. {0} --> {1}", originalNumber, number);
            logFile.Close();
            logFile = null;
        }
    }

    static void Main(string[] args)
    {
        int pNumber = 10;
        int pCurrentNumber = 10;
        System.IO.StreamWriter pLogFile;
        int qNumber = 25;
        int qCurrentNumber = 25;
        System.IO.StreamWriter qLogFile;

        pLogFile = new System.IO.StreamWriter("log-for-10.txt", true);
        pLogFile.WriteLine("Starting Program for {0}", pNumber);
        qLogFile = new System.IO.StreamWriter("log-for-25.txt", true);
        qLogFile.WriteLine("Starting Program for {0}", qNumber);

        pCurrentNumber = Program.Add(pCurrentNumber, 3, pNumber, pLogFile);
        pCurrentNumber = Program.Subtract(pCurrentNumber, 7, pNumber, pLogFile);
        qCurrentNumber = Program.Add(qCurrentNumber, 15, qNumber, qLogFile);
        qCurrentNumber = Program.Subtract(qCurrentNumber, 20, qNumber, qLogFile);
        qCurrentNumber = Program.Subtract(qCurrentNumber, 3, qNumber, qLogFile);

        Program.Finish(pCurrentNumber, pNumber, pLogFile);
        Program.Finish(qCurrentNumber, qNumber, qLogFile);
    }
} 
```

需要注意的另一点是，尽管第一个基于实例的示例有效，但在实践中更常见的是将您的逻辑封装在不同的类中，该类可用于程序的 Main 入口点。这种方法更灵活，因为它可以很容易地获取程序逻辑并将其移动到不同的文件，甚至移动到甚至可以被多个应用程序使用的不同程序集。这是一种方法。

```
// Another instance-based approach
class ProgramLogic
{
    private System.IO.StreamWriter _logStream;
    private int _originalNumber;
    private int _currentNumber;

    public ProgramLogic(int number, string logFilePath)
    {
        _originalNumber = number;
        _currentNumber = number;
        try
        {                
            _logStream = new System.IO.StreamWriter(logFilePath, true);
            _logStream.WriteLine("Starting Program for {0}", _originalNumber);
        }
        catch
        {
            _logStream = null;
        }
    }
    public void Add(int operand)
    {
        if (_logStream != null)
            _logStream.WriteLine("For {0}: Adding {1} to {2}", _originalNumber, operand, _currentNumber);
        _currentNumber += operand;
    }
    public void Subtract(int operand)
    {
        if (_logStream != null)
            _logStream.WriteLine("For {0}: Subtracting {1} from {2}", _originalNumber, operand, _currentNumber);
        _currentNumber -= operand;            
    }
    public void Finish()
    {            
        Console.WriteLine("Program finished. {0} --> {1}", _originalNumber, _currentNumber);
        if (_logStream != null)
        {
            _logStream.WriteLine("Program finished. {0} --> {1}", _originalNumber, _currentNumber);
            _logStream.Close();
            _logStream = null;
        }
    }        
}

class Program
{        
    static void Main(string[] args)
    {
        ProgramLogic p = new ProgramLogic(10, "log-for-10.txt");
        ProgramLogic q = new ProgramLogic(25, "log-for-25.txt");

        p.Add(3);         // p._number = p._number + 3;
        p.Subtract(7);    // p._number = p._number - 7;
        q.Add(15);        // q._number = q._number + 15;
        q.Subtract(20);   // q._number = q._number - 20;
        q.Subtract(3);    // q._number = q._number - 3;

        p.Finish();
        q.Finish();     
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-05T23:49:57.053

这里的主要区别是基于面向对象的编程。C#是一种面向对象的语言，里面的大部分东西都是对象。在这种情况下，程序是一个对象。它很特别，因为它具有静态 void Main() 函数，即程序的“入口点”。

不同之处在于 isMin 函数上的静态修饰符。类定义对象如何工作。当您实际制作一个时，就像您对 new Program() 所做的那样，您已经“实例化”了该对象，或者制作了该对象的实际工作副本。

通常这样做是为了跟踪作为该对象一部分的一组变量，但在这种情况下没有这样的变量。

在第一种情况下，您正在创建目标程序的一个实例，并告诉它在该实例上执行其“isMin”函数。在第二种情况下，您没有创建任何实例，而是告诉它执行与类（而不是对象的实例）关联的“isMin”函数。除了一些更简单的语法之外，这里没有真正的区别，因为在对象中没有跟踪数据。

你会发现当你有关于对象的数据时很重要，因为当你在一个静态函数中时你将无法访问“实例”数据。要了解更多信息，请查看面向对象的编程。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-05T23:50:24.430

这两种方法的区别在于实例方法（第一种）和静态方法（第二种）。第一个声明了`Program`类的一个实例，然后`isMin`在这个实例上调用方法，而第二个只是简单的调用`isMin`方法，没有引用任何实例（你可以认为方法始终属于整个类，在这个内部执行）一般背景）。如果您来自 BASIC 背景，那么静态方法本质上类似于在模块中定义的方法。

就最佳实践而言，第二种方法是可供选择的方法。没有明确的理由拥有`Program`该类的实例（考虑到您在同一个程序集/进程中永远不会有多个实例），那么为什么要麻烦呢？更有意义的是，该`isMin`方法应该是静态的，即不依赖于或什至不与任何特定实例（甚至任何特定类 - 您最好在另一个名为 的类中定义它`MathHelper`）相关。

希望能为你澄清事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T02:27:25.550

两者的区别在于第一个使用实例方法，第二个使用静态方法。实例方法是与给定类的每个对象相关联的方法。静态方法与类本身相关联。在第一种情况下，您必须创建类的对象，然后您可以使用与该特定对象关联的方法。在第二种情况下，您可以使用仅基于类的方法。通常，您会在方法前加上类名，但因为您所在的范围是类，所以静态方法的类被假定为当前类。这解释了差异在非常高的水平。

更重要的是您将如何使用这些方法实际编写程序。在面向对象的编程中，您通常认为对象包含一些数据和对这些数据进行操作的操作（方法）。从某种意义上说，它是自给自足的。编写 OO 程序的典型方法是使用带有实例方法的类。静态方法通常很少见，至少比较少见。

为什么会这样？好吧，静态方法必须从它们的参数中获取所有数据，因为它们不与任何特定对象相关联。请记住，对象由数据和操作组成。有时我们有适用的方法。数学课就是一个很好的例子。通常，它的方法是静态的，采用一两个参数并产生结果。不需要对象，因为唯一需要的数据是方法的参数，创建一个类来保存两个参数然后只对它们执行一个操作是没有意义的。

但是，通常情况下，我们的类数据更复杂，对它们的各种操作也没有那么简单和繁多。在这种情况下，让方法对对象的数据进行操作而不是通过参数传递所有数据是有意义的。在这种情况下，我们需要一个类的特定实例，以便我们可以有特定的数据来进行操作。

正如 Brian Marick 所说，现在是举个例子的好时机。

假设您有一个代表汽车的类，并且正在模拟许多汽车在城镇周围行驶。汽车有许多潜在的操作：启动、加速、转弯、制动等。汽车也有几个属性可能会影响这些操作的各种算法：引擎、BrakePackage、SteeringPackage 等。并非每辆车都有相同的Engine、BrakePackage 和 SteeringPackage 的值。

使用实例方法，我们可以让这些方法：Start、Accelerate、Turn、Brake 对对象本身包含的数据进行操作。

```
public class Car
{
    public Engine Engine { get; set; }
    public BrakePackage Brakes { get; set; }
    public SteeringPackage Steering { get; set; }
    public double X { get; private set; }
    public double Y { get; private set; }
    public double Z { get; private set; }

    public void Accelerate( double pedalPressure )
    {
        this.Engine.MoveThrottle( pedalPressure, UpdatePosition );
    }

    public void UpdatePosition( double x, double y, double z, int deltaTime )
    {
        this.CalculateSpeed( this.X, this.Y, this.Z, x, y, z, deltaTime );
        this.X = x;
        this.Y = y;
        this.Z = z;
    }

    ...
} 
```

另一方面，如果我们使用静态方法，那么我们必须将所有各种参数传递给方法，包括我们想要更新的那些值，因为这些方法不会与任何特定数据相关联。这实际上已经够痛苦了，我什至不想打出与上述等价的示例。

从某种意义上说，不幸的是，您需要开始使用静态 Main 方法编写程序，因为它可能会让您一开始就走错了路。您要做的是开始考虑您的对象——它们需要什么数据以及您将对它们执行什么操作。每隔一段时间，您会发现您有一个适用于类的所有对象的操作，并且不需要访问任何特定对象中的任何或大部分数据，或者只处理有关类本身的信息。这些对象将成为静态方法的候选对象。但是，您的大多数方法将适合您的第一个示例的模式，而不是您的第二个示例。

# user-interface - 如何设置 Tk 小部件的默认字体

> ID：827430
> 
> 赞同：5
> 
> 时间：2009-05-05T23:43:41.403
> 
> 标签：user-interface, fonts, tcl, tk

我有一个生成许多表单的 Tcl/Tk 应用程序，并且希望能够从一个中心位置配置默认小部件字体，而无需使用`-font`开关配置每个小部件。

```
#!<path>/wish
button .hello -text "Hello, World!" -command { exit }
pack .hello
puts "--- i would like to set this thing: [.hello configure -font] --- " 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-06T00:01:23.513

尝试添加，

```
font create myDefaultFont -family Helvetica -size 20
option add *font myDefaultFont 
```

到脚本的顶部。[（链接到关于字体的文章）](http://www.tclscripting.com/articles/jun06/article1.html)

# php - *字节的允许内存大小已用尽，在php中

> ID：827435
> 
> 赞同：3
> 
> 时间：2009-05-05T23:47:04.500
> 
> 标签：php, memory-management

我在 php.ini 中遇到“内存不足”错误。我知道它可以用 ini_set("memory_limit","64M") 之类的方法修复，但我不想这样做，因为脚本的内存量很大是不正常的。我有一些报告非常庞大，以至于我非常需要这些内存，但通常不需要。

问题是：我什至不知道哪个脚本消耗了这么多内存，而且还没有用户报告错误。我知道这只是由于 log_errors（设置为 true）和 error_log（设置为我桌面中一个非常明显的文件）而发生的，但它没有报告哪个脚本是罪魁祸首。

关于如何知道的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T00:07:06.340

您可能有一些基本的算法错误，创建大型数据结构，将数据重新构建为其他结构，过多的大型字符串操作，将整个文件加载到内存中，从存储中重新获取数据而不是重新使用上次检索到的数据，之类的东西。许多本土数据库处理程序会为您提供从查询返回的整个数据集，而不是为您提供数据集资源。这对于可以返回比最初设想的更多数据的查询尤其有害。

一旦你分析了你的代码，你就可以开始寻找内存浪费了。对于处理大型日志记录数据集，将您的代码结构化为一次处理一行，因此它（例如）`while( $data = mysql_fetch_assoc() )`而不是`foreach( $data_rows as $data )`. 这还允许您使用无缓冲查询，这也将减少内存消耗。

错误日志应该告诉你脚本已经死了。也许 Apache 错误日志可以提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-05T23:55:28.803

脚本消耗超过 32M 的内存是很正常的，我最近在使用 GD 库时遇到了这个问题，想要在重新缩放某些图像类型时消耗更多的内存，并且抛出了同样的错误。在您的情况下，我会将内存加倍，并将执行时间限制在安全的范围内（如果还没有的话）。我通过 .htaccess 执行此操作，其中包含以下几行：

```
php_value memory_limit 64M
php_value max_execution_time 30 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T23:57:21.997

为此，您需要一个分析器。我更喜欢[xdebug](http://www.xdebug.org/docs/)。[本文](http://devzone.zend.com/article/2871)介绍如何获取 PHP 脚本的内存使用信息。

# tcl - 为什么此“预期”代码中的字符串匹配失败？

> ID：827442
> 
> 赞同：0
> 
> 时间：2009-05-05T23:49:27.693
> 
> 标签：tcl, expect

为了使用安捷伦基站模拟器，我创建了以下程序：

```
proc get_bss_parameter_value {bss parameter_string} {
global bss_array

set bss_str "$parameter_string?"

puts "String 1"
set bss_str "oa;$bss_array(gpib):$bss_str\r"
send "$bss_str"
expect {nopattern^}

puts "String 2"
set bss_str "en;$bss_array(gpib)"
puts "Sending bss_str: $bss_str"
send "$bss_str\r"
expect .*

set receive_buffer $expect_out(buffer)
puts "receive_buffer START: $receive_buffer"
puts "END"

return $receive_buffer
} 
```

==================================================== ====== 输出：

字符串 1

>

> oa;05:SYST:APPL? 字符串 2 发送 bss_str: en;05 "CDMA 2000 Lab App T"
> 
> 无法读取“expect_out(buffer)”：执行“set receive_buffer $expect_out(buffer)”时没有这样的变量（过程“get_bss_parameter_value”第 20 行）

==================================================== ====== 如果在上面的代码中“. *”被“* ”替换，这是输出：

字符串 1

>

> oa;05:SYST:APPL? 字符串 2 发送 bss_str: en;05 receive_buffer START:
> 
> oa;05:SYST:APPL?
> 
> END 当前申请是
> 
> oa;05:SYST:APPL?

问题：
1) 我无法在 expect_out(buffer) 变量中获得值“CDMA 2000 Lab App T”，该变量应该匹配（由于.*）安捷伦设备的输出。代码有问题吗？
2) 在这两种情况下，命令“en;05”已发送但未显示在标准输出上。虽然我们可以在第一种情况下看到预期的输出。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T18:15:06.903

请注意， [expect] 命令默认执行[glob 样式](http://www.tcl.tk/man/tcl8.5/TclCmd/string.htm#M40)匹配，而不是[regexp-style](http://www.tcl.tk/man/tcl8.5/TclCmd/re_syntax.htm)。所以，你写的地方：

```
expect .* 
```

您实际上是在寻找以文字点开头的字符串，后跟任意数量的字符。由于这不匹配，因此不会填充 expect_out 数组。正如你提到的

```
expect * 
```

由于 glob 模式 "*" 匹配任何字符串，因此行为如您所愿。

如果你真的想要“.*”，那么你需要指定

```
expect -re .*
set receive_buffer $expect_out(buffer) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:01:03.927

我的印象是 expect_out 变量是一个全局变量。如果我是正确的，那么您需要以下内容：

```
global expect_out 
```

或者，您可以使用命名空间限定符“::”将其显式称为全局

```
set receive_buffer $::expect_out(buffer) 
```

# mysql - 哪些 mysql 设置会影响 LOAD DATA INFILE 的速度？

> ID：827445
> 
> 赞同：5
> 
> 时间：2009-05-05T23:51:02.587
> 
> 标签：mysql, performance, load-data-infile, bulk-load

让我设置一下情况。我们正在尝试将适量的行数（每天大约 10-20M）插入到适度宽的 MyISAM 表中：

```
+--------------+--------------+------+-----+---------+-------+
| Field        | Type         | Null | Key | Default | Extra |
+--------------+--------------+------+-----+---------+-------+
| blah1        | varchar(255) | NO   | PRI |         |       | 
| blah2        | varchar(255) | NO   | PRI |         |       | 
| blah3        | varchar(5)   | NO   | PRI |         |       | 
| blah4        | varchar(5)   | NO   | PRI |         |       | 
| blah5        | varchar(2)   | NO   | PRI |         |       | 
| blah6        | varchar(2)   | NO   | PRI |         |       | 
| blah7        | date         | NO   | PRI |         |       | 
| blah8        | smallint(6)  | NO   | PRI |         |       | 
| blah9        | varchar(255) | NO   | PRI |         |       | 
| blah10       | bigint(20)   | YES  |     | NULL    |       | 
+--------------+--------------+------+-----+---------+-------+ 
```

除了巨大的主键之外，唯一的索引是 blah7，即日期字段。我们正在使用 LOAD DATA INFILE 并看到让我印象非常糟糕的性能，大约需要 2 个小时来加载数据。我被引导相信 LOAD DATA INFILE 比这快几个数量级。

有趣的是，我们有一些不太胖的表（5-6 个字段），我们还使用 LOAD DATA INFILE 将数据批处理到其中，我们看到这些表的性能要好得多。记录的数量要少得多，这让我认为当我们加载大表时我们遇到了缓冲区大小限制，并且必须转到磁盘（实际上，除了磁盘还有什么解释这么慢的加载时间？）。

...这让我想到了我的问题。在处理 LOAD DATA INFILE 命令时，哪些 my.cnf 设置最重要？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T04:07:38.603

插入索引通常会降低性能。在插入数据之前删除索引并在插入后重新索引可能会更好。

来自[http://forum.percona.com/s/m/983/](http://forum.percona.com/s/m/983/)：

> 通常 MySQL 在 MyISAM 表中加载数据的速度相当快，但也有例外，即它不能通过排序重建索引，而是逐行构建它们。这可能是由于配置错误（即 myisam_max_sort_file_size 或 myisam_max_extra_sort_file_size 太小）而发生的，或者如果您有大（不适合内存）PRIMARY 或 UNIQUE 索引，则可能只是缺乏优化。

另请查看[http://www.mysqlperformanceblog.com/2007/05/24/predicting-how-long-data-load-would-take/](http://www.mysqlperformanceblog.com/2007/05/24/predicting-how-long-data-load-would-take/)和[http://www.linuxtopia.org/online_books/database_guides/mysql_5。 1_database_reference_guide/insert-speed.html](http://www.linuxtopia.org/online_books/database_guides/mysql_5.1_database_reference_guide/insert-speed.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T00:02:52.637

我不知道设置，但我的钱是在那个复合主键上，为什么你的性能这么差。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-01T22:33:37.120

如果您的表是 MyISam 并且数据被添加到非空表中，bulk_insert_buffer_size 很重要

MyISAM 在向非空表添加数据时，使用特殊的树状缓存使 LOAD DATA INFILE 的批量插入更快。BULK_INSERT_BUFFER_SIZE 变量以每个线程的字节数限制缓存树的大小。将其设置为 0 会禁用此优化。默认值为 8MB。最大值为 4GB。

如果将数据添加到非空表中，调整 bulk_insert_buffer_size 变量可以使数据插入更快。通常，当要插入的数据超过 10k 行时，它会显示出改进。但是很难说什么是正确的值，因此，跟踪并尝试使用增量缓冲区大小值。

此外，如果同时设置以下变量，性能提升会更加明显：

*   `MYISAM_SORT_BUFFER_SIZE`
*   `KEY_BUFFER_SIZE`

您还应该考虑在使用以下 alter table 命令加载数据之前禁用索引：

```
alter table t disable keys; 
```

# java - 搜索大字符串以查看是否存在无效的“参数”

> ID：827446
> 
> 赞同：1
> 
> 时间：2009-05-05T23:51:02.807
> 
> 标签：java, string

我有一个大字符串，类似于这个：

> BREW 锅 HTCPCP/1.0
> 
> 接受添加：#milk;3#whiskey;splash
> 
> 内容长度：5
> 
> 内容类型：消息/咖啡壶

我还有一个包含几个添加项（#whiskey、#espresso 等）的数组。如果这个大字符串包含不在可用添加数组中的添加，我需要做的是发送错误。例如，如果字符串的“Accept-Additions”部分包含“#bricks;3”，则会产生错误，因为它不在数组中。

我将如何在 Java 中解决这个问题？尽管我已经编写了程序的其余部分（你们中的许多人可能都知道），但我在实现这部分时遇到了麻烦。我将如何编码以下问题，重点是添加不可用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T23:54:57.837

你会解析字符串。查看它，每行有一组选项，因此您可以查找以 ACCEPT-ADDITIONS 开头的所有行。然后你必须提取添加，它们似乎用分号分隔，表示 String.split()。然后遍历结果数组以查找添加项。

或者您可以创建一个语法，并使用诸如 ANTLR 之类的工具来生成您的解析器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T00:23:43.697

这段代码对输入做了一些假设。看起来您可以将每个令牌进一步拆分为 #; 组件。对可接受的液体参数使用列表会稍微清理一下代码（只需使用liquids.contains（String s））

```
 static String[] liquids = {"#milk;3", "#whiskey;splash"};

  public static void parseString(String input)
  {
    // Break the String down into line-by-line.
    String[] lines = input.split("" + '\n');
    for (int line_index = 0; line_index < lines.length; line_index++)
    {
      if (lines[line_index].length() > 16)
      {
        // Assume you're delimiting by '#'
        String[] tokens = lines[line_index].split("#");
        if (tokens.length > 1)
        {
          // Start at index = 1 to kill "Accept-Additions:"
          for (int token_index = 1; token_index < tokens.length; token_index++)
          {
            boolean valid = false;
            for (int liquids_index = 0; liquids_index < liquids.length; liquids_index++)
            {
              if (liquids[liquids_index].equals("#" + tokens[token_index]))
              {
                valid = true;
                // break to save some time if liquids is very long
                break;
              }
            }
            if (!valid)
            {
              throwError("#" + tokens[token_index]);
            }
          }
        }
      }
    }
  }

  public static void throwError(String error)
  {
    System.out.println(error + " is not in the Array!");
  } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T01:13:17.303

这是使用正则表达式的可能解决方案。它从有效负载中提取“Accept-Additions”行，然后检查表单的每个键值对`#foo;bar`。

```
final String[] VALID_ADDITIONS = { 
    "milk", "whiskey"
};

final Pattern LINE = Pattern.compile("Accept-Additions:(.+)$", Pattern.MULTILINE);
final Pattern ADDITIONS = Pattern.compile("#(.+?);([^#]+)");

void checkValidAdditions(String request) {
    Matcher lineMatcher = LINE.matcher(request);
    if (!lineMatcher.find()) {
        // no additions - do whatever is appropriate here
        throw new IllegalArgumentException("Additions line not found");
    }
    String line = lineMatcher.group(1);
    Matcher additions = ADDITIONS.matcher(line);
    while (additions.find()) {
        String key = additions.group(1);
        //String value = additions.group(2);

        boolean validKey = false;
        for (String validAddition : VALID_ADDITIONS) {
            if (key.equals(validAddition)) {
                validKey = true;
            }
        }
        if (!validKey) {
            // ...
        }
    }
} 
```

第一个正则表达式从请求中提取相关行。第二个提取键值对。请注意以下警告：

*   此方法不会正确接收格式错误的请求 - 只有无效的“密钥”。

*   如果您允许不同的大小写（例如'ACCEPT-ADDITIONS'、'accept-additions'），请添加 Pattern.CASE_INSENSITIVE 标志，即`Pattern.MULTILINE & Pattern.CASE_INSENSITIVE`.

# c# - 是什么 ”？？” 运营商？

> ID：827454
> 
> 赞同：34
> 
> 时间：2009-05-05T23:54:30.100
> 
> 标签：c#, operators, coalesce, null-coalescing-operator

我想知道代码`??`中的符号。`C#`它是干什么用的？我该如何使用它？

怎么样`int?`？它是一个可为空的 int 吗？

### 也可以看看：

> [?? 空合并运算符 —> 合并是什么意思？](https://stackoverflow.com/questions/770186/null-coalescing-operator-what-does-coalescing-mean)

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-11-19T08:14:05.187

它是[*空合并运算符*](http://msdn.microsoft.com/en-us/library/ms173224.aspx)。它是在 C# 2 中引入的。

表达式的结果`a ?? b`是`a`如果它不为空，`b`否则。`b`除非需要，否则不会评估。

两件好事：

*   表达式的整体类型是第二个操作数的类型，这在您使用可空值类型时很重要：

    ```
    int? maybe = ...;
    int definitely = maybe ?? 10; 
    ```

    （请注意，您不能使用不可为空的值类型作为第一个操作数 - 这将毫无意义。）

*   关联性规则意味着您可以非常轻松地将其链接起来。例如：

    ```
    string address = shippingAddress ?? billingAddress ?? contactAddress; 
    ```

这将使用发货、账单或联系地址中的第一个非空值。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-05-05T23:57:36.707

它被称为“空合并运算符”，其工作原理如下：

而不是这样做：

```
int? number = null;
int result = number == null ? 0 : number; 
```

你现在可以这样做：

```
int result = number ?? 0; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-05T23:56:51.280

那是合并运算符。它本质上是以下内容的简写

```
x ?? new Student();
x != null ? x : new Student(); 
```

运营商的 MSDN 文档

*   [http://msdn.microsoft.com/en-us/library/ms173224.aspx](http://msdn.microsoft.com/en-us/library/ms173224.aspx)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-05T23:57:09.220

这是新的 Null Coalesce 运算符。

这 ？？运算符如果不为空则返回左操作数，否则返回右操作数。

你可以在这里阅读：http: [//msdn.microsoft.com/en-us/library/ms173224 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms173224(VS.80).aspx)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-11-19T08:13:44.093

这是一个快捷方式：

```
Text = (category == null ? "Home" : category); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-05-05T23:56:51.920

它是合并运算符。如果第一个值为空，它将返回另一个值

```
string value1 = null;
string value2 = "other";

string value3 = value1 ?? value2; // assigns "other" to value 3 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-11-19T08:09:29.110

它检查类别是否为空——在这种情况下，空值被“Home”替换。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-06T00:25:55.437

我最喜欢 null 合并运算符的用途之一是避免在我的代码中使用 if 语句（我认为 if 语句很丑陋，而且大多数时候只会把事情弄得一团糟）。例如，以一个典型的场景为例，如果可用，人们可能会选择从缓存中加载某些内容，否则从数据库加载并填充缓存。

```
private SomeData GetData() {
    var data = HttpRuntime.Cache.Get("key") as SomeData;

    if (data == null) {
        data = DAL.GetData(some parameters...);
        HttpRuntime.Cache.Add("key", data, ....);
    }

    return data;
} 
```

对我来说，那是丑陋的代码。我可能有点肛门，但为什么不将它重构为这个呢？

```
private SomeData GetDataAndCache() {
    var data = DAL.GetData(some parameters...);
    HttpRuntime.Cache.Add("key", data, ....);
    return data;
}

private SomeData GetData() {
    var data = HttpRuntime.Cache.Get("key") as SomeData;
    return data ?? GetDataAndCache();
} 
```

IMO，它更接近 SRP，并且更清晰、更易于阅读。这些功能每个都执行一个清晰可识别的功能。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-11-19T08:09:18.627

如果 category 为 null，Text 将变为“Home”

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-05T23:57:20.217

[?? 空合并运算符](http://msdn.microsoft.com/en-us/library/ms173224.aspx)

诠释？是一个可为空的 int，这意味着它可以具有普通 int 和 null 的值。阅读[本文](http://msdn.microsoft.com/en-us/library/2cf62fcy(VS.80).aspx)了解详情。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-05T23:57:51.497

返回第一个非空值。便利。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-05T23:57:38.093

这就是[空合并运算符](http://msdn.microsoft.com/en-us/library/ms173224.aspx)。它与可为[空的类型](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)一起使用（除此之外，抱歉 :)

# php - 在 Kohana 中，可以触发 404 错误吗？

> ID：827458
> 
> 赞同：10
> 
> 时间：2009-05-05T23:55:04.777
> 
> 标签：php, kohana, http-status-code-404

我有一个名为 的控制器`articles`，它创建从数据库中获取相关数据的文章模型。

如果我调用的方法返回`false`，我想触发 404 错误。这就是我到目前为止所拥有的。

```
 $articleName =  $this->uri->segment('articles');

 $article = new Articles_Model();

 $data = $article->getArticleUsingSlug($articleName);

 if (!$data) {
    Kohana::show_404; // This doesn't work.
 } 
```

我刚刚添加了我自己的自定义钩子，它将用户重定向到由 Kohana 触发的实际 404（/articles/page-not-found/），但是有没有一种方法可以调用其内部 404 方法让 Kohana 放弃处理我的控制器并使用我的新钩子？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-06T00:10:21.793

这对我有用：

```
Event::run('system.404'); 
```

您使用的是什么版本的 Kohana？

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-08-11T12:40:32.783

Kohana / 常规 / 错误处理 / [Kohana_404_Exception](http://docs.kohanaphp.com/general/errorhandling#kohana_404_exception)

```
/**
 * @param  string  URL of page
 * @param  string  custom error template
 */
throw new Kohana_404_Exception([string $page [, string $template]]); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-10-09T03:28:36.433

[Kohana Docs](https://v2docs.kohanaframework.org/3.3/guide/kohana/errors#http-exception-handling)告诉你如何做到这一点：

```
throw HTTP_Exception::factory(404, 'File not found!'); 
```

# c# - 如何记录计算机之间的相对时间？

> ID：827473
> 
> 赞同：2
> 
> 时间：2009-05-05T23:58:37.920
> 
> 标签：c#, time, computer-science

我需要在不同的计算机上独立记录事件，并重建这些事件相对于彼此发生的顺序。该方案要求每台计算机相对独立；他们不能直接相互交谈或与单一来源交谈。

我最初的解决方案记录了每台机器上的时间，但是由于不同机器上的时间可能不同，并且可以全天变化，这并没有完全解决我的问题。我决定在机器 (1) 启动进程或 (2) 系统时钟发生变化时与所有机器共享。

所以从每台机器上我都会得到一个完整的日志

```
public class Activity {
    DateTime TimeOccurred { get; set; }
    string Description { get; set; }
} 
```

每当发生上述 (1) 或 (2) 时，我都会在日志中添加一个活动并将其广播到其他机器，这些机器将相同的活动添加到他们的日志中，其中 TranslatedTime 是他们自己的时间：

```
public class TimeSynchronization : Activity {
    string SourceMachine { get; set; }
    DateTime TranslatedTime { get; set; }
} 
```

所以机器A会（按顺序）：

```
TimeSynchronization "started" at 3:00 am.
Activity "asked a question" at 3:05 am.
TimeSynchronization from machine B at 3:05 am.
TimeSynchronization "clock changed" at 3:03 am.
Activity "received an answer" at 3:04 am. 
```

机器 B 将（按顺序）：

```
TimeSynchronization "started" at 3:05 am.
TimeSynchronization "clock changed" at 3:06 
```

因此，我需要将上述事件的相同顺序和时间重构为：

```
On machine A: TimeSynchronization "started" at 0:00
On machine A: Activity "asked a question" at 0:05
On machine B: TimeSynchronization "started" at 0:05
On machine A: TimeSychronization from machine B at 0:05
On machine A: TimeSynchronization "clock changed" at 0:06
On machine B: TimeSynchronization "clock changed" at 0:06
On machine A: Activity "received an answer" at 0:07 
```

`List<Activity>`从每台机器中获取 a 并将其按顺序合并到一个列表中的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T00:05:40.430

如果两台机器通过网络连接，您的程序可以询问另一台机器现在几点。这样，您在机器 A 上的程序可以询问 A 和 B 上的时间，然后记录两次。

您提到时间可能会在白天发生变化（大概是用户更改了时间）。您可以使用 Win32.TimeChanged 事件检测到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T00:11:30.213

原子时间，以及将其提供给您的网络服务。这就是你需要的。实际的？不知道。但至少您不必担心试图同步时钟的 n 台计算机。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T00:03:24.773

看起来他们希望你对[分布式事务有直觉](http://en.wikipedia.org/wiki/Distributed_transaction)

另外，查看[网络时间协议](http://www.ntp.org/)：

> NTP 是一种旨在通过网络同步计算机时钟的协议。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T00:31:07.267

我认为您想以 UTC（通用时间）记录所有内容。这将允许记录时间及其相对于共同时间点的时间，并使比较日期/时间变得非常容易。要在本地时间显示它们，您只需识别偏移量并计算 UTC 时间与本地时间的差异。例如在东海岸它的UTC-5，所以如果UTC时间是17:00，纽约当地时间是12:00，达拉斯是UTC-6，所以它是上午11:00。

因此，如果您在达拉斯上午 11:10 有一个事件，其 UTC 时间是 17:10，而在纽约下午 12:05 有一个事件是 UTC 时间 17:05，那么您知道纽约事件首先发生，但是如果你原始比较了这似乎不是这样的时代。

UTC 的另一个优势是它始终代表一天中的所有 24 小时，因此在秋季，当您离开夏令时时，您不会收到 2 组凌晨 2 点至凌晨 3 点的事件，并且当您向前走时不会浪费时间进入日光节约时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T00:29:30.513

首先：如果每台机器上的操作是真正并行的，你不能保证只有一个规范的序列化排序。如果整个过程中有一些协调，你最好在协议中使用某种排序，这样你就可以按它排序。

除此之外，您需要计算机器之间的时钟偏差以调整时间。你这样做的方法相当简单：询问另一台机器的当前时间，并测量该请求的往返时间。假设远程机器报告的时间在往返时间的一半前是正确的（这假设平均延迟是对称的——并不总是正确的，但如果不深入研究网络布局，你就不能做得更好），然后减去它从当前机器的时间开始。那是你的时钟偏差。您可能需要多次测量偏差并取平均值，以消除连接上的间歇性延迟。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-16T08:34:52.553

如果您需要计算机之间非常准确的时钟同步，请使用 GPS。

# iphone - 在界面生成器（iPhone 应用程序）中更改按钮标题的字体大小

> ID：827488
> 
> 赞同：1
> 
> 时间：2009-05-06T00:07:31.580
> 
> 标签：iphone

您能否让我知道如何在界面构建器（iPhone 应用程序）/或任何 API 中更改按钮标题的字体大小？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T00:16:09.127

您需要通过选择菜单“Font -> Show Fonts”（或按 Command-T）来显示 Fonts 窗口。

然后，您选择（突出显示）IB 中的按钮并在您刚刚打开的字体面板上更改字体大小。

# optimization - 编译器优化问题

> ID：827489
> 
> 赞同：6
> 
> 时间：2009-05-06T00:07:44.933
> 
> 标签：optimization, compiler-construction, compiler-development

1.  编译器消除重复子表达式重新计算的方法有哪些？你如何跟踪子表达式？你如何识别重复的？
2.  除了按位运算符的使用之外，常见的编译器还使用了哪些强度降低技术？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T00:35:36.287

对于 1，您正在寻找的优化名称是通用子表达式消除 (CSE)。根据您的代表，这可能相当容易。通常，编译器将有一些程序的中间表示，其中操作被尽可能地分解和线性化。因此，例如，表达式`c = a * b + a * b`可能被分解为：

```
v1 = a * b
v2 = a * b
c = v1 + v2 
```

因此，您可以通过查找具有相同运算符和操作数的操作来在非常低的级别执行 CSE。当您遇到重复（在这种情况下为 v2）时，您将其所有实例替换为原始实例。所以我们可以将上面的代码简化为：

```
v1 = a * b
c = v1 + v1 
```

这通常假设您只为每个变量分配一次（单个静态分配形式），但您可以在没有限制的情况下实现类似的东西。当您尝试跨分支执行此优化时，这会变得更加复杂。正如 Zifre 提到的，研究部分冗余消除。

无论哪种方式，你都会得到一些基本的改进，而你需要跟踪的只是基本的表达方式。您可能想更进一步，寻找算术恒等式。例如，`a * b`与 相同`b * a`。另外，`x * (y + z) = x * y + x * z`. 这使您的优化变得更加复杂，并且不清楚它是否会给您带来那么多的性能改进。有趣的是，CSE 优化的大部分好处来自地址计算，如数组访问，您不需要像上面那样复杂的身份。

对于 2，什么强度降低是有用的实际上取决于您编译的架构。通常这只涉及将乘法和除法转换为移位、加法和减法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T00:44:10.930

我强烈推荐两个关于这些主题的印刷参考资料：

1.  Steven S. Muchnick 的[高级编译器设计与实现](https://rads.stackoverflow.com/amzn/click/com/1558603204)
2.  Robert Morgan[构建优化编译器](https://rads.stackoverflow.com/amzn/click/com/155558179X)

Muchnick 的书是正式的，但可读性很强，并且对所有重要的优化技术都有很好的描述。Morgan 的书具有更多的动手能力，对于专注于优化技术的编译器项目来说，这将是一个很好的基础。这两本书都没有太多关于词法分析或解析的内容，假设您对这些主题有所了解。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T00:27:42.657

1.  相信很多编译器都会使用 SSAPRE（Static Single Assignment Partial Redundancy Elimination）来消除重复的表达式。这要求代码采用[SSA 形式](http://en.wikipedia.org/wiki/Static_single_assignment_form)，允许进行更多优化。

2.  我不太确定这个，但看看[这个 LLVM 通行证列表](http://llvm.org/docs/Passes.html)。[LLVM](http://llvm.org/)是一种针对编译器的优化 IR，通常比 GCC 还要快。每一关都有一个小的解释。如果您需要更多信息，请查看这些通行证的 LLVM 源代码。它是用 C++ 编写的，但非常简洁易懂。

编辑：顺便说一句，如果您正在开发编译器，我强烈推荐 LLVM，它非常易于使用并生成高度优化的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T23:05:33.943

要在推荐列表中再添加一本书，请查看Henry S. Warren[的“Hacker's Delight”](https://rads.stackoverflow.com/amzn/click/com/0201914654)。这是优化常见操作的技术概要，例如将整数除法转换为乘法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-30T15:07:12.493

您正在寻找部分冗余消除 (PRE)。CSE（来自其他答案）和循环不变代码运动都包含在 PRE 中。（PRE 的一个变体是 Lazy Code Motion，我认为这是最佳的）。

查看[Keith Cooper 的讲义](http://www.cs.rice.edu/~keith/512/Lectures/17LCM.pdf)，它似乎很好地描述了这些技术。

不要使用 SSAPRE **。**AFAIK，这需要一种特殊形式的 SSA，称为 HSSA，它有一些缺点：

*   它相当复杂
*   它需要全局值编号（因此 SSAPRE 不提供值编号，因为它预期已经存在）。
*   如果您的语言不支持指向堆栈变量的指针，它不会提供任何东西（如果支持，请停止编写您自己的分析并使用 LLVM 或 gcc）。
*   gcc 使用了 HSSA 一段时间，但他们已经远离它。
*   LLVM 对其进行了试验，但 AFAIK 他们不再使用它。

### 编辑：

Muchnick的书有详细的描述，它链接在另一个答案中。

# html - Internet explorer 和 floats：请解释一下

> ID：827495
> 
> 赞同：4
> 
> 时间：2009-05-06T00:11:36.110
> 
> 标签：html, css, internet-explorer, cross-browser

昨天有人问[Width 吸收 HTML 元素](https://stackoverflow.com/questions/820473/width-absorbing-html-elements)。我提出了[两种解决方案](https://stackoverflow.com/questions/820473/width-absorbing-html-elements/820580#820580)：一种基于表格，一种纯 CSS。现在纯 CSS 在 Firefox 和 Chrome 中运行良好，但在 IE 中不行。

基本上，花车被撞到下一行。我的理解（以及 FF 和 Chrome 的行为）不应该是这种情况，因为左 div 是浮动应该基本上忽略的块级元素。

完整的代码示例如下。添加 DOCTYPE 以强制 IE 进入标准兼容模式略有帮助，但问题仍然存在。

所以我的问题是：我对浮点数的理解是错误的还是这是 IE 的问题？

更重要的是，我如何让它在 IE 中工作？它一直在烦我。

```
<html>
<head>
<style type="text/css">
div div { height: 1.3em; }
#wrapper { width: 300px; overflow: hidden; }
div.text { float: right; white-space: nowrap; clear: both; background: white; padding-left: 12px; text-align: left; }
#row1, #row2, #row3, #row4, #row5, #row6 { width: 270px; margin-bottom: 4px; }
#row1 { background: red; }
#row2 { background: blue; }
#row3 { background: green; }
#row4 { background: yellow; }
#row5 { background: pink; }
#row6 { background: gray; }
</style>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("jquery", "1.3.2");
google.setOnLoadCallback(function() {
  $(function() {
    $("div.text").animate({ width: "90%" }, 2000);
  });
});
</script>
</head>
<body>
<div id="wrapper">
<div class="text">FOO</div><div id="row1"></div>
<div class="text">BAR</div><div id="row2"></div>
<div class="text">THESE PRETZELS ARE</div><div id="row3"></div>
<div class="text">MAKING ME THIRSTY</div><div id="row4"></div>
<div class="text">BLAH</div><div id="row5"></div>
<div class="text">BLAH</div><div id="row6"></div>
</div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T16:41:08.907

由于行上的 ，浮动被撞到下一`width: 270px`行。这发生在 IE6/7 中，因为它的[浮动模型损坏了](http://www.positioniseverything.net/explorer/floatmodel.html)。IE 将浮动元素放在彩色行 div 旁边而不是覆盖它们，但由于它们的组合宽度大于包装器的宽度，因此彩色行会下降到下一行。

如果您确实需要这些彩色条的最大宽度为 270 像素，则可以`max-width`改用。但是，这在 IE6 中不起作用，因此如果这真的很关键，您将需要一个解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-26T09:20:48.833

不知道为什么你试图以这种方式实现它。但这有效。

```
<html>
<head>
<style type="text/css">
div div { height: 1.3em; }
#wrapper { width: 300px; overflow: hidden; }
div.text { float: right; white-space: nowrap; clear: both; background: white; padding-left: 12px; text-align: left; }
#row1, #row2, #row3, #row4, #row5, #row6 { width: 270px; margin-bottom: 4px; }
#row1 { background: red; }
#row2 { background: blue; }
#row3 { background: green; }
#row4 { background: yellow; }
#row5 { background: pink; }
#row6 { background: gray; }
</style>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("jquery", "1.3.2");
google.setOnLoadCallback(function() {
  $(function() {
    $("div.text").animate({ width: "90%" }, 2000);
  });
});
</script>
</head>
<body>
<div id="wrapper">
<div id="row1"><div class="text">FOO</div></div>
<div id="row2"><div class="text">BAR</div></div>
<div id="row3"><div class="text">THESE PRETZELS ARE</div></div>
<div id="row4"><div class="text">MAKING ME THIRSTY</div></div>
<div id="row5"><div class="text">BLAH</div></div>
<div id="row6"><div class="text">BLAH</div></div>
</div>
</body>
</html> 
```

# asp.net-mvc - 分支 asp.mvc 的项目是什么？

> ID：827497
> 
> 赞同：0
> 
> 时间：2009-05-06T00:12:14.877
> 
> 标签：asp.net-mvc, open-source

我记得读过一篇关于一个小组的博客文章，该小组采用了 asp.mvc 的一个分支。

他们打算将其用作基础并在添加功能的同时解决许多问题。

现在我似乎无法找出谷歌关键字的神奇组合来找到它。

有谁知道这个项目叫什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T00:17:17.440

[Fubu MVC](http://code.google.com/p/fubumvc/)也许？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-11T20:16:49.397

除了 Fubu 不是 ASP.NET MVC 的分支或端口这一事实之外，一切都很好，它是一个完全独立的框架，源于其作者在使用 ASP.NET MVC 时的挫败感。它在某些部分受到 ASP.NET MVC 的严重影响，仅此而已。

# c - C 中带 %g 的字符串格式

> ID：827499
> 
> 赞同：6
> 
> 时间：2009-05-06T00:12:51.507
> 
> 标签：c, string, format, numbers

如何创建一个字符串，以便将浮点数格式化为整数时没有尾随小数点或数字，但不切换到更大数字的科学记数法？

当我做：

```
float myFloat= 15.6f;
float myInt = 5.0f;
float myLarge = 7000000.0f;
sprintf(out, "my float is %g", myFloat);
sprintf(out, "my int is %g", myInt);
sprintf(out, "my large is %g", myLarge); 
```

我得到类似的东西：

```
我的浮点数是 15.6
我的整数是 5
我的大号是 7e+07f

```

我想要一个可以提供 15.6、5 和 700000 的单一格式字符串。

*编辑的原因评论不进行格式化：*

那正是我所想。但是包装器非常不方便，因为格式字符串嵌入在更长的格式字符串中：

```
sprintf(buf, "%d %g", myInt, myFloat); 
```

你怎么包装的？

```
sprintf(buf, "%d %g", myInt, Wrapper(myFloat));?? 
```

Wrapper 应该返回什么？或者更糟：

```
sprintf(buf, "%d %s", myInt, Wrapper(myFloat));?? 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T00:20:14.233

您可以使用“%.*f”进行格式化，它允许您将精度作为单独的参数传递给例如 sprintf。过去，当我想很好地显示 0、1、2 或 3 位数字而不需要额外的尾随 0 时，我曾使用过它。编写一个小辅助函数，它接受 double/float 并返回一个整数精度（乘以 1000，然后取模 10、100、1000）。然后用“%.*f”调用sprintf，调用辅助函数，传递float。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T00:21:35.900

我不认为你可以得到这个`%g`，因为`%g`给你较短的`%e`or `%f`。

所以，我认为没有一个`printf`论点能让你满意。对于 15.6，您可以使用`%2.1f`; 对于 7000000，您可以使用`%7.0f`.

您最好的选择可能是编写一个包装函数，该函数会查看您的值的大小并应用正确的`printf`参数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-07-08T21:34:32.607

将 %g 替换为 %.10g 以显示最多 10 个有效数字

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T02:19:26.507

Mike 的方法是合理的，但是您可以直接使用 log10 函数计算位数，并使用 floor 或 ceil 来验证您实际上是否具有整数值。就像是：

```
#include <math.h>
double x;
...
if (floor(x) == x && x != 0.0) { // x is an non-zero integer value
    int digits = floor(log10(fabs(x)+0.5)) + 1;
    printf("x is %.*f\n", digits, x);
} 
```

解包函数调用链，我们首先取绝对值以确保参数为非负数，将 0.5 添加到已知整数值以处理在计算 log10 的 10 的精确幂时任何可能的舍入错误，组合 log10和 floor 得到小于 fabs(x)+0.5 的 10 的最大幂的指数，最后加 1 得到表示 x 所需的位数。以下是一些示例值（来自 OpenOffice，但 C log10 函数应该以类似的精度计算）：

```
 x          log10(x+0.5)
         1  0.176091259055681000
         9  0.977723605288848000
        10  1.021189299069940000
        99  1.997823080745730000
       100  2.002166061756510000
       999  2.999782798454140000
      1000  3.000217092972230000
     10000  4.000021714181250000
    100000  5.000002171466980000
   1000000  6.000000217147190000
  10000000  7.000000021714720000
 100000000  8.000000002171470000
1000000000  9.000000000217150000 
```

# visual-c++ - 窗口应用

> ID：827500
> 
> 赞同：1
> 
> 时间：2009-05-06T00:12:51.897
> 
> 标签：visual-c++

你好，我是 php 的 c++ 新手。虽然我不是一个绝对的新手，这意味着我已经使用 oop php 和 sql 编写了大型 db 驱动的应用程序，但我想知道使用 c++ 创建独立 Windows 应用程序的一般过程是什么，就模式、API 编译等而言。 .

编辑：就GUI而言，您将如何使用firefox之类的可视界面。您如何创建外观，因为它看起来不像 visualc++ 中的 AWT 库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T00:41:41.827

我认为你真的应该拿起 Charles Petzold 的[Programming Windows 5th Edition](http://www.charlespetzold.com/pw5/)来帮助你了解很多这些背景信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T00:56:39.920

**微软图书馆：**

在非托管 C++ 中，您可以使用本机 Win32 API、MFC 或 ATL/WTL。

本机 Win32 API 是 Windows 系列操作系统公开的 C 风格方法的集合。这些 API 通过操作窗口和消息循环来工作。[您可以在 MSDN Windowing](http://msdn.microsoft.com/en-us/library/ms632586(VS.85).aspx)部分开始阅读有关 Win32 的信息。

MFC 是一个 C++ 类库，它围绕 Win32 API 提供了丰富的面向对象的包装器。它将 Win32 窗口抽象为 CWindow 类，将消息循环抽象为 CMessageMap。您可以在 MSDN 上阅读有关[MFC的更多信息。](http://msdn.microsoft.com/en-us/library/d06h2x6e(VS.80).aspx)

ATL/WTL 是一个轻量级 C++ 模板库，它最初是作为 COM 的 C++ 包装器，后来采用了 MFC 的一些想法（因此共享相同的类名）以支持 Win32 窗口。ATL 窗口支持后来被拆分为 WTL，然后作为开源发布。ATL 窗口支持记录在 MSDN 的[ATL 窗口类](http://msdn.microsoft.com/en-us/library/x1wf8d3x(VS.71).aspx)部分中。

在托管 C++ 中，您可以使用 WinForms 或 WPF。尽管它们的文档和示例严重偏向于 C# 和 VB.Net，但它们在 MSDN 上都得到了相当彻底的介绍。如果您想探索这些 UI 平台，我个人也建议您查看 C#。

**你需要使用这些：**

当然，首先你需要一个 C++ 编译器。:-)

要使用 Win32 API，您只需要[Windows SDK](http://msdn.microsoft.com/en-us/windows/bb980924.aspx)和可选的[Visual C++ Express](http://www.microsoft.com/express/download/)。

要使用 MFC 和 ATL，您需要 Visual Studio Professional 或更高版本之一。ATL 和 MFC 不包含在 Visual C++ Express 中。（ATL/MFC 可能包含在 WIndows SDK 或其他我不知道的免费产品中。）

WTL 8.0 可[免费下载](http://www.microsoft.com/downloads/details.aspx?familyid=E5BA5BA4-6E6B-462A-B24C-61115E846F0C&displaylang=en)。您还可以从[Source Forge WTL 项目](http://sourceforge.net/projects/wtl/)中获取 WTL 源代码。

要使用 WinForms 或 WPF，您需要最新的[.Net 框架](http://www.microsoft.com/downloads/details.aspx?familyid=333325FD-AE52-4E35-B531-508D977D32A6&displaylang=en)（嗯，从技术上讲，您需要任何 .Net 框架:-)）和可选的[Visual C#/VB.Net Express](http://www.microsoft.com/express/download/)。我不确定 Visual C++ Express 是否支持托管 C++。

**第三方选项：**

有几个第三方 C++ 库包装/抽象了本机 Win32 API。其中一些足够抽象，不仅可以为 Windows 开发 UI，还可以为其他平台开发 UI。[我知道Qt](http://qt.nokia.com/)和[wxWidgets](http://www.wxwidgets.org)是一对，但从未使用过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T00:26:35.513

我觉得你的问题太笼统了。尝试将其分解成更小的部分，例如关于 Windows 上的 GUI 编程入门的问题、关于模式的问题、关于形成 API 的问题等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T00:49:17.393

他的问题故意很宽泛：引用“我想知道一般过程是什么”。

致 OP：首先，您需要决定是使用控制台还是构建具有 gui 支持的应用程序。

对于大多数 hello world 教程，您发现它们应该可以在任何平台上正常运行，只要它们可以访问某种控制台。

一旦您了解了 C++ 的工作原理以及如何构建简单的程序，您就可以开始研究为您提供 GUI 等的 Windows 库。

因此，开始为自己准备一个 C++ 编译器（www.bloodshed.net 上的 DevCpp 很好）并做基本的 hello world 之类的。

然后它的问题是从 windows.h 和其他包括实现你想要的任何东西。

至于 API，这将取决于您想要制作的程序类型：对于图像/声音/输入（即游戏/图像查看器/媒体播放器），您应该学习标准开发库或 SDL。

对于 GUI，您可以使用上述 Windows API，或查看 www.qtsoftware.com 上的 Qt 或 www.wxwidgets.org 上的 wxWidgets

作为奖励，如果您尽可能避免使用 Windows API，您的程序将更容易移植。

SDL、Qt、wxWidgets 都是跨平台的。

# javascript - 提供反馈以从控制器查看

> ID：827501
> 
> 赞同：1
> 
> 时间：2009-05-06T00:12:54.250
> 
> 标签：javascript, ruby-on-rails, ruby, ajax, upload

我在视图中使用多个文件字段来上传多个文件。我想通知用户上传**进度**。我尝试使用这样的东西

```
def create  
    params[:upload_data].each do |file|  
    unless (file =="" or file== nil)   
    @photo = Photo.create({:approved => false, :user_id => @current_user.id})    
        @result = "Uploading #{file.original_filename}"  
            render :update do |page|  
            page.insert_html(:bottom, 'progress', :partial => 'partials/result')   
            end   
         #... perform upload
end 
```

如果我删除对用户的反馈，它工作正常。但是，当它进入时，它会失败并出现多次渲染错误。我想知道是否有人知道这样做的任何方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T00:17:41.230

您不能多次调用渲染。仅当控制器方法将返回时才应使用渲染。

为了让它工作，你需要改变你做请求的方式，可能使用 ajax。然后每次上传都会更新页面上的内容，javascript 会执行下一个“上传这个文件，然后更新”调用。

编辑：我不是前端人员，所以我不能给你实际的工作代码，但它会是这样的。目前，您正在将几个文件作为参数发送到控制器中。您需要更改此设置，以便后端一次只处理一个文件。这意味着更改前端以对后端执行单独的请求。你不能只用一个 html 表单来做到这一点——你需要 javascript。控制器将渲染一个 rjs 以发回更新“已处理的文件 xyz”，客户端代码将触发另一次上传，直到所有文件都上传完毕。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:34:42.967

我使用它取得了巨大的成功：[SWFUpload](http://swfupload.org/)

它是一个用于上传的 Flash 控件，您提供 html 前端，无论您使用文本还是 % 栏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T04:39:01.727

如果您使用 Workling 作为后台工作人员，它可以存储进度信息，然后您可以使用这些信息使用 javascript 更新页面上的进度条。

# python - PyODBC 和 Microsoft Access：简单查询的结果不一致

> ID：827502
> 
> 赞同：3
> 
> 时间：2009-05-06T00:14:39.800
> 
> 标签：python, ms-access, odbc, jet, pyodbc

我通过 Microsoft Jet 使用 pyodbc 从 Python 程序访问 Microsoft Access 2003 数据库中的数据。

Microsoft Access 数据库来自第三方；我只是在阅读数据。

我通常在提取我需要的数据方面取得了成功，但我最近注意到了一些差异。

我把它归结为一个简单的查询，形式如下：

```
SELECT field1 FROM table WHERE field1 = 601 AND field2 = 9067 
```

我已经混淆了字段名称和值，但实际上，没有比这更简单的了！当我在 Access 中运行查询时，它返回一条记录。

然后我在 pyodbc 上运行它，代码如下所示：

```
connection = pyodbc.connect(connectionString)
rows = connection.execute(queryString).fetchall() 
```

（同样，没有比这更微不足道的了！）

queryString 的值是从 Access 中的工作查询中剪切和粘贴的，但它不返回*任何*记录。我希望它会返回相同的记录。

当我更改查询以搜索 field2 的不同值时，宾果游戏可以正常工作。它拒绝的只是一些价值观。

所以，请帮帮我。我接下来应该在哪里寻找来解释这种差异？如果我不能相信琐碎查询的结果，我就没有机会参与这个项目！

*更新*：它变得更加简单！以下查询给出了不同的数字...

从表中选择计数（*）

我考虑它是否与某些形式的缓存和/或另一个偶尔填充数据的应用程序的不正确事务管理有关。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T01:48:38.093

你能给我们一个显示这个问题的混淆数据库吗？我从来没有经历过这种情况。至少给出表定义——任何列是浮点数还是小数？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:34:44.480

这听起来可能很愚蠢。但...

实际数据库和连接字符串 (DSN) 的路径是否指向相同的文件位置？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T05:21:57.410

您是否对其他 ODBC 工具（例如[Query Tool](http://gpoulose.home.att.net/) ）有同样的问题？您还可以在 ODBC 连接管理器中打开 ODBC 跟踪。我没有访问权限，也不知道它的 sql 命令是否会被跟踪，但有时它可以帮助我解决 ODBC 问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:25:56.640

字段是否被索引？如果是这样，可能其中一个索引已损坏，您需要压缩 MDB 文件。*如果*索引损坏，可能会导致重大问题。您可能会丢失现有的关系（如果损坏的索引是 PK），或者您可能会丢失数据。因此，您需要在执行此操作之前进行备份。如果有损坏的索引，我认为交互式 Access 压缩操作会告诉你，但如果没有，你可以查找 MSysCompactErrors 表，它会告诉你压缩期间发生了哪些错误。

这种情况很少发生，并且可以表明以下两种情况之一：

1.  糟糕的应用程序设计，包括过时的 Jet 版本（Service Pack 6 之前的 Jet 4 非常容易受到这种影响，这就是我遇到的地方）。

2.  不可靠的操作环境（网络/硬件/软件）。

当然，这个建议是一个真正的远景，但它绝对是导致不同结果的一个原因（最常见的是对损坏的索引进行 ORDER BY，你最终会得到与另一个 ORDER BY 不同的记录数） .

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-27T00:25:56.630

在升级到 Access 2007 和从源下载数据库的新副本之间的某个地方解决了问题。仍然不知道根本原因是什么，但怀疑某种形式的索引损坏。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-23T17:42:01.270

我想问题可能是您没有提交查询。PYODBC 以 autocommit = False 开头，因此每个查询（如 select、insert、update 等）都会启动一个事务，为了生效，您必须提交。在查询之后调用`connection.autocommit = True`或调用`cursor.execute("commit")`然后fetchall。

# reflection - 在 JSF 应用程序中使用反射读取托管 bean 的内容

> ID：827507
> 
> 赞同：2
> 
> 时间：2009-05-06T00:17:55.550
> 
> 标签：reflection, jsf, javabeans

我想以自动生成的方式打印出支持 bean 的内容。所以所有的内容都出现在一个 JSP 上。这有可能吗？

在此先感谢，丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T11:07:41.167

一种方法是使用[JavaBean API](http://java.sun.com/javase/6/docs/api/java/beans/package-summary.html)和[自定义标记函数](http://java.sun.com/javaee/5/docs/tutorial/doc/bnahq.html#bnaiq)。

WEB-INF/tld/beans.tld：

```
<?xml version="1.0" encoding="UTF-8" ?>

<taglib xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/javaee/web-jsptaglibrary_2_1.xsd"
    version="2.1">
    <description>Bean inspector.</description>
    <display-name>Bean inspector utils</display-name>
    <tlib-version>1.2</tlib-version>
    <short-name>beans</short-name>
    <uri>http://acme.demo</uri>
    <function>
        <name>inspect</name>
        <function-class>props.Inspector</function-class>
        <function-signature>
            java.util.List inspect(java.lang.Object)
        </function-signature>
    </function>
</taglib> 
```

执行：

```
public class Inspector {

  public static List<Map.Entry<String, Object>> inspect(
      Object bean) {
    Map<String, Object> props = new LinkedHashMap<String, Object>();

    try {
      BeanInfo info = Introspector.getBeanInfo(bean
          .getClass(), Object.class);
      for (PropertyDescriptor propertyDesc : info
          .getPropertyDescriptors()) {
        String name = propertyDesc.getDisplayName();
        Method reader = propertyDesc.getReadMethod();
        Object value = reader.invoke(bean);
        props.put(name, value == null ? "" : value);
      }
    } catch (IntrospectionException e) {
      throw new RuntimeException(e);
    } catch (InvocationTargetException e) {
      throw new RuntimeException(e);
    } catch (IllegalAccessException e) {
      throw new RuntimeException(e);
    }

    return new ArrayList<Map.Entry<String, Object>>(props
        .entrySet());
  }
} 
```

然后将此标记库导入 JSP 标头中：

```
<?xml version="1.0" encoding="UTF-8" ?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:beans="http://acme.demo"> 
```

使用函数的示例数据表：

```
<h:dataTable border="1" value="#{beans:inspect(demoPropsBean)}" var="entry">
    <h:column id="column1">
        <f:facet name="header">
            <h:outputText value="property" />
        </f:facet>
        <h:outputText value="#{entry.key}" />
    </h:column>
    <h:column id="column2">
        <f:facet name="header">
            <h:outputText value="value" />
        </f:facet>
        <h:outputText value="#{entry.value}" />
    </h:column>
</h:dataTable> 
```

有关如何提供本地化属性名称等的信息，请参阅[JavaBean 规范。](http://java.sun.com/javase/technologies/desktop/javabeans/index.jsp)

# cocoa - 我应该如何从委托方法返回一个 NSError 对象？

> ID：827508
> 
> 赞同：0
> 
> 时间：2009-05-06T00:17:55.800
> 
> 标签：cocoa, api

我正在设计一个委托方法，当远程服务器需要来自委托的输入时调用该方法。此时的委托负责填写要发送到服务器的数据，并告诉服务器此时是否有错误。

我现在拥有的委托方法是：

```
-(void)server:(MBServer*)server
 willSendData:(NSMutableString*)data
        error:(NSError**)error; 
```

此时，delegate 可以通过修改传入的 NSMutableString 来为服务器提供要发送的数据。此外，它可以通过将`error`变量设置为新的 NSError 实例来创建要发送回的 NSError。

我遇到的问题是委托方法可能通过 NSInvocation 从另一个线程调用。委托可以创建一个新的 NSError 对象，但它会在其他线程收到响应之前在当前线程中自动释放。

在单线程应用程序中，这不是问题，因为委托人可以直接保留响应，但在多线程设计中我不能这样做（再次因为当前事件循环将自动释放它）。委托人必须保留错误，以便委托人可以释放它。

这是针对公共 api 的，我不喜欢通过文档要求实现者知道他们必须保留错误对象的想法。好像太不安全了。

```
// You *must* retain the returned error before
// passing it back or you will crash

-(void)server:(MBServer*)server
 willSendData:(NSMutableString*)data
        error:(NSError**)error; 
```

我想到的其他想法是发送一个 NSError 作为返回值（似乎有点不标准，因为大多数方法返回一个布尔值并采用 NSError 双指针）。它也只是看起来很奇怪。

```
-(NSError *)server:(MBServer*)server
      willSendData:(NSMutableString*)data; 
```

我还考虑过传递一个可变字典并要求委托填写一个错误。然后字典将保留错误，安全地跨线程取回。

```
// Send your NSError response in the dictionary with the key
// MBServerErrorResponseKey

-(void)server:(MBServer*)server
 willSendData:(NSMutableString*)data
     response:(NSMutableDictionary*)response; 
```

有没有人处理过这个设计问题，如果有，你的解决方案是什么？

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T00:47:34.560

怎么样：不是直接调用委托方法，而是通过 NSInvocation 调用“蹦床”方法。蹦床（您将实现）只会调用委托方法，并在返回之前保留错误。换句话说：蹦床（可能是服务器对象上的一个方法）只会用传递的参数包装对委托的调用，然后保留错误并返回。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T00:41:07.553

您可以做的一件事是尝试类似

```
-(void)server:(MBServer*)server
 willSendData:(NSMutableString*)data
        shouldStop:(BOOL*)stopFlag;
-(NSError*)getLastErrorForServer:(MBServer*)server; 
```

这将允许委托通过设置 来向服务器发出出现问题的信号`stopFlag`，然后服务器可以调用该`getLastErrorForServer:`方法以获取实际出现的问题。`server:WillSendData:`让方法返回 a`BOOL`而不是传入指针也可能更有意义。

# build-process - 在哈德逊的工作之间共享构建工件

> ID：827515
> 
> 赞同：33
> 
> 时间：2009-05-06T00:21:02.843
> 
> 标签：build-process, build, continuous-integration, build-automation, hudson

我正在尝试在哈德逊建立我们的构建过程。

工作 1 将是一个超级快速（希望如此）的持续集成构建工作，它将被频繁构建。

工作 2，将负责定期运行或手动触发的综合测试套件。

Job 3 将负责在代码库中运行分析工具（很像 Job 2）。

我尝试使用“高级项目选项 > 使用自定义工作区”功能，以便在 Job 1 中编译的代码可以在 Job 2 和 3 中使用。但是，似乎所有构建工件都保留在 Job 1 工作区中。我这样做对吗？有没有更好的方法来做到这一点？我想我正在寻找类似于构建管道设置的东西......以便可以共享事物并且可以分阶段执行适当的作业。

（我也考虑过使用“批处理任务”......但似乎无法安排这些任务？只能手动触发？）

欢迎任何建议。谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-11-09T15:10:22.110

您可能想尝试 Copy Artifact 插件：

[http://wiki.hudson-ci.org/display/HUDSON/Copy+Artifact+Plugin](http://wiki.hudson-ci.org/display/HUDSON/Copy+Artifact+Plugin)

您的持续工作可以构建必要的工件，而您的其他两项工作可以将它们拉进来进行分析。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-03-26T02:21:16.823

Hudson 有一个插件可以解决这个问题：[http](http://wiki.hudson-ci.org/display/HUDSON/Clone+Workspace+SCM+Plugin) ://wiki.hudson-ci.org/display/HUDSON/Clone+Workspace+SCM+Plugin （链接目前已损坏）

对应的 Jenkins 页面在这里：[https ://wiki.jenkins-ci.org/display/JENKINS/Clone+Workspace+SCM+Plugin](https://wiki.jenkins-ci.org/display/JENKINS/Clone+Workspace+SCM+Plugin)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-17T09:00:08.893

是的，那个 wiki 页面并不是很有帮助，因为它试图让它听起来非常优雅。事实是，如果您必须将内容从一份工作传递到另一份工作，那么 Hudson 还不能非常优雅地支持工作链。

我还在使用 zip-up-and-copy-workspace 方法将工作空间从一项工作转移到另一项工作。我有一个快速构建、完整分析构建，然后是分发构建。在这两者之间，我使用 Ant 生成时间戳，并使用“build-stamps”来标记哪个作业的编号构建了哪个其他作业的编号。指纹识别功能有助于跟踪文件，但由于我不打算归档工作区 zip，因此指纹识别对用户来说毫无用处，因为他们实际上看不到工作区 zip。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-09T20:39:31.647

你看过哈德逊维基吗？具体来说：[将大工作拆分为较小的工作](http://wiki.hudson-ci.org/display/HUDSON/Splitting+a+big+job+into+smaller+jobs)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-11T23:47:54.273

Hudson 似乎没有用于构建工件的内置存储库。我们的解决方案是创建一个。

我们在一个 Windows 环境中，所以我创建了一个可以被所有 Hudson 服务器访问的共享（我们为相关服务提供一个公共帐户，因为系统帐户无法通过网络访问资源）。

在我们的构建脚本 (ant) 中，我们有任务将资源构建从其他作业复制到本地工作区，而生成工件的作业将它们复制到公共存储库中。

在其他环境中，您可以通过 FTP 或任何其他移动文件的机制发布和获取。

发布和获取任务的简单示例：

```
<!-- ==================== Publish ==================================== -->
<target name="Publish" description="Publish files">
  <mkdir dir="${publish.dir}/lib" />
  <copy todir="${publish.dir}/lib" file="${project.jar}"/>
</target> 
```

和

```
<!-- ==================== Get ==================================== -->
<target name="getdependencies" description="Get necessary results from published directory">
  <copy todir="${support.dir}">
    <fileset dir="${publish.dir}/lib">
      <include name="*.jar"/>
    </fileset>
  </copy>
</target> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-09T21:20:33.153

我遇到了同样的问题，我最终选择的是针对长期任务的单独项目。这些项目的第一步是将所有文件从 Job 1 的工作区（即最后一次构建）复制到 Job 2/3/etc 工作区。这通常有效，除非 Job 1 在 Job 2/3 开始时正在构建，因为它会得到一个不完整的工作区。您可以通过使用哨兵文件检测作业 1 中的“构建结束”来解决此问题，或者使用 Hudson 锁插件（我没有尝试过）。

如果您假设其他作业相对于 %WORKSPACE% 的位置，则不必使用自定义工作*区*。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-05T09:14:38.590

我同意手动作业之间的当前复制文件/工件/工作空间不够优雅。

此外，我发现必须归档巨大的 tgz/zip 文件会浪费空间/时间。在我们的例子中，这些文件很大（1.5G）并且需要很长时间来打包/归档/指纹/解包。

所以我选择了一个稍微优化的变体：

*   作业 1/2/3 都签出/克隆相同的源存储库，但是
*   作业 1 仅打包实际上是构建工件的文件
    *   使用 Git 使这变得简单快捷`git ls-files -oz`，不确定其他 SCM
*   使用 Copy Artifact 插件传输文件
*   在我们的例子中，这会将这些文件的大小减少到 1/3 -> 加速，减少浪费的空间

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T22:23:53.697

我现在正在做类似的事情。我建议避免尝试在同一个共享工作区中运行许多作业。我只遇到过这个问题。

我正在使用 Maven 和自由形式的项目类型。一组作业在版本控制系统中的文件触发时运行。他们创建本地快照工件。第二组作业每晚运行并设置集成测试环境，然后在其上运行测试。

如果您不使用 Maven；一种选择是在磁盘上设置一个区域，并在作业一中的最后一步将工件复制到该位置。工作二的第一步应该是移动这些文件。运行你需要运行的任何东西。

至于工作三，现在有 findbugs/checkstyle/pmd 等 Hudson 的所有插件。我建议只创建一个作业 1 的版本，它会进行干净的夜间结帐并在您的代码库上运行这些版本。

# cryptography - RSA加密公钥未从容器返回？

> ID：827518
> 
> 赞同：3
> 
> 时间：2009-05-06T00:21:52.450
> 
> 标签：cryptography, c#-2.0, rijndaelmanaged, public-key, rsacryptoserviceprovider

我觉得我想做的很简单。但由于某种原因它不想工作：

这是一个完整的代码片段来测试我正在尝试做的事情：

```
using System;
using System.Xml;
using System.Security.Cryptography;
using System.Security.Cryptography.Xml;

namespace XmlCryptographySendingTest
{
    class Program
    {
        static void Main(string[] args)
        {
            string fullKeyContainer = "fullKeyContainer";
            string publicKeyContainer = "publicKeyContainer";
        //create the two providers
        RSACryptoServiceProvider serverRSA = GetKeyFromContainer(fullKeyContainer);

        //save public and full key pairs
        SaveKeyToContainer(fullKeyContainer, serverRSA.ExportParameters(true));
        SaveKeyToContainer(publicKeyContainer, serverRSA.ExportParameters(false));

        //get rid of them from memory
        serverRSA.Clear();
        serverRSA = null;
        GC.Collect();

        //retrieve a full server set and a private client set
        serverRSA = GetKeyFromContainer(fullKeyContainer);
        RSACryptoServiceProvider clientRSA = GetKeyFromContainer(publicKeyContainer);

        //at this point the public key should be the same for both RSA providers
        string clientPublicKey = clientRSA.ToXmlString(false);
        string serverPublicKey = serverRSA.ToXmlString(false);

        if (clientPublicKey.Equals(serverPublicKey))
        {//they have the same public key.

            // Create an XmlDocument object.
            XmlDocument xmlDoc = new XmlDocument();

            // Load an XML file into the XmlDocument object.
            try
            {
                xmlDoc.PreserveWhitespace = true;
                xmlDoc.Load("test.xml");
            }
            catch (Exception e)
            {
                Console.WriteLine(e.Message);
            }

            //we can encypt with the clientRSA using the public key
            Encrypt(xmlDoc, "Fields", "DataFields", clientRSA, "test");

            Console.WriteLine("Encrypted: \r\n" + xmlDoc.OuterXml);

            //and should be able to decrypt with the serverRSA using the private key
            Decrypt(xmlDoc, serverRSA, "test");

            Console.WriteLine("Decrypted : \r\n" + xmlDoc.OuterXml);
        }
        else
        {
            Console.WriteLine("The two RSA have different public keys...");
        }

        Console.ReadLine();
    }

    private static CspParameters GetCspParameters(string containerName)
    {
        // Create the CspParameters object and set the key container 
        // name used to store the RSA key pair.
        CspParameters tmpParameters = new CspParameters();
        tmpParameters.Flags = CspProviderFlags.UseMachineKeyStore; //use the machine key store--this allows us to use the machine level container when applications run without a logged-in user
        tmpParameters.ProviderType = 1;
        tmpParameters.KeyNumber = (int)KeyNumber.Exchange;
        tmpParameters.KeyContainerName = containerName;
        return tmpParameters;
    }

    public static void SaveKeyToContainer(string containerName, RSAParameters rsaParameters)
    {
        CspParameters tmpParameters = GetCspParameters(containerName);

        // Create a new instance of RSACryptoServiceProvider that accesses
        // the key container 
        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(tmpParameters);

        //set the key information from the text
        rsa.ImportParameters(rsaParameters);
    }

    public static RSACryptoServiceProvider GetKeyFromContainer(string containerName)
    {
        // Create the CspParameters object and set the key container 
        // name used to store the RSA key pair.
        CspParameters tmpParameters = GetCspParameters(containerName);

        // Create a new instance of RSACryptoServiceProvider that accesses
        // the key container.
        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(tmpParameters);

        return rsa;
    }

    public static void DeleteKeyFromContainer(string containerName)
    {
        // Create the CspParameters object and set the key container 
        // name used to store the RSA key pair.
        CspParameters tmpParameters = GetCspParameters(containerName);

        // Create a new instance of RSACryptoServiceProvider that accesses
        // the key container.
        RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(tmpParameters);

        // Delete the key entry in the container.
        rsa.PersistKeyInCsp = false;

        // Call Clear to release resources and delete the key from the container.
        rsa.Clear();
    }

    public static void Encrypt(XmlDocument Doc, string ElementToEncrypt, string EncryptionElementID, RSA Alg, string KeyName)
    {
        // Check the arguments.
        if (Doc == null)
            throw new ArgumentNullException("Doc");
        if (ElementToEncrypt == null)
            throw new ArgumentNullException("ElementToEncrypt");
        if (EncryptionElementID == null)
            throw new ArgumentNullException("EncryptionElementID");
        if (Alg == null)
            throw new ArgumentNullException("Alg");
        if (KeyName == null)
            throw new ArgumentNullException("KeyName");

        ////////////////////////////////////////////////
        // Find the specified element in the XmlDocument
        // object and create a new XmlElemnt object.
        ////////////////////////////////////////////////
        XmlElement elementToEncrypt = Doc.GetElementsByTagName(ElementToEncrypt)[0] as XmlElement;

        // Throw an XmlException if the element was not found.
        if (elementToEncrypt == null)
        {
            throw new XmlException("The specified element was not found");

        }
        RijndaelManaged sessionKey = null;

        try
        {
            //////////////////////////////////////////////////
            // Create a new instance of the EncryptedXml class
            // and use it to encrypt the XmlElement with the
            // a new random symmetric key.
            //////////////////////////////////////////////////

            // Create a 256 bit Rijndael key.
            sessionKey = new RijndaelManaged();
            sessionKey.KeySize = 256;

            EncryptedXml eXml = new EncryptedXml();

            byte[] encryptedElement = eXml.EncryptData(elementToEncrypt, sessionKey, false);
            ////////////////////////////////////////////////
            // Construct an EncryptedData object and populate
            // it with the desired encryption information.
            ////////////////////////////////////////////////

            EncryptedData edElement = new EncryptedData();
            edElement.Type = EncryptedXml.XmlEncElementUrl;
            edElement.Id = EncryptionElementID;
            // Create an EncryptionMethod element so that the
            // receiver knows which algorithm to use for decryption.

            edElement.EncryptionMethod = new EncryptionMethod(EncryptedXml.XmlEncAES256Url);
            // Encrypt the session key and add it to an EncryptedKey element.
            EncryptedKey ek = new EncryptedKey();

            byte[] encryptedKey = EncryptedXml.EncryptKey(sessionKey.Key, Alg, false);

            ek.CipherData = new CipherData(encryptedKey);

            ek.EncryptionMethod = new EncryptionMethod(EncryptedXml.XmlEncRSA15Url);

            // Create a new DataReference element
            // for the KeyInfo element.  This optional
            // element specifies which EncryptedData
            // uses this key.  An XML document can have
            // multiple EncryptedData elements that use
            // different keys.
            DataReference dRef = new DataReference();

            // Specify the EncryptedData URI.
            dRef.Uri = "#" + EncryptionElementID;

            // Add the DataReference to the EncryptedKey.
            ek.AddReference(dRef);
            // Add the encrypted key to the
            // EncryptedData object.

            edElement.KeyInfo.AddClause(new KeyInfoEncryptedKey(ek));
            // Set the KeyInfo element to specify the
            // name of the RSA key.

            // Create a new KeyInfoName element.
            KeyInfoName kin = new KeyInfoName();

            // Specify a name for the key.
            kin.Value = KeyName;

            // Add the KeyInfoName element to the
            // EncryptedKey object.
            ek.KeyInfo.AddClause(kin);
            // Add the encrypted element data to the
            // EncryptedData object.
            edElement.CipherData.CipherValue = encryptedElement;
            ////////////////////////////////////////////////////
            // Replace the element from the original XmlDocument
            // object with the EncryptedData element.
            ////////////////////////////////////////////////////
            EncryptedXml.ReplaceElement(elementToEncrypt, edElement, false);
        }
        catch (Exception e)
        {
            // re-throw the exception.
            throw e;
        }
        finally
        {
            if (sessionKey != null)
            {
                sessionKey.Clear();
            }

        }

    }

    public static void Decrypt(XmlDocument Doc, RSA Alg, string KeyName)
    {
        // Check the arguments.  
        if (Doc == null)
            throw new ArgumentNullException("Doc");
        if (Alg == null)
            throw new ArgumentNullException("Alg");
        if (KeyName == null)
            throw new ArgumentNullException("KeyName");

        // Create a new EncryptedXml object.
        EncryptedXml exml = new EncryptedXml(Doc);

        // Add a key-name mapping.
        // This method can only decrypt documents
        // that present the specified key name.
        exml.AddKeyNameMapping(KeyName, Alg);

        // Decrypt the element.
        exml.DecryptDocument();

        }

    }
} 
```

只要我保存/获取具有私钥和公钥的 RSACryptoServiceProvider ，这似乎就可以正常工作。一旦我用一个公钥保存了一个 RSACryptoServiceProvider，下次我尝试检索它时，我得到的只是一个新的和不同的 RSACryptoServiceProvider！

可以想象，您无法使用一组密钥加密某些内容，然后尝试使用全新的一组密钥进行解密！

关于为什么会发生这种情况的任何想法？或者存储公钥的正确方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-18T09:55:10.110

我有[一个非常相似的问题](https://stackoverflow.com/questions/2274596/how-to-store-a-public-key-in-a-machine-level-rsa-key-container)。

我现在几乎可以肯定密钥容器不能用于存储公钥。它们的主要目的似乎是存储密钥对。密钥容器只存储最初生成的密钥，导入`PublicOnly`密钥只影响实例，不影响存储。

.NET 开发人员指南的“如何：将非对称密钥存储在密钥容器中”页面指出

> 如果需要存储私钥，则应使用密钥容器

...这与我通过 MSDN 找到的一样清晰的 aa 声明。

我使用的替代机制是将密钥存储在 XML 文件中（因为它是一个公钥，所以它是否容易可见并不重要），并使用文件系统访问规则设置权限以防止不必要的修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-09T18:02:37.897

.NET Crypto Classes 的文档很差。

我一直在用同样的问题绞尽脑汁，并得出了相同的结论，尽管文档中没有明确说明。

当您创建 RSA 提供程序的实例时，您将获得一个新的密钥对。如果您提供参数对象并命名密钥容器，则新密钥对将存储在那里。

如果您导入公钥，它不会**被**持久化！

担

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T09:47:16.740

我的理解是，您在 SaveKeyToContainer 中对 ImportParameters 的调用*不会*影响*存储*中的密钥。*SaveKeyToContainer*的实现是使用存储中的密钥初始化*RSACryptoServiceProvider*的实例（当容器不存在时生成新的密钥对），然后导入参数，这会影响实例而不是存储。

 ***当您稍后检索*publicKeyContainer*时，您将获得在您尝试保存它时生成的新密钥对，而不是导入的公共片段。

抱歉，我无法提供有关使用 Cryptography API 将密钥导入商店的任何详细信息。我相信商店只支持密钥对，即不要指望能够只导入公钥。

# javascript - How can I get smoother animation for sliding content with JavaScript/jQuery?

> ID：827522
> 
> 赞同：10
> 
> 时间：2009-05-06T00:22:16.727
> 
> 标签：javascript, jquery, animation

I have some content sliding here.

[http://www.smallsharptools.com/downloads/jQuery/Slider/slider.html](http://www.smallsharptools.com/downloads/jQuery/Slider/slider.html)

The HTML structure is simple. There is an outer box with a fixed height and width with the overflow set to hidden. Then there is an inner container with the width set to the full width of the content inside of it which is a series of div elements marked with the Item class.

To slide the inner container left and right I am changing the left margin. To go left I reduce the value which becomes negative and to go back to the right I return it to zero. But I am seeing a jagged animation, even in Chrome which I expect would perform better.

My question is, would it be smoother if I used a different technique to move it back and forth? Would absolute positioning be smoother or is there something else I should consider? Are there any secrets do smooth animation that I just do not know yet?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T00:25:58.340

Margin would cause other elements to be recalculated because an element's margin affects the position of other elements around it.

Absolute positioning (on its own zIndex) would still cause repaints of other elements, but would be less costly in terms of calculating the objects around it.

This talk gives some good insight into how the browser/dom internals work

[http://www.youtube.com/watch?v=a2_6bGNZ7bA&feature=channel_page](http://www.youtube.com/watch?v=a2_6bGNZ7bA&feature=channel_page)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T00:51:05.597

I've had good results using the jQuery "Easing" plugin, [documentation here](http://gsgd.co.uk/sandbox/jquery/easing/).

This allows you to apply various smoothed movement such as a sine, bounce, elastic, accelerate and so on, to an html element.

It's using the same techniques you mention under the hood, but it takes care of the messy absolute/relative positioning for you. It' also cross browser and has been optimised over new versions.

One of best benefits of using easing however, is that it can help even low framerate animations look more impressive.

# visual-studio-2008 - 使用 VC++ 2008 为 XP 构建屏幕保护程序

> ID：827525
> 
> 赞同：6
> 
> 时间：2009-05-06T00:23:17.970
> 
> 标签：visual-studio-2008, winapi, visual-c++, screensaver

我正在尝试在 Windows XP 上使用 Visual C++ 2008 Express Edition SP1 编译屏幕保护程序。我收到运行时错误：“过程入口点`ChangeWindowMessageFilter()`无法位于动态链接库 USER32.dll 中。” 据我所知，这是因为微软破坏了 VS 2008 中包含的 scrnsave.lib 库来调用特定于 Vista 的函数，该函数在 XP 上失败，因为该函数不存在。

定义`WINVER`似乎没有任何作用。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-20T02:12:52.237

在 MSDN 中查看“ [ChangeWindowMessageFilter](http://msdn.microsoft.com/en-us/library/ms632675(VS.85).aspx) ”表明它是特定于 Vista 的，并且是您要链接的 User32.lib 的一部分，因为 Windows XP 在 User32.dll 中没有该功能....因此爆炸...建议按照迈克尔的建议下载旧版本的 SDK...没有其他方法可以做到...我想知道您能否并排安装不同的 SDK，一个用于 Vista 平台和其他的Win XP平台？

**编辑：我在**[博客](http://www.nuonsoft.com/blog/2008/03/29/latest-scrnsavelib-depends-on-changewindowmessagefilter/)上找到了一个关于这个的有趣链接......它谈到了完全相同的问题，从较旧的安装中获取 scrnsave.lib 的旧副本（VS 2005，如果您可以访问一个或询问朋友/同事？）说到上述特定于 vista 的功能 - 这是一个有趣的[观点](http://www.nynaeve.net/?p=151)，为什么不应该触及它......

希望这会有所帮助，最好的问候，汤姆。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-21T07:57:19.383

编写一个存根函数（代码中遗漏了许多细节）

```
BOOL WINAPI ChangeWindowMessageFilter(      
   UINT message,
   DWORD dwFlag)
{
   if (running_on_vista_or_later)
   {
      ....
      pfn = GetProcAddress(... "ChangeWindowMessageFilter");
      return pfn (message, dwFlag);
   }

   return TRUE;
} 
```

如果此函数所在的 obj 或 lib 在您的链接行中的 user32.lib 之前，则链接器应该选择您的存根函数而不是 user32.lib 中的那个。

您的存根函数可以在运行时检测到您在 Vista 或更高版本上并调用真正的函数，否则只是撒谎并返回 TRUE。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T00:54:04.917

您可以尝试获取旧版本的 Platform SDK，并链接到它的 scrnsave.lib 版本。

[http://www.microsoft.com/downloads/details.aspx?FamilyId=A55B6B43-E24F-4EA3-A93E-40C0EC4F68E5&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=A55B6B43-E24F-4EA3-A93E-40C0EC4F68E5&displaylang=en)是 Windows Server 2003 SP1 平台 SDK 的下载链接。

# c# - C# MD5 哈希器示例

> ID：827527
> 
> 赞同：12
> 
> 时间：2009-05-06T00:24:01.340
> 
> 标签：c#, hash, md5

**编辑：**我已将其重命名为示例，因为代码按预期工作。

我正在尝试复制文件，获取 MD5 哈希，然后删除副本。我这样做是为了避免另一个应用程序写入的原始文件的进程锁定。但是，我正在锁定我复制的文件。

```
File.Copy(pathSrc, pathDest, true);

String md5Result;
StringBuilder sb = new StringBuilder();
MD5 md5Hasher = MD5.Create();

using (FileStream fs = File.OpenRead(pathDest))
{
    foreach(Byte b in md5Hasher.ComputeHash(fs))
        sb.Append(b.ToString("x2").ToLower());
}

md5Result = sb.ToString();

File.Delete(pathDest); 
```

然后我得到一个'进程无法访问文件'异常`File.Delete()`'。

我希望通过该`using`声明，文件流将很好地关闭。我也尝试过单独声明文件流，删除，并在读取后`using`放置`fs.Close()`和。`fs.Dispose()`

在此之后，我注释掉了实际的 md5 计算，代码执行，文件被删除，所以看起来它与`ComputeHash(fs)`.

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-12-10T17:39:55.143

导入名称空间

```
using System.Security.Cryptography; 
```

这是返回 md5 哈希码的函数。您需要将字符串作为参数传递。

```
public static string GetMd5Hash(string input)
{
        MD5 md5Hash = MD5.Create();
        // Convert the input string to a byte array and compute the hash.
        byte[] data = md5Hash.ComputeHash(Encoding.UTF8.GetBytes(input));

        // Create a new Stringbuilder to collect the bytes
        // and create a string.
        StringBuilder sBuilder = new StringBuilder();

        // Loop through each byte of the hashed data 
        // and format each one as a hexadecimal string.
        for (int i = 0; i < data.Length; i++)
        {
            sBuilder.Append(data[i].ToString("x2"));
        }

        // Return the hexadecimal string.
        return sBuilder.ToString();
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-06T01:54:22.433

我把你的代码放在一个控制台应用程序中并没有错误地运行它，得到了哈希并且测试文件在执行结束时被删除了？我只是使用我的测试应用程序中的 .pdb 作为文件。

您正在运行哪个版本的 .NET？

我把我有的代码放在这里，如果你把它放在 VS2008 .NET 3.5 sp1 的控制台应用程序中，它运行没有错误（至少对我来说）。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Security.Cryptography;
using System.IO;

namespace lockTest
{
    class Program
    {
        static void Main(string[] args)
        {
            string hash = GetHash("lockTest.pdb");

            Console.WriteLine("Hash: {0}", hash);

            Console.ReadKey();
        }

        public static string GetHash(string pathSrc)
        {
            string pathDest = "copy_" + pathSrc;

            File.Copy(pathSrc, pathDest, true);

            String md5Result;
            StringBuilder sb = new StringBuilder();
            MD5 md5Hasher = MD5.Create();

            using (FileStream fs = File.OpenRead(pathDest))
            {
                foreach (Byte b in md5Hasher.ComputeHash(fs))
                    sb.Append(b.ToString("x2").ToLower());
            }

            md5Result = sb.ToString();

            File.Delete(pathDest);

            return md5Result;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T00:28:28.443

您是否也尝试将 MD5 对象包装在 using() 中？从文档中，MD5 是一次性的。这可能会让它放开文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T01:38:52.110

[循环之后的md5hasher.Clear()](http://msdn.microsoft.com/en-us/library/system.security.cryptography.hashalgorithm.clear.aspx)可能会成功。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-06T00:31:13.897

您是否尝试在删除文件之前将 md5Hasher 设置为 null？它可能有一个仍然附加到 FileStream 的句柄（可能是内存泄漏）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-06T01:06:00.800

为什么不使用 FileShare.ReadWrite 打开文件？

# tree - 二叉词树

> ID：827535
> 
> 赞同：1
> 
> 时间：2009-05-06T00:27:37.803
> 
> 标签：tree, iterator, binary-tree

我上一堂cs课几乎没有吱吱作响，现在我在数据结构中。我正在从头开始构建一个二叉树结构，我对迭代器的工作方式有点困惑。我了解它们在双链表中的工作方式，但不确定这个将如何工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:07:37.780

所有其他答案都是关于如何在树结构上实现迭代器的技术讨论。但是，据我了解您的问题，您似乎无法理解树遍历概念的机制，而不仅仅是实现。换句话说，您不会“了解”树遍历。最有帮助的可能是获得一个好的伪代码算法来遍历二叉树、铅笔、一张纸，并计算出一个例子。构建一个简单的二叉树，然后自己机械地按照伪代码遍历它。您可能应该使用第二张纸来写出[堆栈](http://en.wikipedia.org/wiki/Call_stack)。也就是说，每个函数的状态，因为它正在等待子函数返回而被调用。

请记住，当你这样做时，一棵树是一个非常优雅的结构。它看起来很复杂，但在每个节点上都很简单。要对树中的所有元素执行操作，您只需在树的根部执行该操作，然后让该操作在该根的每个子节点上调用自身，这些子节点本身就是子树的根。自己设计一个例子将大大有助于让你的大脑理解和接受递归。如果您觉得很难，请不要感到困惑。递归很奇怪。一开始这是一个很难的概念，但有必要理解和使用树。

这是您可以用来启动的示例（ASCII 艺术）树：

```
      F
    / \
   / \
   DH
 / \ / \
 贝吉
/ \
交流电

```

还有一个简单的伪代码算法，您可以使用它以正确的顺序遍历编写所有字母。

```
过程遍历（节点）
    如果节点不为空：
        遍历（node.left）
        写节点.信
        遍历（node.right）
    别的：
        没做什么

```

您甚至可以从更简单的树开始。如果树只包含节点 D、F 和 H 怎么办？如果只有F呢？空值？尝试这些简单的示例，然后逐步构建更大的树。当您弄清楚如何始终如一且正确地执行此操作时，您不仅会对迭代器实现中发生的事情有一个非常好的感觉，而且您将对递归的力量有更好的理解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T00:34:28.320

“迭代器”是什么意思？如果您只需要迭代树，您可以递归地执行此操作： [http ://en.wikipedia.org/wiki/Tree_traversal#Sample_implementations](http://en.wikipedia.org/wiki/Tree_traversal#Sample_implementations)

如果您必须在 C# 或 Java 中提供 IEnumerator 接口，或者想要节省堆栈空间，请使用： [http](http://en.wikipedia.org/wiki/Tree_traversal#Queue-based_level_order_traversal) ://en.wikipedia.org/wiki/Tree_traversal#Queue-based_level_order_traversal 您可以在 C# 中使用 yield 或轻松转换while 循环进入迭代器所需的“GetNext”方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T00:47:33.123

我可以递归地做到这一点。我只是想在脑海中想象你是如何从一片叶子移动到另一片叶子的，因为从根开始有两种选择下一步去哪里，然后它只会增加 2^n 倍。这种工作方式的顺序让我感到困惑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T01:03:35.237

有两种主要的迭代树的方法。[我在Iterative tree walk](https://stackoverflow.com/questions/754439/iterative-tree-walking/754448#754448)发布了一些示例 Python 代码，说明如何做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T01:24:29.807

在二叉树中，每个节点都会存储一些值并有 2 个子节点，例如左节点和右节点。现在遍历树的一种方法是从顶部开始，遍历左孩子，查看该节点的值，然后遍历右孩子。

遍历**子**节点意味着（递归）：1）遍历左子节点 2）查看节点的值 3）遍历右子节点

这是深度优先遍历，因此对于每个节点，您首先“使用”或“查看”它的左子节点的值，然后是当前节点的值，最后是右子节点的值。

对于广度优先遍历，您将从根开始，查看节点的值，然后将其子节点（如果存在）推送到队列中。然后在队列中有一个节点时循环，从队列的前面获取节点并重复：查看它的值，如果它有子节点，则将它们推到队列的末尾。

python中的示例：

```
#!/usr/bin/env python

    class Node:
        def __init__(self, val = 0):
            self.value = val
            self.left = None
            self.right = None

        def __str__(self):
            return "%d" % (self.value)

    def dfs(node = None):
        if node is None: return

        dfs(node.left)
        print node
        dfs(node.right)

    def bfs(root = None):
        if root is None: return

        nodes = []
        nodes.append(root)

        while len(nodes):
            current = nodes[0]
            print current
            nodes.remove(current)

        if current.left is not None:
            nodes.append(current.left)
        if current.right is not None:
            nodes.append(current.right)

    def main():
        root = Node(0)
        root.left = Node(10)
        root.right = Node(20)

        l = root.left
        l.left = Node(100)
        l.right = Node(101)

        r = root.right
        r.left = Node(200)
        r.right = Node(201)

        dfs(root)
        bfs(root)

    if __name__ == '__main__':
        main()

# example tree constructed:
#            0
#      10        20
#  100   101  200  201

# dfs (depth first) traversal:
# 100
# 10
# 101
# 0
# 200
# 20
# 201

# bfs (breadth first) traversal:
# 0
# 10
# 20
# 100
# 101
# 200
# 201 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T01:41:23.993

我在我的数据结构类中遇到了同样的问题。

我的解决方案相当简单。

递归遍历树，但将您访问的每个节点存储在另一个集合中，然后迭代该新集合。这样，编写迭代器就没有什么棘手的了。

我个人选择使用堆栈，但你可以用一个简单的数组，甚至是一个链表（你说你已经有经验）来做到这一点。

# .net - 审批工作流程

> ID：827546
> 
> 赞同：0
> 
> 时间：2009-05-06T00:32:41.507
> 
> 标签：.net, sharepoint, workflow

我正在尝试在不发送任何电子邮件的情况下创建文档审批工作流程。我怎么知道文档已获得批准。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T01:04:30.400

是的，相当模糊，但我会试一试...如果您使用 MOSS 审批工作流程或只是内容审批（在 WSS 和 MOSS 中可用），列表/库中将有一个额外的列用于审批。您可以简单地确保您有一个包含此列的视图来查看该值。如果您希望在这种情况发生变化时收到警报，您可以创建一个视图来过滤那些已完成的内容，并为满足此视图的项目添加警报。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T00:35:35.600

太模糊了。请提供更多信息。听起来像是某种 BPM，但我不确定您的具体用途。

# c# - 在 oninit 事件中确定动态列创建的 DDL 值

> ID：827547
> 
> 赞同：1
> 
> 时间：2009-05-06T00:34:11.923
> 
> 标签：c#, asp.net, dynamic, viewstate

问候，希望有一个简单的解决方案来解决这个复杂的问题。请纠正我在此过程中的任何误解。不久前，我写了一个具有动态列功能的 GrivView。这些列是在 OnInit 页面事件中添加的，以便在应用视图状态之前添加它们。它们会在页面的这一部分中的每个帖子中重新应用，以便在应用视图状态时，用户已经做出但未提交到数据库的更改会得到维护。如果您不希望您的视图状态控制树不同步并炸毁所有内容，它也是必需的。

我目前的问题是，我现在的任务是做基本上相同的事情，其中​​列将基于下拉列表而有所不同（如果 ddl 更改，我将重新创建 GridView，并且用户将失去所有工作并发出警告）。如何获取在 OnInit 事件的下拉列表中选择的 ID？我的理解是，当用户在客户端更改 ddl 的值时，会触发 JavaScript“__doPostBack”调用。然后将页面请求发送到服务器，但是当新值出现在事件处理程序中时，我已经过了需要添加列的点。

当人们试图确定是什么控制导致回发但该代码依赖于 page.Request.Params.Get("__EVENTTARGET"); 时，我看到了一些我认为很有希望的东西。和 page.Request.Form 是空的。

我应该查看会话状态，尝试使用客户端操作或其他方法“发送”ID（也许是一种偷偷摸摸的方式来查看我缺少的视图状态）？

感谢您的任何想法！！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T03:03:39.007

控件的提交值可从 Request[] 集合中获得，即使您的表单似乎尚未重建。

您应该能够使用以下方法在 Init() 期间简单地获取选定的值：

```
string value = Request["myDropDownID"]; 
```

# java - 我需要清理传递给 NewStringUTF 的 char* 吗？

> ID：827549
> 
> 赞同：11
> 
> 时间：2009-05-06T00:35:24.633
> 
> 标签：java, java-native-interface

我认为是的，但我发现的前 12 个示例都做了一些不具说明性的事情，例如

```
JNIEXPORT jstring JCALL Java_com_foo_dumbImpl(JNIEnv* env, jobject thisObj)
{
  return (*env)->NewStringUTF(env, "constant string"); 
} 
```

所以为了后代我会问：这很糟糕，是吗？

```
JNIEXPORT jstring JCALL Java_com_foo_dumbImpl(JNIEnv* env, jobject thisObj)
{
  char *leak = malloc(1024);
  leak[0] = '\0';
  return (*env)->NewStringUTF(env, leak); 
} 
```

...并且应该是：

```
JNIEXPORT jstring JCALL Java_com_foo_dumbImpl(JNIEnv* env, jobject thisObj)
{
  char *emptystring = NULL;
  jstring r = NULL;
  emptystring = malloc(1024);
  emptystring[0] = '\0';
  r = (*env)->NewStringUTF(env, emptystring); 
  free(emptystring);
  emptystring = NULL;
  return  r;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-20T19:43:07.200

是的。（只是为了让这看起来没有答案。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-29T01:55:30.937

关注内存泄漏很好，但是，在这种情况下，没有泄漏（原始示例）。“常量字符串”是文字字符串；它不是从堆中分配的。

所以，不，您不需要清理传递的 char * （原始示例）。

您编辑的示例更适合说明您的观点。在编辑的示例中，是的，您需要清理传递的字符串。

# c++ - 为什么在 C++ 中显式调用构造函数

> ID：827552
> 
> 赞同：21
> 
> 时间：2009-05-06T00:35:50.110
> 
> 标签：c++, constructor

我知道我们可以使用范围解析运算符显式调用 C++ 中类的构造函数，即`className::className()`. 我想知道我到底需要在哪里打这样的电话。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-05-06T00:58:53.923

您有时还显式使用构造函数来构建临时对象。例如，如果您有一些带有构造函数的类：

```
class Foo
{
    Foo(char* c, int i);
}; 
```

和一个函数

```
void Bar(Foo foo); 
```

但你周围没有 Foo，你可以做

```
Bar(Foo("hello", 5)); 
```

这就像一个演员表。实际上，如果您有一个只接受一个参数的构造函数，C++ 编译器将使用该构造函数来执行隐式转换。

在已经存在的对象上调用构造函数是*不合法的。*也就是说，你不能做

```
Foo foo;
foo.Foo();  // compile error! 
```

无论你做什么。但是您可以在不分配内存的情况下调用构造函数——这就是*放置 new*的用途。

```
char buffer[sizeof(Foo)];      // a bit of memory
Foo* foo = new(buffer) Foo();  // construct a Foo inside buffer 
```

你给 new 一些内存，它在那个地方构造对象而不是分配新的内存。这种用法被认为是邪恶的，在大多数类型的代码中很少见，但在嵌入式和数据结构代码中很常见。

例如，`std::vector::push_back`使用此技术调用复制构造函数。这样，它只需要做一个副本，而不是创建一个空对象并使用赋值运算符。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-06T00:47:52.840

大多数情况下，在需要一些参数的子类构造函数中：

```
class BaseClass
{
public:
    BaseClass( const std::string& name ) : m_name( name ) { }

    const std::string& getName() const { return m_name; }

private:

    const std::string m_name;

//...

};

class DerivedClass : public BaseClass
{
public:

    DerivedClass( const std::string& name ) : BaseClass( name ) { }

// ...
};

class TestClass : 
{
public:
    TestClass( int testValue ); //...
};

class UniqueTestClass 
     : public BaseClass
     , public TestClass
{
public:
    UniqueTestClass() 
       : BaseClass( "UniqueTest" ) 
       , TestClass( 42 )
    { }

// ...
}; 
```

... 例如。

除此之外，我没有看到该实用程序。当我还太年轻不知道自己到底在做什么时，我才在其他代码中调用了构造函数……

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T01:13:19.223

我认为编译器错误 C2585 的错误消息给出了您需要在构造函数上实际使用范围解析运算符的最佳理由，并且它与查理的回答相符：

*从基于多重继承的类或结构类型转换。如果该类型多次继承同一个基类，则转换函数或运算符必须使用范围解析 (::) 来指定要在转换中使用哪个继承类。*

所以假设你有BaseClass，BaseClassA和BaseClassB都继承BaseClass，然后DerivedClass同时继承BaseClassA和BaseClassB。

如果您正在执行转换或运算符重载以将 DerivedClass 转换为 BaseClassA 或 BaseClassB，您将需要确定在转换中使用哪个构造函数（我在想像复制构造函数，IIRC 之类的东西）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T01:29:36.890

通常，您不会直接调用构造函数。new 运算符为您调用它，或者子类调用父类的构造函数。在 C++ 中，保证基类在派生类的构造函数启动之前完全构造。

唯一一次直接调用构造函数是在非常罕见的情况下，您在不使用 new 的情况下管理内存。即使那样，你也不应该这样做。相反，您应该使用 operator new 的放置形式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T00:45:39.320

我认为您通常不会将其用于构造函数，至少不会以您描述的方式使用。但是，如果您在不同的命名空间中有两个类，您将需要它。例如，要指定这两个组成的类之间的差异，`Xml::Element`并且`Chemistry::Element`.

通常，类的名称与作用域解析运算符一起使用，以调用继承类的父类上的函数。因此，如果您有一个继承自 Animal 的 Dog 类，并且这两个类都以不同的方式定义了函数 Eat()，那么您可能希望在名为“someDog”的 Dog 对象上使用 Animal 版本的 eat。我的 C++ 语法有点生疏，但我认为在这种情况下你会说`someDog.Animal::Eat()`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-13T18:11:22.023

在某些有效的用例中，您想要公开类构造函数。例如，如果您希望使用 arena 分配器进行自己的内存管理，则需要一个由分配和对象初始化组成的两阶段构造。

我采用的方法与许多其他语言的方法相似。我只是将我的构造代码放在众所周知的公共方法中（*Construct()*，*init()*，类似的东西），并在需要时直接调用它们。

您可以创建与构造函数匹配的这些方法的重载；您的常规构造函数只是调用它们。在代码中添加大注释以警告其他人您正在这样做，这样他们就不会在错误的地方添加重要的构造代码。

请记住，无论使用哪种构造重载，都只有一种析构函数方法，因此请使您的析构函数对未初始化的成员具有健壮性。

我建议不要尝试编写可以重新初始化的初始化程序。由于未初始化的内存与实际保存真实数据的情况，很难判断您正在查看的对象中是否包含垃圾。

最困难的问题来自具有虚拟方法的类。在这种情况下，编译器通常将 vtable 函数表指针作为隐藏字段插入到类的开头。您可以手动初始化此指针，但您基本上取决于编译器特定的行为，并且可能会让您的同事看着您很有趣。

新的安置在许多方面都被打破了；在数组的构造/销毁中是一种情况，所以我倾向于不使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-11T07:41:10.947

考虑以下程序。

```
template<class T>
double GetAverage(T tArray[], int nElements)
{
T tSum = T(); // tSum = 0

for (int nIndex = 0; nIndex < nElements; ++nIndex)
{
    tSum += tArray[nIndex];
}

// Whatever type of T is, convert to double
return double(tSum) / nElements;
} 
```

这将显式调用默认构造函数来初始化变量。

# python - 如何在 Python 中使用正则表达式验证 URL？

> ID：827557
> 
> 赞同：101
> 
> 时间：2009-05-06T00:40:30.830
> 
> 标签：python, regex, google-app-engine

我正在 Google App Engine 上构建一个应用程序。我对 Python 非常陌生，并且在过去 3 天里一直在努力解决以下问题。

我有一个类来表示一个 RSS 提要，在这个类中我有一个名为 setUrl 的方法。此方法的输入是 URL。

我正在尝试使用 re python 模块来验证 RFC 3986 Reg-ex ( [http://www.ietf.org/rfc/rfc3986.txt](http://www.ietf.org/rfc/rfc3986.txt) )

下面是一个*应该*工作的片段？

```
p = re.compile('^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?')
m = p.match(url)
if m:
  self.url = url
  return url 
```

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2009-05-07T15:59:04.360

这是解析 URL 的完整正则表达式。

```
(?:http://(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.
)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)
){3}))(?::(?:\d+))?)(?:/(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F
\d]{2}))|[;:@&=])*)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{
2}))|[;:@&=])*))*)(?:\?(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{
2}))|[;:@&=])*))?)?)|(?:ftp://(?:(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?
:%[a-fA-F\d]{2}))|[;?&=])*)(?::(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-
fA-F\d]{2}))|[;?&=])*))?@)?(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-
)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?
:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?))(?:/(?:(?:(?:(?:[a-zA-Z\d$\-_.+!
*'(),]|(?:%[a-fA-F\d]{2}))|[?:@&=])*)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'()
,]|(?:%[a-fA-F\d]{2}))|[?:@&=])*))*)(?:;type=[AIDaid])?)?)|(?:news:(?:
(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[;/?:&=])+@(?:(?:(
?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[
a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3})))|(?:[a-zA-Z](
?:[a-zA-Z\d]|[_.+-])*)|\*))|(?:nntp://(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[
a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d
])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?)/(?:[a-zA-Z](?:[a-zA-Z
\d]|[_.+-])*)(?:/(?:\d+))?)|(?:telnet://(?:(?:(?:(?:(?:[a-zA-Z\d$\-_.+
!*'(),]|(?:%[a-fA-F\d]{2}))|[;?&=])*)(?::(?:(?:(?:[a-zA-Z\d$\-_.+!*'()
,]|(?:%[a-fA-F\d]{2}))|[;?&=])*))?@)?(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a
-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d]
)?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?))/?)|(?:gopher://(?:(?:
(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:
(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+
))?)(?:/(?:[a-zA-Z\d$\-_.+!*'(),;/?:@&=]|(?:%[a-fA-F\d]{2}))(?:(?:(?:[
a-zA-Z\d$\-_.+!*'(),;/?:@&=]|(?:%[a-fA-F\d]{2}))*)(?:%09(?:(?:(?:[a-zA
-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[;:@&=])*)(?:%09(?:(?:[a-zA-Z\d$
\-_.+!*'(),;/?:@&=]|(?:%[a-fA-F\d]{2}))*))?)?)?)?)|(?:wais://(?:(?:(?:
(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:
[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?
)/(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))*)(?:(?:/(?:(?:[a-zA
-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))*)/(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(
?:%[a-fA-F\d]{2}))*))|\?(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]
{2}))|[;:@&=])*))?)|(?:mailto:(?:(?:[a-zA-Z\d$\-_.+!*'(),;/?:@&=]|(?:%
[a-fA-F\d]{2}))+))|(?:file://(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]
|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:
(?:\d+)(?:\.(?:\d+)){3}))|localhost)?/(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'()
,]|(?:%[a-fA-F\d]{2}))|[?:@&=])*)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(
?:%[a-fA-F\d]{2}))|[?:@&=])*))*))|(?:prospero://(?:(?:(?:(?:(?:[a-zA-Z
\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)
*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?)/(?:(?:(?:(?
:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[?:@&=])*)(?:/(?:(?:(?:[a-
zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[?:@&=])*))*)(?:(?:;(?:(?:(?:[
a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[?:@&])*)=(?:(?:(?:[a-zA-Z\d
$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[?:@&])*)))*)|(?:ldap://(?:(?:(?:(?:
(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?:
[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))?
))?/(?:(?:(?:(?:(?:(?:(?:[a-zA-Z\d]|%(?:3\d|[46][a-fA-F\d]|[57][Aa\d])
)|(?:%20))+|(?:OID|oid)\.(?:(?:\d+)(?:\.(?:\d+))*))(?:(?:%0[Aa])?(?:%2
0)*)=(?:(?:%0[Aa])?(?:%20)*))?(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F
\d]{2}))*))(?:(?:(?:%0[Aa])?(?:%20)*)\+(?:(?:%0[Aa])?(?:%20)*)(?:(?:(?
:(?:(?:[a-zA-Z\d]|%(?:3\d|[46][a-fA-F\d]|[57][Aa\d]))|(?:%20))+|(?:OID
|oid)\.(?:(?:\d+)(?:\.(?:\d+))*))(?:(?:%0[Aa])?(?:%20)*)=(?:(?:%0[Aa])
?(?:%20)*))?(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))*)))*)(?:(
?:(?:(?:%0[Aa])?(?:%20)*)(?:[;,])(?:(?:%0[Aa])?(?:%20)*))(?:(?:(?:(?:(
?:(?:[a-zA-Z\d]|%(?:3\d|[46][a-fA-F\d]|[57][Aa\d]))|(?:%20))+|(?:OID|o
id)\.(?:(?:\d+)(?:\.(?:\d+))*))(?:(?:%0[Aa])?(?:%20)*)=(?:(?:%0[Aa])?(
?:%20)*))?(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))*))(?:(?:(?:
%0[Aa])?(?:%20)*)\+(?:(?:%0[Aa])?(?:%20)*)(?:(?:(?:(?:(?:[a-zA-Z\d]|%(
?:3\d|[46][a-fA-F\d]|[57][Aa\d]))|(?:%20))+|(?:OID|oid)\.(?:(?:\d+)(?:
\.(?:\d+))*))(?:(?:%0[Aa])?(?:%20)*)=(?:(?:%0[Aa])?(?:%20)*))?(?:(?:[a
-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))*)))*))*(?:(?:(?:%0[Aa])?(?:%2
0)*)(?:[;,])(?:(?:%0[Aa])?(?:%20)*))?)(?:\?(?:(?:(?:(?:[a-zA-Z\d$\-_.+
!*'(),]|(?:%[a-fA-F\d]{2}))+)(?:,(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-f
A-F\d]{2}))+))*)?)(?:\?(?:base|one|sub)(?:\?(?:((?:[a-zA-Z\d$\-_.+!*'(
),;/?:@&=]|(?:%[a-fA-F\d]{2}))+)))?)?)?)|(?:(?:z39\.50[rs])://(?:(?:(?
:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?)\.)*(?:[a-zA-Z](?:(?
:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:\d+)){3}))(?::(?:\d+))
?)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))+)(?:\+(?:(?:
[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))+))*(?:\?(?:(?:[a-zA-Z\d$\-_
.+!*'(),]|(?:%[a-fA-F\d]{2}))+))?)?(?:;esn=(?:(?:[a-zA-Z\d$\-_.+!*'(),
]|(?:%[a-fA-F\d]{2}))+))?(?:;rs=(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA
-F\d]{2}))+)(?:\+(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))+))*)
?))|(?:cid:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[;?:@&=
])*))|(?:mid:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[;?:@
&=])*)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[;?:@&=]
)*))?)|(?:vemmi://(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z
\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\
.(?:\d+)){3}))(?::(?:\d+))?)(?:/(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a
-fA-F\d]{2}))|[/?:@&=])*)(?:(?:;(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a
-fA-F\d]{2}))|[/?:@&])*)=(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d
]{2}))|[/?:@&])*))*))?)|(?:imap://(?:(?:(?:(?:(?:(?:(?:[a-zA-Z\d$\-_.+
!*'(),]|(?:%[a-fA-F\d]{2}))|[&=~])+)(?:(?:;[Aa][Uu][Tt][Hh]=(?:\*|(?:(
?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[&=~])+))))?)|(?:(?:;[
Aa][Uu][Tt][Hh]=(?:\*|(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2
}))|[&=~])+)))(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[
&=~])+))?))@)?(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])
?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:\.(?:
\d+)){3}))(?::(?:\d+))?))/(?:(?:(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:
%[a-fA-F\d]{2}))|[&=~:@/])+)?;[Tt][Yy][Pp][Ee]=(?:[Ll](?:[Ii][Ss][Tt]|
[Ss][Uu][Bb])))|(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))
|[&=~:@/])+)(?:\?(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[
&=~:@/])+))?(?:(?:;[Uu][Ii][Dd][Vv][Aa][Ll][Ii][Dd][Ii][Tt][Yy]=(?:[1-
9]\d*)))?)|(?:(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[&=~
:@/])+)(?:(?:;[Uu][Ii][Dd][Vv][Aa][Ll][Ii][Dd][Ii][Tt][Yy]=(?:[1-9]\d*
)))?(?:/;[Uu][Ii][Dd]=(?:[1-9]\d*))(?:(?:/;[Ss][Ee][Cc][Tt][Ii][Oo][Nn
]=(?:(?:(?:[a-zA-Z\d$\-_.+!*'(),]|(?:%[a-fA-F\d]{2}))|[&=~:@/])+)))?))
)?)|(?:nfs:(?:(?://(?:(?:(?:(?:(?:[a-zA-Z\d](?:(?:[a-zA-Z\d]|-)*[a-zA-
Z\d])?)\.)*(?:[a-zA-Z](?:(?:[a-zA-Z\d]|-)*[a-zA-Z\d])?))|(?:(?:\d+)(?:
\.(?:\d+)){3}))(?::(?:\d+))?)(?:(?:/(?:(?:(?:(?:(?:[a-zA-Z\d\$\-_.!~*'
(),])|(?:%[a-fA-F\d]{2})|[:@&=+])*)(?:/(?:(?:(?:[a-zA-Z\d\$\-_.!~*'(),
])|(?:%[a-fA-F\d]{2})|[:@&=+])*))*)?)))?)|(?:/(?:(?:(?:(?:(?:[a-zA-Z\d
\$\-_.!~*'(),])|(?:%[a-fA-F\d]{2})|[:@&=+])*)(?:/(?:(?:(?:[a-zA-Z\d\$\
-_.!~*'(),])|(?:%[a-fA-F\d]{2})|[:@&=+])*))*)?))|(?:(?:(?:(?:(?:[a-zA-
Z\d\$\-_.!~*'(),])|(?:%[a-fA-F\d]{2})|[:@&=+])*)(?:/(?:(?:(?:[a-zA-Z\d
\$\-_.!~*'(),])|(?:%[a-fA-F\d]{2})|[:@&=+])*))*)?))) 
```

鉴于其复杂性，我认为您应该采用 urlparse 方式。

为了完整起见，这是上述正则表达式的伪 BNF（作为文档）：

```
; URL 的一般形式是：

genericurl = 方案“：”方案部分

; 具体的预定义方案在这里定义；新计划
; 可以在 IANA 注册

网址 = httpurl | ftpurl | 新闻网址 |
                 nntpurl | 远程网址 | gopherurl |
                 waisurl | 邮件地址 | 文件网址 |
                 繁荣 | 其他网址

; 新方案遵循一般语法
其他网址 = 通用网址

; 该方案是小写的；口译员应该使用大小写忽略
方案 = 1 * [低阿尔法 | 数字 | "+" | "-" | “。” ]
方案部分 = *xchar | ip-schemepart

; 基于 ip 的协议的 URL 方案部分：

ip-schemepart = "//" 登录 ["/" urlpath ]

登录 = [ 用户 [ ":" 密码 ] "@" ] 主机端口
主机端口=主机[“：”端口]
主机 = 主机名 | 主机号
主机名 = *[ 域标签“。” ] 顶部标签
域标签 = 字母数字 | 字母数字 * [ 字母数字 | "-" ] 字母数字
顶部标签 = 阿尔法 | 字母 * [ 字母数字 | "-" ] 字母数字
alphadigit = alpha | 数字
主机号 = 数字“。” 数字“。” 数字“。” 数字
端口 = 数字
用户 = *[ uchar | “;” | “？” | "&" | “=”]
密码 = *[ uchar | “;” | “？” | "&" | “=”]
urlpath = *xchar ; 取决于协议参见第 3.1 节

; 预定义方案：

; FTP（另见 RFC959）

ftpurl = "ftp://" 登录 [ "/" fpath [ ";type=" ftptype ]]
fpath = fsegment *[ "/" fsegment ]
fsegment = *[ uchar | “？” | “：” | "@" | "&" | “=”]
ftptype = "A" | “我” | "D" | “一个” | “我” | “d”

; 文件

fileurl =“文件：//”[主机| "localhost" ] "/" fpath

; HTTP

httpurl = "http://" 主机端口 [ "/" hpath [ "?" 搜索 ]]
hpath = hsegment *[ "/" hsegment ]
hsegment = *[ uchar | “;” | “：” | "@" | "&" | “=”]
搜索 = *[ uchar | “;” | “：” | "@" | "&" | “=”]

; GOPHER（另见 RFC1436）

gopherurl = "gopher://" 主机端口 [ / [ gtype [ 选择器
                 [ "%09" 搜索 ["%09" gopher+_string ] ] ] ]
gtype = xchar
选择器 = *xchar
gopher+_string = *xchar

; MAILTO（另见 RFC822）

mailtourl = "mailto:" 编码822addr
编码822addr = 1*xchar ; 在 RFC822 中进一步定义

; 新闻（另见 RFC1036）

newsurl = "新闻：" grouppart
grouppart = "*" | 集团 | 文章
组=阿尔法* [阿尔法| 数字 | "-" | “。” | "+" | “_”]
文章 = 1*[ uchar | “;” | "/" | “？” | “：” | "&" | "=" ] "@" 主机

; NNTP（另见 RFC977）

nntpurl =“nntp://”主机端口“/”组[“/”位]

; 远程网络

telneturl = "telnet://" 登录 [ "/" ]

; WAIS（另见 RFC1625）

waisurl = wais 数据库 | 腰指数 | 怀斯多克
waisdatabase = "wais://" 主机端口 "/" 数据库
waisindex = "wais://" 主机端口 "/" 数据库 "?" 搜索
waisdoc = "wais://" 主机端口 "/" 数据库 "/" wtype "/" wpath
数据库 = *uchar
wtype = *uchar
wpath = *uchar

; 普洛斯彼罗

prosperourl = "prospero://" hostport "/" ppath *[ fieldspec ]
ppath = psegment *[ "/" psegment ]
psegment = *[ uchar | “？” | “：” | "@" | "&" | “=”]
字段规格 = ";" 字段名“=”字段值
字段名 = *[ uchar | “？” | “：” | "@" | "&"]
字段值 = *[ uchar | “？” | “：” | "@" | "&"]

; 杂项定义

低阿尔法=“一个”| "b" | "c" | "d" | "e" | "f" | "g" | "h" |
                 “我” | "j" | "k" | "l" | “米” | "n" | "o" | "p" |
                 “问” | "r" | "s" | "t" | “你” | "v" | "w" | "x" |
                 "是" | “z”
hialpha = "A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" | “我” |
                 “J” | "K" | “大号” | "M" | "N" | “哦” | "P" | “问” | "R" |
                 "S" | "T" | “你” | "V" | "W" | "X" | “是” | “Z”
阿尔法 = 低阿尔法 | 高阿尔法
数字 = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" |
                 "8" | “9”
安全 = "$" | "-" | "_" | “。” | “+”
额外=“！” | "*" | "'" | "(" | ")" | ","
国家=“{”| "}" | “|” | "\" | "^" | "~" | "[" | "]" | “`”
标点符号 = "" | "#" | "%" |

保留=“;” | "/" | “？” | “：” | "@" | "&" | “=”
十六进制 = 数字 | “一个” | "B" | "C" | "D" | "E" | "F" |
                 “一个” | "b" | "c" | "d" | "e" | “F”
转义 = "%" 十六进制 十六进制

无保留=阿尔法| 数字 | 安全 | 额外的
uchar = 未保留 | 逃脱
xchar = 未保留 | 保留 | 逃脱
数字 = 1*数字

```

* * *

## 回答 #2

> 赞同：156
> 
> 时间：2009-05-06T01:09:19.547

解析（和验证）URL 的一种简单方法是`urlparse`( [py2](https://docs.python.org/2/library/urlparse.html) , [py3](https://docs.python.org/3.0/library/urllib.parse.html) ) 模块。

正则表达式工作量太大。

* * *

没有“验证”方法，因为几乎任何东西都是有效的 URL。有一些标点符号规则可以将其拆分。没有任何标点符号，您仍然有一个有效的 URL。

仔细检查 RFC，看看你是否可以构造一个“无效”的 URL。规则非常灵活。

例如`:::::`是一个有效的 URL。路径是`":::::"`。一个非常愚蠢的文件名，但是一个有效的文件名。

此外，`/////`是一个有效的 URL。netloc（“主机名”）是`""`. 路径是`"///"`。再次，愚蠢。也有效。此 URL 规范化到`"///"`哪个是等效的。

类似的东西`"bad://///worse/////"`是完全有效的。愚蠢但有效。

**底线**。解析它，并查看这些片段，看看它们是否以某种方式令人不快。

您是否希望该方案始终为“http”？您是否希望 netloc 始终为“www.somename.somedomain”？你想让路径看起来像 unix 吗？还是类似窗户的？是否要删除查询字符串？还是保存？

这些不是 RFC 指定的验证。这些是您的应用程序独有的验证。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2011-11-03T13:49:07.600

我正在使用 Django 使用的那个，它似乎工作得很好：

```
def is_valid_url(url):
    import re
    regex = re.compile(
        r'^https?://'  # http:// or https://
        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|'  # domain...
        r'localhost|'  # localhost...
        r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})' # ...or ip
        r'(?::\d+)?'  # optional port
        r'(?:/?|[/?]\S+)$', re.IGNORECASE)
    return url is not None and regex.search(url) 
```

您可以随时在此处查看最新版本：[https ://github.com/django/django/blob/master/django/core/validators.py#L74](https://github.com/django/django/blob/master/django/core/validators.py#L74)

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-05-06T01:18:04.923

我承认，我发现您的正则表达式完全无法理解。我想知道你是否可以使用 urlparse 代替？就像是：

```
pieces = urlparse.urlparse(url)
assert all([pieces.scheme, pieces.netloc])
assert set(pieces.netloc) <= set(string.letters + string.digits + '-.')  # and others?
assert pieces.scheme in ['http', 'https', 'ftp']  # etc. 
```

[它可能会更慢，也许你会错过条件，但它似乎（对我来说）比URLs 的正则表达式](https://blog.codinghorror.com/the-problem-with-urls/)更容易阅读和调试。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-12-14T11:54:33.807

如今，在 90% 的情况下，如果您在 Python 中使用 URL，您可能会使用 python-requests。因此这里的问题是——为什么不重用请求中的 URL 验证？

```
from requests.models import PreparedRequest
import requests.exceptions

def check_url(url):
    prepared_request = PreparedRequest()
    try:
        prepared_request.prepare_url(url, None)
        return prepared_request.url
    except requests.exceptions.MissingSchema, e:
        raise SomeException 
```

特征：

*   不要重新发明轮子
*   干燥
*   离线办公
*   最少的资源

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-03-12T09:11:04.480

`urlparse`很高兴接受无效的 URL，它比任何类型的验证器更像是一个字符串拆分库。例如：

```
from urlparse import urlparse
urlparse('http://----')
# returns: ParseResult(scheme='http', netloc='----', path='', params='', query='', fragment='') 
```

根据情况，这可能很好..

如果您主要信任数据，并且只想验证协议是 HTTP，那么`urlparse`是完美的。

如果要使 URL 实际上是合法的 URL，请使用[可笑的正则表达式](https://stackoverflow.com/questions/827557/how-do-you-validate-a-url-with-a-regular-expression-in-python/835527#835527)

如果你想确保它是一个真实的网址，

```
import urllib
try:
    urllib.urlopen(url)
except IOError:
    print "Not a real URL" 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-03-23T10:31:27.183

[http://pypi.python.org/pypi/rfc3987](http://pypi.python.org/pypi/rfc3987)提供正则表达式以与 RFC 3986 和 RFC 3987 中的规则保持一致（即不与特定于方案的规则保持一致）。

IRI_reference 的正则表达式是：

```
(?P<scheme>[a-zA-Z][a-zA-Z0-9+.-]*):(?://(?P<iauthority>(?:(?P<iuserinfo>(?:(?:[
a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U0002
0000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U
00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009ff
fd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U00
0dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:)*)@)?(?P<ihost>\
\[(?:(?:[0-9A-F]{1,4}:){6}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4]
[0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|::(?:[0
-9A-F]{1,4}:){5}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]
?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|[0-9A-F]{1,4}?::(
?:[0-9A-F]{1,4}:){4}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|
[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F
]{1,4}:)?[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){3}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?
:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[
0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,2}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){2}(?:
[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3
}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,3}[0-9A-F]{1,
4})?::(?:[0-9A-F]{1,4}:)(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0
-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-
9A-F]{1,4}:){,4}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]
|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|
(?:(?:[0-9A-F]{1,4}:){,5}[0-9A-F]{1,4})?::[0-9A-F]{1,4}|(?:(?:[0-9A-F]{1,4}:){,6
}[0-9A-F]{1,4})?::|v[0-9A-F]+\\.(?:[a-zA-Z0-9_.~-]|[!$&'()*+,;=]|:)+)\\]|(?:(?:(
?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][
0-9]?))|(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\
U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U000500
00-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00
090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd
\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=])*)(
?::(?P<port>[0-9]*))?)(?P<ipath>(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\uf
dcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\
U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007f
ffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U0
00bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-
F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>/(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7
ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000
-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U0007
0000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U
000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000eff
fd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff
\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\
U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U000700
00-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U00
0b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd
])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)?)|(?P<ipath>(?:(?:[a-zA-Z0-9._~-]|[\
xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U
00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006ff
fd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U00
0afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-
\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa
0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00
030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd
\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000a
fffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U
000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>))(?:\\?(?P<iquery
>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U000
1fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\
U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U000900
00-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U00
0d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|[\
ue000-\uf8ff\U000f0000-\U000ffffd\U00100000-\U0010fffd]|/|\\?)*))?(?:\\#(?P<ifra
gment>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-
\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050
000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U0
0090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfff
d\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|
@)|/|\\?)*))?|(?:(?://(?P<iauthority>(?:(?P<iuserinfo>(?:(?:[a-zA-Z0-9._~-]|[\xa
0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00
030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd
\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000a
fffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U
000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:)*)@)?(?P<ihost>\\[(?:(?:[0-9A-F]{1,
4}:){6}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-
9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|::(?:[0-9A-F]{1,4}:){5}(?:
[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3
}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|[0-9A-F]{1,4}?::(?:[0-9A-F]{1,4}:){4
}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\
.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:)?[0-9A-F]{1
,4})?::(?:[0-9A-F]{1,4}:){3}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-
4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?
:[0-9A-F]{1,4}:){,2}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){2}(?:[0-9A-F]{1,4}:[0-9A
-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][
0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,3}[0-9A-F]{1,4})?::(?:[0-9A-F]{1
,4}:)(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]
?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,4}[0-
9A-F]{1,4})?::(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[
0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}
:){,5}[0-9A-F]{1,4})?::[0-9A-F]{1,4}|(?:(?:[0-9A-F]{1,4}:){,6}[0-9A-F]{1,4})?::|
v[0-9A-F]+\\.(?:[a-zA-Z0-9_.~-]|[!$&'()*+,;=]|:)+)\\]|(?:(?:(?:25[0-5]|2[0-4][0-
9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[a-zA
-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000
-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U0006
0000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U
000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dff
fd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=])*)(?::(?P<port>[0-9]*)
)?)(?P<ipath>(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U0
0010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fff
d\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U000
8fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\
U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*
+,;=]|:|@)*)*)|(?P<ipath>/(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufd
f0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U000400
00-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00
080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd
\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A
-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0
-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000
-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U0008
0000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U
000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F
]|[!$&'()*+,;=]|:|@)*)*)?)|(?P<ipath>(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\u
fdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd
\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007
fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U
000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A
-F][0-9A-F]|[!$&'()*+,;=]|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf
\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00
040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd
\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000b
fffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][
0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>))(?:\\?(?P<iquery>(?:(?:(?:[a-zA-Z0-9.
_~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U000
2fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\
U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a00
00-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U00
0e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|[\ue000-\uf8ff\U000f000
0-\U000ffffd\U00100000-\U0010fffd]|/|\\?)*))?(?:\\#(?P<ifragment>(?:(?:(?:[a-zA-
Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-
\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060
000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U0
00a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfff
d\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|/|\\?)*))?) 
```

在一行中：

```
(?P<scheme>[a-zA-Z][a-zA-Z0-9+.-]*):(?://(?P<iauthority>(?:(?P<iuserinfo>(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:)*)@)?(?P<ihost>\\[(?:(?:[0-9A-F]{1,4}:){6}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|::(?:[0-9A-F]{1,4}:){5}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|[0-9A-F]{1,4}?::(?:[0-9A-F]{1,4}:){4}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:)?[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){3}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,2}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){2}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,3}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:)(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,4}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,5}[0-9A-F]{1,4})?::[0-9A-F]{1,4}|(?:(?:[0-9A-F]{1,4}:){,6}[0-9A-F]{1,4})?::|v[0-9A-F]+\\.(?:[a-zA-Z0-9_.~-]|[!$&'()*+,;=]|:)+)\\]|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=])*)(?::(?P<port>[0-9]*))?)(?P<ipath>(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>/(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)?)|(?P<ipath>(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>))(?:\\?(?P<iquery>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|[\ue000-\uf8ff\U000f0000-\U000ffffd\U00100000-\U0010fffd]|/|\\?)*))?(?:\\#(?P<ifragment>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|/|\\?)*))?|(?:(?://(?P<iauthority>(?:(?P<iuserinfo>(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:)*)@)?(?P<ihost>\\[(?:(?:[0-9A-F]{1,4}:){6}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|::(?:[0-9A-F]{1,4}:){5}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|[0-9A-F]{1,4}?::(?:[0-9A-F]{1,4}:){4}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:)?[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){3}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,2}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:){2}(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,3}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:)(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,4}[0-9A-F]{1,4})?::(?:[0-9A-F]{1,4}:[0-9A-F]{1,4}|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)))|(?:(?:[0-9A-F]{1,4}:){,5}[0-9A-F]{1,4})?::[0-9A-F]{1,4}|(?:(?:[0-9A-F]{1,4}:){,6}[0-9A-F]{1,4})?::|v[0-9A-F]+\\.(?:[a-zA-Z0-9_.~-]|[!$&'()*+,;=]|:)+)\\]|(?:(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=])*)(?::(?P<port>[0-9]*))?)(?P<ipath>(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>/(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)?)|(?P<ipath>(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|@)+(?:/(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)*)*)|(?P<ipath>))(?:\\?(?P<iquery>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|[\ue000-\uf8ff\U000f0000-\U000ffffd\U00100000-\U0010fffd]|/|\\?)*))?(?:\\#(?P<ifragment>(?:(?:(?:[a-zA-Z0-9._~-]|[\xa0-\ud7ff\uf900-\ufdcf\ufdf0-\uffef\U00010000-\U0001fffd\U00020000-\U0002fffd\U00030000-\U0003fffd\U00040000-\U0004fffd\U00050000-\U0005fffd\U00060000-\U0006fffd\U00070000-\U0007fffd\U00080000-\U0008fffd\U00090000-\U0009fffd\U000a0000-\U000afffd\U000b0000-\U000bfffd\U000c0000-\U000cfffd\U000d0000-\U000dfffd\U000e1000-\U000efffd])|%[0-9A-F][0-9A-F]|[!$&'()*+,;=]|:|@)|/|\\?)*))?) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-05-03T13:18:59.763

**注意**- Lepl 不再被维护或支持。

RFC 3696 定义了 URL 验证的“最佳实践” - [http://www.faqs.org/rfcs/rfc3696.html](http://www.faqs.org/rfcs/rfc3696.html)

最新版本的 Lepl（一个 Python 解析器库）包括一个 RFC 3696 的实现。你可以像这样使用它：

```
from lepl.apps.rfc3696 import Email, HttpUrl

# compile the validators (do once at start of program)
valid_email = Email()
valid_http_url = HttpUrl()

# use the validators (as often as you like)
if valid_email(some_email):
    # email is ok
else:
    # email is bad
if valid_http_url(some_url):
    # url is ok
else:
    # url is bad 
```

尽管验证器是在递归下降解析器 Lepl 中定义的，但它们主要在内部编译为正则表达式。这结合了两全其美 - 一个（相对）易于阅读的定义，可以根据 RFC 3696 进行检查*和*一个有效的实现。我的博客上有一篇文章展示了这如何简化解析器 - [http://www.acooke.org/cute/LEPLOptimi0.html](http://www.acooke.org/cute/LEPLOptimi0.html)

Lepl 可在[http://www.acooke.org/lepl](http://www.acooke.org/lepl)获得，RFC 3696 模块记录在[http://www.acooke.org/lepl/rfc3696.html](http://www.acooke.org/lepl/rfc3696.html)

这是此版本中的全新内容，因此可能包含错误。如果您有任何问题，请与我联系，我会尽快解决。谢谢。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-06T00:55:26.927

[提供的正则表达式应与http://www.ietf.org/rfc/rfc3986.txt](http://www.ietf.org/rfc/rfc3986.txt)形式的任何 url 匹配；并且在 python 解释器中测试时确实如此。

您在解析时遇到问题的 URL 采用什么格式？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-03-08T16:11:07.800

# 修改 django url 验证正则表达式：

```
import re

ul = '\u00a1-\uffff'  # unicode letters range (must not be a raw string)

# IP patterns 
ipv4_re = r'(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)(?:\.(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}' 
ipv6_re = r'\[[0-9a-f:\.]+\]'

# Host patterns 
hostname_re = r'[a-z' + ul + r'0-9](?:[a-z' + ul + r'0-9-]{0,61}[a-z' + ul + r'0-9])?'
domain_re = r'(?:\.(?!-)[a-z' + ul + r'0-9-]{1,63}(?<!-))*' # domain names have max length of 63 characters
tld_re = ( 
    r'\.'                                # dot 
    r'(?!-)'                             # can't start with a dash 
    r'(?:[a-z' + ul + '-]{2,63}'         # domain label 
    r'|xn--[a-z0-9]{1,59})'              # or punycode label 
    r'(?<!-)'                            # can't end with a dash 
    r'\.?'                               # may have a trailing dot 
) 
host_re = '(' + hostname_re + domain_re + tld_re + '|localhost)'

regex = re.compile( 
    r'^(?:http|ftp)s?://' # http(s):// or ftp(s)://
    r'(?:\S+(?::\S*)?@)?'  # user:pass authentication 
    r'(?:' + ipv4_re + '|' + ipv6_re + '|' + host_re + ')' # localhost or ip
    r'(?::\d{2,5})?'  # optional port
    r'(?:[/?#][^\s]*)?'  # resource path
    r'\Z', re.IGNORECASE) 
```

来源：[https ://github.com/django/django/blob/master/django/core/validators.py#L74](https://github.com/django/django/blob/master/django/core/validators.py#L74)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-06T01:23:09.170

多年来，我需要多次这样做，并且总是最终复制其他人的正则表达式，他们对此的想法比我*想*的要多。

话虽如此，Django表单代码中有一个正则表达式应该可以解决问题：

[http://code.djangoproject.com/browser/django/trunk/django/forms/fields.py#L534](http://code.djangoproject.com/browser/django/trunk/django/forms/fields.py#L534)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-06T00:58:19.540

```
urlfinders = [
    re.compile("([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}|(((news|telnet|nttp|file|http|ftp|https)://)|(www|ftp)[-A-Za-z0-9]*\\.)[-A-Za-z0-9\\.]+)(:[0-9]*)?/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*[^]'\\.}>\\),\\\"]"),
    re.compile("([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}|(((news|telnet|nttp|file|http|ftp|https)://)|(www|ftp)[-A-Za-z0-9]*\\.)[-A-Za-z0-9\\.]+)(:[0-9]*)?"),
    re.compile("(~/|/|\\./)([-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]|\\\\
)+"),
    re.compile("'\\<((mailto:)|)[-A-Za-z0-9\\.]+@[-A-Za-z0-9\\.]+"),
] 
```

注意：在浏览器中看起来很丑，只需复制粘贴即可，格式应该很好

在 python 邮件列表中找到并用于 gnome-terminal

来源： http: [//mail.python.org/pipermail/python-list/2007-January/595436.html](http://mail.python.org/pipermail/python-list/2007-January/595436.html)

# c# - 使用 LINQ 在一行代码中对数组中的每个对象进行类型转换

> ID：827565
> 
> 赞同：0
> 
> 时间：2009-05-06T00:44:31.320
> 
> 标签：c#, linq

假设我有一个数组`User`：

```
class User : IUserDowngraded
{
    public Int32 Id { get; set; }
} 
```

...通过将对象转换为特定接口来完成降级功能：

```
interface IUserDowngraded
{
    Int32 Id { get; } // removes set functionality from property
} 
```

...如何使用 LINQ 将那些降级的对象 ( `IUserDowngraded`) 转换`User`为单行代码中的对象？

我要避免的是：

```
// pseudo-code alert:
IUserDowngraded[] downgradedUsers { IUserDowngraded, IUserDowngraded, ... };

var upgradedUsers = new User[downgradedUsers.Count()];

Int32 i = 0;

foreach (IUserDowngraded du in downgradedUsers)
{
    upgradedUsers[i] = (User)user;

    i++;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T00:47:15.060

```
var upgradedUsers = downgradedUsers.Cast<User>(); 
```

`ToArray()`当然，如果您想要`upgradedUsers`作为数组，请附加调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T00:48:45.833

[使用 cast 方法....](http://www.linqexchange.com/post/2008/05/How-to-Convert-a-Collection-From-One-Type-to-Another-Type-Using-LINQ-Cast.aspx)

```
SampleIntList = SampleStringList.Cast<int>().Select(x => Convert.ToInt32(x)).ToList(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T00:49:56.067

此外，任何[隐式运算符、Linq 和 Lambda 表达式都会降低代码的可读性。但是什么更具可读性？](https://stackoverflow.com/questions/809533/implicit-operators-linq-and-lambda-expressions-can-make-code-less-readable-but)方法应该有效。

# c# - Silverlight 应用程序中对象的动态更新？

> ID：827574
> 
> 赞同：1
> 
> 时间：2009-05-06T00:48:58.783
> 
> 标签：c#, .net, asp.net, silverlight, graphics

也许我只是想多了，需要写更多的原型代码，但我想得到你的一些想法：

基本上，该应用程序将在 X/Y“网格”中显示多达数百个自定义视觉对象。其中一些对象的位置和属性可能会在更新之间发生变化；该应用程序将通过大约每分钟进行的 Web 服务调用定期检索更新。

我的问题是，在客户端处理这些更新的最佳方式是什么？我考虑过查找每个对象并直接更新它，或者构建将在后台线程中更新的数据对象“树”——一旦在后台应用了所有更新，将根据数据重新创建显示的对象在树上”。

任何人都可以以一种或另一种方式提供任何建议吗？是否有任何适合的 Silverlight 设计模式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T00:55:09.173

我将使用数据层并绑定到 XAML（ala mvc 模型）中的属性，并将您的对象基于 INotifyPropertyChanged，然后 UI 将在您的数据更新时自动更新它们。只需确保将新值与现有值进行比较

```
int SomeNumber 
{
    get { return this.m_someInt; }
    set { if ( value != this.m_someInt ) 
    {
        this.m_someInt = value;
        NotifyChange("SomeNumber");
    } 
}

NotifyChange( string propName )
{
.....
} 
```

# mysql - 编辑了一个 JOIN 查询，以便一个具有唯一值的字段

> ID：827590
> 
> 赞同：1
> 
> 时间：2009-05-06T00:57:45.890
> 
> 标签：mysql

我有一个 JOIN 查询，它提取最后 6 个“主题”记录（具有最高 topic_ids 的记录的 topic_status 为 0，即它不是垃圾邮件）：

```
SELECT topic_title, topic_slug, meta_value, topic_poster
FROM `folio_topics` as Topics
INNER JOIN `folio_topicmeta` as Topicmeta
ON Topics.topic_id = Topicmeta.topic_id
WHERE `topic_status` = 0
AND Topicmeta.meta_key = 'bb_attach_thumb'
ORDER BY Topics.`topic_id` DESC
LIMIT 6 
```

我想编辑这个查询，使 folio_topics.topic_poster 字段是唯一的，即我没有得到 6 条具有相同 topic_poster 的记录，而是 6 条记录，所有这些记录都具有唯一的 topic_poster 值。

任何帮助，将不胜感激！:-)

* * *

根据 Vincent 的回答，我提出了一个查询，该查询正确地为每个 topic_poster 提取了*最高*topic_id，但它需要 8.7 秒，与大多数查询（不到 0.1 秒）相比，这非常慢。有没有办法优化这个查询？

```
SELECT topic_title, topic_slug, meta_value, topic_poster
FROM `folio_topics` AS Topics
INNER JOIN `folio_topicmeta` AS Topicmeta
ON Topics.topic_id = Topicmeta.topic_id
WHERE Topics.topic_id IN (
    SELECT MAX(`topic_id`)
    FROM `folio_topics`
    WHERE `topic_status` = 0
    GROUP BY `topic_poster`)
AND Topicmeta.meta_key = 'bb_attach_thumb'
ORDER BY Topics.`topic_id` DESC
LIMIT 6 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T01:06:37.430

根据[这篇](http://dev.mysql.com/doc/refman/5.0/en/distinct-optimization.html)文章，您可以使用 Group By 来完成您正在尝试的事情。试试这个

```
SELECT topic_title, topic_slug, meta_value, topic_poster
FROM `folio_topics` as Topics
INNER JOIN `folio_topicmeta` as Topicmeta
ON Topics.topic_id = Topicmeta.topic_id
WHERE `topic_status` = 0
AND Topicmeta.meta_key = 'bb_attach_thumb'
Group By topic_poster
ORDER BY Topics.`topic_id` DESC
LIMIT 6 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T02:05:10.097

万一有人遇到这种情况，我找不到让这个庞大的查询快速运行的方法，所以我在代码中将它分成两个查询。这是PHP代码：

```
$folio_posters = $wpdb->get_results("SELECT MAX( `topic_id` ) as topiclist FROM `folio_topics` WHERE `topic_status` =0 GROUP BY `topic_poster` ORDER BY topiclist DESC LIMIT 6");

foreach ($folio_posters as $folio_poster) {
    $folio_poster_list[] = $folio_poster->topiclist;
}

$foliopics = $wpdb->get_results("SELECT topic_title, topic_slug, meta_value, topic_poster FROM `folio_topics` AS Topics INNER JOIN `folio_topicmeta` AS Topicmeta ON Topics.topic_id = Topicmeta.topic_id WHERE Topics.topic_id IN (" .  implode ($folio_poster_list, ',') . ") AND Topicmeta.meta_key = 'bb_attach_thumb' ORDER BY Topics.`topic_id` DESC"); 
```

如果有人想出如何用一个查询来做到这一点，我会接受那个版本。:-)

# iphone - iPhone 图像按钮

> ID：827597
> 
> 赞同：4
> 
> 时间：2009-05-06T01:02:58.763
> 
> 标签：iphone, cocoa-touch, uikit

我想在我的 iPhone 应用程序中使用图像按钮。如果有任何我可以阅读的文章，请告诉我。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T02:32:44.883

所以来自[http://www.iphonedevsdk.com/forum/iphone-sdk-development/1891-sharing-button-image-code.html](http://www.iphonedevsdk.com/forum/iphone-sdk-development/1891-changing-button-image-code.html)的建议是：

```
UIButton *btn = [[UIButton alloc] init];
UIImage *img = [UIImage imageNamed:@"image.png"];
[btn setImage:img forState:UIControlStateNormal]
//No need to release img. It is autoreleased!!! 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-04T06:03:19.427

你不需要释放img。所以正确的代码可能是 -

```
UIButton *btn = [[UIButton alloc] init];
UIImage *img = [UIImage imageNamed:@"image.png"];
[btn setImage:img forState:UIControlStateNormal]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T01:07:34.837

以编程方式，你可以做这样的事情...... [http://www.iphonedevsdk.com/forum/iphone-sdk-development/1891-sharing-button-image-code.html](http://www.iphonedevsdk.com/forum/iphone-sdk-development/1891-changing-button-image-code.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-22T18:53:40.347

在 Interface Builder 中，您可以选择自定义按钮，然后将 Image 属性设置为您的图像。不要使用圆角矩形按钮，它会显示在图像后面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-01T09:54:48.467

但是您需要释放按钮；) [btn release];

# xslt - 如何从 XSLT 样式表中防止这些冗余名称空间？

> ID：827600
> 
> 赞同：5
> 
> 时间：2009-05-06T01:03:46.640
> 
> 标签：xslt, namespaces

当使用 XSLT 样式表将包含嵌入式 XHTML（使用名称空间）的 XML 文件转换为纯 XHTML 时，我在最初是 XHTML 的元素上留下了多余的名称空间定义。简单的测试用例：

XML:

```
<?xml version="1.0" encoding="utf-8" ?>
<?xml-stylesheet type="text/xml" href="fbb.xsl"?>
<foo xmlns="urn:foo:bar:baz" xmlns:html="http://www.w3.org/1999/xhtml">
    <bar>
        <baz>Some <html:i>example</html:i> text.</baz>
    </bar>
</foo> 
```

XSL：

```
<?xml version="1.0" encoding="utf-8" ?>
<xsl:stylesheet version="1.0" xmlns="http://www.w3.org/1999/xhtml" xmlns:fbb="urn:foo:bar:baz" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" exclude-result-prefixes="fbb">
    <xsl:output method="xml" indent="yes"/>

    <xsl:template match="/fbb:foo">
        <html>
            <head>
                <title>Example</title>
            </head>

            <body>
                <p>
                    <xsl:copy-of select="fbb:bar/fbb:baz/node()"/>
                </p>
            </body>
        </html>
    </xsl:template>
</xsl:stylesheet> 
```

输出：

```
<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Example</title>
  </head>
  <body>
    <p>Some <html:i xmlns="urn:foo:bar:baz" xmlns:html="http://www.w3.org/1999/xhtml">example</html:i> text.</p>
  </body>
</html> 
```

是否可以防止将多余的名称空间（和前缀）添加到`<i>`元素中？（作为参考，我在 Cygwin 上`xsltproc`使用`libxml2-2.7.3`和使用。）`libxslt-1.1.24`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T18:22:48.250

而不是`xsl:copy-of`使用标识转换模板并从 XHTML 元素中删除名称空间前缀。

```
<xsl:stylesheet version="1.0"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:fbb="urn:foo:bar:baz"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:html="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="fbb html">

  <xsl:output method="xml" indent="yes"/>

  <xsl:template match="/fbb:foo">
    <html>
      <head>
        <title>Example</title>
      </head>
      <body>
        <p>
          <xsl:apply-templates select="fbb:bar/fbb:baz/node()"/>
        </p>
      </body>
    </html>
  </xsl:template>

  <xsl:template match="html:*">
    <xsl:element name="{local-name()}">
      <xsl:apply-templates select="@* | node()"/>
    </xsl:element>
  </xsl:template>

  <xsl:template match="node() | @*">
    <xsl:copy>
      <xsl:apply-templates select="node() | @*"/>
    </xsl:copy>
  </xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T03:59:40.540

更新您的`exclude-result-prefixes`以包含默认命名空间：

```
exclude-result-prefixes="#default" 
```

或者您可以通过执行以下操作来抑制所有内联命名空间：

```
exclude-result-prefixes="#all" 
```

不过有一点点不稳定，因为一些处理器期望一个空格分隔的列表，而另一些处理器期望一个逗号分隔的列表。xsltproc 似乎喜欢逗号分隔，所以如果你仍然想明确，你可以这样做：

```
exclude-result-prefixes="#default,fbb" 
```

# c++ - C/C++ Windows API 将文本发送到剪贴板

> ID：827602
> 
> 赞同：3
> 
> 时间：2009-05-06T01:04:25.580
> 
> 标签：c++, c, api

此代码应该将字符串发送到剪贴板。但是我让它工作了一次。现在当我 CTRL+V 时它不会正确出现。

但是当我使用这个片段来识别剪贴板文本时，它会显示它应该是什么。

```
 #include <windows.h>
#include <iostream>
BOOL SetClipboardText(LPCTSTR pszText)
{
   BOOL ok = FALSE;
   if(OpenClipboard(NULL)) {
      // the text should be placed in "global" memory
      HGLOBAL hMem = GlobalAlloc(GMEM_SHARE | GMEM_MOVEABLE, 
         (lstrlen(pszText)+1)*sizeof(pszText[0]) );
      LPTSTR ptxt = (LPTSTR)GlobalLock(hMem);
      lstrcpy(ptxt, pszText);
      GlobalUnlock(hMem);
      // set data in clipboard; we are no longer responsible for hMem
      ok = (BOOL)SetClipboardData(CF_TEXT, hMem);

      CloseClipboard(); // relinquish it for other windows
   }
   return ok;
}

int main()
{
    LPCTSTR test = "DOG";
    SetClipboardText(test);
    return 0;
}

   //get clipboard text
   #include <windows.h>
#include <iostream>
#include <stdio.h>

using namespace std;

int main()
{
     HANDLE clip;
     if (OpenClipboard(NULL)) 
    clip = GetClipboardData(CF_TEXT);
    printf("%s",clip);
//cout << (char*)clip; // HANDLE==void*, so cast it
cin.get();} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T01:07:58.410

您需要对 GetClipboardData 返回的剪贴板数据调用 GlobalLock()，并将返回的指针作为字符串数据。

对于使用 GMEM_MOVABLE 分配的对象，不能保证指向内存的指针与句柄的值相同。

# php - 将 URL 变量插入 mysql 数据库的 PHP 脚本？

> ID：827604
> 
> 赞同：0
> 
> 时间：2009-05-06T01:05:19.430
> 
> 标签：php, mysql

我正在寻找一个简单且安全的脚本来将行从 php 脚本插入到 mysql 表中。

通过调用[http://www.myserver.com/addtosometable.php?1=asdf&2=asdf](http://www.myserver.com/addtosometable.php?1=asdf&2=asdf) ....

我不是在问具体如何，而是我认为这可能是一个构建示例脚本并使其与最佳实践保持同步的好平台......

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T01:10:40.947

`$_GET`所有 URL 变量（GET 变量）都作为数组放入 PHP 变量中。

使用上面的示例，`myfile.php?1=asdf&2=asdf`您的脚本将可以访问如下所示的数组：

```
array(
    1 => "asdf"
    2 => "asdf"
) 
```

如果您想亲自查看，只需将其放入您的文件中：

```
print_r($_GET); 
```

从那里开始，**清理变量以避免注入攻击**，然后创建一个 INSERT 语句应该是一个简单的任务。我需要更多地了解您的表结构以及其他专门帮助您的信息。请参阅[mysql_real_escape_string](http://ca.php.net/manual/en/function.mysql-real-escape-string.php)上的文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T04:24:33.507

如果您使用的是 MySQL 5，则可以使用准备好的语句来避免大多数形式的 SQL 注入。

```
$stmt = $db->prepare("INSERT INTO 表 (col1, col2) 值 (?, ?);
// 检查错误
$result = $stmt->execute($_GET['1'], $_GET['2']);
// 检查错误

```

我相信您仍然需要担心 XSS（跨站点脚本）攻击，但这超出了我的理解范围。

# ajax - 在 Sharepoint 中实现 AJAX

> ID：827606
> 
> 赞同：1
> 
> 时间：2009-05-06T01:05:44.373
> 
> 标签：ajax, sharepoint

我正在尝试在 SharePoint 中实现 Ajax。我在 MOSS2007 中安装了 AJAX 扩展 1.0，但在我的 SharePoint Designer 中找不到扩展。任何人都可以在这个问题上帮助我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:39:51.480

设置 SharePoint 以使用 MS Ajax 控件是可能的 - 我以前做过，但它确实需要各种 Web 配置更改和父 Web 部件代码中的一些 hack - 您不太可能获得访问权限如果您使用 SharePoint 设计器，则在生产系统上。

JQuery 可能是一个更好的选择——您可以将脚本放在文档库中，这样可以更轻松地直接使用 javascript。

从 javascript 调用标准的 sharepoint Web 服务效果很好 - 我最近在我的博客上发布了一些示例代码，您可能会发现它们很有帮助。

[http://tqcblog.com/2009/05/04/sharepoint-discussion-with-jquery](http://tqcblog.com/2009/05/04/sharepoint-discussion-with-jquery)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T02:23:41.037

这真的不可能。MS Ajax 要求标头中存在特定的文档类型，但 Sharepoint 不提供它。

我的朋友，你的解决方案可以在[这里](http://jquery.com/)找到。

# java - 为什么 ant 每次运行时都要编译所有类？

> ID：827609
> 
> 赞同：10
> 
> 时间：2009-05-06T01:06:12.487
> 
> 标签：java, ant

我更习惯make，所以我很困惑为什么ant在源没有改变的情况下重新编译类。我读过在某些使用泛型的情况下需要重新编译，但我不确定这对我的项目是否必要。

另外，在 javac 任务中，我设置了 includeDestClasses="true"

这是我正在使用的一些目标

```
<target name="init">
        <mkdir dir="${build}"/>
        <mkdir dir="${dist}"/>
    </target>
    <target name="compile" depends="init,util,semantics" description=""/>
    <target name="util" depends="" description="">
        <javac destdir="${build}" classpath="project.class.path" debug="on" srcdir="${src}/util" includeDestClasses="true" source="1.5">
            <classpath refid="project.class.path"/>
        </javac>
    </target> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T03:00:51.150

尝试修改`javac`任务的开始标记以包含`srcdir`属性和`includes`属性：

`<javac destdir="${build}" classpath="project.class.path" debug="on" srcdir="${src}" includes="util/**" includeDestClasses="true" source="1.5">`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-06T02:11:08.773

您的 src 和 dest 目录不等效，因此 ant 无法有效地统计输出文件来比较它们。

这是一个常见问题解答： http: [//ant.apache.org/faq.html#always-recompiles](http://ant.apache.org/faq.html#always-recompiles)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T01:51:00.320

根据我的经验，javac 目标不会编译所有类，只会编译需要它的类，即使没有 includeDestClasses 属性也是如此。事实上，我通常设置两个（或更多）编译目标，一个执行完整编译（通过删除输出目录强制执行），另一个执行快速更新编译，就像您的 javac 行一样。您确定您的依赖项之一没有删除输出目录吗？

# winapi - Windows XP, HKCU\...\LastVisitedMRU 允许的最大项目数？

> ID：827612
> 
> 赞同：2
> 
> 时间：2009-05-06T01:07:04.527
> 
> 标签：winapi, windows-xp, registry, mru, comdlg32

我有一个场景，我需要组合一个脚本来为当前用户添加一个条目到以下注册表项：

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedMRU\ 
```

我正在尝试找出此键中允许的最大值数，以便我可以让我的脚本将另一个添加到末尾。值名称从字母表的开头开始，但我不想假设它们以“Z”结尾。

背景：我们正在重新打包专有（即不是我们自己的，我们无权访问源代码）应用程序并尝试设置其默认文件 -> 打开位置。在许多痛苦的快照和文件/Regmon 会话之后，这似乎是做到这一点的方法。我知道这很hackish，但它确实有效，我已经手动测试了这个理论。也就是说，我当然愿意接受有关如何以对 Win32 更友好的方式执行此操作的建议——假设应用程序本身没有更好的机制来执行此操作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-12T04:45:46.290

对于每个可执行文件名称，此注册表项包含该应用程序上次执行 SaveAs（也许是 Save，我不确定）的目录。

每个字母都包含一个可执行文件的信息并`MRUList`包含顺序（这很重要）。

我的在“y”处被最大化，而我`MRUList`的是`sxahmcjierfobglyuqpdtwvkn`。

根据实验，当我从已经存在的应用程序中执行 SaveAs 时，它只是替换该字母的信息并将其移动到`MRUList`.

如果应用程序不存在且并非所有字母都在 中`MRUList`，它会抓取第一个可用字母，将信息放入该字母中，然后将该字母放在`MRUList`.

如果应用程序不存在并且使用了所有字母，它会抓取 上的最后一个`MRUList`，将信息放入该字母中，然后将其移动到`MRUList`.

我注意到为一个全新的应用程序执行 SaveAs 不会给我这`z`封信，它会重新使用“MRUList”中的最后一个。

密钥本身看起来像 UCS-2（16 位 Unicode，在我的澳大利亚版本的 Windows 中散布空字节的 ASCII，您的里程可能因国际变体而异）并且它们包含以空字符结尾的可执行文件名称，然后是以空字符结尾的可执行文件名称目录。

关于您关于无法访问该应用程序源的评论，这并不重要。不是那个应用程序改变了这些键。ComDlg32 是 Windows 本身的常用对话框（打开、另存为、打印设置等）。

如果要为给定应用程序设置 MRU，请按照以下步骤操作。

1/ 在字母键中搜索该应用程序。如果找到，请转到步骤 3。

2/ 获取下一个不在`MRUList`. 如果 .`MRUList`已经包含所有字母`a`，`y` *或者*您不确定它`y`总是最后一个（它可能在注册表中的其他位置可配置），请抓住 . 末尾的最后一个字母`MRUList`。

3/ 现在你收到了你的信。使用应用程序和目录的 UCS-2 数据更改或创建该字母键（均以 null 结尾）。

4/ 更改`MRUList`将您的字母放在前面。

那里。那应该这样做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T01:16:59.450

除非我误解了您的情况，否则标准的 Windows OpenFileDialog 应该有一个名为 的属性`InitialDirectory`，它指定对话框应该打开到的目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T20:01:43.683

其他重要吗？我会考虑放弃其他人，或者重新使用第一个或最后一个。（我也会尝试使用任何字符，但幸运的是它可能会起作用。）

# php - 在没有预共享标识符的情况下一次性验证用户的策略

> ID：827616
> 
> 赞同：4
> 
> 时间：2009-05-06T01:07:41.110
> 
> 标签：php, javascript, web-applications, hash

我正在创建一个脚本，其中包含姓名和电子邮件地址列表，并发送一封电子邮件，邀请他们注册我们部门的安全网站。姓名和电子邮件列表可在同一站点的面向公众的页面上找到。我需要一种方法给他们一个唯一的令牌，当他们点击电子邮件中的链接到页面注册帐户时，该令牌将识别他们。用户将只使用一次令牌，以创建帐户并设置其初始密码。

生成令牌的最佳方法是什么？存储在数据库中的随机字符串？从用户信息和一些盐生成的哈希？还有什么？我知道这种方法的安全性取决于个人电子邮件邀请的隐私，我理解这是轻微的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T01:47:23.870

为什么它需要特别是哈希？只需将新用户的用户名作为链接的一部分，并随机生成您想要的任何长度的身份验证令牌，并将其存储在数据库中，链接到他们的用户名，直到他们进行身份验证。

所以他们在电子邮件中获得的链接类似于：

```
http://domain.com/confirm.php?user=Chad&t=AB14CD05 
```

有没有碰撞真的没关系，反正这是一个相当低风险的事件。无论如何，可能会出现什么问题，其他人可以......为他们确认他们的电子邮件地址？你在担心什么？也许如果您更详细地解释整个过程，我会更好地理解您的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T01:45:50.080

为什么不分配一个随机的 64 位数字与用户 ID 一起发送。取 64 位数字，将其分成 5 位块，并使用每个 5 位块来索引 32 个字符的字母表：23456789ABCDEFGHJKLMNPQRSTUVWXYZ（方便省略 01IO）。使用 64 位数字和 5 位/代码（最后一个除外），您将获得一个 13 个字符的 slug 用于识别用户。如果需要，您可以用 2 个随机字符填充它以提供 3 组 5 个字符。

使 id 和 slug 成为登录 url 的一部分。检查数据库中与 id 一起存储的 slug 的值，以确保它们相同。我认为对于大多数目的来说，这将是一个足够大的值，以至于很难猜测——这个数字毕竟是随机的——哪个 slug 与哪个用户 ID 对应。使用加密强大的随机数生成器，我认为您甚至不太可能为任何用户获得重复数字。

它可能看起来像：

```
http://example.com/activate?userid=bgates&validate=GY45M-RHQBN-32GYM 
```

使用已知值的散列实际上可能比使用随机数更容易让某人猜出正确的代码。使用散列只需要猜测您正在使用哪些位并通过各种散列算法运行它们。如果有人能够将这些拼凑在一起，例如给出几个示例并有足够的时间尝试各种组合，那么他们破解某人的代码所要做的就是确定给定人的（可能）众所周知的属性并使用这些属性来模仿他们并创建一个帐户。为每个人分配了一个强大的随机数，他们只剩下暴力攻击。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T01:38:40.817

查看[gperf](http://www.gnu.org/software/gperf/)。

> GNU gperf 是一个完美的散列函数生成器。对于给定的字符串列表，它以 C 或 C++ 代码的形式生成哈希函数和哈希表，用于根据输入字符串查找值。哈希函数是完美的，这意味着哈希表没有冲突，哈希表查找只需要单个字符串比较。

还有[CMPH - C 最小完美散列库](http://cmph.sourceforge.net/)

有几个相关的 SO 问题：

*   [什么是一个高性能的字符串散列函数，它会产生一个低冲突率的 32 位整数？](https://stackoverflow.com/questions/114085/what-is-a-performant-string-hashing-function-that-results-in-a-32-bit-integer-wit)

*   [什么是好的哈希函数？](https://stackoverflow.com/questions/34595/what-is-a-good-hash-function)

*   [什么是一个高性能的字符串散列函数，它会产生一个低冲突率的 32 位整数？](https://stackoverflow.com/questions/114085/what-is-a-performant-string-hashing-function-that-results-in-a-32-bit-integer-wit/114097)

*   [如何计算哈希算法中发生冲突的几率？](https://stackoverflow.com/questions/681867/how-to-calculate-the-odds-of-a-collision-in-hash-algorithms)

*   [哈希碰撞 - 有什么机会？](https://stackoverflow.com/questions/297960/hash-collision-what-are-the-chances)

# java - Eclipse RCP：抑制透视栏的上下文菜单

> ID：827618
> 
> 赞同：4
> 
> 时间：2009-05-06T01:08:06.817
> 
> 标签：java, eclipse-rcp, contextmenu, perspectives

我想禁止在 rcp 应用程序中右键单击透视工具栏时显示的上下文菜单。澄清一下，我确实希望显示透视栏和快捷方式，但我不希望弹出上下文菜单。所有透视工具栏 api 似乎都是内部的。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-07T05:54:35.933

你可以试试这个

```
 PerspectiveBarManager perspectiveBarManager = ((WorkbenchWindow) PlatformUI.getWorkbench()
            .getActiveWorkbenchWindow()).getPerspectiveBar();
    ToolBar toolBar = perspectiveBarManager.getControl();
    Listener[] listeners = toolBar.getListeners(SWT.MenuDetect);
    if (listeners != null)
    {
        for (Listener listener : listeners)
        {
            toolBar.removeListener(SWT.MenuDetect, listener);
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T09:25:39.400

正如您所提到的，PerspectiveSwitcher 的上下文菜单是在工作台框架的内部类中创建的。你不能阻止它被创建，你也不能获得对 PerspectiveSwitcher 的引用来以某种方式抑制菜单，而无需大量使用内部类和大量重新实现现有功能。

因此，简单地说，恕我直言，上下文菜单似乎并不是要被压制的。

解决您的问题的最简单和最干净的方法是抑制整个透视栏，并实现您自己的。有用于查询现有透视图 (IWorkbench.getPerspectiveRegistry) 和切换透视图 (IWorkbenchPage.setPerspective) 的公共 API，您只需要编写 UI 即可。

# wpf - 用于 FTP 接口的 WPF

> ID：827622
> 
> 赞同：0
> 
> 时间：2009-05-06T01:10:32.477
> 
> 标签：wpf, user-interface, ftp

我正在使用 WPF 创建一个程序，该程序具有类似 FTP 的界面，其中包含 2 个列表视图和 2 个按钮。我遇到的问题是，我不知道如何设置 2 个列表视图来填充可用空间，而无需让按钮也这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T07:51:58.830

您可以使用 Grid 来做到这一点：

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>
    <ListBox
        x:Name="list1"
        Grid.Column="0"
        />
    <StackPanel
        x:Name="buttonsPlaceholder"
        Grid.Column="1"
        />
    <ListBox
        x:Name="list2"
        Grid.Column="2"
        />
</Grid> 
```

另外，我认为使用绝对大小是一种非常糟糕的做法，因为 WPF 有很多自动调整大小的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T01:40:36.520

除非我误解了您的问题，否则您需要做的就是对我认为的按钮宽度进行硬编码？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T01:52:00.863

由于您使用的是 WPF，因此您的界面在 XAML 中。为什么不直接在 Expression Blend 中编辑您的 XAML，然后使用鼠标移动并调整所有内容的大小，使其看起来像您想要的那样。

# c++ - 给定文件名，如何使用 Crypto++ 获取 Adler32

> ID：827634
> 
> 赞同：1
> 
> 时间：2009-05-06T01:15:44.537
> 
> 标签：c++, hash, md5, crypto++, adler32

给定一个“字符串文件名”，如何使用 C++ Crypto++ 库获取 Adler32 校验和。我对使用他们的 Source 和 Sink 系统有点困惑。

下面我有执行 MD5 的代码骨架，但我似乎找不到任何有关 Adler32 用法的示例或教程。

```
string filename = "/tmp/data.txt"
string file_adler32_digest;
string file_md5_digest;

MD5 hashMD5;

FileSource fs( filename.c_str(), 
              true, 
              new HashFilter( hashMD5, 
              new HexEncoder( new StringSink( file_md5_digest ) ) ) );

/* Confusion begins here */   

//how do I do the adler32 ?

/* Confusion ends here */

cout << file_adler32_digest << endl
     << file_md5_digest << endl; 
```

* * *

好的示例和示例代码在这里[http://www.cryptopp.com/wiki/Category:](http://www.cryptopp.com/wiki/Category:Sample)所有 Crypto++ 的示例（除了我想要的 Adler32 东西）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T06:16:41.553

如果您遵循此[http://www.cryptopp.com/wiki/HashFilter](http://www.cryptopp.com/wiki/HashFilter)，则必须将 hashMD5 更改为 hashAdler32，将 file_md5_digest 更改为 file_adler32_digest

```
Adler32 hashAdler32;

FileSource( filename.c_str(), 
            true, 
            new HashFilter( hashAdler32, 
            new HexEncoder( new StringSink( file_adler32_digest ) ) ) ); 
```

在这之后`file_adler32_digest`应该包含所需的哈希。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-15T20:50:01.510

> .. 对使用他们的 Source 和 Sink 系统有点困惑。

好的。这种特殊的设计灵感来自 Unix 管道系统。如果您了解 Unix 管道以及 doata 如何在其中流动，那么您就会了解[Crypto++ 管道](http://www.cryptopp.com/wiki/Pipelining)。

例如，以下 Unix 命令：

```
cat somefile.bin | hexdump 
```

将成为以下 Crypto++ 程序：

```
FileSource fs("somefile.bin", true /*pumpAll*/, new HexEncoder(new FileSink(cout))); 
```

* * *

> 我有执行 MD5 的代码骨架，但我需要代码……用于 Adler32……

正如伊斯梅尔向您展示的那样，它很简单：

```
Adler32 adler32;
string digest;

FileSource fs(filename.c_str(),  true /*pumpAll*/, 
              new HashFilter(adler32, 
                    new HexEncoder(
                        new StringSink(digest)))); 
```

但这是洞察力：在 Crypto++ 中，数据从[Sources](http://www.cryptopp.com/wiki/Category:Source)流向[Sinks](http://www.cryptopp.com/wiki/Category:Sink)。在这两者之间，它会遇到转换数据的[过滤器。](http://www.cryptopp.com/wiki/Category:Filter)

上面，您有两个过滤器：[HashFilter](http://www.cryptopp.com/wiki/HashFilter)和[HexEncoder](http://www.cryptopp.com/wiki/HexEncoder)。所有过滤器都继承自 a [`BufferedTransformation`](http://www.cryptopp.com/wiki/BufferedTransformation)，因此它们都可以以一致的方式链接在一起。

`Adler32`本身不是过滤器。但它继承自[`HashTransformation`](http://www.cryptopp.com/wiki/HashTransformation)，这就是[HashFilter](http://www.cryptopp.com/wiki/HashFilter)使用的。因此，您可以交换任何基于[HashFilter](http://www.cryptopp.com/wiki/HashFilter)的对象，并且一切正常。

您可以在[HashTransformation Class Reference中找到基于](http://www.cryptopp.com/docs/ref/class_hash_transformation.html)[HashFilter](http://www.cryptopp.com/wiki/HashFilter)的对象列表。它们包括所有哈希（如 MD5、SHA 和 Whirlpool）、Adler32 和 CRC32。

# .net - 如何在不使用 flash-activeX 的情况下从 *.Net 读取 .flv 文件的 videoDuration？

> ID：827641
> 
> 赞同：0
> 
> 时间：2009-05-06T01:18:43.157
> 
> 标签：.net, winforms, flash, flv, file-format

我有一个允许用户将 Shockwave Flash 电影上传到服务器的 winform 程序。为了获得 videoDuration，我创建了一个“ShockwaveFlashObjects”-activeX 的实例，加载影片，然后读取 videoDuration，直到它从“0.0”变为其他任何值。我通过阅读 GetVariable("videoDuration") 得到了这一点。

通常它可以工作，但有时它会锁定或显示上一个加载的 Flash 电影的信息。

我在分发 ShockWaveFlashObject-activeX 时也遇到了麻烦。我真的很想跳过它，只需阅读 Flash 文件并找出电影的播放长度。

上传的所有电影都是视频，因此它们具有特定的播放长度。

[这个问题](https://stackoverflow.com/questions/741551/reading-swf-file-code-from-c)对答案没有帮助。

我已经检查了[wotsit的](http://www.wotsit.org/ "wotsit")[swf 格式](http://www.wotsit.org/download.asp?f=swffileformat&sc=294868335 "swf 格式")，从我所看到的应该可以读取帧率和帧数并计算持续时间，但我找不到任何关于 flv 文件的信息。也许有人已经这样做了，并且可以为我指出一些很好的代码，从而为我节省大量时间尝试理解规范？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T00:07:20.913

其中一种可能性是使用 ffmpeg 读取视频/音频比特率。获得这些详细信息后，您可以将总文件大小除以视频/音频比特率的总和。这为您提供了估计的秒数（+/- 几秒）。

# visual-studio - 是否有用于拼写检查字符串和注释的 Visual Studio 插件？

> ID：827642
> 
> 赞同：1
> 
> 时间：2009-05-06T01:19:30.630
> 
> 标签：visual-studio, plugins

是否有用于拼写检查字符串和注释的 Visual Studio 插件？

**[Visual Studio 08 拼写检查插件](https://stackoverflow.com/questions/30947/visual-studio-08-spell-check-addin)重复**？****

 *** * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T01:28:02.153

看看[IntelliSpell](http://www.componentone.com/SuperProducts/IntelliSpell/)，有一个免费版本可用，它不仅会检查您的 xml 注释，它甚至会检查您的代码、资源文件等中的字符串...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-16T05:51:31.260

我安装了这个并满足我的需要。你可以在这里下载。

[http://visualstudiogallery.msdn.microsoft.com/86788d02-ce1e-4933-b499-cdba6a70f26f](http://visualstudiogallery.msdn.microsoft.com/86788d02-ce1e-4933-b499-cdba6a70f26f)

# c# - 如何在班级内共享 IDisposable 资源？

> ID：827644
> 
> 赞同：1
> 
> 时间：2009-05-06T01:22:38.950
> 
> 标签：c#, class-design, using-statement

我正在编写一些控制台应用程序来在 SQLite 数据库之间移动一些数据。连接的类和各种准备好的语句实现了 IDisposable，所以我使用`using`块来实例化这些对象，如下所示：

```
using (SQLiteConnection sqlite_conn = new SQLiteConnection(connectionString))
{
    sqlite_conn.Open();
    using (SQLiteCommand sqlite_cmd = new SQLiteCommand())
    {
        sqlite_cmd.Connection = sqlite_conn;
        sqlite_cmd.CommandText = "INSERT INTO SOMETHING SOMETHING;";
        sqlite_cmd.ExecuteNonQuery();
    }
    sqlite_conn.Close();
} 
```

但是，我需要能够在一种方法中创建这些连接，然后在其他方法中调用它们。对我来说，将这些连接存储为实例变量的最简洁、最容易混淆的方式是什么？我想确保`.Dispose()`以一种智能的方式调用他们的方法，但看不到确保所有操作都发生在单个`using`块的上下文中的好方法。

我意识到这是一个 C# 新手问题，所以请调整你的答案。如果您有建议的解决方案，如果您包含一个代码示例来说明，我会很高兴。

**编辑：**我的用例是一个控制台应用程序。有人传入源连接字符串和目标连接字符串，控制台应用程序执行操作。我真的会让我的控制台类程序本身像这样实现 IDisposable 吗？：

```
class Program : IDisposable
{
    private SQLiteConnection sourceConnection;
    private SQLiteConnection destinationConnection;

    public void Dispose()
    {
        sourceConnection.Dispose();
        destinationConnection.Dispose();
    }  
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T01:28:47.843

> 我需要能够在一种方法中创建这些连接，然后在其他方法中调用它们。对我来说，将这些连接存储为实例变量的最简洁、最容易混淆的方式是什么？

在这种情况下，保存这些实例变量的类本身应实现 IDisposable，并且在处置时应确保连接也已处置。

此外，当您同时拥有多个 IDisposables 时，您可以通过这种方式重新编写它，对它们进行分组并减少代码中的嵌套：

```
using (SQLiteConnection sqlite_conn = new SQLiteConnection(connectionString))
using (SQLiteCommand sqlite_cmd = new SQLiteCommand())
{
    sqlite_conn.Open();

    sqlite_cmd.Connection = sqlite_conn;
    sqlite_cmd.CommandText = "INSERT INTO SOMETHING SOMETHING;";
    sqlite_cmd.ExecuteNonQuery();
} // no need to call .Close(): IDisposable normally handles it for you 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T01:29:55.783

您可以让您的类实现 IDisposable 并确保在 Dispose 方法中清理连接等。然后调用你的类的方法可以使用（MyClass c ...）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T01:33:18.363

一种方法是让您的类实现 IDisposable。在您的类的 Dispose 方法中，调用连接和命令等的 Dispose 方法。然后您可以在 using 块中使用您的类的实例。

# delphi - 如何以编程方式在另一个应用程序中选择上下文菜单项？

> ID：827648
> 
> 赞同：5
> 
> 时间：2009-05-06T01:26:41.047
> 
> 标签：delphi, winapi, contextmenu, messages, sendmessage

目标应用程序是用 Delphi（win32 不是 .NET）编写的，并且是闭源的。

我要调用的操作称为复制，但没有明显的键盘快捷键。（Ctrl+Insert 做错事，Ctrl+C 什么也不做）

我可以找到我的目标`HWND`并说服它打开上下文菜单（它会响应`WM_RBUTTONDOWN/UP`not `WM_CONTEXTMENU`）。从菜单`HWND`中我什至可以通过获取菜单句柄`MN_GETHMENU`并找到我想要的菜单项。我只是不知道如何“选择”项目的细节。菜单是“无模式的”并没有帮助，即。它`HWND`不属于自己，所以我不知道许多隐藏`TPUtilWindow`窗口中的哪个是真正的所有者 - 否则我可能只是发送它`WM_COMMAND`而不弹出菜单，这将是可取的。

尽管我确信它有助于各种黑客攻击，但我不希望将代码注入目标进程。

接受任何语言的答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T01:59:00.860

显然，您可以向它`WM_RBUTTONDOWN/UP`发送消息并且它会响应。如果是这样，您也可以发送`WM_KEYDOWN/UP`消息吗？只要您知道菜单的结构并且它没有改变，请尝试告诉应用程序有人按了向下箭头 X 次，然后按 ENTER。这对我来说似乎是最简单的解决方案......

# ruby - 什么是 Ruby <=>（宇宙飞船）运算符？

> ID：827649
> 
> 赞同：288
> 
> 时间：2009-05-06T01:27:38.767
> 
> 标签：ruby, operators, comparison-operators, spaceship-operator

什么是 Ruby `<=>`（宇宙飞船）运算符？运算符是否由任何其他语言实现？

* * *

## 回答 #1

> 赞同：406
> 
> 时间：2009-05-06T01:30:27.810

它也被称为*三向比较运算符*。Perl 可能是第一种使用它的语言。其他一些支持它的语言是：Apache Groovy、PHP 7+ 和 C++20。

不是根据参数是否相等而返回`1`( `true`) 或`0`( )，而是根据左参数相对于右参数的值返回,或。`false``1``0``−1`

```
a <=> b :=
  if a < b then return -1
  if a = b then return  0
  if a > b then return  1
  if a and b are not comparable then return nil 
```

它通常用于对数据进行排序。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2013-01-11T16:24:24.627

当您在自己的类中定义 spaceship 方法并包含[Comparable 模块](http://www.ruby-doc.org/core/Comparable.html)时，该方法很有用。然后你的班级免费获得这些`>, < , >=, <=, ==, and between?`方法。

```
class Card
  include Comparable
  attr_reader :value

  def initialize(value)
    @value = value
  end

  def <=> (other) #1 if self>other; 0 if self==other; -1 if self<other
    self.value <=> other.value
  end

end

a = Card.new(7)
b = Card.new(10)
c = Card.new(8)

puts a > b # false
puts c.between?(a,b) # true

# Array#sort uses <=> :
p [a,b,c].sort # [#<Card:0x0000000242d298 @value=7>, #<Card:0x0000000242d248 @value=8>, #<Card:0x0000000242d270 @value=10>] 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-05-06T01:31:08.230

这是一个通用的比较运算符。它返回 -1、0 或 +1，具体取决于其接收者是小于、等于还是大于其参数。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-01-11T14:02:41.057

我会用简单的例子来解释

1.  `[1,3,2] <=> [2,2,2]`

    Ruby 将从左侧开始比较两个数组的每个元素。 `1`对于左数组小于`2`右数组。因此左数组小于右数组。输出将是`-1`.

2.  `[2,3,2] <=> [2,2,2]`

    如上所述，它将首先比较相等的第一个元素，然后比较第二个元素，在这种情况下，左数组的第二个元素更大，因此输出为`1`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-04-11T23:22:59.563

由于此运算符减少了对整数表达式的比较，因此它提供了基于多列/属性进行升序或降序排序的最通用方法。

例如，如果我有一个对象数组，我可以这样做：

```
# `sort!` modifies array in place, avoids duplicating if it's large...

# Sort by zip code, ascending
my_objects.sort! { |a, b| a.zip <=> b.zip }

# Sort by zip code, descending
my_objects.sort! { |a, b| b.zip <=> a.zip }
# ...same as...
my_objects.sort! { |a, b| -1 * (a.zip <=> b.zip) }

# Sort by last name, then first
my_objects.sort! { |a, b| 2 * (a.last <=> b.last) + (a.first <=> b.first) }

# Sort by zip, then age descending, then last name, then first
# [Notice powers of 2 make it work for > 2 columns.]
my_objects.sort! do |a, b|
      8 * (a.zip   <=> b.zip) +
     -4 * (a.age   <=> b.age) +
      2 * (a.last  <=> b.last) +
          (a.first <=> b.first)
end 
```

这种基本模式可以推广为按任意数量的列排序，在每个列上以任何升序/降序排列。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-06-27T08:29:16.423

> **什么是`<=>` （“宇宙飞船”操作员）**

## 根据[介绍操作符的 RFC](https://wiki.php.net/rfc/combined-comparison-operator)， $a `<=>`$b

```
 -  0 if $a == $b
 - -1 if $a < $b
 -  1 if $a > $b 
```

* * *

```
 - Return 0 if values on either side are equal
 - Return 1 if value on the left is greater
 - Return -1 if the value on the right is greater 
```

**例子：**

```
//Comparing Integers

echo 1 <=> 1; //ouputs 0
echo 3 <=> 4; //outputs -1
echo 4 <=> 3; //outputs 1

//String Comparison

echo "x" <=> "x"; // 0
echo "x" <=> "y"; //-1
echo "y" <=> "x"; //1 
```

**更多的：**

```
// Integers
echo 1 <=> 1; // 0
echo 1 <=> 2; // -1
echo 2 <=> 1; // 1

// Floats
echo 1.5 <=> 1.5; // 0
echo 1.5 <=> 2.5; // -1
echo 2.5 <=> 1.5; // 1

// Strings
echo "a" <=> "a"; // 0
echo "a" <=> "b"; // -1
echo "b" <=> "a"; // 1

echo "a" <=> "aa"; // -1
echo "zz" <=> "aa"; // 1

// Arrays
echo [] <=> []; // 0
echo [1, 2, 3] <=> [1, 2, 3]; // 0
echo [1, 2, 3] <=> []; // 1
echo [1, 2, 3] <=> [1, 2, 1]; // 1
echo [1, 2, 3] <=> [1, 2, 4]; // -1

// Objects
$a = (object) ["a" => "b"]; 
$b = (object) ["a" => "b"]; 
echo $a <=> $b; // 0 
```

# domain-driven-design - 实体可以访问存储库吗？

> ID：827670
> 
> 赞同：32
> 
> 时间：2009-05-06T01:39:59.207
> 
> 标签：domain-driven-design, repository-pattern, ddd-repositories

我刚刚开始使用 DDD，所以也许这是一个愚蠢的问题......

实体可以访问存储库（通过某些 IRepository 接口）以在运行时获取值吗？例如，我想对属性强制执行“默认”选择：

```
class Person {
    private Company _employer;

    public Company Employer {
        get { return _employer; }
        set { 
            if(value != null) {
                _employer = value;
            } else {
                _employer = employerRepository.GetDefaultEmployer();
            }
        }
    }

    ...
} 
```

我的问题是，做这样的事情是否严重违反了 DDD 原则。如果不是，我的下一个问题是提供存储库以供使用的最佳方式是什么？是否应该在创建 Person 对象时提供？

谢谢，P

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-06T01:54:08.003

这不是严重违反 DDD，而是严重违反……嗯……这简直太可怕了（我说这个舌头在脸颊上）:)。

首先，您的实体变得依赖于拥有一个存储库......这并不理想。理想情况下，您希望您的存储库创建 Person，然后为其分配在当前域上下文中有效所需的所有内容。

所以当你需要一个人时，你会去 personRepository.GetPersonWithDefaultEmployer() 并取回一个填充了默认雇主的人。personRepository 将依赖于一个employerRepository，并在返回它之前使用它来填充这个人。

```
PersonReposotory : IPersonRepository
{
    private readonly IEmployerRepository employerRepository;

    //use constructor injection to populate the EmployerRepository
    public PersonRepository(IEmployerRepository employerRepository)
    {
        this.employerRepository = employerRepository;
    }

    public person GetPersonWithDefaultEmployer(int personId)
    {
        Person person = GetPerson(personId);
        person.Employer = employerRepository.GetDefaultEmployer(personId);
        return person;
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-03-22T09:58:23.033

您的问题的答案是标准：**这取决于**.

根据经验，永远不要这样做。保留您的实体而不引用存储库。

[*戴上实用的帽子*]在一些极其罕见的情况下，如果你有一个非常、非常、非常好的理由这样做，请添加一个大注释来解释你为什么这样做并这样做：添加参考或使用[Double Dispatch](http://en.wikipedia.org/wiki/Double_dispatch)通过存储库[*脱帽*]

此外，如果您希望遵循 DDD 原则，强烈建议您访问领域专家和迭代开发过程（请参阅[Eric Evans - 我从本书中学到的知识](http://www.infoq.com/presentations/ddd-eric-evans) ）。

与您的领域专家一起，您应该定义边界上下文，最重要的是聚合及其聚合根及其实体和值对象。走上 DDD 之路一开始并不容易，但回报是值得的。

关于您发布的代码的一些事情：

1.  不建议在您的实体上设置公共设置器。使用能更好地表达意图的方法。

2.  如果在未初始化 _employer 字段的情况下创建人员实例，则 Employer 属性的 getter 将返回 null。如果您随后将 Employer 属性的值设置为 null，则对 getter 的下一次调用将返回一个非 null 值。这可能出乎您班级的用户的意料。

3.  设置 Person 的 Employer 的调用者（通过公共 setter 或公共方法）应该知道它想要设置的确切 Company 实例，即使它是默认实例。也许调用者可以拥有对存储库的引用。

4.  根据您的具体领域，公司可能是一个价值对象。在这种情况下，您可以使用值对象的默认值来初始化它，而不是使用 null 来初始化 _employer。如果您只有很少的公司 (1-2) 并且它们是不可变的并且没有特定行为，则可能会出现这种情况。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-08-11T18:02:40.723

我认为说一个实体不应该知道存储库很容易，但很难将其付诸实践。尤其是当聚合在其中获取大量 vo 集合时，我们必须对其进行重构并委托操作，例如**添加**到某些实际上充当存储库的域服务，以避免将整个集合加载到内存中的开销。
但我认为让实体知道存储库是不合理的。如果必须，则改用 **域服务**。我们还应该考虑存储库是否违反了**单一责任**原则——它应该被认为是聚合根的**集合**，而不是普通的**工厂**。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-10T05:26:13.137

首先，我认为实体本身以及如何组装实体实际上是两个职责。所以理想情况下最好将它们分配到不同的类中。但这也取决于。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-20T18:25:14.303

真的是建议做 ddd 吗？

如果您没有内存存储库，但您的存储库有一个关系数据库，并且您希望与他们的雇主一起获得 1000 人怎么办？您是否要通过employeesRepository 调用进行1000 个查询...？

我会使用 NHibernate 或任何 ORM 来帮助实现 personRepository。使用 NHibernate，我将使用与此类似的 Hibernate Query：“from Person join fetch Employer”，它将在每个“Person”实例中加载一个“Employer”实例，只有一个 SQL 查询。

是否违反 DDD ？

# c# - 如何将结构编组为指向结构的指针？

> ID：827672
> 
> 赞同：10
> 
> 时间：2009-05-06T01:40:44.227
> 
> 标签：c#, pinvoke

我正在尝试将结构从 C# 传递到 C++ 库。我将结构作为对象传递，C++ 函数期望它作为指针 (void *)。

我在传递结构时遇到问题。

```
[DllImport("MockVadavLib.dll", CharSet = CharSet.Ansi)]
public static extern IntPtr TheFunction([MarshalAs(UnmanagedType.LPStruct)] UserRec userRec); 
```

这是我得到的运行时异常文本：

> “无法封送‘参数 #1’：托管/非托管类型组合无效（此值类型必须与 Struct 配对）。”

虽然我发现一篇 MSDN 文章正是在这种情况下使用了 LPStruct。

这是我试图编组的结构：

```
[StructLayout(LayoutKind.Sequential)]
public struct UserRec {
    [MarshalAs(UnmanagedType.I4)]
    public int userParam1;
} 
```

这是 C++ 函数：

```
MOCKVADAVLIB_API tVDACQ_CallBackRec * TheFunction(void * userParams) {... 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-06T01:43:47.107

尝试将结构作为 ref 参数传递。

```
[DllImport("MockVadavLib.dll", CharSet = CharSet.Ansi)]
public static extern IntPtr TheFunction(ref UserRec userRec); 
```

当您将 ref 与结构结合使用时，它在概念上传递地址。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-10-28T11:55:30.227

顺便说一句，`UnmanagedType.LPStruct`即使有，也很少是正确的`MarshalAs`论点。[来自](http://blogs.msdn.com/b/adam_nathan/archive/2003/04/23/56635.aspx)Microsoft 员工 Adam Nathan 的一句话：

> UnmanagedType.LPStruct 仅在一种特定情况下受支持：**将 System.Guid 值类型视为具有额外间接级别的非托管 GUID。**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-12-31T18:59:48.877

关于@Rytmis 帖子的一些附加信息跟进。

来自[https://docs.microsoft.com/en-us/dotnet/standard/native-interop/best-practices#guids](https://docs.microsoft.com/en-us/dotnet/standard/native-interop/best-practices#guids)：

* * *

> 请勿`[MarshalAs(UnmanagedType.LPStruct)]`用于 ref GUID 参数以外的任何内容。

# java - Java 的 synchronize 关键字要求的缓存刷新范围是什么？

> ID：827679
> 
> 赞同：9
> 
> 时间：2009-05-06T01:46:13.950
> 
> 标签：java, synchronization

我今天整天研究Java内存模型，以详细了解Java 5之前的JMM存在的问题以及Java 5中实现的JSR-133所做的更改。

我似乎找不到明确的答案是特定同步所需的缓存失效和刷新的范围。

是否必须在输入任何同步代码部分时使所有 CPU 寄存器和缓存无效，并在离开时全部刷新到主 RAM，或者 JVM 是否允许仅使实际读取的变量无效，而仅刷新在同步代码块期间实际写入的变量？

如果是前者，为什么 JMM 如此迂腐地坚持认为内存屏障只发生在两个在完全相同的对象上同步的线程之间？

如果是后者，是否有任何好的文件来解释如何实现的细节？（我想底层实现必须在同步块开始时在 CPU 级别设置一个“绕过缓存”标志并在最后清除它，但我可能会*偏离*基础。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T15:10:00.333

关于[Java 内存模型](http://www.youtube.com/watch?v=WTVooKLLVT8&hd=1)的技术演讲*非常好*。如果您在 Java 内存模型的上下文中不喜欢wideos google 。 `'happens before'`

如果在关系之前发生，则基本上所有写入对其他线程都是可见的，让我们假设线程 A 写入字段 X，而线程 B 从中读取，因此发生在写入和读取之间建立结束之前：

*   x 是易变的
*   对 x 的写入受到从 x 读取的同一个锁的保护
*   也许更多。

所以我认为第二个选项是正确的，他们是如何实现的，我不知道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T01:58:35.043

您需要了解 5.0 之前的 JMM 从未真正真正实现过，因为它实际上并不可行。

因此，在 5.0 之前，您在技术上确实必须将所有内容都写到共享内存中。在 1.5（实际上是 1.4）中，这是放宽的。特别是，如果锁无法逃脱线程，则 JVM 有权将其视为 nop。此外，可以合并一个解锁，然后是同一个锁的一个锁，这对于旧的 JMM 是不正确的。对于逃逸锁，JVM 通常不得不悲观并刷新超过技术上的必要性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T02:49:18.917

我建议你从以下开始：

*   Doug Lea 的[“JSR-133 食谱”](http://gee.cs.oswego.edu/dl/jmm/cookbook.html)为编译器编写者提供了有关如何实现内存模型的信息
*   [Java 内存模型邮件列表存档](http://www.cs.umd.edu/~pugh/java/memoryModel/archive/)，您可以在其中阅读导致当前 JMM 修订版的一些争论。

# css - 并排列出项目作为 div (css) 中的图标

> ID：827683
> 
> 赞同：25
> 
> 时间：2009-05-06T01:47:48.593
> 
> 标签：css

我正在寻找一种方法来创建`<ul>`可以放入 a 中的项目，`<div>`并让它们并排显示并在调整浏览器窗口大小时换行到下一行。

例如，如果列表中有 10 个项目，当前在第一行显示 5 个项目，在第二行显示 5 个项目，当用户将浏览器窗口变宽时，它会变成第一行 6 个项目和 4 个项目第二行等

我正在寻找与 Windows 资源管理器在磁贴/图标/缩略图视图中类似的功能。我能够创建`<li>`我想要的尺寸、颜色、内容等。我只是在包装/清除/等方面遇到了麻烦。部分。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-06T01:51:46.293

给`<li>`浮动：左（或右）

它们都将在同一行中，直到容器中没有更多空间（您的情况， a `<ul>`）。（忘记了）：如果你在浮动元素之后有一个块元素，他也会坚持他们，除非你给他一个`clear: both;`，或者在它之前放一个空的div`clear: both;`

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-06T02:09:50.180

这可以是一个纯 CSS 解决方案。鉴于：

```
<ul class="tileMe">
    <li>item 1<li>
    <li>item 2<li>
    <li>item 3<li>
</ul> 
```

CSS 将是：

```
.tileMe li {
    display: inline;
    float: left;
} 
```

现在，由于您已将显示模式从“块”（隐含）更改为“内联”，因此应用于 li 元素的任何填充、边距、宽度或高度样式都将不起作用。您需要在 li 中嵌套一个块级元素：

```
<li><a class="tile" href="home">item 1</a></li> 
```

并添加以下 CSS：

```
.tile a {
    display: block;
    padding: 10px;
    border: 1px solid red;
    margin-right: 5px;
} 
```

该解决方案背后的关键概念是您将 li 的显示样式更改为“内联”，并在内部嵌套一个块级元素以实现一致的平铺效果。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T02:01:32.400

这是包装柱状列表的好资源。 [http://www.communitymx.com/content/article.cfm?cid=27f87](http://www.communitymx.com/content/article.cfm?cid=27f87)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-04-02T11:07:12.657

我建议您使用`display: inline;`. `float`在IE中搞砸了。这是我将如何处理它的示例：

```
<ul class="side-by-side">
  <li>item 1<li>
  <li>item 2<li>
  <li>item 3<li>
</ul> 
```

这是CSS：

```
.side-by-side {
  width: 100%;
  border: 1px solid black;

}
.side-by-side li {
  display: inline;
} 
```

此外，如果您使用浮点数，`ul`则不会环绕`li`'s，而是在此示例中的高度为 0：

```
.side-by-side li {
  float: left;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-07-06T17:07:59.210

[CSS 3 flex-flow](https://www.w3.org/TR/css-flexbox-1/#flex-flow-property)会变魔术

```
/* This code will do the magic. */
.flex-container {
  display: flex;
  flex-flow: row wrap;
}

/* This code is just to style the inner div elements. */
.flex-container > div {
  background-color: #f1f1f1;
  width: 100px;
  margin: 10px;
  text-align: center;
  line-height: 75px;
  font-size: 30px;
}
```

```
<div class="flex-container">
  <div>1</div>
  <div>2</div>
  <div>3</div>  
  <div>4</div>
  <div>5</div>
  <div>6</div>  
  <div>7</div>
  <div>8</div>
  <div>9</div>
  <div>10</div>
</div>
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T02:14:16.847

使用以下代码浮动项目并确保它们内联显示。

ul.myclass li{float:left;display:inline}

还要确保将它们放入的容器以 100% 的宽度或其他一些技术浮动，以确保浮动项目包含在其中并跟随其下方的项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-05T04:53:09.107

我使用了以上的组合来达到一个工作结果；将 float 更改为 Left 并显示 Block li 本身的 HTML：

```
<ol class="foo">
    <li>bar1</li>
    <li>bar2</li>
</ol> 
```

CSS：

```
.foo li {
    display: block;
    float: left;
    width: 100px;
    height: 100px;
    border: 1px solid black;
    margin: 2px;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-06T08:08:42.533

在您的 css 文件中添加这一行：

```
.classname ul li {
    float: left;
} 
```

# vba - 在 Word 中隐藏文本（尤其是表格）

> ID：827684
> 
> 赞同：1
> 
> 时间：2009-05-06T01:48:16.190
> 
> 标签：vba, ms-word, visibility

我一直在处理一个包含许多隐藏部分的文档，这些部分可以使用复选框（和 VBA）使其可见。其中大部分工作正常，包括使用 Range.Font.Hidden = True 隐藏表格、图片、格式和文本。

我的问题在于隐藏表格，保存文档然后重新打开文档。

文档保存并正常关闭，但重新打开文档时，表格的文本保持隐藏状态，但表格网格线和间距显示，给人一种奇怪但空的表格的外观。

有谁知道避免这个问题的方法或有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T14:56:00.330

您可以像这样隐藏网格线：

```
ActiveWindow.View.TableGridlines = False 
```

但是，如果您的表格有自定义边框，它将不起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T08:10:02.660

在尝试了许多不同的事情之后，即使我的其他部分包含可以正常工作的表格，我最终还是将表格转换回了使它们正常工作的文本。

我似乎无法找到问题，这很烦人，但信息与普通文本一样正常。

# c++ - 托管可执行文件中的非托管库导致托管异常

> ID：827686
> 
> 赞同：0
> 
> 时间：2009-05-06T01:48:43.070
> 
> 标签：c++, sqlite, clr

我在混合托管和非托管代码时遇到问题。我在 Vista x64 SP1 下的 Visual Studio 2008 中的单个解决方案下创建了两个项目。其中之一没有 CLR 支持，是一个静态库。我的第二个项目被编译为启用 CLR 的可执行文件。它依赖于第一个静态库，并将 WinForms 事件传递给它。

当我在没有调试的情况下启动应用程序时，我得到一个异常，我将从异常中获得的信息放在这里： http: [//pastebin.com/f46ad1211](http://pastebin.com/f46ad1211)。

这是运行的非托管库的代码：

```
void manager::init() // <-- Called from the .exe project
{
    this->log.open("C:\\development\\log.txt");
    this->storage = storage_manager(&(this->log), &(this->settings));
    this->storage.load_settings();
} 
```

&

```
void storage_manager::load_settings()
{
    this->error_check(sqlite3_open("settings.db", &(this->db_settings_p)));
    sqlite3_stmt* read_settings;
    this->error_check(sqlite3_prepare_v2(this->db_settings_p, "SELECT name, value FROM settings", 1024, &read_settings, NULL));

    int step_code;
    std::string name;
    std::string value;
    while(true)
    {
        step_code = sqlite3_step(read_settings);
        if(step_code == SQLITE_DONE)
        {
            break;
        }
        else if(step_code == SQLITE_ROW)
        {
            name = std::string(reinterpret_cast<const char*>(sqlite3_column_text(read_settings, 0)));
            value = std::string(reinterpret_cast<const char*>(sqlite3_column_text(read_settings, 1)));
            (*(this->settings))[name] = value;

        }
        else
        {
            this->error();
        }
    }
    sqlite3_reset(read_settings);
    sqlite3_finalize(read_settings);
} 
```

&

```
void storage_manager::error_check(int rc)
{
    if(rc)
    {
        this->error();
    }
}
void storage_manager::error() //Sure of error
{
    std::string error_msg;
    error_msg = "Storage Manager: SQLite Error (";
    error_msg += sqlite3_errcode(this->db_p);
    error_msg += ") - ";
    error_msg += sqlite3_errmsg(this->db_p);
    this->log->write(error_msg.c_str(), error_msg.length());
    this->log->flush();
} 
```

我不明白为什么在非托管库中出现托管 (System.BlahBlahBlah) 异常。有没有办法让两者完全分开？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:16:19.463

底层异常实际上是一个 Windows 异常，CLR 显然为您变成了 CLR 异常。您有访问冲突。您应该能够做的是，在 Visual Studio 中，前往 Debug > Exceptions 并在访问冲突时中断。这应该可以让您进入并查看本机代码中的哪些地方出现了严重错误并开始诊断问题。

# c - 如何在 C 中实现循环缓冲区？

> ID：827691
> 
> 赞同：79
> 
> 时间：2009-05-06T01:52:52.140
> 
> 标签：c, data-structures, circular-buffer

我需要一个固定大小（在创建时可以在运行时选择，而不是在编译时选择）循环缓冲区，它可以保存任何类型的对象，并且它需要*非常*高性能。我认为不会出现资源争用问题，因为尽管它是在多任务嵌入式环境中，但它是一个协作环境，因此任务本身可以管理它。

我最初的想法是在缓冲区中存储一个简单的结构，该结构将包含类型（简单枚举/定义）和一个指向有效负载的 void 指针，但我希望它尽可能快，所以我愿意接受涉及绕过的建议堆。

实际上，我很高兴绕过任何标准库以获得原始速度 - 从我所看到的代码来看，它并没有针对 CPU 进行大量优化：看起来他们只是为之类的东西编译了 C 代码，`strcpy()`没有手工编码组装。

任何代码或想法将不胜感激。所需的操作是：

*   创建具有特定大小的缓冲区。
*   放在尾部。
*   从头上得到。
*   返回计数。
*   删除一个缓冲区。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-05-06T02:18:59.330

最简单的解决方案是跟踪项目大小和项目数，然后创建适当字节数的缓冲区：

```
typedef struct circular_buffer
{
    void *buffer;     // data buffer
    void *buffer_end; // end of data buffer
    size_t capacity;  // maximum number of items in the buffer
    size_t count;     // number of items in the buffer
    size_t sz;        // size of each item in the buffer
    void *head;       // pointer to head
    void *tail;       // pointer to tail
} circular_buffer;

void cb_init(circular_buffer *cb, size_t capacity, size_t sz)
{
    cb->buffer = malloc(capacity * sz);
    if(cb->buffer == NULL)
        // handle error
    cb->buffer_end = (char *)cb->buffer + capacity * sz;
    cb->capacity = capacity;
    cb->count = 0;
    cb->sz = sz;
    cb->head = cb->buffer;
    cb->tail = cb->buffer;
}

void cb_free(circular_buffer *cb)
{
    free(cb->buffer);
    // clear out other fields too, just to be safe
}

void cb_push_back(circular_buffer *cb, const void *item)
{
    if(cb->count == cb->capacity){
        // handle error
    }
    memcpy(cb->head, item, cb->sz);
    cb->head = (char*)cb->head + cb->sz;
    if(cb->head == cb->buffer_end)
        cb->head = cb->buffer;
    cb->count++;
}

void cb_pop_front(circular_buffer *cb, void *item)
{
    if(cb->count == 0){
        // handle error
    }
    memcpy(item, cb->tail, cb->sz);
    cb->tail = (char*)cb->tail + cb->sz;
    if(cb->tail == cb->buffer_end)
        cb->tail = cb->buffer;
    cb->count--;
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-11-20T16:22:27.810

```
// Note power of two buffer size
#define kNumPointsInMyBuffer 1024 

typedef struct _ringBuffer {
    UInt32 currentIndex;
    UInt32 sizeOfBuffer;
    double data[kNumPointsInMyBuffer];
} ringBuffer;

// Initialize the ring buffer
ringBuffer *myRingBuffer = (ringBuffer *)calloc(1, sizeof(ringBuffer));
myRingBuffer->sizeOfBuffer = kNumPointsInMyBuffer;
myRingBuffer->currentIndex = 0;

// A little function to write into the buffer
// N.B. First argument of writeIntoBuffer() just happens to have the
// same as the one calloc'ed above. It will only point to the same
// space in memory if the calloc'ed pointer is passed to
// writeIntoBuffer() as an arg when the function is called. Consider
// using another name for clarity
void writeIntoBuffer(ringBuffer *myRingBuffer, double *myData, int numsamples) {
    // -1 for our binary modulo in a moment
    int buffLen = myRingBuffer->sizeOfBuffer - 1;
    int lastWrittenSample = myRingBuffer->currentIndex;

    int idx;
    for (int i=0; i < numsamples; ++i) {
        // modulo will automagically wrap around our index
        idx = (i + lastWrittenSample) & buffLen; 
        myRingBuffer->data[idx] = myData[i];
    }

    // Update the current index of our ring buffer.
    myRingBuffer->currentIndex += numsamples;
    myRingBuffer->currentIndex &= myRingBuffer->sizeOfBuffer - 1;
} 
```

只要你的环形缓冲区的长度是 2 的幂，令人难以置信的快速二进制“&”操作将为你环绕你的索引。对于我的应用程序，我从麦克风获取的音频环形缓冲区向用户显示一段音频。

我总是确保可以在屏幕上显示的最大音频量远小于环形缓冲区的大小。否则，您可能正在从同一个块读取和写入。这可能会给您带来奇怪的显示伪影。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-06T02:45:21.310

您可以在编写缓冲区代码时枚举所需的类型，还是需要能够在运行时通过动态调用添加类型？如果是前者，那么我会将缓冲区创建为由 n 个结构组成的堆分配数组，其中每个结构由两个元素组成：标识数据类型的枚举标记和所有数据类型的联合。您在小元素的额外存储方面所失去的东西，您可以通过不必处理分配/解除分配以及由此产生的内存碎片来弥补。然后，您只需要跟踪定义缓冲区头部和尾部元素的开始和结束索引，并确保在递增/递减索引时计算 mod n。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-12-15T00:29:17.197

首先，标题。如果您使用位整数来保存头部和尾部“指针”，并且调整它们的大小以使它们完全同步，则不需要模运算来包装缓冲区。IE：填充到 12 位无符号整数中的 4096 本身就是 0，不受任何干扰。消除模运算，即使是 2 的幂，速度也会翻倍——几乎完全一样。

在我的第三代 i7 Dell XPS 8500 上使用 Visual Studio 2010 的 C++ 编译器和默认内联，填充和排出任何类型数据元素的 4096 缓冲区的 1000 万次迭代需要 52 秒，其中 1/8192 用于服务数据。

我将 RX 重写 main() 中的测试循环，这样它们就不再控制流程——而且应该由指示缓冲区满或空的返回值以及随之而来的中断来控制；陈述。IE：填料和排水器应该能够相互碰撞而不会损坏或不稳定。在某个时候，我希望对这段代码进行多线程处理，因此这种行为将是至关重要的。

QUEUE_DESC（队列描述符）和初始化函数强制此代码中的所有缓冲区为 2 的幂。否则上述方案将不起作用。在这个主题上，请注意 QUEUE_DESC 不是硬编码的，它使用清单常量 (#define BITS_ELE_KNT) 进行构造。（我假设 2 的幂在这里足够灵活）

为了使缓冲区大小运行时可选择，我尝试了不同的方法（此处未显示），并决定使用能够管理 FIFO 缓冲区 [USHRT] 的 Head、Tail、EleKnt 的 USHRT。为了避免模运算，我用 Head, Tail 创建了一个 && 的掩码，但这个掩码原来是 (EleKnt -1)，所以就使用它。使用 USHRTS 而不是位整数在安静的机器上提高了约 15% 的性能。英特尔 CPU 内核总是比它们的总线快，因此在繁忙的共享机器上，打包数据结构可以让你在其他竞争线程之前加载和执行。权衡取舍。

请注意，缓冲区的实际存储空间是使用 calloc() 在堆上分配的，并且指针位于结构的底部，因此结构和指针具有完全相同的地址。IE; 不需要将偏移量添加到结构地址以占用寄存器。

同样，与服务缓冲区相关的所有变量在物理上与缓冲区相邻，绑定到同一个结构中，因此编译器可以生成漂亮的汇编语言。您必须终止内联优化才能看到任何程序集，否则它会被遗忘。

为了支持任何数据类型的多态性，我使用了 memcpy() 而不是赋值。如果您只需要在每次编译时灵活地支持一种随机变量类型，那么这段代码就可以完美运行。

对于多态性，您只需要知道类型及其存储要求。描述符的 DATA_DESC 数组提供了一种方法来跟踪放入 QUEUE_DESC.pB​​uffer 中的每个数据，以便可以正确检索它。我只需分配足够的 pBuffer 内存来保存最大数据类型的所有元素，但要跟踪给定数据在 DATA_DESC.dBytes 中实际使用了多少存储空间。另一种方法是重新发明一个堆管理器。

这意味着 QUEUE_DESC 的 UCHAR *pBuffer 将有一个并行的伴随数组来跟踪数据类型和大小，而数据在 pBuffer 中的存储位置将保持原样。新成员可能类似于 DATA_DESC *pDataDesc，或者可能是 DATA_DESC DataDesc[2^BITS_ELE_KNT]，如果您能找到一种方法，通过这样的前向引用使您的编译器提交。Calloc() 在这些情况下总是更灵活。

您仍然会在 Q_Put(),Q_Get 中使用 memcpy()，但实际复制的字节数将由 DATA_DESC.dBytes 决定，而不是由 QUEUE_DESC.EleBytes 决定。对于任何给定的 put 或 get，元素可能具有所有不同的类型/大小。

我相信这段代码可以满足速度和缓冲区大小的要求，并且可以满足 6 种不同数据类型的要求。我以 printf() 语句的形式保留了许多测试装置，因此您可以让自己（或不）确信代码正常工作。随机数生成器表明该代码适用于任何随机头/尾组合。

```
enter code here
// Queue_Small.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include <stdio.h>
#include <time.h>
#include <limits.h>
#include <stdlib.h>
#include <malloc.h>
#include <memory.h>
#include <math.h>

#define UCHAR unsigned char
#define ULONG unsigned long
#define USHRT unsigned short
#define dbl   double
/* Queue structure */
#define QUEUE_FULL_FLAG 1
#define QUEUE_EMPTY_FLAG -1
#define QUEUE_OK 0
//  
#define BITS_ELE_KNT    12  //12 bits will create 4.096 elements numbered 0-4095
//
//typedef struct    {
//  USHRT dBytes:8;     //amount of QUEUE_DESC.EleBytes storage used by datatype
//  USHRT dType :3; //supports 8 possible data types (0-7)
//  USHRT dFoo  :5; //unused bits of the unsigned short host's storage
// }    DATA_DESC;
//  This descriptor gives a home to all the housekeeping variables
typedef struct  {
    UCHAR   *pBuffer;   //  pointer to storage, 16 to 4096 elements
    ULONG Tail  :BITS_ELE_KNT;  //  # elements, with range of 0-4095
    ULONG Head  :BITS_ELE_KNT;  //  # elements, with range of 0-4095
    ULONG EleBytes  :8;     //  sizeof(elements) with range of 0-256 bytes
    // some unused bits will be left over if BITS_ELE_KNT < 12
    USHRT EleKnt    :BITS_ELE_KNT +1;// 1 extra bit for # elements (1-4096)
    //USHRT Flags   :(8*sizeof(USHRT) - BITS_ELE_KNT +1);   //  flags you can use
    USHRT   IsFull  :1;     // queue is full
    USHRT   IsEmpty :1;     // queue is empty
    USHRT   Unused  :1;     // 16th bit of USHRT
}   QUEUE_DESC;

//  ---------------------------------------------------------------------------
//  Function prototypes
QUEUE_DESC *Q_Init(QUEUE_DESC *Q, int BitsForEleKnt, int DataTypeSz);
int Q_Put(QUEUE_DESC *Q, UCHAR *pNew);
int Q_Get(UCHAR *pOld, QUEUE_DESC *Q);
//  ---------------------------------------------------------------------------
QUEUE_DESC *Q_Init(QUEUE_DESC *Q, int BitsForEleKnt, int DataTypeSz)    {
    memset((void *)Q, 0, sizeof(QUEUE_DESC));//init flags and bit integers to zero
    //select buffer size from powers of 2 to receive modulo 
    //                arithmetic benefit of bit uints overflowing
    Q->EleKnt   =   (USHRT)pow(2.0, BitsForEleKnt);
    Q->EleBytes =   DataTypeSz; // how much storage for each element?
    //  Randomly generated head, tail a test fixture only. 
    //      Demonstrates that the queue can be entered at a random point 
    //      and still perform properly. Normally zero
    srand(unsigned(time(NULL)));    // seed random number generator with current time
    Q->Head = Q->Tail = rand(); // supposed to be set to zero here, or by memset
    Q->Head = Q->Tail = 0;
    //  allocate queue's storage
    if(NULL == (Q->pBuffer = (UCHAR *)calloc(Q->EleKnt, Q->EleBytes)))  {
        return NULL;
    }   else    {
        return Q;
    }
}
//  ---------------------------------------------------------------------------
int Q_Put(QUEUE_DESC *Q, UCHAR *pNew)   
{
    memcpy(Q->pBuffer + (Q->Tail * Q->EleBytes), pNew, Q->EleBytes);
    if(Q->Tail == (Q->Head + Q->EleKnt)) {
        //  Q->IsFull = 1;
        Q->Tail += 1;   
        return QUEUE_FULL_FLAG; //  queue is full
    }
    Q->Tail += 1;   //  the unsigned bit int MUST wrap around, just like modulo
    return QUEUE_OK; // No errors
}
//  ---------------------------------------------------------------------------
int Q_Get(UCHAR *pOld, QUEUE_DESC *Q)   
{
    memcpy(pOld, Q->pBuffer + (Q->Head * Q->EleBytes), Q->EleBytes);
    Q->Head += 1;   //  the bit int MUST wrap around, just like modulo

    if(Q->Head == Q->Tail)      {
        //  Q->IsEmpty = 1;
        return QUEUE_EMPTY_FLAG; // queue Empty - nothing to get
    }
    return QUEUE_OK; // No errors
}
//
//  ---------------------------------------------------------------------------
int _tmain(int argc, _TCHAR* argv[])    {
//  constrain buffer size to some power of 2 to force faux modulo arithmetic
    int LoopKnt = 1000000;  //  for benchmarking purposes only
    int k, i=0, Qview=0;
    time_t start;
    QUEUE_DESC Queue, *Q;
    if(NULL == (Q = Q_Init(&Queue, BITS_ELE_KNT, sizeof(int)))) {
        printf("\nProgram failed to initialize. Aborting.\n\n");
        return 0;
    }

    start = clock();
    for(k=0; k<LoopKnt; k++)    {
        //printf("\n\n Fill'er up please...\n");
        //Q->Head = Q->Tail = rand();
        for(i=1; i<= Q->EleKnt; i++)    {
            Qview = i*i;
            if(QUEUE_FULL_FLAG == Q_Put(Q, (UCHAR *)&Qview))    {
                //printf("\nQueue is full at %i \n", i);
                //printf("\nQueue value of %i should be %i squared", Qview, i);
                break;
            }
            //printf("\nQueue value of %i should be %i squared", Qview, i);
        }
        //  Get data from queue until completely drained (empty)
        //
        //printf("\n\n Step into the lab, and see what's on the slab... \n");
        Qview = 0;
        for(i=1; i; i++)    {
            if(QUEUE_EMPTY_FLAG == Q_Get((UCHAR *)&Qview, Q))   {
                //printf("\nQueue value of %i should be %i squared", Qview, i);
                //printf("\nQueue is empty at %i", i);
                break;
            }
            //printf("\nQueue value of %i should be %i squared", Qview, i);
        }
        //printf("\nQueue head value is %i, tail is %i\n", Q->Head, Q->Tail);
    }
    printf("\nQueue time was %5.3f to fill & drain %i element queue  %i times \n", 
                     (dbl)(clock()-start)/(dbl)CLOCKS_PER_SEC,Q->EleKnt, LoopKnt);
    printf("\nQueue head value is %i, tail is %i\n", Q->Head, Q->Tail);
    getchar();
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-12-26T22:28:47.477

这是 C 语言中的一个简单解决方案。假设每个函数都关闭了中断。没有多态性和东西，只是常识。

* * *

```
#define BUFSIZE 128
char buf[BUFSIZE];
char *pIn, *pOut, *pEnd;
char full;

// init
void buf_init()
{
    pIn = pOut = buf;       // init to any slot in buffer
    pEnd = &buf[BUFSIZE];   // past last valid slot in buffer
    full = 0;               // buffer is empty
}

// add char 'c' to buffer
int buf_put(char c)
{
    if (pIn == pOut  &&  full)
        return 0;           // buffer overrun

    *pIn++ = c;             // insert c into buffer
    if (pIn >= pEnd)        // end of circular buffer?
        pIn = buf;          // wrap around

    if (pIn == pOut)        // did we run into the output ptr?
        full = 1;           // can't add any more data into buffer
    return 1;               // all OK
}

// get a char from circular buffer
int buf_get(char *pc)
{
    if (pIn == pOut  &&  !full)
        return 0;           // buffer empty  FAIL

    *pc = *pOut++;              // pick up next char to be returned
    if (pOut >= pEnd)       // end of circular buffer?
        pOut = buf;         // wrap around

    full = 0;               // there is at least 1 slot
    return 1;               // *pc has the data to be returned
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T12:14:46.030

一个简单的实现可能包括：

*   一个缓冲区，实现为大小为 n 的数组，您需要的任何类型
*   读取指针或索引（以您的处理器更有效的为准）
*   写指针或索引
*   指示缓冲区中有多少数据的计数器（可从读写指针派生，但单独跟踪它更快）

每次写入数据时，都会推进写入指针并递增计数器。当您读取数据时，您增加读取指针并减少计数器。如果任一指​​针达到 n，则将其设置为零。

如果 counter = n，你不能写。如果计数器 = 0，您将无法读取。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-10-12T22:13:05.250

C 风格，简单的整数环形缓冲区。首先使用 init，而不是使用 put 和 get。如果缓冲区不包含任何数据，则返回“0”零。

```
//=====================================
// ring buffer address based
//=====================================
#define cRingBufCount   512
int     sRingBuf[cRingBufCount];    // Ring Buffer
int     sRingBufPut;                // Input index address
int     sRingBufGet;                // Output index address
Bool    sRingOverWrite;

void    GetRingBufCount(void)
{
int     r;
`       r= sRingBufPut - sRingBufGet;
        if ( r < cRingBufCount ) r+= cRingBufCount;
        return r; 
}

void    InitRingBuffer(void)
{
        sRingBufPut= 0;
        sRingBufGet= 0;
}       

void    PutRingBuffer(int d)
{
        sRingBuffer[sRingBufPut]= d;
        if (sRingBufPut==sRingBufGet)// both address are like ziro
        {
            sRingBufPut= IncRingBufferPointer(sRingBufPut);
            sRingBufGet= IncRingBufferPointer(sRingBufGet);
        }
        else //Put over write a data
        {
            sRingBufPut= IncRingBufferPointer(sRingBufPut);
            if (sRingBufPut==sRingBufGet)
            {
                sRingOverWrite= Ture;
                sRingBufGet= IncRingBufferPointer(sRingBufGet);
            }
        }
}

int     GetRingBuffer(void)
{
int     r;
        if (sRingBufGet==sRingBufPut) return 0;
        r= sRingBuf[sRingBufGet];
        sRingBufGet= IncRingBufferPointer(sRingBufGet);
        sRingOverWrite=False;
        return r;
}

int     IncRingBufferPointer(int a)
{
        a+= 1;
        if (a>= cRingBufCount) a= 0;
        return a;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-12-23T14:44:36.100

@Adam Rosenfield 的[解决方案](https://stackoverflow.com/a/827749/10975573)虽然是正确的，但可以使用更轻量级的`circular_buffer`结构来实现，该结构不涉及`count`和`capacity`.

该结构只能包含以下 4 个指针：

*   `buffer`: 指向内存中缓冲区的开始。
*   `buffer_end`: 指向内存中缓冲区的末尾。
*   `head`：指向存储数据的结尾。
*   `tail`：指向存储数据的开始。

我们可以保留该`sz`属性以允许对存储单元进行参数化。

`count`和值都`capacity`应该可以使用上述指针进行派生。

# 容量

`capacity`是直截了当的，因为它可以通过将`buffer_end`指针和`buffer`指针之间的距离除以存储单元来得出`sz`（下面的代码段是伪代码）：

```
capacity = (buffer_end - buffer) / sz 
```

# 数数

不过，对于计数，事情变得有点复杂。`head`例如，在和`tail`指向同一个位置的场景下，无法判断缓冲区是空还是满。

为了解决这个问题，缓冲区应该为额外的元素分配内存。例如，如果我们的循环缓冲区所需的容量是`10 * sz`，那么我们需要分配`11 * sz`。

容量公式将变为（下面的代码段是伪代码）：

```
capacity_bytes = buffer_end - buffer - sz
capacity = capacity_bytes / sz 
```

这种额外的元素语义允许我们构建评估缓冲区是空还是满的条件。

## 空状态条件

为了使缓冲区为空，`head`指针指向与指针相同的位置`tail`：

```
head == tail 
```

如果上述计算结果为真，则缓冲区为空。

## 全状态条件

为了使缓冲区满，`head`指针应该是`tail`指针后面的 1 个元素。`head`因此，从该位置跳转到该位置所需覆盖的空间`tail`应等于`1 * sz`。

### 如果`tail`大于`head`：

```
tail - head == sz 
```

如果上述计算结果为真，则缓冲区已满。

### 如果`head`大于`tail`：

1.  `buffer_end - head`返回从`head`缓冲区跳转到末尾的空间。
2.  `tail - buffer`返回从缓冲区开头跳转到尾部所需的空间。
3.  加上上面 2 应该等于从 the 跳转`head`到 the`tail`
4.  步骤 3 中导出的空间，不大于`1 * sz`

```
(buffer_end - head) + (tail - buffer) == sz
=> buffer_end - buffer - head + tail == sz
=> buffer_end - buffer - sz == head - tail
=> head - tail == buffer_end - buffer - sz
=> head - tail == capacity_bytes 
```

如果上述计算结果为真，则缓冲区已满。

# 在实践中

修改@Adam Rosenfield 以使用上述`circular_buffer`结构：

```
#include <string.h>

#define CB_SUCCESS 0        /* CB operation was successful */
#define CB_MEMORY_ERROR 1   /* Failed to allocate memory */
#define CB_OVERFLOW_ERROR 2 /* CB is full. Cannot push more items. */
#define CB_EMPTY_ERROR 3    /* CB is empty. Cannot pop more items. */

typedef struct circular_buffer {
  void *buffer;
  void *buffer_end;
  size_t sz;
  void *head;
  void *tail;
} circular_buffer;

int cb_init(circular_buffer *cb, size_t capacity, size_t sz) {
  const int incremented_capacity = capacity + 1; // Add extra element to evaluate count
  cb->buffer = malloc(incremented_capacity * sz);
  if (cb->buffer == NULL)
    return CB_MEMORY_ERROR;
  cb->buffer_end = (char *)cb->buffer + incremented_capacity * sz;
  cb->sz = sz;
  cb->head = cb->buffer;
  cb->tail = cb->buffer;
  return CB_SUCCESS;
}

int cb_free(circular_buffer *cb) {
  free(cb->buffer);
  return CB_SUCCESS;
}

const int _cb_length(circular_buffer *cb) {
  return (char *)cb->buffer_end - (char *)cb->buffer;
}

int cb_push_back(circular_buffer *cb, const void *item) {
  const int buffer_length = _cb_length(cb);
  const int capacity_length = buffer_length - cb->sz;

  if ((char *)cb->tail - (char *)cb->head == cb->sz ||
      (char *)cb->head - (char *)cb->tail == capacity_length)
    return CB_OVERFLOW_ERROR;

  memcpy(cb->head, item, cb->sz);

  cb->head = (char*)cb->head + cb->sz;
  if(cb->head == cb->buffer_end)
    cb->head = cb->buffer;

  return CB_SUCCESS;
}

int cb_pop_front(circular_buffer *cb, void *item) {
  if (cb->head == cb->tail)
    return CB_EMPTY_ERROR;

  memcpy(item, cb->tail, cb->sz);

  cb->tail = (char*)cb->tail + cb->sz;
  if(cb->tail == cb->buffer_end)
    cb->tail = cb->buffer;

  return CB_SUCCESS;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-08-02T19:03:33.560

扩展 adam-rosenfield 的解决方案，我认为以下内容适用于多线程单生产者 - 单消费者场景。

```
int cb_push_back(circular_buffer *cb, const void *item)
{
  void *new_head = (char *)cb->head + cb->sz;
  if (new_head == cb>buffer_end) {
      new_head = cb->buffer;
  }
  if (new_head == cb->tail) {
    return 1;
  }
  memcpy(cb->head, item, cb->sz);
  cb->head = new_head;
  return 0;
}

int cb_pop_front(circular_buffer *cb, void *item)
{
  void *new_tail = cb->tail + cb->sz;
  if (cb->head == cb->tail) {
    return 1;
  }
  memcpy(item, cb->tail, cb->sz);
  if (new_tail == cb->buffer_end) {
    new_tail = cb->buffer;
  }
  cb->tail = new_tail;
  return 0;
} 
```

# c# - MVC# 在 Winform 中流行吗？

> ID：827692
> 
> 赞同：2
> 
> 时间：2009-05-06T01:53:01.173
> 
> 标签：c#, winforms, model-view-controller

这是一个流行的组合吗（[MVC#](http://www.mvcsharp.org/)和 Winform）？MVC 在传统的 Winform 应用程序开发中真的值得吗？还是我应该坚持使用 3tier 模型？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T01:55:25.300

MVP (Model-View-Presenter) 和 MVP-VM (Model-View-Presenter-ViewModel) 最常与 WinForms 一起使用。

请参阅 SO 问题：

[Winforms - MVP 示例](https://stackoverflow.com/questions/185993/winforms-mvp-examples)

Dan Bunea 的博客文章：[模型视图演示器](http://danbunea.blogspot.com/2005/11/model-view-presenter-is-testing_27.html)

Jeremy D. Miller 的博客文章：[“Humble 对话框”的简单示例](http://codebetter.com/blogs/jeremy.miller/articles/129546.aspx)

Michael Feathers：不起眼[的对话框](http://www.objectmentor.com/resources/articles/TheHumbleDialogBox.pdf)(pdf)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-17T16:01:57.537

看看这个框架 [http://koosserymvcwin.codeplex.com/Wiki/View.aspx?title=koossery.MVCwin%20Overview&referringTitle=Home](http://koosserymvcwin.codeplex.com/Wiki/View.aspx?title=koossery.MVCwin%20Overview&referringTitle=Home)

# c++ - 不使用任何函数计算 e^x

> ID：827706
> 
> 赞同：9
> 
> 时间：2009-05-06T02:00:11.200
> 
> 标签：c++, math, exponential

我们应该使用这种公式计算 e^x：

e^x = 1 + (x ^ 1 / 1!) + (x ^ 2 / 2!) ......

到目前为止我有这个代码：

```
while (result >= 1.0E-20 )
{
    power = power * input;
    factorial = factorial * counter;
    result = power / factorial;
    eValue += result;
    counter++;
    iterations++;
} 
```

我现在的问题是，由于阶乘是 long long 类型，我不能真正存储大于 20 的数字！所以发生的事情是程序在到达那个点时输出有趣的数字..

正确解决方案的 X 值最多为 709，因此 e^709 应输出：8.21840746155e+307

该程序是用 C++ 编写的。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-06T02:10:24.203

x^n 和 n! 随着 n 快速增长（分别为指数和超指数），并且很快就会溢出您使用的任何数据类型。另一方面，x^n/n! 下降（最终），你可以在它很小的时候停下来。也就是说，使用 x^(n+1)/(n+1)! = (x^n/n!) * (x/(n+1))。像这样说：

```
term = 1.0;
for(n=1; term >= 1.0E-10; n++)
{
    eValue += term;
    term = term * x / n;
} 
```

（直接在此框中键入的代码，但我希望它应该可以工作。）

编辑：请注意术语 x^n/n! 是，对于较大的 x，先增加一段时间，然后再减少。对于 x=709，它会上升到 ~1e+306，然后下降到 0，这只是`double`可以处理的极限（`double`的范围是 ~1e308 并将`term*x`其推过），但`long double`工作正常。当然，您的最终*结果*e ^x大于任何项，因此假设您使用的数据类型足够大以容纳结果，您会没事的。

（对于 x=709，只要使用 就`double`可以不用使用`term = term / n * x`，但它不适用于 710。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T02:04:30.817

如果将`factorial`from的类型更改为`long long`to会发生什么`double`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T10:53:43.430

我可以想到另一个解决方案。让`pow(e,x) = pow(10, m) * b`where `b`is`>=1`和`< 10`，然后

```
m = trunc( x * log10(e) ) 
```

其中 in`log10(e)`是一个常数因子。

和

```
b = pow(e,x)/pow(10, m ) = pow(e,x)/pow(e,m/log10(e)) = pow (e,x-m/log10(e)) 
```

通过这个你得到：

```
z = x-m/log10(e) 
```

这将在 0 到 3 之间，然后`b = pow(e,z)`按照 SreevartsR 给出的使用。

最后的答案是

b 是基数（有效数字），m 是尾数（数量级）。

这将比 SreevartsR 方法更快，您可能不需要使用高精度。

祝你好运。

这甚至适用于当 x 小于 0 和更大的负数时，在这种情况下 z 将在 0 到 -3 之间，这将比任何其他方法更快。

由于 z 是 -3 到 3，并且如果您需要前 20 个有效数字，则 pow(e,z) 表达式只能从 3^37/37 开始计算多达 37 个项！= ~ 3.2e-26。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T08:51:17.063

您在这里介绍的是[霍纳方案](http://en.wikipedia.org/wiki/Horner_scheme)在计算多项式方面的应用。

# syntax - 是否有轻松显示和隐藏内容的标准？

> ID：827711
> 
> 赞同：2
> 
> 时间：2009-05-06T02:03:01.163
> 
> 标签：syntax, toggle

*   您是否切换注释或代码块以快速显示或隐藏内容？
*   您使用的一些常用方法是什么？
*   有公认的标准吗？
*   应该避免一些方法吗？*即它们会被某些引擎误解吗？*
*   有没有替代或更好的解决方案？

**标准**- 这是我用来涵盖大多数语言的：CSS、JavaScript、PHP、ActionScript

```
/**/ visible /**/
/**\/ hidden /**/ 
```

**HTML**

```
<!----> visible <!---->
<!----/> hidden <!----> 
```

**PHP** - 定义类似 $hide 的东西效果很好，其他变量可以是生产或开发 - 然后可以隐藏大板并与一个简单的变量更改一起显示。

```
if(0){ hidden }
if(1){ visible }
if(!$HIDE){ content } // $HIDE defined elsewhere, visible if undefined 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T02:08:24.303

我认为如果您可以以编程方式控制正在呈现的内容，那是最好的（就像您在 PHP 中所做的那样）。您编写的更好的解决方案（本质上是本地预处理器宏）是将渲染代码实际分解为生成文档子部分的函数。如果你不需要它，你不调用它，并且你在代码中有明确的条件。例如，这是 MediaWiki 的编写方式。否则，在复杂的项目中，它会变得一团糟。

对代码中的注释进行硬编码存在许多风险。其中：

*   很容易搞砸取消注释

*   不清楚评论了什么。

*   注释掉的部分重叠时出现问题

*   剪切和粘贴错误

*   您想要隐藏的所有内容仍然可以访问，影响搜索引擎等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T02:27:23.117

```
/*
Commented
// */

//*
Not commented
// */ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T03:40:51.943

`if`有些人告诉我，注释掉 C++ 部分的正确方法是使用语句，因为我们显然不再使用预处理器了。

```
if(false)
{
    chunk of code;
} 
```

理论是编译器将从最终产品中优化死代码，并且它们可以嵌套，而`/* */`样式注释不能这样做。

当然，该理论是虚假的，因为您不能使用它来注释掉任意代码区域，例如：

```
class Foo
{
    void Bar();
    if(false)
    {
        int Baz(double); // WRONG!!!
    }
}; 
```

另一方面，这对于像 python 这样允许任何块中的任何语句，并且也缺少标准预处理器或块注释的语言非常有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T03:29:10.147

我更喜欢使用能够理解我正在编辑的源文本结构的文本编辑器（[Vim](https://www.vim.org/)和[Emacs](https://www.gnu.org/software/emacs/)是最受人喜爱的），并且[可以根据编辑器解析的结构进行代码折叠](https://en.wikipedia.org/wiki/Code_folding#Software_with_code_folding_capability)。

Vim[折叠](http://vimcasts.org/episodes/how-to-fold/)或[Emacs 折叠](https://wikemacs.org/wiki/Folding)都满足了我的这种需求。

# c# - 用于在 C# 中调试 db 相关方法的更好的错误处理程序代码？

> ID：827714
> 
> 赞同：0
> 
> 时间：2009-05-06T02:05:10.627
> 
> 标签：c#, database, debugging, error-handling

全部。在 try {} 块之后，我一直在截取以下区域。它的目的是在配置回数据库时提供调试信息......它确实很好地调试（不是它应该调试的全部，但足以准确地找到错误，但是......

代码有味道。即使我能得到它。您对 db 方法的错误处理有更好的了解吗（我目前正在研究 log4net 的实现）

这是代码：

# 区域 CatchExceptionsAdv5NoReturnAtAll

```
 catch (NullReferenceException nre)
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += nre.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch

    catch (System.InvalidOperationException ioe) //comm -- occurs when no result set was found !!!
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ioe.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch (System.InvalidOperationException)

    catch (System.IndexOutOfRangeException ioore) //comm -- occurs when no result set was found !!!
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ioore.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch (System.IndexOutOfRangeException)

    catch (System.Data.SqlClient.SqlException sqle)
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += sqle.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch

    catch (System.FormatException fe)
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += fe.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch

    catch (Exception ex)
    {
        if (userObj == null)
        {
            userObj = new FB.User ();
            FB.User.GiveDefaultUser ( ref userObj );
        }

        System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
            encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
            userObj.Mc.Msg = "Failed to debug application error at " + methodName;
            //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

    } //eof catch
    #endregion CatchExceptionsAdv5NoReturnAtAll 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T02:15:01.837

您应该查看[Enterprise Library 中的异常处理块](http://msdn.microsoft.com/en-us/library/dd203116.aspx)。它可以让你做很多你想做的事情，而无需重复如此大的代码块。但是，一般来说，为什么不考虑每个异常的所有重复代码。至少，如果您不想使用 EntLib，请排除所有重复的代码并为自己构建一个方法库，您可以从异常处理块中干净地调用以执行您想做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T11:49:04.140

我怀疑真正的答案是使用 Enterprise Library 还是 log4net ...同时，重构的快速而肮脏的方法是用以下调用替换该区域：

```
 catch (Exception ex)
  {
    System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace ();
    Utils.ErrorHandler.Trap ( ref userObj, st, ex );
    return false;
  } //eof catch 
```

它指向下面给出的错误处理程序类，它没有改进错误报告，也没有为错误报告提供更好的体系结构......到目前为止，它只是删除了重复的代码并提高了可读性：

```
using System;

namespace Utils
{
  public class ErrorHandler
  {

    public static void Trap ( ref FB.User userObj, System.Diagnostics.StackTrace st, Exception ex )
    {
      if (userObj == null)
      {
        userObj = new FB.User ();
        FB.User.GiveDefaultUser ( ref userObj );
      }

      if (ex is NullReferenceException)
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof if

      if (ex is System.InvalidOperationException) //comm -- occurs when no result set was found !!!
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof if

      if (ex is System.IndexOutOfRangeException) //comm -- occurs when no result set was found !!!
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof if

      if (ex is System.Data.SqlClient.SqlException)
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof if

      if (ex is System.FormatException)
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof if

      if (ex is Exception)
      {
        if (userObj == null)
        {
          userObj = new FB.User ();
          FB.User.GiveDefaultUser ( ref userObj );
        }

        string methodName = st.GetFrame ( 1 ).GetMethod ().Name;
        string className = st.GetFrame ( 1 ).GetFileName ();
        int lineNumber = st.GetFrame ( 1 ).GetFileLineNumber ();

        string encryptedErrorCode = String.Empty;
        encryptedErrorCode += "className - " + className + " methodName ";
        encryptedErrorCode += methodName + " lineNumber " + lineNumber.ToString ();
        encryptedErrorCode += userObj.DomainName;

        if (System.Convert.ToInt16 ( BL.Conf.Instance.Vars["EncryptErrorMessages"] ) == 1)
          encryptedErrorCode = Utils.DataEncryption.EncryptString ( encryptedErrorCode, userObj.DomainName );

        userObj.Mc.Msg = "An error in the application occurred. Report the following error code " + encryptedErrorCode;
        userObj.Mc.ClassName += className + " ; ";
        userObj.Mc.MethodName += methodName + " ; ";
        userObj.Mc.DebugMsg += ex.Message;
        //
        if (Providers.nsDbMeta.DbDebugger.DebugAppError ( ref userObj ) == false)
        {
          userObj.Mc.Msg = "Failed to debug application error at " + methodName;
          //Providers.nsDbMeta.Providers.nsDbMeta.DbDebugger.WriteIf ( userObj.Mc.Msg );
        }

      } //eof catch

    } //eof method 

  }//eof class CustomException
} //eof namespace U 
```

# javascript - 使用适用于 IE 的 Javascript 模拟单击 链接

> ID：827716
> 
> 赞同：22
> 
> 时间：2009-05-06T02:06:47.113
> 
> 标签：javascript, internet-explorer, firefox

我想让java脚本点击页面上的链接..我在网上发现了一些建议添加这样的函数：

```
function fireEvent(obj,evt){

    var fireOnThis = obj;
    if( document.createEvent ) {
      var evObj = document.createEvent('MouseEvents');
      evObj.initEvent( evt, true, false );
      fireOnThis.dispatchEvent(evObj);
    } else if( document.createEventObject ) {
      fireOnThis.fireEvent('on'+evt);
    }
} 
```

然后使用以下命令调用它：

```
fireEvent(document.getElementById('edit_client_link'),'click'); 
```

这似乎适用于 FF，但对于 IE，它不起作用！

有任何想法吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-06T02:37:57.587

我认为您仍然需要调用 document.createEventObject ——您只检查了它是否存在。下面是未经测试的代码，但基于[文档](http://msdn.microsoft.com/en-us/library/ms531020(VS.85).aspx)它应该可以工作。

```
function fireEvent(obj,evt){

    var fireOnThis = obj;
    if( document.createEvent ) {
      var evObj = document.createEvent('MouseEvents');
      evObj.initEvent( evt, true, false );
      fireOnThis.dispatchEvent( evObj );

    } else if( document.createEventObject ) {
      var evObj = document.createEventObject();
      fireOnThis.fireEvent( 'on' + evt, evObj );
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-08T23:59:40.787

起初这对我不起作用，然后我看到代码缺少 IE 部分的参数。这是一个应该有效的更新：

```
function fireEvent(obj, evt) {
    var fireOnThis = obj;

    if (document.createEvent) {
        // alert("FF");
        var evtObj = document.createEvent('MouseEvents');
        evtObj.initEvent(evt, true, false);
        fireOnThis.dispatchEvent(evtObj);
    } 

    else if (document.createEventObject) {
        // alert("IE");
        var evtObj = document.createEventObject();
        fireOnThis.fireEvent('on'+evt, evtObj);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-17T09:47:09.640

如果您仍然遇到错误，请尝试此操作（使用 Jquery + 原型）

```
function fireEvent(element,event){  
if (document.createEventObject){
// dispatch for IE
try {
      var evt = document.createEventObject();
      jQuery(element).change();
      return element.fireEvent('on'+event,evt);
} catch(e) { }                  
}
else{
// dispatch for firefox + others
var evt = document.createEvent("HTMLEvents");
evt.initEvent(event, true, true ); // event type,bubbling,cancelable
return !element.dispatchEvent(evt);
}
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-10T17:54:26.283

如果你只想模拟**链接**的点击，你可以使用这个：

```
function clickLink(id){
location.href=document.getElementById(id).href;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-15T23:02:38.057

我们找到了一种更简单的方法来模拟右键单击（在 IE8 中测试）。使用双击或单击两次，然后使用 Shift-F10 右键单击​​。我不知道为什么会这样，但确实如此。在下面的示例代码中，我们使用 Selenium 方法单击两次，然后使用 IE 驱动程序找到 WebElement 并发送键序列 Shift-F10，它模拟了鼠标右键单击。我们使用它来测试基于 GWT 的 Web 应用程序。有一个地方不能很好地工作是在一个树控件中，其中上下文菜单被设置为出现在鼠标的坐标处。通常，鼠标坐标是负数，因此右键单击菜单项不会导致显示子菜单选项。为了处理这种情况，我们向控件添加了一些代码，这样如果鼠标坐标为负数，上下文菜单就会出现在 0,0 处。

```
selenium.click("//td[@role='menuitem' and contains(text(), 'Add')]");
selenium.click("//td[@role='menuitem' and contains(text(), 'Add')]");
new InternetExplorerDriver().findElement(By.xpath("//td[@role='menuitem' and contains(text(), 'Add')]")).sendKeys(Keys.SHIFT, Keys.F10); 
```

# php - 如何将已经编写好的 CodeIgniter 代码移动到 Kohana？

> ID：827722
> 
> 赞同：12
> 
> 时间：2009-05-06T02:08:29.917
> 
> 标签：php, codeigniter, frameworks, migration, kohana

我使用 CodeIgniter 已经有一段时间了，我非常喜欢它。不过，看起来我需要搬到 Kohana，因为我的其他团队成员需要我们的代码才能充分利用 PHP5 功能。问题是我们已经在 CodeIgniter 中编写了超过一半的项目。以前有没有人将代码从 CodeIgniter 转移到 Kohana？甚至有可能做到吗？如果可以，需要付出多少努力？先感谢您！

**更新**：从[abi noda](https://stackoverflow.com/users/74980/abi-noda)的回答看来，我真的需要做很多代码重写，但是以前有没有人这样做过？也许有人可以给我一些链接？是的，我认为可以做到，但我不知道需要多长时间。我想我们会将这个项目保留为 CodeIgniter 项目，并在我们的下一个项目到来时立即转移到 Kohana。感谢一切！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T02:43:09.040

~~请参阅 Kohana 的文档 -[从 CodeIgniter 迁移](http://docs.kohanaphp.com/installation/migration)。~~

#kohana IRC 的一位聪明人告诉我，不再存在简单的迁移。自从从 Codeigniter 分叉以来，Kohana 发生了很大的变化。它们现在是非常不同的框架，因此您必须重写大部分代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-27T14:37:24.883

CodeIgniter 在 PHP5 上运行良好。

它向后兼容 PHP4，但无需在 PHP4 上运行它。

您的团队无法在 CodeIgniter 中使用 PHP5 的哪一部分？

# asp.net - 从呈现的控件 ID 中删除 ctl00$ContentBody$

> ID：827723
> 
> 赞同：7
> 
> 时间：2009-05-06T02:08:45.377
> 
> 标签：asp.net, master-pages

我对以前只是纯 HTML 和 Javascript 的现有应用程序进行了一些更改。为了添加服务器端功能，我选择了 ASP.NET，并利用了母版页概念。不幸的是，在一个巨大的 Web 表单上，控件 ID 都带有“ctl00$ContentBody$”前缀。我在所有 INPUT 控件上添加了一个 runat="server"，这就是改变 ID 的原因。现在 ID 已更改，Javascript（写得非常糟糕，我什至无法阅读，而且我对 JS 非常有经验）完全被破坏了。

那么，我怎样才能防止这种废话被渲染到 HTML 中呢？我希望能够以某种方式创建一个继承 HtmlGenericControl 的类（我没有使用 Web 控件，我只是在每个输入标签上添加了 runat="server"）并以某种方式覆盖了将这个“容器 id”粘贴在ID 和 NAME 属性的开头。然后我可以在 web.config 中使用 tagMapping 来进行全局更改。这可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T02:53:06.817

现在有点安慰，但这个“功能”将在 Asp.Net 4.0 中修复。您将获得可设置的 ClientID 属性。

除此之外，其他的反应都很好。
使用 <%= control.ClientID %>

或抛出 JQuery 并使用 $("[id$='myId'])

或者，在您的输入标签上，不要放置 runtime='server'。您应该能够通过 Form 成员检索值（就像在传统的 asp 中一样）

或者，跳过 Asp.Net WebForms 并跳到 Asp.Net MVC，它使您可以完全控制生成的 HTML 标记。你必须更多地改变你做事的方式，但这对你来说可能不那么令人沮丧。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-03T08:19:50.327

我尝试了这段代码，由于某种原因它重新组织了整个页面：

```
Protected Overrides Sub Render(ByVal writer As System.Web.UI.HtmlTextWriter)
    Dim Html As New StringWriter()
    Dim Render As New HtmlTextWriter(Html)
    MyBase.Render(Render)
    writer.Write(Html.ToString().Replace("name=""ctl00$ContentBody$", "name=""").Replace("id=""ctl00_ContentBody_", "id="""))
End Sub 
```

如果您希望查看示例，请提交 URL

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T02:39:41.090

我知道没有办法将命名容器从附加到控件 ID 中删除。过去，我使用一种便捷的方法在 javascript 中查找此类 id，该方法遍历标签名称并使用正则表达式来匹配以 结尾的 id `$realID`，其中`realID`是我在标记中提供给控件的 id。现在，我将为此使用 jQuery，使用如下选择器：

```
 $('[id$="realID"]') 
```

这与我以前的便捷方法基本上做同样的事情，但它内置在框架中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T02:43:57.243

据我所知，由于您所说的原因，无法删除它们；以确保它们是独一无二的。在我看来，您有两种选择：

1.  创建一个 JS 变量并将其添加到所有 JS 调用中，以便查找正确的 ID
2.  在您的 javascript 中使用 <%= control.ClientID %> 以便它使用新 ID。

如果您的任何输入在任何其他服务器标签内，则使用 #1 将不起作用。这很容易出现很多问题，所以如果可以的话，我会选择#2。

2 取决于页面本身的 javascript 或者如果 JS 是外部的，您需要能够传入 ID。此代码未经测试，仅作为示例，但我的意思是：

```
function alertValue(textID){
     alert(document.GetElementById(textID).value);
}

<input id="txtBox" runat="server" type="Button" text="Click Me" onClick="alertValue('<%= txtBox.ClientID %>');" /> 
```

这真的取决于你的 JS 是如何实现的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T03:02:11.693

由于您似乎只是想从最终输出中删除客户端 ID，因此您可能能够覆盖页面上的呈现事件并使用正则表达式来删除它们。您可以在下面的帖子中看到一个示例。

[重写 ASP.NET 页面输出](https://stackoverflow.com/questions/710725/rewrite-asp-net-page-output/710770#710770)

在你得到你正在使用的文本后，你很可能会写出类似......

```
output = Regex.Replace(
    output, 
    @"id\=""ctl00\$[^\""]*""", 
    string.Empty, 
    RegexOptions.IgnoreCase
    ); 
```

然后将最终输出写入 HtmlTextWriter。

希望有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T03:40:22.147

伙计们，我需要的是快速而肮脏的东西。感谢 HBoss，我能够想出一个非常简单的解决方案。在相关页面的代码隐藏中，我刚刚添加了这个子例程......

```
Protected Overrides Sub Render(ByVal writer As System.Web.UI.HtmlTextWriter)
    Dim Html As New StringWriter()
    Dim Render As New HtmlTextWriter(Html)
    MyBase.Render(Render)
    writer.Write(Html.ToString().Replace("name=""ctl00$ContentBody$", "name=""").Replace("id=""ctl00_ContentBody_", "id="""))
End Sub 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-06-09T08:41:08.857

检查这个：[http](http://clientidless.codeplex.com/) ://clientidless.codeplex.com/ - 您可以关闭几乎任何控件的 ClientID。这是演示：[http](http://show-demos.net/NoClientId/) ://show-demos.net/NoClientId/ - 按“无 ID 渲染”或“使用 ID 渲染”查看页面大小如何变化。查看源代码以查看差异。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-17T19:13:16.223

我想把我的两分钱加到这个上：

我是这样做的（在接受的答案中），但是认为覆盖 Render 控件以写入新的 TextWriter 然后将其内容写入 Page`OutputStream`对我来说似乎是一种资源浪费。我发现这可以通过创建一个小类来覆盖`HtmlTextWriter`该类来完成。这样，我们直接写入流，并且仅在将文本用作属性时尝试替换文本。

```
public class CleanHtmlTextWriter : HtmlTextWriter
{
    private const string MASTER_PAGE_ID = "ctl00";
    private const string CONTENT_NAME = "MainContent";

    public CleanHtmlTextWriter(TextWriter writer)
        : base(writer)
    {
    }

    public override void WriteAttribute(string name, string value)
    {
        if (name == "name")
            value = value.Replace(CONTENT_NAME + "$", "").Replace(MASTER_PAGE_ID + "$", "");

        if (name == "id")
            value = value.Replace(CONTENT_NAME + "_", "").Replace(MASTER_PAGE_ID + "_", "");

        base.WriteAttribute(name, value);
    }
} 
```

然后你可以像这样使用它：

```
protected override void Render(HtmlTextWriter writer)
{
    base.Render(new CleanHtmlTextWriter(writer));
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-02-09T03:45:40.597

实际上，为了借鉴 Josh 的回答，我发现下面的第一个解决方案与其他输入控件元素和 PostBacks 无法正常工作存在问题。因此，我没有进行空白更改，而是选择了下面的第二种解决方案来更改 JavaScript 而不是元素名称。

**乔希的解决方案**：

代码隐藏：

```
protected override void Render(System.Web.UI.HtmlTextWriter writer)
{
    StringWriter Html = new StringWriter();
    HtmlTextWriter Render = new HtmlTextWriter(Html);
    base.Render(Render);
    writer.Write(Html.ToString()
        .Replace("name=\"ctl00$ContentBody$", "name=\"")
        .Replace("id=\"ctl00_ContentBody_", "id=\""));
} 
```

**解决方案 1**，有 PostBack 问题（注意：我无法更改可能解决此解决方案的 ID）：

代码隐藏：

```
protected override void Render(System.Web.UI.HtmlTextWriter writer)
{
    var html = new StringWriter();
    var render = new HtmlTextWriter(html);
    base.Render(render);
    writer.Write(html.ToString()
        .Replace("name=\"ctl00$contentBody$rbl",
                 "name=\"ctl00_contentBody_rbl"));
} 
```

**解决方案 2**，更改 JavaScript：

单选按钮列表使用约定 'rbl[name]' 的 aspx 文件中的 JavaScript：

```
if (!validateRadioButtonList("<% =rblTitle.ClientID %>")) 
```

代码隐藏：

```
protected override void Render(System.Web.UI.HtmlTextWriter writer)
{
    var html = new StringWriter();
    var render = new HtmlTextWriter(html);
    base.Render(render);
    writer.Write(html.ToString()
        .Replace("validateRadioButtonList(\"ctl00_contentBody_rbl", 
                 "validateRadioButtonList(\"ctl00$contentBody$rbl"));
} 
```

# c - 在 Cocoa / Obj-C 项目中声明外部函数

> ID：827726
> 
> 赞同：0
> 
> 时间：2009-05-06T02:10:47.540
> 
> 标签：c, objective-c, cocoa, function

好的，这就去。我已经完成了一个计算随机整数平均绝对偏差的 Cocoa 基础工具（就像一个学习项目）。

我已经将计算转移到一个名为“findMeanAbsoluteDeviation()”的函数中，它接受一个由 NSNumber 对象组成的 NSMutableArray 来执行计算。无论如何。因此，当我在与其他代码相同的“.m”文件中声明它时，这一切都很好。

```
#import <Foundation/Foundation.h>

float findMeanAbsoluteDeviation(NSMutableArray * array);

int main (int argc, const char * argv[]) {
    ...generate random integers, execute function...
    meanAbsoluteDeviation = findMeanAbsoluteDeviation(numArray);
}

float findMeanAbsoluteDeviation(NSMutableArray * array) {
    ...mean absolute deviation maths... 
```

}

它工作正常。现在，我想将函数移动到外部文件。我创建了一个名为“mad”的 NSObject 子类。我将函数移动到我疯狂的“mad.m”中，我阅读然后重新格式化声明看起来像

```
-(float)findMeanAbsoluteDeviation:(NSMutableArray *)array {
    ...code...
} 
```

在我的“mad.h”文件中。

```
@interface mad : NSObject {

}

    - (float)findMeanAbsoluteDeviation:(NSMutableArray *)array;

@end 
```

看起来都很棒。正确的？我所要做的就是添加...

```
#import "mad.m" 
```

到我的“main.m”文件的顶部并像往常一样使用该功能。好吧，它似乎没有正确编译。

```
ld: duplicate symbol .objc_class_name_mad in ------standardDeviation.build/Debug/standardDeviation.build/Objects-normal/i386/mad.o and ------standardDeviation.build/Debug/standardDeviation.build/Objects-normal/i386/standardDeviation.o 
```

“-----”为了篇幅而被省略

```
Command /Developer/usr/bin/gcc-4.0 failed with error code 1 
```

有任何想法吗？谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T02:25:10.143

你想要`#import "mad.h"`，`#import "mad.m"`否则类实现被评估两次，因此你看到的错误。

几个风格点：

*   如果您没有将对象的实例变量用于任何事情，则通常编写类方法 (+) 而不是实例方法 (-)。
*   如果类接口对您正在做的事情没有意义，那么在 Objective-C 头文件中声明 C 函数原型是没有问题的。见`NSGeometry.h`一些例子。
*   如果您不在函数或方法中更改数组，请不要使用可变数组参数。
*   考虑对类、方法和函数使用标准 Cocoa 命名约定。

例如：

```
@interface MEMeanAbsoluteDeviation : NSObject {
}
+ (float)meanAbsoluteDeviation:(NSArray *)array; 
```

或者简单地说：

```
float MEMeanAbsoluteDeviation(NSArray *array); 
```

# javascript - 有没有办法通过javascript检测关闭页面？

> ID：827728
> 
> 赞同：3
> 
> 时间：2009-05-06T02:12:09.940
> 
> 标签：javascript, events

我在这里看了几个线程，主要使用这个：window.onbeforeunload = function (e) { var e = e || 窗口.事件；

//IE & Firefox if (e) { e.returnValue = '你确定吗？'; }

// 对于 Safari，返回“你确定吗？”；};

但这似乎会混合刷新页面和关闭页面的情况，有没有可能区分这两种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T02:33:00.750

```
function OnUnLoad()
{
    if (window.event.clientY < 0 && window.event.clientX < 0)
    {
        //cleanup code goes here...
    }       
} 
```

这似乎适用于所有浏览器。但是关闭标签似乎会导致问题。实际上，没有“记录”的方式来做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T02:18:36.900

真的没有办法区分 Javascript 中的两个不同事件。您可以采用 GMail 方法并对所有内容使用 AJAX，以免导致页面重新加载。这意味着调用“OnBeforeUnload”的唯一时间是用户实际离开页面的时候。另一种方法是将 JS 放在所有链接上，以在他们单击链接时禁用 OnBeforeUnload 脚本，但您只希望在浏览器实际关闭时触发偶数。

就浏览器而言，用户单击链接以导航离开您的页面与单击浏览器关闭按钮之间没有任何区别。

# arrays - 为什么在动态数组的末尾插入 O(1) 而在中间插入是 O(n)？

> ID：827729
> 
> 赞同：2
> 
> 时间：2009-05-06T02:12:20.907
> 
> 标签：arrays, data-structures, big-o

根据维基百科关于[动态数组](http://en.wikipedia.org/wiki/Dynamic_array)的文章，在数组末尾插入/删除是 O(1)，而从中间插入/删除是 O(n)。为什么会这样？

另外 - 如果我有一个包含 5 个元素的动态数组，并且我在位置 6 插入一个新元素，则操作为 O(n)，而如果我使用该函数附加到数组的末尾，则为 O(1)。假设数组在任何一种情况下都不需要调整大小，这不是相同的操作吗？或者附加到动态数组是否真的在位置 6 之外的某个地方插入了新元素？

谢谢！

**编辑：**我认为我的主要困惑是在数组末尾插入和在相当于数组末尾的特定位置插入之间的区别。

我想指向数组末尾的内存地址的指针很方便，这就是附加操作很快的原因。相反，如果我指定一个精确的位置（即使它是数组的末尾），它不会知道在那个位置插入就等于使用上述内存地址，所以它必须遍历整个数组，是吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T02:13:58.687

要在数组的末尾插入，您只需将项目放在那里。

要插入到数组的中间，您需要将该点之后的项目向上移动一个。

要从数组的末尾删除，只需将其计数减一即可。

要从中间删除，您必须这样做*并将*其他项目向下移动。

正是这种*转变*将其变成了 O(n)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-06T02:16:49.087

数量级完全取决于“动态数组”实际上是哪种数据结构（“动态数组”不是严格定义的数据结构，它更多的是通过使用特定数据结构实现的预期结果）。您给出的示例将通过使用链表实现的动态数组来反映。如果列表结构保留指向最终元素的指针，则添加到末尾可能是 O(1)。插入（无论索引如何）需要遍历链表，这意味着每个节点执行一次操作，直到所需索引为止。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T02:16:47.060

这很简单：

在中间插入涉及将后面的每个元素移动 1。要在最后插入，如果保留了额外的空间，则项目只是存储在那里，但如果没有分配新空间。因此这个操作是在[摊销的常数时间内](http://en.wikipedia.org/wiki/Amortized_constant_time)完成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T02:36:37.213

添加到亚当罗宾逊的精彩总结：这不仅仅是理论。我见过许多情况，其中动态数组是通过重复附加到数组末尾来构造的。这会`(N**2)`降低性能，因为数组需要反复重新分配，迫使其每个成员都被复制到新的数组结构中。重新分配可能仅发生在 1/10 的附加操作上，但这已经够糟糕了，而且在`(N**2)`性能方面仍然不理想。

`vector::reserve(N)`在 STL 中，可以通过在写入向量之前调用来避免这种性能损失；但是这一步经常被忽视。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-06T02:18:21.627

实际上，它不是 Big-O 而是[Big-Theta](http://en.wikipedia.org/wiki/Big_oh#The_family_of_Bachmann.E2.80.93Landau_notations)。

# java - 我可以用 EJB 做什么？

> ID：827732
> 
> 赞同：2
> 
> 时间：2009-05-06T02:13:23.870
> 
> 标签：java, ejb

我想测试我在 EJB 方面的知识，制作一个小型应用程序。你能给我一些使用 EJB 的想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T03:08:49.040

写一个博客引擎。它可以像您喜欢的那样简单或复杂。任何人都可以很容易地理解这个概念。另外，如果您遇到困难，还有很多示例可供参考。此外，如果您在此过程中需要帮助，向某人（例如在 StackOverflow 上）解释您遇到的问题并不难。他们会直观地理解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T02:32:33.777

全部使用它们：

消息：消息驱动的 bean 侦听队列。保持消息简单：外部客户端发送的简单字符串消息。

实体：一个持久化的实体记录最后收到的消息。msgBean 更新实体的“lastMsg”属性。这是交易性的。

会话：无状态会话在任何给定时刻返回最后一条消息，作为一个简单的服务。

会话：用于简单 servlet 客户端的有状态会话。web ui 有一个文本字段（用于最后一个消息）和一个用于刷新的按钮。

如果你能做到这一点，那么你就在路上了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T02:30:56.307

尝试为学校制定一个日程安排系统。例如，制作课程、课程实例、讲师、位置、课程要求。

首先制作实体，然后制作外观并尝试使用它们。然后你可以制作一个web界面和webservice。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T04:51:56.967

尝试使用[EJB in Action](http://www.manning.com/panda/)的代码示例。你可以在[这里](http://www.manning.com/panda/)找到源代码。该源可用于 JBoss、Glassfish、OracleAS。通过这种方式，您可以很好地掌握所有类型的 bean，以及 JPA 的东西。

干杯。

# c# - Powershell脚本删除旧文件

> ID：827738
> 
> 赞同：5
> 
> 时间：2009-05-06T02:15:48.217
> 
> 标签：c#, powershell, delete-file

以下脚本将删除命名目录中超过 14 天`.txt`的文件，并使用已删除的路径和文件写入 a（在另一个论坛上找到此脚本..credit to shay）：

```
dir c:\tmp -recurse | where {!$_.PsIsContainer -AND $_.lastWriteTime -lt (Get-Date).AddDays(-14) } | select LastWriteTime,@{n="Path";e={convert-path $_.PSPath}} | tee c:\oldFiles.txt | Remove-Item -force -whatif 
```

我有3个问题：

1.  什么是`-lt`，什么是`-le`，什么是`-gt`？我什么时候用每一个
2.  上面的脚本只删除文件......我怎样才能删除文件夹呢？
3.  上面的脚本是基于`LastWriteTime`..`CreatedDate`或者`LastAccessed`时间？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T02:32:33.543

好的，我们开始：

1.  -lt、-le 和 -gt 是比较运算符。lt 表示小于，le 表示小于或等于，gt 表示大于。

2.  如果您无法控制其中的内容，则删除文件夹可能会很危险。您可能会遇到问题，请注意数据丢失。您可以使用相同的 Remove-Item cmdlet 删除文件夹，只需使用其选项即可。查看这篇文章，它对如何实现它有很好的说明： [http ://searchwindowsserver.techtarget.com/generic/0,295582,sid68_gci1275887,00.html](http://searchwindowsserver.techtarget.com/generic/0,295582,sid68_gci1275887,00.html)

3.  通常，对于已经存在一段时间的文件，LastWriteTime 和 CreatedDate 和 LastAccessTime 将是相同的。在只读文件（如 DLL）中，LastAccessTime 可能比其他两个更新。在读/写文件（如 Outlook 的 pst 文件）中，WriteTime 和 AccessTime 可能相同。基本上，这完全取决于你。它们的工作方式与 LastWriteTime 相同。考虑要删除的文件的性质，然后继续！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T02:27:20.840

-lt -le 和 -gt 是比较运算符，而不是 <、<=、>。在 powershell 命令提示符处键入“ **help about_Comparison_Operators** ”，了解每种类型的详细信息以及使用这些类型而不是您熟悉的其他语言的原因的原因。

要删除文件夹，您还需要删除**!$.PsIsContainer 和**where 过滤器的一部分。这是从目录列表中删除所有项目。

我不确定您对“CreatedDate 或 LastAccessed 时间怎么样”这个问题的要求，但您可以简单地以与 LastWriteTime 类似的方式使用这些属性，但您需要决定您要实现的逻辑。

# jira - 教软件开发人员如何务实地使用项目/错误/任务跟踪工具的书籍/资源

> ID：827744
> 
> 赞同：2
> 
> 时间：2009-05-06T02:17:02.050
> 
> 标签：jira, project-management

有谁知道优秀的（在您看来）书籍/网站，它们详细介绍了如何务实地使用错误/任务/项目管理工具来帮助改进软件开发过程？理想情况下，我想要“来自海沟”的资源，而不是理论。

此类管理工具的示例有：JIRA/Confluence 组合、Visual Studio Team System/Sharepoint、FogBugz 等。

我想我正在寻找类似于 3 Pragmatic 丛书（源代码控制、单元测试和构建自动化）之类的书籍。想想看，我希望务实的家伙也发布了一本关于如何将项目管理工具集成到他们的软件开发过程。

我知道一些可能适合我的问题的答案：

使用 FogBugz 进行无痛项目管理，第二版 Visual Studio Team System：为敏捷团队提供更好的软件开发 使用 Microsoft Visual Studio Team System 进行软件工程

就像我们如何学习不同的编程语言来拓宽我们的思维过程一样，我真的不介意这本书/网站使用什么工具。我最感兴趣的是该工具如何集成到软件开发过程中以帮助改进它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:21:54.753

史蒂夫·麦康奈尔 (Steve McConnells) 的书《[快速发展》](https://rads.stackoverflow.com/amzn/click/com/1556159005)

您是否也看过实用书架中的这些书：

[管理它！：现代实用项目管理指南](https://rads.stackoverflow.com/amzn/click/com/0978739248)

[装运它！成功软件项目的实用指南](https://rads.stackoverflow.com/amzn/click/com/0974514047)

[发布它！：设计和部署生产就绪软件](https://rads.stackoverflow.com/amzn/click/com/0978739213)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T02:23:06.827

如果您想要“从战壕中”，就很难击败[Virtual Labs](http://msdn.microsoft.com/en-us/aa740411.aspx)。它们使您有机会亲身体验该技术（在这种情况下为 VSTS）。有关于变更管理、管理开发工作、版本控制等的 VSTS 实验室。

# iphone - 如何拍摄显示选定行的 iPhone 模拟器的快照

> ID：827752
> 
> 赞同：1
> 
> 时间：2009-05-06T02:19:50.407
> 
> 标签：iphone, ios-simulator

I'm trying to take a snapshot of the iPhone simulator when a row in a table view is selected, before the new view appears. 在选择行的情况下，我无法找到可以停止模拟器的点，以便我可以对其进行快照。我怎么做？

谢谢你的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:28:53.677

这是一个很长的镜头，但我注意到在 iPhone 上，当您触摸但未释放该行时，该行被选中，但直到您抬起手指，您才会转换到新视图。现在在 Mac 上的模拟器上（我假设）如果它的工作方式相同，您可以在捕获工具上设置几秒钟的超时时间，然后选择该行并按住鼠标按钮，直到超时拍摄快照. 我能够在其他（不太流行的）系统上做类似的事情，但现在不记得它是否在 Mac 上以同样的方式工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:37:15.987

我假设你有源代码；只需注释掉临时选择行时执行某些操作的代码（`- (void) tableview:didSelectRowAtIndexPath:`），单击该行，截取屏幕截图，取消注释代码。

除非您调用`[tableview deselectRowAtIndexPath:animated:]`该行，否则只要显示视图，该行就会保持选中状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T02:34:55.080

尝试使用操作系统的屏幕截图工具。例如，打开 Preview 并选择 File > Grab > Timed Screen，然后切换回 iPhone Simulator 并在表格视图中的行上按住鼠标按钮，直到屏幕闪烁。如果您更像是一个命令行人员，请尝试以下操作：

```
screencapture -T 2 foo.png & ; open -a 'iPhone Simulator' 
```

# windows-xp - 如何从 Windows XP 的批处理文件中设置处理器关联？

> ID：827754
> 
> 赞同：8
> 
> 时间：2009-05-06T02:21:32.680
> 
> 标签：windows-xp, batch-file, executable, dos, affinity

我有一台双处理器机器，我想通过两个处理器上的批处理文件启动可执行文件。

例如：(1) 在处理器 1 上启动 Notepad.exe，以及 (2) 同时在处理器 2 上启动 Notepad.exe

目前，我在批处理文件中使用以下内容，因为我的可执行文件“难以”启动并且需要返回才能在启动时运行：echo.|DoStuff.exe

因此，我想启动它并让它在每个处理器上运行。

感谢您提供的任何反馈。

PS我不认为“开始”对我有用，因为我需要将返回字符发送到可执行文件，如上图所示。

PSS 这适用于 Windows XP 解决方案。谢谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-06T02:39:00.157

启动 /affinity 1 notepad.exe

启动 /affinity 2 notepad.exe

（Windows7 对启动命令有亲和力，但 XP 没有。但 PSexec 可以工作）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T02:21:01.533

Microsoft 的 Sysinternal 的[psexec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)的 -a 标志可以在 Windows XP 上设置处理器关联：

```
用法：psexec [\\computer[,computer2[,...] | @file][-u 用户 [-p psswd]][-ns][-l][-s|-e][-x][-i
[会话]][-c [-f|-v]][-w 目录][-d][-][-an,n,...] cmd [参数]
     -a 应用程序可以在其上运行的独立处理器
                逗号，其中 1 是编号最小的 CPU。例如，
                要在 CPU 2 和 CPU 4 上运行应用程序，请输入：
                “-a 2,4”

```

例如：

```
psexec -a 2 cmd /c "echo.|DoStuff.exe"
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T02:33:20.217

*   [本页](http://www.ocforums.com/archive/index.php/t-453554.html)讨论了一个名为 XCPU 的免费工具，您可以使用它来启动和设置亲和力。但是里面的链接不起作用。也许有点谷歌搜索可以为您找到它。

*   [这里](http://www.activeplus.com/us/freeware/runfirst/)有一个类似的工具 ，叫做 runfirst。

# unity-container - 统一容器可以将自身的引用作为构造函数参数传递吗？

> ID：827756
> 
> 赞同：19
> 
> 时间：2009-05-06T02:22:41.367
> 
> 标签：unity-container

有没有办法让统一容器将自己传递给对象？

IE：

```
public class Something {

     public Something(IUnityContainer container) {
           ...
     }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-06T02:41:38.230

简短的回答是肯定的。

这应该在您使用`Resolve`方法时自动传递。

例如：

```
IUnityContainer container = new UnityContainer();
var something = container.Resolve<Something>(); 
```

此外，如果您想研究它，这与 Prism（在 CodePlex 上）使用的技术相同。

**更新添加测试：**

```
[TestClass]
public class Spike
{
    [TestMethod]
    public void unityTest()
    {
        var container = new UnityContainer();
        var something= container.Resolve<Something>();
        Assert.AreSame(container, something.Container);
        // This passes. Success.
    }
}

public class Something
{
    public Something(IUnityContainer container)
    {
        Container = container;
    }

    public IUnityContainer Container { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:12:06.623

第一个答案是我的想法。谢谢你。

在 Unity 之前，我们构建了自己的 IOC 容器，我们的语法类似于...

```
<constructor>
    <param name="factory" value="[{factory}]"/>
</constructor> 
```

[{factory}] 使其将自身作为参数传递。

至于将其设置为静态：我不喜欢使用这种方法，因为每个对象都依赖于单个属性（显然）。它的可重用性和可测试性较差，特别是如果静态是只读的（它应该是）。一旦设置了静态，您就不能（或不应该）弄乱它，这限制了您可以创建的测试场景。

如果不出意外，那么对象至少应该能够接受容器作为参数。如果它不存在，那么它可能会回到静态。

我们已经走上了使用单一实例的道路，并最终改变了它。在我看来，对象应该比这更灵活。如果对象的消费者希望拥有一个传递给其对象的实例，这取决于消费者。但是，对象本身不应该需要它。使用上面显示的语法，通过图表传递容器真的很容易。

谢谢（你的）信息。

周杰伦

抱歉……新人。我现在看到这应该是评论，而不是答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T04:11:33.663

正如本德威所说，你可以通过它，因为它是一个对象，就像任何其他对象一样，但是，为什么要通过它呢？

你只有一个，为什么不让它成为任何类都可以访问的静态属性呢？

# git - 如何知道何时将某些内容推送到 git 存储库中

> ID：827762
> 
> 赞同：1
> 
> 时间：2009-05-06T02:23:51.847
> 
> 标签：git

我想知道如何检查是否通过 git 将某些内容提交到存储库。这个想法是将提交的文件放入代码审查工具中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T02:30:38.773

您需要一个将新代码推送到代码审查工具的钩子：http: [//git-scm.com/docs/githooks](http://git-scm.com/docs/githooks)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T02:30:59.973

也许最简单的方法是运行 git-count-objects 并查看对象数量何时增加。每 5 分钟或您认为合适的时候轮询一次。

```
$ git count-objects -v
count: 13
size: 568
in-pack: 48
packs: 1
prune-packable: 0
garbage: 0 
```

"count" 被解包，"in-pack" 被打包，所以 "count"+"in-pack" 应该随着提交至少增加一。

或者使用钩子。

# history - Fortran dim(x,y)，到底是什么？

> ID：827769
> 
> 赞同：3
> 
> 时间：2009-05-06T02:27:34.973
> 
> 标签：history, fortran

在 Fortran 中，如果结果为正，则 dim(x,y) 返回差 xy；否则返回零。它的用途是什么？dim这个名字背后的含义是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T02:32:05.370

大概它来自维度，即某物的长度、宽度、高度。由于这些值都不能为负，因此将其计算为正差。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-19T00:31:05.090

因为它（在一些关于 Fortran 的旧文献中）被定义为 DIM(A,B):=A-MIN(A,B)，所以我想说这个名称只是“与最小值的差异”的缩写。

# visual-c++ - 重构大型 C++ 函数

> ID：827774
> 
> 赞同：4
> 
> 时间：2009-05-06T02:30:40.443
> 
> 标签：visual-c++, refactoring

在工作中，我们有一个用 Visual C++ 编写的遗留进程，它基本上由一个 5000 行函数组成。本质上，该程序只是一个大的案例语句，具有类似的剪切和粘贴代码处理相当数量的案例逻辑。显然，我们希望重构此代码以将这些情况提取到单独的函数（或对象）中，并消除任何剪切和粘贴的代码。

我的问题是 - 有什么建议可以进行这种规模的重构工作吗？是否有任何自动化工具可以简化流程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T02:38:05.323

我的第一步是采取一些较大的案例，并首先将它们推到单独的函数中。这将减少一开始的视觉混乱，并使您更容易进行下一阶段。

其次，确定不同案例的共性并创建通用函数来代替它们调用。在一定程度上。如果您走得太远，您将拥有一个与您当前的 switch 语句一样糟糕的通用函数:-)

我从来没有见过一种工具可以完成你头骨内海绵状东西的一半工作。我建议只使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T02:42:41.677

几个建议：

您可以使用[Duplo](http://duplo.giants.ch/)之类的工具找到复制粘贴的代码。脚本（使用您选择的脚本语言）或具有多行搜索和替换功能的编辑器可以帮助您用函数调用替换该代码。（这也可以手动完成，但使用脚本或搜索和替换有助于消除出错的可能性。）

重构工具可以自动执行操作，例如将函数的一部分提取到新函数中。 例如，[Eclipse CDT可以做到这一点，而且它是免费的，它可以编辑在其他 IDE 中维护的代码。](http://www.eclipse.org/cdt/)这并不总是有效，但当它确实有效时，看到 IDE 拆分数千行方法，只提取您想要的内容，并正确识别需要作为新参数传入的每个变量，这真是令人惊叹到您的新方法... 其他重构工具可用，例如[Refactor! Pro](http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/)（提供免费版本），但我没有使用它们。

更一般地说，Michael Feather 的《[*有效地使用遗留代码》*](https://rads.stackoverflow.com/amzn/click/com/0131177052)一书是做这类事情的标准工作。基本上，您需要设置表征测试 - 类似于单元测试，但目标是尽可能多地覆盖（表征）当前函数的行为，而不是测试尽可能小的单元的正确性 - 然后应用重构一个一次。（Feathers 包括一个重构目录和其他对遗留代码特别有用的技术。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T02:48:13.660

第一步是开发一个好的自动化回归测试，如果你还没有的话。然后，当您将每个案例拉到一个函数中时，您可以快速检查您是否没有破坏任何东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T03:11:55.053

在 www.wholetomato.com 上试用 Visual [AssistX](http://wholetomato.com/)。它直接与 VS6 及更高版本的任何版本的 Visual Studio 集成。它包括许多出色的开发功能，但您正在寻找的是重构功能。[您可以在此处](http://wholetomato.com/products/featureRefactoring.asp)查看该功能。它确实很贵，但我认为它是我使用 Visual Studio 开发时的“秘密武器”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T02:38:15.667

我知道[Eclipse](http://www.eclipse.org/)强调重构是一种特性。[IBM 网站](http://www.ibm.com/developerworks/library/os-ecref/)上列出了所有有用的功能，但特别是“选择中的新方法”工具似乎适用于您的情况。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T02:39:21.153

这是一个广泛的问题。有一些自动化工具，但现实情况是您只需要研究代码并做出一些决定。代码中是否存在冗余？如果是这样，请考虑将多余的东西放在它们自己的函数中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T03:07:52.973

1.  不要试图一次完成所有事情。
2.  确定一个可能的重构目标。尽可能窄。
3.  编写测试来验证那段代码的正确功能。
4.  一旦你所有的测试都通过了，或者因为原始函数实际上有那个错误而失败，重构那个位。
5.  确保您的所有测试仍然通过。
6.  转到 2。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-06T04:20:42.347

在进行单元测试之后，继续 Steve Fallows 所写的内容，以确保功能确实发生了变化，创建一个新函数，并进行与原始工作相同的单元测试。

目前他们都将失败。

然后，开始把每个case语句抽出来放到自己的函数中，从新的函数中调用，这样你就得到了一个只有一个switch的函数，每个case只调用一个函数。

移动所有功能后，您可以查看是否需要重构任何其他功能，但是，从单元测试开始以确保功能不会丢失。

顺便说一句，每个新功能也应该有自己的单元测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-05T07:53:03.850

我们的[CloneDR](http://www.semanticdesigns.com/Products/CloneDR)可能会精确识别克隆代码，并向您展示如何制作参数化代码来替换单个克隆。

您可以在链接中看到 C++ 的克隆报告，以及建议的参数化克隆块的外观。

# c# - 使用 LINQ 从与 FK 相关的表中访问信息

> ID：827777
> 
> 赞同：2
> 
> 时间：2009-05-06T02:31:29.723
> 
> 标签：c#, asp.net, linq, linq-to-sql, database-design

我正在开发一个员工调度系统。我认为我的数据库设置非常好，并且在为我的数据库提取数据并将其放到页面上时遇到了障碍。我正在使用 LINQ 让自己的事情变得轻松。

[这](https://imgur.com/HyBT.png)是对象关系图。

这是我的 Linq 选择语句：

```
protected void LinqSelecting(object sender, LinqDataSourceSelectEventArgs e) {
    MilhouseDataClassesDataContext mdb = new MilhouseDataClassesDataContext();
    e.Result = from x in mdb.MilhouseHours
               group x by x.HourString into hour
               select new {
                   hourStr=hour.Key,
                   uName=hour};
 } 
```

以下是我的 GridView 代码的相关部分：

```
 <asp:GridView ID="GridView1" runat="server" DataSourceID="LinqDataSource1" AutoGenerateColumns="false">
            <asp:TemplateField HeaderText="Sunday">
                <ItemTemplate>
                    <asp:CheckBoxList ID="shiftsSun" runat="server" DataSource='<%#Eval("uName")%>' DataValueField="UserId" />
                </ItemTemplate>
            </asp:TemplateField>
            ...
        </asp:Gridview> 
```

这将正确显示数据库中的 UserId，但我希望它显示 UserName。我得到这个显示工作的唯一方法是将我的组语句更改为：

```
group x.aspnet_User by x.HourString into hour 
```

我想我在这里遗漏了一个大概念。通过使用组，我应该可以通过匿名类的 uName 成员访问 aspnet_user 类成员......或者我想！

编辑：这是调试时捕获的变量的几个屏幕截图。

[e](https://imgur.com/I5J4.png) .结果| [aspnet_User](https://imgur.com/I5Hi.png)

我的最终目标是有一个网格视图，它将在每个单元格中显示 y 天 x 小时的工作班次列表。任何设计或代码帮助将不胜感激。我似乎无法理解这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T10:00:50.693

正在迭代包含 MilhouseHour 对象的集合：IGrouping。MilhouseHour 确实包含对 aspnet_User 的引用，但您要引用的名称（和 id）是 aspnet_User 的属性，而不是 MilhouseHour。理想情况下，您可以编写如下标记

```
 <asp:CheckBoxList ID="shiftsSun" runat="server" 
    DataSource='<%#Eval("hourUsers")%>' 
    DataTextField = "aspnet_User.UserName"
    DataValueField = "aspnet_User.UserId" /> 
```

但这给出了一个错误。ASP.Net 期望在 DataTextField 中将调用（可能通过反射）相关对象的属性名称，而不是要评估的表达式。有问题的对象是 MilhouseHour，它没有名为“aspnet_User.UserName”的属性。

你有很多选择。

1.  做你最初做的事情，并在你的 LINQ 表达式中对 x.aspnet_User 进行分组而不是 x 。然后 CheckBoxList 迭代的东西将是一个 IGrouping，它将具有可以工作的属性“UserName”和“UserId”。
2.  避免使用 CheckBoxList 并使用可以让您更明确地控制内部循环中的代码的东西，例如中继器：

    ```
    <asp:TemplateField HeaderText="Sunday">
    <ItemTemplate>
        <asp:Repeater ID="shiftsSun" runat="server" DataSource='<%#Eval("hourUsers")%>'>
            <ItemTemplate>
                <asp:CheckBox runat="server" 
                   Text='<%# Eval("aspnet_User.UserName")  %>' 
                   Value='<%# Eval("aspnet_User.UserId") %>' />
                <br />
            </ItemTemplate>
        </asp:Repeater>
    </ItemTemplate> 
    ```

可能还有更多选择，但这就是我现在想到的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T10:48:37.640

我认为您没有遗漏任何主要概念。组查询生成 IGrouping 的集合，其中无论是 MilhouseHours 集合中对象的类型。（我无法为您的对象模型获得更大的图景。）然后您将这些分组绑定到 CheckBoxList 的数据源。您缺少 DataTextField="NameField" 指令，但没有主要概念。这是一些有效的代码，如果不完全相同，至少与您的问题有关：

```
 <asp:GridView ID="myGrid" runat="server" AutoGenerateColumns="false">
        <Columns>
            <asp:TemplateField>
                <ItemTemplate>
                    <%# Eval("hourUsers.Key") %>
                </ItemTemplate>
            </asp:TemplateField>

            <asp:TemplateField HeaderText="Sunday">
                <ItemTemplate>
                    <asp:CheckBoxList ID="shiftsSun" runat="server" 
                        DataSource='<%#Eval("hourUsers")%>' 
                        DataTextField = "Name"
                        DataValueField = "Id" />
                </ItemTemplate>
            </asp:TemplateField>
        </Columns>
    </asp:GridView> 
```

在后面的页面中：

```
 class UserHour
    {
        public string Name {get;set;}
        public int Id { get; set; }
        public string Hour { get; set; }
    }

    protected void Page_Load(object sender, EventArgs e)
    {
        var users = new List<UserHour>
                        {
                                    new UserHour {Name = "Fred", Id = 1, Hour = "0800"},
                                    new UserHour {Name = "Fred", Id = 1, Hour = "0900"},
                                    new UserHour {Name = "Fred", Id = 1, Hour = "1000"},
                                    new UserHour {Name = "Bob", Id = 2, Hour = "0900"},
                                    new UserHour {Name = "Bob", Id = 2, Hour = "1000"},
                        };
        var result = from x in users
                     group x by x.Hour
                     into hour select new
                                          {
                                                      hourStr = hour.Key, hourUsers = hour
                                          };

        myGrid.DataSource = result;
        myGrid.DataBind();
    } 
```

# java - 为什么Java没有复制构造函数？

> ID：827785
> 
> 赞同：70
> 
> 时间：2009-05-06T02:34:00.043
> 
> 标签：java, copy-constructor

为什么 Java 不支持 C++ 中的复制构造函数？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-05-06T02:50:01.177

Java 可以。它们只是不像在 C++ 中那样被隐式调用，我怀疑这是你真正的问题。

首先，复制构造函数无非是：

```
public class Blah {
  private int foo;

  public Blah() { } // public no-args constructor
  public Blah(Blah b) { foo = b.foo; }  // copy constructor
} 
```

现在 C++ 将使用如下语句隐式调用复制构造函数：

```
Blah b2 = b1; 
```

在该实例中进行克隆/复制在 Java 中根本没有意义，因为所有 b1 和 b2 都是引用，而不是像在 C++ 中那样的值对象。在 C++ 中，该语句会复制对象的状态。在 Java 中，它只是复制**引用**。对象的状态不会被复制，因此隐式调用复制构造函数是没有意义的。

这就是它的全部。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-06T02:48:11.057

从[布鲁斯埃克尔](http://www.codeguru.com/java/tij/tij0128.shtml)：

> **为什么 [复制构造函数] 在 C++ 而不是 Java 中工作？**
> 
> 复制构造函数是 C++ 的基本部分，因为它会自动生成对象的本地副本。然而上面的例子证明它不适用于 Java。为什么？在 Java 中，我们操作的一切都是句柄，而在 C++ 中，您可以拥有类似句柄的实体，也可以直接传递对象。这就是 C++ 复制构造函数的用途：当您想要获取一个对象并按值传递它时，从而复制该对象。所以它在 C++ 中运行良好，但你应该记住，这个方案在 Java 中失败，所以不要使用它。

（我建议阅读整个页面——实际上，从[这里](http://www.codeguru.com/java/tij/tij0127.shtml)开始。）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-06T02:45:49.063

我认为这个问题的答案非常有趣。

一方面，我相信在 Java 中所有对象都在堆上，虽然你没有指针，但你确实有“引用”。引用具有复制语义，Java 在内部跟踪引用计数，以便其垃圾收集器知道可以安全地删除什么。

由于您仅通过可复制引用访问对象，因此需要复制对象的实际次数大大减少（例如，在 C++ 中，仅将对象传递给函数（按值）导致新对象被复制构造，在 Java 中仅传递对对象的引用）。设计者可能认为 clone() 足以满足其余用途。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T02:46:21.077

这只是我的意见（我相信有一个合理的答案）

当您按值发送或返回类的实例时，C++ 中的复制构造函数主要有用，因为此时复制构造函数被透明地激活。

由于在 Java 中所有内容都是通过引用返回的，并且 VM 面向动态分配，因此复制构造函数的复杂性确实没有理由。

此外，由于一切都是参考，开发人员通常必须提供他们自己的实现并决定如何克隆字段。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T02:39:00.873

猜猜他们认为你可以只创建一个 clone() 方法？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T02:46:32.463

确实如此。当浅拷贝没问题时，你有 [clone()]( [http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#clone())](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#clone()))并且当它们不是你必须像 C++ 一样实现深拷贝。

唯一的实质性区别是它是工厂方法而不是构造函数，但就灵活性和可测试性而言，这可能是一件好事。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T02:47:52.023

我不是一个 C++ 程序员，但我似乎确实记得关于“三个朋友”的规则——复制构造函数、赋值运算符和析构函数。如果你有一个，那么你可能需要所有三个。

所以也许语言中没有析构函数，他们不想包含复制构造函数？只是一个猜测。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-29T18:26:03.863

嗯，它可以。它只是不会被隐式创建。如果我不得不猜测，这可能与 Java 对象总是堆分配的事实有关。

在 C++ 中，默认的复制构造函数是按成员的浅拷贝。如果一个类拥有在堆上分配的内存（通过原始指针），这将导致副本与原始类共享内部，这不是您想要的。

想象一下Java有这种行为。任何具有对象字段的类（阅读：基本上所有对象）都会有错误的行为，您需要自己覆盖它。对于 99% 的情况，您没有为任何人省去任何麻烦。此外，您刚刚为自己创建了一个微妙的陷阱——假设您不小心忘记了覆盖默认的复制构造函数。如果它是默认生成的，并且您尝试使用它，编译器根本不会抱怨，但是您的程序会在运行时出现异常。

即使他们创建了一个执行深层复制的默认复制构造函数，我也不确定这是否特别有用。无论如何，您不仅倾向于在 Java 中执行比 C++ 更少的副本，而且您并不总是希望对字段进行深度复制。

您刚刚拥有的对象和您因为需要它们而持有引用但不负责的对象是相同的 - 只是字段。所有权和借款不是一流的概念。对于您拥有的对象，您需要深度复制它们（除非它们是不可变的，在这种情况下您不应该打扰），而对于您只持有引用的对象，您想要复制引用。

我会争辩说，只是盲目地深度复制所有内容的复制构造函数也不适合许多类。当然，默认情况下不仅仅是浅拷贝。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-07-07T22:31:33.703

Java**有**复制构造函数
注意：不是**demo d2=new demo(d1)**，你可以写**demo d2=d1**
主要区别 b/w 两个
**demo d2=new demo(d1)**表示创建新对象并分配内存 但是
**demo d2=d1** 意味着只创建引用变量，它使用对象**d1**的相同内存地址，因此**d2**没有分配单独的内存。

拷贝构造函数的语法：
见下**例第一个拷贝构造函数很简单:))**
classname(int datafield) //Simple Constructor
{
this.datafield=datafield;
}

**classname(classname object)
{
datafield=object.datafield;//见下例
}** 现在调用
**{**

类名 obj=新类名（）；

classname anotherObject=obj;//或类名 anotherObject=new classname(obj)

**}**

```
 课堂演示
{
    私有 int 长度；

    私有宽度；

    私有int半径；

    演示（int x，int y）

    {
        长度=x;
        宽度=y;
    }
    整数区域（）
    {
        返回长度*宽度；
    }

    //复制构造函数
    演示（演示对象）
    {
        长度=obj.长度；
        宽度=obj.宽度；
    }

    公共静态无效主（字符串参数 []）
    {
        演示 d1=新演示（5,6）；
        demo d2=new demo(d1);//调用复制结构
        System.out.println("d1 对象的区域="+d1.area());
        System.out.println("d2 对象的区域="+d2.area());

    }
}

```

# c# - 使用 System.net.mail 命名空间的任何类在发送之前标记电子邮件

> ID：827790
> 
> 赞同：1
> 
> 时间：2009-05-06T02:36:21.910
> 
> 标签：c#, .net

是否可以使用 .NET 中的 SMTPClient/MailMessage 类“标记电子邮件”以进行跟进？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T02:47:16.923

据我了解，该标志不是 POP/MIME/SMTP 规范的一部分，它只是许多应用程序提供的一种排序功能。您可以将重要性设置为高、正常和低。

```
MailMessage msg = new MailMessage
{
    Priority = MailPriority.High,
    Subject = "High priority message."
}; 
```

# parsing - 使用 BISON 等解析器生成器，同时仍能优雅地处理错误输入

> ID：827797
> 
> 赞同：3
> 
> 时间：2009-05-06T02:38:23.450
> 
> 标签：parsing, bison

我需要一个不那么复杂的语言的解析器。唯一的问题是，我从不希望解析器在收到格式错误的输入时引发错误。相反，我希望它继续，尽可能多地理解输入，类似于 Web 浏览器中的 HTML 解析器所做的。

我很自然地想使用解析器生成器，但我对它们没有太多经验，而且我看到的所有关于 Bison 和 Antlr 的示例都具有脆弱的解析器，一旦遇到语法错误就会放弃。这对他们可行吗，还是我应该考虑手动滚动它？考虑到语言，它可能（我认为）不会那么困难。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T04:04:01.450

您需要在设计语法时考虑到检查点。检查点是指 C 的分号、Python 的换行符或 COBOL 的句点（例如）。这个检查点是多少编译器恢复，以便他们可以报告的不仅仅是发现的第一个错误。

我没有使用 Bison，但 YACC 允许您覆盖错误处理，我希望等效的 GNU 工具*至少*与我们的旧 UNIX 旧工具一样强大。

我以前用配置文件 YACC 语法做过这个。假设您有以下正确形成的段：

```
item = "bread" {
    quantity = 7
    price = 1.50
    taxrate = 10
} 
```

由于某些奇怪的原因，用户拼错了“数量”，使其不正确。在您的回调中，您可以只引发一个错误标志，该标志将阻止进一步处理，直到到达检查点。您让解析器继续运行（捕获并忽略进一步的错误）并确保您的回调不做任何事情来响应损坏语法中的任何虚假成功。

这可以通过简单地忽略所有进一步的节直到右括号，或者甚至通过设置价格的默认值并且只忽略到换行符（这样你至少得到一个部分形成的对象）。

不管你怎么做，只要在你到达检查点时重置错误标志，你就可以继续处理。

我仍然会确保通知用户，有时认为继续使用客户不想要的数据是不好的形式:-)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T03:01:13.957

在一般情况下，我不确定您是否能够使用解析器生成器来做到这一点。至少，不是以完全自动的方式。考虑以下格式错误的表达式：

```
a - b + c ) * d 
```

解析器甚至应该对此做什么？当它遇到第一个非法令牌，即右括号时，它可能会以某种方式猜测用户打算在某处使用左括号，但在哪里？它可以放在任何地方都会导致不同的值。

相反，它可以假装之前发生的一切都没有发生过。然后它会结束

```
* d 
```

这仍然是畸形的。

# php - 在整个文件夹中查找尾随空格的正则表达式问题

> ID：827809
> 
> 赞同：0
> 
> 时间：2009-05-06T02:43:12.050
> 
> 标签：php, regex, directory

我有一个从 wordpress 安装中提取的文件夹，>1000 个文件。由于最后一行的尾随空格，一些 php 代码抛出错误（我清理了最后几行页面上的 iframe 注入，并确实找到/替换了一个空格，但不知道这会抛出所有我的代码）。

切割这些空间的最有效方法是什么？我以前从未运行过正则表达式，但知道这就是我会使用的。帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T03:09:32.097

就像是：

查找 -type f |xargs sed -i '$s/[[:space:]]+$//'

这应该删除 cwd 中任何文件的最后一行的尾随空格。第一个 $ 是“最后一行”的 sed 地址，第二个是行尾的正则表达式。

与往常一样，请务必先备份。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T03:08:43.750

如果您确定它是文件最后一行的尾随空格，那么您需要一个 bash 脚本（我假设您使用的是 Linux）来为每个文件（使用“find .”获取list)，tail -1 文件，然后用 grep 该行查找空格或制表符。

切线地，知道关闭 ?> 在 PHP 文件末尾是不必要的很有用，最好在此处省略它。我数不清有多少次我看到一个以“？>”结尾的 PHP 文件，人们疯狂地试图找到一个导致输出/标题问题的额外空间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T03:09:43.407

在这种情况下，我要做的是编写一个脚本或程序，当给定一个目录时，它会递归地查找以 .php 结尾的文件或其他任何内容，然后简单地编写一个函数，1）寻找最后一个字节并存储这个位置 2）如果这个字节是空格 回溯一个字节并再次检查 3）如果它不是空格返回偏移量

然后使用它，您可以将每个文件写为新副本或覆盖旧副本

PS上述解决方案之一也可以工作：P

# c# - C# 应用程序域私有 bin 路径更新

> ID：827825
> 
> 赞同：1
> 
> 时间：2009-05-06T02:49:51.863
> 
> 标签：c#, appdomain

有谁知道是否可以更改当前应用程序域的 AppDomain.CurrentDomain.SetupInformation.PrivateBinPath？还是这只影响未来的appdomain实例..

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:17:46.247

图书馆说

更改 AppDomainSetup 实例的属性不会影响任何现有的 AppDomain。当使用 AppDomainSetup 实例作为参数调用 CreateDomain 方法时，它只会影响新 AppDomain 的创建。

当我需要这个时，用一个空的 AppDomain 启动我的应用程序，为其他应用程序搭建舞台。你需要更多关于这方面的信息吗？

# bash - bash 脚本参数

> ID：827828
> 
> 赞同：14
> 
> 时间：2009-05-06T02:52:19.937
> 
> 标签：bash, scripting, parameters

我需要编写一个**bash 脚本**，并希望它解析格式的**无序参数**：

```
scriptname --param1 <string> --param2 <string> --param3 <date> 
```

有没有一种简单的方法可以做到这一点，还是我几乎坚持使用 1 美元、2 美元、3 美元？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T02:55:04.750

你想要[getopts](http://bash-hackers.org/wiki/doku.php/howto/getopts_tutorial)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-06T08:45:28.293

```
while [[ $1 = -* ]]; do
    arg=$1; shift           # shift the found arg away.

    case $arg in
        --foo)
            do_foo "$1"
            shift           # foo takes an arg, needs an extra shift
            ;;
        --bar)
            do_bar          # bar takes no arg, doesn't need an extra shift
            ;;
    esac
done 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T10:00:22.677

如何并排实现短和长开关的一个很好的例子是 mcurl：

[http://www.goforlinux.de/scripts/mcurl/](http://www.goforlinux.de/scripts/mcurl/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T03:05:32.807

如前所述，Bash 有一个 getops 函数，它可能会解决您的问题。

如果您需要更复杂的东西，bash 还支持位置参数（订购 $1 ... $9，然后 ${10} .... ${n}），您必须提出自己的逻辑来处理这个输入。一种简单的方法是在 for 循环中放置一个 switch/case，迭代参数。您可以使用处理输入的两个特殊 bash 变量之一：[$* 或 $@](http://tldp.org/LDP/abs/html/internalvariables.html#APPREF)。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-01-22T17:39:18.253

```
#!/bin/bash

# Parse the command-line arguments
while [ "$#" -gt "0" ]; do
  case "$1" in
    -p1|--param1)
      PARAM1="$2"
      shift 2
    ;;
    -p2|--param2)
      PARAM2="$2"
      shift 2
    ;;
    -p3|--param3)
      PARAM3="$2"
      shift 2
    ;;
    -*|--*)
      # Unknown option found
      echo "Unknown option $1."

      exit 1
    ;;  
    *)
      CMD="$1"
      break
    ;;
  esac
done 

echo "param1: $PARAM1, param2: $PARAM2, param3: $PARAM3, cmd: $CMD" 
```

当我执行这个：

```
./<my-script> --param2 my-param-2 --param1 myparam1 --param3 param-3 my-command 
```

它输出你所期望的：

```
param1: myparam1, param2: my-param-2, param3: param-3, cmd: my-command 
```

# java - Java中阻塞队列的优点是什么？

> ID：827831
> 
> 赞同：18
> 
> 时间：2009-05-06T02:54:12.460
> 
> 标签：java, performance, data-structures, queue

我正在开发一个使用队列的项目，该队列保留有关需要发送到远程主机的消息的信息。在这种情况下，一个线程负责将信息放入队列，另一个线程负责从队列中获取信息并将其发送。第二个线程需要定期检查队列中的信息。

但后来我发现这是对轮子的重新发明 :) 我可以为此目的使用阻塞队列。

对上述应用程序使用阻塞队列的其他优点是什么？（例如：性能、代码的可修改性、任何特殊技巧等）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-06T03:04:18.007

主要优点是 a`BlockingQueue`提供了正确的、线程安全的实现。多年来，开发人员自己实现了此功能，但要做到正确却很棘手。现在，运行时有一个由并发专家开发、审查和维护的实现。

队列的“阻塞”特性有几个优点。首先，在添加元素时，如果队列容量有限，那么内存消耗也会受到限制。此外，如果队列消费者远远落后于生产者，生产者自然会受到限制，因为他们必须等待添加元素。从队列中取出元素时，主要优点是简单；永远等待是微不足道的，正确等待指定的超时只是稍微复杂一点。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T03:00:10.013

他们用阻塞队列消除的关键是“轮询”。这是你说的

> 在这种情况下，第二个线程需要定期检查队列中的信息。

这可能非常低效 - 使用大量不必要的 CPU 时间。它还可能引入不必要的延迟。

# c# - 尝试使用 .net FtpWebRequest 类下载文件时出错

> ID：827834
> 
> 赞同：0
> 
> 时间：2009-05-06T02:55:20.367
> 
> 标签：c#, ftp

错误信息是：

服务器响应 PASV 命令返回的地址与建立 FTP 连接的地址不同。

当我尝试在下面调用 GetResponse() 方法时收到此消息...请帮助。

这是我的 C# 代码：

FileStream outputStream = new FileStream(feedXmlPath + "\" + "testXml", FileMode.Create);

```
 FtpWebRequest request = (FtpWebRequest)WebRequest.Create(ftpURL + "/" + zipFileName);

        request.UseBinary = true;

        request.Credentials = new NetworkCredential(userName, password);

        request.KeepAlive = false;

        request.Method = WebRequestMethods.Ftp.DownloadFile;

      FtpWebResponse response = (FtpWebResponse)request.GetResponse();
      Stream ftpStream = response.GetResponseStream();

      long cl = response.ContentLength;
      int bufferSize = 2048;
      int readCount;
      byte[] buffer = new byte[bufferSize];

      readCount = ftpStream.Read(buffer, 0, bufferSize);

        while (readCount > 0)
      {
          outputStream.Write(buffer, 0, readCount);
          readCount = ftpStream.Read(buffer, 0, bufferSize);
      }

      ftpStream.Close();
      outputStream.Close();
      response.Close(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T10:49:19.760

如果您使用 NAT，则出于安全原因不允许使用 FTPWebRequest。[在Connect](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=97409&wa=wsignin1.0)上查看这篇文章。

[MSDN](http://social.msdn.microsoft.com/Forums/en-US/netfxnetcom/thread/661a537b-813f-465c-bdd3-e1df975b7e3c)上的这篇文章也可能有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-11T22:51:25.063

尝试切换 Passive 值以查看哪个有效：

```
 request.UsePassive = false; 
```

这可能取决于机器（客户端和服务器）之间的防火墙。

我注意到如果我通过我们的防火墙，我需要将其保留为 True，否则它将返回异常：

> 远程服务器返回错误：(500) 语法错误，命令无法识别。

但是，如果我在防火墙后面（比如在数据中心内直接相互连接的两台机器），那么我需要将其设置为 False，否则它将返回异常：

> 服务器响应 PASV 命令返回的地址与建立 FTP 连接的地址不同。

# asp.net - 格式化国际货币

> ID：827835
> 
> 赞同：3
> 
> 时间：2009-05-06T02:56:57.243
> 
> 标签：asp.net, vb.net

我有一个我们正在“全球化”的asp.net应用程序，我将currentculture和currentUICultre设置为适当的值，并且使用货币格式如预期的那样显示货币。

```
FormatCurrency(_nPrice) 
```

生产

$xxx.xx 用于 en-AU 和 £xxx.xx 用于 en-GB，但是我们需要区分显示值的货币，而不是符号，因为很多货币都使用美元符号。

例如，我们需要为美国显示 US$123.12 或为澳大利亚显示 A$123.12。有没有像符号一样自动执行此操作的方法。

任何建议，将不胜感激。谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T13:04:07.987

**[RegionInfo](http://www1.cs.columbia.edu/~lok/csharp/refdocs/System.Globalization/types/RegionInfo.html)**包含**[ISOCurrencySymbol](http://www1.cs.columbia.edu/~lok/csharp/refdocs/System.Globalization/types/RegionInfo.html#ISOCurrencySymbol)**。_ 由于您已经拥有 CurrentCulture，您可以执行以下操作：

```
string currencySymbol = RegionInfo.CurrentRegion.ISOCurrencySymbol;

// currencySymbol equals EUR for France(fr-FR) or any EU country
// returns AUD for en-AU, US for en-US, etc. 
```

# javascript - jQuery：有没有办法让它更短更优雅？

> ID：827836
> 
> 赞同：2
> 
> 时间：2009-05-06T02:57:26.510
> 
> 标签：javascript, jquery

我有一个看起来像这样的代码：

```
<div id="wrapper">
        <img id="first"  class="images" src="img/nike.jpg" />
        <img  id ="second" class = "images" src="img/golden.jpg" />
        <img id = "third" class ="images" src ="img/a.jpg" />
        <img id = "fourth" class="images" src="img/God__s_Canvas_by_Delacorr.jpg" />
    </div> 
```

我想用`<a name = n>`动态包装每个 img。所以我的解决方案是这样做：

```
$(".images").wrap('<a></a>')
$("#wrapper a").each(function(n) {
            $(this).attr('name', n);
        }) 
```

是否可以将 2 个语句链接到 1 个语句中？我知道 jQuery 特别擅长优雅的链接，所以我认为这绝对是可能的。我只是还不知道怎么做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T03:05:02.373

这并不完全相同，因为它不会在#wrapper 之外包装 .images，但它很接近。它在循环中创建并立即应用该属性。

```
$('#wrapper img').each(function(n) { 
    $(this).wrap($('<a></a>').attr('name', n));
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T03:05:17.503

这可能有效...

```
$(".images").wrap('<a></a>').parent().each(function(n) {$(this).attr('name', n);}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T03:10:53.247

我认为你不能，因为你引用了两个单独的对象集合。$() 将返回一个匹配项的数组。在您的第一个实现的情况下，您将使用“图像”类拉出每个图像并用锚标签包装它们。在您的第二个实现中，您将在“包装器”div 中提取所有锚标记元素，并应用 name 属性。这是两个截然不同的集合，在您完成第一个语句之前，第二个甚至不可用。

现在，Dan 的上述实现可能会奏效。不是您正在寻找的链接，但似乎在金钱上。

# linux - 在 linux 中安装 flash 9 调试器

> ID：827843
> 
> 赞同：2
> 
> 时间：2009-05-06T03:00:22.337
> 
> 标签：linux, flash, debugging

我一直在尝试在 Flash 中使用 ExternalInterface.call 方法，但无济于事（请参见此处：[actionscript + javascript](https://stackoverflow.com/questions/757390/actionscript-javascript)：[在 Flash 中使用 ExternalInterface](https://stackoverflow.com/questions/818089/using-externalinterface-in-flash)和此处：[Firefox、linux 中的 Flash 跟踪输出](https://stackoverflow.com/questions/825316/flash-trace-output-in-firefox-linux)），现在我试图追踪 ExternalInterface.available。到目前为止，我最好的选择似乎是 firefox 的 FlashTracer，除了我必须安装 flash player 9。我删除了旧的 Flash 播放器并下载了相应的文件（[http://download.macromedia.com/pub/flashplayer/updaters/9/flash_player_9_linux_dev.tar.gz](http://download.macromedia.com/pub/flashplayer/updaters/9/flash_player_9_linux_dev.tar.gz)）。根据包含的自述文件，这些是安装步骤：

> 使用安装脚本安装调试器插件 tar.gz：
> o 调试器插件位于：
> ./ plugin/debugger/install_flash_player_9_linux.tar.gz
> o 解压 tar.gz 文件
> o 在终端中，导航到解压目录并输入：
> + $ ./flashplayer-installer
> + 点击 Enter 键并按照提示 操作

除了调试器目录中没有名为 flashplayer 的文件。还有其他人遇到过这个吗？如何在我的 Ubuntu 系统上安装 flash player 9 调试器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-15T05:08:55.437

如果您使用的是 Ubuntu 之类的东西，那么 Flash 插件可能是系统范围内的东西。例如，在 Ubuntu 8.10 下，我有它：

```
/usr/lib/flashplugin-installer 
```

此外，您还可以在以下位置找到：

```
/etc/alternatives/ 
```

链接到它，因此您可以根据用户更改使用哪个 .so。

`./flashplayer-installer`如果文件不存在（尽管在我的文件中存在），您可能会做的最简单的事情是将调试 flashplayer 库复制到此目录。例如：

```
root@me:/usr/lib/flashplugin-installer# mv libflashplayer.so  libflashplayer.non-debug.so
root@me:/usr/lib/flashplugin-installer# cp ~jamie/Adobe_Flex_Builder_Linux/Player/linux/install_flash_player_9_linux/libflashplayer.so libflashplayer.debug.so 
root@me:/usr/lib/flashplugin-installer# ln -s libflashplayer.debug.so libflashplayer.so 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T03:18:15.257

我没有看到您遇到的问题，也许您的要求限制您使用旧版本，但我在[flashplayer 10 的 debugger](http://www.adobe.com/support/flashplayer/downloads.html)方面取得了巨大成功。你可以试试这个，看看它是否有效。

编辑：啊，我刚刚注意到你做了一个非常中肯的声明：你需要 flashplayer 9。抱歉 =(

编辑2：我在Linux上也发生了同样的事情。当我从 Adob​​e 提取 tar.gz 时，安装脚本不存在。这就是说，无论如何我*都能*安装 9 的调试器版本。

提取时，您看到`libflashplayer.so`文件了吗？我没有安装脚本，但我*确实*得到了这个文件。如果是这样，您需要做的就是：

1.  关闭*所有*Firefox 实例
2.  备份您当前的`libflashplayer.so`模块：（`~/.mozilla/plugins/libflashplayer.so.org`这样，如果出现问题，您可以随时将其放回去）
3.  将您从 Flash 播放器下载中提取的版本复制到相同的插件目录：`cp /path/to/vers/9/libflashplayer.so ~/.mozilla/plugins/`
4.  重启火狐，打开Flash应用，右键查看版本

这些步骤对我来说非常有效，我能够在 Linux 中运行 Flex Builder 的调试器。希望这对你有用！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-05T07:37:53.757

我对 Flash Player 调试器也有同样的问题。我遵循了bedwyr给出的指示。它对我有用。为了让它工作，如果没有找到插件目录，你在 ~/.mozilla 中创建一个名为 'plugins' 的目录。

```
mkdir ~/.mozilla/plugins 
```

然后我复制`libflashplayer.so`到插件目录。现在，flash player 调试器适用于我的 Flex Builder 应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-22T15:12:17.270

一种方法是下载 flex 3 SDK for linux。当你下载它时，你会得到几个焦油。如果你想安装 flashplayer 10，你可以在 ~/flex_sdk_3/runtimes/10 中找到它；如果你想要 flashplayer 9，你可以在 ~/flex_sdk_3/runtimes/lnx/ 中找到它。解压缩这些文件（flashplayer.tar.gz 和 libflashplayer.so。 tar.gz 与 tar -xvf)。现在 cp libflashplayer.so 文件到 /usr/lib/mozilla/plugins/ 如果你想创建符号链接（ln -s flashplayer /usr/local/bin 让播放器在你的路径上

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-26T04:20:31.747

对于像我一样搜索此内容的任何人的提示...找出 libflashplayer.so 当前在您的系统上的位置：

```
sudo locate libflashplayer.so 
```

我的在 /usr/lib/flashplugin-installer/

一旦我用该文件的调试版本替换该文件，Firefox 报告我有播放器的调试版本。

# java - 关闭模态 JInternalFrame

> ID：827847
> 
> 赞同：3
> 
> 时间：2009-05-06T03:01:04.300
> 
> 标签：java, swing

我遵循了[本指南](http://java.sun.com/developer/JDCTechTips/2001/tt1220.html)的方法 2 ，所以现在我有一个 ModalInternalFrame 可以阻止所有其他帧的输入，就像我想要的那样。但是，我对示例进行了一项更改，现在我遇到了两个问题。

**改变**

我删除了 JOptionPane，因为重点是显示我自己的窗格。为了使它关闭，我设置`closeable`为`true`，并添加了一个 InternalFrameListener ，其代码与示例的 JOptionPane 侦听器相同。这不起作用，所以我还在 doDefaultCloseAction 的末尾添加了代码。

**问题**

1.  ModalInternal 框架永远不会消失。我认为正在引发一些异常，但是...
2.  我看不到任何抛出的异常，也不知道它们要去哪里。通常在调试模式下，Eclipse 会在异常被提供给 UncaughtExceptionHandler 之前停止，但在这种情况下不会发生这种情况。

**编码**

如果我对问题的描述没有帮助，这是我的 ModalInternalFrame 版本。如果您想要更多代码，我也可以发布。对不起，它太长了，但我尽量让它简洁。

```
public class ModalInternalFrame extends JInternalFrame {
    public ModalInternalFrame(String title, JRootPane rootPane,
            Component desktop) {
        super(title, false, true, false, false);

        // create opaque glass pane
        final JPanel glass = new JPanel();
        glass.setOpaque(false);

        // Attach mouse listeners
        MouseInputAdapter adapter = new MouseInputAdapter() { };
        glass.addMouseListener(adapter);
        glass.addMouseMotionListener(adapter);

        this.addInternalFrameListener(new InternalFrameListenerAdapter() {
            public void internalFrameClosed(InternalFrameEvent e) { close(); }
            public void internalFrameClosing(InternalFrameEvent e){ close(); }
        });

        // Change frame border
        putClientProperty("JInternalFrame.frameType", "optionDialog");

        // Size frame
        Dimension size = getPreferredSize();
        Dimension rootSize = desktop.getSize();

        setBounds((rootSize.width - size.width) / 2,
                (rootSize.height - size.height) / 2, size.width, size.height);
        desktop.validate();
        try { setSelected(true); } 
        catch (PropertyVetoException ignored) { }

        glass.add(this);              // Add modal internal frame to glass pane
        rootPane.setGlassPane(glass); // Change glass pane to our panel
        glass.setVisible(true);       // Show glass pane, then modal dialog
    }

    private void close(){
        if (isVisible()) {
            try { setClosed(true); } 
            catch (PropertyVetoException ignored) { }
            setVisible(false);
            rootPane.getGlassPane().setVisible(false);
        }
    }

    @Override public void doDefaultCloseAction() {
        super.doDefaultCloseAction();
        close();
    }

    @Override public void setVisible(boolean flag) {
        super.setVisible(flag);
        if (flag) startModal();
        else stopModal();
    }

    private synchronized void startModal() {
        try {
            if (SwingUtilities.isEventDispatchThread()) {
                EventQueue theQueue = getToolkit().getSystemEventQueue();
                while (isVisible()) {
                    AWTEvent event = theQueue.getNextEvent();
                    Object source = event.getSource();
                    if (event instanceof ActiveEvent) {
                        ((ActiveEvent) event).dispatch();
                    } else if (source instanceof Component) {
                        ((Component) source).dispatchEvent(event);
                    } else if (source instanceof MenuComponent) {
                        ((MenuComponent) source).dispatchEvent(event);
                    } else {
                        System.err.println("Unable to dispatch: " + event);
                    }
                }
            } else { while (isVisible()) { wait(); } }
        } catch (InterruptedException ignored) {
        }

    }

    private synchronized void stopModal() { notifyAll(); }

} 
```

**更新：**我发现模态对话框很适合我的需求，但如果有人有想法，我会很高兴听到。我没有尝试过的一件事是将每个方法包装在 try {} catch (Exception e){} 中，这可能会有很大帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-03T09:05:26.497

我不能让你的代码运行，但这里有一个更简单的版本，基于 Sun 的例子，它确实有效——主框架中有一个按钮（占用所有可用空间），但点击按钮是直到内部框架关闭为止。

你可以看到，我所做的几乎就是`new JOptionPane().createInternalFrame()`用我自己的框架替换业务。我的猜测是，当您尝试进行自己的事件分派时，事情过于复杂了。

还是我错过了什么？

```
public class Foo {

  public static void main(String[] args) {
    JFrame frame = new JFrame();
    frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
    frame.setSize(600, 400);
    frame.setLocationByPlatform(true);

    JButton desktop = new JButton(new AbstractAction("Click me if you can") {
      @Override
      public void actionPerformed(ActionEvent e) {
        System.out.println("I have been clicked");
      }
    });
    frame.getContentPane().add(desktop);

    frame.setVisible(true);

    JInternalFrame modal = 
      new JInternalFrame("Modal Popup", false, true, false, false);
    JLabel popupContent = new JLabel("I am the popup");
    popupContent.setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));
    modal.add(popupContent);
    modal.pack();

    JPanel glass = new JPanel();
    glass.setOpaque(false);
    glass.add(modal);
    frame.setGlassPane(glass);
    glass.setVisible(true);
    modal.setVisible(true);

    modal.addInternalFrameListener(new ModalAdapter(glass));
  }
}

class ModalAdapter extends InternalFrameAdapter {
  Component glass;

  public ModalAdapter(Component glass) {
    this.glass = glass;

    // Associate dummy mouse listeners
    // Otherwise mouse events pass through
    MouseInputAdapter adapter = new MouseInputAdapter() {
    };
    glass.addMouseListener(adapter);
    glass.addMouseMotionListener(adapter);
  }

  public void internalFrameClosed(InternalFrameEvent e) {
    glass.setVisible(false);
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-11T01:44:56.303

尝试这个。我从关于 JInternal Frames 的 Webby IT 博客文章中得到它：[http ://webbyit.blogspot.com/2011/03/managing-jinternalframes-within.html](http://webbyit.blogspot.com/2011/03/managing-jinternalframes-within.html)

```
import java.awt.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyVetoException;
import java.beans.VetoableChangeListener;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.*;
import javax.swing.event.InternalFrameAdapter;
import javax.swing.event.InternalFrameEvent;

/**
 * An extended <code>JInternalFrame</code> that provides modality in a child/parent hierarchy.
 * <a href="From http://webbyit.blogspot.com/2011/03/managing-jinternalframes-within.html">source: webby it internal frames blog post</a>
 *
 * @author webbyit
 */
public class ModalityInternalFrame extends JInternalFrame {

    protected JDesktopPane desktopPane;
    protected JComponent parent;
    protected ModalityInternalFrame childFrame;
    protected JComponent focusOwner;
    private boolean wasCloseable;

    public ModalityInternalFrame() {
        init(); // here to allow netbeans to use class in gui builder
    }

    public ModalityInternalFrame(JComponent parent) {
        this(parent, null);
    }

    public ModalityInternalFrame(JComponent parent, String title) {
        this(parent, title, false);
    }

    public ModalityInternalFrame(JComponent parent, String title, boolean resizable) {
        this(parent, title, resizable, false);
    }

    public ModalityInternalFrame(JComponent parent, String title, boolean resizable, boolean closeable) {
        this(parent, title, resizable, closeable, false);
    }

    public ModalityInternalFrame(JComponent parent, String title, boolean resizable, boolean closeable,
            boolean maximizable) {
        this(parent, title, resizable, closeable, maximizable, false);
    }

    public ModalityInternalFrame(JComponent parent, String title, boolean resizable, boolean closeable,
            boolean maximizable,
            boolean iconifiable) {
        super(title, resizable, closeable, maximizable, iconifiable);
        setParentFrame(parent);
        //setFocusTraversalKeysEnabled(false);
        if (parent != null && parent instanceof ModalityInternalFrame) {
            ((ModalityInternalFrame) parent).setChildFrame(ModalityInternalFrame.this);

            /*
             * set focus to the new frame and show the frame Code added by Jasir
             */
            try {
                ((ModalityInternalFrame) parent).setSelected(false);
                setSelected(true);
                setVisible(true);
            } catch (PropertyVetoException ex) {
                Logger.getLogger(ModalityInternalFrame.class.getName()).log(Level.SEVERE, null, ex);
            }
        }

        // Add glass pane
        ModalityInternalGlassPane glassPane = new ModalityInternalGlassPane(this);
        setGlassPane(glassPane);

        // Add frame listeners
        addFrameListener();

        // Add frame veto listenr
        addFrameVetoListener();

        init();

        // calculate size and position

    }

    private void setParentFrame(JComponent parent) {
        desktopPane = JOptionPane.getDesktopPaneForComponent(parent);
        this.parent = parent == null ? JOptionPane.getDesktopPaneForComponent(parent) : parent; // default to desktop if no parent given
    }

    public JComponent getParentFrame() {
        return parent;
    }

    public void setChildFrame(ModalityInternalFrame childFrame) {
        this.childFrame = childFrame;
    }

    public ModalityInternalFrame getChildFrame() {
        return childFrame;
    }

    public boolean hasChildFrame() {
        return (childFrame != null);
    }

    protected void addFrameVetoListener() {
        addVetoableChangeListener(new VetoableChangeListener() {

            public void vetoableChange(PropertyChangeEvent evt) throws PropertyVetoException {
                if (evt.getPropertyName().equals(JInternalFrame.IS_SELECTED_PROPERTY)
                        && evt.getNewValue().equals(Boolean.TRUE)) {
                    if (hasChildFrame()) {
                        //childFrame.setSelected(true);
                        if (childFrame.isIcon()) {
                            childFrame.setIcon(false);
                        }
                        throw new PropertyVetoException("no!", evt);
                    }
                }
            }
        });
    }

    /**
     * Method to control the display of the glass pane, dependant on the frame
     * being active or not
     */
    protected synchronized void addFrameListener() {
        addInternalFrameListener(new InternalFrameAdapter() {

            @Override
            public void internalFrameActivated(InternalFrameEvent e) {
                if (hasChildFrame() == true) {
                    getGlassPane().setVisible(true);
                    grabFocus();
                } else {
                    getGlassPane().setVisible(false);
                }
            }

            @Override
            public void internalFrameOpened(InternalFrameEvent e) {
                getGlassPane().setVisible(false);
                try {
                    setSelected(true);
                } catch (PropertyVetoException ex) {
                    Logger.getLogger(ModalityInternalFrame.class.getName()).log(Level.SEVERE, null, ex);
                }
            }

            @Override
            public void internalFrameClosing(InternalFrameEvent e) {
                if (parent != null && parent instanceof ModalityInternalFrame) {
                    ((ModalityInternalFrame) parent).childClosing();
                }
            }
        });
    }

    /**
     * Method to handle child frame closing and make this frame available for
     * user input again with no glass pane visible
     */
    protected void childClosing() {
        setClosable(wasCloseable);
        getGlassPane().setVisible(false);
        if (focusOwner != null) {
            java.awt.EventQueue.invokeLater(new Runnable() {

                @Override
                public void run() {
                    try {
                        moveToFront();
                        setSelected(true);
                        focusOwner.grabFocus();
                    } catch (PropertyVetoException ex) {
                    }
                }
            });
            focusOwner.grabFocus();
        }
        getGlassPane().setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));
        setChildFrame(null);
        getDesktopPane().setSelectedFrame(this);
        System.out.println(getDesktopPane().getSelectedFrame());
    }

    /*
     * Method to handle child opening and becoming visible.
     */
    protected void childOpening() {
        // record the present focused component
        wasCloseable = isClosable();
        setClosable(false);
        focusOwner = (JComponent) getMostRecentFocusOwner();
        grabFocus();
        getGlassPane().setVisible(true);
        getGlassPane().setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));
    }

    @Override
    public void show() {
        if (parent != null && parent instanceof ModalityInternalFrame) {
            // Need to inform parent its about to lose its focus due
            // to child opening
            ((ModalityInternalFrame) parent).childOpening();
        }
        calculateBounds();
        super.show();
    }

    protected void init() {
        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 394, Short.MAX_VALUE));
        layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING).addGap(0, 274, Short.MAX_VALUE));

        pack();
    }

    public void calculateBounds() {
        Dimension frameSize = getPreferredSize();
        Dimension parentSize = new Dimension();
        Dimension rootSize = new Dimension(); // size of desktop
        Point frameCoord = new Point();

        if (desktopPane != null) {
            rootSize = desktopPane.getSize(); // size of desktop
            frameCoord = SwingUtilities.convertPoint(parent, 0, 0, desktopPane);
            parentSize = parent.getSize();
        }

        //setBounds((rootSize.width - frameSize.width) / 2, (rootSize.height - frameSize.height) / 2, frameSize.width, frameSize.height);

        // We want dialog centered relative to its parent component
        int x = (parentSize.width - frameSize.width) / 2 + frameCoord.x;
        int y = (parentSize.height - frameSize.height) / 2 + frameCoord.y;

        // If possible, dialog should be fully visible
        int ovrx = x + frameSize.width - rootSize.width;
        int ovry = y + frameSize.height - rootSize.height;
        x = Math.max((ovrx > 0 ? x - ovrx : x), 0);
        y = Math.max((ovry > 0 ? y - ovry : y), 0);
        setBounds(x, y, frameSize.width, frameSize.height);
    }

    /**
     * Glass pane to overlay. Listens for mouse clicks and sets selected on
     * associated modal frame. Also if modal frame has no children make class
     * pane invisible
     */
    class ModalityInternalGlassPane extends JComponent {

        private ModalityInternalFrame modalFrame;

        public ModalityInternalGlassPane(ModalityInternalFrame frame) {
            modalFrame = frame;
            addMouseListener(new MouseAdapter() {

                @Override
                public void mouseClicked(MouseEvent e) {
                    if (modalFrame.isSelected() == false) {
                        try {
                            modalFrame.setSelected(true);
                            if (modalFrame.hasChildFrame() == false) {
                                setVisible(false);
                            }
                        } catch (PropertyVetoException e1) {
                            //e1.printStackTrace();
                        }
                    }
                }
            });
        }

        @Override
        public void paint(Graphics g) {
            super.paint(g);
            g.setColor(new Color(255, 255, 255, 100));
            g.fillRect(0, 0, getWidth(), getHeight());
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-28T03:28:13.563

我只需要为一个项目做这件事。我所做的只是将主窗口对象传递给 Jinternalframe。主要对象有一个信号量，用于跟踪模态是否被锁定。在关闭 Jinternalframe（扩展）时调用主对象的信号量。很简单。这不是主要代码，但你明白了：

```
//called frame
public CallingFrame parent;
public void setParent(CallingFrame parent_){
    this.parent=parent_;
}
private void frameClosed(javax.swing.event.InternalFrameEvent evt) {
     parent.modalLocked=false; 
} 
```

在我的情况下，应用程序使用带有图像部分的标签来调用内部框架，因此代码以

```
 //calling frame     
 CalledFrame cf=new CalledFrame();
 cf.setParent(this); 
 cf.setVisible(true);  
 modalLoacked=true;
 private void jLabel1MouseReleased(java.awt.event.MouseEvent evt) {
    if (modalLocked)
    return;
    else// (do your things)
  } 
```

我按照教程进行操作，但是当单个信号量可以使您在未关闭一个被调用框架时不让您单击任何区域时，它们中的大多数都使事情变得过于复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-08T00:29:10.727

```
 public void internalFrameClosing(InternalFrameEvent e){ close(); } 
```

调用 close() 将导致再次调用 internalFrameClosing() ，直到堆栈溢出。

尝试完全删除该侦听器。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2015-06-08T23:01:47.293

您可以`setClosable(true);`在构造函数中添加

# linux - 为什么我需要在 linux 内核升级后重新编译 vmware 内核模块？

> ID：827862
> 
> 赞同：5
> 
> 时间：2009-05-06T03:07:47.420
> 
> 标签：linux, module, vmware, kernel, abi

linux 内核升级后，我的 VMWare 服务器无法启动，直到使用 vmware-config.pl 进行一些重新配置工作（包括构建一些内核模块）。

如果我用最新的 Windows Service Pack 更新我的 Windows VMWare 主机，我通常不需要做任何事情来运行 VMWare。

为什么 VMWare 在 Linux 和 Windows 之间的工作方式不同？此重新编译操作是否在 Linux 平台上比 Windows 带来任何好处？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T03:38:04.587

去阅读[Linux 内核驱动程序接口](http://www.kroah.com/log/linux/stable_api_nonsense.html)。

> 写这篇文章是为了解释为什么 Linux 没有二进制内核接口，也没有稳定的内核接口。请注意，本文描述的是_in kernel_接口，而不是内核到用户空间的接口。内核到用户空间接口是应用程序使用的接口，即系统调用接口。该接口随着时间的推移_非常_稳定，并且不会损坏。我有一些旧程序是在 0.9 之前的内核上构建的，在最新的 2.6 内核版本上仍然可以正常工作。该接口是用户和应用程序程序员可以信赖的稳定接口。

它反映了大部分 Linux 内核开发人员的观点：随时更改内核实现细节和 API 的自由使他们能够更快更好地开发。

如果没有保证内核接口在不同版本之间保持一致的承诺，像 VMWare 这样的二进制内核模块就无法在多个内核上可靠地工作。

例如，如果某些结构在新内核版本上发生更改（为了更好的性能或更多功能或任何其他原因），二进制 VMWare 模块可能会使用旧结构布局造成灾难性损坏。从源代码再次编译模块将捕获新的结构布局，因此有更好的工作机会——尽管仍然不是 100%，以防字段已被删除或重命名或赋予不同的目的。

如果一个函数更改了它的参数列表，或者被重命名或以其他方式不再可用，那么即使从相同的源代码重新编译也不会起作用。该模块必须适应新的内核。因为每个人（应该）都有来源并且（可以找到能够修改它以适应的人）。“将工作推到终端节点”在网络和自由软件中都是一个普遍的想法：因为[边缘]/[Linux内核之外的开发人员]的资源大于[主干]的有限资源/ [Linux 开发人员]，让前者做更多工作的权衡是可以接受的。

On the other hand, Microsoft has made the decision that they must preserve binary driver compatibility as much as possible -- they have no choice, as they are playing in a proprietary world. In a way, this makes it much easier for outside developers who no longer face a moving target, and for end-users who never have to change anything. On the downside, this forces Microsoft to maintain backwards-compatibility, which is (at best) time-consuming for Microsoft's developers and (at worst) is inefficient, causes bugs, and prevents forward progress.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T03:09:36.010

Linux 没有稳定的内核 ABI - 诸如数据结构的内部布局之类的东西会随着版本的变化而变化。需要重建 VMWare 才能在新内核中使用 ABI。

另一方面，Windows 有一个非常稳定的内核 ABI，不会因服务包而改变。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T03:23:48.647

为了增加 bdonlan 的答案，ABI 兼容性好坏参半。一方面，它允许您分发适用于较新版本内核的二进制模块和驱动程序。另一方面，它迫使内核程序员添加大量胶水代码以保持向后兼容性。因为 Linux 是开源的，而且因为[内核开发人员即使他们被允许](http://www.linuxtoday.com/developer/2006121402026NWKNDV)，分发二进制模块的能力也被认为不那么重要。从好的方面来说，Linux 内核开发人员在更改数据结构以改进内核时不必担心 ABI 兼容性。从长远来看，这会导致更干净的内核代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-30T14:43:40.607

这是 Linux 和 Windows 在不同的文化环境和期望中开发的结果：http: [//www.joelonsoftware.com/articles/Bicultureism.html](http://www.joelonsoftware.com/articles/Biculturalism.html)。简而言之：Windows 被设计为适合用户，而 Linux 演变为适合开源开发人员。

# flash - 擦除精灵图形？

> ID：827873
> 
> 赞同：4
> 
> 时间：2009-05-06T03:10:29.317
> 
> 标签：flash, actionscript-3, actionscript

如果我有一个精灵，我用它绘制了一些东西，我如何擦除我绘制的部分内容？最好我可以使用`drawRect()`一些“alpha=0”的油漆。

但是，我不相信该`beginFill()`方法可以让您设置 RGBA 颜色（就像您可以在 中一样`bitmapData`）。`alpha = 0`在 graphics 方法中设置`beginFill()`并没有真正做任何事情——它只是什么都不画。

在我的特定用例中，屏蔽不是一种选择。

此外，调用`clear()`不是一个好的解决方案，因为它会清除所有内容。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-15T16:31:23.130

如果您不需要与 Sprite 下的任何元素进行交互，则可以很好地实现这一点。

去做这个

1.  在您想要的形状中创建一个 Shape 对象并将其`cacheAsBitmap`属性设置为`true`
2.  将 Sprite 的`cacheAsBitmap`属性设置为`true`
3.  `blendMode`将Shape的属性设置为`BlendMode.ERASE`
4.  将形状添加到 Sprite 的显示列表

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T05:58:02.300

不幸的是，您不能完全按照您希望对 Graphics 类执行的操作。尽管擦除可能意味着您使用背景颜色绘制了已绘制的内容，但我猜您希望将透明度“绘制”回 Graphics 对象。使用 0 的 alpha 进行绘制并不是“什么都没有”——你只是看不到你绘制的内容，因为它是完全透明的。

这就是你使用矢量而不是位图所得到的。“擦除”矢量的一部分意味着您正在创建一个全新的矢量，这将需要一些计算，而不仅仅是将某个像素设置为某个颜色值。Graphics 不提供这种高级功能，尽管您当然可以编写自己的函数来完成它。:P

一种解决方法是改用位图：
[http ://www.actionscript.org/forums/showthread.php3?t=187857](http://www.actionscript.org/forums/showthread.php3?t=187857)
[http://www.actionscripts.org/forums/showthread.php3?t=149021](http://www.actionscripts.org/forums/showthread.php3?t=149021)

另一个是考虑您是否可以以不同的方式实现您想要做的事情；一种适合使用 clear() 的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T07:41:29.710

如果您希望在擦除其他部分的同时保留部分绘图，那么唯一可行的方法是使用多个精灵进行绘制。为绘图的每个部分创建一个精灵，然后您可以选择要擦除的精灵并保留其余部分。

除此之外，您剩下的就是使用位图数据复制部分，然后在使用 clear 后再次绘制复制的部分。（这在复杂的庄园中很难实现，试着只复制一个复杂的弯曲区域！）

# jquery - JQuery - 不触发 MVC 控制器操作

> ID：827876
> 
> 赞同：-1
> 
> 时间：2009-05-06T03:11:48.207
> 
> 标签：jquery, asp.net-mvc

我有以下 JQuery 代码：

```
// When the document is ready, start firing our AJAX
$(document).ready(function() {
    function showValues() {
        var str = $("form").serialize();
        $("#results").text(str);
    }

    $(":checkbox, :radio").click(showValues);
    $("select").change(showValues);
    //showValues();

    // Bind actions...
    $("#navIndex a").bind("click", function(e) { updateNavIndex($(this).attr('href')); });
    $("#navPrevNext a").bind("click", function(e) { updateNavPrevNext($(this).attr('href')); });
    $("#ItemsPerPage").bind("change", function(e) { updateAll(); });
    $(":checkbox, :radio").bind("change", function(e) { updateAll(); });

    $("#navIndex a").click(function() {
        // switch class type...
        $("#navIndex a").removeClass('selected');
        $("#navIndex span").removeClass('selected');
        $("#navIndex a").addClass('notselected');
        $("#navIndex span").addClass('notselected');
        $(this).removeClass('notselected');
        $(this).addClass('selected');
        $(this).parent().removeClass('notselected');
        $(this).parent().addClass('selected');

        // Get navigation index...
        var navIndex = $(this).attr('href');

        this.blur();
        return true;
    });
    $("#navPrevNext a").click(function() {
        // Get navigation index...
        var navIndex = $(this).attr('href');

        this.blur();
        return true;
    });
});

// Use the getJSON method to call our JsonResult action
var retrieveProductData = function(path, productGroup, productType, itemsPerPage, pageIndex, filter, fnHandleCallback) {
    $.getJSON(path
             , { productGroup: productGroup }
             , { productType: productType }
             , { itemsPerPage: itemsPerPage }
             , { pageIndex: pageIndex }
             , { filter: filter }
             , function(data) { fnHandleCallback(data); });
};

// Use the getJSON method to call our JsonResult action
var retrieveMenuData = function(path, productGroup, productType, itemsPerPage, pageIndex, filter, fnHandleCallback) {
    $.getJSON(path
             , { productGroup: productGroup }
             , { productType: productType }
             , { itemsPerPage: itemsPerPage }
             , { pageIndex: pageIndex }
             , { filter: filter }
             , function(data) { fnHandleCallback(data); });
};

// The path parameter is our JSON controller action
function updateNavIndex(pageIndex) {
    var filters = $("form").serialize();
    var productGroup = $("#valProductGroup").attr('title');
    var productType = $("#valProductType").attr('title');
    var itemsPerPage = $("#ItemsPerPage").val();

    retrieveMenuData("/CatalogAjaxController/UpdateNavigation"
                    , productGroup
                    , productType
                    , itemsPerPage
                    , pageIndex
                    , filters
                    , handleMenuData);
    retrieveProductData("/CatalogAjaxController/UpdateNavigation"
                       , productGroup
                       , productType
                       , itemsPerPage
                       , pageIndex
                       , filters
                       , handleProductData);
}

// The path parameter is our JSON controller action
function updateNavPrevNext(pageIndex) {
    var filters = $("form").serialize();
    var productGroup = $("#valProductGroup").attr('title');
    var productType = $("#valProductType").attr('title');
    var itemsPerPage = $("#ItemsPerPage").val();

    retrieveMenuData("/CatalogAjaxController/UpdateNavigation"
                    , productGroup
                    , productType
                    , itemsPerPage
                    , pageIndex
                    , filters
                    , handleMenuData);
    retrieveProductData("/CatalogAjaxController/UpdateNavigation"
                       , productGroup
                       , productType
                       , itemsPerPage
                       , pageIndex
                       , filters
                       , handleProductData);
}

// The path parameter is our JSON controller action
function updateAll() {
    var filters = $("form").serialize();
    var productGroup = $("#valProductGroup").attr('title');
    var productType = $("#valProductType").attr('title');
    var itemsPerPage = $("#ItemsPerPage").val();

    retrieveMenuData("/CatalogAjaxController/UpdateNavigation"
                    , productGroup
                    , productType
                    , itemsPerPage
                    , pageIndex
                    , filters
                    , handleMenuData);
    retrieveProductData("/CatalogAjaxController/UpdateProducts"
                       , productGroup
                       , productType
                       , itemsPerPage
                       , pageIndex
                       , filters
                       , handleProductData);
}

// Ok, now we have the JSON data, we need to do something with it.  I'm adding it to another dropdown.  
function handleMenuData(data) {
    $("#otherDropDownId > option").remove();
    for (d in data) {
        var item = data[d];
        $("#otherDropDownId").append("<option value=\"" + item.Value + "\">" + item.Text + "</option>");
    }
}

// Ok, now we have the JSON data, we need to do something with it.  I'm adding it to another dropdown.  
function handleProductData(data) {
    $("#otherDropDownId > option").remove();
    for (d in data) {
        var item = data[d];
        $("#otherDropDownId").append("<option value=\"" + item.Value + "\">" + item.Text + "</option>");
    }
} 
```

我的控制器看起来像：

```
public class CatalogAjaxController : Controller
{
    [Authorize, AcceptVerbs(HttpVerbs.Post)]
    public JsonResult UpdateNavigation(string productGroup, string productType, int itemsPerPage, string pageIndex, string filters)
    {
        int pIndex = Convert.ToInt32(pageIndex.Remove(0, 1));

        ProductCatalogBrowserModel myModel;
        myModel = new ProductCatalogBrowserModel(productGroup, productType, pIndex, itemsPerPage);

        return new JsonResult() { Data = myModel.ProductDetailMenu.ToArray() };
    }

    [Authorize, AcceptVerbs(HttpVerbs.Post)]
    public JsonResult UpdateProducts(string productGroup, string productType, int itemsPerPage, string pageIndex, string filters)
    {
        int pIndex = Convert.ToInt32(pageIndex.Remove(0, 1));

        ProductCatalogBrowserModel myModel;
        myModel = new ProductCatalogBrowserModel(productGroup, productType, pIndex, itemsPerPage);

        return new JsonResult() { Data = myModel.ProductDetail.ToArray() };
    }

} 
```

我可以在 JS 脚本中的 3 个更新函数中的任何一个中捕获断点，但它根本不会放入控制器中。我错过了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:20:27.513

我认为您错过了如何构建 Ajax 参数。

```
$.getJSON(
    url,
    {
        'dataVal1': data1,
        'dataVal2': data2
    },
    myCallBackHandler
); 
```

但是，这会传递一个 GET 请求，并且您可能需要一个 POST。

您可以通过基本的 Ajax 调用来做到这一点：

```
$.ajax({
    url: thePath,
    type: 'POST',
    data: {
        dataVal1: data1,
        dataVal2: data2
    },
    success: successHandler,
    failure: failureHandler
}); 
```

你可以在这里找到更多的使用场景：

[http://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T03:19:20.107

您的 JS 正在获取，控制器操作仅接受 POST

# .htaccess - htaccess 麻烦

> ID：827878
> 
> 赞同：1
> 
> 时间：2009-05-06T03:12:17.893
> 
> 标签：.htaccess, apache2

我有这个 .htaccess 文件，当我导航到 gotgage.local/category/gages/ 时，它的 gages 部分没有被传递

```
RewriteEngine On
RewriteRule     ^/category/(.*?)/$  category.php?p=$1 [rn] 
```

为了测试 category.php 文件只是转储 $_POST、$_GET 和 $_SERVER，这是我在打开页面时看到的。

```
GET
Array ( )
POST
Array ( ) 
SERVER
Array (
    [HTTP_USER_AGENT] => Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/525.19 (KHTML, like Gecko) Chrome/1.0.154.59 Safari/525.19
    [HTTP_ACCEPT_ENCODING] => gzip,deflate,bzip2,sdch
    [HTTP_ACCEPT] => text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
    [HTTP_CACHE_CONTROL] => max-age=0
    [HTTP_ACCEPT_LANGUAGE] => en-US,en
    [HTTP_ACCEPT_CHARSET] => ISO-8859-1,*,utf-8
    [HTTP_HOST] => gotgage.local
    [HTTP_CONNECTION] => Keep-Alive
    [PATH] => /usr/local/bin:/usr/bin:/bin
    [SERVER_SIGNATURE] =>  Apache/2.2.9 (Ubuntu) PHP/5.2.6-2ubuntu4.2 with Suhosin-Patch Server at gotgage.local Port 80

    [SERVER_SOFTWARE] => Apache/2.2.9 (Ubuntu) PHP/5.2.6-2ubuntu4.2 with Suhosin-Patch
    [SERVER_NAME] => gotgage.local
    [SERVER_ADDR] => 192.168.0.180
    [SERVER_PORT] => 80
    [REMOTE_ADDR] => 192.168.0.196
    [DOCUMENT_ROOT] => /home/gotgage/www/
    [SERVER_ADMIN] => [no address given]
    [SCRIPT_FILENAME] => /home/gotgage/www/category.php
    [REMOTE_PORT] => 56793
    [GATEWAY_INTERFACE] => CGI/1.1
    [SERVER_PROTOCOL] => HTTP/1.1
    [REQUEST_METHOD] => GET
    [QUERY_STRING] => 
    [REQUEST_URI] => /category/gages/
    [SCRIPT_NAME] => /category.php
    [PATH_INFO] => /gages/
    [PATH_TRANSLATED] => /home/gotgage/www/gages/
    [PHP_SELF] => /category.php/gages/
    [REQUEST_TIME] => 1241579116
    [argv] => Array
        (
        )

    [argc] => 0 ) 
```

从技术上讲，重定向是有效的，但是我没有从正确的页面获取下面正在转储的页面的 vars，但我的 vars 没有被传递。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:29:33.483

好吧，以下对我有用。看起来它不喜欢我的前导`/`和`[rn]`抛出的语法错误。

```
RewriteEngine On
RewriteRule ^category/(.*?)/$ category.php?p=$1 
```

注意：无论如何，它可能应该是`[R,N]`，但同样，在这种情况下不需要它们。

* * *

[RewriteRule Flags Documentation](http://httpd.apache.org/docs/2.2/rewrite/rewrite_flags.html) - 显示您可能不想使用`R`or的原因`N`，但可能有一些我们不知道的东西。
[RewriteRule 文档](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriterule)- 似乎表明`/`.htaccess RewriteRules 中没有前导（如果有 RewriteBase）。无论哪种方式，尝试使用和不使用 的规则`/`，对我来说，它只有在没有的情况下才有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T03:26:39.560

我不完全确定这是问题所在，但将标志设置为“ `[rn]`”是无效的。多个标志应该用逗号分隔，所以如果你试图同时放置`R`和`N`标志，它应该是`[R,N]`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T03:28:27.073

有几件事有些不清楚：

1）与正则表达式部分的预期匹配是什么：

```
(.*?) 
```

这有点多余——假设您只想匹配斜线之间的任何内容，以下内容就足够了：

```
(.*) 
```

2）您设置了一个“rn”标志，这似乎无效。有效标志的示例是：

```
[R]
[N]
[R,N] 
```

不过，我不确定您是否真的想同时使用 R 和 N。

# python - 带有 Linux 屏幕的 Python 解释器

> ID：827879
> 
> 赞同：1
> 
> 时间：2009-05-06T03:12:46.957
> 
> 标签：python, linux, terminal

我正在使用带有[Linux 终端屏幕](http://www.rackaid.com/resources/linux-tutorials/general-tutorials/using-screen/)的 Python 。当我输入：

```
help(somefunction) 
```

它打印了适当的输出，但后来我的屏幕卡住了，终端底部是“（结束）”。

我如何摆脱困境？提前致谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T03:41:29.600

GNU（或其他类 Unix）系统上的标准是使用环境变量`PAGER`作为命令，该命令应该接收**一次查看一屏（“页面”）的**输出。

我的设置为：

```
$ echo $PAGER
less 
```

您的可能设置为`more`，或不同的命令，或者根本没有设置，在这种情况下将使用系统范围的默认命令。

听起来您的程序是根据`more`程序建模的。该程序正在向您显示逐页输出，在这种情况下告诉您您已经结束了。

它们中的大多数（基本上，任何比 更现代的寻呼机）都允许您通过使用光标控制键（箭头和/ ）以及许多其他操作`more`在输出中前进和后退。`PgUp``PgDown`

由于您可以在输出中的任何位置执行所有这些操作，因此程序**需要您发出明确的命令才能知道您已完成**导航输出。command 很可能是 keypress `q`。

有关如何驱动寻呼机的更多信息，例如`less`，使用命令阅读其手册页`man less`（当然，这将使用寻呼机程序显示输出页面:-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T03:14:25.487

该程序使用您的寻呼机，默认情况下更多。您只需按 q 即可退出。

# c# - 如何构建 C# 控制台应用程序以有效使用 IDisposable 数据库资源？

> ID：827884
> 
> 赞同：5
> 
> 时间：2009-05-06T03:15:22.707
> 
> 标签：c#, sqlite, database-connection, console-application

这是我为 C# 控制台应用程序提出的（非常简化以说明问题空间）设计。数据库连接实现 IDisposable，并且此解决方案不允许`using`数据库连接对象。有人可以为控制台应用程序提出更正确的结构吗？这是我需要经常解决的问题。

```
class Program 
{
    SQLiteConnection sourceConnection;
    SQLiteConnection destinationConnection;

    static void Main(string[] args)
    {
        Program shell = new Program();

        // get connection strings from command line arguments
        string sourceConnectionString = shell.getConnectionString(args);
        string destinationConnectionString = shell.getConnectionString(args);

        // call non-static methods that use
        shell.setUpConnections(sourceConnectionString, destinationConnectionString);

        shell.doDatabaseWork();
    }

    private void setUpConnections(string sourceConnectionString, string destinationConnectionString)
    {
        sourceConnection = new SQLiteConnection(sourceConnectionString);
        destinationConnection = new SQLiteConnection(destinationConnectionString);
    }

    private void doDatabaseWork()
    {
        // use the connections here
    }
} 
```

**编辑：**

有些人不明白为什么我希望它们作为成员变量。这是我在 doDatabaseWork 中的用例（有点伪编码）：

```
foreach (Row sourceRow in DBResultSet)
{
  string sourceXml = sourceRow.Columns["MyColumnName"].Value;
  string destinationXML = transformUsingXSLT(sourceXml);
  writeToDestination(destinationXml);
} 
```

看看我想如何在这个循环的生命周期内保持这些连接打开？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T03:23:58.800

如何编写一个实现 IDisposable 的类。

在您的类构造函数中，您可以实例化您的数据库连接。

然后在 IDisposable.Dispose 方法中，编写用于关闭数据库连接的拆卸代码。

这是一个代码示例来演示我的意思：

```
public class DBWrapper : IDisposable
{
    public SqlConnection Connection1 { get; set; }
    public SqlConnection Connection2 { get; set; }

    public DBWrapper()
    {
        Connection1 = new SqlConnection();
        Connection1.Open();
        Connection2 = new SqlConnection();
        Connection2.Open();
    }
    public void DoWork()
    {
        // Make your DB Calls here
    }

    public void Dispose()
    {
        if (Connection1 != null)
        {
            Connection1.Dispose();
        }
        if (Connection2 != null)
        {
            Connection2.Dispose();
        }
    }
} 
```

然后，从 Program 类的 main 方法中：

```
class Program
{
    static void Main(string[] args)
    {
        using (DBWrapper wrapper = new DBWrapper())
        {
            wrapper.DoWork();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T03:25:42.027

斯科特的回答是一种方法。您也可以考虑使用 try{} finally 代替？

```
static void Main(string[] args)
{
    Program shell = new Program();

    // get connection strings from command line arguments
    string sourceConnectionString = shell.getConnectionString(args);
    string destinationConnectionString = shell.getConnectionString(args);

    // call non-static methods that use
    shell.setUpConnections(sourceConnectionString, destinationConnectionString);
    try
    {
      shell.doDatabaseWork();
    }
    finally
    {
      if(sourceConnection != null)
        sourceConnection.Dispose();
      if(destinationConnection != null)
        destinationConnection.Dispose();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T04:21:35.980

就个人而言，我认为你想多了，这个线程中的代码示例过于复杂恕我直言。我不知道为什么人们在他们的 Program 类上实现 IDisposable ，因为它在退出时被释放。

我想不出一个不使用或为什么不能使用 using(){} 语句的原因。

你想打开一个连接并保持它吗？为什么？所有真正的连接都在 .net 连接池的幕后，所以新建 Connection 对象没什么大不了的。只需根据需要打开和关闭它们，连接池在幕后处理所有这些。

我编辑了我的示例以将其包装在一个类中，以便您也可以进行封装。

```
class Program 
{
    static void Main(string[] args)
    {
        DBWorker worker = new DBWorker();
        worker.DoDatabaseWork();
    }
}

public class DBWorker 
{

    private void DoDatabaseWork()
    {
        using (SQLiteConnection sourceDB = new SQLiteConnection( GetConnectionString() ))
        {
            sourceDB.Open();
            using (SQLiteConnection destDB = new SQLiteConnection( GetConnectionString() ))
            {
                destDB.Open();
            }
        }
    }

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T04:42:38.753

我认为最好的解决方案是从 Program 类中提取主要逻辑。Program 类是主要工作的某种启动器。并且为 SqlConnections 提供包装器确实不是一个好主意，因为它们已经是托管资源，包装它们是多余的。因此我的解决方案如下所示：

```
class ProgramCore : IDisposable
{
    internal ProgramCore(string sourceConnectionString, string destinationConnectionString)
    {
        setUpConnections(sourceConnectionString, destinationConnectionString);
    }

    internal void Execute()
    {
        // do whatever you want
        doDatabaseWork();
        // do whatever you want
    }

    public void Dispose()
    {
        if (_sourceConnection != null)
            _sourceConnection.Dispose();
        if (_destinationConnection != null)
            _destinationConnection.Dispose();
    }

    private void setUpConnections(string sourceConnectionString, string destinationConnectionString)
    {
        _sourceConnection = new SQLiteConnection(sourceConnectionString);
        _destinationConnection = new SQLiteConnection(destinationConnectionString);
    }

    private void doDatabaseWork()
    {
        // use the connections here
    }

    private SQLiteConnection _sourceConnection;
    private SQLiteConnection _destinationConnection;
}

class Program
{
    static void Main(string[] args)
    {
        // get connection strings from command line arguments
        string sourceConnectionString = GetConnectionString(args);
        string destinationConnectionString = GetConnectionString(args);

        using (ProgramCore core = new ProgramCore(sourceConnectionString, destinationConnectionString))
        {
            core.Execute();
        }
    }

    static string GetConnectionString(string[] args)
    {
        // provide parsing here
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T21:51:01.720

嗯，我看没有人提到过这样做。您不必拥有在`using`本地声明中使用的变量。

```
 class Program 
{
    SQLiteConnection sourceConnection;
    SQLiteConnection destinationConnection;

    static void Main(string[] args)
    {
        Program shell = new Program();

        // get connection strings from command line arguments
        string sourceConnectionString = shell.getConnectionString(args);
        string destinationConnectionString = shell.getConnectionString(args);

        using (sourceConnection = new SQLiteConnection(sourceConnectionString))
        using (destinationConnection = new SQLiteConnection(destinationConnectionString))
        {
            shell.doDatabaseWork();
        }
    }

    private void doDatabaseWork()
    {
        // use the connections here
    }
} 
```

# c# - 如何从静态类引用 Linq2SQL 类

> ID：827887
> 
> 赞同：0
> 
> 时间：2009-05-06T03:16:50.270
> 
> 标签：c#, asp.net

我有一个奇怪的问题，我有一个像这样的静态类

```
 public static class BlogDataAccess
{
    private static Blog _Blg;
    public static Blog Blg
    {
        get
        {
           _Blg = new Blog ();
           return _Blog ;
        }
    }

} 
```

然后在我的页面中我执行以下操作

```
 var DataContext= new DataClasses();
  BlogDataAccess.Blg.ArticleTitle ="Title";
  DataContext.Blog.InsertOnSubmit(BlogDataAccess.Blg);
  DataContext.SubmitChanges(); 
```

记录被插入，但 ArticleTitle 字段的值为空。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T03:21:56.247

每次访问`BlogDataAccess.Blg`时，您都在创建一个新对象。我认为您的意思是像这样实现惰性实例化：

```
public static class BlogDataAccess
{
    private static Blog _Blg;
    public static Blog Blg
    {
        get
        {
            if(_Blg == null)
                _Blg = new Blog();

            return _Blg;
        }
    }

} 
```

# gis - 如何链接到 KMZ 文件中的内部文件？

> ID：827903
> 
> 赞同：3
> 
> 时间：2009-05-06T03:24:12.637
> 
> 标签：gis, kml, google-earth, kmz

我正在尝试设置一个[KMZ](http://en.wikipedia.org/wiki/KML)文件以在 Google 地球中使用，其中气球内容主要在 HTML 文件中定义，这些文件是使用 iframe 嵌入的。当在本地文件系统上使用相对链接时（假设文件系统访问已启用），该设置适用于纯 KML 文件和额外的 HTML 文件。

我的问题是我找不到一种方法来创建包含所有文件的 KMZ 文件以相互关联的方式。KML 规范根本没有谈论这个问题（事实上 KMZ 在整个文档中只出现了几次）。我也找不到关于 KMZ 的任何其他文档。

是否可以链接到 KMZ 中的其他 HTML 文件？如果是：如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-28T15:58:59.437

是的，Kml 规范允许这样做，您只需使用相对路径。

但是，您的问题实际上与*特定应用程序*对某些类型内容的安全限制有关。

例如，完整的 Google 地球客户端允许您将 Flash (swf) 内容加载到气球中，而 Goggle 地球插件则不允许。iFramed 内容等也是如此。

因此，问题的答案将完全取决于您在哪个应用程序中查看 Kml/kmz，与 Kml 或 Kmz 规范无关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-16T01:57:10.647

意识到存在[OGC KML 标准](http://www.opengeospatial.org/standards/kml)以及该标准的规范如何在 Google 地球软件中得到解释和实施。特别是在 Google 地球实施的规范中，有些灰色区域没有明确定义。管理 KMZ 文件和嵌入内容的规则没有很好地定义，并且显然是特定于实现的。[Google KML 参考](https://developers.google.com/kml/documentation/kmlreference)文档中定义了一些细节，而另一些则没有。KML 和 Google 地球的一些不一致和未记录的功能可以在[KML Errata](http://kml4earth.appspot.com/kmlErrata.html)中找到。

哪些媒体内容（嵌入在 KMZ 文件中）可以在描述气球内内联显示，以及可以链接和访问哪些内容都有限制。

[以下是KMZ 教程](https://developers.google.com/kml/documentation/kmzarchives)`<iframe>`中列出的内容的一些限制

> `<src>`元素内的元素`<iframe>`不能指向磁盘上的本地文件，也不能指向KMZ文件内的文件；它必须指向浏览器可以访问的 Internet 上的 URL。

作为此规则的一个例外，您实际上可以在 KMZ 文件中包含一个 HTML 文件，并将其作为`<src>`元素包含`<iframe>`在具有相对 URL 的功能描述中，但不支持许多其他媒体类型。

如果您在工具/选项/常规菜单面板中启用“*允许访问本地文件和个人数据*”选项，那么这会放宽一些访问规则，并且能够像您一样访问一些内容链接（例如 HTML、PDF 等）来自网络浏览器，但主要是 KMZ 文件外部的本地文件。

# asp.net-mvc - ASP.NET MVC 登录 ReturnUrl 总是 NULL？

> ID：827905
> 
> 赞同：58
> 
> 时间：2009-05-06T03:24:35.523
> 
> 标签：asp.net-mvc, redirect, login

在尝试重新登录到站点时，在 ASP.NET MVC 中使用表单身份验证，它会将 ReturnUrl 参数放入查询字符串中。我的登录操作方法接受“returnUrl”字符串。然而，returnUrl 字符串似乎始终为空，即使它显然在查询字符串中也是如此。关于为什么会出现这种情况或可能的解决方法的任何想法？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-07-30T13:47:46.180

当您使用一个通用登录表单时，往往会发生这种情况，但您明确指定了 Controller 和 ActionMethod（这会导致表单发布，但会丢失查询字符串）

澄清一下，这就是您的代码在 BeginForm 中的样子：

```
Html.BeginForm("LogOn", "Account", new { ReturnUrl = Request.QueryString["ReturnUrl"] }) 
```

> **编辑**：*这是 RickAnd 在下面的评论中提到的设计。但是，如果允许匿名用户，它不允许深入站点的 UI 模式，单击登录，然后返回到您之前所在的页面。这是一种普遍要求的模式。David Allen 的 LogOff 方法也适用于 LogOn 的干净重定向。*

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-05-06T03:30:35.617

也许您没有将`ReturnURL`参数包含在登录表单的操作属性中，从而发布到没有该参数的 URL？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-07-21T12:57:13.097

基本上，Asp.net MVC 有一些隐藏的特性。例如，当您将变量“id”传递给控制器​​操作时，它会将“id”解释为默认标识符，并将其放在带有前斜杠的浏览器查询中。通过使用另一个名称而不是“id”，我们将看到“？” 而不是前斜线。因为在*global.asax*文件上的`RegisterRoutes`方法上设置了“id”名称。

 *在这个问题中，您使用以下代码创建了一个自定义数据传递器到控制器：

```
using(Html.BeginForm("LogOn", "Account", FormMethod.Post))
{
//form fields
} 
```

所以 Asp.net MVC 忽略了其他有用的数据来传递给控制器​​动作，我们将看到`returnUrl`总是`null`.

同时，通过使用它，Asp.net MVC 可以正确运行并`returnUrl`安装：

```
using(Html.BeginForm())
{
//form fields in LogOn View
} 
```

顺便说一句，当我们使用自定义数据传递器到控制器动作时，必须**手动**传递另一个数据，如下所示：

```
using(Html.BeginForm("LogOn", "Account", new {ReturnUrl = Request.QueryString["ReturnUrl"] }))
{
//form fields
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-03T19:45:50.717

我可以想到两种方法来处理登录和注销场景。Dave Beer 在上面概述了一种方式。还有另一种方法适用于许多情况。我在编写 NerdDinner 教程时使用了它。本教程为我们提供了注销功能，可让您注销并带您回家。我不想那样。我想回到我注销前的页面。所以我修改了我的帐户控制器注销操作看起来像这样

```
 public ActionResult LogOff()
    {
        FormsService.SignOut();
        return Redirect(Request.UrlReferrer.ToString());
    } 
```

如果您想覆盖此行为，您可以变得更漂亮并传入 returnUrl 并对其进行测试。但我不需要那个。这达到了预期的结果。登录可以类似地工作。也许有一些方法可以使用 MVC 框架为我做这件事，但在我学习它们之前，这非常简单并且工作可靠。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T08:58:49.090

尝试以下操作：

```
 public static MvcForm BeginForm(this HtmlHelper htmlHelper, string id)
    {
        string formAction = htmlHelper.ViewContext.HttpContext.Request.RawUrl;

        TagBuilder tagBuilder = new TagBuilder("form");

        tagBuilder.MergeAttribute("id", id);
        tagBuilder.MergeAttribute("action", formAction);
        tagBuilder.MergeAttribute("method", HtmlHelper.GetFormMethodString(FormMethod.Post), true);

        HttpResponseBase httpResponse = htmlHelper.ViewContext.HttpContext.Response;
        httpResponse.Write(tagBuilder.ToString(TagRenderMode.StartTag));

        return new MvcForm(htmlHelper.ViewContext.HttpContext.Response);
    } 
```

首先确保您在 web.config 中设置了登录 url，接下来，确保您的登录表单不包含任何类似操作的内容，例如：

# 看法：

如果您指定操作，则返回 url 将始终为 null：

# 控制器：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult SignIn(string userName, string password, bool? rememberMe, string returnUrl)
{
} 
```

# php - 通过 url 传递会话 id

> ID：827910
> 
> 赞同：5
> 
> 时间：2009-05-06T03:27:49.727
> 
> 标签：php, url, session, ini-set

我试图让我的脚本使用 url 会话 ID 而不是 cookie。以下页面未将 url 中的变量作为会话 ID。我肯定错过了什么。

第一页[http://www.website.com/start.php](http://www.website.com/start.php)

```
ini_set("session.use_cookies",0);
ini_set("session.use_trans_sid",1);
session_start();
$session_id = session_id();
header("location: target.php?session_id=". $session_id ); 
```

以下页面 - [http://www.website.com/target.php?session_id=rj3ids98dhpa0mcf3jc89mq1t0](http://www.website.com/target.php?session_id=rj3ids98dhpa0mcf3jc89mq1t0)

```
ini_set("session.use_cookies",0);
ini_set("session.use_trans_sid",1);
print_r($_SESSION);
print(session_id()) 
```

结果是不同的会话 ID，会话为空白。

数组 ( [debug] => no ) pt1t38347bs6jc9ruv2ecpv7o2

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T05:24:54.190

使用 url 传递会话 id 时要小心，这可能导致通过引用者劫持会话！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T03:45:17.220

看起来您只需要在第二页上调用[session_start()即可。](http://www.php.net/manual/en/function.session-start.php)

从文档：

> session_start() 根据通过请求（例如 GET、POST 或 cookie）传递的当前会话 ID 创建会话或恢复当前会话。

**编辑：**

也就是说，您也可以尝试从查询字符串中手动获取会话 ID。在第二页上，您需要执行以下操作：

```
ini_set("session.use_cookies",0);
ini_set("session.use_trans_sid",1);
session_id($_GET['session_id']);
print_r($_SESSION);
print(session_id()); 
```

请注意，如果您将 id 作为参数传递给[session_id()函数，它将设置 id。](http://www.php.net/manual/en/function.session-id.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-25T04:50:24.620

我的问题是在 FF 中使用 Flash（因为 Flash 搭载 IE，因此在 Flash 对象和 firefox 之间不共享会话）

使用 php 5.3 所有这些答案都指向了事实。我最终发现工作非常简单.. 在查询字符串中传递 id。设置它。然后开始会话。

```
session_id($_GET['PHPSESSID']);
session_start(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-02T15:48:34.497

而不是 hardcoding `'PHPSESSID'`，使用这个：

```
session_id($_GET[session_name()]); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-30T07:05:48.743

只是一点点更正......不要忘记检查参数是否存在。这对我很有效。

```
if (isset($_GET['PHPSESSID'])) {
  session_id($_GET['PHPSESSID']);
}
session_start(); 
```

# ruby-on-rails - 如何根据 RailsCasts 教程在 Rails 中进行简单搜索？

> ID：827914
> 
> 赞同：2
> 
> 时间：2009-05-06T03:29:12.673
> 
> 标签：ruby-on-rails, search

我按照 RailsCasts 教程使用自动完成功能进行了简单的搜索，但它不起作用。:(

查看/供应商/索引：

```
<% form_tag vendors_path, :method => 'get' do %>
    <%= text_field_with_auto_complete   :vendor, 
                                        :name,
                                        {}, 
                                        {:method => :get, :class => 'textbox'} %>
    <%= submit_tag "Search", :name => nil %>
<% end %>
</div>
<%= @searchvendor.id %>
<%= @searchterm %> 
```

我将@searchterm 和@searchvendor.id 作为验证步骤。

所以这应该调用控制器 => 供应商，动作 => 索引：

```
def index
    @searchterm = params[:vendor][:name]

    @searchvendor = Vendor.search('checkpoint') 
```

并且为供应商/型号创建如下搜索方法：

```
 def self.search(search)
  if search
    find(:all, :conditions => ['name LIKE ?', "%#{search}%"])
  else
    find(:all)
  end 
```

输出？

@searchterm 确实显示了输入的值，因为 URL 中显示为 vendor[name]=?

@searchvendor.id 是一个长字符串，@searchvendor.name 显示错误，名称不是方法。

我难住了。请帮忙？

链接到教程：

[http://railscasts.com/episodes/37-simple-search-form](http://railscasts.com/episodes/37-simple-search-form)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T03:35:36.183

1.  您不应该将 @searchterm 传递到您的 Vendor.search 方法吗？每次通过“检查点”可能不会奏效。

2.  @searchvendor 将在您执行 find(:all) 时包含一个数组。您需要遍历数组并对每个项目执行 .name 。

# perl - 为什么我不能用 DBD::DB2 断开我的数据库句柄？

> ID：827917
> 
> 赞同：1
> 
> 时间：2009-05-06T03:31:03.260
> 
> 标签：perl, dbi, disconnect

我的 perl 脚本很慢但可以工作。我正在考虑把它扔掉，用适当的绑定等构建一个真正的 DB2 应用程序；但是，与此同时，我希望它可以用作占位符。

我查看了[此文档](http://search.cpan.org/~ibmtordb2/DBD-DB2-1.71/DB2.pod)，其中提到：

```
$dbh->disconnect(); 
```

但是我不能使用它，因为它会引发此错误。

> 无法在 ./ProgramTree.pl 第 119 行通过包“dbh”（可能是加载“dbh”？）找到对象方法“disconnect”。

我知道我的临时应用程序正在泄漏和增长，因为它正在递归地打开数据库句柄。我错过了一些基本的东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T03:37:02.123

该错误听起来很像缺少印记而您正在运行`dbh->disconnect();`。

* * *

看看当一个对象没有方法时会发生什么：

```
    [~] perl -e'my $dbh = bless {}, q/foo/; $dbh->断开连接（）；'
    无法通过 -e 第 1 行的包“foo”定位对象方法“disconnect”。

```

与在裸词“dbh”上调用该方法时相比：

```
    [~] perl -e'dbh->disconnect();'
    无法在 -e 第 1 行通过包“dbh”找到对象方法“断开连接”（也许您忘记加载“dbh”？）。

```

# tfs - 限制谁可以更改 TFS 中的“构建质量”

> ID：827918
> 
> 赞同：1
> 
> 时间：2009-05-06T03:32:00.623
> 
> 标签：tfs, build-process, build-automation

当构建位于 Visual Studio 中构建资源管理器的已完成部分时，可以分配构建质量。

有没有办法限制谁可以设置这些？理想情况下，我希望有一种方法将某些用户限制为特定用户（即测试人员准备好产品），而将其他用户限制为另一个组（即开发人员准备测试）

瓦卡诺

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T08:01:47.137

恐怕您无法将某些构建质量限制在当前版本的 TFS 中的人群中。TFS2008 中只有一个“编辑构建质量”权限，可让您将构建设置为任何定义的质量。默认情况下，这将分配给项目管理员，但如果您愿意，您可以将其分配给备用组。为此，右键单击团队资源管理器中的团队项目，然后转到团队项目设置、安全性...

# c# - FileInfo.Copy 跨网络是好的解决方案吗？需要CAS吗？

> ID：827927
> 
> 赞同：0
> 
> 时间：2009-05-06T03:38:22.790
> 
> 标签：c#, file-io

似乎我所做的一切都涉及赢得跨服务器复制文件的服务。我似乎得到了很多安全和安全访问类型的异常，但从来没有完全理解原因。我想知道 fileinfo 或 file.copy 是否是一个好的解决方案，或者是否有更好的解决方案。是否有我应该使用的特定属性或避免这些错误的东西？问题与帐户或密码无关。例如使用域帐户的 \ipaddress\sharename \ipaddress\drive\path。

---添加了具体示例。--- - 我以域\用户名
登录到服务器**A。**（包括域名）
- 我在地址栏中打开文件 eplorer 输入 \\server **B** \c$\folder 回车，我右键单击，创建新文件。没问题。
- 我安装服务，转到属性选择登录，此帐户并将用户名设置为域\用户名（包括域名）与我登录服务器**A**的密码相同。它接受它没有问题。**应用程序在 \\server A**
上执行 FileSystemWatcher并在更改时复制到 \\server **B**以保持配置文件同步。

 ****```
private void CopyNewFileToClone()  
{  
    FileInfo OriginalConfigFile = new FileInfo(Path.Combine(ConfigurationManager.AppSettings.Get("directoryToWatch"), ConfigurationManager.AppSettings.Get("fileToWatch")));  
    FileInfo CloneConfigFile = new FileInfo(Path.Combine(ConfigurationManager.AppSettings.Get("directoryToCopyTo"), ConfigurationManager.AppSettings.Get("fileToCopyTo")));
    FileInfo tmp = new FileInfo(Path.Combine(CloneConfigFile.DirectoryName,"~" + CloneConfigFile.Name));  

    OriginalConfigFile.CopyTo(tmp.FullName, true);  
    tmp.CopyTo(CloneConfigFile.FullName, true);  
    tmp.Delete();  
} 
```

当我启动服务时，我得到服务无法启动。
System.UnauthorizedAccessException：对路径“\\server **B** \C$\folder\filename”的访问被拒绝。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T04:38:14.113

我使用 fileinfo 从服务器复制文件，它似乎工作正常。如果您确定这不是帐户或密码问题，我会开始查看您的 DNS。如果网络无法解析正在尝试访问网络文件夹的帐户，则使用有效帐户也没关系。您可能会在某些/大部分时间使用缓存帐户感到幸运，但不知道它何时可能不起作用以及何时起作用。

如果您收到大量针对失败响应的广播消息，我会跟踪网络。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T16:12:15.137

这是由于代码访问安全策略。跑
`c:\Windows\Microsoft.NET\Framework\v2.0.50727\CasPol.exe -af <path\application.exe>`
和错误解决了。

在所有需要写入 HD 的应用程序中作为安装步骤添加，尤其是通过 unc 跨网络，例如 \server\share\file。

# bash - 如何使用 bash (grep/sed/etc) 在 2 个时间戳之间获取日志文件的一部分？

> ID：827930
> 
> 赞同：3
> 
> 时间：2009-05-06T03:38:56.470
> 
> 标签：bash, parsing, logfiles, timestamp

我有一组邮件日志：mail.log mail.log.0 mail.log.1.gz mail.log.2.gz

这些文件中的每一个都包含按时间顺序排列的行，这些行以时间戳开头，例如：

**5月3日13:21:12...**

如何**使用 bash**（和相关命令行工具）在某个日期/时间之后和另一个日期/时间之前轻松获取每个日志条目，而无需比较每一行？请记住，我之前和之后的日期可能与日志文件中的任何条目都不完全匹配。

在我看来，我需要确定第一行的偏移量大于起始时间戳，而最后一行的偏移量小于结束时间戳，并以某种方式将该部分剪掉。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T04:49:20.983

将您的最小/最大日期转换为“自纪元以来的秒数”，

```
MIN=`date --date="$1" +%s`
MAX=`date --date="$2" +%s` 
```

将`n`每个日志行中的第一个单词转换为相同的，

```
L_DATE=`echo $LINE | awk '{print $1 $2 ... $n}'`
L_DATE=`date --date="$L_DATE" +%s` 
```

比较并丢弃线条，直到达到`MIN`,

```
if (( $MIN > $L_DATE )) ; then continue ; fi 
```

比较并打印行，直到达到`MAX`,

```
if (( $L_DATE <= $MAX )) ; then echo $LINE ; fi 
```

超过时退出`MAX`。

```
if (( $L_DATE > $MAX )) ; then exit 0 ; fi 
```

整个脚本**minmaxlog.sh**看起来像这样，

```
#!/usr/bin/env bash

MIN=`date --date="$1" +%s`
MAX=`date --date="$2" +%s`

while true ; do
    read LINE
    if [ "$LINE" = "" ] ; then break ; fi

    L_DATE=`echo $LINE | awk '{print $1 " " $2 " " $3 " " $4}'`
    L_DATE=`date --date="$L_DATE" +%s`

    if (( $MIN > $L_DATE  )) ; then continue ; fi
    if (( $L_DATE <= $MAX )) ; then echo $LINE ; fi
    if (( $L_DATE >  $MAX )) ; then break ; fi
done 
```

我在这个文件**minmaxlog.input**上运行它，

```
May 5 12:23:45 2009 first line
May 6 12:23:45 2009 second line
May 7 12:23:45 2009 third line
May 9 12:23:45 2009 fourth line
June 1 12:23:45 2009 fifth line
June 3 12:23:45 2009 sixth line 
```

像这样，

```
./minmaxlog.sh "May 6" "May 8" < minmaxlog.input 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:13:09.230

你必须查看你想要的范围内的每一行（判断它是否在你想要的范围内）所以我猜你的意思不是文件中的每一行。至少，您必须查看文件中的每一行，包括您范围之外的第一行（我假设这些行是按日期/时间顺序排列的）。

这是一个相当简单的模式：

```
state = preprint
for every line in file:
    if line.date >= startdate:
        state = print
    if line.date > enddate:
        exit for loop
    if state == print:
        print line 
```

如果必须，您可以用 awk、Perl、Python 甚至 COBOL 编写此代码，但逻辑始终相同。

首先找到行号（比如 grep），然后盲目地打印出该行范围将无济于事，因为 grep 还必须查看所有行（*所有*行，不仅仅是范围之外的第一个，而且大多数可能*两次*，第一行一个，最后一个）。

如果这是您经常要做的事情，您可能需要考虑将工作量从“每次执行”转移到“一次，当文件稳定时”。一个示例是将日志文件行加载到按日期/时间索引的数据库中。

这需要一些时间来设置，但会导致您的查询变得更快。我不一定提倡使用数据库 - 您可以通过将日志文件拆分为每小时日志来实现相同的效果，因此：

```
2009/
  01/
    01/
      0000.log
      0100.log
      : :
      2300.log
    02/
    : : 
```

然后在给定的时间内，您确切地知道从哪里开始和停止寻找。范围`2009/01/01-15:22`通过`2009/01/05-09:07`将导致：

*   文件的一些（最后一点）`2009/01/01/1500.txt`。
*   所有的文件`2009/01/01/1[6-9]*.txt`。
*   所有的文件`2009/01/01/2*.txt`。
*   所有的文件`2009/01/0[2-4]/*.txt`。
*   所有的文件`2009/01/05/0[0-8]*.txt`。
*   文件的一些（第一位）`2009/01/05/0900.txt`。

当然，我会编写一个脚本来返回这些行，而不是每次都尝试手动执行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T12:51:35.147

这里有一个关于如何做到这一点的基本想法：

1.  检查**文件上的日期**戳以查看它是否无关紧要
2.  如果它*可能*是相关的，则在必要时解压缩并检查文件的**第一行和最后一行**以查看它是否包含开始时间或结束时间。
3.  如果是，请使用**递归函数**来确定它是否在文件的前半部分或后半部分包含开始时间。使用递归函数，我认为您可以在一百万行日志文件中找到任何日期，并进行大约 20 次比较。
4.  按从第一个条目的偏移量到最后一个条目的偏移量的顺序回显日志文件（不再进行比较）

我不知道的是：如何最好地读取文件的第 n 行（使用**tail n+**n** |head 1** 效率如何？）

有什么帮助吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-20T14:20:01.873

也许你可以试试这个：

```
sed -n "/BEGIN_DATE/,/END_DATE/p" logfile 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T04:03:57.020

在 Bash 环境中这可能是可能的，但您应该真正利用具有更多内置支持来处理字符串和日期的工具。例如，Ruby 似乎具有解析日期格式的内置能力。然后它可以将其转换为易于比较的 Unix 时间戳（一个正整数，表示自纪元以来的秒数）。

```
irb> require 'time'
# => true

irb> Time.parse("May 3 13:21:12").to_i
# => 1241371272 
```

然后，您可以轻松编写 Ruby 脚本：

*   提供开始和结束日期。将它们转换为此 Unix 时间戳编号。
*   逐行扫描日志文件，将日期转换为其 Unix 时间戳，并检查它是否在开始和结束日期的范围内。

注意：首先转换为 Unix Timestamp 整数很好，因为比较整数非常容易且高效。

您提到“不比较每一行”。如果不检查其间的所有值，将很难“猜测”日志文件中条目开始太旧或太新的位置。但是，如果确实存在单调增加的趋势，那么您立即知道何时停止解析行，因为一旦下一个条目太新（或旧，取决于数据的布局），您就知道可以停止搜索。尽管如此，仍然存在在您想要的范围内找到第一行的问题。

* * *

我刚刚注意到你的编辑。这是我要说的：

如果您*真的*担心有效地找到该开始和结束条目，那么您可以对每个条目进行二进制搜索。或者，如果这对于 bash 工具来说似乎过大或太难了，您可以试探性地仅读取 5% 的行（每 20 行中的 1 行），以快速获得接近准确的答案，然后在需要时对其进行改进。这些只是性能改进的一些建议。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-11-15T17:56:52.423

我知道这个线程很旧，但我最近找到了一个满足我需求的单行解决方案后偶然发现了它：

```
awk -v ts_start="2018-11-01" -v ts_end="2018-11-15" -F, '$1>=ts_start && $1<ts_end' myfile 
```

在这种情况下，我的文件在第一个字段中包含带有逗号分隔值和时间戳的记录。您可以对开始和结束时间戳使用任何有效的时间戳格式，并根据需要替换这些 shell 变量。

如果要写入新文件，只需使用`> newfile`附加到上述末尾的正常输出重定向 ( )。

# ruby-on-rails - 带有sqlite的rails中的布尔值

> ID：827938
> 
> 赞同：9
> 
> 时间：2009-05-06T03:42:31.253
> 
> 标签：ruby-on-rails, ruby, sqlite, model, boolean

我仍然是个菜鸟，但我遇到了一些看起来有点奇怪的东西。因此，我向数据库中的模型添加了一个布尔字段

```
t.column :admin, :bool, :default => false, :null => false 
```

但是，sqlite3 数据库中的值似乎是`'t'`or `'f'`。没关系，但`user.admin?`如果值为 ，我仍然希望返回 false `'f'`。正如您从以下控制台会话中看到的那样，情况并非如此：

```
>> user = User.first
=> #<User id: 2, login: "matt", name: "", email: "google.ninja@no-spam.com", crypt
ed_password: "c6740f820b4cbf6e3d88188719f23cd3053a54f0", salt: "5629f5ee09f51543
a7d64dd903b8d9e53aa43a24", created_at: "2009-04-26 23:08:05", updated_at: "2009-
04-26 23:10:38", remember_token: nil, remember_token_expires_at: nil, admin: "t"
>
>> user.admin?
=> true
>> user.admin = false
=> false
>> user.save
=> true
>> user = User.first
=> #<User id: 2, login: "matt", name: "", email: "google.ninja@no-spam.com", crypt
ed_password: "c6740f820b4cbf6e3d88188719f23cd3053a54f0", salt: "5629f5ee09f51543
a7d64dd903b8d9e53aa43a24", created_at: "2009-04-26 23:08:05", updated_at: "2009-
05-06 03:32:23", remember_token: nil, remember_token_expires_at: nil, admin: "f"
>
>> user.admin?
=> true 
```

这只是 sqlite 的一些奇怪问题，还是我没有得到什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-06T03:57:34.587

改用这个：

```
t.column :admin, :boolean, :default => false, :null => false 
```

[在这里](http://kconrails.com/blog/articles/2008/07/15/ruby-on-rails-bool-vs-boolean-in-sqlite3)阅读为什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T03:57:21.340

问题可能与数据库迁移有关。我不认为 :bool 是要使用的正确数据类型名称。尝试 :boolean 代替，例如

```
t.column :admin, :boolean, :default => false, :null => false 
```

# django - 如何在 django 中创建关税计算器？

> ID：827942
> 
> 赞同：0
> 
> 时间：2009-05-06T03:46:22.320
> 
> 标签：django, django-models

基本上我正在为我国的一家公用事业公司创建一个关税计算器，基于累进费率表，下面给出一个示例

2.(a) 在任何一个月内，少于 1,001 加仑的费用为…………………………..…… $9.23

(b) 此后每加仑按比例收费，最高为 2,000 加仑（含），每 1,000 加仑………………..$15.89

(c) 超过 2,000 加仑和不超过 3,000 加仑（含）的每加仑按每 1,000 加仑 ...........$17.43 的费率按比例收费

(d) 超过 3,000 加仑和不超过 4,000 加仑（含）的每加仑按每 1,000 加仑 ..........$18.45 的费率按比例收费

(e) 超过 4,000 加仑和不超过 5,000 加仑（含）的每加仑按每 1,000 加仑 ..........$19.48 的费率按比例收费

(f) 超过 5,000 加仑和不超过 6,000 加仑（含）的每加仑按每 1,000 加仑 ..........$20.50 的费率按比例收费

(g) 超过 6,000 加仑和不超过 7,000 加仑（含）的每加仑按每 1,000 加仑 ..........$21.01 的费率按比例收费

(h) 超过 7,000 加仑和不超过 8,000 加仑（含）的每加仑按每 1,000 加仑 ..........$21.53 的费率按比例收费

(i) 超过 8,000 加仑的每加仑按每 1,000 加仑的费率...$22.04 按比例收费

我正在考虑使用以下字段创建 Rate 模型：

1.  供应区域
2.  描述
3.  from_gallons（加仑的起始范围）
4.  to_gallons（加仑的结束范围）
5.  rate_per_1000g

我的观点将接受来自带有加仑数量、供应区域的表格的帖子，并应回发从费率表计算的使用量。

我会在视图中做这样的事情

```
from models import Rate    
def tarrif_calc(request,gallons,area):
    rate = Rate.objects.get(area_of_supply=area, from_gallons >= gallons, to_gallons <= gallons)
    rate_per_gal = rate.rate_per_1000g/1000
    usage = gallons * rate_per_gal
    return usage 
```

这是我能想到的最简单的例子，但是我不确定我将如何处理累进费率......有什么想法吗？我在正确的轨道上吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T03:51:03.430

业务规则应该用代码来表达。 [更多信息](http://thedailywtf.com/articles/soft_coding.aspx)

在仔细阅读您的问题后，您可能需要查询许多此类表。将许多类似的此类结构合法地放入数据库中。现在我假设你有这个。如果你真的只有一张桌子，案例分析可能是最简洁的。

在我自己的 django 应用程序中，我发现在表单中放置业务逻辑的一个非常自然的地方。模型似乎很明显，但很少能够访问必要的上下文来做出明智的决定，以决定什么可以去哪里。

通常我会把它分成几个依赖的应用程序。一个应用程序提供了非常高级的抽象模型和表格。另一个应用程序使用业务规则扩展了第一个表单。

第一个问题是查询 Rate 模型。那段代码实际上不起作用。你不能在 python 中传递惰性比较。 [Django 有一个机制](http://docs.djangoproject.com/en/dev/topics/db/queries/#field-lookups)，通过修改参数名称。

```
rate = Rate.objects.get(area_of_supply=area, from_gallons__gte=gallons, to_gallons__lte=gallons) 
```

我不确定你的数据库是什么样的，但请确保在 from_gallons 和 to_gallons 上有一个索引，否则这个查询会很慢。

你的例子听起来不像它实际上改变了状态。如果这是真的，那么您可能应该使用 GET 视图而不是 POST。

在任何一种情况下，逻辑的第一部分都是相同的。接收请求并验证表单输入。

```
# in "myproject/businessrules/forms.py"
from django import forms
from myproject.otherapp.models import Area

class RateForm(forms.Form):
    # declare as instance variables the data actually posted
    quantity = forms.DecimalField(label="amount of gallons")
    area = forms.ModelChoiceField(label="area of supply", queryset=Area.objects.all() )
    # now add the business rule!
    def clean(self):
        cleaned_data = self.cleaned_data # quantity and area area already validated 
        rate = Rate.objects.get(
                            area_of_supply=cleaned_data["area"],
                            from_gallons__gte=cleaned_data["gallons"],
                            to_gallons__lte=cleaned_data["gallons"])
        usage = cleaned_data["gallons"] * rate.rate_per_1000g/1000
        cleaned_data["usage"] = usage
        return cleaned_data 
```

现在所需要的就是实际使用它。

```
# in "myproject/myapp/views.py"
from django.shortcuts import render_to_response
from businessrules import RateForm

def tarrif_view(request):
    form = RateForm(request.GET)
    if form.is_valid():
        context = { "form": form, "valid": True, "usage":form.cleaned_data["usage"] }
    else:
        context = { "form": form, "valid": False }
    return render_to_response("tarrif.html", context) 
```

视图中嵌入的业务知识很少。只有表单将清理后的计算结果存储在其“使用”键中这一事实。但由于视图正是为了获得该值，所以这是正确的做法。

还需要使用该表单的模板。（我的 django 模板技能只是马马虎虎。正如我所说，我更喜欢[jinja2](http://jinja.pocoo.org/2/)，你也应该如此）

就个人而言，我不太喜欢将单个表单结果移动到模板上下文中，我只是使用整个处理后的表单。不过，我在 jinja2 中编写了自己的模板，因此，如果您的模板设计者不值得信赖，您可能需要比这更仔细地制作您的上下文。

```
{# in "myproject/templates/tarrif.html" #}
{% if valid %}
Usage: {{ usage }} dollars.
{% else %}
<form action="" method="GET">
    {{ form }}
    <input type="submit" \>
</form>
{% endif %} 
```

同样，模板中不会出现比视图中更多的业务逻辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T03:39:04.840

现在来自上面的@TokenMacGuy 的一个非常完整的示例。我明白你对表单中的业务逻辑的意思。虽然我认为你没有考虑累进率，这会使它变得更长。

完成问题后，我正在回答我自己的问题，并希望其他人可以输入并启发 django 用户有关业务逻辑案例的信息。

所以继承人我做了什么：

首先为费率创建了一个模型，以便将其存储在数据库中。我用一个速率级别标记了每个速率，以便能够处理渐进式评分。

```
class Rate(models.Model):
    area_of_supply = models.ForeignKey(SupplyArea)
    description = models.TextField()
    rate_level = models.CharField(max_length=2,choices=RATE_LEVEL_CHOICES,)
    rate_per_1k_gallons = models.DecimalField(max_digits=10,decimal_places=2) 
```

然后，我在我的 views.py 中创建了将处理来自表单的请求的视图（在我的情况下是 ajax 和常规表单）。除了“业务逻辑”，在我的例子中是“traffic_calc()”

```
def tariff(request):
    if request.method == 'POST':
        form = TariffForm(request.POST)
        if form.is_valid():
            gallons = form.cleaned_data['gallons']
            gallons = int(gallons)
            area_id = form.cleaned_data['tariff']
            area = area_id.name
            usage = tarrif_calc(request, area_id, gallons)    
            response_dict = {'gallons': gallons,'area': area,'usage': usage}
            if request.is_ajax():
                return HttpResponse(simplejson.dumps(response_dict), mimetype='application/json')
            return render_to_response('rates/tariff_form.html', response_dict)
    else:
        form = TariffForm()
    return render_to_response('rates/tariff_form.html', {'form': form})

def tarrif_calc(request, area, gallons):
    r_levels = gallons//1000
    remainder = gallons%1000
    usage = 0
    i = 1

    if r_levels < 1:
        rate = Rate.objects.get(area_of_supply=area,rate_level=1)
        usage = rate.rate_per_1k_gallons    
    else:
        if r_levels >= 8:
            while i <= 9:
                rate = Rate.objects.get(area_of_supply=area,rate_level=i)
                usage += rate.rate_per_1k_gallons
                i += 1

            if gallons > 9000:
                remainder = gallons - 9000
            remainder_rate = Rate.objects.get(area_of_supply=area,rate_level=9)
            usage += remainder * remainder_rate.rate_per_1k_gallons/1000
            usage = round(usage,2)
        else:    
            while i <= r_levels:
                rate = Rate.objects.get(area_of_supply=area,rate_level=i)
                usage += rate.rate_per_1k_gallons
                i += 1
            remainder_level = r_levels+1
            if remainder_level >= 9:
                remainder_rate = Rate.objects.get(area_of_supply=area,rate_level=9)
            else:
                remainder_rate = Rate.objects.get(area_of_supply=area, rate_level=remainder_level)    
                usage += remainder * remainder_rate.rate_per_1k_gallons/1000
                usage = round(usage,2)
    return usage 
```

我同意@TokenMacGuy .. 我应该可能使用 GET，但我想使用 POST，因为如果 js 不可用，常规形式也可以工作。我也同意在这个级别上@TokenMacGuy 可能只是从视图中导入关税计算并在他的 forms.py 中使用它。

然后我创建了必要的表单和模板以及处理 ajax 发布的 javascript（尽管不是必需的）

```
// JavaScript Document
$(document).ready(function()    {

$('#tariff_form').submit(function(event){
    event.preventDefault();  // stop the form from submitting and refreshing the page
    var form = this;               // in jQuery, this refers to the current element, which is #article_form

    // grab each form value
    var data = {};
    gallons = $('#id_gallons').val();
    tariff = $('#id_tariff').val();

    // now send the data to the server via AJAX
    if(gallons && tariff)
    {
        $.ajax({
            type: "POST",
            url: "/tariff-calculator/",
            data: "gallons="+gallons+"&tariff="+tariff,
            dataType: "json",
            success: function(json){
                $('#gallons_cont').html(json['gallons']);
                $('#area_cont').html(json['area']);
                $('#usage_cont').html(json['usage'])
                $('#results_json').show('slow');            
            },
            });
    }
    else
    {
        alert('Please Fill All Fields')
    }
}); 

}); 
```

我猜这两种方法都很相似并且都有效（虽然我没有尝试过@TokenMacGuy），除了关税_calc（）函数，似乎MackGuy解决了这个问题，所以我会奖励他正确的答案，虽然我会更喜欢关于 forms.py 中业务逻辑的反馈，因为我不完全相信，或者认为存在巨大差异。

# sql-server-2005 - 为什么我不能在多个环境中同时打开相同的数据库文件 (.mdbs)？

> ID：827944
> 
> 赞同：0
> 
> 时间：2009-05-06T03:47:31.600
> 
> 标签：sql-server-2005, linq-to-sql

这种很烂 如果我通过 VS.Net 的服务器资源管理器连接到 SQL Server DB（.mdb 文件），那么我无法通过 SQL Server 2008 Management Studio 在同一个文件中连接到同一个文件。文件被锁定。

例如，我从 SQL Server Management Studio 收到以下错误

> CREATE FILE 在尝试打开或创建物理文件“C:\SQL Server 2000 Sample Databases\NORTHWND.MDF”时遇到操作系统错误 32（该进程无法访问该文件，因为它正被另一个进程使用。）。（Microsoft SQL Server，错误：5123）

我正在玩 LINQ to SQL。所以你需要连接到 VS.Net 服务器资源管理器来拖入你的表对象并创建 .dbml 文件。但是，如果我想使用管理工作室的老派 SQL 查询数据库，我不能......我收到上述错误。如果我尝试使用 LINQPad 连接（很棒的工具......但由于这个令人讨厌的文件锁定而无用），也是如此。

那么有没有人知道我如何同时从多个程序（如 VS.Net 的服务器资源管理器、SQL Server 的管理工作室和 LINQPad）连接到同一个 .mdb 文件？

谢谢！

顺便说一句，这个网站简直太棒了，我喜欢他们在 ASP.Net 中制作它并使用 LINQ to SQL 进行数据访问的事实......好吧，跑题了。对不起。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T03:58:01.230

一旦连接到该文件，sql 引擎将锁定该文件。没有什么能阻止您将文件附加到 SQL Server 实例，然后从多个应用程序连接到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T07:04:44.153

线索在名称“SQL **Server** ”中 - 似乎您不能将数据库附加到两个地方，这并非完全不合理，因为您不能提供两次服务（假设服务器负责事务、日志等事务） ，锁定等）。

所以...

您想在 SQL Server 实例中“运行”数据库，然后从 Visual Studio 连接到该实例，然后连接到文件，而不是直接打开文件（该选项存在，因为它简化了一些部署模型）此时您应该得到你需要的。

顺便说一句，完全有可能从 Visual Studio 中使用“老派 SQL”——尽管我不知道与 LinqPad 等效

# configuration - 加密 log4net AdoNetAppender 使用的 connectionString

> ID：827945
> 
> 赞同：4
> 
> 时间：2009-05-06T03:47:44.283
> 
> 标签：configuration, log4net

我想加密 log4net [AdoNetAppender](http://logging.apache.org/log4net/release/sdk/log4net.Appender.AdoNetAppender.ConnectionString.html)使用的连接字符串。

这可以在不加密整个附加程序的情况下完成吗？

[Dion Olsthoorn](http://weblogs.asp.net/drnetjes/archive/2005/02/16/374780.aspx)写了关于在代码中设置连接字符串的博客，但我更喜欢在专用于日志记录的配置文件中进行，因为它将使用与应用程序的其余部分不同的数据库。

[以下是来自http://logging.apache.org/log4net/release/sdk/log4net.Appender.AdoNetAppender.html](http://logging.apache.org/log4net/release/sdk/log4net.Appender.AdoNetAppender.html)的示例配置

```
<appender name="AdoNetAppender_SqlServer" type="log4net.Appender.AdoNetAppender">
  <connectionType value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
  <connectionString value="data source=SQLSVR;initial catalog=test_log4net;integrated security=false;persist security info=True;User ID=sa;Password=sa" />
  <commandText value="INSERT INTO Log ([Date],[Thread],[Level],[Logger],[Message]) VALUES (@log_date, @thread, @log_level, @logger, @message)" />
  <parameter>
    <parameterName value="@log_date" />
    <dbType value="DateTime" />
    <layout type="log4net.Layout.PatternLayout" value="%date{yyyy'-'MM'-'dd HH':'mm':'ss'.'fff}" />
  </parameter>
  <parameter>
    <parameterName value="@thread" />
    <dbType value="String" />
    <size value="255" />
    <layout type="log4net.Layout.PatternLayout" value="%thread" />
  </parameter>
  <parameter>
    <parameterName value="@log_level" />
    <dbType value="String" />
    <size value="50" />
    <layout type="log4net.Layout.PatternLayout" value="%level" />
  </parameter>
  <parameter>
    <parameterName value="@logger" />
    <dbType value="String" />
    <size value="255" />
    <layout type="log4net.Layout.PatternLayout" value="%logger" />
  </parameter>
  <parameter>
    <parameterName value="@message" />
    <dbType value="String" />
    <size value="4000" />
    <layout type="log4net.Layout.PatternLayout" value="%message" />
  </parameter>
</appender> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T04:07:43.757

我已经能够通过从 log4net AdoNetAppender 继承并添加一个名为 ConnectionStringName 的属性来解决这个问题。

如果设置了此项，它将从 web.config 连接字符串中读取连接字符串并将其传递给底层 AdoNetAppender。

我仍然热衷于将所有日志记录配置保存在一个文件中并仍然允许加密连接字符串的解决方案。

```
 public class ConfigAdoNetAppender : AdoNetAppender
    {
        public string ConnectionStringName
        {

            set
            {
                this.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings[value].ToString();
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:49:02.443

当前源已经具有完全符合您要求的 ConnectionStringName 属性。

ConnectionStringName 属性是在[修订版 607748](http://svn.apache.org/viewvc?view=rev&revision=607748)中引入的。版本 1.2.10 是[修订版 395324](http://svn.apache.org/viewvc/logging/log4net/tags/log4net-1.2.10/)，与此相比相当旧。

如果您习惯使用未发布的代码，您可以获取最新的源代码并自己编译。您可能还可以获得更新的 AdoNetAppender 类，尽管它可能依赖于 log4net 核心的其他更新。

# cocoa - NSWindows 的“启动时可见”的编程等效项

> ID：827946
> 
> 赞同：6
> 
> 时间：2009-05-06T03:49:40.253
> 
> 标签：cocoa

我正在尝试编写我已设置的包含两个窗口的 nib 文件的编程等效项：主窗口和启动后出现以提示输入凭据的工作表。只要记得取消选中工作表/窗口上的“启动时可见”框，在 IB 中将这些连接起来就可以正常工作。

但是我无法弄清楚“启动时可见”的 API 等效项是什么。当我使用编程版本运行我的应用程序时，工作表被分离，而不是键视图，就像我的应用程序在“启动时可见”被选中时使用笔尖运行的方式一样。所以我的假设是，我错过了启动时可见的秘密酱汁。

有谁知道如何做到这一点？

PS 我知道如何在 IB 中完成这项工作，我特别想找出等效的代码，所以请不要告诉我只使用 nib。我知道。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T04:10:54.227

NSWindows 通常是隐藏的。所以你不应该做任何事情；只是在你需要它之​​前不要显示窗口。这是一个简单的例子。

```
NSWindow *sheetWindow = [[NSWindow alloc] initWithContentRect:NSMakeRect(0, 0, 100, 100) styleMask:NSTitledWindowMask backing:NSBackingStoreBuffered defer:NO];
NSTextField *field = [[NSTextField alloc] initWithFrame: NSMakeRect(25, 25, 50, 50)];
[[sheetWindow contentView] addSubview:field];
[NSApp beginSheet:sheetWindow modalForWindow:[self window] modalDelegate:self didEndSelector:@selector(sheetDidEnd:) contextInfo:NULL]; 
```

当我运行上述内容时，文本字段获得了键盘焦点。

将来，请在这种情况下提供代码 - 更正现有代码比编写新代码容易得多。

# regex - 修改正则表达式以匹配 .java 和 .mm 文件

> ID：827948
> 
> 赞同：0
> 
> 时间：2009-05-06T03:53:23.207
> 
> 标签：regex, linux, grep

我正在尝试使用[cscope-in​​dexer](http://www.opensource.apple.com/darwinsource/Current/cscope-13/cscope/contrib/xcscope/)脚本。但我想知道如何将以下内容更改为包含`*.mm`和`*.java`文件？

```
egrep -i '\.([chly](xx|pp)*|cc|hh)$' | \
sed -e '/\/CVS\//d' -e '/\/RCS\//d' -e 's/^\.\///' | \
sort > $LIST_FILE 
```

我试过了

```
egrep -i '\.([chly](xx|pp)*|cc|hh|mm|java)$' 
```

这没用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T04:01:32.643

尝试：

```
egrep -i '\.([chly](xx|pp)*|cc|hh|mm|java)$' | \
sed -e '/\/CVS\//d' -e '/\/RCS\//d' -e 's/^\.\///' | \
sort > $LIST_FILE 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T04:12:07.220

当您在原始正则表达式中看到 [chly] 时，它的意思是“'c'、'h'、'l' 或 'y'。当将其更改为“chly*”时，它现在的意思是“chl " 后跟任意数量的 y。此外，当您从第一个句点前面删除 '\' 时，您将其含义从“匹配句点”更改为“匹配任何字符之一”。

有关正则表达式的更多信息，请查看[Perl 正则表达式指南](http://www.perl.com/doc/manual/html/pod/perlre.html)，因为 Perl 几乎发明了正则表达式。

# c# - C# - 需要改进一段代码的建议

> ID：827950
> 
> 赞同：0
> 
> 时间：2009-05-06T03:57:01.170
> 
> 标签：c#, performance, list, dictionary

我有一个函数，它接收三个不同的“人”对象并根据“人”对象中的组合值生成一个新的“兼容性”对象。

然而，它作为输入接收的三个“人”对象大约有 1/3 的时间与之前的对象相同，尽管顺序可能不同。在这些情况下，我不想创建一个新的“分数”对象，而只是返回一个包含在现有对象中的值。

最初，程序只是循环遍历“兼容性”对象的列表<>，搜索属于这三个“人”的对象（因为每个“兼容性”对象都包含一组人员对象）。考虑到有超过数千个“兼容性”对象和超过一百万个“人”对象，这种方法真的很慢。

我有使用字典的想法，其中键是我通过使用 XOR 将三个人对象的 id 值组合到单个 UInt64 中生成的数字，并将分数对象存储为字典值而不是列表。这将时间减少了大约一半，并且在时间性能方面是可以接受的，但是有太多的碰撞，并且它经常返回错误的分数。

任何建议或指示将不胜感激。

编辑：要添加到原始问题，每个“人”对象都有一堆我可以使用的其他字段，但问题是制作一个唯一且可交换的键。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T04:05:01.510

我认为您正在以一种过于复杂的方式看待事物。获取 3 个 PersonID 值并对其进行排序，以便它们始终处于相同的顺序，无论它们是按什么顺序传递的。然后使用三个 PersonID 作为键在哈希表中设置一个值，用连字符或一些分隔符分隔不会出现在 PersonID 值中的其他字符。然后稍后，检查哈希表中是否有具有该键的值。

因此，如果三个 PersonID 是 10、5 和 22，则哈希键可能类似于“5-10-22”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:05:19.013

在按预定顺序对三重奏进行排序后，通过连接 objectids 创建密钥。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T04:04:06.660

您最好的选择是自定义`IEqualityComparer`课程。`Dictionary`像这样声明你

```
Dictionary<List<People>, Compatability> people = 
    new Dictionary<List<People>, Compatability>(new PersonListComparer()); 
```

您需要创建一个`PersonListComparer`实现`IEqualityComparer<List<People>>`. 您需要实现两种方法，一种获取哈希码，另一种比较相等。将`Dictionary`用于`GetHashCode`确定两个列表是否可能相等，以及`Equals`确定它们是否实际相等的方法（换句话说，哈希码很快但可能给出误报但绝不会误报）。使用您现有的散列算法（XOR）`GetHashCode`，然后在`Equals`方法中显式地比较两个列表。

这应该可以解决问题！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T04:04:08.610

为什么不使用人名作为字典键呢？（首先对名称进行排序，因此传递顺序无关紧要。）IE、John、Alice 和 Bob 变成类似 my_dictionary["Alice_Bob_John"] <- 如果该键存在，则您已经计算了分数，否则，你需要计算它。作为我上面的字符串破解的替代方法，您实际上可以使用一个结构：

```
NameTriple n = new NameTriple("John", "Alice", "Bob");
// NameTriple internally sorts the names.
my_dictionary[n] ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T04:06:40.413

如果您想将所有内容保存在内存中而不使用数据库，我建议您使用类似于树结构的东西。假设您的对象 ID 是可排序的并且顺序无关紧要，您可以使用嵌套字典来完成此操作。

也就是说， a`Dictionary<Key, Dictionary<Key, Dictionary<Key, Compatibility>>>`应该做的伎俩。对 ID 进行排序，并使用外部字典中的最小值、下一个中的下一个值和最终值来查找兼容性对象。这样，就不会发生冲突，并且查找应该很快。

或者，现在我再想一想，这不必那么复杂。只需使用字符串作为键并将 ID 按排序顺序用“！”连接在一起 或其他在 ID 中不会自然出现的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T04:12:29.667

假设所有“Person”对象都是唯一的，在对象中存储一个 UUID。

在您的函数中静态存储四边形 (P1,P2,P3,V)，其中 P1,P2,P3 是 Person 对象的 UUID，已排序（以避免排序问题），而 V 是先前计算的结果。

然后你的函数检查是否有这个三元组的条目，如果没有，它会完成工作并存储它。

您可以将 (P1,P2,P3,V) 值存储在字典中，只需键入三个 P 值的一些哈希值

# flash - 如何计算 Box2D 中的承重？

> ID：827963
> 
> 赞同：1
> 
> 时间：2009-05-06T04:04:12.510
> 
> 标签：flash, actionscript-3, box2d

我正在使用 Box2D（AS3/Flash 版本，如果重要的话），我正在尝试计算每个身体承载的重量。

我知道如何遍历所有物体，也知道如何轮询碰撞检测例程，但似乎一旦施加重量，碰撞力就会消失为零。我忽略了某种“总静力”属性吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T01:35:01.097

使用可选的 contactListener 对象中的 contactResult 类型，您可以轮询每个项目的 normalForce 以找出正在向对象施加的力（本质上包括重量）。

请注意，睡着的物体（例如静止的堆栈）不会触发contactResults，但如果您关闭睡眠或只想在运动发生时测量力，它应该可以正常工作。

有关如何实现 contactListener 类的信息，请查看文档。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T07:25:25.320

自从我玩 Box2D 以来已经有一段时间了，但是您是否尝试过对感兴趣的事情轮询[GetReactionForce() ？](http://www.kyucon.com/doc/box2d/Box2D/Dynamics/Joints/b2Joint.html#GetReactionTorque())

我知道，当我进行桥梁模拟并且希望桥梁根据其上的重量而断裂时，我轮询[了 GetReactionForce()](http://www.kyucon.com/doc/box2d/Box2D/Dynamics/Joints/b2Joint.html#GetReactionTorque())，如果它高于某个阈值，那么我删除了连接两个主体的关节。

# vb.net - 在 VB .NET 2008 Winform Listview 中禁用复选框选择

> ID：827982
> 
> 赞同：0
> 
> 时间：2009-05-06T04:13:33.830
> 
> 标签：vb.net, winforms, visual-studio-2008, .net-3.5, listview

如何在不牺牲 ListView 功能的情况下禁用其他复选框选择/取消选择？我知道您可以调用：ListView.Enabled = False，但这也会禁用其中的任何滚动。

例如：我有一个计时器，它根据检查的 Listview 项目启动备份。一段时间后，我不希望最终用户能够单击列表视图中的任何复选框（因此我有一定数量的要备份的项目），但我确实希望它们能够滚动执行备份时的列表。我试过这个：

```
Private Sub clboxOptions_ItemChecked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ItemCheckedEventArgs) Handles clboxOptions.ItemChecked

If backupStarted = True Then
   If e.Item.Checked = True Then
      e.Item.Checked = False
   Else
      e.Item.Checked = True
End If 
```

但这似乎对我不起作用。谢谢！联合部队

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2017-01-02T14:47:36.553

这是禁用用户单击 listviewitem 复选框的另一种方法。

```
 Public Sub ChangeItemCheckState(ByVal val As Boolean, ByVal index As Integer)
    If Monitor.TryEnter(Me.Items(index), 10) Then
        Try
            Me.Items(index).Checked = val

        Finally
            Monitor.Exit(Me.Items(index))
        End Try
    End If
End Sub

Public Sub ChangeItemCheckState(ByVal val As Boolean, ByVal item As ListViewItem)
    If Monitor.TryEnter(item, 10) Then
        Try
            item.Checked = val
        Finally
            Monitor.Exit(item)
        End Try
    End If
End Sub

Private Sub ListviewOPC_ItemCheck(sender As Object, e As ItemCheckEventArgs) Handles Me.ItemCheck
    If Monitor.IsEntered(Me.Items(e.Index)) Then
        '
    Else
        'prevent click from users
        e.NewValue = e.CurrentValue
    End If
End Sub 
```

这种方法是线程安全的。要更改项目的检查状态，您必须调用 ChangeItemCheckState 方法。如果要通过单击启用/禁用 itemcheck，则必须添加另一个属性。

```
Private disableUserCheckItem As Boolean
Public Property PreventUserCheckItem() As Boolean
    Get
        Return disableUserCheckItem
    End Get
    Set(ByVal value As Boolean)
        disableUserCheckItem = value
    End Set
End Property

 Public Sub ChangeItemCheckState(ByVal val As Boolean, ByVal index As Integer)
    If Monitor.TryEnter(Me.Items(index), 10) Then
        Try
            Me.Items(index).Checked = val
        Finally
            Monitor.Exit(Me.Items(index))
        End Try
    End If
End Sub

Public Sub ChangeItemCheckState(ByVal val As Boolean, ByVal item As ListViewItem)
    If Monitor.TryEnter(item, 10) Then
        Try
            item.Checked = val
        Finally
            Monitor.Exit(item)
        End Try
    End If
End Sub

Private Sub ListviewOPC_ItemCheck(sender As Object, e As ItemCheckEventArgs) Handles Me.ItemCheck
    If Monitor.IsEntered(Me.Items(e.Index)) Then
        'do nothing or other nessesary things.
    Else
        'prevent click from users
        If PreventUserCheckItem Then
            e.NewValue = e.CurrentValue
        End If
    End If
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T12:33:35.033

您可以自己绘制复选框，而不是使用内置的 CheckBoxes 属性。

谷歌搜索并找到一个 OwnerDraw ListView 的示例。自己画复选框。向您的 ListView 添加一个新属性（类似于 ReadOnly）。当 ReadOnly 为 true 时，将复选框绘制为禁用并忽略单击消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T06:59:24.860

您可以使用[ObjectListView](http://objectlistview.sourceforge.net)（它是普通 .NET ListView 的包装器）。它提供了一个回调 CheckStatePutter，当用户单击一个复选框时会调用该回调。在该回调中，您可以决定是否接受新的复选框值。

这是描述此过程的配方：[如何在我的 ObjectListView 中使用复选框？](http://objectlistview.sourceforge.net/cs/recipes.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T14:45:35.173

我发现我的问题是什么。我使用的是*“ItemChecked”*而不是*“ItemCheck”*方法。下面的代码对我有用：

```
Private Sub clboxOptions_ItemCheck(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles clboxOptions.ItemCheck
    Try
        If backupStarted = True Then
            If e.CurrentValue <> e.NewValue Then
                e.NewValue = e.CurrentValue
            Else
                e.NewValue = e.NewValue
            End If
        End If
End Sub 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-04T07:59:29.867

我想在 Listview 中禁用 CheckBox。当我单击 Button Go 时。我使用的是“ItemChecked”方法。我使用以下代码：

```
Public Sub CheckBoxChecked(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckedEventArgs)
    Try
        If bCheckFromEvent Then
            bCheckFromEvent = False
            Return
        End If
        If BrunService Then
            bCheckFromEvent = True
            ListView.Items(e.Item.Index).Checked = Not ListView.Items(e.Item.Index).Checked
        End If

    Catch ex As Exception
            MsgBox("CheckBoxChecked: " & ex.Message, MsgBoxStyle.Critical Or MsgBoxStyle.OkOnly, "ERROR")
    End Try

End Sub 
```

# sql-server - 支持 DTS 的 Microsoft SQL 服务器托管

> ID：827985
> 
> 赞同：2
> 
> 时间：2009-05-06T04:15:42.077
> 
> 标签：sql-server, hosting, dts

有人可以建议一个支持 DTS 包的共享 SQL Server 解决方案吗？

**更新：** 我希望使用 PostgreSQL ODBC 驱动程序和 DTS 包来保持 MSSQL 服务器和 Postgres 之间的数据同步。在获得 SQL Server 2005 并尝试执行此操作后，我意识到 SSIS 似乎不能很好地与 PostgreSQL ODBC 驱动程序配合使用。

我放弃了 SSIS/DTS 解决方案，并使用 JDBC 编写了一个程序，该程序可以在我的 Linux 服务器上愉快地运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T05:31:14.277

我不知道有任何托管服务提供 DTS 或 SSIS 作为一项功能。但是，如果您试图通过使用 DTS/SSIS 来实现自己的备份/数据传输，那么我建议您查看[Microsoft SQL Server Database Publishing Services](http://www.codeplex.com/sqlhost/)。[Go Daddy 支持它](http://help.godaddy.com/article/3435)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T14:43:41.470

我之前使用过[Edgewebhosting](http://www.edgewebhosting.net/)并使用 DTS 包将数据推送到站点。我与他们没有任何关系，它对这份工作很有效。

# c - 为什么这段代码不在 C 中分配内存？

> ID：827986
> 
> 赞同：0
> 
> 时间：2009-05-06T04:15:44.293
> 
> 标签：c, memory, hashtable, allocation

更新的问题在这里

[HashTable中的内存分配问题](https://stackoverflow.com/questions/828108/please-help-me-to-solve-this-memory-allocation-problem)

我正在用 C 制作一个 HashTable。这就是我所做的。我想我正走在正确的道路上，但是当我试图

**主程序**

```
HashTablePtr hash;
hash = createHashTable(10);
insert(hash, "hello");
insert(hash, "world"); 
```

**哈希表.c**

```
 HashTablePtr createHashTable(unsigned int capacity){
    HashTablePtr hash;
    hash = (HashTablePtr) malloc(sizeof(HashTablePtr));
    hash->size = 0;
    hash->capacity = capacity;
    ListPtr mylist = (ListPtr)calloc(capacity, sizeof(ListPtr)); /* WHY IT DOESN'T ALLOCATE MEMORY FOR mylist HERE?? */
    mylist->head = NULL;
    mylist->size = 0;
    mylist->tail = NULL;    
    hash->list = mylist;  
    return hash; 
```

ListPtr 是一个 LinkedList ptr

**列表.h**

```
typedef struct list List;
typedef struct list * ListPtr;

struct list {
    int size;
    NodePtr head;
    NodePtr tail;
};
...
... 
```

**哈希表.h**

```
 typedef struct hashtable * HashTablePtr;
    typedef struct hashtable HashTable;
    struct hashtable {
        unsigned int capacity;
        unsigned int size;
        ListPtr *list;
        unsigned int (*makeHash)(unsigned int, void *);
    };
...
... 
```

当我运行调试器时，我看到没有分配给 myList 的内存。在上面的示例中，我的尝试是使其成为 10 个列表的数组。

请帮我解决这个问题。

如果有帮助的话，我不是 C 方面的专家。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T12:18:29.063

就我个人而言，我不是使用 typedef 的超级粉丝，尤其是当您是初学者时。我认为这可能是让你感到困惑的部分原因。你最好避免这样的事情：

```
typedef struct hashtable * HashTablePtr; 
```

使用过多的 typedef 将使您的代码更难阅读，因为您也需要不断地查找它们所指的内容。

主要问题是您为哈希表/列表指针的大小分配内存，而不是为它们所尊重的结构的大小分配内存。我认为下面的代码很好地说明了这一点。您还需要检查您的分配是否有效。如果是 malloc、calloc、realloc。等失败他们返回NULL。如果发生这种情况并且您没有检查这种情况，您将收到一个段错误并且您的程序将崩溃。

还要遵循 c99 标准，并将所有变量声明放在函数的开头。

[c99标准](http://www.open-std.org/JTC1/SC22/wg14/www/docs/n1124.pdf)

[malloc 手册页](http://www.poplog.org/docs/popdocs/pop11/unix/malloc)

```
struct hashtable *
createHashTable(unsigned int capacity){
    struct hashtable *hash;
    struct list *mylist;

    /* You want to allocate size of the hash structure not the size of a pointer. */
    hash = malloc(sizeof(struct hashtable)); 
    // always make sure if the allocation worked.
    if(hash == NULL){
        fprintf(stderr, "Could not allocate hashtable\n");
        return NULL;
    }

    hash->size = 0;
    hash->capacity = capacity;

    /* Unless you need the memory to be zero'd I would just use malloc here
     * mylist = calloc(capacity, sizeof(struct list)); */
    mylist = malloc(capacity * sizeof(struct list));
    if(mylist == NULL){
        fprintf(stderr, "Could not allocate list\n");
        free(hash); /* free our memory and handle the error*/
        return NULL;
    }

    mylist->head = NULL;
    mylist->size = 0;
    mylist->tail = NULL;    
    hash->list = mylist;

    return hash;
} 
```

还记得在释放哈希表之前释放你的列表：

```
free(myhash->list);
free(myhash); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T04:21:07.477

```
calloc(capacity, sizeof(ListPtr) 
```

应该

```
calloc(capacity, sizeof(List) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T04:23:01.157

我认为这里有很多问题。你没有包括你得到的错误，我将列出几个：

*   哈希 = (HashTablePtr) malloc(sizeof(HashTablePtr*)); - 你正在分配一个HashTable **的大小，也就是四个字节，你需要分配底层对象的大小。
*   ListPtr mylist = (ListPtr* )calloc(容量, sizeof(ListPtr)); - 同样，您正在分配指针的大小而不是基础列表对象。
*   HashTablePtr createHashTable(unsigned int capacity)){ - 你可能会因为额外的括号和参数数量不一致而出现编译错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T04:20:22.300

您正在分配一个连续的 ListPtr 块，但您实际上想要为所有结构分配空间，而不仅仅是指向这些结构的指针 (ListPtr)：

```
calloc(capacity, sizeof(List)); 
```

我同意 gman 关于不隐藏指针的评论。在 C 中编码时，我从不将 a 输入`List *`为`ListPtr`. 它使代码更难理解。

# asp.net-mvc - mvc - 下拉列表未在编辑视图中正确填充

> ID：827987
> 
> 赞同：3
> 
> 时间：2009-05-06T04:15:56.180
> 
> 标签：asp.net-mvc, selectlist

我正在构建我的第一个 MVC 应用程序，并遵循了“NerdDinner”教程。但是，在以相同方式从 SelectList 创建下拉列表时，我遇到了问题。

出于某种原因，当我打开“编辑”视图时，下拉列表未显示正确的选择，即使数据在数据库中以其他方式设置并且“详细信息”视图显示了正确的值。每个人都只是想出列表中的第一个值。

我已经逐段浏览了 NerdDinner 代码，但我一生都看不到任何区别，但是该应用程序将在编辑时正确显示带有当前值的下拉列表，而我的却没有。

有人对从这里去哪里有建议吗？如果有人要求特定的东西，我可以发布代码片段。

**更新：**

在字段集中：

```
 <p>
            <label for="Parking">Parking Arrangement:</label>
            <%= Html.DropDownList("Parking", Model.Parking)%>
            <%= Html.ValidationMessage("Parking", "*") %>
        </p> 
```

编辑动作：

```
 //
    // GET: /Buyer/Edit/2
    public ActionResult Edit(int id)
    {
        Buyer_Profile buyer_profile = buyerRepository.GetBuyerProfileByID(id);

        if (buyer_profile == null)
            return View("NotFound");
        else if (!buyer_profile.IsOwnedBy(User.Identity.Name, id))
            return RedirectToAction("Index", "Home");
        else
            return View(new BuyerFormViewModel(buyer_profile));
    } 
```

以他们为 NerdDinner 示例构建它的相同方式，我创建了一个“...FormViewModel”：

```
public class BuyerFormViewModel
{
    // Properties
    public Buyer_Profile Buyer_Profile { get; private set; }
    public SelectList Parking { get; private set; }

    // Constructor
    public BuyerFormViewModel(Buyer_Profile buyer_profile)
    {
        Buyer_Profile = buyer_profile;
        Parking = new SelectList(BuyerProfileOptions.Parking, Buyer_Profile.Parking);
    }
} 
```

当值已显示在详细信息视图中并存储在 d/b 中时，单击“编辑”时生成的 HTML：

```
<p>
  <label for="Parking">Parking Arrangement:</label>
  <select id="Parking" name="Parking"><option>No Preference</option>
  <option>On Street</option>
  <option>Assigned Street</option>
  <option>Open Garage</option>
  <option>Covered Garage</option>
  </select>                
</p> 
```

相同表单中的文本字段的值已正确填充。只是所有的下拉菜单都没有！

非常感谢您的关注。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T02:59:00.220

嗯。看来 htmlhelper 太好了。我删除了对模型的引用，一切正常！

IE

```
 <%= Html.DropDownList("Parking", Model.Parking)%> 
```

变成

```
 <%= Html.DropDownList("Parking")%> 
```

我们是金色的。ViewData 是否包含称为“停车”的东西，因为我在模型中引用它，所以它压扁了另一个值......或什么......？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-14T09:53:52.810

给人们的快速提示 - 当他们需要下拉列表时，不要将任何模型属性命名为“标题”。该框架将与视图标题混淆并且无法工作 - 我花了整整一个下午的时间来解决这个问题。需要睡在上面才能意识到发生了什么。

# windows - 何时以及为何使用 CoLoadLibrary？

> ID：827988
> 
> 赞同：1
> 
> 时间：2009-05-06T04:16:26.287
> 
> 标签：windows, com, interop, com-interop

CoLoadLibrary() 的描述说它与 LoadLibraryEx() 几乎相同 - 将 DLL 加载到进程中。COM 类创建函数 - CoCreateInstance() 和 CoGetClassObject() - 也都将必要的 DLL 加载到进程中。

那么为什么首先需要 CoLoadLibrary() 以及应该如何使用它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T08:22:48.053

看一下代码：

```
mov     edi,edi
push    ebp
mov     ebp,esp
push    8
push    0
push    dword ptr [ebp+8]
call    dword ptr [ole32!_imp__LoadLibraryExW (71eb1214)]
pop     ebp
ret     8 
```

所以它只是调用：

```
LoadLibraryEx( FileName, NULL, LOAD_WITH_ALTERED_SEARCH_PATH ). 
```

据推测，该例程的存在只是为了向后兼容——它可能起源于 Win16。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T13:51:36.373

也许如果您正在编写自己的 regsvr32.exe？但是 JP 的反汇编并不能真正支持我的猜测，因为你可以使用 LoadLibraryEx 代替。也许在过去，微软计划有一天以不同于常规 DLL（D-COM？）的方式加载 COM DLL，因此这是确保*未来*兼容性的一种方式。

# cryptography - Skein 作为散列的安全性是否意味着 Threefish 作为块密码的安全性？

> ID：827989
> 
> 赞同：4
> 
> 时间：2009-05-06T04:17:12.683
> 
> 标签：cryptography, theory, sha-3, skein

为 SHA-3 提议的[Skein 散列](http://www.schneier.com/skein.html)拥有一些令人印象深刻的速度结果，我怀疑这将适用于 Threefish 块密码的核心 - 但是，如果 Skein 被批准用于 SHA-3，这是否意味着 Threefish 也被认为是安全的? 也就是说，Threefish 中的任何漏洞是否意味着 SHA-3 中的漏洞？（因此，缺乏已知问题和对 SHA-3 的普遍信任对 Threefish 来说也是如此）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-09T08:39:13.907

没有。Skein 的安全性并不意味着 Threefish 的安全性。积极地说，如果有人发现 Threefish 的弱点，那么这并不意味着 Skein 也没有安全感。

然而，这个问题也很有趣，它也适用于其他哈希函数。Skein 使用经过一些修改的 Davis-Meyer 结构。MD5、SHA1 和许多其他哈希函数也使用这种 Davis-Meyer 结构，因此它们原则上基于分组密码。就在 MD5 或 SHA1 的情况下，分组密码没有名称，而且我不知道有多少关于这些结构的适用性的研究。

一个好的分组密码和一个好的散列函数的要求是不同的。稍微简化一下，如果 E 是一个分组密码并且找到两个密钥 K, K' 和两个消息 M, M' 使得 E [K] (M) xor M = E [K'] (M') xor M' 是不可行的，那么E 适用于使用 Davis-Meyer 构造散列函数。但是要作为分组密码 E 安全，需要其他属性。E 必须抵抗选择密文攻击、选择明文攻击等。

此外，如果 E 是一个好的分组密码，那么这也不意味着它给出了一个好的散列函数。微软不得不通过他们在 XBOX 中使用的哈希来艰难地学习这一点。此散列基于块密码 TEA，它的弱点对于块密码来说是微不足道的，但在用于散列函数时被证明是致命的。

公平地说，作为一个好的分组密码和适合散列函数之间存在一些关系。例如，在这两种情况下都需要避免差异攻击。因此，一些用于构造好的分组密码的设计方法可以用来构造好的散列函数。

我还要补充一点，SHA-3 的一些提议是基于 AES 的。到目前为止，我还没有看到太多支持基于 AES 的哈希函数，因为 AES 已经是一个标准。这些散列函数的分析与任何其他 SHA-3 提案一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T04:30:37.953

忽略我之前的回答。我误解了 Skein 和 Threefish 之间的关系。我仍然不认为 Skein 获得批准绝对证明 Threefish 通常是安全的（Threefish 可能仅在以特定方式使用时才是安全的），但这将是一个迹象。

# tfs - 您可以检索整个解决方案的特定标记版本吗？

> ID：827992
> 
> 赞同：0
> 
> 时间：2009-05-06T04:18:35.050
> 
> 标签：tfs

我对 TS 非常陌生，对我来说并不明显。在我看来，它必须在那里。有人可以指出如何用版本号或标签标记整个解决方案，然后从存储库中检索该特定版本吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T08:23:54.837

应用标签并不是最容易找到的事情。您可以通过在源代码管理资源管理器窗口中右键单击包含解决方案文件的文件夹来访问它（您可以通过双击团队资源管理器中的源代码管理节点来访问它）。应用标签时，将其应用到包含您希望包含在标签中的内容的文件夹。然后确保下一个屏幕向您显示该文件夹的内容（即您要标记的所有文件）

在 TFS 中，标签有点像标签。它实际上是可以编辑的，如果你真的需要，你可以在其中包含不同版本的文件。

TFS 中还有“变更集”的概念。变更集是在特定服务器（或 TFS2010 中的项目集合）上始终递增的数字。该数字代表该服务器实例的唯一时间点。

要从特定版本获取文件，请在解决方案资源管理器中右键单击您的解决方案并执行“获取特定版本...”在版本组框中，您可以将类型从默认的最新版本更改为指定变更集、日期或标签如果您想从较旧的时间点获取版本。

希望有帮助。

马丁。

# compiler-construction - 环裂变是否在单核中工作？

> ID：827993
> 
> 赞同：1
> 
> 时间：2009-05-06T04:18:53.363
> 
> 标签：compiler-construction, compiler-optimization, compiler-development

如果我为单核处理器编译，什么时候使用循环裂变/分布有意义？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T04:22:20.143

性能明智？不，它几乎肯定会引入开销。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T19:40:13.000

有关标准答案，请参阅 comp.compilers。

除此之外，如果其中一个迭代可能会阻塞，我可能会想到一个奇怪的案例。（例如动态内存分配）

请注意，这种情况更多的是“滥用”简单的语言“并行”而不是真正的数字原因。（使用“for”比手动使用线程更容易，即使 FOR 等待所有线程完成）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-07T21:42:24.813

[在comp.compiler](http://groups.google.com/group/comp.compilers/browse_thread/thread/ece41fbd752baf38/5ac7677755aa03b3#5ac7677755aa03b3)获得了精彩的答案

# haskell - 在 Haskell 中定义一个函数的 2 个或多个方程可以共享相同的 where / let 块吗？

> ID：827994
> 
> 赞同：6
> 
> 时间：2009-05-06T04:19:13.550
> 
> 标签：haskell, functional-programming, pattern-matching

**在 Haskell 中定义一个函数的 2 个或多个方程可以共享相同的 where / let 块吗？**

让我举一个人为的例子来说明这个问题。

首先，考虑以下代码作为起点：

```
someFunction v1 v2 v3 = difference ^ v3
   where
      difference = v1 - v2 
```

到目前为止，一切都很好。但是，假设我需要处理“另一种情况”，如果 v3 == 99 并且差异 < 4（完全任意，但假设这些是我的要求），我需要返回零。

我的第一个想法是这样做：

```
someFunction v1 v2 99 | difference < 4 = 0
someFunction v1 v2 v3 = difference ^ v3
   where
      difference = v1 - v2 
```

但是，这是行不通的，因为 someFunction 的第一个方程和 someFunction 的第二个方程并不共享相同的 where 块。在这个人为的示例中，这没什么大不了的，因为 where 块中只有一个变量（“差异”）。但在现实世界的情况下，可能存在大量变量，重复它们是不可接受的。

我已经知道如何通过使用守卫并且只有一个方程来解决这个问题。问题是，有没有办法让多个*方程*共享相同的 where / let 子句？因为有多个具有不同模式的方程似乎是可取的，而不是被迫只有一个方程有很多守卫。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-06T04:21:50.987

一种选择是将函数提升到 where 块本身：

```
someFunction v1 v2 = f
    where
        f 99 | difference < 4 = 0
        f v3 = difference ^ v3
        difference = v1 - v2 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T04:36:53.867

我认为你不能。可能您最好的解决方案是：

```
someFunction v1 v2 v3 | v3==99 && difference<4 = 0
                      | otherwise = difference ^ v3
                      where difference = v1 - v2 
```

# jquery - 获取 div 的原点高度

> ID：827996
> 
> 赞同：0
> 
> 时间：2009-05-06T04:19:58.760
> 
> 标签：jquery, css, height

我设置了div的css

```
height:130px;
overflow:hidden; 
```

我想要一个从当前高度到原点高度的动画[，](https://rads.stackoverflow.com/amzn/click/com/0814473830)但是我无法获得原点高度。一种可能的方法是在加载 dom 之后，将高度存储在 js 中，像这样

```
$(function(){
    $('.detail').data('originHeight',$('.detail').height());
    $('.detail').css({height:'130px',overflow:'hidden'})
}) 
```

但这样做，div 将首先显示所有，然后将高度设置为 130 像素。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T05:32:48.320

您拥有的方法是正确的方法，但您可能需要一些技巧来避免这会给您带来的视觉闪烁。

尝试将 div 移出屏幕，检查高度，然后将其移回。此外，当我们在这里时，尽可能避免使用多个 jQuery 查找`$('.detail')`因为这可能是一项非常昂贵的操作。

```
var $detail = $('.detail');
$detail
    .css({position : 'absolute', left: '-10000px'})
    .data('origHeight', $detail.height())
    .css({position : '', left : '', height : '130px', overflow : 'hidden'})
; 
```

或者，如果这对您不起作用，请不要反对它，使用它。考虑将其调整到您的设计中的方法可能是值得的，例如，从它的全尺寸开始，然后动画回到 130 像素。这将让您优雅地检查其正常大小，并让用户知道那里有更多信息可以看到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T04:28:35.290

你不能通过删除css属性来扩展div吗？

```
$('.detail').css({height:'', overflow:''}) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T15:16:26.123

我以前通过使用元素的`scrollHeight`属性来完成此操作。

```
document.getElementById('element').scrollHeight; 
```

这告诉您如果将高度设置为`auto`并`overflow`启用，元素的高度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T05:23:42.570

我认为这是唯一的方法。因为如果你在 jQuery 中使用 CSS 修改了高度，那么高度就变成了修改后的高度。修改后的高度是您将访问的高度。

我能想到的唯一可能的情况是使用 jquery 存储原始高度，或者提供您的固定高度并告诉 jQuery 它将扩展多长时间。***********