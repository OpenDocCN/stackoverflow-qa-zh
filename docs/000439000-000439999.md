# StackOverflow 问答 000439000-000439999

# jquery - 如何让 jquery ui 标签工作？

> ID：439000
> 
> 赞同：5
> 
> 时间：2009-01-13T13:49:02.300
> 
> 标签：jquery, css

在[http://docs.jquery.com/UI/Tabs#Example](http://docs.jquery.com/UI/Tabs#Example)有一个简短的 HTML 示例，说明如何使用 JQuery UI 选项卡。

*   我将 HTML 放在本地 index.htm 文件中。
*   我下载了所有的 CSS 和 Javascript 文件，并将它们保存在本地文件中：
*   但我能得到的最接近的是标签中没有任何颜色的相同示例。
*   我四处寻找图像等，但找不到任何东西。
*   我什至可以将所有内容都放在本地，除了我从他们的服务器上下载下来的 CSS 文件，然后它就可以工作了，所以这是我没有得到的 CSS 文件中的东西。

我没有在本地复制在线 CSS 文件有什么？有没有人让这个 JQuery UI 选项卡工作并有一个可以在本地工作的 zip 文件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T14:15:03.697

如果您的问题是一切似乎都在运行，但 DIV 并没有像应有的那样消失，那么您可能遇到了与我相同的问题。

您需要定义类 .ui-tabs-hide 以便它隐藏元素。基本上 jQuery 使用它来隐藏元素，而不是使用 display: none 手动进行。这样做的原因是它不会与您的显示器的默认设置混淆，这可能是块、内联或任何东西。通过添加和删除类，它为您提供了更多的控制权。

```
.ui-tabs-hide
{
  display: none
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T13:53:00.433

要使 UI 选项卡正常工作，您需要一些 CSS。文档说明了最低要求。

示例主题的问题是因为使用的 css 文件引用了其他 CSS 文件。您需要将它们全部复制到本地。您还需要主题/flora/i 文件夹下的图像。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-05T03:09:22.327

我遇到了同样的问题，这就是为什么我在这里并且花了一段时间才找到问题。感谢 kgiannakakis 对我在 JqueryUI 页面上找到的 CSS 源代码中的 CSS 的回答：

```
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.8/themes/base/jquery-ui.css" type="text/css" media="all" /> 
```

在你的主要 CSS 之前添加它，例如：

然后你应该没问题 - 它对我有用。

# nhibernate - 您如何使用流畅的 NHibernate 将枚举映射为 int 值？

> ID：439003
> 
> 赞同：88
> 
> 时间：2009-01-13T13:50:43.543
> 
> 标签：nhibernate, fluent-nhibernate

问题确实说明了一切，默认情况下它映射为 a`string`但我需要它映射为`int`.

如果这有什么不同，我目前正在使用它`PersistenceModel`来设置我的约定。提前致谢。

**更新** 发现从主干获取最新版本的代码解决了我的问题。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-11-10T08:48:26.267

定义这个约定的方式以前有时会改变，现在是：

```
public class EnumConvention : IUserTypeConvention
{
    public void Accept(IAcceptanceCriteria<IPropertyInspector> criteria)
    {
        criteria.Expect(x => x.Property.PropertyType.IsEnum);
    }

    public void Apply(IPropertyInstance target)
    {
        target.CustomType(target.Property.PropertyType);
    }
} 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-14T08:44:37.063

因此，如前所述，从后备箱获取最新版本的 Fluent NHibernate 让我到达了我需要的地方。具有最新代码的枚举的示例映射是：

```
Map(quote => quote.Status).CustomTypeIs(typeof(QuoteStatus)); 
```

自定义类型强制将其作为枚举的实例处理，而不是使用`GenericEnumMapper<TEnum>`.

我实际上正在考虑提交一个补丁，以便能够在保留字符串的枚举映射器和保留 int 的枚举映射器之间进行更改，因为这似乎是您应该能够设置为约定的东西。

* * *

这出现在我最近的活动中，并且在 Fluent NHibernate 的较新版本中发生了变化，以使这更容易。

要将所有枚举映射为整数，您现在可以创建如下约定：

```
public class EnumConvention : IUserTypeConvention
{
    public bool Accept(IProperty target)
    {
        return target.PropertyType.IsEnum;
    }

    public void Apply(IProperty target)
    {
        target.CustomTypeIs(target.PropertyType);
    }

    public bool Accept(Type type)
    {
        return type.IsEnum;
    }
} 
```

那么您的映射只需：

```
Map(quote => quote.Status); 
```

您可以像这样将约定添加到 Fluent NHibernate 映射中；

```
Fluently.Configure(nHibConfig)
    .Mappings(mappingConfiguration =>
    {
        mappingConfiguration.FluentMappings
            .ConventionDiscovery.AddFromAssemblyOf<EnumConvention>();
    })
    ./* other configuration */ 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2010-04-26T19:27:47.147

不要忘记可为空的枚举（如`ExampleEnum? ExampleProperty`）！它们需要单独检查。这是使用新的 FNH 样式配置的方式：

```
public class EnumConvention : IUserTypeConvention
{
    public void Accept(IAcceptanceCriteria<IPropertyInspector> criteria)
    {
        criteria.Expect(x => x.Property.PropertyType.IsEnum ||
            (x.Property.PropertyType.IsGenericType && 
             x.Property.PropertyType.GetGenericTypeDefinition() == typeof(Nullable<>) &&
             x.Property.PropertyType.GetGenericArguments()[0].IsEnum)
            );
    }

    public void Apply(IPropertyInstance target)
    {
        target.CustomType(target.Property.PropertyType);
    }
} 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2010-05-14T18:39:17.973

这就是我使用 int 值映射枚举属性的方式：

```
Map(x => x.Status).CustomType(typeof(Int32)); 
```

为我工作！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-16T11:32:18.100

对于那些使用带有 Automapping 的 Fluent NHibernate（以及潜在的 IoC 容器）的用户：

`IUserTypeConvention`正如上面@ **Julien**的回答：[https ://stackoverflow.com/a/1706462/878612](https://stackoverflow.com/a/1706462/878612)

```
public class EnumConvention : IUserTypeConvention
{
    public void Accept(IAcceptanceCriteria<IPropertyInspector> criteria)
    {
        criteria.Expect(x => x.Property.PropertyType.IsEnum);
    }

    public void Apply(IPropertyInstance target)
    {
        target.CustomType(target.Property.PropertyType);
    }
} 
```

Fluent NHibernate Automapping 配置可以这样配置：

```
 protected virtual ISessionFactory CreateSessionFactory()
    {
        return Fluently.Configure()
            .Database(SetupDatabase)
            .Mappings(mappingConfiguration =>
                {
                    mappingConfiguration.AutoMappings
                        .Add(CreateAutomappings);
                }
            ).BuildSessionFactory();
    }

    protected virtual IPersistenceConfigurer SetupDatabase()
    {
        return MsSqlConfiguration.MsSql2008.UseOuterJoin()
        .ConnectionString(x => 
             x.FromConnectionStringWithKey("AppDatabase")) // In Web.config
        .ShowSql();
    }

    protected static AutoPersistenceModel CreateAutomappings()
    {
        return AutoMap.AssemblyOf<ClassInAnAssemblyToBeMapped>(
            new EntityAutomapConfiguration())
            .Conventions.Setup(c =>
                {
                    // Other IUserTypeConvention classes here
                    c.Add<EnumConvention>();
                });
    } 
```

*然后`CreateSessionFactory`可以轻松地在诸如 Castle Windsor 之类的 IoC 中使用（使用 PersistenceFacility 和安装程序）。*

```
 Kernel.Register(
        Component.For<ISessionFactory>()
            .UsingFactoryMethod(() => CreateSessionFactory()),
            Component.For<ISession>()
            .UsingFactoryMethod(k => k.Resolve<ISessionFactory>().OpenSession())
            .LifestylePerWebRequest() 
    ); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T15:57:52.693

您可以创建一个 NHibernate ，并使用属性映射`IUserType`指定它。`CustomTypeIs<T>()`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-24T15:41:36.153

您应该将值保留为数据库表中的 int / tinyint。要映射您的枚举，您需要正确指定映射。请参阅下面的映射和枚举示例，

**映射类**

```
公共类事务映射：类映射事务
{
    公共事务映射（）
    {
        //其他映射
        ......
        //映射枚举
        Map(x => x.Status, "状态").CustomType();

        表（“交易”）；
    }
}

```

**枚举**

```
公共枚举 TransactionStatus
{
   等待 = 1,
   处理 = 2,
   回滚 = 3，
   封锁 = 4,
   退款 = 5,
   已处理 = 6，
}
```

# c# - 从 OpenFileDialog 路径/文件名中提取路径

> ID：439007
> 
> 赞同：83
> 
> 时间：2009-01-13T13:51:50.717
> 
> 标签：c#, .net, parsing, path

我正在编写一个从选择文件开始的小实用程序，然后我需要选择一个文件夹。我想将文件夹默认为所选文件所在的位置。

`OpenFileDialog.FileName`返回**完整路径和文件名**- 我想要的只是获取**路径部分（无文件名）**，因此我可以将其用作初始**选定文件夹**。

```
 private System.Windows.Forms.OpenFileDialog ofd;
    private System.Windows.Forms.FolderBrowserDialog fbd;
    ...
    if (ofd.ShowDialog() == DialogResult.OK)
    {
        string sourceFile = ofd.FileName;
        string sourceFolder = ???;
    }
    ...
    fbd.SelectedPath = sourceFolder; // set initial fbd.ShowDialog() folder
    if (fbd.ShowDialog() == DialogResult.OK)
    {
       ...
    } 
```

是否有任何 .NET 方法可以做到这一点，还是我需要使用`regex, split, trim,`等？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-01-13T13:57:58.600

使用[`Path`](http://msdn.microsoft.com/en-us/library/system.io.path.aspx)来自 的类[`System.IO`](http://msdn.microsoft.com/en-us/library/system.io.aspx)。它包含用于操作文件路径的有用调用，包括[`GetDirectoryName`](http://msdn.microsoft.com/en-us/library/system.io.path.getdirectoryname.aspx)执行您想要的操作，返回文件路径的目录部分。

用法很简单。

```
string directoryPath = Path.GetDirectoryName(filePath); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2013-02-15T12:23:15.483

这个怎么样：

```
string fullPath = ofd.FileName;
string fileName = ofd.SafeFileName;
string path = fullPath.Replace(fileName, ""); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2012-07-10T17:13:11.153

```
if (openFileDialog1.ShowDialog(this) == DialogResult.OK)
{
    strfilename = openFileDialog1.InitialDirectory + openFileDialog1.FileName;
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-09-21T17:11:58.200

您可以使用 FolderBrowserDialog 而不是 FileDialog 并从 OK 结果中获取路径。

```
FolderBrowserDialog browser = new FolderBrowserDialog();
string tempPath ="";

if (browser.ShowDialog() == DialogResult.OK)
{
  tempPath  = browser.SelectedPath; // prints path
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-26T14:15:09.767

这是做它的简单方法！

```
string fullPath =openFileDialog1.FileName;
string directory;
directory = fullPath.Substring(0, fullPath.LastIndexOf('\\')); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-12-16T06:12:55.477

这就是文件完整路径所需的全部内容

```
@openFileDialog1.FileName 
```

# javascript - 单击浏览器上的后退按钮时，“全选”复选框不起作用

> ID：439010
> 
> 赞同：0
> 
> 时间：2009-01-13T13:52:26.503
> 
> 标签：javascript

我有以下html页面：

```
<html>
<body>

<script>
    var check = 0;

function doNow()
{
  void(d=document);

  void(el=d.getElementsByTagName('INPUT'));
  for(i=0;i<el.length;i++)
    {
        if(check == 0)
            void(el[i].checked=1)
        else
            void(el[i].checked=0) 
    }
   if(check == 0)
       check = 1;
   else 
       check = 0;
}

</script>
<HR>
<form>
<INPUT TYPE="CHECKBOX" name="DG1">DG1
<INPUT TYPE="CHECKBOX" name="DG2">DG2
<INPUT TYPE="CHECKBOX" name="DG3">DG3
<INPUT TYPE="CHECKBOX" name="DG4">DG4
<INPUT TYPE="CHECKBOX" name="DG5">DG5

<input type=button onclick="doNow()" value="CheckBox All Now">

</form>
</body>
</html> 
```

如果单击“CheckBox All Now”，则会选中所有复选框。然后，如果按下“返回”按钮或“刷新”按钮。“CheckBox All now”必须单击两次才能取消选中所有复选框。

请让我知道在“刷新”或“返回”的情况下如何处理“CheckBox All Now”。

在此先感谢，马赫什。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T14:14:39.067

这是因为当页面重新加载时，Javascript 被解析并且你的声明

```
var check = 0; 
```

不出所料，此时检查变量将重置为零。因此，在页面重新初始化后，第一次单击按钮将启用所有复选框。似乎这里的问题源于表单渲染器如何记住状态以及 Javascript 引擎如何记住“状态”的差异。后者不能真正按照您想要的方式“修复”，因为脚本基本上每次都需要运行。

您可能会选择做的是将初始“检查”状态从控件本身中拉出来。您当前的代码明确假设复选框最初都未选中（这基本上就是您所说的“check = 0”；这个变量存储了 Javascript 所知道的复选框的状态）。相反，您可以将该行更改为：

```
var check = document.getElementsByTagName('INPUT')[0].checked; 
```

当然，这在当前位置不起作用，因为它是在定义表单之前声明的。您需要将其注册为要在文档加载后运行的闭包，或者将这一行拉出并将其放在文档中表单元素之后出现的 <script> 标记中（这不是最干净的方式这样做但适用于快速和肮脏的开发；在头脑中注册功能通常是要走的路）。

我已经测试了这两种方法，它们都有效。我敢肯定，这个问题还有其他潜在的解决方案，可以提供其他人的答案！

**编辑**：在考虑了一段时间后进行了大编辑。这里的根本问题是`check`变量与实际的复选框本身不同步——我上面描述的是一种在重新加载/重新初始化页面时避免这种情况的方法。

但是，您仍然会遇到其他问题。如果用户手动单击所有复选框会发生什么？它们现在将处于活动状态，但您的检查变量仍将是**0**，因此单击“全部检查”按钮将激活它们（这将无效）。如果我在选中所有复选框的情况下单击此按钮，我希望它的行为始终如一，无论这些复选框如何进入该状态（这应该是无关紧要的）。

另外，如果您的某些复选框被选中而有些未被选中，会发生什么？在这种情况下，按钮的作用*是*什么？

总体上最好的解决方案可能是完全删除变量，而是在每次调用`check`开始时按需解决。`doNow`也就是说，检查复选框数组，读取它们的当前值，并从中得出复选框应该设置的内容。（这可能真的很简单，例如，如果功能结果是每个复选框都应该简单地单独反转 - 这取决于实际的功能要求。）

（另外，作为一个编码风格问题，你的代码部分说

```
 if(check == 0)
    void(el[i].checked=1)
else
    void(el[i].checked=0)
```

可以简单地替换为

```
el[i].checked = (1 - check);
```

除了我们希望摆脱这个变量之外，它应该是一个布尔值而不是一个整数，因为它只有两个状态。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:06:19.830

我的建议是使用复选框而不是按钮。当有人单击复选框时，所有其他复选框将设置为，但该复选框已设置。

因此，如果选中“全选”复选框，然后单击它。所有其他复选框将被清除。

在您描述的场景中应该会更好一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T14:35:13.657

dtsazza 是对的——当页面刷新时，你从头开始。

我注意到“立即检查”按钮实际上*切换*了检查状态。2个按钮怎么样（链接可能更好）；一个检查所有，一个取消检查所有？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T14:44:51.267

您可以将`checked`变量存储在隐藏字段中。这样，它将与复选框一样持久。

# vb.net - Visual Basic 编译器不断崩溃

> ID：439033
> 
> 赞同：2
> 
> 时间：2009-01-13T13:59:56.287
> 
> 标签：vb.net, visual-studio, visual-studio-2005

这个问题真的说明了一切。对于我正在处理的一个项目，Visual Basic 编译器崩溃导致我不得不重新启动我的 IDE。

将用于 obj/debug 的网站的 PDB 文件和 XML 文件复制到输出文件夹时，它看起来会崩溃。

有没有人经历过类似的崩溃？如果有，你是如何修复的？

是否有任何崩溃日志存储在任何地方？

我正在使用 Visual Studio 版本 8.0.50727.762 (SP .050727-7600)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T15:10:39.233

当它崩溃时，您是否真的收到错误消息或代码，或者您只是收到“Visual Studio 停止工作”错误消息？

我第二次尝试卸载、重新安装和重新应用 SP1，以确保它与您的安装无关。我从来没有遇到过 VB 编译器崩溃的情况，我想权限问题和其他移动文件的异常将完全包含在编译器的内部。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T16:40:41.433

您可以尝试使用管理工具中的事件查看器来查看是否记录了任何日志。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-01T16:47:13.277

看起来您没有运行[Visual Studio 2005 SP1](http://www.microsoft.com/downloads/details.aspx?familyid=BB4A75AB-E2D4-4C96-B39D-37BAF6B5B1DC&displaylang=en)。在 SP1 之前，我们有大量的 VBC 崩溃——他们甚至对产品的 RTM 做出了奇迹​​。太可怕了。安装 Service Pack 1，您的问题很可能会消失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-01T18:26:00.723

您是否已经尝试过清理您的解决方案/项目？

有时，由 Visual Studio 维护的 .suo、.ncb 和其他文件会损坏，从而导致在编译或调试期间崩溃。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T12:17:08.703

在不断点击向微软发送错误报告后，我终于收到了一个小消息框，上面写着“我们认为这可能是你的问题”这个[链接](http://support.microsoft.com/kb/942124)

我相信这是我的问题......我仍然需要获得热修复

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-07T06:18:40.477

只需删除 .SUO 文件并获得 Nirvana :)

# windows - 如何在 bat 文件中按位制作？

> ID：439038
> 
> 赞同：3
> 
> 时间：2009-01-13T14:02:14.567
> 
> 标签：windows, batch-file, cmd, bit-manipulation

我已经尝试过以下方法，但它只是说“&在这个时候是出乎意料的”。

```
@echo off
:enter-input
echo Please enter a number between 1 and 15:
echo 1 = Selection one
echo 2 = Selection two
echo 4 = Selection three
echo 8 = Selection four
echo x = Quit

set INPUT=
set /P INPUT=Type number: %=%

if "%INPUT%" == "" goto enter-input
if "%INPUT%" == "x" goto end
if "%INPUT%" == "X" goto end

set /A %INPUT%
if %INPUT% & 1 == 1 echo Selection one
if %INPUT% & 2 == 2 echo Selection two
if %INPUT% & 4 == 4 echo Selection three
if %INPUT% & 8 == 8 echo Selection four

echo Done
:end 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-06-09T05:13:01.277

可以在一个语句中完成逐位数学和比较。如果结果是您正在寻找的结果，诀窍是故意创建除以零错误。当然stderr应该重定向到nul，`||`操作符用来测试错误情况（表示为TRUE）。

这种技术消除了对任何中间变量的需要。

```
@echo off
:enter-input
set "input="
echo(
echo Please enter a number between 1 and 15:
echo 1 = Selection one
echo 2 = Selection two
echo 4 = Selection three
echo 8 = Selection four
echo x = Quit

set /P INPUT=Type number:

if not defined input goto enter-input
if /i "%input%" == "X" exit /b

2>nul (
  set /a "1/(1-(input&1))" || echo Selection one
  set /a "1/(2-(input&2))" || echo Selection two
  set /a 1/(4-(input^&4^)^) || echo Selection three
  set /a 1/(8-(input^&8^)^) || echo Selection four
)
pause
goto enter-input 
```

`&`接受的答案从未说明过一些显而易见的事情：在 SET /A 计算中，像and之类的特殊字符`)`必须被转义或引用。我有意在上面的示例中演示了这两种技术。

* * *

**编辑：**通过反转逻辑（如果为假，则除以零）并使用`&&`运算符，可以使逻辑更加简单。

```
2>nul (
  set /a "1/(input&1)" && echo Selection one
  set /a "1/(input&2)" && echo Selection two
  set /a 1/(input^&4^) && echo Selection three
  set /a 1/(input^&8^) && echo Selection four
) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T14:16:47.517

我找到了一种方法。

```
@echo off
:enter-input
echo Please enter a number between 1 and 15:
echo 1 = Selection one
echo 2 = Selection two
echo 4 = Selection three
echo 8 = Selection four
echo x = Quit

set /P INPUT=Type number:

if "%INPUT%" == "" goto enter-input
if "%INPUT%" == "x" goto end
if "%INPUT%" == "X" goto end

set /A isOne = "(%INPUT% & 1) / 1"
set /A isTwo = "(%INPUT% & 2) / 2"
set /A isThree = "(%INPUT% & 4) / 4"
set /A isFour = "(%INPUT% & 8) / 8"

if %isOne% == 1 echo Selection one
if %isTwo% == 1 echo Selection two
if %isThree% == 1 echo Selection three
if %isFour% == 1 echo Selection four

echo Done
:end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-04-11T16:15:51.217

对于按位与，请将表达式放在引号中以避免错误，
例如。`set /a "48 & 23"`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T15:03:53.863

```
SET LEFT = 1
SET RIGHT = 2
SET /A RESULT = %LEFT% & %RIGHT% 
```

如果您直接在 cmd.exe 中尝试，请使用 '^' 转义 & 字符。

# firefox - Firefox 扩展兼容性

> ID：439047
> 
> 赞同：4
> 
> 时间：2009-01-13T14:05:52.280
> 
> 标签：firefox

我遇到过一些帖子，上面写着“我很想使用扩展 A，但它不适用于扩展 B”。这是我在构建 Firefox 扩展时需要关注的事情吗？

扩展相互冲突的一些常见原因是什么？确保我的扩展程序与所有其他扩展程序良好配合的最佳实践是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T02:05:08.210

扩展冲突的最常见原因是在共享命名空间中使用通用名称。例如，如果两个扩展在 browser.xul 覆盖中定义了一个名为“log”的全局变量，则只有其中一个会按预期运行，因为另一个的“log”将被覆盖。

常见的解决方案是了解您的哪些 ID 将被转储到共享空间中，并使用您自己的唯一前缀作为前缀。

对于 JavaScript 代码，您可以（无论如何这是个好主意）将您的代码放入一个对象中：

```
var myExtension = {
  onLoad: function() { ... },
  ...
} 
```

代替

```
function onLoad() {
} 
```

这是关于该主题的一篇很好的文章：http: [//blog.userstyles.org/2007/02/06/avoiding-extension-conflicts/](http://blog.userstyles.org/2007/02/06/avoiding-extension-conflicts/)。

其他冲突很少见，必须根据具体情况进行调试。例如，Mozilla 中曾经存在一个错误，当节点在 DOM 中移动时，该错误会导致节点上的事件侦听器丢失。这导致菜单编辑器扩展发生多次冲突，允许用户重新排列菜单项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:13:05.357

不确定（资源争用是显而易见的地方）但您可能会更幸运地发布到[mozilla.dev.extensions](http://groups.google.com/group/mozilla.dev.extensions/topics?hl=en)

# c - C 和 Objective-C 入门

> ID：439052
> 
> 赞同：6
> 
> 时间：2009-01-13T14:08:03.370
> 
> 标签：c, objective-c, eclipse, xcode

我最终想用 Objective-C 编程为 OS X 和可能的 iPhone 编写程序。我没有任何 C 语言的直接经验，而且我来自网络编程背景。我比 C 和 Objective C 更熟悉 java 语法。

我只是在寻找有关如何开始的建议。看来我只需要从 C 开始（我还没有足够强大的 Mac 计算机进行编程，所以无论如何在 Windows 平台上从 C 开始会很好（有关编程环境的信息也会有所帮助，我是用于日食））。我只是在寻找书籍推荐、在线教程或任何其他要记住的指针。请记住，尽管我的最终目标是使用 Objective-C，所以在学习 C 时我需要记住什么，需要注意什么等等。感谢您的任何意见。

**更新**：我认为我需要先学习 C 的原因是，到目前为止，我遇到的大多数 Objective-C 教程都假设您已经了解 C 语法，而我并不完全了解。有没有更好的教程适合我？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T14:33:19.760

我不完全同意 unwind 所说的“C 和 Objective-C 是不同的语言”。Objective-C 是 C 的严格超集。

他当然知道——他的观点是，在进入 Objective-C 之前，你不需要完全掌握 C。我会支持这一点（并希望已经澄清了它）。

但我确实认为首先学习一些 C 基础知识是值得的，因为大多数关于 Objective-C 的介绍性文本都会假设您具备基本知识。

我自己对此没有任何建议，但可能大多数基于互联网的教程都足以达到此目的（请记住，您在这个阶段并没有试图掌握它）。如果你想认真对待它，那么 K&R 的《The C Programming Language》就是经典著作。

当您可以在 C 中编写一些基本的 hello world 程序并了解类型系统、指针和其他内容时，请阅读 Aaron Hillegass 所著的“Mac OS X 的 Cocoa 编程”。这是一本关于 Cocoa 的书，它涵盖了 Objective-C，但它是该语言最好的介绍之一。它将假设您在 Mac 上编码（毕竟它是在 Cocoa 的上下文中）。您也许可以在 Windows 上使用 GCC 来遵循纯语言的内容，但我不推荐它。

如果您最终要在 Mac 上工作，那么最好在这个阶段进行，恕我直言。你说你没有“足够强大的编程能力”的 Mac，但任何可以运行 OS X 的东西都可以让你开始。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T14:29:57.023

如果你了解 java，obj-c 对你来说会很容易（java 受 obj-c 的影响很大。）Apple 有很好的文档，你可以从[这里](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Introduction/chapter_1_section_1.html)开始。我认为你不需要在学习 obj-c 之前学习 C（抱歉[Joel](http://www.joelonsoftware.com)）。

如果你有 gcc，你可以在 windows 上使用 obj-c。另请查看[cocotron](http://www.cocotron.org)：

> Cocotron 是一个开源项目，旨在实现类似于 Apple Inc. 的 Cocoa 文档中描述的跨平台 Objective-C API。这包括 AppKit、Foundation、Objective-C 运行时和支持 API，例如 CoreGraphics 和 CoreFoundation。

随着 iPhone 开发的热议，现在有几十本 obj-c 书籍。不确定它们有多好，但我建议的经典是Aaron Hillegass[的 Mac OSX 的 Cocoa Programming 。](https://rads.stackoverflow.com/amzn/click/com/0321503619)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T21:01:47.713

Stephen Kochan 的 Objective-C 编程是你想要的。它假定您没有编程经验，但如果您这样做，它不会阻碍您，并且将整个东西（带有 Objective-C 超集的 C）作为一个完整的包引入。我阅读了 Kochan 的前半部分（后半部分进入 Cocoa），现在我正在为 Aaron Hillegass 编写的 Mac OS X（第 3 版）的 Cocoa Programming 工作，阅读 Kochan 对我有很大帮助。这两个是“一拳二拳”，可以让您立即上手。

有一个方便的 C 和 Objective-C 参考，因为 Apple 在 XCode 中的 C 文档与我迄今为止所看到的相比非常糟糕。K&R 的 C 文本就像 C 的 Encyclopedia Brittanica，就像一套百科全书一样，并不适合所有人。我刚刚在谷歌上搜索参考资料，并且通常在网上找到我需要的东西，因为 C 无处不在。

在找到最适合您的集合之前，您将阅读几本书，但是对于 Objective-C 和 Cocoa，Kochan 和 Hillegass 绝对不会出错。当你完成 Hillegass 的前几章时，你会想要（并且能够）开始自己写一些东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-19T20:18:07.163

Tuaw 最近有一篇博客文章： [http ://www.tuaw.com/2009/01/15/starting-out-with-objective-c/](http://www.tuaw.com/2009/01/15/starting-out-with-objective-c/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-09-13T08:37:45.723

关于 Objective-C 入门的 4 个指南，当我开始使用 Xcode 进行开发时，这对我帮助很大。你应该看看这个：

[http://cocoadevcentral.com/](http://cocoadevcentral.com/)

[http://developer.apple.com/iphone/index.action](http://developer.apple.com/iphone/index.action)

[http://developer.apple.com/iphone/library/referencelibrary/GettingStarted/Learning_Objective-C_A_Primer/](http://developer.apple.com/iphone/library/referencelibrary/GettingStarted/Learning_Objective-C_A_Primer/)

[http://developer.apple.com/iphone/library/documentation/userexperience/conceptual/mobilehig/Introduction/Introduction.html#//apple_ref/doc/uid/TP40006556-CH1-SW1](http://developer.apple.com/iphone/library/documentation/userexperience/conceptual/mobilehig/Introduction/Introduction.html#//apple_ref/doc/uid/TP40006556-CH1-SW1)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T14:43:13.080

我会说最好先学习C。一定要像对待它的本质一样对待它：一种结构化的机器语言。

当您对它感到满意时（无需真正掌握它），继续学习 Objective C，在那里您将重新发现 Java 中熟悉的一些东西，但是当它们相似但不等价时，了解 C 基础架构会更加明显。

不要用你已经知道的作为新事物的“隐喻”来学习一门语言，这一点非常重要。总是试着假装你以前什么都不知道。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T15:53:08.257

我不知道你所说的足够强大的 Mac 是什么意思，可以在上面进行编程（任何 Mac 都应该做），但很快就会让自己成为一个至少有点有用的开发系统。（您很可能在 Mac 随附的一张 CD 上安装了开发系统，或者您也可以从 Apple 下载。）

你越早让 Xcode 工作，你就会越快适应它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-02T10:08:18.443

我最近开始为 Iphone 学习编程并尝试了许多不同的书籍，直到我发现这些对我帮助最大*（我也强烈建议使用 Mac，因为 Xcode 是为 Iphone 编码时要走的路*）：

*   [Apress：在 Mac 上学习 C](http://www.apress.com/book/view/9781430218098) *（让最初的 C 开始）*
*   [Apress：在Mac上](http://www.apress.com/book/view/1430218150) *学习Objective-C（根据你对C的理解学习Objective-C）*
*   [Apress：Learn Cocoa for mac](http://www.apress.com/book/view/9781430218593) *（学习苹果构建应用程序的方式，在转到 Iphone 时有很大帮助，但是如果您愿意，您可以直接转到 iphone）*
*   [Apress：开始 Iphone 开发...](http://www.apress.com/book/view/1430216263) *（最后一本书，也是必不可少的工具）*

需要注意的是，所有这些书都是同一作者，因此可追溯性很好！这些书相互之间有交叉引用，这确实很有帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-20T14:23:40.897

同意其他人的观点，我发现[Cocoa Programming for Mac OSX - Hillegass](http://www.bignerdranch.com/book/cocoa%C2%AE_programming_for_mac%C2%AE_os_x_3rd_edition "Mac OS X 的 Cocoa 编程") 是对 Objective-C、Cocoa 框架和整个 Apple 做事方式的一个很好的介绍。

您也可以在任何 Linux 或 Windows 机器上运行 Objective-C，尽管您当然无法访问所有 Apple 库，例如。NS（阿法克）。这些框架确实是 Objective-C 的全部要点，考虑到 C++ 和 C# 的出现，它仍然存在的真正原因或多或少是围绕它们自己设计的语言（与 Objective-C 相反，它是 C 的严格超集）。

除了指针之外，我认为您无需学习 C 的所有复杂性和接近金属的方面就可以过关，尽管您可以消化的任何和所有 C 总是有帮助的。

# sql - 视图比简单查询快吗？

> ID：439056
> 
> 赞同：400
> 
> 时间：2009-01-13T14:09:03.133
> 
> 标签：sql, sql-server, performance

是一个

```
select *  from myView 
```

比查询本身更快地创建视图（为了具有相同的结果集）：

```
select * from ([query to create same resultSet as myView]) 
```

?

如果视图使用某种缓存使其比简单查询更快，我并不完全清楚。

* * *

## 回答 #1

> 赞同：764
> 
> 时间：2009-01-13T14:11:07.387

**是**的，视图*可以*分配一个聚集索引，并且当它们这样做时，它们将存储可以加速结果查询的临时结果。

微软自己的文档非常清楚地表明 Views 可以提高性能。

首先，人们创建的大多数视图都是*简单*视图，不使用此功能，因此与直接查询基表没有什么不同。简单视图在原地扩展，因此**不会直接促进性能改进**- 确实如此。 **但是，**索引视图可以*显着*提高性能。

让我直接进入文档：

> 在视图上创建唯一聚集索引后，视图的结果集会立即物化并持久化在数据库的物理存储中，从而节省了在执行时执行此昂贵操作的开销。

*其次，即使它们没有被另一个查询直接引用*，这些索引视图也可以工作，因为优化器会在适当的时候使用它们来代替表引用。

再次，文档：

> 索引视图可以两种方式用于查询执行。查询可以直接引用索引视图，或者更重要的是，如果查询优化器确定该视图可以替代最低成本查询计划中的部分或全部查询，则可以选择该视图。在第二种情况下，使用索引视图而不是基础表及其普通索引。该视图不需要在查询中被引用，查询优化器就可以在查询执行期间使用它。这允许现有应用程序从新创建的索引视图中受益，而无需更改这些应用程序。

[可以在此处](http://www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx)找到此文档以及演示性能改进的图表。

**更新 2：**答案受到批评，因为提供性能优势的是“索引”，而不是“视图”。然而，这很容易被驳斥。

假设我们是一个小国家的软件公司；我将以立陶宛为例。我们在全球范围内销售软件并将我们的记录保存在 SQL Server 数据库中。我们非常成功，因此在几年内，我们拥有超过 1,000,000 条记录。但是，出于税收目的，我们经常需要报告销售额，并且我们发现我们在本国仅售出了 100 份我们的软件。通过创建仅立陶宛记录的索引视图，我们可以将我们需要的记录保存在索引缓存中，如 MS 文档中所述。当我们运行 2008 年立陶宛销售报告时，我们的查询将搜索深度仅为 7 的索引（Log2(100) 和一些未使用的叶子）。如果我们要在没有 VIEW 的情况下做同样的事情，而只依赖表中的索引，我们将不得不遍历搜索深度为 21 的索引树！

显然，视图本身将为我们提供比单独使用索引的性能优势（3 倍）。我尝试使用真实世界的示例，但您会注意到，立陶宛销售的简单列表会给我们带来更大的优势。

请注意，我只是在我的示例中使用了一个直接的 b 树。虽然我相当肯定 SQL Server 使用了 b 树的一些变体，但我不知道细节。尽管如此，这一点仍然成立。

**更新 3：**关于索引视图是否仅使用放置在基础表上的索引的问题出现了。也就是说，套用一句话：“索引视图相当于标准索引，它没有提供任何新的或独特的视图。” 如果这是真的，那上面的分析当然是不正确的！让我引用 Microsoft 文档中的一段话来说明为什么我认为这种批评无效或不正确：

> 使用索引来提高查询性能并不是一个新概念；但是，索引视图提供了使用标准索引无法实现的额外性能优势。

连同上面关于物理存储中数据持久性的引用以及文档中有关如何在视图上创建索引的其他信息，我认为可以肯定地说索引视图**不仅仅是**一个缓存的 SQL 选择，它碰巧使用主表上定义的索引。因此，我继续坚持这个答案。

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-01-13T16:27:46.457

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-13T14:11:54.610

**编辑：我错了，你应该[在上面看到 Marks 的回答。](https://stackoverflow.com/a/439061/7186)**

我不能从使用[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server)的经验来说话，但对于大多数数据库来说，答案是否定的。使用视图从性能方面获得的唯一潜在好处是它可能会根据查询创建一些访问路径。但使用视图的主要原因是为了简化查询或标准化访问表中某些数据的方式。一般来说，您不会获得性能优势。不过，我可能是错的。

我会想出一个稍微复杂一些的例子，然后自己去看看。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-13T14:21:56.010

至少在 SQL Server 中，根据查询/视图参数，查询计划存储在视图和普通 SQL 查询的计划缓存中。对于这两种情况，当它们在足够长的时间内未使用并且其他一些新提交的查询需要空间时，它们就会从缓存中删除。之后，如果发出相同的查询，则重新编译并将计划放回缓存中。所以不，没有区别，因为您以相同的频率重用相同的 SQL 查询和相同的视图。

显然，一般来说，视图，就其本质而言（有人认为它经常被使用以使其成为视图）通常比任何任意 SQL 语句更有可能被“重用”。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-13T14:12:50.817

***如果您创建一个物化视图（使用模式绑定***），它可能会更快。非物化视图的执行与常规查询一样。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-13T16:03:51.747

对于 SQL Server，视图绝对比嵌套查询好。在不知道为什么它更好的情况下（直到我阅读了 Mark Brittingham 的帖子），我已经运行了一些测试，并且在使用视图与嵌套查询时经历了几乎令人震惊的性能改进。在连续运行每个版本的查询数百次后，视图版本的查询只用了一半的时间就完成了。我会说这对我来说已经足够证明了。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-13T14:12:54.857

我的理解是，不久前，视图会更快，因为 SQL Server 可以存储执行计划，然后直接使用它，而不是试图在运行中找出一个。我认为现在的性能提升可能不如以前那么大，但我不得不猜测使用视图会有一些边际改进。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-13T14:14:41.763

我希望这两个查询执行相同。视图只不过是存储的查询定义，视图没有缓存或数据存储。当您运行优化器时，它会有效地将您的第一个查询转换为您的第二个查询。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-03-15T14:24:17.270

这一切都取决于情况。MS SQL 索引视图比普通视图或查询更快，但索引视图不能在镜像数据库环境 (MS SQL) 中使用。

任何类型的循环中的视图都会导致严重的减速，因为每次在循环中调用视图时都会重新填充视图。与查询相同。在这种情况下，使用 # 或 @ 来保存数据以进行循环的临时表比视图或查询要快。

所以这一切都取决于情况。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-13T14:31:45.600

存储执行计划应该有一些微不足道的好处，但可以忽略不计。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-10-07T09:18:24.123

在我的发现中，使用视图比普通查询要快一点。我的[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)大约需要 25 分钟（使用不同的更大的记录集和多个连接），在使用视图（非集群）之后，性能稍微快一点，但一点也不显着。我不得不使用其他一些查询优化技术/方法来使它发生巨大的变化。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-04-18T06:58:14.000

从视图或表格中选择不会有太大意义。

当然，如果 View 没有不必要的连接、字段等。您可以检查用于提高 View 性能的查询、连接和索引的执行计划。

您甚至可以在视图上创建索引以满足更快的搜索要求。[http://technet.microsoft.com/en-us/library/cc917715.aspx](http://technet.microsoft.com/en-us/library/cc917715.aspx)

但是，如果您正在搜索“%...%”，那么 sql 引擎将不会从文本列上的索引中受益。如果您可以强制您的用户进行类似 '...%' 的搜索，那将会很快

参考asp论坛上的答案： [https ://forums.asp.net/t/1697933.aspx?Which+is+faster+when+using+SELECT+query+VIEW+or+Table+](https://forums.asp.net/t/1697933.aspx?Which+is+faster+when+using+SELECT+query+VIEW+or+Table+)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-06-08T13:38:35.637

出乎所有人的意料，在某些情况下，视图的速度要慢得多。

我最近发现了这一点，当时我遇到了从 Oracle 提取的数据需要将其转换为另一种格式的问题。也许 20k 源行。一张小桌子。为此，我们尽可能将 Oracle 数据原封不动地导入到表中，然后使用视图提取数据。我们有基于这些观点的次要观点。可能有 3-4 个级别的视图。

最终查询之一可能提取 200 行，需要 45 分钟以上！该查询基于一系列视图。可能有 3-4 层深。

我可以获取每个有问题的视图，将其 sql 插入到一个嵌套查询中，然后在几秒钟内执行它。

我们甚至发现我们甚至可以将每个视图写入一个临时表并查询它来代替视图，它仍然比简单地使用嵌套视图要快得多。

更奇怪的是，在我们达到将源行拉入数据库的某个限制之前，性能一直很好，在几天的时间里，性能刚刚从悬崖上掉下来——只需要更多的源行。

因此，使用从视图中提取的查询比嵌套查询慢得多——这对我来说毫无意义。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T14:15:14.993

没有实际的不同，如果您阅读 BOL，您会发现您的普通旧 SQL SELECT * FROM X 确实利用了计划缓存等。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-13T14:35:27.417

视图的目的是一遍又一遍地使用查询。为此，SQL Server、Oracle 等通常会提供视图的“缓存”或“编译”版本，从而提高其性能。一般来说，这应该比“简单”查询执行得更好，尽管如果查询真的非常简单，好处可能可以忽略不计。

现在，如果您正在执行复杂的查询，请创建视图。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2020-06-08T14:35:32.747

我遇到了这个线程，只是想分享 Brent Ozar 的这篇文章，作为使用可用性组时要考虑的事情。

[Brent Ozar 错误报告](https://www.brentozar.com/archive/2018/05/availability-groups-bug-with-indexed-views/)

# perl - 你如何在 Perl 中进行契约式设计？

> ID：439063
> 
> 赞同：12
> 
> 时间：2009-01-13T14:11:14.877
> 
> 标签：perl, moose, design-by-contract

我正在研究在我们的 Perl 项目中使用 DbC，并且我正在尝试找到在源代码中验证合同的最佳方法（例如检查前置/后置条件、不变量等）

[Class::Contract](http://search.cpan.org/~ggoebel/Class-Contract-1.14/lib/Class/Contract/Production.pm)由 Damian Conway 编写，现在由 C. Garret Goebel 维护，但看起来已经有 8 年多没有人碰过它了。

看起来我想使用的是[Moose](http://www.iinteractive.com/moose/)，因为它似乎可以提供可用于 DbC 的功能，但我想知道是否有人有任何资源（文章等）来说明如何解决这个问题，或者如果我找不到任何有用的模块。

有人用 Perl 做 DbC 吗？我是否应该“跳入”Moose，看看我能为我做些什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-14T16:27:49.157

Moose 为您提供了很多工具（如果不是所有的糖）来进行 DbC。具体来说，您可以使用 before、after 和 around 方法挂钩（[这里](http://search.cpan.org/~ether/Moose-2.2006/lib/Moose/Cookbook/Basics/Point_AttributesAndSubclassing.pod) [有一些示例](http://search.cpan.org/~ether/Moose-2.2006/lib/Moose/Cookbook/Basics/BankAccount_MethodModifiersAndSubclassing.pod)）来执行您可能想要对参数和返回值进行的任何断言。

作为“滚动您自己的 DbC”的替代方法，您可以使用[MooseX::Method::Signatures](http://search.cpan.org/perldoc?MooseX::Method::Signatures)或[MooseX::Method](http://search.cpan.org/perldoc?MooseX::Method)之类的模块来处理传递给子例程的验证参数。但是，这些模块不处理 DbC 通常提供的“后”或“不变”验证。

**编辑：**受这个问题的启发，我一起破解了[MooseX::Contract](http://search.cpan.org/perldoc?MooseX::Contract)并将其上传到 CPAN。我很想获得有关 API 的反馈，因为我从未真正亲身使用过 DbC。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T04:28:32.507

Moose 是一个优秀的 perl oo 系统，我衷心推荐给任何用 perl 编写对象的人。您可以为您的类成员指定“子类型”，这些成员将在由访问器或构造函数设置时强制执行（同一系统可以与函数的 Moose::Methods 包一起使用）。如果您要编写多个衬里，请使用 Moose；

至于做 DbC，好吧，可能不是最适合 perl5。使用一种为您提供很少保证的语言将很难。就个人而言，在很多动态语言中，尤其是 perl，我倾向于使我的指导理念 DRY 和测试驱动开发。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T20:16:46.243

我还建议使用 Moose。

但是，作为“替代方案”，请查看[Sub::Contract](http://search.cpan.org/dist/Sub-Contract/lib/Sub/Contract.pm)。

引用作者的话......

> Sub::Contract 提供了一种实用的方式来通过 Perl 中的合约范式实现部分编程。
> 
> Sub::Contract 不是按合同设计的框架。
> 
> Sub::Contract 旨在使约束子例程输入参数和返回值变得非常容易，以便在运行时模拟强类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-25T19:14:00.420

如果您不需要类不变量，我发现以下 Perl Hacks 书籍推荐对于某些程序来说是一个很好的解决方案。见[`Smart::Comments`](http://search.cpan.org/perldoc?Smart::Comments#Checks_and_Assertions_via_Comments)。

# sql-server - 如何缩小我的 SQL Server 数据库？

> ID：439071
> 
> 赞同：55
> 
> 时间：2009-01-13T14:13:04.637
> 
> 标签：sql-server, database, shrink, msde2000

我有一个大小接近 1.9Gb 的数据库，而 MSDE2000 不允许超过 2.0Gb 的数据库

我需要缩小这个数据库（以及在不同客户端位置的许多其他数据库）。

我发现并删除了许多被认为不需要的 1000 条记录中的 100 条：这些记录占数据库中一些主要（最大）表的很大一部分。因此，假设现在应该可以检索到很多空间是合理的。

所以现在我需要缩小数据库来解决丢失的记录。

*   我执行`DBCC ShrinkDatabase('MyDB')`……没有效果。
*   我已经尝试过 MSSMS 中提供的各种收缩工具......仍然没有效果。
*   我已经备份了数据库并恢复了它......仍然没有效果。

还是 1.9Gb

为什么？

无论我最终找到什么过程，都需要在客户端机器上重播，除了 OSql 或类似的东西之外什么都不能访问。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-08-18T15:30:10.797

```
ALTER DATABASE MyDatabase SET RECOVERY SIMPLE

GO

DBCC SHRINKFILE (MyDatabase_Log, 5)

GO

ALTER DATABASE MyDatabase SET RECOVERY FULL

GO 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-13T15:16:15.353

这可能看起来很奇怪，但它对我有用，我已经编写了一个 C# 程序来自动化它。

第 1 步：截断事务日志（仅备份事务日志，打开删除不活动事务的选项）

第 2 步：运行数据库收缩，将所有页面移动到文件的开头

第 3 步：再次截断事务日志，因为第 2 步添加了日志条目

第 4 步：再次运行数据库收缩。

我使用 SQL DMO 库的精简代码如下：

```
SQLDatabase.TransactionLog.Truncate();
SQLDatabase.Shrink(5, SQLDMO.SQLDMO_SHRINK_TYPE.SQLDMOShrink_NoTruncate);
SQLDatabase.TransactionLog.Truncate();
SQLDatabase.Shrink(5, SQLDMO.SQLDMO_SHRINK_TYPE.SQLDMOShrink_Default); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-11-16T13:34:15.157

这是一个老问题，但我只是碰巧遇到了它。

已经给出了真正简短而正确的答案，并且获得了最多的选票。这就是**缩小**事务日志的方式，这可能是 OP 的问题。并且当事务日志变得失控时，通常需要将其缩回，但应注意防止将来出现日志失控的情况。[dba.se](https://dba.stackexchange.com/questions/29829/why-does-the-transaction-log-keep-growing-or-run-out-of-space/48296#48296)上的这个问题解释了这一点。**基本上 - 首先不要让它通过适当的恢复模型、事务日志维护、事务管理等变得那么大。**

但是当我阅读这个关于缩小数据文件（甚至日志文件）的问题时，我脑海中更大的问题是**为什么？**当你尝试时会发生**什么坏事？**看起来好像收缩操作已经完成。现在在这种情况下，它在某种意义上是有意义的——因为 MSDE/Express 版本的上限为最大 DB 大小。但正确的答案可能是查看适合您需求的正确版本。如果您偶然发现这个问题是为了缩小您的生产数据库，而这不是原因，您应该问自己**为什么？**问题。

我不希望有人在网上搜索“如何缩小数据库”并认为这是一件很酷或可以接受的事情。

收缩数据文件是一项特殊任务，应为特殊场合保留。考虑一下，当您缩小数据库时，您实际上是在对索引进行碎片化。考虑一下，当您收缩数据库时，您正在占用数据库可能有朝一日重新增长的可用空间 - 有效地浪费您的时间并导致收缩操作的性能损失只是为了看到数据库再次增长。

我在几篇关于缩小数据库的博客文章中写过这个概念。首先想到的是“[不要触摸那个收缩按钮](http://www.straightpathsql.com/archives/2009/01/dont-touch-that-shrink-button/)”。我讨论了这里概述的这些概念 - 以及“正确调整”数据库的概念。最好决定您的数据库需要多大，计划未来的增长并将其分配到该数量。借助 SQL Server 2005 及更高版本中可用于数据文件的即时文件初始化，增长的成本更低——但我仍然更喜欢有一个适当的初始应用程序——而且我对数据库中的空白空间的恐惧远比我害怕的要少得多普遍收缩，没有先考虑。:)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-13T14:38:36.707

`DBCC SHRINKDATABASE`对我有用，但这是它的完整语法：

```
DBCC SHRINKDATABASE ( database_name, [target_percent], [truncate] ) 
```

其中`target_percent`是缩小数据库后数据库文件中剩余的所需可用空间百分比。

`truncate`参数可以是：

```
NOTRUNCATE 
```

使释放的文件空间保留在数据库文件中。如果未指定，则释放的文件空间将释放给操作系统。

```
TRUNCATEONLY 
```

将数据文件中所有未使用的空间释放给操作系统，并将文件收缩到最后分配的范围，在不移动任何数据的情况下减小文件大小。不会尝试将行重新定位到未分配的页面。使用 TRUNCATEONLY 时忽略 target_percent。

...是的 no_one 是对的，缩小数据库不是很好的做法，因为例如：

缩小数据文件是引入大量逻辑碎片的极好方法，因为它将页面从数据库文件的分配范围的末尾移动到文件前面的某个位置......

收缩数据库可能会对数据库、服务器产生很多影响……在你做之前要好好考虑一下！

网上有很多关于它的博客和文章。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-06-28T09:07:27.300

迟到的答案，但可能对其他人有用

如果 DBCC ShrinkDatabase/ShrinkFile 或 SSMS (Tasks/Shrink/Database) 都没有帮助，Quest 和 ApexSQL 提供的工具可以完成工作，甚至在需要时安排定期收缩。

前段时间我在免费试用中使用过后者来执行此操作，在本文末尾进行了简短描述：

[https://solutioncenter.apexsql.com/sql-server-database-shrink-how-and-when-to-schedule-and-perform-shrinking-of-database-files/](https://solutioncenter.apexsql.com/sql-server-database-shrink-how-and-when-to-schedule-and-perform-shrinking-of-database-files/)

您需要做的就是安装 ApexSQL Backup，单击主功能区中的“收缩数据库”按钮，在弹出的窗口中选择数据库，然后单击“完成”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-01-08T16:13:02.817

你应该使用：

```
dbcc shrinkdatabase (MyDB) 
```

它将缩小日志文件（保持 Windows 资源管理器打开并查看它的发生）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-13T14:26:55.967

您还需要缩小各个数据文件。

然而，缩小数据库并不是一个好主意。例如看[这里](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1330922,00.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-01-08T16:24:40.150

“因此有理由假设现在应该可以回收很多空间。”

抱歉，如果我误解了这个问题，但是您确定是数据库而不是日志文件占用了空间吗？检查数据库的恢复模式。很有可能它是完整的，这意味着日志文件永远不会被截断。如果您不需要每个事务的完整记录，您应该可以更改为 Simple，这将截断日志。您可以在此过程中收缩数据库。假设一切顺利，该过程如下所示：

1.  备份数据库！
2.  更改为简单恢复
3.  Shrink db（右键单击 db，选择所有任务 > 收缩 db -> 设置为 10% 可用空间）
4.  验证空间是否已被回收，如果没有，您可能需要进行完整备份

如果这不起作用（或者当您尝试切换恢复模式时收到一条消息“日志文件已满”），请尝试以下操作：

1.  备份
2.  终止与数据库的所有连接
3.  分离数据库（右键单击 > 分离或右键单击 > 所有任务 > 分离）
4.  删除日志 (ldf) 文件
5.  重新连接数据库
6.  更改恢复模式

等等

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-13T14:48:29.917

这是另一个解决方案：使用[数据库发布向导](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A)将您的架构、安全性和数据导出到 sql 脚本。然后，您可以使当前的数据库脱机并使用脚本重新创建它。

听起来有点愚蠢，但有几个优点。首先，没有丢失数据的机会。您的原始数据库（只要您在删除数据库时不删除它！）是安全的，新数据库将大致尽可能小，并且您将拥有当前数据库的两个不同快照 - 一个已准备好滚动，一个缩小 - 您可以选择备份。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-07-23T18:11:16.183

尽管我需要在 MSSQL 2012 版本上进行 SHRINKFILE，但我还是遇到了这篇文章，这自 2000 或 2005 版本以来就有点棘手了。在阅读了与此问题相关的所有风险和问题后，我最终进行了测试。长话短说，我得到的最好结果来自使用**MS SQL Server Management Studio**。

```
Right-Click the DB -> TASKS -> SHRINK -> FILES -> select the LOG file 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-08-19T18:04:20.520

删除数据，确保恢复模型简单，然后 skrink（收缩数据库或收缩文件都可以）。如果数据文件仍然太大，并且您使用堆来存储数据 - 也就是说，大型表上没有聚集索引 - 那么您可能会遇到有关从堆中删除数据的问题：http: [//support.microsoft.com /kb/913399](http://support.microsoft.com/kb/913399)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T14:16:12.743

您还必须修改数据和日志文件的最小大小。DBCC SHRINKDATABASE 将收缩您已经分配的文件*中的数据。*要将文件缩小到小于其最小大小，请使用 DBCC SHRINKFILE 并指定新大小。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-07-11T19:00:45.617

我最近做了这个。我试图制作一个紧凑版本的数据库以便在路上进行测试，但无论我删除了多少行，我都无法缩小它。最终，在这个线程中的许多其他命令之后，我发现我的聚集索引在删除行后没有得到重建。重建我的索引使我可以正确收缩。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-12-31T23:22:14.287

我认为您可以通过从完全恢复切换到简单恢复来删除所有日志。右键单击您的数据库并选择`Properties`并选择`Options`并更改

*   `Recovery mode`至`Simple`
*   `Containment type`至`None`

[![从完整切换到简单](https://i.stack.imgur.com/wkMHW.png)](https://i.stack.imgur.com/wkMHW.png)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-09-01T14:45:54.347

不确定这有多实用，取决于数据库的大小、表的数量和其他复杂性，但我：

1.  对物理驱动器进行碎片整理
2.  根据我的要求，空间，百分比增长等创建一个新的数据库
3.  使用简单的 ssms 任务将旧数据库中的所有表导入新数据库
4.  编写旧数据库上所有表的索引，然后在新数据库上重新创建索引。根据需要扩展外键等。
5.  根据需要重命名数据库，确认成功，删除旧的

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-06-04T11:50:56.817

当您将恢复模式设置为简单（并启用自动收缩）时，SQL Server 仍有可能无法收缩日志。它与日志中的检查点（或缺少检查点）有关。

所以首先运行

```
DBCC CHECKDB 
```

在您的数据库上。之后，收缩操作应该像魅力一样工作。

通常我使用*Tasks>Shrink>Files*菜单并选择带有重新组织页面选项的日志文件。

# django - 如何在 satchmo 中使用多个运费值？

> ID：439074
> 
> 赞同：3
> 
> 时间：2009-01-13T14:13:43.840
> 
> 标签：django, satchmo, django-apps

已经有一些运输模块，例如 FEDEX、统一费率、每件和 UPS，但我怎样才能让用户选择其首选的运输方式和/或价格？

对于那些不知道的人，[Satchmo](http://www.satchmoproject.com/)是一个 django 应用程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T14:17:40.340

arg 我很笨。

刚刚通过再次浏览运输文件夹并阅读源代码找到了我的答案。

1.  好像我必须在我的 INSTALLED_APPS 列表中添加“satchmo.shipping.modules.tiered”应用程序。
2.  运行“python manage.py syncdb”在数据库中添加适当的模型
3.  使用管理界面在运营商表中添加一些自定义运营商

# ruby - 如何在某些事件上执行 ruby 脚本？

> ID：439084
> 
> 赞同：2
> 
> 时间：2009-01-13T14:17:20.683
> 
> 标签：ruby, events, shoes

我想从我的 Shoes 应用程序中执行另一个 ruby​​ 脚本。我试试

```
button "..." do
  `ruby -rubygems /Users/kemiisto/Desktop/Ruby/gears.rb`  
end 
```

但什么也没发生。在其他命令的情况下，例如

```
button "..." do
  `open /Applications/TextEdit.app/`  
end 
```

一切正常。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:17:03.743

事情正在发生，您只是没有对命令返回的文本做任何事情。当您通过“系统”或反引号运行系统命令时，每个命令都会返回转储到 STDOUT 的任何命令。

```
Shoes.app do
  @s = stack {}

  button "go!" do
    @out = `ls -al`
    @s.clear { para @out }
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-25T08:39:38.403

这可能是一种奇怪的方式。但我认为有效。
也许您使用 Mac ？（从您的路径），此代码适用于 Windows。
如果在 Mac 上，我认为您可以在执行终端后向终端发送命令。
或从 ruby​​ 执行 applescript。

希望下面的这个想法对你有帮助（为了胜利）。

```
require 'win32ole'

...some code...

button "..." do
  @auto = WIN32OLE.new('AutoItX3.Control')
  @auto.Run('cmd.exe','',@SW_MAXIMIZE)
  @auto.WinActivate("C:\WINDOWS\system32\cmd.exe")
  @auto.ControlSend("[CLASS:ConsoleWindowClass]", "", "", 'ruby -rubygems /Users/kemiisto/Desktop/Ruby/gears.rb')
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:43:43.337

```
load 
```

可能比

```
require 
```

在这里给你。Require 只会加载一次。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T13:17:00.357

一个简单的**要求**怎么样？它确实有效，但我想不出什么可以追溯之后的真实情况（除了**true** ，如果一切正常，则由**require返回）......尽管在这种情况下****系统**不会提供更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T01:37:10.857

我会尝试跑步

```
 Shoes.app do
        @s = stack {}
        button "debug" { @s.clear { para `which ruby` } }
    end 
```

所以你可以看到它调用了哪个 ruby​​ 调用，并从那里开始工作

更好的是，如果`open`有效，请尝试更改对`ruby`to的调用`/usr/bin/env ruby`。

# c# - 使用抽象类型的反射从表中获取实体

> ID：439086
> 
> 赞同：3
> 
> 时间：2009-01-13T14:17:31.073
> 
> 标签：c#, linq, abstraction

好的，所以我有一个名为 Product 的抽象类。我有 3 个表，分别称为 Items、Kits 和 Packages，它们实现了 Product。Product 具有公开对象主键的公共属性。

那就是说我有一个传递产品的表格。我想将该产品从一个新的数据上下文中拉出来，而不必编写一个反映它的类型的大开关来获得它的正确表。

我想做这样的事情，但演员表不接受 foo。

```
public BuilderInclusionsForm(Product p) : this()
        {            
            Type foo = p.GetType();
            product = db2.GetTable(p.GetType()).Cast<foo>().SingleOrDefault(a => 
                a.ProductID == p.ProductID); 
```

或这个：

```
public BuilderInclusionsForm(Product p) : this()
        {            
            Type foo = p.GetType();
            product = db2.GetTable(p.GetType()).OfType<foo>().SingleOrDefault(a => 
                a.ProductID == p.ProductID); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T14:24:06.427

不，因为类型参数必须在编译时知道才能出现在源代码中。

您可以在产品类型中使 BuilderInclusionsForm 通用，或者编写如下通用方法：

```
private static T FindProduct<T>(T product) where T : Product
{
    return db2.GetTable(typeof(T))
                     .OfType<T>()
                     .SingleOrDefault(a => a.ProductID == p.ProductID);
} 
```

然后用反射调用它：

```
public BuilderInclusionsForm(Product p) : this()
{            
    MethodInfo method = typeof(BuilderInclusionsForm).GetMethod("FindProduct",
         BindingFlags.Static | BindingFlags.NonPublic);
    MethodInfo concrete = method.MakeGenericMethod(new Type[] { p.GetType() });
    product = (Product) concrete.Invoke(null, new object[] { p });
} 
```

（显然您可以缓存该方法的开放形式。）

不好，但它应该工作。我怀疑将 BuilderInclusionsForm 设为通用会更好——你总是可以有一个辅助类：

```
public static class BuilderInclusionsForm
{
    public static BuilderInclusionsForm<T> Create<T>(T product) where T : Product
    {
        return new BuilderInclusionsForm<T>(product);
    }
} 
```

这将允许您使用类型推断。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T12:52:23.277

感谢 Skeet 先生，我团队中的一位聪明的成员指出了以下解决方案。

```
public BuilderInclusionsForm(Product p) : this()
{
    IEnumerable<Product> ps = db2.GetTable(p.GetType()).Cast<Product>();
    product = ps.SingleOrDefault(a => a.ProductID == p.ProductID);
} 
```

很抱歉浪费您的时间。请不要垃圾收集我对不起的屁股约翰。=oD

# jquery - 有没有什么好方法可以将现有的基于 YUI 的脚本转换为 JQuery 代码？

> ID：439096
> 
> 赞同：1
> 
> 时间：2009-01-13T14:21:11.487
> 
> 标签：jquery, asp.net-mvc, yui

我的网站基于 YUI，但由于我计划将我的网站升级到 .NET MVC 并且 JQuery 对 MVC 友好，所以我计划将现有的 YUI 脚本转换为 JQuery。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T00:00:49.377

我在所有 ASP.NET MVC 代码中都使用 YUI（2 和 3），在 YUI 中没有什么不是“MVC-Friendly”的。

也就是说，假设您使用的是 YUI2（YUI3 与 JQuery 更相似），将 YUI 转换为 JQuery 并不一定*很难*，但它们的使用方式确实不同。我会从在 JQuery 中编写新东西开始，直到我熟悉 JQuery 的语法和设计方式，然后开始将 YUI 转换为 JQuery。

但重申一下，如果您从 YUI 更改为 JQuery 的唯一原因是因为 MS 现在将它与 ASP.NET MVC 一起提供，那么您可能应该重新考虑这个决定。这根本没有必要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:29:50.830

您需要学习 jquery 样式和语法，所以先看看它是否适合您。我将首先对 JS 进行大量评论，以准确地跟踪以编程方式发生的事情，然后用新库完全重写 JS。

Jquery 可以比许多人意识到的更加紧凑和简洁，因此即使您仍然可以实现相同的目标，使用 YUI 的代码和使用 jquery 的代码之间可能没有直接关联。

# c++ - 以与数据库无关的方式构建查询

> ID：439097
> 
> 赞同：5
> 
> 时间：2009-01-13T14:21:16.463
> 
> 标签：c++, sql

在可以使用几乎任何关系数据库的 C++ 应用程序中，生成可以轻松扩展以允许数据库引擎的怪癖的查询的最佳方式是什么？

换句话说，代码可能需要以在各种数据库引擎之间不一致的方式检索数据。在客户端设计代码以生成查询的最佳方式是什么，这将使支持新的数据库引擎成为一件相对轻松的事情。

例如，如果我的 (MFC) 代码如下所示：

```
CString query = "SELECT id FROM table"
results = dbConnection->Query(query); 
```

我们决定支持一些使用“AVEC”而不是“FROM”的数据库。现在，每当用户使用该数据库引擎时，此查询都会失败。

到目前为止的选项：

*   最糟糕的选择：让进行查询的代码检查数据库类型。
*   更好的选择：在 db 连接对象上创建查询请求方法，该方法采用唯一的查询“代码”并根据正在使用的数据库引擎返回适当的查询。
*   更好的选择：创建一个查询构建器类，允许调用者在不直接使用任何 SQL 的情况下构建查询。查询完成后，调用者可以调用“生成”方法，该方法返回一个适合活动数据库引擎的查询字符串
*   最佳选择：??

注意：数据库引擎本身是通过我们自己创建的一些薄层抽象出来的。查询本身是唯一剩下的问题。

解决方案：
出于两个原因，我决定使用“更好”选项（查询“选择器”）。

1.  **调试**：如下所述，使用选择器方法进行调试会稍微容易一些，因为查询是预先构建的，并以可读的形式在代码中列出。
2.  **灵活性**：我想到有些数据库可能有更好的和完全不同的方法来解决特定的查询。例如，对于 Access，我每次都对多个表执行复杂的查询，因为我必须这样做，但在 Sql Server 上我想设置一个视图。从视图和几个表中选择是完全不同的查询（我认为），这个查询选择器可以轻松处理它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T14:39:34.553

您需要自己的查询编写对象，该对象可以由特定于数据库的实现继承。

所以你会做这样的事情：

```
DbAgnosticQueryObject query = new PostgresSQLQuery();
query.setFrom('foo');
query.setSelect('id');
// and so on
CString queryString = query.toString(); 
```

一旦您从单个表中经过简单的选择，它可能会变得非常复杂。已经有 ORM 包可以处理很多这些细微差别。可能值得看看它们而不是自己编写。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:32:16.363

**最佳选择：选择一个数据库，然后对其进行编码。**

您多久会在生产系统的后端启动和更换数据库？即使你这样做了，你要担心的不仅仅是轻微的语法问题。（诸如连接语法之类的主要内容，甚至*数据类型*在数据库之间也可能存在很大差异。）

现在，如果您正在设计一个商业应用程序，希望客户在实施时能够使用多个后端选项之一，那么您可能必须指定“我们支持 Oracle、MS SQl 或 MYSQL”和代码到那些特定的选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T14:44:58.817

您的所有选择都可以简化为

> 最糟糕的选择：让进行查询的代码检查数据库类型。

这只是您将检查数据库类型的逻辑放在哪里的问题。

我见过的在实践中效果最好的选项是

> 更好的选择：在 db 连接对象上创建查询请求方法，该方法采用唯一的查询“代码”并根据正在使用的数据库引擎返回适当的查询。

根据我的经验，独立于其余代码测试查询要容易*得多。*如果您有对象从语法位拼凑查询，这将变得更加困难，因为您必须测试查询创建代码和查询本身。

如果您将所有 SQL 提取到手动编写和维护的单独文件中，则可以让 SQL 专家编写它们（您仍然可以自动化这些查询的测试）。如果您尝试编写查询生成函数，那么您实际上将有一个 C++ 专家编写 SQL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T14:45:08.007

选择一个 ORM，然后开始映射。

如果您要支持多个数据库，您的问题只会变得更糟。
想想即将到来的数据库——没有（或几乎没有）SQL 的云数据库和对象数据库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T16:18:49.797

将您的查询放在代码之外 - 将它们放在数据库或资源文件中，并允许覆盖不同的数据库引擎。

如果您使用 SP，它可能会更容易，因为 SP 抽象了您的数据库差异。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T14:44:35.057

如果您需要支持多个数据库的能力，我认为您想要做的是创建一个数据提供者接口（或抽象类）和相关的具体实现。数据提供者需要支持您的标准查询运算符和其他常见的、受支持的功能，以支持您的查询操作（查看 .NET 3.5 中的 IEnumerable 扩展方法）。然后，每个具体的提供者将这些转换为基于目标数据库引擎的特定查询。

本质上，您所做的是创建一个数据库抽象层并让您的代码与之交互。如果你能找到其中的一个用于 C++，那么它可能值得购买而不是编写。您可能还想寻找 C++ 的控制反转 (IoC) 容器，它基本上可以做到这一点以及更多。我知道 Java 和 C# 的几个，但我不熟悉 C++ 的任何一个。

# jquery - 添加自定义 Html 属性可以吗？

> ID：439110
> 
> 赞同：22
> 
> 时间：2009-01-13T14:24:49.497
> 
> 标签：jquery, html, css

我有一个正在开发的网站，我想在其中标记一行数据是否已更改。如果该行中的某些内容发生了更改，我会使用这样的自定义属性对其进行标记。

```
<tr>
  <td isDirty="true">
     ....row data
  <td>
</tr> 
```

这对 jQuery 非常有效，并且不会向我的页面添加太多代码。

但这真的是做这样的事情的正确方法吗？缺点是什么？

我想另一种方法是这样的，但这似乎是过度杀戮。

```
<tr>
  <td>
     ....row data
     <input id="isDirty" type="hidden" value="true" />
  <td>
</tr> 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-13T14:32:03.383

为什么不使用 jQuery 数据功能？

您的示例将是（我不知道选择正确 td 的条件）：

```
$("tr td").data("isDirty", true); 
```

看看[文档](http://docs.jquery.com/Core/data#name)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-13T14:27:24.907

从技术上讲，您应该为此使用*class*属性。标签可以有多个类，所以它不应该影响任何东西

```
<td class="isDirty otherclass"> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-13T14:28:16.150

HTML 5 支持以“data-”为前缀的自定义属性。所以，我会用它来向前兼容。

至于早期版本，我认为它不会验证，但我不会担心。不过，我听说有些浏览器可能会忽略这些标签。所以，一定要全面测试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T14:27:17.230

我认为这将阻止您的页面进行验证，因为您正在添加验证器不知道的自定义属性。

您可能可以使用自己的 DTD 或模式来完成此操作，但这需要更多的工作。

我认为您的第二个示例是正确的方法。反正方向是对的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T14:31:12.963

为了坚持标准而坚持标准是坚持标准的坏理由。

您的页面指定 DTD，您的服务器指定 mimetype。只要您不发送真正的 xhtml，就没有理由不以这种方式使用 expando 属性。这会很有帮助。

好的，如果您需要关心，您的页面将不会“验证”然后不要这样做。

只是不要被 IE 访问此类值的“方便” elem.isDirty 方法所诱惑。始终使用 elem.getAttribute('isDirty') 来访问该值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T14:26:27.293

我强烈建议坚持标准。网络已经搞砸了；）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T14:32:41.290

我相信您的问题没有“是”或“否”的答案。在许多情况下，使用自定义属性将帮助您拥有更简洁的代码。你的例子很简单，我相信它不能展示这种技术的力量和灵活性。具体来说，您正在处理一个布尔属性，这很可能与外观有关。这类事情最好用一个班级来处理。但是，使用自定义属性，您可以向节点添加上下文。您可以使用此上下文进行一些计算。例如，将价格或重量属性添加到列表的节点。然后，您稍后使用这些字段来计算总和或平均值。我相信有很多比这个例子更好的例子。

另一方面，自定义属性将阻止 html 通过验证测试。这是一个重要的问题，未来可能会变得更加重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T14:51:28.897

从多个角度来看，使用自定义属性很有用，但请务必通过使用前缀来避免命名空间冲突：

`<td custom:isDirty="true">`

否则它可能会与未来的实现发生冲突。

作为旁注，DOM 元素可以像任何其他 js 对象一样具有自定义属性，这意味着如果您动态创建节点，您仍然可以将任何类型的自定义数据添加到您的元素，而不会影响验证。

```
var element = document.createElement('div');
element.myCustomObject = { foo: "bar", someFunction: function () { alert('foobar'); }};

document.body.appendChild(元素);

```

当然，对于那些在没有 jQuery、原型等框架的情况下从未编写过客户端脚本的人来说，上述内容是没有意义的...... :)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T15:19:45.503

isDirty 是一个类应该如何命名的完美示例。类名应该是语义的，我想不出更好的方法来分配一个类来描述该元素的含义（如果您想与最终用户共享该信息，则使用标题除外）？

除非您愿意维护自己的 DTD，否则不应设置自己的属性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T14:32:02.900

添加任意属性将意味着您的 HTML 不再有效。

但是，如果您使用的是 XHTML，我认为您可以添加具有不同 XML 名称空间的属性，这不会导致验证问题。

我对此知之甚少，但我想我会像其他人一样提及它。如果其他人有更好的理解，也许其他人可以扩展或反驳这一点？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-07T01:12:04.693

几年前，我使用了自定义属性，并且它们有效。按照 html 5 标准做同样的事情，将避免未来的问题，因为过去的问题不存在。未来的问题可能会出现在 movil 设备和其他不同于计算机的设备上，但是，由于它们将成为不久的将来的一部分，如果您想使用它们，请坚持使用 html 5 自定义属性。我的新案例很简单，我所做的是使用编码良好的标签，中间有简单的数据（变量数据），我通过 nodeValue 获得你的元素 ... this.firstChild.nodeValue ，关键是使用标签不按样式显示你是怎么得到这个的？getelementbyID，按标记名，按名称，按您选择的类名。优点 无需编码解码实体等，无需jquery

# c# - nHibernate 更新什么都不做

> ID：439112
> 
> 赞同：3
> 
> 时间：2009-01-13T14:25:13.240
> 
> 标签：c#, .net, nhibernate

我有一个非常奇怪的问题：有时当我调用 nHibernate update 到一个实体并且它工作时，有时它在同一个调用中什么都不做。当它不进行更新时，nHibernate 不会返回异常或类似的东西。它根本什么都不做。你有过这样的烦恼吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T14:29:01.907

我可能错了，但是保存和更新之类的东西不只是更新会话中的对象不持久吗？.Flush() 应该是将对象持久保存到数据库的原因，但是由于您得到间歇性结果...

**添加在：**

我想到的另一件事是，您的会话可能搞砸了？也许您正在创建 2 个会话，其中一个包含您更新的对象的一个​​与您调用 Update 的那个不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T15:41:46.690

您可以尝试[使用 NHProfiler](http://nhprof.com/)来查看您的会话/查询以及它们的调用堆栈。我同意 Programmin Tool 的观点，这听起来像是会话交叉的情况。您是否使用某种会话管理，例如每个请求一个会话？

# python - python中的随机小数

> ID：439115
> 
> 赞同：15
> 
> 时间：2009-01-13T14:26:49.243
> 
> 标签：python, random, decimal

如何获得随机[`decimal.Decimal`](https://docs.python.org/3.6/library/decimal.html#decimal-objects)实例？似乎随机模块仅返回浮点数，这些浮点数是要转换为小数的皮塔。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-13T15:09:41.450

什么是“随机小数”？小数具有任意精度，因此生成一个具有尽可能多的随机性的数字将占用您机器的整个内存来存储。

你必须知道你的随机数需要多少个小数位的精度，此时很容易抓取一个随机整数并将其相除。例如，如果您想要点上方的两位数和分数中的两位数（请参阅[此处的 randrange](https://docs.python.org/2/library/random.html#random.randrange)）：

```
decimal.Decimal(random.randrange(10000))/100 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-13T14:44:36.790

从[标准库参考](http://docs.python.org/dev/3.0/library/decimal.html)：

要从浮点数创建小数，首先将其转换为字符串。这可以明确提醒转换的细节（包括表示错误）。

```
>>> import random, decimal
>>> decimal.Decimal(str(random.random()))
Decimal('0.467474014342') 
```

你是这个意思吗？在我看来，它不像皮塔饼。您可以将其缩放到您想要的任何范围和精度。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-13T14:56:32.787

如果您知道逗号前后需要多少位数，则可以使用：

```
>>> import decimal
>>> import random
>>> def gen_random_decimal(i,d):
...  return decimal.Decimal('%d.%d' % (random.randint(0,i),random.randint(0,d)))

...
>>> gen_random_decimal(9999,999999) #4 digits before, 6 after
Decimal('4262.786648')
>>> gen_random_decimal(9999,999999)
Decimal('8623.79391')
>>> gen_random_decimal(9999,999999)
Decimal('7706.492775')
>>> gen_random_decimal(99999999999,999999999999) #11 digits before, 12 after
Decimal('35018421976.794013996282')
>>> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T16:04:14.210

random 模块提供的不仅仅是“仅返回浮点数”，但无论如何：

```
from random import random
from decimal import Decimal
randdecimal = lambda: Decimal("%f" % random.random()) 
```

还是我在您的问题中遗漏了一些明显的东西？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-07T14:05:04.463

```
decimal.Decimal(random.random() * MAX_VAL).quantize(decimal.Decimal('.01')) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-26T13:48:00.233

另一种制作随机小数的方法。

```
import random
round(random.randint(1, 1000) * random.random(), 2) 
```

在这个例子中，

*   **random.randint()**生成指定范围内的随机整数（包括），
*   **random.random()**在 (0.0, 1.0) 范围内生成随机浮点数
*   最后，**round()**函数将上述值乘法的乘法结果（长如 254.71921934351644）四舍五入到小数点后的指定数字（在我们的例子中，我们得到 254.71）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2018-04-04T18:44:46.510

```
import random
y = eval(input("Enter the value of y for the range of random number : "))
x = round(y*random.random(),2)  #only for 2 round off 
print(x) 
```

# authentication - 如何配置 Tomcat 以使用 Windows NTLM 身份验证？

> ID：439120
> 
> 赞同：11
> 
> 时间：2009-01-13T14:27:39.397
> 
> 标签：authentication, tomcat, active-directory

我想对 Tomcat 使用 NTLM 身份验证，以便 Iexplorer 自动将用户 id+pwd 发送到 webapp。这可能吗？

使用“BASIC”身份验证 IE 会弹出通常的密码对话框，但我想跳过此对话框。（注意，我使用 JNDIReal/ldap）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-05-20T14:27:38.490

是的，现在可以使用支持协商（NTLM v1、v2 等和 Kerberos）的 Waffle Tomcat Authenticator。

*   教程： [http ://code.dblock.org/ShowPost.aspx?id=103](http://code.dblock.org/ShowPost.aspx?id=103)
*   华夫饼： [http ://dblock.github.io/waffle/](http://dblock.github.io/waffle/)

华夫饼仅适用于**Windows 服务器**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T15:08:42.810

是的。[Tomcat Wiki](http://wiki.apache.org/tomcat/FAQ/Windows#Q4)引用了有关使 Tomcat 能够进行 NTLM 身份验证的 Samba 代码的[文档。](http://jcifs.samba.org/src/docs/ntlmhttpauth.html)

Samba 社区实现了一个 Servlet 过滤器，它允许对域控制器的用户进行身份验证。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-29T19:00:39.813

或者，如果您使用的是 Windows 服务器，则可以让 IIS 进行身份验证并将请求重定向到 Tomcat。这是文档：http: [//tomcat.apache.org/connectors-doc/webserver_howto/iis.html](http://tomcat.apache.org/connectors-doc/webserver_howto/iis.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-26T09:59:51.270

*   [JCIF](http://jcifs.samba.org/src/docs/ntlmhttpauth.html)现在 (2011) 已弃用（不支持 NTLM v2）。
*   [JESPA](http://www.ioplex.com/jespa.html)不是免费的，但可能适合您
*   [Waffle](http://waffle.codeplex.com)仅适用于 Windows 服务器

您可能想查看 UnboundID 的 LDAP 解决方案[www.unboundid.com/products/ldapsdk/](http://www.unboundid.com/products/ldapsdk/) 还没有尝试过，但似乎是一种妥协。

以下是 UnboundID SDK、JNDI 和 Netscape SDK 之间的快速比较：[www.unboundid.com/products/ldap-sdk/docs/advantages/comparison.php](http://www.unboundid.com/products/ldap-sdk/docs/advantages/comparison.php)。它可能有偏见，因为它位于 unbound 的网站上，但是，嘿，让您很好地了解为什么您可能会考虑它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T19:44:50.890

来自 JCIFS 项目的人（在 mkoller 的回答中再次提到）说他们提供的解决方案与 NTLMv2 不兼容......

[http://jcifs.samba.org/src/docs/ntlmhttpauth.html](http://jcifs.samba.org/src/docs/ntlmhttpauth.html)

你应该检查[http://www.ioplex.com/jespa.html](http://www.ioplex.com/jespa.html)，它不是免费的......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-11T15:29:32.973

我并排使用过 JCIFS、Waffle 和 IIS。

*   JCIFS 不支持 NTLM v2，有时会提示用户
*   Waffle 支持 NTLM v2，但有时会提示用户
*   IIS 是唯一可以 100% 进行无提示 NTLM 身份验证的解决方案

# svn - SVN 中是否可以使用 CVS 样式的结帐挂钩？

> ID：439125
> 
> 赞同：1
> 
> 时间：2009-01-13T14:29:18.753
> 
> 标签：svn, hook, cvs, svn-checkout

我们正在从 CVS 迁移到 SVN，据我所知，SVN 没有结帐挂钩。在 CVS 中，post checkout 操作是`-o`在模块文件中定义模块时使用选项定义的。这种行为在 SVN 中可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T14:35:42.487

请澄清：您想使用*结帐*挂钩做什么？

我从来没有真正成为 CVS 用户，所以我不知道通过使用签出挂钩（实际上我不知道它们）解决了哪些常见用例（想要...）。

SVN 提供了 pre-commit 和 post-commit 钩子（以及其他一些钩子），它们应该能够在源代码的每次更改时做任何想做的事情。

如果您需要对工作副本进行一些自动签出后处理，那么除了编写脚本并提醒客户执行它们之外，您将没有太多其他选择。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-01-13T15:40:46.240

可能“替代品”指的是“钩子”而不是 SVN，但目前，我看到比 SVN 更好的系统迁移（例如，Mercurial、Git）......即使有人不跟随 Linus Torvalds 看到“[颠覆”成为有史以来最无意义的项目](http://www.youtube.com/watch?v=4XpnKHJAok8)'..

# xml - 你能重用 XML 的片段（以某种变量/引用的方式）吗？

> ID：439129
> 
> 赞同：1
> 
> 时间：2009-01-13T14:31:38.733
> 
> 标签：xml, reusability, sld

我正在使用[SLD](http://en.wikipedia.org/wiki/Styled_Layer_Descriptor)来设置我的地理服务器的输出样式。我有几种类型的对象要显示。每种类型都有不同的图标，但文本描述是从相同的信息（数据库中的文本字段）生成的。我不能使用 object_type 作为图像名称，因为您不能在图像名称中使用变量（或者我不知道该怎么做......）。所以我有 SLD 喜欢（没有不重要的部分）：

```
<StyledLayerDescriptor>
  <NamedLayer>
    <UserStyle>
      <FeatureTypeStyle>
        <Rule>
          <Filter>
            <PropertyIsEqualTo>
              <PropertyName>object_type</PropertyName>
              <Literal>1</Literal>
            </PropertyIsEqualTo>
          </Filter>
          <PointSymbolizer>
            <Graphic>
              <ExternalGraphic>
                <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="/images/1.png" />
                <Format>image/png</Format>
              </ExternalGraphic>
              <Size>16</Size>
              <Opacity>1</Opacity>
            </Graphic>
          </PointSymbolizer>
          <TextSymbolizer>
            <Label>
              <ogc:PropertyName>name</ogc:PropertyName>
            </Label>
            <Font>
              <CssParameter name="font-family">Times New Roman</CssParameter>
              <CssParameter name="font-style">Normal</CssParameter>
              <CssParameter name="font-size">12</CssParameter>
            </Font>
            <Fill>
              <CssParameter name="fill">#110011</CssParameter>
              <CssParameter name="fill-opacity">1</CssParameter>
            </Fill>
            <Halo />
          </TextSymbolizer>
        </Rule>

        <Rule>
          <Filter>
            <PropertyIsEqualTo>
              <PropertyName>object_type</PropertyName>
              <Literal>2</Literal>
            </PropertyIsEqualTo>
          </Filter>
          <PointSymbolizer>
            <Graphic>
              <ExternalGraphic>
                <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="/images/2.png" />
                <Format>image/png</Format>
              </ExternalGraphic>
              <Size>16</Size>
              <Opacity>1</Opacity>
            </Graphic>
          </PointSymbolizer>
          <TextSymbolizer>
            <Label>
              <ogc:PropertyName>name</ogc:PropertyName>
            </Label>
            <Font>
              <CssParameter name="font-family">Times New Roman</CssParameter>
              <CssParameter name="font-style">Normal</CssParameter>
              <CssParameter name="font-size">12</CssParameter>
            </Font>
            <Fill>
              <CssParameter name="fill">#110011</CssParameter>
              <CssParameter name="fill-opacity">1</CssParameter>
            </Fill>
            <Halo />
          </TextSymbolizer>
        </Rule>
      </FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor> 
```

我想做的事情是编写一次 TextSymbolizer 并在两个或更多地方使用它......我还没有听说过 XML 中的类似内容，但也许你有？:-)

我想到的一种解决方案是编写一些非常简单的生成器（xml.erb？：P）并让它生成 XML ......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:11:09.903

您是否尝试过为您的 XML 定义[XML Schema](http://www.w3.org/XML/Schema)或可选的[XML DTD](http://www.w3.org/XML/1998/06/xmlspec-report-v21.htm)，然后使用[元素标识符 http://www.w3.org/TR/xmlschema-0/#schemaConstraintsVsXML1](http://www.w3.org/TR/xmlschema-0/#schemaConstraintsVsXML1)，类似于：

```
 <StyledLayerDescriptor>
  <NamedLayer>
    <CommonStyles>
      <TextSymbolizer id="name_times_normal_12">
        <Label>
          <ogc:PropertyName>name</ogc:PropertyName>
        </Label>
        <Font>
          <CssParameter name="font-family">Times New Roman</CssParameter>
          <CssParameter name="font-style">Normal</CssParameter>
          <CssParameter name="font-size">12</CssParameter>
        </Font>
        <Fill>
          <CssParameter name="fill">#110011</CssParameter>
          <CssParameter name="fill-opacity">1</CssParameter>
        </Fill>
        <Halo />
      </TextSymbolizer>
    </CommonStyles>
    <UserStyle>
      <FeatureTypeStyle>
        <Rule>
          <Filter>
            <PropertyIsEqualTo>
              <PropertyName>object_type</PropertyName>
              <Literal>1</Literal>
            </PropertyIsEqualTo>
          </Filter>
          <PointSymbolizer>
            <Graphic>
              <ExternalGraphic>
                <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="/images/1.png" />
                <Format>image/png</Format>
              </ExternalGraphic>
              <Size>16</Size>
              <Opacity>1</Opacity>
            </Graphic>
          </PointSymbolizer>
          <TextSymbolizer ref="#name_times_normal_12" />
        </Rule>
        <Rule>
          <Filter>
            <PropertyIsEqualTo>
              <PropertyName>object_type</PropertyName>
              <Literal>2</Literal>
            </PropertyIsEqualTo>
          </Filter>
          <PointSymbolizer>
            <Graphic>
              <ExternalGraphic>
                <OnlineResource xmlns:xlink="http://www.w3.org/1999/xlink" xlink:type="simple" xlink:href="/images/2.png" />
                <Format>image/png</Format>
              </ExternalGraphic>
              <Size>16</Size>
              <Opacity>1</Opacity>
            </Graphic>
          </PointSymbolizer>
          <TextSymbolizer ref="#name_times_normal_12" />
        </Rule>
      </FeatureTypeStyle>
    </UserStyle>
  </NamedLayer>
</StyledLayerDescriptor> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-23T15:43:50.773

XML 包括？ [http://www.xml.com/pub/a/2002/07/31/xinclude.html](http://www.xml.com/pub/a/2002/07/31/xinclude.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-29T04:24:56.480

GeoServer 对 SLD 的“动态符号器”扩展确实允许您将数据库属性用作图标 URL 的全部或部分。如果需要，您甚至可以执行计算和调用过滤器函数（它们在 URL 中使用嵌入式 CQL。

这是有关该功能的博客文章：http: [//blog.geoserver.org/2008/12/08/dynamic-symbolizers-part-1/](http://blog.geoserver.org/2008/12/08/dynamic-symbolizers-part-1/)

# sql - 按表中的分组记录运行总计

> ID：439138
> 
> 赞同：12
> 
> 时间：2009-01-13T14:34:17.573
> 
> 标签：sql, oracle, grouping, sum, cumulative-sum

我有一张这样的表（Oracle，10）

```
Account     Bookdate     Amount
      1     20080101        100
      1     20080102        101
      2     20080102        200
      1     20080103       -200
... 
```

我需要的是由 Account asc 和 Bookdate asc 按 Account order 分组的新表，其中包含一个运行总计字段，如下所示：

```
Account     Bookdate     Amount     Running_total
      1     20080101        100               100
      1     20080102        101               201
      1     20080103       -200                 1
      2     20080102        200               200
... 
```

有没有简单的方法来做到这一点？

提前致谢。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-13T15:33:00.530

你真的需要额外的桌子吗？

您可以通过一个简单的查询获得所需的数据，如果您希望它看起来像一个表格，您显然可以将其创建为一个视图。

这将为您提供您正在寻找的数据：

```
select 
    account, bookdate, amount, 
    sum(amount) over (partition by account order by bookdate) running_total
from t
/ 
```

这将创建一个视图来向您显示数据，就好像它是一个表格一样：

```
create or replace view t2
as
select 
    account, bookdate, amount, 
    sum(amount) over (partition by account order by bookdate) running_total 
from t
/ 
```

如果你真的需要这张桌子，你的意思是你需要它不断更新吗？还是只打一次？显然，如果它是一次性的，您可以使用上述查询“创建表作为选择”。

我使用的测试数据是：

```
create table t(account number, bookdate date, amount number);

insert into t(account, bookdate, amount) values (1, to_date('20080101', 'yyyymmdd'), 100);

insert into t(account, bookdate, amount) values (1, to_date('20080102', 'yyyymmdd'), 101);

insert into t(account, bookdate, amount) values (1, to_date('20080103', 'yyyymmdd'), -200);

insert into t(account, bookdate, amount) values (2, to_date('20080102', 'yyyymmdd'), 200);

commit; 
```

编辑：

忘记添加了；您指定要对表进行排序-这实际上没有意义，并且让我认为您的真正意思是您想要查询/视图-排序是您执行的查询的结果，而不是固有的东西表（忽略索引组织表等）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T15:25:58.127

我将从这个非常重要的警告开始：不要创建一个表来保存这些数据。当你这样做时，你会发现你需要维护它，这将成为一个永无止境的头痛。如果您想这样做，请编写一个视图以返回额外的列。如果您正在使用数据仓库，那么**也许**您会做这样的事情，但即便如此，您也会在视图方面犯错，除非您根本无法通过索引、体面的硬件等获得所需的性能。

这是一个查询，它将以您需要的方式返回行。

```
SELECT
    Account,
    Bookdate,
    Amount,
    (
        SELECT SUM(Amount)
        FROM My_Table T2
        WHERE T2.Account = T1.Account
          AND T2.Bookdate <= T1.Bookdate
    ) AS Running_Total
FROM
    My_Table T1 
```

另一种可能的解决方案是：

```
SELECT
    T1.Account,
    T1.Bookdate,
    T1.Amount,
    SUM(T2.Amount)
FROM
    My_Table T1
LEFT OUTER JOIN My_Table T2 ON
    T2.Account = T1.Account AND
    T2.Bookdate <= T1.Bookdate
GROUP BY
    T1.Account,
    T1.Bookdate,
    T1.Amount 
```

测试它们的性能，看看哪个更适合你。此外，除了您提供的示例之外，我还没有对它们进行彻底测试，因此请务必测试一些边缘情况。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T15:34:24.333

使用分析，就像在上一个问题中一样：

```
create table accounts
( account number(10)
, bookdate date 
, amount   number(10)
);

delete accounts;

insert into accounts values (1,to_date('20080101','yyyymmdd'),100);
insert into accounts values (1,to_date('20080102','yyyymmdd'),101);
insert into accounts values (2,to_date('20080102','yyyymmdd'),200);
insert into accounts values (1,to_date('20080103','yyyymmdd'),-200);

commit;

select account
,      bookdate 
,      amount
,      sum(amount) over (partition by account order by bookdate asc) running_total
from accounts
order by account,bookdate asc
/ 
```

输出：

```
 ACCOUNT BOOKDATE     AMOUNT RUNNING_TOTAL
---------- -------- ---------- -------------
         1 01-01-08        100           100
         1 02-01-08        101           201
         1 03-01-08       -200             1
         2 02-01-08        200           200 
```

# build-automation - 有哪些学习使用 NAnt 的好资源？

> ID：439143
> 
> 赞同：8
> 
> 时间：2009-01-13T14:35:19.100
> 
> 标签：build-automation, nant, alt.net

我从来没有使用过自动构建系统——老实说，我从来没有用过它，因为我是一个单独的开发人员（不是自愿）并且只在我的工作站上进行开发，所以使用 Visual 中的 Build 菜单工作室对我来说已经足够好了。

我正在努力学习更多好的软件工程实践，持续集成就是其中之一。但是，我知道我需要使用自动构建脚本来设置 CI 环境，但我从未使用过，也不知道从哪里开始。

我听说 NAnt 是大多数专业开发人员使用的非常好的一个（尽管 MSBuild 类似？）。有哪些很好的资源可以正确学习如何使用 NAnt？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T15:39:25.790

开始学习的最佳地点是深入研究一个小项目并参考[NAnt 用户手册](http://nant.sourceforge.net/release/latest/help/)。

除此之外，这里有一些我过去发现有帮助的地方：

*   [邮件列表](http://nant.sourceforge.net/mailinglists.html)(sourceforge)
*   [NAnt 入门系列](http://blog.jpboodhoo.com/NAntStarterSeries.aspx)(Jean-Paul S. Boodhoo)
*   [NAnt 简介](http://aspnet.4guysfromrolla.com/articles/120104-1.aspx)（Rolla 的 4 人）
*   [使用 NAnt 管理 .NET 开发](http://www.theserverside.net/tt/articles/showarticle.tss?id=NAnt)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T02:40:01.463

[我们在http://dimecasts.net/Casts/ByTag/NAnt](http://dimecasts.net/Casts/ByTag/NAnt)上整理了一些关于 Nant 的优秀屏幕截图

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T05:07:38.170

帮助我的资源是查看其他人创建的一些实际项目。挑选一些使用 .NET 和 NAnt 的项目，下载源代码，查看它们的构建文件以及它们是如何组织的。这可能会阐明您为什么要使用某些东西以及一些提示和技巧。

对我查看他们的 NAnt 构建过程很有用的示例项目：

*   NAnt，他们有 NAnt 文件来构建整个东西，最好向谁学习？
*   单元
*   SharpZipLib

# sql - SQL 连接是如何工作的？

> ID：439152
> 
> 赞同：5
> 
> 时间：2009-01-13T14:39:32.057
> 
> 标签：sql, database, oracle, join

我试图了解连接如何在内部工作。以下两个查询的运行方式有什么区别？

```
For example

(A)

Select * 
FROM TABLE1
FULL JOIN TABLE2 ON TABLE1.ID = TABLE2.ID
FULL JOIN TABLE3 ON TABLE1.ID = TABLE3.ID

And

(B)

Select * 
FROM TABLE1
FULL JOIN TABLE2 ON TABLE1.ID = TABLE2.ID
FULL JOIN TABLE3 ON TABLE2.ID = TABLE3.ID 
```

编辑：我在这里谈论甲骨文。考虑表 2 和表 3 中存在但表 1 中不存在的一些记录，查询 A 将为该记录提供两行，但 B 将仅提供一行。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T14:47:04.413

DBMS 的优化器将确定如何最好地执行查询。通常这是通过“基于成本的优化”来完成的，其中考虑了许多不同的查询计划并选择了最有效的一个。 **如果**您的两个查询在逻辑上是相同的，那么优化器很可能最终会使用相同的查询计划，无论您以何种方式编写它。事实上，如今基于 SQL 中如此细微的差异生成不同的查询计划，这将是一个糟糕的优化器。

但是，完全外部连接是另一回事（至少在 Oracle 中），因为连接列的方式会影响结果。即 2 个查询**不可**互换。

您可以在 SQL Plus 中使用 AUTOTRACE 来查看不同的计划：

```
SQL> select *
  2  from t1
  3  full join t2 on t2.id = t1.id
  4  full join t3 on t3.id = t2.id;

        ID         ID         ID
---------- ---------- ----------
                    1          1

1 row selected.

Execution Plan
----------------------------------------------------------

---------------------------------------------------------------------
| Id  | Operation               | Name | Rows  | Bytes | Cost (%CPU)|
---------------------------------------------------------------------
|   0 | SELECT STATEMENT        |      |     3 |   117 |    29  (11)|
|   1 |  VIEW                   |      |     3 |   117 |    29  (11)|
|   2 |   UNION-ALL             |      |       |       |            |
|*  3 |    HASH JOIN OUTER      |      |     2 |   142 |    15  (14)|
|   4 |     VIEW                |      |     2 |    90 |    11  (10)|
|   5 |      UNION-ALL          |      |       |       |            |
|*  6 |       HASH JOIN OUTER   |      |     1 |    91 |     6  (17)|
|   7 |        TABLE ACCESS FULL| T1   |     1 |    52 |     2   (0)|
|   8 |        TABLE ACCESS FULL| T2   |     1 |    39 |     3   (0)|
|*  9 |       HASH JOIN ANTI    |      |     1 |    26 |     6  (17)|
|  10 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|  11 |        TABLE ACCESS FULL| T1   |     1 |    13 |     2   (0)|
|  12 |     TABLE ACCESS FULL   | T3   |     1 |    26 |     3   (0)|
|* 13 |    HASH JOIN ANTI       |      |     1 |    26 |    15  (14)|
|  14 |     TABLE ACCESS FULL   | T3   |     1 |    13 |     3   (0)|
|  15 |     VIEW                |      |     2 |    26 |    11  (10)|
|  16 |      UNION-ALL          |      |       |       |            |
|* 17 |       HASH JOIN OUTER   |      |     1 |    39 |     6  (17)|
|  18 |        TABLE ACCESS FULL| T1   |     1 |    26 |     2   (0)|
|  19 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|* 20 |       HASH JOIN ANTI    |      |     1 |    26 |     6  (17)|
|  21 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|  22 |        TABLE ACCESS FULL| T1   |     1 |    13 |     2   (0)|
---------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("T3"."ID"(+)="T2"."ID")
   6 - access("T2"."ID"(+)="T1"."ID")
   9 - access("T2"."ID"="T1"."ID")
  13 - access("T3"."ID"="T2"."ID")
  17 - access("T2"."ID"(+)="T1"."ID")
  20 - access("T2"."ID"="T1"."ID")

SQL> select *
  2  from t1
  3  full join t2 on t2.id = t1.id
  4  full join t3 on t3.id = t1.id;

        ID         ID         ID
---------- ---------- ----------
                    1
                               1

2 rows selected.

Execution Plan
----------------------------------------------------------

---------------------------------------------------------------------
| Id  | Operation               | Name | Rows  | Bytes | Cost (%CPU)|
---------------------------------------------------------------------
|   0 | SELECT STATEMENT        |      |     3 |   117 |    29  (11)|
|   1 |  VIEW                   |      |     3 |   117 |    29  (11)|
|   2 |   UNION-ALL             |      |       |       |            |
|*  3 |    HASH JOIN OUTER      |      |     2 |   142 |    15  (14)|
|   4 |     VIEW                |      |     2 |    90 |    11  (10)|
|   5 |      UNION-ALL          |      |       |       |            |
|*  6 |       HASH JOIN OUTER   |      |     1 |    91 |     6  (17)|
|   7 |        TABLE ACCESS FULL| T1   |     1 |    52 |     2   (0)|
|   8 |        TABLE ACCESS FULL| T2   |     1 |    39 |     3   (0)|
|*  9 |       HASH JOIN ANTI    |      |     1 |    26 |     6  (17)|
|  10 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|  11 |        TABLE ACCESS FULL| T1   |     1 |    13 |     2   (0)|
|  12 |     TABLE ACCESS FULL   | T3   |     1 |    26 |     3   (0)|
|* 13 |    HASH JOIN ANTI       |      |     1 |    26 |    15  (14)|
|  14 |     TABLE ACCESS FULL   | T3   |     1 |    13 |     3   (0)|
|  15 |     VIEW                |      |     2 |    26 |    11  (10)|
|  16 |      UNION-ALL          |      |       |       |            |
|* 17 |       HASH JOIN OUTER   |      |     1 |    39 |     6  (17)|
|  18 |        TABLE ACCESS FULL| T1   |     1 |    26 |     2   (0)|
|  19 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|* 20 |       HASH JOIN ANTI    |      |     1 |    26 |     6  (17)|
|  21 |        TABLE ACCESS FULL| T2   |     1 |    13 |     3   (0)|
|  22 |        TABLE ACCESS FULL| T1   |     1 |    13 |     2   (0)|
---------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   3 - access("T3"."ID"(+)="T1"."ID")
   6 - access("T2"."ID"(+)="T1"."ID")
   9 - access("T2"."ID"="T1"."ID")
  13 - access("T3"."ID"="T1"."ID")
  17 - access("T2"."ID"(+)="T1"."ID")
  20 - access("T2"."ID"="T1"."ID") 
```

实际上，除了 Predicate 信息之外，查询计划是相同的

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T14:48:06.690

使用解释计划：

[http://download.oracle.com/docs/cd/B10500_01/server.920/a96533/ex_plan.htm](http://download.oracle.com/docs/cd/B10500_01/server.920/a96533/ex_plan.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T14:58:16.840

您表示对“内部”感兴趣，然后询问了一个说明“语义”的示例。我在回答语义。

考虑这些表。

```
Table1 : 1, 4, 6
Table2 : 2, 4, 5
Table3 : 3, 5, 6 
```

这两个示例首先执行相同的连接，所以我将在此处执行。

```
FirstResult = T1 FULL JOIN T2 : (T1, T2)
(1, null)
(4, 4)
(6, null)
(null, 2)
(null, 5) 
```

示例（一）

```
FirstResult FULL JOIN T3 ON FirstItem : (T1, T2, T3)

(1, null, null)
(4, 4, null)
(6, null, 6)   <----
(null, 2, null)
(null, 5, null)   <----
(null, null, 3) 
```

示例（B）

```
FirstResult FULL JOIN T3 ON SecondItem : (T1, T2, T3)
(1, null, null)
(4, 4, null)
(6, null, null)   <----
(null, 2, null)
(null, 5, 5)   <----
(null, null, 3) 
```

这从逻辑上向您展示了如何从连接中生成结果。

对于“内部”，有一种叫做查询优化器的东西，它会产生相同的结果——但它会做出实现选择以快速进行计算/io。这些选择包括：

*   首先访问哪些表
*   使用索引或表扫描查看表
*   要使用的连接实现类型（嵌套循环、合并、散列）。

另请注意：由于优化器做出了这些选择，并根据它认为是最优的来改变这些选择——结果的顺序可能会改变。结果的默认顺序始终是“最简单的”。如果您不想要默认排序，则需要在查询中指定排序。

要准确了解优化器将如何处理查询（此时，因为它可以改变主意），您需要查看执行计划。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T04:59:52.600

使用查询 A，您获得的内容包括表 1 中的条目以及 table3 中的相应条目，而 table3 中没有相应的条目（t2 列的空值）

使用查询 B，您不会获得这些条目，因为您只能通过 table2 进入 table3。如果您在 table2 中没有相应的条目，则 table2.id 将为 null 并且永远不会匹配 table3.id

# c# - 如何解锁 COM 端口

> ID：439153
> 
> 赞同：3
> 
> 时间：2009-01-13T14:39:32.697
> 
> 标签：c#, serial-port, unlock

我有一个必须在另一个应用程序之后工作的应用程序。第二个应用程序有一个错误，导致 COM 端口在特定情况下不关闭。

我想在我的应用程序中以编程方式关闭所有 COM 端口，以确保不会报告有关关闭端口的错误。如果我不拥有打开 COM 端口的对象，是否有可能？

我需要一个关于 .NET Framework, C# 的解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:53:59.473

没有好的，简单的方法：

*   一个**好**方法是修复其他应用程序；或者如果这不可能，编写一个过滤设备驱动程序（类似于 parport 驱动程序，但用于串行端口而不是并行端口），它将位于串行端口硬件驱动程序的顶部，并且会暴露多个连接点（一个由另一个应用程序，它传递到底层的真实驱动程序，以及您自己的应用程序使用的另一个“后门”......真正的驱动程序只会看到一个客户端，即位于其顶部的过滤器驱动程序）
*   一个**简单**的方法是核对（强制终止）另一个进程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-08-04T15:38:52.353

我最近遇到了这个问题，并且有一点要补充……当设备在设备管理器中启用和禁用时，大多数 COM 端口驱动程序都会“解锁”端口。这意味着解决方案中描述了完成此任务的（C#）方式：

[Win32 API 函数以编程方式启用/禁用设备](https://stackoverflow.com/questions/1438371/win32-api-function-to-programmatically-enable-disable-device/1610140#1610140)

为 COM 端口使用该解决方案需要了解的信息是：

1.  COM 端口的 GUID：{4d36e978-e325-11ce-bfc1-08002be10318} (CLSID_Ports)
2.  您要重置的端口的“实例路径”

由于您说要重置*所有*端口，因此您需要修改该示例中的库以通过更改来遍历所有端口：

```
// Find the index of our instance. i.e. the touchpad mouse - I have 3 mice attached...
int index = GetIndexOfInstance(diSetHandle, diData, instanceId);
// Disable...
EnableDevice(diSetHandle, diData[index], enable); 
```

像这样：

```
for (int index = 0; index < diData.Length; index++)
{
    EnableDevice(diSetHandle, diData[index], enable);
} 
```

# inversion-of-control - StructureMap - 覆盖命名实例的构造函数参数

> ID：439156
> 
> 赞同：5
> 
> 时间：2009-01-13T14:40:53.520
> 
> 标签：inversion-of-control, structuremap

您能否覆盖命名实例的构造函数参数，看来您只能为默认实例执行此操作。

我想要做：

```
ObjectFactory.With("name").EqualTo("Matt").GetNamedInstance<IActivity>("soccer"); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-14T19:43:17.630

在 .With 之后使用时，GetInstance 的行为类似于 GetNamedInstance

```
 using NUnit.Framework;
using NUnit.Framework.SyntaxHelpers;
using StructureMap;

namespace StructureMapWith
{
    [TestFixture]
    public class Class1
    {

        public interface IFooParent
        {
            IFoo Foo { get; set; }
        }
        public interface IFoo
        {

        }

        public class FooParentLeft : IFooParent
        {
            public IFoo Foo { get; set; }

            public FooParentLeft(IFoo foo)
            {
                Foo = foo;
            }
        }

        public class FooParentRight : IFooParent
        {
            public IFoo Foo { get; set; }

            public FooParentRight()
            {

            }
            public FooParentRight(IFoo foo)
            {
                Foo = foo;
            }
        }

        public class Left : IFoo { }
        public class Right : IFoo { }

        [Test]
        public void See_what_with_does_more()
        {
            ObjectFactory.Initialize(c =>
                                        {
                                            c.ForRequestedType()
                                                .AddInstances(i =>
                                                                  {
                                                                      i.OfConcreteType().WithName("Left");
                                                                      i.OfConcreteType().WithName("Right");
                                                                  });
                                            c.ForRequestedType()
                                                .AddInstances(i =>
                                                                  {
                                                                      i.OfConcreteType().WithName("Left");
                                                                      i.OfConcreteType().WithName(
                                                                          "Right");
                                                                  });
                                        });

            var returned = ObjectFactory.With(typeof (IFoo), new Right())
                .With(typeof (IFooParent), new FooParentRight())
                .GetInstance("Right");
            Assert.That(returned, Is.TypeOf(typeof(FooParentRight)));
            Assert.That(returned.Foo, Is.TypeOf(typeof (Right)));
        }

    }
} 
```

# logging - 命名记录器上的 log4net 策略？

> ID：439162
> 
> 赞同：5
> 
> 时间：2009-01-13T14:42:40.820
> 
> 标签：logging, log4net

我通常在每个类中声明以下内容：

```
private static readonly log4net.ILog log = log4net.LogManager.GetLogger(
            System.Reflection.MethodBase.GetCurrentMethod().DeclaringType); 
```

并使用每个类中的静态成员在不同级别（信息、调试等）进行日志记录

我在某处看到它并且一直在不知不觉地使用它，理由是设置足够灵活，可以帮助我按名称空间过滤并记录单个类型，如果我想解决生产问题等等。

但我很少需要使用精细日志记录的“级别”。所以，我想看看其他人在使用什么。你使用上面的，因为我感觉很多人都在使用，或者你创建命名记录器，如“debug”、“trace”、“error”、“moduleA”等，并在不同类型之间共享记录器，组件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-19T16:38:46.713

我基本上用

```
public class MyClass
{
    private static readonly ILog log = Log.Get<MyClass>();
} 
```

其中 Log.Get 是一个基本上在内部执行此操作的类

```
return LogManager.GetLogger(typeof(T)); 
```

启动成本比反射方式还要小，而且更干净。

**更新：**鉴于我晚年在依赖注入、单元测试和伪造方面的经验，我不能再说我纵容上述方法。该方法（我的和 OP 的方法）的问题在于代码对*如何*创建日志实例有明确的了解。

一方面，这种增加的*耦合*使得测试变得更加困难：没有简单的方法可以用`ILog`假实例替换实例。另一方面，对我的`Log`班级所做的更改将导致更改波及所有使用它的班级。

因此，我通常通过构造函数注入来注入*实例*`ILog`，并将*如何构建记录器*外包给[我选择的 DI 框架](https://code.google.com/p/autofac/)：

```
public class MyClass
{
    readonly ILog _log;

    public class MyClass(ILog log)
    {
        _log = log;
    }
} 
```

这允许适当的去耦。代码不再需要知道记录器是如何构造的。大多数依赖注入框架都可以查看被注入的类型，然后使用它来构造日志实例。这是 log4net 和 Autofac 的一种[方法](https://stackoverflow.com/a/14485020/35245)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T15:30:59.450

以原始方式执行此操作的成本是 ILog 实现的实例以及在启动时运行“System.Reflection.MethodBase.GetCurrentMethod().DeclaringType”所需的时间。

我记得几年前研究过它，我们的启动成本大约是每 10000 个类 1 秒，而每 10k 个类不到 1 兆字节。

鉴于如此低的成本，鉴于 log4net 提供的难以置信的灵活性，我从未回头。

注意：我不能在这里评论其他解决方案，因为我是新人.. 但是这一行：

**方法 = 新 System.Diagnostics.StackTrace().GetFrame(1).GetMethod();**

很**昂贵**，尤其是在为每条日志消息调用时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-17T23:29:24.427

您可以使用日志记录的工具是 PostSharp ( [http://www.postsharp.org/](http://www.postsharp.org/) )。有付费和免费（Express）版本。我只用它来记录方法边界，但我知道你也可以用它来处理错误。在两者之间，这将满足您的大部分日志记录需求，而无需在每个类中编写代码。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-22T13:07:52.600

Lately, i created something like this:

```
public static class Logger
{
    private static bool isLoaded = false;       

    public static ILog Log
    {
        get
        {
            System.Reflection.MethodBase method;
            method = new System.Diagnostics.StackTrace().GetFrame(1).GetMethod();
            StringBuilder loggerName = new StringBuilder();
            loggerName.AppendFormat("{0}.{1}(", method.ReflectedType.FullName, method.Name);

            ParameterInfo[] parameters = method.GetParameters();
            string[] parametersStr = new string[parameters.Length];

            if (parameters.Length > 0)
            {
                for (int i = 0; i < parameters.Length; i++)
                {
                    parametersStr[i] = parameters[i].ToString();
                }
                loggerName.Append(String.Join(", ", parametersStr));
            }

            loggerName.Append(")");

            return GetLogger(loggerName.ToString());
        }
    }

    private static ILog GetLogger(string loggerName)
    {
        if (!isLoaded)
        {
            log4net.Config.XmlConfigurator.Configure();
        }
        return LogManager.GetLogger(loggerName);
    }
} 
```

it lets me use log4net without creating its instance in every class i need to use it, and i still get class name and method where i logged the action.

Sample usage:

```
Logger.Log.DebugFormat("Response [{0}]", xmlResponse); 
```

# java - 跨系统缓存解决方案的持续集成

> ID：439164
> 
> 赞同：4
> 
> 时间：2009-01-13T14:43:20.410
> 
> 标签：java, continuous-integration, intersystems-cache, intersystems

我正在使用 Intersystems Cache 从头开始​​一个项目。我想为该项目设置一个持续集成服务器。缓存有单元测试库，所以想法是将源代码导入测试数据库，构建源代码，在缓存终端中运行单元测试，基于版本控制系统（ClearCase）的变化。

除了 Cache Objectscript 之外，肯定还会有一些 Java 代码需要构建。其他技术可以稍后添加。因此，我需要一个不受特定技术约束且易于扩展的持续集成工具。我过去曾使用 CruiseControl 来构建 Java 解决方案，但那已经是很久以前的事了，我想知道从那以后是否没有更好的解决方案可用。

什么是最好的（希望是免费的）持续集成产品，它最容易扩展到不同的技术？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:25:01.170

我建议看看[Hudson](http://hudson-ci.org/)。由于它是作为可执行 jar 交付的，因此尝试起来非常容易。它还支持[插件](http://hudson.gotdns.com/wiki/display/HUDSON/Extend+Hudson)，因此它可能更适合扩展和定制。[Hudson 也有](http://hudson.gotdns.com/wiki/display/HUDSON/Plugins)很多非常方便的插件。它的 ClearCase 支持来自一个插件。甚至还有一个插件可以在您的构建过程中启动和停止 VMWare 虚拟机，这可能会很有趣，具体取决于您计划如何处理数据库服务器“需求”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-16T19:34:51.867

我在以下截屏视频中构建了一个临时的持续集成服务器：[http ://www.ensemblisms.com/episodes/2](http://www.ensemblisms.com/episodes/2)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-09-15T13:19:19.960

雷蒙德·罗斯坦伯格！！

我目前正在测试一个堆栈，用于持续集成我们在 Caché 中开发的解决方案，我正在测试的堆栈现在包括使用 Git + TortoiseGit 的版本控制源代码（带有一个名为“cache-tort-git”的插件[https://github. com/intersystems-ru/cache-tort-git/wiki](https://github.com/intersystems-ru/cache-tort-git/wiki)特定于 Caché ）用于本地版本控制和 BitBucket 用于远程版本控制。

对于持续集成，我使用的是 Jenkins（Hudson 的演变），其任务是下载更新的源代码，然后运行一个执行以下任务的 COS 脚本：

1.  编译所有源代码；
2.  编译所有 CSP 规则；
3.  编译所有 CSP 页面；
4.  运行所有单元测试；
5.  Run all integration tests;

# c# - EventHandlers 和匿名委托 / Lambda 表达式

> ID：439166
> 
> 赞同：11
> 
> 时间：2009-01-13T14:44:11.173
> 
> 标签：c#, events, delegates, lambda, anonymous-methods

我希望通过匿名委托和 lambda 表达式来清除一些事情，这些表达式用于在 C# 中为事件处理程序创建一个方法，至少对我自己而言。

假设我们有一个添加匿名委托或 lambda 表达式的事件（对于可以使用较新版本 .NET 的幸运人群）。

```
SomeClass.SomeEvent += delegate(object o, EventArg e) { /* do something */ }; 
```

我读到过去人们已经忘记了仍然具有阻止类被垃圾收集的处理程序的事件。如果不只是在类中将 SomeEvent 设置为 null ，将如何删除添加的处理程序。以下不是一个全新的处理程序吗？

```
SomeClass.SomeEvent -= delegate(object o, EventArg e) { /* do something */ }; 
```

我可以看到将匿名委托或 lambda 表达式存储在变量中。但是，至少对我来说，这似乎违背了能够简单而简洁地添加事件处理程序的整个目的。

```
SomeEventDelegate handler = new SomeEventDelegate(delegate(object o, EventArg e) { /* do something */ });
SomeClass.SomeEvent += handler;
// ... stuff
SomeClass.SomeEvent -= handler; 
```

再说一次，我明白你可以这样做......

```
public override Dispose(bool disposing)
{
    _someEvent = null;
    this.Dispose();
} 
```

但我更有趣的是从事件中删除动态创建的方法。希望有人可以为我阐明这一点。谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T14:58:23.143

如果对象 X 有一个事件处理程序，其*目标*是对象 Y，那么对象 X 处于活动状态意味着对象 Y 不能被垃圾回收。它不会阻止对象 X 被垃圾收集。

通常，当某些东西被丢弃时，它很快就会变成垃圾，这意味着你没有问题。

事件和 GC 的问题是，如果您忘记从*不同*的对象中删除订阅的处理程序 - 即您有一个已处置的侦听器，但永远不会被垃圾收集，因为在不同的对象中仍然有来自事件的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:51:33.030

我认为问题在于您似乎是从将委托分配给对象的事件会阻止它被 GC 的假设出发的。

这作为一个简单的陈述是不正确的。

话虽如此，感知到的问题消失了。

最初在垃圾收集中，一切都是垃圾。GC 遍历当前全局和每个堆栈上可用的所有内容，以及它们正在引用的其他对象等等，将每个对象标记为非垃圾。

这样一个绘图过程将如何设法到达这个对象？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:01:18.580

**你不能。**

就像您不能在其范围之外创建匿名类型（某些编译器技巧除外）。

这就是它被称为匿名的原因。

您必须在某处保存参考……或使用反射。

# .net - UserControls Classname-Namespaces 问题

> ID：439167
> 
> 赞同：1
> 
> 时间：2009-01-13T14:44:17.837
> 
> 标签：.net, asp.net, user-controls

我想更改 Control(@Control) 指令以使其可再分发并希望使用 ClassName 属性

所以我改变了这个

**从 ：**

```
<%@ Control Language="C#" AutoEventWireup="true"  CodeFile="ProductShower.ascx.cs" Inherits="MyCompany.Web.Controls.ProductShower" %> 
```

**到 ：**

```
<%@ Control Language="C#" ClassName="MyCompany.Web.Controls.ProductShower" %> 
```

通过此更改，我收到很多错误，说我的所有事件都没有定义！

### 更新：

当我将 ClassName 属性与其他两个组合添加时，它会导致另一个错误：

```
Error   4   Missing partial modifier on declaration of type 'MyCompany.Web.Controls.ProductShower'; another partial declaration of this type exists c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\productspanelx2\1f971ff6\ea7644da\App_Web_giywejva.0.cs   138 
```

除此之外，类定义的第一行是：

```
public **partial** class ProductShower : System.Web.UI.UserControl 
```

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T16:09:17.197

使用新方法，您将缺少**CodeFile**和**Inherits**属性。

**Inherits**属性告诉控件哪个类具有代码隐藏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T03:24:00.260

**Inherits**和**ClassName**必须指向命名空间中的不同类。

如果您的控件继承自 MyCompany.Web.Controls.ProductShower，请将您的类名设置为：MyCompany.Web.Controls.ProductShowerControl（这就是我们命名控件的方式）。

# c# - 从表达式调用方法

> ID：439172
> 
> 赞同：4
> 
> 时间：2009-01-13T14:45:00.190
> 
> 标签：c#, lambda

使用 Expression.Call 时，方法“Any”采用什么类型和参数？

我有一个想要与 Any 一起使用的内部和外部表达式。表达式是以编程方式构建的。

内部（这有效）：

```
ParameterExpression tankParameter = Expression.Parameter(typeof(Tank), "t");
Expression tankExpression = Expression.Equal(
    Expression.Property(tankParameter, "Gun"),
    Expression.Constant("Really Big"));

Expression<Func<Tank, bool>> tankFunction = 
    Expression.Lambda<Func<Tank, bool>>(tankExpression, tankParameter); 
```

外部（看起来正确）：

```
ParameterExpression vehicleParameter = Expression.Parameter(typeof(Vehicle), "v");

Expression vehicleExpression = Expression.Lambda(
    Expression.Property(
        vehicleParameter, 
        typeof(Vehicle).GetProperty("Tank")), 
    vehicleParameter); 
```

这给了我两个表达式：

```
v => v.Tank
t => t.Gun == "Really Big"; 
```

我正在寻找的是：

```
v => v.Tank.Any(t => t.Gun == "Really Big"); 
```

我正在尝试使用 Expression.Call 方法来使用“Any”。1\. 这是正确的做法吗？2\. 以下引发异常，“类型'System.Linq.Queryable'上没有方法'Any'与提供的参数兼容。”

这是我如何称呼任何：

```
Expression any = Expression.Call(
    typeof(Queryable),
    "Any",
    new Type[] { tankFunction.Body.Type }, // this should match the delegate...
    tankFunction); 
```

Any 是如何从 vehicleExpression 链接到 tankFunction 的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T14:52:12.827

`string.Contains`我在上班时遇到了类似的问题；我只是使用了`GetMethod`/`MethodInfo`方法；但是 - 它很复杂，因为它是一种通用方法......

这应该是正确的`MethodInfo`-但是如果没有更清楚地说明`Tank`and ，就很难给出完整的（可运行的）答案`Vehicle`：

```
 MethodInfo method = typeof(Queryable).GetMethods()
        .Where(m => m.Name == "Any"
            && m.GetParameters().Length == 2)
        .Single().MakeGenericMethod(typeof(Tank)); 
```

请注意，扩展方法向后工作 - 所以您实际上想要`method`使用两个参数（源和谓词）进行调用。

就像是：

```
 MethodInfo method = typeof(Queryable).GetMethods()
        .Where(m => m.Name == "Any" && m.GetParameters().Length == 2)
        .Single().MakeGenericMethod(typeof(Tank));

    ParameterExpression vehicleParameter = Expression.Parameter(
        typeof(Vehicle), "v");
    var vehicleFunc = Expression.Lambda<Func<Vehicle, bool>>(
        Expression.Call(
            method,
            Expression.Property(
                vehicleParameter,
                typeof(Vehicle).GetProperty("Tank")),
            tankFunction), vehicleParameter); 
```

如果有疑问，请使用反射器（并稍微摆弄一下；-p）-例如，我根据您的规范编写了一个测试方法：

```
Expression<Func<Vehicle, bool>> func = v => v.Tank.Any(
    t => t.Gun == "Really Big"); 
```

并对其进行反编译并玩弄它...

# c# - 消息泵和 AppDomain

> ID：439173
> 
> 赞同：3
> 
> 时间：2009-01-13T14:45:03.467
> 
> 标签：c#, appdomain

我有一个将 DLL 作为插件加载的 C# (FFx 3.5) 应用程序。这些插件加载在单独的 AppDomain 中（有很多很好的理由，而且这种架构不能改变）。这一切都很好。

我现在需要从其中一个插件中显示一个对话框。请记住，我*无法*将对话框表单返回到主应用程序并在那里显示（当前的基础架构不支持它）。

失败1

在我的 DLL 中，我创建了一个名为 Show 的表单。对话框轮廓出现但没有绘制，并且它不响应鼠标事件。我认为这是因为 DLL 位于单独的 AppDomain 中，并且应用程序的消息泵不知何故无法将消息发送到新表单。

失败2

在我的 DLL 中，我创建了一个名为 ShowDialog 的表单，它应该为对话框创建一个内部消息泵。对话框显示并响应点击（万岁），但似乎主应用程序不再处理或调度 windows 消息，因为它退出绘画并且不再响应鼠标事件。由于某种原因，现在似乎主应用程序的消息泵没有发送。

失败 3

在我的 DLL 中，我创建了一个名为 Application.Run 的表单。这肯定会创建一个完整的第二个消息泵。我得到了与失败 2 相同的行为 - 对话框的行为，但调用应用程序没有。

关于这里到底发生了什么以及我如何从另一个 AppDomain 的 DLL 中显示一个对话框并让调用者和被调用者仍然响应并正确绘制的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T08:49:03.683

尝试将 appdomain1 的主表单的 BeginInvoke 与显示 appdomain2 表单的委托一起使用。所以在伪代码中：

```
Appdomain1:
    AppDomain2.DoSomething(myMainForm);

AppDomain2:
    DoSomething(Form parent)
    {
        Form foolishForm = new Form();
        parent.BeginInvoke(new Action( delegate { foolishForm.Show(); } ));
    } 
```

代码可能并不完美，但它展示了这个概念。

顺便说一句，如果您因为远程处理而在传递表单时遇到问题，您可以：

```
public class Container<T> : MarshalByRefObject
{
    private T _value;
    public T Value { get { return _value; } set { _value = value; } }

    public Container() { }
    public Container(T value) { Value = value; }

    public static implicit operator T(Container<T> container)
    {
        return container.Value;
    }
} 
```

这将包含你扔给它的对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T12:29:05.027

我们有一个非常相似的架构应用程序来加载 DLL 文件和插件。每个 DLL 文件都加载到单独的[应用程序域中](http://en.wikipedia.org/wiki/Application_Domain)，该应用程序域是在单独的线程上创建的。我们有一个第三方控件，除非我们`System.Windows.Forms.Application.DoEvents()`定期调用，否则该控件不会出现。

伪代码：

```
<In new thread>
  <Application domain created. Start called inside new application domain.>
  <Start loads new DLL file, calls init function in DLL file>
  <Start loops, calling DoEvents until the DLL file exits>
  <Application domain unloaded>
<Thread exits> 
```

这解决了我们所有的 GUI 问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T06:23:15.217

我之前使用过的一件事是实现[DomainManager](http://msdn.microsoft.com/en-us/library/system.appdomainmanager.aspx)。可以自定义各种[应用程序域](http://en.wikipedia.org/wiki/Application_Domain)安全/绑定/上下文，以处理复杂或鸡蛋类型的问题，将您的数据泵送到您想要的地方；）

我通常从 native.exe 完成此操作，通过 COM 接口引导 CLR（伪代码，但顺序和方法名称是正确的；）：

```
CorBindToRuntimeEx()
SetHostControl()
GetCLRControl()
SetAppDomainManagerType("yourdomainmanger","info")
// Domain manager set before starting runtime
Start()
HostControl -- GetDomainManagerForDefaultDomain()
DomainManager -- Run() 
```

您的域管理器可以是任何[CLR](http://en.wikipedia.org/wiki/Common_Language_Runtime)类库，因此它们不是更原生的 C。

附带说明，如果您在[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)中；我真的很喜欢使用“Microsoft.DwayneNeed.Controls”方法。您可能在*同一个*UI 控件中使用自己的 Dispatcher 泵分散线程（不需要求助于全新的 Window()）。

使用这种方法的独特之处在于，即使主 UI 线程被阻塞/忙碌（一些繁重的操作、扫描文件系统等），这些其他线程也可以绘制/更新它们的 UIElement 而不会出现任何问题。

# .net - 记录数据读取器方法调用的最佳方法是什么？

> ID：439175
> 
> 赞同：0
> 
> 时间：2009-01-13T14:45:42.870
> 
> 标签：.net, documentation, code-readability

在使用诸如 System.Data.Odbc 或 System.Data.OracleClient 之类的命名空间时，各种数据读取器方法通常需要为函数提供与列对应的整数（例如[OracleDataReader.GetInt32](http://msdn.microsoft.com/en-us/library/system.data.oracleclient.oracledatareader.getint32.aspx)）。

我的问题是，使用这些函数的最佳方法是什么，以使代码具有相当的自我记录性。现在，在我看来，有三个选择，即：

```
// Option One - Just provide the integer value
string myString = oraData.GetString[0];

// Option Two - Provide the integer value using a constant
string myString = oraData.GetString[FIELD_NAME];

// Option Three - Provide the column name and use System.Convert to return the correct value
string myString = Convert.ToString(oraData["Field_Name"]); 
```

这些技术中的每一种似乎都有自己的优点和缺点，我很想知道其他人的想法，或者是否有更好的方法来做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T14:52:02.033

我一直这样做：

```
int columnIndex = dataReader.GetOrdinal("field");

if (!dataReader.IsDBNull(columnIndex))
    String myString = dataReader.GetString(columnIndex); 
```

当我试图获得一个不在读者中的字段时，这个想法`GetOrdinal`将会失败。`IndexOutOfRangeException`我想要这个异常，因为它很快告诉我我的代码和我的数据库之间不匹配。

也`GetOrdinal`比将序数本身硬编码为幻数要脆弱得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:50:53.267

我通常使用选项 3。我喜欢它，因为如果底层查询改变了列顺序，它仍然可以工作，并且它会在那里显示你所要求的名称，而不是一些幻数。

但是，我使用了很多 VB.Net，所以这`Convert.ToString()`部分可以隐式完成。C# 类型可能有不同的偏好。

此外，使用字段名称而不是列序号会受到非常小的惩罚。我通常认为这是合理的，但根据您的应用程序，您可能需要考虑到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T15:38:25.650

我同意 Andrew Hare 的观点，此外，我已将功能包含在简化操作的重载扩展方法中：

```
public static string GetStringByName(this OracleDataReader reader, 
                                     string columnName, 
                                     string defaultValue)
{
   string result = defaultValue;
   int columnIndex = reader.GetOrdinal(columnName);
   if(!reader.IsDbNull(columnName)
   {
      result = (string) reader.GetString(columnIndex);
   }
   return result;
} 
```

无论如何，只是一个对我帮助很大的重构。

# windows - IE浏览器控件res://的使用

> ID：439181
> 
> 赞同：3
> 
> 时间：2009-01-13T14:46:25.677
> 
> 标签：windows, internet-explorer, winapi, com

我在我的应用程序中使用 IWebBrowser2 控件，并且我有各种 html 文件作为资源存储在 exe 中。要加载这些，我使用“res://”协议。问题是某些版本的 IE 页面不再加载，而是只显示“操作已取消，Internet Explorer 无法链接到请求的页面”。

这些页面在 .rc 脚本中被引用，如下所示：

stats.html HTML 可丢弃“res\stats.html”

res 请求看起来像 res://C:\path\To\MyApp.exe/stats.html

这曾经工作得很好，在某些时候这种行为发生了变化，大概是通过热修复或类似的东西。现在，在我的机器上，它不起作用。我尝试将 res 路径更改为：

res://MyApp.exe/stats.html

那没有用。

然后我尝试更改 rc 脚本：

stats HTML DISCARDABLE "res\stats.html"

和 res 路径：

res://MyApp.exe/stats

现在它起作用了！然而，不得不使用这种方式真的很烦人（从资源名称中删除“.”和文件扩展名）。有谁知道这是否是一个错误？一个特征？为什么会发生这种情况，还有其他方法吗？

编辑：在玩了一些之后，我发现它可以工作：stats.htm HTML DISCARDABLE "res\stats.html" res://MyApp.exe/stats.htm

将资源名称中的“.html”扩展名更改为“.htm”有效，但我不知道为什么！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T19:37:54.870

确保内容类型设置正确。确保 HKEY_CLASSES_ROOT.html 的 Content Type 设置为“text/html”，否则会发生奇怪的事情。.htm 也是如此。

# hibernate - LazyInitializationException 即使 openSessionInViewInterceptor

> ID：439184
> 
> 赞同：8
> 
> 时间：2009-01-13T14:47:10.887
> 
> 标签：hibernate, spring, lazy-loading

即使我使用的是 openSessionInViewInterceptor，我也遇到了 LazyInitializationException 问题。我已经阅读了很多关于该主题的帖子，并且尝试了三四种不同的方法。

首先，我不想将 Hibernate 配置文件中的惰性属性设置为 false。所以，我想要一个实际的解决方案来解决这个问题。我正在使用 Spring 2.5、Hibernate 3、Netbeans 和 Tomcat。

我的实现如下：

servlet.xml

```
<bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="interceptors">
            <list>
                <ref bean="openSessionInViewInterceptor" />
            </list>
        </property>
        <property name="mappings">
            <props>
                <prop key="/index.htm">indexController</prop>
            </props>
        </property>
 </bean>
 <bean id ="openSessionInViewInterceptor" name="openSessionInViewInterceptor"
    class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
    <property name="sessionFactory">
        <ref bean="sessionFactory" />
    </property>
</bean> 
```

应用程序上下文.xml

```
<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
        <property name="dataSource">
            <ref local="dataSource"/>
        </property>
        <property name="mappingResources">
            <list>
                <value>TasquesDAOHibernate/Model/Tasca.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/TipusTasca.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/Prioritat.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/Persona.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/EstatTasca.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/Usuari.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/LogActivitat.hbm.xml</value>
                <value>TasquesDAOHibernate/Model/ObjecteSIPANUsuari.hbm.xml</value>
            </list>
        </property>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">${hibernate.dialect}</prop>
                <prop key="hibernate.jdbc.batch_size">0</prop>
            </props>
        </property>
    </bean>

    <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory">
            <ref local="sessionFactory"/>
        </property>
    </bean>

    <bean id="tasquesDAO" class="TasquesDAOHibernate.TasquesDAOHibernate">
        <property name="sessionFactory">
            <ref local="sessionFactory"/>
        </property>
    </bean>

<bean id="tasquesService" name="tasquesService" class="Tasques_www.service.TasquesService" >
        <property name="tasquesDAO">
            <ref local="tasquesDAO"/>
        </property>
        <property name="transactionManager" ref="transactionManager"/>
    </bean> 
```

任务服务.java

```
public List<Tasca> getTasques() {
        List<Tasca> tasques = (List)this.transactionTemplate.execute(new           TransactionCallback() {

            public Object doInTransaction(TransactionStatus status) {
                Object tasques = tasquesDAO.getTasques();
                return tasques;
            }
        });
        return tasques;
    } 
```

任务DAOHibernate.java

```
public List<Tasca> getTasques() {
        Session session = this.sessionFactory.getCurrentSession();
        try{
            Query query = session.createQuery("SELECT element FROM Tasca AS element");
            List result = query.list();
            return result;
        }catch(HibernateException ex){
            return null;
        }
    } 
```

我认为这些是重要的文件。我已经尝试了很多东西，但我总是得到 LazyInitializationException 或

org.hibernate.HibernateException：没有 Hibernate Session 绑定到线程，并且配置不允许在此处创建非事务性会话...

我不知道哪一个最糟糕。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T15:20:21.900

我认为您需要**web.xml**级别的过滤器：

```
<filter>
    <filter-name>Spring OpenEntityManagerInViewFilter</filter-name>
    <filter-class>org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter</filter-class>
</filter> 
```

只有这样，spring 才能知道您的视图何时被渲染。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T18:35:14.400

问题是您对事务管理器的使用：这将启动一个新会话，并且由于您手动打开它，它也会关闭它。您需要使用 Springs 配置来配置您的事务管理，这样所有组件才能一起正常工作。

在业务层 (TasqueService) 上使用事务拦截器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T06:40:12.610

要在整个请求期间保持会话打开，您需要将 Spring 的 OpenSessionInViewFilter 添加到 web.xml。这是特定于hibernate3的：

```
<filter>
    <filter-name>OpenSessionInViewFilter</filter-name>
    <filter-class>org.springframework.orm.hibernate3.support.OpenSessionInViewFilter</filter-class>
</filter> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:42:33.203

您可以尝试使用 Spring 的原生拦截器，看看我的

```
<bean id="transactionManager"
    class="org.springframework.orm.hibernate3.HibernateTransactionManager">
    <property name="sessionFactory">
        <ref bean="sessionFactory" />
    </property>
</bean>

<bean id="txAttributeSource"
    class="org.springframework.transaction.interceptor.NameMatchTransactionAttributeSource">
    <property name="properties">
        <props> <!-- this catches every method with the interceptor-->
            <prop key="*">PROPAGATION_REQUIRED</prop>
        </props>
    </property>
</bean>

<bean id="txInterceptor"
    class="org.springframework.transaction.interceptor.TransactionInterceptor">
    <property name="transactionManager">
        <ref local="transactionManager" />
    </property>
    <property name="transactionAttributeSource">
        <ref local="txAttributeSource" />
    </property>
</bean>

<bean id="autoProxyCreator" class="org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator">
    <property name="interceptorNames">
        <list>
            <idref local="txInterceptor" />
        </list>
    </property>
    <property name="beanNames">
        <list> <!--this proxies every bean with the especified pattern -->
            <value>*BL</value>
        </list>
    </property>
</bean> 
```

# c - 关闭套接字的问题。程序暂停

> ID：439187
> 
> 赞同：1
> 
> 时间：2009-01-13T14:47:58.187
> 
> 标签：c, sockets, unix

我在使用[此代码](http://pastebin.com/mbd132a7)时遇到了一些问题。问题是当我请求服务器向我发送一些数据并且客户端只是在服务器尝试向我发送数据时断开连接时，应用程序存在。

这是我认为导致问题的线路

```
int SendBinary(int *byte, int length)
{
    int bytes_sent;

    bytes_sent = send(connecting_socket, byte, length, 0);

    return bytes_sent;

    return 0;
}

void SendFile(FILE *fp, int file_size)
{
    int current_char = 0;

    do{
        current_char = fgetc(fp);

        if ( current_char == EOF )
            break;

        SendBinary(&current_char, sizeof(char));
    }
    while(current_char != EOF);

} 
```

有什么想法我应该做些什么来防止这种情况发生吗？修改整个源代码以补充此片段。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:04:30.557

也许您的应用程序在写入/发送期间正在接收 SIGPIPE 而没有忽略它？尝试忽略此信号或为其安装无操作处理程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T15:36:02.303

您确定客户端在从服务器接收数据时没有失败吗？

1.  `telnet`到您的服务器以查看它发送的响应内容

2.  将您的服务器替换 `netcat`为以确保客户端行为正确

3.  `tcpdump`使用或类似工具嗅探服务器和客户端之间的流量

# c# - WPF：多个页面，每个页面都有自己的上下文菜单，如何设置全局菜单？

> ID：439189
> 
> 赞同：0
> 
> 时间：2009-01-13T14:48:16.267
> 
> 标签：c#, wpf

我有一个显示不同页面的窗口。每个页面都有一个或多个上下文菜单。我希望主窗口在主应用程序菜单中显示这些上下文菜单。因此，如果一页列表视图带有包含删除和复制的上下文菜单，则主应用程序菜单应该具有带有删除和复制命令的菜单“命令”。当页面更改时，命令菜单应更改为新页面正在使用的任何上下文菜单。

上下文菜单已定义命令。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T23:12:28.933

构建要显示的项目的共享集合，然后将数据绑定到该项目 - 主窗口可以绑定到属性，上下文菜单也可以。您可能会为两者使用相同的数据模板。

# programming-languages - 创建移动编程语言

> ID：439196
> 
> 赞同：14
> 
> 时间：2009-01-13T14:49:14.080
> 
> 标签：programming-languages, java-me, hecl

我正在考虑创建一种很容易在手机上输入的小语言（J2ME），为了在手机中运行它（j2me 总是），实现它的更合适的语言是什么？恰当的意思，小/简单的语法，易于在手机中输入。

是口齿不清吗？某种基本/Python/Ruby（我认为不是......）？或者另一个新的（你能提出一个新的语法吗？）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-16T09:05:56.153

我就是这样一种语言的作者：Hecl，位于[http://www.hecl.org](http://www.hecl.org)。为了简化应用程序，我还创建了一个站点，您可以在其中通过 Web 界面构建简单的应用程序：[http](http://www.heclbuilder.com) ://www.heclbuilder.com 。我还写了一篇文章讨论语言的实现：

[http://www.welton.it/articles/hecl_implementation](http://www.welton.it/articles/hecl_implementation)

其他值得关注的语言包括 Lua 和 Javascript，它们都有移动实现。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T15:23:12.267

我认为编辑器的设计将是最大的考虑因素，而不是语言。例如，支持某种类似“智能感知”的自动完成功能对于节省拇指笔划至关重要。编辑器中的某种语言敏感性也会有很大帮助。例如，当 C 用户键入“for”时，自动完成应该显示一个用于填写循环语法的选项：

```
 for (;;) {
   } 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T15:03:15.643

如果您包括编辑器支持（嵌套结构、缩进显示、平衡等），那么某种形式的 LISP 将相对容易实现和使用。我已经看到了基于 LISP 的语言的屏幕截图（但现在找不到它们），用于实时交互式性能编程。它在屏幕上使用缩进的阴影矩形区域（而不是括号）来显示结构的嵌套。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-15T16:28:14.633

您可能想查看 Hecl：[http ://www.hecl.org/](http://www.hecl.org/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-07T22:23:12.543

在手机上，您还应该考虑像[Scratch](http://scratch.mit.edu/) (smalltalk) 这样的语言，因为非打字界面会很容易使用。

同样在具有拖放功能的智能手机上，这将是一件好事。

另一方面，IDE 会占用大量 CPU 和其他资源。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-07T22:37:59.437

[Forth](http://en.wikipedia.org/wiki/Forth_(programming_language))通常被认为是这些要求的合法竞争者。它是可以想象的那样简洁。可扩展、小巧且可塑性强。内置小屏幕编辑器。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-14T04:07:58.743

我不确定在手机上容易输入什么，但我所知道的每个字符计算能力最强的语言是[APL](http://en.wikipedia.org/wiki/APL_(programming_language))。作为语法或设计理念的来源，您可能更喜欢它的现代继任者[J 编程语言](http://www.jsoftware.com/)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-07-03T01:14:57.117

如果您想要超级紧凑，请尝试 nano-False [http://www.aldweb.com/pages/winikoff/#false](http://www.aldweb.com/pages/winikoff/#false)

它不是很有用，尽管比故意痛苦的 Brainfuck 和 Whitepace 更有用。把它想象成 Forth，语法更简洁；-)

我发现[Quartus Forth](http://www.quartus.net/products/forth/)相当容易使用，前提是您可以在堆栈中思考，并且对 API 有更多的 Intellisense 支持，它会更有效率。对于 Palm 上的小算法原型，我更喜欢[Plua](http://en.wikipedia.org/wiki/Plua)或[Lispme](http://www.lispme.de/lispme/)。LispMe 环境无论如何都值得研究，因为它很好地使用了列表来查找关键字，因此简化了 GUI 编程

您必须做出的重大决定是您是否希望用户只使用电话数字小键盘或能够输入合理的近似全键盘。Palm 的一大优势是高品质的全尺寸折叠键盘，我很遗憾地怀念它（希望有人制作 iPhone 配件来连接）。如果您没有完整的键盘，请使用动词选择器，这样他们就可以使用*选择*动作而不必输入单词。考虑与用户代码相比，在框架类和方法的传统代码中键入的代码量。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-07T22:42:37.537

[Brainfuck](http://en.wikipedia.org/wiki/Brainfuck)只有 8 个字符——很容易在手机上输入。

当然，理解它并用它做事......不是那么容易。但是满足要求。。。。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-13T15:02:46.097

当我开始梦想一种语言时，我会考虑在我做梦时哪些特征对我很重要。只有弄清楚哪些功能对您很重要，您才能对什么语法提出最佳答案。例如，如果您想要命名参数，它会极大地影响您对方法调用外观的设计选择（如 Objective-C 或 Python）。

设计一种语言可能是一项非常有趣的任务。我鼓励你退后一步，问问自己“我真的喜欢 X 中的做法吗？” （替换一些语言名称）。如果那是你一直喜爱的东西，*那就去偷吧*。如果没有，请看其他地方。创建你喜欢的东西的终极混搭，留下你讨厌的东西！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-13T15:10:10.827

由于所有的 ()，Lisp 将难以键入，尽管 joel.neely 的回答展示了解决该问题的一种方法。

因此，如果您想使用现有语言，您可能需要查看哪些语言使用最少不寻常的字符。

然后是屏幕尺寸问题。语言越冗长，您一次能在屏幕上显示的代码就越少。你的目标是什么类型的设备？大屏幕智能手机（受众有限）还是 240x240 像素功能手机？

请记住，您的语言的解释器/VM 必须适合少量内存，并且性能可能不是很好。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-01-13T14:58:40.753

基础非常简单。

我会远离 lisp。除非您想让您的移动用户在他们因无线电波而头疼的问题上头疼不已。

# sharepoint - SharePoint 列表预填充

> ID：439212
> 
> 赞同：0
> 
> 时间：2009-01-13T14:53:01.203
> 
> 标签：sharepoint, list

我有两个列表，每个列表位于站点的不同选项卡（子站点）上。我希望用户在第一个选项卡上输入数据，并以某种方式自动将该数据的一部分复制到第二个列表中（例如第二个列表中几个字段的预填充）。发生这种情况会涉及什么？在我提出的想法中，似乎没有一个过于务实。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:04:06.970

第一个列表上的项目接收器将允许您在创建时将数据插入另一个列表。

根据您的情况，可能值得尝试列表查找（一对多）。

# iphone - 安装应用程序时将书签添加到 iPhone 上的 Safari？

> ID：439213
> 
> 赞同：4
> 
> 时间：2009-01-13T14:53:32.403
> 
> 标签：iphone, safari

我想在用户安装我的 iPhone 应用程序时为他们的 Mobile Safari 书签添加一个书签。

我不希望用户必须手动完成，我希望我的 iphone 应用程序安装书签（实际上是基于 javascript 的书签，例如`javascript:`）

有谁知道无论如何要这样做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T14:58:21.973

目前不可能。我见过的最好的方法是在移动 Safari 中启动一个页面，其中包含有关如何手动添加书签的说明，或者告诉用户将其添加到桌面 Safari 并将书签同步回 iPhone。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:18:31.280

目前这是不可能的。如果您希望看到它，您应该向 Apple[提交增强请求](http://bugreporter.apple.com)。

# java - 我如何（应该？）使用 Apache POI HWPFDocument？

> ID：439215
> 
> 赞同：1
> 
> 时间：2009-01-13T14:54:13.213
> 
> 标签：java, ms-word, file-format, apache-poi

我正在考虑将 Apache POI 包含到我的应用程序中。主要目标是输出 RTF 文档，但 DOC 也很好。但是关于编写 HWPFDocument 的文档不是很详细，而且我在网上找到的所有内容都没有帮助。

我可以阅读 DOC 文件，这没有任何问题。但我真的看不出我是如何写文件的。也许有人可以给我一个简短的代码示例？

非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T22:48:09.420

如果你想做 RTF，这些是文本文件，所有版本的 Word 都支持。

您可以将 itext 用于简单的东西 [http://itextdocs.lowagie.com/tutorial/rtf/index.php](http://itextdocs.lowagie.com/tutorial/rtf/index.php)

罗

你可以用艰难的方式导出它们

//--- 另存为example.doc -------------

```
{
\rtf1
\安西
\ansicpg1252
\def0
\deflang1033
  {\fonttbl
    {\f0
     \fswiss
     \fcharset0 宋体；
    }
  }
  {
  \*
  \generator Msftedit 5.41.21.2500;
  }
  \viewkind4
  \uc1
  \pard
  \f0
  \fs20

  你好世界

  \par
}

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T15:19:50.337

好，

距离我上次使用 POI 已经有很长时间了。我读到 HWPFDocument 现在是孤立的（在 apache POI 网站上阅读）。我建议改用 Microsoft 发布的 WordML 规范。

[http://en.wikipedia.org/wiki/Microsoft_Office_XML_formats](http://en.wikipedia.org/wiki/Microsoft_Office_XML_formats)

我以前用过这种方法。最简单的方法是创建一个 WordML 模板并使用 XPATH 替换值

# apache - mod_rewrite '添加路径信息后缀：'

> ID：439218
> 
> 赞同：5
> 
> 时间：2009-01-13T14:54:59.157
> 
> 标签：apache, mod-rewrite

为什么我的 mod_rewrite 会这样做？

```
add path info postfix: /home/mobelluk/public_html/about.php -> /home/mobelluk/public_html/about.php/ 
```

这会导致所有内容都出现不需要的斜杠。

我已经禁用了我所有的 .htaccess 规则，所以它们不在等式中。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-04-01T23:44:22.380

显然，在某些情况下，mod_rewrite 重新附加后修复部分存在问题 [https://issues.apache.org/bugzilla/show_bug.cgi?id=38642](https://issues.apache.org/bugzilla/show_bug.cgi?id=38642)

> 问题：
> 
> 如果 .htaccess 文件中的多个 RewriteRules 匹配，则 PATH_INFO 的不需要的副本可能会累积在 URI 的末尾。

如果您使用的是 Apache 2.2.12 或更高版本，则可以使用 DPI 标志来防止此 [http://httpd.apache.org/docs/2.2/rewrite/flags.html](http://httpd.apache.org/docs/2.2/rewrite/flags.html#flag_dpi)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2018-05-08T13:31:47.760

在搜索“添加路径信息后缀”时，首先出现了这个问题，虽然它最终确实解决了我的问题，但我花了将近 2 个小时才明白发生了什么。在一个网站上工作时，我需要这个重写：

```
/resources/band/ -> resources.html?section=band 
```

完成了这个 mod_rewrite：

```
RewriteRule ^resources/(.*)/$ resources.html?section=$1 [L] 
```

将其更改为 [DPI] 没有任何效果......我的 resources.html 页面上的代码肯定被调用了 100%，但*section=band*的参数没有被发送给它。

得到这个......如果你发现 Apache 的文档无法阅读，Multiviews 就是问题所在。当浏览器看到多视图在服务器上时，会看到 /resources/band/ 并说“哦，我太聪明了，我知道这意味着什么！” 并重定向：

```
/resources/band/ -> /resources.html/band/ 
```

**真实的故事！**我将虚拟主机上的 +Multiviews 更改为 -Multiviews - 问题立即解决。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T22:21:07.943

新服务器是否有可能加载了[mod_dir](http://httpd.apache.org/docs/2.2/mod/mod_dir.html)`DirectorySlash On` ，而旧服务器没有加载，这导致了这个问题？

（请注意，如果已加载并且没有任何内容覆盖它，则这`DirectorySlash On`是默认设置）`mod_dir`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-07-25T17:08:31.400

我通过在我的虚拟主机选项配置中禁用 MultiViews 解决了这个问题。我正在重写类似于下面的内容：

期望重写：

```
/dir/ -> /dir.html 
```

实际翻译：

```
/dir/ -> /dir.html (MultiViews)
/dir.html -> /dir.html/ (mod_rewrite: 404, didn't exist) 
```

禁用 MultiViews 会阻止初始翻译发生。我本可以调整重写规则来弥补这一点，但无论如何我并没有将 MultiViews 用于其他任何事情。

以下帖子向我介绍了这个问题： [https ://velenux.wordpress.com/2012/07/17/apache-mod_rewrite-multiple-add-path-info-postfix/#comment-1476](https://velenux.wordpress.com/2012/07/17/apache-mod_rewrite-multiple-add-path-info-postfix/#comment-1476)

# c++ - 如何从多个静态库中创建一个静态库？

> ID：439219
> 
> 赞同：4
> 
> 时间：2009-01-13T14:55:03.260
> 
> 标签：c++, c, visual-studio-2005

我们最近将一个 C++ 项目从 Visual Studio 6 转换为 Visual Studio 8。一切都很顺利，直到我们编译了一个将所有静态库放在一个大静态库中的项目。默认情况下，在两个版本的项目之间转换后，项目没有做任何事情（没有创建大的静态库，它只说项目是最新的）。

我们通过向项目添加一个虚拟（空）文件找到了一个可行的解决方案（在 Visual Studio 6 解决方案中它之前没有其他文件）。一切顺利，我们设法用新的开发环境（Visual Studio 8）编译了项目。

我的问题是：有没有其他方法可以做到这一点，而无需将虚拟文件添加到项目中？

提前感谢您的回复

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T13:44:55.380

您可以使用 nobugz 的答案中描述的方法，也可以使用多个配置和不同的目录来调试和发布输入库。只需添加所有输入库、调试和发布，然后使用“从构建中排除”。在调试配置中从构建中排除所有发布输入库，在发布配置中排除所有调试输入库。

# linux - 如何在 Linux 中找出哪个进程锁定了文件？

> ID：439221
> 
> 赞同：11
> 
> 时间：2009-01-13T14:55:39.263
> 
> 标签：linux, file, filesystems, directory

今天我遇到了无法删除文件夹的问题，因为“它很忙”。

我怎样才能找出应该归咎于哪个应用程序，或者我可以用蛮力删除它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T14:58:27.683

使用 lsof 找出打开了哪些文件。

man lsof 或者看看[这里](http://en.wikipedia.org/wiki/Lsof)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T15:00:03.200

Unix 命令将为您提供访问文件的进程的[`fuser`](http://en.wikipedia.org/wiki/Fuser_(Unix))PID。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2021-01-16T19:20:13.997

`lslocks`列出有关 Linux 系统中当前持有的所有文件锁的信息。（util-linux 的一部分）这个实用程序支持 json 输出，这对脚本来说很好。

```
~$ sudo lslocks
COMMAND           PID   TYPE SIZE MODE  M START END PATH
cron              873  FLOCK   4B WRITE 0     0   0 /run/crond.pid

..
.. 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T15:00:37.227

`fuser`将显示哪些进程正在访问文件或目录。

# html - HTML 在 .NET 中呈现不正确

> ID：439226
> 
> 赞同：1
> 
> 时间：2009-01-13T14:57:20.790
> 
> 标签：html, vb.net, xslt, line-breaks

我正在尝试`<BR>`在 VB.NET 中获取字符串“”并通过 XSLT 将其转换为 HTML。但是，当 HTML 出来时，它看起来像这样：

```
&lt;BR&gt; 
```

我只能假设它继续并尝试渲染它。有什么办法可以将它们转换`&lt;/&gt;`回括号中，以便获得我正在尝试的换行符？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T14:59:17.993

检查 XSLT 是否具有：

```
<xsl:output method="html"/> 
```

* * *

编辑：评论中的解释

默认情况下，XSLT 输出为 XML(1)，这意味着它将转义任何重要字符。您可以在特定实例中使用属性`disable-output-escaping="yes"`(intro [here](http://www.dpawson.co.uk/xsl/sect2/N2215.html) ) 覆盖它，但更强大的是将输出更改为 HTML 的显式值，这在全局范围内提供相同的好处，如下所示：

> *   对于脚本和样式元素，将所有转义字符（例如 & 和 >）替换为其实际值（分别为 & 和 >）。
> *   对于属性，将任何出现的 > 替换为 >。
> *   编写空元素，例如`<br>`、`<img>`和 ，`<input>`不要使用结束标记或斜杠。
> *   以最小化的形式编写通过存在而不是值来传达信息的属性，例如选中和选择。

*来自一篇涵盖该主题的可靠 IBM[文章，](http://www.ibm.com/developerworks/xml/library/x-tiphtml.html)[这里](http://www.stylusstudio.com/w3c/xslt/N12184.htm)是 stylusstudio 的最新报道*

如果 HTML 输出是您想要的 HTML 输出是您应该指定的。

*(1) 实际上存在输出默认为 HTML 的极端情况，但我认为它不是通用的，依赖它有点迟钝。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T15:08:38.847

尝试用`<xsl:text disable-output-escaping="yes">&lt;br&gt;</xsl:text>`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:11:57.903

不知道 XSLT 但是..

一种解决方法可能是使用System.Web 命名空间中的[HttpUtility.HtmlDecode](http://msdn.microsoft.com/en-us/library/system.web.httputility.htmldecode.aspx)。

```
using System;
using System.Web;

class Program
{
    static void Main()
    {
        Console.WriteLine(HttpUtility.HtmlDecode("&lt;br&gt;"));
        Console.ReadKey();
    }
} 
```

...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T14:06:44.820

知道了！除了选定的答案之外，我还在我的字符串上做了类似的事情：

```
htmlString = htmlString.Replace("&lt;","<")
htmlString = htmlString.Replace("&gt;",">") 
```

不过，我认为最终，我可能最终会使用`<pre>`标签来保存所有内容。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-13T15:02:38.593

字符串 " `<br>`" 已经是 HTML，所以你可以`Response.Write("<br>")`.

但是您的意思是 XSLT，所以我想有一些转换正在进行。在这种情况下，转换肯定应该将其作为节点插入到正确的位置。更好的问题可能会得到更好的答案

# sharepoint - 在 VMware 中运行 VMware？

> ID：439248
> 
> 赞同：19
> 
> 时间：2009-01-13T15:02:44.477
> 
> 标签：sharepoint, deployment, vmware, vmware-server

我们有一台运行 VMware 的物理机，并托管一个我们用于 SharePoint 部署测试的 VM。那台机器已经过时了，而且我雇主的网络沙皇正在大力推动托管虚拟机来替代过时的物理服务器。我很好奇是否可以在 VMware 内部运行 VMware，如果可以，是否会对性能产生严重影响。我们不需要此设置具有极高的性能，因为它仅用于 SharePoint 测试，并且关联的 SQL Server 位于不同的盒子上。我的猜测是，我们不能只使用主要托管的 VM 进行测试，因为我们希望偶尔回滚，否则对它有更多的控制权，并且不太可能从网络人员那里获得支持。有人对这个有经验么？

编辑：我知道这种嵌套当然不是首选，但是（1）我们希望能够灵活地随意使用 VMware 快照，以及（2）网络人员不允许我们任意回滚到前一点及时，因为有可能删除强制的安全更新。我的猜测是，运行 VMware Workstation 的本地台式机可能只是要走的路。托管选项如果可行的话似乎很有吸引力，因为它对我来说处理的机器维护较少。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-13T22:53:23.247

在 VMware 中运行 VMware 的技术限制是 VMware、Virtual PC 等利用了现代 CPU 中存在的[虚拟化功能。](http://en.wikipedia.org/wiki/X86_virtualization)

如果您有两个或多个虚拟机管理程序都试图控制[Ring 0](http://en.wikipedia.org/wiki/Supervisor_mode#Hypervisor_mode)，那么就会出现问题，这是我在桌面上同时运行 VMware 和 Virtual PC 时遇到的问题 - 一个会出错/崩溃。

如果您的管理程序可以与“父”管理程序交互，那么您就可以了。或者，如果子管理程序不尝试使用 CPU 虚拟化功能，或者完全模拟 CPU（例如 QEMU），那么您也应该没问题。

基本上，旧 CPU 上的旧式虚拟机管理程序使用[完全虚拟化](http://en.wikipedia.org/wiki/Full_virtualization)（慢速），这将能够嵌套并带来沉重的性能损失。现代虚拟机管理程序/CPU 使用[硬件辅助虚拟化](http://en.wikipedia.org/wiki/Hardware-assisted_virtualization)（接近本机性能），您很难找到设计或能够嵌套虚拟机的虚拟机管理程序。

最后，我真的建议不要在运行生产 VM 的同一物理服务器上运行开发/测试 VM。有太多错误和安全隐患 - 您需要管理开发/测试环境，听起来您不应该访问生产环境。同样，您可能不希望运营团队弄乱您的测试环境。

**更新：** ESXi 4 现在支持虚拟化自身。有关更多信息，请参阅[本文](http://www.vcritical.com/2009/05/vmware-esx-4-can-even-virtualize-itself/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T15:53:17.197

我从来没有在VMware中运行过VMware，但是我在VirtualBox中运行VirtualPC没有问题，所以我想没有根本原因它不应该工作......

在我看来，您的“网络沙皇”不灵活，而不是任何技术问题，这听起来更像是您的问题。如果您是开发人员或 QA，您*需要*一个测试环境，您可以在其中玩弄过时（并且可能不安全）版本的操作系统和应用程序，而不会使公司网络的其余部分处于危险之中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-06-23T21:17:08.550

前 VMware 员工在这里。

首先，当您说嵌套 VMware 时，我假设您指的是嵌套 ESXi。（您也可以指 Workstation、Fusion 或 Player）。

嵌套 ESXi 环境不受支持，不应用于生产。这些场景未在 QA 中进行测试，也不保证可以正常工作。简而言之，如果您遇到任何类型的问题，VMware 将不会帮助您进行此嵌套 ESXi 设置。

话虽如此，是的，你可以做到，是的，它确实有效。很多人在他们的实验室中使用嵌套 ESXi，但在生产中却没有。以前，嵌套 ESXi 工作需要特殊的配置文件编辑。我见过甚至有 3 层嵌套 ESXi 服务器的环境（ESXi vm on 和 ESXi vm on a physical ESXi host）。最近有 ESXi 设备使这变得更容易。

看看这里： http: [//www.virtuallyghetto.com/2015/12/deploying-nested-esxi-is-even-easier-now-with-the-esxi-virtual-appliance.html](http://www.virtuallyghetto.com/2015/12/deploying-nested-esxi-is-even-easier-now-with-the-esxi-virtual-appliance.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T19:59:23.753

我遇到了同样的问题。我在一家大公司工作，我们的整个基础架构都是虚拟的，所以如果你需要一台服务器，你可以得到一个 VMware VM。所以我有几个基于 Windows 2003 Server Standard Edition 的访客 VM，它们有 6GB 内存和 200GB 磁盘空间，但我想在它们上运行 linux 和 LAMP 堆栈。因此，我尝试在其中安装 VMware Workstation，但收到一条错误消息，提示无法在 VM 中安装它。我还尝试了 Microsoft Virtual PC 并收到了类似的错误消息。我安装了 Sun 的[VirtualBox](http://www.virtualbox.org/)，它安装得很好，但我无法让网络在来宾 Ubuntu 操作系统中工作。我的下一步是尝试[QEMU](http://bellard.org/qemu/download.html) ，尽管性能可能会成为问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-15T03:51:30.583

你应该看看大型机——它们从一开始就是虚拟化的：

硬件 - 运行 Hypervisor Type 1 - Level 1 你有 zVM - Type 2 Hypervisor - Level 2 你有 zOS - 你的主要大型操作系统 - Level 3 和/或在这你有 zLinux - Level 3 和/或这你有 zVM 用于测试下一个版本 - 3 级和/在这个你有 zOS 用于测试 zVM 和 zOS 都在下一个版本 - 4 级

所以降到第 4 级很常见 请注意，在大型机上，您可以同时运行 1000 台虚拟机——大多数开始使用 zVM/CMS 和 zVM/Linux 的站点通常会这样做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T15:28:25.967

我可以看到两个解决方案（如果你在一个疯狂的虚拟机中计算一个虚拟机，三个）。

1.  新硬件，它应该足够强大，可以处理几个专门用于测试的 VM（sharpoint 等）。在这种情况下，您的团队可以被授予更多权利，而不会影响非测试虚拟机。

2.  Sharepoint 测试 VM 被移动到主 VM 池，需要访问的人可以签出/部署/回滚测试资源。这可以直接通过 VMWare 工具或通过通过 VMWare API 工作的内部项目来实现。

这应该是网络/开发/测试之间的共同决定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-22T22:20:08.033

JFYI：我尝试安装和运行 VMware ESXi 服务器主机（子 ESXi 服务器）作为虚拟机（在父 ESXi 服务器上）并且它运行但是你不能在子 ESXi 服务器下运行任何虚拟机。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-01T06:15:06.760

我正在单台物理机上练习 VMware vSphere 数据中心虚拟化。在 Windows 8 操作系统上安装了 VMware Workstation。在 VM Workstation 中，我安装了 Windows Server 2008 操作系统、VMware ESXi 操作系统并创建了 VMware Data center LAB。在 LAB 中运行着虚拟机，它确认我们可以在 VMware 中使用 VMware。但这取决于您的需求和选择的产品。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-05-26T19:50:29.347

您可以在VMware Workstation上安装ESXi，学习ESXi很有用，所以没有理由在VMware中运行VMware。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-03-21T16:15:37.413

是的。您可以在 VMWare 中运行 VMWare。虽然它不受官方支持，但您可以在子 ESX 中部署 VM。我检查了一个高级功能，例如通过 HBA 卡但在子 ESX 中不可用，因此我无法从阵列提供 LUN。所以在生产中最好不要使用它。但是对于培训和实践，这可以使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-06-13T12:59:13.500

你可以这样做。

您可以在另一个 vmware esxi 的虚拟机中安装 vmware esxi。

但是性能会很差。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-05T14:17:19.397

完全有效..除了某种测试或某种教育目的之外，完全不能这样做，因为你不会得到支持。从我有限的经验来看，它的表现并不好。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-01-13T15:16:12.933

“是否可以在 VMware 内部运行 VMware” 什么？

我可以在托管在某处的 VMWare 机器上运行带有 Sharepoint 的 Windows。

或者，我可以在 WMWare 机器上运行带有 Sharepoint 的 Windows，该机器实际上是托管在某处的 VMWare 机器。

为什么我要添加一个嵌套级别？为什么不直接使用 Windows，Sharepoint 托管在某处？

您可以在单个主机上运行任意数量的 VMWare。很多不同的版本做很多不同的事情。

嵌套它们没有意义。

# c# - 如何从登录控件调用 AuthenticationService？

> ID：439253
> 
> 赞同：0
> 
> 时间：2009-01-13T15:03:30.433
> 
> 标签：c#, asp.net, wcf, authentication

我有 2 个项目的解决方案。在第一个项目中，我有一个带有登录控件的网站。在第二个项目中，我有一个配置了 AuthenticatonService 的 WCF 项目。整合两者的最简单方法是什么？换句话说，如何从登录控件调用身份验证服务？

编辑：

好的，我的意思是，默认情况下，您可以在登录控件中设置*MembershipProvider属性以进行身份​​验证。*此属性引用 machine.config 或 web.config 中本地定义的提供程序。

我想要的是停止使用本地定义的提供程序，而是调用远程 WCF 身份验证服务。很抱歉没有让自己清楚。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:13:17.123

我相信这就是您要寻找的内容：[将 WCF 服务暴露给客户端脚本](http://msdn.microsoft.com/en-us/library/bb514961.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:15:48.813

好的，

最后我让它工作了。这就是我所做的：

*   向 WCF url 添加服务引用：

    [http://localhost:8080/servicios/MiServicio.svc](http://localhost:8080/servicios/MiServicio.svc)

*   重置了 Login 控件的 Membership Provider 属性。这实际上是查找随 VS 2008 (SQLEXPRESS) 安装的默认成员资格提供程序。

*   实现 Authenticate 事件。必须这样做才能覆盖使用默认成员资格提供程序进行身份验证的默认行为并进行自定义身份验证。在这种情况下，创建代理身份验证服务类的实例并调用 Login 方法。

`proteted void login_Authenticate(object sender, AuthenticateEventArgse){ AuthenticationServiceClient client = new AuthenticationServiceClient(); e.Authenticated = client.Login(login.UserName, login.Password, "", true); }`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:19:23.403

我认为您需要编写一个在 ValidateUser 方法期间调用您的身份验证服务的[成员资格提供程序。](http://msdn.microsoft.com/en-us/library/aa479031.aspx)

AuthenticationService 允许您使用 ASP.NET Membership 系统来验证其他应用程序中的用户 - 而不是提供一种机制来验证网站本身的用户。

# c# - C# 使用子字符串，我如何提取这个字符串？

> ID：439255
> 
> 赞同：3
> 
> 时间：2009-01-13T15:03:41.760
> 
> 标签：c#, substring

我想提取下面 URL 中的第一个文件夹，在本例中它被称为“extractThisFolderName”，但该文件夹可以有任何名称和任何长度。考虑到这一点，我如何使用子字符串来提取第一个文件夹名称？

字符串：www.somewebsite.com/extractThisFolderName/leave/this/behind

```
String folderName = path.Substring(path.IndexOf(@"/"),XXXXXXXXXXX); 
```

这是我正在努力的长度。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-13T15:06:34.983

如果你得到一个 Uri，为什么不直接做 uri.Segments[0]？

甚至`path.Split(new Char[] { '/' })[1]`？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:49:52.697

这个问题也适用于正则表达式。像这样的表达式：

```
(?<host>.*?)/(?<folder>.*?)/ 
```

清楚发生了什么，您可以通过这些名称获取数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T15:08:47.117

如果您要使用每个路径部分，您可以使用：

```
String[] parts = path.Split('/'); 
```

此时您可以通过访问parts[1] 来访问“extractThisFolderName”部分。

或者，您可以这样做来拼接出文件夹名称：

```
int firstSlashIndex = path.IndexOf('/');
int secondSlashIndex = path.IndexOf('/', firstSlashIndex + 1);
String folderName = path.Substring(firstSlashIndex + 1, secondSlashIndex - firstSlashIndex); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T15:09:08.300

丹尼尔的回答为您提供了其他实用的方法。使用子字符串的另一种选择：

```
int start = path.IndexOf('/')+1; // Note that you don't need a verbatim string literal
int secondSlash = path.IndexOf('/', start);
return path.Substring(start, secondSlash-start); 
```

当然，您需要在其中添加一些错误检查:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T15:08:17.630

```
int start = path.IndexOf('/');
int end = path.IndexOf('/', start + 1);
if (end == -1) end = path.Length;
string folderName = path.Substring(start + 1, end - start - 1); 
```

编辑：Daniel Schaffer 的关于使用 uri 段的回答更可取，但将其保留，因为它可能是您的路径不是真正有效的 uri。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T15:08:59.033

你可以这样做：

```
string myStr = "www.somewebsite.com/extractThisFolderName/leave/this/behind";
int startIndex = myStr.IndexOf('/') + 1;
int length = myStr.IndexOf('/', startIndex) - startIndex;
Console.WriteLine(myStr.Substring(startIndex, length)); 
```

同时，我假设这是在 ASP.Net 中完成的，如果是这样的话，我认为可能有另一种方法可以在不进行查询的情况下获得它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T15:09:21.997

```
folderName.Split('/')[1] 
```

# clickonce - 有没有人在 ClickOnce 中使用过 GoDaddy 的代码签名证书

> ID：439259
> 
> 赞同：2
> 
> 时间：2009-01-13T15:05:00.400
> 
> 标签：clickonce, certificate, code-signing

根据 GoDaddy 的常见问题解答，他们支持 Microsoft 的 SignTool，但未提及 mage.exe。Mage.exe 用于对应用程序进行签名，但我无法确定 mage.exe 是否使用 SignTool。如果有人将 GoDaddy 的代码签名证书用于 ClickOnce，我们将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:34:58.280

我将 GoDaddy 的代码签名证书与 ClickOnce 部署一起使用。要签署部署，我只需在部署构建脚本期间调用 MSBuild 中的[SignFile 任务](http://msdn.microsoft.com/en-us/library/ms164304.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-04T08:27:12.753

Mage.exe 和 SignFile MSBuild 任务都使用 SignTool.exe 对文件进行签名。（反映了这两种工具，以构建我自己的自定义解决方案）

# c++ - 有人用过 smartwin（一个 Windows C++ GUI OS 库）吗？

> ID：439260
> 
> 赞同：2
> 
> 时间：2009-01-13T15:05:06.937
> 
> 标签：c++, windows, user-interface

我正在考虑将[smartwin](http://smartwin.sourceforge.net/)用于仅适用于 Windows 平台的 C++ 项目，但请注意，自 2.0rc5 发布以来已有 18 个月没有发布，即它似乎不再维护。

玩过之后感觉还不错，我喜欢它使用模板、信号/槽（通过 boost），它会满足项目需求，但我希望其他正在使用它的用户的经验来帮助我增加它的权重？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T21:42:02.780

你看过[Qt](http://en.wikipedia.org/wiki/Qt_%28toolkit%29)吗？我认为它具有您正在寻找的许多功能，并且在开发人员工具和框架成熟度方面都会得到*更好的*支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-01T07:16:26.347

“......我们真的不需要完整的应用程序框架或跨平台可移植性 - 只需一个可以轻松添加到现有应用程序的精简版 Win32 GUI 框架”

这正是 Smartwin 的目的所在。将它与 Sally IDE 结合使用，您将拥有一个快速紧凑且完整的完整 RAD 开发环境。请注意，Google 目前在其 Chrome 浏览器中使用 WTL，但 Smartwin 甚至比 WTL 更有效。

Smartwin 还有一个名为 Winelib 的库，他们希望从长远来看，这也是一个可移植的环境。

就个人而言，如果你想要便携，我会选择 wxWidgets。但是，如果您确实打算继续使用 Windows，我当然会考虑 Smartwin++。

我自己会使用 wxWidgets，因为那是我通常使用和习惯的，所以这只是个人选择。

祝你好运。-唐纳德

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:18:28.337

考虑使用[wxWidgets](http://www.wxwidgets.org)。它是成熟的、支持良好的库，具有许多特性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-01T23:23:52.317

终极++ [http://www.ultimatepp.org/](http://www.ultimatepp.org/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-18T11:19:14.850

最后选择了 WTL，这是一个非常无缝和无痛的过渡。感谢大家的评论和回复。

# php - 在 CLI 和 Web 上调用时，如何让 PHP 使用相同的 APC 缓存？

> ID：439262
> 
> 赞同：11
> 
> 时间：2009-01-13T15:05:53.503
> 
> 标签：php, linux, caching, command-line-interface, apc

我正在使用[APC](http://uk3.php.net/apc)缓存用户变量（使用 apc_store/apc_fetch 命令）。我还使用选项“apc.enable_cli = 1”为 CLI 启用了 APC。但是，PHP 的 CLI 版本似乎访问了与 Apache 使用的版本不同的 APC 缓存。

是否可以将 APC 配置为对 CLI 和 Web 调用使用相同的缓存？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T21:44:41.763

不可能.. 完成您所要求的事情的唯一方法是使用 memcacheD 之类的东西。或者运行你需要通过你的网络服务器运行的东西。什么正在运行的 CLI 不能通过带有 cronjob 的 Web 脚本运行？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-06T19:59:33.360

您可以使用 shm。该技术可用于访问 Unix 共享内存。您可以将一些变量放在 shm 中，然后在另一个脚本中，甚至用另一种语言编写，您可以获得共享变量。

shm_put_var 和 shm_get_var。

它比 APC 慢，但比 memcached、redis 等要快。

我希望它会帮助你，我很抱歉我的英语......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-30T17:29:00.487

将您的 CLI 称为 CGI /path-to/cgi-sys/php5.cgi /home/name/crons/engine.php

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-02T00:28:18.293

您需要一个用 php 编写的 Web 服务器——APC 缓存仅由分叉的子进程共享。如果你有一个 php 网络服务器，你可以启动一个主 cli，初始化 apc，在一个子进程中 fork 和加载/运行 web 服务器，并在另一个子进程中 fork 和运行你的 php cli 脚本。有点恶心，呵呵。fork 和 require()，我认为 apc 缓存不会在 exec() 中存活

# asp.net - How do I add an empty first entry do an ?

> ID：439265
> 
> 赞同：11
> 
> 时间：2009-01-13T15:06:39.927
> 
> 标签：asp.net, data-binding

I have a dropdown, I have a datasource, I have `AutoPostBack` set to `true`.
I want to add a first entry to the datasource that says something like "--- select country ---" and selecting this entry won't cause postback.
This feels like it should be easy to do, yet I can't seem to be able to find a good solution.
Thanks.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-13T15:09:23.010

In your aspx page (the important part is handling the DataBound event and setting CausesValidation="true" to force validation of a drop down list):

```
<asp:DropDownList ID="ddlCountries" runat="server" DataSourceID="dsCountries" AutoPostBack="true" OnDataBound="ddlCountries_DataBound" CausesValidation="true" />
<asp:RequiredFieldValidator ID="rfvCountries" runat="server" ControlToValidate="ddlCountries" Display="Dynamic" ErrorMessage="Please select a country." /> 
```

In your codebehind (it is important that the value of the inserted item is String.Empty for the required field validator to work!):

```
protected void ddlCountries_DataBound(Object sender, EventArgs e)
{
ddlCountries.Items.Insert(0, new ListItem("--- select country ---", String.Empty));
} 
```

**Note:** If you don't want the validator's message to display, set the "Display" property to "None".

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T15:10:39.467

You can also add the row manually through the designer but you have to make sure that the DropDownList's property AppendDataBoundItems = True as well so that the databound rows are tacked onto the first row.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:14:59.693

Previous answers deal with inserting the value, but I understand your problem is the AutoPostBack property. I suppose you dont want to postback that value and that's your problem, am I right?

Maybe there's a better solution, but I'd suggest not using AutoPostBack. You could handle postback automatically using the selected value change event.

IMHO if the AutoPostBack does not work as you want, it's always better to implement your own solution that to put some kind of "patch" over it to "fix" it.

Hope that helps

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:14:24.003

Use the insert method as others have suggested to add the item at index 0 with a value to indicate not selected ( for example 'unknown'). Then use validators, add a required field validator and set the InitialValue property to the value of the new list item ('unknown' in our example).

Set index 0 to be the selected item on page load and if not postback.

If the user doesn't select another option the validator will prevent the postback.

Hope that's what you are looking for.

# ajax - 原型 Ajax.PeriodicalUpdater 在服务器无法访问时插入空字符串

> ID：439269
> 
> 赞同：2
> 
> 时间：2009-01-13T15:08:22.560
> 
> 标签：ajax, prototypejs

我正在使用以下内容获取一些更新的 HTML 并将其插入到 id 为“内容”的 div 中

```
var updater = new Ajax.PeriodicalUpdater('content', '/Doc?'+d.getTime(),
  {
    method: 'post',
    frequency: 5,
  }); 
```

问题是当服务器关闭时（它在一个正在修改和服务器数据的应用程序内部运行），更新程序然后简单地清除内容 div。

有没有办法让它在 PeriodicalUpdater 超时时得到 404 等，它只是保持内容不变？我宁愿最后可用的数据只保留在那里，而不是被删除。

* * *

为了完整起见，这是我的整个代码：

```
<html>
<head>
<title></title>
<script type="text/javascript" src="/Prototype"></script>
<script type="text/javascript">
var css;
var css_data;

function load_content()
{
  var d = new Date();

  css = document.createElement('style');
  css.setAttribute('type', 'text/css');
  if(css.styleSheet) { css.styleSheet.cssText = '';} //Because IE is evil
  else { css_data = document.createTextNode(''); css.appendChild(css_data); } //And everyone else is cool
  document.getElementsByTagName("head")[0].appendChild(css);

  var updater = new Ajax.PeriodicalUpdater({success: 'content'}, '/%doc_path%?'+d.getTime(),
  {
    method: 'post',
    frequency: 5,
    onSuccess: function(transport) {
          new Ajax.Request('/%css_path%?'+d.getTime(), {
              method: 'post',
              onSuccess: function(transport) {
                if(css.styleSheet) { css.styleSheet.cssText = transport.responseText}
                else { 
                    var new_css_data = document.createTextNode(transport.responseText);
                    css.replaceChild(new_css_data, css_data); 
                    css_data = new_css_data;
                } 
              }
          });
          new Ajax.Request('/%title_path%?'+d.getTime(), {
              method: 'post',
              onSuccess: function(transport) {
                document.title = transport.responseText;
              }
          });
    }
  });
}

</script>

</head>

<body>
<div id="content"></div>

<script type="text/javascript">
    load_content();
</script>

</body>
</html> 
```

如您所见，我尝试了 Triptych 的解决方案……但还是不行。当请求仍然失败时，它会更新空白数据。既然我现在已经掌握了全部内容，那么任何人都可以看到我正在犯的任何错误。

注意：忽略像 %doc_path% 这样的字符串...这些只是我使用的控制字符串，以便以后可以通过编程方式将它们替换为每个文档的正确路径...所有在服务器上完成的东西实际上并不重要为了这。

* * *

[@Vinze](https://stackoverflow.com/questions/439269/prototype-ajax-periodicalupdater-inserts-empty-string-when-server-unreachable#439292)

根据文档，onFailure 是“在请求完成并且其状态代码存在但不属于 2xy 系列时调用。如果定义了特定于代码的回调，则会跳过此操作，并且在 onComplete 之前发生。”

但是如果服务器停止了，那不就是超时了，根本就没有状态码吗？可能我理解错了...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:12:24.533

您可以在选项列表中添加一个 onFailure 选项，因为 Ajax.PeriodicalUpdater 继承了 Ajax.Request ( [http://www.prototypejs.org/api/ajax/request](http://www.prototypejs.org/api/ajax/request) )的属性

相反，您可能对使用“onComplete”或以下链接中的任何“请求生命周期”更感兴趣

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:30:57.443

将对象（不是字符串）作为第一个参数传递给 PeriodicalUpdater。键入为“成功”的值只会在成功的 AJAX 调用时调用。

```
new Ajax.PeriodicalUpdater({success: 'content'}, '/Doc?'+d.getTime(),
  {
    method: 'post',
    frequency: 5,
  }); 
```

[更多关于 Ajax.Updater](http://www.prototypejs.org/api/ajax/updater)（PeriodicalUpdater 继承自）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:28:43.363

自己做这一切怎么样？

从调用更新的函数开始：

```
function requestMoreInfo(){
new Ajax.Request('url',
  {
    method:'get',
    parameters:  "someget=here",
    onSuccess: handleTheReturn
  });

} 
```

然后创建一个函数来处理来自服务器的答案：

```
function handleTheReturn(reply){
    var newMessages = eval('(' + reply.responseText + ')');
    //update your element or whatever
} 
```

然后每 20（或其他）秒运行一次：

```
new PeriodicalExecuter(requestMoreInfo, 20); 
```

然后只需将第一个 requestMoreInfo 添加到您的 onload 函数和您的好去...现在解决您的问题，只需验证 handleTheReturn 函数中的 newMessages var，您就可以做任何您想做的事情（让服务器发送一个 JSON 对象以了解没问题，或者其他一些代码，或者搜索您想要避免的特定错误！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-14T10:55:44.117

更多细节。

Ajax.PeriodicalUpdater 不*继承*自 Ajax.Updater，如[http://www.prototypejs.org/api/ajax/periodicalupdater](http://www.prototypejs.org/api/ajax/periodicalupdater)中所述：

> Ajax.PeriodicalUpdater 不是 Ajax.Updater 的特化，尽管它的名字。

它确实将可选参数转发给 Ajax.Updater（它本身就是一个继承自 Ajax.Request 的类），这似乎暗示它等同于实例化 Ajax.Request 并将回调传递给它。

我已经测试并且可以确认在这种情况下添加 onFailure 函数*不起作用。*也不会添加 onException。

两者都可以正常工作，因为它们被传递给由 Ajax.PeriodicalUpdater 实例化的 Ajax.Updater 对象。但是，经过一些调试后，Ajax.Updater 似乎从未将不可用的服务器视为异常或故障。也就是说，成功的容器总是会更新（好吧，在这种情况下是清空的），即使定义为 {success : 'content', failure : 'failureContent'} 也是如此。

另外，根据我的测试，当服务器没有响应时，Ajax.Updater（和 Ajax.PeriodicalUpdater）既不会调用 onSuccess() 也不会调用 onComplete()。

事实上，我设法得到的唯一回调是on0，如下：

```
new Ajax.PeriodicalUpdater('content', 'url', {
    frequency: 5,
    on0: function(requester, exception) {
        alert("ERROR 0");
    }
}); 
```

当服务器无法访问时，0 似乎是 Ajax.Request（Ajax.Updater 的父类）的错误代码。

然而，坏消息是 on0()在内容更新/清空*之前*被调用，这意味着不可能用自定义内容替换该内容。

据我所知，在服务器无法访问的情况下，更新内容后根本不会调用任何可选回调。

Ajax.PeriodicalUpdater 和 Ajax.Updater 都是如此。这意味着我看到获得所需行为的唯一方法是直接使用 Ajax.Request。

# javascript - 如何在 Greasemonkey 中嵌入额外的 jQuery 插件

> ID：439286
> 
> 赞同：5
> 
> 时间：2009-01-13T15:10:48.873
> 
> 标签：javascript, jquery, greasemonkey

所以我已经能够让 Greasemonkey 和 jQuery 1.2.6 毫无问题地一起工作，但是，现在我想知道如何将其他 jQuery 插件嵌入到我的 Greasemonkey 脚本中，例如 Eric Martin 的 SimpleModal 插件（[http://www .ericmmartin.com/projects/simplemodal/](http://www.ericmmartin.com/projects/simplemodal/)）。

以下代码加载了 jQuery，但我不确定如何正确加载 SimpleModal：

```
 var GM_JQ = document.createElement('script');
    GM_JQ.src = 'http://jqueryjs.googlecode.com/files/jquery-1.2.6.min.js';
    GM_JQ.type = 'text/javascript';
    document.getElementsByTagName('head')[0].appendChild(GM_JQ);

    var GM_JQ_SM = document.createElement('script');
    GM_JQ_SM.src = 'http://simplemodal.googlecode.com/files/jquery.simplemodal-1.2.2.min.js';
    GM_JQ_SM.type = 'text/javascript';
    document.getElementsByTagName('head')[0].appendChild(GM_JQ_SM);

    // Check if jQuery's loaded
    function GM_wait() {
        if(typeof unsafeWindow.jQuery == 'undefined') { 
            window.setTimeout(GM_wait,100); 
        }
        else { 
            $ = unsafeWindow.jQuery; 
        }

    }
    GM_wait(); 
```

有人有想法么？谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T15:30:56.820

首先，如果您可以接受没有 Firebug 调试访问权限，那么包含 jquery 的最简单方法是使用 require 设置：

```
// @require        http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js
// @require        http://ajax.googleapis.com/ajax/libs/jqueryui/1.5.2/jquery-ui.min.js 
```

在该行之后，您可以包含其他外部脚本。大多数 jquery 插件不像 jquery api 那样可用，但您可以自己托管。

使用 require 还允许您转储所有加载代码并简单地使用：

```
$(document).ready( function() { ... }); 
```

Firebug 将报告错误，但您将无法进入调试器。

此外，一旦您加载了 jquery，您就可以加载其他项目，如下所示：

```
$('head').append("<link href='http://www.somewebsite.com/styles.css' type='text/css' rel='stylesheet'>"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T18:19:07.067

还可以查看有关在 GreaseMonkey 脚本和[@require 块](http://wiki.greasespot.net/Metadata_block#.40require)[中使用 JQuery的 GreaseMonkeyWiki 页面。](http://wiki.greasespot.net/Code_snippets#Use_jQuery_in_a_GreaseMonkey_script)

# c# - 轻轻杀死一个进程

> ID：439288
> 
> 赞同：1
> 
> 时间：2009-01-13T15:11:00.653
> 
> 标签：c#, c++, winapi

我有一个 Windows 服务（C#），它产生了几个子本机进程（C++）。

我想偶尔轻轻地杀死这些进程。（轻轻地 = 让 procs 在停止之前完成其工作）。

我尝试使用 SetConsoleCtrlHandler() 例程将子进程注册到控制台事件，并从 C# 代码调用 CloseMainWindow() 以引发“关闭控制台”事件。

这对我不起作用。主要是因为子进程不是控制台应用程序。

有谁知道可以使用哪些其他方法来满足此要求？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T15:17:35.100

想到内核事件对象：您的“经理”引发了一个*命名*事件。您的子进程应至少每隔一段时间检查一次此事件的状态（或有一个持续检查它的线程）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T15:18:32.227

向子进程发布消息。这可以是您自己选择的消息，因此您可以在子进程中获取消息，然后执行需要执行的操作，请参阅[WM_USER](http://msdn.microsoft.com/en-us/library/aa928069.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:30:36.183

看看我[在这里描述的使用](https://stackoverflow.com/questions/209086/how-do-i-guarantee-fast-shutdown-of-my-win32-app#210385)[QueueUserAPC](http://msdn.microsoft.com/en-us/library/ms684954(VS.85).aspx)和异常的技术。你可能会发现它很有用。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-13T15:17:14.510

C# 有一种本地方式来访问正在运行的服务。您将需要“System.ServiceProcess”命名空间，代码应如下所示：

```
ServiceController[] services = ServiceController.GetServices(); 
for(int i = 0; i <  services.Length; i++)   
    {
       if (services[i].DisplayName == "COM+ System Application")  
            { 
               if (sc.Status == ServiceControllerStatus.Running) 
            { 
            sc.Stop(); 
            } 
        if (sc.Status == ServiceControllerStatus.Stopped) 
            { 
            sc.Start(); 
            } 
             } 
    } 
   } 
```

# php - 验证一个或另一个

> ID：439297
> 
> 赞同：0
> 
> 时间：2009-01-13T15:15:26.947
> 
> 标签：php, javascript, html, validation

我创建了一个 javascript 函数，它允许我验证一个字段或另一个字段是否已填充（调用，令人震惊的是，`oneortheother`）。本质上，它检查是否都没有填充，或者两者都没有填充，然后抛出错误。

正在验证的字段之一是`input type="file"`字段。我在字段下方显示现有文件，以便用户可以查看它是否是他们想要的文件。

有没有办法在`oneortheother`没有值的情况下仍然通过验证`input type="file"`？任何类型的javascript技巧？

在这一点上我束手无策，今天晚些时候有一个需要这个功能的演示，所以任何帮助都将不胜感激。

**编辑：**

根据要求，这里有一些例子：

```
<label for="pdf">Upload PDF:
<span class="fieldnote">Files of type .pdf</span>
</label>
<input type="file" name="pdf" id="pdf" class="external_form_field oneortheother_url" value="/downloads/white_papers/HigherOrderPerl.pdf"  />
<label>Existing file:</label><span class="preview"><a href="/downloads/white_papers/HigherOrderPerl.pdf" target="_blank">HigherOrderPerl.pdf</a></span>
<label for="url">Link to asset:</label>
<input type="text" name="url" id="url" class="external_form_field oneortheother_pdf" value=""  size="25" /> 
```

请注意，该类`oneortheother_url`和`oneortheother_pdf`已应用。这允许验证例程知道要与哪个字段进行比较。比较是：

```
if (fObj.value && fObj2.value) { } 
```

和

```
if (!fObj.value && !fObj2.value) { } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T15:50:39.557

不幸的是，我无法理解实际的问题，但这里有一个侧边栏提示：

在这种情况下，XOR 运算符可以派上用场（虽然晦涩难懂）：

```
if (fObj.value ^ fObj2.value) {
    // Only one value is set, we're good
} else {
    // Both of them are set or neither of them are set
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:37:28.307

我不确定您的验证功能是如何工作的，但您似乎可以添加一个隐藏的输入来保存上传的预览文件的 url 或文件输入中的值。然后您可以将 url 输入与隐藏输入进行比较。

但您似乎只需要编写一个自定义验证函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:38:20.020

我不确定我是否完全理解你的问题，因为我不清楚。

你想检查这个：

```
if (fObj.value && fObj2.value) {} 
```

和

```
if (!fObj.value && !fObj2.value) {} 
```

那么为什么不把它也加入...

```
if (fObj.value && !fObj2.value) {} 
```

或者

```
if (!fObj.value && fObj2.value) {} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T15:46:01.940

在每个选项旁边添加一个单选按钮，并允许选定的单选按钮确定使用哪个选项呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T15:51:09.353

我不确定您到底要在这里做什么，但是您可以添加一个隐藏的表单字段，然后将一个函数附加到文件输入和 URL 输入的`onchange`事件中，这会将隐藏字段设置为此值。

从根本上说，我什至不确定您当前采用的方法是否合适 - 例如，Firefox 3 不允许您直接编辑文件字段的内容，据我所知，您无法“取消设置”一个值。因此，一旦选择了文件，“pdf”输入将*始终*为非空，这与您设置的约束（据我了解）意味着“url”输入实际上被永久禁用。这更糟糕，因为您给文件输入一个初始值，这样它就永远不会是空/空字符串。

您可能需要退后一步，仔细考虑您想要实现的目标以及替代技术是否会更好。例如，用于在文件上传框或 URL 资源之间进行选择的单选按钮，可根据需要禁用和启用字段。

此外，即使在编辑之后，这里的大多数人也不太明白您在问什么，这表明它有些不太直观，这意味着将来需要维护此代码的人可能经历类似的事情。同样，重构设计可能是有序的，或者可能只是一堆描述性的评论。

# java - 在 Java 中为 XML 编码文本数据的最佳方法是什么？

> ID：439298
> 
> 赞同：104
> 
> 时间：2009-01-13T15:15:30.503
> 
> 标签：java, xml, encoding

[与这个问题](https://stackoverflow.com/questions/157646/best-way-to-encode-text-data-for-xml)非常相似，Java 除外。

在 Java 中为 XML 输出编码字符串的推荐方法是什么。字符串可能包含“&”、“<”等字符。

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-01-13T15:53:33.170

正如其他人所提到的，使用 XML 库是最简单的方法。[`StringEscapeUtils`](https://commons.apache.org/proper/commons-text/javadocs/api-release/org/apache/commons/text/StringEscapeUtils.html)如果您确实想逃避自己，可以查看[Apache Commons Lang](http://commons.apache.org/lang/)库。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-01-13T15:18:33.523

非常简单：使用 XML 库。这样一来，它实际上是*正确*的，而不需要详细了解 XML 规范。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-13T15:48:20.047

就用吧。

```
<![CDATA[ your text here ]]> 
```

这将允许除结尾之外的任何字符

```
]]> 
```

因此，您可以包含非法字符，例如 & 和 >。例如。

```
<element><![CDATA[ characters such as & and > are allowed ]]></element> 
```

但是，需要对属性进行转义，因为 CDATA 块不能用于它们。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-04-05T20:17:20.307

试试这个：

```
String xmlEscapeText(String t) {
   StringBuilder sb = new StringBuilder();
   for(int i = 0; i < t.length(); i++){
      char c = t.charAt(i);
      switch(c){
      case '<': sb.append("&lt;"); break;
      case '>': sb.append("&gt;"); break;
      case '\"': sb.append("&quot;"); break;
      case '&': sb.append("&amp;"); break;
      case '\'': sb.append("&apos;"); break;
      default:
         if(c>0x7e) {
            sb.append("&#"+((int)c)+";");
         }else
            sb.append(c);
      }
   }
   return sb.toString();
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-01-13T19:00:22.170

这对我来说很好地提供了文本字符串的转义版本：

```
public class XMLHelper {

/**
 * Returns the string where all non-ascii and <, &, > are encoded as numeric entities. I.e. "&lt;A &amp; B &gt;"
 * .... (insert result here). The result is safe to include anywhere in a text field in an XML-string. If there was
 * no characters to protect, the original string is returned.
 * 
 * @param originalUnprotectedString
 *            original string which may contain characters either reserved in XML or with different representation
 *            in different encodings (like 8859-1 and UFT-8)
 * @return
 */
public static String protectSpecialCharacters(String originalUnprotectedString) {
    if (originalUnprotectedString == null) {
        return null;
    }
    boolean anyCharactersProtected = false;

    StringBuffer stringBuffer = new StringBuffer();
    for (int i = 0; i < originalUnprotectedString.length(); i++) {
        char ch = originalUnprotectedString.charAt(i);

        boolean controlCharacter = ch < 32;
        boolean unicodeButNotAscii = ch > 126;
        boolean characterWithSpecialMeaningInXML = ch == '<' || ch == '&' || ch == '>';

        if (characterWithSpecialMeaningInXML || unicodeButNotAscii || controlCharacter) {
            stringBuffer.append("&#" + (int) ch + ";");
            anyCharactersProtected = true;
        } else {
            stringBuffer.append(ch);
        }
    }
    if (anyCharactersProtected == false) {
        return originalUnprotectedString;
    }

    return stringBuffer.toString();
}

} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2018-02-02T17:36:53.717

这个问题已经八年了，仍然不是一个完全正确的答案！不，您不必导入整个第三方 API 来完成这个简单的任务。不好的建议。

以下方法将：

*   正确处理基本多语言平面之外的字符
*   XML 中所需的转义字符
*   转义任何非 ASCII 字符，这是可选的但很常见
*   用 Unicode 替换字符替换XML 1.0 中的*非法*字符。这里没有最佳选择 - 删除它们同样有效。

我已尝试针对最常见的情况进行优化，同时仍确保您可以通过管道传输 /dev/random 并获得 XML 中的有效字符串。

```
public static String encodeXML(CharSequence s) {
    StringBuilder sb = new StringBuilder();
    int len = s.length();
    for (int i=0;i<len;i++) {
        int c = s.charAt(i);
        if (c >= 0xd800 && c <= 0xdbff && i + 1 < len) {
            c = ((c-0xd7c0)<<10) | (s.charAt(++i)&0x3ff);    // UTF16 decode
        }
        if (c < 0x80) {      // ASCII range: test most common case first
            if (c < 0x20 && (c != '\t' && c != '\r' && c != '\n')) {
                // Illegal XML character, even encoded. Skip or substitute
                sb.append("&#xfffd;");   // Unicode replacement character
            } else {
                switch(c) {
                  case '&':  sb.append("&amp;"); break;
                  case '>':  sb.append("&gt;"); break;
                  case '<':  sb.append("&lt;"); break;
                  // Uncomment next two if encoding for an XML attribute
//                  case '\''  sb.append("&apos;"); break;
//                  case '\"'  sb.append("&quot;"); break;
                  // Uncomment next three if you prefer, but not required
//                  case '\n'  sb.append("&#10;"); break;
//                  case '\r'  sb.append("&#13;"); break;
//                  case '\t'  sb.append("&#9;"); break;

                  default:   sb.append((char)c);
                }
            }
        } else if ((c >= 0xd800 && c <= 0xdfff) || c == 0xfffe || c == 0xffff) {
            // Illegal XML character, even encoded. Skip or substitute
            sb.append("&#xfffd;");   // Unicode replacement character
        } else {
            sb.append("&#x");
            sb.append(Integer.toHexString(c));
            sb.append(';');
        }
    }
    return sb.toString();
} 
```

*编辑：对于那些继续坚持在有完美的 Java API 来处理 XML 时为此编写自己的代码是愚蠢的，您可能想知道 Oracle Java 8 中包含的 StAX API（我没有测试过其他人) 无法正确编码 CDATA 内容：它不会转义 ]]> 内容中的序列。第三方库，即使是 Java 核心的一部分，也并不总是最好的选择。*

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-08-31T01:30:06.427

`StringEscapeUtils.escapeXml()`不转义控制字符 (< 0x20)。XML 1.1 允许控制字符；XML 1.0 没有。例如，`XStream.toXML()`将愉快地将 Java 对象的控制字符序列化为 XML，XML 1.0 解析器将拒绝该字符。

要使用 Apache commons-lang 转义控制字符，请使用

```
NumericEntityEscaper.below(0x20).translate(StringEscapeUtils.escapeXml(str)) 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2014-09-16T09:56:48.103

```
public String escapeXml(String s) {
    return s.replaceAll("&", "&amp;").replaceAll(">", "&gt;").replaceAll("<", "&lt;").replaceAll("\"", "&quot;").replaceAll("'", "&apos;");
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2017-03-27T13:16:52.427

对于那些寻找最快编写解决方案的人：使用来自[apache commons-lang 的](http://commons.apache.org/proper/commons-lang/)方法：

*   [`StringEscapeUtils.escapeXml10()`](https://commons.apache.org/proper/commons-lang/javadocs/api-3.3/org/apache/commons/lang3/StringEscapeUtils.html#escapeXml10(java.lang.String))对于 xml 1.0
*   [`StringEscapeUtils.escapeXml11()`](https://commons.apache.org/proper/commons-lang/javadocs/api-3.3/org/apache/commons/lang3/StringEscapeUtils.html#escapeXml11(java.lang.String))对于 xml 1.1
*   [`StringEscapeUtils.escapeXml()`](https://commons.apache.org/proper/commons-lang/javadocs/api-3.3/org/apache/commons/lang3/StringEscapeUtils.html#escapeXml(java.lang.String))现在已弃用，但过去常用

请记住包含依赖项：

```
<dependency>
  <groupId>org.apache.commons</groupId>
  <artifactId>commons-lang3</artifactId>
  <version>3.5</version> <!--check current version! -->
</dependency> 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2010-05-19T07:00:24.007

虽然理想主义说使用 XML 库，但恕我直言，如果您对 XML 有基本的了解，那么常识和性能就一直说是模板。它也可以说更具可读性。尽管使用库的转义例程可能是一个好主意。

考虑一下：XML*本来*是由人类编写的。

当您将 XML 作为“对象”更好地模拟您的问题时，使用库来生成 XML。例如，如果可插入模块参与构建此 XML 的过程。

编辑：至于如何在模板中实际转义 XML，使用 CDATA 或`escapeXml(string)`来自 JSTL 是两个很好的解决方案，`escapeXml(string)`可以这样使用：

```
<%@taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<item>${fn:escapeXml(value)}</item> 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-12-01T17:42:11.363

StringEscapeUtils.escapeXml() 的行为已从 Commons Lang 2.5 更改为 3.0。它现在不再转义大于 0x7f 的 Unicode 字符。

这是一件好事，旧方法有点急于逃避可以插入到 utf8 文档中的实体。

Google Guava 11.0 中包含的新转义器似乎也很有希望： [http ://code.google.com/p/guava-libraries/issues/detail?id=799](http://code.google.com/p/guava-libraries/issues/detail?id=799)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-01-13T16:11:30.217

注意：您的问题是关于*escaping*，而不是*encoding*。转义是使用 < 等来让解析器区分“这是一个 XML 命令”和“这是一些文本”。编码是您在 XML 标头中指定的内容（UTF-8、ISO-8859-1 等）。

首先，就像其他人所说的那样，使用 XML 库。XML 看起来很简单，但编码+转义的东西是黑暗的巫术（一旦你遇到变音符号和日语以及其他奇怪的东西，比如“[全角数字](http://msdn.microsoft.com/en-us/library/w1c0s6bb.aspx)”（&#FF11; 是 1），你就会注意到它）。保持 XML 可读性是西西弗斯的任务。

我建议永远不要对 XML 中的文本编码和转义聪明。但不要让这阻止你尝试；只要记住它什么时候咬你（它会）。

也就是说，如果您只使用 UTF-8，为了使内容更具可读性，您可以考虑以下策略：

*   如果文本确实包含 '<'、'>' 或 '&'，则将其换行`<![CDATA[ ... ]]>`
*   如果文本不包含这三个字符，请不要扭曲它。

我在 SQL 编辑器中使用它，它允许开发人员将 SQL 从第三方 SQL 工具剪切并粘贴到 XML 中，而不必担心转义。这是有效的，因为在我们的例子中 SQL 不能包含变音符号，所以我很安全。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-12-19T23:09:38.503

虽然我原则上同意 Jon Skeet，但有时我无法选择使用外部 XML 库。而且我发现这两个函数来转义/取消转义一个简单的值（属性或标签，不是完整的文档）在 Java 中包含的标准 XML 库中是不可用的。

因此，根据我在这里和其他地方看到的不同答案，这是我最终创建的解决方案（没有什么可以作为简单的复制/粘贴）：

```
 public final static String ESCAPE_CHARS = "<>&\"\'";
  public final static List<String> ESCAPE_STRINGS = Collections.unmodifiableList(Arrays.asList(new String[] {
      "&lt;"
    , "&gt;"
    , "&amp;"
    , "&quot;"
    , "&apos;"
  }));

  private static String UNICODE_NULL = "" + ((char)0x00); //null
  private static String UNICODE_LOW =  "" + ((char)0x20); //space
  private static String UNICODE_HIGH = "" + ((char)0x7f);

  //should only be used for the content of an attribute or tag      
  public static String toEscaped(String content) {
    String result = content;

    if ((content != null) && (content.length() > 0)) {
      boolean modified = false;
      StringBuilder stringBuilder = new StringBuilder(content.length());
      for (int i = 0, count = content.length(); i < count; ++i) {
        String character = content.substring(i, i + 1);
        int pos = ESCAPE_CHARS.indexOf(character);
        if (pos > -1) {
          stringBuilder.append(ESCAPE_STRINGS.get(pos));
          modified = true;
        }
        else {
          if (    (character.compareTo(UNICODE_LOW) > -1)
               && (character.compareTo(UNICODE_HIGH) < 1)
             ) {
            stringBuilder.append(character);
          }
          else {
            //Per URL reference below, Unicode null character is always restricted from XML
            //URL: https://en.wikipedia.org/wiki/Valid_characters_in_XML
            if (character.compareTo(UNICODE_NULL) != 0) {
              stringBuilder.append("&#" + ((int)character.charAt(0)) + ";");
            }
            modified = true;
          }
        }
      }
      if (modified) {
        result = stringBuilder.toString();
      }
    }

    return result;
  } 
```

上面包含几个不同的东西：

1.  避免使用基于字符的逻辑，直到它绝对必须 - 提高 unicode 兼容性
2.  尝试尽可能高效，因为概率是第二个“如果”条件可能是最常用的途径
3.  是一个纯函数；即是线程安全的
4.  通过仅在实际发生更改时才返回 StringBuilder 的内容来很好地优化垃圾收集器 - 否则，返回原始字符串

在某些时候，我会写这个函数的反转，toUnescaped()。我只是今天没有时间这样做。当我这样做时，我会用代码更新这个答案。:)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2018-09-17T09:46:27.653

如果您正在寻找一个图书馆来完成这项工作，请尝试：

1.  [Guava 26.0](https://mvnrepository.com/artifact/com.google.guava/guava/26.0-jre)记录[在这里](https://google.github.io/guava/releases/26.0-jre/api/docs/com/google/common/xml/XmlEscapers.html#xmlContentEscaper)

    `return XmlEscapers.xmlContentEscaper().escape(text);`

    > 注：还有一个`xmlAttributeEscaper()`

2.  [此处](https://commons.apache.org/proper/commons-text/javadocs/api-release/org/apache/commons/text/StringEscapeUtils.html#escapeXml11-java.lang.String-)记录的[Apache Commons Text 1.4](https://mvnrepository.com/artifact/org.apache.commons/commons-text/1.4)

    `StringEscapeUtils.escapeXml11(text)`

    > 注意：还有一个`escapeXml10()`方法

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-08-31T22:35:08.947

要转义 XML 字符，最简单的方法是使用 Apache Commons Lang 项目，JAR 可从：[http ://commons.apache.org/lang/ 下载](http://commons.apache.org/lang/)

类是这样的：org.apache.commons.lang3.StringEscapeUtils;

它有一个名为“escapeXml”的方法，它将返回一个适当转义的字符串。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-03-07T09:13:16.700

您可以使用[企业安全 API (ESAPI) 库](https://mvnrepository.com/artifact/org.owasp.esapi/esapi)，它提供了 和 之类的`encodeForXML`方法`encodeForXMLAttribute`。看一下[Encoder](https://static.javadoc.io/org.owasp.esapi/esapi/2.0.1/org/owasp/esapi/Encoder.html)接口的文档；它还包含如何创建[DefaultEncoder](https://static.javadoc.io/org.owasp.esapi/esapi/2.0.1/org/owasp/esapi/reference/DefaultEncoder.html)实例的示例。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-10-26T14:24:16.097

这是一个简单的解决方案，它也非常适合编码重音字符！

```
String in = "Hi Lârry & Môe!";

StringBuilder out = new StringBuilder();
for(int i = 0; i < in.length(); i++) {
    char c = in.charAt(i);
    if(c < 31 || c > 126 || "<>\"'\\&".indexOf(c) >= 0) {
        out.append("&#" + (int) c + ";");
    } else {
        out.append(c);
    }
}

System.out.printf("%s%n", out); 
```

输出

```
Hi L&#226;rry &#38; M&#244;e! 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-13T15:18:57.407

使用[JAXP](http://es.wikipedia.org/wiki/JAXP)并忘记文本处理，它将自动为您完成。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-04-09T09:53:38.257

尝试使用 Apache XML 序列化程序对 XML 进行编码

```
//Serialize DOM
OutputFormat format    = new OutputFormat (doc); 
// as a String
StringWriter stringOut = new StringWriter ();    
XMLSerializer serial   = new XMLSerializer (stringOut, 
                                          format);
serial.serialize(doc);
// Display the XML
System.out.println(stringOut.toString()); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-08-17T07:33:39.843

只需更换

```
 & with &amp; 
```

对于其他角色：

```
> with &gt;
< with &lt;
\" with &quot;
' with &apos; 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-01-23T11:38:08.497

这是我在到处寻找解决方案后发现的：

获取 Jsoup 库：

```
<!-- https://mvnrepository.com/artifact/org.jsoup/jsoup -->
<dependency>
    <groupId>org.jsoup</groupId>
    <artifactId>jsoup</artifactId>
    <version>1.12.1</version>
</dependency> 
```

然后：

```
import org.jsoup.Jsoup
import org.jsoup.nodes.Document
import org.jsoup.nodes.Entities
import org.jsoup.parser.Parser

String xml = '''<?xml version = "1.0"?>
<SOAP-ENV:Envelope
   xmlns:SOAP-ENV = "http://www.w3.org/2001/12/soap-envelope"
   SOAP-ENV:encodingStyle = "http://www.w3.org/2001/12/soap-encoding">

   <SOAP-ENV:Body xmlns:m = "http://www.example.org/quotations">
      <m:GetQuotation>
         <m:QuotationsName> MiscroSoft@G>>gle.com </m:QuotationsName>
      </m:GetQuotation>
   </SOAP-ENV:Body>
</SOAP-ENV:Envelope>'''

Document doc = Jsoup.parse(new ByteArrayInputStream(xml.getBytes("UTF-8")), "UTF-8", "", Parser.xmlParser())
doc.outputSettings().charset("UTF-8")
doc.outputSettings().escapeMode(Entities.EscapeMode.base)

println doc.toString() 
```

希望这可以帮助某人

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2020-11-09T04:58:01.913

> 我在这里创建了我的包装器，希望对您有很大帮助，[点击这里](https://stackoverflow.com/a/51833809/7346931)您可以根据您的要求进行修改

# c# - 将 Rtf 转换为 HTML

> ID：439301
> 
> 赞同：49
> 
> 时间：2009-01-13T15:16:40.267
> 
> 标签：c#, html, rtf

我们有一个水晶报告，我们需要以电子邮件的形式发送出去，但是从水晶报告生成的 HTML 非常丑陋，并且会导致一些电子邮件客户端出现问题。如果可能的话，我想将其导出为富文本并将其转换为 HTML。

有什么建议么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-12T13:41:32.113

我会在 CodeProject RTFConverter 上查看这个工具。这个人对程序如何工作以及转换的细节进行了很好的分解。

[编写自己的 RTF 转换器](http://www.codeproject.com/KB/recipes/RtfConverter.aspx "编写自己的 RTF 转换器")

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T17:21:39.640

Mike Stall 在这里发布了他用 c# 编写的代码：

[http://blogs.msdn.com/jmstall/archive/2006/10/20/rtf_5F00_html.aspx](http://blogs.msdn.com/jmstall/archive/2006/10/20/rtf_5F00_html.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-04-28T18:32:34.487

在 MSDN 代码示例库中还有一个示例，称为[在 RTF 和 HTML 之间](http://matthewmanela.com/blog/converting-rtf-to-html/)转换，它允许您在 HTML、RTF 和 XAML 之间进行转换。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-07-15T00:44:16.500

## **更新：**

我回到家并尝试了以下代码，但它不起作用。对于任何想知道的人，剪贴板不只是像我希望的那样神奇地转换东西。相反，它允许应用程序以各种粘贴格式“上传”数据对象，然后粘贴（在我的比喻中是“下载”）程序被粘贴到指定其首选格式。我个人最终使用了之前推荐过的[这段代码](https://code.msdn.microsoft.com/windowsdesktop/Converting-between-RTF-and-aaa02a6e#content)，它非常易于使用且非常有效。导入代码（在 VStudio 中，项目 -> 添加现有文件）后，您只需像这样将 html 转到 rtf：

```
return HtmlToRtfConverter.ConvertHtmlToRtf(myRtfString); 
```

或相反的方向：

```
return RtfToHtmlConverter.ConvertHtmlToRtf(myHtmlString); 
```

## （以下是我之前的错误答案，以防有人对这个答案的年表感兴趣哈哈）

大多数（如果不是全部）上述答案都为手头的问题提供了全面的、通常基于库的解决方案。我远离我的电脑，因此无法测试这个想法，但一种替代的、廉价的、模糊的 hack-y 方法如下。

```
private string HTMLFromRtf(string rtfString)
{
            Clipboard.SetData(DataFormats.Rtf, rtfString);
            return Clipboard.GetData(DataFormats.Html);         
} 
```

同样，不完全确定这是否可行，但只是在我的 iPhone 上弄乱一些 html 我怀疑它会。文档在[这里](https://msdn.microsoft.com/en-us/library/system.windows.forms.clipboard.getdata.aspx)。更深入的解释/文档 RE 可以在[此处](https://msdn.microsoft.com/en-us/library/ms682177(VS.85).aspx)找到剪贴板中数据模型的获取和设置。

*（是的，我完全知道我多年后才来到这里，但我认为这个问题仍然是一些人想要回答的问题）。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T16:13:58.467

如果您不介意自己动手​​，编写一个 RTF 到 HTML 转换器并不难。

编写一个通用的 RTF->HTML 转换器会有些复杂，因为您需要处理数百个 RTF 动词。但是，在您的情况下，您只处理 Crystal Reports 专门使用的那些动词。我敢打赌，Crystal 生成的标准 RTF 编码不会因报告而异。

我用 C++ 编写了一个 RTF 到 HTML 转换器，但它只处理基本格式，如字体、段落对齐等。我的翻译器基本上去除了它不准备处理的任何特殊格式。它花了大约 400 行 C++。它基本上扫描文本中的 RTF 标记并用等效的 HTML 标记替换它们。不在我列表中的 RTF 标签会被简单地删除。编写这样的转换器时，正则表达式函数非常有用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-13T15:23:36.913

我认为您可以使用 .NET 办公可编程性支持和 Visual Studio 办公工具将其加载到 Word 文档对象中。

然后使用文档实例重新保存为 HTML 文档。

我不知道怎么做，但我相信在没有任何第三方库的情况下完全在 .NET 中是可能的。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-01-13T15:18:52.167

我不知道有任何库可以做到这一点（但我相信有很多库可以）但是如果您已经可以从水晶报告创建 HTML，为什么不使用 XSLT 来清理标记呢？

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-01-13T15:26:15.083

您可以尝试将其上传到谷歌文档，并将其下载为 HTML。

# c# - 允许方法在 Java 中锁定其父对象

> ID：439302
> 
> 赞同：4
> 
> 时间：2009-01-13T15:16:43.963
> 
> 标签：c#, java, cross-language, code-translation

Java中有没有办法获得一种方法来锁定（互斥）它所在的对象？

我知道这听起来令人困惑，但基本上我不想与这个 C# 片段等效，而是在 Java 中。

```
lock(this)
{
    // Some code here...
} 
```

我的任务是将 .Net 编写的 API 重新实现到 Java 中，并且我被要求尽可能地保持 Java 版本与 .Net 版本相似。.Net 版本看起来像是从我无法访问的 C++ 版本转录的事实，这无济于事。

无论如何，上面的行出现在 C# 版本中，我需要在 Java 中做同样的事情。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T15:19:38.107

相当于：

```
synchronized (this)
{
} 
```

（不，您通常不应该在 C# 或 Java 中执行此操作。更喜欢锁定没有其他人可以访问的私有引用。当然，您可能已经意识到这一点 - 但我不想留下答案没有警告:)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T15:21:34.937

假设 C++ 代码是一个简单的互斥锁，将“lock”替换为“synchronized”

```
synchronized (this)
{
// ...
} 
```

这是[Java并发教程](http://java.sun.com/docs/books/tutorial/essential/concurrency/) 以获取更多信息

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T15:38:26.337

我推荐 Brian Goetz 的“ [Java Concurrency In Practice](http://jcip.net/) ”。这是一本很棒的书。

保持同步块尽可能小可能是一件好事。在方法上使用同步修饰符是粗粒度的，有时是必要的，但否则您可以使用另一个对象来执行此操作，以保持块更小。

像这样：

```
public class PrivateLock {
    private final Object myLock = new Object();
    @GuardedBy("myLock") Widget widget;

    void someMethod() {
        synchronized (myLock) {
            // Access or modify the state of widget
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T15:44:44.967

您还应该查看 API (JDK 5.0+) 的 java.util.concurrent 包以获取其他并发管理对象，例如信号量、交换器等

[http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/package-summary.html](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/package-summary.html)

# asp.net-mvc - ASP.NET Web 架构设计 - 第 2 部分

> ID：439307
> 
> 赞同：2
> 
> 时间：2009-01-13T15:18:03.367
> 
> 标签：asp.net-mvc

实际上，我已经在[这篇文章](https://stackoverflow.com/questions/406279/asp-net-web-architecture-design)中询问过这个问题，尽管我们已经回到绘图板上，发现它比我们最初想象的要困难得多。我们开发了一个大型（并且非常依赖）Intranet 系统，该系统多年来发展迅猛。

问题是它使用框架在左侧有一个菜单，在顶部有一个标题，然后是主页。这样做是为了确保其他元素是静态的，而您可以滚动页面。现在我们想出了一个解决方案来使用单个页面和 CSS 来实现这一点，但问题在于我们 Web 应用程序的实际架构。

我们希望转向 MVC 架构以使我们的页面更​​加安全和易于管理，但是这样做存在一个主要问题。我们内联网系统的每个部分都有到其他部分中其他页面的交叉链接。因此，例如，假设我们有一个名为“游戏”的部分，其中我们有一个名为“玩游戏的人”的部分，但这实际上只是使用一个框架来指向一个页面，该页面位于我们的 Intranet 系统上的另一个文件夹中，名为“人事”然后是“People.aspx”（一个纯粹的例子）。MVC 架构将如何处理这样的事情？

我们的页面显示在我们内联网的完全不同的区域，实际上它们是同一个页面。因此，拥有像[http://mysite/section/category/page](http://mysite/section/category/page)这样的 URL必须链接到[http://mysite/anothersection/differentcategory/page](http://mysite/anothersection/differentcategory/page)。

希望这对具有 MVC 架构以及过时架构（例如我们正在使用的框架）经验的人有意义。

提出的问题是：

*   我们必须有重复的页面吗？
*   有没有办法使用 MVC 交叉引用不同部分的页面？
*   对于由大约 400 个不同页面组成的 Intranet 系统，MVC 是要走的路吗？

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:26:05.363

*   你不应该这样做，就像复杂类型背后的想法一样。您可以将最小视图放入完整的视图中以分离重复。
*   您可以使用 Html.ActionLink 创建指向页面的链接，并且可以使用 Html.RenderPartial 或 Html.RenderAction 将整个操作呈现到您的页面中。
*   当然。就像我说的那样，您可以将重复分解为小组件，并在需要时包含它们。

例如...

我正在为朋友开发一个小型店面应用程序，我发现自己正在创建一个用于添加和编辑产品的视图。问题是——我对字段使用相同的布局。所以我创建了一个 MVC 用户控件并放入字段中并做了类似的事情。

对于添加..

```
<asp:Content ID="DefaultContent" ContentPlaceHolderID="DefaultContentPlaceHolder" runat="server">
<% Html.BeginForm<CatalogController>(c => c.AddProduct(null), FormMethod.Post); %>
<% Html.RenderPartial("ProductFields", ViewData); %>
<%= Html.SubmitButton("Submit", "Add") %>
<% Html.EndForm(); %>
</asp:Content> 
```

而对于编辑...

```
<asp:Content ID="DefaultContent" ContentPlaceHolderID="DefaultContentPlaceHolder" runat="server">
<% Html.BeginForm<CatalogController>(c => c.EditProduct((Product)null), FormMethod.Post); %>
<% Html.RenderPartial("ProductFields", ViewData); %>
<%= Html.Hidden("Product.ID", ViewData.Model.ID) %>
<%= Html.SubmitButton("Submit", "Save") %>
<% Html.EndForm(); %>
</asp:Content> 
```

ProductFields 部分看起来像这样

```
<% Product product = ViewData.Model; %>
<% IEnumerable<Category> categories = ViewData["Categories"] as IEnumerable<Category>; %>
<table>
    <tr>
        <td><%= Html.Label("Product.Name", "Name") %></td>
        <td><%= Html.TextBox("Product.Name", product.Name) %></td>
    </tr>
    <tr>
        <td><%= Html.Label("Product.Price", "Price") %></td>
        <td><%= Html.TextBox("Product.Price", product.Price) %></td>
    </tr>
    <tr>
        <td><%= Html.Label("Product.Description", "Description") %></td>
        <td><%= Html.TextBox("Product.Description", product.Description) %></td>
    </tr>
    <tr>
        <td><%= Html.Label("Product.IsActive", "Is active") %></td>
        <td><%= Html.CheckBox("Product.IsActive", product.IsActive) %></td>
    </tr>
    <tr>
        <td><%= Html.Label("Product.IsFeatured", "Is featured") %></td>
        <td><%= Html.CheckBox("Product.IsFeatured", product.IsFeatured.HasValue ? product.IsFeatured.Value : false) %></td>
    </tr>
    <tr>
        <td><%= Html.Label("Product.CategoryID", "Category") %></td>
        <td><%= Html.DropDownList("Product.CategoryID", new SelectList(categories, "ID", "Name")) %></td>
    </tr>
</table> 
```

因此，如您所见，您可以根据需要轻松分解页面，并使用 ASP.NET MVC 轻松地包含它们并将数据传递给它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:25:27.613

Kezzer - 您确定要采用现有的（并且我认为是有效的）系统并完全重写它只是为了 MVC 的所谓好处吗？我知道这并不能完全回答你的问题，但我会认真考虑 MVC 架构是否真的会让你的客户比 Webforms 架构更快乐——尤其是因为他们永远不会真正注意到。

以某种相关的方式，看看乔尔关于[建筑宇航员](http://www.joelonsoftware.com/items/2008/05/01.html)的文章。它不是针对您的问题，但它确实解决了我们在研究新技术时有时会得到的不切实际的期望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:43:39.697

我将回答您关于 MVC 的问题的第三部分：

MVC 作为一个团队更容易工作。它在设计师/程序员串联中特别有效，因为设计师可以从事他/她所知道的工作，而程序员可以从事他所知道的工作（让我们面对现实，她的程序员很少），而不是在同一个空间工作（.aspx 页面）设计人员可以在 .aspx 视图空间中工作，而程序员可以在 .cs 控制器空间中工作。

多次使用一页还有一个额外的好处。使用几个不同的 ActionName 并通过部分页面和 ViewData 变量进行一些配置，您可以一遍又一遍地使用一个页面来覆盖几乎所有用例。我发现很难用 WebForms 进行类似的配置。

您在 MVC 中拥有的路由控件非常强大，并且通过智能控制器和视图设计，您最终可以将 400 页的 Intranet 归结为 80 页的 20 个左右的控制器。我正在重建一个类似 ESPN 的 Intranet 站点，该站点是在具有近 200 个页面的 WebForms 上完成的，它完全适合 8 个控制器和 50 个视图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:23:21.433

*   我们必须有重复的页面吗？

不。

*   有没有办法使用 MVC 交叉引用不同部分的页面？

是的。

*   对于由大约 400 个不同页面组成的 Intranet 系统，MVC 是要走的路吗？

正如[theBadDawg 所](https://stackoverflow.com/questions/439307/asp-net-web-architecture-design-part-2#439437)提到的，只要您可以将这 400 个页面分类为具有共同点的页面组，这是可行的。根据您的**类别**和**部分**，听起来像是对页面进行了逻辑分组。

# wcf - 希望我的 WCF 服务在管理员帐户下运行

> ID：439309
> 
> 赞同：0
> 
> 时间：2009-01-13T15:18:23.320
> 
> 标签：wcf, impersonation

如何配置我的 WCF 服务以在管理员帐户下运行？（这不是用于生产，仅用于测试）。

它只是一个 web.config 调整吗？

IIS 7 托管 WCF 服务。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:52:39.320

在 IIS 7 下确保服务在配置为在所需用户下运行的应用程序池下运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T15:23:04.917

如果您将其作为 ASP.NET 服务托管，则应以管理员帐户运行 IIS 进程。如果您将其托管在 Windows 服务下，则应将其配置为以管理员身份运行。

# c# - 在 C# 中，大写和小写字符串/字符串有什么区别？

> ID：439322
> 
> 赞同：27
> 
> 时间：2009-01-13T15:20:41.350
> 
> 标签：c#, string, difference

新手，在C#中，大写和小写字符串/字符串有什么区别？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-13T15:30:06.980

字符串比字符串使用更多的像素。所以，在一个黑暗的房间里，如果你的代码要用明暗字体阅读，它会投射更多的光。决定使用哪个可能很棘手 - 这取决于照明像素的价格，以及您的读者是否想要投射更多或更少的光。但是 c# 为您提供了选择，这就是为什么它是全方位的最佳语言。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-13T15:23:42.157

什么都没有 - 两者都指`System.String`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T15:23:55.477

“String”是底层 CLR 数据类型（类），而“string”是 String 的 C# 别名（关键字）。它们是同义词。有些人在调用像 String.Format() 这样的静态方法时更喜欢使用 String 而不是 string.Format() 但它们是相同的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T15:24:44.430

String 是 System.String 的简短版本，它是所有 .Net 语言使用的通用类型系统 (CTS) 类型。string 是同一事物的 C# 缩写...

喜欢

*   System.Int32 和 int
*   System.Int16 和短，

等等

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T15:33:15.927

C# 中“String”类型的对象是“System.String”类型的对象，如果您使用“using System”指令，编译器会以这种方式绑定它，如下所示：... 字符串 s = "嗨"; Console.WriteLine(s); 如果您要删除“使用系统”语句，我必须更明确地编写代码，如下所示： System.String s = "Hi"; System.Console.WriteLine(s); 另一方面，如果在 C# 中使用“string”类型，则可以跳过“using System”指令和命名空间前缀：string s = "Hi"; System.Console.WriteLine(s); 这工作的原因以及 C# 中的“object”、“int”等都工作的原因是因为它们是底层 .NET Framework 类型的特定于语言的别名。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T15:23:52.390

没有不同。字符串只是字符串的同义词。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T15:25:32.230

string 是 .NET Framework 中 String 的别名。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T15:25:36.643

String 是来自 .NET core (CLR) 的类型。

string 是 C# 类型，在编译的 IL 中被翻译为 String。

语言类型被转换为 CLR 类型。

# java - C++ .NET 等效于 java public static void main()？

> ID：439323
> 
> 赞同：2
> 
> 时间：2009-01-13T15:21:19.507
> 
> 标签：java, .net, c++, equivalent

在java中，我可以简单地直接测试类

```
public static void main() 
```

然后我只需添加快速代码并在 Eclipse 下“运行”该类。C++ .NET 中有类似的东西吗？

现在我必须创建一个空项目，引用正确的标题，然后将该项目设置为启动项目。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:26:53.083

[单元测试](http://en.wikipedia.org/wiki/Unit_testing)。如果您使用的是 VS ，还有[对象测试台。](http://msdn.microsoft.com/en-us/library/c3775d98(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:34:17.407

我对 Eclipse 不是很熟悉，但如果您只是想在 IDE 中运行您的对象，请执行以下操作。

打开立即窗口，然后调用你想要的任何函数。这将开始执行您键入的代码。您可能必须限定名称。例如：ClassLibrary1.MyClass.SomeMethod()

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T15:57:11.293

我喜欢为此使用[TestDriven.NET 。](http://www.testdriven.net/default.aspx)它允许您通过右键单击标题并选择“运行测试”来执行任何公共方法。

我喜欢制作

```
public static void Test() 
```

与此功能一起使用的对话框和表单类的方法。

它支持 C++/CLI，所以如果这就是 C++.NET 的意思，它应该适合你。

**编辑：**你应该只对不能自动测试的东西这样做——比如纯 GUI 类。否则我同意其他评论者：使用单元测试框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T15:27:40.213

我在 C# 中执行此操作，所以我不知道这是否会有不同的反应，但我使用 main 方法设置了一个空的“测试”类，然后将项目设置为使用该类文件启动。您不必在单独的项目中创建文件。

# oracle - TOAD“凭据检索失败”错误

> ID：439326
> 
> 赞同：1
> 
> 时间：2009-01-13T15:22:06.667
> 
> 标签：oracle, toad

半定期使用 TOAD 时，我会尝试连接到数据库并收到错误“ORA-12638 凭据检索失败”。我必须重新启动我的 TOAD 才能克服这个问题。如果我有其他连接处于活动状态，那会很痛苦。有谁知道如何避免或解决这个错误？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T03:20:23.190

1) 转到 /oracle home/network/admin 并打开 sqlnet.ora

2) 搜索 SQLNET.AUTHENTICATION_SERVICES= (NTS) 并将其更改为 SQLNET.AUTHENTICATION_SERVICES= (NONE)

# c# - Windows 服务配置文件 C#

> ID：439334
> 
> 赞同：31
> 
> 时间：2009-01-13T15:23:38.660
> 
> 标签：c#, configuration

我使用 Visual Studio 2008 / C# 开发了一个 Windows 服务应用程序。

我在项目中有一个 app.config 文件。安装后，app.exe.config 文件出现在可执行文件旁边，但当我尝试通过 ConfigurationManager.AppSettings 访问它们时，它似乎没有从中读取值。

它是否将配置文件复制到其他地方，或者还有其他我不知道的问题？

提前致谢，

马丁。

编辑：配置文件名实际上是 my_exe_file_name.exe.config，它看起来像：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <appSettings>

    <add key="RuntimeFrequency" value="3" />

  </appSettings>
</configuration> 
```

我正在尝试通过以下方式阅读：

```
ConfigurationManager.AppSettings["RuntimeFrequency"] 
```

我不断看到的调试值是“1”而不是“3”。我在这里做错了吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-14T10:26:12.443

我找到了错误，它与文件权限有关。安装服务后，我的本地用户帐户无权修改 app.exe.config 文件。

我用来编辑的工具没有通知我它被拒绝访问以保存文件 - 如果有人感兴趣，那就是记事本++ - 所以我看不出它没有保存旧的配置文件。

现在解决了，谢谢大家。

马丁。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T18:10:55.907

当您处于调试模式时，请检查 my_exe_file_name.vshost.exe.config 中的设置并确保在 app.config 文件中进行调整。Visual Studio 应该更新 bin/debug 文件夹中的最终配置文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T15:43:40.523

也许您正在更新错误的配置文件。你应该仔细检查使用

```
System.Configuration.ConfigurationManager.OpenExeConfiguration(PATH_TO_CONFIG); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T18:03:15.453

通常对于我编写的 Windows 服务，我将 appName.exe.config 文件放入 C:\WINDOWS\system32\

也许你在那个目录中有一个旧版本，这是你的服务获得价值的地方，即使你已经更新了项目中的配置文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T15:25:47.550

App.config 文件应重命名为 your_exe_file_name.exe.config 并放在 exe 文件附近。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T16:03:40.390

您是否有可能定义了多个 RuntimeFrequency 条目的实例？ConfigurationManager 从上到下读取文件并单独处理每个设置。因此，文件中定义的 RuntimeFrequency 的最后一个值就是它将使用的值。

如果您想确定是否正在使用您的文件，我会简单地删除或注释掉 RuntimeFrequency 的任何定义（确实会发生复制/粘贴错误）并等待在 ConfigurationManager 尝试引用 AppSettings 中的条目时看到应用程序错误不存在。

# mod-perl - 如何使 CGI::Application::Dispatch 与 mod_perl 一起工作？

> ID：439343
> 
> 赞同：2
> 
> 时间：2009-01-13T15:25:07.113
> 
> 标签：mod-perl

好的，所以我正在尝试使用 mod_perl 设置 Dispatcher，但我真的不知道我做错了什么。我相当肯定问题出在我的 mod_perl 配置上。以下是我认为相关的内容：

**Apache 目录配置**

```
<Directory  "C:/Documents and Settings/frew/My Documents/acd">
   SetHandler perl-script
   PerlHandler ACD::Dispatch
    Options Indexes FollowSymLinks ExecCGI
    AllowOverride None
    Order allow,deny
    Allow from all
    DirectoryIndex Default.html
</Directory> 
```

**注意**： ACD::Dispatch 在 acd/ACD 中。

**ACD::调度**

```
package ACD::Dispatch;
use base 'CGI::Application::Dispatch';
sub dispatch_args {
    return {
        prefix  => 'ACD',
        table   => [
        ''                => { app => 'Controller', rm => 'awesome' },
        ':app/:rm'        => { },
        ],
    };
} 
```

可能最重要的是，**Apache 错误：**

```
[Mon Jan 12 17:42:08 2009] [error] [client 10.6.1.73] failed to resolve handler `ACD::Dispatch': Can't locate ACD/Dispatch.pm in @INC (@INC contains: C:/usr/site/lib C:/usr/lib . C:/Program Files/Apache Software Foundation/Apache2.2) at (eval 3) line 3.\n 
```

谢谢你的帮助！

**更新**：我需要将此添加到我的 Apache 配置中：

```
<Perl>
   use lib '/path/to/acd';
</Perl> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T15:45:54.357

好吧，根据错误消息：

> ACD::Dispatch：无法在 @INC 中找到 ACD/Dispatch.pm（@INC 包含：C:/usr/site/lib C:/usr/lib。C:/Program Files/Apache Software Foundation/Apache2.2

你说的事实：

> ACD::Dispatch 位于 acd/ACD 中。

看起来您需要使用其绝对路径名将“acd”目录放在@INC 路径中。

虽然你可能会想'。在@INC 上，那应该是你的`acd`目录，我不认为它是，在 mod_perl 下。例如，参见[这个讨论](http://www.justskins.com/forums/mod_perl-use-lib-and-stuff-84152.html)。

# javascript - JavaScript - 获取真实图像宽度和高度的函数（跨浏览器）

> ID：439358
> 
> 赞同：-4
> 
> 时间：2009-01-13T15:26:25.410
> 
> 标签：javascript, image, height, width

如何通过 JavaScript 函数获取真实的图像宽度和高度（跨浏览器）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T15:43:00.587

首先，如果您只是以更礼貌的方式提出问题并提供尽可能多的相关信息，您就有更大的机会得到回答。

反正...

据我所知，您几乎可以在所有浏览器中使用该**`.width`属性：**

```
function getDimensions(id) {
    var element = document.getElementById(id);
    if (element && element.tagName.toLowerCase() == 'img') {
        return {
            width: element.width,
            height: element.height
        };
    }
}

<img id="myimage" src="foo.jpg" alt="" />

// using the function on the above image:
var dims = getDimensions('myimage');
alert(dims.width); --> shows width
alert(dims.height); --> shows height 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-01-31T05:38:32.610

```
var realWidth = $("#image").attr("naturalWidth");
var realHeight = $("#image").attr("naturalHeight"); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T15:30:25.497

耶，[谷歌](http://www.google.co.uk/search?q=javascript+image+width+height)！

有几种方法可以做到这一点，具体取决于您所需要的（您无济于事地省略了包括在内）。在一般意义上，最简单的可能是获取对 Image 对象的引用并检查`width`and`height`属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T15:30:51.050

jQuery + `<img src="" ... id="hello" />`+`$("#hello").width()`

# vb.net - 长度不能为零 vb.net

> ID：439382
> 
> 赞同：1
> 
> 时间：2009-01-13T15:31:57.023
> 
> 标签：vb.net

嗨，在我收到错误消息之前是否可以检测字节的长度：

长度不能小于零。参数名称：长度

我在这一行得到错误：

new_username = new_username.Substring(0, new_username.IndexOf("加入"))

我正在从我得到的字符串中删除“加入”......我怎么能忽略它是“加入”不是数据？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:37:29.757

在此上下文中使用它之前，我将测试以查看 IndexOf 返回的内容：

```
if(new_username.IndexOf(" Joined") > 0)
{
      new_username = new_username.Substring(0, new_username.IndexOf(" Joined "))
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:34:54.363

试试这个：

```
new_username = new_Username.Replace(" Joined ", "") 
```

请注意，这将删除*所有*出现的“ `Joined`”子字符串，而不仅仅是第一个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:35:12.960

看起来`new_username.IndexOf(" Joined ")`返回 -1 表示字符串“Joined”未找到`Substring`。我会将其分解为两个陈述：

您看到的错误是您正在有效地进行此调用：

```
new_username = new_username.Substring(0, -1) 
```

# shell - Shell 脚本用户提示/输入

> ID：439390
> 
> 赞同：7
> 
> 时间：2009-01-13T15:33:47.300
> 
> 标签：shell, input, variables, ksh, prompt

这是其他人编写的粗略的 korn shell 脚本。我对使用 shell 语法知之甚少，我什至不确定这是否可能。

有什么方法可以让我运行这个文件并提示输入日期，这样我就不必每次都手动进入脚本并更改它？

例如，我想用从用户提示中获取的变量替换“1/12/09”。

```
#!/bin/ksh
./clear_old
./rooms_xls.pl 1/12/09
cd doors
./doors_xls.pl 1/12/09 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-13T16:11:57.613

如果您想得到提示（而不是将日期作为参数传递），请使用以下逻辑（或类似的东西）：

```
date=
while [ -z $date ]
do
    echo -n 'Date? '
    read date
done 
```

该循环将继续提示输入日期，直到用户输入除简单 RETURN 之外的其他内容（任何内容）。

如果您想添加一些简单的验证，并且您使用的是 KSH93 或更高版本的 KSH，请执行以下操作：

```
date=
while [ -z $date ]
do
    echo -n 'Date? '
    read date
    if [[ $date =~ ^[0-9]{1,2}/[0-9]{1,2}/[0-9]{1,4}$ ]]
    then
        break
    fi
    date=
done 
```

有关更多信息，请参见[ksh93 手册页](http://docs.oracle.com/cd/E23824_01/html/821-1461/ksh93-1.html#scrolltoc)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T15:40:10.890

一般来说，可以从 shell 脚本中访问命令行参数，如下所示：

```
$0, $1, ... $N 
```

所以你可以像这样替换硬编码的日期：

```
./room_xls.pl $1 
```

像这样运行它

```
./myscript 1/12/09 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T15:38:25.697

$1 是第一个命令行参数。这高达 9 美元。查看本[教程](http://www.bolthole.com/solaris/ksh-var2.html)了解更多基本的 ksh 语法。

# subsonic - 为什么 BuildProvider 只能用于 ASP.NET 网站项目？

> ID：439393
> 
> 赞同：1
> 
> 时间：2009-01-13T15:34:50.353
> 
> 标签：subsonic, buildprovider

我打算尝试[Subsonic](http://subsonicproject.com/)，您可以在 ASP.NET 网站项目中使用 buildProvider 元素生成 DAL。但我很好奇为什么 Web 应用程序或 Windows 应用程序不支持[BuildProvider](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)。

PS：我知道对于 Subsonic，除了 BuildProvider 之外还有另一种选择，但我只是好奇。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T17:55:52.363

它不起作用，因为 Web 应用程序项目与网站项目中的编译方式不同。根据我在 MSDN 上阅读的内容，这与以下事实有关：在 Web 应用程序项目中，您的所有代码文件在部署之前都使用 MSBuild 编译为单个程序集，但 Build Providers 用于生成在运行时编译的代码（来自您的 App_Code 文件夹）。

在网站项目中，您的所有代码都是在运行时编译的，因此它们可以很好地协同工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-04T10:37:09.803

您可以将它挂接到您的预构建事件中，并使用正确的命令行调用 sonic.exe。

# mud - 有没有人有任何有用的资源可以分享或提供开发 MUD 的提示？

> ID：439400
> 
> 赞同：10
> 
> 时间：2009-01-13T15:35:47.980
> 
> 标签：mud

作为一个爱好项目，我正在尝试创建一个 ROM（基于 Diku-Merc）的衍生产品。（现已不复存在）如果有人做过类似的事情并有一些有用的资源可以分享或提供提示，我将不胜感激。我发现很多资源（例如邮件列表）不再有效，并且许多链接已失效。

我选择了 ROM，因为这是我作为玩家所熟悉的，但源代码比我遇到的任何东西都复杂，我不介意选择更容易理解的代码库。在我认真潜水之前的任何建议也将不胜感激。

[至于一般的泥泞社区，除了泥泞连接器](http://www.mudconnect.com/)之外，我知道的不多，因为我一直扮演的用户/玩家角色多于开发人员。我最看重的是一个可以让我得到问题答案的宽容和积极的地方。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T02:11:36.217

经过广泛的研究，我决定使用 [tba](http://www.tbamud.com/)代码库。我稍后可能会详细说明，但范围很广

*   编码经验比作为玩家的经验更重要，这让我放弃了自己的根。我想要一个有据可查、相当现代、可管理的代码库，正在积极开发中，这似乎符合要求。

无论如何，泥浆确实是一种爱的劳动，如果你打算运行一个，你必须松开一些螺丝。此外，辉煌的日子已经过去（似乎有很多泥浆在 2000 年左右集体关闭），在我看来，社区基本上不活跃且支离破碎。一些 tba 文档的摘录很好地总结了这一点：

> 那么，您确定要运行自己的 MUD 吗？如果您已经是玩 MUD 的老手，并且您决定要开始自己的一个，这里是我们的建议：继续努力，先尝试其他几个 MUD。逐步晋升到管理员职位，看看运行 MUD 的真正意义。这不是所有的乐趣和游戏。你实际上必须与人打交道，你必须照顾球员，并且不断地唠叨你需要做或改变的事情。如果你做得好，运行 MUD 会非常耗时，如果你不会做得好，那就不要打扰。只玩 MUD 就够自虐了，不是吗？或者你是否想从你的 GPA 中减少额外的分数，在你的下一份工作评估中跳下最后一个档次，还是永远摆脱那个讨厌的重要人物？如果您认为像结交朋友和看到日光这样愚蠢的分心事物会阻止您在 MUD 世界中充分发挥自己的潜力，那么成为 MUD 管理员就是您的工作。

无论如何，我对成功不抱太大希望，但这是我会觉得有趣的事情，改进我的代码，让我在未来的很多年里都很忙：D

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-01-21T09:21:31.453

没有活跃的 ROM 开发者邮件列表，所以 tba 绝对是更好的选择。使用 RAM 项目清理 ROM 有一些努力。

Dead Souls 也看到了积极的发展（主要开发人员在我眼中是英雄，因为他制作的工作量很大）。

我不推荐 MUCK，因为用户群很小。然而，这并不是说没有做好工作——在 wora.netlosers.com 论坛的代码子论坛上查找用户 Valente，因为他可能是目前最重要的 MUCK 开发人员之一。

但是，如果您认为 ROM 很复杂，我应该提醒您不要出于任何目的处理已建立的/规范代码库，而不是熟悉泥服务器。对于实际开发，您可能最好使用诸如 NakedMUD (C/Python) 之类的准系统代码库，或者甚至比诸如 Socketmud（多种语言的端口）之类的更精简的代码库。

当然有几十个泥服务器你可以看看；一切都会以某种方式具有教育意义，但在开始阶段，什么是好的做法，什么不是好的做法并不明显。您可能想查找 ColdC（类似于 LP）和 TeensyMUD（Ruby）来学习。Teensy 的作者 Jon Lambert 在[http://sourcery.dyndns.org/](http://sourcery.dyndns.org/)上有一个有用的开发者网站。

但是，您会在 MudBytes 找到非常有经验的 ROM 和 tba（即，Circle）开发人员，并且我会第二次告诉 Sam，这是目前最活跃的泥开发人员站点。这有点令人惊讶，但去年 MB 的活动显着增长。我认为人们正在从折叠中进来，可以这么说并聚集在 MB。MB 也有一个大型代码存储库。

您的其他选择是您已经知道的 Mudconnector、Top Mud Sites，其中大多数开发人员（通常是已建立和长期运行的泥浆）人群较少，以及 Mudlab，它更安静但通常具有良好的信噪比. MudGamers 是一个有趣的新网站，拥有一个相当安静的论坛，但却是一种创建更具现代感的泥浆游戏门户的新方法。

不容忽视的是旧的 mud-dev 邮件列表的存档。那里有大量的信息需要收集。原始档案可以在 muddev.wishes.net/ 找到。Richard Tew 在梳理旧的 usenet 档案以找到有价值的泥浆开发相关线程方面也做了一些高尚的工作，您可以通过他在posted-stuff.blogspot.com/search/label/mud 上的泥标签找到这些内容。

我应该注意到，许多泥浆使用 IMC 聊天网络来链接泥浆（MB 在其网站的首页上也有一个通往此的门户）。一旦你的泥运行了，如果你需要实时聊天来解决问题，那么上 IMC 会很有用（当然，有很多 IMC 频道，你会想要谨慎选择使用哪一个） .

尽管今天的泥浆充其量只是利基市场，最坏的情况是闻所未闻，但开发中并不缺乏新的泥浆。它们提供的设计和编程挑战仍然可供独立开发者使用，这与任何同等大小或复杂性的图形游戏不同。

此外，如果您感觉自己永远不会发布可玩的游戏，您也不应该气馁。像许多大型项目一样，您可能会多次开始和放弃它，但您将在广泛的编程技能和应用程序方面建立熟练程度——没有多少项目允许您采用这样一个完整的系统方法。祝你好运！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T15:40:23.510

Dead Souls MUDlib 似乎有一个活跃的社区

[http://en.wikipedia.org/wiki/Dead_Souls_MUDlib](http://en.wikipedia.org/wiki/Dead_Souls_MUDlib)

我是 Nightmare LPMud 的老玩家，遗憾地消失了。我对这些 MUD 的编码不太感兴趣，但我一直在松散地关注这个社区，只是因为有这么多积极的 MUD 记忆。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T15:42:15.237

看看[无名渣](http://nmc.limitless.org/)。这是一个可靠的软件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T15:40:18.223

首先专注于获取或找到一个可靠的 Telnet Socket 库，这通常是 MUD 的主要协议。

接下来，创建要实现的功能的完整列表，您可能应该获得某种功能或错误跟踪系统设置（即使它是电子表格）。然后根据其他系统的依赖关系对功能进行优先级排序。

查看[http://www.gamasutra.com](http://www.gamasutra.com)，了解有关创建游戏、创建基本 AI、角色系统和多人游戏的一些架构讨论。

一旦你理解了这个理论，构建你想要支持的所有东西只是一个编程的对接负载。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T15:43:44.017

我会让 MUD 引擎足够抽象，以便在终端客户端、基于 Web 的 Ajax 客户端以及可能的独立客户端之后运行 - 即，不要将前端与实际游戏逻辑联系起来。我并不反对 MUD 实际上使用体面的字体作为文本和真实的图形（作为插页式广告或在公告板上做笔记看起来像笔记等），而不是代替基于文本的界面） ASCII等

您可能还希望将一些 MUD 脚本文件转换器转换为您自己的格式，这样您就不必花费很长时间来创建区域。

我发现 MUD 的问题在于过于强调杀死 NPC，而没有太多的谜题或其他有趣的方面。因此，一个更有趣、以故事为导向（可能扩展到单人或单队使用的分片区域）引擎可能是一个不错的功能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-10-21T06:27:43.677

我将借此机会推荐[MudBytes](http://www.mudbytes.net)，这可能是目前可用的最活跃的 MUD 开发者网站。

# c++ - 在 windows 中构建 boost 的子集

> ID：439402
> 
> 赞同：14
> 
> 时间：2009-01-13T15:36:08.853
> 
> 标签：c++, windows, boost, bjam

我正在尝试设置 boost 的一个子集并使用 bjam 正确编译它，但是我没有得到我正在寻找的结果。我正在使用 boost 1.37.0 在 Windows 上工作。

假设我想要构建/安装库 smart_ptr 和文件系统。我故意选择了一个只有头文件的库和一个需要编译库的库。我希望它们被构建到一个类似于我使用 bjam 构建完整的 boost 安装的目录结构中（即没有指定任何 --with-libraryX）但当然没有我不感兴趣的所有库.

我的第一种方法是在 bjam 中使用 --with-filesystem --with-smart_ptr，但它似乎无法识别 smart_ptr（我尝试了 smartptr 和 smart-ptr 但没有成功）。我想这是因为它是一个只有标题的库。

当我删除它并且只有 --with-filesystem 时，它似乎将所有库头文件复制到安装路径，并且只为文件系统构建库。库构建行为是我所希望的，但是我在我的 boost 目录中安装了大量我不感兴趣的库的头文件。

我的第二种方法是使用 bcp 复制相关项目。从某种意义上说，这确实奏效了，因为我只得到了我关心的项目（及其依赖项）。但是，他们没有提供任何生成文件来构建被复制的库。这意味着我需要为所有不仅仅是标题的库设置项目文件并手动构建它们。

所以我的问题基本上是，有没有一种选择性地构建 boost 的方法，它只复制我感兴趣的库的标头，并且只为我感兴趣的非标头库构建库文件（以及它们是 boost 库取决于课程）？

可能有大量基于手动/脚本的解决方案，但如果我可以只使用 bjam 运行某些东西，对我来说会更有用，因为添加新库或升级到新的 boost 版本会非常简单。

编辑：为第一种方法添加了完整的命令行：

```
bjam install --prefix=c:\temp\boostsmall 
   --build-dir=C:\temp\boostsmalltemp --layout=system 
   --with-filesystem variant=debug link=static threading=multi
   runtime-link=static 
```

将 scoped_ptr 更改为 smart_ptr

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T16:04:51.090

解决了。

bcp 解决方案为项目创建了文件，但是我需要将工具目录和 boost 目录的根目录复制到我复制所有库的位置以使它们运行起来。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-06-11T08:12:03.293

好问题！这是我最近设法弄清楚的一个问题，我想。

我已经安装了完整的 Boost 库，包括需要单独编译的库。

我设法使用以下步骤为我正在处理的特定应用程序创建了 Boost 库（正则表达式）的子集：

1.  首先确保首先安装了 bcp 可执行文件。在 Boost 根文件夹中，导航到 tools/bcp 文件夹并在此处运行 bjam.exe。对我来说，这在 [Boost path]\bin.v2\tools\bcp\msvc-10.0\release\link-static 目录中创建了 bcp 可执行文件：

2.  然后创建您希望 Boost 子集驻留的文件夹。这可能已经是您正在处理的 Visual Studio 项目的文件夹。

3.  运行您创建的 bcp exectubale，确保包含您希望包含的库，以及 boost 根目录和目标文件夹的位置。观察所需的 Boost 组件（例如，用于正则表达式）是如何包含在您的目标文件夹中的。

    bcp.exe 正则表达式 --boost="C:\Program Files\boost_1_55_0\boost_1_55_0" C:\Projects\RegexProject\BoostLite

4.  在您的 Visual Studio 项目中，将 Additional Include Directories and Libraries 设置为指向已创建的“Boost lite”文件夹。

5.  最后一件事 - 我认为之前已经描述过 - 我需要转到我的常规 Boost 文件夹设置并复制所需的 stage/lib 文件夹，其中包含子集版本所需的所有 lib 文件并将它们复制到这里，只是一些与正则表达式相关的lib 文件在我的情况下。

我发现这对我有用。任何来自其他人经验的反馈将不胜感激。

可以在此处找到描述相同内容的[博客文章。](http://www.technical-recipes.com/2014/using-subset-boost-in-windows/)

# objective-c - 运行 scan-build 时出现错误“无法发现 'ccc-analyzer'”

> ID：439404
> 
> 赞同：3
> 
> 时间：2009-01-13T15:36:29.853
> 
> 标签：objective-c, debugging, memory-leaks

我正在尝试使用其他线程中建议的 scan-build 工具在我的项目 chibi [-ORM中查找泄漏。](http://code.google.com/p/chibiorm/)

但是从终端运行时：

```
/Users/mamcx/Downloads/checker-0.138/scan-build  -k -V xcodebuild 
```

我明白了：

```
009-01-13 10:33:18.296 xcodebuild[14025:4213] Warning:  Couldn't discover the 'ccc-analyzer' compiler's built-in search paths and preprocessor definitions for language dialect 'objective-c'.  This may lead to indexing issues.
Compiler: /Users/mamcx/Downloads/checker-0.138/ccc-analyzer
Reason:   gcc-4.0: installation problem, cannot exec '/Developer/usr/bin/arm-apple-darwin9-gcc-4.0.1': No such file or directory 
```

但是，我可以从 XCode Ide 很好地构建和调试。这是这个工具的问题还是我这边有问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-26T22:05:24.477

无需更改项目，只需在 xcodebuild 命令中添加 -sdk 标志即可，例如：

```
scan-build -k -V xcodebuild -configuration Debug -sdk iphonesimulator2.0 
```

您可以将 2.0 更改为 2.1、2.2、2.2.1 或 3.0 以匹配您的目标 SDK。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:26:34.213

由于代码签名的原因，构建失败 iPhone 应用程序的修复方法是转到项目的属性并将“Base SDK”设置为“Simulator - iPhone OS 2.1”而不是“Device”</p>

检查你的情况

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T16:51:48.373

我所做的就是创建一个新的构建配置（这是我的调试配置的副本），我称之为 Clang，然后在项目设置中执行以下操作：

1.  将“基础 SDK”设置为“模拟器 - iPhone OS x.xx”
2.  将代码签名身份设置为 - “不要代码签名”

然后，当我运行 scan-build 时，我会：

```
scan-build xcodebuild -configuration Clang
```

（显然，如果您将新构建配置命名为不同的名称，请在此处使用该名称）。

然后一切正常，在我的代码中没有发现任何错误（除了一个误报）:-)

此外，请确保在每次扫描构建之前进行清理：

```
xcodebuild -configuration Clang clean
```

否则 scan-build 不会扫描已经构建的文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T22:42:16.613

确保您可以首先`xcodebuild`在项目的命令行上运行。就我而言，我发现我的项目默认情况下正在执行发布构建，并且正在尝试为设备构建。Xcode 必须添加一些魔法才能使其与证书一起使用，因为我收到了相同的错误消息。

一旦我明确告诉它使用 Debug 配置进行构建，一切都运行良好。因此，您可能必须使用`scan-build xcodebuild -configuration Debug`.

# openssl - 什么是 OpenSSL BIO 对以及如何使用？

> ID：439407
> 
> 赞同：20
> 
> 时间：2009-01-13T15:36:54.360
> 
> 标签：openssl, key-pair

OpenSSL 中的 BIO 对到底是什么，它打算如何使用？我已经检查了 OpenSSL 文档，但任何细节都很少。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T15:43:09.683

OpenSSL 中的 BIO 类似于文件句柄。您使用它们中的一对来安全地相互通信，就像使用两个套接字一样。我找到的最好的解释是[here](https://web.archive.org/web/20130327081616/http://www.ibm.com/developerworks/linux/library/l-openssl/index.html)。

几个月前，当我不得不使用 OpenSSL 编写应用程序时，我也从[Herong Yang 的网站上](http://www.herongyang.com/crypto/)得到了很多使用。在测试我的应用程序时，使用 OpenSSL 和 keytool 创建和签署证书的部分对我有很大帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-08-02T00:55:32.010

BIO 对是绑定在一起的两个源/接收器 BIO。写入其中的任何内容都可以从另一个读取。如果您已经有两个 BIOS，则可以使用 BIO_make_bio_pair 将它们连接在一起。或者您可以使用 BIO_new_bio_pair 创建一个新的 BIO 对。

使用 OpenSSL 的网络安全一书（参见第 111 页）中提到的一种用途是，该对可以绑定到 SSL 引擎。SSL 引擎将读取写入 BIO 对的任何内容。可以读取写入 BIO 对的任何内容。OpenSSL 有一个示例（参见 ssl/ssltest.c）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-08-08T07:41:35.623

[作为关于 OpenSSL BIOs 的一般答案](https://stackoverflow.com/a/51672134/5447906)的一部分，我写过关于 OpenSSL BIO 对的文章：

> “生物” BIO ( `BIO_s_bio`)。它是一个类似管道的 BIO。可以创建一对这样的 BIO。写入该对中的一个 BIO 的数据将被放置以读取该对中的第二个 BIO。反之亦然。它类似于内存 BIO，但内存 BIO 将数据放置到自身，管道 BIO 将数据放置到与之配对的 BIO。

还有[这里](https://stackoverflow.com/q/51632606/5447906)：

> 但此外还有一个 BIO `BIO_s_bio`，它具有类似管道的功能。可以创建一对这样的 BIO。写入对象对中第一个 BIO 的任何数据`BIO_s_bio`都将从该对象对中的第二个 BIO 中读取。反之亦然：将数据写入第二个 BIO 将导致从第一个 BIO 读取此数据。所以`BIO_s_bio`可以用来代替`BIO_s_mem`. `BIO_s_bio`将对象的单个实例传递给`SSL_set_bio`函数就足够了。应用程序接收数据并将其写入该对中的 BIO `BIO_s_bio`。然后，OpenSSL 将从该对中的 BIO 中获取此数据。OpenSSL 将数据写入其 BIO 中，然后应用程序依次从其 BIO 中获取这些数据。

# architecture - 您对类似社区服务器的平台有何看法？

> ID：439417
> 
> 赞同：0
> 
> 时间：2009-01-13T15:38:49.690
> 
> 标签：architecture, social-networking

如果您可以选择一个平台来使用，当您构建一个新的应用程序时，您会更愿意从头开始构建它还是使用像 Community Server 这样的平台？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T15:42:29.713

如果我们专门讨论社区服务器，答案是从头开始定制的。

如果我们笼统地说，它更多地取决于您需要什么以及那里的哪些产品可以提供您想要的功能并且不会驱使您拔掉头发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T15:47:22.013

我和 TheTXI 在这个上。如果您专门谈论 CS，我会说从头开始构建它。但是，还有其他一些开发框架，我拥有并且确实用于特定项目，但是，所有这些框架都有时间和地点，并且确实必须在逐个项目的基础上评估该决定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T15:45:41.970

也许我没有花足够的时间去了解 CS，但在性能方面对我来说就像一条狗 - 非常缓慢，尤其是与一些更受欢迎和免费的产品（如 phpBBS 等）相比。

仍在寻找用于我自己的一些项目的免费、开源、asp.net、论坛软件——它们可能在那里，但我还没有偶然发现我喜欢的一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:59:10.903

潜台词也是一种选择。社区服务器曾经被称为 .TEXT。Subtext 是该项目的变体

# iis - IIS 服务中断：是什么原因造成的？

> ID：439422
> 
> 赞同：0
> 
> 时间：2009-01-13T15:40:15.337
> 
> 标签：iis

我还没有找到一个明确的清单，但希望有人能找到一个，或者我们可以自己想出一个。是什么导致在 IIS 上运行的 .NET 应用程序中断或一般服务中断？例如，web.config 更改将导致 JIT 中的重新编译（而仅部署单个页面不会影响整个应用程序），并且 iisreset 会停止一切（当然，但你知道我要去哪里）。在当前的网络应用程序下创建一个新的虚拟目录怎么样？

了解所有情况会很有帮助，这样您就可以知道是否可以影响对服务器的更改而不会导致整个事情出现问题。

**编辑：**当我问起时，我想到了 IIS 6，但当然，其他版本中任何不同的列表也会对人们有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:45:12.877

这取决于您到底在谈论什么中断。当 IIS 关闭并重新启动时，IISReset 可能会导致服务不可用消息在短时间内显示。

更改 web.config 或将 .dll 文件添加到应用程序的 bin 目录会导致应用程序域的回收，但这并不是完全中断，更多的是响应“延迟”，用户不会看到错误只是来自服务器的延迟响应。您还可以通过更改非 WAP 开发网站上的 App_Code 或 .vb 文件中的任何文件来获得它。

您还可以因不活动而导致 IIS 工作进程关闭，默认设置为 20 分钟。同样，这是延迟，而不是缺乏服务。

# c# - 如何查看我的客户端应用程序发送的 SOAP 数据？

> ID：439430
> 
> 赞同：6
> 
> 时间：2009-01-13T15:42:20.043
> 
> 标签：c#, soap, service

我有一个项目，我在其中使用 wsdl.exe 创建了 Web 服务代理类，然后简单地创建该类的一个实例（继承 System.Web.Services.Protocols.SoapHttpClientProtocol）并调用应该发送 SOAP 消息的方法。如果这很重要，我正在使用 Visual Studio 2008。我正在我的开发机器上尝试这个，而没有访问位于客户内部网内部的实际 Web 服务。因此，发送当然不会成功，我也不会得到任何回复，但我只想看到此解决方案创建并尝试发送的 SOAP 消息的确切内容。我怎么看？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T15:46:04.140

使用[提琴手](http://www.fiddler2.com/fiddler2/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T15:48:10.483

看看来自 eviware.com 的 SOAPUI。

它是一个免费供个人使用的 Java 应用程序。除其他外，您可以将其设置为作为虚拟测试服务器运行。只需加载 hte WSDL 并输入虚拟数据。

在测试服务器模式下，它将记录您的请求，以便您可以查看请求消息中发生的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T15:47:10.283

如果您的 Web 服务是通过明文、非 SSL HTTP 访问的，您可以只使用嗅探器（如[Wireshark](http://www.wireshark.org/)）来查看来自和传入您的应用程序的数据。Wireshark 可以跟踪、过滤和分析有线数据。我已经用它来调试 HTTP 和其他协议很多次了，它是一个很好的工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T15:58:55.610

SOAP 消息只是使用 HTTP POST 方法发送的 XML 数据。因此，例如，您可以在开发机器上安装本地 Web 服务器，配置您的 Web 服务以在该服务器上使用一些虚拟 URI，并使用 WireShark（AKA ethereal）获取网络流量。这种方法的最大优点是它不涉及编码。

或者，您可以使用转储其传入流量的 HTTP 回显服务器，例如[这个](http://www.brothersoft.com/echoserver-161129.html)（在谷歌搜索“http 回显服务器”时找到）：

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T20:32:46.947

您可以使用[tcpMon拦截呼叫](https://tcpmon.dev.java.net/)

# c# - ASP.NET 或 C# 有哪些最佳实践/约定/指南？

> ID：439440
> 
> 赞同：0
> 
> 时间：2009-01-13T15:44:12.643
> 
> 标签：c#, asp.net, .net, vb.net

很久以前，我读了一本关于 C# 和 Visual Basic 最佳实践的好书：

*Francesco Balena、Giuseppe Dimauro*为 Microsoft Visual Basic 和 Visual C# 开发人员提供的实用指南和最佳实践**

 *[![替代文字](https://i.stack.imgur.com/IH7hr.gif)](https://i.stack.imgur.com/IH7hr.gif)
[（来源：[dotnet2themax.com](http://www.dotnet2themax.com/Books/PracticalGuidelines_Cover.gif)）]

这本书在那个年代对我很有帮助，那个年代可以追溯到 ASP.NET 1.1。请列出 ASP.NET、C# 和 Visual Basic 的一些当前最佳实践。如果你读过这本书，你觉得书中有哪些最佳实践或指导方针已经过时了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T20:14:25.237

对于 C# 和 .Net，我强烈推荐阅读 Krzysztof Cwalina 和 Brad Adams 的书“[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321545613)”。那本书以及针对 FxCop 和 ReSharper 代码分析运行我的代码确实帮助我保持我的代码干净和精简

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T19:54:10.190

很难一次列出所有好的做法。但这是一个起始列表。

*   始终通过禁用视图状态和会话等状态管理功能来开始开发页面。只有在绝对必要时才启用它们。
*   了解 ASP.Net 页面生命周期。
*   不要将 html 标记与代码和 javascript 混为一谈。
*   在 .Net 程序集中嵌入图像和 java 脚本文件等 Web 资源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T03:37:24.940

Krzysztof Cwalina 和 Brad Adams 撰写的[框架设计指南：可重用 .NET 库的约定、习惯用法和模式](https://rads.stackoverflow.com/amzn/click/com/0321545613)可能是最好的资源。虽然本书强调可重用库，但您可以轻松地为标准项目定制指南。

[Brad Adams](http://blogs.msdn.com/brada/default.aspx)（本书的作者之一）也经常在博客中介绍许多规则。

C# 和 VB 编码标准参考文档

有关编码风格，请查看 Clint Edmonson 的[C# 和 VB 编码标准参考文档](http://www.notsotrivial.net/blog/post/2008/12/Holiday-Goodie-Bag-Free-C-and-VB-Coding-Standards-Reference-Documents.aspx)。

ASP.NET 特定指南的两个很好的资源是[MSDN 安全指南：ASP.NET 2.0](http://msdn.microsoft.com/en-us/library/ms998258.aspx)和由澳大利亚维多利亚州教育和幼儿发展部发布的[ASP.NET 编码标准。](http://www.education.vic.gov.au/devreskit/appdev/Standards/ASP/aspnet-standards-summary.htm)

最后，SSW（澳大利亚的另一个组织）有一个很棒的部分，称为[SSW Rules to Better...](http://www.ssw.com.au/ssw/standards/Default.aspx)，其中包含针对不同开发活动的各种规则。

# c# - 有没有办法在允许不区分大小写的 URL 的同时避免重复的页面缓存条目？

> ID：439443
> 
> 赞同：1
> 
> 时间：2009-01-13T15:44:51.550
> 
> 标签：c#, asp.net, caching, outputcache

如果我有一个带有输出缓存的页面（我们称之为Employees.aspx），它接受一个名为*Company*的参数（通过查询字符串），如下所示：

```
http://www.example.com/Employees.aspx?Company=Google

```

如何避免不同大小写 URL 的重复页面缓存条目，例如：

```
http://www.example.com/Employees.aspx?Company=GOOGLE
http://www.example.com/Employees.aspx?Company=GOoGlE

```

我通过 OuputCaching 指令启用了输出缓存，如下所示：

```
<%@ OutputCache Duration="300" VaryByParam="Company"  %> 
```

有没有办法以编程方式设置这个特定请求的“唯一缓存键”应该是什么

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:15:20.303

一种 hack-esque 方法是执行 VaryByCustom（而不是 VaryByParam）并在其中执行 .ToLower/.ToUpper。

将 OutputCache 指令更改为如下所示：

```
<%@ OutputCache Duration="300" VaryByCustom="Company" VaryByParam="none" %> 
```

...并在 Global.asax.cs 中为 GetVaryByCustomString 添加一个覆盖：

```
public override string GetVaryByCustomString(System.Web.HttpContext context, string custom)
{
    string CustomValue = "";
    switch (custom.ToLower())
    {
        case "company":
            CustomValue = context.Request.QueryString["company"] ?? "";
            CustomValue = CustomValue.ToLower();
            break;
    }
    return CustomValue;
} 
```

# .net - .NET 如何检查路径是否是文件而不是目录？

> ID：439447
> 
> 赞同：78
> 
> 时间：2009-01-13T15:45:46.777
> 
> 标签：.net, file, directory

我有一个路径，我需要确定它是目录还是文件。

这是确定路径是否为文件的最佳方法吗？

```
string file = @"C:\Test\foo.txt";

bool isFile = !System.IO.Directory.Exists(file) && 
                         System.IO.File.Exists(file); 
```

对于一个目录，我会颠倒逻辑。

```
string directory = @"C:\Test";

bool isDirectory = System.IO.Directory.Exists(directory) && 
                            !System.IO.File.Exists(directory); 
```

如果两者都不存在，那么我不会去做任何一个分支。所以假设它们都存在。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-01-13T15:52:09.947

采用：

```
System.IO.File.GetAttributes(string path) 
```

并检查返回的`FileAttributes`结果是否包含值`FileAttributes.Directory`：

```
bool isDir = (File.GetAttributes(path) & FileAttributes.Directory)
                 == FileAttributes.Directory; 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2009-01-13T16:00:14.547

我认为这是最简单的方法，您只需要两次检查：

```
string file = @"C:\tmp";
if (System.IO.Directory.Exists(file))
{
    // do stuff when file is an existing directory
}
else if (System.IO.File.Exists(file))
{
    // do stuff when file is an existing file
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-13T15:50:57.297

您可以使用一些互操作代码来做到这一点：

```
 [DllImport("shlwapi.dll", CharSet = CharSet.Unicode)]
    [return: MarshalAsAttribute(UnmanagedType.Bool)]
    public static extern bool PathIsDirectory([MarshalAsAttribute(UnmanagedType.LPWStr), In] string pszPath); 
```

为了进一步澄清一些评论......

在此引入非托管代码并不比 .NET 中的任何其他文件或 I/O 相关调用更危险，因为它们最终都调用非托管代码。

这是使用字符串的单个函数调用。通过调用此函数，您不会引入任何新的数据类型和/或内存使用。是的，您确实需要依赖非托管代码来正确清理，但您最终对大多数 I/O 相关调用都有依赖。

作为参考，这里是来自 Reflector 的 File.GetAttributes(string path) 的代码：

```
public static FileAttributes GetAttributes(string path)
{
    string fullPathInternal = Path.GetFullPathInternal(path);
    new FileIOPermission(FileIOPermissionAccess.Read, new string[] { fullPathInternal }, false, false).Demand();
    Win32Native.WIN32_FILE_ATTRIBUTE_DATA data = new Win32Native.WIN32_FILE_ATTRIBUTE_DATA();
    int errorCode = FillAttributeInfo(fullPathInternal, ref data, false, true);
    if (errorCode != 0)
    {
        __Error.WinIOError(errorCode, fullPathInternal);
    }
    return (FileAttributes) data.fileAttributes;
} 
```

如您所见，它还调用非托管代码以检索文件属性，因此关于引入非托管代码危险的争论是无效的。同样，关于完全保留在托管代码中的论点。没有托管代码实现来执行此操作。即使像其他答案所建议的那样调用 File.GetAttributes() 也存在调用未管理代码的相同“问题”，我相信这是完成确定路径是否为目录的更可靠方法。

**编辑**回答@Christian K 关于CAS 的评论。我相信 GetAttributes 提出安全要求的唯一原因是因为它需要读取文件的属性，因此它希望确保调用代码具有这样做的权限。这与底层操作系统检查（如果有的话）不同。如有必要，您始终可以围绕对 PathIsDirectory 的 P/Invoke 调用创建一个包装函数，该函数还需要某些 CAS 权限。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-13T15:52:32.003

假设目录存在...

```
bool isDir = (File.GetAttributes(path) & FileAttributes.Directory)
                  == FileAttributes.Directory; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-13T15:54:05.370

看一下这个：

```
/// <summary>
/// Returns true if the given file path is a folder.
/// </summary>
/// <param name="Path">File path</param>
/// <returns>True if a folder</returns>
public bool IsFolder(string path)
{
    return ((File.GetAttributes(path) & FileAttributes.Directory) == FileAttributes.Directory);
} 
```

来自[http://www.jonasjohn.de/snippets/csharp/is-folder.htm](http://www.jonasjohn.de/snippets/csharp/is-folder.htm)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T15:54:42.157

读取文件属性：

```
FileAttributes att = System.IO.File.GetAttributes(PATH_TO_FILE); 
```

检查*目录*标志。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T15:55:43.400

鉴于一个特定的路径字符串不能同时表示一个目录*和*一个文件，那么下面的工作就很好，并为其他操作打开了大门。

```
bool isFile = new FileInfo(path).Exists;
bool isDir = new DirectoryInfo(path).Exists; 
```

如果您正在使用文件系统，则使用`FileInfo`and`DirectoryInfo`比使用字符串要简单得多。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2013-01-10T20:20:37.050

嗯，看起来`Files`类（in `java.nio`）实际上有一个静态`isDirectory`方法。所以，我认为你实际上可以使用以下内容：

```
Path what = ...
boolean isDir = Files.isDirectory(what); 
```

# tfs - 了解 MSBuild 和与 TFS 持续集成的好资源

> ID：439461
> 
> 赞同：1
> 
> 时间：2009-01-13T15:49:13.070
> 
> 标签：tfs, msbuild

我对 MSBuild 比较陌生，正在寻找好的资源来了解更多关于 MSBuild 和 CI 与 TFS 的信息。具体来说，我正在寻找以下具体任务

*   发生签入时从 TFS 获取最新信息
*   构建解决方案
*   运行代码分析
*   运行单元测试用例
*   成功后将项目部署到放置位置
*   标记构建

我不是在寻找任何书籍的任何参考。在线资源会很好。我为此做了谷歌，但无法为此获得端到端任务。

任何指向这个方向的指针都将不胜感激。

编辑：自定义 MSBuild 任务的一些好的资源也会有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T15:59:22.380

[这是我第一次开始的地方。](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)

### 编辑

我并不是要轻率，但 MSDN 确实是 MSBuild 和大多数与 .NET 相关的东西的良好起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:09:26.183

事实上，您所描述的一切都是标准 TFS 构建过程的一部分。至少如果您使用 MSTest 进行单元测试。与其他单元测试框架集成也是可能的。

一个好的起点是 MSDN，因为它非常详尽：http: [//msdn.microsoft.com/en-us/library/ms252495.aspx](http://msdn.microsoft.com/en-us/library/ms252495.aspx)

TFS2008 在 Team Builds 方面使用起来非常愉快。可以通过 Visual Studio 本身设置构建。在 TFS2005 中，这是一个不同且更丑陋的故事 :)

如果您在设置过程中遇到任何障碍，您可以在网上找到很多资源。很多人都在使用它，而且我在寻找博客/论坛帖子甚至讨论最晦涩的问题时从来没有遇到任何麻烦。

# javascript - 如何使用 JQuery 获取 GET 和 POST 变量？

> ID：439463
> 
> 赞同：97
> 
> 时间：2009-01-13T15:49:28.703
> 
> 标签：javascript, jquery

如何使用 JQuery 简单地获取`GET`和`POST`值？

我想做的是这样的：

```
$('#container-1 > ul').tabs().tabs('select', $_GET('selectedTabIndex')); 
```

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2009-01-13T16:08:45.667

对于 GET 参数，您可以从以下位置获取它们`document.location.search`：

```
var $_GET = {};

document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
    function decode(s) {
        return decodeURIComponent(s.split("+").join(" "));
    }

    $_GET[decode(arguments[1])] = decode(arguments[2]);
});

document.write($_GET["test"]); 
```

对于 POST 参数，您可以将`$_POST`JSON 格式的对象序列化为`<script>`标签：

```
<script type="text/javascript">
var $_POST = <?php echo json_encode($_POST); ?>;

document.write($_POST["test"]);
</script> 
```

当您使用它时（在服务器端做事），您也可以在 PHP 上收集 GET 参数：

```
var $_GET = <?php echo json_encode($_GET); ?>; 
```

**注意：**您需要 PHP 5 或更高版本才能使用内置`json_encode`函数。

* * *

**更新：**这是一个更通用的实现：

```
function getQueryParams(qs) {
    qs = qs.split("+").join(" ");
    var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

    while (tokens = re.exec(qs)) {
        params[decodeURIComponent(tokens[1])]
            = decodeURIComponent(tokens[2]);
    }

    return params;
}

var $_GET = getQueryParams(document.location.search); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-13T16:08:47.073

有一个用于 jQuery 的插件来获取名为[.getUrlParams的 GET 参数](http://www.mathias-bank.de/2007/04/21/jquery-plugin-geturlparam-version-2/)

对于 POST，唯一的解决方案是使用 PHP 将 POST 回显到 javascript 变量中，就像 Moran 建议的那样。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-06-22T20:35:02.287

为什么不使用好的旧 PHP？例如，假设我们收到一个 GET 参数“target”：

```
function getTarget() {
    var targetParam = "<?php  echo $_GET['target'];  ?>";
    //alert(targetParam);
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-07T02:13:11.647

或者你可以使用这个[http://plugins.jquery.com/project/parseQuery](http://plugins.jquery.com/project/parseQuery)，它比大多数都小（缩小为 449 字节），返回一个表示名称-值对的对象。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T16:16:12.143

使用任何服务器端语言，您都必须将 POST 变量发送到 javascript。

**。网**

```
var my_post_variable = '<%= Request("post_variable") %>'; 
```

请注意空值。如果您尝试发出的变量实际上是空的，您将收到一个 javascript 语法错误。如果你知道它是一个字符串，你应该把它用引号引起来。如果它是一个整数，您可能需要在将行写入 javascript 之前测试它是否确实存在。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-17T17:48:56.910

这是一个收集`GET`全局对象中所有变量的东西，这是一个经过几年优化的例程。由于 jQuery 的兴起，现在将它们存储在 jQuery 本身中似乎是合适的，正在与 John 一起检查潜在的核心实现。

```
jQuery.extend({
    'Q' : window.location.search.length <= 1 ? {}
        : function(a){
            var i = a.length, 
                r = /%25/g,  // Ensure '%' is properly represented 
                h = {};      // (Safari auto-encodes '%', Firefox 1.5 does not)
            while(i--) {
                var p = a[i].split('=');
                h[ p[0] ] = r.test( p[1] ) ? decodeURIComponent( p[1] ) : p[1];
            }
            return h;
        }(window.location.search.substr(1).split('&'))
}); 
```

示例用法：

```
switch ($.Q.event) {
    case 'new' :
        // http://www.site.com/?event=new
        $('#NewItemButton').trigger('click');
        break;
    default :
} 
```

希望这可以帮助。;)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-17T23:53:50.183

你可以试试jQuery 的[查询字符串对象](http://plugins.jquery.com/project/query-object)插件。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-08-11T23:33:33.503

> 把事情简单化

将**VARIABLE_KEY**替换为变量的键以获取其值

```
 var get_value = window.location.href.match(/(?<=VARIABLE_KEY=)(.*?)[^&]+/)[0]; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-16T07:32:32.280

jQuery 插件看起来不错，但我需要的是一个快速的 js 函数来解析获取参数。这是我发现的。

[http://www.bloggingdeveloper.com/post/JavaScript-QueryString-ParseGet-QueryString-with-Client-Side-JavaScript.aspx](http://www.bloggingdeveloper.com/post/JavaScript-QueryString-ParseGet-QueryString-with-Client-Side-JavaScript.aspx)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-07-17T18:51:04.050

如果您的 $_GET 是多维的，那么这可能就是您想要的：

```
var $_GET = {};
document.location.search.replace(/\??(?:([^=]+)=([^&]*)&?)/g, function () {
    function decode(s) {
            return decodeURIComponent(s.split("+").join(" "));
    }

    //handling for multidimensional arrays
    if(decode(arguments[1]).indexOf("[]") > 0){
        var newName = decode(arguments[1]).substring(0, decode(arguments[1]).length - 2);
        if(typeof $_GET[newName] == 'undefined'){
            $_GET[newName] = new Array();
        }
        $_GET[newName].push(decode(arguments[2]));
    }else{
        $_GET[decode(arguments[1])] = decode(arguments[2]);
    }
}); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-05-28T10:12:21.947

简单，但有用的是从 URL 获取变量/值：

```
function getUrlVars() {
    var vars = [], hash, hashes = null;
    if (window.location.href.indexOf("?") && window.location.href.indexOf("&")) {
        hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    } else if (window.location.href.indexOf("?")) {
        hashes = window.location.href.slice(window.location.href.indexOf('?') + 1);
    }
    if (hashes != null) {
        for (var i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars[hash[0]] = hash[1];
        }
    }
    return vars;
} 
```

我是在网上找的，只是修复了一些bug

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-10-27T11:42:52.970

使用以下功能：

```
var splitUrl = function() {
    var vars = [], hash;
    var url = document.URL.split('?')[0];
    var p = document.URL.split('?')[1];
    if(p != undefined){
        p = p.split('&');
        for(var i = 0; i < p.length; i++){
            hash = p[i].split('=');
            vars.push(hash[1]);
            vars[hash[0]] = hash[1];
        }
    }
    vars['url'] = url;
    return vars;
}; 
```

并访问变量作为get 变量`vars['index']`的`'index'`名称。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-08-26T15:48:56.473

我的做法：

```
var urlParams;
(window.onpopstate = function () {
var match,
      pl     = /\+/g,  Regex for replacing addition symbol with a space
       search = /([^&=]+)=?([^&]*)/g,
      decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
       query  = window.location.search.substring(1);
   urlParams = {};
   while (match = search.exec(query))
    urlParams[decode(match[1])] = decode(match[2]);
})(); 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-10-04T10:48:28.977

只是为了记录，我想知道这个问题的答案，所以我使用了一个PHP方法：

```
<script>
var jGets = new Array ();
<?
if(isset($_GET)) {
    foreach($_GET as $key => $val)
        echo "jGets[\"$key\"]=\"$val\";\n";
}
?>
</script> 
```

这样，在此之后运行的所有 javascript/jquery 都可以访问 jGets 中的所有内容。我觉得这是一个不错的优雅解决方案。

# asp.net - 页面仅在附加 Fiddler 的情况下发回？

> ID：439464
> 
> 赞同：0
> 
> 时间：2009-01-13T15:49:39.683
> 
> 标签：asp.net, iis, forms-authentication, postback, fiddler

我已使用表单身份验证设置 Reporting Services。我们的应用程序位于 Reporting Services 之上，并将其身份验证扩展程序用作单点登录。

我们过去有一个简单的登录页面，但是在这台机器上，当单击登录按钮时它拒绝回发。我使用以下方法将跟踪信息插入到页面中：

```
<%@ Page language="c#" Debug="True" Trace="True" Codebehind="UILogon.aspx.cs" AutoEventWireup="true" Inherits="CustomAuthExtension.UILogon, CustomAuthExtension" Culture="auto" meta:resourcekey="PageResource1" UICulture="auto" %> 
```

我可以看到每次单击按钮时会话 ID 都会发生变化。如果我附加到进程，我会看到它通过 InitComponent 但它从未命中 btnLogon_click 代码。

但是，如果我运行 fiddler 一切都很好，它会很好地回发。

到底是怎么回事？超时？IIS设置不正确？

**编辑：** IE7（应用程序仅限 IE），我刚刚发现，如果我将它留在 OnInit 的断点上几秒钟，它会起作用并在 btnLogon_Click 中击中第二个断点，如果我让它马上去没有击中它。这指向某种奇怪的超时问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-20T17:16:41.180

这是 IIS 的配置问题。绝不应该为 Reporting Services 表单扩展启用匿名和 Windows 身份验证，以便与外部应用程序一起正常工作。

重新运行我们的设置过程，它现在可以工作了。

# javascript - 网页图像预览器

> ID：439468
> 
> 赞同：0
> 
> 时间：2009-01-13T15:50:26.610
> 
> 标签：javascript, html, flash, image

我正在用 php 在 html 中创建一个网页。

我希望用户能够点击一个小图标图像。单击该图标时，将显示较大图像的预览。

猜测解决方案可能涉及 javascript 或 flash。你能指出我正确的方向吗？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T15:54:03.047

如果你是用 php 做的，那么不妨用 GD 帮你做。

这是一篇很好的文章，可以帮助您入门：http: [//icant.co.uk/articles/phpthumbnails/](http://icant.co.uk/articles/phpthumbnails/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:21:02.790

听起来你想要一个[灯箱](http://leandrovieira.com/projects/jquery/lightbox/)？

灯箱允许您在页面上显示图像的缩略图，当用户单击它们时，较大的图像将在屏幕中间弹出。这很常见。

如果您真正需要的是显示/隐藏效果，则可以在用户单击较小的图像时使用 JavaScript 来显示较大的图像。像[jQuery](http://jquery.com/)或[YUI](http://developer.yahoo.com/yui/)这样的 JavaScript 库将使它变得非常容易。

# java - 在另一个标签中使用 jsp fmt 标签

> ID：439471
> 
> 赞同：4
> 
> 时间：2009-01-13T15:50:53.020
> 
> 标签：java, jsp

我希望能够将 fmt 标记的返回值包含在另一个标记中：

```
<local:roundedBox boxTitle="<fmt:message key="somekey"/>">
content
</roundedBox> 
```

我已经多次遇到这个问题，这似乎是 jsp 的一个愚蠢的限制。有没有一种简单的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T16:08:36.027

使用中间变量来存储这样的结果（代码未测试）

```
<fmt:message key="somekey" var="formattedvarname" />
<local:roundedBox boxTitle="${formattedvarname}">
content
</roundedBox> 
```

# unit-testing - 我怎样才能最好地为解析器编写单元测试用例？

> ID：439474
> 
> 赞同：7
> 
> 时间：2009-01-13T15:51:00.540
> 
> 标签：unit-testing, tdd, testcase, test-suite

我正在编写一个解析器，它为每个命令生成 32 位操作码。例如，对于以下语句：

```
set lcl_var = 2 
```

我的解析器生成以下操作码：

```
// load immdshort 2 (loads the value 2)
0x10000010
// strlocal lclvar (lcl_var is converted to an index to identify the var)
0x01000002 
```

请注意，`lcl_var`可以是任何东西，即可以给定任何变量。我该如何为此编写单元测试用例？我们可以避免对值进行硬编码吗？有没有办法让它通用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T10:19:36.730

这取决于您如何构建解析器。单元测试测试单个单元。

因此，如果您想将整个解析器作为一个单元进行测试，您可以给它一个命令列表并验证它是否生成了正确的操作码（您在编写测试时手动检查了该操作码）。您可以为每个命令编写测试，并测试正常使用、边缘情况使用、超出边缘情况使用。例如，测试：

设置 lcl_var = 2

结果是：

0x10000010 0x01000002

0, -1, MAX_INT-1, MAX_INT+1, ...

您知道这些值的正确结果。不同的变量也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T15:25:58.220

```
int[] opcodes = Parser.GetOpcodes("set lcl_var = 2");
Assert.AreEqual(2, opcodes.Length);
Assert.AreEqual(0x10000010, opcodes[0]);
Assert.AreEqual(0x01000002, opcodes[1]); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T09:20:28.263

如果您的问题是“如何在不为每个输入-输出组合编写一个 xUnit 测试的情况下使用不同的输入和预期值运行相同的测试？”

那么答案就是使用类似 RowTest NUnit 扩展的东西。我最近在我的博客上写了一篇[快速启动帖子。](http://madcoderspeak.blogspot.com/2009/01/nunit-rowtest-extension-running-same.html)这方面的一个例子是

```
[TestFixture]
    public class TestExpression
    {
        [RowTest]
        [Row(" 2 + 3 ", "2 3 +")]
        [Row(" 2 + (30 + 50 ) ", "2 30 50 + +")]
        [Row("  ( (10+20) + 30 ) * 20-8/4 ", "10 20 + 30 + 20 * 8 4 / -")]
        [Row("0-12000-(16*4)-20", "0 12000 - 16 4 * - 20 -")]
        public void TestConvertInfixToPostfix(string sInfixExpr, string sExpectedPostfixExpr)
        {
            Expression converter = new Expression();
            List<object> postfixExpr = converter.ConvertInfixToPostfix(sInfixExpr);

            StringBuilder sb = new StringBuilder();
            foreach(object term in postfixExpr)
            {
                sb.AppendFormat("{0} ", term.ToString());
            }
            Assert.AreEqual(sExpectedPostfixExpr, sb.ToString().Trim());
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T10:18:22.287

据我了解，您将首先为您的特定示例编写一个测试，即解析器的输入在哪里：

```
set lcl_var = 2 
```

输出是：

```
0x10000010 // load immdshort 2
0x01000002 // strlocal lclvar 
```

当您实现生产代码以通过该测试并对其进行重构时，如果您不满意它可以处理任何局部变量，请使用不同的局部变量编写另一个测试并查看它是否通过。例如带有输入的新测试：

```
set lcl_var2 = 2 
```

并编写您的新测试以期待您想要的不同输出。继续这样做，直到您对您的生产代码足够健壮感到满意为止。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T15:59:05.063

您没有指定要使用哪种语言编写解析器，因此为了论证的目的，我将假设您使用的是面向对象的语言。

如果是这种情况，那么依赖注入可以帮助你。如果发出的操作码的目的地是一个类的实例（例如 File），请尝试为您的发射器类提供一个构造函数，该构造函数采用该类型的对象作为发出代码的目的地。然后，从单元测试中，您可以传入一个模拟对象，它是您的目标类的子类的一个实例，捕获特定语句的发出操作码，并断言它们是正确的。

如果您的目标类不容易扩展，您可能希望基于它创建一个目标类和模拟类都可以实现的接口。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-24T14:21:32.323

你想测试什么？您想知道是否创建了正确的“存储”指令吗？是否选择了正确的变量？下定决心要知道什么，测试将是显而易见的。只要你不知道你想要达到什么，你就不会知道如何测试未知数。

同时，只需编写一个简单的测试。明天或晚些时候，你会再次来到这个地方，因为有些东西坏了。那个时候，你会更了解你想做什么，设计一个测试可能会更简单。

今天，不要试图成为明天的你。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T16:52:54.603

目前尚不清楚您是否正在寻找用于测试的方法或特定技术。

就方法论而言，您可能不想进行广泛的单元测试。也许更好的方法是用您的领域特定语言编写一些程序，然后执行操作码以产生结果。然后测试程序会检查这个结果。这样你可以练习一堆代码，但最后只检查一个结果。从简单的开始清除明显的错误并转向更难的错误。而不是每次都检查生成的操作码。

另一种方法是使用您的领域特定语言自动生成程序以及预期的操作码。这可以非常简单，就像编写一个 perl 脚本来生成一组程序，例如：

设置 lcl_var = 2

设置 lcl_var = 3

一旦您拥有一套具有正确输出的语言测试程序，您就可以返回并生成检查每个操作码的单元测试。由于您已经拥有操作码，因此检查解析器的输出是否正确就成了问题；审查其代码。

虽然我没有使用过 cppunit，但我使用了一个非常类似于 cppunit 的内部工具。使用 cppunit 很容易实现单元测试。

# java - Java中的单引号和双引号有区别吗？

> ID：439485
> 
> 赞同：118
> 
> 时间：2009-01-13T15:52:58.727
> 
> 标签：java, syntax

Java中的单引号和双引号有区别吗？

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2009-01-13T15:54:53.747

对文字使用单引号，对文字使用`char`双引号`String`，如下所示：

```
char c = 'a';
String s = "hello"; 
```

它们不能以任何其他方式使用（例如在 Python 中）。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-01-13T16:03:47.923

char 是单个 UTF-16 字符，即字母、数字、标点符号、制表符、空格或类似的东西。

char 文字是用单引号括起来的单个字符，如下所示

```
char myCharacter = 'g'; 
```

或转义序列，甚至是 Unicode 转义序列：

```
char a = '\t';    // Escape sequence: tab
char b = '\177'   // Escape sequence, octal.
char c = '\u03a9' // Unicode escape sequence. 
```

值得注意的是，Unicode 转义序列在编译过程中很早就被处理，因此使用 '\u00A' 会导致编译器错误。对于特殊符号，最好使用转义序列，即 '\n' 而不是 '\u00A' 。

双引号是 for `String`，您必须在字符串中使用“双引号转义序列”（`\"`），否则它将终止字符串。
例如：

```
System.out.println("And then Jim said, \"Who's at the door?\""); 
```

没有必要在单引号内转义双引号。
以下行在 Java 中是合法的：

```
char doublequote = '"'; 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2017-03-17T16:18:01.280

让我们考虑这行代码（Java）：

```
System.out.println("H"+"A"); //HA
System.out.println('H'+'a'); //169 
```

1) 第一行是 and 的连接，`H`这`A`将导致`HA`(String literal)

2) 其次，我们根据 ASCII 表`H`=72 和`a`=97 添加两个字符的值，这意味着我们添加`72+97`它就像`('H'+'a')`.

3）让我们考虑另一种情况：

```
System.out.println("A"+'N');//AN 
```

在这种情况下，我们正在处理 String`A`和 char的串联，`N`这将导致`AN`.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-04-13T13:21:51.217

单引号表示字符，双引号表示字符串。

字符 c='c';

'c'-----> c 是一个字符

字符串 s="stackoverflow";

“stackoverflow”-----> stackoverflow 是一个字符串（即如果字符的集合）

# javascript - Greasemonkey：文本处理 - 在网站中查找某些单词并使其具有功能的最佳方法是什么？

> ID：439487
> 
> 赞同：3
> 
> 时间：2009-01-13T15:53:00.630
> 
> 标签：javascript, regex, string, greasemonkey

我希望greasemonkey 扫描一个网站并将某些单词更改为其他内容。有没有办法用正则表达式或javascript中的其他字符串处理函数来做到这一点？

谢谢你的帮助 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T16:34:58.220

在greasemonkey 中，您使用DOM，然后在文本节点上使用正则表达式来查找您的单词。检查[Wikiproxy](http://wikiproxy.whitelabel.org/greasemonkey.html)用户脚本以获取搜索单词和更改内容的示例。

# vb6 - 对于没有源代码的随机崩溃的应用程序，我们能做些什么？

> ID：439489
> 
> 赞同：1
> 
> 时间：2009-01-13T15:53:09.397
> 
> 标签：vb6, vbscript, crash

我正在尝试帮助客户解决问题，但我的想法已经不多了。他们有一个自定义的、内部编写的应用程序，该应用程序按计划运行，但它崩溃了。我不知道这种情况已经有多久了，所以我认为我无法将崩溃追溯到任何特定的软件更新。最不幸的部分是不再有任何包含逻辑内容的 VB6 DLL 源代码。

这个 VB6 DLL 由 VB 脚本的 2-3 个函数调用启动。显然，我可以修改 VB 脚本以添加错误日志记录，但我无法获得质量信息来查明崩溃的根源。我已将日志消息放在所有函数调用的任一侧，并确定哪些调用导致了崩溃。但是，err 对象中不会返回任何内容，因为调用正在使 wscript.exe 崩溃。

我不确定我还能做些什么。有任何想法吗？

编辑：即使我没有源代码，我关心的主要原因是可能有一些外部因素导致崩溃（凭据不足、文件锁定等）。我检查了由于 wscript.exe 崩溃而在 drwtsn32.log 中创建的日志文件，我得到的唯一信息是“访问冲突”。

我首先倾向于认为这与安全权限有关，但这难道不是内存访问违规吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T17:05:10.640

如果您确实认为这是文件权限等环境的问题，您可以考虑使用[Sysinternals工具之一。](http://technet.microsoft.com/en-us/sysinternals/default.aspx)我曾经使用 Filemon 来找出我的应用程序接触到的所有文件，并以这种方式发现了一个问题。

您可能还想使用[Dependency Walker](http://www.dependencywalker.com/)进行快速健全性检查，以确保您实际上正在加载您认为的 DLL 文件。我看到加载了错误版本的 C 运行时并导致了神秘的崩溃。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T15:57:20.123

根据应用程序的范围，您的客户可能需要考虑重写。如果没有源代码，当其他事情发生变化时，他们最终将被迫这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T16:01:27.743

始终可以使用调试器（直接在运行崩溃应用程序的 PC 上或内存转储上）来或多或少地确定正在发生的事情。在这种情况下，代码是 VB6，这可能不是很有帮助，因为您只能在 Win32 级别获得有用的信息。

最终，如果您没有源代码，那么找出错误真正有帮助的地方是什么？除非您可以在调用脚本中永远避免该代码路径，否则您将无法修复它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T16:04:23.790

您可以使用[windows 的调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)。这可能会帮助您查明错误，但如果没有修复它的来源，对您没有多大好处。

一种更懒惰的方法是从代码（而不是脚本）调用 dll，这样您至少可以看到导致问题的原因并检查 err 对象。您仍然无法修复它，除非问题是它被错误地调用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T16:32:00.397

[Coding The Wheel](http://www.codingthewheel.com/)的人有一个非常有趣的系列，关于构建一个充满严肃技术信息的在线扑克机器人，其中很多都与如何进入现有应用程序并搞乱它们有关，在某种程度上，你想做什么。

具体来说，他有[一篇关于使用 WinDbg 获取重要信息的文章](http://www.codingthewheel.com/archives/how-i-built-a-working-online-poker-bot-7)，一篇关于[如何将函数调用弯曲到您自己的代码](http://www.codingthewheel.com/archives/extracting-hidden-text-with-windbg)以及[一篇关于在其他进程中注入 DLL 的文章](http://www.codingthewheel.com/archives/how-to-inject-a-managed-assembly-dll)。这些技术可能有助于发现并可能解决或修复崩溃，尽管我想这仍然是一个艰难的决定。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T18:08:38.767

有几个工具可能会有所帮助。首先，您可以使用dependency walker 对您的应用程序进行运行时配置文件：

[http://www.dependencywalker.com/](http://www.dependencywalker.com/)

有一个配置文件菜单，您可能希望确保选中跟随子进程选项。这将做两件事。首先，它可以让你看到所有被拉入的库版本。这对一些问题很有帮助。其次，运行时配置文件在运行子进程时使用调试内存管理器。因此，您将能够查看缓冲区是否溢出以及一些相关信息。

另一个有用的工具是 Mark Russinovich 的过程监视器：

[http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

该工具将报告所有文件、注册表和线程操作。这将帮助您确定是否遇到文件或注册表凭据问题。

Process explorer 为您提供了许多相同的信息：

[http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)

这也是 Russinovich 的工具。我发现通过这个工具查看一些数据要容易一些。

最后，使用 windows 或 dev studio 的调试工具可以让您深入了解错误发生的位置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T17:19:16.027

访问冲突几乎总是一个内存错误——在这种情况下更有可能是因为它的随机崩溃（权限可能更明显可重现）。在 dll 的情况下，它可能是

1.  dll 本身的代码中存在错误 - 这可能类似于内存分配错误，甚至可能是简单的循环边界条件错误。

2.  当 dll 尝试链接到系统上的另一个 dll 时出现错误。这通常是由于机器上的 dll 版本不匹配造成的。

您的第一步应该是尝试获得可重现的崩溃条件。如果您没有一系列会导致系统崩溃的情况，那么您将无法知道何时修复了它。

然后我会在干净的机器上安装系统并尝试在上面重现错误。运行监视器并准确检查程序崩溃时打开的其他文件（dll 等）。我见过在超线程 Pentium 上崩溃的代码，但在较早的 Pentium 上却没有——因此将旧机器恢复为测试平台可能是覆盖该机器的不错选择。改变机器中的 ram 数量也是值得的。

希望这些步骤可以为您提供线索。希望这将是一个环境问题，因此可以通过使用正确版本的 windows、dll 等来避免。但是，如果此时您仍然遇到崩溃而没有好的线索，那么您的选择是重写或尝试通过在汇编器杠杆处调试 dll 或将其反汇编来进一步查明问题。如果您不熟悉汇编代码，那么这两种方法都是遥不可及的，很难看出您将获得什么——而且任何一种选择都可能是一个巨大的时间槽。我自己过去遇到过这样的特别低级别的高强度问题，在“招聘编码器”网站之一上做广告，并寻找具有专业知识的人。同样，您将需要一个可重现的错误才能做到这一点。

从长远来看，必须更换没有源代码的 dll。聘请具有装配技能的专家来分析功能并为您提供流程图可能值得考虑。以受控的方式尽早执行此操作是一种良好的商业实践 - 例如在运行它的机器崩溃并且该版本的 windows 不再容易获得之后。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T17:21:13.540

您可能想尝试使用[Resource Hacker](http://angusj.com/resourcehacker/)，您可能有幸反编译内部应用程序。它可能不会为您提供完整的源代码，但至少可能会提供有关该应用程序正在做什么的更多信息，这也可以帮助您确定罪魁祸首。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T16:52:07.313

**将最大可能的 RAM 添加到机器**

这个简单而便宜的黑客过去对我有用。当然是 YMMV。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T18:11:15.407

逆向工程是一种可能性，尽管很困难。
从理论上讲，您可以反编译甚至调试/跟踪已编译的 VB6 应用程序 - 这是容易的部分，在没有源代码的情况下修改它，除了最简单的情况外，这是困难的部分。

免费编译器/反编译器：

[VB 反编译器](http://www.woodmann.com/collaborative/tools/index.php/Category:Visual_Basic_Decompilers)

[VB 调试器](http://www.woodmann.com/collaborative/tools/index.php/Category:Visual_Basic_Debuggers)

在大多数情况下，重写将是解决问题的更成功和更快的方法。

# sql-server - 如何在 LIKE 子句中转义方括号？

> ID：439495
> 
> 赞同：280
> 
> 时间：2009-01-13T15:53:41.313
> 
> 标签：sql-server, tsql, escaping, character, sql-like

我正在尝试使用 like 过滤带有存储过程的项目。该列是 varchar(15)。我要过滤的项目名称中有方括号。

例如： `WC[R]S123456`。

如果我这样做，`LIKE 'WC[R]S123456'`它不会返回任何东西。

我找到了一些关于使用`ESCAPE`关键字 with的信息，`LIKE`但我不明白如何使用它来将方括号视为常规字符串。

* * *

## 回答 #1

> 赞同：380
> 
> 时间：2009-01-13T15:56:17.800

```
LIKE 'WC[[]R]S123456' 
```

或者

```
LIKE 'WC\[R]S123456' ESCAPE '\' 
```

应该管用。

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2011-01-18T09:52:04.610

假设您要匹配文字`its[brac]et`。

您不需要转义 ，`]`因为它仅在与 配对时才具有特殊含义`[`。

**因此，逃避`[`足以解决问题。**您可以`[` *通过将其替换为* `[[]`.

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-04-30T23:51:51.473

我需要从查询中排除以下划线开头的名称，所以我最终得到了这个：

```
WHERE b.[name] not like '\_%' escape '\'  -- use \ as the escape character 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-01-13T16:03:07.163

这是我实际使用的：

```
like 'WC![R]S123456' ESCAPE '!' 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-01-13T16:03:40.810

如果您需要搜索 % 和 _ 等通常是通配符的特殊字符，则使用 E​​SCAPE 关键字。如果指定 ESCAPE，SQL 将按字面意思搜索字符 % 和 _。

[这是一篇很好的文章，还有更多示例](http://search400.techtarget.com/tip/1,289483,sid3_gci870464,00.html)

```
SELECT columns FROM table WHERE 
    column LIKE '%[[]SQL Server Driver]%' 

-- or 

SELECT columns FROM table WHERE 
    column LIKE '%\[SQL Server Driver]%' ESCAPE '\' 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-02-09T11:08:12.840

如果您需要转义像**“_”**（下划线）这样的特殊字符，就像我的情况一样，并且您不愿意/不能定义 ESCAPE 子句，您可能希望用方括号**'[将特殊字符括起来'**和**']'**。

这解释了“奇怪”字符串**'[[]'**的含义——它只是将**'['**字符包含在方括号中，有效地将其转义。

我的用例是指定带有下划线的存储过程的名称作为 Profiler 的过滤条件。因此，我将字符串**'%name[_]of[_]a[_]stored[_]procedure%'**放在 TextData LIKE 字段中，它给了我想要实现的跟踪结果。

这是文档中的一个很好的示例： [LIKE (Transact-SQL) - Using Wildcard Characters As Literals](https://msdn.microsoft.com/en-us/library/ms179859.aspx#Anchor_7)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-10-12T13:24:49.140

根据[文件](https://docs.microsoft.com/en-us/sql/t-sql/language-elements/like-transact-sql)：

> 您可以将通配符模式匹配字符用作文字字符。要将通配符用作文字字符，请将通配符括在方括号中。

您需要转义这三个字符`%_[`：

```
'5%'      LIKE '5[%]'      -- true
'5$'      LIKE '5[%]'      -- false
'foo_bar' LIKE 'foo[_]bar' -- true
'foo$bar' LIKE 'foo[_]bar' -- false
'foo[bar' LIKE 'foo[[]bar' -- true
'foo]bar' LIKE 'foo]bar'   -- true 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-01-30T17:33:43.197

除了键盘上的“\”或其他字符，您还可以使用键盘上没有的特殊字符。根据您的用例，如果您不希望用户输入意外用作转义字符，这可能是必要的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-12-05T12:54:45.010

有一个问题，而：

```
LIKE 'WC[[]R]S123456' 
```

和：

```
LIKE 'WC\[R]S123456' ESCAPE '\' 
```

两者都适用于 SQL Server，但都不适用于 Oracle。

似乎没有 ISO/IEC 9075 方法来识别涉及左大括号的模式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-06-11T12:35:22.387

**使用跟随。**

对于要按原样搜索的用户输入，请使用转义，因为它需要以下替换所有特殊字符（以下涵盖所有 SQL Server）。

这里不采用单引号“'”，因为它不会影响like子句，因为它是字符串连接的问题。

不需要“-”和“^”和“]”替换，因为我们正在转义“[”。

```
String FormattedString = "UserString".Replace("ð","ðð").Replace("_", "ð_").Replace("%", "ð%").Replace("[", "ð["); 
```

然后，在 SQL Query 中应该如下所示。（在参数化查询中，字符串可以在上述替换后添加模式）。

搜索确切的字符串。

```
like 'FormattedString' ESCAPE 'ð' 
```

从字符串开始搜索

```
like '%FormattedString' ESCAPE 'ð' 
```

以字符串结尾搜索

```
like 'FormattedString%' ESCAPE 'ð' 
```

用字符串搜索包含

```
like '%FormattedString%' ESCAPE 'ð' 
```

等等其他模式匹配。但是直接用户输入需要如上所述格式化。

# sql - SQL 表中的 ID 字段：规则还是法律？

> ID：439507
> 
> 赞同：1
> 
> 时间：2009-01-13T15:55:22.903
> 
> 标签：sql

只是一个快速的数据库设计问题：您总是在每个表中使用 ID 字段，还是只在大多数表中使用？很明显，您的大多数表格都会受益，但是否有您可能不想使用 ID 字段的表格？

例如，我想添加向另一个表 (foo) 中的对象添加标签的功能。所以我有一个表 FooTag，其中有一个 varchar 字段来保存标签，还有一个 fooID 字段来引用 foo 中的行。我真的需要围绕一个基本上任意的 ID 字段创建一个聚集索引吗？使用 fooID 和我的文本字段作为聚集索引不是更有效吗，因为无论如何我几乎总是会通过 fooID 进行搜索？另外，在聚集索引中使用我的文本将使数据保持排序，当我必须查询我的数据时使排序更容易。缺点是插入会花费更长的时间，但这不会被选择期间的收益所抵消，这会更频繁地发生吗？

您对 ID 字段有何看法？可弯曲的规则，还是牢不可破的法律？

编辑：我知道提供的示例未标准化。如果标记是项目的主要部分，标记多个表和其他“附加”，那么两个表的解决方案将是一个明确的答案。然而，在这个最简单的情况下，标准化是否值得？它会节省一些空间，但在运行查询时需要额外的连接

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T15:58:45.487

就像在许多编程中一样：**规则，而不是法律**。

例外证明：一些两列表的存在只是为了在其他更有意义的表之间形成关系。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T16:04:03.133

如果您正在制作在两个或多个其他表之间桥接的表，并且您需要的唯一字段是双 PK/FK，那么我不知道您为什么还需要其中的 ID 列。

ID 列通常非常有用，但这并不意味着您应该在每个场合都使用它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T16:20:55.160

正如其他人所说，这是一个一般规则，而不是绝对规则，并且有很多例外（例如具有复合键的表）。

在某些偶然但有用的情况下，您可能希望在已经具有（通常是复合的）唯一标识符的表中创建人工 ID。例如，在一个系统中，我创建了一个表格来存储零件编号；尽管零件编号是唯一的，但它们实际上可能会发生变化——我们添加一个任意整数 PartID。不是很常见，但它是一个典型的现实世界的例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T21:14:12.837

一般来说，您真正想要的是能够在可能的情况下使用某种方式来唯一标识一条记录。它可以是一个 id 字段，也可以是一个唯一索引（不必只在一个字段上）。任何时候我认为我可以在不创建唯一标识记录的方法的情况下逃脱，但事实证明我错了。但是，所有表都没有自然键，如果没有，您确实需要某种类型的 id 文件。如果你有一个自然键，你可以使用它，但我发现即使这样，在大多数情况下我也需要一个 id 字段，以防止在自然键更改时进行过多更新（它似乎总是在更改）。再加上使用了数百个涉及许多不同主题的数据库，我可以告诉你真正的自然键是罕见的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T15:57:51.727

如果您需要从该表中检索具有唯一 ID 的记录，那么可以。如果您将通过由外键组成的其他组合键来检索它们，那么不会。您最不需要的是不使用的字段、数据和索引。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T16:03:03.747

聚集索引也不需要位于主键或代理项（标识列）上。

但是，您的设计未标准化。通常对于标记，我使用两个表，一个标签表（带有代理键）和一个从标签到主题表的链接表，使用标签表中的代理键和主题表中的主键。这允许您的标签应用于不同的实体（照片、文章、员工、位置、产品等）。它允许您对多个表实施外键关系，还允许您发明标签层次结构和有关标签表的其他内容。

至于这个设计上的索引，它将由使用模式决定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T21:20:25.290

In general developers love having an ID field on all tables except for 'linking' tables because it makes development much easier, and I am no exception to this. DBA's on the other hand see no problem with making natural primary keys made up of 3 or 4 columns. It can be a butting of heads to try and get a good database design.

# vba - Excel 中的 VBA 函数可以返回一个范围吗？

> ID：439510
> 
> 赞同：29
> 
> 时间：2009-01-13T15:56:24.633
> 
> 标签：vba, excel

尝试执行以下操作时，我似乎遇到了类型不匹配错误：

在新工作簿中：

```
A1 B1
5  4

Function Test1() As Integer
    Dim rg As Range
    Set rg = Test2()
    Test1 = rg.Cells(1, 1).Value
End Function
Function Test2() As Range
    Dim rg As Range
    Set rg = Range("A1:B1")
    Test2 = rg
End Function 
```

添加 =Test1() 应该返回 5，但是当从 test2() 返回一个范围时，代码似乎终止了。是否可以返回一个范围？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-01-13T16:00:36.963

范围是一个对象。分配对象需要使用 SET 关键字，看起来您在 Test2 函数中忘记了一个：

```
Function Test1() As Integer
    Dim rg As Range
    Set rg = Test2()
    Test1 = rg.Cells(1, 1).Value
End Function

Function Test2() As Range
    Dim rg As Range
    Set rg = Range("A1:B1")
    Set Test2 = rg         '<-- Don't forget the SET here'
End Function 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-16T15:48:17.030

您还可以返回`Variant()`表示值数组的 a。下面是一个将值从范围反转到新范围的函数的示例：

```
Public Function ReverseValues(ByRef r_values As Range) As Variant()
    Dim i As Integer, j As Integer, N As Integer, M As Integer
    Dim y() As Variant
    N = r_values.Rows.Count
    M = r_values.Columns.Count
    y = r_values.value    'copy values from sheet into an array
    'y now is a Variant(1 to N, 1 to M) 
    Dim t as Variant
    For i = 1 To N / 2
        For j = 1 To M
            t = y(i, j)
            y(i, j) = y(N - i + 1, j)
            y(N - i + 1, j) = t
        Next j
    Next i

    ReverseValues = y
End Function 
```

在工作表中，您必须将此函数作为数组公式（使用`Ctrl`- `Shift`- `Enter`）应用，并选择适当数量的单元格。Swap() 函数的细节在这里并不重要。

**请注意**，对于许多行，这是非常有效的。当是一个数组并且范围包含多行列时，执行`x = Range.Value`and操作比直接对单元格一一执行操作快*很多倍。*`Range.Value = x``x`

 ** * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T15:59:34.640

将 Test2 中的最后一行更改为：

```
Set Test2 = rg 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-03-01T06:20:34.120

这也有效

```
Function Test2(Rng As Range) As Range
    Set Test2 = Rng
End Function 
```

# winforms - 从映射驱动器或共享文件夹运行 .NET 程序 - 优点/缺点

> ID：439515
> 
> 赞同：2
> 
> 时间：2009-01-13T15:57:09.483
> 
> 标签：winforms, .net-3.5

对于你们中的一些人来说，这可能是一个愚蠢的问题，但是从共享驱动器运行 Windows Forms .Net 应用程序的优缺点是什么。直到最近，我什至不知道这是可能的。从研究来看，.Net 3 SP1 允许这种行为（不需要任何安全更改）。

我很好奇任何并发问题或可扩展性。

另外，我假设从共享驱动器运行应用程序的每个客户端仍然需要 .Net。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T16:06:51.740

我们有许多用 .Net 编写的控制台程序，它们在夜间进行批处理。这些程序“活”在通过映射驱动器访问的 SAN 上。由于我们仍在使用 .Net 2.0，因此必须专门配置处理服务器以允许这些程序运行，当然处理服务器需要安装框架，但除此之外它工作得很好。.Net3.5sp1 甚至可以修复特殊配置。

现在，这种情况可能与您的想法不同。如果您想将应用程序部署到共享文件夹以便许多不同的用户可以访问它，那么这是一个坏主意。如果您写入与应用程序相同的文件夹中的任何数据文件（无论如何都是个坏主意，但人们一直这样做），那么这些文件将由所有用户共享（并锁定）。此外，当前运行程序的任何用户都会导致文件系统锁定程序文件，从而可能使您无法部署更新。如果您想这样做，.Net 提供了一个名为 ClickOnce 的出色系统来支持将应用程序部署到网络共享。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T16:00:49.397

您需要在每个客户端上安装正确的 .Net 版本，但没有理由不能从共享驱动器运行，只要用户有权访问，我们就可以在此处和客户端上执行此操作股份。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T16:45:08.763

并发和扩展不是问题，但在最极端的情况下。您只是将网络共享用作提供程序集的驱动器。该应用程序仍在工作站上运行，仅消耗该机器的操作系统资源和 CPU 周期。与 ASP.NET 应用程序不同。

如果应用程序本身使用某种共享资源，而不是非典型的 dbase 服务器，那么并发性和扩展性肯定会发挥作用。但无论应用程序是否从网络共享运行，情况都是如此。

一个考虑因素：部署更新可能很困难。您必须让所有用户退出应用程序，这样任何程序集都不会被锁定。将其构建到应用程序中是明智的。像寻找特定文件名的 FileSystemWatcher 这样简单的东西就可以完成工作。

# r - 用 R 在向量中思考

> ID：439526
> 
> 赞同：26
> 
> 时间：2009-01-13T15:58:48.653
> 
> 标签：r, vector

我知道 R 使用向量最有效，应该避免循环。我很难自学以这种方式实际编写代码。我想要一些关于如何“矢量化”我的代码的想法。`st`下面是为 state ( )、plan1 ( `p1`) 和 plan2 ( )的 10,000 个非唯一组合创建 10 年样本数据的示例`p2`：

```
st<-NULL
p1<-NULL
p2<-NULL
year<-NULL
i<-0
starttime <- Sys.time()

while (i<10000) {
    for (years in seq(1991,2000)) {
        st<-c(st,sample(c(12,17,24),1,prob=c(20,30,50)))
        p1<-c(p1,sample(c(12,17,24),1,prob=c(20,30,50)))
        p2<-c(p2,sample(c(12,17,24),1,prob=c(20,30,50)))    
        year <-c(year,years)
    }
        i<-i+1
}
Sys.time() - starttime 
```

这需要大约 8 分钟才能在我的笔记本电脑上运行。正如预期的那样，我最终得到了 4 个向量，每个向量都有 100,000 个值。如何使用矢量函数更快地做到这一点？

附带说明一下，如果我将上面的代码限制为 i 上的 1000 个循环，它只需要 2 秒，但 10,000 个需要 8 分钟。知道为什么吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T18:00:54.133

显然，在我发布我的问题之前，我应该再为此工作一个小时。回想起来是如此明显。:)

为了使用 R 的向量逻辑，我取出循环并将其替换为：

```
st <-   sample(c(12,17,24),10000,prob=c(20,30,50),replace=TRUE)
p1 <-   sample(c(12,17,24),10000,prob=c(20,30,50),replace=TRUE)
p2 <-   sample(c(12,17,24),10000,prob=c(20,30,50),replace=TRUE)
year <- rep(1991:2000,1000) 
```

我现在几乎可以瞬时完成 100,000 个样本。我知道向量更快，但是该死。我假设使用循环需要 100,000 个循环一个多小时，而矢量方法需要 <1 秒。只是为了踢球，我将向量设为一百万。完成大约需要 2 秒。由于我必须测试失败，我尝试了 10mm，但我的 2GB 笔记本电脑内存不足。我切换到具有 6GB 内存的 Vista 64 桌面，并在 17 秒内创建了长度为 10mm 的向量。100mm 使事情分崩离析，因为其中一个向量超过 763mb，这导致了 R 的分配问题。

R 中的向量对我来说速度非常快。我想这就是为什么我是经济学家而不是计算机科学家的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T22:09:25.190

要回答您关于为什么 10000 循环比您的 1000 循环花费更长的时间的问题：

我认为主要的嫌疑人是每个循环都发生的串联。随着数据变长，R 可能会将向量的每个元素复制到一个更长的新向量中。复制一个小的（平均 500 个元素）数据集 1000 次很快。将较大的（平均 5000 个元素）数据集复制 10000 次会更慢。

# .net - 更改 .NET 应用程序配置文件名

> ID：439538
> 
> 赞同：10
> 
> 时间：2009-01-13T16:00:54.077
> 
> 标签：.net, app-config

我有一个调用 .NET 程序集的 VB6 应用程序，它引用了 app.config 文件中的设置。默认情况下，.NET 会查找以 VB6 应用程序命名的配置文件。如何重定向它以使用不同的配置文件名？这需要成为默认配置文件，以便从中读取例如 WCF 设置。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-01-22T10:22:19.910

AppDomain.CurrentDomain.SetData("APP_CONFIG_FILE", @configFile);

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-20T11:59:07.607

你不能改变它。每个 AppDomain 实例都有一个固定的 app.config，它是在创建新应用程序域时通过**AppDomainSetup实例设置的。**尽管您可以通过**AppDomain.SetupInformation**获取设置信息，但此时它实际上已变为只读。

鉴于此，一种选择可能是从您的**Main**函数中创建一个新的应用程序域，并将该域配置为使用您需要的 app.config。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-13T16:03:10.827

您可以使用强制应用程序读取特定配置文件

```
System.Configuration.ConfigurationManager.OpenExeConfiguration(PATH_TO_CONFIG); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T11:52:42.453

考虑将您的配置放在一个 XML 序列化对象中。

# c++ - 指向类成员函数问题的函数指针

> ID：439540
> 
> 赞同：5
> 
> 时间：2009-01-13T16:01:39.303
> 
> 标签：c++, pointers, function-pointers

首先，我必须承认我的编程技能非常有限，并且我接管了一个（非常小的）现有 C++ OOP 项目，我试图将自己的东西推入其中。不幸的是，我遇到了一个超出我知识范围的问题，并且我希望能在这里找到一些帮助。我正在使用第三方库（无法更改）从相机中获取图像，并将在此处使用一些占位符名称。

第三方库有一个函数“ThirdPartyGrab”来启动连续实时抓取，并获取一个指向函数的指针，每次新帧到达时都会调用该函数。所以在一个普通的 C 应用程序中它是这样的：

```
ThirdPartyGrab (HookFunction); 
```

“HookFunction”需要声明为：

```
long _stdcall HookFunction (long, long, void*); 
```

或声明为“BUF_HOOK_FUNCTION_PTR”

```
typedef long (_stdcall *HOOK_FUNCTION_PTR) (long, long, void*); 
```

现在我有一个 C++ 应用程序和一个类“MyFrameGrabber”，它应该封装我所做的一切。所以我将钩子函数作为私有成员放入，如下所示：

```
long _stdcall HookFunction (long, long, void*); 
```

我的班级中还有一个公共 void 函数“StartGrab”应该启动 Grab。在里面我试着打电话：

```
ThirdPartyGrab (..., HookFunction, ...); 
```

这（不足为奇）失败了。它说对 MyFrameGrabber::HookFunction 的函数调用错过了参数列表，我应该尝试使用 &MyFrameGrabber::HookFunction 来创建一个指针。但是，传递“&MyFrameGrabber::HookFunction”会导致另一个错误，即无法将其转换为 BUF_HOOK_FUNCTION_PTR。

通读[C++ FAQ 函数指针](http://www.parashift.com/c++-faq-lite/pointers-to-members.html)后，我想我理解了问题，但无法提出解决方案。我试图将钩子函数设为静态，但这也会导致转换错误。我也想过将钩子函数放在类之外，但我需要在钩子函数中使用类函数。有没有其他方法或者我需要改变我的整个概念？

编辑 14.01.08：我测试了单例解决方法，因为我无法更改第三方库，并且 void 指针仅用于钩子函数内部使用的数据。不幸的是，它并没有像我希望的那样开箱即用......我不知道静态函数是否需要放在一个单独的类中，所以我把它放在我的“MyFrameGrabber”类中：

```
static MyFrameGrabber& instance()
{
        static MyFrameGrabber _instance;
        return _instance;
}
long Hook(long, long, void*); // Implementation is in a separate cpp file 
```

在我的 cpp 文件中，我有 call_hook 函数：

```
long MFTYPE call_hook(long x, MIL_ID y, void MPTYPE *z)
{
    return MyFrameGrabber::instance().Hook(x,y,z);
}
void
MyFrameGrabber::grab ()
{
    ThirdPartyGrab(..., call_hook, ...);
} 
```

但这给了我一个错误，`static MatroxFrameGrabber _instance;`因为找不到匹配的标准构造函数。这是正确的，因为我的 MyFrameGrabber 构造函数如下所示：

```
MyFrameGrabber (void* x,
                const std::string &y, int z,
                std::string &zz); 
```

我试图放入一个空的构造函数`MyFrameGrabber();`，但这会导致链接器错误。我应该将空参数传递给单例中的 MyFrameGrabber 构造函数吗？或者我是否需要一个单独的 Hook 类，如果是，我如何访问 MyFrameGrabber 函数？提前致谢。

第二次编辑 15.01.08：我应用了更改，现在可以编译和链接。不幸的是，我还不能在运行时测试它，因为它是一个 DLL，而且我还没有 Debug Caller Exe，并且在初始化等过程中还有其他问题。我会将帖子标记为答案，因为我确信这是正确的方法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T16:11:55.460

您的私有成员方法有一个隐式`this`指针作为第一个参数。如果你把它写出来，很明显函数签名不匹配。

您需要编写一个静态成员函数，它可以作为回调函数传递给库。的最后一个参数`HookFunction`a`void*`在我看来很像一个 cookie，可以将自己的指针传入其中。

所以，总而言之，它应该是这样的：

```
我的班级{
  长我的回调（长，长）{
    // 在这里实现你的回调代码
  }

  静态长 __stdcall ThirdPartyGrabCallback(long a, long b, void* self) {
    return reinterpret_cast<MyClass*>(self)->MyCallback(a, b);
  }
上市：
  无效开始抓取（）{
    ThirdPartyGrab(..., &MyClass::ThirdPartyGrabCallback, ..., this, ...);
  }
};

```

当然，这只有在`void*`论证按照我所说的进行时才有效。`this`当具有完整的函数签名（包括可用的参数名称）时，调用中的位置`ThirdPartyGrab()`应该很容易找到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:10:15.243

"&MyFrameGrabber::HookFunction" 不能转换为 BUF_HOOK_FUNCTION_PTR 的原因是，作为类的成员，它隐式地将 "this" 指针作为第一个参数，因此您不能将成员函数转换为非成员函数：这两个签名看起来一样，但实际上是不同的。

我会声明一个接口，定义要调用的函数，让您的类实现它并传递对象本身而不是回调（您可以将接口视为函数指针的面向对象的替换）：

```
class IHookInterface{
public:
    virtual long HookFunction(long, long, void*) = 0;
};
 class HookClass : public IHookInterface{
public:
    virtual long Hook(long, long, void*) {
        // your code here... 
    }
}; 
```

// 新定义：ThirdPartyGrab (..., IHookInterface, ...);

编辑 - 如果您无法修改库，其他可能的解决方案：使用单例而不是静态函数。

```
class HookClass{
public:
    static HookClass& instance(){
        static HookClass _instance;
        return _instance;
    }
    long Hook(long, long, void*) {
        // your code here... 
    }
};

long call_hook(long x,long y,void * z){
    return HookClass::instance().Hook(x,y,z);
} 
```

第二次编辑：您可能会使用初始化方法稍微修改单例类以使用适当的参数调用构造函数，但它可能并不比以下更简单的解决方案更优雅：

```
class HookClass{
public:

    HookClass(string x,string y...){
    }

    long Hook(long, long, void*) {
        // your code here... 
    }
};

static HookClass * hook_instance = 0;

long call_hook(long x,long y,void * z){
    if (0 != hook_instance){
        return hook_instance->Hook(x,y,z);
    }
}

int main(){
    hook_instance = new HookClass("x","y");
    ThirdPartyGrab(..., call_hook, ...);
} 
```

# c# - 代表和 Lambdas 和 LINQ，天哪！

> ID：439541
> 
> 赞同：12
> 
> 时间：2009-01-13T16:01:55.557
> 
> 标签：c#, linq, delegates, lambda, anonymous-methods

作为一名相当初级的开发人员，我遇到了一个突出我缺乏经验和知识漏洞的问题。如果这里的序言太长，请见谅。

我发现自己在一个项目中需要学习一些新的（对我来说）技术，包括 LINQ（为了这个项目的目的到 OBJECTS 和到 XML）等等。到目前为止，我所读到的所有内容都表明，要使用 LINQ，我需要完全理解以下内容（委托、匿名方法和 Lambda 表达式）。

好的，现在乐趣来了。过去我曾在使用 .NET 事件模型时使用过代表，但大部分细节对我来说是隐藏的（感谢 Microsoft！）。我知道，在基本层面上，委托实例是指向方法的指针（我知道，这太简单了）。

我了解匿名方法本质上是一种内联未命名方法，通常（如果不是专门）创建为委托的目标。

我也了解 lambda 以不同的方式使用以简化语法，并可用于将简单的匿名方法指向委托。

请原谅我的任何描述与此处不符，这是我理解这些主题的基本水平。

所以，挑战：

1.  如果我对这些项目的理解甚至接近，谁能告诉我至少在基本层面上？我不是在寻找复杂的深奥细节，只是基础知识（目前）。

2.  在将 LINQ 应用到项目中以达到合理效果之前，我需要在多大程度上真正理解这些概念？我想完全理解它并愿意花时间。在我需要制作一些作品之前，我可能根本没有时间完全了解所有这些东西。

3.  任何人都可以向我指出一些解释这些主题并将它们应用于“现实世界”示例的好文章，以便我可以了解主题的基础知识和它们的应用吗？我所说的现实世界的意思是，我如何在“客户和发票”而不是抽象的“矢量和形状”或“动物和奶牛”的上下文中使用它。出于演示目的，该场景可能有些人为，但希望不是严格的学术性的。我在网上和书中找到了许多示例，但似乎很少有“简单的英语”解释。

提前感谢大家的耐心、时间和专业知识。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T16:06:50.773

[我在哪里可以找到 C# 3 的深入指南？](https://stackoverflow.com/questions/170772/where-can-i-find-a-good-in-depth-guide-to-c-3)

1）到目前为止，您的知识似乎还可以。Lambda 表达式根据上下文转换为匿名方法或 System.Linq.Expressions.Expression。由于您没有使用数据库技术，因此您不需要理解表达式（所有 lambda 表达式都是匿名方法）。您没有列出扩展方法，但这些方法非常重要（且易于理解）。确保您了解如何将扩展方法应用于接口 - 因为 linq 中的所有功能都来自 System.Linq.Enumerable - 针对 IEnumerable(Of T) 的扩展方法的集合。

2) 你不需要对 lambdas 有深入的了解。

箭头语法（ => ）对我来说是最大的障碍。箭头将签名和 lambda 表达式的主体分开。

永远记住： **在枚举之前不会执行 Linq 方法。**

注意在 lambda 中使用[循环变量](https://stackoverflow.com/questions/295593/linq-query-built-in-foreach-loop-always-takes-parameter-value-from-last-iteration)。这是延迟执行的副作用，特别难以追踪。

3）当然，这是我的一些答案，显示了 linq 方法调用 - 有些带有 xml。

*   [列表拆分](https://stackoverflow.com/questions/69748/split-a-list-feature-in-c-possibly-linq)
*   [简单的 Xml 存在搜索](https://stackoverflow.com/questions/239951/how-to-determine-if-xelement-elements-contains-a-node-with-a-specific-name)
*   [Xml 投影 - 形状变化](https://stackoverflow.com/questions/425087/how-to-write-this-nested-linq-to-xml-query)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T16:09:33.827

1）这些描述对我来说听起来很准确。有时匿名方法和 lambda 表达式需要创建一个新类型来放入委托的目标，因此它们可以充当[闭包](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)。

2/3）我会读一点，直到您对委托、匿名方法和 lambda 表达式感到满意为止。我用一章专门介绍 C# 2.0 和 C# 3.0 在 C# 中与委托相关的更改，当然其他书籍也会详细介绍。我也有[一篇文章](http://pobox.com/~skeet/csharp/events.html)，如果有帮助的话。

至于示例 - 代表用于许多不同的目的。它们都是看待相同功能的不同方式，但*感觉*却大不相同：

*   提供启动新线程时要调用的代码
*   对 UI 事件做出反应
*   为 LINQ 查询提供过滤器、选择、排序等
*   在异步操作完成时提供回调

如果您有任何特定情况想要举个例子，那将更容易回答。

编辑：我应该指出，您目前只使用 LINQ to Objects 和 LINQ to XML，这是个好消息，因为这意味着您还不需要了解表达式树。（它们很酷，但一步一步......）LINQ to XML 实际上只是一个与 LINQ 很好地配合使用的 XML API - 据我所知，您将使用委托与 LINQ to XML 的唯一时间是您实际上是在调用 LINQ to Objects。（诚​​然，这样做非常好——但这意味着你可以重用你已经学过的东西。）

由于您已经深入了解了 C#，第 10 章和第 11 章提供了很多在 LINQ 中*使用*lambda 表达式（以及被转换为 lambda 表达式的查询表达式）的示例。第 5 章有几个不同的委托使用示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:10:14.247

读这个...

[http://linqinaction.net/](http://linqinaction.net)

..所有你的问题都会得到解答！！！

# html - 如何防止滚动条与内容重叠？

> ID：439553
> 
> 赞同：13
> 
> 时间：2009-01-13T16:04:02.260
> 
> 标签：html, css, internet-explorer, internet-explorer-7

我有一块预先格式化的代码 (<pre>)，它水平溢出，所以有一个水平滚动条允许用户查看内容。

```
overflow: auto; 
```

但是，在 IE7（可能是其他 IE 版本）中，滚动条与我的内容的最后一行重叠（当只有一行内容时尤其烦人）。

[我已经尝试过此处](http://browservulsel.blogspot.com/2005/04/ie-overflow-auto-scrollbar-overlap.html)列出的解决方案，但没有奏效。

唯一有效的解决方案是使用

```
overflow: scroll; 
```

这为我所有预格式化的部分添加了一个滚动条，这太糟糕了。

注意：它在 Firefox 3 和 Google Chrome 中运行良好。

* * *

**更新**

我找到了一个解决方案（请参阅我的答案），但如果有人找到一种方法，在 IE7 的每个预格式化部分中都没有丑陋的填充，那将是完美的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T16:18:23.777

就在发布问题后，我想检查stackoverflow是否处理了这个问题（确实如此）。

我查看了样式表并发现了这一点：

```
padding-bottom: 19px!ie7; 
```

（嗯，他们使用 20px，但 19 看起来更好）。

它只为 IE7 添加了底部填充，这使得每个没有滚动条的预格式化部分看起来有点奇怪，因为填充很大，但至少我可以看到内容（在 stackoverflow 上看起来也很奇怪）。

很抱歉问得太快了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T18:02:08.293

将 'padding-bottom:20px' 添加到 pre 标签

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:09:48.850

`PRE`用`DIV`一些额外的边距包裹你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:25:15.947

将您包裹`PRE`在 a 中`DIV`并将其`overflow: scroll;`应用于`DIV`. 确保您使用其中一个`<div style="overflow: scroll; width='...'; height='...';">`或为 div 分配一个类，以确保不是所有的 div 都有滚动条。

例如，在我的博客中，我使用`<div style="overflow: scroll; width: 100%;">`了一小段代码，以便人们可以水平滚动并且 div 将增长到正确的高度。对于较长的部分，我还指定了一个高度，以减少整篇文章的长度；人们也可以垂直滚动。

您也可以尝试`<div style="overflow: scroll; overflow-y: hidden; width: 100%;">`只获得一个水平滚动条（而不是两者，其中一个被禁用）。也许`<div style="overflow-x: scroll; width: 100%;">`也有效。

# c++ - 匹配 {if cond}foo{else}bar{/if} 的正则表达式

> ID：439561
> 
> 赞同：0
> 
> 时间：2009-01-13T16:05:47.373
> 
> 标签：c++, regex, boost, smarty

我很难丢弃我不想要的表达部分，并保留我做的部分。

问题是 - 给定输入字符串：

```
{if cond}foo{else}bar{/if} 
```

我只想拥有：

```
0: {if cond}foo{else}bar{/if}
1: cond
2: foo
3: bar 
```

对于输入字符串：

```
{if cond}foo{/if} 
```

我只想拥有：

```
0: {if cond}foo{else}bar{/if}
1: cond
2: foo
3: 
```

我目前拥有的正则表达式如下所示：

```
\{if ([a-z0-9]+)\}([^\{]*?)(((?:\{else\})?)(.*?)?)\{/if\} 
```

我得到以下数据：

```
0: {if cond}foo{else}bar{/if}
1: cond
2:
3: foo{else}bar
4:
5: foo{else}bar 
```

这将需要进一步解析该`foo{else}bar`位以获取相应的值。

我的正则表达式是否接近？

我不太担心这可能会溢出的数据类型 - 包括`{`在 if 语句的主体中允许破坏正则表达式。`foo`和的值`bar`可以是任何不包括`{`.

谢谢，

多姆

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T16:21:47.203

这应该工作：

```
{if\s+([^}]*)}([^{]*)(?:{else}([^{]*))?{/if} 
```

根据您的需要逃脱它

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:22:07.840

那这个呢？

```
\{if ([a-z0-9]+)\}([^\{]*)(?:\{else\})?([^\{]*)\{/if\} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:29:30.370

[正则表达式测试器](http://www.programmersheaven.com/webtools/RegEx/Regextool.aspx)。它使用 .NET 正则表达式引擎，但它可能会派上用场。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T12:07:58.313

在您的问题中说明了这一点，但从标签看来，您使用的是 Boost C++ 库。

也许您也有兴趣查看 Boost.Spirit 库（包含在 Boost 中）。Spirit.Qi 允许您解析复杂的数据，而语法看起来像 EBNF。而伴随的 Spirit.Karam 允许定义输出格式，同样在 EBNF 类似的语法中。

使用这个库，您可以从模板文档生成 AST，对其进行操作，然后生成输出文档。

除了[Boost.Spirit 的文档之外](http://www.boost.org/doc/libs/1_37_0/libs/spirit/doc/html/spirit/introduction.html)，还有一些 [2007 年](http://spirit.svn.sourceforge.net/svnroot/spirit/trunk/final/libs/spirit/doc/_temp_/auxiliary)和[2008 年](http://spirit.svn.sourceforge.net/svnroot/spirit/trunk/final/libs/spirit/doc/auxiliary/)的幻灯片，它们给出了相当好的介绍。

# c++ - C/C++ 中的字典类实现（更新信息）

> ID：439572
> 
> 赞同：0
> 
> 时间：2009-01-13T16:07:20.133
> 
> 标签：c++, c, dictionary

有没有人有关于如何在 C 或 C++ 中安装相当于 Dictionary (VB6) 的信息或示例？
此实现用于作为称为 DLL VB6 的参数传递。

我的意图是在 C 中创建一个字典（使用 VARIANT/ARRAY 等的 win32）并将其传递给调用 VB。所以我必须学习如何创建这个数据结构。

坦克。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T16:08:19.337

[地图](http://www.cplusplus.com/reference/stl/map/)怎么样？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T16:21:23.147

下一个版本的 C++ 将有`unordered_map<>`（显然他们认为调用它`hash_map`会与太多的独立实现冲突），这将是一个基于哈希的容器。

它被添加到 Boost 中，并且很可能在 TR1 中。与往常一样，如果您的开发系统不支持新的标准功能，我推荐使用 Boost。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T16:17:11.673

字典是基于哈希的，地图是基于树的容器。我认为 tr1 添加了某种哈希容器，但在很多平台上你可以使用[hash_map](http://www.sgi.com/tech/stl/hash_map.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T16:08:20.787

你的意思是`std::map`在[地图](http://www.cplusplus.com/reference/stl/map/)标题之外？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T20:16:33.000

哈希表？您可以在 C 中找到几个现有的哈希表包，例如：

*   [Glib](http://library.gnome.org/devel/glib/stable/glib-Hash-Tables.html)非常常见，[有据可查](http://library.gnome.org/devel/glib/stable/glib-Hash-Tables.html)且易于使用。
*   [哈希](http://freshmeat.net/projects/hashit/)
*   [朱迪](http://judy.sourceforge.net/)

您还可以使用为永久存储而制作的软件包，因为有些人可以选择将所有内容保存在内存中以提高速度。

*   [HamsterDB](http://hamsterdb.com/) “内存数据库”，选项 HAM_IN_MEMORY_DB
*   [BerkeleyDB](http://www.oracle.com/technology/products/berkeley-db/db/index.html)，可以通过[关闭缓冲](http://www.oracle.com/technology/products/berkeley-db/faq/db_faq.html#34)或不指定文件来实现（“可以通过将文件参数设置为 NULL 来创建从不打算保留在磁盘上的内存数据库。”）

# c++ - 如何将单个char转换为int

> ID：439573
> 
> 赞同：65
> 
> 时间：2009-01-13T16:07:35.703
> 
> 标签：c++, char

我有一串数字，例如“123456789”，我需要提取每个数字以在计算中使用它们。我当然可以通过索引访问每个 char，但是如何将它转换为 int？

我研究了 atoi()，但它需要一个字符串作为参数。因此，我必须将每个字符转换为字符串，然后在其上调用 atoi。有没有更好的办法？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2009-01-13T16:10:44.027

您可以利用数字的字符编码都是从 48（对于“0”）到 57（对于“9”）的顺序这一事实。这适用于 ASCII、UTF-x 和几乎所有其他编码（*有关此内容的更多信息，请参见下面的评论*）。

因此，任何数字的整数值都是数字减去“0”（或 48）。

```
char c = '1';
int i = c - '0'; // i is now equal to 1, not '1' 
```

是同义词

```
char c = '1';
int i = c - 48; // i is now equal to 1, not '1' 
```

但是我发现第一个`c - '0'`更具可读性。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-12-08T14:50:53.253

```
#define toDigit(c) (c-'0') 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-13T17:03:52.250

或者您可以使用“正确”方法，类似于您原来的 atoi 方法，但使用 std::stringstream 代替。这应该使用字符作为输入以及字符串。（boost::lexical_cast 是更方便语法的另一个选项）

（atoi 是一个旧的 C 函数，通常建议尽可能使用更灵活和类型安全的 C++ 等效项。std::stringstream 涵盖与字符串的转换）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-07-19T10:52:18.367

### 您可以使用 atoi() 函数

```
#include <stdlib.h>
#include <stdio.h>
int main(int argc, char* argv[]){
    int num ;
    num = atoi(argv[1]);
    printf("\n%d", num);
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-15T13:44:38.957

只要您只想处理阿拉伯数字，并且在这些数字是连续的并且与 ASCII 位于同一位置的编码中工作，所提供的答案就很好。

几乎总是这样。

如果不是，那么您需要一个适当的库来帮助您。

让我们从[ICU](http://site.icu-project.org/)开始。

1.  首先将字节字符串转换为 unicode 字符串。（留给读者练习）。
2.  然后使用[uchar.h](http://icu-project.org/apiref/icu4c/uchar_8h.html)查看每个字符。
3.  如果我们的角色是`UBool u_isdigit (UChar32 c)`
4.  那么值是`int32_t u_charDigitValue ( UChar32 c )`

或者也许 ICU 有一些功能可以为你做这件事——我没有详细看过它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-01T16:51:00.197

```
#include<iostream>
#include<stdlib>
using namespace std;

void main()
{
     char ch;
     int x;
     cin >> ch;
     x = char (ar[1]);
     cout << x;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T16:22:22.707

如果您*担心*编码，您可以随时使用 switch 语句。

请注意保存这些大数字的格式。在某些系统中，整数的最大大小低至 65,535（32,767 有符号）。其他系统，你有 2,147,483,647（或 4,294,967,295 未签名）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T13:20:35.820

以下方法有什么问题吗？

```
int CharToInt(const char c)
{
    switch (c)
    {
    case '0':
        return 0;
    case '1':
        return 1;
    case '2':
        return 2;
    case '3':
        return 3;
    case '4':
        return 4;
    case '5':
        return 5;
    case '6':
        return 6;
    case '7':
        return 7;
    case '8':
        return 8;
    case '9':
        return 9;
    default:
        return 0;
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-01-03T16:51:54.057

通过这种方式，您可以轻松地将 char 转换为 int 并将 int 转换为 char：

```
int charToInt(char c)
{
   int arr[]={0,1,2,3,4,5,6,7,8,9};
   return arr[c-'0'];
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-07-26T16:13:17.900

我同意@jalf。使用[sstream](http://www.cplusplus.com/reference/sstream/stringstream/)库和[stoi](https://www.cplusplus.com/reference/string/stoi/)似乎是推荐的方法：

```
#include <iostream>
#include <string>
#include <sstream>

using namespace std;

int main() {

  stringstream st;
  st << 1  << '2';

  cout << stoi(st.str()) + 1; 

  return 0;
} 
```

# 输出

```
13 
```

我是 C++ 的新学生，但长期从事 LAMP 堆栈开发。我希望字符串类有更多的东西可以在字符和字符串之间平滑过渡，但我还没有找到原生支持的东西。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2018-10-18T07:29:56.613

对我来说，以下工作非常好：

```
QChar c = '5';
int x = c.digitValue();
// x is now 5 
```

文档：[int QChar::digitValue() const](http://doc.qt.io/qt-5/qchar.html#digitValue)它说：

> 返回数字的数值，如果字符不是数字，则返回 -1。

# refactoring - 重构具有太多（6+）参数的方法的最佳方法是什么？

> ID：439574
> 
> 赞同：118
> 
> 时间：2009-01-13T16:07:40.773
> 
> 标签：refactoring

偶尔我会遇到参数数量令人不安的方法。通常，它们似乎是构造函数。似乎应该有更好的方法，但我看不出它是什么。

```
return new Shniz(foo, bar, baz, quux, fred, wilma, barney, dino, donkey) 
```

我曾想过使用结构来表示参数列表，但这似乎只是将问题从一个地方转移到另一个地方，并在此过程中创建另一种类型。

```
ShnizArgs args = new ShnizArgs(foo, bar, baz, quux, fred, wilma, barney, dino, donkey)
return new Shniz(args); 
```

所以这似乎不是一个改进。那么最好的方法是什么？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-01-13T22:16:50.777

我假设你的意思是**C#**。其中一些内容也适用于其他语言。

你有几个选择：

**从构造函数切换到属性设置器**。这可以使代码更具可读性，因为对于读者来说，哪个值对应哪个参数是显而易见的。对象初始化器语法使这看起来不错。它也很容易实现，因为您可以只使用自动生成的属性并跳过编写构造函数。

```
class C
{
    public string S { get; set; }
    public int I { get; set; }
}

new C { S = "hi", I = 3 }; 
```

但是，您失去了不变性，并且失去了确保在编译时使用对象之前设置所需值的能力。

**生成器模式**。

想想 和 之间的`string`关系`StringBuilder`。您可以为自己的课程获取此信息。我喜欢将它实现为一个嵌套类，所以类`C`有相关的类`C.Builder`。我也喜欢构建器上的流畅界面。做对了，你可以得到这样的语法：

```
C c = new C.Builder()
    .SetX(4)    // SetX is the fluent equivalent to a property setter
    .SetY("hello")
    .ToC();     // ToC is the builder pattern analog to ToString()

// Modify without breaking immutability
c = c.ToBuilder().SetX(2).ToC();

// Still useful to have a traditional ctor:
c = new C(1, "...");

// And object initializer syntax is still available:
c = new C.Builder { X = 4, Y = "boing" }.ToC(); 
```

我有一个 PowerShell 脚本，可以让我生成构建器代码来完成所有这些工作，其中输入如下所示：

```
class C {
    field I X
    field string Y
} 
```

所以我可以在编译时生成。 `partial`类让我在不修改生成的代码的情况下扩展主类和构建器。

**“引入参数对象”重构**。请参阅[重构目录](http://www.refactoring.com/catalog/introduceParameterObject.html)。这个想法是，您获取一些您正在传递的参数并将它们放入一个新类型，然后传递该类型的一个实例。如果你不加思索地这样做，你最终会回到你开始的地方：

```
new C(a, b, c, d); 
```

变成

```
new C(new D(a, b, c, d)); 
```

但是，这种方法最有可能对您的代码产生积极影响。因此，请继续执行以下步骤：

1.  寻找一起有意义的参数*子集。*只是漫不经心地将函数的所有参数组合在一起并不能让你得到太多。目标是进行有意义的分组。 **当新类型的名称很明显时，您就会知道您做对了。**

2.  寻找这些值一起使用的其他地方，并在那里也使用新类型。很有可能，当您为已经在各处使用的一组值找到了一个很好的新类型时，这种新类型也将在所有这些地方都有意义。

3.  寻找现有代码中但属于新类型的功能。

例如，您可能会看到如下代码：

```
bool SpeedIsAcceptable(int minSpeed, int maxSpeed, int currentSpeed)
{
    return currentSpeed >= minSpeed & currentSpeed < maxSpeed;
} 
```

您可以采用`minSpeed`and`maxSpeed`参数并将它们放入新类型：

```
class SpeedRange
{
   public int Min;
   public int Max;
}

bool SpeedIsAcceptable(SpeedRange sr, int currentSpeed)
{
    return currentSpeed >= sr.Min & currentSpeed < sr.Max;
} 
```

这更好，但要真正利用新类型，请将比较移动到新类型中：

```
class SpeedRange
{
   public int Min;
   public int Max;

   bool Contains(int speed)
   {
       return speed >= min & speed < Max;
   }
}

bool SpeedIsAcceptable(SpeedRange sr, int currentSpeed)
{
    return sr.Contains(currentSpeed);
} 
```

*现在*我们到达了某个地方：now 的实现说明`SpeedIsAcceptable()`了您的意思，并且您拥有了一个有用的、可重用的类。（下一个明显的步骤是进入`SpeedRange`。`Range<Speed>`）

如您所见，Introduce Parameter Object 是一个好的开始，但它的真正价值在于它帮助我们发现了模型中缺少的有用类型。

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2009-01-13T16:10:40.080

最好的方法是找到将论点组合在一起的方法。这假设并且实际上仅在您最终会得到多个参数“分组”的情况下才有效。

例如，如果您要传递一个矩形的规范，您可以传递 x、y、宽度和高度，或者您可以只传递一个包含 x、y、宽度和高度的矩形对象。

在重构时寻找类似的东西来清理它。如果这些论点真的无法结合起来，那就开始看看你是否违反了单一责任原则。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-13T16:12:26.333

如果它是一个构造函数，特别是如果有多个重载的变体，你应该看看 Builder 模式：

```
Foo foo = new Foo()
          .configBar(anything)
          .configBaz(something, somethingElse)
          // and so on 
```

如果是普通方法，您应该考虑传递的值之间的关系，并可能创建一个传输对象。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-13T16:12:27.347

对此的经典答案是使用类来封装部分或全部参数。理论上这听起来不错，但我是那种为在领域中有意义的概念创建类的人，所以应用这个建议并不总是那么容易。

例如，而不是：

```
driver.connect(host, user, pass) 
```

你可以使用

```
config = new Configuration()
config.setHost(host)
config.setUser(user)
config.setPass(pass)
driver.connect(config) 
```

YMMV

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-13T16:36:30.107

这引自 Fowler 和 Beck 的书：“重构”

> 长参数列表
> 
> 在我们早期的编程时代，我们被教导将例程所需的所有内容作为参数传递。这是可以理解的，因为替代方案是全局数据，而全局数据是邪恶的并且通常是痛苦的。对象改变了这种情况，因为如果您没有需要的东西，您可以随时要求另一个对象为您获取它。因此，对于对象，您不会传入方法所需的所有内容；相反，您传递了足够的信息，以便该方法可以获取所需的一切。方法所需的很多东西都可以在方法的宿主类中找到。在面向对象的程序中，参数列表往往比传统程序中的小得多。这很好，因为长参数列表很难理解，因为它们变得不一致且难以使用，并且因为您需要更多数据时会永远更改它们。大多数更改都是通过传递对象来删除的，因为您更有可能只需要发出几个请求即可获取新数据。当您可以通过对您已经知道的对象发出请求来获取一个参数中的数据时，请使用 Replace Parameter with Method。该对象可能是一个字段，也可能是另一个参数。使用 Preserve Whole Object 获取从对象中收集的一堆数据并将其替换为对象本身。如果您有多个没有逻辑对象的数据项，请使用 Introduce Parameter Object。进行这些更改有一个重要的例外。这是当您明确不想创建从被调用对象到较大对象的依赖关系时。在这些情况下，解包数据并将其作为参数发送是合理的，但要注意所涉及的痛苦。如果参数列表太长或更改太频繁，您需要重新考虑您的依赖结构。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-01-20T17:48:10.990

当我看到长长的参数列表时，我的第一个问题是这个函数或对象是否做得太多。考虑：

```
EverythingInTheWorld earth=new EverythingInTheWorld(firstCustomerId,
  lastCustomerId,
  orderNumber, productCode, lastFileUpdateDate,
  employeeOfTheMonthWinnerForLastMarch,
  yearMyHometownWasIncorporated, greatGrandmothersBloodType,
  planetName, planetSize, percentWater, ... etc ...); 
```

当然这个例子是故意荒谬的，但我见过很多真实的程序，其中的例子稍微不那么荒谬，其中一个类用于保存许多几乎不相关或不相关的东西，显然只是因为同一个调用程序需要两者，或者因为程序员碰巧同时想到了两者。有时，简单的解决方案是将类分解为多个部分，每个部分都做自己的事情。

稍微复杂一点的是，当一个类确实需要处理多个逻辑事物时，比如客户订单和有关客户的一般信息。在这些情况下，为客户创建一个类和为订单创建一个类，并让它们在必要时相互交谈。所以而不是：

```
 Order order=new Order(customerName, customerAddress, customerCity,
   customerState, customerZip,
   orderNumber, orderType, orderDate, deliveryDate); 
```

我们可以有：

```
Customer customer=new Customer(customerName, customerAddress,
  customerCity, customerState, customerZip);
Order order=new Order(customer, orderNumber, orderType, orderDate, deliveryDate); 
```

虽然我当然更喜欢只接受 1 个或 2 个或 3 个参数的函数，但有时我们不得不接受，实际上，这个函数需要一堆参数，并且本身的数量并不会真正造成复杂性。例如：

```
Employee employee=new Employee(employeeId, firstName, lastName,
  socialSecurityNumber,
  address, city, state, zip); 
```

是的，这是一堆字段，但可能我们要做的只是将它们保存到数据库记录或将它们扔到屏幕上或类似的地方。这里没有太多的处理。

当我的参数列表确实变得很长时，我更愿意为字段提供不同的数据类型。就像我看到这样的功能：

```
void updateCustomer(String type, String status,
  int lastOrderNumber, int pastDue, int deliveryCode, int birthYear,
  int addressCode,
  boolean newCustomer, boolean taxExempt, boolean creditWatch,
  boolean foo, boolean bar); 
```

然后我看到它被称为：

```
updateCustomer("A", "M", 42, 3, 1492, 1969, -7, true, false, false, true, false); 
```

我开始担心。看着电话，根本不清楚所有这些神秘的数字、代码和标志的含义。这只是要求错误。程序员可能很容易对参数的顺序感到困惑并意外地切换了两个，如果它们是相同的数据类型，编译器就会接受它。我宁愿有一个所有这些东西都是枚举的签名，所以调用会传入诸如 Type.ACTIVE 而不是“A”和 CreditWatch.NO 而不是“false”等内容。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-13T16:19:26.707

我不想听起来像个聪明人，但您还应该检查以确保您传递的数据*确实*应该被传递：将东西传递给构造函数（或与此相关的方法）闻起来有点像很少强调对象的*行为*。

不要误会我的意思：方法和构造函数有时*会有*很多参数。但是当遇到时，请尝试考虑用*行为来封装**数据*。

 *这种气味（因为我们正在谈论重构，这个可怕的词似乎很合适......）也可能会检测到具有很多（阅读：任何）属性或 getter/setter 的对象。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-13T16:23:37.027

如果某些构造函数参数是可选的，则使用构建器是有意义的，它将在构造函数中获取所需的参数，并为可选参数提供方法，返回构建器，如下所示：

```
return new Shniz.Builder(foo, bar).baz(baz).quux(quux).build(); 
```

详细信息在 Effective Java, 2nd Ed., p. 中描述。11\. 对于方法参数，同一本书 (p. 189) 描述了缩短参数列表的三种方法：

*   将方法分解为多个参数较少的方法
*   创建静态助手成员类来表示参数组，即传递 a`DinoDonkey`而不是`dino`和`donkey`
*   如果参数是可选的，方法可以采用上面的builder，为所有参数定义一个对象，设置需要的，然后在其上调用一些execute方法

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-13T16:18:56.943

我会使用默认的构造函数和属性设置器。C# 3.0 有一些很好的语法可以自动执行此操作。

```
return new Shniz { Foo = foo,
                   Bar = bar,
                   Baz = baz,
                   Quuz = quux,
                   Fred = fred,
                   Wilma = wilma,
                   Barney = barney,
                   Dino = dino,
                   Donkey = donkey
                 }; 
```

代码改进在于简化构造函数，并且不必支持多种方法来支持各种组合。“调用”语法仍然有点“罗嗦”，但并不比手动调用属性设置器更糟糕。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-01-13T22:41:48.230

您没有提供足够的信息来保证一个好的答案。一个长的参数列表本质上并不坏。

> Shniz（foo、bar、baz、quux、fred、wilma、barney、dino、donkey）

可以解释为：

```
void Shniz(int foo, int bar, int baz, int quux, int fred, 
           int wilma, int barney, int dino, int donkey) { ... 
```

在这种情况下，您最好创建一个类来封装参数，因为您以编译器可以检查的方式赋予不同参数的含义，并在视觉上使代码更易于阅读。它还使以后更容易阅读和重构。

```
// old way
Shniz(1,2,3,2,3,2,1,2);
Shniz(1,2,2,3,3,2,1,2); 

//versus
ShnizParam p = new ShnizParam { Foo = 1, Bar = 2, Baz = 3 };
Shniz(p); 
```

或者，如果您有：

```
void Shniz(Foo foo, Bar bar, Baz baz, Quux quux, Fred fred, 
           Wilma wilma, Barney barney, Dino dino, Donkey donkey) { ... 
```

这是一个完全不同的情况，因为所有对象都是不同的（并且不太可能混淆）。同意如果所有对象都是必需的，并且它们都是不同的，那么创建参数类就没有什么意义了。

另外，有些参数是可选的吗？是否有方法覆盖（相同的方法名称，但不同的方法签名？）这些细节对于*最佳*答案是什么都很重要。

* 属性包也很有用，但考虑到没有给出背景，并不是特别好。

如您所见，这个问题有不止 1 个正确答案。任你选。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-13T16:11:24.197

您可以尝试将参数分组为多个有意义的结构/类（如果可能）。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-13T16:11:45.723

我通常倾向于使用结构方法 - 大概这些参数中的大多数以某种方式相关，并代表与您的方法相关的某些元素的状态。

如果参数集不能变成有意义的对象，那可能`Shniz`是做太多的迹象，重构应该包括将方法分解为单独的关注点。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-13T16:18:16.490

您可以用复杂性换取源代码行。如果方法本身做的太多（瑞士刀）尝试通过创建另一个方法将其任务减半。如果方法很简单，只是它需要太多参数，那么所谓的参数对象就是要走的路。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-13T18:21:47.710

如果您的语言支持它，请使用命名参数并尽可能多地设置可选参数（具有合理的默认值）。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-13T21:28:23.183

如果您有这么多参数，则可能是该方法做得太多，因此首先通过将方法拆分为几个较小的方法来解决此问题。如果在此之后您仍然有太多参数，请尝试将参数分组或将一些参数转换为实例成员。

更喜欢小类/方法而不是大类。记住单一责任原则。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-01-13T16:11:27.630

我认为你描述的方法是要走的路。当我发现一个方法有很多参数和/或将来可能需要更多参数时，我通常会创建一个 ShnizParams 对象来传递，就像你描述的那样。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-13T16:15:45.153

如何不在构造函数中一次性设置它，而是通过**属性/设置器进行设置**？我见过一些使用这种方法的 .NET 类，例如`Process`类：

```
 Process p = new Process();

        p.StartInfo.UseShellExecute = false;
        p.StartInfo.CreateNoWindow = true;
        p.StartInfo.RedirectStandardOutput = true;
        p.StartInfo.RedirectStandardError = true;
        p.StartInfo.FileName = "cmd";
        p.StartInfo.Arguments = "/c dir";
        p.Start(); 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-13T19:00:35.150

我同意将参数移动到参数对象（结构）中的方法。与其将它们全部放在一个对象中，不如查看其他函数是否使用类似的参数组。如果参数对象与多个函数一起使用，则参数对象更有价值，您希望该组参数在这些函数中一致地更改。可能是您只将部分参数放入新的参数对象中。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-13T22:59:34.357

命名参数是一个很好的选择（假设是一种支持它们的语言），用于消除长（甚至短！）参数列表的歧义，同时还允许（在构造函数的情况下）类的属性是不可变的，而不要求允许它存在处于半建成状态。

在进行此类重构时，我会寻找的另一个选项是相关参数组，这些参数组可能更好地作为独立对象处理。以较早答案中的 Rectangle 类为例，采用 x、y、height 和 width 参数的构造函数可以将 x 和 y 分解为 Point 对象，从而允许您将三个参数传递给 Rectangle 的构造函数。或者更进一步，使其成为两个参数（UpperLeftPoint、LowerRightPoint），但这将是更彻底的重构。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-13T16:16:38.867

这取决于你有什么样的参数，但如果它们是很多布尔值/选项，也许你可以使用标志枚举？

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-13T16:20:04.040

我认为这个问题与你试图用课堂解决的问题的领域密切相关。

在某些情况下，一个 7 参数的构造函数可能表示一个错误的类层次结构：在这种情况下，上面建议的辅助结构/类通常是一个好方法，但是你也倾向于最终得到只是属性包的结构负载并且不要做任何有用的事情。8 参数构造函数也可能表明你的类太通用/太通用，所以它需要很多选项才能真正有用。在这种情况下，您可以重构类或实现隐藏真正复杂构造函数的静态构造函数：例如。Shniz.NewBaz (foo, bar) 实际上可以调用真正的构造函数并传递正确的参数。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-01-13T16:22:03.973

一个考虑因素是，一旦创建了对象，哪些值将是只读的？

可公开写入的属性也许可以在构建后分配。

价值观最终从何而来？也许有些值确实是外部的，而其他值实际上来自库维护的某些配置或全局数据。

在这种情况下，您可以隐藏构造函数以防止外部使用，并为其提供 Create 函数。create 函数获取真正的外部值并构造对象，然后使用仅对库可用的访问器来完成对象的创建。

如果一个对象需要 7 个或更多参数来赋予对象一个完整的状态，并且所有这些参数在本质上都是真正的外部对象，这将是非常奇怪的。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-01-13T16:26:16.507

当一个 clas 的构造函数接受太多参数时，通常表明它有太多责任。它可能可以分解成单独的类，它们相互协作以提供相同的功能。

如果你真的需要构造函数的参数这么多，Builder 模式可以帮助你。目标是仍然将所有参数传递给构造函数，因此它的状态从一开始就被初始化，如果需要，您仍然可以使类不可变。

见下文 ：

```
public class Toto {
    private final String state0;
    private final String state1;
    private final String state2;
    private final String state3;

    public Toto(String arg0, String arg1, String arg2, String arg3) {
        this.state0 = arg0;
        this.state1 = arg1;
        this.state2 = arg2;
        this.state3 = arg3;
    }

    public static class TotoBuilder {
        private String arg0;
        private String arg1;
        private String arg2;
        private String arg3;

        public TotoBuilder addArg0(String arg) {
            this.arg0 = arg;
            return this;
        }
        public TotoBuilder addArg1(String arg) {
            this.arg1 = arg;
            return this;
        }
        public TotoBuilder addArg2(String arg) {
            this.arg2 = arg;
            return this;
        }
        public TotoBuilder addArg3(String arg) {
            this.arg3 = arg;
            return this;
        }

        public Toto newInstance() {
            // maybe add some validation ...
            return new Toto(this.arg0, this.arg1, this.arg2, this.arg3);
        }
    }

    public static void main(String[] args) {
        Toto toto = new TotoBuilder()
            .addArg0("0")
            .addArg1("1")
            .addArg2("2")
            .addArg3("3")
            .newInstance();
    }

} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-02-11T12:27:32.623

简短的回答是：
您需要对**相关参数进行分组**或**重新设计我们的模型**

下面的例子，构造函数有**8 个参数**

```
public Rectangle(
        int point1X,
        int point1Y,

        int point2X,
        int point2Y,

        int point3X,
        int point3Y,

        int point4X,
        int point4Y) {
    this.point1X = point1X;
    this.point1Y = point1Y;

    this.point2X = point2X;
    this.point2Y = point2Y;

    this.point3X = point3X;
    this.point3Y = point3Y;

    this.point4X = point4X;
    this.point4Y = point4Y;
} 
```

**将相关参数分组**后，
构造函数将 **只取4个参数**

```
public Rectangle(
        Point point1,
        Point point2,
        Point point3,
        Point point4) {
    this.point1 = point1;
    this.point2 = point2;
    this.point3 = point3;
    this.point4 = point4;
}

public Point(int x, int y) {
    this.x = x;
    this.y= y;
} 
```

甚至让构造函数更智能，
在 **重新设计我们的模型**
之后 ，构造函数将 **只接受 2 个参数**

```
public Rectangle(
        Point leftLowerPoint,
        Point rightUpperPoint) {
    this.leftLowerPoint = leftLowerPoint;
    this.rightUpperPoint = rightUpperPoint;
} 
```

# c++ - 以编程方式修改 Excel 电子表格的最佳方法

> ID：439580
> 
> 赞同：7
> 
> 时间：2009-01-13T16:08:48.523
> 
> 标签：c++, excel

我正在寻找一个允许我以编程方式修改 Excel 文件以将数据添加到某些单元格的库。我目前的想法是使用命名范围来确定插入新数据的位置（基本上是 1x1 的范围），然后更新命名范围以指向数据。将要与之集成的现有应用程序完全用 C++ 编写，因此我理想情况下正在寻找 C++ 解决方案（因此[该线程](https://stackoverflow.com/questions/292551/modifying-excel-spreadsheet-with-net)的用处有限）。如果一切都失败了，如果有某种方法可以将它与我们的 C++ 应用程序链接起来，我将使用 .NET 解决方案。

一个理想的解决方案是开源的，但到目前为止我所见过的解决方案（[MyXls](http://myxls.in2bits.org/)和[XLSSTREAM](http://members.wibs.at/herz/xlsstream/www/index.html)）似乎都没有应对挑战。我喜欢[Aspose.Cells](http://www.aspose.com/categories/file-format-components/aspose.cells-for-.net-and-java/default.aspx)的外观，但它适用于 .NET 或 Java，而不是 C++（而且要花钱）。我需要支持从 97 到现在的所有 Excel 格式，包括 XLSX 和 XLSB 格式。理想情况下，它还支持 OpenOffice 和（用于输出）PDF 和 HTML 等格式。

我需要支持的一些用例：

*   读取和修改电子表格中的任何单元格，包括公式
*   创建、读取、修改命名范围（范围本身，而不仅仅是单元格）
*   将格式从一个单元格复制到一堆其他单元格（包括条件格式）——我们将使用一个单元格作为我们填充数据的所有其他单元格的模板。

您能给我找到合适的图书馆的任何帮助都会很棒。我还想听听一些关于各种建议（包括我的帖子中的建议）的推荐，这样我就可以做出更明智的决定——什么易于使用、无错误、便宜等？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:15:01.053

最安全的建议是只使用 OLE。它使用 COM，根本不需要 .NET。

[http://en.wikipedia.org/wiki/OLE_Automation](http://en.wikipedia.org/wiki/OLE_Automation) <--大约一半是 C++ 示例。

为了可用性，您可能必须将一些功能包装到函数中，但使用起来并不难看。

编辑：请注意，您需要一份 Excel 副本才能正常工作。此外，您还可以找到一些特定于 excel 的第一方 .h 文件。（这一切都在维基百科文章中进行了解释）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:34:04.590

我不知道这是否适合您，但新的 office 2007 格式是压缩的 XML 格式，这使得您自己进行修改非常可行。有关规格，请参见[此处](http://msdn.microsoft.com/en-us/library/aa338205.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T17:44:16.150

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)将处理您的要求，并具有与 Excel 非常相似的 API。

当您插入单元格时，您定义的名称（以及任何其他公式/图表/等）将自动修复以引用新范围（就像它们在 Excel 中一样）。因此，您不需要更新定义的名称（尽管如果您想要这样做，则完全支持创建和更新定义的名称）。

SpreadsheetGear 是一个 .NET 组件，但您可以构建自己的可从 C++ 调用的包装器。

您可以[在此处](https://www.spreadsheetgear.com/downloads/register.aspx)[查看我们的客户所说](http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx)的并下载免费的、功能齐全的评估版。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:15:14.190

您是否已经尝试过使用 Excel COM 接口？显然Excel需要安装在机器上，处理起来很痛苦......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T16:25:25.433

我认为带有 COM 互操作的 .net 解决方案用于链接到您的 C++ 应用程序是最好的解决方案。在与他们合作的十多年中，我从未见过没有在某处泄漏内存的 Excel 的 COM 自动化。

如果您需要自动化 Excel，我推荐[Visual Studio Tools for Office](http://msdn.microsoft.com/en-us/office/aa905533.aspx)。如果您不需要自动化，只修改文件并且这些文件可以是 Office 2007 格式，那么您最好找到一个可以直接操作文件的库，而不是打开 Excel 来进行操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-18T15:32:17.140

正如我在原始帖子中提到的那样，我最终使用了 Aspose.Cells，因为它似乎是最简单的路径。我对结果非常满意，他们的支持非常好。我必须在 C# 中创建一个包装器，将 COM 接口导出到我的 C++ 应用程序。

# .net - 打印多页不同的数据

> ID：439591
> 
> 赞同：3
> 
> 时间：2009-01-13T16:10:54.867
> 
> 标签：.net, printing

在我的应用程序中，我有几种打印特定数据的表单。为此，我使用 PrintDocument PrintPage 事件。

如果一个报告超过 1 页，我将 hasMorePages 标志设置为 true，然后再次触发事件，我有责任从最后一页末尾的位置继续打印。

现在，我需要在 ONE PrintDocument 中打印所有这些报表，并且我想重用每个报表的代码，以便用户在一个打印按钮中打印所有报表。这个想法是不打印多个文档。

你会采取什么方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T16:35:01.403

虽然我不太喜欢它的感觉，但显而易见的解决方案是制作一个打印事件，它是其他打印事件的聚合器。您连接到文档打印事件，并且对于需要打印的每个项目，您手动触发其打印事件。

我想你会想要制作一个像 IPrintableForm 这样的接口，它有一个方法 DoPrintEvent(object sender, PrintPageEventArgs args);

然后你的聚合器得到一堆需要打印的表单并将其存储在一个实例变量中，并执行以下操作：

```
private multiDocPageEventHandler(object sender, PrintPageEventArgs args)
{
    if (printStack == null) { // all done
        throw new Exception("This should never happen.");
    }
    else { // send to top of stack
        printStack.Peek().DoPrintEvent(sender, args);
        if (!args.HasMorePages) {
             printStack.Pop();
        }
        args.HasMorePages = printStack.Count > 0;
        if (!args.HasMorePages) {
            printStack = null;
        }
    }
} 
```

# linq-to-sql - 如何检查 LINQ to SQL EntitySet 上的删除

> ID：439611
> 
> 赞同：2
> 
> 时间：2009-01-13T16:14:32.037
> 
> 标签：linq-to-sql

我有一个实体，它在 EntitySet 中具有关联实体的集合。最后，我试图报告对该实体所做的一些更改。我很可能会使用 GetModifiedMembers() 方法来执行此操作，我猜我可以对 EntitySet 中的每个实体执行相同的操作，但我不确定如何判断该 EntitySet 中是否有任何删除.

最好的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T16:52:39.463

您可以使用`dataContext.GetChangeSet()`来跟踪所有更改的实体并过滤特定`T`实体。请看看这是不是你想要的：

```
 public static void ShowModifiedEntitiesInfo<T>(DataContext context) where T : class
    {
        foreach (var entity in context.GetChangeSet().Updates.Where(del => del is T).Cast<T>())
        {
            ModifiedMemberInfo[] modifiedMembers = context.GetTable<T>().GetModifiedMembers(entity);
            Console.WriteLine("Updated Entity: " + entity.ToString());
            Console.WriteLine("     (Members Changed)");
            foreach (var member in modifiedMembers)
            {
                Console.WriteLine("     - Member Name: " + member.Member.Name);
                Console.WriteLine("     - Original Value: " + member.OriginalValue.ToString());
                Console.WriteLine("     - Current Value: " + member.CurrentValue.ToString());
            }
        }
        foreach (var entity in context.GetChangeSet().Inserts.Where(del => del is T).Cast<T>())
        {
            Console.WriteLine("Inserted Entity: " + entity.ToString());
        }
        foreach (var entity in context.GetChangeSet().Deletes.Where(del => del is T).Cast<T>())
        {
            Console.WriteLine("Deleted Entity: " + entity.ToString());
        }
    } 
```

**编辑：**

你需要这样的东西吗？

```
 public static void ShowModifiedCustomerInfo(MyDataContext context, Customer customer)
    {
        ModifiedMemberInfo[] modifiedMembers = context.Customers.GetModifiedMembers(customer);

        List<Order> updatedOrders = context.GetChangeSet().Updates.Where(e => e is Order).Cast<Order>().Intersect<Order>(customer.Orders).ToList<Order>();

        List<Order> insertedOrders = context.GetChangeSet().Inserts.Where(e => e is Order).Cast<Order>().Intersect<Order>(customer.Orders).ToList<Order>();

        List<Order> deletedOrders = context.GetChangeSet().Deletes.Where(e => e is Order).Cast<Order>().Intersect<Order>(customer.Orders).ToList<Order>();

        if (modifiedMembers.Length > 0 || updatedOrders.Count > 0 || insertedOrders.Count > 0 || deletedOrders.Count > 0)
        {
            Console.WriteLine("Updated Customer: " + customer.ToString());

            foreach (var member in modifiedMembers)
            {
                Console.WriteLine("     - Member Name: " + member.Member.Name);
                Console.WriteLine("     - Original Value: " + member.OriginalValue.ToString());
                Console.WriteLine("     - Current Value: " + member.CurrentValue.ToString());
            }

            foreach (var entity in updatedOrders)
            {
                Console.WriteLine("     Updated Order: " + entity.ToString());
            }

            foreach (var entity in insertedOrders)
            {
                Console.WriteLine("     Inserted Order: " + entity.ToString());
            }

            foreach (var entity in deletedOrders)
            {
                Console.WriteLine("     Deleted Order: " + entity.ToString());
            }
        }
    } 
```

是`Customer`实体并具有`EntitySet<Order>`. 据我了解，您知道客户本身是否发生了变化，以及该客户的任何订单是否也发生了变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-29T03:24:35.463

CodeSmith 的 PLINQO 捕获在执行 SubmitChanges 时所做的所有更改，并将其全部打包到可以从上下文 LastAudit 属性访问的 Audit 对象中。报告发生了什么变化以及它是什么类型的更新。[http://plinqo.com/home.ashx?NoRedirect=1#Auditing_18](http://plinqo.com/home.ashx?NoRedirect=1#Auditing_18)有一个示例

# c# - 如何将枚举集合发送到 WCF 服务

> ID：439612
> 
> 赞同：3
> 
> 时间：2009-01-13T16:14:40.507
> 
> 标签：c#, wcf, collections, enums

我无法将枚举集合发送到 WCF 服务方法。我以这篇文章为指导：[与 WCF 服务共享枚举](https://stackoverflow.com/questions/187505/sharing-enum-with-wcf-service)

```
[ServiceContract]
[ServiceKnownType(typeof(MyEnum))]
[ServiceKnownType(typeof(List<MyEnum>))]
public interface IMyService{    
  [OperationContract]    
  MyEnum ServiceMethod1( );

  [OperationContract]    
  IList<MyEnum> ServiceMethod2( );

  [OperationContract]    
  IList<MyEnum> ServiceMethod3( MyEnum e );

  [OperationContract]    
  IList<MyEnum> ServiceMethod4( IList<MyEnum> e );
}

[Serializable]
[DataContract]
public enum MyEnum{ 
  [EnumMember] red, 
  [EnumMember] green, 
  [EnumMember] blue 
}; 
```

ServiceMethod1、ServiceMethod2 和 ServiceMethod3 工作正常。尝试将枚举列表发送到 ServiceMethod4 时出现以下错误。

```
Operation 'ServiceMethod4' in contract 'IMyService' has a query variable named 'e' of type 'System.Collections.Generic.IList`1[MyEnum]', but type 'System.Collections.Generic.IList`1[MyEnum]' is not convertible by 'QueryStringConverter'.  Variables for UriTemplate query values must have types that can be converted by 'QueryStringConverter'. 
```

我需要创建自定义 QueryStringConverter 吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T17:13:03.807

你的配置文件是什么样的？听起来您可能正在使用`webHttpBinding`不支持的元素，`IList<MyEnum>`因为它不可能在 URL 上表示。

您应该考虑使用 a `basicHttpBinding`，因为它使用 SOAP。使用 SOAP 将允许您序列化`IList<MyEnum>`并将其发送到您的`OperationContract`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T22:43:59.117

将该参数键入为 MyEnum 数组是否可以接受？然后在您的实现中使用 var eList = new List(e); 或者，您可以尝试使用 KnownType 帮助器类，如下所述：http: [//msdn.microsoft.com/en-us/library/system.servicemodel.serviceknowntypeattribute.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.serviceknowntypeattribute.aspx)

# c# - 使用 .NET Process.Start 运行时挂起进程——出了什么问题？

> ID：439617
> 
> 赞同：30
> 
> 时间：2009-01-13T16:15:53.640
> 
> 标签：c#, processstartinfo

我在 svn.exe 周围编写了一个快速而肮脏的包装器来检索一些内容并对其进行处理，但对于某些输入，它偶尔且可重现地挂起并且无法完成。例如，一个调用是 svn list：

```
svn list "http://myserver:84/svn/Documents/Instruments/" --xml  --no-auth-cache --username myuser --password mypassword 
```

当我只是从命令外壳执行此命令行时，它运行良好，但它挂在我的应用程序中。我运行它的 c# 代码是：

```
string cmd = "svn.exe";
string arguments = "list \"http://myserver:84/svn/Documents/Instruments/\" --xml  --no-auth-cache --username myuser --password mypassword";
int ms = 5000;
ProcessStartInfo psi = new ProcessStartInfo(cmd);
psi.Arguments = arguments;
psi.RedirectStandardOutput = true;
psi.WindowStyle = ProcessWindowStyle.Normal;
psi.UseShellExecute = false;
Process proc = Process.Start(psi);
StreamReader output = new StreamReader(proc.StandardOutput.BaseStream, Encoding.UTF8);

proc.WaitForExit(ms);
if (proc.HasExited)
{
    return output.ReadToEnd();
} 
```

这需要完整的 5000 毫秒并且永远不会完成。延长时间没有用。在单独的命令提示符下，它会立即运行，所以我很确定它与等待时间不足无关。然而，对于其他输入，这似乎工作正常。

我还尝试在这里运行一个单独的 cmd.exe（其中 exe 是 svn.exe 并且 args 是原始 arg 字符串），但仍然发生挂起：

```
string cmd = "cmd";
string arguments = "/S /C \"" + exe + " " + args + "\""; 
```

我可以在这里搞砸什么，我该如何调试这个外部进程的东西？

编辑：

我现在才开始解决这个问题。Mucho 感谢 Jon Skeet 的建议，这确实很有效。不过，我对我的处理方法还有另一个问题，因为我是一个多线程新手。我想就改善任何明显的缺陷或任何其他愚蠢的东西提出建议。我最终创建了一个小类，其中包含标准输出流、一个保存输出的 StringBuilder 和一个告诉它何时完成的标志。然后我使用了 ThreadPool.QueueUserWorkItem 并传入了我的类的一个实例：

```
ProcessBufferHandler bufferHandler = new ProcessBufferHandler(proc.StandardOutput.BaseStream,
                                                                          Encoding.UTF8);
ThreadPool.QueueUserWorkItem(ProcessStream, bufferHandler);

proc.WaitForExit(ms);
if (proc.HasExited)
{
    bufferHandler.Stop();
    return bufferHandler.ReadToEnd();
} 
```

... 和 ...

```
private class ProcessBufferHandler
{
    public Stream stream;
    public StringBuilder sb;
    public Encoding encoding;
    public State state;

    public enum State
    {
        Running,
        Stopped
    }

    public ProcessBufferHandler(Stream stream, Encoding encoding)
    {
        this.stream = stream;
        this.sb = new StringBuilder();
        this.encoding = encoding;
        state = State.Running;
    }
    public void ProcessBuffer()
    {
        sb.Append(new StreamReader(stream, encoding).ReadToEnd());
    }

    public string ReadToEnd()
    {
        return sb.ToString();
    }

    public void Stop()
    {
        state = State.Stopped;
    }
} 
```

这似乎可行，但我怀疑这是最好的方法。这合理吗？我能做些什么来改进它？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-01-13T16:19:09.860

一个标准问题：该过程可能正在等待您读取其输出。创建一个单独的线程以在您等待它退出时从其标准输出中读取。这有点痛苦，但这很可能是问题所在。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-15T00:31:27.813

Jon Skeet 是对的！

如果您在启动 svn 命令后不介意轮询，请尝试以下操作：

```
Process command = new Process();
command.EnableRaisingEvents = false;
command.StartInfo.FileName = "svn.exe";
command.StartInfo.Arguments = "your svn arguments here";
command.StartInfo.UseShellExecute = false;
command.StartInfo.RedirectStandardOutput = true;
command.Start();

while (!command.StandardOutput.EndOfStream)
{
    Console.WriteLine(command.StandardOutput.ReadLine());
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-08-13T18:42:48.027

我不得不在客户端机器上放置一个 exe 并使用 Process.Start 来启动它。

调用应用程序会挂起 - 问题最终出在他们的机器上，假设 exe 是危险的并阻止其他应用程序启动它。

右键单击exe并转到属性。在安全警告旁边点击底部的“解除阻止”。

[![在此处输入图像描述](https://i.stack.imgur.com/MqYcy.png)](https://i.stack.imgur.com/MqYcy.png)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-04-28T15:05:31.480

我知道这是一个旧帖子，但也许这会对某人有所帮助。我使用它来执行一些使用 .Net TPL 任务的AWS *（亚马逊网络服务） CLI 命令。*

我在我的命令执行中做了类似的事情，该命令在一个 .Net TPL 任务中执行，该任务是在我的 WinForm 后台工作`bgwRun_DoWork`方法中创建的，该方法持有一个循环`while(!bgwRun.CancellationPending)`。这包含使用 .Net ThreadPool 类通过新线程从进程读取标准输出。

```
private void bgwRun_DoWork(object sender, DoWorkEventArgs e)
{
  while (!bgwRun.CancellationPending)
  {
   //build TPL Tasks
   var tasks = new List<Task>();

   //work to add tasks here

   tasks.Add(new Task(()=>{

     //build .Net ProcessInfo, Process and start Process here

     ThreadPool.QueueUserWorkItem(state =>
       {
           while (!process.StandardOutput.EndOfStream)
           {
               var output = process.StandardOutput.ReadLine();
               if (!string.IsNullOrEmpty(output))
               {
                   bgwRun_ProgressChanged(this, new ProgressChangedEventArgs(0, new ExecutionInfo
                   {
                       Type = "ExecutionInfo",
                       Text = output,
                       Configuration = s3SyncConfiguration
                   }));
               }

               if (cancellationToken.GetValueOrDefault().IsCancellationRequested)
               {
                     break;
               }
           }
       });
   });//work Task

   //loop through and start tasks here and handle completed tasks

  } //end while
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T16:21:14.457

我知道我的 SVN 存储库有时会运行缓慢，所以可能 5 秒还不够长？您是否从断点复制了要传递给进程的字符串，因此您确定它不会提示您输入任何内容？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-09-08T17:45:47.607

根据[Jon Skeet 的回答](https://stackoverflow.com/a/439633/235648)，这就是我在现代（2021 年）.NET 5 中的做法

```
var process = Process.Start(processStartInfo);

var stdErr = process.StandardError;
var stdOut = process.StandardOutput;

var resultAwaiter = stdOut.ReadToEndAsync();
var errResultAwaiter = stdErr.ReadToEndAsync();

await process.WaitForExitAsync();

await Task.WhenAll(resultAwaiter, errResultAwaiter);

var result = resultAwaiter.Result;
var errResult = errResultAwaiter.Result; 
```

请注意，您不能在错误之前等待标准输出，因为如果标准错误缓冲区首先变满，等待将挂起（反过来尝试也是如此）。

唯一的方法是开始异步读取它们，等待进程退出，然后通过使用完成等待`Task.WaitAll`

# java - JAXB XmlID 和 XmlIDREF 注释（Java 架构）

> ID：439629
> 
> 赞同：0
> 
> 时间：2009-01-13T16:18:35.650
> 
> 标签：java, wsdl, jaxb, jax-ws, cxf

我正在使用 CXF 公开一个 Web 服务。我正在使用 @XmlID 和 @XmlIDREF JAXB 注释在编组/解组期间维护我的对象图的引用完整性。

WSDL 正确地包含具有 xs:id 和 xs:idref 属性的元素来表示这一点。

在服务器端，一切运行良好。用@XmlIDREF 注释的类型实例与用@XmlID 注释注释的实例是相同的实例（如==）。

但是，当我使用 WSDLToJava 生成客户端时，引用（那些用 @XmlIDREF 注释的）是 java.lang.Object 类型的。

有什么方法可以自定义 JAXB 绑定，使引用的类型要么是 java.lang.String （以匹配被引用类型的 ID），要么与被引用类型本身相同？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-09T12:45:35.873

使用内联 JAXB 绑定来指示要使用的类型。然后 JAXB 生成的代码将具有正确的类型。

```
<complexType name="Column">
    <sequence>
        <element name="name" type="string" maxOccurs="1" minOccurs="1"></element>
        <element name="referencedColumn" type="IDREF" maxOccurs="1" minOccurs="0">
            <annotation>
                <appinfo>
                    <jaxb:property>
                        <jaxb:baseType name="Column"/>
                    </jaxb:property>
                </appinfo>
            </annotation> 
        </element>
    </sequence>
    <attribute name="id" type="ID" use="required"></attribute>
</complexType> 
```

另请注意，您必须在元素中声明`jaxb`名称空间和 JAXB 版本。`schema`

```
<schema targetNamespace="http://example.com/schema" 
    elementFormDefault="qualified" 
    xmlns="http://www.w3.org/2001/XMLSchema" 
    xmlns:jaxb="http://java.sun.com/xml/ns/jaxb"
    jaxb:version="1.0"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T11:10:48.513

以下似乎至少为 xs:IDREF 类型的元素/属性创建字符串属性。一个好的开始，但理想情况下，JAXB 将生成与被引用元素相同类型的属性。如果/当我发现如何做到这一点时，我会报告。这个结果可能表明我需要编写自己的转换器，这将是一种耻辱。

```
<jxb:bindings version="2.0" xmlns:jxb="http://java.sun.com/xml/ns/jaxb" xmlns:xs="http://www.w3.org/2001/XMLSchema">
        <jxb:globalBindings>
            <jxb:javaType name="java.lang.String" xmlType="xs:IDREF" parseMethod="javax.xml.bind.DatatypeConverter.parseString" printMethod="javax.xml.bind.DatatypeConverter.printString" />
        </jxb:globalBindings>
</jxb:bindings> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T11:27:38.857

好的，所以这行不通。JAXB 不可能为 IDREF 生成具有正确类型的代码，因为架构无法指定引用的类型，并且可能有 IDREF 指向不同的复杂类型。JAXB 如何知道引用的类型是什么？XML Schema 的扩展就可以了！:)

# javascript - 创建具有设定时区的日期而不使用字符串表示

> ID：439630
> 
> 赞同：475
> 
> 时间：2009-01-13T16:18:35.727
> 
> 标签：javascript, timezone

我有一个网页，其中包含日、月和年的三个下拉菜单。如果我使用接受数字的 JavaScript`Date`构造函数，那么我会得到一个`Date`当前时区的对象：

```
new Date(xiYear, xiMonth, xiDate) 
```

给出正确的日期，但由于夏令时，它认为日期是 GMT+01:00。

这里的问题是，然后我将它传递`Date`给 Ajax 方法，当日期在服务器上反序列化时，它已转换为 GMT，因此丢失了一个小时，这将一天向后移动。现在我可以将日、月和年单独传递到 Ajax 方法中，但似乎应该有更好的方法。

接受的答案为我指明了正确的方向，但只是单独使用`setUTCHours()`改变了：

```
Apr 5th 00:00 GMT+01:00 
```

到

```
Apr 4th 23:00 GMT+01:00 
```

然后我还必须设置 UTC 日期、月份和年份以结束

```
Apr 5th 01:00 GMT+01:00 
```

这就是我想要的。

* * *

## 回答 #1

> 赞同：530
> 
> 时间：2009-01-13T17:12:20.750

使用`.setUTCHours()`它可以实际设置 UTC 时间中的日期，这将允许您在整个系统中使用 UTC 时间。

~~但是，除非您指定日期字符串，否则您不能在构造函数中使用 UTC 设置它。~~

使用`new Date(Date.UTC(year, month, day, hour, minute, second))`您可以从特定的 UTC 时间创建日期对象。

* * *

## 回答 #2

> 赞同：215
> 
> 时间：2013-04-16T22:22:19.113

```
var d = new Date(xiYear, xiMonth, xiDate);
d.setTime( d.getTime() + d.getTimezoneOffset()*60*1000 ); 
```

此答案是专门针对原始问题量身定制的，不会给出您所期望的答案。特别是，有些人会想要减去时区偏移量而不是添加它。请记住，尽管此解决方案的全部意义在于破解 javascript 的日期对象以进行特定的反序列化，但并非在所有情况下都是正确的。

* * *

## 回答 #3

> 赞同：192
> 
> 时间：2012-12-22T21:02:23.523

我相信您需要**createDateAsUTC**函数（请与**convertDateToUTC**进行比较）

```
function createDateAsUTC(date) {
    return new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds()));
}

function convertDateToUTC(date) { 
    return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()); 
} 
```

* * *

## 回答 #4

> 赞同：176
> 
> 时间：2019-01-31T05:39:29.303

**只需设置时区并返回**

```
new Date().toLocaleString("en-US", {timeZone: "America/New_York"}) 
```

> 其他**时区**如下

```
var world_timezones =
[
    'Europe/Andorra',
    'Asia/Dubai',
    'Asia/Kabul',
    'Europe/Tirane',
    'Asia/Yerevan',
    'Antarctica/Casey',
    'Antarctica/Davis',
    'Antarctica/DumontDUrville', 
    'Antarctica/Mawson',
    'Antarctica/Palmer',
    'Antarctica/Rothera',
    'Antarctica/Syowa',
    'Antarctica/Troll',
    'Antarctica/Vostok',
    'America/Argentina/Buenos_Aires',
    'America/Argentina/Cordoba',
    'America/Argentina/Salta',
    'America/Argentina/Jujuy',
    'America/Argentina/Tucuman',
    'America/Argentina/Catamarca',
    'America/Argentina/La_Rioja',
    'America/Argentina/San_Juan',
    'America/Argentina/Mendoza',
    'America/Argentina/San_Luis',
    'America/Argentina/Rio_Gallegos',
    'America/Argentina/Ushuaia',
    'Pacific/Pago_Pago',
    'Europe/Vienna',
    'Australia/Lord_Howe',
    'Antarctica/Macquarie',
    'Australia/Hobart',
    'Australia/Currie',
    'Australia/Melbourne',
    'Australia/Sydney',
    'Australia/Broken_Hill',
    'Australia/Brisbane',
    'Australia/Lindeman',
    'Australia/Adelaide',
    'Australia/Darwin',
    'Australia/Perth',
    'Australia/Eucla',
    'Asia/Baku',
    'America/Barbados',
    'Asia/Dhaka',
    'Europe/Brussels',
    'Europe/Sofia',
    'Atlantic/Bermuda',
    'Asia/Brunei',
    'America/La_Paz',
    'America/Noronha',
    'America/Belem',
    'America/Fortaleza',
    'America/Recife',
    'America/Araguaina',
    'America/Maceio',
    'America/Bahia',
    'America/Sao_Paulo',
    'America/Campo_Grande',
    'America/Cuiaba',
    'America/Santarem',
    'America/Porto_Velho',
    'America/Boa_Vista',
    'America/Manaus',
    'America/Eirunepe',
    'America/Rio_Branco',
    'America/Nassau',
    'Asia/Thimphu',
    'Europe/Minsk',
    'America/Belize',
    'America/St_Johns',
    'America/Halifax',
    'America/Glace_Bay',
    'America/Moncton',
    'America/Goose_Bay',
    'America/Blanc-Sablon',
    'America/Toronto',
    'America/Nipigon',
    'America/Thunder_Bay',
    'America/Iqaluit',
    'America/Pangnirtung',
    'America/Atikokan',
    'America/Winnipeg',
    'America/Rainy_River',
    'America/Resolute',
    'America/Rankin_Inlet',
    'America/Regina',
    'America/Swift_Current',
    'America/Edmonton',
    'America/Cambridge_Bay',
    'America/Yellowknife',
    'America/Inuvik',
    'America/Creston',
    'America/Dawson_Creek',
    'America/Fort_Nelson',
    'America/Vancouver',
    'America/Whitehorse',
    'America/Dawson',
    'Indian/Cocos',
    'Europe/Zurich',
    'Africa/Abidjan',
    'Pacific/Rarotonga',
    'America/Santiago',
    'America/Punta_Arenas',
    'Pacific/Easter',
    'Asia/Shanghai',
    'Asia/Urumqi',
    'America/Bogota',
    'America/Costa_Rica',
    'America/Havana',
    'Atlantic/Cape_Verde',
    'America/Curacao',
    'Indian/Christmas',
    'Asia/Nicosia',
    'Asia/Famagusta',
    'Europe/Prague',
    'Europe/Berlin',
    'Europe/Copenhagen',
    'America/Santo_Domingo',
    'Africa/Algiers',
    'America/Guayaquil',
    'Pacific/Galapagos',
    'Europe/Tallinn',
    'Africa/Cairo',
    'Africa/El_Aaiun',
    'Europe/Madrid',
    'Africa/Ceuta',
    'Atlantic/Canary',
    'Europe/Helsinki',
    'Pacific/Fiji',
    'Atlantic/Stanley',
    'Pacific/Chuuk',
    'Pacific/Pohnpei',
    'Pacific/Kosrae',
    'Atlantic/Faroe',
    'Europe/Paris',
    'Europe/London',
    'Asia/Tbilisi',
    'America/Cayenne',
    'Africa/Accra',
    'Europe/Gibraltar',
    'America/Godthab',
    'America/Danmarkshavn',
    'America/Scoresbysund',
    'America/Thule',
    'Europe/Athens',
    'Atlantic/South_Georgia',
    'America/Guatemala',
    'Pacific/Guam',
    'Africa/Bissau',
    'America/Guyana',
    'Asia/Hong_Kong',
    'America/Tegucigalpa',
    'America/Port-au-Prince',
    'Europe/Budapest',
    'Asia/Jakarta',
    'Asia/Pontianak',
    'Asia/Makassar',
    'Asia/Jayapura',
    'Europe/Dublin',
    'Asia/Jerusalem',
    'Asia/Kolkata',
    'Indian/Chagos',
    'Asia/Baghdad',
    'Asia/Tehran',
    'Atlantic/Reykjavik',
    'Europe/Rome',
    'America/Jamaica',
    'Asia/Amman',
    'Asia/Tokyo',
    'Africa/Nairobi',
    'Asia/Bishkek',
    'Pacific/Tarawa',
    'Pacific/Enderbury',
    'Pacific/Kiritimati',
    'Asia/Pyongyang',
    'Asia/Seoul',
    'Asia/Almaty',
    'Asia/Qyzylorda',
    'Asia/Qostanay', 
    'Asia/Aqtobe',
    'Asia/Aqtau',
    'Asia/Atyrau',
    'Asia/Oral',
    'Asia/Beirut',
    'Asia/Colombo',
    'Africa/Monrovia',
    'Europe/Vilnius',
    'Europe/Luxembourg',
    'Europe/Riga',
    'Africa/Tripoli',
    'Africa/Casablanca',
    'Europe/Monaco',
    'Europe/Chisinau',
    'Pacific/Majuro',
    'Pacific/Kwajalein',
    'Asia/Yangon',
    'Asia/Ulaanbaatar',
    'Asia/Hovd',
    'Asia/Choibalsan',
    'Asia/Macau',
    'America/Martinique',
    'Europe/Malta',
    'Indian/Mauritius',
    'Indian/Maldives',
    'America/Mexico_City',
    'America/Cancun',
    'America/Merida',
    'America/Monterrey',
    'America/Matamoros',
    'America/Mazatlan',
    'America/Chihuahua',
    'America/Ojinaga',
    'America/Hermosillo',
    'America/Tijuana',
    'America/Bahia_Banderas',
    'Asia/Kuala_Lumpur',
    'Asia/Kuching',
    'Africa/Maputo',
    'Africa/Windhoek',
    'Pacific/Noumea',
    'Pacific/Norfolk',
    'Africa/Lagos',
    'America/Managua',
    'Europe/Amsterdam',
    'Europe/Oslo',
    'Asia/Kathmandu',
    'Pacific/Nauru',
    'Pacific/Niue',
    'Pacific/Auckland',
    'Pacific/Chatham',
    'America/Panama',
    'America/Lima',
    'Pacific/Tahiti',
    'Pacific/Marquesas',
    'Pacific/Gambier',
    'Pacific/Port_Moresby',
    'Pacific/Bougainville',
    'Asia/Manila',
    'Asia/Karachi',
    'Europe/Warsaw',
    'America/Miquelon',
    'Pacific/Pitcairn',
    'America/Puerto_Rico',
    'Asia/Gaza',
    'Asia/Hebron',
    'Europe/Lisbon',
    'Atlantic/Madeira',
    'Atlantic/Azores',
    'Pacific/Palau',
    'America/Asuncion',
    'Asia/Qatar',
    'Indian/Reunion',
    'Europe/Bucharest',
    'Europe/Belgrade',
    'Europe/Kaliningrad',
    'Europe/Moscow',
    'Europe/Simferopol',
    'Europe/Kirov',
    'Europe/Astrakhan',
    'Europe/Volgograd',
    'Europe/Saratov',
    'Europe/Ulyanovsk',
    'Europe/Samara',
    'Asia/Yekaterinburg',
    'Asia/Omsk',
    'Asia/Novosibirsk',
    'Asia/Barnaul',
    'Asia/Tomsk',
    'Asia/Novokuznetsk',
    'Asia/Krasnoyarsk',
    'Asia/Irkutsk',
    'Asia/Chita',
    'Asia/Yakutsk',
    'Asia/Khandyga',
    'Asia/Vladivostok',
    'Asia/Ust-Nera',
    'Asia/Magadan',
    'Asia/Sakhalin',
    'Asia/Srednekolymsk',
    'Asia/Kamchatka',
    'Asia/Anadyr',
    'Asia/Riyadh',
    'Pacific/Guadalcanal',
    'Indian/Mahe',
    'Africa/Khartoum',
    'Europe/Stockholm',
    'Asia/Singapore',
    'America/Paramaribo',
    'Africa/Juba',
    'Africa/Sao_Tome',
    'America/El_Salvador',
    'Asia/Damascus',
    'America/Grand_Turk',
    'Africa/Ndjamena',
    'Indian/Kerguelen',
    'Asia/Bangkok',
    'Asia/Dushanbe',
    'Pacific/Fakaofo',
    'Asia/Dili',
    'Asia/Ashgabat',
    'Africa/Tunis',
    'Pacific/Tongatapu',
    'Europe/Istanbul',
    'America/Port_of_Spain',
    'Pacific/Funafuti',
    'Asia/Taipei',
    'Europe/Kiev',
    'Europe/Uzhgorod',
    'Europe/Zaporozhye',
    'Pacific/Wake',
    'America/New_York',
    'America/Detroit',
    'America/Kentucky/Louisville',
    'America/Kentucky/Monticello',
    'America/Indiana/Indianapolis',
    'America/Indiana/Vincennes',
    'America/Indiana/Winamac',
    'America/Indiana/Marengo',
    'America/Indiana/Petersburg',
    'America/Indiana/Vevay',
    'America/Chicago',
    'America/Indiana/Tell_City',
    'America/Indiana/Knox',
    'America/Menominee',
    'America/North_Dakota/Center',
    'America/North_Dakota/New_Salem',
    'America/North_Dakota/Beulah',
    'America/Denver',
    'America/Boise',
    'America/Phoenix',
    'America/Los_Angeles',
    'America/Anchorage',
    'America/Juneau',
    'America/Sitka',
    'America/Metlakatla',
    'America/Yakutat',
    'America/Nome',
    'America/Adak',
    'Pacific/Honolulu',
    'America/Montevideo',
    'Asia/Samarkand',
    'Asia/Tashkent',
    'America/Caracas',
    'Asia/Ho_Chi_Minh',
    'Pacific/Efate',
    'Pacific/Wallis',
    'Pacific/Apia',
    'Africa/Johannesburg'
]; 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2009-01-13T16:44:10.807

我不相信这是可能的 - 创建后无法在 Date 对象上设置时区。

从某种意义上说，这是有道理的——在概念上（如果可能没有实现）；每个[http://en.wikipedia.org/wiki/Unix_timestamp](http://en.wikipedia.org/wiki/Unix_timestamp)（强调我的）：

> Unix 时间或 POSIX 时间是用于描述时间瞬间的系统，定义为自1970 年 1 月 1 日星期四的**协调世界时 (UTC)**午夜以来经过的秒数。

一旦你构建了一个，它将代表“实时”的某个点。仅当您要将抽象时间点转换为人类可读的字符串时，时区才相关。

因此，您只能更改 Date 在构造函数中表示的实际时间。可悲的是，似乎没有办法传递一个明确的时区——你正在调用的构造函数（可以说是正确的）在规范存储它们时将你的“本地”时间变量转换为 GMT——所以没有办法使用`int, int, int`构造函数格林威治标准时间。

从好的方面来说，只使用采用 String 的构造函数是微不足道的。您甚至不必将数字月份转换为字符串（至少在 Firefox 上），所以我希望一个简单的实现可以工作。然而，在试用后，它在 Firefox、Chrome 和 Opera 中成功运行，但在 Konqueror ("Invalid Date") 、Safari ("Invalid Date") 和 IE ("NaN") 中失败。我想你只有一个查找数组来将月份转换为字符串，如下所示：

```
var months = [ '', 'January', 'February', ..., 'December'];

function createGMTDate(xiYear, xiMonth, xiDate) {
   return new Date(months[xiMonth] + ' ' + xiDate + ', ' + xiYear + ' 00:00:00 GMT');
} 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2014-09-19T03:05:14.460

我知道这很旧，但如果它有帮助，你可以使用时刻和时刻时区。如果你还没有看到他们看看。

[http://momentjs.com/timezone/](http://momentjs.com/timezone/)

[http://momentjs.com/](http://momentjs.com/)

两个非常方便的时间操作库。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2013-01-31T22:36:45.110

如果您想处理从年、月、日...（*包括时区*）创建 Javascript Date 对象的略有不同但相关的问题——也就是说，如果你想将字符串解析为日期——那么你显然必须跳一段极其复杂的舞蹈：

```
// parseISO8601String : string -> Date
// Parse an ISO-8601 date, including possible timezone,
// into a Javascript Date object.
//
// Test strings: parseISO8601String(x).toISOString()
// "2013-01-31T12:34"              -> "2013-01-31T12:34:00.000Z"
// "2013-01-31T12:34:56"           -> "2013-01-31T12:34:56.000Z"
// "2013-01-31T12:34:56.78"        -> "2013-01-31T12:34:56.780Z"
// "2013-01-31T12:34:56.78+0100"   -> "2013-01-31T11:34:56.780Z"
// "2013-01-31T12:34:56.78+0530"   -> "2013-01-31T07:04:56.780Z"
// "2013-01-31T12:34:56.78-0330"   -> "2013-01-31T16:04:56.780Z"
// "2013-01-31T12:34:56-0330"      -> "2013-01-31T16:04:56.000Z"
// "2013-01-31T12:34:56Z"          -> "2013-01-31T12:34:56.000Z"
function parseISO8601String(dateString) {
    var timebits = /^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/;
    var m = timebits.exec(dateString);
    var resultDate;
    if (m) {
        var utcdate = Date.UTC(parseInt(m[1]),
                               parseInt(m[2])-1, // months are zero-offset (!)
                               parseInt(m[3]),
                               parseInt(m[4]), parseInt(m[5]), // hh:mm
                               (m[6] && parseInt(m[6]) || 0),  // optional seconds
                               (m[7] && parseFloat(m[7])*1000) || 0); // optional fraction
        // utcdate is milliseconds since the epoch
        if (m[9] && m[10]) {
            var offsetMinutes = parseInt(m[9]) * 60 + parseInt(m[10]);
            utcdate += (m[8] === '+' ? -1 : +1) * offsetMinutes * 60000;
        }
        resultDate = new Date(utcdate);
    } else {
        resultDate = null;
    }
    return resultDate;
} 
```

也就是说，您使用没有时区的日期创建一个“UTC 时间”（这样您就知道它所在的区域设置，即 UTC 的“区域设置”，并且它不是默认为本地的），然后手动应用指定的时区偏移量。

如果有人真的*考虑*Javascript 日期对象超过 5 分钟，那不是很好吗？

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2016-06-10T14:10:16.153

```
d = new Date();
utc = d.getTime() + (d.getTimezoneOffset() * 60000);
nd = new Date(utc + (3600000*offset));

offset value base on which location time zone you would like to set 
For India offset value +5.5,
New York offset value -4,
London offset value +1 
```

对于所有位置偏移[Wiki UTC 时间偏移列表](https://en.wikipedia.org/wiki/List_of_UTC_time_offsets)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2014-07-31T15:12:09.937

对于 UTC + z，getTimeZoneOffset 为负数。

```
var d = new Date(xiYear, xiMonth, xiDate);
if(d.getTimezoneOffset() > 0){
    d.setTime( d.getTime() + d.getTimezoneOffset()*60*1000 );
} 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2014-08-28T14:39:54.683

这可能对某人有所帮助，将UTC放在您传递给新构造函数的末尾

至少在 chrome 中你可以说`var date = new Date("2014-01-01 11:00:00 UTC")`

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2015-01-29T09:56:02.857

一条线解决方案

```
new Date(new Date(1422524805305).getTime() - 330*60*1000) 
```

而不是 1422524805305，使用以毫秒为单位的时间戳而不是 330，使用您的时区偏移量（以分钟为单位）。GMT（例如印度 +5:30 是 5*60+30 = 330 分钟）

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2018-07-24T17:37:52.693

```
// My clock 2018-07-25, 00:26:00 (GMT+7)
let date = new Date(); // 2018-07-24:17:26:00 (Look like GMT+0)
const myTimeZone = 7; // my timeZone 
// my timeZone = 7h = 7 * 60 * 60 * 1000 (millisecond);
// 2018-07-24:17:26:00 = x (milliseconds)
// finally, time in milliseconds (GMT+7) = x + myTimezone 
date.setTime( date.getTime() + myTimeZone * 60 * 60 * 1000 );
// date.toISOString() = 2018-07-25, 00:26:00 (GMT+7) 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-10-05T13:11:19.317

我发现获得正确日期的最简单方法是使用 datejs。

[http://www.datejs.com/](http://www.datejs.com/)

我通过 Ajax 以这种格式获取我的日期作为字符串：'2016-01-12T00:00:00'

```
var yourDateString = '2016-01-12T00:00:00';
var yourDate = new Date(yourDateString);
console.log(yourDate);
if (yourDate.getTimezoneOffset() > 0){
    yourDate = new Date(yourDateString).addMinutes(yourDate.getTimezoneOffset());
}
console.log(yourDate); 
```

控制台将显示：

> 2016 年 1 月 11 日星期一 19:00:00 GMT-0500（东部标准时间）
> 
> 2016 年 1 月 12 日星期二 00:00:00 GMT-0500（东部标准时间）

[https://jsfiddle.net/vp1ena7b/3/](https://jsfiddle.net/vp1ena7b/3/)

'addMinutes' 来自 datejs，您可能可以自己在纯 js 中执行此操作，但我的项目中已经有 datejs，所以我找到了一种使用它来获取正确日期的方法。

我认为这可能会帮助某人...

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-01-25T16:27:32.967

此代码将返回使用**浏览器 timezone**格式化的**Date 对象**。

 **```
Date.prototype.timezone = function () {
    this.setHours(this.getHours() + (new Date().getTimezoneOffset() / 60));
    return this;
} 
```

编辑：

为避免污染 Date API，可以将上述函数转换为实用函数。该函数接受一个 Date 对象，并返回一个变异的 Date 对象。

```
function setTimeZone(date) {
    date.setHours(date.getHours() + (new Date().getTimezoneOffset() / 60));
    return date;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-01-13T17:11:39.940

任何里程

```
var d = new Date(xiYear, xiMonth, xiDate).toLocaleString(); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2020-08-18T08:10:02.633

我在使用日期选择器时遇到了类似的问题。我的研究导致了一个非常简单的解决方案，没有任何额外的库或硬编码的乘法器。

## 关键信息：

1.  ISO 是 Javascript 首选日期标准。假设日期实用程序可能会以该格式返回日期值。
    *   我的日期选择器以本地化格式显示日期：mm/dd/yyyy

    *   但是，它以 ISO 格式返回日期值：yyyy-mm-dd

        ```
        //Select "08/12/2020" in Date Picker date_input 

        var input = $('#date_input').val();  //input: 2020-08-12 
        ```

2.  Date.getTimezoneOffset() 以分钟为单位返回偏移量。

## 例子：

如果您使用默认返回的日期值而不修改字符串格式，则日期可能不会设置为您的时区。这可能会导致意想不到的结果。

```
var input = $('#date_input').val();  //input: 2020-08-12
var date = new Date(input);          //This get interpreted as an ISO date, already in UTC
//date:                             Tue Aug 11 2020 20:00:00 GMT-0400 (Eastern Daylight Time)
//date.toUTCString():               Wed, 12 Aug 2020 00:00:00 GMT
//date.toLocaleDateString('en-US'):       8/11/2020 
```

使用不同于 ISO 标准 yyyy-mm-dd 的日期字符串格式将您的时区应用于日期。

```
var date = new Date("08/12/2020");  //This gets interpreted as local timezone
//date:                             Wed Aug 12 2020 00:00:00 GMT-0400 (Eastern Daylight Time)
//date.toUTCString():               Wed, 12 Aug 2020 04:00:00 GMT
//date.toLocaleDateString('en-US'):       8/12/2020 
```

## 解决方案：

要将您的时区应用于与格式无关的日期而不进行字符串操作，请使用`Date.getTimezoneOffset()`Minutes。这适用于原始日期字符串格式（即 UTC 日期或本地化日期）。它提供了一致的结果，然后可以准确地转换为 UTC 以进行存储或与其他代码交互。

```
var input = $('#date_input').val();
var date = new Date(input);
date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
//date:                             Wed Aug 12 2020 00:00:00 GMT-0400 (Eastern Daylight Time)
//date.toUTCString():               Wed, 12 Aug 2020 04:00:00 GMT
//date.toLocaleDateString('en-US'):       8/12/2020 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2021-12-09T20:12:48.090

这是一个可用于实现日期对象的函数：

```
const getUTCDate = (date) => {
    const d = new Date(date);
    const utcDate = new Date(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate());
    return utcDate;
}

const string = '1930-08-12T00:00:00.000000Z';

const utcDate = getUTCDate(string);

// returns Tue Aug 12 1930 00:00:00 GMT-0800 (Pacific Daylight Time) 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-05-17T17:13:02.037

我从中看到的最佳解决方案来自

[http://www.codingforums.com/archive/index.php/t-19663.html](http://www.codingforums.com/archive/index.php/t-19663.html)

打印时间功能

```
<script language="javascript" type="text/javascript">
//borrowed from echoecho
//http://www.echoecho.com/ubb/viewthread.php?tid=2362&pid=10482&#pid10482
workDate = new Date()
UTCDate = new Date()
UTCDate.setTime(workDate.getTime()+workDate.getTimezoneOffset()*60000)

function printTime(offset) {
    offset++;
    tempDate = new Date()
    tempDate.setTime(UTCDate.getTime()+3600000*(offset))
    timeValue = ((tempDate.getHours()<10) ? ("0"+tempDate.getHours()) : (""+tempDate.getHours()))
    timeValue += ((tempDate.getMinutes()<10) ? ("0"+tempDate.getMinutes()) : tempDate.getMinutes())
    timeValue += " hrs."
    return timeValue
    }
    var now = new Date()
    var seed = now.getTime() % 0xfffffff
    var same = rand(12)
</script>

Banff, Canada:
<script language="JavaScript">document.write(printTime("-7"))</script> 
```

完整代码示例

```
<html>

<head>
<script language="javascript" type="text/javascript">
//borrowed from echoecho
//http://www.echoecho.com/ubb/viewthread.php?tid=2362&pid=10482&#pid10482
workDate = new Date()
UTCDate = new Date()
UTCDate.setTime(workDate.getTime()+workDate.getTimezoneOffset()*60000)

function printTime(offset) {
offset++;
tempDate = new Date()
tempDate.setTime(UTCDate.getTime()+3600000*(offset))
timeValue = ((tempDate.getHours()<10) ? ("0"+tempDate.getHours()) : (""+tempDate.getHours()))
timeValue += ((tempDate.getMinutes()<10) ? ("0"+tempDate.getMinutes()) : tempDate.getMinutes())
timeValue += " hrs."
return timeValue
}
var now = new Date()
var seed = now.getTime() % 0xfffffff
var same = rand(12)
</script>

</head>

<body>
Banff, Canada:
<script language="JavaScript">document.write(printTime("-7"))</script>
<br>
Michigan:
<script language="JavaScript">document.write(printTime("-5"))</script>
<br>
Greenwich, England(UTC):
<script language="JavaScript">document.write(printTime("-0"))</script>
<br>
Tokyo, Japan:
<script language="JavaScript">document.write(printTime("+9"))</script>
<br>
Berlin, Germany:
<script language="JavaScript">document.write(printTime("+1"))</script>

</body>
</html> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-09-06T12:21:57.243

当我创建一个日期对象时：

`new Date(year, month, day, hour, minute)`

我在本地主机上工作正常。当我部署到服务器时，它**会中断**，因为服务器位于另一个时区。

我不能使用 getTimezoneOffset()。我需要**我家的 timezoneOffset** - 取决于**夏季**/**冬季**

```
// add diff minutes between myself (HOME) and server 
timezoneHomeOffset (d, tz = 'Europe/Copenhagen') {
  const utc = new Date(d.getTime())
  const dHome = new Date(d.toLocaleString('en-US', { timeZone: tz }))
  const diff = Math.round((utc - dHome) / 60000) // 60*1000 => minutes
  d.setMinutes(d.getMinutes() + diff)
  return d
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-12-16T20:47:35.080

```
const date = new Date("2020-12-16 17:45:00 UTC"); 
```

工作正常。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-12-21T06:41:55.853

您可以使用库来帮助更改时区

`moment-timezone`

```
var moment = require("moment-timezone");
const today = new Date();
var timeGet = moment(today);
timeGet.tz("Asia/Karachi").format("ha z"); 
```

这可以更改您所在地区的时区粘贴您的地区并获得真正的 GMT+ 解决问题

有关更多详细信息，请访问[时刻时区官方文档](https://momentjs.com/timezone/)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-04-13T22:57:41.093

做到这一点实际上一点也不难，但想出解决方案肯定不是很直观。这里有一些非常复杂的答案（尽管也有一些不错的答案）。这是我想出的确保我的服务器时间戳与我的本地时间戳匹配的方法，无论我部署的服务器恰好位于哪个时区。

（CET = 中欧时区，恰好是我的个人时区；您可以获取任何给定时区的偏移量并计算它，如果您愿意，甚至可以将其作为参数，但出于我的目的，我只需要获取我的日期都是唯一需要的一致时区。）

```
 const convertDateToCET = function(date) {
        date = new Date(date)
        // let startTime = date.getTime();
        const cetOffset = -120; // this is the number you get from running 
        // `(new Date()).getTimezoneOffset()` if you're on a machine in CET
        const offsetFromCET = (date.getTimezoneOffset() - cetOffset);
        const cetMillsecondOffset = ( cetOffset* 60 * 1000);
        date = new Date( date.getTime() - cetMillsecondOffset ) 
        // let endTime = date.getTime()
        // console.log("updated date from",startTime,"to",endTime)
        return date;
    }, 
```

使用它，您只需按照您期望的方式安排时间，例如

```
 let myDate = new Date("12-4-2021")
    myDate.setHour(14)
    myDate.setMinute(30)
    // now myDate is 2:30pm, December 4th, 2021, in whatever the timezone the machine of code running happens to be in
    myDate = convertDateToCET(myDate)
    // now myDate will show up as 2:30pm, Dec 4th, 2021, mapped into your local timezone
    // so, if you're in the UK, and one hour behind CET, myDate is now 1:30pm, Dec 4th, 2021 
```

这里的关键是`date.getTimezoneOffset()`。如果您实际上在 CET 中，则该数字将为`-120`，因此它会抵消，没有区别（因此 CET 会导致 CET 输出）。如果您在英国，比 CET 晚一小时，则输出将为`-60`，这意味着`-60 + 120 = +60`我们将输入时间更改一小时，*依此类推*。

在这种情况下，转换所有内容并使用 UTC 格式可能更有意义，但考虑到我所有的输入时间都在 CET 中，并且我最初是根据我的机器上本地的外观开发系统的，这个实用程序允许我通过在几个关键位置调用此函数来转换现有代码。

注意：确保不要在同一日期多次应用此函数调用，因为您将多次重新应用偏移量，将其丢弃！

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2021-06-14T16:34:13.130

这适用于不同的时区（IST、PST、墨西哥、中美洲）：

```
let dateUtc: any = new Date(Date.parse(data.details.dateOfBirth));

dateUtc = new Date(dateUtc.getTime() + Math.abs(dateUtc.getTimezoneOffset()*60000));

console.log(dateUtc); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-10-23T19:41:32.367

如果您想检查两个日期之间的时间差，您可以简单地检查第二个时区是否比您想要的第一个时区更小或更大，然后减去或添加一个时间。

```
 const currTimezone = new Date().getTimezoneOffset(); // your timezone
  const newDateTimezone = date.getTimezoneOffset(); // date with unknown timezone

  if (currTimezone !== newDateTimezone) {
    // and below you are checking if difference should be - or +. It depends on if unknown timezone is lesser or greater than yours
    const newTimezone = (currTimezone - newDateTimezone) * (currTimezone > newDateTimezone ? 1 : -1);
    date.setTime(date.getTime() + (newTimezone * 60 * 1000));
  } 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-02-27T18:03:38.107

格林威治标准时间 -03:00 示例

```
new Date(new Date()-3600*1000*3).toISOString();  // 2020-02-27T15:03:26.261Z 
```

甚至

```
now  = new Date().getTime()-3600*1000*3; // 1582818380528
data = new Date(now).toISOString();      // 2020-02-27T15:03:26.261Z 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2017-07-31T16:02:58.857

我使用了 timezone-js 包。

```
var timezoneJS  = require('timezone-js');
var tzdata = require('tzdata');

createDate(dateObj) {
    if ( dateObj == null ) {
        return null;
    }
    var nativeTimezoneOffset = new Date().getTimezoneOffset();
    var offset = this.getTimeZoneOffset();

    // use the native Date object if the timezone matches
    if ( offset == -1 * nativeTimezoneOffset ) {
        return dateObj;
    }

    this.loadTimeZones();

    // FIXME: it would be better if timezoneJS.Date was an instanceof of Date
    //        tried jquery $.extend
    //        added hack to Fiterpickr to look for Dater.getTime instead of "d instanceof Date"
    return new timezoneJS.Date(dateObj,this.getTimeZoneName());
}, 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2018-04-04T01:12:05.633

这对我有用。不确定这是否是个好主意。

```
var myDate = new Date();
console.log('myDate:', myDate);   // myDate: "2018-04-04T01:09:38.112Z"

var offset = '+5';  // e.g. if the timeZone is -5

var MyDateWithOffset = new Date( myDate.toGMTString() + offset );   

console.log('MyDateWithOffset:', MyDateWithOffset); // myDateWithOffset: "2018-04-03T20:09:38.000Z"
```

* * *

## 回答 #28

> 赞同：-15
> 
> 时间：2016-11-10T02:10:24.467

这是最好的解决方案

使用：

```
// TO ALL dates
Date.timezoneOffset(-240) // +4 UTC

// Override offset only for THIS date
new Date().timezoneOffset(-180) // +3 UTC 
```

代码：

```
Date.prototype.timezoneOffset = new Date().getTimezoneOffset();

Date.setTimezoneOffset = function(timezoneOffset) {
  return this.prototype.timezoneOffset = timezoneOffset;
};

Date.getTimezoneOffset = function() {
  return this.prototype.timezoneOffset;
};

Date.prototype.setTimezoneOffset = function(timezoneOffset) {
  return this.timezoneOffset = timezoneOffset;
};

Date.prototype.getTimezoneOffset = function() {
  return this.timezoneOffset;
};

Date.prototype.toString = function() {
  var offsetDate, offsetTime;
  offsetTime = this.timezoneOffset * 60 * 1000;
  offsetDate = new Date(this.getTime() - offsetTime);
  return offsetDate.toUTCString();
};

['Milliseconds', 'Seconds', 'Minutes', 'Hours', 'Date', 'Month', 'FullYear', 'Year', 'Day'].forEach((function(_this) {
  return function(key) {
    Date.prototype["get" + key] = function() {
      var offsetDate, offsetTime;
      offsetTime = this.timezoneOffset * 60 * 1000;
      offsetDate = new Date(this.getTime() - offsetTime);
      return offsetDate["getUTC" + key]();
    };
    return Date.prototype["set" + key] = function(value) {
      var offsetDate, offsetTime, time;
      offsetTime = this.timezoneOffset * 60 * 1000;
      offsetDate = new Date(this.getTime() - offsetTime);
      offsetDate["setUTC" + key](value);
      time = offsetDate.getTime() + offsetTime;
      this.setTime(time);
      return time;
    };
  };
})(this)); 
```

咖啡版：

```
Date.prototype.timezoneOffset = new Date().getTimezoneOffset()

Date.setTimezoneOffset = (timezoneOffset)->
    return @prototype.timezoneOffset = timezoneOffset

Date.getTimezoneOffset = ->
    return @prototype.timezoneOffset

Date.prototype.setTimezoneOffset = (timezoneOffset)->
    return @timezoneOffset = timezoneOffset

Date.prototype.getTimezoneOffset = ->
    return @timezoneOffset

Date.prototype.toString = ->
    offsetTime = @timezoneOffset * 60 * 1000
    offsetDate = new Date(@getTime() - offsetTime)
    return offsetDate.toUTCString()

[
    'Milliseconds', 'Seconds', 'Minutes', 'Hours',
    'Date', 'Month', 'FullYear', 'Year', 'Day'
]
.forEach (key)=>
    Date.prototype["get#{key}"] = ->
        offsetTime = @timezoneOffset * 60 * 1000
        offsetDate = new Date(@getTime() - offsetTime)
        return offsetDate["getUTC#{key}"]()

    Date.prototype["set#{key}"] = (value)->
        offsetTime = @timezoneOffset * 60 * 1000
        offsetDate = new Date(@getTime() - offsetTime)
        offsetDate["setUTC#{key}"](value)
        time = offsetDate.getTime() + offsetTime
        @setTime(time)
        return time 
```

# email - 如何编写 VMS 邮件正文的脚本？

> ID：439635
> 
> 赞同：0
> 
> 时间：2009-01-13T16:19:51.403
> 
> 标签：email, vms

我有一个用于处理和发送电子邮件的脚本，但我需要消息中的正文**而不创建文件**，然后使用标准 MAIL 命令行插入文件。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T19:29:19.837

假设您要创建的正文是您可以写入 SYS$OUTPUT 的内容（例如命令过程或 DCL 命令的输出），那么您可以使用 DCL PIPE 将输出通过管道传输到 VMS 邮件中，例如：

```
$ PIPE write sys$output "The date is ", f$cvtime() | MAIL SYS$INPUT smith/SUBJ="Piping in DCL" 
```

或者

```
$ PIPE DIR *.LOG | MAIL SYS$INPUT smith/SUBJ="Piping in DCL" 
```

在 OpenVMS V7.1 中添加了 PIPE 命令。如果您使用的是 7.1 之前的系统，那么您唯一的选择就是写入临时文件并进行清理。

编辑：要回答评论，如果您想消除 Mail 命令中的交互式显示，您可以将 SYS$OUTPUT 重定向到 NLA0:，如下所示：

```
$ PIPE DIR *.LOG |  MAIL SYS$INPUT smith/SUBJ="Piping in DCL" > NLA0: 
```

错误消息转到 SYS$ERROR，因此您仍然会看到任何失败。请参阅帮助管道以获得更多好处。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T18:14:09.910

让脚本创建一个临时文件来保存消息的正文。

邮件将接受命令行上的文本文件，例如用户列表和 /subj

# wcf - netTcpBinding - 挂起的安全会话

> ID：439637
> 
> 赞同：0
> 
> 时间：2009-01-13T16:20:43.290
> 
> 标签：wcf, wcf-binding

我有一个通过 tcp 托管的内部服务。它在 Windows 服务中自托管。该服务在大多数情况下运行良好，但偶尔我会从中得到一堆异常（全部连续）。

```
System.ServiceModel.Security.SecuritySessionServerSettings.AddPendingSession(UniqueId sessionId, IServerReliableChannelBinder channelBinder) 
```

抛出一个`System.ServiceModel.QuotaExceededException`说法“无法创建安全会话。稍后重试。”

该服务每秒大约有 14-30 个请求，我没有看到异常峰值周围的使用量激增。

所有的服务都是简单的数据拉取/设置。

我的配置或调用服务的方式是否有问题会导致这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T19:07:19.147

Have you tried to raise the maxReceivedMessageSize and the maxBuffersize in your config? Googling "QuotaExceededException wcf" leads to these three links, which seem to indicate that it helps:

[http://www.arquitecturadesoftware.org/blogs/hugobatista/archive/2006/05/16/wcf-maxreceivedmessagesize-and-quotaexceededexception.aspx](http://www.arquitecturadesoftware.org/blogs/hugobatista/archive/2006/05/16/wcf-maxreceivedmessagesize-and-quotaexceededexception.aspx)

[http://guyellisrocks.com/coding/wcf-tracing-with-svctraceviewer/](http://guyellisrocks.com/coding/wcf-tracing-with-svctraceviewer/)

[http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/d9d1ece9-250a-4cd3-99ab-123f4d2df762/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/d9d1ece9-250a-4cd3-99ab-123f4d2df762/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-16T22:55:41.303

挂起的安全会话是客户端在不执行任何操作的情况下建立的会话。此类会话的数量是有限的。

通常，尤其是考虑到您的低通话率，这是由于客户没有关闭他们的会话造成的。

# python - PIL vs RMagick/ruby-gd

> ID：439641
> 
> 赞同：4
> 
> 时间：2009-01-13T16:21:17.920
> 
> 标签：python, ruby, python-imaging-library, rmagick

对于我的下一个项目，我计划创建带有文本和图形的图像。我对 ruby​​ 很满意，但对学习 python 很感兴趣。我认为这可能是个好时机，因为 PIL 看起来像是一个很棒的库。但是，我不知道它与 ruby​​ 所提供的（例如 RMagick 和 ruby​​-gd）相比如何。据我所知，PIL 有更好的文档（ruby-gd 甚至有主页吗？）和更多功能。只是想听听一些意见来帮助我做出决定。

谢谢。

文斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T19:00:38.723

PIL 是一个很好的库，使用它。ImageMagic（RMagick 包装的）是一个非常繁重的库，如果可能的话应该避免使用。它非常适合对图像进行本地处理，例如批量照片编辑器，但对于 Web 的常见图像处理任务来说，处理器效率太低了。

**编辑：**针对这个问题，PIL 支持绘制矢量形状。它可以绘制多边形、曲线、线条、填充和文本。我在一个项目中使用它在网络上动态生成 PNG 图像的圆形 alpha 角。它本质上具有 GDI+（在 Windows 中）或 GTK（在 Linux 上的 Gnome 中）的大部分绘图功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T19:12:00.930

PIL 已经存在了很长时间并且非常稳定，因此它可能是您第一个 Python 项目的不错选择。PIL 文档包含一个有用的[教程](http://effbot.org/imagingbook/introduction.htm)，它可以让您快速上手。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T23:12:10.010

ImageMagic 是一个巨大的库，可以在阳光下做所有事情，但是许多人报告 RMagick 变体存在内存问题，我个人发现它对我的需求来说太过分了。

正如你所说，当涉及到英文文档时，ruby-gd 在地面上有点薄……但 GD 在后期平台上安装是一件轻而易举的事，并且有一个小包装器，其中包含一些名为[gruby](http://gruby.sourceforge.jp/index.en.html)的有用示例，值得一看。（如果您追求 alpha 透明度，请确保安装最新的 GD 库）

对于整体社区博客的帮助，PIL 的方式。

# perl - 如何在 Perl 数组中打印唯一元素？

> ID：439647
> 
> 赞同：25
> 
> 时间：2009-01-13T16:21:53.083
> 
> 标签：perl, arrays, unique

我在 while 语句中将元素推入数组。每个元素都是老师的名字。当循环结束时，数组中最终会出现重复的教师姓名。有时它们在阵列中并不相邻，有时它们是相邻的。

在完成将值推入其中后，如何仅打印该数组中的唯一值？每次我想打印一个元素时都不必解析整个数组。

将所有内容推入数组后，代码如下：

```
$faculty_len = @faculty;
$i=0;
while ($i != $faculty_len)
{
        printf $fh '"'.$faculty[$i].'"';
        $i++;
} 
```

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-13T16:48:18.723

```
use List::MoreUtils qw/ uniq /;
my @unique = uniq @faculty;
foreach ( @unique ) {
    print $_, "\n";
} 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-01-13T16:58:37.267

您最好的选择是使用（基本上）内置工具，例如 uniq （[如 innaM 所述）](https://stackoverflow.com/a/439764/18097)。

如果你没有能力使用 uniq 并且想要保留顺序，你可以使用 grep 来模拟它。

```
my %seen;
my @unique = grep { ! $seen{$_}++ } @faculty;
# printing, etc. 
```

这首先给你一个散列，其中每个键是每个条目。然后，您遍历每个元素，计算其中有多少，然后添加第一个元素。（由 brian d foy 更新评论）

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-13T16:24:00.537

我建议将其推入哈希中。像这样：

```
my %faculty_hash = ();
foreach my $facs (@faculty) {
  $faculty_hash{$facs} = 1;
}
my @faculty_unique = keys(%faculty_hash); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-04-02T06:36:13.203

```
@array1 = ("abc", "def", "abc", "def", "abc", "def", "abc", "def", "xyz");

@array1 = grep { ! $seen{ $_ }++ } @array1;

print "@array1\n"; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-07-25T14:16:10.073

这个问题在 perldoc 中有多种解决方案。只需在命令行输入：

```
perldoc -q duplicate 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-10-01T12:46:55.253

请注意：一些包含哈希的答案会改变数组的顺序。哈希没有任何顺序，因此获取键或值将生成一个未定义排序的列表。

这不适用于`grep { ! $seen{$_}++ } @faculty`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-12-08T01:03:27.210

这是一个单行命令，用于按出现的顺序打印唯一行。

```
perl -ne '$seen{$_}++ || print $_' fileWithDuplicateValues 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-11-08T23:49:29.477

我刚找到陈旧的 3 班轮，享受

```
my %uniq; 
undef @uniq(@non_uniq_array); 
my @uniq_array = keys %uniq; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-10-01T13:17:11.323

只是另一种方法，*仅当您不关心 order 时才*有用：

```
my %hash;
@hash{@faculty}=1;
my @unique=keys %hash; 
```

如果你想避免声明一个新变量，你可以使用某种未充分记录的全局变量[%_](http://www.perlmonks.org/?node_id=11757)

```
@_{@faculty}=1;
my @unique=keys %_; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-18T05:39:05.747

如果您需要以任何方式处理教师列表，则将数组上的映射转换为用于键合并的哈希然后对键进行排序是另一种好方法：

```
my @deduped = sort keys %{{ map { /.*/? ($_,1):() } @faculty }};
print join("\n", @deduped)."\n"; 
```

您可以通过更改用于选择或解析和捕获的正则表达式来处理列表，并且您可以通过任意复杂`/.*/`的方式在每次传递中输出一个或多个变异的、非唯一的键。`($_,1):()`

如果您需要使用替换正则表达式修改运行中的数据，例如从名称 ( `s/\.//g`) 中删除点，那么根据上述模式的替换将`@faculty`由于`$_`混叠而改变原始数组。您可以`$_`通过制作数组的匿名副本来解决别名问题`@faculty`（请参阅所谓的[“婴儿车”运算符](https://metacpan.org/pod/distribution/perlsecret/lib/perlsecret.pod#Baby-cart)）：

```
my @deduped = sort keys %{{ map {/.*/? do{s/\.//g; ($_,1)}:()} @{[ @faculty ]} }};
print join("\n", @deduped)."\n";
print "Unmolested array:\n".join("\n", @faculty)."\n"; 
```

在更新的 Perl 版本中，您可以传递`keys`hashref，并且可以使用非破坏性替换：

```
my @deduped = sort keys { map { /.*/? (s/\.//gr,1):() } @faculty }; 
```

否则，其他地方的`grep`解决`$seen[$_]++`方案可能更可取。

# .net - 在 .NET 中获取进程信息

> ID：439653
> 
> 赞同：0
> 
> 时间：2009-01-13T16:22:33.037
> 
> 标签：.net, process, diagnostics, working-directory

~~[这个问题](https://stackoverflow.com/questions/217951/get-the-current-working-directory-for-cmdexe)的重复。~~

**更新**- 这不是完全重复的。请参阅我的解决方案。

我在进程资源管理器中看到一个 java.exe 进程，双击它会给我它的工作目录和启动命令行参数。

在 .NET 中，我运行以下代码并获得具有相同 PID 的进程，但上述字段为空。显然，[这是记录在案的](http://social.microsoft.com/Forums/en-US/netfxbcl/thread/e7536183-ae65-4abc-a457-223dfa0dfbee)。

```
foreach (Process process in Process.GetProcessesByName("java"))
{ 
  ...
} 
```

那么如何**在不**手动查看进程内存的情况下获得正确的 startinfo 字段值（换句话说 - 我想从某个地方窃取此代码，而不是自己破解进程内存）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T16:37:42.660

根据您在问题中列出的帖子，方法是查看进程内存。.NET 类不会加载数据，因为您没有从 .NET 启动进程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:14:11.507

我写了一些代码来完成这个（[博客文章](http://ripper234.com/p/reading-enviornment-variables-from-external-processes-in-c/)和[zip 的直接链接](http://ripper234.com/apps/ReadProcessEnv.zip)）。

简而言之：[这个问题](https://stackoverflow.com/questions/217951/get-the-current-working-directory-for-cmdexe)很有帮助。我获取了 CodeProject 代码并将其包装在命令行实用程序中，然后是 C# 包装器。

# visual-studio - Visual Studio 2005 Pro 可以生成 UML 风格的类图吗？

> ID：439655
> 
> 赞同：2
> 
> 时间：2009-01-13T16:23:17.917
> 
> 标签：visual-studio, uml

Visual Studio 2005 Pro 可以生成 UML 风格的类图吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T16:28:35.393

您可以单击解决方案资源管理器窗口中的放大镜图标。然后将生成图表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:29:21.337

2005 没有 UML 建模器。上面提到的类设计器将允许您对类进行建模和代码生成，但它不是一个 UML 工具。如果您不关心模型中的代码生成，那么我建议您只使用 Viso。如果您确实想从真正的 UML 模型生成代码，那么您可能需要考虑类似 [Enterprise Architect](http://www.sparxsystems.com.au/)的东西。

[然而， 2010 Team System](http://dotnet.dzone.com/articles/a-firist-look-visual-studio-20)应该内置完整的 UML 建模和代码生成。只需要再等一年:-P

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:26:44.510

[是的](http://msdn.microsoft.com/en-us/library/aa288743.aspx)

该页面的一些详细信息：

> # **Visual Studio 2005 类设计器**
> 
> # [视觉工作室 .NET 2003]
> 
> *   适用于：Visual Studio® 2005
> 
> **简介：**
> Visual Studio 类设计器使您可以可视化类的结构及其关系，使用可视化设计环境创建新类，并轻松重构类。本白皮书将引导您完成其中一些任务。（7 打印页）
> 
> **简介**
> Visual Studio 类设计器是用于公共语言运行时的功能齐全的可视化设计环境。Visual Studio 类设计器让您可视化类和其他类型的结构，并通过这些可视化表示编辑它们的源代码。对类图所做的更改会立即反映在代码中，对代码所做的更改会立即影响设计器的外观。设计器和代码之间的这种同步关系使直观地创建和配置复杂的 CLR 类型变得容易。
> 
> 类设计器包含专门用于帮助您重构代码以及允许您轻松重命名标识符和覆盖方法的功能。您可以自动生成类和结构，并通过自动生成存根来实现接口。
> 
> 最后，Class Designer 还可以作为一种交流工具，让您可以轻松地与同事交流代码库的各个区域。类图可以打印成硬拷贝或保存为图像，以便在 HTML 页面或 PowerPoint 演示文稿中显示。
> 
> > **注意：**
> > 本文档是在产品投入生产之前制定的，因此，您可能会发现此处包含的详细信息与发货产品中的内容不一致。该信息基于创建本文档时的产品，仅用于规划目的。信息可能随时更改，恕不另行通知...

# php - 具有动态字段数的 MySQL 设计

> ID：439656
> 
> 赞同：3
> 
> 时间：2009-01-13T16:23:35.590
> 
> 标签：php, mysql, database

我对 MySQL 的经验非常基础。简单的东西很容易，但我遇到了一些需要更多知识的东西。我需要一个存储一小部分单词的表。存储的单词数可能在 1 到 15 之间。稍后，我计划通过这些单词在表中进行搜索。我想过几种不同的方法：

A.) 我可以创建包含 15 个字段的数据库，并且只要数据小于 15，就用空值填充字段。我不太喜欢这样。看起来真的效率很低。

B.) 另一种选择是只使用一个字段，并将数据存储为逗号分隔的列表。每当我回来搜索时，我都会在该字段上运行一个正则表达式。同样，这似乎真的效率低下。

我希望这两个选项有一个很好的选择。任何建议将不胜感激。

-谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-13T16:27:23.930

C) 使用[范式](http://en.wikipedia.org/wiki/Database_normalization)；使用具有适当键的多行。一个例子：

```
mysql> SELECT * FROM blah;
+----+-----+-----------+
| K  | grp | name      |
+----+-----+-----------+
|  1 |   1 | foo       |
|  2 |   1 | bar       |
|  3 |   2 | hydrogen  |
|  4 |   4 | dasher    |
|  5 |   2 | helium    |
|  6 |   2 | lithium   |
|  7 |   4 | dancer    |
|  8 |   3 | winken    |
|  9 |   4 | prancer   |
| 10 |   2 | beryllium |
| 11 |   1 | baz       |
| 12 |   3 | blinken   |
| 13 |   4 | vixen     |
| 14 |   1 | quux      |
| 15 |   4 | comet     |
| 16 |   2 | boron     |
| 17 |   4 | cupid     |
| 18 |   4 | donner    |
| 19 |   4 | blitzen   |
| 20 |   3 | nod       |
| 21 |   4 | rudolph   |
+----+-----+-----------+
21 rows in set (0.00 sec) 
```

这是我在另一个问题中发布的关于[`group_concat`](https://stackoverflow.com/questions/397708/is-it-possible-to-concatenate-strings-from-multiple-rows-and-tables-into-one-resu#397733). 您会注意到`K`每一行都有一个唯一的键。还有一个`grp`代表每个类别的键。剩下的字段代表一个类别成员，每个类别可以有可变数量的这些成员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:37:44.207

还有哪些其他数据与这些词相关联？

处理此类问题的一种典型方法最好通过示例来描述。假设您的表格捕获了在某些文档中找到的某些单词。一种典型的方法是为每个文档分配一个标识符。让我们暂时假设每个文档都是一个 Web URL，因此您将有一个类似这样的表格：

```
CREATE TABLE WebPage (
    ID INTEGER NOT NULL,
    URL VARCHAR(...) NOT NULL
) 
```

您的 Words 表可能如下所示：

```
CREATE TABLE Words (
    Word VARCHAR(...) NOT NULL,
    DocumentID INTEGER NOT NULL 
) 
```

然后，对于每个单词，您在表中创建一个新行。要查找特定文档中的所有单词，请按文档的 ID 进行选择：

```
SELECT Words.Word FROM Words, WebPage 
WHERE Words.DocumentID = WebPage.DocumentID
AND WebPage.URL = 'http://whatever/web/page/' 
```

要查找包含特定单词的所有文档，请按单词选择：

```
SELECT WebPage.URL FROM WebPage, Words
WHERE Words.Word = 'hello' AND Words.DocumentID = WebPage.DocumentID 
```

或者一些这样的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:32:41.603

Hurpe，是您描述的场景，您将拥有一个数据库表，其中包含最多 15 个关键字的列。稍后您将使用这些关键字来搜索可能还有其他列的表？

那么答案不就是为关键字设置一个单独的表格吗？您还需要在关键字和主表之间建立多对多关系。

因此，以汽车为例，将存储 15 个左右关键字的 WORD 表将具有以下结构：

```
ID             int
Word           varchar(100) 
```

CAR 表的结构类似于：

```
ID              int
Name            varchar(100) 
```

最后你需要一个 CAR_WORD 表来保存多对多关系：

```
ID              int
CAR_ID          int
WORD_ID         int 
```

以及用于 WORD 表的示例数据：

```
ID   Word

001  Family
002  Sportscar
003  Sedan
004  Hatchback
005  Station-wagon
006  Two-door
007  Four-door
008  Diesel
009  Petrol 
```

连同 CAR 表的样本数据

```
ID   Name

001  Audi TT
002  Audi A3
003  Audi A4 
```

那么路口 CAR_WORD 表样本数据可以是：

```
ID    CAR_ID   WORD_ID
001   001      002
002   001      006
003   001      009 
```

这为奥迪 TT 提供了正确的特性。

最后要搜索的 SQL 类似于：

```
SELECT c.name
FROM CAR c
INNER JOIN CAR_WORD x
ON c.id = x.id
INNER JOIN WORD w
ON x.id = w.id
WHERE w.word IN('Petrol', 'Two-door') 
```

呸！不打算写这么多，它看起来很复杂，但我似乎总是以这种方式结束，无论我多么努力地简化事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:28:00.450

你是对的，A不好。B 也不好，因为它不符合第一范式（每个字段必须是原子的）。您的示例中没有任何内容表明您可以通过避免 1NF 获得收益。

您需要一个包含单词列表的表格，每个单词都在自己的行中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T16:31:17.790

我会创建一个带有 ID 和一个字段的表，然后将您的结果存储为多条记录。这提供了许多好处。例如，您可以以编程方式强制执行 15 个字的限制，而不是在您的设计中这样做，所以如果您改变主意，这应该很容易。您对数据进行搜索的查询运行起来也会快得多，正则表达式运行起来需要很多时间（相比之下）。另外，使用 varchar 字段可以让您更好地压缩表格。使用这种设计，表格上的索引应该更容易（更有效）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T16:32:14.030

做额外的工作，将 15 个单词作为 15 行存储在表中，即规范化数据。这可能需要您重新考虑一下您的策略，但是当客户出现并说“您可以将 15 限制更改为 20...”时请相信我，您会很高兴您做到了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T16:46:03.253

具体取决于您想要完成的任务：

1.  在字符串表上使用全文索引

2.  三个表：一个用于原始字符串，一个用于唯一词（在词根之后？），以及一个连接表。这也可以让您进行更复杂的搜索，例如“返回包含以下五个单词中至少三个的所有字符串”或“返回所有在 'dog' 之后出现 'fox' 的字符串”。

    CREATE TABLE 字符串（id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，字符串 TEXT NOT NULL）

    CREATE TABLE word（id INT NOT NULL AUTO_INCREMENT PRIMARY KEY，word VARCHAR(14) NOT NULL UNIQUE，UNIQUE INDEX（word ASC））

    CREATE TABLE word_string ( id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, string_id INT NOT NULL, word_id INT NOT NULL, word_order INT NOT NULL, FOREIGN KEY (string_id) REFERENCES (string.id), FOREIGN KEY (word_id) REFERENCES (word.id) , 索引 (word_id ASC) )

    // 样本数据 INSERT INTO string(string) VALUES ('This is a test string'), ('迅捷的红狐跳过了懒惰的棕狗')

    INSERT INTO word (word) VALUES ('this'), ('test'), ('string'), ('quick'), ('red'), ('fox'), ('jump'), ( 'over'), ('lazy'), ('brown'), ('dog')

    INSERT INTO word_string (string_id, word_id, word_order) 值 (0, 0, 0), (0, 1, 3), (0, 2, 4), (1, 3, 1), (1, 4, 2) , (1, 5, 3), (1, 6, 4), (1, 7, 5), (1, 8, 7), (1, 9, 8), (1, 10, 9)

    // 示例查询 - 查找所有包含 'fox' 和 'quick' 的字符串 SELECT UNIQUE string.id, string.string FROM string INNER JOIN word_string ON string.id=word_string.string_id INNER JOIN word AS fox ON fox.word='fox ' AND word_string.word_id=fox.id INNER JOIN word AS quick ON quick.word='quick' AND word_string.word_id=word.id

# xml - XSD - 取决于属性值的子元素

> ID：439657
> 
> 赞同：4
> 
> 时间：2009-01-13T16:23:36.857
> 
> 标签：xml, xsd

我正在尝试为以下 XML 创建 XSD 架构：

```
<root>
  <!-- The actual file must contain one of the following constraints -->
  <constraint type="interval">
    <min>100</min>
    <max>200</max>
  </constraint>

  <constraint type="equals">
    <value>EOF</value>
  </constraint>
</root> 
```

约束元素的子元素依赖于 type 属性的值。

我已经使用定义类型属性的抽象类型和定义子元素的两个扩展类型成功地验证了 XML。这需要我用 xsi:type 属性装饰 XML，命名实际的扩展类型：

```
 <constraint type="interval" xsi:type="intervalConstraintType">
    <min>100</min>
    <max>200</max>
  </constraint> 
```

遗憾的是，我无法控制 XML 结构，并且很难引入新属性。

这对 XSD 可行吗？有没有更合适的替代品？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-04-15T12:48:17.043

> 约束元素的子元素依赖于 type 属性的值。

我认为 XSD 1.1 可以通过使用断言来实现。您的架构可能看起来像这样（未经测试）

```
<!-- ... -->
<xs:element name="constraint"> 
  <xs:complexType> 
     <xs:sequence> 
         <xs:element name="min" type="xs:decimal" minOccurs="0" maxOccurs="1" /> 
         <xs:element name="max" type="xs:decimal" minOccurs="0" maxOccurs="1" />
         <xs:element name="value" type="xs:string"minOccurs="0" maxOccurs="1" />
     </xs:sequence> 
     <xs:attribute name="type" type="contraintType" />

     <xs:assert test="

        if (@type eq 'equals')
        then (exist(value) and empty(min, max))
        else (exist(min) and exist(max) and empty(value))

     "/>

</xs:complexType> 
</xs:element>

<xs:simpleType name="contraintType">
    <xs:restriction base="xs:string">
        <xs:enumeration value="interval"/>
        <xs:enumeration value="equals"/>
    </xs:restriction>
</xs:simpleType> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:00:52.320

我认为这应该是可能的，但我目前不知道自己该怎么做。作为一种解决方法，您可以动态重写 xml 以包含您的扩展。

编辑：嗯，看起来不可能，至少在 XSD 1.0 中是不可能的

# objective-c - Objective-C 中的#import 和#include 有什么区别？

> ID：439662
> 
> 赞同：399
> 
> 时间：2009-01-13T16:25:17.117
> 
> 标签：objective-c, import, include

Objective-C 中的#import 和#include 之间有什么区别？在某些时候你应该使用其中一个而不是另一个？一个被弃用了吗？

我正在阅读以下教程：[http](http://www.otierney.net/objective-c.html#preamble) : //www.otierney.net/objective-c.html#preamble 及其关于#import 和#include 的段落似乎自相矛盾，或者至少不清楚。

* * *

## 回答 #1

> 赞同：374
> 
> 时间：2010-09-17T22:38:15.120

关于预处理器似乎有很多困惑。

当编译器看到`#include`它用包含文件的内容替换该行时，编译器会做什么，没有提出任何问题。

因此，如果您有一个`a.h`包含以下内容的文件：

```
typedef int my_number; 
```

以及`b.c`包含以下内容的文件：

```
#include "a.h"
#include "a.h" 
```

该文件`b.c`将在编译前由预处理器翻译成

```
typedef int my_number;
typedef int my_number; 
```

这将导致编译器错误，因为该类型`my_number`被定义了两次。即使定义相同，C 语言也不允许这样做。

由于标头经常在多个地方使用，因此在 C 中通常使用*包含守卫。这看起来像这样：*

```
 #ifndef _a_h_included_
 #define _a_h_included_

 typedef int my_number;

 #endif 
```

该文件`b.c`在预处理后仍然会包含两次标题的全部内容。但是第二个实例将被忽略，因为宏`_a_h_included_`已经定义了。

这非常有效，但有两个缺点。首先必须编写包含保护，并且每个标头中的宏名称必须不同。其次，编译器仍然需要查找头文件并尽可能频繁地读取它。

Objective-C 有`#import`预处理器指令（它也可以用于带有一些编译器和选项的 C 和 C++ 代码）。这与 几乎相同`#include`，但它还在内部记录了已包含的文件。该`#import`行仅在第一次遇到时被命名文件的内容替换。之后每次都会被忽略。

* * *

## 回答 #2

> 赞同：356
> 
> 时间：2009-01-13T16:29:54.953

#import 指令作为#include 的改进版本添加到Objective-C。然而，它是否得到改进仍然是一个争论的问题。#import 确保文件只包含一次，这样您就不会遇到递归包含的问题。然而，无论如何，大多数体面的头文件都会保护自己免受这种情况的影响，所以它并没有太大的好处。

基本上，由您决定要使用哪个。我倾向于为 Objective-C 的东西（如类定义等）和 #include 我需要的标准 C 东西 #import 标头。例如，我的一个源文件可能如下所示：

```
#import <Foundation/Foundation.h>

#include <asl.h>
#include <mach/mach.h> 
```

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2010-11-18T20:51:47.693

我同意杰森。

我被抓到这样做：

```
#import <sys/time.h>  // to use gettimeofday() function
#import <time.h>      // to use time() function 
```

对于 GNU gcc，它一直抱怨没有定义 time() 函数。

然后我将#import 更改为#include，一切正常。

原因：

你#import <sys/time.h>：
    <sys/time.h>使用#defines 只包含<time.h>的**一部分**

你#import <time.h>：
    不行。尽管只有 <time.h> 的一部分已经包含在内，但
    就#import 而言，该文件现在已经**完全**包含在内。

底线：

C/C++ 头文件通常包含**其他**包含文件的一部分。
所以对于 C/C++ 头文件，使用#include。
对于 objc/objc++ 头文件，使用#import。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2009-01-13T16:28:39.263

`#include`就像 C 一样工作`#include`。

`#import`跟踪已包含哪些标头，如果在编译单元中多次导入标头，则将其忽略。这使得没有必要使用标头保护。

底线只是`#import`在 Objective-C 中使用，如果您的标头最终多次导入某些内容，请不要担心。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2014-04-18T01:37:44.343

我知道这个线程很旧......但在“现代”......通过[clang的`@import`模块](http://clang.llvm.org/docs/Modules.html)有一个非常优越的“包含策略” - 这是经常被忽视的......

> 模块通过用更健壮、更高效的语义模型替换文本预处理器包含模型来改进对软件库 API 的访问。从用户的角度来看，代码看起来只是略有不同，因为它使用了导入声明而不是#include 预处理器指令：

```
@import Darwin; // Like including all of /usr/include. @see /usr/include/module.map 
```

或者

```
@import Foundation;  //  Like #import <Foundation/Foundation.h>
@import ObjectiveC;  //  Like #import <objc/runtime.h> 
```

> 但是，此模块导入的行为与相应的#include 完全不同：当编译器看到上面的模块导入时，它会加载模块的二进制表示并使其 API 直接可供应用程序使用。导入声明之前的预处理器定义对提供的 API 没有影响……因为模块本身被编译为单独的独立模块。此外，在导入模块时，将**自动**提供使用该模块所需的任何链接器标志。这种语义导入模型解决了预处理器包含模型的许多问题。

要启用模块，请在编译时传递命令行标志，`-fmodules`也就是`CLANG_ENABLE_MODULES`- 。`Xcode`如上所述.. 这种策略避免了 ANY 和 ALL `LDFLAGS`。如在，您可以删除任何“OTHER_LDFLAGS”设置，以及任何“链接”阶段..

![在此处输入图像描述](https://i.stack.imgur.com/yUi2T.png)

我发现编译/启动时间“感觉”更快（或者可能，“链接”时延迟更少？）..而且，提供了一个很好的机会来清除现在无关的 Project-Prefix.pch 文件，并且相应的构建设置、`GCC_INCREASE_PRECOMPILED_HEADER_SHARING`、`GCC_PRECOMPILE_PREFIX_HEADER`和`GCC_PREFIX_HEADER`等。

此外，虽然没有很好的文档......您可以`module.map`为自己的框架创建 s 并以同样方便的方式包含它们。 [您可以查看我的 ObjC-Clang-Modules github repo，了解如何实现这些奇迹的一些示例。](https://github.com/mralexgray/ObjC-Clang-Modules)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-18T12:56:27.683

如果你熟悉 C++ 和宏，那么

```
#import "Class.h" 
```

类似于

```
{
#pragma once

#include "class.h"
} 
```

这意味着您的类只会在您的应用程序运行时加载一次。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-10T15:47:32.430

在可能的情况下，我的一个`.h`文件中有一个导致问题的全局变量，我通过`extern`在它前面添加来解决它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-01T22:39:38.813

`#include`它曾经从另一个文件中获取“东西”到`#include`使用的文件中。例如：

**在文件中：main.cpp**

```
#include "otherfile.h"

// some stuff here using otherfile.h objects,
// functions or classes declared inside 
```

在每个头文件 (*.h) 的顶部使用头保护，以防止多次包含同一文件（如果发生这种情况，您将得到编译错误）。

**在文件中：otherfile.h**

```
#ifndef OTHERFILE
#define OTHERFILE

// declare functions, classes or objects here

#endif 
```

即使您`#include`在代码中放入“otherfile.h”n 次，它里面的 this 也不会被重新声明。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-16T09:43:02.917

如果你在 .h 文件中 #include 一个文件两次，编译器就会出错。但是如果你多次#import 一个文件，编译器会忽略它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-06T11:11:15.280

**#include 与 #import**

**历史：**

```
#include => #import => Precompiled Headers .pch => @import Module(ObjC); => import Module(Swift) 
```

[[预编译头文件 .pch]](https://stackoverflow.com/a/59213256/4770877)
[[@import Module(ObjC);]](https://stackoverflow.com/a/59213796/4770877)
[[import Module(Swift)]](https://stackoverflow.com/a/67130959/4770877)

```
#include + guard == #import 
```

`#include guard`[^(Wiki)](https://en.wikipedia.org/wiki/Include_guard) - 宏守卫、标头守卫或文件守卫可防止双重包含标头，`preprocessor`这会减慢构建时间

**#进口劣势**

`.h`适用于文件范围，这就是我们构建时间缓慢的原因，因为编译器必须解析和编译与项目范围中导入的文件一样多的次数

[[#导入`.h`或`.m`]](https://stackoverflow.com/a/59211762/4770877)

# objective-c - 我必须用 try/finally 附上对象的创建/释放吗？

> ID：439664
> 
> 赞同：0
> 
> 时间：2009-01-13T16:25:39.800
> 
> 标签：objective-c, delphi

在 Delphi 中，这样做是正常的：

```
ob = TObject.create;
try
  //code
finally
  ob.free;
end; 
```

我想知道这在 Obj-c 中是否相似。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T21:52:34.833

你可以那样做，但是异常在 Objective-C 中的成本往往很高。32 位和 64 位 ABI 之间的性能以及 Objective-C 异常和 C++ 异常之间的交互存在一些差异。

另一种方法是创建您的对象，以便它们自动释放并且仅在您的方法结束之前保留它们。

```
SomeClass *object = [[[SomeClass alloc] init] autorelease];

/* deadly code here */

return [object retain]; 
```

这样，即使您的代码遇到异常，您的对象也将在下次自动释放池耗尽时（通常在事件循环结束时）被释放，假设异常不是致命的并导致您的程序崩溃。

Apple 有一些关于 Obj-C 异常的[文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/Exceptions/Exceptions.html)，Leopard[的发行说明最后讨论了 64 位 ABI 的变化。](http://developer.apple.com/ReleaseNotes/Cocoa/RN-ObjectiveC/index.html#//apple_ref/doc/uid/TP40004309-DontLinkElementID_11)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:30:01.583

不。Objective-C 确实支持异常，你很少在 Cocoa 中看到它们（NSError 是 Apple 的发展方向），但你绝对不会在每次初始化或释放对象时都使用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T17:18:50.410

我当然不是 Obj-C 方面的专家，但事实上它提供了（人们在 Delphi 中提出的问题）复合 try/catch/finally，让您可以选择使用它来像在 Delphi 中一样进行防御性编程：

```
@try {
   // protected block
} 
@catch (id theException) {
  // do smthing with theException
} 
@finally {
  // clean up code 
} 
```

我认为如果程序员更频繁地使用@finally，他们的开发中的错误就会更少。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-27T03:25:05.043

好的答案，但是......我会得到纠正，但我的理解是 @try {} @finally {} 在概念上是不同的，因此适用于 @try {} **@catch {}** @finally {}，因为如果您不引发任何异常，则开销最小，但是当引发异常时（根据定义，应该是“异常而不是规则”），它们用于保护被包装的资源，进一步留下 @catch 处理程序处理食物链的逻辑端处理异常。

举个例子，当我必须返回一个自动释放的值时，我经常使用一个结构，如果它不是你看到的@try/@finally/drain/autorelease 结构，它将自动释放大量无关数据到调用者池中这里。

```
+(NSArray *) arrayOfUrlPrefixAssociatedUrlArraysFromUnsortedArrayOfUrlStrings:(NSArray *)urlStrings {

    NSArray *arrayResult = nil;
    NSAutoreleasePool *wader = [[NSAutoreleasePool alloc] init];
    @try  {

        NSMutableDictionary *result = [NSMutableDictionary dictionary];

        for (NSString *urlString in urlStrings) {

            BOOL addedToPrior = NO;

            for (NSString *prefix in result.allKeys) {

                if ([urlString hasPrefix:prefix]) {

                    [(NSMutableArray *) [result objectForKey:prefix] addObject:urlString];

                    addedToPrior = YES;
                    break;

                }
            }

            if (!addedToPrior) { 
                [result setObject:[NSMutableArray arrayWithObject:urlString] forKey:[self urlPrefixFromUrlString:urlString]];
            }
        }

        arrayResult = [[NSArray alloc] initWithArray:[result allValues]];

    }

    @finally {
        [wader drain];
    }

    return (arrayResult?[arrayResult autorelease]:nil); 
} 
```

# svn - svn:switch 不适用于相对 svn:external？

> ID：439666
> 
> 赞同：1
> 
> 时间：2009-01-13T16:25:44.307
> 
> 标签：svn, branch, switch-statement

我们有一个相对 svn 外部的子文件夹（../project/subfolder）。在新的主干结帐中，它指向（...TRUNK/project/subfolder），在新的分支结帐中，它指向（...BRANCH/branchName/project/subfolder）。但是，如果您对包含子文件夹的项目进行切换，则子文件夹将始终指向 TRUNK。或者，如果您进行 BRANCH 结帐并切换到 TRUNK，它会一直指向 BRANCH。

svn:switch 不应该更新相对外部吗？是否有某种递归 svn:switch 我应该运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-24T13:31:32.530

该问题的正确答案是“是的，它应该更新那些外部数据”。它没有的事实是一个错误：

见：[http ://subversion.tigris.org/issues/show_bug.cgi?id=3390](http://subversion.tigris.org/issues/show_bug.cgi?id=3390)

修复目标里程碑是 1.6.10。修复显然已经完成，但我写这篇文章时的当前版本仍然是 1.6.6。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-26T12:45:04.677

似乎这已在 Subversion 1.6.11 [http://svn.apache.org/repos/asf/subversion/trunk/CHANGES中修复](http://svn.apache.org/repos/asf/subversion/trunk/CHANGES)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:27:08.550

您可能想尝试 svncopy.pl。分支或切换时，svn:externals 不会更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T16:29:34.893

Subversion 通常认为外部对象与其包含的项目是分开的。例如，“svn commit”只查看项目中的文件，而不查看项目中包含的外部文件中的任何文件。“svn switch”的工作方式相同；你可以切换主项目，但你需要在每个外部运行一个单独的“svn switch”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-21T20:11:06.803

唉，我相信这仍然没有修复，尽管上面提到的错误修复是很久以前实现的。

我有一个外部对象，其名称包含嵌入空格并使用双相对路径。我的外部引用了同一分支中的文件，但反复引用，如下所示：../../myOriginFolder/itsSubfolder/my file name.pdf

一旦我重命名了分支，现在我的 repo 使用 TortoiseSVN 1.7.8（或其命令行 SVN 1.7.6）被破坏了。旧的工作副本在切换后无法正确更新，我也无法签出旧分支的新副本！所有命令 - checkout-to-old-revision、update-to-old-revision 和 switch-and-update - 都将失败。唯一可行的方法是重新结帐，然后继续前进，永不回头。

这似乎是一个非常糟糕的错误！这意味着**由于我使用了相对路径外部，我不能再重命名/切换/恢复我的分支**。

我想知道是否有人看过这个并有解决方法？我想知道我是否应该对这些引用进行硬编码。即使这样也可能比这次失败更好。

我还想知道上面提到的修复现在是否可能失败，因为在 1.6 和 1.7 之间工作副本格式已更改。现在只有一个顶级面包屑；可能与这个问题有关吗？如果我仍然可以签出该文件夹，我会比较 /.svn/ 信息以获取最新的最新签出与以前的名称。

这是我看到的错误的详细信息。

TortoiseSVN 说：External failed c:\myRepo-keyword\myDestinationFolder\my file name.pdf '/svn/myrepo/!svn/me' 的错误报告：无法读取块大小：连接已被服务器关闭。

Apache/VisualSVN 事件日志说；来源：VisualSVN Server 2.5 日期：2012 年 8 月 21 日上午 11:20:57 事件 ID：4000 级别：信息描述：开关 /myRepo-Path/myOriginFolder/itsSubfolder/my file name.pdf/my file name.pdf /myRepo -Path/mySubfolder/我的文件名.pdf@7178

这是从重命名之前的修订版中重新检出 external-ed 文件夹的错误。外部失败：C:\VcsSvn\3.7.8.6328.RuntimeRefs\Stroz Review User Guide.pdf
错误：URL
错误：' [http://myurl/svn/myOldRepo-Path/myOriginFolder/itsSuubfolder/my](http://myurl/svn/myOldRepo-Path/myOriginFolder/itsSuubfolder/my) file name.pdf'
错误：在修订版 7179 不存在
已完成：在修订版：6328

//edit 感谢另一个stackoverflow用户，我发现了这个可能相关的开放票； [http://subversion.tigris.org/issues/show_bug.cgi?id=4150](http://subversion.tigris.org/issues/show_bug.cgi?id=4150)

//编辑2; 另一张海报建议避免使用外部： [如何在 SVN 中分支并让它分支我的 svn:external 文件夹？](https://stackoverflow.com/questions/245337/how-can-i-branch-in-svn-and-have-it-branch-my-svnexternal-folders-as-well)

# sql - 如何混合 COUNT() 和非 COUNT() 列而不丢失查询中的信息？

> ID：439670
> 
> 赞同：1
> 
> 时间：2009-01-13T16:26:21.890
> 
> 标签：sql

我从一个查询开始：

```
SELECT strip.name as strip, character.name as character
  from strips, characters, appearances
 where strips.id = appearances.strip_id
   and characters.id = appearances.character.id
   and appearances.date in (...) 
```

这给了我一些结果：

```
strip                 | character
'Calvin & Hobbes'     | 'Calvin'
'Calvin & Hobbes'     | 'Hobbes'
'Pearls Before Swine' | 'Pig'
'Pearls Before Swine' | 'Rat'
'Pearls Before Swine' | 'Hobbes'  # a guest appearance
'Pearls Before Swine' | 'Calvin'  # a guest appearance 
```

然后我还想获得`COUNT`在结果集中（在任何条带中）使用字符的次数。所以我尝试了：

```
SELECT count(character.id), strip.name as strip, character.name as character
  from strips, characters, appearances
 where strips.id = appearances.strip_id
   and characters.id = appearances.character.id
   and appearances.date in (...) 
```

但这给了我

```
[ERROR 11:20:17] Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP columns is illegal if there is no GROUP BY clause 
```

所以我尝试了：

```
SELECT count(character.id), strip.name as strip, character.name as character
  from strips, characters, appearances
 where strips.id = appearances.strip_id
   and characters.id = appearances.character.id
   and appearances.date in (...)
 group by character.id 
```

这给了我

```
count | strip                 | character
4     | 'Calvin & Hobbes'     | 'Calvin'
4     | 'Calvin & Hobbes'     | 'Hobbes'
2     | 'Pearls Before Swine' | 'Pig'
2     | 'Pearls Before Swine' | 'Rat' 
```

也就是说，我丢失了关于哪些字符出现在哪些条带中的所有额外信息。

我想得到的是：

```
count | strip                 | character
4     | 'Calvin & Hobbes'     | 'Calvin'
4     | 'Calvin & Hobbes'     | 'Hobbes'
2     | 'Pearls Before Swine' | 'Pig'
2     | 'Pearls Before Swine' | 'Rat'
4     | 'Pearls Before Swine' | 'Calvin'
4     | 'Pearls Before Swine' | 'Hobbes' 
```

但我似乎无法弄清楚。如果重要的话，我在 MySQL 上。也许它只需要两个查询。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:41:39.160

mySQL 是否支持分析函数？像：

```
SELECT foo.bar, baz.yoo, count(baz.yoo) over (partition by foo.bar) as yoo_count 
from foo, bar
where foo.baz_id = baz.id and baz.id in (...) 
```

或者：

```
SELECT foo.bar, baz.yoo, v.yoo_count 
from foo, bar, 
( select foo.baz_id, count(*) as yoo_count
  from foo
  group by foo.baz_id
) as v
where foo.baz_id = baz.id and baz.id in (...)
and v.baz_id = foo.baz_id; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:37:41.290

按 foo.bar 分组呢？

```
SELECT count(baz.id) as count, foo.bar, baz.yoo where foo.baz_id = baz.id and baz.id in (...) group by foo.bar 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T16:32:32.360

在 RDBMS 系统上，我会将计数查询选择到临时表中，然后将临时表重新加入主表。这将为您提供两全其美的体验。

不过，我不知道 mySQL 是否支持临时表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:36:18.530

如果 MySQL 支持分析/窗口函数，则：

```
select bar, yoo,
    count(yoo) over (partition by yoo) c 
from t
/ 
```

否则您需要使用相关子查询：

```
select bar, yoo,
    (select count(yoo) from t t2 where t2.yoo=t.yoo) c 
from t
/ 
```

在 oracle 上，测试数据如下所示：

```
create table t(bar number, yoo varchar2(16));

insert into t(bar, yoo) values (1, 'hello');

insert into t(bar, yoo) values (2, 'goodbye');

insert into t(bar, yoo) values (3, 'goodbye');

insert into t(bar, yoo) values (4, 'goodbye');

insert into t(bar, yoo) values (2, 'calvin');

insert into t(bar, yoo) values (5, 'Hobbes');

insert into t(bar, yoo) values (6, 'Hobbes');

commit; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T16:36:21.917

子选择：

```
SELECT foo.bar
    ,baz.yoo
    ,(SELECT COUNT(*) FROM baz AS baz2 WHERE baz2.yoo = baz.yoo etc.) AS yoo_count
FROM foo, baz
WHERE foo.baz_id = baz.id
    AND baz.id in (...) 
```

您还可以获取子选择并将其嵌套并加入。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T16:44:32.040

如果我要经常需要这样的计数字段，那么我创建一个用户定义的函数来返回值并在普通选择中使用它。

# asp.net - 如何在 System.Web.UI.Timer OnTick 之前运行 JavaScript？

> ID：439677
> 
> 赞同：0
> 
> 时间：2009-01-13T16:27:27.207
> 
> 标签：asp.net, javascript, asp.net-3.5, timer, confirmation

我需要一个客户端脚本来确认 Timer 的 OnTick 事件可以继续。

如何在 Timer1 回发发生之前调用*CanContinue() ？*
如果用户选择取消，我如何取消回发？

```
<%@ Page Language="C#" %>
<script runat="server">
    protected void Timer1_OnTick(object sender, EventArgs e)
    {
        Response.Write("Last Postback: " + DateTime.Now.ToString());
    }
</script>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Timer Test</title>
    <script type="text/javascript" language="javascript">
        function CanContinue() {
            return confirm('The page is requesting new data.  Ok or Cancel?');
        }
    </script>
</head>
<body>
    <form id="form1" runat="server">
        <asp:ScriptManager ID="ScriptManager1" runat="server" />
        <asp:Timer ID="Timer1" runat="server" OnTick="Timer1_OnTick" Interval="300000" />
    </form>
</body>
</html> 
```

* * *

注意：有些读者可能会对每 x 分钟显示一次模态确认有疑问。我同意这不利于可用性，但我无法更改设计。

* * *

更新：毕竟我决定不使用计时器。有关替代解决方案的详细信息，请参阅[此帖子。](http://robertclaypool.info/2009/01/21/javascript-and-timer-ontick/)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T16:58:02.027

我不知道是否有办法与计时器生成的方法绑定以调用服务器操作。但是，您可以获得对 javascript 组件的引用并启动/停止或更改间隔。考虑到这一点，你可以做一些讨厌的黑客攻击来获得你想要的功能。

例如：

1.  获得对您的计时器的参考。（类似于`$find(‘&lt;%= Timer1.ClientID %>’);`：）
2.  停止计时器。
3.  创建一个具有相同间隔的新计时器。
4.  执行您的计时器并导致条件。
5.  根据您的条件的返回值..您可以将服务器生成的计时器间隔设置为 ~0 并启动/停止。

这不是一个优雅的解决方案，但我不能说我曾经使用过内置的 asp.net 计时器，所以我不能提供太多的见解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T21:55:18.717

毕竟我决定不使用计时器。有关替代解决方案的详细信息，请参阅[此帖子。](http://robertclaypool.info/2009/01/21/javascript-and-timer-ontick/)

# sql-server - SQL Server 中针对 varchar 数据的算术运算符

> ID：439679
> 
> 赞同：1
> 
> 时间：2009-01-13T16:27:53.413
> 
> 标签：sql-server

有人可以向我解释一下算术运算符如 > 或 < 在 SQL Server 2005 中如何比较字符串吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T17:04:26.477

排序（因此 < > 运算符）取决于您的 SQL Server 排序规则：http: [//msdn.microsoft.com/en-us/library/ms144250 (SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms144250(SQL.90).aspx)

您必须在网络上找到该排序规则的规则。请注意，它们通常非常复杂。为了您的利益，除非您真的非常需要，否则我会尽量避免 VARCHAR 的 < 和 > 比较。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T17:08:50.367

感谢您及时的回复。

我问的原因是我需要查询英国邮政编码的数据库表。有问题的表有两个邮政编码列，“from_postcode”和“to_postcode”，我需要确定给定的邮政编码是否位于这些值之间。

幸运的是，数据的布局方式使我认为我应该能够使用算术运算符至少获得潜在匹配行的子集。

是时候写一些（或者可能是相当多的）uni 测试了！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:32:45.637

如果它们反对数字字段，它们的工作方式与您预期的一样。如果它针对字符类型的数据字段，它们将按字母顺序工作。因此，如果您想要大于 (>)10 且小于 (<)20，您可能会得到 11、110、123456 作为响应。

这就是为什么将希望能够进行数学计算或比较的数字存储为 varchar（或任何其他类型的 char 数据）总是一个坏主意的一个原因。只有不需要数学计算的数字（电话、邮编、ssn 等）应该以这种方式存储，并且应该始终存储在字符类型字段中以说明前导零。

# sql-server-2005 - 无需鼠标即可在 SQL Server Management Studio 2005 中修改单元格

> ID：439681
> 
> 赞同：2
> 
> 时间：2009-01-13T16:28:20.107
> 
> 标签：sql-server-2005, ssms

作为我工作的一部分，我总是对大量数据进行手动更改。我注意到的一件事是，在查看数据时，我可以使用箭头键浏览不同的单元格。但是当我转到一个新单元格时，其中的整个文本都会突出显示。如何使用键盘说我想要一个光标，这样我就可以修改文本而无需使用鼠标单击它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T16:32:50.877

点击 F2 开始修改。

# c# - 在c#中实现树管理父子

> ID：439686
> 
> 赞同：3
> 
> 时间：2009-01-13T16:29:12.913
> 
> 标签：c#, nhibernate, design-patterns, tree

我正在实现一棵树，将其视为文件夹结构，因此我有一个如下所示的类：

```
public class Folder
{
    //Various Props like Name etc.
    public IList<Folder> Children{get;}
    public Folder Parent {get;}
} 
```

现在我想要的是能够在树上上下走动，所以给定一个根我可以找到一个叶子，给定一个叶子我可以找到根节点。所以每个孩子都需要父母。现在的问题是向树中添加新节点的最佳方法是什么。我过去使用过两种解决方案：

1.  将 AddChild(Folder) 方法添加到处理添加文件夹的文件夹，并可以设置父级。这个问题是我现在必须锁定我的 Children 集合，这样你就不能绕过这个方法。
2.  创建我自己的 Children 集合，该集合将获得对实例的引用，因此它可以处理在添加时设置父级。这个问题我必须实现一个新的集合。
3.  使用在添加或删除项目时具有事件的集合。

我很好奇人们通常使用什么模式，然后是否有人对我的特定用例有任何建议。我正在使用 nHibernate 将我的树持久化到 SQL 服务器。我宁愿不实现自定义集合，因为它需要很多代码才能使它适用于我的应用程序的一小部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:57:19.470

在查看[MSDN](http://msdn.microsoft.com/en-us/library/e78dcd75.aspx)后，您可以尝试以下操作：

```
List<Folder> children;

public ReadOnlyCollection<Folder> Children
{
    get { return this.children.AsReadOnly(); }
} 
```

如果您的私有成员必须声明为 IList，那么我们可以将其复制到列表中，然后将其返回。但我真的不认为将具体实现用作私有成员有问题。稍后更改实现不会破坏兼容性。

```
IList<Folder> children;

public ReadOnlyCollection<Folder> Children
{
    get 
    { 
        return new List<Folder>(this.children).AsReadOnly(); 
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:37:46.203

就个人而言，我会选择方法 1。允许客户端代码直接操作 Children 集合在任何情况下都违反了封装，因此“锁定”Children 集合是正确的事情™。

保持节点关系正确的“正确”策略取决于客户的需求。我假设在这种特定情况下，您希望客户端能够自己更改子节点，但不能更改 Children 集合。如果是这样的话，我认为 Rob Prouse 的建议（让 Children 属性返回一个 IEnumerable）可能是最好的选择。在其他情况下，ReadOnlyCollection 可能会更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:40:15.700

我会选择选项 1，然后让 Children 属性看起来像这样：

```
 public IEnumerable<Folder> Children
    {
        get { return this.children.GetEnumerator(); }
    } 
```

现在必须调用 AddChild 来添加孩子。该集合不可访问。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T16:43:49.543

使用数字 1，但将您的 Children 属性设置为 IEnumerable，以便用户无法添加到集合中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T18:02:59.010

实现自定义集合的工作量很大；对仅公开两个或三个方法的现有集合类实现包装器不是。从您对 JayArr 的回复来看，这似乎就是您要寻找的东西。就像是：

```
public class ChildCollection
{
   // _Children is maintained by the Folder class, hence the internal access specifier
   internal Dictionary<KeyType, Folder> _Children = new Dictionary<KeyType, Folder>;

   public this[KeyType key]
   {
      get
      {
          return _Children[key];
      }
   }

   public IEnumerable<KeyType> Keys
   {
      get
      {
         return _Children.Keys;
      }
   }
} 
```

# timezone - 修复 Solaris 10 上的时区

> ID：439690
> 
> 赞同：1
> 
> 时间：2009-01-13T16:29:46.420
> 
> 标签：timezone, solaris

我不知道如何解决这个问题。在我的 /etc/TIMEZONE 文件中，TZ 变量具有正确的值（加拿大/东部），但仍然显示 -1 小时滞后。我还应该去哪里寻找？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-29T05:10:03.633

你应该检查你的硬件时钟是什么。我建议这样做：

*   正确设置 UTC 时间。即（示例中为凌晨 5 点）：

$ 日期 -u -s "05:00"

UTC 时间 2010 年 4 月 29 日星期四 05:00:00 AM

*   相应地设置硬件时钟（SPARC 为 tod，x86 为 rtc）：

$ rtc -c （'-c' 参数正确设置 DST）

*   再次检查日期：

$日期

2010 年 4 月 29 日星期四 02:00:11 AM 艺术

问候，

莱安德罗。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T01:59:00.247

你的机器是最新的补丁吗？2007 年北美的 DST 处理发生了变化。在我的 Solaris 10 上，我有：

-bash-3.00$ ls -l /usr/share/lib/zoneinfo/Canada/Eastern -rw-r--r-- 2 root bin 1252 2008 年 7 月 14 日 /usr/share/lib/zoneinfo/Canada/Eastern -bash -3.00$ openssl md5 /usr/share/lib/zoneinfo/Canada/Eastern MD5(/usr/share/lib/zoneinfo/Canada/Eastern)= 82980b1345aab5a97d90307edfefb6da

您是使用 NTP 自动设置时间还是手动设置时间？

沃尔克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-22T14:57:41.597

当您实际登录主机时，您的 shell 会话中设置了哪个时区？

如果您的 shell 会话中的时区与 /etc/TIMEZONE 不匹配，那么您可能需要重新启动以使时区更改生效。

如果你的 shell 会话中的时区是正确的，但实际时间是错误的，那么要么系统时钟关闭，要么时区定义文件有误。您可以运行“date -u”来获取 UTC 时间，这将帮助您确定实际时钟是否错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:39:14.000

那是要编辑的正确文件。**唯一需要的其他步骤是重新启动**。需要重新启动的原因是该`init`进程在启动时会读取 TZ 的值，并且所有其他进程都继承该值。据我所知，如果不完全重新启动，就无法使更改生效。

另外，请确保`/etc/TIMEZONE`符号链接到`/etc/default/init`. 例如：

`[root@server:/etc]ls -l /etc/ | grep TIMEZONE`

`lrwxrwxrwx 1 root root 14 Jul 7 2008 TIMEZONE -> ./default/init`

# c# - 如何从 .NET 运行记录的 (HTML) 硒测试

> ID：439693
> 
> 赞同：2
> 
> 时间：2009-01-13T16:30:07.873
> 
> 标签：c#, testing, selenium

我使用 .NET (c#) 中的 Selenium RC 运行 Selenium 测试。

在某些情况下，我想将测试用例源保留为 HTML（以便能够从 Selenium IDE 修改它），但我想从我的 c# 单元测试中运行/包含这些测试。

也许很明显，但是我在 Selenium Core 中找不到实现这一点的 API 方法。知道怎么做吗？

（我认为 Selenium on Rails 中的“includePartial”命令可以满足我的需要，但对于 c#。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-04T08:03:28.077

我前段时间问过这个问题，从那以后我在自动化功能测试方面取得了进展，更多的是通过[SpecFlow](http://www.specflow.org)的 BDD/ATDD/Specification 示例方向。

我现在才意识到，在我的实验过程中，我已经为这个具体问题实施了解决方案。我分享我的解决方案，也许可以帮助其他人。

我为 Selenium html 文件创建了一个小型解析器和一个解释器（您可以从这里下载：http: [//bit.ly/ciTMA2](http://bit.ly/ciTMA2)）。除了实现之外，这些类还向 Selenium 的 ICommandProcessor 接口添加了一些扩展方法。基于此，测试可能如下所示：

列表命令 = SeParser.ParseSeFile(@"HomePageTest.html"); selenium.Processor.InterpretCommands(commands); selenium.Processor.AssertNoVerifyErrors();

（InterpretCommands 和 AssertNoVerifyErrors 是自定义扩展方法。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T16:33:21.203

上次我使用 Selenium RC .NET 时，我认为没有办法做到这一点

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-12T12:57:42.217

在 Selenium IDE 中工作时，您可以通过转到 Options-> Format 来设置格式，然后将其设置为您选择的语言。这意味着您可以创建 c# 测试，而无需随时转换它们。您仍然可以右键单击并选择您的命令，它将在 IDE 中更新为 c#。

我想这就是你所追求的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-29T08:48:30.057

可能您可以解析测试的 xhtml 并使用 .NET 反射将其转换为方法调用，但这需要您做一些工作

# java - 使用 CORBA 进行 Java/C++ 互操作的最佳 ORB 是什么？

> ID：439704
> 
> 赞同：7
> 
> 时间：2009-01-13T16:32:56.820
> 
> 标签：java, c++, corba

我有一个用 Java 编写的客户端-服务器应用程序，使用 CORBA 进行通信。使用的ORB 是orbd，Java6 平台提供的ORB。我必须将 Java 服务器实现替换为另一个用 C++ 编写的实现。所以问题是，在 CORBA 库的免费源代码实现中，哪个更好地与这个 ORB 互操作？我是否应该替换 Java ORB 并同时使用 C++ 库提供的 ORB？

目标是在用新的 C++ 实现替换已经运行的服务器时实现简单而平稳的过渡。还有什么我应该考虑的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T22:49:44.253

很久没有使用 CORBA 来实现 Java 和 C++ 的互操作性了，所以我的回答可能会有点过时。

我发现可以很好地协同工作的是omniORB (C++) 和JacORB (Java)。您可以在 google 上搜索这些库，看看它们是否仍然受支持。

我还记得我在使用“原生”Java CORBA 时遇到了很大的问题（Sun Bugs Parade 中有很多错误，已经开放了很多年......）但那是在 JDK1.4 的时候，希望现在情况会好一些...... .

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:14:23.257

TAO 绝对是商业上使用最多的开源 C++ ORB。它与 JacORB 作为 Java ORB 配合使用非常好，但您也可以使用 JDK ORB。如果该软件当前可与 JDK ORB 一起使用，那么它没有理由不能与 TAO 一起使用。如果您遇到任何问题，您可以将 JDK ORB 替换为 JacORB。

哦，关于上一篇文章，ZEN Java ORB 已死，不再开发。对于 Java，如果 JDK ORB 不足以满足您的需求，您应该使用 JacORB。

如果您需要商业支持，它也可用。我们使用 Remedy IT ( [http://www.remedy.nl](http://www.remedy.nl) ) 来满足我们的支持需求（TAO 和 JacORB）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-22T11:25:24.897

我有一些 Java 客户端将大量数据推送/拉入用 Mico 编写的 C++ 服务器。永远不要与他们有任何问题。

我们也在使用 Visibroker 来实现它的负载平衡功能，但很快就会摆脱它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T13:19:11.627

### C++

你看过 ACE/TAO ORB。
[https://www.dre.vanderbilt.edu/~schmidt/TAO.html](https://www.dre.vanderbilt.edu/%7Eschmidt/TAO.html)

ACE 基本上是一个操作系统抽象层。
TAO 是建立在这个抽象之上的 CORBA ORB，因此它是跨平台的。

### 爪哇

TAO 的 Java 版本是 ZEN：
[http ://www.zen.uci.edu/](http://www.zen.uci.edu/)

尽管从技术上讲，您的 ORB 不需要相同。只要符合 CORBA 协议/规范，它们就应该是可互操作的。因此，尽管您可以使用 ZEN，但使用 JacORB 也同样容易。

# c# - VS 2008 中的解决方案文件

> ID：439706
> 
> 赞同：1
> 
> 时间：2009-01-13T16:33:14.213
> 
> 标签：c#, visual-studio, projects-and-solutions

我引用了一个位于解决方案文件夹中的配置文件。然后我在我的项目中引用该文件。发布项目时如何将该配置文件放入 bin 目录？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T16:36:29.467

选择文件，然后选择属性->复制到输出目录->始终复制

# multithreading - 是否存在应用程序实例跨多台计算机运行的情况？

> ID：439714
> 
> 赞同：0
> 
> 时间：2009-01-13T16:35:23.167
> 
> 标签：multithreading, cloud, cluster-computing

我们知道单个应用程序实例可以使用多个内核甚至多个物理处理器。对于云计算和集群计算，或者其他特殊场景，我不知道一个stance 是否可以跨多台计算机运行，或者跨多个OS 实例。

这对我来说很重要，因为除了被认为是糟糕的编程之外，我还使用了一些静态**（如在 C# 中）**（全局）变量，如果这些变量在计算机之间共享，我的程序可能会出现意外行为。

**更新**我会更具体：我正在编写一个 .NET 应用程序，它有一个变量来计算活动 IP 连接的数量，以防止连接数量不超过每台计算机的限制。我担心我是否将该应用程序部署在云计算主机中，是否每台计算机都有一个变量实例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:01:36.717

如果你想学习如何实现这样的场景（跨多台计算机的单个实例），我认为你应该阅读一些关于[MPI](http://en.wikipedia.org/wiki/Message_Passing_Interface)的文章。

> 它已成为模拟在分布式内存系统上运行的并行程序的进程之间通信的*事实上的标准。*

关于您的担忧：显然，您需要以某种方式有意识地更改程序以在多台计算机上作为一个实例运行。否则，当然不会发生共享，正如[Shy 所写](https://stackoverflow.com/questions/439714/is-there-any-scenario-where-an-application-instance-runs-across-multiple-computer#439786)，没有什么可担心的。这种事情不会自动发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:02:32.423

您使用的是什么编程环境（语言）？它应该准确定义“静态”的含义。很可能它不允许在不同计算机之间共享任何信息，除非通过诸如 MPI 或 RPC 之类的显式通道。

但是，抽象的高级环境可能会被设计为完全隐藏“在多台计算机上运行”的概念。可以想象设计一个可以在集群上运行的虚拟机，并且实际上在不同的物理机之间共享静态变量——但是在这种情况下，您的程序运行在单个虚拟机上，无论是运行在一台还是多台物理机上都应该没有任何区别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:53:10.710

如果您甚至无法想象会发生这种情况的情况，您为什么要担心呢？

通常，这可能发生在涉及某种 RPC 的场景中。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-13T17:24:36.357

嗯，是的，有 distcc。它是分布式的 GCC 编译器。

# java - MIDP 堆与 VM 堆

> ID：439721
> 
> 赞同：0
> 
> 时间：2009-01-13T16:36:33.803
> 
> 标签：java, java-me, mobile

一些 Java 移动设备具有不同的 MIDP 和 VM 堆。这两个堆之间有什么区别，J2ME 应用程序如何控制用于给定数据的部分？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:00:34.707

您无法控制 MIDlet 使用哪一个，它由 KVM 的实现决定（因此由生产者决定）。通常，当设备有两个单独的堆时，它使用一个来保存“公共”数据，另一个来保存图片或视频剪辑等媒体，但同样，这取决于生产者，您不能强制分配对象通过 J2ME 堆而不是另一个堆

# c++ - 与 Mac OS X 上的间接依赖关系的链接问题

> ID：439727
> 
> 赞同：1
> 
> 时间：2009-01-13T16:38:07.653
> 
> 标签：c++, macos, boost, linker

我们有一些间接依赖的链接问题。从我在网上阅读的内容猜测，这可能是因为使用了两级命名空间。当我们链接到 boost 库时会发生这种情况，确切地说是 boost_filesystem，它本身依赖于 boost_system。链接器不解决 boost_filesystem 和 boost_system 之间的依赖关系。有人可以给我一些提示如何解决这个问题吗？手动将 boost_system 添加到依赖项中感觉很难看，此外，它在其他平台上也能正常工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T23:36:07.190

Mac 上某些版本的静态链接编辑器 ld 不会通过 -L 选项解析间接依赖关系，而是通过直接依赖关系中的 install_name 来查找它们。在 boost_filesysten 上运行 otool -L 将显示 ld 在哪里寻找 boost_system。

您可以使用 install_name_tool 更改 install_name，也可以使用

-dylib_file install_name:file_name

ld 的选项，这只是告诉 ld 每当遇到与冒号之前的参数部分匹配的 install_name 路径时，它实际上应该从冒号之后的路径中获取该库。

我认为 ld 的较新版本现在确实尊重 -L 对 Mac 的间接依赖，但我不确定。我只使用了 10.4，它的 ld 忽略了 -L 用于间接依赖，我使用 -dylib_file 摆脱了许多其他人为了解决你描述的问题而投入的幻影显式依赖！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T15:54:50.097

如果 boost_filesystem 使用来自 boost_system 的符号（而您的应用程序不是），并且它本身直接链接到 boost_system 以解决它们，它应该可以正常工作。当您期望您链接的库的依赖项提供的符号在您的应用程序中可用时，平面与两级命名空间问题通常会抬头。

如果 boost_filesystem 没有链接到 boost_system（otool -L 会告诉你），那么你几乎没有选择——除了重新链接它——除了手动添加对 boost_system 的依赖。

我认为 boost 不使用 GNU libtool 是否正确（它以正确的特定于平台的方式为您处理库间依赖关系）？如果是这样，那可能是一个简单的解决方法。

# c# - 使用依赖注入的存储库和专用存储库的装饰器链接

> ID：439729
> 
> 赞同：1
> 
> 时间：2009-01-13T16:39:07.027
> 
> 标签：c#, dependency-injection, domain-driven-design, repository-pattern, decorator-chaining

现在，我正试图找出一种更聪明地做事的方法，在此过程中，我设法做的就是在一天内使用一整瓶 excedrin。

假设我有一个像这样的名为 IRepository 的接口。

```
 public interface IRepository<T>
 {
    T Get(int id);
    void Add(T value);
    void Update(T value);
    void Delete(T value);
    ...
 } 
```

并假设我有一个像

```
public class NHibernateRepository<T>
{
    ...
} 
```

现在，一切都很好，我可以对存储库执行所有基本操作以支持所有 CRUD 功能，但我可能需要专门的操作，所以假设我有一个这样的界面：

```
public interface IUserRepository : IRepository<User>
{
     IList<User> GetUsersByRole(Role role);
} 
```

和这样的实现：

```
public class UserRepository : NHibernateRepository<User>, IUserRepository
{
    ....
} 
```

好的，这就是基本设置，现在我还想做一件事。我想要透明地进行日志记录和事务以及类似的事情。所以我想做的是使用像 Castle Windsor 或 StructureMap 这样的依赖注入框架，这样当我请求 IRepository 时，我会用 LoggingRepository 和 TransactionRepository 包装它，这两个都实现了 IRepository。

所以，我想做的是这样的：

```
IUserRepository repository = container.Resolve< IUserRepository>(); 
```

并让它返回一个包含在 Logging 和 Transaction 装饰器中的用户存储库，但我想不出一种可行的方法。我能想到让它工作的唯一方法是像这样实现 UserRepository：

```
public class UserRepository : DecoratorRepository<T>, IUserRepository
{
    protected IRepository<T> Repository { get; set; }

    public UserRepository(IRepository<T> innerRepository)
    {
        Repository = innerRepository;
    }
} 
```

这意味着我们将使用依赖注入来创建一个修饰的存储库并将其传递给 UserRepository 的构造函数，然后将其用作我们对其运行操作的存储库。这会起作用，但我仍然认为它不是理想的。

所以，我的问题是，我是对的，这是做到这一点的唯一方法，还是我没有正确理解这一点，或者只是错过了一些东西。另外，如果你以前遇到过这个问题，你是如何解决这个问题的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:59:26.190

如果您要使用听起来正确的[装饰器。](http://en.wikipedia.org/wiki/Decorator_pattern)每个装饰器都有一个带有 IRepository 参数的构造函数，并围绕调用它正在装饰的内部存储库调用日志记录或事务代码。

作为替代方案，您可能会考虑，但我对面向方面编程的经验很少。在这种情况下，您将属性应用于您的类，以指示您要使用的日志记录或事务方法。在某些时候，这些方法会被编织到您的代码中，这可以作为额外的编译步骤来完成，或者在[SpringFramework.net](http://www.springframework.net/doc-latest/reference/html/aop.html)的情况下在注入时完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:55:45.963

难道你不能有一个 LoggingRepository 抽象基类来处理你不同的 Get、Add、Update、Delete 的日志记录，使它们成为虚拟然后从它们继承吗？

我不确定您要解决什么问题，因为我认为您可能已经尝试过了？您也可以包装事务，尽管您很可能希望在您的 NHibernateRepository 中执行此操作。

# html - 在grails中制作下载选项

> ID：439734
> 
> 赞同：3
> 
> 时间：2009-01-13T16:40:22.860
> 
> 标签：html, grails, gsp

> **可能重复：**
> [Grails 文件下载](https://stackoverflow.com/questions/396677/grails-file-download)

我正在接受网络开发培训。我想创建一个页面，显示 D://downloads 目录中的所有文件。我在 grails 中制作了该部分。如果我单击特定文件，我想下载该文件。我不知道如何制作那部分。我做了谷歌搜索。但我不能那样做。

我的代码是

```
 <g:each in="${fileList}" var="filename" status="i">
    ${filename}
   <!-- Codes to make a file downloadable-->
  </g:each> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T16:46:39.400

您只需要设置正确的标题，以便浏览器知道它需要下载的文件。我不确定如何在 grails 中做到这一点。[http://support.microsoft.com/kb/260519](http://support.microsoft.com/kb/260519)

# java - 从 Java 集合中删除对象

> ID：439738
> 
> 赞同：0
> 
> 时间：2009-01-13T16:42:08.753
> 
> 标签：java, collections

我有一个`HashMap`对象（尽管我猜这个问题适用于其他集合）。据我了解，当文档谈到删除映射时，它是从哈希表中删除条目，即不一定会破坏实际对象。如果对该对象的唯一剩余引用在此表中，那么该对象是否会被垃圾回收？

如果我这样做`map.clear()`并且表中的那些对象没有在其他任何地方引用，它们会被垃圾收集吗？

什么是最快的方法，实际上从表中删除所有条目，但也销毁这些对象。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T16:43:50.497

是的，如果集合是这些对象被引用的最后一个位置，那么在从集合中删除它们之后，它们就有资格进行垃圾回收。不，你不能强行破坏这些物体。垃圾收集器会在需要时处理它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:48:25.557

请注意，[WeakHashMap](http://java.sun.com/j2se/1.4.2/docs/api/java/util/WeakHashMap.html)允许您在其中放置对象并让它们符合垃圾回收的条件，只要不再引用映射之外的键（而不是值） - 此时映射条目将消失。

通常，您不必担心对象*何时*被垃圾回收——JVM 会决定这一点，并且它比您更了解内存需求和可能的延迟。您*应该*担心的是确保您不再需要的对象有*资格*进行垃圾收集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T16:48:32.017

> 如果对该对象的唯一剩余引用在此表中，那么该对象是否会被垃圾回收？

如果没有对某个对象的其他引用，那么该对象将在将来的某个时间被垃圾回收。

您不必强制销毁对象。如果它们是非常重量级的对象（或者您有太多的对象无法放入内存），这表明您的代码存在更根本的问题。

如果你真的必须，那么你可以调用`System.gc()`，虽然这不是一个好的做法，并且永远是你代码中潜在问题的领头羊。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T16:52:24.537

一般来说，您无法严格控制何时专门销毁对象。当没有更多（强）引用时，任何对象都有资格进行垃圾收集 - 但不能保证它何时会被垃圾收集，或者实际上是否会被垃圾收集。即使调用[System.gc()](http://java.sun.com/javase/6/docs/api/java/lang/System.html#gc())或[Runtime.gc()](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#gc())也不能保证实际执行任何操作，这只是对 JVM 的一个提示，它现在可能要考虑进行垃圾收集。我相信您得到的唯一保证是，如果抛出 OutOfMemoryError，则所有潜在的垃圾收集都在抛出错误之前完成。

这里对处理密码等敏感信息有影响。由于无法以编程方式清除字符串，因此理想情况下您不希望这样存储密码。如果您将其存储为字符数组，则可以使用`Arrays.fill(' ')`它来覆盖密码并保证从那时起它不再驻留在内存中。

回到主题 - 如果没有在其他地方引用，那么这两个操作都会使对象符合垃圾收集的条件，这是对的。Collection.clear() 确实是一次删除对集合中所有对象的引用的最快方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T16:50:55.613

要真正收集垃圾，不能对对象进行强引用。带有[弱引用的](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/ref/WeakReference.html)对象可能会被[垃圾回收](http://www-128.ibm.com/developerworks/java/library/j-jtp11225/)。使用 Wea​​kHashMap 确保它们被垃圾回收，因为在 HashMap 中仍然存在对该对象的引用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T16:46:13.503

您可以在清除地图后发起对 System.gc() 的调用，但这通常不是一个好主意。

# visual-sourcesafe - 视觉源安全版本 8

> ID：439740
> 
> 赞同：0
> 
> 时间：2009-01-13T16:43:44.193
> 
> 标签：visual-sourcesafe, visual-sourcesafe-2005

我的问题是，当我从 SS 中签出项目时，有时我无法获得最新版本的项目，而当我将项目签入 SS 时，.frx 文件已损坏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T16:48:07.523

你和SS绑定了吗？您不能使用更现代的存储库吗？Subversion 将是一个好的开始。入门非常容易，比我想象的要容易得多。

如果没有，那么您必须运行一个工具来找出损坏是什么，然后尝试清理它或重置它。您也可以检查服务器时间，因为有时这会导致问题。服务器时间应该和我相信的开发机器一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T16:54:23.783

首先，我没有解决方案，但我认为你正在打死马。

Source (Un)Safe 不好，而且从来都不是，但它的问题很少会出现，直到它被使用了一段时间。

相信我，如果你找到一个不同的系统来保存你的源代码会更好。

这就像在说“我 25 年的生锈车每天早上都不能启动，我该如何修理它？” 答案当然是放弃它并获得一辆新车。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T16:58:29.763

.frx？那是一个VB6表单资源文件对吗？

Vss 经常遇到这些文件的问题，因为它使用散列来确定文件是否已更改。将您的 VSS 设置切换为使用修改后的日期。

**编辑**：一个警告，VSS 不了解夏令时，因此每六个月它认为你所有的文件都应该是日期的，并再次获取很多文件。不会造成太大的伤害，但真的很烦人。

# xml - Flash AS2：如何将 CDATA 发布到服务器？

> ID：439747
> 
> 赞同：1
> 
> 时间：2009-01-13T16:44:44.410
> 
> 标签：xml, flash, actionscript-2, cdata

我有一个 XML 对象，我想通过 HTTP POST 发送给我的播放器。使用 XML.sendAndLoad 时这一切都很好。

问题是当我生成的 XML 对象包含 CDATA 时，CDATA 在 POST 发生之前被剥离。

所以如果我有：

```
var xml:XML = new XML("<root><tag><![CDATA[hello]]></tag></root>") 
```

当我执行 sendAndLoad 时，这就是发布的内容：

```
<root><tag>hello</tag></root> 
```

当我尝试使用 createElement、createTextNode 和 appendChild 等 XMLDOM 方法创建 XML 时，也会发生同样的情况。

AS2 文档说不支持 CDATA。有解决方法吗？我认为它可以通过扩展和覆盖 XML 类来解决，但我还没有找到一种方法来做到这一点。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T16:52:59.590

这是预期的行为。XML 解析器在构建其树时替换 CDATA。发送的是树的序列化，没有 CDATA。

如果要发送原始 XML 源，则必须将其作为纯字符串数据发送。

顺便说一句，我看不出这怎么可能是个问题，因为两者在语义上是相同的，即 "<![CDATA[hello]]>" 和 "hello" 给出相同的字符串。CDATA 只是一种引用语法，而不是重要的标记。但是，如果 CDATA 包含特殊字符，则可能会出现问题。您必须正确引用它们。

# tsql - T-SQL：通过连接选择要删除的行

> ID：439750
> 
> 赞同：519
> 
> 时间：2009-01-13T16:45:21.600
> 
> 标签：tsql, join

设想：

假设我有两个表，TableA 和 TableB。TableB 的主键是单列（BId），是TableA 中的外键列。

在我的情况下，我想删除 TableA 中与 TableB 中特定行链接的所有行：我可以通过联接来做到这一点吗？删除从联接中拉入的所有行？

```
DELETE FROM TableA 
FROM
   TableA a
   INNER JOIN TableB b
      ON b.BId = a.BId
      AND [my filter condition] 
```

还是我被迫这样做：

```
DELETE FROM TableA
WHERE
   BId IN (SELECT BId FROM TableB WHERE [my filter condition]) 
```

我问的原因是，在我看来，第一个选项在处理更大的表时会更有效。

谢谢！

* * *

## 回答 #1

> 赞同：766
> 
> 时间：2009-01-13T16:50:12.323

```
DELETE TableA
FROM   TableA a
       INNER JOIN TableB b
               ON b.Bid = a.Bid
                  AND [my filter condition] 
```

应该管用

* * *

## 回答 #2

> 赞同：268
> 
> 时间：2009-01-13T16:51:51.010

我会使用这种语法

```
Delete a 
from TableA a
Inner Join TableB b
on  a.BId = b.BId
WHERE [filter condition] 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-01-13T16:50:18.377

是的你可以。例子 ：

```
DELETE TableA 
FROM TableA AS a
INNER JOIN TableB AS b
ON a.BId = b.BId
WHERE [filter condition] 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2011-07-22T12:55:07.263

试图使用访问数据库执行此操作，发现我需要在删除后立即使用**a.* 。**

```
DELETE a.*
FROM TableA AS a
INNER JOIN TableB AS b
ON a.BId = b.BId
WHERE [filter condition] 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-08-02T14:58:11.753

在**MySQL**中几乎相同，但您必须在单词“DELETE”之后使用**表别名：**

```
DELETE a
FROM TableA AS a
INNER JOIN TableB AS b
ON a.BId = b.BId
WHERE [filter condition] 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-11-19T19:14:58.847

上面的语法在 Interbase 2007 中不起作用。相反，我不得不使用类似的东西：

```
DELETE FROM TableA a WHERE [filter condition on TableA] 
  AND (a.BId IN (SELECT a.BId FROM TableB b JOIN TableA a 
                 ON a.BId = b.BId 
                 WHERE [filter condition on TableB])) 
```

（注意 Interbase 不支持别名的 AS 关键字）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-22T17:19:44.530

我正在使用这个

```
DELETE TableA 
FROM TableA a
INNER JOIN
TableB b on b.Bid = a.Bid
AND [condition] 
```

并且@TheTXI 方式已经足够好了，但我阅读了答案和评论，我发现必须回答的一件事是在 WHERE 子句中使用条件或作为连接条件。所以我决定对其进行测试并编写一个片段，但没有发现它们之间有任何有意义的区别。您可以在此处查看 sql 脚本，重要的是我更喜欢将其写为 commnet，因为这不是确切的答案，但它很大并且不能放在评论中，请原谅我。

```
Declare @TableA  Table
(
  aId INT,
  aName VARCHAR(50),
  bId INT
)
Declare @TableB  Table
(
  bId INT,
  bName VARCHAR(50)  
)

Declare @TableC  Table
(
  cId INT,
  cName VARCHAR(50),
  dId INT
)
Declare @TableD  Table
(
  dId INT,
  dName VARCHAR(50)  
)

DECLARE @StartTime DATETIME;
SELECT @startTime = GETDATE();

DECLARE @i INT;

SET @i = 1;

WHILE @i < 1000000
BEGIN
  INSERT INTO @TableB VALUES(@i, 'nameB:' + CONVERT(VARCHAR, @i))
  INSERT INTO @TableA VALUES(@i+5, 'nameA:' + CONVERT(VARCHAR, @i+5), @i)

  SET @i = @i + 1;
END

SELECT @startTime = GETDATE()

DELETE a
--SELECT *
FROM @TableA a
Inner Join @TableB b
ON  a.BId = b.BId
WHERE a.aName LIKE '%5'

SELECT Duration = DATEDIFF(ms,@StartTime,GETDATE())

SET @i = 1;
WHILE @i < 1000000
BEGIN
  INSERT INTO @TableD VALUES(@i, 'nameB:' + CONVERT(VARCHAR, @i))
  INSERT INTO @TableC VALUES(@i+5, 'nameA:' + CONVERT(VARCHAR, @i+5), @i)

  SET @i = @i + 1;
END

SELECT @startTime = GETDATE()

DELETE c
--SELECT *
FROM @TableC c
Inner Join @TableD d
ON  c.DId = d.DId
AND c.cName LIKE '%5'

SELECT Duration    = DATEDIFF(ms,@StartTime,GETDATE()) 
```

如果你能从这个脚本中得到很好的理由或写另一个有用的，请分享。谢谢并希望这有帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-06-13T18:36:35.627

假设您有 2 个表，一个带有 Master 集（例如，Employees）和一个带有子集（例如 Dependents），并且您想要摆脱 Dependents 表中无法键入的所有数据行与主表中的任何行。

```
delete from Dependents where EmpID in (
select d.EmpID from Employees e 
    right join Dependents d on e.EmpID = d.EmpID
    where e.EmpID is null) 
```

这里要注意的一点是，您首先从连接中收集 EmpID 的“数组”，然后使用该组 EmpID 对 Dependents 表执行删除操作。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-07-20T17:31:01.920

在 SQLite 中，唯一有效的是类似于 beauXjames 的回答。

似乎归结为这一点 `DELETE FROM table1 WHERE table1.col1 IN (SOME TEMPORARY TABLE);` ，一些临时表可以通过 SELECT 和 JOIN 你的两个表来创建，你可以根据要删除 Table1 中记录的条件过滤这个临时表。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-01-10T13:27:53.683

您可以运行此查询：

```
 DELETE FROM TableA
    FROM
       TableA a, TableB b 
    WHERE
       a.Bid=b.Bid
    AND
       [my filter condition] 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-02-22T20:22:33.103

更简单的方法是：

```
DELETE TableA
FROM TableB
WHERE TableA.ID = TableB.ID 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-12-03T17:43:03.473

```
DELETE FROM table1
where id IN 
    (SELECT id FROM table2..INNER JOIN..INNER JOIN WHERE etc) 
```

尽量减少对连接的 DML 查询的使用。您应该能够使用上述子查询执行大多数 DML 查询。

通常，仅当您需要按 2 个或更多表中的列进行 SELECT 或 GROUP 时才应使用连接。如果您**只是**接触多个表来定义总体，请使用子查询。对于 DELETE 查询，使用相关子查询。

# java - 在 Java 中访问声卡或操作系统合成器设备

> ID：439758
> 
> 赞同：1
> 
> 时间：2009-01-13T16:47:05.607
> 
> 标签：java, synthesizer

当我尝试在 Java (1.6.0) 中列出 Synthesizer 设备时，我只得到一个设备*Java Sound Synthesizer*。我想在声卡中使用合成器或使用任何其他已安装的合成器，例如。微软合成器。我该怎么做呢？如果此功能不是内置的，是否有任何开源项目充当前端来安装合成器驱动程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T23:31:30.220

我不相信 java 让你指定使用哪个已安装的合成器。API 通常只为每种类型（合成器、发射器等）提供一个设备，因此您将获得默认值。我怀疑windows下的java API实际上正在使用控制面板中指定的任何一个作为默认MIDI设备。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T17:59:49.320

Frinika 可以做到这一点，因此它可能会掌握答案。

**编辑**：在 Java 1.5 及更高版本中，大多数 OS Midi 设备都显示为可以使用`MidiSystem.getMidiDeviceInfo()`和访问的设备`MidiSystem.getMididevice()`。

根据 midi 常见问题解答，由于为每个声卡编写自定义驱动程序以及从没有 Midi 标准的硬件获取信息存在问题，因此没有将声卡 Midi 设备**作为合成器访问的好方法。**

然而，硬件合成器通常会显示为可以向其发送事件的 MidiDevice。（[http://www.jsresources.org/faq_midi.html#use_hw_synth](http://www.jsresources.org/faq_midi.html#use_hw_synth)）。

感谢奥术为我指明了正确的方向。

# php - PHP、Python、PostgreSQL 设计是否适合业务应用程序？

> ID：439759
> 
> 赞同：2
> 
> 时间：2009-01-13T16:47:39.037
> 
> 标签：php, python, postgresql

我正在寻找一些关于我要构建的业务应用程序的快速想法。我想分别使用**PHP**、**Python**和**PostgreSQL来分离****表示**层、**域逻辑**和**数据**的三层。我想听听，可能是从以前走这条路的其他人那里，如果这种方法有问题，我是否针对错误的工具等。

 *******   我正在关注**PHP**，因为它被广泛使用，相当成熟，而且我可以找到大量具有 PHP 界面设计技能的人。

*   我看**Python**是因为代码可读性的好处，因为我听说可以找到更多具有主题技能（在本例中为金融）的 Python 程序员，而且它是一种开源语言。另外，它似乎更容易编码。

*   我正在寻找**PostgreSQL**的事务级功能。**MySQL**也是这里的一个选项，但我不需要讨论这个方面。

这不是一个 Web 应用程序，尽管我想使用浏览器作为用户界面。这更像是一个企业应用程序，但适用于用户数量适中（可能 5-10 个）和日常交易数量适中的小型企业。

重要的是我们将来能够独立于其他层升级数据库或域逻辑或接口。

*我不是在寻找购买与构建的辩论*，因为这是一个不同的讨论。

感谢您的任何见解

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T16:56:15.713

看看[姜戈](http://www.djangoproject.com)。

Python 代码。一种模板语言，它允许一些与 PHP 相同的功能——语法略有不同。

模型与视图功能（“业务规则”）分离，与表示分离。这是在整个 Django 中强制执行的。

常见的问题之一是“为什么我不能在 Django 模板中做一些疯狂的类似 PHP 的事情？” 答案是演示文稿没有处理。在 Django 视图函数中进行处理。在模板中将结果呈现为 HTML。

此外，Django 有一个 ORM 层，可以让您摆脱琐碎的 SQL 考虑。MySQL 或 PostgreSQL 在 Django 中或多或少是等价的。

* * *

**编辑**

“成熟”意味着很多东西。您特别提到熟练的人是成熟的标志。

Django 是纯 Python。如果你能找到 Python 的人，他们可以在几天内学习 Django。他们只需要做教程。

*   由 Django 驱动的站点通常是 Apache + 一些胶水 + Django。胶水可以是 mod_wsgi 或 mod_python 或 mod_fastcgi。您必须小心管理此配置，因为有几个活动部件。然而，这与您在使用 PHP 时遇到的 Apache 配置问题相同——这里没有什么新鲜事。

*   一个 Django 站点有一个或多个 Django 服务器实例，每个实例都有一个设置文件、一个 URL 映射和任意数量的应用程序。此时纯Python。

*   Django 应用程序具有 URL 映射、模型和视图。所有纯 Python。使用 Python 自己的内部单元测试框架的 Django 扩展进行单元测试。

*   该模型使用 ORM 层。这可能是 Django 中最令人困惑的事情。人们有时会设计非常奇怪的模型，因为他们认为要么太高级——超级泛型，要么在 SQL 中想得太多。Django 是一个主要面向对象的中间地带，并考虑了一些 SQL。得到这个，你就势不可挡。

*   Django 应用程序可能有模板，这些模板使用自己的模板语言。这将是唯一令人感兴趣的非 Python 事物。您可能想要添加自定义标签——纯 Python。

*   您可能会使用 JavaScript（对于 PHP 和所有其他 Web 应用程序框架也是如此）。这里没有什么新鲜事。

*   由于 Django 的管理应用程序会自动处理基本的 CRUD 处理，因此您不必编写此代码。您可以自由编写所有您想要的事务性内容。但你不必这样做。这将导致您获得非常非常强大的混合动力。

    *   您编写了一些复杂的关键事务。纯 Python，顺便说一句。

    *   您不会编写任何愚蠢的表维护事务。没有任何代码优于 Python 或 PHP。

    *   在您熟悉模板引擎和 CSS 之后，您可以定制管理界面以使其看起来像您想要的任何东西。这是 HTML/CSS 的东西，没有 Python 或 PHP。

底线。大多数技能是Python。ORM 在语法上是 Python，但在简单而干净地做事时需要小心。模板是它自己的语言，但比 PHP 简单得多。其余的是 SQL、Javascript、HTML、CSS、Apache 等等。

* * *

**编辑**

Django 成熟度

*   有关活动项目的数量，请参见[http://www.djangoproject.com/community/](http://www.djangoproject.com/community/)。

*   加入[http://groups.google.com/group/django-users](http://groups.google.com/group/django-users)，每天都会收到大量来自用户的电子邮件。

Django 博客可以追溯到 05 年，这意味着他们在 08 年 9 月最终发布 1.0 之前拥有多年的扎实经验。开发显然是从 03 年开始的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:12:47.900

我将假设“业务应用程序”是指托管在 Intranet 环境中的 Web 应用程序，而不是 Internet 上的某种 SaaS 应用程序。

在构建应用程序的过程中，您需要考虑现有的基础架构和基础架构支持您的雇主/客户的人员。此外，如果公司足够大，可以拥有诸如“已批准的软件/硬件列表”之类的内容，那么您应该了解这些内容。请记住，列表中的某些元素可能完全迟钝。不要让过去的错误决定你的应用程序的架构，但如果它们是合理的，我会选择我的战斗并坚持你的企业标准。当您选择一个真正在 Unix/Linux 上运行最好的开发堆栈，然后有人试图强行进入由除了 ASP.NET 应用程序之外从未接触过任何东西的人管理的 Windows 服务器上时，这可能是一个真正的痛苦。

除非您打算使用没有 Python 等效项的特定 PHP 模块，否则我会放弃 PHP 并使用 Django。如果有一个令人信服的理由使用 PHP，那么我会放弃 Python。我很难想象你想同时使用两者的场景。

至于 PG 与 MySQL，两者都可以。看看你的客户已经部署了什么，如果他们有一堆，一个很少，选择那个。如果他们有现有的 Oracle 基础架构，您应该考虑使用它。如果他们是 SQL Server 商店...重新考虑您的堆栈并记住选择您的战斗。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T19:46:13.357

我只能重复这里其他人已经说过的话：如果您选择 Python 作为领域层，那么使用 PHP 作为表示层将不会获得任何好处（恰恰相反）。其他人已经建议使用 Django，这可能是一个不错的选择，但不乏优秀的 Python Web 框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T16:55:15.963

我个人同意你帖子中的第二点和第三点。说到 PHP，在我看来，您也可以使用 Python 进行演示，有很多基于 Python 的解决方案（Zope、Plone ...）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T17:00:41.447

只需跳过 PHP 并使用 Python（使用 Django，正如我在键入时已经注意到的那样）。正如您提到的，Django 已经将这些层分开了。

我自己从未使用过 PgSQL，但我认为您是否更喜欢它而不是 MySQL，这主要是一个品味问题。它曾经支持比 MySQL 更多的企业功能，但我不确定 MySQL 5.0 和 5.1 是否仍然如此。无论如何，MySQL 都支持事务（但是您必须使用 InnoDB 表引擎）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T18:06:45.320

只是为了解决 MySQL 与 PgSQL 的问题——没关系。他们都能够胜任这项任务，任何合理的框架都应该相对较好地将您与差异隔离开来。我认为这取决于您已经使用了什么，人们在什么方面最有经验，以及您认为您会从中受益的一个或另一个功能。

如果您没有偏好，您可能只想使用 MySQL，因为它在 Web 工作中更受欢迎。这意味着更多的例子，更容易找到帮助，等等。我实际上更喜欢 PgSQL 的哲学，但这并不是一个足以反对风的理由。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T01:01:43.123

只是把它扔在那里......有使用MVC的PHP框架。

Codeigniter 做简单但功能强大的事情。您绝对可以将模板层与逻辑层分开。

# java - VMware 来宾中的 JVM 堆大小调整

> ID：439777
> 
> 赞同：6
> 
> 时间：2009-01-13T16:52:00.340
> 
> 标签：java, memory, vmware

这个问题的表述可能更好：在 VMware ESX 等管理程序上运行 Java 服务器如何影响 Java 堆？

*   从操作系统/管理程序的角度来看，对 JVM 堆的访问是随机的
*   客户操作系统或管理程序很难优化随机访问的内存
*   鉴于此，管理程序能否检测 JVM 堆中未使用的页面？

Java 服务器应用程序的传统观点是，如果您在 JVM 启动时分配所有堆，而不是让堆在需要时动态调整大小，则性能最佳。换句话说，如果您将堆大小设置为 1GB，您的 Java 进程将获取 1GB 的连续虚拟地址空间（+ 二进制文件所需的任何空间），其他应用程序不再可用的内存。

VMware 是否足够聪明，可以检测到其中一些堆实际上是未使用的？这对 GC 性能有何影响？让堆在VMware中动态调整大小会更好吗？哪些 GC 策略最适合 VMware 来宾？

另外，有人会指出我在虚拟化环境中调整 JVM 堆的指南吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T19:35:24.830

与我的问题相关：

这是一个 PDF，它提供了在 VMware 客户机上运行 Java 的注意事项的广泛概述：[链接文本](http://communities.vmware.com/servlet/JiveServlet/download/1142080-17786/Best%20Practices%20for%20Java%20in%20Virtual%20Machines%20on%20VMwareESX.pdf "VMware ESX 上的虚拟机中的 Java：最佳实践")

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-23T04:19:46.540

在这种情况下，请确保 Reservation = OS vRAM + JVM + heap size。

同时，以下是 VMware KB 站点的一般建议：

> 调整虚拟机内存的大小，为 Java 堆、Java 虚拟机代码和堆栈的其他内存需求以及任何其他需要来自客户操作系统的内存的并发执行进程留出足够的空间。
> 
> 将 VMware Infrastructure Client 中的内存预留值设置为虚拟机的内存大小。因为任何类型的内存交换（物理或虚拟）都会损害 JVM 堆的性能，尤其是垃圾收集。
> 
> 通过在不同时间以相同负载测试配置有不同数量虚拟 CPU 的虚拟机，确定托管 Java 应用程序的虚拟机的最佳虚拟 CPU 数量。
> 
> 如果您在 JVM 中使用多个垃圾收集器线程，请将这些线程的数量与虚拟机中配置的虚拟 CPU 的数量相匹配。
> 
> 为了更容易监控和负载平衡，每个虚拟机使用一个 JVM 进程。
> 
> 如果您的 ESX Server 过度使用，请确保 Balloon Driver 在虚拟机中运行，以便对内存进行最佳管理。

# php - .htaccess 的公共目录

> ID：439784
> 
> 赞同：9
> 
> 时间：2009-01-13T16:53:02.303
> 
> 标签：php, regex, .htaccess, mod-rewrite, url-rewriting

我在 index.php 中有一个调度程序函数，因此 URL 如下：

/博客/节目转到

/index.php/blog/show

```
<IfModule mod_rewrite.c>
    重写引擎开启
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
</IfModule>
```

如何修改它，以便我可以将所有静态文件转储到公共目录中，但在 URL 中不公开的情况下访问它们。

例如 /docs/lolcats.pdf 访问

/public/docs/lolcats.pdf 在驱动器上

我试过这个

```
RewriteCond %{REQUEST_FILENAME} !f
RewriteRule ^(.*)$ public/$1 [QSA,L]
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-28T11:48:24.747

试试这个：

```
RewriteCond %{DOCUMENT_ROOT}public%{REQUEST_URI} -f
RewriteRule !^public/ public%{REQUEST_URI} [L] 
```

如果要在根目录下的子目录中使用它：

```
RewriteCond %{REQUEST_URI} ^/subdir(/.*)
RewriteCond %{DOCUMENT_ROOT}subdir/public%1 -f
RewriteRule !^public/ public%1 [L] 
```

我找到了另一个没有明确命名子目录的解决方案：

```
RewriteRule ^public/ - [L]
RewriteCond public/$0 -F
RewriteRule .* public/$0 [L] 
```

重要的变化是使用`-F`而不是`-f`前者触发子请求。

# .net - 如何在 .NET 中实现共享内存？

> ID：439787
> 
> 赞同：18
> 
> 时间：2009-01-13T16:53:18.747
> 
> 标签：.net, shared-memory

我有一个 C++.NET 应用程序和一个 C#.NET 应用程序。我希望他们通过共享内存进行通信。

.NET 2.0 版怎么可能？

主要是想共享一个队列对象。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-29T10:01:38.873

更新：嘿，这是我刚刚找到[的一个完整实现的页面。](http://blogs.microsoft.co.il/blogs/pavely/archive/2008/05/05/shared-memory-section-wrapper-using-c-cli.aspx)

* * *

使用 C++/CLI，很容易按照普通的 C++ API 设置共享内存（C++/CLI 能够与托管和本机 HEAP/内存引用进行交互）。然后可以使用 UnmanagedMemoryStream 将 Stream 对象公开给 C#。

我没有附加 .h 文件，但您可以相当容易地推断出 pmapped 本机 typedef 的布局；）。您可能还想根据您的读取器/写入器用例评估 BufferedStream 的可能用途。而且代码来自一个我不再使用的项目，所以我不记得它的错误回归状态。

这是建立文件映射并公开 UnmanagedMemoryStream 的 C++/CLI 类；

```
public ref class MemMapp
{
    public:
        __clrcall MemMapp(String^ file)  
        { 
            map = NULL;

            if(!File::Exists(file)) throw gcnew ApplicationException("Can not find file " + file);

            marshal_context^ x = gcnew marshal_context();
            const char *nname = x->marshal_as<const char*>(file);

            map = (pmapped) malloc(sizeof(mapped));
            ZeroMemory(map, sizeof(mapped));
            map->name = strdup(nname);
            InitMap(map);
        }
        void __clrcall MapBytes(long long loc, long length)
        {
            map->low = loc & 0xffffffff;
            map->high = (loc >> 32) & 0xffffffff;
            map->size = length & 0xffffffff;
            if(!GetMapForFile(map))
                throw gcnew ApplicationException("can not map range " + loc + " :" + length);

            if(map->size = 0)
                map->size = MAXMAX&0xffffffff;

        }
        UnmanagedMemoryStream ^View()
        { 
            return gcnew UnmanagedMemoryStream((unsigned char *) map->blok, map->size, map->size, FileAccess::Read); 
        }
        long long __clrcall FileSize()
        {
            DWORD high, low;
            long long rv;

            low = GetFileSize(map->hFile, &high);
            maxmax = high;
            maxmax << 32;
            maxmax += low;

            rv = high;
            rv << 32;
            rv = rv & low;
            return rv;
        }
        property unsigned int MinBufSiz { unsigned int get() { return map->dwbufz; } }
        property long long BufBase { long long get() { return (map->high << 32) + map->low; } }
        property long long BufLim { long long get() { return ((map->high << 32) + map->low) + map->size; } }
        property long long MAXMAX { long long get() { return maxmax; } }
        static MemMapp() { }
        __clrcall ~MemMapp() { if(map != NULL) { CloseMap(map); free(map->name); free(map); map = NULL; } }
    protected:
        __clrcall !MemMapp() { if(map != NULL) { CloseMap(map); free(map->name); free(map); map = NULL; } }
        pmapped map;
        long long maxmax;
}; 
```

* * *

至少这里是 CLoseMap……我刚刚找到它……它不是用 /CLR 编译的

* * *

```
bool CloseMap(pmapped map)
{
    if(map->blok != NULL) {
        UnmapViewOfFile(map->blok);
        map->blok = NULL;
    }
    if(map->hMap != INVALID_HANDLE_VALUE && map->hMap != NULL) {
        CloseHandle(map->hMap);
        map->hMap = INVALID_HANDLE_VALUE;
    }
    if(map->hFile != INVALID_HANDLE_VALUE && map->hFile != NULL) {
        CloseHandle(map->hFile);
        map->hFile = INVALID_HANDLE_VALUE;
    }
    return false;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T17:10:02.487

您的应用程序可以通过多种方式进行通信。最受欢迎的是远程处理和管道。两者都有几个示例，在您选择一个之前，您应该考虑诸如便携性等优点和缺点。以下是一些有用的链接：

[.NET 中使用命名管道的进程间通信，第 1 部分](http://www.codeproject.com/KB/threads/dotnetnamedpipespart1.aspx)

[.NET 中使用命名管道的进程间通信，第 2 部分](http://www.codeproject.com/KB/threads/dotnetnamedpipespart2.aspx)

[.NET Remoting 简单英语](http://www.codeproject.com/KB/XML/remotingsimpleeng.aspx)

[.NET Remoting 一个简单的例子](http://www.codeproject.com/KB/IP/Net_Remoting.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T17:11:04.700

共享内存是唯一的选择吗？两个 .NET 进程有多种通信方式。他们之中有一些是：

*   .NET Remoting Object - 允许对象跨进程相互交互。[这里](http://www.codeproject.com/KB/IP/Net_Remoting.aspx)有一个很好的代码示例
*   Microsoft 消息队列 (MSMQ) - 进程之间的共享消息队列。MSMQ 将作为另一个 Windows 服务运行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-12T11:58:28.013

您还可以在 C# 应用程序中导入 win32 函数来替代 C++/CLI：

```
[DllImport ("kernel32.dll", SetLastError = true)]
  static extern IntPtr CreateFileMapping (IntPtr hFile,
                                          int lpAttributes,
                                          FileProtection flProtect,
                                          uint dwMaximumSizeHigh,
                                          uint dwMaximumSizeLow,
                                          string lpName);

  [DllImport ("kernel32.dll", SetLastError=true)]
  static extern IntPtr OpenFileMapping (FileRights dwDesiredAccess,
                                        bool bInheritHandle,
                                        string lpName);

  [DllImport ("kernel32.dll", SetLastError = true)]
  static extern IntPtr MapViewOfFile (IntPtr hFileMappingObject,
                                      FileRights dwDesiredAccess,
                                      uint dwFileOffsetHigh,
                                      uint dwFileOffsetLow,
                                      uint dwNumberOfBytesToMap);
  [DllImport ("Kernel32.dll")]
  static extern bool UnmapViewOfFile (IntPtr map);

  [DllImport ("kernel32.dll")]
  static extern int CloseHandle (IntPtr hObject); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T18:31:14.337

我想.NET v2.0 没有对共享内存的内置支持。我们最多可以 PInvoke CreateFileMapping 和 MapViewOfFile API。

在我的场景中，IPC 必须在单台机器上进行。所以管道是目前最快的选择。

感谢您的回答

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-12T08:16:12.733

看看这个[链接]： [http](http://www.albahari.com/nutshell/ch22.aspx) ://www.albahari.com/nutshell/ch22.aspx 在共享内存包装器中你可以找到你的答案。

# c++ - 什么是最高效的线程安全 C++ 记录器？

> ID：439791
> 
> 赞同：85
> 
> 时间：2009-01-13T16:54:41.160
> 
> 标签：c++, logging

我正在开发一个性能关键的多线程应用程序。我查看了 rlog、Ace 和 Boost 日志记录。我选择 rlog 是因为我读到它是最快的（当日志被禁用时，它的开销最小）。

我遇到的问题是即使在发布模式下它也会显示文件名、行号等。如果你能告诉我如何关闭这些信息，我的问题可能会解决。无论如何，对于我的情况，C++ 中最有效的记录器是什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2012-11-27T08:59:47.347

不幸的是，我目前无法投票。据我所知，永远不要使用像 Apache log4cxx 这样的垃圾。它包含严重的错误。

1.  0.9 分支的最后一个版本是 0.9.7，并且仍然包含内存泄漏，因为每个具有虚拟成员的类都没有虚拟 dtor。
2.  最新版本 0.10.x 与 0.9.x 相比失去了很多功能，并且不向后兼容。你被迫重写很多自己的代码。
3.  整个项目似乎无人维护。0.11.xx 的发布已经宣布了 2 年。

在我看来，您应该使用boost。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-22T13:25:39.350

[Pantheios](http://www.pantheios.org/)被认为是性能最好[的 C++ 日志库](http://www.pantheios.org/performance.html)，并且声称是唯一一个 100% 类型安全的（请参阅[这篇](http://accu.org/index.php/journals/1539)关于相关库的文章，解释为什么基于 printf()/iostream 的库不是类型-安全的）

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-13T18:44:59.177

我在[http://logging.apache.org/log4cxx/index.html](http://logging.apache.org/log4cxx/index.html)使用 log4cxx 取得了成功。它是流行的 Log4j 记录器的 C++ 版本，可以通过 conf 文件或代码轻松配置。禁用时的开销很小（方法调用和整数比较）。

输出到日志的模式由转换模式定义，可以像日期/时间和消息一样简单。它还处理文件大小限制、翻转等。您还可以为各种错误和来源配置不同的模式。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-10-31T10:13:54.280

以下是关闭 rlog 提供的额外信息（例如文件名、行号等）的方法。当您在`main()`函数（或任何地方）中初始化 rlog 时，您可能会执行以下操作：

```
rlog::RLogInit(argc, argv);
rlog::StdioNode slog (2, rlog::StdioNode::OutputColor);
slog.subscribeTo( RLOG_CHANNEL("error") ); 
```

第二个参数`StdioNode`是用于控制输出的标志。检查 rlog 文档（可以使用 Doxygen 生成）以获取可能标志的整个列表。此处示例中的一个使 rlog 仅根据严重性对输出进行着色，而没有添加任何其他信息。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-09-10T22:47:54.613

您可能希望考虑 logog 系统。logog 正好提供了这种功能，但它没有 Pantheios 所具有的隐式代码依赖性。logog 是线程安全的，它允许对在任何时候记录的消息类型进行高度控制。

我是 logog 的作者和维护者，所以我的看法有点偏颇。但在实施这个之前，我确实审查了 rlog、Pantheios 和其他日志系统。

[https://github.com/johnwbyrd/logog](https://github.com/johnwbyrd/logog)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-13T21:01:45.030

一些开销可能发生在您的宏/流中。您需要非常小心，不要在禁用日志记录时编写正在记录的字符串。

巧妙地使用流和 ?: 运算符可以让您做到这一点，宏也是如此。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-06-17T11:11:43.870

Poco 有很好的日志记录支持......

[http://pocoproject.org/slides/110-Logging.pdf](http://pocoproject.org/slides/110-Logging.pdf)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-14T03:55:15.570

也许[pantheios](http://pantheios.sourceforge.net/)
虽然我不知道它是否是线程安全的......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-09-21T05:10:48.550

试用 c-log 库[https://github.com/0xmalloc/c-log](https://github.com/0xmalloc/c-log)，这是一个用于 C/C++ 语言的快速、稳定且线程安全的日志库。

# javascript - 外部接口

> ID：439794
> 
> 赞同：0
> 
> 时间：2009-01-13T16:55:36.073
> 
> 标签：javascript, flash, interface, external

我在 java 脚本中有一个 calc 函数，它接受三个整数参数，下面是 AS3 代码

```
import flash.external.ExternalInterface;
var para:Array = new Array();
send_btn.addEventListener(MouseEvent.CLICK, clickListener);
function clickListener(eventObj:Object ):void {
    para.push(mean.text);
    para.push(std.text);
    para.push(points.text);
    trace("click > " + para);
    ExternalInterface.call("calc",para );
} 
```

这是正确的做法吗？我如何从 javascript 中取回 3 个参数并在 flash 中显示它们？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T03:08:13.913

此外，您需要注册您的 AS 函数，以便容器可以使用它：

```
ExternalInterface.addCallback("callFlash", myASFunction); 
```

然后，从您的容器 (JS) 中调用 AS 函数并将您想要的任何参数传递给它。

```
<script language="JavaScript"> 

    flashObject.callFlash(param1, param2, param3); 
</script> 

... 

<object id="flashObject"...> 
    ... 
    <embed name="flashObject".../> 
</object> 
```

最后，在 AS3 中，您编写将在容器“回调”时执行的函数：

```
function myASFunction(param1:String,param2:String,param3:String):void {
    trace("\n Received call from JS: " + param1 + param2 + param3);
} 
```

# asp.net - 为他们转换现有用户帐户还是让用户重新注册更好？

> ID：439796
> 
> 赞同：2
> 
> 时间：2009-01-13T16:56:07.210
> 
> 标签：asp.net, forms-authentication

我正在重写一个网站，并从用户使用其帐户 ID（数字）和密码登录的本土身份验证模型转到 .NET FormsAuthentication，其中用户将使用他们选择（或可用）的用户名和更强的密码。现有帐户超过 38K，我正在尝试确定现有用户是否应该重新注册，或者我是否应该编写一些代码来代表他们执行此操作。我已经排除了为用户创建用户名的可能性，因为他们将无法更改他们的用户名。幸运的是，我们没有任何名为 Brenda Utthead 的用户。

如果用户重新注册，有些人可能会抱怨必须再次执行此步骤，并且可能会引发一些支持电话，但我坚持每个人都必须执行的标准流程。或者我可以允许用户使用他们现有的用户名和密码登录，然后可以选择给他们一个宽限期来转换他们的帐户。我对后者犹豫不决，因为它是特殊代码和可能的威胁向量，因为它绕过标准身份验证机制并允许用户使用不太安全的凭据登录。

该应用程序目前占我们网站流量的 40% 左右，我不担心用户因为可能不得不重新注册而不会返回该网站。

大家怎么看？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-17T23:04:04.903

听了大家的建议，我决定修改登录。我查看他们提供的用户名并尝试猜测他们是现有用户。然后我在旧表中查找它们，如果找到匹配项，则将它们带到转换屏幕。在那里，他们可以快速转换他们的帐户或跳过整个过程并临时登录。转换表单需要填写的字段较少 b/c 我能够根据旧用户表对它们进行身份验证，因此我不需要它们提供尽可能多的信息。

我对跳过转换并不感到兴奋，但该选项仅在上线后的前 45 天提供。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:58:31.857

如果您希望您的用户回来，最好的办法是转换他们的帐户并发送一封电子邮件来解释转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T17:00:47.530

不要让他们重新注册你所做的任何事情。

如果你这样做，你将失去一半的用户。

为他们提供服务，以便他们可以输入以前的用户 ID 并让他们提供电子邮件地址。通过提供的地址向他们发送电子邮件，并让他们使用他们的电子邮件地址作为新用户名登录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T17:07:46.487

我即将做同样的事情。我正在编写一个迁移页面，用户使用他/她现有的凭据登录，在幕后，我写到 asp.net 成员资格表。首先进行检查以确保他们尚未为所有后续访问迁移。

不要让他们重新注册。您只需做一点工作，您就需要让您的客户满意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T13:31:44.410

我会迁移他们的信息，然后在他们第一次登录时要求他们确认他们的会员信息是正确的（只是为了肛门）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T17:01:46.980

要么转换它们，要么找到一种方法让两种成员模型一起存在，并以某种方式在登录时转换每个用户或其他东西。

想想获得 38k 会员需要多长时间，然后问问自己这些会员是否都被淘汰了，这些人是否会再次经历注册的麻烦。如果你有一个非常强大的社区，你应该没问题，在你建立起来之前，成功只是时间问题。

您可以做的另一件事来降低风险是发送一封电子邮件，尽管垃圾邮件拦截器可能会过滤它们，但您可以接触到大部分用户并告诉他们新的会员资格。在此过程中，可能还会让一些老年人回到现场。

最大的挑战是转换与用户帐户相关的所有数据。如果人们已经建立了某种声誉，而您将通过新的会员制度破坏他们，他们会非常沮丧。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T17:07:58.980

这个网站是一个检查你的余额类型的网站。它本身不是一个银行网站，但它作为用户的便利工具而存在。我不认为用户取消他们的账户是不现实的，因为他们被迫重新注册。

不过，我确实喜欢我在回复中读到的一些想法。

# java - 什么是用于终端应用程序的好的 Java、curses 类库？

> ID：439799
> 
> 赞同：110
> 
> 时间：2009-01-13T16:56:19.877
> 
> 标签：java, terminal, console, console-application, gnu-screen

我想编写一个进行屏幕操作的 Java 终端应用程序。有没有什么好的库可以让你像*nix/C 世界中的诅咒一样操纵屏幕？

我正在寻找的最小功能是窗口和用户输入支持。

在功能方面，我希望有一个终端区域，其中一些数据会定期更新，而（同时）用户可以在屏幕的其他部分输入命令/文本。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2012-10-15T13:21:02.520

我最近找到了[灯笼](https://github.com/mabe02/lanterna)图书馆。还没有机会使用它，但它看起来比其他人更先进。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-01-13T17:06:42.087

有[Charva](http://www.pitman.co.za/projects/charva/)，它链接到本机代码，但有一个基于 Swing 的 api。[屏幕截图](http://www.pitman.co.za/projects/charva/Screenshots.html)显示了许多文本窗口，因此看起来很有用。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-01-13T16:58:14.773

我自己没有使用过，但[Java Curses Library](http://sourceforge.net/projects/javacurses)听起来像你想要的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-13T17:12:52.573

[这](http://plindenbaum.blogspot.com/2008/01/java-native-interface-jni-notebook.html)是一种使用 JNI 调用 ncurses 库的方法。我对此进行了测试，并且可以正常工作。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-11-20T17:52:14.137

截至 2013 年，我能找到的最接近的是[Blacken](https://code.google.com/p/blacken/)。

Blacken 本身并不是一个诅咒库。它远离终端，而是呈现它自己的“控制台窗口”。这具有看起来不像“控制台”的缺点。相反，您可以获得完整的（任意）颜色支持，以及类似 curses 的 API（除了它们的主要 API）。

您还可以将字体设置`Mono`为固定宽度字符。

# algorithm - 300 000 000 000 的质因数？

> ID：439814
> 
> 赞同：3
> 
> 时间：2009-01-13T16:59:44.987
> 
> 标签：algorithm, prime-factoring, fxsl

我需要找出超过 3000 亿的质因数。我有一个功能正在添加到它们的列表中......非常缓慢！它现在已经运行了大约一个小时，我认为它还有很长的路要走。我这样做是完全错误的还是预期的？

编辑：我试图找到数字 600851475143 的最大素数。

编辑：结果：

```
{
    List<Int64> ListOfPrimeFactors = new List<Int64>();
    Int64 Number = 600851475143;
    Int64 DividingNumber = 2;

    while (DividingNumber < Number / DividingNumber)
    {
        if (Number % DividingNumber == 0)
        {
            ListOfPrimeFactors.Add(DividingNumber);
            Number = Number/DividingNumber;
        }
        else
            DividingNumber++;
        }
        ListOfPrimeFactors.Add(Number);
        listBox1.DataSource = ListOfPrimeFactors;
    }
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-13T17:03:50.347

您是否记得在找到它们时将要分解的数字除以每个因子？

例如，假设您发现 2 是一个因子。您可以将其添加到您的因子列表中，然后您将尝试分解的数字除以该值。

现在你只搜索 1500 亿的因数。每次你都应该从你刚刚找到的因素开始。因此，如果 2 是一个因素，请再次测试 2。如果您找到的下一个因素是 3，那么再次从 2 进行测试是没有意义的。

等等...

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-13T17:07:25.643

使用蛮力很难找到主要因素，这听起来像您正在使用的技术。

以下是一些加快速度的技巧：

*   起点低，不高
*   不要费心测试每个潜在因素以查看它是否是素数——只需测试 LIKELY 素数（以 1、3、7 或 9 结尾的奇数）
*   不要费心测试偶数（都可以被 2 整除）或以 5 结尾的赔率（都可以被 5 整除）。当然，实际上不要跳过 2 和 5！
*   当你找到一个质因数时，一定要把它分开——不要继续使用你的大量原始数字。请参阅下面的示例。
*   如果您发现某个因素，请确保再次对其进行测试，以查看它是否存在多次。你的号码可能是 2x2x3x7x7x7x31 或类似的东西。
*   到达 >= sqrt（剩余大数）时停止

编辑：一个简单的例子：您正在寻找 275 的因数。

1.  测试 275 是否可被 2 整除。275/2 = int(275/2) 吗？不，失败。
2.  测试 275 的可被 3 整除。失败。
3.  跳过4！
4.  测试 275 可被 5 整除。是的！275/5 = 55。所以你的新测试号现在是 55。
5.  测试**55**是否能被 5 整除。是的！55/5 = 11。所以你的新测试号现在是 11。
6.  但是 5 > sqrt (11)，所以 11 是素数，你可以停下来！

所以 275 = 5 * 5 * 11

更有意义？

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-13T17:06:07.690

分解大数字是一个难题。事实上，这太难了，以至于我们依靠它来保证 RSA 的安全。但是请查看[wikipedia 页面](http://en.wikipedia.org/wiki/Integer_factorization)，了解一些可以提供帮助的算法指针。但是对于这么小的数字，它真的不应该花那么长时间，除非你一遍又一遍地重新做你不必去某个地方的工作。

对于蛮力解决方案，请记住您可以进行一些小型优化：

*   专门检查2，然后只检查奇数。
*   您只需要检查数字的平方根（如果到那时您没有找到任何因子，那么该数字是素数）。
*   一旦你找到了一个因子，不要使用原来的数字来寻找下一个因子，将它除以找到的因子，然后搜索新的更小的数字。
*   当你找到一个因素时，尽可能多地划分它。之后，您再也不需要检查该数字或任何较小的数字。
*   如果您执行上述所有操作，您找到的每个新因子都将是素数，因为任何较小的因子都已被删除。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-15T06:35:55.963

**这是一个 XSLT 解决方案！**

**此 XSLT 转换需要 0.109 秒**。

```
<xsl:stylesheet version="2.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:xs="http://www.w3.org/2001/XMLSchema"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:f="http://fxsl.sf.net/"
 exclude-result-prefixes="xs saxon f"
 >
 <xsl:import href="../f/func-Primes.xsl"/>

 <xsl:output method="text"/>

 <xsl:template name="initial" match="/*">
   <xsl:sequence select="f:maxPrimeFactor(600851475143)"/>
 </xsl:template>

 <xsl:function name="f:maxPrimeFactor" as="xs:integer">
   <xsl:param name="pNum" as="xs:integer"/>

   <xsl:sequence select=
    "if(f:isPrime($pNum))
       then $pNum
       else
         for $vEnd in xs:integer(floor(f:sqrt($pNum, 0.1E0))),
             $vDiv1 in (2 to $vEnd)[$pNum mod . = 0][1],
             $vDiv2 in $pNum idiv $vDiv1
           return 
             max((f:maxPrimeFactor($vDiv1),f:maxPrimeFactor($vDiv2)))
    "/>
 </xsl:function>
</xsl:stylesheet> 
```

**此转换仅在 0.109 秒内产生正确的结果（最大素因子 600851475143）。**：

**`6857`**

转换使用[**`f:sqrt()`**](http://fxsl.cvs.sourceforge.net/viewvc/fxsl/fxsl-xslt2/f/func-sqrt.xsl?revision=1.4&view=markup)和[**`f:isPrime()`**](http://fxsl.cvs.sourceforge.net/viewvc/fxsl/fxsl-xslt2/f/func-Primes.xsl?revision=1.5&view=markup)定义在[**XSLT**](http://www.w3.org/TR/xslt20/)[**`FXSL 2.0`**](http://fxsl.sf.net)中的函数式编程库。它本身完全用[**XSLT**](http://www.w3.org/TR/xslt20/)编写。[](http://www.w3.org/TR/xslt20/)**[**`FXSL`**](http://fxsl.sf.net)[](http://www.w3.org/TR/xslt20/)**

 ******[`f:isPrime()`](http://fxsl.cvs.sourceforge.net/viewvc/fxsl/fxsl-xslt2/f/func-Primes.xsl?revision=1.5&view=markup)**使用[**费马小定理**](http://en.wikipedia.org/wiki/Fermat's_little_theorem)，因此确定素性是有效的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T17:11:27.587

最后一件事没有人提到，也许是因为它看起来很明显。每次你找到一个因素并把它分开时，继续尝试这个因素，直到它失败。

64 只有一个质因数，2。如果你一直把 2 分开，直到你不能再用，你会发现它非常微不足道。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T17:09:47.637

```
$ time factor 300000000000 > /dev/null

real        0m0.027s
user        0m0.000s
sys         0m0.001s 
```

如果需要一个小时，你就做错了。你甚至可能在某处有一个无限循环——确保你没有使用 32 位整数。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-14T09:14:34.803

理解为什么平方根很重要的关键是，考虑到在 n的平方根**之下的每个 n 因子在它****之上**都有一个对应的因子。要看到这一点，请考虑如果 x 是 n 的因数，则 x/n = m，这意味着 x/m = n，因此 m 也是一个因数。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T17:06:51.697

我根本不认为它需要很长时间 - 这不是一个特别大的数字。

您能给我们一个导致您的代码困难的示例编号吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-13T18:14:43.027

这是给你们的一些 Haskell 优点:)

```
primeFactors n = factor n primes
  where factor n (p:ps) | p*p > n = [n]
                        | n `mod` p /= 0 = factor n ps
                        | otherwise = p : factor (n `div` p) (p:ps)
        primes = 2 : filter ((==1) . length . primeFactors) [3,5..] 
```

花了大约 0.5 秒才找到它们，所以我称之为成功。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-13T18:35:25.560

这是您可以获得答案的一个站点：[Factoris - 在线分解服务](http://wims.unice.fr/wims/wims.cgi?session=9R8296D526.12&+lang=en&+module=tool/algebra/factor)。它可以处理非常大的数字，但它也可以分解代数表达式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-13T18:38:32.167

最快的算法是筛算法，并且基于离散数学的神秘领域（至少在我头上），实现和测试复杂。

最简单的因式分解算法可能是（正如其他人所说）埃拉托色尼筛法。关于使用它来分解数字要记住的事情`N`：

*   总体思路：您正在检查可能的整数因子的递增序列，`x`以查看它们是否均分您的候选数`N`（在 C/Java/Javascript 中检查是否`N % x == 0`），在这种情况下 N 不是素数。
*   你只需要上升到`sqrt(N)`，但实际上并不计算`sqrt(N)`: 只要你的测试因子 x 通过测试就循环`x*x<N`
*   如果您有内存来保存一堆以前的素数，请仅将它们用作测试因子（如果素数 P 未通过测试，请不要保存它们，`P*P > N_max`因为您将永远不会再使用它们
*   即使您不保存以前的素数，对于可能的因素，`x`只需检查 2 和所有奇数。是的，它需要更长的时间，但对于合理大小的数字来说不会更长。素[数计数函数](http://en.wikipedia.org/wiki/Prime-counting_function)及其近似值可以告诉您哪些数字是素数；这部分减少*得非常*缓慢。即使对于 2 ^(64) = 大约 1.8x10 ^(19)，大约每 43 个数字中有一个是素数（= 每 21.5 个奇数中有一个是素数）。对于数字小于 2 ^(64)的因数，这些因数`x`小于 2 ^(32)其中大约每 20 个数字中有一个是素数 = 每 10 个奇数中有一个是素数。因此，您必须测试 10 倍的数字，但循环应该更快一些，而且您不必乱七八糟地存储所有这些素数。

还有一些更老、更简单的筛选算法，它们稍微复杂一些，但仍然可以理解。请参阅[Dixon 的](http://en.wikipedia.org/wiki/Dixon%27s_factorization_method)、[Shanks](http://en.wikipedia.org/wiki/Shanks%27_square_forms_factorization)和[Fermat 的](http://en.wikipedia.org/wiki/Fermat%27s_factorization_method)因式分解算法。我曾经读过一篇关于其中一个的文章，不记得是哪一篇了，但它们都相当简单，并使用平方差的代数性质。

如果您只是测试一个数字是否`N`为素数，而您实际上并不关心因素本身，请使用[概率素数测试](http://en.wikipedia.org/wiki/Primality_test)。[我认为米勒-拉宾](http://en.wikipedia.org/wiki/Miller%E2%80%93Rabin_primality_test)是最标准的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-14T00:13:12.803

我花了一些时间，因为它只是吸引了我。我不会在这里粘贴代码。如果您好奇，请参阅[这个 factor.py gist 。](http://gist.github.com/46702)

请注意，在阅读此问题之前，我对因式分解一无所知（仍然不知道）。[这只是上面BradC](https://stackoverflow.com/users/21398/bradc)答案的 Python 实现。

在我的 MacBook 上，需要 0.002 秒来计算问题中提到的数字（600851475143）。

显然必须有很多更快的方法来做到这一点。我的程序需要 19 秒来计算 6008514751431331 的因子。但[Factoris](http://wims.unice.fr/wims/wims.cgi?module=tool%2Falgebra%2Ffactor.en)服务很快就会给出答案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-07-08T04:26:23.327

具体号码是300425737571？它微不足道地考虑到 131 * 151 * 673 * 22567。我看不出有什么大惊小怪的......

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T17:15:44.630

您可以使用[Eratosthenes 的筛子](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)找到素数，看看您的数是否可以被您找到的数整除。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-13T17:16:01.570

您只需要检查它的余数 mod(n) 其中 n 是素数 <= sqrt(N) 其中 N 是您要考虑的数字。即使在非常慢的计算机或 TI-85 上，它也不应该超过一个小时。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-13T18:07:31.780

您的算法必须是 FUBAR。在我使用 Python 编写的 1.6 GHz 上网本上，这只需要大约 0.1 秒。Python 并不以其惊人的速度而闻名。但是，它确实具有任意精度整数...

```
import math
import operator

def factor(n):
    """Given the number n, to factor yield a it's prime factors.
    factor(1) yields one result: 1\. Negative n is not supported."""
    M = math.sqrt(n)  # no factors larger than M
    p = 2             # candidate factor to test
    while p <= M:     # keep looking until pointless
        d, m = divmod(n, p)
        if m == 0:
            yield p   # p is a prime factor
            n = d     # divide n accordingly
            M = math.sqrt(n)  # and adjust M
        else:
            p += 1    # p didn't pan out, try the next candidate
    yield n  # whatever's left in n is a prime factor

def test_factor(n):
    f = factor(n)
    n2 = reduce(operator.mul, f)
    assert n2 == n

def example():
    n = 600851475143
    f = list(factor(n))
    assert reduce(operator.mul, f) == n
    print n, "=", "*".join(str(p) for p in f)

example()

# output:
# 600851475143 = 71*839*1471*6857 
```

（这段代码似乎无视我对数论的了解不足以填补顶针这一事实。）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-14T00:39:10.770

只是为了稍微扩展/改进“仅测试不以 5 结尾的奇数”的建议......

所有大于 3 的素数要么比 6 的倍数大一或小一（对于 x 的整数值，6x + 1 或 6x - 1）。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2009-01-13T17:06:07.673

即使使用相对幼稚的蛮力，也不应该花那么长时间。对于那个特定的数字，我可以在大约一秒钟内将其计入脑海。

您说您不想要解决方案（？），但这是您的“微妙”提示。该数字的唯一素数是最低的三个素数。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2009-01-13T17:07:23.693

这种大小的半素数用于加密，所以我很好奇你到底想用它们做什么。

除此之外，目前还没有好的方法可以在相对较短的时间内找到大数的素数分解。

# ms-access - 用户定义的参数在 Access 中用作文件名的一部分

> ID：439815
> 
> 赞同：1
> 
> 时间：2009-01-13T16:59:52.803
> 
> 标签：ms-access, filenames

我有一个访问 2007 数据库，它以 excel 格式输出报告，该报告取决于用户选择的日期参数。此参数通过具有弹出日历的文本框 (text100) 选择。我想使用文本框（text100）中的日期作为文件名的一部分。我正在使用 transferspreadsheet 方法创建导出，但是我不需要列标题。创建文件后，我让代码打开文件并删除标题。此外，当前代码在文件名中使用今天的日期，这是不准确的。文件名需要反映用户在弹出日历的文本框中选择的日期

好的，这里是代码。

```
Sub Branch298nohdr()

 Dim Filename As String
 Dim Path As String
 Dim Branch As Integer
 Dim Text100 As Date
 Dim xl

    Branch = "298"
    Path = "Path" & Branch & "\"
    Filename = "Identity Report " & Branch & " " & _
                        Replace(Text100, ":", " ") & ".xls"

If Dir(Path & Filename) <> "" Then

    MsgBox "File has been created already"

If Dir(Path & Filename) <> "" Then

    GoTo 53

End If

Else

    Set xl = CreateObject("excel.application")

    TempVars.Add "branchnum", Branch    
    DoCmd.TransferSpreadsheet acExport, acSpreadsheetTypeExcel8, _
            "queryname", Path & Filename, False
    xl.workbooks.Open Path & Filename

     With xl

          .Rows("1:1").entirerow.Delete
            .Columns("L:L").select
            .Selection.NumberFormat = "0"
          .range("a1").select
            xl.workbooks(1).Close Savechanges:=True

            xl.Quit
    Set xl = Nothing
53
    MsgBox "Done!"
    End With

    TempVars.Remove "branchnum"
End If

Branch298nohdr_Exit:
    Exit Sub

End Sub 
```

文本 100 是用户通过弹出日历选择日期的地方。我想将此日期用作文件名的一部分。当前使用 text100 作为文件名的一部分，它被引用为上午 12:00，然后将其添加到文件名中。我希望这能澄清我的意图。

文本 100 在打开表单上设置，然后有几个按钮允许用户在几个分支或所有分支之间进行选择。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T18:15:41.963

那么显而易见的问题是，Text100 的第一个集合在哪里？

另一种风格评论，最好做

```
goto ExitSub
'...
ExitSub: 
```

然后你的“GoTo 53”——它更有意义一点。

以这种速度，最好将您的“完成”消息移到 IF 语句之外，而 TempVars 似乎没有目的；去掉它。

**编辑：**

我假设 Text100 是表单上的一个文本框，那么该行显示为：

```
Dim Text100 As Date 
```

将在您的代码中覆盖该引用。

如果您在代码中引用该文本框，则需要这样做：

```
foo = me.Text100
' or
foo = Forms!FormName.Text100 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:07:32.727

确切地确定您的问题是什么有点困难，但我想您是在问，“我如何使用文本框的内容作为导出文件名？” 听起来像是在您的代码中的某处，它为带有 & now() 标记到末尾的文件名创建了一个字符串，以使用文件名中的当前日期。您可以简单地将 '& now()' 替换为 '& textbox.value' 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:31:15.690

一位 JD Long 说在您的帖子中很难看到任何问题。也许你应该再次编辑它。

但一般来说，您需要先转义用户输入的任何特殊字符，然后才能在文件名中使用输入。

不允许使用以下保留字符：

```
< > : " / \ | ? * 
```

有关在 Windows 中命名文件的更多详细信息，请参阅：在 MSDN 中[命名文件或目录。](http://msdn.microsoft.com/en-us/library/aa365247.aspx)

# linq-to-sql - 自定义 Linq to Sql DataContext

> ID：439823
> 
> 赞同：1
> 
> 时间：2009-01-13T17:01:16.950
> 
> 标签：linq-to-sql, datacontext

有没有简单的方法将属性添加到 Linq to Sql 生成的实体以引用其 DataContext？例如：

```
var myContext = new DataContext(); 
var product = context.Products.Where(p => p.Id == productId).SingleOrDefault(); 
```

并且产品实体有一个名为“Context”(product.Context) 的属性，它引用了 myContext，datacontext。

我知道如何自定义生成的实体。我的问题是如何自定义（我认为是 DataContext）来设置它为自己创建的每个实例的“上下文”属性。

我不确定我是否做对了。我想用更少的代码编写一个性能最好的业务封装模型。当我四处搜索时，我发现 DataContext 对象非常轻量级，我认为这是向每个对象添加 DataContext 实例的好方法。这将减少每次我想更新或删除对象时，再次将分离的对象附加到新的数据上下文实例的需要。

如果您有任何其他解决方案，我将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:56:54.217

> 有没有一种简单的方法可以将属性添加到 Linq to Sql 生成的实体以引用其 DataContext？

没有简单的方法可以实现这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:36:37.167

请参阅此处：[确定 Linq to Sql 查询的源 DataContext](https://stackoverflow.com/questions/317114/determine-the-source-datacontext-for-a-linq-to-sql-query)

我或多或少地问了同样的问题。您可以从 linq to sql 查询返回的 IQueryable 获取上下文，但据我所知，不能从实体本身获取。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:02:27.000

这样做会破坏 LINQ-to-SQL 的部分目的。目的之一是允许您使用您拥有的对象，而不必根据数据库考虑更改您的设计。

在将 DataContext 附加到数据库时，您将代码中的表示与持久化它的方法相结合，这通常是一个糟糕的设计理念。

如果您觉得*必须*这样做，您始终可以从该类派生，然后在该类上实现一个接口，该接口公开 DataContext。

我建议实现该接口，因为您无法向 LINQ-to-SQL 设计器指示基类，并且您希望所有实体都具有共享实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T19:17:33.773

Actually, I agree to casperOne. If you really have to need this, I remembered that the classes that linq-to-sql generates are partial. So you can write a partial class to any class you want and add extended functionalities to it.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-06T19:52:12.450

这是我为 System.Data.Linq 制作的自定义包装器。它包含一个 find 方法，所以不是你的代码：

```
var myContext = new DataContext(); 
var product = context.Products.Where(p => p.Id == productId).SingleOrDefault(); 
```

你可以这样做

```
var myContext = new DataContext(); 
var product = context.Products.Find(productId); //(assuming productId is your primary key) 
```

您可以获取下面的代码并进行任何您希望设置 product.Context 的自定义修改，但这是修改 DataContext 的示例。

我还做了保存和删除方法。你会注意到我出去重新抓取记录，即使它正在被传递。我这样做是因为记录可能会与上下文分离并且不会更新。如果有人想要完整的代码，我可以发布 github 链接。

```
public abstract class DbContext : IDisposable
{
    #region Properties
    private string _connectionString { get; set; }
    private DataContext _context { get; set; }
    #endregion

    #region Constructor
    public DbContext(string connectionString)
    {
        _connectionString = connectionString;
        _context = new DataContext(_connectionString);
        Initialized(_context);
    }

    public DbContext(string server, string database, string userID, string password)
    {
        _connectionString = string.Format(
        "Server={0};Database={1};User Id={2};Password={3};MultipleActiveResultSets=true",
        server,
        database,
        userID,
        password);

        _context = new DataContext(_connectionString);
        Initialized(_context);
    }
    #endregion

    #region Methods
    /// <summary>
    /// Is used to get the contents of a Sql Server Table.
    /// </summary>
    /// <typeparam name="TEntity">Type</typeparam>
    /// <returns>Table</returns>
    public Table<TEntity> GetTable<TEntity, TPKType>()
        where TEntity : DbTableEquatable<IDbTableEquatable<TPKType>>
        where TPKType : struct
    {
        return _context.GetTable<TEntity>();
    }

    /// <summary>
    /// Is used to get the contents of a Sql Server Table.
    /// </summary>
    /// <typeparam name="TEntity">Type</typeparam>
    /// <returns>Table</returns>
    public Table<TEntity> GetTable<TEntity>()
        where TEntity : DbTableEquatable<IDbTableEquatable<long>>
    {
        return GetTable<TEntity, long>();
    }

    protected virtual void Initialized(DataContext context) { }

    /// <summary>
    /// Saves the changes to the database.  In order to save the table must inherit from DbTableEquatable 
    /// and be a type of IDbTableEquatable and the Primary Key Type must be a C# Structure
    /// </summary>
    /// <typeparam name="TEntity">Record Type</typeparam>
    /// <typeparam name="TPKType">Primary Key Type</typeparam>
    /// <param name="entity">Record</param>
    public virtual void SaveChanges<TEntity, TPKType>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<TPKType>>
        where TPKType : struct
    {
        var changedList = _context.GetTable<TEntity>();
        var ID = entity.GetType().GetProperty("ID").GetValue(entity);

        _preprocessSave<TEntity, TPKType>(entity);

        // Save changes
        if (Convert.ToInt64(ID) == 0)
        {
            // Insert
            // If No ID we need to insert on submit
            _context.GetTable<TEntity>().InsertOnSubmit((TEntity)entity);
            _context.SubmitChanges();
        }
        else
        {
            // Update
            var item = changedList.Where(w => w.Equals(entity)).FirstOrDefault();
            ReflectionManager.SetValuesWithSkip(entity, item, "ID");
            _context.SubmitChanges();
        }

        Refresh();
    }

    /// <summary>
    /// Saves the changes to the database.  In order to save the Table the Record is from must inherit from DbTableEquatable 
    /// and be a type of IDbTableEquatable and the Primary Key Type must be a C# Structure
    /// </summary>
    /// <typeparam name="TEntity">Record Type</typeparam>
    /// <param name="entity">Record</param>
    public virtual void SaveChanges<TEntity>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<long>>
    {
        SaveChanges<TEntity, long>(entity);
    }

    /// <summary>
    /// Saves any non committed changes to the database
    /// </summary>
    public void SaveChanges()
    {
        _context.SubmitChanges();
        Refresh();
    }

    /// <summary>
    /// Marks the record as delete and will be deleted when saved
    /// </summary>
    /// <typeparam name="TEntity">Record Type</typeparam>
    /// <typeparam name="TPKType">Primary Key Type</typeparam>
    /// <param name="entity">Record</param>
    public virtual void DeleteOnSave<TEntity, TPKType>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<TPKType>>
        where TPKType : struct
    {
        var item = _context.GetTable<TEntity>().Where(w => w.Equals(entity)).FirstOrDefault();
        _context.GetTable<TEntity>().DeleteOnSubmit((TEntity)item);
    }

    /// <summary>
    /// Marks the record as delete and will be deleted when saved
    /// </summary>
    /// <typeparam name="TEntity">Record Type</typeparam>
    /// <param name="entity">Record</param>
    public virtual void DeleteOnSave<TEntity>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<long>>
    {
        DeleteOnSave<TEntity, long>(entity);
    }

    protected virtual void _preprocessSave<TEntity, TPKType>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<TPKType>>
        where TPKType : struct
    {

    }

    protected virtual void _preprocessSave<TEntity>(TEntity entity)
        where TEntity : DbTableEquatable<IDbTableEquatable<long>>
    {
        _preprocessSave<TEntity, long>(entity);
    }

    public void Dispose()
    {
        _connectionString = "";
        _context.Dispose();
        _context = null;
    }

    public virtual void Refresh<TEntity>(RefreshMode mode, TEntity entity) where TEntity : class
    {
        _context.Refresh(RefreshMode.OverwriteCurrentValues, entity);
    }

    public virtual void Refresh()
    {
        _context = new DataContext(_connectionString);
    }

    public virtual void Refresh<TEntity>(RefreshMode mode, params TEntity[] entities) where TEntity : class
    {
        _context.Refresh(RefreshMode.OverwriteCurrentValues, entities);
    }

    public virtual void Refresh<TEntity>(RefreshMode mode, IEnumerable<TEntity> entities) where TEntity : class
    {
        _context.Refresh(RefreshMode.OverwriteCurrentValues, entities);
    }
    #endregion
} 
```

扩展

```
public static class Extension
{
    public static TEntity Find<TEntity, TPKType>(this Table<TEntity> table, TPKType ID, string pkName = "ID")
        where TEntity : DbTableEquatable<IDbTableEquatable<TPKType>>
        where TPKType : struct
    {
        TEntity copy = Activator.CreateInstance<TEntity>();

        // set value through reflection
        copy.GetType().GetProperty(pkName).SetValue(copy, ID, null);
        return (TEntity)table.Where(w => w.Equals(copy)).FirstOrDefault();
    }

    public static TEntity Find<TEntity>(this Table<TEntity> table, long ID, string pkName = "ID")
        where TEntity : DbTableEquatable<IDbTableEquatable<long>>
    {
        TEntity copy = Activator.CreateInstance<TEntity>();

        // set value through reflection
        copy.GetType().GetProperty(pkName).SetValue(copy, ID, null);
        return (TEntity)table.Where(w => w.Equals(copy)).FirstOrDefault();
    }
} 
```

}

接口/抽象

```
/// <summary>
/// This Class Assumes the type T has a property called ID. MUST be 
/// used with IDbEquatable
/// </summary>
/// <typeparam name="T">Class Type</typeparam>
public abstract class DbTableEquatable<T> : IEquatable<T> where T : class
{
    public bool Equals(T other)
    {
        //Check whether the compared object is null.  
        if (Object.ReferenceEquals(other, null))
        {
            return false;
        }

        //Check whether the compared object references the same data.  
        if (Object.ReferenceEquals(this, other))
        {
            return true;
        }

        return ((dynamic)other).ID == ((dynamic)this).ID;
    }
}

/// <summary>
/// Needs to be inherited from in order for Ion.Data.Linq functions to work
/// </summary>
/// <typeparam name="T">Primary Key Type</typeparam>
public interface IDbTableEquatable<T>
{
    T ID { get; set; }
} 
```

这是一个表实现

```
[Table(Name = "Crews")]
public class Crew : DbTableEquatable<IDbTableEquatable<long>>, IDbTableEquatable<long>
{
    [Column(IsPrimaryKey = true, DbType = "Bigint NOT NULL IDENTITY", AutoSync = AutoSync.OnInsert, IsDbGenerated = true)]
    public long ID { get; set; }
    [Column]
    public string Alias { get; set; }
    [Column]
    public string DefaultForeground { get; set; }
    [Column]
    public string DefaultBackground { get; set; }
    [Column]
    public string AccountEmailAddress { get; set; }
    [Column]
    public long? CrewLeaderEmployeeID { get; set; }
    [Column]
    public string Comments { get; set; }
    [Column]
    public string Password { get; set; }
    [Column]
    public string PrivateICSLink { get; set; }
    [Column]
    public string PrivateXMLLink { get; set; }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-09T14:51:42.973

将数据上下文作为 ref 参数传递给部分 Product 对象的自定义方法：

```
public partial class Product 
{
    public string GetSomethingElse(ref DataContext dbase) 
    {
         return dbase.OtherTableWhatever.Count.ToString(); // whatever
    }
} 
```

在你的 aspx.cs 里面：

```
var context = new DataContext();
var product = context.Products.SingleOrDefault(x => x.id == 1);
var s = product.GetSomethingElse(ref context); 
```

# ruby-on-rails - rspec 在哪里测试 lib/ 下的代码？

> ID：439828
> 
> 赞同：33
> 
> 时间：2009-01-13T17:01:57.603
> 
> 标签：ruby-on-rails, rspec

我在 lib/ 目录中有一些代码实际上不属于控件、模型或助手。我想为此代码编写一些 rspec 测试，但不确定它们应该放在 spec/ 目录下的哪个位置。是否有普遍遵循的约定？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-14T07:51:46.717

我也会使用 /spec 的子目录。但是，如果它真的是独立的并且可以独立测试，我会考虑将代码重构为一个单独的插件或 gem。在这个插件中，您可以创建一个单独的规范目录。

# crystal-reports - 水晶报表：有没有办法在水晶报表中进行正则表达式？

> ID：439829
> 
> 赞同：5
> 
> 时间：2009-01-13T17:02:10.053
> 
> 标签：crystal-reports

我有一个水晶报表功能，它要求我剪掉以“-”开头的字符，并删除“-”（破折号）后面的其余字符。

例如，我的订单号为 00000112345-C43-PJ。

我如何从“-”右侧修剪掉所有内容，得到结果为 00000112345？

我寻找了一个正则表达式和子字符串，但水晶似乎没有这些功能可用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-06-14T10:15:17.620

我最近在这里添加了一个正则表达式库：- [https://sourceforge.net/projects/cruflregex/files/](https://sourceforge.net/projects/cruflregex/files/)

它有点小，但可能对某人有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:43:13.327

Crystal 可能没有正则表达式，但它肯定有所有基本的字符串函数

这样的事情应该为你做（未经测试）：

```
Left({OrderNumber}, InStr({OrderNumber}, "-") - 1) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:43:56.287

这在 Crystal 报表中已经有一段时间没有出现了。我听说它可能是最新水晶报告中的一个功能（16？）。查看他们的网站并给他们打电话，他们不应该对售前问题收费。

您可以采取的另一种方法是手动处理该值并使用字符串和 isvalue 函数等对其进行验证。Messier，但它可能是一个备用选项。

# ms-access - 将 VBScript 通用日期时间导入 MS Access 日期/时间列

> ID：439831
> 
> 赞同：2
> 
> 时间：2009-01-13T17:02:18.180
> 
> 标签：ms-access, vbscript, import

## 设置

我有一个用于驱动 Web 服务压力测试的 VBScript。该脚本创建一个测量数据文件，每条记录都带有一般日期/时间的时间戳：

```
FormatDateTime(Now(), 0) 
```

这会创建日期，例如

```
mm/dd/yyyy hh:mm:ss [AM|PM] 
```

我需要将此数据文件导入 MS-Access 2003 数据库。Access 数据库中的表有一个名为的列`TimeStamp`，其数据类型为`Date/Time`，格式为`General Date`。

我的导入规范有一个以`Timestamp`日期类型命名的字段`Date/Time`。在`Dates, Times, and Numbers`框架中，选择了以下选项：

> ```
> Date Order: MDY
> Date Delimiter: /
> Time Delimiter: :
> Four Digit Years: Checked 
> ```

数据文件以制表符分隔，第一行中的字段名称。

## 问题

当我导入我的数据文件时，时间戳字段中的每条记录都失败并出现`Type Conversion Failure`错误。

## 问题

有没有办法按原样导入数据，还是我必须先将时间戳字段“按摩”为 24 小时日期/时间格式？如果是后者，有没有办法在我的 VBScript 代码中格式化时间戳，以 24 小时格式写入日期/时间？我试过

```
FormatDateTime(Now(), "mm/dd/yyyy hh:mm:ss") 
```

但 VBScript 对此感到不满。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T17:18:34.310

VBScripts FormatDateTime 函数不支持一般格式字符串，仅支持一组受约束的常量，而 0 是您必须同时包含日期和时间的唯一选择。

会不会是上午/下午的出现导致了混乱？

您在美国地区？

尝试`SetLocale(2057)`

这会将脚本放入 en-GB（英国）语言环境。默认日期时间格式为 dd/mm/yyyy hh:mm:ss。它的 24 小时也许您的导入会更喜欢这种格式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:10:16.020

为什么不跳过数据文件，直接将结果写入数据库呢？

编辑：或使用此脚本将数据从文件移动到数据库。

```
 Set DataFile = CreateObject("Scripting.FileSystemObject").OpenTextFile("FileName",1)

Set objConnection = CreateObject("ADODB.Connection")
objConnection.Open "Provider=Microsoft.Jet.OLEDB.4.0;Persist Security Info=False;Data Source=database.mdb"

Set objRecordset = CreateObject("ADODB.Recordset")
objRecordset.CursorLocation = 3
objRecordset.Open "SELECT * FROM TableName" , objConnection, 3, 3

Do Until DataFile.AtEndOfStream
    arrTemp = Split(DataFile.ReadLine, vbTab)
    If IsArray(arrTemp) Then
        objRecordset.AddNew
        objRecordset("FieldName1") = arrTemp(0)
        objRecordset("FieldName2") = arrTemp(1)
        objRecordset("FieldName3") = arrTemp(2)
        objRecordset.Update
    Else
        'Only one item of data is on this line
    End If 
Loop 

DataFile.Close
objConnection.Close
Set DataFile = Nothing
Set objRecordset = Nothing
Set objConnection = Nothing 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T19:27:28.560

从这个[链接](http://classicasp.aspfaq.com/date-time-routines-manipulation/can-i-make-vbscript-format-dates-for-me.html); 我可以模仿 VB 的`Format()`函数将日期格式化为 24 小时日期/时间：

```
Function Format(vExpression, sFormat) 

    set fmt = CreateObject("MSSTDFMT.StdDataFormat") 
    fmt.Format = sFormat 

    set rs = CreateObject("ADODB.Recordset") 
    rs.Fields.Append "fldExpression", 12 ' adVariant 

    rs.Open 
    rs.AddNew 

    set rs("fldExpression").DataFormat = fmt 
    rs("fldExpression").Value = vExpression 

    Format = rs("fldExpression").Value 

    rs.close: Set rs = Nothing: Set fmt = Nothing 

End Function 
```

来自文章：

> MSSTDFMT 对象取决于由 Visual Studio 6.0 安装的 MSSTDFMT.dll 的可用性。

MSSTDFMT.dll 似乎在 Windows XP 和 Windows 2003 服务器上可用；我检查了几台从未安装过 MS Visual Studio 并且存在 DLL 的机器。

我更改了我的 VBScript 代码以使用此函数将日期置于 Access 可以导入的格式中：

```
Format(Now(), "mm/dd/yyyy hh:mm:ss") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T00:48:24.637

我不知道这是否会有所帮助，但有什么方法可以让您在 VBScript 中处理日期输出，以确保日期具有前导零和 4 位数年份？如果你这样做，那么你可以将它作为文本字段导入然后处理它，因为你会知道前 10 个字符是明确的日期，然后你可以通过一些数据按摩来解析时间。如果这是不可能的，但您知道日期和时间之间有一个空格，那么您可以再次导入为文本并使用空格作为分隔符从时间解析日期，然后处理时间字段。

我知道您说过您不想在导入后解析数据，但如果您无法将导入数据转换为 Access 可以处理的格式，那么您别无选择。

另一个想法：

您是否尝试过 Excel 的导入功能？它可能表面上类似于 Access 导入，但它通常会在完全相同的数据上为您提供完全不同的结果。

抱歉，我无法提供任何确定的信息。

# c++ - 如果在 WinXP 上的调试版本中使用 boost (C++) 库，则无法执行程序

> ID：439840
> 
> 赞同：0
> 
> 时间：2009-01-13T17:05:16.583
> 
> 标签：c++, windows, dll, boost, side-by-side

我正在为几个 C++ 项目使用 boost。我最近进行了升级（从 1.33.1 升级到 1.36，很快升级到 1.37），从那时起我就不能再运行任何调试版本了。

为确保不存在其他项目问题，我创建了一个最小测试项目，其中仅包含 boost.thread，并使用它来启动一种方法。可以启动发布构建，但不能启动调试构建，尽管*Dependency Walker*显示找到了所有必需的库（这也意味着在 SxS 目录中找到了所需的 MS Debug CRT）。

在启动时我只得到：

> Die Anwendung konnte nicht Richtig initialisiert werden (0xc0150002)。Klicken Sie auf "OK", um die Anwendung zu beden。

这意味着“无法初始化应用程序”。互联网研究主要导致[MS Office 安装问题](http://support.microsoft.com/?scid=kb%3Ben-us%3B822520&x=16&y=11)，建议对 WinXP 进行修复。

那么，除了修复设置（我认为这在我谈论调试 dll 问题时无济于事）之外，还有什么想法吗？

啊，在我忘记之前：完全相同的源代码在构建机器上不会导致错误（即，可以注册 DLL，意味着执行）。所以这显然是一个安装问题，但是由于 DLL*在*那里，并且dependency-walker 找到了它，我还忘记了什么？

（**编辑**）好吧，我还没有解决我的问题，但感谢 deemok，我更进一步。为了减少误解，我在下面做一些澄清：

*   程序无法在*开发者*机器上运行
*   我正在使用已*安装*的 VS2005（这是一个 VC++8 项目）
*   我使用了来自[BoostPro](http://www.boostpro.com/products/free)的 boost-setup ，编译了所有可能的构建版本，并仔细检查了它们是否存在（否则我在构建过程中已经遇到了链接器错误）。
*   我仔细检查了我能想到的 include/lib/bin 配置的任何角落——因为 boost 在 Windows 上使用自动链接，具有特殊的命名约定，构建或启动会失败，更容易理解错误信息。
*   我*不能*使用*静态链接*，因为 boost.thread 需要动态链接 DLL 项目（我可能会在这里搞砸，但由于这个问题似乎只发生在我的机器上，我不想搞砸这个，我确定助推器首先有理由将检查放在那里）
*   正如我写的那样，我检查了 Dependency Walker，它说一切都很好。

目前，它似乎是 boost-dll 中的一个错误（可能是不正确的 Manifest），将对其进行检查。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T17:09:22.223

这是一个[并行](http://blogs.msdn.com/rchiodo/archive/2007/04/09/the-next-level-of-dll-hell-sxs.aspx)(SxS) 问题——仅仅复制 DLL 已经不够了。

关于您关于 Debug 构建的具体问题，请参阅：[Running vc2008 debug builds on non-dev machines](https://stackoverflow.com/questions/264385/running-vc2008-debug-builds-on-non-dev-machines)

简短的回答：

> 你不能，因为调试运行时没有安装程序 redist（实际上软件许可证禁止分发它，所以即使你确实把一些东西放在一起，你也会违反 EULA）。

因此，您需要在那里安装 Visual Studio。

但是，如果您仍然想尝试不走那条路，您可以完整阅读[puetzk 的答案](https://stackoverflow.com/questions/264385/running-vc2008-debug-builds-on-non-dev-machines#264406)。

或者，您可以尝试[静态链接所有内容](https://stackoverflow.com/questions/264385/running-vc2008-debug-builds-on-non-dev-machines#264461)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:04:41.143

这可能与 SxS 无关。我建议检查事件日志中的 SxS 错误消息并使用依赖遍历器检查最可能的 DLL 依赖问题，或者其中一个 DLL 从其 DllMain 返回 FALSE（无论出于何种原因）。

此外，启用加载程序快照：

> gflags -i yourapp.exe +sls

在调试器（或依赖walker）下运行时可能会带来额外的启发。

注意：gflags 是[Windows 调试工具](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T21:31:50.773

那么您使用的是BoostPro的*预构建库吗？*如果是这样，您的环境可能与它们内置的环境略有不同（TR1 功能包与否等）。也许最好尝试在您的特定环境中[构建 Boost 自己。](http://www.boost.org/doc/libs/1_37_0/more/getting_started/windows.html#or-build-binaries-from-source)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T17:40:59.117

让自己成为[依赖步行者](http://www.dependencywalker.com/)。在其中打开您的应用程序 exe。它将向您显示您的应用程序需要但无法加载/访问的所有 dll。

如果这还不够，您还可以使用dependency walker 分析您的应用程序，这将为您提供大量输出以找出问题所在。

[编辑] 因为您只有调试版本存在问题：确保在升级 boost 时，不仅重建了发布二进制文件，还重建了 boost 的调试二进制文件。当然，请确保调试版本是使用与您现在使用的相同版本的 VisualStudio 构建的。

并确保包含路径（工具->选项->项目和解决方案->VC++目录）是正确的：最新的boost版本的路径必须在那里，而不是旧版本的路径。

# c# - 你如何（单元）测试数据库模式？

> ID：439855
> 
> 赞同：11
> 
> 时间：2009-01-13T17:08:08.357
> 
> 标签：c#, .net, sql-server, unit-testing, testing

当有很多人在做一个项目时，所有的人都可以改变数据库模式，单元测试/测试/验证的最简单方法是什么？到目前为止，我们的主要建议是为每个表编写测试以验证列名、约束等。

有没有其他人做过类似/更简单的事情？我们将 C# 与 SQL Server 一起使用，如果这有什么真正的不同的话。

更新：

*   我们正在处理的项目部分是使用 SSIS 包来完成大部分工作，因此很少有 C# 代码可以再次编写单元测试。
*   创建表/存储过程的代码分布在 SQL 文件中。由于构建系统，我们也可以维护一个单独的 VS DB 项目文件，但我不确定这将如何帮助我们验证架构。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T17:37:39.110

一个可能的答案是使用 Visual Studio for Database 开发人员，并将您的架构与其余代码一起保存在源代码控制中。这使您可以看到差异，并获得谁更改了什么的历史记录。

或者，您可以使用 SQLCompare 之类的工具来查看与另一个数据库相比，一个数据库中已修改的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:41:15.543

就我而言，您的（关系）数据库做了两件事：1）保存数据和 2）保存数据之间的关系。

持有数据不是一种行为，因此您不会对其进行测试

为了确保关系，只需使用约束。很多约束。到处都是。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-08T15:02:09.227

我以前不得不做这种事情，虽然不是在 C# 中。[首先，我根据Ode to Code（第 1 页，共 5 页）中](http://odetocode.com/blogs/scott/archive/2008/01/30/three-rules-for-database-work.aspx)的讨论构建了一个模式迁移工具（也有现有的工具可以做类似的事情）。重要的是，我构建的迁移工具允许您指定要应用更改的数据库以及要应用的版本。然后，遵循测试优先的方法，每当我需要进行架构更改时，我都会编写一个测试脚本，该脚本将创建一个测试数据库，将版本更改应用于我的目标更改脚本之前的版本，添加一些数据，在下应用更改脚本测试，并确认数据处于预期状态。

我的主要目标是确认在架构迁移期间没有数据丢失或损坏，而不是专门检查架构是否处于特定状态。需要很好地了解您的生产数据集，以便您可以为测试编写具有代表性的样本数据。

这是否应该被视为单元测试或集成测试是值得商榷的。我倾向于考虑集成测试，因为我不想每次迭代代码时都运行旧测试。不管你想怎么称呼它，我发现它在这种情况下是一个有用的工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T17:40:32.473

这是一个有趣的问题！有很多工具可以用于测试存储过程，但不能用于测试数据库模式。

您是否发现为代码编写的单元测试通常会发现数据库架构有任何问题？

我使用的一种方法是编写存储过程，将测试数据从开发人员的模式复制到测试模式。这是相当粗糙和准备好的，因为存储过程在遇到模式之间的任何差异时通常会崩溃，但它确实会提醒您注意您尚未被告知的任何更改。

并提名某人成为监控模式更改的 DBA？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-09-25T19:06:13.250

This is an old question but it appears that people are still landing here. So the best tool I have found so far is "SQL Test" by Red Gate. It allows you to create scripts that run as transactions. Allowing you to run "sandboxed" queries for checking the state of the database.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T22:02:49.220

*您是否发现为代码编写的单元测试通常会发现数据库架构有任何问题？*

当然，这假设您的测试测试了所有内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T18:11:56.060

这并不真正适合单元测试范式。我建议对模式进行版本控制，并将写入权限限制为单个合格的团队成员，例如 DBA 或团队负责人，他们可以针对整个应用程序验证任何请求的更改。架构更改不应随意进行。

# api - 有电影放映时间API吗？

> ID：439857
> 
> 赞同：71
> 
> 时间：2009-01-13T17:09:19.493
> 
> 标签：api, movies

有谁知道通过邮政编码访问电影放映时间的任何（最好是免费的）受支持的 api？

我不相信任何现有的 api，例如 netflix 或 imdb，提供此信息。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-02-04T11:03:12.363

当“allow_url_fopen”被禁用时，然后使用

```
 <?php
/**
 * Google Showtime grabber
 * 
 * This file will grab the last showtimes of theatres nearby your zipcode.
 * Please make the URL your own! You can also add parameters to this URL: 
 * &date=0|1|2|3 => today|1 day|2 days|etc.. 
 * &start=10 gets the second page etc...
 * 
 * Please download the latest version of simple_html_dom.php on sourceForge:
 * http://sourceforge.net/projects/simplehtmldom/files/
 * 
 * @author Bas van Dorst <info@basvandorst.nl>
 * @version 0.1 
 * @package GoogleShowtime
 *
 * @modifyed by stephen byrne <gold.mine.labs@gmail.com>
 * @GoldMinelabs.com 
 */

require_once('simple_html_dom.php');

$curl = curl_init(); 
curl_setopt($curl, CURLOPT_URL, 'http://www.google.ie/movies?near=dublin');  
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);  
curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 10);  
$str = curl_exec($curl);  
curl_close($curl);  

$html = str_get_html($str);

print '<pre>';
foreach($html->find('#movie_results .theater') as $div) {
    // print theater and address info
    print "Theate:  ".$div->find('h2 a',0)->innertext."\n";
    //print "Address: ". $div->find('.info',0)->innertext."\n";

    // print all the movies with showtimes
    foreach($div->find('.movie') as $movie) {
        print "Movie:    ".$movie->find('.name a',0)->innertext.'<br />';
        print "Time:    ".$movie->find('.times',0)->innertext.'<br />';
    }
    print "\n\n";
}

// clean up memory
$html->clear();
?> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-11-23T21:19:01.117

是的，雅虎显然在 2009 年 11 月删除了他们的秘密电影 API。
似乎每个人都从 TMS Data Direct 获取数据：[http ://www.tmsdatadirect.com/](http://www.tmsdatadirect.com/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T17:16:38.417

不知道 Google 是否将其公开为 api，但这看起来很像您想要的。 [http://www.google.com/movies?hl=en&near=90210&dq=movie+times+90210&sa=X&oi=showtimes&ct=title&cd=1](http://www.google.com/movies?hl=en&near=90210&dq=movie+times+90210&sa=X&oi=showtimes&ct=title&cd=1)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-01T14:37:48.847

Fandango 似乎有 RSS 提要，可让您搜索附近的电影。

它们可以在这里找到：

[https://www.fandango.com/rss/moviefeed](https://www.fandango.com/rss/moviefeed)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T18:34:54.437

抱歉，在发布问题之前应该进行更多搜索。

del.icio.us 上的一些[创造性搜索](http://delicious.com/search?p=api.movies&u=happykylie&chk=&context=userposts&fr=del_icio_us&lc=0)发现了一个无证的 yahoo！电影 api（[示例 api 调用](http://new.api.movies.yahoo.com/v2/listTheatersByPostalCode?pcode=90210&count=20&yprop=msapi)）。

看起来不错。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-03T21:02:50.263

我也在寻找可以合法抓取和重新发布的放映时间。如果您不出于商业目的这样做，雅虎的声音就不会被禁止……或者这可能是我的一厢情愿。

> 您同意不 **出于任何商业目的**复制、复制、复制、出售、交易、转售或利用Yahoo! 的任何部分、使用或访问。服务

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-06T10:16:21.087

环顾四周后，我发现 Dapper (open.dapper.net) 是创建此类提要的绝佳解决方案...

这是我制作的提要，它以电影标题和邮政编码作为参数。（大多数其他可用仅通过 ZIP 搜索）

[http://www.dapper.net/dapp-howto-use.php?dappName=GoogleMoviesbynameANDzip](http://www.dapper.net/dapp-howto-use.php?dappName=GoogleMoviesbynameANDzip)

花了大约5分钟来设置...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-10-25T14:33:31.153

不确定从中刮取 html 是否合法，但是，它是我发现的最干净的伪 API。[http://opensocial.flixster.com/igoogle/showtimes?date=20111025&postal=23226](http://opensocial.flixster.com/igoogle/showtimes?date=20111025&postal=23226) - 只需用类似...的东西刮掉html

```
$('div.showtime', response).each(function() {
   // ... process each showtime div
}); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T17:13:22.137

我的猜测是，你最好的选择（除非这些人有 RSS 提要）是用支持正则表达式的语言来抓取 HTML。

请注意，这很丑陋，每次他们更改代码时，您的代码都可能会损坏。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T17:15:41.680

我找不到一个。

您可以尝试从 Yahoo Movies 进行屏幕抓取： http://movies.yahoo.com/showtimes/movie?z=60630&date=20090113&mid= [1810038822](http://movies.yahoo.com/showtimes/movie?z=60630&date=20090113&mid=1810038822)

```
z    = zip code
date = year + month + day (as a string)
mid  = movieID, which you will have to grab from Yahoo Movies 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-01-21T21:44:26.687

我也在寻找一个放映时间 API，和你一样，我还没有找到一个好的电影放映时间 API。我决定基于 Google Showtimes 编写自己的“showtime API”。请检查一下。

这是一个简单的 PHP 脚本，但“它做了它应该做的事情”：

```
 <?php
/**
 * Google Showtime grabber
 * 
 * This file will grab the last showtimes of theatres nearby your zipcode.
 * Please make the URL your own! You can also add parameters to this URL: 
 * &date=0|1|2|3 => today|1 day|2 days|etc.. 
 * 
 * Please download the latest version of simple_html_dom.php on sourceForge:
 * http://sourceforge.net/projects/simplehtmldom/files/
 * 
 * @author Bas van Dorst <info@basvandorst.nl>
 * @version 0.1 
 * @package GoogleShowtime
 */

require_once('simple_html_dom.phps');

$html = new simple_html_dom();
$html->load_file('http://www.google.nl/movies?mid=&hl=en&near=1400AB');

print '<pre>';
foreach($html->find('#movie_results .theater') as $div) {
    // print theater and address info
    print "Theate:  ".$div->find('h2 a',0)->innertext."\n";
    print "Address: ". $div->find('.info',0)->innertext."\n";

    // print all the movies with showtimes
    foreach($div->find('.movie') as $movie) {
        print "\tMovie:    ".$movie->find('.name a',0)->innertext.'<br />';
        print "\tTime:    ".$movie->find('.times',0)->innertext.'<br />';
    }
    print "\n\n";
}

// clean up memory
$html->clear();

?> 
```

示例：http://code.basvd.nl/showtime_grabber_0.1/Google_showtime.php

下载 simple_html_dom.php：http://code.basvd.nl/showtime_grabber_0.1/

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2012-02-06T18:00:44.183

我知道这有点老了。我认为目前还没有 api，但一些提供商确实提供了这项服务。我建议你看看西方世界媒体。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2011-02-16T18:24:51.143

```
http://www.google.com/ig/api?movies=YOUR_ZIP_HERE 
```

感谢尼克。这就是我将使用的链接。

# sql-server - SQL SERVER CLR 的优势

> ID：439859
> 
> 赞同：13
> 
> 时间：2009-01-13T17:09:28.743
> 
> 标签：sql-server, clr, sqlclr

SQLServer CLR 与 T-SQL 相比有哪些优势？使用 .NET 语法是否比 T-SQL 更容易？我看到您可以定义用户类型，但我不太清楚为什么这样做更好。例如，您可以定义一个电子邮件类型，它会有一个前缀属性和一个域属性。然后，您可以搜索域或前缀或两者。但是，我看不出这与添加几列有什么不同，一列称为前缀，一列称为域并单独搜索它们。也许有人有现实世界的理由为什么这更好。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-13T17:17:39.243

我将举一个很好的例子：CLR 有一个内置的 RegEx 对象，这在 SQL Server 中是非常缺乏的。现在编写函数来执行基于正则表达式的验证约束/修复是微不足道的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-13T17:12:16.710

不同的目的。CLR 存储过程对于编写高度过程化的代码或使用 T-SQL 无法访问的系统设施会带来好处的事情很有用。尽管没有内在的理由不能针对它编写应用程序存储过程，但通常您不会将 CLR 存储过程视为一种仅用于编写应用存储过程的不同语言。通常，CLR sproc 的大多数用途将用于系统目的而不是应用程序组件，尽管这绝不是硬性规定。

CLR 集成层确实提供了一些 T-SQL 存储过程无法直接使用的功能，例如自定义聚合函数。它还提供对 .Net 库的访问，这对于访问 T-SQL 不支持的功能可能很有用。

T-SQL 做传统数据库的东西，并与查询优化器集成，因此它仍然最适合面向集合的数据库代码。有用于 CLR 存储过程的 API 挂钩向查询优化器提供信息，但这增加了一些复杂性。

还可以使用 CLR 集成来定义 T-SQL 代码可访问的函数。在某些情况下，这些函数比 T-SQL 函数更快且内存效率更高。Wrox 关于 CLR 集成的[新闻书籍](https://rads.stackoverflow.com/amzn/click/com/0470054034)对此进行了深入讨论。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-15T17:19:40.063

例如，您还可以从 SQLCLR 方法调用外部 Web 服务 - 在 T-SQL 中并不完全可能 :-)

马克

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-14T20:38:51.887

SQL Server 中的 SQLCLR / CLR 集成只是帮助解决某些（不是全部）问题的另一种工具。有些事情它比纯 T-SQL 做得更好，有些事情只能通过 SQLCLR 完成。我为 SQL Server Central 写了一篇文章，[Stairway to SQLCLR Level 1：什么是 SQLCLR？](http://www.sqlservercentral.com/articles/Stairway+Series/104406/)（需要免费注册才能阅读那里的文章），这解决了这个问题。基础知识是（有关详细信息，请参阅链接的文章）：

*   流表值函数 (sTVF)
*   动态 SQL（在函数内）
*   更好地访问外部资源/替换 xp_cmdshell
    *   传入数据更容易
    *   取回结果集的多列更容易
    *   没有外部依赖（例如 7zip.exe）
    *   通过模拟提高安全性
*   多线程能力
*   错误处理（函数内）
*   自定义聚合
*   自定义类型
*   修改状态（在函数内且不带`OPENQUERY`/ `OPENROWSET`）
*   执行存储过程（只读；在函数内且不带`OPENQUERY`/ `OPENROWSET`）
*   性能（**注意：**这*并不是*在所有情况下都有意义，但在某些情况下肯定取决于操作的类型和复杂性）
*   可以捕获输出（即发送到 SSMS 中的“消息”选项卡的内容）（例如，`PRINT`严重性*=* 0 到 10）——我忘了​​在文章中提到这一点 ;-)。`RAISERROR`

 *要考虑的另一件事是，有时能够在应用程序和数据库之间共享代码是有益的，这样数据库就可以深入了解某些业务逻辑，而无需构建自定义的、仅限内部的屏幕来访问该应用程序代码。例如，我曾在一个系统上工作，该系统从客户那里导入数据文件，并使用大多数字段的自定义哈希并将该值保存到数据库中的行中。这允许在再次导入数据时轻松跳过行，因为应用程序将从输入文件中散列值并与存储在行中的散列值进行比较。如果它们相同，那么我们立即知道所有字段都没有改变，所以我们进入下一行，这是一个简单的 INT 比较。但是用于进行哈希的算法仅在应用程序代码中，因此无论是用于调试客户案例还是通过标记至少有一个字段发生更改的行（来自我们的应用程序的更改）来寻找将某些处理卸载到后端服务的方法与在较新的导入文件中查找更改相反），我无能为力。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。

如果有兴趣在不编写任何代码的情况下查看其中的一些功能，[SQL#](http://www.sqlsharp.com/)的免费版本（我是它的作者）有 RegEx 函数、自定义聚合 (UDA)、自定义类型 (UDT) 等。

# spring - Spring MVC 标签与自定义标签的交互

> ID：439861
> 
> 赞同：8
> 
> 时间：2009-01-13T17:09:57.947
> 
> 标签：spring, spring-mvc, jstl, jsp-tags

我有一个使用 Spring:form 标签将控件绑定到命令对象的 JSP。

我想对其进行如下修改：如果[某些条件为真]，则显示控件；否则，只显示文本。（示例：如果用户是管理员，则显示控件，否则仅显示文本。如果 whatsit 仍可修改，则显示控件，否则显示文本。）

换句话说，我想要这个：

```
<c:choose>
     <c:when test="SOME TEST HERE">
          <form:input path="SOME PATH" />
     </c:when>
     <c:otherwise>
          <p>${SOME PATH}</p>
     </c:otherwise>
</c:choose> 
```

但我想要一种简单的方法来为每个领域（有很多）创建这个。

如果我创建一个自定义标签来生成上述文本（给定“SOME PATH”），Spring 自定义标签会被绑定吗？

我想我真正要问的是：我可以创建自定义标签来生成**然后**绑定的 Spring 自定义标签吗？还是同时处理所有自定义标签（我的和 Spring 的）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-20T20:31:05.093

通常，唯一的解决方案是尝试一下。

我尝试了三种不同的方法——JSP 自定义标记库、参数化的 JSP 包含和 JSP2 标记文件。

前两个不起作用（虽然我怀疑可以使标签库起作用），但是标签文件起作用了！该解决方案大致基于[Expert Spring MVC 和 Web Flow](http://www.apress.com/book/view/9781590595848)中给出的示例。

这是我在 WEB-INF/tags/renderConditionalControl.tag 中的代码：

```
<%@ tag body-content="tagdependent" isELIgnored="false" %>
<%@ attribute name="readOnly" required="true" %>
<%@ attribute name="path" required="true" %>
<%@ attribute name="type" required="false" %>
<%@ attribute name="className" required="true" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="form" uri="/WEB-INF/spring-form.tld" %>
<%@ taglib prefix="spring" uri="/WEB-INF/spring.tld" %>

<c:if test="${empty type}">
<c:set var="type" value="text" scope="page" />
</c:if>

<spring:bind path="${path}">
    <c:choose>
        <c:when test="${readOnly}">
            <span class="readOnly">${status.value}</span>
        </c:when>
        <c:otherwise>
           <input type="${type}" id="${status.expression}" name="${status.expression}"
                    value="${status.value}" class="${className}" />
        </c:otherwise>
    </c:choose>
</spring:bind> 
```

这是jsp中的代码：

首先，使用其他 taglibs 指令：

```
<%@ taglib tagdir="/WEB-INF/tags" prefix="tag" %> 
```

并在表格内：

```
<tag:renderConditionalControl path="someObject.someField" type="text" readOnly="${someBoolean}" className="someClass" /> 
```

# cryptography - 为什么素数在密码学中很重要？

> ID：439870
> 
> 赞同：200
> 
> 时间：2009-01-13T17:12:17.663
> 
> 标签：cryptography, primes

作为一个非密码学家，我总有一件让我印象深刻的事情：为什么使用素数如此重要？是什么让它们在密码学中如此特别？

有没有人有一个*简单*的简短解释？（我知道有很多入门书，应用密码学是圣经，但正如所说：我不打算实现自己的密码算法，而我发现的东西让我的大脑爆炸了——没有 10 页的数学公式请 ：））

**感谢**所有的答案。我接受了那个让我最清楚实际概念的那个。

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2009-01-13T17:19:17.977

最基本和一般的解释：密码学都是关于[数论](http://en.wikipedia.org/wiki/Number_theory)的，所有整数（除了 0 和 1）都是由素数组成的，所以在数论中你会处理很多素数。

更具体地说，一些重要的加密算法（如[RSA ）严重依赖于大数的](http://en.wikipedia.org/wiki/RSA_(cryptosystem))[素数分解](http://en.wikipedia.org/wiki/Integer_factorization)需要很长时间这一事实。基本上，您有一个“公钥”，由用于加密消息的两个大素数的乘积组成，以及一个由用于解密消息的这两个素数组成的“秘密密钥”。您可以公开公钥，每个人都可以使用它来加密给您的消息，但只有您知道主要因素并可以解密消息。考虑到目前数论技术的现状，其他人都必须考虑这个数字，这需要很长时间才能实现。

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2009-01-13T17:15:21.727

简单的？是的。

如果你将两个大素数相乘，你会得到一个只有两个（大）素因子的巨大非素数。

分解该数字是一项不平凡的操作，而这一事实是许多密码算法的来源。有关详细信息，请参阅[单向函数](http://en.wikipedia.org/wiki/One-way_function)。

附录：只是多一点解释。两个素数的乘积可以用作公钥，而素数本身可以用作私钥。对数据所做的任何操作都只能通过知道这两个因素之一来撤消，这对于解密来说并非易事。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-01-13T17:15:03.477

这是一个非常简单和常见的例子。

安全商务网站中常用的[RSA 加密算法](https://en.wikipedia.org/wiki/RSA_(cryptosystem))基于这样一个事实，即取两个（非常大的）素数并将它们相乘很容易，而反之则非常困难 - 意思是：取一个非常大的数，给定它只有两个质因数，然后找到它们。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-01-13T17:35:19.253

重要的不是素数本身，而是使用素数的算法。特别是，找到一个数字（任何数字）的因数。

如您所知，任何数字至少有两个因素。素数具有独特的性质，因为它们恰好有两个因数：1 和它们自己。

因式分解如此重要的原因是数学家和计算机科学家不知道如何在不尝试所有可能组合的情况下对数字进行因式分解。也就是说，首先尝试除以 2，然后除以 3，再除以 4，以此类推。如果你试图分解一个素数——尤其是一个非常大的素数——你必须尝试（基本上）在 2 和那个大素数之间的每一个可能的数字。即使在最快的计算机上，也需要数年（甚至数百年）来分解密码学中使用的素数种类。

事实上，我们不知道如何有效地分解大量数字，这使得密码算法具有强大的实力。如果有一天，有人想出了如何做到这一点，那么我们目前使用的所有加密算法都将过时。这仍然是一个开放的研究领域。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-01-13T17:19:52.390

因为没有人知道将整数分解为其素数的快速算法。然而，很容易检查一组素因数是否乘以某个整数。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-13T17:17:35.110

有一些很好的资源可以增加加密货币。这是一个：

*   [http://research.microsoft.com/en-us/groups/crypto/firstcrypto.aspx](http://research.microsoft.com/en-us/groups/crypto/firstcrypto.aspx)

从该页面：

> 在 Ron Rivest、Adi Shamir 和 Len Adleman 于 1977 年发明的最常用的公钥密码系统中，公钥和私钥都是根据一个相对简单的数学公式从一对大素数中导出的。理论上，可以通过倒推公式从公钥中推导出私钥。但只有大素数的乘积是公开的，将这种大小的数分解为素数非常困难，即使是世界上最强大的超级计算机也无法破解普通的公钥。

Bruce Schneier 的《*应用密码学*》一书是另一本。我强烈推荐那本书；阅读很有趣。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-01-13T20:23:32.597

为了更具体地了解 RSA 如何使用素数的属性，RSA 算法严重依赖于[欧拉定理](http://en.wikipedia.org/wiki/Euler%27s_Theorem)，该定理指出，对于相对素数“a”和“N”，a^e 等于 1[模](http://en.wikipedia.org/wiki/Modular_arithmetic)N，其中e 是N[的欧拉总函数。](http://en.wikipedia.org/wiki/Euler%27s_totient_function)

质数是从哪里来的？为了有效地计算 N 的欧拉总函数，需要知道 N 的素数分解。在 RSA 算法的情况下，对于某些素数“p”和“q”，其中 N = pq，则 e = (p - 1)(q - 1) = N - p - q + 1。但是在不知道 p 和 q 的情况下，计算 e 非常困难。

更抽象地说，许多加密协议使用各种[陷门函数](http://en.wikipedia.org/wiki/Trapdoor_function)，这些函数易于计算但难以反转。数论是此类陷门函数（例如大素数的乘法）的丰富来源，而素数绝对是数论的核心。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-10-02T17:00:44.183

我会推荐这本书[A Mathematical Journey In Code](https://rads.stackoverflow.com/amzn/click/com/0761123849)。这本书有一种很好的脚踏实地的感觉，这令人惊讶，因为它是关于密码学的。这本书总结了 Sarah Flannery 从小时候学习拼图到 16 岁时创建 Cayley-Purser (CP) 算法的历程。它对单向函数、数论和素数以及它们与密码学。

使这本书对您的问题更加具体的原因是莎拉试图使用矩阵实现一种新的公钥算法。它比使用素数要快得多，但发现了一个可以利用它的漏洞。事实证明，她的算法更适合用作私有加密机制。这本书很好地证明了使用素数进行加密，因为它经受住了时间的考验和非常聪明的人的挑战。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-01-13T18:12:38.883

为您提供更多资源。 [立即安全！第 30 集](http://www.grc.com/sn/sn-030.htm)（约 30 分钟的播客，链接是成绩单）讨论了密码学问题，并解释了为什么素数很重要。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-03-18T13:20:50.630

我不是数学家或神秘主义者，所以这是外行人的外部观察（没有花哨的方程式，抱歉）。

整个线程充满了关于**如何**在密码学中使用素数的解释，很难在这个线程中找到任何人以简单的方式解释**为什么**使用素数......很可能是因为每个人都认为这些知识是理所当然的。

只有从外面看问题，才会产生这样的反应；但是如果他们使用两个素数的和，为什么不创建一个任何两个素数可以生成的所有可能和的列表呢？

在这个[网站上](http://www.prime-numbers.org/)有一个**455,042,511 个**素数的列表，其中最高的素数是**9,987,500,000**（**10**位数字）。

已知最大的素数（截至 2015 年 2 月）是**2 的 257,885,161 - 1 次方**，即**17,425,170**位。

这意味着保留所有已知素数的列表是没有意义的，更不用说它们所有可能的总和了。取一个数字并检查它是否是素数更容易。

计算大素数本身就是一项艰巨的任务，因此**逆向计算**已相乘的两个素数密码学家和数学家都会说已经**够难了**……今天。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-13T17:19:00.800

密码算法的安全性通常依赖于“难题”。大多数现代算法似乎都使用非常大数的因式分解作为他们的难题 - 如果将两个大数相乘，计算它们的因式是“困难的”（即耗时）。如果这两个数字是素数，那么只有一个答案，这使得它变得更加困难，并且还保证当你找到答案时，它是正确的，而不是恰好给出相同结果的其他答案。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-01-13T17:27:13.950

我认为密码学中重要的不是素数本身，而是*素数分解问题*的**难度**

 *假设你有一个非常大的整数，已知它是两个素数 m 和 n 的乘积，那么要找到 m 和 n 是不容易的。诸如 RSA 之类的算法取决于这个事实。

顺便说一句，有一篇关于算法的[已发表论文](http://arxiv.org/abs/quant-ph/9508027)可以使用量子计算机在可接受的时间内“解决”这个素数分解问题。因此，当量子计算机出现时，密码学中较新的算法可能不再依赖质数分解的这种“困难”了:)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-07-24T20:47:34.857

因为分解算法在找到每个因子后都会大大加快速度。将两个私钥设为素数可确保找到的第一个因素也是最后一个因素。理想情况下，两个私钥的价值也几乎相等，因为只有较弱密钥的强度很重要。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-06-19T09:21:19.403

素数主要用于密码学，因为它会花费大量时间来确定给定数是否为素数。对于黑客来说，如果任何算法需要花费大量时间来破解代码，它对他们来说就变得毫无用处

# data-binding - XAML 模板水平绑定

> ID：439877
> 
> 赞同：0
> 
> 时间：2009-01-13T17:14:38.080
> 
> 标签：data-binding, xaml, templates

我想知道如何使用模板数据绑定来完成以下代码生成的内容（带有一些关联文本的复选框网格）：

```
 int tbIndex = 0;
        for (int i = 1; i < 5; i++) {
            StackPanel pan = new StackPanel();
            pan.Orientation = Orientation.Horizontal;
            pan.Margin = new Thickness(3);
            pan.Name = "RowPanel" + i;
            for (int j = 0; j < 3; j++) {
                CheckBox cb = new CheckBox();
                TextBlock block = new TextBlock();
                block.Width = 75;
                block.Text = "Item " + (++tbIndex).ToString();
                pan.Children.Add( cb );
                pan.Children.Add( block );
            }
            ContentPanel.Children.Add( pan );
        } 
```

例如，在 ASP.NET 中，可以使用 DataList 并将重复方向设置为水平和绑定。是否有一种等效的方式，它的命令性和声明性更强（即使用模板预先完成并使用通用的“数据绑定”工具）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T17:21:08.907

```
<ItemsControl ItemsSource="{Binding YourListOfItems}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal">
                <CheckBox IsChecked="{Binding YourIsChecked}"/>
                <TextBlock Text="{Binding YourText}"/>
            </StackPanel>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

这假设您在名为 的属性中有一组对象`YourListOfItems`。在这些对象中的每一个中，它假定存在称为`YourIsChecked`( `bool`) 和`YourText`(probably `string`) 的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:27:53.840

[Silverlight 工具包](http://www.codeplex.com/Silverlight)有一个 Wrap Panel。

这是它的[描述](http://jesseliberty.com/2008/12/03/the-wrap-panel/)。

作为一个开源项目，您可以了解它是如何做到的，并为 WPF 创建类似的东西，我不敢相信似乎没有人已经将该工具包移植到完整的 WPF 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T22:25:17.873

AnthonyWJones 认为 Wrap Panel 是一种很好的方法是正确的，但 Kent 在演示如何使用 ItemSource 时遇到了麻烦（尽管 StackPanel 没有达到目标）。因此，我将发布演示声明等价的代码：

```
<ItemsControl x:Name="myItems" Width="300">
    <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
            <controls:WrapPanel x:Name="itemsWrapPanel" Margin="0" Orientation="Horizontal" />
        </ItemsPanelTemplate>
    </ItemsControl.ItemsPanel>
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal" Width="100">
                <CheckBox IsChecked="{Binding MyCheckedProperty, Mode=TwoWay}" x:Name="IsSelectedCheckBox" Height="25"></CheckBox>
                <TextBlock Height="12" Text="{Binding MyTextProperty}" Margin="0" />
            </StackPanel>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl> 
```

一个小问题是 DataTemplate 需要一个孩子，因此使用水平方向的 StackPanel 可以保持流畅。

# .net - IDictionary (.NET) 使用指南

> ID：439897
> 
> 赞同：2
> 
> 时间：2009-01-13T17:19:35.103
> 
> 标签：.net

我相信 IDictionary 类更适用于可排序的对象。我还相信 IComparer 接口对于对类中的对象进行排序是必要的。我还在[MSDN](http://msdn.microsoft.com/en-us/library/7h9bszxx.aspx)上读到，当你实现 IComparable 时，你需要重写 Equals 方法（我假设是 GetHashCode 扩展名）。

我有三个疑问：

1）以上任何假设都不正确？

2) 当我实施 IComparer 时，我必须遵循相同的 IComparable 准则吗？

3) 当我重写 Equals 方法时，我将不得不重写 == 运算符，或者反过来是真的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T17:28:23.793

（我已经把泛型去掉了大部分——泛型和非泛型形式的原则相同。没有非泛型 IEquatable 接口，因为 System.Object 已经有相关方法。）

对象不必是可排序的才能用作`IDictionary`键。但是，它们必须具有合理的哈希码和相等实现。

除非您使用的是实际对键进行*排序*的字典，否则您应该对[`IEqualityComparer<T>`](http://msdn.microsoft.com/en-us/library/ms132151.aspx)和更感兴趣[`IEquatable<T>`](http://msdn.microsoft.com/en-us/library/ms131187.aspx)- 您不需要能够说一个对象大于或小于另一个对象，只是它们是否相等和一个对象的哈希码是什么（以与 一致的方式`Equals`）。

实现`IEquatable`就像实现`IComparable`——它意味着一个对象可以将*自己*与另一个指定类型（通常是相同类型）的对象进行比较。尽管您不必重写 Equals(object) 来实现 IEquatable，但强烈建议您这样*做。*

实现`IEqualityComparer`就像实现`IComparer`- Equals/Compare 方法不是将“this”对象与另一个对象进行比较，而是采用*两个*值进行比较。`IEqualityComparer`/的实现`IComparer`很少覆盖`object.GetHashCode`or `object.Equals`，除非他们想要允许比较比较器 - 很少有用。

对于您的第三点：覆盖`Equals`当然不会强迫您重载 == （您不能覆盖运算符，只能重载它们）。您可以选择是否要执行此操作。

# c# - C# - 修改数据表

> ID：439900
> 
> 赞同：0
> 
> 时间：2009-01-13T17:20:38.473
> 
> 标签：c#, database, datagrid, datatable

我有一个从数据库连接填充的数据表。我想对数据表进行检查，例如用文本替换数字并添加我自己的数据，然后再将其绑定到数据网格以供查看。如何访问数据表中的一条数据？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:23:42.537

只需查看表的`.Rows`集合，并使用普通数组 ( `[]`) 表示法访问每一行中的字段，使用列索引或字段名称作为下标。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:24:55.373

您可以订阅 DataGrid 的[ItemDataBound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datagrid.itemdatabound.aspx)事件，然后在将 DataGridRow 的内容全部发送回浏览器之前对其进行修改。

这是它的使用[示例](http://www.codeproject.com/KB/webforms/ItemCreated.aspx)。在事件处理程序中，尝试：

```
Label lblBalance = (Label)e.Item.FindControl("dgLabel2"); 
```

或者

```
e.Item.Cells[2].Text = "whatever text" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T18:21:38.473

```
DataSet ds = GetData();
foreach( DataTable dt in ds.Tables )
{
   foreach( DataRow row in dt.Rows )
   {
      if ( row["columnName"] != DBNull.Value )
      {
         row["columnName"] = "some data";
      }
   }
}
DataBind(); 
```

# java - Java 等价于 C# 的 TimeSpan

> ID：439903
> 
> 赞同：34
> 
> 时间：2009-01-13T17:21:14.087
> 
> 标签：java, datetime, time, timespan

Java 是否具有表示时间段的数据类型，例如 34 秒、5 分钟等。

我见过一些 TimeSpan 的实现，涵盖了从 12 月 10 日到 12 月 11 日这样的时间段。

我需要的是 C# 中的 TimeSpan 之类的东西。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-13T17:25:53.313

目前不是 JDK 的一部分，但将被纳入 JDK 7 - 试试[Joda Time](http://joda-time.sourceforge.net/)

# c++ - UTF-8 从文件到文本框 VC++ 6.0

> ID：439915
> 
> 赞同：1
> 
> 时间：2009-01-13T17:25:00.303
> 
> 标签：c++, mfc, utf-8, visual-c++-6

如何让旧的 VC++ 6.0 MFC 程序在 TextBox 或 MessageBox 中读取和显示 UTF8？最好不要破坏当前写入其中的任何文件读取和显示（相当大）。

我将一行读入 CString strStr，然后使用以下代码：

```
int nLengthNeeded = MultiByteToWideChar(CP_UTF8,0,strStr,1024,0,0);
wchar_t * pWCMessage = new wchar_t[ nLengthNeeded ];

MultiByteToWideChar(CP_UTF8,0,strStr,1024,pWCMessage,nLengthNeeded);

nLengthNeeded = MultiByteToWideChar(CP_UTF8,0,"Error Title",50,0,0);
wchar_t * pWCTitle = new wchar_t[ nLengthNeeded ];
MultiByteToWideChar(CP_UTF8,0,"Error Title",50,pWCTitle,nLengthNeeded);

MessageBoxW(NULL,pWCMessage,pWCTitle,MB_ICONINFORMATION); 
```

仍然不确定如何将其放入文本框中，但事实证明我不需要这样做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:47:04.300

我觉得这不会有帮助，但这是一个起点......我假设它不会“正常工作”，而且我认为您不想尝试使用古怪的代码页来解决可能或者可能无法得到你想要的。

如何仅使用 MultiByteToWideChar(CP_UTF8, ...) 将其转换为 utf16，然后调用这些函数的 W 版本（或为项目定义 UNICODE/_UNICODE）。

我知道这适用于 MessageBox，我无法想象文本框没有 unicode 支持。

如果您需要将输出恢复为 UTF8 - 只需使用 WideCharToMultiByte()。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:37:05.287

看一眼：

[widechartomultibyte](http://msdn.microsoft.com/en-us/library/ms776420(VS.85).aspx)和[更多一般信息](http://msdn.microsoft.com/en-us/library/ey142t48.aspx)

当/如果您遇到麻烦，请确保发布您的代码。自从我这样做以来已经有一段时间了，我记得这有点棘手。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:50:36.930

[首先使用 API MultiByteToWideChar](http://msdn.microsoft.com/en-us/library/ms776413(VS.85).aspx)将 utf8 字符串转换为宽字符串，并将 CP_UTF8 传递给 codepage 参数。如果您的应用程序是使用定义的 _UNICODE 编译的，您现在可以将宽字符串传递给您的文本框。

[但是，如果您的应用程序被编译为 MBCS 应用程序，则必须使用WideCharToMultiByte](http://msdn.microsoft.com/en-us/library/ms776420(VS.85).aspx)将宽字符串转换回 MBCS ，并将 CP_ACP 作为代码页参数传递。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T19:33:36.520

你的应用是 Unicode。如果是，请回退到 Stefan 的回答：

MyDisplayableUtf16String = MultiByteToWideChar(CP_UTF8, MyUtf8String,...)

我假设它不是那么简单：您的应用程序是 ANSI。首先，您需要将字符串转换为 UTF16，如上所示。然后有一个瓶颈：您的 UTF8 字符串是否包含当前系统代码页之外的字符（又名“非 Unicode 应用程序语言”）？如果不是，则使用将 UTF16 字符串转换为系统区域设置

```
MyGoodOldAnsiString = WideCharToMultiByte(CP_ACP,MyUtf16String,...) 
```

（或使用 ATL/MFC 宏之一，例如`W2A(MyUtf16String)`）

你就完成了。

否则该字符串无法转换为 ANSI，这意味着您将有一个......咳咳......很难在 ANSI 文本框或消息框中显示它。

正如乔指出的那样，您可以使用在消息框中显示文本

MessageBoxW(...,MyDisplayableUtf16String,...)

尾随的 W 表示 API 的 Unicode (UTF16) 版本。

但是，在文本框中显示字符串仍然很困难：您需要使用`CreateWindowExW()`. 如果文本框的父窗口（对话框，框架？）不是 Unicode 窗口，我认为这将不起作用。

# django - 对 Satchmo 的购物车总价征税

> ID：439917
> 
> 赞同：0
> 
> 时间：2009-01-13T17:25:31.067
> 
> 标签：django, satchmo, django-apps

即使我：

1.  激活“按国家/地区”税收模块。
2.  添加了我的国家/地区税率。
3.  选中“显示含税”复选框。

[这里附上正在进行的问题的屏幕截图](http://www.picoodle.com/view.php?img=/3/1/13/f_errorm_2003f36.png&srv=img34)，我选择了一些可疑的区域。

所以基本上，购物车显示“含税”，但既不计算项目也不计算总数。结帐在“订购的物品”中显示了一些税收计算，但其总额不是正确的金额。它也没有显示在“总”字段集中。

我稍微更改了模板以使其看起来更好一点，但我没有更改所有这些 satchmo 过滤器/标签。

[这是base_cart.html](http://dpaste.com/hold/108581/)的模板

这是结帐模板（[order_details.html](http://dpaste.com/hold/108582/)）

** 我还在[satchmo google 群组](http://groups.google.com/group/satchmo-users/browse_thread/thread/4ae29a735e2b2079)上发布了这个问题，但我认为在这里发布它可能是值得的，因为[谷歌现在有超过一百万的 stackoverflow 页面](http://www.google.ca/search?hl=fr&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=kaS&q=site%3Astackoverflow.com&btnG=Rechercher&meta=)。:P

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T18:09:36.923

我必须使用管理部分中的复选框和选择框使我的产品征税。

然后让它只计算购物车的总税额，我只需要取消选中“税费设置”中的“显示含税”。

# perl - “map”如何解释 Perl 中的第一个参数？

> ID：439927
> 
> 赞同：5
> 
> 时间：2009-01-13T17:29:20.810
> 
> 标签：perl

我对 Perl 的“map”函数有一些疑问。

具体来说：

*   如何

    %hash = 映射 {$_ => 1} @array

    创建一个哈希映射数组的元素到 1？块如何返回两个元素的列表？我认为 block 返回它的最后一个值。=> 是否隐式创建一个列表，而不是返回其正确参数的“，”？

*   为什么

    %hash = map ($_ => 1), @array

    不行？我试图在这里返回两个元素的列表......从解析器的角度来看，如何在“（”之前添加“+”修复它​​？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T17:40:37.183

问题 1：map 块是运行列表上下文，因此允许返回零、一个或多个值。`map`全部归还。" `,`" 或 " `=>`" 在标量上下文中返回它们的右侧，但在列表上下文中返回两边。有关详细信息，请参阅[perlop](http://perldoc.perl.org/perlop.html#Comma-Operator)。

问题2：`%hash = map ($_ => 1), @array`被解释为`%hash = (map($_, 1), @array)`。换句话说，它返回 (1, @array)。在`%hash = map +($_ => 1), @array`中，+ 表示 () 不引用参数列表，因此它被解释为 map(+($_ => 1), @array);

今天的教训：总是在你的地图表达周围使用赞誉，这样你就不会被这些问题所困扰。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T17:59:31.280

添加到@Leon 的正确答案以帮助您解决第二个问题：

来自[perlop](http://perldoc.perl.org/perlop.html#Symbolic-Unary-Operators)

> 一元“+”没有任何作用，即使在字符串上也是如此。它在语法上用于将函数名称与带括号的表达式分开，否则将被解释为函数参数的完整列表。

您可以使用 deparse 来查看 perl 如何解释每个：

```
perl -MO=Deparse,-p -e "%h = map ($_ => 1), @a;"
(((%h) = map($_, 1)), @a); 
```

然而

```
perl -MO=Deparse,-p -e "%h = map +($_ => 1), @a;"
((%h) = map(($_, 1), @a)); 
```

我希望这有帮助

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:33:40.990

第一个参数是代码块或子程序。代码块必须用 {} 包围。它们的工作方式不太像 lambda，但非常接近。

编辑：不知道为什么在 1 之后添加 + 有效。也许它正在以某种奇怪的方式编译成代码块？这似乎与 perldoc 不匹配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T17:43:25.993

Map 将块应用于数组/列表中的每个值并创建一个新列表。=> 是语法糖，表明列表由键/值对组成（IIRC，它也可以与普通逗号一起使用）。当您将交替键/值对列表分配给哈希变量时，会创建一个哈希表。

另一个变体不起作用，因为它不是代码块。我不知道+。

# windows - 以管理员身份运行时获取当前登录的用户

> ID：439932
> 
> 赞同：3
> 
> 时间：2009-01-13T17:29:56.037
> 
> 标签：windows, installation, nsis

我使用 NSIS 编写了一个安装程序，我需要它在标准位置（如 C:/Program Files/App Name/）安装一些文件（DLL 等）。我还需要在当前用户的 Application Data 目录中安装文件。问题是，当用户不是 Vista 上的管理员时，我需要提升权限，这样做时环境变量会发生变化，因此当前用户现在似乎是管理员用户，我最终安装在管理员用户的目录中，而不是实际用户。您必须在启动安装程序时提升，所以我无法获取用户名然后提升。当我以管理员身份运行安装程序时，是否有一些合理的方法可以确定实际用户是谁？

编辑：不幸的是，在第一次运行时复制数据不是一种选择。如果没有我写入用户目录的内容，该应用程序将无法运行，因为它是一个 MS Word 模板。如果没有模板，我的东西将无法运行，因此我必须在安装时编写模板，并且 Word 要求模板位于用户的 AppData 目录中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:43:06.990

我所有的 NSIS 安装程序都使用这个 UAC 插件： http: [//nsis.sourceforge.net/UAC_plug-in](http://nsis.sourceforge.net/UAC_plug-in)。

启动安装程序后，您可以升级为管理员。这会生成完成所有工作的安装程序的第二个实例。但是您可以以启动安装程序的用户身份调用将在原始进程中运行的代码段。

所以你可以有一个像这样的安装程序部分：

```
Section "Install My Program" SecMain
    ...    
    # Install files to common folders
    ...
    !insertmacro UAC.CallFunctionAsUser CopyUserWordTemplate
    ...
SectionEnd

Function CopyUserWordTemplate
    SetOutPath $LOCALAPPDATA
    File "MyWordTemplate.dot"
FunctionEnd 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T22:33:45.500

如果另一个用户尝试运行该应用程序怎么办？然后文件将不可用 - 这是我与数月斗争的问题......

我发现的最佳解决方案是利用一个鲜为人知（且完全未记录）的 Windows 功能，称为**Active Setup**。请参阅[http://www.etlengineering.com/installer/activesetup.txt](http://www.etlengineering.com/installer/activesetup.txt)以了解其工作原理。

这是 IE 用来安装每个用户设置的相同功能，总结上面的链接，基本上你创建一个注册表项，Windows 每次用户登录时都会检查它。如果 HKCU 键中的值小于找到的值在 HKLM 中，它运行您定义的脚本/程序/任何东西。您将每个用户的文件安装到程序文件文件夹中，然后在下次登录时使用 Active Setup 功能将它们复制到用户配置文件中。如果您需要确保它们在安装完成时在那里，请在安装完成时安排重新启动。

*PS。如果使用 MSI 而不是 NSIS，那么您在启动安装程序时不必提升，Vista 应该在执行序列开始时触发提升（如果安装程序设计正确 - 很少） - 但是当您使用 NSIS那么我猜你需要在安装程序运行时触发提升。*

**编辑：**哈哈，我的确切问题也与 MS Word 模板有关！我为 Word 模板找到的解决方案是从该注册表项中包含的路径下的文件夹中读取安装目录`HKLM\SOFTWARE\Microsft\Windows\CurrentVersion\App Paths\Winword.exe`并安装到该文件夹​​中。`STARTUP`系统将提示用户在第一次运行时允许执行宏，即使它已经过数字签名，但它可供所有用户使用。确保也将模板设置为只读，以避免以后出现任何权限错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T21:11:06.197

查看[Windows 7 徽标计划](http://msdn.microsoft.com/en-us/windows/dd203105.aspx)文档。它指出：

> 请注意，在每台机器安装中，用户数据必须在首次运行时写入，而不是在安装期间写入，因为在安装时没有正确的用户位置来存储日期。

如果您的应用程序仅适用于一位用户。然后你应该安装到本地设置文件夹（我认为 vista 和 windows 7 上的名称略有不同）。

# java - 需要在 Java 中将 EPS 文件转换为 jpg/png

> ID：439934
> 
> 赞同：3
> 
> 时间：2009-01-13T17:31:05.253
> 
> 标签：java, eps

我们有一个网络应用程序，人们可以在其中上传各种图像文件类型，并在后端将它们转换为标准类型（通常是 png 或 jpeg）。现在我们正在使用 ImageIO 来执行此操作。然而，新的要求是能够支持 eps 文件。我还没有找到任何在 ImageIO 中支持 EPS 的库，或者在 Java 中支持读取 eps 文件的方式。

阅读 eps 文件并转换它们有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T17:54:11.370

[Freehep](http://java.freehep.org/freehep1.x/)有一个[Java PostScript Viewer](http://java.freehep.org/freehep1.x/psviewer/)，您可以将它改造成 PS 转换器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T22:19:33.173

我很确定 ImageMagick（一个 C 库）可以做到这一点（尽管我相信它需要 GhostScript），并且有一个名为[JMagick](http://www.jmagick.org/index.html)的 ImageMagick 的 JNI 包装器，它允许从 Java 访问 ImageMagick。如果你可以处理 JNI，JMagick 可能会成功。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-10T17:28:46.330

几周前，我开发了一个您可能感兴趣的 EPS ImageIO 插件：

[http://www.spectotechnologies.com/en/open-projects/imageio-eps-plugin](http://www.spectotechnologies.com/en/open-projects/imageio-eps-plugin)

希望这会有所帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T17:53:59.840

EPS 是带有预览的 PostScript 文件，IIRC。所以基本上你需要一个 Java 的 PostScript 解释器。我怀疑你会发现很多...

也许更好的方法是从 Java 调用 GhostScript。它可能是最好的免费/开源 PostScript 解释器/渲染器，很难击败它。

# visual-studio-2008 - 使用 TFS 在 Visual Studio 2008 中移动/重命名项目

> ID：439941
> 
> 赞同：4
> 
> 时间：2009-01-13T17:31:58.713
> 
> 标签：visual-studio-2008

我们的团队正在旧产品的基础上开发新产品，我收到了将旧项目重命名为新名称的光荣任务。例如：

*   项目 OldProductLib.vcproj 必须成为 NewProductLib.vcproj
*   \main\OldLib 必须变为 \main\NewLib

……等等。

有没有人有方法和/或工具可以帮助我做到这一点？我正在寻找的是一个可以重命名目录、更新解决方案、*正确*更新 TFS 的工具。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T15:18:09.513

您可以在 Visual Studio 中重命名项目，它会为您解决很多问题。但是，它不会修复文件夹名称。这是我在重命名项目时所做的。

1）从解决方案中删除项目。2）重命名项目所在的文件夹。 3）将项目重新添加到解决方案中。4) 在 Visual Studio 中重命名项目。

这将留下一些项目，例如 bin 文件夹中具有旧名称的 dll。

现在，对于 TFS 问题。我认为当您将项目添加回解决方案时，他们会希望在 TFS 中创建新条目。这可能不是你想要的。我现在没有可用的 TFS 来测试它，所以我可能有这部分错误，但我认为如果您要在步骤 2 和 3 之间更新项目的“工作文件夹”，它可能会挂钩它正确备份。在处理任何非常重要的事情之前，先用一个小样本解决方案试试这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T17:44:04.663

我知道这是可能的，但这是一次痛苦的经历。一个更简单的选择是创建一个新项目并将所有内容分支到其中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-13T12:55:45.817

您必须使用 TFS“源代码管理资源管理器”视图进行重命名。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-14T07:31:18.210

这在**Visual Studio 2012**和**Team Foundation Server 2012**中是可能的。查看[我对相关问题的回答](https://stackoverflow.com/a/17090927/280392)，了解如何重命名项目文件夹并为文件和项目保留 TFS 源代码控制历史记录的分步指南。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T17:33:40.990

您是否尝试过在视觉工作室中这样做...

它可以重命名您的项目，我认为会为您创建文件夹等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T18:40:13.037

[在此处讨论了](https://stackoverflow.com/questions/211241/how-do-i-rename-a-project-folder-from-within-visual-studio "测试")在 Visual Studio 2008 中重命名项目文件夹，接受的解决方案对我非常有用。

不幸的是，我无法为 TFS 提供帮助，但是如果您使用 Visual Studio 更改项目的路径，也许它会优雅地处理这种情况（人们会期望它会这样）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-17T01:31:11.477

对于 TFS 部分，我认为您可以在文件->源代码管理中使用“更改源代码管理”命令在移动后重新绑定项目。

# java - Java 中性能最高的数据库

> ID：439958
> 
> 赞同：16
> 
> 时间：2009-01-13T17:34:46.743
> 
> 标签：java, database, performance, embedded-database

我需要一些想法来用 Java 实现（真正的）高性能内存数据库/存储机制。在存储 20,000 多个 java 对象的范围内，每 5 秒左右更新一次。
我愿意接受的一些选择：

纯JDBC/数据库组合

JDO

JPA/ORM/数据库组合

对象数据库

其他存储机制

我最好的选择是什么？你有什么经验？

编辑：我还需要能够查询这些对象

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T17:47:47.137

您可以尝试像[Prevayler 之](http://prevayler.org/old_wiki/Welcome.html)类的东西（基本上是一个内存缓存，可以为您处理序列化和备份，以便数据持久存在并且在事务上是安全的）。还有其他类似的项目。我已经将它用于一个大型项目，它安全且速度极快。

如果它是同一组 20,000 个对象，或者至少不是每 5 秒有 20,000 个新对象但有很多更改，那么最好缓存更改并定期以批处理模式写入更改（jdbc 批量更新比单个行快得多更新）。取决于您是否需要对每个写入进行事务性包装，以及您是否需要更改日志的记录或只是汇总更改。

**编辑**：正如其他帖子提到的 Prevayler 我想我会留下一个关于它的作用的注释：基本上你创建一个可搜索/可序列化的对象（通常是某种 Map ），它被包装在一个 Prevayler 实例中，该实例被序列化到磁盘. 您可以通过向 Prevayler 实例发送您的更改的可序列化记录（只是一个包含更改指令的对象）来进行更改，而不是直接对您的地图进行更改。Prevayler 的事务版本是将您的序列化更改写入磁盘，以便在发生故障时它可以加载最后一个完整备份，然后针对该备份重放更改。它是安全的，尽管您必须有足够的内存来加载所有数据，而且它是一个相当古老的 API，因此遗憾的是没有通用接口。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-13T17:16:05.000

我强烈推荐**[H2](http://www.h2database.com/html/main.html)**。这是由原作者之一完成的一种“第二代”HSQLDB 版本。 **H2**允许我们在不需要实际的 PostgreSQL 数据库的情况下对 DAO 层进行单元测试，这**很棒**。

有一个活跃的网络组和邮件列表，作者 Thomas Mueller 对查询非常敏感（哈哈，那里有点双关语。）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-13T17:47:28.310

我不知道它是否是最快的选择，但无论何时使用它，我都对[H2非常满意。](http://www.h2database.com/html/main.html)它是由最初编写 Hypersonic（后来成为 HSQLDB）的同一个人编写的。

据称速度非常快的另一个选择是[Prevayler](http://www.prevayler.org/)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-06-17T00:28:24.917

这是一个老问题，但现在有很多数据库的性能水平为 20,000/s。选择哪个数据库取决于您想要进行的查询的数据结构和类型。它还取决于总体积。

我们在处理大量时间序列数据时遇到了类似的问题，大约 300,000 条记录/秒，我们最终编写了一个新数据库，它具有足够简单的 API 和良好的性能。它可以每秒执行大约 2,000,000 次对象写入，而我们在没有 ORM 的情况下就取消了。

它后来演变成[QuestDB](https://questdb.io/)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-13T17:42:52.313

试试下面的，它在 Hibernate 和其他 ORM 框架中表现得非常好

[http://hsqldb.org/](http://hsqldb.org/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-07-08T11:45:13.823

[Chronicle Map](https://github.com/OpenHFT/Chronicle-Map)是一个可嵌入的纯 Java 持久化数据库，提供了一个简单的`java.util.Map`接口。它可以承受*来自单线程的*每秒大约*100 万*次查询/更新，一致的读/写性能，并且几乎可以线性地扩展到机器中的内核数量。

 *以下是一些最近有实际数字的性能研究：

*   [Jetbrains Xodus、Oracle Berkeley DB JE BTree、MapDB TreeMap、Chronicle Map和H2 MVStore Map的比较](http://jetbrains.github.io/xodus/#benchmarks)
*   [LmdbJava 基准测试](https://github.com/lmdbjava/benchmarks)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-03-07T16:26:00.533

我会尝试[OrientDB](http://www.orientechnologies.com/)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-13T17:10:25.653

兵马俑也可能是您的答案。它允许多个虚拟机共享对象，以便您可以分配负载等......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-07T07:14:03.810

您还可以查看[db4o](http://www.db4o.com/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-13T17:47:03.207

如果您想将所有数据存储在内存中，您可能需要查看[Prevayler](http://www.prevayler.org/wiki/)。

我自己从未使用过它，但对于所有数据都可以存储在内存中的情况，它似乎是比使用关系数据库更好的解决方案。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-13T18:48:41.820

hsqldb 相当快，但它不是 ACID 事务安全的。我知道的最快的 java 数据库是 db4o: [benchmarks](http://www.db4o.com/about/productinformation/benchmarks/)。

*编辑*：请注意 Prevayler 不是数据库，请参阅[http://www.prevayler.org/wiki.jsp?topic=PrevaylerIsNotADatabase](http://www.prevayler.org/wiki.jsp?topic=PrevaylerIsNotADatabase)。如果你的 RAM 用完了，那你就不走运了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-13T18:56:54.113

[Berkeley DB for Java](http://www.oracle.com/technology/products/berkeley-db/index.html)是一个快速的内存数据库，对于简单的对象图非常有用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-04-21T13:55:43.440

H2 确实很棒，确实，在内存、普通服务器和事务方面，你拥有一切。但是它的性能无法与对象数据库进行比较，我看到提到了 Db4o，实际上我使用 Neodatis 的性能要好得多，并且一切都在 Maven 存储库中设置得很好。虽然不是很健壮，像法拉利，快但不像甲骨文的卡车。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-07T06:57:18.467

你可以试试[CSQL](http://www.csqldb.com)（开源和企业版）它提供了 30 倍的基于磁盘的数据库系统的性能提升，并提供了 JDBC 接口。它可以配置为独立的主内存数据库或作为 MySQL、Postgres、Oracle 数据库的透明缓存。

# version-control - ClearCase：如何查找没有特定标签的元素

> ID：439959
> 
> 赞同：4
> 
> 时间：2009-01-13T17:34:53.530
> 
> 标签：version-control, command-line, clearcase

我正在寻找一个 ClearCase 命令，它将列出我当前视图中可见的所有元素，但**没有**应用特定标签。

例如，在我的视图中可见的大多数元素都应用了*LABEL_X*。我想要一个没有*LABEL_X*的元素的列表。

我显然需要使用`cleartool find`，但是在如何构造这样的查询方面，用法和 ClearCase 手册页让我感到困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T06:45:38.270

这应该有效：

```
ct find -all -ele '! lbtype_sub(LABEL_X)' -print
ct find -ele '! lbtype_sub(LABEL_X)' -print 
```

笔记：

*   ct 代表 cleartool
*   这里的 Unix 语法（对于 windows，用双引号替换单引号）
*   注意和之间的空间`!`（`lbtype_sub`在windows中你不需要空间）
*   **`-ele`**仅获得给定文件的一次出现非常重要（而不是匹配条件的文件的所有不同版本）

`-ele`将搜索限制为元素，而不是版本（这会触发*更多*涉及版本的结果......）

`-all`列出所有包含“已删除”（即“未引用”）的元素。
第二行仅列出*可见*元素（在当前视图中）

您应该在给定 ClearCase（快照或动态视图）内选择的子目录上执行第二个命令行：将列出该子目录（和子子目录...）中与 cirteria 匹配的所有文件。

警告：

*   列出文件*和目录。*如果您只想要文件，请添加`-type f`到查询中：

    ct find -type f -ele '!lbtype_sub(LABEL_X)' -print

*   显示的是元素的扩展路径，即文件名后跟`@@`.

要仅列出不带 的名称`@@`，请使用 ' `-nxn`'（无扩展路径名选项）

```
ct find -nxn -ele '!lbtype_sub(LABEL_X)' -print 
```

另一种更复杂但也更完整的仅列出名称而不列出名称的方法`@@`是使用`descr -fmt`. 例如：

```
ct find . -ele "!lbtype_sub(LABEL_X)" -exec "cleartool descr -fmt \"%En %d\n\" \"%CLEARCASE_PN%\""

ct find . -ele '! lbtype_sub(LABEL_X)' -exec 'cleartool descr -fmt "%En %d\n" "$CLEARCASE_PN"' 
```

会给你（在 windows 或 unix 语法中）未标记为 LABEL_X 的文件和目录的日期和名称。

使用该“ `descr -fmt`”显示，您可以组合任何类型的信息和您想要的结果的演示文稿。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T19:50:10.100

以上工作，但请记住指定 -cview 以获取当前视图，否则您也会从所有其他视图中获取文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-28T08:00:23.557

我需要在我的 Linux clearcase 安装上使用以下内容：

```
cleartool find -cview -all -version '\!lbtype(LABEL_X)' -print 
```

VonC 帖子中的语法不能与“！”一起正常工作。没有被逃脱。

# ruby-on-rails - 正确的模型数据结构？（我的第一个 Rails 应用程序）

> ID：439966
> 
> 赞同：1
> 
> 时间：2009-01-13T17:36:30.937
> 
> 标签：ruby-on-rails, orm, data-structures, models

我即将构建我的第一个 Ruby on Rails 应用程序（首先是 xhtml 和 css 之外的任何东西），我正在寻找一些关于我的模型结构的有用反馈。

**[我已经包含了一个模型来帮助可视化应用程序。](http://img523.imageshack.us/img523/523/demoox9.jpg)**

到目前为止，我确定我需要的唯一模型是：
1.**电影**模型*（作为主要模型，命名为电影，因此 URL 看起来像“sitename.com/movies/1-Willy-Wonka”）*和
2 . 一个**用户**模型

除了这些，我不知道其他的要做什么；像“拍摄地点”、“演员”，最重要的是，像“威利旺卡”和“约翰尼德普”这样的属性。

我应该制作所有这些模型，甚至是属性吗？如果是这样，是否有可能并推荐让人们创建模型作为属性？

我尝试将应用程序视为由表单创建并存储在数据库中的数据，并且使用该 pov 我无法决定如何将属性（角色 <=> 演员）连接到内部的部分（演员、拍摄地点、艺术品等）电影清单；同时允许属性本身成为相关属性/电影/甚至部分的超链接：单击“史蒂文·斯皮尔伯格”将带您进入一个页面，其中包含他演过的电影、他导演、制作、编写的电影等。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T17:44:56.207

我建议先弄清楚你的数据模型。然后，您可以从每个数据库表的一个 rails 模型开始。情况并非总是如此，但这是一个合理的起点。

让我们专注于电影和演员：

一些假设：

*   电影可以与其他实体有多对多的关系
*   您想将角色信息存储为演员和电影之间关系的一部分

然后，您可以像这样对您的关系建模：

```
# movies.rb
class Movie < ActiveRecord::Base
  has_many :roles
  has_many :actors, :through => :roles
end

# actor.rb
class Actor < ActiveRecord::Base
  has_many :roles
  has_many :movies, :through => :roles
end 
```

通常，您可以依靠 Rails 的魔法来处理连接模型，而无需自己创建一个。在这种情况下，我们希望将字符信息存储为连接模型的属性，因此我们显式地创建它。

```
# role.rb
class Role < ActiveRecord::Base
  belongs_to :movie
  belongs_to :actor
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T17:55:00.820

从模型 Movie、Actor、FilmLocation 和 Character 开始。电影和演员是多对多的关系（一部电影有很多演员，一个演员演过很多电影）。FileLocation 和 Movie 也是多对多的。角色（威利旺卡）和演员也是多对多的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T17:55:47.667

如果这是您第一次进行 Web 开发，那么我建议您从编写一个简单的 Web 应用程序开始，该应用程序仅列出电影并允许您添加、编辑和删除它们。只需存储电影海报/DVD 封面的标题、概要和可能的 URL。然后添加 Actor 并将它们与电影相关联。

创建一个“类似 IMDB”的网站不是一个简单的项目。除了将演员与电影联系起来之外，您还会有很多复杂的关系。演员在电影中扮演角色。你可能想要比这更抽象，说一个人在电影中有工作，这将允许你跟踪诸如导演、制片人、关键点、选角导演之类的事情。

您不仅应该处理您的数据模型，还应该制定有关您希望站点包含什么以及应该按照什么顺序（根据需要）创建这些功能的计划，并采取一些小步骤来实现最终目标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T18:42:44.890

进一步阐述。上面列出的模型的迁移可能如下所示：

```
class CreateMovies < ActiveRecord::Migration
  def self.up
    create_table 'movies' do |t|
      t.string  'title', :null => false
      t.timestamps
    end
  end

  def self.down
    drop_table 'movies' 
  end
end

class CreateActors < ActiveRecord::Migration
  def self.up
    create_table 'actors' do |t|
      t.string  'first_name', 'last_name', :null => false
      t.timestamps
    end
  end

  def self.down
    drop_table 'actors' 
  end
end 
```

下面的`movie_id`和`actor_id`字段对应于`belongs_to`上面 Role 模型中的关联，是允许角色表连接演员和电影的外键。正如我提出的建模它，`character_name`是这种关系的一个属性，因此是角色的一个属性。是否允许在 character_name 中使用 NULL 由您决定。我对 NULL 持怀疑态度，但在这种情况下，我允许它，因为人们可能会提出这样的论点：在实践中，您经常希望存储演员在给定电影中但不知道或不关心角色的事实姓名。

```
class CreateRoles < ActiveRecord::Migration
  def self.up
    create_table 'roles' do |t|
      t.integer 'movie_id', 'actor_id', :null => false
      t.string 'character_name'
      t.timestamps
    end
  end

  def self.down
    drop_table 'roles' 
  end
end 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-14T00:32:29.193

阅读数据库规范化可能是值得的：[http ://en.wikipedia.org/wiki/Database_normalization](http://en.wikipedia.org/wiki/Database_normalization)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T18:05:36.260

一般来说，是的。我喜欢我的模型尽可能细化。对于不熟悉应用程序的人来说，这让事情变得更加清晰，并且更容易重用代码。

在编写复杂的应用程序之前牢牢掌握[ActiveRecord 关联是很有帮助的。](http://guides.rubyonrails.org/association_basics.html)确保您牢记所有关联以及它们在 SQL 表中实际生成的内容。有时它看起来像魔术，而魔术不一定是好事。如果你知道它背后是什么，事情就顺理成章了。

此外，不要害怕放弃所有东西并在试验时重新开始。它是 Ruby，所以很快就可以回到原来的位置。

# c - 使 C 预处理器忽略某些 #include 指令

> ID：439970
> 
> 赞同：0
> 
> 时间：2009-01-13T17:37:34.413
> 
> 标签：c, gcc, include, build-process, c-preprocessor

我在这里使用了一个解析器生成器，不幸的是它坚持要放置一个

```
#include <some/file.h> 
```

在每个生成的源文件的顶部。标题早已被重命名。虽然强制编译器（gcc）使用新的头文件没有问题`-include new/header.h`，但从每个生成的文件中删除上述指令会使构建过程复杂化。

有没有办法告诉 gcc 简单地忽略`some/file.h`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T17:41:08.087

替换`some/file.h`为空文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T17:42:41.250

不，您可以对生成的文件进行后处理 - 我说：不！

或者您可以添加“。” 到您的系统包含目录（或任何您的本地包含路径 - 确保它也是 <> 系统包含路径）。

然后创建一个'some'目录并将你自己的永久'file.h'粘贴在其中有1行用于#include并摆脱你的-include。

我猜有一些原因可能不起作用 - 因为在使用 -include 之前，这似乎是更直接和更容易理解的事情。特别是因为您可以评论传递文件以解释发生了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:45:58.207

为什么不创建从 some/file.h 到 new/header.h 的符号链接，并删除 -include 指令？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:50:01.490

```
#include <some/file.h> 
```

可能开始像

```
#ifndef _FILE_H_
#define _FILE_H_ 
```

如果是这样，只需在命令`#define _FILE_H_`之前添加`#include`，它应该忽略它。不过，我不确定这是否是最好的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T19:04:16.360

尝试使用[预处理器](http://en.wikipedia.org/wiki/C_preprocessor)指令，如 #if 和 #ifdef 以及 gcc **-DSYMBOL=value**命令行标志。

例如，如果您使用*gcc -DREQUIRE_STDC=1 -o myfile.o myfile.c*进行编译，并且您的 .c 文件包含：

```
 #if defined(REQUIRE_STDC) && defined(__STDC__)
#include "some/file.h"
#else
#include "another/file.h"
#endif /* defined(REQUIRE_STDC) && defined(__STDC__) */ 
```

**如果定义了STDC**和 REQUIRE_STDC 符号，它将使用“some/file.h”进行编译。此外，您的标头可能包含正确的指令，以避免多次包含同一文件：

```
 #ifndef MY_HEADER_FILE
#define MY_HEADER_FILE 1

/* your C declarations here */

#endif /* MY_HEADER_FILE */ 
```

此外，您还可以[阅读 gcc 预处理器](http://gcc.gnu.org/onlinedocs/cpp/)手册。

# c# - 如何在 C# 中关闭 MessageBox 后强制按钮、文本框在表单上重新绘制

> ID：439974
> 
> 赞同：5
> 
> 时间：2009-01-13T17:38:54.723
> 
> 标签：c#, winforms

我有一个带有按钮、文本框和用户控件的表单。单击按钮时，它会调用另一个类中的方法。在此类中，会打开一个消息框。当用户单击 OK 时，messageBox 关闭，类方法在结束前持续 10 秒左右。在这 10 秒内，消息框结束的任何文本框或按钮仍然显示消息框（它们没有被重新绘制）。

问题是我怎样才能强制所有东西在表单上重新绘制。问题是具有 messageBox 的类不知道调用它的表单

坦率

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T17:42:52.920

你可以试试

```
Application.DoEvents() 
```

消息框关闭后。但是 - 除非您在后台线程中执行您在该其他类中调用的方法 - 您的 UI 将在 10 秒内没有响应。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T17:42:29.100

那 10 秒是完全在 UI 中完成的吗？如果没有，它真的应该在一个单独的线程上完成。即使您刷新表单本身，您仍然会有 10 秒的无响应 UI，这并不理想。

有关在不同线程中执行代码并回调 UI 线程的示例，请参阅[我的线程教程。](http://pobox.com/~skeet/csharp/threads/winforms.shtml)请注意，这是做事的“旧”方式 - [BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)使事情变得更简单。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T17:43:36.787

这里的问题是您在 UI 线程上进行了处理并阻止了绘制消息。调用 Refresh 或 Invalidate 并不能解决此问题，因为您仍在阻塞将执行这些操作的线程。

相反，您应该进行该处理并将其移至另一个线程，然后在后台线程上执行工作时更新您的 UI 线程（适当地，通过 Invoke 方法，很有可能）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T17:41:00.223

要强制重新绘制所有内容，您可以在主窗体上调用 Invalidate()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T17:43:07.273

你的问题是你在 UI 线程上做你的工作。在您的方法返回之前不会重新绘制 UI，这将允许 Windows 消息循环继续。

解决方案是在不同的线程上运行您的工作方法。也许 BackgroundWorker 类会很好地解决您的问题。

编辑：请参阅这篇文章以获得深入的解释：
[http ://www.yoda.arachsys.com/csharp/threads/winforms.shtml](http://www.yoda.arachsys.com/csharp/threads/winforms.shtml)

# java - 编写 CANopen 测试实用程序

> ID：439976
> 
> 赞同：0
> 
> 时间：2009-01-13T17:39:37.217
> 
> 标签：java, can-bus, canopen

我如何在没有商业 CANopen 堆栈的情况下侦听（最好使用 Java）一小组定义明确的[CANopen消息？](http://en.wikipedia.org/wiki/CANopen)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T23:49:15.160

CANopen 在这方面确实没有什么特别之处。如果您能够从 CAN 总线读取 CAN 数据，则应该没问题。消息的 CAN ID 将识别它们，数据的解释将在数据发送设备的文档中给出。

很难就如何读取数据给出一个通用的答案，因为一切都取决于您的硬件情况。但是，在收听任何 CAN 消息之前，您的计算机需要一个 CAN 接口。CAN 接口的文档可能会告诉您如何使用它。

# networking - 如何使用“拥有”昵称实现 IRC 服务器？

> ID：439987
> 
> 赞同：3
> 
> 时间：2009-01-13T17:41:27.463
> 
> 标签：networking, distributed, protocols, irc

最近，我一直在阅读 IRC 协议（RFC 1459、2810-2813），并且正在考虑实现自己的服务器。

我不一定要认真地遵守 IRC 协议（毕竟我这样做是为了好玩），但我喜欢它的一件事是网络可以透明地由多个服务器组成。

关于协议或 IRC 规范，我有很多不喜欢的地方。首先是昵称没有所有权。虽然存在像 NickServ 这样的服务，但它们不是官方协议的一部分。另一方面，*适当地**实施*像 NickServ这样的东西会破坏分发的目的（即会有一个地方运行 NickServ，并为它存储一个数据）。

 *我希望有一种方法可以在每个服务器的基础上管理昵称。这样做的问题是，如果您有两个具有一些注册昵称的服务器，然后它们链接起来，您可能会发生冲突。

有没有办法在不使用一个中央数据存储的情况下避免这种情况？也就是说：是否可以保持服务器松散连接（这样它们每个都作为一个独立的实体存在，但也可以相互连接）并保持昵称之间的唯一性？

我意识到这个问题很模糊，但我想不出更好的措辞方式。我正在寻找更多的建议而不是实际的是/否答案。因此，如果有人对如何在保持服务器独立性的同时在网络中实现昵称唯一性有任何想法，我很想听听。请注意，完全没有必要严格遵守 IRC 协议。我可以根据自己的目的进行更改。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T17:47:41.710

*如果*您不关心*严格*实现 IRC 服务器，而是实现*类似于*IRC 但不*完全是*IRC 的分布式消息系统，那么有一个简单的解决方案。

简单的解决方案是使用“nick@host”形式的昵称，就像电子邮件一样。因此，我的昵称不仅仅是“mipadi”，还可以是“mipadi@free-memorys-server.net”。所以我只在你的服务器上注册，但是当你的服务器与其他服务器连接起来形成另一个大型聊天网络时，你可以轻松地将所有用户名合并在一起。otherserver.net 上可能有一个“mipadi”，但后来我们的昵称变成了“mipadi@free-memorys-server.net”和“mipadi@otherserver.net”，一切都很酷。

当然，这与 IRC 有很大的不同。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T17:47:05.737

他们必须互相了解。如果没有，您将无法阻止共享昵称。如果是，您只需要在后端传输更新。为了防止同时注册，您需要一个交易系统来阻止、请求所有其他服务器的许可并做出响应。

为了防止在中断期间同时注册，您别无选择，只能为注册添加时间戳，并删除除最后一个（或真正同时的随机）注册的昵称副本之外的所有副本。

考虑到这些服务器最初没有合并，这不是很漂亮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T17:51:21.123

*如果*您的服务器实例相互信任，您仍然可以在没有中央实例的情况下实现昵称所有权。

*   当用户注册一个昵称时，它会在他连接的当前服务器上注册
*   当服务器接收到它不知道的注册信息时，它将该信息转发给所有其他还不知道的服务器（可能需要一个智能算法来避免向网络发送垃圾邮件）
*   当服务器重新连接到另一台服务器时，它会尝试同步已注册昵称的列表以及哪个服务器处理哪个昵称
*   如果在同步期间发生冲突，则使用较旧的注册，并将较新的注册标记为无效

如果您不能信任您的服务器，那么它会变得更加困难，因为服务器可以轻松地声明每个用户名，甚至声明每个用户名的最旧注册。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T17:51:47.817

由于您正在尝试提出新的想法，因此想到的想法只是在与服务器外部通信时将服务器的独特之处作为昵称的一部分。因此，如果您想向其他服务器上的用户发送消息，您可能会有类似 user@server 的信息

如果您不需要它们完全分开，您可能需要考虑创建某种多主复制帐户数据库。每台服务器都存储帐户数据库的完整副本，并且每台服务器都可以创建新帐户，这些帐户将尽可能复制到其他服务器。不过，您有时可能仍需要处理碰撞。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T18:00:43.103

> 虽然存在像 NickServ 这样的服务，但它们不是官方协议的一部分。

服务不是官方协议的一部分，因为它们与协议无关。他们是具有权限的机器人。没有理由不能在每台服务器上运行一个，但这确实使它们更难维护。

如果你要走这条路，我可能会建议常用的“多主”数据库复制技术。如果收到写入（在您的情况下，创建或更新新用户等），它将数据发送到所有其他节点。不过，您必须小心。如果一个节点在其他节点获得更新时处于脱机状态，则它需要知道在重新连接时重新同步。

另一种技术与上述相同，但相反。数据仅在需要时在节点之间交换。例如，如果用户尝试在没有数据的节点上登录，它将查询其他节点并发出移动命令以将所有数据获取到该节点。这可能没有复制版本那么痛苦，但是如果有人在与包断开连接的节点上注册一个重复的昵称，则 netsplits 可能会出现严重问题。

消除 netsplits 问题的一种技术是让聊天节点及其机器人知道 netsplits。当它们被拆分时，它们可能不应该允许任何写入操作......但是如果您拆分很多，这可能会影响您的网络。

您还必须询问这可能或可能不安全。IRC 网络节点是为性能而分布的，但它们并不“安全”。因此，服务机器人通常集中运行以保持对其运行的最终控制。如果您分发了机器人并且远程节点被黑客入侵，他们可能会访问整个用户数据库（取决于模型）。*******************