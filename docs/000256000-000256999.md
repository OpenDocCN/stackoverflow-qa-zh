# StackOverflow 问答 000256000-000256999

# arrays - 使用文件系统来扩充内存

> ID：256009
> 
> 赞同：1
> 
> 时间：2008-11-01T19:42:34.567
> 
> 标签：arrays, filesystems, ram

我应该先说我正在开发一款袖珍 PC 应用程序，并且数据文件保存在 sd 卡上。

我有一个应用程序必须创建一个大小为 x 的数组。malloc 每次都失败。

我在 4 gig 卡上有一个 1 gig 文件。
我有 64 兆的板载内存 (ram/data/application/os)
我无法处理数据，因为我需要的数组太大了。
访问 sd 卡几乎和 ram 一样快。
我正在使用 C++ (mfc)

访问我将用作数组的文件的最佳方法是什么？
或者会有不同的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-01T19:51:16.980

您应该为数组创建一个足够大的文件，适当地填充（根据 GetSystemInfo），并使用 CreateFileMapping/MapViewOfFile 映射文件。

至少，这将是我的第一次尝试——CE 上映射文件的大小可能会受到限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T19:51:48.260

您需要创建一个包含 n 条记录的窗口（适合内存）并移动该窗口，以便将您正在处理的记录保留在其中。我在 mfc 中不够流利，无法为您提供代码示例，但这并不难。

在 c# 中，我会编写一个自定义 IEnumerable<T>

# python - 我可以使用 Python 在“网页”中创建删除按钮吗

> ID：256021
> 
> 赞同：2
> 
> 时间：2008-11-01T19:52:08.540
> 
> 标签：python, web-applications, browser

我编写了一个脚本，它遍历一堆文件并剪掉一部分文件以进行进一步处理。该脚本创建一个新目录并为取出的每个片段创建新文件。我现在必须评估创建的每个文件，看看它是否是我需要的。该脚本还创建一个 html 索引文件，其中包含指向每个片段的链接。因此，我可以单击超链接查看文件，在电子表格中记下文件是否正确，然后使用浏览器中的后退按钮将我带回索引列表。

我坐在这里想知道是否可以在超链接旁边的浏览器中以某种方式创建一个删除按钮。我的想法是我会单击超链接，对文件进行判断，如果它不是我想要保留的文件，那么当我回到主页时，我只需按下删除按钮，它就会从目录中消失。

有谁知道这是否可能。我正在用 python 编写这个，但显然问题是有没有办法用删除按钮创建一个 htm 文件——我只会使用 Python 来编写删除按钮的命令。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T20:07:07.293

您可以通过将这一切都发生在一个主页中来使这一切变得更简单。与其拥有超链接列表，不如让主页有一个框架来加载其中一个自动创建的页面。在底部放置几个按钮 - “保留此页面”和“删除此页面”。当您单击任一按钮时，主页面会刷新，这次是框架中的下一个自动创建的页面。

你可以用你最喜欢的脚本语言把它做成一个 cgi 脚本。您不能只在 html 中执行此操作，因为 html 页面仅在客户端处理内容，而您只能在服务器端删除文件。您可能需要将页面作为 cgi args 显示在框架中，如果按钮单击是“删除”，则您查看的最后一页。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T19:59:48.383

您必须用 Python 编写网页。有许多易于使用的 Python Web 框架（例如 Django）。您可以将整个脚本框架转换为一个 Web 应用程序，该应用程序有一个工作线程遍历 html 页面，将它们保存到特定位置，为它们编制索引以供您查看，并提供一个删除按钮，该按钮在特定位置调用系统的删除功能文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T20:00:43.280

与其让脚本输出静态 HTML 文件，不如通过一些工作，您可以在 web.py 之类的帮助下调整脚本以作为小型 Web 应用程序运行。

例如，您将启动您的脚本并将浏览器指向[http://localhost:8080](http://localhost:8080)。Web 浏览器将是您的用户界面。

要实现“删除”功能，您需要做的就是编写一些 Python，在提交表单以实际执行删除时执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-19T19:40:25.133

好吧，我终于找到了一个实现我想要的答案——我不想学习一门新语言——鉴于我的缺乏或经验，Python 已经够难了

```
def OnDelete(self, event):
    assert self.current, "invalid delete operation"
    try:
        os.remove(os.path.join(self.cwd, self.current)) 
```

# c# - 继承问题 - 从 Access 数据库文件和 SQL Express 中检索数据

> ID：256027
> 
> 赞同：1
> 
> 时间：2008-11-01T19:59:28.353
> 
> 标签：c#, database, ms-access, inheritance, sql-server-express

我正在开发一个应用程序，一开始将连接到 Access 数据库，并计划在不久的将来切换到 MS SQL 或 SQL Express。两种类型的数据库的数据表结构相同，我试图避免重复代码并试图找到最小化代码的方法。

例如，我编写了以下用于从 Access 数据库中检索数据的函数：

```
public static DataTable GetActiveCalls()
    {
        string select = "SELECT call_id, call_time, msisdn, status FROM call WHERE status = 0 OR status = 1 ORDER by call_id ASC";
        OleDbCommand cmd = new OleDbCommand(select, conn);
        DataTable dt = new DataTable("Active Calls");
        OleDbDataAdapter DA = new OleDbDataAdapter(cmd);
        try
        {
            conn.Open();
            DA.Fill(dt);
        }
        catch (Exception ex)
        {
            string sDummy = ex.ToString();
        }
        finally
        {
            conn.Close();
        }
        return dt;
    } 
```

以下代码适用于 SQL Express 数据库：

```
public static DataTable GetActiveCalls()
    {
        string select = "SELECT call_id, call_time, msisdn, status FROM call WHERE status = 0 OR status = 1 ORDER by call_id ASC";
        SqlCommand cmd = new SqlCommand(select, conn);
        DataTable dt = new DataTable("Active Calls");
        SqlDataAdapter DA = new SqlDataAdapter(cmd);
        try
        {
            conn.Open();
            DA.Fill(dt);
        }
        catch (Exception ex)
        {
            string sDummy = ex.ToString();
        }
        finally
        {
            conn.Close();
        }
        return dt;
    } 
```

这两种方法几乎相同。唯一的区别是 SqlCommand/OleDbCommand 和 SqlDataAdapter/OleDbDataAdapter。还有一些方法可以接受参数，例如：

```
public static void AddMessage(string callID, string content)
    {
        string select =
            "INSERT INTO message(key, direction, content, read, write_time) VALUES (@callId, 0, @content, 0, @insertTime)";
        OleDbCommand cmd = new OleDbCommand(select, conn);
        cmd.Parameters.AddWithValue("callId", callID.ToString());
        cmd.Parameters.AddWithValue("content", content);
        cmd.Parameters.AddWithValue("insertTime", DateTime.Now.ToString());
        try
        {
            conn.Open();
            cmd.ExecuteScalar();
        }
        catch (Exception ex)
        {
            string sDummy = ex.ToString();
        }
        finally
        {
            conn.Close();
        }
    } 
```

在这种情况下，两个数据库的 SQL 查询字符串也相同，但 cmd 的类型（SqlCommand/OleDbCommand）有所不同。

如果有人能就如何避免重复代码和优化给定问题提出任何建议，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T20:21:23.677

您可以使用数据库独立接口 IDbDataAdapter 和 IDbCommand，然后使用工厂创建具体实例。[这](http://aspalliance.com/837_Implementing_a_Data_Access_Layer_in_C)是一个例子。

但是，如果您的应用程序不是很简单，我建议使用像[NHibernate](http://www.nhibernate.org/)这样的 ORM 解决方案，因为 Access 和 SQL Server 之间的 SQL 语言几乎没有差异，这会使您的数据访问代码更加复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T05:16:28.027

您应该查看[Enterprise Library](http://www.codeplex.com/entlib)数据访问位。为您抽象了底层数据库提供程序的细节。例如：

```
string sql = @"UPDATE tblContent 
                        SET Title = @Title, Content = @Content, IsPublic = @IsPublic, ItemOrder = @ItemOrder
                        WHERE ContentItemID = @ContentItemID";

Database db = DatabaseFactory.CreateDatabase();
using(DbCommand cmd = db.GetSqlStringCommand(sql))
{
    db.AddInParameter(cmd, "Title", DbType.String, title);
    db.AddInParameter(cmd, "Content", DbType.String, content);
    db.AddInParameter(cmd, "IsPublic", DbType.Boolean, isPublic);
    db.AddInParameter(cmd, "ItemOrder", DbType.Int32, itemOrder);
    db.AddInParameter(cmd, "ContentItemID", DbType.Int32 , contentItemID);

    db.ExecuteNonQuery(cmd);
} 
```

...或者...

```
string sql = "SELECT MenuText FROM tblMenuItems WHERE MenuItemID = @MenuItemID";

Database db = DatabaseFactory.CreateDatabase();
using(DbCommand cmd = db.GetSqlStringCommand(sql))
{
    db.AddInParameter(cmd, "MenuItemID", DbType.Int32, menuItemID);

    using(IDataReader dr = db.ExecuteReader(cmd))
    {
        while(dr.Read())
        {
            return dr["MenuText"].ToString();
        }
        return null;
    }
} 
```

上面的两个示例都适用于 Access 和 MS SQL，并且只要您坚持与 Jet 和 MS SQL 兼容的 SQL 语句，您应该不会有任何问题。

当您从 Access 切换到 MS SQL 时，只需更改连接字符串，例如，从：

```
<connectionStrings>
    <add 
         name="ContentManager" 
         connectionString="Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|Content.mdb;" 
         providerName="System.Data.OleDb"/>
</connectionStrings> 
```

...到...

```
<connectionStrings>
    <add
        name="ContentManager"
        connectionString="Data Source=your.sql.server;Initial Catalog=content;Persist Security Info=True;User ID=cmuser;Password=password"
        providerName="System.Data.SqlClient" />
</connectionStrings> 
```

为此，您只需在 EL 发行版中引用以下 DLL：

Microsoft.Practices.EnterpriseLibrary.Common.dll
Microsoft.Practices.EnterpriseLibrary.Data.dll

很值得一看。

干杯
凯夫

# c++ - std::string size() 是 O(1) 操作吗？

> ID：256033
> 
> 赞同：27
> 
> 时间：2008-11-01T20:03:08.953
> 
> 标签：c++, visual-c++, stl, stdstring

std::string size() 是 O(1) 操作吗？

我正在使用的 STL 的实现是 VC++ 中内置的

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-02T00:21:36.937

如果您问 MSVC 的 string::size() 实现是否具有恒定的复杂性，那么答案是肯定的。但是[Don Wakefield](https://stackoverflow.com/questions/256033/is-stdstring-size-a-o1-operation#256081)在 C++ 标准的 23.1 中提到了表 65，它说的复杂性`size()`应该遵循“注释 A”中所说的内容。注 A 说：

> 那些标记为“（注 A）”的条目应该具有恒定的复杂性。

但是，这并不意味着这些条目*将*具有恒定的复杂性。标准使用非常具体的术语，“应该”意味着它不是强制性的。

'Note A' 被添加到标准中，以安抚那些认为`size()`应该允许具有线性复杂性的人，因此在修改容器时不需要保持大小。

因此，您不能依赖于`size()`具有恒定的复杂性，但老实说，我不确定是否有任何实现没有恒定的`string::size()`.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-03T20:20:09.230

这是为 msvc++ 回答该问题的一种简单方法。

在项目中编写一些代码：

```
string happy;
happy.size(); 
```

突出显示 .size 调用，右键单击，转到定义。

在我的安装（vs2005sp1）上，这会将我发送到 xstring:1635，如下所示：

```
size_type __CLR_OR_THIS_CALL size() const
    {   // return length of sequence
    return (_Mysize);
    } 
```

所以看起来字符串有一个名为 _Mysize 的成员，它只是返回它。

换句话说，这是一个 O(1) 的实现。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-01T20:13:52.957

是的，std::string::size() 是 O(1)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-01T20:39:14.093

请参阅标准第 23.1 节中的表 65。“a.size()”被列为“（注 A）”，表示“那些条目......应该具有恒定的复杂性”。

第 21.3 节说字符串符合序列 (23.1) 的要求，事实上，size() 是常数时间。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-10-27T10:32:47.440

对于字符串，对于所有不使用*绳索*^((1))`size()`的字符串实现，操作*必须*是常量。标准中没有明确要求要求操作是，最接近的是*应该*是常数时间的通用要求，但这为任何其他复杂性度量留下了空间。*^(`O(1)``size()`)*

 **那么为什么*必须*是 O(1) 呢？

这是因为无法从字符串本身的内容计算大小。在 C 中，您使用 NUL 终止符来确定字符串的结尾，而在 C++ 中，NUL 与字符串中的任何其他字符一样有效。由于字符串的大小不能从内容^((2))中计算出来，因此必须在外部进行处理，与字符串的实际大小无关。

^((1)) C++03 标准允许实现使用*绳索*作为字符串的实现，但事实是标准库的当前实现都没有使用它们。

^((2))如果实现使用绳索，则操作可以通过构建绳索的块的数量来取决于大小，如果块通过链表或类似结构链接，或者如果它们被允许具有不同的尺寸。但是我知道的任何标准库实现中都没有使用*绳索。*

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-01T20:16:16.417

STL 保证容器的性能至少为 O(N)，但是包括 std::string 在内的许多容器可以将其实现为 O(1) 并且将。通常它要么返回一个简单的变量，要么执行 _End - _Begin 之类的操作并返回它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-12-14T17:20:03.773

的复杂性`size()` **应**遵循“注 A”。这意味着，它**应该**具有恒定的复杂性，即 O(1)。虽然，我不确定实现，但 C++ 中的迭代器确实具有指向 STL 容器的关联操作，如 begin() 和 end()。这些操作具有恒定的时间复杂度，因为它们是容器要求。这意味着它`begin() - end()`也具有恒定的复杂性。这意味着，`size()`是 O(1) 操作。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-11-01T20:12:25.893

```
size_type __CLR_OR_THIS_CALL size() const

{   // return length of sequence

    return (_Mysize);

} 
```

所以最终可能会是这样，但你永远无法确定。

# c++ - 如何使用键类型 std::string 提高地图查找的性能？

> ID：256038
> 
> 赞同：11
> 
> 时间：2008-11-01T20:06:40.913
> 
> 标签：c++, dictionary, optimization, visual-c++, stdmap

我正在使用`std::map`（VC++ 实现），通过地图的 find 方法进行查找有点慢。

密钥类型是`std::string`。

我可以`std::map`通过地图的自定义键比较覆盖来提高此查找的性能吗？例如，也许< compare在比较数据之前`std::string`没有考虑简单的比较？`string::size()`

还有其他加快比较速度的想法吗？

在我的情况下，地图将始终包含 < 15 个元素，但它正在不停地被查询并且性能至关重要。也许有一个更好的数据结构我可以使用它会更快？

更新：地图包含文件路径。

更新2：地图的元素经常变化。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-01T20:43:56.097

正如[Even](https://stackoverflow.com/questions/256038/how-can-i-increase-the-performance-in-a-map-lookup-with-key-type-stdstring#256052)所说，在 a `set`is `<`not中使用的运算符`==`。

如果您不关心字符串的顺序，`set`您可以传递`set`一个自定义比较器，该比较器的性能比常规的*less-than*更好。

例如，如果您的许多字符串具有相似的前缀（但它们的长度不同），您可以按字符串长度排序（因为`string.length`速度是恒定的）。

如果您这样做，请注意一个常见错误：

```
struct comp {
    bool operator()(const std::string& lhs, const std::string& rhs)
    {
        if (lhs.length() < rhs.length())
            return true;
        return lhs < rhs;
    }
}; 
```

该运算符不保持[严格的弱排序](http://en.wikipedia.org/wiki/Strict_weak_ordering)，因为它可以将两个字符串视为一个小于另一个。

```
string a = "z";
string b = "aa"; 
```

按照逻辑，你会看到`comp(a, b) == true`和`comp(b, a) == true`。

正确的实现是：

```
struct comp {
    bool operator()(const std::string& lhs, const std::string& rhs)
    {
        if (lhs.length() != rhs.length())
            return lhs.length() < rhs.length();
        return lhs < rhs;
    }
}; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-01T23:23:53.230

首先，关闭所有 profiling 和 DEBUG 开关。这些可以极大地减慢 STL。

如果不是这样，部分问题可能是您的字符串对于字符串的前 80-90% 是相同的。这对 map 来说当然不错，但它适用于字符串比较。如果是这种情况，您的搜索可能需要更长的时间。

例如，在这段代码中 find() 可能会导致几个字符串比较，但每次都会在比较第一个字符直到 "david" 之后返回，然后将检查前三个字符。因此，每次调用最多检查 5 个字符。

```
map<string,int> names;
names["larry"] = 1;
names["david"] = 2;
names["juanita"] = 3;

map<string,int>::iterator iter = names.find("daniel"); 
```

另一方面，在以下代码中，find() 可能会检查 135+ 个字符：

```
map<string,int> names;
names["/usr/local/lib/fancy-pants/share/etc/doc/foobar/longpath/yadda/yadda/wilma"] = 1;
names["/usr/local/lib/fancy-pants/share/etc/doc/foobar/longpath/yadda/yadda/fred"] = 2;
names["/usr/local/lib/fancy-pants/share/etc/doc/foobar/longpath/yadda/yadda/barney"] = 3;

map<string,int>::iterator iter = names.find("/usr/local/lib/fancy-pants/share/etc/doc/foobar/longpath/yadda/yadda/betty"); 
```

这是因为字符串比较必须更深入地搜索才能找到匹配项，因为每个字符串的开头都是相同的。

由于您的数据集非常小，因此在比较中使用 size() 对您没有太大帮助。std::map 保持排序，因此可以使用二进制搜索来搜索其元素。每次对 find 的调用应该导致少于 5 次字符串比较未命中，平均 2 次比较命中。但这确实取决于您的数据。如果您的大多数路径字符串的长度不同，那么像 Motti 描述的大小检查可能会有很大帮助。

考虑替代算法时要考虑的事情是您获得了多少“命中”。您的大多数 find() 调用是返回 end() 还是命中？如果您的大多数 find()s 返回 end()（未命中），那么您每次都在搜索整个地图（比较 2logn 字符串）。

Hash_map 是个好主意；它应该将您的搜索时间减少一半左右；更多的失误。

由于路径字符串的性质，可能需要自定义算法，特别是如果您的数据集具有上述代码中的共同祖先。

要考虑的另一件事是如何获取搜索字符串。如果您正在重用它们，将它们编码成更容易比较的东西可能会有所帮助。如果您使用它们一次并丢弃它们，那么这个编码步骤可能太昂贵了。

我曾经（很久以前）使用过类似 Huffman 编码树的东西来优化字符串搜索。在某些情况下，像这样的二进制字符串搜索树可能更有效，但对于像你这样的小集合来说，它相当昂贵。

最后，研究替代 std::map 实现。我听说过一些关于 VC 的 stl 代码性能的坏消息。尤其是 DEBUG 库在每次调用时检查你是不好的。 [StlPort](http://stlport.sourceforge.net/)曾经是一个不错的选择，但我已经有几年没有尝试过了。我也一直很喜欢[Boost](http://www.boost.org/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-01T20:12:19.387

如果可能的话，第一件事是尝试使用 hash_map - 你是对的，标准字符串比较不会首先检查大小（因为它是按字典顺序比较的），但是最好避免编写自己的地图代码. 从您的问题看来，您不需要遍历范围；在这种情况下， map 没有 hash_map 没有的任何东西。

它还取决于您在地图中拥有什么样的键。它们通常很长吗？还有“有点慢”是什么意思？如果您还没有对代码进行概要分析，则很可能这是另一个需要时间的部分。

更新：嗯，您程序中的瓶颈是 map::find，但该地图的元素总是少于 15 个。这让我怀疑该配置文件在某种程度上具有误导性，因为在这么小的地图上查找应该不会很慢。事实上，map::find 应该如此之快，只是分析的开销可能超过 find 调用本身。我又要问了，你确定这真的是你程序的瓶颈吗？你说字符串是路径，但你没有在这个循环中做任何类型的操作系统调用、文件系统访问、磁盘访问？其中任何一个都应该比小地图上的 map::find 慢几个数量级。实际上，任何获取字符串的方法都应该比 map::find 慢。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-01T20:52:39.667

您可以尝试使用已排序的向量（[这是一个示例](http://www.codeproject.com/KB/stl/sorted_vector.aspx)），这可能会更快（您必须[对其进行分析以确保](https://stackoverflow.com/questions/61278/quick-and-dirty-way-to-profile-your-code#61279)当然）。

认为它会更快的原因：

1.  更少的内存分配和释放（向量将扩展到使用的最大大小，然后重用释放的内存）。
2.  随机访问的二进制查找应该比树遍历更快（尤其是由于数据局部性）。

认为它会变慢的原因：

1.  删除和添加意味着在内存中移动字符串，因为`string`'s`swap`是有效的并且数据集的大小很小，这可能不是问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-01T20:18:08.003

std::map 的比较器不是 std::equal_to 它是 std::less，我不确定短路 a < compare 的最佳方法是什么，以便它比内置的更快。

如果总是有 < 15 个元素，也许您可​​以使用除 std::string 之外的密钥？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-01T20:53:23.457

Motti 有一个很好的解决方案。但是，我很确定对于您的 < 15 个元素，映射不是正确的方法，因为它的开销总是大于具有适当散列方案的简单查找表的开销。在您的情况下，仅按长度进行散列甚至可能就足够了，如果仍然会产生冲突，请对所有相同长度的条目进行线性搜索。

为了确定我是否正确，当然需要一个基准，但我很确定它的结果。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-02T00:05:21.663

您可能会考虑预先计算字符串的哈希值，并将其保存在您的地图中。这样做可以在通过 std::map 树进行搜索期间提供哈希比较而不是字符串比较的优势。

```
class HashedString
{
  unsigned m_hash;
  std::string m_string;

public:
  HashedString(const std::string& str)
    : m_hash(HashString(str))
    , m_string(str)
  {};
  // ... copy constructor and etc...

  unsigned GetHash() const {return m_hash;}
  const std::string& GetString() const {return m_string;}
}; 
```

这样做的好处是在构造时计算一次字符串的哈希。在此之后，您可以实现一个比较功能：

```
struct comp
{
  bool operator()(const HashedString& lhs, const HashedString& rhs)
  {
    if(lhs.GetHash() < rhs.GetHash()) return true;
    if(lhs.GetHash() > rhs.GetHash()) return false;
    return lhs.GetString() < rhs.GetString();
  }
}; 
```

由于哈希现在是在`HashedString`构造时计算的，因此它们以这种方式存储在 std::map 中，因此比较可以在天文数字的高百分比时间内非常快速地发生（整数比较），当哈希值相等。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-04T04:58:28.060

也许您可以在将字符串用作地图中的键之前反转字符串？如果每个字符串的前几个字母相同，这可能会有所帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-01T20:40:06.883

您可以考虑以下几点：

0）你确定这是性能瓶颈所在吗？像 Quantify、Cachegrind、gprof 或类似的结果？因为在这样的 smap 地图上查找应该相当快......

1）您可以覆盖用于比较 std::map<> 中的键的仿函数，还有第二个模板参数可以做到这一点。但是，我怀疑你能比 operator< 做得更好。

2）地图的内容变化很大吗？如果不是，并且鉴于您的地图非常小，也许使用排序向量和二进制搜索可以产生更好的结果（例如，因为您可以更好地利用内存局部性。

3) 这些元素在编译时是否已知？如果是这种情况，您可以使用完美的哈希函数来缩短查找时间。在网上搜索 gperf。

4）您是否有很多查找都找不到任何东西？如果是这样，也许与集合中的第一个和最后一个元素进行比较可能会比每次完全搜索更快地消除许多不匹配。

这些已经被建议，但更详细：

5）由于您的字符串很少，也许您可​​以使用不同的键。例如，您的钥匙是否都一样大？您可以使用包含固定长度字符数组的类吗？你能把你的字符串转换成数字或一些只有数字的数据结构吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-01T21:26:32.077

根据使用情况，您可以使用其他一些技术。例如，我们有一个应用程序需要跟上超过一百万个不同的文件路径。问题是有成千上万的对象需要保留这些文件路径的小图。

由于向数据集添加新文件路径是一种不常见的操作，因此在向系统添加路径时，会搜索主地图。如果找不到路径，则添加它并返回一个新的有序整数（从 1 开始）。如果路径已经存在，则返回先前分配的整数。然后每个对象维护的每个映射从基于字符串的映射转换为整数映射。这不仅极大地提高了性能，而且通过没有那么多重复的字符串副本减少了内存使用量。

当然，这是一个非常具体的优化。但是当谈到性能改进时，您经常会发现自己必须针对特定问题制定量身定制的解决方案。

而且我讨厌字符串 :) 比较起来不是很慢，但是它们确实可以在高性能软件上浪费您的 CPU 缓存。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-01T23:43:46.433

试试 std::tr1::unordered_map（在标题 <tr1/unordered_map> 中找到）。这是一个哈希映射，虽然它不维护元素的排序顺序，但可能会比常规映射快得多。

如果您的编译器不支持 TR1，请获取更新的版本。MSVC 和 gcc 都支持 TR1，我相信大多数其他编译器的最新版本也有支持。不幸的是，许多图书馆参考网站尚未更新，因此 TR1 仍然是一项很大程度上未知的技术。

我希望 C++0x 不一样。

编辑：请注意，tr1::unordered_map 的默认散列方法是 tr1::hash，可能需要专门用于 UDT。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-02T02:54:58.700

如果您有很长的公共子字符串，则 trie 可能是比 map 或 hash_map 更好的数据结构。不过，我说“可能”——hash_map 每次查找只遍历一次键，所以应该相当快。我不会再讨论它，因为其他人已经有了。

如果某些键比其他键更频繁地查找，您也可以考虑使用展开树，但这当然会使最坏情况的查找比平衡树更糟糕，并且查找是变异操作，如果您正在使用这可能对您很重要例如读写锁。

如果您更关心查找的性能而不是修改，那么使用 AVL 树可能会比使用红黑树做得更好，我*认为*这是 STL 实现通常用于映射的。AVL 树通常具有更好的平衡性，因此每次查找平均需要更少的比较，但差异很小。

找到您满意的这些实现可能是一个问题。在 Boost 主页上的搜索表明他们有一个 splay 和 AVL 树，但没有一个 trie。

您在评论中提到，您从来没有找不到任何东西的查找。所以理论上你可以跳过最后的比较，在 15 < 2^4 个元素的树中，它可以给你带来 20-25% 的加速，而无需做任何其他事情。事实上，可能不止于此，因为相等的字符串是最慢的比较。是否值得为这种优化编写自己的容器是另一个问题。

您也可以考虑参考的局部性——我不知道您是否可以通过从小堆中分配键和节点来避免偶尔的页面丢失。如果您一次只需要大约 15 个条目，那么假设文件名限制低于 256 个字节，您可以确保在查找期间访问的所有内容都适合单个 4k 页面（当然，除了正在查找的键）。与几个页面加载相比，比较字符串可能是微不足道的。但是，如果这是您的瓶颈，则必须进行大量查找，所以我猜一切都相当接近 CPU。值得检查，也许。

另一个想法：如果您在有很多争用的结构上使用悲观锁定（您在评论中说程序是大量多线程的），那么无论分析器告诉您什么（CPU 周期花费在什么代码中） ，通过有效地将您限制为 1 个核心，您的成本可能比您想象的要多。试试读写锁？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-01T20:53:02.100

`hash_map`不是标准的，请尝试使用`unordered_map`tr1 中的可用（如果您的工具链还没有它，则可以在 boost 中使用）。

对于少量字符串，您可能会更好地使用`vector`，因为`map`它通常实现为树。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-22T22:38:59.623

你为什么不使用哈希表呢？boost::unordered_map 可以。或者您可以推出自己的解决方案，并存储字符串的 crc 而不是字符串本身。或者更好的是，将#defines 用于字符串，并使用它们进行查找，例如，

```
#define "STRING_1" STRING_1 
```

# php - MySQL 或 PHP 中的函数

> ID：256046
> 
> 赞同：12
> 
> 时间：2008-11-01T20:12:38.810
> 
> 标签：php, mysql, performance

在网络服务器或数据库中运行功能通常更好吗？

例子：

```
INSERT INTO example (hash) VALUE (MD5('hello')) 
```

或者

```
INSERT INTO example (hash) VALUE ('5d41402abc4b2a76b9719d911017c592') 
```

好的，这是一个非常微不足道的例子，但是当一个站点扩展到多个网站或数据库服务器时，为了实现可伸缩性，最好在哪里“完成工作”？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-01T20:19:30.623

我尝试将数据库视为仅保存内容的地方，并将所有抽象代码放在其他地方。数据库表达式已经足够复杂，无需向它们添加函数。

此外，如果您最终想要执行诸如“SELECT .... WHERE MD5(xxx) = ...”之类的操作，查询优化器将跳过任何带有函数的表达式

并且数据库功能通常不是很便携。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-01T21:12:40.750

每当需要这样的计算时，我都会尝试在我的脚本语言中使用函数。出于多种原因，我将 SQL 函数的使用率降至最低。

主要原因是我的一个 SQL 数据库负责托管多个网站。如果 SQL 服务器因来自一个站点的请求而陷入困境，则会对其余站点产生不利影响。例如，如果您在共享服务器上工作，则考虑这一点更为重要，尽管在这种情况下，您几乎无法控制其他用户正在做什么。

第二个原因是我希望我的 SQL 代码尽可能地可移植。我什至不想*尝试*计算存在的不同风格的 SQL，因此我尝试将函数（尤其是非标准扩展）保留在我的 SQL 代码之外，除了 SUM 或 MIN/MAX 之类的东西。

我想我的意思是，SQL 旨在存储和检索数据，它应该保持这个目的。使用您选择的服务语言预先执行任何计算，并保持您的 SQL 代码可移植。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-01T20:25:23.760

就个人而言，我尝试通过插入、更新、删除来保持数据库的简单（最低限度），而无需在代码中使用太多功能。Stored Proc 也是一样，只包含与持久性数据非常接近的任务，与业务逻辑无关。

我会把MD5放在外面。这将让我们在数据库的存储范围之外进行这种“数据操作”。

但是，你的例子很“简单”，我认为把它放在里面并不坏......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-01T22:27:53.297

使用您的数据库作为持久化和维护数据完整性的手段。并将业务逻辑留在其中。

如果您将业务逻辑（其中任何一个）放入数据库中，您将使其在未来的管理和维护变得更加复杂。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-01T20:47:08.163

我认为大多数时候，您会希望将数据操作留给网络服务器，但是，如果您想处理有关表、关系等的数据库，那么就选择数据库。

我亲自游说我的公司将我们的 MySQL 服务器升级到 5.0，以便我可以开始利用程序（这正在杀死我们管理的几个站点）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-02T16:07:37.603

与迄今为止的其他答案一样，我更喜欢将所有业务逻辑保存在一个地方。即，我的应用程序语言。（更具体地说，在对象模型中，如果存在，但并非所有代码都是 OO 的。）

但是，如果您在 StackOverflow 中查找关于是否使用内联 SQL 或存储过程的 (my)sql-tagged 问题，您会发现大多数回答这些问题的人都强烈支持随时随地使用存储过程，即使是最琐碎的查询。您可能想查看其中一些问题，以了解支持另一种方法的一些论点。

# debugging - 调试是一种难闻的气味——如何说服他们？

> ID：256047
> 
> 赞同：16
> 
> 时间：2008-11-01T20:13:12.040
> 
> 标签：debugging, tdd

我一直在从事一个不能再被描述为“小”的项目（40 多个月），我的团队不再被定义为“小”（约 30 人）。我们一直在使用敏捷/Scrum (1) 实践，以及健康剂量的 TDD。

我不确定我是从敏捷还是 TDD 中学到的，更可能是两者的结合，但我现在显然属于将调试视为难闻的人的阵营。通过“调试”，我指的不是更抽象的概念，即找出系统可能出现的问题，而是在调试模式下运行系统的具体活动，单步执行代码以找出原本难以理解的细节。

**由于我相当确信，这个问题不是关于调试是否是一种难闻的气味。相反，我想知道如何说服我的队友。**

认为调试模式是“标准”模式的人倾向于编写只有通过调试才能理解的代码，这会导致大量时间浪费，因为每次在其他人开发的代码之上处理项目时，您首先要花大量时间调试它（而且，因为没有涉及错误......这个术语变得越来越荒谬） - 然后发生了孤岛。所以我很想说服我的一些队友，避免调试模式是一件好事（2）。然而，由于他们习惯于在调试模式下工作，他们似乎没有发现问题。对他们来说，在他们开始做任何与他们的新项目相关的事情之前花几个小时调试别人的代码是常态；他们看不出有什么问题。另外，因为他们花时间“弄清楚”

帮我想出一个让他们远离黑暗面的计划！

***提前致谢。***

(1) 也称为 SCRUM（全部大写）。撇开大小写争论不谈，我认为必须在术语后面使用星号，因为——不出所料——我们的组织“调整”了敏捷和 Scrum 流程，以适应所有相关利益相关者的感知需求。所以，老实说，根据理论，我不会假装这是 100%，但这与我的问题无关。

(2) 是的，总会有一些时候我们必须*进入*调试模式，我并不是要绝对避免它，只是.. 尽量减少我们必须深入它的次数。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-01T20:20:33.240

如果你想说服你的同事你的编程实践更好，首先要通过你的生产力证明你比他们更有效率，至少在某些任务上是这样。然后，当您解释如何完成这么多工作时，他们会相信您。

有时也更容易专注于具体的事情。您的同事甚至会谈论“代码气味”吗？也许您可以专注于诸如“当 ABC 模块发生故障时，调试它需要很长时间；使用 XYZ 技术要快得多。在这里，让我演示一下。” 然后你可以提到你的基本原则，是的，调试器是一个有用的工具，但通常还有其他更有用的工具。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-02T12:10:16.367

*这是一个交叉帖子，因为第一次围绕它更多地是对其他人对[不同问题](https://stackoverflow.com/questions/112479/are-bugs-easier-to-produce-in-one-language-than-in-another#112673)的回答。对于这个问题，这是一个直接的答案。*

> 调试会降低我们生成的代码的质量，因为它使我们能够以较低的准备水平和较少的心理纪律来逃避。我从 2000 年初的一次意外对照实验中了解到这一点，我现在将其联系起来：
> 
> 我接受了一份 Delphi 编码员的合同，分配的第一个任务是编写一个在概念上类似于报告引擎的模板引擎 - 使用我不熟悉的 Java 语言。
> 
> 奇怪的是，雇主很乐意付给我合同费，让我花几个月的时间精通一门新语言，但不会支付书籍或调试器的费用。有人告诉我下载编译器并使用在线资源学习（Java Trails 非常好）。
> 
> 艺术和科学的黄金法则是，谁拥有黄金，谁就制定规则，所以我按照指示进行。我安装了我的编辑器宏，这样我就可以在当前编辑缓冲区上通过一个按键启动 Java 编译器，我找到了我的编辑器的语法着色定义，我使用正则表达式来解析编译器输出并将我的光标放在报告的位置的编译错误。尘埃落定后，我有了一个小 IDE，除了调试器之外什么都有。
> 
> 为了跟踪我的代码，我使用了向控制台插入写入的老式技术，该技术记录了代码中的位置以及我想要检查的任何变量的状态。它很粗糙，很耗时，一旦代码工作就必须将其取出，并且有时会产生令人困惑的副作用（例如，在可能发生之前强制初始化，导致代码仅在存在跟踪时才有效）。
> 
> 在这些条件下，我的类方法变得更短，定义也越来越清晰，直到通常它们只做了一个非常明确的操作。它们还倾向于专门为易于测试而设计，具有简单且完全确定的输出，因此我可以独立测试它们。
> 
> 总而言之，当调试比设计更痛苦时，阻力最小的路径就是更好的设计。
> 
> 使这从观察变为确定的是该项目的成功。突然有了预算，我有了一个带有集成调试器的“合适的”IDE。在接下来的两周里，我注意到对以前习惯的回归，通过调试器中的迭代细化使“草图”代码工作。
> 
> 注意到这一点后，我使用调试器代替了深思熟虑的设计，重新创建了一些早期的工作。有趣的是，去掉调试器只会稍微减慢开发速度，而且完成的代码质量要好得多，尤其是从维护的角度来看。
> 
> 不要误会我的意思：调试器有一个地方。就我个人而言，我认为那个地方是在队长的手中，在危急时刻被带出来，需要弄清楚一个谜，然后在人们失去纪律之前再次被带走。
> 
> 人们不想要求它，因为那将是在他们的同行面前承认弱点，而解释需求和周围环境的行为很可能会引起同行的洞察力来解决问题 - 甚至更好的设计没有问题。

所以，FOR，我不仅同意你的立场，而且我有来自对照实验的真实数据来支持它。然而，这是一个相当小的样本。在我的结论得到支持之前，需要进行更详细的测试。

你为什么不接受我对你的团队所说的话并建议进行试验。你有比他们更多的数据（我只是给你的），为了有一个不同意你的可靠依据，他们基本上必须测试这个想法，而做到这一点的唯一方法就是试一试你的想法。

但是，您应该准备好让它分崩离析，因为整个事情都是基于这样的假设，即开发人员有能力和经验在没有逐步调试的情况下应对更强大的设计挑战。

创建了逐步调试以使调试更容易。降低标准的直接影响是，天赋较低的人可以参与——如果你开发了一个连傻瓜都可以使用的工具，你就会让傻瓜使用它——如果新的可访问活动报酬丰厚，其中很多。

这导致人才外流，因为他们通常利用人才做稀有和珍贵的事情，以便获得高薪而不是太努力，而市场不想为优秀买单，因为它不能很好地区分人才知道什么时候付钱是合理的。

* * *

另一个想法：最近在生产服务器上遇到的问题，无法安装调试器，这表明拥有一个维护不依赖于调试器可用性的代码库的重要性。在没有调试器的情况下增长的代码要少得多。当您可以改变主意时选择不使用它们，然后当您无法改变主意时，它就不会那么糟糕了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-01T20:19:42.930

> 由于我相当确信，这个问题不是关于调试是否是一种难闻的气味。

那么，您当地的教堂可能更适合您的问题。

除此之外，通过争论说服他们。但是，您可能需要重新考虑您的原教旨主义立场，因为这与说服力完全相反。您可能想要做的一件事是在整个讨论中删除“调试”一词，并将其替换为“逐步执行代码”或类似内容，强调您反对您谴责的无知的猜测/拼凑式探测实践，而不是关于代码的知情反思。

（我仍然不同意你的观点，但那是重点，因为你不想讨论。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-01T20:29:01.133

这里有问题，但我很难说清楚。也许真正的问题是代码有其他味道，很难理解。我同意使用 TDD 时应该少用而不是多用调试器，因为您将以小增量开发代码。但是，如果您无法查看代码并理解它，可能是因为设计过于耦合——需要太多相互关联的类才能使事情正常工作。

如果代码真的需要如此复杂以至于观察不够，那么也许你需要投资一些好的评论，解释正在发生的事情——尽管我更愿意看到事情被重构到不需要评论的地步。我怀疑调试器可能是症状而不是问题。

我知道对我来说，从传统的代码优先开发切换到测试优先开发可以减少调试时间……这不是我想念的。通常，我只会在不明显为什么我刚刚编写的代码通过测试时才涉及调试器。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-01T20:38:02.783

我认为这里真正的问题是

> 相信调试模式是“标准”模式的人倾向于编写只有通过单步执行才能理解的代码

如果这是真的，那应该是不言自明的错误，应该没有必要讨论它。如果不是很明显，那是因为他们看不到如何改进写得不好的代码。向他们展示，进行代码审查，展示如何以一种无需单步执行的方式清晰地重构代码。

**一旦编写了更好的代码，代码步进将自动减少**，*反之则行不通*。人们仍然会编写糟糕的代码，如果他们避免单步执行它只会导致更多的时间浪费（我真希望我能单步完成这个意大利面条式的混乱），而不是更好的代码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-01T22:37:59.330

这听起来像是你说你不想拥有的论点，但我认为如果你想说服你的队友，你将不得不提出更有力的理由。我不明白你的反对意见。我经常单步调试我试图用调试器理解的代码。这是查看正在发生的事情的好方法。您还没有确立您的说法，即以这种方式使用调试器的人倾向于编写难以理解的代码。这样做的唯一令人信服的方法是通过某种案例/对照研究，该研究试图测量和比较人们使用不同的调试器方法编写的代码的可读性。而且您甚至没有讲一个合理的故事来解释为什么您认为使用工具来理解代码执行往往会导致代码构建更加草率。*不合逻辑*。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-01T20:28:51.180

让他们相信另一种方法的优势的“计划”是建立与针对*不同*错误调试*相同*功能的次数相关的***[指标。](https://stackoverflow.com/questions/195887#195932)***

 **通过分析该指标的*趋势*，您可以让他们相信***非回归***测试对花时间编写更有用，并将帮助他们更有效地调试。

这样，您不会完全摆脱“调试”习惯，而是说服他们建立一套可靠的测试，让他们在需要时专注于真正有用的调试会话。

如果您考虑这个行动过程（指标），您应该知道它的实施涉及所有层次结构（利益相关者、项目经理、架构师、开发人员）。为了对它们采取行动，它们都需要参与这些指标。

关于开发人员，您可以尝试建议：

*   一些关闭错误案例的新方法（仅在重现该错误的测试场景下关闭它，这意味着他们需要独立测试才能在需要时启动他们的调试会话）
*   这些指标与管理层评估之间的明确关系（反复调试同一功能是一种不好的做法）
*   更多地参与*架构*决策：有时，了解一些功能或应用特性而不仅仅是类和代码可以促使开发人员更多地考虑黑盒测试而不是白盒（这更容易导致调试会话）
*   参与“运营架构”流程（您需要在其中部署您的应用程序，并进行完整的从前到后的集成测试）。同样，整个系统的大图可以帮助开发人员对功能而不是“代码行”更感兴趣

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-01T22:03:51.317

我认为这个问题的更好的措辞是“非 TDD 是一种代码味道吗？” 由于花费了更多时间编写/失败/通过测试，TDD 似乎导致在调试器中花费的时间更少。如果没有 TDD，您更有可能在调试器中花费时间来诊断错误。

至少在 Visual Studio 中，使用调试器并没有那么痛苦，因此您面临的挑战是向您的团队成员解释 TDD 如何使他们的开发更加愉快、高效和成功。仅仅避免使用调试器可能不足以让团队改变他们的开发方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-02T02:42:39.867

就在公路战士上。调试不是问题，它的注释和/或记录的代码和架构不好。我在一个较小的团队中工作，但是当出现错误时，我会逐步执行代码。通常这是一项非常小的工作，因为该应用程序经过精心计划，并且代码上的文档很清楚。

这就是说，让我们谈谈我的观点。希望团队不要调试...评论，评论评论。没有什么能比得上更快地调试的冲动。当然他们仍然会这样做，但他们更有可能跳过有据可查的代码。

哦，虽然它应该不言而喻，但无论如何我都会这样做。您的代码中没有错误。:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-02T03:32:23.603

我同意上面那些表示这个“调试器问题”相对无关紧要的人的观点。

IMO，开发人员的两个最重要的目标是：

1）让软件做它应该做的事情。

2) 编写代码，让维护开发人员在 2 年后享受更改现有功能或添加新功能的经验。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-02T08:39:41.937

在制定计划之前，您应该确定此更改对您的重要性。尽管我同意调试是一种气味，但它也是开发人员非常接受和根深蒂固的做法，因此说服他们停止这样做并不容易或快速——而且有充分的理由。你想在这个话题上投入多少精力？

第二，你为什么要首先说服他们？如果你的动机是帮助他们，那真的是他们的首要问题吗？当你以人们*希望得到帮助*的方式帮助他们时，[改变就变得容易](http://radio.javaranch.com/ilja/2008/07/19/1216448097868.html)了。

一旦你决定要继续你的变革计划，你就需要考虑到不同的人会被不同的事情说服。有些人已经通过尝试一些新的和令人兴奋的东西而被说服了。有些人会被数字（指标）说服。有些人在吃他们最喜欢的饼干时被告知（说真的！），有些人是从他们最喜欢的大师那里听到的。有些是通过在杂志上阅读的。有些人看到“其他人也在这样做”。等等。

在 InfoQ 上有一篇关于 Linda Rising 的深刻访谈：http: [//www.infoq.com/interviews/Linda-Rising-Fearless-Change](http://www.infoq.com/interviews/Linda-Rising-Fearless-Change)。她说得比我好。书也挺好的。

无论做什么，都不要压得太紧，也不要放弃。改变可能会发生——特别是如果你把[抵抗当作一种资源](http://dhemery.com/articles/resistance_as_a_resource/)——有时它会在意想不到的时候发生，所以要始终[保持一种惊奇的感觉](http://radio.javaranch.com/ilja/2008/06/26/1214506993463.html)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-04T01:14:20.073

@FOR：你还有第二个问题，这里是：

> 遗憾的是，开发人员似乎对提高生产力并不感兴趣（无论如何他们的报酬都是一样的）

当他们没有任何（可见的）收益时，你打算如何**让他们想要**更有效率？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-04-08T16:42:33.947

**通过调试来设计软件是一种很好的做法**。

支持这种开发方式的环境数量非常少：最著名的是 Smalltalk。在 Smalltalk 中，您可以编写一个测试来描述您的对象协议，而无需实现这些方法。运行此测试将触发调试器，您可以在调试器中将方法添加到正确的类中，并且可以继续单步执行代码，直到实现所有功能并且测试为绿色。

这需要一个在运行时可用的编译器和一流的调用。它提供了非常短的反馈周期，并且是 Smalltalks 生产力的主要原因之一

# unit-testing - 使用随机输入进行测试的最佳实践

> ID：256065
> 
> 赞同：10
> 
> 时间：2008-11-01T20:28:14.973
> 
> 标签：unit-testing, language-agnostic

**注意**：我提到接下来的几段作为背景。如果您只想要一个 TL;DR，请随意跳到编号问题，因为它们仅与此信息间接相关。

我目前正在编写一个 python 脚本，它使用 POSIX 日期（除其他外）做一些事情。不过，对这些进行单元测试似乎有点困难，因为可以遇到的日期和时间范围很广。

当然，尝试测试每个可能的日期/时间组合对我来说是不切实际的，所以我想我将尝试一个单元测试，将输入随机化，然后在测试失败时报告输入是什么。从统计上讲，我认为如果我尝试考虑所有潜在的问题区域（由于遗漏的东西）或测试所有案例（由于完全不可行），我可以实现更多的测试完整性，假设我运行它足够的次数。

所以这里有几个问题（主要与上述间接相关）：

1.  哪些类型的代码适合随机测试？哪些类型的代码不是？
    *   如何确定使用随机输入运行代码的次数？我问这个是因为我想有足够大的样本来确定任何错误，但不想等待一周才能得到我的结果。
    *   这些类型的测试是否非常适合单元测试，或者是否有另一种可以很好地使用的测试？
    *   做这种事情还有其他最佳实践吗？

### 相关话题：

*   [单元测试中的随机数据？](https://stackoverflow.com/questions/32458/random-data-in-unit-tests)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-01T20:37:56.717

我同意 Federico 的观点——随机测试会适得其反。如果测试不能可靠地通过或失败，那么很难修复它并知道它已修复。（当然，当您引入不可靠的依赖项时，这也是一个问题。）

但是，您可能希望以其他方式确保您拥有良好的数据覆盖率。例如：

*   确保您在 1900 到 2100 年间对每年每个月的开始、中间和结束进行测试（当然，如果这些测试适合您的代码）。
*   使用多种文化，或者“所有文化”（如果已知的话）。
*   尝试“第0天”和“每个月结束后的一天”等。

简而言之，仍然尝试很多值，但以编程方式和可重复的方式进行。您不需要在测试中尝试将每个值都作为文字 - 可以循环围绕测试的一个轴的所有已知值等。

你永远不会得到*完整*的覆盖，但它至少是可重复的。

编辑：我确信随机测试在*某些*地方很有用，尽管可能不适用于单元测试。但是，在这种情况下，我想提出一些建议：使用一个 RNG 创建一个随机但已知的种子，然后用该值播种一个新的 RNG - 并记录它。这样，如果发生有趣的事情，您*将*能够通过使用记录的种子启动 RNG 来重现它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-01T20:32:49.533

关于第三个问题，我认为随机测试*不太*适合单元测试。如果应用于同一段代码，单元测试应该总是成功，或者总是失败（即，由于错误导致的错误行为应该是可重现的）。但是，您可以使用随机技术生成大型数据集，然后在单元测试中使用该数据集；这没有什么问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-01T20:33:37.597

哇，好问题！一些想法：

*   随机测试始终是一种很好的建立信心的活动，尽管正如您所提到的，它最适合某些类型的代码。
*   这是对性能可能与其执行次数或输入序列相关的任何代码进行压力测试的绝佳方法。
*   对于相当简单的代码或需要有限类型输入的代码，我更喜欢系统测试，明确涵盖所有可能的情况、每个不太可能或病态情况的样本以及*所有*边界条件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-01T21:04:53.120

Q1) 我发现具有大量并发性的分布式系统非常适合随机测试。很难为此类应用程序创建所有可能的场景，但随机测试可能会暴露您从未想过的问题。

Q2）我想你可以尝试使用统计数据来建立一个发现所有“错误”的置信区间。但实际的答案是：尽可能多地运行随机测试。

Q3）我发现随机测试很有用，但是*在*您编写了正常的单元测试、集成测试和回归测试之后。您应该将您的随机测试集成为正常测试套件的一部分，尽管可能是一个小运行。如果不出意外，您可以避免测试本身出现一些问题，并在团队使用不同的随机输入运行测试时获得一些覆盖率。

Q4) 在编写随机测试时，请确保将随机种子与测试结果一起保存。没有什么比发现您的随机测试发现错误，并且无法使用相同的输入再次运行测试更令人沮丧的了。确保您的测试也可以使用保存的种子执行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-06T05:51:35.940

一些东西：

*   通过随机测试，您无法真正判断一段代码有多*好，但您可以判断它有多**糟糕*。
*   随机测试更适合具有随机输入的事物——一个典型的例子是任何暴露给用户的事物。因此，例如，在您的应用程序（或操作系统）中随机点击和键入的内容是对一般稳健性的良好测试。
*   同样，开发人员也算作用户。因此，从您的框架中随机组装 GUI 的东西是另一个不错的选择。
*   同样，您不会以这种方式找到所有的错误——您要寻找的是“如果我做了一百万件古怪的事情，它们中的任何一个都会导致系统损坏吗？” 如果没有，您可以对您的应用程序/操作系统/SDK/任何东西可能会在几天内向用户展示有一定程度的信心。
*   ...但是，更重要的是，如果您的 random-beater-upper 测试应用程序可以在大约 5 分钟内使您的应用程序/OS/SDK 崩溃，那么如果您尝试发布该应用程序，那么您在第一次消防演习之前还有多长时间傻瓜。

另请注意：**可重复性在测试中很重要！** 因此，让您的测试工具记录它使用的随机种子，并有一个参数以相同的种子开始。此外，让它从已知的“基本状态”开始（*即*，从服务器上的映像重新安装所有内容并从那里开始）或一些可重新创建的基本状态（*即*，从该映像重新安装，然后根据一些随机更改它- 测试工具作为参数的种子。）

当然，如果该工具具有“每 20,000 个事件保存状态”和“在事件 # 之前停止”和“向前 1/10/100 个事件”之类的好东西，开发人员会很感激。这将极大地帮助他们重现问题、发现并解决问题。

正如其他人指出的那样，服务器是暴露给用户的另一件事。为自己获取一个包含 1,000,000 个 URL 的列表（来自服务器日志的 grep），然后将它们提供给您的随机数生成器。

请记住：“系统连续 24 小时无误运行”并不意味着它已经准备好发货，它只是意味着它足够稳定，可以开始一些严肃的测试。在它能够做到这一点之前，QA 应该随意说“看，你的 POS 在栩栩如生的随机用户模拟下甚至不能持续 24 小时——你解决这个问题，我将花一些时间编写更好的工具。”

哦，是的，最后一件事：除了“尽可能快和用力地敲击它”测试之外，还有能力“完全按照真正的用户 [可能是精神错乱的，或者是键盘/鼠标的婴儿]会做。” 也就是说，如果您正在执行随机用户事件；以非常快的打字员或非常快的鼠标用户可以做到的速度（偶尔延迟，以模拟一个慢速的人），除了“我的程序可以吐出事件的速度”之外。这是两种**非常不同*类型的测试，当发现错误时会得到非常不同的反应。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-28T07:26:36.493

为了使测试具有可重复性，只需使用固定的种子起始值。这确保了无论何时运行测试都使用相同的数据。测试将可靠地通过或失败。

*   好/坏候选人？随机测试擅长发现边缘情况（例外）。一个问题是定义随机输入的正确结果。
*   确定运行代码的次数：只需尝试一下，如果花费的时间太长，请减少迭代次数。您可能想要使用代码覆盖率工具来找出您的应用程序的哪些部分实际被测试。
*   这些类型的测试是否非常适合单元测试？是的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T07:43:47.510

这可能有点离题，但是如果您使用的是 .net，则有[Pex](http://research.microsoft.com/en-us/projects/Pex/)，它执行类似于随机测试的操作，但通过尝试生成一个“随机”测试用例来练习所有路径，从而更加直观你的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-28T09:08:44.860

这是我对类似问题的回答：[随机生成测试数据是一种不好的做法吗？](https://stackoverflow.com/questions/636353/is-it-a-bad-practice-to-randomly-generate-test-data). 其他答案也可能有用。

> 只要您没有解决*预言机问题*的方法，即根据输入确定软件的预期结果，随机测试就是一种不好的做法。
> 
> 如果你解决了预言机问题，你可以比简单的随机输入生成更进一步。您可以选择输入分布，以便软件的特定部分得到比简单随机更多的锻炼。
> 
> 然后，您从随机测试切换到统计测试。
> 
> ```
> if (a > 0)
>     // Do Foo
> else (if b < 0)
>     // Do Bar
> else
>     // Do Foobar 
> ```
> 
> 如果你在范围内随机 选择`a`，你有50% 的时间、25% 的时间和 25% 的时间锻炼。您可能会发现 in 中的错误 多于或中的错误。`b``int``Foo``Bar``Foobar``Foo``Bar``Foobar`
> 
> 如果你选择`a`这样它在 66.66% 的时间是负的，`Bar`并且 `Foobar`比你的第一个分布得到更多的锻炼。事实上，三个分支各有 33.33% 的时间被执行。
> 
> 当然，如果您观察到的结果与您的预期结果不同，您必须记录所有对重现错误有用的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-27T21:40:43.493

随机测试具有巨大的优势，即可以以极低的成本生成单独的测试。即使您只有部分预言机也是如此（例如，软件会崩溃吗？）

在复杂的系统中，随机测试会发现其他任何方法都难以发现的错误。想想这对安全测试意味着什么：即使你不做随机测试，黑帽会，他们会发现你错过的错误。

随机测试的一个引人入胜的子领域是随机差分测试，其中应该显示相同行为的两个或多个系统用一个共同的输入来刺激。如果他们的行为不同，则发现了一个错误（一个或两个）。这在编译器的测试中得到了很好的应用，并且总是在任何编译器中发现以前没有遇到过该技术的错误。即使您只有一个编译器，您也可以在不同的优化设置上尝试它以寻找不同的结果，当然崩溃总是意味着错误。

# c# - C# 错误：使用未分配的局部变量

> ID：256073
> 
> 赞同：28
> 
> 时间：2008-11-01T20:33:16.007
> 
> 标签：c#, initialization

我不确定为什么会收到此错误，但不应该编译此代码，因为我已经在检查队列是否正在初始化？

```
public static void Main(String[] args)
{
    Byte maxSize;
    Queue queue;

    if(args.Length != 0)
    {
        if(Byte.TryParse(args[0], out maxSize))
            queue = new Queue(){MaxSize = maxSize};
        else
            Environment.Exit(0);
    }
    else
    {
        Environment.Exit(0);
    }

    for(Byte j = 0; j < queue.MaxSize; j++)
        queue.Insert(j);
    for(Byte j = 0; j < queue.MaxSize; j++)
        Console.WriteLine(queue.Remove());
} 
```

因此，如果队列未初始化，那么 for 循环就无法访问，对吗？由于程序已经以 Environment.Exit(0) 终止？

希望你们能给我一些指点:)

谢谢。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-11-01T20:35:29.280

编译器不知道 Environment.Exit() 将终止程序；它只是看到你在一个类上执行一个静态方法。声明时只需初始化`queue`为 null 即可。

```
Queue queue = null; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-01T20:35:14.053

编译器不知道 Environment.Exit() 不会返回。为什么不只是从 Main() 中“返回”？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-02T01:36:06.130

解决问题的几种不同方法：

只需将 Environment.Exit 替换为 return。编译器知道 return 结束了方法，但不知道 Environment.Exit 会结束。

```
static void Main(string[] args) {
    if(args.Length != 0) {
       if(Byte.TryParse(args[0], out maxSize))
         queue = new Queue(){MaxSize = maxSize};
       else
         return;
    } else {
       return;   
} 
```

当然，你真的只能侥幸逃脱，因为在所有情况下你都使用 0 作为退出代码。确实，您应该返回一个 int 而不是使用 Environment.Exit。对于这种特殊情况，这将是我的首选方法

```
static int Main(string[] args) {
    if(args.Length != 0) {
       if(Byte.TryParse(args[0], out maxSize))
         queue = new Queue(){MaxSize = maxSize};
       else
         return 1;
    } else {
       return 2;
    }
} 
```

将队列初始化为 null，这实际上只是一个编译器技巧，上面写着“我会找出我自己的未初始化变量，非常感谢”。这是一个有用的技巧，但在这种情况下我不喜欢它 - 你有太多的 if 分支来轻松检查你是否正确地执行它。如果你*真的*想这样做，这样的事情会更清楚：

```
static void Main(string[] args) {
  Byte maxSize;
  Queue queue = null;

  if(args.Length == 0 || !Byte.TryParse(args[0], out maxSize)) {
     Environment.Exit(0);
  }
  queue = new Queue(){MaxSize = maxSize};

  for(Byte j = 0; j < queue.MaxSize; j++)
    queue.Insert(j);
  for(Byte j = 0; j < queue.MaxSize; j++)
    Console.WriteLine(queue.Remove());
} 
```

在 Environment.Exit 之后添加一个 return 语句。同样，这更像是一个编译器技巧 - 但在 IMO 中稍微合法一些，因为它也为人类添加了语义（尽管它会让你远离那个自吹自擂的 100% 代码覆盖率）

```
static void Main(String[] args) {
  if(args.Length != 0) {
     if(Byte.TryParse(args[0], out maxSize)) {
        queue = new Queue(){MaxSize = maxSize};
     } else {
        Environment.Exit(0);
        return;
     }
  } else { 
     Environment.Exit(0);
     return;
  }

  for(Byte j = 0; j < queue.MaxSize; j++)
     queue.Insert(j);
  for(Byte j = 0; j < queue.MaxSize; j++)
     Console.WriteLine(queue.Remove());
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T20:47:18.210

如果您使用“return”，编译器只知道代码是否可以访问。将 Environment.Exit() 视为您调用的函数，编译器不知道它将关闭应用程序。

# c# - 静态终结器

> ID：256077
> 
> 赞同：45
> 
> 时间：2008-11-01T20:35:22.633
> 
> 标签：c#, .net, static, destructor, finalizer

执行某些静态终结的正确方法是什么？

没有静态析构函数。该`AppDomain.DomainUnload`事件不会在默认域中引发。该`AppDomain.ProcessExit`事件在所有事件处理程序之间共享三秒（默认设置）的总时间，因此它不是真正可用的。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-11-01T23:51:57.930

> Herfried Wagner 写了一篇[很好的文章](http://dotnet.mvps.org/dotnet/articles/sharedfinalizer/)，解释了如何实现这一点——唉，用德语（和 VB）。不过，代码应该是可以理解的。

我试过了：

```
static readonly Finalizer finalizer = new Finalizer();

sealed class Finalizer {
  ~Finalizer() {
    Thread.Sleep(1000);
    Console.WriteLine("one");
    Thread.Sleep(1000);
    Console.WriteLine("two");
    Thread.Sleep(1000);
    Console.WriteLine("three");
    Thread.Sleep(1000);
    Console.WriteLine("four");
    Thread.Sleep(1000);
    Console.WriteLine("five");
  }
} 
```

它的工作方式似乎与事件完全相同`AppDomain.ProcessExit`：终结器获取 ca. 三秒……

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-11-01T20:40:44.807

基本上，你不能。尽最大可能设计自己的方式。

不要忘记程序*总是*可以突然终止——有人拔掉电源就是一个明显的例子。所以你所做的任何事情都必须是“尽力而为”——在这种情况下，我当然*希望*这`AppDomain.ProcessExit`已经足够好了。

在您的特定情况下，您需要做什么？

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-01T20:59:25.393

两个让我想到的解决方案：

*   不要使用静态类。如果您使用非静态类并将其实例化，则不必担心清理工作。
*   如果这不是一个选项，我认为这是使用单例的好情况。这将实例化您的对象的副本并在退出时调用终结器，但仍然允许您在大多数情况下将其视为静态类。毕竟，您的类已经是静态的，因此共享不使用单例的大多数常见原因。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-01T20:40:51.407

我会质疑您在需要释放的静态方法中加载的内容。我当然不建议用静态方法做这些事情。

也就是说，您的静态方法可以实例化具有 finalize 方法的对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-07-31T20:03:23.863

移植基于 Herfried K. Wagner 的 Michael Damatov 的答案 (C#)。(VB.NET) 这里是 C++/CLI 版本：

```
ref class MyClass
{
        ref class StaticFinalizer sealed
        {
            !StaticFinalizer();
        };
        static initonly StaticFinalizer^ stDestr = gcnew StaticFinalizer();
}

MyClass::StaticFinalizer::!StaticFinalizer()
{
    System::Diagnostics::Debug::WriteLine("In StaticFinalizer!");
} 
```

PS 就像 AppDomain.ProcessExit 方法一样，如果进程异常终止（例如从任务管理器中），则可能不会调用此方法。另一个要注意的是，如果 MyClass 是泛型的（模板化的），那么每次应用程序执行不超过一次调用其静态构造函数和静态析构函数的假设不再有效。

# mysql - MySql集群“脑裂”解决方案？

> ID：256084
> 
> 赞同：2
> 
> 时间：2008-11-01T20:40:39.987
> 
> 标签：mysql, split, database-cluster

几天前，我在贝尔格莱德参加了一些 IT 会议。Agenda 上有一个关于 MySql 和 MySql 中的集群的话题，MySql 的人说他们有解决集群裂脑问题的最佳解决方案，有没有人对此有所了解，这是真的还是只是一个营销技巧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-01T21:33:30.817

MySQL Cluster 需要至少 3 个系统，这使得它可以让其中一个节点成为处理脑裂场景的仲裁者。其中两个系统可以运行数据节点/mysqld节点，第三个需要运行管理节点（通常默认为仲裁器，但SQL节点也可以作为它们运行）。

如果出现脑裂设置（即两个数据节点无法再相互通信，但它们仍在运行），那么它们将意识到这一点并要求仲裁器决定允许哪个节点继续运行。如果一个节点不能与仲裁者对话，那么它将关闭。仲裁者可以从所有节点中选择一个节点继续运行并告诉其他节点关闭。

仲裁器通常是管理节点，但也可以是数据节点。如果仲裁者失败，则集群可以选举一个新的仲裁者。但是，它不能在仲裁期间执行此操作，因此如果数据节点和仲裁器同时发生故障，则第三个节点将关闭。

当然，当您有多个节点组时，它会变得有点复杂，但同样的基本思想也适用于这些情况。

您可以在[MySQL Cluster FAQ](http://dev.mysql.com/doc/refman/5.0/en/faqs-mysql-cluster.html#qandaitem-22-10-25)中阅读更多相关信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T22:32:45.330

这是否属实是主观的，虽然我听说mysql的集群支持很好。然而，这个概念绝对支持并用于其他数据库，例如用于 postgres 的 Slony-I。

如果您澄清您所指的最佳方面（即性能、正常运行时间、易于设置等），您可能会得到更有用的回复。

# hyperlink - 更改嵌入在表格中的选定链接的颜色

> ID：256093
> 
> 赞同：1
> 
> 时间：2008-11-01T20:52:03.410
> 
> 标签：hyperlink, scripting, html-table

我试图在选择链接后使用类名来更改链接的颜色，以便它将保持新颜色，但仅在选择另一个链接之前，它会变回来。

我正在使用 Martin Kool 在[这个](https://stackoverflow.com/questions/206689/changing-the-bg-color-of-a-selected-link)问题中发布的代码：

```
<html>     
<head>
<script>
  document.onclick = function(evt) {
    var el = window.event? event.srcElement : evt.target;
    if (el && el.className == "unselected") {
      el.className = "selected";
      var siblings = el.parentNode.childNodes;
      for (var i = 0, l = siblings.length; i < l; i++) {
        var sib = siblings[i];
        if (sib != el && sib.className == "selected")
          sib.className = "unselected";
      }
    }
  }
</script>
<style>
  .selected { background: #f00; }
</style>
</head>
 <body>
   <a href="#" class="selected">One</a> 
    <a href="#" class="unselected">Two</a> 
    <a href="#" class="unselected">Three</a>
  </body> 
```

在我尝试找出表格中的链接之前，它工作正常。为什么是这样？轻松一点，我是初学者。

* * *

没有错误，链接正在更改为“选定的”类，但选择另一个链接时，旧链接正在保留“所选”类，而不是更改为“未选择”。基本上，据我所知，它的功能就像一个 vlink 属性，这不是我想要的。

是的，链接都在不同的单元格中，您建议我如何更改代码以使其正常工作？

* * *

好吧，其实我说得太早了。

```
document.onclick = function(evt)
{
var el = window.event? event.srcElement : evt.target;
if (el && el.className == 'unselected')
{
    var links = document.getElementsByTagName('a');
    for (var i = links.length - 1; i >= 0; i--)
    {
            if (links[i].className == 'selected')
                    links[i].className = 'unselected';
    }
    el.className = 'selected';
}

return false;
} 
```

你给我的这段代码工作得很好，在视觉上，它完全符合我的要求。但是，它使我的链接停止工作......它们改变颜色，但不链接到任何东西，然后当我删除脚本时，它们工作正常。我做错了什么/我必须改变什么才能完成这项工作？

另外，我想在我网站的其他地方做同样的事情，链接都在一个`<div>`标签中，由`<p>`标签分隔。我怎样才能使这项工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T21:33:03.437

您正在遍历兄弟姐妹。如果链接位于单独`<td>`的 's 中，则它们不再是兄弟姐妹。

您可以像这样遍历所有链接：

```
document.onclick = function(evt)
{
    var el = window.event? event.srcElement : evt.target;
    if (el && el.className == 'unselected')
    {
        var links = document.getElementsByTagName('a');
        for (var i = links.length - 1; i >= 0; i--)
        {
            if (links[i].className == 'selected')
                links[i].className = 'unselected';
        }
        el.className = 'selected';
    }

    return false;
} 
```

我还在`return false;`函数末尾添加了一个来阻止你去'#'

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T21:04:49.720

是有错误还是什么也没发生？如果您是 javascript 初学者，第一步是使用 Firebug 之类的工具，以便查看详细的错误消息，并且可以添加 console.log 语句以查看运行代码时发生的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T21:09:01.457

“在表格中”是指将每个链接放在自己的单元格中吗？因为那会使这条线：

```
var siblings = el.parentNode.childNodes; 
```

无法选择单元格外的其他链接。您必须找到另一种方法来指示哪个元素是链接容器。

# c++ - 如何在 VS 2008 上安装 boost？

> ID：256109
> 
> 赞同：6
> 
> 时间：2008-11-01T21:05:17.520
> 
> 标签：c++, visual-studio-2008, boost, installation

我几乎已经完全安装了 Boost，但是我对如何在*Tools->options->projects->VC++ Directories*中设置 Boost 的路径有疑问。

我已经编写了包含文件和库的路径（我的文件夹包含两个子文件夹`lib`和`include`），但是当我尝试将 Boost 与 一起使用时 `#include boost/regex.hpp`，出现此链接错误：

```
LINK : fatal error LNK1104: cannot open file 'libboost_regex-vc90-mt-gd-1_36.lib 
```

您能否告诉我如何为 Visual Studio 2008 正确安装 Boost？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-01T21:10:19.693

使用 Boost 咨询组的[Boost Installer](http://www.boostpro.com/download/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-01T21:36:19.670

您可能对 Visual Studio 2008 功能包感兴趣。它添加了许多迄今为止只能从 Boost 中获得的特性，这些特性是 C++ TR1 的一部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T13:07:34.210

还可以查看[这篇文章](https://stackoverflow.com/questions/289909/boost-137)以获取有关如何自己构建 Boost 的说明。

# ip - 应用程序多播的最佳教程？

> ID：256125
> 
> 赞同：6
> 
> 时间：2008-11-01T21:15:12.943
> 
> 标签：ip, multicast, irc

我最近意识到 IP 多播（在公共互联网上显然不能很好地工作）和应用程序多播（根据[http://en.wikipedia.org显然在 IRC 和 PSYC 中使用）之间存在区别/wiki/多播](http://en.wikipedia.org/wiki/Multicast)）。

是否有关于实现应用程序级多播的好教程？

我认为多播的全部意义在于减少公共网段的带宽，所以我很难理解应用程序级多播的作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T01:20:04.023

IP 级多播的目的是减少许多用户希望接收相同流量的公共网段的带宽。它通常仅限于一个特定的子网，IP 路由器不会将多播传播到子网之外。这样做是出于可扩展性的原因 - 允许一台主机发起多播数据包并传播到 Internet 上的每个 IP 地址并不是一个好主意。

有不同的方式来考虑“应用程序级”多播。一种方法是使用参与多播的主机来构建多播树。Dijkstra 的算法可以用来做到这一点（维基百科对此有一个合理的描述）。但是，如果主机以相当大的速度加入和离开网络，维护参与计算机的列表并保持树是最新的可能是一项相当大的工作。而且您可能无法很好地估计应用程序级别的可用跃点成本。

您应该查看的另一种方法是 Gnutella 网络的查询路由协议中使用的泛洪算法。（Wikipedia 对此也有很好的描述。）这种方法减少了构建多播树的需要，但它的缺点是会产生更多的网络流量。事实上，网络流量增加了很多，因为流量随着节点数的平方而增长，即 O(n**2)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-06T04:49:03.173

应用程序多播的另一个示例是在[Amazon EC2](http://en.wikipedia.org/wiki/Amazon_Elastic_Compute_Cloud)或[Google App Engine中使用](http://en.wikipedia.org/wiki/Google_App_Engine)[JGroups](http://www.jgroups.org/) ，因为它们不支持 IP 多播，但开发人员希望使用多播功能。

# git - 尝试创建提交消息时出现 Cygwin + git 权限问题

> ID：256142
> 
> 赞同：1
> 
> 时间：2008-11-01T21:32:53.220
> 
> 标签：git, permissions, cygwin, vim

当我尝试从 Cygwin 将第一个修订版提交到我的 git 存储库（git commit）时，我在 gvim 中收到一个错误，上面写着“无法打开“foo\.git\COMMIT_EDITMSG”[新目录]的交换文件。我认为这可能是某种权限问题，但我尝试从文件夹中删除只读标志，以及递归调整所有者（使用 Windows 属性选项卡，而不是 Cygwin 下的 chown）作为我的帐户m 下运行，没有任何运气。如果我将默认编辑器更改为记事本，我会得到“系统找不到指定的文件”，即使文件 (COMMIT_EDITMSG) 确实存在，甚至包含：

```
# Please enter the commit message for your changes.
# (Comment lines starting with '#' will not be included)
# etc... 
```

如何进一步解决此问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-01T21:54:06.127

> 无法打开“foo\.git\COMMIT_EDITMSG”[新目录] 的交换文件。

看起来`git commit`将文件路径作为 Windows 路径而不是 POSIX 路径传递。注意`\`消息中的。

`gvim`将尝试打开不存在的“foo.gitCOMMIT_EDITMSG”。

我不使用`git`，但我想它使用类似于`SVN_EDITOR`. 您可能需要使用一个小脚本来包装编辑会话，该脚本用于`cygpath`将文件路径从 Windows 更改为 Posix 分隔符。

```
#!/bin/bash
gvim "$(cygpath --unix "${1}")" 
```

警告 Emptor，未经测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-20T20:59:40.597

您在 cygwin ( *windows native* ) 中使用 mingw 或 msysgit git。这在使用 cygwin 编辑器 (gvim) 时不起作用。\ 不是 POSIX 中的路径分隔符，而是转义下一个字符。

您需要安装 cygwin git 包或使用适当的 mingw/msysgit 编辑器。

也可能是 mingw git.exe 在 /usr/bin 之前的 PATH 中。然后修复你的PATH。

此类问题通常通过[http://cygwin.com/problems.html](http://cygwin.com/problems.html)处理，尤其是。cygcheck -s -v -r > cygcheck.out 在邮件列表中。然后我们可以看到更多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-23T15:56:20.313

对于“cygpath”，尝试：

`cygdrive -a -m COMMIT_EDITMSG`

您可能需要以下样式的路径：

`D:/path/to/your/working_directory/.git/COMMIT_EDITMSG`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-05T19:31:49.837

我第一次遇到同样的问题，但我发现这是正常的。只是我不记得如何处理 Vim。我在该链接中找到了解决方案：http: [//vim.runpaint.org/basics/quitting-vim/](http://vim.runpaint.org/basics/quitting-vim/)。我使用了 vim 命令 :x 来保存我的评论并提交修改。您可以通过以下链接了解 Git 和 Vim 之间的这种集成：http: [//vim.runpaint.org/extending/integrating-vim-with-git/](http://vim.runpaint.org/extending/integrating-vim-with-git/)。

# delphi - 有人可以向我解释匿名方法吗？

> ID：256146
> 
> 赞同：31
> 
> 时间：2008-11-01T21:37:00.810
> 
> 标签：delphi, closures, anonymous-methods

在一些很酷的东西中，Delphi 2009 也刚刚获得了匿名方法。我已经看过这些例子，以及关于匿名方法的博客文章，但我还没有得到它们。有人能解释为什么我应该兴奋吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-01T21:54:02.477

请看一下[闭包](http://en.wikipedia.org/wiki/Closure_(computer_science))。

Delphi 匿名函数是闭包。

这些是在其他函数中创建的，因此可以访问该函数的范围。即使将匿名函数分配给在调用原始函数之后调用的函数参数，情况也是如此。（我稍后会创建一个示例）。

```
type
  TAnonFunc = reference to procedure;
  TForm2 = class(TForm)
    Memo1: TMemo;
    Button1: TButton;
    Button2: TButton;
    Button3: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
  private
    F1 : TAnonFunc;
    F2 : TAnonFunc;
  end;

procedure TForm2.Button1Click(Sender: TObject);
var
  a : Integer;
begin
  a := 1;

  F1 := procedure
  begin
    a := a + 1;
  end;

  F2 := procedure
  begin
    Memo1.Lines.Add(IntToStr(a));
  end;
end; 
```

上述方法将两个匿名函数分配给字段 F1 和 F2。第一个增加局部变量，第二个显示变量的值。

```
procedure TForm2.Button2Click(Sender: TObject);
begin
  F1;
end;

procedure TForm2.Button3Click(Sender: TObject);
begin
  F2;
end; 
```

您现在可以调用这两个函数，并且它们访问相同的 a。所以调用 F1 两次，F2 一次显示 3。当然这是一个简单的例子。但它可以扩展为更有用的代码。

在多线程环境中，可以在调用 Synchronise 时使用匿名函数，这样就不需要无数方法了。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-05T14:00:44.877

想想典型的回调代码，你需要有数据可用于回调。通常**只有**回调需要这些数据，但您必须跳过许多圈才能到达那里，而不必接受全局变量等非 OOP 友好的做法。使用匿名方法，数据可以保留在原处——您不必不必要地扩展其范围或将其复制到某个辅助对象。只需将您的回调代码就地编写为匿名方法，它就可以在定义匿名方法的位置（而不是调用它的位置！）完全访问和操作所有局部变量。

匿名方法还有其他方面，最明显的是它们是，嗯：匿名，但这是真正让他们为我“点击”的那个......

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-02T18:13:35.413

可能这个例子对你有一些价值。在这里，我将实现一个可缩放的显示列表，用于在 TCanvas 上进行绘制，而无需声明不同类型的显示类。它还大量使用泛型。假设我们有一个带有 TPaintBox 和 TTrackBar 的 TForm...

```
type
  TDisplayProc = TProc<TCanvas>;

type
  TFrmExample3 = class(TForm)
    pbxMain: TPaintBox;
    trkZoom: TTrackBar;
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
    procedure pbxMainClick(Sender: TObject);
    procedure pbxMainMouseMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
    procedure pbxMainPaint(Sender: TObject);
    procedure trkZoomChange(Sender: TObject);
  private
    FDisplayList: TList<TDisplayProc>;
    FMouseX: Integer;
    FMouseY: Integer;
    FZoom: Extended;
    procedure SetZoom(const Value: Extended);
  protected
    procedure CreateCircle(X, Y: Integer);
    procedure CreateRectangle(X, Y: Integer);
    function MakeRect(X, Y, R: Integer): TRect;
  public
    property Zoom: Extended read FZoom write SetZoom;
  end;

implementation

{$R *.dfm}

procedure TFrmExample3.PaintBox1Paint(Sender: TObject);
var
  displayProc: TDisplayProc;
begin
  for displayProc in FDisplayList do
    displayProc((Sender as TPaintBox).Canvas);
end;

procedure TFrmExample3.CreateCircle(X, Y: Integer);
begin
  FDisplayList.Add(
    procedure (Canvas: TCanvas)
    begin
      Canvas.Brush.Color := clYellow;
      Canvas.Ellipse(MakeRect(X, Y, 20));
    end
  );
end;

procedure TFrmExample3.CreateRectangle(X, Y: Integer);
begin
  FDisplayList.Add(
    procedure (Canvas: TCanvas)
    begin
      Canvas.Brush.Color := clBlue;
      Canvas.FillRect(MakeRect(X, Y, 20));
    end
  );
end;

procedure TFrmExample3.FormCreate(Sender: TObject);
begin
  FDisplayList := TList<TDisplayProc>.Create;
end;

procedure TFrmExample3.FormDestroy(Sender: TObject);
begin
  FreeAndNil(FDisplayList);
end;

function TFrmExample3.MakeRect(X, Y, R: Integer): TRect;
begin
  Result := Rect(Round(Zoom*(X - R)), Round(Zoom*(Y - R)), Round(Zoom*(X + R)), Round(Zoom*(Y + R)));
end;

procedure TFrmExample3.pbxMainClick(Sender: TObject);
begin
  case Random(2) of
    0: CreateRectangle(Round(FMouseX/Zoom), Round(FMouseY/Zoom));
    1: CreateCircle(Round(FMouseX/Zoom), Round(FMouseY/Zoom));
  end;
  pbxMain.Invalidate;
end;

procedure TFrmExample3.pbxMainMouseMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
begin
  FMouseX := X;
  FMouseY := Y;
end;

procedure TFrmExample4.SetZoom(const Value: Extended);
begin
  FZoom := Value;
  trkZoom.Position := Round(2*(FZoom - 1));
end;

procedure TFrmExample4.trkZoomChange(Sender: TObject);
begin
  Zoom := 0.5*(Sender as TTrackBar).Position + 1;
  pbxMain.Invalidate;
end; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-02T18:24:39.947

人们已经提供了代码，所以我只列出一些有用的地方。

假设您有一些 GUI 代码。通常，对于像按钮的 onclick 处理程序这样的东西，您必须提供一个在单击该按钮时将调用的函数。但是，假设该函数所要做的只是一些简单的事情，比如弹出一个消息框或在某处设置一个字段。假设您的代码中有几十个这样的按钮。如果没有匿名函数，您将不得不拥有大量名为“OnButton1Click”、“OnExitButtonClick”等的函数，这可能会使您的代码混乱……或者您可以创建立即附加到这些事件的匿名函数，而您不需要再也不用担心他们了。

另一个用途是函数式编程。假设您有一个数字列表。你只想取回那些能被三整除的数字。可能有一个函数被调用`filter`，它接受一个返回布尔值和列表的函数，并返回一个新列表，该列表仅包含第一个列表中的那些元素，当传递给函数时，返回 True。例子：

```
filter(isOdd, [1, 2, 3, 5, 6, 9, 10]) --> [1, 3, 5, 9] 
```

被迫定义一个函数“isDivisibleByThree”，然后将其传递给过滤器会很烦人，因此这里匿名函数的另一个用途是快速创建一个您在其他任何地方都不需要的函数并将其传递给过滤器。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-02T23:18:40.307

我正在回答我自己的问题，但我在这里找到了对匿名方法的一个很好的解释 [你的编程语言可以做到这一点吗？](http://www.joelonsoftware.com/items/2006/08/01.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-01T21:48:58.350

我猜（我不知道 Delphi）这意味着您现在可以将函数创建为一种数据对象。例如，这意味着您可以将函数作为参数传递给其他函数。示例：排序函数可能将比较函数作为参数，因此更加通用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T08:02:19.517

匿名方法在函数式编程中很有用，但它们也可以帮助您在结构化编程中编写更紧凑的代码。线程，例如：http: [//blogs.codegear.com/abauer/2008/09/08/38868](http://blogs.codegear.com/abauer/2008/09/08/38868)

您的“兴奋”的另一个用例:)：http: [//delphi.fosdal.com/2008/08/anonymous-methods-when-to-use-them.html](http://delphi.fosdal.com/2008/08/anonymous-methods-when-to-use-them.html)

# c - 将结构的指针/引用传递给函数

> ID：256148
> 
> 赞同：13
> 
> 时间：2008-11-01T21:38:41.960
> 
> 标签：c, pointers, struct, reference

这听起来像是一个愚蠢的问题，但我还在学习 C，所以请多多包涵。:)

我正在编写 K&R（结构）的第 6 章，到目前为止，这本书已经取得了巨大的成功。我决定大量使用结构，因此在本章的开头用 point 和 rect 示例做了很多工作。我想尝试的一件事是`canonrect`通过指针更改函数（第 2 版，第 131 页）工作，因此返回`void`。

我有这个工作，但遇到了一个小问题，我希望你们能帮助我。我想`canonRect`创建一个临时矩形对象，执行它的更改，然后将它传递给临时矩形的指针重新分配，从而简化代码。

但是，如果我这样做，矩形不会改变。相反，我发现自己手动重新填充了我传入的矩形字段，这确实有效。

代码如下：

```
#include <stdio.h>

#define min(a, b) ((a) < (b) ? (a) : (b))
#define max(a, b) ((a) > (b) ? (a) : (b))

struct point {
    int x;
    int y;
};

struct rect {
    struct point lowerLeft;
    struct point upperRight;
};

// canonicalize coordinates of rectangle
void canonRect(struct rect *r);

int main(void) {
    struct point p1, p2;
    struct rect r;

    p1.x = 10;
    p1.y = 10;
    p2.x = 20;
    p2.y = 40;
    r.lowerLeft = p2; // note that I'm inverting my points intentionally
    r.upperRight = p1;

    printf("Rectangle, lower left: %d, %d; upper right: %d %d\n\n", 
        r.lowerLeft.x, r.lowerLeft.y, r.upperRight.x, r.upperRight.y);

    // can't pass a pointer, only a reference. 
    // (Passing pointers results in illegal indirection compile time errors)
    canonRect(&r); 
    printf("Rectangle, lower left: %d, %d; upper right: %d %d\n\n", 
        r.lowerLeft.x, r.lowerLeft.y, r.upperRight.x, r.upperRight.y);    
}

void canonRect(struct rect *r) {
    struct rect temp;
    temp.lowerLeft.x = min(r->lowerLeft.x, r->upperRight.x);
    temp.lowerLeft.y = min(r->lowerLeft.y, r->upperRight.y);
    temp.upperRight.x = max(r->lowerLeft.x, r->upperRight.x);
    temp.upperRight.y = max(r->lowerLeft.y, r->upperRight.y);

    r = &temp; // doesn't work; my passed-in rect remains the same

    // I wind up doing the following instead, to reassign all 
    // the members of my passed-in rect
    //r->lowerLeft = temp.lowerLeft;
    //r->upperRight = temp.upperRight;
} 
```

所以这里有问题：

1.  为什么不`r = &temp;`工作？（我**认为**这是因为我传入了引用而不是指针；我认为引用不可修改但指针是正确的吗？）
2.  如果我尝试传递指向 的指针，为什么会出现非法间接编译时错误`canonRect`？（即，如果我有的话`canonRect(*r);`。`main()`）

我怀疑我已经知道#1 的答案，但#2 让我感到困惑——我认为传递指针是合法的。

无论如何...请原谅C新手。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-01T21:41:50.237

**我想你想要做的是：**

```
void canonRect(struct rect *r) {
    struct rect temp;
    temp.lowerLeft.x = min(r->lowerLeft.x, r->upperRight.x);
    temp.lowerLeft.y = min(r->lowerLeft.y, r->upperRight.y);
    temp.upperRight.x = max(r->lowerLeft.x, r->upperRight.x);
    temp.upperRight.y = max(r->lowerLeft.y, r->upperRight.y);

    *r = temp; 
} 
```

在上面的代码中，您将 rect 类型的 *r 设置为 rect 类型的 temp。

Re 1：如果要更改 r 指向的内容，则需要使用指向指针的指针。如果这确实是您想要的（见上文，它并不是您真正想要的），那么您必须确保将其指向堆上的某些内容。如果你将它指向不是用 'new' 或 malloc 创建的东西，那么它将超出范围，你将指向不再用于该变量的内存。

*为什么您的代码不能与 r = &temp 一起使用？*

因为 r 是 rect* 类型。这意味着 r 是一个变量，其中包含一个内存地址，该内存地址包含一个矩形。如果您更改 r 指向的内容，那很好，但这不会更改传入的变量。

Re 2： * 在类型声明中不使用时是取消引用一元运算符。这意味着它将查找指针地址内的内容。所以通过 *r 你根本没有传递指针。面对面，因为 r 不是指针，所以这是无效的语法。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-01T21:43:50.560

还值得注意的是，一旦该方法 canonRect 结束，您的变量 'struct rec temp' 将超出范围，并且您将指向无效内存。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-01T21:53:53.957

听起来您将“取消引用”运算符（`*`）与“地址”运算符（）混淆了`&`。

当您 write`&r`时，它​​会获取 r 的地址并返回一个指向 r 的指针（指针只是变量的内存地址）。因此，您实际上是在将指针传递给函数。

当你写的时候`*r`，你试图取消对 r 的引用。如果 r 是一个指针，那将返回 r 指向的值。但是 r 不是一个指针，它是一个矩形，所以你会得到一个错误。

为了使事情更加混乱，`*`在声明指针变量时也使用了该字符。在这个函数声明中：

```
void canonRect(struct rect *r) { 
```

`r`被声明为指向 a 的指针`struct rect`。这与像这样使用完全不同`*`：

```
canonRect(*r); 
```

在这两种情况下，* 字符意味着完全不同的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-01T21:54:45.220

您可能想了解参数可以（从概念上）传递给函数的不同方式。C 是[按值调用](http://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value)，因此当您将指向 rect 的指针传递给函数时，您将传递指针的副本。函数直接（非间接）对值 r 所做的任何更改对调用者都是不可见的。

如果您希望该函数为调用者提供一个新结构，那么有两种方法：1\. 您可以返回一个 rect： 2\. 您可以将一个指针传递给一个指向 rect 的指针：

第一种方式会更自然：

```
struct rect* canonRect(struct rect* r)
{
  struct rect* cr = (struct rect*) malloc(sizeof(struct rect));
  ...
  return cr;
} 
```

第二种方法是：

```
void canonRect(struct rect** r)
{
  *r = (struct rect*) malloc(sizeof(struct rect));
} 
```

然后调用者将使用：

```
 canonRect(&r); 
```

但是调用者丢失了它拥有的原始指针，你必须小心不要泄漏结构。

无论您使用哪种技术，该函数都需要使用 malloc 为堆上的新结构分配内存。您不能仅通过声明一个结构来分配堆栈上的空间，因为当函数返回时该内存变得无效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-01T21:56:22.877

首先，K&R c 没有“引用”的概念，只有指针。运算符的`&`意思是“取地址”。

* * *

其次，`r`in`cannonRect()`是一个局部变量，而*不是*`r`in `main()`。更改本地点的`r`位置不会影响`r`调用例程。

* * *

最后，如前所述，本地`struct rect`分配在堆栈上，并在右括号处超出范围，

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-04T14:13:43.603

> 2.如果我尝试传递一个指向canonRect的指针，为什么会得到一个非法的间接编译时错误？（IE，如果我有 canonRect(*r); 在 main()。）

因为，它不是**指针**的目的。

# ide - 语言向导被认为是有害的？

> ID：256154
> 
> 赞同：2
> 
> 时间：2008-11-01T21:42:11.657
> 
> 标签：ide, code-generation, wizard, yagni

奇才可以启动功能。它们还可以混淆你的代码，并且是反 YAGNI 的。

总的来说，你认为巫师更有用还是更有害？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-01T21:51:40.077

**当**且仅当您了解它们生成的代码时，它们才比有害更有用。只有在您掌握了向导试图解决的问题之后，它们才真正有用。否则你会在项目后期碰壁，因为生成的代码在某些时候需要修改**。**

[“泄漏抽象定律”](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)真的把它钉在了头上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-01T21:47:49.587

他们在那里是有原因的——尝试让你的生活更轻松。它们很有用，可以为您节省 5 或 10 分钟的打字时间。当然，最好阅读并确保您了解他们为您写的内容。

如果您在不了解的情况下使用它们，那么它们可能会被认为是有害的，因为它们会让您逃脱不学习您可能应该知道的东西，但总的来说，我认为它们是一件好事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-01T22:26:14.797

当且仅当您可以摆脱*从不*编辑它们生成的代码的情况下，向导才是好的。在这种情况下，它们本质上是一种非常高级的编程语言。当您对向导生成的某些内容改变主意时，可以再次运行该向导。

*如果*您必须编辑他们生成的代码，那么巫师是最可怕的邪恶。如果您这样做了，后来又改变了您在向导中做出的选择之一的想法，那么您将被迫在两个非常糟糕的选项之间做出选择。您可以重新运行向导，然后重新应用手动编辑，或者您可以尝试编辑向导第一次创建的样板代码的多个副本。在前一种情况下，您可能会忘记至少一个编辑，而在后一种情况下，您可能会错过代码中在向导运行时受您的选择影响的至少一个位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-01T22:17:01.430

当向导生成一个封装实体（一个函数、一个类或一组类）时，它们“基本上是无害的”，您不需要对其进行修改，并且可以通过定义良好、设计良好的界面与之交互。

另一方面是一个向导，它生成需要扩展和修改的骨架代码。如果您以后无法更改某些向导选项而不会丢失您的编辑，这将特别麻烦。

对于可以自己编写相同代码并使用向导节省时间的专业人士来说，这些仍然是“可以的”。然而，当他们习惯于让复杂的东西看起来对初学者来说很容易时，他们就是对一辆生锈的汽车的油漆工作：他们帮助销售一些你本来不会买的东西。

在实践中，它们可能仍然有助于简化平台的采用。但这是一个业务方面，业务方面是否可以证明代码错误是开发环境的问题。

# java - java开发的最佳操作系统？

> ID：256169
> 
> 赞同：24
> 
> 时间：2008-11-01T21:54:44.643
> 
> 标签：java, operating-system, jvm, solaris

什么是 Java 开发的最佳操作系统？Sun 的人正在推动 Solaris，是的，Solaris 本身包含一些额外的功能，例如（dTrace、性能调整 JVM 的可能性等。）。我的一些朋友将他们的应用程序移植到了 solaris 上，他们对我说性能非常出色。我不喜欢切换我的操作系统，而是使用 Solaris。

你的经历是什么？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-02T08:43:46.453

在我使用过的三个（Mac OS X、Linux、Windows）中，我认为 Linux 是进行 Java 开发的最佳场所。

我的主要个人机器是 Mac，我在那里做了很多 Java 开发并且对它很满意。然而，不幸的是，Apple 落后于官方 JDK 版本，而且您几乎受限于他们选择提供的少数几个版本。

我的雇主提供的机器是 HP 的旧 P4 板条箱，我主要用它来保暖。真正的工作发生在“Oberon”上，在 2.6 GHz 四核上以 32 位模式运行*Ubuntu 8.04 [1]。*与 Windows 相比，我日常注意到的两个优势是：

1.  一个强大的命令行，它可以帮助我自动化无聊的小东西。
2.  **远超**卓越的文件系统性能。（我目前正在使用 EXT3，因为我在晚年变得保守。我以前使用过 ReiserFS，对于通常在从 subversion 签出的大型工作空间上执行的各种操作来说，它甚至更快。）

您也可以从 mac 获得这些优势，但 Linux 提供了另一个不错的好处：

*   远程 X11：在我的 $EMPLOYER 通过 Web 提供电子邮件和日历之前，我必须在 Windows 机器上阅读我的邮件和查看我的会议，所以我使用了 Cygwin 的 X11。这使我可以在 Linux 上运行这些东西，但可以在我的 Windows 桌面上显示它。

* * *

[1] 我曾经在 64 位模式下运行 Ubuntu，但我遇到了无穷无尽的麻烦。（混合 64 位和 32 位是 Mac OS X 做得更好的东西*。*） 7.04 在 64 位内核上运行 32 位应用程序运行良好。7.10 打破了`linux32`脚本和安装新的 32 位应用程序的能力，尽管旧的应用程序继续（大部分）运行。8.04 使 32 位 JVM 无法连接到网络，从而杀死了 32 位 java（Eclipse 不再更新）。运行 Eclipse 64 位运行不可靠。当时当前版本的 oXygen 只能（勉强地）在 IBM 64 位 VM 下运行，该 VM 可以运行大约 10 分钟，直到它停止接收键盘事件。我终于沮丧地放弃了，使用了我的 Mac 几个月，直到我有足够的空闲时间在 linux 机器上进行 8.04 的 32 位安装。现在一切都恢复了，我很高兴。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-01T22:10:59.087

随心所欲地发展。作为一名 Java 程序员，您可能希望避免使用 Mac OS X，主要是因为新功能似乎已经明显延迟，而且您会发现您不再拥有一台支持 Java 新版本的机器。话虽如此，我想象在 Mac OS X 上开发一定非常好（命令行界面、dtrace、nice OS）。

我使用 IntelliJ 7 在 Windows 上开发。没关系，但需要一些强大的硬件。然后我部署到 solaris/linux 上。除非您正在编写 GUI 或与 C++ 代码集成，否则您应该可以选择您喜欢的任何内容。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-01T22:07:46.677

“发展” ？

我相信您应该坚持使用您最熟悉的操作系统，或者对于一大群（开发人员）来说最可用的操作系统，例如 Windows 上的一组 PC。

很少需要在*开发*平台上进行深度调优。

您可以将所有这些 dtrace 和其他性能调整保留到汇编平台（例如在 Linux 中），用于重新编译和单元测试所有内容的日常部署。

然后您可以设置一个特殊的 JVM（例如 IBM JRockit 而不是 Sun JRE）来对您的集成平台进行一些分析，您的所有系统都可以从前到后进行测试，包括压力和非回归测试

最后，在预生产平台（可以是昂贵的 F15K 或 SunFire880 或 V490 或...）上进行所有 UAT（用户验收测试），并在其中使用目标 JRE。

我的观点是：在开发和发布到生产之间需要考虑很多参数，因此在这么早的阶段切换操作系统可能证明是不必要的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-01T22:08:15.253

开发您满意的内容，并测试您部署的内容。

我开始在我的 Mac 上开发 Java，并在 Solaris 和 Linux 上进行部署。事实上，对于大部分任务，Java 可以以独立于操作系统的方式开发。对于服务器端开发尤其如此。

我一般喜欢在 Windows 机器上的 Unix 上进行开发，但这就是我。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-01T23:23:00.330

我会说Mac OS X。

内置 Java 开发。您想要的所有 unix 命令行工具。盒子外面。蚂蚁和行家都在那里。不是最新版本，但这很容易升级。

是的，您可能没有最新版本的 JDK，但实际上，除非您需要为最新最好的 JDK 进行开发，否则这不会成为问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-02T00:44:21.103

答案比您想象的要容易：使用您最喜欢的操作系统。对于Java，这是最好的答案。不是开发本身，而是您的舒适度将有助于您在您最喜欢的环境中取得成功、浏览文档等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-01T22:06:59.593

就个人而言，我不会打扰。我会使用最能支持您使用的开发工具和目标平台的平台。

为什么需要调整 JVM？这是一件非常不寻常的事情。用 C++ 这样的低级语言编写会更好吗？

Dtrace 可用于 OS X，也有一个 linux 端口。Solaris 在历史上一直以速度慢着称（因此有 Slowaris 的昵称）。我不确定这是否仍然正确。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-04T06:16:38.077

我使用过 Linux、Windows 和 OS X。我支持 OS X 的最大理由是它是用户友好的操作系统（即，我可以运行 iTunes、大多数现代浏览器，并且不需要分配 50% 的时间在具有 unix 基础的笔记本电脑（如 linux）上维护它。由于我的大部分开发都是针对 Unix 系统的，这让生活变得更加富有成效。此外，这里的平台背后还有一个越来越活跃的开发社区。这些原因也适用于 Windows——而 cygwin 关闭了我对使用 unix 工具的一些要求——这与拥有真正的 unix 系统完全不同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-01T22:06:50.453

在使用 Eclipse 在 Windows 中进行 Java 开发之前，我已经取得了成功。听起来您也在询问部署/托管。无论哪种操作系统最适合运行您的应用程序，都不应真正预测您用于开发应用程序的操作系统。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-01T22:09:25.703

正如 pmiller 建议的那样，Windows 和 Eclipse 运行良好。我还可以推荐带有 Eclipse 或 IntelliJ IDEA 的 OS X（后者也适用于 Windows）。

我只在 Solaris 上做过最基本的 Java 开发（大学里基本数据结构的编程实践），所以恐怕我无法提供任何真正的比较。不过，由于缺乏适当的工具（我认为我只能使用 nedit 或其他工具），我确实发现在 Solaris 上非常痛苦。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-01T22:22:50.327

您必须考虑的一件事是您是否要开发可以在 Mac 上运行的应用程序。我喜欢 OS X，但好老 steve 确保我们总是落后于许多 JDK 版本。我们刚刚获得 Java 6。在 Mac 上开发至少可以确保您在尽可能低的 JDK 版本下工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-04T06:57:58.867

您的开发环境必须与生产环境相同。

没有与您的生产环境不同的“最佳开发环境”。运行您在生产和开发中运行的内容。

也就是说，这并不意味着您不能在例如另一个操作系统上运行您的 IDE，只要您仍然在与生产相同的系统上进行开发（例如，在另一台机器或 VM 上）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-26T17:40:05.607

窗户很好。

Solaris 也是一个很棒的 Java 开发环境（我比 Windows 更喜欢它，但出于主观原因），但除非你在上面进行部署，否则它可能不值得切换。

Linux 对于 Java 开发来说有点笨拙，但可行。

我唯一不能推荐的是 Mac，因为它们在可用的 Java 版本上总是落后很多（Sun 不提供，Apple 自己提供）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-09-04T20:56:24.403

我最好的建议是在您的目标平台上进行开发。这样，当您在开发测试和单元测试期间运行它时，您就知道它也可以在目标平台上运行，而不会出现任何令人讨厌的意外。

如果你面向所有平台，那么你可能真的想在 Mac 上开发，因为你会在 Mac 上得到最令人讨厌的惊喜。就 Java 而言，在 Windows 和 Unix 上，“它可以正常工作”，但在 Mac 上则不然。Sun 为除 Mac 之外的所有操作系统开发 Java 运行时 (JRE)。Apple 开发了自己的 JRE。

如果您在 Mac 上进行开发，您很可能会针对最小公分母进行开发，因此在 Mac 上运行的应该可以在其他平台上运行。这就是我的经验。

除此之外，我始终建议您根据操作系统是否运行您的软件来选择操作系统。选择运行 IDE 的操作系统以及用于开发和测试的其他工具。如果不止一个操作系统运行您需要的工具，请选择运行最好的那个。

# php - 上传文件最安全的方法是什么？

> ID：256172
> 
> 赞同：40
> 
> 时间：2008-11-01T22:00:30.933
> 
> 标签：php, security, file-upload

我工作的公司最近在我们托管的网站上遭受了许多标头注入和文件上传漏洞的打击，虽然我们已经解决了有关标头注入攻击的问题，但我们尚未控制上传漏洞。

我正在尝试设置一个即插即用型上传脚本系列以供内部使用，设计师可以将其复制到他们网站的结构中，修改一些变量，并在其上准备好上传表单他们的网站。我们希望尽可能地限制我们的暴露（我们已经关闭了 fopen 和 shell 命令）。

我在过去一个小时内搜索了该站点，发现许多不同的答案涉及依赖外部资源的特定方法。你们都认为什么是最好的纯脚本解决方案，它足够具体，可以用作可靠的保护方法？另外，如果可能的话，我想将语言限制为 PHP 或伪代码。

**编辑：**我找到了我的答案（发布在下面），虽然它确实使用了 shell 命令 exec()，但如果你阻止上传脚本文件（这个解决方案做得很好），你不会遇到任何问题。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2013-08-30T10:42:33.517

1.  **只允许授权用户上传文件。**您也可以添加验证码来阻止原始机器人。

2.  首先，**在`MAX_FILE_SIZE`您的上传表单中设置 ，并****在服务器上**设置**最大文件`size`和`count`**。

    ```
    ini_set('post_max_size', '40M'); //or bigger by multiple files
    ini_set('upload_max_filesize', '40M');
    ini_set('max_file_uploads', 10); 
    ```

    通过上传的文件进行大小检查：

    ```
    if ($fileInput['size'] > $sizeLimit)
        ; //handle size error here 
    ```

3.  您应该**使用`$_FILES`and[`move_uploaded_file()`](https://stackoverflow.com/questions/16276835/php-move-uploaded-file-why-is-it-important)**将您上传的文件放入正确的目录，或者如果您想处理它，请使用`is_uploaded_file()`. （这些函数的存在是为了防止由 .引起的*文件名注入*`register_globals`。）

    ```
    $uploadStoragePath = '/file_storage';
    $fileInput = $_FILES['image'];

    if ($fileInput['error'] != UPLOAD_ERR_OK)
        ; //handle upload error here, see http://php.net/manual/en/features.file-upload.errors.php

    //size check here

    $temporaryName = $fileInput['tmp_name'];
    $extension = pathinfo($fileInput['name'], PATHINFO_EXTENSION);

    //mime check, chmod, etc. here

    $name = bin2hex(mcrypt_create_iv(32, MCRYPT_DEV_URANDOM)); //true random id

    move_uploaded_file($temporaryName, $uploadStoragePath.'/'.$name.'.'.$extension); 
    ```

    始终**生成随机 id 而不是使用原始文件名**。

4.  为上传的文件创建一个**新的*子域****，例如[http://static.example.com](http://static.example.com)*或至少在 , 之外的一个新目录。`public_html`此*子域*或目录**不应执行任何文件**。将其设置在服务器配置中，或通过目录设置[在**`.htaccess`文件**](https://stackoverflow.com/questions/18932756/disable-all-cgi-php-perl-for-a-directory-using-htaccess)中。

    ```
     SetHandler none
        SetHandler default-handler
        Options -ExecCGI
        php_flag engine off 
    ```

    设置它[**为`chmod()`**](https://stackoverflow.com/questions/828172/how-do-i-secure-a-web-servers-image-upload-directory)好。

    ```
     $noExecMode = 0644;
        chmod($uploadedFile, $noExecMode); 
    ```

    也用于`chmod()`新上传的文件并将其设置在目录中。

5.  您应该**检查***黑客发送的***mime 类型。***您应该创建一个允许的*mime 类型的**白名单*。仅在不需要任何其他格式**时才允许使用图像。**任何其他格式都是安全威胁。图像也是如此，但至少我们有工具来处理它们……例如：图像文件中的 HTML*可能会导致具有**内容*[*嗅探*](https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff)[漏洞](https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff)的浏览器导致*XSS*。当损坏的内容是*PHP*代码时，它可以与*eval 注入*漏洞结合使用。 ******[](https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff)*******

     *****```
    $userContent = '../uploads/malicious.jpg';
    include('includes/'.$userContent); 
    ```

    尽量避免这种情况，例如使用 a`class autoloader`而不是手动包含 php 文件...
    通过首先处理*javascript 注入*，您必须**关闭浏览器中的*xss*和*内容嗅探***。*内容嗅探*问题是较旧的*msie*的典型问题，我认为其他浏览器可以很好地过滤它们。无论如何，您可以使用一堆标题来防止这些问题。（并非每个浏览器都完全支持，但这是您在客户端可以做的最好的事情。）

    ```
    Strict-Transport-Security: max-age={your-max-age}
    X-Content-Type-Options: nosniff
    X-Frame-Options: deny
    X-XSS-Protection: 1; mode=block
    Content-Security-Policy: {your-security-policy} 
    ```

    您可以使用 来检查文件是否损坏[`Imagick identify`](http://www.php.net/manual/en/imagick.identifyimage.php)，但这并不意味着完全保护。

    ```
    try {
        $uploadedImage = new Imagick($uploadedFile);
        $attributes = $uploadedImage->identifyImage();
        $format = $image->getImageFormat();
        var_dump($attributes, $format);
    } catch (ImagickException $exception) {
        //handle damaged or corrupted images
    } 
    ```

    如果你想为**其他*mime 类型*提供服务，你应该总是*强制***他们下载，永远不要*将*它们包含到网页中，除非你真的知道你在做什么......

    ```
    X-Download-Options: noopen
    Content-Disposition: attachment; filename=untrustedfile.html 
    ```***** 
*****   可以有有效的图像文件，其中包含代码，例如在*exif*数据中。所以你必须**从 images中****清除*exif***，如果它的内容对你不重要。您可以使用*`Imagick`*or来做到这一点*`GD`*，但它们都需要重新打包文件。您可以找到*`exiftool`*一个替代方案。我认为清除*exif的最简单方法是使用**GD*加载图像，[并将它们保存为最高质量的*PNG*](https://stackoverflow.com/questions/18531457/php-clear-png-metadata-but-keep-similar-quality)。所以图像不会损失质量，*exif*标签会被清除，因为*GD*无法处理它。也可以使用上传为*PNG*的图像来制作它...
    如果要提取*exif*数据，切勿使用`preg_replace()`if `pattern`or`replacement`来自用户，因为这将导致*eval 注入*...如有必要，请使用`preg_replace_callback()`而不是。`eval regex flag`（复制粘贴代码中的常见错误。） 如果您的网站存在*eval 注入*漏洞，例如，如果您在某处使用，则*Exif数据可能会成为问题。**`include($userInput)`*

    **   **`include()``require()`**如果您想控制访问，**永远不要使用****,****通过上传文件**，将它们作为静态或使用`file_get_contents()`or或任何其他文件读取功能。 它很少可用，但我认为将标头与[sendfile apache 模块](https://tn123.org/mod_xsendfile/)一起使用的最佳方法。通过标头，切勿使用未经验证或清理的用户输入，因为这将导致*HTTP 标头注入*。 如果您不需要*访问控制*（意味着：只有授权用户可以看到上传的文件），则使用您的网络服务器提供文件。它要快得多...`readfile()`
    `X-Sendfile: {filename}`

    ***   **使用杀毒软件**检查上传的文件（如果有的话）。

    *   Always **use a combined protection**, not just a single approach. It will be harder to breach your defenses...******* 

 ****** * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-11-01T23:53:04.530

恕我直言，最好的解决方案是将包含上传文件的目录放在“网络”环境之外，并使用脚本使它们可下载。这样，即使有人上传了脚本，也无法通过浏览器调用来执行，也不必检查上传文件的类型。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-01T22:59:52.140

使用和配置[Hardened-PHP使用](http://www.hardened-php.net/suhosin/a_feature_list.html)[move_uploaded_file](http://www.php.net/move_uploaded_file)和[$_FILES superglobal](http://es.php.net/features.file-upload)创建一个纯脚本。脚本越简单，就越安全（至少，与正在运行的 PHP 版本本身一样安全）

# asp.net - 如何从文本框中读取文本并使其中一些成为链接？

> ID：256183
> 
> 赞同：1
> 
> 时间：2008-11-01T22:11:04.000
> 
> 标签：asp.net, javascript, jquery

我将用一个例子来说明问题。

文本框中有一些文本，例如：

你好！这是一个示例 [lnk]文本[/lnk]

当我按下提交按钮并发布此文本时，[lnk] 和 [/lnk] 标记中的单词必须是这样的链接 www.mysite.com?link=text。

如何使用 javascript 或 jquery 轻松实现？

注意：我对 javascript 不太了解。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-01T22:26:18.370

这将为您执行 javascript - 不确定您是否需要为 asp.net 做任何特别的事情

```
<form onsubmit="return doLinks(this.elements['links']);">
<textarea name="links" rows="20" cols="80"></textarea>
<input type="submit">
</form>

<script type="text/javascript">

function doLinks(elm)
{
    var matches = elm.value.match(/\[link\](.*?)\[\/link\]/gi);
    for (var i = 0; i < matches.length; i++)
    {
        var url = 'http://www.mysite.com/?link=' + encodeURIComponent(matches[i].substring(6, matches[i].length - 7));
        elm.value = elm.value.replace(matches[i], url);
    }

    return true;
}

</script> 
```

# c++ - 线程第一次创建时消耗多少内存？

> ID：256188
> 
> 赞同：8
> 
> 时间：2008-11-01T22:15:34.070
> 
> 标签：c++, multithreading, winapi

我知道在应用程序中创建太多线程并不是您可能称之为其他正在运行的进程的“好邻居”，因为即使这些线程处于有效的睡眠状态，也会消耗 CPU 和内存资源。

我感兴趣的是：**一个睡眠线程正在消耗多少内存（win32平台）？**

从理论上讲，我假设在 1mb 左右（因为这是默认的堆栈大小），但我很确定它小于这个，但我不确定为什么。

对此的任何帮助将不胜感激。

（*我问的原因是我正在考虑引入一个线程池，我想了解通过创建 5 个线程池可以节省多少内存，与 20 个手动创建的线程相比*）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-01T23:23:13.170

我有一个线程使用量很大的服务器应用程序，它使用由客户设置的可配置线程池，并且在至少一个站点中它有 1000 多个线程，启动时它只使用 50 MB。原因是Windows*保留*1MB 用于堆栈（它映射其地址空间），但不一定分配在物理内存中，只是其中的一小部分。如果堆栈增长超过该值，则会生成页面错误并分配更多物理内存。我不知道初始分配是什么，但我假设它等于系统的页面粒度（通常为 64 KB）。当然，线程在创建时也会使用更多的内存来做其他事情（TLS、TSS 等），但我猜测总内存约为 200 KB。请记住，任何不经常使用的内存都会被虚拟内存管理器卸载。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-02T09:42:29.127

添加到 Fabios 评论：

记忆是你的第二个问题，而不是你的第一个问题。线程池的目的通常是限制想要并发运行的线程之间的上下文切换开销，理想情况下限制在可用的 CPU 内核数上。

上下文切换非常昂贵，通常引用几千到 10,000+ 个 CPU 周期。

在 WinXP（32 位）上进行的一个小测试以每个线程（创建 999 个线程）大约**15k 私有字节计入时钟。**这是初始提交的堆栈大小，加上操作系统管理的任何其他数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T07:34:41.990

如果您使用 Vista 或 Win2k8，只需使用本机 Win32 线程池 API。让它弄清楚尺寸。我还会考虑将工作负载类型（例如 CPU 密集型与磁盘 I/O）划分到不同的池中。

> MSDN 线程池 API 文档
> 
> [http://msdn.microsoft.com/en-us/library/ms686766(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686766(VS.85).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T22:30:13.010

我认为您很难检测到对工作代码进行这种更改的任何影响——从 20 个线程减少到 5 个。然后增加管理线程池的复杂性（和开销）。也许值得在嵌入式系统上考虑，但是 Win32 呢？

您可以将堆栈大小设置为您想要的任何值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-01T23:22:53.280

这在很大程度上取决于系统：

但通常，每个进程都是独立的。通常，系统调度程序会确保每个**进程**都能平等地访问可用处理器。因此，多线程应用程序时间在可用线程之间多路复用。

分配给线程的内存将影响进程可用的内存，但不会影响其他进程可用的内存。一个好的操作系统会分页出未使用的堆栈空间，因此它不在物理内存中。尽管如果您的线程在运行时分配了足够的内存，那么您可能会在每个处理器的内存被分页到/从辅助设备时导致抖动。

我怀疑睡眠线程对系统有任何（非常小的）影响。

*   它没有使用任何 CPU
*   它正在使用的任何内存都可以调出到辅助设备。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-02T09:02:23.593

我想这可以很容易地测量出来。

1.  创建线程前获取系统使用的资源量
2.  创建具有默认系统值的线程（默认堆大小和其他）
3.  创建线程后获取资源量并有所作为（与步骤1）。

请注意，某些线程需要指定与默认值不同的值。

您可以尝试通过创建不同数量的线程来找到平均内存使用量（步骤 2）。

操作系统在创建线程时分配的内存由线程本地数据组成：[TCB](http://en.wikipedia.org/wiki/Task_Control_Block) [TLS](http://en.wikipedia.org/wiki/Thread-local_storage) ...

来自[维基百科](http://en.wikipedia.org/wiki/Thread_(computer_science))：“线程不拥有除了堆栈、包括程序计数器在内的寄存器副本和线程本地存储（如果有）之外的资源。”

# javascript - jQuery $(document).ready 和 UpdatePanels？

> ID：256195
> 
> 赞同：482
> 
> 时间：2008-11-01T22:24:34.973
> 
> 标签：javascript, jquery, asp.net, asp.net-ajax, jquery-events

我正在使用 jQuery 为 UpdatePanel 内的元素连接一些鼠标悬停效果。事件绑定在`$(document).ready`. 例如：

```
$(function() {    
    $('div._Foo').bind("mouseover", function(e) {
        // Do something exciting
    });    
}); 
```

当然，这在第一次加载页面时可以正常工作，但是当 UpdatePanel 进行部分页面更新时，它不会运行，并且鼠标悬停效果在 UpdatePanel 内不再起作用。

不仅在第一页加载时，而且每次 UpdatePanel 触发部分页面更新时，在 jQuery 中连接东西的推荐方法是什么？我应该使用 ASP.NET ajax 生命周期而不是`$(document).ready`?

* * *

## 回答 #1

> 赞同：553
> 
> 时间：2008-11-01T23:35:28.510

UpdatePanel 在更新时完全替换更新面板的内容。这意味着您订阅的那些事件不再被订阅，因为该更新面板中有新元素。

我为解决此问题所做的工作是在每次更新后重新订阅我需要的事件。我`$(document).ready()`用于初始加载，然后使用 Microsoft [`PageRequestManager`](https://docs.microsoft.com/en-us/previous-versions/bb311028%28v%3dvs.140%29)（如果您的页面上有更新面板，则可用）重新订阅每个更新。

```
$(document).ready(function() {
    // bind your jQuery events here initially
});

var prm = Sys.WebForms.PageRequestManager.getInstance();

prm.add_endRequest(function() {
    // re-bind your jQuery events here
}); 
```

这`PageRequestManager`是一个 javascript 对象，如果页面上有更新面板，它会自动可用。只要 UpdatePanel 在页面上，您就不需要执行上述代码以外的任何操作来使用它。

如果您需要更详细的控制，此事件传递的参数类似于 .NET 事件传递参数的方式`(sender, eventArgs)`，因此您可以查看引发事件的原因并仅在需要时重新绑定。

以下是 Microsoft 文档的最新版本：[msdn.microsoft.com/.../bb383810.aspx](http://msdn.microsoft.com/en-us/library/bb383810.aspx)

* * *

根据您的需要，您可能拥有的更好的选择是使用 jQuery 的[`.on()`](http://api.jquery.com/on/). 这些方法比在每次更新时重新订阅 DOM 元素更有效。但是，在使用此方法之前请阅读所有文档，因为它可能会也可能不会满足您的需求。有很多 jQuery 插件使用`.delegate()`or重构是不合理的`.on()`，所以在这些情况下，你最好重新订阅。

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2009-01-14T13:51:45.007

```
<script type="text/javascript">

        function BindEvents() {
            $(document).ready(function() {
                $(".tr-base").mouseover(function() {
                    $(this).toggleClass("trHover");
                }).mouseout(function() {
                    $(this).removeClass("trHover");
                });
         }
</script> 
```

将要更新的区域。

```
<asp:UpdatePanel...
<ContentTemplate
     <script type="text/javascript">
                    Sys.Application.add_load(BindEvents);
     </script>
 *// Staff*
</ContentTemplate>
    </asp:UpdatePanel> 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2010-05-26T19:53:23.293

**在 UpdatePanel 中使用 jQuery 进行用户控制**

这不是问题的直接答案，但我确实通过阅读我在这里找到的答案将这个解决方案放在一起，我认为有人可能会觉得它有用。

我试图在用户控件中使用 jQuery textarea 限制器。这很棘手，因为用户控件在 UpdatePanel 内运行，并且在回调中丢失了它的绑定。

如果这只是一个页面，那么这里的答案将直接适用。但是，用户控件不能直接访问 head 标签，也不能像某些答案所假设的那样直接访问 UpdatePanel。

我最终把这个脚本块放在我的用户控件标记的顶部。对于初始绑定，它使用 $(document).ready，然后从那里使用 prm.add_endRequest：

```
<script type="text/javascript">
    function BindControlEvents() {
        //jQuery is wrapped in BindEvents function so it can be re-bound after each callback.
        //Your code would replace the following line:
            $('#<%= TextProtocolDrugInstructions.ClientID %>').limit('100', '#charsLeft_Instructions');            
    }

    //Initial bind
    $(document).ready(function () {
        BindControlEvents();
    });

    //Re-bind for callbacks
    var prm = Sys.WebForms.PageRequestManager.getInstance(); 

    prm.add_endRequest(function() { 
        BindControlEvents();
    }); 

</script> 
```

所以...只是想有人可能想知道这行得通。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-02-06T00:54:52.633

升级到 jQuery 1.3 并使用：

```
$(function() {

    $('div._Foo').live("mouseover", function(e) {
        // Do something exciting
    });

}); 
```

注意：live 适用于大多数活动，但不是全部。[文档](http://docs.jquery.com/Events/live#typefn)中有完整的列表。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-12-31T10:51:51.293

你也可以试试：

```
<asp:UpdatePanel runat="server" ID="myUpdatePanel">
    <ContentTemplate>

        <script type="text/javascript" language="javascript">
        function pageLoad() {
           $('div._Foo').bind("mouseover", function(e) {
               // Do something exciting
           });
        }
        </script>

    </ContentTemplate>
</asp:UpdatePanel> 
```

，因为 pageLoad() 是一个 ASP.NET ajax 事件，每次在客户端加载页面时都会执行该事件。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2011-02-28T18:01:41.987

我的答案？

```
function pageLoad() {

  $(document).ready(function(){ 
```

等等

像魅力一样工作，许多其他解决方案都惨遭失败。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-11-01T22:39:23.320

我会使用以下方法之一：

1.  将事件绑定封装在一个函数中，并在每次更新页面时运行它。您始终可以包含与特定元素的事件绑定，以免将事件多次绑定到相同的元素。

2.  使用[livequery](http://docs.jquery.com/Plugins/livequery)插件，它基本上会自动为您执行方法一。您的偏好可能会有所不同，具体取决于您希望对事件绑定进行控制的程度。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-06-26T11:14:55.993

这对我有用：

```
$(document).ready(function() {

    // Do something exciting

    var prm = Sys.WebForms.PageRequestManager.getInstance();

    prm.add_endRequest(function() {
        // re-bind your jQuery events here
    });

}); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-06-17T15:17:10.883

在这种情况下使用函数 pageLoad() 是非常危险的。您可能会多次连接事件。我也会远离 .live() 因为它附加到文档元素并且必须遍历整个页面（缓慢而糟糕）。

到目前为止，我看到的最好的解决方案是在更新面板外部的包装器上使用 jQuery .delegate() 函数并利用冒泡。除此之外，您始终可以使用 Microsoft 的 Ajax 库来连接处理程序，该库旨在与 UpdatePanels 一起使用。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-07-16T05:06:05.107

当`$(document).ready(function (){...})`页面发布后不起作用时，请在 Asp.page 中使用 JavaScript 函数 pageLoad，如下所示：

```
<script type="text/javascript" language="javascript">
function pageLoad() {
// Initialization code here, meant to run once. 
}
</script> 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-03T12:36:02.787

我遇到了类似的问题，发现最有效的方法是依靠事件冒泡和事件委托来处理它。事件委托的好处是一旦设置，您不必在 AJAX 更新后重新绑定事件。

我在代码中所做的是在更新面板的父元素上设置一个委托。此父元素不会在更新时被替换，因此事件绑定不受影响。

有许多优秀的文章和插件可以在 jQuery 中处理事件委托，并且该功能可能会融入 1.3 版本。我用作参考的文章/插件是：

[http://www.danwebb.net/2008/2/8/event-delegation-made-easy-in-jquery](http://www.danwebb.net/2008/2/8/event-delegation-made-easy-in-jquery)

一旦你了解它发生了什么，我想你会发现这是一个更优雅的解决方案，它比每次更新后记住重新绑定事件更可靠。这还有一个额外的好处，即在页面卸载时为您提供一个取消绑定的事件。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-11-03T16:28:13.910

FWIW，我在使用 mootools 时遇到了类似的问题。重新附加我的事件是正确的举动，但需要在请求结束时完成..eg

```
var prm = Sys.WebForms.PageRequestManager.getInstance();
prm.add_endRequest(function() {... 
```

如果 beginRequest 导致您获得空引用 JS 异常，请记住一些事情。

干杯

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2011-03-16T19:20:42.633

这是一个与更新面板一起使用的很棒的插件：

[http://updatepanelplugin.codeplex.com/](http://updatepanelplugin.codeplex.com/)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2014-07-23T02:18:38.507

```
pageLoad = function () {
    $('#div').unbind();
    //jquery here
} 
```

pageLoad 函数非常适合这种情况，因为它在初始页面加载和每个 updatepanel 异步回发时运行。我只需要添加 unbind 方法来使 jquery 在 updatepanel 回发上工作。

[http://encosia.com/document-ready-and-pageload-are-not-the-same/](http://encosia.com/document-ready-and-pageload-are-not-the-same/)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-11-27T16:26:38.753

我的回答是基于上面所有专家的评论，但下面是任何人都可以使用的以下代码，以确保在每次回发和每次异步回发时 JavaScript 代码仍将被执行。

**就我而言，我在页面中有一个用户控件。只需将以下代码粘贴到您的用户控件中。**

```
<script type="text/javascript"> 
        var prm = Sys.WebForms.PageRequestManager.getInstance();
    prm.add_endRequest(EndRequestHandler);
    function EndRequestHandler(sender, args) {
        if (args.get_error() == undefined) {
            UPDATEPANELFUNCTION();
        }                   
    }

    function UPDATEPANELFUNCTION() {
        jQuery(document).ready(function ($) {
            /* Insert all your jQuery events and function calls */
        });
    }

    UPDATEPANELFUNCTION(); 

</script> 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-07-21T12:05:48.497

每次加载后，更新面板总是用其内置的 Scriptmanager 脚本替换您的 Jquery。如果你像这样使用 pageRequestManager 的实例方法会更好......

```
Sys.WebForms.PageRequestManager.getInstance().add_endRequest(onEndRequest)
    function onEndRequest(sender, args) {
       // your jquery code here
      }); 
```

它会正常工作...

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-06-20T07:47:51.897

使用下面的脚本并相应地更改脚本的主体。

```
 <script>
        //Re-Create for on page postbacks
        var prm = Sys.WebForms.PageRequestManager.getInstance();
        prm.add_endRequest(function () {
           //your codes here!
        });
    </script> 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-06-04T21:10:54.580

回应布赖恩麦凯的回答：

我通过 ScriptManager 将 JavaScript 注入我的页面，而不是将其直接放入 UserControl 的 HTML 中。就我而言，我需要滚动到在 UpdatePanel 完成并返回后可见的表单。这在文件后面的代码中。在我的示例中，我已经在主内容页面上创建了**prm变量。**

```
private void ShowForm(bool pShowForm) {
    //other code here...
    if (pShowForm) {
        FocusOnControl(GetFocusOnFormScript(yourControl.ClientID), yourControl.ClientID);
    }
}

private void FocusOnControl(string pScript, string pControlId) {
    ScriptManager.RegisterStartupScript(this.Page, this.Page.GetType(), "focusControl_" + pControlId, pScript, true);
}

/// <summary>
/// Scrolls to the form that is made visible
/// </summary>
/// <param name="pControlId">The ClientID of the control to focus on after the form is made visible</param>
/// <returns></returns>
private string GetFocusOnFormScript(string pControlId) {
    string script = @"
    function FocusOnForm() {
        var scrollToForm = $('#" + pControlId + @"').offset().top;
        $('html, body').animate({ 
            scrollTop: scrollToForm}, 
            'slow'
        );
        /* This removes the event from the PageRequestManager immediately after the desired functionality is completed so that multiple events are not added */
        prm.remove_endRequest(ScrollFocusToFormCaller);
    }
    prm.add_endRequest(ScrollFocusToFormCaller);
    function ScrollFocusToFormCaller(sender, args) {
        if (args.get_error() == undefined) {
            FocusOnForm();
        }
    }";
    return script;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-12-18T22:25:06.733

```
Sys.Application.add_load(LoadHandler); //This load handler solved update panel did not bind control after partial postback
function LoadHandler() {
        $(document).ready(function () {
        //rebind any events here for controls under update panel
        });
} 
```

# vim - 在不退出 VIM 应用程序的情况下关闭文件？

> ID：256204
> 
> 赞同：276
> 
> 时间：2008-11-01T22:35:04.483
> 
> 标签：vim

我使用`:e`and`:w`命令来编辑和写入文件。我不确定是否有“关闭”命令可以在不离开 Vim 的情况下关闭当前文件？

我知道这个`:q`命令可以用来关闭一个文件，但是如果它是最后一个文件，Vim 也会被关闭；实际上在 Mac OS MacVim 确实退出了。只有 Vim 窗口关闭，我可以使用`Control`-`N`再次打开一个空白的 Vim 窗口。我希望 Vim 在空白屏幕上保持打开状态。

* * *

## 回答 #1

> 赞同：371
> 
> 时间：2008-11-01T22:37:59.640

这将删除缓冲区（转换为关闭文件）

```
:bd 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2010-12-02T11:13:34.630

如前所述，您正在寻找`:bd`，但这并没有完全删除缓冲区，它仍然可以访问：

```
:e foo
:e bar
:buffers
  1 #h   "foo"                          line 1
  2 %a   "bar"                          line 1
Press ENTER or type command to continue
:bd 2
:buffers
  1 %a   "foo"                          line 1
Press ENTER or type command to continue
:b 2
2   bar 
```

您可能想要`:bw`完全删除它。

```
:bw 2
:b 2 
E86: Buffer 2 does not exist 
```

不知道`:bw`困扰了我很长一段时间。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-11-14T13:41:08.857

如果你的 Vim 窗口中有多个拆分窗口，则`:bd`关闭当前文件的拆分窗口，所以我喜欢使用更高级的东西：

```
map fc <Esc>:call CleanClose(1)

map fq <Esc>:call CleanClose(0)

function! CleanClose(tosave)
if (a:tosave == 1)
    w!
endif
let todelbufNr = bufnr("%")
let newbufNr = bufnr("#")
if ((newbufNr != -1) && (newbufNr != todelbufNr) && buflisted(newbufNr))
    exe "b".newbufNr
else
    bnext
endif

if (bufnr("%") == todelbufNr)
    new
endif
exe "bd".todelbufNr
endfunction 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-01T22:39:16.173

```
:[N]bd[elete][!] *:bd* *:bdel* *:bdelete* *E516*
:bd[elete][!] [N]
                卸载缓冲区 [N]（默认值：当前缓冲区）并将其从
                缓冲区列表。如果缓冲区已更改，则会失败，
                除非指定了 [!]，否则更改将丢失。
                该文件不受影响。此缓冲区的任何窗口都是
                关闭。如果缓冲区 [N] 是当前缓冲区，则另一个缓冲区
                将改为显示。这是最近的条目
                指向已加载缓冲区的跳转列表。
                实际上，缓冲区并没有完全删除，而是被删除了
                来自缓冲区列表 |unlisted-buffer| 和选项值，
                缓冲区的变量和映射/缩写是
                清除。
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-01T22:37:33.777

如果您已经保存了最后一个文件，那么`:enew`就是您的朋友（`:enew!`如果您不想保存最后一个文件）。请注意，原始文件仍将在您的缓冲区列表中（通过 访问的那个`:ls`）。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-11-07T00:10:44.690

如果你*修改*了一个文件并想在不退出 Vim 和保存的情况下关闭它，你应该输入`:bd!`.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-03-27T21:40:29.627

`:bd`可以映射。我将它映射到`F4`, `Shift`-`F4`如果我因为一些我不再想要的更改而需要强制关闭。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-09-21T13:03:17.973

bufkill.vim[插件](http://www.vim.org/scripts/script.php?script_id=1147)添加`BD`等，以删除缓冲区而不关闭任何拆分（如`bd`）将单独。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-08-31T14:40:36.490

在您的 .vimrc 文件中插入以下内容，然后按`F4`，它将关闭当前文件。

```
:map <F4> :bd<CR> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-07T10:27:34.517

查看[Butane 插件](https://github.com/Soares/butane.vim)以在关闭缓冲区时保持窗口布局。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2014-10-27T21:37:17.120

我有同样的问题，所以我做了插件。这个插件替换 :q 和其他命令然后防止窗口关闭。

如果您仍然有问题，请尝试使用以下插件。 [https://github.com/taka-vagyok/prevent-win-closed.vim](https://github.com/taka-vagyok/prevent-win-closed.vim)

# .net - 高延迟/低带宽环境中的浏览器应用

> ID：256215
> 
> 赞同：1
> 
> 时间：2008-11-01T22:44:46.320
> 
> 标签：.net, ajax

我们有一个典型的业务应用程序，它带有一个看起来像 Outlook 的 Winforms 客户端，它与 asmx webservices 通信。我们希望在我们的 Intranet 上提供部分功能，但我们需要接触的新用户——所有这些用户——都在发展中国家，具有拨号类型的带宽和大量的延迟。他们都使用IE 6。

因此，我们需要将往返次数以及传输的数据量保持在绝对最小值。我们正在考虑一个具有单个 url 的站点，通过 AJAX 调用与我们现有的后端进行所有交互。基本上是一个保持大量状态的胖客户端，只是偶尔发出一个 http 请求来修改或获取数据。为每个用户单击发出两打请求的典型 Web 应用程序对我们不起作用。

这种方法听起来合理吗？如果您遇到此类问题，您会推荐哪些 JavaScript 框架或库？我们使用 TIBCO GI 进行原型设计，但 XML 操作很痛苦，而且我们无法在浏览器中获得所需的性能。接下来我们可能会看看 YUI，可能有我们现有的 asmx 的服务 JSON。

感谢任何建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-01T23:25:24.273

我能想到的几件事

**往返**

就像你说的越少越好，为了最适合浏览器客户端，最好是从浏览器应用程序的用例中设计界面，为界面返回现成的数据，没有其他开销。这与您当前为桌面应用程序提供的内容会有些不同，因为状态不像胖客户端那样容易。

**运输**

在 Web 服务器上启用压缩。

**API**

尽可能使用 REST api，因为一些静态数据可以被浏览器缓存，并且大小比将请求的序列化形式放在正文中要小

**编码**

对于浏览器应用，JSON 比 XML 要好得多，而且大小也比 XML 小。

**框架**

你也可以看看 JQuery 或原型 最近的 GWT 也非常适合使用 AJAX 构建 weblication，它将 java 代码转换为具有国际化功能的 javascript 等。它也使调试变得更加容易。

对于 Web 服务，值得再看一下 WCF RESTful 服务，您应该能够在将框架迁移到 WCF 的同时利用现有的业务逻辑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T13:00:32.397

正如 CodeMelt 所说，这一切都是为了减少往返行程。这里还有一些方法：

确保您的第一个页面加载包含尽可能多的信息。在第一次构建应用程序时，页面经常会立即通过 Ajax 调用从服务器请求更多状态。通过在页面上包含信息，可以避免您对服务器的第一次请求。

如果您有很多图形，请考虑使用[css sprites](http://www.alistapart.com/articles/sprites/)来减少往返获取图像的次数。

非规范化。构建应用程序的逻辑方法可能是使用几个不同的 Ajax 调用来从服务器获取不同的状态。组合它们以返回更大的 JSON 结构。

使用[YSlow](http://developer.yahoo.com/yslow/)和 Firebug 来查看你的页面到底在做什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T13:19:58.457

这里有一些想法：

*   如果 MSIE 支持它，请使用某种方式将静态（不变）文件放入单个存档文件 - Mozilla 支持为此使用 .jar 文件。
*   如果您不能将所有资源放入 .jar 或类似文件中，请使用 Javascript 预加载它们（如果有帮助的话）。
*   确保静态文件具有适当的 Last-modified: 和 Expires: 用于客户端缓存的标头。确保“无缓存”标头等不会出现在静态资源上。
*   如果您使用 XHR 请求通过 GET 方法获取信息（这是一个好主意），请确保 THOSE 请求具有适当的 Last-modified: 和 Expires: 标头 - 也可以从客户端缓存中提供 AJAX 请求。
*   如果您特别使用 HTTPS，请启用 HTTP keepalives 并使用较长的超时时间 - 这将占用服务器上的更多资源，但客户端上用于建立连接和进行 HTTPS 握手的资源会更少
*   除非需要，否则不要使用 HTTPS。

# c - 在 C 中打印 char[] 的一部分的最简单方法

> ID：256218
> 
> 赞同：32
> 
> 时间：2008-11-01T22:59:45.573
> 
> 标签：c, string-formatting

假设我有一个`char* str = "0123456789"`，我想剪掉第一个和最后三个字母，只打印中间，最简单、最安全的方法是什么？

现在的诀窍：要剪切的部分和要打印的部分大小不同，所以我可以有一个很长的 char* 或一个非常小的字符。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-11-01T23:03:22.147

您可以使用`printf()`, 和一个特殊的格式字符串：

```
char *str = "0123456789";
printf("%.6s\n", str + 1); 
```

转换说明符中的精度`%s`指定要打印的最大字符数。您也可以使用变量来指定运行时的精度：

```
int length = 6;
char *str = "0123456789";    
printf("%.*s\n", length, str + 1); 
```

在此示例中， * 用于指示下一个参数 ( `length`) 将包含`%s`转换的精度，相应的参数必须是`int`。

指针算法可用于指定起始位置，就像我在上面所做的那样。

**[编辑]**

还有一点，如果您的字符串比您的精度说明符短，将打印更少的字符，例如：

```
int length = 10;
char *str = "0123456789";
printf("%.*s\n", length, str + 5); 
```

将打印“ `56789`”。如果您总是想打印一定数量的字符，请同时指定最小字段宽度和精度：

```
printf("%10.10s\n", str + 5); 
```

或者

```
printf("%*.*s\n", length, length, str + 5); 
```

这将打印：

```
"     56789" 
```

您可以使用减号将字段中的输出左对齐：

```
printf("%-10.10s\n", str + 5); 
```

最后，最小字段宽度和精度可以不同，即

```
printf("%8.5s\n", str); 
```

将在 8 个字符的字段中打印最多 5 个右对齐字符。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-01T23:16:15.913

罗伯特甘布尔和史蒂夫分别拥有大部分作品。组装成一个整体：

```
void print_substring(const char *str, int skip, int tail)
{
    int len = strlen(str);
    assert(skip >= 0);
    assert(tail >= 0 && tail < len);
    assert(len > skip + tail);
    printf("%.*s", len - skip - tail, str + skip);
} 
```

调用示例：

```
print_substring("0123456789", 1, 3); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-01T23:03:41.197

如果你不介意修改数据，你可以做一些指针运算。这是假设 str 是 char 指针而不是数组：

```
char string[] = "0123456789";
char *str = string;

str += 3; // "removes" the first 3 items
str[4] = '\0'; // sets the 5th item to NULL, effectively truncating the string

printf(str); // prints "3456" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T01:32:49.817

这是我从我的个人库中挖出的一个干净简单的子字符串函数，它可能有用：

```
char *
substr(const char *src, size_t start, size_t len)
{
  char *dest = malloc(len+1);
  if (dest) {
    memcpy(dest, src+start, len);
    dest[len] = '\0';
  }
  return dest;
} 
```

它可能是不言自明的，但它需要一个字符串、一个起始位置（从零开始）和一个长度，如果 malloc 失败，则返回原始字符串的子字符串或空指针。`free`当不再需要内存时，调用者可以 'd 调用返回的指针。本着 C 的精神，该函数不验证提供的起始位置和长度。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-01T23:05:12.177

我相信你可以用 printf 做一些魔法，它只会打印一定数量的字符，但它并不被普遍理解或使用。我们试图在以前的工作中做到这一点，但无法使其始终如一地工作。

我要做的是保存一个字符，将字符串中的该字符设为空，打印它，然后将其保存回来。

# c++ - 在主要 C/C++ 编译器生成的代码中注册分配规则

> ID：256220
> 
> 赞同：4
> 
> 时间：2008-11-01T23:00:06.007
> 
> 标签：c++, c, assembly, compiler-construction, cpu-registers

我记得以前的一些规则（32 位之前的英特尔处理器），当时（至少对我而言）非常频繁地必须分析 C/C++ 编译器（在我的情况下，当时是 Borland/Turbo）生成的汇编输出找到性能瓶颈，并安全地将汇编程序与 C/C++ 代码混合。诸如将 SI 寄存器用于*this*指针、将 AX 用于返回值、在汇编例程返回时应保留哪些寄存器等。

现在我想知道是否有更流行的 C/C++ 编译器（Visual C++、GCC、Intel ...）和处理器（Intel、ARM、...）的参考，如果没有，在哪里可以找到要创建的部分一。想法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-01T23:43:41.117

您正在询问“应用程序二进制接口”（ABI）和调用约定。这些通常由操作系统和库设置，并由编译器和链接器强制执行。谷歌为“ABI”或“调用约定”。[来自Wikipedia](http://en.wikipedia.org/wiki/Calling_convention)和[Debian for ARM 的](http://wiki.debian.org/ArmEabiPort)一些起点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-07T21:35:06.137

Agner Fog 的“调用约定”文档总结了 Windows 和 Linux 64 位和 32 位 ABI 等内容：[http](http://www.agner.org/optimize/calling_conventions.pdf) ://www.agner.org/optimize/calling_conventions.pdf 。请参阅第 10 页上的表 4，了解寄存器使用的摘要。

来自个人经验的一个警告：不要将关于 ABI 的假设嵌入到内联汇编中。如果您在内联汇编中编写一个函数，假设返回和/或参数在特定寄存器（例如eax、rdi、rsi）中传输，那么如果/当编译器内联该函数时，它将中断。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T10:05:44.447

Open Watcom C/C++ 编译器支持两种调用约定，基于寄存器（默认）和基于堆栈（非常接近其他编译器使用的）。此编译器的用户指南对它们都进行了描述，并且与编译器[本身](http://openwatcom.org/index.php/Download)一起可[在线](http://www.openwatcom.org/ftp/manuals/1.5/cguide.pdf)免费获得。您可能会发现用户指南中的这些主题特别有用：

*   10.4.1 使用基于寄存器的调用约定传递参数
*   10.4.6 使用基于堆栈的调用约定
*   10.5 基于 80x87 的应用程序的调用约定

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T23:47:08.003

好吧，今天如果打开优化，就没有了。但是 GCC 允许你声明你的汇编指令应该使用特定的变量，无论它是否在寄存器中，或者甚至强制 GCC tu 将该变量放入可与你的指令一起使用的寄存器中。您还可以声明哪些注册您的内联汇编块为自己保留（因此如果需要，编译器应该在您的内联块周围生成适当的保存/恢复代码）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T00:11:51.260

我相信但绝不肯定 GCC 使用[Itanium ABI](http://www.codesourcery.com/public/cxx-abi/abi.html#acknowledgements)来完成其大部分功能。它和它使用的 ABI 之间的不兼容性被[记录在案](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/C_002b_002b-Dialect-Options.html#C_002b_002b-Dialect-Options)。

# python - 对于 Python 中的错误/非法参数组合，我应该提出哪个异常？

> ID：256222
> 
> 赞同：708
> 
> 时间：2008-11-01T23:02:36.767
> 
> 标签：python, exception, arguments

我想知道在 Python 中指示无效参数组合的最佳实践。我遇到过一些你有这样的功能的情况：

```
def import_to_orm(name, save=False, recurse=False):
    """
    :param name: Name of some external entity to import.
    :param save: Save the ORM object before returning.
    :param recurse: Attempt to import associated objects as well. Because you
        need the original object to have a key to relate to, save must be
        `True` for recurse to be `True`.
    :raise BadValueError: If `recurse and not save`.
    :return: The ORM object.
    """
    pass 
```

唯一的烦恼是每个包都有自己的，通常略有不同`BadValueError`。我知道在 Java 中存在`java.lang.IllegalArgumentException`- 是否每个人都将在 Python 中创建自己的`BadValueError`s 或者是否有另一种首选方法？

* * *

## 回答 #1

> 赞同：785
> 
> 时间：2008-11-01T23:37:31.643

我只会提出[ValueError](https://docs.python.org/3/library/exceptions.html#ValueError)，除非您需要更具体的例外..

```
def import_to_orm(name, save=False, recurse=False):
    if recurse and not save:
        raise ValueError("save must be True if recurse is True") 
```

这样做真的没有意义`class BadValueError(ValueError):pass`- 您的自定义类在使用上与[ValueError](https://docs.python.org/3/library/exceptions.html#ValueError)相同，那么为什么不使用它呢？

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2008-11-01T23:17:49.250

我会继承自`ValueError`

```
class IllegalArgumentError(ValueError):
    pass 
```

有时最好创建自己的异常，但从内置异常继承，它尽可能接近您想要的。

如果您需要捕获该特定错误，那么拥有一个名称会很有帮助。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2018-08-01T16:17:55.077

我认为处理这个问题的最好方法是 python 本身处理它的方式。Python 引发类型错误。例如：

```
$ python -c 'print(sum())'
Traceback (most recent call last):
File "<string>", line 1, in <module>
TypeError: sum expected at least 1 arguments, got 0 
```

我们的初级开发人员刚刚在谷歌搜索“python 异常错误参数”中找到了这个页面，我很惊讶自从提出这个问题以来的十年里从未提出过明显的（对我而言）答案。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2019-06-25T08:47:13.453

这取决于论点的问题所在。

如果参数的类型错误，则引发 TypeError。例如，当您获得一个字符串而不是其中一个布尔值时。

```
if not isinstance(save, bool):
    raise TypeError(f"Argument save must be of type bool, not {type(save)}") 
```

但是请注意，在 Python 中我们很少进行这样的检查。如果参数真的无效，一些更深层次的函数可能会为我们抱怨。如果我们只检查布尔值，也许一些代码用户稍后会只给它一个字符串，知道非空字符串总是 True。这可能会为他节省一个演员。

如果参数具有无效值，则引发 ValueError。这似乎更适合您的情况：

```
if recurse and not save:
    raise ValueError("If recurse is True, save should be True too") 
```

或者在这种特定情况下，递归的 True 值意味着 Save 的 True 值。由于我认为这是从错误中恢复，因此您可能还想在日志中抱怨。

```
if recurse and not save:
    logging.warning("Bad arguments in import_to_orm() - if recurse is True, so should save be")
    save = True 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-11-01T23:17:40.717

我大多只是看到`ValueError`在这种情况下使用的内置函数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2021-08-11T18:20:58.567

在这种情况下，您很可能会使用`ValueError`( `raise ValueError()`in full) ，但这取决于错误值的类型。例如，如果您创建了一个只允许字符串的函数，而用户输入了一个整数，那么您会`TypeError`改为。如果用户输入了错误的输入（意味着它具有正确的类型但不符合某些条件）a`Value Error`将是您的最佳选择。`Value`Error 也可用于阻止程序发生其他异常，例如，您可以使用 a`ValueError`来停止引发 a 的 shell 表单`ZeroDivisionError`，例如，在此函数中：

```
def function(number):
    if not type(number) == int and not type(number) == float:
        raise TypeError("number must be an integer or float")
    if number == 5:
        raise ValueError("number must not be 5")
    else:
        return 10/(5-number) 
```

PS 对于 python 内置异常的列表，请访问这里： [https](https://docs.python.org/3/library/exceptions.html) ://docs.python.org/3/library/exceptions.html （这是官方 python 数据库）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-01T23:21:54.920

我不确定我是否同意继承`ValueError`——我对文档的解释是，`ValueError`它只*应该*由内置函数提出……从它继承或自己提出似乎不正确。

> 当内置操作或函数接收到具有正确类型但值不适当的参数时引发，并且这种情况没有由更精确的异常（如 IndexError）描述。

-- [ValueError 文档](http://docs.python.org/library/exceptions.html?highlight=valueerror#exceptions.ValueError)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-10-05T15:20:13.323

同意 Markus 的建议来推出您自己的异常，但异常的文本应阐明问题出在参数列表中，而不是单个参数值。我建议：

```
class BadCallError(ValueError):
    pass 
```

当缺少特定调用所需的关键字参数或参数值单独有效但彼此不一致时使用。 `ValueError`当特定参数是正确类型但超出范围时仍然是正确的。

这不应该是 Python 中的标准例外吗？

一般来说，我希望 Python 风格能够更清晰地区分函数的错误输入（调用者的错误）和函数中的错误结果（我的错误）。所以可能还有一个 BadArgumentError 来区分参数中的值错误和本地值错误。

# serial-port - 奇怪的随机数据从 Arduino 发送到处理

> ID：256228
> 
> 赞同：4
> 
> 时间：2008-11-01T23:09:52.883
> 
> 标签：serial-port, processing, arduino

我正在尝试从光电管电阻器和我的 Arduino Decimila 读取数据，然后使用 Processing 实时绘制它。

应该很简单；但它对我来说有点像噩梦。

我在我的 Arduino 上运行的代码：

```
int photoPin;

void setup(){

  photoPin = 0;
  Serial.begin( 9600 );

}

void loop(){

  int val = int( map( analogRead( photoPin ), 0, 1023, 0, 254 ) );
  Serial.println( val ); //sending data over Serial

} 
```

我在处理中运行的代码：

```
import processing.serial.*;

Serial photocell;

int[] yvals;

void setup(){

  size( 300, 150 );
  photocell = new Serial( this, Serial.list()[0], 9600 );
  photocell.bufferUntil( 10 );
  yvals = new int[width];

}

void draw(){

  background( 0 );
  for( int i = 1; i < width; i++ ){
    yvals[i - 1] = yvals[i];
  }

  if( photocell.available() > 0 ){
    yvals[width - 1] = photocell.read();
  }

  for( int i = 1; i < width; i++ ){
    stroke( #ff0000 );
    line( i, yvals[i], i, height );
  }
  println( photocell.read() ); // for debugging
} 
```

我已经分别测试了这两个代码，我知道它们可以工作。只有当我尝试让 Arduino 的输入进入处理时，问题才会开始。

当我在 Arduino 的“串行监视器”中查看数据时，我得到了一个看起来很有效的持续不断的数据流。

但是当我通过处理读取相同的数据时，我会得到一个随机值的重复模式。

哈普？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T02:03:28.523

After a closer look at the resources at hand, I realized that the problem had already been solved for me by the folks over at [http://arduino.cc](http://arduino.cc)

> [http://arduino.cc/en/Tutorial/Graph](http://arduino.cc/en/Tutorial/Graph)

Oh how much time I could have saved if I had seen that earlier.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-11-06T02:56:29.680

You could transmit that data with the Plotly Arduino API, which along with the documentation and setup is available [here](http://plot.ly/api/arduino). Basic idea: you can continuously stream data from your Arduino, or transmit a single chunk.

Then, if you want to embed it into a site, you'll want to grab the URL and use this snippet:

```
<iframe id="igraph" src="https://plot.ly/~abhishek.mitra.963/1/400/250/" width="400" height="250" seamless="seamless" scrolling="no"></iframe> 
```

You can change the width/height dimensions in that snippet. Note: you need to swap in your own URL there to get it stream through.

[Here's an example of how it looks to stream Arduino data](http://plot.ly/~flann321/9/)

![enter image description here](https://i.stack.imgur.com/5QRMO.png)

Full disclosure: I work for Plotly.

# asp.net - 多语言 Web 应用程序 - 如何在 ASP.NET 中检测用户的语言？

> ID：256229
> 
> 赞同：21
> 
> 时间：2008-11-01T23:10:13.943
> 
> 标签：asp.net, web-applications, multilingual, language-switching

我正在构建一个 ASP.NET Web 应用程序，我的所有字符串都存储在一个资源文件中。我想在我的应用程序中添加第二种语言，理想情况下，我想自动检测用户的浏览器语言（或 Windows 语言）并默认使用该语言，而不是让他们选择英语以外的其他语言。目前，我正在手动处理所有资源填充，因此从我的角度来看，添加第二个资源文件和语言是微不足道的，如果我有一种简单的方法来自动找出要显示的语言。

有没有人这样做过，或者您对我如何检索该值有任何想法？由于 ASP.NET 是基于服务器的，我似乎无法访问特定的浏览器设置。

**解决方案**：这就是我最终要做的。我使用“For Each”浏览“HttpContext.Current.Request.UserLanguages”并搜索我支持的一个。我实际上只是检查左边的两个字符，因为我们还不支持任何方言——只有英语和西班牙语。感谢所有的帮助！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-01T23:28:25.500

在 web.config 中试试这个：

```
<globalization culture="auto" uiCulture="auto" /> 
```

这将导致 ASP.NET 从请求标头中自动检测客户端的文化。您还可以通过 Page 属性在每页的基础上进行设置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-01T23:19:50.227

这篇[文章（链接到archive.org，因为原始链接现已失效）](http://web.archive.org/web/20080930115525/http://microsoft.apress.com/asptodayarchive/71804/website-internationalization-using-asp)可能有助于自动检测浏览器的语言设置。

[编辑] 是的。引用的文章不使用 ASP.NET。这篇[文章](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/localization/culture.aspx#autoculture)可以。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-01T23:25:21.760

这是一个很好的问题，因为许多开发人员都忽略了[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)中的本地化。

ASP.NET***应该***自动获取用户的浏览器设置并强制使用`CultureInfo.CurrentCulture`用户的浏览器语言。您可以使用以下行来强制解决问题`Page_OnInit()`：

```
Thread.CurrentThread.CurrentCulture = new CultureInfo(HttpContext.Current.Request.UserLanguages[0]); 
```

你怎么能测试这个？在我们的浏览器上输入语言面板并更改设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T03:34:52.537

客户端通常在 HTTP 请求标头中设置[Accept-Language](http://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Requests)并使用定量评分的首选语言列表，通常（但不一定）按照最受青睐到最不受青睐的顺序排列。您可以对其进行解析，但正如 Maxam 所指出的，[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)确实具有代表您执行此操作的机制。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-23T17:23:06.497

ASP.NET 4 中的 Request.UserLanguages 将其解析为字符串数组。

好信息：[http ://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-07-08T16:51:57.303

```
 /// <summary>
    /// Sets a user's Locale based on the browser's Locale setting. If no setting
    /// is provided the default Locale is used.
    /// </summary>

public static void SetUserLocale(string CurrencySymbol, bool SetUiCulture)
{
    HttpRequest Request = HttpContext.Current.Request;
    if (Request.UserLanguages == null)
        return;

    string Lang = Request.UserLanguages[0];
    if (Lang != null)
    {
        // *** Problems with Turkish Locale and upper/lower case
        // *** DataRow/DataTable indexes
        if (Lang.StartsWith("tr"))
            return;

        if (Lang.Length < 3)
            Lang = Lang + "-" + Lang.ToUpper();
        try
        {
            System.Globalization.CultureInfo Culture = new System.Globalization.CultureInfo(Lang);
            if (CurrencySymbol != null && CurrencySymbol != "")
                Culture.NumberFormat.CurrencySymbol = CurrencySymbol;

            System.Threading.Thread.CurrentThread.CurrentCulture = Culture;

            if (SetUiCulture)
                System.Threading.Thread.CurrentThread.CurrentUICulture = Culture;
        }
        catch
        { ;}
    }
} 
```

本文出处： [如何检测浏览器语言](http://forums.asp.net/t/1052219.aspx/1)

# c# - 如何访问 SOAP 响应

> ID：256234
> 
> 赞同：13
> 
> 时间：2008-11-01T23:17:15.863
> 
> 标签：c#, xml, web-services, soap, wse2.0

（如果这里有什么需要澄清/更多细节，请告诉我。）

我有一个使用 SOAP 与第三方 Web 服务交互的应用程序（C#，2.* 框架）。我针对提供的 WSDL 使用 thinktecture 的 WSCF 插件来创建客户端实现。由于我无法控制的原因，SOAP 消息交换使用 WSE2.0 来保证安全性（必须修改 Thinctecture 实现以包含 WSE2.0 参考）。除了“普通”数据包之外，我还附加了一个存储的 X509 证书和一个来自先前调用不同 Web 服务的二进制安全令牌。我们正在使用某种 SSL 加密——我不知道细节。

所有必要的序列化/反序列化都包含在 Web 服务客户端中——这意味着在调用客户端后将控制权返回给我时，我无法使用 SOAP 响应中包含的整个 XML 字符串——只有反序列化的组件。不要误会我的意思——我认为这很好，因为这意味着我不必自己做。

但是，为了让我有一些值得存储/存档的东西，我必须在根元素处重新序列化数据。这似乎是一种资源浪费，因为我的结果是在 SOAP 响应中。

**现在我的问题是：我如何才能访问 SOAP 响应的“清晰”版本，这样我就不必重新序列化所有内容以进行存储/归档？**

编辑 - 我的应用程序是作为网络服务运行的“无格式”Windows 应用程序 - 由 WebsphereMQ 客户端触发器监视器触发。我*认为*ASP.NET 解决方案不会适用。

编辑 - 由于到目前为止的共识是我的应用程序是否是 ASP.NET 并不重要，所以我会给 CodeMelt（以及扩展 Chris 的）解决方案一个机会。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-01T23:49:17.623

您可以利用现有 WSE2.0 框架中的 SoapExtension 来拦截来自服务器的响应。

```
public class MyClientSOAPExtension : SoapExtension
{

     Stream oldStream;
     Stream newStream;

     // Save the Stream representing the SOAP request or SOAP response into
     // a local memory buffer.
     public override Stream ChainStream( Stream stream )
     {
            oldStream = stream;
            newStream = new MemoryStream();
            return newStream;
     }

    public override void ProcessMessage(SoapMessage message)
    {
       switch (message.Stage)
        {
            case SoapMessageStage.BeforeDeserialize:
                // before the XML deserialized into object.
                break;
            case SoapMessageStage.AfterDeserialize:
                break;        
            case SoapMessageStage.BeforeSerialize:
                break;
            case SoapMessageStage.AfterSerialize:
                break;            
            default:
                throw new Exception("Invalid stage...");
        }       
    }
} 
```

在 SoapMessageStage.BeforeDeserialize 阶段，您可以从 oldstream 中读取您想要的预期数据（例如使用 XmlReader）。然后将预期的数据存储在某个地方供自己使用，并且您需要将旧的流数据转发到新的流以供 Web 服务稍后使用数据，例如将 XML 反序列化为对象。

[记录来自 MSDN 的 Web 服务的所有流量的示例](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension(VS.85).aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-03T12:54:11.297

这是一个示例，您可以使用 Visual Studio Web 引用对[http://footballpool.dataaccess.eu/data/info.wso?WSDL进行设置](http://footballpool.dataaccess.eu/data/info.wso?WSDL)

基本上，您必须在 web 服务调用链中插入一个 XmlReader spyer，它将重建原始 XML。

我相信这种方式比使用 SoapExtensions 更简单。

解决方案的灵感来自[http://orbinary.com/blog/2010/01/getting-the-raw-soap-xml-sent-via-soaphttpclientprotocol/](http://orbinary.com/blog/2010/01/getting-the-raw-soap-xml-sent-via-soaphttpclientprotocol/)

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Net;
using System.IO;
using System.Reflection;
using System.Xml;

namespace ConsoleApplication1 {

    public class XmlReaderSpy : XmlReader {
        XmlReader _me;
        public XmlReaderSpy(XmlReader parent) {
            _me = parent;
        }

        /// <summary>
        /// Extracted XML.
        /// </summary>
        public string Xml;

        #region Abstract method that must be implemented
        public override XmlNodeType NodeType {
            get {

                return _me.NodeType;
            }
        }

        public override string LocalName {
            get {
                return _me.LocalName;
            }
        }

        public override string NamespaceURI {
            get {
                return _me.NamespaceURI;
            }
        }

        public override string Prefix {
            get {
                return _me.Prefix;
            }
        }

        public override bool HasValue {
            get { return _me.HasValue; }
        }

        public override string Value {
            get { return _me.Value; }
        }

        public override int Depth {
            get { return _me.Depth; }
        }

        public override string BaseURI {
            get { return _me.BaseURI; }
        }

        public override bool IsEmptyElement {
            get { return _me.IsEmptyElement; }
        }

        public override int AttributeCount {
            get { return _me.AttributeCount; }
        }

        public override string GetAttribute(int i) {
            return _me.GetAttribute(i);
        }

        public override string GetAttribute(string name) {
            return _me.GetAttribute(name);
        }

        public override string GetAttribute(string name, string namespaceURI) {
            return _me.GetAttribute(name, namespaceURI);
        }

        public override void MoveToAttribute(int i) {
            _me.MoveToAttribute(i);
        }

        public override bool MoveToAttribute(string name) {
            return _me.MoveToAttribute(name);
        }

        public override bool MoveToAttribute(string name, string ns) {
            return _me.MoveToAttribute(name, ns);
        }

        public override bool MoveToFirstAttribute() {
            return _me.MoveToFirstAttribute();
        }

        public override bool MoveToNextAttribute() {
            return _me.MoveToNextAttribute();
        }

        public override bool MoveToElement() {
            return _me.MoveToElement();
        }

        public override bool ReadAttributeValue() {
            return _me.ReadAttributeValue();
        }

        public override bool Read() {
            bool res = _me.Read();

            Xml += StringView();

            return res;
        }

        public override bool EOF {
            get { return _me.EOF; }
        }

        public override void Close() {
            _me.Close();
        }

        public override ReadState ReadState {
            get { return _me.ReadState; }
        }

        public override XmlNameTable NameTable {
            get { return _me.NameTable; }
        }

        public override string LookupNamespace(string prefix) {
            return _me.LookupNamespace(prefix);
        }

        public override void ResolveEntity() {
            _me.ResolveEntity();
        }

        #endregion

        protected string StringView() {
            string result = "";

            if (_me.NodeType == XmlNodeType.Element) {
                result = "<" + _me.Name;

                if (_me.HasAttributes) {
                    _me.MoveToFirstAttribute();
                    do {
                        result += " " + _me.Name + "=\"" + _me.Value + "\"";
                    } while (_me.MoveToNextAttribute());

                    //Let's put cursor back to Element to avoid messing up reader state.
                    _me.MoveToElement();
                }

                if (_me.IsEmptyElement) {
                    result += "/";
                }

                result += ">";
            }

            if (_me.NodeType == XmlNodeType.EndElement) {
                result = "</" + _me.Name + ">";
            }

            if (_me.NodeType == XmlNodeType.Text || _me.NodeType == XmlNodeType.Whitespace) {
                result = _me.Value;
            }

            if (_me.NodeType == XmlNodeType.XmlDeclaration) {
                result = "<?"  + _me.Name + " " +   _me.Value + "?>";
            }

            return result;

        }
    }

    public class MyInfo : ConsoleApplication1.eu.dataaccess.footballpool.Info {             

        protected XmlReaderSpy _xmlReaderSpy;

        public string Xml {
            get {
                if (_xmlReaderSpy != null) {
                    return _xmlReaderSpy.Xml;
                }
                else {
                    return "";
                }
            }
        }

        protected override XmlReader GetReaderForMessage(System.Web.Services.Protocols.SoapClientMessage message, int bufferSize) {          
            XmlReader rdr = base.GetReaderForMessage(message, bufferSize);
            _xmlReaderSpy = new XmlReaderSpy((XmlReader)rdr);
            return _xmlReaderSpy;
        }

    }

    class Program {
        static void Main(string[] args) {

            MyInfo info = new MyInfo();
            string[] rest = info.Cities();

            System.Console.WriteLine("RAW Soap XML response :\n"+info.Xml);
            System.Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-12-07T11:21:50.750

受 jfburdet 的启发，我想看看是否可以在流/字节级别直接拦截而不是重建 XML。它是！请参见下面的代码：

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using System.Web.Services.Protocols;
using System.Xml;

using Test.MyWebReference;

namespace Test {
    /// <summary>
    /// Adds the ability to retrieve the SOAP request/response.
    /// </summary>
    public class ServiceSpy : OriginalService {
        private StreamSpy writerStreamSpy;
        private XmlTextWriter xmlWriter;

        private StreamSpy readerStreamSpy;
        private XmlTextReader xmlReader;

        public MemoryStream WriterStream {
            get { return writerStreamSpy == null ? null : writerStreamSpy.ClonedStream; }
        }

        public XmlTextWriter XmlWriter {
            get { return xmlWriter; }
        }

        public MemoryStream ReaderStream {
            get { return readerStreamSpy == null ? null : readerStreamSpy.ClonedStream; }
        }

        public XmlTextReader XmlReader {
            get { return xmlReader; }
        }

        protected override void Dispose(bool disposing) {
            base.Dispose(disposing);
            DisposeWriterStreamSpy();
            DisposeReaderStreamSpy();
        }

        protected override XmlWriter GetWriterForMessage(SoapClientMessage message, int bufferSize) {
            // Dispose previous writer stream spy.
            DisposeWriterStreamSpy();

            writerStreamSpy = new StreamSpy(message.Stream);
            // XML should always support UTF8.
            xmlWriter = new XmlTextWriter(writerStreamSpy, Encoding.UTF8);

            return xmlWriter;
        }

        protected override XmlReader GetReaderForMessage(SoapClientMessage message, int bufferSize) {
            // Dispose previous reader stream spy.
            DisposeReaderStreamSpy();

            readerStreamSpy = new StreamSpy(message.Stream);
            xmlReader = new XmlTextReader(readerStreamSpy);

            return xmlReader;
        }

        private void DisposeWriterStreamSpy() {
            if (writerStreamSpy != null) {
                writerStreamSpy.Dispose();
                writerStreamSpy.ClonedStream.Dispose();
                writerStreamSpy = null;
            }
        }

        private void DisposeReaderStreamSpy() {
            if (readerStreamSpy != null) {
                readerStreamSpy.Dispose();
                readerStreamSpy.ClonedStream.Dispose();
                readerStreamSpy = null;
            }
        }

        /// <summary>
        /// Wrapper class to clone read/write bytes.
        /// </summary>
        public class StreamSpy : Stream {
            private Stream wrappedStream;
            private long startPosition;
            private MemoryStream clonedStream = new MemoryStream();

            public StreamSpy(Stream wrappedStream) {
                this.wrappedStream = wrappedStream;
                startPosition = wrappedStream.Position;
            }

            public MemoryStream ClonedStream {
                get { return clonedStream; }
            }

            public override bool CanRead {
                get { return wrappedStream.CanRead; }
            }

            public override bool CanSeek {
                get { return wrappedStream.CanSeek; }
            }

            public override bool CanWrite {
                get { return wrappedStream.CanWrite; }
            }

            public override void Flush() {
                wrappedStream.Flush();
            }

            public override long Length {
                get { return wrappedStream.Length; }
            }

            public override long Position {
                get { return wrappedStream.Position; }
                set { wrappedStream.Position = value; }
            }

            public override int Read(byte[] buffer, int offset, int count) {
                long relativeOffset = wrappedStream.Position - startPosition;
                int result = wrappedStream.Read(buffer, offset, count);
                if (clonedStream.Position != relativeOffset) {
                    clonedStream.Position = relativeOffset;
                }
                clonedStream.Write(buffer, offset, result);
                return result;
            }

            public override long Seek(long offset, SeekOrigin origin) {
                return wrappedStream.Seek(offset, origin);
            }

            public override void SetLength(long value) {
                wrappedStream.SetLength(value);
            }

            public override void Write(byte[] buffer, int offset, int count) {
                long relativeOffset = wrappedStream.Position - startPosition;
                wrappedStream.Write(buffer, offset, count);
                if (clonedStream.Position != relativeOffset) {
                    clonedStream.Position = relativeOffset;
                }
                clonedStream.Write(buffer, offset, count);
            }

            public override void Close() {
                wrappedStream.Close();
                base.Close();
            }

            protected override void Dispose(bool disposing) {
                if (wrappedStream != null) {
                    wrappedStream.Dispose();
                    wrappedStream = null;
                }
                base.Dispose(disposing);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2020-08-20T02:28:22.400

旧线程，但如果其他人希望今天这样做：利用 SoapExtension 或创建“间谍”类的这些想法很棒，但在 .NET Core 中不起作用。

@mting923 建议使用 IClientMessageInspector 方法适用于 .NET Core 3.1；请参阅此处：[在将 SOAP 消息发送到 .NET 中的 WebService 之前获取 SOAP 消息](https://stackoverflow.com/questions/461744/get-soap-message-before-sending-it-to-the-webservice-in-net/63497094#63497094)。

生成的 SOAP 代理类在底层仍然只是一个 WCF 客户端，因此 IClientMessageInspector 方法很有效，即使对于调用旧 SOAP Web 服务的 .NET Core Azure 函数也是如此。以下适用于 .NET Core 3.1 Azure 函数：

```
public class SoapMessageInspector : IClientMessageInspector
{
    public string LastRequestXml { get; private set; }
    public string LastResponseXml { get; private set; }

    public object BeforeSendRequest(ref Message request, IClientChannel channel)
    {
        LastRequestXml = request.ToString();
        return request;
    }

    public void AfterReceiveReply(ref Message reply, object correlationState)
    {
        LastResponseXml = reply.ToString();
    }
}

public class SoapInspectorBehavior : IEndpointBehavior
{
    private readonly SoapMessageInspector inspector_ = new SoapMessageInspector();

    public string LastRequestXml => inspector_.LastRequestXml;
    public string LastResponseXml => inspector_.LastResponseXml;

    public void AddBindingParameters(ServiceEndpoint endpoint, BindingParameterCollection bindingParameters)
    {
    }

    public void ApplyDispatchBehavior(ServiceEndpoint endpoint, EndpointDispatcher endpointDispatcher)
    {
    }

    public void Validate(ServiceEndpoint endpoint)
    {
    }

    public void ApplyClientBehavior(ServiceEndpoint endpoint, ClientRuntime clientRuntime)
    {
        clientRuntime.ClientMessageInspectors.Add(inspector_);
    }
} 
```

然后可以这样设置：

```
 var client = new ServiceClient();
    var soapInspector = new SoapInspectorBehavior();
    client.Endpoint.EndpointBehaviors.Add(soapInspector); 
```

在客户端代理上调用 Web 服务调用后，`soapInspector.LastRequestXml`将`soapInspector.LastResponseXml`包含原始 SOAP 请求和响应（作为字符串）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-01T23:26:01.633

[MSDN 库](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension(VS.85).aspx)包含用于获取请求和响应的 XML 的示例代码，您可以使用它来归档它。显然，由于示例将数据存储在文本文件中，因此您必须进行一些更改，但这并不太复杂。

# functional-programming - 函数式编程：最佳平台/环境

> ID：256254
> 
> 赞同：12
> 
> 时间：2008-11-01T23:35:46.107
> 
> 标签：functional-programming

我最近一直在研究和玩函数式编程，只是为了拓宽我对编程的思考，因为我发现“函数式”思考很困难。

我已经下载了 Glasgow Haskell 并进行了实验。

我想知道的是，Windows 试验 FP 的最佳平台是什么？我更喜欢基于 JVM 的方法，但是关于 SO 的另一篇文章表明，由于缺乏对尾递归的支持，无法在 JVM 上实现真正的 FP 语言。你说什么？

编辑：正如我所说，我已经对 Haskell 进行了相当多的实验；根据我一直在查看 Scala 网站的答案之一的建议。查看 Scala 示例，代码似乎更“熟悉”（我的背景是 C 和 Java），但它似乎显然更多的是 OO/过程性和更少的功能。Scala 的一个巨大优势在于，它为我提供了另一种与 Java 一起使用的语言工具，并且可以成为我目前专业箭袋的另一个箭头，而不仅仅是一个学习练习。当我更深入地了解 Scala 时，功能方面会变得更加重要，还是我会倾向于只编写具有一些功能影响的 OO 代码？换句话说，Haskell 会比 Scala 更难更快地挑战我的先入之见吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-01T23:51:32.380

查看[F#](http://fsharp.org/)。CLR 有一个 .tail 指令，因此您可以使用不会导致 StackOverflow 的尾调用编写 F# 代码（异常，而不是网站）。 [这](http://channel9.msdn.com/pdc2008/TL11/)是来自 PDC 的关于 F# 的介绍视频。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-02T09:48:05.827

如果你真的想学习如何以函数式的方式思考，Haskell 绝对是正确的选择。几乎所有其他语言都让你很容易陷入命令式风格。Haskell 将迫使您进入功能性思维模式。我在学习时发现这是必不可少的。（当然，你可能比我更有纪律，但为什么要碰运气呢？）

当您对从 Haskell 中学到的东西感到满意时（这将是很多！），您将开始评估更自由的函数式语言，例如 Clojure 或 Scala。或者你可以留在 Haskell，它的图书馆情况实际上也不是那么糟糕。在这一点上，这是一个环境和个人喜好的问题。但为了做出这样的选择，我认为，首先学会如何以“纯”功能的方式思考是至关重要的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-01T23:48:42.523

我推荐[PLT Scheme](http://www.plt-scheme.org/)和[SICP](http://mitpress.mit.edu/sicp/full-text/book/book.html)。该语言非常简单，您可以非常快速地了解重要概念。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-02T19:26:59.480

Scala 绝不会像 Haskell 那样让你心烦意乱。在学习 FP 时选择 Scala 而不是 Haskell 的主要原因是让自己更温和地介绍单子、函子和高阶善良的危险荒野。如果您来自面向对象的背景并试图将这些知识转换为功能领域，那么 Scala 非常棒。如果您只想一头扎进深渊，那就不是太好了。

鉴于您的要求，我会推荐 GHC Haskell。没有什么比这更让你头疼了。:-) 尽管如此，我认为你仍然应该关注 Scala。该语言有很多方面是非常独特的，特别是它的类型系统（结构+名义子类型==甜蜜）。它不会像 Haskell 那样伤脑筋，但它会让你深入了解一些在其他地方可能找不到的概念，尤其是所谓的“类型化编程”方法。

哦，为了回答您问题的第二部分（Scala 中的 FP 与 OO），我倾向于在面向对象的框架中以函数式风格编写代码。这有点难以描述，但就是这样。可以将其想象为从面向对象的角度设计 API，但以功能样式实现所有内容。我使事物保持不变并花费大量时间使用高阶方法，但我在继承和常规名义子类型的范围内完成所有工作。每隔一段时间，我仍然会写一些命令式的东西，但前提是这样做比使用函数式风格更简洁。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-02T01:44:20.560

另请查看[Clojure](http://clojure.org/)。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-02T18:25:46.437

> 换句话说，Haskell 会比 Scala 更难更快地挑战我的先入之见吗？

是的。

如果您真的想学习，请远离舒适区。

你真的打算在接下来的 3 个月内将 Scala 用于生产代码吗？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-01T23:46:32.513

看看[斯卡拉](http://www.scala-lang.org/)。它以 JVM 为目标，与 Java 互操作，并具有许多最先进的函数式编程特性。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-02T00:01:00.893

我*喜欢*使用 Haskell 和 GHC。GHC 包括一个交互式解释器 (GHCI)，并具有非常有用的错误消息。此外，Haskell 是真正函数式语言的最佳示例之一，一旦您尝试了一下，使用起来还不错。此外，它还有一个*很棒*的类型系统。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-02T00:45:41.800

曾经尝试过 Prolog 吗？……那会

```
?- bend(your_mind).
Yes

?- bend(X).
X = your_mind 
```

无论如何，它给了我一个全新的视角...... [那里](http://www.swi-prolog.org/)[有](http://www.sics.se/isl/sicstuswww/site/index.html)[很多](http://www.csupomona.edu/~jrfisher/www/prolog_tutorial/contents.html) [信息](http://www.gprolog.org/)

# java - 弹簧和接口

> ID：256255
> 
> 赞同：29
> 
> 时间：2008-11-01T23:35:46.543
> 
> 标签：java, spring

我到处阅读有关 Spring 如何鼓励您在代码中使用接口的信息。我没看到。spring xml 配置中没有接口的概念。Spring 的哪一部分实际上鼓励您使用接口（除了文档）？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-02T00:45:26.810

[依赖倒置原则](https://en.wikipedia.org/wiki/Dependency_inversion_principle)很好地解释了这一点。特别是图4。

> A. 高级模块不应该依赖于低级模块。两者都应该依赖于抽象。
> 
> B. 抽象不应依赖于细节。细节应该取决于抽象。

将上面链接中的示例翻译成java：

```
public class Copy {
    private Keyboard keyboard = new Keyboard(); // concrete dependency
    private Printer printer = new Printer();    // concrete dependency
    public void copy() {
        for (int c = keyboard.read(); c != KeyBoard.EOF) {
            printer.print(c);
        }
    }
} 
```

现在依赖反转：

```
public class Copy {
     private Reader reader; // any dependency satisfying the reader interface will work
     private Writer writer; // any dependency satisfying the writer interface will work
     public void copy() {
        for (int c = reader.read(); c != Reader.EOF) {
            writer.write(c);
        }
     }
     public Copy(Reader reader, Writer writer) {
         this.reader = reader;
         this.writer = writer;
     }
} 
```

现在`Copy`支持的不仅仅是从键盘复制到打印机。

它能够从任何复制`Reader`到任何复制，`Writer`而无需对其代码进行任何修改。

现在有了春天：

```
<bean id="copy" class="Copy">
    <constructor-arg ref="reader" />
    <constructor-arg ref="writer" />
</bean>

<bean id="reader" class="KeyboardReader" />
<bean id="writer" class="PrinterWriter" /> 
```

也许：

```
<bean id="reader" class="RemoteDeviceReader" />
<bean id="writer" class="DatabaseWriter" /> 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-11-02T05:04:31.153

当你为你的类定义一个接口时，它有助于依赖注入。您的 Spring 配置文件本身没有关于接口的任何内容——您只需输入类的名称。

但是如果你想注入另一个提供“等效”功能的类，使用接口真的很有帮助。

例如，假设您有一个分析网站内容的类，并且您正在使用 Spring 注入它。如果您将其注入的类知道实际的类是什么，那么为了将其更改，您将不得不更改大量代码以使用不同的具体类。但是，如果您创建了一个`Analyzer`界面，您可以轻松地注入您的原始界面，`DefaultAnalyzer`就像您可以模拟一个模型`DummyAnalyzer`或什至另一个本质上做相同事情的界面一样，例如 a`PageByPageAnalyzer`或其他任何东西。为了使用其中之一，您只需更改您在 Spring 配置文件中注入的类名，而不是通过代码更改类。

我花了大约一个半的时间才真正开始看到它的用处。就像大多数最终有用的东西（在企业语言中）一样，起初它似乎是毫无意义的工作，直到您的项目开始增长，然后您发现通过预先做更多的工作节省了多少时间。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-03T23:42:50.053

这里的大多数答案都是某种形式的“您可以轻松换出实现”，但我认为他们无法回答的是为什么？部分。对此，我认为答案几乎是明确的可测试性。无论您是否使用 Spring 或任何其他 IOC 框架，使用 Dependency Injection 都会使您的代码更容易测试。在使用 writer 而不是 PrinterWriter 的情况下，您可以在单元测试中模拟 Writer 接口，并确保您的代码以您期望的方式调用它。如果您直接依赖于类实现，您唯一的选择就是走到打印机前检查它，这不是很自动化。此外，如果您依赖于类调用的结果，则无法模拟它可能会阻止您访问测试中的所有代码路径，从而降低它们的质量（潜在地）简单地说，您应该将对象图的创建与应用程序逻辑分离。这样做会使您的代码更容易测试。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-07-09T14:09:04.733

还没有人提到在很多情况下不需要创建一个接口以便实现类可以快速切换，因为不会有多个实现类。

当不需要创建接口时，类将成对创建（接口加实现），添加不必要的样板接口并造成潜在的依赖混淆，因为在 XML 配置文件中，组件有时会被其接口引用，有时被其实现引用，与在运行时没有后果，但在代码约定方面不连贯。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-01T23:50:03.147

您可能想尝试自己使用它以便更好地看到这一点，从文档中可能不清楚 Spring 如何鼓励接口使用。

这里有几个例子：

1.  假设您正在编写一个需要从资源（例如，文件）中读取的类，该资源可能以多种方式（例如，在类路径、绝对文件路径、作为 URL 等）中引用。你想`org.springframework.core.io.Resource`在你的类上定义一个（接口）属性。然后在您的 Spring 配置文件中，您只需选择实际的实现类（例如`org.springframework.core.io.ClassPathResource`，、`org.springframework.core.io.FileSystemResource`等`org.springframework.core.io.UrlResource`）。Spring 基本上是作为一个非常通用的工厂运行的。

2.  如果您想利用 Spring 的 AOP 集成（例如添加事务拦截器），您几乎需要定义接口。您在 Spring 配置文件中定义拦截点，Spring 会根据您的接口为您生成代理。

这些都是我亲身经历过的例子。我敢肯定还有更多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-14T00:13:05.820

从接口生成代理很容易。

如果您查看任何 spring 应用程序，您将看到服务和持久性接口。使 spring 成语确实鼓励使用接口。没有比这更明确的了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-08-14T20:53:44.523

编写单独的接口会增加通常不必要的复杂性和样板代码。它还使调试变得更加困难，因为当您在 IDE 中单击方法调用时，它会显示接口而不是实现。除非您在运行时交换实现，否则无需走这条路。

像 Mockito 这样的工具使使用依赖注入测试代码变得非常容易，而无需在接口上堆积。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-04T19:31:49.297

Spring 不会强迫你在任何地方使用接口，它只是一个很好的实践。如果你有一个 bean 有一些属性是接口而不是具体的类，那么你可以简单地用实现相同接口的模型切换一些对象，这对于某些测试用例很有用。

如果您使用例如 Hibernate 支持类，您可以为您的 DAO 定义一个接口，然后单独实现它；拥有接口的优点是您将能够使用 Spring 拦截器对其进行配置，这将允许您简化代码；您不必编写任何代码覆盖 HibernateExceptions 并在 finally 段中关闭会话，也不必以编程方式定义任何事务，您只需使用 Spring 以声明方式配置所有这些东西。

当您编写快速而肮脏的应用程序时，您可以使用 JDBC 或一些您最终不会在最终版本中使用的简单框架来实现一些简单的 DAO；如果它们实现了一些通用接口，您将能够轻松地切换这些组件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-19T13:53:47.003

**如果您不使用接口，您将面临自动装配失败的风险**：有时 Spring 会为 Bean 创建一个代理类。**这个 Proxy 类不是服务实现的子类，**但它重新实现了它的所有接口。Spring 将尝试自动装配此 Bean 的实例，但是此 Proxy 类与 Bean 类不兼容。所以用 Bean 类声明一个字段会导致“不安全的字段赋值”异常。

您无法合理地知道 Spring 何时代理服务（您也不应该），因此为了保护自己免受这些意外的影响，最好的做法是声明一个接口并在声明自动装配字段时使用此接口。

# emacs - 如何让 Emacs shell 模式渲染（或忽略）我的颜色而不是打印 ASCII 代码？

> ID：256264
> 
> 赞同：20
> 
> 时间：2008-11-01T23:44:15.343
> 
> 标签：emacs, colors, ascii

问题的症状看起来像“[0m[27m[24m[J[34;1””，在终端上转换为蓝色。

-一种

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-02T02:07:23.337

我有以下内容`.emacs`

```
(add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T03:01:18.657

目前给我一些成功的解决方案是将 shell 函数重新定义为 ansi 术语：

```
;; shell-mode
(defun sh ()
  (interactive)
  (ansi-term "/bin/zsh")) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T13:44:07.847

对于“忽略”替代方案，请在文件中添加“ `alias ls=ls`”或“ `unset LS_COLORS`”之类的`~/.emacs_{bash,tsch,whatever-your-shell-is-called}`内容。该文件在 emacs 创建的所有从属 shell 中执行。

> [Emacs](http://www.gnu.org/software/emacs/manual/html_node/emacs/Interactive-Shell.html)向新的 shell 发送文件的内容`~/.emacs_shellname`作为输入，如果存在，其中`shellname`是从中加载 shell 的文件的名称。例如，如果您使用 bash，则发送给它的文件是`~/.emacs_bash`. 如果找不到这个文件，Emacs 会尝试回退到`~/.emacs.d/init_shellname.sh`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T01:59:35.617

以下内容应适用于您的 .bash_profile 或 .bashrc

```
case $TERM in
xterm-color)
export PS1='\[\e]0;\W\007\]\[\e[34;1m\]\W\[\e[0m\]\$ '
;;
*)
export PS1='\W\$ '
;;
esac 
```

# c# - 是什么导致 DbDataAdapter.Fill 用不正确的列数填充 DataSet？

> ID：256267
> 
> 赞同：0
> 
> 时间：2008-11-01T23:45:40.660
> 
> 标签：c#, .net, sql-server, database

我有一个连接到本地机器上的 SqlServer 数据库的 Windows 服务。这一直都很好。然而，在一个大客户中，数据库连接由于一些罕见且未知的原因而损坏。发生这种情况时，对 DbDataAdapter.Fill 的调用返回的 DataSet 的列数与传入的 select 命令中的列数不同（由显示预期 sql 和返回的列数的跟踪日志验证）。对于前几个错误的数据集，适配器实例似乎正在返回上一个查询的结果。即使适配器对象是唯一实例，并且连接/适配器创建调用受线程保护（因为 DbProviderFactory 不是线程安全的），也会发生这种情况。

有没有人经历过这个或类似的事情？有谁知道这可能是什么原因？在这个时刻，我很难为这个原因想出新的想法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-02T00:10:50.483

您是否正在填充强类型数据集 (STDS)？如果您正在填写 STDS，如果列名和类型不匹配，您将获得带有一些幻列的表......即那些在 STDS 的架构中定义的表，而不是在您返回的记录集中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T11:00:59.203

尝试关闭连接池一段时间，看看是否可以缓解问题。我在其他地方看到过这个问题，我认为涉及连接池，但我不能确定。我看看我能不能找到其他论坛，或者也许其他人也记得它？

# c - 什么是记录 C 中“.h”文件使用模式的良好参考？

> ID：256277
> 
> 赞同：1
> 
> 时间：2008-11-01T23:51:57.790
> 
> 标签：c, design-patterns, include

“C 接口和实现”展示了一些有趣的数据结构使用模式，但我相信还有其他的。

[http://www.amazon.com/Interfaces-Implementations-Techniques-Addison-Wesley-Professional/dp/0201498413](https://rads.stackoverflow.com/amzn/click/com/0201498413)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-02T02:51:24.963

查看戈达德太空飞行中心 (NASA) C 编码标准（在此[URL](http://software.gsfc.nasa.gov/assetsbytype.cfm?TypeAsset=Standard)上）。它有一些好的和有趣的指导方针。

我为自己的代码采用的一个特定准则是标题应该是自包含的。也就是说，您应该能够编写：

```
#include "header.h" 
```

并且代码应该正确编译，包括任何其他必要的头文件，无论之前发生了什么。确保这一点的简单方法是将标头包含在实现源中——作为第一个标头。如果编译成功，则标头是自包含的。如果它没有编译，请修复它以便它编译。当然，这还要求您确保标头是幂等的——无论它们被包含的频率如何，它们的工作方式都是一样的。也有一个标准的成语：

```
#ifndef HEADER_H_INCLUDED
#define HEADER_H_INCLUDED
...operational body of header.h...
#endif /* HEADER_H_INCLUDED */ 
```

当然，必须将#define 放在文件的顶部，而不是底部。否则，如果其中包含的标头也包含 header.h，那么您最终会出现无限循环 - 不健康。即使您决定采用以下策略：

```
#ifndef HEADER_H_INCLUDED
#include "header.h"
#endif /* HEADER_H_INCLUDED */ 
```

在包含标头的代码中 -**不**推荐这种做法 - 在标头本身中包含守卫也很重要。

* * *

### 2011-05-01 更新

上面的 GSFC URL 不再有效。您可以在问题的答案中找到更多信息，[我应该在标题中使用#include](https://stackoverflow.com/questions/1804486/should-i-use-include-in-headers)，其中还包含对此问题的交叉引用。

### 2012-03-24 更新

引用的 NASA C 编码标准可以通过 Internet 存档访问和下载：

[http://web.archive.org/web/20090412090730/http://software.gsfc.nasa.gov/assetsbytype.cfm?TypeAsset=Standard](http://web.archive.org/web/20090412090730/http://software.gsfc.nasa.gov/assetsbytype.cfm?TypeAsset=Standard)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T00:06:25.000

[Makeheaders](http://www.hwaci.com/sw/mkhdr/)是一种有趣的方法：使用工具生成标题。Makeheaders 用于 DR Hipp 的[cvstrac](http://www.cvstrac.org/)和[化石](http://www.fossil-scm.org/index.html/doc/tip/www/index.wiki)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T02:24:50.197

您可能想看看 John Lakos 的大型 C++ 软件设计。

# sql - 在 MySQL 中计算每天页面点击量的最佳方法是什么

> ID：256282
> 
> 赞同：4
> 
> 时间：2008-11-01T23:54:36.897
> 
> 标签：sql, mysql, datetime

在[我的博客上](http://andrew.hedges.name/blog/)，我在右侧导航中显示了 10 篇最受欢迎的文章（就页面点击而言）。我是这样理解的：

```
SELECT *
FROM entries
WHERE is_published = 1
ORDER BY hits DESC, created DESC
LIMIT 10 
```

我想做的是在*每天的页面点击量方面显示前 10 名。*我正在使用 MySQL。有没有办法在数据库中做到这一点？

顺便说一句，该`created`字段是日期时间。

更新：我想我还没有说清楚。我想要的是 1000 天前发布的具有 10,000 次点击的博客文章与 1 天前发布的具有 10 次点击的博客文章具有相同的受欢迎程度。在伪代码中：

```
ORDER BY hits / days since posting 
```

... where`hits`只是一个 int ，每次查看博客文章时都会递增。

好的，这就是我要使用的：

```
SELECT *, AVG(
    hits / DATEDIFF(NOW(), created)
) AS avg_hits
FROM entries
WHERE is_published = 1
GROUP BY id
ORDER BY avg_hits DESC, hits DESC, created DESC 
LIMIT 10 
```

谢谢，斯蒂芬！（我喜欢这个网站...）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-02T00:13:30.913

我不完全确定您可以使用您在查询中建议的表结构。我能想到的唯一方法是通过每天最高的*平均点击量获得前 10 名。*通过这样做，您的查询变为：

```
SELECT *, AVG(hits / DATEDIFF(NOW(), created)) as avg_hits
FROM entries
WHERE is_published = 1
GROUP BY id
ORDER BY avg_hits DESC
LIMIT 10 
```

此查询假定您创建的字段是 DATETIME（或类似）数据类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T00:44:07.420

我猜你可能有一个 hits_day_count 列，它在每个视图上递增，还有一个 hits_day_current。

在每个页面查看中，您检查 hits_day_current 列是否是今天。如果没有，请重置命中计数。然后增加 hits_day_count 列，并将 hits_day_current 设置为当前日期时间。

伪代码：

```
if article_data['hits_day_current'] == datetime.now():
    article_data['hits_day_count'] ++
else:
    article_data['hits_day'] = 0

article_data['hits_day_current'] = datetime.now() 
```

明显的问题很简单 - 时区。无论服务器位于何处，总数都会在 00:00 重置，这可能没有用。

一个更好的解决方案是滚动 24 小时总计.. 不太确定如何巧妙地做到这一点。最简单（虽然不是那么优雅）的方法是定期解析您的网络服务器日志。获取最近 24 小时的日志，统计每篇文章的请求数，并将这些数字存入数据库。

# 64-bit - 如何在 x64 窗口中运行 PartCover

> ID：256287
> 
> 赞同：15
> 
> 时间：2008-11-02T00:01:46.790
> 
> 标签：64-bit, partcover

我正在尝试运行 PartCover 以在 windows x64 上使用 Gallio 测试一些测试的覆盖率。但是尝试运行它会出现以下错误。

> 由于以下错误，检索具有 CLSID {FB20430E-CDC9-45D7-8453-272268002E08} 的组件的 COM 类工厂失败：80040153。

编辑：我正在使用 PartCover 2.2.0

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-02T00:07:07.760

该问题是由 PartCover 在 64 位 .NET VM 下运行时尝试加载 32 位 dll 引起的。

诀窍是强制 PartCover 在 32 位 VM 中运行。为此，您必须使用名为 CorFlags.exe 的工具来修改 exe 并将其标记为 32 位。这相当于它是以 x86 为目标构建的。

CorFlags（在我的机器上）位于 Program Files\Microsoft SDKs\Windows\v6.0A\Bin\x64\

要设置 32 位标志，请运行：

> CorFlags.exe PartCover.exe /32BIT+ /Force

我还发现我必须对正在运行的程序做同样的事情（在我的例子中是 Gallio 测试运行程序）

# windows-mobile - 适用于 Windows CE/Mobile 的代码分析/性能分析工具

> ID：256291
> 
> 赞同：6
> 
> 时间：2008-11-02T00:06:06.857
> 
> 标签：windows-mobile, windows-ce, native, profiling

除了 Visual Studio 中的工具，您还知道哪些工具可以分析 Windows CE/Mobile 应用程序中的性能瓶颈？我正在寻找类似 AQTime for CE/Mobile 的东西，以分析编译为本机代码的 C/C++ 应用程序。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-01T21:42:08.427

Windows CE 支持开箱即用的[Remote Call Profiler （如果 OEM 添加了对它的支持）。](http://msdn.microsoft.com/en-us/library/ms894533.aspx)我相信，WinMo 图像通常已经在图像中支持它。对于 CE，您需要设置 IMAGEPROFILER 环境变量（使用项目属性）。

MSDN 中不清楚的是如何检测不是使用 Platform Builder 构建的应用程序，但它实际上非常简单。您必须将 /callcap 开关添加到编译器命令行并将 cecap.lib 添加到链接器设置。

当然，您需要一个工具来捕获和显示探查器数据。为此，您可以使用 Platform Builder 的评估版（[5.0](http://www.microsoft.com/downloads/details.aspx?familyid=486e8250-d311-4f67-9fb3-23e8b8944f3e&displaylang=en)或[6.0](http://www.microsoft.com/downloads/details.aspx?FamilyID=7e286847-6e06-4a0c-8cac-ca7d4c09cb56&displaylang=en)）（eval 是免费的）或[eVC 4.0](http://www.microsoft.com/downloads/details.aspx?FamilyId=1DACDB3D-50D1-41B2-A107-FA75AE960856&displaylang=en)（也是免费的）。

有关分析器使用的更多信息，来自 CE 核心团队的 Sue Loh 已在博客中介绍了一些相关信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-02T04:24:19.737

我还没有为 WindowsMo​​bile 找到任何此类用于本机开发的工具。

我发现最接近的是 EnTrek 工具集（CodeSnitch / ProcMan），但它们并不是真正的分析工具。 [http://www.entrek.com/products.htm](http://www.entrek.com/products.htm)

我们所做的是使用 VC++ 的 Vistual Studio "/callcap" 开关将自己的分析支持构建到我们自己的产品中。使用该开关，您可以构建一个分析库，该库可以输出时间和计数，无论您喜欢什么。它对我们来说效果很好，但有时这些钩子函数的开销可能太大，它可能会将计时结果倾斜到大量函数调用的区域。

来自 MSDN 文档：

> /callcap 选项使编译器在每个函数的开头和结尾插入对分析挂钩的调用。
> 
> 您必须在没有 callcap 开关的情况下编译分析挂钩。如果您使用 callcap 开关编译分析挂钩函数，这些函数将对它们自己执行无限递归调用。
> 
> 以下代码示例 Callcaphooks.c 显示了一个分析挂钩函数 _CAP_Enter_Function，用于在没有 callcap 的情况下进行编译。

```
// File: callcaphooks.c

#include <stdio.h>
int main();

void _CAP_Enter_Function(void *p) 
{
    if (p != main) 
        printf("Enter function   (at address %p) at %d\n", 
            p, GetTickCount());
        return;
}
void _CAP_Exit_Function(void *p) 
{
    if (p != main) 
        printf("Leaving function (at address %p) at %d\n", 
            p, GetTickCount());
    return;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-26T21:43:13.097

我为 Windows Mobile 编写了一个调用图分析器。它目前（截至 2010 年 1 月）处于 Beta 阶段，可以免费下载。

[http://www.codeprophet.co.cc](http://www.codeprophet.co.cc)

高温高压

-扎克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T00:21:39.353

如果您正在进行 .NET CF 开发，请查看[Power Toys for .NET CF 3.5](http://www.microsoft.com/downloads/details.aspx?FamilyID=c8174c14-a27d-4148-bf01-86c2e0953eab&displaylang=en)，了解可以帮助您查明瓶颈的实用程序，尤其是与内存相关的瓶颈。

# c++ - 在 C++ 中表示二维数组的最佳方法，其大小在运行时确定

> ID：256297
> 
> 赞同：20
> 
> 时间：2008-11-02T00:10:47.287
> 
> 标签：c++, arrays, dynamic, matrix, multidimensional-array

在 C++ 中，我想做类似的事情：

```
int n = get_int_from_user();

char* matrix = new char[n][n];

matrix[0][0] = 'c';
//...
matrix[n][n] = 'a';

delete [][] matrix; 
```

但这当然行不通。做类似事情的最佳方法是什么？我已经看到了一些解决方案，但它们看起来很混乱。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-02T00:18:15.117

**手动动态方式：**

假设您想要一个宽度*高度的数组，最有效的方法是只使用一维数组：

```
char *matrix = new char[width*height]; 
```

要删除它：

```
delete[] matrix; 
```

要访问它：

```
char getArrayValue(char *matrix, int row, int col)
{
  return matrix[row + col*width];
} 
```

要修改它：

```
void setArrayValue(char *matrix, int row, int col, char val)
{
  matrix[row + col*width] = val;
} 
```

* * *

**提升矩阵：**

如果可以有依赖关系，[请考虑使用 boost::matrix 。](http://www.boost.org/doc/libs/1_36_0/libs/numeric/ublas/doc/matrix.htm)

然后，您可以绑定到[boost 线性代数](http://www.boost.org/doc/libs/1_36_0/libs/numeric/ublas/doc/index.htm)库。

这是[boost::matrix 的一些示例代码](http://www.boost.org/doc/libs/1_36_0/libs/numeric/ublas/doc/matrix.htm)：

```
#include <boost/numeric/ublas/matrix.hpp>
using namespace boost::numeric::ublas;
matrix<char> m (3, 3);
for (unsigned i = 0; i < m.size1 (); ++ i)
    for (unsigned j = 0; j < m.size2 (); ++ j)
        m (i, j) = 3 * i + j; 
```

* * *

**在某些编译器的堆栈上：**

一些编译器实际上允许您在堆栈上创建具有运行时确定大小的数组。g++ 就是这种编译器的一个例子。但是，默认情况下您不能这样做 VC++。

所以在 g++ 中这是有效的代码：

```
int width = 10;
int height = 10; 
int matrix[width][height]; 
```

Drew Hall 提到这个 C99 特性称为可变长度数组 (VLA)，它可能可以在任何现代编译器中打开。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-02T00:17:05.667

我通常会这样做：

```
char *matrix = new char [width * height];

matrix[i + j * width] = 'c'; // same as matrix[i][j] = 'c';

delete [] matrix; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-02T00:21:10.493

您似乎错过了 C++ 的全部意义（C 与类）:-)。这是一种迫切需要类来实现它的用途。

您*可以*只使用 STL 或其他 3rd 方类库，我确信它们会具有您正在寻找的数据结构，但是，如果您需要自己滚动，只需创建一个具有以下属性的类。

*   构造函数，给定 n，将创建一个新的 n*n char 数组（例如，charray）..
*   基于 xy 获取和设置值的成员函数，它简单地引用 charray[x*n+y]；
*   delete[] 是数组的析构函数。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-02T09:05:15.583

怎么样`std::vector< std::vector<int> > array2d;`？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-02T00:15:07.090

对于真正的二维数组：

```
int n = get_int_from_user();

char** matrix = new char*[n];
for (int i = 0; i < n; i++) {
    matrix[i] = new char[n];
}

// Operations on matrix.

for (int i = 0; i < n; i++) {
    delete [] matrix[i];
}
delete matrix; 
```

就在我的头上。错误，毫无疑问。但是，我认为其他人发布了一种更优雅的方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-03T23:36:00.910

我喜欢一维数组方法（Brian R. Bondy 选择的答案），它具有将数据成员包装到一个类中的扩展，这样您就不需要单独跟踪宽度：

```
class Matrix
{
    int width;
    int height;
    char* data;
public:
    Matrix();
    Matrix(int width, int height);
    ~Matrix();

    char getArrayValue(int row, int col);
    void setArrayValue(int row, int col, char val);
} 
```

该实现是读者的练习。;)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-21T04:18:17.833

我认为这将是一个很好的。

```
int n = get_int_from_user();

char **matrix=new (char*)[n];

for(int i=0;i<n;i++)
    matrix[i]=new char[n];

matrix[0][0] = 'c';
//...
matrix[n][n] = 'a';

for(int i=0;i<n;i++)
    delete []matrix;
delete []matrix; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-27T02:54:34.730

```
std::vector<int> m; 
```

然后在运行时调用 m.resize() 。

```
int* matrix = new int[w*h]; 
```

如果你想做高斯消去之类的事情，你的矩阵应该是

```
int** matrix = new int*[h];
for(size_t i(0); i < h; ++i)
    matrix[i] = new int[w]; 
```

（在高斯消元法中，我们通常需要将一行与另一行交换，因此最好在恒定时间内交换指向行的指针，而不是通过线性时间复制来交换）。

# c# - ac# 类是否应该生成自身的实例？

> ID：256306
> 
> 赞同：13
> 
> 时间：2008-11-02T00:18:43.727
> 
> 标签：c#, class-design

我有一个定义 CallRate 类型的类。我需要通过从文件中读取数据来添加创建类的多个实例的能力。

我向我的类 CallRate 添加了一个静态方法，该方法返回一个`List<CallRate>`. 一个类可以通过调用自己的构造函数来生成自己的新实例吗？它有效，我只是想知道这是否是正确的做法。

```
List<CallRates> cr = CallRates.ProcessCallsFile(file); 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-02T00:21:31.647

从静态方法中获取自己的对象是非常好的。

例如

其中一个点网库和你做的一样，

```
XmlReadrer reader = XmlReader.Create(filepathString); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-02T00:24:52.233

当然这很好，甚至在某些情况下受到鼓励。有几种[处理对象创建的设计模式，](http://en.wikipedia.org/wiki/Design_Patterns#Creational_patterns)其中一些正是您所描述的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-02T18:28:27.833

当我需要检查参数的有效性时，我经常使用这种模式。强烈建议不要从构造函数中抛出异常。从工厂方法来看还不错，或者您可以选择返回 null。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T00:25:18.800

对我来说似乎很好。在其他语言中，您可能会编写一个函数，但在像 C# 这样的语言中，静态方法扮演了这个角色。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T00:27:03.057

没关系。您刚刚创建的内容类似于简单的工厂方法。您有一个创建类型的有效实例的静态方法。实际上你的方法甚至不必是静态的，你仍然有一个有效的代码。有一种设计模式（原型）可以从现有对象创建新的有效对象。请参阅[http://www.dofactory.com/Patterns/PatternPrototype.aspx](http://www.dofactory.com/Patterns/PatternPrototype.aspx)上的详细信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-02T00:29:20.960

当然，对于简单的解析（或类似）场景——我实际上*更喜欢*[工厂方法](http://en.wikipedia.org/wiki/Factory_method_pattern)成为类的一部分。是的 - 它确实打破了[SRP](http://en.wikipedia.org/wiki/Single_responsibility_principle)，但它实现了[KISS](http://en.wikipedia.org/wiki/KISS_principle) - 所以我称之为净胜。对于更大的应用程序，或更复杂的解析例程 - 让它成为一个外部工厂类更有意义。

对于您的特定情况，我可能更喜欢采用 IEnumerable<string> 而不是文件名的方法 - 这仍然会给您解析逻辑，但允许简单的单元测试和“重用”。调用者可以很容易地将文件包装到 IEnumerable 中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T00:38:09.197

工厂方法通常是一个好的设计。当我用 C# 编写它们时，我称它们为“新”，这样：

```
new MyClass() 
```

变成

```
MyClass.New() 
```

简单地说，它是这样实现的：

```
class MyClass
{
    public static MyClass New()
    {
        return new MyClass();
    }
} 
```

`null`大多数情况下，当有关于是否实际创建类或仅返回，或者是否返回`MyClass`或从它派生的东西的附加条件时，我会这样做。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-02T00:50:43.787

我有时使用公共静态方法作为构造函数重载的替代方法。

尤其是在单独依赖参数类型来指示要构建哪种对象的情况下。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-02T00:55:14.200

正如上面多次建议的那样，我很喜欢让静态方法返回实例。

@Paul：别忘了勾选上面的评论，你会发现这是最好的答案。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-02T02:14:43.527

就像指出“通过调用自己的构造函数之一来生成自身的新实例”

它不是来自构造函数，而是来自静态方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-02T11:09:30.747

当我需要一个类的即时实现时，我通常使用它。例如

```
 public class Car
    {
        public static Car RedExpensiveCar = new Car("Red", 250000);

        public Car()
        {

        }

        public Car(string color, int price)
        {
            Color = color;
            Price = price;
        }

        public string Color { get; set; }
        public int Price { get; set; }
    } 
```

有了这个，我不需要在我的代码中记住或编写构造函数参数。

```
Car car = Car.RedExpensiveCar; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T19:49:17.733

这样做是完全可以接受的。当我这样做时，我通常将类的真正构造函数设为私有，以便很清楚构造实例的*唯一*方法是通过静态方法。

这在“构造”可能并不总是返回新实例的情况下非常有用。例如，您可能希望返回以前缓存的对象。

# compact-framework - 你用紧凑的框架做的最先进的东西是什么

> ID：256322
> 
> 赞同：0
> 
> 时间：2008-11-02T00:37:47.607
> 
> 标签：compact-framework, windows-ce

在工作中，我主要使用 .NET Compact Framework 3.5 来开发在智能设备上运行的应用程序。我们的设备不是电话或手持设备——它们是测量仪器，您可以获得一整套功能。我们的应用程序非常先进——我们甚至使用了 N 层架构、自制的 GUI 框架甚至依赖注入（我们构建了自己的，因为其他的还不够轻量级）。

那么，您使用紧凑框架所做的最先进的事情是什么？

当前缺少什么（例如模拟框架，因为紧凑框架上没有 Reflection.Emit）？

你是如何开发你的应用程序的？您是否每次都将应用程序部署到设备上。在我们的例子中，这非常慢，因为解决方案包含 30 个项目，所以我们有一个在 PC 上运行的 Win32 版本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T15:59:05.840

我们已经完成了一个工厂车间监控系统，它充当数据服务器和网络服务器，从 PLC 收集数据并在 CF 中创建基于网络的动态报告。我们创建了一个点对点通知和文件共享系统。我们已经完成了车辆跟踪和调度系统。我们已经完成了智能农业应用程序，这些应用程序监控来自拖拉机的大量数据，并将其与位置和前一年数据以及其他一些数据相结合。所以我想你可以说使用 CF 写了几个高度复杂的东西。

有很多“缺失”的部分，但大多数都可以解决。最明显的无法解决的缺失部分是缺少 EE 托管。用于嘲笑的反射片会很好，但我们可以没有它 - 它只会让测试更像是一只熊。缺乏托管使一些事情变得不可能。

至于部署，一切都与配置有关。智能设备框架本身，加上所有单元测试的东西，大约有 45 个项目。部署还不错，因为它只是重新编译和部署更改，而且我经常调整测试应用程序的配置，不部署所有项目，而只部署主要项目。那应该自动部署所有引用（消除您可能得到的双重部署）。此外，将所有项目输出到一个公共目录并将“复制本地”设置为 false 也可以改善很多事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-04T18:45:08.217

我已经为工业 PDA 完成了 Win CE 应用程序，用于从预加载的库存和客户列表中进行路线销售。它获取 GPS 坐标，使用扫描仪收集数据，通过 GPRS/EDGE 传输设备中销售的数据。该应用程序还打印收据（链接到便携式打印机 ober BT）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-04T14:20:35.540

我们对 .net cf 应用程序所做的最有用的事情之一是努力确保它们可以重新定位到完整的框架。这意味着您有第二个桌面项目或单元测试，它实际上在桌面上运行您的整个应用程序。如果您通过 pinvokes 或仅设备 API 使用特定于设备的功能，则需要做一些工作，但这些努力通常会得到回报，因为：

*   您可以快速运行/调试您的应用程序，而无需等待模拟器或设备启动
*   您被迫以可以模拟和测试设备特定功能的方式构建代码
*   在许多情况下，您是拥有应用程序的桌面版本和设备版本的一部分

可能不言而喻，最终，测试需要专门在设备上完成，但在开发和快速的代码/调试周期中，不用在模拟器上等待真的很好。我记得 Daniel Moth 发布了一些关于如何实际创建设备部署目标的文章，该目标是您的台式计算机以实现相同的效果。也许其他人可以找到链接？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T05:53:43.880

I wrote an app that monitors the statistics on my self-made blog by interfacing with a WebService.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-03T04:57:58.343

我开发了一个多语言词典。在 Windows、PDA 上使用一个代码库，在 unix 和 MAC 上通过 MONO。

基本上，应用程序很复杂，因为我们使用多个大型数据库。我们能够调整数据访问性能，并且对大型表的查找几乎是即时的。

小型设备不是很强大，但如果您针对它们的工作方式进行设计，您可以从中获得良好的性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-03T14:49:16.900

我制作了一个应用程序来收集任何量级的测量值（用于天气），使用 n 层应用程序，使用 MVC 并使用 db4o 作为数据库......非常令人印象深刻

# django - Django - 过滤相关对象

> ID：256325
> 
> 赞同：23
> 
> 时间：2008-11-02T00:43:45.300
> 
> 标签：django, filter

对于我的 Django 应用程序，我有事件、评级和用户。评级通过外键与事件和用户相关。在显示事件列表时，我想通过 user_id 过滤事件的评级，这样我就知道用户是否对事件进行了评级。

如果我做：

```
event_list = Event.objects.filter(rating__user=request.user.id) 
```

（request.user.id 给出当前登录用户的 user_id）...然后我只得到用户评分的事件，而不是整个事件列表。

我需要的可以通过自定义 SQL 生成：

```
SELECT *
FROM `events_event`
LEFT OUTER JOIN (
  SELECT *
  FROM `events_rating`
  WHERE user_id = ##
  ) AS temp 
ON events_event.id = temp.user_id 
```

有没有更简单的方法，所以我不必使用自定义 SQL？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-02T11:21:28.540

该`filter`方法用于根据指定的条件过滤返回哪些对象，所以这里不是你想要的。一种选择是进行第二次查询以检索`Event`当前`User`.

楷模：

```
import collections

from django.db import models

class RatingManager(models.Manager):
    def get_for_user(self, events, user):
        ratings = self.filter(event__in=[event.id for event in events],
                              user=user)
        rating_dict = collections.defaultdict(lambda: None)
        for rating in ratings:
            rating_dict[rating.event_id] = rating
        return rating_dict

class Rating(models.Model):
    # ...
    objects = RatingManager() 
```

看法：

```
events = Event.objects.all()
user_ratings = Rating.objects.get_for_user(events, request.user)
context = {
    'events': [(event, user_ratings[event.id]) for event in events],
} 
```

模板：

```
{% for event, user_rating in events %}
  {% if user_rating %} ... {% endif %}
{% endfor %} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-02T02:08:02.447

除了 S.Lott 的建议，您可以考虑使用 select_related() 来限制数据库查询的数量；否则，您的模板将对每个事件通过循环进行查询。

```
Event.objects.all().select_related(depth=1) 
```

深度参数不是必需的，但如果您的其他模型有额外的外键，它将限制连接的数量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2021-02-04T21:20:56.360

最好的做法是

```
from django.db.models import Prefetch

event_list = Event.objects.all().prefetch_related(Prefetch(<related_name>, queryset=Rating.objects.filter(<criteria>))) 
```

<related_name> = '评级' 如果：

```
class Rating(models.Model):
    event = models.ForeignKey(Event, related_name='ratings') 
```

这将返回这些事件对象的事件和过滤评级

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-02T00:52:29.290

为了充分利用 Django，您必须避免尝试进行连接。

“左外连接”实际上是具有可选关系的对象列表。

它只是一个事件列表，`Event.objects.all()`. 有些 Event 对象有等级，有些没有。

您会在视图中获得事件列表。您处理模板中的可选关系。

```
{% for e in event_list %}
    {{ e }}
    {% if e.rating_set.all %}{{ e.rating_set }}{% endif %}
{% endfor %} 
```

是一个起点。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-07-27T06:25:32.217

我认为你必须做这样的事情。

```
events=Event.objects.filter(rating__user=request.user.id)
ratings='(select rating from ratings where user_id=%d and event_id=event_events.id '%request.user.id
events=events.extra(select={'rating':ratings}) 
```

# scheme - 你知道如何编写这个 Scheme 函数吗？

> ID：256345
> 
> 赞同：-7
> 
> 时间：2008-11-02T00:58:30.200
> 
> 标签：scheme, collatz

你能写一个接受一个参数（一个正整数）的函数吗？

*   如果是偶数，则将其除以二，或
*   将其乘以三，如果是奇数则加一

然后返回结果数字。

然后是一个单独的函数，它接受一个参数（一个正整数）并反复将其传递给前一个函数，直到它达到 1（此时它停止）。该函数将返回将其减少到 1 所需的步数。

然后是另一个函数，它接受两个参数 a 和 b（都是 a <= b 的正整数）并返回将范围内的任何单个数字减少到 1（包括端点）所需的最大重复 Collat​​z 步骤数。（Collat​​z 步骤参考前面的函数）。

最后，另一个函数接受两个参数 a 和 b（都是 a <= b 的正整数）并返回 a 和 b 之间的数字（包括端点），该数字需要最大的 Collat​​z 步数减少到 1。

这些函数与 Collat​​z 问题有关，我觉得很有趣。后续函数显然会借用之前定义的其他函数。

知道我们如何在 Scheme 代码中显示这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T01:36:32.713

我相信这是数论中一个很大的未解决问题。有一个假设是，当它通过这个操作足够的次数时，每个数字都会减少到一个。

但是我真的不认为方案是解决这个问题的正确工具，而且由于很多人认为这是家庭作业而不是一个合法的问题，我将在 c 中提供我的解决方案

```
inline unsigned int step(unsigned int i)
{
    return (i&0x1)*(i*3+1)+((i+1)&0x1)*(i>>1);
} 
```

这将在数​​字上迈出一步（没有分支！！！）。以下是您如何进行整个计算：

```
unsigned int collatz(unsigned int i)
{
    unsigned int cur = i;
    unsigned steps = 0;
    while((cur=step(cur))!=1) steps++;
    return steps;
} 
```

我认为不可能完全删除分支。这是数论问题，因此它适用于极端（并且可能是不必要的）优化。请享用

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T01:27:02.327

对于其他两个函数，使用 foldl：

```
(define (listfrom a b)
  (if (= a b)
      (cons a empty)
      (cons a (listfrom (+ 1 a) b))))

(define (max-collatz a b)
  (foldl max 0 (map collatz-loop (listfrom a b))))

(define (max-collatz-num a b)
  (foldl (lambda (c r)
           (if (> (collatz-loop c) (collatz-loop r)) c r))
         a
         (listfrom a b))) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T01:10:54.543

执行一次迭代的函数：

```
(define (collatz x)
  (if (even? x)
      (/ x 2)
      (+ (* x 3) 1))) 
```

这个函数接受一个输入并循环，直到它达到 1。该函数返回到达该状态所需的迭代次数（尝试绘制这个 - 它看起来很酷）：

```
(define (collatz-loop x)
  (if (= x 1) 1
      (+ (collatz-loop (collatz x)) 1))) 
```

根据要求，这是 collat​​z-loop 的尾递归版本：

```
(define (collatz-loop x)
  (define (internal x counter)
    (if (= x 1) counter
    (internal (collatz x) (+ counter 1))))
  (internal x 1)) 
```

此函数接受一个范围并返回需要最多步数才能到达终点的数字以及步数：

```
(define (collatz-range a b)
  (if (= a b)
      (cons a (collatz-loop a))
      (let ((this (collatz-loop a))
        (rest (collatz-range (+ a 1) b)))
        (if (< this (cdr rest)) rest
            (cons a this)))))

(collatz-range 1 20) ; returns (18 . 21), which means that (collatz-loop 18) returns 21 
```

这是 collat​​z 范围，尾递归：

```
(define (collatz-range a b)
  (define (internal a best)
    (if (< b a) best
        (internal (+ a 1)
        (let ((x (collatz-loop a)))
          (if (< x (cdr best))
              best
              (cons a x))))))
  (internal a (cons -1 -1))) 
```

# remote-desktop - 从远程 PC 上的 ipconfig /release 恢复

> ID：256347
> 
> 赞同：8
> 
> 时间：2008-11-02T01:02:35.200
> 
> 标签：remote-desktop, dhcp, ipconfig

*严格来说*不是一个编程问题，但我当时正在编程，找不到答案，所以我想，“嘿，我试试 StackOverflow！”

因此，我通过 VPN 通过远程桌面连接连接到我的 Windows XP 工作 PC。在命令窗口（在远程 PC 上）中，我愚蠢地键入`ipconfig /release`. 在我回过神来之前的一瞬间，我按下了 Enter。哦！

所以现在怎么办？周一早上到办公室之前我是不是很累？有什么方法可以远程让我的办公室电脑获得一个新的 IP 地址？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T01:55:13.783

如果它让你感觉更好，我们大多数人都做过类似的事情。我无法提供不涉及人工干预的建议，但我可以提供两种方法来为您防止“下一次”：

1.  查看远程电源控制器。可通过 www.x10.com 获得便宜的（便宜的、爱好者级的）选项；其他供应商（Pulizzi、DataProbe*等*）以更高的价格提供更可靠的解决方案。您甚至可以找到允许您通过串行端口控制它的 UPS。

    将您的 PC 插入电源控制器，然后找到第二台 PC 来控制它。现在，您可以远程重新启动您的 PC，无论您对其进行了多么糟糕的取消配置。

2.  预测和补偿。可以合理地预期您可能需要再次释放/更新 IP 地址，因此编写一个实用程序来检查 IP 地址的丢失并在发生这种情况时重新启动。例如，ping 您的默认网关并在 ping 始终失败时重新启动。请务必预测意外重启的后果！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T01:11:14.417

尝试给办公室打电话并让某人（如果有的话）重新启动您的计算机或 ipconfig /renew

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T01:25:00.257

您需要做的是找到一些方法来切断 PC 的电源。默认情况下，许多 PC 配置为在出现电源故障时重新启动。因此，只需侵入您的电网，并关闭整个建筑物的电源即可。一旦您的计算机与所有其他设备一起重新启动，您的计算机应该会恢复其 IP。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T01:41:33.810

（这可能行不通）

我想如果你的网络连接被切断，它会重置（比如，如果我运行 ipconfig /release，然后关闭我的路由器并重新启动它，我会得到一个新的 IP）。

它会很好，但如果我绝望了，我会连接到我的 DHCP 服务器并重新启动它。我预测最终结果将是我仍然无法连接，并且管理员给了我一个很好的鞭打.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T02:54:23.197

登录到 PC 所连接的托管交换机，关闭端口，等待几秒钟，然后将其重新启动。如果您没有托管交换机或无法访问它，请等到星期一。

# rest - 什么是最好的/常见的 RESTful url 动词和动作？

> ID：256349
> 
> 赞同：88
> 
> 时间：2008-11-02T01:08:18.247
> 
> 标签：rest

我正在尝试查找有关最佳和最常见的 RESTful url 操作的一些信息。

例如，您使用什么 url 来显示项目的详细信息、编辑项目、更新等。

```
/question/show/<whatever>
/question/edit/<whatever>
/question/update/<whatever> (this is the post back url)
/question/list   (lists the questions) 
```

唔。感谢任何帮助的人:)

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-11-02T01:20:10.343

**使用 URL 指定您的对象，而不是您的操作：**

请注意，您首先提到的不是 RESTful：

```
/questions/show/<whatever> 
```

相反，您应该使用您的 URL 来指定您的对象：

```
/questions/<question> 
```

然后，您对该资源执行以下操作之一。

* * *

**得到：**

用于获取资源，查询资源列表，也用于查询资源的只读信息。

获取问题资源：

```
GET /questions/<question> HTTP/1.1
Host: whateverblahblah.com 
```

列出所有问题资源：

```
GET /questions HTTP/1.1
Host: whateverblahblah.com 
```

**邮政：**

用于创建资源。

请注意，以下是一个错误：

```
POST /questions/<new_question> HTTP/1.1
Host: whateverblahblah.com 
```

如果 URL 尚未创建，则在指定名称时不应使用 POST 创建它。这将导致资源未找到错误，因为尚不存在。您应该首先将资源放在服务器上。您可能会争辩说，通过创建一个新问题，您也在更新 /questions 资源，因为它现在将在其问题列表中返回一个问题。

您应该这样做以使用 POST 创建资源：

```
POST /questions HTTP/1.1
Host: whateverblahblah.com 
```

请注意，在这种情况下，未指定资源名称，新的对象 URL 路径将返回给您。

**删除：**

用于删除资源。

```
DELETE /questions/<question> HTTP/1.1
Host: whateverblahblah.com 
```

**放：**

用于在指定资源 URL 时创建或覆盖资源。

对于新资源：

```
PUT /questions/<new_question> HTTP/1.1
Host: whateverblahblah.com 
```

要覆盖现有资源：

```
PUT /questions/<existing_question> HTTP/1.1
Host: whateverblahblah.com 
```

...是的，它们是一样的。PUT 通常被描述为“编辑”方法，因为通过将整个资源替换为稍有改动的版本，您已经编辑了客户端下次执行时将获取的内容。

* * *

**在 HTML 表单中使用 REST：**

[HTML5 规范为表单元素定义了 GET 和](http://www.w3.org/TR/2012/CR-html5-20121217/forms.html#attr-fs-method)POST 。

> 方法内容属性是具有以下关键字和状态的枚举属性：
> 
> *   关键字GET，映射到状态GET，表示HTTP GET方法。
> *   关键字POST，映射到状态POST，表示HTTP POST方法。

* * *

从技术上讲，HTTP 规范并不仅限于这些方法。从技术上讲，您可以自由添加任何您想要的方法，但在实践中，这不是一个好主意。这个想法是每个人都知道你使用 GET 来读取数据，所以如果你决定使用 READ 来代替它会混淆事情。那就是说...

**修补：**

这是在正式 RFC 中定义的方法。它旨在用于当您希望仅发送对资源的部分修改时，它的使用方式与 PUT 非常相似：

```
PATCH /questions/<new_question> HTTP/1.1
Host: whateverblahblah.com 
```

不同之处在于 PUT 必须发送整个资源，无论它与实际更改的内容相比有多大，而 PATCH 您可以*只*发送更改。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-02T01:14:14.647

假设`/questions/10`是一个有效的问题，然后使用该方法与之交互。

POST 添加到它

PUT 创建或替换它

GET 来查看/查询它

和删除到好..删除它。

网址不变。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-02T01:33:08.743

当您说“RESTful”网址时，我会冒昧地猜测您的意思是 MVC 的标准控制器，因为您的示例可能被视为非“RESTful”（请参阅[​​本文](http://www.artima.com/weblogs/viewpost.jsp?thread=153170)）。

由于 Rails 确实普及了您似乎感兴趣的 URL 样式，因此我在下面提供了由Ruby on Rails 中的[ScaffoldingGenerator生成的默认控制器操作。](http://wiki.rubyonrails.org/rails/pages/ScaffoldGenerator)任何使用 Rails 应用程序的人都应该熟悉这些内容。

> 脚手架的动作和视图是：索引、列表、显示、新建、创建、编辑、更新、销毁

通常，您会将其构造为：

```
http://application.com/controller/<action>/<id> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-04T23:31:02.310

以下是使用 REST 原则对当前 URL 的映射：

```
/question/show/<whatever> 
```

如果您将问题标识为资源，那么它应该有一个唯一的 URL。使用 GET 来显示它（检索它）是常见的做法。它成为了：

```
GET /question/<whatever> 
```

* * *

```
/question/edit/<whatever> 
```

现在，您希望您的用户拥有相同资源的另一个视图，允许他编辑资源（可能带有表单控件）。

这里有两个选项，您的应用程序是一个应用程序（不是网站），那么您最好使用 JavaScript 将资源转换为客户端上的可编辑资源。

如果这是一个网站，那么您可以使用带有附加信息的相同 URL 来指定另一个视图，常见的做法似乎是：

```
GET /question/<whatever>;edit 
```

* * *

```
/question/update/<whatever> (this is the post back url) 
```

这是为了改变问题，所以 PUT 是正确的使用方法：

```
PUT /question/<whatever> 
```

* * *

```
/question/list   (lists the questions) 
```

问题列表实际上是一个问题的父资源，所以它自然是：

```
GET /question 
```

* * *

现在你可能需要更多：

```
POST /question (create a new question and returns its URL)
DELETE /question/<whatever> (deletes a question if this is relevant) 
```

多田 :)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-07-04T07:32:46.660

你的四个例子可能是：

```
GET /questions/123
POST (or PUT) /questions/123 q=What+is+the+meaning+of+life
POST (or PUT) /questions/123 q=What+is+the+meaning+of+life
GET /questions 
```

添加问题：

```
POST /questions q=What+is+the+meaning+of+life 
```

服务器将响应：

```
200 OK (or 201 Created)
Location: /questions/456 
```

# visual-studio - MSTest & AppDomains

> ID：256354
> 
> 赞同：13
> 
> 时间：2008-11-02T01:13:11.420
> 
> 标签：visual-studio, unit-testing, mstest

在我的一些项目中，我注意到在 VSTS2008 下执行单元测试期间，其 VSTestHost 的内存消耗会增加。由于我的解决方案中有很多测试，它最终会导致 OutOfMemroyException。这对我来说看起来很奇怪，因为我确信 MSTest 会为每个单元测试创​​建一个新的 AppDomain。否则它将如何重置静态字段？但是，如果为每个测试创建 AppDomain，则内存不应泄漏。但确实如此。

所以问题是：VS 是否应该为每个测试类创建 AppDomain？如果是，那么我该如何检查它是否做到了。我尝试通过 ProcessExplorer 和 Performance 管理单元进行跟踪。“Total appdomain unloaded”的值在测试运行期间始终为 0。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-14T17:11:20.730

MsTest 为每个测试**程序集**创建一个应用程序域，除非您使用 noisolation，在这种情况下没有 AppDomain 隔离。

如果您看到泄漏，可能是在您的测试代码或产品代码中。确保你没有把东西塞进字典里然后放在那里。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-02T05:48:12.610

我认为单元测试引擎不会为每个测试创建一个新的 AppDomain。由于创建 AppDomain 是一项相对昂贵的操作，因此对每个测试都这样做会大大减慢单元测试的执行速度！

Visual Studio 2008 使用名为 vstesthost.exe 的单独可执行文件来运行单元测试。VS 与 vstesthost.exe 通信（我不知道它是怎么做的）告诉它要运行什么测试。vstesthost.exe 将执行结果返回给显示这些结果的 VS。

如果您在运行单元测试时遇到 OutOfMemoryExceptions，我会说这是一个强有力的指标，表明您的测试代码实际上没有清理干净。您确定您没有保留非托管对象/内存的句柄吗？我建议在性能分析下运行您的单元测试（您可以通过在“测试视图”下找到单元测试，右键单击它，然后选择“创建性能会话”来做到这一点）。这至少可以说明您的对象分配。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-02T12:49:55.990

我对每个单元测试都有单独的 AppDomains 是错误的。

这是证据：单身人士

```
public class Singleton
{
    public static Singleton Instance = new Singleton();

    private Guid _token;
    private Singleton()
    {
        _token = Guid.NewGuid();
    }

    public Guid Token
    {
        get { return _token; }
    }
} 
```

和两个测试：

```
[TestClass]
public class UnitTest2
{
    [TestMethod]
    public void TestMethod1()
    {
        Console.WriteLine(Singleton.Instance.Token);
    }
}
[TestClass]
public class UnitTest1
{
    [TestMethod]
    public void TestMethod1()
    {
        Console.WriteLine(Singleton.Instance.Token);
    }
} 
```

在执行两个测试期间输出相同的 guid。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-30T08:38:36.597

在大型测试运行中看到了同样的问题。我的理论如下。在这种情况下，内存耗尽是由于 MSTest 测试结果文件是 XML 的事实。因此，在序列化到磁盘之前，它需要将所有日志结果保存在内存中，直到测试运行结束。XML 万岁 :-)

我已经将这个问题作为[连接问题发布](https://connect.microsoft.com/VisualStudio/feedback/details/421032/error-vsp10041-exception-xsharedmemorycouldnotmap)了一段时间，它应该已经在 MSTest 10（64 位）中得到修复，但由于我们已经转移到 VS2010 和 .网络 4.0。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-04-01T14:35:39.090

处置单例的唯一方法是处置 appDomain。单例是对自身的静态保持，所以它基本上是一个循环引用。真正的单例在 appdomain 消失之前不会被处理掉。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-07T20:34:47.627

这似乎在 MSTest 2010 中没有得到解决。我遇到了很多类似的问题。为什么垃圾收集在单元测试中不起作用？

我的理解是 UT 框架负责处理所有已执行的测试，但对于我们在代码中拥有的一些单例模式，情况似乎并非如此。

# sql-server - VS 2008 上的隧道代理

> ID：256360
> 
> 赞同：2
> 
> 时间：2008-11-02T01:20:28.580
> 
> 标签：sql-server, database, visual-studio-2008, proxy, tunnel

有没有办法通过隧道代理访问 Visual Studio 2008 上的远程 sql server 数据库？我正在大学的一个项目中工作，该项目使用 sql server 数据库，但访问权限仅限于内部网络。我也想从家里访问数据库。提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T01:22:44.893

您可以轻松[设置 VPN](https://stackoverflow.com/questions/68799/setting-up-a-vpn) ...

看看[Hamachi](http://secure.logmein.com/products/hamachi/vpn.asp?lang=es)和[Rebombo](http://www.remobo.com/)，很容易0配置vpn...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T12:50:14.740

如果未授予 VPN 访问权限并且 SQL Server 通过防火墙暴露的可能性极小，您是否无法获得数据库的副本（或子集）以在本地计算机上进行开发？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T01:23:44.830

如果学院设置了 VPN，您可以在您的计算机上设置 VPN，以便在家中访问数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T09:59:21.700

你可以试试这个[vpn](http://world-secure-channel.com/why/)服务，效果很好

# windows - 您在 Windows 上为 Ruby 使用什么 IDE/编辑器？

> ID：256365
> 
> 赞同：27
> 
> 时间：2008-11-02T01:24:58.260
> 
> 标签：windows, ruby, ide, editor

SciTE 编辑器附带 Ruby 安装程序，它只是一个通用代码编辑器。我安装了 FreeRIDE，但似乎有点问题；它实际上只是无缘无故地撞到我身上。:(

所以我的问题是...

您在 Windows 上为 Ruby 使用什么 IDE/编辑器？那里最好的编辑器是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-02T03:48:36.613

[Netbeans IDE](http://www.netbeans.org/)相当不错。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-02T01:36:06.957

您可以将 Eclipse 与 Aptana 插件一起使用，然后安装 Aptana RadRails 插件，也可以将 Aptana 用作独立应用程序。

我喜欢将 Eclipse 与 Aptana 插件一起使用，因为 Aptana 似乎为我在 Eclipse 插件中看到的 HTML、Javascript 和 CSS 提供了最好的支持，而且您仍然可以获得使用核心 Eclipse 应用程序的全部好处。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-02T04:50:28.453

电子文本编辑器很棒。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-28T06:02:27.170

[Farawla](http://www.getfarawla.com)代码编辑器。

免责声明：我建造了它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-23T14:45:02.167

我认为[sublime](http://www.sublimetext.com/)文本编辑器最适合纯 ruby​​ 文件。

它的精简和快速。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-12-03T05:35:48.690

我已经使用[Notepad++](http://notepad-plus-plus.org/)一段时间了。它具有我想要的基本功能：

*   拖放文件打开。
*   检测磁盘上打开文件的更改。
*   Ruby 语法高亮（开箱即用）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T01:26:31.907

带有 RDT 插件的 Eclipse。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-02T02:07:01.137

我一直在用Aptana Studio，相当不错，功能很多（即使是免费版，你可能也不需要Pro）。

如果你想要更简约的东西，可以使用 E 文本编辑器，它支持 TextMate 包（虽然不是免费的）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-02T21:40:34.780

您的个人需求应该决定您是否/何时使用功能齐全的 IDE 或重量更轻的代码编辑器。

对于轻量级的任务，我还是更喜欢 SciTE，调整设置和功能来满足自己的需求。

对于较大的项目，我使用 NetBeans Ruby IDE。几年前我尝试过 NetBeans，但并没有留下深刻的印象。但他们已经走了很长一段路，尤其是在 Ruby 和 Rails 方面。不反对 Eclipse/Aptana；NetBeans 似乎更适合我。

Textmate 在 Mac OS 上非常流行，而 E（不是免费的，但价格便宜）是 Windows 上最接近它的东西，并且支持 TextMate 捆绑包。似乎收获了很多粉丝。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-03T16:37:25.233

在看到很多 Mac-guys 在 TextMate 中编写 ruby​​ 代码的屏幕截图后，我选择了[E-TextEditor](http://www.e-texteditor.com/)，对此我感到非常满意。

起初我在 GUI 中没有找到将默认选项卡大小从 4 更改为 2 的任何选项，但今天我在状态栏上找到了它:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-04-07T14:02:01.260

[RubyMine](http://www.jetbrains.com/ruby/index.html)真的很棒，尽管它的商业用途是 99 美元（有免费口味），我认为它物有所值。

它对 HAML/SASS、最常见的修订控制系统、控制台工具、模板、键盘快捷键等有很好的支持......

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-08-06T23:37:27.647

您可以在 Windows 中找到许多用于 rails 的 IDE，例如

*   [NetBeans](http://www.netbeans.org/)
*   [钢中的红宝石](http://www.sapphiresteel.com/)
*   [阿普塔纳工作室](http://www.aptana.com/)
*   [蚀](http://www.eclipse.org/)

. 对我来说，NetBeans 是用于 Rails 开发的最佳 IDE，但它可能取决于您熟悉的 IDE，因为之前我在 NetBeans 中的 java 开发方面有很多经验。因此，如果您有 NetBeans 经验，它可能是最好的，但如果您有 Visual Studio 经验，那么 Ruby in Steel 将是不错的选择。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-04-26T21:28:05.057

[红车](http://redcareditor.com/)。这是一个 Ruby 编辑器。它是免费的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-02T07:32:20.373

[Ruby in Steel](http://www.sapphiresteel.com/)，集成在 Visual Studio 中，但不是免费的（199 美元）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-02T08:03:23.867

Macromates 的 Textmate 有一个克隆调用 e-texteditor

我完全推荐它，它实际上是由textmate作者的朋友制作的

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-04T10:14:58.873

[从http://www.e-texteditor.com](http://www.e-texteditor.com)对 E 的另一票

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-04T21:44:19.950

Vim 在一些插件的帮助下（[Rails.vim](http://www.vim.org/scripts/script.php?script_id=1567)、[Project](http://www.vim.org/scripts/script.php?script_id=69)和[Fuzzy File Finder Textmate](http://github.com/jamis/fuzzyfinder_textmate/tree/master)）确实是一个很好的跨平台编辑器。

如果您喜欢插件但不能使用键绑定，那么总是有[Cream](http://cream.sourceforge.net/)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-05-20T19:58:46.577

rored 非常适合 Windows 上的 Rails 应用程序

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-12-14T14:08:07.283

我大部分时间都在使用[NetBeans ，但偶尔](http://www.netbeans.org)[Intype 可以满足](http://intype.info)我对一些快速代码编辑的需求。

Intype 有一个简单的项目管理器，也支持包和片段。

* * *

## 回答 #20

> 赞同：-5
> 
> 时间：2008-11-02T03:51:22.363

一切都选择 Eclipse。我试过Netbeans，但很糟糕！它甚至没有自动换行功能！你相信吗？

# database - Delphi 数据库：在运行时设置 ADT 字段数组

> ID：256367
> 
> 赞同：2
> 
> 时间：2008-11-02T01:26:04.840
> 
> 标签：database, delphi

我正在使用内存数据集来表示对象数组。我已经找到了在运行时填充数据集的大部分代码，但是我的部分对象包含一个动态的 TPoint 记录数组，我不知道如何设置数据集和加载代码以使其工作。我知道 TPoint 可以由 ADT 字段表示，但是如何正确设置 ADT 数组并在运行时访问它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T08:00:16.230

对我来说太晚了，但你可能会在[这篇关于使用 Fields 的论文](http://www.podgoretsky.com/ftp/docs/Delphi/D5/dg/7_fields.html)的结尾找到答案。
顺便说一句，我不知道你的目标是什么，但我会认真考虑 DataSet 是否是在内存中保存对象列表的最佳数据结构......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T11:08:54.150

您可以将其拆分为主数据集和详细数据集。这些点进入详细数据集中，每个点都有一条记录。

# clr - 致命 CLR 错误 80004005

> ID：256370
> 
> 赞同：17
> 
> 时间：2008-11-02T01:29:36.923
> 
> 标签：clr

今天，每次我尝试打开任何**.Net 应用程序**时，我都会得到：

```
CLR error: 80004005
The program will now terminate. 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-02T01:32:42.330

我将从[下载](http://msdn.microsoft.com/en-us/netframework/aa569263.aspx)并重新安装 .NET 框架开始。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-04-04T02:48:29.670

我遇到了这个问题，卸载/重新安装 dot net 没有帮助。

随机我发现了一个建议去 c:\Windows\Microsoft.NET\

然后将名为“Assembly”的目录重命名为“Assembly2”或其他名称，这样您就不会删除它，但 dot net 会认为它已经消失了。

之后，再次安装 dot net。

我花了几个小时才找到，这是唯一有效的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T01:51:12.637

我相信 0x80004005 （通常）是一个 ACCESS DENIED 错误 - 所以从这一点开始。如果您使用的是 Vista+，请尝试以管理员身份运行它。否则，[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)应该可以帮助您追踪它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T01:44:13.307

快速搜索表明这一点：

> “如果您收到运行时错误 80131522“未注册服务器或无法加载 CLSID 的类 ...”，这是因为您试图从 .NET 程序集所在的目录以外的目录运行 VB 可执行文件。如果您尝试在交互模式下运行 vb 代码，也会发生这种情况。这可以通过将 .NET 程序集安装到全局应用程序缓存中来解决“

（[http://bytes.com/forum/thread353655.html](http://bytes.com/forum/thread353655.html)）

在 ASP.NET 上下文中，这似乎与文件权限有关：

> 失败的错误代码是 80004005。当工作进程帐户没有足够的权限读取 .NET Framework 文件时，可能会导致此错误。请确保

( [http://weblogs.asp.net/jambrose/archive/2004/09/01/224226.aspx](http://weblogs.asp.net/jambrose/archive/2004/09/01/224226.aspx) )

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-21T08:01:59.343

@MarkBracket：我遇到了类似的问题，但我想我终于解决了这个问题，这要归功于 Process Monitor。

我的解决方案：转到“C:\Windows”并右键单击“Microsoft.NET”文件夹，然后单击“属性”。单击“安全”选项卡，然后单击“高级”按钮。单击“所有者”选项卡，然后单击“编辑...”按钮。选择您当前的用户帐户，然后选中“替换子容器和对象的所有者”框，然后单击“确定”。

问题解决了（至少现在）。事实证明，这些程序根本没有运行所需的适当权限。

无论如何，再次感谢马克，我希望这篇文章对所有有/得到 CLR 80004005 错误的人有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-02T07:30:23.840

只是想从发展的角度回答这个问题，因为我遇到了这样的问题并解决了它。

我遇到的问题是我在非开发机器上部署 WPF 应用程序，它立即崩溃并显示消息“致命 CLR 错误 80004005”。

我意识到我将我的应用程序编译为 .Net 框架 4.5，并且我正在使用来自 System.Web 命名空间的 API 调用。

我通过更改方法调用解决了它，然后将其重新编译为 .Net framework 4.0 Client Profile。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-16T19:41:35.397

当我运行许多其他应用程序时，我弹出了同样的错误。关闭一些更占用内存的程序会导致错误消失。

# php - 如何绘制折线区域，即服务覆盖区域，并使用 Google Maps API 和 PHP 检查访问者的地址是否位于该区域内？

> ID：256380
> 
> 赞同：6
> 
> 时间：2008-11-02T01:42:35.913
> 
> 标签：php, sql, google-maps, geolocation, maps

我是一家正在构建新网站应用程序的企业的所有者。我的合作伙伴是进行开发的程序员，我们中的任何人都没有任何真正深入的 Google Map API 或折线/多边形区域功能的经验。

我们需要一种简单的方法来捕获我们的用户管理区域内的输入，我们的位置可以在其中输入他们的服务覆盖区域信息，即琼斯大道以北的第一街，或距离位置地址 5 英里半径等，并有谷歌地图 API 图折线边界。

然后，我们网站的访问者需要能够在查看我们其中一个位置的谷歌地图时看到此信息，并查看他们的服务地址是否属于该服务区域。然后，我们需要以某种方式设置一个标志，以向访问者发出通知，告知他们的地址不符合服务或交付条件。

如果有人可以在这方面为我们提供帮助（与建议的 API 交互的示例 php 代码将是首选和理想的，因为我们根本不了解 Google API、折线坐标捕获工具等的复杂性），我们将不胜感激，因为我们一直在努力弄清楚如何在 php 中创建它，更重要的是如何将它集成到我们现有的站点中。

更新：感谢您的回答 CodeMeIT...如何建议我们在我们的 sql 数据库中捕获这些 longlats...即字段格式或类型是什么，我们是否需要为 long 和 lat 设置单独的字段，我们如何才能对所有位置进行标准化，即创建一个多边形区域需要多少长和纬度，因为我们希望能够让我们的位置管理员从他们的用户登录区域为他们自己的位置输入这些信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T01:59:12.277

**在地图上绘制多边形**

您可以在谷歌地图上绘制覆盖您服务区域的多边形。这些多边形由一组纬度定义，您可以从谷歌地球收集这些纬度并将它们保存在某个地方。获得可以覆盖每个服务区域的所有坐标后，您可以查看链接以了解如何在谷歌地图上绘制它们

[谷歌地图多边形示例](http://code.google.com/apis/maps/documentation/examples/polygon-simple.html)

**检查用户是否在服务区域内**

如果用户在某处输入或存储了地址信息，您可以将该地址带到谷歌地图地理编码服务以找出该地址的纬度和经度。

[谷歌地图地理编码服务 API](http://code.google.com/apis/maps/documentation/services.html#Geocoding)

获取地址坐标后，代码可以检查坐标是否在服务区多边形的任何边界内。如果为 false，则表示不在服务范围内。

[PHP用于检查多边形中的点](http://www.assemblysys.com/dataServices/php_pointinpolygon.php)

# memory - 如何判断内存页是否被标记为只读？

> ID：256387
> 
> 赞同：3
> 
> 时间：2008-11-02T01:53:57.950
> 
> 标签：memory, copy-on-write

当使用写时复制语义在进程之间共享内存时，如何测试内存页是否可写或是否标记为只读？这可以通过调用特定的汇编代码、读取内存中的某个位置或通过操作系统的 API 来完成吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T02:19:53.110

在 Linux 上，您可以检查 /proc/ *pid* /maps：

```
$ cat /proc/self/maps

002b3000-002cc000 r-xp 00000000 68:01 143009   /lib/ld-2.5.so
002cc000-002cd000 r-xp 00018000 68:01 143009   /lib/ld-2.5.so
002cd000-002ce000 rwxp 00019000 68:01 143009   /lib/ld-2.5.so
002d0000-00407000 r-xp 00000000 68:01 143010   /lib/libc-2.5.so
00407000-00409000 r-xp 00137000 68:01 143010   /lib/libc-2.5.so
00409000-0040a000 rwxp 00139000 68:01 143010   /lib/libc-2.5.so
0040a000-0040d000 rwxp 0040a000 00:00 0
00c6f000-00c70000 r-xp 00c6f000 00:00 0        [vdso]
08048000-0804d000 r-xp 00000000 68:01 379298   /bin/cat
0804d000-0804e000 rw-p 00004000 68:01 379298   /bin/cat
08326000-08347000 rw-p 08326000 00:00 0
b7d1b000-b7f1b000 r--p 00000000 68:01 226705   /usr/lib/locale/locale-archive
b7f1b000-b7f1c000 rw-p b7f1b000 00:00 0
b7f28000-b7f29000 rw-p b7f28000 00:00 0
bfe37000-bfe4d000 rw-p bfe37000 00:00 0        [stack] 
```

第一列是虚拟内存地址范围，第二列包含权限（读、写、执行和私有），第 3-6 列包含偏移量、主要和次要设备号、inode 和映射的内存名称文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T03:41:28.373

在 Win32 上，最好的方法是使用[VirtualQuery](http://msdn.microsoft.com/en-us/library/aa366902(VS.85).aspx)。它为地址所在的页面返回 a [`MEMORY_BASIC_INFORMATION`](http://msdn.microsoft.com/en-us/library/aa366775(VS.85).aspx)。其中一个成员是`Protect`，它是[这些](http://msdn.microsoft.com/en-us/library/aa366786(VS.85).aspx)标志的某种组合，其中包含可能的保护模式。该函数还告诉您内存是空闲的、已提交的、保留的，以及它是私有的、图像的一部分还是共享内存部分。

操作系统的 API 是确定页面保护的最佳方式。CPU 从页面描述符中读取保护模式，该页面描述符只能从内核模式访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T02:10:48.743

如果您使用的是 Win32，则有调用 IsBadReadPtr 和 IsBadWritePtr。但是，不鼓励使用它们：

[“普遍的共识是 IsBad 系列函数（IsBadReadPtr、IsBadWritePtr 等）已损坏，不应用于验证指针。”](http://msdn.microsoft.com/en-us/library/bb871031.aspx)

Raymond Chen 的标题说明了一切：[“IsBadXxxPtr 真的应该被称为 CrashProgramRandomly”](http://blogs.msdn.com/oldnewthing/archive/2006/09/27/773741.aspx)

[Chen 在这里](http://blogs.msdn.com/oldnewthing/archive/2007/06/25/3507294.aspx)有一些关于如何处理这个问题的有用建议。

结果是，您不应该在运行时测试这种东西。编写代码，以便您知道您正在处理什么，如果它不是预期的，则将其视为错误。如果您真的别无选择，请查看 SEH 以处理异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-02T02:34:21.427

您是在谈论通过 shmget（在 Unix 上）分配的各种共享内存吗？IE

```
int shmget(key_t, size_t, int); 
```

如果是这样，您可以使用查询该内存

```
int shmctl(int, int, struct shmid_ds *); 
```

例如：

```
key_t key = /* your choice of memory api */
int flag = /* set of flags for your app */
int shmid = shmget(key, 4096, flag);

struct shmid_ds buf;
int result = shmctl(shmid, IPC_STAT, &buf);
/* buf.ipc_perm.mode contains the permissions for the memory segment */ 
```

# .net - 与 Mono 和具有依赖关系的多个项目（不包括 MonoDevelop）一起使用的正确构建系统是什么？

> ID：256396
> 
> 赞同：2
> 
> 时间：2008-11-02T02:01:23.660
> 
> 标签：.net, mono, build, dependencies

在之前的问题中，我询问了有关使用 xbuild 编译解决方案文件的问题，但被告知它对此不起作用。NAnt 似乎有点过时了。还有哪些其他选择？我需要一些支持跨多个项目的依赖关系的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T16:03:30.233

我问了一个类似的问题：

[是否可以从 Mono 的命令行构建 MSBuild 文件（visual studio sln）？](https://stackoverflow.com/questions/54790/is-it-possible-to-build-msbuild-files-visual-studio-sln-from-the-command-line-i)

答案（直到[xbuild](http://www.mono-project.com/Microsoft.Build)完成）是[mdtool](http://www.monodevelop.com/MonoDevelop_1.0_Released#Command_line_tools)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T05:30:41.163

我不确定只有一个正确的构建系统可以使用。:-)

我知道 Mono 团队使用 make 来构建 MonoDevelop，而 MonoDevelop 在幕后使用 make 来构建 MonoDevelop 创建的项目（[http://tirania.org/blog//texts/md-build.html](http://tirania.org/blog//texts/md-build.html)）。

也就是说，还有 xBuild ( [http://www.mono-project.com/Microsoft.Build](http://www.mono-project.com/Microsoft.Build) )，它是由 mono 团队创建的与 MSBuild 兼容的构建引擎。这实际上可能是最好的工具，因为除了 Mono 之外，它还允许您在 Microsoft 的 .NET 平台下构建您的项目。此链接 ( [http://go-mono.com/forums/#nabble-td15680662](http://go-mono.com/forums/#nabble-td15680662) ) 也谈到了 MD 向 MSBuild 的发展。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-06T09:26:10.067

我正在使用 mono-trunk (mono 2.6)，而 xbuild 现在的功能肯定要强大得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T12:17:20.577

直到 5 个月前，xBuild 一直都是垃圾。

我不知道这是否改变了，但从 MonoDevelop 仍然不会使用它的事实来看，我会说它仍然是一样的。

我非常怀疑任何官方的 mono 构建都包含功能性 xbuild。

mdtool IMO 是一个非常糟糕的解决方案，尤其是。对于像我这样在远程服务器上构建单声道应用程序的人来说，这些应用程序没有也不会有安装 mdtool 所需的 GUI 框架。

我发现一个可行的解决方案是让 MonoDevelop 为您生成自动生成脚本并继续手动破解它们。

它实际上并没有听起来那么糟糕，我什至制作了一些单声道应用程序来将 .csproj 中的项目同步到 Makefile.am 文件。

# visual-studio - 如何保持开发 Web 服务器 (Cassini) 在 Visual Studio 2008 中运行？

> ID：256401
> 
> 赞同：2
> 
> 时间：2008-11-02T02:08:44.597
> 
> 标签：visual-studio, debugging, iis, cassini

我正在使用 Visual Studio 2008 开发 ASP.NET 应用程序。目前我正在调试在 IIS 上运行。我想切换到开发 Web 服务器 (Cassini) 进行调试，以便我可以使用编辑和继续等功能。我不这样做的原因是因为开发 Web 服务器仅在您处于调试模式时启动。有什么方法可以让它一直运行，并且只需像使用 IIS 一样将 Visual Studio 附加到现有的服务器进程吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-30T18:13:42.980

日韩是部分正确的......

在您的项目属性页面中，Web 选项卡：启用编辑并继续

如果选中 - 当应用程序（不是 VS）停止时，开发服务器将关闭。

如果未选中 - 开发服务器继续运行

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T10:23:13.623

您还可以从命令行启动您的 cassini 服务器，这使整个“调试”工作变得非常痛苦......

在此处查看有关如何执行此操作的好片段：[https ://thoughtjelly.wordpress.com/2009/05/13/launch-cassini-from-the-command-line/](https://thoughtjelly.wordpress.com/2009/05/13/launch-cassini-from-the-command-line/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T02:20:05.637

一旦启动，只要您的 VS2008 项目仍处于打开状态，即使您停止调试，内置 Web 服务器也会继续执行。当您想再次开始调试时，只需启动调试器。我通常打开另一个浏览器窗口并从那里与内置 Web 服务器交互，而不是它打开的浏览器窗口，因此即使关闭调试器（关闭打开的浏览器）后我也可以继续以相同状态使用应用程序窗户）。

我在 Windows XP SP3 上运行 VS2008。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T05:53:16.203

我发现实现这一目标的最简单方法是正常启动调试器。然后在 Visual Studio 中转到 Debug 菜单，然后选择 detach all。它与 Cassini Web 引擎分离，但不会像停止调试时那样关闭它。

我很确定您知道可以使用命令行开关来启动 cassini 引擎，但我猜您正在寻找更简单的东西。

分离不会关闭 Visual Studio 启动的浏览器窗口，如果您关闭该特定 Web 窗口，它将停止调试。

我在没有 IIS 的 Vista 64x SP1 上运行 VS 2008 SP1。

希望它可以帮助 Rihan Meij

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-12T02:00:06.420

我有 3 个网站，每个网站之间都有单点登录，所以我需要启动所有 3 个并附加到进程。但是，没有附加调试器的过程，每当我用 F5 启动一个项目然后停止它时，Visual Studio Web 服务器就会关闭。

启用编辑并继续选项没有改变任何东西。

因此，要启动 Web 服务器并使其保持运行，以便您可以将 Web 项目附加到进程，我只是做了一个“在浏览器中查看”（ctrl+shift+W）。这启动了服务器进程，但没有启动项目或调试器。然后我可以轻松地附加到进程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-26T10:00:37.737

在 Visual Studio 2015 中，您可以通过转到工具 > 选项 > 调试 > 常规并取消选中“启用编辑并继续”选项来执行此操作：

[![在此处输入图像描述](https://i.stack.imgur.com/dAr7P.png)](https://i.stack.imgur.com/dAr7P.png)

# openssl - 使用 OpenSSL 以编程方式创建 X509 证书

> ID：256405
> 
> 赞同：84
> 
> 时间：2008-11-02T02:16:49.323
> 
> 标签：openssl, ssl-certificate, x509, pkix

我有一个 C/C++ 应用程序，我需要创建一个包含公钥和私钥的 X509 pem 证书。证书可以是自签名的，也可以是未签名的，没关系。

我想在应用程序中执行此操作，而不是从命令行。

哪些 OpenSSL 功能将为我做这件事？任何示例代码都是奖励！

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2013-02-26T05:51:05.687

我意识到这是一个非常晚（而且很长）的答案。但考虑到这个问题在搜索引擎结果中的排名，我认为可能值得写一个像样的答案。

您将在下面阅读的很多内容都是从[这个演示](http://www.opensource.apple.com/source/OpenSSL/OpenSSL-22/openssl/demos/x509/mkcert.c)和 OpenSSL 文档中借来的。下面的代码适用于 C 和 C++。

* * *

在我们真正创建证书之前，我们需要创建一个私钥。OpenSSL 提供了`EVP_PKEY`在内存中存储与算法无关的私钥的结构。这个结构被声明`openssl/evp.h`但被包含`openssl/x509.h`（我们稍后需要）所以你不需要显式地包含头文件。

为了分配`EVP_PKEY`结构，我们使用[`EVP_PKEY_new`](http://www.openssl.org/docs/crypto/EVP_PKEY_new.html)：

```
EVP_PKEY * pkey;
pkey = EVP_PKEY_new(); 
```

还有一个用于释放结构的相应函数`EVP_PKEY_free`——它接受一个参数：`EVP_PKEY`上面初始化的结构。

现在我们需要生成一个密钥。对于我们的示例，我们将生成一个 RSA 密钥。这是通过在[`RSA_generate_key`](http://www.openssl.org/docs/crypto/RSA_generate_key.html)中声明的函数完成的`openssl/rsa.h`。该函数返回一个指向`RSA`结构的指针。

函数的简单调用可能如下所示：

```
RSA * rsa;
rsa = RSA_generate_key(
    2048,   /* number of bits for the key - 2048 is a sensible value */
    RSA_F4, /* exponent - RSA_F4 is defined as 0x10001L */
    NULL,   /* callback - can be NULL if we aren't displaying progress */
    NULL    /* callback argument - not needed in this case */
); 
```

如果返回值为，`RSA_generate_key`则说明`NULL`出现问题。如果没有，那么我们现在有一个 RSA 密钥，我们可以将它分配给我们`EVP_PKEY`之前的结构：

```
EVP_PKEY_assign_RSA(pkey, rsa); 
```

当`RSA`结构被释放时，结构将被自动`EVP_PKEY`释放。

* * *

现在是证书本身。

OpenSSL 使用该`X509`结构来表示内存中的 x509 证书。该结构的定义在`openssl/x509.h`. 我们需要的第一个函数是[`X509_new`](http://www.openssl.org/docs/crypto/X509_new.html). 它的使用相对简单：

```
X509 * x509;
x509 = X509_new(); 
```

与. `EVP_PKEY`_`X509_free`

`X509_*`现在我们需要使用一些函数来设置证书的一些属性：

```
ASN1_INTEGER_set(X509_get_serialNumber(x509), 1); 
```

这会将我们证书的序列号设置为“1”。一些开源 HTTP 服务器拒绝接受序列号为“0”的证书，这是默认设置。下一步是指定证书实际有效的时间跨度。我们通过以下两个函数调用来做到这一点：

```
X509_gmtime_adj(X509_get_notBefore(x509), 0);
X509_gmtime_adj(X509_get_notAfter(x509), 31536000L); 
```

第一行将证书的`notBefore`属性设置为当前时间。（该`X509_gmtime_adj`函数将指定的秒数添加到当前时间 - 在本例中为无。）第二行将证书的`notAfter`属性设置为从现在起 365 天（60 秒 * 60 分钟 * 24 小时 * 365 天）。

现在我们需要使用我们之前生成的密钥为我们的证书设置公钥：

```
X509_set_pubkey(x509, pkey); 
```

由于这是一个自签名证书，我们将颁发者的名称设置为主题的名称。该过程的第一步是获取主题名称：

```
X509_NAME * name;
name = X509_get_subject_name(x509); 
```

如果您以前曾在命令行上创建过自签名证书，您可能还记得被要求输入国家代码。这是我们与组织 ('O') 和通用名称 ('CN') 一起提供的地方：

```
X509_NAME_add_entry_by_txt(name, "C",  MBSTRING_ASC,
                           (unsigned char *)"CA", -1, -1, 0);
X509_NAME_add_entry_by_txt(name, "O",  MBSTRING_ASC,
                           (unsigned char *)"MyCompany Inc.", -1, -1, 0);
X509_NAME_add_entry_by_txt(name, "CN", MBSTRING_ASC,
                           (unsigned char *)"localhost", -1, -1, 0); 
```

（我在这里使用值 'CA' 因为我是加拿大人，那是我们的国家代码。另请注意，参数 #4 需要显式转换为`unsigned char *`.）

现在我们可以实际设置发行者名称：

```
X509_set_issuer_name(x509, name); 
```

最后，我们准备好执行签名过程。我们`X509_sign`使用之前生成的密钥进行调用。代码非常简单：

```
X509_sign(x509, pkey, EVP_sha1()); 
```

请注意，我们使用[SHA-1](http://en.wikipedia.org/wiki/SHA-1)散列算法对密钥进行签名。这与`mkcert.c`我在此答案开头提到的使用 MD5 的演示不同。

* * *

我们现在有一个自签名证书！但我们还没有完成——我们需要将这些文件写入磁盘。值得庆幸的是，OpenSSL 也为我们提供了`PEM_*`在`openssl/pem.h`. 我们需要的第一个是`PEM_write_PrivateKey`保存我们的私钥。

```
FILE * f;
f = fopen("key.pem", "wb");
PEM_write_PrivateKey(
    f,                  /* write the key to the file we've opened */
    pkey,               /* our key from earlier */
    EVP_des_ede3_cbc(), /* default cipher for encrypting the key on disk */
    "replace_me",       /* passphrase required for decrypting the key on disk */
    10,                 /* length of the passphrase string */
    NULL,               /* callback for requesting a password */
    NULL                /* data to pass to the callback */
); 
```

如果您不想加密私钥，则只需传递`NULL`上面的第三个和第四个参数。无论哪种方式，您都肯定希望确保该文件不是世界可读的。（对于 Unix 用户，这意味着`chmod 600 key.pem`.）

哇！现在我们只需要一个功能——我们需要将证书写入磁盘。我们需要的功能是`PEM_write_X509`：

```
FILE * f;
f = fopen("cert.pem", "wb");
PEM_write_X509(
    f,   /* write the certificate to the file we've opened */
    x509 /* our certificate */
); 
```

* * *

我们完成了！希望这个答案中的信息足以让您大致了解一切是如何工作的，尽管我们几乎没有触及 OpenSSL 的表面。

对于那些有兴趣了解上述所有代码在实际应用程序中的样子的人，我整理了一个 Gist（用 C++ 编写），您可以[在此处](https://gist.github.com/nathan-osman/5041136)查看。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-11-02T06:51:35.463

您需要先熟悉术语和机制。

根据定义， X.509**证书**不包含私钥。相反，它是公钥的 CA 签名版本（以及 CA 放入签名中的任何属性）。PEM 格式实际上只支持密钥和证书的单独存储 - 尽管您可以将两者连接起来。

在任何情况下，您都需要调用 OpenSSL API 的 20 多个不同函数来创建密钥和自签名证书。OpenSSL 源代码本身就是一个例子，在[demos/x509/mkcert.c](http://www.opensource.apple.com/source/OpenSSL/OpenSSL-22/openssl/demos/x509/mkcert.c)

有关更详细的答案，请参阅下面[Nathan Osman 的解释](https://stackoverflow.com/a/15082282/2387465)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-08-13T13:30:39.090

[Nathan Osman](https://stackoverflow.com/a/15082282/2387465)详细而全面地解释了它，在 C++ 中要解决同样的问题，所以这是我的小补充，cpp 风格的重写概念，其中考虑了几个警告：

```
bool generateX509(const std::string& certFileName, const std::string& keyFileName, long daysValid)
{
    bool result = false;

    std::unique_ptr<BIO, void (*)(BIO *)> certFile  { BIO_new_file(certFileName.data(), "wb"), BIO_free_all  };
    std::unique_ptr<BIO, void (*)(BIO *)> keyFile { BIO_new_file(keyFileName.data(), "wb"), BIO_free_all };

    if (certFile && keyFile)
    {
        std::unique_ptr<RSA, void (*)(RSA *)> rsa { RSA_new(), RSA_free };
        std::unique_ptr<BIGNUM, void (*)(BIGNUM *)> bn { BN_new(), BN_free };

        BN_set_word(bn.get(), RSA_F4);
        int rsa_ok = RSA_generate_key_ex(rsa.get(), RSA_KEY_LENGTH, bn.get(), nullptr);

        if (rsa_ok == 1)
        {
            // --- cert generation ---
            std::unique_ptr<X509, void (*)(X509 *)> cert { X509_new(), X509_free };
            std::unique_ptr<EVP_PKEY, void (*)(EVP_PKEY *)> pkey { EVP_PKEY_new(), EVP_PKEY_free};

            // The RSA structure will be automatically freed when the EVP_PKEY structure is freed.
            EVP_PKEY_assign(pkey.get(), EVP_PKEY_RSA, reinterpret_cast<char*>(rsa.release()));
            ASN1_INTEGER_set(X509_get_serialNumber(cert.get()), 1); // serial number

            X509_gmtime_adj(X509_get_notBefore(cert.get()), 0); // now
            X509_gmtime_adj(X509_get_notAfter(cert.get()), daysValid * 24 * 3600); // accepts secs

            X509_set_pubkey(cert.get(), pkey.get());

            // 1 -- X509_NAME may disambig with wincrypt.h
            // 2 -- DO NO FREE the name internal pointer
            X509_name_st* name = X509_get_subject_name(cert.get());

            const uchar country[] = "RU";
            const uchar company[] = "MyCompany, PLC";
            const uchar common_name[] = "localhost";

            X509_NAME_add_entry_by_txt(name, "C",  MBSTRING_ASC, country, -1, -1, 0);
            X509_NAME_add_entry_by_txt(name, "O",  MBSTRING_ASC, company, -1, -1, 0);
            X509_NAME_add_entry_by_txt(name, "CN", MBSTRING_ASC, common_name, -1, -1, 0);

            X509_set_issuer_name(cert.get(), name);
            X509_sign(cert.get(), pkey.get(), EVP_sha256()); // some hash type here

            int ret  = PEM_write_bio_PrivateKey(keyFile.get(), pkey.get(), nullptr, nullptr, 0, nullptr, nullptr);
            int ret2 = PEM_write_bio_X509(certFile.get(), cert.get());

            result = (ret == 1) && (ret2 == 1); // OpenSSL return codes
        }
    }

    return result;
} 
```

当然，应该对函数的返回值进行*更多检查，实际上应该检查**所有*这些值，但这会使样本过于“分支”并且无论如何都很容易改进。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T02:44:17.693

有没有机会通过`system`您的应用程序内的呼叫来做到这一点？这样做的几个充分理由：

*   许可：调用`openssl`可执行文件可以说将其与您的应用程序分开，并可能提供某些优势。 *免责声明：就此咨询律师。*

*   文档：OpenSSL 附带了*惊人*的命令行文档，极大地简化了可能很复杂的工具。

*   可测试性：您可以从命令行练习 OpenSSL，直到您确切了解如何创建证书。有*很多*选择；预计要花大约一天的时间，直到你把所有的细节都搞对了。之后，将命令合并到您的应用程序中是微不足道的。

如果您选择使用 API，请查看`openssl-dev`www.openssl.org 上的开发人员列表。

祝你好运！

# performance - MySQL 字段管理

> ID：256413
> 
> 赞同：1
> 
> 时间：2008-11-02T02:20:45.137
> 
> 标签：performance, mysql-management, mysql

当我进行查询时，我经常想知道这一点：

> 将额外的字段添加到表中更好，还是只获取值并使用服务器端语言进行计算？

例如，表 Student 包含 Student.score 字段。我想考成绩。

> 我得到分数并为成绩做一堆 if/else/switch 吗？
> 
> 我是否会通过添加一个字段来存储依赖于另一个字段的内容来**浪费空间？**

每次你需要成绩时，前者很烦人。当我想到空间使用时，后者让我害怕。如果我只有 10,000 条记录，那么我已经浪费了 10,000 个字段！

考虑到重要的表和大中型数据库，哪种方法最有效？

如果重要，让我们使用 PHP 作为服务器端语言。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T02:31:51.103

您的数据持久层通常不应存储经常更改的计算值。这样做会产生风险，即允许停滞数据在数据存储中持久存在，然后影响业务层，进而影响其他一切。

一般来说，您总是希望在运行时生成计算值。

但是，在确定解决任何设计问题的最佳方法时，我不会担心数据库中的单个附加字段。硬盘空间既便宜又充足。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T02:38:28.533

您的数据库比您认为的要强大得多。

这在很大程度上取决于您的数据库类型和版本，但您可以使用一些过程和函数来提高脚本的效率。与现有的多行解决方案服务器端语言相比，这些方法可以是简单的快速调用。为什么不制定一个程序——当被调用时——返回所有学生的信息以及它为你计算的字母等级？为什么不使用一些数学函数来找出两个字段之间的差异？为什么不使用 datetime 函数来格式化您的日期字段？

您可以通过多种方式使用数据库来处理信息。这仅取决于您期望数据库的大小。如果它只是一个简单的 5 页 CMS 网站，那么，不，您可能不希望在数据库方面完成太多工作，但是，如果您有一个包含多个相互关联的大容量表的大型数据库那么，是的，您可能希望将一些处理转移到数据库中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T02:33:22.020

添加额外字段时，您还需要考虑每当更新它所依赖的字段时，也需要更新额外字段。是否可以将计算移到 SQL 中，而不是遍历记录集并在服务器端代码中执行？

# python - Python 包和 egg-info 目录

> ID：256417
> 
> 赞同：82
> 
> 时间：2008-11-02T02:26:20.583
> 
> 标签：python, setuptools, egg

有人可以解释一下 egg-info 目录是如何与它们各自的模块相关联的吗？例如，我有以下内容：

```
/usr/local/lib/python2.5/site-packages/quodlibet/
/usr/local/lib/python2.5/site-packages/quodlibet-2.0.egg-info/ 
```

我假设 egg-info 目录是为了让 setuptools (easy_install) 可以看到相应的模块，对吧？如果是这样，setuptools 如何将 egg-info 目录绑定到模块目录？

假设我走在正确的轨道上，并且为了举例......如果我想让我的现有包对 setuptools 可见，我可以将模块目录和 egg-info 目录符号链接到站点 -包目录？我自己会尝试这个，但我不确定如何测试该包是否对 setuptools 可见。如果您还可以告诉我如何测试，则可以加分：)

我试图理解这一切的主要原因是因为我想将我的一些模块符号链接到站点包中，以便我可以对它们进行更改并使使用它们的脚本可以看到更改，而无需重新安装每次更改后来自 PyPI 的鸡蛋。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-02T06:40:26.033

只有在使用 --single-version-externally-managed 安装 egg 时才会创建 .egg-info 目录。“通常”，安装 egg 会创建一个目录（或 zip 文件），其中包含代码和元数据。

pkg_resources（它是读取元数据的库）有一个函数`require`可以用来请求特定版本的包。对于“老式”的常规导入，easy_install 会破解一个 .pth 文件以将 egg 目录放到 sys.path 中。对于--single-version-externally-managed，这种hacking 是不必要的，因为只会安装一个版本（通过系统的打包基础设施，例如rpm 或dpkg）。`require`对于使用（或任何其他 pkg_resources 绑定机制）的应用程序，仍然包含 egg-info 。

如果你想通过硬链接安装一个包，我推荐使用“setup.py develop”。这是来自 setuptools 的命令，它实际上并没有安装 egg，而是使它在站点范围内可用。为此，它创建了一个 egg-link 文件，以便 pkg_resources 可以找到它，并且它操作一个 .pth 文件，以便常规导入可以找到它。

# javascript - 如何在 open-flash-chart 2.x 中实现此类工具提示

> ID：256428
> 
> 赞同：1
> 
> 时间：2008-11-02T02:36:25.650
> 
> 标签：javascript, open-flash-chart

以我的思维方式，我需要使用工具提示，如 1.x 中的工具提示和魔术词 #tip# 的功能。

有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T12:26:56.987

你可以试试这两个链接：

[http://teethgrinder.co.uk/open-flash-chart-2/tooltip.php](http://teethgrinder.co.uk/open-flash-chart-2/tooltip.php)

[http://pullmonkey.com/2008/7/28/open-flash-chart-ii-multi-bar-graph-with-tooltips](http://pullmonkey.com/2008/7/28/open-flash-chart-ii-multi-bar-graph-with-tooltips)

# risk-analysis - 分析项目风险的最佳方法是什么？

> ID：256445
> 
> 赞同：2
> 
> 时间：2008-11-02T02:56:01.507
> 
> 标签：risk-analysis

是否有一种万无一失的方法来消除项目中涉及的所有风险？它是否会因您从事的项目类型（即：网站、客户端/服务器...）而有所不同？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T03:00:41.373

绝对没有万无一失的方法。关于这个主题已经写了整本书。说到书，我推荐这本：

Steve McConnell 的软件项目生存指南（我知道，糟糕的图像）

[替代文字 http://ecx.images-amazon.com/images/I/41X9bGinoNL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/41X9bGinoNL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T05:08:00.320

“[风险]会因[您]从事的项目类型而异吗？”

是的，一点没错。软件项目有几种普遍的风险（缺乏管理承诺、沟通不畅等），但风险“概况”因环境而异。例如，视频游戏项目的风险与企业供应链管理项目的风险大不相同。

对于企业发展，风险因管理支持和复杂程度、团队结构、项目规模、面向客户与内部、平台选择和集成水平而异，仅举一些主要领域。

风险不同的事实是“领域经验不足”是*普遍*风险的原因之一。

各种情况下的风险概况是学术论文的热门主题（进行调查，研究一些数字，获得出版学分......）。它们通常不会引人入胜，但在制定项目计划时非常值得回顾。

DeMarco 和 Lister的《 *Waltzing with Bears* 》是一本很棒的关于风险管理的短书。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T03:01:47.377

没有万无一失的方法——最危险的风险是你没有预见到的。

不幸的是，开发人员往往是乐观主义者，这使情况更加复杂。如果您向程序员询问“最可能的估计”，您往往会得到与要求“最佳情况估计”相同的答案。根据我的经验，你能做的最好的事情就是找到优秀的人，并且总是假设他们的估计值很低，即使在你要求他们不要乐观之后，即使在你告诉他们包括一些无法预料的弯路之后也是如此。

最重要的是，永远，*永远*，*永远不要*告诉你的程序员估算值太高，他需要降低它。如果你想从你的帽子里拿出一个估计，那就这样做，但要诚实地承认你是从你的帽子里拿出来的。当你强迫他降低它时，假装“这是程序员的估计”是冒险和不诚实的。

我强烈推荐Fred Brooks 的*The Mythical Man-Month*，以了解有关软件开发过程危险的其他见解。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T03:02:46.407

风险管理是一个巨大的话题，可能无法在 stackoverflow 的答案中得到公正的回答。你最好的选择是去买一本关于软件项目管理的好书（软件项目生存指南的推荐是一本很好的书），然后从那里开始。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T03:11:30.820

不要忘记任何发展的结局：

***发布到生产中***

有人可能会争辩说，任何与软件开发有关的风险都应该根据该目标进行评估（成功地将软件发布到生产环境中，换句话说，“向客户提供服务”）。
这还不够，因为监控和维护该软件本身就是有风险的操作，但这是一个很好的指导方针。

例如，NASA（对于“发布”至关重要！）有一个[软件质量模型](http://satc.gsfc.nasa.gov/support/STC_APR96/qualtiy/stc_qual.html)定义。IBM 有很多关于这个主题[的文章。](http://www-01.ibm.com/software/tivoli/governance/action/06212007.html)

所有其他答案和书籍推荐都是正确的。

我只是想将项目的全部内容（“发布”）放在任何答案的中心，以便更好地为该项目建立自己的“风险”定义。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-02T03:18:07.797

经验。开发和发布软件的实践将使您能够以结构化分析无法做到的方式预测和降低风险。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T03:03:57.590

我非常喜欢这篇文章：[软件设计中的风险分析](http://www.cigital.com/papers/download/bsi3-risk.pdf)（PDF），看看它，对风险分析进行了很好的概述，但我认为没有万无一失的方法，它真的取决于你的环境.. .

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-04T04:04:20.167

几个主要风险包括：程序员是否知道需要构建什么，如何做，他们可以一起工作吗？一些开发方法，包括敏捷和极端，通过尽快构建一些真正的东西来正面应对这些风险，然后通过一次追求一个高优先级的业务目标来发展一个工作系统。

# .net - 检查是否安装了 SQL CE 的最佳方法是什么版本？

> ID：256451
> 
> 赞同：4
> 
> 时间：2008-11-02T03:00:47.393
> 
> 标签：.net, sql, vb.net, sql-server-ce

我编写了一个使用 SQL CE 3.5 的 VB.NET 应用程序。我很好奇是否有人有任何最佳实践或代码来帮助检查是否安装了 A）SQL CE 和 B）如果是，那么是什么版本。

我在 msdn 和 google 上搜索了任何东西，但没有发现任何有用的东西。我在注册表中四处寻找，发现这个键：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server Compact Edition\v3.5，字符串值为“Version”，数据为3.5.5692.0。

所以我的假设是检查这个键的存在，但这让我很困扰，因为“3.5”键听起来确实像它与 3.5 DLL 相关联。我想说的是，如果有人有 SQL CE，我不想强​​迫他们安装 SQL 3.5（在此处插入一些未来版本的 CE）。

其他信息：目标框架：.NET 2.0 最低目标操作系统：Windows XP SP2

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T12:34:41.730

不确定您是在谈论 Windows 机器还是便携式设备上的 SQL CE。在 PC 上，最好的办法是将 SQL CE 版本与您的应用程序一起分发。[您可以在http://www.microsoft.com/Sqlserver/2005/en/us/compact-redistribute.aspx](http://www.microsoft.com/Sqlserver/2005/en/us/compact-redistribute.aspx)注册以获得这样做的权利。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T12:51:52.537

正如 BlackWasp 所指出的，最好的方法是将 SqlServerCe 程序集与您的应用程序一起分发。如果您想检查数据库文件（SDF 文件）是哪个版本，您应该查看[此处](http://nativemobile.blogspot.com/2007/12/detecting-sdf-file-version.html)。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T13:02:11.643

执行此操作的广泛接受的方法是检查由 MSI 安装程序保存在注册表中的产品标识符 (GUID)。如果您没有安装有问题的产品，您可以使用名为 Orca（Windows SDK 的一部分）的工具破解打开 MSI 并以这种方式获取 GUID。大多数（如果不是全部）安装构建器都有一个动作或任务可以作为 pre-req 测试的一部分执行此操作，甚至 VS2005/2008 也具有此功能。

要检查版本，我会在注册表中再次挖掘，或者查看文件版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-09T17:16:12.500

这是我的解决方案。它在我的安装文件中增加了 5 兆，但它现在也可以离线安装。安装需要几秒钟的额外时间，但它总是做正确的事情。

为什么这应该是事实上的解决方案：

*   确保正确安装程序应该是该功能的安装程序的责任
*   您总是希望最终结果是安装了 SQL Server CE（即使用户对原始安装很生气）
*   仅额外 5 兆（但您仍然可以使用下载）

    ```
     DownloadUrl="http://download.microsoft.com/download/0/5/D/05DCCDB5-57E0-4314-A016-874F228A8FAD/SSCERuntime_x86-ENU.exe"
        SourceFile="SSCERuntime_x86-ENU.exe"
        Compressed="no" 
    ```

这是我的解决方案：

```
<PackageGroup Id="SQLExpressCE">
  <ExePackage
        Vital="yes"
        SourceFile="SSCERuntime_x86-ENU.exe"
        InstallCondition="NOT VersionNT64"

        //Include the exes(only about 2.5 megs each)
        //Setting this to no causes your bootstrapper to download on installation but since this will always be trying to install, it is probably best to include it
        Compressed="yes"

        //install quietly without an interface
        InstallCommand="/i /quiet /n"
        />
  <ExePackage
        Vital="yes"
        InstallCondition="VersionNT64" 
        SourceFile="SSCERuntime_x64-ENU.exe"
        Compressed="yes"
        InstallCommand="/i /quiet /n"
        />
</PackageGroup> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-24T13:07:24.543

好的，这仅回答了您问题的第一部分，但希望它仍然有用......这是我目前使用的：

```
<Fragment>
    <util:RegistrySearch
          Id='SearchForSQLCE'
          Variable="SQLCEInstalled"
          Result="exists"
          Root="HKLM"
          Key="SOFTWARE\Classes\Microsoft SQL Server Compact Edition Database File"
          Win64="yes"
               />
  </Fragment> 
```

# .net - 如何在我的应用程序中分析序列化开销

> ID：256456
> 
> 赞同：1
> 
> 时间：2008-11-02T03:05:41.567
> 
> 标签：.net, serialization, profiling

我的应用程序在前端和数据库之间有一个 WCF 服务层。由于我们目前托管在 IIS6 中，因此我们使用的是 SOAP over HTTP。我如何才能知道在我的应用程序中进行序列化活动所花费的实际时间是多少？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T10:08:07.050

不是关于测量——而是关于改进：我一直在研究[protobuf-net](http://code.google.com/p/protobuf-net/)，它是用于 .NET 的 Google 的“协议缓冲区”（一种紧凑的、低 CPU 二进制序列化格式）的实现——包括一个 WCF 挂钩（用于替换DataContractSerializer）。它有一些[非常好的指标](http://code.google.com/p/protobuf-net/wiki/Performance)重新序列化。

当与基本的 http 绑定一起使用时，它也可以与 MTOM 一起使用，因此您甚至不会获得二进制的 base-64 开销。[这里](http://code.google.com/p/protobuf-net/source/browse/#svn/trunk/WcfPerfTest)有一个 WCF 示例。

可能很有意思……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T06:28:33.590

Create a message inspector and add it to your endpoint behavior,

In the message inspector, you implement the interface which has the following method

```
AfterReceiveRequest
{
  DateTime start = datetime.now;
  return start;
}
BeforeSendReply
{
 // start will be passed in as state in the parameter.  
 TimeSpan period = datetime.now - start 
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T06:23:25.223

One of the dead simple things old mainframes always used to to was to include a "sever time" field in the response. Therefore you'd know that anything that happened between your observed time and server time is network/serialization overhead. I know it kind of 1960-ish, but it still works well.

If you want avoid changing the method signature you can set it in a http response header or something ;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T06:31:52.540

The [xperf tools](http://msdn.microsoft.com/en-us/performance/default.aspx) are a good choice if you can run on Windows Server 2008 and Vista on the client. These are ETW based and use the Windows sample profile interrupt to profile anything running on the system. Here is [series of posts](http://blogs.msdn.com/pigscanfly/pages/xperf-articles.aspx) on the xperf tools from myself. [This post](http://blogs.msdn.com/pigscanfly/archive/2008/03/02/using-the-windows-sample-profiler-with-xperf.aspx) is specifically about profiling.

note that you can download the latest version of the tools directly for [this page](http://msdn.microsoft.com/en-us/performance/default.aspx).

You may want to experiment with some of the other kernel events, such as disk IO and hard faults.

# linux - 在 Linux 中填充 MS Access 数据库

> ID：256459
> 
> 赞同：9
> 
> 时间：2008-11-02T03:08:54.087
> 
> 标签：linux, ms-access

有什么方法可以在 Linux 中创建 Access / Jet 数据库？

我正在尝试从 linux 应用程序服务器（mysql 后端）提供数据，但没有找到任何让我这样做的工具 - 似乎应该有一些东西。

如果我无法创建数据库，有没有办法从 Linux 中插入现有的 Access 数据库文件？

CLI 工具、SQL 命令文件的包装器、C 库、Ruby 库等等？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-05-11T05:01:17.237

有一个名为[jackcess](http://jackcess.sourceforge.net/)的 java 库，它可以从任何可以运行 jvm 的平台写入 Access mdb 文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T03:40:54.693

[EasySoft](http://www.easysoft.com/products/data_access/)有一个 ODBC 驱动程序，可用于将数据插入现有的 MS Access 数据库。

如果可以的话，我会将 Access 换成[SQL Server Express](http://www.microsoft.com/express/sql/default.aspx)（免费下载），然后您可以使用[FreeTDS ODBC 驱动程序](http://www.freetds.org/userguide/)从 Linux 或其他可用的商业 ODBC 驱动程序之一从 Linux 访问 MS SQL Server。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T03:44:56.777

可能是一个愚蠢的问题，但为什么要访问？我必须假设这些数据需要在某个时候转移到 Windows？可能还有其他方法可以解决这个问题。如果要在内部使用访问数据库，您可以从 Windows 上运行的 Access 设置与 MySQL 的连接，并以这种方式获取数据。如果数据文件将被断开，您可以尝试创建一个逗号分隔的带有数据的文本文件，但给它一个 .xls 扩展名 - 在 Windows 机器上，这将导致它在 Excel 中打开，许多用户都可以使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T14:07:29.227

您是否可以在 Windows 中编辑访问数据库，以便使用链接表，然后链接到外部文本文件、XML 文件、HTML 文档等？

在 Office2007 中，使用“外部数据”选项卡，然后选择“文本文件”、“XML 文件”等。只需确保选择单选按钮“通过创建链接表链接到数据源”。如果您首先删除现有表并创建一个具有相同名称的链接表，您可能会欺骗您的应用程序通过 Access 作为代理查看文本文件。

这样，您可以轻松地从您的 linux 应用程序更新外部文件，并且您的应用程序在与访问数据库交互时应该看到该数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-13T00:45:54.017

为什么不使用网络服务？您可以在 Windows 机器上运行 ASP（或其他）服务，它可以使用 ODBC 构造所需的 .mdb 文件。然后，您的 Linux 应用程序可以上传原始数据并接收 .mdb 作为响应。

或者，只需在 Windows 上运行整个脚本。您可以安装 cygwin 和/或 ActiveSate perl 并从那里访问 Windows ODBC 驱动程序（包括 Access）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-29T19:26:49.417

[您可以使用Crossover Office](https://www.codeweavers.com/compatibility/browse/name/?app_id=564)在 Linux 系统上运行 Access 2002 ，并通过脚本将其自动化。（例如，您可以编写一些 VBScript 并使用 CrossOver 下的 wscript.exe 执行。）

最近，我自己为一些数据库做这个，效果很好。如果您需要帮助设置它，请给我发电子邮件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-03T20:29:11.960

1.  如果你想从头开始创建一个访问数据库（mdb 文件），你需要一些 Microsoft Office dll，所以我想你可以忘记它。

2.  如果您的想法是在 Access mdb 文件中插入/操作数据，您将需要一个特定的驱动程序来满足您想要使用的连接类型。我认为您的选择基本上是在 ODBC 和 OLEDB 之间。然后，您可以使用此连接来修改您的数据（INSERT、UPDATE、DELETE）、提取数据（SELECT）甚至通过 DDL 指令（CREATE、DROP 等）操作您的数据库结构。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-27T23:23:03.087

> 有什么方法可以在 Linux 中创建 Access / Jet 数据库？

绝对地。[UCanAccess](http://ucanaccess.sourceforge.net/site.html)是一个免费的、开源的、纯 Java JDBC 驱动程序，可以在任何运行 Java 的机器上创建/读取/写入 Access 2000+ 数据库（对于 Access 97 是只读的）。有关如何在 Java 中使用它的更多信息，请参见此处：

[在没有 ODBC 的情况下从 Java 操作 Access 数据库](https://stackoverflow.com/q/21955256/2144390)

如果您更愿意使用 Python，那么您可以将 UCanAccess 与 Jython 或 JayDeBeApi 一起使用，如我[在此处](https://stackoverflow.com/a/25614063/2144390)的回答中所示。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-26T16:12:27.530

[MDB 工具](http://mdbtools.sourceforge.net/)提供：

*   一个 C 库
*   一组命令行工具
*   一个 ODBC 驱动程序 [unixODBC]（用于[http://www.unixodbc.org/](http://www.unixodbc.org/)），它又具有其他语言的包装器

它是免费和开源的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-23T08:12:40.343

在 Linux 上创建 MS Access 数据库可以从 Windows 完成。

1.  在 Linux 上设置 SMB 共享
2.  在 Windows 上为您的 SMB 共享创建一个映射驱动器
3.  创建 Access 数据库 3.1 如果您安装了 MS Access，您可以简单地在共享上创建一个新数据库。3.2 如果您没有安装 MS Access 但您在 Windows 上安装了 MS Access ODBC 驱动程序，只需创建一个新的 Microsoft Access ODBC 数据源 - 这将为您提供创建数据库的选项。

然后，您可以使用[Easysoft Access ODBC 驱动程序](http://www.easysoft.com/products/data_access/odbc-access-driver/index.html)将数据写入您的数据库。

或者，您可以使用另一个 Easysoft 工具[Easysoft ODBC-ODBC Bridge](http://www.easysoft.com/products/data_access/odbc_odbc_bridge/index.html)。这将允许您将 Access 数据库保留在 Windows 上，但允许您从 Linux 应用程序对其进行 ODBC 调用。

# objective-c - Objective-C 中的 NSString indexOf

> ID：256460
> 
> 赞同：56
> 
> 时间：2008-11-02T03:10:37.530
> 
> 标签：objective-c, cocoa

`indexOf`NSString 对象中有什么类似于函数的东西吗？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2008-11-02T03:13:59.630

使用`-[NSString rangeOfString:]`：

```
- (NSRange)rangeOfString:(NSString *)aString; 
```

> 查找并返回给定字符串在接收器中第一次出现的范围。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-11-07T12:11:47.867

如果您只想知道 String a 何时包含 String b ，请使用我的方式来执行此操作。

```
#define contains(str1, str2) ([str1 rangeOfString: str2 ].location != NSNotFound)

//using 
NSString a = @"PUC MINAS - BRAZIL";

NSString b = @"BRAZIL";

if( contains(a,b) ){
    //TO DO HERE
} 
```

这不太可读，但提高了性能

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-09-07T06:37:10.887

我写了一个类别来扩展原始的 NSString 对象。或许大家可以参考一下。（你也可以在我的博客中看到[这篇文章。）](http://fstoke.me/blog/?p=3121)

扩展NSString.h：

```
#import <Foundation/Foundation.h>

@interface NSString (util)

- (int) indexOf:(NSString *)text;

@end 
```

扩展NSString.m：

```
#import "ExtendNSString.h"

@implementation NSString (util)

- (int) indexOf:(NSString *)text {
    NSRange range = [self rangeOfString:text];
    if ( range.length > 0 ) {
        return range.location;
    } else {
        return -1;
    }
}

@end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-05T15:06:05.363

我知道已经很晚了，但是我添加了一个实现此方法的类别以及许多其他类似于 javascript 字符串方法的类别
[https://github.com/williamFalcon/WF-iOS-Categories](https://github.com/williamFalcon/WF-iOS-Categories)

# java - 哪里可以获得更多关于 Dictionary ADT 和 Skip List for Java 的信息？

> ID：256490
> 
> 赞同：0
> 
> 时间：2008-11-02T03:56:20.043
> 
> 标签：java, data-structures, abstract-data-type

我正在尝试深入研究 Dictionary ADT 和 Skip List for Java。我的教科书对此并没有太多的介绍，而且它所涵盖的内容都非常复杂。哪个是获取有关 Dictionary ADT 和 Skip List for Java 的更多信息的最佳在线站点。我正在寻找一个能直观地说话并给出很多例子的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T04:13:47.950

由于听起来您在算法类中，因此我会将字典和跳过列表的实现与 Java API 提供的内容分开。此时，了解这些抽象数据类型的概念更为重要，因为它们可以用任何语言（C#、PHP、Scheme、Brainfuck 等）实现。

您的讲师可能希望您：首先，为字典（或跳过列表）定义接口或协定，然后确定其实现。如果您使用 Java 进行编程，请使用 JUnit 来验证您的算法的正确性。如果您正在使用其他语言进行编程，请查找任何 xUnit API。

查看[NIST 的算法和数据结构词典](http://www.nist.gov/dads/)作为教科书的辅助资源，以了解这些内容的含义。Java 中最好的算法书可能是 Sedgewick 的，它的主要特点是它对小程序的教学使用。由于示例代码不是用惯用的 Java 编写的，因此我不会在那里寻找算法的工业强度实现。毕竟，您应该自己完成工作，而不是使用其他人的集合 API。

哦，顺便说一句，Java 6 有两个跳过列表的实现：`ConcurrentSkipListSet`和`ConcurrentSkipListMap`. Java中字典数据结构的接口是`Map`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-20T12:07:10.863

[您可以在此处](ftp://ftp.cs.umd.edu/pub/skipLists/skiplists.pdf)下载 William Pugh 描述跳过列表及其背后理论的原始论文的 PDF 。

此外，[这](http://iamwww.unibe.ch/~wenger/DA/SkipList/)是一个很好的小程序来可视化跳过列表的操作。当我的数据结构类中出现跳过列表时，它对我有很大帮助。

此外，[Wikipedia](http://en.wikipedia.org/wiki/Skip_list)条目底部有一些很好的链接，用于其他实现和 Java 源代码。

# compiler-construction - 任意架构的目标编译器

> ID：256495
> 
> 赞同：1
> 
> 时间：2008-11-02T04:00:26.807
> 
> 标签：compiler-construction

是否有针对高级语言（例如 C）的编译器可以通过指定目标的硬件资源来针对各种体系结构？

我想知道是否有编译器可以通过指定诸如处理器的可用寄存器和指令集（即每条指令如何改变处理器的状态）和架构的内存布局等特性来针对架构。

我知道诸如[gcc](http://gcc.gnu.org/)之类的编译器可以针对多个架构，但我想知道是否有编译器可以通过交换配置文件来针对新架构进行编译，以便针对新架构。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-02T07:55:37.423

根本问题是各种处理器的特性并不是特别统一。看看 IA64 上的捆绑，ARM/Thumb 上的双指令集，SPARC 上的寄存器窗口，PPC 上的计数寄存器。甚至可能在多种架构上的特性（例如基于 ARM 和 Itanium 的预测）也可能完全不同，以至于您不会共享一个实现。为了编写一个好的编译器，这些都是您需要了解的非常独特的功能，它们不仅仅是设计人员选择的不同配置。鉴于它们对于给定的处理器往往是唯一的，因此您在编译器中启用它们的任何切换实际上都是编译器中支持该处理器的特定代码，将其隐藏在某些配置选项后面以允许您启用它只是对此的混淆。

话虽如此，许多处理器必须处理许多共同的功能。因此，您会发现大多数现代编译器在配置文件中定义了指令编码、寄存器文件（和别名）和各种其他花絮，然后它们用来生成与手写位集成的编译器源的一部分。

查看 LLVM X86 后端，其中很大一部分（约 30%）是 .td（目标定义）文件

```
Phoenix:X86 louis$ ls -al | grep cpp 
-rw-r--r--   1 louis  louis    27627 Nov  1 03:32 X86CodeEmitter.cpp
-rw-r--r--   1 louis  louis      661 Oct 29 18:56 X86ELFWriterInfo.cpp
-rw-r--r--   1 louis  louis    46558 Oct 29 18:56 X86FastISel.cpp
-rw-r--r--   1 louis  louis    43660 Oct 29 18:56 X86FloatingPoint.cpp
-rw-r--r--   1 louis  louis    59915 Oct 29 18:56 X86ISelDAGToDAG.cpp
-rw-r--r--   1 louis  louis   312709 Nov  1 03:32 X86ISelLowering.cpp
-rw-r--r--   1 louis  louis   109229 Oct 29 18:56 X86InstrInfo.cpp
-rw-r--r--   1 louis  louis    17396 Oct 29 18:56 X86JITInfo.cpp
-rw-r--r--   1 louis  louis    44111 Nov  1 03:32 X86RegisterInfo.cpp
-rw-r--r--   1 louis  louis    10369 Oct 29 18:56 X86Subtarget.cpp
-rw-r--r--   1 louis  louis    15265 Oct 29 18:56 X86TargetAsmInfo.cpp
-rw-r--r--   1 louis  louis     9365 Oct 29 18:56 X86TargetMachine.cpp
Phoenix:X86 louis$ ls -al | grep td  
-rw-r--r--   1 louis  louis     6870 Oct 29 18:56 X86.td
-rw-r--r--   1 louis  louis    13480 Oct 29 18:56 X86CallingConv.td
-rw-r--r--   1 louis  louis    77361 Nov  1 03:32 X86Instr64bit.td
-rw-r--r--   1 louis  louis    31517 Oct 29 18:56 X86InstrFPStack.td
-rw-r--r--   1 louis  louis    11690 Oct 29 18:56 X86InstrFormats.td
-rw-r--r--   1 louis  louis   156188 Oct 29 18:56 X86InstrInfo.td
-rw-r--r--   1 louis  louis    32971 Oct 29 18:56 X86InstrMMX.td
-rw-r--r--   1 louis  louis   183502 Oct 29 18:56 X86InstrSSE.td
-rw-r--r--   1 louis  louis    23653 Nov  1 03:32 X86RegisterInfo.td 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T05:26:44.167

AFAIK，gcc 确实是这样工作的。检查gcc 文档中的[“机器描述”](http://gcc.gnu.org/onlinedocs/gccint/Machine-Desc.html)。当然，创建这些`.md`文件是一项主要的编程工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T04:51:19.403

不久前我在听一个播客，它谈到了一个（主要）用 Java 编写的 Java 虚拟机，它针对具有某种平台定义文件的多个不同平台。我*想*我在听[Java Posse](http://javaposse.com)，我*想*可能是[Maxine Research Virtual Machine](https://maxine.dev.java.net/)。

# rtml - 如何摆脱 RTML 函数产生的愚蠢的“pad”标签？

> ID：256500
> 
> 赞同：2
> 
> 时间：2008-11-02T04:23:43.670
> 
> 标签：rtml

我很不幸负责维护一些旧的 Yahoo! 使用他们基于 RTML 的平台构建的商店。

最近我注意到由一些 RTML 函数生成的 HTML 代码到处都是“填充图像”（或任何用于强制布局的 1x1 像素图像的常规名称）。我不反对使用这样的图像，但是......所有这些图像都提供了这样的 ALT 属性：

```
<img href="http://.../image1x1.gif" alt="pad"> 
```

非常尊重 RTML 的原作者，但是当他们想出这个“可访问性增强”时，他们一定是在抽烟...... :-(

无论如何，这是我的问题：

1.  有谁知道生成带有所有这些“pad”图像的 HTML 的所有 RTML 函数的列表？

2.  有什么方法可以在不重写大量 RTML 代码的情况下摆脱所有这些**alt="pad"属性？**

**注意：**这听起来可能有点愤世嫉俗，但提高可访问性并不是这里的主要目标。主要目标是停止将那些愚蠢的**alt="pad"**属性暴露给 Google 和其他智能搜索引擎。因此，据我所知，客户端脚本不会有帮助。

谢谢！

* * *

PS 也许，你们中的大多数人真的很幸运，从未听说过 RTML。因为如果有人会设立一个基于软件产品的奖项

```
commercial success
------------------
    usability 
```

比，这个基于 RTML 的“平台”很可能会获得第一名。

* * *

*PPS 显然有人来自 Yahoo! 终于听完了，因为我在为我们商店生成的 RTML 中再也找不到那些愚蠢的“pad”标签了。尽管如此，在回答我最初的问题时提出的一个想法确实提供了一个非常实用的解决方案——不仅针对原始问题，而且针对 RTML 平台的任何类似问题。看到获胜的答案 - 这真的很好。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-15T17:27:50.270

我看到的唯一方法是拥有自己的网站前端，它将从 RTML 站点过滤您想要的任何内容....

例如，您的 rtml 站点位于[http://rtmlusglysite.yahoo.com/store/XYZ01134](http://rtmlusglysite.yahoo.com/store/XYZ01134)，您可以在 http:://www.example.com 托管一个简单的 PHP 前端，其作用类似于“过滤" HTTP 网络代理，所以[http://rtmlusglysite.yahoo.com/store/XYZ01134/item1234.rtml](http://rtmlusglysite.yahoo.com/store/XYZ01134/item1234.rtml)将被[http://www.example.com/item1234.html 访问](http://www.example.com/item1234.html)

这不是一个理想的解决方案，但它应该可以工作，你可以做一些更花哨的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T06:08:43.273

好吧，您对 RTML 的看法是对的，它相对不受欢迎:)

您有办法将自己的属性添加到这些图像标签吗？如果是这样，是否可以覆盖 alt 属性？如果您指定 alt=""，我认为这会覆盖雅虎的...否则请考虑在其中为盲人和拨号类型放置一个有用的 alt 标签。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T08:53:28.960

这是我第一次听说这个平台，但这里有一个想法：如果您可以将 javascript 添加到页面，您可以编写一个在页面加载后运行的函数并删除所有 alt="pad" 属性从页面。

不幸的是，此解决方案仅适用于了解脚本的浏览器，因此 lynx 或其他一些基于文本的浏览器可能不支持它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-13T00:43:29.907

其他海报的不错尝试，但是有一个非常简单的 RTML 命令可以做到这一点。. .

```
文本 PAT-SUBST s GRAB
                     多
                         头
                         身体
                         文本@var-with-alt-tag-equals-pad-in-it
                 frompat "alt=\"pad\""
                 顶“”

```

上面的 RTML 会找到所有 alt="pad" 的实例并将其替换为空。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-28T21:00:06.800

我已经分享了来自 yahoo 的链接官方 RTML 指南。希望它会有所帮助。谢谢！

[可用的 RTML 书籍和资源列表](https://stackoverflow.com/questions/5464944/list-of-available-rtml-books-and-resources)

# lisp - 如何在 Lisp 中记忆递归函数？

> ID：256507
> 
> 赞同：18
> 
> 时间：2008-11-02T04:35:21.760
> 
> 标签：lisp, common-lisp, memoization

我是一个 Lisp 初学者。我试图记住一个递归函数来计算[Collat​​z 序列中的项数（对于](http://en.wikipedia.org/wiki/Collatz_conjecture)[Project Euler](http://projecteuler.net/index.php?section=problems&id=14)中的问题 14 ）。到目前为止，我的代码是：

```
(defun collatz-steps (n)
  (if (= 1 n) 0
       (if (evenp n) 
           (1+ (collatz-steps (/ n 2)))
           (1+ (collatz-steps (1+ (* 3 n)))))))

(defun p14 ()
  (defvar m-collatz-steps (memoize #'collatz-steps))
  (let 
      ((maxsteps (funcall m-collatz-steps 2))
       (n 2)
       (steps))
    (loop for i from 1 to 1000000
          do 
          (setq steps (funcall m-collatz-steps i))
          (cond 
            ((> steps maxsteps) 
             (setq maxsteps steps)
             (setq n i))
            (t ())))
    n))

(defun memoize (fn)
  (let ((cache (make-hash-table :test #'equal)))
    #'(lambda (&rest args)
        (multiple-value-bind 
              (result exists)
            (gethash args cache)
          (if exists
              result
              (setf (gethash args cache)
                    (apply fn args))))))) 
```

[memoize 函数与On Lisp](http://lib.store.yahoo.net/lib/paulgraham/onlisp.pdf)书中给出的函数相同。

与非记忆版本相比，此代码实际上并没有提供任何加速。我相信这是由于递归调用调用了函数的非记忆版本，这有点违背了目的。在那种情况下，在这里进行记忆的正确方法是什么？有没有办法让对原始函数的所有调用都调用记忆化版本本身，从而消除对特殊 m-collat​​z-steps 符号的需要？

编辑：更正了代码

```
(defvar m-collatz-steps (memoize #'collatz-steps)) 
```

这就是我的代码中的内容。在编辑之前，我错误地输入了：

```
(defvar collatz-steps (memoize #'collatz-steps)) 
```

看到这个错误给了我另一个想法，我尝试使用最后一个 defvar 本身并将递归调用更改为

```
 (1+ (funcall collatz-steps (/ n 2)))
       (1+ (funcall collatz-steps (1+ (* 3 n)))) 
```

这似乎确实执行了记忆（从大约 60 秒加速到 1.5 秒），但需要更改原始功能。是否有不涉及更改原始功能的更清洁的解决方案？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-02T19:11:29.137

我假设您使用的是 Common-Lisp，它具有用于变量和函数名称的单独命名空间。为了记住一个符号命名的函数，你需要改变它的函数绑定，通过访问器`fdefinition'：

```
(setf (fdefinition 'collatz-steps) (memoize #'collatz-steps))

(defun p14 ()
  (let ((mx 0) (my 0))
    (loop for x from 1 to 1000000
          for y = (collatz-steps x)
          when (< my y) do (setf my y mx x))
    mx)) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-03T19:46:01.140

这是一个重新绑定符号函数的 memoize 函数：

```
(defun memoize-function (function-name)
  (setf (symbol-function function-name)
    (let ((cache (make-hash-table :test #'equal)))
         #'(lambda (&rest args)
             (multiple-value-bind 
                 (result exists)
                (gethash args cache)
               (if exists
                   result
                   (setf (gethash args cache)
                         (apply fn args))))))) 
```

然后你会做这样的事情：

```
(defun collatz-steps (n)
  (if (= 1 n) 0
      (if (evenp n) 
          (1+ (collatz-steps (/ n 2)))
          (1+ (collatz-steps (1+ (* 3 n)))))))

(memoize-function 'collatz-steps) 
```

我会留给你做一个 unmemoize 功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-02T05:18:10.627

像这样的东西：

```
(setf collatz-steps (memoize lambda (n)
  (if (= 1 n) 0
    (if (evenp n) 
        (1+ (collatz-steps (/ n 2)))
        (1+ (collatz-steps (1+ (* 3 n)))))))) 
```

IOW：您的原始（非记忆）函数是匿名的，您只为记忆它的结果命名。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-06T18:36:50.167

注意几点：

```
(defun foo (bar)
   ... (foo 3) ...) 
```

上面是一个调用自身的函数。

在 Common Lisp 中，文件编译器可以假设 FOO 不会改变。稍后它不会调用更新的 FOO。如果改变了 FOO 的函数绑定，那么原函数的调用还是会转到旧函数。

**所以记忆一个自递归函数在一般情况下是行不通的。如果您使用的是好的编译器，则尤其如此。**

您可以解决它以始终通过符号，例如： (funcall 'foo 3)

(DEFVAR ...) 是一种顶级形式。不要在函数内部使用它。如果您已声明变量，请稍后使用 SETQ 或 SETF 设置它。

对于您的问题，我只使用哈希表来存储中间结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T04:58:06.113

更改“原始”函数是必要的，因为正如您所说，没有其他方法可以更新递归调用以调用记忆化版本。

幸运的是，lisp 的工作方式是在每次需要调用时*按名称*查找函数。这意味着用函数的memoized版本替换函数绑定就足够了，这样递归调用会自动查找并通过memoization重新进入。

怀远的代码展示了关键步骤：

```
(setf (fdefinition 'collatz-steps) (memoize #'collatz-steps)) 
```

这个技巧也适用于 Perl。然而，在像 C 这样的语言中，函数的记忆版本必须单独编码。

一些 lisp 实现提供了一个称为“advice”的系统，该系统提供了一个标准化的结构，用于将函数替换为自身的增强版本。除了像记忆这样的功能升级之外，通过插入调试打印（或完全停止并给出可继续的提示）而不修改原始代码，这在调试中非常有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-16T15:19:37.923

这个函数正是 Peter Norvig 给出的一个函数示例，它似乎是一个很好的记忆候选函数，但事实并非如此。

参见他关于记忆化的原始论文（“在现实世界人工智能系统中使用自动记忆化作为软件工程工具”）的图 3（函数“Hailstone”）。

所以我猜，即使你让记忆机制发挥作用，在这种情况下也不会真正加快速度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T05:13:53.993

不久前，我为 Scheme 编写了一个小记忆例程，它使用一系列闭包来跟踪记忆状态：

```
(define (memoize op)
  (letrec ((get (lambda (key) (list #f)))
           (set (lambda (key item)
                  (let ((old-get get))
                    (set! get (lambda (new-key)
                                (if (equal? key new-key) (cons #t item)
                                    (old-get new-key))))))))
    (lambda args
      (let ((ans (get args)))
        (if (car ans) (cdr ans)
            (let ((new-ans (apply op args)))
              (set args new-ans)
              new-ans)))))) 
```

这需要像这样使用：

```
(define fib (memoize (lambda (x)
                       (if (< x 2) x
                           (+ (fib (- x 1)) (fib (- x 2))))))) 
```

我确信这可以轻松移植到您最喜欢的词法范围的 Lisp 风格中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-06T17:33:29.570

我可能会做类似的事情：

```
(let ((memo (make-hash-table :test #'equal)))
  (defun collatz-steps (n)
    (or (gethash n memo)
    (setf (gethash n memo)
          (cond ((= n 1) 0)
            ((oddp n) (1+ (collatz-steps (+ 1 n n n))))
            (t (1+ (collatz-steps (/ n 2))))))))) 
```

它既不美观也不实用，但是，它并不麻烦，而且确实有效。缺点是你没有一个方便的非记忆版本来测试并且清除缓存接近“非常困难”。

# algorithm - 跳过列表与二叉搜索树

> ID：256511
> 
> 赞同：248
> 
> 时间：2008-11-02T04:39:55.603
> 
> 标签：algorithm, language-agnostic, data-structures, binary-tree, skip-lists

我最近遇到了一种称为[*跳过列表*](http://en.wikipedia.org/wiki/Skip_list)的数据结构。它似乎与二叉搜索树具有非常相似的行为。

为什么要在二叉搜索树上使用跳过列表？

* * *

## 回答 #1

> 赞同：282
> 
> 时间：2008-11-03T23:03:41.803

跳过列表更适合并发访问/修改。Herb Sutter 写了[一篇](http://www.ddj.com/hpc-high-performance-computing/208801371)关于并发环境中的数据结构的文章。它有更深入的信息。

## 二叉搜索树最常用的实现是[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)。修改树时会出现并发问题，它通常需要重新平衡。重新平衡操作会影响树的大部分，这将需要在许多树节点上使用互斥锁。将节点插入跳过列表更加本地化，​​只有直接链接到受影响节点的节点需要被锁定。

Jon Harrops 评论的更新

我阅读了 Fraser 和 Harris 的最新论文[Concurrent programming without locks](http://www.cl.cam.ac.uk/netos/papers/2007-cpwl.pdf)。如果您对无锁数据结构感兴趣，这真是个好东西。这篇论文的重点是[事务性内存](http://en.wikipedia.org/wiki/Transactional_memory)和一个理论操作多字比较和交换 MCAS。这两者都是在软件中模拟的，因为还没有硬件支持它们。我对他们能够在软件中构建 MCAS 印象深刻。

我没有发现事务内存的东西特别引人注目，因为它需要垃圾收集器。[软件事务内存](http://en.wikipedia.org/wiki/Software_transactional_memory)也受到性能问题的困扰。但是，如果硬件事务内存变得普遍，我会非常兴奋。最后，它仍在研究中，在未来十年左右不会用于生产代码。

在 8.2 节中，他们比较了几种并发树实现的性能。我将总结他们的发现。下载 pdf 是值得的，因为它在第 50、53 和 54 页上有一些非常有用的图表。

*   **锁定跳过列表**非常快。它们随着并发访问的数量而扩展得非常好。这就是使跳过列表特别的原因，其他基于锁的数据结构往往在压力下发声。
*   **无锁跳过列表**始终比锁定跳过列表快，但只是勉强。
*   **事务跳过列表**始终比锁定和非锁定版本慢 2-3 倍。
*   **锁定红黑树**在并发访问下呱呱叫。它们的性能随着每个新的并发用户而线性下降。在两种已知的锁定红黑树实现中，一种在树重新平衡期间本质上具有全局锁。另一个使用花哨（和复杂）的锁升级，但仍然没有明显优于全局锁版本。
*   **不存在无锁红黑树**（不再正确，请参阅更新）。
*   **事务性红黑树**与事务性跳过列表相当。这是非常令人惊讶和非常有希望的。事务性内存，虽然更容易编写，但速度较慢。它可以像在非并发版本上快速搜索和替换一样简单。

* * *

更新
这里是关于无锁树的论文：[Lock-Free Red-Black Trees Using CAS](http://www.cs.umanitoba.ca/%7Ehacamero/Research/RBTreesKim.pdf)。
我没有深入研究它，但从表面上看，它似乎很牢固。

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2015-02-02T02:59:01.947

首先，您无法公平地将随机数据结构与提供最坏情况保证的数据结构进行比较。

跳过列表等效于随机平衡二叉搜索树 (RBST)，在 Dean 和 Jones 的[“探索跳过列表和二叉搜索树之间的对偶性”](http://people.cs.clemson.edu/~bcdean/skip_bst.pdf)中进行了更详细的解释。

反过来，你也可以有确定性的跳过列表来保证最坏情况下的性能，参见。[门罗等人。](http://www.ic.unicamp.br/~celio/peer2peer/skip-net-graph/deterministic-skip-lists-munro.pdf)

与上面的某些说法相反，您可以实现在并发编程中运行良好的二叉搜索树 (BST)。以并发为中心的 BST 的一个潜在问题是，您无法像从红黑 (RB) 树中那样轻松获得相同的平衡保证。（但是“标准”，即随机的，跳过列表也不能给你这些保证。）在始终保持平衡和良好（且易于编程）的并发访问之间进行权衡，因此通常使用*宽松*的 RB 树当需要良好的并发性时。放松包括不立即重新平衡树。对于有点过时的（1998 年）调查，请参阅 Hanke 的“并发红黑树算法的性能” [[ps.gz]](ftp://ftp.informatik.uni-freiburg.de/documents/reports/report115/report00115.ps.gz.)。

对这些最近的改进之一是所谓的*彩色树*（基本上你有一些权重，黑色为 1，红色为 0，但你也允许介于两者之间的值）。彩色树在跳过列表中的表现如何？让我们看看布朗等人是什么。[“A General Technique for Non-blocking Trees”](http://www.cs.toronto.edu/~tabrown/chromatic/fullpaper.pdf)（2014）不得不说：

> 我们的算法有 128 个线程，比 Java 的非阻塞跳过列表（Bronson 等人的基于锁的 AVL 树）高出 13% 到 156%。63% 到 224%，以及使用软件事务内存 (STM) 13 到 134 次的 RBT

编辑添加：Pugh 的基于锁的跳过列表，在 Fraser 和 Harris (2007) [“无锁并发编程”](http://www.cl.cam.ac.uk/research/srg/netos/papers/2007-cpwl.pdf)中进行了基准测试，接近他们自己的无锁版本（这里的最佳答案中充分强调了这一点），还针对良好的并发操作进行了调整，参见。Pugh 的[“跳过列表的并发维护”](http://drum.lib.umd.edu/bitstream/1903/542/2/CS-TR-2222.pdf)，虽然方式相当温和。尽管如此，一篇较新的/2009 年论文[“A Simple Optimistic skip-list Algorithm”](http://people.csail.mit.edu/shanir/publications/LazySkipList.pdf)Herlihy 等人提出了一种据称更简单（比 Pugh 的）基于锁的并发跳过列表实现，批评 Pugh 没有为他们提供足够令人信服的正确性证明。撇开这个（也许太迂腐的）疑虑不谈，Herlihy 等人。表明他们更简单的基于锁的跳过列表实现实际上无法像 JDK 的无锁实现一样扩展，但仅适用于高争用（50% 插入、50% 删除和 0% 查找）......弗雷泽哈里斯根本没有测试；Fraser 和 Harris 仅测试了 75% 的查找、12.5% 的插入和 12.5% 的删除（在具有约 500K 元素的跳过列表上）。Herlihy 等人的更简单的实现。在他们测试的低争用情况下（70% 查找、20% 插入、10% 删除），也接近 JDK 的无锁解决方案；当他们使他们的跳过列表足够大时，他们实际上击败了这种情况下的无锁解决方案，即从 200K 到 2M 元素，因此任何锁的争用概率变得可以忽略不计。如果 Herlihy 等人会很好。他们已经克服了对 Pugh 证明的困扰，并测试了他的实现，但可惜他们没有这样做。

EDIT2：我发现了所有基准的（2015 年出版）母线：Gramoli 的[“比你想知道的更多关于同步。同步台，测量同步对并发算法的影响”](http://delivery.acm.org/10.1145/2690000/2688501/p1-gramoli.pdf)：这是与这个问题相关的摘录图像。

![在此处输入图像描述](https://i.stack.imgur.com/iWBcf.png)

“Algo.4”是上述 Brown 等人的前身（旧版本，2011 年版本）。（我不知道 2014 版本好坏了多少）。“Algo.26”是上面提到的 Herlihy；正如您所看到的，它在更新时被丢弃了，而且这里使用的 Intel CPU 比原始论文中的 Sun CPU 更糟糕。“Algo.28”是来自 JDK 的 ConcurrentSkipListMap；与其他基于 CAS 的跳过列表实现相比，它的表现不如人们希望的那么好。竞争激烈的获胜者是“Algo.2”，一种由 Crain 等人描述的基于锁的算法 (!!)。在["A Contention-Friendly Binary Search Tree"](http://sydney.edu.au/engineering/it/~gramoli/doc/pubs/EuroPar2013.pdf)和 "Algo.30" 中是 "rotating skiplist" 来自["Logarithmic data structures for multicores"](http://sydney.edu.au/engineering/it/research/tr/tr697.pdf)。". 请注意，Gramoli 是所有这三篇获胜者算法论文的合著者。“Algo.27”是弗雷泽跳过列表的 C++ 实现。

Gramoli 的结论是，搞砸基于 CAS 的并发树实现比搞砸类似的跳过列表要容易得多。根据这些数字，很难不同意。他对这个事实的解释是：

> 设计无锁树的困难源于原子地修改多个引用的困难。跳过列表由通过后继指针相互链接的塔组成，其中每个节点都指向紧接在其下方的节点。它们通常被认为类似于树，因为每个节点在后继塔及其下方都有一个后继者，但是，主要区别是向下指针通常是不可变的，因此简化了节点的原子修改。这种区别可能是跳过列表在激烈争用下优于树的原因，如图 [上图] 所示。

克服这一困难是 Brown 等人最近工作的一个关键问题。他们有一篇完全独立的（2013 年）论文[“Pragmatic Primitives for Non-blocking Data Structures”](http://www.cs.utoronto.ca/~tabrown/podc13/fullpaper.pdf) ，关于构建多记录 LL/SC 复合“原语”，他们称之为 LLX/SCX，他们自己使用（机器级）CAS 实现。布朗等人。在他们的 2014 年（但不是在他们的 2011 年）并发树实现中使用了这个 LLX/SCX 构建块。

我认为这里或许也值得总结一下[“无热点”/争用友好 (CF) 跳过列表的基本思想](https://hal.inria.fr/hal-00699794/file/techReport_v3.pdf). 它从宽松的 RB 树（以及类似的并发数据结构）中添加了一个基本思想：塔不再在插入后立即建立，而是延迟到竞争减少为止。相反，拆除一座高塔会引起许多争用；早在 Pugh 的 1990 年并发跳过列表论文中就观察到了这一点，这就是为什么 Pugh 在删除时引入了指针反转（维基百科关于跳过列表的页面至今仍未提及的花絮，唉）。CF 跳过列表更进一步，延迟删除高塔的上层。CF 跳过列表中的两种延迟操作都是由一个（基于 CAS 的）独立的类似垃圾收集器的线程执行的，其作者称之为“适应线程”。

Synchrobench 代码（包括所有测试的算法）可在以下网址获得：[https](https://github.com/gramoli/synchrobench) ://github.com/gramoli/synchrobench 。最新的布朗等人。实现（不包括在上面）可在[http://www.cs.toronto.edu/~tabrown/chromatic/ConcurrentChromaticTreeMap.java](http://www.cs.toronto.edu/~tabrown/chromatic/ConcurrentChromaticTreeMap.java)有没有人有 32+ 核心机器可用？J/K 我的意思是你可以自己运行这些。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-02T06:32:23.800

此外，除了给出的答案（易于实施以及与平衡树相当的性能）。我发现实现按顺序遍历（向前和向后）要简单得多，因为跳过列表在其实现中实际上有一个链表。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-16T06:45:31.783

在实践中，我发现我的项目中的 B-tree 性能比跳过列表更好。跳过列表似乎更容易理解，但实现 B 树并不*难*。

我知道的一个优点是一些聪明的人已经研究出如何实现一个只使用原子操作的无锁并发跳过列表。例如，Java 6 包含 ConcurrentSkipListMap 类，如果你疯了，你可以阅读它的源代码。

但是编写并发 B-tree 变体也不是太难——我见过其他人做过——如果你在沿着树走的时候“以防万一”抢先拆分和合并节点，那么你就不必担心死锁，并且一次只需要在树的两个级别上持有一个锁。同步开销会更高一些，但 B-tree 可能更快。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-02T04:47:37.460

从您引用的[维基百科文章中：](http://en.wikipedia.org/wiki/Skip_list)

> Θ(n) 操作，它迫使我们以升序访问每个节点（例如打印整个列表），提供了以最佳方式对跳过列表的级别结构执行幕后去随机化的机会，将跳过列表带到 O(log n) 搜索时间。[...] 一个跳过列表，我们最近没有对其执行[任何这样的] Θ(n) 操作，**它不能提供与更传统的平衡树数据结构相同的绝对最坏情况性能保证**，因为它总是可能的（尽管概率非常低）用于构建跳过列表的硬币翻转将产生一个不平衡的结构

编辑：所以这是一个权衡：跳过列表使用更少的内存，但它们可能会退化为不平衡的树。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-24T20:21:58.167

跳过列表是使用列表实现的。

单链表和双链表都存在无锁解决方案——但没有任何 O(logn) 数据结构直接使用 CAS 的无锁解决方案。

但是，您可以使用基于 CAS 的列表来创建跳过列表。

（请注意，使用 CAS 创建的 MCAS 允许任意数据结构，并且使用 MCAS 创建了概念证明红黑树）。

因此，尽管它们很奇怪，但事实证明它们非常有用:-)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-04-05T20:45:49.217

跳过列表确实具有锁剥离的优势。但是，runt time 取决于如何决定新节点的级别。通常这是使用 Random() 完成的。在 56000 个单词的字典中，skip list 比 splay tree 花费更多时间，而 tree 比 hash table 花费更多时间。前两个无法匹配哈希表的运行时。此外，哈希表的数组也可以以并发的方式进行锁剥离。

当需要参考位置时，使用跳过列表和类似的有序列表。例如：查找应用程序中某个日期的下一个和之前的航班。

内存二叉搜索展开树非常好，也更常用。

[字典查找操作上的跳过列表与展开树与哈希表运行时](http://harisankar-krishnaswamy.blogspot.in/2012/04/skip-list-runtime-on-dictionay.html)

# multithreading - 确保线程安全的最佳编程方法/方法

> ID：256517
> 
> 赞同：8
> 
> 时间：2008-11-02T04:45:32.520
> 
> 标签：multithreading, multicore, concurrency

当我从大约 20 年的基本、Pascal、COBOL 和 C 过程编程的背景中学习 Java 时，我当时认为最难的事情是围绕 OOP 术语和概念来思考。现在有了大约 8 年的扎实 Java 经验，我得出的结论是，使用 Java 和类似的语言（如 C#）进行编程最困难的事情就是多线程/并发方面。

编写可靠且可扩展的多线程应用程序非常困难！随着处理器发展“更宽”而不是更快的趋势，它正迅速变得非常关键。

当然，最难的领域是控制线程之间的交互以及由此产生的错误：死锁、竞争条件、陈旧数据和延迟。

*所以我的问题是：你*采用什么方法或方法来生成安全的并发代码，同时减少死锁、延迟和其他问题的可能性？我提出了一种有点非传统的方法，但在几个大型应用程序中效果很好，我将分享这个问题的详细答案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-02T05:10:20.037

这不仅适用于 Java，也适用于一般的线程编程。我发现自己只需遵循以下准则就可以避免大多数并发和延迟问题：

1/ 让每个线程运行自己的生命周期（即决定何时死亡）。它可以从外部提示（比如一个标志变量），但它完全负责。

2/**让所有**线程以相同的顺序分配和释放它们的资源——这保证不会发生死锁。

3/ 尽可能短的时间锁定资源。

4/ 将数据的责任交给数据本身——一旦你通知线程数据是它要处理的，**不要管它，**直到责任归还给你。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-02T06:23:50.107

有许多技术刚刚进入公众意识（例如：过去几年）。一个大的将是演员。这是 Erlang 首次引入网格铁的东西，但它已被 Scala 等新语言（JVM 上的参与者）发扬光大。虽然演员确实不能解决所有问题，但它们确实使推理代码和识别问题点变得更加容易*。*它们还使设计并行算法变得更加简单，因为它们迫使您使用延续传递共享可变状态的方式。

Fork/Join 是你应该看的东西，特别是如果你在 JVM 上。Doug Lea 撰写了关于该主题的开创性论文，但多年来许多研究人员一直在讨论它。据我了解，Doug Lea 的参考框架计划包含在 Java 7 中。

在侵入性稍小的层面上，通常简化多线程应用程序所需的唯一步骤就是降低锁定的复杂性。细粒度锁定（Java 5 风格）非常适合吞吐量，但很难做到正确。通过 Clojure 获得一些关注的另一种锁定方法是软件事务内存 (STM)。这本质上与传统锁定相反，因为它是乐观的而不是悲观的。您首先假设您不会有任何冲突，然后允许框架在问题发生时解决问题。数据库通常以这种方式工作。这对于碰撞率低的系统的吞吐量非常有用，但最大的胜利在于算法的逻辑组件化。无需将锁（或一系列锁）与某些数据任意关联，您只需将危险代码包装在事务中，让框架解决其余的问题。您甚至可以从像 GHC 的 STM monad 或我的实验性 Scala STM 这样的体面的 STM 实现中获得相当多的编译时检查。

有很多用于构建并发应用程序的新选项，您选择哪一个很大程度上取决于您的专业知识、您的语言以及您尝试建模的问题类型。作为一般规则，我认为演员与持久的、不可变的数据结构相结合是一个可靠的选择，但正如我所说，STM 的侵入性要小一些，有时可以产生更直接的改进。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-02T04:57:35.037

1.  尽可能避免在线程之间共享数据（复制所有内容）。
2.  在可能的情况下，永远不要锁定对外部对象的方法调用。
3.  尽可能缩短锁定时间。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-02T04:58:37.390

Java中的线程安全没有**一个真正的答案**。但是，至少有一本非常棒的书：[Java Concurrency in Practice](http://www.javaconcurrencyinpractice.com/)。我经常参考它（尤其是我旅行时的在线 Safari 版本）。

我强烈建议您深入阅读本书。您可能会发现，您的非常规方法的成本和收益已经过深入研究。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-02T08:59:23.740

我通常遵循 Erlang 风格的方法。我使用主动对象模式。它的工作原理如下。

将您的应用程序划分为非常粗粒度的单元。在我当前的一个应用程序（400.000 LOC）中，我有 appr。这些粗粒度单元中的 8 个。**这些单位根本不共享数据。每个单元都有自己的本地数据。每个单元都在自己的线程上运行**（= 活动对象模式），因此是单线程的。您不需要单位内的任何锁。当单元需要向其他单元发送消息时，他们通过将消息发布到其他单元的队列来完成。另一个单元从队列中挑选消息并对该消息作出反应。这可能会向其他单位触发其他消息。因此，此类应用程序中唯一的锁围绕队列（每个单元一个队列和锁）。**根据定义，这种架构是无死锁的！**

一旦您了解了基本原理，该架构的扩展性非常好，并且非常容易实现和扩展。它喜欢将其视为应用程序中的 SOA。

通过将您的应用程序划分为单元记住。每个 CPU 内核的最佳长时间运行线程数是 1。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-06-25T20:25:01.430

我推荐基于流的编程，也就是数据流编程。它*使用*OOP 和线程，我觉得这像是一个自然的进步，就像 OOP 被程序化了一样。不得不说，数据流编程不是万能的，它不是通用的。

维基百科有关于这个主题的好文章：

[http://en.wikipedia.org/wiki/Dataflow_programming](http://en.wikipedia.org/wiki/Dataflow_programming)

[http://en.wikipedia.org/wiki/Flow-based_programming](http://en.wikipedia.org/wiki/Flow-based_programming)

此外，它还有几个优点，如令人难以置信的灵活配置、分层；程序员（组件程序员）不必编写业务逻辑，它是在另一个阶段完成的（将处理网络放在一起）。

你知道吗，*make*是一个数据流系统？请参阅**make -j**，特别是如果您有多核处理器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-02T05:11:24.683

在多线程应用程序中编写所有代码非常……小心！我不知道有什么比这更好的答案。（这涉及到提到的[jonnii 之](https://stackoverflow.com/questions/256517/best-programming-approachmethodology-to-assure-thread-safety#256535)类的东西）。

我听到人们争论（并同意他们）传统的线程模型在未来真的行不通，所以我们将不得不开发一套不同的范例/语言来真正使用这些新奇的多线程模型。有效的核心。像 Haskell 这样的语言，其程序很容易并行化，因为任何具有副作用的函数都必须以这种方式显式标记，还有 Erlang，不幸的是我不太了解。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-02T06:11:46.107

我看到的核心问题是（a）避免死锁和（b）在线程之间交换数据。出租人的一个担忧（但只是轻微出租人）是避免瓶颈。我已经遇到了几个不同的无序锁定导致死锁的问题——说“总是以相同的顺序获取锁”很好，但在中型到大型系统中，实际上通常不可能确保这一点。

警告：当我想出这个解决方案时，我必须以 Java 1.1 为目标（所以并发包在 Doug Lea 眼中还不是一闪而过）——手头的工具完全同步并等待/通知。我借鉴了使用基于实时消息的系统 QNX 编写复杂的多进程通信系统的经验。

根据我使用 QNX 的经验，它存在死锁问题，但通过将消息从一个进程的内存空间处理到另一个进程来避免数据并发，我提出了一种基于消息的对象方法——我称之为 IOC，用于对象间协调. 在开始时，我设想我可能会像这样创建*所有*对象，但事后看来，它们仅在大型应用程序的主要控制点是必需的——如果你愿意的话，“州际交换”并不适用于每一个道路系统中的“十字路口”。事实证明这是一个主要的好处，因为它们完全不是 POJO。

我设想了一个系统，其中对象在概念上不会调用同步方法，而是“发送消息”。消息可以是发送/回复，发送方在处理消息时等待并返回回复，也可以是异步的，其中消息被放入队列并在稍后阶段出列并处理。请注意，这是一个概念上的区别——消息传递是使用同步方法调用实现的。

消息系统的核心对象是IsolatedObject、IocBinding 和IocTarget。

隔离对象之所以被称为是因为它没有公共方法；这是为了接收和处理消息而扩展的。使用反射进一步强制子对象没有公共方法，也没有任何包或受保护的方法，除了那些从 IsolatedObject 继承的方法，几乎​​所有这些方法都是最终的；起初它看起来很奇怪，因为当您继承 IsolatedObject 时，您创建了一个具有 1 个受保护方法的对象：

```
Object processIocMessage(Object msgsdr, int msgidn, Object msgdta) 
```

其余所有方法都是处理特定消息的私有方法。

IocTarget 是一种抽象IsolatedObject 可见性的方法，对于为另一个对象提供自我引用以将信号发回给您，而不暴露您的实际对象引用非常有用。

IocBinding 只是将发送者对象绑定到消息接收者，这样就不会对发送的每条消息进行验证检查，而是使用 IocTarget 创建的。

与隔离对象的所有交互都是通过“发送”消息来实现的——接收者的 processIocMessage 方法是同步的，这确保了一次只处理一条消息。

```
Object iocMessage(int mid, Object dta)
void   iocSignal (int mid, Object dta) 
```

在创建了一个孤立对象完成的所有工作都通过一个方法汇集的情况之后，我接下来通过它们在构造时声明的“分类”将对象排列在声明的层次结构中 - 只是一个将它们标识为其中之一的字符串任意数量的“消息接收器类型”，将对象置于某个预定的层次结构中。然后我使用消息传递代码来确保如果发送者本身是一个独立对象，对于同步发送/回复消息，它是层次结构中较低的一个。异步消息（信号）使用线程池中的单独线程分派给消息接收者，线程池的整个工作传递信号，因此信号可以从任何对象发送到系统中的任何接收者。信号可以传递任何所需的消息数据，

因为消息只能*向上*传递（并且信号总是向上传递，因为它们是由专门为此目的运行的单独线程传递的）死锁在设计上被消除了。

因为线程之间的交互是通过使用 Java 同步交换消息来完成的，所以设计上同样消除了竞争条件和陈旧数据的问题。

因为任何给定的接收器一次只处理一条消息，并且因为它没有其他入口点，所以消除了对对象状态的所有考虑——实际上，对象是完全同步的，并且同步不会意外地被任何方法遗漏；没有 getter 返回过时的缓存线程数据，也没有 setter 在另一个方法作用于它时更改对象状态。

因为只有主要组件之间的交互通过这种机制汇集，所以在实践中这已经很好地扩展了——这些交互在实践中几乎没有我理论的那样经常发生。

整个设计成为以严格控制的方式交互的有序*子系统集合之一。*

请注意，这不适用于更简单的情况，即使用更传统的线程池的工作线程就足够了（尽管我经常通过发送 IOC 消息将工作线程的结果注入主系统）。它也不用于线程关闭并执行完全独立于系统其余部分的事情的情况，例如 HTTP 服务器线程。最后，它不用于资源协调器本身不与其他对象交互以及内部同步将完成工作而没有死锁风险的情况。

编辑：我应该说交换的消息通常应该是不可变的对象；如果使用可变对象，则发送它的行为应被视为移交并导致发送者放弃所有控制权，并且最好不保留对数据的引用。就个人而言，我使用了一个可锁定的数据结构，它被 IOC 代码锁定，因此在发送时变得不可变（锁定标志是易失的）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-02T07:22:02.907

我建议演员模型。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-02T08:53:48.913

[演员模型](http://en.wikipedia.org/wiki/Actor_model)就是您正在使用的，它是迄今为止最简单（和有效的方式）多线程的东西。基本上每个线程都有一个（同步的）队列（它可以依赖于操作系统或不依赖于操作系统），其他线程生成消息并将它们放入将处理消息的线程的队列中。

基本示例：

```
thread1_proc() {

msg = get_queue1_msg(); // block until message is put to queue1
threat1_msg(msg);

}

thread2_proc() {
msg = create_msg_for_thread1();
send_to_queue1(msg);
} 
```

这是[生产者消费者](http://en.wikipedia.org/wiki/Producer-consumer_problem)问题的典型例子。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-02T09:04:09.953

这显然是一个难题。除了明显需要小心之外，我认为第一步是准确定义您需要哪些线程以及为什么需要。

像设计类一样设计线程：确保知道是什么使它们保持一致：它们的内容以及它们与其他线程的交互。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-03T01:56:23.407

我记得当我发现 Java 的 synchronizedList 类不是完全线程安全的，而只是有条件的线程安全时，我感到有些震惊。如果我没有将我的访问（迭代器、设置器等）包装在同步块中，我仍然可能会被烧毁。这意味着我可能已经向我的团队和我的管理层保证我的代码是线程安全的，但我可能错了。我可以确保线程安全的另一种方法是使用工具来分析代码并让它通过。STP、Actor 模型、Erlang 等是获得后一种保证形式的一些方法。能够可靠地确保程序的属性是/将是编程的一大步。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-11T19:53:49.770

看起来你的 IOC 有点像 FBP :-) 如果 JavaFBP 代码可以得到像你这样精通编写线程安全代码艺术的人的彻底审查，那就太好了……它在 SourceForge 的 SVN 上。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-06-25T20:52:25.523

一些专家认为您的问题的答案是完全避免线程，因为几乎不可能避免无法预料的问题。引用[线程问题](http://www.eecs.berkeley.edu/Pubs/TechRpts/2006/EECS-2006-1.pdf)：

我们开发了一个流程，其中包括代码成熟度评级系统（有四个级别，红色、黄色、绿色和蓝色）、设计审查、代码审查、夜间构建、回归测试和自动代码覆盖率指标。确保程序结构视图一致的内核部分是在 2000 年初编写的，设计审查为黄色，代码审查为绿色。审稿人包括并发专家，而不仅仅是没有经验的研究生（Christopher Hylands（现为 Brooks）、Bart Kienhuis、John Reekie 和 [Ed Lee] 都是审稿人）。我们编写了实现 100% 代码覆盖率的回归测试……系统本身开始被广泛使用，并且每次使用系统都会执行此代码。直到四年后的 2004 年 4 月 26 日代码陷入僵局，才发现任何问题。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-01-20T13:03:11.433

使用多线程设计新应用程序的最安全方法是遵守以下规则：

**没有设计低于设计。**

这意味着什么？

想象一下，您确定了应用程序的主要构建块。让它成为 GUI，一些计算引擎。通常，一旦您拥有足够大的团队规模，团队中的一些人会要求“库”在这些主要构建块之间“共享代码”。虽然在开始时为主要构建块定义线程和协作规则相对容易，但所有这些努力现在都处于危险之中，因为“代码重用库”将设计得很糟糕，在需要时进行设计，并且到处都是锁和互斥锁“感觉不错”。这些临时库是您设计之下的设计，也是您的线程架构的主要风险。

该怎么办？

*   告诉他们你宁愿重复代码而不是跨线程边界共享代码。
*   如果您认为，该项目将真正受益于一些库，建立它们必须是无状态和可重入的规则。
*   您的设计正在不断发展，其中一些“通用代码”可能会在设计中“向上移动”，成为您应用程序的新主要构建块。
*   远离酷酷的网上图书馆狂热。一些第三方库确实可以为您节省大量时间。但也有一种趋势，即任何人都有自己的“最爱”，这几乎不是必需的。随着您添加的每个第三方库，您遇到线程问题的风险就会增加。

最后同样重要的是，考虑在您的主要构建块之间进行一些基于消息的交互；例如，参见经常提到的演员模型。

# asp.net - 从 URL 上传 ASP.NET 图像

> ID：256526
> 
> 赞同：1
> 
> 时间：2008-11-02T04:50:08.000
> 
> 标签：asp.net, image, file-upload

我有一个 aspx 页面，用户将在其中输入有效的图像 url（例如：[https](https://stackoverflow.com/Content/Img/stackoverflow-logo-250.png) ://stackoverflow.com/Content/Img/stackoverflow-logo-250.png ）。我需要程序将此图像上传到服务器。我怎样才能做到这一点 ？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-02T05:02:04.857

```
System.Net.WebClient webClient = new WebClient();

webClient.DownloadFile(@"http://stackoverflow.com/Content/Img/stackoverflow-logo-250.png",
@"c:\path\localfile.png"); 
```

您可以使用[Server.MapPath](http://msdn.microsoft.com/en-us/library/ms524632.aspx)获取服务器上的物理目录对应的相对或虚拟路径，例如`Server.MapPath("~/Images")`

# c# - 在 WPF 中解析本地 XML 文档（在调试中工作，发布后失败）

> ID：256529
> 
> 赞同：1
> 
> 时间：2008-11-02T04:51:01.773
> 
> 标签：c#, wpf, xml

我正在构建一个 WPF 应用程序。在该应用程序中，我使用 XmlReader 类来解析几个本地 XML 文件。我编写的代码在调试过程中**运行**良好，但一旦我发布应用程序并安装它就会失败。

我在构建操作中将 XML 文档作为 CONTENT，并将它们设置为 COPY ALWAYS。我可以确认 XML 文档正在我的构建中部署，并且在安装后在应用程序文件夹中完好无损。

更让我感到困惑的是，我使用相同的 XmlReader 代码在此应用程序中解析来自外部网站的 RSS 提要没有问题。它仅在本地 XML 文档上失败。

有谁知道为什么我的 XmlReader 在应用程序发布后无法解析本地 XML 文档？

这是我的 XmlReader 代码的一小段供参考：

```
XmlReaderSettings settings = new XmlReaderSettings();
            settings.IgnoreComments = true;
            settings.IgnoreProcessingInstructions = true;
            settings.IgnoreWhitespace = true;
            try
            {
                settingsReader = XmlReader.Create("Resources/data/TriviaQuestions.xml", settings);

                nodeNum = 0;
                while (settingsReader.Read())
                {
                    switch (settingsReader.NodeType)
                    {
                        case XmlNodeType.Element:
                            if (settingsReader.HasAttributes)
                            {
                                for (int i = 0; i < settingsReader.AttributeCount; i++)
                                {
                                    settingsReader.MoveToAttribute(i);
                                    _feeds[nodeNum] = settingsReader.Value.ToString();
                                }
                                settingsReader.MoveToContent(); // Moves the reader back to the element node.
                            }
                            break;
                        case XmlNodeType.Text:
                            _questions[nodeNum] = settingsReader.Value;
                            nodeNum++;
                            break;

                    }

                }
                settingsReader.Close();
            }
            catch
            {

            } 
```

这是我的 XML

```
<?xml version="1.0" encoding="utf-8" ?>
<Questions>
    <Question feed="http://entertainment.msn.com/rss/topboxoffice/">What movie has the top box office sales in the US right now?</Question>
    <Question feed="http://entertainment.msn.com/rss/topdvdrentals/">What is the top DVD rental in the US this week?</Question>
    <Question feed="http://entertainment.msn.com/rss/topalbums/">Which of the following albums is currently topping the charts?</Question>
</Questions> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T09:05:09.797

根据您的发布描述，我假设您正在使用 clickonce 来安装应用程序。

Clickonce 对 xml 文件有不同的默认行为 - 它假定它们是数据文件并将它们放置在与其他文件不同的安装位置。

请仔细检查您的 xml 文件是否真的安装在您认为的位置。

在发布设置中，您可以将每个 xml 文件的设置从数据文件更改为包含。您的其他文件将已设置为包含。

请注意，发布设置独立于文件的构建设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T05:52:01.153

您能否描述“但一旦我发布应用程序并安装它就会失败”？

如果您能描述什么不起作用、错误是什么并提供异常信息，那将会很有帮助。

* * *

与您的问题无关，每当我在生产代码中看到空的 catch 块时，我都会感到恐惧！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T19:19:23.473

考虑使用 IsolatedStorage 来存储您的设置，而不是在相对的 Resources 目录中。这将为您提供不同安装方案（例如，ClickOnce 安装）的已知位置。

# .net - 在asp.net ajax页面中不断重复计时器

> ID：256544
> 
> 赞同：0
> 
> 时间：2008-11-02T05:10:16.680
> 
> 标签：.net, asp.net, asp.net-ajax, timer

今天我对 ASP.NET AJAX Timer Control 进行了第一次测试，希望它能让我不断更新我的网站。

目前，它只更新一次；这与以前的 .NET 计时器的行为不匹配。

AJAX Timer 控件是否仅用于更新项目一次？还是我需要使用另一个框架？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T05:48:23.360

不，它会定期更新。确保您的计时器已启用并且间隔设置正确，然后尝试将其放入更新面板中。适用于我的页面 * 个人资料页面中的链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T09:32:26.810

You could try to check your implementation against what is described in [this tutorial on MSDN (Walkthrough)](http://msdn.microsoft.com/en-us/library/bb398787.aspx).

*"The Timer control can work as a trigger either inside or outside an UpdatePanel control. This example shows how to use the Timer control inside an UpdatePanel control. For an example of using a Timer control as a trigger outside an UpdatePanel control, see Walkthrough: Using the ASP.NET Timer Control with Multiple UpdatePanel Controls."*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T17:26:42.047

查看 setInterval 函数。一个很好的解释是[here。](http://javascript.about.com/library/blstvsi.htm)

# .net - 类型字符串的验证器？

> ID：256546
> 
> 赞同：1
> 
> 时间：2008-11-02T05:10:53.543
> 
> 标签：.net, configuration, validation

任何人都知道是否已经有“类型”字符串的验证器？

我想确保我的自定义配置中的类型属性是以下之一：

```
type="TopNamespace.SubNameSpace.ContainingClass, MyAssembly"
type="TopNamespace.SubNameSpace.ContainingClass, MyAssembly, Version=1.3.0.0, Culture=neutral, PublicKeyToken=b17a5c561934e089"

```

写一个很容易，我只是不想重新发明轮子。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-15T17:04:57.400

我不确定您所说的“自定义配置”是什么意思，但如果您仍在使用 .NET 的配置框架（例如，开发自定义[configurationSection](http://msdn.microsoft.com/en-us/library/system.configuration.configurationsection.aspx) / [configurationElement](http://msdn.microsoft.com/en-us/library/system.configuration.configurationelement.aspx)），您可以简单地将[属性](http://msdn.microsoft.com/en-us/library/system.configuration.configurationpropertyattribute.aspx)键入为 System.Type（而不是string)，.NET 将自动进行验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T10:56:18.933

如果 resharper 的全局错误分析找不到名称空间或类，您将收到错误，但如果您引用插件，这并不总是有帮助。

可能最简单的事情是将您的代码加载到应用程序域中的 try catch 块中。

如果 dll 在 bin 中，它将在启动时加载，但在您使用它之前不会引发错误，因此如果您只是新建一个 ContainingClass 实例。您可以从配置中提取名称空间，然后尝试使用每个类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T15:12:19.460

我很确定框架中没有为此内置任何内容。

[regexlib.com 上](http://regexlib.com/Search.aspx?k=type+name&c=-1&m=-1&ps=20)有几个结果。它们中的任何一个都应该适用于您描述的场景。但是，请记住，它们都不会正确支持指定泛型类型的语法。为了正确处理这个问题，仅使用正则表达式是不够的——您需要针对泛型类型参数递归处理相同的正则表达式。例如，考虑以下类型名称：

```
List<>
"System.Collections.Generic.List`1"

List<string>
"System.Collections.Generic.List`1[[System.String]]"

Dictionary<string, string>
"System.Collections.Generic.Dictionary`2[[System.String],[System.String]]"

Dictionary<string, List<string>>
"System.Collections.Generic.Dictionary`2[[System.String],[System.Collections.Generic.List`1[[System.String]]]]" 
```

有关详细信息，请参阅有关[Type.AssemblyQualifiedName](http://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname.aspx)的 MSDN 文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-15T22:55:45.570

如果您正在编写自定义配置部分，Abraham Pinzur 的建议是正确的。

`Type.GetType(...)`允许您手动完成。

# .net - 有没有办法记录或拦截 First Chance Exceptions

> ID：256548
> 
> 赞同：8
> 
> 时间：2008-11-02T05:15:57.637
> 
> 标签：.net, exception

如果没有使用分析器，在运行程序中是否有任何方法可以检测第一次机会异常？理想情况下，我想记录更详细的状态信息，一旦 catch 块接管了最终异常，这些信息将不可用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-01-29T00:15:46.947

我在谷歌上搜索 FirstChanceException，两年多后我忍不住回答了这个问题......

现在，在 .net 4.0 中，您可以捕获 AppDomain 的[FirstChanceException 事件](https://msdn.microsoft.com/en-us/library/system.appdomain.firstchanceexception(VS.100).aspx)。它只是一个事件，因此您无法处理错误，但它似乎是获取有关异常信息的一种很好的集中方式，无论它们是否被处理。FirstChanceException 事件在一个 catch 块被允许处理它之前被抛出。我没有找到很多关于它的信息，但除了微软文档之外，更好的来源之一是[Mitch Sellers Blog](http://www.mitchelsellers.com/blogs/articletype/articleview/articleid/334/first-chance-exception-event-net-40.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-03T02:45:04.743

我认为在 .NET 中获取该信息的唯一方法是使用调试器。

否则，您必须自己开发一个解决方案来保存堆栈帧的状态并使用一种特殊的方式来记录异常。您基本上会做与内存分析器相同的事情，跟踪创建的实例。除非您限制要记录的信息量，否则这将对性能造成巨大影响。

更好的解决方案是使用 System.Diagnostics 命名空间中的 Trace 和 Assert 功能来选择性地跟踪程序状态，或者使用日志记录工具（log4net、EnterpriseLibrary、NLog，滚动您自己的简单工具）来转储线程/堆栈/随手可得的可变信息。

在任何情况下，添加所有这些额外信息都是一个很大的开销。

编辑：我在我的提要中得到了这个项目的消息：[NTrace](http://www.codeplex.com/NTrace)。看起来它更适合您尝试做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-06T12:31:24.900

使用[Adplus](http://support.microsoft.com/default.aspx/kb/286350)。它将在进程中附加一个调试器，并在第一次出现异常时生成（默认情况下）一个小型小型转储。Adplus 生成的日志文件也将包含异常信息。只要确保您有 PDB 可以查看完整的 calstack 信息。

# xml - 编辑 .plist 文件 - 是否允许将单引号用作字符串？

> ID：256554
> 
> 赞同：7
> 
> 时间：2008-11-02T05:26:36.023
> 
> 标签：xml, macos, plist, cssedit

特别是，我正在为 CSSEdit 编辑 AutoCompletion.plist 文件（如果这很重要的话）。

我的问题是，是否有任何带有 STRING 元素的字符需要转义？空间？引号？

编辑：为了清楚起见，我没有使用 CSSEdit 来编辑文件——而是该文件是 CSSEdit 包的一部分。我正在使用 TextMate 来编辑文件（尽管“Property List Editor.app”是另一个选项）并且它是 XML 格式的。这是 AutoCompletion.plist 文件中的一个片段：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
<key>font-family</key>
<array>
    <string>Arial</string>
    <string>Helvetica</string>
    <string>Georgia</string>
    <string>serif</string>
    <string>sans-serif</string>
    <string>cursive</string>
    etc... 
```

我想添加带有空格和单引号的字符串，例如：

```
<string>Georgia, Times, 'Times New Roman', serif</string> 
```

但是当我这样编辑文件时，CSSEdit 变得混乱

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-02T18:16:49.480

如果您正在使用某种文本编辑器编辑 XML plist，则需要像在任何 XML 中一样转义字符。需要注意的基本字符是：

<（小于），转义为 <

>（大于），转义为 >

&（与号），转义为 &

'（撇号），转义为'

"（引号），转义为 "

所以在你的例子中，你会想要

`<string>Georgia, Times, &apos;Times New Roman&apos;, serif</string>`

您还可以使用 Apple 的 Property List Editor 等工具，该工具包含在他们的免费[Xcode 开发人员工具](http://developer.apple.com/technology/tools.html)中，或第三方产品（如[PlistEdit Pro](http://www.fatcatsoftware.com/plisteditpro)），它们都会为您处理所有字符转义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T18:36:03.543

您可以使用`plutil`来检查您的 plist 的语法。（请注意，这不会验证应用程序是否会理解您对其 plist 所做的事情......）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T06:05:50.500

有 3 种类型的 plist，转义规则取决于您使用的类型。最常见的形式是 XML plist，它确实需要对某些内容进行转义。通常，您可以在字符串元素中使用 XML 转义规则。如果您正在使用较旧的 NextStep 样式 plist，我相信需要转义的内容要少得多，但我需要查看详细信息以确定规则是什么。第三种是二进制的，我很确定你没有用 CSSEdit 编辑它们。

# iphone - 如何更改 UIPickerView 的文本大小和组件宽度？

> ID：256556
> 
> 赞同：16
> 
> 时间：2008-11-02T05:26:44.667
> 
> 标签：iphone, cocoa-touch

我有以下代码来创建 UIPickerView：

```
pickerView = [[UIPickerView alloc] initWithFrame:CGRectMake(0.0f, 416.0f - height, 320.0f, height)];
pickerView.delegate = self;
pickerView.showsSelectionIndicator = YES;
[pickerView setSoundsEnabled:YES]; 
```

我想更改组件宽度并更改每个组件中的文本大小。是否有可能做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-11-02T06:24:53.287

您可以通过适当的委托方法更改宽度

```
- (CGFloat)pickerView:(UIPickerView *)pickerView widthForComponent:(NSInteger)component {
    switch(component) {
        case 0: return 22;
        case 1: return 44;
        case 2: return 88;
        default: return 22;
    }

    //NOT REACHED
    return 22;
} 
```

至于自定义文本大小，您可以使用委托返回自定义视图，其中包含您想要的任何大小的文本：

```
- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view {
        UILabel *retval = (id)view;
        if (!retval) {
            retval= [[[UILabel alloc] initWithFrame:CGRectMake(0.0f, 0.0f, [pickerView rowSizeForComponent:component].width, [pickerView rowSizeForComponent:component].height)] autorelease];
        }

        retval.text = @"Demo";
        retval.font = [UIFont systemFontOfSize:22];
        return retval;
} 
```

当然，您需要修改这些以使您的应用程序具有适当的值，但它应该可以让您到达您需要去的地方。

# c++ - 接近 STL 算法、lambda、局部类和其他方法

> ID：256557
> 
> 赞同：2
> 
> 时间：2008-11-02T05:29:20.293
> 
> 标签：c++, stl, lambda

使用 STL 似乎需要的一件事是指定本地函数的方法。我通常提供的许多函数无法使用 STL 函数对象创建工具（例如 bind）创建，我必须手动滚动我的函数对象。

由于 C++ 标准禁止将本地类型用作模板实例化中的参数，因此我能够使用的最好方法是创建一个小型库，（仅显示相关部分）

```
// library header
class MyFunctionBase<R,T>  
{  
 public:  
   virtual ~MyFunctionBase();  
   virtual R operator()(const T &) const=0;  
};    

class  MyFunction<R,T> 
{   
    MyFunctionBase<R,T> *b; 
 public: 
    ~MyFunction()
    {
       delete b;
    }
    virtual R operator()(const T &) const
    {
        return (*b)(T);
    } 
};

// source file
....

    class func: public MyFunctionBase  ...
    std::stl_alg(....    MyFunction(new funct)); 
```

这在我看来一直很笨拙。我想 ISO 委员会的人也这么认为，并在 C++ 中添加了一个 lambda。

与此同时，编译器是如何解决这个问题的？（尤其是 Windows 编译器。）

一个可能会澄清一点的更正。变更日志：11 月 2 日被替换以澄清由于 C++ 标准禁止将本地类作为函数对象

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T05:41:27.897

标准方式是一个“函子”——基本上，`struct`提供一个`operator()`

例如：

```
struct MyMinFunctor {
  bool operator()(const int& a, const int& b) { return a > b; }
};

vector<int> v;
sort(v.begin(), v.end(), MyMinFunctor()); 
```

因为它是一个结构/类，你可以继承任何东西，比如“binary_operator”，也可以为更高级的仿函数维护状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T20:18:30.717

使用 C++0x，您可以使用 lambda（如您所述）：

```
for_each(container.begin(), container.end(),
  [](auto item) {
    // do something with item
  }
  ); 
```

这已在 MS Visual C++ 2010（目前处于社区技术预览版）和 GCC 4.3.x（带有 -std=c++0x 编译器标志）中可用。但是，如果没有 lambda，您只需要提供一个类型：

1.  默认可构造
2.  可复制构造
3.  定义函数运算符重载

有些算法需要二元函数对象，而有些算法需要一元函数对象。请参阅供应商的 STL 文档以准确了解哪些算法需要二进制函数对象，哪些算法需要一元函数对象。

您可能还想研究的一件事是TR1 的更新实现（基于 Boost.Bind 和 Boost.Function）`bind`。`function`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T20:35:49.137

Boost.Bind、Boost.Function 和 Boost.Lambda 是您的朋友。

# cross-platform - 每个平台上的“数据目录”概念

> ID：256561
> 
> 赞同：0
> 
> 时间：2008-11-02T05:32:08.743
> 
> 标签：cross-platform

[这与跨平台应用程序应该将数据保存在哪里](https://stackoverflow.com/questions/57019/where-should-cross-platform-apps-keep-their-data "跨平台应用程序应该将数据保存在哪里？")非常相似？，但稍微扩展一下。

关于数据的父目录应该在哪里有一些很好的建议，但对于给定应用程序的目录应该是*什么*却没有太多建议。

例如，假设我们在 My Brand 中有一个由 My Corp 编写的跨平台应用程序，名为 My App。假设 My Brand 中的其他产品可能需要自己的数据，My Corp 中的其他品牌也是如此。它的数据和/或配置在 Windows 上应该放在哪里？在 Unix 上？Mac OS9？Mac OS X？其他？

例如，在 Windows 上，数据会进入“...\Application Data\My Corp\My Brand\My App”，而在 Mac OS X 上，数据会进入 ~/Library/Application Support/My Corp/My Brand /My App”，在 Unix 上它会进入“~/.mycorp/mybrand/myapp”？（我想其他平台会使用 unix 的修改，即使基本目录可能不同。）

如果没有真正的约定，这似乎合理吗？对 Mac OS9 有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T09:49:27.397

只是开始反思：

您必须明确区分：

*   应用*状态*数据
*   设置
*   数据（对于多个应用程序可能是通用的）

后者最终可能在数据库中，或者可以由一个或多个应用程序管理，或者由通信总线封装，以避免所有其他应用程序在它们之间进行对话以访问这些数据。

代表应用程序状态的数据可以放在“应用程序数据”中，如问题“[跨平台应用程序将数据保存在哪里？](https://stackoverflow.com/questions/57019/where-should-cross-platform-apps-keep-their-data) ”中所述。

但是设置...这取决于您的应用程序是否需要使用多个“配置”启动：

*   每个平台一个：如果您必须在开发阶段管理它们，并在发布阶段打包该文件，以便将其存储在“应用程序数据”中
*   **一个平台有**很多*，比如不同的堆大小，或者不同的设置代表你的同一个应用程序要执行的不同操作。这导致设置文件的爆炸式增长（也存储在“应用程序数据”的各种子目录中）
    这就是将这些数据抽象到[设置提供程序](https://stackoverflow.com/questions/57019/where-should-cross-platform-apps-keep-their-data#57146)中的想法是一个好主意。*

 *实际上，我们的设置有很多不同的配置，我们将它们存储到单独生产机器上的数据库中。这样所有的应用程序都可以访问它们，但更重要的是，*我们*可以实时访问和更改它们，而不必为每次修改停止/重新启动应用程序，或者不必去每个部署平台。

# python - 将 pyCurl XML 服务器响应放入变量中（Python）

> ID：256564
> 
> 赞同：3
> 
> 时间：2008-11-02T05:38:48.870
> 
> 标签：python, xml, pycurl

我是 Python 新手，正在尝试使用 pyCurl。我正在进行的项目是为 twitpic.com API ( [http://twitpic.com/api.do](http://twitpic.com/api.do) ) 创建一个 Python 包装器。出于参考目的，请查看代码 ( [http://pastebin.com/f4c498b6e](http://pastebin.com/f4c498b6e) ) 和我收到的错误 ( [http://pastebin.com/mff11d31](http://pastebin.com/mff11d31) )。

请特别注意代码的第 27 行，其中包含“xml = server.perform()”。在研究了我的问题后，我发现与我之前的想法不同，当上传成功时，.perform() 不会返回来自 twitpic.com 的 xml 响应，而是 None （呃！）。

在进一步查看错误输出之后，在我看来，我想填充到“xml”变量中的 xml 输入被打印到以太标准输出或标准错误（不确定是哪个）。我确信有一种简单的方法可以做到这一点，但我目前似乎无法想到它。如果您有任何提示可以为我指明正确的方向，我将不胜感激。提前致谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-02-28T14:42:24.433

使用 StringIO 会更干净，如果你想要的只是响应数据，那么使用这样的虚拟类毫无意义......

这样的事情就足够了：

```
import pycurl
import cStringIO

response = cStringIO.StringIO()

c = pycurl.Curl()
c.setopt(c.URL, 'http://www.turnkeylinux.org')
c.setopt(c.WRITEFUNCTION, response.write)
c.perform()
c.close()

print response.getvalue() 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-02T06:35:34.433

[pycurl 文档](http://pycurl.sourceforge.net/doc/curlobject.html)明确表示：

> 执行（）-> 无

所以预期的结果就是你观察到的。

查看 pycurl 站点的示例：

```
import sys
import pycurl

class Test:
   def __init__(self):
       self.contents = ''

   def body_callback(self, buf):
       self.contents = self.contents + buf

print >>sys.stderr, 'Testing', pycurl.version

t = Test()
c = pycurl.Curl()
c.setopt(c.URL, 'http://curl.haxx.se/dev/')
c.setopt(c.WRITEFUNCTION, t.body_callback)
c.perform()
c.close()

print t.contents 
```

该接口需要一个类实例——`Test()`带有一个特定的回调来保存内容。请注意调用`c.setopt(c.WRITEFUNCTION, t.body_callback)`- 您的代码中缺少类似的内容，因此您不会收到任何数据（`buf`在示例中）。该示例显示了如何访问内容：

```
print t.contents 
```

# c# - 类限制和原型

> ID：256566
> 
> 赞同：0
> 
> 时间：2008-11-02T05:41:03.173
> 
> 标签：c#

我正在尝试在 C# 中创建一个函数，它允许我在调用时返回对给定类类型的引用。我见过的唯一类型的函数是在 UnrealScript 中，即使这样，功能也被硬编码到它的编译器中。我想知道我是否可以在 C# 中做到这一点。这就是我的意思（来自 UnrealScript 源的代码片段）：

```
native(278) final function actor Spawn
(
    class<actor>      SpawnClass,
    optional actor    SpawnOwner,
    optional name     SpawnTag,
    optional vector   SpawnLocation,
    optional rotator  SpawnRotation
); 
```

现在在 UScript 中你会这样称呼它......

```
local ActorChild myChildRef; //Ref to ActorChild which Extends 'actor'
myChildRef = Spawn(class'ActorChild' ...);  //rest of parameters taken out
myChildRef.ChildMethod();  //method call to method existing inside class 'ActorChild' 
```

这将返回对“ActorChild”类对象的引用并将其设置为变量“myChildRef”。我需要在 C# 中做类似的事情。

我已经研究过泛型，但似乎要使用它们，我需要创建我的函数所在的类的实例并将“泛型”参数传递给它。但是，这并不是很理想，因为我不需要对某些类使用“Spawn”函数，但是每当我使用它时，我仍然需要将泛型参数添加到该类中。

我想一个简化的问题是，我怎样才能返回一个我在编译时不知道的类型，以及不同的类可能太多而无法捕获。

伪代码（坚持UScript类名，即Actor）：

```
//Function Sig
public class<Actor> Create(class<Actor> CreatedClass)
{
    return new CreatedClass;
}

//Function call
ActorChild myChild = Create(class'ActorChild'); 
```

有任何想法吗？

编辑：我想避免从调用 Created 的类中发生的显式类型转换。如果我可以在 Created 方法中对所需对象进行类型转换并返回“未知类型”，无论它是什么，我都会非常高兴。

编辑2：感谢您的回答。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T07:53:14.637

*与其使用泛型类*，不如使用泛型*方法*：

```
public T Spawn<T>() where T : new()
{
    return new T();
} 
```

话虽如此，我假设你想做的不仅仅是盲目地创建一个实例，否则你可以打电话给`new MyClass()`自己。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T06:06:25.180

您可以使用类 System.Type 来表示类。要获取对类型对象的引用，您可以使用 typeof （在实际定义类的范围内）

```
System.Type t = typeof(ActorChild); 
```

或 Type.GetType 函数（如果您只知道类型的名称）

```
System.Type t = Type.GetType("NamespaceFoo.ActorChild"); 
```

然后，您可以使用反射 API 创建实例

```
public object Create(System.Type ClassToCreate)
{
    return ClassToCreate.GetConstructor(Type.EmptyTypes).Invoke(null);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T07:48:08.360

使用反射和称为动态方法调用的东西可以很容易地完成您要完成的工作。

基本上，您将使用 Type 对象、Activator.CreateInstance 方法和其他一些不错的类，如 MethodInfo 和 ParameterInfo。

这是一个帮助您入门的示例：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;

namespace Reflection
{
    class SomeClass
    {
        private string StringPrimer = "The parameter text is: ";
        public SomeClass(string text)
        {
             Console.WriteLine(StringPrimer + text);
        }
        public string getPrimer() //supplies the Primer in upper case, just for kicks
        {
            return StringPrimer.ToUpper();
        }
    }
    class Program
    {
        static void Main(string[] args)
        {
            SomeClass s = new SomeClass("this is an example of the classes normal hard-coded function.\nNow try feeding in some text");
            string t = Console.ReadLine();

            Console.WriteLine("Now feed in the class name (SomeClass in this case)");
            Type myType = Type.GetType("Reflection."+Console.ReadLine()); //Stores info about the class.
            object myClass = Activator.CreateInstance(myType, new object[] { t }); //This dynamically calls SomeClass and sends in the text you enter as a parameter

            //Now lets get the string primer, using the getPrimer function, dynamically
            string primer = (string)myType.InvokeMember("getPrimer",
                                                        BindingFlags.InvokeMethod | BindingFlags.Default,
                                                        null,
                                                        myClass,
                                                        null); //This method takes the name of the method, some Binding flags,
                                                              //a binder object that I left null,
                                                              //the object that the method will be called from (would have been null if the method was static)
                                                              //and an object array of parameters, just like in the CreateInstance method.
            Console.WriteLine(primer);
        }
    }
} 
```

# apache - 无法通过 xampp 在 XP 上重新安装 apache 2.2 服务

> ID：256575
> 
> 赞同：0
> 
> 时间：2008-11-02T05:48:57.057
> 
> 标签：apache, xampp

我正在尝试使用 xampp。在遇到一些空间问题后，我想将我的 xampp 安装移动到另一个驱动器 (d:)。但是我在 XP 服务中有 apache 2.2 服务，它们仍然指向我原来的 c: install。我只看到如何开始和停止。我希望仅删除该服务就能解决我的问题。

所以问题是两部分 1）我如何删除服务 2）基于此信息我可以简单地重新安装以使服务运行吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T08:03:17.893

在命令提示符下执行：

sc 删除**服务**

其中**服务**是 Apache 和 mysql。

然后进入您的 xampp 控制面板并检查小 svc 框。这将使他们再次服务。

请务必在 xampp 服务器的根目录中运行“setup_xampp.bat”脚本！每次服务器更改目录时都必须执行此操作（如果您将服务器放在 USB 驱动器上，此功能很有用）。

祝你好运 ：）

# sql - 为什么在 Microsoft SQL Server 中使用“Y”/“N”而不是位域？

> ID：256579
> 
> 赞同：13
> 
> 时间：2008-11-02T05:56:33.827
> 
> 标签：sql, sql-server, boolean

我正在开发由另一个暴民开发的应用程序，并且对数据库中所有布尔列使用 char 字段而不是 bit 感到困惑。它使用“Y”表示真，“N”表示假（这些必须是大写）。然后类型名称本身会使用一些晦涩的名称（例如*ybln* ）作为别名。

由于很多原因，使用它非常烦人，其中最重要的是它看起来完全不美观。

但也许是我太愚蠢了——为什么有人会这样做？是数据库兼容性问题还是我不​​知道的一些设计模式？

任何人都可以启发我吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-02T05:59:49.047

我经常在旧的数据库模式中看到这种做法。我看到的一个优点是使用 CHAR(1) 字段提供的支持不止是 Y/N 选项，例如“是”、“否”、“也许”。

其他海报提到可能使用了 Oracle。我提到的架构实际上部署在 Oracle 和 SQL Server 上。它将数据类型的使用限制为两个平台上可用的公共子集。

它们在 Oracle 和 SQL Server 之间的一些地方确实存在分歧，但在大多数情况下，它们在数据库之间使用通用模式，以最大限度地减少支持这两个数据库所需的开发工作。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-02T06:01:09.077

欢迎来到棕地。您继承了由老学生设计的应用程序。它不是一种设计模式（至少不是一种有好处的设计模式），它是编码人员在数据类型有限的数据库上的残余。没有重构数据库和大量代码，咬紧牙关，通过它（并注意你的案例）！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-02T06:01:11.320

其他平台（例如 Oracle）没有一点 SQL 类型。在这种情况下，可以在 NUMBER(1) 和单个字符字段之间进行选择。也许他们从不同的平台开始，或者想要跨平台兼容性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T08:09:28.160

我也不喜欢 Y/N char(1) 字段作为位列的替代品，但是表中的位字段有一个主要缺点：您**不能为位列创建索引**或将其包含在复合索引中（至少在 SQL Server 2000 中不包含）。

当然，您可以讨论是否需要这样的索引。[请在 SQL Server 论坛上](http://sqlserver2000.databases.aspfaq.com/can-i-create-an-index-on-a-bit-column.html)查看此请求。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T12:30:31.597

原因如下（顺便说一句，它们不是很好的理由）：

1) Y/N 可以很快变成“X”（表示未知）、“L”（表示可能）等 - 我的意思是我亲自与那些习惯于无法正确收集需求的程序员一起工作他们只是从 Y/N 作为一种“标志”开始，迷信它可能需要扩展（他们应该使用 int 作为状态 ID）。

2）“性能”——但如上所述，如果 SQL 索引不够“选择性”，则排除它们......只有 2 个可能值的字段将永远不会使用该索引。

3) 懒惰。- 有时开发人员希望直接输出到带有字母“Y”或“N”的可视化显示器以供人类阅读，他们不想自己转换:)

我以前听过/看过的所有 3 个不好的原因。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-02T12:34:35.317

我无法想象无法索引“BIT”列的任何缺点，因为它不太可能有足够的不同值来帮助执行查询。

我还想象在大多数情况下，BIT 和 CHAR(1) 之间的存储差异可以忽略不计（CHAR 是 NCHAR 吗？它存储 16 位、24 位还是 32 位 unicode 字符？我们真的在乎吗？）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T14:13:03.700

他们可能已经开始使用 Microsoft SQl 6.5 进行开发

那时，在现有的数据表中添加一个位字段是一件非常痛苦的事情。位字段不能为空，因此向现有表添加一个的唯一方法是创建一个临时表，其中包含目标表的所有现有字段加上位字段，然后将数据复制过来，填充位字段具有默认值。然后您必须删除原始表并将临时表重命名为原始名称。加上一些外键关系，你就有了一个很长的脚本要写。

话虽如此，总有 3rd 方工具可以帮助完成这个过程。如果之前的开发者选择使用 char 字段代替 bit 字段，简单地说，原因可能是懒惰。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-03T16:29:57.260

这在大型机文件、COBOL 等中非常常见。

如果表中只有一个这样的列，那么在实践中并没有那么糟糕（没有真正的位浪费）；毕竟SQL Server不会让你说自然的`WHERE BooleanColumn`，你要说的`WHERE BitColumn = 1`，而`IF @BitFlag = 1`不是自然的`IF @BooleanFlag`。当您有多个位列时，SQL Server 会将它们打包。如果使用区分大小写的排序规则，则 Y/N 的大小写应该是一个问题，并且要停止无效数据，总是有一个约束选项。

说了这么多，我个人的偏好是位，只有`NULL`在仔细考虑后才允许。

显然，位列[在 MySQL 中不是一个好主意](http://www.xaprb.com/blog/2006/04/11/bit-values-in-mysql/)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-02T06:04:02.143

他们可能习惯于使用 Oracle，并且没有正确阅读 SQL Server 的可用数据类型。我自己也正是这种情况（Y/N 字段让我抓狂）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-02T23:23:34.510

我见过更糟糕的...

我有机会使用的一个 O/R 映射器使用了“真”和“假”，因为它们可以干净地转换为 Java 布尔值。

此外，在数据仓库等报告数据库上，数据库是用户界面（尽管有基于元数据的报告工具）。您可能希望做这种事情来帮助人们开发报告。此外，星型模式上的索引交集操作仍将使用具有两个值的索引。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-05T01:28:50.997

有时，此类怪癖与应用程序的相关性比与数据库的相关性更高。例如，处理 PHP 和 MySQL 之间的布尔值有点偶然，并且会导致代码不直观。使用 CHAR(1) 字段和 'Y' 和 'N' 使得代码更易于维护。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-05T01:43:52.120

反正我也没有什么强烈的感觉。我看不出以一种方式比另一种方式有什么好处。我从哲学上知道位域更适合存储。我的现实是，我很少有数据库在一条记录中包含大量逻辑字段。如果我有很多，那么我肯定会想要位字段。如果你只有几个，我认为这并不重要。我目前使用 Oracle 和 SQL 服务器数据库，我从 Cullinet 的 IDMS 数据库 (1980) 开始，我们将各种数据打包成记录并担心位和字节。虽然我仍然担心数据的大小，但我很久以前就不再担心一些位了。

# linq - 更改语言时如何评估利弊

> ID：256622
> 
> 赞同：3
> 
> 时间：2008-11-02T07:22:51.250
> 
> 标签：linq, ms-solver-foundation

我在一家开发计算内核的公司工作。他们的设计很简单：它是一个 c++ 库，只有一个函数可用于从可用数据中计算结果。

这些内核中的每一个基本上都有四个步骤：

*   检索 xml 内容（格式已在 XSD 文件中定义）并存储到对象中

*   使用上述对象定义一个数学问题

*   使用求解器找到解决方案（或最优解决方案）

*   将结果导出到新的 xml 文件中

目前，我们的资源在能力和兴趣方面非常面向模型（而不是在编程方面）。显然，我们希望使环境尽可能友好和高效。[我们正在使用 LinQ 和Microsoft Solver Foundation](http://code.msdn.microsoft.com/solverfoundation)评估 c# 的使用，以替代 c++ 和自制工具。

我的问题是：

*   LinQ 和 Solver Foundation 能做到这一切吗？使用起来有多容易？

*   改变环境对我们的资源（学习和重写的时间、效率等）的收益/损失是什么？

*   我应该考虑其他有趣的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T12:23:12.503

切换到 C#/LINQ 在处理 XML 甚至大量数学运算方面，您将获得巨大的好处。会有一个轻微的学习曲线（所以这是一个骗局），但在短短几周内，我相信你会嘲笑编码 C#3/LINQ 是多么容易。

我是根据经验说的……我特别提到了“C#3”（而不仅仅是 C#），因为当我说服我的 C#2 同事迁移到 3/LINQ 时，他们经历了上述情况:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T07:53:39.083

我说任何 C++ 应用程序开发人员都应该好好看看 C#。在我看来，您在 C++ 中解决的许多问题可以在 C# 中更快地解决。从 C++ 学习它根本不是一门难学的语言。我会说，在你决定之前，先看看 C# 一周左右，看看你有多*喜欢*它。

祝你好运 ：）

# c# - 什么时候使用闭包？

> ID：256625
> 
> 赞同：39
> 
> 时间：2008-11-02T07:27:37.433
> 
> 标签：c#, functional-programming, closures

我已经看到了关闭样本 -[什么是“关闭”？](https://stackoverflow.com/questions/36636/what-is-a-closure)

谁能提供何时使用闭包的简单示例？

**具体来说，在哪些情况下关闭是有意义的？**

让我们假设该语言没有闭包支持，如何仍然实现类似的事情？

为了不冒犯任何人，请以 c#、python、javascript、ruby 等语言发布代码示例。
对不起，我还不懂函数式语言。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-02T08:34:44.617

闭包简直就是很棒的工具。什么时候使用它们？任何时候你喜欢......正如已经说过的那样，另一种选择是编写一个类；例如，在 C# 2.0 之前，创建参数化线程是一场真正的斗争。使用 C# 2.0，您甚至不需要 `ParameterizedThreadStart'，只需执行以下操作：

```
string name = // blah
int value = // blah
new Thread((ThreadStart)delegate { DoWork(name, value);}); // or inline if short 
```

将其与创建具有名称和值的类进行比较

或者同样搜索列表（这次使用 lambda）：

```
Person person = list.Find(x=>x.Age > minAge && x.Region == region); 
```

再次 - 另一种方法是编写一个具有两个属性和一个方法的类：

```
internal sealed class PersonFinder
{
    public PersonFinder(int minAge, string region)
    {
        this.minAge = minAge;
        this.region = region;
    }
    private readonly int minAge;
    private readonly string region;
    public bool IsMatch(Person person)
    {
        return person.Age > minAge && person.Region == region;
    }
}
...
Person person = list.Find(new PersonFinder(minAge,region).IsMatch); 
```

这与编译器在引擎盖下的执行方式*相当*（实际上，它使用公共读/写字段，而不是私有只读字段）。

C# 捕获的最大警告是观察范围；例如：

```
 for(int i = 0 ; i < 10 ; i++) {
            ThreadPool.QueueUserWorkItem(delegate
            {
                Console.WriteLine(i);
            });
        } 
```

这可能不会打印您期望的结果，因为*变量*i 用于每个变量。你可以看到任何重复的组合——甚至是 10 个 10。您需要仔细确定 C# 中捕获的变量的范围：

```
 for(int i = 0 ; i < 10 ; i++) {
            int j = i;
            ThreadPool.QueueUserWorkItem(delegate
            {
                Console.WriteLine(j);
            });
        } 
```

这里每个 j 都被单独捕获（即不同的编译器生成的类实例）。

Jon Skeet 有一篇很好的博客文章，涵盖了 C# 和 java 闭包[。](http://msmvps.com/blogs/jon_skeet/archive/2008/05/06/the-beauty-of-closures.aspx)或者有关更多详细信息，请参阅他的书[C# in Depth](http://www.manning.com/skeet/)，其中有一整章介绍了它们。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-02T08:03:28.563

我同意之前“一直”的回答。当您使用函数式语言或任何常见 lambda 和闭包的语言进行编程时，您甚至会在没有注意到的情况下使用它们。这就像问“函数的场景是什么？” 或“循环的场景是什么？” 这并不是要使最初的问题听起来很愚蠢，而是要指出语言中存在您没有根据特定场景定义的结构。您只是一直使用它们，对于所有事情，这是第二天性。

这在某种程度上让人想起：

> 尊贵的 Qc Na 大师与他的学生 Anton 同行。安东希望能引起大师的讨论，道：“大师，我听说物件是一个很好的东西，这是真的吗？” Qc Na 怜悯地看着他的学生，回答说：“愚蠢的学生 - 对象只是一个穷人的闭包。”
> 
> 受到责备后，安东离开了他的主人，回到了他的牢房，一心研究闭包。他仔细阅读了整个“Lambda: The Ultimate...”系列论文及其表亲，并实现了一个带有基于闭包的对象系统的小型 Scheme 解释器。他学到了很多，并期待着向他的主人通报他的进步。
> 
> 在与 Qc Na 的下一次散步中，Anton 试图打动他的师父，他说：“师父，我已经认真研究了这件事，现在明白了物体确实是穷人的闭包。” Qc Na 用棍子击打 Anton 回应说：“你什么时候才能学会？闭包是穷人的对象。” 那一刻，安东顿悟了。

（[http://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03277.html](http://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03277.html)）

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-02T08:29:26.640

使用闭包的最简单的例子是所谓的柯里化。基本上，假设我们有一个函数`f()`，当使用两个参数`a`和调用时`b`，将它们加在一起。因此，在 Python 中，我们有：

```
def f(a, b):
    return a + b 
```

但是，假设为了争论，我们一次只想调用`f()`一个参数。所以，`f(2, 3)`我们想要的是 ，而不是`f(2)(3)`。这可以这样做：

```
def f(a):
    def g(b): # Function-within-a-function
        return a + b # The value of a is present in the scope of g()
    return g # f() returns a one-argument function g() 
```

现在，当我们调用 时`f(2)`，我们得到一个新函数，`g()`; 这个新函数带有 的*范围内*的变量，因此`f()`据说它*关闭了*这些变量，因此称为闭包。当我们调用`g(3)`时，变量`a`（由 的定义绑定`f`）被 访问`g()`，返回`2 + 3 => 5`

这在几种情况下很有用。例如，如果我有一个接受大量参数的函数，但其​​中只有少数对我有用，我可以编写一个通用函数，如下所示：

```
def many_arguments(a, b, c, d, e, f, g, h, i):
    return # SOMETHING

def curry(function, **curry_args):
    # call is a closure which closes over the environment of curry.
    def call(*call_args):
        # Call the function with both the curry args and the call args, returning
        # the result.
        return function(*call_args, **curry_args)
    # Return the closure.
    return call

useful_function = curry(many_arguments, a=1, b=2, c=3, d=4, e=5, f=6) 
```

`useful_function`现在是一个只需要 3 个参数而不是 9 个参数的函数。我避免重复自己，并且还创建了一个*通用*解决方案；如果我编写另一个多参数函数，我可以`curry`再次使用该工具。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-02T07:39:45.367

通常，如果没有闭包，则必须定义一个类来携带与闭包环境等效的类，并将其传递。

例如，在像 Lisp 这样的语言中，可以定义一个函数，该函数返回一个函数（具有封闭环境），从而向其参数添加一些预定义的数量：

```
(defun make-adder (how-much)
  (lambda (x)
    (+ x how-much))) 
```

并像这样使用它：

```
cl-user(2): (make-adder 5)
#<Interpreted Closure (:internal make-adder) @ #x10009ef272>
cl-user(3): (funcall * 3)     ; calls the function you just made with the argument '3'.
8 
```

在没有闭包的语言中，你会做这样的事情：

```
public class Adder {
  private int howMuch;

  public Adder(int h) {
    howMuch = h;
  }

  public int doAdd(int x) {
    return x + howMuch;
  }
} 
```

然后像这样使用它：

```
Adder addFive = new Adder(5);
int addedFive = addFive.doAdd(3);
// addedFive is now 8. 
```

闭包隐含地携带着它的环境；您可以从执行部分（lambda）内部无缝地引用该环境。如果没有闭包，您必须明确该环境。

这应该向您解释何时使用闭包：*一直*。大多数实例化一个类以携带来自计算的另一部分的一些状态并将其应用到其他地方，这些实例被支持它们的语言中的闭包优雅地取代。

可以使用闭包实现对象系统。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-02T09:02:53.483

这是 Python 标准库 inspect.py 中的一个示例。它目前读取

```
def strseq(object, convert, join=joinseq):
    """Recursively walk a sequence, stringifying each element."""
    if type(object) in (list, tuple):
        return join(map(lambda o, c=convert, j=join: strseq(o, c, j), object))
    else:
        return convert(object) 
```

这具有作为参数的转换函数和连接函数，并递归遍历列表和元组。递归是使用 map() 实现的，其中第一个参数是一个函数。该代码早于 Python 中对闭包的支持，因此需要两个额外的默认参数，以将 convert 和 join 传递到递归调用中。使用闭包，这读取

```
def strseq(object, convert, join=joinseq):
    """Recursively walk a sequence, stringifying each element."""
    if type(object) in (list, tuple):
        return join(map(lambda o: strseq(o, convert, join), object))
    else:
        return convert(object) 
```

在 OO 语言中，您通常不会经常使用闭包，因为当您的语言有对象时，您可以使用对象来传递状态和绑定方法。当 Python 没有闭包时，人们说 Python 用对象模拟闭包，而 Lisp 用闭包模拟对象。作为 IDLE (ClassBrowser.py) 的示例：

```
class ClassBrowser: # shortened
    def close(self, event=None):
        self.top.destroy()
        self.node.destroy()
    def init(self, flist):
        top.bind("<Escape>", self.close) 
```

这里，self.close 是按下 Escape 时调用的无参数回调。然而，close 实现确实需要参数——即 self，然后是 self.top，self.node。如果 Python 没有绑定方法，您可以编写

```
class ClassBrowser:
    def close(self, event=None):
        self.top.destroy()
        self.node.destroy()
    def init(self, flist):
        top.bind("<Escape>", lambda:self.close()) 
```

在这里，lambda 不是从参数中获取“self”，而是从上下文中获取。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-02T07:58:52.677

在 Lua 和 Python 中，“只是编码”是一件很自然的事情，因为当你引用不是参数的东西时，你正在做一个闭包。（因此，其中大多数作为示例将非常乏味。）

至于具体情况，想象一个撤消/重做系统，其中步骤是成对的 (undo(), redo()) 闭包。更麻烦的做法可能是：(a) 使不可重做的类有一个带有普遍愚蠢参数的特殊方法，或者 (b) 无数次子类 UnReDoOperation。

另一个具体的例子是无限列表：不是使用泛型容器，而是使用检索下一个元素的函数。（这是迭代器功能的一部分。）在这种情况下，您可以只保留一点点状态（下一个整数，用于所有非负整数列表或类似的）或对位置的引用实际容器。无论哪种方式，它都是一个引用自身外部事物的函数。（在无限列表的情况下，状态变量必须是闭包变量，否则每次调用它们都是干净的）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-24T18:25:44.383

有人告诉我，haskell 有更多用途，但我只有在 javascript 中使用闭包的乐趣，而在 javascript 中我不太明白这一点。我的第一直觉是尖叫“哦，不，不要再”了，实施必须是多么混乱才能使闭包起作用。在我阅读了闭包是如何实现的（无论如何都是在 javascript 中）之后，现在对我来说似乎并没有那么糟糕，而且至少对我来说，实现似乎有些优雅。

但从中我意识到“关闭”并不是描述这个概念的最佳词。我认为最好将其命名为“飞行范围”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-10-23T18:56:44.780

正如之前的答案之一，您经常发现自己在使用它们时几乎没有注意到自己在使用它们。

一个典型的例子是，它们非常常用于设置 UI 事件处理以获得代码重用，同时仍允许访问 UI 上下文。下面是一个示例，说明如何为 click 事件定义匿名处理函数来创建包含函数的`button`和`color`参数的闭包`setColor()`：

```
function setColor(button, color) {

        button.addEventListener("click", function()
        {
            button.style.backgroundColor = color;
        }, false);
}

window.onload = function() {
        setColor(document.getElementById("StartButton"), "green");
        setColor(document.getElementById("StopButton"), "red");
} 
```

注意：为了准确起见，值得注意的是，在`setColor()`函数退出之前，实际上并没有创建闭包。

# javascript - How can I set up a callback to run *before* a jquery animation?

> ID：256628
> 
> 赞同：1
> 
> 时间：2008-11-02T07:37:50.550
> 
> 标签：javascript, jquery, user-interface, animation

I'm trying to set up a loop where an animation runs a certain number of times, and a function is run before each iteration of the animation. The timing ends up being off, though -- it runs the callback n times, then runs the animation n times. For example:

```
for (var i=0;i<3;i++) {
  console.log(i);
  $('#blerg').animate({top:'+=50px'},75,'linear', function(){log('animated')});
} 
```

outputs

```
0
1
2
animated
animated
animated 
```

I ran into this problem with scriptaculous before I switched to jquery, and discovered a "beforeSetup" animation callback. Is there a jquery equivalent?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T08:00:21.597

The animation is asynchronous. So the loops runs through pretty quickly, starting off three animations and outputting 1, 2 and 3\. After a while the animations complete and output animated x 3\. That would explain your output.

How about some recursion?

```
do_animation(max_runs, total_runs) {
   log();
   if (total_runs < max_runs) {
       $(foo).animate(..., do_animation(max_runs, ++total_runs));
    }
} 
```

do_animation(3, 0);

Give that a try and let me know how it runs.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T09:07:48.933

You could also try utilising the Queue function.

[http://docs.jquery.com/Effects/queue#callback](http://docs.jquery.com/Effects/queue#callback)

Internally I recall animate uses the same execution queue, so this should work in theory ( untested ).

```
/* Safe Namespace + Onload : I do this everywhere */
jQuery(function($){ 
 /* Calling this once instead of many times will save 
    a lot of wasted calls to document.getElementById + processing garbage 
  */
 var blerg = $('#blerg');
 var addStep = function( i )
 {
     blerg.queue(function(){ 
        console.log(i);
        $(this).dequeue();
     }); 
     blerg.animate({top:'+=50px'},75,'linear'); 
     /* In theory, this works like the callback does */
     blerg.queue(function(){
       log('animated');
       $(this).dequeue();
     });
 };

 for (var i=0;i<3;i++) 
 {
  /* I call a function here, because that way you don't need to worry 
     about the fact 'i' will reference the last value of 'i' when the code 
     gets around to executing. */
    addStep(i); 
 }
}); 
```

* * *

> Kent, I don't quite understand why you need to explicitly put the callback in the queue. Not that you're wrong -- it doesn't work if the callback is an argument to animate() -- but I'm just curious.

Its not necessary for the second case, but I thought it made for more consistent and somewhat neater code if one was going to endeavor to do more things in the callback phase ( for instance, another animation ).

Then you would just put the next animate call after the second blerg.queue,

Not to mention it has the added benefit of creating a bit of programmatic nicety in that the entire execution sequence is defined before it needs to be run, making the execution largely linear.

So this makes the code still "how you think it works" and makes it still run "how you need it to work" without needing to worry about the whole asynchronicity of it all. ( Which makes for less buggy and more maintainable code )

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T09:42:43.310

Both of those solutions worked like a charm! Thanks, MDCore and Kent!

Kent, I don't quite understand why you need to explicitly put the callback in the queue. Not that you're wrong -- it doesn't work if the callback is an argument to animate() -- but I'm just curious.

# c# - 构建一个简单的解释器

> ID：256629
> 
> 赞同：10
> 
> 时间：2008-11-02T07:38:01.470
> 
> 标签：c#, architecture, compiler-construction, programming-languages

我正在启动一个需要实现轻量级解释器的项目。解释器用于执行简单的科学算法。该解释器将使用的编程语言应该很简单，因为它针对的是非软件开发人员（例如，数学家）。

解释器应该支持基本的编程语言特性：

*   实数、变量、多维数组
*   二进制 (+, -, *, /, %) 和布尔 (==, !=, <, >, <=, >=) 运算
*   循环（for、while）、条件表达式（if）
*   职能

[MathWorks MatLab](http://www.mathworks.com/)是我前进的一个很好的例子，只是简单得多。解释器将用作演示算法的环境；简单的算法，例如查找数据集/数组的平均值，或者稍微复杂的算法，例如[高斯消除](http://en.wikipedia.org/wiki/Gaussian_elimination)或[RSA](http://en.wikipedia.org/wiki/RSA)。

我在该主题上找到的最佳/最实用的资源是 Ron Ayoub 的代码项目条目（[使用解释器模式解析代数表达式](http://www.codeproject.com/KB/architecture/InterpreterPatternParsing.aspx)）——这是我的问题的缩小版本的完美示例。

紫龙书好像太多了，还有什么更实用的？

解释器将使用 C# 实现为 .NET 库。然而，任何平台的资源都是受欢迎的，因为这个问题的设计架构部分是最具挑战性的。

有什么实用资源吗？

（请避免“这不是微不足道的”或“为什么要重新发明轮子”的回答）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-02T07:47:56.503

我会把它写在[ANTLR](http://www.antlr.org/)中。编写语法，让ANTLR生成一个C#解析器。您可以 ANTLR 请求解析树，并且解释器可能已经可以对解析树进行操作。也许您必须将解析树转换为更抽象的内部表示（尽管 ANTLR 已经允许在生成树时省略不相关的标点符号）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T07:50:40.850

听起来可能很奇怪，但 Game Scripting Mastery 是学习解析、编译和解释代码的绝佳资源。

你真的应该检查一下：

[http://www.amazon.com/Scripting-Mastery-Premier-Press-Development/dp/1931841578](https://rads.stackoverflow.com/amzn/click/com/1931841578)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-04T06:24:24.160

一种方法是检查现有解释器的源代码。我用 D 编程语言编写了一个 javascript 解释器，你可以从[http://ftp.digitalmars.com/dmdscript.zip下载源代码](http://ftp.digitalmars.com/dmdscript.zip)

沃尔特·布莱特，数字火星

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-04T06:31:47.857

我建议利用 DLR 来执行此操作，因为这正是它的设计目的。

[在 DLR 之上创建您自己的语言](http://www.dotnetguru.org/us/dlrus/DLR2.htm)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-12T06:39:57.943

[Lua](http://www.lua.org/)被设计为非程序员使用的可扩展解释器。（第一批用户是巴西石油地质学家，尽管从那时起[用户群已经大大扩大](http://www.wowprogramming.com/)。）您可以使用 Lua 并轻松添加您的科学算法、可视化等。它设计精良，您可以继续手头的任务。

当然，如果您真正想要的是构建自己的乐趣，那么其他建议是合理的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-04T06:38:25.363

你考虑过使用[IronPython](http://www.codeplex.com/IronPython)吗？它很容易从 .NET 中使用，而且似乎可以满足您的所有要求。我知道 Python 在科学编程中相当流行，因此您的用户可能已经熟悉它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-26T00:11:14.333

> 该解释器将使用的编程语言应该很简单，因为它针对的是非软件开发人员。

我将插话你问题的这一部分。一种简单的语言并不是你真正想要交给非软件开发人员的。精简的语言需要程序员付出更多的努力。您真正想要的是一种设计良好且实施良好的领域特定语言 (DSL)。

从这个意义上说，我将支持 Norman Ramsey 对 Lua 的推荐。它作为高质量 DSL 的基础而享有盛誉。一个有据可查且有用的 DSL 需要时间和精力，但从长远来看，当领域专家可以快速上手并需要最少的支持时，它将为每个人节省时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-05-18T16:13:51.560

我很惊讶还没有人提到[xtext](https://en.wikipedia.org/wiki/Xtext)。它可用作[Eclipse 插件](https://eclipse.org/Xtext/index.html)和[IntelliJ 插件](https://plugins.jetbrains.com/plugin/8074-xtext)。它不仅提供像 ANTLR 这样的解析器，还提供 DSL 所需的整个管道（包括解析器、链接器、类型检查器、编译器）。您可以在 Github 上查看它的源代码，以了解解释器/编译器的工作原理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-05-28T22:27:06.743

[Silk](https://github.com/SoftCircuits/Silk)库刚刚发布到 GitHub。它似乎完成了您所要求的大部分工作。这是非常容易使用。只需注册您想要提供给脚本的功能，将脚本编译为字节码并执行它。

# asp.net - 循环调用 Webservices 不会执行自定义 OnSuccess 函数

> ID：256634
> 
> 赞同：1
> 
> 时间：2008-11-02T07:49:32.523
> 
> 标签：asp.net, javascript, jquery, web-services

我有个问题。我正在使用 VS2008 进行编码。我正在从我的 JavaScript 页面调用 web 服务。一个例子

```
Services.ChangeDropDownLists.GetNowPlayingMoviesByLocationSVC(
    blah, 
    OnSuccessMoviesByRegion, 
    OnError, 
    OnTimeOut
); 
```

执行后，它转到函数`OnSuccessMoviesByRegion`。

但是如果我把服务放在一个循环中（一个简单的 for 循环）

```
Services.ChangeDropDownLists.GetNowPlayingMoviesByLocationSVC(
    blah[i], 
    OnSuccessMoviesByRegion, 
    OnError, 
    OnTimeOut
); 
```

`OnSucessMoviesByRegion`函数不会执行（但服务调用成功执行 n 次但我必须有函数因为我通过它返回值。

我错过了什么？这是典型的行为吗？有什么选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T08:00:25.823

我猜有某种**并发问题**。可能您在最后一个请求完成之前触发了下一个请求。

我认为您将不得不重写循环。尝试移动该代码，仅调用第一个请求，然后每次使用“OnSuccess”函数调用下一个请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T08:25:14.150

Naveen，我在这里回答你的[后续问题](https://stackoverflow.com/questions/256634/calling-webservices-in-a-loop-wont-execute-the-custom-onsuccess-function#256658)。我可以想到两个选择：

1.  尝试进行一次调用打包您的数据（发送整个 blah 数组并在服务器上处理它）。

2.  使用您每次在“OnSucces”客户端处理程序中递减的计数器变量，并在此计数器变量达到 0 时停止。

# time - PLT 方案中的时间码

> ID：256647
> 
> 赞同：2
> 
> 时间：2008-11-02T08:01:35.027
> 
> 标签：time, scheme, timing, racket

我想看看一个函数需要多长时间才能运行。在 PLT-Scheme 中最简单的方法是什么？理想情况下，我希望能够做这样的事情：

```
> (define (loopy times)
  (if (zero? times)
      0
      (loopy (sub1 times)))) 
> (loopy 5000000)
0                      ;(after about a second)
> (timed (loopy 5000000))
Took: 0.93 seconds
0
> 
```

我是否必须使用其他语法（如`(timed loopy 5000000)`or `(timed '(loopy 5000000))`，或者它是否返回在 cons 或其他东西中花费的时间）都没有关系。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-04T18:49:15.623

在大多数 Scheme 实现中，用于计时表达式执行的标准名称是“time”。这是 DrRacket 中的一个示例。

> (define (loopy times) (if (zero? times) 0 (loopy (sub1 times))))
> 
> （时间（循环 5000000）） cpu 时间：1526 实时：1657 gc 时间：0 0

如果您花时间对不同的实现进行基准测试，请记住从命令行使用球拍而不是直接在 DrRacket 中进行基准测试（DrRacket 插入调试代码以提供更好的错误消息）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T08:03:58.797

找到了...

从[在线文档](http://download.plt-scheme.org/doc/301/html/mzscheme/mzscheme-Z-H-15.html#node_sec_15.1.3)：

> *   `(time-apply proc arg-list)`使用 arg-list 中的参数调用过程 proc。返回四个值：一个包含应用程序结果的列表，获得该结果所需的 CPU 时间毫秒数，结果所需的“真实”毫秒数，以及用于垃圾回收的 CPU 时间（包括在第一个结果中）。

示例用法：

```
> (time-apply loopy '(5000000))
(0)
621
887
0 
```

# mysql - PL/Ruby equivalent in MySQL

> ID：256681
> 
> 赞同：1
> 
> 时间：2008-11-02T09:02:53.013
> 
> 标签：mysql, ruby, postgresql

PL/Ruby is a loadable procedural language for Postgres that lets you use Ruby to write user defined functions for the database.

Anyone know of an equivalent way of writing user defined functions for MySQL in Ruby?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T09:44:49.590

Starting from version 5 (I think) Mysql supports [stored procedures](http://dev.mysql.com/doc/refman/5.1/en/stored-routines.html), but the syntax is restricted to SQL:2003 which is somewhat similar to PL/SQL.

Other languages aren't supported and I'm not aware of any projects offering ruby support. Last time I checked the PL/Ruby extensions to postgres were still a bit wonky as well, though.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T09:32:09.337

Mysql as far as I am aware only supports MySQLs own stored procedure language.

I'm a postgresql fan too, and this is something that has always frustrated me about MySQL when I have had no choice but to use it. :(

# c# - Why would a typebuilder spit out two .ctor methods?

> ID：256689
> 
> 赞同：2
> 
> 时间：2008-11-02T09:09:55.323
> 
> 标签：c#, .net, vb.net

I have a typebuilder that is generating two identical .ctors one that is has no method body and the other that has all the init code.

I am defining a field from another type and a property to access the type and therefore need to init it in the .ctor

Where should I start looking

Code as follows

```
Public Sub ctor(ByVal type As TypeBuilder, ByVal FieldRefs As Dictionary(Of Type, FieldBuilder))
    ' Method attributes
    Dim methodAttributes As System.Reflection.MethodAttributes = MethodAttributes.[Public]

    Dim method As MethodBuilder = type.DefineMethod(".ctor", methodAttributes)
    ' Preparing Reflection instances

    Dim ctor1 As ConstructorInfo = GetType(Object).GetConstructor(BindingFlags.Instance Or BindingFlags.[Public] Or BindingFlags.NonPublic, Nothing, Nothing, Nothing)

    ' Setting return type
    method.SetReturnType(GetType(Void))
    ' Adding parameters
    Dim gen As ILGenerator = method.GetILGenerator()
    ' Writing body
    gen.Emit(OpCodes.Ldarg_0)
    gen.Emit(OpCodes.[Call], ctor1)

    'new up fields
    For Each item In FieldRefs
        AddCtor(type, gen, item.Value, item.Key)
    Next

    gen.Emit(OpCodes.Ret)

    ' finished
End Sub

Private Sub AddCtor(ByVal type As TypeBuilder, ByVal gen As ILGenerator, ByVal FieldBuilderRef As FieldBuilder, ByVal TypeToReference As Type)
    Dim TypeCtor = TypeToReference.GetConstructor(BindingFlags.Instance Or BindingFlags.[Public] Or BindingFlags.NonPublic, Nothing, New Type() {}, Nothing)
    gen.Emit(OpCodes.Ldarg_0)
    gen.Emit(OpCodes.Newobj, TypeCtor)
    gen.Emit(OpCodes.Stfld, FieldBuilderRef)
End Sub 
```

Code takes in a dictionary of type , fieldbuilder to emit in the ctor. to new up the fields built earlier in the typebuilder main routine

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T09:13:33.710

Are you sure one isn't the `.cctor`? But you are responsible for creating all constructors in a `TypeBuilder`; have you perhaps called `DefineDefaultConstructor()` in addition to `DefineConstructor()`? This would create an empty default constructor... so if you don't want an *empty* constructor, don't call this.

# scala - Scala 组合器解析器 - 区分数字字符串和变量字符串

> ID：256694
> 
> 赞同：6
> 
> 时间：2008-11-02T09:22:15.567
> 
> 标签：scala, parsing, combinators

我正在做 Cay Horstmann 的组合解析器练习，我想知道在匹配语句中区分表示数字的字符串和表示变量的字符串的最佳方法：

```
def factor: Parser[ExprTree] = (wholeNumber | "(" ~ expr ~ ")" | ident) ^^ {
    case a: wholeNumber  => Number(a.toInt)
    case a: String => Variable(a)
} 
```

第二行，“case a: wholeNumber”是不合法的。我想过一个正则表达式，但还没有找到一种方法让它与“案例”一起工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-02T19:44:07.103

我会将其拆分一下，然后将案例分析推送到`|`. 这是组合器的优点之一，通常是 LL(*) 解析：

```
def factor: Parser[ExprTree] = ( wholeNumber ^^ { Number(_.toInt) }
                               | "(" ~> expr <~ ")" 
                               | ident ^^ { Variable(_) } ) 
```

如果您不熟悉下划线语法，我深表歉意。基本上它只是意味着“将第*n*个参数替换为封闭函数值”。因此`{ Variable(_) }`等价于`{ x => Variable(x) }`。

这里的另一个语法魔术是`~>`and`<~`运算符代替`~`. 这些运算符意味着该术语的解析应该包括两个括号的*语法*，但结果应该完全由`expr`. 因此，`"(" ~> expr <~ ")"`匹配的内容与 完全相同`"(" ~ expr ~ ")"`，但不需要额外的案例分析来从 中检索内部结果值`expr`。

# syntax - Scala 语法 - 将字符串传递给对象

> ID：256697
> 
> 赞同：5
> 
> 时间：2008-11-02T09:27:37.910
> 
> 标签：syntax, scala, notation

在 Scala 中玩正则表达式时，我写了如下内容：

```
scala> val y = "Foo"
y: java.lang.String = Foo

scala> y "Bar"

scala> 
```

如您所见，第二个语句只是默默接受。这是合法的法律声明吗？如果是，它有什么作用？或者它是解析器中的错误并且应该有错误消息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T11:50:49.230

这确实是解析器中的错误。它在 scala 2.7.2 中修复（目前是 RC6）

```
$ ./scala
Welcome to Scala version 2.7.2.RC6 (Java HotSpot(TM) Client VM, Java 1.5.0_16).
Type in expressions to have them evaluated.
Type :help for more information.
scala> def y = "foo"
y: java.lang.String

scala> y "bar"
<console>:1: error: ';' expected but string literal found.
       y "bar"
         ^

scala> val x = "foo"
x: java.lang.String = foo

scala> x "foo"
<console>:1: error: ';' expected but string literal found.
       x "foo"
         ^

scala> "foo" "bar"
<console>:1: error: ';' expected but string literal found.
       "foo" "bar"
             ^ 
```

# database - What is a View in Oracle?

> ID：256700
> 
> 赞同：59
> 
> 时间：2008-11-02T09:33:38.913
> 
> 标签：database, oracle, views

What is a view in Oracle?

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-11-02T09:36:55.643

A **View in Oracle** and in other database systems is simply the representation of a SQL statement that is stored in memory so that it can easily be re-used. For example, if we frequently issue the following query

```
SELECT customerid, customername FROM customers WHERE countryid='US'; 
```

To create a view use the **CREATE VIEW command** as seen in this example

```
CREATE VIEW view_uscustomers
AS
SELECT customerid, customername FROM customers WHERE countryid='US'; 
```

This command creates a new view called view_uscustomers. Note that this command does not result in anything being actually stored in the database at all except for a data dictionary entry that defines this view. This means that every time you query this view, Oracle has to go out and execute the view and query the database data. We can query the view like this:

```
SELECT * FROM view_uscustomers WHERE customerid BETWEEN 100 AND 200; 
```

And Oracle will transform the query into this:

```
SELECT * 
FROM (select customerid, customername from customers WHERE countryid='US') 
WHERE customerid BETWEEN 100 AND 200 
```

**Benefits of using Views**

*   Commonality of code being used. Since a view is based on one common set of SQL, this means that when it is called it’s less likely to require parsing.
*   Security. Views have long been used to hide the tables that actually contain the data you are querying. Also, views can be used to restrict the columns that a given user has access to.
*   [Predicate pushing](http://www.devx.com/tips/Tip/34429)

You can find advanced topics in this article about "[How to Create and Manage Views in Oracle](http://www.oracle-dba-online.com/sql/create_and_manage_views.htm)."

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-03T11:32:43.243

如果您喜欢 Views 的想法，但担心性能，您可以让 Oracle 创建一个缓存表来表示 oracle 保持最新的视图。
查看[物化视图](http://download.oracle.com/docs/cd/B10501_01/server.920/a96567/repmview.htm)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-01-17T07:58:43.400

regular view----->short name for a query,no additional space is used here

Materialised view---->similar to creating table whose data will refresh periodically based on data query used for creating the view

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-03T10:16:04.470

视图是一个虚拟表，它提供对一个或多个表中列的子集的访问。视图可以从一个或多个表中获取其数据。查询的输出可以存储为视图。View 就像一张小桌子，但实际上并不占用任何空间。视图是通过直接访问表来呈现特定用户的数据的好方法。oracle 中的视图不过是存储的 sql 脚本。视图本身不包含数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-03T09:54:40.447

视图只是任何`SELECT`已指定名称并保存在数据库中的查询。因此，视图有时称为命名查询或存储查询。要创建视图，请使用 SQL 语法：

```
 CREATE OR REPLACE VIEW <view_name> AS
     SELECT <any valid select query>; 
```

# c++ - How to use boost::mpl to compose policies?

> ID：256702
> 
> 赞同：6
> 
> 时间：2008-11-02T09:36:04.430
> 
> 标签：c++, templates, metaprogramming, boost-mpl

I have used something like the following to compose policies for my application:

The policy classes look like this:

```
struct Policy {
  static void init();
  static void cleanup();
  //...
};

template <class CarT, class CdrT>
struct Cons {
  static void init() {
    CarT::init();
    CdrT::init();
  }
  static void cleanup() {
    CdrT::cleanup();
    CarT::cleanup();
  }
  //...
}; 
```

To compose policies:

```
typedef Cons<Policy1, Cons<Policy2, Cons<Policy3, Policy4> > > MyPolicy; 
```

To use MyPolicy:

```
init_with<MyPolicy>(...);
//...
cleanup_with<MyPolicy>(...); 
```

where they'd call:

```
MyPolicy::init_options(); // calls Policy1 to 4's init in order 
```

and

```
MyPolicy::cleanup(); // calls Policy1 to 4's cleanup in reverse order 
```

Essentially, Cons constructs a type list here. It's pretty straight forward. However the typedef cons line is kinda ugly. It'll be ideal to have policy combiner that can do this:

```
typedef CombinePolicy<Policy1, Policy2, Policy3, Policy4> MyPolicy; 
```

Since we can have arbitrary number of policies, the CombinePolicy would need variadic template support in C++0x, which is only available experimentally in cutting edge compilers. However, it seems that boost:mpl library solved/worked around the problem by using a bunch preprocessing tricks. I *guess* I could use something like:

```
typedef mpl::list<Policy, Policy2, Policy3, Policy4> Policies; 
```

and then calls:

```
init_with<Policies>(...); 
```

which would then use:

```
typedef iter_fold<Policies, begin<Policies>::type,
                  some_magic_lambda_expression>::type MyPolicy; 
```

Obviously, I have a little trouble figuring out *some_magic_lambda_expression* here. I'm sure it's quite trivial for mpl experts here.

Thanks in advance.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-04T03:16:44.630

由于没有人满意地回答这个问题，我花了一些时间深入研究 boost::mpl 源代码。伙计，多层宏和数百行专业化类并不漂亮。我现在更加感谢 boost 库的作者，他们让元编程对我们来说更容易、更便携。希望 C++0x 也能让库编写者的生活更轻松。

无论如何，解决方案变得简单而优雅。

首先 iter_fold 不是我想要的，因为我不知道如何指定一个可以遵循空类型的迭代器。所以我摆弄折叠并找到以下内容：

```
typedef fold<Policies, Null, Cons<_1, _2> >::type MyPolicy; 
```

为了让它工作，我需要提供 Null 类型和 Cons 的特化：

```
struct Null { };

template<class PolicyT>
struct Cons<Null, PolicyT> {
  static void init() { PolicyT::init(); }
  static void cleanup() { PolicyT::cleanup(); }
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T12:40:55.320

我认为您的问题是运行时调用而不是元函数，因为您想在实际运行时对象上调用 init 函数。

您可以尝试 mpl 的运行时算法，例如：

```
for_each<Policies>(InitPolicy()); 
```

和

```
struct InitPolicy() {
    template<class Policy>
    void operator() (Policy& p) { p.init_options(); }
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T19:51:59.163

我认为您正在寻找类似的东西：

```
typedef 
  iter_fold<
    Policies,
    begin<Policies>::type,
    Cons<_1,_2>
  >::type
  MyType; 
```

如果您内置某种 CRTP 以在编译时调用硬连线的基函数，您可能还想查看[inherit_linearly<> 。](http://www.boost.org/doc/libs/1_36_0/libs/mpl/doc/refmanual/inherit-linearly.html)

# orm - Code generators or ORMs?

> ID：256708
> 
> 赞同：4
> 
> 时间：2008-11-02T09:43:13.683
> 
> 标签：orm, code-generation, data-access-layer

What do you suggest for Data Access layer? Using ORMs like Entity Framework and Hibernate OR Code Generators like Subsonic, .netTiers, T4, etc.?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-02T11:48:13.587

对我来说，这很容易，您*生成*代码。

我将在这里稍微偏离主题，因为有一个更大的潜在谬误在起作用。谬误在于这些 ORM 框架*解决*了对象/关系阻抗不匹配问题。这种说法是赤裸裸的谎言。

我发现解决对象/关系阻抗不匹配的最佳方法是专门使用 OOP 并使用对象数据库，或者专门使用关系数据库的习语而忽略 OOP。

“一切都是表”的抽象对我来说，比“一切都是类”的抽象要强大得多。当您编码到数据库而不是对象模型时，它需要更少的代码、更少的智力工作并导致*更快的代码。*

对我来说，这似乎很明显。如果您的应用程序是数据驱动的，那么您的代码肯定也应该是数据驱动的吗？然而，要说这是非常有争议的。

这里的核心问题是，当与数据库结合使用时，OOP 变成了一个真正有漏洞的抽象。当您看到代码在数据库中生成的流量时，按照 OOP 的习惯用法编写时看起来非常合理的代码看起来完全是疯狂的。当这种混乱成为性能问题时，OOP 是第一个牺牲品。

真的没有办法解决这个问题。数据库处理数据*集*。OOP 专注于类的*实例*。试图让两人结婚，总是以离婚收场。

所以要回答你的问题，我相信你应该生成你的类并尝试让它们尽可能地映射底层数据库结构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T10:42:50.613

也许有争议的是，我一直认为使用 ADO.NET 管道的代码生成器从根本上解决了错误的问题。

在某个时候，希望在学习了连接字符串、SqlCommands、DataAdapters 和所有这些之后不久，我们会注意到：

1.  这样的代码很难看
2.  写的很无聊
3.  如果你用手做，很容易错过一些东西
4.  每次要访问数据库时都必须重复

那么，要解决的问题是“如何快速多次做同一件事”？

我拒绝。

使用代码生成器来加快这个过程仍然意味着您在整个业务类（或数据访问层，如果您将其与业务逻辑分开）中都有大量代码。

然后，如果您想做一些通用的事情（例如跟踪存储过程的使用），如果代码生成器还没有您想要的功能，您最终不得不自定义代码生成器。即使它确实如此，你仍然必须一直重新生成所有内容。

我喜欢做一件事，而不是很多次，不管我能做多快。

所以我推出了自己的数据访问类，它知道如何添加参数、设置和关闭连接、管理事务和其他很酷的东西。它只需要编写一次，并且从需要完成一些数据库工作的业务对象调用它的方法由一行代码组成。

当我需要使应用程序支持多线程数据库访问时，只需要更改数据访问类，所有业务类都只做它们已经做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-09T02:20:47.567

没有正确的答案，这完全取决于您的项目。正如 Simon 指出的那样，如果您的应用程序都是数据驱动的，那么根据域的大小和复杂性，使用非 oop 范式可能是有意义的。我在使用事务脚本模式构建系统方面取得了很大成功，该模式在系统中传递 XML 消息。

然而，随着应用程序规模和复杂性的增长（5 或 6 个 Web、多个 Web 服务、大量的 COM+ 组件、遗留和 .net 代码、8 个以上的数据库和 800 多个表 4,000+程序）。没有人知道什么是什么，复制猖獗。

除了OOP，还有其他方法可以减轻维护；但是，如果您有一个非常复杂的域，那么拥有一个丰富的域模型是理想的恕我直言，因为它允许业务规则以很好的封装组件表示。

要回答您的问题，请尽可能避免使用代码生成器。代码生成器是灾难的根源，但如果您确实使用代码生成器，请不要修改生成的代码。还要确保有一个良好的流程，以便开发人员轻松获取新生成的代码。

我建议使用以下任一：ORM 或手卷轻量级 DAL。我目前正在将一个项目从我的手卷 DAL 转移到 nHibernate，并且取得了很大的成功；但是，我喜欢使用任一选项。此外，如果您正确地将您的关注点（数据访问从业务层与表示）分开，您可以拥有一个可能与 Dao（数据访问对象）对话的单个服务层，对于一个对象是 ORM，而对于另一个对象是手动滚动的）。我喜欢这种灵活性，因为它允许将最好的工具应用到工作中。

我喜欢 nHibernate 而不是手卷 DAL，因为虽然我的 DAL 确实抽象了大部分 ADO.Net 代码，但您仍然必须编写将数据读取器带到对象或对象并创建参数的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T10:17:41.693

我一直更喜欢使用代码生成器路线，尤其是在 C# 中，您可以利用扩展类向基本数据对象添加功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T10:23:19.047

讨厌这么说，但这取决于。如果您找到适合您需求的 ORM 工具，请选择它。我们在开发应用程序时分小步编写了自己的系统。我们正在使用 C++，而且无论如何都没有那么多工具。我们最终成为数据库的 XML 描述，从中生成 SQL 生成脚本和基本对象层和元数据。

做好功课并评估这些工具，您会找到适合您需求的工具。

# c++ - 如何以编程方式激活 Windows mobile 中的菜单

> ID：256719
> 
> 赞同：1
> 
> 时间：2008-11-02T09:52:58.047
> 
> 标签：c++, windows, mfc, mobile

在大多数版本的 Windows 中，您可以通过按 F10 键进入菜单，从而避免使用鼠标。这种行为在 Windows Mobile 5.0 中似乎不存在，但由于我使用的设备更多是键盘而不是触摸屏驱动，因此是可取的。

有没有一种方法可以在 C++ 下使用 MFC 或 Windows API 调用以编程方式激活和使用 Windows Mobile 5.0 上的菜单。我尝试将 CFrameWnd 和 CCeCommandBar 类的焦点设置为无济于事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T11:14:54.463

经过多次尝试，以下似乎可行；

```
void CMyFrame::OnFocusMenu()
{
  PostMessage(WM_SYSCOMMAND,SC_KEYMENU,0);
} 
```

FWIW，以下都没有，其中 m_wndCommandBar 是包含菜单的 CCeCommandBar 工具栏；

```
::SetActiveWindow(m_wndCommandBar.m_hWnd);
m_wndCommandBar.PostMessage(WM_ACTIVATE,WA_ACTIVE,0);
m_wndCommandBar.PostMessage(WM_LBUTTONDOWN,0,0);
m_wndCommandBar.PostMessage(WM_LBUTTONUP,0,0);
m_wndCommandBar.OnActivate(WA_ACTIVE, NULL, FALSE);
m_wndCommandBar.SetFocus(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T22:52:13.933

如果通过菜单，您的意思是软键，请注意它们分别绑定到 F1 和 F2。

# svn - SVN - 检索有用信息

> ID：256723
> 
> 赞同：6
> 
> 时间：2008-11-02T10:00:04.927
> 
> 标签：svn

我们正在使用颠覆。我们想要

```
1\. search across all commit messages ?
2\. monitor the commits on certain important files ?
3\. identify files that are never/rarely used ?
4\. identify files that are most frequently changed ?         
5\. identify files that most developers have accessed ?
6\. identify files that have been committed together many number of times ? 
```

这些数据的用途可能是清除[此类](https://stackoverflow.com/questions/216876/what-is-the-best-commit-message-you-have-ever-encountered#255762)消息，重构代码并清理项目中未使用的文件。

请建议工具来实现相同的..

**编辑：**我们在 Windows 2003 上运行 SVN。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T11:22:39.487

[StatSVN](http://www.statsvn.org/ "统计SVN")应该能够为您完成大部分工作。但是，您需要设置一个计划任务以在您的存储库上运行它，或者如果您碰巧使用它，您可以将它集成到 Ant 构建中。

但是，一些更复杂的任务（例如列表中的第 6 项）可能需要自定义解决方案。或者，由于 StatSVN 是开源的，您可以对其进行必要的更改并将其提交回项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T12:20:20.900

另一个值得一看的工具是[ViewVC](http://www.viewvc.org/)。最新版本可以选择维护提交数据库。这允许您搜索所有提交消息，并查看按用户、时间或正则表达式过滤的目录中文件或文件的更改列表。它还支持 RSS 提要，可以对单个文件进行某种形式的通知。

对于列表中的 3、4 和 5，其他答案中提到的 StatSVN 应该能够做到这一点。对于商业解决方案，有来自 Atlassian的[FishEye 。](http://www.atlassian.com/software/fisheye/)

在我们的存储库中，我们使用 ViewVC 和 StatSVN 的组合，前者用于存储库浏览和搜索提交消息，后者用于查看统计信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T10:05:25.087

你用的是什么平台？在 linux 上，使用一个快速的 shell 脚本`sed`应该可以解决问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-02T10:25:55.280

在 .NET领域，您可以使用[SharpSvn](http://sharpsvn.open.collab.net/)库。不过，要实现您想要的，您需要收集所有日志消息并自己解析它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T18:12:25.200

您可以使用 Subversion 命令行客户端和一些脚本（Ruby 或 Python）来完成很多工作，但不要指望这里的人会为您编写代码。实施细节将取决于您希望多久运行一次统计信息以及您的存储库有多大。

从 Subversion 命令行客户端处理数据时，您可能会发现使用 --xml 选项（由“log”和“info”命令接受）以 XML 格式输出数据更容易。

```
1\. search across all commit messages ? 
```

运行“svn log -v --xml”并在生成的 XML（或其部分）上运行文本搜索。您可以指定要搜索的提交消息集。

```
2\. monitor the commits on certain important files ? 
```

这是通过提交触发器实现的。请参阅 Subversion 服务器文档。

```
3\. identify files that are never/rarely used ?
4\. identify files that are most frequently changed ?         
5\. identify files that most developers have accessed ?
6\. identify files that have been committed together many number of times ? 
```

这些都可以使用“svn log --xml”的输出和生成的 XML 数据的后处理来实现。

# c++ - 在 C++ 中，通过引用扩展范围是否安全？

> ID：256724
> 
> 赞同：9
> 
> 时间：2008-11-02T10:00:29.233
> 
> 标签：c++, reference, scope

在 C++ 中，通过引用扩展范围是否安全？

在代码中，我的意思是：

```
MyCLass& function badIdea()
{
    MyClass obj1;
    ...
    return obj1;
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-02T10:18:36.233

通过引用扩展范围是不安全的。当 obj1 超出范围时，C++ 中的对象不会被引用计数，它将被删除，引用 badIdea() 的结果只会给你带来麻烦

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-02T10:25:18.463

唯一可以使用引用扩展范围的地方是使用`const`引用`namespace`或函数范围（而不是类成员）。

```
const int & cir = 1+1; // OK to use cir = 2 after this line 
```

这个技巧在[Andrei Alexandrescu 的](http://erdani.org/)非常酷的[范围保护](http://www.ddj.com/cpp/184403758)中使用，以捕获`const`对具体范围保护的基类的引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T10:16:42.680

请澄清你的意思。

假设您打算这样做：

```
int * p = NULL;
{
  int y = 22;
  p = &y;
}
*p = 77; // BOOM! 
```

那么不，绝对不是，范围不会通过引用来扩展。

您可能想查看智能指针，例如来自 boost 库：[clickety](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/smart_ptr.htm)

# java - vi 模式下的 JTextArea

> ID：256726
> 
> 赞同：3
> 
> 时间：2008-11-02T10:04:39.707
> 
> 标签：java, textarea, vi

是否有支持“vi 模式”的 JTextArea 的免费和开源扩展？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-05T15:59:34.093

也许你可以在这里找到有用的信息：http: [//jvi.sourceforge.net/](http://jvi.sourceforge.net/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T14:02:18.713

AFAIK，不。这是一个晦涩难懂的请求，我认为您必须自己编写代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-03T16:26:34.163

当然，我不能*确定*这样的组件不存在，但如果确实存在，我会感到非常惊讶。Eclipse有一个[vi 插件](http://www.satokar.com/viplugin/)，它大概包括 vi 键绑定的 Java 实现。但是，该插件是商业的，因此您不能合法地重用该源代码。出于好奇，您到底想要这个做什么？

# asp.net - 处理 Web 服务响应（错误场景）不起作用

> ID：256728
> 
> 赞同：0
> 
> 时间：2008-11-02T10:05:34.853
> 
> 标签：asp.net, javascript, jquery, web-services

```
function AddTheatres() {
  Services.AdminWebServices.AddTheatresSVC(oTheatres, OnSuccessTheatres, OnError, OnTimeOut);
}

function OnSuccessTheatres(result1) {
  Services.AdminWebServices.AddTicketPricesSVC(oTicketPrices, OnSuccessTicketPrices, OnError, OnTimeOut); //working
}

function OnSuccessTicketPrices(result2) {
  alert(result2); //not working
} 
```

为什么警报不起作用？在调试函数调用`AddTicketPricesSVC`返回正确的值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T10:13:53.637

您是否实现了 OnError 和 OnTimeout 处理程序？也许有服务器错误？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T10:25:00.790

```
function OnError(error)
{
    alert(error.get_message());
}
function OnTimeOut()
{
    alert('System Time Out');
} 
```

这是实现它的方法吗？

# regex - 正则表达式最多匹配 4 个空格

> ID：256729
> 
> 赞同：4
> 
> 时间：2008-11-02T10:06:10.483
> 
> 标签：regex

我有一个正则表达式来匹配一个人的名字。

到目前为止，我有 ^([a-zA-Z\'\s]+)$ 但我想添加一个检查以允许最多 4 个空格。我该如何修改它来做到这一点？

**编辑：**我的意思是字符串中任意位置的 4 个空格

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-02T10:46:13.493

不要尝试正则表达式验证名称。人们可以随意称呼自己。这可以包括任何字符。仅仅因为你住在一个只使用英语的地方并不意味着所有使用你系统的人都会有英文名字。我们甚至不得不将系统中的名称字段设为 Unicode。它是数据库中唯一的 Unicode 类型。

如果您在意，我们实际上将名称拆分为“”，并将每个名称部分存储为单独的记录，但我们有一些非常具体的要求，这意味着这是一个好主意。

PS。我的继母名字中有 5 个空格。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-02T11:26:53.770

```
^                    # Start of string
(?!\S*(?:\s\S*){5})  # Negative look-ahead for five spaces.
([a-zA-Z\'\s]+)$     # Original regex 
```

或者在一行中：

```
^(?!(?:\S*\s){5})([a-zA-Z\'\s]+)$ 
```

如果字符串中有五个或更多空格，则五个将被否定前瞻匹配，整个匹配将失败。如果有四个或更少，则将匹配原始正则表达式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-02T10:15:24.413

## 拧正则表达式。

在这里使用正则表达式似乎是在为解决方案创造问题，而不仅仅是解决问题。

即使对于新手程序员来说，这项任务也应该是“容易的”，而正则表达式的新颖想法已经污染了我们的思想！

```
1: Get Input    
2: Trim White Space
3: If this makes sence, trim out any 'bad' characters. 
4: Use the "split" utility provided by your language to break it into words
5: Return the first 5 Words. 
```

火箭科学。

### 回复

> 你是什​​么意思拧正则表达式？你显然是一个 VB 程序员。正则表达式是处理字符串的最有效方式。学习它们。

不，Php，玩弄了一点 ruby​​，现在疯狂地进入 perl。

在某些情况下（例如这种情况），基于正则表达式的替代方案在计算上和逻辑上对任务来说过于复杂。

我已经用正则表达式解析了整个 php 源文件，我在使用它们时并不完全是新手。

但是在很多情况下，例如这种情况，您正在雇用一家伐木公司来修剪您的玫瑰丛。

当然，我可以使用正则表达式完成所有步骤 2 到 5，但它们将是简单且原子的正则表达式，没有奇怪的回溯语法或递归搜索的潜力。

我上面列出的步骤 1 到 5 具有已知的范围、已知的输入范围，并且它的功能没有歧义。至于你的正则表达式，你必须得到其他人的贡献才能写出如此简单的东西这一事实证明了这一点。

我看到有人将我的帖子标记为冒犯，我有点不高兴我不能将此事实标记为冒犯我。;)

布丁的证明：

```
sub getNames{
    my @args = @_;
    my $text = shift @args;
    my $num  = shift @args;

    # Trim Whitespace from Head/End
    $text =~ s/^\s*//;
    $text =~ s/\s*$//;

    # Trim Bad Characters (??)
    $text =~ s/[^a-zA-Z\'\s]//g;

    # Tokenise By Space 
    my @words = split( /\s+/, $text );

    #return 0..n 
    return @words[ 0 .. $num - 1 ];
} ## end sub getNames

print join ",", getNames " Hello world     this is a    good test", 5;
>> Hello,world,this,is,a 
```

如果任何人对它的工作原理有任何不明确之处，我很乐意向他们解释。注意到我仍在使用正则表达式。其他语言我会尽可能使用它们提供的原生“修剪”功能。

* * *

## 胡说八道——>

我首先尝试了这种方法。这是你对正则表达式的大脑。孩子们，不要做正则表达式。

* * *

这可能是一个好的开始

```
/([^\s]+
    (\s[^\s]+
      (\s[^\s]+
        (\s[^\s]+
          (\s[^\s]+|)
         |)
       |)
    |)
  )/ 
```

（为清楚起见，换行）

```
/([^\s]+(\s[^\s]+(\s[^\s]+(\s[^\s]+|)|)|))/ 
```

（ 实际的 ）

为了简洁起见，我在`[^\s]+`这里使用了而不是您的 AZ 组合，但重点是嵌套的可选组

IE：

```
(Hello( this( is( example))))
(Hello( this( is( example( two)))))
(Hello( this( is( better( example))))) three
(Hello( this( is()))))
(Hello( this()))
(Hello()) 
```

（注意：这虽然令人费解，但好处是将每个名称匹配到自己的组中）

如果你想要可读的代码：

```
 $word = '[^\s]+'; 
  $regex = "/($word(\s$word(\s$word(\s$word(\s$word|)|)|)|)|)/"; 
```

（它围绕着（捕获|）“得到这个，或者什么都得不到”的口头禅）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-02T10:15:56.283

@Sir Psycho：请注意您的假设。连字符的名字呢？带点的名字（例如Brian R. Bondy）等等？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T10:15:32.197

`^([a-zA-Z']+\s){0,4}[a-zA-Z']+$`

这假设您希望此字符串中有 4 个空格*（*即您已修剪它）

编辑：如果你想在任何地方有 4 个空格，我建议不要使用正则表达式 - 你最好使用 a `substr_count`（或你的语言中的等价物）。

我也同意 pipTheGeek 的观点，即有很多不同的方式来写名字，你可能最好相信用户会正确地写出他们的名字（尽管我发现很多人不会在电子商务结账时使用大写字母）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-02T11:55:12.993

这是您最有可能寻找的答案：

```
^[a-zA-Z']+(\s[a-zA-Z']+){0,4}$ 
```

那就是（英文）：“从头到尾，匹配一个或多个字母，也可以有一个空格，后跟另一个'名称'最多四次。”

顺便说一句：你为​​什么希望他们在名字的任何地方都有撇号？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-06-27T06:18:27.790

在行尾匹配多个空格后跟两个字符。

**相关问题----**

从一个字符串中，删除前面有多个空格的尾随 2 个字符...例如，如果该列包含此字符串 -“'这是一个以 AB 结尾的 2 个字符的长字符串”，则应删除 AB，同时保留句子。

**解决方案 - -**

`select 'This is a long string with 2 chars at the end AB' as "C1",` `regexp_replace('This is a long string with 2 chars at the end AB', '[[[:space:]][a-zA-Z][a-zA-Z]]*$') as "C2" from dual;`

**输出 - -**

`C1`

`This is a long string with 2 chars at the end AB`

`C2`

`This is a long string with 2 chars at the end`

**分析 ----** 正则表达式指定 - 匹配和替换零个或多个出现 (*) 的空格 ([:space:]) 后跟两个字符的组合 ([a-zA-Z][a-zA-Z] ) 在行尾。

希望这是有用的。

# multithreading - 我可以监控线程的消息队列的大小吗？

> ID：256734
> 
> 赞同：8
> 
> 时间：2008-11-02T10:15:18.093
> 
> 标签：multithreading, winapi, message-queue

我们的应用程序收到来自 DCOM ( `0x80010100`) 的 System Call Failed RPC 错误，我们怀疑目标线程的消息队列已满（尽管我不相信这是真的）。我知道队列[仅限于`10,000`消息](https://stackoverflow.com/questions/123323/how-deep-is-the-win32-message-queue)，我想看看在常见情况下我们是否接近这个数字。有没有办法监控线程的消息队列的大小？

我发现的最有希望的选项是[`GetQueueStatus`](http://msdn.microsoft.com/en-us/library/ms644940(VS.85).aspx)，但这不包括队列中的消息数量，只包括它们的类型。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T08:07:06.717

我不知道有任何监控队列大小的方法（没有使用内核调试器和在 TIB+[0x40] 的内部 Win32Thread 数据结构中卑躬屈膝，我几乎不推荐）。

出于调试目的，要在收到错误时检查队列是否已满，请尝试执行 PostThreadMessage。如果已满，调用应该会失败，GetLastError() == 0x718。（没有足够的配额来处理这个命令。）

# javascript - 如何将参数传递给 addEventListener 侦听器函数？

> ID：256754
> 
> 赞同：412
> 
> 时间：2008-11-02T10:36:14.853
> 
> 标签：javascript, dom, addeventlistener

情况有点像——

```
var someVar = some_other_function();
someObj.addEventListener("click", function(){
    some_function(someVar);
}, false); 
```

问题是 的值`someVar`在 的侦听器函数中不可见`addEventListener`，它可能被视为新变量。

* * *

## 回答 #1

> 赞同：457
> 
> 时间：2012-08-16T12:14:10.550

为什么不直接从事件的目标属性中获取参数呢？

例子：

```
const someInput = document.querySelector('button');
someInput.addEventListener('click', myFunc, false);
someInput.myParam = 'This is my parameter';
function myFunc(evt)
{
  window.alert(evt.currentTarget.myParam);
}
```

```
<button class="input">Show parameter</button>
```

JavaScript 是一种面向原型的语言，请记住！

* * *

## 回答 #2

> 赞同：268
> 
> 时间：2008-11-02T10:51:50.487

您编写的代码绝对没有问题。两者都`some_function`应该`someVar`是可访问的，以防它们在匿名的上下文中可用

```
function() { some_function(someVar); } 
```

被创建。

检查警报是否为您提供了您一直在寻找的值，确保它可以在匿名函数的范围内访问（除非您有更多代码`someVar`在调用旁边的同一变量上运行`addEventListener`）

```
var someVar; 
someVar = some_other_function();
alert(someVar);
someObj.addEventListener("click", function(){
    some_function(someVar);
}, false); 
```

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2013-05-16T19:29:20.807

这个问题很老，但我想我会`.bind()`为后代提供一个使用 ES5 的替代方案。:)

```
function some_func(otherFunc, ev) {
    // magic happens
}
someObj.addEventListener("click", some_func.bind(null, some_other_func), false); 
```

请注意，您需要使用第一个参数设置您的侦听器函数作为您传递给绑定（您的其他函数）的参数，而第二个参数现在是事件（而不是第一个，因为它本来是） .

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2017-08-15T15:44:28.570

相当老的问题，但我今天遇到了同样的问题。我发现最干净的解决方案是使用[柯里化的概念。](https://en.wikipedia.org/wiki/Currying)

代码：

```
someObj.addEventListener('click', some_function(someVar));

var some_function = function(someVar) {
    return function curried_func(e) {
        // do something here
    }
} 
```

通过命名 curried 函数，它允许您调用 Object.removeEventListener 在稍后的执行时间取消注册 eventListener。

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2014-04-12T00:33:45.557

你可以用'bind'绑定所有必要的参数：

```
root.addEventListener('click', myPrettyHandler.bind(null, event, arg1, ... )); 
```

这样，您将始终将`event`,`arg1`和其他内容传递给`myPrettyHandler`.

[http://passy.svbtle.com/partial-application-in-javascript-using-bind](http://passy.svbtle.com/partial-application-in-javascript-using-bind)

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2010-09-12T19:53:01.337

您可以通过将函数声明为变量来添加和删除带有参数的事件监听器。

`myaudio.addEventListener('ended',funcName=function(){newSrc(myaudio)},false);`

`newSrc`是以 myaudio 为参数的方法 `funcName`是函数名变量

您可以删除侦听器 `myaudio.removeEventListener('ended',func,false);`

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2016-04-22T06:37:57.457

您可以通过称为[闭包](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures)的 javascript 功能按值（而不是按引用）传递 somevar ：

```
var someVar='origin';
func = function(v){
    console.log(v);
}
document.addEventListener('click',function(someVar){
   return function(){func(someVar)}
}(someVar));
someVar='changed' 
```

或者您可以编写一个通用的包装函数，例如`wrapEventCallback`：

```
function wrapEventCallback(callback){
    var args = Array.prototype.slice.call(arguments, 1);
    return function(e){
        callback.apply(this, args)
    }
}
var someVar='origin';
func = function(v){
    console.log(v);
}
document.addEventListener('click',wrapEventCallback(func,someVar))
someVar='changed' 
```

这里`wrapEventCallback(func,var1,var2)`是这样的：

```
func.bind(null, var1,var2) 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2019-04-26T01:55:32.600

不错的单线替代品

```
element.addEventListener('dragstart',(evt) => onDragStart(param1, param2, param3, evt)); 
```

```
function onDragStart(param1, param2, param3, evt) {

 //some action...

} 
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2014-02-04T12:11:26.600

[Function.prototype.bind()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_objects/Function/bind)是将目标函数绑定到特定范围的方法，并可以选择`this`在目标函数中定义对象。

```
someObj.addEventListener("click", some_function.bind(this), false); 
```

或者捕获一些词法范围，例如在循环中：

```
someObj.addEventListener("click", some_function.bind(this, arg1, arg2), false); 
```

最后，如果`this`目标函数中不需要该参数：

```
someObj.addEventListener("click", some_function.bind(null, arg1, arg2), false); 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2015-02-20T16:06:27.973

这是另一种方式（这个在 for 循环中工作）：

```
var someVar = some_other_function();
someObj.addEventListener("click", 

function(theVar){
    return function(){some_function(theVar)};
}(someVar),

false); 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2008-11-02T14:57:04.143

`someVar`value 应该只能在`some_function()`上下文中访问，而不是从侦听器中访问。如果您想在侦听器中使用它，则必须执行以下操作：

```
someObj.addEventListener("click",
                         function(){
                             var newVar = someVar;
                             some_function(someVar);
                         },
                         false); 
```

并`newVar`改用。

另一种方法是返回`someVar`值`some_function()`以在侦听器中进一步使用它（作为新的本地变量）：

```
var someVar = some_function(someVar); 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2012-07-17T03:18:26.003

采用

```
 el.addEventListener('click',
    function(){
        // this will give you the id value 
        alert(this.id);    
    },
false); 
```

如果你想将任何自定义值传递给这个匿名函数，那么最简单的方法是

```
 // this will dynamically create property a property
 // you can create anything like el.<your  variable>
 el.myvalue = "hello world";
 el.addEventListener('click',
    function(){
        //this will show you the myvalue 
        alert(el.myvalue);
        // this will give you the id value 
        alert(this.id);    
    },
false); 
```

在我的项目中完美运行。希望这会有所帮助

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2019-01-22T17:41:26.090

如果我没记错的话，使用调用函数`bind`实际上会创建一个由该`bind`方法返回的新函数。这将在以后给您带来问题，或者如果您想删除事件侦听器，因为它基本上就像一个匿名函数：

```
// Possible:
function myCallback() { /* code here */ }
someObject.addEventListener('event', myCallback);
someObject.removeEventListener('event', myCallback);

// Not Possible:
function myCallback() { /* code here */ }
someObject.addEventListener('event', function() { myCallback });
someObject.removeEventListener('event', /* can't remove anonymous function */); 
```

所以请记住这一点。

如果您使用的是 ES6，则可以按照建议执行相同的操作，但更简洁：

```
someObject.addEventListener('event', () => myCallback(params)); 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2019-02-17T08:16:03.473

```
 $form.addEventListener('submit', save.bind(null, data, keyword, $name.value, myStemComment));
    function save(data, keyword, name, comment, event) { 
```

这就是我正确传递事件的方式。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2021-04-20T19:39:46.607

一种简单的执行方法可能是这样

```
 window.addEventListener('click', (e) => functionHandler(e, ...args)); 
```

为我工作。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2015-10-04T05:08:27.420

一种方法是使用**外部函数**执行此操作：

```
elem.addEventListener('click', (function(numCopy) {
  return function() {
    alert(numCopy)
  };
})(num)); 
```

这种将匿名函数包装在括号中并立即调用它的方法称为**IIFE**（立即调用函数表达式）

[您可以在http://codepen.io/froucher/pen/BoWwgz](http://codepen.io/froucher/pen/BoWwgz)中查看带有两个参数的示例。

```
catimg.addEventListener('click', (function(c, i){
  return function() {
    c.meows++;
    i.textContent = c.name + '\'s meows are: ' + c.meows;
  }
})(cat, catmeows)); 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2019-12-19T23:50:07.963

2019 年，大量 api 更改，最佳答案不再有效，没有修复 bug。

分享一些工作代码。

受到以上所有答案的启发。

```
 button_element = document.getElementById('your-button')

 button_element.setAttribute('your-parameter-name',your-parameter-value);

 button_element.addEventListener('click', your_function);

 function your_function(event)
   {
      //when click print the parameter value 
      console.log(event.currentTarget.attributes.your-parameter-name.value;)
   } 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-07-02T22:47:11.390

向 eventListener 的回调函数发送参数需要创建一个隔离函数并将参数传递给该隔离函数。

这是您可以使用的一个不错的小助手功能。基于上面的“hello world”示例。）

还需要一件事是维护对该函数的引用，以便我们可以干净地删除侦听器。

```
// Lambda closure chaos.
//
// Send an anonymous function to the listener, but execute it immediately.
// This will cause the arguments are captured, which is useful when running 
// within loops.
//
// The anonymous function returns a closure, that will be executed when 
// the event triggers. And since the arguments were captured, any vars 
// that were sent in will be unique to the function.

function addListenerWithArgs(elem, evt, func, vars){
    var f = function(ff, vv){
            return (function (){
                ff(vv);
            });
    }(func, vars);

    elem.addEventListener(evt, f);

    return f;
}

// Usage:

function doSomething(withThis){
    console.log("withThis", withThis);
}

// Capture the function so we can remove it later.
var storeFunc = addListenerWithArgs(someElem, "click", doSomething, "foo");

// To remove the listener, use the normal routine:
someElem.removeEventListener("click", storeFunc); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-01-12T17:58:34.530

所有函数内部都有一个特殊变量：*arguments*。您可以将参数作为匿名参数传递，并通过*arguments*变量访问它们（按顺序）。

例子：

```
var someVar = some_other_function();
someObj.addEventListener("click", function(someVar){
    some_function(arguments[0]);
}, false); 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-02-09T11:24:59.583

当我在循环中使用它来查找元素并向其添加侦听器时，我陷入了困境。如果您在循环中使用它，那么这将完美地工作

```
for (var i = 0; i < states_array.length; i++) {
     var link = document.getElementById('apply_'+states_array[i].state_id);
     link.my_id = i;
     link.addEventListener('click', function(e) {   
        alert(e.target.my_id);        
        some_function(states_array[e.target.my_id].css_url);
     });
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-11-20T16:26:57.510

也试试这些（IE8 + Chrome。我不知道 FF）：

```
function addEvent(obj, type, fn) {
    eval('obj.on'+type+'=fn');
}

function removeEvent(obj, type) {
    eval('obj.on'+type+'=null');
}

// Use :

function someFunction (someArg) {alert(someArg);}

var object=document.getElementById('somObject_id') ;
var someArg="Hi there !";
var func=function(){someFunction (someArg)};

// mouseover is inactive
addEvent (object, 'mouseover', func);
// mouseover is now active
addEvent (object, 'mouseover');
// mouseover is inactive 
```

希望没有错别字:-)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-06-03T15:02:47.623

以下答案是正确的，但如果假设您使用 yuicompressor 压缩了 js 文件，则以下代码在 IE8 中不起作用。（其实还是大部分美国人用IE8）

```
var someVar; 
someVar = some_other_function();
alert(someVar);
someObj.addEventListener("click",
                         function(){
                          some_function(someVar);
                         },
                         false); 
```

因此，我们可以按如下方式解决上述问题，并且在所有浏览器中都可以正常工作

```
var someVar, eventListnerFunc;
someVar = some_other_function();
eventListnerFunc = some_function(someVar);
someObj.addEventListener("click", eventListnerFunc, false); 
```

希望对在生产环境中压缩 js 文件的人有用。

祝你好运！！

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-09-18T06:17:32.110

```
 var EV = {
        ev: '',
        fn: '',
        elem: '',
        add: function () {
            this.elem.addEventListener(this.ev, this.fn, false);
        }
    };

    function cons() {
        console.log('some what');
    }

    EV.ev = 'click';
    EV.fn = cons;
    EV.elem = document.getElementById('body');
    EV.add();

//If you want to add one more listener for load event then simply add this two lines of code:

    EV.ev = 'load';
    EV.add(); 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-02-04T22:17:44.013

以下方法对我来说效果很好。从[这里](https://github.com/loverajoel/jstips/blob/gh-pages/_posts/en/2016-01-16-passing-arguments-to-callback-functions.md)修改。

```
function callback(theVar) {
  return function() {
    theVar();
  }
}

function some_other_function() {
  document.body.innerHTML += "made it.";
}

var someVar = some_other_function;
document.getElementById('button').addEventListener('click', callback(someVar));
```

```
<!DOCTYPE html>
<html>
  <body>
    <button type="button" id="button">Click Me!</button>
  </body>
</html>
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2020-08-08T22:20:56.633

由于您的事件侦听器是“点击”，您可以：

```
someObj.setAttribute("onclick", "function(parameter)"); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-06-09T12:43:21.150

以下代码对我来说很好（firefox）：

```
for (var i=0; i<3; i++) {
   element = new ...   // create your element
   element.counter = i;
   element.addEventListener('click', function(e){
        console.log(this.counter);
        ...            // another code with this element
   }, false);
} 
```

输出：

```
0
1
2 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-06-01T18:44:12.503

你需要：

```
newElem.addEventListener('click', {
    handleEvent: function (event) {
        clickImg(parameter);
    }
}); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2019-04-30T16:24:51.250

可能不是最佳的，但对于那些不精通 js 的人来说足够简单。将调用 addEventListener 的函数放入自己的函数中。这样，传递给它的任何函数值都保持自己的范围，您可以根据需要迭代该函数。

示例我使用文件读取进行了计算，因为我需要捕获和渲染图像和文件名的预览。在使用多文件上传类型时，我花了一些时间来避免异步问题。尽管上传了不同的文件，但我会意外地在所有渲染上看到相同的“名称”。

最初，所有 readFile() 函数都在 readFiles() 函数中。这导致了异步范围问题。

```
 function readFiles(input) {
      if (input.files) {
        for(i=0;i<input.files.length;i++) {

          var filename = input.files[i].name;

          if ( /\.(jpe?g|jpg|png|gif|svg|bmp)$/i.test(filename) ) {
            readFile(input.files[i],filename);
          }
       }
      }
    } //end readFiles

    function readFile(file,filename) {
            var reader = new FileReader();

            reader.addEventListener("load", function() { alert(filename);}, false);

            reader.readAsDataURL(file);

    } //end readFile 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-09-11T12:43:15.947

只是想补充。如果有人将更新复选框的功能添加到事件侦听器，您将不得不使用`event.target`而不是`this`更新复选框。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2020-05-24T13:07:37.837

我有非常简单的方法。这可能对其他人有用，因为它帮助了我。它是......当您为多个元素/变量分配了相同的功能并且您想要传递引用时，最简单的解决方案是......

```
function Name()
{

this.methodName = "Value"

} 
```

就是这样。它对我有用。 ***很简单。***

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2022-02-03T07:27:34.797

我建议你做这样的事情：

```
var someVar = some_other_function();
someObj.addEventListener("click", (event, param1 = someVar) => {
    some_function(param1);
}, false); 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2014-05-13T16:06:10.150

其他替代方案，可能不如使用 bind 优雅，但它对循环中的事件有效

```
for (var key in catalog){
    document.getElementById(key).my_id = key
    document.getElementById(key).addEventListener('click', function(e) {
        editorContent.loadCatalogEntry(e.srcElement.my_id)
    }, false);
} 
```

它已针对 google chrome 扩展进行了测试，在其他浏览器中可能必须将 e.srcElement 替换为 e.source

[我使用Imatoria](https://stackoverflow.com/users/279755/imatoria)发布的[评论](https://stackoverflow.com/questions/256754/how-to-pass-arguments-to-addeventlistener-listener-function#comment7616286_256763)找到了此解决方案，但我无法将其标记为有用，因为我没有足够的声誉：D

* * *

## 回答 #33

> 赞同：-2
> 
> 时间：2018-11-06T19:54:12.263

该解决方案可能适合寻找

```
var some_other_function = someVar => function() {
}

someObj.addEventListener('click', some_other_function(someVar)); 
```

或绑定变量也会很好

# javascript - 是否有资源可以帮助将 Prototype JavaScript 转换为 jQuery？

> ID：256768
> 
> 赞同：3
> 
> 时间：2008-11-02T11:01:06.740
> 
> 标签：javascript, jquery, asp.net, visual-studio, prototypejs

我以前广泛使用过 Prototype，它帮助我们为 Web 应用程序增加了相当多的交互性。然而，我们正在考虑使用 jQuery 来标准化 Visual Studio 中更好支持的东西。

我知道我们可以使用 jQuery.noConflict 与 Prototype 一起运行它，但我们希望避免让用户需要下载这两个库才能使用我们的网站。

那么，有没有什么好的资源可以帮助我们将旧脚本从 Prototype 迁移到 jQuery 中呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T12:36:27.890

对于您的问题，我真的无法为您提供太多帮助，除了说我还没有听说过任何这样的工具，如果真的存在，我会感到非常惊讶。

虽然我认为 jQuery 是一个很棒的库，而且您只想使用一个库是对的，但请记住，更改所有脚本的成本将是很多小时的工作。您的用户下载额外 30kb 脚本的成本大约为 0.3 秒。也许尝试慢慢地逐步淘汰 Prototype，只在 a) 必须这样做或 b) 没有更好的事情可做时重构现有页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T15:29:19.320

法尔凯恩，

没有可用于将针对一个 JS 库编写的 JavaScipt 代码转换为另一个的自动化过程。而且不可能有一个。不同的库实现不同的编程模型，并以不同的方式排列 API。

因此，在您找到问题的解决方案之前，现在问自己一个问题：一旦另一个更“酷”的“X-type”JavaScript 库可用，我是否要转换我的 jQuery 代码？如果您的答案是否定的，请花点时间手动转换代码，无论需要多长时间。如果您回答“是”，则根本不要转换代码。

就这样。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-04T03:38:23.357

谢谢你们的意见。我一直在寻找更多的语法比较，而不是任何自动化的东西，但 nickf 提出了一个很好的观点，即实际成本不必太大。我们只在几个真正需要高度交互性的页面上使用了 Prototype，所以只要注意 Ps 和 Qs，在其他地方使用 jQuery 应该不会有什么坏处。

# mysql - 使用文件系统与 RDMBS (MySQL) 进行并发处理

> ID：256791
> 
> 赞同：1
> 
> 时间：2008-11-02T11:32:59.950
> 
> 标签：mysql, concurrency, dictionary, filesystems

我正在构建一个英语网络词典，用户可以在其中输入单词并获取定义。我考虑了一段时间，因为数据是 100% 静态的，而且我一次只能检索一个单词，所以最好使用文件系统 (ext3) 作为数据库系统，而不是选择使用 MySQL 来存储定义。考虑到您必须连接到 MySQL 并且这本身是一个非常缓慢的操作，我认为开销会更少。

我担心的是，如果我的系统受到 500 字检索/秒的轰炸，我还是将文件系统用作数据库会更好吗？或者增加的文件系统读取会阻碍性能，而不是 MySQL 可能在幕后做的事情？

目前，层次结构由单词的第一个字母、第二个字母和第三个字母分割。因此，如果您要搜索“水”的定义，脚本 (PHP) 将尝试从“../dict/w/a/t/water.word”中读取（在清理有问题的单词和小写）

我是朝着正确的方向前进还是有更快的解决方案（不计算使用 memcached 之类的东西在内存中存储定义）？存储在任何目录中的文件数量是否会影响性能？我应该在目录中存储的文件数量的粗略基准是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T11:58:33.987

你有什么理由相信这个决定对解决方案的整体性能很重要？除了提供定义之外，它还能做什么？

无论如何，您是否将 MySQL 作为解决方案的一部分，或者如果您在此处选择它作为解决方案，您是否需要添加它？

定义的权威来源在哪里？（可能是复制的）文件系统，还是一些离线数据库？

从架构上看，这似乎应该存在于数据库中 - 文件系统是将大量名称映射到值的一个奇怪地方（正如您的文件系统结构通过首字母分解事物所证明的那样）

如果它在数据库中，回答诸如“有多少定义？”之类的问题。容易得多，但是如果您不关心应用程序的这些事情，这可能无关紧要。

因此，在某种程度上，这感觉像是在寻求超级优化某些性能实际上不会对整体解决方案产生太大影响的东西的性能。

我是“让它正确，然后让它快速”的粉丝，而“正确”会更直接地通过 DB 实现。

当然，最终的答案是两者都尝试，看看哪一个最适合你的情况。

保罗

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T11:36:34.640

字典需要的查找类型正是数据库擅长的。我认为您描述的文件系统方法将不可行。不要太难了！使用数据库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T11:44:14.687

您可以保留一个连接池以加快连接到数据库的速度。

此外，如果此应用程序需要扩展到多台服务器，则文件系统可能难以在服务器之间共享。

所以，我第三个建议。使用数据库。

但是除非它是一个非常大的字典，否则缓存将意味着您几乎总是从本地内存中获取内容，所以我认为这不会成为您的应用程序的最大问题 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T11:40:20.543

DB 听起来非常适合您的需求。我也不明白为什么 memcached 是相关的（你的数据有多大？不能超过几 GB ......对吗？）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T11:49:35.610

数据大约为几 GB。我的目标是速度、速度、速度（将使用 XHR 加载定义）。正如我所说的，数据是静态的，永远不会改变，除了每个请求的单个读取操作之外，我在任何地方都不会使用其他任何东西。所以我很难说服使用 MySQL 及其所有的臃肿。

使用这种策略，文件系统或 MySQL 在高负载下哪个会首先失败？至于扩展复制是答案，因为数据永远不会改变并且只有几 GB。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-02T12:01:25.870

先让它工作。过早的优化是不好的。

使用数据库可以更轻松地重构您的模式，并且您不必编写基于索引的查找的实现，这实际上是不平凡的。

说连接到数据库“是一个非常缓慢的操作”夸大了问题。实际上连接不应该花费很长时间，而且无论如何您都可以重用连接。

如果您担心读取扩展，1G 的数据库非常小，因此您可以将它的只读副本推送到每个 Web 服务器，并且它们都可以从本地副本中读取。如果写入保持在不影响读取性能的水平，这将为您提供几乎完美的读取可扩展性。

此外，1G 的数据很容易放入内存中，因此您可以通过在启动时将整个数据库加载到内存中来加快速度（在该节点向负载均衡器通告自己之前）。

每秒 500 次查找是微不足道的。也许我会开始担心每台服务器每秒大约 5000 个。如果您无法在现代硬件上实现每秒 5000 次键查找（来自适合 RAM 的数据库？！！），那么您的实现存在严重错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-02T12:16:04.013

同意这是过早的优化，并且 MySQL 肯定会为这个用例提供足够的性能。我必须补充一点，您还可以使用基于文件的数据库，例如非常快速的[Tokyo Cabinet](http://sourceforge.net/projects/tokyocabinet/)作为折衷方案。遗憾的是它没有 PHP 绑定，因此您可以使用它的祖父[DBM](http://php.net/manual/en/ref.dba.php)。

也就是说，不要使用文件系统，据我所知，没有充分的理由这样做。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-01T17:53:47.213

在您的 ram 中使用虚拟驱动器（谷歌它以了解如何为您的发行版），或者如果您的数据由 PHP 提供，则使用 APC，memcache 可能适用于 mysql。就我个人而言，我不认为你在这里做的优化真的是你应该花时间的地方。每秒 500 个请求是巨大的，我认为使用 mysql 会为您以后提供更好的转发功能。我认为如果你想与竞争对手区分开来，你需要专注于功能而不是速度。也有一些关于网络 UI 的好讨论，服务器速度只是整个画面中的一个小因素。

祝你好运

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-14T19:43:09.063

您可能还会考虑使用 no-sql 数据库（如 riak、mongo 甚至 redis）来处理此类问题。它们都非常快，可以帮助您进行复制。在这样的实例中，Mysql 可能会过度杀伤且难以扩展，但其他实例具有一些强大的工具

# string - 什么定义了可以存储在字符串中的数据

> ID：256803
> 
> 赞同：1
> 
> 时间：2008-11-02T11:52:28.257
> 
> 标签：string, character

几天前，我问[为什么不能将二进制数据，例如 jpg 文件存储到字符串变量](https://stackoverflow.com/questions/242577/c-what-is-string-really-good-for)中。

我得到的大多数答案都说字符串用于文本信息，例如我现在正在写的内容。

什么被认为是文本数据？某种性质的字节代表一个jpg文件，这些字节可以用字符字节值表示……我想。因此，当我们说字符串用于文本信息时，是否存在某种未存储的字符范围或字符列表？

对不起，如果这个问题听起来很傻。只是想“得到它”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T12:03:46.270

我发现在字符串中存储二进制数据的三个主要问题：

1.  大多数系统在字符串变量中假设某种编码 - 例如，如果它是 UTF-8、UTF-16 或 ASCII 字符串。根据您的系统，换行符也可能会被翻译。
2.  您应该注意对字符串大小的限制。
3.  如果您使用 C 样式字符串，则数据中的每个空字符都将终止该字符串，并且执行的任何字符串操作仅对第一个空字符之前的字节有效。
4.  也许最重要的是：它令人困惑——其他开发人员不希望在字符串变量中找到随机二进制数据。当遇到二进制数据时，许多*适用*于字符串的代码也可能会变得非常困惑:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T12:23:54.903

我更愿意将二进制数据存储为二进制，只有在别无选择时才会考虑将其转换为文本，因为当您将其转换为文本表示时，它确实会浪费一些字节（不多，但仍然很重要），就是这样他们将附件放入电子邮件中。

[Base64](http://en.wikipedia.org/wiki/Base64)是二进制文件的良好文本表示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T12:02:46.223

我认为您指的是[二进制到文本编码问题](http://en.wikipedia.org/wiki/Binary-to-text_encoding)。（将 jpg 转换为字符串需要这种预处理）

确实，在那篇文章中，提到了一些字符并不总是受支持，其他字符可能会令人困惑：

> 有些系统可以处理的字符集比较有限；它们不仅不是 8 位干净的，有些甚至无法处理每个可打印的 ASCII 字符。
> 其他人对换行符之间可能出现的字符数有限制。
> 还有一些人在文本中添加标题或预告片。
> 
> 一些不受欢迎但仍在使用的协议使用带内信令，如果消息中出现特定模式，则会导致混乱。最著名的是行首的字符串“From”（包括尾随空格），用于分隔 mbox 文件格式的邮件消息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-02T12:06:56.560

谁告诉你不能将“二进制”数据放入字符串中是错误的。字符串仅表示您最有可能计划用于文本数据的字节数组……但没有什么能阻止您将任何数据放入其中。

不过我必须要小心，因为我不知道您使用的是什么语言......并且在某些语言中 \0 结束了字符串。

在 C# 中，您可以将任何数据放入字符串中...例如：

```
byte[] myJpegByteArray = GetBytesFromSomeImage();

string myString = Encoding.ASCII.GetString(myJpegByteArray); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T14:06:35.867

在国际化之前，它并没有太大的区别。ASCII 字符都是字节，因此字符串、字符数组和字节数组最终具有相同的实现。

然而，如今，为了处理成千上万的外语字符和与之相关的语言规则，字符串变得更加复杂。

当然，如果你看得足够深入，一切都只是位和字节，但计算机如何解释它们是天壤之别。“文本”的规则使事物在显示给人类时看起来是正确的，但计算机可以随意使用内部表示。例如，

*   [在 Unicode 中，有许多编码系统。](http://www.joelonsoftware.com/articles/Unicode.html) 在它们之间进行更改会使每个字节都不同。
*   某些语言具有[多个在语言上等效的字符](http://blogs.msdn.com/anutthara/archive/2005/12/04/499994.aspx)。这些可以在您最不期望的时候来回切换。
*   有不同的方法来结束一行文本。 [CRLF 和 LF 之间的意外转换会破坏二进制文件。](http://svnbook.red-bean.com/en/1.5/svn.forcvs.binary-and-trans.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-02T12:00:46.667

取决于语言。例如，在 Python 中，字符串类型 (str) 是真正的字节数组，因此它们确实可以用于二进制数据。

在 C 中，NULL 字节用于字符串终止，因此字符串不能用于任意二进制数据，因为二进制数据可能包含空字节。

在 C# 中，字符串是一个字符数组，由于 char 基本上是 16 位 int 的别名，因此您可能可以在字符串中存储任意二进制数据。当您尝试显示字符串时，您可能会遇到错误（因为某些值实际上可能不对应于合法的 unicode 字符），并且某些操作（如大小写转换）可能会以奇怪的方式失败。

简而言之，在某些语言中可能可以将任意二进制数据存储在字符串中，但它们不是为这种用途而设计的，您可能会遇到各种无法预料的麻烦。大多数语言都有用于存储任意二进制数据的字节数组类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-02T12:00:54.513

在内心深处，一切都只是字节。字符串和图片之类的东西是由有关如何排序字节的规则定义的。例如，字符串以值为 32（或其他值）的字节结尾 jpg's don't

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-02T12:18:01.733

我同意[Jacobus 的](https://stackoverflow.com/questions/256803/what-defines-data-that-can-be-stored-in-strings#256813)回答：最终所有的数据结构都是由字节组成的。（好吧，如果你更深入：位）。通过一些抽象，您可以说字符串或字节数组是程序员关于如何访问它们的约定。

在这方面，字符串是解释为文本的数据的抽象。文本是为人类之间的交流而发明的，计算机或程序不能很好地使用文本进行交流。SQL 是文本的，但它是人类告诉数据库该做什么的接口。

因此，一般而言，文本数据以及字符串主要用于人与人之间或人与机器之间的交互（例如消息框的内容）。将它们用于其他事情（例如读取或写入二进制图像数据）是可能的，但会带来很多风险，因为您正在将数据类型用于它不是设计用于处理的事情。这使得它更容易出错。您可能能够将二进制数据存储在字符串中，但是仅仅因为您能够在脚上开枪，您应该避免这样做。

摘要：你可以做到。但你最好不要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-02T12:18:16.613

您最初的问题（[c# - What is string really good for?](https://stackoverflow.com/questions/242577/c-what-is-string-really-good-for)）意义不大。所以答案也没有意义。

您最初的问题是“由于某种原因，当我将此字符串写入文件时，它不会打开。” 这并不意味着什么。

您最初的问题不完整，答案具有误导性和混淆性。您可以将任何内容存储在字符串中。时期。“字符串用于文本”的答案在那里，因为您没有在问题中提供足够的信息来确定您的特定 C# 代码出了什么问题。

您没有提供代码片段或错误消息。这就是为什么很难“得到它”——你没有提供足够的细节让我们知道你没有得到什么。

# c# - 企业库中的 SQL 自定义函数

> ID：256804
> 
> 赞同：1
> 
> 时间：2008-11-02T11:54:52.590
> 
> 标签：c#, .net, sql-server, enterprise-library

有没有办法使用 Enterprise Library 执行 SQL 自定义函数？我试过 Database.ExecuteScalar() 但由于某种原因它返回 null。

这是我的功能：

```
Database db = DatabaseFactory.CreateDatabase("ConnectionString");
DbCommand cmd = db.GetStoredProcCommand("FunctionName");
db.AddInParameter(cmd, "Value1", DbType.String, Param1Value);
db.AddInParameter(cmd, "Value2", DbType.String, Param2Value);
return Convert.ToBoolean(db.ExecuteScalar(cmd)); 
```

这里 db.ExecuteScalar(cmd) 方法返回 null。存储过程不会发生这种情况。

顺便说一句，我使用的是 4.0 版

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T12:33:15.943

您必须创建一个 select 语句，从函数中选择结果并执行它。

“选择 * FROM 函数名（@Value1，@Value2）”

或者您可以将您的函数调用包装在一个过程中并调用该过程，我更喜欢这个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T13:48:26.353

对于标量函数，它将是

```
SELECT FuncName(@Param1) 
```

而表值函数将是

```
SELECT * FROM FuncName(@Param1) 
```

# c# - 是否可以在 C# 中实现范围锁？

> ID：256806
> 
> 赞同：5
> 
> 时间：2008-11-02T11:56:22.790
> 
> 标签：c#, locking

C++ 中的一个常见模式是创建一个包装锁的类——锁要么在创建对象时隐式获取，要么在之后显式获取。当对象超出范围时，dtor 会自动释放锁。是否可以在 C# 中执行此操作？据我了解，不能保证 C# 中的 dtor 何时会在对象超出范围后运行。

澄清：一般的任何锁，自旋锁，ReaderWriterLock，等等。自己调用 Dispose 违背了模式的目的——一旦我们退出作用域就释放锁——无论我们是否在中间调用 return、抛出异常或诸如此类。此外，据我了解，使用仍然只会为 GC 排队对象，而不是立即销毁它......

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-02T12:23:58.787

为了放大蒂莫西的回答，lock 语句确实使用监视器创建了一个作用域锁。本质上，这转化为如下内容：

```
lock(_lockKey)
{
    // Code under lock
}

// is equivalent to this
Monitor.Enter(_lockKey)
try
{
     // Code under lock
}
finally
{
    Monitor.Exit(_lockKey)
} 
```

在 C# 中，您很少将 dtor 用于这种模式（请参阅 using 语句/IDisposable）。您可能在代码中注意到的一件事是，如果在 Monitor.Enter 和 try 之间发生异步异常，则看起来监视器不会被释放。JIT 实际上做了一个特殊的保证，即如果 Monitor.Enter 紧接在 try 块之前，则异步异常将在 try 块之前不会发生，从而确保释放。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-02T12:25:19.563

您的理解`using`是不正确的，这是一种以确定性方式发生作用域操作的方法（不会发生对 GC 的排队）。

C# 提供了`lock`提供排他锁的关键字，如果您想拥有不同的类型（例如读/写），则必须使用该`using`语句。

PS[这个线程](https://stackoverflow.com/questions/173670/why-is-there-no-raii-in-net)可能会让你感兴趣。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-02T12:03:37.190

确实，您并不确切知道 dtor 何时运行……但是，如果您实现 IDisposable 接口，然后使用“使用”块或自己调用“Dispose()”，您将有一个放置代码的地方。

问题：当您说“锁”时，您的意思是线程锁，以便一次只有一个线程可以使用该对象吗？如：

```
lock (_myLockKey) { ... } 
```

请澄清。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-02T14:29:16.740

为了完整起见，还有另一种方法可以在不使用`using`and的情况下实现类似的 RAII 效果`IDisposable`。在 C#`using`中通常更清晰（有关更多想法，另[请参阅此处](http://www.levelofindirection.com/journal/2009/9/24/raii-and-readability-in-c.html)），但在其他语言（例如 Java）中，甚至在 C# 中，如果`using`由于某种原因不合适，了解它是有用的。

这是一个叫做“Execute Around”的成语，想法是你调用一个方法来执行前和后的事情（例如锁定/解锁你的线程，或者设置和提交/关闭你的数据库连接等），然后你传入那个方法一个委托，它将实现您希望在两者之间发生的操作。

例如：

```
 funkyObj.InOut( delegate{ System.Console.WriteLine( "middle bit" ); } ); 
```

根据 InOut 方法的作用，输出可能类似于：

```
第一位
中间位
最后一点

```

正如我所说，这个答案只是为了完整性，之前的`using`with建议`IDisposable`以及`lock`关键字在 99% 的情况下都会更好。

遗憾的是，虽然 .Net 在这方面比许多其他现代 OO 语言（我在看你，Java）走得更远，但它仍然让 RAII 负责处理客户端代码（即使用`using`)，而在 C++ 中，析构函数将始终在作用域的末尾运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-04-03T11:59:12.670

为什么你首先想要一个作用域锁？假设您有以下代码：

```
lock(obj) {
    ... some logic goes here
} 
```

`try`如果在insert 的地方发生了异常`lock`，这通常意味着你现在有一个损坏的状态，其他线程将继续以损坏的状态工作。最好让程序挂起以发出有关问题的信号。

另一个问题是`try`会导致一些性能损失，但如果有的话，这通常是小得多的问题。

> Jeffrey Richter 特别建议不要使用`lock`语句。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-03T13:51:49.327

我一直被`using`开发人员记住要做的事实所困扰 - 充其量你会收到一个警告，大多数人从不费心将其提升为错误。所以，我一直在玩弄这样的想法——它迫使客户至少尝试正确地做事。幸运和不幸的是，它是一个闭包，所以客户端仍然可以保留资源的副本，并在以后尝试再次使用它 - 但这段代码至少试图将客户端推向正确的方向......

```
public class MyLockedResource : IDisposable
{
    private MyLockedResource()
    {
        Console.WriteLine("initialize");
    }

    public void Dispose()
    {
        Console.WriteLine("dispose");
    }

    public delegate void RAII(MyLockedResource resource);

    static public void Use(RAII raii)
    {
        using (MyLockedResource resource = new MyLockedResource())
        {
            raii(resource);
        }
    }

    public void test()
    {
        Console.WriteLine("test");
    }
} 
```

很好的用法：

```
MyLockedResource.Use(delegate(MyLockedResource resource)
{
    resource.test();
}); 
```

使用不当！（不幸的是，这是无法避免的......）

```
MyLockedResource res = null;
MyLockedResource.Use(delegate(MyLockedResource resource)
{
    resource.test();
    res = resource;
    res.test();
});
res.test(); 
```

# c++ - 检查数组索引是否存在

> ID：256807
> 
> 赞同：4
> 
> 时间：2008-11-02T11:56:39.030
> 
> 标签：c++, arrays

有没有办法检查数组的给定索引是否存在？我正在尝试设置数字索引，但类似于 1、5、6,10。所以我想看看这些索引是否已经存在，以及它们是否只是增加了另一个计数器。

我通常使用 php，但我正在尝试在 c++ 中执行此操作，所以基本上我想问是否有 isset() 方法可以与 c++ 一起使用

PS：使用向量会更容易吗？如果是这样，谁能指出我一个好的矢量教程？谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-02T12:08:42.827

在 C++ 中，数组的大小在声明时是固定的，虽然您可以访问声明的数组大小的末尾，但这是非常危险的，也是难以追踪的错误的根源：

```
int i[10];
i[10] = 2; // Legal but very dangerous! Writing on memory you don't know about 
```

似乎您想要类似数组的行为，但没有填充所有元素。传统上，这是在哈希表领域。向量在这里不是一个很好的解决方案，因为你会有空元素占用空间，更好的是像地图，你可以通过搜索并解释结果来测试元素是否存在：

```
#include <map>
#include <string>

// Declare the map - integer keys, string values    
std::map<int, std::string> a;

// Add an item at an arbitrary location
a[2] = std::string("A string");

// Find a key that isn't present
if(a.find(1) == a.end())
{
   // This code will be run in this example
   std::cout << "Not found" << std::endl;
}
else
{
   std::cout << "Found" << std::endl;
} 
```

警告一句话：使用上述方法查找键是否存在，而不是像测试默认值这样的方法

```
if(a[2] == 0)
{
    a[2] = myValueToPutIn;
} 
```

因为映射的行为是在第一次访问该键值时插入一个默认构造对象，如果当前没有任何内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T12:00:56.370

我个人的投票是使用矢量。它们会动态调整大小，只要你不做一些愚蠢的事情（比如尝试访问不存在的元素），它们使用起来非常友好。

至于教程，我可以为您指出的最好的方法是[谷歌搜索](http://www.google.com.au/search?q=C%2B%2B+vector+tutorial)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-07-17T09:01:05.940

要在没有向量的情况下执行此操作，您可以简单地交叉检查要访问的索引与数组的大小。喜欢：`if(index < array_size)`它是无效的索引。

如果您不知道大小，您可以使用`sizeof`运算符找到它。

例如：

```
int arr[] = {5, 6, 7, 8, 9, 10, 1, 2, 3};
int arr_size = sizeof(arr)/sizeof(arr[0]); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T18:08:24.520

对我来说，这听起来好像真的地图最接近你想要的。您可以使用 STL（标准模板库）（[http://www.cppreference.com/wiki/stl/map/start](http://www.cppreference.com/wiki/stl/map/start)）中的 Map 类。

地图为可以通过键（您的“索引”）引用的对象提供了一个容器。

# html - 如何在没有两组滚动条的 HTML 页面顶部创建非滚动 div

> ID：256811
> 
> 赞同：19
> 
> 时间：2008-11-02T11:59:40.443
> 
> 标签：html, ribbon, non-scrolling

如何在没有两组滚动条的网页上创建看起来像 MS Office 2007 功能区的非滚动 div。一个用于窗口，一个用于 div。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-03T15:20:45.263

尝试这个：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Fixed Header/Full Page Content</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style type="text/css">
            body,
            div {
                margin: 0;
                padding: 0;
            }

            body {
                /* Disable scrollbars and ensure that the body fills the window */
                overflow: hidden;
                width: 100%;
                height: 100%;
            }

            #header {
                /* Provide scrollbars if needed and fix the header dimensions */
                overflow: auto;
                position: absolute;
                width: 100%;
                height: 200px;
            }

            #main {
                /* Provide scrollbars if needed, position below header, and derive height from top/bottom */
                overflow: auto;
                position: absolute;
                width: 100%;
                top: 200px;
                bottom: 0;
            }
        </style>
    </head>
    <body>
        <div id="header">HEADER</div>
        <div id="main">
            <p>FIRST</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>MAIN</p>
            <p>LAST</p>
        </div>
<!--[if lt IE 7]>
        <script type="text/javascript">
            var elMain = document.getElementById('main');

            setMainDims();
            document.body.onresize = setMainDims;

            function setMainDims() {
                elMain.style.height = (document.body.clientHeight - 200) + 'px';
                elMain.style.width = '99%'
                setTimeout("elMain.style.width = '100%'", 0);
            }
        </script>
<![endif]-->
    </body>
</html> 
```

基本上，您所做的是从正文中删除滚动条并将滚动条应用于文档内的元素。这很简单。诀窍是让`#main`div 调整大小以填充标题下方的空间。在大多数浏览器中，这是通过设置 the`top`和`bottom`位置并保持未设置来完成的`height`。结果是 div 的顶部固定在 header 下方，而 div 的底部将始终拉伸到屏幕底部。

当然，那里总是有 IE6 来确保我们获得薪水。在版本 7 之前，IE 不会从冲突的绝对位置派生尺寸。 [有些人](http://www.alistapart.com/articles/conflictingabsolutepositions)使用 IE 的 css 表达式来解决 IE6 的这个问题，但是这些表达式在每次鼠标移动时都会计算，所以我只是`#main`在 resize 事件上调整 div 的大小，并使用条件注释从其他浏览器隐藏该 javascript 块。

将宽度设置为 99% 的行和将其设置回 100% 的 setTimeout 修复了 IE6 中的一点渲染异常，导致在调整窗口大小时偶尔会出现水平滚动条。

*注意：您必须使用 doctype 并使 IE 退出 quirks 模式。*

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-02T12:14:24.173

使用具有 100% 宽度和高度的固定位置`<div>`元素`z-index`。

您还需要确保滚动内容的开头不会被 fixed 遮挡`<div>`，直到您开始向下滚动，方法是将它放在另一个中`<div>`并适当地定位它。

```
<body>
    <div style="position: fixed; top: 0px; width:100%; height: 100px;">
        HEader content goes here
    </div>
    <div style="margin-top: 100px;">
        Main content goes here
    </div>
</body> 
```

请注意第一个的高度`<div>`和第二个的上边距，需要根据您的需要进行调整。

PS 这在 IE7 中不起作用，出于某种原因，但它是一个很好的起点，我相信您可以在这个主题上做出一些变化，以您想要的方式工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-04T09:03:56.240

我可能会在这里受到 CSS 纯粹主义者的抨击，但是使用 100% 宽度和高度的表格可以在任何浏览器中使用，并且不需要特定于浏览器的 CSS hack。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T12:52:16.467

您也可以使用

```
 <div style='position:absolute;top:0px:left:0px;'>Text</div>; 
```

它会堵塞页面顶部的 div，但如果您的页面向下滚动，它将停留在那里。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-03T11:40:11.200

Belugabob 有正确的想法，即您尝试做的是固定定位，这是 IE 6 不支持的。

[我修改了本教程](http://www.howtocreate.co.uk/fixedPosition.html)底部的一个示例，除了所有优秀的浏览器之外，它应该可以满足您的需求并支持 IE 6+。它之所以有效，是因为 IE 允许您将 Javascript 放入样式声明中：

```
<style type="text/css">
  div#fixme {
    width: 100%; /* For all browsers */
  }
  body > div#fixme {
    position: fixed; /* For good browsers */
  }
</style>

<!--[if gte IE 5.5]>
<![if lt IE 7]>
<style type="text/css">
  div#fixme {
    /* IE5.5+/Win - this is more specific than the IE 5.0 version */
    right: auto; bottom: auto;
    left: expression( ( 0 - fixme.offsetWidth + ( document.documentElement.clientWidth ? document.documentElement.clientWidth : document.body.clientWidth ) + ( ignoreMe2 = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft ) ) + 'px' );
    top: expression( ( 0 - fixme.offsetHeight + ( document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );
  }
</style>
<![endif]>
<![endif]-->

<body>
  <div id="fixme"> ... 
```

# ruby-on-rails - 如何在 ruby 中使用 utf8 的正则表达式

> ID：256822
> 
> 赞同：11
> 
> 时间：2008-11-02T12:06:18.387
> 
> 标签：ruby-on-rails, ruby, regex, utf-8

在 RoR 中，如何验证带有 utf8 代码的张贴表单的中文或日文单词。

在GBK代码中，它使用[\u4e00-\u9fa5]+来验证中文单词。在 PHP 中，它使用 /^[\x{4e00}-\x{9fa5}]+$/u 来处理 utf-8 页面。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-02T12:36:03.023

Ruby 1.8 对 UTF-8 字符串的支持很差。您需要在正则表达式中单独写入字节，而不是完整的代码：

```
>> "acentuação".scan(/\xC3\xA7/)
=> ["ç"] 
```

要匹配您指定的范围，表达式会变得有点复杂：

```
/([\x4E-\x9E][\x00-\xFF])|(\x9F[\x00-\xA5])/  # (untested) 
```

[不过，这将在 Ruby 1.9 中得到改进](http://books.google.com.br/books?id=jcUbTcr5XWwC&pg=PA50&lpg=PA50&source=web&ots=fHClxbbxcy&sig=up3TxmEM9C3N1K8hf-nnBQDzPUQ&hl=en&sa=X&oi=book_result&resnum=6&ct=result)。

*编辑：*如评论中所述，unicode 字符 \u4E00-\u9FA5 仅映射到 UTF16-BE 编码中的上述表达式。UTF8 编码可能不同。因此，您需要仔细分析映射，看看是否可以为 Ruby 1.8 提供字节匹配表达式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-28T19:06:48.003

这就是我所做的：

```
%r{^[#{"\344\270\200"}-#{"\351\277\277"}]+$} 
```

这基本上是一个正则表达式，其八进制值表示 U+4E00 和 U+9FFF 之间的范围，这是最常见的中文和日文字符。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-03T00:20:16.983

The [Oniguruma](https://github.com/stedolan/jq/wiki/Docs-for-Oniguruma-Regular-Expressions-(RE.txt) "Oniguruma") regexp engine has proper support for Unicode. Ruby 1.9 uses Oniguruma by default. Ruby 1.8 can be recompiled to use it.

With Oniguruma you can use the exact same regex as in PHP, including the /u modifier to force Ruby to treat the string as UTF-8.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-02T12:57:16.707

activeSupport 有一个 UTF-8 处理程序

[http://api.rubyonrails.org/classes/ActiveSupport/Multibyte/Handlers/UTF8Handler.html](http://api.rubyonrails.org/classes/ActiveSupport/Multibyte/Handlers/UTF8Handler.html)

* * *

否则，请查看 ruby​​ 1.9，Regexp 对象的编码方法

# vba - 查找文本框/标签标题是否适合控件

> ID：256823
> 
> 赞同：1
> 
> 时间：2008-11-02T12:06:25.267
> 
> 标签：vba, excel

该场景试图调整字体大小以获得良好的图形排列，或者试图决定在哪里打破标题/副标题。a) 在 XL VBA 中，有没有办法找出文本框上的文本或标签上的标题是否仍然适合控件？b) 有没有办法知道多行控件上的文本/标题在哪里损坏？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T22:07:31.043

我休息了一下，给了它足够的脑后时间（这比“尽快打嗝，以获得学分”产生更好的结果），并且......

```
Function TextWidth(aText As String, Optional aFont As NewFont) As Single
    Dim theFont As New NewFont
    Dim notSeenTBox As Control

    On Error Resume Next 'trap for aFont=Nothing
    theFont = aFont 'try assign

    If Err.Number Then 'can't use aFont because it's not instantiated/set
        theFont.Name = "Tahoma"
        theFont.Size = 8
        theFont.Bold = False
        theFont.Italic = False
    End If
    On Error GoTo ErrHandler

    'make a TextBox, fiddle with autosize et al, retrive control width
    Set notSeenTBox = UserForms(0).Controls.Add("Forms.TextBox.1", "notSeen1", False)
    notSeenTBox.MultiLine = False
    notSeenTBox.AutoSize = True 'the trick
    notSeenTBox.Font.Name = theFont.Name
    notSeenTBox.SpecialEffect = 0
    notSeenTBox.Width = 0 ' otherwise we get an offset (a ""feature"" from MS)
    notSeenTBox.Text = aText
    TextWidth = notSeenTBox.Width
    'done with it, to scrap I say
    UserForms(0).Controls.Remove ("notSeen1")
    Exit Function

ErrHandler:
    TextWidth = -1
    MsgBox "TextWidth failed: " + Err.Description
End Function 
```

我觉得我正在/接近答案 b)，但我会让它再次思考……因为它比在一瞬间说出“不可能”更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T13:23:24.597

我确信没有办法使用表单工具栏上的普通 Excel 控件来执行此操作，尤其是因为（据我了解）它们只是绘图而不是完整的 Windows 控件。

最简单的方法可能是通过一些测试对每个控件的最大文本长度进行稍微保守的估计，并使用这些来管理换行符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-06-24T18:05:47.990

这可以通过利用标签或文本框的 .AutoSize 功能来实现，并循环显示字体大小，直到找到最适合的那个。

```
Public Sub ResizeTextToFit(Ctrl As MSForms.Label)   'or TextBox

    Const FONT_SHRINKAGE_FACTOR As Single = 0.9 'For more accuracy, use .95 or .99

    Dim OrigWidth As Single
    Dim OrigHeight As Single
    Dim OrigLeft As Single
    Dim OrigTop As Single

    With Ctrl
        If .Caption = "" Then Exit Sub
        .AutoSize = False
        OrigWidth = .Width
        OrigHeight = .Height
        OrigLeft = .Left
        OrigTop = .Top
        Do
            .AutoSize = True
            If .Width <= OrigWidth And .Height <= OrigHeight Then
                Exit Do     'The font is small enough now
            .Font.Size = .Font.Size * FONT_SHRINKAGE_FACTOR
            .AutoSize = False
        Loop
        .AutoSize = False
        .Width = OrigWidth
        .Height = OrigHeight
        .Left = OrigLeft
        .Top = OrigTop
    End With

End Sub 
```

# c# - C# - 用 DataTable 填充组合框

> ID：256832
> 
> 赞同：22
> 
> 时间：2008-11-02T12:17:51.000
> 
> 标签：c#, .net, combobox, datatable, sharpdevelop

我习惯于使用有大量示例可用的 Java。由于各种原因，我不得不切换到 C# 并尝试在 SharpDevelop 中执行以下操作：

```
// Form has a menu containing a combobox added via SharpDevelop's GUI

// --- Variables
languages = new string[2];
languages[0] = "English";
languages[1] = "German";
DataSet myDataSet = new DataSet();

// --- Preparation
DataTable lTable = new DataTable("Lang");
DataColumn lName = new DataColumn("Language", typeof(string));
lTable.Columns.Add( lName );
for( int i=0; i<languages.Length; i++ ) {
    DataRow lLang = lTable.NewRow();
    lLang["Language"] = languages[i];
    lTable.Rows.Add(lLang);
}
myDataSet.Tables.Add(lTable);

// --- Handling the combobox
mnuActionLanguage.ComboBox.DataSource = myDataSet.Tables["Lang"].DefaultView;
mnuActionLanguage.ComboBox.DisplayMember = "Language"; 
```

有人会假设在下拉列表中看到一些值，但它是空的。请告诉我我做错了什么;(

*编辑： mnuActionLanguage.ComboBox.DataBind() 是我在网上也找到的，但在我的情况下它不起作用。*

**解决方案**

```
mnuActionLanguage.ComboBox.BindingContext = this.BindingContext; 
```

最后解决了问题！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-02T12:54:09.960

You need to set the binding context of the ToolStripComboBox.ComboBox.

Here is a slightly modified version of the code that I have just recreated using Visual Studio. The menu item combo box is called toolStripComboBox1 in my case. Note the last line of code to set the binding context.

I noticed that if the combo is in the visible are of the toolstrip, the binding works without this but not when it is in a drop-down. Do you get the same problem?

If you can't get this working, drop me a line via my contact page and I will send you the project. You won't be able to load it using SharpDevelop but will with C# Express.

```
var languages = new string[2];
languages[0] = "English";
languages[1] = "German";

DataSet myDataSet = new DataSet();

// --- Preparation
DataTable lTable = new DataTable("Lang");
DataColumn lName = new DataColumn("Language", typeof(string));
lTable.Columns.Add(lName);

for (int i = 0; i < languages.Length; i++)
{
    DataRow lLang = lTable.NewRow();
    lLang["Language"] = languages[i];
    lTable.Rows.Add(lLang);
}
myDataSet.Tables.Add(lTable);

toolStripComboBox1.ComboBox.DataSource = myDataSet.Tables["Lang"].DefaultView;
toolStripComboBox1.ComboBox.DisplayMember = "Language";

toolStripComboBox1.ComboBox.BindingContext = this.BindingContext; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-04-14T07:36:43.660

```
string strConn = "Data Source=SEZSW08;Initial Catalog=Nidhi;Integrated Security=True";
SqlConnection Con = new SqlConnection(strConn);
Con.Open();
string strCmd = "select companyName from companyinfo where CompanyName='" + cmbCompName.SelectedValue + "';";
SqlDataAdapter da = new SqlDataAdapter(strCmd, Con);
DataSet ds = new DataSet();
Con.Close();
da.Fill(ds);
cmbCompName.DataSource = ds;
cmbCompName.DisplayMember = "CompanyName";
cmbCompName.ValueMember = "CompanyName";
//cmbCompName.DataBind();
cmbCompName.Enabled = true; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-11-06T13:11:10.003

For example, i created a table :

```
DataTable dt = new DataTable ();
dt.Columns.Add("Title", typeof(string));
dt.Columns.Add("Value", typeof(int)); 
```

Add recorde to table :

```
DataRow row = dt.NewRow();
row["Title"] = "Price"
row["Value"] = 2000;
dt.Rows.Add(row); 
```

or :

```
dt.Rows.Add("Price",2000); 
```

finally :

```
combo.DataSource = dt;
combo.DisplayMember = "Title";
combo.ValueMember = "Value"; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-02T12:49:20.250

Are you applying a RowFilter to your DefaultView later in the code? This could change the results returned.

I would also avoid using the string as the display member if you have a direct reference the the data column I would use the object properties:

```
mnuActionLanguage.ComboBox.DataSource = lTable.DefaultView;
mnuActionLanguage.ComboBox.DisplayMember = lName.ColumnName;
```

I have tried this with a blank form and standard combo, and seems to work for me.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T12:35:56.797

几点：

1) "DataBind()" 仅适用于 Web 应用程序（不是 Windows 应用程序）。

2）你的代码看起来很“JAVAish”（不是坏事，只是观察）。

试试这个：

```
mnuActionLanguage.ComboBox.DataSource = languages; 
```

If that doesn't work... then I'm assuming that your datasource is being stepped on somewhere else in the code.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-02T12:23:28.070

这条线

```
mnuActionLanguage.ComboBox.DisplayMember = "Lang.Language"; 
```

是错的。将其更改为

```
mnuActionLanguage.ComboBox.DisplayMember = "Language"; 
```

它会工作（即使没有 DataBind()）。

# java - for 循环和 for-each 循环之间是否存在性能差异？

> ID：256859
> 
> 赞同：198
> 
> 时间：2008-11-02T12:40:53.183
> 
> 标签：java, performance, for-loop

以下两个循环之间的性能差异是什么（如果有的话）？

```
for (Object o: objectArrayList) {
    o.DoSomething();
} 
```

和

```
for (int i=0; i<objectArrayList.size(); i++) {
    objectArrayList.get(i).DoSomething();
} 
```

* * *

## 回答 #1

> 赞同：219
> 
> 时间：2008-11-02T12:47:22.530

来自Joshua Bloch在[Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)中的第 46条：

> 在 1.5 版中引入的 for-each 循环通过完全隐藏迭代器或索引变量来消除混乱和出错的机会。由此产生的习语同样适用于集合和数组：
> 
> ```
> // The preferred idiom for iterating over collections and arrays
> for (Element e : elements) {
>     doSomething(e);
> } 
> ```
> 
> 当您看到冒号 (:) 时，将其读作“in”。因此，上面的循环读作“对于元素中的每个元素 e”。请注意，使用 for-each 循环没有性能损失，即使是数组也是如此。事实上，在某些情况下，它可能比普通的 for 循环提供轻微的性能优势，因为它只计算一次数组索引的限制。虽然您可以手动完成（第 45 条），但程序员并不总是这样做。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-11-02T16:10:44.990

所有这些循环都完全相同，我只想在投入两分钱之前展示这些。

一、循环遍历List的经典方式：

```
for (int i=0; i < strings.size(); i++) { /* do something using strings.get(i) */ } 
```

其次，首选方式，因为它不易出错（您做过多少次“哎呀，在循环中的这些循环中混合变量 i 和 j”的事情？）。

```
for (String s : strings) { /* do something using s */ } 
```

三、微优化的for循环：

```
int size = strings.size();
for (int i = -1; ++i < size;) { /* do something using strings.get(i) */ } 
```

现在实际的两美分：至少在我测试这些时，第三个是最快的，以毫秒计算每种类型的循环所需的时间，其中一个简单的操作重复了几百万次 - 这是使用 Java 5如果有人感兴趣，请在 Windows 上使用 jre1.6u10。

虽然至少看起来第三个是最快的，但你真的应该问自己是否愿意冒险在循环代码中到处实现这种窥视孔优化，因为从我所见，实际循环不是'这通常是任何实际程序中最耗时的部分（或者我可能只是在错误的领域工作，谁知道呢）。而且就像我在 Java *for-each 循环*的借口中提到的那样（有些人将其称为*Iterator 循环*，其他人称为*for-in 循环*），您在使用它时不太可能遇到一个特定的愚蠢错误。在讨论这甚至比其他的更快之前，请记住 javac 根本不优化字节码（好吧，几乎完全没有），它只是编译它。

如果您正在进行微优化和/或您的软件使用大量递归循环等，那么您可能会对第三种循环类型感兴趣。只要记住在将 for 循环更改为这个奇怪的、微优化的循环之前和之后都对您的软件进行基准测试。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-02T13:07:58.120

通常应该首选 for-each 循环。如果您使用的 List 实现不支持随机访问，“get”方法可能会更慢。例如，如果使用 LinkedList，则会产生遍历成本，而 for-each 方法使用迭代器来跟踪其在列表中的位置。[有关for-each 循环](http://today.java.net/pub/a/today/2006/11/07/nuances-of-java-5-for-each-loop.html)的细微差别的更多信息。

我想这篇文章现在在这里： [新位置](https://community.oracle.com/docs/DOC-983591)

此处显示的链接已失效。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-24T02:13:53.493

嗯，性能影响大多是微不足道的，但不是零。如果您查看`RandomAccess`接口的JavaDoc：

> 根据经验，如果对于类的典型实例，如果出现以下循环，则 List 实现应该实现此接口：
> 
> ```
> for (int i=0, n=list.size(); i < n; i++)
>     list.get(i); 
> ```
> 
> 运行速度比这个循环快：
> 
> ```
> for (Iterator i=list.iterator(); i.hasNext();)
>       i.next(); 
> ```

并且 for-each 循环使用带有迭代器的版本，`ArrayList`例如，for-each 循环不是最快的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-09-26T20:57:58.010

不幸的是，似乎有所不同。

如果您查看为这两种循环生成的字节代码，它们是不同的。

这是来自 Log4j 源代码的示例。

在 /log4j-api/src/main/java/org/apache/logging/log4j/MarkerManager.java 我们有一个名为 Log4jMarker 的静态内部类，它定义：

```
 /*
     * Called from add while synchronized.
     */
    private static boolean contains(final Marker parent, final Marker... localParents) {
        //noinspection ForLoopReplaceableByForEach
        for (final Marker marker : localParents) {
            if (marker == parent) {
                return true;
            }
        }
        return false;
    } 
```

使用标准循环：

```
 private static boolean contains(org.apache.logging.log4j.Marker, org.apache.logging.log4j.Marker...);
    Code:
       0: iconst_0
       1: istore_2
       2: aload_1
       3: arraylength
       4: istore_3
       5: iload_2
       6: iload_3
       7: if_icmpge     29
      10: aload_1
      11: iload_2
      12: aaload
      13: astore        4
      15: aload         4
      17: aload_0
      18: if_acmpne     23
      21: iconst_1
      22: ireturn
      23: iinc          2, 1
      26: goto          5
      29: iconst_0
      30: ireturn 
```

对于每个：

```
 private static boolean contains(org.apache.logging.log4j.Marker, org.apache.logging.log4j.Marker...);
    Code:
       0: aload_1
       1: astore_2
       2: aload_2
       3: arraylength
       4: istore_3
       5: iconst_0
       6: istore        4
       8: iload         4
      10: iload_3
      11: if_icmpge     34
      14: aload_2
      15: iload         4
      17: aaload
      18: astore        5
      20: aload         5
      22: aload_0
      23: if_acmpne     28
      26: iconst_1
      27: ireturn
      28: iinc          4, 1
      31: goto          8
      34: iconst_0
      35: ireturn 
```

那个甲骨文怎么了？

我已经在 Windows 7 上使用 Java 7 和 8 进行了尝试。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-03T08:22:38.510

foreach 使您的代码的意图更清晰，并且通常比非常小的速度改进更可取 - 如果有的话。

每当我看到一个索引循环时，我都必须对其进行更长时间的解析，以确保它完成我*认为*它所做的事情。例如它是否从零开始，它是否包含或排除终点等？

我的大部分时间似乎都花在阅读代码（我编写的或其他人编写的）上，而清晰性几乎总是比性能更重要。现在很容易忽视性能，因为 Hotspot 做得如此出色。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-08-28T21:53:42.170

以下代码：

```
import java.lang.reflect.Array;
import java.util.ArrayList;
import java.util.List;

interface Function<T> {
    long perform(T parameter, long x);
}

class MyArray<T> {

    T[] array;
    long x;

    public MyArray(int size, Class<T> type, long x) {
        array = (T[]) Array.newInstance(type, size);
        this.x = x;
    }

    public void forEach(Function<T> function) {
        for (T element : array) {
            x = function.perform(element, x);
        }
    }
}

class Compute {
    int factor;
    final long constant;

    public Compute(int factor, long constant) {
        this.factor = factor;
        this.constant = constant;
    }

    public long compute(long parameter, long x) {
        return x * factor + parameter + constant;
    }
}

public class Main {

    public static void main(String[] args) {
        List<Long> numbers = new ArrayList<Long>(50000000);
        for (int i = 0; i < 50000000; i++) {
            numbers.add(i * i + 5L);
        }

        long x = 234553523525L;

        long time = System.currentTimeMillis();
        for (int i = 0; i < numbers.size(); i++) {
            x += x * 7 + numbers.get(i) + 3;
        }
        System.out.println(System.currentTimeMillis() - time);
        System.out.println(x);
        x = 0;
        time = System.currentTimeMillis();
        for (long i : numbers) {
            x += x * 7 + i + 3;
        }
        System.out.println(System.currentTimeMillis() - time);
        System.out.println(x);
        x = 0;
        numbers = null;
        MyArray<Long> myArray = new MyArray<Long>(50000000, Long.class, 234553523525L);
        for (int i = 0; i < 50000000; i++) {
            myArray.array[i] = i * i + 3L;
        }
        time = System.currentTimeMillis();
        myArray.forEach(new Function<Long>() {

            public long perform(Long parameter, long x) {
                return x * 8 + parameter + 5L;
            }
        });
        System.out.println(System.currentTimeMillis() - time);
        System.out.println(myArray.x);
        myArray = null;
        myArray = new MyArray<Long>(50000000, Long.class, 234553523525L);
        for (int i = 0; i < 50000000; i++) {
            myArray.array[i] = i * i + 3L;
        }
        time = System.currentTimeMillis();
        myArray.forEach(new Function<Long>() {

            public long perform(Long parameter, long x) {
                return new Compute(8, 5).compute(parameter, x);
            }
        });
        System.out.println(System.currentTimeMillis() - time);
        System.out.println(myArray.x);
    }
} 
```

在我的系统上提供以下输出：

```
224
-699150247503735895
221
-699150247503735895
220
-699150247503735895
219
-699150247503735895 
```

我正在运行带有 OracleJDK 1.7 更新 6 的 Ubuntu 12.10 alpha。

一般来说，HotSpot 优化了很多间接和简单的冗余操作，所以通常你不应该担心它们，除非它们有很多顺序或者它们是严重嵌套的。

另一方面，LinkedList 上的索引 get 比在 LinkedList 的迭代器上调用 next 慢得多，因此您可以在使用迭代器时（在 for-each 循环中显式或隐式地）在保持可读性的同时避免性能下降。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-07-02T18:12:36.370

以下是Android开发团队提出的差异的简要分析：

[https://www.youtube.com/watch?v=MZOf3pOAM6A](https://www.youtube.com/watch?v=MZOf3pOAM6A)

结果是存在*差异*，并且在具有非常大列表的非常受限的环境中，这可能是一个明显的差异。在他们的测试中，for each 循环花费了两倍的时间。然而，他们的测试是针对一个包含 400,000 个整数的数组列表。阵列中每个元素的实际差异为 6*微秒*。我没有测试过，他们也没有说，但我希望使用对象而不是原语的差异会稍微大一些，但即使是这样，除非你正在构建库代码，而你不知道你会被问到的规模重复一遍，我认为差异不值得强调。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-02T13:05:43.977

确定的唯一方法是对其进行基准测试，即使这样也[并不像听起来那么简单](http://wikis.sun.com/display/HotSpotInternals/MicroBenchmarks)。JIT 编译器可以对您的代码做非常意想不到的事情。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-02T12:54:21.690

即使使用 ArrayList 或 Vector 之类的东西，其中“get”是一个简单的数组查找，第二个循环仍然有第一个循环没有的额外开销。我希望它比第一个慢一点。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-11-06T01:33:22.817

通过变量名`objectArrayList`，我假设它是`java.util.ArrayList`. 在这种情况下，性能差异将不明显。

另一方面，如果它是 的实例`java.util.LinkedList`，则第二种方法将慢得多，因为它`List#get(int)`是 O(n) 操作。

因此，除非循环中的逻辑需要索引，否则始终首选第一种方法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-03T03:51:34.093

使用迭代器而不是索引总是更好。这是因为迭代器最有可能针对 List 实现进行了优化，而索引（调用 get）可能不会。例如 LinkedList 是一个 List 但通过其元素进行索引将比使用迭代器进行迭代要慢。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-06-14T09:03:14.190

奇怪的是没有人提到明显的 - foreach 分配内存（以迭代器的形式），而普通的 for 循环不分配任何内存。对于 Android 上的游戏来说，这是一个问题，因为这意味着垃圾收集器会定期运行。在游戏中，您不希望垃圾收集器运行......永远。所以不要在你的绘制（或渲染）方法中使用 foreach 循环。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-09-17T12:23:14.067

在我看来，其他答案似乎是基于不正确的基准，这并没有考虑到 Hotspot 的编译和优化过程。

## **简短的回答**

尽可能使用增强循环，因为大多数时候它是最快的。如果不能，请尽可能将整个数组拉入局部变量：

```
int localArray = this.array;
for (int i = 0; i < localArray.length; i++) { 
    methodCall(localArray[i]); 
} 
```

## **长答案**

现在，通常没有区别，因为 Hotspot 非常擅长优化和摆脱 Java 需要做的检查。

但有时某些优化无法完成，通常是因为您在循环中有一个虚拟调用，无法内联。在这种情况下，某些循环确实可以比其他循环更快。

Java需要做的几件事：

*   ***重新加载 this.array*** - 因为它可以被改变（通过调用或另一个线程）
*   **检查*i*是否在数组的边界内**，如果没有则*抛出 IndexOutOfBoundsException*
*   **检查访问的对象引用是否为 null**，如果是则*抛出 NullPointerException*

考虑这个 c 风格的循环：

```
for (int i = 0; i < this.array.length; i++) { //now java knows i < this.array.length
    methodCall(this.array[i]);// no need to check
} 
```

通过评估循环条件***i < this.array.length***，java 知道***i*** **必须**在边界内（***i***仅**在**调用后更改），因此不需要在下一行再次检查它。但在这种情况下，java 需要重新加载***this.array.length***。

您可能很想通过将***this.array.length***值拉到局部变量中来“优化”循环：

```
int len = this.array.length;//len is now a local variable
for (int i = 0; i < len; i++) { //no reload needed
    methodCall(this.array[i]); //now java will do the check
} 
```

现在java不需要每次都重新加载，因为局部变量不能被methodCall和/或另一个线程更改。局部变量只能在方法本身内部改变，java现在可以证明变量***len***不能改变。

但是现在循环条件***i < this.array.length***变成了***i < len***，之前的优化失败了，java 需要检查***i是否在******this.array***的边界内。

更好的优化是将整个数组拉入局部变量：

```
int localArray = this.array;
for (int i = 0; i < localArray.length; i++) { 
    methodCall(localArray[i]); 
} 
```

现在java不需要重新加载数组，并且“ ***i*** in bounds”检查也被取消了。

那么增强循环呢？好吧，通常编译器会将您的增强循环重写为类似于最后显示的循环，如果不是更好的话。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-01-22T14:09:21.047

```
1\. for(Object o: objectArrayList){
    o.DoSomthing();
}
and

2\. for(int i=0; i<objectArrayList.size(); i++){
    objectArrayList.get(i).DoSomthing();
} 
```

两者都做同样的事情，但为了方便和安全地使用 for-each 编程，第二种使用方式可能容易出错。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-08-21T05:37:44.670

接受的答案回答了这个问题，除了 ArrayList 的例外情况......

由于大多数开发人员都依赖 ArrayList（至少我相信如此）

所以我有义务在这里添加正确的答案。

直接来自开发者文档：-

增强的 for 循环（有时也称为“for-each”循环）可用于实现 Iterable 接口的集合和数组。对于集合，分配了一个迭代器来对 hasNext() 和 next() 进行接口调用。使用 ArrayList，手写计数循环大约快 3 倍（使用或不使用 JIT），但对于其他集合，增强的 for 循环语法将完全等同于显式迭代器的使用。

遍历数组有几种选择：

```
static class Foo {
    int mSplat;
}

Foo[] mArray = ...

public void zero() {
    int sum = 0;
    for (int i = 0; i < mArray.length; ++i) {
        sum += mArray[i].mSplat;
    }
}

public void one() {
    int sum = 0;
    Foo[] localArray = mArray;
    int len = localArray.length;

    for (int i = 0; i < len; ++i) {
        sum += localArray[i].mSplat;
    }
}

public void two() {
    int sum = 0;
    for (Foo a : mArray) {
        sum += a.mSplat;
    }
} 
```

zero() 是最慢的，因为 JIT 还无法优化循环中每次迭代获取数组长度的成本。

one() 更快。它将所有内容提取到局部变量中，避免查找。只有数组长度提供了性能优势。

two() 对于没有 JIT 的设备是最快的，并且对于带有 JIT 的设备与 one() 没有区别。它使用 Java 编程语言 1.5 版中引入的增强的 for 循环语法。

因此，您应该默认使用增强的 for 循环，但考虑为性能关键的 ArrayList 迭代使用手写的计数循环。

# php - 谁能告诉我一个学习网络服务的好资源？

> ID：256886
> 
> 赞同：6
> 
> 时间：2008-11-02T13:24:44.903
> 
> 标签：php, web-services

我目前对 Web 服务一无所知，除了它们用于允许应用程序共享其功能。

*   从哪里开始以及如何开始？
*   如果我使用 PHP 作为我的编程语言，是否有任何关于 Web 服务的书适合我？
*   有谁知道任何 IRC 频道寻求帮助？
*   有谁知道初学者教程目录？
*   复杂吗？
*   学习需要很长时间吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T14:05:52.700

过去我使用过两本专注于 Web 服务和 PHP 的好书。 如果您想快速开始*使用*3rd 方 API（如 Amazon、Google、eBay 等），使用[PHP 的专业 Web API是很好的选择。](https://rads.stackoverflow.com/amzn/click/com/0764589547)它有大量示例 PHP 代码可以帮助您入门。 如果您有兴趣使用 PHP*实现自己的 Web 服务，那么*[Pro PHP XML 和 Web 服务](https://rads.stackoverflow.com/amzn/click/com/1590596331)就是您想要的。

 *** * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T13:41:48.880

Web 服务并不难学。如果您已经有 PHP 经验，那么您知道大部分您需要做的 Web 服务。本文可能会让您开始在 php 中创建您的第一个 Web 服务[。](http://webservices.xml.com/pub/a/ws/2004/03/24/phpws.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T06:31:06.003

我建议您从 Apache Axis2 开始。浏览[Axis2/C](http://ws.apache.org/axis2/c/docs/index.html)和[Axis2/Java](http://ws.apache.org/axis2/1_4/toc.html)文档。您还可以在[WSO2 在线图书馆](http://wso2.org/library)中找到很多关于 Web 服务的有用教程/文章/等。首先，请参阅以下几篇关于 Axis2/C 的文章。

1.  [Apache Axis2/C 简介](http://wso2.org/library/252)

2.  [Apache Axis2/C - Web 服务引擎](http://wso2.org/library/2406)

如果您正在寻找 PHP Web 服务框架，我建议您尝试[WSO2 WSF/PHP](http://wso2.org/downloads/wsf/php)。

我还认为您会发现[PHP Web Services 博客](http://phpwebservices.blogspot.com/)非常有用。

# php - 如何使用 PHP 备份 SQL 数据库？

> ID：256892
> 
> 赞同：10
> 
> 时间：2008-11-02T13:41:56.180
> 
> 标签：php, sql, backup

我如何使用 PHP 备份 SQL 数据库。

是否有符合 ANSI SQL 的与供应商无关的方法来执行此操作？

如果不是，也许您可​​以列出如何为每个数据库供应商做这件事？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-02T14:09:29.433

每个数据库系统都带有一些用于转储其内容的程序。

*   PostgreSQL：[`pg_dump`](http://www.postgresql.org/docs/8.0/interactive/backup.html)
*   MySQL：[`mysqldump`](http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html)
*   ...

[`system()`](http://php.net/manual/en/function.system.php) 您可以使用或简单地从 PHP 调用该程序[`shell_exec()`](http://php.net/manual/en/function.shell-exec.php)。

例如，如果您使用启用了[Ident 身份验证](http://www.postgresql.org/docs/8.0/interactive/auth-methods.html#AUTH-IDENT)的 PostgreSQL，并希望将数据库`test`作为 SQL 文本直接转储到浏览器，则很简单：

```
`<?php
header('Content-type: text/plain');
system('pg_dump test');
?>` 
```

`使用 MySQL 时将数据库用户和密码存储到[`~/.my.cnf`](http://dev.mysql.com/doc/refman/5.0/en/option-files.html)中，也很简单：`

```
``<?php
header('Content-type: text/plain');
system('mysqldump test');
?>`` 
```

``但是，**不要这样做：**``

```
```<?php
header('Content-type: text/plain');
system('mysqldump -utestuser -p**testpassword** test');
?>``` 
```

``因为将密码作为命令行参数传输是[非常不安全](http://dev.mysql.com/doc/refman/5.0/en/password-security.html)的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T14:23:44.990

我爱[phpmybackuppro](http://www.phpmybackuppro.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T14:35:18.490

这是一个相当复杂的过程。我建议你使用 phpmyadmin 或类似的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-03T00:52:16.373

虽然备份“符合 ANSI SQL”的数据库是可能的并且令人钦佩，但您仍然会遇到可移植性问题。最明显的是，虽然 MySQL 的转储/恢复格式相当快，但它主要通过使用 SQL 的非标准扩展来实现这一点。所以你不能只把转储交给 PostGresql：它不起作用。事实上，PostGresql 在处理大量 INSERT 语句时也很慢。它的原生转储格式使用它自己的自定义 SQL 语句，该语句针对一次插入大量数据进行了优化。

# c# - 串口和蓝屏

> ID：256893
> 
> 赞同：2
> 
> 时间：2008-11-02T13:41:58.460
> 
> 标签：c#, concurrency, serial-port, bsod

我编写了一些 C# 代码，通过在端口上发出命令并侦听回复来检查设备是否存在于任何 SerialPort 上。当我只是设置端口速度，打开端口，获取串行流并开始处理时，它的工作时间是 100%。但是，我们的一些设备以不同的速度工作，我正在尝试以不同的速度探测设备以自动协商连接并检测设备的存在。

当我在一个线程中完成所有这些操作时，没有任何问题。但是十速下的3s超时是每个串口30s，可能有几个。因此希望同时探测所有端口。

有时这有效。有时 Vista 蓝屏。当我使用线程同时探测所有端口时，它几乎总是蓝屏。当我强迫一切都在一个线程中运行时，它永远不会发生。

USB 串行 Prolific PL-2303 适配器与 x64 驱动程序一起使用。

* * *

@Vinko - 感谢您提供有关阅读小型转储的提示。

据我所知，问题的症结在于，通过*从不同的线程*启动新的异步 I/O 操作，可以为重叠 I/O 赋予全新的含义，从而在驱动程序内部引发竞争条件。由于驱动程序在内核模式下执行，**BLAM！**

# 结语

除了开始之外，不要在回调处理程序之外使用 BeginXxx，并且在调用 EndXxx 之前不要调用 BeginXxx，因为你会在内核模式下运行的驱动程序代码中引发竞争条件。

# 后记

我发现这也适用于套接字流。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T13:51:34.930

您还可以在系统属性\高级\开始和恢复\设置下禁用“自动重启”。禁用该功能后，您可以看到 BSOD 并查找错误消息，例如 IRQL_LESS_OR_EQUAL，通过搜索该错误名称，您通常可以缩小问题的根源。

顺便说一句，现在带串口的笔记本不多，所以你一定是用USB-Serial转换器吧？如果是这种情况，驱动程序可能一开始就存在问题，因为大多数制造商将串行端口驱动程序编写为虚拟驱动程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T14:49:35.200

曾经为其中一种设备编写过 Windows 驱动程序，我的建议是不要浪费您的时间在 WinDbg 上尝试证明您已经知道的内容 - 即您使用的驱动程序有问题。

如果您可以从 PL2302 中找到更新的驱动程序，请尝试，但我的建议是，如果您必须使用 USB->串行适配器，基于 FTDI 的适配器是最好的。（他们*也不*是我为其编写驱动程序的人......）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T22:56:23.550

蓝屏死机通常意味着有缺陷的驱动程序。

你使用什么样的硬件端口？我遇到过带有 SiLabs CP21xx USB 到串行转换器驱动程序的蓝屏死机。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-31T19:00:33.077

在 x64 vista 和 win7 下有稳定的 FTDI 驱动程序。我支持那个说只使用 FTDI 芯片组的人。

我附近商店（加拿大多伦多）的大多数廉价串行 USB 加密狗似乎都是 FTDI 芯片。它从来没有在盒子上，所以我买了一个，如果它好的话，我会去买一整盒。

W

# entity-framework - 如何在实体框架的 SSDL 中使用定义查询？优点和例子会有所帮助

> ID：256895
> 
> 赞同：2
> 
> 时间：2008-11-02T13:46:08.403
> 
> 标签：entity-framework, ado.net

我需要一些关于在实体框架的 SSDL 中使用定义查询元素的信息。使用它的优势以及它会有所帮助的场景将非常有帮助。一个例子和链接会很棒。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-28T00:32:33.313

我自己也在寻找相同的信息，偶然发现了这个有用的链接：

[http://blogs.microsoft.co.il/blogs/gilf/archive/2008/05/14/how-why-use-definingquery-element.aspx](http://blogs.microsoft.co.il/blogs/gilf/archive/2008/05/14/how-why-use-definingquery-element.aspx)

# web-services - 模拟 Biztalk 请求-响应端口使用的 WebService

> ID：256897
> 
> 赞同：9
> 
> 时间：2008-11-02T13:48:06.073
> 
> 标签：web-services, mocking, biztalk

我正在使用[BizUnit](http://www.codeplex.com/bizunit "商务单元")对我的 Biztalk 编排进行单元测试，但是一些编排使用 WebService，并且测试这些似乎更像是集成测试而不是单元测试。

我熟悉使用模拟框架来模拟生成的代理对象，以便从 Windows 窗体应用程序测试 Web 服务，但我希望能够在请求-响应端口中以更集成的方式完成它?

你会如何处理这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-07T02:20:05.290

这正是我作为 BizTalk 开发人员的主要烦恼之一——BizTalk 不适合进行单元测试。从您进入 BizTalk 应用程序的 99% 的接口是基于消息的并且有大量可能的输入这一事实，到编排的不透明性质，BizTalk 没有提供测试功能单元的真正方法......以及......单位。

对于 BizTalk，集成测试通常是唯一的游戏。

这导致，由于凯文史密斯没有过错，BizUnit 被 (IMO) 用词不当。一个更好的名字可能是 BizIntegrationIt。BizUnit 提供了一系列辅助集成测试的工具，其大部分测试，例如检查文件是否已写入给定目录或向 BizTalk HTTPReceive 位置发送 HTTPRequest 严格来说都是测试集成。

既然我已经吐槽了，你所要求的是我考虑了很长时间的东西，创建自动化单元测试的能力让我真正相信我对地图做一个小改动就赢了不要突然破坏下游的其他东西，以及消除对外部服务依赖的方法。

我从来没有想过这样做的任何好方法，但下面是一个**应该**可行的解决方案，我已经单独完成了每个部分的变体，但从未尝试过将它们全部以这种特定形式放在一起。

因此，鉴于希望模拟对某些外部服务（甚至可能还不存在）的调用，而不需要实际进行任何外部调用**，并且**希望能够设置对该服务调用的期望并指定响应的性质，我能想到的唯一方法是开发一个自定义适配器。

## 使用自定义适配器模拟 Web 服务

如果您构建一个自定义请求-响应适配器，您可以将其插入您的发送端口来代替 SOAP 适配器。然后，您可以为适配器指定属性，使其能够充当 Web 服务的模拟。该适配器在概念上类似于环回适配器，但允许内部模拟逻辑。

您可能希望作为适配器属性包含的内容：

*   预期的文档（可能是一个磁盘位置，它指定了您希望 BizTalk 应用程序发送到 Web 服务的内容的示例）。
*   响应文档 - 适配器将发送回消息传递引擎的文档。
*   对测试的特定期望，例如文档元素中的查找值。

您还可以让自定义适配器写入磁盘并设置 BizUnit 步骤来验证写出的文件。

[构建自定义适配器并非易事，但有可能，您可以从BizTalk 适配器向导](http://www.codeplex.com/BizTalkAdapterWizard)获得良好的开端，这里有一篇关于部署自定义适配器的[文章](http://msdn.microsoft.com/en-us/library/aa561871.aspx)。

向导生成的代码中有一个错误，您需要更改`new Guid(""),`为`new Guid()`.

还有一些在 BizTalk SDK 中构建自定义适配器的示例。

另一种选择是使用一个普通的 http 页面和[这里](http://geekswithblogs.net/gwiele/archive/2004/11/10/14737.aspx)讨论的 HTTP 请求响应，你的所有逻辑都在 http 页面中。如果您很高兴有一个 http 调用并设置一个 IIS 端口来监听您的测试，这可能会更简单。

## 初始化单元测试

您可以使用 .bat 文件将绑定文件导入 BizTalk 应用程序。

如果您为每个运行的测试以及标准应用程序设置创建一个新的绑定文件，那么您可以运行适当的批处理文件以应用正确的绑定。

每个绑定文件都会更改您的 Web 服务发送端口以使用模拟自定义适配器并为该测试设置特定属性。

然后，您甚至可以创建一个自定义 BizUnit 步骤，该步骤（可能）根据测试步骤中的设置生成绑定设置，然后运行 ​​shell 命令来更新绑定。

## 测试消息内容

您可能要考虑的最后一件事是将所有这些真正联系在一起，是测试消息内容的某种方式。您可以在模拟适配器中执行此操作，但对于大型消息或大量可能的输入消息，这将很快变得乏味。

一种选择是创建一个自定义管道，该管道调用[Schematron](http://www.schematron.com/)来验证它接收到的文件。Schematron 是一种模式语言，它允许比 xsd 更丰富的文件检查级别，因此您可以检查诸如“如果元素 x 包含此内容，我希望元素 y 存在”之类的内容。

如果您构建了一个将 schematron 模式作为参数的自定义管道，那么您可以为特定的单元测试交换一个测试文件，验证该测试，当您调用 web 服务时，您会得到一个实际匹配您想要的文件（并且不只是匹配 xsd）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-08T21:35:46.487

作为 BizUnitExtensions (www.codeplex.com/bizunitextensions) 的合著者，我同意 BizUnit 中的“单元”名称可能会造成混淆，但对于 Biztalk，“集成测试”是单元测试。一些 Biztalk 人员已经成功地使用模拟来测试管道组件和其他测试工具（+ BizUnit/Extensions）来测试模式和映射。

不幸的是，编排是不透明的。但这是有充分理由的。

(a) 由于消息框中的庞大订阅系统 - 编排在被激活时使用等，因此无法启动一些“虚拟”进程来托管编排（可以为管道完成。Tomas Restrepo 已经完成这些方面的东西）。

(b) 另外，这个虚拟进程将如何处理持久性和脱水？我敢打赌，使用 WF 的人在尝试完全测试工作流程时会遇到同样的问题。

(c) 我们不直接使用 C#，因此我们无法将模拟接口“注入”到编排代码中。

(d) 编排并不是真正的“单元”。它是一个复合元素。这些单元是进出消息框的消息以及通过表达式形状调用的外部组件。因此，即使您可以注入模拟 Web 服务接口，也无法注入模拟消息框和相关集等。

可以为编排做的一件事（我一直在考虑添加到 BizUnitExtensions 库来执行此操作）是与 OrchestrationProfiler 工具链接，因为该工具提供了所有形状的非常详细的报告，并以某种方式检查了个人步骤被执行（也许是执行所花费的时间）。这可能会使编排更像是一个白盒。另外考虑到编排调试器显示了很多变量值，当然必须可以通过 API 获取该信息以显示变量的值在给定实例的给定点。

回到 Richard 的问题，我之前的开发团队有一个解决方案。基本上我们所做的是编写一个通用的可配置 HttpHandler 来解析传入的服务请求并返回预设的响应。发回的响应可根据 XPath 等条件进行配置。在 BUILD 和 DEV 绑定文件中，webservice 端点是 mock。这在将 BUILD 和 DEV 环境与实际的第三方 Web 服务隔离开来时非常有效。这也有助于采用“合同优先”的方法，在这种方法中，我们构建了 mock，orch 开发人员使用它，而 web 服务作者继续构建实际的服务。

[更新：17-FEB-09：这个工具现在在 codeplex 上：http: [//www.codeplex.com/mockingbird](http://www.codeplex.com/mockingbird)。如果这种方法听起来很有趣，请查看并告诉我您对该工具的看法]

现在，在有人抛出旧的“关于模拟对象框架的内容”栗子之前，让我说上面的实用程序既适用于 Biztalk 的“消费者”，也适用于非 Biztalk 的消费者，但我也与 NMock2 合作并发现在编写 CLR 消费者时，它是模拟接口和设定期望的绝佳方式。（我将很快研究 MoQ 和 TypeMock 等）。但是，由于上述原因，它不适用于编排。

希望这可以帮助。

问候，

本杰

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-07T01:18:15.663

不。

不要针对任意接口进行测试，也不要为它们创建模拟。

大多数人似乎认为开发人员（单元）测试旨在测试非平凡的、单独的功能单元，例如单个类。另一方面，对主要子系统或整个系统进行客户（验收/集成）测试也很重要。

对于 Web 服务，重要的功能单元隐藏在实际执行有意义服务的类中，位于通信线路后面。这些类应该有单独的开发人员测试类来验证它们的功能，但完全没有任何面向 Web 服务的通信线路。自然地，但可能不是很明显，这意味着您的功能实现必须与布线的实现分开。因此，您的开发人员（单元）测试永远不会看到任何特殊的通信线路；这是集成的一部分，可以（适当地）将其视为“演示”问题而不是“业务逻辑”。

客户（验收/集成）测试应该解决更大范围的功能，但仍然不关注“呈现”问题。这就是 Facade 模式的普遍使用——暴露一个具有统一的、粗粒度的、可测试的接口的子系统。同样，Web 服务通信集成是无关紧要的，并且是单独实现的。

但是，实现一组单独的测试非常有用，这些测试实际上确实包括 Web 服务集成。但我强烈建议不要只测试该集成的一方面：端到端测试。这意味着构建作为 Web 服务客户端的测试，就像真正的生产代码一样；他们应该完全按照实际应用程序的方式使用 Web 服务，这意味着这些测试可以作为任何必须实现此类应用程序的人的示例（例如，如果您正在销售库，则为您的客户）。

那么，为什么要这么麻烦呢？

1.  您的开发人员测试验证您的功能在小范围内工作，无论它是如何访问的（独立于表示层，因为它都在业务逻辑层内）。

2.  您的客户测试验证您的功能在您的业务逻辑层的接口边界处是否可以正常工作，无论它是如何访问的。

3.  您的集成测试验证您的表示层与您的业务逻辑层一起使用，现在可以管理，因为您现在可以忽略底层功能（因为您在上面单独测试了它）。换句话说，这些测试集中在漂亮的面孔（GUI？）和通信接口（Web 服务？）的薄层上。

4.  当您添加另一种访问功能的方法时，您只需为新的访问形式（表示层）添加集成测试。您的开发人员和客户测试可确保您的核心功能保持不变且完好无损。

5.  您不需要任何特殊工具，例如专门用于 Web 服务的测试工具。您使用将在生产代码中使用的工具/组件/库/技术，就像在此类生产代码中使用它们一样。这使您的测试更有意义，因为您不是在测试其他人的工具。它可以为您节省大量时间和金钱，因为您无需购买、部署、开发和维护特殊工具。但是，如果您通过 GUI 进行测试（不要那样做！），您可能需要一个专门的工具用于该部分（例如，HttpUnit？）。

所以，让我们具体一点。假设我们想提供一些功能来跟踪自助餐厅的每日菜单（因为我们在一家大型公司工作，大楼里有自己的咖啡馆，就像我的一样）。假设我们的目标是 C#。

我们为菜单、菜单项和其他细粒度的功能及其相关数据构建了一些 C# 类。我们使用 nAnt 建立了一个自动构建（你这样做，对吗？），它使用 nUnit 执行开发人员测试，我们确认我们可以构建一个每日菜单并通过所有这些小块查看它。

我们对我们要去哪里有了一些想法，所以我们通过创建一个暴露少数方法同时隐藏大部分细粒度部分的单个类来应用 Facade 模式。我们添加了一组单独的客户测试，这些测试仅通过该新外观进行操作，就像客户一样。

现在我们决定要为我们的大型企业知识工作者提供一个网页来查看今天的自助餐厅菜单。我们编写一个 ASP.NET 页面，让它调用我们的外观类（如果我们使用 MVC，它将成为我们的模型），然后部署它。由于我们已经通过客户测试彻底测试了外观类，并且由于我们的单个网页非常简单，所以我们放弃针对网页编写自动化测试——使用一些知识工作者的手动测试就可以了。

后来，我们开始添加一些主要的新功能，比如能够预订我们当天的午餐。我们扩展了我们的细粒度类和相应的开发人员测试，因为我们知道我们预先存在的测试可以防止我们破坏现有的功能。同样，我们扩展我们的外观类，甚至可能随着接口的增长而分离出一个新类（例如，MenuFacade 和 OrderFacade），并在我们的客户测试中添加类似的内容。

现在，也许，对网站的更改（两个页面就是一个网站，对吗？）使手动测试无法令人满意。因此，我们引入了一个类似于 HttpUnit 的简单工具，它允许 nUnit 测试网页。我们实现了一系列集成/演示测试，但针对的是外观类的模拟版本，因为这里的重点是网页可以正常工作——我们已经知道外观类可以工作。测试通过模拟门面推送和拉取数据，只是为了测试数据是否成功到达另一端。而已。

当然，我们的巨大成功促使 CEO 要求（要求）我们将 Web 应用程序公开给大型公司的黑莓手机。因此，我们实现了一些新页面和一组新的集成测试。我们不必接触开发人员或客户测试，因为我们没有添加新的核心功能。

最后，CTO 要求（要求）我们将我们的自助餐厅应用程序扩展到所有 mega-corp 的机器人工人——你在过去几天注意到他们了吗？所以，现在我们添加一个通过我们的外观进行通信的 Web 服务层。同样，我们的核心功能、我们的开发人员测试或我们的客户测试没有任何变化。我们通过创建使用等效 Web 服务 API 公开外观的类来应用适配器/包装器模式，并且我们创建客户端类来使用该 API。我们添加了一组新的集成测试，但它们使用普通的 nUnit 创建客户端 API 类，这些类通过 Web 服务连接与服务端 API 类进行通信，服务端 API 类调用模拟外观类，从而确认我们的连接工作。

请注意，在整个过程中，除了我们的生产平台和代码、我们选择的开发平台、一些用于自动化构建和测试的开源组件以及一些定义明确的测试组之外，我们不需要任何重要的东西。另请注意，我们没有测试任何我们在生产中不使用的东西，我们也没有测试任何东西两次。

我们最终得到了一个已经证明自己成熟（假设）的功能的坚实核心（业务逻辑层）。我们有三个独立的表示层实现：一个针对桌面的网站、一个针对黑莓的网站和一个 Web 服务 API。

现在，请原谅我的冗长答案——我厌倦了不充分的答案，我不想提供一个。请注意，我实际上已经这样做了（尽管不是自助餐厅菜单）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-04T13:30:29.573

这是一个非常有趣的问题，我仍然没有看到一个好的通用答案。有些人建议使用 SoapUI，但我还没有时间实际测试它。[这个页面](http://www.soapui.org/userguide/functional/mockresponse.html)可能对此很有趣。

另一种方法可能是以某种方式包装 WebDev.WebHost.dll 并使用它... Phil Hakkck 在[这篇文章](http://haacked.com/archive/0001/01/01/using_webserver.webdev_for_unit_tests.aspx)中讨论了这一点。

之前也在[这里](https://stackoverflow.com/questions/34661/automate-test-of-web-service-communication)讨论过。

如果您找到其他解决方案，请告诉我们！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T13:25:32.143

这是这样做的方法：

> 回到 Richard 的问题，我之前的开发团队有一个解决方案。基本上我们所做的是编写一个通用的可配置 HttpHandler 来解析传入的服务请求并返回预设的响应。发回的响应可根据 XPath 等条件进行配置

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-04T19:32:31.137

我已经有一段时间不用这样做了，但是当我测试我的 Biztalk 应用程序时，我总是使用soap ui 或 web service studio。我能够毫不费力地测试不同的输入值。

# java - 如何在 Java 中实现 Web 服务安全性

> ID：256899
> 
> 赞同：2
> 
> 时间：2008-11-02T13:49:30.410
> 
> 标签：java, web-services, security, jboss

有人对 Java 中的 Web 服务安全架构有什么建议吗（最好在 JBoss 下）？有什么推荐的读物吗？

我想向世界公开一个相当丰富的 Web 服务，但数据是敏感的，它需要来自当前客户端 (Flex) 的身份验证，通过 RPC 访问。我绝对不想要任何服务器端会话状态。

在 Java/JBoss 中通过 Web 服务实现安全性的最佳方式是什么？我在哪里可以了解它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-03T02:13:04.013

你可以试试：

[![SOA 安全](https://www.manning.com/kanneganti/kanneganti_cover150.jpg)](http://www.manning.com/kanneganti/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T14:21:03.310

对于 JBoss 中的 Web 服务安全性，我将从阅读[JBossWS 用户指南](http://jbossws.jboss.org/mediawiki/index.php?title=User_Guide)的[8.4 WS-Security](http://jbossws.jboss.org/mediawiki/index.php?title=User_Guide#WS-Security)开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T04:16:26.820

WSSE 很简单并且运行良好。

[http://www.xml.com/pub/a/2003/12/17/dive.html](http://www.xml.com/pub/a/2003/12/17/dive.html)

[http://www.sixapart.com/developers/atom/protocol/atom_authentication.html](http://www.sixapart.com/developers/atom/protocol/atom_authentication.html)

# c - 使用键盘中断显示与用户键入的内容不同的内容

> ID：256902
> 
> 赞同：1
> 
> 时间：2008-11-02T14:01:27.530
> 
> 标签：c, input, interrupt

在 C 语言中，使用键盘中断，如何显示用户键入的备用键？例如，当我按键盘上的“Q”时，屏幕应显示“A”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T16:14:39.803

在任何平台上处理键盘中断都不是一个好主意。USB 键盘怎么样，没有中断可以捕捉？

对于 Windows 操作系统，您可能想要编写过滤器驱动程序，您会发现[此](https://stackoverflow.com/questions/177804/nt-kernel-programming#177854)重播部分相关。
可以在[此处](http://technet.microsoft.com/en-us/sysinternals/bb897578.aspx)找到键盘过滤器驱动程序的示例。
对于 Linux，您可能需要修补 HID 层驱动程序。Mac完全超出了我的范围:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T14:30:20.450

我们需要更多关于您的环境的信息。

据我了解你的问题，你想用你自己的方式替换键盘中断处理程序：

*   保存原始键盘处理程序的入口地址。
*   安装您自己的调用原始文件并操作键码值。

但是，在大多数现代操作系统上，定义和安装新的键盘布局要容易得多。

# java - JSTL forEach 标签：枚举问题，以及理解它应该如何工作

> ID：256910
> 
> 赞同：4
> 
> 时间：2008-11-02T14:15:20.887
> 
> 标签：java, jsp, jstl

我经历过 JSTL forEach 标记的相当奇怪的行为。

我有一些名为 SessionBean 的 bean：

```
public class SessionBean {
  private Collection<MyObject> objects;
  public Collection<MyObject> getObjects() {return objects;}
  ...
} 
```

还有一个像这样的简单 JSP 页面：

```
<%@page contentType="text/html"%>
<%@page pageEncoding="UTF-8"%>
<%@taglib prefix="f" uri="http://java.sun.com/jsf/core"%>
<%@taglib prefix="h" uri="http://java.sun.com/jsf/html"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<body>
    <f:view>
        <h:form>
            <c:forEach var="myObject" items="#{SessionBean.objects}">
                <h:outputText value="#{myObject}" /> <br />
            </c:forEach>
        </h:form>
    </f:view>
</body> 
```

而且，它不起作用。抛出的异常是

```
javax.servlet.jsp.JspTagException：不知道如何迭代 <forEach> 中提供的“项目”
        在 org.apache.taglibs.standard.tag.common.core.ForEachSupport.toForEachIterator(ForEachSupport.java:255)
        在 org.apache.taglibs.standard.tag.common.core.ForEachSupport.supportedTypeForEachIterator(ForEachSupport.java:219)
   ……

```

*为什么？*
然后我更改`items="#{SessionBean.objects}"`为 items= `"${SessionBean.objects}"`，也不例外。不打印 MyObjects 除外。

然后，我对 进行了相同的更改`<h:outputText value="#{myObject}" />`，并且该属性的值无效。

最后，用 just 替换 JSF`outputText`标记`${myObject}`可以按预期工作。

有人可以解释一下，每个阶段会发生什么，好吗？

**U：** SessionBean 由 JSF 管理，肯定是被创建的，因为它在 header 中执行一些操作。

**解决方案：**该问题被证明是由于 J2EE 1.4 中 JSTL 和 JSF 之间的不兼容造成的。切换到 J2EE 5 使第一个变体工作得很好。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T14:24:15.800

本文解释了统一 EL 和 EL 的区别[。](http://today.java.net/pub/a/today/2006/03/07/unified-jsp-jsf-expression-language.html)这是一个片段

> EL评估
> 
> EL 的评估分为立即评估和延期评估。立即评估意味着 JSP 页面在呈现页面时评估表达式。通过立即评估，所有值始终是只读的。JSP EL 表达式采用 ${imExpr} 的形式。JSP 表达式会立即求值。
> 
> 延迟评估意味着使用统一 EL 的技术从 JSP 引擎接管评估表达式的责任，并在页面生命周期的适当时间评估表达式。EL 从 JSP 容器中获得控制权，以便在适当的时间评估表达式。JSF EL 表达式采用#{defExpr} 的形式。JSF 表达式以这种方式工作。
> 
> 下面的示例显示了一个 JSF inputText 标记，它表示用户在其中输入值的文本字段组件。inputText 标记的 value 属性引用了一个表达式，该表达式指向 book bean 的 name 属性。

```
<h:inputText id="name" value="#{student.name}"/> 
```

> 对于包含此标记的页面的初始请求，JSF 实现在生命周期的“呈现响应”阶段评估#{student.name} 表达式。在此阶段，表达式仅访问 book bean 中的数量值，就像在立即评估中所做的那样。
> 
> 对于回发，实现在“应用请求值”、“过程验证”和“更新模型”阶段评估表达式，在此期间从请求中检索值、验证值并传播到 book bean。

我想知道问题是否是由于没有创建 SessionBean 的实例？

试试这个：

```
<jsp:useBean class="packagename.SessionBean" id="sb"/>
<c:forEach var="myObject" items="${sb.objects}">
            <h:outputText value="${myObject}" /> <br />
</c:forEach> 
```

[更新]我想知道这篇[文章](http://java.sun.com/products/jsp/reference/techart/unifiedEL.html)是否会有所帮助。它解释了两个 EL 如何协同工作。

# asp.net-mvc - StructureMap IOC/DI 和对象创建

> ID：256915
> 
> 赞同：1
> 
> 时间：2008-11-02T14:24:40.057
> 
> 标签：asp.net-mvc, inversion-of-control, structuremap

我正在使用 asp.net mvc 和 Structuremap ioc/di 构建小型网上商店。我的篮子类使用会话对象进行持久化，我想使用 SM 通过 IBasket 接口创建我的篮子对象。我的篮子实现需要构造函数中的 HttpSessionStateBase（来自 mvc 的会话状态包装器），它在 Controller/Action 中可用。如何为 SM 注册我的 IBasket 实现？
这是我的购物篮界面：

```
public interface IBasketService    {
    BasketContent GetBasket();
    void AddItem(Product productItem);
    void RemoveItem(Guid guid);
} 
```

和SM注册：

```
ForRequestedType(typeof (IBasketService)).TheDefaultIsConcreteType(typeof (StoreBasketService)); 
```

但是我的 StoreBasketService 实现有构造函数：

```
public StoreBasketService(HttpSessionStateBase sessionState) 
```

如何向 SM 提供 HttpSessionStateBase 对象，该对象仅在控制器中可用？
这是我第一次使用 SM IOC/DI，在官方文档和网站中找不到解决方案/示例；）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T22:31:24.583

如果您绝对必须让您的 StoreBasketService 使用会话，我会很想定义一个接口和包装 HttpSessionState 而不是使用 HttpSessionStateBase 以便您也可以使用 StructureMap 注册它。包装器将从当前获取会话状态语境。使用 StructureMap 注册包装器，然后让 StoreBasketService 将接口作为构造函数的参数。然后结构映射应该知道如何创建接口包装器的实例并将其注入到您的 StoreBasketService 类中。

使用接口和包装器将允许您在单元测试中模拟包装器，muc 与 HttpSessionStateBase 允许模拟实际会话的方式相同。

```
public interface IHttpSessionStateWrapper
{
    HttpSessionState GetSessionState();
}

public class HttpSessionStateWrapper : IHttpSessionStateWrapper
{
    public virtual HttpSessionState GetSessionState()
    {
       return HttpContext.Current.Session;
    }
}

ForRquestedType(typeof(IHttpSessionStateWrapper))
   .TheDefaultIsConcreteType(typeof(IHttpSessionStateWrapper)); 
```

* * *

```
public class StoreBasketService
{
   HttpSessionState session;
   public StoreBasketService( IHttpSessionstateWrapper wrapper )
   {
      session = wrapper.GetSessionState();
   }

   // basket implementation ...
} 
```

但是，您可以让 StructureMap`.CacheBy(InstanceScope.HttpContext)`在注册时将您的购物篮实际存储在会话中。实际上，让您的 StoreBasketService 实现内部存储而不是在会话中存储内容可能会更好——然后您完全失去了对会话状态的依赖（从您的类的角度来看），您的解决方案可能会更简单。您的内部存储可能是一个`Dictionary<Guid,Product>`，因为这是您通过界面访问它们的方式。

也可以看看：

[http://www.lostechies.com/blogs/chad_myers/archive/2008/07/15/structuremap-basic-scenario-usage.aspx](http://www.lostechies.com/blogs/chad_myers/archive/2008/07/15/structuremap-basic-scenario-usage.aspx)

[http://www.lostechies.com/blogs/chad_myers/archive/2008/07/17/structuremap-medium-level-usage-scenarios.aspx](http://www.lostechies.com/blogs/chad_myers/archive/2008/07/17/structuremap-medium-level-usage-scenarios.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T04:40:02.743

```
ForRequestedType<IBasketService>()
    .TheDefault.Is.OfConcreteType<StoreBasketService>()
    .WithCtorArg("sessionState").EqualTo(HttpContext.Current.Session); 
```

?? 那样有用吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T10:33:10.970

我刚从 StructureMap 开始，我没有得到你描述的结果。我使用一个简单的类进行了一个简单的测试，将 Structuremap 配置为 cacheby HttpContext，从我所见，CacheBy.HttpContext 意味着在同一个请求中你将获得相同的实例......不在同一个 Session

我的类的构造函数在私有字段中设置日期/时间我有一个按钮，它以一秒的间隔获取 MyClass 的 2 个实例......然后它在标签中显示两个实例的时间。

第一次按下此按钮时，对象 A 和 B 是相同的实例，因为它们的创建时间与预期的完全相同。

第二次单击该按钮，如果实例将在会话中缓存，您会期望创建时间不会改变......但是，在我的测试中，我得到了一个新的创建时间......

**结构图配置：**

```
 ObjectFactory.Initialize(x=>x.ForRequestedType<MyClass>(). CacheBy(InstanceScope.HttpContext)); 
```

**测试页面的按钮点击事件**

```
 protected void btnTest_Click(object sender, EventArgs e)
    {
        MyClass c = ObjectFactory.GetInstance<MyClass>();
        System.Threading.Thread.Sleep(1000);
        MyClass b = ObjectFactory.GetInstance<MyClass>();

        lblResult.Text = String.Format("cache by httpcontext First:{0}  Second:{1}  session id {2} ", c.GetTimeCreated(), b.GetTimeCreated(),Session.SessionID);
    } 
```

**我的课**

```
public class MyClass
{
    private DateTime _timeCreated;
    public MyClass()
    {
        _timeCreated = DateTime.Now;
    }

    public string GetTimeCreated()
    {
        return _timeCreated.ToString("dd/MM/yyyy hh:mm:ss");
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T10:38:06.267

您还可以使用 ObjectFactory.Inject 方法之一将 HttpSessionStateBase 注入到 StructureMap 中。然后它将使用注入的 HttpSessionStateBase 调用构造函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T18:49:22.233

我刚刚第一次尝试创建自定义范围......用它构建了一个小型 Web 应用程序，据我所知，它似乎可以工作。这会将对象缓存在当前用户会话中，并且只要您留在同一会话中，就会返回相同的对象：

```
public class HttpSessionBuilder : CacheInterceptor
{
    private readonly string _prefix = Guid.NewGuid().ToString();

    protected override CacheInterceptor clone()
    {
        return this;
    }

    private string getKey(string instanceKey, Type pluginType)
    {
        return string.Format("{0}:{1}:{2}", pluginType.AssemblyQualifiedName, instanceKey, this._prefix);
    }

    public static bool HasContext()
    {
        return (HttpContext.Current.Session != null);
    }

    protected override bool isCached(string instanceKey, Type pluginType)
    {
        return HttpContext.Current.Session[this.getKey(instanceKey, pluginType)] != null;
    }

    protected override object retrieveFromCache(string instanceKey, Type pluginType)
    {
        return HttpContext.Current.Session[this.getKey(instanceKey, pluginType)];
    }

    protected override void storeInCache(string instanceKey, Type pluginType, object instance)
    {
        HttpContext.Current.Session.Add(this.getKey(instanceKey, pluginType), instance);
    }

} 
```

您必须在 global.asax Application_start 中按如下方式配置 ObjectFactory

```
 ObjectFactory.Initialize(x=>
            x.ForRequestedType<MyClass>().InterceptConstructionWith(new HttpSessionBuilder())); 
```

# floating-point - 使用 C：如何确定浮点组件的大小？

> ID：256919
> 
> 赞同：2
> 
> 时间：2008-11-02T14:31:44.443
> 
> 标签：floating-point, exponent, mantissa

我正在寻找有关如何以独立于架构的方式查找浮点数的大小（以位为单位）和范围的建议。代码可以使用不同的标志在各种平台（AIX、Linux、HPUX、VMS，也许是 Windoze）上构建 - 所以结果应该会有所不同。符号，我只看到了一点，但是如何测量指数和尾数的大小？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-02T14:46:12.073

由于您正在考虑构建多个系统，因此我认为您可能正在考虑使用 GCC 进行编译。

关于浮点的一些很好的信息 - 这是几乎所有现代架构都使用的： [http ://en.wikipedia.org/wiki/IEEE_754](http://en.wikipedia.org/wiki/IEEE_754)

这详细说明了可能出现的一些差异 [http://www.network-theory.co.uk/docs/gccintro/gccintro_70.html](http://www.network-theory.co.uk/docs/gccintro/gccintro_70.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-02T16:23:52.873

当您按照之前评论中建议的链接进行操作时，您可能会看到对[每个计算机科学家应该了解的浮点运算](http://citeseer.ist.psu.edu/goldberg91what.html)的参考。无论如何，花时间阅读这篇论文。当讨论浮点数时，它会随处弹出。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-02T14:39:09.030

查看 中定义的值`float.h`。那些应该给你你需要的价值观。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T10:59:39.033

它相对容易找到：

十进制或二进制；

```
myfloat a = 2.0,
        b = 0.0;

for (int i=0; i<20; i++)
  b += 0.1;

(a == b) => decimal, else binary 
```

原因：所有二进制系统都可以表示 2.0，但是任何二进制系统都会有一个表示 0.1 的错误项。通过累积，您可以确定这个错误项不会像舍入那样消失：例如 1.0 == 3.0*(1.0/3.0) 即使在二进制系统中

尾数长度：

```
Myfloat a = 1.0,
        b = 1.0,
        c,
        inc = 1.0;

int mantissabits = 0;

do {
 mantissabits++;
 inc *= 0.5;   // effectively shift to the right
 c = b+inc;
} while (a != c); 
```

您正在添加递减项，直到达到尾数的容量。它为浮点数返回 24 位，为双精度返回 53 位，这是正确的（尾数本身仅包含 23/52 位，但由于第一位始终是标准化值的一位，因此您有一个隐藏的额外位）。

指数长度：

```
Myfloat a = 1.0;
int max = 0,
    min = 0;

while (true) {
 a *= 2.0;
 if (a != NaN && a != Infinity && whatever) // depends on system
   max++;
 else
   break;
}

a = 1.0;
while (true) {
 a *= 0.5;
 if (a != 0.0) 
   min--;
 else
   break;
} 
```

您正在向左或向右移动 1.0，直到到达顶部或底部。通常 exp 范围是`-(max+1) - max`.

如果`min`小于`-(max+1)`，则您有（如浮点数和双精度数一样）次正规。通常正值和负值是对称的（可能有一个偏移量），但您可以通过添加负值来调整测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T14:40:07.780

用于将每个字段存储在浮点数中的位数不会改变。

```
 Sign      Exponent    Fraction    Bias
Single Precision    1 [31]     8 [30-23]      23 [22-00]         127
Double Precision    1 [63]    11 [62-52]      52 [51-00]        1023 
```

编辑：正如 Jonathan 在评论中指出的那样，我省略了[long double](http://en.wikipedia.org/wiki/Long_double)类型。我将把它的位分解作为练习留给读者。:)

# visual-studio - 如何在 Visual Studio 中突出显示文本中出现的搜索词？

> ID：256931
> 
> 赞同：14
> 
> 时间：2008-11-02T14:40:56.437
> 
> 标签：visual-studio, search, keyboard-shortcuts, highlighting

如何在 VS 代码编辑器中突出显示文件中所有出现的短语（搜索词）？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-02T15:05:16.997

我注意到 Rock-Scroll 插件的一个很好的副作用是，当您双击一个关键字时，它也会突出显示文件中的所有出现（以及在摇滚滚动预览中）。

[http://microsoftdev.blogspot.com/2008/05/rock-scroll-visual-studio-plugin.html](http://microsoftdev.blogspot.com/2008/05/rock-scroll-visual-studio-plugin.html)

希望有帮助，亚历克斯

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-18T22:39:25.287

ReSharper 可以通过 Highlight Usages 功能做到这一点：[Highlight Usages In File](http://www.jetbrains.com/resharper/documentation/help20/UsageSearch/highlightUsagesInFile.html)

当然，你需要 ReSharper ;)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-08T07:42:19.200

我刚刚为这个功能做了一个快速的谷歌搜索。

想出了这些结果

VS 2008 [http://visualstudiogallery.msdn.microsoft.com/en-us/ad686131-47d4-4c13-ada2-5b1a9019fb6f](http://visualstudiogallery.msdn.microsoft.com/en-us/ad686131-47d4-4c13-ada2-5b1a9019fb6f)

VS 2010 [http://visualstudiogallery.msdn.microsoft.com/en-us/4b92b6ad-f563-4705-8f7b-7f85ba3cc6bb](http://visualstudiogallery.msdn.microsoft.com/en-us/4b92b6ad-f563-4705-8f7b-7f85ba3cc6bb)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-03-28T11:37:52.030

您可以使用 metalScroll 扩展 - 它类似于 Rockscroll，但它具有丰富且非常有用的功能。你可以下载这个：

[http://code.google.com/p/metalscroll/downloads/list](http://code.google.com/p/metalscroll/downloads/list)

使用前请仔细阅读：

[http://code.google.com/p/metalscroll/](http://code.google.com/p/metalscroll/)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-02T14:49:52.830

当您运行“查找”时，您可以单击“全部添加书签”，这将在左侧识别搜索词出现在哪些行上，但您不能使用 Visual Studio 开箱即用地“突出显示”元素。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-02T14:50:33.763

如果您使用 CTRL-i 快捷方式，它将执行内联增量搜索。继续按 CTRL-i 以跳转到并突出显示文件中的每个后续出现。

我不确定您是否可以一次突出显示所有事件。使用像 ReSharper 这样的插件可能是可能的，但我不知道。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-06-08T04:04:08.157

微软有一个（实际上）有用的 VS 插件可以解决这个问题。

电动工具：http: [//visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef/](http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef/)

安装后（之后重新启动 VS），或者突出显示一段文本并点击 CTRL+F 以迭代所有出现，或者突出显示文本并让 VS 在语法突出显示中为您标记所有匹配项。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-08-13T08:57:23.573

CTRL + F3

*   发送当前单词以查找，无论它是否被选中
*   到下一次出现的步骤
*   并突出显示编辑器中的所有事件

提示：使用 SHIFT+CTRL+F3 “后退”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-14T13:51:20.423

我将源代码复制并粘贴到 Word 2007 中。这突出显示了所有名为“阅读突出显示”的选项。即使您搜索另一个术语，这也会保持突出显示。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-07T19:21:04.997

我在 Notepad++ 和 VS 中打开文件。

**更新：**

我最近发现 VS 的这个扩展使它表现得像记事本++！您只需要选择一个短语，它就会突出显示所有短语。

[突出显示所选单词的所有出现](http://visualstudiogallery.msdn.microsoft.com/4b92b6ad-f563-4705-8f7b-7f85ba3cc6bb)

# java - 使用 Java 获取 URL

> ID：256932
> 
> 赞同：0
> 
> 时间：2008-11-02T14:41:05.827
> 
> 标签：java, url, geturl

有没有办法使用 Java获取网站的绝对 URL（[http://www.domain.com/ ）？](http://www.domain.com/)因为我用谷歌搜索了一下，但我只发现必须创建 2 或 3 个类来创建该函数 =/

### 更新：

问题是我正在尝试创建一个爬虫，它会给我一些信息，其中我想获取它从中获取信息的网页的 URL。我正在用 JAVA 开发它，我的意思是我想知道是否有一些 getUrl(); 或任何类似的方法来获取 URL，因为我知道它可以完成，但我只是编写了一个完整的其他类来检索 url，然后继承它并进一步使用它......希望它让它更清楚

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T15:55:55.740

这个问题不是很清楚，但我会假设您正在尝试从 Servlet 中获取路径。

```
String realPath = getServletConfig().getServletContext().getRealPath(relativePath); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T18:46:23.163

我假设您只需要来自 JSP 的域，但是您可能会发现您需要整个 URL，包括前缀、域、路径和参数。快速获得此功能的最简单方法是使用 Request 对象并构建它。在这里查看更多信息：

[http://www.exforsys.com/tutorials/jsp/jsp-request-object.html](http://www.exforsys.com/tutorials/jsp/jsp-request-object.html)

这是 Sun 在 HttpServletRequest 接口上的 API：

[http://java.sun.com/j2ee/sdk_1.3/techdocs/api/javax/servlet/http/HttpServletRequest.html](http://java.sun.com/j2ee/sdk_1.3/techdocs/api/javax/servlet/http/HttpServletRequest.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T19:41:25.473

你可以再详细一点吗？您的问题指出：

> 有没有办法使用 Java获取网站的绝对 URL（[http://www.domain.com/ ）？](http://www.domain.com/)

通过“网站”，您要查询哪个网站？我可以看到多种解释您的问题的方法：

1.  给定一个 URL，是否有办法获取它的主机名部分？
2.  给定一个相对路径，如何获得完整路径？
3.  在 Servlet 的上下文中，有没有办法获取已部署服务器的名称？

ETC...

# css - 为什么动态生成的内容不改变包含div的高度？

> ID：256938
> 
> 赞同：3
> 
> 时间：2008-11-02T14:49:07.713
> 
> 标签：css, html

我正在编写一个显示数据库信息的页脚 div。页脚的背景颜色与页面的其余部分不同，其高度取决于数据库向其提供的内容量。当我使用 php 生成内容并调用页脚 div 周围的边框时，内容会出现，并且比方说高 400px，但 div 边框在 div 顶部显示为 1px 高的矩形。

如何获得高度以自动适应内容？

```
<div id="footer">
<?php 

    $an_array=array();
    $tasks=mysql_query("select stuff from the db");

    while($row=mysql_fetch_assoc($tasks)){
        extract($taskrow);
        $an_array[]=$task;
        }

    $an_array=array_chunk($an_array,4);

    foreach($an_array as $dtkey=>$dtval){
        echo "<dl>";
        foreach($dtval as $dtvkey=>$dtvval){
            echo "<dt>".$dtvval."</dt>";

        }
        echo "</dl>";
        }
?>
</div> 
```

这就是我得到的。红色边框下方的区域应填充颜色。 [边框图片 http://www.kevtrout.com/tortus/div.png](http://www.kevtrout.com/tortus/div.png)

根据大众的需求，这里是 css：

```
#footer{
        border-top: 10px solid #d8d8d8;
        background:#5b5b5b;
        /*overflow:auto;*///Added this after seeing your answers, it worked

         }              
dl.tr{
        width: 255px;
        height:160px;
        background: #5b5b5b;
        margin:0px;
        float:left;
        padding: 10px;
        }

    dt.tr{
        font-weight: normal;
        font-size: 14px;
        color: #d8d8d8;
        line-height: 28px;
        } 
```

编辑：我在 Mac 上使用 Firefox

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-02T14:53:32.790

检查您的页脚 CSS...如果您将溢出设置为除自动/滚动之外的任何内容，则 DIV 将不会增长。

如果不尝试使用 DL/DT 以外的东西，因为 DT 是内联元素，它们不会推动您的 div 以适应内容。*

例如，只需尝试使用 DIV，如果页脚变大，您就有答案了。

（注：我修改了建议的顺序）

*（我意识到规范方面，这**不应该**是一个问题，但没有迹象表明这发生在哪些浏览器中，因此如果 IE 的呈现方式与预期不同，我一点也不感到惊讶）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T15:03:56.297

在没有看到 CSS 的情况下，我的猜测是你`<dl>`的 s 是浮动的，以便将它们并排放置。然后包含`<div>`不会扩展以包含它们。如果是这种情况`clear:both;`，在 final 之前添加 a`</div>`应该可以修复它，如下所示：

```
<div style='clear:both;'></div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T15:01:22.790

浏览器不关心您的内容是由 PHP 生成还是来自静态 HTML 文件。

问题很可能出在您的 CSS 中。您放入页脚的内容具有将它们放置在 div“外部”的定位属性（如 float:left 或 position:absolute），或者 div 具有固定大小和/或溢出属性集。

我建议在此处发布您的 CSS 文件，或者（如果它太大）将它放在我们可以查看的地方。完成的 HTML（如果您的系统尚未在线，您可以保存输出的静态副本）也不会受到伤害。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T15:16:28.580

顺便说一句，您对`<dl>`元素的使用是错误的：您缺少`<dd>`元素。定义列表中的项目始终包含一个定义*术语*和一个或多个*定义*（在您的代码中，这些定义是缺失的）。

另外，`<div style='clear:both;'></div>`我建议不要像史蒂夫建议的那样使用，而是明确说明`<dt>`元素的高度。这样，就不必清除浮标。

# php - 需要 PHP 日期选择器控件和事件日历

> ID：256946
> 
> 赞同：3
> 
> 时间：2008-11-02T15:01:00.857
> 
> 标签：php, calendar

我正在寻找有关 PHP 的建议：

1.  我可以嵌入到网页中的日历控件/小部件，以使用户能够选择日期。一个日期选择器。
2.  提供每周日历视图的日历软件，类似于 Microsoft Outlook 提供的。它应该在代表时隙的列和行中显示一周中的几天。每个单元格将显示在一天/时间段内发生的事件 [（来源：][[microsoft.com](https://www.microsoft.com/uk/atwork/images/office2007/outlook2007_todo.jpg)][）][![替代文字](https://i.stack.imgur.com/1QVT8.jpg)](https://i.stack.imgur.com/1QVT8.jpg)

我不是在寻找一款兼具两者的软件。它不必花哨或功能齐全。我需要一些基本的东西来做一个小项目。如果该软件不依赖于数据库，或者如果它依赖于数据库，它可以支持 Oracle，那就太好了。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-02T15:49:53.427

您可以使用 JQuery 的日期选择器：

主页：[http ://www.kelvinluck.com/assets/jquery/datePicker/](http://www.kelvinluck.com/assets/jquery/datePicker/)

演示：[http ://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/)

至于一个全面的日历组织者，不幸的是我不知道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T16:09:49.813

我使用[DHTML 日历](http://www.dynarch.com/projects/calendar/)。它可以在任何地方使用，并且很容易换肤，并且还带有一些非常漂亮的皮肤（除了他们网站上的丑陋演示）。

关于完整日历，您是否考虑过与[Google 日历](http://google.com/calendar)集成？他们已经完成了所有这些，当然它完全兼容浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T01:27:14.400

[FullCalendar](http://arshaw.com/fullcalendar/)提供了非常灵活的月视图，但不是周视图。不过也许可以扩展它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T15:26:15.643

如果您愿意进行自定义，请查看 PHP[日历手册](http://docs.php.net/manual/en/book.calendar.php)。

不幸的是，我自己没有使用过这些。

# design-patterns - 围绕用户工作流程构建 Webapp

> ID：256952
> 
> 赞同：2
> 
> 时间：2008-11-02T15:09:51.697
> 
> 标签：design-patterns, user-interface, workflow

我对我如何使用计算机的思考越多，我就越相信“工作流程”是提高生产力的关键因素，也是我应该设计交互的方式。我认为工作流是我们处理和管理与任务相关的数据、信息和知识的方式。

我开始使用我的第一个 Web 框架 - 我选择了 kohana，因为它看起来相对轻量级、功能完善并且使用我已经部分熟悉的语言 (PHP)。最近我一直在研究一本关于设计模式的书，但对如何使用这些信息感到有点畏惧。

我对简单的 Web 应用程序有一些想法，我认为它们可能对 Web 有用。我已经勾勒出我的数据对象，并尝试在便利贴上注明所涉及的阶段。

你们有没有任何设计技巧可以确保我的 web 应用程序围绕用户工作流的概念发展？除了设计模式，我还应该研究其他概念吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-03T04:08:38.053

我认为您对可靠且引人入胜的工作流程的权利是成功的用户应用程序的关键。举个例子，考虑一下这个网站（stackoverflow），它围绕问题有一个引人入胜且简单的工作流程。这是一个很好的例子。我也一直在思考这个问题。让我为您指出几个资源。其中一篇是 Bret Victor 的一篇精彩文章，现任职于 Apple。 [http://worrydream.com/MagicInk/](http://worrydream.com/MagicInk/)。它是关于作为信息设计的软件设计。这是一个与工作流不同的想法，但我认为它归结为同一件事，为用户提供有意义的信息图形，他们可以轻松地采取行动并回答他们的首要问题。阅读那篇文章，它可能会改变你对软件的看法，它确实是我的。二、是流的概念（工作*流*对吗？）用于游戏编程。[考虑来自http://www.jenovachen.com/flowingames/flowtheory.htm](http://www.jenovachen.com/flowingames/flowtheory.htm)的这些核心思想：

*   我们负责活动。
*   我们能够专注于活动。
*   活动有明确的目标。
*   活动有直接反馈。
*   我们觉得我们控制着活动。
*   我们的担忧和担忧消失了。
*   我们对时间的主观体验被改变了。

对我来说，这些听起来像是一个很棒的工作流程的组成部分。

您也可以阅读 iPhone UI 文档并研究一般的 Apple 应用程序，它们通常是世界上最擅长构建具有可靠工作流程的 UI 的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T15:24:04.570

查看源代码以（开源）类似工作流方向的替代应用程序，以及在您选择的框架中编写的其他应用程序。

理论很好，但要真正理解，您需要研究已经存在的实际具体应用。

# xhtml - HTML 5 与 XHTML 1.0 过渡？

> ID：256953
> 
> 赞同：54
> 
> 时间：2008-11-02T15:10:14.100
> 
> 标签：xhtml, html

似乎 Firefox 3.1 和其他浏览器将（部分）支持 HTML 5。它正在添加对视频和音频作为标签的支持，但这些是 XHTML 1.0 Transitional 无法识别的新标签。如果我在未来版本的 Firefox 中使用新的 HTML 5 标记，但对 XHTML 使用 DTD，应该是什么行为？如果我将 HTML 5 标记与 XHTML 1.0 Trans 混合使用会怎样？

这越来越令人困惑。他们为什么不直接将这些标签添加到 XHTML 中？我们如何同时支持 XHTML 和 HTML 5？

HTML 5 视频：[http ://www.youtube.com/watch?v=xIxDJof7xxQ](http://www.youtube.com/watch?v=xIxDJof7xxQ)

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-11-02T18:11:11.300

HTML5 比 XHTML 1.0 更容易编写。

1.  您不必手动声明“ [http://www.w3.org/1999/xhtml](http://www.w3.org/1999/xhtml) ”命名空间。

2.  您不必为脚本和样式元素添加类型属性（它们默认为 text/javascript 和 text/css）。

3.  您不必使用浏览器忽略大部分内容的长文档类型。您必须使用易于记忆的<!DOCTYPE html>。

4.  您无法选择在文档类型中包含或不包含 dtd uri，并且您无法在过渡和严格之间进行选择。您只有一个调用完整标准模式的严格文档类型。这样，您就不必担心意外进入几乎标准模式或 Quirks 模式。

5.  字符集声明要简单得多。它只是 <meta charset="utf-8">。

6.  如果你觉得将 void 元素写成 <name> 会让人感到困惑，你可以根据需要使用 <name/>。

7.  HTML5 在[http://validator.nu/](http://validator.nu/)有一个非常好的验证器。验证器不受无法表达所有规则的糟糕 DTD 的约束。

8.  您不必在内联脚本或样式表（在某些情况下）中添加 //<![CDATA 等来验证。

9.  如果需要，您可以使用嵌入。

就语法而言，当您使用 HTML5 时，您最终会得到更清晰、更易于阅读的标记，该标记始终调用标准模式。当您使用 XHTML 1.0（作为 text/html 提供）时，您指定了浏览器将自动执行的一堆杂乱无章（以针对糟糕的 dtd 进行验证）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-11-02T18:24:08.780

在这个线程中，神话和误解比比皆是。

1.  XHTML 1.0 早于 HTML 5。它不能使用任何新词汇。事实上，它的主要卖点是它使用与 HTML 4.01 完全相同的词汇。

2.  不会有 XHTML 1.2 - 很可能。而且它不是必需的。XHTML 5 是 HTML 5 的 XML 序列化。相同的词汇，不同的解析规则。

3.  HTML 在浏览器中从未被视为真正的 SGML。没有浏览器实现过符合 SGML 的解析器。HTML 5 会将这一事实变成规则，HTML 序列化将遵循当今的事实标准。也许有人会说它是“SGML-ish”。

4.  如前所述，DTD 在浏览器中仅用于一个目的，即区分标准遵从模式和怪癖模式。因此它只影响样式和脚本。如果您在具有严格文档类型的页面上使用框架，它们将呈现得很好。<embed> 甚至 <marquee> 也一样——尽管后者是可憎的，而前者不在任何当前标准中。不过，它是 HTML 5 的一部分。

5.  无论是序列化、XML 还是 HTML，都可以使用视频和音频。它们是 HTML 5 和 XHTML 5 的一部分。一旦解析阶段结束，浏览器将构建文档的内部 DOM。无论序列化如何，该 DOM 对于所有实际目的都是相同的。是的，无论文档类型如何，使用 text/html 发送的 XHTML 仍然是普通的 html。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-02T16:00:24.717

嗯，一般来说 HTML 是 SGML，而 XHTML 是用 XML 表示的。因此，与 HTML 相比，创建 XHTML 受到更多限制（以标记的形式）。（[基于 SGML 的 HTML 与基于 XML 的 HTML](http://en.wikipedia.org/w/index.php?title=HTML&oldid=248853176#SGML-based_versus_XML-based_HTML "HTML – 维基百科")）

如[Wikipedia](http://en.wikipedia.org/w/index.php?title=HTML_5&oldid=247907787 "HTML 5 – 维基百科")中所述，HTML 5 也将有一个 XHTML 变体 (XHTML 5)。

经验法则：您应该始终使用有效的标记。这也意味着您不应该在 XHTML 1.0 过渡中使用提到的`<video>`或`<audio>`标记，因为它们不是该规范的元素。如果您**确实需要**使用这些标签（我非常怀疑），那么您应该确保使用 HTML 5/XHTML 5 DTD 以指定您的文档在该 DOCTYPE 中。

在给定的实现状态下使用 HTML 5 或 XHTML 5（AFAIK，标准甚至还没有确定，对吗？）可能会适得其反，因为几乎所有用户可能都看不到网站呈现的正确性。

2013 年编辑：由于最近的反对意见，并且由于无法（由我删除）这个已接受的答案，我想补充一点，现在 HTML5 的支持和标准化过程与五年前我写这个答案时完全不同. 由于大多数主流浏览器都支持 HTML5 草案的大部分内容，并且由于旧浏览器中的 polyfill 可以修复很多东西，所以我现在主要使用 HTML5。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-02T18:59:22.607

您可能以错误的方式看待问题，因为与[XHTML 1.x](http://www.whatwg.org/specs/web-apps/current-work/#relationship-to-xhtml-1.x)部分的关系，HTML 5 指出：

> “本规范旨在取代 XHTML 1.0 作为 HTML 词汇的 XML 序列化的规范定义。”

现在这种语言是有争议的（XHTML 2 WG 对它提出了异议，HTML WG 正在尝试解决这些差异......）但这就是我们现在的立场。

几点注意事项：

*   HTML 5 包含一个称为 XHTML 5 的 XML 序列化，[如果您了解细节，规范会解释其中的差异](http://www.whatwg.org/specs/web-apps/current-work/#html-vs-xhtml)
*   HTML 不是 SGML。[Henri Sivonen 在 HTML 解析的历史上写了一篇很棒的文章](http://hsivonen.iki.fi/thesis/html5-conformance-checker.html#history)
*   到目前为止（它已经多次成为争论的话题），不会有 HTML/XHTML 5[的 DTD——规范的一致性要求部分](http://www.whatwg.org/specs/web-apps/current-work/#conformance-requirements)解释了为什么 DTD 不适合定义 HTML 语言. [HTML 5 验证器](http://about.validator.nu/)还包含有关此主题的大量信息（包括 HTML5 的 RELAX NG 模式）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-02T16:58:34.193

请记住，文档类型在浏览器中仅用于一个目的：在怪癖、几乎标准和标准模式之间切换。因此，使用`<video>`and`<audio>`将适用于任何 doctype 声明。IMO，使用 XHTML doctype 是非常没用的，因为您发送的每个具有`text/html`MIME 类型的页面都会被解析为（tag-soup）HTML。我建议使用 HTML5 doctype ( `<!doctype html>`)，因为它更容易记住并且不会无缘无故地强迫您使用 XML 语法。

> 他们为什么不直接将这些标签添加到 XHTML 中？

他们确实做到了，有一个 HTML 5 (XHTML5) 的 XML 序列化。要使用它，您必须使用 XML MIME 类型发送您的页面，例如`application/xhtml+xml`. 不过，IE （尚）不支持此功能。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-02T16:35:36.877

> 如果我在未来版本的 Firefox 中使用新的 HTML 5 标记，但对 XHTML 使用 DTD，应该是什么行为？
> 
> 如果我将 HTML 5 标记与 XHTML 1.0 Trans 混合使用会怎样？

如果您的标记没有作为您选择的 DTD 的一部分实现 - 那么从逻辑上讲，不应遵循该标记。但是浏览器的实现并不总是严格合乎逻辑的。

> 他们为什么不直接将这些标签添加到 XHTML 中？我们如何同时支持 XHTML 和 HTML 5？

xHTML 并不比 HTML 好，但它更适合某些应用程序。xHTML 的主要优点之一是可以使用 XSLT 将其转换为不同的格式。例如，您可以使用 XSLT 将 xHTML 自动转换为 RSS 提要或其他 XML 格式。

您不需要同时支持这两种格式 - 根据您的项目要求权衡每种格式的优缺点。HTML 5 可能在相当长的一段时间内都不会成为标准。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T18:15:05.297

(X)HTML5 只是下一个版本。在 XHTML5 得到很好的支持之前，您应该使用 XHTML1.1。

您可能不应该使用 HTML5 的向后兼容 SGML 配置文件。它使爬虫和小型解析器变得更加困难。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-11-02T15:13:02.237

您的[文档类型](http://en.wikipedia.org/wiki/Document_Type_Declaration)将告诉浏览器您使用的是 HTML5 还是 XHTML。您不能只是将一个 doctype 中的标签推入另一种 doctype 的文档中并期望它起作用。如果没有 doctype，这一切都只是标签汤。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-11-02T15:14:13.327

当 99% 的人无法在浏览器上正常查看时，不要使用视频/音频标签之类的东西。对于这两个示例中的任何一个，我建议使用 FLV。

至于他们为什么不将它添加到 XHTML...首先 1.0 不是最新版本，1.1 是不久前发布的。

最终，事情变得标准化，我们将在这两个标准中看到这些类型的标签，但现在只要尽你所能确保最多的人可以查看你的内容。

# php - 在 PHP 中创建/修改 Web 表单的快捷方式？

> ID：256956
> 
> 赞同：0
> 
> 时间：2008-11-02T15:11:57.810
> 
> 标签：php, oracle, forms, crud

我是 PHP 新手，在我浪费大量时间做艰难的事情之前，我想了解是否有创建 PHP Web 表单应用程序的快捷方式/技术。这个应用程序将做的只是显示来自 1 个或多个表的数据的 Web 表单。除了显示数据之外，用户还必须能够更新表单并将新数据添加到表单中。我知道如何通过手动编写所有 PHP/HTML 代码来完成所有这些工作。但我正在寻找任何可以节省我时间的东西。

不幸的是，我不能为此使用任何花哨的 PHP 库，例如 CakePHP。我仅限于使用核心 PHP 框架、用于数据库的 Oracle 和用于 Oracle 访问的 OCI 库。

鉴于这些限制，在基本的 PHP 表单应用程序中支持 CRUD 操作的最简单方法是什么？是否有代码生成器或其他工具可以提供帮助？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T16:20:04.677

> 不幸的是，我不能为此使用任何花哨的 PHP 库，例如 CakePHP。我仅限于使用核心 PHP 框架，

大多数 PHP 框架都是用 PHP 编写的。所以你不必安装任何东西来使用它们。

也就是说，表格相当重要。将表单视为单独的组件仅在某种程度上有效。正因为如此，许多框架都将表单深度集成到其中，而不是作为独立组件。

您可以看一下 Zend Framework（现在称为[Laminas](https://getlaminas.org)）的[表单组件](http://web.archive.org/web/20120829111558/http://framework.zend.com:80/manual/en/zend.form.html) 。它相当自给自足且功能丰富。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T18:47:32.010

I build all of my forms on top of a "fillInFormValues($html, $request, $formErrors);" function. See [my article at OnLamp](http://www.onlamp.com/pub/a/php/2006/03/16/autofill-forms.html) for details and full source code.

# entity-framework - 将存储过程的返回类型设置为自动 - 使用实体框架生成

> ID：256962
> 
> 赞同：3
> 
> 时间：2008-11-02T15:13:57.523
> 
> 标签：entity-framework, ado.net

在 LINQ2SQL 中，可以将存储过程的返回类型设置为自动生成。我无法使用实体框架这样做。

我想将存储过程的返回类型设置为使用实体框架自动生成。这可能吗？

亲切的问候。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T18:23:28.107

Entity Framework V1 很好地支持直接与实体一起使用存储过程（作为插入/更新/删除操作），但正如您所发现的，开箱即用的 SP 作为 ObjectContext 上的函数的支持很差。它们几乎总是必须完美地映射到模型中的现有实体，因为期望您随后会对 SP 返回的结果进行更改，因此希望将它们作为实体使用。显然，情况并非总是如此。

值得庆幸的是，EF v1 有一些扩展，其中包括对 SP 的改进支持。[在此处](http://code.msdn.microsoft.com/EFExtensions)下载扩展。

EF v2 会有[更好的支持](http://blogs.msdn.com/efdesign/archive/2008/07/18/using-stored-procedures-to-get-load-structured-data.aspx)。

# nhibernate - 如何使用 NHibernate 持久化枚举

> ID：256978
> 
> 赞同：52
> 
> 时间：2008-11-02T15:30:50.970
> 
> 标签：nhibernate, enums, persistence, foreign-keys

有没有办法使用 NHibernate 将枚举持久化到数据库？那就是有一个包含代码和枚举中每个值的名称的表。

我想保留没有实体的枚举，但仍然有一个从所有其他引用实体到枚举表的外键（枚举的 int 表示）。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-12-15T05:01:17.620

为什么你们把事情复杂化了？这真的很简单。

映射如下所示：

```
<property name="OrganizationType"></property> 
```

模型属性如下所示：

```
public virtual OrganizationTypes OrganizationType { get; set; } 
```

枚举看起来像这样：

```
public enum OrganizationTypes
{
    NonProfit = 1,
    ForProfit = 2
} 
```

NHibernate 会自动解决所有问题。为什么打字比你需要的多？？？？

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-03T02:33:57.993

可以直接使用枚举类型：http://web.archive.org/web/20100225131716/http: [//graysmatter.codivation.com/post/Justice-Grays-NHibernate-War-Stories-Dont-Use-Int- If-You-Mean-Enum.aspx](http://web.archive.org/web/20100225131716/http://graysmatter.codivation.com/post/Justice-Grays-NHibernate-War-Stories-Dont-Use-Int-If-You-Mean-Enum.aspx)。如果您的基础类型是字符串，它应该使用字符串表示，如果它是数字，它将只使用数字表示。

但是您的问题措辞听起来像是您正在寻找不同的东西，而不是枚举。似乎您想要一个查找表而不创建单独的实体类。我不认为这可以在不创建单独的实体类的情况下完成。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-02T17:19:24.010

一个简单但不那么漂亮的解决方案：

创建一个整数字段，并将映射文件中的映射设置为该字段。创建一个使用整数字段的公共属性。

```
private int myField;
public virtual MyEnum MyProperty
{
   get { return (MyEnum)myField; }
   set { myField = value; }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-05-15T17:23:20.847

我正在使用 NHibernate 3.2，这很好用：

```
type="NHibernate.Type.EnumStringType`1[[enum_full_type_name, enum_assembly]], NHibernate" 
```

不过，不确定何时添加了通用 EnumStringType。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-07T08:05:06.557

尝试使用策略模式。然后，您可以将逻辑放入您的内部类中。当“枚举”中应该包含逻辑时，我会经常使用它。例如，下面的代码具有抽象 IsReadyForSubmission()，然后在每个嵌套子类中实现（仅显示一个）。高温高压

```
[Serializable]
public abstract partial class TimesheetStatus : IHasIdentity<int>
{
        public static readonly TimesheetStatus NotEntered = new NotEnteredTimesheetStatus();
        public static readonly TimesheetStatus Draft = new DraftTimesheetStatus();
        public static readonly TimesheetStatus Submitted = new SubmittedTimesheetStatus();
        //etc

        public abstract int Id { get; protected set; }
        public abstract string Description { get; protected set; }
        public abstract bool IsReadyForSubmission();

        protected class NotEnteredTimesheetStatus: TimesheetStatus
        {
            private const string DESCRIPTION = "NotEntered";
            private const int ID = 0;
            public override int Id
            {
                get { return ID; }
                protected set { if (value != ID)throw new InvalidOperationException("ID for NotEnteredTimesheetStatus must be " + ID); }
            }

             public override string Description
            {
                get { return DESCRIPTION; }
                protected set { if (value != DESCRIPTION)throw new InvalidOperationException("The description for NotEnteredTimesheetStatus must be " + DESCRIPTION); }
            }
            public override bool IsReadyForSubmission()
            {
                return false;
            }

        }
        //etc
} 
```

# sql - SQL 中的分层标记

> ID：256997
> 
> 赞同：8
> 
> 时间：2008-11-02T15:57:03.693
> 
> 标签：sql, mysql, database, tags, normalizing

我有一个 PHP Web 应用程序，它使用 MySQL 数据库进行对象标记，其中我使用了接受的标记结构作为[这个 SO question](https://stackoverflow.com/questions/20856/how-do-you-recommend-implementing-tags-or-tagging)的答案。

我想实现一个标签层次结构，其中每个标签都可以有一个唯一的父标签。然后，对父标签 T 的搜索将匹配 T 的所有后代（即 T、父标签为 T（T 的子代）、T 的孙子代等）。

最简单的方法似乎是在标签表中添加一个 ParentID 字段，该字段包含标签的父标签的 ID，或者如果标签没有父标签，则包含一些幻数。然而，搜索后代需要对数据库进行重复的完整搜索以找到每个“世代”中的标签，我想避免这种情况。

一种（可能）更快但标准化程度较低的方法是拥有一个包含每个标签的所有子代，甚至每个标签的所有后代的表。然而，这会带来数据库中数据不一致的风险（例如，标签是多个父级的子级）。

有没有一种好方法可以让查询快速找到后代，同时保持数据尽可能规范化？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-02T16:15:00.350

我使用两列实现了它。我在这里简化了一点，因为我必须将标签名称保存在单独的字段/表中，因为我必须针对不同的语言对其进行本地化：

*   标签
*   小路

例如，查看这些行：

```
tag            path
---            ----
database       database/
mysql          database/mysql/
mysql4         database/mysql/mysql4/
mysql4-1       database/mysql/mysql4-1/
oracle         database/oracle/
sqlserver      database/sqlserver/
sqlserver2005  database/sqlserver/sqlserver2005/
sqlserver2005  database/sqlserver/sqlserver2008/ 
```

等等

使用`like`路径字段上的运算符，您可以轻松获取所有需要的标记行：

```
SELECT * FROM tags WHERE path LIKE 'database/%' 
```

有一些实现细节，例如当您在层次结构中移动节点时，您也必须更改所有子节点等，但这并不难。

还要确保路径的长度足够长 - 在我的情况下，我没有使用路径的标记名称，而是使用另一个字段来确保我不会得到太长的路径。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T18:24:26.983

Ali 的答案有一个链接到[Joe Celko 的 Trees and Hierarchies in SQL for Smarties](http://books.google.co.uk/books?id=6mAAFPTB-9cC)，这证实了我的怀疑 - 没有一个简单的数据库结构可以提供世界上最好的。最适合我的目的似乎是这本书中详述的“频繁插入树”，它类似于阿里链接的“嵌套集模型”，但具有非连续索引。这允许 O(1) 插入（*a la*非结构化 BASIC 行编号），并在需要时偶尔进行索引重组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T16:19:16.723

[这里有几种方法](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T17:45:26.953

您可以构建 Kimball 所说的 Hierarchy Helper Table。

假设您的层次结构如下所示： A -> B | B -> C | C -> D

您会将记录插入到如下所示的表中

```
ParentID, ChildID, Depth, Highest Flag, Lowest Flag
A, A, 0, Y, N
A, B, 1, N, N
A, C, 2, N, N
A, D, 3, N, Y
B, B, 0, N, N
B, C, 1, N, N
B, D, 2, N, Y
C, C, 0, N, N
C, D, 1, N, Y
D, D, 0\. N, Y 
```

我想我是正确的....无论如何。关键是你仍然正确地存储你的层次结构，你只是从你正确的表中构建这个表。这个表查询就像一个女妖。假设您想知道 B 以下的所有第一级是什么。

```
WHERE parentID = 'B' and Depth = 1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T17:46:59.820

我会使用某种数组来存储子标签，这应该比在自身上加入表格要快得多（特别是如果你有大量标签）。我看了一下，我不知道 mysql 是否具有本机数组数据类型，但您可以通过使用文本列并在其中存储序列化数组来模拟这一点。如果您想进一步加快速度，您应该能够在该列上放置一个文本搜索索引以找出哪些标签是相关的。

[编辑] 在阅读了 Ali 的文章后，我进行了更多的搜索，并发现[了这篇](http://pugs.postgresql.org/lapug/200808#attachments)关于在 postgres 中实现层次结构的方法的演示文稿。可能仍然有助于解释目的。``************