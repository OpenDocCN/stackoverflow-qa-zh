# StackOverflow 问答 000194000-000194999

# .net - 与 .net 应用程序的防病毒集成

> ID：194013
> 
> 赞同：12
> 
> 时间：2008-10-11T12:04:23.607
> 
> 标签：.net, antivirus

在使用应用程序上传文件时，我想在我的 .net 应用程序中使用防病毒集成。.Net 是否有可用的防病毒 API？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-05-10T19:32:53.007

我不想复活一个老问题，但我需要一个问题所问的解决方案。我评估了很多东西，得出的结论是，确实没有一个好的 .NET 库可以做到这一点。所以我自己做了。

该库称为 nClam，它连接到 ClamAV 服务器。它是具有非常简单 API 的开源（Apache 许可证 2.0）库。你可以在这里获得它：[https](https://github.com/tekmaven/nClam) ://github.com/tekmaven/nClam 。还有一个 nuget 包：nClam。

我希望将来偶然发现这个问题的人能从我的图书馆中受益！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T18:13:03.673

我在我的桌面上使用 ClamWin，它建立在开源 Clam AntiVirus 库之上：http: [//www.clamav.net/download/third-party-tools/3rdparty-library/](http://www.clamav.net/download/third-party-tools/3rdparty-library/)

看起来他们对 .NET 有几个不同的绑定：

[ClamAv#](http://clamav-sharp.sourceforge.net/)

[WRAV库](http://www.wolfereiter.com/antivirus.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T13:49:10.463

为什么不在接收服务器上安装杀毒软件？这样，您可以保持定义更新，这可能不会在上传客户端应用程序上发生。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-05-30T18:09:22.973

赛门铁克提供[扫描引擎](http://www.symantec.com/scan-engine)作为将防病毒软件集成到您的 .Net 应用程序中的一种方式。如果这是针对非商业（内部）软件，并且您的公司已经在使用赛门铁克，那么这对您来说也是一个不错的选择。我不能代表 ClamAV 或 nClam，因为我从未亲自使用过它们。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2019-12-11T07:39:17.970

我向您推荐一个称为防病毒扫描程序的 nuget，您可以轻松地做到这一点[https://www.nuget.org/packages/AntiVirusScanner/](https://www.nuget.org/packages/AntiVirusScanner/) 这个 nuget 基本上调用了 microsoft windows defender apis。

# asp.net-mvc - ASP.NET 中的用户身份验证

> ID：194015
> 
> 赞同：2
> 
> 时间：2008-10-11T12:06:57.330
> 
> 标签：asp.net-mvc, authentication

我想知道，为我的 asp.net-mvc Web 应用程序创建用户身份验证的最佳方法是什么。

我应该使用自定义 MembershipProvider 使用 Forms 身份验证吗？或者我应该为我的用户实现自己的登录和注册机制？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T12:28:04.543

如果您没有迫切的业务需要，重新发明轮子似乎很愚蠢。我会使用自定义提供程序进行表单身份验证（如有必要）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T12:29:00.093

除非您有一些特殊需求，否则最好使用开箱即用的解决方案。所以也许你应该描述一下让你考虑自己滚动的考虑因素？（并将该信息添加到原始问题中 - 这将有助于人们提供有用的答案）。

# php - 执行请愿书的最佳方式是什么？（签署请愿书后发送电子邮件）

> ID：194032
> 
> 赞同：0
> 
> 时间：2008-10-11T12:33:06.530
> 
> 标签：php, design-patterns, email

我需要构建一个小 webapp，但我不确定最好的做法是什么。

订阅请愿书的人正在签署发送给*X*的电子邮件。这也将保存到数据库中，以便在线显示订阅者。

这个想法是有一个标准的文本消息，用户提交他的名字，这个名字作为签名进入消息。

我可以让 php 使用真实发件人的地址发送电子邮件，或者让用户复制并粘贴文本并让他自己发送电子邮件。

我不确定实现它的最佳方法是什么。什么会更“有效”，我的意思是作为订阅者的数量，应用程序发送电子邮件的解决方案更容易，但是电子邮件的真实性呢？如果它们都是从同一个地方发送的，它们会被认为是无效的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T13:34:21.490

不管整件事是不是一个“好”的想法，你都想保证自己的安全。如果您欺骗了发件人字段，您的大部分电子邮件（尤其是具有 SPF 记录的域）很可能无法通过第一级垃圾邮件过滤。

SPF（发件人策略框架）记录列出了允许为域发送邮件的唯一 IP。如果一个域有 SPF 记录并且您对其进行轮询，那么您应该将任何并非源自所列服务器的内容视为危险废物。

根据您发送这些电子邮件的位置，您最终可能会将您的邮件服务器列入一个或多个黑名单。这意味着*任何*电子邮件、SPF 或其他电子邮件都不会被接受。

简而言之：

*   让人们发送自己的电子邮件。提供模板。
*   考虑使用完整的规范`<a href="mailto:...`——您可以将主题和正文放在链接中，让模板成为一键式事件。
*   您可以在您的网站上使用 Javascript 来个性化消息（并因此`mailto:`链接），同时仍在您的网站上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T12:50:52.313

让我直截了当地说 - 所以你想添加到已经使世界饱和到没有好的目的的扶手椅激进主义电子邮件的洪流中，你在问如何最好地做到这一点？在进一步讨论之前，我会阅读以下内容：

[http://www.breakthechain.org/armchair.html](http://www.breakthechain.org/armchair.html)

# visual-studio-2008 - 是否可以下载VS2008“测试项目”模板？

> ID：194035
> 
> 赞同：2
> 
> 时间：2008-10-11T12:41:08.383
> 
> 标签：visual-studio-2008, templates, test-project

出于某种原因，我的 Visual Studio 2008 安装没有安装“创建测试项目”模板。我假设我应该能够从 MSDN 上的某个地方下载它，但我无法在任何地方找到它（猜我的 Google-Fu 很弱）

有谁知道我在哪里可以得到模板来安装它？

谢谢

编辑：我已经设法从另一台开发机器上获得项目模板，但现在 devenv /installvstemplates 似乎仍然没有安装模板......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T13:31:17.300

看看[这篇](http://blogs.telerik.com/KevinBabcock/Posts/08-07-20/Visual_Studio_Tip_Creating_and_Consuming_an_Item_Template.aspx)关于使用项目模板的文章，看看它是否为安装复制模板的主题带来了一些启示。

您还没有说您的机器上安装了哪些客户端版本。测试项目在 Team Edition for Software Testers 和 Team Suite 中可用。

# ruby-on-rails - act_as_taggable_on_steroids 的 Unicode 问题

> ID：194051
> 
> 赞同：2
> 
> 时间：2008-10-11T12:59:01.763
> 
> 标签：ruby-on-rails, unicode, utf-8, tags, acts-as-taggable-on-ster

我正在实现一个带有一些法语字符标签的博客。我的问题与如何处理 url 中的空格和 unicode (utf-8) 字符有关。

假设我有一个名为：ohlàlà！我的标签云中有以下代码：

```
<%= link_to h(tag.name.capitalize), { :controller => :blog, :action => :tag, :id => h(tag.name) }, :class => css_class %> 
```

我该如何处理这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T13:14:15.477

请参阅[此 Wikipedia 文章](http://en.wikipedia.org/wiki/Internationalized_domain_name)中的[ToASCII 和 ToUnicode](http://en.wikipedia.org/wiki/Internationalized_domain_name#ToASCII_and_ToUnicode)。我希望这篇文章有足够的指针来解决你的问题。

*编辑：*虽然它会讲*Python*，但[Unicode 和永久链接](http://www.gooli.org/blog/unicode-and-permalinks/)可以让您了解如何对您的问题的解决方案进行编码。总结一下：

> 基本上，Unicode URL 以 UTF8 编码，并且 UTF8 编码字符串的每个字节都使用百分比编码进行编码。浏览器显然识别出这种特定的编码方案（我可以在任何地方都没有记录）并为用户显示漂亮的国际化 URL。

抱歉，我不知道*Rails*是否有现成的函数来以这种方式对 URL 进行编码。

# sql-server-2005 - 如何在复制监视器中删除过时的发布？

> ID：194057
> 
> 赞同：1
> 
> 时间：2008-10-11T13:07:02.827
> 
> 标签：sql-server-2005

由于在创建和删除出版物方面的一些失误，我留下了很多过时的出版物，由于某种原因，它们仍然保留在复制监视器中。

您如何删除这些出版物？似乎没有明确的方法来删除它们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-06T13:52:18.090

这是我的一个老问题，但至少我再次找到了解决它的方法。

我能够删除出版物是通过创建一个具有相同名称的新出版物，然后再次删除该出版物。这次发布将不再出现在复制监视器中。我不记得出版物是否必须与过时的出版物类型相同，但它确实有效。

**UPDATE：**好的，发布类型和数据库名称很重要，否则新创建的发布将被视为不同的发布。有点明显，但现在我确定了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-09-26T09:37:29.097

当带有出版物的数据库脱机时，我在我们的一个服务器上注意到了另一种情况。然后，该发布将从对象浏览器中消失，但仍会根据此问题显示在复制监视器中。

在这种情况下，您可以简单地使数据库重新联机，从而使发布重新出现。然后您可以删除它并使数据库重新脱机解决问题。

这仅在问题的原因是脱机数据库时才有效 - 我相信还有许多其他情况会发生这种情况。

# sql-server - 由自定义复制存储过程插入时未复制的记录

> ID：194077
> 
> 赞同：1
> 
> 时间：2008-10-11T13:40:09.530
> 
> 标签：sql-server, sql-server-2005, replication

我最近刚刚为我的订阅者数据库设置了自定义复制，如此处的[另一篇文章](https://stackoverflow.com/questions/161890/how-do-you-track-the-time-of-replicated-rows-for-subscribers-in-sql-server-2005)所述。基本上，当发布者向订阅者推送新记录时，存储过程也会将复制时间插入到表中的额外列中，并将新记录插入到日志表中。

尝试将日志表复制回主发布数据库时出现我的问题。这就是我所做的：

1.  在日志表所在的数据库中，我设置了一个新的事务复制，并将其设置为创建快照。
2.  创建发布后，我会创建一个新的推送订阅，并将其设置为立即初始化。
3.  创建订阅后，我检查了同步状态并确认已成功应用快照。

现在这是奇怪的部分：如果我使用 SQL Server Management Studio 手动将记录添加到日志表中，该记录将被很好地复制。如果记录是由自定义复制存储过程添加的，则不会。状态将始终显示“没有可用的复制事务”。

我不知道出版物为什么会这样：我真的不明白它如何以不同的方式处理自定义复制存储过程插入的数据。

有人可以解释我做错了什么吗？

**更新：**几个月前我终于有了这个问题的答案，只是我从来没有时间更新这个问题。我们必须向 Microsoft 记录支持电话，但我们得到了一个可行的解决方案。

* * *

**解答：**要解决此问题，添加订阅时，您需要运行如下脚本：

```
sp_addsubscription @publication = 'TEST', ..., @loopback_detection = 'false' 
```

解决方案的关键是上面显示的最后一个参数。默认情况下，生成的订阅脚本不会有这个参数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T10:03:44.053

几个月前我终于有了这个问题的答案，只是我从来没有时间更新这个问题。我们必须向 Microsoft 记录支持电话，但我们得到了一个可行的解决方案。

要解决此问题，添加订阅时，您需要运行如下脚本：

```
sp_addsubscription @publication = 'TEST', ..., @loopback_detection = 'false' 
```

解决方案的关键是上面显示的最后一个参数：**@loopback_detection = 'false'**。默认情况下，生成的订阅脚本不会有这个参数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-09T12:34:24.533

我看到这是一个非常古老的问题，所以你可能已经解决了这个问题，但无论如何......

您描述的问题当然似乎没有意义。通过复制触发器对源表的任何更改都将进一步调用复制。在您的流程描述中唯一看起来不正确的事情（尽管我可能误读了）是您在推送订阅之前创建了一个快照。通常，您应该设置复制、推送订阅，然后创建/推送快照。不要相信同步状态，因为这没有检查任何内容，它只是说它没有要复制的事务，它不知道表已同步。

至于为什么您的手动插入工作而不是自动插入工作，我会检查并重新检查您的工作，从根本上说，如果复制工作正常，那么无论来源如何，都会复制对该表的任何更改。

如果您早就解决了这个问题，我很想听听解决方案。

编辑：

一个迟到的想法：当您使用自定义 proc 更新 datetime 字段，然后将触发器触发回复制数据库时，您可能会导致复制模型和插入之间出现死锁问题。这可能会导致无法复制回来。在不运行测试的情况下弄清楚有点复杂，但这是一种可能性。

# java - XMLEntityScanner.peekChar 中的 ArrayIndexOutOfBoundsException 从 HttpRequest 读取 XML

> ID：194086
> 
> 赞同：1
> 
> 时间：2008-10-11T13:50:33.377
> 
> 标签：java, servlets, jaxb, xerces

我正在从我的 servlet doPost() 中的 HttpServletRequest 读取 XML 数据，并将 Reader 从 req.getReader() 传递给 JAXB 解组器。我尝试了几种不同的输入 XML，但我总是得到这个异常。

```
SEVERE: Servlet.service() for servlet RESTPhotoAdmin threw exception
java.lang.ArrayIndexOutOfBoundsException: 8192
        at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(XMLEntityScanner.java:491)
        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2672)
        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)
        at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:140)
        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:508)
        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:807)
        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)
        at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:107)
        at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)
        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)
        at com.sun.xml.internal.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:195)
        at com.sun.xml.internal.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal(UnmarshallerImpl.java:168)
        at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:137)
        at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:194)
        at com.cantorva.gigcalendar.servlets.rest.RESTPhotoAdmin.doPost(RESTPhotoAdmin.java:41) 
```

这只发生在我的 Live Web 服务器上，而不是本地开发机器上。无论输入是什么（尽管我只尝试了大约 90k 个输入），堆栈跟踪的消息部分始终显示为“8192”。我查看了 XMLEntityScanner.java 第 491 行，可以看到正在读取的缓冲区，并且该缓冲区确实是一个数组。对我来说，使用从零开始的索引 8192 无法读取 8k 缓冲区是有道理的，所以这一定是一个错误 - 但原因是什么，我该怎么办？

* * *

我问这个已经通过大量的侦探工作找到了答案。我想为下一个可怜的家伙省去麻烦，因为 Apache 已经拒绝修复它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T14:07:02.703

我发现了一个不起眼的错误[XERCESJ-1275](http://issues.apache.org/jira/browse/XERCESJ-1275)，它本身就是[XERCESJ-1015](http://issues.apache.org/jira/browse/XERCESJ-1015)的副本。该报告没有提到我的堆栈跟踪，但确实提到了`ArrayIndexOutOfBoundsException`. 线索是关于 0 是来自 Reader 的 read 方法的有效（或有些有效）响应的评论，而不是来自 JavaDoc 的 InputStream 的评论。XMLEntityScanner 假定 0 永远不会发生 - 因此是错误。

Michael Glavassevich 以不同的方式解释文档并将缺陷标记为无效，但解决方法只是使用`req.getInputStream()`而不是 Reader 为 Unmarshaller 提供 InputStream 并交叉手指，实现的某些晦涩部分正在更完美地履行不同的接口契约 - 这他们是这样。

# .net - 如何检查数字是否是.NET中的整数？

> ID：194089
> 
> 赞同：1
> 
> 时间：2008-10-11T13:54:08.113
> 
> 标签：.net, isinteger

假设我有一个包含数字的字符串。我想检查这个数字是否是整数。

### 例子

```
IsInteger("sss") => false 

IsInteger("123") => true

IsInterger("123.45") =>false 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-11T13:56:02.803

你可以使用int。[尝试解析](http://msdn.microsoft.com/en-us/library/f02979c7.aspx)。如果它可以解析字符串并将您的 out 参数设置为值，它将返回一个布尔值

```
 int val;
if(int.TryParse(inputString, out val))
{
    //dosomething
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-11T14:11:47.080

您可以使用两个直接选项。

**选项 1** -*首选*- 使用[Int32.TryParse](http://msdn.microsoft.com/en-us/library/system.int32.tryparse.aspx)。

```
int res;
Console.WriteLine(int.TryParse("sss", out res));
Console.WriteLine(int.TryParse("123", out res));
Console.WriteLine(int.TryParse("123.45", out res));
Console.WriteLine(int.TryParse("123a", out res)); 
```

这输出：

```
False
True
False
False 
```

**选项 2** - 使用正则表达式

```
Regex pattern = new Regex("^-?[0-9]+$", RegexOptions.Singleline);
Console.WriteLine(pattern.Match("sss").Success);
Console.WriteLine(pattern.Match("123").Success);
Console.WriteLine(pattern.Match("123.45").Success);
Console.WriteLine(pattern.Match("123a").Success); 
```

这输出：

```
False
True
False
False 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T14:00:27.320

你可以使用[System.Int32.TryParse](http://msdn.microsoft.com/en-us/library/system.int32.tryparse.aspx)并做这样的事情......

```
string str = "10";
int number = 0;
if (int.TryParse(str, out number))
{
    // True
}
else
{
    // False
} 
```

# c# - 模型 - 视图 - 具有虚拟网格的演示者

> ID：194094
> 
> 赞同：1
> 
> 时间：2008-10-11T13:58:58.383
> 
> 标签：c#, winforms, grid, virtual, mvp

在 winforms 应用程序中使用虚拟网格和 MVP 模式时，最好的责任分解是什么。

包含：

1.  从网格中获取用户更改单元格更新的回调
2.  从网格回调以设置给定行和列的单元格的样式和值

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T01:40:30.917

被称为模型-视图-演示者的许多模式中的确切职责各不相同。主要是它们在演示者对视图施加多少控制方面有所不同。Martin Fowler 在他关于[GUI 架构](http://martinfowler.com/eaaDev/uiArchs.html)的章节中深入讨论了许多不同的变体，非常值得一读。

看看[Presenter First](http://www.atomicobject.com/files/PresenterFirstAgile2006.pdf)，因为它在一定程度上处理了适配器和职责。

[被动视图](http://martinfowler.com/eaaDev/PassiveScreen.html)和[监督控制器](http://martinfowler.com/eaaDev/SupervisingPresenter.html)都值得一看。

模型（或域模型）== 系统中涉及的实体的逻辑表示，包括它们的状态和行为

Presenter == 监听来自视图（也可能是模型）的事件并为这些请求提供服务，将模型类型转换为视图类型（被动视图），这确实是隐藏视图和模型的管道。对来自用户的刺激做出反应。

view ==presentation：用户可以与之交互的模型的可视化表示，收集用户输入

您关于回调和获取网格单元格样式的具体问题都将涉及视图处理来自网格的事件并将事件返回给演示者以请求操作或从模型中检索数据。这对于单元格内容更新时的回调是完美的（这需要发布给演示者，以便演示者可以验证模型中的更改并在模型中进行更改）。
对于网格单元样式，我认为视图中的某种适配器可能需要将模型中的状态（通过从视图到演示者的事件检索）转换为网格单元样式信息。这可能发生在演示者中，但我个人更希望演示者不了解视图中的小部件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T22:24:51.403

如果我理解正确，网格是视图实现的一部分，对演示者不可见。在这种情况下，演示者不需要知道数据是如何显示的，只需要知道如何提供它们。

我可能会创建一个帮助器类，某种适配器，网格与之通信。网格只看到这个助手，视图同上。

合作将是这样的：

网格 <-- 助手 <-- 视图 <--> 演示者

# javascript - 通过javascript跟踪表单更改的最佳方法是什么？

> ID：194101
> 
> 赞同：49
> 
> 时间：2008-10-11T14:08:07.430
> 
> 标签：javascript, forms

我想通过javascript跟踪表单中输入的变化。我的意图是（但不限于）

*   仅在某些内容发生更改时启用“保存”按钮
*   如果用户想要关闭页面并且某些内容未保存，则发出警报

想法？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-11T14:17:47.177

循环遍历所有输入元素，并`onchange`在每个元素上放置一个处理程序。当它触发时，设置一个标志，让您知道表单已更改。它的基本版本很容易设置，但如果有人将输入从“a”更改为“b”然后又变回“a”，它就不够聪明。如果抓住那个案例很重要，那么它仍然是可能的，但需要更多的工作。

这是 jQuery 中的一个基本示例：

```
$("#myForm")
    .on("input", function() {
        // do whatever you need to do when something's changed.
        // perhaps set up an onExit function on the window
        $('#saveButton').show();
    })
; 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-11T14:18:00.590

JS 中的文本表单元素暴露了一个`.value`属性和一个`.defaultValue`属性，因此您可以轻松地实现如下内容：

```
function formChanged(form) {
  for (var i = 0; i < form.elements.length; i++) {
      if(form.elements[i].value != form.elements[i].defaultValue) return(true);
  }
  return(false);
} 
```

对于复选框和单选按钮，请查看是否`element.checked != element.defaultChecked`，对于 HTML`<select />`元素，您需要遍历`select.options`数组并检查每个选项是否`selected == defaultSelected`.

您可能想查看使用[jQuery](http://jquery.com/)之类的框架将处理程序附加到`onchange`每个单独的表单元素的事件。这些处理程序可以调用您的`formChanged()`代码并修改`enabled`“保存”按钮的属性，和/或附加/分离文档正文事件的事件处理程序`beforeunload`。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-10-22T18:59:55.763

这是一个用于检测表单更改的简单的 javascript 和 jquery 方法。它会禁用提交按钮，直到进行更改。它检测通过提交表单以外的方式离开页面的尝试。它解释了用户的“撤消”，它被封装在一个函数中以便于应用，并且它不会在提交时出错。只需调用该函数并传递表单的 ID。

此函数在页面加载时序列化表单一次，并在用户离开页面之前再次序列化。如果两个表单状态不同，则会显示提示。

试试看：http: [//jsfiddle.net/skibulk/ev5rE/](http://jsfiddle.net/skibulk/ev5rE/)

```
function formUnloadPrompt(formSelector) {
    var formA = $(formSelector).serialize(), formB, formSubmit = false;

    // Detect Form Submit
    $(formSelector).submit( function(){
        formSubmit = true;
    });

    // Handle Form Unload    
    window.onbeforeunload = function(){
        if (formSubmit) return;
        formB = $(formSelector).serialize();
        if (formA != formB) return "Your changes have not been saved.";
    };

    // Enable & Disable Submit Button
    var formToggleSubmit = function(){
        formB = $(formSelector).serialize();
        $(formSelector+' [type="submit"]').attr( "disabled", formA == formB);
    };

    formToggleSubmit();
    $(formSelector).change(formToggleSubmit);
    $(formSelector).keyup(formToggleSubmit);
}

// Call function on DOM Ready:

$(function(){
    formUnloadPrompt('form');
}); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-07-09T12:35:16.253

尝试

```
function isModifiedForm(form){
  var __clone = $(form).clone();
  __clone[0].reset();
  return $(form).serialize() == $(__clone).serialize();
} 
```

希望它有帮助））

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-11T14:19:47.873

如果您使用 Web 应用程序框架（rails、ASP.NET、Cake、symfony），则应该有用于 ajax 验证的包，

[http://webtecer.com/2008/03/17/list-of-ajax-form-validators/](http://webtecker.com/2008/03/17/list-of-ajax-form-validators/)

以及 onbeforeunload() 上的一些包装器以警告用户即将关闭表单：

[http://pragmatig.wordpress.com/2008/03/03/protecting-userdata-from-beeing-lost-with-jquery/](http://pragmatig.wordpress.com/2008/03/03/protecting-userdata-from-beeing-lost-with-jquery/) [检测未保存的更改](https://stackoverflow.com/questions/155739/detecting-unsaved-changes-using-javascript)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-11T17:27:37.730

我在 Ars Technica 上回答了这样的问题，但问题是这样设计的，即使用户没有模糊文本字段（在这种情况下，更改事件永远不会触发），也需要检测到更改。我想出了一个全面的脚本：

1.  如果字段值更改，则启用提交和重置按钮
2.  如果表单被重置，则禁用提交和重置按钮
3.  如果表单数据已更改且未提交，则中断离开页面
4.  支持 IE 6+、Firefox 2+、Safari 3+（大概是 Opera 但我没有测试）

这个脚本依赖于原型，但可以很容易地适应另一个库或独立。

```
$(document).observe('dom:loaded', function(e) {
    var browser = {
        trident: !!document.all && !window.opera,
        webkit: (!(!!document.all && !window.opera) && !document.doctype) ||
            (!!window.devicePixelRatio && !!window.getMatchedCSSRules)
    };

    // Select form elements that won't bubble up delegated events (eg. onchange)
    var inputs = $('form_id').select('select, input[type="radio"], input[type="checkbox"]');

    $('form_id').observe('submit', function(e) {
        // Don't bother submitting if form not modified
        if(!$('form_id').hasClassName('modified')) {
            e.stop();
            return false;
        }
        $('form_id').addClassName('saving');
    });

    var change = function(e) {
        // Paste event fires before content has been pasted
        if(e && e.type && e.type == 'paste') {
            arguments.callee.defer();
            return false;
        }

        // Check if event actually results in changed data
        if(!e || e.type != 'change') {
            var modified = false;
            $('form_id').getElements().each(function(element) {
                if(element.tagName.match(/^textarea$/i)) {
                    if($F(element) != element.defaultValue) {
                        modified = true;
                    }
                    return;
                } else if(element.tagName.match(/^input$/i)) {
                    if(element.type.match(/^(text|hidden)$/i) && $F(element) != element.defaultValue) {
                        modified = true;
                    } else if(element.type.match(/^(checkbox|radio)$/i) && element.checked != element.defaultChecked) {
                        modified = true;
                    }
                }
            });
            if(!modified) {
                return false;
            }
        }

        // Mark form as modified
        $('form_id').addClassName('modified');

        // Enable submit/reset buttons
        $('reset_button_id').removeAttribute('disabled');
        $('submit_button_id').removeAttribute('disabled');

        // Remove event handlers as they're no longer needed
        if(browser.trident) {
            $('form_id').stopObserving('keyup', change);
            $('form_id').stopObserving('paste', change);
        } else {
            $('form_id').stopObserving('input', change);
        }
        if(browser.webkit) {
            $$('#form_id textarea').invoke('stopObserving', 'keyup', change);
            $$('#form_id textarea').invoke('stopObserving', 'paste', change);
        }
        inputs.invoke('stopObserving', 'change', arguments.callee);
    };

    $('form_id').observe('reset', function(e) {
        // Unset form modified, restart modified check...
        $('reset_button_id').writeAttribute('disabled', true);
        $('submit_button_id').writeAttribute('disabled', true);
        $('form_id').removeClassName('modified');
        startObservers();
    });

    var startObservers = (function(e) {
        if(browser.trident) {
            $('form_id').observe('keyup', change);
            $('form_id').observe('paste', change);
        } else {
            $('form_id').observe('input', change);
        }
        // Webkit apparently doesn't fire oninput in textareas
        if(browser.webkit) {
            $$('#form_id textarea').invoke('observe', 'keyup', change);
            $$('#form_id textarea').invoke('observe', 'paste', change);
        }
        inputs.invoke('observe', 'change', change);
        return arguments.callee;
    })();

    window.onbeforeunload = function(e) {
        if($('form_id').hasClassName('modified') && !$('form_id').hasClassName('saving')) {
            return 'You have unsaved content, would you really like to leave the page? All your changes will be lost.';
        }
    };

}); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-11T14:22:47.727

要在关闭前提醒用户，请使用 unbeforeunload：

```
window.onbeforeunload = function() {
   return "You are about to lose your form data.";
}; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-11T18:02:12.543

当页面加载时，我会将每个字段值存储在一个变量中，然后在用户卸载页面时比较这些值。如果检测到任何差异，您将知道要保存什么，并且更好的是，能够明确告诉用户如果他们退出哪些数据将不会被保存。

```
// this example uses the prototype library
// also, it's not very efficient, I just threw it together
var valuesAtLoad = [];
var valuesOnCheck = [];
var isDirty = false;
var names = [];
Event.observe(window, 'load', function() {
    $$('.field').each(function(i) {
        valuesAtLoad.push($F(i));
    });
});

var checkValues = function() {
    var changes = [];
    valuesOnCheck = [];
    $$('.field').each(function(i) {
        valuesOnCheck.push($F(i));
    });

    for(var i = 0; i <= valuesOnCheck.length - 1; i++ ) {
        var source = valuesOnCheck[i];
        var compare = valuesAtLoad[i];
        if( source !== compare ) {
            changes.push($$('.field')[i]);
        }
    }

    return changes.length > 0 ? changes : [];
};

setInterval(function() { names = checkValues().pluck('id'); isDirty = names.length > 0; }, 100);

// notify the user when they exit
Event.observe(window, 'beforeunload', function(e) {
     e.returnValue = isDirty ? "you have changed the following fields: \r\n" + names + "\r\n these changes will be lost if you exit. Are you sure you want to continue?" : true;
}); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-02-25T19:58:55.567

我用过dirtyforms.js。对我来说效果很好。

[http://mal.co.nz/code/jquery-dirty-forms/](http://mal.co.nz/code/jquery-dirty-forms/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-11T14:21:53.983

将事件处理程序附加到每个表单输入/选择/文本区域的 onchange 事件。设置一个变量来告诉您是否应该启用“保存”按钮。创建一个 onunload 处理程序来检查脏表单，并在提交表单时重置变量：

```
window.onunload = checkUnsavedPage;
var isDirty = false;
var formElements = //获取所有表单元素的引用
for(var i = 0; len = formElements.length; i++) {
    //给每个元素添加onchange事件调用formChanged()
}

函数formChanged（事件）{
    isDirty = 假；
    document.getElementById("savebtn").disabled = "";
}

函数 checkUnsavedPage() {
    如果（脏）{
        var isSure = confirm("你确定？");  
        如果（！isSure）{
            event.preventDefault();
        }
    }
}

```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-11T18:28:44.720

[这是Dylan Beattie 建议](https://stackoverflow.com/questions/194101/what-is-the-best-way-to-track-changes-in-a-form-via-javascript#194112)的完整实现：

[用于“未保存数据”保护的客户端/JS 框架？](https://stackoverflow.com/questions/140460/clientjs-framework-for-unsaved-data-protection#140508)

您不需要存储初始值来确定表单是否已更改，除非您在客户端动态填充它（尽管即使那样，您仍然可以`default`在表单元素上设置属性）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-31T06:04:54.430

您还可以查看我在[jQuery track changes in forms plugin 中构建的这个 jQuery 插件](http://code.zhandwa.com/jquery/)

在此处查看演示并[在](http://downloads.zhandwa.com/trackchanges/demo/js/jquery.form.track.changes.js)[此处](http://downloads.zhandwa.com/trackchanges/demo/)下载 JS

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-05-16T18:34:35.463

如果您愿意使用 jQuery，请参阅我对类似问题的回答： [Disable submit button unless original form data has changed](https://stackoverflow.com/questions/16593222/disable-submit-button-unless-original-form-data-has-changed/16594431#16594431)。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-11-22T04:39:19.237

我遇到了同样的挑战，我正在考虑一个通用的解决方案。下面的代码并不完美，它来自最初的研发。以下是我使用的步骤：

1）将以下JS移动到另一个文件（比如changeFramework.js）

2）通过导入将其包含在您的项目中

3）在你的html页面中，无论哪个控件需要监控，添加类“monitorChange”

4) 全局变量“hasChanged”会告诉您，您正在处理的页面是否有任何变化。

```
<script type="text/javascript" id="MonitorChangeFramework">
// MONITOR CHANGE FRAMEWORK
// ALL ELEMENTS WITH CLASS ".monitorChange" WILL BE REGISTERED FOR CHANGE
// ON CHANGE IT WILL RAISE A FLAG
var hasChanged;

function MonitorChange() {
    hasChanged = false;
    $(".monitorChange").change(function () {
        hasChanged = true;
    });
} 
```

以下是我使用此框架的控件：

```
<textarea class="monitorChange" rows="5" cols="10" id="testArea"></textarea></br>
        <div id="divDrinks">
            <input type="checkbox" class="chb monitorChange" value="Tea" />Tea </br>
            <input type="checkbox" class="chb monitorChange" value="Milk" checked='checked' />Milk</br>
            <input type="checkbox" class="chb monitorChange" value="Coffee" />Coffee </br>
        </div>
        <select id="comboCar" class="monitorChange">
            <option value="volvo">Volvo</option>
            <option value="saab">Saab</option>
            <option value="mercedes">Mercedes</option>
            <option value="audi">Audi</option>
        </select>
        <button id="testButton">
            test</button><a onclick="NavigateTo()">next >>> </a> 
```

我相信这个框架可以有很大的改进。欢迎评论/更改/反馈。:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-29T14:06:17.973

我做了一些跨浏览器测试。

在 Chrome 和 Safari 上，这很好：

```
<form onchange="validate()">
...
</form> 
```

对于 Firefox + Chrome/Safari，我会这样做：

```
<form onkeydown="validate()">
    ...
    <input type="checkbox" onchange="validate()">
</form> 
```

复选框或单选按钮等项目需要自己的 onchange 事件侦听器。

# web-services - 在 Java Webservice 中检索调用 url

> ID：194102
> 
> 赞同：2
> 
> 时间：2008-10-11T14:09:54.867
> 
> 标签：web-services, monitoring

我们有一个 Web 服务部署在不同位置的 2 台不同的机器上。是否可以使用 java 代码监控一个人用来调用我们的 web 服务的 url？我们设置了一个 3DNS url，我们希望所有客户端都使用这个 url，而不是直接在 url 中使用正确的端口号点击框。

谢谢达米安

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-07T18:09:41.443

你有没有看过：

```
@Resource
WebServiceContext wsContext; 
```

这将返回发送到您的 Web 服务的当前消息的上下文。我已经能够从中获取用户的IP地址。

这是假设您使用的是 Java。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T05:14:42.263

您可能会研究类似 OWSM（Oracle Web 服务管理器）的东西......可能有开源替代品。

OWSM 创建一个虚拟端点，它处理并路由到实际的服务主机。这样，您的服务主机可以隐藏在防火墙后面，只有 OWSM 主机对全世界可见。当用户点击虚拟端点时，OWSM 可以进行身份​​验证并将其传递给平衡的服务主机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-23T19:48:37.563

另一种方法可能是在真实端点上使用 servlet 过滤器。过滤器可以做一些不同的事情。它可以简单地从 HttpServletRequest 记录请求的 URL，或者它甚至可以为您重定向到正确的 URL（不过，我不确定这对 Web 服务有什么影响）。

您所要做的就是将过滤器映射到与 Web 服务相同的上下文路径（例如，轴使用 /services/*）。

# perl - 我如何知道系统是否已启动？

> ID：194104
> 
> 赞同：8
> 
> 时间：2008-10-11T14:11:45.130
> 
> 标签：perl, operating-system, boot, uptime

我正在编写一个通过网络启动系统的脚本。然后我需要在另一台主机上运行一些命令。如何知道系统是否已开机？

我的编程语言是 Perl，目标主机是 RHEL5。

是否有任何内核中断或网络引导信息表明系统已开机且操作系统已加载？

[在不同的情况下] 我也想知道如果我只是手动打开我的机器。确切地说是什么时候通电。以及操作系统应该何时完全启动以进行网络相关操作，例如在那里执行网络命令。如果系统在 DHCP 上怎么办，那么远程系统将如何搜索这台机器 [我猜这可能通过 mac 地址。但如果我错了]。

如果我错过了任何信息，请随时问我。如果您有任何建议可以使任务更轻松，请提出：)

谢谢伊姆金

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-11T14:16:30.453

好吧，我会说当系统可以执行您提出的请求时系统已启动。也就是说，sshd 守护进程正在运行。这足以满足您的目的（我假设 - 替代您真正需要的任何守护程序）。

所以，我会发送开机信号，然后每 15-30 秒检查一次，看看我是否可以连接。如果我未能在该机器的合理时间内（2 分钟或 5 分钟或其他任何时间）连接，那么我会向 IT 支持团队发送警报。好吧，我会先把它发送给自己，只有在我调查了一些故障并发现它们都是合法的之后，我才会开始将它直接发送给 IT。

DHCP是一个不同的问题。您必须开始学习广播，或者在启动期间在该机器上安装一个守护进程“回拨”以注册其当前 IP 地址。每次 DHCP 更新更改其 IP 地址时，它都必须“回拨”。这显然更令人费解。如果可能，请尽量避免在此类服务器机器上使用 DHCP。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-11T14:37:48.883

在重新启动的机器上，您可以在 crontab 中安装一个带有特殊`@reboot`断言的脚本（请参阅 参考资料`man 5 crontab`）。该脚本可以向另一台机器发送某种通知，通知它现在已经启动。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-11T14:24:26.117

我认为检查 sshd 听起来是个好方法。

至于 DHCP 问题：如果另一台计算机在同一子网中，您可以使用[Net::ARP](http://search.cpan.org/~crazydj/Net-ARP/ARP.pm)通过 MAC 地址查找它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-11T14:34:06.877

如何将脚本添加到在启动时运行的远程机器，让它告诉你它什么时候准备好。

# php - 如何弃用 PHP 中的函数？

> ID：194121
> 
> 赞同：38
> 
> 时间：2008-10-11T14:24:55.257
> 
> 标签：php, deprecated

在我工作的团队中，我们有一个旧代码库，在代码中使用 PHP 的 ibase_* 函数与数据库通信。我们为它创建了一个包装器，除了调用原始函数之外还可以做其他事情，我在整个代码中进行了大规模搜索替换，以确保使用包装器。

现在，我们如何防止将来使用 ibase_* 函数？

最好，我希望它们仍然可用，但在使用时会发出通知或警告。

首选纯 PHP 解决方案（不需要编译 PHP 的自定义版本）。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-11T14:34:58.700

[触发错误（）](http://au.php.net/trigger_error)

```
function my_deprecated_function() {
    trigger_error("Deprecated function called.", E_USER_NOTICE);
    // do stuff.
} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2017-07-27T10:26:27.587

一般来说，您可以将一个方法标记为已弃用，以向您的用户发出有关在未来版本中无法使用的代码的警告。我认为最好的方法是使用[trigger_error](http://php.net/manual/en/function.trigger-error.php)和一些[phpdoc](https://www.phpdoc.org/)。

```
/**
 * @deprecated
 *
 * @return $this
 */
public function oldMethod()
{
    trigger_error('Method ' . __METHOD__ . ' is deprecated', E_USER_DEPRECATED);

    return $this;
} 
```

phpdoc`@deprecated`很重要，因为许多 IDE（如[PHPStorm）会](https://www.jetbrains.com/phpstorm/)识别它并在您尝试使用它时删除方法名称，因此您会注意到在实际运行代码之前已弃用它。

它或多或少看起来像这样：

[![jetbrains 弃用删除线](https://i.stack.imgur.com/eiMB5.png)](https://i.stack.imgur.com/eiMB5.png)

除了 phpdoc，您还可以通过在运行时触发正确的错误来确保用户收到警告。只要确保您使用正确的常量（即`E_USER_DEPRECATED`）。

`E_DEPRECATED`而是由 PHP 在内部使用，因此您**不**应该使用它。更多信息[在这里](http://php.net/manual/en/errorfunc.constants.php#errorfunc.constants.errorlevels.e-deprecated-error)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-11T15:02:27.990

如果我理解正确，您想在使用内置 PHP 函数时触发错误？在这种情况下，请查看[Override Function](http://no.php.net/manual/en/function.override-function.php)函数。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-11T14:30:31.517

我自己没有检查过，但在我的书签中找到了这个：[http ://wiki.php.net/rfc/e-user-deprecated-warning](http://wiki.php.net/rfc/e-user-deprecated-warning)

编辑：好的，这还不行——所以不要使用 E_USER_DEPRECATED，而是使用 E_USER_NOTICE 之类的东西：

```
<?php
class Foo
{   
    public function __construct()
    {
        trigger_error('Use Bar instead', E_USER_NOTICE);
    }
}

$foo = new Foo() 
```

这最终会是这样的：

```
Notice: Use Bar instead in /home/unexist/projects/ingame/svn/foo.php on line 6 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-11T14:35:27.513

如果您的函数是类的一部分，那么您可以在构造函数中使用[trigger_error](http://www.php.net/trigger_error)来警告弃用。

或者，如果函数位于单个文件中，则在文件顶部触发弃用警告将在文件包含在其他位置时显示错误。

最后，您可以在任何不推荐使用的函数的第一行抛出错误。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-11T15:28:50.213

您可以考虑编写一个脚本，而不是在使用时发出运行时警告，该脚本可以扫描您的代码库以使用此函数，然后生成违规代码的报告。时不时地跑一遍。

如果您使用版本控制系统，您可以将脚本设置为提交挂钩。我可能会推荐一个 post-hook，它只是发送一封电子邮件，当包含已弃用函数的脚本被签入时，但是如果你真的想强制执行它，你可以有一个 pre-hook 完全阻止任何人签入它.

# java - Ant 仍然是 Java 构建工具的最佳选择吗？

> ID：194125
> 
> 赞同：21
> 
> 时间：2008-10-11T14:29:14.687
> 
> 标签：java, ant, build, build-management

根据我的少量经验，我只使用 Ant 作为构建工具。还有其他更好的项目吗，为什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-11T14:31:50.300

[马文](http://maven.apache.org/)

它比 ant 好得多，因为对于大多数常见任务，您不必编写复杂的 build.xml，maven 具有非常好的默认值，并且都是约定优于配置。

它还有一个大型的库中央存储库，并且很容易将其配置为“使用最新的稳定公共资源”。然后，Maven 将为您下载最新的稳定版本（不再将 jar 签入 VCS），如果发布了新的上游稳定版本，它也会下载它。当然，如果您需要，也可以很容易地将其锁定到某个特定版本。

它还与 Netbeans 和 Eclipse（m2eclipse 插件）很好地集成，因此 IDE 支持您在 pom.xml 文件中声明的任何设置（包括依赖项）。

maven 也有一些缺点：一些插件的文档记录很差，与两个 IDE 的集成并不是很完美，而且在不同的方面，一些错误消息可能难以理解。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-11T16:11:56.353

蚂蚁仍然是主要参与者。根据我的经验，它占主导地位。另外，借助 Ivy，它可以处理 Maven 的一些优势。IMO，Ant 将成为其他工具的框架：XML 太死板（见下面的链接）。

Maven 2 也是一个主要参与者。我认识一些人，他们非常喜欢它，并对 Maven 1 的正确批评感到愤怒（它已经走了很长一段路）。

Groovy 在构建空间中提供了一些很酷的东西，因为它们构建在 Ant 之上。Gant 在 Grails 中使用，但可能包含在 Gradle 中。这些也可以用于 Java。

冒着对我自己的博客进行拉皮条的风险，[这里有一篇](http://codetojoy.blogspot.com/2008/10/ant-vs-maven-episode-2-gant-or-gradle.html)关于 Gant 和 Gradle 的文章。这是关于他们未来的[当前辩论的链接。](http://www.nabble.com/Gant-and-Gradle-td19810302.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-11T18:24:18.410

在企业中，蚂蚁仍然是盘踞者。依赖关系不会快速变化。与不断迁移到相当最新版本的依赖 jar 的开源项目不同，大多数企业尽量不要太快地更改它们的依赖关系。鉴于此，与 ant 相比，maven 的优势并不算多。

再说一次，如果你想要一些 maven 的特性，ant 的人有 ivy ( [http://ant.apache.org/ivy/](http://ant.apache.org/ivy/) ) 的依赖特性。

如果您想继续使用 ant，请获取“ANT IN ACTION”，第 2 版，以便您可以使用 ant 获得最佳生产力。

祝你好运，

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-11T14:41:34.630

有些人喜欢[Ivy](http://ant.apache.org/ivy/)，它是 Ant 的依赖管理东西，所以我想来自 Ant 背景的人会喜欢它。

其他人喜欢[Buildr](http://incubator.apache.org/buildr/)。这是一个 JRuby 的东西，所以如果你可以在同一个项目中兼顾 Ruby 和 Java，那么我想它会很有趣。

就个人而言，我只使用[Maven](http://maven.apache.org/)。创建一个默认的 pom.xml 文件并让所有构建命令供您使用很容易。当项目增长时，您已经拥有运行插件和添加依赖项的基础设施。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-11T22:16:55.210

你也有[甘特](http://gant.codehaus.org)。Gant 是 Groovy + Ant，你可以用普通的 groovy 编写任务，也可以调用任何 ant 任务。如果你是一个 Java 商店，想重用你拥有的 ant 技能但不喜欢 XML，我推荐 Gant，它很容易设置，你可以将它嵌入到 ant 中（也可以从 ant 调用 gant）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-11T15:05:24.803

我真的很喜欢[SCons](http://www.scons.org/)，它是一个构建工具，其配置文件都是 Python 脚本。这将吸引任何了解 Python 或类似脚本语言的人。SCons 旨在与 Java 以及 C/C++ 和其他语言一起很好地工作，过去我对它非常满意。

因为 SCons 文件是用 Python 编写的，所以如果您发现自己需要做一些特别的事情，您可以编写任意 Python 代码。但是，如果您对 Python 完全不熟悉，那么学习曲线可能比尝试扩展 Ant 或类似的东西来做您想做的事情要高。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-11T16:00:27.657

Maven2 似乎是新兴事物。

然而，对于我们的项目，我们将在可行的情况下迁移回 ant。

Maven2 需要相当多的知识才能完全按照您想要的方式获得它，并且 Maven2 版本似乎以不同的方式处理类路径。

并且检查可能被引入的依赖项的依赖项中包含的所有许可证是一件痛苦的事情。

并且可能启动时间较慢，因为您需要自己弄清楚依赖关系，但至少它易于阅读。这里没有魔法:)

如果您确实使用 maven，请考虑像 Nexus 这样的内部存储库。这样，如果某些库决定离开网络*，您的软件就不会死掉。

*我们被 maven1 烧毁了；ibiblio maven1 存储库重定向并且 maven1 不支持重定向:(

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T14:49:11.013

在考虑正确的工具时，我会敦促您从您的要求开始。每个项目都不一样，你使用的工具应该反映问题空间而不是时尚。

话虽如此，我认为对于一般用途而言，ant 仍然可能是构建 java 应用程序的最佳通用工具。它通常与其他依赖管理工具一起有效地使用，但我们再次绕过解决方案而没有问题。

好消息是，如果您的过程很好，切换构建工具是一个相当轻松的过程 - 课程 - 从一个适合手头问题的良好过程开始。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-11T16:07:18.687

您会在[什么是一些好的 java make 实用程序中找到一些答案？](https://stackoverflow.com/questions/169293/what-are-some-good-java-make-utilities "有哪些好的 java make 实用程序？").

# c# - C#如何获取其他批处理文件的输出？

> ID：194127
> 
> 赞同：5
> 
> 时间：2008-10-11T14:29:40.490
> 
> 标签：c#, io

我必须使用其他应用程序（控制台）将一些参数传递给该程序，并在我的 C# 程序中获取该程序的输出。我不想看到控制台（对用户来说都是不可见的）。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-11T14:30:25.667

```
Process myProcess = new Process();
ProcessStartInfo myProcessStartInfo = new ProcessStartInfo("YOUPROGRAM_CONSOLE.exe" );
myProcessStartInfo.UseShellExecute = false;
myProcessStartInfo.RedirectStandardOutput = true;
myProcess.StartInfo = myProcessStartInfo;
myProcess.Start();

StreamReader myStreamReader = myProcess.StandardOutput;
string myString = myStreamReader.ReadLine();
Console.WriteLine(myString);
myProcess.Close(); 
```

资料来源：[MSDN](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.standardoutput.aspx)

编辑：如果您需要获取错误消息，您将需要使用异步操作。您可以使用异步读取操作来避免这些依赖关系及其潜在的死锁。或者，您可以通过创建两个线程并在单独的线程上读取每个流的输出来避免死锁情况。

# winapi - Win32 WM_SETCURSOR，WM_MOUSEMOVE 总是成对的？

> ID：194133
> 
> 赞同：5
> 
> 时间：2008-10-11T14:33:33.103
> 
> 标签：winapi, controls

我正在开发一个 Win32 控件。此控件上可能有数百个“项目”。这些不是窗口，而是内部对象（例如：矩形）。根据鼠标位置，我想更改鼠标光标。没关系，我可以使用 WM_SETCURSOR。

同时基于鼠标移动，我想显示一个状态栏，显示当前鼠标下对象的详细信息。为此，我可以使用 WM_MOUSEMOVE。

因为可能有数百个项目，所有项目都在鼠标下找到一个，所以效率不高，尤其是两次（一个用于设置光标，一个用于鼠标移动）。

简而言之，您知道 WM_SETCURSOR 和 WM_MOUSEMOVE 是否**总是**成对出现吗？在那种情况下，我可以在 WM_SETCURSOR 期间计算出我想要的。另一种选择是在 WM_MOUSEMOVE 期间设置鼠标光标，但据我所知，这不是一个好的解决方案（会闪烁）。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-07T10:35:53.760

您也可以尝试`GetMessagePos()`（给出光标屏幕坐标），然后`MapWindowPoints()`看看它是否在热矩形中，或类似的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T15:49:52.247

最重要的是您的窗口消息处理程序不应该担心持有或计算任何东西。您应该简单地向应用程序的逻辑发出鼠标可能位于新区域上的信号并使其找到对象。一旦找到热点区域（或多个），缓存其（它们的）边界并检查以下鼠标移动。一旦鼠标从其中之一移出，您就可以重建您的热对象列表。

您不必在每次鼠标移动时都在控件中寻找热点区域。

如果可以有许多对象共享同一区域，则存在 z 顺序问题。当您创建这些对象并处理它们的运动时，请考虑一下。

此外，您应该考虑一个有效的数据结构来保存对象坐标，这样您就不必在每次寻找*热门*对象时检查每个对象。

只是我的两欧元。;)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T14:42:47.030

虽然它们目前可能总是成对出现，但您可能不能依赖这种行为。

您可以在 WM_MOUSEMOVE 期间设置光标（使用 SetCursor），它不会闪烁，只要（IIRC），您从 WM_SETCURSOR 返回 TRUE 而不做任何事情（即您吃消息），并且您的窗口没有类光标分配给它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T14:51:26.843

有没有办法缓存找到的最后一个项目，如果光标在同一个地方，可以快捷地查找？那将是最强大的解决方案。

# c# - 是否有充分的理由不使用 ORM？

> ID：194147
> 
> 赞同：113
> 
> 时间：2008-10-11T14:43:03.753
> 
> 标签：c#, orm, enterprise

在我的学徒期间，我将[NHibernate](http://nhibernate.org/ ".NET 的 NHibernate")用于一些较小的项目，这些项目主要是我自己编码和设计的。现在，在开始一些更大的项目之前，讨论了如何设计数据访问以及是否使用 ORM 层。由于我仍处于学徒阶段，并且仍然认为自己是企业编程的初学者，因此我并没有真正尝试提出自己的观点，即使用对象关系映射器到数据库可以大大简化开发。开发团队的其他编码人员比我更有经验，所以我想我会照他们说的做。:-)

但是，我不完全理解不使用 NHibernate 或类似项目的两个主要原因：

1.  可以使用 SQL 查询构建自己的数据访问对象，然后将这些查询复制到 Microsoft SQL Server Management Studio 之外。
2.  调试 ORM 可能很困难。

所以，当然我可以用很多`SELECT`s 等来构建我的数据访问层，但是在这里我错过了自动连接、延迟加载代理类以及如果表获得新列或列获得的维护工作量较低的优势重命名。（更新大量`SELECT`,`INSERT`和`UPDATE`查询与更新映射配置并可能重构业务类和 DTO。）

此外，如果您不太了解该框架，使用 NHibernate 可能会遇到无法预料的问题。例如，这可能是信任 Table.hbm.xml，您在其中设置了要自动验证的字符串长度。但是，我也可以想象一个“简单”的基于 SqlConnection 查询的数据访问层中的类似错误。

最后，上面提到的那些论点真的是一个很好的理由不将 ORM 用于基于数据库的非平凡的企业应用程序吗？他们/我可能错过了其他论点吗？

（我可能应该补充一点，我认为这就像第一个需要团队合作的基于 .NET/C# 的“大型”应用程序。在 Stack Overflow 上被视为非常正常的良好实践，例如单元测试或持续集成，是非- 到现在为止。）

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-11T15:12:16.753

简短的回答是肯定的，确实有充分的理由。事实上，在某些情况下您不能使用 ORM。

举个例子，我在一家大型企业金融机构工作，我们必须遵循很多安全准则。为了满足对我们施加的规则和规定，通过审核的唯一方法是将数据访问保持在存储过程中。现在有些人可能会说这简直是愚蠢的，但老实说并非如此。使用 ORM 工具意味着工具/开发人员可以插入、选择、更新或删除他或她想要的任何内容。存储过程提供了更多的安全性，尤其是在处理客户端数据的环境中。我认为这是考虑的最大原因。安全。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2010-07-07T15:29:15.187

**ORM 的最佳选择**

ORM 对于自动化 95% 以上的查询非常有用。它们的特殊优势在于您拥有一个具有强大对象模型架构的应用程序和一个可以很好地与该对象模型配合使用的数据库。如果你正在做一个新的构建并且你的团队有很强的建模技能，那么你可能会用 ORM 获得很好的结果。

您可能有一些最好手动完成的查询。在这种情况下，不要害怕编写一些存储过程来处理这个问题。即使您打算跨多个 DBMS 平台移植您的应用程序，依赖于数据库的代码也将是少数。请记住，您将需要在您打算支持它的任何平台上测试您的应用程序，一些存储过程的一些额外移植工作不会对您的 TCO 产生太大影响。对于第一个近似值，98% 的可移植性与 100% 的可移植性一样好，并且远远优于绕过 ORM 限制的复杂或性能不佳的解决方案。

我已经看到前一种方法在一个非常大的（100 个员工年）J2EE 项目中运行良好。

**ORM 可能不是最适合的地方**

在其他情况下，可能存在比 ORM 更适合应用程序的方法。Fowler 的*企业应用程序架构模式*有一节关于数据访问模式，它很好地对各种方法进行了分类。我见过的一些 ORM 可能不适用的例子是：

*   在具有大量存储过程遗留代码库的应用程序上，您可能希望使用面向功能的（不要与函数式语言混淆）数据访问层来包装现有的存储过程。这重用了现有（因此经过测试和调试）的数据访问层和数据库设计，这通常代表着相当大的开发和测试工作，并且不必将数据迁移到新的数据库模型。这通常是一种很好的方法，将 Java 层包裹在遗留的 PL/SQL 代码库中，或者使用 Web 界面重新定位富客户端 VB、Powerbuilder 或 Delphi 应用程序。

*   变体是您继承不一定非常适合 OR 映射的数据模型。如果（例如）您正在编写一个从外部接口填充或提取数据的接口，那么您最好直接使用数据库。

*   跨系统数据完整性很重要的金融应用程序或其他类型的系统，尤其是当您使用具有两阶段提交的复杂分布式事务时。您可能需要比 ORM 能够支持的更好地微观管理您的事务。

*   您想要真正调整数据库访问的高性能应用程序。在这种情况下，最好在较低级别工作。

*   在您使用现有数据访问机制（如 ADO.Net）的情况下，它“足够好”并且可以很好地使用该平台，这比 ORM 带来的好处更大。

*   有时数据只是数据 - 可能是（例如）您的应用程序正在使用“事务”而不是“对象”，这是域的明智视图。这方面的一个例子可能是一个财务包，其中您有带有可配置分析字段的交易。虽然应用程序本身可能构建在 OO 平台上，但它并不依赖于单个业务域模型，并且可能不知道的不仅仅是 GL 代码、帐户、文档类型和六个分析字段。在这种情况下，应用程序不知道业务领域模型本身，并且对象模型（超出分类帐结构本身）与应用程序无关。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2008-10-17T17:36:34.167

首先 - 使用 ORM 不会使您的代码更容易测试，也不一定会在持续集成场景中提供任何优势。

根据我的经验，虽然使用 ORM 可以提高开发速度，但您需要解决的最大问题是：

1.  测试你的代码
2.  维护你的代码

这些问题的解决方案是：

1.  使您的代码可测试（使用[SOLID](http://www.lostechies.com/blogs/chad_myers/archive/2008/03/07/pablo-s-topic-of-the-month-march-solid-principles.aspx "Chad Meyer 的 SOLID 概述")原则）
2.  为尽可能多的代码编写自动化测试
3.  尽可能频繁地运行自动化测试

谈到您的问题，您列出的两个反对意见似乎更像是无知而不是其他任何东西。

无法手动编写 SELECT 查询（我想这就是需要复制粘贴的原因）似乎表明迫切需要一些 SQL 培训。

我不使用 ORM 的原因有两个：

1.  公司政策严禁（这种情况下我会去其他地方工作）
2.  该项目是数据*密集型*的，使用供应商特定的解决方案（如 BulkInsert）更有意义。

通常对 ORM（尤其是 NHibernate）的拒绝是：

1.  速度

    没有理由使用 ORM 会比手动编码的数据访问慢。事实上，由于内置了缓存和优化，它可以更快。一个好的 ORM 将生成一组可重复的查询，您可以针对这些查询优化您的架构。一个好的 ORM 还将允许使用各种获取策略有效地检索相关数据。

2.  复杂

    关于复杂性，使用 ORM 意味着更少的代码，这通常意味着更少的复杂性。许多使用手写（或代码生成）数据访问的人发现自己在“低级”数据访问库上编写自己的框架（例如为 ADO.Net 编写辅助方法）。这些等同于更复杂，更糟糕的是，它们很少有很好的文档记录或经过很好的测试。
    如果您专门研究 NHibernate，那么 Fluent NHibernate 和 Linq To NHibernate 等工具也可以缓和学习曲线。

让我对整个 ORM 辩论感到震惊的是，那些声称使用 ORM 会太难/太慢/无论如何的人，正是那些非常乐意使用 Linq To Sql 或 Typed Datasets 的人。虽然 Linq To Sql 是朝着正确方向迈出的一大步，但它仍然落后于一些开源 ORM 的光年。但是，Typed Datasets 和 Linq To Sql 的框架仍然非常复杂，并且使用它们来超越 (Table=Class) + (basic CRUD) 是非常困难的。

我的建议是，如果在一天结束时，您无法获得 ORM，那么请确保您的数据访问与其他代码分开，并且您遵循四人组的编码建议一个界面。另外，获取一个依赖注入框架来进行连接。

（咆哮怎么样？）

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2008-10-11T15:29:47.327

对于许多常见问题，像 Hibernate 这样的 ORM 工具是天赐之物，而在少数情况下它是一个障碍。我对你的项目了解得不够多，不知道它是什么。

Hibernate 的优势之一是您只能说 3 次：在类、.hbm.xml 文件和数据库中提到每个属性。使用 SQL 查询，您的属性位于类、数据库、选择语句、插入语句、更新语句、删除语句以及支持 SQL 查询的所有编组和解组代码中！这可能会很快变得混乱。另一方面，你知道它是如何工作的。你可以调试它。这一切都在您自己的持久层中，而不是埋在第 3 方工具的内部。

Hibernate 可能是 Spolsky 的泄漏抽象定律的典型代表。稍微偏离常规，您需要了解该工具的深层内部工作原理。当您知道您可以在几分钟内修复 SQL 时，这可能会非常烦人，但是您却花费数小时试图诱使您的 dang 工具生成合理的 SQL。调试有时是一场噩梦，但很难说服没有去过那里的人。

编辑：如果他们不想改变 NHibernate 并且他们想要控制他们的 SQL 查询，你可能想要研究 iBatis.NET。

编辑 2：不过，这是一个大红旗：“到目前为止，在 Stack Overflow 上被视为非常正常的良好做法，例如单元测试或持续集成，在这里都不存在。” 那么，这些“经验丰富”的开发者，他们在开发过程中有哪些经验呢？他们的工作保障？听起来您可能属于对该领域并不特别感兴趣的人，所以不要让他们扼杀您的兴趣。你需要保持平衡。投入了战斗。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-10-11T14:55:33.450

近年来，ORM 出现了爆炸式增长，您更有经验的同事可能仍在思考“每个数据库调用都应该通过存储过程”的心态。

为什么 ORM 会让事情变得更难调试？无论是来自存储过程还是来自 ORM，您都会得到相同的结果。

我想我能想到的唯一真正的 ORM 缺点是安全模型不太灵活。

**编辑：**我刚刚重新阅读了您的问题，看起来他们正在将查询复制并粘贴到内联 sql 中。这使得安全模型与 ORM 相同，因此与 ORM 相比，这种方法绝对没有优势。如果他们使用未参数化的查询，那么这实际上是一个安全风险。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-10-11T15:14:06.813

我在一个不使用 ORM 的项目上非常成功。这是一个项目

1.  从一开始就必须是水平缩放的
2.  必须快速开发
3.  有一个相对简单的领域模型

让 NHibernate 在水平分区结构中工作所花费的时间比开发一个了解我们的分区方案的超级简单数据映射器所花费的时间要长得多......

因此，在我从事的 90% 的 ORM 项目中，它都提供了宝贵的帮助。但是在一些非常具体的情况下，我认为不使用 ORM 是最好的。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-10-11T15:46:51.287

首先让我说，如果正确集成，ORM 可以使您的开发生活更轻松，但是在一些问题中，ORM 实际上会阻止您实现既定的要求和目标。

我发现，在设计对性能要求很高的系统时，我经常面临着寻找提高系统性能的方法的挑战。很多时候，我最终得到的解决方案具有高写入性能配置文件（这意味着我们写入数据的次数远远多于读取数据的次数）。在这些情况下，我想利用数据库平台为我提供的设施来达到我们的性能目标（它是 OLTP，而不是 OLAP）。因此，如果我使用 SQL Server 并且我知道我有很多数据要写入，我为什么不使用批量插入...好吧，正如您可能已经发现的那样，大多数 ORMS（我不知道是否即使是一个也没有）没有能力利用平台特定的优势，如批量插入。

您应该知道您可以混合使用 ORM 和非 ORM 技术。我刚刚发现有少数 ORM 无法支持您的要求的边缘情况，您必须针对这些情况解决它们。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2012-10-17T04:05:13.580

## 对于一个重要的基于数据库的企业应用程序，确实没有理由不使用 ORM。

除了特点：

*   通过不使用 ORM，您正在解决一个已经被拥有大量资源的大型社区或公司反复解决的问题。
*   通过使用 ORM，您的数据访问层的核心部分可以从该社区或公司的调试工作中受益。

为了在争论中提出一些观点，请考虑使用 ADO.NET 与编写代码自己解析表格数据流的优势。

我已经看到对如何使用 ORM 的无知证明开发人员对 ORM 的蔑视是正当的，例如：急切加载（我注意到你没有提到）。想象一下，您想要检索一个客户和他们的所有订单，以及所有这些订单详细信息项目。如果您只依赖延迟加载，您将离开您的 ORM 体验，并认为：“ORM 很慢”。如果你学会了如何使用急切加载，你将在 2 分钟内用 5 行代码完成，而你的同事将需要半天时间来实现：对数据库进行一次查询并将结果绑定到对象层次结构。另一个例子是手动编写 SQL 查询来实现分页的痛苦。

使用 ORM 的可能例外情况是，如果该应用程序是一个 ORM 框架，旨在应用专门的业务逻辑抽象，并且旨在在多个项目中重用。但是，即使是这种情况，您也可以通过使用这些抽象增强现有 ORM 来更快地采用。

不要让您的高级团队成员的经验将您拖向计算机科学发展的相反方向。我在专业上发展了 23 年，其中一个不变的就是老派对新的不屑一顾。ORM 之于 SQL 就像 C 语言之于汇编一样，您可以打赌，C++ 和 C# 的等价物正在开发中。一行新式代码等于 20 行旧式代码。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2010-10-26T21:30:39.050

当您需要更新 50000000 条记录时。设置一个标志或其他任何东西。

尝试使用 ORM 执行此操作，**而不**调用存储过程或本机 SQL 命令。

更新 1：也尝试检索仅包含少数字段的记录。（当你有一个非常“宽”的桌子时）。或标量结果。ORM 在这方面也很烂。

**更新 2**：似乎 EF 5.0 beta 承诺批量更新，但这是非常热门的新闻（2012 年 1 月）

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-10-16T03:36:42.193

我认为也许当您在更大的系统上工作时，您可以使用 CodeSmith 之类的代码生成器工具而不是 ORM... 我最近发现了这个：[Cooperator Framework](http://www.codeplex.com/cooperator)，它生成 SQL Server 存储过程并生成您的业务实体、映射器、网关， lazyload 和 C# 中的所有内容...检查一下...它是由阿根廷的一个团队编写的...

我认为它介于编码整个数据访问层和使用 ORM 之间......

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-11T16:09:00.400

就个人而言，我（直到最近）反对使用 ORM，并且习惯于编写一个封装所有 SQL 命令的数据访问层。对 ORM 的主要反对意见是我不相信 ORM 实现可以编写完全正确的 SQL。而且，从我曾经看到的 ORM（主要是 PHP 库）来看，我认为我是完全正确的。

现在，我的大部分 Web 开发都使用 Django，我发现包含的 ORM 非常方便，而且由于数据模型首先用他们的术语表示，然后才用 SQL 表示，它确实可以很好地满足我的需求。我相信它不会太难超越它并且需要用手写SQL来补充；但对于 CRUD 访问来说绰绰有余。

我不知道 NHibernate；但我想它对于您需要的大部分内容也“足够好”。但是如果其他编码人员不信任它；它将成为每个与数据相关的错误的主要嫌疑人，使验证更加乏味。

您可以尝试在您的工作场所逐步引入它，首先关注小型“显而易见”的应用程序，例如简单的数据访问。一段时间后，它可能会用在原型上，并且可能不会被替换......

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-02T20:32:30.627

如果它是一个 OLAP 数据库（例如，用于报告/分析的静态、只读数据等），那么实现 ORM 框架是不合适的。相反，最好使用数据库的本机数据访问功能，例如存储过程。ORM 更适合事务 (OLTP) 系统。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2012-01-31T19:31:45.957

我认为不使用 ORM 有很多充分的理由。首先，我是一名 .NET 开发人员，我喜欢坚持出色的 .NET 框架已经为我提供的内容。它可以完成我可能需要的一切。通过这样做，您可以使用更标准的方法，因此在同一项目上工作的任何其他开发人员都有更好的机会能够拾取那里的内容并使用它运行。微软已经提供的数据访问能力相当丰富，没有理由放弃它们。

我已经是 10 年的专业开发人员，领导了多个非常成功的数百万美元以上的项目，而且我从未编写过需要能够切换到任何数据库的应用程序。为什么你会希望客户这样做？仔细计划，根据您的需要选择正确的数据库，并坚持下去。就个人而言，SQL Server 已经能够完成我曾经需要做的任何事情。这很简单，而且效果很好。甚至还有支持高达 10GB 数据的免费版本。哦，它与 .NET 配合得非常好。

我最近不得不开始从事几个使用 ORM 作为数据层的项目。我认为这很糟糕，而且我不得不无缘无故地学习如何使用一些额外的东西。在客户确实需要更改数据库的极其罕见的情况下，我可以轻松地在比我花在与 ORM 提供者愚弄上花费的时间更短的时间内重新设计整个数据层。

老实说，我认为 ORM 有一个真正的用途：如果您正在构建像 SAP 这样的应用程序，它确实需要能够在多个数据库上运行。否则，作为解决方案提供商，我会告诉我的客户这个应用程序设计为在这个数据库上运行，就是这样。再一次，经过 10 年和无数次的申请，这从来都不是问题。

否则，我认为 ORM 适合那些不了解少即是多的开发人员，并认为他们在应用程序中使用的 3rd 方工具越酷，他们的应用程序就会越好。我会把这样的事情留给顽固的超级极客，同时我会开发出更多优秀的软件，同时任何开发人员都可以拿起并立即投入使用。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-10-11T16:08:54.207

ORM 有两个方面令人担忧。首先，它们是由其他人编写的代码，有时是封闭源代码，有时是开源代码，但范围很大。其次，他们复制数据。

第一个问题导致两个问题。您正在依赖外部代码。我们都这样做，但选择这样做不应该掉以轻心。如果它不能满足您的需求怎么办？你什么时候会发现这个？你住在你的 ORM 为你绘制的盒子里。

第二个问题是两阶段提交之一。正在将关系数据库复制到对象模型。您更改了对象模型，它应该更新数据库。这是一个两阶段提交，而不是最容易调试的事情。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-10-11T15:16:29.490

运行时性能是我能想到的唯一真正的缺点，但我认为这不仅仅是一个公平的权衡，因为 ORM 为您节省了开发/测试/等时间。在大多数情况下，您应该能够定位数据瓶颈并更改对象结构以提高效率。

我以前没有使用过 Hibernate，但我注意到一些“现成的”ORM 解决方案的一件事是缺乏灵活性。我敢肯定这取决于您选择哪个以及您需要做什么。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-04-21T19:27:51.853

我建议阅读此书以了解 ORM 的缺点。

[http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx](http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx)

就我自己而言，我发现 ORM 对于我编写的大多数应用程序都非常有用！

/阿斯格

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-05-20T03:36:40.637

我对 Hibernate 的体验是它的语义很微妙，当出现问题时，很难理解引擎盖下出了什么问题。我从朋友那里听说，通常从 Criteria 开始，然后需要更多的灵活性并需要 HQL，后来注意到毕竟需要原始 SQL（例如，Hibernate 没有联合 AFAIK）。

同样使用 ORM，人们很容易过度使用现有的映射/模型，这导致对象具有许多未初始化的属性。所以在查询之后，内部事务 Hibernate 会进行额外的数据获取，这可能会导致速度变慢。同样可悲的是，休眠模型对象有时会泄漏到视图架构层，然后我们会看到 LazyInitializationExceptions。

要使用 ORM，必须真正了解它。不幸的是，人们很容易给人一种很容易的印象，而事实并非如此。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2011-05-08T21:30:23.910

本身不是一个答案，我想改写我最近听到的一句话。“一个好的 ORM 就像一只雪人，每个人都在谈论它，但没有人看到它。”

每当我将手放在 ORM 上时，我通常会发现自己在为那个 ORM 的问题/限制而苦苦挣扎。最后，是的，它做了我想要的，它写在那个糟糕的文档中的某个地方，但我发现自己又浪费了一个小时，我永远不会得到。任何使用过 nhibernate，然后在 postgresql 上使用流利的 nhibernate 的人都会明白我的经历。“这段代码不受我控制”的持续感觉真的很糟糕。

我没有指责或说它们很糟糕，但我开始思考我放弃了什么只是为了在一个表达式中自动化 CRUD。现在我认为我应该少用 ORM，也许创建或找到一个至少可以启用数据库操作的解决方案。但这只是我。我相信在这个 ORM 领域有些事情是错误的，但我没有足够的技能来表达它。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-11T15:16:45.467

我认为使用 ORM 仍然是一个好主意。特别是考虑到你给出的情况。从您的帖子看来，您在数据库访问策略方面更有经验，我会提出使用 ORM。

#1 没有参数，因为复制和粘贴查询以及文本中的硬编码没有灵活性，而对于 #2，大多数 orm 将包装原始异常，允许跟踪生成的查询等，因此调试也不是火箭科学。

至于验证，在任何内置验证之上，使用 ORM 通常还可以更轻松地开发验证策略。

编写自己的框架可能很费力，而且经常会遗漏一些事情。

编辑：我想再强调一点。如果您的公司采用 ORM 策略，这将进一步提高其价值，因为您将制定使用和实施的指南和实践，每个人都将进一步增强他们对所选框架的了解，从而减轻您提出的问题之一。此外，当情况出现时，您将了解哪些有效，哪些无效，最终将节省大量时间和精力。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-02-18T21:52:22.953

每个 ORM，即使是“好的”，都带有一定数量的假设，这些假设与软件用于在应用程序层和数据存储之间来回传递数据的底层机制相关。

我发现对于中等复杂的应用程序，解决这些假设通常比简单地编写更简单的解决方案（例如：查询数据和手动实例化新实体）花费更多时间。

特别是，当您使用多列键或其他适度复杂的关系时，您可能会遇到问题，这些关系刚好超出您的 ORM 在下载代码时为您提供的方便示例的范围。

我承认对于某些类型的应用程序，特别是那些具有大量数据库表或动态生成的数据库表的应用程序，ORM 的自动魔术过程可能很有用。

否则，ORM 就完蛋了。我现在认为它们基本上是一种时尚。

# flash - 检查 SoundChannel 是否正在播放声音

> ID：194150
> 
> 赞同：6
> 
> 时间：2008-10-11T14:46:04.577
> 
> 标签：flash, actionscript-3, audio, soundchannel

如何可靠地检查 SoundChannel 是否仍在播放声音？

例如，

```
[Embed(source="song.mp3")]
var Song: Class;

var s: Song = new Song();
var ch: SoundChannel = s.play();

// how to check if ch is playing? 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-11T21:11:26.590

我做了一些研究，但找不到查询任何对象以确定声音是否正在播放的方法。您似乎必须编写一个包装类并自己管理它。

```
 package
{
    import flash.events.Event;
    import flash.media.Sound;
    import flash.media.SoundChannel;

    public class SoundPlayer
    {
        [Embed(source="song.mp3")]
        private var Song:Class;

        private var s:Song;
        private var ch:SoundChannel;
        private var isSoundPlaying:Boolean;

        public function SoundPlayer()
        {
            s = new Song();
            play();
        }

        public function play():void
        {
            if(!isPlaying)
            {
                ch = s.play();
                ch.addEventListener(
                    Event.SOUND_COMPLETE,
                    handleSoundComplete);
                isSoundPlaying = true;
            }
        }

        public function stop():void
        {
            if(isPlaying)
            {
                ch.stop();
                isSoundPlaying = false;
            }
        }

        private function handleSoundComplete(ev:Event):void
        {
            isSoundPlaying = false;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-05T11:05:08.840

我知道这真的很旧，但我发现这个链接我认为很有帮助。它解释了如何从某个点监视和播放文件。

[http://help.adobe.com/en_US/as3/dev/WS5b3ccc516d4fbf351e63e3d118a9b90204-7d21.html](http://help.adobe.com/en_US/as3/dev/WS5b3ccc516d4fbf351e63e3d118a9b90204-7d21.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-06T17:22:09.360

检查声音是否仍在播放且不使用任何管理器的方法之一是在两个连续的 enterFrame 侦听器调用中检查 soundChannel.position，如果不匹配，则声音仍在播放。

```
private var oldPosition:Number;
function onEnterFrame(e:Event):void {
    var stillPlaying:Boolean;
    var newPosition=soundChannel.position;
    if (newPosition-oldPosition>1) stillPlaying=true; else stillPlaying=false;
    oldPosition=newPosition;
} 
```

# graphics - HCI：超越 WIMP 范式的 UI

> ID：194156
> 
> 赞同：7
> 
> 时间：2008-10-11T14:52:36.387
> 
> 标签：graphics, user-interface, hci, wimp

*随着 Apple iPhone 的流行、Microsoft [Surface的潜力以及](http://www.microsoft.com/surface/index.html)[Perceptive Pixel](http://link.brightcove.com/services/link/bcpid713271701/bclid713073346/bctid709364416)的 Jeff Han 开创的界面的纯粹流动性和创新......*

### 什么是已经超越了图形用户界面的好例子

### 窗口、图标、（鼠标/菜单）和指针范例？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-11T16:19:24.043

您只对 GUI 感兴趣吗？许多研究已经完成并将继续在[有形界面](http://en.wikipedia.org/wiki/Tangible_User_Interface)上进行，例如，它们不属于该类别（尽管它们可以包括计算机图形）。[用户界面 Wikipedia](http://en.wikipedia.org/wiki/User_interface)页面可能是一个不错的起点。您可能还想探索[ACM CHI 会议](http://www.chi2008.org/)。我曾经认识一些从事缩放界面工作的人。马里兰大学的[人机交互实验室](http://www.cs.umd.edu/hcil/research/)也有很多你可能会觉得有趣的链接。

最后我要指出，许多创新的用户界面创意在演示中比在实际使用中效果更好。我提出这一点是因为您的示例，正​​如一些评论者所指出的那样，如果应用不当，可能会厌倦长时间使用。请注意，在大多数情况下，光笔已被老鼠取代。好的设计有时会违背天真的直觉（无论如何都是我的）。[关于useit.com](http://useit.com)上的 3d 图形，关于这个主题有一个很好的[咆哮](http://www.useit.com/alertbox/981115.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-30T12:09:01.390

根据Andries van Dam[的同名论文，从](http://portal.acm.org/citation.cfm?id=253708)技术上讲，您正在寻找的界面可能称为**Post-WIMP 用户界面。**我们需要其他范式的原因是 WIMP 不够好，尤其是对于一些特定的应用程序，例如 3D 模型操作。

对于那些认为 UI 研究只能构建看起来很酷但不实用的演示[的人来说，第一款鼠标](http://en.wikipedia.org/wiki/File:Firstmouseunderside.jpg)体积庞大，并且花了几十年的时间才流行起来。发明者道格拉斯·恩格尔巴特（Douglas Engelbart）还认为，人们会同时使用鼠标和（简称）键盘。这表明即使是该领域的先驱者也对未来抱有错误的看法。

由于我们还处于 WIMP 时代，对于未来将如何发展，有各种各样的评论（而且大多数肯定是错误的）。请在 Google 中搜索这些关键字以获取更多详细信息。

*   **通过示例/演示进行编程**
    简而言之，在这种范式中，用户展示了他们想要做什么，计算机将学习新的行为。

*   **3D 用户界面**
    我想每个人都知道并且之前已经看过很多这个界面的例子。尽管对其有用性进行了很多激烈的争论，但正在进行的 3D 界面研究的一部分已被实施到许多领先的操作系统中。最先进的可能是**BumpTop**。另请参阅：**缩放用户界面**

*   **基于笔/基于草图/基于手势的计算**
    虽然此界面可能使用与 WIMP 相同的硬件设置，但用户通过信息更丰富的笔画而不是点击来命令。

*   **直接触摸用户界面**
    这就像 Microsoft 的 Surface 或 Apple 的 iPhone，但它不必在桌面上。交互式表面可以是垂直的，比如墙壁，也可以不平坦。

*   **有形的用户界面** 这已经在另一个答案中提到过。这可以很好地与触摸表面、一组计算机视觉系统或增强现实配合使用。

*   **语音用户界面**、**移动计算**、**可穿戴计算机**、**无处不在/普适计算**、**人机交互**等。

更多信息： Jakob Nielsen (1993) 的[Noncommand User Interface](http://www.useit.com/papers/noncommand.html)是关于该主题的另一篇开创性论文。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-30T12:25:42.443

如果您想了解有关 GUI 的一些理论概念，请考虑查看 Tuomo Valkonen 的[vis](http://modeemi.fi/~tuomov/vis/)。Tuomo长期以来一直对WIMP概念持批评态度，他开发了[离子窗口管理器](http://en.wikipedia.org/wiki/Ion_(window_manager))，这是周围众多[平铺窗口管理器](http://en.wikipedia.org/wiki/Tiling_window_manager)之一。如果使用得当，平铺 WM 实际上是对用户的性能提升。

Vis 是真正适应特定用户或其环境需求的 UI 概念，包括视力障碍、触觉偏好（鼠标或键盘）、首选语言（以更好地适应从右到左的语言）、首选视觉呈现（按钮顺序、mac 风格或 windows 风格）、更好地利用可用空间、企业标识等。UI 定义是无显示的，唯一允许的就是输入/输出参数及其关系。GUI 本身的布局算法和人体工程学约束在系统级别和用户偏好中只定义一次。本质上，只要明确定义了要显示的数据，这允许任何类型的 GUI。移动设备的 GUI 与文本终端 UI 和语音界面同样可能。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-30T13:06:35.027

[鼠标手势](http://en.wikipedia.org/wiki/Mouse_gesture)怎么样？

一个有点不为人知、相对较新且被高度低估的 UI 功能。由于不可见，它们的学习曲线往往比图标更陡峭（如果没有人告诉你它们存在，它们会保持不可见），但对于更有经验的用户来说可以节省时间（当我必须浏览时，我会感到非常恼火没有鼠标手势）。

这有点像鼠标的热键。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-02T11:19:38.803

坚持使用 GUI 会限制硬件的物理特性。用户必须能够阅读屏幕并以某种方式做出响应。以 iPhone 为例：它的接口是整个顶面，所以物理尺寸和 IxD 是相反的因素。

圣诞节前后，我写了一篇论文，探讨了可穿戴 BCI 控制设备的潜力。现在，我并不是说我们已经准备好开始建造这样的设备，但吸取的教训是有效的。我发现大多数用户都喜欢使用语言作为主要交互媒介的想法。*但至关重要的是，所有人都表达了对模棱两可*和*确认*的担忧。

WIMP 范式依赖于非常精确、明确的动作——通常是按下按钮。此外，正如尼尔森提醒我们的那样，良好的反馈至关重要。WIMP 系统通常非常擅长（或至少有可能）立即宣布用户操作的接收和结果。

为了逃避这些成对的需求，我们似乎真的需要编写用户可以*信任*的软件。这可能意味着了解上下文，或者可能意味着拥有某种基于英语子集的结构化查询语言，或者可能意味着完全不同的东西。不过，这肯定意味着，我们将摆脱桌面，最终能够部署无缝集成的计算体验。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-03T06:11:27.920

[NUI Group](http://nuigroup.com)的人员主要致力于多点触控界面，您可以看到一些现代、更人性化设计的好例子（不包括没完没了的照片组织应用程序演示；））。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T07:09:03.327

人们习惯了 WIMP，另一个主要问题是大多数其他“酷”接口都需要专门的硬件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-12T21:49:27.683

我不从事新闻业；我以写软件为生。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-30T13:12:37.620

呸！

它绝对在 WIMP 的范围之外，但它是否超出它或远远落后于它取决于判断！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-05-13T16:37:57.383

我会推荐以下论文：

Jacob, RJ, Girouard, A., Hirshfield, LM, Horn, MS, Shaer, O., Solovey, ET 和 Zigelbaum, J. 2008。基于现实的交互：后 WIMP 界面的框架。在第二十六届 SIGCHI 年度计算系统人为因素会议上（意大利佛罗伦萨，2008 年 4 月 5 日至 10 日）。志'08。ACM，纽约，纽约，201-210。见[DOI](http://doi.acm.org/10.1145/1357054.1357089)

# c# - C# - 如何在 Windows 64 位上获取程序文件 (x86)

> ID：194157
> 
> 赞同：153
> 
> 时间：2008-10-11T14:53:12.563
> 
> 标签：c#, windows, file, 64-bit

我正在使用：

```
FileInfo(
    System.Environment.GetFolderPath(
        System.Environment.SpecialFolder.ProgramFiles) 
    + @"\MyInstalledApp" 
```

为了确定是否在用户机器上检测到程序（这并不理想，但我正在寻找的程序是 MS-DOS 应用程序的正确旧组合，我想不出另一种方法）。

在 Windows XP 和 32 位版本的 Windows Vista 上，这可以正常工作。但是，在 x64 Windows Vista 上，代码返回 x64 Program Files 文件夹，而应用程序安装在 Program Files x86 中。有没有办法以编程方式返回 Program Files x86 的路径而无需硬连线“C:\Program Files (x86)”？

* * *

## 回答 #1

> 赞同：233
> 
> 时间：2008-10-11T15:45:38.387

`Program Files`下面的函数将返回所有这三个 Windows 配置中的 x86目录：

*   32 位 Windows
*   在 64 位 Windows 上运行的 32 位程序
*   在 64 位窗口上运行的 64 位程序

```
static string ProgramFilesx86()
{
    if( 8 == IntPtr.Size 
        || (!String.IsNullOrEmpty(Environment.GetEnvironmentVariable("PROCESSOR_ARCHITEW6432"))))
    {
        return Environment.GetEnvironmentVariable("ProgramFiles(x86)");
    }

    return Environment.GetEnvironmentVariable("ProgramFiles");
} 
```

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2010-12-22T21:58:44.937

如果您使用的是 .NET 4，则有一个特殊的文件夹枚举[ProgramFilesX86](http://msdn.microsoft.com/en-us/library/system.environment.specialfolder.aspx)：

```
Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86) 
```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2010-12-14T18:02:52.753

```
Environment.GetEnvironmentVariable("PROGRAMFILES(X86)") ?? Environment.GetFolderPath(Environment.SpecialFolder.ProgramFiles) 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-11T15:19:56.787

但是请注意，`ProgramFiles(x86)`环境变量仅在您的应用程序运行 64 位时可用。

如果您的应用程序运行 32 位，您可以只使用`ProgramFiles`其值实际上是“Program Files (x86)”的环境变量。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-11T14:59:37.013

一种方法是查找“ProgramFiles(x86)”环境变量：

```
String x86folder = Environment.GetEnvironmentVariable("ProgramFiles(x86)"); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-02-28T09:26:13.713

我正在编写一个可以在 Windows 7 的 x86 和 x64 平台上运行的应用程序，并且查询下面的变量只会在任何平台上提取正确的程序文件文件夹路径。

```
Environment.GetEnvironmentVariable("PROGRAMFILES") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-13T16:28:53.780

使用 .NET 中的新方法的单线器。将始终返回 x86 Program Files 文件夹。

`Environment.Is64BitOperatingSystem ? Environment.GetEnvironmentVariable("ProgramFiles(x86)") : Environment.GetEnvironmentVariable("ProgramFiles"))`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-25T11:59:20.737

**C#代码：**

**`Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86)`**

**输出：**

*C:\Program 文件 (x86)*

**笔记：**

我们需要告诉编译器不要偏爱特定的构建平台。

```
Go to Visual Studio > Project Properties > Build > Uncheck "Prefer 32 bit" 
```

**原因：**

> 默认情况下，大多数 .NET 项目是“首选任何 CPU 32 位”
> 
> 当您取消选中 32 位汇编时，将：
> 
> JIT 到 32 位进程上的 32 位代码
> 
> JIT 到 64 位进程上的 32 位代码

# java - 如何将 java 日志控制台输出从 std err 更改为 std out？

> ID：194165
> 
> 赞同：42
> 
> 时间：2008-10-11T15:00:11.613
> 
> 标签：java, logging

我使用标准`ConsoleHandler`，`java.util.logging`默认情况下控制台输出被定向到错误流（即`System.err`）。

如何将控制台输出更改为输出流（即`System.out`）？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-01-19T18:09:10.430

我已经到达

```
 SimpleFormatter fmt = new SimpleFormatter();
 StreamHandler sh = new StreamHandler(System.out, fmt);
 logger.addHandler(sh); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-03-18T20:38:08.307

嗯，我只是被咬了几次，试图完成这个壮举。在用谷歌搜索我的方式之前，我设法想到了以下黑客攻击。丑陋，但它似乎完成了工作。

```
public class StdoutConsoleHandler extends ConsoleHandler {
  protected void setOutputStream(OutputStream out) throws SecurityException {
    super.setOutputStream(System.out); // kitten killed here :-(
  }
} 
```

注意：从构造函数调用 setOutputStream() 很诱人，但它确实（正如 Jon Skeet 已经指出的那样）关闭 System.err。疯狂的技能！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-11T23:49:12.983

我想出了一种方法。首先删除默认的控制台处理程序：

setUseParentHandlers(false);

然后子类 ConsoleHandler 并在构造函数中：

setOutputStream(System.out);

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-05-25T15:46:14.557

```
Handler consoleHandler = new Handler(){
         @Override
            public void publish(LogRecord record)
            {
                if (getFormatter() == null)
                {
                    setFormatter(new SimpleFormatter());
                }

                try {
                    String message = getFormatter().format(record);
                    if (record.getLevel().intValue() >= Level.WARNING.intValue())
                    {
                        System.err.write(message.getBytes());                       
                    }
                    else
                    {
                        System.out.write(message.getBytes());
                    }
                } catch (Exception exception) {
                    reportError(null, exception, ErrorManager.FORMAT_FAILURE);
                }

            }

            @Override
            public void close() throws SecurityException {}
            @Override
            public void flush(){}
        }; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-05-18T00:38:39.793

我有一个类似的问题。我想将 INFO 及以下记录到`System.out`，并将 WARNING 及以上记录到`System.err`。这是我实施的解决方案：

```
public class DualConsoleHandler extends StreamHandler {

    private final ConsoleHandler stderrHandler = new ConsoleHandler();

    public DualConsoleHandler() {
        super(System.out, new SimpleFormatter());
    }

    @Override
    public void publish(LogRecord record) {
        if (record.getLevel().intValue() <= Level.INFO.intValue()) {
            super.publish(record);
            super.flush();
        } else {
            stderrHandler.publish(record);
            stderrHandler.flush();
        }
    }
} 
```

当然，您可以通过分解硬编码引用来使其更灵活`Level.INFO`，例如。但这对我来说很有效，可以获得一些基本的双流日志记录。（顺便说一句，关于不继承 ConsoleHandler 以避免关闭的提示`System.err`非常有用。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2020-06-03T04:22:38.430

**第 1 步：**将父处理程序设置为 false。

```
log.setUseParentHandlers(false); 
```

**第 2 步：**添加写入 System.out 的处理程序

```
log.addHandler(new StreamHandler(System.out, new SimpleFormatter())); 
```

而已..

```
import java.io.IOException;
import java.util.logging.Logger;
import java.util.logging.SimpleFormatter;
import java.util.logging.StreamHandler;

public class App {

     static final Logger log = Logger.getLogger("com.sample.app.App");

     static void processData() {
          log.info("Started Processing Data");
          log.info("Finished processing data");
     }

     public static void main(String args[]) throws IOException {
          log.setUseParentHandlers(false);

          log.addHandler(new StreamHandler(System.out, new SimpleFormatter()));

          processData();
     }
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-11T15:24:51.643

查看[ConsoleHandler](http://java.sun.com/javase/6/docs/api/java/util/logging/ConsoleHandler.html)的文档和源代码- 我相信您可以轻松编写一个仅使用 System.err 而不是 System.out 的版本。（老实说，ConsoleHandler 不允许配置它，这很遗憾。）

然后，只需将日志系统配置为以正常方式使用您的新 StdoutHandler（或您所称的任何名称）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-04-18T15:53:01.377

如果还有人在那里寻找解决这个问题的方法。这是我最终想出的：我只是将 StreamHandler 子类化并添加了一个附加参数 MaxLevel，该参数在 publish() 的开头进行检查。如果 logging event 的 level 大于 MaxLevel，则不会再执行 publish。以下是详细信息：

**MaxlevelStreamHandler.java** Main Class 下面。

```
package helper;

/**
 * The only difference to the standard StreamHandler is 
 * that a MAXLEVEL can be defined (which then is not published)
 * 
 * @author Kai Goergen
 */

import java.io.PrintStream;
import java.util.logging.Formatter;
import java.util.logging.Level;
import java.util.logging.LogRecord;
import java.util.logging.StreamHandler;

public class MaxlevelStreamHandler extends StreamHandler {

    private Level maxlevel = Level.SEVERE;  // by default, put out everything

    /**
     * The only method we really change to check whether the message
     * is smaller than maxlevel.
     * We also flush here to make sure that the message is shown immediately.
     */
    @Override
    public synchronized void publish(LogRecord record) {
        if (record.getLevel().intValue() > this.maxlevel.intValue()) {
            // do nothing if the level is above maxlevel
        } else {
            // if we arrived here, do what we always do
            super.publish(record);
            super.flush();
        }
    }

    /**
     * getter for maxlevel
     * @return
     */
    public Level getMaxlevel() {
        return maxlevel;
    }

    /**
     * Setter for maxlevel. 
     * If a logging event is larger than this level, it won't be displayed
     * @param maxlevel
     */
    public void setMaxlevel(Level maxlevel) {
        this.maxlevel = maxlevel;
    }

    /** Constructor forwarding */
    public MaxlevelStreamHandler(PrintStream out, Formatter formatter) {
        super(out, formatter);
    }

    /** Constructor forwarding */
    public MaxlevelStreamHandler() {
        super();
    }
} 
```

**主班**

现在要在 stdout 和 stderr 中显示一些事件，只需设置两个 StreamLogger，一个用于关键事件，一个用于所有其他事件，并禁用标准控制台记录器：

```
// setup all logs that are smaller than WARNINGS to stdout
MaxlevelStreamHandler outSh = new MaxlevelStreamHandler(System.out, formatter);
outSh.setLevel(Level.ALL);
outSh.setMaxlevel(Level.INFO);
logger.addHandler(outSh);

// setup all warnings to stdout & warnings and higher to stderr
StreamHandler errSh = new StreamHandler(System.err, formatter);
errSh.setLevel(Level.WARNING);
logger.addHandler(errSh);

// remove default console logger
logger.setUseParentHandlers(false);

logger.info("info");
logger.warning("warning");
logger.severe("severe"); 
```

希望这可以帮助！

更新：我在 super.publish() 之后添加了 super.flush() 以确保消息立即显示。以前，我遇到过日志消息总是显示在最后的问题。它现在是上面代码的一部分。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-11T15:29:12.647

如果您使用 Java 日志记录，您可以更改默认处理程序：

例如，对于文件： Handler fh = new FileHandler(FILENAME); Logger.getLogger(LOGGER_NAME).addHandler(fh);

如果你想输出到一个流，你可以使用 StreamHandler，我想你可以用任何你喜欢的输出流来配置它，包括系统流。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-02-25T16:14:49.910

当我们创建一个新的 ConsoleHandler 对象时，默认输出流是“system.err”。遗憾的是，Java 没有为 ConsoleHandler 类提供任何公共方法来设置输出流。所以只能在创建对象的时候设置。由于 ConsoleHandler 类扩展了 StreamHandler，它有一个受保护的方法“setOutputStream”来显式设置输出流。要为 ConsoleHandler 设置输出流，只需在新调用对象创建时覆盖此方法。

```
ConsoleHandler consoleHandler = new ConsoleHandler (){
            @Override
            protected synchronized void setOutputStream(OutputStream out) throws SecurityException {
                super.setOutputStream(System.out);
            }
        }; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-03-10T14:48:30.013

ConsoleHandler 将`System.err`在构建过程中获取快照。一种选择是将全局错误流与全局输出流交换，然后创建 ConsoleHandler。

```
ConsoleHandler h = null;
final PrintStream err = System.err;
System.setErr(System.out);
try {
    h = new ConsoleHandler(); //Snapshot of System.err
} finally {
    System.setErr(err);
} 
```

这假定代码有权修改错误流并且没有其他正在运行的代码正在访问错误流。简而言之，这是一种选择，但有更安全的选择。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-18T22:59:48.123

如果设置 setUseParentHandlers(false); 只有那个类有它设置。应用程序中的其他类仍会将其传递给 stderr。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-10-21T22:41:26.063

只需在构造函数调用 Super(System.out,) 中扩展 StreamHandler &。这将避免关闭 System.err - 谢谢

# iphone - 如何在 iPhone 上更快地推送像素？

> ID：194168
> 
> 赞同：3
> 
> 时间：2008-10-11T15:04:01.357
> 
> 标签：iphone, framebuffer, pixels

我之前问过像素推送，现在已经设法让噪音出现在屏幕上。这是我的初始化方式：

```
CGDataProviderRef provider;
bitmap = malloc(320*480*4);
provider = CGDataProviderCreateWithData(NULL, bitmap, 320*480*4, NULL);
CGColorSpaceRef colorSpaceRef;
colorSpaceRef = CGColorSpaceCreateDeviceRGB();
ir = CGImageCreate(
320,
480,
8,
32,
4 * 320,
colorSpaceRef,
kCGImageAlphaNoneSkipLast,
provider,
NULL,
NO,
kCGRenderingIntentDefault
); 
```

这是我渲染每一帧的方式：

```
for (int i=0; i<320*480*4; i++) {
bitmap[i] = rand()%256;
}
CGRect rect = CGRectMake(0, 0, 320, 480);
CGContextDrawImage(context, rect, ir); 
```

问题是这非常慢，大约 5fps。我认为我发布缓冲区的路径一定是错误的。是否可以在不使用 3D 芯片的情况下以 30fps 的速度更新全屏像素图形？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T02:39:58.613

缓慢几乎肯定是在噪声产生中。如果您在 Instruments 中运行它，您可能会发现大量时间都花在了循环中。

另一个较小的问题是您的色彩空间。如果您使用屏幕的色彩空间，您将避免可能很昂贵的色彩空间转换。

如果您可以使用 CoreGraphics 例程进行绘图，则最好为绘图上下文创建一个 CGLayer，而不是每次都创建一个新对象。

bytesPerRow 组件对性能也很重要。它应该是 32 IIRC 的因子。有一些代码可用的[链接文本](http://www.geekspiff.com/content/view/61/ "这里")显示了如何计算它。

是的，对于原始性能，OpenGL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T15:40:09.257

我怀疑做 614400 ( `320*480*4`) 内存写入、随机数生成和每帧创建一个新对象会减慢你的速度。

您是否尝试过将静态位图写入屏幕并查看速度有多快？您是否尝试过分析代码？您是否还需要每次都制作一个新的 CGRect ？

如果只是想给出随机的效果，可能没必要每次都重新生成整个位图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T18:04:43.957

据我所知，OpenGL 应该是在 iPhone 上处理图形的最快方式。这包括 2D 和 3D。UIView 由核心动画层支持，无论如何最终都会使用 OpenGL 进行绘制。那么为什么不跳过中间人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-22T20:30:37.877

`CGContextDrawImage`您可以通过分配`CGImageRef`to来避免行程`-[CALayer setContents:]`，只要确保在您仍在使用位图时不要释放位图。

```
[[view layer] setContents:(id)ir]; 
```

^(是的，我知道这是旧的，我是从谷歌偶然发现的)

# cocoa - 当用户完成对 NSTableView 中的单元格的编辑时，如何获得通知？

> ID：194192
> 
> 赞同：5
> 
> 时间：2008-10-11T15:20:36.143
> 
> 标签：cocoa, macos

我需要知道用户何时完成对 NSTableView 中的单元格的编辑。该表包含所有用户的日历（从 CalCalendarStore 获得），因此为了保存用户的更改，我需要将更改通知 CalCalendarStore。但是，我找不到在用户完成编辑后调用的任何内容 - 我猜想在表的委托中会有一个方法，但我只看到在编辑开始时调用的方法，而不是在编辑结束时调用的方法。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-08-26T17:45:47.360

`NSTableView`通过使用`NSNotificationCenter`或使用方法，您可以在不进行子类化的情况下获得相同的结果`NSControl`。请参阅此处的 Apple 文档：

[http://developer.apple.com/library/mac/#qa/qa1551/_index.html](http://developer.apple.com/library/mac/#qa/qa1551/_index.html)

它只有几行代码，对我来说非常有效。

* * *

如果你可以成为`delegate`你`NSTableView`只需要实现该方法

```
- (void)controlTextDidEndEditing:(NSNotification *)obj { ... } 
```

实际上，`NSTableView`是它所包含`delegate`的`NSControl`元素的，并将那些方法调用转发给它`delegate`（还有其他有用的方法）

否则，使用`NSNotificationCenter`：

```
// where you instantiate the table view
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(editingDidEnd:)
    name:NSControlTextDidEndEditingNotification object:nil];

// somewhere else in the .m file
- (void)editingDidEnd:(NSNotification *)notification { ... }

// remove the observer in the dealloc
- (void)dealloc {
   [[NSNotificationCenter defaultCenter] removeObserver:self
    name:NSControlTextDidEndEditingNotification object:nil];
   [super dealloc]
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T03:02:19.410

使用 addObserver:toObjectsAtIndexes:forKeyPath:options:context 为内容数组中的每个项目设置观察者：

您还需要为数组本身设置一个观察者，以便您收到有关添加到数组中或从数组中删除的对象的通知。

以[iSpend](http://developer.apple.com/samplecode/iSpend/index.html)项目为例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T03:03:01.047

子类 NSTableView 并覆盖 textDidEndEditing: (一定要调用 super 的实现)。

这只会由文本字段 NSTextFieldCell 或 NSComboBoxCell 调用（但仅在通过键入来更改值时，而不是通过从组合菜单中选择值）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T17:22:26.710

查看 NSTableDataSource 协议。您正在查找的消息称为：tableView:setObjectValue:forTableColumn:row:

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-09-07T17:27:29.390

将@Milly 的答案翻译成**Swift 3**：

```
// Setup editing completion notifications
NotificationCenter.default.addObserver(self, selector: #selector(editingDidEnd(_:)), name: NSNotification.Name.NSControlTextDidEndEditing, object: nil) 
```

处理通知的函数：

```
func editingDidEnd(_ obj: Notification) {
    guard let newName = (obj.object as? NSTextField)?.stringValue else {
        return
    }

    // post editing logic goes here
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-12T03:03:41.013

子类 NSArrayController 并覆盖 objectDidEndEditing: (一定要调用 super 的实现)。

这将主要仅由文本字段 NSTextFieldCell 或 NSComboBoxCell 调用（但仅在通过键入来更改值时，而不是通过从组合菜单中选择值）。可能还有一些其他的单元格会调用它，但我不确定哪些单元格。如果您有自定义单元格，请考虑实施 NSEditor 和 NSEditorRegistration 非正式协议。

# java - 在数据库之前处理数据的应用程序设计

> ID：194194
> 
> 赞同：3
> 
> 时间：2008-10-11T15:21:54.877
> 
> 标签：java, design-patterns, chain-of-responsibility

我在 excel 文件（和 csv 文件）中有大量数据。数据需要放入数据库（mysql）中。但是，在它进入数据库之前需要对其进行处理。例如，如果第 1 列小于第 3 列，则将 4 添加到第 2 列。在持久化信息之前必须遵循很多规则。

完成这项任务需要遵循什么好的设计？（使用Java）

**补充笔记**

该过程需要自动化。从某种意义上说，我不必手动进入并更改数据。我们谈论的是数千行数据，每行包含 15 列信息。

目前，我建立了一种责任链设计。每个规则一个类（Java）。当一个规则完成时，它会调用以下规则。

**更多信息**

通常每个数据表大约有 5000 行。速度不是一个大问题，因为这种大输入并不经常发生。

我考虑过流口水，但我不确定任务是否足够复杂，流口水。

示例规则：

1.  所有货币（特定列中的数据）不得包含货币符号。

2.  类别名称必须统一（例如书柜 = 书柜）

3.  参赛日期不能是未来日期

4.  文本输入只能包含 [AZ 0-9 \s]

等等。
此外，如果任何一列信息无效，则需要在处理完成时报告（或者可能停止处理）。

我目前的解决方案有效。但是我认为还有改进的余地，所以我正在寻找关于如何改进以及其他人如何处理类似情况的理想。

我曾考虑过（非常简单地）使用drools，但我不确定这项工作是否足够复杂以利用drools。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T15:51:36.080

我觉得你的方法还可以。特别是如果您在每个处理器上使用相同的接口。

你也可以看看一些叫做 Drules 的东西，目前是 Jboss-rules。前段时间我将它用于我的应用程序的规则繁重的部分，我喜欢它的是业务逻辑可以用例如电子表格或 DSL 来表达，然后编译为 java（运行时，我认为有也是一个编译时选项）。它使规则更加简洁，因此更具可读性。它也很容易学习（2天左右）。

这是开源[Jboss-rules](https://www.jboss.org/community/docs/DOC-10741)的链接。在 jboss.com，如果更符合您公司的口味，您无疑可以购买官方维护的版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T21:30:53.777

如果我不想一步完成（正如 Oli 提到的），我可能会使用[管道和过滤器](http://www.eaipatterns.com/PipesAndFilters.html)设计。由于您的规则相对简单，我可能会做几个基于委托的课程。例如（C# 代码，但 Java 应该非常相似......也许有人可以翻译？）：

```
interface IFilter {
   public IEnumerable<string> Filter(IEnumerable<string> file) {
   }
}

class PredicateFilter : IFilter {
   public PredicateFilter(Predicate<string> predicate) { }

   public IEnumerable<string> Filter(IEnumerable<string> file) {
      foreach (string s in file) {
         if (this.Predicate(s)) {
            yield return s;
         }
      }
   }
}

class ActionFilter : IFilter {
  public ActionFilter(Action<string> action) { }

  public IEnumerable<string> Filter(IEnumerable<string> file) {
      foreach (string s in file) {
         this.Action(s);
         yield return s;
      }
  }
}

class ReplaceFilter : IFilter {
  public ReplaceFilter(Func<string, string> replace) { }

  public IEnumerable<string> Filter(IEnumerable<string> file) {
     foreach (string s in file) {
        yield return this.Replace(s);
     }
  }
} 
```

从那里，您可以直接使用委托过滤器，也可以根据具体情况对它们进行子类化。然后，将它们注册到将它们通过每个过滤器的管道。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T21:53:14.760

只需创建一个函数来执行每个规则，并为每个值调用每个适用的函数。我不明白这需要任何异国情调的架构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T15:29:56.390

每个规则一个类？*真的吗？*也许我不了解这些规则的数量或复杂性，但我会（半伪代码）：

```
public class ALine {
    private int col1;
    private int col2;
    private int coln;
    // ...

    public ALine(string line) {
         // read row into private variables
         // ...

         this.Process();
         this.Insert();
    }

    public void Process() {
         // do all your rules here working with the local variables
    }

    public void Insert() {
        // write to DB
    }
}

foreach line in csv
    new ALine(line); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T15:33:14.340

您为每个规则使用类的方法听起来确实有点重，但它的优点是在新规则出现时易于修改和扩展。

至于加载数据批量加载是要走的路。我已经阅读了一些信息，这些信息表明它可能比使用插入语句加载快 3 个数量级。[你可以在这里](http://www.classes.cs.uchicago.edu/archive/2005/fall/23500-1/mysql-load.html)找到一些关于它的信息

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-11T15:35:59.437

将数据批量加载到临时表中，然后使用 sql 应用您的规则。使用临时表，作为插入真实表的基础。删除临时表。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-11T17:53:20.923

你可以看到所有不同的答案都来自他们自己的经验和观点。

由于我们对您系统中的复杂性和行数了解不多，因此我们倾向于根据我们之前所做的提供建议。

如果您想将实施范围缩小到 1/2 的解决方案，请尝试提供更多详细信息。

祝你好运

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T16:06:11.683

这可能不是您想听到的，无论如何都不是“有趣的方式”，但是有一种更简单的方法可以做到这一点。

So long as your data is evaluated line by line... you can setup another worksheet in your excel file and use spreadsheet style functions to do the necessary transforms, referencing the data from the raw data sheet. For more complex functions you can use the vba embedded in excel to write out custom operations.

I've used this approach many times and it works really well; its just not very sexy.

# dll - 哪个“更好”：带有 Typelib 的 COM DLL 或标准 DLL？

> ID：194195
> 
> 赞同：6
> 
> 时间：2008-10-11T15:23:27.480
> 
> 标签：dll, typelib, com

我将“更好”放在引号中，因为这是一个定性问题。几年来我一直在编写 COM DLL，直到最近才发现并成功使用了带有 Typelib 概念的标准 DLL。

使用 COM DLL 代替 DLL+Typelib 是否有任何令人信服的理由？当然，你不能用 DLL+Typelib 做 DCOM，但这是唯一的原因吗？

**编辑**我已经用 Visual C/C++ 6、Compaq Visual Fortran、Delphi、Visual BASIC 6、ActiveState Perl 和其他一些语言编写了 COM DLL。我用 Visual C/C++ 6、Delphi、Ada 和其他一些语言编写了标准 DLL。我已经为我自己的一些标准 DLL 以及第三方 DLL 编写了类型库。该问题最初是在 VB6 原件的 Delphi DLL+Typelib 重新实现的上下文中编写的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T15:48:27.913

如果您希望将来将 COM 组件迁移到托管代码，TypeLib 也很重要。或者让托管代码与 COM 组件交互。

使用 typelib 有很多工具可以自动将您的 COM 签名转换为 .Net 接口和类型。这可以手工完成，但对于大型项目，它肯定会节省大量时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T02:47:31.157

这真的取决于我认为的组件的客户。

# .net - 在业务层和数据访问层之间传递数据 - 错误代码？

> ID：194208
> 
> 赞同：0
> 
> 时间：2008-10-11T15:31:49.897
> 
> 标签：.net, vb.net, data-access-layer

我在 JCProperty 类中使​​用以下代码从 DAL 检索数据：

```
Dim x As JCProperty
        x = JCPropertyDB.GetProperty(PropertyID)

        If Not x Is Nothing Then
            Me.PropertyID = x.PropertyID
            Me.AddressLine1 = x.AddressLine1
            Me.AddressLine2 = x.AddressLine2
            Me.AddressLine3 = x.AddressLine3
            Me.AddressCity = x.AddressCity
            Me.AddressCounty = x.AddressCounty
            Me.AddressPostcode = x.AddressPostcode
            Me.TelNo = x.TelNo
            Me.UpdatedOn = x.UpdatedOn
            Me.CreatedOn = x.CreatedOn
            Me.Description = x.Description
            Me.GUID = x.GUID
        End If 
```

这工作正常，但需要 DAL 对象 (JCPropertyDB) 知道业务对象 (JCProperty)，并且我有效地创建和填充相同的对象两次（一次在 DAL 中返回到 BL，然后再次在 BL 对象中填充本身）。

我在这里遗漏了一些东西，我知道一定有更好的方法！

实际上，我需要分配不允许的“Me = x”。有人可以让我直截了当吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T08:12:54.930

您在正确的路线上，但是略微丢失了一点。

通常，您的数据访问层 (DAL) 会从您的数据库返回[数据传输对象](http://martinfowler.com/eaaCatalog/dataTransferObject.html)(DTO)。这些是普通旧 CLR 对象 (POCO)，不包含业务逻辑，只是或多或少映射到数据库表的属性。

然后，您将拥有从这些 DTO 创建[域模型](http://martinfowler.com/eaaCatalog/domainModel.html)的代码，称为[Data Mapper](http://martinfowler.com/eaaCatalog/dataMapper.html)。领域模型中的类可能具有相似的名称（即 CustomerDTO -> Customer），但除了数据之外，它们还将包含验证规则和可能的其他业务逻辑。

然后您在业务层中使用的正是这个领域模型，而不是实际的 DTO。这意味着如果您更改从 DAL 返回的 DTO（即通过实施新的 ORM 工具），您只需修改您的数据映射器，前提是数据模型保持不变。

我建议查看[Martin Fowler 的企业应用程序架构模式以](http://martinfowler.com/books.html#eaa)了解数据访问模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T16:05:47.207

不确定这是否会回答您的问题，但重要的是域模型独立于显示和存储。这通常被称为关注点分离。这个想法是获得松散耦合并创建一个简单的系统，其中对象没有几个完全不同的职责。
所以我要做的是允许 DAL 直接创建业务对象，但要确保我的业务对象不会被与 DAL 相关的任何东西污染。同样，我不想用特定于 UI 的东西（如 HTML）来污染它们。在我看来，业务层、DAL 和 UI 层都对域模型有依赖关系是可以的，但是从域模型和这些其他组件中具有依赖关系是不行的。
要放松耦合，使用 Spring 或任何其他依赖注入容器以及接口和接线可以帮助您。
通过在每一层中重新创建相同的对象，您违反了 DRY 原则（不要重复自己），并且您正在引入样板代码并增加在某处引入错误的机会。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T16:23:14.613

就个人而言，我很懒。我通常会做类似的事情：

```
class JCProperty : inherits JCPropertyDB
   {

   New()
      {
      MyBase.New()

      GetProperty(PropertyID)

      }
   } 
```

然后你基本上完成了，直到你在 JCProperty 类中有一些额外的功能需要发生在 JCPropertyDB 中已经存在的功能的“顶部”。然后覆盖 JCPropertyDB 方法以首先调用基本方法，然后添加新功能。

罗恩

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-29T20:49:11.653

查看： http: [//www.icemanind.com/layergen.aspx](http://www.icemanind.com/layergen.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-09T11:55:23.110

我一直在通过桥接模式和提供者模型接收 BO 并从 DAL 中发回 BO。我看不到 DTO 的意义，除非我害怕大量的序列化（比如 Web 服务或 JSON）。我的方法是通过接口抽象数据层和业务层，并提供一个匿名数据层馈入业务对象。这意味着我可以插入任何数据层，实现一个具有通用加载和保存方法的接口，然后可以通过我的域层访问该接口。BL 中没有 DAL 代码——只是对提供的和抽象的数据层的调用。我对数据层的调用由提供者模式管理（没有直接引用），我只是这样做：

```
public class Person : IBusinessObject<Person>
{
   protected IDataLayer<T> dataLayer;

   Person Load() { this.dataLayer.Load(this); }

} 
```

在我的数据层...

```
public class PersonMapper : IDataLayer<Person> 
{
    Person Load(Person person) {
    ...get DB stuff...map to person...decorate object...
       return person;
    }
} 
```

我仍然不知道这是否好，但它对我来说效果很好。对于使用反射的嵌套对象，我也设法获得了延迟加载。

# database - 数据库和版本控制系统

> ID：194213
> 
> 赞同：3
> 
> 时间：2008-10-11T15:37:41.087
> 
> 标签：database, version-control, django-models, project-management

我正在使用 django 框架进行项目，并使用控制版本系统将我的代码与其他人同步。但我不知道如何组织数据库。在 django 中，任何参与项目的人都可以更改 django 模型，并告诉“syncdb”将模型对象与 db 同步。但是其他人不知道这个变化，它的代码修订可能不起作用。请告诉我一些解决这个问题的方法（也许是不同的数据库或其他东西）。

谢谢，原谅我的英语:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-11T15:40:56.073

您必须与项目中的人员进行实际交谈。

如果有人更改了任何数据库模型，他们必须实际告诉其他人有关更改的信息。这不是 Django 问题。

想想任何 SQL 数据库——没有 Django。当 DBA 删除表时，他们必须告诉所有人他们更改了数据库。否则所有使用表格的程序都会中断。

模型定义很特殊，谁能改变这个必须告诉其他人。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T15:46:46.917

您必须对受版本控制的数据库进行初始备份。之后，您必须将所有修改脚本放在同一个版本控制上。像这样的东西：

/数据库（在存储库中）

*   初始备份
*   Script1_date.sql
*   Script2_date.sql

...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-16T15:44:50.820

我很好奇...如果您将 MDF 和 LDF 文件置于源代码控制之下会发生什么？当然，如果你的表是空的，而你只有数据库的结构......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T18:38:14.793

我不确定你的问题；但请记住，在 Django 上，syncdb 只创建新表。它不会改变现有表。

例如，如果您只是添加一个新字段，则 syncdb 不会做任何事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-12T05:46:00.980

实际上，看着替代品，我经常惊讶于没有人提到南方

[http://south.aeracode.org/](http://south.aeracode.org/)

它似乎是最好的迁移应用程序......也许我错过了一些重要的东西，但我发现它很好用......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-29T13:58:37.660

还可以看看 deltasql。您可以在[http://www.gpu-grid.net/deltasql](http://www.gpu-grid.net/deltasql)进行测试（用户名：管理员密码：testdbsync）并从[http://sourceforge.net/projects/deltasql](http://sourceforge.net/projects/deltasql) ciao 下载 :-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-11T15:41:17.180

听起来你想要迁移。

例如： [http ://www.aswmc.com/dbmigration/](http://www.aswmc.com/dbmigration/)

您可能还想添加功能单元测试来实际测试架构是否符合预期，这样当测试失败时，您可以看到这是架构更改，并审核它是否会影响应用程序的其他部分。如果没有，请修复您的测试以考虑新架构。

# asp.net - 获取目录属性以进行显示的正确层是什么？

> ID：194227
> 
> 赞同：-1
> 
> 时间：2008-10-11T15:48:21.843
> 
> 标签：asp.net, database, web-services, architecture, directory

我有一个 Intranet 应用程序，它需要我们校园内各个地点的联系信息，这些地点由我们的 IT 实验室支持组织提供服务。我们有一个包含联系信息的企业目录，所以我没有将实际的联系信息保存在数据库中，而是一个不可变的标识符，用作在我们的企业目录中查找该人的键（通过 Web 服务）。我将通过一个公开的网站查找联系信息。

问题在于对基于 Web 的目录查找有用的 id 只是“某种”不可变的，而不是我将存储在数据库中的 id。使用人员的 Active Directory 登录 ID 最容易执行目录查找。我将使用的称为主记录唯一 ID。

我的问题是：将链接从 MRUID 转换为 Active Directory 登录 ID 的最合理位置在哪里？

现在我正在表示层中进行翻译，使用应用程序级缓存来减少对目录的查找。目前只有一个网站，但我希望如果有其他网站需要这样做，我会将帮助程序类迁移到共享的 Web 控件库。

我考虑将代码放在数据或业务层中，但由于缓存而选择不这样做。您缓存的方式和内容似乎更多是应用程序的功能，而不是这些其他层。

我会对我可能没有考虑过的其他意见和想法感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:07:49.750

当面对需要在 asp.net 网站或 web 应用程序的表示层中的东西时，但它也可能在其他 asp.net web 应用程序中有价值时，我发现创建一个具有依赖关系的特殊类库很有用在 system.web 命名空间上。

具体来说，它将利用 HttpContext.Current 与托管库的网站进行互操作。我不确定，但我通常认为这是一个业务层程序集，但假设它托管在 Web 上下文中。

我将真正的业务代码（可能在非 Web 应用程序中使用的代码）保存在第三个程序集中。

拥有一个依赖于 Web 上下文的程序集允许您使用 HttpContext.Current 来找出请求和响应对象的情况，并允许您与 asp.net 缓存 API 和相关内容进行交互。但它也使代码保持可移植性，以便在多个 Web 应用程序中使用。

通常，这个依赖于 Web 的程序集也是我的 HttpModules 和 HttpHandlers 所在的地方。

请记住，“层”是逻辑概念，而不是物理概念。将业务、DAL 甚至表示层类一起包含的程序集没有任何问题。类本身不应混淆它们的角色，但单个程序集可以包含来自设计中不同逻辑层的类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T15:58:28.237

您可以将它放在业务层中并仍然使用缓存，或者使用业务层中的企业库[缓存应用程序块](http://msdn.microsoft.com/en-us/library/cc309502.aspx)，或者通过在表示层的 ASP.Net 缓存中缓存业务层返回的值。

由于它来自与您的其他数据不同的位置，因此我不会将其与其他数据库代码放在同一数据访问层中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T00:41:53.450

我在工作中与其他一些开发人员讨论了这个问题，我们认为表示层是进行翻译的正确位置。考虑使用相同业务/数据访问层的不同应用程序希望以不同方式转换数据的情况。除非我们有明确定义的业务规则，规定个人身份应始终以某种形式显示，否则我认为我会将其保留在原处，并根据需要将其迁移到 Web 控件库以支持多个前端。

# objective-c - Xcode 中是否有组合键来实现协议？

> ID：194241
> 
> 赞同：29
> 
> 时间：2008-10-11T16:00:13.223
> 
> 标签：objective-c, xcode, refactoring, code-generation

在 Visual Studio 中，如果我定义一个类来实现一个接口，例如

```
class MyObject : ISerializable {} 
```

我可以右键单击 ISerializable，从上下文菜单中选择“*实现接口*”，然后在我的类定义中看到相应的方法。

```
class MyObject : ISerializable {
    #region ISerializable Members
    public void GetObjectData(SerializationInfo info, 
                StreamingContext context)
    {
        throw new NotImplementedException();
    }
    #endregion
} 
```

Mac 上的 Xcode 中有类似的功能吗？我希望能够以这种方式自动实现协议。也许使用生成但注释掉的可选方法。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2011-03-19T02:04:03.570

XCode 目前不支持这种自动化。但是：使用协议引导代码的一种简单方法是单击类声明中的协议名称

```
@interface FooAppDelegate : NSObject <NSApplicationDelegate, 
                                      NSTableViewDelegate> { 
```

快速打开定义协议的 .h 文件。从那里，复制并粘贴您感兴趣的方法。这些标题往往会得到很好的注释，这有助于确定您可以安全地忽略哪些方法。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-11T17:16:35.490

我还没有在 Xcode 中看到该功能。但似乎有人可以编写一个新的用户脚本，名为“将实施器定义放在剪贴板上”，它位于脚本 > 代码中。

你没有发现这很有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-12T02:57:34.600

Xcode 目前没有这样的重构。

如果您愿意，请提交[增强请求](http://bugreport.apple.com/ "苹果的错误报告器")。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-30T20:45:51.290

我知道这个线程有点老了，但我想知道同样的事情并找到了这个问题。

就我而言，我在接口 (.h) 中定义了一个属性，并且我想在实现 (.m) 中综合它。我还需要实现接口中定义的方法。是的，正如其他人所提到的，Xcode 有所帮助，但是现代 IDE 为我们经常做的事情提供了这些生产力增强。看来这仍然不是 Xcode 4.3.3 中的功能。但是，该功能在[JetBrains 的 AppCode](http://www.jetbrains.com/objc/index.html)中可用。我只是涉足试用，但它似乎一次只能使用一个属性或方法，而不是像 Visual Studio 这样的整个界面。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-17T04:20:39.247

Xcode 可以根据协议方法为您提供帮助，假设您有这样的协议：

```
@protocol PosterousWebsitesDelegate <NSObject>
- (void)PosterousWebsitesLoadSuccess:(PosterousWebsites*)websites;
@end 
```

在 .m 文件的 @implementation 部分中，您可以开始编写方法的名称并按 ESC 键以自动完成方法/选择器的签名：

```
-(void)Poste (...press ESC...) 
```

Xcode 将自动完成@protocol 方法的完整签名，按 TAB 键确认代码。

如果你真的致力于学习 OSX/iOS 开发，我建议你阅读“XCode 3 Unleashed”，这本书真的帮助我深入了解 Xcode，就像我对 VS 的了解一样 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-06-07T15:43:03.583

检查这个插件

[https://github.com/music4kid/FastStub-Xcode](https://github.com/music4kid/FastStub-Xcode)

它可以满足您的要求，甚至更多。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-27T03:50:02.597

[Macrumors](http://forums.macrumors.com/showthread.php?p=6180803#post6180803)也对此进行了讨论。有一些苹果脚本的链接。我还没有真正尝试过这些。

# c# - 如何在 C# 中从二维矩形字符数组的一行创建字符串？

> ID：194247
> 
> 赞同：1
> 
> 时间：2008-10-11T16:02:09.943
> 
> 标签：c#, arrays, string, character, multidimensional-array

我有一个二维数组，如下所示：

```
char[,] str = new char[2,50]; 
```

现在，在我将内容存储在 str[0] 和 str[1] 中之后，如何将其存储在

```
string[] s = new string[2]; 
```

?

我试过

```
s[0] = str[0].ToString(); 
```

但这似乎是一个错误：VC# 期望大括号中有“两个”索引，这意味着我只能转换数组中的一个字符。有没有办法将整个 str[0] 转换为字符串？还是将其更改为锯齿状数组是唯一的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T16:12:29.970

由于各种原因，锯齿状阵列几乎总是最好的解决方案，这是一个很好的例子。与多维数组相比，数组数组具有更大的灵活性。在这种情况下，一旦您在字符数组中获得了值，则可以使用字符串类的构造函数从中创建字符串。

此外，锯齿状数组将由“向量”（即，下界索引为零的一维数组）组成，这在 .Net 中更受欢迎，因为 CLR 对它们进行了特殊处理。

因此，在不知道程序的其余部分在做什么的情况下，这将是我的建议。

如果您确实尝试通过遍历数组索引来手动构造字符串，而不是使用锯齿状数组，那么我建议使用 StringBuilder 类来执行此操作。

我刚刚敲了这个，但它应该是这样的：

```
// For the multi-dimentional array
StringBuilder sb = new StringBuilder();
for (int stringIndex = 0; stringIndex < s.Length; stringIndex++)
{
  sb.Clear();
  for (int charIndex = 0; charIndex < str.UpperBound(1); charIndex++)
    sb.Append(str[stringIndex,charIndex]);
  s[stringIndex] = sb.ToString();
}

// For the jagged array
for (int index = 0; index < s.Length; index++)
  s[index] = new string(str[index]); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T16:07:24.753

假设尺寸固定为 2x50：

```
char[,] str = new char[2,50];

// populate str somehow

// chose which of the strings we want (the 'row' index)
int strIndex = 0;
// create a temporary array (faster and less wasteful than using a StringBuilder)
char[] chars = new chars[50];
for (int i = 0; i < 50; i++)
  chars[i] = str[strIndex, i];
string s = new string[chars]; 
```

如果您使用锯齿状数组，这将更容易且性能更高：

```
char[][] str = new char[2][]; 
```

然后你可以写：

```
string s = new string(characters[0]); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T16:28:28.800

我同意使用锯齿状数组。你可以使用这个辅助方法来初始化一个锯齿状数组：

```
static T[][] InitJaggedArray<T>(int dimension1, int dimension2)
{
    T[][] array = new T[dimension1][];
    for (int i = 0; i < dimension1; i += 1)
    {
        array[i] = new T[dimension2];
    }
    return array;
} 
```

所以

```
char[,] str = new char[2,50]; 
```

会成为

```
char[][] str = ArrayHelper.InitJaggedArray<char>(2, 50); 
```

然后，您将像这样访问其中的元素

```
str[0, 10] = 'a'; 
```

为了使它成为一个字符串，你会做

```
string s = new string(str[0]); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-15T16:17:46.877

你可以用 LINQ 做到这一点：

```
string[] Convert(char[,] chars)
{
    return Enumerable.Range(0, chars.GetLength(1))
                     .Select(i => Enumerable.Range(0, chars.GetLength(0))
                                            .Select(j => chars[j, i]))
                     .Select(chars => new string(chars.ToArray());
} 
```

# java - Java中的RAII ...资源处理总是那么难看吗？

> ID：194261
> 
> 赞同：17
> 
> 时间：2008-10-11T16:16:24.580
> 
> 标签：java, design-patterns, raii, resource-management

我刚刚玩了 Java 文件系统 API，得到了以下函数，用于复制二进制文件。原始来源来自网络，但我添加了 try/catch/finally 子句以确保如果发生错误，缓冲流将在退出函数之前关闭（因此，我的操作系统资源被释放）。

我修剪了函数以显示模式：

```
public static void copyFile(FileOutputStream oDStream, FileInputStream oSStream) throw etc...
{
   BufferedInputStream oSBuffer = new BufferedInputStream(oSStream, 4096);
   BufferedOutputStream oDBuffer = new BufferedOutputStream(oDStream, 4096);

   try
   { 
      try
      { 
         int c;

         while((c = oSBuffer.read()) != -1)  // could throw a IOException
         {
            oDBuffer.write(c);  // could throw a IOException
         }
      }
      finally
      {
         oDBuffer.close(); // could throw a IOException
      }
   }
   finally
   {
      oSBuffer.close(); // could throw a IOException
   }
} 
```

据我了解，我不能将两者`close()`放在 finally 子句中，因为第一个`close()`可以很好地抛出，然后第二个不会被执行。

我知道 C# 有*Dispose*模式，可以用`using`关键字处理这个问题。

我什至更清楚 C++ 代码应该类似于（使用类似 Java 的 API）：

```
void copyFile(FileOutputStream & oDStream, FileInputStream & oSStream)
{
   BufferedInputStream oSBuffer(oSStream, 4096);
   BufferedOutputStream oDBuffer(oDStream, 4096);

   int c;

   while((c = oSBuffer.read()) != -1)  // could throw a IOException
   {
      oDBuffer.write(c);  // could throw a IOException
   }

   // I don't care about resources, as RAII handle them for me
} 
```

我遗漏了一些东西，还是我真的必须在 Java 中生成丑陋和臃肿的代码才能处理`close()`缓冲流方法中的异常？

（请告诉我我在某个地方错了......）

**编辑：是我，还是在更新此页面时，我看到问题和所有答案在几分钟内都减少了一点？是否有人在匿名时太享受自己了？**

编辑 2：**McDowell**提供了一个非常有趣的链接，我觉得我不得不在这里提到：http: [//illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html)

编辑 3：在 McDowell 的链接之后，我偶然发现了一个 Java 7 的提案，该提案类似于使用模式的 C#：http: [//tech.puredanger.com/java7/#resourceblock](http://tech.puredanger.com/java7/#resourceblock)。我的问题已明确描述。显然，即使使用 Java 7 `do`，问题仍然存在。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-11T16:33:45.340

在 Java 6 及更低版本的大多数情况下，try/finally 模式是处理流的正确方法。

*有些人提倡默默地关闭流。出于以下原因，请小心执行此操作：[Java：如何不弄乱流处理](http://illegalargumentexception.blogspot.com/2008/10/java-how-not-to-make-mess-of-stream.html)*

* * *

Java 7 引入了*try-with-resources*：

```
/** transcodes text file from one encoding to another */
public static void transcode(File source, Charset srcEncoding,
                             File target, Charset tgtEncoding)
                                                             throws IOException {
    try (InputStream in = new FileInputStream(source);
         Reader reader = new InputStreamReader(in, srcEncoding);
         OutputStream out = new FileOutputStream(target);
         Writer writer = new OutputStreamWriter(out, tgtEncoding)) {
        char[] buffer = new char[1024];
        int r;
        while ((r = reader.read(buffer)) != -1) {
            writer.write(buffer, 0, r);
        }
    }
} 
```

[`AutoCloseable`](http://download.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html)类型将自动关闭：

```
public class Foo {
  public static void main(String[] args) {
    class CloseTest implements AutoCloseable {
      public void close() {
        System.out.println("Close");
      }
    }
    try (CloseTest closeable = new CloseTest()) {}
  }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-11T16:29:02.997

不幸的是，这种类型的代码在 Java 中往往会变得有点臃肿。

顺便说一句，如果对 oSBuffer.read 或 oDBuffer.write 的调用之一引发异常，那么您可能希望让该异常渗透到调用层次结构中。

在 finally 子句中对 close() 进行不受保护的调用将导致原始异常被 close() 调用产生的异常替换。换句话说，失败的 close() 方法可能会隐藏由 read() 或 write() 产生的原始异常。*因此，我认为当且仅当*其他方法没有抛出时，您才想忽略 close() 抛出的异常。

我通常通过在内部尝试中包含一个明确的关闭调用来解决这个问题：

```
  尝试 {
    尽管 （...） {
      读...
      写...
    }
    oSBuffer.close(); // 这里没有忽略异常
    oDBuffer.close(); // 这里没有忽略异常
  } 最后 {
    静默关闭（oSBuffer）；// 此处忽略异常
    沉默关闭（oDBuffer）；// 此处忽略异常
  }

```

```
  静态无效静默关闭（可关闭 c）{
    尝试 {
      c.close();
    } 捕捉（IOException 即）{
      // 忽略；来电者必须有这个意图
    }
  }

```

最后，为了性能，代码应该可以使用缓冲区（每次读/写多个字节）。不能用数字来支持这一点，但更少的调用应该比在顶部添加缓冲流更有效。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-11T16:36:19.940

有一些问题，但是你在网上发现的代码真的很糟糕。

关闭缓冲区流会关闭下面的流。你真的不想那样做。您要做的就是刷新输出流。此外，指定底层流用于文件也没有意义。性能很糟糕，因为您一次复制一个字节（实际上，如果您使用 java.io，则可以使用 transferTo/transferFrom ，这会更快一些）。当我们谈到它时，变量名很糟糕。所以：

```
public static void copy(
    InputStream in, OutputStream out
) throw IOException {
    byte[] buff = new byte[8192];
    for (;;) {
        int len = in.read(buff);
        if (len == -1) {
            break;
        }
        out.write(buff, 0, len);
    }
} 
```

如果您发现自己经常使用 try-finally，那么您可以使用“execute around”习语将其分解。

在我看来：Java 应该在范围结束时以某种方式关闭资源。我建议添加`private`为一元后缀运算符以在封闭块的末尾关闭。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-11T16:50:09.363

是的，这就是java的工作方式。存在控制反转——对象的用户必须知道如何清理对象，而不是对象本身自己清理。不幸的是，这会导致大量清理代码散布在您的 java 代码中。

C# 具有“using”关键字，可在对象超出范围时自动调用 Dispose。Java没有这样的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-11T17:14:52.090

对于复制文件等常见的 IO 任务，如上所示的代码正在重新发明轮子。不幸的是，JDK 不提供任何更高级别的实用程序，但 apache commons-io 提供。

例如，[FileUtils](http://commons.apache.org/io/api-1.4/index.html?org/apache/commons/io/FileUtils.html)包含用于处理文件和目录（包括复制）的各种实用方法。另一方面，如果你真的需要使用JDK中的IO支持，[IOUtils](http://commons.apache.org/io/api-1.4/index.html?org/apache/commons/io/IOUtils.html)包含一组closeQuietly()方法，可以关闭Readers、Writers、Streams等而不抛出异常。

# vb.net - 混合 VB.NET 的 Option Strict 和新的 Option Infer 指令的最佳方式是什么？

> ID：194278
> 
> 赞同：10
> 
> 时间：2008-10-11T16:27:45.463
> 
> 标签：vb.net, linq, option-strict, option-infer

在一个[相关问题](https://stackoverflow.com/questions/194272)中，我的团队即将（希望）开始使用 LINQ，我想利用匿名类型。混合 VB.NET 的 Option Strict（我们在项目的整个生命周期中一直在使用）和新的 Option Infer 指令的最佳方式是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-11T16:45:39.780

Option Strict 和[Option Infer](http://msdn.microsoft.com/en-us/library/bb384665.aspx)并不冲突，所以我认为两者都打开没有什么坏处。

作为风格指南，我更喜欢将 Option Strict、Explicit 和 Infer 放在每个类文件的顶部 - 这可以防止项目或 IDE 设置的差异导致问题，并明确使用了哪些设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-01-19T12:09:48.680

Option Strict 可以在没有 Option Infer 的情况下使用，但 Option Infer 不应该在没有 Option Strict 的情况下使用，因为这会导致结果 IL 的差异。

考虑这行代码：

```
txtBox.Text = If(str="", Nothing, CDate(str)) 
```

使用 Option Strict Off 和 Option Infer Off 时，相当于：

```
txtBox.Text = CStr(If(str="", Nothing, CType(CDate(str), Object))) 
```

如果 str="" 则 txtBox.Text 设置为 Nothing/空字符串。

使用 Option Infer On 但 Option Strict Off 时：

```
txtBox.Text = Cstr(If(str="", CDate(Nothing), CType(CDate(str), Object))) 
```

并且 CDate(Nothing) = Date.MinValue 等等 txtBox.Text = "01/01/0001"

Option Strict 只能让你的代码无法编译，Option Infer 可以改变它的含义。这并不是说 Infer 不是一件好事，总的来说它是，但有一些注意事项您需要注意。

原始代码可以写成：

```
 txtBox.Text = Cstr(If(str="", Nothing, CDate(str))) 
```

在这种情况下，如果您打开 Option，Option Strict 将无法拯救您。Infer On，但在没有 Strict 的代码库中，原始版本的可能性更大。

# c# - 描述国际象棋规则的推荐数据格式

> ID：194289
> 
> 赞同：8
> 
> 时间：2008-10-11T16:34:31.830
> 
> 标签：c#, java, python, chess, dataformat

我将编写一个国际象棋服务器和一个或多个国际象棋客户端，我想以独立于编程语言的方式描述国际象棋规则（例如，基于游戏状态的允许移动，游戏完成时的规则）。这有点棘手，因为一些国际象棋规则（例如 King Castling、en passent、基于 3 个或更多重复移动的平局）不仅基于棋盘布局，而且基于移动的历史。

我希望格式为：

*   文本的
*   人类可读
*   基于标准（例如 YAML、XML）
*   易于用多种语言解析

但我愿意牺牲其中任何一个来换取合适的解决方案。

我的主要问题是：如何构建如此复杂的算法，以从数据格式对如此复杂的状态进行操作？

后续问题是：您能否提供一个以类似方式解决的类似问题的示例，可以作为起点？

**编辑：**为了响应清晰的请求——考虑我将有一个用 Python 编写的服务器，一个用 C# 编写的客户端和另一个用 Java 编写的客户端。我想避免在每个地方指定规则（例如允许的棋子移动、检查情况等）。我更愿意以独立于语言的方式指定这些规则一次。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-11T16:48:28.680

让我们想想。我们正在描述具有状态和行为的对象（位置和片段）。我们需要注意当前状态和从当前状态更改的一组不断变化的允许状态更改。

这就是编程。您不想要一些“元语言”，然后可以用常规编程语言进行解析。只需使用编程语言。

从普通语言中的普通类定义开始。让一切正常工作。那么，这些类定义就是国际象棋的定义。

除了极少数例外，**所有**编程语言都是

*   文本
*   人类可读
*   合理标准化
*   由它们各自的编译器或解释器轻松解析。

只需选择一种语言，您就完成了。由于处理细微差别需要一段时间，因此使用 Python 或 Ruby 之类的动态语言可能比使用 Java 或 C# 之类的静态语言更快乐。

如果你想要便携性。选择一种可移植的语言。如果您希望将语言嵌入到“更大”的应用程序中，那么请为您的“更大”应用程序选择语言。

* * *

由于最初的需求不完整，次要的小问题是如何让代码与多个客户端一起运行。

1.  没有多种语言的客户。选一个。例如，Java 并坚持使用它。

2.  如果您必须拥有多种语言的客户端，那么您需要一种可以嵌入到所有三种语言运行时环境中的语言。你有两个选择。

    *   嵌入解释器。例如，Python、Tcl 和 JavaScript 是轻量级解释器，您可以从 C 或 C# 程序中调用它们。这种方法适用于浏览器，它可以为您工作。Java，通过 JNI 也可以利用这一点。您可以使用一些 BPEL 规则引擎进行尝试。

    *   将解释器生成为单​​独的子进程。在您的应用程序和生成的解释器之间打开命名管道或套接字或其他东西。您的 Java 和 C# 客户端可以与 Python 子进程通信。您的 Python 服务器可以简单地使用此代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T22:22:23.233

到目前为止，我从回复中收集到的信息：

**对于棋盘数据表示：**

请参阅有关 [棋盘表示]( [http://en.wikipedia.org/wiki/Board_representation_(chess))](http://en.wikipedia.org/wiki/Board_representation_(chess)))的 Wikipedia 文章。

**对于国际象棋移动数据表示：**

请参阅有关[Portable Game Notation](http://en.wikipedia.org/wiki/Portable_Game_Notation)和[Algebraic Chess Notation的 Wikipedia 文章](http://en.wikipedia.org/wiki/Algebraic_chess_notation)

**对于国际象棋规则表示：**

这必须使用编程语言来完成。如果一个人想减少在规则将以一种以上的语言实现的情况下编写的代码量，那么有几个选项

1.  使用目标语言存在可嵌入解释器的语言（例如 Lua、Python）。
2.  使用通用语言可以编译成的虚拟机（例如，用于 C# 的 IronPython，用于 Java 的 JPython）。
3.  为目标语言可以与之通信的规则使用后台守护程序或子进程。
4.  用每种目标语言重新实现规则算法。

尽管我希望有一种声明式语法可以被多种语言解释以强制执行国际象棋规则，但我的研究使我没有找到可能的候选者。我怀疑[基于约束的编程](http://en.wikipedia.org/wiki/Constraint_programming)可能是一种可能的途径，因为存在许多语言的求解器，但我不确定它们是否能真正满足这一要求。感谢大家的关注，也许将来会出现答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T16:57:04.453

**编辑：**删除了过于冗长的答案。

简短的回答是，用 Python 编写规则。使用 Iron Python 将其连接到 C# 客户端，使用 Jython 连接到 Java 客户端。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-11T17:00:56.987

这是回答后续问题:-)

我可以指出，最流行的国际象棋服务器之一在[这里](ftp://ftp.chessclub.com/pub/icc/formats/formats.txt)记录了它的协议（警告、FTP 链接，并且不支持被动 FTP），但**只是为了向它编写接口**，而不是出于任何其他目的。您可以开始为此服务器编写客户端作为学习经验。

相关的一件事是，好的国际象棋服务器提供的功能不仅仅是移动中继。

也就是说，有一个更基本的协议用于连接国际象棋引擎，记录[在这里](http://www.tim-mann.org/xboard/engine-intf.html)。

哦，顺便说一句：[维基百科的董事会代表](http://en.wikipedia.org/wiki/Board_representation_%28chess%29)

正如许多人已经指出的那样，董事会代表之外的任何事情都属于该计划本身。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-11T17:09:30.310

已经有一种广泛使用的特定于国际象棋的格式，称为[Portable Game Notation](http://en.wikipedia.org/wiki/Portable_Game_Notation)。还有[智能游戏格式](http://www.red-bean.com/sgf/)，它适用于许多不同的游戏。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-11T17:14:31.173

我建议用 Prolog 来描述规则。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-19T21:53:34.927

要表示棋盘的当前状态（包括转换可能性等），您可以使用 [Forsyth-Edwards Notation](http://en.wikipedia.org/wiki/Forsyth-Edwards_Notation)，它会给您一个简短的 ascii 表示。例如：

```
rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1

```

将是开放的董事会位置。

然后，为了表示从某个位置开始的特定移动，您可以使用[数字移动符号](http://en.wikipedia.org/wiki/ICCF_numeric_notation)（如在对应国际象棋中使用的那样），它为您提供了棋盘上移动的简短（4-5 位）表示。

至于代表规则 - 我很想了解自己。目前，我的国际象棋引擎的规则只是用 Python 编写的，可能不像我想要的那样具有声明性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-18T03:48:18.067

我同意 ΤZΩΤZΙΟΥ 留下的评论，即。只需让服务器进行验证并让客户端提交潜在的移动即可。如果这不是您想要的设计方式，那么只需按照 S. Lott 和其他人的建议用 Python 编写规则。

真的不应该那么难。您可以将规则分为三大类：
- 依赖于棋盘状态的规则（易位、过路、平局、过牌、将死、通过过牌、是否轮到该玩家等）
- 规则适用于所有棋子（不能与您自己颜色的另一棋子占据相同的方格，移动到带有对手棋子的方格==捕获，不能移出棋盘）
-适用于每个单独棋子的规则。（棋子不能向后移动，城堡不能对角移动，等等）

每个规则都可以实现为一个函数，然后对于每个半步，通过查看它是否通过所有验证来确定其有效性。

对于提交的每个潜在移动，您只需按以下顺序检查规则：

1.  拟议的举措可能有效吗？（这件作品的正确“形状”）
2.  它符合董事会的限制吗？（这块被挡住了，它会从边缘移开吗）
3.  此举是否违反国家要求？（这次行动后我是否受到检查？我是否通过检查？这是否合法？）

如果所有这些都正常，那么服务器应该接受这个移动是合法的……</p>

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-11T18:31:16.570

Drools 具有现代人类可读的规则实现——https: [//www.jboss.org/drools/](https://www.jboss.org/drools/)。他们有一种方式，用户可以在 Excel 中输入他们的规则。与其他工具相比，更多用户可以理解 Excel 中的内容。

# logging - 记录，何时以及什么？

> ID：194299
> 
> 赞同：8
> 
> 时间：2008-10-11T16:43:16.697
> 
> 标签：logging, error-logging

我目前正在开发一个相当大的多层应用程序，该应用程序将部署在海外。虽然我希望它一旦解散就不会倒下或炸毁，但我不能 100% 确定这一点。因此，很高兴知道我可以请求日志文件，以准确找出问题所在以及原因。

所以基本上正如标题所示，我想知道何时以及记录什么？我想知道这一点，以确保我有全面的日志文件，可以轻松检查以确定我的应用程序崩溃时发生的情况。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-11T16:52:52.387

1 - 制作一个具有标准化格式的日志。它是什么并不重要，但要确保每个条目都具有相同的基本字段。只是调用“printf”可能不会削减它（替换 System.err.println 或任何适当的）

2 - 允许至少一个字段是任意字符串...开发人员会比您更了解需要存在的内容。

3 - 在每个条目上包含一个高分辨率时间戳。你最终会需要它，相信我。

4 - 如果可能，包括错误来源的文件和行号。这在 C 中很容易，而在 Java 中则有点痛苦。但它在以后*非常*有用，尤其是当人们开始剪切+粘贴代码时，包括错误消息。

5 - 确保日志位于任何级别的代码都可以使用它的位置。

6 - 我经常使用“Primary”和“Secondary”错误标签，其中“Primary”表示“我是检测到问题的人”，“Secondary”表示“我调用了一个报告错误的函数”。这样可以很容易地找到问题的根源（“Primary: file not found”）并且仍然报告错误的含义（“Secondary: can't load tracking table”）。

7 - 包括一些记录非错误和错误的功能。

我发现最困难的部分是错误不一定是错误。如果您使用文件调用函数，并且该文件不存在，那么是否应该记录一个错误？有时它是一个严重的失败，有时它是意料之中的。这几乎取决于函数的 API；如果函数有办法返回错误，我通常会让它在不记录的情况下这样做；那么更高级别代码的工作就是决定是否需要报告该错误或是否需要报告。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-11T16:59:51.607

首先，给自己一个日志框架——你没有提到任何特定的语言，但是任何基于 Apache log4j 的框架都是一个安全的选择。最重要的是该框架支持不同级别的详细信息（调试消息、警告、错误消息）。您可以在运行时配置记录器，以确定它将实际写入哪些消息，以及写入到哪里——重新发明轮子来处理记录是没有意义的。

在源代码中实现您的日志框架。作为最低要求，您应该记录并为您的应用程序中可能发生的异常“增加价值”。将堆栈跟踪写入日志文件非常好，但很少能够诊断问题 - 考虑在 catch {} 中记录诸如方法参数值之类的内容。

在更高的级别上，您可以利用不同级别的详细程度来记录它在您的应用程序中发生的事情。如果错误仅发生在无法附加远程调试器的生产系统上，这尤其有用 - 您只需增加日志框架配置文件中的详细级别，并观察所有调试（“使用参数调用方法 X Y") 消息出现在日志中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T17:35:41.923

我只想补充一点，对于一个大型任务关键型应用程序，一旦部署，问题只能通过客户端发送的日志进行调查，随着时间的推移，对何时何地进行日志记录的良好感觉是应用程序成熟（成熟度与应用程序在一个地方部署和使用的时间量直接相关，以及它在不同客户端/位置的不同部署数量）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T16:54:16.643

只要您不必为性能付出太多，日志记录就很重要。

根据我的经验，您要记录的最重要的事情是那些警告、糟糕的、健全性检查失败、雨天场景等，在编写晴天场景时往往会忽略它们，有时会用打印“我们不应该到这里”等。这些东西倾向于在测试期间不出现，但在部署期间开始弹出，当然不会被捕获。

如果您记录并打算通过远程读取结果，请确保捕获确切的时间戳、位置和某种会话 ID（以防多个实例同时运行并写入日志文件）。您越容易确定哪些消息是一次执行的一部分，您就越好。

错误级别和类型也很重要。进行搜索以确保您没有从多个位置编写相同的消息也很重要，否则跟踪将很困难。

最后，如果您的用户运行 Mac OS X，请格外小心记录错误：出于某种奇怪的原因，即使在 Leopard 中，默认记录机制的处理成本也很高，并且会占用大量 CPU。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T17:36:30.363

我们开发了一个基于电话的大型系统，该系统在世界各地使用，并且多年来一直使用我们自己的日志记录系统进行应用。调试级别非常重要，我们的应用程序附带的调试设置为“仅错误”，除了对时间最敏感的之外，所有的都启用了日志到文件。我们还支持将我们的输出转移到调试跟踪系统（这是 Windows，所以它是对 OutputDebugString 的简单调用，我们的工程师可以访问一个名为 DBWIN32 的调试捕获器）。这很重要，因为某些类别的错误要求您能够查看多个应用程序的输出，并进行序列化。通过应用这种技术，我已经解决了一些非常棘手的多应用交互错误。应用程序通常会在输出中添加一个人类可读的标签，这样我们就可以在这种情况下判断哪一行来自哪个应用程序。

我们使用的级别通常是：关闭、仅错误、基本、详细、“详细”（其中详细是一个占位符，表示投票结果、用户操作、消息内容等多项内容——作者认为重要的任何内容）。

哦，应用程序写入其日志文件的第一件事是提供其版本资源的标题，因此我们可以知道我们正在处理的构建 - 不要相信用户或本地工程师知道:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-11T17:45:45.493

AOP 对于非侵入式日志记录非常有用。例如，您可以使用 AOP 记录每个方法调用的参数值和返回值，而无需实际将日志记录语句添加到每个方法中。

如何执行此操作的具体细节显然取决于您的目标语言和平台（您没有指定）。有关如何将此类记录器添加到基于 Java Spring 的应用程序的示例，请参见[此处](http://forum.springframework.org/showthread.php?t=36035)。

# c# - 用 C# 编写 [0..100] 的最佳方法是什么？

> ID：194304
> 
> 赞同：15
> 
> 时间：2008-10-11T16:46:57.810
> 
> 标签：c#, linq, optimization, sequences

我试图想出聪明、清晰和简单的方法来编写描述给定范围内整数序列的代码。

这是一个例子：

```
IEnumerable<int> EnumerateIntegerRange(int from, int to)
{
    for (int i = from; i <= to; i++)
    {
        yield return i;
    }
} 
```

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-10-11T16:49:17.027

这已经在框架中：[Enumerable.Range](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.range.aspx)。

对于其他类型，您可能对我的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)库中的范围类感兴趣。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-12T19:43:44.630

或者，来自扩展方法的流畅接口：

```
public static IEnumerable<int> To(this int start, int end)
{
    return start.To(end, i => i + 1);
}

public static IEnumerable<int> To(this int start, int end, Func<int, int> next)
{
    int current = start;
    while (current < end)
    {
        yield return current;
        current = next(current);
    }
} 
```

像这样使用：

```
1.To(100) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T19:41:35.850

这是一个让范围类同时处理离散和非离散事物的想法：

```
class Range<T> where T: IComparable<T>
{
    public T From { get; set; }
    public T To { get; set; }

    public Range(T from, T to) { this.From = from; this.To = to; }

    public IEnumerable<T> Enumerate(Func<T, T> next)
    {
        for (T t = this.From; t.CompareTo(this.To) < 0; t = next(t))
        {
            yield return t;
        }
    }

    static void Example()
    {
        new Range<int> (0, 100).Enumerate(i => i+1)
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T19:42:07.550

如果你认为每次都提供枚举器很烦人，这里有一个派生类：

```
class EnumerableRange<T> : Range<T>, IEnumerable<T>
    where T : IComparable<T>
{
    readonly Func<T, T> _next;
    public EnumerableRange(T from, T to, Func<T, T> next)
        : base(from, to)
    {
        this._next = next;
    }

    public IEnumerator<T> GetEnumerator()
    {
        return Enumerate(this._next).GetEnumerator();
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return this.GetEnumerator();
    }
} 
```

# iphone - iPhone 到 iPhone 通信

> ID：194327
> 
> 赞同：7
> 
> 时间：2008-10-11T17:11:43.580
> 
> 标签：iphone, networking, mobile, upnp

我有点好奇我应该如何处理 iPhone 和两部手机之间的通信问题。

我有一个需要在两部已知手机之间发送数据的应用程序的想法。问题是数据可能非常小或非常大。我希望在服务器和消息传递层上有中间存储，但我希望有一种高性能的方式在设备之间进行通信以获取更短、不重要的消息。

你总是听说网络和客户端到客户端与流行平台和协议的通信，但我很好奇人们对使用 iPhone 进行 p2p 风格通信的想法。

我很确定它应该（并且可以）被视为只是一个简单的可寻址机器......所以我必须将 NAT 遍历网络代码构建到 iPhone 本身中。我的想法是某种 UPnP 情况，我会要求对特定端口进行 NAT 以与设备通信……但我想我可以很容易地将其变成轮询情况。

诚然，我了解 Apple 最终将为开发人员提供“推送”机制，但我想提前将应用程序推出...

只是对这类事情的想法感到好奇......关于多人游戏情况的任何想法也将直接适用于（并从中受益）这个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-11T17:26:21.757

您是否尝试过 Apple 的 WiTap 示例？它解决了可发现性（通过 Bonjour）和连接性（通过基本 TCP）的问题。它可能不像您正在寻找的那样强大，但值得一看：

[http://developer.apple.com/iphone/library/samplecode/WiTap/index.html](http://developer.apple.com/iphone/library/samplecode/WiTap/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T19:15:32.317

查看 iPhone 3.0 SDK 中 Game Kit 的文档。它允许 iPhone 在本地通过蓝牙或通过 wi-fi/3G 相互连接。它解决了对等和客户端-服务器架构。它提供不可靠和可靠的链接。

# java - 如何在远程 Java Web 应用程序上进行内存分析

> ID：194328
> 
> 赞同：3
> 
> 时间：2008-10-11T17:12:17.150
> 
> 标签：java, memory, profiling

我知道我们可以使用 JProfiler 等工具。有没有关于如何配置它以仅通过远程监控显示内存使用情况的教程？

任何想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-11T17:31:01.327

你有 VisualGC，它不是很先进，但你可以看到你的应用程序的内存使用情况（垃圾，旧，烫发等......）

[http://java.sun.com/performance/jvmstat/visualgc.html](http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jstatd.html)

恢复：你在远程机器上启动一个守护进程监控（[http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jstatd.html](http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jstatd.html)，见安全段落）

```
JAVA_HOME/bin/jstatd -J-Djava.security.policy=jstatd.all.policy 
```

这里有一个名为**jstatd.all.policy**的文件，其中包含：

```
 grant codebase "file:${java.home}/../lib/tools.jar" {   
permission java.security.AllPermission;
}; 
```

在远程机器上，您获得了应用程序的 pid 以使用 jps 工具进行调试：

[http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jps.html#jps](http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jps.html#jps)

最后在您的本地机器上启动 visualgc ：

```
visualgc the_pid@remote_machine_address 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-23T09:56:40.143

我通常使用 YourKit，这是一个优秀的应用程序（需要许可证）。

在您的网络服务器启动/关闭脚本（catalina.sh for tomcat）中输入：

```
JAVA_OPTS="-Djava.awt.headless=true -agentlib:yjpagent -Xrunyjpagent:sessionname=Tomcat" 
```

您需要已下载 YourKit 并将其添加到您的库路径中（我也在 catalina.sh 中执行此操作）：

```
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:~/yourkit/yjp-6.0.16/bin/linux-x86-32 
```

然后，您可以在本地桌面上启动 YourKit 客户端并进行远程连接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-23T09:24:45.997

您可以更改为 Java 应用程序的 VM 参数，以允许远程分析类似`-agentlib:jprofilerti=port=25000`

[JProfiler 的一般解释](http://resources.ej-technologies.com/jprofiler/help/doc/)。

例子：

*   [NetBeans](http://profiler.netbeans.org/docs/help/5.5/attach.html#direct_attach)

*   [智能](http://plugins.intellij.net/plugin/?id=253)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-07T15:13:26.600

使用 Jprofiler 分析您的应用程序。以下是使用 Jprofiler 配置 Tomcat 的步骤。

1.  在 Linux 机器`.bash_profile`中从`/root`目录中打开文件。
    在中输入 jprofiler 位置（使用下面的命令导出）

    ```
    .bash_profile file
    export LD_LIBRARY_PATH=/dsvol/jprofiler6/bin/linux-x86 
    ```

2.  转到Tomcat安装目录。`catalena.sh`从文件夹中打开文件`bin`。
    在文件中输入以下详细信息`catelana.sh`（在 catalena.sh 文件中默认只有红色信息和黑色信息）。

    ```
    export JPROFILER_HOME
    JAVA_OPTS="-Xms768m -Xmx1024m -XX:PermSize=256m -XX:MaxPermSize=256m -Dfile.encoding=UTF8 -agentpath:/opt/Performance/jprofiler7/bin/linux-x86/libjprofilerti.so=port=8849 $CATALINA_OPTS" 
    ```

3.  通过执行`starup.sh`命令从 bin 文件夹启动服务器

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-08T06:47:16.610

我听说过 VisualVM 的好东西，这里有一篇关于如何远程启动它的文章：

[用于分析远程服务器的 Java VisualVM](http://www.codefactorycr.com/java-visualvm-to-profile-a-remote-server.html)

**编辑**：我在这里写了一篇关于如何通过 SSH 隧道设置远程分析的博客文章：

[http://kamilmroczek.com/2012/11/16/168787859/](http://kamilmroczek.com/2012/11/16/168787859/)

# grails - 向域类添加方法

> ID：194331
> 
> 赞同：10
> 
> 时间：2008-10-11T17:14:26.773
> 
> 标签：grails, groovy

我有一个包含几个字段的域类。我可以从我的 .gsps 访问它们。我想向域类添加一个方法，我可以从 .gsps 调用它（此方法是一种虚拟字段；它的数据不是直接来自数据库）。

如何添加该方法，然后如何从 .gsps 调用它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-11T17:29:02.953

要添加一个方法，只需像编写任何其他常规方法一样将其写出来。当您在 GSP 中显示它时，它将在对象上可用。

```
def someMethod() {
  return "Hello."
} 
```

然后在您的普惠制中。

```
${myObject.someMethod()} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T02:06:39.850

如果你想让你的方法看起来更像一个属性，那么让你的方法成为一个 getter 方法。一个名为 getFullName() 的方法可以像 ${person.fullName} 的属性一样被访问。注意没有括号。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-08-30T14:16:21.857

考虑如下类

类工作{

```
String jobTitle
String jobType
String jobLocation
String state

static constraints = {

    jobTitle nullable : false,size: 0..200
    jobType nullable : false,size: 0..200
    jobLocation nullable : false,size: 0..200
    state nullable : false

}

def jsonMap () {
    [
         'jobTitle':"some job title",
         'jobType':"some jobType",
         'jobLocation':"some location",
         'state':"some state"
    ]
    } 
```

}

您可以在任何地方使用该 jsonMap。在 gsp 中也像 ${jobObject.jsonMap()}

# python - Python 代码组织问题：Eggs + Packages + Buildout + Unit Tests + SVN

> ID：194339
> 
> 赞同：8
> 
> 时间：2008-10-11T17:21:05.480
> 
> 标签：python, svn, code-organization, buildout, egg

我有几个共享通用模块的 python 项目。直到现在，我一直在……咳咳……保留公共代码的多个副本并手动同步。但我显然更愿意做其他事情。

现在在我看来，好像 zc.Buildout 可能是我需要的。我想我应该做的是将系统的每个可重用组件放入一个单独的鸡蛋中，然后使用 buildout 将它们组装成项目。

我还认为对于任何特定模块，我应该将单元测试放入单独的包或鸡蛋中，这样我就不会在每个项目中安装组件的单元测试副本。我只想在开发我的库的地方进行单元测试，而不是在刚刚使用它的地方进行单元测试。

所以也许我想要这样的东西

```
projects
  lib1
    tests
    code
  lib2
    tests
    code
  app1
    tests 
    appcode
  app2
    tests
    appcode 
```

等等

其中 app1 和 app2 都是具有自己的代码和测试的独立应用程序，但也包含并使用 lib1 和 lib2。而 lib1/test、lib1/code、lib2/test、lib2code、app1、app2 是独立的鸡蛋。这听起来对吗？

然而，我现在很困惑。我假设当我开发 app1 时，我希望 buildout 将 lib1、lib2 和 app1 的副本拉到单独的工作目录中，而不是将这些库的副本直接放在 app1 下。但这如何与我的 SVN 源代码控制一起使用？如果工作目录是使用 buildout 动态构建的，它不能是一个实时 SVN 目录，我可以从中将更改检查回存储库吗？

我是否误解了 buildout 的使用方式？我会更好地采用完全不同的方法吗？你如何在项目之间混合源代码控制和模块重用？

更新：感谢目前已回答此问题的两个人。我正在对此进行更多实验。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-10-01T14:15:43.133

不要将测试与代码分开，您需要将两者紧密结合在一起。测试并没有占用那么多磁盘空间或任何内存！测试对您的图书馆用户非常有指导意义。

对于库包，请在包中包含一个`buildout.cfg`和`bootstrap.py`文件，以便轻松运行测试。例如，参见[plone.reload 包](https://github.com/plone/plone.reload)；请注意它如何使用[zc.recipe.testrunner](http://pypi.python.org/pypi/zc.recipe.testrunner)部分来创建一个测试脚本，该脚本将自动发现您的测试并运行它们。这样您就可以确保您的库包始终经过测试！

然后，您的应用程序包只需要测试集成和特定于应用程序的代码。同样，将测试包含在包本身中，在处理代码时不要忘记测试。使用`zc.recipe.testrunner`构建中的部件来发现和运行这些部件。

最后但同样重要的是，使用[mr.developer](http://pypi.python.org/pypi/mr.developer)来管理你的包。使用 mr.developer，您可以签出包作为您的工作，或者如果您不需要处理代码，则可以依赖已发布的版本。一个较大的项目将有许多依赖项，其中许多不需要您调整代码。使用 mr.developer，您可以随意提取源代码并将它们变成开发鸡蛋，直到您发布该代码并且您可以再次取消结帐。

要查看此类项目构建的实际示例，只需查看[Plone 核心开发构建](https://github.com/plone/buildout.coredev)。

该`sources.cfg`文件包含各种包的 SCM 位置的长列表，但通常使用鸡蛋的发布版本，直到您明确激活您计划使用的包。`checkouts.cfg`列出所有默认签出的包；这些软件包的更改将成为 Plone 下一版本的一部分，但尚未发布。如果你在 Plone 上工作，你会想要这些，因为你不能忽略这些变化。并`testing.cfg`列出了如果你想测试 Plone，你需要测试的所有包，一个很大的列表。

请注意，Plone 的来源来自很多地方。一旦你开始使用 buildout 和 mr.developer 来管理你的包，你就可以从任何地方自由地拉取你的源代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T04:37:08.237

我已经非常有效地使用了以下结构。在 SVN 中。

```
Lib1/
   branches/
   tags/
   trunk/
     lib1/
     tests/
     setup.py
Lib2
   branches/
   tags/
   trunk/
     lib2/
     tests/
     setup.py
App1
   branches/
   tags/
   trunk/
     app1/
     tests/
     setup.py
App2
   branches/
   tags/
   trunk/
     app2/
     tests/
     setup.py 
```

然后，我将创建我的开发工作区（我使用 eclipse/pydev），如下所示，从主干或分支签出。

```
Lib1/
   lib1/
   tests/
   setup.py
Lib2/
   lib2/
   tests/
   setup.py
App1/
   app1/
   tests/
   setup.py
App2/
   app2/
   tests/
   setup.py 
```

然后，我将使用 Eclipse 项目依赖项设置 python 路径，它与 Eclipse 代码完成配合得很好。setup.py 也可以，但不能很好地支持多个工作区。

对于部署，我使用以下结构创建单个 zip。

```
App1/
   lib1-1.1.0-py2.5.egg/
   lib2-1.1.0-py2.5.egg/
   app1/
   sitecustomize.py

App2/
   lib1-1.2.0-py2.5.egg/
   lib2-1.2.0-py2.5.egg/
   app2/
   sitecustomize.py 
```

我不使用安装程序安装，因为我想支持应用程序的多个版本，而且我对运行时环境有一些控制，所以我不会将 python 与我的部署打包，但如果在部署包中添加 Python 应该很容易它是必需的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T19:22:32.053

这就是您拥有[站点](http://www.python.org/doc/2.5.2/lib/module-site.html)模块的原因。它将内部设置`sys.path`为包含来自的所有包和模块

*   `lib/site-packages`-- 包括目录、鸡蛋和`.pth`文件。
*   `PYTHONPATH`

这样，您的库就只有一个工作副本。

有无限的方法可以利用它。这里有两个。

1.  在每个库中，编写一个`setup.py`正确部署您的库的代码。当您进行更改时，您`svn up`将收集更改并`python setup.py install`部署每个应用程序共享的一个工作副本。

2.  在每个应用程序中，要么取决于`PYTHONPATH`环境变量中的内容。确保`projects/lib1`并`projects/lib2`赢得了`PYTHONPATH`. 然后，每个应用程序共享各个库的一个工作副本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T19:38:52.057

我认为每个应用程序和库都是一个鸡蛋，并使用已经给出的示例之一在 SVN 中进行布局。真的，VCS 的结局应该不是问题。

然后，为了测试每个应用程序/库或组合，我会设置一个 virtualenv 并通过 setup.py develop 或实际安装它来安装每个包。Virtualenvwrapper 也是管理这些环境的有用工具，因为您可以简单地执行以下操作：

```
mkvirtualenv lib1-dev 
```

然后后来：

```
workon lib1-dev 
```

Virtualenv 使用 PYTHONPATH 来更好地控制已安装的软件包。同样，您可以使用 create 环境：

```
virtualenv --no-site-packages some-env 
```

它会忽略对您实际系统站点包的任何引用。这很有帮助，因为您不仅可以测试您的库/应用程序，还可以验证您在安装时具有正确的依赖关系。

# mysql - 无法访问 MySQL 服务器，不知道 root 帐户的密码

> ID：194345
> 
> 赞同：1
> 
> 时间：2008-10-11T17:26:51.600
> 
> 标签：mysql, centos

由于某些超出我的原因，我无法访问机器上的 mysql 服务器。我正在使用 CentOS 5 寻找未受影响的 MT (dv) 服务器。关于如何获取根目录的任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-11T17:34:27.840

使用跳过的授权表在安全模式下启动（首先停止正在运行的）你的 MySQL，例如：

```
safe_mysqld --user=mysql --skip-grant-tables --skip-networking 
```

此后，您应该可以在没有密码的情况下访问您的数据库，并且可以创建一个新的用户/密码。

# javascript - 强制 iframe 加载全帧

> ID：194346
> 
> 赞同：1
> 
> 时间：2008-10-11T17:26:52.067
> 
> 标签：javascript, html, iframe, frame

我有一个 HTML 页面（比如welcome.html），其中包含一个我无法控制的页面的 iframe（比如 app.html）。用户在 iframe 中使用应用程序执行一些操作并单击提交。一旦他们这样做了，他们就会被带到一个新页面（比如thanks.jsp），该页面在iframe中加载。有没有一种方法可以强制thanks.jsp在单击提交后加载全帧而不是iframe？请记住，我无法控制提交按钮或 app.html 背后的逻辑。不过，我确实可以控制welcome.html 和thanks.jsp。如果可能的话，我想坚持使用 HTML 和/或 JavaScript。先感谢您。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-11T17:39:37.673

您可能想要使用带有基本目标的 framebuster，以防万一失败。

第一的：

**如果** `thanks.jsp`通过发布请求请求 - 重定向，以便您将页面呈现为对获取请求的响应。

然后：

包括 framebuster JavaScript：

```
<script type="text/javascript">
   if (self != top) { top.location.replace(location); }
</script> 
```

最后：

如果用户没有启用 JavaScript，请确保他们不再停留在框架中，然后他们必须：

```
<base target="_top">
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T17:41:17.077

`thanks.jsp`你可以输入以下JS ：

```
// Parent window not the same as this one
if (self !=top) 
{
    top.location.href = self.location.href;
} 
```

`thanks.jsp`由于[相同的来源策略](http://en.wikipedia.org/wiki/Same_origin_policy)，如果您与包含框架的原始页面在同一台服务器上，这将起作用。

上面的代码检查您所在页面的 url，然后检查它正在执行的页面之一 ( `thanks.jsp`) - 如果它们不匹配，您将被发送到该`thanks.jsp`url。当是静态页面时，此方法可以正常工作`thanks.jsp`，但不会携带 postdata 等。

# java - 用Java存储应用程序的conf数据的正确方法是什么？

> ID：194349
> 
> 赞同：16
> 
> 时间：2008-10-11T17:29:38.740
> 
> 标签：java, configuration

您在哪里存储J2SE 应用程序的特定于*用户和特定*于*机器的* **运行时**配置数据？

（例如， Windows 上的 C:\Users\USERNAME\AppData\Roaming</em> 和Unix 上的*/home/username ）*

您如何以独立于平台的方式在文件系统中获取这些位置？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-11T19:33:52.123

先说格式：

1.  Java[属性文件](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream))适用于键/值对（也自动处理换行符）。通过使用“点符号”可以实现一定程度的结构。缺点是该结构不允许您轻松枚举顶级配置实体并以向下钻取的方式工作。最适合用于一小组通常可调整的特定于环境的设置
2.  XML 文件 - 经常用于各种 Java 框架（尤其是 J2EE 和 Spring）的更复杂的配置。我建议你至少了解一下[Spring——](http://static.springframework.org/spring/docs/2.5.x/reference/index.html)即使你决定不使用它，它也包含许多值得了解的想法。如果您决定推出自己的 XML 配置，我建议您使用带有自定义序列化选项的[XStream](http://xstream.codehaus.org/)，或者如果您只需要解析一些 XML，请查看[XOM](http://www.xom.nu/)。BTW Spring 还允许您插入自定义 XML 配置语言，但这是一项[相对复杂的任务](http://static.springframework.org/spring/docs/2.5.x/reference/extensible-xml.html)。XML 配置最适合用于最终用户看不到或无法调整的更复杂的“内部”配置。
3.  序列化 Java 对象 - 一种快速简便的方法来保持对象的状态并在以后恢复它。如果您编写配置 GUI 并且您不关心配置是否是人类可读的，这很有用。进化类时要注意[兼容性问题。](http://www.ibm.com/developerworks/library/j-serialtest.html)
4.  首选项 - 在[Java 1.4](http://java.sun.com/j2se/1.5.0/docs/api/java/util/prefs/Preferences.html)中引入，允许您在特定于平台的存储中存储类型化的文本、数字、字节数组和其他原语。在 Windows 上，即注册表（您可以在*HKLM*或*HKCU*下的*/Software/JavaSoft/Prefs*之间进行选择）。在 Unix 下，相同的 API 在用户 home 或*/etc*下创建文件。每个 prefs 配置单元都可以作为 XML 文件导出和导入。您可以通过将“java.util.prefs.PreferencesFactory”JVM 属性设置为您的实现类名称来指定[PreferencesFactory](http://java.sun.com/j2se/1.4.2/docs/api/java/util/prefs/PreferencesFactory.html)接口的自定义实现。

 ***一般来说，根据您的应用场景，使用 prefs API 可能是好事也可能是坏事。

1.  如果您计划在具有不同配置的同一台机器上运行相同代码的多个版本，那么使用 Preferences API 是个坏主意。
2.  如果您计划在受限环境（Windows 域或严格管理的 Unix 机器）中使用该应用程序，则需要确保您有权访问必要的注册表项/目录。这不止一次让我感到意外。
3.  当涉及多台活动机器时，请注意漫游配置文件（复制的主目录），它们弥补了一些有趣的场景。
4.  首选项不像应用程序目录下的配置文件那么明显。大多数桌面支持人员不期望也不喜欢它们。

关于首选项的文件布局，它再次取决于您的应用程序。一个通用的建议是：

1.  将大部分 XML 文件打包到应用程序的 JAR 中，位于根目录或 /META-INF 目录下。这些文件将是只读的，并被视为应用程序的私有文件。
2.  将用户可修改的配置放在*$APP_HOME/conf*下。它应该主要由属性文件和偶尔的简单 XML 文件（XStream 序列化）组成。这些文件作为安装过程的一部分进行了调整，通常用户无法使用。
3.  在用户主目录下，在一个点目录（即“~/.myapplication”）中存储任何用户配置。用户配置可能会覆盖应用程序*conf*目录中的配置。从应用程序中进行的任何更改都在这里（另请参阅下一点）。
4.  您还可以使用*$APP_HOME/var*目录来存储特定于此应用程序实例（而不是用户）的任何其他可变数据。这种方法的另一个优点是您可以通过一个目录的简单副本来移动和备份整个应用程序及其配置。

这说明了一些用于管理配置的标准技术。您可以使用不同的库和工具来实现它们，从原始 JRE、添加 Spring/Guice 或使用完整的 J2EE 容器（可能使用嵌入式 Spring）

其他管理配置的方法是：

1.  使用[多个基本目录](http://azeditech.com/tomcat/multiple-tomcat-instances.html)来运行使用不同配置的应用程序的多个实例。
2.  使用[轻量级](http://www.mulesource.org/display/GALAXY/Home) [注册表](http://wso2.org/projects/registry)进行集中配置管理
3.  一个集中管理的配置管理数据库 (CMDB) 文件，包含每台机器的特定于主机的值，每晚都会同步到所有生产主机。应用程序使用模板化配置，并在运行时根据当前主机名从 CMDB 中进行选择。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-11T17:44:09.520

这取决于您的 J2SE 应用程序类型：

*   J2SE 可执行 JAR 文件（非常简单）：使用[user.home 系统属性](http://www.mindspring.com/~mgrand/java-system-properties.htm)查找 home-dir。然后相应地制作一个子目录（例如PGP，SVN，...做）
*   Java Web Start 为安全属性提供了非常好的包含方法。始终针对用户
*   最后是 Eclipse RCP：你有工作空间的概念（也来自 user.home），用于用户和配置（不完全确定如何在 Vista 中访问这个棘手的问题）以供计算机广泛使用

所有这些方法在小心使用时——使用正确的[separatorChar——](http://java.sun.com/j2se/1.4.2/docs/api/java/io/File.html#separator)操作系统中立。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-11T17:46:45.523

Java 在[java.util.prefs.Preferences 中](http://java.sun.com/j2se/1.5.0/docs/api/java/util/prefs/Preferences.html)有一个专门用于执行此操作的库。

```
Preferences userPrefs = Preferences.getUserNodeForPackage(MyClass.class); // Gets user preferences node for MyClass
Preferences systemPrefs = Preferences.getSysteNodeForPackage(MyClass.class); // Gets system preferences node for MyClass
Preferences userPrefsRoot = Preferences.getUserRoot(); // Gets user preferences root node
Preferences systemPrefsRoot = Preferences.getSystemRoot(); // Gets system preferences root node 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T17:36:40.440

您可能想查看[Resource Bundles](https://docs.oracle.com/javase/7/docs/api/java/util/ResourceBundle.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T17:43:29.273

对于用户特定的配置，您可以将配置文件写入“user.home”系统属性指向的文件夹。当然只能在那台机器上工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-25T08:56:16.533

我用这个

```
    字符串路径文件 = null;
    如果（操作系统。包含（“赢”））{
        pathFile = System.getenv("AppData");
    }别的{
        pathFile = System.getProperty("user.home");
    }

```

我将我的应用程序的设置保存在这里 C:\Users\USERNAME\AppData\ 在其他平台上的 windows user.home (/home/USERNAME) 上

# database - Oracle 针对高容量写入和低容量读取的建议

> ID：194352
> 
> 赞同：2
> 
> 时间：2008-10-11T17:32:37.250
> 
> 标签：database, oracle, database-design

在线是否有一些关于如何调整 oracle 以进行大量插入和少量读取的一般准则？

下面的所有答案都是很好的建议。我必须澄清以下几点。我使用的是 10g，这是我们使用 Oracle 的绝对要求。我对用于调优的 oracle 实例参数也更感兴趣（可能是一些不同的锁定策略）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T18:23:06.727

让我假设您想要进行过多的插入，因此您只想忽略所有其他类型的操作，只是为了完成这些插入而没有问题。

首先，您是否完全排除了其他类型的数据库？有像行业数据库这样的系统可以很好地处理大量插入，通常用于接收和存储来自在工厂环境中测量某物的设备的数据。Oracle 是一个关系数据库，它可能不是满足您需求的正确软件类型。

话虽如此，让我们假设您可以、将要或应该使用 Oracle。您需要做的第一件事是考虑做出此假设所需的所有各种类型的数据。如果它们都是关于相同类型的数据，您需要 1 个表，并且它需要在插入方面保持精简和平均。

最佳方法是执行以下操作：

1.  根本不要在这个表上添加任何索引，如果你需要一个主键，那是你想要的唯一索引
2.  如果您需要对该表进行读取，请考虑使用一个影子表，其中包含您对其进行读取、查找和聚合的索引。如果这不必更新到毫秒，请考虑定期批处理作业以使用主表中的数据对其进行更新。这将尽可能少地用读锁干扰主表
3.  确保您的服务器具有快速磁盘。事务性写入操作通常会在某些时候涉及磁盘，因此请确保这是一个小的瓶颈。
4.  如果您的应用程序正在从许多传入源收集数据，请考虑在数据库前面添加一个层，以将并发连接数和对该表的事务数保持在最低限度。如果您在 Oracle 数据库的同一页面上获得大量写锁，最终您的性能将受到影响。

如果您可以拆分数据，请考虑将其拆分为将其存储在不同的物理磁盘上。这样，磁盘 I/O 问题就不会是跨数据类型的，只会影响一种数据类型。

在频谱的另一端，您有一个非规范化表，其中包含许多针对查找和更新之间的平衡进行了优化的索引，您需要找到一些中间方法来获得您想要的性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T17:45:17.630

在数据库设计方面，尽可能少地在要插入的表上放置约束、索引和触发器，因为这些都会减慢插入速度。

缺少索引显然会损害您的 SELECT 性能，但听起来这不是您最关心的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T04:11:16.053

一些建议供您进一步研究：-

*   直接路径负载
*   块压缩

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T18:06:34.047

我们在谈论什么样的应用程序？什么版本的甲骨文？

例如，如果您正在设计数据仓库加载过程，您通常希望将直接路径插入到临时表中，然后构建任何必要的索引，然后进行分区交换以将数据加载到分区目标表中. 当然，如果您正在执行单行插入，这也不起作用。

根据 Oracle 版本和应用程序的类型，您可能还希望对表启用压缩。从 CPU 的角度来看，插入通常很便宜，因此可能有大量 CPU 可用于进行压缩，这可以大大减少所需的 I/O 量，这通常会成为您的瓶颈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T21:05:53.060

我建议您将问题提交到 Tom Kyte 的网站**[http://asktom.oracle.com](http://asktom.oracle.com)**。您通常可以在那里找到答案。否则，请尝试**[Oracle 的论坛](http://forums.oracle.com/forums/main.jspa?categoryID=84)**。

还可以尝试查找任何 Tom Kyte 的书。建议检查图书馆或当地书店以找到合适的书，以确保该书包含适合您的主题。此外，**[他的博客](http://tkyte.blogspot.com/)**有指向他的书籍的链接以及每本书的一些文章/讨论。

我做了一个快速的 google，site:oracle.com 调优写作，发现了这个 **[OracleAS TopLink Writing Optimization Features](http://download-west.oracle.com/docs/cd/B14099_19/web.1012/b15901/tuning006.htm)**。我知道您可能没有使用 TopLink，但它可能有一些很好的提示。您想尝试使用的关键字：调整、性能、插入、改进。还通过您正在使用的技术，如 java/c++/等。

您可以尝试的其他提示：

*   使用存储过程或以更有效的方式使用它们。
*   调整服务器的硬件。更快的硬盘驱动器或特定的 RAID 阵列，可能更多的 cpu。
*   **[问汤姆线程](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:12083187196917)**- 这里有一些很好的评论，也链接到**[福勒的网站](http://www.martinfowler.com/articles/dblogic.html)**

您可能必须开始对您的查询/实现进行一些性能分析，以找到每个查询/实现的最佳位置。我希望我能给你一个简单的答案。祝你好运！

# c# - 非托管 C++ 加密字符串转换为 C# byte[]

> ID：194358
> 
> 赞同：2
> 
> 时间：2008-10-11T17:35:58.337
> 
> 标签：c#, c++, arrays, encryption, marshalling

我有一个从 C# 类库调用的非托管 C dll，它将字符串值加密为包含非 ascii 字符的加密字符串。我需要获取数据并将其二进制值写入文件，但 C# 将文本视为`string`而不是`byte[]`.

加密值通常包含特殊字符（`\r`、`\O`等）。当我使用某种类型的代码集（ascii、utf-7、utf-16）将返回的字符串转换为 C# 时，它会将特殊字符值写入 Windows 解释值而不是它们的实际二进制表示。

我的问题是如何将非托管 dll 中的数据提取到一个`byte[]`而不是一个字符串中，这样我就可以使用`BinaryWriter`?

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T17:54:55.677

如果我理解正确，我认为您可能希望 Encoding.GetBytes() 使用 UTF8？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T18:41:39.233

您是否尝试过使用 ASCIIEncoding 类？它应该将任何 UTF-8 字符转换为 '?' 的 ascii 字符。

[MSDN 页面](http://msdn.microsoft.com/en-us/library/system.text.asciiencoding.aspx "MSDN 页面")

**用法**

```
ASCIIEncoding ascii = new ASCIIEncoding();
Byte[] encodedBytes = ascii.GetBytes(unicodeString); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T18:46:19.893

你在使用 P/Invoke 吗？嗯...也许指定 [MarshalAs(UnmanagedType.*)] 会有所帮助。此外，您可以创建一个中间 C 函数，将加密数据公开为 (void *)。这应该更容易进入字节[]。

# plugins - Trac 有哪些推荐的插件？

> ID：194361
> 
> 赞同：34
> 
> 时间：2008-10-11T17:38:11.873
> 
> 标签：plugins, project-management, trac

特别是，我需要更完整的 Trac 版本来支持强大的项目管理和任务跟踪。我浏览了这些插件，从字面上发现了 50 多个看起来很有希望的插件。

我的问题是对 Trac 的管理员/用户：哪些对于完成 Trac 功能是必不可少的，哪些应该避免*（例如稳定性问题）*？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-11T19:59:56.377

许多 Trac 插件看起来很有希望。不幸的是，只有少数真正交付，即使这样，其中一些也没有得到适当的支持或维护。他们有时也会发生冲突。

我不会专门为项目管理推荐任何东西，但这些让我们的生活变得如此轻松：

*   [TagsPlugin](http://trac-hacks.org/wiki/TagsPlugin) - 最有用的一个，增加了标签支持
*   [BreadCrumbsNav](http://trac-hacks.org/wiki/BreadCrumbsNavPlugin) - 显示以前访问过的页面，节省大量时间
*   [ShowPath](http://trac-hacks.org/wiki/ShowPathPlugin) - 显示面包屑路径，如果您的页面分层命名，则很有用
*   [CaseInsensitiveWiki](http://trac-hacks.org/wiki/CaseInsensitiveWikiPlugin) - 允许输入不区分大小写的 URL
*   [Stratistics](http://trac-hacks.org/wiki/StractisticsPlugin) - 显示 Wiki/SVN 统计数据
*   [WikiRename](http://trac-hacks.org/wiki/WikiRenamePlugin) - 允许页面重命名（不适用于标签）

0.10

*   [WebAdmin](http://trac.edgewall.org/wiki/WebAdmin) - 预装在 0.11 中，但在您需要单独获取之前

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-01T13:33:02.000

我最喜爱的：

一般的：

*   更好的编辑器所见即所得： [http ://trac-hacks.org/wiki/TracWysiwygPlugin](http://trac-hacks.org/wiki/TracWysiwygPlugin)
*   TicketCalendar 宏： [http ://trac-hacks.org/wiki/WikiTicketCalendarMacro](http://trac-hacks.org/wiki/WikiTicketCalendarMacro)
*   AccountManager：[http ://trac-hacks.org/wiki/AccountManagerPlugin](http://trac-hacks.org/wiki/AccountManagerPlugin)

Scrum - Agilo：[http ://trac-hacks.org/wiki/AgiloForScrumPlugin](http://trac-hacks.org/wiki/AgiloForScrumPlugin)

这是观看的地方[http://trac-hacks.org/](http://trac-hacks.org/)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-29T03:14:36.793

除了这里已经提到的那些，我还发现以下必要的：

1.  [播音员](http://www.trac-hacks.org/wiki/AnnouncerPlugin)- 非常灵活的通知方案
2.  [AutocompleteUsers](http://trac-hacks.org/wiki/AutocompleteUsersPlugin) - 输入（现有）用户名时很方便
3.  [AutoLinks](http://trac-hacks.org/wiki/AutoLinksPlugin) - 自动将不符合 wiki 命名规则但与现有页面名称匹配的单词作为链接
4.  [CustomFieldAdmin](http://trac-hacks.org/wiki/CustomFieldAdminPlugin) - 使管理自定义字段更容易
5.  [重定向](http://svn.ipd.uka.de/trac/javaparty/wiki/TracRedirect)- 如果您经常需要制作简写名称 wiki 页面（如 HTML 重定向到超文本.....）
6.  [TicketDelete](http://trac-hacks.org/wiki/TicketDeletePlugin) - 使删除（如果需要）更容易
7.  [WikiRename](http://trac-hacks.org/wiki/WikiRenamePlugin) - wiki 重构的必备工具

以下是值得拥有的：

1.  [S5](http://trac-hacks.org/wiki/S5Plugin) - 直接将 wiki 页面呈现为 S5 格式的幻灯片，对于使用 Trac 作为演示源非常有用
2.  [FullBlog](http://trac-hacks.org/wiki/FullBlogPlugin) - 为 Trac 添加博客支持
3.  [投票](http://trac-hacks.org/wiki/VotePlugin)- 大团队的酷附加功能
4.  [TracWikiToPdf](http://trac-hacks.org/wiki/TracWikiToPdfPlugin) - 将 wiki 页面动态转换为 pdf（但效果可能非常令人满意）
5.  [TimingAndEstimation](http://www.trac-hacks.org/wiki/TimingAndEstimationPlugin) - 用于跟踪时间和/或估计

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-12T01:18:46.157

我真的很喜欢[BatchModifyPlugin](http://trac-hacks.org/wiki/BatchModifyPlugin)，它可以让您轻松更改多张票。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-26T23:10:36.250

[MasterTicketsPlugin](http://trac-hacks.org/wiki/MasterTicketsPlugin)对于票证依赖非常有用。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-06-16T11:17:05.173

尽管我正在使用Bitten，但我建议不要使用 Bitten 进行 CI（持续集成）（请参阅[Martin Fowler 的主题）。](http://www.martinfowler.com/articles/continuousIntegration.html)

Bitten 背后的工作组似乎不够强大，无法处理剩余的任务。只看[Bitten门票的年龄和发帖数](http://bitten.edgewall.org/query?status=assigned&status=new&status=reopened&col=id&col=summary&col=status&col=owner&col=type&col=priority&col=milestone&col=time&order=time)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-11T18:05:03.753

我不管理我们的 Trac，也不知道我们使用的所有插件。但我与人共同开发了一个 GUI，用于导航工单并跟踪花在特定工单上的时间。它使用**[xmlrpc](http://trac-hacks.org/wiki/XmlRpcPlugin)插件**来查询票证信息并写回一些信息。通过这种方式扩展 Trac 真的很容易。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-12-29T18:26:17.720

我的必备插件列表：

*   [http://trac-hacks.org/wiki/AccountManagerPlugin](http://trac-hacks.org/wiki/AccountManagerPlugin)
*   [http://trac-hacks.org/wiki/GitPlugin](http://trac-hacks.org/wiki/GitPlugin)
*   [http://trac-hacks.org/wiki/TagsPlugin](http://trac-hacks.org/wiki/TagsPlugin)
*   [http://trac-hacks.org/wiki/BatchModifyPlugin](http://trac-hacks.org/wiki/BatchModifyPlugin)
*   [http://trac-hacks.org/wiki/TicketDeletePlugin](http://trac-hacks.org/wiki/TicketDeletePlugin)
*   [http://trac-hacks.org/wiki/XmlRpcPlugin](http://trac-hacks.org/wiki/XmlRpcPlugin)

从 0.12 开始，有些可能是 trac 的一部分

和一个脚本：

*   [https://subtrac.sara.nl/oss/email2trac](https://subtrac.sara.nl/oss/email2trac)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-05-31T15:16:54.363

[Apache Bloodhound](http://bloodhound.apache.org/)是与 Trac 捆绑的插件集合。它包括早期答案中建议的一些单独插件，例如[AccountManagerPlugin](http://trac-hacks.org/wiki/AccountManagerPlugin)。

作为 Bloodhound 的一部分开发的主要插件是非常强大的[多产品实现](https://issues.apache.org/bloodhound/wiki/Proposals/BEP-0003)，具有更好导航的[全文搜索](https://issues.apache.org/bloodhound/wiki/BloodhoundSearch)（基于 Whoosh）。 [票务关系](https://issues.apache.org/bloodhound/wiki/Proposals/BEP-0006)也刚刚添加。

Bloodhound 不断快速集成新发布的 trac 版本，并且所有插件都按预期进行互操作，因为它们是有目的地捆绑在一起的。它也仍然与大多数[trac-hacks](http://trac-hacks.org/)兼容。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-06-04T11:17:16.157

您认为必备的插件在很大程度上取决于您的用例。

如果您需要更多功能来创建高级 wiki 页面，则必须拥有插件：

*   [Graphviz插件](https://trac-hacks.org/wiki/GraphvizPlugin)
*   [WikiExtras插件](https://trac-hacks.org/wiki/WikiExtrasPlugin)

如果您喜欢文本编辑器中的 IDE 风格的自动完成和缩进功能，则必须拥有插件：

*   [TextareaKeyBindings插件](https://trac-hacks.org/wiki/TextareaKeyBindingsPlugin)
*   [维基自动完成插件](https://trac-hacks.org/wiki/WikiAutoCompletePlugin)

如果您使用许多 Mercurial 存储库，则必须拥有插件：

*   [Mercurial插件](http://trac.edgewall.org/wiki/TracMercurial)
*   [HgDirManager 插件](https://trac-hacks.org/wiki/HgDirManagerPlugin)

必备插件，如果你...

*   ...想要存档电子邮件：[MailArchivePlugin](https://trac-hacks.org/wiki/MailArchivePlugin)
*   ...想要跟踪花费在任务上的时间：[TimeTrackingPlugin](https://trac-hacks.org/wiki/TimeTrackingPlugin)
*   ...想计划你的一周：[WeekPlanPlugin](https://trac-hacks.org/wiki/WeekPlanPlugin)
*   ...想要在堆栈之间拖动卡片：[CardsPlugin](https://trac-hacks.org/wiki/CardsPlugin)
*   ...

但是，如果您没有这些用例，您将不会发现这些插件有价值。

# java - 使用访问者模式和界面有什么区别？

> ID：194382
> 
> 赞同：6
> 
> 时间：2008-10-11T18:02:34.663
> 
> 标签：java, design-patterns, coding-style, visitor-pattern

将访问者设计模式应用于您的代码与以下方法有什么区别：

```
interface Dointerface {
    public void perform(Object o);
}

public class T {
    private Dointerface d;
    private String s;

    public String getS() {
            return s;
    }

    public T(String s) {
            this.s = s;
    }

    public void setInterface(Dointerface d) {
            this.d = d;
    }

    public void perform() {
            d.perform(this);
    }

    public static void main(String[] args) {
            T t = new T("Geonline");
            t.setInterface(new Dointerface() {
                    public void perform(Object o) {
                            T a = (T)o;
                            System.out.println(a.getS());
                    }
            });
            t.perform();
    }
} 
```

我假设通过使用接口，我们并没有真正分离算法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-11T18:49:46.003

有很大的不同。

访问者模式使用接口，但其目的是能够对一个或多个类（实现接口）执行操作，而无需更改类。因此，实现实际上“访问”类并在不修改类的情况下完成它的事情。

接口是一个基本概念，用于为可能不同的类组提供通用 API。对接口的典型测试是共享它的类至少在一个方面是相似的（is-like-a），并且在这些情况下可以这样对待。

[这是 wikipedia 上的一个简单示例，显示了几个 Java 访问者。](http://en.wikipedia.org/wiki/Visitor_pattern#Example_in_Java)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-11T19:04:38.423

两件事情：

*   在您的示例中，您需要两种方法。`perfom`和`setInterface`。_ 使用访问者模式，您只需要一种方法，`perfom`通常称为`accept`.
*   如果您需要多个“表演者”，则必须通过`setInterface`方法为每个表演者设置表演者。这使得不可能使您的类不可变。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T02:11:40.823

这些示例中最重要的区别是，在访问者案例中，您保留了“this”的编译时具体类型。这允许您使用双重分派，其中要调用的方法取决于具体数据类型和访问者实现。双重分派只是多重分派的一种特殊情况，其中调用的方法取决于接收者和方法参数的类型。Java 当然是单分派，但其他一些语言支持多分派。

访问者模式背后的基本驱动力是，通过在具体节点上使用接口，需要添加到复合数据结构中的每个操作都必须更改每个节点。访问者模式在节点上使用通用（静态）模式，因此动态添加操作很容易。缺点是修改数据结构（通过添加或删除具体节点）变得更加困难，因为所有操作访问者都会受到影响。

一般来说，这种权衡是更好的匹配，因为在数据结构上扩展操作比更改数据结构本身更频繁。这是我关于如何使用访问者和一系列注意事项的较长文章：

*   [http://tech.puredanger.com/2007/07/16/visitor/](http://tech.puredanger.com/2007/07/16/visitor/)

您可能会问是否有一种模式可以让我们同时做到这两种：在不破坏现有代码的情况下添加操作或扩展我们的数据结构。这被称为 Philip Wadler 创造的表达问题。您可以在此处找到有关此内容的一些链接以及更多链接：

*   [http://tech.puredanger.com/presentations/design-patterns-reconsidered](http://tech.puredanger.com/presentations/design-patterns-reconsidered)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-19T22:51:41.470

当您有一个由许多不同的类组成的数据结构并且您有多种算法需要对每个类进行不同的操作时，就会使用访问者模式。在您的示例中，您的 DoInterface 实现仅对一种类型执行一项操作。您唯一要做的就是打印 getS() 的结果，因为您将 o 转换为 T，您只能对 T 类型的类执行此操作。

如果您想将您的界面应用于典型的访问者样式类，那么您的带有 DoInterface.perform 函数的类可能会以一个大的 if else if 语句结束，如下所示：

```
 public void visit(Object o) {
        if (o instanceof File)
            visitFile((File)o);
        else if (o instanceof Directory)
            visitDirectory((Directory)o);
        else if (o instanceof X)
            // ...
    } 
```

因为这使用了 Object ，所以它允许任何类型的调用者创建只会在运行时出现的错误。访问者通过为数据结构中的每种类型创建一个“visitType”函数来解决这个问题。然后数据结构中的类负责了解访问者上的哪个函数要调用。映射由数据结构的每个类执行一个接受函数，然后回调访问者类。如果访问者上不存在该类型的函数，则会出现编译错误。接受方法如下所示：

```
 @Override
    public void accept(FileSystemVisitor v) {
        v.visitFile(this);
    } 
```

访问者模式的部分问题在于它需要相当多的代码才能在示例中真正做到公正。我认为这就是为什么很多人不明白它的原因，因为很容易被其他代码分心。我创建了一个简单的文件系统示例，希望能更清楚地展示如何使用访问者。它创建一个包含一些文件和目录的组合，然后对层次结构执行两个操作。在实践中，您可能需要两个以上的数据类和两个操作来证明这种模式的合理性，但这只是一个示例。

```
public class VisitorSample {
    //
        public abstract class FileSystemItem {
            public abstract String getName();
            public abstract int getSize();
            public abstract void accept(FileSystemVisitor v);
        }
    //  
        public abstract class FileSystemItemContainer extends FileSystemItem {
            protected java.util.ArrayList<FileSystemItem> _list = new java.util.ArrayList<FileSystemItem>();
    //              
            public void addItem(FileSystemItem item)
            {
                _list.add(item);
            }
    //
            public FileSystemItem getItem(int i)
            {
                return _list.get(i);
            }
    //          
            public int getCount() {
                return _list.size();
            }
    //      
            public abstract void accept(FileSystemVisitor v);
            public abstract String getName();
            public abstract int getSize();
        }
    //  
        public class File extends FileSystemItem {
    //
            public String _name;
            public int _size;
    //      
            public File(String name, int size) {
                _name = name;
                _size = size;
            }
    //      
            @Override
            public void accept(FileSystemVisitor v) {
                v.visitFile(this);
            }
    //
            @Override
            public String getName() {
                return _name;
            }
    //
            @Override
            public int getSize() {
                return _size;
            }
        }
    //  
        public class Directory extends FileSystemItemContainer {
    //
            private String _name;
    //      
            public Directory(String name) {
                _name = name;
            }
    //      
            @Override
            public void accept(FileSystemVisitor v) {
                v.visitDirectory(this);
            }
    //
            @Override
            public String getName() {
                return _name;
            }
    //
            @Override
            public int getSize() {
                int size = 0;
                for (int i = 0; i < _list.size(); i++)
                {
                    size += _list.get(i).getSize();
                }
                return size;
            }       
        }
    //  
        public abstract class FileSystemVisitor {
    //      
            public void visitFile(File f) { }
            public void visitDirectory(Directory d) { }
    //
            public void vistChildren(FileSystemItemContainer c) {
                for (int i = 0; i < c.getCount(); i++)
                {
                    c.getItem(i).accept(this);
                }
            }
        }
    //  
        public class ListingVisitor extends FileSystemVisitor {
    //      
            private int _indent = 0;
    //      
            @Override
            public void visitFile(File f) {
                for (int i = 0; i < _indent; i++)
                    System.out.print(" ");
                System.out.print("~");
                System.out.print(f.getName());
                System.out.print(":");
                System.out.println(f.getSize());
            }
    //  
            @Override
            public void visitDirectory(Directory d) {
                for (int i = 0; i < _indent; i++)
                    System.out.print(" ");  
                System.out.print("\\");
                System.out.print(d.getName());
                System.out.println("\\");
    //          
                _indent += 3;
                vistChildren(d);
                _indent -= 3;
            }
        }
    //  
        public class XmlVisitor extends FileSystemVisitor {
    //      
            private int _indent = 0;
    //      
            @Override
            public void visitFile(File f) {
                for (int i = 0; i < _indent; i++)
                    System.out.print(" ");
                System.out.print("<file name=\"");
                System.out.print(f.getName());
                System.out.print("\" size=\"");
                System.out.print(f.getSize());
                System.out.println("\" />");
            }
    //  
            @Override
            public void visitDirectory(Directory d) {
                for (int i = 0; i < _indent; i++)
                    System.out.print(" ");
                System.out.print("<directory name=\"");
                System.out.print(d.getName());
                System.out.print("\" size=\"");
                System.out.print(d.getSize());
                System.out.println("\">");
    //          
                _indent += 4;
                vistChildren(d);
                _indent -= 4;
    //          
                for (int i = 0; i < _indent; i++)
                    System.out.print(" ");
                System.out.println("</directory>");
            }
        }
    //  
        public static void main(String[] args) {
            VisitorSample s = new VisitorSample();
    //      
            Directory root = s.new Directory("root");
            root.addItem(s.new File("FileA", 163));
            root.addItem(s.new File("FileB", 760));
            Directory sub = s.new Directory("sub");
            root.addItem(sub);
            sub.addItem(s.new File("FileC", 401));
            sub.addItem(s.new File("FileD", 543));
            Directory subB = s.new Directory("subB");
            root.addItem(subB);
            subB.addItem(s.new File("FileE", 928));
            subB.addItem(s.new File("FileF", 238));
    //      
            XmlVisitor xmlVisitor = s.new XmlVisitor();
            root.accept(xmlVisitor);
    //      
            ListingVisitor listing = s.new ListingVisitor();
            root.accept(listing);
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T18:17:30.733

我看到的唯一显而易见的事情是，通过存储接口，您可以创建它，因此您必须执行两个操作而不是一个来调用它。我想如果您在设置界面后重复执行相同的操作，这可能是有道理的，但我认为您可以坚持使用标准的访问者并完成相同的事情。

# data-access-layer - 为引用另一个对象的对象创建数据访问层的最佳实践是什么？

> ID：194384
> 
> 赞同：0
> 
> 时间：2008-10-11T18:04:11.773
> 
> 标签：data-access-layer, business-logic

（对不起我的英语）例如，在我的 DAL 中，我有一个 AuthorDB 对象，它有一个 Name 和一个 BookDB 对象，它有一个 Title 和一个 IdAuthor。

现在，如果我想显示所有书籍及其相应作者的姓名，我必须获取所有书籍的集合，并使用 IdAuthor 属性为每本书找到作者姓名。这会对数据库进行大量查询，显然可以使用简单的 JOIN。

我有哪些选择？创建一个包含作者姓名和书名的“自定义”对象？如果是这样，维护可能会变得很糟糕。

那么，有哪些选择呢？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T16:47:50.007

当可靠、高效和通用的工具可用时，不要编写错误、低效和专业的东西。免费。

选择一个 ORM。NHibernate、ActiveRecord、SubSonic、NPersist、LinqToEF、LinqToSQL、LLBLGenPro、DB4O、CSLA 等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T16:40:17.807

非常感谢您的意见。

实际上，我们试图使数据库对象尽可能接近数据库中相应表的实际列。这就是为什么我们不能真正将（字符串）“作者”属性添加到 BookDB 对象。

这是我在使用“查看”对象时看到的问题。在数据库中，如果出于任何原因必须修改架构（例如：在 Book 表中，必须为“The_Title”修改“标题”列，我们如何轻松知道必须修改的所有“视图”对象？被修改？换句话说，当他们进行使用多个连接的查询时，我如何知道哪些对象必须被修改？

在这里，由于我们有一个 AuthorsBooks 对象，我们可以通过名称看到它可能对 book 和 author 表进行查询。但是，对于在表之间进行 4 或 5 个连接的对象，我们不能依赖对象名称。

有任何想法吗？（再次感谢您，这是一个很棒的网站！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T22:35:38.323

我建议你看看领域驱动设计。在 DDD 中，您从存储库中获取所有业务对象。存储库隐藏了您的数据存储和实现，并将解决您在如何查询数据和跟踪数据库更改方面的问题。因为每个业务对象都是从存储库中检索的，所以存储库将是您的单点更改。然后，存储库可以以您认为有效的任何方式查询您的数据库，然后从该数据构建您的域对象：

```
var books = new BookRepository().GetAllBooks(); 
```

您应该能够使用 Justice 提到的任何技术对存储库进行编码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-11T19:07:37.573

您可以在具有内置连接的数据库中创建一个视图，并将一个对象绑定到该视图，例如 AuthorBooksDB。它不会造成太严重的维护问题，因为视图可以隐藏任何潜在的更改并保持静态。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T20:31:38.357

如果您可以将数据库查询与对象构建分开，那么您可以创建一个查询来获取您需要的数据。然后将该数据传递给您的构建器并让它返回您的书籍。

使用 Linq to SQL，这可以很容易地完成：

```
public IEnumerable<Book> AllBooks()
{
    return  from book in db.Books
            join author in db.Authors on book.AuthorId equals author.Id
            select new Book() 
                        { 
                            Title = book.Title, 
                            Author = author.Name,
                        };
} 
```

使用 DataTables / DataSets 也可以实现相同的目的：

```
public IEnumerable<Book> AllBooks()
{
    DataTable booksAndAuthors = QueryAllBooksAndAuthors(); // encapsulates the sql query

    foreach (DataRow row in booksAndAuthors.Rows)
    {
        Book book = new Book();
        book.Title = row["Title"];
        book.Author = row["AuthorName"];
        yield return book;
    }
} 
```

# c# - 如何通过 OleDb 确定 MS Access 字段大小

> ID：194388
> 
> 赞同：1
> 
> 时间：2008-10-11T18:05:51.147
> 
> 标签：c#, ms-access, oledb, jet

现有应用程序使用 C#。在启动期间，应用程序调用一个虚拟方法来对数据库进行更改（例如，新修订可能需要计算新字段或其他内容）。打开的 OleDb 连接被传递到该方法中。

我需要更改字段宽度。ALTER TABLE 语句工作正常。但是如果字段已经是适当的大小，我想避免执行 ALTER TABLE 语句。有没有办法使用相同的 OleDb 连接来确定 MS Access 字段的大小？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T03:14:54.550

这是我根据 shahkalpesh 的回答得出的结论：

```
var command = new OleDbCommand("SELECT FIELD FROM TABLE", connection); 
var reader = command.ExecuteReader(CommandBehavior.SchemaOnly); 
var schema = reader.GetSchemaTable(); 
var size = Convert.ToInt32(table.Rows[0]["ColumnSize"]); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T19:25:45.870

不确定我是否完全理解你的问题。
但是您可以查询该表的 0 行（SELECT 1 FROM myTable WHERE 1= 0）

您可以使用记录的字段集合，按名称或索引引用该字段，并使用字段的属性，如大小、类型等。

这有帮助吗？

# java - 我如何发现永久代中的内容

> ID：194395
> 
> 赞同：11
> 
> 时间：2008-10-11T18:14:06.637
> 
> 标签：java, memory, garbage-collection, permgen, permanent-generation

给定一个堆转储或一个正在运行的虚拟机，我如何发现永久代的内容是什么？我知道“jmap -permstat”，但这在 Windows 上不可用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T20:19:26.120

永久代包含类对象。所以你应该检查堆转储或其他形式的对象列表的类。如果您对永久代的大小有疑问，通常是由两个原因引起的：

*   您使用的程序或库动态创建类，并且永久生成的默认大小太小 - 使用 -XX:MaxPermSize=256m 简单地创建大小
*   您的程序或您使用的库在每次调用时都会动态创建新类，因此永久代的大小会不断增加 - 这是您应该修复的编程错误（或搜索修复/创建错误报告）

要查看您的情况，请检查较长时期内永久代的大小。

关于永久代的一个很好的概述：

[http://blogs.oracle.com/jonthecollector/entry/presenting_the_permanent_generation](http://blogs.oracle.com/jonthecollector/entry/presenting_the_permanent_generation)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-22T06:51:31.823

这篇[使用 Java SE 5 进行内存监控的](http://www.informit.com/guides/content.aspx?g=java&seqNum=249)文章描述了如何以编程方式发现有关堆使用情况、内存池（包括 permgen 空间）等的信息。它非常简单：

```
 MemoryUsage usage = ManagementFactory.getMemoryMXBean().getNonHeapMemoryUsage();
    long nonHeapFree = usage.getMax() - usage.getUsed();
    long nonHeapTotal = usage.getMax(); 
```

在我对 OSX (Sun VM) 的测试中，“非堆内存使用”与为 permgen 池返回的值非常匹配，并且可能会对没有 permgen 的 VM 做一些有用的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-16T21:48:33.877

我正在研究同样的事情，但由于嵌入式平台的内存限制。

查看 jmap 的代码，permstat 工具只有在 sun.jvm.hotspot.tools.HeapSummary 类可用的情况下才可用。此类是可维护性代理的一部分。根据 OpenJDK 文档（http://openjdk.java.net/groups/serviceability/svcjdk.html#bsa）：

Serviceability Agent 组件是作为 HotSpot 存储库标准构建的一部分构建的。这些组件是：

-libsaproc.so：这是 SA 的本机代码组件。

-sa-jdi.jar：这是包含 SA 的 Java 类。它包括一个 JDI 实现，它允许 JDI 客户端对核心文件和挂起的进程进行只读调试。

SA 被 jinfo、jmap、jstack 使用

注意：Serviceability Agent 和使用它的技术当前不包含在 Windows 平台上的 JDK 版本中。

Oracle JDK 似乎也是如此。我正在寻找修改 jmap 工具以获取更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-24T08:14:01.133

[请参阅我关于Eclipse 的 thr permsize 的](http://kohlerm.blogspot.com/2008/11/blog-post.html)博客文章

简而言之，内存分析器可以做到，但您需要 SAP JVM。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T03:44:37.727

永久代实际上只包含两种东西：类定义和实习字符串。后者很少给你带来问题，但它经常被归咎于问题。由于代码生成和部分热重载（悬空引用），前者更常见。

不像名字所暗示的那样，permgen 最终也会被 GC 处理，只是不是常规 GC 周期的一部分。因此，未引用的实习字符串和未使用的类会被清理掉。但是 permgen 也不会动态增长，这意味着有时需要手动调整其设置以启动 JVM。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-14T09:48:52.260

你有具体的问题要解决吗？使用 String.intern() 是 permgen 问题的典型原因之一。此外，具有很多类的项目也存在 permgen 问题。

我不知道如何进入 permgen 看看它在那里......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-28T21:37:16.040

对我有帮助的一种技术是使用`-verbose:class` [java 的命令行选项](http://www.oracle.com/technetwork/java/javase/clopts-139448.html#gbmtm)，当类被加载/卸载时，你会得到日志输出。由于类被加载到 permgen，这在某些情况下会有所帮助。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-11T18:28:22.973

您可以使用 JConsole 或 jvisualvm.exe（使用 jdk 1.6 7）来查找在哪里。如果您想知道您的所有对象是如何相互关联的以及对象树，那么您可能想尝试 Eclipse Memory Analyzer -- [http://www.eclipse.org/mat/](http://www.eclipse.org/mat/)。

总之，你会从“ [http://www.eclipse.org/mat/](http://www.eclipse.org/mat/) ”得到你想要的。

祝你好运，

# javascript - 如何混淆（保护）JavaScript？

> ID：194397
> 
> 赞同：740
> 
> 时间：2008-10-11T18:17:18.970
> 
> 标签：javascript, obfuscation, source-code-protection

我想制作一个非开源的 JavaScript 应用程序，因此我想学习如何混淆我的 JS 代码？这可能吗？

* * *

## 回答 #1

> 赞同：427
> 
> 时间：2008-10-11T18:21:22.910

**混淆：**

~~试试[**YUI 压缩机**](http://yuilibrary.com/)。它是一个非常流行的工具，由 Yahoo UI 团队构建、增强和维护。~~

您还可以使用：

~~*   [谷歌闭包编译器](http://closure-compiler.appspot.com/home)~~
*   ~~[丑化JS](http://marijnhaverbeke.nl/uglifyjs)~~

`UPDATE: This question was originally asked on 2008, and The mentioned technologies are deprecated. you can use:`

*   [terser -](https://github.com/terser/terser) [web.dev](https://web.dev/unminified-javascript/)中的更多信息。

**私有字符串数据：**

将字符串值保密是一个不同的问题，混淆不会有太大的好处。当然，通过将您的源代码打包成一个乱码、缩小的混乱，您可以通过**默默无闻获得一个轻量级的****安全性**。大多数情况下，查看源代码的是您的用户，而客户端上的字符串值是供他们使用的，因此通常不需要这种私有字符串值。

 **如果你真的有一个你不想让用户看到的价值，你会有几个选择。首先，您可以进行某种加密，在页面加载时对其进行解密。这可能是最安全的选择之一，但也有很多可能不必要的工作。您可能可以对一些字符串值进行 base64 编码，这会更容易.. 但是真正想要这些字符串值的人可以**轻松解码它们**。加密是真正防止任何人访问您的数据的唯一方法，大多数人发现加密比他们需要的更安全。

**边注：**

众所周知，Javascript 中的混淆会导致一些错误。混淆器对此有所改善，但许多机构认为他们从**压缩**和**gzip 压缩**中看到了足够的好处，而且混淆的额外节省**并不总是值得麻烦的**。如果你试图保护你的源代码，也许你会认为值得你花时间，只是为了让你的代码更难阅读。[**JSMin**](http://www.crockford.com/javascript/jsmin.html)是一个不错的选择。

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2010-04-17T15:14:49.847

我很惊讶没有人提到 Google 的[Closure Compiler](http://code.google.com/closure/compiler/)。它不只是缩小/压缩，它分析以查找和删除未使用的代码，并重写以最大程度地缩小。它还可以进行类型检查并警告语法错误。

JQuery 最近从 YUI Compresser 切换到 Closure Compiler，并看到了“[坚实的改进](http://twitter.com/jeresig/status/5462879648)”

* * *

## 回答 #3

> 赞同：130
> 
> 时间：2008-10-25T23:24:56.637

混淆永远不会真正起作用。对于任何真正想了解您的代码的人来说，这只是一个减速带。更糟糕的是，它使您的用户无法修复错误（并将修复发送回给您），并使您更难诊断现场问题。这是浪费你的时间和金钱。

与律师讨论知识产权法以及您的法律选择是什么。[“开源”](https://en.wikipedia.org/wiki/Open-source_license)并不意味着“人们可以阅读源代码”。相反，开源是一种特殊的许可模式，允许自由使用和修改您的代码。如果您不授予这样的许可，那么复制您的代码的人就属于违规行为，并且（在世界上的大多数地方）您可以选择法律来阻止他们。

真正保护您的代码的唯一方法是不发布它。将重要的代码移动到服务器端并让您的公共 Javascript 代码对其进行 Ajax 调用。

[在这里查看我关于混淆器的完整答案。](https://stackoverflow.com/questions/232736/code-obfuscator-for-php)

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2008-10-11T19:21:26.687

您可以随心所欲地混淆 javascript 源代码，但它始终是可逆向工程的，因为它要求所有源代码实际运行在客户端机器上......我能想到的最佳选择是完成所有处理使用服务器端代码，javascript 所做的所有客户端代码都是向服务器本身发送处理请求。否则，任何人都将始终能够跟踪代码正在执行的所有操作。

有人提到 base64 来保证字符串的安全。这是一个可怕的想法。想要对您的代码进行逆向工程的人可以立即识别 Base64。他们要做的第一件事就是取消编码，看看它是什么。

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2008-10-11T18:26:52.633

有许多免费的 JavaScript 混淆工具。但是，我认为重要的是要注意很难将 JavaScript 混淆到无法进行逆向工程的程度。

为此，我在某种程度上加班时使用了几个选项：

*   [YUI 压缩机](http://developer.yahoo.com/yui/compressor/)。Yahoo! 的 JavaScript 压缩器在压缩代码方面做得很好，可以缩短加载时间。有一个小级别的混淆，效果相对较好。本质上，Compressor 将更改函数名称、删除空格并修改局部变量。这是我最常使用的。这是一个基于 Java 的开源工具。

*   [JSMin](http://www.crockford.com/javascript/jsmin.html)是一个由 Douglas Crockford 编写的工具，旨在缩小您的 JavaScript 源代码。用 Crockford 自己的话来说，“JSMin 不会混淆，但会丑化”。它的主要目标是缩小源代码的大小，以便在浏览器中更快地加载。

*   [免费的 JavaScript 混淆器](http://www.javascriptobfuscator.com/Default.aspx)。这是一个基于 Web 的工具，它试图通过实际编码来混淆您的代码。我认为其编码（或混淆）形式的权衡可能会以文件大小为代价；但是，这是个人喜好问题。

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2013-07-04T11:12:40.907

我会做什么：

**A.**巨魔黑客！

这将在我的伪造/混淆秘密 javascript 代码 LAUNCHER 的第二部分中。您在源代码中看到的那个。

这段代码是做什么的？

1.  加载真实代码
2.  设置自定义标题
3.  发布自定义变量

* * *

```
var ajax=function(a,b,d,c,e,f){
 e=new FormData();
 for(f in d){e.append(f,d[f]);};
 c=new XMLHttpRequest();
 c.open('POST',a);
 c.setRequestHeader("Troll1","lol");
 c.onload=b;
 c.send(e);
};
window.onload=function(){
 ajax('Troll.php',function(){
  (new Function(atob(this.response)))()
 },{'Troll2':'lol'});
} 
```

**B.**稍微混淆一下代码

那是什么？

1.  这与上面 base64 中的代码相同
2.  这不是秘密的 javascript 代码

* * *

```
(new Function(atob('dmFyIGFqYXg9ZnVuY3Rpb24oYSxiLGQsYyxlLGYpe2U9bmV3IEZvcm1EYXRhKCk7Zm9yKGYgaW4gZCl7ZS5hcHBlbmQoZixkW2ZdKTt9O2M9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7Yy5vcGVuKCdQT1NUJyxhKTtjLnNldFJlcXVlc3RIZWFkZXIoIlRyb2xsMSIsImxvbCIpO2Mub25sb2FkPWI7Yy5zZW5kKGUpO307d2luZG93Lm9ubG9hZD1mdW5jdGlvbigpe2FqYXgoJ1Ryb2xsLnBocCcsZnVuY3Rpb24oKXsgKG5ldyBGdW5jdGlvbihhdG9iKHRoaXMucmVzcG9uc2UpKSkoKX0seydUcm9sbDInOidsb2wnfSk7fQ==')))() 
```

**C**创建一个很难显示的php文件，里面有真实的代码

这个php代码是什么？

1.  检查正确的引荐来源网址（您的启动器的域/目录/代码）
2.  检查自定义 HEADER
3.  检查自定义 POST 变量

如果一切正常，它会向您显示正确的代码，否则会显示假代码或禁止 IP，关闭页面.. 随便。

```
<?php
$t1=apache_request_headers();
if(base64_encode($_SERVER['HTTP_REFERER'])=='aHR0cDovL2hlcmUuaXMvbXkvbGF1bmNoZXIuaHRtbA=='&&$_POST['Troll2']=='lol'&&$t1['Troll1']='lol'){
 echo 'ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkuaW5uZXJUZXh0PSdBd2Vzb21lJzsNCg==';//here is the SECRET javascript code
}else{
 echo 'd2luZG93Lm9wZW4oJycsICdfc2VsZicsICcnKTt3aW5kb3cuY2xvc2UoKTs=';
};
?> 
```

base64 推荐人 =`http://here.is/my/launcher.html`

秘密 javascript =`document.body.appendChild(document.createElement('div')).innerText='Awesome';`

假=`window.open('', '_self', '');window.close();`

现在..如果您在 SECRET javascript 中定义事件处理程序，它可能是可访问的..您需要使用启动代码在外部定义它们并指向嵌套的 SECRET 函数。

所以...有没有一种简单的方法来获取代码？ `document.body.appendChild(document.createElement('div')).innerText='Awesome';`

**我不确定这是否有效，但我正在使用 chrome 并检查了 Elements、Resources、Network、Sources、Timeline、Profiles、Audits 但我没有找到上面的行。**

注意 1：如果你在 chrome 中从 Inspect element->network 打开 Troll.php url，你会得到假代码。

注意2：整个代码是为现代浏览器编写的。polyfill 需要更多代码。

编辑

启动器.html

```
<!doctype html><html><head><meta charset="utf-8"><title></title><script src="data:application/javascript;base64,KG5ldyBGdW5jdGlvbihhdG9iKCdkbUZ5SUdGcVlYZzlablZ1WTNScGIyNG9ZU3hpTEdRc1l5eGxMR1lwZTJVOWJtVjNJRVp2Y20xRVlYUmhLQ2s3Wm05eUtHWWdhVzRnWkNsN1pTNWhjSEJsYm1Rb1ppeGtXMlpkS1R0OU8yTTlibVYzSUZoTlRFaDBkSEJTWlhGMVpYTjBLQ2s3WXk1dmNHVnVLQ2RRVDFOVUp5eGhLVHRqTG5ObGRGSmxjWFZsYzNSSVpXRmtaWElvSWxSeWIyeHNNU0lzSW14dmJDSXBPMk11YjI1c2IyRmtQV0k3WXk1elpXNWtLR1VwTzMwN2QybHVaRzkzTG05dWJHOWhaRDFtZFc1amRHbHZiaWdwZTJGcVlYZ29KMVJ5YjJ4c0xuQm9jQ2NzWm5WdVkzUnBiMjRvS1hzZ0tHNWxkeUJHZFc1amRHbHZiaWhoZEc5aUtIUm9hWE11Y21WemNHOXVjMlVwS1Nrb0tYMHNleWRVY205c2JESW5PaWRzYjJ3bmZTazdmUT09JykpKSgp"></script></head><body></body></html> 
```

巨魔.php

```
<?php $t1=apache_request_headers();if(/*base64_encode($_SERVER['HTTP_REFERER'])=='PUT THE LAUNCHER REFERER HERE'&&*/$_POST['Troll2']=='lol'&&$t1['Troll1']='lol'){echo 'ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkuaW5uZXJUZXh0PSdBd2Vzb21lJzsNCg==';}else{echo 'd2luZG93Lm9wZW4oJycsICdfc2VsZicsICcnKTt3aW5kb3cuY2xvc2UoKTs=';}; ?> 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-10-11T18:23:36.213

解释语言的问题在于，您发送源代码以使它们正常工作（除非您有字节码的编译器，但话又说回来，反编译非常简单）。

因此，如果您不想牺牲性能，则只能对变量和函数名称进行操作，例如。用 a、b...aa、ab... 或 a101、a102 等替换它们。当然，尽可能多地删除空格/换行符（这就是所谓的 JS 压缩器所做的）。
如果您必须对它们进行加密和实时解密，那么混淆字符串会对性能造成影响。加上一个 JS 调试器可以显示最终值......

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2010-06-08T20:35:32.097

试试[JScambler](http://www.jscrambler.com)。我最近试了一下，对它印象深刻。它为那些不太关心细节而只想快速完成它的人提供了一组带有预定义设置的混淆模板。您还可以通过选择所需的任何转换/技术来创建自定义混淆。

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2010-08-22T12:44:20.103

与我建议反对 YUI Compressor 的大多数其他答案相反；你应该使用[谷歌关闭](http://code.google.com/closure/)。

不是因为它压缩得更多，但主要是因为它会捕获 javascript 错误，例如`a = [1,2,3,];`使 IE 失控。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2008-10-11T19:15:01.507

我可以推荐Patrick J. O'Neil 的[JavaScript Utility](http://jsutility.pjoneil.net/)。它可以混淆/压缩和压缩，它似乎很擅长这些。也就是说，我从未尝试将它集成到任何类型的构建脚本中。

至于混淆与缩小 - 我不是前者的忠实粉丝。它使调试变得不可能（第 1 行出现错误......“等等，只有一行”）并且它们总是需要时间来解包。但如果你需要……好吧。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2008-10-12T05:44:51.407

一个非开源的基于 Javascript 的应用程序是相当愚蠢的。Javascript 是一种客户端解释语言.. 混淆并没有太多保护..

JS 混淆通常是为了减小脚本的大小，而不是“保护”它。如果您不希望自己的代码公开，那么 Javascript 不是正确的语言。

周围有很多工具，但大多数工具的名称中都有“压缩器”（或“压缩器”）这个词是有原因的。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2014-01-02T23:56:01.117

您无法保护客户端代码：只需在 Google Chrome 上按 F12，*暂停 javascript 执行*，您将获得所有字符串，即使是加密的。[美化](http://jsbeautifier.org/)它[并重命名变量](http://esprima.org/demo/rename.html)，您将获得几乎原始代码。

如果您正在编写服务器端 javascript（即 NodeJS），害怕有人侵入您的服务器并想让黑客的工作更加困难，让您有更多时间重新获得访问权限，那么请使用*javacript 编译器*：

您需要在 Advanced Compilation 上使用 Closure Compiler，因为它是重命名所有变量的唯一工具，即使这些变量在多个文件/模块中使用。但它只是有一个问题：它只有在你用它的[编码风格](https://developers.google.com/closure/compiler/docs/api-tutorial3)编写时才有效。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2011-04-15T23:27:39.727

我建议首先使用 YUI Compressor 之类的东西进行缩小，然后使用[http://www.javascriptobfuscator.com/之类的东西将所有字符串和数字转换为 HEX 值](http://www.javascriptobfuscator.com/)

有了这个，代码将变得几乎无法理解，我认为在这个阶段，黑客重新制定你的代码比从头开始重新编写实际需要更多的时间。重写和克隆是你实际上无法停止的。毕竟我们是自由人！

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2011-04-20T03:30:38.400

Dean Edward 的 Packer 是一个出色的混淆器，尽管它主要混淆代码，而不是代码中可能包含的任何字符串元素。

请参阅：[在线 Javascript 压缩工具](http://jscompress.com) 并从下拉列表中选择 Packer (Dean Edwards)

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-01-24T01:12:38.317

我的印象是一些企业（例如：JackBe）将加密的 JavaScript 代码放在 *.gif 文件中，而不是 JS 文件中，作为一种额外的混淆措施。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2011-07-22T19:26:44.197

我正在使用 Closure-Compiler 实用程序进行 java 脚本混淆。它缩小了代码并有更多的混淆选项。此实用程序可在以下 URL 的 Google 代码中获得：
[关闭工具](http://code.google.com/closure/compiler)

但是现在我听到很多关于 UglifyJS 的消息。您可以找到 Closure Compiler 和 UglifyJS 之间的各种比较，其中 Uglify 似乎是赢家。
[UglifyJS：一个快速的 Node.js 新 JavaScript 压缩器，与 Closure 相当](http://badassjs.com/post/971960912/uglifyjs-a-fast-new-javascript-compressor-for-node-js)

很快我就会给 UglifyJS 机会。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2011-08-19T09:54:53.063

试试这个工具[Javascript Obfuscator](http://javascript-source.com/)

我在我的 HTML5 游戏中使用了它，它不仅将它的大小从 950KB 减少到 150，而且还使源代码不可读，闭包编译器和压缩器是可逆的我个人不知道如何扭转这种混淆。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2012-01-01T07:31:51.403

我已经使用[Jasob](http://www.jasob.com/)多年了，它无疑是最好的混淆器。
它具有高级 UI，但仍然直观且易于使用。
它还将处理 HTML 和 CSS 文件。

使用它的最佳方法是在所有*私有*变量前加上下划线之类的前缀，然后使用该`sort`功能将它们全部组合在一起并将它们作为混淆目标 *检查。*

用户仍然可以查看您的源代码，但是当您的私有变量`_sUserPreferredNickName`从`a`.

引擎将自动计算目标变量的数量并优先考虑它们以获得最大的压缩。

我不为 Jasob 工作，我从宣传他们中得不到任何好处，只是提供一些友好的建议。
缺点是它不是免费的，而且有点贵，但在与替代品叠加时仍然值得 - “免费”选项甚至没有接近。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2012-10-05T13:19:25.960

你试过[香蕉脚本](http://www.bananascript.com/)吗？它产生高度压缩且完全不可读的代码。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2010-04-17T15:07:00.570

作为一个 JavaScript/HTML/CSS 混淆器/压缩器，你也可以试试[Patu Digua](http://digua.sf.net)。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2011-05-06T08:26:09.627

我过去用过这个，它做得很好。它不是免费的，但你一定要看看。
[JavaScript 混淆器和编码器](http://www.stunnix.com/prod/jo)

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2012-03-25T21:06:11.280

您绝对应该考虑看看[Obfuscriptor](http://www.obfuscriptor.com/)。

我超越了我们从[YUI Compressor](http://developer.yahoo.com/yui/compressor/)或[Google Closure](http://closure-compiler.appspot.com/home)等其他工具中看到的典型 Javascript 缩小技巧。

混淆后的代码看起来更像是加密的。不像我以前见过的任何东西。

# windows - Windows 开发人员切换到 Linux 的资源

> ID：194418
> 
> 赞同：5
> 
> 时间：2008-10-11T18:32:40.500
> 
> 标签：windows, linux

我正在寻求一些帮助，它是这样的：我是一个相当绿色的软件开发人员，主要专注于网络（python/PHP），但在 Java 应用程序方面经验丰富，作为一名电气工程专业的学生，​​期待潜入一些 c/c++。我几乎是在 Windows 机器上长大的，但对 .net 充满热情，并且真的不需要在 Windows 上开发——除了我已经习惯了。

我希望完全切换到 Ubuntu 作为我的开发机器（没有在另一个分区上安装 WinXP），因为我已经厌倦了 Windows，但是每当我遇到无数的驱动程序问题时，我都想回到它耳机驱动程序或双显示器设置等）。我正在寻找有助于这种转变的综合资源，并且不假设您知道外星人 linux shell 关键字。

干杯。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-11T18:43:28.963

就我个人使用 Ubuntu 的经验而言，我始终能找到帮助的两个地方是[Ubuntu 论坛](http://ubuntuforums.org/)和[Ubuntu Wiki](https://wiki.ubuntu.com/)。这两个站点展示了 Ubuntu 社区的帮助、组织和积极性。

另一个资源也是[IRC 上的 Ubuntu 频道](http://www.ubuntu.com/support/community/chatirc)。每当我遇到一个我认为有必要与某人（或少数人）讨论的问题时，IRC 总是一个好去处。

最后，我倾向于通过阅读大量参与 Ubuntu 开发的人们的博客来学习很多东西。[Planet Ubuntu](http://planet.ubuntu.com/)是一个很好的提要，可以保留在您的读者中。它本质上是许多博客的集合。大多数帖子都与 Ubuntu 相关；但是，偶尔会有一些帖子只是关于开发人员的想法和意见。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T21:00:20.560

我建议您以以下方式设置您的 PC：

*   有三个分区，一个用于交换（1-2x 内存大小），一个用于 /（根目录），一个用于 /home。
*   将与运行 linux 无关的**所有内容**保存在 /home 或完全独立的硬盘上。不要将您想保留的东西存储在保存 / 的分区上。

这使您可以相当有效地核对整个 linux 安装并安装另一个，而不会丢失您的数据*或*设置。这使您可以做两件事：

*   如果你真的破坏了你的安装，你通常可以直接删除它并重新安装。您将要尝试的大多数发行版都会快速将您升级回当前版本。
*   如果你对 Ubuntu 不满意，你可以直接核对它并安装其他东西，比如 OpenSUSE、CentOS 或 Fedora。

要记住的关键是，您的所有个人设置（桌面背景、应用程序设置等）都存储在隐藏目录下的 /home/yourname/ 中，例如，通过使用“.”命名它们来定义`.gnome`。系统设置存储在 /etc 中，但现在大多数发行版的系统设置都被猜到了，你永远不需要关心。您关心的数据位于 /home/yourname 下。

如果您要迁移到另一个发行版，我建议您将这些隐藏目录复制到您的主目录/您的名字目录下的另一个目录中，例如“old-prefs”之类的。这是因为您想从新安装开始“全新”。您可以复制回您知道以后想要的隐藏目录（例如，我总是复制回 .opera、.mozilla）。

另外，不要扔掉你的 Windows 安装，反正还没有。你可能会发现 Linux 不适合你。您可能会发现在不重新启动痛苦的情况下无法玩任何新游戏。根据我的经验，包括 Adob​​e Flash 和各种与声音相关的东西（由于早期的 PulseAudio 采用，声音最近在 imo 中扎根），您可能会发现各种东西不像在 Windows 上那样无缝地工作。

正如其他人所说，Ubuntu wiki 和 Ubuntu 论坛很好，因此它是我建议您尝试的第一个发行版。它是如此受欢迎，以至于您经常通过将 'linux' 替换为 'ubuntu' 来在 google 中获得更好的结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T19:13:08.733

本身不是答案，而是一些不请自来的建议：

*   所有平台都有问题
*   在一个平台上开发与在另一个平台上开发非常相似
*   熟悉 *nix 和 Windows 世界很有用

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-11T20:58:54.543

在回答问题的资源方面，我同意[汤姆的回答](https://stackoverflow.com/questions/194418/resources-for-windows-developer-to-switch-to-linux#194429)。除此之外，我建议您准备好学习使用命令提示符，并了解比您在 Windows 上可能习惯的更多的系统基础知识。一般来说，Linux 比 Windows 更频繁地暴露操作系统的“机器”，如果你是那种不喜欢偶尔修补东西的人，那么它可能不适合你。

例如，我父亲是一名工程师和经验丰富的程序员，他对使用 Linux 没有兴趣，因为他不想为了让它们工作而费尽心思。对他来说，使用 Windows 就是一条阻力最小的道路。另一方面，我经常使用 OS X 和 Linux，我喜欢当事情不正常时，我至少可以选择深入研究并解决问题。我喜欢命令行界面的现成可用性、大量的脚本选项以及 Linux 的普遍开放性。从您的帖子中很难看出您具有哪种性格，但如果您期待深入研究 C/C++ 并且喜欢电气工程，那么 Linux 可能非常适合您。

最后，我强烈建议经常使用命令提示符，即使有 GUI 界面也是如此。Linux GUI 应用程序通常构建在控制台应用程序之上。如果您熟悉并熟悉命令行，那么处理事物几乎总是会更容易。大多数经验丰富的 *nix 用户还发现，从命令提示符处完成多种类型的任务最终会变得更加高效和舒适。如果您打算在 Linux 上进行开发，那么这更有可能发生，因为您习惯于使用 UNIX 平台上常见的构建工具和脚本。

**编辑**：我不能推荐的最后一件事是：使用虚拟化！安装[VirtualBox](http://virtualbox.org/)、[VirtualPC](http://www.microsoft.com/downloads/details.aspx?FamilyID=04d26402-3199-48a3-afa2-2dc0b40a73b6&displaylang=en)或[VMWare Player](http://www.vmware.com/products/player/)之类的东西以在虚拟环境中运行 Linux。自从我开始使用 Linux 以来，虚拟化已经发展得足够远了，以至于您现在可以在全屏环境中安装和运行 Linux，几乎与本地运行 Linux 没有区别。使用虚拟化环境也将使诸如驱动程序之类的事情不再成为问题，因为应该开箱即用地支持通用“硬件”。虚拟化或 Linux 的“Live CD”版本（例如 Ubuntu live CD）是一种适应 Linux 的绝妙方法，而无需立即抛弃 Windows 的安全毯。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-11T21:47:05.287

这里的另一个建议非常好。作为在 2005 年底实现同样飞跃的人，我只想添加我自己的两便士。

1.  期待陡峭的学习曲线。当我切换时，我一直在使用 Unix / Linux 类型的服务器 13 年的大部分时间。不一样。我切换的时候是我开始学习的时候。起初我的工作效率有所下降，但我现在对我们的部署环境了解得更多——当然，工作效率也超过了原来的水平。但这并不容易。

2.  当您切换时，您再也不会以相同的方式查看操作系统。可以轻松地将任何操作系统视为一组您必须学习的东西。这本身就是一件好事（tm）

3.  一开始最大的问题是寻找 linux 等效的 windows 处事方式。我记得我在寻找像样的 FTP 客户端（最后，如果我现在被迫使用 FTP，我使用带有两个窗口的 konqueror - 但等到你发现 rsync！），一个像样的图形颠覆客户端（然后意识到知道如何使用find、sed、grep 和 svn cmd 命令行客户端要好得多）等。

4.  我以前听人说过，诉诸命令行就是承认失败。如果没有选择，这可能是正确的，但您很快就会陶醉于图形和命令行工具的混合来完成工作。例如，我倾向于使用 find 和 grep 和 xargs 来加载我的 IDE，其中包含我想要处理的内容。

5.  你又学会了爱上计算。整台计算机成为完成工作的工具。

6.  最大的变化是自由。不是成本。但是安装软件就像“sudo apt-get install”或图形等效一样简单。即使是一个非常非技术性的 Windows 用户也很快就会喜欢 Linux 的这个惊人的方面。

享受！

# c - 如何释放已用于 C 中变量的内存？

> ID：194428
> 
> 赞同：1
> 
> 时间：2008-10-11T18:43:21.587
> 
> 标签：c, memory-management

如何释放用于 C 中变量（例如长字符串）的内存？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-11T18:44:51.490

假设您动态分配内存（使用`malloc`或其他内存分配器），您可以使用`free`. 如果内存是静态分配的，则无法释放它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T18:53:50.037

这真的取决于你如何声明你的变量 - 如果它是一个常规变量，你不能“释放”它的内存 - 当它超出范围时它将被释放，如下所示：

```
for (int i=0;i<10;i++) {
 int k=i;
 //do stuff
} 
```

i 将在您退出循环时被释放，并且 k 将在每次通过循环体时被分配和释放。

当涉及运行时内存分配时，您可以使用值得信赖的 malloc 和 free :)

```
int* intArray;
malloc(200 * sizeof(int)); 
```

这将为您提供 200 个整数的数组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T18:57:52.540

假设您没有使用 malloc，并且正在使用创建字符串或缓冲区

```
char array[100]; 
```

但是你知道你只是将它用于长函数的一小部分，你可以将函数的那部分放在另一组 { }

```
int reallylongfunction() {
    // Do a lot of stuff
    {
        char stringbuffer[100];
        // Do stuff with the buffer...
        // Ok, we're done with the buffer, and don't want it anymore
    }
    // Do a lot more stuff
    return;
} 
```

这将导致缓冲区超出范围并被释放。不过要小心，你在额外的 { } 中声明的任何其他内容都会超出范围并消失！

编辑：该死的，评论是对的。超出范围的静态字符串没有任何好处。编辑所以它只是一个数组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T00:24:30.743

如果没有更多信息，这个问题真的无法回答。知道如何释放对象（甚至知道是否应该释放）的唯一方法是知道对象是如何分配的。

当我说对象时，我指的不仅仅是 C++ 的“对象”，而是 C 标准中使用的“对象”：

> 执行环境中的数据存储区域，其内容可以表示值

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-11T22:35:44.223

我建议您看一下[ustr](http://www.and.org/ustr/)，这是一个字符串 API，您可以将其与自动、常量和动态分配的字符串一起使用……您实际上可以“免费”使用其中两个，但所有这些都可以处理同样的方式并传递给 ustr_free()。

您可能仍然想了解堆栈、堆和数据（RO 文本字符串）是如何“分配”和“释放”的......但是在学习时使用可用的 API 将停止对您有很大帮助（并且会比你自己做的要快得多）。

# java - 如何在属性文件中正确存储和检索国际化字符串？

> ID：194430
> 
> 赞同：3
> 
> 时间：2008-10-11T18:43:43.147
> 
> 标签：java, encoding, properties, internationalization

我正在通过制作一个使用属性文件 + ResourceBundle 来获取不同字符串的 Hello World 程序来试验国际化。

具体来说，我有一个存储“hello.world=Hello World!”的文件“messages_en_US.properties”，当然可以正常工作。

然后我有一个文件“messages_ja_JP.properties”，我已经尝试了各种方法，但是当打印到控制台或 Swing 中时，它总是显示为某种类型的乱码。问题显然在于将内容读入 Java 字符串，因为直接输入源代码的日文 Java 字符串可以正常打印。

我尝试过的事情：

*   采用 UTF-8 编码的 .properties 文件，其值按原样使用日语字符串。我读到的东西表明Java希望属性文件处于系统的本机编码中......？无论如何，它都不起作用。
*   默认编码 (ISO-8859-1) 中的文件和存储为转义 Unicode 的值，由 Java 中包含的 native2ascii 程序创建。尝试使用各种日语编码的源文件... SHIFT-JIS、EUC-JP、ISO-2022-JP。

**编辑：**

实际上，我在键入此内容时就想到了这一点，但我想无论如何我都会将其发布并回答以防万一。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T18:44:01.460

我意识到 native2ascii 假设（惊讶）它每次都从我的操作系统的默认编码转换，因此没有产生正确的转义 Unicode 字符串。

*使用“ -encoding encoding_name* ”选项运行 native2ascii，其中*encoding_name*是源文件编码的名称（在本例中为 SHIFT-JIS）产生了正确的结果，并且一切正常。

Ant 还有一个 native2ascii 任务，它在一组输入文件上运行 native2ascii 并将输出文件发送到任何你想要的地方，所以我能够添加一个在 Eclipse 中执行此操作的构建器，以便我的源文件夹具有原始编码中的字符串，以便于编辑和构建会自动将转换后的同名文件放在输出文件夹中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T23:07:08.747

从 JDK 1.6 开始，Properties 有一个接受 Reader的[load()方法。](http://java.sun.com/javase/6/docs/api/java/util/Properties.html#load(java.io.Reader))这意味着您可以将所有属性文件保存为 UTF-8，并通过将 InputStreamReader 传递给 load() 直接读取它们。我认为这是最优雅的解决方案，但它要求您的应用程序在 Java 6 运行时上运行。

从历史上看，load() 只接受一个 InputStream，并且该流被解码为 ISO-8859-1。 *不是*系统默认编码，总是 ISO-8859-1。这很重要，因为它使某些黑客成为可能。假设您的属性文件存储为 UTF-8。检索属性后，您可以将其重新编码为 ISO-8859-1 并再次将其解码为 UTF-8，如下所示：

```
String realProp = new String(prop.getBytes("ISO-8859-1"), "UTF-8"); 
```

它丑陋而脆弱，但它确实有效。但我认为，至少在接下来的几年里，最好的解决方案是你找到的那个：使用像 Ant 这样的构建工具使用 native2ascii 批量转换文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T20:40:28.307

处理属性文件的另一种方法是： [http ://www.unipad.org/main/](http://www.unipad.org/main/)

这是一个可以读取/写入 \u unicode 转义格式文件的编辑器，这是 native2ascii 创建的格式。

它不知道它与日语的效果如何，我已经将它用于匈牙利语。

# c# - 如何在 Visual Studio 输出窗口中运行控制台应用程序，而不是打开新的命令提示符？

> ID：194436
> 
> 赞同：20
> 
> 时间：2008-10-11T18:47:18.690
> 
> 标签：c#, visual-studio, visual-studio-2008

我正在 Visual Studio 2008 中开发一个简单的控制台应用程序，并希望在 Visual Studio 2008 的输出窗口中运行它，而不是出现单独的命令提示符窗口。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-12T02:06:40.100

如果您在后期构建步骤中运行控制台应用程序，它的输出将转到输出窗口。无法轻松做到这一点是我对 VS（任何版本）的最大不满

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-09-04T16:59:59.343

ctrl+F5 seems to "start without debugging" in the debugging menu.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-11T19:02:48.130

它实际上必须是控制台应用程序吗？如果您将其设为 WinForms 应用程序（即使它不创建任何 GUI 元素），您将在“输出”窗口中获得控制台输出。但是，您将无法从控制台输入中读取数据，而且如果您从真正的命令行或资源管理器中运行，显然您根本不会得到任何输出。当然，对于简单的测试应用程序，这可能没问题！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-11T18:51:43.440

我知道的唯一方法是将其添加为外部工具，并在定义工具时勾选*使用输出窗口*复选框。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-18T16:02:39.643

这是一个相当老的问题，但由于还没有答案标记为解决方案，请尝试此处给出的答案：[在 Visual Studio 中输出控制台应用程序而不是控制台](https://stackoverflow.com/questions/2542599/having-the-output-of-a-console-app-in-visual-studio-instead-of-the-console)

# asp.net - 如何使用来自 asp.net 的 webrequest 将 xml 发送到 asp 页面？

> ID：194443
> 
> 赞同：3
> 
> 时间：2008-10-11T18:53:27.930
> 
> 标签：asp.net, xml, asp-classic

我想将 xml 文档从**asp.net页面发布到****asp**页面。如果我将 WebRequest 与 content/type text/xml 一起使用，则文档永远不会到达 asp 页面。我怎样才能做到这一点 ？

 *** * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-24T20:55:19.553

这是一个没有任何错误处理的示例（自己做:)）：

```
HttpWebRequest request = (HttpWebRequest)WebRequest.Create(targetUri);
string sendString = formParameterName + "=" + HttpUtility.UrlEncode(xmlData);
byte[] byteStream;
byteStream = System.Text.Encoding.UTF8.GetBytes(sendString);

request.Method = POST;
request.ContentType = "application/x-www-form-urlencoded";
request.ContentLength = byteStream.LongLength;

using(Stream writer = request.GetRequestStream())
{
    writer.Write(byteStream, 0, (int)request.ContentLength);
    writer.Flush();
}

HttpWebResponse resp = (HttpWebResponse)request.GetResponse();

//read the response 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T19:20:58.280

这是绝对可能的。确保将 XML 写入 RequestStream。

[http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getrequeststream.aspx](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getrequeststream.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T14:17:59.030

我确实使用 GetRequestStream。但是，如果您尝试`<data id='10'>value</data>`使用内容类型 text/xml 发送 xml，则文档永远不会到达其目的地

# palm-os - “后台”中的多段式 PalmOS 应用程序/库

> ID：194445
> 
> 赞同：2
> 
> 时间：2008-10-11T18:55:00.470
> 
> 标签：palm-os, garnet-os

我遇到的问题是：当使用 sysAppLaunchCmdNormalLaunch 以外的启动代码运行我的应用程序时，我不能使用默认代码段之外的代码 - 但我可以使用多段共享库，从而规避这个问题吗？

一些背景信息：我正在评估将现有移动应用程序移植到 PalmOS 的可能性。这个应用程序的一个核心部分是它每隔 10 分钟左右在后台进行一些网络通信，或者当它接收到传入数据时（通过网络/套接字回调）。在此期间，我无法访问全局变量，因此无法访问我的应用程序中除默认代码段之外的任何代码段。

现在的问题是，通信中涉及的操作（协议、数据处理等）需要大量代码，而这些代码不适合一个段。除了在“后台”运行这么多代码是否有意义的问题之外，显而易见的问题是：我将如何运行它？因此，问题是，将代码放入共享（多段）库是否会有所帮助。

期待您的见解。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T12:26:05.013

我没有使用共享库的经验，但是我们的软件遇到了这个问题，我们遇到了三种不同的方法来解决这个问题。

可能最简单的方法是在使用 Metrowerks 编译器时启用扩展模式，但我不完全确定这是否有效。这种特殊模式允许您在从非全局启动调用时访问某些常量全局数据。但是，使用这种方法有很多注意事项。此外，我还没有确认扩展模式肯定允许段间跳转。Ben Combee 写的白皮书详细解释了如何使用扩展模式。它的标题是“支持 Palm OS 上的扩展模式”。我在网上找不到它，所以我在我的网站上放了一份副本：[http ://www.normsoft.com/tim/technical/Codewarrior_Expanded_Mode.pdf](http://www.normsoft.com/tim/technical/Codewarrior_Expanded_Mode.pdf "CodeWarrior 扩展模式")

另一个更复杂的选择是自己加载全局变量并将指向它们的指针放在 A5 中。为此，您必须修改（或复制）加载全局变量的 Metrowerks 启动代码，然后在收到非全局启动时调用此修改后的代码。Metrowerks 包含运行时这部分的完整源代码，因此您可以很容易地做到这一点，尽管其中一些代码非常神秘。我们在 Pocket Tunes 的一个版本中成功地使用了这种技术，以在从非全局启动代码调用时访问全局变量和无限数量的段。只需确保从启动代码返回时恢复 A5。

最后的选择是将所有（或部分）代码移入 PNOlets。这可能会很痛苦，因为您必须将代码分割成 68K 和 PNO，这很快就会成为维护的噩梦。我们也成功地使用了这种方法，但是交互代码的维护很糟糕。我们最终使用 PEAL 加载程序将整个代码移动到 PNOlet，这对于大型代码非常有效，因为它会自动将代码分割成 64KB 的块并就地运行 ARM 代码。但是，这是一项非常大的工作，因为 PNOlet 开发在 ARM 上没有得到很好的支持，因此您必须自己提供很多低级支持（例如调用每个 API 函数的 thunk）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-26T21:34:23.543

使用 FtrSet 将指向您使用 MemPtr 分配的大型结构的指针存储在 Ftr 内存中。这可以在您的应用程序中需要使用 FtrGet 进行全局访问的任何地方检索。

交替使用`__STANDALONE_CODE_RESOURCE__`将每个函数放入单独的代码段，并使用带有包装器的共享函数.c 将它们加载并锁定到内存中以调用它们。

```
//segment 1000

UInt32 foobar( char* hi )
{
   return 12;
}

// functions.c
typedef (UInt32)(*fooPtr)( char* ); // this is now a type representing a pointer to your function.
UInt32 foobar( char* hi )
{
   LocalID id; UInt16 cn; SysCurAppDatabase(&cn,&id);
   DmOpenRef ref = DmOpenDatabase (cn, id, dmModeReadOnly );
   MemHandle H = DmGetResource('code',1000);
   fooPtr code = MemHandleLock(H);
   UInt32 result = (*fooPtr)( hi);

   return result;
} 
```

# javascript - Rails 应用程序中文本框的“建议”功能

> ID：194450
> 
> 赞同：9
> 
> 时间：2008-10-11T19:02:14.450
> 
> 标签：javascript, ruby-on-rails, ajax, autosuggest

我正在寻找一种最简单的方法来实现 Rails 应用程序中文本输入字段的“建议”功能。这个想法是完成存储在数据库列中的名称，在用户键入时为用户提供可能匹配的下拉菜单。

感谢您的任何建议！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T14:26:55.877

Rails 使用该方法使文本字段的“建议”式自动完成变得非常容易`text_field_with_auto_complete`。

在 Rails 1.x 中，这个方法是内置的[`ActionView::Helpers::JavaScriptMacrosHelper`](http://api.rubyonrails.com/classes/ActionView/Helpers/JavaScriptMacrosHelper.html)，但在 Rails 2.x 中，它被移到了[一个单独的插件](http://github.com/rails/auto_complete.git/)中。

假设您有一个名为的模型`Post`，它有一个名为 的文本字段`title`。在您看来，通常使用`text_field_tag`（或`f.text_field`）的地方，只需使用`text_field_with_auto_complete`：

```
<%= text_field_with_auto_complete :post, :title %> 
```

此外，在 中`PostsController`，您必须做出相应的声明：

```
class PostsController < ApplicationController
  auto_complete_for :post, :title
end 
```

这在幕后做的是动态添加一个调用`auto_complete_for_[object]_[method]`到控制器的动作。在上面的例子中，这个动作将被调用`auto_complete_for_post_title`。

值得指出的是，`find`此自动生成的操作使用的调用将作用于*所有*模型对象，例如`Post.find(:all, ...)`. 如果这不是您想要的行为（例如，如果想要`Post`根据登录用户将搜索限制为 s 的特定子集），那么您必须在控制器中定义自己的`auto_complete_for_[object]_[method]`操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-11T19:07:35.843

Ruby on Rails 具有可用的[原型框架](http://www.prototypejs.org)。这个框架由[Script.aculo.us](http://script.aculo.us/)使用，它提供了一个[自动完成器控件](http://demo.script.aculo.us/ajax/autocompleter)，可以提供您正在寻找的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T02:00:02.170

您也可以尝试这种稍微手动的方法

```
# your_view.rhtml

<%= text_field 'contact', 'name', :id => 'suggest' %>
<div id='dropdown' style='display:none; z-index: 100; background: #FFFFFF'></div>

<script>
  new Ajax.Autocompleter('suggest', 'dropdown', "<%= url_for :controller => 'contacts', :action => 'suggest_name' %>") 
</script>

# contacts_controller.rb

def suggest_name
  query_string = params[:contact][:name]
  @contacts = Contact.find.all :conditions => ['name ilike ?', "%#{query_string}%"]
  render :partial => 'name_suggestions'
end

# contacts/_name_suggestions.rhtml

<ul>
<% for contact in @contacts %>
  <li><%= contact.name %></li>
<% end %>
</ul> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T19:08:37.150

编辑：我将把这个答案留在这里作为一种理论参考点，但听起来[自动完成器的答案](https://stackoverflow.com/questions/194450/suggest-feature-for-textboxes-in-a-rails-app#194453)可能对你更有用:)

免责声明：虽然我为 Google 工作（在各种 UI 中显然都有“建议”元素），但我没有查看过该领域的任何代码，甚至没有与任何人谈论客户端方面的问题。

服务器端语言在这里可能无关紧要。重要的一点是客户端所需的 AJAX。

我建议你有一个大约 1 秒的计时器（尝试找到一个最佳位置），每次用户在文本框中输入击键时都会重置它，如果用户离开文本框则取消。如果计时器触发，则使其触发 AJAX 请求。AJAX 请求将包含用户迄今为止键入的内容。AJAX 响应应该是建议列表和原始请求文本。

如果，当 AJAX 响应返回时，文本框中的文本仍然与响应中的字段相同（即用户此后没有键入）并且如果文本框仍然具有焦点，则提供一个下拉菜单。（必须有数百个关于 HTML 组合框的示例页面才能做到这一点。）

服务器所需要做的就是通过执行搜索和适当地格式化响应来响应 AJAX 请求——这比客户端容易得多！

希望对您有所帮助 - 很抱歉没有任何示例代码，但我怀疑它相当复杂，而且我并不是真正的 JavaScript 开发人员。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-11T23:46:48.603

与 Rails 中的大多数事情一样，有几种方法可以做到这一点。Rails 曾经包含一组内置的自动完成帮助器，但现在该功能已被删除到 auto_complete 插件中。这可能是您获得想要实现的最简单的方法 - 控制器中的简单命令，视图中的一些简单内容 - ta-dah。要使用此解决方案，您只需将插件安装到您的应用程序中 - 请参阅[此页面](http://agilewebdevelopment.com/plugins/auto_complete)，该页面会告诉您安装和开始使用所需的所有知识。

正如另一个答案中所指出的，走这条路将利用与 Rails 捆绑在一起的原型和脚本 AJAX 框架。还有其他 AJAX 框架，尤其是 JQuery，也可以帮助您完成此功能，但您将有更多的学习来使用它们，而不仅仅是使用插件。

# parsing - 如何解析 .xfa 文件

> ID：194460
> 
> 赞同：1
> 
> 时间：2008-10-11T19:13:54.473
> 
> 标签：parsing, xfa

希望有人对如何解析 xfa 文件有一些信息。我可以很好地解析 csv 或 xml 文件，但是出现了一个 xfa 文件，我不熟悉这种格式。看起来像制表符分隔的正文，顶部有列元数据。

任何人之前都处理过这些问题，或者可以指导我如何解析它们？

我使用 vb.net，但任何解决方案的语言都不太相关。

非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-18T14:05:28.820

嗯，好像没有人知道。问题是 .xfa 看起来不像一个“标准”扩展名：毕竟，任何人都可以创建自己的扩展名，从 .xyz 到 .something...

我环顾四周，毫不意外地发现（“x”）是一种带有此扩展名的 XML 格式，仅此而已。

指出这种文件来自哪里，它包含什么样的数据，可能会有所帮助。或不。

您将文件描述为带有标题的简单 TSV（制表符分隔值）。使用标记器或一些正则表达式进行解析非常简单，所以我不确定你卡在哪里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T03:18:36.090

我想你可能在谈论这个：[http ://en.wikipedia.org/wiki/XFA_forms](http://en.wikipedia.org/wiki/XFA_forms)

这似乎是一个旨在处理该模板的页面：http: [//www.w3.org/1999/05/XFA/xfa-template-19990614](http://www.w3.org/1999/05/XFA/xfa-template-19990614)

这些信息应该足以让球滚动起来。如果失败了，那么您总是可以分析文件本身的模式并从那里开始。我不认为这太棘手。

无论如何，我希望这会有所帮助。

PS 如果您可以提供指向该 .xfa 的链接，我们可能会为您提供更多帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-06T17:10:09.583

原始帖子说内容看起来像“顶部有列元数据的制表符分隔的正文”。XFA 表单看起来不像 - XFA 表单通常使用 *.xdp 扩展名并且是 XML。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T14:43:16.617

查看 Adob​​e 页面：

[http://partners.adobe.com/public/developer/xml/index_arch.html](http://partners.adobe.com/public/developer/xml/index_arch.html)

（Adobe XML Forms Architecture，目前 1400 页）

让 LiveCycle/Acrobat 为您解析它。

# language-agnostic - 你有没有崩溃过编译器？

> ID：194464
> 
> 赞同：19
> 
> 时间：2008-10-11T19:19:01.827
> 
> 标签：language-agnostic, compiler-construction, crash

每个人（至少每个使用编译语言的人）都遇到过编译错误，但是您实际上使编译器崩溃了多少次？

我有相当一部分**“内部编译器错误”**，但大多数只是通过重新编译而消失了。您是否有一段（最少的）代码会使编译器崩溃？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-10-11T19:22:32.070

我编写了我们使用的编译器，所以它有时会崩溃。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-11T20:56:51.037

简单的。

```
// -*- C++ -*-

template <int n>
class Foo : public Foo<n+1>
{

};

int main(int, char*[])
{
    Foo<0> x;
    return 0;
};

ejgottl@luna:~/tmp$ g++ -ftemplate-depth-1000000 -Wall foo.cpp -o foo
g++: Internal error: Segmentation fault (program cc1plus)
Please submit a full bug report.
See `<URL:http://gcc.gnu.org/bugs.html>` for instructions.
For Debian GNU/Linux specific bug reporting instructions, see
`<URL:file:///usr/share/doc/gcc-4.2/README.Bugs>`. 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-12T01:26:48.947

我还没有让 GHC（一个 Haskell 编译器）崩溃，但是我已经让它出错了

> ```
> My brain just exploded.
> I can't handle pattern bindings for existentially-quantified constructors. 
> ```

它很容易解决，除非你有一些棘手的（通常是错误的）设计，否则你不会遇到这个问题，但它可能会成为有史以来最好的编译器错误消息。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-11T22:42:43.443

VC 现在可以优雅地捕捉到它，但在 90 年代中期，这会导致 Microsoft C++ 和 Borland C++ 编译器崩溃：

```
struct MyClass
{
    MyClass operator->() { return *this; }
};

int main(int argc, char* argv[])
{
    MyClass A;
    A->x;
} 
```

重载的 operator-> 本质上是递归的。该函数应返回一个指针，oper-> 再次应用于该指针。这个片段使代码生成无限递归。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-11T20:38:41.913

动作脚本 3.0：

```
switch(on_some_variable)
{
} 
```

空开关 = Kaboom！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-13T01:41:46.700

视觉 C++ 9.0 SP1

这*只是*发生在我身上

```
------ Build started: Project: pdfp, Configuration: Debug Win32 ------
Compiling...
reader.cpp
xref.cpp
c:\projects\pdfp\xref.cpp(52) : fatal error C1001: An internal error has occurred in the compiler.
(compiler file 'f:\dd\vctools\compiler\cxxfe\sl\p1\c\toil.c', line 8569)
 To work around this problem, try simplifying or changing the program near the locations listed above.
Please choose the Technical Support command on the Visual C++ 
 Help menu, or open the Technical Support help file for more information
Generating Code...
Build log was saved at "file://c:\Projects\pdfp\Debug\BuildLog.htm"
pdfp - 1 error(s), 0 warning(s)
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ========== 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-13T13:48:56.063

好吧，这实际上并没有使编译器崩溃——这只是一个错误，VC++ 不能接受完美的代码。（[此处提供详细信息](http://vcfaq.mvps.org/lang/2.htm)）。

奇怪的是，它只有在三个相当模糊的条件都满足时才会触发。移动一行代码是有效解决方法所需要的。所需的先决条件之一是“使用命名空间标准；” 这在生产代码中被广泛劝阻。

尽管如此，询问如何解决问题的消息仍然是 Microsoft VC++ 新闻组的主要内容。我不知道有多少人偶然发现了一个不起眼的错误。所以，最后，我问了一个人......

触发该错误所需的确切代码是 Stroustrup 的“ *C++ 编程语言*”中的一个示例。(*)

(*) 注意，我不是说他是故意的。我确信他在 C++ 的 UNIX 变体下对其进行了测试，并且完全不知道它对 VC++ 的影响。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-11T19:26:20.627

我在 C# 编译器中看到了一些编译器错误（所有边缘情况，均已正确报告），并确认了其他人引发的一些崩溃。

我遇到的最可怕的编译器（某种）错误是一个 Java 版本中的 JIT 错误。这是非常可重现的，但导致虚拟机停机。添加一个相当无操作的语句（我不记得究竟是什么副手 - 可能只是用初始值声明了一个额外的局部变量）将它从它碰巧的任何极端情况中移开 - 它在以后的版本中得到了修复。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-12T19:17:40.720

这使 C64 BASIC 崩溃：

```
PRINT 0 + "" +- 0 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-11T19:21:06.423

是的，尤其是当它是一个旧的或维护不足的编译器时（GCC 2.95，C++ 模式下的 Tendra）。不过，我不会保留这些代码。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-11T20:42:36.587

Visual C++ 5\. 'Nuff 说。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-04T03:29:20.473

糟糕，忘记了 typedef 中的“e”并导致编译器崩溃。

```
typdef struct kGUIColor GameColor;

c:\source\kgui\samples\space\space.cpp(35) : fatal error C1001: INTERNAL COMPILER ERROR
        (compiler file 'msc1.cpp', line 2708) 
         Please choose the Technical Support command on the Visual C++ 
         Help menu, or open the Technical Support help file for more information 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-04-09T20:03:23.180

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-09-22T20:05:41.890

Here's a way to crash the VS2003 C++ compiler.

```
typedef map<int,int> Tmap;
private: Tmap; * m_map; 
```

This will result in a crash and the following error message

> fatal error C1001: INTERNAL COMPILER ERROR (compiler file 'msc1.cpp', line 2708) Please choose the Technical Support command on the Visual C++ Help menu, or open the Technical Support help file for more information

Remove the semicolon immediately after `Tmap` (second line which defines `m_map`) to eliminate the error.

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-12T00:26:23.157

在我工作的一个项目中，[Boost Lambda](http://www.boost.org/doc/libs/1_36_0/doc/html/lambda.html)表达式的一些特定用法可能会导致 Visual C++ 编译器崩溃。（我们使用的是 Visual Studio 2003）
编译器只会在发布版本期间崩溃，调试版本可以正常工作。

关于 lambda 库的适当使用在团队中发生了一场激烈的宗教战争，我几乎很感激编译器为我们解决了这个问题。:-)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-12T03:48:13.577

在 Mono C# 编译器的 1.2.x 版本中，复杂的代码会导致相当多的崩溃（如果我没记错的话，嵌套的匿名委托）。幸运的是，在 2.x 版本中，我没有看到任何崩溃。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-12T18:26:18.437

在我之前的工作中，我们有一个模拟器，它因能够使 (ICE) 编译器崩溃或导致它们生成错误代码而臭名昭著。当代码实际生成正确时，编译器通常需要 15 分钟才能生成单个源文件。Visual Studio 从来没有（只要我在那里工作）能够编译模拟器核心。

核心是从 DSL 自动生成的，生成的代码经常将编译器推到极限。

升级到新版本的 GCC 经常引起广泛的紧张：新版本会工作吗？

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-22T10:31:06.050

感谢[@Nick](https://stackoverflow.com/questions/209793)，这会使 VS2005 崩溃。

```
 template<typename Res, typename T>
 Res operator_cast(const T& t)
 {
     return t.operator Res();
 }

 int main()
 {
    return operator_cast<int>(0);
 } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-04T05:04:59.047

我之前因为内存不足而使编译器崩溃。

给一个 DOS 编译器大约 0.5mb 的源代码。紧缩。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-27T19:03:02.513

当您收到“灾难性失败”消息时，您知道您正在尝试....

迈克尔

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-04-09T20:28:59.533

I use both pcc and gcc to compile my old OS project.

I found a bug with how both pcc and gcc handle a non-trivial piece of code and it crashed pcc. (chars are signed on my platform)

```
struct{
  char myvalue:1;
}mystruct; 
```

pcc crashed because all bitfield values must be int though, so it's really more buggy there, but gcc handles it wrongly. See, if you think about it, it is signed, but only has room for one bit. So therefore, it only can store 0 and -1\. Well, gcc handles it wrong by storing 0 or 1\.

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-11T19:25:18.600

如果模板使用混乱（例如，错过了结束的“>”），VC++ 在编译 C++ 时让我崩溃了。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-11T19:30:16.500

我做到了。一些 Delphi 版本（比如说 #4）经常崩溃，并带有神秘的错误消息。

较新的版本（2006 及更高版本）稳定但不坚如磐石。（在那种情况下，7 很棒）。

编译器崩溃经常发生在大型编辑和复杂项目（大量 dll）的调试会话中。大多数情况下，重新启动 ide 就足够了。但有时您需要重新启动 PC。

O 和我曾经因为交换文件变得太大而导致 OS2 和编译器一起崩溃。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-10-11T23:35:11.950

有一次，当我使用 Python 文档中的生成器示例时，它破坏了我们正在使用的 Python 版本。同一周，我的一位同事设法滥用了 FFI，以至于任何涉及数字 3 的计算都会使 python 崩溃。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-10-12T03:36:06.300

Microsoft Xbox 360 编译器很容易崩溃。我得到了带有日文注释的源代码，当转换为常规文本时，该行的最后一个字符是“\”，因此它将注释继续到下一行。如果下一行是一个 switch 命令，那么编译器就会崩溃。

```
//wierd japanese characters here %^$$\
switch(n)
{
case 0:
    .....
break;
case 1:
    .....
break;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-10-12T19:05:05.177

我曾多次让 Delphi 7 崩溃，要求它编译遗留的 dos 代码。

罪魁祸首似乎是某种东西在系统单元中的任何资格。这并不总是会炸毁它，但是当它炸毁这些东西时，我会查看并重写任何需要这种覆盖的东西，问题就会消失。

爆炸是 100% 可重现的，但我从未设法制作一个简单的测试用例。大多数情况下它实际上并没有使编译器崩溃，您通常会收到一个与问题无关的错误，并且可能有数百行。环境不稳定，保存退出就OK了但是别想干别的了。

回到使用 Borland Pascal 7（最后一个 dos 版本）的石器时代，我多次破坏它。没有崩溃，只是不正确和不一致的代码发射。我终于学会了将 .EXE（不包括调试信息）保持在 3mb 以下。我走得越远，它就越不稳定。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-10-12T19:14:32.973

我已经多次使 VC++ 崩溃，通常是使用模板代码。但这还不是最有趣的崩溃……

我使用 /analyze 选项编译了我的共享代码库，该编译器在没有开关的情况下编译时没有错误，并且在使用和不使用开关的 VS2008 上使 VS2005 Team System 编译器崩溃。当然 MS 不是很感兴趣，因为它是旧版本编译器中的一个错误，但我认为这很有趣。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-10-22T10:37:17.660

我设法对 Python 解释器进行了段错误。当然，当时我正在开发一个 C 扩展，但它并不完全正确。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-12-04T04:20:06.907

它不像以前那样发生了，但偶尔 ASP.net 预编译器会出现问题——我个人没有见过，但我已经在另一个项目上解决了一个问题，一旦它们发生名称冲突，因为它们不是在预编译期间正确使用命名空间（导致编译器崩溃）。

在过去的美好时光（非托管 MSVC++），我们有奇怪的编译器崩溃，通常是由于外部静态 win32 类 (.lib) 中的链接和一些奇怪的代码位偶尔会导致问题，但这些都很快得到了解决。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-12-04T06:55:01.510

我不知道我是否会称之为崩溃，但 sdcc（[小型设备 C 编译器](http://en.wikipedia.org/wiki/Small_Device_C_Compiler)）无法编译以特定方式形成的代码：

*   目标：[8051](http://en.wikipedia.org/wiki/Intel_8051)
*   代码必须在从外部测试器加载的 512 字节缓存中执行
*   测试人员处于控制之中并存储代码 - 缓存无法获取下一页
*   不允许函数调用——PC（程序计数器）会跳到一个不在缓存中的地方；预处理器宏用于完成模块化编码实践
*   如果它没有跳出缓存，则允许跳转（分支）
*   没有 const 值 - 在程序代码的数据部分中，这会导致缓存中的代码获取不在缓存中的内容 - 预处理器常量 (#define) OK here

预处理器宏展开，生成扁平但大的代码 - main() 中的所有内容；执行跳过启动代码（设置堆栈等）并从 main() 的开头开始

**这个答案的相关部分：**

有时，sdcc 会拒绝编译语法正确的代码，并显示有关内存不足的消息。这甚至发生在具有 8GB RAM 的 64 位机器上编译。

在这些情况下，解决方案是将固件拆分为单独的部分，分别编译并分别执行。这些碎片可能已经能够重新连接在一起，但在那一点上并不重要。

我没有尝试过，但[Keil](http://www.keil.com/) 8051 编译器可能已经处理了有问题的代码。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-12-04T06:57:05.373

我已经成功使 F# 编译器崩溃了很多次；但这不公平，因为它是一个 beta/alpha/research/etc 编译器。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-01-27T19:19:21.137

我从来没有*尝试过*让编译器崩溃，但是 VB 编译器/调试器每天都会在我身上出现好几次。即使它是VB，这也算吗？

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-03-12T01:06:24.893

我的团队经常在我们的构建机器上使用 csharp 编译器出现随机的内部编译器错误。我们通过清理每个目标构建之间的所有 bin/obj 文件夹解决了这个问题。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-05-07T09:36:46.447

我在为 Source 引擎编译地图时崩溃[了 VVIS 。](http://developer.valvesoftware.com/wiki/Vvis)

这算不算？

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2010-04-09T20:16:34.910

A long time ago, I worked on COBOL on a Control Data computer. (If that sounds funny, it is. Control Data was known for its high-performance scientific computing systems, and the COBOL compiler was a bit of an afterthought.) I don't remember the details, but I had a program I was trying to port to a newer version. I tried things several different ways, and found out I had a choice between crashing the compiler or putting it into an infinite loop.

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2010-04-09T20:33:35.513

Not the compiler, but the linker in Visual Studio 2008 crashes several times per day for me under Windows 7 64 bit. Immediately building again always works without a crash. Microsoft don't seem to care...

Not really an answer to your question because it's not the code itself causing it, but I'm always willing to rant about this particular issue :-)

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2010-04-09T22:09:42.010

Template support in GCC 2.95 (though I might be misremembering the version) was buggy. Various constructs would cause it to crash. I can't find the test case, but I think inner classes of templates (or inner classes that were templates) were one way of getting an compiler error.

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2010-04-18T12:41:42.600

I had something more interesting: Linker internal error...

Do you know how to cause THAT?

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2010-09-22T20:12:10.127

I once wrote a C program that would make the computer spontaneously reboot. One downside is that it didn't really have anything to do with mergesort which I was trying to implement at the time.

Fortunately it went away once I'd gotten my pointer errors figured out.

# c++ - 如何在 C++ 中将字符串解析为 int？

> ID：194465
> 
> 赞同：277
> 
> 时间：2008-10-11T19:20:37.407
> 
> 标签：c++, parsing

将字符串（以 char * 给出）解析为 int 的 C++ 方法是什么？强大而清晰的错误处理是一个加号（而不是[返回零](http://en.cppreference.com/w/cpp/string/byte/atoi)）。

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2011-05-27T15:42:20.637

## 什么不能做

这是我的第一条建议：**不要为此使用 stringstream**。虽然一开始使用起来可能看起来很简单，但您会发现如果您想要健壮性和良好的错误处理能力，您必须做很多额外的工作。

这是一种直观地看起来应该可行的方法：

```
bool str2int (int &i, char const *s)
{
    std::stringstream ss(s);
    ss >> i;
    if (ss.fail()) {
        // not an integer
        return false;
    }
    return true;
} 
```

这有一个很大的问题：`str2int(i, "1337h4x0r")`会愉快地返回`true`并且`i`会得到 value `1337`。我们可以通过确保转换后没有更多字符来解决这个问题`stringstream`：

```
bool str2int (int &i, char const *s)
{
    char              c;
    std::stringstream ss(s);
    ss >> i;
    if (ss.fail() || ss.get(c)) {
        // not an integer
        return false;
    }
    return true;
} 
```

我们解决了一个问题，但还有一些其他问题。

如果字符串中的数字不是以 10 为底怎么办？`ss << std::hex`我们可以通过在尝试转换之前将流设置为正确的模式（例如）来尝试适应其他基础。但这意味着调用者必须*先验地*知道数字的基数——调用者怎么可能知道呢？来电者还不知道号码是多少。他们甚至不知道这*是*一个号码！怎么能指望他们知道它的基础是什么？我们可以只要求输入到我们程序的所有数字必须以 10 为底，并拒绝十六进制或八进制输入为无效。但这不是很灵活或健壮。这个问题没有简单的解决方案。您不能简单地为每个基数尝试一次转换，因为对于八进制数（带有前导零），十进制转换总是会成功，而对于某些十进​​制数，八进制转换可能会成功。所以现在你必须检查前导零。可是等等！十六进制数字也可以以前导零开头（0x ...）。叹。

即使您成功处理了上述问题，还有另一个更大的问题：如果调用者需要区分错误输入（例如“123foo”）和超出范围的数字（例如“4000000000”）怎么办`int`？ 32位`int`）？有了`stringstream`，就没有办法做出这种区分。我们只知道转换是成功还是失败。如果它失败了，我们就无法知道*它*失败的原因。如您所见，`stringstream`如果您想要健壮性和清晰的错误处理，还有很多不足之处。

这引出了我的第二条建议：**不要`lexical_cast`为此**使用 Boost 。考虑`lexical_cast`文档必须说的内容：

> 在需要对转换进行更高程度的控制的情况下，std::stringstream 和 std::wstringstream 提供了更合适的路径。在需要非基于流的转换的情况下，lexical_cast 是不适合该工作的工具，并且对于这种情况不是特殊情况。

什么？？我们已经看到它`stringstream`的控制水平很差，但它说`stringstream`应该使用它而不是`lexical_cast`如果你需要“更高水平的控制”。此外，因为`lexical_cast`它只是 的包装器`stringstream`，所以它也存在同样的问题`stringstream`：对多基数的支持不佳和错误处理能力差。

## 最佳解决方案

幸运的是，已经有人解决了上述所有问题。C 标准库包含`strtol`没有这些问题的系列。

```
enum STR2INT_ERROR { SUCCESS, OVERFLOW, UNDERFLOW, INCONVERTIBLE };

STR2INT_ERROR str2int (int &i, char const *s, int base = 0)
{
    char *end;
    long  l;
    errno = 0;
    l = strtol(s, &end, base);
    if ((errno == ERANGE && l == LONG_MAX) || l > INT_MAX) {
        return OVERFLOW;
    }
    if ((errno == ERANGE && l == LONG_MIN) || l < INT_MIN) {
        return UNDERFLOW;
    }
    if (*s == '\0' || *end != '\0') {
        return INCONVERTIBLE;
    }
    i = l;
    return SUCCESS;
} 
```

对于处理所有错误情况并且还支持从 2 到 36 的任何数字基数的东西来说非常简单。如果`base`为零（默认值），它将尝试从任何基数转换。或者调用者可以提供第三个参数并指定只应针对特定的基尝试转换。它很健壮，可以以最少的工作量处理所有错误。

喜欢`strtol`（和家庭）的其他原因：

*   它表现出更好的[运行时性能](http://tinodidriksen.com/2010/02/16/cpp-convert-string-to-int-speed/)
*   它引入了更少的编译时开销（其他从头文件中提取了近 20 倍的 SLOC）
*   它导致最小的代码大小

绝对没有充分的理由使用任何其他方法。

* * *

## 回答 #2

> 赞同：177
> 
> 时间：2012-07-06T00:48:40.937

在新的 C++11 中有这样的函数：stoi、stol、stoll、stoul 等等。

```
int myNr = std::stoi(myString); 
```

它将在转换错误时引发异常。

即使这些新函数仍然存在 Dan 指出的**相同问题**：它们很乐意将字符串“11x”转换为整数“11”。

查看更多：[http ://en.cppreference.com/w/cpp/string/basic_string/stol](http://en.cppreference.com/w/cpp/string/basic_string/stol)

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-10-11T19:47:52.297

这是比 atoi() 更安全的 C 方式

```
const char* str = "123";
int i;

if(sscanf(str, "%d", &i)  == EOF )
{
   /* error */
} 
```

C++ 与标准库[字符串流](http://en.cppreference.com/w/cpp/io/basic_stringstream)：（感谢[CMS](https://stackoverflow.com/questions/194465/how-to-parse-a-string-to-an-int-in-c#194478)）

```
int str2int (const string &str) {
  stringstream ss(str);
  int num;
  if((ss >> num).fail())
  { 
      //ERROR 
  }
  return num;
} 
```

使用[boost](http://www.boost.org/doc/libs/1_36_0/libs/conversion/lexical_cast.htm#lexical_cast)库：（感谢[jk](https://stackoverflow.com/questions/194465/how-to-parse-a-string-to-an-int-in-c#194487)）

```
#include <boost/lexical_cast.hpp>
#include <string>

try
{
    std::string str = "123";
    int number = boost::lexical_cast< int >( str );
}
catch( const boost::bad_lexical_cast & )
{
    // Error
} 
```

编辑：修复了 stringstream 版本，以便它处理错误。（感谢 CMS 和 jk 对原帖的评论）

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-10-11T19:22:28.060

好的'旧C方式仍然有效。我推荐 strtol 或 strtoul。在返回状态和“endPtr”之间，您可以提供良好的诊断输出。它还可以很好地处理多个基地。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-10-11T19:31:58.680

您可以使用[Boost's`lexical_cast`](http://www.boost.org/doc/libs/1_36_0/libs/conversion/lexical_cast.htm#lexical_cast)，它将其[包装](https://stackoverflow.com/questions/194465/how-to-parse-a-string-to-an-int-in-c#194518)在更通用的界面中。 `lexical_cast<Target>(Source)`失败`bad_lexical_cast`。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-10-11T19:49:49.003

您可以使用 C++ 标准库中的字符串流：

```
stringstream ss(str);
int x;
ss >> x;

if(ss) { // <-- error handling
  // use x
} else {
  // not a number
} 
```

> 如果在尝试读取整数时遇到非数字，则流状态将设置为失败。

有关 C++ 中错误处理和流的缺陷，请参阅[流陷阱](http://www.horstmann.com/cpp/pitfalls.html)。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2018-02-21T23:30:29.287

从 C++17 开始，您可以使用[此处](http://en.cppreference.com/w/cpp/utility/from_chars)`std::from_chars`记录的`<charconv>`标头。

例如：

```
#include <iostream>
#include <charconv>
#include <array>

int main()
{
    char const * str = "42";
    int value = 0;

    std::from_chars_result result = std::from_chars(std::begin(str), std::end(str), value);

    if(result.error == std::errc::invalid_argument)
    {
      std::cout << "Error, invalid format";
    }
    else if(result.error == std::errc::result_out_of_range)
    {
      std::cout << "Error, value too big for int range";
    }
    else
    {
      std::cout << "Success: " << result;
    }
} 
```

作为奖励，它还可以处理其他基数，例如十六进制。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-10-11T19:26:06.507

您可以使用[字符串流的](http://www.cplusplus.com/reference/iostream/stringstream/)

```
int str2int (const string &str) {
  stringstream ss(str);
  int num;
  ss >> num;
  return num;
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2010-12-01T20:10:35.757

我认为这三个链接总结了它：

*   [http://tinodidriksen.com/2010/02/07/cpp-convert-int-to-string-speed/](http://tinodidriksen.com/2010/02/07/cpp-convert-int-to-string-speed/)
*   ***[http://tinodidriksen.com/2010/02/16/cpp-convert-string-to-int-speed/](http://tinodidriksen.com/2010/02/16/cpp-convert-string-to-int-speed/)***
*   ***[http://www.fastformat.org/performance.html](http://www.fastformat.org/performance.html)***

stringstream 和 lexical_cast 解决方案与使用 stringstream 的词法转换大致相同。

词法转换的一些专业化使用不同的方法，请参阅**[http://www.boost.org/doc/libs/release/boost/lexical_cast.hpp](http://www.boost.org/doc/libs/release/boost/lexical_cast.hpp)**了解详细信息。整数和浮点数现在专门用于整数到字符串的转换。

可以根据自己的需要专门化 lexical_cast 并使其快速。这将是满足所有各方的最终解决方案，干净而简单。

已经提到的文章显示了转换整数 <-> 字符串的不同方法之间的比较。以下方法是有意义的：旧的 c-way、spirit.karma、fastformat、简单的幼稚循环。

Lexical_cast 在某些情况下是可以的，例如用于 int 到 string 的转换。

使用词法转换将字符串转换为 int 不是一个好主意，因为它比 atoi 慢 10-40 倍，具体取决于所使用的平台/编译器。

Boost.Spirit.Karma 似乎是将整数转换为字符串的最快库。

```
ex.: generate(ptr_char, int_, integer_number); 
```

上面提到的文章中的基本简单循环是将字符串转换为int的最快方法，显然不是最安全的方法， strtol() 似乎是一种更安全的解决方案

```
int naive_char_2_int(const char *p) {
    int x = 0;
    bool neg = false;
    if (*p == '-') {
        neg = true;
        ++p;
    }
    while (*p >= '0' && *p <= '9') {
        x = (x*10) + (*p - '0');
        ++p;
    }
    if (neg) {
        x = -x;
    }
    return x;
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-08-29T05:59:53.273

C++ 字符串工具包库[(StrTk)](http://www.partow.net/programming/strtk/index.html)有以下解决方案：

```
static const std::size_t digit_table_symbol_count = 256;
static const unsigned char digit_table[digit_table_symbol_count] = {
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xFF - 0x07
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x08 - 0x0F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x10 - 0x17
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x18 - 0x1F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x20 - 0x27
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x28 - 0x2F
   0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, // 0x30 - 0x37
   0x08, 0x09, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x38 - 0x3F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x40 - 0x47
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x48 - 0x4F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x50 - 0x57
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x58 - 0x5F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x60 - 0x67
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x68 - 0x6F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x70 - 0x77
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x78 - 0x7F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x80 - 0x87
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x88 - 0x8F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x90 - 0x97
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0x98 - 0x9F
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xA0 - 0xA7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xA8 - 0xAF
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xB0 - 0xB7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xB8 - 0xBF
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xC0 - 0xC7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xC8 - 0xCF
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xD0 - 0xD7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xD8 - 0xDF
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xE0 - 0xE7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xE8 - 0xEF
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // 0xF0 - 0xF7
   0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF  // 0xF8 - 0xFF
 };

template<typename InputIterator, typename T>
inline bool string_to_signed_type_converter_impl_itr(InputIterator begin, InputIterator end, T& v)
{
   if (0 == std::distance(begin,end))
      return false;
   v = 0;
   InputIterator it = begin;
   bool negative = false;
   if ('+' == *it)
      ++it;
   else if ('-' == *it)
   {
      ++it;
      negative = true;
   }
   if (end == it)
      return false;
   while(end != it)
   {
      const T digit = static_cast<T>(digit_table[static_cast<unsigned int>(*it++)]);
      if (0xFF == digit)
         return false;
      v = (10 * v) + digit;
   }
   if (negative)
      v *= -1;
   return true;
} 
```

InputIterator 可以是 unsigned char*、char* 或 std::string 迭代器，并且 T 应为有符号 int，例如有符号 int、int 或 long

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2013-08-01T15:52:03.270

如果你有 C++11，现在合适的解决方案是 C++ 整数转换函数`<string>`：`stoi`, `stol`, `stoul`, `stoll`, `stoull`. 当输入不正确时，它们会抛出适当的异常，并在后台使用快速和小`strto*`功能。

如果您坚持使用 C++ 的早期版本，那么在您的实现中模仿这些功能将是可向前移植的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-08-09T21:20:27.270

我喜欢[Dan Moulding 的回答](https://stackoverflow.com/a/6154614)，我将为其添加一点 C++ 风格：

```
#include <cstdlib>
#include <cerrno>
#include <climits>
#include <stdexcept>

int to_int(const std::string &s, int base = 0)
{
    char *end;
    errno = 0;
    long result = std::strtol(s.c_str(), &end, base);
    if (errno == ERANGE || result > INT_MAX || result < INT_MIN)
        throw std::out_of_range("toint: string is out of range");
    if (s.length() == 0 || *end != '\0')
        throw std::invalid_argument("toint: invalid string");
    return result;
} 
```

它通过隐式转换对 std::string 和 const char* 都有效。它对于基本转换也很有用，例如 all `to_int("0x7b")`and `to_int("0173")`and `to_int("01111011", 2)`and `to_int("0000007B", 16)`and `to_int("11120", 3)`and`to_int("3L", 34);`将返回 123。

与`std::stoi`它在 C++11 之前的版本不同。也不像`std::stoi`,`boost::lexical_cast`它`stringstream`会抛出像“123hohoho”这样的奇怪字符串的异常。

注意：此函数允许前导空格但不允许尾随空格，即在抛出异常`to_int(" 123")`时返回 123 。`to_int("123 ")`确保这对于您的用例是可接受的或调整代码。

这样的功能可能是 STL 的一部分......

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-05-31T03:18:24.370

我知道将 String 转换为 int 的三种方法：

要么使用 stoi(String to int) 函数，要么只使用 Stringstream，第三种单独转换的方法，代码如下：

**第一种方法**

```
std::string s1 = "4533";
std::string s2 = "3.010101";
std::string s3 = "31337 with some string";

int myint1 = std::stoi(s1);
int myint2 = std::stoi(s2);
int myint3 = std::stoi(s3);

std::cout <<  s1 <<"=" << myint1 << '\n';
std::cout <<  s2 <<"=" << myint2 << '\n';
std::cout <<  s3 <<"=" << myint3 << '\n'; 
```

**第二种方法**

```
#include <string.h>
#include <sstream>
#include <iostream>
#include <cstring>
using namespace std;

int StringToInteger(string NumberAsString)
{
    int NumberAsInteger;
    stringstream ss;
    ss << NumberAsString;
    ss >> NumberAsInteger;
    return NumberAsInteger;
}
int main()
{
    string NumberAsString;
    cin >> NumberAsString;
    cout << StringToInteger(NumberAsString) << endl;
    return 0;
} 
```

**第三种方法 - 但不适用于个人转换**

```
std::string str4 = "453";
int i = 0, in=0; // 453 as on
for ( i = 0; i < str4.length(); i++)
{

    in = str4[i];
    cout <<in-48 ;

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-02-04T14:43:25.093

我喜欢[丹的回答](https://stackoverflow.com/a/6154614/892771)，尤其是因为避免了例外。对于嵌入式系统开发和其他低级系统开发，可能没有合适的异常框架可用。

在有效字符串之后添加了对空格的检查...这三行

```
 while (isspace(*end)) {
        end++;
    } 
```

也添加了对解析错误的检查。

```
 if ((errno != 0) || (s == end)) {
        return INCONVERTIBLE;
    } 
```

这是完整的功能..

```
#include <cstdlib>
#include <cerrno>
#include <climits>
#include <stdexcept>

enum STR2INT_ERROR { SUCCESS, OVERFLOW, UNDERFLOW, INCONVERTIBLE };

STR2INT_ERROR str2long (long &l, char const *s, int base = 0)
{
    char *end = (char *)s;
    errno = 0;

    l = strtol(s, &end, base);

    if ((errno == ERANGE) && (l == LONG_MAX)) {
        return OVERFLOW;
    }
    if ((errno == ERANGE) && (l == LONG_MIN)) {
        return UNDERFLOW;
    }
    if ((errno != 0) || (s == end)) {
        return INCONVERTIBLE;
    }    
    while (isspace((unsigned char)*end)) {
        end++;
    }

    if (*s == '\0' || *end != '\0') {
        return INCONVERTIBLE;
    }

    return SUCCESS;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-12-31T17:30:29.797

您可以使用此定义的方法。

```
#define toInt(x) {atoi(x.c_str())}; 
```

如果您要从字符串转换为整数，您只需执行以下操作。

```
int main()
{
string test = "46", test2 = "56";
int a = toInt(test);
int b = toInt(test2);
cout<<a+b<<endl;
} 
```

输出将是 102。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-03T00:27:52.417

我知道这是一个较老的问题，但我已经多次遇到它，并且迄今为止，仍然没有找到具有以下特征的良好模板化解决方案：

*   可以转换任何基础（并检测基础类型）
*   将检测错误数据（即确保整个字符串，较少的前导/尾随空格，被转换消耗）
*   将确保，无论转换为何种类型，字符串值的范围都是可接受的。

所以，这是我的，带有测试带。因为它在底层使用了 C 函数 strtoull/strtoll，所以它总是首先转换为可用的最大类型。然后，如果您没有使用最大的类型，它将执行额外的范围检查以验证您的类型没有溢出（下）。为此，与正确选择 strtol/strtoul 相比，它的性能要差一些。但是，它也适用于短裤/字符，据我所知，也没有标准库函数可以做到这一点。

享受; 希望有人觉得它有用。

```
#include <cstdlib>
#include <cerrno>
#include <limits>
#include <stdexcept>
#include <sstream>

static const int DefaultBase = 10;

template<typename T>
static inline T CstrtoxllWrapper(const char *str, int base = DefaultBase)
{
    while (isspace(*str)) str++; // remove leading spaces; verify there's data
    if (*str == '\0') { throw std::invalid_argument("str; no data"); } // nothing to convert

    // NOTE:  for some reason strtoull allows a negative sign, we don't; if
    //          converting to an unsigned then it must always be positive!
    if (!std::numeric_limits<T>::is_signed && *str == '-')
    { throw std::invalid_argument("str; negative"); }

    // reset errno and call fn (either strtoll or strtoull)
    errno = 0;
    char *ePtr;
    T tmp = std::numeric_limits<T>::is_signed ? strtoll(str, &ePtr, base)
                                              : strtoull(str, &ePtr, base);

    // check for any C errors -- note these are range errors on T, which may
    //   still be out of the range of the actual type we're using; the caller
    //   may need to perform additional range checks.
    if (errno != 0) 
    {
            if (errno == ERANGE) { throw std::range_error("str; out of range"); }
            else if (errno == EINVAL) { throw std::invalid_argument("str; EINVAL"); }
            else { throw std::invalid_argument("str; unknown errno"); }
    }

    // verify everything converted -- extraneous spaces are allowed
    if (ePtr != NULL)
    {
            while (isspace(*ePtr)) ePtr++;
            if (*ePtr != '\0') { throw std::invalid_argument("str; bad data"); }
    }

    return tmp;
}

template<typename T>
T StringToSigned(const char *str, int base = DefaultBase)
{
    static const long long max = std::numeric_limits<T>::max();
    static const long long min = std::numeric_limits<T>::min();

    long long tmp = CstrtoxllWrapper<typeof(tmp)>(str, base); // use largest type

    // final range check -- only needed if not long long type; a smart compiler
    //   should optimize this whole thing out
    if (sizeof(T) == sizeof(tmp)) { return tmp; }

    if (tmp < min || tmp > max)
    {
            std::ostringstream err;
            err << "str; value " << tmp << " out of " << sizeof(T) * 8
                << "-bit signed range (";
            if (sizeof(T) != 1) err << min << ".." << max;
            else err << (int) min << ".." << (int) max;  // don't print garbage chars
            err << ")";
            throw std::range_error(err.str());
    }

    return tmp;
}

template<typename T>
T StringToUnsigned(const char *str, int base = DefaultBase)
{
    static const unsigned long long max = std::numeric_limits<T>::max();

    unsigned long long tmp = CstrtoxllWrapper<typeof(tmp)>(str, base); // use largest type

    // final range check -- only needed if not long long type; a smart compiler
    //   should optimize this whole thing out
    if (sizeof(T) == sizeof(tmp)) { return tmp; }

    if (tmp > max)
    {
            std::ostringstream err;
            err << "str; value " << tmp << " out of " << sizeof(T) * 8
                << "-bit unsigned range (0..";
            if (sizeof(T) != 1) err << max;
            else err << (int) max;  // don't print garbage chars
            err << ")";
            throw std::range_error(err.str());
    }

    return tmp;
}

template<typename T>
inline T
StringToDecimal(const char *str, int base = DefaultBase)
{
    return std::numeric_limits<T>::is_signed ? StringToSigned<T>(str, base)
                                             : StringToUnsigned<T>(str, base);
}

template<typename T>
inline T
StringToDecimal(T &out_convertedVal, const char *str, int base = DefaultBase)
{
    return out_convertedVal = StringToDecimal<T>(str, base);
}

/*============================== [ Test Strap ] ==============================*/ 

#include <inttypes.h>
#include <iostream>

static bool _g_anyFailed = false;

template<typename T>
void TestIt(const char *tName,
            const char *s, int base,
            bool successExpected = false, T expectedValue = 0)
{
    #define FAIL(s) { _g_anyFailed = true; std::cout << s; }

    T x;
    std::cout << "converting<" << tName << ">b:" << base << " [" << s << "]";
    try
    {
            StringToDecimal<T>(x, s, base);
            // get here on success only
            if (!successExpected)
            {
                    FAIL(" -- TEST FAILED; SUCCESS NOT EXPECTED!" << std::endl);
            }
            else
            {
                    std::cout << " -> ";
                    if (sizeof(T) != 1) std::cout << x;
                    else std::cout << (int) x;  // don't print garbage chars
                    if (x != expectedValue)
                    {
                            FAIL("; FAILED (expected value:" << expectedValue << ")!");
                    }
                    std::cout << std::endl;
            }
    }
    catch (std::exception &e)
    {
            if (successExpected)
            {
                    FAIL(   " -- TEST FAILED; EXPECTED SUCCESS!"
                         << " (got:" << e.what() << ")" << std::endl);
            }
            else
            {
                    std::cout << "; expected exception encounterd: [" << e.what() << "]" << std::endl;
            }
    }
}

#define TEST(t, s, ...) \
    TestIt<t>(#t, s, __VA_ARGS__);

int main()
{
    std::cout << "============ variable base tests ============" << std::endl;
    TEST(int, "-0xF", 0, true, -0xF);
    TEST(int, "+0xF", 0, true, 0xF);
    TEST(int, "0xF", 0, true, 0xF);
    TEST(int, "-010", 0, true, -010);
    TEST(int, "+010", 0, true, 010);
    TEST(int, "010", 0, true, 010);
    TEST(int, "-10", 0, true, -10);
    TEST(int, "+10", 0, true, 10);
    TEST(int, "10", 0, true, 10);

    std::cout << "============ base-10 tests ============" << std::endl;
    TEST(int, "-010", 10, true, -10);
    TEST(int, "+010", 10, true, 10);
    TEST(int, "010", 10, true, 10);
    TEST(int, "-10", 10, true, -10);
    TEST(int, "+10", 10, true, 10);
    TEST(int, "10", 10, true, 10);
    TEST(int, "00010", 10, true, 10);

    std::cout << "============ base-8 tests ============" << std::endl;
    TEST(int, "777", 8, true, 0777);
    TEST(int, "-0111 ", 8, true, -0111);
    TEST(int, "+0010 ", 8, true, 010);

    std::cout << "============ base-16 tests ============" << std::endl;
    TEST(int, "DEAD", 16, true, 0xDEAD);
    TEST(int, "-BEEF", 16, true, -0xBEEF);
    TEST(int, "+C30", 16, true, 0xC30);

    std::cout << "============ base-2 tests ============" << std::endl;
    TEST(int, "-10011001", 2, true, -153);
    TEST(int, "10011001", 2, true, 153);

    std::cout << "============ irregular base tests ============" << std::endl;
    TEST(int, "Z", 36, true, 35);
    TEST(int, "ZZTOP", 36, true, 60457993);
    TEST(int, "G", 17, true, 16);
    TEST(int, "H", 17);

    std::cout << "============ space deliminated tests ============" << std::endl;
    TEST(int, "1337    ", 10, true, 1337);
    TEST(int, "   FEAD", 16, true, 0xFEAD);
    TEST(int, "   0711   ", 0, true, 0711);

    std::cout << "============ bad data tests ============" << std::endl;
    TEST(int, "FEAD", 10);
    TEST(int, "1234 asdfklj", 10);
    TEST(int, "-0xF", 10);
    TEST(int, "+0xF", 10);
    TEST(int, "0xF", 10);
    TEST(int, "-F", 10);
    TEST(int, "+F", 10);
    TEST(int, "12.4", 10);
    TEST(int, "ABG", 16);
    TEST(int, "10011002", 2);

    std::cout << "============ int8_t range tests ============" << std::endl;
    TEST(int8_t, "7F", 16, true, std::numeric_limits<int8_t>::max());
    TEST(int8_t, "80", 16);
    TEST(int8_t, "-80", 16, true, std::numeric_limits<int8_t>::min());
    TEST(int8_t, "-81", 16);
    TEST(int8_t, "FF", 16);
    TEST(int8_t, "100", 16);

    std::cout << "============ uint8_t range tests ============" << std::endl;
    TEST(uint8_t, "7F", 16, true, std::numeric_limits<int8_t>::max());
    TEST(uint8_t, "80", 16, true, std::numeric_limits<int8_t>::max()+1);
    TEST(uint8_t, "-80", 16);
    TEST(uint8_t, "-81", 16);
    TEST(uint8_t, "FF", 16, true, std::numeric_limits<uint8_t>::max());
    TEST(uint8_t, "100", 16);

    std::cout << "============ int16_t range tests ============" << std::endl;
    TEST(int16_t, "7FFF", 16, true, std::numeric_limits<int16_t>::max());
    TEST(int16_t, "8000", 16);
    TEST(int16_t, "-8000", 16, true, std::numeric_limits<int16_t>::min());
    TEST(int16_t, "-8001", 16);
    TEST(int16_t, "FFFF", 16);
    TEST(int16_t, "10000", 16);

    std::cout << "============ uint16_t range tests ============" << std::endl;
    TEST(uint16_t, "7FFF", 16, true, std::numeric_limits<int16_t>::max());
    TEST(uint16_t, "8000", 16, true, std::numeric_limits<int16_t>::max()+1);
    TEST(uint16_t, "-8000", 16);
    TEST(uint16_t, "-8001", 16);
    TEST(uint16_t, "FFFF", 16, true, std::numeric_limits<uint16_t>::max());
    TEST(uint16_t, "10000", 16);

    std::cout << "============ int32_t range tests ============" << std::endl;
    TEST(int32_t, "7FFFFFFF", 16, true, std::numeric_limits<int32_t>::max());
    TEST(int32_t, "80000000", 16);
    TEST(int32_t, "-80000000", 16, true, std::numeric_limits<int32_t>::min());
    TEST(int32_t, "-80000001", 16);
    TEST(int32_t, "FFFFFFFF", 16);
    TEST(int32_t, "100000000", 16);

    std::cout << "============ uint32_t range tests ============" << std::endl;
    TEST(uint32_t, "7FFFFFFF", 16, true, std::numeric_limits<int32_t>::max());
    TEST(uint32_t, "80000000", 16, true, std::numeric_limits<int32_t>::max()+1);
    TEST(uint32_t, "-80000000", 16);
    TEST(uint32_t, "-80000001", 16);
    TEST(uint32_t, "FFFFFFFF", 16, true, std::numeric_limits<uint32_t>::max());
    TEST(uint32_t, "100000000", 16);

    std::cout << "============ int64_t range tests ============" << std::endl;
    TEST(int64_t, "7FFFFFFFFFFFFFFF", 16, true, std::numeric_limits<int64_t>::max());
    TEST(int64_t, "8000000000000000", 16);
    TEST(int64_t, "-8000000000000000", 16, true, std::numeric_limits<int64_t>::min());
    TEST(int64_t, "-8000000000000001", 16);
    TEST(int64_t, "FFFFFFFFFFFFFFFF", 16);
    TEST(int64_t, "10000000000000000", 16);

    std::cout << "============ uint64_t range tests ============" << std::endl;
    TEST(uint64_t, "7FFFFFFFFFFFFFFF", 16, true, std::numeric_limits<int64_t>::max());
    TEST(uint64_t, "8000000000000000", 16, true, std::numeric_limits<int64_t>::max()+1);
    TEST(uint64_t, "-8000000000000000", 16);
    TEST(uint64_t, "-8000000000000001", 16);
    TEST(uint64_t, "FFFFFFFFFFFFFFFF", 16, true, std::numeric_limits<uint64_t>::max());
    TEST(uint64_t, "10000000000000000", 16);

    std::cout << std::endl << std::endl
              << (_g_anyFailed ? "!! SOME TESTS FAILED !!" : "ALL TESTS PASSED")
              << std::endl;

    return _g_anyFailed;
} 
```

`StringToDecimal`是用户土地方法；它是重载的，所以它可以这样调用：

```
int a; a = StringToDecimal<int>("100"); 
```

或这个：

```
int a; StringToDecimal(a, "100"); 
```

我讨厌重复 int 类型，所以更喜欢后者。这确保了如果 'a' 的类型发生变化，一个不会得到不好的结果。我希望编译器可以像这样弄清楚：

```
int a; a = StringToDecimal("100"); 
```

...但是，C++ 不会推断模板返回类型，所以这是我能得到的最好的。

实现非常简单：

`CstrtoxllWrapper`包装`strtoull`and `strtoll`，根据模板类型的有符号性调用任何必要的，并提供一些额外的保证（例如，如果无符号则不允许负输入，并确保整个字符串被转换）。

`CstrtoxllWrapper`由编译器使用`StringToSigned`并`StringToUnsigned`与编译器可用的最大类型（long long/unsigned long long）一起使用；这允许执行最大转换。然后，如果有必要，`StringToSigned`/`StringToUnsigned`对基础类型执行最终范围检查。最后，端点方法 ，`StringToDecimal`根据底层类型的签名决定调用哪个 StringTo* 模板方法。

我认为大部分垃圾都可以被编译器优化掉；几乎所有东西都应该是编译时确定的。关于这方面的任何评论对我来说都会很有趣！

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2013-08-01T16:01:15.057

在 C 中，您可以使用`int atoi (const char * str)`,

解析 C 字符串 str，将其内容解释为整数，该整数作为 int 类型的值返回。

# c# - 如何获取已登录的本地 Windows 用户的列表？

> ID：194468
> 
> 赞同：3
> 
> 时间：2008-10-11T19:21:05.707
> 
> 标签：c#, .net, windows

我正在尝试为 Windows 编写一个更快的用户切换应用程序。Win+L 和选择用户非常麻烦。如果我以管理员身份启动任务管理器，它会显示活动用户，我可以选择一个并“连接”（如果我输入他们的密码）。

如何获取所有用户（或所有活跃用户）的列表？

我正在使用 C# (Visual Studio Express)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T03:15:04.503

如果你不想处理 P/Invokes，你可以使用[Cassia](http://cassia.googlecode.com)，它为你包装了丑陋的东西：

```
using Cassia;

foreach (ITerminalServicesSession session in new TerminalServicesManager().GetSessions())
{
    if (!string.IsNullOrEmpty(session.UserName))
    {
        Console.WriteLine("Session {0} (User {1})", session.SessionId, session.UserName);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T19:29:47.967

我会尝试[WTSEnumerateSessions](http://msdn.microsoft.com/en-us/library/aa383833(VS.85).aspx)来获取所有可用的会话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T19:58:13.807

您还可以使用[NetWkstaUserEnum](http://msdn.microsoft.com/en-us/library/aa370669(VS.85).aspx)查看当前登录的所有用户；它不一定更好，但它是另一种选择。它的一个优点是它可以在不支持终端服务的旧系统上运行，但如果您使用 C#，这可能不是问题。:)

# c# - 您在 C# 或 .NET 中见过的最奇怪的极端案例是什么？

> ID：194484
> 
> 赞同：322
> 
> 时间：2008-10-11T19:30:45.407
> 
> 标签：c#, .net

我收集了一些极端案例和[脑筋急转弯](http://www.yoda.arachsys.com/csharp/teasers.html)，并且总是想听更多。该页面仅真正涵盖了 C# 语言的零碎知识，但我也发现核心 .NET 的东西也很有趣。例如，这是一个不在页面上，但我觉得不可思议的：

```
string x = new string(new char[0]);
string y = new string(new char[0]);
Console.WriteLine(object.ReferenceEquals(x, y)); 
```

我希望打印 False - 毕竟，“new”（具有引用类型）*总是*创建一个新对象，不是吗？C# 和 CLI 的规范都表明它应该这样做。好吧，不是在这种特殊情况下。它打印 True，并且在我测试过的每个版本的框架上都完成了。（诚​​然，我还没有在 Mono 上尝试过......）

为了清楚起见，这只是我正在寻找的那种东西的一个例子——我并不是特别在寻找这种奇怪的讨论/解释。（它与普通的字符串实习不同；特别是，字符串实习通常不会在调用构造函数时发生。）我真的要求类似的奇怪行为。

还有其他的宝石潜伏在那里吗？

* * *

## 回答 #1

> 赞同：394
> 
> 时间：2008-10-11T21:25:23.693

我想我之前给你看过这个，但我喜欢这里的乐趣——这需要一些调试才能追踪！（原始代码显然更加复杂和微妙......）

```
 static void Foo<T>() where T : new()
    {
        T t = new T();
        Console.WriteLine(t.ToString()); // works fine
        Console.WriteLine(t.GetHashCode()); // works fine
        Console.WriteLine(t.Equals(t)); // works fine

        // so it looks like an object and smells like an object...

        // but this throws a NullReferenceException...
        Console.WriteLine(t.GetType());
    } 
```

那么T是什么...

答案：任何`Nullable<T>`- 例如`int?`。所有方法都被覆盖，除了 GetType() 不能；所以它被强制转换（装箱）为对象（因此为 null）以调用 object.GetType()... 它调用 null ;-p

* * *

更新：情节变厚了...... Ayende Rahien[在他的博客上提出了类似的挑战](http://ayende.com/Blog/archive/2009/11/25/can-you-hack-this-out-hint-1.aspx)，但有一个`where T : class, new()`：

```
private static void Main() {
    CanThisHappen<MyFunnyType>();
}

public static void CanThisHappen<T>() where T : class, new() {
    var instance = new T(); // new() on a ref-type; should be non-null, then
    Debug.Assert(instance != null, "How did we break the CLR?");
} 
```

但它可以被打败！使用与远程处理等相同的间接方式；警告 - 以下是**纯粹的邪恶**：

```
class MyFunnyProxyAttribute : ProxyAttribute {
    public override MarshalByRefObject CreateInstance(Type serverType) {
        return null;
    }
}
[MyFunnyProxy]
class MyFunnyType : ContextBoundObject { } 
```

有了这个，`new()`调用被重定向到代理（`MyFunnyProxyAttribute`），它返回`null`。现在去洗眼睛吧！

* * *

## 回答 #2

> 赞同：216
> 
> 时间：2008-10-12T06:03:03.913

银行家的四舍五入。

这不是一个编译器错误或故障，而是一个奇怪的极端情况......

.Net 框架采用称为银行家舍入的方案或舍入。

在银行家的四舍五入中，0.5 数字被四舍五入到最接近的偶数，所以

```
Math.Round(-0.5) == 0
Math.Round(0.5) == 0
Math.Round(1.5) == 2
Math.Round(2.5) == 2
etc... 
```

这可能会导致基于更广为人知的 Round-Half-Up 舍入的财务计算中出现一些意外错误。

这也适用于 Visual Basic。

* * *

## 回答 #3

> 赞同：176
> 
> 时间：2008-10-12T18:29:56.060

如果调用为`Rec(0)`（不在调试器下）此函数会做什么？

```
static void Rec(int i)
{
    Console.WriteLine(i);
    if (i < int.MaxValue)
    {
        Rec(i + 1);
    }
} 
```

回答：

*   在 32 位 JIT 上，它应该导致 StackOverflowException
*   在 64 位 JIT 上，它应该将所有数字打印到 int.MaxValue

这是因为[64 位 JIT 编译器应用了尾调用优化](http://blogs.msdn.com/davbr/pages/tail-call-jit-conditions.aspx)，而 32 位 JIT 没有。

不幸的是，我没有 64 位机器来验证这一点，但该方法确实满足尾调用优化的所有条件。如果有人有的话，我很想看看它是否属实。

* * *

## 回答 #4

> 赞同：111
> 
> 时间：2009-11-25T21:42:14.833

## 分配这个！

* * *

这是我喜欢在聚会上问的问题（这可能是我不再被邀请的原因）：

您可以编译以下代码吗？

```
 public void Foo()
    {
        this = new Teaser();
    } 
```

一个简单的作弊可能是：

```
string cheat = @"
    public void Foo()
    {
        this = new Teaser();
    }
"; 
```

但真正的解决方案是：

```
public struct Teaser
{
    public void Foo()
    {
        this = new Teaser();
    }
} 
```

`this`因此，值类型（结构）可以重新分配其变量是一个鲜为人知的事实。

* * *

## 回答 #5

> 赞同：100
> 
> 时间：2009-05-08T15:20:36.073

几年前，在制定忠诚度计划时，我们遇到了给予客户积分数量的问题。该问题与将 double 转换为 int 有关。

在下面的代码中：

```
double d = 13.6;

int i1 = Convert.ToInt32(d);
int i2 = (int)d; 
```

**i1 == i2**吗？

事实证明，i1 != i2。由于 Convert 和 cast 运算符中的舍入策略不同，实际值为：

```
i1 == 14
i2 == 13 
```

最好调用 Math.Ceiling() 或 Math.Floor() （或符合我们要求的带有 MidpointRounding 的 Math.Round）

```
int i1 = Convert.ToInt32( Math.Ceiling(d) );
int i2 = (int) Math.Ceiling(d); 
```

* * *

## 回答 #6

> 赞同：74
> 
> 时间：2009-05-11T09:26:03.007

即使存在枚举函数重载，他们也应该将 0 设为整数。

我知道 C# 核心团队将 0 映射到枚举的基本原理，但它仍然没有应有的正交性。[来自Npgsql](http://plus.kaist.ac.kr/~shoh/postgresql/Npgsql/apidocs/Npgsql.NpgsqlParameterCollection.Add_overload_3.html)的示例。

测试示例：

```
namespace Craft
{
    enum Symbol { Alpha = 1, Beta = 2, Gamma = 3, Delta = 4 };

   class Mate
    {
        static void Main(string[] args)
        {

            JustTest(Symbol.Alpha); // enum
            JustTest(0); // why enum
            JustTest((int)0); // why still enum

            int i = 0;

            JustTest(Convert.ToInt32(0)); // have to use Convert.ToInt32 to convince the compiler to make the call site use the object version

            JustTest(i); // it's ok from down here and below
            JustTest(1);
            JustTest("string");
            JustTest(Guid.NewGuid());
            JustTest(new DataTable());

            Console.ReadLine();
        }

        static void JustTest(Symbol a)
        {
            Console.WriteLine("Enum");
        }

        static void JustTest(object o)
        {
            Console.WriteLine("Object");
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：67
> 
> 时间：2009-08-26T04:36:08.457

这是迄今为止我见过的最不寻常的之一（当然除了这里的那些！）：

```
public class Turtle<T> where T : Turtle<T>
{
} 
```

它允许你声明它，但没有真正的用处，因为它总是要求你用另一个 Turtle 包装你在中心填充的任何类。

[笑话] 我猜是乌龟一路下来... [/笑话]

* * *

## 回答 #8

> 赞同：65
> 
> 时间：2009-08-15T09:28:20.300

这是我最近才发现的一个...

```
interface IFoo
{
   string Message {get;}
}
...
IFoo obj = new IFoo("abc");
Console.WriteLine(obj.Message); 
```

上面的内容乍一看很疯狂，但**实际上是合法**的。不，真的（虽然我错过了一个关键部分，但它**并不是**像“添加一个名为的类`IFoo`”或“添加一个`using`别名以指向`IFoo`一个班级”）。

看看你能不能找出原因，然后：[谁说你不能实例化一个接口？](http://marcgravell.blogspot.com/2009/08/who-says-you-cant-instantiate-interface.html)

* * *

## 回答 #9

> 赞同：56
> 
> 时间：2008-10-12T18:16:30.530

**什么时候布尔值既不是真也不是假？**

比尔发现你可以破解一个布尔值，这样如果 A 为真且 B 为真，则 (A 和 B) 为假。

[被黑的布尔值](http://blogs.msmvps.com/bill/2004/06/22/a-hacked-boolean/)

* * *

## 回答 #10

> 赞同：47
> 
> 时间：2008-11-22T22:00:02.340

我参加聚会有点晚了，但我得到~~了~~~~三四五~~ ：

 ~~1.  如果您在尚未加载/显示的控件上轮询 InvokeRequired，它会说 false - 如果您尝试从另一个线程更改它，它会在您的脸上炸毁（[解决方案](https://stackoverflow.com/questions/246058/system-invalidoperationexception-the-object-is-currently-in-use-elsewhere-ho)是引用 this.Handle 在创建者控制）。

2.  另一个让我感到困惑的是，如果有一个装配：

    ```
    enum MyEnum
    {
        Red,
        Blue,
    } 
    ```

    如果您在另一个程序集中计算 MyEnum.Red.ToString() ，并且在此期间有人将您的枚举重新编译为：

    ```
    enum MyEnum
    {
        Black,
        Red,
        Blue,
    } 
    ```

    在运行时，你会得到“黑色”。

3.  我有一个共享程序集，里面有一些方便的常量。我的前任留下了一堆难看的 get-only 属性，我想我会摆脱混乱，只使用 public const。当 VS 将它们编译为它们的值而不是引用时，我感到非常惊讶。

4.  如果您从另一个程序集实现接口的新方法，但您重新构建引用该程序集的旧版本，您会得到一个 TypeLoadException（没有实现“NewMethod”），即使您*已经*实现了它（参见[此处](https://stackoverflow.com/questions/948785/typeloadexception-says-no-implementation-but-it-is-implemented)）。

5.  Dictionary<,>：“项目返回的顺序未定义”。这*太可怕*了，因为它有时会咬你，但对其他人有用，如果你只是盲目地认为 Dictionary 会很好玩（“为什么不应该呢？我想，List 会”），你真的必须在您最终开始质疑您的假设之​​前，请先了解一下。

* * *

## 回答 #11

> 赞同：33
> 
> 时间：2009-11-04T09:29:06.137

VB.NET，可为空值和三元运算符：

```
Dim i As Integer? = If(True, Nothing, 5) 
```

这花了我一些时间来调试，因为我希望`i`包含`Nothing`.

我真正包含什么？`0`.

这是令人惊讶但实际上是“正确”的行为：在 VB.NET 中与在 CLR`Nothing`中不完全相同：可以表示或表示值类型，具体取决于上下文。在上述情况下，推断为 and 的常见类型，因此，在这种情况下，表示。`null``Nothing``null``default(T)``T``If``Integer``Nothing``5``Nothing``0`

* * *

## 回答 #12

> 赞同：28
> 
> 时间：2009-09-26T16:38:08.897

我发现了第二个非常奇怪的角落案例，它远远超过了我的第一个案例。

String.Equals Method (String, String, StringComparison) 实际上并不是没有副作用的。

我正在编写一个代码块，该代码块在某个函数的顶部单独一行：

```
stringvariable1.Equals(stringvariable2, StringComparison.InvariantCultureIgnoreCase); 
```

删除该行会导致程序中其他地方的堆栈溢出。

代码原来是为本质上是一个 BeforeAssemblyLoad 事件安装一个处理程序并试图做

```
if (assemblyfilename.EndsWith("someparticular.dll", StringComparison.InvariantCultureIgnoreCase))
{
    assemblyfilename = "someparticular_modified.dll";
} 
```

现在我不应该告诉你。在字符串比较中使用以前未使用过的区域性会导致程序集加载。InvariantCulture 也不例外。

* * *

## 回答 #13

> 赞同：20
> 
> 时间：2009-02-10T03:40:00.537

下面是一个示例，说明如何创建导致错误消息“尝试读取或写入受保护的内存。这通常表明其他内存已损坏”的结构。成功与失败的区别是非常微妙的。

以下单元测试演示了该问题。

看看你能不能找出问题所在。

```
 [Test]
    public void Test()
    {
        var bar = new MyClass
        {
            Foo = 500
        };
        bar.Foo += 500;

        Assert.That(bar.Foo.Value.Amount, Is.EqualTo(1000));
    }

    private class MyClass
    {
        public MyStruct? Foo { get; set; }
    }

    private struct MyStruct
    {
        public decimal Amount { get; private set; }

        public MyStruct(decimal amount) : this()
        {
            Amount = amount;
        }

        public static MyStruct operator +(MyStruct x, MyStruct y)
        {
            return new MyStruct(x.Amount + y.Amount);
        }

        public static MyStruct operator +(MyStruct x, decimal y)
        {
            return new MyStruct(x.Amount + y);
        }

        public static implicit operator MyStruct(int value)
        {
            return new MyStruct(value);
        }

        public static implicit operator MyStruct(decimal value)
        {
            return new MyStruct(value);
        }
    } 
```

* * *

## 回答 #14

> 赞同：18
> 
> 时间：2008-10-28T07:48:11.580

C#支持数组和列表之间的转换，只要数组不是多维的，并且类型之间存在继承关系，并且类型是引用类型

```
object[] oArray = new string[] { "one", "two", "three" };
string[] sArray = (string[])oArray;

// Also works for IList (and IEnumerable, ICollection)
IList<string> sList = (IList<string>)oArray;
IList<object> oList = new string[] { "one", "two", "three" }; 
```

请注意，这不起作用：

```
object[] oArray2 = new int[] { 1, 2, 3 }; // Error: Cannot implicitly convert type 'int[]' to 'object[]'
int[] iArray = (int[])oArray2;            // Error: Cannot convert type 'object[]' to 'int[]' 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2010-03-01T07:11:44.110

这是我偶然遇到的最奇怪的：

```
public class DummyObject
{
    public override string ToString()
    {
        return null;
    }
} 
```

使用如下：

```
DummyObject obj = new DummyObject();
Console.WriteLine("The text: " + obj.GetType() + " is " + obj); 
```

会抛出一个`NullReferenceException`. 事实证明，多个添加是由 C# 编译器编译为对`String.Concat(object[])`. 在 .NET 4 之前，Concat 的重载中存在一个错误，其中检查对象是否为空，但不是 ToString() 的结果：

```
object obj2 = args[i];
string text = (obj2 != null) ? obj2.ToString() : string.Empty;
// if obj2 is non-null, but obj2.ToString() returns null, then text==null
int length = text.Length; 
```

这是 ECMA-334 §14.7.4 的一个错误：

> 当一个或两个操作数为 类型时，二元 + 运算符执行字符串连接`string`。如果字符串连接的操作数是`null`，则替换为空字符串。否则，任何非字符串操作数都会通过调用`ToString`从 type 继承的虚拟方法转换为其字符串表示形式`object`。**如果`ToString`返回`null`，则替换为空字符串。**

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2008-10-12T16:10:02.627

有趣 - 当我第一次看到它时，我认为这是 C# 编译器正在检查的东西，但即使你直接发出 IL 以消除任何干扰的机会，它仍然会发生，这意味着它确实是正在执行的`newobj`操作码检查。

```
var method = new DynamicMethod("Test", null, null);
var il = method.GetILGenerator();

il.Emit(OpCodes.Ldc_I4_0);
il.Emit(OpCodes.Newarr, typeof(char));
il.Emit(OpCodes.Newobj, typeof(string).GetConstructor(new[] { typeof(char[]) }));

il.Emit(OpCodes.Ldc_I4_0);
il.Emit(OpCodes.Newarr, typeof(char));
il.Emit(OpCodes.Newobj, typeof(string).GetConstructor(new[] { typeof(char[]) }));

il.Emit(OpCodes.Call, typeof(object).GetMethod("ReferenceEquals"));
il.Emit(OpCodes.Box, typeof(bool));
il.Emit(OpCodes.Call, typeof(Console).GetMethod("WriteLine", new[] { typeof(object) }));

il.Emit(OpCodes.Ret);

method.Invoke(null, null); 
```

它还等同于`true`如果您检查是否`string.Empty`意味着此操作码必须具有特殊行为来实习空字符串。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2008-10-11T21:34:20.803

```
Public Class Item
   Public ID As Guid
   Public Text As String

   Public Sub New(ByVal id As Guid, ByVal name As String)
      Me.ID = id
      Me.Text = name
   End Sub
End Class

Public Sub Load(sender As Object, e As EventArgs) Handles Me.Load
   Dim box As New ComboBox
   Me.Controls.Add(box)          'Sorry I forgot this line the first time.'
   Dim h As IntPtr = box.Handle  'Im not sure you need this but you might.'
   Try
      box.Items.Add(New Item(Guid.Empty, Nothing))
   Catch ex As Exception
      MsgBox(ex.ToString())
   End Try
End Sub 
```

输出为“尝试读取受保护的内存。这表明其他内存已损坏。”

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2009-11-25T18:50:08.743

PropertyInfo.SetValue() 可以将整数分配给枚举，将整数分配给可空整数，将枚举分配给可空枚举，但不能将整数分配给可空枚举。

```
enumProperty.SetValue(obj, 1, null); //works
nullableIntProperty.SetValue(obj, 1, null); //works
nullableEnumProperty.SetValue(obj, MyEnum.Foo, null); //works
nullableEnumProperty.SetValue(obj, 1, null); // throws an exception !!! 
```

完整的描述[在这里](http://andersivner.blogspot.com/2008/05/nullable-enums.html)

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2010-05-26T17:34:14.650

如果你有一个泛型类，它的方法可能会根据类型参数变得不明确怎么办？我最近在写一本双向词典时遇到了这种情况。我想编写对称`Get()`方法，该方法将返回与传递的任何参数相反的结果。像这样的东西：

```
class TwoWayRelationship<T1, T2>
{
    public T2 Get(T1 key) { /* ... */ }
    public T1 Get(T2 key) { /* ... */ }
} 
```

如果您创建一个不同类型的实例`T1`，一切都很好：`T2`

```
var r1 = new TwoWayRelationship<int, string>();
r1.Get(1);
r1.Get("a"); 
```

但是如果`T1`和`T2`是相同的（并且可能如果一个是另一个的子类），这是一个编译器错误：

```
var r2 = new TwoWayRelationship<int, int>();
r2.Get(1);  // "The call is ambiguous..." 
```

有趣的是，第二种情况下的所有其他方法仍然可用；它只是调用导致编译器错误的现在模棱两可的方法。有趣的案例，如果有点不太可能和晦涩难懂。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2010-08-10T17:59:33.587

## C# 可访问性拼图

* * *

以下派生类正在从其基类访问**私有字段，编译器默默地查看另一端：**

```
public class Derived : Base
{
    public int BrokenAccess()
    {
        return base.m_basePrivateField;
    }
} 
```

该字段确实是私有的：

```
private int m_basePrivateField = 0; 
```

想知道我们如何编译这样的代码吗？

.

.

.

.

.

.

.

## 回答

* * *

诀窍是声明`Derived`为的内部类`Base`：

```
public class Base
{
    private int m_basePrivateField = 0;

    public class Derived : Base
    {
        public int BrokenAccess()
        {
            return base.m_basePrivateField;
        }
    }
} 
```

内部类可以完全访问外部类成员。在这种情况下，内部类也恰好派生自外部类。这使我们能够“打破”私有成员的封装。

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2011-01-18T10:35:19.057

今天刚发现一个好东西：

```
public class Base
{
   public virtual void Initialize(dynamic stuff) { 
   //...
   }
}
public class Derived:Base
{
   public override void Initialize(dynamic stuff) {
   base.Initialize(stuff);
   //...
   }
} 
```

这会引发编译错误。

对方法“Initialize”的调用需要动态调度，但不能动态调度，因为它是基本访问表达式的一部分。考虑强制转换动态参数或消除基本访问。

如果我写 base.Initialize(stuff as object); 它工作得很好，但是这似乎是一个“神奇的词”，因为它完全一样，一切仍然被认为是动态的......

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2010-06-19T21:09:42.797

在我们使用的 API 中，返回域对象的方法可能会返回一个特殊的“空对象”。在此的实现中，比较运算符和方法被覆盖，如果它与 比较则`Equals()`返回。`true``null`

所以这个 API 的用户可能有一些这样的代码：

```
return test != null ? test : GetDefault(); 
```

或者更详细一点，像这样：

```
if (test == null)
    return GetDefault();
return test; 
```

where`GetDefault()`是返回一些我们想要使用的默认值的方法，而不是`null`. 当我使用 ReSharper 并遵循它的建议将其中任何一个重写为以下内容时，我感到很惊讶：

```
return test ?? GetDefault(); 
```

如果测试对象是从 API 返回的 null 对象而不是适当`null`的 ，则代码的行为现在已经改变，因为 null 合并运算符实际上检查了`null`、未运行`operator=`或`Equals()`。

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2011-01-05T13:56:40.013

考虑这个奇怪的案例：

```
public interface MyInterface {
  void Method();
}
public class Base {
  public void Method() { }
}
public class Derived : Base, MyInterface { } 
```

如果`Base`和`Derived`在同一个程序集中声明，编译器将使`Base::Method`虚拟和密封（在 CIL 中），即使`Base`没有实现接口。

如果`Base`和`Derived`位于不同的程序集中，则在编译程序集时`Derived`，编译器不会更改另一个程序集，因此它将引入一个成员，`Derived`该成员将是一个显式实现，因为它只会将`MyInterface::Method`调用委托给`Base::Method`.

编译器必须这样做以支持关于接口的多态分派，即它必须使该方法成为虚拟方法。

* * *

## 回答 #24

> 赞同：7
> 
> 时间：2010-02-04T21:14:27.467

以下可能是我只是缺乏的一般知识，但是。前段时间，我们遇到了一个包含虚拟属性的错误案例。稍微抽象一下上下文，考虑以下代码，并将断点应用于指定区域：

```
class Program
{
    static void Main(string[] args)
    {
        Derived d = new Derived();
        d.Property = "AWESOME";
    }
}

class Base
{
    string _baseProp;
    public virtual string Property 
    { 
        get 
        {
            return "BASE_" + _baseProp;
        }
        set
        {
            _baseProp = value;
            //do work with the base property which might 
            //not be exposed to derived types
            //here
            Console.Out.WriteLine("_baseProp is BASE_" + value.ToString());
        }
    }
}

class Derived : Base
{
    string _prop;
    public override string Property 
    {
        get { return _prop; }
        set 
        { 
            _prop = value; 
            base.Property = value;
        } //<- put a breakpoint here then mouse over BaseProperty, 
          //   and then mouse over the base.Property call inside it.
    }

    public string BaseProperty { get { return base.Property; } private set { } }
} 
```

在`Derived`对象上下文中，您可以在添加`base.Property`为手表或在快速手表中输入时获得相同的行为`base.Property`。

我花了一些时间才意识到发生了什么。最后，我被 Quickwatch 启发了。当进入 Quickwatch 并探索`Derived`对象 d （或从对象的上下文中，`this`）并选择 field`base`时，Quickwatch 顶部的编辑字段会显示以下演员表：

```
((TestProject1.Base)(d)) 
```

这意味着如果 base 被这样替换，调用将是

```
public string BaseProperty { get { return ((TestProject1.Base)(d)).Property; } private set { } } 
```

`"AWESOME"`对于 Watches、 Quickwatch和调试鼠标悬停工具提示，然后`"BASE_AWESOME"`在考虑多态性时显示它是有意义的。我仍然不确定它为什么会将其转换为演员表，一个假设是`call`可能无法从这些模块的上下文中获得，并且只有`callvirt`.

无论如何，这显然不会改变任何功能，`Derived.BaseProperty`仍然会真正返回`"BASE_AWESOME"`，因此这不是我们工作中的错误的根源，只是一个令人困惑的组件。然而，我确实发现它可能会误导开发人员，而开发人员在调试会话期间不知道这一事实，特别`Base`是如果没有在您的项目中公开而是作为第 3 方 DLL 引用，导致开发人员只是说：

> “哦，等等..什么？天哪，DLL就像，..做一些有趣的事情”

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2011-02-25T03:33:15.407

这个很难顶。我在尝试构建一个真正支持 Begin/EndInvoke 的 RealProxy 实现时遇到了它（感谢 MS，如果没有可怕的黑客攻击，这不可能做到）。此示例基本上是 CLR 中的一个错误，BeginInvoke 的非托管代码路径无法验证来自 RealProxy.PrivateInvoke（以及我的 Invoke 覆盖）的返回消息是否正在返回 IAsyncResult 的实例。一旦它返回，CLR 就会变得非常混乱，并且对正在发生的事情一无所知，正如底部的测试所证明的那样。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.Remoting.Proxies;
using System.Reflection;
using System.Runtime.Remoting.Messaging;

namespace BrokenProxy
{
    class NotAnIAsyncResult
    {
        public string SomeProperty { get; set; }
    }

    class BrokenProxy : RealProxy
    {
        private void HackFlags()
        {
            var flagsField = typeof(RealProxy).GetField("_flags", BindingFlags.NonPublic | BindingFlags.Instance);
            int val = (int)flagsField.GetValue(this);
            val |= 1; // 1 = RemotingProxy, check out System.Runtime.Remoting.Proxies.RealProxyFlags
            flagsField.SetValue(this, val);
        }

        public BrokenProxy(Type t)
            : base(t)
        {
            HackFlags();
        }

        public override IMessage Invoke(IMessage msg)
        {
            var naiar = new NotAnIAsyncResult();
            naiar.SomeProperty = "o noes";
            return new ReturnMessage(naiar, null, 0, null, (IMethodCallMessage)msg);
        }
    }

    interface IRandomInterface
    {
        int DoSomething();
    }

    class Program
    {
        static void Main(string[] args)
        {
            BrokenProxy bp = new BrokenProxy(typeof(IRandomInterface));
            var instance = (IRandomInterface)bp.GetTransparentProxy();
            Func<int> doSomethingDelegate = instance.DoSomething;
            IAsyncResult notAnIAsyncResult = doSomethingDelegate.BeginInvoke(null, null);

            var interfaces = notAnIAsyncResult.GetType().GetInterfaces();
            Console.WriteLine(!interfaces.Any() ? "No interfaces on notAnIAsyncResult" : "Interfaces");
            Console.WriteLine(notAnIAsyncResult is IAsyncResult); // Should be false, is it?!
            Console.WriteLine(((NotAnIAsyncResult)notAnIAsyncResult).SomeProperty);
            Console.WriteLine(((IAsyncResult)notAnIAsyncResult).IsCompleted); // No way this works.
        }
    }
} 
```

输出：

```
No interfaces on notAnIAsyncResult
True
o noes

Unhandled Exception: System.EntryPointNotFoundException: Entry point was not found.
   at System.IAsyncResult.get_IsCompleted()
   at BrokenProxy.Program.Main(String[] args) 
```

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2010-02-22T07:41:11.243

我不确定你会说这是 Windows Vista/7 的怪异还是 .Net 的怪异，但它让我摸不着头脑。

```
string filename = @"c:\program files\my folder\test.txt";
System.IO.File.WriteAllText(filename, "Hello world.");
bool exists = System.IO.File.Exists(filename); // returns true;
string text = System.IO.File.ReadAllText(filename); // Returns "Hello world." 
```

在 Windows Vista/7 中，该文件实际上将被写入`C:\Users\<username>\Virtual Store\Program Files\my folder\test.txt`

* * *

## 回答 #27

> 赞同：6
> 
> 时间：2010-04-08T18:24:59.293

你有没有想过 C# 编译器会生成无效的 CIL？运行这个，你会得到一个`TypeLoadException`：

```
interface I<T> {
  T M(T p);
}
abstract class A<T> : I<T> {
  public abstract T M(T p);
}
abstract class B<T> : A<T>, I<int> {
  public override T M(T p) { return p; }
  public int M(int p) { return p * 2; }
}
class C : B<int> { }

class Program {
  static void Main(string[] args) {
    Console.WriteLine(new C().M(42));
  }
} 
```

我不知道它在 C# 4.0 编译器中的表现如何。

**编辑**：这是我系统的输出：

```
C:\Temp>type Program.cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1 {

  interface I<T> {
    T M(T p);
  }
  abstract class A<T> : I<T> {
    public abstract T M(T p);
  }
  abstract class B<T> : A<T>, I<int> {
    public override T M(T p) { return p; }
    public int M(int p) { return p * 2; }
  }
  class C : B<int> { }

  class Program {
    static void Main(string[] args) {
      Console.WriteLine(new C().M(11));
    }
  }

}
C:\Temp>csc Program.cs
Microsoft (R) Visual C# 2008 Compiler version 3.5.30729.1
for Microsoft (R) .NET Framework version 3.5
Copyright (C) Microsoft Corporation. All rights reserved.

C:\Temp>Program

Unhandled Exception: System.TypeLoadException: Could not load type 'ConsoleAppli
cation1.C' from assembly 'Program, Version=0.0.0.0, Culture=neutral, PublicKeyTo
ken=null'.
   at ConsoleApplication1.Program.Main(String[] args)

C:\Temp>peverify Program.exe

Microsoft (R) .NET Framework PE Verifier.  Version  3.5.30729.1
Copyright (c) Microsoft Corporation.  All rights reserved.

[token  0x02000005] Type load failed.
[IL]: Error: [C:\Temp\Program.exe : ConsoleApplication1.Program::Main][offset 0x
00000001] Unable to resolve token.
2 Error(s) Verifying Program.exe

C:\Temp>ver

Microsoft Windows XP [Version 5.1.2600] 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2010-03-03T18:43:04.100

C# 有一些非常令人兴奋的地方，它处理闭包的方式。

它不是将堆栈变量值复制到闭包自由变量，而是执行预处理器魔术，将所有出现的变量包装到一个对象中，从而将其移出堆栈 - 直接到堆！:)

我想，这使得 C# 比 ML 本身（使用堆栈值复制 AFAIK）在功能上更完整（或 lambda 完整）语言。F# 也有这个特性，就像 C# 一样。

这确实给我带来了很多乐趣，谢谢你们MS伙计们！

虽然这不是一个奇怪或极端情况......但是基于堆栈的VM语言确实出乎意料:)

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2010-03-21T02:10:30.837

不久前我问的一个问题：

[条件运算符不能隐式转换？](https://stackoverflow.com/questions/2215745/conditional-operator-cannot-cast-implicitly)

鉴于：

```
Bool aBoolValue; 
```

where`aBoolValue`被赋值为 True 或 False；

以下将无法编译：

```
Byte aByteValue = aBoolValue ? 1 : 0; 
```

但这会：

```
Int anIntValue = aBoolValue ? 1 : 0; 
```

提供的答案也很好。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2009-06-26T08:18:15.823

c# 中的作用域有时真的很奇怪。让我举一个例子：

```
if (true)
{
   OleDbCommand command = SQLServer.CreateCommand();
}

OleDbCommand command = SQLServer.CreateCommand(); 
```

这无法编译，因为命令被重新声明？[关于为什么它在 stackoverflow 上的这个线程](https://stackoverflow.com/questions/404899/scope-of-variables-in-a-delegate)和[我的博客](http://people.iola.dk/arj/2009/01/02/scoping-rules-in-c/)中以这种方式工作，有一些有趣的猜测。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2010-08-10T15:37:28.130

以下不起作用：

```
if (something)
    doit();
else
    var v = 1 + 2; 
```

但这有效：

```
if (something)
    doit();
else {
    var v = 1 + 2;
} 
```

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2010-10-14T15:17:01.700

这是我的一些：

1.  调用实例方法而不抛出 NullReferenceException 时 this 可以为 null
2.  不必为枚举定义默认枚举值

简单的第一个：枚举 NoZero { Number = 1 }

```
 public bool ReturnsFalse()
        {
            //The default value is not defined!
            return Enum.IsDefined(typeof (NoZero), default(NoZero));
        } 
```

下面的代码实际上可以打印真实！

```
 internal sealed class Strange
{
    public void Foo()
    {
        Console.WriteLine(this == null);
    }
} 
```

一段简单的客户端代码将导致委托 void HelloDelegate(Strange bar);

```
public class Program
{
    [STAThread()]
    public static void Main(string[] args)
    {
        Strange bar = null;
        var hello = new DynamicMethod("ThisIsNull",
            typeof(void), new[] { typeof(Strange) },
         typeof(Strange).Module);
        ILGenerator il = hello.GetILGenerator(256);
        il.Emit(OpCodes.Ldarg_0);
        var foo = typeof(Strange).GetMethod("Foo");
        il.Emit(OpCodes.Call, foo);
        il.Emit(OpCodes.Ret);
        var print = (HelloDelegate)hello.CreateDelegate(typeof(HelloDelegate));
        print(bar);
        Console.ReadLine();
    }
} 
```

只要调用时的实例方法不使用对象的状态，这实际上在大多数语言中都是正确的。仅当访问对象的状态时才取消引用

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2011-02-09T03:25:40.737

这个非常简单，但我仍然觉得它有些有趣。调用 Foo 后 x 的值是多少？

```
static int x = 0;

public static void Foo()
{
    try { return; }
    finally { x = 1; }
}

static void Main() { Foo(); } 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2010-08-20T23:15:07.083

如果您有扩展方法：

```
public static bool? ToBoolean(this string s)
{
    bool result;

    if (bool.TryParse(s, out result))
        return result;
    else
        return null;
} 
```

这个代码：

```
string nullStr = null;
var res = nullStr.ToBoolean(); 
```

这不会抛出异常，因为它是扩展方法（并且真的`HelperClass.ToBoolean(null)`）而不是实例方法。这可能会令人困惑。

* * *

## 回答 #35

> 赞同：-4
> 
> 时间：2008-10-27T21:24:05.537

以下打印 False 而不是引发溢出异常：

```
Console.WriteLine("{0}", yep(int.MaxValue ));

private bool yep( int val )
{
    return ( 0 < val * 2);
} 
```

* * *

## 回答 #36

> 赞同：-4
> 
> 时间：2008-10-27T21:42:11.820

这让我真的很困惑（我为长度道歉，但它是 WinForm）。不久前，我将它发布在[新闻组](http://bytes.com/forum/thread615727.html)中。

> 我遇到了一个有趣的错误。我有解决方法，但我想知道问题的根源。我已将其精简为一个短文件，并希望有人可能对正在发生的事情有所了解。
> 
> 这是一个简单的程序，它将控件加载到表单上，并将“Foo”绑定到组合框（“SelectedItem”），因为它的“Bar”属性和 datetimepicker（“Value”），因为它的“DateTime”属性。DateTimePicker.Visible 值设置为 false。加载后，选择组合框，然后尝试通过选中复选框来取消选择它。组合框保持焦点使这是不可能的，您甚至无法关闭表单，这就是对焦点的把握。
> 
> 我找到了解决这个问题的三种方法。
> 
> a) 移除对 Bar 的绑定（有点明显）
> 
> b) 移除对 DateTime 的绑定
> 
> c) 使 DateTimePicker 可见！？！
> 
> 我目前正在运行 Win2k。而.NET 2.00，我认为1.1也有同样的问题。代码如下。

```
using System;
using System.Collections;
using System.Windows.Forms;

namespace WindowsApplication6
{
    public class Bar
    {
        public Bar()
        {
        }
    }

    public class Foo
    {
        private Bar m_Bar = new Bar();
        private DateTime m_DateTime = DateTime.Now;

        public Foo()
        {
        }

        public Bar Bar
        {
            get
            {
                return m_Bar;
            }
            set
            {
                m_Bar = value;
            }
        }

        public DateTime DateTime
        {
            get
            {
                return m_DateTime;
            }
            set
            {
                m_DateTime = value;
            }
        }
    }

    public class TestBugControl : UserControl
    {
        public TestBugControl()
        {
            InitializeComponent();
        }

        public void InitializeData(IList types)
        {
            this.cBoxType.DataSource = types;
        }

        public void BindFoo(Foo foo)
        {
            this.cBoxType.DataBindings.Add("SelectedItem", foo, "Bar");
            this.dtStart.DataBindings.Add("Value", foo, "DateTime");
        }

        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Component Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.checkBox1 = new System.Windows.Forms.CheckBox();
            this.cBoxType = new System.Windows.Forms.ComboBox();
            this.dtStart = new System.Windows.Forms.DateTimePicker();
            this.SuspendLayout();
            //
            // checkBox1
            //
            this.checkBox1.AutoSize = true;
            this.checkBox1.Location = new System.Drawing.Point(14, 5);
            this.checkBox1.Name = "checkBox1";
            this.checkBox1.Size = new System.Drawing.Size(97, 20);
            this.checkBox1.TabIndex = 0;
            this.checkBox1.Text = "checkBox1";
            this.checkBox1.UseVisualStyleBackColor = true;
            //
            // cBoxType
            //
            this.cBoxType.FormattingEnabled = true;
            this.cBoxType.Location = new System.Drawing.Point(117, 3);
            this.cBoxType.Name = "cBoxType";
            this.cBoxType.Size = new System.Drawing.Size(165, 24);
            this.cBoxType.TabIndex = 1;
            //
            // dtStart
            //
            this.dtStart.Location = new System.Drawing.Point(117, 40);
            this.dtStart.Name = "dtStart";
            this.dtStart.Size = new System.Drawing.Size(165, 23);
            this.dtStart.TabIndex = 2;
            this.dtStart.Visible = false;
            //
            // TestBugControl
            //
            this.AutoScaleDimensions = new System.Drawing.SizeF(8F, 16F);
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.Controls.Add(this.dtStart);
            this.Controls.Add(this.cBoxType);
            this.Controls.Add(this.checkBox1);
            this.Font = new System.Drawing.Font("Verdana", 9.75F,
            System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point,
            ((byte)(0)));
            this.Margin = new System.Windows.Forms.Padding(4);
            this.Name = "TestBugControl";
            this.Size = new System.Drawing.Size(285, 66);
            this.ResumeLayout(false);
            this.PerformLayout();

        }

        #endregion

        private System.Windows.Forms.CheckBox checkBox1;
        private System.Windows.Forms.ComboBox cBoxType;
        private System.Windows.Forms.DateTimePicker dtStart;
    }

    public class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            this.Load += new EventHandler(Form1_Load);
        }

        void Form1_Load(object sender, EventArgs e)
        {
            InitializeControl();
        }

        public void InitializeControl()
        {
            TestBugControl control = new TestBugControl();
            IList list = new ArrayList();
            for (int i = 0; i < 10; i++)
            {
                list.Add(new Bar());
            }
            control.InitializeData(list);
            control.BindFoo(new Foo());
            this.Controls.Add(control);
        }

        /// <summary>
        /// Required designer variable.
        /// </summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>
        /// Clean up any resources being used.
        /// </summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        #region Windows Form Designer generated code

        /// <summary>
        /// Required method for Designer support - do not modify
        /// the contents of this method with the code editor.
        /// </summary>
        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
            this.Text = "Form1";
        }

        #endregion
    }

    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
        }
    }
} 
```

* * *

## 回答 #37

> 赞同：-18
> 
> 时间：2008-10-12T15:37:48.823

我认为这个问题的答案是因为.net 使用字符串实习可能导致相等的字符串指向同一个对象（因为字符串是可变的，这不是问题）

（我不是在谈论字符串类上的重写相等运算符）

# xcode - 如何使用 Xcode 创建动态库 (dylib)？

> ID：194485
> 
> 赞同：28
> 
> 时间：2008-10-11T19:30:47.450
> 
> 标签：xcode, linker, shared-libraries, dylib, mach-o

我在 Xcode 中构建了一些命令行实用程序（纯 C，没有 Cocoa）。我希望他们所有人都使用我定制的 libpng 版本，并且我想通过在所有可执行文件之间共享一个库的副本来节省空间（我不介意`.dylib`与它们一起重新分发）。

我需要做一些魔术来获取 libpng 导出符号吗？

*“Link Binary With Libraries”*是否静态构建阶段链接？

Apple 的文档提到在运行时加载库`dlopen`，但是我如何让 Xcode 创建可执行文件而不抱怨缺少符号？

* * *

我想我已经弄清楚了：

*   libpng 没有正确链接，因为我已经构建了 32/64 位可执行文件和 32 位库。库和可执行文件的构建设置必须匹配。

*   libpng 的 config.h 需要有大量的定义，例如`#define FEATURE_XXX_SUPPORTED`

*   *“Link Binary With Libraries”*构建阶段可以很好地处理动态库，并且`DYLD_FALLBACK_LIBRARY_PATH`环境变量对于`.dylib`从应用程序包加载 s 是必需的。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-05T13:54:13.373

Mac OS X 上的动态链接，一个小例子

脚步：

1.  创建一个包含 mymod.o 的库 libmylib.dylib
2.  编译并链接一个调用它的“callmymod”
3.  使用 DYLD_LIBRARY_PATH 和 DYLD_PRINT_LIBRARIES 从 callmymod 调用 mymod

问题：您“只是”想创建一个库供其他模块使用。然而，有一堆令人生畏的程序——gcc、ld、macosx libtool、dyld——有无数的选项、一些腐烂的堆肥，以及 MacOSX 和 Linux 之间的差异。有大量的手册页（我在 10.4.11 ppc 中计算了 7679 + 1358 + 228 + 226 行），但没有太多示例，或者具有“告诉我你在做什么”模式的程序。

（理解最重要的是给自己做一个简化的OVERVIEW：画一些图，跑一些小例子，给别人解释）。

背景：[苹果 OverviewOfDynamicLibraries](https://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/DynamicLibraries/100-Articles/OverviewOfDynamicLibraries.html)， [维基百科 Dynamic_library](http://en.wikipedia.org/wiki/Dynamic_library)

* * *

第一步，创建libmylib.dylib——

```
mymod.c:
    #include <stdio.h>
    void mymod( int x )
    {
        printf( "mymod: %d\n", x );
    }
gcc -c mymod.c  # -> mymod.o
gcc -dynamiclib -current_version 1.0  mymod.o  -o libmylib.dylib
    # calls libtool with many options -- see man libtool
    # -compatibility_version is used by dyld, see also cmpdylib

file libmylib.dylib  # Mach-O dynamically linked shared library ppc
otool -L libmylib.dylib  # versions, refs /usr/lib/libgcc_s.1.dylib 
```

* * *

第二步，编译链接callmymod——

```
callmymod.c:
    extern void mymod( int x );
    int main( int argc, char** argv )
    {
        mymod( 42 );
    }
gcc -c callmymod.c
gcc -v callmymod.o ./libmylib.dylib -o callmymod
    # == gcc callmymod.o -dynamic -L. -lmylib
otool -L callmymod  # refs libmylib.dylib
nm -gpv callmymod  # U undef _mymod: just a reference, not mymod itself 
```

* * *

第 3 步，运行 callmymod 链接到 libmylib.dylib --

```
export DYLD_PRINT_LIBRARIES=1  # see what dyld does, for ALL programs
./callmymod
    dyld: loaded: libmylib.dylib ...
    mymod: 42

mv libmylib.dylib /tmp
export DYLD_LIBRARY_PATH=/tmp  # dir:dir:...
./callmymod
    dyld: loaded: /tmp/libmylib.dylib ...
    mymod: 42

unset DYLD_PRINT_LIBRARIES
unset DYLD_LIBRARY_PATH 
```

一个小例子到此结束；希望它有助于理解这些步骤。
（如果您经常这样做，请参阅[GNU Libtool](http://en.wikipedia.org/wiki/Libtool) ，它是 mac 上的 glibtool，以及[SCons](http://www.scons.org)。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-12T03:00:34.077

您可能需要确保您构建的动态库具有导出的符号文件，其中列出了应从库中导出的内容。它只是要导出的符号的平面列表，每行一个。

此外，当您的动态库被构建时，它会在其中嵌入一个*安装名称*，默认情况下，它是构建它的路径。随后，任何链接到它的东西都会首先在指定的路径中查找它，然后才搜索[手册页](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/dyld.1.html "dyld(1) man page")`DYLD_FALLBACK_LIBRARY_PATH`中描述的一组（小）默认路径。[`dyld(1)`](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/dyld.1.html "dyld(1) 手册页")

如果你打算把这个库放在你的可执行文件旁边，你应该调整它的安装名称来引用它。只需在 Google 上搜索“安装名称”就可以找到大量相关信息。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-23T01:33:34.513

不幸的是，根据我的经验，Apple 的文档已经过时、冗余并且缺少很多您通常需要的常见信息。

我在我的网站上写了很多关于这个的东西，我必须让 FMOD（声音 API）与我们在 uni 开发的跨平台游戏一起工作。这是一个奇怪的过程，我很惊讶苹果没有在他们的开发者文档中添加更多信息。

不幸的是，像微软一样“邪恶”，他们实际上在用文档照顾他们的开发人员方面做得更好（这来自苹果的传道者）。

我认为基本上，你没有做的是在你编译了你的 .app Bundle 之后。然后，您需要在可执行二进制文件 /MyApp.app/contents/MacOS/MyApp 上运行命令，以更改可执行文件查找其库文件的位置。您必须创建一个可以运行脚本的新构建阶段。这个过程我就不再解释了，这里我已经深入做过了：

[http://brockwoolf.com/blog/how-to-use-dynamic-libraries-in-xcode-31-using-fmod](http://brockwoolf.com/blog/how-to-use-dynamic-libraries-in-xcode-31-using-fmod)

希望这可以帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T02:21:24.720

您知道 Apple 参考页面[Dynamic Library Programming Topics](http://developer.apple.com/library/mac/documentation/DeveloperTools/Conceptual/DynamicLibraries/index.html)吗？它应该涵盖您需要的大部分内容。请注意，有一个在程序启动时无条件加载的共享库和按需加载的动态加载库（bundles，IIRC），两者在 MacOS X 上与 Linux 或 Solaris 上的等效库有些不同。

# c++ - 从子类访问受保护的成员：gcc vs msvc

> ID：194492
> 
> 赞同：5
> 
> 时间：2008-10-11T19:40:12.593
> 
> 标签：c++, gcc, g++, visual-c++

在 Visual C++ 中，我可以执行以下操作：

```
template <class T>
class A{
protected:
    T i;
};

template <class T>
class B : public A<T>{
    T geti() {return i;}
}; 
```

如果我尝试在 g++ 中编译它，我会得到一个错误。我必须这样做：

```
template <class T>
class B : public A<T>{
    T geti() {return A<T>::i;}
}; 
```

我不应该在标准 C++ 中做前者吗？还是 gcc 配置错误导致我出错？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-11T21:02:17.547

这曾经是允许的，但在[gcc 3.4](http://gcc.gnu.org/gcc-3.4/changes.html#cplusplus)中改变了。

在模板定义中，非限定名称将不再找到依赖基的成员（如 C++ 标准中的 [temp.dep]/3 所指定）。例如，

```
 template <typename T> struct B {
      int m;
      int n;
      int f ();
      int g ();
    };
    int n;
    int g ();
    template <typename T> struct C : B<T> {
      void h ()
      {
        m = 0; // error
        f ();  // error
        n = 0; // ::n is modified
        g ();  // ::g is called
      }
    }; 
```

您必须使名称依赖，例如通过在它们前面加上 this->。这是 C::h 的更正定义，

```
 template <typename T> void C<T>::h ()
    {
      this->m = 0;
      this->f ();
      this->n = 0
      this->g ();
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T21:03:34.813

我想出了这个：

*   [C++ 超级常见问题解答：“当我的模板派生类使用从其模板基类继承的嵌套类型时，为什么会出现错误？”](https://isocpp.org/wiki/faq/templates#nondependent-name-lookup-types)
*   [C++ 超级常见问题解答：“当我的模板派生类使用从其模板基类继承的成员时，为什么会出现错误？”](https://isocpp.org/wiki/faq/templates#nondependent-name-lookup-members)

显然，第一个示例不是有效的 C++，msvc 采用它很糟糕。C++ faq lite 上发布了解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T15:09:53.263

您可能想了解[两阶段名称查找](http://www.codeproject.com/KB/cpp/TwoPhaseLookup.aspx)

# design-patterns - 静态工厂方法与实例（普通）构造函数？

> ID：194496
> 
> 赞同：56
> 
> 时间：2008-10-11T19:41:26.460
> 
> 标签：design-patterns, constructor, coding-style

在两者都可用的语言中，您希望看到实例构造函数还是返回实例的静态方法？

例如，如果您`String`从 a创建一个`char[]`：

1.  `String.FromCharacters(chars);`

2.  `new String(chars);`

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-11T19:48:22.500

在[Effective Java, 2nd edition](https://rads.stackoverflow.com/amzn/click/com/0321356683)中，Joshua Bloch 肯定推荐前者。我记得有几个原因，毫无疑问有些我不记得了：

*   你可以给方法一个有意义的名字。如果您有两种构造实例的方法，这两种方法都采用 int，但对于该 int 具有不同的含义，则使用普通方法会使调用代码更具可读性。
*   第一个推论 - 您可以使用具有相同参数列表的不同工厂方法
*   您可以为“潜在的预期失败”情况返回 null，而构造函数将*始终*返回值或引发异常
*   您可以返回声明以外的类型（例如返回派生类）
*   您可以将其用作工厂，以可能多次返回对同一对象的引用

缺点：

*   目前，它并不惯用 - 开发人员更习惯于看到“新”
*   如果您看到“新”，您就*知道您正在获得一个新实例（以*[我最近提到的奇怪](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-or-net)为模）
*   您需要为子类提供适当的构造函数
*   在 C# 3 中，构造函数调用能够使用对象初始化表达式以紧凑的方式设置字段/属性；该功能不适用于静态方法调用

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-11T20:06:18.533

我在创建实例时编写了一个构造函数，没有副作用，即构造函数唯一要做的事情就是初始化属性。如果创建实例执行您通常不希望构造函数执行的操作，我将编写一个静态方法（并将构造函数设为私有）。

例如：

```
public class Foo
{
   private Foo() { }

   private static List<Foo> FooList = new List<Foo>();
   public static Foo CreateFoo()
   {
      Foo f = new Foo();
      FooList.Add(f);
      return f;
   }
} 
```

因为我遵守这个约定，如果我看到

```
Foo f = Foo.CreateFoo();
Bar b = new Bar(); 
```

在阅读我的代码时，我对这两行中的每一行所做的事情有着截然不同的期望。该代码并没有告诉我是什么让创建 Foo 与创建 Bar 不同，但它告诉我我需要查看。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-06-15T10:59:56.810

我最近一直在研究一个公共 API，我一直在为静态工厂方法与构造函数的选择而苦恼。静态工厂方法在某些情况下肯定是有意义的，但在其他情况下则不是很清楚，我不确定与 API 其余部分的一致性是否足以将它们包含在构造函数中。

无论如何，我在[Bill-Venners 对 Josh Bloch 的采访中看到了一句](http://www.artima.com/intv/bloch14.html)我觉得很有帮助的名言：

> 当你在写一个类时，你可以在我的书中列出静态工厂相对于公共构造函数的优势。如果您发现这些优势中的大部分实际上适用于您的情况，那么您应该使用静态工厂。否则，您应该使用构造函数。
> 
> 有些人对在我的书中找到这个建议感到失望。他们读到它并说：“你强烈支持公共静态工厂，我们应该默认使用它们。” 我认为这样做的唯一真正缺点是，对于习惯于使用构造函数来创建对象的人来说，这有点令人不安。而且我认为它在程序中提供的视觉提示要少一些。（您看不到 new 关键字。）此外，在文档中找到静态工厂有点困难，因为 Javadoc 将所有构造函数组合在一起。但是我想说大家应该一直考虑静态工厂，在合适的时候使用。

阅读了那句话，以及[Uri 提到的研究](http://www.cs.cmu.edu/~NatProg/papers/Ellis2007FactoryUsability.pdf)* 后，我感觉倾向于错误地支持构造函数，除非有令人信服的理由不这样做。我认为没有正当理由的静态工厂方法可能只是不必要的复杂性和过度工程。虽然明天我可能会再次改变主意......

*不幸的是，这项研究较少关注静态工厂方法，而更多地关注工厂模式（存在一个单独的工厂对象来创建新实例），所以我不确定是否真的可以得出静态工厂方法让许多程序员感到困惑的结论。尽管这项研究确实给我的印象是他们经常会这样做。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-11T20:05:56.473

如果您的对象是不可变的，您也许可以使用静态方法返回缓存的对象并为自己节省内存分配和处理。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-11T19:54:25.420

ICSE'07 有一篇论文研究了构造函数与工厂模式的可用性。虽然我更喜欢工厂模式，但研究表明开发人员在找到正确的工厂方法方面速度较慢。

[http://www.cs.cmu.edu/~NatProg/papers/Ellis2007FactoryUsability.pdf](http://www.cs.cmu.edu/~NatProg/papers/Ellis2007FactoryUsability.pdf)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-11T20:08:08.293

这取决于。对于使用实例构造函数是“正常”的语言，我通常会使用一个，除非我有充分的理由不这样做。这遵循最小意外原则。

顺便说一句，您忘记了另一个常见情况：null/default 构造函数与初始化方法配对。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-11T19:44:48.607

静态方法。然后你可以返回一个null，而不是抛出一个异常（除非是引用类型）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-11T19:46:01.630

我更喜欢实例构造函数，只是因为这对我来说更有意义，并且你试图表达的内容的潜在歧义更少（即：如果 FromCharacters 是一个采用单个字符的方法怎么办）。不过，当然是主观的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-11T19:48:30.830

我个人更喜欢看普通的构造函数，因为构造函数应该是用来构造的。但是，如果有充分的理由*不*使用它，即如果 FromCharacters 明确声明它没有分配新内存，那将是值得的。调用中的“新”是有意义的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-12T05:03:01.117

正如 Jon Skeet 解释 Josh Bloch 所说，在许多情况下静态工厂方法比构造函数更可取的原因有很多。我会说，如果该类是一个简单的类，没有昂贵的设置或复杂的使用，请使用惯用的构造函数。现代 JVM 使对象创建极其快速和廉价。如果该类可能是子类，或者您能够使其不可变（并发编程的一大优势，这只会变得更加重要），然后使用工厂方法。

还有一个提示。不要命名工厂方法`Foo.new*`或`Foo.create*`. 具有这些名称的方法应始终返回一个新实例，这样做会错过工厂方法的一大优势。更好的命名约定是`Foo.of*`or `Foo.for*`。[Google Guava 库](https://github.com/google/guava)（以前的*Google Collections Library*）在这方面做得很好，恕我直言。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-01-28T17:31:55.050

*当然，静态工厂方法相对于构造函数有几个优点。*

1.  工厂方法帮助我们编写灵活的代码。而构造函数使其紧密耦合。
2.  静态工厂方法提高了可读性，因为它们允许您创建不同的实例。
3.  您可以返回一个缓存的对象。例如`getInstance()`在单例中。

# c++ - 如何在 fork 的帮助下并行搜索文件中的字符串？(GNU Linux/g++)

> ID：194499
> 
> 赞同：3
> 
> 时间：2008-10-11T19:42:34.773
> 
> 标签：c++, linux, file, search, parallel-processing

我有一个包含几行的文本文件，我正在这个文件中寻找一个字符串。我需要将以下命令行参数传递给程序：
- 文件路径
- 我要查找的字符串
- 允许程序“分叉”以完成此任务的最大进程数。

这样的程序应该如何构建？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T19:46:14.640

几个想法。

*   您必须与每个进程分开打开文件，否则它们将共享一个文件描述符，因此在文件中具有共享位置（或不，请参阅注释，因为这可能是系统特定的......）。
*   由于磁盘访问和/或缓存未命中模式，您可能看不到您希望的速度提高。

您可以通过内存映射文件来解决这两个问题（当然，您仍然冒着增加缓存未命中率的风险）......

* * *

你有多需要这个？它存在过早优化的真正风险。我建议不要在没有迫切需要的情况下接触这个问题。真的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T19:51:06.940

考虑一下为什么你认为你需要并行化它，以及你是否会看到任何实际的性能优势。您可能会受到磁盘访问时间的限制，并且分叉会产生开销。您最好的选择可能是进行标准的单线程搜索（可能使用正则表达式）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T21:23:01.357

假设你真的认为这是必要的（或者这是家庭作业？），一个（相对高级的）方法可能是：

1.  计算要搜索的文件的大小（例如使用 fopen、fseek(file, END)、fclose）
2.  将文件中的两个偏移量关联到每个进程：搜索开始偏移量和搜索结束偏移量：

    ```
    startIndex = indexOfProcess * fileSize / numberOfProcesses
    endIndex = (indexOfProcess + 1) * fileSize / numberOfProcesses

    ```

    您必须考虑这样一个事实，即要搜索的字符串可以通过添加一些重叠来跨越两个或多个进程的切片（这将是字符串大小的函数）。
3.  fork，在每个进程中打开文件（在读取模式下），fseek 到开始索引，搜索字符串，就好像你有一个大小的文件（endIndex - startIndex），然后将结果转储到屏幕上（或者，如果你有更具体的要求，请告诉我们）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T21:35:24.127

要么这是作业，要么这是无用的。瓶颈在于磁盘带宽，而不是 CPU 能力。使用同时访问只会减慢您的速度。

# c# - 发现现有项目的最佳方式是什么？

> ID：194516
> 
> 赞同：3
> 
> 时间：2008-10-11T19:48:48.410
> 
> 标签：c#, projects-and-solutions, code-discovery

最近我的任务是发现一个我以前从未见过的 C# 解决方案，并就重构它提出建议。我想我将使用 NDepend（有史以来第一次）来查看整体情况，并检查大量代码指标以找出可以重构的内容。我认为 NDepend 非常擅长展示项目的结构。

我的问题是一个更笼统的问题：您认为发现您第一次看到的代码并需要了解其结构的最佳方法是什么？（不幸的是，没有合乎逻辑的设计文档，代码注释也很差。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T10:57:19.170

使用 NDepend 更容易发现代码。该工具为程序集、命名空间和类之间的依赖关系和分层提供了一种自上而下的方法。这是通过代码生成的一些图形和依赖矩阵来完成的。

您还将获得对层代码程序集的依赖关系，这对于了解代码的哪一部分执行什么操作非常有用。

此外，一些体积指标的图形表示，例如 # 行代码，有助于清楚地了解代码在哪里完成的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T19:57:20.533

我经常使用[Reflector](http://reflector.red-gate.com/)来研究第三方程序集以及 .NET 程序集。与其说是鸟瞰类之间的关系，不如说是更详细地了解正在发生的事情。

# windows - 创建独立的 Lua 可执行文件

> ID：194520
> 
> 赞同：39
> 
> 时间：2008-10-11T19:50:15.443
> 
> 标签：windows, lua

有没有一种简单的方法可以从 Lua 脚本创建独立的 .exe 文件？基本上这将涉及链接 Lua 解释器和脚本。

我相信这是可能的（PLT Scheme 允许以相同的方式创建独立的可执行文件），但是究竟如何呢？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-11T21:08:19.810

检查[srlua](http://www.tecgraf.puc-rio.br/~lhf/ftp/lua/#srlua)。它可以满足您的需要。

它来自 Lua 作者之一。在这个地址上还有预编译的 Windows 二进制文件，所以我认为这对你来说会更容易。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-07-19T14:41:58.790

要从脚本中执行可执行文件，请使用 bin2c 实用程序，如下所示：

```
luac script.lua -o script.luac
bin2c script.luac > code.c 
```

然后在文本编辑器文件 main.c 中创建并使用您喜欢的编译器编译/链接它。就是这样。（注意 - 可执行文件还支持命令行参数）

MSVC 示例：

```
cl /I "./" /I "$(LUA_DIR)\include" /D "_CRT_SECURE_NO_DEPRECATE" /D "_MBCS" /GF /FD /EHsc /MD /Gy /TC /c main.c
ld /SUBSYSTEM:CONSOLE /RELEASE /ENTRY:"mainCRTStartup" /MACHINE:X86 /MANIFEST $(LUA_DIR)\lib\lua5.1.lib main.obj /out:script.exe
mt -manifest $script.manifest -outputresource:script.exe;1 
```

对 GUI 可执行文件使用 /SUBSYSTEM:WINDOWS。第一次这一切都不容易，一旦成功尝试，您可以创建批处理文件以自动化该过程。

主.c：

```
#include <stdlib.h>
#include <stdio.h>
#include "lua.h"
#include "lauxlib.h"
#include "lualib.h"

int main(int argc, char *argv[]) {
  int i;
  lua_State *L = luaL_newstate();
  luaL_openlibs(L);
  lua_newtable(L);
  for (i = 0; i < argc; i++) {
    lua_pushnumber(L, i);
    lua_pushstring(L, argv[i]);
    lua_rawset(L, -3);
  }
  lua_setglobal(L, "arg");
#include "code.c"
  lua_close(L);
  return 0;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-09T21:00:47.100

除了以上建议，您还可以看看[L-Bia](http://l-bia.luaforge.net/)。

它可以制作独立的可执行文件，包括 lua 脚本和所需的动态库。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-09-26T14:27:28.263

截至 2018 年，[luastatic](https://github.com/ers35/luastatic)是一个积极维护的工具，可以做到这一点。已接受答案中的 srlua 和此页面上的其他工具似乎未维护。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-11T20:41:01.083

既然您说“.exe”，我假设您正在寻找 Windows 解决方案。一种想法是将脚本附加到预构建的解释器可执行文件中。在您的书中，它可能会或可能不会被称为“简单”。

解释器需要能够读取自己，解析其头部以确定常规 .exe 数据的结束位置（即脚本开始的位置），然后将文件的其余部分交给 Lua。

其他解决方案不需要解释器努力工作，但需要更多涉及的链接，而使用这种方法，执行脚本可以很简单

```
copy interpreter.exe+script.lua script.exe 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-19T13:05:50.247

由于这个主题具有某种“永久”的兴趣，并且可能的答案是“流动的”，因为新的解决方案可能会出现（而旧的解决方案可能会过时），这里还有另一种可能性（对于 Windows）和纯 Lua 源依赖项。

链接：[Windows 控制台实用程序，只需一步即可将 Lua 源及其 Lua 源依赖项转换为准备编译的 C 文件。](http://chiselapp.com/user/tonypdmtr/repository/PureLua53/uv/lua2c.exe)

*注意：除了其他平台的字节码存在差异外，生成的 C 代码应该能够在任何可以编译库存 Lua 源代码的平台上编译，并创建 Lua 应用程序的独立本机二进制文件。*

# .net - 使用 LINQ 进行多次删除（更具体地说是 Linq2Nhibernate，但是......）

> ID：194521
> 
> 赞同：2
> 
> 时间：2008-10-11T19:50:56.677
> 
> 标签：.net, sql, linq, nhibernate

有什么聪明的方法可以做到这一点吗？

如果使用`Linq2Nhibernate`，您似乎真的必须依赖`HQL`或喜欢从数据库中进行多次删除（无需加载并一一删除）？

好像`Linq2Sql`也没有？我只想要一些可以做的事情，比如：

```
DELETE FROM Accounts WHERE amount < 1000 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T21:05:51.860

简短的回答是：你不能。

您可以执行以下操作：

```
var q = from account in dataContext.Accounts
    where account.amount < 1000
    select account;

dataContext.DeleteAllOnSubmit(q); 
```

但是，因为框架需要跟踪并发问题，它总是会执行单独的删除（所以如果你有 500 行要被删除，它会发送 500 条删除语句）

有关更长的版本和解决方案，请参阅：[http ://www.aneyfamily.com/terryandann/post/2008/04/Batch-Updates-and-Deletes-with-LINQ-to-SQL.aspx](http://www.aneyfamily.com/terryandann/post/2008/04/Batch-Updates-and-Deletes-with-LINQ-to-SQL.aspx)

# windows - UDP和我的电脑？

> ID：194526
> 
> 赞同：0
> 
> 时间：2008-10-11T19:52:40.260
> 
> 标签：windows, udp, firewall

我最近在我的计算机上打开了 Windows 防火墙日志记录并开始跟踪传入和传出连接。对日志文件感到好奇的是，我注意到许多 UDP 数据包（实际上，它基本上构成了我所有的传入流量），这些数据包没有将我的主机作为目标或源出现在日志中。

我认为这可能是 UDP 的实现细节（数据包在子网中的我的计算机上跳跃）但维基百科的 UDP 并没有再启发我，我不明白为什么我的计算机应该转发这些数据包第一名。

有任何想法吗？

**编辑 1：**这是带有神秘 UDP 数据包的日志文件行的样子：

```
2008-10-11 16:04:31 ALLOW UDP 18.243.7.218 239.255.255.250 49152 3702 0 - - - - - - - RECEIVE 
```

239.255.255.250 是广播地址吗？既然你提到了，我看到的 UDP 数据包有非常具体的目的地，基本上是 224.0.0.252、239.255.255.250、18.243.255.255。我还收到了发往 224.0.0.1 的虚拟 ICMP ping。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-11T20:24:44.720

发往以 239 和 224 开头的 IP 的数据包是[多播数据包](http://en.wikipedia.org/wiki/Multicast)。这是一种在不将其广播到整个网络的情况下将流量寻址到一组计算机的方法。它被各种合法协议使用。

224.0.0.252 是[链路本地名称解析协议](http://en.wikipedia.org/wiki/Link-local_Multicast_Name_Resolution)使用的地址。

239.255.255.250 是[简单服务发现协议](http://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol)使用的地址。

224.0.0.1 是[所有主机地址](http://tldp.org/HOWTO/Multicast-HOWTO-2.html)，路由器使用它来查看网络上谁愿意参与多播对话。

寻址到 18.243.255.255 的那些看起来像广播，这又被许多合法协议（如 Bonjour）使用。

正如 Luka 所推荐的，像[Wireshark](http://www.wireshark.org/)这样好的协议分析器会准确地告诉你这些数据包是什么以及它们包含什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T20:04:08.910

这取决于您使用的连接类型。在大多数有线调制解调器 ISP 上，您基本上与您的邻居在同一个 LAN 上，并且通常可以看到他们的一些流量（如 brodcast）。

我建议您安装数据包嗅探器并查看实际情况。好的多平台数据包嗅探器是[Wireshark](http://www.wireshark.org/)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-11T20:03:50.550

如果不分析日志数据很难说，但它们可能是网段上的广播数据包，在这种情况下，您的系统会监听它们。这在 IPv4 和 IPv6 中是可能的。

您的系统不应该转发它们，除非它设置为路由，但它当然可以一直在监听数据包（各种网络协议使用 UDP）。

# c# - 针对 MS Access 的 LINQ asp.net 页面。

> ID：194528
> 
> 赞同：9
> 
> 时间：2008-10-11T19:55:22.190
> 
> 标签：c#, asp.net, linq, ms-access

我有一个使用 ADO 查询 MS 访问数据库的 ASP.Net 页面，作为学习练习，我想结合 LINQ。我有一张简单的表格，叫做报价单。

这些字段是：QuoteID、QuoteDescription、QuoteAuthor、QuoteDate。我想运行简单的查询，例如“给我 1995 年之后的所有报价”。

我如何将 LINQ 合并到这个 ASP.Net 站点（C#）中

基本上，我的问题是 LINQ 是否适用于 MS Access ？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-11T21:09:46.797

LINQ to SQL 不支持 Access（即，没有用于 LINQ 的 Access/Jet 提供程序），但您可以使用 LINQ 查询数据集。这意味着您使用数据库中可能需要在结果中的任何可能数据填充 DataSet，然后在客户端进行过滤。在你有一个类型化的 DataSet 并使用 TableAdapter 填充（）它之后，你可以执行以下操作：

```
var year = 1995;  // you can pass the year into a method so you can filter on any year
var results = from row in dsQuotes
              where row.QuoteDate > year
              select row; 
```

你必须决定这是否值得。您必须用*所有*引号填充 DataSet，然后使用 LINQ 仅过滤 1995 年之后的那些引号。对于少量数据，当然，为什么不呢？但是对于非常大量的数据，您需要确保它不会太慢。

但是，如果您使用的是 DataSet，则可以编写自定义查询，这些查询将成为新的 TableAdapter 方法。因此，您可以将查询的正确 SQL 放入 TableAdapter 中的 FillByYear() 方法中，并使用它来填充您键入的 DataTable。这样你就只能取回你需要的数据。

如果你走这条路，请记住 Access/Jet 使用位置参数，而不是命名参数。所以而不是

```
SELECT * FROM Quotes WHERE Year(QuoteDate) > @Year 
```

你会使用这样的东西：

```
SELECT * FROM Quotes WHERE Year(QuoteDate) > ? 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-11T20:00:32.773

我不*认为*LINQ to SQL 支持 Access。但是，如果您的表足够小以适合内存，LINQ to DataSet 将让您非常轻松地查询数据表等 - 特别是强类型数据集。

# dependency-injection - 对具有许多依赖项的类使用依赖注入框架

> ID：194534
> 
> 赞同：36
> 
> 时间：2008-10-11T20:02:52.470
> 
> 标签：dependency-injection

我一直在研究 .NET 的各种依赖注入框架，因为我觉得我正在从事的项目将从中受益匪浅。虽然我认为我很好地掌握了这些框架的*功能*，但我仍然不清楚如何最好地将它们引入大型系统。大多数演示（可以理解）往往是具有一两个依赖项的非常简单的类。

我有三个问题...

**首先**，您如何处理那些常见但无趣的依赖关系，例如 ILog、IApplicationSettings、IPermissions、IAudit。每个类都在其构造函数中将这些作为参数似乎有点过头了。在需要时使用 DI 容器的静态实例来获取它们会更好吗？

```
MyClass(ILog log, IAudit audit, IPermissions permissions, IApplicationSettings settings)
// ... versus ...
ILog log = DIContainer.Get<ILog>(); 
```

**其次**，您如何处理*可能*使用但创建成本可能很高的依赖项。示例 - 一个类可能依赖于 ICDBurner 接口，但不希望创建具体实现，除非实际使用了 CD 刻录功能。您是在构造函数中将接口传递给工厂（例如 ICDBurnerFactory），还是再次采用某种静态方式直接进入 DI 容器并在需要时请求它？

**第三**，假设您有一个大型 Windows 窗体应用程序，其中顶级 GUI 组件（例如 MainForm）可能是数百个子面板或模式窗体的父级，每个子面板或模式窗体可能有多个依赖项。这是否意味着应该将 MainForm 设置为将其所有子项的所有依赖项的超集作为依赖项？如果你这样做了，这最终会不会创建一个巨大的自膨胀怪物，它会在你创建 MainForm 的那一刻构建它可能需要的每一个类，在这个过程中浪费时间和内存？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-10-16T09:14:42.110

好吧，虽然您可以按照其他答案中的描述执行此操作，但我相信关于您的示例还有更重要的事情需要回答，那就是您可能违反了具有许多依赖关系的类的 SRP 原则。

在您的示例中，我会考虑将类分解为几个具有重点关注点的更连贯的类，因此它们的依赖项的数量会下降。

尼古拉的 SRP 和 DI 定律

> “任何具有超过 3 个依赖项的类都应因违反 SRP 而受到质疑”

（为了避免冗长的回答，我在[IoC 和 SRP](https://vuscode.wordpress.com/2009/10/16/inversion-of-control-single-responsibility-principle-and-nikola-s-laws-of-dependency-injection/)博客文章中详细发布了我的答案）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T20:27:24.120

**首先：**根据需要将简单的依赖项添加到您的构造函数中。无需将每种类型都添加到每个构造函数中，只需添加您需要的类型即可。需要另一个，只需扩展构造函数即可。性能应该不是什么大事，因为这些类型中的大多数可能是单例，因此在第一次调用后就已经创建了。不要使用静态 DI 容器来创建其他对象。而是将 DI 容器添加到自身，以便它可以将自身解析为依赖项。所以像这样的东西（暂时假设 Unity）

```
IUnityContainer container = new UnityContainer();
container.RegisterInstance<IUnityContainer>(container); 
```

这样，您只需添加对 IUnityContainer 的依赖项并使用它来创建昂贵或很少需要的对象。主要优点是单元测试时更容易，因为没有静态依赖项。

**第二：**不需要通过工厂类。使用上述技术，您可以在需要时使用 DI 容器本身来创建昂贵的对象。

**三：**将DI容器和轻单例依赖添加到主窗体中，根据需要通过DI容器创建其余部分。需要更多代码，但正如您所说，如果您在启动时创建所有内容，则主窗体的启动成本和内存消耗将达到顶峰。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-13T19:35:57.827

**第一的：**

您可以在需要时将这些对象作为成员而不是在构造函数中注入。这样，您不必在使用更改时对构造函数进行更改，并且您也不需要使用静态。

**第二：**

进入某种建筑商或工厂。

**第三：**

任何类都应该只具有它本身需要的那些依赖项。子类应该注入它们自己的特定依赖项。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-19T16:02:05.603

*我有一个与“创建成本高且可能*使用”相关的类似案例，在我自己的 IoC 实现中，我正在为工厂服务添加自动支持。

基本上，而不是这样：

```
public SomeService(ICDBurner burner)
{
} 
```

你会这样做：

```
public SomeService(IServiceFactory<ICDBurner> burnerFactory)
{
}

ICDBurner burner = burnerFactory.Create(); 
```

这有两个优点：

*   在幕后，解析您的服务的服务容器也用于解析刻录机，如果以及何时请求
*   这减轻了我之前在这种情况下看到的担忧，典型的方法是将服务容器本身作为参数注入到您的服务中，基本上是说“该服务需要其他服务，但我不会轻易告诉你哪些”

工厂对象很容易制作，解决了很多问题。

这是我的工厂课程：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using LVK.IoC.Interfaces;
using System.Diagnostics;

namespace LVK.IoC
{
    /// <summary>
    /// This class is used to implement <see cref="IServiceFactory{T}"/> for all
    /// services automatically.
    /// </summary>
    [DebuggerDisplay("AutoServiceFactory (Type={typeof(T)}, Policy={Policy})")]
    internal class AutoServiceFactory<T> : ServiceBase, IServiceFactory<T>
    {
        #region Private Fields

        [DebuggerBrowsable(DebuggerBrowsableState.Never)]
        private readonly String _Policy;

        #endregion

        #region Construction & Destruction

        /// <summary>
        /// Initializes a new instance of the <see cref="AutoServiceFactory&lt;T&gt;"/> class.
        /// </summary>
        /// <param name="serviceContainer">The service container involved.</param>
        /// <param name="policy">The policy to use when resolving the service.</param>
        /// <exception cref="ArgumentNullException"><paramref name="serviceContainer"/> is <c>null</c>.</exception>
        public AutoServiceFactory(IServiceContainer serviceContainer, String policy)
            : base(serviceContainer)
        {
            _Policy = policy;
        }

        /// <summary>
        /// Initializes a new instance of the <see cref="AutoServiceFactory&lt;T&gt;"/> class.
        /// </summary>
        /// <param name="serviceContainer">The service container involved.</param>
        /// <exception cref="ArgumentNullException"><paramref name="serviceContainer"/> is <c>null</c>.</exception>
        public AutoServiceFactory(IServiceContainer serviceContainer)
            : this(serviceContainer, null)
        {
            // Do nothing here
        }

        #endregion

        #region Public Properties

        /// <summary>
        /// Gets the policy that will be used when the service is resolved.
        /// </summary>
        public String Policy
        {
            get
            {
                return _Policy;
            }
        }

        #endregion

        #region IServiceFactory<T> Members

        /// <summary>
        /// Constructs a new service of the correct type and returns it.
        /// </summary>
        /// <returns>The created service.</returns>
        public IService<T> Create()
        {
            return MyServiceContainer.Resolve<T>(_Policy);
        }

        #endregion
    }
} 
```

基本上，当我从我的服务容器构建器类构建服务容器时，所有服务注册都会自动获得另一个协同服务，为该服务实现 IServiceFactory，除非程序员已经为该服务明确注册了他/她自己。然后使用上述服务，其中一个参数指定策略（如果不使用策略，则可以为 null）。

这允许我这样做：

```
var builder = new ServiceContainerBuilder();
builder.Register<ISomeService>()
    .From.ConcreteType<SomeService>();

using (var container = builder.Build())
{
    using (var factory = container.Resolve<IServiceFactory<ISomeService>>())
    {
        using (var service = factory.Instance.Create())
        {
            service.Instance.DoSomethingAwesomeHere();
        }
    }
} 
```

当然，更典型的用途是与您的 CD Burner 对象一起使用。在上面的代码中，我当然会解决服务，但它是对所发生情况的说明。

因此，请使用您的 cd 刻录机服务：

```
var builder = new ServiceContainerBuilder();
builder.Register<ICDBurner>()
    .From.ConcreteType<CDBurner>();
builder.Register<ISomeService>()
    .From.ConcreteType<SomeService>(); // constructor used in the top of answer

using (var container = builder.Build())
{
    using (var service = container.Resolve<ISomeService>())
    {
        service.Instance.DoSomethingHere();
    }
} 
```

在服务内部，您现在可以拥有一项服务，即工厂服务，它知道如何根据请求解决您的 cd 刻录机服务。这很有用，原因如下：

*   您可能希望同时解决多个服务（同时刻录两张光盘？）
*   您可能不需要它，而且创建它的成本可能很高，因此您仅*在*需要时才解决它
*   您可能需要多次解决、处置、解决、处置，而不是希望/尝试清理现有服务实例
*   您还在构造函数中标记您*需要*哪些服务以及您*可能需要哪些服务*

这里同时有两个：

```
using (var service1 = container.Resolve<ISomeService>())
using (var service2 = container.Resolve<ISomeService>())
{
    service1.Instance.DoSomethingHere();
    service2.Instance.DoSomethingHere();
} 
```

这是两个一个接一个，而不是重复使用相同的服务：

```
using (var service = container.Resolve<ISomeService>())
{
    service.Instance.DoSomethingHere();
}
using (var service = container.Resolve<ISomeService>())
{
    service.Instance.DoSomethingElseHere();
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-12T12:13:31.310

**第一的：**

您可以通过创建一个容器来保存您的“无趣”依赖项（ILog、ICache、IApplicationSettings 等）来处理它，并使用构造函数注入将其注入，然后在构造函数内部，从 container.Resolve( ) ? 我不确定我是否愿意，但是，嗯，这是一种可能性。

或者，您可能希望使用新的 IServiceLocator 通用接口 ( [http://blogs.msdn.com/gblock/archive/2008/10/02/iservicelocator-a-step-toward-ioc-container-service-locator-detente .aspx](http://blogs.msdn.com/gblock/archive/2008/10/02/iservicelocator-a-step-toward-ioc-container-service-locator-detente.aspx) ) 而不是注入依赖项？

**第二：**

您可以将 setter 注入用于可选/按需依赖项吗？我想我会去注入工厂并按需从那里新建。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T08:41:00.083

为了部分回答我的**第一个**问题，我刚刚找到了Jeremy Miller 的[一篇博](http://codebetter.com/blogs/jeremy.miller/archive/2008/10/08/setter-injection-in-structuremap-2-5.aspx)文，展示了如何使用结构映射和设置器注入来自动填充对象的公共属性。他以 ILogger 为例：

```
var container = new Container(r =>
{
    r.FillAllPropertiesOfType<ILogger>().TheDefault.Is
        .ConstructedBy(context => new Logger(context.ParentType));
}); 
```

这意味着任何具有 ILogger 属性的类，例如：

```
public class ClassWithLogger
{
    public ILogger Logger { get; set; }
}

public class ClassWithLogger2
{
    public ILogger Logger { get; set; }
} 
```

构造时将自动设置其 Logger 属性：

```
container.GetInstance<ClassWithLogger>(); 
```

# language-agnostic - 班员组织

> ID：194538
> 
> 赞同：6
> 
> 时间：2008-10-11T20:05:25.320
> 
> 标签：language-agnostic, coding-style, class

对班级成员进行排序的最佳方法是什么？

我在这件事上与一名团队成员发生冲突。他建议我们应该按字母顺序对成员进行排序。我认为最好以语义的方式组织：重要属性优先，相关方法放在一起等。

你怎么看？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-11T20:08:49.387

我喜欢语义。按字母顺序对我来说似乎没有多大意义，因为当你在寻找一个成员时，你很少知道它到底叫什么。此外，如果您使用任何类型的命名约定（例如：匈牙利语），字母顺序将导致按类型分组，这可能不是您想要的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T20:10:57.383

将相关的班级成员分组在一起。我认为这将有助于其他程序员在第一次看到您的界面时更容易理解它。

有些人还发现将访问器和修饰符组织在单独的部分中很有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T20:17:16.373

作为硕士论文的一部分，我已经研究了这个确切的问题。

按字母顺序排列的组织或基于公共/私人的组织更适合能够找到特定的事物。但是，在某些 IDE 中，您可以将大纲工具设置为按字母顺序排序，并为公共/私有使用特殊指标。

我的方法是根据使用的成员对方法进行分组：使用相同字段的方法之间通常存在概念上的联系。

实际上，我从中创建了一个可视化，这有助于快速导航和理解大型类的结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T20:19:42.733

这只是我的观点，我相信它会不受欢迎，但语义排序的问题是它的主观性。每个人对于哪些方法应该紧密结合会有不同的看法。

Alphabetical 的优势在于它完全是客观的。它还减少了小变化的大差异，这在一个编码器选择不同的语义排序时很常见。

大多数 IDE 都有大纲或超链接，以使导航更容易。

编辑：澄清 - 我仍然先从公共到私人排序，但在同一访问级别内按字母顺序排列。事实上，我不做任何排序——我让我的 IDE 在保存时为我处理文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-11T20:23:26.203

我从不通过查看代码来寻找成员。当我想跳转到成员定义时，我要么从导航栏/文档大纲/类视图中选择它，要么右键单击并选择“跳转到定义”。如果您有一个不错的 IDE，则不需要对成员进行排序。这在 Visual Studio 和我在需要时使用的另一个 IDE 中非常有效，KDevelop 至少支持这方面的基础知识。

无论如何，我倾向于按功能对成员进行分组，即属于某些特定功能的所有字段/属性/方法都放在一起。而且由于课程不应该太长，这就足够了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T07:34:23.153

假设您使用的是现代 IDE，只需单击两次鼠标即可找到所需的方法，因此我不确定采用特定的方法组织方法会给您带来什么。我确实使用了 stylecop ( [http://code.msdn.microsoft.com/sourceanalysis](http://code.msdn.microsoft.com/sourceanalysis) )，它让我按公共/私有/方法/属性排序 - 我发现这已经足够了。

我真正认为这很重要的唯一一次是我编写了一个非常大的 jscript 程序，而当时的编辑器在查找函数时没有提供任何帮助。按字母顺序排列非常有帮助。字母化后，不难确定您需要在文件中的哪个方向查找方法。语义组织完全没有帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T08:39:15.270

在更高的层次上，我会这样组织我的课程：

1.  构造函数
2.  析构函数
3.  私有字段
4.  特性
5.  方法/功能

然后对于方法/功能，我将按功能再次对其进行分解。例如，我会将实现接口的方法放在一个区域中，我会将事件处理程序方法放在一个区域中，等等...

[温迪](http://www.rwendi.com "温迪")

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T21:15:03.637

你在写电话簿吗？

使用语义方法，您可以轻松地展示最重要的方法。我通常先使用构造函数，析构函数，然后是重要方法，然后是 getter 和 setter，最后是杂项。方法。最后，我对内部部分（私有方法、属性......）采取了类似的方法。

字母顺序不会传达有关您的班级的任何有用信息。如果您真的想查看按字母顺序排序的方法，您应该依赖 IDE 的功能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-11T21:56:50.120

您可以通过在 IDE 中对“方法显示”进行排序来从语义转换为字母。

你不能（自动）从字母到语义。

因此：语义。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-20T03:25:37.790

我想我是喜欢按字母顺序排列的古怪案例之一。

首先，根据我的经验，将方法“语义”组合在一起往往会浪费时间。现在，如果我们正在讨论按范围/可见性对它们进行分组，那是另一回事。但是，如果成员更改了它的范围，您必须花时间移动成员以保持代码最新。我不想浪费时间改组代码来遵守这样的准则。

我也不是地区的忠实粉丝。当按范围对属性和方法进行分组时，它们往往会在一个区域中大喊大叫。但是在折叠区域中包含代码往往会隐藏写得不好的代码。只要您不必查看它，您就不会费心考虑重构它以使其可维护。

所以，我赞成按字母顺序排列。它简单、直接、切中要害。我不想将组封闭到区域中。而且由于 IDE 可以很容易地跳转到函数或属性定义，因此代码的物理布局没有实际意义。过去，您希望人们*首先*关注您的公共成员。现代 IDE 使这在很大程度上成为支持基于范围的布局的毫无意义的论据。

但字母布局的最大优势在于：*在代码审查期间打印代码示例。*我经常使用它们。它使查找函数或属性变得轻而易举。如果您曾经不得不费力地翻阅大量代码来查找函数或属性，而不仅仅是按字母顺序列出的内容，那么您就会知道我在说什么。

但是，正如他们所说，这些是*我*对这个主题的主观看法。你的旅费可能会改变。

# coldfusion - 有人用过vinpower吗？

> ID：194565
> 
> 赞同：0
> 
> 时间：2008-10-11T20:20:07.473
> 
> 标签：coldfusion, vin

我必须实现 VinPower 应用程序。他们提供 Java 版本、C dll 和 ActiveX dll，如果有人知道我可以从哪里开始，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T00:48:35.827

第一步是将 VinPOWER Jar 文件放入您的 lib 目录，然后重新启动服务器。
（或者，您可以将文件放在不同的目录中，然后在 CF Administrator 中添加路径）

然后使用它......好吧，这是他们在 CFML 中的 Java 示例：

```
<cfset vp = createObject("java","com.pki.vp4j.VinPower") />

<cfset rc = vp.decodeVIN("JTEDP21A650046919") />

<cfif rc>
    <cfoutput>#vp.getAsXML()#</cfoutput>
</cfif> 
```

试一试，看看你得到了什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T20:27:19.050

快速谷歌搜索显示有[Vinpower](http://www.vinpowerdigital.com)和[VinPOWER](http://www.vinpower.com)。你指的是哪一个？

当您说“实现”时，您是否正在考虑编写自己的库来与现有产品做同样的事情？或者您的意思是说“集成”您需要在现有项目中使用第三方库的地方？

如果您的目标是集成，并且供应商为不同的接口提供不同版本的库，我会选择最容易与您现有项目集成的库。例如，如果您的代码已经在 J​​ava 中，那么我会选择他们库的 Java 版本。如果您的代码在 Visual Basic 中，那么最好使用 ActiveX dll。

# php - 使用 PHP DOM 在 XML 文件中插入数据

> ID：194574
> 
> 赞同：6
> 
> 时间：2008-10-11T20:24:40.040
> 
> 标签：php, xml, dom

我试图将新数据插入现有的 XML 文件，但它不起作用。这是我的xml文件：

```
<list>
    <activity>swimming</activity>
    <activity>running</activity>
<list> 
```

现在，我的想法是制作两个文件：一个索引页面，它显示文件上的内容并提供一个用于插入新元素的字段，以及一个将数据插入 XML 文件的 php 页面。下面是 index.php 的代码：

```
<html>
<head><title>test</title></head>
</head>

<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml', LIBXML_NOBLANKS);

    $activities = = $xmldoc->firstChild->firstChild;
    if($activities!=null){
        while(activities!=null){
            echo $activities->textContent.'<br/>';
            activities = activities->nextSibling.
        }
    }
?>

<form name='input' action='insert.php' method='post'>
    insert activity:
    <input type='text' name='activity'/>
    <input type='submit' value='send'/>
</form>
</body>
</html 
```

这是 insert.php 的代码：

```
<?php
    header('Location:index.php');
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml');

    $newAct = $_POST['activity'];

    $root = $xmldoc->firstChild;

    $newElement = $xmldoc->createElement('activity');
    $root->appendChild($newElement);
    $newText = $xmldoc->createTextNode($newAct);
    $newElement->appendChild($newText);

    $xmldoc->save('sample.xml');
?> 
```

用户将访问 index.php，他将在其中看到 XML 文件中当前活动的列表，以及可以插入新活动的文本字段。单击发送按钮后，页面将调用 insert.php，其中包含在 DOM 树中打开 XML 文件的代码，在根节点下插入一个新节点并回调 index.php 页面，用户应该在该页面能够看到活动列表，他的新活动在其他人之下。它不工作。当我单击按钮提交新条目时，页面刷新并且显然没有任何反应，XML 与以前相同。我做错什么了？另外，我想知道是否有更好的方法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-11T21:01:06.737

您的代码块是从现有文件中复制和粘贴的吗？如果是这样，我看到两个潜在的问题：

```
<form name='input' action'insert.php' method='post'> // should be:
<form name="input" action="insert.php" method="post"> 
```

注意：您缺少`action`**=**`"insert.php"`，这将导致表单仅重新加载而不提交，这是您描述的行为。

其次，确保您对“sample.xml”具有写入权限。你可以确认你是否真的在写任何东西：

```
print 'I wrote '.$xmldoc->save('sample.xml').' bytes of data'; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-27T03:25:39.167

最终解决方案

**样本.XML**

```
<list>
    <activity>swimming</activity>
    <activity>running</activity>
    <activity>Jogging</activity>
    <activity>Theatre</activity>
    <activity>Programming</activity>
</list> 
```

**索引.php**

```
<html>
<head><title>test</title></head>
</head>

<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load("sample.xml", LIBXML_NOBLANKS);

    $activities = $xmldoc->firstChild->firstChild;
    if($activities!=null){
        while($activities!=null){
            echo $activities->textContent."<br/>";
            $activities = $activities->nextSibling;
        }
    }
?>

<form name="input" action="insert.php" method="post">
    insert activity:
    <input type="text" name="activity"/>
    <input type="submit" value="send"/>
</form>
</body>
</html> 
```

**插入.php**

```
<?php
    header('Location:index.php');
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml');

    $newAct = $_POST['activity'];

    $root = $xmldoc->firstChild;

    $newElement = $xmldoc->createElement('activity');
    $root->appendChild($newElement);
    $newText = $xmldoc->createTextNode($newAct);
    $newElement->appendChild($newText);

    $xmldoc->save('sample.xml');
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T13:34:38.120

$newText = $xmldoc->createTextNode($newActv);

将此行更改为

$newText = $xmldoc->createTextNode($newAct);

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-02T08:25:52.620

实际上你在两个地方犯了错误。

我认为这条线应该是因为错字，你错过了一个等号。还

这些行应该是

立即尝试，它应该可以工作，Hop 这会有些道理

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T02:57:31.063

我想我知道你的代码有什么问题。你不应该这样写：`<?xml-stylesheet type="text/xsl" href="sample.xsl" ?>` 正确的代码是：

```
<?xml:stylesheet type="text/xsl" href="sample.xsl" ?> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-18T17:05:12.550

这是我为我工作的代码。

索引.php

```
<html>
<head><title>test</title></head>
</head>

<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml', LIBXML_NOBLANKS);

    $activities = $xmldoc->firstChild->firstChild;
    if($activities!=null){
        while($activities!=null){
            echo $activities->textContent.'<br/>';
            $activities = $activities->nextSibling;
        }
    }
?>

<form name='input' action='insert.php' method='post'>
    insert activity:
    <input type='text' name='activity'/>
    <input type='submit' value='send'/>
</form>
</body>
</html>

insert.php

<?php
    header('Location:index.php');
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml');

    $newAct = $_POST['activity'];

    $root = $xmldoc->firstChild;

    $newElement = $xmldoc->createElement('activity');
    $root->appendChild($newElement);
    $newText = $xmldoc->createTextNode($newAct);
    $newElement->appendChild($newText);

    $xmldoc->save('sample.xml');
?> 
```

示例.xml

```
<list>
  <activity>swimming</activity> 
  <activity>running</activity> 
</list> 
```

# virtual-machine - 将内部 DSL 转换为外部 DSL 反模式吗？

> ID：194576
> 
> 赞同：1
> 
> 时间：2008-10-11T20:25:19.477
> 
> 标签：virtual-machine, dsl, oslo

在我们的遗留系统中，我们编写了自己的虚拟机来在运行时执行我们的内部 DSL。内部 VM 旨在仅运行我们的内部 DSL。我们正在重写我们的遗留应用程序。我们正在考虑的想法之一是将我们的内部 DSL 转换为外部 DSL（C# 或 Java）并利用他们的 VM。

何时为我们的内部 DSL 编写我们自己的 VM 与何时转换为外部 DSL 并在该 VM 上运行，并没有明确的指导方针。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T20:37:59.793

内部 DSL/VM 与外部 DSL/VM 决策与所有构建与购买与下载决策相同。对于所有软件，这些指南都很明确且相同。

为什么要支持您自己的 VM，而其他人会为您支持 Java 或 Python？

这里有一些明确的指导方针。请注意，这些是所有软件的相同准则。

1.  您继续维护自己的软件是否更便宜。在这种情况下，DSL和VM？

2.  你自己的 DSL 和 VM 是否比 Java 或 Python 更好？通过“更好”，您必须填写质量因素的任意组合：更快、更小、更可靠、更好的功能、更少的资源使用、更可审计、更安全等。

不要被 DSL 和 VM 所迷惑。没什么特别的；它只是更多的软件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-12T18:31:52.317

这绝对不是反模式。与内部 DSL 相比，外部 DSL 具有许多优势。在您的情况下，独立于宿主语言或实现平台就是其中之一。其他好处是更好的语法灵活性、使用模型驱动方法（如模型转换、模型查看等）的可能性。

# php - 如何检测用户何时成功完成在php中下载文件

> ID：194579
> 
> 赞同：9
> 
> 时间：2008-10-11T20:27:07.367
> 
> 标签：php, http-headers, attachment

我有一个处理文件下载请求的 php 页面。我需要能够检测文件何时成功下载。如何才能做到这一点？也许有一些方法可以检测到这个客户端，然后将确认发送到服务器。

谢谢。

编辑：通过句柄，我的意思是页面正在做这样的事情：

```
$file = '/var/www/html/file-to-download.xyz';
  header('Content-Type: application/octet-stream');
  header('Content-Length: ' . filesize($file));
  header('Content-Disposition: attachment; filename=' . basename($file));
  readfile($file); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-11T20:48:28.993

在单独的 php 脚本中处理下载（最好多做一点`readfile($file);`，您还可以像在这个[问题](https://stackoverflow.com/questions/157318/resumable-downloads-when-using-php-to-send-the-file)中一样提供恢复下载的能力）。然后在这个脚本中，当您*读取*最后一个块并发送它时，您就知道所有文件都已发送。这与知道所有内容都已收到不同，但对于大多数情况来说应该足够了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T23:02:45.010

Treb 说了什么，但我应该补充一点，您可以使用[connection_status()](http://nl3.php.net/connection_status)检查客户端在下载期间是否仍在侦听。

不要忘记`flush()`在将数据写入客户端后，它有助于检测连接是否仍然正常。

# php - 如何在不使用框架的情况下编写好的 PHP 代码？

> ID：194584
> 
> 赞同：40
> 
> 时间：2008-10-11T20:30:07.767
> 
> 标签：php

除了标准的 OO 概念之外，还有哪些其他策略可以在不使用框架时生成良好、干净的 PHP 代码？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-12T11:40:49.753

请记住：MVC、OOP 和层是设计概念，不是语言结构，也不是文件结构。

对我来说，这意味着当不使用框架时，并且没有不同的团队进行编程和设计时；在PHP（这是一种模板语言）之上使用*另一个*模板系统没有任何价值。此外，将代码与布局分开并不一定意味着在不同的文件上进行。

这就是我曾经为一次性的、很少扩展的 PHP Web 应用程序做的事情：

1.  编写一个“通用实用程序”文件，在那里我放了一些格式化/清理功能，以及一些数据库访问功能：
    1.  getquery()：给定一个 SQL，返回一个结果对象
        *   getrecord()：给定一个 SQL，返回一个记录对象（并关闭查询）
        *   getdatum()：给定一个 SQL，返回一个字段（并关闭查询）
        *   将所有配置（数据库访问、一些 URL 前缀等）放在“config.php”文件中
        *   为存储在数据库中的每个对象编写一个模型层，一个文件或一个文件。那里将有所有 SQL 常量，基于您的概念对象，而不是数据库记录，呈现更高级别的 API。

那是你的“框架”，然后你编写“演示”层：

4.  每个页面都有一个 PHP 文件，从一些*简单*的代码开始获取所需的对象，然后是带有交叉 PHP 代码的 HTML，只是为了“填补漏洞”。除了极少数例外，最复杂的代码应该是 for 循环。我规定只使用单行，`?>`应该与开头在同一行`<?php`

    *   每个数据输入表单都应该指向一个没有任何 HTML 的小型 PHP，它只是获取 POST 数据，进入数据库，然后转发到调用页面。

就是这样。如果单独工作，它具有您需要的所有意图分离，而不会淹没在单个用户操作的大量文件中。用户看到的每个页面都由一个 PHP 文件管理。

它甚至很容易维护，几个月后不用看代码，因为很容易测试应用程序，记下浏览器 URL 字段中的文件名。这将直接引导您访问相关代码。

（当然，现在我几乎在所有事情上都使用 Django……）

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-11T20:39:30.523

我会说与任何其他语言几乎相同：

*   不要过早优化
*   保持方法小
*   练习 DRY
*   练习数据驱动的编程
*   使用合理的快捷方式（例如三元运算符）
*   正确格式化您的代码，以便其他人可以理解
*   不要盲目使用OO
*   始终检查返回码是否有错误
*   启用最高警告级别并确保您的代码不会产生任何警告
*   当涉及到打字问题时要*非常小心（这适用于所有弱类型语言）。*'===' 运算符是你的朋友。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-12T10:23:38.397

如果您发现自己混合了 HTML 和代码，请停止。你，嗯…… [你做错了！http://dennisjudd.com/albums/cute_cats/wrong_mike.jpg](http://dennisjudd.com/albums/cute_cats/wrong_mike.jpg)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-11T20:37:55.740

确实，这个问题与语言无关，因为它适用于您选择“自己动手”的大多数语言。我会提出两个建议：

首先，仅仅因为您没有使用框架并不意味着您不能采用分离代码的模式。MVC 模式是您在安排源代码时应考虑的最低要求 - 它使源代码的集合更加清洁和易于维护，即使应用程序不完全遵循与框架相关的路由过程，具有“ “做”的东西与“代表”的东西分开是非常有益的。

其次，仅仅因为您选择不使用完整的框架，并不意味着您需要重新发明轮子。明智地利用预打包的库来解决特定问题。两个很好的例子是日志框架（log4php）和前端渲染/模板解决方案（Smarty）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-11T20:36:13.887

尽可能远离全局变量 :-D

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-11T20:42:48.177

如果您确实遵循 OO 概念，例如关注点分离，您的代码会非常好，但这里有一些建议：

*   框架与否，使用 MVC。
*   我怎么强调都不要把你的逻辑和你的 HTML 混在一起是多么重要。在 HTML 文件中，PHP 只能用作模板语言，仅此而已。
*   使用 DBAL。
*   将您的设计与内容分开。一种常见的方法是大量使用 CSS 并使用包含大量站点布局的页眉和页脚文件。
*   为选项常量提供一个文件，例如 DB 凭据、FTP 凭据等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-11T20:37:16.147

确保遵循关注点分离的标准做法。这意味着尽量不要将您的业务和数据层与您的 UI 混合。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-11T20:41:21.287

即使您不使用框架，也请使用模板引擎。通过使用模板，您将分离应用程序的逻辑和表示。然后像使用任何其他语言一样设计、编码和格式化逻辑部分。让“设计师”设计用户界面 :)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-11T20:41:50.880

OO 不是绝对必要的：用 PHP < 5 编写好的代码也是可能的。良好的程序代码，通过“逻辑距离”很好地分隔成文件和目录也应该保证你的安全。但是请注意，这从远处开始类似于 OO。

最好的办法是保持一致：我见过一个项目，其中 Smarty 用于大多数页面，除了一个 - 最复杂的，去图 -。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-12T11:10:13.293

利用 PHP 的内置扩展 - 例如 MySQLi。随着这些变得更加面向对象，对框架的要求变得越来越少。

例如，我可以通过使用以下扩展来创建一个有用的 TwitterApp，并且除了核心类之外没有任何实际框架来将实例绑定在一起。

*   用于数据库的 MySQLi（如果需要 DAL，则为 PDO）
*   用于 RSS/API 读取的 SimpleXML
*   用于模板的 Smarty

我可能需要为诸如 Login 之类的东西创建一些帮助类，但我常用的一对类（DAL 和 TPL）被两个运行良好的扩展淘汰了。

# asp.net - 通过互联网控制机器人

> ID：194593
> 
> 赞同：-1
> 
> 时间：2008-10-11T20:36:50.170
> 
> 标签：asp.net, .net, controls, robot

我有机器人，想通过互联网使用无线电波控制它。但我仍然不知道最好的语言来做到这一点。需要建立安全站点以确保没有任何人可以使用它。我期望使用 c# 的站点 asp，但是我需要它来控制从发送设备到接收机器人的语言是什么。还需要从机器人摄像机将实时视频传输到现场............打扰了......我知道这可能是错的，但我是初学者

感谢所有阅读或尝试帮助我的人

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T20:41:46.247

我认为最好在选择编程语言之前缩小您对技术的选择范围。机器人控制可能是一个非常复杂的主题，并且有很多方法可以解决相同的问题。

话虽如此，使用您列出的组件：

*   安全的互联网接口
*   与自主机器人的射频通信
*   嵌入式机器人控制软件
*   视频处理、压缩和解压
*   向互联网访问者展示视频

我猜想您的完整解决方案将涉及至少两种或三种不同的编程语言，具体取决于应用程序和环境。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T20:52:51.387

可能值得看一下[Microsoft Robotics Studio](http://msdn.microsoft.com/en-us/robotics/default.aspx)，为您提供一个可以使用的框架示例。通常，所有各种控制器等都“交谈”不同的语言，因此您可以使用机器人工作室之类的东西将它们全部联系在一起，这样您就可以以一种共同的方式与它们交谈。

不过，对于初学者来说，这是一项艰巨的任务，除了选择一种语言之外，还有更多的事情要考虑:-)

# .net - 如何判断 .NET 应用程序是在 DEBUG 还是 RELEASE 模式下编译的？

> ID：194616
> 
> 赞同：45
> 
> 时间：2008-10-11T20:47:03.927
> 
> 标签：.net, executable, debug-symbols, compiler-options

我的电脑上安装了一个应用程序。如何确定它是否在 DEBUG 模式下编译？

我尝试使用[.NET Reflector](http://en.wikipedia.org/wiki/.NET_Reflector)，但它没有显示任何具体内容。这是我看到的：

```
// Assembly APPLICATION_NAME, Version 8.0.0.15072
Location: C:\APPLICATION_FOLDER\APPLICATION_NAME.exe
Name: APPLICATION_NAME, Version=8.0.0.15072, Culture=neutral, PublicKeyToken=null
Type: Windows Application 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-11T20:53:32.773

我很久以前[写过这个，我不知道它是否仍然有效，但代码类似于......](http://chillijam.co.uk/?p=134)

```
private void testfile(string file)
{
    if(isAssemblyDebugBuild(file))
    {
        MessageBox.Show(String.Format("{0} seems to be a debug build",file));
    }
    else
    {
        MessageBox.Show(String.Format("{0} seems to be a release build",file));
    }
}    

private bool isAssemblyDebugBuild(string filename)
{
    return isAssemblyDebugBuild(System.Reflection.Assembly.LoadFile(filename));    
}    

private bool isAssemblyDebugBuild(System.Reflection.Assembly assemb)
{
    bool retVal = false;
    foreach(object att in assemb.GetCustomAttributes(false))
    {
        if(att.GetType() == System.Type.GetType("System.Diagnostics.DebuggableAttribute"))
        {
            retVal = ((System.Diagnostics.DebuggableAttribute)att).IsJITTrackingEnabled;
        }
    }
    return retVal;
} 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-03-15T18:42:29.853

ZombieSheep 的回答不正确。

我对这个重复问题的回答在这里：[如何判断 .NET 应用程序是在 DEBUG 还是 RELEASE 模式下编译的？](https://stackoverflow.com/questions/798971/how-to-identify-if-the-dll-is-debug-or-release-build-in-net/5316565#5316565)

要非常小心 - 仅查看程序集清单中的“程序集属性”是否存在“可调试”属性并不**意味着**您有一个未经过 JIT 优化的程序集。程序集可以进行 JIT 优化，但将高级构建设置下的程序集输出设置为包含“完整”或“仅 pdb”信息 - 在这种情况下，将存在“可调试”属性。

请参阅下面的帖子以获取更多信息： [如何判断程序集是调试版还是发布版](http://dave-black.blogspot.com/2011/12/how-to-tell-if-assembly-is-debug-or.html)以及 [如何识别 DLL 是调试版还是发布版（在 .NET 中）](https://stackoverflow.com/questions/798971/how-to-idenfiy-if-the-dll-is-debug-or-release-build-in-net/5316565#5316565)

Jeff Key 的应用程序无法正常工作，因为它根据 DebuggableAttribute 是否存在来识别“调试”构建。如果您在发布模式下编译并将 DebugOutput 选择为“none”以外的任何内容，则会出现 DebuggableAttribute。

您还需要明确定义“调试”与“发布”的含义*......*

*   你的意思是应用程序配置了代码优化？
*   您的意思是可以将 Visual Studio/JIT 调试器附加到它吗？
*   你的意思是它会生成DebugOutput吗？
*   你的意思是它定义了 DEBUG 常量吗？请记住，您可以使用该`System.Diagnostics.Conditional()`属性有条件地编译方法。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-11T20:59:21.483

你实际上是在正确的道路上。如果您在反射器中查看反汇编器窗口，如果它是在调试模式下构建的，您将看到以下行：

```
[assembly: Debuggable(...)] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-12T11:34:11.407

使用 Jeff Key 的[IsDebug](http://www.sliver.com/dotnet/IsDebug/)实用程序怎么样？它有点过时了，但是由于你有 Reflector，你可以反编译它并在任何版本的框架中重新编译它。我做到了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-04T15:34:15.277

这是ZombieSheep提出的解决方案的VB.Net版本

```
Public Shared Function IsDebug(Assem As [Assembly]) As Boolean
    For Each attrib In Assem.GetCustomAttributes(False)
        If TypeOf attrib Is System.Diagnostics.DebuggableAttribute Then
            Return DirectCast(attrib, System.Diagnostics.DebuggableAttribute).IsJITTrackingEnabled
        End If
    Next

    Return False
End Function

Public Shared Function IsThisAssemblyDebug() As Boolean
    Return IsDebug([Assembly].GetCallingAssembly)
End Function 
```

**更新**
此解决方案对我有用，但正如 Dave Black 指出的那样，可能存在需要不同方法的情况。
所以也许你也可以看看戴夫布莱克的答案：

*   [如何识别 DLL 是 Debug 还是 Release 构建（在 .NET 中）](https://stackoverflow.com/questions/798971/how-to-identify-if-the-dll-is-debug-or-release-build-in-net/5316565#5316565)
*   [如何判断 .NET 应用程序是在 DEBUG 还是 RELEASE 模式下编译的？](https://stackoverflow.com/questions/194616/how-to-tell-if-a-net-application-was-compiled-in-debug-or-release-mode/5316442#5316442)

# c++ - 正在寻找 C/C++ 中的开源 Traveling Salesman 函数/库？

> ID：194621
> 
> 赞同：6
> 
> 时间：2008-10-11T20:51:48.457
> 
> 标签：c++, c, gpl, traveling-salesman

我知道那里有几个不同的[旅行推销员项目，我和](http://en.wikipedia.org/wiki/Traveling_salesman_problem)[LKH](http://www.akira.ruc.dk/~keld/research/LKH/)玩过一些，但我想知道是否有人对其他项目有任何建议？

我的项目是 GPL 的，所以我需要与该许可证兼容的东西。

![输入](https://i.stack.imgur.com/6WnwE.gif) ![输出](https://i.stack.imgur.com/lAUwq.gif)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T09:36:01.563

一般来说，[空间填充分形](http://en.wikipedia.org/wiki/Special:Search?search=space+filling+fractal)会以最低的成本为您提供一些最佳结果。

特别是，我会推荐[Sierpiński 曲线](http://en.wikipedia.org/wiki/Sierpi%C5%84ski_curve)。

这是一个使用它的示例实现：

```
(defvar *grid-width* 100000)
(defvar *grid-heigth* 100000)
(defvar *max-number-of-points* 1000)
(defvar *search-area-width* (* 2 *grid-width*))
(defvar *search-area-heigth* (* 2 *grid-heigth*))

(defun make-random-point (max-x max-y)
    "makes a point in a random position of the grid"
    (complex
        (/ (random (* max-x 1000)) 1000)
        (/ (random (* max-y 1000)) 1000)))

(defun make-random-point-list (max-len)
    "makes a list of random points up to max-len length"
     (let   ((value ()))    ; Make a set of random points
         (dotimes (n (random max-len) value)
            (setq value
                (cons (make-random-point *grid-width* *grid-heigth*) value)))))

(defun get-printable-point-position (point)
    "Gets a rounded-off point that can be used to make a dot on a visual grid"
    (complex
        (round (realpart point))
        (round (imagpart point))))

(defun euclid (point-a point-b)
    "calculates the euclidean distance in between two points"
    (let*   ((p (- point-a point-b)))
        (sqrt
            (+  (expt (realpart p) 2)
                (expt (imagpart p) 2)))))

(defstruct triangle
    "A triangle consists of 3 points.
    Complex numbers are used to construct the points,
    the real part signifying the X axis,
    and the imaginary part signifying the Y axis."
    a b c)

(defun avg (&rest numbers)
    "Gets the average of the numbers provided"
    (if
        (null numbers)
        1   ; prevents divide by 0
        (/ (apply #'+ numbers) (length numbers)))) ;/

(defun get-triangle-centre (triangle)
    "Gets the centre of a triangle"
    (avg (triangle-a triangle)
         (triangle-b triangle)
         (triangle-c triangle)))

(defstruct (triangle-list
        (:include triangle))
    point-list)

(defun triangle-split (triangle)
    "Splits a triangle in two according to the rule:
    { a0->c1; b0->a1,c2; c0->a2; avg(c0,a0)->b1,b2 }"
    (let*  ((old-a-point (triangle-a triangle))
            (old-b-point (triangle-b triangle))
            (old-c-point (triangle-c triangle))
            (new-b-point (avg old-a-point old-c-point)))
        (list
            (make-triangle-list :a old-b-point :b new-b-point :c old-a-point)
            (make-triangle-list :a old-c-point :b new-b-point :c old-b-point))))

(defun triangle-list-split (triangle-list)
    "Split a triangle list and acomodate all the points in their right places"
    (let*  ((triangles  (triangle-split triangle-list))
            (triangle-a (car triangles))
            (triangle-b (cadr triangles))
            (centre-a   (get-triangle-centre triangle-a))
            (centre-b   (get-triangle-centre triangle-b)))
        (dolist (point (triangle-list-point-list triangle-list))
            (if (< (euclid point centre-a) (euclid point centre-b))
                (setf (triangle-list-point-list triangle-a)
                    (cons point (triangle-list-point-list triangle-a)))
                (setf (triangle-list-point-list triangle-b)
                    (cons point (triangle-list-point-list triangle-b)))))
        (let   ((list-a (triangle-list-point-list triangle-a))
                (list-b (triangle-list-point-list triangle-b)))
            (if (= 1 (length list-a))
                (setf (triangle-list-point-list triangle-a) (car list-a)))
            (if (= 1 (length list-b))
                (setf (triangle-list-point-list triangle-b) (car list-b))))
        (list triangle-a triangle-b)))

(defun print-point (out point &rest args)
    "Utility function - Pretty-prints a point"
    (format out "(X:~F, Y:~F)"
        (realpart point)
        (imagpart point))
    args)

(defun pprint-triangle-list (out triangle-list &rest args)
    "Utility function - Pretty-prints a triangle-list object"
    (format out "   TRIANGLE{
        A:~/print-point/
        B:~/print-point/
        C:~/print-point/
        CENTRE:~/print-point/
        POINTS:{~{~/print-point/~^,~%                ~}}~&    }"
        (triangle-a triangle-list)
        (triangle-b triangle-list)
        (triangle-c triangle-list)
        (get-triangle-centre triangle-list)
        (let   ((points (triangle-list-point-list triangle-list)))
            (cond
                ((null points)  ())
                ((listp points) points)
                (t (list points)))))
    args)

(defun print-list-of-triangle-list (lst)
    "Pretty-prints a list of triangle-list objects"
    (format t "(~{~/pprint-triangle-list/~^,~% ~}~&)" lst))

(defun explode (lst)
    "explodes a triangle-list list and gets all
    the points in the order they should be"
    (let ((l (flatten lst)))
        (cond
            ((null l) ())
            ((triangle-list-p l) (explode (triangle-list-split l)))
            ((null (triangle-list-point-list (car l)))
                (explode (cdr l)))
            ((atom (triangle-list-point-list (car l)))
                (cons (car l) (explode (cdr l))))
            (t  (explode (append (triangle-list-split (car l)) (cdr l)))))))

(defun flatten (lst)
    "Flattens a list (removes nesting and nulls)"
    (cond
        ((atom lst) lst)
        ((listp (car lst))
            (append (flatten (car lst)) (flatten (cdr lst))))
        (t  (append (list (car lst)) (flatten (cdr lst))))))

(let   ((triangle (make-triangle-list
                :a          (complex 0 *search-area-heigth*)
                :b          0
                :c          *search-area-width*
                :point-list (make-random-point-list *max-number-of-points*))))
    (print-list-of-triangle-list (explode triangle))) 
```

我也有一个使用 GA 的版本（C 中的那个），但它存在于一个死硬盘中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T20:58:14.230

[这个](http://www.ics.forth.gr/~lourakis/levmar/)看起来不错。

我知道这不是一个很好的答案，但是如果您对不断变化的技术持开放态度，那么[scipy](http://scipy.org)有一堆非常好的优化算法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-29T21:00:13.080

[这里](http://www.cs.sunysb.edu/~algorith/implement/syslo/distrib/processed/babtsp.p)有一个可以完全解决 TSP，但它在 PASCAL 中。不过，在当前形式中，距离是整数。用 C++ 重写不应该太难。

# macos - 区分 HFS+ 和 HFS 标准卷

> ID：194628
> 
> 赞同：1
> 
> 时间：2008-10-11T20:55:53.283
> 
> 标签：macos, iokit, diskarbitration

IOKit 和 DiskArbitration 框架可以告诉我很多关于 Mac 上挂载卷的信息，但它们似乎无法区分 HFS+ 和 HFS 标准卷。

IOKit/DA 键`Content`，对于 HFS 标准卷和 HFS+ 卷，始终是 Apple_HFS 和 hfs `DAVolumeKind`。`DAMediaContent`

diskutil 和 DiskUtility.app*可以*区分，但我似乎没有被 Apple 开源。

ps statfs(2) 不区分

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-11T22:09:37.927

有两种方法可以做到这一点：

1.  用于`getattrlist()`检索`ATTR_VOL_SIGNATURE`卷的安装路径的属性。
2.  使用 Carbon 调用 FSGetVolumeInfo() 并查看`signature`返回结构的字段。

卷的签名是一个 16 位的值，通常解释为两个 ASCII 字符。HFS 的签名是'BD'，HFS+ 是'H+'，区分大小写的HFS+ 是'HX'。

手册页`getattrlist`说该字段是 u_int32，但 FSVolumeInfo 结构中的等效字段只有 16 位，所以我不确定 32 中的哪 16 位在使用时用签名填充`getattrlist`，你可能会有如果您想走非碳路线，请尝试一下。

[getattrlist 手册页](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/getattrlist.2.html "getattrlist 手册页")

[HFS Plus 卷格式参考](http://developer.apple.com/technotes/tn/tn1150.html)

[FSGetVolumeInfo](http://developer.apple.com/documentation/Carbon/Reference/File_Manager/Reference/reference.html#//apple_ref/c/func/FSGetVolumeInfo)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-15T09:13:51.717

除了`FSGetVolumeInfo()`返回`FSVolumeInfo`包含字段`signature`和`filesystemID`字段的 Carbon 之外，还有一个类的 Cocoa`-getFileSystemInfoForPath:`方法，`NSWorkspace`它返回文件系统类型的字符串表示：例如，`hfs`对于 HFS+ 和`msdos`对于 DOS FAT。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-13T23:45:25.493

如果您尝试直接读取分区映射，您可能会遇到的另一个问题是，从历史上看，HFS+ 卷嵌套在 HFS 包装器中。这样做是为了让任何尝试使用具有较旧操作系统的 HFS+ 磁盘的人都会在驱动器上看到一个文件，说明他们所有其余数据的位置。

# c++ - 字符串 c_str() 与 data()

> ID：194634
> 
> 赞同：130
> 
> 时间：2008-10-11T20:59:19.783
> 
> 标签：c++, stl, c-str

`c_str()`我已经阅读了几个地方，和`data()`（在 STL 和其他实现中）之间的区别在于`c_str()`它总是以空值终止，而`data()`不是。据我在实际实现中所见，它们要么做同样的事情，要么`data()`调用`c_str()`.

我在这里想念什么？在哪些场景中使用哪个更正确？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-10-11T21:01:15.550

文档是正确的。[`c_str()`](http://en.cppreference.com/w/cpp/string/basic_string/c_str)如果您想要一个以空字符结尾的字符串，请使用。

如果实现者碰巧[`data()`](http://en.cppreference.com/w/cpp/string/basic_string/data)按照`c_str()`您的方式实现，则不必担心，`data()`如果您不需要字符串为空终止，则仍然使用，在某些实现中它可能会比 c_str() 执行得更好。

字符串不一定必须由字符数据组成，它们可以由任何类型的元素组成。在那些情况下`data()`更有意义。`c_str()`在我看来，只有当你的字符串元素是基于字符的时才真正有用。

*额外*：从 C++11 开始，两个函数必须相同。ie`data`现在需要以空值结尾。根据[cppreference](http://en.cppreference.com/w/cpp/string/basic_string/data)：“返回的数组以空值结尾，即 data() 和 c_str() 执行相同的功能。”

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-09-13T04:41:20.793

在[C++11/C++0x](https://stackoverflow.com/questions/7747069/where-can-i-find-the-c11-standard-papers)`data()`中，`c_str()`不再不同。因此`data()`，最后也需要有一个空终止。

> 21.4.7.1`basic_string`访问器 [string.accessors]
> 
> `const charT* c_str() const noexcept;`
> 
> `const charT* data() const noexcept;`
> 
> 1 返回： 一个指针 p 使得`p + i == &operator[](i)`对于每个`i`in `[0,size()]`。

* * *

> 21.4.5 basic_string 元素访问 [string.access]
> 
> `const_reference operator[](size_type pos) const noexcept;`
> 
> 1 要求：pos <= size()。2 返回：`*(begin() + pos) if pos < size()`，否则对 T 类型对象的`charT();`引用，其值不应被修改。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-11T21:12:22.267

即使知道您已经看到它们做了同样的事情，或者 .data() 调用了 .c_str()，但假设其他编译器也会出现这种情况是不正确的。您的编译器也可能会随着未来的版本而改变。

**使用 std::string 的 2 个理由：**

std::string 可用于文本和任意二进制数据。

```
//Example 1
//Plain text:
std::string s1;
s1 = "abc";

//Example 2
//Arbitrary binary data:
std::string s2;
s2.append("a\0b\0b\0", 6); 
```

当您将字符串用作示例 1 时，您应该使用 .c_str() 方法。

当您使用字符串作为示例 2 时，您应该使用 .data() 方法。不是因为在这些情况下使用 .c_str() 是危险的，而是因为更明确的是您正在使用二进制数据以供其他人查看你的代码。

**使用 .data() 的可能陷阱**

以下代码是错误的，可能会导致您的程序出现段错误：

```
std::string s;
s = "abc";   
char sz[512]; 
strcpy(sz, s.data());//This could crash depending on the implementation of .data() 
```

**为什么实现者让 .data() 和 .c_str() 做同样的事情很常见？**

因为这样做效率更高。使 .data() 返回非空终止的唯一方法是让 .c_str() 或 .data() 复制它们的内部缓冲区，或者只使用 2 个缓冲区。拥有一个空终止缓冲区总是意味着您在实现 std::string 时总是可以只使用一个内部缓冲区。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-07-01T08:04:28.317

已经回答了，一些关于目的的注释：实施自由。

`std::string`操作——例如迭代、连接和元素突变——不需要零终止符。除非您将 传递`string`给期望以零结尾的字符串的函数，否则可以将其省略。

这将允许实现让子字符串共享实际字符串数据：`string::substr`可以在内部保存对共享字符串数据和开始/结束范围的引用，避免复制（和额外分配）实际字符串数据。该实现将推迟复制，直到您调用`c_str`或修改任何字符串。如果只是读取所涉及的子字符串，则不会制作任何副本。

（写时复制的实现在多线程环境中并不好玩，加上典型的内存/分配节省不值得今天更复杂的代码，所以很少这样做）。

* * *

类似地，`string::data`允许不同的内部表示，例如绳索（字符串段的链表）。这可以显着改进插入/替换操作。`c_str`同样，当您调用或时，必须将段列表折叠为单个段`data`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-05T13:04:42.587

引用自`ANSI ISO IEC 14882 2003`（C++03 标准）：

```
 21.3.6 basic_string string operations [lib.string.ops]

    const charT* c_str() const;

    Returns: A pointer to the initial element of an array of length size() + 1 whose first size() elements
equal the corresponding elements of the string controlled by *this and whose last element is a
null character specified by charT().
    Requires: The program shall not alter any of the values stored in the array. Nor shall the program treat the
returned value as a valid pointer value after any subsequent call to a non-const member function of the
class basic_string that designates the same object as this.

    const charT* data() const;

    Returns: If size() is nonzero, the member returns a pointer to the initial element of an array whose first
size() elements equal the corresponding elements of the string controlled by *this. If size() is
zero, the member returns a non-null pointer that is copyable and can have zero added to it.
    Requires: The program shall not alter any of the values stored in the character array. Nor shall the program
treat the returned value as a valid pointer value after any subsequent call to a non- const member
function of basic_string that designates the same object as this. 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-02-25T18:23:17.417

之前的所有评论都是一致的，但我还想补充一点，从 c++17 开始，str.data() 返回一个 char* 而不是 const char*

# javascript - 二维 Javascript 数组

> ID：194650
> 
> 赞同：7
> 
> 时间：2008-10-11T21:08:57.253
> 
> 标签：javascript, arrays, multidimensional-array

简而言之，有没有办法使用与此类似的语法来创建 2D javascript 数组？

```
var newArray = [
    [0, 1, 2],
    [3, 4, 5],
    [6, 7, 8]
] 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T01:46:07.690

您可以使用您在以下示例中建议的格式*创建*任何 n 维数组：

```
<script>
    var newArray = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8]
    ]
    var newArray3d =
        [[[ 0,  1,  2],[ 3,  4,  5],[ 6,  7,  8]],
         [[10, 11, 12],[13, 14, 15],[16, 17, 18]],
         [[20, 21, 22],[23, 24, 25],[26, 27, 28]]]
    alert(newArray[0]);
    alert(newArray[0][2]);
    alert(newArray3d[0]);
    alert(newArray3d[1][0]);
    alert(newArray3d[1][0][2]);
</script> 
```

警报框按顺序返回：

```
0,1,2
2
0,1,2,3,4,5,6,7,8
10,11,12
12 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T21:18:44.847

是的。这工作正常：

```
<script>
var newArray = [
    [0, 1, 2],
    [3, 4, 5],
    [6, 7, 8]
]
alert(newArray[0][2]);
</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T21:32:54.457

在 FF3、Opera 9、IE6 和 Chrome 中测试和工作。

# sql-server - T-SQL 中的 SQL Server 正则表达式

> ID：194652
> 
> 赞同：133
> 
> 时间：2008-10-11T21:10:18.090
> 
> 标签：sql-server, regex, tsql

是否有任何用 T-SQL（无 CLR、无扩展`SP`、纯 T-SQL）编写的用于 SQL Server 的正则表达式库，并且应该与共享主机一起使用？

编辑：

*   谢谢，我知道`PATINDEX`、`LIKE`和`xp_` `sps`CLR 解决方案
*   我也知道这不是正则表达式的最佳位置，问题是理论上的:)
*   减少的功能也被接受

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-13T20:49:14.373

[PATINDEX](http://msdn.microsoft.com/en-us/library/ms188395.aspx)函数怎么样？

TSQL 中的模式匹配不是一个完整的正则表达式库，但它为您提供了基础知识。

（来自在线书籍）

```
Wildcard  Meaning  
% Any string of zero or more characters.

_ Any single character.

[ ] Any single character within the specified range 
    (for example, [a-f]) or set (for example, [abcdef]).

[^] Any single character not within the specified range 
    (for example, [^a - f]) or set (for example, [^abcdef]). 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2015-06-16T20:13:59.370

如果有人有兴趣在 CLR 中使用正则表达式，这里有一个解决方案。如果模式匹配，则下面的函数 (C# .net 4.5) 返回 1，如果模式不匹配，则返回 0。我用它来标记子查询中的行。SQLfunction 属性告诉 sql server 这个方法是 SQL server 将使用的实际 UDF。将文件作为 dll 保存在您可以从 Management Studio 访问的位置。

```
// default using statements above
using System.Data.SqlClient;
using System.Data.SqlTypes;
using Microsoft.SqlServer.Server;
using System.Text.RegularExpressions;

namespace CLR_Functions
{   
    public class myFunctions
    {
        [SqlFunction]
        public static SqlInt16 RegexContain(SqlString text, SqlString pattern)
        {            
            SqlInt16 returnVal = 0;
            try
            {
                string myText = text.ToString();
                string myPattern = pattern.ToString();
                MatchCollection mc = Regex.Matches(myText, myPattern);
                if (mc.Count > 0)
                {
                    returnVal = 1;
                }
            }
            catch
            {
                returnVal = 0;
            }

            return returnVal;
        }
    }
} 
```

在管理工作室中通过可编程性导入 dll 文件 -- 程序集 -- 新程序集

然后运行这个查询：

```
CREATE FUNCTION RegexContain(@text NVARCHAR(50), @pattern NVARCHAR(50))
RETURNS smallint 
AS
EXTERNAL NAME CLR_Functions.[CLR_Functions.myFunctions].RegexContain 
```

然后，您应该可以通过存储程序集的数据库完全访问该函数。

然后在这样的查询中使用：

```
SELECT * 
FROM 
(
    SELECT
        DailyLog.Date,
        DailyLog.Researcher,
        DailyLog.team,
        DailyLog.field,
        DailyLog.EntityID,
        DailyLog.[From],
        DailyLog.[To],
        dbo.RegexContain(Researcher, '[\p{L}\s]+') as 'is null values'
    FROM [DailyOps].[dbo].[DailyLog]
) AS a
WHERE a.[is null values] = 0 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-11T22:13:23.113

通过使用 LIKE 可以进行一些基本的模式匹配，其中 % 匹配任意数量和字符组合，_ 匹配任意一个字符，而 [abc] 可以匹配 a、b 或 c ... [MSDN 站点](http://msdn.microsoft.com/en-us/library/ms179859.aspx)上有更多信息.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-06-03T18:43:09.793

如果其他人仍在查看这个问题，[http://www.sqlsharp.com/](http://www.sqlsharp.com/)是一种免费、*简单的方法，可以将正则表达式**CLR 函数***添加到您的数据库中。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-10-03T03:11:37.117

如果您使用的是 SQL Server 2016 或更高版本，则可以`sp_execute_external_script`与 R 一起使用。它具有正则表达式搜索的功能，例如`grep`和`grepl`。

这是电子邮件地址的示例。我将通过 SQL Server 数据库引擎查询一些“人”，将这些人的数据传递给 R，让 R 决定哪些人的电子邮件地址无效，然后让 R 将那部分人传回 SQL Server。“人”来自示例数据库`[Application].[People]`中的表。`[WideWorldImporters]`它们作为名为 的数据框传递给 R 引擎`InputDataSet`。R 使用带有“not”运算符（感叹号！）的 grepl 函数来查找哪些人的电子邮件地址与 RegEx 字符串搜索模式不匹配。

```
EXEC sp_execute_external_script 
 @language = N'R',
 @script = N' RegexWithR <- InputDataSet;
OutputDataSet <- RegexWithR[!grepl("([_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,4}))", RegexWithR$EmailAddress), ];',
 @input_data_1 = N'SELECT PersonID, FullName, EmailAddress FROM Application.People'
 WITH RESULT SETS (([PersonID] INT, [FullName] NVARCHAR(50), [EmailAddress] NVARCHAR(256))) 
```

请注意，必须在 SQL Server 主机上安装相应的功能。对于 SQL Server 2016，它被称为“SQL Server R Services”。对于 SQL Server 2017，它被重命名为“SQL Server 机器学习服务”。

**结束语** Microsoft 的 SQL (T-SQL) 实现没有对 RegEx 的本机支持。这个提议的解决方案对于 OP 来说可能并不比使用 CLR 存储过程更可取。但它确实提供了另一种解决问题的方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-15T19:57:57.667

您可以通过 OLE 自动化使用 VBScript 正则表达式功能。这比创建和维护程序集的开销要好得多。请确保您浏览评论部分以获得更好的主要修改版本。

[http://blogs.msdn.com/b/khen1234/archive/2005/05/11/416392.aspx](http://blogs.msdn.com/b/khen1234/archive/2005/05/11/416392.aspx)

```
DECLARE @obj INT, @res INT, @match BIT;
DECLARE @pattern varchar(255) = '<your regex pattern goes here>';
DECLARE @matchstring varchar(8000) = '<string to search goes here>';
SET @match = 0;

-- Create a VB script component object
EXEC @res = sp_OACreate 'VBScript.RegExp', @obj OUT;

-- Apply/set the pattern to the RegEx object
EXEC @res = sp_OASetProperty @obj, 'Pattern', @pattern;

-- Set any other settings/properties here
EXEC @res = sp_OASetProperty @obj, 'IgnoreCase', 1;

-- Call the method 'Test' to find a match
EXEC @res = sp_OAMethod @obj, 'Test', @match OUT, @matchstring;

-- Don't forget to clean-up
EXEC @res = sp_OADestroy @obj; 
```

如果`SQL Server blocked access to procedure 'sys.sp_OACreate'...`出现错误，请使用`sp_reconfigure`启用`Ole Automation Procedures`. （是的，不幸的是，这是服务器级别的更改！）

有关该`Test`方法的更多信息可[在此处获得](https://msdn.microsoft.com/en-us/library/ms974570.aspx?f=255&MSPPError=-2147217396)

快乐编码

# c# - 我需要我的缩放图像在 C# 中具有别名

> ID：194659
> 
> 赞同：2
> 
> 时间：2008-10-11T21:16:30.433
> 
> 标签：c#, image, bitmap

这可能是一个奇怪的问题，但是当我在 C# 中缩放我的图像时，我需要它被像素化而不是抗锯齿。就像缩放时在 MSpaint 中一样。

我希望默认情况下在 C# 中图像抗锯齿，否则我更改了我不想更改的内容。

我试过玩，`Graphics.InterpolationMode`但没有运气。我正在使用 Bitmap 对象来保存图像，并且它的构造如下：

```
// A custom control holds the image
this.m_ZoomPanPicBox.Image = new Bitmap(szImagePath); 
```

以及自定义控件的简要说明：

```
class ZoomPanPicBox : ScrollableControl
{
    Image m_image;
    float m_zoom = 1.0f;
    InterpolationMode m_interpolationMode;
    ...
    ////////////////////////////////////////////////////////
    public ZoomPanPicBox()
    {
        //Double buffer the control
        this.SetStyle(ControlStyles.AllPaintingInWmPaint | ControlStyles.UserPaint | ControlStyles.ResizeRedraw | ControlStyles.UserPaint | ControlStyles.DoubleBuffer, true);

        this.AutoScroll=true;
    }
    ////////////////////////////////////////////////////////
    protected override void OnPaint(PaintEventArgs e)
    {
        //if no image, don't bother
        if(m_image==null)
        {
            base.OnPaintBackground(e);
            return;
        }

        //Set up a zoom matrix
        Matrix mx = new Matrix(m_zoom,0,0,m_zoom,0,0);

        //now translate the matrix into position for the scrollbars
        mx.Translate(this.AutoScrollPosition.X / m_zoom, this.AutoScrollPosition.Y / m_zoom);

        //use the transform
        e.Graphics.Transform = mx;

        //and the desired interpolation mode
        e.Graphics.InterpolationMode = m_interpolationMode;

        //Draw the image ignoring the images resolution settings.
        e.Graphics.DrawImage(m_image,new Rectangle(0,0,this.m_image.Width,this.m_image.Height),0,0,m_image.Width, m_image.Height,GraphicsUnit.Pixel);

        base.OnPaint(e);
    } 
```

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T21:28:25.887

[实际上，正如文档所说](http://msdn.microsoft.com/en-us/library/k0fsyd4e.aspx)，您对 InterpolationMode 是正确的。只需将其设置为 InterpolationMode.NearestNeighbor。在您的代码示例中，您从未设置 m_interpolationMode。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T21:19:28.527

好吧，你可以自己实现比例并做一个简单的线性插值（IE 不会像双三次那样做任何邻居平均）......那些看起来不错而且块状。

# apache-flex - 使用 Flex SDK mxmlc 解析组件库

> ID：194663
> 
> 赞同：6
> 
> 时间：2008-10-11T21:19:39.413
> 
> 标签：apache-flex, mxml

我是 Flex SDK 的新手，并尝试使用[Doug Mccune 的 CoverFlow](http://dougmccune.com/blog/2007/11/19/flex-coverflow-performance-improvement-flex-carousel-component-and-vertical-coverflow/)小部件实现一个简单的项目。大多数关于如何执行此操作的文档都假定使用 Adob​​e 的 FlexBuilder 产品，这是一个 250 美元的 Eclipse 插件，我宁愿避免购买。我遇到的问题只是让 Flex SDK 项目编译器 mxmlc 识别 Doug 的 swc 文件，这是他的组件库的二进制版本。我不断收到错误消息，例如

> 错误：无法解析组件安装

和

> 错误：找不到类型或不是编译时常量：CoverFlow。

我也尝试过“VideoCoverFlow”类型，因为我很确定这些类型是在 Doug 的库中定义的。唉，我一直在弄清楚我哪里出错了。

以下是我的 mxml 项目文件的全文，名为 coverflow.mxml。

```
<?xml version="1.0" encoding="utf-8"?>

<mx:Application
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:local="*"
    height="100%"
    width="100%"
    layout="absolute">

    <local:CoverFlow
        id="CoverFlow"
        horizontalCenter="0"
        verticalCenter="0"
        borderThickness="10"
        borderColor="#FFFFFF"
        width="100%"/>

</mx:Application> 
```

我正在尝试使用以下命令对其进行编译：

```
c:\flex_sdk_3\bin\mxmlc.exe -compiler.source-path=lib coverflow.mxml 
```

我还尝试将 CoverFlow_lib.swc 文件移动到与 mxml 文件相同的目录中，而不是使用 source-path 参数，但这似乎没有什么区别。

如果有人能向我指出正确文档的方向，我会很乐意去 RTFM。[这里](https://stackoverflow.com/questions/78230/compiling-mxml-files-with-ant-and-flex-sdk)和[这里](https://stackoverflow.com/questions/119947/using-flash-component-swc-file-in-flex)有相关的 Stack Overflow 问题。

谢谢！

* * *

**更新**：我已将构建命令更改为以下内容：

```
mxmlc -library-path+=lib coverflow.mxml 
```

我还尝试了以下方法：

```
mxmlc -library-path+=CoverFlow_lib.swc coverflow.mxml 
```

将 swc 文件与 mxml 文件放在同一目录中。但是，我仍然遇到同样的错误。

这里还有一个[视频，](http://www.adobe.com/products/flex/media/flexapp/)显示了我正在尝试使用的同一个库，但在 Flex Builder 中。不幸的是，它没有显示如何使用 mxmlc。

我也尝试将我的 mxml 简化为，

```
<mx:Application
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:local="*" >

    <local:VideoCoverFlow />

</mx:Application> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-11T21:33:11.803

这是[Adob​​e 的 mxmlc 命令行工具文档的](http://livedocs.adobe.com/flex/3/html/help.html?content=compilers_13.html)[链接和命令行选项参考](http://livedocs.adobe.com/flex/3/html/help.html?content=compilers_14.html#157203)的直接链接。我也发现`mxmlc -help list`这是一个很好的起点。

正如另一张海报所推荐的那样，您确实想使用`library-path`将路径添加到包含 swc 文件的目录。使用 += 运算符确保不会覆盖以前的值

例如）

```
c:\flex_sdk_3\bin\mxmlc.exe -library-path+=lib coverflow.mxml 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T21:24:50.993

如果它是一个 swc，你不应该使用 library-path 而不是 source-path 并引用 swc？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T22:00:25.447

我终于得到了我的项目来构建。使用 library-path 是解决方案的一部分，但我还必须仔细查看 Doug Mccune 库的源代码，以便我可以在我的 mxml 中使用正确的路径信息和类型名称。

获胜的命令行是

```
mxmlc -library-path+=lib coverflow.mxml 
```

工作的mxml是

```
<?xml version="1.0" encoding="utf-8"?>

<mx:Application
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:coverflow="com.dougmccune.coverflow.*"
    xmlns:containers="com.dougmccune.containers.*"
    xmlns:local="*" >

    <containers:CoverFlowContainer id="flow" />

</mx:Application 
```

出于某种原因，如果我使用`id="coverflow"`. 我收到一条错误消息，提示 id 名称和类型名称不允许相同。如果有人可以向我解释，我很想了解那里发生了什么。

再次感谢西蒙和詹姆斯的帮助。

# objective-c - 有没有办法抑制 Xcode 中的警告？

> ID：194666
> 
> 赞同：125
> 
> 时间：2008-10-11T21:21:29.147
> 
> 标签：objective-c, xcode, cocoa, cocoa-touch, suppress-warnings

有没有办法抑制 Xcode 中的警告？

例如，我正在调用一个未记录的方法，并且由于该方法不在标头中，因此我在编译时收到警告。我知道我可以将它添加到我的标题以停止警告，但我想知道除了将它添加到标题（这样我可以保持标题清洁和标准）之外是否还有其他方法来抑制警告？一个pragma还是什么？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2008-10-13T05:28:52.843

要在每个文件的基础上禁用警告，使用 Xcode 3 和 llvm-gcc-4.2，您可以使用：

```
#pragma GCC diagnostic ignored "-Wwarning-flag" 
```

警告名称是一些 gcc 警告标志。

这会覆盖命令行上的任何警告标志。但它不适用于所有警告。将 -fdiagnostics-show-option 添加到您的 CFLAGS 中，您可以查看可以使用哪个标志来禁用该警告。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2011-11-03T09:13:44.813

有一种更简单的方法可以抑制**未使用的变量**警告：

```
#pragma unused(varname) 
```

编辑：来源：[http ://www.cocoadev.com/index.pl?XCodePragmas](http://www.cocoadev.com/index.pl?XCodePragmas)

更新：我遇到了一个新的解决方案，一个更强大的解决方案

1.  打开项目 > 编辑活动目标 > 构建选项卡。
2.  在`User-Defined`：找到（如果找不到，则创建）键：`GCC_WARN_UNUSED_VARIABLE`将其设置为`NO`.

EDIT-2 示例：

```
BOOL ok = YES;
NSAssert1(ok, @"Failed to calculate the first day the month based on %@", self); 
```

编译器显示未使用的变量警告`ok`。

解决方案：

```
BOOL ok = YES;
#pragma unused(ok)
NSAssert1(ok, @"Failed to calculate the first day the month based on %@", self); 
```

PS：您还可以设置/重置其他警告 `GCC_WARN_ABOUT_RETURN_TYPE`：：`YES/NO`

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2014-09-06T12:48:41.383

## 对于 gcc，您可以使用

```
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wshadow-ivar"
// your code
#pragma GCC diagnostic pop 
```

您可以在此处了解[GCC pragma](http://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Pragmas.html)并获取警告的警告代码，请转到 Report Navigator (Command+9)，选择最顶层的构建，展开日志（右侧的“=”按钮），然后滚动到底部和那里你的警告代码在这样的方括号内`[-Wshadow-ivar]`

## 对于铿锵声，你可以使用

```
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wshadow-ivar"
// your code
#pragma clang diagnostic pop 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2010-10-19T01:05:48.910

为了抑制单个文件的警告，请执行以下操作：

在 xcode 项目中选择文件。按获取信息转到带有构建选项的页面输入 -Wno- 以否定警告：

> -没有-

例如

> -Wno-未使用的参数

如果您查看项目设置查看位于构建选项卡页面底部的 GCC 警告，您可以获得警告的名称，通过单击每个警告，它会告诉您警告参数名称：

例如

> 每当函数参数除了声明之外未使用时发出警告。[GCC_WARN_UNUSED_PARAMETER，-Wunused-参数]

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-09-26T00:10:13.327

摆脱警告：尝试为有问题的对象创建一个类别界面

```
@interface NSTheClass (MyUndocumentedMethodsForNSTheClass)

-(id)theUndocumentedMethod;
@end
...

@implementation myClass : mySuperclass

-(void) myMethod {
...
   [theObject theUndocumentedMethod];
...
} 
```

顺便说一句，我*强烈*建议不要在运输代码中调用未记录的方法。界面可以并且将会改变，这将是你的错。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-10T06:57:05.700

在 Objective-C 中，一些严重的错误只会以警告的形式出现。我不仅*从不*禁用警告，而且通常打开“将警告视为错误”（-Werror）。

通过正确地做事（通常通过将对象转换为正确的类型）或在需要时声明原型，可以避免代码中的每种类型的警告。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-07-05T16:09:29.773

[http://nshipster.com/pragma/#inhibiting-warnings](http://nshipster.com/pragma/#inhibiting-warnings) - 跳到禁止警告部分

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-06-13T07:29:07.097

创建一个名为“Undocumented.h”的新的单独头文件并将其添加到您的项目中。然后为每个要调用未记录函数的类创建一个接口块，并为每个类分配“（未记录）”类别。然后只需在您的 PCH 中包含那个头文件。这样，您的原始头文件保持干净，只需要维护一个其他文件，并且您可以注释掉 PCH 中的一行以重新启用所有警告。

我也将这种方法用于“Depreciated.h”中具有“（Depreciated）”类别的折旧函数。

最好的部分是您可以通过注释或取消注释单个原型来选择性地启用/禁用单个警告。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-15T07:07:44.233

抑制该特定警告是不安全的。编译器需要知道参数的类型并返回一个方法来生成正确的代码。

例如，如果您正在调用这样的方法

[foo doSomethingWithFloat:1.0];

那需要一个浮点数，并且没有可见的原型，那么编译器会猜测该方法需要一个双精度，而不是一个浮点数。这可能会导致崩溃和错误解释的值。在上面的例子中，在像 intel 机器这样的小端机器上，接收器方法会看到 0 通过，而不是 1。

[您可以在i386 ABI 文档](http://developer.apple.com/documentation/DeveloperTools/Conceptual/LowLevelABI/Articles/IA32.html)中阅读原因，或者您可以修复您的警告。:-)

# asp.net - 如何在 ASP.NET MVC Web 应用程序的 Web 服务器的内存中缓存图像？

> ID：194674
> 
> 赞同：1
> 
> 时间：2008-10-11T21:28:00.457
> 
> 标签：asp.net, asp.net-mvc, caching

我正在使用 ASP.NET MVC 开发一个包含许多图像的 Web 应用程序。我希望能够将图像缓存在内存中以提高性能，但我想听听最好的方法是什么。

1) 图片可从 URL 访问，例如[http://www.site.com/album/1.jpg](http://www.site.com/album/1.jpg)。图像是如何存储在内存中的？它们会以内存流的形式存在吗？

2）如何从内存中访问图像并发送到网页？现在网页将使用图像 URL 将图像直接嵌入标签中。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T02:18:05.210

如果图像只是磁盘上的静态文件，那么 Beepcake 是正确的，IIS 已经缓存了经常使用的图像并从内存中提供它们。使用单独的缓存服务器应该不会比 IIS 从内存中提供图像快 - 它更多地与可伸缩性有关。一旦你有一个大型服务器场，这意味着你有一组服务器只处理你的代码，一组服务器只处理静态图像。此外，如果您的内容太多，一台服务器无法全部缓存，那么您可以路由请求，以便十台服务器中的每台都缓存不同的 10% 的内容。这应该比让每台服务器缓存相同的最常用的 10% 内容要好得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T21:46:57.660

无论如何，网络服务器和下游缓存不会为静态资源处理这个问题吗？不确定会有很多性能提升，但对应用程序或设置一无所知，我可能是错的。

为了实现，我设置了一个页面，该页面采用图像文件名并从磁盘或内存缓存中的 asp.net 提供它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T22:36:16.653

感谢您的回复。我想我想错了方向。我刚刚发现 Flickr 正在使用 Squid 来缓存图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-15T22:22:10.800

如果您想要真正的出色性能，我建议您使用 Amazon CloudFront。边缘缓存将为您提供比内存缓存更好的性能，并且 CloudFront 运行 nginx，这在静态文件（除其他外）上明显优于 IIS。

设置边缘缓存非常容易 - 您登录，并获得一个域来使用而不是您自己的图像 URL。

# c++ - 对于受 CPU 限制的应用程序，您会推荐什么语言/平台？

> ID：194676
> 
> 赞同：5
> 
> 时间：2008-10-11T21:28:41.737
> 
> 标签：c++, performance, algorithm

我正在开发非交互式 cpu-bound 应用程序，它只进行计算，几乎没有 IO。目前它工作的时间太长，而我正在努力改进算法，我也认为它是否可以为改变语言或平台带来任何好处。目前它在使用英特尔 C++ 编译器编译的 Windows 上是 C++（没有 OOP，所以它几乎是 C）。切换到 ASM 有帮助吗？有多大帮助？切换到 Linux 和 GCC 有帮助吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-11T22:23:19.363

只是要彻底：要做的第一件事是收集个人资料数据，第二件事是考虑您的算法。我相信你知道这一点，但它们必须被#include 到任何性能编程讨论中。

直接回答您的问题“切换到 ASM 有帮助吗？” 答案是“如果你不知道答案，那么可能不知道。” 除非您非常熟悉 CPU 架构及其来龙去脉，否则您不太可能比在代码上优化 C/C++ 编译器做得更好。

接下来要说明的一点是，代码中的显着加速（除了算法改进）几乎肯定来自并行性，而不是线性增长。台式机现在可以在一项任务中使用 4 或 8 个内核，这比稍微好一点的代码生成器具有更大的性能潜力。由于您对 C/C++ 很熟悉，因此 OpenMP 几乎是轻而易举的事。使用它来并行化你的循环非常容易（显然，你必须观察循环携带的依赖关系，但它绝对是“可能工作的最简单的并行性”）。

话虽如此，C/C++ 编译器之间的代码生成质量确实有所不同。英特尔 C++ 编译器因其优化质量而备受推崇，不仅完全支持 OpenMP，还支持线程构建模块等其他技术。

谈到哪种编程语言可能比 C++ 更好的问题，答案将是“积极促进/促进并行和并发编程概念的编程语言”。Erlang 是这方面的佼佼者，现在是一种“热门”语言，大多数对性能编程感兴趣的人至少对它有所关注，所以如果你想提高你在这方面的技能，你可以想看看。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-11T21:37:05.493

它总是算法，很少是语言。这是我的线索：“当我致力于改进算法时”。

调整可能还不够。

考虑彻底改变算法。你必须消除处理，而不是让处理更快。罪魁祸首通常是“搜索”——在数据中循环寻找某些东西。寻找消除搜索的方法。如果你不能消除它，用某种树搜索或某种哈希映射替换线性搜索。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-11T21:32:12.493

切换到 ASM 不会有太大帮助，除非你非常擅长它和/或有一个特定的关键路径例程，你知道你可以做得更好。正如一些人所说，现代编译器在大多数情况下更善于利用​​缓存/等。比任何人都可以手工完成。

我建议：

*   尝试不同的编译器和/或不同的优化选项
*   运行代码覆盖/分析实用程序，找出关键路径在哪里，并努力优化代码中的路径

C++ 应该能够为您提供非常接近代码的最佳性能，所以我不建议切换语言。作为另一个建议，根据应用程序，您可能能够在使用多线程的多代码/处理器系统上获得更好的性能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-11T21:34:38.090

虽然只是切换到 asm 不会带来任何好处，但由于英特尔 C++ 编译器可能比您更擅长优化，您可以尝试以下选项之一：

*   尝试使用可以并行化您的代码的编译器，例如[VectorC](http://www.codeplay.com/)编译器。
*   尝试通过大量使用 MMX、3DNow!、SSE 或任何适合您需求（和您的 CPU）的方式切换到 asm。这将比纯 asm 带来更多好处。
*   您也可以尝试使用 GPGPU，即在 GPU 而不是 CPU 上执行大部分算法。根据您的算法，它可以显着加快。

编辑：我也支持配置文件方法。我推荐[AQTime](http://www.automatedqa.com)，它支持 Intel C++ 编译器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-11T21:35:05.700

就我个人而言，我会看那些让你最容易利用并行性的语言，除非它是一个完全不可并行的情况。能够使用一些额外的核心并获得（如果可能的话！）接近线性的改进可能比挤出额外的几个百分比的效率更具成本效益。

谈到并行化，我相信函数式语言通常被认为是最好的方法，或者你可以看看 OpenMP for C/C++。（就我个人而言，作为一个托管语言的人，我会关注 Java/.NET 的库，但我很明白并不是每个人都有相同的偏好！）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-11T23:04:34.413

试试 Fortran 77 - 在计算方面，仍然没有什么能比得上编程语言的祖父。此外，请尝试使用 OpenMP 来利用多个内核。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-12T04:28:03.387

与 C++ 可以为您做的相比，手动优化您的 ASM 代码很少具有成本效益。

如果你从传统算法的角度对算法做了任何你能做的事情，并且你也消除了多余的东西，那么你可能是 SOL，或者**你可以考虑从硬件的角度优化你的程序。**

例如，任何时候你在堆周围跟随一个指针，你都会因为缓存未命中、可能的分页等而付出巨大的代价，这些都会影响分支预测。大多数程序员（甚至 C 大师）倾向于从功能的角度来看待 CPU，而不是从幕后发生的事情。有时重新组织内存，例如通过“展平”或手动分配内存以适应同一页面可以获得极大的加速。仅仅通过扁平化我的结构，我设法在图形遍历上获得了 2 倍的加速。

这些不是您的编译器将为您做的事情，因为它们基于您对程序的高级理解。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-12T02:09:24.710

正如 lobrien 所说，您没有向我们提供任何信息来告诉您手动优化的 ASM 代码是否会有所帮助……这意味着答案可能是“还没有”。

您是否使用分析器运行代码？

你知道代码慢是因为内存限制还是处理器限制？

您是否正在使用所有可用的内核？

您是否确定了您正在使用的不是 O(1) 的算法？你能让他们达到 O(1) 吗？如果不是，为什么不呢？

如果你已经完成了所有这些，你对程序运行的环境有多少控制权？（如果您正在考虑切换操作系统，可能会很多）您可以禁用其他进程，给您的进程最高优先级等吗？只是找到一台具有更快处理器、更多内核或更多内存的机器怎么样（取决于你的限制）

不断地。

如果您已经完成了所有这些以及更多，那么您当然可能会想到，“我想知道这里的这几行代码是否可以比我正在查看的程序集更好地优化现在调试器？” 到那时你可以具体问。

祝你好运！你正在解决一个有趣的问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-12T01:20:47.040

有时您可以找到优化了您关心的算法实现的库。通常他们会为你完成多线程。

例如，从 LINPACK 切换到 LAPACK 使用良好的 BLAS 库使我们的 LU 分解/求解速度提高了 10 倍。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-12T01:42:43.970

首先，弄清楚是否可以按照 S.Lott 的建议更改算法。

假设算法选择是正确的，如果您正在处理大量数据，您可能会查看内存访问模式。对于当今的许多数字运算应用程序，它们受内存总线的约束，而不是受 ALU(s) 的约束。我最近优化了一些形式的代码：

```
// 假设 N 是一个大数
for (int i=0; i<N; i++) {
  myArray[i] = dosomething(i);
}
for (int i=0; i<N; i++) {
  myArray[i] = somethingElse(myArray[i]);
}
...

```

并将其转换为：

```
for (int i=0; i<N; i++) {
  双 tmp = dosomething(i);
  tmp = somethingElse(tmp);
  ...
  我的数组[i] = tmp;
}
...

```

在这种特殊情况下，这产生了大约 2 倍的加速。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-29T10:06:15.053

正如 Oregonghost 已经暗示的那样 - VectorC 编译器可能会有所帮助。虽然它并没有真正并行化代码，但您可以使用它来利用扩展命令集，如 mmx 或 sse。我将它用于软件渲染引擎中时间最关键的部分，它在大多数处理器上实现了大约 150%-200% 的加速。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-11T22:03:30.417

对于另一种方法，您可以研究[分布式计算](http://en.wikipedia.org/wiki/Distributed_computing)，听起来它可以满足您的需求。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-12T04:14:30.747

如果您在 intel 编译器上坚持使用 C++，请查看[编译器内在函数（](http://software.intel.com/en-us/articles/how-to-use-intrinsics)[此处](http://softwarecommunity.intel.com/isn/downloads/softwareproducts/pdfs/347603.pdf)为完整参考）。我知道 VC++ 有[类似的功能](http://msdn.microsoft.com/en-us/library/26td21ds.aspx)，我相信你可以用 gcc 做同样的事情。这些可以让您充分利用 CPU 内置的并行性。您可以使用 MMX、SSE 和 SSE2 指令在一定程度上提高性能。就像其他人说的那样，你可能最好先看看算法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-12T04:27:16.167

我建议你重新考虑你的算法，或者甚至更好，你的方法。另一方面，您尝试计算的内容可能只需要大量计算时间。您是否考虑过使其分布式以便它可以在某种集群中运行？如果您想通过为[内部循环](https://rads.stackoverflow.com/amzn/click/com/0201479605)引入 Assembler 来专注于纯代码优化，那么这通常会非常有益（如果您知道自己在做什么）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-12T15:48:52.403

对于现代处理器，学习 ASM 将花费您很长时间。此外，随着 SSE 的所有不同版本，您的代码最终将非常依赖处理器。

我做了很多 CPU 密集型的工作，发现 intel 的 C++ 编译器和 g++ 之间的差异通常不是那么大（最多 15% 左右），而且 Mac OS X、Windows 之间没有可测量的差异和 Linux。

您将不得不手动优化您的代码并改进您的算法。恐怕没有“魔法仙尘”可以使现有代码更快。

如果你还没有，并且你关心性能，你必须通过一个好的分析器运行你的代码（我个人喜欢 Linux 上的 kcachegrind 和 valgrind，或者 Mac OS X 上的 Shark。我不知道什么对 Windows 有好处我耽心）。

根据我过去的经验，很有可能您会发现某些方法占用了您 95% 的 CPU 时间，而一些简单的更改或添加缓存将大大提高您的性能。类似地，如果某种方法只占用了你 CPU 时间的 1%，那么再多的优化也不会给你带来任何好处。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-13T10:36:32.847

“受 CPU 限制”的 2 个明显答案是： 1\. 使用更多 CPU（核心） 2\. 使用其他东西。

使用 2 个线程而不是 1 个线程将花费的时间最多减少 50%。相比之下，C++ 到 ASM 很少给你 5%（对于新手 ASM 程序员来说，通常是 -5%！）。有些问题可以很好地扩展，并且可能受益于 8 或 16 核。这种硬件仍然是相当主流的，所以看看你的问题是否属于这一类。

另一种解决方案是在任务中投入更专业的硬件。这可能是您的 CPU 的矢量单元 - 考虑到 Windows=x86/x64，这将是 SSE 的一种风格。另一种矢量硬件是现代 GPU。GPU 也有自己的内存总线，速度非常快。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-04T23:22:39.627

[先把头条拿出来。](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)然后，如果它在不使用 ASM 的情况下尽可能快，那就这样吧。但是认为你必须去 ASM 假设你知道是什么让它变慢，我敢打赌你猜的甜甜圈。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-10T21:00:13.357

如果你觉得你已经优化你的代码到一个点没有改进，增加你的 CPU。这可以在不同的平台上完成。我开发的一个是Appistry。几个链接：

[http://www.appistry.com/resource-library/index.html](http://www.appistry.com/resource-library/index.html)

您可以从这里免费下载产品：

[http://www.appistry.com/developers/](http://www.appistry.com/developers/)

我为 Appistry 工作，我们通过将工作分散到 10 或 100 台机器上完成了许多受 cpu 限制的任务的安装。

希望这会有所帮助，-布雷特

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-30T18:11:20.957

可能的小帮助：

[64位程序的优化](http://www.viva64.com/art-1-2-1756520624.html)

[AMD64 (EM64T) 架构](http://www.viva64.com/art-1-2-1496710594.html)

[多线程 OpenMP 程序的调试和优化](http://www.viva64.com/art-3-2-86765651.html)

[开发并行程序的问题介绍](http://www.viva64.com/art-3-2-1809481708.html)

[在 Visual C++ 中开发资源密集型应用程序](http://www.viva64.com/art-1-2-2014169752.html)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-30T18:39:48.683

# Linux

切换到 Linux 会有所帮助，如果您将其剥离到您实际需要的部分。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-02-17T19:08:08.920

[CrowdProcess](https://crowdprocess.com)有大约 2000 个工作人员可以用来计算你的算法。API 非常简单，我们一直在观察接近工人数量的加速。您还可以编写 Javascript，它应该使您比 C++ 或 ASM 更有效率。

因此，如果您介于 C++ 或 ASM 之间，我会说您应该首先使用所有 CPU 内核，然后如果还不够，CrowdProcess 应该是一个有趣的平台。

免责声明：我构建了 CrowdProcess。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2012-02-14T00:37:04.243

很难生成比原始 C 或 C++ 代码更快的 ASM 代码。在大多数情况下，如果你把这项工作做得很好，你可能获得的收益不会超过几个百分点，获得 10% 的加速被认为是巨大的成功，但在大多数情况下，这是不可能的。

编译器能够理解如何有效地编译。您应该分析以找出优化的地方。

# java - 如何在运行时加载 jar 文件

> ID：194698
> 
> 赞同：74
> 
> 时间：2008-10-11T21:42:22.677
> 
> 标签：java, jar, runtime, classloader

我被要求构建一个能够在运行时加载新代码（扩展）的 java 系统。如何在我的代码运行时重新加载 jar 文件？或者我如何加载一个新的罐子？

显然，由于恒定的正常运行时间很重要，我想添加在现有类时重新加载现有类的能力（如果它不会使事情变得太复杂的话）。

我应该注意什么？（将其视为两个不同的问题 - 一个关于在运行时重新加载类，另一个关于添加新类）。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-11T21:57:09.493

使用现有数据重新加载现有类可能会破坏事情。

您可以相对容易地将新代码加载到新的类加载器中：

```
ClassLoader loader = URLClassLoader.newInstance(
    new URL[] { yourURL },
    getClass().getClassLoader()
);
Class<?> clazz = Class.forName("mypackage.MyClass", true, loader);
Class<? extends Runnable> runClass = clazz.asSubclass(Runnable.class);
// Avoid Class.newInstance, for it is evil.
Constructor<? extends Runnable> ctor = runClass.getConstructor();
Runnable doRun = ctor.newInstance();
doRun.run(); 
```

不再使用的类加载器可以进行垃圾回收（除非存在内存泄漏，使用 ThreadLocal、JDBC 驱动程序`java.beans`等经常出现这种情况）。

如果您想保留对象数据，那么我建议使用诸如序列化之类的持久性机制，或者您习惯的任何方式。

当然，调试系统可以做一些更高级的事情，但更笨拙，更不可靠。

可以将新类添加到类加载器中。例如，使用`URLClassLoader.addURL`. 但是，如果一个类无法加载（例如，因为您没有添加它），那么它将永远不会加载到该类加载器实例中。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-03-23T13:44:31.907

这对我有用：

```
File file  = new File("c:\\myjar.jar");

URL url = file.toURL();  
URL[] urls = new URL[]{url};

ClassLoader cl = new URLClassLoader(urls);
Class cls = cl.loadClass("com.mypackage.myclass"); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-11T10:49:43.800

> 我被要求构建一个能够在运行时加载新代码的 java 系统

您可能希望您的系统基于[OSGi](http://www.osgi.org/Main/HomePage)（或至少花很多时间），这正是针对这种情况而设计的。

使用类加载器确实是一件棘手的事情，主要是因为类可见性是如何工作的，而且您不想在以后遇到难以调试的问题。例如，在许多库中广泛使用的[Class.forName()](http://docs.oracle.com/javase/7/docs/api/java/lang/Class.html)在碎片化的类加载器空间中不能很好地工作。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-11T21:55:31.883

我用谷歌搜索了一下，[在这里](https://community.oracle.com/message/5531305#5531305)找到了这段代码：

```
File file = getJarFileToLoadFrom();   
String lcStr = getNameOfClassToLoad();   
URL jarfile = new URL("jar", "","file:" + file.getAbsolutePath()+"!/");    
URLClassLoader cl = URLClassLoader.newInstance(new URL[] {jarfile });   
Class loadedClass = cl.loadClass(lcStr); 
```

任何人都可以分享有关这种方法的意见/评论/答案吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-23T07:09:38.743

使用 org.openide.util.Lookup 和 ClassLoader 来动态加载 Jar 插件，如下所示。

```
public LoadEngine() {
    Lookup ocrengineLookup;
    Collection<OCREngine> ocrengines;
    Template ocrengineTemplate;
    Result ocrengineResults;
    try {
        //ocrengineLookup = Lookup.getDefault(); this only load OCREngine in classpath of  application
        ocrengineLookup = Lookups.metaInfServices(getClassLoaderForExtraModule());//this load the OCREngine in the extra module as well
        ocrengineTemplate = new Template(OCREngine.class);
        ocrengineResults = ocrengineLookup.lookup(ocrengineTemplate); 
        ocrengines = ocrengineResults.allInstances();//all OCREngines must implement the defined interface in OCREngine. Reference to guideline of implement org.openide.util.Lookup for more information

    } catch (Exception ex) {
    }
}

public ClassLoader getClassLoaderForExtraModule() throws IOException {

    List<URL> urls = new ArrayList<URL>(5);
    //foreach( filepath: external file *.JAR) with each external file *.JAR, do as follows
    File jar = new File(filepath);
    JarFile jf = new JarFile(jar);
    urls.add(jar.toURI().toURL());
    Manifest mf = jf.getManifest(); // If the jar has a class-path in it's manifest add it's entries
    if (mf
            != null) {
        String cp =
                mf.getMainAttributes().getValue("class-path");
        if (cp
                != null) {
            for (String cpe : cp.split("\\s+")) {
                File lib =
                        new File(jar.getParentFile(), cpe);
                urls.add(lib.toURI().toURL());
            }
        }
    }
    ClassLoader cl = ClassLoader.getSystemClassLoader();
    if (urls.size() > 0) {
        cl = new URLClassLoader(urls.toArray(new URL[urls.size()]), ClassLoader.getSystemClassLoader());
    }
    return cl;
} 
```

# c# - 如何自动注册 Web 服务器控件所需的 HttpHandler？

> ID：194721
> 
> 赞同：2
> 
> 时间：2008-10-11T22:09:31.670
> 
> 标签：c#, .net, asp.net

在 ASP.NET 中，当在包含 HttpHandler 的类库中构建 Web 服务器控件时，是否可以自动注册处理程序而无需手动编辑 Web 应用程序的 web.config 文件？

我有一个包含 CompositeControl 的类库。在复合控件中，我有一个 Image 控件，其 ImageUrl 属性设置为 HttpHandler。为了让 HttpHandler 在使用类库的应用程序中工作，我必须在 web.config 文件中创建一个条目：

```
<add verb="*" path="Icon.ashx" type="ClassLibrary.MyHandler" /> 
```

我已经阅读[了这篇博客文章](http://www.tkachenko.com/blog/archives/000686.html)，其中概述了如何诱使设计人员为您执行此操作，但我想要一些不需要我的类库的用户在 Visual Studio 中输入设计器才能工作的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T01:50:12.690

我认为没有办法在运行时注册处理程序。您已经拥有的代码的变体将在运行时修改 web.config 的其他部分，但如果您尝试修改 <httpHandlers>，则会悄悄地失败。您可以解析和编辑 web.config，就好像它是任何其他 XML 文件一样，但您不一定假设应用程序在运行时具有对 web.config 的写入权限。

但是，您可以通过处理应用程序的 BeginRequest 事件来实现与 HttpHandler 相同的效果。在您的控件第一次加载时添加一个事件处理程序，在该处理程序中，您可以检查 Request.Url 是否是您应该处理的，如果是，请调用您的 ProcessRequest 代码。最后，调用 HttpApplication.CompleteRequest() 跳过正常的请求处理。您将为每个请求增加一点开销，因此是否值得避免手动编辑 web.config 取决于您。

部分解决方案是在运行时使用 IsHttpHandlerRegistered() 方法，以便在未注册处理程序时提供有用的异常。这似乎是 ASP.NET 本身处理需要 HttpHandler 的功能的方式。在运行时读取配置应该没问题，但获取配置对象会略有不同：

```
Configuration configuration = WebConfigurationManager.OpenWebConfiguration("~"); 
```

# macos - 如何使 OS X 上的“查找”命令默认为当前目录？

> ID：194725
> 
> 赞同：14
> 
> 时间：2008-10-11T22:10:24.600
> 
> 标签：macos, bash, command-line, find

我是一个重度命令行用户，并`find`在我的构建系统脚本中广泛使用该命令。但是在 Mac OS X 上，当我不专心时，我经常会得到这样的输出：

```
$ find -name \*.plist
find: illegal option -- n
find: illegal option -- a
find: illegal option -- m
find: illegal option -- e
find: *.plist: No such file or directory 
```

基本上，我忘了添加小点：

```
$ find . -name \*.plist 
```

因为 BSD`find`需要路径而 GNU`find`不需要（如果您不指定，它假定当前目录）。我经常同时使用 Linux、Mac OS X 和 Cygwin，所以让我的所有工具的行为都相同对我来说是非常有益的。如果我忘记了，我尝试编写一个`find`添加“./”的 bash 函数，但我失败了。谢谢你的帮助。:)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2013-02-21T13:26:58.937

改为安装 GNU find。

```
$ brew install findutils
$ alias find=gfind 
```

是的，它有效！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T00:14:57.733

如果您不能训练自己`find`“正确”使用，那么为什么不在系统命令之前将 GNU `find`（来自`findutils`）安装在 PATH 上的目录中。`find`

如果列表中的最后一项不是目录，我曾经有我自己的私有变体会`cp`将文件复制到当前目录。我将它保存在我的个人`bin`目录中多年 - 但最终因为我不再使用该功能而将其删除。（我的 'cp.sh' 写于 1987 年，并在 1990 年和 1997 年进行了两次编辑，作为版本控制系统符号更改的一部分。我想我在 1998 年左右删除了它。脚本的主要问题`cp file1 file2`是在复制之间模棱两可一个文件覆盖另一个文件并将两个文件复制到当前目录。）

考虑编写自己的包装器`find`：

```
#!/bin/sh
[ ! -d "$1" ] && set -- . "$@"
exec /usr/bin/find "$@" 
```

第二行说“如果参数 1 不是目录，则调整命令行参数以在命令的其余部分之前包含点。如果您输入以下内容，那将令人困惑：

```
~/bin/find /non-existent/directory -name '*.plist' -print 
```

因为不存在的目录不是目录，并且脚本会在命令行中添加点——这就是我停止使用私有`cp`命令的原因。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-11T22:41:40.497

如果您必须将其称为“查找”，那么您需要：

```
alias find=/usr/bin/find\ . 
```

在您的 .profile 或 .bash_profile 或……中。替换 Mac OSX 上的真实路径（如果不是 /usr/bin/find）。输入完整路径以避免循环（bash 通常会`alias find=find`毫无问题地解释，但最好确定）。

但是你最好不要命名别名`find`（findl、myfind 等），因为如果你在另一个系统上尝试它会成为你的习惯和麻烦。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-11T22:14:53.327

```
find ./ -name "*.plist" 
```

**编辑**：嗯，我可能误解了这个问题！如果你疯了，如何通过 shell 脚本来模拟它？我经常将随机实用程序脚本保存在 ~/.bin 中，这是我 PATH 中的第一件事。如果您有类似的设置，也许您可​​以执行以下操作：（未经测试！）

```
#!/bin/sh
# remapping find!
CMD=`echo $1 | cut -c 1`
if [ $CMD = '-' ]
then
# pwd search
  /usr/bin/find ./ $*
else
# regular find
  /usr/bin/find $*
fi 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-11T22:18:10.933

我建议如果您正在编写脚本（将来更有可能从一个系统迁移到另一个系统），您应该尝试使用更具体的命令形式，即指定“。” 而不是依赖默认值。出于同样的原因，我什至可能会建议编写`sh`脚本，而不是依赖`bash`可能不会随处安装的脚本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-11T22:17:17.783

这可能不是您想要的，但如何：`alias find="find ."`

或选择一个新名称（`findl`用于查找本地？）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-16T19:04:00.097

您可能想要运行此链接中的命令：[https ://www.topbug.ne​​t/blog/2013/04/14/install-and-use-gnu-command-line-tools-in-mac-os- X/](https://www.topbug.net/blog/2013/04/14/install-and-use-gnu-command-line-tools-in-mac-os-x/)

它有点过时了，例如我发现我根本不需要在我的路径中添加很多命令。

这通过让您的系统使用软件包中的非 BSD 查找实用程序来解决您的问题`findutils`，同时还安装您可能需要的其他工具。

# actionscript-3 - Flex 3 方法可以检测到调用对象吗？

> ID：194733
> 
> 赞同：2
> 
> 时间：2008-10-11T22:16:24.603
> 
> 标签：actionscript-3, apache-flex, flex3

如果我有这样的方法：

```
private function testMethod(param:string):void
{
  // Get the object that called this function
} 
```

在 testMethod 中，我能算出是什么对象调用了我们吗？例如

```
class A
{
  doSomething()
  {
    var b:B = new B();
    b.fooBar();
  }
}

class B
{
  fooBar()
  {
    // Can I tell that the calling object is type of class A?
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-11T22:26:03.960

抱歉，答案是否定的（请参阅下面的编辑）。函数接收到一个特殊的属性`arguments`，在 AS2 中它曾经拥有`caller`可以大致完成您想要的操作的属性。虽然 arguments 对象在 AS3 中仍然可用，但 caller 属性已从 AS3（因此 Flex 3）中删除，因此没有直接的方法可以做你想做的事。还建议您使用 [...rest 参数]( [http://livedocs.adobe.com/flex/3/langref/statements.html#..._(rest)_parameter)](http://livedocs.adobe.com/flex/3/langref/statements.html#..._(rest)_parameter))语言功能而不是[参数](http://livedocs.adobe.com/flex/3/langref/arguments.html).

这是[关于此事的参考](http://www.senocular.com/flash/tutorials/as3withflashcs3/)（搜索被调用者以找到相关详细信息）。

**编辑：**进一步的调查表明，可以获得当前执行函数的堆栈跟踪，所以如果你幸运的话，你可以用它做一些事情。有关更多详细信息，请参阅[此博客条目](http://blog.joa-ebert.com/2006/12/12/looking-up-the-calling-function/)和[此论坛帖子](http://tech.groups.yahoo.com/group/flexcoders/message/58388)。

博客文章的基本思想是你抛出一个错误，然后立即捕获它，然后解析堆栈跟踪。丑陋，但它可能对你有用。

博客文章中的代码：

```
 var stackTrace:String;

try { throw new Error(); }
catch (e:Error) { stackTrace = e.getStackTrace(); }

var lines:Array = stackTrace.split("\n");
var isDebug:Boolean = (lines[1] as String).indexOf('[') != -1;

var path:String;
var line:int = -1;

if(isDebug)
{
    var regex:RegExp = /at\x20(.+?)\[(.+?)\]/i;
    var matches:Array = regex.exec(lines[2]);

    path = matches[1];

    //file:line = matches[2]
    //windows == 2 because of drive:\
    line = matches[2].split(':')[2];
}
else
{
    path = (lines[2] as String).substring(4);
}

trace(path + (line != -1 ? '[' + line.toString() + ']' : '')); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T22:01:46.427

重要的是要知道 stackTrace 仅在 Flash Player 的调试器版本上可用。对不起！:(

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T00:20:10.033

我赞成明确传递“callingObject”参数的想法。除非您正在做非常棘手的事情，否则调用者最好能够提供目标对象。（对不起，如果这看起来很明显，我不知道你想要完成什么。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T07:23:49.960

在 James 的第一段中添加一些模棱两可的内容： arguments 属性在 Function 对象中仍然可用，但 caller 属性已被删除。

这是文档的链接：http: [//livedocs.adobe.com/flex/3/langref/arguments.html](http://livedocs.adobe.com/flex/3/langref/arguments.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-06T01:07:55.607

这可能对某人有帮助，我不确定......但如果有人使用，`Event`则可以使用`e.currentTarget`以下方法：

```
private function button_hover(e:Event):void
{
      e.currentTarget.label="Hovering";
} 
```

# c# - 您如何确定 Internet 连接是否可用于您的 WinForms 应用程序？

> ID：194742
> 
> 赞同：13
> 
> 时间：2008-10-11T22:23:32.233
> 
> 标签：c#, .net, winforms

确定 WinForms 应用程序是否有可用的 Internet 连接的最佳方法是什么。（当然以编程方式）如果用户未连接到 Internet，我想禁用/隐藏某些功能。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-11T23:05:41.027

以下将确定您是否已连接到网络，但这并不一定意味着您已连接到 Internet：

```
NetworkInterface.GetIsNetworkAvailable() 
```

这是史蒂夫的代码的 C# 翻译，似乎相当不错：

```
private static int ERROR_SUCCESS = 0;
public static bool IsInternetConnected() {
    long dwConnectionFlags = 0;
    if (!InternetGetConnectedState(dwConnectionFlags, 0))
        return false;

    if(InternetAttemptConnect(0) != ERROR_SUCCESS)
        return false;

    return true;
}

 [DllImport("wininet.dll", SetLastError=true)]
 public static extern int InternetAttemptConnect(uint res);

 [DllImport("wininet.dll", SetLastError=true)]
  public static extern bool InternetGetConnectedState(out int flags,int reserved); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-12T02:24:53.340

sbeskur 的回复在 InternetGetConnectedState 的翻译中存在错误。参数都是 DWORD（第一个是 LPDWORD）。这两个都转换为 C# 中的 int（从技术上讲，uint 但 int 适用于大多数场景）。

正确翻译如下。

```
 [DllImport("wininet.dll", SetLastError=true)] 
public static extern bool InternetGetConnectedState(out int flags,int reserved); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-11T22:29:37.870

我不是 ac# 开发人员，但在 C++ 中，您可以像这样使用 Win32 API（特别是来自 Wininet.dll）：

```
bool IsInternetConnected( void )
{
    DWORD dwConnectionFlags = 0;

    if( !InternetGetConnectedState( &dwConnectionFlags, 0 ) )
        return false;

    if( InternetAttemptConnect( 0 ) != ERROR_SUCCESS )
        return false;

    return true;
} 
```

我认为这很容易变成c#

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-11T23:08:25.543

我在其他地方找到了这段代码，但真的很想知道是否有更好的方法。

```
HttpWebRequest req;
HttpWebResponse resp;
try
{
    req = (HttpWebRequest)WebRequest.Create("http://www.google.com");
    resp = (HttpWebResponse)req.GetResponse();

    if(resp.StatusCode.ToString().Equals("OK"))
    {
        Console.WriteLine("its connected.");
    }
    else
    {
        Console.WriteLine("its not connected.");
    }
}
catch(Exception exc)
{
    Console.WriteLine("its not connected.");
} 
```

我喜欢能够通过 NetworkInterface 抛出的 NetworkChange 事件来监控连接是否丢失的想法。我的应用程序供没有经验的用户在互联网连接不稳定的笔记本电脑上使用（通常在澳大利亚内陆地区）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-11T23:01:14.793

对 Internet 连接性的猜测是网络可用性，在`NetworkInterface.GetIsNetworkAvailable()`. 上的事件`NetworkChange`可以告诉您它何时发生变化。这两个类都在`System.Net.NetworkInformation`命名空间中。

当然，在您尝试连接某些东西之前，您不会知道 Internet 是否真的可用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T03:06:17.063

InternetGetConnected 状态是确定您已连接到网络的第一步。为了确定您是否有 Internet 连接，一种技术是使用[IPHelper api 向 Internet 上的某些服务器发送 ARP](http://msdn.microsoft.com/en-us/library/aa366358(VS.85).aspx)（地址解析协议）请求。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T09:30:28.393

Ping google.com（或知名主机列表）或尝试实际执行您的应用程序需要 Internet 连接的功能之一（在结构意义上）。*在任何操作系统上，如果不实际尝试*通信，就无法真正确定 Internet 连接是否正常工作，这与操作系统对什么构成“可用”的看法相反。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T23:09:33.793

[http://www.csharphelp.com/archives3/archive499.html](http://www.csharphelp.com/archives3/archive499.html)

此外，滚动浏览位于[http://www.csharpfriends.com/Forums/ShowPost.aspx?PostID=13045](http://www.csharpfriends.com/Forums/ShowPost.aspx?PostID=13045)的专家交流链接，您会看到一些建议。

此外，如果您喜欢 VB.Net 中的 My 命名空间（顺便说一句，您可以链接到它），My.Computer.Network.IsAvailable 是最简单的解决方案。

# asp.net - ASP.NET 动态数据多行文本控件中的 HTML

> ID：194750
> 
> 赞同：2
> 
> 时间：2008-10-11T22:31:42.263
> 
> 标签：asp.net, dynamic-data

我正在尝试在 ASP.NET 动态数据 MultilineText_Edit 控件中输入一些 HTML，`<br>`当我在网页上输出列的值时，只有几个标签具有换行符。

但是，当我尝试单击动态数据编辑页面上的“更新”链接时，没有任何反应。我什至没有收到错误消息，如果通过控件内置的某些规则不允许 HTML 输入，我会预料到。只要我删除标签，更新链接就可以正常工作。这不是列大小问题，我可以在输入中添加更多字符，一切正常。

这些控件中是否不允许 HTML 输入，还是发生了其他事情？如果有某种验证规则，可以关闭吗？或者我需要在数据库中设置什么？我应该使用默认的多行文本模板以外的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T13:14:47.240

输入验证是 ASP.NET 2.0 或更高版本中的内置功能。我不知道您为什么没有收到错误，但请检查一下是否有帮助：

[http://www.asp.net/learn/whitepapers/request-validation/](http://www.asp.net/learn/whitepapers/request-validation/)

在页面上检查这些设置：

```
<%@ Page validateRequest="false" %> 
```

或 web.config：

```
<configuration>  
  <system.web>
    <pages validateRequest="false" />
  </system.web>
</configuration> 
```

# automation - 从文本文件渲染 UML 图

> ID：194754
> 
> 赞同：29
> 
> 时间：2008-10-11T22:39:20.470
> 
> 标签：automation, uml, svg

是否有任何好的工具或工具链允许从文本源文件创建 .svg 格式的 UML 图像？这个问题的原因是我想自动生成这些图像，以避免必须手动创建和更新这组图像。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-03T05:12:57.177

我在这里创建了一个接受文本模型描述作为输入的工具列表：

[http://modeling-languages.com/uml-tools-textual-notations-define-uml-models/](http://modeling-languages.com/uml-tools-textual-notations-define-uml-models/)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-09-20T07:08:36.753

[PlantUML](http://plantuml.sourceforge.net/)是一个很好的工具，可以将文本转换为标准化的 uml 图。

你有这个作为 confluenze 的插件

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-11T23:45:13.020

[UMLGraph](http://www.umlgraph.org/)是一个用于从基于文本的描述生成 UML 图（主要是类图和序列图）的程序。它旨在与 java 源代码一起使用，但经过一些更改，C++ 样式的源代码也可以按照[此博客条目](http://www.spinellis.gr/blog/20060921/)的描述使用。

引用 UMLGraph 网站：

> 然后，GNU plotutils [pic2plot](http://www.gnu.org/software/plotutils/plotutils.html)程序可以处理序列图以创建 PNG、PNM、（伪）GIF、**SVG**、AI、Postscript、CGM、FIG、PCL、HPGL、Regis 或 TEK 绘图。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-10T10:19:17.757

还有另一个称为[JS 序列图](http://bramp.github.io/js-sequence-diagrams/#message)的工具，允许从简单文本生成 UML 序列图。

它使用`underscore.js`和`Raphaël`构建图表。

它是经过简化的 BSD 许可的，源代码可在[GitHub 上获得](https://github.com/bramp/js-sequence-diagrams)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-09-07T05:42:31.967

我知道这是一个旧线程，但我仍然想分享一个我觉得非常有用且用户友好的工具：[https ://www.websequencediagrams.com/](https://www.websequencediagrams.com/)

这是一个在线工具，可让您立即启动并运行。

它还具有各种开箱即用的漂亮布局。
这里有两个例子：

![在此处输入图像描述](https://i.stack.imgur.com/3d6mR.png)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-02T12:55:30.290

[Enterprise Architect](http://www.sparxsystems.com/)在从源代码（各种语言）以及数据库或其他来源自动创建图表方面做得很好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-02-07T08:18:39.650

对于序列图，我真的很喜欢 Mscgen。输入简单的文本格式，输出可爱的图表。

“Mscgen 是一个小程序，它解析消息序列图描述并生成 PNG、SVG、EPS 或服务器端图像映射 (ismaps) 作为输出” - [http://www.mcternan.me.uk/mscgen/](http://www.mcternan.me.uk/mscgen/)

例如表格的输入：

```
# MSC for some fictional process
msc {
  hscale = "2";

  a,b,c;

  a->b [ label = "ab()" ] ;
  b->c [ label = "bc(TRUE)"];
  c=>c [ label = "process(1)" ];
  c=>c [ label = "process(2)" ];
  ...;
  c=>c [ label = "process(n)" ];
  c=>c [ label = "process(END)" ];
  a<<=c [ label = "callback()"];
  ---  [ label = "If more to run", ID="*" ];
  a->a [ label = "next()"];
  a->c [ label = "ac1()\nac2()"];
  b<-c [ label = "cb(TRUE)"];
  b->b [ label = "stalled(...)"];
  a<-b [ label = "ab() = FALSE"];
} 
```

产生如下输出：

![虚构过程的序列图](https://i.stack.imgur.com/rDco0.png)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T23:11:19.563

免费的 UML 工具[JUDE](http://jude.change-vision.com/jude-web/product/index.html)允许从 Java 源代码创建 UML 图。我不知道它是否适用于其他语言。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-10T11:24:54.543

如果你喜欢 JS 序列图，你还应该看看[UMLet](http://www.umlet.com/)，它有类似的前提（能够通过文本定义图表，类似于 graphviz 描述）并让工具找出图表和定位。

恕我直言，这种方法没有得到足够的宣传或牵引。完整的往返源分析很困难，而且在许多情况下，对于简单的设计对话或快速文档来说，“工作量太大”。企业工具中布局的复杂性使除了最大的文档之外的所有人都无法使用它们。敏捷遭受无文档的困扰，因为价格太高了。

出于这些原因，我希望看到更多工具采用这种方法。

# c# - .Net 表单 POST

> ID：194759
> 
> 赞同：1
> 
> 时间：2008-10-11T22:43:48.637
> 
> 标签：c#, asp.net, form-post

我有一个客户，在测试期间，它给了我相互矛盾的信息。我不认为他们在撒谎，而是更加困惑。所以，我想在我的 ASP.Net 应用程序中设置一些简单的审计。具体来说，当任何页面被调用时，我想立即将查询字符串和/或表单 POST 数据插入日志表。只是原始值。

查询字符串很容易。但是似乎没有办法在不使用 BinaryRead 的情况下获取原始表单 POST 数据，如果我这样做了，那么我稍后会不再使用 Request.Form 集合。

有谁知道解决这个问题的方法？

编辑：tvanfosson 建议 Request.Params。我一直在寻找更容易使用的东西（比如 Request.Querystring，仅用于 POST），但我想我可以轻松地遍历所有参数并构建一个 name=value& 字符串等）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T00:45:49.140

您可以创建一个自定义 HttpModule 来捕获对您的应用程序发出的所有请求，这样您就不需要触摸每个页面，并且您只能在测试期间使用它，以免降低生产中的性能。

一个示例实现将是：

```
public class CustomModule : IHttpModule 
{
    public void Init(HttpApplication context)
    {
        context.EndRequest += new EventHandler(context_BeginRequest);
    }

    private void context_BeginRequest(object sender, EventArgs e)
    {
        HttpContext context = ((HttpApplication)sender).Context;
        // you can use the context.Request here to send it to the database or a log file
    }
} 
```

您需要将该模块添加到您的 web.config

```
<httpModules>
    <add name="CustomModule" type="CustomModule"/>
</httpModules> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T22:54:54.293

所有表单数据都应该在[Request.Params](http://msdn.microsoft.com/en-us/library/system.web.httprequest.params.aspx)中。您需要在每个页面上执行此操作，或者可能使用 HttpModule。

[编辑] 如果您想单独使用[Request.Form](http://msdn.microsoft.com/en-us/library/system.web.httprequest.form.aspx)和 Request.QueryString获取表单参数

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T23:00:41.927

对于这种类型的场景，我建议实施 HttpHandler 或 HttpModule 。您可以从 Page_Load 事件中获取 POST 数据，但在此处实现此日志记录工具并不那么可维护。

# javascript - 使用javascript进行图像缩放？

> ID：194761
> 
> 赞同：2
> 
> 时间：2008-10-11T22:44:50.913
> 
> 标签：javascript, imaging

有没有人有一些好的代码来使用javascript放大图像？

我知道我可以调整它的大小等等，但是我很懒，正在寻找一些聪明的东西来缩放到不同的水平，缩放时四处移动等

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T22:59:26.903

检查这个：

*   [jQZoom](http://www.mind-projects.it/blog/jqzoom_v10)
*   [Zoomimage - jQuery 插件](http://www.eyecon.ro/zoomimage/)
*   [jQuery ImgZoom](http://plugins.jquery.com/project/imgzoom)
*   [花式盒](http://fancy.klade.lv/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T23:01:01.673

图片有多大？如果它们是巨大的图像，你可以使用这个[http://www.casa.ucl.ac.uk/software/googlemapimagecutter.asp像谷歌地图样式那样做](http://www.casa.ucl.ac.uk/software/googlemapimagecutter.asp)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-11T22:59:21.693

这真的取决于你所追求的质量。如果您需要具有详细缩放级别和适当插值的高质量图像，您将需要编写后端服务来提供图像的缩放部分。如果您不关心质量或速度，您可以下载整个图像并使其适合显示在绝对定位的 div 内，偏移您要查看的区域，并根据缩放级别确定大小。

我会说你可能在第一个选择之后。已经为此制作[了](http://blogs.zdnet.com/microsoft/?p=1252)一些工具，我个人没有使用任何工具；我相信其他人会发布您可以尝试的其他人的链接；我已经编写了自己的服务和客户端。我不能详细介绍它的专有信息，但我可以概述一下我的工作。

我有一个 asp.net 通用处理程序，它接受一个查询字符串，表示哪个图像（通过一个 id）和要放大的坐标和目标图像大小。我让服务加载图像并裁剪并调整大小（它比这更复杂，因为我在最初上传文件时进行了许多优化和准备，例如文件的多个横截面以便在缩放时更快地提供服务，但我描述的是这是基础知识）。

该服务仅返回类型 image/jpeg 并发送图像。

在客户端，我编写了一个选取框控件，允许用户在他们想要放大的图像上选取一个区域。他们选中该区域并单击缩放。然后，这会根据原始图像大小和可视图像大小计算所选坐标的图像偏移量。我将这些坐标发送到前面提到的处理程序。我将带有服务查询字符串的 url 加载到 Image 对象中，并处理 onload。如果一切顺利，我将其交换到查看的图像并更新我的所有客户端变量，以确定我放大图像的位置，然后可以再次放大或缩小或从那里进一步平移。

现在我了解您的懒惰要求，但我需要说的是，写这篇文章实际上很容易让基础知识得以实现。你会发现最难的部分是做一个选择框。但即使这样也可以像跟踪两次点击一样简单。缩放选择标记的左上角和右下角。或者根本没有选择框，并且仅以预定间隔进行放大和缩小。我在我的项目中需要一个缩放框，因为它是一个相当复杂的图像分析解决方案。

我希望这至少会有所帮助并引导您找到有用的东西。

# css - IE 中 pre-like 元素的 CSS

> ID：194762
> 
> 赞同：4
> 
> 时间：2008-10-11T22:46:11.127
> 
> 标签：css, internet-explorer

我想定义一个 CSS 类，它将提供与 HTML`<pre>`元素相同的样式。我试过这个：

```
.mystyle { 
   display: block;
   font-family: monospace;
   white-space: pre;
} 
```

它在 FF 上运行良好，但在 IE 上运行良好（不保留空格）。有人有线索吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-11T22:51:14.127

`white-space:pre`仅受 IE6 和更高版本支持。

您的页面可能没有`DOCTYPE`或已经过时，它可以在所有较新版本的 IE 中模拟 IE **5 。**

将 HTML4 Strict 添加`DOCTYPE`到您的文档中。确保之前没有任何其他内容`DOCTYPE`，因为 IE6 不会“看到”它。

# java - 如何让 java 日志输出显示在一行上？

> ID：194765
> 
> 赞同：143
> 
> 时间：2008-10-11T22:51:24.707
> 
> 标签：java, logging

目前，默认条目如下所示：

```
Oct 12, 2008 9:45:18 AM myClassInfoHere
INFO: MyLogMessageHere 
```

我如何让它做到这一点？

```
Oct 12, 2008 9:45:18 AM myClassInfoHere - INFO: MyLogMessageHere 
```

澄清我正在使用 java.util.logging

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2012-05-22T16:20:11.237

从 Java 7 开始，[java.util.logging.SimpleFormatter](http://docs.oracle.com/javase/7/docs/api/java/util/logging/SimpleFormatter.html#format%28java.util.logging.LogRecord%29)支持从系统属性获取其[格式](http://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html#syntax)，因此在 JVM 命令行中添加类似这样的内容将导致它在一行上打印：

```
-Djava.util.logging.SimpleFormatter.format='%1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS %4$s %2$s %5$s%6$s%n' 
```

或者，您也可以将其添加到您的`logger.properties`：

```
java.util.logging.SimpleFormatter.format='%1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS %4$s %2$s %5$s%6$s%n' 
```

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2011-05-09T14:00:02.173

## 1)`-Djava.util.logging.SimpleFormatter.format`

Java 7 支持具有`java.util.Formatter`格式字符串语法的属性。

```
-Djava.util.logging.SimpleFormatter.format=... 
```

见[这里](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6381464)。

我最喜欢的是：

```
-Djava.util.logging.SimpleFormatter.format=%1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS %4$-6s %2$s %5$s%6$s%n 
```

这使得输出如下：

```
2014-09-02 16:44:57 SEVERE org.jboss.windup.util.ZipUtil unzip: Failed to load: foo.zip 
```

## 2) 将其放入 IDE

IDE 通常允许您为项目设置系统属性。例如，在 NetBeans 中，不是在某处添加 -D...=...，而是在操作对话框中添加属性，形式为`java.util.logging.SimpleFormatter.format=%1$tY-%1$tm-...`- 不带任何引号。IDE 应该弄清楚。

## 3) 把它交给 Maven - Surefire

为了您的方便，以下是如何将其放入 Surefire：

```
<!-- Surefire -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>2.17</version>
    <configuration>
        <systemPropertyVariables>
            <!-- Set JUL Formatting -->
            <java.util.logging.SimpleFormatter.format>%1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS %4$-6s %2$s %5$s%6$s%n</java.util.logging.SimpleFormatter.format>
        </systemPropertyVariables>
    </configuration>
</plugin> 
```

## 4) 手工制作

我有一个[相关类](http://code.google.com/p/ondrazizka/source/browse/#svn%2Ftrunk%2FDwLib%2Fsrc%2Fmain%2Fjava%2Fcz%2Fdynawest%2Flogging)[很少`java.util.logging`](http://code.google.com/p/ondrazizka/source/browse/#svn%2Ftrunk%2FDwLib%2Fsrc%2Fmain%2Fjava%2Fcz%2Fdynawest%2Flogging)的库。其中，`SingleLineFormatter`. [可在此处](http://code.google.com/p/ondrazizka/source/browse/maven/cz/dynawest/lib/DwLib/1.01/DwLib-1.01-javadoc.jar)下载 jar 。

```
public class SingleLineFormatter extends Formatter {

  Date dat = new Date();
  private final static String format = "{0,date} {0,time}";
  private MessageFormat formatter;
  private Object args[] = new Object[1];

  // Line separator string.  This is the value of the line.separator
  // property at the moment that the SimpleFormatter was created.
  //private String lineSeparator = (String) java.security.AccessController.doPrivileged(
  //        new sun.security.action.GetPropertyAction("line.separator"));
  private String lineSeparator = "\n";

  /**
   * Format the given LogRecord.
   * @param record the log record to be formatted.
   * @return a formatted log record
   */
  public synchronized String format(LogRecord record) {

    StringBuilder sb = new StringBuilder();

    // Minimize memory allocations here.
    dat.setTime(record.getMillis());    
    args[0] = dat;

    // Date and time 
    StringBuffer text = new StringBuffer();
    if (formatter == null) {
      formatter = new MessageFormat(format);
    }
    formatter.format(args, text, null);
    sb.append(text);
    sb.append(" ");

    // Class name 
    if (record.getSourceClassName() != null) {
      sb.append(record.getSourceClassName());
    } else {
      sb.append(record.getLoggerName());
    }

    // Method name 
    if (record.getSourceMethodName() != null) {
      sb.append(" ");
      sb.append(record.getSourceMethodName());
    }
    sb.append(" - "); // lineSeparator

    String message = formatMessage(record);

    // Level
    sb.append(record.getLevel().getLocalizedName());
    sb.append(": ");

    // Indent - the more serious, the more indented.
    //sb.append( String.format("% ""s") );
    int iOffset = (1000 - record.getLevel().intValue()) / 100;
    for( int i = 0; i < iOffset;  i++ ){
      sb.append(" ");
    }

    sb.append(message);
    sb.append(lineSeparator);
    if (record.getThrown() != null) {
      try {
        StringWriter sw = new StringWriter();
        PrintWriter pw = new PrintWriter(sw);
        record.getThrown().printStackTrace(pw);
        pw.close();
        sb.append(sw.toString());
      } catch (Exception ex) {
      }
    }
    return sb.toString();
  }
} 
```

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2015-12-11T17:53:38.200

类似于 Tervor，但我喜欢在运行时更改属性。

请注意，这需要在创建第一个 SimpleFormatter 之前设置 - 正如评论中所写。

```
 System.setProperty("java.util.logging.SimpleFormatter.format", 
            "%1$tF %1$tT %4$s %2$s %5$s%6$s%n"); 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2008-10-13T12:10:25.310

就像 Obediah Stane 所说，有必要创建自己的`format`方法。但我会改变一些事情：

*   创建一个直接从 派生的子类`Formatter`，而不是从`SimpleFormatter`。`SimpleFormatter`没有什么可添加的了。

*   小心创建一个新`Date`对象！您应该确保代表`LogRecord`. 使用默认构造函数创建 new`Date`时，它将表示`Formatter`处理的日期和时间`LogRecord`，而不是`LogRecord`创建的日期。

下面的类可以[用作](http://java.sun.com/javase/6/docs/api/java/util/logging/Handler.html#setFormatter(java.util.logging.Formatter))a 中的格式化程序`Handler`，而后者又可以[添加](http://java.sun.com/javase/6/docs/api/java/util/logging/Logger.html#addHandler(java.util.logging.Handler))到`Logger`. 请注意，它会忽略`LogRecord`.

```
import java.io.PrintWriter;
import java.io.StringWriter;
import java.util.Date;
import java.util.logging.Formatter;
import java.util.logging.LogRecord;

public final class LogFormatter extends Formatter {

    private static final String LINE_SEPARATOR = System.getProperty("line.separator");

    @Override
    public String format(LogRecord record) {
        StringBuilder sb = new StringBuilder();

        sb.append(new Date(record.getMillis()))
            .append(" ")
            .append(record.getLevel().getLocalizedName())
            .append(": ")
            .append(formatMessage(record))
            .append(LINE_SEPARATOR);

        if (record.getThrown() != null) {
            try {
                StringWriter sw = new StringWriter();
                PrintWriter pw = new PrintWriter(sw);
                record.getThrown().printStackTrace(pw);
                pw.close();
                sb.append(sw.toString());
            } catch (Exception ex) {
                // ignore
            }
        }

        return sb.toString();
    }
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-08-19T08:49:49.933

这就是我正在使用的。

```
public class VerySimpleFormatter extends Formatter {

    private static final String PATTERN = "yyyy-MM-dd'T'HH:mm:ss.SSSXXX";

    @Override
    public String format(final LogRecord record) {
        return String.format(
                "%1$s %2$-7s %3$s\n",
                new SimpleDateFormat(PATTERN).format(
                        new Date(record.getMillis())),
                record.getLevel().getName(), formatMessage(record));
    }
} 
```

你会得到类似...

```
2016-08-19T17:43:14.295+09:00 INFO    Hey~
2016-08-19T17:43:16.068+09:00 SEVERE  Seriously?
2016-08-19T17:43:16.068+09:00 WARNING I'm warning you!!! 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-03-20T16:55:55.227

![Eclipse 配置](https://i.stack.imgur.com/0kOvJ.gif)

根据屏幕截图，在 Eclipse 中选择“run as”，然后选择“Run Configurations...”，然后使用双引号而不是引号添加 Trevor Robinson 的答案。如果你错过了双引号，你会得到“找不到或加载主类”错误。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-12T06:13:56.793

我想出了一个可行的方法。您可以继承 SimpleFormatter 并覆盖格式方法

```
 public String format(LogRecord record) {
        return new java.util.Date() + " " + record.getLevel() + " " + record.getMessage() + "\r\n";
    } 
```

对这个 API 有点惊讶，我原以为开箱即用会提供更多功能/灵活性

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2016-10-03T08:39:54.200

如果您使用 tomcat 登录 Web 应用程序，请添加：

```
-Djava.util.logging.ConsoleHandler.formatter = org.apache.juli.OneLineFormatter 
```

关于 VM 参数

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-10-12T01:00:10.920

如果您使用的是 java.util.logging，那么有一个配置文件正在执行此操作以记录内容（除非您使用的是编程配置）。因此，您的选择是
1）运行删除换行符的后处理器
2）更改日志配置并从中删除换行符。重新启动您的应用程序（服务器），您应该会很好。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-10-11T22:56:41.933

此日志记录特定于您的应用程序，而不是一般的 Java 功能。您正在运行什么应用程序？

这可能来自您在自己的代码中使用的特定日志库。如果是这样，请发布您正在使用的详细信息。

# smalltalk - 你如何使用吱吱声？

> ID：194784
> 
> 赞同：10
> 
> 时间：2008-10-11T23:02:41.157
> 
> 标签：smalltalk, squeak

我下载了 Squeak、Image 文件和 Sources 文件，但我不知道如何编写 Smalltalk 代码。我有什么明显的遗漏吗？Squeak 甚至是适合 Smalltalk 开发的正确 IDE 吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-11T23:16:35.403

请参阅[Squeak 网站上的教程列表](http://www.squeak.org/Documentation/)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-11T23:17:00.863

[这些视频](http://www.vimeo.com/groups/squeak/videos)是对 Squeak 的一个很好的简单介绍，尤其是[这个](http://www.vimeo.com/groups/squeak/videos/1362376)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-11T23:24:33.313

Squeak 是学习 Smalltalk 的绝佳环境，但不要将该特定实现与“Smalltalk”混淆。其他一些实现非常专业，但毫不奇怪会付出财务成本。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-16T17:06:43.010

给自己一份[Squeak by Example](http://www.squeakbyexample.org/)的副本。

作为免费的 PDF 或书籍。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-11T23:06:47.123

希望这会对您有所帮助：[http ://wiki.squeak.org/squeak/377](http://wiki.squeak.org/squeak/377)

这也是： http: [//www.cosc.canterbury.ac.nz/wolfgang.kreutzer/cosc205/smalltalk1.html](http://www.cosc.canterbury.ac.nz/wolfgang.kreutzer/cosc205/smalltalk1.html)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-12T13:37:04.923

Squeak 是一款出色的 IDE，适用于严肃的 Smalltalk 开发。这并不是说它不能改进。pharo 家伙正在从吱吱作响的图像中剔除您可能不希望用于专业发展的部分。

下载（或购买）Squeak by Example 一书以开始使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-11T23:17:23.653

我不认为 Squeak 真正面向“严肃的 Smalltalk 开发”。它旨在作为儿童的第一个编程环境。这并不是说你不能用它做有用的事情，它只是没有针对大规模开发。

查看[Wiki](http://wiki.squeak.org)以获取入门提示。自从我上次使用 Squeak 已经有一段时间了，但我不记得它特别难上手。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-26T07:02:33.197

Squeak 很适合学习这门语言，看看像它这样的系统有多么有创意，这有两个方面：你会看到许多有趣的想法和尝试的新概念，但也有很多垃圾和看起来很糟糕（有些甚至被放弃）的实验.

我承认，对于初学者来说，可能很难看到全局，或者根本没有全局。一个例子是使用多个 GUI 方案（MVC 与 Morphic）：当时，主流正在 MVC 上（他们只是在 Java 中理解，ST 人在 20 年前谈论过什么，所以他们从回调和 AW 到 Swing），Squeak 的家伙们接受了 MVC 并继续前进，尝试其他方法。吱吱声也缺乏“专业外观”。还有一个混乱的社区，其中一些是非常自我驱动的个人。

可以说，如果 Squeak 加在一起对 Smalltalk 的声誉是好是坏，因为它肯定会惹恼所有想要编写带有菜单栏、图标、工具栏等的“保守”Windows 应用程序的人。性能曾经也是一个问题（但因为 ELiot 正在开发虚拟机，所以越来越好......）

另一方面，还有其他环境中几乎不可能的精彩应用：看看槌球（墙上有一个浏览器，鱼在四处游动）、Etoys、Scratch、漂亮的 Seaside 应用程序等。还有几乎所有的东西现在被认为是主流的，起源于 Smalltalk 和 Squeak 社区。而这些家伙正在继续……

所以也请看看其他的 Smalltalk：至少有 GNU-ST、Visualworks 和 Smalltalk/X。后两者更偏向于经典的商业应用，语言和基础库几乎相同。不过，对于商业工作，大众汽车不是免费的。

# testing - 在类似敏捷的开发中，谁应该编写测试用例？

> ID：194790
> 
> 赞同：16
> 
> 时间：2008-10-11T23:06:04.800
> 
> 标签：testing, project-management, agile, testcase

我们的团队有一个任务系统，我们在其中发布分配给每个开发人员的小增量任务。

每个任务都在自己的分支中开发，然后在合并到主干之前对每个分支进行测试。

我的问题是：一旦任务完成，谁应该定义应该在这个任务上完成的**测试用例？**

理想情况下，我认为该任务的开发人员本人最适合这项工作，但我遇到了很多开发人员的反对，他们认为这是浪费时间，或者他们根本不喜欢这样做。

我不喜欢我的 QA 人员这样做的原因是因为我不喜欢他们创建自己的工作的想法。例如，他们可能会遗漏那些测试工作量太大的东西，并且他们可能不知道所需的技术细节。

但同样，开发测试用例的开发人员的缺点是他们可能会遗漏他们认为会破坏的东西。（甚至可能下意识地）

作为项目经理，我最终自己为每项任务编写了测试用例，但我的时间被占用了，我想改变这一点。

建议？

**编辑：通过测试用例，我的意思是在分支合并到主干之前应该对分支完成的各个 QA 任务的描述。（黑盒子）**

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-16T22:56:12.853

## 团队。

如果缺陷传给了客户，那是***团队的***错，因此***团队***应该编写测试用例以确保缺陷不会传给客户。

1.  **项目经理 (PM)**应该比团队中的任何人都更了解该领域。他们的领域知识对于拥有对该领域有意义的测试用例*至关重要。*他们需要提供示例输入并回答有关对无效输入的期望的问题。他们至少需要提供“快乐路径”测试用例。

2.  **开发人员**将知道代码。您建议开发人员可能最适合该任务，但您正在寻找黑盒测试用例。开发人员提出的任何测试都是白盒测试。这就是让开发人员创建测试用例的优势——他们知道代码中的接缝在哪里。

    优秀的开发人员也会向 PM 提出“什么时候……应该发生什么？”的问题。– 每一个都是一个测试用例。如果答案很复杂“如果*a*则*x*，但如果*b*则*y*，星期四除外”——有多个测试用例。

3.  **测试人员 (QA)**知道如何测试软件。测试人员很可能会提出 PM 和开发人员不会想到的测试用例——这就是为什么你有测试人员。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-11T23:18:27.537

我认为项目经理或业务分析师应该编写这些测试用例。
然后，他们应该将它们交给 QA 人员进行充实和测试。

这样，您可以确保规范与实际测试和交付的内容之间没有遗漏。

开发人员绝对不应该这样做，因为他们将测试他们的单元测试。所以这是浪费时间。

此外，这些测试将发现开发人员永远不会发现的错误，因为它们可能是由于对规范的误解，或者没有经过深思熟虑和正确实施的代码中的功能或路线。

如果您发现自己没有足够的时间，请雇用其他人或提拔某人担任此职位，因为这是交付出色产品的关键。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-11T23:17:47.147

我们尝试将开发人员与 QA 人员配对，结果非常好。他们通常“保持彼此诚实”，并且由于开发人员有单元测试来处理代码，她/他已经对这些更改非常熟悉。QA 人员不是从黑匣子方面来的。两人都对完整性负责。正在进行的审查过程的一部分有助于发现单元测试的缺点，因此我知道没有太多事件是我知道有人故意避免编写 X 测试，因为它可能会证明存在问题。

在某些情况下，我喜欢配对的想法，并认为它运作良好。可能并不总是有效，但让来自不同领域的玩家互动有助于避免经常发生的“把它扔到墙上”的心态。

无论如何，希望这对您有所帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-15T15:42:46.910

根据过去的经验，我们非常幸运地在不同级别定义测试以测试略有不同的事物：

第一层：在代码/类级别，开发人员应该编写原子单元测试。目的是尽可能地测试单个类和方法。这些测试应该由开发人员在编写代码时运行，大概是在将代码归档到源代码控制之前，如果正在使用持续集成服务器（自动），则应该运行这些测试。

第二层：在组件集成级别，再次让开发人员创建单元测试，但测试组件之间的集成。目的不是测试单个类和组件，而是测试它们如何相互交互。这些测试应该由集成工程师手动运行，或者由持续集成服务器自动运行（如果正在使用）。

第三层：在应用程序级别，让 QA 团队运行他们的系统测试。这些测试用例应该基于产品经理提供的业务假设或需求文档。基本上，就像您是最终用户一样进行测试，做最终用户应该能够做的事情，如文档中的 int eh 要求。这些测试用例应该由 QA 团队和产品经理编写，他们（大概）知道客户想要什么以及他们应该如何使用应用程序。

我觉得这提供了相当不错的覆盖率。当然，理想情况下，上面的第 1 层和第 2 层应该在将构建的应用程序发送给 QA 团队之前运行。当然，您可以将其调整为适合您的业务模型的任何内容，但这在我上一份工作中效果很好。如果在构建/集成过程中其中一个单元测试也失败了，我们的持续集成服务器会向开发团队发送一封电子邮件，以防有人忘记运行他们的测试并将损坏的代码提交到源存档中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-12T00:23:11.650

> 我不喜欢我的 QA 人员这样做的原因是因为我不喜欢他们创建自己的工作的想法。例如，他们可能会遗漏那些测试工作量太大的东西，并且他们可能不知道所需的技术细节。

是的，你需要对你的 QA 部门有更多的信任，或者一个更好的部门。我的意思是，想象一下你说过“我不喜欢让我的开发人员开发软件。我不喜欢他们创建自己的工作的想法。”

作为开发人员，我知道编写自己的测试存在风险。这并不是说我不这样做（我这样做，特别是如果我在做 TDD），但我对测试覆盖率没有任何幻想。开发人员将编写测试来表明他们的代码按照他们的想法做了。没有太多人会编写适用于手头实际业务案例的测试。

测试是一种技能，希望您的 QA 部门，或者至少该部门的领导者，都精通该技能。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-12T23:27:00.513

“开发人员认为这是在浪费时间，或者他们根本不喜欢这样做”然后奖励他们。让他们创建测试用例需要什么社会工程学？

QA 能否查看代码和测试用例并说出“没有足够的覆盖范围——需要更多用例”。如果是这样，那么立即拥有“足够”覆盖范围的程序员将是 Big Kahuna。

所以，我的问题是：一旦任务完成，谁应该为这个任务定义“足够”测试用例的目标？一旦知道“足够”，您就可以让程序员负责填写“足够”，让 QA 负责确保完成“足够”测试。

很难定义“足够”？有趣的。可能这首先是与程序员发生冲突的根本原因。他们可能会觉得这是在浪费他们的时间，因为他们已经做得“足够”了，而现在有人说这还“不够”。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-15T16:00:54.470

QA 人员，连同“客户”，应该为每个任务*定义*测试用例[我们在这里真的混合了术语]，并且开发人员应该编写它们。第一的！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T18:36:03.800

选择（不仅仅是随机挑选）一两个测试人员，让他们编写测试用例。审查。如果处理任务的开发人员查看任务的测试用例，它也可能很有用。鼓励测试人员提出改进和增加测试集的建议——有时人们害怕修复老板所做的事情。这样你可能会找到擅长测试设计的人。

让测试人员了解技术细节——我认为敏捷团队中的每个人都应该拥有对代码和任何可用文档的阅读权限。我认识的大多数测试人员都可以阅读（和编写）代码，因此他们可能会发现单元测试很有用，甚至可能扩展它们。确保测试设计人员从开发人员那里得到有用的答案，如果他们需要知道一些事情的话。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-15T15:52:01.163

我的建议是在合并代码之前让其他人查看测试用例以确保质量。当然，这可能意味着一个开发人员正在忽略另一个开发人员的工作，但第二组眼睛可能会捕捉到最初没有捕捉到的东西。初始测试用例可以由任何开发人员、分析师或经理完成，而不是测试人员。

QA 不应该编写测试用例，因为它们可能是未定义预期结果的情况，此时，如果每一方都认为他们的解释是正确的，那么在 QA 和开发之间可能很难有人裁判。这是我见过很多次的事情，但希望它不会像现在这样经常发生。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-15T15:55:17.320

我将我的测试松散地分解为“开发人员”测试和“客户”测试，后者将是“验收测试”。前者是开发人员编写的用于验证其代码是否正确执行的测试。后者是开发人员以外的其他人编写的测试，*以*确保行为符合规范。开发人员绝*不能*编写验收测试，因为他们创建正在测试的软件假定他们做了正确的事情。因此，他们的验收测试可能会断言开发人员已经知道是真实的。

验收测试应该由规范驱动，如果它们是由开发人员编写的，它们将由代码驱动，因此由当前行为驱动，而不是由期望的行为驱动。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-31T07:01:23.747

**敏捷规范**是您应该（至少）有两层测试：开发人员测试和客户测试。

**开发人员测试**由编写生产代码的同一个人编写，最好使用*测试驱动开发*。它们有助于提出良好的解耦设计，并确保代码按照开发人员认为的方式运行——即使在重构之后也是如此。

**客户测试**由客户或客户代理*指定。*实际上，它们是系统的规范，并且应该以一种既可执行（完全自动化）*又*可供业务人员理解的方式编写。通常情况下，团队会在 QA 人员的帮助下找到让客户*编写它们的方法。*这应该在功能开发时（甚至之前）发生。

理想情况下，QA 在合并之前要做的唯一任务是按下按钮运行所有自动化测试，并进行一些额外的探索性（=非脚本）测试。*您还需要在合并后再次运行这些测试，以确保集成更改不会破坏某些内容。*

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-12T17:36:08.700

**测试用例首先在故事卡中开始。**

测试的目的是将缺陷推向左侧（在软件开发过程的早期，当它们更便宜且修复速度更快时）。

每张故事卡都应包括验收标准。产品负责人与解决方案分析师配对以定义每个故事的验收标准。此标准用于确定故事卡的目的是否已达到。

故事卡验收标准将确定开发人员在进行测试驱动开发时需要编写哪些自动化单元测试。它还将推动由自动化测试人员实现的自动化功能测试（如果使用 FIT 等工具，可能还需要开发人员的支持）。

同样重要的是，验收标准将推动自动化性能测试，并且可以在开发人员分析应用程序的配置文件时使用。

最后，用户验收测试将由故事卡中的验收标准确定，并应由业务合作伙伴和/或用户设计。遵循此过程，您可能会发布零缺陷。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-04-11T19:57:32.090

除了在较小的团队中，我很少听说或见过项目经理编写测试用例。*在任何大型、复杂的软件应用程序中都必须有一个真正*了解该应用程序的分析师。我曾在一家抵押贷款公司担任 PM - 我是否了解次级贷款、利率等？也许在肤浅的层面上，但真正的专家需要确保这些事情奏效。我的工作是保持团队健康，保护敏捷原则，并为我的团队寻找新的工作机会。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-09-18T15:54:32.577

系统分析师应该审查所有测试用例及其与用例的正确关系。另外，分析师应该执行最终的 UAT，这也可以基于测试用例。所以分析师和质量专家正在进行同行评审。

质量是在构建测试用例时审查用例，而分析师在编写测试用例后和执行 UAT 时审查测试用例。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-02-11T15:48:17.417

当然，BA 是领域专家，而不是从技术角度来看。BA 了解需求，并且测试用例应该映射到需求。开发人员不应该是编写测试用例来测试他们的代码的人。QA 可以根据要求编写详细的测试步骤。但是编写需求的人应该指定需要测试的内容。测试用例到底是谁写的，我不太在意，只要测试用例可以追溯到需求。我认为 BA 指导测试方向或范围是有道理的，而 QA 编写细粒度的测试计划。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-08-19T21:22:21.167

We need to evolve from the "this is how it has been done or should be done mentality" it is failing and failing continuously. The best way to resolve the test plan/cases writing issue is that test cases should be written on the requirements doc in waterfall or the user story in agile as those reqs/user stories are being written. This way there is no question what needs to be tested and QA and UAT teams can execute the test case(s) and focus time on actual testing and defect resolution.

# asp.net - Lucene.Net 在我的主机上失败，因为它调用 GetTempPath()。有什么工作？

> ID：194795
> 
> 赞同：2
> 
> 时间：2008-10-11T23:07:26.873
> 
> 标签：asp.net, permissions, lucene, lucene.net

我在共享主机上的 ASP.NET 应用程序中使用 Lucene.Net。得到了如下所示的堆栈跟踪。有什么工作？

[SecurityException：请求'System.Security.Permissions.EnvironmentPermission，mscorlib，Version = 2.0.0.0，Culture = Neutral，PublicKeyToken = b77a5c561934e089'类型的权限失败。] System.Security.CodeAccessSecurityEngine.Check（对象需求，StackCrawlMark和stackMark , Boolean isPermSet) +0 System.Security.CodeAccessPermission.Demand() +59 System.IO.Path.GetTempPath() +54 Lucene.Net.Store.FSDirectory..cctor() +73

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T01:35:36.653

这是我自己的问题的答案。解决方案是通过注释掉这个未使用的行来修改 Lucene.Net.Store.FSDirectory：

```
// Comments out by Corey Trager, Oct 2008 to workaround permission restrictions at shared host.  This is not used.
//        public static readonly System.String LOCK_DIR = SupportClass.AppSettings.Get("Lucene.Net.lockDir", System.IO.Path.GetTempPath()); 
```

在那之后还有一个安全许可障碍，这也是解决方法。我不明白为什么一种获取目录中文件名的方式会被阻止，而另一种方式不会被阻止。

```
 public override System.String[] List()
    {

/* Changes by Corey Trager, Oct 2008, to workaround permission restrictions at shared host */
            System.IO.DirectoryInfo dir = new System.IO.DirectoryInfo(directory.FullName);
            System.IO.FileInfo[] files = dir.GetFiles();
            string[] list = new string[files.Length];
            for (int i = 0; i < files.Length; i++)
            {
                list[i] = files[i].Name;
            }
            return list;
/* end of changes */

//            System.String[] files = SupportClass.FileSupport.GetLuceneIndexFiles(directory.FullName, IndexFileNameFilter.GetFilter());
//            for (int i = 0; i < files.Length; i++)
//            {
//                System.IO.FileInfo fi = new System.IO.FileInfo(files[i]);
//                files[i] = fi.Name;
//            }
//            return files;
        } 
```

# javascript - 使用 CSS 或 JavaScript 自动创建两列

> ID：194803
> 
> 赞同：11
> 
> 时间：2008-10-11T23:12:59.483
> 
> 标签：javascript, css, two-columns

我目前正在开发一个网站，我的客户希望各种文章的文本溢出到两列中。有点像在报纸上？所以它看起来像：

```
Today in Wales, someone actually      Nobody was harmed in
did something interesting.            the incident, although one 
Authorities are baffled by this       elderly victim is receiving
development and have arrested the     counselling.
perpetrator. 
```

[我想写点东西的尝试真的很糟糕]

有没有办法只用 CSS 来做到这一点？我宁愿不必使用多个 div。我也对使用 JavaScript 持开放态度，但我 - 真的 - 不擅长，所以我们将不胜感激。我在想也许 JavaScript 可以计算内容 div 中有多少 <p>，然后根据它移动它们的后半部分以向右浮动？也许？建议将不胜感激：D

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-11T23:31:00.397

好消息是，有一个[CSS only 解决方案](http://www.w3.org/TR/css3-multicol/)。[坏消息是，在现有的浏览器](http://en.wikipedia.org/wiki/Comparison_of_layout_engines_(CSS))中没有对它的任何主要支持。如果它被实施，它看起来像这样：

```
div.multi {
  column-count: 3
  column-gap: 10px;
  column-rule: 1px solid black;      
} 
```

我认为现在你最好的选择可能是一氧化碳提到的服务器端

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-11T23:24:12.703

我可能会在您的后端处理它，无论发生什么。PHP 中的示例可能如下所示：

```
$content = "Today in Wales, someone actually did something...";
// Find the literal halfway point, should be close to the textual halfway point
$pos = int(strlen($content) / 2);
// Find the end of the nearest word
while ($content[$pos] != " ") { $pos++; }
// Split into columns based on the word ending.
$column1 = substr($content, 0, $pos);
$column2 = substr($content, $pos+1); 
```

应该可以用 InnerHTML 在 JavaScript 中做类似的事情，但我个人会避免这种情况，因为越来越多的人正在使用像 NoScript 这样的插件，它会禁用 JavaScript，直到它被明确允许用于 x 站点，最重要的是，div 的和 CSS 旨在很好地降级。在这种情况下，JavaScript 解决方案会严重退化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-11T23:31:07.073

[这是一个 JQuery 插件](http://welcome.totheinter.net/2008/07/22/multi-column-layout-with-css-and-jquery/)，它自动生成列，甚至可以根据屏幕大小改变列数。

我自己没有用过，但请检查一下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-11T23:58:29.657

如果您使用的是 Mootools，您可以查看[MooColumns](http://greengeckodesign.com/projects/moocolumns.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T08:14:26.893

This is difficult to achieve in HTML/CSS/JS for a reason (although I'm sure it's possible).

Newspapers use multiple columns to reduce the line width make text more readable. This is fine on paper because when you finish one column you flip your eye up to the beginning of the next.

On the web we use scrolling to allow text to continue past the bounds of the screen therefore don't need columns.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-11T23:21:07.063

首先，我不认为只有 css 可以做到这一点，但我很想被证明是错误的。

其次，仅计算段落对您根本没有帮助，您至少需要所有高度并据此计算文本高度的中间值，但您必须考虑调整窗口大小等。我认为没有是一个相当简单的现成解决方案。不幸的是，我对找到一个完美解决这个问题的方法感到悲观，但这是一个有趣的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-09-17T14:34:16.230

这在仅 Mozilla 的 CSS 扩展中受支持：`-moz-column-count`. 请参阅：[https ://developer.mozilla.org/en/CSS3_Columns](https://developer.mozilla.org/en/CSS3_Columns)

# xslt - XSLT 中的 Webtextedit Mousemove 事件

> ID：194805
> 
> 赞同：0
> 
> 时间：2008-10-11T23:15:02.880
> 
> 标签：xslt, webtextedit

我需要帮助。

在 xml 和 WebtextEdit 中没有线索，我正在编辑一个创建 asp 控件的 xslt 样式表。

下面是 WebTextEdit 控件，我想添加一个 mousemove 事件：

```
 <xsl:element name="igtxt:WebTextEdit">
        <xsl:attribute name='id'><xsl:value-of select='$Name' /></xsl:attribute>
        <xsl:attribute name='runat'>server</xsl:attribute> 
 <xsl:attribute name='Text'><xsl:value-of select='$Value' disable-output-escaping="yes" /></xsl:attribute>                                                      <xsl:attribute name='MouseMove'>"<xsl:value-of select='@name' />".style.color = '#006AB6';</xsl:attribute>
 <xsl:for-each select="$Attributes/Attribute">
          <xsl:if test=". != ''">
            <xsl:attribute name='{@name}'><xsl:value-of select='.' /></xsl:attribute>
          </xsl:if>
        </xsl:for-each>
        <xsl:copy-of select="$Events" />
      </xsl:element> 
```

该代码用于更改样式，因为它适用于其他对象。

请协助我如何将鼠标悬停事件添加到 WebTextEdit 控件

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-27T08:47:56.520

If you always want to run the same (static) JavaScript or dynamic JavaScript generated with XSLT, use the same method as is used to add the id, runat, and Text attributes:

```
<xsl:attribute name="mouseover">alert('test');</xsl:attribute> 
```

If each control needs to execute different (static) JavaScript, just add an onmouseover attribute to the XML element that triggers this template. The loop will read any attributes in the XML element and pass them on to the generated markup.

# drupal - Drupal 5 中的批处理节点操作

> ID：194821
> 
> 赞同：3
> 
> 时间：2008-10-11T23:25:16.663
> 
> 标签：drupal

遍历和更新 drupal 站点中每个节点的最有效方法是什么，例如以机械方式添加标签？Drupal 6 有一个闪亮的新批处理 API，但是在 Drupal 5 中做什么呢？

我开始编写一个保留指针的脚本，然后遍历 cron 上的所有节点，加载它们，然后保存它们，但我想知道还能做什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T12:22:35.987

我不建议直接在数据库级别上工作，因为某些模块可能想要更新其他一些相关的表。最可靠和灵活的方法是编写一个脚本来循环加载、更改和保存节点。您还可以尝试为 Drupal 5 使用额外的特殊模块：

*   [分类节点操作](http://drupal.org/project/taxonomy_node_operations)
*   [分类法多编辑器](http://drupal.org/project/taxonomy_multi_edit)（类似功能）
*   和更通用的模块[查看批量操作](http://drupal.org/project/views_bulk_operations)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T10:46:50.223

考虑[作业队列](https://www.drupal.org/project/job_queue)模块。这是关于它的引用（来自模块的项目页面）：

> ...模块用于对函数调用进行排队以在 cron 上执行。模块使用 job_queue_add() 函数将作业添加到队列中
> 
> 这个模块是 Drupal 7 的生命周期结束，[在 core 中有一个队列](http://api.drupal.org/api/drupal/modules--system--system.queue.inc/7/source)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-11T23:37:30.383

嗯，我不熟悉 drupal 5 的数据库结构，但如果它与 drupal 6 足够相似，您可以通过在`term_node`表格之外轻松地修改这一切。它是节点 ID 到术语 ID 的映射器：

```
term_node
- nid
- vid
- tid 
```

nid 当然是节点 id，vid 是修订版 id，如果你使用修订版，tid 是术语 id。条款都存储在`term_data`

```
term_data
- tid
- name 
```

是更有趣的列。因此，如果您已经有现有术语，则可以创建现有 tid 的快速映射，然后添加到 term_node 中所需的任何节点。无论如何，在这方面粗心可能会导致奇怪的数据问题，所以我不会建议这种方法，除非您对原始数据库感到非常满意。

# c - 如何初始化指向结构的指针数组？

> ID：194828
> 
> 赞同：16
> 
> 时间：2008-10-11T23:31:14.033
> 
> 标签：c, pointers, struct

是否可以初始化指向结构的指针数组？就像是：

```
struct country_t *countries[] = {
        {"United States of America", "America"},
        {"England", "Europe"},
        {"Ethiopia", "Africa"}  
    } 
```

我想这样做是为了将实体放在不连续的内存中，并将指向它们的指针放在连续的内存中......但我不能使用动态内存，所以我想知道没有它是否可行。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-11T23:39:15.747

好吧，您的代码使用结构而不是指向结构的指针。有多种方法可以满足您的需求，包括：

```
static struct country_t us = { "United States of America", "America" };
static struct country_t uk = { "England",                  "Europe"  };
static struct country_t et = { "Ethiopia",                 "Africa"  };

struct country_t *countries[] = { &us, &uk, &et, }; 
```

在 C99 中，还有其他方法可以使用指定的初始化程序和复合文字。第 6.5.2.5 节“复合文字”显示了这种方式：

```
struct country_t *countries[] =
{
    &(struct country_t) { "United States of America", "America" },
    &(struct country_t) { "England",                  "Europe"  },
    &(struct country_t) { "Ethiopia",                 "Africa"  },
}; 
```

该标准通过函数调用说明了指向结构的指针。请注意，并非所有 C 编译器都接受 C99 语法，并且这些复合文字在 C89（又名 C90）中不存在。

*编辑：*升级为使用 2 个字母的 ISO 3166 国家代码。还将命名结构变成静态变量——这些符号之前在文件外不可见（因为它们不存在），现在它们在文件外也不可见。我争论过是否做任何事情 const 并决定不做——但在可能的情况下使用 const 通常是一个好主意。此外，在示例中，有 3 个大洲的 3 个国家/地区。如果您在一个大陆上有多个国家（标准），您可能希望能够共享大陆字符串。但是，您是否可以安全地（或完全）做到这一点取决于`struct country_t`（未给出）的详细信息，以及是否允许程序更新表（这又回到了 const-ness 问题）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T23:45:26.077

这对我有用：

```
 struct country_t {
    char *fullname;
    char *shortname;
};

struct country_t countries[] = {
        {"United States of America", "America"},
        {"England", "Europe"},
        {"Ethiopia", "Africa"}
};

int main(int argc, char *argv[])
{
    return 0;
} 
```

您可以更简洁并使用：

```
 struct country_t {
    char *fullname;
    char *shortname;
} countries[] = {
        {"United States of America", "America"},
        {"England", "Europe"},
        {"Ethiopia", "Africa"}
};

int main(int argc, char *argv[])
{
    return 0;
} 
```

**编辑：**我在[The C Book找到了这些信息](http://publications.gbdirect.co.uk/c_book/chapter6/initialization.html)

# unit-testing - 您的项目的代码覆盖率是多少？

> ID：194836
> 
> 赞同：3
> 
> 时间：2008-10-11T23:35:51.917
> 
> 标签：unit-testing, code-coverage

你项目的代码覆盖率是多少？我很好奇为什么。

开发团队对此满意吗？如果没有，增加它的障碍是什么？

Stuart Halloway 的项目目标是 100%（否则构建会中断！）。有人在那个水平吗？

我们处于痛苦的 25%，但渴望 80-90% 的新代码。我们有遗留代码，我们决定在它消失时不去管它（我们正在积极重写）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T23:46:38.697

我们以 85% 的代码覆盖率运行，但低于它并不会破坏构建。我认为使用代码覆盖率作为重要指标是一种危险的做法。仅仅因为某些东西在测试中被覆盖并不意味着覆盖是好的。我们尝试将其用作我们覆盖范围较弱的领域的指导，而不是作为一个硬性事实。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T00:44:59.047

80% 是里程碑的退出标准。如果我们没有通过 sprint（即使我们确实提前计划了时间），我们会通过稳定来添加它。我们可能会针对特定组件或功能进行例外处理，但我们会为下一个里程碑打开 Pri 1 项目。

在编码期间，代码覆盖率会在每日构建时自动测量，并将报告发送给整个团队。任何低于 70% 的东西都是黄色的，低于 50% 的东西是红色的。我们目前没有使构建失败，但我们计划在下一个里程碑中添加它。

不确定开发人员的快乐与单元测试有什么关系。聘请开发人员来构建优质产品，并且应该有一个流程来执行最低质量和衡量它的方法。如果有人对该过程不满意，他们可以自由地提出另一种验证其代码的方法，然后再将其与其余组件集成。

顺便说一句，我们也在自动化场景测试中测量代码覆盖率。因此，我们有三个 unmbers——单元、场景和组合。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T13:50:02.240

我们公司的目标是 80% 的语句覆盖率，包括异常处理代码。就个人而言，我喜欢在我检查的所有东西上都超过 90%。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T20:12:34.100

几年前我做的一个项目实现了 100% 的线路覆盖率，但我完全控制了它，因此我可以执行目标。
我们现在的目标是覆盖 50% 的新代码，这个数字在不久的将来会上升，但无法衡量。我们很快就会有工具来测量每晚运行单元测试的代码覆盖率，所以我相信我们的情况会有所改善。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T13:22:39.347

我经常在我们的自动化测试套件下使用代码覆盖率，但主要是为了寻找未测试的区域。我们大部分时间都得到大约 70% 的覆盖率，并且永远不会达到 100%，原因有两个；

1) 我们通常会在发布**后**自动执行新功能，这些功能会在首次发布时进行手动测试，因此不包含在覆盖率分析中。在我们的案例中，自动化主要用于功能回归，并且是执行和调整代码覆盖率的最佳场所。

2) 需要故障注入才能获得 100% 的覆盖率，因为您需要进入执行处理程序。自动化是困难且耗时的。我们目前不这样做，因此永远不会得到 100%。Jame 的 Whittakers 关于[破解软件](https://rads.stackoverflow.com/amzn/click/com/0201796198)的书籍很好地涵盖了这个主题，任何有兴趣的人都可以阅读。

还值得记住的是，代码覆盖率并不等同于测试覆盖率，正如SQAforums 上的[this](http://www.sqaforums.com/showflat.php?Number=426373)和[this等线程中经常讨论的那样。](http://www.sqaforums.com/showflat.php?Cat=0&Number=293776&an=&page=0&vc=1)因此，100% 的代码覆盖率可能是一个误导性指标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T13:46:39.173

几年前[，我测量了 Perl 的测试覆盖率](http://books.google.gr/books?id=vEN-ckcdtCwC&pg=PA443&lpg=PA443&dq=perl+test+coverage+spinellis&source=web&ots=sF1me24MtH&sig=OJbnYuZjM0EMSDMyWkkEObc33jo&hl=en&sa=X&oi=book_result&resnum=3&ct=result)。在 250 个测试用例结束时，它达到了 70% 的代码和 33% 的完全测试分支

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T13:59:09.803

0% 可悲的是在我们的工作场所。将致力于改善这一点，但试图告诉老板我们需要它，这并不容易，因为他们看到了测试！= 编码更少的钱。

# css - 是否可以使用带有阴影、文本轮廓和/或渐变等特殊效果的 CSS 来制作一种链接/按钮样式？

> ID：194842
> 
> 赞同：0
> 
> 时间：2008-10-11T23:42:23.213
> 
> 标签：css, graphics

是否可以使用 CSS制作这样的按钮（[http://img225.imageshack.us/img225/6452/buttonslw9.jpg ）？](http://img225.imageshack.us/img225/6452/buttonslw9.jpg)它应该是菜单，PHP 只会将文本提供给 html/css，而 css 应该负责设计。

也许我想要太多的 CSS - 尤其是文本的红色轮廓..？有什么想法可以在不在图形编辑器中手动执行这些按钮的情况下实现这样的结果吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T00:12:23.590

“纯”解决方案在最新的 Safari 中具有`text-shadow`,`-webkit-text-stroke`和`-webkit-gradient`属性（在[Safari 博客](http://webkit.org/blog/175/introducing-css-gradients/)中解释）是可能的。

`background-image`您还可以在 Opera 9.5 和 Safari 中使用 SVG + CSS 。

一个适用于多个尖端浏览器的实用解决方案是使用[GD 库](http://php.net/gd)在服务器端生成图像。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T00:08:20.727

没有跨浏览器的方法可以做到这一点（正如你所说，尤其是红色文本轮廓），但是 Webkit 和 Gecko 团队正在实现一些很酷的 CSS 东西，比如带有实验性 CSS 属性的渐变浮雕。

您可能会看到 jQuery 可以为您做什么。它做了一些超越 CSS 的非常酷的类似 CSS 的事情。

# php - 将 MySQL select 语句放在一个类中而将 CRUD 语句放在一个子类中是否过大？

> ID：194843
> 
> 赞同：2
> 
> 时间：2008-10-11T23:42:50.187
> 
> 标签：php, design-patterns

我有 2 个用于访问数据库的类：

MovieDAO - 仅使用“选择”语句访问数据库；目的是检索数据以在 Web 浏览器中显示。

和

MovieExtendedDAO（扩展 MovieDAO）——它更完整，除了继承的功能外，还允许创建/更新/删除电影。此类仅用于站点的管理区域。

有人告诉我，像这样分开它是矫枉过正的。

这是做事的正常方式还是设计模式的一部分？或者这样做没有真正的好处？我的主要目的是为公共方面简化事情：一种优化需要加载多少东西以及在公共（非管理员）方面可能发生什么样的事情。谢谢您的意见！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T23:51:06.643

这不是一个坏方法，它基本上是一个[行数据网关](http://martinfowler.com/eaaCatalog/rowDataGateway.html)。从这个意义上说，我认为您的 movieDAO 更像是一个发现者，（与 fowler 使用相同的术语），而您的 movieextendeddao 则是一个网关（即 MovieFinder 和 MovieGateway）。

一旦您开始获得更复杂的域逻辑（即计算有关电影的各种事物），您就可以查看其他一些数据访问模式，但您的方法对于您正在做的事情似乎是合理的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T00:32:52.630

这不是矫枉过正。当然，有更好的方法来限制对代码的访问。但是您正在做的是将数据检索（记录数组）与修改数据（单个记录，实例）分开。

也许你可以给你的类起不同的、更有意义的名字。您可以使用 MovieQuery 代替 MovieDAO，而您可以使用 Movie 代替 MovieExtendedDAO。你保持功能。像现在一样分开，但使课程更加不言自明。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T00:22:46.190

您应该考虑为什么要分开课程。如果是出于性能考虑（不为简单的读取加载更大的类），那么您肯定会过早地进行优化。在您从实际数据中得知存在这种需求之前，您不应做出此类决定（我认为这永远不会发生。如果您担心大型类，请使用 APC 或其他一些字节码缓存）。

关于权限 - 这应该是应用程序逻辑，而不是物理地将方法分成不同的类。另外，您不是在扩展抽象此类操作的基本 DAO 吗？您不会在每个模型上实现单独的插入/删除/更新方法吗？这些操作变化不大，应该属于一个共同的父类。

我建议你看看 PHP 中数据库抽象的一些好的开源实现，例如[Zend_Db](http://framework.zend.com/manual/en/zend.db.html)（我强烈推荐）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T10:34:28.373

The main problem I see here is that you are mixing *permissions* ( Control ) with *database access* ( Model ). I goes against the *Model - View - Controler* architecture but no I am not saying everybody needs to use it. It is a kind of complex pattern. It may have advantages over your solution. **Does a change in your permissions affect your class model?** I think so.

Appart from MVC there may be other ways to control access. At the database ( by users, for example ).

# javascript - JavaScript中是否有任何类型的哈希码函数？

> ID：194846
> 
> 赞同：164
> 
> 时间：2008-10-11T23:45:37.763
> 
> 标签：javascript, hash, set, hashcode

基本上，我正在尝试创建一个独特对象的对象，一个集合。我有一个绝妙的想法，就是使用带有对象作为属性名称的 JavaScript 对象。如，

```
set[obj] = true; 
```

这在一定程度上有效。它适用于字符串和数字，但对于其他对象，它们似乎都“散列”到相同的值并访问相同的属性。有什么方法可以为对象生成唯一的哈希值吗？字符串和数字是如何做到的，我可以覆盖相同的行为吗？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2011-11-10T08:01:44.717

如果你想要一个 hashCode() 函数，比如 JavaScript 中的 Java，那就是你的：

```
String.prototype.hashCode = function(){
    var hash = 0;
    for (var i = 0; i < this.length; i++) {
        var character = this.charCodeAt(i);
        hash = ((hash<<5)-hash)+character;
        hash = hash & hash; // Convert to 32bit integer
    }
    return hash;
} 
```

这就是Java（按位运算符）中的实现方式。

请注意，hashCode 可以是正数和负数，这很正常，请参阅[HashCode 给出负值](https://stackoverflow.com/questions/9249983/hashcode-giving-negative-values)。因此，您可以考虑`Math.abs()`与此功能一起使用。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-12T00:42:56.663

JavaScript 对象只能使用字符串作为键（其他任何东西都被转换为字符串）。

或者，您可以维护一个对相关对象进行索引的数组，并将其索引字符串用作对该对象的引用。像这样的东西：

```
var ObjectReference = [];
ObjectReference.push(obj);

set['ObjectReference.' + ObjectReference.indexOf(obj)] = true; 
```

显然它有点冗长，但您可以编写几个方法来处理它并随意获取和设置所有内容。

编辑：

> 您的猜测是事实——这是 JavaScript 中定义的行为——特别是发生了 toString 转换，这意味着您可以在将用作属性名称的对象上定义自己的 toString 函数。- 奥利耶

这带来了另一个有趣的观点；您可以在要散列的对象上定义一个 toString 方法，这可以形成它们的散列标识符。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-05-20T02:51:59.897

最简单的方法是为每个对象赋予其独特的`toString`方法：

```
(function() {
    var id = 0;

    /*global MyObject */
    MyObject = function() {
        this.objectId = '<#MyObject:' + (id++) + '>';
        this.toString= function() {
            return this.objectId;
        };
    };
})(); 
```

我遇到了同样的问题，这对我来说完美地解决了它，而且几乎没有大惊小怪，并且比重新实现一些肥胖的 Java 风格`Hashtable`并添加`equals()`和添加`hashCode()`到您的对象类要容易得多。只需确保您没有将字符串 '<#MyObject:12> 粘贴到您的哈希中，否则它将清除具有该 ID 的现有对象的条目。

现在我所有的哈希都完全变冷了。几天前我也刚刚发布了一篇关于[这个确切主题](http://strd6.com/?p=276)的博客文章。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2011-11-10T09:31:39.277

[Harmony WeakMaps](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/WeakMap)涵盖了您所描述的内容，它是[ECMAScript 6](http://en.wikipedia.org/wiki/ECMAScript#Versions)规范（JavaScript 的下一个版本）的一部分。那就是：一个集合，其中的键可以是任何东西（包括未定义的）并且是不可枚举的。

这意味着除非您直接引用链接到它的键（任何对象！），否则不可能获得对值的引用。这对于与效率和垃圾收集相关的一系列引擎实现原因很重要，但它也非常酷，因为它允许新的语义，如可撤销的访问权限和传递数据而不暴露数据发送者。

来自[MDN](https://en.wikipedia.org/wiki/Mozilla_Developer_Network)：

```
var wm1 = new WeakMap(),
    wm2 = new WeakMap();
var o1 = {},
    o2 = function(){},
    o3 = window;

wm1.set(o1, 37);
wm1.set(o2, "azerty");
wm2.set(o1, o2); // A value can be anything, including an object or a function.
wm2.set(o3, undefined);
wm2.set(wm1, wm2); // Keys and values can be any objects. Even WeakMaps!

wm1.get(o2); // "azerty"
wm2.get(o2); // Undefined, because there is no value for o2 on wm2.
wm2.get(o3); // Undefined, because that is the set value.

wm1.has(o2); // True
wm2.has(o2); // False
wm2.has(o3); // True (even if the value itself is 'undefined').

wm1.has(o1);   // True
wm1.delete(o1);
wm1.has(o1);   // False 
```

WeakMaps 在当前的 Firefox、Chrome 和 Edge 中可用。`--harmony-weak-maps`Node v7 和带有标志的 v6 也支持它们。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-04-26T13:10:36.263

我选择的解决方案类似于 Daniel 的解决方案，但我没有使用对象工厂并覆盖 toString，而是在第一次通过 getHashCode 函数请求对象时显式地将哈希添加到对象中。有点乱，但更适合我的需要:)

```
Function.prototype.getHashCode = (function(id) {
    return function() {
        if (!this.hashCode) {
            this.hashCode = '<hash|#' + (id++) + '>';
        }
        return this.hashCode;
    }
}(0)); 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2014-03-11T16:30:17.257

对于我的具体情况，我只关心键和原始值的对象是否相等。对我有用的解决方案是将对象转换为其 JSON 表示并将其用作哈希。存在键定义顺序可能不一致等限制；但就像我说的那样，它对我有用，因为这些对象都是在一个地方生成的。

```
var hashtable = {};

var myObject = {a:0,b:1,c:2};

var hash = JSON.stringify(myObject);
// '{"a":0,"b":1,"c":2}'

hashtable[hash] = myObject;
// {
//   '{"a":0,"b":1,"c":2}': myObject
// } 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-04-07T22:33:40.100

不久前我组装了[一个小的 JavaScript 模块](https://github.com/stuartbannerman/hashcode)来为字符串、对象、数组等生成哈希码（我刚刚将它提交到[GitHub](http://en.wikipedia.org/wiki/GitHub) :)）

用法：

```
Hashcode.value("stackoverflow")
// -2559914341
Hashcode.value({ 'site' : "stackoverflow" })
// -3579752159 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2015-01-13T19:48:40.933

在 ECMAScript 6 中，现在有一个`Set`可以按照您的方式工作：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)

它已经在最新的 Chrome、FF 和 IE11 中可用。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-10-12T08:02:24.500

JavaScript 规范将索引属性访问定义为对索引名称执行 toString 转换。例如，

```
myObject[myProperty] = ...; 
```

是相同的

```
myObject[myProperty.toString()] = ...; 
```

这是必需的，就像在 JavaScript 中一样

```
myObject["someProperty"] 
```

是相同的

```
myObject.someProperty 
```

是的，这也让我很难过:-(

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-08-07T01:28:35.397

根据标题，我们可以生成强[SHA](https://en.wikipedia.org/wiki/Secure_Hash_Algorithms)哈希，在浏览器上下文中，它可以用于从对象、参数数组、字符串或其他任何内容生成唯一哈希。

```
async function H(m) {
  const msgUint8 = new TextEncoder().encode(m)                       
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8)          
  const hashArray = Array.from(new Uint8Array(hashBuffer))                    
  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('')
  console.log(hashHex)
}

/* Examples ----------------------- */
H("An obscure ....")
H(JSON.stringify( {"hello" : "world"} ))
H(JSON.stringify( [54,51,54,47] ))
```

我的浏览器中的上述输出，对你来说也应该是相等的：

```
bf1cf3fe6975fe382ab392ec1dd42009380614be03d489f23601c11413cfca2b
93a23971a914e5eacbf0a8d25154cda309c3c1c72fbb9914d47c60f3cb681588
d2f209e194045604a3b15bdfd7502898a0e848e4603c5a818bd01da69c00ad19 
```

支持的算法：

```
SHA-1 (but don't use this in cryptographic applications)
SHA-256
SHA-384
SHA-512 
```

[https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest#Converting_a_digest_to_a_hex_string](https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest#Converting_a_digest_to_a_hex_string)

* * *

但是，对于一个简单的 FAST 校验和哈希函数，仅用于避免冲突，请参阅**CRC32（内容冗余检查）**

[JavaScript CRC32](https://stackoverflow.com/questions/18638900/javascript-crc32)

* * *

您可能也对这种通过 web crypto api[生成 HMAC 代码的类似方法感兴趣。](http://HMAC)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-01-29T20:22:32.593

参考：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol)

您可以使用 Es6 符号创建唯一键和访问对象。从 Symbol() 返回的每个符号值都是唯一的。符号值可以用作对象属性的标识符；这是数据类型的唯一用途。

```
var obj = {};

obj[Symbol('a')] = 'a';
obj[Symbol.for('b')] = 'b';
obj['c'] = 'c';
obj.d = 'd'; 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-04-06T03:41:22.453

这是我返回唯一整数的简单解决方案。

```
function hashcode(obj) {
    var hc = 0;
    var chars = JSON.stringify(obj).replace(/\{|\"|\}|\:|,/g, '');
    var len = chars.length;
    for (var i = 0; i < len; i++) {
        // Bump 7 to larger prime number to increase uniqueness
        hc += (chars.charCodeAt(i) * 7);
    }
    return hc;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-02-19T09:14:07.103

`Object`我的解决方案为全局对象引入了一个静态函数。

```
(function() {
    var lastStorageId = 0;

    this.Object.hash = function(object) {
        var hash = object.__id;

        if (!hash)
             hash = object.__id = lastStorageId++;

        return '#' + hash;
    };
}()); 
```

我认为这与 JavaScript 中的其他对象操作函数更方便。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-11-23T16:26:09.283

我会尝试比其他答案更深入一点。

即使 JS 有更好的散列支持，它也不会神奇地完美地散列所有内容，在许多情况下，您必须定义自己的散列函数。例如 Java 有很好的散列支持，但你仍然需要思考和做一些工作。

一个问题是散列/散列码这个术语……有加密散列和非加密散列。另一个问题是您必须了解散列为什么有用以及它是如何工作的。

当我们谈论 JavaScript 或 Java 中的散列时，大部分时间我们都在谈论非加密散列，通常是关于 hashmap/hashtable 的散列（除非我们正在处理身份验证或密码，您可以使用 NodeJS 在服务器端进行。 ..)。

这取决于您拥有什么数据以及您想要实现什么。

您的数据具有一些自然的“简单”独特性：

*   整数的散列是......整数，因为它是唯一的，你很幸运！
*   字符串的散列......它取决于字符串，如果字符串表示唯一标识符，您可以将其视为散列（因此不需要散列）。
*   任何间接几乎是唯一整数的东西都是最简单的情况
*   这将尊重：如果对象相等，则哈希码相等

您的数据具有一些自然的“复合”独特性：

*   例如，对于 person 对象，您可以使用 firstname、lastname、birthdate 来计算散列……看看 Java 是如何做到的：[Good Hash Function for Strings](https://stackoverflow.com/questions/2624192/good-hash-function-for-strings)，或者使用其他一些对您的用例来说足够便宜且足够独特的 ID 信息

您不知道您的数据将是什么：

*   祝你好运……您可以序列化为字符串并对其进行 Java 风格的哈希处理，但如果字符串很大并且它不会避免冲突以及说整数（自身）的哈希值，这可能会很昂贵。

对于未知数据没有神奇的高效散列技术，在某些情况下很容易，在其他情况下你可能需要三思而后行。所以即使 JavaScript/ECMAScript 增加了更多的支持，也没有什么神奇的语言可以解决这个问题。

在实践中你需要两件事：足够的独特性，足够的速度

除此之外，它很棒：“如果对象相等，哈希码相等”

*   [https://en.wikipedia.org/wiki/Hash_table#Collision_resolution](https://en.wikipedia.org/wiki/Hash_table#Collision_resolution)
*   [Java中hashCode和equals方法的关系](https://stackoverflow.com/questions/17027777/relationship-between-hashcode-and-equals-method-in-java)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-02-21T18:20:15.447

只需将隐藏的秘密属性与`defineProperty` `enumerable: false`

它工作[得非常快](https://jsbench.me/wlk6wi04ph/1)：

*   首次读取uniqueId：**1,257,500 ops/s**
*   所有其他：**309,226,485 次操作/秒**

```
var nextObjectId = 1
function getNextObjectId() {
    return nextObjectId++
}

var UNIQUE_ID_PROPERTY_NAME = '458d576952bc489ab45e98ac7f296fd9'
function getObjectUniqueId(object) {
    if (object == null) {
        return null
    }

    var id = object[UNIQUE_ID_PROPERTY_NAME]

    if (id != null) {
        return id
    }

    if (Object.isFrozen(object)) {
        return null
    }

    var uniqueId = getNextObjectId()
    Object.defineProperty(object, UNIQUE_ID_PROPERTY_NAME, {
        enumerable: false,
        configurable: false,
        writable: false,
        value: uniqueId,
    })

    return uniqueId
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-12T01:49:29.260

如果您真的想要设置行为（我将根据 Java 知识进行说明），那么您将很难在 JavaScript 中找到解决方案。大多数开发人员会推荐一个唯一的键来表示每个对象，但这与 set 不同，因为您可以获得两个相同的对象，每个对象都有一个唯一的键。Java API 通过比较哈希码值而不是键来检查重复值，并且由于 JavaScript 中没有对象的哈希码值表示，因此几乎不可能做同样的事情。甚至 Prototype JS 库也承认了这个缺点，当它说：

> “哈希可以被认为是一个关联数组，将唯一键绑定到值（不一定是唯一的）......”

[http://www.prototypejs.org/api/hash](http://www.prototypejs.org/api/hash)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-07-11T20:29:32.717

除了 eyelidlessness 的答案之外，这里还有一个函数，它为任何对象返回一个可重现的、唯一的 ID：

```
var uniqueIdList = [];
function getConstantUniqueIdFor(element) {
    // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?
    if (uniqueIdList.indexOf(element) < 0) {
        uniqueIdList.push(element);
    }
    return uniqueIdList.indexOf(element);
} 
```

正如您所看到的，它使用一个非常低效的查找列表，但这是我现在能找到的最好的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-01-22T22:35:59.553

如果你想使用对象作为键，你需要覆盖它们的 toString 方法，正如这里已经提到的一些。使用的散列函数都很好，但它们只适用于相同的对象，而不适用于相等的对象。

我编写了一个从对象创建散列的小型库，您可以轻松地将其用于此目的。对象甚至可以有不同的顺序，哈希值是相同的。在内部，您可以为哈希使用不同的类型（djb2、md5、sha1、sha256、sha512、ripemd160）。

这是文档中的一个小示例：

```
var hash = require('es-hash');

// Save data in an object with an object as a key
Object.prototype.toString = function () {
    return '[object Object #'+hash(this)+']';
}

var foo = {};

foo[{bar: 'foo'}] = 'foo';

/*
 * Output:
 *  foo
 *  undefined
 */
console.log(foo[{bar: 'foo'}]);
console.log(foo[{}]); 
```

该包可以在浏览器和 Node-Js 中使用。

存储库：[https ://bitbucket.org/tehrengruber/es-js-hash](https://bitbucket.org/tehrengruber/es-js-hash)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-10-22T01:38:39.530

如果您想在查找对象中具有唯一值，您可以执行以下操作：

创建查找对象

```
var lookup = {}; 
```

设置哈希码函数

```
function getHashCode(obj) {
    var hashCode = '';
    if (typeof obj !== 'object')
        return hashCode + obj;
    for (var prop in obj) // No hasOwnProperty needed
        hashCode += prop + getHashCode(obj[prop]); // Add key + value to the result string
    return hashCode;
} 
```

**目的**

```
var key = getHashCode({ 1: 3, 3: 7 });
// key = '1337'
lookup[key] = true; 
```

**大批**

```
var key = getHashCode([1, 3, 3, 7]);
// key = '01132337'
lookup[key] = true; 
```

**其他类型**

```
var key = getHashCode('StackOverflow');
// key = 'StackOverflow'
lookup[key] = true; 
```

**最后结果**

`{ 1337: true, 01132337: true, StackOverflow: true }`

*请注意，`getHashCode`当对象或数组为空时不返回任何值*

```
getHashCode([{},{},{}]);
// '012'
getHashCode([[],[],[]]);
// '012' 
```

这类似于@ijmacd 解决方案，只是`getHashCode`没有`JSON`依赖关系。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-12-23T16:43:11.430

我结合了眼睑和 KimKha 的答案。

下面是一个 angularjs 服务，它支持数字、字符串和对象。

```
exports.Hash = () => {
  let hashFunc;
  function stringHash(string, noType) {
    let hashString = string;
    if (!noType) {
      hashString = `string${string}`;
    }
    var hash = 0;
    for (var i = 0; i < hashString.length; i++) {
        var character = hashString.charCodeAt(i);
        hash = ((hash<<5)-hash)+character;
        hash = hash & hash; // Convert to 32bit integer
    }
    return hash;
  }

  function objectHash(obj, exclude) {
    if (exclude.indexOf(obj) > -1) {
      return undefined;
    }
    let hash = '';
    const keys = Object.keys(obj).sort();
    for (let index = 0; index < keys.length; index += 1) {
      const key = keys[index];
      const keyHash = hashFunc(key);
      const attrHash = hashFunc(obj[key], exclude);
      exclude.push(obj[key]);
      hash += stringHash(`object${keyHash}${attrHash}`, true);
    }
    return stringHash(hash, true);
  }

  function Hash(unkType, exclude) {
    let ex = exclude;
    if (ex === undefined) {
      ex = [];
    }
    if (!isNaN(unkType) && typeof unkType !== 'string') {
      return unkType;
    }
    switch (typeof unkType) {
      case 'object':
        return objectHash(unkType, ex);
      default:
        return stringHash(String(unkType));
    }
  }

  hashFunc = Hash;

  return Hash;
}; 
```

**示例用法：**

```
Hash('hello world'), Hash('hello world') == Hash('hello world')
Hash({hello: 'hello world'}), Hash({hello: 'hello world'}) == Hash({hello: 'hello world'})
Hash({hello: 'hello world', goodbye: 'adios amigos'}), Hash({hello: 'hello world', goodbye: 'adios amigos'}) == Hash({goodbye: 'adios amigos', hello: 'hello world'})
Hash(['hello world']), Hash(['hello world']) == Hash(['hello world'])
Hash(1), Hash(1) == Hash(1)
Hash('1'), Hash('1') == Hash('1') 
```

**输出**

```
432700947 true
-411117486 true
1725787021 true
-1585332251 true
1 true
-1881759168 true 
```

**解释**

如您所见，该服务的核心是由 KimKha 创建的哈希函数。我已将类型添加到字符串中，以便对象的结构也会影响最终的哈希值。对键进行哈希处理以防止数组|对象冲突。

eyelidlessness 对象比较用于防止自引用对象的无限递归。

**用法**

我创建了这个服务，以便我可以使用对象访问错误服务。这样一个服务可以注册一个给定对象的错误，另一个可以确定是否发现了任何错误。

**IE**

**JsonValidation.js**

```
ErrorSvc({id: 1, json: '{attr: "not-valid"}'}, 'Invalid Json Syntax - key not double quoted'); 
```

**UserOfData.js**

```
ErrorSvc({id: 1, json: '{attr: "not-valid"}'}); 
```

这将返回：

```
['Invalid Json Syntax - key not double quoted'] 
```

尽管

```
ErrorSvc({id: 1, json: '{"attr": "not-valid"}'}); 
```

这将返回

```
[] 
```

# sql - 如何在 SQL Server 中将多行文本连接成单个文本字符串

> ID：194852
> 
> 赞同：2204
> 
> 时间：2008-10-11T23:49:59.470
> 
> 标签：sql, sql-server, csv, string-concatenation, group-concat

考虑一个包含名称的数据库表，其中包含三行：

```
Peter
Paul
Mary 
```

有没有一种简单的方法可以把它变成一个字符串`Peter, Paul, Mary`？

* * *

## 回答 #1

> 赞同：1585
> 
> 时间：2009-02-13T11:53:52.437

如果您使用的是 SQL Server 2017 或 Azure，请参阅[Mathieu Renda 答案](https://stackoverflow.com/a/42778050/1178676)。

当我尝试加入两个具有一对多关系的表时，我遇到了类似的问题。在 SQL 2005 中，我发现该`XML PATH`方法可以非常轻松地处理行的连接。

如果有一个表叫`STUDENTS`

```
SubjectID       StudentName
----------      -------------
1               Mary
1               John
1               Sam
2               Alaina
2               Edward 
```

我预期的结果是：

```
SubjectID       StudentName
----------      -------------
1               Mary, John, Sam
2               Alaina, Edward 
```

我使用了以下内容`T-SQL`：

```
SELECT Main.SubjectID,
       LEFT(Main.Students,Len(Main.Students)-1) As "Students"
FROM
    (
        SELECT DISTINCT ST2.SubjectID, 
            (
                SELECT ST1.StudentName + ',' AS [text()]
                FROM dbo.Students ST1
                WHERE ST1.SubjectID = ST2.SubjectID
                ORDER BY ST1.SubjectID
                FOR XML PATH (''), TYPE
            ).value('text()[1]','nvarchar(max)') [Students]
        FROM dbo.Students ST2
    ) [Main] 
```

如果您可以在开头连接逗号并使用`substring`跳过第一个逗号，那么您可以以更紧凑的方式执行相同的操作，这样您就不需要执行子查询：

```
SELECT DISTINCT ST2.SubjectID, 
    SUBSTRING(
        (
            SELECT ','+ST1.StudentName  AS [text()]
            FROM dbo.Students ST1
            WHERE ST1.SubjectID = ST2.SubjectID
            ORDER BY ST1.SubjectID
            FOR XML PATH (''), TYPE
        ).value('text()[1]','nvarchar(max)'), 2, 1000) [Students]
FROM dbo.Students ST2 
```

* * *

## 回答 #2

> 赞同：1096
> 
> 时间：2008-10-12T00:18:00.757

> **此答案可能会返回[意外结果](https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136)为了获得一致的结果，请使用其他答案中详述的 FOR XML PATH 方法之一。**

使用`COALESCE`：

```
DECLARE @Names VARCHAR(8000) 
SELECT @Names = COALESCE(@Names + ', ', '') + Name 
FROM People 
```

只是一些解释（因为这个答案似乎得到了相对常规的观点）：

*   Coalesce 实际上只是一个有用的作弊工具，它完成了两件事：

1) 无需`@Names`使用空字符串值进行初始化。

2) 无需在最后剥离额外的分隔符。

*   如果一行具有*NULL* Name 值，上述解决方案将给出不正确的结果（如果存在*NULL*，则*NULL*将在该行之后变为`@Names` *NULL*，并且下一行将再次作为空字符串重新开始。使用两个之一轻松修复解决方案：

```
DECLARE @Names VARCHAR(8000) 
SELECT @Names = COALESCE(@Names + ', ', '') + Name
FROM People
WHERE Name IS NOT NULL 
```

或者：

```
DECLARE @Names VARCHAR(8000) 
SELECT @Names = COALESCE(@Names + ', ', '') + 
    ISNULL(Name, 'N/A')
FROM People 
```

根据您想要的行为（第一个选项只是将*NULL*过滤掉，第二个选项将它们保留在列表中并带有标记消息[将 'N/A' 替换为适合您的任何内容]）。

* * *

## 回答 #3

> 赞同：696
> 
> 时间：2017-03-14T05:00:15.573

### SQL Server 2017+ 和 SQL Azure：STRING_AGG

从 SQL Server 的下一个版本开始，我们终于可以跨行连接，而无需求助于任何变量或 XML 巫术。

[STRING_AGG (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql)

**不分组**

```
SELECT STRING_AGG(Name, ', ') AS Departments
FROM HumanResources.Department; 
```

**分组：**

```
SELECT GroupName, STRING_AGG(Name, ', ') AS Departments
FROM HumanResources.Department
GROUP BY GroupName; 
```

**具有分组和子排序**

```
SELECT GroupName, STRING_AGG(Name, ', ') WITHIN GROUP (ORDER BY Name ASC) AS Departments
FROM HumanResources.Department
GROUP BY GroupName; 
```

* * *

## 回答 #4

> 赞同：399
> 
> 时间：2011-04-05T21:19:15.560

`XML` `data()`SQL Server 中尚未通过命令显示的一种方法是：

假设有一个名为 NameList 的表，其中有一列名为 FName，

```
SELECT FName + ', ' AS 'data()'
FROM NameList
FOR XML PATH('') 
```

返回：

```
"Peter, Paul, Mary, " 
```

只有多余的逗号必须处理。

正如@NReilingh 的评论所采用的那样，您可以使用以下方法删除尾随逗号。假设相同的表和列名：

```
STUFF(REPLACE((SELECT '#!' + LTRIM(RTRIM(FName)) AS 'data()' FROM NameList
FOR XML PATH('')),' #!',', '), 1, 2, '') as Brands 
```

* * *

## 回答 #5

> 赞同：336
> 
> 时间：2010-09-09T00:08:06.757

## 在[SQL Server 2005中](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005)

```
SELECT Stuff(
  (SELECT N', ' + Name FROM Names FOR XML PATH(''),TYPE)
  .value('text()[1]','nvarchar(max)'),1,2,N'') 
```

* * *

## 在 SQL Server 2016 中

您可以使用[FOR JSON 语法](https://docs.microsoft.com/en-us/sql/t-sql/queries/select-for-clause-transact-sql)

IE

```
SELECT per.ID,
Emails = JSON_VALUE(
   REPLACE(
     (SELECT _ = em.Email FROM Email em WHERE em.Person = per.ID FOR JSON PATH)
    ,'"},{"_":"',', '),'$[0]._'
) 
FROM Person per 
```

结果会变成

```
Id  Emails
1   abc@gmail.com
2   NULL
3   def@gmail.com, xyz@gmail.com 
```

即使您的数据包含无效的 XML 字符，这也可以工作

这`'"},{"_":"'`是安全的，因为如果您的数据包含`'"},{"_":"',`它将被转义到`"},{\"_\":\"`

您可以替换`', '`为任何字符串分隔符

* * *

## 而在 SQL Server 2017 中，Azure SQL 数据库

您可以使用新的[STRING_AGG 函数](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql)

* * *

## 回答 #6

> 赞同：145
> 
> 时间：2008-10-12T00:10:14.577

在 MySQL 中，有一个函数[GROUP_CONCAT()](https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat)，它允许您连接多行的值。例子：

```
SELECT 1 AS a, GROUP_CONCAT(name ORDER BY name ASC SEPARATOR ', ') AS people 
FROM users 
WHERE id IN (1,2,3) 
GROUP BY a 
```

* * *

## 回答 #7

> 赞同：66
> 
> 时间：2016-04-05T07:08:21.163

使用***COALESCE*** -[从这里了解更多信息](https://msdn.microsoft.com/en-IN/library/ms190349.aspx)

*例如：*

> 102
> 
> 103
> 
> 104

然后在 SQL Server 中编写以下代码，

```
Declare @Numbers AS Nvarchar(MAX) -- It must not be MAX if you have few numbers
SELECT  @Numbers = COALESCE(@Numbers + ',', '') + Number
FROM   TableName where Number IS NOT NULL

SELECT @Numbers 
```

输出将是：

```
102,103,104 
```

* * *

## 回答 #8

> 赞同：56
> 
> 时间：2012-08-09T21:20:03.530

PostgreSQL 数组很棒。例子：

创建一些测试数据：

```
postgres=# \c test
You are now connected to database "test" as user "hgimenez".
test=# create table names (name text);
CREATE TABLE
test=# insert into names (name) values ('Peter'), ('Paul'), ('Mary');
INSERT 0 3
test=# select * from names;
 name
-------
 Peter
 Paul
 Mary
(3 rows) 
```

将它们聚合到一个数组中：

```
test=# select array_agg(name) from names;
 array_agg
-------------------
 {Peter,Paul,Mary}
(1 row) 
```

将数组转换为逗号分隔的字符串：

```
test=# select array_to_string(array_agg(name), ', ') from names;
 array_to_string
-------------------
 Peter, Paul, Mary
(1 row) 
```

完毕

从 PostgreSQL 9.0 开始就更容易了，引用“无名马”的已删除答案：

```
select string_agg(name, ',') 
from names; 
```

* * *

## 回答 #9

> 赞同：49
> 
> 时间：2012-03-08T16:29:34.373

Oracle 11g 第 2 版支持 LISTAGG 函数。文档[在这里](http://www.oracle-base.com/articles/misc/StringAggregationTechniques.php)。

```
COLUMN employees FORMAT A50

SELECT deptno, LISTAGG(ename, ',') WITHIN GROUP (ORDER BY ename) AS employees
FROM   emp
GROUP BY deptno;

    DEPTNO EMPLOYEES
---------- --------------------------------------------------
        10 CLARK,KING,MILLER
        20 ADAMS,FORD,JONES,SCOTT,SMITH
        30 ALLEN,BLAKE,JAMES,MARTIN,TURNER,WARD

3 rows selected. 
```

## 警告

如果结果字符串有可能超过 4000 个字符，请小心执行此函数。它会抛出异常。如果是这种情况，那么您需要处理异常或滚动您自己的函数来防止连接的字符串超过 4000 个字符。

* * *

## 回答 #10

> 赞同：37
> 
> 时间：2011-07-06T12:46:28.347

在 SQL Server 2005 及更高版本中，使用下面的查询来连接行。

```
DECLARE @t table
(
    Id int,
    Name varchar(10)
)
INSERT INTO @t
SELECT 1,'a' UNION ALL
SELECT 1,'b' UNION ALL
SELECT 2,'c' UNION ALL
SELECT 2,'d' 

SELECT ID,
stuff(
(
    SELECT ','+ [Name] FROM @t WHERE Id = t.Id FOR XML PATH('')
),1,1,'') 
FROM (SELECT DISTINCT ID FROM @t ) t 
```

* * *

## 回答 #11

> 赞同：36
> 
> 时间：2012-08-09T21:06:05.887

建议使用递归[CTE](https://en.wikipedia.org/wiki/Hierarchical_and_recursive_queries_in_SQL#Common_table_expression)解决方案，但未提供代码。下面的代码是递归 CTE 的示例。

请注意，尽管结果与问题匹配，但数据与给定的描述并不*完全*匹配，因为我假设您确实希望对行组执行此操作，而不是表中的所有行。将其更改为匹配表中的所有行留给读者作为练习。

```
;WITH basetable AS (
    SELECT
        id,
        CAST(name AS VARCHAR(MAX)) name,
        ROW_NUMBER() OVER (Partition BY id ORDER BY seq) rw,
        COUNT(*) OVER (Partition BY id) recs
    FROM (VALUES
        (1, 'Johnny', 1),
        (1, 'M', 2),
        (2, 'Bill', 1),
        (2, 'S.', 4),
        (2, 'Preston', 5),
        (2, 'Esq.', 6),
        (3, 'Ted', 1),
        (3, 'Theodore', 2),
        (3, 'Logan', 3),
        (4, 'Peter', 1),
        (4, 'Paul', 2),
        (4, 'Mary', 3)
    ) g (id, name, seq)
),
rCTE AS (
    SELECT recs, id, name, rw
    FROM basetable
    WHERE rw = 1

    UNION ALL

    SELECT b.recs, r.ID, r.name +', '+ b.name name, r.rw + 1
    FROM basetable b
    INNER JOIN rCTE r ON b.id = r.id AND b.rw = r.rw + 1
)
SELECT name
FROM rCTE
WHERE recs = rw AND ID=4 
```

* * *

## 回答 #12

> 赞同：33
> 
> 时间：2008-10-12T00:16:20.167

我无法访问家里的 SQL Server，所以我猜测这里的语法，但或多或​​少：

```
DECLARE @names VARCHAR(500)

SELECT @names = @names + ' ' + Name
FROM Names 
```

* * *

## 回答 #13

> 赞同：27
> 
> 时间：2016-11-15T21:07:57.127

您需要创建一个变量来保存您的最终结果并选择它，就像这样。

# 最简单的解决方案

```
DECLARE @char VARCHAR(MAX);

SELECT @char = COALESCE(@char + ', ' + [column], [column]) 
FROM [table];

PRINT @char; 
```

* * *

## 回答 #14

> 赞同：23
> 
> 时间：2016-11-21T11:27:29.307

在 SQL Server vNext 中，这将使用 STRING_AGG 函数内置。*[在STRING_AGG (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql)*中阅读有关它的更多信息。

* * *

## 回答 #15

> 赞同：20
> 
> 时间：2012-02-03T10:39:33.463

即用型解决方案，没有额外的逗号：

```
select substring(
        (select ', '+Name AS 'data()' from Names for xml path(''))
       ,3, 255) as "MyList" 
```

空列表将导致 NULL 值。通常您会将列表插入到表格列或程序变量中：根据需要调整 255 最大长度。

（Diwakar 和 Jens Frandsen 提供了很好的答案，但需要改进。）

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2011-04-07T11:16:36.653

使用 XML 帮助我用逗号分隔行。对于多余的逗号，我们可以使用 SQL Server 的替换功能。代替添加逗号，使用 AS 'data()' 将使用空格连接行，稍后可以用逗号替换，如下所示。

```
REPLACE(
        (select FName AS 'data()'  from NameList  for xml path(''))
         , ' ', ', ') 
```

* * *

## 回答 #17

> 赞同：18
> 
> 时间：2021-04-04T17:34:44.700

在[SQL Server 2017](https://en.wikipedia.org/wiki/History_of_Microsoft_SQL_Server#SQL_Server_2017)或更高版本中，您可以使用 STRING_AGG() 函数生成**逗号分隔**值。请看下面的一个例子。

```
SELECT
VendorId,STRING_AGG(FirstName,',') UsersName FROM
Users
where VendorId!=9 GROUP BY VendorId 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Z5m6r.png)](https://i.stack.imgur.com/Z5m6r.png)

* * *

## 回答 #18

> 赞同：16
> 
> 时间：2019-09-16T12:21:49.913

这对我有用（**SQL Server 2016**）：

```
SELECT CarNamesString = STUFF((
         SELECT ',' + [Name]
            FROM tbl_cars
            FOR XML PATH('')
         ), 1, 1, '') 
```

这是来源：[https ://www.mytecbits.com/](https://www.mytecbits.com/microsoft/sql-server/concatenate-multiple-rows-into-single-string)

**以及MySQL**的解决方案（因为此页面出现在 Google for MySQL 中）：

```
SELECT [Name],
       GROUP_CONCAT(DISTINCT [Name]  SEPARATOR ',')
       FROM tbl_cars 
```

来自[MySQL 文档](https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html#function_group-concat)。

* * *

## 回答 #19

> 赞同：15
> 
> 时间：2018-01-25T04:55:48.420

```
SELECT STUFF((SELECT ', ' + name FROM [table] FOR XML PATH('')), 1, 2, '') 
```

这是一个示例：

```
DECLARE @t TABLE (name VARCHAR(10))
INSERT INTO @t VALUES ('Peter'), ('Paul'), ('Mary')
SELECT STUFF((SELECT ', ' + name FROM @t FOR XML PATH('')), 1, 2, '')
--Peter, Paul, Mary 
```

* * *

## 回答 #20

> 赞同：12
> 
> 时间：2016-05-04T19:31:22.067

对于其他答案，阅读答案的人必须知道特定的域表，例如车辆或学生。必须创建该表并用数据填充该表以测试解决方案。

下面是一个使用 SQL Server“Information_Schema.Columns”表的示例。通过使用此解决方案，无需创建表或添加数据。此示例为数据库中的所有表创建一个逗号分隔的列名列表。

```
SELECT
    Table_Name
    ,STUFF((
        SELECT ',' + Column_Name
        FROM INFORMATION_SCHEMA.Columns Columns
        WHERE Tables.Table_Name = Columns.Table_Name
        ORDER BY Column_Name
        FOR XML PATH ('')), 1, 1, ''
    )Columns
FROM INFORMATION_SCHEMA.Columns Tables
GROUP BY TABLE_NAME 
```

* * *

## 回答 #21

> 赞同：10
> 
> 时间：2008-10-13T17:24:38.187

```
DECLARE @Names VARCHAR(8000)
SELECT @name = ''
SELECT @Names = @Names + ',' + Names FROM People
SELECT SUBSTRING(2, @Names, 7998) 
```

这将杂散逗号放在开头。

但是，如果您需要其他列，或者要 CSV 一个子表，您需要将其包装在一个标量用户定义字段 (UDF) 中。

您也可以在 SELECT 子句中使用 XML 路径作为相关子查询（但我必须等到我回去工作，因为谷歌不在家做工作:-)

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2011-11-21T01:11:57.093

我真的很喜欢[Dana 回答的](https://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string/194886#194886)优雅，只是想让它完整。

```
DECLARE @names VARCHAR(MAX)
SET @names = ''

SELECT @names = @names + ', ' + Name FROM Names

-- Deleting last two symbols (', ')
SET @sSql = LEFT(@sSql, LEN(@sSql) - 1) 
```

* * *

## 回答 #23

> 赞同：8
> 
> 时间：2013-05-13T16:02:15.117

对于 Oracle DB，请参阅以下问题：[如何在 Oracle 中将多行连接为一个而不创建存储过程？](https://stackoverflow.com/questions/1076011/how-can-multiple-rows-be-concatenated-into-one-in-oracle-without-creating-a-stor)

最佳答案似乎是 @Emmanuel，使用 Oracle 11g 第 2 版及更高版本中提供的内置 LISTAGG() 函数。

```
SELECT question_id,
   LISTAGG(element_id, ',') WITHIN GROUP (ORDER BY element_id)
FROM YOUR_TABLE;
GROUP BY question_id 
```

正如@user762952 所指出的，并且根据 Oracle 的文档[http://www.oracle-base.com/articles/misc/string-aggregation-techniques.php](http://www.oracle-base.com/articles/misc/string-aggregation-techniques.php)， WM_CONCAT() 函数也是一个选项。它看起来很稳定，但 Oracle 明确建议不要将它用于任何应用程序 SQL，因此使用风险自负。

除此之外，您必须编写自己的函数；上面的 Oracle 文档有一个关于如何做到这一点的指南。

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2015-02-12T12:01:27.810

为避免空值，您可以使用 CONCAT()

```
DECLARE @names VARCHAR(500)
SELECT @names = CONCAT(@names, ' ', name) 
FROM Names
select @names 
```

* * *

## 回答 #25

> 赞同：8
> 
> 时间：2015-07-22T07:51:12.910

**MySQL完整示例：**

我们有可以拥有大量数据的用户，我们希望有一个输出，我们可以在列表中看到所有用户的数据：

**结果：**

```
___________________________
| id   |  rowList         |
|-------------------------|
| 0    | 6, 9             |
| 1    | 1,2,3,4,5,7,8,1  |
|_________________________| 
```

**表设置：**

```
CREATE TABLE `Data` (
  `id` int(11) NOT NULL,
  `user_id` int(11) NOT NULL
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;

INSERT INTO `Data` (`id`, `user_id`) VALUES
(1, 1),
(2, 1),
(3, 1),
(4, 1),
(5, 1),
(6, 0),
(7, 1),
(8, 1),
(9, 0),
(10, 1);

CREATE TABLE `User` (
  `id` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO `User` (`id`) VALUES
(0),
(1); 
```

**询问：**

```
SELECT User.id, GROUP_CONCAT(Data.id ORDER BY Data.id) AS rowList FROM User LEFT JOIN Data ON User.id = Data.user_id GROUP BY User.id 
```

* * *

## 回答 #26

> 赞同：7
> 
> 时间：2011-07-27T20:05:13.063

如果要处理空值，可以通过添加 where 子句或在第一个子句周围添加另一个 COALESCE 来实现。

```
DECLARE @Names VARCHAR(8000) 
SELECT @Names = COALESCE(COALESCE(@Names + ', ', '') + Name, @Names) FROM People 
```

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2015-05-08T01:39:06.667

这个答案需要服务器上的一些权限才能工作。

[组件](https://msdn.microsoft.com/pt-br/library/ms189524.aspx)对您来说是一个不错的选择。有很多网站解释了如何创建它。我认为解释得很好的是[这个](http://www.mssqltips.com/sqlservertip/2022/concat-aggregates-sql-server-clr-function/)。

如果需要，我已经创建了程序集，可以在[此处](https://1drv.ms/u/s!AsecqFu3CHaYtZMLaMJ7Y2z70xU7nQ?e=CssM8J)下载 DLL 文件。

下载后，您需要在 SQL Server 中运行以下脚本：

```
EXEC sp_configure 'show advanced options', 1
RECONFIGURE;
EXEC sp_configure 'clr strict security', 1;
RECONFIGURE;

CREATE Assembly concat_assembly
   AUTHORIZATION dbo
   FROM '<PATH TO Concat.dll IN SERVER>'
   WITH PERMISSION_SET = SAFE;
GO

CREATE AGGREGATE dbo.concat (

    @Value NVARCHAR(MAX)
  , @Delimiter NVARCHAR(4000)

) RETURNS NVARCHAR(MAX)
EXTERNAL Name concat_assembly.[Concat.Concat];
GO

sp_configure 'clr enabled', 1;
RECONFIGURE 
```

请注意，服务器可以访问程序集的路径。由于您已成功完成所有步骤，您可以使用如下功能：

```
SELECT dbo.Concat(field1, ',')
FROM Table1 
```

* * *

从[SQL Server 2017](https://en.wikipedia.org/wiki/History_of_Microsoft_SQL_Server#SQL_Server_2017)开始，可以使用[STRING_AGG](https://docs.microsoft.com/pt-br/sql/t-sql/functions/string-agg-transact-sql?view=sql-server-ver15)函数。

* * *

## 回答 #28

> 赞同：6
> 
> 时间：2011-07-06T06:58:31.607

我通常使用这样的 select 来连接 SQL Server 中的字符串：

```
with lines as 
( 
  select 
    row_number() over(order by id) id, -- id is a line id
    line -- line of text.
  from
    source -- line source
), 
result_lines as 
( 
  select 
    id, 
    cast(line as nvarchar(max)) line 
  from 
    lines 
  where 
    id = 1 
  union all 
  select 
    l.id, 
    cast(r.line + N', ' + l.line as nvarchar(max))
  from 
    lines l 
    inner join 
    result_lines r 
    on 
      l.id = r.id + 1 
) 
select top 1 
  line
from
  result_lines
order by
  id desc 
```

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2019-08-16T00:20:43.600

在[克里斯谢弗的回答](https://stackoverflow.com/questions/194852/how-to-concatenate-text-from-multiple-rows-into-a-single-text-string-in-sql-serv/194887#194887)之上：

如果您的数据可能会重复，例如

```
Tom
Ali
John
Ali
Tom
Mike 
```

而不是拥有`Tom,Ali,John,Ali,Tom,Mike`

您可以使用 DISTINCT 来避免重复并获取`Tom,Ali,John,Mike`：

```
DECLARE @Names VARCHAR(8000)
SELECT DISTINCT @Names = COALESCE(@Names + ',', '') + Name
FROM People
WHERE Name IS NOT NULL
SELECT @Names 
```

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2011-06-03T18:14:16.237

在 Oracle 中，它是`wm_concat`. 我相信这个功能在[10g](http://en.wikipedia.org/wiki/Oracle_10g)及更高版本中可用。

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2013-10-25T08:14:23.270

这也很有用

```
create table #test (id int,name varchar(10))
--use separate inserts on older versions of SQL Server
insert into #test values (1,'Peter'), (1,'Paul'), (1,'Mary'), (2,'Alex'), (3,'Jack')

DECLARE @t VARCHAR(255)
SELECT @t = ISNULL(@t + ',' + name, name) FROM #test WHERE id = 1
select @t
drop table #test 
```

返回

```
Peter,Paul,Mary 
```

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2016-06-01T20:42:40.670

### SQL Server 2005 或更高版本

```
CREATE TABLE dbo.Students
(
    StudentId INT
    , Name VARCHAR(50)
    , CONSTRAINT PK_Students PRIMARY KEY (StudentId)
);

CREATE TABLE dbo.Subjects
(
    SubjectId INT
    , Name VARCHAR(50)
    , CONSTRAINT PK_Subjects PRIMARY KEY (SubjectId)
);

CREATE TABLE dbo.Schedules
(
    StudentId INT
    , SubjectId INT
    , CONSTRAINT PK__Schedule PRIMARY KEY (StudentId, SubjectId)
    , CONSTRAINT FK_Schedule_Students FOREIGN KEY (StudentId) REFERENCES dbo.Students (StudentId)
    , CONSTRAINT FK_Schedule_Subjects FOREIGN KEY (SubjectId) REFERENCES dbo.Subjects (SubjectId)
);

INSERT dbo.Students (StudentId, Name) VALUES
    (1, 'Mary')
    , (2, 'John')
    , (3, 'Sam')
    , (4, 'Alaina')
    , (5, 'Edward')
;

INSERT dbo.Subjects (SubjectId, Name) VALUES
    (1, 'Physics')
    , (2, 'Geography')
    , (3, 'French')
    , (4, 'Gymnastics')
;

INSERT dbo.Schedules (StudentId, SubjectId) VALUES
    (1, 1)        --Mary, Physics
    , (2, 1)    --John, Physics
    , (3, 1)    --Sam, Physics
    , (4, 2)    --Alaina, Geography
    , (5, 2)    --Edward, Geography
;

SELECT
    sub.SubjectId
    , sub.Name AS [SubjectName]
    , ISNULL( x.Students, '') AS Students
FROM
    dbo.Subjects sub
    OUTER APPLY
    (
        SELECT
            CASE ROW_NUMBER() OVER (ORDER BY stu.Name) WHEN 1 THEN '' ELSE ', ' END
            + stu.Name
        FROM
            dbo.Students stu
            INNER JOIN dbo.Schedules sch
                ON stu.StudentId = sch.StudentId
        WHERE
            sch.SubjectId = sub.SubjectId
        ORDER BY
            stu.Name
        FOR XML PATH('')
    ) x (Students)
; 
```

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2013-11-15T20:26:03.600

此方法仅适用于[Teradata](https://en.wikipedia.org/wiki/Teradata#Technology_and_products) Aster 数据库，因为它使用其 NPATH 函数。

同样，我们有学生表

```
SubjectID       StudentName
----------      -------------
1               Mary
1               John
1               Sam
2               Alaina
2               Edward 
```

然后使用 NPATH 它只是单个 SELECT：

```
SELECT * FROM npath(
  ON Students
  PARTITION BY SubjectID
  ORDER BY StudentName
  MODE(nonoverlapping)
  PATTERN('A*')
  SYMBOLS(
    'true' as A
  )
  RESULT(
    FIRST(SubjectID of A) as SubjectID,
    ACCUMULATE(StudentName of A) as StudentName
  )
); 
```

结果：

```
SubjectID       StudentName
----------      -------------
1               [John, Mary, Sam]
2               [Alaina, Edward] 
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2016-06-10T02:03:25.653

并不是说我对性能进行了任何分析，因为我的列表中只有不到 10 个项目，但是在浏览了 30 个奇怪的答案后，我感到很惊讶，我仍然对已经给出的类似答案有一个转折，类似于使用 COALESCE 用于单个组列表并且没有'甚至不必设置我的变量（无论如何默认为 NULL），它假定我的源数据表中的所有条目都是非空白的：

```
DECLARE @MyList VARCHAR(1000), @Delimiter CHAR(2) = ', '
SELECT @MyList = CASE WHEN @MyList > '' THEN @MyList + @Delimiter ELSE '' END + FieldToConcatenate FROM MyData 
```

我确信 COALESCE 在内部使用了相同的想法。让我们希望微软不要在我身上改变这一点。

* * *

## 回答 #35

> 赞同：4
> 
> 时间：2018-04-02T13:04:36.910

这是实现此目的的完整解决方案：

```
-- Table Creation
CREATE TABLE Tbl
( CustomerCode    VARCHAR(50)
, CustomerName    VARCHAR(50)
, Type VARCHAR(50)
,Items    VARCHAR(50)
)

insert into Tbl
SELECT 'C0001','Thomas','BREAKFAST','Milk'
union SELECT 'C0001','Thomas','BREAKFAST','Bread'
union SELECT 'C0001','Thomas','BREAKFAST','Egg'
union SELECT 'C0001','Thomas','LUNCH','Rice'
union SELECT 'C0001','Thomas','LUNCH','Fish Curry'
union SELECT 'C0001','Thomas','LUNCH','Lessy'
union SELECT 'C0002','JOSEPH','BREAKFAST','Bread'
union SELECT 'C0002','JOSEPH','BREAKFAST','Jam'
union SELECT 'C0002','JOSEPH','BREAKFAST','Tea'
union SELECT 'C0002','JOSEPH','Supper','Tea'
union SELECT 'C0002','JOSEPH','Brunch','Roti'

-- function creation
GO
CREATE  FUNCTION [dbo].[fn_GetItemsByType]
(   
    @CustomerCode VARCHAR(50)
    ,@Type VARCHAR(50)
)
RETURNS @ItemType TABLE  ( Items VARCHAR(5000) )
AS
BEGIN

        INSERT INTO @ItemType(Items)
    SELECT  STUFF((SELECT distinct ',' + [Items]
         FROM Tbl 
         WHERE CustomerCode = @CustomerCode
            AND Type=@Type
            FOR XML PATH(''))
        ,1,1,'') as  Items

    RETURN 
END

GO

-- fianl Query
DECLARE @cols AS NVARCHAR(MAX),
    @query  AS NVARCHAR(MAX)

select @cols = STUFF((SELECT distinct ',' + QUOTENAME(Type) 
                    from Tbl
            FOR XML PATH(''), TYPE
            ).value('.', 'NVARCHAR(MAX)') 
        ,1,1,'')

set @query = 'SELECT CustomerCode,CustomerName,' + @cols + '
             from 
             (
                select  
                    distinct CustomerCode
                    ,CustomerName
                    ,Type
                    ,F.Items
                    FROM Tbl T
                    CROSS APPLY [fn_GetItemsByType] (T.CustomerCode,T.Type) F
            ) x
            pivot 
            (
                max(Items)
                for Type in (' + @cols + ')
            ) p '

execute(@query) 
```

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2008-10-11T23:57:25.663

您可以在 SQL Server 中执行此操作的一种方法是将表内容作为 XML（对于 XML 原始文件）返回，将结果转换为字符串，然后将标签替换为“，”。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2012-09-28T20:44:47.400

Oracle中有两种方法：

```
 create table name
    (first_name varchar2(30));

    insert into name values ('Peter');
    insert into name values ('Paul');
    insert into name values ('Mary'); 
```

解决方案是1：

```
 select substr(max(sys_connect_by_path (first_name, ',')),2) from (select rownum r, first_name from name ) n start with r=1 connect by prior r+1=r
    o/p=> Peter,Paul,Mary 
```

解决方案是2：

```
 select  rtrim(xmlagg (xmlelement (e, first_name || ',')).extract ('//text()'), ',') first_name from name
    o/p=> Peter,Paul,Mary 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2016-05-26T11:14:20.360

```
SELECT PageContent = Stuff(
    (   SELECT PageContent
        FROM dbo.InfoGuide
        WHERE CategoryId = @CategoryId
          AND SubCategoryId = @SubCategoryId
        for xml path(''), type
    ).value('.[1]','nvarchar(max)'),
    1, 1, '')
FROM dbo.InfoGuide info 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2017-12-07T17:20:21.480

虽然为时已晚，并且已经有很多解决方案。这是 MySQL 的简单解决方案：

```
SELECT t1.id,
        GROUP_CONCAT(t1.id) ids
 FROM table t1 JOIN table t2 ON (t1.id = t2.id)
 GROUP BY t1.id 
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2018-02-15T09:35:04.043

## 下面是一个使用“基本循环”和“rownum”实现给定场景的简单 PL/SQL 过程

表定义

```
CREATE TABLE "NAMES" ("NAME" VARCHAR2(10 BYTE))) ; 
```

让我们在这个表中插入值

```
INSERT INTO NAMES VALUES('PETER');
INSERT INTO NAMES VALUES('PAUL');
INSERT INTO NAMES VALUES('MARY'); 
```

手续从这里开始

```
DECLARE 

MAXNUM INTEGER;
CNTR INTEGER := 1;
C_NAME NAMES.NAME%TYPE;
NSTR VARCHAR2(50);

BEGIN

SELECT MAX(ROWNUM) INTO MAXNUM FROM NAMES;

LOOP

SELECT NAME INTO  C_NAME FROM 
(SELECT ROWNUM RW, NAME FROM NAMES ) P WHERE P.RW = CNTR;

NSTR := NSTR ||','||C_NAME;
CNTR := CNTR + 1;
EXIT WHEN CNTR > MAXNUM;

END LOOP;

dbms_output.put_line(SUBSTR(NSTR,2));

END; 
```

结果

```
PETER,PAUL,MARY 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2021-01-14T09:08:59.640

在 PostgreSQL 中 - **array_agg**

```
SELECT array_to_string(array_agg(DISTINCT rolname), ',') FROM pg_catalog.pg_roles; 
```

或**STRING_AGG**

```
SELECT STRING_AGG(rolname::text,',') FROM pg_catalog.pg_roles; 
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2011-04-29T15:28:29.060

用这个：

```
ISNULL(SUBSTRING(REPLACE((select ',' FName as 'data()' from NameList for xml path('')), ' ,',', '), 2, 300), '') 'MyList' 
```

考虑到您认为将显示的最大项目数，“300”可以是任何宽度。

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2013-12-02T09:25:52.907

使用“TABLE”类型非常容易。让我们假设您的表被调用`Students`并且它有 column `name`。

```
declare @rowsCount INT
declare @i INT = 1
declare @names varchar(max) = ''

DECLARE @MyTable TABLE
(
  Id int identity,
  Name varchar(500)
)
insert into @MyTable select name from Students
set @rowsCount = (select COUNT(Id) from @MyTable)

while @i < @rowsCount
begin
 set @names = @names + ', ' + (select name from @MyTable where Id = @i)
 set @i = @i + 1
end
select @names 
```

此示例使用[SQL Server 2008](https://en.wikipedia.org/wiki/History_of_Microsoft_SQL_Server#SQL_Server_2008) R2 进行了测试。

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2018-07-31T06:13:40.833

使用递归查询，您可以这样做：

```
-- Create example table
CREATE TABLE tmptable (NAME VARCHAR(30)) ;

-- Insert example data
INSERT INTO tmptable VALUES('PETER');
INSERT INTO tmptable VALUES('PAUL');
INSERT INTO tmptable VALUES('MARY');

-- Recurse query
with tblwithrank as (
select * , row_number() over(order by name) rang , count(*) over() NbRow
from tmptable
),
tmpRecursive as (
select *, cast(name as varchar(2000)) as AllName from tblwithrank  where rang=1
union all
select f0.*,  cast(f0.name + ',' + f1.AllName as varchar(2000)) as AllName 
from tblwithrank f0 inner join tmpRecursive f1 on f0.rang=f1.rang +1 
)
select AllName from tmpRecursive
where rang=NbRow 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2019-04-23T17:42:17.210

我们可以使用 RECUSRSIVITY, WITH CTE, union ALL 如下

```
declare @mytable as table(id int identity(1,1), str nvarchar(100))
insert into @mytable values('Peter'),('Paul'),('Mary')

declare @myresult as table(id int,str nvarchar(max),ind int, R# int)

;with cte as(select id,cast(str as nvarchar(100)) as str, cast(0 as int) ind from @mytable
union all
select t2.id,cast(t1.str+',' +t2.str as nvarchar(100)) ,t1.ind+1 from cte t1 inner join @mytable t2 on t2.id=t1.id+1)
insert into @myresult select *,row_number() over(order by ind) R# from cte

select top 1 str from @myresult order by R# desc 
```

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2020-11-13T11:33:38.447

首先，您应该声明一个表变量并用表数据填充它，然后使用 WHILE 循环，逐行选择行并将其值添加到 nvarchar(max) 变量。

```
 Go
    declare @temp table(
        title nvarchar(50)
    )
    insert into @temp(title)
    select p.Title from dbo.person p
    --
    declare @mainString nvarchar(max)
    set @mainString = '';
    --
    while ((select count(*) from @temp) != 0)
    begin
        declare @itemTitle nvarchar(50)
        set @itemTitle = (select top(1) t.Title from @temp t)

        if @mainString = ''
        begin
            set @mainString = @itemTitle
        end
        else
        begin
            set @mainString = concat(@mainString,',',@itemTitle)
        end

        delete top(1) from @temp

    end
    print @mainString 
```

* * *

## 回答 #47

> 赞同：-5
> 
> 时间：2015-04-20T06:07:42.353

```
 declare @phone varchar(max)='' 
   select @phone=@phone + mobileno +',' from  members
   select @phone 
```

# c# - C#中的随机日期

> ID：194863
> 
> 赞同：151
> 
> 时间：2008-10-12T00:01:38.090
> 
> 标签：c#, datetime, random, date

我正在寻找一些简洁、现代的 C# 代码来生成 1995 年 1 月 1 日和当前日期之间的随机日期。

我在想一些利用 Enumerable.Range 的解决方案可能会使这更简洁。

* * *

## 回答 #1

> 赞同：266
> 
> 时间：2008-10-12T00:06:45.693

```
private Random gen = new Random();
DateTime RandomDay()
{
    DateTime start = new DateTime(1995, 1, 1);
    int range = (DateTime.Today - start).Days;           
    return start.AddDays(gen.Next(range));
} 
```

为了获得更好的性能，如果这将被重复调用，请在函数*外部*`start`创建and `gen`（甚至可能是`range`）变量。

 ** * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-12T02:18:09.983

这是对 Joel 关于制作稍微更优化版本的评论的轻微回应。与其直接返回随机日期，不如返回一个可以重复调用以创建随机日期的生成器函数。

```
Func<DateTime> RandomDayFunc()
{
    DateTime start = new DateTime(1995, 1, 1); 
    Random gen = new Random(); 
    int range = ((TimeSpan)(DateTime.Today - start)).Days; 
    return () => start.AddDays(gen.Next(range));
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-10-08T18:14:55.950

我已经接受了@Joel Coehoorn 的回答并做出了他建议的更改 - 将变量从方法中取出并将所有内容放在课堂上。另外，现在时间也是随机的。这是结果。

```
class RandomDateTime
{
    DateTime start;
    Random gen;
    int range;

    public RandomDateTime()
    {
        start = new DateTime(1995, 1, 1);
        gen = new Random();
        range = (DateTime.Today - start).Days;
    }

    public DateTime Next()
    {
        return start.AddDays(gen.Next(range)).AddHours(gen.Next(0,24)).AddMinutes(gen.Next(0,60)).AddSeconds(gen.Next(0,60));
    }
} 
```

以及如何使用将 100 个随机 DateTimes 写入控制台的示例：

```
RandomDateTime date = new RandomDateTime();
for (int i = 0; i < 100; i++)
{
    Console.WriteLine(date.Next());
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-12T03:16:57.197

好吧，如果您要提供替代优化，我们也可以使用迭代器：

```
 static IEnumerable<DateTime> RandomDay()
 {
    DateTime start = new DateTime(1995, 1, 1);
    Random gen = new Random();
    int range = ((TimeSpan)(DateTime.Today - start)).Days;
    while (true)
        yield return  start.AddDays(gen.Next(range));        
} 
```

你可以像这样使用它：

```
int i=0;
foreach(DateTime dt in RandomDay())
{
    Console.WriteLine(dt);
    if (++i == 10)
        break;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-12T00:04:35.103

从一个固定的日期对象（1995 年 1 月 1 日）开始，用 AddDays 添加一个随机天数（显然，注意不要超过当前日期）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-10-19T16:11:58.050

```
Random rnd = new Random();
DateTime datetoday = DateTime.Now;

int rndYear = rnd.Next(1995, datetoday.Year);
int rndMonth = rnd.Next(1, 12);
int rndDay = rnd.Next(1, 31);

DateTime generateDate = new DateTime(rndYear, rndMonth, rndDay);
Console.WriteLine(generateDate); 
```

//这可能不是最好的方法，但快速且易于理解

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-11-14T12:31:56.377

我玩游戏有点晚了，但这里有一个很好的解决方案：

```
 void Main()
    {
        var dateResult = GetRandomDates(new DateTime(1995, 1, 1), DateTime.UtcNow, 100);
        foreach (var r in dateResult)
            Console.WriteLine(r);
    }

    public static IList<DateTime> GetRandomDates(DateTime startDate, DateTime maxDate, int range)
    {
        var randomResult = GetRandomNumbers(range).ToArray();

        var calculationValue = maxDate.Subtract(startDate).TotalMinutes / int.MaxValue;
        var dateResults = randomResult.Select(s => startDate.AddMinutes(s * calculationValue)).ToList();
        return dateResults;
    }

    public static IEnumerable<int> GetRandomNumbers(int size)
    {
        var data = new byte[4];
        using (var rng = new System.Security.Cryptography.RNGCryptoServiceProvider(data))
        {
            for (int i = 0; i < size; i++)
            {
                rng.GetBytes(data);

                var value = BitConverter.ToInt32(data, 0);
                yield return value < 0 ? value * -1 : value;
            }
        }
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-03-10T06:35:13.443

基于一些简单的输入参数，将随机日期作为字符串返回的小方法。基于上述答案的变体构建：

```
public string RandomDate(int startYear = 1960, string outputDateFormat = "yyyy-MM-dd")
{
   DateTime start = new DateTime(startYear, 1, 1);
   Random gen = new Random(Guid.NewGuid().GetHashCode());
   int range = (DateTime.Today - start).Days;
   return start.AddDays(gen.Next(range)).ToString(outputDateFormat);
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2021-01-18T21:52:08.767

基于@Jeremy Thompson 解决方案的有用扩展

```
public static class RandomExtensions
{
    public static DateTime Next(this Random random, DateTime start, DateTime? end = null)
    {
        end ??= new DateTime();
        int range = (end.Value - start).Days;
        return start.AddDays(random.Next(range));
    }
} 
```

# windows - 非基于 SSL 的签名和加密的硬件加速

> ID：194869
> 
> 赞同：2
> 
> 时间：2008-10-12T00:05:53.977
> 
> 标签：windows, encryption, hardware, hash, signing

我正在从事一个进行大量散列、签名以及非对称和对称加密的项目。由于这些步骤对我们的性能和可用负载有重大影响，我想知道是否有基于硬件的解决方案来卸载工作。

我做了一些冲浪来找出答案，我能找到的唯一项目是专用于基于 SSL 的通信。我需要一个更通用的解决方案，无论它发生在哪里，我都可以加快签名和加密的速度。

是否可以调整这些基于 SSL 的解决方案（也许它只是营销，很容易在其他地方重复使用）？是否有一个很好的通用协处理器可以提供帮助？

我需要在基于 Windows Server 2008 的机器上使用它，但我会对任何平台上的解决方案感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T00:42:33.467

我不确定这会有多大帮助，但是我看到了一些关于使用图形硬件加速加密的论文

[这是一个快速的谷歌搜索](http://www.google.com.au/search?q=AES+on+GPU)

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T01:32:25.473

有几家公司生产加密专用硬件。例如，我最近在一个应用程序中编写了对 nCipher 硬件设备的支持，该设备在卡上处理 AES（并支持许多其他加密算法）。它们并不便宜，但它们确实支持各种算法和操作模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T03:02:33.263

如果您正在使用的算法是标准加密算法，如 3DES 和 AES，那么肯定有可用的硬件。[Hifn](http://www.hifn.com/)是最知名的，但[博通](http://www.broadcom.com/products/Small-Medium-Business/Security-Processor-Solutions)也拥有多年前收购 BlueSteel 的一系列芯片。[nCipher](http://www.ncipher.com/)也有一系列加密产品，尽管当我（几年前）上次查看它们时，它们更专注于其安全密钥管理硬件，而不是块算法的加速。

即使是为 SSL 设计的卡片也可能对您有用，尽管您需要访问低级别的详细信息。SSL 硬件的最大胜利是指数器和宽乘法器单元，这两者通常可以在我所知道的硬件中独立访问。如果您使用的是非对称加密算法，那么这两个单元也可能对您有用。

您还应该检查是否有更有效的软件实施可用。例如，Dan Bernstein 和 Peter Schwabe在 2008 年 9 月[发表](http://cr.yp.to/aes-speed/aesspeed-20080926.pdf)了一篇关于为现代 CPU 优化 AES 的论文。软件实现已被置于公共领域（即否认所有版权，随心所欲地使用它）。

最后，未来的 AMD（可能还有 Intel）CPU 将包括[SSE5](http://developer.amd.com/SSE5)，它添加了对 AES 特别有用的指令。如果您能坚持到那时，您的下一次服务器升级可能会提供您需要的所有硬件支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T03:03:24.557

最流行的硬件加密引擎是[威盛 Padlock](http://www.via.com.tw/en/initiatives/padlock/hardware.jsp)，包含在 C3、C7 和更高版本的处理器中。这些是低性能、低功耗；但是（据说）在加密算法上很容易胜过 Core2。

Linux 内核 2.6.16 及更高版本[包括](http://www.logix.cz/michal/devel/padlock/index.xp?show_selected=1&msgid=424)对 RNG、MD5、SHA1/256、SSL、GPG 和其他标准事物的支持。我不确定ssh。

您提到了非 SSL，因此您可能无法从现有代码中受益，但 Via 的网站有从用户空间使用它所需的文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-31T07:23:23.887

在 Windows 上，您想找到一个设备，其 API 支持 MSCAPI、CAPING 或 PKCS#11，第一个和最后一个都很常见，但 MSCAPI 不支持硬件 AES/3DES。

nCipher（现在的 Thales）做几个盒子或 PCI/PCIe 卡，支持上述（并支持 openssl），还支持其他平台，包括 Linux 和 Solaris，Safenet 也做类似的硬件，支持类似的平台。

如果我刚开始我会选择 PKCS#11，那么您可以选择不错的语言来编写，包括 C 或 java。

如果你想用 C#/.Net 编写，那么你可以使用 .Net 的 MSCAPI，或者你可以 PInvoke 到你的硬件的 PKCS#11 DLL。

# google-maps - 哪个地图 api 最能支持虚构定义的地图？

> ID：194879
> 
> 赞同：4
> 
> 时间：2008-10-12T00:12:09.643
> 
> 标签：google-maps, mapping

我正在研究在网络游戏中为我的联盟设置映射工具的可行性。该游戏并非基于现实世界，因此我对可用地图工具的内容不感兴趣，只对功能感兴趣。

至少，我希望地图显示有关盟国城市在世界上的位置的信息。理想情况下，我希望能够显示有关所需行业、发展水平和军事行动的信息。所有这些都应该由地图用户编辑。

我一直在研究 google maps API，看来我可以通过使用我自己的地图图块和自定义定义的地图对象和一些自定义叠加层来使用它来服务于我的目的，但看起来它会做很多工作建立。

是否有其他工具更适合这项任务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T01:41:37.513

A List Apart 有[一篇来自 EveryBlock.com 的创建者的文章](http://www.alistapart.com/articles/takecontrolofyourmaps)。他们使用完整的开源堆栈（客户端库、切片缓存、地图生成器）作为 Google 地图的替代品。听起来它正是您所需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T01:48:42.853

我认为 Goole Maps API 方法并不像您想象的那么难。该 API 提供了一个非常好的接口来定义自定义图块集以呈现您自己的地图。

这个界面实际上使用起来非常简单。这里有详细的[描述](http://code.google.com/apis/maps/documentation/overlays.html#Custom_Map_Types)。当你创建一个*GMapType*对象时，你可以为你自己的图像块指定一个 url 向量，标记图像并从根本上改变显示范式。

网上有很多这样的例子：

*   [乔治·RR·马丁的《权力的游戏》](http://www.towerofthehand.com/maps/westeros.html?lat=-11.602&lng=-150.996&zoom=3)。我发现他们写的[javascript很清楚。](http://www.towerofthehand.com/maps/gmaps/core.js)
*   [遗忘游戏世界](http://www.uesp.net/maps/obmap/obmap.shtml)（正如马特提到的）。
*   [魔兽世界游戏世界](http://mapwow.com/)

我认为这是在网络上实现您自己的地图的一种非常强大的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-07T05:33:58.520

[Oblivion](http://www.uesp.net/maps/obmap/obmap.shtml)游戏世界有一个谷歌地图实现——这可以作为参考。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-12T00:13:44.757

在 Google 地图中使用 KMZ 文件定义您自己的叠加层不起作用吗？

# visual-studio - 在 Visual Studio 2005 中显示文件树？

> ID：194890
> 
> 赞同：3
> 
> 时间：2008-10-12T00:20:46.257
> 
> 标签：visual-studio

我有一个大型项目，我想开始使用 Visual Studio 2005 进行编辑。我想告诉它“这是我希望你跟踪的所有文件，现在继续吧”并将它们显示为目录树，例如：

```
Folder 1
 - File A
 - File B
 - File C
Folder 2
 - Folder 3
   - File X
   - File Y
 - File D
 - File E 
```

现在它只是在一个大列表中显示所有头文件，在一个大列表中显示所有源文件，我觉得这没有帮助。我也不想花很多时间在项目中为磁盘上的每个文件夹创建一个文件夹。

有什么方法可以让 VS 向我展示解决方案中所有内容的源代码树，按照它在实际磁盘上的位置进行组织？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-12T00:24:45.187

单击解决方案资源管理器中的“显示所有文件”图标，然后选择要包含的文件夹，右键单击并选择“包含在项目中”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-30T10:42:35.603

为了澄清这一点：要导入包含所有子文件夹的源树，在 VS Explorer 视图中表示，就像它在文件系统上一样，您必须通过菜单条目创建一个新的解决方案， 这是VS2005 Pro 菜单中`Datei >> Neu >> Projekt aus vorhandenem Code` 的最后一个条目（德语`New...`版本）例如。

这将打开一个向导，您将在其中找到提到的选项`Show All Files`和`Select Folders`选项。

# linux - 如何有效地检查地址的 VM 映射？

> ID：194896
> 
> 赞同：1
> 
> 时间：2008-10-12T00:24:38.497
> 
> 标签：linux, memory-management

我正在编写一个跟踪工具，它需要处理一个 JIT 的输出，所以堆栈有时看起来很奇怪。我想尝试对地址应用一些启发式方法来确定它们是代码、数据还是垃圾。（如果有时我错了，那没什么大不了的；但是，如果进程崩溃，也没那么多。）

我可以`cat /proc/«pid»/maps`获取 Linux 中某个进程的 VM 映射列表。是否可以在不解析该文件的情况下从进程内部访问此信息（或任何子集）？检查`rwx`地址的位是理想的。本质上，我想要一个“阅读”版本的`mprotect(2)`.

如果我不能这样做，如何确定对某个地址的访问是否会导致分段错误？（在这种情况下已经`SIGSEGV`安装了一个处理程序，我不能轻易覆盖它，或者我就这样做。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T02:25:08.440

查看我发现的所有与内存相关的函数，我可以使用它`munlock()`来确定页面是否有效。

```
bool is_address_valid(ADDRINT addr) {
  static int pagesize = getpagesize();

  const void *foo = (const void *)(addr / pagesize * pagesize);

  if (munlock(foo, 1) == -1) {
    fprintf(stderr, "munlock(%p=>%p, 1) failed: %s\n", addr, foo,
            strerror(errno));
    return false;
  }
  return true;
} 
```

很恶心，但它确实可以防止我的代码崩溃。

# .net - Visual Studio 从哪里获取 Intellisense 使用的类型描述信息？

> ID：194899
> 
> 赞同：2
> 
> 时间：2008-10-12T00:31:05.190
> 
> 标签：.net, visual-studio

您在 Intellisense 气泡中看到的类型/成员/参数描述来自哪里？它们是否存储在类型属性中？

编辑：我对内置类型特别感兴趣。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T00:43:18.723

我不知道内置类型，但是当您构建自己的类时，您可以使用 Xml 注释来列出智能感知信息。构建项目时，注释会放入它们自己的 xml 文件中，只要该文件位于正确的位置，Visual Studio 就可以使用它。不仅如此，您还将获得智能感知帮助来构建评论。对于 C#，只需在类、属性或方法正上方的注释行中添加一个额外的 / 字符：///。对于 VB，使用两个额外的 ' 字符：'''

对此有一个警告（我确信在某处有一个选项可以控制它），但根据我的经验，一旦你在项目的*任何地方*放置了一个 xml 注释，你就会得到*每个*公共项目的编译警告如果您不在项目中的*任何地方*使用它们，t 评论。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T02:10:50.497

.Net Framework 为随附的程序集提供了一个 XML 文档文件。IDE 读取这些文档文件以获取内置类型的描述和工具提示。

该文档通常（但并非总是）存储在框架安装点的子目录中。例如，在我的机器上，文件存储在目录 C:\windows\microsoft.net\framework\v2.0.50727\en 中。

框架中提供的每个程序集都有一个 XML 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T00:52:22.137

尽管如果您的类已编译并且您不想发布源代码，那么您可能需要创建一个 XML 模式文件并将其放置在此处。不确定结构，但四处看看，你就会明白我的意思。

[安装驱动器]\Program Files (x86)\Microsoft Visual Studio 9.0\Xml\Schemas

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T01:11:40.553

我同意乔尔·科霍恩。您可以查看该主题的 MSDN：http: [//msdn.microsoft.com/en-us/library/b2s063f7.aspx](http://msdn.microsoft.com/en-us/library/b2s063f7.aspx)

还有一篇很棒的关于 codeproject 的文章，其中有很多解释、示例、当你想为你的类制作文档而不发布完整源代码和你可能使用的所有标准标签的完整列表时的操作方法（*你可以也定义你自己的标签——只要确保用你的文档工具读出它们，例如 sandcastle*）。

关于代码项目的文章：http: [//www.codeproject.com/KB/XML/csharpcodedocumentation.aspx](http://www.codeproject.com/KB/XML/csharpcodedocumentation.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T02:39:57.113

还可以查看 DotNetConfig.xsd 文件，该文件通常位于 Visual Studio 8（或 9）安装目录的 Xml\Schemas 子目录中。

# c++ - 任何可用于在浮点表示之间转换的 C++ 库？

> ID：194912
> 
> 赞同：2
> 
> 时间：2008-10-12T00:49:02.253
> 
> 标签：c++, floating-point

我最近需要解释 DEC 32 位浮点表示。它与 IEEE 浮点表示法的不同之处在于分配给指数和尾数的位数。

这是一堆浮点格式的描述：

[http://www.quadibloc.com/comp/cp0201.htm](http://www.quadibloc.com/comp/cp0201.htm)

我设法滚动自己的 C++ 代码，将 DEC 32 位浮点数填充到 IEEE 32 位浮点数中，但想知道是否有任何库已经解决了这种转换以及其他问题。

我检查了[boost.org](http://www.boost.org)但在那里没有看到任何东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T01:55:56.533

你的意思是像[libvaxdata](http://pubs.usgs.gov/of/2005/1424/ "libvaxdata")？

我从未使用过它 - 我只是通过谷歌搜索找到它。但它看起来像你正在寻找的东西。

它是一个 C 库而不是 C++，但是从外部“C”调用转换浮点数据应该可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T02:34:00.200

哈......不知道为什么我没有检查代码项目：

[http://www.codeproject.com/KB/applications/libnumber.aspx](http://www.codeproject.com/KB/applications/libnumber.aspx)

# .net - 在字符串之间添加空格

> ID：194914
> 
> 赞同：2
> 
> 时间：2008-10-12T00:52:18.330
> 
> 标签：.net, xml, vb.net, string

在字符串之间添加空格的最佳方法是什么

```
myString = string.Concat("a"," ","b") 
```

或者

```
myString = string.Concat("a",Chr(9),"b") 
```

我正在使用 stringbuilder 构建 XML 文件并寻找有效的东西。

谢谢

编辑 ~ 语言 VB.NET

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T00:55:12.443

使用 XmlDocument 类创建您的 XML 文件。您浪费时间从头开始创建字符串。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-12T00:57:23.047

[String.Join](http://msdn.microsoft.com/en-us/library/57a79xd0.aspx)是一个静态方法，可以采用分隔符（在本例中为“”）和字符串数组。

```
string sentence = String.Join(" ", new string[] { "The", "quick", "brown", "fox" }); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T01:25:04.787

好吧，首先， chr(9) 是一个制表符 - 你会想要使用 chr(32) 来获得一个空格。

也就是说，第一个选项 ,**`string.Concat("a"," ","b")`**是一个更具可读性的选项。我将专注于让您的代码在功能上正确开始。优化应该始终是最后一步，并且只针对那些需要它的领域。换句话说，您需要一个基线来检查您的优化。

太多次，您优化然后发现自己不得不更改代码，这意味着您的优化工作被浪费了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T00:57:29.990

绝对不是 Chr(9)。毕竟，不是每个人都使用 ascii。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T01:12:47.993

作为“传统” [XMLDocument](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)的替代方案，如果您使用的是 .NET 3.5 及更高版本，请查看 LINQ 中新的[XDocument](http://msdn.microsoft.com/en-us/library/system.xml.linq.xdocument.aspx) / [XElement](http://msdn.microsoft.com/en-us/library/system.xml.linq.xelement.aspx)类。

一个很好的教程在这里：

[http://www.hookdonlinq.com/Print.aspx?Page=LINQtoXML5MinuteOverview](http://www.hookedonlinq.com/Print.aspx?Page=LINQtoXML5MinuteOverview)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T11:25:27.147

如果您要连接已知数量的字符串，最好只使用 + ，因为编译器会将其转换为对 string.Concat 的调用。所以

```
s = a + " " + b 
```

变成

```
s = string.Concat(a, " ", b) 
```

但第一个更具可读性。尽管通常需要注意，但在循环中执行此操作时，StringBuilders 通常更可取。

在“”上使用 Chr(32) 不会在速度方面产生任何差异，因为在这种情况下 Chr(x) 在编译时在 VB.Net 中被翻译（不知道它是否总是如此，但在我的机器上它确实如此）所以你'只是让阅读变得更加困难，没有任何好处。Chr 主要用于向后兼容，通常最好用于定义可打印范围之外的字符。

也就是说，除非它是一个非常小的片段，否则最好使用其中一个框架库来构建 XML。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-05-22T06:02:49.537

```
 Dim TestString As String
' Returns a string with 10 spaces.
TestString = Space(10)
' Inserts 10 spaces between two strings.
TestString = "Hello" & Space(10) & "World" 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T02:08:27.117

最简单的方法是使用聚合函数来组合元素。

```
string[] input = new string[]{"a", "b"};
var withSpaces = input.Aggregate( (x,y) => x + " " + ); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-12T02:53:54.403

我看不到问题的代码示例中哪里有字符串生成器；但是既然你说你正在使用一个；我会使用：

```
sb.AppendFormat("{0} {1}", a, b); 
```

# c# - 如何使用 LINQ Contains(string[]) 而不是 Contains(string)

> ID：194930
> 
> 赞同：106
> 
> 时间：2008-10-12T01:14:30.267
> 
> 标签：c#, linq, string, contains

我有一个大问题。

我得到了一个 linq 查询，它看起来像这样：

```
from xx in table
where xx.uid.ToString().Contains(string[])
select xx 
```

数组的值`string[]`将是像 (1,45,20,10,etc...) 这样的数字

默认`.Contains`为`.Contains(string)`.

我需要它来代替： `.Contains(string[])`...

**编辑：**一位用户建议为`string[]`. 我想学习如何，但有人愿意为我指出正确的方向吗？

**编辑：** uid 也将是一个数字。这就是它被转换为字符串的原因。

帮助任何人？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-10-12T02:01:14.073

spoulson 几乎是正确的，但您需要先创建一个`List<string>`。`string[]`实际上`List<int>`如果 uid 也是 .a 会更好`int`。 `List<T>`支持`Contains()`。这样做 `uid.ToString().Contains(string[])`意味着作为字符串的 uid 包含作为子字符串的数组的所有值？？？即使您确实编写了扩展方法，它的感觉也是错误的。

**[编辑]**

除非你改变它并按照 Mitch Wheat 演示的那样编写它`string[]`，否则你就可以跳过转换步骤。

**[结束编辑]**

如果您不执行扩展方法，这就是您想要的（除非您已经将潜在的 uid 集合作为整数 - 然后只需使用`List<int>()`）。这使用了我认为更简洁的链式方法语法，并转换为 int 以确保查询可以与更多提供程序一起使用。

```
var uids = arrayofuids.Select(id => int.Parse(id)).ToList();

var selected = table.Where(t => uids.Contains(t.uid)); 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-12T16:00:38.077

如果你真的想复制*Contains*，但对于数组，这里有一个[扩展方法](http://msdn.microsoft.com/en-us/library/bb383977.aspx)和使用示例代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ContainsAnyThingy
{
    class Program
    {
        static void Main(string[] args)
        {
            string testValue = "123345789";

            //will print true
            Console.WriteLine(testValue.ContainsAny("123", "987", "554")); 

            //but so will this also print true
            Console.WriteLine(testValue.ContainsAny("1", "987", "554"));
            Console.ReadKey();

        }
    }

    public static class StringExtensions
    {
        public static bool ContainsAny(this string str, params string[] values)
        {
            if (!string.IsNullOrEmpty(str) || values.Length > 0)
            {
                foreach (string value in values)
                {
                    if(str.Contains(value))
                        return true;
                }
            }

            return false;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-12T02:03:25.987

试试下面的。

```
string input = "someString";
string[] toSearchFor = GetSearchStrings();
var containsAll = toSearchFor.All(x => input.Contains(x)); 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2012-03-14T22:40:46.867

.NET 4.0 中的 LINQ 为您提供了另一种选择；.Any() 方法；

```
string[] values = new[] { "1", "2", "3" };
string data = "some string 1";
bool containsAny = values.Any(data.Contains); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-04-28T03:31:53.450

或者，如果您已经在列表中有数据并且更喜欢其他 Linq 格式:)

```
List<string> uids = new List<string>(){"1", "45", "20", "10"};
List<user> table = GetDataFromSomewhere();

List<user> newTable = table.Where(xx => uids.Contains(xx.uid)).ToList(); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-12T01:24:42.120

怎么样：

```
from xx in table
where stringarray.Contains(xx.uid.ToString())
select xx 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-12T01:54:24.057

这是编写扩展方法的一种方式的示例（注意：我不会将它用于非常大的数组；另一种数据结构会更合适......）：

```
namespace StringExtensionMethods
{
    public static class StringExtension
    {
        public static bool Contains(this string[] stringarray, string pat)
        {
            bool result = false;

            foreach (string s in stringarray)
            {
                if (s == pat)
                {
                    result = true;
                    break;
                }
            }

            return result;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-02-13T09:07:50.043

*这是一个迟到的答案，但我相信它仍然有用*。
我创建了[NinjaNye.SearchExtension](http://nuget.org/packages/NinjaNye.SearchExtensions/) nuget 包，可以帮助解决这个问题。：

```
string[] terms = new[]{"search", "term", "collection"};
var result = context.Table.Search(terms, x => x.Name); 
```

您还可以搜索多个字符串属性

```
var result = context.Table.Search(terms, x => x.Name, p.Description); 
```

或者执行一个`RankedSearch`which 返回`IQueryable<IRanked<T>>`，它只包含一个显示搜索词出现次数的属性：

```
//Perform search and rank results by the most hits
var result = context.Table.RankedSearch(terms, x => x.Name, x.Description)
                     .OrderByDescending(r = r.Hits); 
```

## 项目 GitHub 页面上有更广泛的指南：[https ://github.com/ninjanye/SearchExtensions](https://github.com/ninjanye/SearchExtensions)

希望这对未来的访客有所帮助

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-04-17T03:55:57.203

Linq 扩展方法。将与任何 IEnumerable 对象一起使用：

```
 public static bool ContainsAny<T>(this IEnumerable<T> Collection, IEnumerable<T> Values)
    {
        return Collection.Any(x=> Values.Contains(x));
    } 
```

用法：

```
string[] Array1 = {"1", "2"};
string[] Array2 = {"2", "4"};

bool Array2ItemsInArray1 = List1.ContainsAny(List2); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-12T01:59:43.077

我相信你也可以做这样的事情。

```
from xx in table
where (from yy in string[] 
       select yy).Contains(xx.uid.ToString())
select xx 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-12T16:38:52.007

那么我是否正确地假设 uid 是唯一标识符（Guid）？这只是可能场景的一个示例，还是您真的试图找到与字符串数组匹配的 guid？

如果这是真的，您可能想要真正重新考虑整个方法，这似乎是一个非常糟糕的主意。您可能应该尝试将 Guid 与 Guid 匹配

```
Guid id = new Guid(uid);
var query = from xx in table
            where xx.uid == id
            select xx; 
```

老实说，我无法想象使用“包含”将字符串数组与 Guid 的内容相匹配的场景是个好主意。一方面， Contains() 不会保证 Guid 中的数字顺序，因此您可能会匹配多个项目。更不用说以这种方式比较 guid 比直接进行比较要慢得多。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-19T05:17:38.043

您应该以相反的方式编写它，检查您的特权用户 id 列表是否包含该表行上的 id：

```
string[] search = new string[] { "2", "3" };
var result = from x in xx where search.Contains(x.uid.ToString()) select x; 
```

LINQ 在这里表现得相当出色，并将其转换为良好的 SQL 语句：

```
sp_executesql N'SELECT [t0].[uid]
FROM [dbo].[xx] AS [t0]
WHERE (CONVERT(NVarChar,[t0].[uid]))
IN (@p0, @p1)',N'@p0 nvarchar(1),
@p1 nvarchar(1)',@p0=N'2',@p1=N'3' 
```

它基本上将'search'数组的内容嵌入到sql查询中，并在SQL中使用'IN'关键字进行过滤。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-17T09:21:21.017

我设法找到了一个解决方案，但不是一个很好的解决方案，因为它需要使用 AsEnumerable() 来返回数据库中的所有结果，幸运的是我在表中只有 1k 条记录，所以它并不是很明显，但是这里有.

```
var users = from u in (from u in ctx.Users
                       where u.Mod_Status != "D"
                       select u).AsEnumerable()
            where ar.All(n => u.FullName.IndexOf(n,
                        StringComparison.InvariantCultureIgnoreCase) >= 0)
            select u; 
```

* * *

*我的原帖如下：*

> 你怎么做反向？我想在实体框架中执行以下操作。
> 
> ```
> string[] search = new string[] { "John", "Doe" };
> var users = from u in ctx.Users
>             from s in search
>            where u.FullName.Contains(s)
>           select u; 
> ```
> 
> 我想要的是找到他们的全名包含“搜索”中所有元素的所有用户。我尝试了许多不同的方法，所有这些方法都没有为我工作。
> 
> 我也试过
> 
> ```
> var users = from u in ctx.Users select u;
> foreach (string s in search) {
>     users = users.Where(u => u.FullName.Contains(s));
> } 
> ```
> 
> 此版本仅查找包含搜索数组中最后一个元素的那些。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-06-18T18:52:59.743

我找到的最佳解决方案是继续在 SQL 中创建一个表值函数来产生结果，例如 ::

```
CREATE function [dbo].[getMatches](@textStr nvarchar(50)) returns @MatchTbl table(
Fullname nvarchar(50) null,
ID nvarchar(50) null
)
as begin
declare @SearchStr nvarchar(50);
set @SearchStr = '%' + @textStr + '%';
insert into @MatchTbl 
select (LName + ', ' + FName + ' ' + MName) AS FullName, ID = ID from employees where LName like @SearchStr;
return;
end

GO

select * from dbo.getMatches('j') 
```

然后，您只需将该函数拖入您的 LINQ.dbml 设计器并像调用其他对象一样调用它。LINQ 甚至知道存储函数的列。我这样称呼它::

```
Dim db As New NobleLINQ
Dim LNameSearch As String = txt_searchLName.Text
Dim hlink As HyperLink

For Each ee In db.getMatches(LNameSearch)
   hlink = New HyperLink With {.Text = ee.Fullname & "<br />", .NavigateUrl = "?ID=" & ee.ID}
   pnl_results.Controls.Add(hlink)
Next 
```

难以置信的简单，并真正利用了应用程序中 SQL 和 LINQ 的强大功能……当然，您可以生成任何您想要的表值函数以获得相同的效果！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-08-04T03:22:02.643

我相信你真正想做的是：让我们想象一个场景，你有两个数据库，它们有一个共同的产品表，你想从表“A”中选择 id 与“B”相同的产品

使用方法 contains 太复杂了我们正在做的是一个交集，并且有一个方法叫做交集

来自 msdn 的示例：http: [//msdn.microsoft.com/en-us/vcsharp/aa336761.aspx#intersect1](http://msdn.microsoft.com/en-us/vcsharp/aa336761.aspx#intersect1)

int [] 数字 = (0, 2, 4, 5, 6, 8, 9); int [] numbersB = (1, 3, 5, 7, 8); var = commonNumbers numbersA.Intersect (numbersB);

我认为你需要的东西很容易通过交集来解决

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-07-30T07:02:35.737

```
from xx in table
where xx.uid.Split(',').Contains(string value )
select xx 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-08-10T13:55:19.457

检查此扩展方法：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace ContainsAnyProgram
{
    class Program
    {
        static void Main(string[] args)
        {
            const string iphoneAgent = "Mozilla/5.0 (iPhone; CPU iPhone OS 5_0 like...";

            var majorAgents = new[] { "iPhone", "Android", "iPad" };
            var minorAgents = new[] { "Blackberry", "Windows Phone" };

            // true
            Console.WriteLine(iphoneAgent.ContainsAny(majorAgents));

            // false
            Console.WriteLine(iphoneAgent.ContainsAny(minorAgents));
            Console.ReadKey();
        }
    }

    public static class StringExtensions
    {
        /// <summary>
        /// Replicates Contains but for an array
        /// </summary>
        /// <param name="str">The string.</param>
        /// <param name="values">The values.</param>
        /// <returns></returns>
        public static bool ContainsAny(this string str, params string[] values)
        {
            if (!string.IsNullOrEmpty(str) && values.Length > 0)
                return values.Any(str.Contains);

            return false;
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-08-08T13:17:40.310

尝试：

```
var stringInput = "test";
var listOfNames = GetNames();
var result = from names in listOfNames where names.firstName.Trim().ToLower().Contains(stringInput.Trim().ToLower());
select names; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-03-06T11:05:11.400

```
var SelecetdSteps = Context.FFTrakingSubCriticalSteps
             .Where(x => x.MeetingId == meetid)
             .Select(x =>    
         x.StepID  
             );

        var crtiticalsteps = Context.MT_CriticalSteps.Where(x =>x.cropid==FFT.Cropid).Select(x=>new
        {
            StepID= x.crsid,
            x.Name,
            Checked=false

        });

        var quer = from ax in crtiticalsteps
                   where (!SelecetdSteps.Contains(ax.StepID))
                   select ax; 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-08-20T02:28:03.427

```
 string texto = "CALCA 40";
        string[] descpart = texto.Split(' ');

        var lst = (from item in db.InvItemsMaster
                   where descpart.All(val => item.itm_desc.Contains(val))
                   select item
                    ).ToList();
        Console.WriteLine("ITM".PadRight(10) + "DESC".PadRight(50)+"EAN".PadRight(14));
        foreach(var i in lst)
        {

            Console.Write(i.itm_id.ToString().PadRight(10));
            Console.Write(i.itm_desc.ToString().PadRight(50));
            Console.WriteLine(i.itm_ean.ToString().PadRight(14));

        }

        Console.ReadKey(); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2010-08-31T17:48:41.557

```
string[] stringArray = {1,45,20,10};
from xx in table 
where stringArray.Contains(xx.uid.ToString()) 
select xx 
```

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2016-10-16T18:21:00.393

```
Dim stringArray() = {"Pink Floyd", "AC/DC"}
Dim inSQL = From alb In albums Where stringArray.Contains(alb.Field(Of String)("Artiste").ToString())
Select New With
  {
     .Album = alb.Field(Of String)("Album"),
     .Annee = StrReverse(alb.Field(Of Integer)("Annee").ToString()) 
  } 
```

# c# - 在 C# 中，将字符串格式化为 XML 的最佳方法是什么？

> ID：194944
> 
> 赞同：43
> 
> 时间：2008-10-12T01:27:01.130
> 
> 标签：c#, xml, string, formatting, string-formatting

我正在 C# 中创建一个轻量级编辑器，并且想知道将字符串转换为格式良好的 XML 字符串的最佳方法。我希望 C# 库中有一个公共方法，例如“public bool FormatAsXml(string text, out string formattedXmlText)”，但它不可能那么容易，不是吗？

非常具体地说，“SomeMethod”方法必须是什么才能产生下面的输出？

```
string unformattedXml;
string formattedXml;

unformattedXml = "<?xml version=\"1.0\"?><book><author>Lewis, C.S.</author><title>The Four Loves</title></book>"
formattedXml = SomeMethod(unformattedXml);

Console.WriteLine(formattedXml); 
```

输出：

```
<?xml version="1.0"?>
  <book id="123">
    <author>Lewis, C.S.</author>
    <title>The Four Loves</title>
  </book> 
```

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-12T23:01:07.243

```
string unformattedXml = "<?xml version=\"1.0\"?><book><author>Lewis, C.S.</author><title>The Four Loves</title></book>";
string formattedXml = XElement.Parse(unformattedXml).ToString();
Console.WriteLine(formattedXml); 
```

输出：

```
<book>
  <author>Lewis, C.S.</author>
  <title>The Four Loves</title>
</book> 
```

Xml 声明不是由 ToString() 输出的，而是由 Save() 输出的......

```
 XElement.Parse(unformattedXml).Save(@"C:\doc.xml");
  Console.WriteLine(File.ReadAllText(@"C:\doc.xml")); 
```

输出：

```
<?xml version="1.0" encoding="utf-8"?>
<book>
  <author>Lewis, C.S.</author>
  <title>The Four Loves</title>
</book> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-12T02:24:37.427

不幸的是，不，它不像 FormatXMLForOutput 方法那么简单，这是微软在这里谈论的；）

无论如何，从 .NET 2.0 开始，推荐的方法是使用 XMlWriterSettingsClass 来设置格式，而不是直接在 XmlTextWriter 对象上设置属性。 [有关更多详细信息，请参阅此 MSDN 页面](http://msdn.microsoft.com/en-us/library/kkz7cs0d.aspx)。它说：

“在 .NET Framework 2.0 版本中，推荐的做法是使用 XmlWriter.Create 方法和 XmlWriterSettings 类创建 XmlWriter 实例。这使您可以充分利用此版本中引入的所有新功能。有关更多信息，请参阅创建 XML 写入器。"

以下是推荐方法的示例：

```
XmlWriterSettings settings = new XmlWriterSettings();
settings.Indent = true;
settings.IndentChars = ("    ");
using (XmlWriter writer = XmlWriter.Create("books.xml", settings))
{
    // Write XML data.
    writer.WriteStartElement("book");
    writer.WriteElementString("price", "19.95");
    writer.WriteEndElement();
    writer.Flush();
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-12T03:33:44.900

使用新的 System.Xml.Linq 命名空间（System.Xml.Linq 程序集），您可以使用以下内容：

```
string theString = "<nodeName>blah</nodeName>";
XDocument doc = XDocument.Parse(theString); 
```

您还可以使用以下命令创建片段：

```
string theString = "<nodeName>blah</nodeName>";
XElement element = XElement.Parse(theString); 
```

如果字符串还不是 XML，您可以执行以下操作：

```
string theString = "blah";
//creates <nodeName>blah</nodeName>
XElement element = new XElement(XName.Get("nodeName"), theString); 
```

在最后一个示例中需要注意的是，XElement 将对提供的字符串进行 XML 编码。

我强烈推荐新的 XLINQ 类。与大多数现有的 XmlDocument 相关类型相比，它们重量更轻，更易于用户使用。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-08-13T08:09:41.470

假设您只是想重新格式化 XML 文档以将新节点放在新行上并添加缩进，那么，如果您使用的是 .NET 3.5 或更高版本，那么最好的解决方案是使用 XDocument 解析然后输出，类似于：

```
string unformattedXml;
string formattedXml;

unformattedXml = "<?xml version=\"1.0\"?><book><author>Lewis, C.S.</author><title>The Four Loves</title></book>";
formattedXml = System.Xml.Linq.XDocument.Parse(unformattedXml).ToString();

Console.WriteLine(formattedXml); 
```

整齐吗？

这应该重新格式化 XML 节点。

要使用以前版本的框架执行此操作需要更多的工作，因为没有内置函数来重新计算空格。

事实上，使用 pre-Linq 类来做到这一点是：

```
string unformattedXml;
string formattedXml;

unformattedXml = "<?xml version=\"1.0\"?><book><author>Lewis, C.S.</author><title>The Four Loves</title></book>";
System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
doc.LoadXml(unformattedXml);
System.Text.StringBuilder sb = new System.Text.StringBuilder();
System.Xml.XmlWriter xw = System.Xml.XmlTextWriter.Create(sb, new System.Xml.XmlWriterSettings() { Indent = true });
doc.WriteTo(xw);
xw.Flush();
formattedXml = sb.ToString();
Console.WriteLine(formattedXml); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-12T01:41:25.300

听起来您想将 XML 加载到[XmlTextWriter](http://msdn.microsoft.com/en-us/library/system.xml.xmltextwriter.aspx)对象中并设置 Formatting 和 Indentation 属性：

```
writer.Formatting = Formatting.Indented;
writer.Indentation = 1;
writer.IndentChar = '\t'; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-13T04:45:19.670

Jason 的方法是最简单的。这是方法：

```
private static string FormatXmlString(string xmlString)
{
    System.Xml.Linq.XElement element = System.Xml.Linq.XElement.Parse(xmlString);
    return element.ToString();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T04:04:54.400

如果您只需要转义 XML 字符，则以下内容可能有用：

```
string myText = "This & that > <> &lt;";
myText = System.Security.SecurityElement.Escape(myText); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-24T06:25:20.240

在 Framework 4.0 中，这**很**简单。

```
var unformattedXml = "<?xml version=\"1.0\"?><book><author>Lewis, C.S.</author><title>The Four Loves</title></book>";
var xdoc = System.Xml.Linq.XDocument.Parse(unformattedXml);
var formattedXml = (xdoc.Declaration != null ? xdoc.Declaration + "\r\n" : "") + xdoc.ToString();
Console.WriteLine(formattedXml); 
```

这增加了所需的缩进，并**维护了 Xml Declaration**。

```
<?xml version="1.0"?>
<book>
  <author>Lewis, C.S.</author>
  <title>The Four Loves</title>
</book> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-12T01:34:00.743

字符串是有效的 XML 吗？您的意思是如何将 XML 字符串转换为 XML 文档？如果是这样，请执行以下操作：

```
XmlDocument xml = new XmlDocument();

xml.LoadXml( YourString ); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-10T20:28:04.910

**System.Xml.Linq.XElement.ToString() 自动格式化！**

```
XElement formattedXML = new XElement.Parse(unformattedXmlString);
Console.WriteLine(formattedXML.ToString()); 
```

# asp.net - VS 2008 Designer 屏幕的替代方案

> ID：194976
> 
> 赞同：1
> 
> 时间：2008-10-12T02:03:40.137
> 
> 标签：asp.net, visual-studio

我认为 2005 年的网页设计器屏幕很平庸，直到我在 2008 年使用了我认为不好的那个。这里有一个有趣的白皮书：

[http://www.west-wind.com/weblog/posts/484172.aspx](http://www.west-wind.com/weblog/posts/484172.aspx)

这些年来我已经非常习惯这些所见即所得的设计师，但我现在正在寻找一种新的方式。

我制作需要数据输入表单的商业网络应用程序。我不需要任何特别艺术的东西，但我确实需要能够在输入表单上排列文本框等，以便它们有序并方便用户。我使用 Telerik 控件，并且我的 CSS 技能接近及格。

人们经常提到他们不使用设计器，但他们很少说明他们使用的方法。

使用 VS 设计器有哪些替代方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T04:14:17.173

我没有为 WebForms 使用任何所见即所得的编辑器。我发现没有好的 HTML 所见即所得编辑器，更不用说 ASP.net。

我的建议是学习足够多的 HTML/CSS/ASP.net，以便您在没有所见即所得编辑器的情况下完全关心代码。如果你不能或不想这样做，那么你只需要忍受一个边缘编辑器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T04:23:49.293

我认为很多时候当人们说他们不使用设计器时，他们大部分时间只使用源视图。这样做的原因是设计人员经常生成您不需要的额外 HTML 代码，或者它甚至可能是一个障碍，例如直接向您的页面添加额外的 css 样式，我还让它通过在表格内的错误位置（尽管在大多数浏览器中显示正常）。

如果您还对源不满意，我建议拆分视图，然后至少在使用设计器时可以看到它正在创建的内容并进行编辑以使其完美。

不要相信设计师会在几个不同的浏览器中看到您的网站。

# .net - 如何找出 .NET 函数可能引发的异常？

> ID：194995
> 
> 赞同：10
> 
> 时间：2008-10-12T02:21:43.267
> 
> 标签：.net, exception, reference

我可能遗漏了一些明显的东西，但是在某处是否有关于 .NET 中的函数抛出哪些异常以及为什么会抛出异常的参考？

例如，我最近在 Visual C# 2008 中试用 Linq，我正在将 XML 文件加载到 XDocument 中。只有通过测试我才意识到如果你尝试加载一个不存在的文件，它会抛出一个 FileNotFound 异常，但是如果你尝试加载一个目录而不是一个文件，你会得到一个 UnauthorizedAccessException。还通过 System.IO 命名空间，我可以看到 FileLoad 异常和 PathTooLongException 之类的东西，我可以猜到它们何时可能被抛出，但在某些我还没有想到的情况下可能会抛出其他东西.

我现在唯一的解决方案就是捕获我知道的那些，然后捕获异常类型，但我宁愿能够确切地知道我最有可能遇到的异常类型以及原因。我原以为 MSDN 库会有这类信息，但我在任何地方都找不到。我只是瞎了吗？这个信息在其他地方吗？

编辑：更多细节，现在我正在寻找 XDocument.Load(string) 函数可能引发的异常。看起来[在线文档](http://msdn.microsoft.com/en-us/library/bb343181.aspx)或对象浏览器中没有任何相关内容。我现在是否只需要运行一些测试，看看我遇到了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T02:33:38.283

好问题，你有 20/20 的视力。C#/.NET 没有实现 throws 语句（即检查异常）。

任何来自 Java 等语言的人都可能对此感到疑惑。

[C# 之父 Anders Hejlsberg 在这篇文章/采访](http://www.artima.com/intv/handcuffsP.html)中解释了将检查异常从 C# 中排除的基本原理。这是一个很好的阅读。

从那篇文章中，安德斯说：

> 我对检查异常的担忧是他们给程序员戴上的手铐。您会看到程序员选择了包含所有这些 throws 子句的新 API，然后您会看到他们的代码变得多么复杂，并且您意识到检查的异常对他们没有任何帮助。正是这些独裁的 API 设计者告诉你如何进行异常处理。他们不应该那样做。

So, as Mitch and monoxide have said, MSDN documentation for the .NET FCL lists exceptions relevant to each class and also exceptions possible within each namespace.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T02:29:26.200

如果函数抛出异常，通常会在离线帮助页面的底部或对象浏览器中列出。它也列在有关如何调用在线 MSDN 库中的函数的信息下方，[例如 string.Contains()](http://msdn.microsoft.com/en-us/library/dy85x1sa.aspx)，它被标记为“异常”。

此外，实际抛出异常的只有函数、属性等，因此这些内容并未包含在一般文档中，仅包含在实际抛出异常的函数或访问器的文档中，如给出的示例中所示。您最好的选择是在 VS 中使用您感兴趣的类/es 浏览对象浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T02:25:45.553

.NET 没有在 java 中实现类似“throws”关键字的任何东西，所以最好的办法是查看在线 MSDN 文档。

编辑：如果您查看命名空间文档（例如[System.IO ），它会列出可能引发的异常。](http://msdn.microsoft.com/en-us/library/system.io.aspx)

# c# - 静态类实例对于 ASP.NET 中的请求或服务器是唯一的吗？

> ID：194999
> 
> 赞同：189
> 
> 时间：2008-10-12T02:25:16.457
> 
> 标签：c#, asp.net, static

在 ASP.NET 网站上，每个 Web 请求的静态类是唯一的，还是在需要时实例化并在 GC 决定处理它们时进行 GC？

我问的原因是因为我之前在 C# 中编写了一些静态类，并且行为与我预期的不同。我本来希望静态类对每个请求都是唯一的，但情况似乎并非如此。

如果它们不是每个请求唯一的，有没有办法让它们成为唯一的？

**更新：**
driis 给我的答案正是我所需要的。我已经在使用单例类，但是它使用的是静态实例，因此即使用户不同，它也会在请求之间共享，这在这种情况下是一件坏事。使用`HttpContext.Current.Items`完美地解决了我的问题。对于将来偶然发现这个问题的任何人，这是我的实现，经过简化和缩短，以便于理解模式：

```
using System.Collections;
using System.Web;

public class GloballyAccessibleClass
{
    private GloballyAccessibleClass() { }

    public static GloballyAccessibleClass Instance
    {
        get
        {
            IDictionary items = HttpContext.Current.Items;
            if(!items.Contains("TheInstance"))
            {
                items["TheInstance"] = new GloballyAccessibleClass();
            }
            return items["TheInstance"] as GloballyAccessibleClass;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2008-10-12T09:51:34.513

您的静态类和静态实例字段在对应用程序的所有请求之间共享，并且与应用程序域具有相同的生命周期。因此，在使用静态实例时应该小心，因为您可能会遇到同步问题等。还要记住，在应用程序池被回收之前，不会对静态实例进行 GC，因此静态实例引用的所有内容都不会被 GC。这可能会导致内存使用问题。

如果您需要一个与请求具有相同生命周期的实例，我建议使用该`HttpContext.Current.Items`集合。这是设计用来存储您在请求中需要的东西的地方。为了更好的设计和可读性，您可以使用单例模式来帮助您管理这些项目。只需创建一个 Singleton 类，将其实例存储在`HttpContext.Current.Items`. （在我的 ASP.NET 通用库中，为此我有一个通用的 SingletonRequest 类）。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2013-08-20T12:09:08.743

静态成员只有当前工作进程的范围，所以它与请求无关，因为不同的请求可能由同一个工作进程处理，也可能不处理。

*   为了与特定用户和跨请求共享数据，请使用 HttpContext.Current.Session。
*   为了在特定请求中共享数据，请使用 HttpContext.Current.Items。
*   为了在整个应用程序之间共享数据，要么为此编写一种机制，要么将 IIS 配置为使用单个进程并编写一个单例/使用应用程序。

顺便说一句，工作进程的默认数量是 1，所以这就是为什么网络上到处都是认为静态成员具有整个应用程序范围的人的原因。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-12T02:30:05.887

由于这些类型包含在应用程序域中，我希望只要应用程序域没有被回收，或者如果请求由不同的应用程序域提供服务，就会存在静态类。

我可以想到几种方法来使特定于特定请求的对象取决于您想要做什么，例如，您可以在 Application.BeginRequest 中实例化该对象，然后将其存储在 HttpRequest 对象中，以便它可以被所有对象访问请求处理管道。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T02:57:37.173

> 如果它们不是每个请求唯一的，有没有办法让它们成为唯一的？

没有。静态成员归 ASP.NET 进程所有，并由Web 应用程序的*所有用户共享。*您需要求助于其他会话管理技术，例如会话变量。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-12T10:02:21.370

通常静态方法、属性和类在该`Application`级别是通用的。只要应用程序存在，它们就会被共享。

您可以使用该`ThreadStatic`属性指定不同的行为。在这种情况下，它们将特定于当前线程，我认为这是特定于每个请求的。
不过，我不建议这样做，因为它似乎过于复杂。

您可以使用`HttpContext.Current.Items`为一个请求设置内容，或`HttpContext.Current.Session`为一个用户设置内容（跨请求）。

一般来说，除非你必须使用类似`Server.Transfer`的东西，否则最好的方法基本上是创建一次，然后通过方法调用显式传递它们。*~~*******