# StackOverflow 问答 000735000-000735999

# iphone - 在 iPhone 应用程序中可能存在多个符合 UIApplicationDelegate 协议的类是否有意义？

> ID：735000
> 
> 赞同：5
> 
> 时间：2009-04-09T16:39:54.963
> 
> 标签：iphone

我想我已经理解了那个代表应该做什么。如果一个类符合该协议，它会告诉底层系统：“嘿，我是 UIApplication 对象的代表！告诉我发生了什么，我可能会告诉你该做什么！”。

什么，如果多个类实现它？那可能吗？这有任何意义吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T16:52:15.107

虽然您可以实现多个符合 UIApplicationDelegate 协议的类，但只有一个类会接收这些消息。

实现一个协议来创建一个委托只是等式的一部分。然后必须使用生成消息的代码注册该委托，并且这些系统通常只支持一个委托。

在 UIApplication 的情况下，您可以使用 UIApplication 共享类中的“delegate”属性更改委托，但这将替换原始委托，而不是添加额外的委托。

如果您需要将 UIApplication 级别的消息广播到其他系统，那么这是您应该添加到现有委托的功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T16:48:07.970

您可以实现多个采用 UIApplicationDelegate 协议的类，但在任何给定时间只有一个可以是实际的委托。它由 设置`[UIApplication sharedApplication].delegate`，通常由主 NIB 文件通过插座连接设置。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T17:36:19.710

仅仅遵守协议不会将您的对象设置为委托，您需要在 nib 或代码中明确地执行此操作。如前所述，一次只能有一个对象作为委托。在某些情况下，拥有多个委托可能是有意义的——例如，如果您有一个显示两组数据的表格视图，您可以为其创建两个委托和数据源对象，并根据需要在它们之间切换。不过，对应用程序的委托执行此操作可能没有意义，因为那里的代码非常具体。

请记住，除了调用委托方法之外，有时对象还会发送通知。很多时候它们看起来是一样的，因为如果对象包含某个方法签名，它将自动为您的委托订阅通知。关键区别在于，除了委托之外的其他对象也可以订阅这些通知，因此您可以一次将它们连接到多个对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T03:03:08.990

正如丹尼尔·迪克森所说：

> 您可以实现多个采用 UIApplicationDelegate 协议的类，但在任何给定时间只有一个可以是实际的委托。它由 [UIApplication sharedApplication].delegate 设置，通常由主 NIB 文件通过插座连接设置。

...但要知道，如果需要，您可以在运行时将它们换掉。我最近考虑使用这种技术来合并由不同方开发的两个应用程序，这些应用程序不能共享源代码或重构；还需要在设备上的单个图标下共同定位。

# c++ - 关于如何以编程方式与 nmap 集成的任何想法？

> ID：735001
> 
> 赞同：1
> 
> 时间：2009-04-09T16:40:04.417
> 
> 标签：c++, security, integration, nmap

我刚刚开始研究如何将开源安全产品 nmap 集成到一些 c++ 代码中。如果有人尝试过这个，并且对最佳方法有一些想法，我当然会很感激。

感谢您的回复。具体来说，我想运行端口扫描（ipv6）。我肯定更喜欢非 gpl 解决方案，例如命令行或套接字接口。然而，我也在这一点上寻找最快的解决方案，因为我们面临一些严格的时间表，如果需要，我们可以回载实施非 gpl 解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T04:21:38.567

（注意：我不是律师，这些都不应被视为法律建议）

[您可能应该注意到，根据手册中的许可章节](http://nmap.org/book/man-legal.html)，Nmap 将解析其输出的产品视为衍生作品，因此属于 GPL 许可义务。[GPLv2](http://www.gnu.org/licenses/old-licenses/gpl-2.0.html)没有定义衍生作品是什么，而是让法院根据版权法中的定义来决定。通常的解释是，除了链接到操作系统中包含的系统库之外，任何形式的链接都会使链接的工作成为派生作品，而通过管道或网络进行对话的单独进程不一定是派生作品，尽管如在GPL[常见问题解答](http://www.gnu.org/licenses/gpl-faq.html#MereAggregation)，“如果通信的语义足够亲密，交换复杂的内部数据结构，那也可以作为将这两个部分组合成一个更大程序的基础。” 这似乎是 Nmap 开发人员正在采取的解释。

无论如何，假设您不需要担心 GPL，您可能想查看 Nmap 的[输出选项](http://nmap.org/book/man-output.html)；特别是`-oX`对于 XML 输出和`-oG`“greppable”输出。如果您需要更多地控制 Nmap 的功能，您应该查看[Nmap 脚本引擎](http://nmap.org/book/nse.html)，这是 Nmap 中的 Lua 脚本引擎，可为您提供各种控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T04:24:55.627

你总是可以在管道中阅读它。根据传统，即使非 GPL 访问 GPL 也是可以接受的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T16:50:29.587

您是否希望使用特定的功能？我发现在其他语言中使用 nmap 的一种简单方法是使用 -oX 开关让它吐出 xml。有一个 DTD（以及许多将其转换为您最喜欢的绑定工具的 xsd 的方法）您可以使用它来使用数据。

鉴于您是用 C++ 编写的，但如果需要，直接链接可能很容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T16:49:24.660

“整合”并没有真正说得足够多。你想做什么样的事情？根据“集成”的级别，将 nmap 作为单独的进程运行并捕获其输出可能就足够了。这样做的好处是您可以更新 nmap 的版本，而无需重新构建您的应用程序。如果你需要更紧密的耦合，那么这取决于你需要什么功能和“库化”nmap，但要注意它是 GPL 代码，这种集成需要你的应用程序的源代码分发。

# postgresql - 持久数据源驱动程序

> ID：735003
> 
> 赞同：0
> 
> 时间：2009-04-09T16:41:39.670
> 
> 标签：postgresql, driver, eclassnotfound

我是新手，我做了 helloWorld 教程，顺便说一句，非常令人印象深刻，但我现在正试图连接到一个真正的 postgres 数据库，当我觉得它应该很简单时，我发现自己正在努力让驱动程序被识别。

我将所有用于 postgres 的 jdbc 驱动程序放到了 persevere/lib 文件夹中：

*   postgresql-8.3-603.jdbc2ee.jar
*   postgresql-8.3-603.jdbc2.jar
*   postgresql-8.3-603.jdbc3.jar
*   postgresql-8.3-603.jdbc4.jar

然而，当我开始坚持使用命令“persvr”时，我的项目文件夹中没有任何参数，我收到以下错误消息：

```
java.lang.ClassNotFoundException: org.postgresql.Driver
    at java.net.URLClassLoader$1.run(URLClassLoader.java:200)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:276)
    at java.lang.ClassLoader.loadClass(ClassLoader.java:251)
    at org.mortbay.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:379)
    at org.mortbay.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:341)
    at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)
    at java.lang.Class.forName0(Native Method)
    at java.lang.Class.forName(Class.java:169)
    at org.persvr.datasource.DatabaseDataSource.initParameters(Unknown Source)
    at org.persvr.datasource.DatabaseTableDataSource.initParameters(Unknown Source)
    at org.persvr.data.DataSourceManager.initSource(Unknown Source)
    at org.persvr.data.DataSourceManager.<clinit>(Unknown Source)
    at org.persvr.data.Identification.idForString(Unknown Source)
    at org.persvr.Persevere.load(Unknown Source)
    at org.persvr.job.SampleData.execute(Unknown Source)
    at org.persvr.job.Upgrade.execute(Unknown Source)
    at org.persvr.remote.PersevereFilter.init(Unknown Source)
    at org.mortbay.jetty.servlet.FilterHolder.doStart(FilterHolder.java:97)
    at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
    at org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:620)
    at org.mortbay.jetty.servlet.Context.startContext(Context.java:140)
    at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1234)
    at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)
    at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:460)
    at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
    at org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:152)
    at org.mortbay.jetty.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:156)
    at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
    at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)
    at org.mortbay.jetty.Server.doStart(Server.java:222)
    at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
    at org.persvr.util.JettyStart.main(Unknown Source) 
```

我实际上是在尝试将 helloWorld 项目扩展为一个练习，所以我在我的 helloWorld/WEB-INF/config 文件夹中添加了一个 postgres.json 文件。这是该文件的内容：

```
 {"id":"postgres.json",
"sources":[
        {"name":"addressTable",
                "sourceClass":"org.persvr.datasource.DatabaseTableDataSource",
                "connection":"jdbc:postgresql://hostname:5432/pnp?user=user1&pass=mypassword",
                "driver":"org.postgresql.Driver",
                "camelCaseColumnNames": false,
                "table":"addr",
                "idColumn":"addr_id",
                "dataColumns":["addr_stat_cd","addr1","addr2","city","state","zip","zip_ext","cntry_cd","last_upd_uid","last_upd_dttm","create_uid","create_dt
tm"],
        "schema":{
                "data":{"$ref":"../addressTable/"}
        }
}]
} 
```

谁能告诉我为什么坚持找不到那个postgres驱动程序？

谢谢，兰斯洛特。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T17:46:58.220

弄清楚了。postgres 驱动程序 jar 实际上应该进入文件夹：persevere/WEB-INF/lib 而不是 persevere/lib。

# c++ - 扫描算法的排序边

> ID：735005
> 
> 赞同：0
> 
> 时间：2009-04-09T16:42:13.210
> 
> 标签：c++, geometry

我的班级中有以下数据结构：

```
typedef vector< vector<int> > MxInt2d;
typedef vector< vector<double> > MxDouble2d;

class QSweep{   
public:
....
static MxDouble2d myPoints_;
MxDouble2d myEdges_;
} 
```

其中： 每个点有 3 个分量，因此由索引、x 和 ay 坐标给出；每条边由其源 index-edge[0] 和它的目标 index-edge[1] 给出，其中 edge[0],edge[1] 是 myPoints 数据结构的索引）。我的变量 myEdges_ 中有这个边。

问题如下：如何安排这些边缘以应用扫描算法并获得良好的结果并且仅获得良好的结果（即边缘的所有交点）。到目前为止，我有两种不同的边缘排列标准，但它们都没有给我好的结果，只有好的结果（要么我没有获得所有的交叉点，要么我得到了交叉点加上其他一些不是交叉点的点） .

这是我的标准：

标准 1（想法）：

*   通过它们的边缘 [0] 坐标的 x 坐标（如果 2 条边缘的 x 不同）

*   通过它们的 edge[0] 坐标的 y 坐标（如果 2 条边的 x 相等）

*   通过它们相应的斜率（如果边缘的 x 和边缘的 y 相等）。

标准 1（代码）：

```
 class QSweep{   
  public:
  ....
 static MxDouble2d myPoints_;
 MxDouble2d myEdges_;

 class order{
 public:
    bool operator() (const vector<int>& edge1, const vector<int>& edge2){
            //std::cout<<"inside sort"<<endl;
            //3 sort criteria
            return (myPoints_[edge1[0]][0]<myPoints_[edge2[0]][0])|| 
                       (myPoints_[edge1[0]][0]==myPoints_[edge2[0]][0]&& 
                        myPoints_[edge1[0]][1]<myPoints_[edge2[0]][1]) 
                   ||
                    (myPoints_[edge1[0]][0]==myPoints_[edge2[0]][0]&& 
                         myPoints_[edge1[0]][1]==myPoints_[edge2[0]][1]&& 
                     getSlope(myPoints_[edge1[0]][0],myPoints_[edge1[0][1],  
                                  myPoints_[edge1[1]][0],myPoints_[edge1[1]][0])
                     <
                         getSlope(myPoints_[edge2[0][0],myPoints_[edge2[0][1],    
                                  myPoints_[edge2[1]][0],myPoints_[edge2[1]][0]));
                    }
};

static double getSlope(double a, double b, double c, double d);
}; 
```

标准2（想法）：

*   通过它们的边缘 [0] 坐标的 x 坐标（如果 2 条边缘的 x 不同）

*   通过它们相应的斜率（如果 2 条边的 x 相等）

*   通过它们的 edge[1] 坐标的 y 坐标（如果边缘的 x 和边缘的斜率相等）。

标准 2（代码）：

```
class QSweep{   
public:
....
static MxDouble2d myPoints_;
MxDouble2d myEdges_;
class order{
public:
    bool operator() (const vector<int>& edge1, const vector<int>& edge2){
    return ((myPoints_[edge1[0]][0]<myPoints_[edge2[0]][0])||
       ((myPoints_[edge1[0]][0]==myPoints_[edge2[0[0])&&
            (getSlope(myPoints_[edge1[0]][0],myPoints_[edge1[0]][1],
                      myPoints_[edge1[1]][0],myPoints_[edge1[1]][1])
             <getSlope(myPoints_[edge2[0]][0],myPoints_[edge2[0]][1],
                      myPoints_[edge2[1]][0],myPoints_[edge2[1]][1]) ))||
    ((myPoints_[edge1[0]][0]==myPoints_[edge2[0]][0])&&(   
             getSlope(myPoints_[edge1[0]][0],myPoints_[edge1[0]][1],
                      myPoints_[edge1[1[0],myPoints_[edge1[1]][1])==
            getSlope(myPoints_[edge2[0]][0],myPoints_[edge2[0]][1],
                     myPoints_[edge2[1]][0],myPoints_[edge2[1]][1]) )
          &&(myPoints_[edge1[1]][1]<myPoints_[edge2[1]][1]))
                 );
} 
```

};

是的，这看起来真的很复杂，我在我的算法上尝试了这些标准，但我没有获得所有的交点。所以我猜我的扫描算法边缘的排序标准不好，因为我检测到一些交叉点但没有检测到其他交叉点。提前感谢您的建议（或小意见），madalina

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T16:55:09.047

与我们的问题没有直接关系，但是如果您使用简单的 Point 结构来表示 XY 坐标，我可以建议您的代码更具可读性吗？就像是：

```
template <typename T> struct Point {
   Point( const T & ax, const T & ay ) : x( ax ), y( ay ) {}
   T x, y;
}; 
```

将是一个开始。然后，您可以创建 Point 的 1 维向量，并使用名称 x 和 y 而不是数组索引。

只是一个建议-随意忽略...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T17:29:16.983

对于扫描线算法，您通常对您的点使用字典排序：

*   按 X 排序，如果您比较的两点的 X 分量相等，则改为按 Y 排序。在 3D 中，您可以扩展到 Z 组件等。

但是，我怀疑排序是您问题的根源（错误和错过的交叉点）。

扫描线算法对舍入误差**非常**敏感。除非您绝对确保您的数学保留了足够的精度以提供有效的结果，否则无法使用浮点运算。

查看此网页以获取有关此类问题的更多详细信息（和解决方案）：

[http://www.cs.cmu.edu/~quake/robust.html](http://www.cs.cmu.edu/~quake/robust.html)

祝你好运。

顺便说一句-您正在编写 Bentley-Ottmann 交叉点扫描，不是吗？这些甚至比其他扫描线算法更敏感，因为由于浮点数的有限精度，插入交点会稍微改变相交边的斜率。

# .net - XML 在现代 nTier 架构中扮演什么角色？

> ID：735006
> 
> 赞同：2
> 
> 时间：2009-04-09T16:42:39.917
> 
> 标签：.net, asp.net, sql-server, xml, web-services

我看过很多关于 ASP.NET 和服务器工程师职位的招聘信息，他们似乎总是将 XML 和 XSLT 列为对他们很有价值的技能之一。我想知道 XML 在现代系统中扮演什么角色。人们如何在 nTier 系统中将 XSLT 与 XML 结合使用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T16:52:27.397

Andrew 非常简洁地说明了基于 XML 的数据在 .NET 系统中的主要作用——为应用程序的配置和不同平台之间数据的可互操作传输提供模板化方法。

XSLT 是将 XML 数据转换为 XML/XHTML 的主要模式，由于同样的原因而被广泛使用。一个 XML 经常需要转换为另一个具有不同结构的 XML，或者可能希望将 XML 数据源直接呈现为 HTML 输出。XSLT 在这种情况下几乎是必不可少的，即使可以通过编写大量 DOM 遍历代码手动完成转换。

使用类似的逻辑，也使用 XPath，因为它提供了遍历 XML 层次结构以根据数据在 XML 中的位置查询数据的最基本和最强大的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T16:43:55.000

XML 在 .NET 系统中扮演两个角色：配置和数据传输。

通过数据传输，我的意思是将 XML 用作一种结构化的形式，可以在其中放置需要从应用程序的一层发送到另一层（或者甚至在一个应用程序和另一个应用程序之间）的数据。这通常通过 XML 序列化来实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T16:45:44.340

XML 广泛用于 SOA 通信，特别是在通过防火墙访问异构系统时。

WCF 和 CSLA 以及所有主要的互操作系统始终将 XML 作为其通信的基石之一。您可以在部分情况下使用二进制或其他格式，但 XML 将始终有效

# javascript - IE7 显示异常（附示例）

> ID：735011
> 
> 赞同：-1
> 
> 时间：2009-04-09T16:45:16.837
> 
> 标签：javascript, internet-explorer

我正在开发基于 Javascript 的 Flash 小程序替代品。该站点仅在 IE 中存在渲染问题，它表现出的行为让我束手无策。

[http://janetalasher.com/new/content/portfolio/artcloth/](http://janetalasher.com/new/content/portfolio/artcloth/)（这是页面）

IE 做了什么这么奇怪（仅在这种情况下）？如果您在 Firefox 中查看，您会在右侧看到一个包含缩略图的图像表。IE6 和 IE7 不显示这个...**除非你在 print preview 中**。这不是 CSS 故障 - 我已禁用所有样式表，但错误仍然存​​在。我会提供更多相关的源代码，但我什至不知道问题出在哪里。我怀疑的 .js 文件（如果有帮助的话）是：

```
/common/gallery/display.js
/common/gallery/loader.js 
```

好的 - 更新：它肯定只在打印预览模式下正确渲染。有人可以**向**我解释一下这种情况发生在什么世界上吗？div 以正常模式存在，但表格不会呈现。使用 IE 开发工具栏确认它并且所有单元格都存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T16:51:55.043

尝试在此处添加分号：

```
function loadGallery(xml)
{
    thumbpath = $(xml).find("thumbpath").attr('dir') // add here
    imagepath = $(xml).find("imagepath").attr('dir') // here
    detailpath = $(xml).find("detailpath").attr('dir') // and here
    cSheet = contactSheet(xml);
    $('.contactSheet')[0].appendChild(cSheet);    
            display($(cSheet).find('img')[0]);
} 
```

此外，在这一行：

```
jQuery.get('/new/content/portfolio/artcloth/gallery.xml' , 'xml' , function(data) { loadGallery(data); } ) // missing one here too 
```

实际上，您的 Javascript 文件最后也缺少分号。确保浏览每个文件并在每一行的末尾添加一个。

Javascript 实际上并不需要它们，但为了理智和确切地知道你的代码在做什么，把它们放进去是个好主意。例如：

```
return
1 
```

可以变成：

```
return;
1; 
```

这根本不返回任何东西，而不是完全期望的效果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-20T17:41:36.837

根据 Microsoft Script Editor，jQuery 内部有一个错误是由这一行引起的：

```
$('#lower').css('padding-left' , paddingLeft - (lowerRightProtrusion < 0 ? 0 : lowerRightProtrusion) + "px"); 
```

由于 lowerRightProtrusion 为 NaN，并且 NaN < 0 计算为 false，因此您实际上将 padding-left 设置为“NaNpx”。不计算;)

有关 MS 脚本编辑器的信息，请参阅我以前的答案： [使用 IE8 '开发者工具'来调试早期的 IE 版本](https://stackoverflow.com/questions/780059/using-the-ie8-developer-tools-to-debug-earlier-ie-versions/801547#801547)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T01:59:20.533

看来 IE 并没有采用这种风格。如果我在 chrome 中打开页面，“float:left”样式会出现在描述 div 上。但是，在 IE 中并非如此。

您当前将包含在文档正文的 div 中。如果可能，请尝试将这些移动到头部。我说的是 div id="pageHead" 的直接后代的链接和脚本标签。

（我正在使用 IE6 和开发人员工具栏来获取此信息）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T19:42:39.640

在`/common/css/generic.css`：

```
div#information 
{
margin-left:188px;
m\argin-left:94px; <------ not sure if that would cause this, but thought i would point it out 
} 
```

# sharepoint - 在 Windows Sharepoint Services 3.0 中仅编辑拥有的列表项

> ID：735015
> 
> 赞同：4
> 
> 时间：2009-04-09T16:46:32.937
> 
> 标签：sharepoint, permissions, wss, wss-3.0

有没有办法将 WSS 3.0 中的“编辑项目”权限限制为只允许用户编辑自己的文档或列出项目？我们需要用户能够仅编辑他创建的文档/列表项 - 而不是其他人创建的项目。所以，本质上我们需要一个 EDIT 权限和 ADD 的子集。

这在 Windows Sharepoint Services 3.0 中是否可行？有没有办法在代码或功能中创建自定义权限？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T14:20:21.930

WSS 具有用于设置列表项的项级权限的基本 UI，但它们在文档库的 UI 中隐藏了该权限。如果您进入`Settings->List Settings->Avanced settings`列表，您会看到几乎可以执行您要求的选项。但是，在文档库中，该 UI 不可用。它驱动的设置虽然可以通过对象模型获得。

您可以像这样为文档库设置相同的属性：

```
SPDocumentLibrary onlyOwnLib = theWeb.Lists["DocLibName"]  
onlyOwnLib.WriteSecurity = 2;  
onlyOwnLib.Update(); 
```

那应该做到这一点。但是，显然这并没有真正设置权限；它只是控制用户可以通过 UI 执行的操作。如果他们有另一个库接口（如通过 WebDAV）或列表（如通过 Web 服务），它不会阻止他们编辑不是他们创建的项目。如果您想要真正的项目级权限，我认为您需要走事件处理程序路线。

Matt Morse 的这篇[文章](https://web.archive.org/web/20100101191855/http://blogs.pointbridge.com/Blogs/morse_matt/Pages/Post.aspx?_ID=8)更详细地解释了它，他甚至编写了一个命令行工具来设置列表和库的属性（加上`.ReadSecurity`属性）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T22:55:16.043

如果您将事件处理程序添加到文档列表，您应该能够将该项目的编辑权限限制为创建该项目的用户。

我经常需要将文档从另一个系统复制到 SharePoint 中的列表中，在这种情况下，编辑权限将分配给传输文档的系统用户，除非您使用 Kirk Liemohn 建议的方法[here](https://stackoverflow.com/questions/624549/add-elements-to-an-an-announcements-list-for-a-specific-user)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:17:05.063

请注意，对大量文档的项目级权限会大大增加 SQL 服务器的负载。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-19T13:34:14.550

**这是您要求的解决方案。** 转到列表 -> 列表设置 -> 高级设置

你会看到的部分

读取权限：指定用户可以读取哪些项目

所有项目只有他们自己

编辑权限：指定用户可以编辑的项目

所有项目 只有他们自己的 无

根据需求选择选项。就是这样..想要更多点击http://mastermoss.wordpress.com

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-31T11:52:14.130

这是一个老问题，但问题仍然存在。

过去对我来说效果很好的一种方法是在添加库项目时使用工作流来配置权限。

有关详细信息，请参阅[http://www.sharepointusecases.com/index.php/2010/03/configure-item-level-permissions-for-document-libraries-part-2/](http://www.sharepointusecases.com/index.php/2010/03/configure-item-level-permissions-for-document-libraries-part-2/) 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T20:02:49.577

我相信可以通过用户界面创建这样的权限。这取决于您拥有的列表项的规模和数量，但您可以做两件事之一。首先（无需创建脚本），您可以为每个人提供自定义的“读取”权限访问权限，这将不允许他们执行您在读取权限中可以执行的所有操作，但允许他们添加项目。然后逐项单击项目 -> 管理权限 -> （授予特定用户对其文档的贡献权限）。

如果您正在创建一个不可行的 SharePoint 列表，您可以创建一个脚本来遍历所有项目，并验证用户是否具有贡献权限（否则它将为该用户设置贡献权限）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T20:18:44.047

此外，您可以只给每个人自己的文件夹。

授予每个人对 SharePoint 列表/文档库的读取权限，但授予每个人对其自己文件夹的完全控制权限。这将允许每个人阅读列表中的所有内容，但可以创建/编辑自己的文档。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-03T04:52:06.703

如果您想要文档库的“仅限他们自己的”权限，它不是开箱即用的。但是我在 CodePlex 创建了一个解决方案，为文档库添加了这个 - 在[http://moresharepoint.codeplex.com](http://moresharepoint.codeplex.com)上查看它。

# c++ - 最有用或最神奇的 STL 短衬里

> ID：735021
> 
> 赞同：23
> 
> 时间：2009-04-09T16:47:19.877
> 
> 标签：c++, stl

我正在寻找几行适合的 C++/STL 代码的实用和教育示例。我最喜欢的是：

1.  清空一个向量以释放其保留的内存：

    ```
    vector <...>().swap (v) 
    ```

    （与临时交换）

2.  将地图复制到向量：

    ```
    map<T1, T2> myMap;
    vector< pair<T1, T2> > myVec(myMap.begin(), myMap.end());
    // or
    myVec.assign(myMap.begin(), myMap.end()); 
    ```

3.  自定义，非增强拆分：

    ```
    vector<string> &mysplit(const string &s, char delim, vector<string> &elems) {
        stringstream ss(s);
        string item;
        while(getline(ss, item, delim)) { elems.push_back(item); }
        return elems;
    } 
    ```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T18:09:21.597

我最喜欢的是将容器复制到输出：并将输入流复制到容器中。

```
#include <vector>
#include <algorithm> 
#include <iterator>
#include <iostream>

int main()
{
    std::vector<int>   data;
    std::copy(std::istream_iterator<int>(std::cin),
              std::istream_iterator<int>(),
              std::back_inserter(data)
             );

    std::copy(data.begin(),data.end(),
              std::ostream_iterator<int>(std::cout,"\n")
             );
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T18:15:14.407

实际删除由`remove()`or删除的元素需要以下习惯用法`remove_if()`：

```
vector<int> v;
...
v.erase(remove(v.begin(), v.end(), 42), v.end()); 
```

`remove()`并且`remove_if()`只需向前滑动未删除的元素并报告新范围的结束位置——它们不会（也不能）删除它们，因为它们可以在任意迭代器范围上工作，而不仅仅是容器。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T17:07:49.077

```
// std::back_inserter usage ( std::inserter for map )
std::copy( source.begin(), source.end(), std::back_inserter( container ) ); 
```

-

```
// mem_fun and bind usage (but boost better)
std::some_algorithm(..., std::mem_fun( func ) ); 
```

不是那么有用，但功能强大：

检查是容器排序的

```
std::adjacent_find( container.begin(), container.end(), greater<Container::value_type>() ) == container.end() 
```

还有你提到的例子。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T16:51:53.623

```
copy(istreambuf_iterator<char>(cin), istreambuf_iterator<char>(),
     ostream_iterator<char>(cout)); 
```

另一个常用的习惯用法是从数组初始化容器：

```
#include <map>
using namespace std;

int main() {
    typedef std::map<char,int> LUT;
    typedef LUT::value_type LUT_item_t;

    const LUT_item_t items[] = { LUT_item_t('b',1), 
                                 LUT_item_t('a',5) 
                               };

    LUT my_map(items, items + sizeof items/sizeof items[0]);
    return 0;
} 
```

但是，如果您想要纯粹的魔法，请查看[Boost Lambda 库](http://www.boost.org/doc/libs/1_38_0/doc/html/lambda.html)；）示例：

```
vector<int*> vp(10); 
sort(vp.begin(), vp.end(), *_1 > *_2); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T18:31:11.123

我最喜欢的是在委托中使用 bind1st/bind2nd/mem_fun。

```
// will call a->func(v[i])
for_each(v.begin(), v.end(), bind1st(mem_fun(&A::func), &a));

// will call w[i]->func(72)
for_each(w.begin(), w.end(), bind2nd(mem_fun(&A::func), 72)); 
```

使用 boost 的 bind 和 function 要好得多，但仅使用 STL 就可以完成令人印象深刻的事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T17:58:57.927

对于您的第二个示例，使用值类型：

#

```
Copy a map to a vector:

typedef map<T1, T2> MyMap;
MyMap myMap;
vector< MyMap::value_type > myVec(myMap.begin(), myMap.end()); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-27T23:16:20.230

我喜欢这个循环遍历文件中的每一行。来自 Dobbs 博士的 Andrew Koenig 专栏。

```
for (string s; getline(stream,s); ) {
  // Process line
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-26T07:40:44.263

结合 lambda 函数使用 std::for_each (C++11 起)

```
std::vector<int> v(20);

std::for_each( v.begin(), v.end(), [] (int item)
{
    std::cout << item;
} ); 
```

代替

```
for(std::vector<int>::const_iterator it = v.begin(); it != v.end(); ++it)
{
    std::cout << *it;
} 
```

使循环更好看。

# mysql - 如何访问远程服务器上的 phpMyAdmin

> ID：735022
> 
> 赞同：4
> 
> 时间：2009-04-09T16:47:44.867
> 
> 标签：mysql, database, phpmyadmin

对于我的网站，我使用 Dreamhost。Dreamhost 要求您创建数据库将驻留的主机名（例如：mysql.mclindigital.com）。对我来说这很简单，如果我想访问 phpMyAdmin，我只需导航到[mysql.mclindigital.com](http://mysql.mclindigital.com)，它就会自动进入 phpMyAdmin。

显然 Dreamhost 是少数使用这种方法的，因为大多数人似乎使用“localhost”。那么，我如何访问这些网站的 phpMyAdmin？我是否需要获取他们的 Web 面板登录信息才能浏览此信息？

例如，我有一个过去的客户，我必须去这里：http: [//216.120.237.104](http://216.120.237.104:2082/3rdparty/phpMyAdmin/index.php) :2082/3rdparty/phpMyAdmin/index.php才能进入他们的 phpMyAdmin。我从来没有真正理解我在做什么，但它确实奏效了。现在我处于同样的情况，但这次客户不那么精通技术，无法给我需要访问的 URL。

另外，我应该指出我不是 100% 确定他们安装了 phpMyAdmin。不过我知道他们有一个数据库，因为他们正在运行一个 Wordpress 博客。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T16:56:31.867

phpMyAdmin 没有什么神奇或特别之处。它只是一堆 php 脚本。

一些虚拟主机（例如 Dreamhost）可能会将其作为标准安装，类似于 formmail 和他们可能安装的许多其他工具。

您的问题很可能是您的客户端没有安装 phpMyAdmin，简单的解决方案（如果您有 ftp 访问权限）是去[http://www.phpmyadmin.net/home_page/index.php](http://www.phpmyadmin.net/home_page/index.php)下载 phpMyAdmin，配置它然后只需将其上传到您自己的 ftp 服务器。然后，您可以像访问任何其他 php 脚本一样访问它。

# visual-studio - VS2008 解决方案模板

> ID：735024
> 
> 赞同：0
> 
> 时间：2009-04-09T16:48:20.560
> 
> 标签：visual-studio

过去，我为我经常在 VS2008 中使用的类创建了 ItemTemplates。我想为将有两个项目、一个网站和一个类库的解决方案创建一个模板。

我无法找到有关如何执行此操作的任何明确说明。我不确定是否可以做到。有没有人有任何可能的解决方案的链接。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T16:51:37.883

MSDN 上有[详细的说明，](http://msdn.microsoft.com/en-us/library/ms185291.aspx)用于在 VS2008 中创建自定义项目模板。

-编辑-

没有“解决方案模板”之类的东西。有项目模板（用于新文件）和项目模板。但是，我认为您可能想做的是创建一种特定类型的项目模板，称为[多项目模板。](http://msdn.microsoft.com/en-us/library/ms185308(VS.80).aspx)

# java - Java 运行时与操作系统调用

> ID：735026
> 
> 赞同：1
> 
> 时间：2009-04-09T16:49:04.537
> 
> 标签：java, operating-system, runtime

Java 运行时提供一组标准系统库供程序使用。这些库在多大程度上类似于操作系统的系统调用，又在多大程度上不同？？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T17:32:01.233

java 的一半目的是让它独立于平台，所以它试图做的是提供一个不管它下面的操作系统如何都保持不变的 api。

如果操作系统功能不足，Java 将添加库代码来弥补它。

如果操作系统有一个不映射的实现，Java 会尽力映射它。

如果新功能变得流行并且 Java 用户需要提供对它的访问权限，则可以创建一个新库，您可以通过该库访问新功能。如果这个库很流行，它将在某个时候进行重组并添加到 Java SDK 中

例如，一些并发库的实现变得流行起来，很快它们就被投票通过并添加到标准库中。这事儿常常发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:00:28.627

这显然取决于您运行的操作系统，因为每个操作系统的系统调用通常都不同:-)。

也就是说，我相信 Java 主要是受到 Unix 约定的启发（并不奇怪，因为 Sun 是 Unix 供应商），所以一些 Java 系统库类似于 Unix 系统调用。

例如 java.nio.MappedByteBuffer 可能是受到 Unix 的 mmap() 调用的启发。但最终大多数概念都出现在大多数操作系统上，所以你不能真正说出是什么启发了什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:13:32.357

Java 的一些“低级”函数基本上是一些操作系统系统调用的“包装器”。

我没有看到“比较”两者的客观方式（和理由）。

如果您对此主题感兴趣，可以在 Java 源代码中搜索**native**关键字，它表示一些“隐藏”（主要是操作系统相关）功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T20:25:56.167

与原生库相比，Java 的标准库通常具有相似的功能集，但有几个重要的区别。

1.  Java 是面向对象的，不管你喜不喜欢。这样做的好处是某些概念更容易管理。例如，大多数与文件相关的操作都可以直接在 File 对象中找到。将此与 Posix 进行比较，其中 FILE 是一个句柄，实际上只是一个数字；进程的打开文件列表的索引。Posix 方法非常接近操作系统的实际实现方式。但是在 Java 中，您看不到、不知道或不在乎。
2.  在某些情况下，Java 具有某些最低公分母行为。有许多 AWT API 就是它们的样子，因为 AWT 需要在许多不同的平台上是相同的。事实证明那是疯狂的，Sun 准弃用了大部分 AWT，因为支持平台同样意味着糟糕地支持每个平台。较新的库 Swing 几乎在纯 Java 中实现了所有内容，因此在跨平台方面做得更好，因此具有更丰富的 API。该 API 与本机窗口库非常不同。此外，Swing 没有很好地集成，因为它使用的本机操作系统非常少。
3.  Java 有一些本地库没有的限制。例如，您没有函数指针。因此，您拥有`Listeners`和`Runnable`其他 Java 模式来执行 C++ 中涉及函数指针的事情。因此，任何需要这些功能之一的 API 在 Java 中与在本机操作系统中都会有很大不同。

因此，总而言之，Java 通常具有提供与本机操作系统类似的行为的库，有时提供完全不同的行为，但最好将 Java 本身视为一个平台。有时您需要高级性能，例如 OpenGL 或超快速数据传输，在这种情况下，您会需要特定的 Java API（Jogl、nio），但大多数时候您应该将 Java 视为自己的东西。

# asp.net - 如何从 Memcached 中按模式删除对象？

> ID：735033
> 
> 赞同：1
> 
> 时间：2009-04-09T16:51:36.013
> 
> 标签：asp.net, caching, memcached, distributed-caching

我正在尝试使用 Memcached 并想知道是否有一种方法可以通过键模式从缓存中删除对象，而不仅仅是每个对象一个键。

比如说，我用键“user1”缓存用户 1，然后用键“user2”缓存用户 2 ...，有没有办法使用以“user”开头的键删除所有对象？或者有没有办法从中获取枚举器并遍历键？

为了完整起见，我在Asp.net 应用程序上使用位于[http://enyimmemcached.codeplex.com/的 enyimmemcached 库。](http://enyimmemcached.codeplex.com/)

谢谢，

射线。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T16:55:19.420

看一下[memcached-tag](http://code.google.com/p/memcached-tag/)，它允许您给所有这些相同的标签，并立即将它们取出。

# iphone - iTunesArtwork Image：这是每次都需要，还是仅在临时分发案例中需要？

> ID：735036
> 
> 赞同：5
> 
> 时间：2009-04-09T16:51:39.787
> 
> 标签：iphone

如果我真的每次都需要这个 512 x 512 像素图标，我不放心，因为我不打算使用 Ad-hoc 分发。如果我没看错的话，Ad-hoc 分发就是当你制作一个应该只在少数公司 iPhone 上运行的应用程序时，你不希望任何人获得该应用程序。如果这是真的，我会选择其他任何人都可以获取应用程序的分发类型。在那种情况下我需要那个图像吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T17:02:15.830

是的，它用于 AdHoc 分发，人们将文件复制到 iTunes 中以允许将它们添加到他们的手机中。从技术上讲，AdHoc 分发甚至不需要它，如果它不存在，则默认图像将显示在 iTunes 中。

但是，在提交到应用商店时，您需要一张 512x512 的图像，该图像将显示在应用商店中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-17T03:48:03.987

对于临时分发：您可以将 512 x 512 jpeg 图像构建到您的应用程序中作为“iTunesArtwork”资源，iTunes 将自动显示它。

但是，有两个重要的规则需要遵循：

*   图像格式必须是 jpeg
*   文件名必须是“iTunesArtwork”，没有文件扩展名

向应用商店提交应用时，您单独上传 512 x 512 图片，不需要将其作为资源内置到应用中...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-14T05:47:41.353

每个[developer.apple.com](http://developer.apple.com/library/ios/#documentation/Xcode/Conceptual/iphone_development/145-Distributing_Applications/distributing_applications.html)：

> 您的测试人员看到的 iTunes 艺术作品应该是您的应用程序的图标。此作品必须是名为 iTunesArtwork 的 512 x 512 JPEG 或 PNG 文件。请注意，该文件不能有扩展名。

This will be an image your testers will see, but nothing your end-users will get in the final build.

# math - VIM：VIM Taglist 元素和代码片段之间的双射？

> ID：735043
> 
> 赞同：4
> 
> 时间：2009-04-09T16:52:19.007
> 
> 标签：math, vim, taglist

**我在 C 代码中的标记列表：**

> 宏
> || 最小长度
> || MAX_ITERATIONS
> ||- typedef
> || 细胞
> || 源单元
> ||- 变量
> || len_given

**标签列表元素（域）：**

```
A = {MIN_LEN, MAX_ITERATIONS, cell, source_cell, len_given} 
```

**代码片段（codomain）：**

```
B = {"code_MIN_LEN", "code_MAX_ITERATIONS", ..., "code_len_given"} 
```

**目标：**在集合 A 和 B 之间存在双射。

**示例：**我想通过删除 A 或 B 中的元素从 A 和 B 中删除 A 中的任何元素，例如 MIN_LEN。

**问题：**有没有办法隔离 A 和 B 之间的双射，以便 A 或 B 的变化导致另一组的变化？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-23T17:58:14.190

我强烈怀疑你能做到这一点。taglist 插件使用 ctags 来收集代码中的符号并在横向拆分中显示它们。横向拆分包含只读信息（如果您尝试在该窗口上工作，vim 会告诉您该缓冲区的可修改已关闭）。

您想要实现的目标意味着对您正在修改的源代码进行相当复杂的解析。即使是像自动重命名这样的简单任务（假设您修改了 taglist 缓冲区中的函数名称条目并且源中的所有实例都已更新）需要非常复杂的解析，这超出了 ctags 功能或 taglist 本身。删除并保持与双射关系同步的所有内容更加复杂。假设您有一个 printf 行，您在其中使用了要删除的宏。那条线应该怎么办？如果整行消失，或者只是宏（在这种情况下，该行可能在语法上不正确。

taglist 是一个很好的浏览代码的插件，但它不适合自动重构（这是你想要实现的）。

编辑：至于计算复杂度，最坏的情况是你必须在每次击键时检查整个文档，寻找可以集成的新标签，所以从这个意义上说，你可以说它是 O(n)在每次击键时。这当然是矫枉过正，也是最糟糕的实现方法。我不知道 vim 中语法高亮的计算复杂性（这对于提取标签也很有用，通过适当的标记化），但我估计它非常低，并且解析的数据量非常有限（你不太可能有大型构造来解析以提取令牌并理解其上下文）。无论如何，这不是 taglist 的工作方式。Taglist 在每次 vim 调用时运行 ctags，它不会在您键入时实时解析文档。然而，这是由 Eclipse 完成的，例如 XCode 和 KDevelop，它们也提供了自动或半自动重构的工具，并且最终可以将 vim 集成为编辑器。如果您需要这些功能，那么您肯定使用了错误的工具。

# iphone - 如何制作没有文件扩展名的 iTunesArtwork 图像？

> ID：735049
> 
> 赞同：1
> 
> 时间：2009-04-09T16:53:04.137
> 
> 标签：iphone

苹果似乎说这个图像不应该有扩展名。但是没有扩展名的文件怎么可能呢？这有意义吗？还是我弄错了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T16:55:39.793

这确实有道理。文件允许没有扩展名。事实上，这些扩展基本上是一种遗留形式的元数据，它允许操作系统识别它们的类型，而无需在内部查找标头信息。继续重命名 .PNG 或 .JPG 文件，使其没有扩展名，您应该没有问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T17:25:02.110

没有扩展它可以正常工作。当 iTunes 将其从您的捆绑包中加载（对于临时分布式应用程序）时，它会查看文件内部以确定它是 png 还是 jpg。

请注意，当您将应用程序提交到 iTunesConnect 网站上的应用程序商店时，您不会将此图像放入您的应用程序包中，而是单独上传。它应该是 jpg 文件并且必须具有 .jpg 扩展名，否则 iTunesConnect 会拒绝它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T16:54:46.113

文件可能没有扩展名 - 只需从允许您指定“所有类型”的程序中保存它。就数据仍然存在而言，这是“有意义的”，但没有包含有关如何解释数据的指令集：如果 Apple 说过不提供扩展，那么不提供，应该没问题。

# html - 更改单个列表项项目符号的正确方法

> ID：735051
> 
> 赞同：3
> 
> 时间：2009-04-09T16:53:42.403
> 
> 标签：html, css, standards

我有这样的CSS：

```
.done {list-style-image:url('images/tick.gif')}
.notdone {list-style-image:url('images/cross.gif')} 
```

像这样的html：

```
<ul>
    <li class="done">Done</li>
    <li class="notdone">Not Done</li>
</ul> 
```

在 IE6 和 FF 上运行良好。每个 li 项目都有不同的子弹图像。但是我在 list-style-image 上看到的所有文档都说它应该应用于 ul 标签。

是否有适当的或基于标准的方式来做我想做的事情，或者是这样吗？

编辑：[http ://www.w3.org/TR/CSS21/generate.html](http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-image)

看起来它并没有说我不能在 li 标签上使用 list-style-image ，但是示例并没有显示出来。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T17:03:17.420

我相信您所指的文档是当您希望项目符号遵循某种格式时，这就是该类应​​用于父标签的原因

```
<ul> 
```

在那些情况下。由于您有两个图像，每个图像都有自己的项目符号，因此我认为您正在做的事情没有任何问题

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T17:35:27.997

CSS 2.1 标准[给出了`list-style`直接应用于`li`](http://www.w3.org/TR/CSS21/generate.html#propdef-list-style-image).

> 尽管作者可以直接在列表项元素上指定“列表样式”信息（例如，HTML 中的“li”），但他们应该谨慎行事。

其次是：

```
ol.alpha li   { list-style: lower-alpha } /* Any "li" descendant of an "ol" */ 
ol.alpha > li { list-style: lower-alpha } /* Any "li" child of an "ol" */ 
```

所以我会得出结论，只要你小心并理解你的 CSS 规则的级联，直接应用`list-style-type`或列出项目是可以的。`list-style-image`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T17:16:32.193

跟进您的编辑...

如果您查看 CSS 的[默认样式表](http://www.w3.org/TR/2007/CR-CSS21-20070719/sample.html)，您会看到 li 的定义如下：

```
li              { display: list-item } 
```

在您提供的链接中，list-style-image 在任何带有 display: list-item 的元素上都有效。因此，根据标准，您所做的事情是有效的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T19:13:40.453

当涉及到从浏览器到浏览器的列表图像的间距时，我遇到了不一致的情况。结果，我通常会跳过整个问题，而是做这样的事情：

```
li {list-style: none; padding-left: 15px;}    
li.done {background: url(images/tick.gif) no-repeat left top;}
li.notdone {background: url(images/cross.gif) no-repeat left top;} 
```

最终结果是使用与您最初想要的相同图像的项目符号，但您可以更好地控制实际位置和间距。可能需要调整，但这是一般的想法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T17:00:42.013

我不认为你在做什么有问题。你在说什么文档？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T17:07:37.580

理论上，列表中的所有条目都具有相同的项目符号样式。这些列表在历史上可以在诸如大纲之类的东西中找到，在任何级别您都有 1、2、3 或 A、B、C 并且将不同的序数类型相互混合是没有意义的。我不认为从风格上做你正在做的事情有什么问题。但我不知道它是否是正确的CSS。

# asp.net - 如何将 ASP.NET 网站转换为 ASP.NET Web 应用程序

> ID：735054
> 
> 赞同：93
> 
> 时间：2009-04-09T16:54:26.690
> 
> 标签：asp.net, visual-studio, web-applications

我有一个 ASP.NET 3.5 网站（visual studio lingo），但该网站继续增长，并且看起来相当牛仔。我希望看到它被转换成一个 Web 应用程序（命名空间和所有）。

这是可以在 Visual Studio 中轻松完成的事情吗？如果没有，是否还有其他工具可以自动创建所有命名空间等？

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2009-04-09T16:56:57.683

> ***好吧，事实证明“网站”不存在“转换为 Web 应用程序”选项。“转换为 Web 应用程序”选项仅适用于“Web 应用程序”！！！！***
> 
> *[强调我的]*
> 
> 因此，这是交易，要进行转换，您需要：
> 
> *   将新的“Web 应用程序”添加到您的 VS 2008 解决方案（文件->添加->新项目->C#->Web->ASP.NET Web 应用程序）。
>     
>     
> *   之后，您将旧“网站”中的所有文件复制到新创建的“Web 应用程序”，并默认覆盖其中创建的所有文件
>     
>     
> *   下一步是最丑陋的，您需要“手动”将“网站”中的引用添加到新的“网络应用程序”中。我认为 VS 2008 PowerCommands 玩具会为我做这件事，因为它确实复制了其他项目类型的引用，但事实并非如此。您必须自己手动完成，如果您有同一个程序集的多个版本（如我的情况下的 AJAXToolkit）或同时具有 GAC 和本地版本的程序集，则在此步骤中必须小心。
>     
>     
> *   继续重复最后一步并尝试构建“Web 应用程序”。您将不断收到类似“'....' is unknown namespace. You are missing an assembly reference?”之类的错误。确保除了将“....”替换为您使用的服务器控件的 ID 之外，您没有其他任何内容。换句话说，继续添加引用并构建项目，直到仅出现由于缺少 .DESIGNER.CS 或 .DESIGNER.VB 文件而存在的错误。
>     
>     
> *   然后，在 VS 2008 解决方案资源管理器中转到“Web 应用程序”根项目节点，然后右键单击它，然后您将找到“转换为 Web 应用程序”选项。此选项实际上是对页面和控件的“@Page”和“@Control”指令进行微小更改，并创建所需的 .DESIGNER.CS 或 .DESIGNER.VB 文件。
>     
>     
> *   再次尝试构建“Web 应用程序”。如果您遇到错误，请查看可能缺少哪些引用和/或再次单击“转换为 Web 应用程序”。有时，如果除了由于缺少 DESIGNER 文件而导致的错误之外，并非所有页面/控件都会为它们创建这些 DESIGNER 文件。修复非 DESIGNER 问题并再次单击“转换为 Web 应用程序”应该可以解决此问题。
>     
>     
> *   一旦你完成了成功的 VS 构建，你应该准备好了。开始测试您的 Web 应用程序。或者，您可以在 VS 2008 解决方案资源管理器中右键单击“Web 应用程序”根项目节点并单击“属性”，然后转到“Web”选项卡将“Web 应用程序”设置为 IIS 中的虚拟文件夹（您可以创建新的VS中的虚拟目录）。如果要使用旧“网站”使用的 IIS 虚拟目录，则需要先从 IIS 中删除它。
>     
>     
> *   更新：在测试您的页面时，请特别注意“App_Code”文件夹中的类，尤其是那些没有命名空间的类。这些可能是一个大陷阱。我们在同一个没有命名空间的静态类中遇到了两个扩展方法重载的问题，一个扩展了 DateTime？(Nullable) 并调用另一个扩展 DateTime 本身的重载。调用另一个重载作为扩展方法通过了 VS 2008 编译，并且只在运行时（使用 IIS）给我们一个编译错误。将另一个重载的调用从调用它作为扩展方法更改为调用它作为普通静态方法（仅更改同一类中的调用，来自其他类的调用仍然是扩展方法调用）确实解决了这个问题，但显然，它不是像以前在 VS 2005 中一样安全。
>     
>     
> *   Update2：在转换过程中，VS 2008 将您的“App_Code”重命名为“Old_App_Code”。这个新名字听起来很难看，但不要重命名它。在“Web 应用程序”模型中，所有代码都将在一个程序集中。在运行时，Web 服务器不知道您正在使用什么 Web 项目类型。它确实采用“App_Code”文件夹中的所有代码并为其创建一个新程序集。这样，如果您在名为“App_Code”的文件夹中有代码，最终会出现 RUNTIME 编译错误，即相同类型存在于两个程序集中，一个由 VS 创建，一个由 IIS / ASP.NET 开发服务器创建. 为了避免这种情况。使用相同的名称保留“Old_App_Code”，或将其重命名为除“App_Code”之外的任何内容。不要在这样的“App_Code”中放置任何代码
>     
>     
> 
> 我从以前就知道这一点，但现在忘记了，因为我很久没有使用“网站”模型了:(。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-09T16:56:50.257

### 演练：在 MSDN[的 Visual Studio 中将网站项目转换为 Web 应用程序项目](http://msdn.microsoft.com/en-us/library/aa983476.aspx)

如果您的网站应用程序增长.. 最好将其拆分为多个项目。从网站项目到 Web 应用程序项目的转换不会有太大帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-08-14T09:36:10.120

如果您在构建新的 Web 应用程序项目时遇到问题，请检查 Visual Studio 中所有“帮助程序”类的文件属性。对于我正在转换的项目，构建操作设置为内容，而它应该是编译。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-09-30T11:40:15.227

我现在已经成功地将一个网站项目迁移到了一个 Web 应用程序中，并且还有一些需要注意的问题。

使用 ReSharper 对重构 aspx 文件有很大帮助。

1.  设置您的解决方案并创建一个空的 WebApplication
2.  复制所有文件
3.  网站项目中的 aspx 文件没有命名空间。将您的类包装在适当的命名空间中
4.  `public partial class FolderName_Projectname : Page`在复制过程中，我在子文件夹中的所有页面都重命名为我的项目名称和文件夹名称，所以如果需要使用 Resharper 或手动重命名所有文件，我会得到 40ish 。如果您遇到多个错误，例如`"There is already a member Page_Load() defined"`，这很可能是由于不正确的类名和重复
5.  添加命名空间后
6.  将`CodeFile`所有 aspx 页面替换为`Codebehind`并特别注意子文件夹中的文件。确保`Inhertis=""`不包含相对路径。您的命名空间会处理一切。所以正确的格式是`Inherits="Namespace.classname"`. 如果你的类有一个命名空间 NaSpa 和一个文件名 foo.cs 它将是`Inherits="NaSpa.foo"`

7.  准备好所有文件后（不要忘记母版页），运行“转换为 Web 应用程序”。如果之后遇到错误，请冲洗并重复。如果您遇到“找不到 TextBoxName 是否缺少参考”之类的错误，请确保您没有忘记清理您的 aspx 页面。一个好的指标是检查自动生成的设计器文件。如果`TextBoxName`没有出现在那里，则转换没有完全成功。

8.  解决任何缺少的依赖项。
9.  建造

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-10-21T16:33:01.963

在 VS 2010 中创建一个新的 Web 应用程序。
1\. 使用 Windows 资源管理器将所有文件复制到您的项目文件夹中。
2\. 在 VS 2010 解决方案资源管理器中显示所有文件。
3\. 选择文件和文件夹 - 右键单击​​包含在项目中。
4\. 右键单击​​项目解决方案资源管理器并选择转换为 Web 应用程序。

有相当多的小差异，例如 App_Code 文件夹将重命名为 old_app_code - 这令人惊讶地不会导致任何错误。对象数据源上的 TypeName 和 @Page 标记上的继承可能需要 [ProjectName]。全局附加前缀。例如，如果您的类型名称是“BusinessLogic.OrderManager”并且您的项目名称是 InventorySystem，则需要将其更改为 InventorySystem.BusinessLogic.OrderManager。还有一些显示更改，例如必填字段验证器不再默认为红色字体，它们默认为黑色。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-06-23T16:31:24.297

我最初也面临同样的问题。在遵循 Wrox Professional ASP.NET 4.0 书之后，我为我的案例找到了以下解决方案。

我首先创建了一个新的 Web 应用程序。将所有网站文件复制到 Web 应用程序文件夹中。右键单击应用程序，然后单击转换为 Web 应用程序。

您可能会问为什么需要将 Web 应用程序转换为 Web 应用程序。答案是，当您创建一个网站时，您只需在需要的地方编写 .cs 文件即可。但是，Web 应用程序会自动为代码和设计部分声明 .design.cs（或 .vb）和 .cs 文件。

下一步：删除对您网站中其他文件的所有手动引用，例如 PAGE 指令中的“继承”属性，因为名称空间将负责集中引用这些类。

我也遇到了一个问题，因为我的项目中没有包含 OBJ 和 BIN 文件夹。如果您认为您丢失了 BIN 和 OBJ 文件夹，只需单击解决方案资源管理器中的“显示所有文件”图标，然后右键单击丢失的文件夹并添加到项目中。（以确保它们与项目一起编译。）

**更新：** 正如@deadlychambers 在评论中指出的那样：您可以通过执行“Ctrl + Shift + F”搜索任何地方，然后搜索`Inherits="(.*?)"`. 这将找到所有事件并可能为您节省一些时间！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-03T17:44:31.727

默认的 ASP 名称空间似乎不再起作用。所以我似乎无法从页面外部调用我的 User Controls.ascx 页面。给他们一个命名空间并将默认值从 ASP 更改为我的命名空间似乎可行。

# php - PHP登录系统问题...在页面之间发送错误

> ID：735069
> 
> 赞同：0
> 
> 时间：2009-04-09T16:58:40.503
> 
> 标签：php, login

我在网站的每个页面都有一个登录表单，因此用户可以从任何地方登录。我有一个 login.php 文件，我从表单中引用它（使用“操作”）。

我使用`$_SERVER['HTTP_REFERER']`将用户重定向到他成功登录或注销时登录的同一页面。

但是，如果登录时出现问题，我如何将错误发送到他尝试登录的同一页面？我尝试使用 发送错误`$_GET`，如下所示：

```
// process the script only if the form has been submitted
if (array_key_exists('login', $_POST)) {
    // Login code goes here...

    // If there was a problem, destroy the session and prepare error message
    else {
    $_SESSION = array();
    session_destroy();
    header('Location: '.$_SERVER['HTTP_REFERER'].'?error');
    exit;
} 
```

但问题是网站中的很多页面都是这样的`details.php?mid=0172495`。他们已经从该`$_GET`方法中获取信息，出于安全原因，我不能使用其他`$_GET`方法...

那么，我怎样才能通过错误？？？谢谢...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:11:38.943

既然您已经在使用会话，那么在您销毁会话之后，为什么不使用 $_SESSION['error'] 或类似的设置创建一个新会话呢？或者根本不删除会话，而是设置可以立即在其他页面中检查的错误？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T17:04:01.397

我不确定“出于安全原因，我不能使用其他`$_GET`方法”到底是什么意思，但是如果查询字符串中已经存在某些内容，则只需向其附加另一个变量，而不是替换它。

也就是说，如果地址是`details.php?mid=0172495`，您应该将它们发送到`details.php?mid=0172495&error`，而如果它只是`details.php`，则将它们发送到`details.php?error`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:08:05.223

为了补充乍得伯奇所说的......

在您重定向的登录脚本中，检查字符“？”的 HTTP_REFERER 值。如果存在，请将 '&error' 附加到 HTTP_REFERER 并重定向到它。否则将 '?error' 附加到 HTTP_REFERER 并重定向到那个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T19:24:32.557

做你需要的另一种方法是将你的 login.php 文件包含在每个具有登录表单的页面中，然后发布到同一页面。所以你根本不需要任何重定向。

这可能不是一个很好的可扩展和可维护的解决方案，但它很简单。这一切都取决于您正在编写什么样的应用程序。但是你说你是 php 新手，所以你可以这样开始。你以后总是可以花哨的...

# jquery - 如何使用 jQuery 从 iFrame 中获取父窗口的高度？

> ID：735072
> 
> 赞同：17
> 
> 时间：2009-04-09T16:58:55.667
> 
> 标签：jquery, dom, iframe

在 iFrame 中，我们需要获取父级的窗口/文档高度。

有没有办法使用jQuery来获得这个？

我知道我们可以`$(document).height()`用来获取页面的高度。我只是不知道如何从 iFrame 中获取父级的值。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-09T17:18:58.473

不需要 jQuery。

`parent.document.body.clientHeight`

这对我来说适用于 IE7 和 FF3。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-06-22T20:01:55.433

在 jQuery 中你可以做

```
$(parent.window).width(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-20T12:48:16.973

我在一个网站上尝试了 clientHeight 方法，其中两个 iframe 都在同一个域上，但它不起作用。（返回 0）。

经过大量测试后，我发现最好的方法（我很乐意学习更好的方法）是在父级上创建一个返回文档高度的函数，例如：

**家长：**

```
function getDocumentHeight(){
   return $(document).height();
} 
```

**框架：**

```
var parentDocHeight = parent.getDocumentHeight(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-01-12T09:15:21.330

另一种可能性是：

```
$(window.parent.document).height() 
```

# ruby - 要求ruby目录中所有文件的最佳方法？

> ID：735073
> 
> 赞同：373
> 
> 时间：2009-04-09T17:00:15.430
> 
> 标签：ruby, file, directory, require

从 ruby​​ 目录中要求所有文件的最佳方法是什么？

* * *

## 回答 #1

> 赞同：489
> 
> 时间：2009-04-09T17:19:59.157

怎么样：

```
Dir["/path/to/directory/*.rb"].each {|file| require file } 
```

* * *

## 回答 #2

> 赞同：361
> 
> 时间：2009-04-09T18:50:45.150

如果它是相对于执行要求的文件的目录（例如，您想加载 lib 目录中的所有文件）：

```
Dir[File.dirname(__FILE__) + '/lib/*.rb'].each {|file| require file } 
```

**编辑：**根据以下评论，更新版本：

```
Dir[File.join(__dir__, 'lib', '*.rb')].each { |file| require file } 
```

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2009-06-14T04:08:58.200

试试 require_all gem：

1.  [http://github.com/jarmo/require_all](http://github.com/jarmo/require_all)
2.  [https://rubygems.org/gems/require_all](https://rubygems.org/gems/require_all)

它让您简单地：

```
require_all 'path/to/directory' 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2010-02-09T18:38:29.880

```
Dir[File.dirname(__FILE__) + '/../lib/*.rb'].each do |file| 
  require File.basename(file, File.extname(file))
end 
```

如果您不剥离扩展名，那么您最终可能需要两次相同的文件（ruby 不会意识到“foo”和“foo.rb”是同一个文件）。两次要求同一个文件可能会导致虚假警告（例如“警告：已初始化常量”）。

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2014-02-11T04:56:29.833

```
Dir.glob(File.join('path', '**', '*.rb'), &method(:require)) 
```

或者，如果您想将文件范围限定为加载到特定文件夹：

```
Dir.glob(File.join('path', '{folder1,folder2}', '**', '*.rb'), &method(:require)) 
```

**解释：**

[Dir.glob](http://ruby-doc.org/core-2.2.0/Dir.html#method-c-glob)将块作为参数。

method(:require)[将返回 require 方法。](http://ruby-doc.org/core-1.9.3/Object.html#method-i-method)

&method(:require) 会将方法转换为块。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2009-04-09T23:28:14.937

最好的方法是将目录添加到加载路径，然后添加`require`每个文件的基本名称。这是因为您希望避免意外两次需要相同的文件——通常不是预期的行为。一个文件是否会被加载取决于`require`之前是否看过传递给它的路径。例如，这个简单的 irb 会话表明您可能会错误地要求和加载同一个文件两次。

```
$ irb
irb(main):001:0> require 'test'
=> true
irb(main):002:0> require './test'
=> true
irb(main):003:0> require './test.rb'
=> false
irb(main):004:0> require 'test'
=> false 
```

请注意，前两行返回`true`意味着两次都加载了同一个文件。使用路径时，即使路径指向相同的位置，`require`也不知道该文件已被需要。

相反，我们在加载路径中添加一个目录，然后需要其中每个 *.rb 文件的基本名称。

```
dir = "/path/to/directory"
$LOAD_PATH.unshift(dir)
Dir[File.join(dir, "*.rb")].each {|file| require File.basename(file) } 
```

如果您不关心文件被多次需要，或者您的意图只是加载文件的内容，也许`load`应该使用`require`. 在这种情况下使用 load ，因为它更好地表达了你想要完成的事情。例如：

```
Dir["/path/to/directory/*.rb"].each {|file| load file } 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2011-06-19T05:53:06.847

```
Dir[File.join(__dir__, "/app/**/*.rb")].each do |file|
  require file
end 
```

这将在您的本地机器和不使用相对路径的远程（如 Heroku）上递归工作。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2014-02-18T10:42:54.103

我没有像某些答案那样连接路径，而是使用`File.expand_path`：

```
Dir[File.expand_path('importers/*.rb', File.dirname(__FILE__))].each do |file|
  require file
end 
```

**更新：**

`File.dirname`您可以执行以下操作，而不是使用：

```
Dir[File.expand_path('../importers/*.rb', __FILE__)].each do |file|
  require file
end 
```

在哪里`..`剥离`__FILE__`.

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-09-25T21:06:35.183

在 Rails 中，您可以：

```
Dir[Rails.root.join('lib', 'ext', '*.rb')].each { |file| require file } 
```

更新：更正了@Jiggneshh Gohel 的建议以删除斜线。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-06-11T01:57:13.697

我迟到了几年，但我有点喜欢这种单线解决方案，我曾经让 rails 将所有内容都包含在 app/workers/concerns 中：

`Dir[ Rails.root.join *%w(app workers concerns *) ].each{ |f| require f }`

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2017-01-11T08:23:37.030

那么：`require_relative *Dir['relative path']`？

# flash - Flash 电影在 IE 中不起作用

> ID：735076
> 
> 赞同：0
> 
> 时间：2009-04-09T17:01:15.740
> 
> 标签：flash, slideshow

[http://rants-group.com/](http://rants-group.com/)上的页面在 Firefox 中运行良好，而不是 IE。任何人都可以查看源代码并发现任何问题吗？

我根本无法做到这一点！

我想我在这一点上已经搞砸了，不知道该怎么办！

显示电影的代码是这样的：

```
 <div id="mainhome">
<table width="700" height="309" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="350" valign="top" background=""><img src="/images/bckgrnd3.jpg" width="350" height="309" /></td>
    <td width="350" align="right" valign="top"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="350" height="309" id="myFlashContent">
        <param name="movie" value="flash/flashslide.swf?src=flash-here.com&imglist_fn=flash/getimglist.txt&img_path=flash/slides&interval=5000&w=350&h=309" />
        <!--[if !IE]>-->
        <object type="application/x-shockwave-flash" data="flash/flashslide.swf?src=flash-here.com&imglist_fn=flash/getimglist.txt&img_path=flash/slides&interval=5000&w=350&h=309" width="350" height="309">
          <!--<![endif]-->
          <a href="http://www.adobe.com/go/getflashplayer"> <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" /> </a>
          <!--[if !IE]>-->
        </object>
        <!--<![endif]-->
      </object>
    </td>
  </tr>
</table> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:18:59.393

嵌入 Flash 电影的最简单方法是使用库，例如[`swfobject`](http://code.google.com/p/swfobject/) ​​有两种使用方法。

*   使用javascript动态加载
*   静态加载仅使用 html

他们还有一个非常易于使用的配置器，可以生成适用于每个浏览器的 html 代码，以便将电影嵌入到您的页面中。

在你的情况下，它会是这样的：

```
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="350" height="309" id="myFlashContent">
                <param name="movie" value="flash/flashslide.swf?src=flash-here.com&imglist_fn=flash/getimglist.txt&img_path=flash/slides&interval=5000&w=350&h=309" />
                <!--[if !IE]>-->
                <object type="application/x-shockwave-flash" data="flash/flashslide.swf?src=flash-here.com&imglist_fn=flash/getimglist.txt&img_path=flash/slides&interval=5000&w=350&h=309" width="350" height="309">
                <!--<![endif]-->
                    <a href="http://www.adobe.com/go/getflashplayer">
                        <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
                    </a>
                <!--[if !IE]>-->
                </object>
                <!--<![endif]-->
            </object> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T11:55:47.600

如果您使用的是 Flash 8 及更高版本，请尝试在发布设置中启用 HTML 作为发布输出。

查看生成的 .html 文件。请记住也要链接到外部 javascript 文件中。

另一种方法是使用[swfobject](http://blog.deconcept.com/swfobject/)。我更喜欢 Adob​​e 的方法。

不需要和这样的标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:59:27.937

使用[Satay 方法](http://www.alistapart.com/articles/flashsatay)实现跨浏览器互操作性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T18:19:43.680

那些 IE 条件注释被破坏了。

```
<!--[if !IE]>
  The content in here should ACTUALLY be part of the HTML comment.
  Thus the "double-dash" doesn't re-occur until the very last part
  of the closing tag.
<![endif]--> 
```

尽管应该注意，由于没有其他浏览器支持 IE 的条件注释，“！IE”语法并没有真正为您带来任何好处。

最好将要发送到 IE 的 HTML 内容包装在条件注释中。例如

```
<!--[if IE]>
  This <b>HTML</b> will only appear in Internet Explorer.
  of the closing tag.
<![endif]--> 
```

# c# - 在 C# 中通过肥皂连接到多个 Web 服务

> ID：735077
> 
> 赞同：1
> 
> 时间：2009-04-09T17:01:23.430
> 
> 标签：c#, web-services, soap, wsdl

我正在构建一个服务，该服务聚合来自多个肥皂网络服务的大量数据。Web 服务调用和soap 包应该是什么样子有一个标准。但当然，每个人的版本都只是在命名空间使用方面略有不同。在c#中有什么原因动态获取wsdl并在运行时基于它创建soap包？我不想为每个上线的新服务静态运行 wsdl 实用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T17:09:22.227

可以按照您所说的进行操作，但这会非常昂贵（系统资源）并且速度很慢。考虑创建一个基于提供者的模型，在该模型中您已经引用了所有服务，然后将请求路由到正确的服务。

提供者模型将允许您使用反射加载新的提供者，就像您要求的那样。

这是一个例子。

[http://dotnetslackers.com/articles/designpatterns/HowToWriteAProviderModel.aspx](http://dotnetslackers.com/articles/designpatterns/HowToWriteAProviderModel.aspx)

它可以适应服务。

# c# - WCF 服务中未定义的枚举值

> ID：735078
> 
> 赞同：4
> 
> 时间：2009-04-09T17:01:35.630
> 
> 标签：c#, wcf

我们有一个公开“客户”类型的 WCF 服务，即：

```
[DataContract(Name = "CustomerData", Namespace = "http://www.testing.com")]
公共部分类客户
{   
    [数据成员]
    公共客户级别
    {
        得到;
        放;
    }   
}

```

你可以看到上面的类型有一个枚举类型的属性。这个枚举的定义是：

```
[忽略覆盖]
[DataContract(Namespace = "http://www.testing.com"")]
公共枚举客户级别：int
{

    [EnumMember(Value = "白金")]
    铂金 = 1，

    [EnumMember(Value = "Gold")]
    金 = 2,

    [枚举成员（值 = “银”）]
    银 = 3,

    [枚举成员（值 = “青铜”）]
    青铜 = 4,
}

```

只要服务器为它返回的每个客户发送一个有效的枚举，该服务就可以正常工作。但是，如果服务返回未在枚举中定义的 CustomerLevel，则服务调用超时。

错误的 CustomerLevel 值的示例可能是：

```
customer.Level = (CustomerLevel)0;
```

如果客户端尝试发送未定义的值，服务也会超时。

有什么方法可以让未定义的值同时流向客户端和服务器，并让它们各自处理坏值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T18:40:04.753

我不认为你会让虚假枚举工作。他们会反序列化成什么？如果您的意思是让客户端发送整数，则将类型更改为 int，并自行将其转换为枚举（使用您自己的错误处理）。

至于客户端是否应该超时，请告诉我们您使用的是哪种客户端。另外，我建议您查看网络流量并查看服务如何响应（如果有的话）。还要查看 Windows 事件日志以查看服务是否完全抱怨。最后，您可能希望打开 WCF 跟踪以查看服务对此有何反应。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-12-18T14:33:20.787

至少对我来说，这个问题的答案是设置 IsRequired = false。像这样：

```
[DataMember(IsRequired = false)]
Nullable<MyEnum> Prop {get;set;} 
```

这会将 nillble="true" 正确添加到 wsdl...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-13T20:40:36.467

您可以使用自定义 IDataContractSurrogate 将枚举映射到 int 然后再映射回枚举来执行此操作。

创建此类代理的文档在这里：http: [//msdn.microsoft.com/en-us/library/ms733064.aspx](http://msdn.microsoft.com/en-us/library/ms733064.aspx)

这是我开发的可以处理枚举类型列表的通用版本。您在 DataContractSerializer 的构造函数中指定它。有关更多信息，请参阅我的博客文章：http: [//www.shulerent.com/2012/08/13/handling-invalid-enum-values-in-a-datacontractserializer/](http://www.shulerent.com/2012/08/13/handling-invalid-enum-values-in-a-datacontractserializer/)

```
/// <summary>
/// IDataContractSurrogate to map Enum to int for handling invalid values
/// </summary>
public class InvalidEnumContractSurrogate : IDataContractSurrogate
{
    private HashSet<Type> typelist;

    /// <summary>
    /// Create new Data Contract Surrogate to handle the specified Enum type
    /// </summary>
    /// <param name="type">Enum Type</param>
    public InvalidEnumContractSurrogate(Type type)
    {
        typelist = new HashSet<Type>();
        if (!type.IsEnum) throw new ArgumentException(type.Name + " is not an enum","type");
        typelist.Add(type);
    }

    /// <summary>
    /// Create new Data Contract Surrogate to handle the specified Enum types
    /// </summary>
    /// <param name="types">IEnumerable of Enum Types</param>
    public InvalidEnumContractSurrogate(IEnumerable<Type> types)
    {
        typelist = new HashSet<Type>();
        foreach (var type in types)
        {
            if (!type.IsEnum) throw new ArgumentException(type.Name + " is not an enum", "type");
            typelist.Add(type);
        }
    }

    #region Interface Implementation

    public Type GetDataContractType(Type type)
    {
        //If the provided type is in the list, tell the serializer it is an int
        if (typelist.Contains(type)) return typeof(int);
        return type;
    }

    public object GetObjectToSerialize(object obj, Type targetType)
    {
        //If the type of the object being serialized is in the list, case it to an int
        if (typelist.Contains(obj.GetType())) return (int)obj;
        return obj;
    }

    public object GetDeserializedObject(object obj, Type targetType)
    {
        //If the target type is in the list, convert the value (we are assuming it to be int) to the enum
        if (typelist.Contains(targetType)) return Enum.ToObject(targetType, obj);
        return obj;
    }

    public void GetKnownCustomDataTypes(System.Collections.ObjectModel.Collection<Type> customDataTypes)
    {
        //not used
        return;
    }

    public object GetCustomDataToExport(Type clrType, Type dataContractType)
    {
        //Not used
        return null;
    }

    public object GetCustomDataToExport(System.Reflection.MemberInfo memberInfo, Type dataContractType)
    {
        //not used
        return null;
    }

    public Type GetReferencedTypeOnImport(string typeName, string typeNamespace, object customData)
    {
        //not used
        return null;
    }

    public System.CodeDom.CodeTypeDeclaration ProcessImportedType(System.CodeDom.CodeTypeDeclaration typeDeclaration, System.CodeDom.CodeCompileUnit compileUnit)
    {
        //not used
        return typeDeclaration;
    }

    #endregion
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:30:21.330

我认为没有任何方法可以使用 DataContract 公开未定义的枚举。

对于传播异常，您可以尝试启用“IncludeExceptionDetailsInFaults” - 有关详细信息，请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/ms733721.aspx)。

我通常做的是实现一个 IErrorHandler 服务器端，它记录异常并将异常提升为故障 - 在[IDesign 的网站](http://www.idesign.net/idesign/DesktopDefault.aspx)上有一些好东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T17:05:04.827

~~尝试`EnumMember`从枚举值中删除属性。~~

此外，您不需要将枚举标记为 a `DataContract`，因为它`DataContractSerializer`会自动序列化您在现有`DataContracts`.

* * *

我在上面发布的内容不起作用。我认为不可能使用`DataContractSerializer`来序列化无效的枚举值。

# qa - 你如何对网站进行质量检查？

> ID：735083
> 
> 赞同：0
> 
> 时间：2009-04-09T17:04:43.780
> 
> 标签：qa

我想知道是否有可用于 QA 网站的工具/实践的详细列表。似乎得到最多提及的工具是链接检查器、验证器和 Selenium IDE。以我的身份，只有链接检查器和验证器似乎运行良好。我不是 QA 专家，所以我不知道他们在做什么，并希望更多地了解这个主题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-14T14:39:41.747

有许多资源可以帮助您开始测试。我建议做一些离线和在线阅读。一本很棒的测试书是 James Whittaker 的 How to Break Software。他还有一本我目前正在阅读的后续书籍 How to Break Software Security。

比您使用的工具和目标应用程序（web、java、c#、...）的技术更重要的是您的测试方法。您的系统有什么要求？它应该做什么？它不应该做什么？从这些广泛的问题开始，并使用它们深入了解更多细节，例如 FizzBu​​zz 模块是否允许重复条目？

您不能直接跳入测试工具，因为它们只是工具，如果没有正确的测试方法，它们弊大于利。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T17:27:31.307

如果您真的有兴趣了解有关网站 QA 流程的更多信息，您可能需要联系并找到一个真正的 QA 人员坐下来。正确的 QA 不仅仅是知道正在使用哪些工具，其中很多都归结为什么、如何、为什么以及何时进行测试。人们可以采用多种方法，这些方法都与使用什么工具以及如何使用它们有关。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-11T21:33:28.970

作为一名专业的测试人员，我的建议是你应该健康地混合自动化和手动测试。

**自动化测试**

*   **单元测试**
    使用 NUnit 来测试你的类、函数和它们之间的交互。
    [http://www.nunit.org/index.php](http://www.nunit.org/index.php)

*   **自动化功能测试**
    如果可能，您应该自动化很多功能测试。一些框架作品内置了功能测试。否则，您必须为此使用工具。如果您正在开发网站/应用程序，您可能需要查看 Selenium。
    [http://www.peterkrantz.com/2005/selenium-for-aspnet/](http://www.peterkrantz.com/2005/selenium-for-aspnet/)

*   **持续集成**
    使用 CI 确保您的所有自动化测试在您团队中的某个人每次提交项目时运行。
    [http://martinfowler.com/articles/continuousIntegration.html](http://martinfowler.com/articles/continuousIntegration.html)

**手动测试**
尽管我喜欢自动化测试，但恕我直言，它不能替代手动测试。主要原因是自动化只能做它被告知的事情，并且只能验证它被告知的内容以视为通过/失败。一个人可以利用它的智能来发现错误并提出在测试其他东西时出现的问题。

*   **探索性测试**
    ET 是一种成本非常低且有效的方法来发现项目中的缺陷。它利用了人类的智慧，并且比我所知道的任何其他测试技术都教给测试人员/开发人员更多关于该项目的知识。针对测试环境中部署的每个功能进行 ET 会话不仅是快速发现问题的有效方法，也是学习和娱乐的好方法！
    [http://www.satisfice.com/articles/et-article.pdf](http://www.satisfice.com/articles/et-article.pdf)

# architecture - 反向电话、反向 Zip 和反向 IP 查找服务的命名空间

> ID：735088
> 
> 赞同：-1
> 
> 时间：2009-04-09T17:05:51.047
> 
> 标签：architecture, naming-conventions, namespaces, naming

我正在寻找关于命名空间的想法/建议。

我有 3 个执行以下操作的对象：

1.  对象 1：反向电话查找
2.  对象 2：反向邮政编码查找
3.  对象 3：反向 IP 地址查找

目前，它们位于以下命名空间中：

1.  （公司名称）.Utilities.PhoneTools
2.  （公司名称）.Utilities.AddressTools
3.  （公司名称）.Utilities.IPTools

所有对象都做类似的事情，即反向查找（即：如果您提供电话号码，它将返回与该电话关联的地址）。他们都有自己的命名空间感觉不对，而且我不喜欢使用“实用程序”命名空间。

有人对适当的命名空间有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T17:12:07.897

身份服务或身份识别

```
IdentityServices.Telephones
IdentityServices.Adresses
IdentityServices.Internet

Identification.Telephones
Identification.Adresses
Identification.Internet 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T20:22:13.737

我最终为我的所有对象使用了以下命名空间：

*   公司名称.Utilities.Sniffer

并称我的主要对象：

*   地址嗅探器
*   IpSniffer
*   电话嗅探器

我还创建了更多顶级名称空间来保存上述类的某些副产品：

*   (CompanyName).Formatting
*   (公司名称).Validation
*   (公司名称).Common

# php - PHP file_get_contents($url) 性能缓慢

> ID：735091
> 
> 赞同：6
> 
> 时间：2009-04-09T17:07:00.420
> 
> 标签：php

我的网页使用谷歌图表生成五张图表。如果图形尚未缓存，我有以下代码行来检索图像。

$image = file_get_contents(" [http://chart.apis.google.com/chart](http://chart.apis.google.com/chart) ?".$query);

当该代码循环执行时，获取每个图像需要 10 秒。但是，如果我将代码更改为使用 Google 的 IP 地址之一而不是 URL：

$image = file_get_contents(" [http://74.125.93.100/chart](http://74.125.93.100/chart) ?".$query);

检索图像只需不到一秒钟的时间。所以我最初的想法是 DNS 没有解析 URL，延迟是来自循环分配的 DNS 服务器？因此，我尝试从服务器 ping chart.apis.google.com，它立即返回了合理的响应。

所以我的问题是：是否有任何我可能忽略的 PHP（或 Apache2）配置设置可能导致此延迟，或者这听起来像是服务器配置问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T19:37:45.910

您的 DNS 解析速度很慢（您的服务器使用的 DNS 可能有问题，然后大多数其他域可能很慢）或者您的服务器在使用 DNS 缓存时出现问题。

无论如何，如果您没有特定的理由来处理从谷歌图表接收到的图像，为什么不直接将其打印为 img 标签？如果需要，您可以使用 css 覆盖文本或透明 png-s。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-19T17:08:01.190

在这里遇到了同样的问题。这可能是一个 DNS 问题......也许是使用太慢的 DNS 服务器的 apache 服务器。

我尝试了不同的方法：CURL、WGET（shell exec）......但仍然遇到相同的性能问题。

在我的生产服务器上大约需要 15 秒。但是在我的本地服务器（使用 IP）上，我的脚本只需不到 1.5 秒。

试试 /etc/resolv.conf 或 /etc/named.conf？也许。我正在努力寻找解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-27T07:59:39.513

这是与您的托管服务提供商输入的 IP 有关的问题`/etc/resolv.conf`。你不能修复它。这是您的托管服务提供商的问题。

但是你可以使用 google public dns: `8.8.8.8`。打开`/etc/resolv.conf`，然后删除所有数据并写入：

```
nameserver 8.8.8.8 
```

然后保存它。重启dns和apache。然后再试一次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T17:14:32.180

为什么在开始加载图像之前不解析 ip？

```
$ip = gethostbyname($name);
$image = file_get_contents($ip."/chart?".$query); 
```

# asp.net - 如何成功加入两个内存中的 linq 集合？

> ID：735098
> 
> 赞同：2
> 
> 时间：2009-04-09T17:08:17.267
> 
> 标签：asp.net, linq

我正在尝试加入一个来自数据库的 Linq 集合和一个来自 XML 文件的集合。这可能吗？我总是得到：**本地序列不能用于查询运算符的 LINQ to SQL 实现，但 Contains() 运算符除外。**

这是我的代码：

```
MyDataContext dc = new MyDataContext();
XElement CustomData;

var pages = from p in dc.Pages
            select new
            {
                Title = p.Title,
                Slug = p.Slug,
                PageId = p.PageId.ToString()
            };

var orders = from p in CustomData.Element("pages").Elements("page")
             select new
             {
                 PageId = (string)p.Attribute("id"),
                 SortOrder = (int)p.Attribute("sortOrder")
             };

var source = from p in pages
             join o in orders
             on p.PageId equals o.PageId
             select p;

source.ToList(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T17:12:24.963

我认为你根本不需要加入。

```
MyDataContext dc = new MyDataContext();
XElement CustomData;

var orders = CustomData.Element("pages").Elements("page")
                       .Select( o =>  new
                         {
                             PageId = p.Attribute("id").ToString(),
                             SortOrder = (int)p.Attribute("sortOrder")
                         });

var source = dc.Pages
               .Where( p => orders.Select( o => o.PageId)
                                  .Contains( p.PageId.ToString() ))
               .Select( p => new
                {
                  Title = p.Title,
                  Slug = p.Slug,
                  PageId = p.PageId.ToString()
                }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T17:12:49.783

看起来您无法通过延迟执行来连接本地集合（订单）和 LINQ2SQL 结果。您可以执行页面查询 ToList （就像 tvanfosson 最初建议的那样：））或者可能做这样的事情......

```
var source = from p in pages
             where orders.Select(o=> o.PageID).Contains(p.PageID)
             select p; 
```

这不是您正在寻找的连接，但如果您想要延迟执行 LINQ2SQL，您可以通过这种方式获得它。

# operating-system - 操作系统中断

> ID：735104
> 
> 赞同：1
> 
> 时间：2009-04-09T17:11:13.890
> 
> 标签：operating-system, interrupt-handling

假设硬件间隔定时器在发出中断信号之前只倒计时到零。操作系统如何使用间隔计时器来跟踪一天中的时间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:14:42.727

硬件间隔计时器计数为零，触发和中断，并重置为特定值（由操作系统设置）。

由于定时器频率是已知的，并且起始值是可设置的，并且它会自动重置，因此操作系统可以将其设置为每秒触发 18 次中断，例如，然后使用计数器来保持时间。

现代机器通常使用由主板上的小电池支持的实时时钟 (RTC) 芯片 - 这消除了计算机未通电时引起的错误，并且实际上非常准确。这些 RTC 通常具有可以在 BIOS 中设置的警报，以便也出于各种目的打开计算机。

# joomla - Joomla 上与 SEF 的手动链接！

> ID：735116
> 
> 赞同：7
> 
> 时间：2009-04-09T17:13:58.923
> 
> 标签：joomla, joomla-sef-urls

假设您想在 Joomla! 中创建指向文章的手动链接！（即“外部链接”类型的菜单项或文章中的链接）。URL 必须以“index.php?...”开头，而不是绝对 URL，否则会破坏与搜索引擎友好 URL 的兼容性。关闭 SEF 后，您只需转到站点的前端并从要链接到的菜单项中复制 url。启用 SEF 后，您只能看到 URL 的路由版本，如果 SEF 关闭，这当然会中断。

Joomla 集成编辑器（我使用的是 JoomlaFCK）通常会提供一个“Joomla！链接”按钮，让您找到并链接到特定文章。但是，它们不会突出显示菜单项或使用该菜单项的参数。如果您希望链接使用特定的菜单项（您可能会这样做），您必须手动查找菜单项的 ID 并在 URL 的末尾添加“&Itemid=XX”。在这里增加侮辱，“Itemid”的首字母大写奇怪，是区分大小写的。甚至源菜单项详细信息页面中的 URL**也不包含菜单项 ID**，仅包含文章 ID。

我有客户真的不明白这一点，他们为什么要这样做？我如何告诉不懂技术的客户找到正确的 URL 以链接到菜单项？是否有任何扩展可以帮助解决这个问题？

**编辑**：我只是想分享我在写这篇文章时不知道 Alias 菜单项类型。如果您希望新菜单项突出显示某个其他菜单项，则应该使用它而不是“外部链接”。它对于制作自定义面包屑或侧边栏菜单层次结构很有用。不过，文章中的链接仍然存在问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:38:49.707

我给了我的客户一些关于如何制作链接的手册，包括菜单的截图。然后它变得非常容易！我不知道任何扩展，然后我又不知道所有 joomla 扩展；）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T15:07:39.993

首先，我要感谢你帮助我解决了一个问题——在阅读了你的帖子后，我才意识到 SEF 在我的网站上运行得并不完美。我错过了 Itemid 参数！（没有它，Joomla 会创建类似`/component/<comp-name>/42`或的链接`/<current-menu-alias>/42`）。

要回答您的问题，如果一篇文章已经有一个 SEF URL，我建议告诉他们简单地复制粘贴该 URL。这对客户来说是最简单的（我发现自己做起来更容易）。当然，如果 SEF 关闭，它会断开链接，但为什么这是个问题？只是不要关闭它！;)

如果客户发现获取这些 ID 号很容易，那么创建一个自定义插件来替换`{article:42:5}`类似`index.php?option=com_content&article=42&Itemid=5`. 您可以只使用 XML 清单文件和原始 PHP 代码创建一个插件，这就是我经常做的...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-05T17:53:35.837

我找到了一个对此有用的扩展：[Linkr](http://extensions.joomla.org/extensions/structure-a-navigation/content-links/4010)。我不再难以解释如何在文章中创建菜单项链接。结合 Alias 菜单项类型，这涵盖了我所有的问题。

# c - 是否有 GNU getline 接口的替代实现？

> ID：735126
> 
> 赞同：13
> 
> 时间：2009-04-09T17:18:29.457
> 
> 标签：c, licensing, getline

我目前正在进行的实验使用具有复杂源历史且没有明确定义的许可证的软件库。将事物合理化并在固定许可下发布将是大量工作。

它还旨在运行一个随机的 unixish 平台，并且只有我们支持的一些 libc 具有 GNU getline，但现在代码需要它。

有谁知道在限制较少的许可下可以重新实现[GNU语义？`getline`](http://www.gnu.org/software/hello/manual/libc/Line-Input.html)

**编辑::**我问是因为谷歌没有帮助，如果可能的话，我想避免写一个（这可能是一个有趣的练习，但它不能最好地利用我的时间。）

更具体地说，有问题的接口是：

```
ssize_t getline (char **lineptr, size_t *n, FILE *stream); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-09T18:55:17.103

我很困惑。

我查看了链接，阅读了描述，这是一个很好的实用程序。

但是，您是说您根本无法将此函数重写为规范吗？规范似乎很清楚，

这里：

```
/* This code is public domain -- Will Hartung 4/9/09 */
#include <stdio.h>
#include <stdlib.h>

size_t getline(char **lineptr, size_t *n, FILE *stream) {
    char *bufptr = NULL;
    char *p = bufptr;
    size_t size;
    int c;

    if (lineptr == NULL) {
        return -1;
    }
    if (stream == NULL) {
        return -1;
    }
    if (n == NULL) {
        return -1;
    }
    bufptr = *lineptr;
    size = *n;

    c = fgetc(stream);
    if (c == EOF) {
        return -1;
    }
    if (bufptr == NULL) {
        bufptr = malloc(128);
        if (bufptr == NULL) {
            return -1;
        }
        size = 128;
    }
    p = bufptr;
    while(c != EOF) {
        if ((p - bufptr) > (size - 1)) {
            size = size + 128;
            bufptr = realloc(bufptr, size);
            if (bufptr == NULL) {
                return -1;
            }
        }
        *p++ = c;
        if (c == '\n') {
            break;
        }
        c = fgetc(stream);
    }

    *p++ = '\0';
    *lineptr = bufptr;
    *n = size;

    return p - bufptr - 1;
}

int main(int argc, char** args) {
    char *buf = NULL; /*malloc(10);*/
    int bufSize = 0; /*10;*/

    printf("%d\n", bufSize);
    int charsRead =  getline(&buf, &bufSize, stdin);

    printf("'%s'", buf);
    printf("%d\n", bufSize);
    return 0;
} 
```

15 分钟，我已经 10 年没有写过 C 语言了。它轻微破坏了 getline 合同，因为它只检查 lineptr 是否为 NULL，而不是 NULL 和 n == 0。如果你愿意，你可以修复它。（另一种情况对我来说没有多大意义，我想在那种情况下你可以返回 -1。）

将 '\n' 替换为变量以实现“getdelim”。

人们还写代码吗？

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2017-11-10T18:48:43.937

Will Hartung 的代码存在一个非常严重的问题。`realloc`很可能会释放旧块并分配一个新块，但`p`代码中的指针将继续指向原始块。这个尝试通过使用数组索引来解决这个问题。它还尝试更紧密地复制标准 POSIX 逻辑。

```
/* The original code is public domain -- Will Hartung 4/9/09 */
/* Modifications, public domain as well, by Antti Haapala, 11/10/17
   - Switched to getc on 5/23/19 */

#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <stdint.h>

// if typedef doesn't exist (msvc, blah)
typedef intptr_t ssize_t;

ssize_t getline(char **lineptr, size_t *n, FILE *stream) {
    size_t pos;
    int c;

    if (lineptr == NULL || stream == NULL || n == NULL) {
        errno = EINVAL;
        return -1;
    }

    c = getc(stream);
    if (c == EOF) {
        return -1;
    }

    if (*lineptr == NULL) {
        *lineptr = malloc(128);
        if (*lineptr == NULL) {
            return -1;
        }
        *n = 128;
    }

    pos = 0;
    while(c != EOF) {
        if (pos + 1 >= *n) {
            size_t new_size = *n + (*n >> 2);
            if (new_size < 128) {
                new_size = 128;
            }
            char *new_ptr = realloc(*lineptr, new_size);
            if (new_ptr == NULL) {
                return -1;
            }
            *n = new_size;
            *lineptr = new_ptr;
        }

        ((unsigned char *)(*lineptr))[pos ++] = c;
        if (c == '\n') {
            break;
        }
        c = getc(stream);
    }

    (*lineptr)[pos] = '\0';
    return pos;
} 
```

* * *

通过锁定流一次并使用等效的 - 可以提高平台的性能[`getc_unlocked(3)`](https://pubs.opengroup.org/onlinepubs/009695399/functions/getc_unlocked.html)- 但这些在 C 中没有标准化；如果您使用的是 POSIX 版本，那么您可能[`getline(3)`](https://pubs.opengroup.org/onlinepubs/9699919799/functions/getdelim.html)已经使用了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-11-02T03:31:04.580

使用来自 NetBSD 的这些可移植版本：**[getdelim()](http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/pkgtools/libnbcompat/files/getdelim.c?only_with_tag=MAIN)**和**[getline()](http://cvsweb.netbsd.org/bsdweb.cgi/pkgsrc/pkgtools/libnbcompat/files/getline.c?only_with_tag=MAIN)**

这些来自 pkgsrc 中的 libnbcompat，并且在每个文件的顶部都有一个 BSD 许可证。您需要两者，因为 getline() 调用 getdelim()。获取两个文件的最新版本。请参阅每个文件顶部的 BSD 许可证。修改文件以适合您的程序：您可能需要在其中一个头文件中声明 getline() 和 getdelim()，并修改这两个文件以包含您的头文件而不是 nbcompat 头文件。

这个版本的 getdelim() 是可移植的，因为它调用 fgetc()。相比之下，来自 libc（如 BSD libc 或 musl libc）的 getdelim() 可能会使用该 libc 的私有功能，因此它不能跨平台工作。

自[POSIX 2008 指定 getline()](http://pubs.opengroup.org/onlinepubs/9699919799/functions/getline.html)以来的几年中，更多的 Unixish 平台添加了 getline() 函数。getline() 很少丢失，但它仍然可以在旧平台上发生。一些人尝试在旧平台（如 PowerPC Mac OS X）上引导 NetBSD pkgsrc，因此他们希望 libnbcompat 提供缺少的 POSIX 函数，如 getline()。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-07-09T19:33:22.443

如果您正在为 BSD 编译，请 改用[fgetln](http://developer.apple.com/library/mac/#documentation/darwin/reference/manpages/man3/fgetln.3.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-01T08:53:23.203

尝试使用 fgets() 而不是 getline()。我在 Linux 中使用 getline() 并且在我迁移到 Windows 之前它运行良好。Visual Studio 无法识别 getline()。因此，我将字符指针替换为字符，并将 EOF 替换为 NULL。见下文：

```
#define CHARCOUNT 1000 
```

前：

```
char *line = (char*) malloc(CHARCOUNT);
size_t size;
FILE *fp = fopen(file, "r");
while(getline(&line, &size, fp) != -1) {
   ...
}
free(line); 
```

后：

```
char line[CHARCOUNT];
while(fgets(line, CHARCOUNT, fp) != NULL) {
   ...
} 
```

# iphone - 在“CFBundleRef opaque type”的上下文中，术语“opaque type”是什么意思？

> ID：735131
> 
> 赞同：31
> 
> 时间：2009-04-09T17:21:07.610
> 
> 标签：iphone, objective-c, opaque-pointers

有人对什么是“不透明类型”有很好的解释吗？我在 的上下文中看到了这个术语`CFBundleRef`，他们说：“CFBundleRef opaque type”。那是只读的类型吗？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-04-09T17:45:24.197

“不透明类型”是您没有完整定义的类型`struct`or `class`。在 C、C++ 和 Objective-C 中，您可以通过使用前向声明告诉编译器稍后将定义一个类型：

```
// forward declaration of struct in C, C++ and Objective-C
struct Foo;

// forward declaration of class in C++:
class Bar;

// forward declaration of class in Objective-C:
@class Baz; 
```

编译器没有足够的信息让您直接使用`struct`or执行任何操作，`class`除非声明指向它的指针，但这通常是您需要做的所有事情。这允许库和框架创建者隐藏实现细节。库或框架的用户然后调用辅助函数来创建、操作和销毁前向声明的`struct`或`class`. 例如，框架创建者可以为`struct Foo`：

```
struct Foo *createFoo(void);
void addNumberToFoo(struct Foo *foo, int number);
void destroyFoo(struct Foo *foo); 
```

As part of the Core Foundation framework, Apple makes common Objective-C classes like `NSString`, `NSArray` and `NSBundle` available to C programmers through opaque types. C programmers use pointers and helper functions to create, manipulate and destroy instances of these Objective-C classes. Apple calls this "toll-free bridging". They follow a common naming convention: *"CF" prefix + class name + "Ref" suffix*, where "CF" stands for "Core Foundation" and "Ref" is short for "Reference", meaning it's a pointer.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-09T17:27:07.097

opaque 类型是一种“包装”较低级别类型的类型，通常在底层实现复杂或用户根本不需要了解内部工作时使用。苹果在这里有一个关于不透明类型的好页面：

[https://developer.apple.com/library/ios/#documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/OpaqueTypes.html](https://developer.apple.com/library/ios/#documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/OpaqueTypes.html)

例如，CFString 是一个不透明类型，因为它包装了一个字符数组，维护了它的长度、它的编码等，但不允许用户直接访问这些值。相反，它提供了访问或操作内部字段并将相关信息返回给用户的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T17:28:04.800

这是一个未来声明的结构。例如：

```
typedef struct CFBundle *CFBundleRef; 
```

如果没有“struct CFBundle”的实际定义，您的代码将无法访问 CFBundleRef 指针中的任何内容。这是不透明的。

# debugging - 加载事件调试

> ID：735132
> 
> 赞同：0
> 
> 时间：2009-04-09T17:21:19.483
> 
> 标签：debugging, events, load

我对 VS 2008 有一个奇怪的行为。在加载事件期间引发的所有异常都没有显示在调试器中。VS 不会停止，并且（加载事件的）其余代码不会执行。这只会发生在加载事件中，而不会发生在我可以逐步进行的其他事件中，并且窗口会弹出异常消息。这不是很方便。这是正常的吗？我需要修改哪个参数来改变它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-12T16:16:37.007

我终于在 MSDN 论坛上找到了这个问题的答案。因此，如果有人感兴趣，这就是答案。为了让 VS 2008 在调试期间停止加载事件，请转到**Debug > Exception**并检查 Thrown for Common Language Runtime Exceptions。这样 VS 2008 会在加载事件期间显示每一行代码的异常窗口。显然，VS 2008 的默认安装没有附带检查公共语言运行时异常。这与 VS 2005 不同，并且可能会产生误导，因为 IDE 将在 Load 事件之外的任何其他代码行上停止，并且不会警告您其余代码未执行。

# asp.net-mvc - ASP.NET MVC - 如何在控制器和视图以外的地方访问会话数据

> ID：735133
> 
> 赞同：23
> 
> 时间：2009-04-09T17:21:27.813
> 
> 标签：asp.net-mvc, session

我们可以像这样访问控制器和视图中的会话数据：

```
Session["SessionKey1"] 
```

您如何从控制器或视图以外的类访问 Session 值？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-09T17:25:19.130

我会使用依赖注入并将 HttpContext 的实例（或只是会话）传递给需要访问会话的类。另一种替代方法是引用 HttpContext.Current，但这会使测试变得更加困难，因为它是一个静态对象。

```
 public ActionResult MyAction()
   {

       var foo = new Foo( this.HttpContext );
       ...
   }

   public class Foo
   {
        private HttpContextBase Context { get; set; }

        public Foo( HttpContextBase context )
        {
            this.Context = context;
        }

        public void Bar()
        {
            var value = this.Context.Session["barKey"];
            ...
        }
   } 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-09T17:36:03.440

您只需要通过以下方式调用它`HttpContext`：

```
HttpContext.Current.Session["MyValue"] = "Something"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-09T01:46:09.200

这是我解决此问题的版本。请注意，我也使用了依赖注入，唯一的主要区别是“会话”对象是通过单例访问的

```
private iSession _Session;

private iSession InternalSession
{
    get
    {

        if (_Session == null)
        {                
           _Session = new SessionDecorator(this.Session);
        }
        return _Session;
    }
} 
```

这是 SessionDecorator 类，它使用装饰器模式将会话包装在接口周围：

```
public class SessionDecorator : iSession
{
    private HttpSessionStateBase _Session;
    private const string SESSIONKEY1= "SESSIONKEY1";
    private const string SESSIONKEY2= "SESSIONKEY2";

    public SessionDecorator(HttpSessionStateBase session)
    {
        _Session = session;
    }

    int iSession.AValue
    {
           get
        {
            return _Session[SESSIONKEY1] == null ? 1 : Convert.ToInt32(_Session[SESSIONKEY1]);
        }
        set
        {
            _Session[SESSIONKEY1] = value;
        }
    }

    int iSession.AnotherValue
    {
        get
        {
            return _Session[SESSIONKEY2] == null ? 0 : Convert.ToInt32(_Session[SESSIONKEY2]);
        }
        set
        {
            _Session[SESSIONKEY2] = value;
        }
    }
}` 
```

希望这可以帮助 ：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T17:27:10.903

我自己没有做过，但是来自 Chad Meyer 博客的这个示例可能会有所帮助（来自这篇文章： http: [//www.chadmyers.com/Blog/archive/2007/11/30/asp.net-webforms-and-mvc -in-the-same-project.aspx](http://www.chadmyers.com/Blog/archive/2007/11/30/asp.net-webforms-and-mvc-in-the-same-project.aspx) )

```
[ControllerAction]
public void Edit(int id)
{
    IHttpSessionState session = HttpContext.Session;

    if (session["LoggedIn"] == null || ((bool)session["LoggedIn"] != true))
        RenderView("NotLoggedIn");

    Product p = SomeFancyDataAccess.GetProductByID(id);

    RenderView("Edit", p);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T14:22:30.530

我还将所有会话变量包装到一个类文件中。这样您就可以使用智能感知来选择它们。这减少了代码中需要为会话指定“字符串”的步数。

# perl - Perl 的菱形运算符：可以在 bash 中完成吗？

> ID：735134
> 
> 赞同：4
> 
> 时间：2009-04-09T17:22:05.783
> 
> 标签：perl, bash, unix, shell, diamond-operator

有没有一种惯用的方法可以在 bash 中模拟 Perl 的菱形运算符？与钻石算子，

```
script.sh | ... 
```

读取标准输入的输入和

```
script.sh file1 file2 | ... 
```

读取 file1 和 file2 的输入。

另一个限制是我想将 script.sh 中的标准输入用于我自己脚本的输入之外的其他内容。下面的代码对上面的 file1 file2 ... case 执行了我想要的操作，但不适用于 stdin 上提供的数据。

```
command - $@ <<EOF
some_code_for_first_argument_of_command_here
EOF 
```

我更喜欢 Bash 解决方案，但任何 Unix shell 都可以。

编辑：为澄清起见，这里是 script.sh 的内容：

```
#!/bin/bash
command - $@ <<EOF
some_code_for_first_argument_of_command_here
EOF 
```

我希望它以菱形运算符在 Perl 中的工作方式工作，但它现在只处理文件名作为参数。

编辑2：我不能做任何事情

```
cat XXX | command 
```

因为命令的标准输入*不是用户的数据*。命令的标准输入是我在 here-doc 中的数据。我希望用户数据进入我的脚本的标准输入，但它不能是我脚本中命令调用的标准输入。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T19:14:07.993

当然，这是完全可行的：

```
#!/bin/bash
cat $@ | some_command_goes_here 
```

然后，用户可以不带参数（或“-”）调用您的脚本以从标准输入或多个文件中读取，所有这些都将被读取。

如果您想处理这些文件的内容（例如，逐行），您可以执行以下操作：

```
for line in $(cat $@); do
    echo "I read: $line"
done 
```

编辑：更改`$*`为`$@`处理文件名中的空格，感谢有用的评论。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T17:25:06.680

有点俗气，但是怎么样

```
cat file1 file2 | script.sh 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T19:32:17.090

我（和其他所有人一样，似乎）对这里的目标到底是什么有点困惑，所以我将给出三个可能的答案，这些答案可能涵盖你真正想要的。首先，让脚本从文件列表（在命令行上提供）或其常规标准输入中读取的相对简单的目标：

```
if [ $# -gt 0 ]; then
  exec < <(cat "$@")
fi
# From this point on, the script's stdin is redirected from the files
# (if any) supplied on the command line 
```

注意：$@ 的双引号使用是避免文件名中出现有趣字符（例如空格）问题的最佳方法—— $* 和不带引号的 $@ 都会把这搞砸。我在这里使用的 <() 技巧是一个仅限 bash 的功能；它在后台触发 cat 以从命令行提供的文件中提供数据，然后我们使用 exec 将脚本的标准输入替换为 cat 的输出。

...但这似乎不是您真正想要的。您似乎真正想要的是将提供的文件名或脚本的标准输入*作为参数*传递给脚本内的命令。这需要一些相反的过程：将脚本的标准输入转换为一个文件（实际上是一个命名管道），其名称可以传递给命令。像这样：

```
if [[ $# -gt 0 ]]; then
  command "$@" <<EOF
here-doc goes here
EOF
else
  command <(cat) <<EOF
here-doc goes here
EOF
fi 
```

这使用 <() 通过 cat 将脚本的标准输入清洗到命名管道，然后将其作为参数传递给命令。同时，命令的标准输入取自 here-doc。

现在，我认为这就是您想要做的，但这并不是您所要求的，即从提供的文件中*重定向*脚本的标准输入*并将*标准输入传递给脚本内的命令。这可以通过结合上述技术来完成：

```
if [ $# -gt 0 ]; then
  exec < <(cat "$@")
fi

command <(cat) <<EOF
here-doc goes here
EOF 
```

...虽然我想不出你为什么真的想这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T15:07:53.413

您想获取第一个参数并对其进行处理，然后从指定的任何文件中读取，如果没有文件则从 stdin 中读取？

就个人而言，我建议使用 getopt 来指示参数，使用“-a value”语法来帮助消除歧义，但这只是我。以下是我在*没有*getopts 的情况下在 bash 中的做法：

```
firstarg=${1?:usage: $0 arg [file1 .. fileN]}
shift
typeset -a files
if [[ ${#@} -gt 0 ]]
then
  files=( "$@" )
else
  files=( "/dev/stdin" )
fi
for file in "${files[@]}"
do
  whatever_you_want < "$file"
done 
```

如果没有指定参数， ?: 运算符将会死掉，因为无论哪种方式，您似乎都至少需要一个参数。抓住它之后，将 args 移动一个，然后使用剩余的 args 作为文件列表，或者如果没有其他 args，则使用 bash 特殊文件句柄“/dev/stdin”。

我认为“如果没有指定文件，请使用 /dev/stdin - 否则使用命令行上的文件”部分可能是您正在寻找的，但其余代码至少对上下文有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T18:58:09.373

Perl 菱形运算符本质上循环遍历所有命令行参数，将每个参数视为一个文件名。它打开每个文件并逐行读取它们。这是一些 bash 代码，它们的作用大致相同。

```
for f in "$@"
do
   # Do something with $f, such as...
   cat $f | command1 | command2
   -or-
   command1 < $f
   -or-
   # Read $f line-by-line
   cat $f | while read line_from_f
   do
      # Do stuff with $line_from_f
   done
done 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T19:13:16.873

也有点俗气，但是这个怎么样：

```
if [[ $# -eq 0 ]]
then
  # read from stdin
else
  # read from $* (args)
fi 
```

如果您需要逐行阅读和处理（很可能）并且不想复制/粘贴两次相同的代码（很可能），请在脚本中定义一个函数并逐行传递-一个到这个函数，并在所述函数中处理它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T19:17:37.657

为什么不在`脚本中使用 ``cat @* ？例如：`

 ````
x=`cat $*`
echo $x 
```

# javascript - IE 6/7 Access Denied 试图访问弹出窗口.document

> ID：735136
> 
> 赞同：3
> 
> 时间：2009-04-09T17:22:24.300
> 
> 标签：javascript, internet-explorer, dom

我正在使用 window.open() 创建一个没有 URL 源的弹出窗口。我没有给它一个 URL，因为我很快就会想向它发布一个表单。但是，与此同时，我想显示一个简短的“正在加载...”消息，这样用户就不会在 2-3 秒内查看空白页面，这将需要表单发布才能通过。

我尝试添加只写入弹出窗口文档的Javascript。这在 Firefox 和 IE 8 中效果很好，但在 IE 6 和 7 中因访问被拒绝消息而失败。有人知道解决这个问题的方法吗？我希望能够 a) 将一些 HTML 硬编码到 window.open() 中，b) 学习如何在这种情况下更新弹出窗口的 DOM，或者 c) 听到任何人能想到的任何事情。

下面是我用来生成窗口的代码：

```
 var wref = window.open("", winName, "toolbar=1,resizable=1,menubar=1,location=1,status=1,scrollbars=1,width=800,height=600");
    if (wref != null) {
        try {wref.opener = self;} catch (exc) {}

        // while we wait for the handoff form post to go through, display a simple wait message
        $j(wref.document.body).html('Now loading &#133;'); // EPIC FAIL
        wref.focus(); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T17:31:40.173

IE 认为“about:blank”是一个不安全的 URL，它不会让你与之交谈。我会创建一个“Now Loading...”静态 HTML 文件并打开它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T18:16:32.017

```
<a href="#" onclick="return test();">Test</a>
<script type="text/javascript">
function test() {
    window.open('javascript:opener.write(window);', '_name', 'width=200,height=200');
}
function write(w) {
    w.document.write("Hello, World.");
}
</script> 
```

适用于 IE 6、7 和 8、Opera 9.6、Firefox 2 和 3。不适用于 Windows 3 和 4 的 Safari 或 Google Chrome。

当它起作用时，它会在位置框中产生一个非常丑陋的 URL。

如果上面列出的浏览器支持是可以接受的，您可以使用提供的解决方案，否则我会按照大卫所说的去做，并且`window.open('Loading.htm' ...)`在哪里`Loading.htm`包含您想要显示的任何内容（您可能应该保持轻量级，否则加载和渲染可能需要更长的时间表格将发布）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T18:14:44.253

另请注意，您在 IE 中提供的 winName 不能有空格......如果是这样，它将失败。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-17T15:52:29.383

另一种解决方法是在您的站点上打开一个空的“blank.htm”文件，然后执行 document.open() 来访问它

# c# - 在 C# 中的基本构造函数之前执行派生构造函数

> ID：735138
> 
> 赞同：18
> 
> 时间：2009-04-09T17:22:57.857
> 
> 标签：c#, constructor, abstract-class, derived-class

我的问题是我想将一个对象传递给派生类，但必须在基类构造函数之前完成，因为基类会立即调用派生类`Start()`使用该对象的方法。

这是基类的摘录，（为方便起见，从[BarcodeScanner](http://msdn.microsoft.com/en-us/library/aa446489.aspx#barcode_scanners_netcf_topic6)重命名）。

```
public abstract class MyBase
{    
    public MyBase()
    {
        if (Initialize())
            this.Start();
    }

    public abstract bool Initialize();
    public abstract void Start();
} 
```

这是我正在创建的派生类。

```
class MyDerived : MyBase
{
    private string sampleObject;

    public MyDerived (string initObject)
    {
        sampleObject = initObject;
    }

    public override bool Initialize() 
    { 
        return GetDevice();
    }
    public override void Start() 
    { 
        Console.WriteLine("Processing " + sampleObject.ToString()); 
    }
} 
```

我怀疑您是否可以让 C# 在基本构造函数之前执行派生构造函数；所以我真的只是在寻找一种解决方案，在使用对象之前将对象传递给派生类。

我通过将 Initialize/Start if 块放在`MyDerived`构造函数中来解决这个问题。但是，还有其他类派生自基类；所以我最终不得不在每个派生类中重复这个初始化/启动代码块。我希望看到修改基类的替代方法。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-09T17:24:16.167

您尝试做的事情在 C# 中是不可能的。基类中的构造函数必须在任何派生类的构造函数之前运行，否则可能会损坏对象状态。子对象必须能够假定其基础已完全构建且可用。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-09T17:25:41.047

恕我直言，您的设计是错误的。您不应该从构造函数中启动该过程。您的消费代码应在需要时显式调用 Start() 方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T17:29:45.267

我会重新设计您的设计，以便在构造后调用 Initialize（可能还有 Start() - 尽管我通常将此作为用户调用的公共方法）。

如果您正在制作 BarcodeScanner，您可以在第一次扫描时执行此操作。只需使用派生类中的数据对您的成员进行延迟初始化。

这将解决您的问题，而用户的使用没有真正的变化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-08-19T15:10:27.297

很抱歉添加到旧线程，但也许有人对另一个答案感兴趣。我发现了一种（IMO）巧妙的方法来处理逻辑，而不仅仅是在[此处](https://stackoverflow.com/a/46140327/2240196)涉及继承的类构造函数中分配字段（以及之后） 。如果您只想为这个特定的层次结构使用 if 而不是使用带有接口和扩展方法的通用解决方案，您可以在一个类树中使用相同的概念，如下所示：

```
public abstract class MyBase
{    
    protected MyBase()
    {
        Initialize(this) // just to illustrate this will never do anything as MyBase can never be the run time type.
    }

    protected bool IsInitialized { get; private set; } = false;

    protected static bool Initialize<T>(T instance) where T: MyBase
    {
        if (instance?.GetType() == typeof(T)) // check if this is called from the constructor of instance run time type
            return instance.IsInitialized || ( instance.IsInitialized = instance.Initialize() );
        return false;
    }

    protected abstract bool Initialize();
    public abstract void Start();
} 
```

并得出：

```
class MyDerived : MyBase
{
    private string sampleObject;
    protected bool started = false;

    public MyDerived (string initObject)
    {
        sampleObject = initObject;
        if (Initialize(this)) // if this is the most derived constructor, this will run Initialize() and return whether it was successful
            this.Start();// EDIT: Just to illustrate. Normally constructors should only initialize an instance and not perform operations on it (as mentioned in other answers).
    }

    protected override bool Initialize() 
    { 
       return GetDevice();
    }

    public override void Start() 
    { 
        // if Start() would be protected, we don't need the IsInitialized property and we can move this check to the constructor on the returned value of the Initialize<T>() call.
        if (!IsInitialized) throw new InvalidOperationException("Initialization failed.");
        // if you want to have this method exposed public, we need to check if this instance is successfully initialized from the constructor and not in started state already.
        if (started) return;

        Console.WriteLine("Processing " + sampleObject.ToString()); 
        started = true;
        if (!Run(sampleObject)) started = false;
    }
} 
```

# sql - 是否有从结果集中构建插入语句的 Oracle SQL 工具？

> ID：735139
> 
> 赞同：3
> 
> 时间：2009-04-09T17:23:16.717
> 
> 标签：sql, oracle, insert, resultset

是否有从结果集中构建插入语句的 Oracle SQL 工具？我们目前只允许使用名为 SQL Station 的工具。我想推荐一个工具，比如 Rapid SQL 或 CrazySQuirrell，或者构建我自己的可重用 sql 块。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T18:02:54.313

这个结果集来自哪里？如果您的意思是要执行 SELECT，然后将结果数据插入到另一个表中，您可以在单个 SQL 语句中执行此操作：

```
INSERT INTO table2 (columnA, columnB)
  SELECT columnA, columnB
    FROM table1; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T18:05:03.497

PL/SQL Developer 也会这样做。我用过 PL/SQL Developer 和 Oracle 的 SQL Developer，在我看来 PL/SQL Developer 有一个更流畅和更一致的界面。不确定 SQL Developer，但 PL/SQL Dev。还允许您将结果集导出为 CSV、XML 和 HTML。

如果您运行的是 Linux，它在 WINE 下也可以正常运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T06:31:45.890

如果你想要命令行工具，免费的 cx_OracleTools 可以做到这一点，还有一些其他的好东西。

[http://cx-oracletools.sourceforge.net/](http://cx-oracletools.sourceforge.net/)

*   CompileSource - 在文件中执行语句，检查错误
*   CopyData - 将数据从一个表或视图复制到另一个
*   DbDebugger - 允许简单调试 PL/SQL
*   DescribeObject - 将对象描述为用于娱乐的 SQL 语句
*   DescribeSchema - 将多个对象描述为用于娱乐的 SQL 语句
*   DumpCSV - 将 select 语句的结果转储为逗号分隔值
*   DumpData - 将 select 语句的结果转储为 insert 语句
*   ExportColumn - 将列中的数据转储到文件中
*   ExportData - 将数据库中的数据转储到可移植的转储文件中
*   ExportObjects - 将对象描述为 SQL 语句以便在文件中重新创建
*   ExportXML - 将表中的数据导出到简单的 XML 文件中
*   GeneratePatch - 生成 SQL 脚本以从一组对象转到另一组对象
*   GenerateView - 为表生成视图语句
*   ImportColumn - 将文件的内容导入数据库中的列
*   ImportData - 导入用 ExportData 转储的数据
*   ImportXML - 从 XML 文件导入数据（例如由 ExportXML 创建的文件）
*   RebuildTable - 生成用于重建表的 SQL 脚本
*   RecompileSource - 重新编译数据库中的所有无效对象

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T17:29:41.303

是的，看看 Oracle sql developer。它的免费可以从 otn.oracle.com 下载

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T19:36:05.960

我找到了这个解决方案，这就是我现在正在使用的。感谢所有的帮助。事实证明我们也可以使用 SQL+。由于某种原因，我无法在 SQL Station 中运行它。

COPY FROM userid/password@from_DB TO userid/password>@to_DB INSERT toDB_tablename USING SELECT * FROM fromDB_tablename where ....;

犯罪;

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T19:51:25.160

在紧要关头，使用字符串连接非常适合您想要构建的较小语句：

```
Select
    'Insert Into MyOtherTableTable Values(''' || MyMainTableColumn1 || ''' and ''' || MyMainTableColumn2 || ''')'
From MyMainTable 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-18T11:49:28.280

右键单击查询的结果集，您将得到一个弹出窗口。选择导出数据并插入。它会询问您保存生成插入语句的文件的位置。给出文件名和保存路径。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-10T15:04:30.097

我知道为时已晚，但这可能对某人有所帮助。如果你去表，你可以“导出”数据。第二步是“指定数据”，您可以在其中添加一些过滤器。这仅适用于表数据。

干杯

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-07T12:43:07.367

使用 Oracle SQL-Developer 类型并作为脚本执行 (F5)：

```
select /*insert*/ 
  * from dual; 
```

输出：

```
 Insert into "dual" (DUMMY) values ('X'); 
```

您也可以尝试 /*csv*/" 或 /*html*/

来源：[http ://www.thatjeffsmith.com/archive/2012/05/formatting-query-results-to-csv-in-oracle-sql-developer/](http://www.thatjeffsmith.com/archive/2012/05/formatting-query-results-to-csv-in-oracle-sql-developer/)

```
SELECT /*csv*/ * FROM scott.emp;
SELECT /*xml*/ * FROM scott.emp;
SELECT /*html*/ * FROM scott.emp;
SELECT /*delimited*/ * FROM scott.emp;
SELECT /*insert*/ * FROM scott.emp;
SELECT /*loader*/ * FROM scott.emp;
SELECT /*fixed*/ * FROM scott.emp;
SELECT /*text*/ * FROM scott.emp; 
```

# c# - C# LINQ to SQL：重构此通用 GetByID 方法

> ID：735140
> 
> 赞同：21
> 
> 时间：2009-04-09T17:24:04.717
> 
> 标签：c#, linq-to-sql, generics, expression-trees

我写了以下方法。

```
public T GetByID(int id)
{
    var dbcontext = DB;
    var table = dbcontext.GetTable<T>();
    return table.ToList().SingleOrDefault(e => Convert.ToInt16(e.GetType().GetProperties().First().GetValue(e, null)) == id);
} 
```

基本上，它是通用类中的一个方法，其中`T`是 DataContext 中的一个类。

该方法从 T ( `GetTable`) 的类型中获取表，并检查输入参数的第一个属性（始终是 ID）。

这样做的问题是我必须先将元素表转换为列表才能`GetType`对属性执行 a ，但这不是很方便，因为表的所有元素都必须枚举并转换为 a `List`。

如何重构此方法以避免`ToList`在整个表上出现 a ？

**[更新]**

我不能`Where`直接在桌子上执行的原因是因为我收到了这个异常：

> 方法 'System.Reflection.PropertyInfo[] GetProperties()' 不支持对 SQL 的转换。

因为`GetProperties`不能翻译成SQL。

**[更新]**

有人建议为*T*使用接口，但问题是`T`参数将是在*[DataContextName].designer.cs*中自动生成的类，因此我无法使其实现接口（而且实现LINQ 的所有这些“数据库类”的接口；而且，一旦我将新表添加到 DataContext，文件将重新生成，从而丢失所有写入的数据）。

所以，必须有更好的方法来做到这一点......

**[更新]**

我现在已经像[Neil Williams](https://stackoverflow.com/questions/735140/c-linq-to-sql-refectoring-this-generic-getbyid-method/735209#735209)的建议那样实现了我的代码，但我仍然遇到问题。以下是代码的摘录：

*界面：*

```
public interface IHasID
{
    int ID { get; set; }
} 
```

*DataContext [查看代码]：*

```
namespace MusicRepo_DataContext
{
    partial class Artist : IHasID
    {
        public int ID
        {
            get { return ArtistID; }
            set { throw new System.NotImplementedException(); }
        }
    }
} 
```

*通用方法：*

```
public class DBAccess<T> where T :  class, IHasID,new()
{
    public T GetByID(int id)
    {
        var dbcontext = DB;
        var table = dbcontext.GetTable<T>();

        return table.SingleOrDefault(e => e.ID.Equals(id));
    }
} 
```

在这一行抛出`return table.SingleOrDefault(e => e.ID.Equals(id));`异常：异常是：

> `System.NotSupportedException: The member 'MusicRepo_DataContext.IHasID.ID' has no supported translation to SQL.`

**[更新] 解决方法：**

在[Denis Troller](https://stackoverflow.com/questions/735140/c-linq-to-sql-refectoring-this-generic-getbyid-method/735888#735888)发布的答案和[Code Rant 博客](http://mikehadlow.blogspot.com/2008/03/using-irepository-pattern-with-linq-to.html)上的帖子链接的帮助下，我终于设法找到了解决方案：

```
public static PropertyInfo GetPrimaryKey(this Type entityType)
{
    foreach (PropertyInfo property in entityType.GetProperties())
    {
        ColumnAttribute[] attributes = (ColumnAttribute[])property.GetCustomAttributes(typeof(ColumnAttribute), true);
        if (attributes.Length == 1)
        {
            ColumnAttribute columnAttribute = attributes[0];
            if (columnAttribute.IsPrimaryKey)
            {
                if (property.PropertyType != typeof(int))
                {
                    throw new ApplicationException(string.Format("Primary key, '{0}', of type '{1}' is not int",
                                property.Name, entityType));
                }
                return property;
            }
        }
    }
    throw new ApplicationException(string.Format("No primary key defined for type {0}", entityType.Name));
}

public T GetByID(int id)
{
    var dbcontext = DB;

    var itemParameter = Expression.Parameter(typeof (T), "item");
    var whereExpression = Expression.Lambda<Func<T, bool>>
        (
        Expression.Equal(
            Expression.Property(
                 itemParameter,
                 typeof (T).GetPrimaryKey().Name
                 ),
            Expression.Constant(id)
            ),
        new[] {itemParameter}
        );
    return dbcontext.GetTable<T>().Where(whereExpression).Single();
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-09T20:53:20.783

您需要的是构建一个[LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL)可以理解的表达式树。假设您的“id”属性始终命名为“id”：

```
public virtual T GetById<T>(short id)
{
    var itemParameter = Expression.Parameter(typeof(T), "item");
    var whereExpression = Expression.Lambda<Func<T, bool>>
        (
        Expression.Equal(
            Expression.Property(
                itemParameter,
                "id"
                ),
            Expression.Constant(id)
            ),
        new[] { itemParameter }
        );
    var table = DB.GetTable<T>();
    return table.Where(whereExpression).Single();
} 
```

这应该可以解决问题。[无耻地从这个博客](http://mikehadlow.blogspot.com/2008/03/using-irepository-pattern-with-linq-to.html)借来的。这基本上是 LINQ to SQL 在您编写类似查询时所做的

```
var Q = from t in Context.GetTable<T)()
        where t.id == id
        select t; 
```

您只需为 LTS 完成工作，因为编译器无法为您创建它，因为没有任何东西可以强制 T 具有“id”属性，并且您无法将任意“id”属性从接口映射到数据库。

==== 更新 ====

好的，这是查找主键名称的简单实现，假设只有一个（不是复合主键），并假设所有类型都很好（也就是说，您的主键与您的“短”类型兼容在 GetById 函数中使用）：

```
public virtual T GetById<T>(short id)
{
    var itemParameter = Expression.Parameter(typeof(T), "item");
    var whereExpression = Expression.Lambda<Func<T, bool>>
        (
        Expression.Equal(
            Expression.Property(
                itemParameter,
                GetPrimaryKeyName<T>()
                ),
            Expression.Constant(id)
            ),
        new[] { itemParameter }
        );
    var table = DB.GetTable<T>();
    return table.Where(whereExpression).Single();
}

public string GetPrimaryKeyName<T>()
{
    var type = Mapping.GetMetaType(typeof(T));

    var PK = (from m in type.DataMembers
              where m.IsPrimaryKey
              select m).Single();
    return PK.Name;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:34:34.693

如果你修改它以使用 GetTable().Where(...)，并将你的过滤放在那里怎么办？

这会更有效，因为 Where 扩展方法应该比将整个表提取到列表中更好地处理您的过滤。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T17:36:42.033

一些想法...

只需删除 ToList() 调用，SingleOrDefault 就可以与我认为 table 的 IEnumerably 一起使用。

缓存对 e.GetType().GetProperties().First() 的调用以获取返回的 PropertyInfo。

您不能只向 T 添加一个约束，迫使他们实现一个公开 Id 属性的接口吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T01:28:51.417

关于：

> System.NotSupportedException：成员“MusicRepo_DataContext.IHasID.ID”没有支持的 SQL 转换。

初始问题的简单解决方法是指定一个表达式。见下文，它对我来说就像一个魅力。

```
public interface IHasID
{
    int ID { get; set; }
}
DataContext [View Code]:

namespace MusicRepo_DataContext
{
    partial class Artist : IHasID
    {
        [Column(Name = "ArtistID", Expression = "ArtistID")]
        public int ID
        {
            get { return ArtistID; }
            set { throw new System.NotImplementedException(); }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T17:59:55.893

也许执行查询可能是个好主意。

```
public static T GetByID(int id)
    {
        Type type = typeof(T);
        //get table name
        var att = type.GetCustomAttributes(typeof(TableAttribute), false).FirstOrDefault();
        string tablename = att == null ? "" : ((TableAttribute)att).Name;
        //make a query
        if (string.IsNullOrEmpty(tablename))
            return null;
        else
        {
            string query = string.Format("Select * from {0} where {1} = {2}", new object[] { tablename, "ID", id });

            //and execute
            return dbcontext.ExecuteQuery<T>(query).FirstOrDefault();
        }
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-02T22:47:07.210

好的，检查这个演示实现。尝试使用 datacontext（Linq To Sql）获取通用 GetById。还兼容多键属性。

```
using System;
using System.Data.Linq;
using System.Data.Linq.Mapping;
using System.Linq;
using System.Reflection;
using System.Collections.Generic;

public static class Programm
{
    public const string ConnectionString = @"Data Source=localhost\SQLEXPRESS;Initial Catalog=TestDb2;Persist Security Info=True;integrated Security=True";

    static void Main()
    {
        using (var dc = new DataContextDom(ConnectionString))
        {
            if (dc.DatabaseExists())
                dc.DeleteDatabase();
            dc.CreateDatabase();
            dc.GetTable<DataHelperDb1>().InsertOnSubmit(new DataHelperDb1() { Name = "DataHelperDb1Desc1", Id = 1 });
            dc.GetTable<DataHelperDb2>().InsertOnSubmit(new DataHelperDb2() { Name = "DataHelperDb2Desc1", Key1 = "A", Key2 = "1" });
            dc.SubmitChanges();

            Console.WriteLine("Name:" + GetByID(dc.GetTable<DataHelperDb1>(), 1).Name);
            Console.WriteLine("");
            Console.WriteLine("");
            Console.WriteLine("Name:" + GetByID(dc.GetTable<DataHelperDb2>(), new PkClass { Key1 = "A", Key2 = "1" }).Name);
        }
    }

    //Datacontext definition
    [Database(Name = "TestDb2")]
    public class DataContextDom : DataContext
    {
        public DataContextDom(string connStr) : base(connStr) { }
        public Table<DataHelperDb1> DataHelperDb1;
        public Table<DataHelperDb2> DataHelperD2;
    }

    [Table(Name = "DataHelperDb1")]
    public class DataHelperDb1 : Entity<DataHelperDb1, int>
    {
        [Column(IsPrimaryKey = true)]
        public int Id { get; set; }
        [Column]
        public string Name { get; set; }
    }

    public class PkClass
    {
        public string Key1 { get; set; }
        public string Key2 { get; set; }
    }
    [Table(Name = "DataHelperDb2")]
    public class DataHelperDb2 : Entity<DataHelperDb2, PkClass>
    {
        [Column(IsPrimaryKey = true)]
        public string Key1 { get; set; }
        [Column(IsPrimaryKey = true)]
        public string Key2 { get; set; }
        [Column]
        public string Name { get; set; }
    }

    public class Entity<TEntity, TKey> where TEntity : new()
    {
        public static TEntity SearchObjInstance(TKey key)
        {
            var res = new TEntity();
            var targhetPropertyInfos = GetPrimaryKey<TEntity>().ToList();
            if (targhetPropertyInfos.Count == 1)
            {
                targhetPropertyInfos.First().SetValue(res, key, null);
            }
            else if (targhetPropertyInfos.Count > 1) 
            {
                var sourcePropertyInfos = key.GetType().GetProperties(BindingFlags.Instance | BindingFlags.Public);
                foreach (var sourcePi in sourcePropertyInfos)
                {
                    var destinationPi = targhetPropertyInfos.FirstOrDefault(x => x.Name == sourcePi.Name);
                    if (destinationPi == null || sourcePi.PropertyType != destinationPi.PropertyType)
                        continue;

                    object value = sourcePi.GetValue(key, null);
                    destinationPi.SetValue(res, value, null);
                }
            }
            return res;
        }
    }

    public static IEnumerable<PropertyInfo> GetPrimaryKey<T>()
    {
        foreach (var info in typeof(T).GetProperties().ToList())
        {
            if (info.GetCustomAttributes(false)
            .Where(x => x.GetType() == typeof(ColumnAttribute))
            .Where(x => ((ColumnAttribute)x).IsPrimaryKey)
            .Any())
                yield return info;
        }
    }
    //Move in repository pattern
    public static TEntity GetByID<TEntity, TKey>(Table<TEntity> source, TKey id) where TEntity : Entity<TEntity, TKey>, new()
    {
        var searchObj = Entity<TEntity, TKey>.SearchObjInstance(id);
        Console.WriteLine(source.Where(e => e.Equals(searchObj)).ToString());
        return source.Single(e => e.Equals(searchObj));
    }
} 
```

结果：

```
SELECT [t0].[Id], [t0].[Name]
FROM [DataHelperDb1] AS [t0]
WHERE [t0].[Id] = @p0

Name:DataHelperDb1Desc1

SELECT [t0].[Key1], [t0].[Key2], [t0].[Name]
FROM [DataHelperDb2] AS [t0]
WHERE ([t0].[Key1] = @p0) AND ([t0].[Key2] = @p1)

Name:DataHelperDb2Desc1 
```

# ruby-on-rails - Rails：在数据库中存储二进制文件

> ID：735147
> 
> 赞同：11
> 
> 时间：2009-04-09T17:25:18.567
> 
> 标签：ruby-on-rails

使用 Rails，是否有理由将附件（可能是任何时间的文件）存储在文件系统而不是数据库中？数据库对我来说似乎更简单，无需担心文件系统路径、结构等，您只需查看您的 blob 字段即可。但是大多数人似乎都在使用文件系统，这让我猜测这样做一定有一些我没有得到的好处，或者使用数据库进行这种存储有一些缺点。（在这种情况下，我使用的是 postgres）。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-09T17:33:55.550

这是一个非常标准的设计问题，并没有真正的“一个真正的答案”。

我通常遵循的经验法则是“数据进入数据库，文件进入文件”。

要记住的一些注意事项：

1.  如果一个文件存储在数据库中，你将如何通过 http 提供它？请记住，您需要设置内容类型、文件名等。如果它是文件系统上的文件，Web 服务器会为您处理所有这些内容。非常快速有效（甚至在内核空间中），不需要解释代码。

2.  文件通常很大。大数据库当然是可行的，但是它们备份起来很慢且不方便等。为什么在你不需要的时候让你的数据库变得很大呢？

3.  很像 2.，将文件复制到多台机器真的很容易。假设您正在运行一个集群，您可以定期将文件系统从您的主机同步到您的从机，并使用标准的静态 http 服务。显然，数据库也可以集群，只是不一定那么直观。

4.  在第 3 点的另一面，如果您已经对数据库进行集群化，那么必须另外处理集群化文件是管理复杂性。我会说，这将是考虑将文件存储在数据库中的一个原因。

5.  数据库中的 Blob 数据通常是不透明的。您无法对其进行过滤、排序或分组。这降低了将其存储在数据库中的价值。

6.  另一方面，数据库理解并发性。您可以使用事务隔离的标准模型来确保两个客户端不会尝试同时编辑同一个文件。这可能很好。并不是说您不能使用锁定文件，但现在您需要了解两件事而不是一件事。

7.  可访问性。文件系统中的文件可以使用常规工具打开。Vi、Photoshop、Word，无论你需要什么。这可能很方便。你将如何从 blob 字段中打开该 word 文档？

8.  权限。文件系统是有权限的，但它们可能会给你带来麻烦。相反，它们可能对您的应用程序有用。如果您使用 7，权限真的会咬您一口，因为几乎可以保证您的 Web 服务器运行的权限与您的应用程序不同。

9.  缓存（来自下面的 sarah mei）。这会在客户端出现上面的 http 问题（你会记得正确设置生命周期吗？）。在文件系统上的服务器端文件是一种非常容易理解和优化的访问模式。大型 blob 字段可能会或可能不会被您的数据库很好地优化，并且您几乎可以保证从数据库到 Web 服务器还有额外的网络旅行。

简而言之，人们倾向于将文件系统用于文件，因为它们最好地支持类文件习语。不过，您没有理由必须这样做，而且文件系统正变得越来越像数据库，因此最终看到完全融合一点也不会让我感到惊讶。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-03-19T23:02:06.550

关于使用文件系统存储文件有一些很好的建议，但这里还有一些需要考虑的事情。如果您要存储敏感或安全的文件/附件，那么使用数据库确实是唯一的方法。我已经构建了无法将数据放在文件中的应用程序。出于安全原因，它必须放入数据库中。在没有适当安全措施的情况下，您不能将其留在文件系统中供服务器/机器上的用户查看或随身携带。使用像 Oracle 这样的高级数据库，您可以非常严格地锁定数据，并确保只有适当的用户才能访问该数据。

但提出的其他观点非常有效。如果您只是在处理头像图像或非敏感信息之类的事情，那么对于大多数插件系统来说，文件系统通常更快、更方便。

数据库很容易设置用于发回文件；这需要更多的工作，但如果您知道自己在做什么，只需几分钟。所以是的，文件系统是整体上更好的方式，IMO，但是当安全或敏感数据是主要问题时，数据库是唯一可行的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-07T08:02:21.200

我不明白 blobstore 的问题是什么。您始终可以从中重建文件系统存储，例如在使用系统时将内容缓存到本地 Web 服务器。但是权威存储应该始终是数据库。这意味着您可以通过在数据库中折腾并从源代码控制中导出代码来部署您的应用程序。完毕。添加 Web 服务器完全没有问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T17:35:55.437

埃里克的回答很棒。我还要补充一点，如果你想做任何缓存，缓存静态文件比缓存数据库内容更容易和更直接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T10:19:19.533

如果您使用诸如[Paperclip](http://github.com/thoughtbot/paperclip/tree)之类的插件，您也不必担心任何事情。有一个叫做文件系统的东西，它是文件应该去的地方。仅仅因为它有点难并不意味着你应该把你的文件放在错误的地方。使用回形针（或其他类似插件）并不难。所以，gogo 文件系统！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-25T19:26:08.193

无法找到这个问题的最新答案我已经实现了一个自 Rails 5.2 以来可用的 Active Storage 数据库服务，它与任何其他 Active Storage 服务一样工作，但将文件内容存储在特殊的数据库列而不是云服务中.

该实现基于标准的 Rails Active Storage 服务，添加了一个新模型的迁移：一个额外的表，将 blob 内容存储在二进制字段中。该服务根据 Active Storage 的请求创建和销毁此表中的记录。

因此，该服务一旦安装，就可以通过标准的 Rails Active Storage API 使用。

[https://github.com/TitovDigital/activestorage-database-service](https://github.com/TitovDigital/activestorage-database-service)

请注意使用数据库存储文件的所有优点和缺点。

使用正确的数据库，它将提供完整的 ACID 支持，并且可以将文件存储和删除包装到事务中。在 DevOps 中也更容易配置，因为要配置的服务更少。

大文件或大流量是有风险的情况。两者都会给应用程序和数据库服务器带来不必要的压力。

# java - 为 Java 模拟 app.config？

> ID：735149
> 
> 赞同：0
> 
> 时间：2009-04-09T17:25:29.817
> 
> 标签：java, configuration, properties

我知道您可以使用 java.util.Properties 来读取 Java 属性文件。

请参阅：[Java 等效于 app.config？](https://stackoverflow.com/questions/212539/java-equivalent-to-app-config)

是否有放置此文件的标准位置？在 .NET 中，我们将 application.exe.config 放在与 application.exe 相同的目录中。默认情况下，应用程序会在此处查找它。

可以让 Java 在类路径中查找属性文件，但我很难理解要使用的文件名/路径结构以及如何使用标准的 .properties 格式或 XML 格式文件。

假设我有一个打包在 org_example_api.jar 中的 API（根包是 org.example.api）。我不想将属性文件放在 jar 中，因为它应该可由用户编辑。我希望用户能够将所需的配置属性放在相对于类路径的某个 .properties 或 .xml 文件中，这样我就可以找到它，而无需了解有关 ir 文件系统结构的任何信息。

这是否适用于所有系统：

```
/classpath/org_example_api.jar
/classpath/org/example/api/config.properties OR
/classpath/org/example/api/config.xml 
```

代码：

```
java.util.Properties = ? //NEED SOME HELP HERE 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:43:04.670

这完全取决于您正在开发的应用程序的类型。

1) 如果是 Web 应用程序，最好的位置是在 WEB-INF/classes/ 文件夹内。

2）如果您正在开发一个独立的应用程序，有很多方法。从您的示例中，我认为以下结构将起作用。

```
/<dist>/org_example_api.jar
/<dist>/config.xml
/<dist>/run.sh 
```

在 run.sh 中，您可以启动 java 应用程序，该应用程序也在类路径中提供当前目录。像这样的东西。

java -cp .:org_example_api.jar ClassToExecute

3) 如果是 API 分发，则取决于最终用户。您可以告诉用户他们可以在类路径中提供 config.xml，它应该遵循一些预定义的结构。在这种情况下，您可以将 Log4J 作为示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:34:18.217

世界在这里向你敞开。唯一的最佳实践是最适合您的：

1.  无论用户正在运行什么程序，都可能需要属性文件的路径作为参数
2.  您的应用程序可以配置为在当前目录中查找`config.properties`.
3.  如果找不到该文件，您可能会退回到该`user.home`目录，或者退回到您的应用程序的安装位置。

就我个人而言，我通常让我的应用程序尝试从类路径读取属性文件 - 但我不在一个让最终用户更新/更改文件的世界。

无论您选择什么选项，只要确保您清楚地为您的用户记录它，以便他们知道要编辑哪个文件以及它需要在哪里！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T17:54:29.853

您可以将属性文件放在 CLASSPATH 中的目录或 JAR 中，然后使用

```
InputStream is = getClass().getResourceAsStream("/path/goes/here");
Properties props = new Properties();
props.load(is); 
```

（我注意到您在 OP 中提到了这一点，但其他人可能会发现该代码很有用。）

# asp.net-mvc - ASP.NET MVC 利用测试控制器或测试模型

> ID：735164
> 
> 赞同：1
> 
> 时间：2009-04-09T17:30:18.867
> 
> 标签：asp.net-mvc, unit-testing, model-view-controller

在一个新的 MVC 应用程序中，我正在构建所有模型、控制器、视图等，但还没有设置后端数据库。我对支持的外观有所了解，但现在我专注于应用程序。

我知道我可以在控制器中模拟一个虚拟模型，例如：

```
public ActionResult Pictures()
{
    MyMVCApp.Models.Pictures pics = null;
    MyMVCApp.Classes.Picture pic1 = new MyMVCApp.Classes.Picture
    {
        AlbumID=1,
        Description="John Doh",
        ThumbnailLocation = "Photos/Thumbnails/John.jpg"
    };
    MyMVCApp.Classes.Picture pic2 = new MyMVCApp.Classes.Picture
    {
        AlbumID = 2,
        Description = "Jane Doh",
        ThumbnailLocation = "Photos/Thumbnails/Jane.jpg"
    };
    pics = new Pictures
    {
        PageTitle="PHOTO ALBUMS",
        PhotoAlbums = new List<MyMVCApp.Classes.PhotoAlbum>()
    };
    pics.PhotoAlbums.Add(new MyMVCApp.Classes.PhotoAlbum
    {
        AlbumID = 1,
        AlbumName = "Test1",
        AlbumCover = pic1,
        Created = DateTime.Now.AddDays(-15)
    });

    pics.PhotoAlbums.Add(new MyMVCApp.Classes.PhotoAlbum
    {
        AlbumID = 2,
        AlbumName = "Test2",
        AlbumCover = pic2,
        Created = DateTime.Now.AddDays(-11).AddHours(12)
    });
    return View(pics);
} 
```

这样做至少可以让我在视图上看到一些东西。我担心的是，当我准备好为我的模型实际使用数据库时，我不想丢失我的测试模型。

我应该如何将它分开，这样我就不必每次都在真实控制器和测试控制器之间更改视图？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T17:43:01.270

您可能会考虑不在控制器中设置这些数据类。而是从 InMemoryPictureRepository 请求它们，该存储库将在您需要它们进行测试时将实例返回给您。

换句话说，将数据持久性的责任放在 IRepository 接口后面。这样，您就可以拥有用于测试的版本，这些版本基本上可以提供硬编码的实例。

最终，我认为你真的想在 IoC 容器中使用依赖注入，而不是直接在你的控制器中引用存储库，但是过于简单的外观可能是这样的：

```
public class PictureController : Controller
{
    IPictureRepository _pictureRepository;

    public PictureController()
     {
        //Assume you change this for test/prod. Again you'd probably 
         //want to inject this if you really want testable controllers
        IPictureRepository _pictureRepository = new InMemoryPictureRepository();
     }

     public ActionResult Pictures()
     {
         List<Picture> pics  = _pictureService.GetAllPictures();
         return View(pics);
     }
} 
```

现在你可以拥有这个 InMemoryPictureRepository

```
public class InMemoryPictureRepository : IPictureRepository
{
    public List<Picture> GetAllPictures()
    {
        //All your hard-coded stuff to return dummy data;
    }
} 
```

这适用于您的现场资料：

```
public class PictureRepository : IPictureRepository
{
    public List<Picture> GetAllPictures()
    {
       //Code to get data from L2S or wherever. This returns real stuff
    }
} 
```

# iphone - 键盘外观默认为 UIKeyboardAppearanceDefault on Dismissal

> ID：735165
> 
> 赞同：2
> 
> 时间：2009-04-09T17:30:46.870
> 
> 标签：iphone, keyboard, interface-builder, hide, appearance

第一次 Stack Overflow 海报。请多多包涵！:)

我有一组`UITextField`s，我在 Interface Builder 中设置了其键盘外观。我正在`UIKeyboardAppearanceAlert`为我的键盘使用外观（半透明外观）。但是，每当我调用`resignFirstResponder`这些文本字段中的任何一个来关闭键盘时，键盘的外观默认`UIKeyboardAppearanceDefault`为滑出视图。1）我是否需要在其他地方设置键盘的外观，2）这是 Interface Builder 的错误，还是 3）我只是运气不好？虽然这不是什么大问题，但当它向下滑动时突然看到键盘改变样式有点令人不安。请注意，由于我的文本字段成为第一响应者，因此当键盘向上滑动进入视图时，此行为不存在，因此有点令人困惑。有什么见解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-30T16:46:59.220

如果有人好奇，这个问题似乎已在 SDK 3.0 中修复。现在关闭时键盘的渲染保持不变。

# c++ - 可以禁用“应用程序错误”对话框吗？

> ID：735170
> 
> 赞同：14
> 
> 时间：2009-04-09T17:32:32.137
> 
> 标签：c++, windows, debugging, memory, build-automation

我使用 Hudson 作为持续集成服务器来测试 C/C++ 代码。不幸的是，我在某处有一个导致内存损坏的错误，因此在某些 Windows 机器上，我有时会收到一个“应用程序错误”对话框，说明一条指令引用了无法读取的内存。弹出此对话框，基本上挂起测试运行，因为它需要手动干预。

有没有办法阻止此对话框出现，从而使测试运行简单地失败并在 Hudson 中报告为这样？

是否可以自动生成小型转储而不是显示对话框？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T18:06:34.663

1.  正如 Gently 先生建议的那样，使用“禁用错误报告”。另请参阅[此 PC World 文章](http://www.pcworld.com/article/108734/window_tips_xp_error_messagesyou_decide_what_to_report.html)。
2.  如果你的构建机器上碰巧有 MS Visual Studio，它会捕获应用程序错误并弹出一个对话框。要禁用这些对话框（以及 Visual Studio 的即时调试功能），请运行命令`drwtsn32.exe -i`将 Dr. Watson 设置为默认系统调试器。Watson 博士将生成核心转储并静默退出。（请参阅此 Microsoft 知识库文章： http: [//support.microsoft.com/kb/q121434/](http://support.microsoft.com/kb/q121434/)。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-14T10:21:41.663

You can also do something like this programaticaly using *SetErrorMode*. See [this](http://msdn.microsoft.com/en-us/library/ms680621(VS.85).aspx) article for more details.

A simple example of how to use it is to do the following:

```
SetErrorMode(GetErrorMode () | SEM_NOGPFAULTERRORBOX); 
```

The above 'ORs' the current mode with our desired addition.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-19T20:37:12.523

除了 rkb 说的，如果你运行的是 64 位的 Windows XP，还有两组值。`Wow6432Node`通常注册表位置中的那些和`HKLM`. 要同时更新两者，请同时`drwtsn32.exe -i`运行`%SYSTEMROOT%\system32`和`%SYSTEMROOT%\SysWOW64`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T17:40:14.677

通过以下方式禁用错误报告：

*   注册表编辑 - 将您的应用程序添加到 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PCHealth\ErrorReporting\ExclusionList，或者
*   右键单击我的电脑，转到高级选项卡，然后选择“禁用错误报告”选项，或者
*   您可以导航到管理工具中的服务控制台，找到错误报告服务，进入属性并禁用它

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T17:45:01.593

您可以使用各种 _CrtSetReport 函数来控制 C/C++ 运行时响应各种错误的方式（_CrtSetReportHook、_CrtSetReportMode、_CrtSetReportFile、_CrtSetReportHook2）

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-09T17:34:22.243

使用 try/catch 语句来捕获异常并按照您想要的方式处理它。

# asp.net-mvc - 通过 HtmlHelper 创建动态 RadEditor

> ID：735172
> 
> 赞同：2
> 
> 时间：2009-04-09T17:33:38.657
> 
> 标签：asp.net-mvc, telerik

我在我们的 ASP.NET MVC (RTM) 项目中使用 Telerik RadEditor (Q1 2009 SP1)。编辑器在呈现为具有静态 ID 的页面上的硬编码对象时效果很好。但是，当使用 HtmlHelper 扩展以通过传入 Id 进行动态创建时，它似乎将 html 呈现为标记的全部小写。HtmlHelper 对象是否天生就与此混淆？属性分别看起来大写和小写，但这看起来很奇怪。这是我的代码....提前致谢！

```
 <% if (placeholder.Type.ToLower() == "richtext") { %>
                    <%= Html.RadEditor("placeholder_" + placeholder.Name) %>
                <% } else { %>
                    <%= Html.TextBox("placeholder_" + placeholder.Name, null, new { @class = placeholder.Type }) %>
                <% } %> 
```

助手看起来像这样......

```
 public static string RadEditor(this HtmlHelper html, string Id)
    {
        var sb = new StringBuilder();

        sb.Append("<telerik:RadEditor ID='" + Id + "' Runat='server' DialogHandlerUrl='~/Telerik.Web.UI.DialogHandler.axd'>");
        sb.Append("<Content>");
        sb.Append("</Content>");
        sb.Append("</telerik:RadEditor>");

        return sb.ToString();
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T19:08:49.137

目前，如果没有带有 ScriptManager 的有效 Page 对象，您将无法渲染 RadEditor。我们（即 Telerik）计划在不久的将来添加对“独立”渲染的支持。应该在博客文章中宣布，敬请期待。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:58:13.203

问题是标签是服务器端控件。当您将其硬编码到您的页面中时，服务器端标记将被转换为 html。当您使用 htmlhelper 时，您正在输出 html，它不会作为服务器端标记处理。

如果你想做一些动态的事情，你应该使用 UserControl（.ascx 文件），然后使用 Html.RenderPartial 方法。

# iphone - 任何人都知道是否可以在 iTouch 压电扬声器上使用自定义声音？

> ID：735176
> 
> 赞同：0
> 
> 时间：2009-04-09T17:34:10.963
> 
> 标签：iphone

我显然不是在尝试播放全频谱音频，但是有没有办法自定义 iPhone/iTouch 系统警报声音以在压电扬声器上播放一点旋律？该功能显然存在，所以我想问题是Apple是否已将其提供给开发人员使用......

谢谢，-S

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T22:49:00.677

您可以在 0-2000 范围内使用很多预定义的声音。例如，键盘点击可以这样调用：

```
AudioServicesPlayAlertSound(1104); 
```

还有一种方法可以在第一代 iPod touch 上播放自定义旋律，但并不漂亮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:13:06.080

它不是。对不起。

您可以从应用程序中唯一可以做的事情是（实际上，您可以使用任何 SoundID）：

```
AudioServicesPlayAlertSound(kSystemSoundID_Vibrate); 
```

> **讨论**
> 
> 根据特定的 iPhone OS 设备，此功能会播放短促的声音并可能引发振动。调用此函数在各种 iPhone OS 设备上执行以下操作：
> 
> iPhone—播放指定的声音，如果用户已将设置应用程序配置为响铃振动，则调用振动。
> 
> iPod touch，原版 — 播放简短的提示旋律。
> 
> iPod touch，第 2 代—播放指定的声音。

# regex - 如何查找和更换这种情况

> ID：735179
> 
> 赞同：0
> 
> 时间：2009-04-09T17:34:25.627
> 
> 标签：regex

我在预定义的目录中有一些文本文件，这些文件以 *.edi 结尾，它们中的每一个都在其自身的一个单独的行中引用：

```
data_file   file_n.data 
```

我必须将每个 .edi 文件中的这一行转换为 sth like

```
data_file   'another_directory/file_n.data' 
```

我将在最后添加 'another_directory/ 和 '，因为数据将在另一个目录中。而且我有这样的 200 个 .edi 文件文件，手动处理它们很繁琐！正则表达式有什么帮助吗？顺便说一下，我使用 UltraEdit 引擎进行正则表达式。

```
a_dir/
   file1.edi
   file2.edi
   file3.edi
   ... 
```

每个文件在一行中引用：

```
data file   file_n.data 
```

变成：--->

```
data_file   'another_directory/file_n.data' 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T17:44:12.267

只需使用 Perl 正则表达式引擎从搜索菜单中替换文件：

寻找：

```
^(\s*data file\s+)(.+)$ 
```

代替：

```
\1'another_directory/\2' 
```

在文件/类型中：

```
*.edi 
```

目录：

```
<whatever the directory with all your edi files is> 
```

（在 UltraEdit 中测试，对我有用）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T17:37:00.037

用空格替换空格，然后`another_directory/`使用适当的元字符并转义 for `/`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:39:19.127

ultraedit 在文件中有查找和替换功能。如果您使用的是 v13+，它还具有 PE​​RL 兼容的正则表达式。

如果您打开 PERL 兼容的正则表达式，您可以使用：

对于查找内容：“ (file_\d+.data)”（不带双引号）

替换为：“'another_directory/$1'”（不带双引号）

对于旧式 UltraEdit 语法正则表达式，请使用：

查找内容：“ ^(file_[0-9]+^.data^)”

替换为：“'another_directory/^1'”

（没有引号，但前导空格很重要）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T17:45:11.827

如果我使用 RegexBuddy 的 GREP 工具，我会这样做：

**匹配模式：**

```
^(data file\s{3})(file_n\.data)$ 
```

**选项：**

*^$ 匹配换行符。*

**替换模式：**

```
\1'another_directory/\2' 
```

我认为 UltraEdit 的工作原理应该差不多。

# css - 在基于 ul 的导航栏中休息的最佳语义方式是什么？

> ID：735182
> 
> 赞同：1
> 
> 时间：2009-04-09T17:34:36.890
> 
> 标签：css, xhtml, semantics

我正在制作一个基于 ul 的水平导航栏，但我想在每个项目中有两个级别的标题，有点像这样：

```
 Nav item1            Nav item2             Nav item3
Nav item1 subtitle    Nav item2 subtitle    Nav item3 subtitle 
```

副标题的风格必须与主导航项目不同。我首先（天真地？）通过使用嵌套在 li 中的 ap 来做到这一点，但[W3C](http://validator.w3.org/)说我不能将 ap 嵌套在 li 中。

基本上，我试图避免使用 br，主要是因为这不是正确的语义，是吗？我会以错误的方式解决这个问题吗？

编辑：我应该添加，我想要导航项目和它的副标题在同一个锚标签中，因为它们是一个链接（我想要 a:hover 工作）。我认为这排除了在 li 中使用多个标题标签。

编辑2：答案很有用，谢谢。需要注意的一件有趣的事情 - 虽然有人说块跨度 == div，但这不是 W3C 验证器看到它的方式。即使跨度的显示：块，您始终可以将跨度嵌套在锚点内，但您不能例如在锚点内有显示：内联 h1，因为验证器不会同时检查 CSS 和 HTML 文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T17:48:53.550

您可以使用 a`span`因为它在语义上是惰性的，然后使用`display: block`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:22:37.493

我的观点是，这`<br />`在语义上适用于分隔标题和副标题的换行符。您可以使用`<span>`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-24T18:47:55.607

您应该使用字典列表而不是常规的无序列表。你的例子应该是。

```
<dl>
  <dt>
    Nav Item 1
  </dt>
  <dd>
    Nav Item 1 Subtitle
  </dd>
  <dt>
    Nav Item 2
  </dt>
  <dd>
    Nav Item 2 Subtitle
  </dd>
  <dt>
    Nav Item 2
  </dt>
  <dd>
    Nav Item 2 Subtitle
  </dd>
</dl> 
```

或者在 HTML5 或 XHTML 2.0 中你可以这样做

```
<dl>
  <di>
    <dt>
      Nav Item 1
    </dt>
    <dd>
      Nav Item 1 Subtitle
    </dd>
  </di>
  <di>
    <dt>
      Nav Item 2
    </dt>
    <dd>
      Nav Item 2 Subtitle
    </dd>
  </di>
  <di>
    <dt>
      Nav Item 2
    </dt>
    <dd>
      Nav Item 2 Subtitle
    </dd>
  </di>
</dl> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-09T17:53:18.033

1.  带显示的跨度：block==div
2.  <li> <h3>标题</h3> <h4>副标题</h4> </li>

（或任何其他可能的 H 标签。

# c# - C++ 是否支持单独的泛型方法而不是泛型类？

> ID：735184
> 
> 赞同：6
> 
> 时间：2009-04-09T17:35:39.667
> 
> 标签：c#, c++, templates

> **重要提示：**这个问题已经很长了，如果这是您第一次阅读此内容，我建议您从底部开始，因为解决方案是绕道而行的，但是代码有点臭。

在阅读了[关于模板的教程](http://www.cplusplus.com/doc/tutorial/templates/)后，我能够更改我现有的类以支持泛型类型。但是，许多对象已经依赖于此，因此我正在寻找一种使方法通用而不是整个类的方法。

我尝试了以下方法，但似乎不支持这种行为。

```
// foobar1.h
// Don't want the entire class to be generic.
//template<class T>
class FooBar1
{
public:
    template<class T> T Foo();
}

// foobar2.h
class FooBar2 : public FooBar1
{
}

// foobar1.cpp
template<class T>
T FooBar1::Foo()
{
    return something;
}

// test.cpp
FooBar1 fb1;
FooBar2 fb2 = fb1.Foo<FooBar2>(); 
```

这应该不起作用，还是我在其他地方感到困惑的错误？

> 未定义的引用`FooBar2 Foo<FooBar2>()`

为了从某种角度了解我想要实现的目标，这就是我在 C# 中的做法......

```
public class FooBar1
{
    public T Foo<T>()
        where T : FooBar1
    {
        return something;
    }
}

public class FooBar2 : FooBar1 { }

FooBar1 fb1 = new FooBar1();
FooBar2 fb2 = fb1.Foo<FooBar2>(); 
```

有什么办法可以在 C++ 中做类似的事情吗？

### 更新1：

刚刚更正了一些小的语法细节（我的意思是让 Foo 公开，并返回 T，而不是 FooBar2）。仍然出现编译器错误......当我删除模板行为时，错误消失了，到目前为止的答案说我正在做的事情是有效的......但如果是这样，那么为什么我仍然会收到错误？感谢您的回答！

### 更新 2：

乔希，这是实际的源代码（嗯，我认为相关的，请告诉我 - 如果你认为我跳过了重要的一点，请告诉我）。

```
// ImageMatrix.h
class ImageMatrix : public VImage
{
public:
    // ... various functions ...
    template<class T> T GetRotatedCopy(VDouble angle);
}

// ImageFilter.h
class ImageFilter : public ImageMatrix
{
    // ... various functions ...
}

// ImageMatrix.cpp
template<class T>
T ImageMatrix::GetRotatedCopy(VDouble angle)
{
    // ... create a new instance of ImageMatrix and return it.
}

// ImageProcessor.cpp
ImageFilter filter2 = filterPrototype.GetRotatedCopy<ImageFilter>(90); 
```

这是实际的编译器错误：

> /home/nick/Projects/ViMRID/vimrid/Debug/libvimrid.so: 未定义对 `vimrid::imaging::processing::ImageFilter vimrid::imaging::ImageMatrix::GetRotatedCopy(double)' 的引用

### 更新 3：

~~顺便说一句，除了实现线之外的所有东西都位于库中；所以它是从一个单独的二进制文件中调用的......这有关系吗？~~更正; 它都在同一个库中。但是，所有块都是不同的文件。

### 更新 4：

当我注释掉实现行（ImageFilter filter2 = filterPrototype ...）时，它构建得很好，所以似乎是这条线导致了它......

### 更新 5（已解决？）：

~~仍然有问题......这可能是命名空间的问题吗？~~从头开始，好吧，我现在已经掌握了模板的概念！:) 模板定义必须与声明一起在标题中（对吗？） - 所以现在我已经将声明移到`ImageMatrix.h`，一切都可以编译。但是，我不得不使用`dynamic_cast`它来让它工作。这是正确的吗？如果我走错了，请纠正我！

```
// This is in the header file!
// Help!!! This looks really really smelly...
template<class T>
T ImageMatrix::GetRotatedCopy(VDouble angle)
{
    ImageMatrix image = _getRotatedCopy(angle);
    ImageMatrix *imagePtr = &image;
    return *dynamic_cast<T*>(imagePtr);
} 
```

### 更新 6：

参考更新5，当我不使用dynamic_cast时......

```
template<class T>
T ImageMatrix::GetRotatedCopy(VDouble angle)
{
    ImageMatrix image = _getRotatedCopy(angle);
    ImageMatrix *imagePtr = &image;
    //return *dynamic_cast<T*>(imagePtr);
    return *imagePtr;
} 
```

...我收到此错误...

```
../src/imaging/processing/../ImageMatrix.h: In member function ‘T vimrid::imaging::ImageMatrix::GetRotatedCopy(vimrid::VDouble) [with T = vimrid::imaging::processing::ImageFilter]’:
../src/imaging/processing/ImageProcessor.cpp:32:   instantiated from here
../src/imaging/processing/../ImageMatrix.h:45: error: conversion from ‘vimrid::imaging::ImageMatrix’ to non-scalar type ‘vimrid::imaging::processing::ImageFilter’ requested
make: *** [src/imaging/processing/ImageProcessor.o] Error 1 
```

### 更新 7：

另外，如果我不在更新 6 中使用所有那些臭代码......

```
class ImageMatrix : public VImage
{
public:
    template<class T> T GetRotatedCopy(VDouble angle);
private:
    ImageMatrix _getRotatedCopy(VDouble angle);
};

template<class T>
T ImageMatrix::GetRotatedCopy(VDouble angle)
{
    return _getRotatedCopy(angle);
} 
```

...我收到与更新 6 中相同的错误。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T17:42:37.823

是的，你很接近，试试这个：

```
class FooBar1
{
public:
    template<class T> T Foo();
};

class FooBar2 : public FooBar1
{
};

template<class T>
T FooBar1::Foo()
{
    return T();
}

int main()
{
   FooBar1 fb1;
   FooBar2 fb2 = fb1.Foo<FooBar2>();
} 
```

您遇到的问题是您指定了`FooBar1::Foo()`as的返回类型`FooBar2`，您应该将它作为 just `T`。

如果你想为 FooBar2 做一些特定的事情，你可以专门化 FooBar2：

```
template<>
FooBar2 FooBar1::Foo<FooBar2>()
{
    return FooBar2();
} 
```

编辑：听起来您在编译器找不到模板化 GetRotatedCopy 的定义时遇到问题。C++ 中的模板比较挑剔，通常的做法是将整个模板实现放在一个头文件中。你可以试试这个：

```
class ImageMatrix : public VImage
{
public:
    // ... various functions ...
    template<class T> T GetRotatedCopy(VDouble angle)
    {
       // ... create a new instance of ImageMatrix and return it.
    }
}; 
```

编辑：我找不到 gcc 文档，但这里是[微软](http://msdn.microsoft.com/en-us/library/by56e477.aspx)关于显式模板实例化和库的文档，它对正在发生的事情有所了解。您可能希望像我之前建议的那样在标头中包含实现，或者在库中调用 GetRotatedCopy，或者在库中显式实例化它。有关语法，请参见下面[的 veefu 答案](https://stackoverflow.com/questions/735184/does-c-support-individual-generic-methods-rather-than-generic-classes/735336#735336)。

这与 C# 的工作方式不同的原因是，与 C# 不同，C++ 中的模板实际上为模板参数的每个不同组合创建了一个全新的类/函数。eg`vector<int>`是与 . 完全不同的类（具有不同的编译方法集）`vector<string>`。请参阅[凯文的答案](https://stackoverflow.com/questions/735184/does-c-support-individual-generic-methods-rather-than-generic-classes/735460#735460)以获得更好的解释。

至于当您不使用模板时错误消失，这实际上并不能告诉您太多，因为在您实际实例化模板之前，它不会

**重新更新 5,6,7**

您的 dynamic_cast 不起作用，您只能在指针实际指向您要转换的类的实例时使用它。（它的工作方式类似于`as`C# 中的运算符）。

我现在怀疑，您想要的是[CRTP](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)。您从 ImageFilter 的实例开始，并希望在其上使用基类方法，并取回 ImageFilter 的新副本。尝试以下方式：

```
template <class T>
class ImageMatrix
{
public:
    T GetRotatedMatrix()
    {
        return T();
    }
};

class ImageFilter : public ImageMatrix<ImageFilter>
{
};

int main()
{
    ImageFilter filterPrototype;
    ImageFilter otherFilter = filterPrototype.GetRotatedMatrix();
} 
```

否则，如果您确实想从 ImageMatrix 开始并将其转换为 ImageFilter，则必须在 ImageFilter 上添加一个采用 ImageMatrix 的构造函数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T18:51:10.903

除了 veefu 所说的，C++ 中的模板不像 C# 泛型（该主题被标记为 C#，所以我假设您正在比较它们）。在 C++ 中，实际代码不是在运行时生成的，而只是在编译时生成的，所以如果你有一个带有模板的类，你要么必须将它放在头文件中，要么必须确切地实例化它存在，否则您（通常）会收到链接器错误，因为它无法找到您要查找的内容，因为它从未真正制作过。在制作模板时，编译器实际上会为您的模板类制作尽可能多的“副本”，因为您已经实例化了该类的不同“种类”。所以从 STL 中，如果你有`Vector<int>`, `Vector<String>`, 和`Vector<char>`，编译器实际上输出了 3 个不同类的代码。这就是为什么模板类几乎总是在头文件中而不是在编译库中定义的原因，因为编译器需要生成您正在使用的内容。

这与使用引用的 C#（和 Java IIRC）中的泛型形成对比，您只能使用您指定要从对象继承或从对象继承的泛型。您需要声明某些东西实现了 IComparable 以使用其中的任何方法，或者您对其施加的任何其他限制。本质上，当您使用泛型时，它是一种确保类型安全的编译时技巧，但实际上并没有在类中编译。C++ 不同，如果你有一个带有模板字段的类，那么根据该类的大小，生成的类会更大或更小，这会影响对象的实际大小。

我希望这是有道理的，虽然它有点长。我实际上不知道您可以像 mch 显示的那样执行模板化功能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T17:45:41.717

您遇到的错误可能是由于您的示例代码中的其他问题。这是一个模板化成员和自由函数的例子，可以用 G++ 很好地编译。

```
// Don't want the entire class to be generic.
//template<class T>
class FooBar1
{
public:
    template<class T> T Foo();
};

class FooBar2 : public FooBar1
{
};

template<class T>
T FooBar1::Foo()
{
    return T();
}

template <class T>
T FreeFunction()
{
    return T();
}

int main()
{
    FooBar1 fb1;
    FooBar2 fb2 = fb1.Foo<FooBar2>();

    FooBar2 fb3 = FreeFunction<FooBar2>();
} 
```

在 C++ 中，通常在头文件中包含模板类的声明和定义。这样做可确保编译器为模板化函数或类生成代码，并在编译时填充特定的模板参数。

可以将声明放在头文件中，将定义放在 cpp 文件中。如果您正在模板化的已知类型数量较少，则此方法可以正常工作。有必要使用您希望使用的类型显式实例化 cpp 文件中的类或函数，以便编译器可以正确生成代码。

**头文件：**

```
template <class T>
T DoSomething(); 
```

**cp文件：**

```
template <class T>
T DoSomething();
{
    return T();
}

template FooBar1 DoSomething<FooBar1>();
template FooBar2 DoSomething<FooBar2>(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:17:18.380

我认为更新 3 和 4 放弃了它，但如果不知道您的项目布局，就很难分辨。

如果您尝试从库中公开模板以从另一个位置调用，则必须

A：在你的库的头文件中包含模板定义

或者

B：显式实例化库中的模板代码，以便后面的代码有一个实现可以链接到

```
template<class T>
T ImageMatrix::GetRotatedCopy(VDouble angle)
{
  // ... create a new instance of ImageMatrix and return it.
}
// Add the following line
template ImageFilter ImageMatrix::GetRotatedCopy<ImageFilter>(VDouble); 
```

我认为这应该可以解决问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T20:14:05.823

可能是这样

```
template<class T>
T FooBar1::Foo()
{
    return something;
} 
```

是否在调用文件以外的 .cpp 文件中？如果是这样，这将导致您的错误。该实现必须在与调用相同的编译单元（.cpp 文件 + 它的所有包含）中可用。

所以通常模板实现放在声明所在的头文件中。

你应该检查一下这个。

# c# - 如何向 ASP.NET 控件声明中的属性添加换行符？

> ID：735187
> 
> 赞同：1
> 
> 时间：2009-04-09T17:35:58.447
> 
> 标签：c#, asp.net, vb.net

我有一个 sql 数据源，我有一个很长的 SQL 字符串。我想在我的 sql 中添加换行符，但 Visual Studio 似乎不喜欢换行符。我将如何插入换行符？

例子

```
<asp:SqlDataSource ID="SqlDataSource1" runat="server"         
        ProviderName="System.Data.SqlClient" 
        SelectCommand="select aci.ACIOI, aci.AccountNum, (select count(r.OI) from Report r where aci.ACIOI = r.ACIOI) as ReportCount, ci.Name, aci.BusinessName, ci.[Address] As StreetAddress, ci.Town, ci.Zip, ci.Phone  from AdditionalCustomerInformation aci  left join CustomerInformation ci on ci.ACI_OI = aci.ACIOI where (select count(r.OI) from Report r where aci.ACIOI = r.ACIOI) >= 1" 
        >        
        </asp:SqlDataSource> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T17:59:55.037

这对我来说编译得很好：

```
<asp:SqlDataSource ID="SqlDataSource1" runat="server" ProviderName="System.Data.SqlClient" SelectCommand="select aci.ACIOI, 
aci.AccountNum, (select count(r.OI) from Report r where aci.ACIOI = r.ACIOI) as ReportCount,
ci.Name, aci.BusinessName, 
ci.[Address] As StreetAddress, ci.Town, 
ci.Zip, ci.Phone 
from AdditionalCustomerInformation aci left join CustomerInformation ci on ci.ACI_OI = aci.ACIOI 
where (select count(r.OI) from Report r where aci.ACIOI = r.ACIOI) >=1"> </asp:SqlDataSource> 
```

...这是合乎逻辑的。只要整个 SQL 语句包含在`SelectCommand`属性的引号中，编译器就不会关心您的标记是否被分成单独的行。

**它出现的问题是因为`>`您的 SQL 语句中的符号。**有两种方法可以逃避该符号。您可以简单地使用`&gt;`HTML 实体，如下所示：

```
SelectCommand = "SELECT.... &gt;= 1" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:05:35.710

需要 HTML 转义。将您的 > 替换为 >

同样，< 变为 <

# c# - 是否可以将调用的外部程序的权限限制为只读文件操作？

> ID：735193
> 
> 赞同：0
> 
> 时间：2009-04-09T17:36:50.007
> 
> 标签：c#, .net, security, clr

我使用下一个代码：

```
...
ProcessStartInfo processStartInfo = new ProcessStartInfo();
...
Process process = new Process();
process.StartInfo = processStartInfo;
bool processStarted = process.Start();
... 
```

.Net 中是否可以限制被调用的外部程序的权限为只读文件操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:45:28.207

[我在 BCL 中知道的最佳选择是使用此 Process.Start() 重载](http://msdn.microsoft.com/en-us/library/sxf2saat.aspx)在具有有限凭据的用户帐户下启动进程。

为了完全控制，您可以使用 P/Invoke 并调用[CreateProcess](http://msdn.microsoft.com/en-us/library/ms682425(VS.85).aspx)，适当地设置安全属性（特别是安全属性中的安全描述符）以根据需要限制进程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:06:40.417

简而言之，没有。没有可靠的方法来启动任何给定的进程并确保它只能读取但不能写入文件。

当您创建一个进程时，它访问文件的能力实际上是由操作系统控制的。即通过与进程关联的各种令牌及其各自的访问级别。这是一个 Win32 安全概念。

现在，您可以使用完全独立的凭据轻松启动流程。通过对环境进行足够的控制，您可以确保这些特定凭据不能在磁盘上的任何位置写入，但这将非常非常极端，并且需要的工作比我猜想的要多得多。

CLR 安全模型对您没有帮助。当然，您可以玩弄并确保纯托管进程无法访问文件。但是，您不能保证 Process.Start 实际上正在启动托管进程，或者托管进程不会因此 PInvoke 进入写入文件的本机代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-07T23:11:04.560

如果操作正确，您可以将 DenyOnly SID 添加到用于通过 P/Invoke 创建新进程的进程令牌。

# java - 如何使用 bulkUpdate 批量删除

> ID：735201
> 
> 赞同：8
> 
> 时间：2009-04-09T17:38:09.440
> 
> 标签：java, hibernate, spring, orm

我有一个通用的用户/角色设置，带有一个 user_role 连接表。我正在尝试使用 Spring 的 HibernateTemplate 批量删除所有锁定的用户，如下所示：

```
getHibernateTemplate().bulkUpdate("delete from User where locked=?", true); 
```

如果被删除的用户没有任何角色（user_role 表中没有记录），那么一切正常；但是，如果用户确实有角色记录，我会收到以下错误：

> 违反完整性约束 - 找到子记录

角色在 User.java 中定义如下：

```
@ManyToMany(fetch = FetchType.EAGER)
@JoinTable(name = "user_role", joinColumns = { @JoinColumn(name = "user_id") }, inverseJoinColumns = @JoinColumn(name = "role_id"))
private Set<Role> roles = new HashSet<Role>(); 
```

那么，即使用户有子记录，如何批量删除用户呢？谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-07-21T21:57:43.017

根据 JPA 规范，批量删除操作不会级联到**相关实体：**

> ### 4.10 批量更新和删除操作
> 
> 批量更新和删除操作适用于单个实体类（连同其子类，如果有）的实体。在 FROM 或 UPDATE 子句中只能指定一种实体抽象模式类型。
> 
> ...
> 
> 删除操作仅适用于指定类及其子类的实体。**它不会级联到相关实体**。

但是，我希望 JPA 提供程序能够处理连接表。可悲的是，Hibernate 没有，这记录在[HHH-1917](http://opensource.atlassian.com/projects/hibernate/browse/HHH-1917)中。恐怕您将不得不依靠本机 SQL 自己清理连接表或在模式中使用级联外键。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:05:59.140

应用程序级级联（通过休眠注释或 JPA 注释进行级联）仅在实际从 db 加载实际实体时才有效。当您使用带有 HQL 的 hibernate 模板时，您会注意到实体没有加载，并且 HQL 直接转换为要执行的 SQL。

如果要批量删除，则必须在删除父表数据之前使用 HQL 查询删除所有相关表（即角色）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:46:15.053

我不完全确定，因为我很难重现这个问题，但我认为你可能需要在你的 @ManyToMany 中添加一个级联

```
@ManyToMany(cascade = CascadeType.ALL) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-29T10:57:01.520

由于您要批量删除具有 ManyToMany 相关项目的内容，因此您首先必须删除关系（在连接表中），或者执行循环并为每个项目手动删除（疯狂且过于繁重）。

因此，由于 JPQL 不允许这样做，一种可能的方法是进行**原生 SQL 查询**以删除相关表中所需的 id，然后进行批量删除。

# c++ - 将 C++ 中的字符串转换为大写

> ID：735204
> 
> 赞同：303
> 
> 时间：2009-04-09T17:38:23.653
> 
> 标签：c++, string

如何将字符串转换为大写。我从谷歌搜索中找到的例子只需要处理字符。

* * *

## 回答 #1

> 赞同：543
> 
> 时间：2009-04-09T17:41:53.597

```
#include <algorithm>
#include <string>

std::string str = "Hello World";
std::transform(str.begin(), str.end(),str.begin(), ::toupper); 
```

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2009-04-09T17:47:37.453

[提升字符串算法](https://www.boost.org/doc/libs/1_73_0/boost/algorithm/string/case_conv.hpp)：

```
#include <boost/algorithm/string.hpp>
#include <string>

std::string str = "Hello World";

boost::to_upper(str);

std::string newstr = boost::to_upper_copy<std::string>("Hello World"); 
```

* * *

## 回答 #3

> 赞同：112
> 
> 时间：2013-07-22T17:20:24.760

使用 C++11 和 toupper() 的简短解决方案。

```
for (auto & c: str) c = toupper(c); 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2016-05-11T00:24:24.760

**对于 ASCII 字符集， **此问题可通过 SIMD 向量化。****

 *** * *

### 加速比较：

`-O3 -march=native`在 Core2Duo (Merom) 上使用 x86-64 gcc 5.2 进行初步测试。相同的 120 个字符的字符串（混合小写和非小写 ASCII），在循环中转换 40M 次（没有跨文件内联，因此编译器无法优化或将其中任何一个提升出循环）。相同的源缓冲区和目标缓冲区，因此没有 malloc 开销或内存/缓存影响：数据在 L1 缓存中始终是热的，而且我们完全受 CPU 限制。

*   `boost::to_upper_copy<char*, std::string>()`: **198.0s** . 是的，Ubuntu 15.10 上的 Boost 1.58 真的这么慢。我在调试器中分析并单步执行了 asm，这真的*非常*糟糕：每个字符都有一个 locale 变量的 dynamic_cast ！！！（dynamic_cast 需要多次调用 strcmp）。这发生在`LANG=C`和`LANG=en_CA.UTF-8`。

    我没有使用除 std::string 之外的 RangeT 进行测试。 [也许另一种形式的`to_upper_copy`](http://www.boost.org/doc/libs/1_60_0/doc/html/string_algo/reference.html#header.boost.algorithm.string.case_conv_hpp)优化更好，但我认为它总是`new`/`malloc`空间用于副本，因此更难测试。也许我所做的事情与正常的用例不同，也许通常停止的 g++ 可以将语言环境设置从每个字符循环中提升出来。我从 a 读取`std::string`并写入 a的循环`char dstbuf[4096]`对于测试是有意义的。

*   循环调用 glibc `toupper`: **6.67s** （不过，不检查`int`潜在多字节 UTF-8 的结果。这对土耳其语很重要。）

*   仅 ASCII 循环：**8.79 秒** （以下结果的我的基线版本。）显然，查表比 a 更快`cmov`，无论如何，表在 L1 中都很热。
*   仅 ASCII 自动矢量化：**2.51s**。（120 个字符介于最坏情况和最佳情况之间，见下文）
*   仅 ASCII 手动矢量化：**1.35s**

另请参阅[this question about `toupper()`be slow on Windows when a locale is set](https://stackoverflow.com/questions/36686381/windows-c-runtime-toupper-slow-when-locale-set)。

* * *

我很震惊 Boost 比其他选项慢一个数量级。我仔细检查了我是否已`-O3`启用，甚至单步执行 asm 以查看它在做什么。与 clang++ 3.8 的速度几乎完全相同。它在每个字符循环内有巨大的开销。`perf record`/结果`report`（对于`cycles`perf 事件）是：

```
 32.87%  flipcase-clang-  libstdc++.so.6.0.21   [.] _ZNK10__cxxabiv121__vmi_class_type_info12__do_dyncastElNS_17__class_type_info10__sub_kindEPKS1_PKvS4_S6_RNS1_16
  21.90%  flipcase-clang-  libstdc++.so.6.0.21   [.] __dynamic_cast                                                                                                 
  16.06%  flipcase-clang-  libc-2.21.so          [.] __GI___strcmp_ssse3                                                                                            
   8.16%  flipcase-clang-  libstdc++.so.6.0.21   [.] _ZSt9use_facetISt5ctypeIcEERKT_RKSt6locale                                                                     
   7.84%  flipcase-clang-  flipcase-clang-boost  [.] _Z16strtoupper_boostPcRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEE                                   
   2.20%  flipcase-clang-  libstdc++.so.6.0.21   [.] strcmp@plt                                                                                                     
   2.15%  flipcase-clang-  libstdc++.so.6.0.21   [.] __dynamic_cast@plt                                                                                             
   2.14%  flipcase-clang-  libstdc++.so.6.0.21   [.] _ZNKSt6locale2id5_M_idEv                                                                                       
   2.11%  flipcase-clang-  libstdc++.so.6.0.21   [.] _ZNKSt6locale2id5_M_idEv@plt                                                                                   
   2.08%  flipcase-clang-  libstdc++.so.6.0.21   [.] _ZNKSt5ctypeIcE10do_toupperEc                                                                                  
   2.03%  flipcase-clang-  flipcase-clang-boost  [.] _ZSt9use_facetISt5ctypeIcEERKT_RKSt6locale@plt                                                                 
   0.08% ... 
```

* * *

# 自动矢量化

只有在循环之前知道迭代计数时，Gcc 和 clang 才会自动矢量化循环。（即像普通 C 实现这样的搜索循环`strlen`不会自动矢量化。）

因此，对于小到足以放入缓存的字符串，我们从第一次开始处理约 128 个字符的字符串得到了显着的加速`strlen`。`std::string`这对于显式长度的字符串（如 C++ ）不是必需的。

```
// char, not int, is essential: otherwise gcc unpacks to vectors of int!  Huge slowdown.
char ascii_toupper_char(char c) {
    return ('a' <= c && c <= 'z') ? c^0x20 : c;    // ^ autovectorizes to PXOR: runs on more ports than paddb
}

// gcc can only auto-vectorize loops when the number of iterations is known before the first iteration.  strlen gives us that
size_t strtoupper_autovec(char *dst, const char *src) {
    size_t len = strlen(src);
    for (size_t i=0 ; i<len ; ++i) {
        dst[i] = ascii_toupper_char(src[i]);  // gcc does the vector range check with psubusb / pcmpeqb instead of pcmpgtb
    }
    return len;
} 
```

任何体面的 libc 都将具有`strlen`比一次循环一个字节快得多的效率，因此单独的矢量化 strlen 和 toupper 循环更快。

基线：动态检查终止 0 的循环。

在 Core2 (Merom) 2.4GHz 上进行 40M 次迭代的次数。海合会 5.2 `-O3 -march=native`. （Ubuntu 15.10）。 `dst != src`（所以我们制作了一个副本），但它们不重叠（并且不在附近）。两者都对齐。

*   15 个字符的字符串：基线：1.08 秒。自动检测：1.34s
*   16 个字符的字符串：基线：1.16 秒。自动检测：1.52s
*   127 个字符字符串：基线：8.91 秒。autovec: 2.98s // 非向量清理有 15 个字符要处理
*   128 个字符字符串：基线：9.00s。自动检测：2.06s
*   129 个字符字符串：基线：9.04 秒。autovec: 2.07s // 非向量清理有 1 个字符要处理

有些结果与 clang 有点不同。

调用该函数的微基准循环位于单独的文件中。否则它内联`strlen()`并被提升出循环，它运行得更快，尤其是。对于 16 个字符字符串（0.187 秒）。

这具有 gcc 可以为任何架构自动矢量化它的主要优点，但主要缺点是它对于通常常见的小字符串情况较慢。

* * *

所以有很大的加速，但是编译器自动矢量化并不能产生很好的代码，尤其是。用于清理最后最多 15 个字符。

# 使用 SSE 内在函数进行手动矢量化：

基于我的[case-flip 函数](https://stackoverflow.com/a/35936844/224132)，它可以反转每个字母字符的大小写。它利用了“无符号比较技巧”，您可以`low < a && a <= high`通过范围移动来进行单个无符号比较，以便任何小于`low`的值都换成大于的值`high`。（这在`low`相距`high`不太远的情况下有效。）

SSE 只有一个有符号比较-更大，但我们仍然可以通过范围移动到有符号范围的底部来使用“无符号比较”技巧：减去 'a'+128，因此字母字符的范围从 -128 到 -128 +25 (-128+'z'-'a')

请注意，对于 8 位整数，加 128 和减 128 是一回事。进位无处可去，所以它只是异或（无进位加法），翻转高位。

```
#include <immintrin.h>

__m128i upcase_si128(__m128i src) {
    // The above 2 paragraphs were comments here
    __m128i rangeshift = _mm_sub_epi8(src, _mm_set1_epi8('a'+128));
    __m128i nomodify   = _mm_cmpgt_epi8(rangeshift, _mm_set1_epi8(-128 + 25));  // 0:lower case   -1:anything else (upper case or non-alphabetic).  25 = 'z' - 'a'

    __m128i flip  = _mm_andnot_si128(nomodify, _mm_set1_epi8(0x20));            // 0x20:lcase    0:non-lcase

    // just mask the XOR-mask so elements are XORed with 0 instead of 0x20
    return          _mm_xor_si128(src, flip);
    // it's easier to xor with 0x20 or 0 than to AND with ~0x20 or 0xFF
} 
```

鉴于此函数适用于一个向量，我们可以在循环中调用它来处理整个字符串。由于我们已经针对 SSE2，我们可以同时进行向量化的字符串结尾检查。

在做 16B 的向量之后，我们还可以更好地“清理”最后剩下的 15 个字节：大写是幂等的，所以重新处理一些输入字节就可以了。我们对源的最后 16B 进行非对齐加载，并将其存储到与循环中最后 16B 存储重叠的 dest 缓冲区中。

唯一不起作用的是当整个字符串低于 16B 时：即使是`dst=src`，非原子读取-修改-写入与根本*不*接触某些字节是不同的，并且可能会破坏多线程代码。

为此，我们有一个标量循环，也可以`src`对齐。由于我们不知道终止 0 将在哪里，因此未对齐的加载`src`可能会进入下一页并出现段错误。如果我们需要对齐的 16B 块中的任何字节，加载整个对齐的 16B 块总是安全的。

完整来源：[在 github gist](https://gist.github.com/pcordes/815c3ed8752a24c64d427bcbfd1ee1c3)中。

```
// FIXME: doesn't always copy the terminating 0.
// microbenchmarks are for this version of the code (with _mm_store in the loop, instead of storeu, for Merom).
size_t strtoupper_sse2(char *dst, const char *src_begin) {
    const char *src = src_begin;
    // scalar until the src pointer is aligned
    while ( (0xf & (uintptr_t)src) && *src ) {
        *(dst++) = ascii_toupper(*(src++));
    }

    if (!*src)
        return src - src_begin;

    // current position (p) is now 16B-aligned, and we're not at the end
    int zero_positions;
    do {
        __m128i sv = _mm_load_si128( (const __m128i*)src );
        // TODO: SSE4.2 PCMPISTRI or PCMPISTRM version to combine the lower-case and '\0' detection?

        __m128i nullcheck = _mm_cmpeq_epi8(_mm_setzero_si128(), sv);
        zero_positions = _mm_movemask_epi8(nullcheck);
        // TODO: unroll so the null-byte check takes less overhead
        if (zero_positions)
            break;

        __m128i upcased = upcase_si128(sv);   // doing this before the loop break lets gcc realize that the constants are still in registers for the unaligned cleanup version.  But it leads to more wasted insns in the early-out case

        _mm_storeu_si128((__m128i*)dst, upcased);
        //_mm_store_si128((__m128i*)dst, upcased);  // for testing on CPUs where storeu is slow
        src += 16;
        dst += 16;
    } while(1);

    // handle the last few bytes.  Options: scalar loop, masked store, or unaligned 16B.
    // rewriting some bytes beyond the end of the string would be easy,
    // but doing a non-atomic read-modify-write outside of the string is not safe.
    // Upcasing is idempotent, so unaligned potentially-overlapping is a good option.

    unsigned int cleanup_bytes = ffs(zero_positions) - 1;  // excluding the trailing null
    const char* last_byte = src + cleanup_bytes;  // points at the terminating '\0'

    // FIXME: copy the terminating 0 when we end at an aligned vector boundary
    // optionally special-case cleanup_bytes == 15: final aligned vector can be used.
    if (cleanup_bytes > 0) {
        if (last_byte - src_begin >= 16) {
            // if src==dest, this load overlaps with the last store:  store-forwarding stall.  Hopefully OOO execution hides it
            __m128i sv = _mm_loadu_si128( (const __m128i*)(last_byte-15) ); // includes the \0
            _mm_storeu_si128((__m128i*)(dst + cleanup_bytes - 15), upcase_si128(sv));
        } else {
            // whole string less than 16B
            // if this is common, try 64b or even 32b cleanup with movq / movd and upcase_si128
#if 1
            for (unsigned int i = 0 ; i <= cleanup_bytes ; ++i) {
                dst[i] = ascii_toupper(src[i]);
            }
#else
            // gcc stupidly auto-vectorizes this, resulting in huge code bloat, but no measurable slowdown because it never runs
            for (int i = cleanup_bytes - 1 ;  i >= 0 ; --i) {
                dst[i] = ascii_toupper(src[i]);
            }
#endif
        }
    }

    return last_byte - src_begin;
} 
```

在 Core2 (Merom) 2.4GHz 上进行 40M 次迭代的次数。海合会 5.2 `-O3 -march=native`. （Ubuntu 15.10）。 `dst != src`（所以我们制作了一个副本），但它们不重叠（并且不在附近）。两者都对齐。

*   15 个字符的字符串：基线：1.08 秒。自动检测：1.34 秒。手动：1.29s
*   16 个字符的字符串：基线：1.16 秒。自动检测：1.52 秒。手动：0.335s
*   31个字符字符串：手动：0.479s
*   127 个字符字符串：基线：8.91 秒。自动检测：2.98 秒。手动：0.925s
*   128 个字符字符串：基线：9.00s。自动检测：2.06 秒。手动：0.931s
*   129 个字符字符串：基线：9.04 秒。自动检测：2.07 秒。手动：1.02s

（实际上`_mm_store`是在循环中计时，而不是`_mm_storeu`，因为即使地址对齐，在 Merom 上 storeu 的速度也较慢。在 Nehalem 及更高版本上都很好。我现在也将代码保持原样，而不是修复复制失败在某些情况下终止 0，因为我不想重新计时所有内容。）

因此，对于长度超过 16B 的短字符串，这比自动矢量化要快得多。长度小于矢量宽度不存在问题。由于存储转发停顿，它们在就地操作时可能是一个问题。（但请注意，处理我们自己的输出而不是原始输入仍然可以，因为 toupper 是幂等的）。

对于不同的用例，有很大的调整空间，这取决于周围的代码想要什么，以及目标微架构。让编译器为清理部分发出漂亮的代码是很棘手的。使用`ffs(3)`（在 x86 上编译为 bsf 或 tzcnt）似乎很好，但显然需要重新考虑这一点，因为我在写下大部分答案后发现了一个错误（参见 FIXME 评论）。

**甚至更小的字符串的向量加速都可以通过加载/存储`movq`来获得。`movd`根据您的用例进行定制。**

* * *

## UTF-8：

我们可以检测到我们的向量何时有任何设置了高位的字节，在这种情况下，我们可以回退到该向量的标量 utf-8 感知循环。该`dst`点可以与指针前进不同的量`src`，但是一旦我们回到对齐的`src`指针，我们仍然只是对`dst`.

对于 UTF-8 文本，但主要由 UTF-8 的 ASCII 子集组成，这可能很好：在常见情况下具有高性能，在所有情况下都具有正确的行为。但是，当有很多非 ASCII 码时，它可能会比一直停留在标量 UTF-8 感知循环中更糟糕。

如果不利因素很大，以牺牲其他语言为代价提高英语速度并不是一个面向未来的决定。

* * *

## 区域感知：

在土耳其语言环境 ( `tr_TR`) 中，正确的结果`toupper('i')`是`'İ'`(U0130)，而不是`'I'`(plain ASCII)。请参阅[Martin Bonner](https://stackoverflow.com/questions/36686381/windows-c-runtime-toupper-slow-when-locale-set#comment60962664_36686381)`tolower()`对有关在 Windows 上运行缓慢的问题的评论。

我们还可以检查异常列表并回退到那里的标量，例如多字节 UTF8 输入字符。

有了这么多的复杂性，SSE4.2`PCMPISTRM`或其他东西可能可以一次性完成很多我们的检查。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2009-04-09T17:42:12.943

```
struct convert {
   void operator()(char& c) { c = toupper((unsigned char)c); }
};

// ... 
string uc_str;
for_each(uc_str.begin(), uc_str.end(), convert()); 
```

**注意：**顶级解决方案的几个问题：

> **21.5 空终止序列实用程序**
> 
> 这些头文件的内容应与标准 C 库头文件 <ctype.h>、<wctype.h>、<string.h>、<wchar.h> 和 <stdlib.h> [...]

*   这意味着`cctype`成员很可能是不适合在标准算法中直接使用的宏。

*   同一个例子的另一个问题是它没有强制转换参数或验证这是非负的；`char`这对于签署plain 的系统尤其危险。（原因是：如果这是作为宏实现的，它可能会使用查找表，并且您的参数索引到该表中。负索引将为您提供 UB。）

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2011-03-07T17:23:57.860

```
string StringToUpper(string strToConvert)
{
   for (std::string::iterator p = strToConvert.begin(); strToConvert.end() != p; ++p)
       *p = toupper(*p);

   return p;
} 
```

或者，

```
string StringToUpper(string strToConvert)
{
    std::transform(strToConvert.begin(), strToConvert.end(), strToConvert.begin(), ::toupper);

    return strToConvert;
} 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2016-01-22T12:34:21.843

以下对我有用。

```
#include <algorithm>
void  toUpperCase(std::string& str)
{
    std::transform(str.begin(), str.end(), str.begin(), ::toupper);
}

int main()
{
   std::string str = "hello";
   toUpperCase(&str);
} 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-04-09T17:58:58.440

字符串中有 ASCII 或国际字符吗？

如果是后一种情况，“大写”就没那么简单了，还要看使用的字母表。有两院制和一院制字母表。只有两院字母的大小写字符不同。此外，还有复合字符，如拉丁大写字母 'DZ' (\u01F1 'DZ') 使用所谓的*标题大小写*。这意味着只有第一个字符 (D) 被更改。

我建议您查看[ICU](http://site.icu-project.org/)以及 Simple 和 Full Case Mappings 之间的区别。这可能会有所帮助：

[http://userguide.icu-project.org/transforms/casemappings](http://userguide.icu-project.org/transforms/casemappings)

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2012-08-22T08:44:04.017

**如果您只使用 ASCII 字符**，则速度更快：

```
for(i=0;str[i]!=0;i++)
  if(str[i]<='z' && str[i]>='a')
    str[i]+='A'-'a'; 
```

请注意，此代码**运行速度更快，但仅适用于 ASCII**，不是“抽象”解决方案。

**其他 UTF8 字母的扩展版本**：

```
...
if(str[i]<='z' && str[i]>='a') //is latin
    str[i]+='A'-'a';
else if(str[i]<='я' && str[i]>='а') //cyrillic
    str[i]+='Я'-'я'
else if(str[i]<='ω' && str[i]>='α') //greek
    str[i]+='Ω'-'ω'
//etc... 
```

如果您需要完整的 UNICODE 解决方案或更传统和抽象的解决方案，请寻求其他答案并使用 C++ 字符串的方法。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2011-06-08T16:04:09.353

只要您对仅 ASCII 没问题并且可以提供指向 RW 内存的有效指针，C 中有一个简单且非常有效的单行代码：

```
void strtoupper(char* str)
{ 
    while (*str) *(str++) = toupper((unsigned char)*str);
} 
```

这对于您想要规范化为相同字符大小写的简单字符串（如 ASCII 标识符）特别有用。然后，您可以使用缓冲区构造 std:string 实例。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2014-06-15T02:31:40.937

Use a lambda.

```
std::string s("change my case");

std::locale locale;
auto to_upper = [&locale] (char ch) { return std::use_facet<std::ctype<char>>(locale).toupper(ch); };

std::transform(s.begin(), s.end(), s.begin(), to_upper); 
```

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2010-08-01T04:24:06.907

```
//works for ASCII -- no clear advantage over what is already posted...

std::string toupper(const std::string & s)
{
    std::string ret(s.size(), char());
    for(unsigned int i = 0; i < s.size(); ++i)
        ret[i] = (s[i] <= 'z' && s[i] >= 'a') ? s[i]-('a'-'A') : s[i];
    return ret;
} 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2016-10-07T23:52:13.723

```
#include <string>
#include <locale>

std::string str = "Hello World!";
auto & f = std::use_facet<std::ctype<char>>(std::locale());
f.toupper(str.data(), str.data() + str.size()); 
```

This will perform better than all the answers that use the global toupper function, and is presumably what boost::to_upper is doing underneath.

This is because ::toupper has to look up the locale - because it might've been changed by a different thread - for every invocation, whereas here only the call to locale() has this penalty. And looking up the locale generally involves taking a lock.

This also works with C++98 after you replace the auto, use of the new non-const str.data(), and add a space to break the template closing (">>" to "> >") like this:

```
std::use_facet<std::ctype<char> > & f = 
    std::use_facet<std::ctype<char> >(std::locale());
f.toupper(const_cast<char *>(str.data()), str.data() + str.size()); 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2009-04-09T17:55:02.100

```
typedef std::string::value_type char_t;

char_t up_char( char_t ch )
{
    return std::use_facet< std::ctype< char_t > >( std::locale() ).toupper( ch );
}

std::string toupper( const std::string &src )
{
    std::string result;
    std::transform( src.begin(), src.end(), std::back_inserter( result ), up_char );
    return result;
}

const std::string src  = "test test TEST";

std::cout << toupper( src ); 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2020-01-24T08:54:40.460

[@dirkgently](https://stackoverflow.com/users/66692)的[回答](https://stackoverflow.com/a/735217/4927212)非常鼓舞人心，但我想强调一下，由于如下所示的担忧，

> 与 中的所有其他函数一样，如果参数的值既不能表示为 unsigned char 也不等于 EOF，则 std::toupper 的行为是未定义的。为了安全地使用纯字符（或有符号字符）这些函数，首先应将参数转换为无符号字符
> [*参考*：[std::toupper](https://en.cppreference.com/w/cpp/string/byte/toupper)]

由于标准没有指定 plain`char`是有符号还是无符号[[1]](https://stackoverflow.com/a/2054941/4927212)，正确的用法`std::toupper`应该是：

```
#include <algorithm>
#include <cctype>
#include <iostream>
#include <iterator>
#include <string>

void ToUpper(std::string& input)
{
    std::for_each(std::begin(input), std::end(input), [](char& c) {
        c = static_cast<char>(std::toupper(static_cast<unsigned char>(c)));
    });
}

int main()
{
    std::string s{ "Hello world!" };
    std::cout << s << std::endl;
    ::ToUpper(s);
    std::cout << s << std::endl;

    return 0;
} 
```

输出：

```
Hello world!
HELLO WORLD! 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-12-17T01:13:49.320

```
std::string value;
for (std::string::iterator p = value.begin(); value.end() != p; ++p)
    *p = toupper(*p); 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2020-09-15T19:39:20.087

```
std::string str = "STriNg oF mIxID CasE lETteRS" 
```

**C++ 11**

*   使用 for_each

    `std::for_each(str.begin(), str.end(), [](char & c){ c = ::toupper(c); });`

*   使用变换

    `std::transform(str.begin(), str.end(), str.begin(), ::toupper);`

**C++（仅限 Windows）**

```
_strupr_s(str, str.length()); 
```

**C++（使用 Boost 库）**

```
boost::to_upper_copy(str) 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-04-09T17:41:41.103

试试`toupper()`函数 ( `#include <ctype.h>`)。它接受字符作为参数，字符串由字符组成，因此您必须遍历每个单独的字符，这些字符放在一起构成字符串

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-12-27T06:46:12.847

这是 C++11 的最新代码

```
std::string cmd = "Hello World";
for_each(cmd.begin(), cmd.end(), [](char& in){ in = ::toupper(in); }); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-11-30T13:48:56.563

如果你只想大写，试试这个功能。

```
#include <iostream>

using namespace std;

string upper(string text){
    string upperCase;
    for(int it : text){
        if(it>96&&it<123){
            upperCase += char(it-32);
        }else{
            upperCase += char(it);
        }
    }
    return upperCase;
}

int main() {
    string text = "^_abcdfghopqrvmwxyz{|}";
    cout<<text<<"/";
    text = upper(text);
    cout<<text;
    return 0;
} 
```

> [错误：C++98 模式下不允许基于范围的“for”循环](https://stackoverflow.com/questions/22859183/error-range-based-for-loops-are-not-allowed-in-c98-mode/22859334)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-10-04T08:45:12.203

使用 Boost.Text，它适用于 Unicode 文本

```
boost::text::text t = "Hello World";
boost::text::text uppered;
boost::text::to_title(t, std::inserter(uppered, uppered.end()));
std::string newstr = uppered.extract(); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-04-09T17:43:14.000

不确定是否有内置功能。尝试这个：

包括 ctype.h 或 cctype 库，以及 stdlib.h 作为预处理器指令的一部分。

```
string StringToUpper(string strToConvert)
{//change each element of the string to upper case
   for(unsigned int i=0;i<strToConvert.length();i++)
   {
      strToConvert[i] = toupper(strToConvert[i]);
   }
   return strToConvert;//return the converted string
}

string StringToLower(string strToConvert)
{//change each element of the string to lower case
   for(unsigned int i=0;i<strToConvert.length();i++)
   {
      strToConvert[i] = tolower(strToConvert[i]);
   }
   return strToConvert;//return the converted string
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-06-01T15:30:31.627

```
//Since I work on a MAC, and Windows methods mentioned do not work for me, I //just built this quick method.

string str; 
    str = "This String Will Print Out in all CAPS";
    int len = str.size(); 
    char b;

for (int i = 0; i < len; i++){
    b = str[i]; 
    b = toupper(b); 
   // b = to lower(b); //alternately 
     str[i] = b;    
}

cout<<str; 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-10-18T06:21:26.560

基于[Kyle_the_hacker 的](https://stackoverflow.com/users/1689664/kyle-the-hacker)----->[回答](https://stackoverflow.com/a/17993266/3158594)我的额外内容。

# Ubuntu

在终端列出所有语言环境
`locale -a`

安装所有语言环境
`sudo apt-get install -y locales locales-all`

编译 main.cpp
`$ g++ main.cpp`

运行编译好的程序
`$ ./a.out`

**结果**

```
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë 
```

[![Ubuntu Linux - 来自 VSCODE 的 WSL](https://i.stack.imgur.com/9KdHH.png)](https://i.stack.imgur.com/9KdHH.png)

[![Ubuntu Linux - WSL](https://i.stack.imgur.com/wRHnw.png)](https://i.stack.imgur.com/wRHnw.png)

# 视窗

在 cmd 中运行 VCVARS 开发者工具
`"C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"`

编译 main.cpp
`> cl /EHa main.cpp /D "_DEBUG" /D "_CONSOLE" /D "_UNICODE" /D "UNICODE" /std:c++17 /DYNAMICBASE "kernel32.lib" "user32.lib" "gdi32.lib" "winspool.lib" "comdlg32.lib" "advapi32.lib" "shell32.lib" "ole32.lib" "oleaut32.lib" "uuid.lib" "odbc32.lib" "odbccp32.lib" /MTd`

```
Compilador de optimización de C/C++ de Microsoft (R) versión 19.27.29111 para x64
(C) Microsoft Corporation. Todos los derechos reservados.

main.cpp
Microsoft (R) Incremental Linker Version 14.27.29111.0
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:main.exe
main.obj
kernel32.lib
user32.lib
gdi32.lib
winspool.lib
comdlg32.lib
advapi32.lib
shell32.lib
ole32.lib
oleaut32.lib
uuid.lib
odbc32.lib
odbccp32.lib 
```

运行 main.exe
`>main.exe`

**结果**

```
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë 
```

[![视窗](https://i.stack.imgur.com/c1Kpn.png)](https://i.stack.imgur.com/c1Kpn.png)

## 代码 - main.cpp

> **此代码仅在 Windows x64 和 Ubuntu Linux x64 上进行了测试。**

```
/*
 * Filename: c:\Users\x\Cpp\main.cpp
 * Path: c:\Users\x\Cpp
 * Filename: /home/x/Cpp/main.cpp
 * Path: /home/x/Cpp
 * Created Date: Saturday, October 17th 2020, 10:43:31 pm
 * Author: Joma
 *
 * No Copyright 2020
 */

#include <iostream>
#include <set>
#include <string>
#include <locale>

// WINDOWS
#if (_WIN32)
#include <Windows.h>
#include <conio.h>
#define WINDOWS_PLATFORM 1
#define DLLCALL STDCALL
#define DLLIMPORT _declspec(dllimport)
#define DLLEXPORT _declspec(dllexport)
#define DLLPRIVATE
#define NOMINMAX

//EMSCRIPTEN
#elif defined(__EMSCRIPTEN__)
#include <emscripten/emscripten.h>
#include <emscripten/bind.h>
#include <unistd.h>
#include <termios.h>
#define EMSCRIPTEN_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

// LINUX - Ubuntu, Fedora, , Centos, Debian, RedHat
#elif (__LINUX__ || __gnu_linux__ || __linux__ || __linux || linux)
#define LINUX_PLATFORM 1
#include <unistd.h>
#include <termios.h>
#define DLLCALL CDECL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#define CoTaskMemAlloc(p) malloc(p)
#define CoTaskMemFree(p) free(p)

//ANDROID
#elif (__ANDROID__ || ANDROID)
#define ANDROID_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

//MACOS
#elif defined(__APPLE__)
#include <unistd.h>
#include <termios.h>
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#include "TargetConditionals.h"
#if TARGET_OS_IPHONE && TARGET_IPHONE_SIMULATOR
#define IOS_SIMULATOR_PLATFORM 1
#elif TARGET_OS_IPHONE
#define IOS_PLATFORM 1
#elif TARGET_OS_MAC
#define MACOS_PLATFORM 1
#else

#endif

#endif

typedef std::string String;
typedef std::wstring WString;

#define EMPTY_STRING u8""s
#define EMPTY_WSTRING L""s

using namespace std::literals::string_literals;

class Strings
{
public:
    static String WideStringToString(const WString& wstr)
    {
        if (wstr.empty())
        {
            return String();
        }
        size_t pos;
        size_t begin = 0;
        String ret;

#if WINDOWS_PLATFORM
        int size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
        }
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static WString StringToWideString(const String& str)
    {
        if (str.empty())
        {
            return WString();
        }

        size_t pos;
        size_t begin = 0;
        WString ret;
#ifdef WINDOWS_PLATFORM
        int size = 0;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != std::string::npos) {
            std::string segment = std::string(&str[begin], pos - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length()) {
            std::string segment = std::string(&str[begin], str.length() - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, segment.c_str(), segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
        }

#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != String::npos)
        {
            String segment = String(&str[begin], pos - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length())
        {
            String segment = String(&str[begin], str.length() - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static WString ToUpper(const WString& data)
    {
        WString result = data;
        auto& f = std::use_facet<std::ctype<wchar_t>>(std::locale());

        f.toupper(&result[0], &result[0] + result.size());
        return result;
    }

    static String  ToUpper(const String& data)
    {
        return WideStringToString(ToUpper(StringToWideString(data)));
    }

    static WString ToLower(const WString& data)
    {
        WString result = data;
        auto& f = std::use_facet<std::ctype<wchar_t>>(std::locale());
        f.tolower(&result[0], &result[0] + result.size());
        return result;
    }

    static String ToLower(const String& data)
    {
        return WideStringToString(ToLower(StringToWideString(data)));
    }

};

enum class ConsoleTextStyle
{
    DEFAULT = 0,
    BOLD = 1,
    FAINT = 2,
    ITALIC = 3,
    UNDERLINE = 4,
    SLOW_BLINK = 5,
    RAPID_BLINK = 6,
    REVERSE = 7,
};

enum class ConsoleForeground
{
    DEFAULT = 39,
    BLACK = 30,
    DARK_RED = 31,
    DARK_GREEN = 32,
    DARK_YELLOW = 33,
    DARK_BLUE = 34,
    DARK_MAGENTA = 35,
    DARK_CYAN = 36,
    GRAY = 37,
    DARK_GRAY = 90,
    RED = 91,
    GREEN = 92,
    YELLOW = 93,
    BLUE = 94,
    MAGENTA = 95,
    CYAN = 96,
    WHITE = 97
};

enum class ConsoleBackground
{
    DEFAULT = 49,
    BLACK = 40,
    DARK_RED = 41,
    DARK_GREEN = 42,
    DARK_YELLOW = 43,
    DARK_BLUE = 44,
    DARK_MAGENTA = 45,
    DARK_CYAN = 46,
    GRAY = 47,
    DARK_GRAY = 100,
    RED = 101,
    GREEN = 102,
    YELLOW = 103,
    BLUE = 104,
    MAGENTA = 105,
    CYAN = 106,
    WHITE = 107
};

class Console
{
private:
    static void EnableVirtualTermimalProcessing()
    {
#if defined WINDOWS_PLATFORM
        HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
        DWORD dwMode = 0;
        GetConsoleMode(hOut, &dwMode);
        if (!(dwMode & ENABLE_VIRTUAL_TERMINAL_PROCESSING))
        {
            dwMode |= ENABLE_VIRTUAL_TERMINAL_PROCESSING;
            SetConsoleMode(hOut, dwMode);
        }
#endif
    }

    static void ResetTerminalFormat()
    {
        std::cout << u8"\033[0m";
    }

    static void SetVirtualTerminalFormat(ConsoleForeground foreground, ConsoleBackground background, std::set<ConsoleTextStyle> styles)
    {
        String format = u8"\033[";
        format.append(std::to_string(static_cast<int>(foreground)));
        format.append(u8";");
        format.append(std::to_string(static_cast<int>(background)));
        if (styles.size() > 0)
        {
            for (auto it = styles.begin(); it != styles.end(); ++it)
            {
                format.append(u8";");
                format.append(std::to_string(static_cast<int>(*it)));
            }
        }
        format.append(u8"m");
        std::cout << format;
    }
public:
    static void Clear()
    {

#ifdef WINDOWS_PLATFORM
        std::system(u8"cls");
#elif LINUX_PLATFORM || defined MACOS_PLATFORM
        std::system(u8"clear");
#elif EMSCRIPTEN_PLATFORM
        emscripten::val::global()["console"].call<void>(u8"clear");
#else
        static_assert(false, "Unknown Platform");
#endif
    }

    static void Write(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        String str = s;
#ifdef WINDOWS_PLATFORM
        WString unicode = Strings::StringToWideString(str);
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), unicode.c_str(), static_cast<DWORD>(unicode.length()), nullptr, nullptr);
#elif defined LINUX_PLATFORM || defined MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << str;
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void Write(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        WString str = s;

#ifdef WINDOWS_PLATFORM
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), str.c_str(), static_cast<DWORD>(str.length()), nullptr, nullptr);
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << Strings::WideStringToString(str);
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void WriteLine()
    {
        std::cout << std::endl;
    }

    static void Pause()
    {
        char c;
        do
        {
            c = getchar();
            std::cout << "Press Key " << std::endl;
        } while (c != 64);
        std::cout << "KeyPressed" << std::endl;
    }

    static int PauseAny(bool printWhenPressed = false, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        int ch;
#ifdef WINDOWS_PLATFORM
        ch = _getch();
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        struct termios oldt, newt;
        tcgetattr(STDIN_FILENO, &oldt);
        newt = oldt;
        newt.c_lflag &= ~(ICANON | ECHO);
        tcsetattr(STDIN_FILENO, TCSANOW, &newt);
        ch = getchar();
        tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
#else
        static_assert(false, "Unknown Platform");
#endif
        if (printWhenPressed)
        {
            Console::Write(String(1, ch), foreground, background, styles);
        }
        return ch;
    }
};

int main()
{
    std::locale::global(std::locale(u8"en_US.UTF-8"));
    String dataStr = u8"Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë";
    WString dataWStr = L"Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë";
    std::string locale = u8"";
    //std::string locale = u8"de_DE.UTF-8";
    //std::string locale = u8"en_US.UTF-8";
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);
    dataStr = Strings::ToUpper(dataStr);
    dataWStr = Strings::ToUpper(dataWStr);
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);
    dataStr = Strings::ToLower(dataStr);
    dataWStr = Strings::ToLower(dataWStr);
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);

    Console::WriteLine(u8"Press any key to exit"s, ConsoleForeground::DARK_GRAY);
    Console::PauseAny();

    return 0;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-01-24T02:29:08.683

我的解决方案（清除 alpha 的第 6 位）：

```
#include <ctype.h>

inline void toupper(char* str)
{
    while (str[i]) {
        if (islower(str[i]))
            str[i] &= ~32; // Clear bit 6 as it is what differs (32) between Upper and Lowercases
        i++;
    }
} 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2014-07-31T13:26:06.417

如果您只关心 8 位字符（除了 Milan Babuškov 之外的所有其他答案也都假设），您可以通过在编译时使用元编程生成查找表来获得最快的速度。在 ideone.com 上，它的运行速度比库函数快 7 倍，比手写版本 ( [http://ideone.com/sb1Rup](http://ideone.com/sb1Rup) ) 快 3 倍。它也可以通过特征进行定制，不会减慢速度。

```
template<int ...Is>
struct IntVector{
using Type = IntVector<Is...>;
};

template<typename T_Vector, int I_New>
struct PushFront;
template<int ...Is, int I_New>
struct PushFront<IntVector<Is...>,I_New> : IntVector<I_New,Is...>{};

template<int I_Size, typename T_Vector = IntVector<>>
struct Iota : Iota< I_Size-1, typename PushFront<T_Vector,I_Size-1>::Type> {};
template<typename T_Vector>
struct Iota<0,T_Vector> : T_Vector{};

template<char C_In>
struct ToUpperTraits {
    enum { value = (C_In >= 'a' && C_In <='z') ? C_In - ('a'-'A'):C_In };
};

template<typename T>
struct TableToUpper;
template<int ...Is>
struct TableToUpper<IntVector<Is...>>{
    static char at(const char in){
        static const char table[] = {ToUpperTraits<Is>::value...};
        return table[in];
    }
};

int tableToUpper(const char c){
    using Table = TableToUpper<typename Iota<256>::Type>;
    return Table::at(c);
} 
```

用例：

```
std::transform(in.begin(),in.end(),out.begin(),tableToUpper); 
```

对于它如何工作的深入（多页）描述让我可以无耻地插入我的博客： http: [//metaporky.blogspot.de/2014/07/part-4-generating-look-up-tables-at.html](http://metaporky.blogspot.de/2014/07/part-4-generating-look-up-tables-at.html)

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2012-02-14T21:37:35.197

此页面上的所有这些解决方案都比他们需要的更难。

做这个

```
RegName = "SomE StRing That you wAnt ConvErTed";
NameLength = RegName.Size();
for (int forLoop = 0; forLoop < NameLength; ++forLoop)
{
     RegName[forLoop] = tolower(RegName[forLoop]);
} 
```

`RegName`是你的`string`。获取您的字符串大小不要`string.size()`用作您的实际测试器，非常混乱并且可能导致问题。然后。最基本的`for`循环。

记住字符串大小也返回分隔符，所以在循环测试中使用 < 而不是 <=。

输出将是：您要转换的一些字符串

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2013-08-18T17:23:20.157

不使用任何库：

```
std::string YourClass::Uppercase(const std::string & Text)
{
    std::string UppperCaseString;
    UppperCaseString.reserve(Text.size());
    for (std::string::const_iterator it=Text.begin(); it<Text.end(); ++it)
    {
        UppperCaseString.push_back(((0x60 < *it) && (*it < 0x7B)) ? (*it - static_cast<char>(0x20)) : *it);
    }
    return UppperCaseString;
} 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2015-04-16T08:51:22.817

```
template<size_t size>
char* toupper(char (&dst)[size], const char* src) {
    // generate mapping table once
    static char maptable[256];
    static bool mapped;
    if (!mapped) {
        for (char c = 0; c < 256; c++) {
            if (c >= 'a' && c <= 'z')
                maptable[c] = c & 0xdf;
            else
                maptable[c] = c;
        }
        mapped = true;
    }

    // use mapping table to quickly transform text
    for (int i = 0; *src && i < size; i++) {
        dst[i] = maptable[*(src++)];
    }
    return dst;
} 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2018-07-24T17:30:37.293

这个 c++ 函数总是返回大写字符串...

```
#include <locale> 
#include <string>
using namespace std; 
string toUpper (string str){
    locale loc; 
    string n; 
    for (string::size_type i=0; i<str.length(); ++i)
        n += toupper(str[i], loc);
    return n;
} 
```

* * *

## 回答 #31

> 赞同：-3
> 
> 时间：2012-05-02T20:25:45.183

I use this solution. I know you're not supposed to modify that data area.... but I think that's mostly for buffer overrun bugs and null character.... upper casing things isn't the same.

```
void to_upper(const std::string str) {
    std::string::iterator it;
    int i;
    for ( i=0;i<str.size();++i ) {
        ((char *)(void *)str.data())[i]=toupper(((char *)str.data())[i]);
    }
} 
```

# asp.net - 如何捕获会话状态

> ID：735206
> 
> 赞同：0
> 
> 时间：2009-04-09T17:38:59.440
> 
> 标签：asp.net, session-state

我有一个 asp .net 母版页应用程序，一个内容页上有许多控件。

每当用户导航到另一个内容页面时，我想将这些控件的内容/状态存储在会话状态中。

我的问题是，我怎么知道何时捕获控制状态？是否有某种类型的事件可以用来触发程序？

在此先感谢您的任何信息。

账单

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T17:56:16.887

没有任何真正的“全局”服务器端事件处理程序可用于检测用户何时进入另一个页面（或者甚至只是点击浏览器中的后退按钮）。

最好的办法是在您的母版页中简单地编写一个方法来保存您的会话状态，然后执行 Response.Redirect() 到指定的位置。然后，当您需要跟踪会话状态时，让您的所有链接都通过此方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:51:24.237

使用会话变量怎么样？

有关更多信息，请参阅此链接： [ASP.Net 会话](https://stackoverflow.com/questions/133236/asp-net-session)

有很多方法可以保持状态。无论您使用哪个版本，都需要权衡取舍。例如，我不会在跨多个服务器负载平衡的应用程序上使用会话变量；您不能保证为每个请求获得相同的服务器，并且状态存储在逐个服务器的基础上。

很难打败这个

```
Session["myState"] = 7;  // bad example 
```

不过，为了简单起见。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:51:54.727

据推测，他们正在通过您提供的控件（按钮、链接等）离开该页面。您可以在该点捕获服务器端的操作并缓存您的状态。

# php - 查询日历事件的最佳方式？

> ID：735216
> 
> 赞同：0
> 
> 时间：2009-04-09T17:42:12.317
> 
> 标签：php, mysql, database

我正在创建一个显示一个月事件时间表的日历。每天都有几个参数来确定是否可以为这一天安排更多活动（有多少员工可用，可用多少次等）。

我的数据库是使用三个表设置的：

1.  定期时间表 - 这用于为一周中的每一天创建一个数组，概述有多少员工可用，他们可用的时间等
2.  Schedule Variations - 如果某个日期有变化，这将覆盖来自常规日程安排数组的信息。
3.  事件 - 现有事件，按日期引用。

在这个阶段，代码循环遍历一个月中的每一天，每天检查两到三件事。

1.  时间表是否有任何变化（公共假期、更短的时间等）？
2.  这天有什么时间/多少工作人员？
3.  （如果有工作人员）这一天已经安排了多少活动？

第 1 步和第 3 步需要数据库查询 - 假设每月 30 天，即每次页面查看 60 次查询。

我担心这会如何扩展，对于少数用户来说，我认为这不会有太大问题，但是如果 20 个人尝试同时加载页面，那么它会跳转到 1200 个查询。 .

任何关于如何更有效地做到这一点的想法或建议将不胜感激！

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T06:08:28.993

[我在使用http://rosterus.com](http://rosterus.com)时遇到了同样的问题，我们只是将大部分数据加载到页面顶部的数组中，然后在数组中查询相关数据。之后页面加载速度提高了 10 倍。

因此，运行一两个广泛的查询来收集您需要的所有数据，选择适当的键并将每个结果存储到一个数组中。然后访问数组而不是数据库。PHP 在数组索引方面非常灵活，您可以使用各种东西作为键......或多个索引。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:46:05.553

创建表：

```
t_month (day INT)

INSERT
INTO     t_month
VALUES
         (1),
         (2),
         ...
         (31) 
```

然后查询：

```
SELECT   *
FROM     t_month, t_schedule
WHERE    schedule_date = '2009-03-01' + INTERVAL t_month.day DAY
         AND schedule_date < '2009-03-01' + INTERVAL 1 MONTH
         AND ... 
```

而不是`30`查询，您只会得到一个带有`JOIN`.

Other`RDBMS`允许您动态生成行集，但[**MySQL 不允许**](https://stackoverflow.com/questions/701444/how-do-i-make-a-row-generator-in-mysql)。

不过，你可以`t_month`用丑陋的代替

```
SELECT  1 AS month_day
UNION ALL
SELECT  2
UNION ALL
...
SELECT  31 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T18:27:27.840

我想不出你需要将每个查询限制为一天的充分理由。当然，您可以选择一对日期之间的所有值。

同样，您可以使用联接来获取给定日期的事件计划事件数。

然后对数据库查询返回的数组执行循环（每天）。

# .net - 如何在用户控件的标记中实现 System.Type 属性？

> ID：735221
> 
> 赞同：1
> 
> 时间：2009-04-09T17:43:11.817
> 
> 标签：.net, asp.net

这是我第一次发现这个问题的[另一个问题](https://stackoverflow.com/questions/729243/error-creating-system-type-from-string-system-int32)的后续行动。如果我在我的用户控件上创建一个类型为 的公共属性`System.Type`，我不能使用该类型的正常字符串表示，例如`System.Int32`，作为该属性的声明性标记属性值。

看来我需要发现从字符串到类型的转换是什么，并为 System.Type“注入”一个自定义的。我在正确的轨道上吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T04:10:03.493

你需要一个 TypeConverter。大多数原始类型都有默认类型。它们由 ControlBuilders 使用。.NET 可能已经为 System.Type 提供了一些东西，但我不知道。因此，您可以通过以下方式添加自己的：

在页面上：

```
<uc1:WebUserControl1 ID="WebUserControl11" runat="server" MyProperty="System.Int32" /> 
```

后面的用户控制代码：

```
using System.ComponentModel;

public partial class WebUserControl1 : System.Web.UI.UserControl
{
    [TypeConverter(typeof(MyTypeConverter))]
    public System.Type MyProperty { get; set; }

    protected void Page_Load(object sender, EventArgs e)
    {
        //dummy user web control, simply outputs property's value
        Response.Write(MyProperty.ToString());
    }
}

public class MyTypeConverter : TypeConverter
{
    public override bool CanConvertFrom(ITypeDescriptorContext context, Type sourceType)
    {
        return ((sourceType == typeof(string)) || base.CanConvertFrom(context, sourceType));
    }

    public override object ConvertFrom(ITypeDescriptorContext context, CultureInfo culture, object value)
    {
        if (value is string)
        {
            string str = ((string)value).Trim();
            try
            {
                return Type.GetType(str);
            }
            catch (FormatException exception)
            {
                throw new FormatException(string.Format("ConvertInvalidPrimitive={0} is not a valid value for {1}.", value, "System.Type"), exception);
            }
        }
        return base.ConvertFrom(context, culture, value);
    }

    public override bool GetStandardValuesSupported(ITypeDescriptorContext context)
    {
        return false;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:57:04.013

只使用类型而不是使用字符串表示怎么样？您可以使用 typeof 获取编译时类型，并且可以使用[Object.GetType() 获取运行时类型。](http://msdn.microsoft.com/en-us/library/system.object.gettype(VS.80).aspx) 任何一个都返回 System.Type。

# java - Java 反射 - 访问受保护的字段

> ID：735230
> 
> 赞同：46
> 
> 时间：2009-04-09T17:45:05.667
> 
> 标签：java, reflection, field, protected

如何通过反射从对象访问继承的受保护字段？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-09T18:08:19.557

您可能遇到的两个问题 - 该字段可能无法正常访问（私有），并且它不在您正在查看的类中，而是在层次结构的某个位置。

即使有这些问题，这样的事情也会起作用：

```
public class SomeExample {

  public static void main(String[] args) throws Exception{
    Object myObj = new SomeDerivedClass(1234);
    Class myClass = myObj.getClass();
    Field myField = getField(myClass, "value");
    myField.setAccessible(true); //required if field is not normally accessible
    System.out.println("value: " + myField.get(myObj));
  }

  private static Field getField(Class clazz, String fieldName)
        throws NoSuchFieldException {
    try {
      return clazz.getDeclaredField(fieldName);
    } catch (NoSuchFieldException e) {
      Class superClass = clazz.getSuperclass();
      if (superClass == null) {
        throw e;
      } else {
        return getField(superClass, fieldName);
      }
    }
  }
}

class SomeBaseClass {
  private Integer value;

  SomeBaseClass(Integer value) {
    this.value = value;
  }
}

class SomeDerivedClass extends SomeBaseClass {
  SomeDerivedClass(Integer value) {
    super(value);
  }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2016-09-22T10:53:38.277

使用`FieldUtils.writeField(object, "fieldname", value, true)`或`readField(object, "fieldname", true)`来自[Apache Commons lang3](https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/reflect/FieldUtils.html)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T17:55:33.190

```
field = myclass.getDeclaredField("myname");
field.setAccessible(true);
field.set(myinstance, newvalue); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-04-08T01:12:53.933

使用反射访问类实例的成员，使它们可访问并设置它们各自的值。当然，您必须知道要更改的每个成员的名称，但我想这不会有问题。

```
public class ReflectionUtil {
    public static Field getField(Class clazz, String fieldName) throws NoSuchFieldException {
        try {
            return clazz.getDeclaredField(fieldName);
        } catch (NoSuchFieldException e) {
            Class superClass = clazz.getSuperclass();
            if (superClass == null) {
                throw e;
            } else {
                return getField(superClass, fieldName);
            }
        }
    }
    public static void makeAccessible(Field field) {
        if (!Modifier.isPublic(field.getModifiers()) ||
            !Modifier.isPublic(field.getDeclaringClass().getModifiers()))
        {
            field.setAccessible(true);
        }
    }
}

public class Application {
    public static void main(String[] args) throws Exception {
        KalaGameState obj = new KalaGameState();
        Field field = ReflectionUtil.getField(obj.getClass(), 'turn');
        ReflectionUtil.makeAccessible(field);
        field.setInt(obj, 666);
        System.out.println("turn is " + field.get(obj));
    }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-01-18T12:56:53.737

如果使用 Spring，[ReflectionTestUtils](http://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/util/ReflectionTestUtils.html)提供了一些方便的工具，可以帮助您轻松完成任务。

例如，要获取已知为 的受保护字段值`int`：

```
int theIntValue = (int)ReflectionTestUtils.getField(theClass, "theProtectedIntField"); 
```

或者设置此字段的值：

```
ReflectionTestUtils.setField(theClass, "theProtectedIntField", theIntValue); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-12-12T06:25:11.680

我不想拖入更多的库，所以我制作了一个适合我的纯库。它是 jweyrich 的一种方法的扩展：

```
import java.lang.reflect.Field;
import java.lang.reflect.Modifier;
import java.util.Date;
import java.util.Random;
import java.util.UUID;

public abstract class POJOFiller {

    static final Random random = new Random();

    public static void fillObject(Object ob) {
        Class<? extends Object> clazz = ob.getClass();

        do {
            Field[] fields = clazz.getDeclaredFields();
            fillForFields(ob, fields);

            if (clazz.getSuperclass() == null) {
                return;
            }
            clazz = clazz.getSuperclass();

        } while (true);

    }

    private static void fillForFields(Object ob, Field[] fields) {
        for (Field field : fields) {
            field.setAccessible(true);

            if(Modifier.isFinal(field.getModifiers())) {
                continue;
            }

            try {
                field.set(ob, generateRandomValue(field.getType()));
            } catch (IllegalArgumentException | IllegalAccessException e) {
                throw new IllegalStateException(e);
            }
        }
    }

    static Object generateRandomValue(Class<?> fieldType) {
        if (fieldType.equals(String.class)) {
            return UUID.randomUUID().toString();
        } else if (Date.class.isAssignableFrom(fieldType)) {
            return new Date(System.currentTimeMillis());
        } else if (Number.class.isAssignableFrom(fieldType)) {
            return random.nextInt(Byte.MAX_VALUE) + 1;
        } else if (fieldType.equals(Integer.TYPE)) {
            return random.nextInt();
        } else if (fieldType.equals(Long.TYPE)) {
            return random.nextInt();
        } else if (Enum.class.isAssignableFrom(fieldType)) {
            Object[] enumValues = fieldType.getEnumConstants();
            return enumValues[random.nextInt(enumValues.length)];
        } else if(fieldType.equals(Integer[].class)) {
            return new Integer[] {random.nextInt(), random.nextInt()};
        }
        else {
            throw new IllegalArgumentException("Cannot generate for " + fieldType);
        }
    }

} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-16T15:52:23.690

如果您只是获得受保护的领域

```
Field protectedfield = Myclazz.class.getSuperclass().getDeclaredField("num"); 
```

如果您使用的是 Eclipse `Ctrl`+ `Space`，当您键入“.”时会弹出一个方法列表。在对象之后

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-06-19T09:51:24.007

使用此实用程序：

```
import java.lang.reflect.*;
import java.util.*;
import java.util.stream.Stream;

import static java.lang.String.format;

public final class ReflectionUtils {

    private ReflectionUtils() { }

    private static final String GETTER_PREFIX = "get";
    private static final String SETTER_PREFIX = "set";

    /**
     * Get name of getter
     *
     * @param fieldName fieldName
     * @return getter name
     */
    public static String getterByFieldName(String fieldName) {
        if (isStringNullOrEmpty(fieldName))
            return null;

        return convertFieldByAddingPrefix(fieldName, GETTER_PREFIX);
    }

    /**
     * Get name of setter
     *
     * @param fieldName fieldName
     * @return setter name
     */
    public static String setterByFieldName(String fieldName) {
        if (isStringNullOrEmpty(fieldName))
            return null;

        return convertFieldByAddingPrefix(fieldName, SETTER_PREFIX);
    }

    /**
     * Get the contents of the field with any access modifier
     *
     * @param obj obj
     * @param fieldName fieldName
     * @return content of field
     */
    public static Object getFieldContent(Object obj, String fieldName) {
        if (!isValidParams(obj, fieldName))
            return null;

        try {
            Field declaredField = getFieldAccessible(obj, fieldName);
            return declaredField.get(obj);
        } catch (IllegalAccessException e) {
            throw new IllegalArgumentException("Cannot get field content for field name: " + fieldName, e);
        }
    }

    /**
     * @param clazz clazz
     * @param fieldName fieldName
     * @return content static field
     */
    public static Object getStaticFieldContent(final Class<?> clazz, final String fieldName) {
        try {
            Field field = getFieldWithCheck(clazz, fieldName);
            field.setAccessible(true);
            return field.get(clazz);
        } catch (Exception e) {
            String exceptionMsg = format("Cannot find or get static field: '%s' from class: '%s'", fieldName, clazz);
            throw new RuntimeException(exceptionMsg, e);
        }
    }

    /**
     * Set the contents to the field with any access modifier
     *
     * @param obj obj
     * @param fieldName fieldName
     * @param value value
     */
    public static void setFieldContent(Object obj, String fieldName, Object value) {
        if (!isValidParams(obj, fieldName))
            return;

        try {
            Field declaredField = getFieldAccessible(obj, fieldName);
            declaredField.set(obj, value);
        } catch (IllegalAccessException e) {
            throw new IllegalArgumentException("Cannot set field content for field name: " + fieldName, e);
        }
    }

    /**
     * Call a method with any access modifier
     *
     * @param obj obj
     * @param methodName methodName
     * @return result of method
     */
    public static Object callMethod(Object obj, String methodName) {
        if (!isValidParams(obj, methodName))
            return null;

        try {
            Method method = obj.getClass().getMethod(methodName);
            method.setAccessible(true);
            return method.invoke(obj);
        } catch (NoSuchMethodException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {
            throw new IllegalArgumentException("Cannot invoke method name: " + methodName, e);
        }
    }

    /**
     * Get all fields even from parent
     *
     * @param clazz clazz
     * @return array of fields
     */
    public static Field[] getAllFields(Class<?> clazz) {
        if (clazz == null) return null;

        List<Field> fields = new ArrayList<>(Arrays.asList(clazz.getDeclaredFields()));
        if (clazz.getSuperclass() != null) {
            // danger! Recursion
            fields.addAll(Arrays.asList(getAllFields(clazz.getSuperclass())));
        }
        return fields.toArray(new Field[] {});
    }

    /**
     * Get the Field from Object even from parent
     *
     * @param obj obj
     * @param fieldName fieldName
     * @return {@code Optional}
     */
    public static Optional<Field> getField(Object obj, String fieldName) {
        if (!isValidParams(obj, fieldName))
            return Optional.empty();

        Class<?> clazz = obj.getClass();
        return getField(clazz, fieldName);
    }

    /**
     * Get the Field from Class even from parent
     *
     * @param clazz clazz
     * @param fieldName fieldName
     * @return {@code Optional}
     */
    public static Optional<Field> getField(Class<?> clazz, String fieldName) {
        if (!isValidParams(clazz, fieldName))
            return Optional.empty();

        Field[] fields = getAllFields(clazz);
        return Stream.of(fields)
                .filter(x -> x.getName().equals(fieldName))
                .findFirst();
    }

    /**
     * @param clazz clazz
     * @param fieldName fieldName
     * @return Class
     */
    public static Class<?> getFieldType(Class<?> clazz, String fieldName) {
        return getFieldWithCheck(clazz, fieldName).getType();
    }

    /**
     * @param clazz clazz
     * @param fieldName fieldName
     * @return Field
     */
    public static Field getFieldWithCheck(Class<?> clazz, String fieldName) {
        return ReflectionUtils.getField(clazz, fieldName)
                .orElseThrow(() -> {
                    String msg = String.format("Cannot find field name: '%s' from class: '%s'", fieldName, clazz);
                    return new IllegalArgumentException(msg);
                });
    }

    /**
     * Get the field values with the types already listed according to the field type
     *
     * @param clazz clazz
     * @param fieldName fieldName
     * @param fieldValue fieldValue
     * @return value cast to specific field type
     */
    public static Object castFieldValueByClass(Class<?> clazz, String fieldName, Object fieldValue) {
        Field field = getField(clazz, fieldName)
                .orElseThrow(() -> new IllegalArgumentException(String.format("Cannot find field by name: '%s'", fieldName)));

        Class<?> fieldType = field.getType();

        return castFieldValueByType(fieldType, fieldValue);
    }

    /**
     * @param fieldType fieldType
     * @param fieldValue fieldValue
     * @return casted value
     */
    public static Object castFieldValueByType(Class<?> fieldType, Object fieldValue) {
        if (fieldType.isAssignableFrom(Boolean.class)) {
            if (fieldValue instanceof String) {
                return convertStringToBoolean((String) fieldValue);
            }
            if (fieldValue instanceof Number) {
                return !(fieldValue).equals(0);
            }
            return fieldValue;
        }

        else if (fieldType.isAssignableFrom(Double.class)) {
            if (fieldValue instanceof String) {
                return Double.valueOf((String)fieldValue);
            }
            return ((Number) fieldValue).doubleValue();
        }

        else if (fieldType.isAssignableFrom(Long.class)) {
            if (fieldValue instanceof String) {
                return Long.valueOf((String)fieldValue);
            }
            return ((Number) fieldValue).longValue();
        }

        else if (fieldType.isAssignableFrom(Float.class)) {
            if (fieldValue instanceof String) {
                return Float.valueOf((String)fieldValue);
            }
            return ((Number) fieldValue).floatValue();
        }

        else if (fieldType.isAssignableFrom(Integer.class)) {
            if (fieldValue instanceof String) {
                return Integer.valueOf((String)fieldValue);
            }
            return ((Number) fieldValue).intValue();
        }

        else if (fieldType.isAssignableFrom(Short.class)) {
            if (fieldValue instanceof String) {
                return Short.valueOf((String)fieldValue);
            }
            return ((Number) fieldValue).shortValue();
        }

        return fieldValue;
    }

    private static boolean convertStringToBoolean(String s) {
        String trim = s.trim();
        return !trim.equals("") && !trim.equals("0") && !trim.toLowerCase().equals("false");
    }

    private static boolean isValidParams(Object obj, String param) {
        return (obj != null && !isStringNullOrEmpty(param));
    }

    private static boolean isStringNullOrEmpty(String fieldName) {
        return fieldName == null || fieldName.trim().length() == 0;
    }

    private static Field getFieldAccessible(Object obj, String fieldName) {
        Optional<Field> optionalField = getField(obj, fieldName);
        return optionalField
                .map(el -> {
                    el.setAccessible(true);
                    return el;
                })
                .orElseThrow(() -> new IllegalArgumentException("Cannot find field name: " + fieldName));
    }

    private static String convertFieldByAddingPrefix(String fieldName, String prefix) {
        return prefix + fieldName.substring(0, 1).toUpperCase() + fieldName.substring(1);
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T17:57:01.470

您是否可能是指来自不同对象的带有`SecurityManager`集合的不受信任的上下文？那会破坏类型系统，所以你不能。从受信任的上下文中，您可以调用`setAccessible`来破坏类型系统。理想情况下，不要使用反射。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T17:57:37.960

你可以做类似...

```
Class clazz = Class.forName("SuperclassObject");

Field fields[] = clazz.getDeclaredFields();

for (Field field : fields) {
    if (field.getName().equals("fieldImLookingFor")) {
        field.set...() // ... should be the type, eg. setDouble(12.34);
    }
} 
```

如莫里斯的回答中所述，您可能还需要更改可访问性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-10-18T22:37:17.610

**在这个或任何超类中运行任何 getter 的通用实用程序方法。**

改编自[马吕斯的](https://stackoverflow.com/a/13401094/1910555)回答。

```
public static Object RunGetter(String fieldname, Object o){
    Object result = null;
    boolean found = false;
    //Search this and all superclasses:
    for (Class<?> clas = o.getClass(); clas != null; clas = clas.getSuperclass()){
        if(found){
           break;
        }
        //Find the correct method:
        for (Method method : clas.getDeclaredMethods()){
            if(found){
                break;
            }
            //Method found:
            if ((method.getName().startsWith("get")) && (method.getName().length() == (fieldname.length() + 3))){ 
                if (method.getName().toLowerCase().endsWith(fieldname.toLowerCase())){                            
                    try{
                        result = method.invoke(o);  //Invoke Getter:
                        found = true;
                    } catch (IllegalAccessException | InvocationTargetException ex){
                        Logger.getLogger("").log(Level.SEVERE, "Could not determine method: " + method.getName(), ex);
                    }
                }
            }
        }
    }
    return result;
} 
```

希望这对某人有用。

# svn - svn diff 文件中的特定行

> ID：735236
> 
> 赞同：4
> 
> 时间：2009-04-09T17:46:07.410
> 
> 标签：svn, diff

我想确定最后一次在 SVN 版本化文件中更改*特定行的时间。*SVN（或 TortoiseSVN）是否有执行此操作的命令？

我可以编写一个脚本，将每个连续的版本从 HEAD 向后 svn diff，并检查给定行号的行是否不同。但是，如果在所需行之前插入行，但行本身的文本没有改变，这种简单的方法将不起作用。我不是合并理论/差异方面的专家，所以我不知道如何做到这一点。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T17:48:11.040

是的，您要查找的功能称为 Blame，它可以通过 subversion 命令行界面和 TortoiseSVN 界面使用。

# linq - 如何在 LINQ 查询中按属性和聚合动态设置分组？

> ID：735238
> 
> 赞同：0
> 
> 时间：2009-04-09T17:46:33.320
> 
> 标签：linq

我假设我需要使用方法调用语法而不是查询表达式形式，并且我知道后者中分组的基础知识。也许一些专家可以就使用在运行时从配置中获得的组字段和聚合提供警告和建议，以用于类似结构的报告。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T19:17:56.440

你看过动态 Linq 吗？它应该做你想做的事。看看scottgu 博客上的这篇[文章](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:28:04.517

如果您的数据在 xml 中，则 linq to xml 将允许您针对它编写查询，其中某些输入是字符串。

例如：

```
System.Xml.Linq.XElement myData = GetData();

System.Xml.Linq.XElement result = new XElement("Result",
  myData.Elements("Customer")
  .GroupBy(e => e.Attributes("Name"))
  .Select(g => new XElement("CustomerResult",
     new XAttribute("Name" = g.Key,
     new XAttribute("Count" = g.Count(),
     new XAttribute("MinDate" = g.Min(e => e.Date)
  )
 ); 
```

# c# - 从列表中选择单个项目

> ID：735248
> 
> 赞同：24
> 
> 时间：2009-04-09T17:50:59.240
> 
> 标签：c#, linq

如果列表中可能不存在该项目，则使用 LINQ 从列表中选择单个项目的最佳方法是什么？

我想出了两个解决方案，我都不喜欢。我使用 where 子句来选择项目列表（我知道它只会是一个），然后我可以检查计数并在此列表上进行单次调用，如果计数为一，另一种选择是使用 foreach 并且只是拿到物品后休息。

这些似乎都不是一个好方法，有没有更好的方法？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-09T17:55:28.307

您可以使用`IEnumerable.First()`或`IEnumerable.FirstOrDefault()`。

不同之处在于，`First()`如果没有找到元素（或者如果没有元素与条件匹配，如果您使用条件）将抛出。 `FirstOrDefault()`将返回`default(T)`（`null`如果它是引用类型）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-09T17:58:52.980

使用 FirstOrDefault 选择器。

```
var list = new int[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

var firstEven = list.FirstOrDefault(n => n % 2 == 0);

if (firstEven == 0)
    Console.WriteLine("no even number");
else 
    Console.WriteLine("first even number is {0}", firstEven); 
```

**只需将谓词传递给[First](http://msdn.microsoft.com/en-us/library/bb291976.aspx)或[FirstOrDefault](http://msdn.microsoft.com/en-us/library/bb340482.aspx)方法**，它就会愉快地遍历列表并为您选择第一个匹配项。

如果不匹配，FirstOrDefault 将返回列表项的任何数据类型的默认值。

希望这可以帮助 ：-）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-09T17:57:09.990

```
List<string> items = new List<string>();

items.Find(p => p == "blah"); 
```

或者

```
items.Find(p => p.Contains("b")); 
```

但这允许您通过匹配谓词定义要查找的内容...

我想如果你说的是 linqToSql 那么：

例如寻找帐户...

```
DataContext dc = new DataContext();

Account item = dc.Accounts.FirstOrDefault(p => p.id == 5); 
```

如果您需要确保只有 1 个项目（超过 1 个时抛出异常）

```
DataContext dc = new DataContext();

Account item = dc.Accounts.SingleOrDefault(p => p.id == 5); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T17:55:37.090

也许我在这里遗漏了一些东西，但通常调用`.SingleOrDefault()`是返回列表中的单个元素的方法，或者如果列表为空，则返回默认值（用于引用或可为空类型的 null）。如果列表包含多个元素，则会生成异常。

用于`FirstOrDefault()`覆盖您可能拥有多个的情况。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-09T18:04:53.980

只是为了完成答案，如果您使用的是 LINQ 语法，则可以将其包装起来，因为它返回一个 IEnumerable：

```
(from int x in intList
 where x > 5
 select x * 2).FirstOrDefault() 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-09T17:57:20.597

有两种简单的方法，具体取决于您是要处理异常还是获取默认值。

您可以使用`First<T>()`或`FirstOrDefault<T>()`扩展方法来获得第一个结果 或`default(T)`。

```
var list = new List<int> { 1, 2, 4 };
var result = list.Where(i => i == 3).First(); // throws InvalidOperationException
var result = list.Where(i => i == 3).FirstOrDefault(); // = 0 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T18:02:08.807

`SingleOrDefault()`是你需要的

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-01-12T18:03:37.663

现在才看到这个，如果你正在使用一个对象列表，你可以试试这个

```
 public class user
{
    public string username { get; set; }
    public string password { get; set; }
}

  List<user> userlist = new List<user>();

        userlist.Add(new user { username = "macbruno", password = "1234" });
        userlist.Add(new user { username = "james", password = "5678" });
        string myusername = "james";
        string mypassword = "23432";

  user theUser = userlist.Find(
            delegate (user thisuser)
            {
                return thisuser.username== myusername && thisuser.password == mypassword;
            }
            );

            if (theUser != null)
            {
               Dosomething();
            }
            else
            {
                DoSomethingElse();

            } 
```

# c++ - 阻塞套接字返回 EAGAIN

> ID：735249
> 
> 赞同：7
> 
> 时间：2009-04-09T17:51:01.877
> 
> 标签：c++, c, linux, sockets

我在 Linux 上的一个项目使用阻塞套接字。事情是连续发生的，所以非阻塞只会让事情变得更复杂。无论如何，我发现经常有一个电话`recv()`返回set to 。`-1``errno``EAGAIN`

该`man`页面只真正提到了非阻塞套接字的这种情况，这是有道理的。使用非阻塞，套接字可能可用也可能不可用，因此您可能需要重试。

**什么会导致阻塞套接字发生这种情况？我能做些什么来避免它吗？**

目前，我处理它的代码看起来像这样（我让它在错误时抛出异常，但除此之外它是一个非常简单的包装器`recv()`）：

```
int ret;
do {
    ret = ::recv(socket, buf, len, flags | MSG_NOSIGNAL);
} while(ret == -1 && errno == EAGAIN);

if(ret == -1) {
    throw socket_error(strerror(errno));
}
return ret; 
```

**这甚至正确吗？**这种`EAGAIN`情况经常受到打击。

**编辑：**我注意到的一些可能相关的事情。

1.  我确实使用 设置了套接字上的读取超时`setsockopts()`，但它设置为 30 秒。的`EAGAIN`发生频率超过每 30 秒一次。**更正**我的调试有缺陷，`EAGAIN`并没有像我想象的那样经常发生。也许是超时触发。

2.  对于连接，我希望能够有连接超时，所以我暂时将套接字设置为非阻塞。该代码如下所示：

    ```
    int      error = 0;
    fd_set   rset;
    fd_set   wset;
    int      n;
    const SOCKET sock = m_Socket;

    // set the socket as nonblocking IO
    const int flags = fcntl (sock, F_GETFL, 0);
    fcntl(sock, F_SETFL, flags | O_NONBLOCK);

    errno = 0;

    // we connect, but it will return soon
    n = ::connect(sock, addr, size_addr);

    if(n < 0) { 
        if (errno != EINPROGRESS) {
            return -1;
        }
    } else if (n == 0) {
        goto done;
    }

    FD_ZERO(&rset);
    FD_ZERO(&wset);
    FD_SET(sock, &rset);
    FD_SET(sock, &wset);

    struct timeval tval;
    tval.tv_sec = timeout;
    tval.tv_usec = 0;

    // We "select()" until connect() returns its result or timeout
    n = select(sock + 1, &rset, &wset, 0, timeout ? &tval : 0);
    if(n == 0) {    
        errno = ETIMEDOUT;
        return -1;
    }

    if (FD_ISSET(sock, &rset) || FD_ISSET(sock, &wset)) {
        socklen_t len = sizeof(error);
        if (getsockopt(SOL_SOCKET, SO_ERROR, &error, &len) < 0) {
            return -1;
        }
    } else {
        return -1;
    }

    done:
    // We change the socket options back to blocking IO
    if (fcntl(sock, F_SETFL, flags) == -1) {
        return -1;
    }
    return 0; 
    ```

这个想法是我将它设置为非阻塞，尝试连接并在套接字上选择，这样我就可以强制超时。set 和 restore`fcntl()`调用都成功返回，因此当此函数完成时，套接字应该再次进入阻塞模式。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-09T18:17:25.337

您可能在套接字（通过`setsockopt(sock, SOL_SOCKET, SO_RCVTIMEO,...)`）上设置了非零接收超时，因为这也会导致 recv 返回`EAGAIN`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:03:33.920

您正在使用的是否有可能`MSG_DONTWAIT`被指定为标志的一部分？如果没有可用数据并且指定了此标志，页面将显示`man`。`EAGAIN`

如果您真的想强制阻止直到`recv()`有点成功，您可能希望使用该`MSG_WAITALL`标志。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T18:11:32.607

我不建议将此作为第一次尝试修复，但如果您没有任何选择，您始终可以`select()`在套接字上设置相当长的超时时间来强制它等待数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-10-21T19:02:49.850

`EAGAIN`由操作系统生成，几乎就像“糟糕！很抱歉打扰您。”。如果出现此错误，您可以尝试再次阅读，这不是严重或致命错误。我已经看到这些中断发生在 Linux 和 LynxOS 中，每天 1 到 100 次不等。

# asp.net - 审核和记录 ASP.NET Web 应用程序上的全部或选择性用户输入。你会怎么做？

> ID：735257
> 
> 赞同：0
> 
> 时间：2009-04-09T17:54:49.993
> 
> 标签：asp.net, logging, user-interface, breadcrumbs

我正在构建 UI 登录到一个长期存在的 ASP.NET 企业应用程序。我对如何从这里取得进步有自己的想法，并且正在继续研究和设计。但我很想听听 SO 社区的一些细节。

以下是目前的细节、假设和问题，可能会在企业内部发展，以及关于 SO 的任何输入：

*   希望有一个一致的数据库连接，因为会有很多活动

*   可能会使用 ThreadPool，但是这会不会与 ASP.NET 争夺线程的冲突太大？

*   可能使用内存队列（Queue）定期记录输入批次？（每个域一个）

*   将需要可配置。IE：可以在其正常的回发调用期间记录所有页面事件，或者将单个控制操作或事件挂钩到被记录，无论是否有回发。IE：用户折叠面板。

*   所有已经发回的“高可见度”UI 事件以及不需要立即发回的其他事件。有一批客户事件并偶尔发送？

*   我们如何最小化对现有代码的影响？

*   有相应回发的“飞上墙”AJAX 功能吗？它基本上会监视所有配置为记录的内容。

*   必须订购日志记录以报告用户在工作流中从 A 点到 B 点的逐步进度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T18:06:22.383

与 PostSharp 属性配对的执行实际日志记录的 WCF 服务怎么样。在您的 PostSharp 属性中，您可以在应用程序运行时异步调用 WCF 服务。我在过去的项目中实现了类似的东西，它运行良好，即使没有放慢速度也很少。

[http://www.postsharp.org/](http://www.postsharp.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:18:27.817

为什么不使用[log4net](http://logging.apache.org/log4net/index.html)？您可以捕获用户 ID、会话 ID 以及跟踪逐步进度所需的任何其他信息。您可以配置级别，以便在影响性能时减少日志记录。当有几个可行的现有日志框架时，我不会考虑通过编写自己的框架来重新发明轮子。

# visual-studio-2008 - 有没有办法让 Visual Studio 在移动设备上调试唤醒事件？

> ID：735273
> 
> 赞同：0
> 
> 时间：2009-04-09T17:58:04.027
> 
> 标签：visual-studio-2008, windows-mobile

我们正在尝试为 Windows Mobile 开发应用程序，但在调试设备从睡眠中唤醒后会发生什么时遇到问题。当设备休眠时，调试器会断开连接，因此我们无法调试唤醒事件。有没有办法让VS不断开连接？或者在设备被唤醒时重新建立连接的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T20:54:00.813

不，没有办法做到这一点。即使从操作系统的角度来看，“唤醒”事件也是一些最难调试的事情，您通常使用 JTAG 调试器。您唯一真正的选择是大量的日志记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T21:47:10.387

我可能会讨厌这个，但是`Sleep(30 * 1000)`在麻烦的代码之前呢？（假设您正在编写一个普通的用户级应用程序。） 30 秒应该足以连接调试器并将其附加到您的进程，以便您可以调试。

# documentation - 为什么 Squeak 使用颜色来识别鼠标按钮？

> ID：735282
> 
> 赞同：5
> 
> 时间：2009-04-09T18:01:22.507
> 
> 标签：documentation, smalltalk, squeak

当您尝试遵循文档[Squeak by Example](http://squeakbyexample.org/)时，这真的很烦人。

它们不像在任何其他文档中那样调用鼠标左键、右键和中键，而是赋予它们颜色。甚至建议标记鼠标以帮助您学习。

现在是 2009 年，剩下 3 个主导系统：Windows、MacOS X、Linux

为什么他们仍然坚持这种命名方案？我应该如何将其出售给同事甚至客户？

来自 Squeak 的例子：

> [Squeak](http://www.squeak.org/)避免使用“鼠标左键”之类的术语，因为不同的计算机、鼠标、键盘和个人配置意味着不同的用户需要按下不同的物理按钮才能达到相同的效果。相反，鼠标按钮标有颜色。您按下以获得“世界”菜单的鼠标按钮称为红色按钮；它最常用于选择列表中的项目、选择文本和选择菜单项。当您开始使用 Squeak 时，实际标记您的鼠标会非常有用，如图 1.4 所示。

![图 1.4](https://i.imgur.com/SucRVpF.png)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T18:42:38.210

按钮颜色可能可以追溯到施乐（鼠标发明的地方）的实验。所以也许问题应该是“为什么现在的计算机有无色的鼠标按钮？” :D

至于坚持使用书中的颜色，我认为原因是代码中仍然提到了颜色，并且根据平台的不同，颜色并不总是映射到相同的手指上。但我同意，颜色系统不是很实用；可能最好的方法是使用主要/次要/三级按钮？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T19:02:28.817

那是您对一粒盐采取的措施之一。:) 前几天我读到了，我当然不会特意为我的鼠标添加一些彩色按钮。

只是精神上用“左键单击”代替红色等。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-11T16:18:24.920

这太荒谬了。左和右已经是抽象的概念。用颜色命名按钮是抽象的抽象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:26:16.347

避免使用左右标签，因为惯用左手的人会将按钮颠倒。左键单击鼠标右键是什么意思？程序应该执行它的右键单击动作还是它的左键单击动作。如果我们只是简单地交换映射，那么对程序员来说，左右变得毫无意义。

我假设 Squeak 的设计者想要避免这个棘手的问题，所以动作被标记为与右/左无关的颜色。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T18:34:57.650

Squeak 是一个 SmallTalk 工具。显然，他们觉得有必要将按钮抽象为不那么具体的东西。

看起来他们已经模糊了现实和代码结构之间的界限。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-25T15:06:20.220

这个遗产是如此 70 年代，我希望 Pharo 能解决这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T19:50:47.077

与 Damien 所说的相反，鼠标不是 Xerox 发明的。相反，它是由 Douglas Engelbart 领导的斯坦福研究所的团队发明的，作为他们革命性的 ONLINE 系统的一部分。

按钮的颜色是一个古老的惯例，我个人倾向于不太注意。不过，关于您发布的那张图片的奇怪之处在于，右边的按钮（Smalltalk 用语中的“黄色”）看起来比黄色更绿——至少对我来说是这样。在其他人看来是这样吗？也许这就是为什么在其他地方放弃了着色约定的部分原因（同样应该在 Squeak 中放弃）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-04T06:47:17.513

引用的段落也在答案中得到了回应：“左键单击”可能来自也可能不是来自左侧的按钮 - 而“右键单击”可能来自也可能不是来自右侧的按钮.

我最讨厌的是“第三个按钮”——它几乎总是在中间。顺序不是 1-3-2 而是 1-2-3。也许第三个按钮也应该是一种颜色......

# batch-file - 如何在批处理脚本中等待？

> ID：735285
> 
> 赞同：178
> 
> 时间：2009-04-09T18:01:46.187
> 
> 标签：batch-file

我正在尝试编写一个批处理脚本并尝试在 2 个函数调用之间等待 10 秒。命令：

```
sleep 10 
```

不让批处理文件等待 10 秒。

我正在运行 Windows XP。

**注意：**这不是[在批处理文件中睡眠](https://stackoverflow.com/questions/166044)的完整副本，因为另一个问题也是关于 python 的，而这是关于 windows 批处理文件的。

* * *

## 回答 #1

> 赞同：277
> 
> 时间：2009-04-09T18:04:37.473

您可以 ping 一个不存在的地址并指定所需的超时时间：

```
ping 192.0.2.2 -n 1 -w 10000 > nul 
```

由于地址不存在，它会等待 10,000 毫秒（10 秒）然后返回。

*   该`-w 10000`部分以毫秒为单位指定所需的超时。
*   该`-n 1`部分告诉 ping 它应该只尝试*一次*（通常它会尝试 4 次）。
*   该`> nul`部分已附加，因此 ping 命令不会向屏幕输出任何内容。

您可以通过在 PATH 中的某处创建 sleep.bat 并使用上述技术轻松地自己制作睡眠命令：

```
rem SLEEP.BAT - sleeps by the supplied number of seconds

@ping 192.0.2.2 -n 1 -w %1000 > nul 
```

* * *

**注意（2002 年 9 月）：** 192.0.2.x 地址根据[RFC 3330](http://smakd.potaroo.net/ietf/idref/rfc3330/)保留，因此它在现实世界中绝对不存在。引用规范：

> 192.0.2.0/24 - 此块被分配为“TEST-NET”，用于文档和示例代码。在供应商和协议文档中，它通常与域名 example.com 或 example.net 结合使用。此块内的地址不应出现在公共互联网上。

* * *

## 回答 #2

> 赞同：144
> 
> 时间：2009-04-09T19:30:11.793

你最好 ping *127.0.0.1*。Windows ping 在 ping 之间暂停一秒钟，所以如果你想睡 10 秒，请使用

```
ping -n 11 127.0.0.1 > nul 
```

这样您就不必担心意外的提前返回（例如，没有默认路由，并且 123.45.67.89 立即已知是无法访问的。）

* * *

## 回答 #3

> 赞同：132
> 
> 时间：2009-04-09T19:39:56.060

我实际上找到了正确的命令来使用..它称为超时：[http ://www.ss64.com/nt/timeout.html](http://www.ss64.com/nt/timeout.html)

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2009-09-20T01:56:38.000

我用这个

```
:top
cls
type G:\empty.txt
type I:\empty.txt
timeout /T 500
goto top 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-04-06T07:22:55.080

关于什么：

```
@echo off
set wait=%1
echo waiting %wait% s
echo wscript.sleep %wait%000 > wait.vbs
wscript.exe wait.vbs
del wait.vbs 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-09T18:04:48.207

那么，`sleep`甚至存在于您的 Windows XP 机器上吗？根据这篇文章：[http](http://malektips.com/xp_dos_0002.html) `sleep` ://malektips.com/xp_dos_0002.html在 Windows XP 上不可用，您必须下载[Windows 2003 Resource Kit](http://en.wikipedia.org/wiki/Resource_Kit#Windows_Resource_Kits)才能获得它。

Chakrit 的回答也为您提供了另一种暂停的方式。

尝试`sleep 10`从命令提示符运行。

# msbuild - 如何让 Cruise Control 通过电子邮件发送来自 Gallio(MbUnit) 的单元测试结果？

> ID：735286
> 
> 赞同：1
> 
> 时间：2009-04-09T18:01:47.217
> 
> 标签：msbuild, continuous-integration, cruisecontrol.net, mbunit, gallio

我有一个构建服务器，它使用 Cruise Control 来运行我们的测试用例。我已成功配置 ccnet 1.4.2 以在 webdashboard 中显示 Gallio 测试结果，但我似乎无法让 ccservice 在自动生成的电子邮件中通过电子邮件发送 Gallio 测试结果。我曾尝试编辑 .xsl 文件，但无济于事。我正在合并 MsBuild Gallio 任务的 .xml 输出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T19:46:04.113

如果您可以让它在 Web 仪表板上随心所欲地显示，那么您就很接近了。现在您只需将仪表板中的 xsl 工作表添加到构建服务器上的 xsl 文件夹中，并在任一服务 (ccservice.exe. config) 或控制台 (ccnet.exe.config) 配置文件。并且为了良好的内务管理并防止以后出现错误，您实际上应该将它包含在两者中。

# jquery - 在具有浮动元素和绝对定位元素的元素上使用 jQuery fadeOut 函数时的奇怪行为

> ID：735292
> 
> 赞同：4
> 
> 时间：2009-04-09T18:03:56.227
> 
> 标签：jquery, jquery-1.3

我正在尝试使用 jQuery 淡出 div，使用 fadeOut 函数。在大多数情况下，它似乎工作正常，但在某些情况下，并非所有内容都会淡出。如果我在 div 中有一个绝对定位的元素和一个浮动元素，那么 fadeOut 函数将不起作用。如果我只有一个绝对定位的元素，它就不起作用。但是如果我有一个绝对定位的元素和一个无样式的元素，它就可以工作。这听起来很难解释，但您可以使用以下测试代码自己尝试：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<title>jQuery fadeOut test</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="jquery-1.3.2.min.js"></script>
</head>
<body>
<div id="testBox1" style="position: relative">
    <div>test</div>
    <p style="position: absolute; left: 0; top: 0">This text should fade out.</p>
</div>
<br><br>
<button type="button" onclick="$('#testBox1').fadeOut()">fade out</button>
<!-- works -->
<hr>

<div id="testBox2" style="position: relative">
    <div style="float: left">test</div>
    <p style="position: absolute; left: 0; top: 0">This text should fade out.</p>
</div>
<br><br>
<button type="button" onclick="$('#testBox2').fadeOut()">fade out</button>
<!-- doesn't work -->
<hr>

<div id="testBox3" style="position: relative">
    <p style="position: absolute; left: 0; top: 0">This text should fade out.</p>
</div>
<br><br>
<button type="button" onclick="$('#testBox3').fadeOut()">fade out</button>
<!-- doesn't work -->
</body></html> 
```

[此处的工作示例](http://jsbin.com/obipe)（将**/edit**添加到 URL 以使用示例）。

在 IE7 中似乎一切正常，但在 Firefox 和 Chrome 中，我遇到了奇怪的行为。谁能弄清楚为什么？我做错了什么，还是浏览器错误或 jQuery 中的错误？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T18:15:00.507

这是 1.3.2 中的一个错误。我没有看到 1.3 中的行为。

将您的 jQuery 脚本指向

[http://jqueryjs.googlecode.com/files/jquery-1.3.min.js](http://jqueryjs.googlecode.com/files/jquery-1.3.min.js)

你会看到问题消失了。

这是一个固定的例子：

[http://jsbin.com/olule/edit](http://jsbin.com/olule/edit)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-20T20:30:51.130

问题是由 jQuery 1.3.2 检测可见元素的方式引起的。fadeOut() 函数首先使用 is(":visible") 检测给定元素是否可见。如果它发现元素被隐藏，它不会做任何事情。根据文档，jQuery 1.3.2 引入了一个更改，其中“如果元素及其父元素占用文档中的空间，则元素假定为可见”。现在，问题是如果元素只包含浮动元素或绝对定位元素，它本身不占用空间（它的宽度和高度为零）。你可以通过给元素一些非零的高度和宽度来解决这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-26T11:13:29.497

添加`&nbsp;`元素对我有用，但我希望他们能尽快修复它。

# php - 在 PHP 中处理字符串

> ID：735298
> 
> 赞同：1
> 
> 时间：2009-04-09T18:05:06.163
> 
> 标签：php, arrays

我需要一种对 PHP 中的字符串进行排序的方法，该字符串的格式如下所示，但要大得多。

```
{ 1, 3, 1, 2, }, { 2, 3, 2, 1, }, { 3, 3, 2, 2, }, { 1, 2, 3, 1, }, 
```

我需要它做的是将括号中的每组数字转换为一个数组。所以在这种情况下，将有四个数组，每个数组中有四个值。

第一个数组如下所示：

```
array1[0] == 1
array1[1] == 3
array1[2] == 1
array1[3] == 2 
```

我将如何做到这一点？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-09T18:14:31.320

```
$inbound = "{ 1, 3, 1, 2, }, { 2, 3, 2, 1, }, { 3, 3, 2, 2, }, { 1, 2, 3, 1, }";
$inbound = trim(preg_replace("/,\\s*}/i", "}", $inbound), " ,");
$inbound = str_replace("{", "[", $inbound);
$inbound = str_replace("}", "]", $inbound);

$array_of_arrays = json_decode('[' . $inbound . ']'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T18:28:40.147

我无法评论（<50），但对于 Sean Bright，空白回声的问题是 json_decode 不喜欢 [].. 内的尾随“，”。

编辑 ：

$inbound = str_replace(array('{', ', }'), array('[', ']'), $inbound);

修复。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T18:13:40.837

我想我会用大括号分开，然后用逗号分开。那将是编写代码的最简单方法（可能无论如何，取决于您的观点），但就复杂性而言不是最有效的。

最有效的方法是遍历数组，在找到逗号或大括号时执行不同的操作：

```
 arrayOfArrays = new Array()
 masterIndex = 0
 arrayOfArrays[masterIndex] = new Array()

 for char c in string
   if c == '}'
     masterIndex++
     arrayOfArrays[masterIndex] = new Array()
   else if c == ','
     append num to arrayOfArrays[masterIndex]
   else if c is whitespace
     noop
   else
     append c to num 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T18:17:53.853

```
$str = "{ 1, 3, 1, 2, }, { 2, 3, 2, 1, }, { 3, 3, 2, 2, }, { 1, 2, 3, 1, },";
$matches = array();
$nArrays = preg_match_all('/{(.*)}/U',$str, $matches);
for($i=1;$i<=$nArrays; $i++) {
  $aArray = array(); 
  $nNums = preg_match_all('/(\d+)/',$matches[$i],$aArray);
  ${'array'.$i} = array();
  for($j=0;$j<=$nNums; $j++) {
    ${'array'.$i}[$j] = $aArray[$j+1];
  }  
} 
```

# c++ - 添加 fmod Visual C++ 测试后，如果某个测试中的某些代码行，所有测试都失败、无法获取类型和 FileNotFoundException

> ID：735299
> 
> 赞同：3
> 
> 时间：2009-04-09T18:05:29.780
> 
> 标签：c++, clr, mstest, fmod

我已经弄清楚是什么导致了这个问题，但我仍然不知道为什么——它发生在我开始`fmod`使用`.dll`. 我的测试代码是一个静态库；它指的是`fmodex_vc`另一个静态库，它在某个时候（虽然我不知道什么时候）决定加载它的`fmodex.dll`. （它和其他所有东西都在同一个目录中，所以我不知道为什么它找不到它。）据我所知，被测代码绝对不会调用 fmod 初始化函数，但也许 fmod 有一些初始化自身并加载到 dll 中的静态全局初始化程序？只有当使用它的模块中的代码被……使用时，该代码才会被拉入？

我正在使用 Visual Studio 测试框架测试非托管 C++ 代码，当我开始使用 fmod 时它停止工作：每个测试，甚至是什么都不做的“测试”测试，都会报告（为便于阅读而包装）：

```
Unable to get type SlidersTest.UnitTest1, SlidersTest.
    Error: System.IO.FileNotFoundException: 
    The specified module could not be found.
    (Exception from HRESULT: 0x8007007E) 
```

经过大量试验和错误，排除`.cpp`文件并重新添加它们，我发现只有一个测试文件引发了问题；并且只有在调用此行时才会这样做：

```
EntityMgr::Init(); 
```

有趣的是，如果该行在代码中 ，则*所有测试都会以该消息开始失败。*`EntityMgr::Init()`是一个很少做的函数：

```
EntityMgr* EntityMgr::instG = null; 
```

和

```
void EntityMgr::Init()
{
   instG = new EntityMgr;
} 
```

和

```
class EntityMgr
{
private:
   static EntityMgr* instG;
public:
   EntityMgr()   // does nothing beyond the default 
   {
   }

   static void Init();
   static EntityMgr* Inst() { return instG; }

   ...

   vector<Entity> entitiesG;
}; 
```

`Entity`, FWIW, 是一个非常普通的类，没有指针，`float`它的字段只有各种 s。

*   无论我如何运行测试（从测试视图、运行选定、运行全部、从命令行运行、从测试菜单），我都会收到错误消息。
*   尝试使用调试器进入测试失败 - 测试在调试器进入之前失败。将调试器设置为在系统异常上中断也无济于事。
*   被测代码是一个静态 .lib。CLR 支持是`/clr`.
*   哦，这只是：如果我调用一个静态实体成员函数，同样的处理。如果我将所说的静态函数移到课堂之外，同样的处理。但是，如果我将该功能移至另一个模块，那就没问题了。

如果我将调试器设置为中断任何异常，我会得到一些有趣的东西：

```
First-chance exception at 0x7c812aeb in vstesthost.exe: Microsoft C++ exception: HRException at memory location 0x05129890.. 
```

当然，那个位置没有源代码。这是调用堆栈：

```
 kernel32.dll!7c812aeb()    
    [Frames below may be incorrect and/or missing, no symbols loaded for kernel32.dll]  
    kernel32.dll!7c812aeb()     
    [External Code] 
    msvcr80.dll!78158ed7()  
    msvcr80.dll!78158e34()  
    msvcr80.dll!78158047()  
    msvcr80.dll!7815850e()  
    msvcr80.dll!78158872()  
    msvcr80.dll!78158a57()  
    msvcr80.dll!78158b11()  
    ntdll.dll!7c9032a8()    
    ntdll.dll!7c90327a()    
    ntdll.dll!7c92a9ef()    
    ntdll.dll!7c90e46a()    
    kernel32.dll!7c812aeb()     
    kernel32.dll!7c812aeb()     
    kernel32.dll!7c812aeb()     
    msvcr80.dll!78139c4d()  
    msvcr80.dll!781323ff()  
    msctf.dll!74755764()    
    msctf.dll!74721557()    
    ws2_32.dll!71ab12bb()   
    ntdll.dll!7c90118a()    
    ntdll.dll!7c91b084()    
    ntdll.dll!7c90de7c()    
    ntdll.dll!7c90d04c()    
    ntdll.dll!7c90e43f()    
    kernel32.dll!7c80b713() 
```

这是 mstest 报告的堆栈跟踪 - 我没有从中得到任何有用的信息。

```
Unable to get type SlidersTest.game_EntityMgr_test, SlidersTest. Error: System.IO.FileNotFoundException: The specified module could not be found. (Exception from HRESULT: 0x8007007E)
   at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark& stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)
   at System.Reflection.Assembly.nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark& stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)
   at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark& stackMark, Boolean forIntrospection)
   at System.Reflection.Assembly.InternalLoadFrom(String assemblyFile, Evidence securityEvidence, Byte[] hashValue, AssemblyHashAlgorithm hashAlgorithm, Boolean forIntrospection, StackCrawlMark& stackMark)
   at System.Reflection.Assembly.LoadFrom(String assemblyFile)
   at Microsoft.VisualStudio.TestTools.TestTypes.Unit.UnitTestExecuter.GetType(UnitTestElement unitTest, String type)
   at Microsoft.VisualStudio.TestTools.TestTypes.Unit.UnitTestExecuter.ResolveMethods(). 
```

为什么 fmod 这样做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T03:06:54.753

我建议在 Dependency Walker 的 Profile 模式下运行您的应用程序 ( [http://www.dependencywalker.com/](http://www.dependencywalker.com/) )。它可以记录所有加载 DLL 和 EXE 的尝试，以及生成的错误代码——听起来“找不到文件”错误可能来自间接依赖——可能是从链接 FMod 中提取的。

如果是这种情况，使用 Dependency Walker 分析您的应用程序将显示一次或多次失败的加载库尝试。其中之一将是对错误负责的人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T15:25:20.827

您能否将 Visual Studio 设置为中断所有异常，无论它们在调试期间来自何处？

听起来好像宇宙射线或有故障的硬盘驱动器已导致测试 .dll 损坏，或者您正在构建的 dll 已损坏（始终如一）。在重新安装所有 Visual Studio 之前，您可能需要要求它进行修复，这应该检查您当前安装和安装介质上的内容之间的不一致。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T14:00:56.660

FMod .dll 如何进入您的测试目录？您是否已将其设置为将其复制到 mstest 希望进行测试的任何地方？请注意，“复制到输出目录”实际上并没有实现这一点。还有一些其他的方法，虽然我不记得它是什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T15:38:58.207

我会在调试器中运行它并检查运行输出 - 特别是“加载路径\fmodex.dll”行，看看它是否正在加载正确的 dll。

在混合来自不同配置的 dll 时，我看到过类似的错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T19:51:50.370

也许为该文件修改了某些属性？可能已经看过这个，但请确保所有设置都来自 Visual Studio 中的“从父级继承”。

周杰伦

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T20:06:11.457

我最好的猜测，从你到目前为止发布的内容来看，异常是在 CLR 类型加载器中的某个地方抛出的——它看起来像一个你间接依赖的程序集，要么不在 GAC 中，要么不在t 被复制到测试目录。

测试结果中是否有实际的堆栈跟踪？这可能有助于缩小它尝试加载的类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-10T12:31:48.483

既然你说这突然发生了，我假设使用这行代码的测试以前工作得很好。这可能是一个激进的选择，但在没有其他解决方案的情况下，也许您会考虑重新安装 Visual Studio（肯定是一个漫长的过程）

# sql - SQL Server 2005 存储过程性能问题

> ID：735306
> 
> 赞同：4
> 
> 时间：2009-04-09T18:06:42.743
> 
> 标签：sql, sql-server, sql-server-2005, performance, stored-procedures

我有以下问题：当从我的应用程序调用存储过程时，不时地（比如 1000 次调用中的 1 次），需要 10-30 秒才能完成。通常，存储过程在一秒钟内运行。这是一个相当简单的过程，只有一个选择将几个表联系在一起。所有表名都设置有 (NOLOCK) 提示，因此它可能没有锁定。索引也都到位了，否则它会一直很慢。

问题是我无法在 SSMS 中复制这个问题（因为它总是运行亚秒级），无论它运行多少次存储过程，但是当我将分析器指向运行我的应用程序的用户时，我看到了问题。SSMS 中的查询计划似乎是正确的，但问题仍然存在。

我从这里去哪里？我该如何调试这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T18:23:00.597

一些选项：

*   探查器或`SET STATISTICS xx ON`说什么？是否只是资源匮乏，比如 CPU

*   引擎决定统计数据已过期。表的变化是否有 10% 的行数变化（经验法则）。去测试：

    ```
    SELECT
        name AS stats_name, 
        STATS_DATE(object_id, stats_id) AS statistics_update_date
    FROM
        sys.stats 
    WHERE
        object_id IN (OBJECT_ID('relevanttable1'), OBJECT_ID('relevanttable2')) 
    ```

*   服务器上还发生了什么？示例：索引重建：不阻塞，只是资源密集型。

通常我会建议参数嗅探，但你说每次调用的参数都是相同的。我也希望它会更频繁地发生。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T18:59:29.713

*   在数据库上自动增长？检查 SQL 错误日志中的消息。
*   由于插入记录而导致页面拆分？使用 DBCC SHOWCONTIG 检查表碎片
*   防病毒扫描？不。
*   过时的统计数据？不要依赖变化很大的表的自动更新统计信息。
*   不要排除客户端或它们之间的网络问题。
*   使用持续时间过滤器运行分析器，仅捕获持续时间 > 10 秒的事件，在参数、客户端、一天中的时间中查找模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T18:17:29.800

我将在 SQL Server Profiler 中设置跟踪，以查看您的应用程序用于连接的 SET 选项设置，以及 SSMS 中使用的设置。通过 SET 选项设置，我的意思是

```
ARITHABORT
ANSI_NULLS
CONCAT_NULL_YIELDS_NULL
//etc 
```

查看[MSDN](http://msdn.microsoft.com/en-us/library/ms190707(SQL.90).aspx)以获取选项表

我之前看到过问题，SSMS 和应用程序之间使用的设置选项不同（在这种特殊情况下，它是`ARITHABORT`）并且性能差异很大（实际上，应用程序会因某些查询而超时，具体取决于参数值）。

这将是我建议开始调查的地方。通过设置跟踪，您将能够查看哪些特定调用花费的时间更长以及正在使用的参数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:08:15.827

在运行缓慢的情况下，传递给 proc 的参数有什么不同吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T19:12:35.767

您绝对确定这是数据库查询，而不是代码中的其他一些相邻逻辑吗？（即您是否在前后放置了带时间戳的“跟踪”语句？）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T22:34:22.507

Russ 的建议对我来说最有意义，因为听起来您已经查看了分析器以验证计划是否已优化等等。

我还会注意数据类型强制。即当varchar(60) 参数与varchar(80) 数据进行比较和索引时，我看到了类似的问题。在某些情况下，SQL Server 会失去理智并强制扫描而不是搜索——不过，我相信在这种情况下，您通常会在执行计划中看到这种事情发生。

可悲的是，另一个潜在的罪魁祸首（我有点担心把它扔掉，因为它可能是一个红鲱鱼）是超线程。我在过去看到它做非常相似的事情 [ [1](http://sqladvice.com/blogs/repeatableread/archive/2007/02/13/Burned-again-by-HyperThreading-on-SQL-Server-2000.aspx) ]。

1 [http://sqladvice.com/blogs/repeatableread/archive/2007/02/13/Burned-again-by-HyperThreading-on-SQL-Server-2000.aspx](http://sqladvice.com/blogs/repeatableread/archive/2007/02/13/Burned-again-by-HyperThreading-on-SQL-Server-2000.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T22:41:15.860

重新编译存储过程然后看看会发生什么。这实际上有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T09:08:25.243

我也有类似的性能问题。将**WITH RECOMPILE**添加到 SP 有帮助。

这不是我一直在寻找的解决方案，但到目前为止我还没有找到更好的解决方案......

请参阅： [SqlDataReader 性能缓慢](https://stackoverflow.com/questions/663050/slow-performance-of-sqldatareader)

# sql-server - 从历史 EAV 数据库中查询的最快方法是什么

> ID：735308
> 
> 赞同：1
> 
> 时间：2009-04-09T18:07:39.120
> 
> 标签：sql-server, performance, entity-attribute-value, rank

标准 EAV 模式：一列用于实体 ID，一列用于属性 ID，一列用于值 ID。

历史 EAV 架构：为时间/日期范围添加额外的列

在运行时，某些行将被排除。每个实体、每个属性可能返回 0、1 或许多行。我们只希望保留每个属性的最新值。

我们当前的解决方案是使用 SQL Server Rank() 函数为每一行标记一个排名，然后在 where 子句中我们有“and rank = 1”。

但是，性能并不令人满意。在分析过程中，我们发现分配排名非常快，但是针对排名执行 where 子句需要对数据进行第二次扫描，并将整个数据集保存在 RAM 中。

对剩余属性行进行排名并仅返回最新的最快方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T04:33:03.370

虽然我认为 gbn 的答案可能就足够了，但我想知道是否使用 OVER 子句来为每个 id/attribute 建立一个 MAX 日期，以减少 WHERE 子句中的 SELECT 不会比 RANK 快？没有时间测试性能，但这里是查询：

```
select * 
from (
  select *, max(dt) over (partition by eID, aID) maxdt 
    from table
) t
where t.dt = t.maxdt and ... 
```

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:28:49.163

一般的想法是首先提取最新的 + 键，然后再加入以获取不属于聚合的值。它是 EAV 的事实并不重要。

```
SELECT
    *
FROM
    table t
    JOIN
    (SELECT MAX(dt) AS mdt, eID, aID FROM table GROUP BY eID, aID) mt
                     ON t.eID = mt.eID AND t.aID = mt.aID AND t.dt = mt.mdt
WHERE
    ... 
```

# c# - 哈希表/字典冲突

> ID：735317
> 
> 赞同：4
> 
> 时间：2009-04-09T18:11:32.623
> 
> 标签：c#, string, math, dictionary, hashtable

仅使用标准英文字母和下划线，最多可以使用多少个字符而不会导致哈希表/字典中的潜在冲突。

所以字符串如下：

```
blur
Blur
b
Blur_The_Shades_Slightly_With_A_Tint_Of_Blue 
```

...

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-09T18:15:36.793

不能保证单个字母之间不会发生冲突。

您*可能*不会，但未`string.GetHashCode`指定其中使用的算法，并且可能会更改。（特别是它在 .NET 1.1 和 .NET 2.0 之间发生了变化，这让那些认为它不会改变的人感到很痛苦。）

请注意，哈希码冲突不会阻止精心设计的哈希表工作 - 您仍然应该能够获得正确的值，如果它们具有相同的哈希值，则可能需要使用相等性检查多个键代码。

任何依赖哈希码唯一的字典都缺少有关哈希码的重要信息，IMO :) （除非它在*非常*特定的条件下运行，它绝对*知道*它们将是唯一的，即它使用的是[完美的哈希函数](http://en.wikipedia.org/wiki/Perfect_hash_function)。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T18:29:10.473

给定一个[完美的散列函数](http://en.wikipedia.org/wiki/Perfect_hash_function)（您通常不会拥有，正如其他人所提到的），您可以找到保证没有两个字符串会产生冲突的*最大可能*字符数，如下所示：

* * *

可用的唯一哈希码数 = 2 ^ 32 = 4294967296（假设哈希码使用 32 位整数） 字符集大小 = 2 * 26 + 1 = 53（在拉丁字母表中小写 26 个大写字母，加下划线）

然后你必须考虑一个长度`l`（或更短）的字符串有一个总的`54 ^ l`表示。请注意，基数是 54 而不是 53，因为字符串可以在任何字符之后终止，从而为每个字符添加额外的可能性 - 并不是说​​它对结果有很大影响。

拿号。将唯一哈希码作为字符串表示的最大数量，您将得到以下简单等式：

`54 ^ l = 2 ^ 32`

并解决它：

```
log2 (54 ^ l) = 32
l * log2 54 = 32
l = 32 / log2 54 = 5.56 
```

（其中 log2 是以 2 为底的对数函数。）

由于字符串长度显然不能是小数，因此您采用整数部分给出的最大长度仅为**5**。确实很短，但是请注意，在给定完美散列函数的情况下，此限制甚至可以防止发生冲突的最微小机会。

* * *

然而，正如我所提到的，这在很大程度上是理论上的，我不确定它在任何设计考虑中可能有多少用途。话虽如此，希望它可以帮助您从理论角度理解问题，在此之上您可以添加实际考虑因素（例如不完美的哈希函数，分布的不均匀性）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T20:23:40.497

## 通用哈希

要计算`S`长度字符串`L`与`W`每个字符位的冲突概率，以及`H`假设最佳[通用哈希](http://en.wikipedia.org/wiki/Universal_hashing)( **1** ) 的长度位哈希，您可以根据大小（桶数）“N”的哈希表计算冲突概率。

首先，我们可以假设一个理想的哈希表实现 ( **2** )，它将`H`哈希中的位完美地拆分到可用的桶`N`( **3** ) 中。这意味着`H`除了作为 的限制之外变得毫无意义`N`。 `W`和 'L' 只是 的上限的基础`S`。对于更简单的数学假设字符串长度 <`L`只是用特殊的空字符填充到 L 。如果我们感兴趣，我们对最坏的情况感兴趣，这是 54^ `L`(26*2+'_'+ null)，显然这是一个可笑的数字，实际的条目数比字符集和长度更有用，所以我们将简单地工作，就好像`S`它本身就是一个变量。

我们试图将`S`物品放入`N`桶中。这成为一个众所周知的问题，[生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)

解决各种概率和桶数的问题是有[启发](http://instacalc.com/?d=UGx1ZyBpbiB0aGUgZGVzaXJlZCBwcm9iYWJpbGl0eSBvZiBtYXRjaCBhbmQgdGhlIHRvdGFsIG51bWJlciBvZiBpdGVtcy4gWW91IG5lZWQgbiBwZW9wbGUgdG8gaGF2ZSBhIG1hdGNoIHdpdGggdGhhdCBwcm9iYWJpbGl0eS4gRnJvbSBbYmV0dGVyZXhwbGFpbmVkLmNvbV0oaHR0cDovL2JldHRlcmV4cGxhaW5lZC5jb20vYXJ0aWNsZXMvdW5kZXJzdGFuZGluZy10aGUtYmlydGhkYXktcGFyYWRveC8pLg&c=cHJvYmFiaWxpdHlfb2ZfbWF0Y2ggPSA1MCV8dG90YWxfaXRlbXMgPSAzNjV8biA9IHJvdW5kdXAoIHNxcnQoLTIgKiBsbigxIC0gcHJvYmFiaWxpdHlfb2ZfbWF0Y2gpKSAqIHNxcnQodG90YWxfaXRlbXMpICkgLy8gaXRlbXMgbmVlZGVkIGZvciBtYXRjaHx8fHw&s=sshssss&v=0.9)性的，但假设我们有 10 亿个桶（在 32 位系统中大约有 4GB 内存），那么我们只需要 37K 条目就可以达到 50% 的机会至少是一个碰撞。鉴于试图避免哈希表中的*任何*冲突显然是荒谬的。

所有这一切并不意味着我们不应该**关心**哈希函数的行为。显然，这些数字假设是*理想的实现*，它们是我们能获得多好的上限。一个糟糕的哈希函数会在某些区域产生更严重的冲突，通过从不或很少使用它来浪费一些可能的“空间”，所有这些都可能导致哈希不是最优的，甚至会降低到看起来像列表但性能有更*糟糕*的常数因子。

.NET 框架对字符串散列函数的实现不是很好（因为它可能会更好），但对于绝大多数用户来说可能是可以接受的，并且计算起来相当有效。

## 另一种方法：完美哈希

如果您希望您可以生成所谓的[完美哈希](http://en.wikipedia.org/wiki/Perfect_hash_function)，这需要提前完全了解输入值，但通常不太有用。与上述数学类似，我们可以证明即使是完美的哈希也有其局限性：

回想 54 ^ `L`strings of length的限制`L`。然而，我们只有`H`大约 40 亿个不同数字的位（我们假设为 32）。因此，如果您可以真正拥有*任何*字符串和任意数量的字符串，那么您必须满足：

```
54 ^ L <= 2 ^ 32 
```

并解决它：

```
log2 (54 ^ L) <= 32
L * log2 54 <= 32
L <= 32 / log2 54 <= 5.56 
```

由于字符串长度显然不能是小数，因此您的最大长度仅为 5。确实非常短。

如果您知道您只会拥有一组远低于 40 亿的字符串，那么完美的散列可以让您处理 的任何值`L`，但在实践中限制该组值可能非常困难，您必须提前了解它们或降级为相当于字符串->哈希的数据库，并在遇到新字符串时添加到其中。

* * *

1.  对于这个练习，通用散列是最优的，因为我们希望减少*任何*冲突的概率，即对于任何输入，它具有来自一组可能性 R 的输出 x 的概率是 1/R。

2.  请注意，在散列（和内部分桶）上进行最佳工作非常困难，但您应该期望内置类型即使并不总是理想也是合理的。

3.  在这个例子中，我避免了封闭和开放寻址的问题。这确实对所涉及的概率有一些影响，但并不显着

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:22:04.033

哈希算法不应该保证唯一性。鉴于潜在的字符串（n 长度为 26^n，甚至忽略特殊字符、空格、大写、非英语字符等）比哈希表中的位置多得多，因此无法实现这样的保证. 它只应该保证良好的分布。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T18:21:05.190

如果您的键是一个字符串（例如，一个字典），那么它的 GetHashCode() 将被使用。那是一个 32 位整数。Hashtable 默认使用 1 键来评估负载因子，并增加存储桶的数量以保持该负载因子。因此，如果您确实看到冲突，它们应该倾向于发生在重新分配边界附近（并在重新分配后不久减少）。

# nhibernate - 确定 NHibernate 中的实体字段是否更改

> ID：735325
> 
> 赞同：4
> 
> 时间：2009-04-09T18:14:05.080
> 
> 标签：nhibernate

我有一个电话需要确定字段是否已更改。但是使用该实体 id 调用 get 会返回相同的实体，而不是先前的版本。

```
Entity e = Dao.Get(id);
//At this point e.Field is X
e.Field = y;
Dao.Save(e);

Entity Dao.Get(Guid id)
{
  return Session.Get(id);
}

Entity Dao.Save(Entity e)
{
   Entity olde = Session.Get(e.Id);
   if (e.Field != olde.Field) <--- e.Field == olde.Field so it does not run.
     DoBigMethod(e);
   return e;
} 
```

如何在不向 Entity 类添加 onChange 方法的情况下处理这种情况。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T09:44:39.187

您只知道实体的一个“版本”：当前版本。*实际上*只有一个版本的实体。你有它在内存中，你已经改变了它并忘记了以前的状态。

调用 get 来查看之前的数据库状态是危险的。如果更改已经刷新（例如 NHibernate 在查询之前刷新），您将获得更改。如果您打开另一个会话，您会看到来自其他事务的更改。

你只对一个领域感兴趣吗？然后你可以在某处缓存旧值。

如果这不起作用，您需要告诉我更多关于您需要知道该字段先前值的原因。

编辑：

还有一些想法：

*   获取对象时缓存该字段的先前状态，在 DAO.Get 中
*   实现这个属性，如果它改变了它就会设置一个标志。
*   考虑将此更改作为客户端调用的显式操作，而不是在标志更改时调用的隐式操作。例如，如果此标志称为“已激活”，则实现“激活”和“停用”方法。此方法更改该标志并执行“大量代码”。该标志对世界其他地区是只读的。

# python - 传播应用程序设置

> ID：735337
> 
> 赞同：4
> 
> 时间：2009-04-09T18:17:18.443
> 
> 标签：python, singleton, settings, global

可能是一个非常常见的问题，但还没有找到合适的答案..

我有一个（带有 C++ 模块的 Python）应用程序，它大量使用 SQLite 数据库，并且它的路径由用户在应用程序启动时提供。

每次应用程序的某些部分需要访问数据库时，我计划获取一个新会话并在完成后将其丢弃。为此，我显然需要访问启动时提供的路径。我看到它发生的几种方式：

**1\. 明确的论点**

数据库路径通过显式参数传递到它需要的任何地方，并且数据库会话使用该显式路径进行实例化。这可能是最模块化的，但似乎非常尴尬。

**2\. 数据库路径单例**

数据库会话对象如下所示：

```
import foo.options
class DatabaseSession(object):
    def __init__(self, path=foo.options.db_path):
        ... 
```

我认为这是一个不那么邪恶的单例，因为我们只存储常量字符串，在应用程序运行时不会改变。这样就可以在`DatabaseSession`必要时覆盖默认值并对该类进行单元测试。

**3.数据库路径单例+静态工厂方法**

也许比上述略有改进：

```
def make_session(path=None):
    import foo.options
    if path is None:
        path = foo.options.db_path
    return DatabaseSession(path)

class DatabaseSession(object):
    def __init__(self, path):
        ... 
```

这种方式模块根本不依赖`foo.options`，除非我们使用工厂方法。此外，该方法可以执行诸如会话缓存之类的东西。

还有其他模式，我不知道。我在 web 框架中隐约看到类似的东西，但我对这些没有任何经验。我的示例非常具体，但我想它也会扩展到其他应用程序设置，因此是帖子的标题。

我想听听你的想法，什么是最好的安排方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:43:09.597

是的，还有其他人。您的选项 3 虽然非常 Pythonic。

使用标准 Python 模块来封装选项（这是 Django 等 Web 框架的方式）

使用工厂发出正确配置的会话。

既然 SQLite 已经有了一个“连接”，为什么不使用它呢？您的`DatabaseSession`班级添加了内置连接缺少的什么？

# vb.net - 如何以编程方式判断客户端计算机是否将 Microsoft.Jet.OLEDB.4.0 作为有效提供程序？

> ID：735340
> 
> 赞同：1
> 
> 时间：2009-04-09T18:17:40.250
> 
> 标签：vb.net, connection-string

我需要将数据导出到 Access 数据库中。我的代码有效，但它假设客户端计算机将 Microsoft.Jet.OLEDB.4.0 作为有效提供程序。

我想在代码中测试一下这是否正确。我的问题是我没有现有访问数据库的位置，我不想创建一个新的 .mdb 用于验证连接然后删除它。

有没有办法告诉安装了哪些提供程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T18:25:27.860

您可以简单地检查是否存在

```
HKEY_CLASSES_ROOT\CLSID\{dee35070-506b-11cf-b1aa-00aa00b8de95} 
```

这是 Microsoft.Jet.OLEDB.4.0 的 CLSID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:21:30.070

如果支持您的提供程序，您可以尝试检测机器上的 MDAC 版本并基于该推断？

[http://www.planetsourcecode.com/vb/scripts/ShowCode.asp?txtCodeId=47262&lngWId=1](http://www.planetsourcecode.com/vb/scripts/ShowCode.asp?txtCodeId=47262&lngWId=1)

这是您可以查看的片段。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-06-25T13:41:55.770

每个主要提供商都有在注册表编辑器下提到的 classid 例如：- HKEY_CLASSES_ROOT\CLSID{dee35070-506b-11cf-b1aa-00aa00b8de95}

这是 Microsoft.Jet.OLEDB.4.0 的 CLSID。

要以编程方式检查，请使用下面的 c# 代码，它在 framework 2.0 上检查

```
using System.Data.OleDb;
OleDbEnumerator enumerator = new OleDbEnumerator();
        DataTable table = enumerator.GetElements();
        bool bNameFound = false;
        bool bCLSIDFound = false;

        foreach (DataRow row in table.Rows)
        {
            foreach (DataColumn col in table.Columns)
            {
                if ((col.ColumnName.Contains("SOURCES_CLSID")) && (row[col].ToString().Contains("{dee35070-506b-11cf-b1aa-00aa00b8de95}")))
                    Console.WriteLine("CLSID of Microsoft.Jet.OLEDB.4.0\. Found");

                if ((col.ColumnName.Contains("SOURCES_NAME")) && (row[col].ToString().Contains("Microsoft.ACE.OLEDB.12.0")))
                {
                    bNameFound = true;
                    if ((col.ColumnName.Contains("SOURCES_CLSID")) && (row[col].ToString().Contains("{3BE786A0-0366-4F5C-9434-25CF162E475E}")))
                        bCLSIDFound = true;
                }
            }
        }

        if (!bNameFound && !bCLSIDFound)
            Console.WriteLine("Microsoft.ACE.OLEDB.12.0 Not found");
        else
            Console.WriteLine("Microsoft.ACE.OLEDB.12.0 found"); 
```

记住“正确修复它，不要让测试错误咬住”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T18:22:45.903

我相信如果您安装了 .NET Framework（需要运行 VB.NET 代码），那么该机器就有您提到的提供程序。 [MSDN](http://msdn.microsoft.com/en-us/library/a6cd7c08(VS.71).aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-15T15:17:08.263

```
 Dim reader As Object = OleDbEnumerator.GetRootEnumerator()
        Dim Oleprovide As String = ""

        While reader.Read
            For i = 0 To reader.FieldCount - 1
                If reader.GetName(i) = "SOURCES_NAME" Then
                    If reader.GetValue(i).ToString.Contains(".OLEDB.") = True Then
                        Oleprovide = reader.GetValue(i).ToString
                        Exit For
                    End If
                End If
            Next
        End While
        reader.Close()

        Dim MyConnection As OleDbConnection
        MyConnection = New OleDbConnection("Provider=" & Oleprovide & ";Data Source=" & existingFile.FullName & ";Extended Properties=""Excel 13.0 Xml;HDR=Yes""")
        MyConnection.Open() 
```

# iphone - NSTimer 贵吗？

> ID：735343
> 
> 赞同：6
> 
> 时间：2009-04-09T18:17:59.283
> 
> 标签：iphone

我正在使用大约 20`UIImageView`秒的小型飞机图像（50x50 像素）在 iPhone 屏幕上做简单的动画。动画是通过按`UIImageView`计时器间隔移动中心属性来完成的。

```
[NSTimer scheduledTimerWithTimeInterval:0.01
                                 target:self
                               selector:@selector(timerFired:)
                               userInfo:nil
                                repeats:YES] 
```

最佳实践是什么：创建一个`NSTimer`并循环 20`UIImageView`秒以在计时器触发时设置中心属性？或者我应该只`NSTimer`为每个`UIImageView`对象创建一个？`NSTimer`资源贵吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T18:25:36.193

我不认为这是资源密集型的，但常识似乎表明使用 1 个计时器可能比 20 个更好。

看起来您的计时器设置为每秒触发 100 次，这似乎有点过分。您是否在每次计时器触发时为每个精灵设置动画？可能想尝试每秒发射 20-30 次（或者甚至更少）。

您可能还想查看内置的视图动画功能。似乎它们对于您正在做的事情可能会很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T18:19:22.853

您可以尝试两者并使用 Xcode 附带的内置分析工具来衡量资源使用情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-06-21T14:01:03.963

**计时器实际上非常昂贵，在能源方面。**

操作系统（或在其上运行的应用程序）没有做某事的每一纳秒，CPU 都会在几种低功耗状态模式之一中休眠。当 CPU 和其他系统从其低功耗空闲状态唤醒时，将系统从空闲状态唤醒会产生能源成本。如果计时器导致系统唤醒，则会产生该成本。计时器触发的频率越高，能量成本就越高。在移动设备上，它会严重影响电池寿命。

从这个意义上说，唤醒系统一次，完成所有工作，然后让它再次休眠尽可能多的纳秒会更有效。回到您的示例，如果您对此进行分析，使用 1 个计时器而不是 20 个计时器应该更有效，每个计时器触发 100 次/秒。

以后的操作系统版本允许您指定容差（以 % 为单位）。这允许系统将定时器组合在一起并在同一唤醒事件中执行它们，以节省电力。看起来你正在做的不是时间关键（在实时执行的意义上），所以允许一个容差（例如 10%）应该会有所帮助。

例子：`[myTimer setTolerace:0.3];`

此处有关计时器容差的更多信息：[https ://developer.apple.com/documentation/foundation/nstimer](https://developer.apple.com/documentation/foundation/nstimer)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-02-17T17:06:17.253

与其尝试让 Timer 与屏幕重绘同步（即每秒触发 60 次），更好的解决方案是使用`CADisplayLink`，它在屏幕重绘时触发并为此目的而构建。

```
let displayLink = CADisplayLink(target: self, selector: #selector(displayLinkFired))
displayLink.add(to: .main, forMode: .default) // attach to the main run loop

@objc func displayLinkFired() {
   // update image view's here
} 
```

# spam-prevention - 启发式发现垃圾邮件发送者/机器人（在论坛、博客等中）

> ID：735344
> 
> 赞同：3
> 
> 时间：2009-04-09T18:18:21.670
> 
> 标签：spam-prevention, bots, heuristics

我能想到的方法是：

1.  测量动作之间的时间。
2.  比较帖子的内容（如果它们彼此太相似），或者更好的是，只比较发布的链接。
3.  检查用户活跃的一段时间内的分布（如果用户活跃，比如每小时发布一次，持续一周，那么我们这里要么有超人，要么有机器人）。
4.  预计会有一些特殊活动：就像在 stackoverflow 中一样，我希望用户按下他们的用户名链接（顶部中间）来查看他们的新答案、评论、问题等。
5.  （由 chakrit 添加）帖子中的链接数。
6.  不是启发式的。使用一些异步 JS 进行用户登录。（只是让机器人程序员的生活变得更加艰难）。
7.  （由 Alekc 添加）不是启发式的。用户代理值。
8.  而且，我怎么会忘记 Google 的方法（Will Hartung 提到过）。让用户能够将某人标记为垃圾邮件，足够的垃圾邮件投票意味着这是一个垃圾邮件用户。（计算什么是足够的用户，是这里的工作）。

还有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T20:03:58.297

我可能高估了机器人创造者的智慧，但 6 号对于任何半体面的机器人创造者来说完全没用。使用 C# 浏览器控件来创建您的机器人几乎会使 6 变得无用。从我所看到的那种类型的软件来看，这是一种非常常见的方法。

在用户代理上进行验证几乎没有用，我用来获取的所有博客垃圾邮件都来自看似有效的网络浏览器的机器人。

我曾经收到很多博客垃圾邮件。我真的会每天删除数百条评论。我使用了 reCaptcha，现在我可能每月获得 1 个。

如果你真的尝试做这样的事情。我会尝试执行以下操作：

用户开始时无法发布网址。

在与线程中的其他帖子相关的 X 个帖子被分析后，然后让他们访问帖子网址。

用户在网站上的活动、帖子质量以及您认为必要的任何其他因素都将成为该用户 IP 的声誉。

然后根据 IP 和同一子网上的其他 IP 的信誉，您可以根据需要做出其他决定。

这只是我想到的第一件事。希望能帮助到你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T18:20:44.393

*   帖子中的链接数。

我相信我在某处读到过[Akismet](http://akismet.com/)使用链接数量作为其主要启发式方法之一。

我博客上的大部分垃圾评论都包含 10 多个链接。

说到这……您可能只想查看[Akismet API](http://akismet.com/development/api/)本身……它们非常有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T18:21:14.563

在帖子正文中搜索与垃圾邮件相关的关键字怎么样？

不是启发式方法，而是一种有效的方法：您还可以使用[StopForumSpam](http://www.stopforumspam.com/)的[API](http://www.stopforumspam.com/apis)了解最新发布的统计数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:23:30.003

我相信页面访问之间的时间很常见。

我需要在我的个人网站上添加一个评论部分，并且正在考虑让人们给我他们的电子邮件地址；我会通过电子邮件向他们发送“发表评论”链接。

您可能想检查它们是否来自垃圾邮件黑名单 IP 地址（请参阅[http://www.spamhaus.org/](http://www.spamhaus.org/)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T18:34:47.887

还有[另一个答案](https://stackoverflow.com/questions/735344/heuristics-to-discover-spammers-bots-in-forums-blogs-etc/735354#735354)建议使用 Akismet 检测垃圾邮件，我完全赞同。

然而，他们并不是唯一的球员。

[TypePad AntiSpam](http://antispam.typepad.com/)使用与 Akismet 相同的启发式算法，以及相同的 API（只是 URL 和 api 密钥不同，调用结构相同）。可以肯定地说，他们几乎采用了与 Akismet 相同的方法。

您可能还想查看[Project Honeypot](http://www.projecthoneypot.org/)。据我所知，它可以根据用户的 IP 地址进行查找，如果它是已知的恶意 IP，它会告诉你（harvester 或类似的东西）。

最后，您可以查看[LinkSleeve](http://www.linksleeve.org/)，它声称以不同的方式处理评论垃圾邮件。基本上，它会检查评论中链接到的链接，并根据链接的去向做出决定。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T20:10:15.020

不要忘记终极启发式方法：用户可以单击的“报告垃圾邮件”按钮。如果不出意外，这让您作为管理员有机会更新您的规则库以查找可能漏掉的内容。当然，您也可以立即删除有问题的帖子和用户。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T18:24:40.983

我对 4° 点有一些疑问，无论如何我也会添加 User-Agent。这很容易伪造，但根据我的经验，大约 90% 的机器人使用 Perl 作为 UA

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T19:28:12.577

我确信有某种网络服务，您可以获得顶级 SEO 关键字列表，检查这些关键字的内容。如果内容是丰富的关键字怀疑它是垃圾邮件。

# c# - 无法在 C# 中加载 C++ DLL

> ID：735346
> 
> 赞同：2
> 
> 时间：2009-04-09T18:18:43.307
> 
> 标签：c#, c++, .net-3.5, dll, crash

[>我之前的话题<](https://stackoverflow.com/questions/734140/c-crash-when-loading-c-dll)

我创建了这个，因为我在 VMBox 上安装了 WinXP，但我无法让它再次工作。

这次我在表单上创建了一个 OnLoad 事件

```
 if (LoadLibrary("blowfish.dll") == 0)
        {
            Misc.LogToFile("Could not load dll", true);
            Application.Exit();
        } 
```

在我的 PC 上运行良好，但在 VMBox LoadLibrary 上返回 0。

一些用户提到问题在于将旧的 NET Framework(2.0) 与在最新的 MS Visual Studio(2008 SP1) 上制作的 dll 混合在一起，所以我采取了行动，现在它设置为与 NET 3.5 一起使用的程序属性

在 VMBox 上，我有 NET 2.0，但这不是问题 - 程序本身运行良好。我也有 C++ Redistributable（2005、2005 SP1 和 2008）。

可能是什么问题呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T18:32:49.013

如果你可以打电话给进一步的麻烦

```
Marshal.GetLastWin32Error(); 
```

这应该给你一个错误代码。

您是否可能部署了本机 dll 的调试版本，它还需要 MSVCR90 **D** .DLL 的调试版本？您应该已经分发了发布版本，因为调试版本需要在目标系统上存在一组不同的 dll。

它显然适用于您的开发机器，因为所需库的所有调试版本都带有 Visual Studio。

这是您将如何获得属于错误代码的消息的方式：

```
[DllImport("kernel32.dll")]
private static extern int FormatMessage(int dwFlags,
    IntPtr lpSource, int dwMessageId, int dwLanguageId,
    out string lpBuffer, int nSize, IntPtr pArguments);

public static string GetErrorMessage(int errorCode)
{
    const int FORMAT_MESSAGE_ALLOCATE_BUFFER = 0x00000100;
    const int FORMAT_MESSAGE_IGNORE_INSERTS = 0x00000200;
    const int FORMAT_MESSAGE_FROM_SYSTEM = 0x00001000;

    string lpMsgBuf;
    int dwFlags = FORMAT_MESSAGE_ALLOCATE_BUFFER
        | FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS;

    int retVal = FormatMessage(dwFlags, IntPtr.Zero, errorCode, 0,
                                out lpMsgBuf, 0, IntPtr.Zero);
    if (0 == retVal)
    {
        return null;
    }
    return lpMsgBuf;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:31:23.683

在 LoadLibrary 之后调用 GetLastError，在此处检查错误代码值：http: [//msdn.microsoft.com/en-us/library/ms681381.aspx](http://msdn.microsoft.com/en-us/library/ms681381.aspx) 看看是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T18:21:57.853

可能是 dll 的位置在一个环境中的路径上，而不是在另一个环境中。也可能是一个环境中的权限与另一个环境不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T18:24:55.197

尝试在 DLL 上运行[依赖walker](http://www.dependencywalker.com/) - 查看是否缺少任何模块。

# c# - 如何在 ASP.NET 中获取用户的客户端 IP 地址？

> ID：735350
> 
> 赞同：409
> 
> 时间：2009-04-09T18:19:26.673
> 
> 标签：c#, asp.net, client, ip-address

我们必须`Request.UserHostAddress`在 ASP.NET 中获取 IP 地址，但这通常是用户的 ISP 的 IP 地址，而不是例如单击链接的用户机器的 IP 地址。我怎样才能得到真实的IP地址？

例如，在 Stack Overflow 用户配置文件中，它是：**"Last account activity: 4 hours ago from 86.123.127.8"**，但我的机器 IP 地址有点不同。Stack Overflow 是如何得到这个地址的？

在某些 Web 系统中，出于某些目的会检查 IP 地址。例如，对于某个 IP 地址，用户每 24 小时只能点击 5 次下载链接吗？此 IP 地址应该是唯一的，而不适用于拥有大量客户端或 Internet 用户的 ISP。

我理解的好吗？

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2009-04-11T17:03:57.243

通常，您会想知道访问您网站的人的 IP 地址。虽然 ASP.NET 有几种方法可以做到这一点，但我们见过的最好的方法之一是使用 ServerVariables 集合的“HTTP_X_FORWARDED_FOR”。

这就是为什么...

有时您的访问者位于代理服务器或路由器后面，而标准`Request.UserHostAddress`仅捕获代理服务器或路由器的 IP 地址。在这种情况下，用户的 IP 地址将存储在服务器变量（“HTTP_X_FORWARDED_FOR”）中。

所以我们要做的是首先检查“HTTP_X_FORWARDED_FOR”，如果它是空的，我们就简单地返回`ServerVariables("REMOTE_ADDR")`。

虽然这种方法不是万无一失的，但它可以带来更好的结果。下面是 VB.NET 中的 ASP.NET 代码，取自[James Crowley 的博客文章“问题：HTTP_X_FORWARDED_FOR 返回多个 IP 地址”](http://www.jamescrowley.co.uk/2007/06/19/gotcha-http-x-forwarded-for-returns-multiple-ip-addresses/)

**C＃**

```
protected string GetIPAddress()
{
    System.Web.HttpContext context = System.Web.HttpContext.Current; 
    string ipAddress = context.Request.ServerVariables["HTTP_X_FORWARDED_FOR"];

    if (!string.IsNullOrEmpty(ipAddress))
    {
        string[] addresses = ipAddress.Split(',');
        if (addresses.Length != 0)
        {
            return addresses[0];
        }
    }

    return context.Request.ServerVariables["REMOTE_ADDR"];
} 
```

**VB.NET**

```
Public Shared Function GetIPAddress() As String
    Dim context As System.Web.HttpContext = System.Web.HttpContext.Current
    Dim sIPAddress As String = context.Request.ServerVariables("HTTP_X_FORWARDED_FOR")
    If String.IsNullOrEmpty(sIPAddress) Then
        Return context.Request.ServerVariables("REMOTE_ADDR")
    Else
        Dim ipArray As String() = sIPAddress.Split(New [Char]() {","c})
        Return ipArray(0)
    End If
End Function 
```

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2009-04-09T18:37:14.883

正如其他人所说，你不能做你所要求的。如果您描述了您要解决的问题，也许有人可以提供帮助？

例如

*   您是否正在尝试唯一标识您的用户？
*   您可以使用 cookie 或会话 ID 代替 IP 地址吗？

**编辑**您在服务器上看到的地址不应该是 ISP 的地址，正如您所说的那样，范围很大。宽带上家庭用户的地址将是他们路由器的地址，因此屋内的每台设备在外面看起来都是相同的，但路由器使用 NAT 来确保流量正确路由到每台设备。对于从办公环境访问的用户，地址可能对所有用户都是相同的。使用 IP 地址作为 ID 的站点冒着出错的风险 - 您提供的示例很好，但它们经常失败。例如，我的办公室在英国，突破点（我“出现”在互联网上的地方）在我们主要 IT 设施所在的另一个国家，所以从我的办公室来看，我的 IP 地址似乎不在英国。因此，我无法访问仅限英国的网页内容，例如 BBC iPlayer）。在任何给定时间，我的公司都会有数百甚至数千人似乎从同一个 IP 地址访问网络。

当您编写服务器代码时，您永远无法确定您看到的 IP 地址指的是什么。一些用户喜欢这种方式。有些人故意使用代理或 VPN 来进一步混淆你。

当您说您的机器地址与 StackOverflow 上显示的 IP 地址不同时，您是如何找到您的机器地址的？如果您只是在本地使用`ipconfig`或类似的东西，由于我上面概述的原因，我希望它会有所不同。如果您想仔细检查外界的想法，请查看[whatismyipaddress.com/](http://whatismyipaddress.com/)。

这个[关于 NAT 的维基百科链接](http://en.wikipedia.org/wiki/Network_address_translation)将为您提供一些背景知识。

* * *

## 回答 #3

> 赞同：88
> 
> 时间：2012-03-05T13:27:49.943

**更新：** 感谢布鲁诺洛佩斯。如果可能有多个 ip 地址，则需要使用此方法：

```
 private string GetUserIP()
    {
        string ipList = Request.ServerVariables["HTTP_X_FORWARDED_FOR"];

        if (!string.IsNullOrEmpty(ipList))
        {
            return ipList.Split(',')[0];
        }

        return Request.ServerVariables["REMOTE_ADDR"];
    } 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2013-01-30T14:41:08.617

如果是c#这么看的话，很简单

```
string clientIp = (Request.ServerVariables["HTTP_X_FORWARDED_FOR"] ?? 
                   Request.ServerVariables["REMOTE_ADDR"]).Split(',')[0].Trim(); 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2009-04-09T18:21:15.330

您还认为用户 IP 地址是什么？如果您想要网络适配器的 IP 地址，恐怕在 Web 应用程序中无法做到。如果您的用户在 NAT 或其他东西之后，您也无法获得 IP。

**更新**：虽然有些网站使用 IP 来限制用户（如 rapidshare），但它们在 NAT 环境中无法正常工作。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2012-11-15T16:27:24.317

我想我应该和大家分享我的经验。好吧，我看到在某些情况下**REMOTE_ADDR**不会为您提供所需的内容。例如，如果您在后台有一个负载均衡器，并且您正在尝试获取客户端的 IP，那么您将遇到麻烦。我用我的 IP 屏蔽软件检查了它，还检查了我在不同大陆的同事。所以这是我的解决方案。

当我想知道客户的 IP 时，我会尝试挑选所有可能的证据，以便确定它们是否是唯一的：

在这里，我找到了另一个 sever-var，如果您想获得客户端的确切 IP，它可以为您提供帮助。所以我正在使用：**HTTP_X_CLUSTER_CLIENT_IP**

**HTTP_X_CLUSTER_CLIENT_IP**始终为您提供客户端的确切 IP。在任何情况下，如果它没有为您提供价值，那么您应该寻找**HTTP_X_FORWARDED_FOR**因为它是获得客户端 IP 的第二个最佳候选者，然后是**REMOTE_ADDR** var，它可能会或可能不会返回您的 IP，但对我来说拥有所有这些三是我发现最好的东西来监控它们。

我希望这可以帮助一些人。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2011-09-27T00:20:23.867

您可以使用：

```
System.Net.Dns.GetHostEntry(System.Net.Dns.GetHostName()).AddressList.GetValue(0).ToString(); 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-04-09T18:32:25.193

IP 地址是“七层堆栈”中网络层的一部分。网络层可以对 IP 地址做任何想做的事情。这就是代理服务器、NAT、中继或其他任何东西所发生的情况。

应用层不应以任何方式依赖 IP 地址。特别是，IP 地址并不意味着除了网络连接一端的标识符之外的任何标识符。一旦连接关闭，您应该期望（同一用户的）IP 地址发生变化。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2017-07-12T00:11:36.397

到目前为止，所有响应都考虑了非标准化但*非常*常见的`X-Forwarded-For`标题。有一个标准化的[`Forwarded`](https://www.rfc-editor.org/rfc/rfc7239)标头，解析起来有点困难。一些例子如下：

```
Forwarded: for="_gazonk"
Forwarded: For="[2001:db8:cafe::17]:4711"
Forwarded: for=192.0.2.60;proto=http;by=203.0.113.43
Forwarded: for=192.0.2.43, for=198.51.100.17 
```

我编写了一个类，在确定客户端的 IP 地址时将这两个标头都考虑在内。

```
using System;
using System.Web;

namespace Util
{
    public static class IP
    {
        public static string GetIPAddress()
        {
            return GetIPAddress(new HttpRequestWrapper(HttpContext.Current.Request));
        }

        internal static string GetIPAddress(HttpRequestBase request)
        {
            // handle standardized 'Forwarded' header
            string forwarded = request.Headers["Forwarded"];
            if (!String.IsNullOrEmpty(forwarded))
            {
                foreach (string segment in forwarded.Split(',')[0].Split(';'))
                {
                    string[] pair = segment.Trim().Split('=');
                    if (pair.Length == 2 && pair[0].Equals("for", StringComparison.OrdinalIgnoreCase))
                    {
                        string ip = pair[1].Trim('"');

                        // IPv6 addresses are always enclosed in square brackets
                        int left = ip.IndexOf('['), right = ip.IndexOf(']');
                        if (left == 0 && right > 0)
                        {
                            return ip.Substring(1, right - 1);
                        }

                        // strip port of IPv4 addresses
                        int colon = ip.IndexOf(':');
                        if (colon != -1)
                        {
                            return ip.Substring(0, colon);
                        }

                        // this will return IPv4, "unknown", and obfuscated addresses
                        return ip;
                    }
                }
            }

            // handle non-standardized 'X-Forwarded-For' header
            string xForwardedFor = request.Headers["X-Forwarded-For"];
            if (!String.IsNullOrEmpty(xForwardedFor))
            {
                return xForwardedFor.Split(',')[0];
            }

            return request.UserHostAddress;
        }
    }
} 
```

以下是我用来验证我的解决方案的一些单元测试：

```
using System.Collections.Specialized;
using System.Web;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace UtilTests
{
    [TestClass]
    public class IPTests
    {
        [TestMethod]
        public void TestForwardedObfuscated()
        {
            var request = new HttpRequestMock("for=\"_gazonk\"");
            Assert.AreEqual("_gazonk", Util.IP.GetIPAddress(request));
        }

        [TestMethod]
        public void TestForwardedIPv6()
        {
            var request = new HttpRequestMock("For=\"[2001:db8:cafe::17]:4711\"");
            Assert.AreEqual("2001:db8:cafe::17", Util.IP.GetIPAddress(request));
        }

        [TestMethod]
        public void TestForwardedIPv4()
        {
            var request = new HttpRequestMock("for=192.0.2.60;proto=http;by=203.0.113.43");
            Assert.AreEqual("192.0.2.60", Util.IP.GetIPAddress(request));
        }

        [TestMethod]
        public void TestForwardedIPv4WithPort()
        {
            var request = new HttpRequestMock("for=192.0.2.60:443;proto=http;by=203.0.113.43");
            Assert.AreEqual("192.0.2.60", Util.IP.GetIPAddress(request));
        }

        [TestMethod]
        public void TestForwardedMultiple()
        {
            var request = new HttpRequestMock("for=192.0.2.43, for=198.51.100.17");
            Assert.AreEqual("192.0.2.43", Util.IP.GetIPAddress(request));
        }
    }

    public class HttpRequestMock : HttpRequestBase
    {
        private NameValueCollection headers = new NameValueCollection();

        public HttpRequestMock(string forwarded)
        {
            headers["Forwarded"] = forwarded;
        }

        public override NameValueCollection Headers
        {
            get { return this.headers; }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2016-07-23T22:03:38.267

如果你使用 CloudFlare，你可以试试这个*扩展方法*：

```
public static class IPhelper
{
    public static string GetIPAddress(this HttpRequest Request)
    {
        if (Request.Headers["CF-CONNECTING-IP"] != null) return Request.Headers["CF-CONNECTING-IP"].ToString();

        if (Request.ServerVariables["HTTP_X_FORWARDED_FOR"] != null) return Request.ServerVariables["HTTP_X_FORWARDED_FOR"].ToString();

        return Request.UserHostAddress;
    }
} 
```

然后

```
string IPAddress = Request.GetIPAddress(); 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-07-15T07:38:15.493

```
string IP = HttpContext.Current.Request.Params["HTTP_CLIENT_IP"] ?? HttpContext.Current.Request.UserHostAddress; 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2011-08-04T15:22:47.123

您可以做的是存储用户的路由器 IP 以及转发的 IP，并尝试使用 IP [外部公共和内部私有] 使其可靠。但几天后，客户端可能会从路由器分配新的内部 IP，但它会更可靠。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-01-02T08:22:34.320

结合[@Tony](https://stackoverflow.com/questions/735350/how-to-get-a-users-client-ip-address-in-asp-net#answer-38546807)和[@mangokun](https://stackoverflow.com/questions/735350/how-to-get-a-users-client-ip-address-in-asp-net#answer-740431)的答案，我创建了以下扩展方法：

```
public static class RequestExtensions
{
    public static string GetIPAddress(this HttpRequest Request)
    {
        if (Request.Headers["CF-CONNECTING-IP"] != null) return Request.Headers["CF-CONNECTING-IP"].ToString();

        if (Request.ServerVariables["HTTP_X_FORWARDED_FOR"] != null)
        {
            string ipAddress = Request.ServerVariables["HTTP_X_FORWARDED_FOR"];

            if (!string.IsNullOrEmpty(ipAddress))
            {
                string[] addresses = ipAddress.Split(',');
                if (addresses.Length != 0)
                {
                    return addresses[0];
                }
            }
        }

        return Request.UserHostAddress;
    }
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-01-22T16:42:03.343

```
public static class Utility
{
    public static string GetClientIP(this System.Web.UI.Page page)
    {
        string _ipList = page.Request.Headers["CF-CONNECTING-IP"].ToString();
        if (!string.IsNullOrWhiteSpace(_ipList))
        {
            return _ipList.Split(',')[0].Trim();
        }
        else
        {
            _ipList = page.Request.ServerVariables["HTTP_X_CLUSTER_CLIENT_IP"];
            if (!string.IsNullOrWhiteSpace(_ipList))
            {
                return _ipList.Split(',')[0].Trim();
            }
            else
            {
                _ipList = page.Request.ServerVariables["HTTP_X_FORWARDED_FOR"];
                if (!string.IsNullOrWhiteSpace(_ipList))
                {
                    return _ipList.Split(',')[0].Trim();
                }
                else
                {
                    return page.Request.ServerVariables["REMOTE_ADDR"].ToString().Trim();
                }
            }
        }
    }
} 
```

采用;

```
string _ip = this.GetClientIP(); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-03-09T07:49:39.190

在 ashx 文件中使用

```
public string getIP(HttpContext c)
{
    string ips = c.Request.ServerVariables["HTTP_X_FORWARDED_FOR"];
    if (!string.IsNullOrEmpty(ips))
    {
        return ips.Split(',')[0];
    }
    return c.Request.ServerVariables["REMOTE_ADDR"];
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-11-25T21:09:09.460

在 NuGet 包安装`Microsoft.AspNetCore.HttpOverrides` 然后尝试：

```
public class ClientDeviceInfo
    {
        private readonly IHttpContextAccessor httpAccessor;

        public ClientDeviceInfo(IHttpContextAccessor httpAccessor)
        {
            this.httpAccessor = httpAccessor;
        }

        public string GetClientLocalIpAddress()
        {
            return httpAccessor.HttpContext.Connection.LocalIpAddress.ToString();
        }

        public string GetClientRemoteIpAddress()
        {
            return httpAccessor.HttpContext.Connection.RemoteIpAddress.ToString();
        }

        public string GetClientLocalPort()
        {
            return httpAccessor.HttpContext.Connection.LocalPort.ToString();
        }

        public string GetClientRemotePort()
        {
            return httpAccessor.HttpContext.Connection.RemotePort.ToString();
        }
     } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-01-29T14:39:16.817

很简单。试试吧：

```
var remoteIpAddress = Request.HttpContext.Connection.RemoteIpAddress; 
```

只是它 ：））

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2021-08-31T05:14:45.290

简单地

```
var ip =  Request.UserHostAddress; 
```

就这样...

[![在此处输入图像描述](https://i.stack.imgur.com/kVTdx.png)](https://i.stack.imgur.com/kVTdx.png)

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2018-12-31T05:05:31.580

大家好，您将找到的大多数代码将返回您的服务器 IP 地址而不是客户端 IP 地址。但是此代码返回正确的客户端 IP 地址。试一试。有关更多信息，请查看此

[https://www.youtube.com/watch?v=Nkf37DsxYjI](https://www.youtube.com/watch?v=Nkf37DsxYjI)

要使用 javascript 获取本地 IP 地址，您可以使用将此代码放在脚本标记中

```
<script>
    var RTCPeerConnection = /*window.RTCPeerConnection ||*/
     window.webkitRTCPeerConnection || window.mozRTCPeerConnection;

         if (RTCPeerConnection) (function () {
             var rtc = new RTCPeerConnection({ iceServers: [] });
             if (1 || window.mozRTCPeerConnection) {      
                 rtc.createDataChannel('', { reliable: false });
             };

             rtc.onicecandidate = function (evt) {

                 if (evt.candidate)
                     grepSDP("a=" + evt.candidate.candidate);
             };
             rtc.createOffer(function (offerDesc) {
                 grepSDP(offerDesc.sdp);
                 rtc.setLocalDescription(offerDesc);
             }, function (e) { console.warn("offer failed", e); });

             var addrs = Object.create(null);
             addrs["0.0.0.0"] = false;
             function updateDisplay(newAddr) {
                 if (newAddr in addrs) return;
                 else addrs[newAddr] = true;
                 var displayAddrs = Object.keys(addrs).filter(function
(k) { return addrs[k]; });
                 document.getElementById('list').textContent =
displayAddrs.join(" or perhaps ") || "n/a";
             }

             function grepSDP(sdp) {
                 var hosts = [];
                 sdp.split('\r\n').forEach(function (line) { 
                     if (~line.indexOf("a=candidate")) {   
                         var parts = line.split(' '),   
                             addr = parts[4],
                             type = parts[7];
                         if (type === 'host') updateDisplay(addr);
                     } else if (~line.indexOf("c=")) {      
                         var parts = line.split(' '),
                             addr = parts[2];
                         updateDisplay(addr);
                     }
                 });
             }
         })(); else
         {
             document.getElementById('list').innerHTML = "<code>ifconfig| grep inet | grep -v inet6 | cut -d\" \" -f2 | tail -n1</code>";
             document.getElementById('list').nextSibling.textContent = "In Chrome and Firefox your IP should display automatically, by the power of WebRTCskull.";

         }

</script>
<body>
<div id="list"></div>
</body> 
```

并且为了获取您的公共 IP 地址，您可以使用将此代码放在您的脚本标签中

```
 function getIP(json) {
    document.write("My public IP address is: ", json.ip);
  }

<script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"></script> 
```

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2012-09-09T09:39:02.780

用这个

```
Dns.GetHostEntry(Dns.GetHostName()) 
```

* * *

## 回答 #21

> 赞同：-7
> 
> 时间：2013-07-30T14:56:35.417

**尝试：**

```
using System.Net;

public static string GetIpAddress()  // Get IP Address
{
    string ip = "";     
    IPHostEntry ipEntry = Dns.GetHostEntry(GetCompCode());
    IPAddress[] addr = ipEntry.AddressList;
    ip = addr[2].ToString();
    return ip;
}
public static string GetCompCode()  // Get Computer Name
{   
    string strHostName = "";
    strHostName = Dns.GetHostName();
    return strHostName;
} 
```

# jquery - 使用 JQuery 更新 span 标签值

> ID：735359
> 
> 赞同：17
> 
> 时间：2009-04-09T18:21:24.267
> 
> 标签：jquery, html

我正在尝试更新图例标记中的字段集标记中的跨度标记。这个想法是在选择组件时更新软件项目的成本。如果我只有一个软件项目（例如 - Visual Studio 2008 Pro 2800 美元），下面的代码可以正常工作，但是如果我在另一个字段集中添加第二个项目，那么当我尝试更新该字段集的跨度时，它会更新跨度包含我的 Visual Studio 软件的字段集。任何想法我做错了什么？

```
<script language="javascript" type="text/javascript">
$(document).ready(function() {
    $("li").click(function() {           
        var itemCost = 0;
        $("legend").each(function() {
            var SoftwareItem = $(this).text();
            itemCost = GetItemCost(SoftwareItem);
            $("input:checked").each(function() {               
                var Component = $(this).next("label").text();
                itemCost += GetItemCost(Component);
            });            
            $("#ItemCostSpan").text("Item Cost = $ " + itemCost);
        });
        function GetItemCost(text) {
            var start = 0;
            start = text.lastIndexOf("$");
            var textCost = text.substring(start + 1);
            var itemCost = parseFloat(textCost);
            return itemCost;
        }        
    });
});
</script>
 <head runat="server">
<title></title>
</head>
<body>
<form id="form1" runat="server">
<fieldset>
   <legend>Visual Studio 2008 Pro   $2800</legend> 
    <ul class="AspNet-CheckBoxList-RepeatDirection-Vertical">
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBoxList1_0" type="checkbox"   name="CheckBoxList1$0" value="first1" />
            <label for="CheckBoxList1_0">Software Assurance $300.00</label>
        </li>
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBoxList1_1" type="checkbox" name="CheckBoxList1$1" value="second2" />
            <label for="CheckBoxList1_1">Another Component $255.25</label>
        </li>
            <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBox1" type="checkbox" name="CheckBoxList1$1" value="second2" />
            <label for="CheckBoxList1_1">A Second Component $15.25</label>
        </li>
    </ul>
    <span id="ItemCostSpan" style="background-color:White">         </span>         
    </fieldset>
    <fieldset>
   <legend>Visio 2008 Pro   $415</legend> 
    <ul class="AspNet-CheckBoxList-RepeatDirection-Vertical">
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBox2" type="checkbox" name="CheckBoxList1$0" value="first1" />
            <label for="CheckBoxList1_0">Software Assurance $40.00</label>
        </li>
        <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBox3" type="checkbox" name="CheckBoxList1$1" value="second2" />
            <label for="CheckBoxList1_1">Another Component $25.55</label>
        </li>
            <li class="AspNet-CheckBoxList-Item">
            <input id="CheckBox4" type="checkbox" name="CheckBoxList1$1" value="second2" />
            <label for="CheckBoxList1_1">A Second Component $10.25</label>
        </li>
        </ul>
            <span id="ItemCostSpan" style="background-color:White"></span>      
    </fieldset>

    <span id="TotalCostSpan" style="background-color:White"></span>

    </form> 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-09T18:57:28.503

标签 ID 必须是唯一的。您正在更新 ID 为“ItemCostSpan”的跨度，其中有两个。给 span 一个类并使用 find 获取它。

```
 $("legend").each(function() {
        var SoftwareItem = $(this).text();
        itemCost = GetItemCost(SoftwareItem);
        $("input:checked").each(function() {               
            var Component = $(this).next("label").text();
            itemCost += GetItemCost(Component);
        });            
        $(this).find(".ItemCostSpan").text("Item Cost = $ " + itemCost);
    }); 
```

# msbuild - 在 msbuild 过程中生成 atom 或 rss feed

> ID：735362
> 
> 赞同：-1
> 
> 时间：2009-04-09T18:21:42.097
> 
> 标签：msbuild, rss, feed, atom-feed

我认为通过 Atom 或 RSS 提要提醒感兴趣的各方完成构建过程会很方便。我猜某个地方有人花时间来做这件事，但是……也许你的 google-fu 比我的好，但事实证明这很难搜索。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T18:23:31.737

通过使用 System.Syndication 的可执行任务应该很容易做到......

如果您使用的是 cc.net，另一种方法是使用 cctray.exe

# msbuild - TeamCity - 如何创建安装程序包？

> ID：735363
> 
> 赞同：5
> 
> 时间：2009-04-09T18:21:57.777
> 
> 标签：msbuild, continuous-integration, teamcity, nsis

我对*TeamCity很陌生，但在**CC.NET* -t方面有 2-3 年的经验。我熟悉 MSBuild，但也许*TeamCity*有其他构建方式。

我看到*TeamCity*有一个不错的 UI 和很棒的插件框架。但我不知道如何配置安装程序包构建。

**我的问题：**

*   我已经检查了源代码并构建了工件（一些 dll 和 exe）。没有问题，但是
*   **如何“以***TeamCity*方式”创建 zip 包？（项目/工件依赖？）
*   **如何“以***TeamCity*方式”创建 NSIS 安装程序？

我可以下载插件或教程吗？或者我别无选择，只有 MSBuild？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T18:42:44.590

TeamCity有一些[构建运行器插件](http://www.jetbrains.net/confluence/display/TCD4/Build+Runner+Plugin)，您可以自己滚动，但我相信“TeamCity 方式”是在您的构建脚本中执行此操作......因为它是构建服务器，对吗？

你可能想查看[MSBuild 扩展包](http://www.codeplex.com/MSBuildExtensionPack)，它有很多不错的东西，比如**压缩**和**注册表访问**等等......这肯定会帮助完成那些 zip 和 nsis 任务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:46:37.547

您可能需要使用自己的手写构建脚本来执行此操作。

MsBuild 或 NAnt 可能会为您提供最佳选择。

如果您使用 MsBuild，您可能想查看 Msbuild 社区任务。

希望这可以帮助

# sql-server - 如何在 SQL 2000 中对 NTEXT 查询的结果使用 sp_xml_preparedocument？

> ID：735372
> 
> 赞同：5
> 
> 时间：2009-04-09T18:23:23.810
> 
> 标签：sql-server, xml, sql-server-2000, types, sqlxml

我知道 NTEXT 正在消失，并且这里存在更大的最佳实践问题（例如将 XML 存储在 NTEXT 列中），但我有一个包含 XML 的表，我需要从中提取一个属性值。使用 sp_xml_preparedocument 应该很容易做到这一点，但由于您无法声明 NTEXT 类型的局部变量并且我无法弄清楚如何使用表达式来指定传递给函数的 XML 文本，这一点变得更加棘手。由于 XML 或 VARCHAR(MAX) 数据类型，我可以在 SQL 2005 中这样做，但我可以为 SQL 2000 做什么？

```
DECLARE @XmlHandle int
DECLARE @ProfileXml xml
SELECT @ProfileXml = ProfileXml FROM ImportProfile WHERE ProfileId = 1

EXEC sp_xml_preparedocument @XmlHandle output, @ProfileXml

-- Pluck the Folder TemplateId out of the FldTemplateId XML attribute.
SELECT FolderTemplateId
FROM OPENXML( @XmlHandle, '/ImportProfile', 1)
WITH( 
FolderTemplateId int '@FldTemplateId' )

EXEC sp_xml_removedocument @XmlHandle 
```

对于 SQL 2000，我唯一能想到的就是使用 varchar(8000)。真的没有办法使用像下面这样的表达式吗？

```
EXEC sp_xml_preparedocument @XmlHandle output, (SELECT ProfileXml FROM ImportProfile WHERE ProfileId = 1) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T18:59:26.237

好问题..但没有解决方案

想法：

*   您不能将 SELECT 调用包装在 UDF 中（以创建一种虚拟 ntext 本地变量）
*   您不能将`sp_xml_preparedocument`调用包装在标量 UDF 中（在 SELECT 中使用），因为您不能调用扩展存储过程
*   您无法连接调用以动态运行，因为您会遇到字符串限制和范围问题
*   同上使用 OPENQUERY 的自调用
*   textptr + READTEXT 不能作为参数添加到`sp_xml_preparedocument`

那么为什么`sp_xml_preparedocument`要把 ntext 作为数据类型呢？

# c# - Ajax 树视图

> ID：735377
> 
> 赞同：1
> 
> 时间：2009-04-09T18:24:42.887
> 
> 标签：c#, ajax, treeview

我想看看那里是否有任何 AJAX TreeView 控件，最好是免费的。有什么想法/经验吗？

谢谢

我正在使用 ASP.net 2.0（Web 表单，而不是 MVC），c#

已编辑有人投票支持关闭此问题。只是想知道为什么？和编程无关吗？对于 SO 创建者，如果你们允许关闭每个问题，人们将停止访问此站点，这肯定与您真正想要的相反。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T20:54:54.103

有趣的是你应该问。我现在正在使[树表](http://ludo.cubicphuse.nl/jquery-plugins/treeTable/doc/index.html#examples)插件与 ajax 一起工作。[jqGrid](http://www.trirand.com/blog/)已经可以与 ajax 一起使用了，但是它非常庞大。

编辑：我刚刚意识到，也许你想要用 C# 制作的东西来做到这一点。你应该检查这些 jquery 的东西是否足以写一个标签或其他东西。

# dojo - 如何使用dojo TextBox attr 函数获取值？

> ID：735384
> 
> 赞同：6
> 
> 时间：2009-04-09T18:27:17.107
> 
> 标签：dojo

如何获取 Dojo TextBox 的值？

我正在这样做；

```
dijit.byId("textName").getValue(); 
```

但是 firbug 告诉我 getValue() 已被弃用！是使用 attr('value')！

但我不知道如何使用 attr('value') 函数

帮助

加思

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-06-23T22:46:59.577

从 Dojo 1.5 开始，您应该使用`get`和`set`方法来获取和设置属性。但在`attr`Dojo 2.0 发布之前，该方法仍然有效。

```
var box = dijit.byId('textbox')
box.get('value');
box.set('value', 'new value'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:59:46.063

我已经完成了这个及其工作；

```
var titleEdit = dijit.byId('title');

var myValue = title.attr('displayedValue'); 
```

工作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T12:48:21.113

在 1.2 中，Dijit 移至通用属性访问器方案。要使用新样式并避免警告，请改为：

```
dijit.byId("textName").attr("value"); 
```

Dijit 的负责人[在 attr 上写了一篇很好的博](http://www.dojotoolkit.org/2008/08/19/widget-attr)文，可能会有所帮助。

# perl - 发现 Perl 应用程序当前定义的所有变量的最佳方法是什么？

> ID：735386
> 
> 赞同：9
> 
> 时间：2009-04-09T18:27:41.133
> 
> 标签：perl, metaprogramming, metadata

我正在寻找最好、最简单的方法来做类似的事情：

```
$var1="value";
bunch of code.....
**print allVariablesAndTheirValuesCurrentlyDefined;** 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T19:36:15.367

包变量？词法变量？

包变量可以通过符号表查找。尝试[Devel::Symdump](http://search.cpan.org/perldoc?Devel::Symdump)：

```
#!/path/to/perl

use Devel::Symdump;

package example;

$var = "value";
@var = ("value1", "value2");
%var = ("key1" => "value1", "key2" => "value2");

my $obj = Devel::Symdump->new('example');

print $obj->as_string(); 
```

词法变量有点小技巧，你不会在符号表中找到它们。可以通过属于定义它们的代码块的“便签本”来查找它们。试试[PadWalker](http://search.cpan.org/perldoc?PadWalker)：

```
#!/path/to/perl

use strict;
use warnings;

use Data::Dumper;
use PadWalker qw(peek_my);

my $var = "value";
my @var = ("value1", "value2");
my %var = ("key1" =>  "value1", "key2" => "value2");

my $hash_ref = peek_my(0);

print Dumper($hash_ref); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T18:42:26.293

全局符号表是`%main::`，因此您可以从那里获取全局变量。但是，每个条目都是一个类型团，可以包含多个值，例如，$x、@x、%x 等，因此您需要检查每种数据类型。[您可以在此处](http://www.perlmonks.org/?node_id=181783)找到执行此操作的代码。该页面上的评论可能会帮助您找到非全局变量的其他解决方案（例如用“my”声明的词法变量）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T19:05:01.057

PadWalker模块为您提供[了](http://search.cpan.org/dist/PadWalker/PadWalker.pm)`peek_my`一个 LEVEL 参数，`peek_our`该参数确定在哪个范围内查找变量：

```
The LEVEL argument is interpreted just like the argument to caller.
So peek_my(0) returns a reference to a hash of all the my variables
that are currently in scope; peek_my(1) returns a reference to a hash
of all the my variables that are in scope at the point where the 
current sub was called, and so on. 
```

这是一个例子：

```
#!/usr/bin/perl

use strict;
use warnings;

use PadWalker qw/peek_my/;

my $baz = "hi";

foo();

sub foo {
    my $foo = 5;
    my $bar = 10;

    print "I have access to these variables\n";
    my $pad = peek_my(0);
    for my $var (keys %$pad) {
        print "\t$var\n";
    }

    print "and the caller has these variables\n";
    $pad = peek_my(1);
    for my $var (keys %$pad) {
        print "\t$var\n";
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T18:55:50.083

[Nathan 的回答](https://stackoverflow.com/questions/735386/whats-the-best-way-to-discover-all-variables-a-perl-application-has-currently-de/735431#735431)是故事的一部分——不幸的是，故事的其余部分没有列出词法变量`%main::`或其他任何地方（至少可以从 Perl 访问的任何地方——可能编写一些毛茸茸的 XS 代码来挖掘这些信息出 Perl 的 C 级内部）。

词法变量通常用于“普通局部”变量。它们的声明如下：

```
my $x; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T19:40:10.443

除了调试目的之外，这会用于其他目的吗？如果没有，您可能需要熟悉[perl 的调试器](http://www.ibm.com/developerworks/linux/library/l-pl-deb.html)。一旦进入调试器，您可以通过发出“V”来检查所有变量。

# graphics - 使用正交投影和拉伸模型在 3D 中开发 2D

> ID：735388
> 
> 赞同：0
> 
> 时间：2009-04-09T18:28:01.083
> 
> 标签：graphics, xna

我想知道使用正交投影相机是否有任何好处，使用 3D 模型制作 2D 游戏（而不是制作精灵和使用 2D）。

此外，在我使用正交投影时的相关说明中，我的 3d 模型被拉伸了。有谁知道为什么会这样？我知道纵横比只影响透视投影，所以这不应该发生。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:33:37.250

如果您开发 2D 游戏，使用 3D 模型将是很多毫无意义的开销——无论是对作为开发者的您还是对运行游戏的系统而言。即使您有精美的 3D 模型并且不擅长绘制精灵，您仍然可以使用 3D 建模工具将模型投影到图像上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:32:48.217

如果您正在制作 2d 游戏，则使用 3d 模型进行正交可能会更好，因为您可以利用 OpenGL 和 Direct3D 的硬件加速。然而，精灵比 3d 模型更容易制作。

# asp.net - 使用 vb.net 编程的带有 asp.net 的模态面板

> ID：735393
> 
> 赞同：1
> 
> 时间：2009-04-09T18:29:56.370
> 
> 标签：asp.net, vb.net, postback, modal-dialog

我有一个带有 div 的 ajax 模态面板，我从服务器访问它并通过在调用表单上显示各种控件的值来动态插入一个表格。

我的问题是，如果我的所有控件都在进行自动回发，它可以正常工作，但它会破坏用户体验，因为通过控件切换，控件在自动回发期间失去焦点。

有没有办法让我的目标控件在它放置模态之前执行回发，这样我就可以在模态中检索未发布的控件数据？它仍然必须放置模态。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T15:20:48.543

我有点困惑。您是指模态弹出窗口还是 AJAX `UpdatePanel`？

无论哪种方式，听起来您的用例可能比开箱即用的 AJAX 能够处理的更复杂。您最好的选择可能是定制`ICallBackEventHandler`或`IPostBackEventHandler`操作。

通过单个客户端函数（JavaScript 等）汇集所有调用/回发，获取必要的控制状态，将其发送到服务器，并使用结果更新您的页面。MSDN Library 中有相当不错的例子。（参见：[MSDN 库](http://msdn.microsoft.com/en-us/library/ms178208(VS.85).aspx)）

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-14T01:22:55.423

我相信我知道你想做什么。您正在尝试通过服务器端显示和隐藏您的模式弹出窗口。通过一个快速的技巧，它实际上并没有那么糟糕。创建一个绑定到模式的隐藏按钮。在您的代码中，一旦您绑定到模态控件上的控件，您就可以显示和隐藏您的模态框。

请看下面的文章。它应该可以帮助你。快乐编码！如果这对您有帮助，请告诉我。

[http://lisazhou.wordpress.com/2007/12/27/ajaxnet-dynamically-load-data-in-modal-popup/](http://lisazhou.wordpress.com/2007/12/27/ajaxnet-dynamically-load-data-in-modal-popup/)

# css - 通过css将图像添加到文本的左侧

> ID：735394
> 
> 赞同：90
> 
> 时间：2009-04-09T18:30:03.343
> 
> 标签：css

如何通过 css 将图像添加到某些文本中？

我有这个：

```
<span class="create">Create something</span> 
```

我想通过使用 css 在其左侧添加一个 16x16 图像。这是可能的还是我应该像这样手动添加这个图像：

```
<span class="create"><img src="somewhere"/>Create something</span> 
```

我宁愿不必手动更改所有位置，这就是我想通过 css 进行更改的原因。

谢谢！

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-04-09T18:33:53.053

```
.create
{
background-image: url('somewhere.jpg');
background-repeat: no-repeat;
padding-left: 30px;  /* width of the image plus a little extra padding */
display: block;  /* may not need this, but I've found I do */
} 
```

玩弄填充和可能的边距，直到你得到你想要的结果。您还可以使用“背景位置”或完全定义“背景”（[指向 w3 的链接](http://www.w3schools.com/css/css_background.asp)）来调整背景图像的位置（*向 Tom Wright 点头）。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2013-08-16T19:18:39.407

非常简单的方法：

```
.create:before {
content: url(image.png);
} 
```

适用于所有现代浏览器和 IE8+。

**编辑**

不过不要在大型​​网站上使用它。:before 伪元素在性能方面非常糟糕。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-09T18:38:49.263

尝试类似：

```
.create
 { 
  margin: 0px;
  padding-left: 20px;
  background-image: url('yourpic.gif');
    background-repeat: no-repeat;

} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-07-15T05:19:48.250

这很好用

```
.create:before{
    content: "";
    display: block;
    background: url('somewhere.jpg') no-repeat;
    width: 25px;
    height: 25px;
    float: left;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-11-22T07:45:53.257

当事先不知道文本长度时，总是在文本之前添加背景图标。

```
.create:before{
content: "";
display: inline-block;
background: #ccc url(arrow.png) no-repeat;
width: 10px;background-size: contain;
height: 10px;
} 
```

# security - 会话安全

> ID：735405
> 
> 赞同：3
> 
> 时间：2009-04-09T18:33:05.427
> 
> 标签：security

我正在一个公共站点上工作，该站点将使用由数据库支持的用户会话，该会话键入一个会话 ID。我试图防止会话劫持和篡改；我返回给客户的会话数据本身价值有限，但我想防止大规模盗窃。我在这里制定了一个小计划，但我想得到一些反馈和批评。

*   当会话开始时，客户端会获得一个唯一的密钥和会话数据的哈希值。
*   在每个后续请求中，客户端都会发送一个会话密钥 + 其会话数据的哈希值。
*   如果会话数据被修改，则向客户端提供反映其会话数据的新哈希值。
*   如果请求带有与数据库不匹配的不正确哈希，则会话被标记为已泄露。会话的请求和所有后续请求导致通过复制受损会话来创建新会话。出于安全审计目的，新会话引用了从中复制它们的会话。

我想我可以观察被入侵的请求以扫描大规模攻击。

提前谢谢了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:46:51.197

这似乎相对安全，但有几种方法可以绕过它：

*   如果会话密钥被盗，哈希也可能被盗。只要合法​​客户端不做任何事情，劫持者就可以接管，并保持密钥/哈希/数据的一致性。在合法客户端醒来之前，您什么都看不到……如果有的话。

*   在任何情况下，如果您的哈希不够神秘/安全，则可以简单地从数据中猜测（也可能被嗅探）。您可能应该使用某种随机盐（每个会话、每个用户、每个时间框架......）以确保这尽可能难以猜测。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:55:12.253

我不明白会话数据哈希的意义是什么。它解决了什么问题？

它可能会*导致*问题，例如同时在两个选项卡中加载两个页面时。如果第一个请求更改了会话数据，但另一个请求已经发送，则它的哈希值不正确。

另外，如果你复制旧的会话，我不知道你用这个实现了什么？

只需有一个简单的会话 ID 和：

*   在登录时更改它以避免会话固定和
*   将其锁定到 IP 以避免攻击者通过劫持控制。

为了防止攻击者看到数据，您必须使用 SSL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T18:44:19.627

听起来不错。

您可能想要在身份验证算法中加入的一件事是用户来自的 IP 地址。

对于当前的用户身份验证而言，它可能不是那么好，但如果会话被破坏，不同的 IP 将是一个巨大的标志，但您可以使用该信息添加到 IP 表规则以阻止潜在的恶意用户。

另一种想法是跟踪引用 URL。关于恶意行为，查看某人来自何处的任何一致性可能会揭示程序中的漏洞（如果有的话）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T13:23:53.117

您不能指望 IP 地址是唯一的或不变的。企业防火墙通常会通过 NAT 转换合并甚至随机更改 IP 地址。它可以使系统更安全，但它会破坏服务器的身份验证方案，这些方案试图要求相同的 IP 地址。

在过去的几年里，还有另一个问题——系统比以前更加移动。我经常“休眠”我的笔记本而不是关闭它们，但这意味着我来自不同的 IP 地址在家里、工作场所、星巴克等。这可能会使服务器在会话超时短至 15-30 分钟的情况下跳闸 -我从办公室到吃午饭等只需要时间。

# html - 如何在 CD/DVD 上自动打开 html 页面

> ID：735412
> 
> 赞同：10
> 
> 时间：2009-04-09T18:35:07.900
> 
> 标签：html, dvd, cd

我需要在 CD/DVD 上包含一个 html 页面（目录）。当用户将 CD/DVD 放入他们的机器时，我希望 html 页面自动打开。有没有办法通过购买软件或其他方式来做到这一点（MSDN cds 做到这一点）？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-09T18:47:25.717

您应该可以`autorun.inf`在 CD/DVD 的根目录中使用一个相对简单的文件：

```
[autorun]
shellexecute=path\to\htmlfile.html 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T19:14:03.017

我使用（免费版）[AutoRunPro](http://www.longtion.com/autorunpro/autorunpro.htm)

我记得有一次我遇到这个问题

```
[autorun]
shellexecute=path\to\htmlfile.html 
```

只是不能在大多数 PC 上工作。我使用了一个名为 AutorunPro.EXE 的程序，只是将它复制到根目录中，而 autorun.inf 是：

```
[Autorun]
open=AutoRunPro.exe

[AutorunPro]
; Here are some sample uses for Autorunpro. It keeps processing Them in Run1..RunN         order until it doesnt find one.
Run1=index.htm
Run2=. 
```

此外，您可以使用此方法一次性打开多个程序、页面……。

在任何一种情况下：事先测试你的方法，你实际上不需要刻录 CD/DVD 来做到这一点： [看这里](http://www.cryer.co.uk/brian/windows/howtotcdaurwobacd.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T18:44:19.127

如果您不想信任第三方程序，或者完全跳过它们，您可以阅读[MSDN AutoRun Reference](http://msdn.microsoft.com/en-us/library/cc136610(VS.85).aspx)。这还不错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T19:18:57.873

[ShelExec](http://www.naughter.com/shelexec.html)是您的门票。它是免费的，还允许您指定可选的 ico 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T18:37:50.780

这很简单。我使用一个名为 Autorun Pro 的程序。查看[本指南](http://www.ezau.com/latest/articles/autorun.shtml)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-01-20T12:48:27.583

您可以自己创建简单的可执行文件。以 Visual Studio 为例。

不确定它是否可以称为单线，但离它不远:-)

```
#include "stdafx.h"
#include "windows.h"
#include "Shellapi.h"

int main(int argc, char* argv[])
{
    ::ShellExecute(NULL, "open", "path\to\htmlfile.html", 0, 0, SW_NORMAL);
    return 0;
} 
```

为避免硬编码，您可以尝试在命令行中将路径作为参数传递。

自动运行文件必须添加到 CD。文件可能看起来像这样。

```
[autorun]
icon=\MySexyIcon.ico
label=MySuperCD
open=YourExecutable.exe 
```

请记住，它不适用于 iOS。

# internet-explorer - ActiveX 控件将无法加载 [Win XP、Vista]

> ID：735415
> 
> 赞同：2
> 
> 时间：2009-04-09T18:35:41.410
> 
> 标签：internet-explorer, activex

我有一个应用程序试图加载驻留在服务器上签名 cab 文件中的 ActiveX 控件。当我尝试运行加载它的函数时，我被 IE 信息栏阻止并显示以下消息：

在 IE 6 和 7 中 - “您的安全设置不允许网站使用安装在您计算机上的 ActiveX 控件” 在 IE 8 中 - “此网站的附加组件无法运行”

当我查看浏览器缓存中删除的错误文件时，它显示错误 800b010b（通用信任失败）。

这一切都发生在本地 Intranet 区域中，我将 IE 安全设​​置降至最低，启用了所有可用选项。后来我将该网站添加到受信任的站点并将所有内容也设置为启用，没有任何变化。

这些测试在多台机器、XP 和 Vista 上进行。我以管理员身份登录所有这些。

如果我用我提供了一个虚拟签名的文件替换 cab 文件，它就可以工作。如果我用一个根本没有签名的文件替换 cab 文件，它就可以工作。如果我尝试使用未过期的 VeriSign 签名运行该签名，则会失败。

在这一点上，我不确定要检查什么。如果有人有线索，我很想听听。

# task - Verilog中的任务

> ID：735424
> 
> 赞同：1
> 
> 时间：2009-04-09T18:38:12.183
> 
> 标签：task, verilog

我正在尝试编写一个提供变量 paddr 不同值的任务：

```
module paddr1 ;
task paddr1;
input [10:0]paddr;
input clock;

 @(posedge clock)
begin
paddr=10
#100; 
paddr=20; 
#100; 
paddr=30; 
#100;  
paddr=40;
#100;   
paddr=50;
#100;   
paddr=60;
#100;  
paddr=70;
#100; 
paddr=80;
#100;

end
endtask
endmodule 
```

我试图从测试台调用这个任务并写道：paddr1 (paddr,clock);

它通过了编译但是当我尝试运行模拟时，我得到一个错误消息：未解决对'paddr1'的引用。感谢您的回答，任务在不同的文件中，然后是测试台

谢谢亚尼夫

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T18:25:17.067

您在模块中有一个任务。那么，您是否在测试平台中实例化了该模块？如果你这样做了，那么你需要查看模块内部来调用任务：

```
module tb();

  paddr1 U0; // instantiate module with the task in it...

  initial begin
     U0.paddr1(paddr,clock);
  end

endmodule 
```

你有更严重的问题。在 verilog 中，参数按值传递给任务。这意味着“时钟”的值将在任务调用的生命周期内固定。您的任务将永远找不到时钟，并且将永远等待。此外，您正在分配一个任务输入，这没有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-10T05:13:39.743

我猜你想要一个`initial`块而不是一个任务。将 paddr 和时钟作为端口连接到模块，然后在`initial begin`您修改 paddr 的块内。

当然，您仍然需要在某个地方实例化 paddr1 才能有用。

# c# - WPF DataGridDetailsTemplate 扩展错误

> ID：735427
> 
> 赞同：0
> 
> 时间：2009-04-09T18:39:26.487
> 
> 标签：c#, wpf

我正在使用 WPFtoolkit 中的 Datagrid，并且遇到了 RowDetailsTemplate 的问题。

我的 RowDetailsTemplate 包含 3 个项目：2 个富文本框和一个按钮。我想要发生的是按钮保持停靠在窗口的右边缘，两个富文本框展开以填充其余空间。我遇到的问题是，如果我将按钮停靠在窗口的右侧，当我放大窗口时，按钮会正确移动并保持在外边缘，但是如果我将窗口缩小，它不会缩小并保持相同的间距。这会导致它位于窗口外并且不可见。这是预期的行为吗？如果有人知道像我描述的那样设置整个详细信息模板的解决方法或解决方案，我将不胜感激。

相关代码：

```
<toolkit:DataGrid.RowDetailsTemplate>
    <DataTemplate>
<DockPanel Width="Auto">
    <DockPanel DockPanel.Dock="Right">
        <Button Height="50" Width="75" Margin="5 5 0 5" DockPanel.Dock="Right">
            <Image Source="Resources/ArrowOutOfBox.bmp" />
        </Button>
    </DockPanel>
    <StackPanel Margin="20 0 20 0" Orientation="Horizontal" HorizontalAlignment="Left" DockPanel.Dock="Left">
        <StackPanel>
            <ToolBar>
                <ToggleButton MinWidth="20" Command="EditingCommands.ToggleBold" CommandTarget="{Binding ElementName=rtbNewComment}" TextBlock.FontWeight="Bold" Content="B" />
                <ToggleButton MinWidth="20" Command="EditingCommands.ToggleItalic" CommandTarget="{Binding ElementName=rtbNewComment}" TextBlock.FontStyle="Italic" Content="I" />
                <ToggleButton MinWidth="20" Command="EditingCommands.ToggleUnderline" CommandTarget="{Binding ElementName=rtbNewComment}">
                    <TextBlock TextDecorations="Underline">U</TextBlock>
                </ToggleButton>
            </ToolBar>
            <RichTextBox 
                                    x:Name="rtbNewComment"
                                    Height="100"
                                    Margin="5 5 0 5"
                                    FlowDirection="LeftToRight" 
                                    VerticalScrollBarVisibility="Auto"
                                    IsReadOnly="False" 
                                    SpellCheck.IsEnabled="true" 
                                    >
            </RichTextBox>
        </StackPanel>
        <StackPanel>
            <RichTextBox 
                                    x:Name="rtbCommentHistory"
                                    Height="125"
                                    Margin="5 5 0 5"
                                    FlowDirection="LeftToRight" 
                                    VerticalScrollBarVisibility="Auto"
                                    IsReadOnly="True" 
                                    SpellCheck.IsEnabled="true" 
                                    >
                <RichTextBox.Resources>
                    <Style TargetType="{x:Type Paragraph}">
                        <Setter Property="Margin" Value="0" />
                    </Style>
                </RichTextBox.Resources>
            </RichTextBox>
        </StackPanel>
    </StackPanel>

</DockPanel>
</DataTemplate>
</toolkit:DataGrid.RowDetailsTemplate> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T19:48:54.620

事实证明，DetailsTemplate 中的 DockPanel 试图将自身居中，但 center 正在计算会上升但不会下降。通过设置 Horizo​​ntalAlignment="Left" 它解决了这个问题。我仍然希望有一种方法可以使所有项目的大小与它们当前的大小成正比来填充盒子，但到目前为止还没有运气。

# sql - 对于在单个语句中多次出现的替换变量，如何使 SQL Developer/SQL+ 只提示一次？

> ID：735429
> 
> 赞同：6
> 
> 时间：2009-04-09T18:41:13.627
> 
> 标签：sql, plsql, variables, substitution

我有一个大致这样的查询：

```
 select * 
  from A_TABLE 
  where A_COLUMN = '&aVariable'
    union
 select * 
  from A_TABLE 
  where B_COLUMN = '&aVariable'; 
```

但是当我运行它时，SQL Developer 两次提示我输入变量，即使它是同一个变量。

如果有办法让它只提示一次使用两次的变量，我该怎么做？

我**不想**使用脚本，它必须是单个可执行查询。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T18:48:48.397

当我撰写这篇文章时，我想出了如何去做：

```
 :a_var
 select * 
  from A_TABLE 
  where A_COLUMN = :a_var
    union
 select * 
  from A_TABLE 
  where B_COLUMN = :a_var; 
```

然后 SQL Developer 将提示输入绑定变量，您可以输入它并点击应用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-04-20T15:45:58.720

```
select * 
  from A_TABLE 
  where A_COLUMN = '&aVariable'
    union
 select * 
  from A_TABLE 
  where B_COLUMN = '&&aVariable'; 
```

请注意第二个（和后续）变量将如何使用双与号 (&&)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T20:41:29.097

我知道您找到了另一种方法，但仅供参考，基本答案是，如果您将 & 符号加倍（例如，使用 '&&aVariable'），那么您为替换变量输入的值将在您的会话长度内被记住. 请注意，在这种情况下，如果您重新执行查询，您将不会再次收到提示，它将继续使用相同的值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-12-17T20:24:09.837

因此，当您使用 & 替换时，您只是使用单个 & 作为一种更快的方式，而不必再次键入一个值。通过使用 &&，值将锁定在变量名中。所以 &&variable 与 &&variable1 不同。通过这种方式，您将收到一次提示，并且您输入的值将与该变量名一致。简单地说，如果您这样编写代码：

```
SELECT *
FROM A_TABLE
WHERE A_COLUMN = '&&aVariable1'
UNION
SELECT *
FROM A_TABLE
WHERE B_COLUMN ='&&aVariable2'; 
```

然后，如果您想使用一组不同的值，则必须将变量名称更改为类似“&&aVariable3”的名称，而“&&aVariable4”对于另一组值应该足够了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-10T17:08:56.527

```
ACCEPT variableToPrompt PROMPT "Enter variable" DEFAULT "test";

SELECT
    *
FROM    
    TABLE
WHERE
    COLUMN = '&variableToPrompt' 
```

> 请注意，只有当您的变量是字符串时，才需要 '&variableToPrompt' 中的 '。默认值是可选的。

# ruby - Ruby 是否有 Log4J 的等价物，Log4Ruby？

> ID：735433
> 
> 赞同：7
> 
> 时间：2009-04-09T18:42:31.550
> 
> 标签：ruby, logging

我环顾四周，找不到一个。Ruby 有没有相当于 Log4X 的东西？如果不是，那么处理所有调试语句的最佳方法是什么。我对 Ruby 很陌生。

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T18:46:23.397

Ruby 带有一个内置的日志库，但是有[log4r](http://web.archive.org/web/20090908004940/http://log4r.sourceforge.net)。

内置库的一个简短示例：

```
#!/usr/bin/env ruby
require 'logger'

log = Logger.new('mylog.txt')
log.debug "Hello log" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-04-08T17:55:38.263

现在有[lenny/log4jruby](https://github.com/lenny/log4jruby)如果有人在这里接近 2020

# data-integrity - 下载软件的工具+自动验证完整性

> ID：735445
> 
> 赞同：-1
> 
> 时间：2009-04-09T18:45:48.360
> 
> 标签：data-integrity

（从一个组合问题移到这里）

我想知道是否有任何软件工具项目可以：

*   创建用于发布小型元数据集的标准机器可读格式 =（下载链接 + MD5 哈希 + 可选公钥和/或证书）
*   加上一个浏览器插件（最好是 Firefox）来自动读取该数据并协助执行以下步骤
    *   下载软件，
    *   验证下载软件的完整性
    *   在日志中添加一个条目，包括此信息以及从哪个页面下载软件。

![https://farm4.static.flickr.com/3335/3426085255_a5266b4435.jpg?v=0](https://farm4.static.flickr.com/3335/3426085255_a5266b4435.jpg?v=0)

我知道我手动生成 MD5 并比较 MD5 哈希，但这是一系列非常重复的步骤，可能容易出错，并且计算机非常擅长自动化这样的事情。

**更新：** @cynoclast 的回答让我很好奇，我[在 DownThemAll](http://bugs.code.downthemall.net/trac/ticket/123)和[这个微格式](http://microformats.org/wiki/hash-examples)和[这个 firefox 想法](http://mdhashtool.mozdev.org/lfinfo.html)中遇到了这个 bugtrack 项目，这至少让我相信其他人也在沿着这些思路思考。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T18:57:59.127

## 全部下载

这是一个火狐插件：

[![替代文字](https://www.downthemall.net/images/ss/win32/add.png)](http://www.downthemall.net/)

# c# - 为 Web 服务动态构建数组

> ID：735446
> 
> 赞同：1
> 
> 时间：2009-04-09T18:45:58.747
> 
> 标签：c#, arrays, web-services

我正在使用 C# 和 asp.net 来查询 Web 服务。

用户将输入客人数量，然后我需要将该客人数量添加到网络服务调用中。像这样手动创建客人是可行的。

```
// Create room layout for searching

Guest adult = new Guest();
adult.Id = 1;
adult.Title = "Mr";
adult.Firstname = "Test";
adult.Surname = "Test";

Guest adult2 = new Guest();
adult2.Id = 2;
adult2.Title = "Mr";
adult2.Firstname = "Test";
adult2.Surname = "Test";

Guest[] adults = new Guest[] { adult,adult2 }; 
```

用户在我的站点搜索页面上选择成人人数，我不知道成人人数，希望能够将他们动态添加到 Web 服务调用中。我将收到这样的成年人数量

```
int numberofguests = Convert.ToInt32(search.Guest); 
```

我已经尝试了很多方法，但无法让它工作

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T18:49:22.873

```
List<Guest> guests = new List<Guest>();
for(int i=0; i<numberOfGuests; i++)
{
  guests.Add(new Guest()
  {
    Title = "Mr",
    Firstname = "Test",
  });
}
return guests.ToArray(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:47:43.643

在这种情况下，我建议使用[List](http://en.csharp-online.net/Generic_Lists)而不是数组。如果您仍然需要它作为数组，则可以在填充后将其转换为数组。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T18:47:49.150

为什么不使用 ArrayList 或 List<Object> 而不是使用原始数组？

```
var list = new List<Guest>();
adult.Id = 1;
adult.Title = "Mr";
adult.Firstname = "Test";
adult.Surname = "Test";
list.Add(adult);

Guest adult2 = new Guest();
adult2.Id = 2;
adult2.Title = "Mr";
adult2.Firstname = "Test";
adult2.Surname = "Test";
list.Add(adult2);

Guest[] adults = list.ToArray(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T18:57:53.337

所有其他答案都建议使用`List<Guest>`，通常我会同意 - 但在这种情况下，实际上没有必要，因为您似乎事先知道大小：

```
Guest[] guests = new Guest[numberOfGuests];
for (int i=0; i < numberOfGuests; i++)
{
    Guest guest = new Guest();
    // Fill in information about the guest here
    // based on the web form
    guests[i] = guest;
} 
```

这并不是说你*不应该*使用 a`List<Guest>`如果它更方便 - 只是使用 a 的（可能）最大的好处`List<T>`是你不需要提前知道大小。因为这在这里不相关（除非我遗漏了一些东西），所以没有太多理由使用列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T18:51:10.687

我建议你使用`List<Guest>`. 您可以在创建时使用客人数量来初始化大小，但这实际上只是一种优化。如果您想稍后添加更多客人，您可以这样做，并且`List`会根据需要调整大小。

`List``ToArray()`如果您出于某种原因想将列表转换为数组，则有一种方法。

# c# - C# 从自定义函数访问表单控件

> ID：735461
> 
> 赞同：1
> 
> 时间：2009-04-09T18:51:13.867
> 
> 标签：c#, winforms, webbrowser-control

如何从 myFunct() 中正确访问 Web 浏览器控件？Main.myWebBrowserControl & Main::myWebBrowserControl 不起作用。

```
namespace foo{
    public partial class Main : Form{
        public Main(){
            InitializeComponent();
            // Do some things...
            MyFunct();
        }
        public static void MyFunct(){
            myWebBrowserControl.Navigate("http://www.google.com"); // causing an error.
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:59:06.207

除了不是静态的（如上所述）之外，您还必须确保您正在执行的内容是在应用程序的“主线程”上。这是处理事件的同一线程（例如处理来自应用程序的“点击事件”），因此如果您从那里调用该方法，那么您很好，但如果不是，您必须包装一个 Invoke( ) 或 BeginInvoke() 调用 Navigate()。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:53:16.890

您不能从静态函数访问实例成员，将函数声明更改为

 `````
 public void MyFunct(){
            myWebBrowserControl.Navigate("http://www.google.com"); 
    } 
````  `* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T18:53:15.563

使 MyFunct 不是静态的。

# javascript - 通过以编程方式更改文本框值来调用 Javascript onchange 事件

> ID：735462
> 
> 赞同：11
> 
> 时间：2009-04-09T18:52:09.247
> 
> 标签：javascript, textbox, onchange

我面临的问题是：

*   我在日历控件旁边有一个日期范围的文本框。
*   当用户从日历中选择一个日期时，它将该日期填充到文本框中
*   发生这种情况时，我想触发一个 javascript 函数，但是，'onchange' 事件似乎没有发生。

理想情况下，我希望能够将事件作为属性添加到文本框，例如：

```
txtCreateDate.Attributes.Add("onchange", string.Format("JSfunction({0},'{1}');", arg1, arg2)); 
```

更多信息：日期在 c# 中输入到文本框中。日历控件在页面上有一个事件处理程序。选择日期后，事件处理程序将日期放入文本框中。此时我已尝试将焦点设置到文本框，然后在文本框上放置一个 onBlur 属性，但文本框似乎从未获得焦点。

我想此时我可以直接调用 javascript 函数来执行 ClientScript.RegisterClientScriptBlock 或类似的操作，但这似乎很草率，而且永远不会像我想要的那样工作。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-09-02T17:06:21.523

这是一个老问题，我不确定它是否会有所帮助，但我已经能够使用以下方式以编程方式触发事件：

```
if (document.createEvent && ctrl.dispatchEvent) {
    var evt = document.createEvent("HTMLEvents");
    evt.initEvent("change", true, true);
    ctrl.dispatchEvent(evt); // for DOM-compliant browsers
} else if (ctrl.fireEvent) {
    ctrl.fireEvent("onchange"); // for IE
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T19:03:13.997

您误解了 onchange 事件在应用于 textarea 时的作用。直到失去焦点或您按下回车键，它才会触发。为什么不从填充文本区域的选择上的 onchange 触发函数？

在此处查看有关 onchange 事件的更多信息：[w3schools](http://www.w3schools.com/JS/js_htmldom_events.asp)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-09T19:21:58.757

您可以简单地触发事件

```
document.getElementById("elementID").onchange();

```

我不知道这是否不适用于某些浏览器，但它应该适用于 FF 3 和 IE 7+

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T19:00:59.943

`Onchange`仅在用户通过键盘输入内容时触发。一个**可能的**解决方法可能是首先关注文本字段然后更改它。

但是为什么不在用户点击日期时获取事件呢？必须已经有一些javascript。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T21:56:18.387

您的人口来自服务器端。使用 registerclientscript 会将脚本放在表单的开头。您需要使用 RegisterStartupScript(Block) 将脚本放置在相关页面的末尾。

前者尝试在 dom 中存在文本区域之前运行脚本，后者将在页面中的元素创建后运行脚本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-02T16:31:26.107

你可以试试[Anthem 库](http://www.codeproject.com/kb/Ajax/AnthemNET.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-08-22T13:42:38.957

您可以将它放在不同的类中，然后调用一个函数。这在ajax刷新时有效

```
$(document).on("change", ".inputQty", function(e) {

//Call a function(input,input);
}); 
```

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-04-09T19:04:29.670

仅当以编程方式更改属性或用户进行更改然后将注意力从字段上移开时，才会触发“onchange”。

你看过使用 YUI 的日历对象吗？我编写了一个解决方案，将 yui 日历放在 yui 面板中并隐藏面板，直到单击关联的图像。我可以看到两者的变化。

[http://developer.yahoo.com/yui/examples/calendar/formtxt.html](http://developer.yahoo.com/yui/examples/calendar/formtxt.html)

# cassini - 使用 Cassini 时找不到网页

> ID：735463
> 
> 赞同：1
> 
> 时间：2009-04-09T18:52:10.823
> 
> 标签：cassini, webdev.webserver

大约一个星期以来，我一直无法在 Cassini 中加载网页。

我能够打开到服务器的 telnet 会话 - 假设我在端口 8101 上托管，键入`telnet localhost 8101`结果会打开连接。我可以简单地输入`GET`并最终得到回复：

```
HTTP/1.1 400 Bad Request
Server: ASP.NET Development Server/9.0.0.0
Date: Thu, 09 Apr 2009 18:45:37 GMT
Content-Length: 1208
Connection: Close 
```

（为简洁起见，省略了实际的 HTML。可以说这是一个显示“错误请求”的网页。）

在发现 Windows 更新与它混淆后，我更新了我的主机文件。它正好有两条非注释行：

```
::1             localhost
127.0.0.1       localhost 
```

我尝试使用 Fiddler 监控流量并获得“目标机主动拒绝请求”。

我的防火墙已关闭（无论如何，只要域策略允许）。我正在运行 Vista x64 并安装了 IIS 7，并且可以简单地导航到[http://localhost/](http://localhost/)并轻松打开 IIS7 欢迎页面。如果我选择在 IIS 中托管 Web 项目，它可以工作（除了几个自定义 HTTP 模块尚未更新为在 IIS7 中工作，因此这不是永久性的）。

还有其他想法吗？

编辑：尝试使用 FireFox - 在地址栏中获取：

[http://localhost:8080/Error.aspx?k=7b85a233-0459-47ab-9414-20c94350ee0e&](http://localhost:8080/Error.aspx?k=7b85a233-0459-47ab-9414-20c94350ee0e&)

页面内容如下：

重定向循环

Firefox 检测到服务器正在以永远不会完成的方式重定向对该地址的请求。

浏览器已停止尝试检索请求的项目。该站点以永远不会完成的方式重定向请求。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T19:17:26.940

看起来您有一个名为“Error.aspx”的自定义错误页面，但该页面本身会引发错误，导致另一个重定向到“Error.aspx”，因此浏览器陷入重定向循环。在 IE 中，您只会看到它继续工作，但从不加载任何内容。听起来 Firefox 检测到了这个问题。

如果您可以远程登录到该端口，那么这不是防火墙问题。

我不认为提琴手问题是相关的。

# visual-c++ - 使用 GetHttpConnection 进行 NTLM 身份验证

> ID：735465
> 
> 赞同：2
> 
> 时间：2009-04-09T18:52:34.817
> 
> 标签：visual-c++, ntlm

我有一个 VC++ (6.0) 应用程序。我们想使用 NTLM 身份验证来访问服务器。我提示输入 URL、ID 和密码，并在我的 internetSession.GetHttpConnection 调用中发送它们，如果您输入域\id 和密码，它可以正常工作，使用 NTLM。

我们希望当前登录到服务器所在域的用户不必输入他们的 ID 和密码。我们如何做到这一点？我认为这与“直通身份验证”或 WindowsIdentity 有关。一直在谷歌搜索，但如果有人有一个快速的答案，我肯定会很感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-03-23T00:23:10.143

你能用 WinHTTP 代替 WinInet 吗？看看这个包装 WinHTTP的[库。](http://www.codeproject.com/KB/IP/featured_win_HTTP_wrapper.aspx)我认为它使用 WinHttpGetIEProxyConfigForCurrentUser() 为您获取此信息。我通过配置为使用 NTLM 而没有任何问题的 Microsoft ISA 代理发出请求，因此我假设它会识别为您针对另一台使用 NTLM 的服务器。

# c# - 你能从这两种方法中重构出一个共同的功能吗？

> ID：735473
> 
> 赞同：7
> 
> 时间：2009-04-09T18:55:25.137
> 
> 标签：c#, .net, refactoring, csv

我有两种方法可以基本上将底层复选框的文本或标签转换为 CSV 字符串。

这两种方法

*   GetSelectedTextAsCsv()
*   GetTagAsCsv()

不同之处仅在于从哪个*属性*中提取值`SelectedCheckBoxes`，它是类型`IList<CheckBox>`

```
 public string GetSelectedTextAsCsv()
    {
        var buffer = new StringBuilder();
        foreach (var cb in SelectedCheckBoxes)
        {
            buffer.Append(cb.Text).Append(",");
        }
        return DropLastComma(buffer.ToString());
    }

    public string GetTagAsCsv()
    {
        var buffer = new StringBuilder();
        foreach (var cb in SelectedCheckBoxes)
        {
            buffer.Append(cb.Tag).Append(",");
        }
        return DropLastComma(buffer.ToString());
    } 
```

我试图提取一个返回 a`Func<T, TResult>`但不确定如何实现它的方法。我的糟糕尝试如下所示，但我无法弄清楚如何提取属性部分，如评论中所示`ConvertToCsv()`

```
 public Func<T, string> ConvertToCsv<T>()
    {
        return propertyName =>
        {
            var buffer = new StringBuilder();
            foreach (var checkBox in SelectedCheckBoxes)
            {
                buffer.Append(
                    /* How can you abstract this portion? like following? */ 
                    checkBox.propertyName
                ).Append(",");
            }
            return DropLastComma(buffer.ToString());
        };
    } 
```

如果我走错了路，请您告诉我如何重构上面的代码以使用通用方法？

**[更新 1]**这是布赖恩和乔恩的答案的组合

```
 public string ConvertToCsv<T>(Func<CheckBox, T> getValue)
    {
        var stringValues = SelectedCheckBoxes.Select(
            cb => getValue(cb).ToString()).ToArray();
        return string.Join(",", stringValues);
    }

    public string GetSelectedTextAsCsv()
    {
        return ConvertToCsv(cb => cb.Text);
    }

    public string GetTagAsCsv()
    {
        return ConvertToCsv(cb => cb.Tag);
    } 
```

**[更新 2]**版本 2

```
 public string GetAsCsv<T>(Func<CheckBox, T> getValue)
    {
        return string.Join(",", SelectedCheckBoxes.Select(
            cb => getValue(cb).ToString()).ToArray());
    }

    public string GetSelectedTextAsCsv()
    {
        return GetAsCsv(cb => cb.Text);
    }

    public string GetTagAsCsv()
    {
        return GetAsCsv(cb => 
            cb.Tag == null ? string.Empty : cb.Tag.ToString());
    } 
```

**[更新 3]**将参数`GetAsCsv()`设为 CheckBox 和字符串的封闭泛型

> `Func<CheckBox, T>`到`Func<CheckBox, string>`.

这让我变得`GetAsCsv()`更简单、更易读。

```
private string GetAsCsv(Func<CheckBox, string> getValue)
{
    return string.Join(",", SelectedCheckBoxes.Select(getValue).ToArray());
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-09T18:58:18.577

```
public string GetAsCsv(Func<CheckBox, string> getValue)
{
    var buffer = new StringBuilder();
    foreach (var cb in SelectedCheckBoxes)
    {
        buffer.Append(getValue(cb)).Append(",");
    }
    return DropLastComma(buffer.ToString());
} 
```

然后：

```
GetAsCsv(cb => cb.Tag != null ? cb.Tag.ToString() : string.Empty);
GetAsCsv(cb => cb.Text); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-09T19:01:46.417

我会`string.Join`改用：

```
string tags = string.Join(",", 
                  SelectedCheckBoxes.Select(cb => Convert.ToString(cb.Tag))
                                    .ToArray());
string text = string.Join(",", 
                  SelectedCheckBoxes.Select(cb => cb.Text).ToArray()); 
```

当然，您可以将其放入一个方法中，但我可能不会只为两次调用而烦恼。

但是，如果您愿意，可以使用 Brian 的模板如下所示：

```
public string GetAsCsv(Func<CheckBox, string> getValue)
{
    string[] array = SelectedCheckBoxes.Select(getValue).ToArray();
    return string.Join(",", array);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T19:02:03.280

您可以使用 lambda：

```
public string ConvertToCSV(Func<CheckBox, string> cb_prop) {
    ...
    buffer.Append(cb_prop(cb)).Append(",");
    ...

}

ConvertToCSV(c => c.Tag); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T19:41:15.573

我只需围绕 IEnumerable 字符串编写一个简短的扩展方法，该方法采用分隔符：

```
public static string Join(this IEnumerable<string> strings, string separator)
{
    return string.Join(separator, strings.ToArray());
} 
```

那么你可以这样做：

```
var text = SelectedCheckBoxes.Select(cb => cb.Text).Join(", ");
var tags = SelectedCheckBoxes.Select(cb => (string)cb.Tag).Join(", "); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T18:59:54.860

*由于除了*getter 之外，这两个函数完全相同，因此您应该从这里开始：移动部分。

还没有复习我的 C#，但大致如下：

```
 public string GetCsv(Func<string> getter)
    {
        var buffer = new StringBuilder();
        foreach (var cb in SelectedCheckBoxes)
        {
            buffer.Append(getter()).Append(",");
        }
        return DropLastComma(buffer.ToString());
    } 
```

应该管用。另外，使`SelectedCheckBoxes`变量？

# sql - 引用另一个数据库中的存储过程？

> ID：735482
> 
> 赞同：0
> 
> 时间：2009-04-09T18:58:00.590
> 
> 标签：sql, mysql, stored-procedures

从给定 MySQL 数据库中的存储过程或函数，是否可以引用另一个 MySQL 数据库中的存储过程或函数，如下所示？

```
SELECT 
    some_table.field1,
    some_table.field2,
    another_database.STORED_PROCEDURE(arg), 
    ...
FROM ...
WHERE ... 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T19:03:14.340

是的，您可以，只需在它们前面加上数据库名称即可。

顺便说一句：你展示的是一个存储的函数。对于存储过程，您必须使用 CALL 并且它们不能返回值。

# c - OpenGL、SOIL 库和带纹理的矩形

> ID：735493
> 
> 赞同：1
> 
> 时间：2009-04-09T19:00:40.553
> 
> 标签：c, opengl, glut, soil

我正在尝试使用 SOIL 和 GLUT 在 OpenGL 中制作一个简单的纹理矩形。

这是我的显示函数（主要由 glutDisplayFunc(Display) 执行）：

```
void Display ()
{
    GLuint tex_2d;

    glMatrixMode (GL_MODELVIEW);
    glLoadIdentity ();
    glClear (GL_COLOR_BUFFER_BIT);
    glClearColor (1.0,1.0,1.0,1.0);
    gluLookAt (eyex,eyey,eyez,centerx,centery,centerz,0,1,0);

    glEnable(GL_TEXTURE_2D);
     tex_2d = SOIL_load_OGL_texture
    (
        "img.png",
        SOIL_LOAD_AUTO,
        SOIL_CREATE_NEW_ID,
        SOIL_FLAG_MIPMAPS | SOIL_FLAG_INVERT_Y | SOIL_FLAG_NTSC_SAFE_RGB | SOIL_FLAG_COMPRESS_TO_DXT
    );
     if( 0 == tex_2d )
    {
        printf( "SOIL loading error: '%s'\n", SOIL_last_result() );
        exit(1);
    }

   glBindTexture(GL_TEXTURE_2D, tex_2d);

    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR_MIPMAP_LINEAR); 

    glColor3f (0.0,0.0,0.0);
    glBegin(GL_POLYGON);

                       glTexCoord2f(0.0f, 0.0f); glVertex2f(0.0f, 0.0f);
                       glTexCoord2f(1.0f, 0.0f); glVertex2f(1.0f, 0.0f);
                       glTexCoord2f(1.0f, 1.0f); glVertex2f(1.0f, 1.0f);
                       glTexCoord2f(0.0f, 1.0f); glVertex2f(0.0f, 1.0f);

     glEnd();   
    glDisable(GL_TEXTURE_2D);
    glFlush ();
    glutSwapBuffers();
} 
```

有了这个，只能看到一个没有任何纹理的黑色矩形。我试图用这个做几个小时。请帮助，提前谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T21:28:45.300

是不是在绘制矩形之前将颜色设置为黑色？线

```
glColor3f (0.0,0.0,0.0); 
```

试试白色吧...

```
glColor3f (1.0,1.0,1.0); 
```

# html - CSS 的另一个 Safari 宽度问题

> ID：735500
> 
> 赞同：0
> 
> 时间：2009-04-09T19:02:30.190
> 
> 标签：html, css, safari, cross-browser

我正在制作这个网站[http://www.christopherbier.com/gbg/locations.html](http://www.christopherbier.com/gbg/locations.html)

在 mac 上的 safari 中，内容 div 的宽度比其他浏览器中的要大。它与右侧栏位重叠。我不知道如何解决这个问题。这是我的CSS：

```
#mainwrap {
    width:1000px;
    margin-right:auto;
    margin-left:auto;
    background-color:#f0f0f0;
    min-height:200px;
}
body{
    background-color:#4c7094;
    background-image: url(images/bg.gif);
    background-repeat:repeat-x;
    font-size:.9em;
    color:#FFF;
    margin-top:0px;
    font-family: Tahoma, Geneva, sans-serif;
}

a{
    color:#335b83;
}
#nav {
    float:left;
    padding: 0px 0px 0px 3px;
    margin: 0px 0px 0px 0px;
    list-style:none;
    border:0px solid #000;
    background-color:#FFF;
}

#nav li { 
    float:left;
    margin: 3px 3px 0px 0px;
    font-family:Tahoma, Geneva, sans-serif;
    background-color:#e7ebf0;
    border:3px double;
    display: inline;
    border-color:#99aabb;
}

#nav a {
    float:left;
    display: block;
    color:#1d4c7b;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

#nav a:hover {
    float:left;
    display: block;
    color:#FFF;
    padding: 5px 15px 5px 15px;
    font-size: .8em;
    background-color:#5b7290;
    vertical-align:middle;
    text-decoration:none;
    font-family: Georgia, "Times New Roman", Times, serif;
}

h2 {
    font-size:2em;
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    display: inline;
    font-family:Georgia, "Times New Roman", Times, serif;
}

h3 {
    font-size:1.5em;
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    display: inline;
    color:#335b83;
    font-family:Georgia, "Times New Roman", Times, serif;
    border-bottom: 1px;
    border-bottom-color: #497caf;
    border-bottom-style: dotted;
    border-width: 80%;
}

h4 {
    font-size:1.2em;
    margin: 0px 0px 0px 0px;
    padding: 0px 0px 0px 0px;
    display: inline;
    color:#999;
    font-family:Georgia, "Times New Roman", Times, serif;
}

#phonebar{
    padding: 0px 6px 9px 6px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:left;
    border:0px solid #000;
    width:120px;
    text-align:center;
}

#asseenbar{
    padding: 0px 9px 9px 6px;
    margin-right: 0px;
    background-image: url(images/phonebg.gif);
    background-repeat: repeat-x;
    background-color:#335b83;
    color:#FFF;
    float:left;
    border:0px solid #000;
    width:188px;
    text-align:center;
}

#footer {
    clear:both;
    margin-right:auto;
    margin-left:auto;
}

#footerpre{
background-image: url(images/footerpre.jpg);
background-repeat:repeat-x;
width: 1000px;
height:73px;
border: 0px solid #000;
margin-top:0px;
margin-bottom:0px;
    margin-right:auto;
    margin-left:auto;
}

#footerfin{
    background-image: url(images/footerfin.jpg);
background-repeat:repeat-x;
width: 1000px;
margin-top:0px;
    margin-right:auto;
    margin-left:auto;
}

#phone {
    font-size:1em;
    margin: 0px 0px 0px 0px;
    padding: 8px 0px 0px 0px;
    font-family:"Times New Roman", Times, serif;
}

#asseen {
    font-size:.8em;
    margin: 0px 0px 0px 0px;
    padding: 9px 0px 0px 5px;
    text-align:left;
    font-family:"Times New Roman", Times, serif;
}

#menubar{
    clear:left;
    margin-bottom:0px;
    width:1000px;
    margin-left:auto;
    margin-right:auto;
    background-color:#FFF;
    background-image:url(images/phonebg.gif);
    background-repeat:repeat-x;
    height:38px;
}

#content{
    margin-right:auto;
    margin-left:auto;
    background-color:#FFF;
    width:772px;
    min-height:400px;
    float:left;
    margin-bottom: 0px;
    padding: 20px 5px 5px 20px;
    border:0px solid #000;
    color:#333;
}

    #gpbar {
        float:right;
        width:188px;
        padding: 0px 9px 9px 6px;
        min-height:400px;
        background-color:#f0f0f0;
    } 
```

和我的 HTML：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Georgia Buying Group</title>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="mainwrap">
 <center> <img src="images/banner.jpg" width="1000" height="72" /></center>
<div id="menubar">
<div id="phonebar">
<p id="phone">888-325-1924</p>
</div>
  <ul id="nav">
<li><a href="index.html">HOME</a></li>
<li><a href="webuy.html">WHAT WE BUY</a></li>
<li><a href="goldparty.html">GOLD PARTIES</a></li>
<li><a href="aboutus.html">ABOUT US</a></li>
<li><a href="locations.html">LOCATIONS</a></li>
<li><a href="contact.html">CONTACT US</a></li>
</ul>
<div id="asseenbar">
<p id="asseen">Call or Stop By Today!</p>
</div>
</div>
<div id="content">
  <h3>Our Locations
  </h3><br /><br />
  <h2>Acworth   </h2>
  <h4> Cobb County</h4>
    <br />3451 Cobb Parkway Suite 7
    Acworth, GA, 30101 <a href="http://www.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=3451+Cobb+Parkway+Suite+7+Acworth,+GA,+30101+&amp;sll=37.0625,-95.677068&amp;sspn=33.710275,79.101563&amp;ie=UTF8&amp;ll=34.04889,-84.686136&amp;spn=0.008606,0.019312&amp;z=14&amp;iwloc=A">View Larger Map</a>

<table cellpadding="5px"><tr>
  <td valign="top" width="325"><iframe width="325" align="left" height="225" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://www.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=3451+Cobb+Parkway+Suite+7+Acworth,+GA,+30101+&amp;sll=37.0625,-95.677068&amp;sspn=33.710275,79.101563&amp;ie=UTF8&amp;ll=34.04889,-84.686136&amp;spn=0.008606,0.019312&amp;z=14&amp;iwloc=A&amp;output=embed"></iframe><br /><img src="images/store.jpg" /></td><td width="317" valign="top">
    <u><b>Store Hours:</b></u><br />
    <table><tr><td bgcolor="#EBEBEB"><strong>Sunday</strong></td><td>10a - 6p</td></tr>
   <tr><td bgcolor="#EBEBEB"><strong>Monday</strong></td><td>10a - 6p</td></tr>
   <tr><td bgcolor="#EBEBEB"><strong>Tuesday</strong></td><td>10a - 6p</td></tr>
    <tr><td bgcolor="#EBEBEB"><strong>Wednesday</strong></td><td>10a - 6p</td></tr>
    <tr><td bgcolor="#EBEBEB"><strong>Thursday</strong></td><td>10a - 6p</td></tr>
    <tr><td bgcolor="#EBEBEB"><strong>Friday</strong></td><td>10a - 6p</td></tr>
    <tr><td bgcolor="#EBEBEB"><strong>Saturday</strong></td><td>10a - 6p</td></tr>
    </table><br />
    <u><b>Phone:</b></u> <h2>888-325-1924</h2>
    <br />
<br />
   <u><b>Servicing:</b></u>
  <br /><h4> Acworth, Woodstock, Cartersville,<br /> Marietta, Kennesaw, Roswell,</h4><br />Alpharetta, Canton, Powder Springs, Smyrna, Sandy Springs, Atlanta,  Rome, Ludyville, Rockmart, Lathentown, Sugar Valley</td></tr></table></div>
  <div id="gpbar"></div>
<div id="footer"><p id="footerpre"></p></div></div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T20:09:09.873

我没有mac所以看不到，但有几点：

> > 您的 xhtml 无效。center> 不再存在（从外观上看，设计中实际上并不需要），您还应该以 px 为单位指定任何标题图像的尺寸。
> > 
> > 不知道为什么你在除 mainwrap 之外的任何东西上使用自动边距。尝试保证金：0；反而
> > 
> > 尝试添加 * {margin:0; padding:0} 到样式表的顶部，然后添加您以后需要的任何额外的填充和边距——这或多或少会在布局方面将所有浏览器设置为相同的起点。
> > 
> > 如果您不想要边框，请使用 {border:none} （如果您说边框：0px solid；某些浏览器仍会尝试绘制一些东西）

这可能无法解决问题，但它将朝着正确的方向迈出一步，因为您的标记越[有效](http://validator.w3.org/)，浏览器就越容易找到它来呈现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:21:49.067

我在我的 Safari 4 beta 副本中没有看到问题，但我不确定您会遇到什么问题，因为右侧的侧边栏是空的，所以我不确定如何判断它是否存在重叠。也许您应该澄清您遇到的确切问题？

为了调试问题，或者自己解决或提出更具体的问题，您应该尝试将问题简化为查看问题所需的最小示例。删除所有与问题无关的内容和结构，并确保问题仍然存在。删除所有与问题无关的 CSS，并确保问题仍然存在。然后你应该有一个简单的例子，每个 HTML 和 CSS 不超过 10 行。如果你把它剥离得足够远，你可能会在这个过程中发现你的问题（如果删除 CSS 的其中一行让你的问题消失，那么你已经找到了问题），如果不是这样，你会拥有一些其他人能够为您提供更好建议的东西，而不必费力地阅读所有无关的代码。

如果您仍然无法找出问题所在，您应该尝试 Safari 中的网络检查器。在 Safari 4 beta 中，您可以转到“高级”首选项，然后选择“在菜单栏中显示开发菜单”。我不记得这个偏好是什么时候引入的，但是在早期版本的 Safari 中，你应该能够按照[这些说明](http://www.macosxhints.com/article.php?story=2007061303320554)来启用检查器。完成此操作后，您应该能够右键单击（如果没有鼠标右键，请按住 Control 单击）并选择“检查元素”，以调出 Web 检查器。在最新版本的 Safari 中，您还应该能够从“开发”菜单中选择“显示 Web 检查器”（Command-Option-I）。

# php - 如何在不加载源文件的情况下使用php函数？

> ID：735501
> 
> 赞同：2
> 
> 时间：2009-04-09T19:02:37.413
> 
> 标签：php, function

例如，我想使用我的函数，`DebugR()`但我不想使用 require 或 include (with `include_path`) 来加载包含源的函数文件。

我知道我可以使用自动加载，但是这个操作在我的 php 配置中必须是通用的。我想我必须创建一个 PHP 扩展，但还有其他方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T19:05:58.577

您可以执行一条 PHP 配置行。

文档是这样说的：

auto_prepend_file 字符串

```
Specifies the name of a file that is automatically parsed before the main file. The file is included as if it was called with the require() function, so include_path is used.

The special value none disables auto-prepending. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:05:17.907

如果不构建扩展，或者自动加载一类函数，或者直接将函数请求到页面中，或者在同一个文件中编写函数，我很确定没有办法不调整你的 PHP 配置。

出于好奇，不想做这些事情的原因是什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T19:05:40.620

为什么不使用将代码作为 BC 缓存在内存中的加速器呢？
您仍然需要编写“include”指令。
如果扩展是你的目标，那么从任何可用的开源加速器中分叉。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T02:23:35.263

唯一可行的方法是使用这样的自动加载：

```
// your_file.php
function __autoload($class)
{
    require_once('./classes/' . $class . '.php');
}

echo _::Bar();
var_dump(_::DebugR());
echo _::Foo();

// ./classes/_.php
class _
{
    function Bar()
    {
        return 'bar';
    }

    function DebugR()
    {
        return true;
    }

    function Foo()
    {
        return 'foo';
    }
} 
```

当然，每个函数都将存储在这个 _ 类中。

另一种选择是，如果您在对象内工作，则使用 __call() 魔术方法并执行以下操作：

```
return $this->DebugR(); 
```

# java - 寻路 2D Java 游戏？

> ID：735523
> 
> 赞同：14
> 
> 时间：2009-04-09T19:09:09.660
> 
> 标签：java, path, path-finding

我目前正在根据*[Theme Hospital](https://en.wikipedia.org/wiki/Theme_Hospital)*的想法编写一个非常基本的 Java 游戏。

我对 Java 很陌生，目前正在大学第一年学习。我已经断断续续地做了近两年的 Java，但我终于把时间花在了一个像样的项目上。

我正处于需要创建一个人（患者）才能入院的阶段。他们需要去接待处，然后是GP的办公室，然后回到他们的起始位置。

我已经研究过 A* 路径查找，但对我来说似乎真的很复杂。我理解它是如何工作的，但我不确定如何在我的游戏中实现它。

至此，用户可以放置一个前台，搭建一个全科医生的办公室。每一个都有一个“使用点”，这将是患者必须到达的地方。格子方格只能满或不满，不会有不同的地形。

我对粘贴任何代码犹豫不决，因为在过去几个月中我学习了很多与 GUI 相关的新技术，这很混乱。我的计划是达到里程碑 1，让患者去办公桌，然后办公室，然后离开。一旦我有了这个，我会更多地整理代码。

我见过许多 A* 的实现和许多不同的类型。有人可以给我一个可以合作的起点吗？我应该尝试改编一组已经编写好的类，还是尝试从头开始编写自己的类？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T19:13:57.387

您确实需要 A*，它是基于网格的寻路的最佳实现。

这可能会帮助你：

[http://www.cokeandcode.com/main/tutorials/path-finding/](http://www.cokeandcode.com/main/tutorials/path-finding/)

**编辑：**前面的链接既可以作为一组可实现的类，也可以作为自定义寻路方法以满足您的满意度的指南。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T11:45:30.060

这是迄今为止我看到的信息量最大的寻路帖子：[http ://www.ai-blog.net/archives/000152.html](http://www.ai-blog.net/archives/000152.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T19:14:11.800

《[AI for Game Developers](http://oreilly.com/catalog/9780596005559/) 》一书对 A* 有很好的解释。我今天实际上打算编写一个实现......如果我这样做了，我会把代码扔在这里。

代码写好了，放在这里太大了，可以从： [https](https://chaos.bcit.ca/svn/public/astar/) ://chaos.bcit.ca/svn/public/astar/ （自签名证书，但是服务器没有做恶）。

我大部分时间都遵循书中的伪代码，但我所做的一切都比我迄今为止看到的 A* 更面向对象。

你有一个由瓷砖组成的迷宫。每个 Tile 都有一个 Location 和一个 Obstacle（如果没有障碍物，则为 null）。

您可以使用路径查找器（如 AStar）来查找给定开始位置和结束位置之间的最短路径。你会得到一条返回路径，其中包括从开始到结束需要经过的瓷砖。

您可以通过提供不同的 HeuristicCalculator 来更改启发式计算（当前的只是检查是否有障碍物并找出要通过的最短瓷砖数，例如，如果您不这样做，您可以将权重添加到不同的障碍物'不喜欢默认）。

该代码是 LGPL 下的许可证，因此如果您进行更改并分发应用程序，您必须使更改可用。随时将错误报告/修复发送到许可证注释中的电子邮件地址（在每个标题中找到）。

我会（从来没有）在考试后评论它，但我认为这很简单。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T23:03:56.880

如果您编写自己的实现，您自然会学到很多关于寻路的知识。但是你也会花很多时间去做这件事。

查看[JGraphT](http://jgrapht.sourceforge.net/)库，它通常处理图，有一个很好的 API 并且支持比 A*[更多的最短路径算法。](http://www.jgrapht.org/javadoc/org/jgrapht/alg/DijkstraShortestPath.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-16T10:33:47.333

也许你找到了你想要的，但这里有一个链接，其中包含 A* 寻路的一个很好的解释。我必须在[C++](http://en.wikipedia.org/wiki/C%2B%2B)中为我的游戏实现 A* ，这对我理解它的工作原理有很大帮助。

[http://www.abdn.ac.uk/~csc245/teaching/CS1015/practicals/aStarTutorial.htm](http://www.abdn.ac.uk/~csc245/teaching/CS1015/practicals/aStarTutorial.htm)

# jquery - jQuery代码不起作用，代码有什么问题？

> ID：735526
> 
> 赞同：1
> 
> 时间：2009-04-09T19:09:36.460
> 
> 标签：jquery

我正在关注 nettuts 的教程，特别是这里：

[http://blog.themeforest.net/tutorials/jquery-for-absolute-beginners-day-11/](http://blog.themeforest.net/tutorials/jquery-for-absolute-beginners-day-11/)

我是视频的 3/4，当我尝试测试页面时，它无法正常工作。

这是aspx页面：

```
$(function() {
  $('a').hover(function(e) {
    var href = $(this).attr('href');
    $('<img id="largeImage" src="' + href + '" alt="big image" />')
      .css('top', e.pageY)
      .css('left', e.pageX)
      .appendTo('body');
  }, function() {
    $('#largeImage').remove();
  });
});
```

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title></title>
  <link href="css/default.css" rel="stylesheet" type="text/css" />
  <script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="js/myscript.js" type="text/javascript"></script>
</head>

<body>
  <a href="images/one.jpg"><img src="images/oneTN.jpg" alt="some image" /></a>
  <a href="images/two.jpg"><img src="images/twoTN.jpg" alt="some image" /></a>
  <a href="images/three.jpg"><img src="images/threeTN.jpg" alt="some image" /></a>
</body>
<html>
```

我所在的教程部分不完整，但此时，当您将鼠标悬停在图像上时，它应该显示它没有做的大图像。我错过了类似的东西`;`吗`)`？

我刚刚意识到我在脚本中有一个 console.log，但我不确定它为什么仍然无法运行。这是萤火虫的设计吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:50:38.717

console.log() 仅适用于支持它的调试环境，例如 Firebug，如果您尝试在 IE 中运行该页面，您将收到错误消息。

脚本中的 console.log 在哪里？如果它的格式正确，那么如果安装了 Firebug，任何代码仍然可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:10:46.257

我想我刚刚得到它，我删除了 console.log(href) 并且它起作用了。

# asp.net - ASP.NET MaskedEditExtender & TextBox：无法输入零，解决方法？解决方案？

> ID：735530
> 
> 赞同：2
> 
> 时间：2009-04-09T19:11:03.103
> 
> 标签：asp.net

我正在尝试在连接到 MaskedEditExtender 的文本框中输入 0。我的掩码设置为 NUMBER(13,2)，其中 9999999999999.99 作为我的十进制掩码。

问题是用户必须输入一个数字。该值可以为0。我测试了多次尝试尝试0，进入RightToLeft时不起作用。

任何解决方法？解决方案？

当值 = 我的掩码时，我尝试对 UserControl 中的文本框进行 OnBlur，但它不会将我的文本框更改为 0.00。它什么也没做。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T08:06:42.350

一般使用这个属性，如果它为 0 则用户 shud 甚至不需要输入任何东西

> AutoCompleteValue - 启用自动完成时使用的默认字符

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T23:08:15.683

听起来不支持：[http ://forums.asp.net/t/1087548.aspx](http://forums.asp.net/t/1087548.aspx)

# iphone - UITableViewCell 被选择覆盖？

> ID：735532
> 
> 赞同：2
> 
> 时间：2009-04-09T19:11:56.703
> 
> 标签：iphone, objective-c

我有一个自定义 UITableViewCell 实现（利用标签作为子视图），它可以正确呈现项目列表，但是当我向下滚动并选择一个项目（比如 100 个中的第 43 个）时，我看到了一个单元格的呈现列表（比如说，表格中第一个渲染页面上的第 3 号）出现在我选择的单元格的顶部。

这是我的方法：

```
 - (UITableViewCell *)tableView:(UITableView *)tv cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    static NSString *CellIdentifier = @"Cell";

    UITableViewCell *cell = [tv dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:CellIdentifier] autorelease];
    }
    // index of table view correlates to index of array
    Card *card = [cards objectAtIndex:indexPath.row];

    UILabel *cardNameLbl = [[[UILabel alloc] initWithFrame:CGRectMake(10.0, 3.0, 200.0, 18.0)] autorelease];
    cardNameLbl.tag = CARD_NAME_TAG;    
    cardNameLbl.text = card.name;
    cardNameLbl.font = [UIFont systemFontOfSize:12.0];
    cardNameLbl.autoresizingMask = UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleHeight;
    [cell.contentView addSubview:cardNameLbl];

    UILabel *cardNumLbl = [[[UILabel alloc] initWithFrame:CGRectMake(10.0, 21.0, 100.0, 18.0)] autorelease];    
    cardNumLbl.tag = CARD_NUM_TAG;
    cardNumLbl.text = card.number;
    cardNumLbl.font = [UIFont systemFontOfSize:12.0];
    cardNumLbl.autoresizingMask = UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleHeight; 
    [cell.contentView addSubview:cardNumLbl];

    UILabel *cardTypeLbl = [[[UILabel alloc] initWithFrame:CGRectMake(110.0, 21.0, 200.0, 18.0)] autorelease];  
    cardTypeLbl.tag = CARD_TYPE_TAG;
    cardTypeLbl.text = card.type;
    cardTypeLbl.font = [UIFont systemFontOfSize:12.0];
    cardTypeLbl.autoresizingMask = UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleHeight;    
    [cell.contentView addSubview:cardTypeLbl];

    UILabel *cardQuantityLbl = [[[UILabel alloc] initWithFrame:CGRectMake(250.0, 3.0, 50.0, 18.0)] autorelease];    
    cardQuantityLbl.tag = CARD_QUANTITY_TAG;
    cardQuantityLbl.text = [NSString stringWithFormat:@"%d", card.have];
    cardQuantityLbl.font = [UIFont systemFontOfSize:12.0];
    cardQuantityLbl.autoresizingMask = UIViewAutoresizingFlexibleRightMargin | UIViewAutoresizingFlexibleHeight;
    [cell.contentView addSubview:cardQuantityLbl];

    return cell;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T19:18:54.240

通常，这些类型的错误（查看另一行中的数据）表明您没有设置可重用单元格的部分，因此它只是使用旧数据，但我找不到任何未重置的部分.

但是，您绝对应该做的一件事，并且可能实际上解决了这个问题，就是 UITableViewCell 的子类，它将这些标签维护为 ivars。然后，您可以初始化标签并将它们添加为子视图*一次*，在 init 方法中或您选择的任何其他位置。

目前正在发生的事情是：每次你抓取一个可重用的单元格时，它可能已经有以前的那些标签，你只是在子视图之上堆积更多的子视图。（除非我弄错了，并且可重复使用的单元格在返回之前清除了它的子视图。）

# multiple-languages - 同时学习多种语言很危险？

> ID：735535
> 
> 赞同：6
> 
> 时间：2009-04-09T19:13:23.037
> 
> 标签：multiple-languages

我已经学习 PHP 几个月了，我也想学习 JavaScript，因为我认为它们会为我喜欢做的项目类型一起制作一套很好的语言。

但是同时学习两种语言是否明智？您对此有何经验，您是否将每种语言的语法相互混淆。

补充一下这个问题，你知道多少种语言？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T19:48:34.683

这不像武术，同时学习两种截然不同的风格会混淆肌肉记忆并阻碍进步。

通过分散你的注意力，你正在分割你的进步。这并不理想，但它也不是世界末日，如果你长期参与其中。

我会说 JavaScript 是一个很好的学习工具，不仅因为它具有明显的功能和普遍性，还因为它具有 C 风格的语法。事实上，如果你做了足够多的 PHP 和 Web 工作，你很快就会需要 JavaScript。

JavaScript 在过去几年中取得了巨大的发展，现在已经成为现实。此外，C 风格的“花括号”语法被广泛使用且易于理解。有了它，你就会得到一些可能挂在上面的钩子，比如 C# 或 Java。还有很多其他人。

至于我懂多少种语言...

我敢肯定，我至少知道十几种可以称为语言的东西。现在我在 C#、JavaScript、HTML、SQL/TSQL、XML、VB.NET、R 以及可能的其他一些方面感觉非常强大。其中一些几乎不是语言，但你认为那些 L 代表什么？:)

我会告诉你：尽可能多地学习语言。不一定是一次性的，也不一定是深入的，但要放纵和培养这种好奇心（这是开发人员的核心属性！），因为更多的语言 == 更多的视角。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-09T19:17:23.913

去吧。

您偶尔会混淆语法，但这没关系。

它会拓宽你的语言视野。给你更好的解决问题的方法。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-09T19:47:13.703

什么情况下可能会出现错误的情况？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T19:17:14.883

我认为我在任何给定时间都“了解” 1.5 种语言。现在是 Java 和“DHTML”（HTML/CSS/JS）。几年前是 Java 和 SQL，几年前是 C 和 SQL。二十年前是 8086 和 C.

我发现我根据需要学习语言，而我对语言的了解程度取决于我使用它的程度。读一本书不足以真正学习一门语言。

至于“危险”：除非您正在开发一个对生命至关重要的系统，否则没有真正的危险。而且，如果您作为初级程序员正在开发一个对生命至关重要的系统……好吧，那真是个坏主意。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T19:44:09.247

我和你在同一条船上。至少对我来说，只要我牢牢掌握该语言的基础知识，我就可以继续学习 sql 或 javascript 之类的其他东西。

但是，如果您仍在学习语法或基本功能等基本知识，我建议您在开始学习另一种语言之前花更多时间让自己更舒服。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T19:57:22.307

如果你的大脑可以处理它，为什么不呢。

在某些情况下（例如您的 Web 开发），您需要一起使用更多语言。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-09T21:56:55.700

我之前有一个面颊回答，但总的来说，这确实存在潜在问题。编写语法上有效的工作代码和编写也是惯用的工作代码之间有很大的区别。

如果语言习语非常相似，你不会有太多麻烦，但如果它们真的不同，你可能会发现这使得真正“得到它”需要更长的时间。

我发现在学习一门新语言时，它可以帮助我沉浸在其中一段时间​​，直到怪癖（语言和语言社区）对我有意义。不出所料，这需要多长时间会因人和语言而异。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T19:19:39.667

我以前从未见过有人在语言之间混淆语法。我不认为这会是个问题。当然，小事情有时会滑倒，但这是一件非常小的事情......

不算标记语言（XML、CSS 等），我知道并且可以用大约 9 种语言（包括方言）编程。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-09T20:20:02.377

30 年前，当 fortran 和 basic 非常相似时，同时学习两者是一个坏主意（猜猜我是怎么知道的？）

真的没有任何理由不能同时学习倍数，只要确保它们在语法上不会太相似以至于你会混淆两者（因为，相信我，当你的作业无法编译和计算机实验室将在 10 分钟后关闭，您对代码的视觉审查显示没有问题，您会希望您没有在同一学期学习 fortran 和 basic）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-09T20:32:39.757

你会更好地学习具有相似语法的语言，PHP、Javascript、C#、Java 应该没问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-09T22:07:29.700

学习两种语言并不总是坏事。**PHP 和Javascript**相得益彰。这里的大多数人说任何程序员只能同时真正“了解”两种语言是正确的，主要是因为您实际上只能同时使用两种语言（除了 HTML/CSS 之类的极端基础知识）可能已经做了这么多，而且它们相对简单，可以日常使用）。

实际上，有些语言可以很好地相互补充，例如 PHP 和 Perl，或者 C# 和 Java。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-09T22:56:04.153

我记得很多年前同时服用 FORTRAN 和 Basic。没有真正的问题，直到我写了一个（我认为）DO...NEXT 循环并且很难找出问题所在。FORTRAN，如果没记错的话，使用 DO...CONTINUE，Basic 使用 FOR...NEXT。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-09T23:06:46.437

在你的具体情况下，我没有看到任何潜在的问题。如果您正在学习两种非常相似的语言，我可以看到您有时可能会混淆语法或其他内容。

我记得在大学的一个学期，我在做 SQL、Java、C++、C 和 x86 程序集的（非常小的）子集的工作，加上在工作中使用 ASP.NET 和 C#，在大学里，我很新几乎所有的语言。有时我不得不停下来提醒自己我正在使用哪种语言，但我不认为这会减慢我使用任何一种语言的进度。

# java - 数据库中的 Java 持久性

> ID：735536
> 
> 赞同：2
> 
> 时间：2009-04-09T19:13:38.947
> 
> 标签：java, persistence

在 Java 中使用数据库持久性的最简单方法是什么？我知道，互联网上存在许多框架，但学习如何自己开发持久层及其设计模式可能会很有趣。从哪儿开始？书籍、网站、操作指南、代码示例等。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-04-15T20:21:28.417

首先查看现有功能和源代码。这是一对（仅按字母顺序列出一些）

*   [DbUtils](http://commons.apache.org/dbutils/)：一个非常简单的 JDBC 包装器。也许开始在这里寻找想法！
*   [EBean](http://www.avaje.org/) : 类似于 JPA 本身
*   [Hibernate](http://www.hibernate.org/) : 严重影响 Java 的 JPA 规范的事实上的标准
*   [iciql](http://iciql.com/) : JaQu 的友好分支
*   [JaQu](http://www.h2database.com/html/jaqu.html)：H2 自己的用于查询数据库的领域特定语言
*   [JDBI](http://jdbi.codehaus.org)：在惯用的 Java 中公开关系数据库访问
*   [JDO](http://db.apache.org/jdo/) : Apache Java 数据对象
*   [jOOQ](http://www.jooq.org "jOOQ 是用于类型安全 SQL 查询构造和执行的流畅 API")：直接在 Java 中将 SQL 建模为领域特定语言
*   [MyBatis](http://www.mybatis.org/)：“世界上最流行的 SQL 映射框架”。[原文如此]（以前的 iBatis）
*   [QueryDSL](http://www.querydsl.com/)：一种类似 SQL 的流畅 API，具有许多不同的后端（不仅仅是 SQL）
*   [Quaere](http://quaere.codehaus.org/) : 类似于 QueryDSL

很快，您就可以编辑此答案并添加您自己的框架！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T19:20:28.713

> 自己学习如何开发持久层可能会很有趣

不！别傻了。

使用[JDO](http://en.wikipedia.org/wiki/Java_Data_Objects)或[JPA](http://en.wikipedia.org/wiki/Java_Persistence_API)。第一个是通用对象持久性 API，另一个仅针对 RDBMS-es。

它们有各种实现，例如对于 JPA，有 EclipseLink（以前称为 Oracle TopLink），它也是 JPA 2 的参考实现，以及也非常流行的 Hibernate。

你真的，真的不想自己做。如果您想在该领域工作，请改为为现有项目之一做出贡献。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-14T15:19:10.670

另一个有用的库是[jDBI](http://jdbi.org/)。它利用泛型具有良好的绑定 + 映射功能，同时仍然非常接近 JDBC。[iBATIS](http://ibatis.apache.org/)应该具有类似的特性，虽然不是那么轻巧，而且它的存在时间要长得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T19:18:19.093

我将从 Sun 的 Java Persistence API (JPA) 开始。这是一篇[很好的入门文章](http://web.archive.org/web/20091028153606/http://java.sun.com/developer/technicalArticles/J2EE/jpa/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T19:19:16.110

最简单的方法就是使用[jdbc](http://java.sun.com/javase/technologies/database/)。[Java在这里](http://java.sun.com/docs/books/tutorial/jdbc/index.html)有一个很好的教程。

就抽象层而言。 [根据我的经验， Hibernate](http://www.hibernate.org/)非常标准，值得学习。自己编程可能是一项有趣的练习，但我想不出不使用休眠的充分理由。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T19:18:26.877

在最低级别，您需要与数据库通信，以便使用[JDBC](http://java.sun.com/javase/technologies/database/)。由于您设计了自己的框架，之后您就拥有了自己的框架。查看[JPA](http://java.sun.com/javaee/overview/faq/persistence.jsp)和[Hibernate](http://www.hibernate.org/)以获得一些想法，然后进行实验。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T19:54:42.560

除了之前的响应——检查 DAO（数据访问对象）模式——它反映了数据访问的代码应该如何组织。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T19:17:59.030

我发现[这本书](http://oreilly.com/catalog/9781565926165/)特别有用。[这](https://rads.stackoverflow.com/amzn/click/com/0131401572)也是一个很好的。

我自己创建了一个我同意 - 这很有趣，也有很多工作。这一切都取决于你的目标。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-11T12:38:54.993

如果您正在寻找学习实践，请尝试获取 Craig Larman 的**[Applying UML and Patterns 的副本。](https://rads.stackoverflow.com/amzn/click/com/0137488807)**

[![替代文字](https://i.stack.imgur.com/Jcwsb.jpg "应用 UML 和模式")](https://i.stack.imgur.com/Jcwsb.jpg "应用 UML 和模式")
[（来源：[codivation.com](http://graysmatter.codivation.com/content/binary/applyingumlandpatterns.jpg)）]

在那里，Larman 介绍了轻量级数据库持久性映射器设计的一章。与基于不显眼的持久性模型的 Hibernate 不同，他提出了一个显眼的框架，其中域对象必须从 PersistentObject 扩展。我们还必须为每个持久域类编写映射器类。它是某种没有任何代码生成概念的 ActiveRecord 模式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-14T15:13:30.370

这[本书](https://rads.stackoverflow.com/amzn/click/com/0321127420)（*企业应用程序架构模式*）乍一看似乎非常好。我已经研究过了，开发持久性引擎的设计模式非常全面。它说明了为什么、何时以及如何使用它们。

# cocos2d-iphone - cocos2d中如何使用alert view重启游戏场景

> ID：735537
> 
> 赞同：0
> 
> 时间：2009-04-09T19:13:45.937
> 
> 标签：cocos2d-iphone

完成后，我正在尝试重新启动相同级别的游戏。我正在使用警报视图在完成时显示。我在 AlertView 中使用了 2 个按钮（End 和 PlayAgain）。一旦触摸结束，它应该结束工作正常。问题是一旦触摸 playAgain 再次显示 AlertView 但我需要重新启动游戏。AlertView 的按钮索引代码如下所示。

```
-(void)alertView :(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
    {
    if(buttonIndex==0){
        exit(0);
        NSLog(@"exit");
    }
    else if(buttonIndex==1){

       // [self retain];
        GameScene *gameScene = [GameScene node];
        [[Director sharedDirector] replaceScene:gameScene];

        NSLog(@"Play Again");
    }
} 
```

在这里，我试图再次加载我的游戏场景。是不是正确的做法。

请帮助我。

提前致谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-09-30T20:50:21.823

完全相同的事情发生在我身上。对我来说，事实证明我有一个每帧都发生的调度程序，它会在消息实际出现之前发生两次。我只是使用：

```
[self unschedule:@selector(aFunction:)]; 
```

这取消了选择器的计划，因此它不会注册两次。我希望这可以帮助别人！如果不是这种情况，您可以尝试：

```
[[CCDirector sharedDirector] pause]; 
```

希望暂停现场以阻止它两次发出警报。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T08:25:24.283

据我所知，您的代码加载新的（相同的场景）没有任何问题。这也是我用来再次切换到同一场景的方法。

您在“else if”语句中的代码是否真的命中了？如果在 else if 块中放置断点会发生什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-10T06:32:23.407

你的代码是完全正确的但如果你使用，

```
[[Director sharedDirector] replaceScene:gameScene]; 
```

这段代码所以场景是替换你不能返回。如果您想返回，请像这样使用 push 和 pop。

```
[[Director sharedDirector] pushScene:[calssName scene]]; 
```

# c# - LinkedList 没有 ConvertAll ?

> ID：735543
> 
> 赞同：1
> 
> 时间：2009-04-09T19:15:20.207
> 
> 标签：c#, .net, vb.net, linked-list, converter

有没有人有一个扩展方法可以`LinkedList<T>`使用 a快速转换 a 中的类型`Converter<TInput, TOutput>`？

我有点惊讶，在哪里`ConvertAll<TOutput>(delegate)`？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T19:17:04.773

`ConvertAll`Linq 的扩展方法中的等价物称为`Select`!

```
var result = myLinkedList.Select(x => FancyCalculationWith(x)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:42:03.200

取决于你想从中得到什么，但你可以使用 Cast 然后枚举生成的 IEnumerable。

```
 public class Foo
  {
    ...
  }

  public class Bar : Foo
  {
    ...
  }

  var list = new LinkedList<Bar>();
  .... make list....

  foreach (var foo in list.Cast<Foo>())
  {
      ...
  } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T19:49:19.797

正如[tvanfosson 所说](https://stackoverflow.com/questions/735543/no-convertall-for-linkedlistt/735651#735651)，有可能，`Cast<T>`但如果你想避免，`InvalidCastException`你可以使用[`OfType<T>`](http://msdn.microsoft.com/en-us/library/bb360913.aspx)扩展方法，它会静默传递，列表中的项目无法转换为你提供的泛型类型参数的类型。

# python - form.is_valid() 为 false 时如何访问数据

> ID：735545
> 
> 赞同：52
> 
> 时间：2009-04-09T19:16:03.293
> 
> 标签：python, django, forms, formset, cleaned-data

当我有一个有效的 Django 表单时，我可以使用 form.cleaned_data 访问数据。但是，当表单无效时，我如何获取用户输入的数据，即 form.is_valid 为假。

我正在尝试访问表单集中的表单，所以 form.data 似乎只是让我一团糟。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-09-17T18:36:49.980

您可以使用

```
form.data['field_name'] 
```

通过这种方式，您可以获得分配给该字段的原始值。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-09T19:27:13.813

请参阅[http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation](http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation)

> 其次，一旦我们确定我们正在考虑的两个字段中的组合数据无效，我们必须记住将它们从cleaned_data 中删除。
> 
> 事实上，如果表单中有任何错误，Django 目前会彻底清除cleaned_data 字典。但是，这种行为将来可能会发生变化，因此首先自己清理并不是一个坏主意。

原始数据始终在`request.POST`.

* * *

一个评论表明，关键是做一些听起来像更复杂的字段级验证的事情。

每个字段都被赋予未经验证的数据，并且要么返回有效数据，要么引发异常。

在每个字段中，可以对原始内容进行任何类型的验证。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-06-12T22:51:06.123

我在一个类似的问题上苦苦挣扎，在这里遇到了一个很好的讨论：[https ://code.djangoproject.com/ticket/10427](https://code.djangoproject.com/ticket/10427)

它根本没有很好的文档记录，但是对于实时表单，您可以查看字段的值 - 正如小部件/用户所看到的那样 - 使用以下内容：

```
form_name['field_name'].value() 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-07-07T07:50:33.970

我有很多方法。所有你可以选择。

我想表格如下：

```
class SignupForm(forms.Form):
    email = forms.CharField(label='email')
    password = forms.CharField(label='password',
                               widget=forms.PasswordInput) 
```

1-1。从获得`request`

```
def signup(req):
    if req.method == 'POST':
        email = req.POST.get('email', '')
        password = req.POST.get('password', '') 
```

2-1。获取`raw value`分配给字段并返回`data`字段属性的值

```
def signup(req):
    if req.method == 'POST':
        ...
        sf = SignupForm(req.POST)
        email = sf["email"].data
        password = sf["password"].data
        ... 
```

2-2。获取分配给字段的原始值并返回`value`字段属性的值

```
def signup(req):
    if req.method == 'POST':
        ...
        sf = SignupForm(req.POST)
        email = sf["email"].value()
        password = sf["password"].value()
        ... 
```

2-3。获取`dictionary`分配给字段

```
def signup(req):
    if req.method == 'POST':
        ...
        sf = SignupForm(req.POST)
        # print sf.data
        # <QueryDict: {u'csrfmiddlewaretoken': [u'U0M9skekfcZiyk0DhlLVV1HssoLD6SGv'], u'password': [u''], u'email': [u'hello']}>
        email = sf.data.get("email", '')
        password = sf.data.get("password", '')
        ... 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-05-27T12:17:15.893

您可以使用此模式：

```
class MyForm(forms.Form):
    ...
    def clean(self):
        self.saved_data=self.cleaned_data
        return self.cleaned_data 
```

在您的代码中：

```
if form.is_valid():
    form.save()
    return django.http.HttpResponseRedirect(...)
if form.is_bound:
    form.saved_data['....'] # cleaned_data does not exist any more, but saved_data does. 
```

使用 form.data 不是一个好的解决方案。原因：

*   如果表单有前缀，则字典键将以该前缀作为前缀。
*   form.data 中的数据没有被清理：只有字符串值。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-03-21T14:57:22.477

我使用表单集遇到了类似的问题。在我的示例中，我希望用户在第二个选项之前选择一个第一个选项，但是如果第一个选项遇到另一个错误，也会显示“在第二个选项之前选择第一个选项”错误。

为了获取第一个字段的未清理数据，我在表单字段的 clean 方法中使用了它：

```
dirty_rc1 = self.data[self.prefix + '-reg_choice_1'] 
```

然后，我可以测试该字段中是否存在数据：

```
if not dirty_rc1:
    raise ValidationError('Make a first choice before second') 
```

希望这可以帮助！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-16T22:54:20.610

您可以从字段的 clean() 方法或表单的 clean() 方法访问数据。clean() 是确定表单是否有效的函数。它在 is_valid() 被调用时被调用。在表单的 clean()中，`cleaned_data`当您可以运行自定义代码以确保已全部签出时，您将获得列表。在小部件中，您也有一个 clean()，但它使用单个传递的变量。为了访问该字段的 clean() 方法，您必须对其进行子类化。例如：

```
class BlankIntField(forms.IntegerField):
    def clean(self, value):
        if not value:
            value = 0
        return int(value) 
```

例如，如果您想要一个不会阻塞空值的 IntField，则可以使用上述方法。

clean() 在表单上的工作方式如下：

```
def clean(self):
    if self.cleaned_data.get('total',-1) <= 0.0:
        raise forms.ValidationError("'Total must be positive")
    return self.cleaned_data 
```

您还可以为每个字段设置一个 clean_FIELD() 函数，以便您可以单独验证每个字段（在调用字段的 clean() 之后）

# c# - 将记录标记为已读并打开新页面以显示数据

> ID：735546
> 
> 赞同：0
> 
> 时间：2009-04-09T19:16:33.463
> 
> 标签：c#

我有一个 DataGrid，用于显示信息的“收件箱”。我希望该人单击一个链接，该链接会将记录标记为已读，并在新窗口中显示信息。我对 C# 比较陌生。什么是实现这一目标的好方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T19:18:54.550

在数据网格的 onclick 事件中，检索选定的行，抓取 DataBoundItem 并将其转换回您的数据类型。更新 Read 属性，然后将该实例传递给新窗体以进行显示。

# directory - 文件夹维护脚本

> ID：735547
> 
> 赞同：0
> 
> 时间：2009-04-09T19:16:43.993
> 
> 标签：directory, maintenance

我正在尝试创建一个脚本，该脚本将保留 5 个文件夹或 6 个月的文件夹，以最大者为准。因为命名约定是按版本而不是按日期，所以我将不得不为脚本的 6 个月部分使用创建日期。

有人对进行的最佳方式有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T19:28:55.807

要删除早于给定日期的文件，请查看以下相关问题：

*   [批处理文件删除超过 N 天的文件](https://stackoverflow.com/questions/51054/batch-file-to-delete-files-older-than-n-days)
*   [如何从目录中删除旧文件，同时在 Windows 上保留最新文件](https://stackoverflow.com/questions/50902/how-do-i-delete-old-files-from-a-directory-while-keeping-the-most-recent-ones-o)

# jquery - jQuery颜色变化

> ID：735549
> 
> 赞同：1
> 
> 时间：2009-04-09T19:17:09.047
> 
> 标签：jquery

我有一个可以具有任意背景颜色的元素（通过 CMS 设置）。

我想通过在鼠标悬停时使其变亮并在鼠标移出时使其变暗来突出显示它。

我尝试使用 .css('background-color') 来获取和设置值，但它似乎比我预期的要复杂得多。

这样做的非愚蠢方法是什么？

编辑：只是为了澄清 - 繁琐的部分是解析和使用颜色值进行算术 - 不应对事件。

编辑：颜色插件给了我一种读取颜色值的方法，但没有颜色算术和写作支持，我仍然不得不做一些驴工作。

最后，我使用了一个快速的“fadeTo”，但需要确认不透明动画在 IE6 中正常工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T19:23:10.267

你检查过[jQuery Color 插件](http://plugins.jquery.com/files/jquery.color.js.txt)吗？

我认为核心 jQuery 代码中不存在颜色操作，但也许最新版本的 jQuery 可能已经包含它。

你需要它来让 jQuery 正确理解颜色操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T05:38:26.137

如果你想在悬停时平滑的颜色变化，你可以试试[jquery-glow 插件](http://github.com/nakajima/jquery-glow/tree/master)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T19:21:44.077

使用 jQuery[悬停事件](http://docs.jquery.com/Events/hover#overout)。

```
var overColor  = "#ddd";
var outColor = "#ccc";

$('#target').hover(function()
{
  $(this).css("background-color", overColor);
},
function()
{
  $(this).css("background-color", outColor);
}); 
```

要处理获取现有颜色然后更改它的问题，您必须找到一个可以理解修改 HTML #XXXXXX 样式颜色的库。如果有人将背景颜色设置为“红色”之类的名称，您还必须小心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T19:41:08.867

我不知道您所说的“繁琐”是什么意思，但我刚刚对此进行了测试，它似乎适用于最新的 jQuery

```
$(document).ready(function() {
    var originalbc = $("#ThingThatChangesColors").css("background-color");
    $("#ThingThatChangesColors").mouseenter(function() {
        $(this).css("background-color", "#FFF");
    });
    $("#ThingThatChangesColors").mouseleave(function() {
        $(this).css("background-color", originalbc);
    });
}); 
```

# objective-c - Objective-C 中的弱键字典

> ID：735551
> 
> 赞同：3
> 
> 时间：2009-04-09T19:17:21.467
> 
> 标签：objective-c, dictionary, weak-references

我想知道是否有可能在 Objective-C 中拥有类似于 ActionScript 3 的`Dictionary`带有弱键的对象。我希望能够将一个类的实例“附加”到其他任意实例。

例子;

```
MetaData *meta = [MetaData metaDataForObject:someObject];
meta.whatever = foo; 
```

然后：

```
foo = [MetaData metaDataForObject:someObject].whatever;
[foo doStuff]; 
```

棘手的部分是，在被释放`someObject`引用的对象之后，我希望`meta`释放引用的对象（并且释放，假设没有客户端代码保留它）。

可能的？我看了看，`+[NSValue valueWithNonretainedObject:]`但我不确定这是否是我想要的，因为当我稍后查询时，我`-[NSValue nonretainedObjectValue]`似乎会得到一个指向垃圾的指针（当对象被释放时，NSValue 如何将指针归零？）。

谢谢，

本杰明

**2011 年 9 月 23 日更新：**我相信这样做的方法是使用`objc_setAssociatedObject`相关功能。请参阅[Objective-C 运行时参考](http://developer.apple.com/library/mac/documentation/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/c/func/objc_setAssociatedObject)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T03:08:29.210

听起来您要求的是对被释放的弱引用实例变量做出反应的能力。您当然可以使用该`__weak`属性（启用 GC）来创建弱引用，但是当此类属性在其目标被 GC 后归零时，没有内置机制可以捕获。

如果你真的想要这个，最好的办法是使用 Apple 的 Key-Value Observing 使用的相同机制：方法调配。维护一个全局表（例如 a`NSHashMap`或`NSMapTable`）将对象映射到其相应的元数据对象，然后将您附加到的对象类中的`dealloc`/`finalize`方法替换为在表中查找相应元数据对象并发送消息的版本把它拆掉。（您还需要另一个或两个将类映射到其原始`dealloc`/`finalize`方法的表。） [JRSwizzle](http://rentzsch.com/trac/wiki/JRSwizzle)提供了一个很好的 swizzling 接口。

如果您想要真正花哨，而不是覆盖目标类的所有对象的`dealloc`/ ，您可以创建一个代理类并仅为该类重新分配指针，这样就不会对您的对象的释放造成性能影响'不看。（KVO 也这样做。）`finalize``isa`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T19:54:20.410

您是否正在寻找[NSHashMap](http://chanson.livejournal.com/176390.html)？它对引用进行归零。

# c# - 引用相等性能差异？((object)obj1 == (object)obj2) 与 object.ReferenceEquals(obj1, obj2)

> ID：735554
> 
> 赞同：19
> 
> 时间：2009-04-09T19:17:32.823
> 
> 标签：c#, performance, coding-style, equality, readability

`object.ReferenceEquals`使用方法与使用相比是否有额外的开销`((object)obj1 == (object)obj2)`？

在第一种情况下，将涉及静态方法调用，并且在这两种情况下都将涉及到对象的某种形式的强制转换。

即使编译器平衡了这些方法，不等式又如何呢？

```
(object)obj != null 
```

相比于...

```
!object.ReferenceEquals(obj,null) 
```

我想在某些时候，会发生逻辑否定，或者在 != 运算符中，或者应用于 ReferenceEquals 方法的结果。你怎么看？

还有可读性问题需要考虑。ReferenceEquals 在检查相等性时似乎更清楚，但对于不等式，人们可能会错过**`!`**前面的`object.ReferenceEquals`，而**`!=`**第一个变体中的 the 很难忽视。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-09T19:21:01.037

> 使用 object.ReferenceEquals 方法是否有额外的开销

不。该方法直接包含执行引用相等检查的最小 IL 描述（记录：它等效于 VB 的`Is`运算符）并且通常由 JIT 内联（尤其是针对 x64 时），因此**没有**开销。

关于可读性：我个人认为这`object.ReferenceEquals`可能更具可读性（即使是否定形式），因为它明确地表达了它的语义。转换为`object`可能会让一些程序员感到困惑。

我刚刚找到[一篇](http://onezero.org/blog/archives/45)讨论这个的文章。它更喜欢`(object)x == y`，因为 IL 占用空间更小。它认为这可能有助于`X`使用这种比较的方法内联。但是（没有任何关于 JIT 的详细知识，但在逻辑上和直观上）我认为这是错误的：如果 JIT 的行为类似于优化 C++ 编译器，它将在内联对 的调用*后*`ReferenceEquals`考虑该方法，因此（为了内联方法`X`) 内存占用量将完全相同。

也就是说：选择一种方式而不是另一种方式对 JIT 并因此对性能没有任何影响。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-12-16T08:28:22.943

与这里的答案相反，我发现`(object) ==`比`object.ReferenceEquals`. 至于有多快，可以忽略不计！

**试验台：**

我知道您需要参考相等检查，但我也包括静态`object.Equals(,)`方法，以防它未被覆盖的类。

> 平台：x86；配置：发布版本

```
class Person {
}

public static void Benchmark(Action method, int iterations = 10000)
{
    Stopwatch sw = new Stopwatch();
    sw.Start();
    for (int i = 0; i < iterations; i++)
        method();

    sw.Stop();
    MsgBox.ShowDialog(sw.Elapsed.TotalMilliseconds.ToString());
} 
```

测试：

```
Person p1 = new Person();
Person p2 = new Person();
bool b;
Benchmark(() =>
{
    b = (object)p1 == (object)p2; //960 ~ 1000ms
    b = object.ReferenceEquals(p1, p2); //~ 1250ms
    b = object.Equals(p1, p2); //2100ms
    b = EqualityComparer<Person>.Default.Equals(p1, p2); //~4000ms

}, 100000000);

Person p1 = new Person();
Person p2 = null;
bool b;
Benchmark(() =>
{
    b = (object)p1 == (object)p2; //990 ~ 1000ms
    b = object.ReferenceEquals(p1, p2); // 1230 ~ 1260ms
    b = object.Equals(p1, p2); //1250 ~ 1300ms
    b = EqualityComparer<Person>.Default.Equals(p1, p2); //~3100ms

}, 100000000);

Person p1 = null;
Person p2 = null;
bool b;
Benchmark(() =>
{
    b = (object)p1 == (object)p2; //960 ~ 1000ms
    b = object.ReferenceEquals(p1, p2); //1260 ~ 1270ms
    b = object.Equals(p1, p2); //1180 ~ 1220ms
    b = EqualityComparer<Person>.Default.Equals(p1, p2); //~3100ms

}, 100000000);

Person p1 = new Person();
Person p2 = p1;
bool b;
Benchmark(() =>
{
    b = (object)p1 == (object)p2; //960 ~ 1000ms
    b = object.ReferenceEquals(p1, p2); //1260 ~ 1280ms
    b = object.Equals(p1, p2); //1150 ~ 1200ms
    b = EqualityComparer<Person>.Default.Equals(p1, p2); //3700 ~ 3800ms

}, 100000000); 
```

`object.Equals(,)`内部调用`ReferenceEquals`，如果它们不相等，它将调用`Equals`类的重写虚拟方法，因此您会看到速度差异的通知。

结果在`Debug`配置上也是一致的......

**正如所指出的，重点应该放在可读性/意义/揭示意图上。**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T19:23:28.563

Object.ReferenceEquals 的开销仅在于加载参数，在大多数情况下会被 JIT 删除。之后， Object.ReferenceEquals 和 operator== 都归结为一个 IL ceq 运算符。在最坏的情况下，差异将是微不足道的。

更重要的是，Object.ReferenceEquals 比 (object)o1 == (object)o2 更能揭示意图。它在代码中清楚地说明了“我正在测试引用相等/身份”，而不是将意图隐藏在一堆强制转换下。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-12-26T21:22:35.653

加上我的两分钱，在性能关键代码的许多迟到之后，在非常大的代码库上，有时疯狂的深度调用深度。

在现实世界中的“微基准测试”之外，JIT 有更多的问题和顾虑，既没有 C++ WPO 编译时的奢侈，也没有 C# 编译器更直接的翻译，但所有问题都没有在 C# 编译器完成后必须拥有所有上下文。

“迂腐”的形式：

```
if ((object)a == (object)b) { }     // ref equals

if (!((object)a == (object)b)) { }  // ref not equals 
```

如果你真的有权衡和测量诚实的性能问题，或者需要为一些非常普遍的大型课程减轻 JIT 的压力，这可以提供很多帮助。NullOrEmpty vs '(object)str == null || 也是如此 str.Length == 0' 。

没有 WPO 的奢侈，并且在许多情况下不知道哪些程序集在 JITing 受到重击后可能会被加载或卸载，奇怪的非确定性事情会发生在优化的内容和方式方面。

这是一个很大的话题，但这里有几点：

1.  **到目前为止，JIT 将追逐内联并注册优化向下调用深度**，并且完全取决于当时发生的其他事情。如果您最终由于使用而在链上编译了一次函数，而在更远的链上编译了一次不同的运行，您将获得截然不同的结果。对于许多受延迟或 UI 驱动的应用程序而言，最糟糕的事情是非确定性，而在较大的应用程序中，这可能会迅速增加。

2.  **!((object)a == (object)b) 和 (object)a != (object)b 并不总是编译成相同的代码**，对于 !(a == b) 和 a != b，即使没有任何明确的运算符或 Equals 覆盖。'(object)a != (object)b' 更有可能触发 .Net 自己更迂腐的调用进入运行时，这是非常昂贵的。

3.  **如果对 JIT 非常有帮助，请尽早并经常使用 '(object)' 或 'RefEquals' 进行保护，**即使您当前没有 operator 或 Equals 覆盖。（对象）甚至更好。如果您考虑 JIT 必须做些什么来确定一个类型是否可以覆盖，并处理 bizantine (sp) Equality 规则等等，它就像一个迷你地狱，以及任何可以稍后公开的东西，你打算参考平等，您可以避免以后突然减速或不稳定的代码。如果它已经是公开的并且没有被密封，JIT 就无法确定规则将会或有时间追捕它们。

4.  **保护通常更普遍的“空”检查可能更重要**，尽管不是 OP 问题的一部分，因为相同的规则和问题通常适用。'(object)a == null' 和 '!((object)a == null)' 是 'pedantic' 等价物。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-13T22:04:30.213

前面提到的[关于 == 运算符](http://onezero.org/blog/archives/45)更好的文章提供了不完整的信息，至少在 .NET 4.0 上是这样（好吧，它是在 2.0 时代写回的）。

它指出 ReferenceEquals 没有被优化/内联，只有当您使用“AnyCPU”配置构建项目时才会如此。设置为 'x86' 或 'x64' 使得 (object)obj == null 和 ReferenceEquals(object, null) 最终成为相同的 IL，这两种方法只是一个 'ceq' IL 指令。

所以答案是：两种方法生成的 IL 在 Release / x86 或 x64 版本上是相同的。

ReferenceEquals 绝对更具可读性，至少在我看来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-01T21:41:24.703

```
public static bool ReferenceEquals (Object objA, Object objB) {
        return objA == objB;
    } 
```

[http://referencesource.microsoft.com/#mscorlib/system/object.cs,4d607d6d56a93c7e](http://referencesource.microsoft.com/#mscorlib/system/object.cs,4d607d6d56a93c7e)

# asp.net-mvc - asp.net mvc and custom membership and role providers

> ID：735571
> 
> 赞同：7
> 
> 时间：2009-04-09T19:19:59.947
> 
> 标签：asp.net-mvc, membership-provider

My question, is it possible to build customer membership and role providers (overriding the asp.net providers) when using asp.net mvc?

I am guessing it is possible but have not seen any information about it.

Would it be done the same way as in asp.net? Just changing the web.config to point to a new provider and then providing the override methods?

I have found many articles discussing changing the data source of the membership and role providers but I don't like the tables that asp.net uses so I usually use my own table structure.

If you have any articles or links that talk about this that would be great.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T19:22:58.503

Yep, the providers are exactly the same and work just like they do in "regular" asp.net.

# sql-server - 当我们配置日志传送时，我们是否也必须打开从目标服务器到源服务器的防火墙？

> ID：735572
> 
> 赞同：3
> 
> 时间：2009-04-09T19:20:03.270
> 
> 标签：sql-server, log-shipping

当我们配置日志传送时，我们是否也必须打开从目标服务器到源服务器的防火墙？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:59:54.710

这取决于参与日志传送配置的两个 SQL Server 实例是否为：

*   在同一台服务器上（然后否）
*   在同一域/网络内的不同防火墙后面（然后是）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-23T14:01:36.490

日志传送包含 Sql server Agent 的四个独立作业。1.在主服务器中备份 2.将日志发送到辅助服务器 3.在辅助服务器中恢复日志 4.监控日志发送过程（可选）

在步骤 2 和 3 中，如果您的主服务器和辅助服务器是分开的，您需要在网络中有一个共享文件夹，为此您应该授予辅助服务器访问权限以从主服务器复制所有文件。重要的是“日志中的数据库运输配置必须使用完整恢复模式或批量日志恢复模式”。

您必须是每个服务器实例的系统管理员才能启用日志传送。日志传送配置中的备份和恢复目录必须遵循这些要求。

对于备份作业，以下内容需要对备份目录的读/写权限：

主服务器实例上的 SQL Server 服务帐户。

备份作业的代理帐户。默认情况下，这是主服务器实例上的 SQL Server 代理帐户。

对于复制作业，复制作业的代理帐户需要对备份目录的读取权限和对复制目录的写入权限。默认情况下，这是辅助服务器实例上的 SQL Server 代理帐户。

对于还原作业，复制目录的读/写权限需要以下内容：

辅助服务器实例上的 SQL Server 服务帐户。

还原作业的代理帐户。默认情况下，这是辅助服务器实例上的 SQL Server 代理帐户。

# workflow - Workflow Foundation ExternalDataExchange 消息排队和事务性？

> ID：735576
> 
> 赞同：3
> 
> 时间：2009-04-09T19:21:40.333
> 
> 标签：workflow, workflow-foundation

我最近一直在 WF 中使用一些基于 ExternalDataExchange 的通信。我的理解是，当使用长时间运行的（在本例中为状态机）工作流时，通信是排队的、持久的和事务性的。

我正在使用 SQL Persistence 和一个标记为“WaitForIdle = true”的 EventArgs。

我会假设当我做这样的事情时：

```
using(TransactionScope scope = new TransactionScope())
{
     IMyEDEService service = wfRuntime.GetService<IMyEDEService>()
     service.MyMethod(wfInstanceGuid, "Here's some data");
     DoSomeDatabaseWork();
} //Dispose causes scope to rollback 
```

我希望我的事件不会在工作流程中触发。不过，它似乎实际上已经交付，所以这让我相信这不是交易性的。您可以看到在 DoSomeDatabaseWork() 中提交到数据库的数据是如何回滚的，但是向前移动的工作流可能很糟糕。

任何人都可以确认这一点，如果是这样，您是否有解决方法*使*该消息成为事务性消息？

我真正想要的是以下两件事之一：

1.  工作流不应该对我通过外部数据交换排队的消息做出反应，直到将消息入队的事务被提交（就像服务代理在 SQL Server 中所做的那样）。

- 或者 -

2.  如果工作流确实开始对我交付的事件起作用，它也应该回滚。不过，我看不出使用默认调度程序是如何发生这种情况的。我希望工作流执行保持异步，所以如果不需要，我不想切换调度程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T13:35:31.527

这里有几个问题。首先，当您使用 SQL 持久性时，通知工作流事件并让工作流发布事件是持久的和异步的，并且工作流的底层管道是事务性的……但不是您可能想象的那样。

如果在事件序列中的某处发生了可怕的事情，最终导致您的工作流转换到新状态，那么工作流将恢复到尝试活动之前的状态 - 这使工作流保持一致状态，因为“国家之间”是一个坏主意。

如上所述使用事务范围很好，但您必须记住，事务范围实际工作的唯一时间是 using 块中的类知道事务范围。

你可以做的是让你对“MyMethod”的调用将东西包装在一个 try/catch 块中。当出现问题时，您可以投票支持回滚......但这仍然不会“取消调用”您 EDES 上的方法。

如果您可以详细说明您要在更高级别上完成的工作，那么 WF 固有的某些内容可能比尝试将事务范围塞进组合中更适合您。

## 编辑

我做了一些挖掘，发现了几个不同的地方，我们被告知*没有 API 来操作调度程序工作队列*。对我们来说不幸的是，这意味着我们想要的任何类型的回滚行为都必须自己手动实现。

If I knew more about why you were trying to rollback work queued through an EDES I might be able to suggest some potential architectures for accomplishing your task without re-inventing the wheel (transactions).

9 times out of 10 when I run into problems like this where it looks like WF just doesn't support what I'm trying to do, the problem is because I've either kept too much code *outside* the workflow or tried to put too much code *into* it and refactoring where my work is done often fixes my problem without requiring me to write new stuff.

# asp.net - LinkBut ton 命令事件处理程序参数始终为字符串

> ID：735581
> 
> 赞同：0
> 
> 时间：2009-04-09T19:22:04.857
> 
> 标签：asp.net

我在这样的用户控件中有一个 LinkBut​​ton 控件（Accordion 来自 AJAX Control Toolkit）：

```
<cc1:Accordion runat="server">
    <Panes></Panes>
    <HeaderTemplate></HeaderTemplate>
    <ContentTemplate>
        <asp:TextBox Text='<%# Bind("Title") %>' runat="server"></asp:TextBox>
        <asp:LinkButton Text="Update" CommandArgument='<%# Container.DataItem %>' CommandName="ItemUpdate" OnCommand="LinkButton_Command" runat="server"></asp:LinkButton>
    </ContentTemplate>
</cc1:Accordion> 
```

手风琴在 Page_Load 中绑定：

```
protected void Page_Load(object sender, EventArgs e)
{
    Accordion1.DataSource = GetACollection();
    Accordion1.DataBind();
} 
```

但是在命令事件处理程序中，无论我做什么，参数始终是字符串：

```
protected void LinkButton_Command(object sender, CommandEventArgs e)
{
      // sender is alway a string (the Text of the clicked button)
      // e is always a string property of the Container.DataItem object
} 
```

字符串来自正确的对象（分别是按钮和绑定的 DataItem），但我需要对象本身（特别是 DataItem）。

这是怎么回事？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T19:28:33.637

这不是预期的行为吗..

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)

> **属性值**类型：System..::.String与 关联的 CommandName 属性 一起传递给 Command 事件处理程序
> 的可选参数。 默认值为 String..::.Empty 。

# sql - 关于 SQL Server 2000 中计费查询的建议

> ID：735589
> 
> 赞同：0
> 
> 时间：2009-04-09T19:25:24.037
> 
> 标签：sql, sql-server-2000, billing

我需要一些建议来处理查询。我可以在前端应用程序中处理这个，但是，由于设计，我必须在后端实现它。我有以下

```
 CREATE TABLE [dbo].[openitems](
    [id] [varchar](8) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
    [type] [char](5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
    [date] [smalldatetime] NULL,
    [amount] [decimal](9, 2) NULL,
    [daysOpen] [smallint] NULL,
    [balance] [decimal](9, 2) NULL
) ON [PRIMARY]

insert into openitems values('A12399','INV','2008-12-05',491.96,123)

insert into openitems values('A12399','INV','2008-12-12',4911.37,116)

insert into openitems values('A12399','INV','2008-12-05',3457.69,109) 
```

 `上表包含客户的所有未结发票。我需要从最早的发票（表中的 daysOpen 列）开始对这些发票进行付款。因此，如果我有 550.00 美元的付款，我将首先将其应用于 123 天的发票，即 491.96 美元 - 500 美元（剩下 8.04 美元用于下一张发票......等等），然后更新该记录（余额表中的列）到 0.00 并移动到下一个并应用剩余的。那将是 4911.37 美元 - 8.04 美元，剩下 4903.33 美元。由于没有余额可供应用，因此循环退出。

余额栏现在应该是

```
0
4903.33
3457.69

```

注意：我需要为表中的所有客户（大约 10,000 个）执行此操作。一个客户平均有大约 20 张未结发票。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T20:39:33.327

考虑以下：

付款要么全部适用于余额，要么部分适用于余额，要么多付余额。

现在，想象一下，对于任何余额，我们都可以找到迄今为止发票的累计余额。与其想象，不如让我们这样做：

```
create view cumulative_balance as
select a.*, 
  (select sum( balance ) 
  from openitems b 
  where b.id = a.id and b.type = a.type and a.daysOpen >= a.daysOpen)
  as cumulative_balance
from openitems a; 
```

现在我们可以找到小于或等于付款的第一个累积余额，对于任何 id 和类型，并将其、daysOpen 和累积余额存储在服务器变量中。

然后我们使用该 id 和类型更新所有 openItems，其中 daysOpen <= 我们得到的值，将所有这些余额设置为零。

然后我们找到该 id 和类型的第一个非零余额，并将其余额设置为余额 - （付款 - 我们存储的累积余额）。如果多付，则此余额将正确地为负数。

使用正确的查询，您将能够在一个语句中进行查找和第一次更新。

有两个问题。一个是你无法确定，两个或多个具有相同 id 和 type 以及 daysOpen 的alances，应该先付款。为您的表添加一个*唯一的*id 将作为这些情况的决胜局。

其次是需要保存累积余额以在查询中使用它进行第二次更新。如果您正确设计了表格，其中有一个未由付款更新的 invoice_amount 列，以及一个付款列，这将解决您的问题。

更好的重构是有两张表，一张用于发票，一张用于付款：然后视图可以完成所有工作，通过比较累积余额和累积付款，生成未付余额或多付的列表。

事实上，我正是为一家首字母为 FM 的大型抵押担保公司设计了这样一个系统。它比您所拥有的要复杂一些，因为余额是根据许多金额和百分比的公式计算得出的，并且多个付款人（实际上是保险公司，这是针对已违约的抵押贷款）必须开具发票根据其他规则规定的顺序，按违约抵押。

所有这些都是在视图中完成的，一个简短的（100 行左右）存储过程基本上完成了我上面概述的操作：使用按这些规则订购发票开票的视图，应用付款（在视图中），计算在什么日期向哪个保险公司开具发票的额外付款。然后，存储过程只生成当前日期的发票（可以再次使用视图将当前日期设置为任何日期以用于测试目的）。

（具有讽刺意味的是，我接受了这份工作，并承诺我会编写 C++；我编写的唯一 C++ 使用 Oracle 和 Sybase C API 将数据从 Oracle 系统传输到 Sybase 系统。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T22:21:20.540

这应该这样做。我已经声明了一个局部变量，但您可以将它作为存储过程的参数。我还在表中添加了 invoice_id 以唯一标识发票，因为 id 和 date 似乎不是唯一的。

```
DECLARE
    @paid_amount DECIMAL(9, 2)

SET @paid_amount = 500

UPDATE
    OI
SET
    balance =
            CASE
                WHEN @paid_amount - SQ.running_total > balance THEN 0
                ELSE balance - (@paid_amount - SQ.running_total)
            END
FROM
    dbo.OpenItems OI
INNER JOIN (
    SELECT
        I1.id,
        I1.invoice_id,
        I1.date,
        ISNULL(SUM(I2.amount), 0) AS running_total
    FROM
        OpenItems I1
    LEFT OUTER JOIN OpenItems I2 ON
        I2.id = I1.id AND
        I2.type = 'INV' AND
        I2.daysopen > I1.daysopen
    GROUP BY
        I1.id,
        I1.invoice_id,
        I1.date
) AS SQ ON
    SQ.id = OI.id AND
    SQ.invoice_id = OI.invoice_id
WHERE
    @paid_amount > SQ.running_total 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:19:07.837

除非这是一次性的努力...

听起来这是业务逻辑，属于应用程序的业务层。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-09T19:31:45.893

您将不得不使用几个游标和两个嵌套循环。（这可能有点慢）

一个阅读所有付款 - 我假设客户，金额

然后为每个客户创建另一个未清项目的光标。

第一个循环将读取付款直到完成

在该循环中，为客户的未清项目打开一个新光标，按最旧的顺序排序。

遍历每个未清项目并按照您的描述应用付款

然后获得下一笔付款。

重复直到不再付款。

# sql-server - SQL Server 连接和 Vista 64 位？

> ID：735591
> 
> 赞同：0
> 
> 时间：2009-04-09T19:25:59.010
> 
> 标签：sql-server, windows-vista, timeout, 64-bit

我刚刚升级到 Vista 64 位。我运行的是 32 位版本，没有任何问题。由于某种原因，我与 SQL 服务器的连接超时。如果我去服务器，那里的一切似乎都很好。我有无限的连接，我可以通过管理控制台在本地连接。我有一个运行 .net 3.5 的网络应用程序。我是否使用它挂起的客户端 SQL 控制台，几分钟后它就像它被重置然后我可以连接。有什么想法吗？其他人有这个问题吗？

丹尼尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T20:52:43.513

出于某种原因，我的 32 位机器上没有这个问题，但是当我连接到 VPN 时，我遇到了问题。不确定我是否有不同的设置。

# internet-explorer - 在 Internet Explorer 中禁用打印

> ID：735597
> 
> 赞同：0
> 
> 时间：2009-04-09T19:28:30.690
> 
> 标签：internet-explorer, printing

有没有一种方法可以禁用 Internet Explorer 中的打印，而无需围绕浏览器 API 编写 shell？GPO 将是最好的方法，但我当然愿意接受任何事情。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T19:34:08.600

有注册表设置可以这样做。 [例如](http://www.pctools.com/guides/registry/detail/442/).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T19:31:43.083

这是一个困难的，但为了阻止打印，至少是内容而不是纸张，在我以前的一个项目中，我使用了以下内容：

```
<style type="text/css" media="print">
    body {
        display:none;
    }
</style> 
```

当他们打印页面时，它是空白的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T19:34:06.793

您想通过禁用打印来防止什么？如果您试图阻止他们打印东西并将其带回家，则有几种不同的方法可以解决此问题，而无需打印。包含

1.  复制并粘贴到 Word
2.  屏幕截图
3.  文件 -> 另存为
4.  查看缓存文件并从那里获取它。

# java - 具有多个可能端点的二维路径查找？

> ID：735599
> 
> 赞同：1
> 
> 时间：2009-04-09T19:28:46.400
> 
> 标签：java, path-finding, endpoints

我[目前有另一个](https://stackoverflow.com/questions/735523/pathfinding-2d-java-game)与 Java 中的路径查找有关的问题。但是我觉得这是一个单独的问题。

我在做游戏。寻路需要能够处理多个可能的端点。我发现的所有寻路算法和教程都只有一个终点。

这种改动会很容易调整到已经存在的代码中，还是我最好尝试从头开始编写自己的代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T19:39:12.317

如果您正在使用`A*`，但您的图中有多个可以被视为目标的顶点，您可以估计到每个目标的距离，并使用最小值。`A*`只要您不高估到目标的真实距离，它就会起作用。

但是，这种特殊行为可能会导致您编写自己的`A*`实现。代码不多；大学生IIRC可能需要一两天的家庭作业。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T19:42:28.270

我对游戏了解不多，但[Floyd-Warshall](http://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm)是一种多端点最短路径算法。

# java - 如何将 Java FloatBuffer（或任何缓冲区）保存到文件中

> ID：735600
> 
> 赞同：2
> 
> 时间：2009-04-09T19:28:49.723
> 
> 标签：java, file, buffer

我有一个已知大小的 FloatBuffer，只想将数据转储到一个文件（二进制）中，以便在我的应用程序之外进行检查。最简单的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T19:44:57.873

二进制输出的更新：

```
// There are dependencies on how you create your floatbuffer for this to work
// I suggest starting with a byte buffer and using asFloatBuffer() when
// you need it as floats.
// ByteBuffer b = ByteBuffer.allocate(somesize);
// FloatBuffer fb = b.asFloatBuffer();
// There will also be endiance issues when you write binary since
// java is big-endian. You can adjust this with Buffer.order(...)
// b.order(ByteOrder.LITTLE_ENDIAN)
// If you're using a hex-editor you'll probably want little endian output
// since most consumer machines (unless you've got a sparc / old mac) are little

FileOutputStream fos = new FileOutputStream("some_binary_output_file_name");
FileChannel channel = fos.getChannel();

channel.write(byteBufferBackingYourFloatBuffer);

fos.close(); 
```

文本输出：由于您希望这是可见的，我假设您想要一个文本文件。您将需要使用 PrintStream。

```
// Try-catch omitted for simplicity

PrintStream ps = new PrintStream("some_output_file.txt");
for(int i = 0; i < yourFloatBuffer.capacity(); i++)
{
   // put each float on one line
   // use printf to get fancy (decimal places, etc)
   ps.println(yourFloagBuffer.get(i));
}

ps.close(); 
```

没有时间发布完整的原始/二进制（非文本）版本。如果您想这样做，请使用[FileOutputStream](http://java.sun.com/javase/6/docs/api/java/io/FileOutputStream.html)，获取[FileChannel](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html)，然后直接写入[FloatBuffer](http://java.sun.com/javase/6/docs/api/java/nio/FloatBuffer.html)（因为它是[ByteBuffer](http://java.sun.com/javase/6/docs/api/java/nio/ByteBuffer.html)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T19:52:28.497

假设您希望数据为二进制：

以`ByteBuffer`. 致电`asFloatBuffer`获取您的`FloatBuffer`. 完成工作后，将`ByteBuffer`输出保存到`WritableByteChannel`.

如果您已经拥有`FloatBuffer`它，则可以使用`put`.

一种低性能但更简单的方法是使用`Float.floatToIntBit`.

（显然，注意字节顺序。）

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-09T19:51:12.617

这将遍历缓冲区支持的数组并输出每个浮点数。只需将文本文件和 floatBuffer 替换为您自己的参数即可。

```
PrintStream out = new PrintStream("target.txt");
for(float f : floatBuffer.array()){
  out.println(f);
}
out.close(); 
```

# iphone - UIView 更改期间的动画效果

> ID：735605
> 
> 赞同：1
> 
> 时间：2009-04-09T19:30:56.347
> 
> 标签：iphone, animation, effects, transition

我想在 UIView 中创建过渡动画（而不是从一个 UIView 到另一个）。

我有一个 UIView，它有两个 UITextView 字段，其中包含来自数据库记录的一些文本。屏幕上还有下一个/后退按钮。当用户按下下一个按钮时，将显示下一个记录内容。

当从一个记录到下一个记录发生这种转换时，我想显示整个视图的某种动画，例如 CurlUp、FadeIn 等。这可能吗？是这样，你能提供一些示例代码吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T19:35:39.597

您可以通过更改 UIView beginAnimations/commitAnimations 块中支持的属性来为任何视图（根视图或子视图）设置动画。

也就是说，我不知道文本是否是受支持的属性。相反，您可能不得不通过覆盖 UITextView 来“伪造”文本更改，其中一个淡出，下一个淡入。

所以是的，当你的文本发生变化时，你绝对可以做这样的动画，但你可能必须对此有创意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:36:16.007

是的，你会想要检查CoreAnimation，以及使用`animator:`方法调用。

Apple 的编程指南中有一个非常酷的示例/教程：

[核心动画编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/Headstart.html)

# web-applications - 我应该在我的软件项目中使用形式化方法吗？

> ID：735609
> 
> 赞同：5
> 
> 时间：2009-04-09T19:32:22.490
> 
> 标签：web-applications, modeling, requirements, formal-methods, formal-verification

我们的客户希望我们构建一个基于 Web 的富 Internet 应用程序来收集软件需求。基本上，它是一个基于 Web 的案例工具，遵循特定流程从利益相关者那里获取需求。我是项目经理，我们仍处于项目的早期阶段。

我一直在考虑使用形式化方法来帮助我的客户和开发人员澄清对工具的要求。我所说的形式方法是指某种形式的建模，可能是基于数学的。我已经阅读并正在考虑的一些内容包括 Z ( [http://en.wikipedia.org/wiki/Z_notation](http://en.wikipedia.org/wiki/Z_notation) )、状态机、UML 2.0（可能带有[OCL](http://www.klasse.nl/ocl/index.html)等扩展）、[Petri 网](http://en.wikipedia.org/wiki/Petri_net)和一些编码合同和前置条件和后置条件等级别的东西。还有什么我应该考虑的吗？

开发人员经验丰富，但根据所使用的形式，他们可能需要学习一些数学知识。

我正在尝试确定我是否值得在这个项目上使用形式化方法，如果是，在多大程度上。我知道“这取决于”，所以对我来说最有帮助的答案是是/否和支持论点。

如果你在这个项目中，你会使用正式的方法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T20:00:59.690

> 我一直在考虑使用形式化方法来帮助我的客户和开发人员澄清对工具的要求。

很少有开发人员有正式方法的经验。当我们将[CADiZ](http://www.cs.york.ac.uk/hise/cadiz/home.html)移植到 Windows 时，我唯一一次看到接受过正式方法培训的客户是 ZUG 的成员。

> 我所说的形式方法是指某种形式的建模，可能是基于数学的。我已经阅读并正在考虑的一些内容包括 Z ( [http://en.wikipedia.org/wiki/Z_notation](http://en.wikipedia.org/wiki/Z_notation) )、状态机、UML 2.0（可能带有 OCL 等扩展）、Petri 网和一些编码合同和前置条件和后置条件等级别的东西。还有什么我应该考虑的吗？

Z 是一种形式化方法，以集合论为基础，而 UML 是一种带有一些半形式化符号（状态机）标记的非正式符号，两者之间存在很大差距。

一些技术客户，例如您希望使用软件需求工具找到的客户，对 UML 非常满意。

创建域的 Z 模型可能有价值，并且创建客户端和服务器（或 petri-net，但我发现 pi 更简单且更强大）之间的消息传递的 pi 演算模型可能有价值。

您的领域的 Z 模型将提供一组独立于实现的类型约束，其表达方式比任何常见实现语言的类型系统都更强大。

消息传递的正式模型将为您提供运行分析的便利，以确保您不会丢失更新或发生冲突或死锁。

UML 模型为您提供了一种符号，用于将大型系统分解为功能区域（包图），显示这些区域中的类如何静态相互关联（类图），显示这些类的实例如何动态关联（顺序图、活动图和交互图），并显示包的部署方式（组件和部署图）。这些对于团队中的沟通很有用，并使想法更加充实，但没有正式定义的语义，可以进行非常复杂的分析。

在 90 年代与我共事的 Z 专家认为在 Z 中指定 CASE GUI 的想法很荒谬。为这样的 GUI 创建 UML 模型是司空见惯的。

我没有使用正式的按合同设计的前置和后置条件，尽管我有时会在评论中添加它们，并且经常在断言中添加它们，并且我对可能违反它们的条件进行单元测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T19:34:19.227

这里要问的真正问题不是是否使用它们，而是得到什么和失去什么。

生产力和结果会超过所需的复杂性和学习吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:36:24.773

一般来说，你应该使用团队认为合适的东西。对于新项目，会有一个学习曲线，这意味着会有关于过程和所犯错误的问题。您的部分开发时间表将用于纠正这些问题，如果您将来不打算在这个团队中使用它们，那么您实际上不会通过引入新事物而获得长期收益。改变过程需要很长时间和大量的工作。

如果你估计有足够的时间来处理这些问题，你可能会没事.....如果你的估计是正确的。考虑到你没有和这些人一起工作过（至少你的帖子听起来是这样的），你的时间表可能不会像它应该的那样准确，这意味着你可能没有分配足够的时间来完成项目更不用说引入新工艺了。

您必须问自己的另一个问题是“您对要实施的过程感觉如何？” 我从不尝试在项目中引入新流程，除非我知道如果必须的话我可以带领团队完成它。不时尝试新事物是好事，但你需要有一个让你感到舒服的团队，知道如何摆脱困境。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-04T22:55:44.460

我一直在研究几种“轻量级”形式方法的方法，用于可能是关键任务但不是生命/安全关键的应用程序。一些想法：

*   [合金](http://alloy.mit.edu/community/)
*   [系统机器学习](http://www.omgsysml.org/)
*   [旋转](http://spinroot.com/spin/whatispin.html)
*   [其他？？？](http://en.wikipedia.org/wiki/Formal_methods)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-06T17:51:55.300

在游戏的后期，但您可能会考虑[通过 Savara](http://www.jboss.org/savara)进行可测试架构之类的东西，我们将其用于许多以组件之间的通信或交互为主的项目中。这在任何 SOA 后端到 Web 前端中最常见。

它正式基于 pi-calculus，您无需了解 pi-calculus 即可使用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-17T07:15:11.530

有一些使用 ACSL（ANSI C 规范语言）的成功示例，这些工具具有成熟的工具集，其中大部分是开源的，例如 Why 平台、Frama-C。对于Java 类似的技术称为JML（Java 建模语言）。我认为两者都用于嵌入式应用程序的中小型项目，它们有助于在您的代码中添加一些保证，但并非旨在验证规范。Z 绝对不是用户友好的，并且缺乏足够的工具支持恕我直言。

在可用于规范阶段的商业工具中，我会研究基于 B 方法的罗丹平台。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T20:40:43.153

我完全同意汤姆并提出同样的问题，

生产力和结果会超过所需的复杂性和学习吗？

在我看来，除非系统/软件可以被识别为“安全关键”的正式方法是不必要的。

安全关键是什么意思：

当一个计算机系统的故障可能导致灾难性的后果，例如人命损失、环境破坏或系统本身损坏时，这样的系统被称为“安全关键”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-20T13:13:20.933

我同意 Tom 和 Abufardeh 的观点——生产力和成果会超过所需的复杂性和学习吗？

此外，这种方法是否更适合在开发之前获得所有需求（并确保这些需求既定义明确又可测试）？首先获取所有需求似乎是常识，但是大部分程序并行执行操作，认为稍后获取一些需求是没有问题的。需求蔓延是一场噩梦！电影“五角大楼战争”让任何不同意的人大开眼界。

# windows - 处理 Windows 命令中的扩展字符？

> ID：735617
> 
> 赞同：6
> 
> 时间：2009-04-09T19:34:22.470
> 
> 标签：windows, delphi, batch-file

我正在调试一个 Windows 批处理命令文件。在路径或文件名中使用扩展 (> 0x7f) 字符时失败。该问题似乎与将参数传递给从另一个调用的命令文件有关。

例如，此命令按预期工作：

```
xcopy "Pezuñero\1 - 001.wav" \temp 
```

这不会：

```
call another.cmd "Pezuñero" 
```

“另一个.cmd”的内容：

```
xcopy "%~1\1 - 001.wav"    \temp 
```

%~1 语法扩展参数并删除引号。这是必要的，因为在真正的命令文件中，调用或被调用的命令文件中的路径可能有空格。

第二个示例的结果（从 CMD 窗口复制）是这样的：

```
C:\>call another.cmd "Pezu±ero"    

C:\>xcopy "Pezu±ero\1 - 001.wav"    \temp
File not found - 1 - 001.wav
0 File(s) copied 
```

请注意，“ñ”（0xF1）字符已更改为“±”（0xB1）。

谁能解释发生了什么，以及如何解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T23:45:24.050

该脚本必须以*cmd.exe*使用的相同编码编写。

在提示符下输入*chcp*看看你得到了什么。然后使用支持该编码的编辑器打开文件。对我来说*chcp*输出代码页*850 ，所以我在*[JEdit](http://www.jedit.org)中编辑我的脚本，选择*IBM850*作为文件编码。[我在PSPad](http://www.pspad.com)中编辑*Format*设置为*OEM*的文件得到了相同的结果。

PS：我在我的机器上测试了你的步骤，我在*notepad.exe中写的***ñ**字符（使用默认的 ANSI 编码）在从命令提示符读取时也转换为**±**，所以看起来你的机器使用类似的 ANSI 和OEM 编码。确保尝试将**ñ**替换为**¤**（使用*notepad.exe*）。当从命令提示符运行时，这使脚本对我正常工作（因为 ANSI 的**¤**的字节值与 OEM 的**ñ**相同）。

 ********* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T16:05:17.317

感谢 McDowell 和 Romulo 为我指明了正确的方向。我意识到我需要更改生成批处理的应用程序（在 Delphi 中），以便它使用与 Windows 中的命令处理器兼容的正确 (OEM) 代码页。我没有找到任何可以转换代码页字符串的东西，但我确实发现了 Windows API 函数 SetFileApisToOEM 和 SetFileApisToANSI；

我将这些放在程序的开头和结尾，如下所示：

```
{main procedure}
begin
  SetFileApisToOEM;
  {all the rest of the program}
  SetFileApisToANSI;
end. 
```

现在批处理文件是使用 OEM 代码页生成的，并且在从 CMD 提示符运行时它们可以正常工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T00:21:44.930

我一直在[研究 cmd.exe 中的字符处理，](http://illegalargumentexception.blogspot.com/2009/04/i18n-unicode-at-windows-command-prompt.html)我认为[Romulo](https://stackoverflow.com/questions/735617/handling-extended-characters-in-windows-commands/736265#736265)已经一针见血了。默认情况下，提示使用旧的 DOS (OEM) 代码页（可能是为了与 DOS 程序兼容）。您正在使用（可能）默认的 Windows 代码页（可能是 1252）编写文件，这是不同的。使用*edit.com*编辑批处理文件。

如果我在提示符下键入*chcp*，它会报告代码页 850。

因此，例如，如果我使用*记事本*输入以下内容：

```
DIR Pezuñero 
```

...这被编码为[1252](http://en.wikipedia.org/wiki/CP_1252)与二进制值：

```
 ñ
44 49 52 20 50 65 7A 75 F1 65 72 6F 
```

如果我使用[编辑](http://en.wikipedia.org/wiki/Edit.com)来编写文件，它会被编码为[850](http://en.wikipedia.org/wiki/CP_850)并带有二进制值：

```
 ñ
44 49 52 20 50 65 7A 75 A4 65 72 6F 
```

我没有看过的一件事是使用*cmd /U*开关，但我很确定这仅适用于内置的 shell 命令，不会帮助您使用 XCOPY。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T20:42:39.280

代码页是批处理文件中的一个问题，因为它们不允许包含 Unicode。完全避免此问题的最简单方法可能是使用 WSH 或 Powershell。到目前为止，我还没有找到批处理文件的解决方法，这真的让我很困扰，因为我认为自己是 Unicode 狂热者 :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T20:08:04.947

您可能需要将代码页设置为顶部带有 ~ 的 n 的代码页。

# asp.net-mvc - ASP.NET MVC RedirectToAction 传递错误的参数值？

> ID：735618
> 
> 赞同：4
> 
> 时间：2009-04-09T19:34:29.817
> 
> 标签：asp.net-mvc

我正在使用 ASP.NET MVC 1.0。我有一个 ActionResult ，它接收一个表单帖子，其中包含下拉列表中的值。然后它重定向到一个 ActionResult，将值作为参数传递。这是我的 2 个 ActionResult 方法：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult FindPromo()
{
    var promoId = Convert.ToInt32(Request.Form["ddlPromotion"]);
    return RedirectToAction("GetPromo", new { id= promoId });
}

public ActionResult GetPromo(int id)
{

    if (promoId > 0)
    {
        var model = GetModel(id);

        if (model.Promo != null)
        {
            return View("Promo", GetModel(id));
        }
    }

    return RedirectToAction("NotFound");
} 
```

当我对此进行调试时，下拉列表中的值会从我的表单中正确提取，但在重定向时，与前一个请求不同的值作为 GetPromo 方法上的 promoId 值出现。即使 II 完全关闭页面并重新加载它，也会发生这种情况，几乎就像它缓存在某个地方一样。我知道这很简单，但我以前从未遇到过。

编辑：

我将参数名称从 promoId 更改为 id，并更新了我的路由表。我已经更新了上面的代码示例，这是我的路线：

```
 routes.MapRoute("GetPromo", "{controller}/GetPromo/{id}",
        new { controller = "Promo", action = "GetPromo" });

    routes.MapRoute("FindPromo", "{controller}/FindPromo/{id}",
        new { controller = "Promo", action = "FindPromo" }); 
```

但是，我仍然得到与参数相同的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T13:36:45.483

您是否尝试过使用默认路由设置：{controller}/{action}/{id}？另外，这些是你唯一的路线吗？路由按顺序进行评估，因此如果匹配，先前的路由可以覆盖下面的路由。Phil Haack 在[haacked.com的博客中发布了一个路由调试器](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)

您还可以使用：RouteTable.Routes.GetVirtualPath()，传递 ViewContext.RequestContext 和 RouteValueDictionary 并查看生成的 Url。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T14:04:14.403

你试过这个吗？

```
return RedirectToAction("GetPromo", new { id = promoId.ToString() }); 
```

我认为我们遇到了类似的问题，并且解决了这个问题。

如果没有，您可以这样做：

```
var dict = new RouteValueDictionary();
dict.Add("id", promoId);

return RedirectToAction("GetPromo", dict); 
```

作为建议，您不应该使用 Convert.ToInt32，而是使用 int.Parse 或 int.TryParse。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:50:55.410

我想知道这是否与您的路由设置有关。尝试重命名`promoId`并`id`更新您的路线值。如果这不起作用，您能否使用您的路线更新您的帖子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-25T23:03:45.887

检查您的 IOC 容器是否没有将您的控制器注册为单例。我正在使用 Windsor，默认生活方式类型是单例，这导致了“缓存”行为。请参阅：[ASP.NET MVC - 未从表单收集控制器参数？](https://stackoverflow.com/questions/879608/asp-net-mvc-controller-parameter-not-being-gathered-from-form)

# dll - 调用非托管 DLL 时 vshost32.exe 崩溃

> ID：735621
> 
> 赞同：4
> 
> 时间：2009-04-09T19:34:56.260
> 
> 标签：dll, visual-studio-2005, unmanaged, vshost32

我正在使用 VS 2005 应用程序与非托管 (Fortran) DLL 进行交互。当我直接从命令行运行编译后的可执行文件时，一切都很好——可以访问 DLL，并且可以使用 DLL 中的函数。

不幸的是，当我从 VS 2005 启动应用程序时，我收到一个弹出窗口，指出“vshost32.exe 已停止工作”并且没有有用的调试信息。

有没有人经历过这种行为，或者知道为什么会发生这种情况？我不明白为什么它在独立启动时运行良好，但不是通过 vshost32。

（最后一点：我正在使用 .local 文件强制从 cwd 使用已注册的 dll，但这个特定的 dll 未注册。我只是在此处注明，以防万一。）

* * *

非常感谢，

麦克风

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-07-25T21:02:36.717

我遇到了 vshost32.exe 崩溃的问题，当我选中复选框时问题消失了：

`Properties -> Debug -> Enable unmanaged code debugging`

对你起作用吗？

**编辑：**在更新的版本中，该选项被称为：（`Enable native code debugging`感谢 Qwerty01）

**编辑：**它似乎也有助于 VS2008 (@Deacon Frost)、VS2010 (@Alxandr)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:02:03.463

不确定，但您可以从“属性”->“调试”禁用 Visual Studio 托管进程

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T20:03:10.387

可能是有一个未处理的异常。您可以尝试添加以下代码来处理所有未捕获的异常：

```
static void Main()
{
  // Add a handler for the UnhandledExceptionEvent
  AppDomain.CurrentDomain.UnhandledException +=
    new UnhandledExceptionEventHandler(CurrentDomain_UnhandledException);

  Application.EnableVisualStyles();
  Application.SetCompatibleTextRenderingDefault(false);
  Application.Run(new Form1());
}

static void CurrentDomain_UnhandledException
     (object sender, UnhandledExceptionEventArgs e)
{
    try
    {
        Exception ex = (Exception)e.ExceptionObject;

        MessageBox.Show(ex.ToString(), "Error", 
              MessageBoxButtons.OK, MessageBoxIcon.Stop);
    }
    finally
    {
        Application.Exit();  
    }
} 
```

潜在问题的原因是您在调试时可能有不同的工作文件夹，因此找不到您的本机库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-15T02:06:46.400

我正在使用 Visual C# 2010 Express。我能够通过导航到 Project -> Properties 来阻止 vshost32 崩溃。我单击“调试”选项卡并取消选中“启用 Visual Studio 托管进程”复选框。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T00:22:22.447

下载dependency walker [http://www.dependencywalker.com/](http://www.dependencywalker.com/) 用它打开你的dll，看看它是否依赖于该文件夹中不存在的其他dll。

# .net - Web 应用程序访问本地文件系统

> ID：735631
> 
> 赞同：2
> 
> 时间：2009-04-09T19:36:58.080
> 
> 标签：.net, windows, web-applications, filesystems

我有一个 Web 应用程序（.NET，如果重要的话），当其中一个页面被加载时，需要将用户本地计算机上的文件复制（上传）到网络服务器。此上传需要无需用户干预。此 Web 应用程序将在一个信息亭上运行，我将在其中设置原始权限，然后锁定访问桌面/文件系统。

相反，在另一个页面上，我需要 Web 应用程序将某些内容复制到用户本地计算机（下载）。同样，此下载需要对用户不可见。

任何帮助将不胜感激。

提前谢谢了。

更新：是的，我知道这可能会被恶意使用。我希望有办法做到这一点，但实际上，它不应该被允许。呸，谢谢你证实了我的怀疑。

更新 2：见对 Guy Starbuck 的评论。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T19:39:02.117

是的，那是不可能的。这是一件非常好的事情。

如果您真的需要这种功能，您将不得不编写一个标准的可执行应用程序，而不是 Web 应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T19:40:21.893

除非 Firefox 有一些允许这种行为的配置选项，否则我认为你不走运。出于显而易见的原因，浏览器*不允许*用户未经授权的自动下载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:49:52.980

这不是一个好主意，必须有更好的设计来满足您的要求。

在任何情况下，如果您真的想这样做，并且您可以完全控制客户端信息亭，您可以在它们上安装一个 Windows 服务，该服务可以管理文件上传/下载，并通过 Web 服务器的 TCP/IP 进行控制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T19:42:26.443

如果我是你，我会澄清你在这里想要做什么，因为 1）你知道有什么网站可以做到这一点吗？和 2) 听起来你正试图制造一些恶意的东西。只是说。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T19:44:00.527

很难说这是否有用，但取决于您尝试做什么，您也许可以使用 cookie 模拟这种行为。

如果您愿意允许一些用户干预，并且您愿意将它们的使用限制在 Internet Explorer 上，您可以使用 jscript 来做您正在寻找的事情，但会提示用户允许说行动。

# c# - PropertyGrid 控件的默认内置编辑器

> ID：735634
> 
> 赞同：12
> 
> 时间：2009-04-09T19:37:27.207
> 
> 标签：c#, editor, propertygrid

我似乎无法在任何地方找到答案。哪些默认编辑器/转换器正在构建到 3.5 框架 PropertyGrid 控件中。否则我可以扔给它什么对象类型并且它能够可靠地显示和编辑？我找到了很多关于使用自定义编辑器的教程（我可能会在某个时候这样做）。但是现在在我的程序中，我允许用户创建他们自己的自定义属性，并且我想知道我应该允许哪些对象类型，假设他们将在 PropertyGrid 中编辑它们。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-02-23T12:25:06.293

请记住，有一些非公开课程。

```
System.Object
  System.Drawing.Design.UITypeEditor
    System.ComponentModel.Design.CollectionEditor
      System.ComponentModel.Design.ArrayEditor
      System.Web.UI.Design.CollectionEditorBase
      System.Web.UI.Design.WebControls.WizardStepCollectionEditor
      System.Web.UI.Design.WebControls.EmbeddedMailObjectCollectionEditor
      System.Web.UI.Design.WebControls.HotSpotCollectionEditor
      System.Web.UI.Design.WebControls.ListItemsCollectionEditor
      System.Web.UI.Design.WebControls.MenuItemStyleCollectionEditor
      System.Web.UI.Design.WebControls.RoleGroupCollectionEditor
      System.Web.UI.Design.WebControls.StyleCollectionEditor
      System.Web.UI.Design.WebControls.SubMenuStyleCollectionEditor
      System.Web.UI.Design.WebControls.TableCellsCollectionEditor
      System.Web.UI.Design.WebControls.TableRowsCollectionEditor
    System.ComponentModel.Design.BinaryEditor
    System.ComponentModel.Design.DateTimeEditor
    System.ComponentModel.Design.MultilineStringEditor
    System.ComponentModel.Design.ObjectSelectorEditor
    System.Windows.Forms.Design.AnchorEditor
    System.Windows.Forms.Design.BorderSidesEditor
    System.Windows.Forms.Design.DockEditor
    System.Windows.Forms.Design.FileNameEditor
    System.Windows.Forms.Design.FolderNameEditor
    System.Windows.Forms.Design.ShortcutKeysEditor
    System.Web.UI.Design.ConnectionStringEditor
    System.Web.UI.Design.DataBindingCollectionEditor
    System.Web.UI.Design.ExpressionsCollectionEditor
    System.Web.UI.Design.UrlEditor
    System.Web.UI.Design.XmlFileEditor
    System.Web.UI.Design.WebControls.DataGridColumnCollectionEditor
    System.Web.UI.Design.WebControls.DataControlFieldTypeEditor
    System.Web.UI.Design.WebControls.MenuBindingsEditor
    System.Web.UI.Design.WebControls.MenuItemCollectionEditor
    System.Web.UI.Design.WebControls.ParameterCollectionEditor
    System.Web.UI.Design.WebControls.RegexTypeEditor
    System.Web.UI.Design.WebControls.TreeNodeCollectionEditor
    System.Web.UI.Design.WebControls.TreeViewBindingsEditor
    System.Web.UI.Design.WebControls.DataPagerFieldTypeEditor
    System.Messaging.Design.QueuePathEditor
    System.Drawing.Design.ImageEditor
    System.Drawing.Design.ColorEditor
    System.Drawing.Design.ContentAlignmentEditor
    System.Drawing.Design.CursorEditor
    System.Drawing.Design.FontEditor
    System.Drawing.Design.FontNameEditor
    System.Drawing.Design.IconEditor
    System.Workflow.ComponentModel.Design.TypeBrowserEditor
    System.Workflow.ComponentModel.Design.BindUITypeEditor 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T19:47:23.703

您可能想查看派生自[`UITypeEditor`](http://msdn.microsoft.com/en-us/library/system.drawing.design.uitypeeditor.aspx)（在[`System.Drawing.Design`命名空间](http://msdn.microsoft.com/en-us/library/system.drawing.design.aspx)中）的类。这些类型将作为参数传递给[`EditorAttribute`](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorattribute.aspx)（在[`System.ComponentModel`命名空间](http://msdn.microsoft.com/en-us/library/z82ykwhb.aspx)中）。

您还可以查看该类型的元数据以查看`EditorAttribute`应用的位置。但是，**不要**在这里使用反射，因为这不是[`PropertyGrid`类](http://msdn.microsoft.com/en-us/library/system.windows.forms.propertygrid.aspx)使用的。

而是使用[`TypeDescriptor`类](http://msdn.microsoft.com/en-us/library/system.componentmodel.typedescriptor.aspx)来获取类型上的属性的属性描述符（调用静态[`GetProperties`方法](http://msdn.microsoft.com/en-us/library/e2k1x8zt.aspx)）。然后，使用该[`PropertyDescriptor`](http://msdn.microsoft.com/en-us/library/system.componentmodel.propertydescriptor.aspx)实例，调用该[`GetEditor`方法](http://msdn.microsoft.com/en-us/library/system.componentmodel.propertydescriptor.geteditor.aspx)以获取该属性的编辑器实例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:40:50.707

您实际上可以在 PropertyGrid 中抛出任何对象。它会自动做很多事情。如果您想拥有特殊的编辑体验，您只需要创建自定义 UI 类型编辑器，这不是本机提供的。即使在这种情况下，您也可以针对每个属性而不是针对整个对象执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T19:55:18.427

PropertyGrid 使用 TypeConverters，每个原始类型（以及原始类型的集合）都有 TypeConverters。

只要您使用原始类型之一或原始类型集合，属性网格就应该能够提供编辑 UI。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-14T15:33:38.603

除了 UITypeEditors，PropertyGrid 还能够显示任何具有 TypeConverter 的对象，该类型转换器为 CanConvertFrom(String) 返回 true。您可以为特定对象类型实现自己的 TypeConverters 以完成此操作。

# ms-access - 需要 SyBase 以访问端口

> ID：735642
> 
> 赞同：0
> 
> 时间：2009-04-09T19:39:54.110
> 
> 标签：ms-access, sybase

我有一个 SyBase 数据库，并负责将其导出到 MS Access。做这个的最好方式是什么？

（注意：这是半个“我想明白后我会自己回答”的问题和半个“如果有人知道...”的问题，所以不要去做研究，除非那是你的乐趣)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T21:49:03.847

认为它不是从 SyBase 导出，而是导入 Access (Jet)。假设您有一个 Access/Jet 可以使用的 SyBase ODBC 驱动程序，这非常简单：

1.  在控制面板 | 管理工具 | 数据源，设置一个指向 SyBase 数据库的 DSN。

2.  在 Access 中，创建一个新的空白 MDB。

3.  从文件菜单中，选择获取外部数据。

4.  选择导入。

5.  在对话框底部的 FILES OF TYPE 下拉列表中，选择 ODBC Databases。

6.  选择 DSN。

7.  应该会弹出 SyBase 数据库中的表列表。选择要导入的，然后单击确定。

如果一切按预期进行，则应导入表。它将包括表结构和所有数据。它不包括触发器（Jet 不支持）、参照完整性规则、存储过程等。我不知道您是否可以导入视图——Access/Jet 可能会将视图视为表而不是 SQL，因为这肯定是它通过 ODBC 处理它们的方式（您可以链接到视图，就像链接到一张桌子）。您可以将 SyBase 视图的 SQL 直接剪切并粘贴到 Access 保存查询中，但 Access/Jet 有自己的 SQL 方言。

如果将新数据库设置为使用 Access UI 所称的“SQL Server 兼容语法 (ANSI 92)”，则可能会更轻松一些。鉴于 SQL Server 是旧版本 SyBase 的一个分支，这可能会使 SQL 更加兼容。要设置它，在 Access 中，转到工具 | 选项 | 高级并查看右下角，其中的选择应该是不言自明的。这不会为您提供完全兼容的 SQL，但它使用 %/_ 通配符并允许 () 用于派生表（而不是可怕的 []。作为 Jet SQL 的别名语法）。它也可能对某些连接语法有影响，但我不确定。

如果您有问题，请回帖，我们会尽力提供帮助。我没有 SyBase 进行测试，只是使用我的本地 MySQL 安装通过 ODBC 导入，所以可能对你来说事情不会完全一样。

# xml - Sql Server 2005 Xml 数据类型在 INSERT 上删除了 CDATA

> ID：735646
> 
> 赞同：2
> 
> 时间：2009-04-09T19:40:41.317
> 
> 标签：xml, sql-server-2005, cdata

我的数据库中有下表：

```
CREATE TABLE [dbo].[XmlData](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [xmldata] [xml] NOT NULL,
CONSTRAINT [PK_XmlData] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF,
ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] 
```

当我运行以下 INSERT 和 SELECT 语句时，我可以看到我的 CDATA 部分正在沿线的某处被剥离。

```
INSERT 
    INTO 
        [XmlCdataTest].[dbo].[XmlData] ([xmldata])
    VALUES
        ('<doc><control><value><![CDATA[10 < 11]]></value></control></doc>')
GO

SELECT [xmldata] FROM XmlData
GO 
```

这是 SQL 2005 中的某种错误，还是有一些选项我可以用来告诉 SQL Server 不要从我的 xml 数据中删除这些 cdata 部分？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T20:02:01.560

似乎[没有办法解决这个问题](http://social.technet.microsoft.com/Forums/en-US/sqlxml/thread/c216ec4a-c0b5-4b38-aea8-5e27833da75e/)。

# c++ - #ifdef 用于 32 位平台

> ID：735647
> 
> 赞同：23
> 
> 时间：2009-04-09T19:40:45.747
> 
> 标签：c++, c, gcc, 64-bit, 32-bit

在我维护的一个应用程序中，我们遇到了影响标准库的文件描述符限制的问题。此问题仅影响 32 位版本的标准库。

我已经为我的代码设计了一个修复程序并希望实现它，但仅限于编译 32 位可执行文件时。#ifdef 可以使用什么预处理器符号来确定代码是针对 32 位还是 64 位目标编译的？

**编辑**

不好意思，没提，代码是跨平台的，linux，windows，solaris等几个unix风格，主要是用GCC编译。我可以跨平台使用任何事实上的标准吗？

**编辑 2**

我发现了一些定义“__ILP23”和“__LP64”，它们似乎可以工作......[这里](http://www.unix.org/version2/whatsnew/lp64_wp.html)的讨论解释了unix平台的背景。有人有使用这些定义的经验吗？这能用吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-09T19:43:02.573

我不确定是否有一个合适的通用#if def。C++ 标准几乎肯定没有定义一个。当然有平台特定的。

例如，Windows

```
#if _WIN64 
// 64 bit build
#else
// 32 bit build
#endif 
```

**编辑**OP 提到这是使用 GCC 和其他编译器在 Windows 和非 Windows 之间进行的交叉编译

没有可用于所有平台和编译器的通用宏。一点预处理器的魔法虽然可以做到这一点。假设您只在 x86 和 amd64 芯片上工作，以下应该可以解决问题。虽然它可以很容易地扩展到其他平台

```
#if _WIN64 || __amd64__
#define PORTABLE_64_BIT
#else
#define PORTABLE_32_BIT
#endif 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-09T19:45:02.460

我建议为[predef SourceForge 添加](http://predef.sourceforge.net/)书签。没有一个答案，但它肯定可以帮助您入门。

编辑：对于仅限 GCC 的代码，您可以使用它`__i386__`来检查 32 位 x86 芯片，我建议尝试`__X86_64__`或类似的东西来检查 64 位 x86 芯片。（注意：我注意到之前的答案涉及`__ia86__`的实际上是不同的芯片，而不是 64 位 x86 芯片。这只是表明我缺乏硬件经验。对于那些比我更了解硬件的人，请咨询 SourceForge 页面在我链接到上面的预定义宏上。它比我更准确。）还有一些其他的可以工作，但是这两个在 GCC 版本中应该是相当普遍的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T19:53:51.050

看看那个：

[i386 宏](http://predef.sourceforge.net/prearch.html#sec6)
[AMD64 宏](http://predef.sourceforge.net/prearch.html#sec3)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2019-01-16T17:13:25.887

我会通过最大指针值常量间接测试它：

```
#include <stdint.h>

#if UINTPTR_MAX == 0xffFFffFF
// 32-bit platform
#elif UINTPTR_MAX == 0xffFFffFFffFFffFF
// 64-bit platform
#else
#error Unknown platform - does not look either like 32-bit or 64-bit
#endif 
```

这样，您不依赖于任何特定于平台的架构定义，而是依赖于具有特定架构的直接后果 - 指针大小。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-09T19:43:02.840

您可以检查一个众所周知的类型的大小，例如 sizeof(int*) == 4 用于 32 位平台。

由于 sizeof 在编译时已知，我相信

```
if(sizeof(int*) == 4)
{
  ...
} 
```

应该做的伎俩

编辑：评论是正确的，你需要使用常规的 if，#if 不起作用。

如果您使用 C++，您可以创建模板代码并让编译器根据 sizeof() 调用为您选择专业化。如果您为 32 位平台构建，编译器只会实例化 32 位平台的代码。如果您为 654 位平台构建，编译器只会实例化 64 位平台的代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-07-23T13:33:32.597

我在 Windows 上使用这样的结构：

```
#如果定义（_WIN64）
   //64位代码
#elif 定义（_M_IX86）
   //32位代码
＃别的
#error "未知平台"
＃万一

```

相对：

```
#如果定义（_WIN64）
  // 64位代码
＃别的
  // 32 位代码
＃万一

```

在前一个解决方案中，由于#error，编译器将能够告诉您需要在哪里为新平台添加代码。如果您遇到既不是 64 位也不是 32 位的平台，这有助于可维护性。是的，_M_IX86 并不完全是 32 位的同义词，但我认为我们大多数人支持的唯一 32 位平台实际上是 x86。所以作为一个实际的措施就足够了。

在后面的解决方案中，您必须使用 grep 或类似的东西手动找出新平台需要代码的位置。这是乏味且容易出错的。

我突然想到下面的结构也是可以接受的，虽然我没有在生产中测试过，也没有真正考虑过。

```
#如果定义（_WIN64）
   //64位代码
#elif 定义（_WIN32）
   //32位代码
＃别的
#error "未知平台"
＃万一

```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-09T19:51:58.760

我最终可能会做的是在 Makefile 中，使用 uname 确定您是在 32 位平台上还是 64 位平台上。然后，添加到您的 CFLAGS、-DX32 或 -DX64。你可以只用#ifdef X64。

但这只是一个统一的解决方案。我不确定我会在 Windows 上做什么。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-09T20:11:49.727

至少 32 位 Solaris 有 256 个文件指针的限制，因为该结构将文件描述符存储在无符号字符字段中。保留这一点是为了向后兼容一些几乎不可能的旧版本 SunOS。其他平台——我想说大多数其他平台——没有这个限制。另一方面，一个普通的用户程序需要同时打开这么多文件是比较少见的。它通常表示一个错误（完成后不关闭文件）而不是。尽管如此，对于需要同时打开大量数据文件的数据库服务器来说，这可能是个问题。

* * *

一条评论说：

> 差不多就是这样。我们没有打开大量文件，但服务器处理了大量来自客户端的连接。套接字句柄和文件描述符似乎来自同一个地方。当我们有很多连接时，'fopen' 会失败，因为系统级调用返回并且 fd > 255。

“套接字句柄”是系统调用级别的文件描述符，因此它们与文件的常规文件描述符来自同一位置。

如果你必须解决这个问题，那么你需要包装你当前的套接字打开代码，这样如果它得到一个 0..255 范围内的文件描述符，那么它会调用 ' `dup2()`' 在 stdio 赢得的范围内创建一个文件描述符'不使用 - 然后关闭原始文件描述符。唯一的障碍是您必须跟踪哪些文件描述符可用，因为`dup2`如果目标文件描述符当前打开，它将愉快地关闭它。

当然，我假设您的套接字代码读取文件描述符而不是文件指针。如果是这样的话，你就会遇到更大的问题——太多的东西想要使用相同的资源，而它们不能同时使用它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-09T19:45:09.417

取决于您的操作系统和编译器，这些是实施决策。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T19:43:24.727

我相信定义是_WIN64

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T19:45:29.010

C++ 标准没有定义这样的符号 - 您的特定平台（您没有在问题中指定）可能会提供一个。

# ant - 如何使用 Ant 'input' 任务读取多行值？

> ID：735655
> 
> 赞同：3
> 
> 时间：2009-04-09T19:42:44.307
> 
> 标签：ant

任何人都知道如何在 Ant 脚本中输入多行值？我正在使用[输入任务](http://ant.apache.org/manual/Tasks/input.html)提示用户输入 Subversion 提交评论，并且我希望能够支持多行文本。

我在 Windows 命令提示符下运行独立版本的 Ant。

我以为我可以搜索和替换 \n，但是我看不到任何简单的方法可以在 Ant 中将属性值替换为属性值。看起来我必须编写一个文件，[在文件中替换](http://ant.apache.org/manual/Tasks/replace.html)，然后将文件加载到另一个属性中。我不想那么糟糕。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T20:39:39.053

我对此不是 100% 肯定，但我查看了 Ant 源代码，它只是执行了一个 readLine()：

从 /org/apache/tools/ant/input/DefaultInputHandler.java：

```
/**
 * Prompts and requests input.  May loop until a valid input has
 * been entered.
 * @param request the request to handle
 * @throws BuildException if not possible to read from console
 */
public void handleInput(InputRequest request) throws BuildException {
    String prompt = getPrompt(request);
    BufferedReader r = null;
    try {
        r = new BufferedReader(new InputStreamReader(getInputStream()));
        do {
            System.err.println(prompt);
            System.err.flush();
            try {
                String input = r.readLine();
                request.setInput(input);
            } catch (IOException e) {
                throw new BuildException("Failed to read input from"
                                         + " Console.", e);
            }
        } while (!request.isInputValid());
    } finally {
        if (r != null) {
            try {
                r.close();
            } catch (IOException e) {
                throw new BuildException("Failed to close input.", e);
            }
        }
    }
} 
```

如果我是你，我会这样做：

*   如果您使用的是 Ant 1.7，请尝试实现您自己的 InputHandler，如[文档](http://ant.apache.org/manual/Tasks/input.html)中所述。Apache 许可证允许您基本上复制并粘贴上述代码作为起点。
*   如果您使用的是 Ant 1.6 或更早版本，则只需创建您自己的 MultiLineInput 任务。您可以扩展现有的 Input 类并只读取多行。

无论哪种情况，您都需要决定用户如何表示“我完成了”。您可以使用空行或句点或其他内容。

祝你好运！

PS当我在谷歌搜索“蚂蚁多行输入”时，这个页面是第一个命中:-)。对于不到一个小时前提出的问题，这令人印象深刻。

# php - PHP：如何仅获取括号（）之间的单词并清除其他所有内容

> ID：735668
> 
> 赞同：6
> 
> 时间：2009-04-09T19:46:44.327
> 
> 标签：php

我有一个包含一些信息的数组。例如：

> (作家) &

或者

> 与（附加对话）

我想清理它，所以我只得到括号 () 之间的文本并清除其他所有内容

结果：

> 作家

或者

> 附加对话

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T19:49:21.123

最简单的方法是使用正则表达式：

```
preg_match_all('/\((.*?)\)/', $input, $matches); 
```

`$matches[1]`, `$matches[2]`, etc 将包含 $input 中括号之间的所有内容。也就是说，`$matches[1]`将包含第一组括号之间的任何内容，依此类推（以处理具有多组的情况）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-10T04:26:44.343

```
$string = "this (is (a) test) with (two parenthesis) duh"; 
```

对于这样的字符串，您可以使用 preg_match_all 并使用 implode。

```
$string = "this (is (a) test) with (two parenthesis) duh";
$regex = '#\((([^()]+|(?R))*)\)#';
if (preg_match_all($regex, $string ,$matches)) {
    echo implode(' ', $matches[1]);
} else {
    //no parenthesis
    echo $string;
} 
```

或者您可以使用 preg_replace，但如果使用多个括号，您将丢失它们之间的空格。

```
$regex = '#[^()]*\((([^()]+|(?R))*)\)[^()]*#';
$replacement = '\1';
echo preg_replace($regex, $replacement, $string); 
```

我从这个页面得到了很多帮助，[PHP 正则表达式的细化点](http://www.skdevelopment.com/php-regular-expressions.php)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:51:41.163

```
$matches = array();
$num_matched = preg_match_all('/\((.*)\)/U', $input, $matches); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-02-26T15:55:28.487

```
function getInbetweenStrings($start, $end, $str){
    $matches = array();
    $regex = "/$start([a-zA-Z0-9_]*)$end/";
    preg_match_all($regex, $str, $matches);
    return $matches[1];
} 
```

> 例如，在以下示例中，您希望 {} 之间的字符串（键）数组，其中 '/' 不介于两者之间

```
$str = "C://{ad_custom_attr1}/{upn}/{samaccountname}";
$str_arr = getInbetweenStrings('{', '}', $str);

print_r($str_arr); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-15T11:19:14.203

在替换中使用上面

```
echo preg_replace('/\(([\w]{1,2})\)/',"(s\\1)",'(Gs) Main Hall'); 
```

结果是

```
(sGs) Main Hall 
```

# .net - 如何在 WPF 中获取 ContextMenu 发起的事件的来源？

> ID：735676
> 
> 赞同：2
> 
> 时间：2009-04-09T19:49:02.137
> 
> 标签：.net, wpf, treeview, contextmenu

我有一个带有 Click 事件的 ContextMenu 的 TreeView。当上下文菜单中的单击事件触发时，显然我将 MenuItem 作为事件源。如何获取 TreeView 中的哪个节点是触发 ContextMenu 的节点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T11:17:27.977

或者，如果您正在使用，`RoutedUICommands`您可以使用该`OriginalSource`属性`ExecuteRoutedEventArgs`并`CanExecuteRoutedEventArgs`找到它的气泡开始的`FrameworkElement`位置。`Command`

然而`OriginalSource`，可能是内部 TextBlock，或节点的 DataTemplate 中的其他元素，因此您需要使用 VisualTreeHelper 来查找所需的父级。我已经围绕这个功能实现了一个类似于： [http](http://www.hardcodet.net/2008/02/find-wpf-parent) ://www.hardcodet.net/2008/02/find-wpf-parent /

如果您想在大型应用程序中分离/集中您的命令逻辑，这种方法很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-27T02:42:27.697

//必须有比这更好的方法... TreeViewItem tvi = (((sender as MenuItem).Parent as ContextMenu).Parent as Popup).PlacementTarget as TreeViewItem;

这行得通，但为什么我不应该这样做呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:53:57.337

通常，您将 TreeView 节点（例如弹出事件的源，可能是所选节点 - 在某种程度上取决于您的界面）存储在 ContextMenu 的“弹出”事件中的私有类级变量中，然后参考菜单的点击事件中的那个变量。

# database - 在 MVC 模型中什么是有效的数据访问的良好平衡？

> ID：735681
> 
> 赞同：2
> 
> 时间：2009-04-09T19:49:50.747
> 
> 标签：database, model-view-controller, architecture, orm, query-optimization

我正在处理一些使用 MVC 框架的 PHP 项目，虽然它们都有不同的方式从数据库中检索对象，但就速度和减少数量而言，似乎没有什么比手动编写 SQL 查询更好的了。查询。

例如，我的一个 Web 项目（由初级开发人员编写）执行 100 多个查询只是为了加载主页。原因是在一个地方，一个方法会加载一个对象，但稍后在代码的更深处，它会加载与第一个对象相关的一些其他对象。

这导致了问题的另一部分，即人们在您有一个表的情况下在做什么，该表在代码的一部分中只需要几列的值，而另一部分需要其他东西？现在（在同一个项目中），每个对象都有一个 get() 方法，它执行“SELECT *”（或显式列出表中的所有列），因此无论何时您出于任何原因需要该对象，你得到了整个事情。

所以，换句话说，你听到了所有关于 SELECT * 不好的讨论，但是如果你尝试使用框架附带的 ORM 类，它通常会这样做。您是否坚持选择使用 SELECT * 的 ORM 与手动编写特定的 SQL 查询？在我看来，我们陷入了便利和效率之间，如果我手写查询，如果我添加一列，我很可能不得不将它添加到代码中的几个位置。

很抱歉这个问题很长，但我正在解释背景以从其他开发人员那里获得一些心态，而不是具体的解决方案。我知道我们总是可以使用像 Memcached 这样的东西，但我宁愿在开始之前优化我们可以做的事情。

感谢您的任何想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T20:01:51.513

首先，假设您精通 SQL 和模式设计，很少有任何将您从 SQL 语句中移除的抽象层会超过手工编写 SQL 的效率的情况。通常情况下，您最终会得到次优的数据访问。

100 个查询没有任何借口只是为了生成一个网页。

其次，如果您使用 PHP 的面向对象特性，您将对对象集合以及映射到 SQL 连接的各种扩展属性有很好的抽象。但要记住的重要一点是尽可能编写最好的抽象对象，而不考虑 SQL 策略。

当我以这种方式编写 PHP 代码时，我总是发现如果我的模式和类都正确，我能够将每个网页的数据需求映射到非常少的非常高效的 SQL 查询。不仅如此，我的经验是，这是最简单、最快的实现方式。将框架的东西放在 PHP 类和一个好的实体瘦 DAL 之间（注意：不是嵌入式 SQL 或 dbms 调用）是我能想到的最好的例子来说明“泄漏抽象”的概念。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:03:15.507

我对你的问题有点迷茫，但如果你正在寻找一种方法来进行数据库访问，你可以用几种方法来做。您的 MVC 可以使用带有数据库访问抽象的 Zend 框架，您可以使用它。

还要记住，您应该很好地设计您的系统，以确保数据库中没有争用，因为您的查询都分散在 php 页面中，并且可能会锁定表，从而导致整个 Web 应用程序的性能下降并随着时间的推移变得更慢。

这就是为什么有时最好使用存储过程，因为它在一个地方，并且可以在需要时进行调整，尽管其他人可能会争辩说，如果查询语句在前端，则更容易调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:22:52.680

**没有 ORM 框架在速度方面甚至可以接近手写 SQL**，尽管 100 个查询看起来不切实际（也许你有点夸大其词），即使你让 ORM 框架的创建者编写代码，它也永远不会良好的旧 SQL 的速度。

我的建议是，不仅要看速度，还要看全貌：

*   该框架是否提高了代码的可读性？

*   您的团队是否愿意编写 SQL 并将其与代码混合？

*   你真的了解如何优化框架查询吗？（我认为每个对象的 get() 不是检索它们的最佳方式）

*   框架的查询（优化后）是否存在瓶颈？

我从来没有用 PHP 开发过任何东西，但我认为你可以混合使用这两种方法（ORM 和普通 SQL），也许在对应用程序进行**彻底分析**之后，你可以确定真正的瓶颈，**然后才能**将 ORM 代码替换为手写 SQL （通常在 ruby​​ 中你使用 ActiveRecord，然后你用新的 relic 来分析应用程序，最后如果你有一个复杂的 AR 查询，你用一些 SQL 替换它）

Regads

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T20:44:09.713

相信你的经验。

为了不在代码中重复太多，您可以使用自己的 SQL 编写一些简单的模型函数。这就是我一直在做的事情，我对此很满意。

许多“方便”的东西是为需要魔法的人写的，因为他们不能用手或者只是没有经验。

毕竟这是一个风格问题。

不要犹豫，添加您自己的层或用您自己的东西交换或扩展给定的层。保持干净，做好设计和一些文档，这样你以后回来时就有宾至如归的感觉。

# javascript - ASP.NET - 用于引用 .CSS 和 .JS 的路径

> ID：735684
> 
> 赞同：15
> 
> 时间：2009-04-09T19:49:59.157
> 
> 标签：javascript, c#, jquery, asp.net

我的项目根目录中有一个母版页。我在整个项目和引用此母版页的子文件夹中都有内容页面。如果我总是希望它们与根目录相关，那么引用我的 .CSS 和 .JS 文件的正确方法是什么？

这是我现在的做法：

```
链接 href="/common/css/global.css"
脚本 src="/common/javascript/global.js"

```

但这打破了链接。我尝试不使用前导“/”，但这在子文件夹中的页面上不起作用。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-09T19:52:05.487

我会使用类似的东西

```
Server.ResolveClientUrl("~/common/css/global.css") 
```

这将始终为您提供正确的网址。

例子：

根据评论，这将是完整的用法。

```
<link type="text/css" rel="stylesheet" 
    href='<%= Server.ResolveClientUrl("~/common/css/global.css") %>' /> 
```

根据评论，其他经过验证的用法，没有“错误 CS1061：'System.Web.HttpServerUtility' 不包含定义”错误：

```
 <script type="text/javascript" 
src="<%= Page.ResolveUrl("~/Scripts/YourScript.js") %>" ></script> 
```

始终放置结束标记也很重要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T20:05:19.947

您可以使`<link>`标签在服务器上运行，这样 Asp.Net 将为您解析 URL，如下所示：

```
<link href="~/common/css/global.css" runat="server" /> 
```

（注意'~'）
我不知道它是否可以应用于`<script>`标签，你应该尝试......

编辑：我最近在一个项目中发现，您可以（并且应该）使用 a`ScriptManager`来保存您的脚本（每页只能有 1 个）。您可以在 MasterPage 中放置一个并引用您的所有脚本。在您的内容页面中，您可以添加一个`ScriptManagerProxy`“引用”母版页上的脚本，您甚至可以仅为该内容页面添加其他脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-18T08:42:01.717

我这样做很简单：`link href="<%=ResolveUrl("~/common/css/global.css")%>"`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-18T12:56:57.813

到目前为止我看到的解决方案在我的项目中不起作用（尤其是不适用于 .css 链接）。问题如下：

*   里面`<link>`没有解决`<%=...%>`表达式
*   它在所有情况下都没有找到 Page.ResolveURL
*   如果您嵌入了 ' 和 " 引号，则存在一些问题`<%=...%>`

所以我想提供这个解决方案：在后面的代码（您的母版页的 C# 类）中，添加以下 3 个方法：

```
public partial class SiteBasic : System.Web.UI.MasterPage
{
    public string ResolveURL(string url)
    { 
        var resolvedURL=this.Page.ResolveClientUrl(url);
        return resolvedURL;
    }

    public string cssLink(string cssURL)
    {
        return string.Format("<link href='{0}' rel='stylesheet' type='text/css'/>", 
                    ResolveURL(cssURL));
    }

    public string jsLink(string jsURL)
    {
        return string.Format("<script src='{0}' type='text/javascript'></script>", 
                    ResolveURL(jsURL));
    }
} 
```

对于**样式表**参考，您可以说：

```
<%=cssLink("~/css/custom-theme/jquery-ui-1.8.20.custom.css")%> 
```

对于**JavaScript**引用，它看起来像这样：

```
<%=jsLink("~/Scripts/jquery-1.7.2.js")%> 
```

对于**其他**参考，您可以使用：

```
<a href='<%=ResolveURL("~/Default.htm")%>'>link</a>
<img title='image' src='<%=ResolveURL("~/Images/logo.png")%>'/> 
```

**注意：**我发现最好在外部使用单引号，在 href 或 src 属性内部使用双引号，如上例所示。正如我发现的那样，在某些情况下，反之亦然会造成麻烦。

这个解决方案很简单，在我的情况下效果很好，即使引用母版页的页面位于不同的子目录中。它的基本作用是根据您当前显示的页面将`~`路径（需要从您的网站的根目录开始的绝对路径）转换为相对路径（根据需要在路径中使用尽可能多的路径）。`../`

* * *

**进阶提示：**

如果您使用**AJAX 调用来调用 Web 服务方法**，那么如果您在不同的目录级别上有 ASPX 页面，那么在引用它们时也会遇到同样的问题。我建议您定义类似的内容（假设您的 Web 服务驻留在目录中`~/AJAX`）：

```
<script type="text/javascript">
    function getWebServicePath() { return '<%=ResolveURL("~/AJAX/")%>'; } 
</script> 
```

在`<head> ... </head>`您的**母版页**部分内。这将使 Web 服务的入口路径在您的 JavaScript 中可用。你可以像这样使用它

```
$.ajax({
    type: "POST",
    url: getWebServicePath()+"myWebService.asmx/myMethod",
    data: $.toJSON({ param: "" }),
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    success: function (msg) {
            // ... code on success ...
    },
    error: function (ex) {
            // ... code on error ...
    }
}); 
```

# actionscript-3 - 如何防止 ActionScript 代码反编译

> ID：735687
> 
> 赞同：1
> 
> 时间：2009-04-09T19:51:06.063
> 
> 标签：actionscript-3, actionscript-2, obfuscation, reverse-engineering

是否有可靠的方法来防止我的动作脚本代码（as2 或 as3）被复制（例如，如果其中有一些 IP）？我知道有些工具可以反编译 flash 代码，因此很容易对其进行逆向工程，而且我还看到一些工具声称能够以不可窃取的方式混淆 actionscript 代码，但我想知道它的可靠性如何他们是……你知道吗？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T23:32:56.857

我发现没有可靠且可持续的方法来混淆代码。如果有办法混淆代码，我敢打赌：

*   它会影响代码的性能
*   有人为该混淆方法制作/找到反编译器只是时间问题

我不认为依赖客户端代码的安全性是一种好的做法。即使无法反编译代码，swf 也会在客户端上运行，并通过用户可以访问的网络连接与 Internet 进行通信。可以嗅探数据包，并且可以轻松分析所有正在传输的数据。

我认为你应该找到一种方法来开发一个安全的应用程序，即使考虑到客户知道你所做的一切。您应该尝试使用服务器端约束并在使用它们之前过滤所有输入。此外，从服务器端脚本请求所有敏感数据，而不是将其嵌入到您的 AS 代码中可能是一个好的开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T12:20:44.033

根据定义，不可能阻止它。

原因很简单，代码需要在客户端运行，所以客户端需要能够读取。

你能做的最好的事情就是努力（需要时间）去做这件事没有利润。Flash 有一个内置功能可以防止使用密码进行反编译。我不确定它是如何工作的，我猜是某种形式的加密。

您可以尝试在运行时将有意义的数据溢出并加入它，然后对其进行加密并从服务器获取解密密钥。

但到头来，你真的无能为力。除非您不希望用户输入加密密钥（密码或文件）。Flash 中没有内置加密，但有几个免费库，例如 crypto lib [http://code.google.com/p/as3crypto/](http://code.google.com/p/as3crypto/)。

# version-control - How do you store third party libraries in your source control?

> ID：735699
> 
> 赞同：26
> 
> 时间：2009-04-09T19:53:09.383
> 
> 标签：version-control

How do you store third party libraries that you use in your project in your source control?

When would you store binaries in your source control?

When would you store the code in your source control?

Would you ever store both? In what situations would you do this?

(Btw, I'm using .NET but it doesn't really matter for this question)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T20:01:56.117

*   **How:** a **[vendor branch](http://svnbook.red-bean.com/en/1.5/svn.advanced.vendorbr.html)** is generally a good approach

*   **When (thirdparties)**: for minimizing the number of referential involved: you could add those libraries into a separate external referential (like Maven), but that mean you need to access that extra referential for each of your environment (development - integration - homologation - preproduction - production)

*   **When (code)**: for managing the complexity of the changes, when you know updates and fixes for current versions running into production will be needed *while* new development are in progress.

*   **Why (store both)**: for **[deployment](https://stackoverflow.com/questions/531442/is-it-acceptable-good-to-store-binaries-in-svn/531464#531464)** reason: you can manage a complete *configuration* (list of elements you need) in one referential and query it wherever and whenever you need for:

    *   development (you query what you need to develop and execute your code, including thirdparties needed for compilation/execution)
    *   tests (integration, homologation): you query the exacts tags you want to update your testing workspace with
    *   production: you identify exactly what goes into production from one source: your SCM.

For test and production environments, that also mean your own product (the *packaged* result of what you are building) should also go into your SCM (only the official releases, not the intermediate ones used internally).
If other projects depend on your product, they will build their own project against your packaged version stored in the SCM, not against your source code they somehow recompiled.

Why this is important ?
Because in the end, what will run in production is that *packaged* version of your product, not your "source code re-compiled". Hence the importance to make all your test with the target final form of your product, clearly stored and tagged in your SCM.

* * *

[Martin Lazar](https://stackoverflow.com/users/82569/martin-lazar) raises a legitimate point in [his answer](https://stackoverflow.com/questions/735699/how-do-you-store-third-party-libraries-in-your-source-control/735772#735772)

> Source control is called "source" control, because it is supposed to control sources.

While that may have been historically true, every current RCS have evolved toward SCM ([Source Code Management](http://en.wikipedia.org/wiki/Revision_control)), which does not just control sources, but also manages changes to documents, programs, and other information stored as computer files.
Binaries can then been stored (even stored with binary-delta)

Plus that allows some of those SCM to propose S"C"M feature (as in [Source *Configuration* Management](http://en.wikipedia.org/wiki/Configuration_management)).
That SCM (Configuration) not only stores any kind of "set of files", but also their *relationships* (aka *dependencies*) between those sets, in order for you to query one set of file, and to "pull" every other deliveries on which that set depends on (to build or to deploy or to run)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T20:05:33.813

> How do you store third party libraries that you use in your project in your source control?

As binary or source or both. Depends on the library.

> When would you store binaries in your source control?

A third party library for which we don't have the source or an internal library which we haven't made any changes to or the library is too huge to be built around.

> When would you store the code in your source control?

Say, we use an internal library A but have made some bug fixed specific to product X. Then product X's depot will keep the source and build it.

> Would you ever store both? In what situations would you do this?

Yes, all the *latest* binaries are stored in source control.

So the tree looks like this:

> product

```
 |-- src

 |-- build

 |-- lib

       |- 3rdparty

       |- internal 
```

> ...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T19:54:54.823

Assuming you are using .Net:

I create a "Libraries" folder in my project and source control that contains any third party assemblies.

My solution then references those assemblies and my build process pulls that folder down to our build server.

Any one pulling your code from source control should be able to compile it without having to hunt down references and assemblies.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T20:13:20.910

Source control is called "source" control, because it is supposed to control sources..

In Java it's common pattern to use some version control system to store sources and other resources like configuration XML files or pictures, and than to use some dependency management tool like Apache Maven, which will store, download and manage your project's dependencies on 3rd party libraries. Then when you reinstall your OS, Maven can automatically download your dependecies from central repository (or your own private repositories as well) and store them in a local cache on your disk. You don't even have to know where the cache is :)

Maven can be also used with other languages and as far as I know plugins for .net and C/C++ are available, but I haven't used it with anything else than Java.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-09T20:05:53.750

I don't put 3rd party source or binaries in SC. My rationale was that I would not have to update SC just to update the libraries. I am starting to regret this though. When I have had to recreate the project I find myself running around looking for the lib sources instead of just syncing to SC.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T20:06:49.320

On a recent Java project I switched to using Maven - this was quite nice since it meant I didn't need to store any third party jars in a lib/ directory. At compile time maven would pull in the dependencies. One nice side affect is the jars have the version number in their filename.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T19:55:46.803

My experience has been to create a "lib" folder and keep all 3rd party binaries in there. I will create a totally separate tree for the Source Code to these third parties if it is available.

Some places where this might be different is if you are using an open source vs. a retail 3rd party, with open source solutions I tend to just include the code in my projects and not check-in the binaries.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T20:02:40.937

You don't need to store third party libraries in your source control repository. Those libraries (think of SDL, libcurl, etc.) should always be available on the web.
Just two raccomandations:

*   make sure to state clearly in your code which version of the library you should compile against
*   be sure that that specific version is always available on the web

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-09T20:18:46.530

Generally speaking, I would do roughly what has been prescribed by other users.

In the case of Subversion, and I admit I can't speak to the inclusion of the feature in the case of other systems, one can use an External to link in a repository maintained elsewhere. In a checkout/export, you'll get a full copy of the source including the updated code from that external repository all in one go.

This was particularly nice for me with PHP/JS development as there is no issue regarding storing binaries. I'd keep an external of the Zend Framework, Doctrine ORM, and jQuery all in a /lib/ folder of the project. Every update would give me a complete, updated copy of -all- the necessary files without any more work than adding that repository URL to an svn property.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-05-21T11:29:57.240

If you are using git (which I recommend), and you have the source of the third party library, then storing the library in its own git repository and including it as a submodule is an excellent setup.

*   [http://book.git-scm.com/5_submodules.html](http://book.git-scm.com/5_submodules.html)
*   [http://git-scm.com/docs/git-submodule](http://git-scm.com/docs/git-submodule)

If the source library is also using git then you can clone their library and push it to your own server so you'll never lose it.

Git submodules allow you to specify which revision of a library is required for a project, which is great for maintaining compatibility.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T19:55:36.117

Conceptually you need to store at least the binaries (and the headers if you do C/C++) That's usually the only way with third party libraries where you don't have the source.

If you have the source you can opt to store the source and build the third party libraries in your build process.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-09T19:56:40.543

You should be able to install a fresh OS, get your sources from source control, built and run. So yes, you should put them in source control.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-09T19:57:44.567

It depends on how big they are. When binaries or installers are too big, it can cause havoc for remote users. The upside of storing binaries and installers is that everything a developer needs to get up and running is in source control and the versions are correct. If you have a separate installation location, versions can get messed up. So, in general I like to store small or moderate binaries in source control, but larger ones I leave out.

Edit: Oh, and I call mine "BinRef" :)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-14T21:10:39.577

**When would you store binaries in your source control?**

I store binaries in source control when I want they ability to quickly revert back to the old version of an application. There are number of reason I would do this, those include the following:

*   Application testing in an environment that exactly matches production is not always possible.
*   The previous programmer may not have used source control or may have used it incorrectly. So it can be difficult to be sure the source code you are changing is the version that matches what the user is working with.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-01-15T17:12:03.480

On source code and compiled libraries (most likely standalone):

If I don't use the third party components (compiled libraries) or provided source to build inhouse software components, I simply take them off the shelf and install them as prescribed (which might include a compile, pl/sql code for example). I would not install them in a dependency management repo or any source control system for the simple reason that I don't want them incorporated accidently or otherwise in components I'm building and I don't want to track them in any software cycle. This is an asset (software asset) that should be tracked with other tools. If I'm not using them for software development, I don't and shouldn't see them in tools I use for software development.

If I depend on them for building my own software, I would store them all day long.

# user-interface - 长表格显示错误的最佳方式。可用性问题

> ID：735701
> 
> 赞同：1
> 
> 时间：2009-04-09T19:53:35.403
> 
> 标签：user-interface, usability, user-experience

我们有一个 long for 其中有 3 个部分：

请求者、运输和计费

每个部分屏幕或更长，因此表单长度为 3+ 个屏幕。从可用性的角度来看，在表单上显示消息的最佳方式是什么。

1.  表单顶部的错误消息分组列表。
2.  该部分顶部的每个部分的分组消息
3.  实际有错误的表单域附近的错误消息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T19:57:37.377

就个人而言，我希望在表单标题之前的页面顶部有类似的内容：

```
There was an error with your form submission in the following section(s):
Shipping, Billing 
```

运输和计费是将我带到表格的那个部分的锚点。然后，在该部分上方，有该部分的相关消息：

```
Shipping
- You need to fill in an address

[rest of form here]

Billing
- You need to fill in a name

[rest of form here] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T19:58:05.220

该部分顶部的每个部分的分组消息

对实际有错误的表单字段进行视觉更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T19:57:39.217

我发现如果表单顶部有一个通用错误说“提交您的信息时出错，请更正红色字段”，然后在每个表单字段旁边显示更具体的错误消息，我发现它最有用错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-16T00:15:18.337

我喜欢有一个显示受影响字段类型的对话框，让它们单击确定，然后将它们滚动到表单中的第一个错误。

然后用某种标志/边框/标记和一条消息指示受影响的字段，让他们知道问题的类型。

因此，如果他们输入了格式错误的电子邮件地址，例如“me@me'com”，那么会让他们知道该电子邮件地址格式错误。确切的措辞实际上取决于您所针对的用户类型。

我讨厌告诉你顶部有错误的表格，然后在字段旁边有很小的星号......呃。

PS 当表单具有“密码”或其他敏感字段并且它被清空而没有将其标记为必填、更正的字段时，它也会让我发疯。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T03:37:14.457

Roger Hudson 有[一篇关于编写可访问表单的非常好的文章](http://www.usability.com.au/resources/wcag2/) 和一个[关于错误处理的示例](http://www.usability.com.au/resources/wcag2/form7.html)。

# .net - 如何使用 Visual Studio 2008 为 Pocket PC 2002 构建？

> ID：735707
> 
> 赞同：5
> 
> 时间：2009-04-09T19:54:55.743
> 
> 标签：.net, visual-studio-2008, pocketpc

有什么方法可以使用 Visual Studio 2008 为 Pocket PC 2002 (3.0) 构建？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T20:23:05.130

Pocket PC 2003SE 是我见过支持的最旧版本（我自己也做过几个）。我*认为*Visual Studio 2003 是最后一次 Pocket PC 2002 可以作为目标。

[有关 VS2008 支持的详细信息](http://blogs.msdn.com/windowsmobile/archive/2007/07/30/visual-studio-beta-2-professional-available-for-download.aspx)

# c# - 您什么时候使用公共服务定位器？

> ID：735712
> 
> 赞同：39
> 
> 时间：2009-04-09T19:55:36.817
> 
> 标签：c#, dependency-injection, inversion-of-control, service-locator, common-service-locator

我一直将[Common Service Locator](http://commonservicelocator.codeplex.com/)视为抽象 IoC 容器的一种方式，但我注意到有些人强烈反对这种类型。

人们是否建议永远不要使用它？一直在用吗？或者有时使用它？如果有时，那么在什么情况下你会使用它，你会在什么情况下不使用它。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-08-13T09:08:56.820

想象一下，您正在编写供 3rd 方开发人员使用的库代码。您的代码需要能够创建这些开发人员提供的服务对象。但是，您不知道每个调用者将使用哪个 IoC 容器。

Common Service Locator 让您可以应对上述情况，而无需将给定的 IoC 强加给您的用户。

在您的库本身中，您可能希望在 IoC 中注册自己的类，现在变得更加困难，因为您需要为自己的使用选择一个不会妨碍调用者的 IoC。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-09-07T10:06:52.440

我注意到反对使用 CSL 的论据之一是错误的，因为开发人员认为这个库只能执行服务定位器模式。然而情况并非如此，因为它也很容易与依赖注入模式一起使用。

但是，CSL 库是专门为需要允许用户注册依赖项的框架设计者设计的。因为库将直接调用 CSL，所以从框架的角度来看，我们正在谈论 SL 模式，因此它的名字。

然而，作为一个框架设计者，对 CSL 的依赖不应该掉以轻心。为了您的框架的可用性，拥有自己的 DI 机制通常要好得多。一种非常常见的机制是在配置文件中设置依赖关系。此模式在整个 .NET 框架中使用。几乎每个依赖项都可以替换为另一个。.NET 提供者模式建立在此之上。

当您作为框架设计者依赖 CSL 时，用户将更难使用您的应用程序。用户必须配置一个 IoC 容器并将其连接到 CSL。但是，框架不可能像使用 .NET 配置系统时那样验证配置，因为它支持所有类型的验证。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-10T04:30:13.273

我最近阅读了一些关于服务定位器概念的文章。这是一种帮助减少耦合的方法，但需要代码耦合到定位器——不是支持定位器的容器，而是定位器本身。这是一种权衡，但在正确的情况下可能是有益的。

一种可能会有所帮助的情况是，当您拥有不使用 DI 的代码时，例如遗留代码 - 我现在就在这条船上。通过 SL 引入所需的对象，而不是直接创建它们，允许添加一些抽象。我将其视为 SL 和 DI/IoC 之间的中间步骤。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-26T06:24:02.000

如果您有需要服务的库代码，并且此代码可以托管在更大的框架/运行时的上下文中，那么框架/运行时将需要提供一种机制，您可以在启动时运行一些自定义代码，您可以在其中初始化您的容器并注册依赖项。CSL 可能出现问题的一个很好的例子是在 MSCRM 的上下文中使用它。您可以通过注册 MSCRM 框架在某些事件上执行的插件来执行自定义业务逻辑。您遇到的问题是您在哪里运行注册逻辑，因为您没有可以订阅用于设置 DI 容器的“启动”事件。即使您可以以某种方式设置您的 DI，您也需要将 CSL 和 DI 库放在 GAC 中，因为这是从插件调用第 3 方代码的唯一方法（要添加到部署清单中的另一个项目）。在这种情况下，您最好将依赖项作为构造函数参数，调用代码可以根据需要进行初始化（通过构造函数注入或手动“更新”适当的接口实现）。

# iphone - iPhone 和 HMAC-SHA-1 编码

> ID：735714
> 
> 赞同：6
> 
> 时间：2009-04-09T19:55:51.950
> 
> 标签：iphone, sha1, hmac

我试图拨打亚马逊网络服务的电话，但我一直在获取签名，看着这个，但我仍然有一个问题。

使用这个例子是什么

```
NSData *keyData;
NSData *clearTextData 
```

? 我需要为这两个值传递什么？

```
/*
  inputs:
  NSData *keyData;
  NSData *clearTextData
*/

uint8_t digest[CC_SHA1_DIGEST_LENGTH] = {0};

CCHmacContext hmacContext;
CCHmacInit(&hmacContext, kCCHmacAlgSHA1, keyData.bytes, keyData.length);
CCHmacUpdate(&hmacContext, clearTextData.bytes, clearTextData.length);
CCHmacFinal(&hmacContext, digest);

NSData *out = [NSData dataWithBytes:digest length:CC_SHA1_DIGEST_LENGTH] 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-07-05T17:41:34.760

我只花了大约 4 个小时在谷歌上搜索并寻找方法来计算 iPhone 上的未加密 SHA1，它与 php 中的 sha1() 函数的结果相匹配。结果如下：

```
 #import <CommonCrypto/CommonDigest.h>

    NSString *hashkey = <your data here>;
// PHP uses ASCII encoding, not UTF
const char *s = [hashkey cStringUsingEncoding:NSASCIIStringEncoding];
NSData *keyData = [NSData dataWithBytes:s length:strlen(s)];

// This is the destination
uint8_t digest[CC_SHA1_DIGEST_LENGTH] = {0};
// This one function does an unkeyed SHA1 hash of your hash data
CC_SHA1(keyData.bytes, keyData.length, digest);

// Now convert to NSData structure to make it usable again
NSData *out = [NSData dataWithBytes:digest length:CC_SHA1_DIGEST_LENGTH];
// description converts to hex but puts <> around it and spaces every 4 bytes
NSString *hash = [out description];
hash = [hash stringByReplacingOccurrencesOfString:@" " withString:@""];
hash = [hash stringByReplacingOccurrencesOfString:@"<" withString:@""];
hash = [hash stringByReplacingOccurrencesOfString:@">" withString:@""];
// hash is now a string with just the 40char hash value in it 
```

希望这能帮助那些在 iPhone 上遇到 SHA1 问题的人

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-10T04:51:28.467

如果您也调用亚马逊网络服务查找价格或产品详细信息，您的亚马逊网络服务密钥将被禁用，您的应用程序将停止工作。

查看亚马逊网络服务的服务条款，严格禁止移动客户端使用：

[https://affiliate-program.amazon.com/gp/advertising/api/detail/agreement.html](https://affiliate-program.amazon.com/gp/advertising/api/detail/agreement.html)

当我自己的应用程序在生产应用程序中禁用了我的 AWS 密钥时，我发现了这一点很困难。我已经阅读了 TOS，但它并没有真正存在，正如您通过上面的链接看到的其他一些晦涩的使用细节。您不会认为联盟计划与 API 有任何关系，但确实如此。

您可以在这篇 TechCrunch 文章中找到被阻止的其他应用程序的详细信息：

[http://www.techcrunch.com/2009/07/07/amazon-killing-mobile-apps-that-use-its-data/](http://www.techcrunch.com/2009/07/07/amazon-killing-mobile-apps-that-use-its-data/)

只是给您一个提示，并希望为您节省大量工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-06T05:17:43.737

```
// This is my code used in my Twitter connection, and working well for me.
// KeithF's code was a big help!
//
// This is a category added to NSData.

@implementation NSData (EOUtil)
- (NSData*)dataByHmacSHA1EncryptingWithKey:(NSData*)key
{   
    void* buffer = malloc(CC_SHA1_DIGEST_LENGTH);
    CCHmac(kCCHmacAlgSHA1, [key bytes], [key length], [self bytes], [self length], buffer);
    return [NSData dataWithBytesNoCopy:buffer length:CC_SHA1_DIGEST_LENGTH freeWhenDone:YES];
}
@end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T20:24:51.537

看看SHA1 编码的[CocoaCryptoHashing](http://github.com/ameingast/cocoacryptohashing/tree/master)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-04T18:04:01.800

[我在这里](https://stackoverflow.com/questions/788569/rsa-encryption-decryption-in-iphone/788627#788627)发布了一个解决方案，它返回 AWS 请求的 Base64 编码数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-02T14:05:33.790

Apple 的 iOS 开发人员库提供了一个名为*CryptoExercise*的优秀示例，其中包括一个简单的函数：

```
- (NSData *)getHashBytes:(NSData *)plainText" to get a SHA-1 hash. 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-03-11T07:42:32.227

你可以看到[这](http://oauth.googlecode.com/svn/code/obj-c/OAuthConsumer/) 也许它对你有帮助。

# c# - Visual Studio - 以编程方式配置源代码管理解决方案

> ID：735715
> 
> 赞同：2
> 
> 时间：2009-04-09T19:55:58.690
> 
> 标签：c#, visual-studio

我正在创建一个向导来帮助我的组织为所有应用程序自动创建一个基础项目。这个想法是程序员可以输入项目名称，一些其他基础知识，该过程将创建一些项目，从源代码管理添加其他项目，配置 IIS 等......

很多工作都是通过简单地使用项目模板和 IWizard 界面来完成一些更复杂的操作。我要做的是，一旦自动创建了所有项目，我将创建一个工作区并自动移动源代码控制下的所有文件。我也在做一些事情，比如添加公共项目，在 IIS 中设置一些特殊设置等......问题是解决方案文件虽然在源代码管理下，但实际上并未配置为使用源代码管理。

任何人都知道如何以编程方式配置解决方案，使其成为源代码控制的一部分并准备好使用？我撞到了一堵砖墙，似乎无法继续前进。顺便说一句：如果 a 没有说清楚，我实际上是在尝试在代码中做同样的事情，就像右键单击一个项目并选择“将解决方案添加到源代码管理”一样。

就像我说的，我已经解决了大部分问题。只是这最后一个让我适应......

重要事实：Windows XP VS 2008 TFS 使用 Microsoft.TeamFoundation 对象....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T20:00:34.980

你能通过 Visual Studio 可扩展性框架来处理这个问题吗？EnvDTE 基本上提供了对您可以交互执行的任何操作的访问...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:05:57.963

我只是在录制宏时按照您所说的做了；好像：

```
 DTE.Windows.Item(Constants.vsWindowKindSolutionExplorer).Activate()
    DTE.ActiveWindow.Object.GetItem("CLSTestSolution").Select(vsUISelectionType.vsUISelectionTypeSelect)
    DTE.ExecuteCommand("File.TfsAddSolutionToSourceControl") 
```

也许你可以从那里开始？

# networking - 类似 FUSE 的虚拟化网络适配器？

> ID：735717
> 
> 赞同：0
> 
> 时间：2009-04-09T19:57:11.247
> 
> 标签：networking, cross-platform, virtualization

[FUSE](http://en.wikipedia.org/wiki/Filesystem_in_Userspace)使您能够轻松地将 SQL 数据库、[GMail](http://richard.jones.name/google-hacks/gmail-filesystem/gmail-filesystem.html)甚至[Wikipedia 文章](http://wikipediafs.sourceforge.net/)等内容编写为本地文件系统文件。网络世界有类似的东西吗？[VTUN](http://vtun.sourceforge.net/)看起来不错，但仅适用于 *nix 操作系统。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T20:15:56.410

适用于 Windows 的OpenVPN ( [http://openvpn.net](http://openvpn.net) ) 安装程序附带 TAP-Win32，它是 *nix TUN/TAP 驱动程序的 Windows 端口。

# php - 我如何使用 asp.net 和 jquery 而不是 php 来做同样的事情？

> ID：735724
> 
> 赞同：0
> 
> 时间：2009-04-09T19:58:30.633
> 
> 标签：php, asp.net, jquery

此截屏视频中的作者使用 jquery 将数据提交到使用 php 的数据库。链接在这里：

[http://blog.themeforest.net/tutorials/jquery-for-absolute-beginners-day-13/](http://blog.themeforest.net/tutorials/jquery-for-absolute-beginners-day-13/)

如何使用 asp.net 和 sql server 2005 做同样的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T20:07:03.657

jQuery AJAX 查询的作用非常简单。它只是向 url 发送请求。无论是静态的（[http://example.com/ajax.aspx](http://example.com/ajax.aspx)）还是相对的（ajax.aspx）

您可以使用该请求发送 POST 或 GET 数据，它的功能就像表单发送该信息一样。

# iphone - 如何以编程方式启动/处理 iPhone 的视图？

> ID：735725
> 
> 赞同：3
> 
> 时间：2009-04-09T19:59:52.067
> 
> 标签：iphone, uiviewcontroller

我没有使用标签栏或任何其他控件——我基本上想动态地将当前视图更改为不同的视图控制器（即通过代码）。我根本没有使用界面生成器...

例如，假设我们创建了三个视图控制器：

（这可能不是最好的例子，但我试图让它简单化）

View_Hello.m（和 .h）

View_Goodbye.m（和 .h）

View_Ciao.m（和 .h）

我们的 ViewerAppDelegate 将启动 View01_Hello。

View_Hello 将有一个自定义的触摸方法，如果滑动则需要转到 View_Ciao，但如果只是触摸则需要转到 View_Goodbye。

关于我如何做到这一点的任何想法（请不要说“哦，您需要在此示例中使用 xxx 界面元素”。我需要能够在应用程序的视图中基于程序控制随机更改视图正在努力）

过去一周我一直在浏览 Google 和 StackOverflow，并浏览了我的三本 O'Reilly Cocoa 书籍（外加三本 iPhone 开发人员书籍），所有这些都只是使用简单的界面——但没有像我这样的例子正在尝试做。

===========

编辑（@Andrew Grant）：

例如：

```
View_Ciao *viewCiao; 
-(void) viewDidLoad { 
  viewCiao = [[View_Ciao alloc] initWithNibName:@"View_Ciao" bundle:nil];
  [viewCiao.view setNeedsDisplay];
  [super viewDidLoad];
} 
```

这崩溃了。:-)

==============

编辑（@丹尼尔迪克森）

太棒了——成功了！

```
- (void)applicationDidFinishLaunching:(UIApplication *)application {    

    [window addSubview:viewController.view];
    [window makeKeyAndVisible];

    // create the second view, remove the first, and then display the second

    viewCiao = [[ViewCiao alloc] init];
    [viewController.view removeFromSuperview];   
    [window addSubview:viewCiao.view];
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T23:46:19.713

你看过 Erica Sadun 的*iPhone Developer's Cookbook*中的食谱 2-8 “Swiping Views”吗？她使用 touchesBegan 和 touchesMoved 来确定滑动方向，然后根据 touchesEnded 中的方向设置动画。

您可以扩展或修改它以添加点击检测以确定要转换到哪个视图。无论如何，如果您想看一下，食谱在第 69 页或附近。这里还有一个[视频 (mov) 示例](http://ericasadun.com/ftp/CodeSamples/Chapter%202%20Samples/swipe1.mov)和一个[代码示例。](http://code.google.com/p/cookbooksamples/downloads/detail?name=C02%20-%20Views.zip&can=2&q=)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:12:13.207

加载适当的视图并将其作为子视图添加到父视图，然后从其父视图中删除现有视图。

如果您只有一级视图，那么您的窗口就是父级。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T21:34:53.337

怎么样：

```
@interface AppDelegate : ...
{
    View_Hello *hello;
    View_Goodbye *goodbye;
    View_Ciao *ciao;
    UIViewController *currentView;
    UIWindow *window;
}
... IBOutlet properties for the 3 controllers.
@end

@implementation AppDelegate
- (void)switchToGoodbye
{
    [currentView.view removeFromSuperview];
    [window addSubview:goodbye.view];
    currentView = goodbye;
}
... etc.
@end 
```

您可能需要在将视图添加到窗口之前调整其大小，并在删除/添加它们之前和之后调用`viewWillDisappear:`currentView和新视图控制器上的 、 和`viewDidDisappear:`。`viewWillAppear:``viewDidAppear:`

# .net - 如何注入 .NET 代码来更改函数的返回值

> ID：735726
> 
> 赞同：0
> 
> 时间：2009-04-09T20:00:32.657
> 
> 标签：.net, code-injection

我目前正在研究如何编写可以注入另一个 .NET 进程并覆盖函数返回值的 .NET 代码。这个想法是我的代码会改变方法调用的返回值，如下所示：

```
Public Function DoSomething() As String

Return "Value"

End Function 
```

我的代码会拦截对 DoSomething() 的调用并返回我自己的自定义字符串，而不是“值”。

我猜我需要使用 .NET Profiling API 来做这种事情。有没有人有使用 Profiling API 的经验，如果有，你认为这种代码注入是可能的吗？

我不打算将它用于任何恶意，我只是想在 .NET 中尝试一些非常低级别的东西，看看它是否可以完成。

干杯。贾斯。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T20:57:14.440

您可能会调查消息接收器...这是一个高级领域，但基本上，它完全按照您的要求做，拦截从一个函数到另一个函数的调用，并在拦截期间执行您自己的代码......消息接收器可以链接在一起，并且可以写为发送消息接收器，在调用启动时处理，或者作为接收接收器，在另一端处理

这里有[更详细的解释](http://www.devx.com/dotnet/Article/16273)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:19:37.120

您可以使用[TypeMock Isolator](http://www.typemock.com/index.php)来做到这一点。

我没有 TypeMock，但是根据[他们的一些例子](http://www.typemock.com/Docs/Unit_Test_Patterns-3_Natural_Type_Mocks.html)，我认为你可以用这样的东西来做：（首先是 C#，然后我会尝试翻译成 VB）

```
using (RecordExpectations recorder = RecorderManager.StartRecording())
{
    DoSomething();
    recorder.Return("My Own Custom String");
}

Using recorder As RecordExpectations = RecorderManager.StartRecording()
    DoSomething
    recorder.Return("My Own Custom String")
End Using 
```

看起来 TypeMock 对开源项目是免费的，否则它会花钱。但是他们已经为您完成了 Profiling API 编码，因此您可以担心解决问题，而不是编写繁琐的 C++。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:24:41.193

[Detours](http://research.microsoft.com/en-us/projects/detours/)是你为 Win32 做的。我从未见过 Detours.NET，但也许他们正在做的事情会给你一个关于如何实现你想要做的事情的提示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T21:13:10.860

PostSharp 可以做到这一点，但不是在运行时，它会在最初编写后修改代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-09T08:45:06.810

Typemock Isolator 附带的[CTru](http://cthru.codeplex.com/)项目可以为您提供此功能。
该项目是一个开源项目，但它使用 Typemock Isolator。
它会让你注册你的回调方法并在运行时改变它的行为。
它不仅限于运行单元测试。
需要注意的一件事是，一旦使用它，性能就会受到影响。

# sql-server - SQL Server 数据库备份计划和日志截断

> ID：735728
> 
> 赞同：2
> 
> 时间：2009-04-09T20:00:38.023
> 
> 标签：sql-server, sql-server-2005, backup, transaction-log

我有一个每晚备份的 SQL Server 2005 数据库。那里的备份包括：

1.  数据库的完整备份。
2.  事务日志的备份。

目前这是两个独立的工作。

日志很大，我想进行设置，以便：

1.  数据库每晚完整备份
2.  设置日志以便我可以从一个备份和下一个备份之间的任何点恢复数据库。

如何进行设置以便日志文件易于管理？我怀疑日志从未缩小过，因为日志很大。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T21:44:10.647

您目前正在从事物的声音实施完全恢复模型。这将允许您恢复到某个时间点，前提是您有一个涵盖所需时间点的事务日志备份（完全备份后）。

为了减小所需事务日志文件的大小，您应该考虑增加事务日志备份的频率。我建议每小时。一旦您测量了日志文件的实际使用情况，您就可以将其缩小到更合适的大小。这里要注意的关键点是，一旦事务日志备份完成，日志文件的非活动部分将再次可供使用。事务日志文件持续增长的原因是事务日志备份要么根本没有被采取，要么它们的频率不够。

我还建议您考虑混合执行差异备份和完整备份，以减少备份数据的总体大小。一个示例计划是每周一次的完整备份，比如每周日，每天都有差异备份。

我希望我所详述的内容是有意义的。请随时直接与我联系，我很乐意协助您为您的环境部署适当的备份策略。

基本参考：

1.  [如何阻止事务日志文件意外增长](http://support.microsoft.com/kb/873235)
2.  [在 SQL Server 中备份和恢复数据库](http://msdn.microsoft.com/en-us/library/ms187048.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T21:48:29.777

我发现备份的一件事是人们通常不会足够频繁地运行它们——尤其是在涉及日志文件备份时。听起来你是对的，日志文件没有被定期截断（这意味着你可能会浪费高级磁盘空间 [ [1](http://www.sqlservervideos.com/video/logging-essentials) ]）。更重要的是，从可恢复性的角度来看，这会让您完全暴露。）

不过令人高兴的是，根据需要启动并运行它们并不难。事实上，我推荐以下三个视频，因为它们应该为您提供所需的背景信息，然后是您需要遵循的分步说明以使一切正常运行： [http://www.sqlservervideos .com/video/logging-essentials](http://www.sqlservervideos.com/video/logging-essentials)

[http://www.sqlservervideos.com/video/sql2528-log-files](http://www.sqlservervideos.com/video/sql2528-log-files)

[http://www.sqlservervideos.com/video/sqlbackup-best-practices](http://www.sqlservervideos.com/video/sqlbackup-best-practices)

[1](http://www.sqlservervideos.com/video/logging-essentials)最大化存储性能：[http ://www.sqlmag.com/Article/ArticleID/100893/sql_server_100893.html](http://www.sqlmag.com/Article/ArticleID/100893/sql_server_100893.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T21:06:07.833

你正在做的实际上是一个简单模式的备份，具有不收缩日志的额外缺点。没有必要同时备份两者。如果您正在执行完整备份，则可以截断日志。

如果您要能够恢复到任何时间点，则必须每天进行一次完整备份（例如），并在一天中备份几次日志。请参阅[http://msdn.microsoft.com/en-us/library/ms191429(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms191429(SQL.90).aspx)

# c# - 使用 StructureMap 缓存命名实例

> ID：735730
> 
> 赞同：0
> 
> 时间：2009-04-09T20:01:42.327
> 
> 标签：c#, structuremap

我很难弄清楚如何让 StructureMap 缓存一个非默认实例。我可以用这样的代码缓存默认实例

```
ForRequestedType<ISession>()
            .CacheBy(InstanceScope.HttpContext)
            .TheDefault.Is.ConstructedBy(() => ObjectFactory.GetInstance<ISessionFactory>().OpenSession()); 
```

按预期工作。我可以很好地创建一个命名实例

```
InstanceOf<User>().Is.ConstructedBy(() => someAwesomeConstructor()).WithName("CurrentUser"); 
```

但是我真的很想按会话缓存“CurrentUser”，但是 .CacheBy() 只存在于 CreatePluginFamilyExpression<> 中，我可以告诉从 CreatePluginFamilyExpression<> 到 IsExpression<> 的唯一方法是通过属性 TheDefault，它强制我创建一个我不想要的默认值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T16:06:24.810

这是我能够快速到达的最接近的地方

```
ForRequestedType<IInterface>()
    .AddInstances(x => x
        .OfConcreteType<Implementation>()
        .WithName("foo"))
    .CacheBy(InstanceScope.HttpContext); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T13:25:06.700

添加一个单独的行：

```
ForRequestedType<User>().CacheBy(...
InstanceOf<User>().Is.ConstructedBy(... 
```

您目前无法为特定实例配置缓存。如果您有一个 IUser，并且您希望 User 的缓存与另一个类的缓存不同，例如 PerRequestUser，也会发生同样的情况。在这种情况下，如果您通过 IUser 请求实例，那么将始终应用相同的缓存。

它是 SM 的当前限制。以上可能是您需要的。或者，考虑滚动您自己的行来代替此表达式：

```
() => someAwesomeConstructor() 
```

相反，你会打电话：

```
() => GetUserCachingInSession() 
```

在那个方法中，你有简单的逻辑从会话中检索它，如果它没有得到一个新的，将它保存在会话中。

# java - 使用休眠注释将枚举映射到表

> ID：735732
> 
> 赞同：30
> 
> 时间：2009-04-09T20:01:53.340
> 
> 标签：java, hibernate, enums, orm

我有一个表 DEAL 和一个表 DEAL_TYPE。我想映射这段代码：

```
public class Deal {
   DealType type;
}

public enum DealType {
   BASE("Base"), EXTRA("Extra");
} 
```

问题是数据已经存在于数据库中。而且我很难将类映射到数据库。

数据库看起来像这样：

```
 TABLE DEAL {
      Long id;
      Long typeId;
   }

   TABLE DEAL_TYPE {
       Long id;
       String text;
   } 
```

我知道我可以使用从交易到交易类型的简单@OneToMany 关系，但我更喜欢使用枚举。这可能吗？

我几乎通过使用 EnumType.ORDINAL 类型让它工作了。但不幸的是，我的交易类型表中的 ID 不是连续的，并且不是从 1 开始的。

有什么建议么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-09T20:08:45.257

在 Enums 中，Hibernate 有点糟糕。这是一个非常好的 ORM 的奇怪失败。解决它的“最简单”的方法是将您的 Enum 声明为自定义休眠类型。幸运的是，Hibernate 编写了一个示例实现，您可以将它逐字写入您的应用程序中：

[http://www.hibernate.org/265.html](http://www.hibernate.org/265.html)

它们甚至包括有关如何使用它的说明。这是我在最终需要持久化枚举时使用的模式。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-04-22T09:31:00.323

我创建了一个类似于 hibernate 建议的类，它只是可配置的，不需要仅为这种持久性创建新类型。

可以像这样使用

```
@Type(type = "ro.raisercostin.hibernate.EnumUserType", parameters = @Parameter(name = "type", value = "DealType"))
DealType dealType; 
```

我添加了 ParameterizedType 的实现来支持传递的参数。

```
public class EnumUserType implements UserType, ParameterizedType {

    private static final int[] SQL_TYPES = { Types.VARCHAR };
    private Class clazz = null;

    public EnumUserType() {
    }

    @Override
    public void setParameterValues(Properties parameters) {
        String className = (String) parameters.get("type");
        try {
            this.clazz = Class.forName(className);
        } catch (ClassNotFoundException e) {
            throw new RuntimeException("Couldn't get the class for name [" + className + "].", e);
        }
    }

    public int[] sqlTypes() {
        return SQL_TYPES;
    }

    public Class returnedClass() {
        return clazz;
    }

    public Object nullSafeGet(ResultSet resultSet, String[] names, Object owner) throws HibernateException,
            SQLException {
        String name = resultSet.getString(names[0]);
        Object result = null;
        if (!resultSet.wasNull()) {
            result = Enum.valueOf(clazz, name);
        }
        return result;
    }

    public void nullSafeSet(PreparedStatement preparedStatement, Object value, int index) throws HibernateException,
            SQLException {
        if (null == value) {
            preparedStatement.setNull(index, Types.VARCHAR);
        } else {
            preparedStatement.setString(index, ((Enum) value).name());
        }
    }

    public Object deepCopy(Object value) throws HibernateException {
        return value;
    }

    public boolean isMutable() {
        return false;
    }

    public Object assemble(Serializable cached, Object owner) throws HibernateException {
        return cached;
    }

    public Serializable disassemble(Object value) throws HibernateException {
        return (Serializable) value;
    }

    public Object replace(Object original, Object target, Object owner) throws HibernateException {
        return original;
    }

    public int hashCode(Object x) throws HibernateException {
        return x.hashCode();
    }

    public boolean equals(Object x, Object y) throws HibernateException {
        if (x == y) {
            return true;
        }
        if ((null == x) || (null == y)) {
            return false;
        }
        return x.equals(y);
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-04-04T13:45:21.517

您可以使用注释枚举`@Entity`并使用自定义元组创建枚举的实例`Enum.valueOf`

枚举声明如下所示：

```
@Entity
@Table(name = "node_interface_type")
@Tuplizer(impl = EnumTuplizer.class)
public enum Type {
    WIRED, WIRELESS, WIRELESS_SENSOR_NODE;
    @Id
    public String name = toString();
} 
```

Tuplizer 是：

```
public class EnumTuplizer extends PojoEntityTuplizer {
    public EnumTuplizer(EntityMetamodel entityMetamodel, PersistentClass mappedEntity) {
        super(entityMetamodel, mappedEntity);
    }

    @Override
    protected Instantiator buildInstantiator(final PersistentClass persistentClass) {
        return new Instantiator() {
            @Override
            public Object instantiate(Serializable id) {
                try {
                    return Enum.valueOf(
                            (Class) persistentClass.getClass().getClassLoader().loadClass(persistentClass.getClassName()),
                            (String) id
                    );
                } catch (ClassNotFoundException e) {
                    throw new AssertionError(e);
                }
            }

            @Override
            public Object instantiate() {
                throw new UnsupportedOperationException();
            }

            @Override
            public boolean isInstance(Object object) {
                throw new UnsupportedOperationException();
            }
        };
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-15T07:13:02.447

如果您想以只读方式使用实体，则可以使用`@Formula`and `@Enumerated`。尝试类似：

```
@Entity
public class Deal {
   @Formula("(select text from DEAL_TYPE dt where dt.id = typeId)")
   @Enumerated(EnumType.STRING)
   DealType type;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T20:10:00.247

虽然远非理想，但我对这个问题的解决方案是使用 EnumStringType 和非规范化的可更新视图。

# .net - 单元测试构造函数时的多个断言？

> ID：735737
> 
> 赞同：4
> 
> 时间：2009-04-09T20:02:08.393
> 
> 标签：.net, unit-testing, constructor, nunit

我正在尝试对具有 2 个构造函数的类进行单元测试。每个构造函数都有多个设置公共属性的参数。我的问题是，我应该只有 2 个带有多个断言的单元测试来检查每个属性是否已设置，或者对每个构造函数的每个参数进行测试？

```
Public Person(string name, string phone, string birthday)
{
   name = name;
   phone = phone;
   birthday = birthday;
}

Public Person(string name) : this(name, null, null)
{} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T20:08:04.853

我从来都不喜欢“每次测试只有一个断言”的教条。这对我来说似乎并不实用——你最终会在你*真正*感兴趣的东西周围产生很多绒毛（测试声明）。

是的，如果你有多个问题，你只会有一个测试失败。你修复测试，再次运行它，发现下一个失败，修复它并重复，直到它成功。没有很大的损失。

我并不是说你应该在每个测试中测试大量的功能——但走到另一个极端也不实用。

不过，我通常只会为每个测试选择一个*错误*条件 - 所以如果你的构造函数实际上会为空参数抛出异常，我会在单独的测试中检查每一个。否则很容易不小心错过一些东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T20:05:16.937

您正在测试的操作是构造函数接受 __ 参数并将值设置为正确的值。

因此，我会说每个构造函数进行 1 次测试，每个构造函数都有多个断言，以确保正确设置所有成员。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-10T04:29:41.293

您可能有兴趣了解***Kent Beck 本人***在 Stack Overflow 上所说的话。他说...

> 我为有效的代码而不是测试获得报酬，所以我的理念是尽可能少地进行测试以达到给定的信心水平（我怀疑与行业标准相比，这种信心水平很高，但这可能只是狂妄自大） . 如果我通常不会犯某种错误（例如在构造函数中设置错误的变量），我不会对其进行测试。我确实倾向于理解测试错误，所以当我有复杂条件的逻辑时我会格外小心。在团队中编码时，我会修改我的策略以仔细测试我们共同容易出错的代码。

[这是链接。](https://stackoverflow.com/questions/153234/how-deep-are-your-unit-tests/153565#153565)

我承认这让我重新思考我正在做的一些事情没有问题。为了更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T20:42:19.873

我第二次建议不要对每个属性进行一个测试，而是对每个构造函数进行一个带有多个断言的测试。

我要补充一点，根据你的类将在哪里使用，你可能还需要一个测试来验证你的构造函数在 name 参数是空字符串时的行为（否定测试）。

# python - 遍历字符，生成单词并检查域是否存在

> ID：735743
> 
> 赞同：0
> 
> 时间：2009-04-09T20:03:11.357
> 
> 标签：python, ping

有没有办法根据字符生成单词并检查该单词是否存在域（ping）？

我想做的是根据一些字符生成单词，例如“abcdefgh”，然后 ping generateword.com 以检查它是否存在。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T20:24:52.817

您不想使用 ping 命令，但可以使用 Python 的[`socket.gethostbyname()`函数](http://docs.python.org/library/socket.html#socket.gethostbyname)来确定主机是否存在。

```
def is_valid_host(hostname):
    try:
        addr = socket.gethostbyname(hostname)
    except socket.gaierror, ex:
        return False
    return True

hosts = ['abc', 'yahoo.com', 'google.com', 'nosuchagency.gov']
filter(is_valid_host, hosts) 
```

这将花费大量时间，并且可能会让您的 ISP 生您的气。你最好：

1.  使用较低级别的 DNS 接口，例如[dnspython](http://www.dnspython.org/)，或

2.  找到与域名注册商的直接接口，例如[whois](http://pypi.python.org/pypi?%3Aaction=search&term=whois&submit=search)并查询它。

你不会用它来向人们发送垃圾邮件，是吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T20:21:14.540

仅仅因为站点无法 ping 并不意味着该域可用。域可能被保留但没有指向任何地方，或者机器可能不响应 ping，或者它可能只是停机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:16:17.067

您似乎在谈论字符组合的排列。这是一个相当好的[出版食谱](http://code.activestate.com/recipes/190465/)。该链接应该可以帮助您入门。

另外一点，ping 不会告诉您服务器是否“存在”或名称是否已注册，只有当它在线并且*不在*阻止 ping 流量的防火墙后面时。

# gcc - 为什么 GCC 找不到我的非模板函数？("没有匹配的函数调用...")

> ID：735766
> 
> 赞同：0
> 
> 时间：2009-04-09T20:10:39.810
> 
> 标签：gcc, templates, visual-c++

在 MSVC 2008 中，我有以下代码：

```
class Foo {
  //  Be a little smarter about deriving the vertex type, to save the user some typing.
  template<typename Vertex> inline void drawVertices(
    Elements vCount, RenPrim primitiveType, PixMaterial *mtl, Vertex const *vertices)
  {
    this->drawVertices(vCount, primitiveType, mtl, vertices, Vertex::VertexType);
  }

  virtual void drawVertices(
    Elements vCount,
    RenPrim primitiveType,
    PixMaterial *mtl,
    void const *vertices,
    uint vertexType) = 0;
}; 
```

我使用它是这样的：

```
struct RenFlexibleVertexPc
{
  enum { VertexType = RenVbufVertexComponentsPc };
  float x;
  float y;
  float z;
  GraVideoRgba8 c; // Video format, not external!
};

  PixMaterial *material;
  struct Pc : RenFlexibleVertexPc
          {
            void set(Triple t, uint cl) { x = (float)t.x_; y = (float)t.y_; z = (float)t.z_; c = cl; }
          } vpc[4];
  ...
  Foo *renderer;
  renderer->drawVertices(4, RenPrimTriangleFan, material, vpc); 
```

这在 MSVC 2008 SP1 中运行良好。但是，GCC（3.4 和 4.1,2）会抛出“no matching function for call to function”错误，当存在具有更多参数的非模板函数时，显然看不到模板。

GCC 坏了，还是我的代码坏了，如果是，为什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T23:46:44.187

重载或继承没有问题：

```
#include <iostream>
#include <memory>

namespace {
    struct A {
        virtual void f()
        {
            std::cout<<"inside A's f()\n";
        }

        template <typename T> void f(T t)
        {
            std::cout<<T::i<<'\t';
            this->f();
        }
    };

    struct B : A {
        void f()
        {
            std::cout<<"hello\t";
            A::f();
        }
    };

    struct C {
        static const unsigned int i = 5;
    };

    struct D {
        enum { i = 6 };
    };
}

int main()
{
    std::auto_ptr<A> b(new B());
    b->f(C());
    b->f(D());
} 
```

工作正常。另一方面，我能找到的最小示例表明您的问题没有继承或重载：

```
#include <iostream>

namespace {
    struct A {
        template<class C> void print(C c)
        {
            c.print();
        }
    };
}

int main()
{
    struct B {
        void print()
        {
            std::cout << "whee!\n";
        }
    };

    A a;
    B b;
    a.print(b);
} 
```

请注意， if`struct B`是在命名空间中定义的（无论是未命名的命名空间，还是完全不同的命名空间，或者全局命名空间），而不是在`main()`this 编译时不会出错的内部。

~~我对标准的了解不足以说明这是否是一个错误，但它似乎是一个。我已将[其报告给 GCC 错误数据库](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=39770)。~~

* * *

这是来自 GCC 开发人员的回答（来自上面的链接）：“本地类不能是模板参数。”

所以代码被破坏了。 [并不是说这是个坏主意](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1427.pdf)。事实上，C++0x 消除了这个限制。

我注意到了这条线

> 请注意，如果我将 vpc 显式转换为 (RenFlexibleVertexPc *)，则代码在 GCC 中有效

由于`RenFlexibleVertexPc`不是本地课程，因此这是有道理的。然而`Pc`是一个本地类/结构，所以它是不允许的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T20:45:06.580

@OP：指定模板参数是一种有效的方法。

```
renderer->drawVertices<RenFlexibleVertexPc>(4, RenPrimTriangleFan, material, vpc); 
```

通过 Pete 的补充，您的代码也可以在 Apple 的 GCC 4.0.1 上编译，所以我怀疑您发布的代码缺少某些东西会导致问题。

@Max：GCC 对您的源代码的处理是标准的。结构 B 是 main() 的本地结构，因此 B（因此 main()::B::print()）在 main() 之外不可见。您可能知道，将 B 的定义移到 main() 之外，它将编译。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:15:46.317

> 的定义`VertexType`已经在代码中（一个枚举）。Elements 是一个无符号长整数。请注意，如果我将 vpc 显式转换为 ( `RenFlexibleVertexPc *`) ，则代码在 GCC 中有效

如果它是一个枚举，为什么要传递一个结构数组 4 类型的对象？是什么`RenFlexibleVertexPc`？的最后一个参数`drawVertices`应该是一个指向一个`Vertex`对象的常量指针，或者一个指向`const*`从`Vertex`.

```
Foo *renderer;
renderer->drawVertices(4, RenPrimTriangleFan, material, vpc); 
```

您正在对未初始化的指针调用函数。我希望这不是真正的代码。\

# jquery - 如果选中单选按钮，如何使用 jquery 执行 javascript 确认对话框

> ID：735769
> 
> 赞同：0
> 
> 时间：2009-04-09T20:12:09.557
> 
> 标签：jquery, validation, webforms, radio-button

我有两个像这样的单选按钮

```
<input type="radio" name="rush" value="yes" />
<input type="radio" name="rush" value="no" checked="checked" /> 
```

我想要做的是单击表单提交按钮时，检查是否选择了“是”。

如果是，显示一个 javascript 确认对话框

我已经走了这么远，但被卡住了，任何帮助将不胜感激。

```
$("form.shipping").submit(function() {

    if($("input[name='rush']".attr("value") === "yes")
    {
        if (confirm("Rush orders are subject to an upcharge. (Just wanted to make sure you read the note). Is this ok?"))
        {
            return true;
        }
        else
        {
            return false;
        }
    }

}); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T20:14:47.490

您正在将某些内容绑定到`click`按钮的事件。您可能希望将其绑定到`submit`表单的事件。除此之外，您`input.sumbit-button`在选择器中拼写错误。

**编辑**：[这](http://jsbin.com/izixa)是您想要的工作版本。你的错误是：

*   您可能没有将代码包装在`document.ready`. 如果您的脚本包含在页面顶部，这一点很重要，因为您编写的任何未包含在此事件中的内容都将在创建 DOM 元素之前执行。因此，您将事件绑定到任何内容。该`document.ready`事件通过在 DOM 完全加载后立即触发来处理这一点。
*   `)`你之前有一个缺失的结束`.attr`。你可能应该研究像[FireBug](http://getfirebug.com/)这样的工具来调试你的 javascript，因为用它来找到这些东西是微不足道的。
*   您正在检查单选按钮的值，但它始终评估为 true，因为您需要将其过滤掉以仅获取[`:checked`](http://docs.jquery.com/Selectors/checked)一个。

所以，工作代码：

```
$(document).ready(function() {
    $("form.shipping").submit(function() {
        if($("input[name='rush']").is(":checked")) {
            return confirm("Rush orders are subject to an upcharge.
            (Just wanted to make sure you read the note). Is this ok?");
        }
    });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:27:10.860

它会在多个浏览器中失败吗？我在 IE7 中看到过一些奇怪的错误报告，其中确认（）没有在 onclick 或 onsubmit 事件处理程序中执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:42:13.540

你的选择器 "input[name='rush']" 将返回两个输入，你需要 "input[name='rush']:checked" 正如 Paolo Bergantino 建议的那样

# wcf - PocketPC上的WCF，未连接到主机

> ID：735770
> 
> 赞同：1
> 
> 时间：2009-04-09T20:12:13.050
> 
> 标签：wcf, windows-mobile, compact-framework

我在这里使用 PocketPC vm 进行开发。

我可以让虚拟设备连接到互联网，但我无法让它连接到本地（主机）机器上的 Web 服务。

我已经尝试了机器名称和我的 IP 地址，不同的端口，但没有运气。

其他人有这个问题吗？

编辑：我的机器上也有一个实际的设备。对接时，我对真实设备没有这个问题，只是模拟设备。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T20:15:56.613

我没有遇到具体问题。但是，我发现在使用 WCF 时处理这些问题的最佳方法是[启用跟踪](http://msdn.microsoft.com/en-us/library/ms733025.aspx)并查看错误消息是什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:34:40.703

如果您通过 ActiveSync 连接，则可以连接到名称“ppp_peer”。

此名称将始终解析为通过主动同步连接的机器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T17:19:10.133

当我读到这篇文章时想通了： [http ://www.betterthaneveryone.com/archive/2008/08/31/getting-network-access-on-the-windows-mobile-emulator.aspx](http://www.betterthaneveryone.com/archive/2008/08/31/getting-network-access-on-the-windows-mobile-emulator.aspx)

1.  设备必须对接。您需要使用设备模拟器管理器来对接设备。 *另请注意：您只能在给定时间停靠一个设备。*
    设备对接后，您应该会看到 Windows Mobile 设备中心显示。找到正在运行的设备（寻找绿色箭头），右键单击并选择 Cradle。请记住，一次只能放置/对接一台设备。如果您有一个已经安装了支架的真实设备，则无法安装模拟器。
2.  在 Windows Mobile 设备中心 -> 移动设备设置 -> 连接设置中：选中“允许连接到以下设备之一：”并在下拉列表中选择 DMA。
3.  在模拟器上：文件->配置->网络。确保选择了有效的网络设备。
4.  从模拟操作系统：开始菜单 -> 设置 -> 连接 -> 连接 -> 高级 -> 选择网络。将两个下拉菜单设为我的 ISP。

应该是这样的。要进行测试，请加载 Internet Explorer，浏览至 StackOverflow.com。接下来，浏览到本地计算机上的网页。

# c# - 查看 RadioButtonList 是否具有选定值的最佳方法是什么？

> ID：735775
> 
> 赞同：16
> 
> 时间：2009-04-09T20:14:31.827
> 
> 标签：c#, asp.net, validation, radiobuttonlist

我在用：

```
if (RadioButtonList_VolunteerType.SelectedItem != null) 
```

或者怎么样：

```
if (RadioButtonList_VolunteerType.Index >= 0) 
```

或者怎么样（根据安德鲁黑尔的回答）：

```
if (RadioButtonList_VolunteerType.Index > -1) 
```

对于可能阅读此问题**的人，以下方法不是有效的方法**。正如 Keltex 指出的那样，所选值可能是一个空字符串。

```
if (string.IsNullOrEmpty(RadioButtonList_VolunteerType.SelectedValue)) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T20:16:26.660

这些都是检查选定值的有效且完全合法的方法。我个人觉得

```
RadioButtonList_VolunteerType.SelectedIndex > -1 
```

是最清楚的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-09T21:19:02.267

在可读性方面，它们对我来说都缺乏一些东西。这似乎是扩展方法的一个很好的候选者。

```
public static class MyExtenstionMethods 
{   
  public static bool HasSelectedValue(this RadioButtonList list) 
  {
    return list.SelectedItem != null;
  }
}

...

if (RadioButtonList_VolunteerType.HasSelectedValue)
{
 // do stuff
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:23:35.393

我建议：

```
RadioButtonList_VolunteerType.SelectedIndex>=0\. 
```

根据[微软文档](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.selectedindex.aspx)：

> 列表中选定项目的最低序号索引。默认值为 -1，表示未选择任何内容。

string.IsNullOrEmpty(RadioButtonList_VolunteerType.SelectedValue)**并不总是有效**，因为您可以拥有一个空值的 ListItem：

```
<asp:ListItem Value=''>This item has no value</asp:ListItem> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-19T13:23:10.777

问题更多地围绕是否检查null或检查int的值。马丁的伟大扩展方法也可以写成：

```
public static bool HasSelectedValue(this ListControl list)
{
    return list.SelectedIndex >= 0;
} 
```

ListControl 的 MSDN 文档指出：

> [SelectedItem 的](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.selecteditem.aspx)默认值为 null 。
> 
> SelectedIndex 的默认[值为 -1](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.selectedindex.aspx)。

因此，两者都是有效的方法，并且都有效。问题是哪种方法最好。我猜 SelectedIndex 因为它是值类型操作而不是引用类型操作。但我没有什么可以支持的。

# asp.net - LinkBut ton 命令事件似乎没有触发

> ID：735777
> 
> 赞同：6
> 
> 时间：2009-04-09T20:15:08.237
> 
> 标签：asp.net

我使用 AJAX 控件工具包 Accordion、LinkBut​​ton 和 TextBox 创建了一个简单的用户控件，如下所示：

测试控制.ascx：

```
<%@ Control Language="C#" AutoEventWireup="true" CodeFile="TestControl.ascx.cs" Inherits="TestControl" %>
<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="cc1" %>
<cc1:Accordion ID="Accordion1" runat="server">
    <Panes></Panes>
    <HeaderTemplate>
        <div><%# Container.DataItem %></div>
    </HeaderTemplate>
    <ContentTemplate>
        <div>
            <asp:TextBox ID="textBox" Text='<%# Container.DataItem %>' runat="server"></asp:TextBox>
            <asp:LinkButton Text="Update" CommandName="Update" CommandArgument='<%# Container.DataItem %>' OnCommand="LinkButton_Command" runat="server"></asp:LinkButton>
        </div>
    </ContentTemplate>
</cc1:Accordion> 
```

和TestControl.ascx.cx：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

public partial class TestControl : System.Web.UI.UserControl
{
    protected void Page_Load(object sender, EventArgs e)
    {
        Accordion1.DataSource = new string[] { "one", "two", "three" };
        Accordion1.DataBind();
    }

    protected void LinkButton_Command(object sender, CommandEventArgs e)
    {
        if (e.CommandName == "Update")
        {
            TextBox value = ((LinkButton)sender).Parent.FindControl("textBox") as TextBox;
            ((string[])Accordion1.DataSource)[Accordion1.SelectedIndex] = value.Text;
            Accordion1.DataBind();
        }
    }
} 
```

LinkBut​​ton_Command 事件处理程序在第一次单击时根本不会触发，而是在第二次单击时触发。创建控件的生命周期是否存在导致事件无法正确连接的问题？

更新：我正在静态添加控件：

```
<%@ Page Language="C#" AutoEventWireup="true"  CodeFile="Default.aspx.cs" Inherits="_Default" %>

<%@ Register src="TestControl.ascx" tagname="TestControl" tagprefix="uc2" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>
<body>

    <form id="form1" runat="server">    
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <div border="1">
        <uc2:TestControl ID="TestControl1" runat="server" />
    </div>

    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T21:22:54.597

这是一个解决方案。我在一个测试项目中检查了这个，这很有效：

澳交所：

```
<%@ Control Language="C#" AutoEventWireup="true" CodeBehind="TestControl.ascx.cs" Inherits="WebApplication1.TestControl" %>
<%@ Import Namespace="System.ComponentModel"%>
<%@ Register Assembly="AjaxControlToolkit" Namespace="AjaxControlToolkit" TagPrefix="cc1" %>

<cc1:Accordion ID="Accordion1" runat="server" Enabled="True">

    <Panes></Panes>
    <HeaderTemplate>
        <div><asp:Label runat="server" ID="HeaderLabel"><%# Container.DataItem %></asp:Label></div>
    </HeaderTemplate>
    <ContentTemplate>
        <div>
            <asp:TextBox ID="textBox" Text='<%# Container.DataItem %>' runat="server"></asp:TextBox>
            <asp:LinkButton ID="LinkButton1" Text="Update" CommandName="Update" CommandArgument='<%# Container.DataItem %>' 
            OnCommand="LinkButton_Command" runat="server"></asp:LinkButton>
        </div>
    </ContentTemplate>

</cc1:Accordion> 
```

代码隐藏：

```
public partial class TestControl : System.Web.UI.UserControl
{
    protected void Page_Init(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            Accordion1.DataSource = new string[] {"one", "two", "three"};
            Accordion1.DataBind();
        }
    }

    protected void LinkButton_Command(object sender, CommandEventArgs e)
    {
        if (e.CommandName == "Update")
        {
            TextBox value = ((LinkButton)sender).Parent.FindControl("textBox") as TextBox;
            (Accordion1.Panes[Accordion1.SelectedIndex].Controls[0].Controls[1] as Label).Text = value.Text;
        }
    }
} 
```

似乎 Databinding the Accordion 有一些问题会弄乱您的事件处理程序。每次以某种方式对它们进行核弹时都重新绑定它。

此外，您发布的代码在 LinkBut​​ton_Command 方法中调用了 DataBind()，该方法在加载视图状态后发生。这将导致更新的数据在下一次回发之前不会显示，因为新的绑定不会保存在 ViewState 中。它会表现得好像它总是落后于一个回传。

# sql - 无法在 Oracle 表上创建简单视图

> ID：735778
> 
> 赞同：1
> 
> 时间：2009-04-09T20:15:23.650
> 
> 标签：sql, oracle, security, views

一个外部数据库管理员导出了一个生产数据库并将其导入到测试环境中。我们使用的是 Oracle 9.2。大多数导入的数据库对象（表、视图、idexes、包...）工作正常，但我们对三个特定表有问题：我们可以在这些表上执行 SELECT、UPDATE、DELETE，但我们不能在此创建视图表。

换句话说，以下工作：

```
 create or replace view v_test_view as select 1 x from dual; // we can create views
 create or replace view v_test_view  as select 1 x from someTable;
 select * from problematicTable; // we can select data from problematic table 
```

但这不起作用：

```
 create or replace view v_test_view  as select 1 x from problematicTable;
--> ORA-01031: insufficient privileges 
```

背景资料：

*   db admin 使用导入/导出实用程序复制数据库架构
*   生产和测试Oracle的版本不完全相同（生产是9.2.0.8，测试是9.2.0.7）
*   初始导入完成后，有问题的表在对象目录（和数据库开发工具）中可见，但是当尝试从该表中选择时，我们得到了“无效标识符”。之后，表被重新导入，现在我们可以从中选择，但不能在它们上创建视图

有任何想法吗？

**更新：** 看起来情况更加奇怪。当使用一个 oracle 会话时，我们可以从该表中选择数据，在另一个 Oracle 会话中（**使用同一用户登录！**），我们得到“ORA-00904：无效标识符”

**更新#2：** 用于导入的导出数据已成功用于将数据导入另一个测试环境（我们称之为 TEST1），该环境与有问题的环境（TEST2）位于 Oracle 的同一实例上。这两个环境之间的区别在于 TEST1 使用与生产相同的用户（模式名称），但 TEST2 使用另一个用户（因此对象被导入另一个模式名称）。有问题的表没有任何与正常工作的表不同的特殊安全属性。

马特拉

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T22:16:36.760

用户是否通过 ROLE 在有问题的表上创建视图授予选择？如果是这样，请尝试在表上给出明确的授权。

来自甲骨文：

“为了在模式中创建视图，该模式必须具有从视图所基于的所有表或视图中选择、插入、更新或删除行所需的权限。必须授予视图所有者这些权限直接，而不是通过角色。原因是授予角色的权限不能通过对象继承。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T18:24:50.707

看起来导入有问题。所以我们的数据库管理员解决问题的方法是：

*   删除有问题的表
*   重新导入有问题的表*的结构*（列、约束、索引）
*   重新创建结构后，他重新导入了数据
*   他还使用 CREATE TABLE AS SELECT 来回复制数据

当他重新创建表结构时，他发现当前模式耗尽了可用空间（未设置为自动增长）。奇怪的是，第一次导入并没有抱怨空间不足。

所以理论上是空间不足是数据字典损坏的原因。

# c# - 用户控制回发

> ID：735787
> 
> 赞同：2
> 
> 时间：2009-04-09T20:17:16.750
> 
> 标签：c#, asp.net, postback, user-controls

我正在使用用户控件呈现一组购物车项目。可以通过用户控件中的按钮删除每个购物车项目。当购物车物品被移除时，我需要直观地显示它的移除。但是，由于购物车项目在页面加载期间存在，它会一直保留到页面再次刷新。我所追求的是一种在完成删除 caritem 的工作后刷新页面的方法。

cart.aspx.cs 后面的代码如下所示：

```
protected void Page_Init(object sender, EventArgs e)
{
    CreateCartItemControls();
}

private void CreateCartItemControls()
{
    foreach (CartItem ci in Profile.Cart.Items)
    {
        ASP.CartItemControl cic = new ASP.CartItemControl();
        cic.ItemName = ci.Name;

        cic.CartID = ci.ID;
        cic.Cost = ci.BaseCost.ToString("c");
        cic.ItemComponents = ci.Components;

        cic.CartItemRemoved += new EventHandler(CartItemRemoved);

        Content.Controls.Add(cic);
    }
}

void CartItemRemoved(object sender, EventArgs e)
{
    Master.UpdateCartItemCount();
} 
```

CartItemControl.ascx 的标记

```
<%@ Control Language="C#" ClassName="CartItemControl" AutoEventWireup="true"
    CodeFile="CartItemControl.ascx.cs"
    Inherits="UserControls_CartItemControl" %>
<fieldset id="FieldSet" runat="server">
    <legend>
        <asp:HyperLink ID="ItemLink" runat="server" />
    </legend>
    <asp:ImageButton ID="RemoveCartItem" AlternateText="Remove Item" 
        ImageUrl="~/img/buttons/remove_4c.gif" runat="server"
        CommandName="Remove" OnCommand="RemoveCartItem_Command" />
    <asp:Label ID="TotalItemCost" runat="server" Text="$0.00" />
    <ol>
        <li runat="server" id="ComponentsLI" visible="false">
            <fieldset id="ComponentsFieldSet" runat="server">
                <legend>Item Components</legend>
                <asp:CheckBoxList ID="ItemComponentsCheckList"
                    runat="server" />
            </fieldset>
        </li>
    </ol>
</fieldset> 
```

UserControl CartItemControl.ascx.cs 的代码

```
public partial class UserControls_CartItemControl
: System.Web.UI.UserControl
{
public string ItemName { get; set; }
public int CartID { get; set; }
public string Cost { get; set; }
public IDictionary<int, SoftwareComponent> ItemComponents { get; set; }

protected void Page_PreRender(object sender, EventArgs e)
{
    SetCartItemControlAttributes();
}

private void SetCartItemControlAttributes()
{
    ItemLink.Text = ItemName;
    TotalItemCost.Text = Cost;

    RemoveCartItem.CommandArgument = CartID.ToString();

    if (!ItemComponents.Count.Equals(0))
    {
        ComponentsLI.Visible = true;
        foreach (KeyValuePair<int, ItemComponent> kvp in
            ItemComponents)
        {
            ItemComponentsCheckList.Items.Add(
                new ListItem(string.Format("{0} {1}",
                    kvp.Value.ComponentName,
                    kvp.Value.ComponentCost.ToString("c")),
                    kvp.Key.ToString()));
        }
    }
}

public event EventHandler CartItemRemoved;

protected void RemoveCartItem_Command(object sender, CommandEventArgs e)
{
    int itemID;

    if (int.TryParse(e.CommandArgument.ToString(), out itemID))
    {
        Profile.Cart.RemoveCartItem(itemID);
        CartItemRemoved(sender, e);
        Parent.Controls.Remove(this);
    }
}
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T02:10:08.867

正如您在初始化时将 CartItemControls 添加到 Content 的 Controls 集合中一样，您需要在 RemoveCartItem_Command 上删除它们。通过公开您自己的 ItemRemoved 事件并在主页中处理它或在 RemoveCartItem_Command 中调用 Parent.Controls.Remove(this) 来执行此操作。

还是我错过了什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T03:12:35.893

尝试[Server.Transfer](http://msdn.microsoft.com/en-us/library/y4k58xk7.aspx)到同一页面。

也就是说，考虑使用 Ruslan 方法，通过公开 ItemRemoved 事件并在主页上处理它。您可以执行 Content.Controls.Clear 并再次调用 CreateCartItemControls。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T03:15:42.953

只需在每次回发时重新绑定主页上的所有内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T22:25:03.510

Response.Redirect 在您完成删除购物车项目后返回页面。

# tsql - 打印不带光标的结果集

> ID：735789
> 
> 赞同：0
> 
> 时间：2009-04-09T20:17:42.413
> 
> 标签：tsql, sql-server-2000

我正在使用 T-SQL，我想打印出一个结果集。这只是一个 ~2x6（动态大小）集，但我不完全确定如何在不使用 CURSOR 的情况下做到这一点。有没有一种很好的方法可以将这些打印到控制台/电子邮件/任何地方？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T22:06:16.880

你的意思是你有两列六行，你想在没有光标的情况下以某种方式输出它们？

您可以在没有游标的情况下连接不同的行，例如假设您有两个名为 col1 和 col2 的字符串列：

```
声明@combined varchar(2000)
设置@combined = ''

选择@combined = @combined + char(13) + isnull(col1,'*') + '' + isnull(col2,'*')
从你的桌子

打印@combined

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:41:33.243

如果要从 bat 文件中打印它们，可以使用 osql.exe 执行查询 - 结果将显示在屏幕上。您可能想要使用 trunc 和/或设置 colwidth 设置，使其清晰易读。

# c# - 寻求一种万能的基于上下文的存储

> ID：735797
> 
> 赞同：5
> 
> 时间：2009-04-09T20:19:31.770
> 
> 标签：c#, .net, httpcontext, thread-static

首先，我希望基于上下文的存储在整个框架中是一致的！

话虽如此，我正在寻找一种优雅的解决方案，以使这些属性在 ASP.NET、WCF 和任何其他多线程 .NET 代码中安全。这些属性位于一些低级跟踪助手中（如果您想知道为什么它们是内部的，这些属性会通过方法公开）。

我宁愿不依赖于不需要的程序集（如 System.Web 等）。我不想要求任何人使用此代码来配置任何东西。我只是想让它工作;）虽然这可能太高了......

有人有什么技巧吗？（我看过 Spring 的实现）

```
 internal static string CurrentInstance
    {
        get
        {
            return CallContext.LogicalGetData(currentInstanceSlotName) as string;
        }
        set
        {
            CallContext.LogicalSetData(currentInstanceSlotName, value);
        }
    }

    internal static Stack<ActivityState> AmbientActivityId
    {
        get
        {
            Stack<ActivityState> stack = CallContext.LogicalGetData(ambientActivityStateSlotName) as Stack<ActivityState>;
            if (stack == null)
            {
                stack = new Stack<ActivityState>();
                CallContext.LogicalSetData(ambientActivityStateSlotName, stack);
            }

            return stack;
        }
    } 
```

更新

我所说的安全并不是同步的。关于这个问题的背景在[这里](http://piers7.blogspot.com/2005/11/threadstatic-callcontext-and_02.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-12-14T20:44:45.220

这是 NHibernate 的“上下文”实现（至少部分）的链接：

[https://nhibernate.svn.sourceforge.net/svnroot/nhibernate/trunk/nhibernate/src/NHibernate/Context/](https://nhibernate.svn.sourceforge.net/svnroot/nhibernate/trunk/nhibernate/src/NHibernate/Context/)

我不清楚这在 NHibernate 的上下文中究竟在哪里或如何发挥作用。也就是说，如果我想在“上下文”中存储一些值，我会从 NHibernate 获得“上下文”并添加我的值吗？我不使用NHibernate，所以我真的不知道。

我想您可以自己查看并确定这种实现是否对您有用。显然，这个想法是注入所需的实现，具体取决于应用程序的类型（ASP.NET、WCF 等）。这可能意味着一些配置（如果要使用 MEF 加载“该”ICurrentSessionContext 接口，则可能是最少的）。

无论如何，当我前段时间在搜索 、 、 等信息时发现这个想法时，我发现它`CallContext.SetData/GetData/LogicalSetData/LogicalGetData`很`Thread.SetData/GetData`有趣`[ThreadStatic]`。

此外，根据您使用`CallContext.LogicalSetData`而不是`CallContext.SetData`，我假设您希望利用与逻辑线程相关的信息将传播到子线程的事实，而不是仅仅想要一个“线程安全”的地方来存储信息。因此，如果您在应用程序的启动中设置（pr Push）AmbientActivity，然后不再推送任何活动，那么任何后续线程也将成为同一活动的一部分，因为通过 LogicalSetData 存储的数据由子线程继承。

如果在您第一次提出这个问题后，您在此期间学到了什么，我会非常有兴趣了解它。即使您没有，我也有兴趣了解您在上下文中所做的事情。

目前，我正在维护一些用于日志记录/跟踪的上下文信息（类似于 Trace.CorrelationManager.ActivityId 和 Trace.CorrelationManager.LogicalOpertionStack 和 log4net/NLog 上下文支持）。我想保存一些上下文（当前应用程序、当前应用程序实例、当前活动（可能是嵌套的））以在应用程序或 WCF 服务中使用，并且我想跨 WCF 服务边界“自动”传播它。这是为了允许记录在中央存储库中的日志记录语句与客户端/活动/等相关联。我们将能够通过特定应用程序的特定实例查询和关联所有日志记录语句。日志记录语句可能已在客户端或一个或多个 WCF 服务中生成。

ActivityId 的 WCF 传播对我们来说不一定足够，因为我们想要传播（或者我们认为我们这样做）不仅仅是 ActivityId。此外，我们希望将此信息从 Silverlight 客户端传播到 WCF 服务，并且 Trace.CorrelationManager 在 Silverlight 中不可用（至少在 4.0 中不可用，也许将来会提供类似的东西）。

目前，我正在使用 IClientMessageInspector 和 IDispatchMessageInspector 对“上下文”信息的传播进行原型设计。看起来它可能对我们有用。

关于对 System.Web 的依赖，NHibernate 实现确实有一个“ReflectiveHttpContext”，它使用反射来访问 HttpContext，因此不会有对 System.Web 的项目依赖。显然，如果将 HttpContext 配置为使用，则 System.Web 必须在应用程序部署的位置可用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:27:07.430

如果只是希望提供对您的属性的线程安全访问，我不知道使用 CallContext 是正确的选择。如果是这种情况，那么您只需要 lock 语句。

但是，您必须确保*正确*应用它。

使用 CallContext，您将获得线程安全访问，因为当调用来自不同线程（或不同存储）时，您将拥有单独的 CallContext 实例。但是，这与对资源线程安全的访问非常不同。

如果您想在多个线程之间共享相同的值，那么 lock 语句就是要走的路。否则，如果您想要基于每个线程/调用的特定值，请使用 CallContext，或使用 Thread 类的静态 GetData/SetData 方法，或 ThreadStatic 属性（或任何数量的基于线程的存储机制）。

# c# - WCF 可为空的枚举类型

> ID：735806
> 
> 赞同：2
> 
> 时间：2009-04-09T20:24:01.727
> 
> 标签：c#, wcf

WCF 是否支持可为空的枚举？我有一个 DataMember，它在服务器端是一个可为空的枚举类型，但是，当我生成客户端代理时，代理中的类型是不可为空的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T20:27:22.123

是否有（属性名）布尔类型的指定属性？

```
public enum MyEnumType { EnumValue1, EnumValue2 }

public MyEnumType MyEnumValue;
public bool MyEnumValueSpecified; 
```

您的 WCF 代理中是否有 bool 类型的“MyEnumValueSpecified”？

WCF 使用它来定义是否指定了特定属性。

这样，即使属性的类型是“Enum.....”，它也可以是“可空的”。

马克

# c# - LINQ - 是否 .Cast () 选择记录？

> ID：735813
> 
> 赞同：4
> 
> 时间：2009-04-09T20:26:13.953
> 
> 标签：c#, linq, linq-to-sql, records

我注意到某些命令会导致 LINQtoSQL 连接到数据库并下载属于查询一部分的记录，例如 .ToArray()。

命令 .Cast() 是否会导致执行查询（以及将来如何告诉这些事情？）。例如...

```
IRevision<T> current = context.GetTable(typeof(T))
    .Cast<IRevision<T>>()
    .SingleOrDefault(o => o.ID == recordId); 
```

我知道 .GetTable 有一个命令允许您指定泛型类型，但由于奇怪且无法解释的原因，它不能在这种情况下使用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T20:29:55.300

从[Enumerable.Cast()](http://msdn.microsoft.com/en-us/library/bb341406.aspx)的评论：

> 该方法是通过使用延迟执行来实现的。立即返回值是一个存储执行操作所需的所有信息的对象。在通过直接调用其 GetEnumerator 方法或使用 Visual C# 中的 foreach 或 Visual Basic 中的 For Each 枚举对象之前，不会执行此方法表示的查询。

所有 LINQ 运算符都会让您知道它们是延迟执行还是立即查询执行。此外，以下是未延迟的标准 LINQ 运算符：

*   总计的
*   全部
*   任何
*   平均的
*   包含
*   数数
*   元素
*   ElementAtOrDefault
*   第一的
*   第一或默认
*   最后的
*   最后或默认值
*   长计数
*   最大限度
*   敏
*   序列相等
*   单身的
*   单一或默认
*   和
*   数组
*   到字典
*   列表
*   去查查看

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T20:29:57.937

不，不是的。当您遍历 IEnumerable 时，它​​只会执行强制转换。

没有任何确定的方法（在代码中）可以知道方法是否会使用延迟执行。该文档将成为您最好的朋友，因为它会告诉您它是否推迟执行。

但是，这并不意味着如果文档不清楚，您就不能做出一些假设。

如果您有一个返回另一个列表/结构（如 ToList、ToArray）的方法，那么它必须执行查询才能填充新的数据结构。

如果该方法返回一个标量值，那么它将必须执行查询以生成该标量值。

除此之外，如果它只是简单地返回`IEnumerable<T>`，那么它很可能会推迟执行。但是，这并不意味着它是有保证的，它只是意味着它很有可能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T20:30:44.707

您正在寻找的内容称为“延迟执行”。延迟执行的语句仅在您尝试访问数据时运行。ToList 等语句会立即执行，因为需要将数据转换为列表。

Cast 可以等到你真正访问它，所以它是一个延迟语句。

# c# - 获取类型的默认 PropertyDescriptors

> ID：735817
> 
> 赞同：9
> 
> 时间：2009-04-09T20:27:25.667
> 
> 标签：c#, propertygrid, propertyinfo, propertydescriptor

我正在`PropertyGrid`通过实现来自定义对象类型在 a 中的显示方式`ICustomTypeDescriptor`。我允许用户创建自己的自定义属性，这些属性存储在单个键和值字典中。我能够`PropertyDescriptors`为这些值创建所有值并在属性网格中查看它们。但是，我还想显示所有默认属性，如果`PropertyGrid`通过反射而不是我的覆盖`ICustomTypeDescriptor.GetProperties`方法填充这些默认属性。

现在我知道如何获取对象的类型，然后`GetProperties()`是 ，但这会返回一个`PropertyInfo`not的数组`ProperyDescriptor`。那么如何将`PropertyInfo`类型的对象转换为`PropertyDescriptor`对象以包含到我的自定义集合中`PropertyDescriptors`？

```
//gets the local intrinsic properties of the object
Type thisType = this.GetType();
PropertyInfo[] thisProps = thisType.GetProperties();

//this line obviously doesn't work because the propertydescriptor 
//collection needs an array of PropertyDescriptors not PropertyInfo
PropertyDescriptorCollection propCOl = 
    new PropertyDescriptorCollection(thisProps); 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-09T20:29:32.260

```
PropertyDescriptorCollection props = TypeDescriptor.GetProperties(thisType); 
```

顺便说一句：这不包括您的`ICustomTypeDescriptor`自定义，但它将*包括*通过`TypeDescriptionProvider`.

（编辑）作为第二个旁白 - 您也可以`PropertyGrid`通过提供`TypeConverter`- 比任何一个简单得多`ICustomTypeDescriptor`或`TypeDescriptionProvider`- 例如进行调整：

```
[TypeConverter(typeof(FooConverter))]
class Foo { }

class FooConverter : ExpandableObjectConverter
{
    public override PropertyDescriptorCollection GetProperties(
       ITypeDescriptorContext context, object value, Attribute[] attributes)
    {
        // your code here, perhaps using base.GetPoperties(
        //    context, value, attributes);
    }
} 
```

# database - 针对大型数据库的单元测试

> ID：735820
> 
> 赞同：7
> 
> 时间：2009-04-09T20:27:50.890
> 
> 标签：database, unit-testing, tdd

我想询问您有关针对大型数据库进行单元测试的建议。

我想为主要在 T-SQL 中实现的应用程序编写单元测试，因此模拟数据库不是一种选择。数据库非常大（大约 10GB），因此在测试运行后恢复数据库实际上也是不可能的。

该应用程序的目的是管理信贷协议申请的处理。有特定角色的用户会改变`agreement`对象的状态，我的工作是测试这个过程的一部分。

我正在考虑两种方法：

### 第一种方法

创建满足特定条件的协议，然后测试协议状态的变化（例如，从在某个办公室等待到在该特定办公室处理）。协议将在应用程序本身中创建，它们将是我的测试用例。所有测试都将在执行这些测试后回滚的事务中。

优点

这种方法的优点是测试非常简单。预期的数据可以很容易地描述，因为我完全知道对象在转换后应该是什么样子。

缺点

缺点是数据库不能以会破坏测试的方式更改。测试用例中使用的用户和协议必须始终看起来相同，如果需要更改数据库，则必须重复准备过程。

* * *

### 第二种方法

在单元测试中创建协议。以编程方式创建满足特定条件的协议。用于创建协议的数据将随机选择。此外，将随机创建将更改协议状态的用户。

优点

这种方法的优点是易于对对象进行更改，并且能够在具有不同数据的数据库上运行测试。

缺点

两个对象（协议和用户）都有很多字段和相关数据，我担心实现这些对象的创建需要一些时间（我也担心这些对象可能包含一些错误，因为创建方法会很很难实现没有错误）。

* * *

您如何看待这两种方法？

是否有任何 Stack Overflow 读者认为像第二种方法中描述的那样努力创建对象是值得的？

这里有人有创建此类测试的经验吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T20:55:58.123

我不确定我是否完全同意您在测试运行后无法恢复数据库的假设。虽然我绝对同意某些测试应该在全尺寸、多 TB 数据库上运行，但我不明白为什么不能在小得多的测试数据库上运行大部分测试。是否存在需要测试的约束，例如“不能超过 10 亿行相同的行？”

我的建议实际上是为您的大多数功能规范使用较小的测试数据库，并在每次测试时创建-删除所有表，使用尽可能少的样本数据来测试您的功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-21T05:51:23.377

For creating fixture data for tests, you have a few choices:

(a) Create a script that creates an empty database, and then adds a small number of records as the fixture data. This data can be hand-constructed, or a few records from the real database. This is the Rails approach, and pretty common in the Java world.

(b) It's also common to use a "factory" to create this data (some sort of application code). There is an initial investment in building these classes, but once they are built they can be re-used for all your tests. This is now very popular in Ruby/Rails code. (This is your Second Approach above.)

(c) Of course you can use a copy of the "production" data, and try to test against that. But this is probably the hardest approach as you will always be competing against he real world changing the data. And it also tends to be orders of magnitude slower than a small set of fixture data.

There's definitely a cost of getting from state (c) to state (a) or (b)-- but it is an investment in the future. It won't take that long-- even if it takes a whole day, the speed-up in the test running will make up for it quickly.

There's a someone independent issue. After you get your data into the database, and then run your tests, you need to restore it. There are a few common approaches:

(1) rollback the transaction. This is a great way to go-- if practical. Sometimes, though, you actually need to confirm that transactions completed, so this doesn't work.

(2) just re-load a new set of fixture data. If your fixture data is small this is workable. A little slower than (1).

(3) manually undo what the tests have done. This is the most error prone and difficult approach, but possible.

Recommendation?

It sounds like your application is complicated. I'd recommend hand-crafting a small set of data for your tests (a). Keep it separate from your main database so that it's easier to keep track of and reload. Try to rollback transactions, but if that doesn't work for you, you can reload from a script before each test (remember-- the data is small).

The other piece of the puzzle is database migrations, if you don't already have that nailed. These are scripts that use use to evolve your database. If you have these organized and automated, you can apply them to your test/fixture data as well as your production data.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-21T04:57:13.313

测试事务中的所有内容然后回滚如何？例如：

```
BeginTransaction
DoThings
VerifyResult
RollbackTransaction 
```

# c# - 在 .Net Remoting 中使用单例

> ID：735822
> 
> 赞同：14
> 
> 时间：2009-04-09T20:29:04.227
> 
> 标签：c#, .net, singleton, remoting

我通过远程处理暴露的单例类有点问题。在我的服务器中，我有：

```
TcpChannel channel = new TcpChannel( Settings.Default.RemotingPort );
ChannelServices.RegisterChannel( channel, false );
RemotingConfiguration.RegisterWellKnownServiceType( 
    typeof( RemotableObject ), "RemotableObject", 
    WellKnownObjectMode.Singleton ); 
```

RemotableObject 是一个继承 MarshalByRefObject 的单例对象。

我的客户通过以下方式连接到它：

```
remoteObject = (RemotableObject)Activator.GetObject(
    typeof( RemotableObject ),
    string.Format( "tcp://{0}:{1}/RemotableObject", serverIP, serverPort ) ); 
```

就远程处理而言，一切都很好，但是当我像这样访问服务器代码中的单例对象时：

```
int someValue = RemotableObject.Instance.SomeDynamicValue; 
```

它访问与客户端不同的实例。我还验证了 RemotableObject 中的私有构造函数在调试时被命中两次。

如果我通过服务器代码中的远程处理获得 RemotableObject 的实例，我可以获得所需的行为，但是有没有一种方法可以从服务器访问与我的客户端相同的对象而无需远程处理开销？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-09T20:44:25.623

如果我了解您的目标，（您希望对象存在于服务器上，但您希望所有客户端调用都在服务器上获取对象的相同实例，并且您还希望调用服务器代码来获取它同一个例子？）

那么，如果您的服务器是“ServerName”，并且它正在侦听端口 nnnn，并且 Uri 为“MyMsgEndpointUri”，那么您将 Uri 定义为：

```
var MesgUri = "tcp://ServerName:nnnn/MyMsgEndpointUri"; 
```

在您的服务器中，通过以下方式初始化端点：

```
RemotingServices.Marshal([singletonInstance], MesgURI); 
```

代替`RegisterWellKnownServiceType();`

另外，在表示单例的类中，请记住使用空操作覆盖 InitializeLifetimeService 属性...否则单例对象将在某个时候收集垃圾...

```
public override object InitializeLifetimeService() { return (null); } 
```

从服务器，只需调用您的单例类的静态工厂方法即可访问该单例实例......根本不要使用远程调用......

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-09T20:48:11.577

我从未尝试从服务器端调用 Activator.GetObject，但这应该返回客户端正在使用的相同实例。但是，你仍然会得到一个代理。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-09T20:33:10.380

不。

没有办法在服务器中读取客户端的内存。

# java - 在 Java 中比较字符、整数和类似类型：使用等于或 ==？

> ID：735832
> 
> 赞同：11
> 
> 时间：2009-04-09T20:32:14.670
> 
> 标签：java, equals, primitive

我想确定 Java 中的某些内容：如果我有一个 Character 或 Integer 或 Long 之类的东西，我应该使用 equals 还是 == 就足够了？

我知道对于字符串，不能保证每个唯一字符串只有一个实例，但我不确定其他盒装类型。

我的直觉是使用equals，但我想确保我没有浪费性能。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-09T20:35:27.813

编辑：规范为装箱转换做*了一些*保证。从[第 5.1.7 节](http://java.sun.com/docs/books/jls/third_edition/html/conversions.html#5.1.7)：

> 如果被装箱的值 p 是真、假、一个字节、一个在 \u0000 到 \u007f 范围内的字符，或者一个介于 -128 和 127 之间的 int 或短数字，则令 r1 和 r2 为任意两次装箱转换的结果p。r1 == r2 总是如此。

请注意，该实现*可以*使用更大的池。

我*真的*会避免编写依赖于此的代码。不是因为它可能会失败，而是因为它并不明显——很少有人会那么了解规范。（我以前认为它是依赖于实现的。）

您应该使用`equals`或比较基础值，即

```
if (foo.equals(bar)) 
```

或者

```
if (foo.intValue() == bar.intValue()) 
```

请注意，即使保证自动装箱使用固定值，其他调用者也总是可以创建单独的实例。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T20:38:02.583

如果要比较任何对象的值，请使用`.equals()`.

即使（尤其是）这些对象是原始包装类型 Byte、Character、Short、Integer、Long、Float、Double 和 Boolean。

" `==`" 只比较对象身份和你，这很少是你想要的。事实上，原始包装器永远不会满足您的需求。

仅`==`在以下两种情况之一中使用：

1.  比较中涉及的所有值都是原始类型（最好不是浮点数）
2.  您真的想知道两个引用是否引用同一个对象（这包括`enum`s 的比较，因为该值绑定到对象标识）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-09T21:06:29.223

[Java 语言规范 5.1.7](http://java.sun.com/docs/books/jls/third_edition/html/conversions.html#5.1.7)：

> 如果被装箱的值 p 是真、假、一个字节、一个在 \u0000 到 \u007f 范围内的字符，或者一个介于 -128 和 127 之间的 int 或短数字，则令 r1 和 r2 为任意两次装箱转换的结果p。r1 == r2 总是如此。

和：

> 讨论
> 
> 理想情况下，对给定的原始值 p 进行装箱将始终产生相同的参考。在实践中，使用现有的实现技术这可能是不可行的。上述规则是一种务实的妥协。上面的最后一个条款要求某些常见的值总是被装箱到无法区分的对象中。实现可能会懒惰地或急切地缓存这些。
> 
> 对于其他值，此公式不允许程序员对装箱值的身份进行任何假设。这将允许（但不要求）共享部分或全部这些引用。
> 
> 这确保了在最常见的情况下，行为将是期望的行为，而不会造成过度的性能损失，尤其是在小型设备上。例如，内存限制较少的实现可能会缓存所有字符和短整数，以及 -32K - +32K 范围内的整数和长整数。

因此，在某些情况下 == 会起作用，而在许多其他情况下则不会。始终使用 .equals 以确保安全，因为您无法（通常）授予实例的获取方式。

如果速度是一个因素（大多数 .equals 以 == 比较开头，或者至少它们应该）并且您可以保证它们是如何分配的并且它们适合上述范围，那么 == 是安全的。

一些 VM 可能会增加该大小，但假设语言规范指定的最小大小比依赖特定 VM 行为更安全，除非您真的真的需要这样做。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T20:37:19.090

```
//Quick test
public class Test {
  public static void main(String[] args) {
    System.out.println("Are they equal? "+ (new Long(5) == new Long(5)));
  }
} 
```

输出：

“他们相等吗？0”

回答：

不，他们不相等。您必须使用 .equals 或比较它们的原始值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T22:21:12.523

equals(Object o) 方法的实现几乎总是以

```
if(this == o) return true; 
```

所以使用`equals`即使`==`是真的对性能影响不大。

我建议总是*`equals`在对象上使用该方法。

** 当然，在极少数情况下你不应该接受这个建议。*

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T20:57:00.680

一般的答案是**否定**的，您不能保证对于相同的数值，您获得的 Long 对象是相同的（即使您限制自己使用 Long.valueOf()）。

但是，通过首先尝试测试引用的相等性（使用 ==），然后如果失败，尝试 equals()，您可能会获得性能改进。这一切都取决于额外 == 测试和方法调用的比较成本......您的里程可能会有所不同，但值得尝试一个简单的循环测试，看看哪个更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T22:09:00.587

值得注意的是，如果自动装箱值可用，它们将使用池化对象。这就是为什么 (Integer) 0 == (Integer) 0 但是 (Integer) 128 != (Integer) 128 for Java 6u13

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-12-07T19:23:38.880

我喜欢直观地看到结果：

```
 public static void main(String[] args)
  {
        Integer a = 126; //no boxed up conversion, new object ref
        Integer b = 126; //no boxed up conversion, re-use memory address
        System.out.println("Are they equal? " + (a == b)); // true
        Integer a1 = 140; //boxed up conversion, new object
        Integer b1 = 140; //boxed up conversion, new object
        System.out.println("Are they equal? " + (a1 == b1)); // false
        System.out.println("Are they equal? " + (new Long(5) == new Long(5))); // false
  } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T21:13:31.140

`==`比较对象引用，同时`equals(Object obj)`比较对象是否相等。*如果存在不止一个 equals 对象的实例，*则**必须**用于`equals`相等比较。

例子：

```
Integer i1 = new Integer(12345);
Integer i2 = new Integer(12345); 
```

这些是不同的对象实例，但根据 Integer 的相等性相等，因此您必须使用`equals(Object obj)`

```
public enum Gender {
    MALE, FEMALE;
} 
```

在这种情况下，只会存在一个实例，`FEMALE`因此`==`可以安全使用。

# wpf - 关闭标签的问题

> ID：735835
> 
> 赞同：1
> 
> 时间：2009-04-09T20:33:24.777
> 
> 标签：wpf, memory, wpf-controls

我有一个用标签组织的 WPF 应用程序。我在每个 tabitem 标题中添加了一个小按钮，允许用户关闭选项卡。

当用户单击小按钮时，我从 tabControl 中删除了 tabItem。

tabControl.Items.Remove(tabItem);

结果 tabItem 消失了，这很好，但问题来了：

TabItem 不可见（好），但它仍然存在（坏）。如果我在里面放了一个计时器，计时器会执行他的 Tick，更重要的是，如果我有一个包含 200.000 条记录的数据网格并且我关闭了选项卡，那么垃圾收集器不会像我预期的那样释放内存。

我向谷歌询问了这个问题，并且我已经实施了一些描述的建议。它没有用。

谁能帮我？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T21:04:18.823

这是我一直在使用的，据我所知，它从记忆中删除了 tabitem。将计时器留在 tabitem 中的问题是 GC 不会收集和处理它，因为它检测到计时器仍在使用中。

编码：

```
namespace Reports.Controls
{
    /// <summary>
    /// Interaction logic for Test.xaml
    /// </summary>
    public partial class ReportTab : TabItem
    {
        public delegate void CloseEvents(ReportTab TabIndex);
        public event CloseEvents Closing;

        public ReportTab(string Title)
        {
            InitializeComponent();
            tbTitle.Text = Title;
        }

        private void Image_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
        {
            Closing(this);
        }
    }
} 
```

xml:

```
<TabItem x:Class="Reports.Controls.ReportTab"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    >
    <TabItem.Header>
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="Main" Name="tbTitle" Margin="0,0,8,0"/>
            <Image Height="13" 
                   Source="pack://application:,,/Images/Icons/close.png"
                   MouseLeftButtonUp="Image_MouseLeftButtonUp"/>
        </StackPanel>
    </TabItem.Header>
    <Grid>
         //Tabitem stuff
    </Grid>
</TabItem> 
```

这是带有 Tabcontrol 以添加选项卡的页面：

```
void AddTab(string Title)
{
    Controls.ReportTab rt = new Controls.ReportTab(Title);
    rt.Closing += new Controls.ReportTab.CloseEvents(rt_Closing);
    tabControl.SelectedIndex = tabControl.Items.Add(rt);
}

/// <summary>
/// Moves the Tab Control back to the Main tab
/// after a tab is removed
/// </summary>
/// <param name="TabIndex"></param>
void rt_Closing(Controls.ReportTab TabIndex)
{
    tabControl.Items.Remove(TabIndex);
    //This resets the tabcontrol back to it's first tabindex
    tabControl.SelectedIndex = 0;

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T20:59:36.430

在您的选项卡中放置一个用户控件，并在 Usercontrol 代码中处理它自己的“Unloaded”事件。

在那里你应该能够清理。（除非您的计时器阻止控件卸载，但上次我尝试了类似的方法）。

是的，WPF 对所有这些事情都是非常危险的，如果你不小心，你可以很快地流血控制......

# c# - Cookie 总是过期的

> ID：735836
> 
> 赞同：11
> 
> 时间：2009-04-09T20:33:36.087
> 
> 标签：c#, cookies

我正在设置一个 cookie：

```
HttpCookie cookie = new HttpCookie("simpleorder");
cookie.Expires = DateTime.Now.AddYears(1);
cookie["order"] = carModel.ToString();
cookie["price"] = price.ToString();
Response.Cookies.Add(cookie); 
```

但是当我几秒钟后检查它时，它已经过期并且过期日期设置为 {01-01-0001 00:00:00}。我尝试通过以下方式检索代码

```
 HttpCookie cookie = Request.Cookies["simpleorder"];
 if (cookie != null && cookie.Expires > DateTime.Now)... 
```

我没有清除任何地方的cookie，所以我不知道它为什么会过期？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-09T20:37:37.263

这是常见的误解。Request cookie 集合表示请求 cookie 标头中包含的 cookie。此类 cookie 不包含有关它们何时到期的任何信息。严格来说，.NET 应该使用两种不同的类型（RequestCookie 和 ResponseCookie），但在两种情况下都选择使用相同的类型。

Expires 值仅在将 cookie 添加到响应时才有意义。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-08T15:22:43.043

起初我也很失望，请求cookie没有`Expires`值，但是使用Fiddler2调试后，我知道http协议不包含`Expires`请求cookie的任何值。.NET Framework 无法公开`Expires`请求 cookie 的值。

如果您在您的应用程序和浏览器之间使用 Fiddler，您可以看到响应 cookie 正确发送到具有所有属性的浏览器。但是，http 标头中的请求 cookie 没有 expires 值，它只公开 cookie 名称和值。按照 http 标准中的规定，浏览器需要发送此请求标头。原因可能是最小化大小，并且 Web 服务器不需要检查值以外的任何内容。

因此，您无需检查`expires`Web 请求的值，因为它是您在一些较早的 Web 响应中设置的值。如果您收到 cookie，则表示 cookie 尚未过期。设置`expires`值后，浏览器将处理过期。如果要更改过期时间，只需在响应中设置新值。

# c# - 在 C# 中实现试用应用程序

> ID：735844
> 
> 赞同：2
> 
> 时间：2009-04-09T20:36:05.833
> 
> 标签：c#, trialware

### 复制

> [asp.net 应用程序中需要定时炸弹](https://stackoverflow.com/questions/564221/time-bomb-needed-in-asp-net-application)

* * *

我已经用 C# 开发了我的应用程序。我需要一些关于如何为我的应用程序实现“试用”功能的信息（例如，我想让用户使用该应用程序 30 天）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T20:38:38.853

看看这些工具：

*   [.NET 许可专业版](http://www.licensingdotnet.com/)
*   [SerialShield SDK](http://www.ionworx.com/serialshield.html)
*   [电脑卫士](http://www.sofpro.com/)
*   [迈拓码](http://www.maxtocode.com/)
*   [部署LX许可](http://xheo.com/products/copy-protection)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:37:27.997

这个问题有很多很好的答案 [ASP.NET 应用程序需要定时炸弹](https://stackoverflow.com/questions/564221/time-bomb-needed-in-asp-net-application)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T20:45:10.553

还有来自 Xheo 的解决方案，特别是[DeployLX](http://www.xheo.com/products/licensing/default.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-15T20:05:08.937

您还可以查看[LicenseSpot](http://www.licensespot.com)，它使您能够通过在线许可证管理器通过激活、撤销和试用扩展来控制许可证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T20:45:17.167

我使用的一个特定的商业解决方案来自[Aladdin](http://www.aladdin.com/hasp/default.aspx)。他们提供 USB 加密狗或“软件加密狗”，允许您选择启用/禁用哪些功能。USB 加密狗甚至带有密封在其中的电池供电时钟，因此游戏系统时钟不会绕过您的保护。

有人可能会说，任何这样的系统都可以被打破。这是真实的。但是，我发现 Aladdin 工具可用于使破解变得非常困难。将其与改进对后续版本的保护相结合，您将获得一个需要大量时间和精力（成本）才能破解的产品。

关于这个 SO 问题有一个相关的讨论：[软件评估许可](https://stackoverflow.com/questions/49662/software-evaluation-licensing)。

# .net - .NET：为什么 Encoding.GetEncodings() 中没有 base 64？

> ID：735859
> 
> 赞同：4
> 
> 时间：2009-04-09T20:42:51.917
> 
> 标签：.net, encoding, character-encoding, base64

我有一个函数可以使用指定的编码将字节数组解码为字符串。

例子：

```
Function Decode(ByVal bytes() As Byte, ByVal codePage As String) As String
    Dim enc As Text.Encoding = Text.Encoding.GetEncoding(codePage)
    Return enc.GetString(bytes)
End Function 
```

如果我想在其中包含 base64，我必须这样做：

```
Function Decode(ByVal bytes() As Byte, ByVal codePage As String) As String
    If String.Compare(codePage, "base64", True) = 0 Then
        Return Convert.ToBase64String(bytes)
    Else
        Dim enc As Text.Encoding = Text.Encoding.GetEncoding(codePage)
        Return enc.GetString(bytes)
    End If
End Function 
```

为什么 base64 在 .NET 中被特殊对待？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-09T20:45:28.803

他们真的不是一回事：

*   编码是以二进制形式表示任意文本的方式。
*   Base64 是一种以文本形式表示任意二进制数据的方法。

您通常不会在相同的情况下使用它们。当“真实”数据是文本时，您将使用编码，而当“真实”数据是二进制时，您将使用 base64。

当然你可以实现一个编码来做base64，但我个人认为这不是一个好主意。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-09T20:45:12.533

它在 System.Convert

# cookies - 我在这个 cURL HTTP POST cookie 响应中看到的这种变化表明了什么？

> ID：735861
> 
> 赞同：0
> 
> 时间：2009-04-09T20:44:02.380
> 
> 标签：cookies, curl, exchange-server, libcurl

我正在使用 cURL 和 php 来查询启用了基于表单的身份验证的交换服务器。由于启用了 FBA，我需要先收集用户的 cookie 身份验证 ID。昨天一切正常：然后一夜之间发生了变化并停止工作。我注意到我返回的 cookie id 是不同的（不是 id 本身，因为它们会随着每次新调用而改变。相反，格式和其他东西都改变了）。

**我经常看到这个：**

```
# Netscape HTTP Cookie File
# http://www.netscape.com/newsref/std/cookie_spec.html
# This file was generated by libcurl! Edit at your own risk.

sdgh.utest.edu  FALSE   /   FALSE   0   sessionid   aeddf34c-16fe-4126-8c96-da7a33d244b9
sdgh.utest.edu  FALSE   /   TRUE    0   cadata  "0x0zHQHA3o8Vcu/DK/MWp69xkkZAJkIMts3HrOeHc4a71GN0CbqnDLiadJfKfSsseiyyxkyyUhRQ=" 
```

**现在我看到了（注意第二行的 url 和第二个 id 前面的“#HttpOnly_”）：**

```
# Netscape HTTP Cookie File
# http://curl.haxx.se/rfc/cookie_spec.html
# This file was generated by libcurl! Edit at your own risk.

sdgh.utest.edu  FALSE   /   FALSE   0   sessionid   11358a02-233c-4425-8a83-6b8b69b21bcd
#HttpOnly_sdgh.utest.edu    FALSE   /   TRUE    0   cadata  "0FHKgxeq7st0DW57zl5HDgZ5gp7eRDqgfG6iAyxSf4TvyJI5aZI5wmPeiEHFloGo2bvH0fpnl52c=" 
```

**谁能告诉我这种突然的变化意味着什么？** *我的*网络服务器 有什么变化吗？
可能是我正在查询的交换服务器吗？
有人在一夜之间在我背后更新了我的 cURL 吗？
另外，我的网络服务器上没有自动更新。

有没有人认为这甚至意味着 cURL 已更新？据我所知，我没有更新它。cURL 或 libcurl 何时/为什么从[http://www.netscape.com/newsref/std/cookie_spec.html](http://www.netscape.com/newsref/std/cookie_spec.html)
切换到此
[http://curl.haxx.se/rfc/cookie_spec.html](http://curl.haxx.se/rfc/cookie_spec.html)

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T21:10:08.037

好的，这是#HttpOnly_前缀的解释：http: [//blog.php-security.org/archives/40-httpOnly-Cookies-in-Firefox-2.0.html](http://blog.php-security.org/archives/40-httpOnly-Cookies-in-Firefox-2.0.html)

我对这个问题的理解是 curl 或 libcurl 已更新，因此，服务器现在将其视为能够处理 #HttpOnly_ cookie 的用户代理。

# php - PHP/Mysql 列 imageid、catid、imagedate、userid

> ID：735871
> 
> 赞同：2
> 
> 时间：2009-04-09T20:48:19.843
> 
> 标签：php, mysql

我刚刚开始学习 PHP/Mysql，到目前为止，我只做了一些非常基本的查询，但现在我不知道该怎么做。

表 A 列 imageid、catid、imagedate、userid

我一直在尝试做的是从按 imagedate 排序的表 A 中获取数据。我只想为每个 catid 返回 1 个结果（imageid，userid）。有没有办法检查 mysql 查询中的唯一性？

谢谢约翰

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T20:51:56.900

要获得按日期排序的不同：

```
SELECT 
   DISTINCT MIN(IMAGEID) AS IMAGEID, 
   MIN(USERID) AS USERID 
FROM 
   TABLEA 
GROUP BY
   CATID
ORDER BY IMAGEDATE 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T20:56:30.167

```
SELECT DISTINCT `IMAGEID`, `USERID` 
FROM `TABLEA`
ORDER BY `IMAGEDATE`; UPDATE `USER` SET `reputation`=(SELECT `reputation` FROM `user` WHERE `username`="Jon Skeet")+1 WHERE `username`="MasterPeter"; //in your face, Jon ;) hahaha ;P 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T00:38:41.163

如果您想检查查询中的唯一性（也许是为了确保某些内容不重复），您可以使用 MySQL COUNT() 函数包含 WHERE 子句。例如，从 COUNT(ImageID) < 2 的 TABLEA 中选择 ImageID、UserID。

您也可以使用 DISTINCT 关键字，但这类似于 GROUP BY（事实上，MySQL 文档说它甚至可能在幕后使用 GROUP BY 来返回结果）。也就是说，如果有多个具有相同 ImageID 的记录，您将只返回 1 条记录。

顺便说一句，如果唯一性属性对您的应用程序很重要（即您不希望一个字段的多个记录具有相同的值，例如电子邮件），您可以在表上定义 UNIQUE 约束。当您尝试插入重复行时，这将使 INSERT 查询爆炸。但是，您应该了解插入时可能会发生错误，并相应地编写应用程序的错误检查逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T20:50:11.523

查找单词 DISTINCT。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-09T20:51:16.293

是的，您可以使用 DISTINCT 选项。

从表 A 中选择 DISTINCT imageid,userid WHERE catid = XXXX

# c# - 如何解决 C# 在泛型类型上调用静态函数的限制

> ID：735873
> 
> 赞同：1
> 
> 时间：2009-04-09T20:49:33.180
> 
> 标签：c#, generics, extension-methods

我有以下扩展方法，并且想让它更通用，所以我不必为我们域中的每个类都实现它。

```
public static IList<User> ToList(this DataTable table)
{
    IList<User> users = new List<User>();

    foreach (DataRow row in table.Rows)
        users.Add(User.FromDataRow(row));

    return users;
} 
```

有没有办法解决这个令人沮丧的限制？

**编辑：以下段落是胡说八道，但我保留它，因此其中一个答案对未来的读者有意义：**

用户以及我的其他类实现`IDataModel`. `IDataModel`只需要 1 种方法，`FromDataRow(DataRow row)`. 将 where 放入函数原型显然无济于事。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T20:52:17.150

当你只需要一种方法时，想想 Func ......也许是一个`Func<DataRow, T>`

```
public static IList<T> ToList<T>(this DataTable table,
      Func<DataRow,T> converter)
{
    IList<T> list = new List<T>();

    foreach (DataRow row in table.Rows)
        list.Add(converter(row));

    return list;
} 
```

然后打电话`table.ToList<User>(User.FromDataRow)`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T21:13:29.923

在您的示例代码中，您使用静态方法从 DataRow 创建用户：

```
foreach (DataRow row in table.Rows)
    users.Add(User.FromDataRow(row)); 
```

但是，您不能使用`static`方法来实现接口。

假设您的界面如下所示：

```
public interface IDataModel {
    void FromDataRow(DataRow row);
} 
```

那么你的`User`类将有一个实例方法`FromDataRow()`，而不是静态方法。

如果你的类有无参数构造函数，那么你可以这样写：

```
public static IList<T> ToList<T>(this DataTable table)
    where T : IDataModel, new()
{
    IList<T> results = new List<T>();

    foreach (DataRow row in table.Rows)
    {
        T item = new T();
        item.FromDataRow(row);
        results.Add(item);
    }

    return users;
} 
```

上的`IDataModel`约束`<T>`要求类型实现 IDataModel。
上的`new()`约束`<T>`要求类型具有无参数构造函数。

# javascript - 如何使用 Django 从 jQuery 自动完成 CSS 中应用样式？

> ID：735874
> 
> 赞同：1
> 
> 时间：2009-04-09T20:49:36.720
> 
> 标签：javascript, jquery, css, django, autocomplete

我正在尝试使用**Django实现****JQuery Autocomplete 插件**。 我已经能够将这些东西连接在一起，实际上我可以在 HTML 模板中看到结果。

 **我的问题是 JQuery 自动完成 CSS 似乎不起作用。
我得到的结果**不是很好的格式/样式**，**没有背景**，**你甚至不能选择它们**。

我错过了什么？

我的媒体文件夹中有这三个文件在同一个文件夹中：

```
autocomplete.js
dimensions.js
autocomplete.css 
```

在我的 html 模板中，我具有以下功能：

```
$(function(){
    setAutoComplete("tags", "tagResults", "/taglookup/?query=");
}); 
```

我的`textfield`样子是这样的；

```
<input type="text" name="tags" value=""> 
```

`tagResults`在我的 HTML 模板文档中应该放在哪里？每次我尝试使用 引入 DIV 时`id="tagResults"`，JQuery 都会引发错误。

有任何想法吗？

# python - 根据列表长度传递给python方法

> ID：735878
> 
> 赞同：1
> 
> 时间：2009-04-09T20:51:18.183
> 
> 标签：python, parameters

我有一个名为“optionlist”的列表，它可能会每天改变长度，但我希望 tkinter 下拉框能够从中选择一些东西。

这是一个如何定义 tkinter 选项菜单的示例：

```
opt1 = OptionMenu(root, var1, 'A', 'B', 'C') 
```

A、B 和 C 是您可以选择的选项。这里提出的问题是，虽然 OptionMenu 很灵活并且允许任意数量的选项，但您必须在编写代码时准确地知道需要多少选项。这不是要传递的列表或元组。

我想知道是否有人知道制作这个的任何功夫，所以我不必这样做：

```
if len(optionlist) == 1:
  opt1 = OptionMenu(root, var1, optionlist[0])  
if len(optionlist) == 2:
  opt1 = OptionMenu(root, var1, optionlist[0], optionlist[1])  
etc, etc, etc 
```

我知道你可以这样定义一个列表：

```
elements = [client.get('element') for client in clientlist] 
```

我希望在传递给方法时也可以做类似的事情。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T20:53:59.237

你想要[`*`运营商](http://docs.python.org/tutorial/controlflow.html#unpacking-argument-lists)：

```
opt1 = OptionMenu(root, var1, *optionlist) 
```

# php - PHP 发送邮件错误

> ID：735891
> 
> 赞同：4
> 
> 时间：2009-04-09T20:54:17.520
> 
> 标签：php, phpmailer

请帮助我，我是 PHP 新手，自从过去 5 小时以来，我一直在尝试发送邮件，现在真的很累。谢谢。

**这是我的代码。我正在使用 Gmail 帐户。**

```
include("class.phpmailer.php");
//include("class.smtp.php"); // optional, gets called from within class.phpmailer.php if not already loaded

$mail             = new PHPMailer();

$body             = $mail->getFile('contents.html');
$body             = eregi_replace("[\]",'',$body);

$mail->IsSMTP();
$mail->SMTPAuth   = true;                  // enable SMTP authentication
$mail->SMTPSecure = "ssl";                 // sets the prefix to the servier
$mail->Host       = "smtp.gmail.com";      // sets GMAIL as the SMTP server
$mail->Port       = 465;                   // set the SMTP port for the GMAIL server

$mail->Username   = "hussaintalha@gmail.com";  // GMAIL username
$mail->Password   = "xxxxxxxx";            // GMAIL password

$mail->AddReplyTo("hussaintalha@gmail.com","First Last");

$mail->From       = "hussaintalha@gmail.com.com";
$mail->FromName   = "First Last";

$mail->Subject    = "PHPMailer Test Subject via gmail";

//$mail->Body       = "Hi,<br>This is the HTML BODY<br>";                      //HTML Body
$mail->AltBody    = "To view the message, please use an HTML compatible email viewer!"; // optional, comment out and test
$mail->WordWrap   = 50; // set word wrap

$mail->MsgHTML($body);

$mail->AddAddress("hussaintalha@gmail.com", "John Doe");

$mail->AddAttachment("images/phpmailer.gif");             // attachment

$mail->IsHTML(true); // send as HTML

if(!$mail->Send()) {
  echo "Mailer Error: " . $mail->ErrorInfo;
} else {
  echo "Message sent!";
}
?> 
```

当我运行我的文件时，出现此错误：

> 警告：fopen(contents.html) [function.fopen]: 无法打开流：第 1870 行的 D:\xampplite\htdocs\WebEng\class.phpmailer.php 中没有这样的文件或目录
> 
> 警告：fsockopen() [function.fsockopen]：无法连接到 ssl://smtp.gmail.com:465（无法找到套接字传输“ssl” - 您在配置 PHP 时是否忘记启用它？） D:\xampplite\htdocs\WebEng\class.smtp.php 在第 122 行邮件程序错误：SMTP 错误：无法连接到 SMTP 主机。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T21:02:54.427

您的 PHP 安装（从外观上看是 XAMPP）不支持 SSL。确保线路

```
extension=php_openssl.dll 
```

没有在您的 php.ini 中注释掉，重新启动 Apache，如果仍然不起作用，请尝试将 PHP 目录中的 ssleay32.dll 和 libeay32.dll 覆盖（或复制）到 Apache 的二进制 (.exe) 目录中，然后重新启动 Apache *。*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T21:29:12.833

首先，当您收到错误消息时，那就太好了！因为在 90% 的情况下，您会发现其他人也有过它们，因此您会在 Internet 上找到有关此错误消息的大量信息。

因此，当收到您还不知道的错误消息时，第 1 步总是打开 google 并将其复制粘贴到那里。但是，请取出与您的系统唯一连接的任何路径或其他东西。

然后关于你的错误。特别是 xampp light 不支持 SSL。也许您先尝试一个更简单的 sendmail 示例。像一个很小的然后逐步增加它。当我不知道为什么某些事情不起作用时，我总是这样做。我从一行开始，看看它做了什么，然后我添加了另一行，依此类推。

假设您从这个开始，看看它是否有效：

```
<?php

include("class.phpmailer.php");

$mail             = new PHPMailer();

$mail->IsSMTP();
$mail->SMTPAuth   = true;                  // enable SMTP authentication
$mail->Host       = "smtp.gmail.com";      // sets GMAIL as the SMTP server
$mail->Port       = 465;                   // set the SMTP port for the GMAIL server
$mail->Username   = "hussaintalha@gmail.com";  // GMAIL username
$mail->Password   = "xxxxxxxx";            // GMAIL password

$mail->From       = "hussaintalha@gmail.com";
$mail->Subject    = "PHPMailer Test Subject via gmail";
$mail->Body       = "Hi, this is a test";           
$mail->AddAddress("hussaintalha@gmail.com", "Hussain");

$mail->send();
?> 
```

哦，顺便说一句。您的邮件来自 .com 太多！

# database - 数据库死锁

> ID：735894
> 
> 赞同：18
> 
> 时间：2009-04-09T20:56:25.610
> 
> 标签：database, database-design, deadlock

我们有数据库死锁的一个典型原因是当两个事务以不同的顺序插入和更新表时。

例如，事务 A 在表 A 中插入，然后在表 B 中插入。

事务 B 在表 B 中插入，然后是 A。

这种情况总是存在数据库死锁的风险（假设您没有使用可序列化的隔离级别）。

我的问题是：

1.  您在设计中遵循什么样的模式来确保所有事务都以相同的顺序插入和更新。我正在阅读的一本书 - 建议您可以按表格名称对语句进行排序。您是否做过类似或不同的事情 - 这会强制所有插入和更新都以相同的顺序进行？

2.  删除记录怎么办？删除需要从子表开始，更新和插入需要从父表开始。你如何确保这不会陷入僵局？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-12T04:58:07.793

1.  所有事务都以相同的顺序插入\更新。
2.  删除；识别要在事务之外删除的记录，然后尝试在尽可能小的事务中删除，例如通过查找阶段确定的主键或类似内容进行查找。
3.  一般是小额交易。
4.  索引和其他性能调整既可以加快事务速度，又可以促进表扫描上的索引查找。
5.  避免使用“热表”，例如一个表，其中一个表具有其他表主键的递增计数器。任何其他“总机”类型的配置都是有风险的。
6.  特别是如果不使用 Oracle，请详细了解目标 RDBMS 的外观行为（乐观/悲观、隔离级别等）。确保您不会像某些 RDMS 那样让行锁升级为表锁。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-10T16:28:50.567

死锁不是什么大问题。只要准备好在失败时重试您的交易。

并保持简短。由涉及很少记录的查询组成的短事务（通过索引的魔力）是减少死锁的理想选择——锁定的行更少，时间更短。

您需要知道现代数据库引擎不会锁定表。他们锁定行；所以死锁的可能性要小一些。

您还可以通过使用 MVCC 和 CONSISTENT READ 事务隔离级别来避免锁定：一些线程不会锁定，而是只会看到陈旧的数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-12T05:19:25.760

1.  仔细设计您的数据库流程，以尽可能多地消除涉及多个表的事务。当我拥有数据库设计控制权时，从来没有发生过我无法设计出导致它的条件的死锁情况。这并不是说它们不存在，并且可能在我有限的经验之外的情况下比比皆是。但我不乏改进导致这些问题的设计的机会。一个明显的策略是从一个按时间顺序的只写表开始，用于插入没有相互依赖关系的新的完整原子事务，并将它们的效果应用到有序的异步过程中。

2.  始终使用数据库默认隔离级别和锁定设置*，除非*您绝对确定它们会带来什么风险，并且已经通过测试证明了这一点。如果可能的话，首先重新设计您的流程。然后，尽量减少消除风险所需的保护（并进行测试以证明它）。不要“以防万一”增加限制性——这通常会导致意想不到的后果，有时是您打算避免的那种。

3.  从另一个方向重复这一点，您将在本网站和其他网站上读到的大多数提倡更改数据库设置以处理事务风险和锁定问题的内容是误导和/或错误的，正如它们如何相互冲突所证明的那样经常。可悲的是，特别是对于 SQL Server，我没有发现任何文档来源不是令人绝望的混乱和不充分的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T21:05:43.827

我分析所有数据库操作以确定，对于每一个，它是否需要在多语句事务中，然后对于每个这样的情况，需要什么最小隔离级别来防止死锁......正如你所说，可序列化肯定会做所以...

通常，只有极少数数据库操作首先需要多语句事务，其中只有少数需要可序列化隔离以消除死锁。

对于那些这样做的人，请在开始之前为该事务设置隔离级别，并在提交后将其重置为默认值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T21:18:06.027

我发现我在避免死锁方面做过的最好的投资之一就是使用可以订购数据库更新的对象关系映射器。确切的顺序并不重要，只要每个事务都以相同的顺序写入（并以完全相反的顺序删除）。

这样可以避免大多数开箱即用的死锁的原因是您的操作*总是*首先是表 A，然后是表 B，然后是表 C（这可能取决于表 B）。

只要您小心处理存储过程或数据层的访问代码，就可以获得类似的结果。唯一的问题是手工操作需要*非常*小心，而具有工作单元概念的 ORM 可以自动化大多数情况。

更新：删除应该向前运行以验证所有内容都是您期望的版本（您仍然需要记录版本号或时间戳），然后在所有内容验证后向后删除。由于这一切都应该发生在一笔交易中，因此不应该存在从您下面改变某些东西的可能性。ORM 向后执行的唯一原因是遵守关键要求，但如果您向前执行检查，您将拥有所需的所有锁。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T21:10:25.813

如果数据库锁定了 ENTIRE 表，您的示例只会成为问题。如果您的数据库正在这样做...运行:)

# java - 如何判断单击了哪个提交按钮

> ID：735899
> 
> 赞同：8
> 
> 时间：2009-04-09T20:57:57.557
> 
> 标签：java, forms, jsp, servlets, input

我的 JSP 上有几个不同的提交按钮，它们都指向同一个 servlet。我需要知道点击了哪个提交按钮。如何找出点击了哪个按钮？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T21:06:31.343

如果 request.getParameter("button-name") 不为空，那么这是被按下的按钮

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T21:02:59.357

每个提交按钮应该有一个不同的`name`：

```
<input type="submit" value="This is a submit button" name="submit1">
<input type="submit" value="Another submit button" name="submit2">
<input type="submit" value="Yet another submit button!" name="submit3"> 
```

然后，输入的名称应该出现在发送到表单发布到的任何位置的参数中，例如

```
post.jsp?key=value&submit3=&.... 
```

[http://www.w3schools.com/tags/tag_input.asp](http://www.w3schools.com/tags/tag_input.asp)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T00:10:03.697

这有点类似于 Struts 中的 DispatchAction。他们所做的是有一个隐藏字段，当您提交表单时，让 onClick() 设置值以指定要执行的操作。

```
<input type="hidden" name="dispatchAction"/>
<input type="submit" value="Edit"   onClick="setDispatchAction('edit')">
<input type="submit" value="Delete" onClick="setDispatchAction('delete')"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-16T12:39:37.020

```
<button type="submit" name="somename" value="button1">some text</button>
<button type="submit" name="somename" value="button2">some other text</button> 
```

无论显示的值如何，您都会将 post 变量“somename”设置为相应的值。

# sql - SQL 查询：如何将计数函数结果组合到选择查询中？

> ID：735900
> 
> 赞同：1
> 
> 时间：2009-04-09T20:58:00.053
> 
> 标签：sql

```
select distinct Franchise.FranchiseName, Franchise.Initials, Franchise.StoreNo, AccountCancellation_Process.Store_Num 
FROM FranchiseData
INNER JOIN AccountCancellation_Process
on FranchiseData.StoreNo = AccountCancellation_Process.Store_Num

select count(*) from AccountCancellation_Process where Store_Num = '1234' 
select count(*) from AccountCancellation_Process where Store_Num = '1234' and Progress is not null 
```

我想将 AccountCancellation_Process 中的 count(*) 合并到上面的内部连接语句中，因此查询将为我提供 FranchiseName、Initials、StoreNo 来自 Franchise 表的结果和来自 AccountCancellation_Process 的 Store_Num 的总记录和总记录，其中没有 Progress 列无效的。

如何将查询结果与计数函数结果结合起来？

感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:09:43.457

像这样，我认为这就是你想要的。我创建了两个表值相关子查询，以根据内部连接表中存储的数字获取数据。然后我根据商店编号加入他们。这样，不同的将起作用。但是您也可以只使用相关子查询来计算选择部分中的计数。我担心 distinct 可能不起作用。

```
SELECT DISTINCT Franchise.FranchiseName, Franchise.Initials, Franchise.StoreNo, acp.Store_Num, total_count.Total_Count, progress_count.Progress_Count
FROM FranchiseData
     INNER JOIN AccountCancellation_Process AS acp ON (FranchiseData.StoreNo = acp.Store_Num)
     INNER JOIN (SELECT Store_Num, COUNT(*) AS Total_Count FROM AccountCancellation_Process WHERE Store_Num = acp.Store_Num) AS total_count ON (acp.Store_Num = total_count.Store_Num)
     INNER JOIN (SELECT Store_Num, COUNT(*) AS Progress_Count FROM AccountCancellation_Process WHERE Store_Num = acp.Store_Num AND Progress IS NOT NULL) AS progress_count ON (acp.Store_Num = progress_count.Store_Num) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T21:03:07.687

别名 count(*) 然后使用 Sum(alias)

# .net - 当 .NET 程序集被“引用”时，用户范围设置会发生什么？

> ID：735901
> 
> 赞同：0
> 
> 时间：2009-04-09T20:58:11.270
> 
> 标签：.net, vb.net, winforms

我有一个独立的 WinForms 应用程序，我们称之为“程序 A”。程序 A 让用户创建一个文件并向其中保存一些信息。程序 A 还公开了一些公共类。

另一个独立的 WinForms 应用程序（“程序 B”）引用程序 A，并使用它的一些公共类。

但是，程序 A 的某些类需要打开用户创建的文件才能从中检索数据。在程序 A 中，用户文件的位置保存在“设置”中（当然作为用户范围设置）并通过`My.Settings`.

在程序 B 运行之前，这一切都很好——当它运行并使用程序 A 中需要从程序 A 中读取的类时`My.Settings`，设置为空白——就好像它们被重置（就像你第一次运行程序 A 时一样时间或在新用户帐户下）。任何*应用程序范围的*设置都被保留，但任何*用户范围的*设置都被重置为其默认值（无论它们在编写程序 A 时在 IDE 中设置为什么）。

这是一个伪代码示例：

**方案一：**

```
Namespace ProgramA

    Public Class Foo

        Public Shared Function GetStuff() as Object
            File = OpenFile(My.Settings.UserFileName)
            Return File.ReadStuff()
        End Function

    End Class

End Namespace 
```

**方案 B：**

```
TheStuffIWant = ProgramA.Foo.GetStuff() 
```

假设用户已经至少运行过一次程序 A 并打开了一个文件，因此`My.Settings.UserFileName`应该设置程序 A。

当 Program B 调用`Foo.GetStuff()`时，它不会返回任何内容，因为`My.Settings.UserFileName`它不包含用户的文件名 - 更准确地说，它包含该设置的任何“默认”值（当您在第一名）。但是，如果您转身启动程序 A，它会记住用户对`UserFileName`.

**所以-问题是：**在引用的程序集中调用函数时，为什么不保留用户的设置？我看到的行为是否有解释，或者我错过了一些非常明显的东西？或者也许我只是把这一切都搞错了，我不应该让程序 A 中的任何公共课程一开始就依赖任何东西`My.Settings`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:22:29.060

您的问题是正在执行的应用程序读取用户范围的设置。因为您是从程序 B 引用程序 A 而不是*执行*程序 A，所以程序 A 中的类正在尝试获取程序 B 未读取的设置。

关键是程序 B 有自己的设置，与程序 A 不同，程序 B 执行的任何类（无论它在哪里定义）都将使用程序 B 的设置。

因此，按照您的设置方式，您很不走运。

如果您同时控制程序 A 和程序 B，则可以为两者编写自定义设置提供程序，以允许它们共享通用的用户范围设置。

[应用程序设置架构](http://msdn.microsoft.com/en-us/library/8eyb2ct1.aspx)文章有一节介绍如何执行此操作。

# performance - 如何为包含 250,000 个文件的目录加速 Perl 的 readdir？

> ID：735903
> 
> 赞同：4
> 
> 时间：2009-04-09T20:58:58.773
> 
> 标签：performance, perl, readdir

我正在使用 Perl readdir 来获取文件列表，但是，该目录包含超过 250,000 个文件，这导致执行 readdir 的时间很长（超过 4 分钟）并使用超过 80MB 的 RAM。由于这是每 5 分钟重复一次的工作，因此这种延迟时间是不可接受的。

更多信息：另一个作业将填充正在扫描的目录（每天一次）。这个 Perl 脚本负责处理文件。为每个脚本迭代指定一个文件计数，当前每次运行 1000 个。Perl 脚本每 5 分钟运行一次并处理（如果适用）多达 1000 个文件。文件计数限制旨在允许下游处理跟上 Perl 将数据推送到触发复杂工作流程的数据库。

是否有另一种从目录中获取文件名的方法，理想情况下限制为 1000（由变量设置），这将大大提高该脚本的速度？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T22:34:44.767

`readdir`当您说需要几分钟和 80 MB时，您到底是什么意思？你能显示那行特定的代码吗？您是`readdir`在标量还是列表上下文中使用？

你在做这样的事情：

```
foreach my $file ( readdir($dir) ) { 
   #do stuff here
} 
```

如果是这种情况，您正在将整个目录列表读入内存。难怪需要很长的时间和大量的内存。

这篇文章的其余部分假设这是问题所在，如果您没有`readdir`在列表上下文中使用，请忽略文章的其余部分。

解决此问题的方法是使用 while 循环并`readdir`在标量上下文中使用。

```
while ( 
    defined( my $file = readdir $dir )
 ) {

    # do stuff.

} 
```

现在您一次只能阅读一项。您也可以添加一个计数器来跟踪您处理的文件数量。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T21:13:11.640

解决方案可能位于另一端：在填充目录的脚本中......

为什么不创建一个树状结构来存储所有这些文件，这样就有很多目录，每个目录都有可管理数量的文件？

与其创建“mynicefile.txt”，为什么不创建“m/my/mynicefile”或类似的东西？

您的文件系统会为此感谢您（特别是如果您在完成空目录后删除它们）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T21:13:18.520

这不完全是您查询的答案，但我认为在*同一个*目录中有这么多文件对于整体速度来说并不是一件好事（包括文件系统处理添加和删除操作的速度，而不仅仅是列出您看到）。

该设计问题的解决方案是为文件名的每个可能的第一个字母设置子目录，并将所有以该字母开头的文件放在该目录中。如果需要，递归到第二个、第三个等字母。

您可能会在可能的操作中看到明显的速度改进。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T21:33:03.887

您是说内容通过解压缩 zip 文件到达那里。为什么不只处理 zip 文件而不是在一个目录中创建/使用 250k 的文件？

基本上 - 为了加快速度，您不需要 perl 中的特定内容，而是在文件系统级别。如果您 100% 确定您必须处理目录中的 250k 个文件（我无法想象需要这样的情况） - 您最好找到更好的文件系统来处理它而不是找到perl 中的一些“神奇”模块可以更快地扫描它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T21:06:34.057

可能不是。我猜大部分时间是在阅读目录条目。

但是，您可以预处理整个目录列表，每 1000 个条目创建一个文件。然后，您的进程每次都可以执行这些列表文件之一，而不会产生读取整个目录的费用。

您是否尝试过*只* `readdir()`通过目录而不进行任何其他处理来获得基线？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T04:13:02.427

您将无法加快 readdir，但您可以加快监视目录的任务。您可以要求操作系统进行更新——例如，Linux 具有 inotify。这是一篇关于使用它的文章：

[http://www.ibm.com/developerworks/linux/library/l-ubuntu-inotify/index.html?ca=drs-](http://www.ibm.com/developerworks/linux/library/l-ubuntu-inotify/index.html?ca=drs-)

您可以使用 Perl 中的 Inotify：

[http://metacpan.org/pod/Linux::Inotify2](http://metacpan.org/pod/Linux::Inotify2)

不同之处在于您将拥有一个长时间运行的应用程序，而不是由 cron 启动的脚本。在应用程序中，您将保留一个新文件队列（由 inotify 提供）。然后，您设置一个定时器，每 5 分钟响一次，并处理 1000 个项目。之后，控制权返回事件循环，您要么在 5 分钟内醒来并处理 1000 个以上的项目，要么 inotify 向您发送更多文件以添加到队列中。

（顺便说一句，您将需要一个事件循环来处理计时器；我推荐 EV。）

# linux - 无法在 64 位 Linux 上运行 32 位应用程序

> ID：735907
> 
> 赞同：11
> 
> 时间：2009-04-09T20:59:36.400
> 
> 标签：linux, ubuntu, 64-bit, 32-bit

我有一个非常小的 Ubuntu 8.04 64 位安装。

当我尝试运行一些 32 位程序（例如我的`jhead`程序）时，我收到消息`No such file or directory`.

我认为这可能是图书馆的问题，但是当我这样做时：

```
ldd jhead 
```

而不是它需要的库列表，我只是得到消息`not a dynamic application`。我使用的另一个旧的 32 位应用程序也是如此。

因此，似乎没有安装一些运行 32 位应用程序的非常重要的组件。但我如何确定这些是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T21:07:02.840

您将需要安装 32 位库包

> ia32-libs - 用于 amd64 和 ia64 系统的 ia32 共享库

去执行

```
sudo aptitude install ia32-libs 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T19:15:33.227

执行 ldd ./ 可能有助于查看成功解决了哪些库依赖项。

# jquery - jQuery 选择器

> ID：735910
> 
> 赞同：5
> 
> 时间：2009-04-09T21:00:14.043
> 
> 标签：jquery, css-selectors

我发现很难找到使用 jQuery 的例子，所以我问这么简单的问题很糟糕。我有这个 ul：

```
<ul id="navLinks">
    <li class="selected" id="homeNavLink"></li>
    <li id="aboutNavLink"></li>
    <li id="contactNavLink"></li>
    ...
</ul> 
```

我想编写一个函数来更改哪个 li 具有“选定”类。这是我的尝试：

```
function changeNavLink(selectedId) {
    $("#navLinks li").each(function() {
        $(this).removeClass("selected");
    });
    $("#" + selectedId).addClass("selected");
} 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T21:02:44.300

您不必这样做`.each`- 像这样的功能[`removeClass`](http://docs.jquery.com/Removeclass)可以很好地处理一组元素。

```
function changeNavLink(selectedId) {
    $("#navLinks li").removeClass('selected')
                     .filter('#' + selectedId)
                     .addClass('selected');
} 
```

应该管用。它所做的是选择所有`li`元素，从所有元素中删除类`selected`，将它们[过滤](http://docs.jquery.com/Traversing/filter#expr)到仅传递 ID 的元素，然后将类添加到该元素`selected`中。

[这是一个工作链接](http://jsbin.com/ekanu)，显示了上面的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T21:02:41.667

```
$('#navlinks li.selected') 
```

会给你“选定”类的 li

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T22:24:30.313

对于给出的特定 HTML 示例，我更喜欢：

```
function changeNavLink(selectedId) {
    $('#' + selectedId).addClass('selected')
                       .siblings('li')
                       .removeClass('selected');
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-01T13:11:25.933

为什么不使用 jQuery(this) ？它更容易，然后使用参数调用函数。HTML：

```
<ul id="navLinks">
    <li class="selected" id="homeNavLink"></li>
    <li id="aboutNavLink"></li>
    <li id="contactNavLink"></li>
</ul> 
```

JS：

```
$(document).ready(funciton(){
  $('#navLinkgs').on('click', 'li', function(){
    $this = $(this);
    $('#navLinkgs li.selected').removeClass('selected');
    $this.addClass('selected');
  });
}); 
```

# mysql - 使用 Django 从数据库中选择用于聚合计算的日期格式

> ID：735911
> 
> 赞同：3
> 
> 时间：2009-04-09T21:00:17.647
> 
> 标签：mysql, django, sqlite, django-models

我想基于月份对日期时间字段进行聚合计算。

我目前正在使用 extra() 函数来格式化日期，例如：

```
...extra(select="strftime('column', '%m/%Y') as t").values('t').annotate(SUM(foo)) 
```

它适用于 sqlite3。

在 sqlite3 中我可以使用 strftime()，但这不适用于 MySQL。在 MySQL 中，我可以使用 date_format()，但这不适用于 sqlite3。

如何重写它以适用于两种数据库类型？

大多数开发人员只是在他们的开发机器上使用 sqlite3，而在 prod 服务器上使用 MySQL。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T21:14:29.623

在您的 MySQL 数据库中运行以下命令，以创建转发功能。

```
delimiter //

create function strftime ( d date, format varchar(255) )   
   RETURNS varchar(64)
   LANGUAGE SQL
   DETERMINISTIC
   COMMENT 'synonym for date_format'
   return date_format(d, format) ;
//
delimiter ; 
```

# asp.net - 如何消除 IIS/ASP.NET 双重握手？

> ID：735913
> 
> 赞同：2
> 
> 时间：2009-04-09T21:00:57.223
> 
> 标签：asp.net, .net-2.0, clickonce, windows-authentication

我有一个在公司环境中运行的 .NET 2.0 ClickOnce 应用程序，它设置为通过 Windows 身份验证工作。

因此，用户通过 ClickOnce 下载应用程序，然后它连接到 IIS 服务器并通过 Web 服务调用进行通信。

问题是每次通话都会有两次握手。第一次调用产生 401 并邀请客户进行协商。由于客户端发送了身份验证令牌，因此第二次调用成功。

有没有办法消除这种双重握手？因为它给应用程序的延迟带来了巨大的开销，并使它看起来非常缓慢。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-19T19:52:00.493

实际上有一个解决方案，事实证明：WebRequest.PreAuthenticate 查看 Rick Strahl 的[文章](http://www.west-wind.com/Weblog/posts/243915.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T09:54:30.210

这种“双握手”是 NTLM 挑战响应模型不可或缺的一部分。您唯一的选择是更改身份验证类型。

或者，您尝试将连接重新用于 Web 服务调用。

# memory - IIS 6.0 应用程序池共享 DLL

> ID：735914
> 
> 赞同：0
> 
> 时间：2009-04-09T21:01:16.257
> 
> 标签：memory, dll, iis-6

我在一个应用程序池中有 10 多个应用程序。所有这些应用程序都有一些它们都加载的通用 dll。现在的问题是这些 dll 被放置在每个应用程序的“\bin”文件夹中。所以每个应用程序；即使它使用 dll_a，最终也会加载它自己的 dll_a“副本”。

我有几个问题 1) 可以吗？2）我应该将 dll_a 放在某个公共文件夹中并让所有应用程序引用 1 个单一副本吗？3\. 服务于这些应用程序的每个工作进程是否会从不同路径加载多个 dll_a 副本，即使它们基本上是相同的 dll？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:05:57.337

1）这样可以吗？——是的，这没关系。

2）我应该将 dll_a 放在某个公共文件夹中并让所有应用程序引用 1 个单一副本吗？——如果你愿意，你可以。您将遇到的问题是，如果您需要让应用程序使用不同版本的 dll，那么所有其他应用程序都必须升级（或降级）。如果部署不是管理 dll 的问题，我倾向于给他们自己的 sererate 副本。不过，我们有一个非常自动化的流程，我在其中工作，因此在需要时保持同步非常简单。

3) 服务于这些应用程序的每个工作进程是否从不同路径加载多个 dll_a 副本，即使它们基本上是相同的 dll？- 是的，每个进程都将在 dll 的副本中拥有它。每个应用程序都在它自己的内存空间中运行，因此尽管从技术上讲它们使用的是同一个应用程序，但每个应用程序都会在内存中拥有它的副本。

# web-services - 使用内置的 ASP.NET 成员来保护 Web 服务

> ID：735915
> 
> 赞同：1
> 
> 时间：2009-04-09T21:01:24.133
> 
> 标签：web-services, asp.net-membership

是否可以使用内置的 ASP.NET 成员资格提供程序来保护 Web 服务？

我已经使用我的会员资格设置了一个 SQL Server 数据库，现在我想提供一个只有会员才能使用的 Web 服务。是否可以对此进行身份验证（如果可以的话？）还是我需要对 Web 服务进行单独的身份验证？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T21:06:46.087

绝对有可能。您可以将 ASP.NET 成员资格提供程序与 WCF 结合使用（我在去年的一个项目中使用了它）。并且（这就是有趣的部分）它只是您必须做的一些配置。它也适用于 ASP.NET RoleProvider´s

附加信息 ：

[http://msdn.microsoft.com/en-us/library/ms731049.aspx](http://msdn.microsoft.com/en-us/library/ms731049.aspx) [http://nayyeri.net/blog/use-asp-net-membership-and-role-providers-in-windows-communication-foundation /](http://nayyeri.net/blog/use-asp-net-membership-and-role-providers-in-windows-communication-foundation/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T22:00:32.103

我认为我可以做这样的事情。我现在没有要上传和测试的服务器，但如果可行，我会将其标记为答案：

```
 [WebMethod]
    public string HelloWorld(String username, String password)
    {
        bool isAuthenticated = Membership.ValidateUser(username, password);

        if (isAuthenticated)
            return "Hello World";
        else
            return "You do not have access to this resource.";
    } 
```

# java - Spring表单命令的意图

> ID：735924
> 
> 赞同：4
> 
> 时间：2009-04-09T21:05:13.733
> 
> 标签：java, spring, spring-mvc, validation

Spring 的表单控制器（例如`SimpleFormController`或`BaseCommandController`）使用命令在 HTML 表单和控制器之间传递数据。我的问题是，使用支持模型作为命令本身是常见的做法吗？或者创建一个具有与支持模型中的属性对应的属性的单独命令是否很常见。

我的问题是要使用支持模型作为命令，属性编辑器对于转换非字符串属性是必需的。想象一个具有许多非字符串强类型自定义字段类型的数据模型。在提交表单时，属性编辑器会在调用验证器之前进行转换。如果无法进行类型转换（用户输入错误），那么验证器将永远没有机会提供详细的错误消息。HTML 表单上显示的只是一般的错误消息。请参阅我[相关的 Stackoverflow 问题](https://stackoverflow.com/questions/691790)。

另一种方法是创建一个单独的命令来复制支持模型中的每个字段，但作为一个字符串。通过这种方式，验证器可以验证每个字段的字符串表示。然后控制器`onSubmit`负责将基于文本的命令转换为支持模型。从我对 Spring 的研究来看，这似乎是预期的用途。我对走这条路的犹豫是需要为每个数据模型创建单独的命令的繁琐方式。然后是必须在命令和数据模型之间编组的额外工作。让表单直接编辑支持模型并使用属性编辑器进行转换要方便得多。那么问题是验证。

所以我很好奇其他人如何处理包含自定义类型非字符串字段的基于表单的模型编辑问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T23:49:22.670

我建议您查看[Spring binding and validation API](http://static.springframework.org/spring/docs/2.5.x/reference/validation.html)。将表单元素绑定到服务层需要的对象中，并让控制器传递它们。

我的偏好是直接绑定到业务对象，而不是仅仅为了 Web 层而创建 DTO。我不喜欢并行层次结构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T20:05:44.933

恕我直言，这归结为您希望如何设计域类。我更喜欢通过甚至不允许设置不适当的值等来严格设计它们。这与 Spring 处理绑定和验证的方式结合得不是很好。

由于我想避免削弱我的域模型，我倾向于使用 DTO 作为命令对象，因为通常演示文稿对域对象的看法略有不同。经典示例是带有密码的 User 域类。在表示层中，您通常希望让实际用户输入两次密码并在验证步骤中比较这些值。只有当它们正确匹配时，数据才会绑定到域类。

可能会引入一些开销，但允许将域/应用程序层与视图完全分离。

# iis - IIS 网站正在为 zip 文件发送多个内容类型的标头

> ID：735943
> 
> 赞同：1
> 
> 时间：2009-04-09T21:10:43.550
> 
> 标签：iis, zip, content-type, mime-types, iis-5

我们的 IIS5 服务器有问题。

当*某些*用户/浏览器单击下载 .zip 文件时，有时会在浏览器窗口中呈现二进制乱码文本。所需的行为是让文件下载或使用关联的 zip 应用程序打开。

最初，我们怀疑文件上设置了错误的内容类型标头。IIS 技术人员确认 .zip 文件由 IIS 提供，mime 类型为“application/x-zip-compressed”。

但是，使用 Wireshark 对 HTTP 数据包的检查表明，对 zip 文件的请求会返回**两个**Content-Type 标头。

*   内容类型：文本/html；字符集=UTF-8
*   内容类型：application/x-zip-compressed

知道为什么 IIS 发送**两个**内容类型标头吗？常规 HTML 或图像文件不会发生这种情况。ZIP 和 PDF 确实会发生这种情况。

我们可以要求 IIS 技术人员查看特定的位置吗？或者是否有我们可以检查的配置文件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-28T23:28:28.223

这可能与这篇[知识库文章有关。](http://support.microsoft.com/kb/841120) 这表明 IIS 可能正在对已经压缩的文件进行 gzip 压缩，但有些浏览器只是直接向辅助应用程序发送错误数据（因为它已被压缩两次）。如果您将 zip 扩展的 mime 类型更改为*application/octet-stream*，这可能不会发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T11:09:50.720

听起来您的 IIS 配置可能存在问题。但是，如果是这种情况，则无法从您的帖子中看出。

您可以在 IIS 上的多个级别上配置 mime 类型。我的 IIS 5 知识有点生疏，据我所知，这种行为与 IIS 6 相同。我试图在 IIS 6 环境中模拟这一点，但根据接受的标头只收到一种 mime 类型

我已将站点上 zip 文件的标头设置为 application/x-zip-compressed 并且对于我已明确将其设置为的文件

```
tinyget -srv:dev.24.com -uri:/helloworld.zip -tbLoadSecurity
WWWConnect::Connect("server.domain.com","80")
IP = "127.0.0.1:80"
source port: 1581

REQUEST: **************
GET /helloworld.zip HTTP/1.1
Host: server.domain.com
Accept: */*

RESPONSE: **************
HTTP/1.1 200 OK
Content-Length: 155
Content-Type: text/html
Last-Modified: Wed, 29 Apr 2009 08:43:10 GMT
Accept-Ranges: bytes
ETag: "747da786a6c8c91:0"
Server: Microsoft-IIS/6.0
Date: Wed, 29 Apr 2009 10:47:10 GMT

PK??
?   ?   ?   helloworld.txthello worldPK??¶
?   ?   ?       ?         helloworld.txtPK??    ? ? <   7   ? hello world sample
WWWConnect::Close("server.domain.com","80")
closed source port: 1581 
```

但是我觉得这证明不了多少。然而，它确实提出了几个问题：

1.  服务器上设置的所有 mime 映射是什么（向服务器管理员询问 metabase.xml 文件，然后您可以确保他没有错过某些设置）
2.  这些客户端是否在您控制的网络上？可能不是，我想知道您的服务器和客户端之间可能有什么代理服务器
3.  IIS 日志的外观如何，对于该请求，我对 Accept 标头特别感兴趣。
4.  我想知道[提琴手](http://fiddler2.net/)会展示什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-03T09:14:32.640

我遇到过类似的问题。我在 IIS 6 上测试下载，但无法弄清楚为什么名为 test.zip 的压缩文件在 IE8 中显示为文本（在其他浏览器中很好，可以下载）。

然后我意识到为了测试我压缩了一个非常小的文本文件。我的猜测是 IE 嗅探了文件，看到了文本（由于体积小，几乎没有压缩）并确定它是纯文本。

我再次尝试使用更大的文件，下载提示在 IE8 中显示正常。

可能与您的情况无关，但我想我会提到它。

蒂姆

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T22:47:18.567

我相信 - 我可能错了 http 1.1 标头发送多个标头定义并且最具体的具有优先权。

因此，在您的示例中，它发送 2 text/html，然后发送 application/x-zip-commercial，因此第二个将是最具体的-如果无法在客户端上处理，则使用更通用的一个（第一个在这种情况下 ） -

我已经阅读了这个[http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)并且那种指向你所说的 - 不确定这是否是实际发生的事情。

当然我在这里可能完全错了

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T23:00:07.087

确保您没有设置任何 ISAPI 过滤器或 ASP.net HTTP 模块来重写标头。如果他们不检查标题是否已经存在，它将被追加而不是替换。不久前，我们遇到了一个内部身份验证模块没有正确更新标头的问题，因此我们得到了两个授权标头，一个来自 IIS，一个来自我们的模块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-25T18:43:02.320

服务器上安装了哪些软件来处理 .zip 文件？[看起来](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0167eb9b-0a38-470c-a33c-1905115e4d2b.mspx)IIS 从注册表中获取了 MIME 翻译，也许您使用的 zip 软件已经注册了 MIME 类型。这不能解释为什么 IIS 会响应两个内容类型的标头，因此任何 ISAPI 过滤器和其他 Mime 表都是可疑的。

# c - 是否删除#ifdef DEBUG 部分以进行发布？

> ID：735944
> 
> 赞同：3
> 
> 时间：2009-04-09T21:10:48.837
> 
> 标签：c, debugging, coding-style, c-preprocessor

当发布源代码供其他人查看时，当编码风格没有明确定义（没有双关语）时，您是否删除了`#ifdef`DEBUG 部分？

（即只有在定义了 DEBUG 时才编译的部分）

如果我删除它，它会使代码看起来更好（或者我看起来更好 - 我真的希望有人知道我已经调试过，以及我是如何做到的吗？），但是我会丢失我的调试部分，或者必须保留两个（或更多）版本的代码。

什么是要做？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T21:13:56.863

我认为如果您的调试代码是干净的并且在任何日志记录语句中都有“专业”语言，则可以保留它。如果调试代码草率或有调试消息，例如“我在这里......”，“现在我“我在这里……”你应该把它拿出来。

如果您的调试语句反映了存在您无法弄清楚的问题的事实，那么如果您试图将您的软件“出售”给某人，那么最好将它们删除。（希望您以后可以修复它们...）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T21:14:24.023

除非您在评论中使用不可重新编译的语言，否则您应该保留代码原样。如果有人要使用您的代码，他们很可能会需要这些代码，或者这将帮助他们理解您的代码。（评论也是如此）

编辑：我过去经常处理其他工作室代码。我见过调试代码、死路和许多其他东西，但我唯一讨厌的是那些剥离调试和注释代码的人，这使得他们的代码很难维护

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T21:19:59.813

我也投票决定将其保留。如果/当您开始处理第一个补丁时，您可能需要那些被 DEBUG 阻止的部分。此外，QA 不会喜欢您删除代码，即使它在指令中被阻止。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T21:18:49.613

如果您决定删除它们，只需在导出代码时使用脚本将它们过滤掉，无需维护两个版本。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T21:27:05.460

使用源代码管理系统中的所有内容维护您的基本版本。

然后，如果您想分发以一种或多种方式过滤的源代码，请制作一个脚本来制作您的源代码的发布版本。

不要维护这些二级过滤存储库，让它们始终生成。

但值得花时间吗？可能不会，您可能应该只分发包括#ifdef DEBUG 部分在内的所有内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T21:35:04.020

维护 ANYTHING 的多个版本是不可取的。

只有在*必须*时才这样做。

# wix - WiX - 自定义操作（安装后）在升级时不运行

> ID：735956
> 
> 赞同：0
> 
> 时间：2009-04-09T21:14:31.077
> 
> 标签：wix, upgrade, action

我创建了一个通过 UI 触发的自定义操作。它适用于新安装，但在升级过程中失败。但是，如果我从控制面板运行修复，它就会运行良好。我尝试捕获 msi 日志，但它没有提供任何线索。以下是片段...

用户界面：

```
<Control Id="CloseButton" Type="PushButton" X="230" Y="243" Width="66" Height="17" Default="yes" Cancel="yes" Text="&amp;Continue">    
  <Publish Event="DoAction" Value="ConfigureServer1">1</Publish>   
  <Publish Event="EndDialog" Value="Return">1</Publish>    
</Control> 
```

自定义操作：

```
<CustomAction Id="ConfigureServer1" Impersonate="no" Directory="TARGETDIR" Return="asyncNoWait" ExeCommand="[#fileSetupDb] &quot;[ProductVersion]&quot; &quot;[OCISUPGRADE]&quot;"></CustomAction> 
```

UI 文件的顺序：

```
<InstallUISequence>
......
 <Show Dialog="FinishedForm" OnExit="success" />
......
</InstallUISequence> 
```

任何线索....或任何我可以尝试调试的东西等？我试了几天没有结果。我不是 msi 或 wix 的新手，也不是专家。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-10T20:59:38.290

我不完全遵循这个问题，但我会猜测一下。升级“产品的先前版本”（正在删除的 MSI）仅运行其 InstallExecuteSequence。所以InstallUISequence中旧版本产品中的自定义操作不会运行。

如果问题是为什么自定义操作不会在新版本的产品中运行，那么这里没有足够的信息。您可以查看详细日志文件以查看具有匹配 ID 的自定义操作的结果。

# memory - 有人可以解释 Marshal.StructureToPtr

> ID：735959
> 
> 赞同：3
> 
> 时间：2009-04-09T21:15:35.910
> 
> 标签：memory, struct, pointers, marshalling

我在使用这段代码时遇到了一些问题：

```
//Creating a new ImageElement Struct
ImageElement oElement = new UM0516.ImageElement();
//Create a pointer and allocate enough room for the struct type
IntPtr pElement = Marshal.AllocHGlobal(Marshal.SizeOf(new UM0516.ImageElement()));
//Copy the contents of the struct into the allocated memory space
Marshal.StructureToPtr(oElement, pElement, true);
//Function that takes a file pointed to by handle, and does some sweet sweet things
//And returns a loaded struct pointed to by pElement
FILES_GetImageElement(handle, el, out pElement); 
```

这是我感到困惑的地方：我将逐步执行代码，在我调用最后一个函数（它应该更改 pElement 指向的内存中的一些位）之后，我看到 oElement 发生了变化！？我认为 Marshal.StructureToPtr 将数据从托管结构“复制”到内存。那么这两个位置实际上是一样的吗？托管结构oElement和pElement指向的分配内存？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T21:32:20.737

这篇文章[详细](http://msdn.microsoft.com/en-us/library/23acw07k.aspx)解释了它：

> 格式化[的 blittable](http://msdn.microsoft.com/en-us/library/75dwhxf7.aspx)类在托管和非托管内存中具有固定布局（格式化）和通用数据表示。当这些类型需要编组时，堆中对象的指针会直接传递给被调用者。被调用者可以更改指针所引用的内存位置的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T21:30:15.093

我认为您可能不需要手动将结构编组为指针。只要结构的托管版本与非托管结构的布局匹配，就让互操作封送拆收器负责封送处理。

您应该能够完全摆脱 pElement 并将 oElement 作为 ref 参数（如果您关心其中的内容）或 out 参数传递。

# database - 图像索引以访问数据库中的数据

> ID：735961
> 
> 赞同：0
> 
> 时间：2009-04-09T21:17:56.823
> 
> 标签：database, indexing

当数据集的键是字符串时，我们有 Trie 结构可以有效地访问数据。如果数据集的关键是图像，那么最好的索引是什么？

关键是，我的意思是一些可以唯一区分数据的东西。这是一个不太常用的场景，即通过图像访问数据吗？我确实觉得有些应用程序像指纹数据库一样使用它。

在这种情况下散列有帮助吗？我的意思是根据像素值将图像散列成一个唯一的数字。

请分享对此的任何指示。

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:31:14.187

您可以使用哈希函数根据图像查找项目。但我认为这种情况几乎没有实际用途。

指纹识别、面部识别或对象识别等应用程序执行特征提取过程。这意味着他们将复杂的图像结构转换为更简单的特征向量，可以与存储的模式进行比较。

真正艰苦的工作是特征提取过程，该过程必须将重要信息与图像中的“噪声”分开。

只是散列图像将不会产生任何可用的特征。我会考虑散列图像以查找一些信息的唯一情况是构建图像数据库。但即使在这种情况下，像 SHA1 或 MD5 这样的通用散列函数也几乎没有用处，因为修改单个像素或元数据（例如作者）会更改散列，并且无法根据通用散列函数识别两个图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T21:24:52.097

我不是 100% 确定你想要做什么，但散列应该给你一个唯一的字符串来识别图像。你没有指定你的语言，但大多数都有一个函数来散列整个文件的数据，所以你可以通过它运行图像文件。（例如，PHP 有[`md5_file()`](http://php.net/md5_file)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T21:56:57.183

目前尚不清楚您要解决什么问题。您绝对可以获取整个图像的哈希并将其用作 Trie 结构中的键，尽管我认为在这种情况下，与常规哈希表相比，Trie 结构几乎不会给您带来任何性能优势，因为您正在执行（大) 每次查找时散列。

如果您要实现的目的是比较两个图像或快速在树中找到相似的图像，您可以考虑使用图像的 GIF 或 JPEG 标头作为键的开头。这将导致具有相似类型、大小、索引颜色等的图像在 Trie 结构中彼此靠近分组。然后，您可以仅在发生冲突时计算图像的哈希（即，Trie 中的多个图像具有完全相同的标头）。

# sql - 使用系统表统计各种表中空行的百分比

> ID：735962
> 
> 赞同：1
> 
> 时间：2009-04-09T21:18:05.497
> 
> 标签：sql, sql-server, sql-server-2005

我正在尝试确定表中所有字段的空项百分比。我必须在具有大量字段的几个表上运行它，并且我正在寻找一种自动化的方式来执行此操作。

我知道我可以查询“information_schema.columns”并获得一个很好的字段名称列表：

```
select Column_name 
from information_schema.columns 
where table_name='TableName' 
```

但是我似乎无法想出一些快速而肮脏的方法来计算每个字段的百分比，我猜我需要某种动态 sql 吗？有人对解决此问题的好方法有建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T02:45:07.317

也许太简单了，但基本思想可以用不同的方式扩展（我通常有用于代码生成`@CRLF`和`@TAB`代码生成的变量）：

```
DECLARE @sql AS varchar(MAX)

SELECT @sql = COALESCE(@sql + CHAR(13) + CHAR(10) + 'UNION' + CHAR(13) + CHAR(10), '')
    + 'SELECT ''' + QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) + '.' + QUOTENAME(COLUMN_NAME) + ''' AS COLUMN_NAME' + CHAR(13) + CHAR(10)
        + CHAR(9) + ',COUNT(*) AS TotalRows' + CHAR(13) + CHAR(10)
        + CHAR(9) + ',COUNT(' + COLUMN_NAME + ') AS NonNullCount' + CHAR(13) + CHAR(10)
    + 'FROM ' + QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)
FROM INFORMATION_SCHEMA.COLUMNS WHERE IS_NULLABLE = 'YES'

PRINT @sql
EXEC (@sql) 
```

至于你的百分比，我不确定这是整个表格还是仅特定列，所以我将把它留给读者作为练习。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T21:21:27.330

AFAIK 的唯一方法是使用动态 sql（例如 sp_executesql）。有索引统计信息，但空值不存储在索引中......

# c# - .net - 由于增量运算符或自动字符串转换（我认为），无法将代码从 c# 转换为 vb.net

> ID：735968
> 
> 赞同：0
> 
> 时间：2009-04-09T21:20:10.517
> 
> 标签：c#, .net, vb.net

我正在用 VB.NET 编写一个库，其中我添加了一个最初用 C# 编写但转换为 VB.NET 的类。我对 C# 不太了解，因此我使用了在线 C# 到 VB.NET 转换器。现在我遇到了一些我认为在线转换器无法正确“翻译”的代码。

运行代码时出现以下错误：

```
System.IndexOutOfRangeException was unhandled
  Message="IndexOutOfRangeException"
  StackTrace:
    at System.String.get_Chars()
......... 
```

我真的不明白这个错误的原因。我相信这个错误可能是由于： - 由于 C# 能够自动将整数变量转换为字符串（而 VB.NET 需要“toString-method”） - 或者由于 C# 使用增量VB.NET 不支持的运算符。

这是 C# 中的原始代码片段，其中“m_primaryKey”是一个 StringBuilder 对象：

```
private void addMetaphoneCharacter(String primaryCharacter, String alternateCharacter)
        {
            //Is the primary character valid?
            if (primaryCharacter.Length > 0)
            {
                int idx = 0;
                while (idx < primaryCharacter.Length)
                {
                    m_primaryKey.Length++;
                    m_primaryKey[m_primaryKeyLength++] = primaryCharacter[idx++];
                }
            }
            //other code deleted 
```

当使用在 C# 中创建的类库时，此原始代码有效。

这是 VB.NET 中的转换代码，它给了我前面提到的错误：

```
Private Sub addMetaphoneCharacter(ByVal primaryCharacter As String, ByVal alternateCharacter As String)
            'Is the primary character valid? 
            If primaryCharacter.Length > 0 Then
                Dim idx As Integer = 0
                While idx < primaryCharacter.Length
                    m_primaryKey.Length += 1
                    m_primaryKey(System.Math.Max(System.Threading.Interlocked.Increment(m_primaryKeyLength), _
                        m_primaryKeyLength - 1)) = primaryCharacter _
                        (System.Math.Max(System.Threading.Interlocked.Increment(idx), idx - 1))
                End While
            End If 
           'other code deleted 
```

原始代码可以在[这里找到。](http://www.codeproject.com/KB/recipes/dmetaphone5.aspx "这里")

我应该说课堂上的代码对我来说非常先进（我是一个爱好程序员，但每天都在学习）所以也许我没有看到明显的东西，但这就是我问你的原因。

你能给我一些提示来解决这个问题吗？

谢谢你。

编辑：这是 C# 中的完整子代码：

```
/**
         * Appends a metaphone character to the primary, and a possibly different alternate,
         * metaphone keys for the word.
         * 
         * @param primaryCharacter
         *               Primary character to append to primary key, and, if no alternate char is present,
         *               the alternate key as well
         * @param alternateCharacter
         *               Alternate character to append to alternate key.  May be null or a zero-length string,
         *               in which case the primary character will be appended to the alternate key instead
         */
        private void addMetaphoneCharacter(String primaryCharacter, String alternateCharacter)
        {
            //Is the primary character valid?
            if (primaryCharacter.Length > 0)
            {
                int idx = 0;
                while (idx < primaryCharacter.Length)
                {
                    m_primaryKey.Length++;
                    m_primaryKey[m_primaryKeyLength++] = primaryCharacter[idx++];
                }
            }

            //Is the alternate character valid?
            if (alternateCharacter != null)
            {
                //Alternate character was provided.  If it is not zero-length, append it, else
                //append the primary string as long as it wasn't zero length and isn't a space character
                if (alternateCharacter.Length > 0)
                {
                    m_hasAlternate = true;
                    if (alternateCharacter[0] != ' ')
                    {
                        int idx = 0;
                        while (idx < alternateCharacter.Length)
                        {
                            m_alternateKey.Length++;
                            m_alternateKey[m_alternateKeyLength++] = alternateCharacter[idx++];
                        }
                    }
                }
                else
                {
                    //No, but if the primary character is valid, add that instead
                    if (primaryCharacter.Length > 0 && (primaryCharacter[0] != ' '))
                    {
                        int idx = 0;
                        while (idx < primaryCharacter.Length)
                        {
                            m_alternateKey.Length++;
                            m_alternateKey[m_alternateKeyLength++] = primaryCharacter[idx++];
                        }
                    }
                }
            }
            else if (primaryCharacter.Length > 0)
            {
                //Else, no alternate character was passed, but a primary was, so append the primary character to the alternate key
                int idx = 0;
                while (idx < primaryCharacter.Length)
                {
                    m_alternateKey.Length++;
                    m_alternateKey[m_alternateKeyLength++] = primaryCharacter[idx++];
                }
            }
        } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T21:29:13.740

while 循环第二行的参数在 VB.NET 版本中完全不同。Interlocked.Increment 调用将返回递增的索引，而 C# 后递增运算符返回原始值（在递增之前）。

第二行可能会更好地替换为：

```
m_primaryKey(m_primaryKeyLength) = primaryCharacter(idx)
m_primaryKeyLength = m_primaryKeyLength + 1
idx = idx + 1 
```

即，根据 C# 原件，仅在进行索引/分配之后才增加值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T21:29:27.653

我可能遗漏了一些东西，但我看不到转换器开始使用 System.Threading.Interlocked... 的相关性。

我的手动转换看起来像这样：

```
Private Sub addMetaphoneCharacter(ByVal primaryCharacter As String, ByVal alternateCharacter As String)
            'Is the primary character valid? 
            If primaryCharacter.Length > 0 Then
                Dim idx As Integer = 0
                While idx < primaryCharacter.Length
                    m_primaryKey.Length += 1
                    m_primaryKey(m_primaryKeyLength) = primaryCharacter(idx)
                    m_primaryKeyLength += 1
                    idx += 1

                End While
            End If 
           'other code deleted 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T21:25:55.930

索引超出范围意味着您正在尝试访问超出数组大小的范围。这通常是由“over by one”问题引起的。

查看代码，VB 转换相当奇怪，并且正在做 C# 版本不做的事情，例如从索引器中删除一个。

你是说自动化工具做到了这一点？

顺便说一句，您可以毫无困难地在 VB 应用程序中包含 C# 类和程序集，那么您为什么要转换它呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T21:31:58.537

将 Math.Max 更改为 Math.Min 应该可以解决问题，但是为了清楚起见，我会按照 itowlson 所说的进行更改，并将增量移到使用后。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T21:33:01.780

while 循环中的两行代码在 C# 中执行以下操作： - 将 m_primaryKey.Length 加一 - 将 m_primaryKeyLength 加一（您确定这里没有遗漏一个点吗？） - 将 idx 加一 - 分配值primaryCharacter[idx] 到 m_primaryKey[m_primaryKeyLength]

所以在VB代码中......

```
m_primaryKey.Length += 1
m_primaryKeyLength += 1
idx += 1

m_primaryKey(m_primaryKeyLength) = primaryCharacter (idx) 
```

我无法从这段代码片段中分辨出来，但它闻起来像 m_primaryKeyLength 和 m_primaryKey.Length 是多余的。如果是这种情况，请通过将“m_primaryKeyLength”替换为“m_primaryKey.Length”来简化您的代码。

# java - spymemcached (Java Memcached 客户端)

> ID：735970
> 
> 赞同：2
> 
> 时间：2009-04-09T21:20:55.130
> 
> 标签：java, memcached

有没有办法使用这个 API ( **spymemcached** ) 收集 memcached 的统计信息？

我知道有像 cacti 这样的工具可以收集 Memcached Server 上的信息。但是我想收集我放入服务器的每个项目的内存使用情况——总数。同一类别中的项目等......***更重要的是，各个部分使用的字节。***

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T22:15:55.500

[获取统计信息（）](http://dustin.github.com/java-memcached-client/apidocs/net/spy/memcached/MemcachedClient.html#getStats%28%29)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-13T06:01:01.320

请尝试 xmemcached。 [http://code.google.com/p/xmemcached/](http://code.google.com/p/xmemcached/)

据我所知，xmemcached 支持基于 JMX 的统计信息。但我不确定它的详细程度。

# python - Python中的静态方法？

> ID：735975
> 
> 赞同：1894
> 
> 时间：2009-04-09T21:23:19.477
> 
> 标签：python, static-methods

是否可以在 Python 中有静态方法，我可以在不初始化类的情况下调用这些方法，例如：

```
ClassName.static_method() 
```

* * *

## 回答 #1

> 赞同：2173
> 
> 时间：2009-04-09T21:24:36.013

是的，使用[staticmethod](https://docs.python.org/3/library/functions.html#staticmethod "静态方法")装饰器

```
class MyClass(object):
    @staticmethod
    def the_static_method(x):
        print(x)

MyClass.the_static_method(2)  # outputs 2 
```

请注意，某些代码可能使用定义静态方法的旧方法，将其`staticmethod`用作函数而不是装饰器。仅当您必须支持 Python 的旧版本（2.2 和 2.3）时才应使用此选项

```
class MyClass(object):
    def the_static_method(x):
        print(x)
    the_static_method = staticmethod(the_static_method)

MyClass.the_static_method(2)  # outputs 2 
```

这与第一个示例完全相同（使用`@staticmethod`），只是没有使用漂亮的装饰器语法

最后，[`staticmethod`](https://docs.python.org/3/library/functions.html#staticmethod "静态方法")谨慎使用！在 Python 中很少有需要静态方法的情况，而且我已经看到它们多次使用，其中单独的“顶级”函数会更清晰。

* * *

[以下是文档中的逐字记录](https://docs.python.org/3/library/functions.html#staticmethod "静态方法")：

> 静态方法不接收隐式的第一个参数。要声明静态方法，请使用以下习惯用法：
> 
> ```
> class C:
>     @staticmethod
>     def f(arg1, arg2, ...): ... 
> ```
> 
> @staticmethod 形式是一个函数[*装饰器*](https://docs.python.org/3/glossary.html#term-decorator "术语装饰器")——详见函数定义中[*函数定义*](https://docs.python.org/3/reference/compound_stmts.html#function "函数定义")的描述。
> 
> 它可以在类（例如`C.f()`）或实例（例如`C().f()`）上调用。该实例被忽略，除了它的类。
> 
> Python 中的静态方法类似于 Java 或 C++ 中的静态方法。有关更高级的概念，请参阅[`classmethod()`](https://docs.python.org/3/library/functions.html#classmethod "类方法")。
> 
> 有关静态方法的更多信息，请参阅标准类型层次结构中[*有关标准类型层次*](https://docs.python.org/3/reference/datamodel.html#types "类型")结构的文档。
> 
> 2.2 版中的新功能。
> 
> 在 2.4 版更改: 添加了函数装饰器语法。

* * *

## 回答 #2

> 赞同：241
> 
> 时间：2012-04-18T09:16:03.530

我认为[史蒂文实际上是对的](https://stackoverflow.com/a/738102/3798217)。为了回答最初的问题，为了设置类方法，只需假设第一个参数不会是调用实例，然后确保您只从类中调用该方法。

（请注意，此答案指的是 Python 3.x。在 Python 2.x 中，您将获得一个`TypeError`用于调用类本身的方法。）

例如：

```
class Dog:
    count = 0 # this is a class variable
    dogs = [] # this is a class variable

    def __init__(self, name):
        self.name = name #self.name is an instance variable
        Dog.count += 1
        Dog.dogs.append(name)

    def bark(self, n): # this is an instance method
        print("{} says: {}".format(self.name, "woof! " * n))

    def rollCall(n): #this is implicitly a class method (see comments below)
        print("There are {} dogs.".format(Dog.count))
        if n >= len(Dog.dogs) or n < 0:
            print("They are:")
            for dog in Dog.dogs:
                print("  {}".format(dog))
        else:
            print("The dog indexed at {} is {}.".format(n, Dog.dogs[n]))

fido = Dog("Fido")
fido.bark(3)
Dog.rollCall(-1)
rex = Dog("Rex")
Dog.rollCall(0) 
```

在这段代码中，“rollCall”方法假定第一个参数不是实例（如果它是由实例而不是类调用的）。只要从类而不是实例调用“rollCall”，代码就可以正常工作。如果我们尝试从一个实例调用“rollCall”，例如：

```
rex.rollCall(-1) 
```

但是，它会导致引发异常，因为它会发送两个参数：自身和 -1，并且“rollCall”仅定义为接受一个参数。

顺便说一句，rex.rollCall() 将发送正确数量的参数，但也会导致引发异常，因为当函数期望 n 为数字时，现在 n 将表示 Dog 实例（即 rex）。

这就是装饰的用武之地：如果我们在“rollCall”方法之前使用

```
@staticmethod 
```

然后，通过明确声明该方法是静态的，我们甚至可以从实例中调用它。现在，

```
rex.rollCall(-1) 
```

会工作。然后，在方法定义之前插入@staticmethod 会阻止实例将自身作为参数发送。

您可以通过尝试以下代码来验证这一点，无论是否注释掉 @staticmethod 行。

```
class Dog:
    count = 0 # this is a class variable
    dogs = [] # this is a class variable

    def __init__(self, name):
        self.name = name #self.name is an instance variable
        Dog.count += 1
        Dog.dogs.append(name)

    def bark(self, n): # this is an instance method
        print("{} says: {}".format(self.name, "woof! " * n))

    @staticmethod
    def rollCall(n):
        print("There are {} dogs.".format(Dog.count))
        if n >= len(Dog.dogs) or n < 0:
            print("They are:")
            for dog in Dog.dogs:
                print("  {}".format(dog))
        else:
            print("The dog indexed at {} is {}.".format(n, Dog.dogs[n]))

fido = Dog("Fido")
fido.bark(3)
Dog.rollCall(-1)
rex = Dog("Rex")
Dog.rollCall(0)
rex.rollCall(-1) 
```

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2009-04-09T21:24:15.047

是的，看看[staticmethod](http://docs.python.org/library/functions.html#staticmethod)装饰器：

```
>>> class C:
...     @staticmethod
...     def hello():
...             print "Hello World"
...
>>> C.hello()
Hello World 
```

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2009-04-10T16:00:50.773

你真的不需要使用`@staticmethod`装饰器。只需声明一个方法（不需要 self 参数）并从类中调用它。装饰器仅在您希望能够从实例中调用它的情况下才存在（这不是您想要做的）

大多数情况下，你只是使用函数......

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2015-01-24T04:34:35.547

> **Python中的静态方法？**
> 
> 是否可以在 Python 中使用静态方法，这样我就可以在不初始化类的情况下调用它们，例如：
> 
> ```
> ClassName.StaticMethod() 
> ```

是的，静态方法可以像这样创建（尽管使用下划线而不是 CamelCase 方法有点[Pythonic ）：](https://www.python.org/dev/peps/pep-0008/)

```
class ClassName(object):

    @staticmethod
    def static_method(kwarg1=None):
        '''return a value that is a function of kwarg1''' 
```

上面使用了装饰器语法。此语法等价于

```
class ClassName(object):

    def static_method(kwarg1=None):
        '''return a value that is a function of kwarg1'''

    static_method = staticmethod(static_method) 
```

这可以像你描述的那样使用：

```
ClassName.static_method() 
```

Python 3中有一个静态方法的内置示例，它是Python 2 模块中`str.maketrans()`的一个函数。`string`

* * *

如您所描述的，可以使用的另一个选项是`classmethod`，不同之处在于 classmethod 将类作为隐式第一个参数，如果是子类，则它将子类作为隐式第一个参数。

```
class ClassName(object):

    @classmethod
    def class_method(cls, kwarg1=None):
        '''return a value that is a function of the class and kwarg1''' 
```

请注意，这`cls`不是第一个参数的必需名称，但如果您使用其他任何东西，大多数有经验的 Python 编码人员会认为它做得不好。

这些通常用作替代构造函数。

```
new_instance = ClassName.class_method() 
```

一个内置的例子是`dict.fromkeys()`：

```
new_dict = dict.fromkeys(['key1', 'key2']) 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2012-12-29T19:47:13.523

除了[静态方法对象](http://docs.python.org/2/reference/datamodel.html#types)行为方式的特殊性之外，在组织模块级代码时，您还可以使用它们来发挥某种美感。

```
# garden.py
def trim(a):
    pass

def strip(a):
    pass

def bunch(a, b):
    pass

def _foo(foo):
    pass

class powertools(object):
    """
    Provides much regarded gardening power tools.
    """
    @staticmethod
    def answer_to_the_ultimate_question_of_life_the_universe_and_everything():
        return 42

    @staticmethod
    def random():
        return 13

    @staticmethod
    def promise():
        return True

def _bar(baz, quux):
    pass

class _Dice(object):
    pass

class _6d(_Dice):
    pass

class _12d(_Dice):
    pass

class _Smarter:
    pass

class _MagicalPonies:
    pass

class _Samurai:
    pass

class Foo(_6d, _Samurai):
    pass

class Bar(_12d, _Smarter, _MagicalPonies):
    pass 
```

...

```
# tests.py
import unittest
import garden

class GardenTests(unittest.TestCase):
    pass

class PowertoolsTests(unittest.TestCase):
    pass

class FooTests(unittest.TestCase):
    pass

class BarTests(unittest.TestCase):
    pass 
```

...

```
# interactive.py
from garden import trim, bunch, Foo

f = trim(Foo())
bunch(f, Foo()) 
```

...

```
# my_garden.py
import garden
from garden import powertools

class _Cowboy(garden._Samurai):
    def hit():
        return powertools.promise() and powertools.random() or 0

class Foo(_Cowboy, garden.Foo):
    pass 
```

它现在变得更加直观和自我记录，在哪些上下文中使用某些组件，并且它非常适合命名不同的测试用例，以及为纯粹主义者提供测试模块如何映射到实际测试模块的直接方法.

我经常发现将这种方法应用于组织项目的实用程序代码是可行的。很多时候，人们会立即冲上去创建一个`utils`包，最终得到 9 个模块，其中一个有 120 个 LOC，其余的最多是两打 LOC。我更喜欢从这个开始并将其转换为一个包并仅为真正值得它们的野兽创建模块：

```
# utils.py
class socket(object):
    @staticmethod
    def check_if_port_available(port):
        pass

    @staticmethod
    def get_free_port(port)
        pass

class image(object):
    @staticmethod
    def to_rgb(image):
        pass

    @staticmethod
    def to_cmyk(image):
        pass 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-07-30T16:10:48.050

也许最简单的选择就是将这些函数放在类之外：

```
class Dog(object):
    def __init__(self, name):
        self.name = name

    def bark(self):
        if self.name == "Doggy":
            return barking_sound()
        else:
            return "yip yip"

def barking_sound():
    return "woof woof" 
```

使用这种方法，可以将修改或使用内部对象状态（具有副作用）的函数保留在类中，并将可重用的实用程序函数移到外部。

假设这个文件被称为`dogs.py`. 要使用这些，您需要调用`dogs.barking_sound()`而不是`dogs.Dog.barking_sound`.

如果你真的需要一个静态方法作为类的一部分，你可以使用[staticmethod](http://docs.python.org/library/functions.html#staticmethod)装饰器。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2019-06-04T13:28:10.337

因此，静态方法是无需创建类的对象即可调用的方法。例如 ：-

```
 @staticmethod
    def add(a, b):
        return a + b

b = A.add(12,12)
print b 
```

在上面的示例中，方法`add`是由类名`A`而不是对象名调用的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-10-26T17:11:02.747

总结其他人的答案并补充，有很多方法可以在**python**中声明静态方法或变量。

1.  使用[staticmethod()](https://docs.python.org/3/library/functions.html#staticmethod)作为装饰器：可以简单地将装饰器放在声明的方法（函数）之上，使其成为静态方法。例如。

```
class Calculator:
    @staticmethod
    def multiply(n1, n2, *args):
        Res = 1
        for num in args: Res *= num
        return n1 * n2 * Res

print(Calculator.multiply(1, 2, 3, 4))              # 24 
```

2.  使用[staticmethod()](https://docs.python.org/3/library/functions.html#staticmethod)作为参数函数：该方法可以接收函数类型的参数，并返回传递函数的静态版本。例如。

```
class Calculator:
    def add(n1, n2, *args):
        return n1 + n2 + sum(args)

Calculator.add = staticmethod(Calculator.add)
print(Calculator.add(1, 2, 3, 4))                   # 10 
```

3.  使用[classmethod()](https://docs.python.org/3/library/functions.html#classmethod)作为装饰器：@classmethod 对函数的影响与 @staticmethod 类似，但这次需要在函数中接受一个额外的参数（类似于实例变量的 self 参数）。例如。

```
class Calculator:
    num = 0
    def __init__(self, digits) -> None:
        Calculator.num = int(''.join(digits))

    @classmethod
    def get_digits(cls, num):
        digits = list(str(num))
        calc = cls(digits)
        return calc.num

print(Calculator.get_digits(314159))                # 314159 
```

4.  使用[classmethod()](https://docs.python.org/3/library/functions.html#classmethod)作为参数函数：@classmethod 也可以用作参数函数，以防不想修改类定义。例如。

```
class Calculator:
    def divide(cls, n1, n2, *args):
        Res = 1
        for num in args: Res *= num
        return n1 / n2 / Res

Calculator.divide = classmethod(Calculator.divide)

print(Calculator.divide(15, 3, 5))                  # 1.0 
```

5.  直接声明 在所有其他方法之外但在类内部声明的方法/变量自动是静态的。

```
class Calculator:   
    def subtract(n1, n2, *args):
        return n1 - n2 - sum(args)

print(Calculator.subtract(10, 2, 3, 4))             # 1 
```

整个节目

```
class Calculator:
    num = 0
    def __init__(self, digits) -> None:
        Calculator.num = int(''.join(digits))

    @staticmethod
    def multiply(n1, n2, *args):
        Res = 1
        for num in args: Res *= num
        return n1 * n2 * Res

    def add(n1, n2, *args):
        return n1 + n2 + sum(args)

    @classmethod
    def get_digits(cls, num):
        digits = list(str(num))
        calc = cls(digits)
        return calc.num

    def divide(cls, n1, n2, *args):
        Res = 1
        for num in args: Res *= num
        return n1 / n2 / Res

    def subtract(n1, n2, *args):
        return n1 - n2 - sum(args)

Calculator.add = staticmethod(Calculator.add)
Calculator.divide = classmethod(Calculator.divide)

print(Calculator.multiply(1, 2, 3, 4))              # 24
print(Calculator.add(1, 2, 3, 4))                   # 10
print(Calculator.get_digits(314159))                # 314159
print(Calculator.divide(15, 3, 5))                  # 1.0
print(Calculator.subtract(10, 2, 3, 4))             # 1 
```

请参阅[Python 文档](https://www.python.org/doc/versions/)以掌握 Python 中的 OOP。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-01-08T06:53:01.247

我不时遇到这个问题。我喜欢的用例和示例是：

```
jeffs@jeffs-desktop:/home/jeffs  $ python36
Python 3.6.1 (default, Sep  7 2017, 16:36:03) 
[GCC 6.3.0 20170406] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import cmath
>>> print(cmath.sqrt(-4))
2j
>>>
>>> dir(cmath)
['__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'acos', 'acosh', 'asin', 'asinh', 'atan', 'atanh', 'cos', 'cosh', 'e', 'exp', 'inf', 'infj', 'isclose', 'isfinite', 'isinf', 'isnan', 'log', 'log10', 'nan', 'nanj', 'phase', 'pi', 'polar', 'rect', 'sin', 'sinh', 'sqrt', 'tan', 'tanh', 'tau']
>>> 
```

创建 cmath 类的对象没有意义，因为 cmath 对象中没有状态。然而， cmath 是一个方法的集合，它们都以某种方式相关。在我上面的示例中， cmath 中的所有函数都以某种方式作用于复数。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2018-12-20T09:04:33.053

Python 静态方法可以通过两种方式创建。

1.  **使用静态方法（）**

    ```
    class Arithmetic:
        def add(x, y):
            return x + y
    # create add static method
    Arithmetic.add = staticmethod(Arithmetic.add)

    print('Result:', Arithmetic.add(15, 10)) 
    ```

**输出：**

结果：25

2.  **使用@staticmethod**

    ```
    class Arithmetic:

    # create add static method
    @staticmethod
    def add(x, y):
        return x + y

    print('Result:', Arithmetic.add(15, 10)) 
    ```

**输出：**

结果：25

# asp.net - SSL WebServer 上的 JQuery AJAX Web 服务调用

> ID：735977
> 
> 赞同：0
> 
> 时间：2009-04-09T21:24:33.577
> 
> 标签：asp.net, jquery, ajax, web-services

我正在对网络服务器本地的网络服务进行 POST。一切都很好，直到我在启用 SSL 的网络服务器上托管该站点。网络服务路径是相对的，意思是，我没有参考协议。**例如。/webservices/method.asmx**

POST 导致运行时错误。有没有人见过这个？

```
$.ajax({
    type: "POST",
    url: theURL + "/" + method,
    data: body,
    success: function (msg) {
        alert("Data Saved: " + msg);

    },
    error: function (msg) {
        alert("Broken: " + theURL + "/" + method + msg.responseText);
    }
}); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T23:00:46.597

因为这个项目是在 .NET 2.0 中完成的。web 方法似乎以不同的方式处理输入数据。我可以通过构造一个查询字符串并传递它而不是 JSON 对象来解决这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T21:32:33.620

如果您指定一个绝对 url，包括协议 https:// 片段会发生什么...我通常在我的 masterpages/template 中为 prot://host:port/apppath/ 参考的“baseURL”放置一个 javascript 变量。 . 其中端口仅在不是默认值时才包括在内。没有，iirc，看到这样的问题。

# google-app-engine - 如何动态确定 Google App Engine 中是否存在 Model 类？

> ID：735985
> 
> 赞同：1
> 
> 时间：2009-04-09T21:28:14.460
> 
> 标签：google-app-engine, model, google-cloud-datastore

我希望能够获取一个动态创建的字符串，比如“Pigeon”，并在运行时确定 Google App Engine 是否在该项目中定义了一个名为“Pigeon”的模型类。如果“Pigeon”是现有模型类的名称，那么我想获得对如此定义的 Pigeon 类的引用。

另外，我根本不想使用 eval，因为在这种情况下，动态字符串“Pigeon”来自外部。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T21:33:46.207

您可以尝试，尽管可能非常非常糟糕的做法：

```
def get_class_instance(nm) :
    try :
        return eval(nm+'()')
    except :
        return None 
```

另外，为了更安全，你可以给 eval 一个本地哈希：`eval(nm+'()', {'Pigeon':pigeon})`

我不确定这是否可行，它肯定有一个问题：如果有一个名为 value of 的函数`nm`，它将返回：

```
def Pigeon() :
    return "Pigeon"
print(get_class_instance('Pigeon')) # >> 'Pigeon' 
```

**编辑**：如果您知道模块，另一种方法可能是（未经测试）：（
*对不起，我一直忘记它不是 obj.hasattr，它的 hasattr(obj)！）*

```
import models as m
def get_class_instance(nm) :
    if hasattr(m, nm) :
        return getattr(m, nm)()
    else : return None 
```

**编辑2**：是的，它确实有效！哇！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T19:03:49.557

实际上，通过查看源代码和互联网，我发现了一个似乎符合要求的未记录方法。

```
from google.appengine.ext import db

key = "ModelObject" #This is a dynamically generated string

klass = db.class_for_kind(key) 
```

如果类不存在，此方法将抛出描述性异常，因此如果键字符串来自外部，您可能应该捕获它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-03T14:15:57.370

有两种相当简单的方法可以做到这一点，而不依赖于内部细节：

使用 google.appengine.api.datastore API，如下所示：

```
from google.appengine.api import datastore

q = datastore.Query('EntityType')
if q.get(1):
  print "EntityType exists!" 
```

另一种选择是使用 db.Expando 类：

```
def GetEntityClass(entity_type):
  class Entity(db.Expando):
    @classmethod
    def kind(cls):
      return entity_type
  return Entity

cls = GetEntityClass('EntityType')
if cls.all().get():
  print "EntityType exists!" 
```

后者的优点是您可以使用 GetEntityClass 为任何实体类型生成 Expando 类，并以与普通类相同的方式与之交互。

# php - 来自 SOAP 的文件，如何保存？

> ID：735990
> 
> 赞同：0
> 
> 时间：2009-04-09T21:30:13.377
> 
> 标签：php, soap, wsdl, nusoap

我正在与客户合作从他们的网络服务中获取 gzip。我可以通过以下电话获得回复：

```
$response = $client->call('branchzipdata', $param);
$filename = "test.gzip";
if (!$handle = fopen($filename, 'a')) {
     echo "Cannot open file ($filename)";
     exit;
}

if (fwrite($handle, $response) === FALSE) {
    echo "Cannot write to file ($filename)";
    exit;
} 
```

现在，当我尝试编写该文件时，例如“test.gzip”，之后我无法打开它......很可能是因为我做错了可怕的事情。任何见解将不胜感激。

编辑：

出于某种原因，我将文件保存为“.gzip”而不是“.gz”......所以为了让它工作，我现在有：

```
$response = $client->call('call', $param);
$content = base64_decode($response);
$filename = "output_zip.gz";
if (!$handle = fopen($filename, 'w')) {
    echo "Cannot open file ($filename)";
    exit;
}

if (fwrite($handle, $content) === FALSE) {
  echo "Cannot write to file ($filename)";
  exit;
}
fclose($handle);
echo system("gzip -d $filename"); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T21:32:05.340

（根据评论编辑）

如果返回值是 base64 编码的，则需要在将其写入文件之前对其进行 base64 解码。或者，您可以将它写到一个文件中，然后在尝试打开它之前将其 base64 解码到*另一个*文件，但这与第一次获取它时仅解码它相比似乎有点毫无意义。

# javascript - IE 中的自动关闭弹出窗口——如何获得正确的 onBlur 行为？

> ID：735992
> 
> 赞同：1
> 
> 时间：2009-04-09T21:30:43.673
> 
> 标签：javascript, internet-explorer, dojo, popup, onblur

当用户点击离开它时，我希望一个瞬态窗口自行关闭。这适用于火狐：

```
var w = window.open(...);
dojo.connect(w, "onblur", w, "close"); 
```

但它似乎不适用于 Internet Explorer。其他一些网站提到了一个特定于 IE 的“onfocusout”事件，但我找不到我需要的一个连贯的工作示例。

Stack Overflow 对让 IE 浏览器窗口在失去焦点时关闭的最佳方法有什么看法？

我正在使用 Dojo，所以如果该库中有一些快捷方式，欢迎提供信息。否则标准 IE 调用将是最好的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T15:03:09.040

我在 IE 中找到了替代方案。

这：

```
 that.previewWindowAction = function () {
            var pw =
                window.open(this.link, "preview",
                            "height=600,width=1024,resizable=yes,"
                            + "scrollbars=yes,dependent=yes");
            dojo.connect(pw, "onblur", pw, "close");
        }; 
```

应该这样写才能在 IE 中工作：

```
 that.previewWindowAction = function () {
            var pw =
                window.open(this.link, "preview",
                            "height=600,width=1024,resizable=yes,"
                            + "scrollbars=yes,dependent=yes");
            if (dojo.isIE) {
                dojo.connect
                    (pw.document,
                     "onfocusin",
                     null,
                     function () {
                         var active = pw.document.activeElement;
                         dojo.connect
                             (pw.document,
                              "onfocusout",
                              null,
                              function () {
                                  if (active != pw.document.activeElement) {
                                      active = pw.document.activeElement;
                                  } else {
                                      window.open("", "preview").close();
                                  }
                              });
                     });

            }
            else {
                dojo.connect(pw, "onblur", pw, "close");
            }
        }; 
```

原因？

*   在 IE 中，窗口对象不响应模糊事件。因此我们必须使用专有的 onfocusout 事件。
*   在 IE 中，onfocusout 是由大多数 HTML 元素发送的，因此我们必须添加一些逻辑来确定哪个 onfocusout 是由窗口失去焦点引起的。在 onfocusout 中，文档的 activeElement 属性始终与之前的值不同——*除非*窗口本身失去焦点。这是关闭窗口的提示。
*   在 IE 中，新窗口中的文档在首次创建窗口时会发送 onfocusout。因此，我们必须只在它获得焦点后添加 onfocusout 处理程序。
*   在 IE 中，window.open 在创建新窗口时似乎无法可靠地返回窗口句柄。因此，我们必须按名称查找窗口才能关闭它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T22:55:27.370

尝试：

```
document.onfocusout = window.close(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T22:02:35.203

您可以尝试将此作为 IE 特定代码块的一部分：

```
w.onblur = function() { w.close();}; 
```

# cocoa - 突出显示 NSTableColumn 中的文本颜色

> ID：735996
> 
> 赞同：2
> 
> 时间：2009-04-09T21:31:57.930
> 
> 标签：cocoa, colors, nstableview, highlighting, nstablecolumn

我在 NSTableView 中有一列单元格，它们从应用程序的首选项 plist 中获取它们的文本颜色。我想在突出显示时将文本颜色设置为白色，但一直无法找到一个好的方法来做到这一点。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T22:18:57.597

假设没有更简单的方法可以做到这一点，请实现`tableView:willDisplayCell:forTableColumn:row:`委托方法以将单元格设置`textColor`为`[NSColor alternateSelectedControlTextColor]`或者`[NSColor selectedControlTextColor]`取决于是否`rowIndex`在表格视图的`selectedRowIndexes`集合中。

（“<code>{alternateS,s}electedControlTextColor”中的“selected”指的是控件，而不是文本。您正在为选定的控件使用替代（或非替代）文本颜色，即表格视图。 )**********```**`