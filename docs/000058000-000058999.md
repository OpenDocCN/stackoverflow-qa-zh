# StackOverflow 问答 000058000-000058999

# apache-flex - 在 ant/nant 中构建 Flex 项目

> ID：58000
> 
> 赞同：7
> 
> 时间：2008-09-12T00:23:23.867
> 
> 标签：apache-flex, build-process, nant, flexbuilder

在我的公司，我们的 Flex 项目中经常出现构建中断的问题。问题的出现主要是因为开发人员在他们的本地机器上进行的构建与在构建机器上发生的构建根本不同。开发人员正在使用构建项目`FlexBuilder/eclipse`，构建机器正在使用命令行编译器。不可避免地，`{projectname}-config.xml`运行构建的和/或批处理文件与 eclipse 使用的项目文件不同步，因此构建在开发机器上成功，但在构建机器上失败。

我们开始编写实用程序来将 FlexBuilder 的项目文件转换为`{projectname}-config.xml`文件，但它 a) 没有文档，b) 是一个可怕的 hack。

我查看了 -dump-config 开关以获取配置文件，但这有几个问题：1）生成的配置文件具有在我们的环境中不起作用的绝对路径（一些开发人员使用 mac，一些 windows机器）和 2）仅在从 IDE 运行时才能正常工作，因此不能构建到构建过程中。

明天，我们将讨论几个我不太喜欢的选项：

**a)**向 Subversion 添加一个签入后事件以删除这些绝对引用，或
**b)**添加一个删除绝对引用的预构建过程。

我不敢相信我们是第一批遇到这个问题的开发人员，但我在 Google 上找不到任何好的解决方案。其他团体是如何处理这个问题的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T16:18:18.273

虽然不是针对您的特定问题的解决方案，但解决方法是使用持续集成服务器。

使用[Cruise Control](http://cruisecontrol.sourceforge.net/)之类的工具，您可以在每次有人向源代码控制提交内容时启动自动构建。然后，如果构建由于任何原因（包括环境不一致）失败，则由破坏它的开发人员来修复它。您可以将其配置为以各种方式发送失败/成功的电子邮件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-13T15:28:00.440

我发现将 ant 与 Flexbuilder 一起使用的未记录要求之一是在您的 ant 脚本中设置变量 FLEX_HOME。通常在 build.xml 中有以下内容：

```
<!– Module properties –&gt;
<property environment=”env”/>
<property name=”build.dir” value=”build”/>
<property name=”swf.name” value=”MyProjectSwf”/>
<property name=”root.mxml” value=”Main.mxml”/>
<property name=”locale” value=”en_US”/>
<property name=”FLEX_HOME” value=”${env.FLEX_HOME}”/> 
```

这可能看起来很麻烦，但如果您为开发人员使用多个平台，这是一种更合理的方法来获得跨平台和环境的一致性。

高温高压

# .net - 从 Windows 窗体打开 URL

> ID：58024
> 
> 赞同：80
> 
> 时间：2008-09-12T00:40:55.807
> 
> 标签：.net, winforms

我正在尝试从 Windows 窗体提供指向我公司网站的链接。我希望表现良好并使用用户首选的浏览器启动。

从 Windows 窗体应用程序在用户的默认浏览器中打开 URL 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-09-12T00:44:25.563

本文将[引导](http://support.microsoft.com/kb/320478)您完成它。

简短的回答：

```
ProcessStartInfo sInfo = new ProcessStartInfo("http://mysite.com/");  
Process.Start(sInfo); 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-12T00:43:59.730

```
using System.Diagnostics;

Process.Start("http://www.google.com/"); 
```

这种方法对我有用，但我可能会遗漏一些重要的东西。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-08-16T14:46:21.007

这是两全其美：

```
Dim sInfo As New ProcessStartInfo("http://www.mysite.com")

Try
     Process.Start(sInfo)
Catch ex As Exception
     Process.Start("iexplore.exe", sInfo.FileName)
End Try 
```

我发现当桌面应用程序在 Windows 8 设备上运行时，Blorgbeard 提供的答案将失败。就 Camillo 而言，您应该尝试使用用户的默认浏览器应用程序打开它，但如果未分配浏览器应用程序，则会引发未处理的异常。

我将其发布为答案，因为它处理异常同时仍尝试在默认浏览器中打开链接。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2020-06-23T12:09:43.133

对于那些得到“Win32Exception：系统找不到指定的文件”的人

这应该做的工作：

```
ProcessStartInfo psInfo = new ProcessStartInfo
{
   FileName = "https://www.google.com",
   UseShellExecute = true
};
Process.Start(psInfo); 
```

UseShellExecute[在此处进一步描述](https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.processstartinfo.useshellexecute?view=netcore-3.1)

对我来说，问题是由于[此处描述的 .NET 运行时](https://github.com/dotnet/runtime/issues/17938)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-09-30T22:20:49.383

我喜欢[这里](http://code.logos.com/blog/2008/01/using_processstart_to_link_to.html)描述的方法。它考虑了启动浏览器时可能出现的异常和延迟。

为了获得最佳实践，请确保您不只是忽略异常，而是捕获它并执行适当的操作（例如通知用户打开浏览器以将其导航到该 url 失败）。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2012-10-01T13:36:41.597

上面的方法很完美，我想推荐这种方法来传递参数。

```
Process mypr;
mypr = Process.Start("iexplore.exe", "pass the name of website"); 
```

# windows - 如何在 Visual Studio 中嵌入命令外壳

> ID：58027
> 
> 赞同：2
> 
> 时间：2008-09-12T00:42:13.713
> 
> 标签：windows, command-line, visual-studio-2005

我希望能够在 Visual Studio 的可停靠窗口中嵌入命令行解释器。有什么好方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T00:49:55.007

查看[VS Command shell](http://www.codeplex.com/Wiki/View.aspx?ProjectName=VSCmdShell)项目

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-01-05T09:51:19.483

查看Mads Kristensen 的[Open Command Line](https://marketplace.visualstudio.com/items?itemName=MadsKristensen.OpenCommandLine)。**请注意**，它并没有真正将外壳“嵌入”到 VS 中，而是添加了一个键盘快捷键以在项目目录中打开外壳

它支持 bash、powershell、git bash 等

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-12-11T17:07:39.413

在 Visual Studio 中单击工具 -> NuGet 包管理器 -> 包管理器控制台

它嵌入了一个 cmd 提示符，其中包含您期望的 %PATH% 上的所有内容。

# c# - 加载同一程序集的不同版本

> ID：58035
> 
> 赞同：24
> 
> 时间：2008-09-12T00:45:51.847
> 
> 标签：c#, .net, reflection, dll, assemblies

使用反射，我需要加载同一程序集的 2 个不同版本。我可以在同一进程中加载​​ 2 个不同 AppDomain 中的 2 个版本吗？

我需要从旧版本的应用程序到新版本进行一些数据迁移。请让我知道这是否可行，或者我应该使用 2 个单独的过程。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-12T00:49:24.243

如果您在设计时这样做（您表示您不是），这应该可以帮助您：

[http://blogs.msdn.com/abhinaba/archive/2005/11/30/498278.aspx](http://blogs.msdn.com/abhinaba/archive/2005/11/30/498278.aspx)

如果您通过反射动态地执行此操作（看起来像这里的情况），这可能会对您有所帮助：

[https://www.infosysblogs.com/microsoft/2007/04/loading_multiple_versions_of_s.html](https://www.infosysblogs.com/microsoft/2007/04/loading_multiple_versions_of_s.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-12T13:33:38.383

**更新**：我想我会发布我的发现作为答案。在开发工作、跟踪运行时错误等方面，反射被证明太复杂了。我记得很久以前遇到类似情况时，我使用 2 个不同的进程使用了​​不同的方法（谢谢布兰登）。

这是计划：在开发和故障排除方面没有什么优雅但更容易的。由于这是一次性的工作，我们只需要让它发挥作用。

托管具有新版本应用程序的远程处理进程（我称之为服务器）。远程客户端具有旧版本的引用。

远程客户端实例化并加载具有迁移所需数据的对象。将旧对象转换为通用的可序列化对象，并作为参数传递给服务器。

Remoting Server 使用公共数据来实例化和加载新对象。调用新类型的函数以保存其数据。

# c# - 我的进程是如何退出的？

> ID：58036
> 
> 赞同：1
> 
> 时间：2008-09-12T00:46:22.703
> 
> 标签：c#, .net, system.diagnostics

从 Windows 机器上的 C# 中，有没有办法找出进程是如何停止的？我已经查看了[Process](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)类，一旦我设置，就设法从 Exited 事件中获得一个很好的友好回调，`EnableRaisingEvents = true;`但我还没有设法找出进程是否被杀死或它是否自然退出？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T01:30:48.807

启动 Process Monitor（来自 Sysinternals，Microsoft 的一部分），运行您的进程并让它停止运行，然后按您的进程名称过滤 Process Monitor 结果——您将能够看到它所做的一切，包括退出代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T00:57:23.537

您可以为此使用该过程的返回码。如果您的进程从其 Main 方法返回一个非零值，则您可以检查该进程是否自行退出（返回值匹配）。

# string - 如何使用 JSP 和 JSTL 替换换行符？

> ID：58054
> 
> 赞同：45
> 
> 时间：2008-09-12T00:57:11.900
> 
> 标签：string, jsp, replace, jstl, newline

我有一个传递到我的 JSP 页面的 bean 对象列表，其中一个是注释字段。该字段可能包含换行符，我想使用 JSTL 将它们替换为分号，以便该字段可以显示在文本输入中。我找到了一种解决方案，但它不是很优雅。我将在下面发布作为一种可能性。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-12T00:59:31.160

这是我找到的解决方案。不过，它似乎不是很优雅：

```
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<% pageContext.setAttribute("newLineChar", "\n"); %>

${fn:replace(item.comments, newLineChar, "; ")} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-11-06T22:31:08.207

只需使用`fn:replace()`函数替换`\n`为`;`.

```
${fn:replace(data, '\n', ';')} 
```

如果您使用 Apache 的 EL 实现而不是 Oracle 的 EL 参考实现（即当您使用 Tomcat、TomEE、JBoss 等而不是 GlassFish、Payara、WildFly、WebSphere 等时），那么您需要重新转义反斜杠。

```
${fn:replace(data, '\\n', ';')} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-08-19T16:15:18.507

这类似于接受的答案（因为它使用 Java 来表示换行符而不是 EL），但这里 <c:set/> 元素用于设置属性：

```
<c:set var="newline" value="<%= \"\n\" %>" />
${fn:replace(myAddress, newline, "<br />")} 
```

下面的代码片段也可以，但是 <c:set/> 元素的第二行不能缩进（并且可能看起来更丑）：

```
 <c:set var="newline" value="
" /><!--this line can't be indented -->
    ${fn:replace(myAddress, newline, "<br />")} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-09T12:00:22.430

此解决方案比您自己直接设置 pagecontext 属性的解决方案更优雅。您应该`<c:set>`为此使用标签：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>

<c:set var="newLine" value="\n"/>
${fn:replace(data, newLine, "; ")} 
```

顺便说一句：`${fn:replace(data, "\n", ";")}`不起作用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-12T01:29:45.800

您可以创建自己的 JSP 函数。 [http://java.sun.com/j2ee/1.4/docs/tutorial/doc/JSPTags6.html](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/JSPTags6.html)

这大致就是你需要做的。

创建标签库描述符文件
/src/META-INF/sf.tld

```
<?xml version="1.0" encoding="UTF-8"?>
<taglib version="2.0" xmlns="http://java.sun.com/xml/ns/j2ee" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_0.xsd">
  <tlib-version>1.0</tlib-version>
  <short-name>sf</short-name>
  <uri>http://www.stackoverflow.com</uri>
  <function>
    <name>clean</name>
    <function-class>com.stackoverflow.web.tag.function.TagUtils</function-class>
    <function-signature>
      java.lang.String clean(java.lang.String)
    </function-signature>
  </function>
</taglib> 
```

为函数逻辑创建一个 Java 类。
com.stackoverflow.web.tag.function.TagUtils

```
package com.stackoverflow.web.tag.function;

import javax.servlet.jsp.tagext.TagSupport;

public class TagUtils extends TagSupport {
  public static String clean(String comment) {
    return comment.replaceAll("\n", "; ");
  }
} 
```

在您的 JSP 中，您可以通过以下方式访问您的函数。

```
<%@ taglib prefix="sf" uri="http://www.stackoverflow.com"%>
${sf:clean(item.comments)} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-11-06T22:23:23.357

这对我不起作用：

```
<c:set var="newline" value="\n"/>
${fn:replace(data, newLine, "; ")} 
```

这样做：

```
<% pageContext.setAttribute("newLineChar", "\n"); %> 
${fn:replace(item.comments, newLineChar, "; ")} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-08-05T17:55:23.567

如果您真正需要的是 \n 符号，则可以使用[此处](http://www.coderanch.com/t/283187/JSP/java/New-Line-character-JSTL-set#1298039)的建议：

```
${fn:replace(text, "
", "<br/>")} 
```

或者

```
<c:set var="nl" value="
" /><%-- this is a new line --%> 
```

这包括字符串文字中的新行。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-12T01:19:14.623

您应该可以使用 fn:replace 来完成。

您需要使用以下声明将标签库导入您的 JSP：

```
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>

```

然后，您可以使用以下表达式将 ${data} 中出现的换行符替换为分号：

```
${fn:replace(数据, "\n", ";")}

```

这些东西的文档不是很好，我没有机会测试它。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-28T12:53:48.353

\n 不代表 EL 表达式中的换行符。

将`pageContext`属性设置为换行符然后将其与 JSTL 的`fn:replace`函数一起使用的解决方案确实有效。

不过，我更喜欢使用 Jakarta String Tab Library 来解决这个问题：

```
<%@ taglib prefix="str" uri="http://jakarta.apache.org/taglibs/string-1.1" %>
...
<str:replace var="result" replace="~n" with=";" newlineToken="~n">
Text containing newlines
</str:replace>
... 
```

你可以为 newlineToken 使用任何你想要的东西；“~n”不太可能出现在我正在替换的文本中，所以这对我来说是一个合理的选择。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-07-20T15:08:46.710

这是 JSP EL 的有效解决方案：

```
"${fn:split(string1, Character.valueOf(10))}" 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-10-28T15:28:41.620

更容易：

```
<str:replace var="your_Var_replaced" replace="\n" with="Your ney caracter" newlineToken="\n">${your_Var_to_replaced}</str:replace> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-12T01:28:44.710

您可以编写自己的 JSP 函数来进行替换。

这意味着你最终会得到类似的东西：

```
<%@ taglib prefix="ns" uri="..." %>
...
${ns:replace(data)} 
```

`ns`您定义的名称空间前缀在哪里，并且`replace`是您的 JSP 函数。

这些函数很容易实现（它们只是一个静态方法），尽管目前我似乎找不到编写这些函数的好参考。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-12T04:08:53.857

在设置 var 的值中，在双引号之间按 ENTER。

${fn:replace(data, newLineChar, ";")}

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-31T16:48:13.570

作为记录，我在解决这个问题时遇到了这篇文章：

JSTL 中的多行字符串被添加为文本区域的标题属性。然后 Javascript 将其添加为 textarea 的默认文本。为了在焦点上清除此文本，值需要等于标题...但由于许多文本编辑器放置 \r\n 而不是 \n 而失败。所以follownig会去掉不需要的\r：

```
<% pageContext.setAttribute("newLineChar", "\r"); %> 
<c:set var="textAreaDefault" value="${fn:replace(textAreaDefault, newLineChar, '')}" /> 
```

# c++ - 在 .so 库中使用 C++ 类

> ID：58058
> 
> 赞同：9
> 
> 时间：2008-09-12T00:58:25.483
> 
> 标签：c++, linux, class-library

我正在尝试为 C++ 课程编写一个小型类库。

我想知道是否可以在我的共享对象中定义一组类，然后直接在演示库的主程序中使用它们。有没有什么技巧？我记得很久以前（在我开始真正编程之前）读过这篇文章，C++ 类只适用于 MFC .dll 而不是普通的，但这只是 windows 方面的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-12T01:01:22.997

C++ 类在 .so 共享库中工作正常（它们也可以在 Windows 上的非 MFC DLL 中工作，但这不是你的问题）。它实际上比 Windows 更容易，因为您不必从库中显式导出任何符号。

本文档将回答您的大部分问题： http: [//people.redhat.com/drepper/dsohowto.pdf](http://people.redhat.com/drepper/dsohowto.pdf)

要记住的主要事情是`-fPIC`在编译时使用该选项，以及`-shared`在链接时使用该选项。你可以在网上找到很多例子。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-12T02:12:30.297

# 我的解决方案/测试

这是我的解决方案，它符合我的预期。

## 代码

*猫.hh*：

```
#include <string>

class Cat
{
    std::string _name;
public:
    Cat(const std::string & name);
    void speak();
}; 
```

*猫.cpp*：

```
#include <iostream>
#include <string>

#include "cat.hh"

using namespace std;

Cat::Cat(const string & name):_name(name){}
void Cat::speak()
{
    cout << "Meow! I'm " << _name << endl;
} 
```

*主.cpp*：

```
#include <iostream>
#include <string>
#include "cat.hh"

using std::cout;using std::endl;using std::string;
int main()
{
    string name = "Felix";
    cout<< "Meet my cat, " << name << "!" <<endl;
    Cat kitty(name);
    kitty.speak();
    return 0;
} 
```

## 汇编

您首先编译共享库：

```
$ g++ -Wall -g -fPIC -c cat.cpp
$ g++ -shared -Wl,-soname,libcat.so.1 -o libcat.so.1 cat.o 
```

然后使用库中的类编译主可执行文件或 C++ 程序：

```
$ g++ -Wall -g -c main.cpp
$ g++ -Wall -Wl,-rpath,. -o main main.o libcat.so.1 # -rpath linker option prevents the need to use LD_LIBRARY_PATH when testing
$ ./main
Meet my cat, Felix!
Meow! I'm Felix
$ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T01:24:03.627

据我了解，只要您链接所有使用相同编译器编译的 .so 文件就可以了。不同的编译器以不同的方式处理符号，并且将无法链接。

这是在 Windows 上使用 COM 的优势之一，它定义了将 OOP 对象放入 DLL 的标准。我可以使用 GNU g++ 编译 DLL 并将其链接到使用 MSVC 编译的 EXE - 甚至是 VB！

# c - 如何使用 getaddrinfo_a 与 glibc 进行异步解析

> ID：58069
> 
> 赞同：18
> 
> 时间：2008-09-12T01:07:06.167
> 
> 标签：c, dns, glibc, getaddrinfo-a

一个经常被忽视的函数，它不需要外部库，但基本上没有任何文档。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-12T01:07:18.537

**更新（2010-10-11）**：Linux 手册页现在有 getaddrinfo_a 的文档，你可以在这里找到它：http: [//www.kernel.org/doc/man-pages/online/pages/man3/getaddrinfo_a .3.html](http://www.kernel.org/doc/man-pages/online/pages/man3/getaddrinfo_a.3.html)

作为免责声明，我应该补充一点，我对 C 很陌生，但并不完全是新手，所以可能存在错误或错误的编码习惯，请纠正我（我的语法也很烂）。

直到我看到 Adam Langley 的[这篇文章](https://www.imperialviolet.org/2005/06/01/asynchronous-dns-lookups-with-glibc.html)，我个人才知道它，我将给出一些代码片段来说明它的用法，并澄清一些在第一次使用时可能不太清楚的事情。使用它的好处是您可以在*socket()*、*listen()*和其他函数中轻松获取可用的数据，如果操作正确，您也不必担心 ipv4/v6。
所以从基础开始，从上面的链接中获取（你需要链接到 libanl (-lanl)）：
这是函数原型：

```
int getaddrinfo_a(int mode, struct gaicb *list[], int ent, 
                  struct sigevent *); 
```

1.  *模式*是 GAI_WAIT（这可能不是您想要的）和 GAI_NOWAIT 用于异步查找
2.  gaicb参数接受*要*查找的主机数组，*ent*参数指定该数组有多少元素
3.  *sigevent*将负责告诉函数我们将如何收到通知，稍后会详细介绍

gaicb 结构如下所示：

```
struct gaicb {
    const char *ar_name;
    const char *ar_service;
    const struct addrinfo *ar_request;
    struct addrinfo *ar_result;
}; 
```

如果您熟悉 getaddrinfo，那么这些字段对应于它们，如下所示：

```
int getaddrinfo(const char *node, const char *service,
                const struct addrinfo *hints,
                struct addrinfo **res); 
```

node 是 ar_name 字段，service 是端口，hints 参数对应 ar_request 成员，结果存储在其余部分。
现在您指定您希望如何通过 sigevent 结构获得通知：

```
struct sigevent {
    sigval_t sigev_value;
    int sigev_signo;
    int sigev_notify;
    void (*sigev_notify_function) (sigval_t);
    pthread_addr_t *sigev_notify_attributes;
}; 
```

1.  您可以通过将 _sigev_notify_ 设置为 SIGEV_NONE 来忽略通知
2.  您可以通过将 sigev_notify 设置为 SIGEV_SIGNAL 并将 sigev_signo 设置为所需信号来触发信号。请注意，当使用实时信号（*SIGRTMIN* - *SIGRTMAX*，始终通过宏和添加*SIGRTMIN* +2 等）使用它时，您可以在 sigev_value.sival_ptr 或 sigev_value.sival_int 成员中传递指针或值
3.  您可以通过将 sigev_notify 设置为 SIGEV_NONE 在新线程中请求回调

因此，基本上，如果您想查找主机名，则将 ar_name 设置为主机并将其他所有内容设置为*NULL*，如果要连接到主机，则设置 ar_name 和 ar_service ，如果要创建服务器，则指定 ar_service 和ar_result 字段。您当然可以根据自己的内心内容自定义 ar_request 成员，查看[*man getaddrinfo*](http://www.kernel.org/doc/man-pages/online/pages/man3/getaddrinfo.3.html)了解更多信息。

如果你有一个带有 select/poll/epoll/kqueue 的事件循环，为了方便起见，你可能想使用[*signalfd*](http://www.kernel.org/doc/man-pages/online/pages/man2/signalfd.2.html)。Signalfd 创建一个文件描述符，您可以在其上使用通常的事件轮询机制，如下所示：

```
#define _GNU_SOURCE //yes this will not be so standardish
#include <netdb.h>
#include <signal.h>
#include <sys/signalfd.h>

void signalfd_setup(void) {
    int sfd;
    sigset_t mask;

    sigemptyset(&mask);
    sigaddset(&mask, SIGRTMIN);
    sigprocmask(SIG_BLOCK, &mask, NULL); //we block the signal
    sfd = signalfd(-1, &mask, 0);
    //add it to the event queue
}
void signalfd_read(int fd) {
    ssize_t s;
    struct signalfd_siginfo fdsi;
    struct gaicb *host;

    while((s = read(fd, &fdsi, sizeof(struct signalfd_siginfo))) > 0){
    if (s != sizeof(struct signalfd_siginfo)) return; //thats bad
    host = fdsi.ssi_ptr; //the pointer passed to the sigevent structure
            //the result is in the host->ar_result member
            create_server(host);
    }
}
void create_server(struct gaicb *host) {
    struct addrinfo *rp, *result;
    int fd;

    result = host->ar_result;
    for(rp = result; rp != NULL; rp = rp->ai_next) {
        fd = socket(rp->ai_family, rp->ai_socktype, rp->ai_protocol);
        bind(fd, rp->ai_addr, rp->ai_addrlen);
        listen(fd, SOMAXCONN);
        //error checks are missing!

        freeaddrinfo(host->ar_request);
        freeaddrinfo(result);
        //you should free everything you put into the gaicb
    }
}
int main(int argc, char *argv[]) {
    struct gaicb *host;
    struct addrinfo *hints;
    struct sigevent sig;

    host = calloc(1, sizeof(struct gaicb));
    hints = calloc(1, sizeof(struct addrinfo));

    hints->ai_family = AF_UNSPEC; //we dont care if its v4 or v6
    hints->ai_socktype = SOCK_STREAM;
    hints->ai_flags = AI_PASSIVE;
    //every other field is NULL-d by calloc

    host->ar_service = "8888"; //the port we will listen on
    host->ar_request = hints;

    sig.sigev_notify = SIGEV_SIGNAL;
    sig.sigev_value.sival_ptr = host;
    sig.sigev_signo = SIGRTMIN;

    getaddrinfo_a(GAI_NOWAIT, &host, 1, &sig);

    signalfd_setup();

    //start your event loop
    return 0;
} 
```

您当然也可以使用简单的信号处理程序来完成这项工作，查看[*man sigaction*](http://www.kernel.org/doc/man-pages/online/pages/man2/sigaction.2.html)了解更多信息。

# oop - OOP 类设计，这种设计是否天生就“反”OOP？

> ID：58070
> 
> 赞同：1
> 
> 时间：2008-09-12T01:07:11.063
> 
> 标签：oop

记得在MS发布论坛示例应用程序时，应用程序的设计是这样的：

/Classes/User.cs /Classes/Post.cs ... /Users.cs /Posts.cs

所以类文件夹只有类，即属性和getter/setter。Users.cs、Post.cs 等具有访问数据访问层的实际方法，因此 Posts.cs 可能如下所示：

```
public class Posts
{
    public static Post GetPostByID(int postID)
    {
          SqlDataProvider dp = new SqlDataProvider();
          return dp.GetPostByID(postID);
    }
} 
```

另一种更传统的方法是将 Posts.cs 中的所有方法也放入类定义（Post.cs）中。

将内容拆分为 2 个文件会使其更加程序化，不是吗？这不是破坏 OOP 规则，因为它将行为从类中取出并将其放入另一个类定义中吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T01:17:43.550

如果每个方法都只是直接对数据源的静态调用，那么“Posts”类实际上就是一个工厂。您当然可以将“Posts”中的静态方法放入“Post”类（这就是 CSLA 的工作方式），但它们仍然是工厂方法。

我会说“Posts”类的更现代和更准确的名称是“PostFactory”（假设它只有静态方法）。

我想我不一定会说这是一种“程序化”方法——这只是一个误导性的名称，您会假设在现代 OO 世界中，“Posts”对象将是有状态的，并提供操作和管理一组“发布”对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T01:18:48.413

Well it depends where and how you define your separation of concerns. If you put the code to populate the Post in the Post class, then your Business Layer is interceded with Data Access Code, and vice versa.

To me it makes sense to do the data fetching and populating outside the actual domain object, and let the domain object be responsible for using the data.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T01:10:16.237

你确定这些类不是部分类吗？在这种情况下，它们实际上不是两个类，只是一个跨多个文件分布的类，以提高可读性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T01:12:17.760

根据您的代码片段，**Posts**主要是一类静态辅助方法。**Posts与****Post**不是同一个对象。而不是**Posts**，一个更好的名字可能是**PostManager**或**PostHelper**。如果你这样想，它可能会帮助你理解他们为什么以这种方式打破它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T01:13:40.597

这也是解耦（或松散耦合）应用程序的重要步骤。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T01:14:46.100

什么是反 OOP 或支持 OOP 完全取决于软件的功能以及使其工作所需的条件。

# python - re.compile() 或任何给定的 Python 库调用是否会引发异常？

> ID：58119
> 
> 赞同：17
> 
> 时间：2008-09-12T01:35:33.803
> 
> 标签：python, regex, exception

我无法从 Python 文档中判断 re.compile(x) 函数是否可能引发异常（假设您传入一个字符串）。我想有些东西可以被认为是无效的正则表达式。更大的问题是，我在哪里可以找到给定的 Python 库调用是否会引发异常以及这些异常是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-12T01:42:38.357

好吧，`re.compile`当然可以：

```
>>> import re
>>> re.compile('he(lo')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "C:\Python25\lib\re.py", line 180, in compile
    return _compile(pattern, flags)
  File "C:\Python25\lib\re.py", line 233, in _compile
    raise error, v # invalid expression
sre_constants.error: unbalanced parenthesis 
```

[文档](https://web.archive.org/web/20080913142948/http://docs.python.org/lib/node46.html)确实支持这一点，以一种迂回的方式 - 检查“模块内容”页面的底部以获取`error`异常的（简要）描述。

不幸的是，我对一般性问题没有任何答案。我想各种模块的文档在质量和彻底性上各不相同。如果有您感兴趣的特定模块，您可以[反编译](https://web.archive.org/web/20081004235506/http://www.depython.net/)它们（如果用 Python 编写），甚至[查看源代码](http://www.python.org/download/)（如果它们在标准库中）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-12T02:10:16.467

与 Java 不同，有一些异常必须声明才能引发（有些不是必须的，但这是另一回事），任何 Python 代码都可能随时引发任何异常。

有一个[内置异常](https://docs.python.org/2.7/library/exceptions.html)列表，其中通常有一些关于何时可能引发这些异常的描述。由您决定您将执行多少异常处理，以及您是否会优雅地处理事情，或者只是因为回溯而失败。

# c# - Get current System.Web.UI.Page from HttpContext?

> ID：58123
> 
> 赞同：84
> 
> 时间：2008-09-12T01:37:23.893
> 
> 标签：c#, asp.net, httpcontext

This is actually a two part question. First,does the HttpContext.Current correspond to the current System.UI.Page object?

And the second question, which is probably related to the first, is why can't I use the following to see if the current page implements an interface:

```
private IWebBase FindWebBase()
{
    if (HttpContext.Current as IWebBase != null)
    {
        return (IWebBase)HttpContext.Current.;
    }
    throw new NotImplementedException("Crawling for IWebBase not implemented yet");
} 
```

The general context is that some controls need to know whether they are executing as a SharePoint webpart, or as part of an Asp.Net framework.

I have solved the problem by requiring the control to pass a reference to itself, and checking the Page property of the control, but I'm still curious why the above does not work.

The compiler error is: Cannot convert System.Web.HttpContext to ...IWebBase via a reference conversion, boxing conversion, unboxing conversion, wrapping conversion or null type conversion.

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-09-12T01:42:57.017

No, from MSDN on HttpContext.Current: "Gets or sets the HttpContext object for the current HTTP request."

In other words it is an HttpContext object, not a Page.

You can get to the Page object via HttpContext using:

```
Page page = HttpContext.Current.Handler as Page;

if (page != null)
{
     // Use page instance.
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-12T01:42:26.110

You're looking for `HttpContext.Handler`. Since Page implements IHttpHandler, you'll obtain a reference to the currently executing page.You'll have to cast it, or at least try to cast it to the particular type you're looking for.

`HttpContext.Current` simply returns the singleton instance of HttpContext. Therefore, it is not and can never be, a page.

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-07-07T22:05:16.037

You may want to use `HttpContext.Current.CurrentHandler` if you want the precise page that is currently executing. For example, a request for Default.aspx is sent, but an error is thrown and you do a `Response.Transfer` to your custom ErrorHandler.aspx page. `CurrentHandler` will return the instance of ErrorHandler.aspx (if called after the error) whereas `HttpContext.Current.Handler` would return an instance of Default.aspx.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-01T00:44:50.607

Please see my answer :
[Why HttpContext.Current.Handler is null?](https://stackoverflow.com/questions/1054123/why-httpcontext-current-handler-is-null)

Maybe resolved your problem.

# sql-server - 为什么在 SQL Server 中使用游标被认为是不好的做法？

> ID：58141
> 
> 赞同：64
> 
> 时间：2008-09-12T01:52:15.900
> 
> 标签：sql-server, sql-server-2005, database-cursor

早在 SQL 7 天我就知道一些性能原因，但是在 SQL Server 2005 中是否仍然存在相同的问题？如果我在存储过程中有一个我想单独操作的结果集，那么游标仍然是一个糟糕的选择吗？如果是这样，为什么？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-09-12T02:00:00.423

因为游标会占用内存并创建锁。

您真正在做的是试图将基于集合的技术强制转换为基于非集合的功能。而且，平心而论，我应该指出游标*确实*有用，但他们不赞成，因为许多不习惯使用基于集合的解决方案的人使用游标而不是找出基于集合的解决方案。

但是，当您打开游标时，您基本上是将这些行加载到内存中并锁定它们，从而创建潜在的块。然后，当您循环浏览游标时，您正在对其他表进行更改，并且仍然保持游标的所有内存和锁处于打开状态。

所有这些都有可能导致其他用户出现性能问题。

因此，作为一般规则，光标是不受欢迎的。特别是如果这是解决问题的第一个解决方案。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2010-06-11T15:53:29.570

以上关于 SQL 是基于集合的环境的评论都是正确的。但是，有时逐行操作很有用。考虑元数据和动态 sql 的组合。

作为一个非常简单的示例，假设我在一个表中有 100 多条记录，这些记录定义了我想要复制/截断/任何内容的表的名称。哪个最好？硬编码 SQL 来做我需要做的事情？或者遍历这个结果集并使用动态 SQL (sp_executesql) 来执行操作？

使用基于集合的 SQL 是无法实现上述目标的。

那么，要使用游标还是 while 循环（伪游标）？

只要您使用正确的选项，SQL 游标就可以了：

INSENSITIVE 将为您的结果集制作一个临时副本（使您不必自己为伪光标执行此操作）。

READ_ONLY 将确保在底层结果集上没有锁。底层结果集的变化将反映在后续的提取中（就像从伪光标中获取 TOP 1 一样）。

FAST_FORWARD 将创建一个优化的只进只读游标。

在将所有游标视为邪恶之前，请阅读可用选项。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-07-20T21:12:24.687

有一个关于我每次需要时都会使用的游标的解决方法。

我创建了一个表变量，其中包含一个标识列。

在其中插入我需要使用的所有数据。

然后使用计数器变量创建一个 while 块，并使用标识列与计数器匹配的选择语句从表变量中选择我想要的数据。

这样我就不会锁定任何东西并且使用更少的内存和它的安全，我不会因为内存损坏或类似的东西而丢失任何东西。

并且块代码易于查看和处理。

这是一个简单的例子：

```
DECLARE @TAB TABLE(ID INT IDENTITY, COLUMN1 VARCHAR(10), COLUMN2 VARCHAR(10))

DECLARE @COUNT INT,
        @MAX INT, 
        @CONCAT VARCHAR(MAX), 
        @COLUMN1 VARCHAR(10), 
        @COLUMN2 VARCHAR(10)

SET @COUNT = 1

INSERT INTO @TAB VALUES('TE1S', 'TE21')
INSERT INTO @TAB VALUES('TE1S', 'TE22')
INSERT INTO @TAB VALUES('TE1S', 'TE23')
INSERT INTO @TAB VALUES('TE1S', 'TE24')
INSERT INTO @TAB VALUES('TE1S', 'TE25')

SELECT @MAX = @@IDENTITY

WHILE @COUNT <= @MAX BEGIN
    SELECT @COLUMN1 = COLUMN1, @COLUMN2 = COLUMN2 FROM @TAB WHERE ID = @COUNT

    IF @CONCAT IS NULL BEGIN
        SET @CONCAT = '' 
    END ELSE BEGIN 
        SET @CONCAT = @CONCAT + ',' 
    END

    SET @CONCAT = @CONCAT + @COLUMN1 + @COLUMN2

    SET @COUNT = @COUNT + 1
END

SELECT @CONCAT 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-12T01:57:37.260

我认为游标的名字很糟糕，因为 SQL 新手发现它们并认为“嘿，for 循环！我知道如何使用它们！” 然后他们继续将它们用于一切。

如果您将它们用于它们的设计目的，我无法找到错误。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-12T01:59:55.647

SQL 是一种基于集合的语言——这是它最擅长的。

我认为游标仍然是一个糟糕的选择，除非您对它们有足够的了解以证明它们在有限情况下的使用是合理的。

我不喜欢游标的另一个原因是清晰度。光标块非常难看，很难以清晰有效的方式使用。

综上所述，在*某些*情况下光标确实是最好的——它们通常不是初学者想要使用它们的情况。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-12T02:04:08.493

有时，您需要执行的处理的性质需要游标，但出于性能原因，如果可能，最好使用基于集合的逻辑编写操作。

我不会将使用游标称为“不好的做法”，但它们确实在服务器上消耗了更多资源（比等效的基于集合的方法）而且通常它们不是必需的。鉴于此，我的建议是在使用游标之前考虑其他选项。

有几种类型的游标（只进、静态、键集、动态）。每一个都有不同的性能特征和相关的开销。确保使用正确的光标类型进行操作。仅转发是默认设置。

使用游标的一个论点是当您需要处理和更新单个行时，尤其是对于没有良好唯一键的数据集。在这种情况下，您可以在声明游标时使用 FOR UPDATE 子句并使用 UPDATE ... WHERE CURRENT OF 处理更新。

请注意，“服务器端”游标曾经很流行（来自 ODBC 和 OLE DB），但 ADO.NET 不支持它们，AFAIK 永远不会。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-12T02:08:34.333

在极少数情况下使用游标是合理的。几乎没有任何情况下它会胜过基于集合的关系查询。有时程序员更容易从循环的角度来思考，但是使用集合逻辑，例如更新表中的大量行，将产生一个解决方案，不仅是更少的 SQL 代码行，但运行速度要快得多，通常要快*几个数量级*。

甚至 Sql Server 2005 中的快进游标也无法与基于集合的查询竞争。与基于集合的操作相比，性能下降的图表通常开始看起来像一个 n^2 操作，随着数据集变得非常大，它往往更加线性。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-05-19T01:18:06.190

@ Daniel P -> 你不需要使用光标来做。您可以轻松地使用基于集合的理论来做到这一点。例如：使用 Sql 2008

```
DECLARE @commandname NVARCHAR(1000) = '';

SELECT @commandname += 'truncate table ' + tablename + '; ';
FROM tableNames;

EXEC sp_executesql @commandname; 
```

只会做你上面所说的。你可以用 Sql 2000 做同样的事情，但是查询的语法会有所不同。

但是，我的建议是尽可能避免使用游标。

伽倻

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2015-06-21T12:54:28.620

光标通常不是疾病，而是它的症状：不使用基于集合的方法（如其他答案中所述）。

不理解这个问题，只是相信避免“邪恶”光标会解决它，会使事情变得更糟。

例如，将游标迭代替换为其他迭代代码，例如将数据移动到临时表或表变量，以如下方式遍历行：

```
SELECT * FROM @temptable WHERE Id=@counter 
```

或者

```
SELECT TOP 1 * FROM @temptable WHERE Id>@lastId 
```

如另一个答案的代码所示，这种方法会使事情变得更糟，并且不能解决原始问题。*这是一种称为货物崇拜编程*的反模式：不知道为什么某事是坏的，因此实施更糟糕的事情来避免它！我最近将此类代码（使用#temptable 并且在身份/PK 上没有索引）更改回游标，并且更新略多于 10000 行只需要 1 秒而不是近 3 分钟。仍然缺乏基于集合的方法（作为较小的邪恶），但那一刻我能做到的最好。

这种缺乏理解的另一个症状可能是我有时所说的“单一对象疾病”：通过数据访问层或对象关系映射器处理单个对象的数据库应用程序。通常代码如下：

```
var items = new List<Item>();
foreach(int oneId in itemIds)
{
    items.Add(dataAccess.GetItemById(oneId);
} 
```

代替

```
var items = dataAccess.GetItemsByIds(itemIds); 
```

第一个通常会用大量的 SELECT 淹没数据库，每个 SELECT 一次往返，特别是当对象树/图发挥作用并且臭名昭著的 SELECT N+1 问题来袭时。

这是不了解关系数据库和基于集合的方法的应用程序方面，就像使用过程数据库代码（如 T-SQL 或 PL/SQL）时游标一样！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-12T02:01:45.333

游标确实有它们的位置，但我认为这主要是因为它们通常在单个 select 语句足以提供结果的聚合和过滤时使用。

避免使用游标可以让 SQL Server 更充分地优化查询性能，这在大型系统中非常重要。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-12T01:59:56.507

我认为，基本问题是数据库是为基于集合的操作而设计和调整的——基于数据中的关系在一个快速步骤中选择、更新和删除大量数据。

另一方面，内存软件是为单独的操作而设计的，因此循环一组数据并可能对每个项目连续执行不同的操作是它最擅长的。

循环不是数据库或存储体系结构的设计目的，即使在 SQL Server 2005 中，如果您将基本数据集拉入自定义程序并在内存中执行循环，您将无法获得接近您所获得的性能，使用尽可能轻量级的数据对象/结构。

# asp.net - ASP.NET MVC 中的分层数据

> ID：58146
> 
> 赞同：2
> 
> 时间：2008-09-12T01:54:55.550
> 
> 标签：asp.net, asp.net-mvc

我正在尝试使用 ASP.NET MVC 将一些分层数据呈现到嵌套无序列表中的最佳方法。有没有人有关于如何做到这一点的任何提示？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T02:11:36.463

你的意思是......你想要某种树状视图？

你实际上可以让树视图控件工作......但你必须将它包装在服务器端表单标签中才能运行。你会得到通常带来的麻烦（比如生成的 id 和视图状态），但它会从渲染的角度工作。

如果您只想创建标签并嵌套它们，那么使用 foreach() 循环会很容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T05:11:29.167

我建议使用 jquery 树视图插件使其像树一样运行，但对于渲染，只需将其放入递归 lambda 助手中即可进行嵌套。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T12:16:08.910

我相信目前没有这样的控制...... TreeViews本质上是复杂的。当然，您可以使用各种*重复器*和循环尽可能多地“绘制”层次结构，但是要实现类似于 Web 表单工具箱中的树视图的**功能**……您必须等待！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T20:37:22.610

为什么不将模型以树的形式传递给视图？

```
/// This is the model class
public class MyTreeNode<T>
{
    public ICollection<MyTreeNode> ChildNodes {get;}
    public T MyValue { get; set; }
    bool HasChildren { get { return ChildNodes.Any(); } }
}

///This is the html helper:
public static string RenderTree<T>(this HtmlHelper html, MyTreeNode<T> root, Func<T, string> renderNode)
{
    var sb = new StringBuilder();
    sb.Append(renderNode(root.MyValue));
    if (root.HasChildren)
    {
        foreach(var child in root.ChildNodes)
        {
            sb.Append(RenderTree<T>(html, child, renderNode));
        }
    }
    return sb.ToString();
} 
```

我实际上并没有测试这段代码，但它是关于这个想法的。您可以想象创建自己的递归 html 助手来渲染树。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T20:39:18.240

为此（渲染分层菜单、树视图等），我使用自定义组件的递归调用（ascx 或新预览中的 aspx5）。
我给组件第一级项目（项目列表），然后组件检查列表中的每个项目是否有任何子项目，并使用该子项目的列表调用自身。
您可以在控制器中构建对象的层次图，或者只是具有 ParentID 属性的一维列表。

# java - 你什么时候可以/应该全力以赴地使用 ORM 方法？

> ID：58163
> 
> 赞同：2
> 
> 时间：2008-09-12T02:05:01.173
> 
> 标签：java, hibernate, architecture, orm

在我看来，引入 ORM 工具应该可以让您的架构更整洁，但为了提高效率，我发现自己有时会绕过它并迭代 JDBC 结果集。这会导致不协调的工件缠结，而不是更清晰的架构。

这是因为我在无效的上下文中应用了该工具，还是比这更深？

你什么时候可以/应该全力以赴地使用 ORM 方法？

任何见解将不胜感激。

* * *

一点背景：

在我的环境中，我有大约 50 台客户端计算机和 1 台相当强大的 SQL Server。

我有一个桌面应用程序，其中所有 50 个客户端一直在访问数据。

该项目的数据模型出于各种原因（包括清晰度、效率等）经历了多次重组。

我的数据模型的历史

1.  JDBC直接调用
2.  DAO + POJO 没有 Pojos 之间的关系（基本上包装了 JDBC）。
3.  添加了实现延迟加载的 POJO 之间的关系，但只是隐藏了 DAO 间调用
4.  在看到它使数据访问变得多么“简单”（它使 POJO 之间的关系变得微不足道）并且因为它可以减少与许多相关实体一起工作时到数据库的往返次数后，跳上了 Hibernate 的潮流。
5.  因为它是一个桌面应用程序，让 Sessions 长期保持打开状态是一场噩梦，所以它最终导致了很多问题
6.  回到部分 DAO/Hibernate 方法，允许我在 DAO 幕后进行直接 JDBC 调用，同时使用 Hibernate。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T03:59:42.520

*当您的应用程序在对象图*上工作时，Hibernate 更有意义，对象图保存在 RDBMS 中。相反，如果您的应用程序逻辑在二维数据矩阵上工作，那么通过直接 JDBC 获取这些数据会更好。尽管 Hibernate 是在 JDBC 之上编写的，但它具有在 JDBC 中实现可能并非易事的功能。例如：

1.  比如说，用户在 UI 中查看了一行并更改了一些值，而您希望仅针对确实发生更改的那些列触发更新查询。
2.  为避免陷入死锁，您需要维护事务中 SQL 的全局顺序。获得正确的 JDBC 可能并不容易
3.  轻松设置乐观锁定。当你使用 JDBC 时，你需要记住在每个更新查询中都有这个。
4.  Batch updates, lazy materialization of collections etc might also be non-trivial to implement in JDBC.

(I say "*might* be non-trivial", because it of course can be done - and you might be a super hacker:)

Hibernate lets you fire your own SQL queries also, in case you need to.

Hope this helps you to decide.

PS: Keeping the Session open on a remote desktop client and running into trouble is really not Hibernate's problem - you would run into the same issue if you keep the Connection to the DB open for long.

# database - 有谁知道在哪里可以找到免费的数据库设计模板？

> ID：58174
> 
> 赞同：6
> 
> 时间：2008-09-12T02:16:12.503
> 
> 标签：database, templates

我显然不是在谈论一个完整的解决方案，而只是软件架构师常用应用程序的一个很好的起点。它可以用于 CMS、电子商务店面、地址簿等。UML 图不是必需的，但至少是具有数据类型的表模式。谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-12T02:22:27.530

查看来自 DatabaseAnswers.org[的免费数据模型](http://databaseanswers.org/data_models/)库——这可能是一个很好的起点。我不能保证质量，但这里有很多......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T02:24:50.020

开源？

[DB-UML 可能对您有用](https://sourceforge.net/projects/dbuml#item3rd-1)。

编辑：

哦！[MySQL 工作台](http://dev.mysql.com/workbench/)很好 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T02:26:15.647

[世界数据库。](http://www.dbis.informatik.uni-goettingen.de/Mondial/) 用于了解 DBMS。如果您需要快速而肮脏的东西来敲打。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-06T15:43:12.600

试试这个...[数据库设计文档模板](http://www.klariti.com/software-development-lifecycle-templates/database-design-document-template.shtml)。非常好用的模板。但它不是免费的..你必须买它.. :(

# javascript - Safari for Windows 和 AJAX 有什么特别之处吗？

> ID：58184
> 
> 赞同：-3
> 
> 时间：2008-09-12T02:23:37.010
> 
> 标签：javascript, windows, ajax, browser, safari

Safari for Windows 和 AJAX 有什么特别之处吗？
换句话说：我应该记住一些常见的陷阱吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T03:06:59.357

Safari 确实符合标准。除非您使用一些非常深奥的浏览器功能，否则通常如果某些东西在 Firefox 中有效，我发现它在 Windows Safari 中无需修改即可工作。

Apple 有[一个面向 Web 开发者的开发者中心](http://developer.apple.com/internet/safari/)，但我没有发现那里有什么太有用的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T04:16:16.287

`return false`在您的事件处理程序中，使用`event.preventDefault()`or代替`event.stopPropagation()`. 这些`event`方法是标准/兼容的方式，但许多旧教程仍然推荐`return`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T03:30:23.887

警告一句话：Windows 上的 Safari 不支持 XSLT。

# .net - 在 SQL 2005+ 中，CLR 存储过程是否优于 TSQL 存储过程？

> ID：58190
> 
> 赞同：16
> 
> 时间：2008-09-12T02:27:12.323
> 
> 标签：.net, sql-server, tsql, sqlclr

我目前的观点是不，更喜欢 Transact SQL 存储过程，因为它们重量更轻且（可能）性能更高的选项，而 CLR 过程允许开发人员进行各种恶作剧。

但是最近我需要调试一些写得很糟糕的 TSQL 存储过程。像往常一样，我发现许多问题是由于原始开发人员没有真正的 TSQL 经验，他们专注于 ASP.NET / C#。

因此，使用 CLR 程序首先会为这类开发人员提供更熟悉的工具集，其次，调试和测试工具更强大（即 Visual Studio 而非 SQL Management Studio）。

我很想听听您的经历，因为这似乎不是一个简单的选择。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-12T02:36:20.833

编写良好、经过深思熟虑的 T-SQL 和 CLR 都有位置。如果某些函数不经常调用并且如果它需要 SQL Server 2000 中的扩展过程，CLR 可能是一个选项。在数据旁边运行诸如计算之类的东西也可能很有吸引力。但是通过引入新技术来解决糟糕的程序员听起来是个坏主意。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-12T02:34:30.887

CLR 存储过程并不意味着取代基于集合的查询。如果您需要查询数据库，您仍然需要将 SQL 放入您的 CLR 代码中，就像它嵌入在常规代码中一样。这将是白费力气。

CLR 存储过程有两个主要用途：1) 与操作系统交互，例如从文件读取或在 MSMQ 中删除消息，以及 2) 执行复杂的计算，尤其是当您已经用 .NET 语言编写代码时做计算。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-12T03:57:10.483

在 SQL Server 中托管 CLR 旨在为数据库开发人员在他们寻求完成任务的方式上提供*更灵活的选择。*就像其他人提到的那样，SQL 非常适合*对数据集*进行操作和修改。任何使用复杂的业务/域规则进行过大型应用程序开发的人都可能会告诉您 - 尝试使用纯 SQL（有时在单个宏查询中）强制执行其中的一些规则可能会成为真正的噩梦。

只有某些任务可以以程序或 OO 方式更好地处理。通过选择使用 .NET 代码来分解逻辑序列，查询操作可以变得更易于阅读和调试。使用 CLR 存储过程后，我可以告诉您逐步使用调试器确实可以更轻松地跟踪数据库级别发生的事情。

仅举一个例子，我们在这里经常使用 CLR 存储过程作为动态搜索查询的“网关”。假设一个搜索请求最多可以有 30 个不同的搜索参数。用户显然不会使用全部 30 个，所以传入的数据结构会有 30 个参数，但大多是 DBNULL。出于明显的安全原因，客户端*无法*生成动态语句。生成的动态语句在内部生成，无需担心外部“额外”。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-12T02:31:56.430

通常，如果您有一些不需要与数据库进行太多交互的东西，则可以使用 CLR。因此，假设您正在解析或解码一个值。这在 CLR 中更容易做到，然后返回值。

尝试在 CLR 中进行复杂查询并不是可行的方法。

顺便说一句，这在 2008 年也没有改变。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-12T05:45:00.083

我相信这两者并不等同......适合相互对抗。
**CLR 集成应该逐步淘汰过去的“扩展存储过程”。**我们的工作场所中有一些这样的......本质上是对 SQL 数据的处理/逻辑块，这些块通过传统的 DB 存储过程/T SQL 太难/不可能完成。因此，他们将其编写为 C++ DLL 中的扩展存储过程，可以类似地调用。 [现在它们已被淘汰，CLR 集成是替代品](http://msdn.microsoft.com/en-us/library/ms164734.aspx)

*   DB存储过程：如果可以在T SQL Stored procs中完成，就去做。
*   CLR 存储过程：如果逻辑过于复杂或繁琐而无法通过 T SQL 执行...方法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-12T16:31:16.880

除了文件系统访问（CLR procs 具有非常明显的优势），我会使用 T-SQL procs。如果您有特别复杂的计算，您可以将该部分放入 CLR**函数**中并从您的 proc 中调用它（udf 是我发现 CLR 集成真正闪耀的地方）。然后，您可以为任务的特定部分获得 CLR 集成的好处，但尽可能多地将存储的过程逻辑保留在数据库中。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-13T17:40:15.360

鉴于您所说，我宁愿您让开发人员在 t-SQl 和一般数据库方面接受适当的培训，也不愿允许他们通过允许他们在 CLR 中执行 t-sql 任务来对性能造成更大的损害。不了解数据库的开发人员以此为借口避免以最有利于数据库性能的方式做事，因为他们希望采用他们认为更容易的方式。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-12T03:18:07.643

它总是归结为适合这项工作的正确工具，因此这实际上取决于您要完成的工作。

但是，作为一般规则，您是对的，CLR proc 具有更大的开销，并且永远不会在 T-SQL 之类的集合操作上执行。我的指导方针是全部在 T-SQL 中完成，除非你需要的东西在 T-SQL 中变得过于复杂。然后，更加努力地让 T-SQL 方法发挥作用。:-)

CLR proc 很棒并且确实有它们的位置，但它们的使用应该是例外，而不是规则。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-12T04:10:57.877

SQL Server 联机丛书[的主题页面](http://msdn.microsoft.com/en-us/library/ms131089.aspx)列出了这些好处：

*   **更好的编程模型。**.NET Framework 语言在许多方面都比 Transact-SQL 更丰富，提供了以前 SQL Server 开发人员无法使用的结构和功能。开发人员还可以利用 .NET Framework 库的强大功能，它提供了一组广泛的类，可用于快速有效地解决编程问题。

*   **提高了安全性和安保性。**托管代码在由数据库引擎托管的公共语言运行时环境中运行。SQL Server 利用这一点为早期版本的 SQL Server 中可用的扩展存储过程提供更安全的替代方案。

*   **能够定义数据类型和聚合函数。**用户定义类型和用户定义聚合是两个新的托管数据库对象，它们扩展了 SQL Server 的存储和查询能力。

*   **通过标准化环境简化开发。**数据库开发集成到 Microsoft Visual Studio .NET 开发环境的未来版本中。开发人员使用与编写中间层或客户端层 .NET Framework 组件和服务相同的工具来开发和调试数据库对象和脚本。

*   **提高性能和可扩展性的潜力。**在许多情况下，.NET Framework 语言编译和执行模型提供了优于 Transact-SQL 的性能。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-09-25T22:06:37.693

我们遇到了一个 CLR 函数的情况，该函数在常规 SQL 过程中被调用了数千次。这是从另一个系统导入数据的过程。该函数验证了数据并很好地处理了空值。

如果我们在 TSQL 中进行操作，proc 大约在 15 秒内完成。如果我们使用 CLR 函数，proc 会在 20 - 40 分钟内完成。CLR 函数看起来更优雅，但据我们所知，每次使用 CLR 函数都会触发一次启动。因此，如果您使用一个 CLR 函数完成了一项大型操作，那很好，因为与操作时间相比，启动时间很短。或者，如果您调用 CLR 函数的次数不多，则该函数的所有调用的总启动时间会很短。但要小心循环。

此外，为了可维护性，最好不要使用比您真正需要的更多的语言。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-07-14T20:47:17.770

我会添加几个可能没有提到的使用 CLR 的原因。

*   替换和扩展基本查询、非查询和标量 sql 函数。
    A) 可以根据定义的要求集成错误报告和警报。B) 轻松定义调试级别。C) 以更简单的方式与外部 SQL 服务器交互
*   将遗留代码移至托管环境。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-07-17T20:10:32.590

我对类似问题发布了以下答案：[SQL SERVER CLR 的优势](https://stackoverflow.com/questions/439859/advantage-of-sql-server-clr)。不过，我将在这里补充一点，C#/VB.net/etc 是一种比 T-SQL 更适合的语言，*不*应该成为使用 SQLCLR 而不是 T-SQL 的理由。如果有人不知道如何在 T-SQL 中完成某事，请首先寻求帮助以找到 T-SQL 解决方案。如果不存在，*则*走 CLR 路线。

* * *

SQL Server 中的 SQLCLR / CLR 集成只是帮助解决某些（不是全部）问题的另一种工具。有些事情它比纯 T-SQL 做得更好，有些事情只能通过 SQLCLR 完成。我为 SQL Server Central 写了一篇文章，[Stairway to SQLCLR Level 1：什么是 SQLCLR？](http://www.sqlservercentral.com/articles/Stairway+Series/104406/)（需要免费注册才能阅读那里的文章），这解决了这个问题。基础知识是（有关详细信息，请参阅链接的文章）：

*   流表值函数 (sTVF)
*   动态 SQL（在函数内）
*   更好地访问外部资源/替换 xp_cmdshell
    *   传入数据更容易
    *   取回结果集的多列更容易
    *   没有外部依赖（例如 7zip.exe）
    *   通过模拟提高安全性
*   多线程能力
*   错误处理（函数内）
*   自定义聚合
*   自定义类型
*   修改状态（在函数内且不带`OPENQUERY`/ `OPENROWSET`）
*   执行存储过程（只读；在函数内且不带`OPENQUERY`/ `OPENROWSET`）
*   性能（**注意：**这*并不是*在所有情况下都有意义，但在某些情况下肯定取决于操作的类型和复杂性）
*   可以捕获输出（即发送到 SSMS 中的“消息”选项卡的内容）（例如，`PRINT`严重性*=* 0 到 10）——我忘了​​在文章中提到这一点 ;-)。`RAISERROR`

 *要考虑的另一件事是，有时能够在应用程序和数据库之间共享代码是有益的，这样数据库就可以深入了解某些业务逻辑，而无需构建自定义的、仅限内部的屏幕来访问该应用程序代码。例如，我曾在一个系统上工作，该系统从客户那里导入数据文件，并使用大多数字段的自定义散列并将该值保存到数据库中的行中。这允许在再次导入数据时轻松跳过行，因为应用程序将从输入文件中散列值并与存储在行中的散列值进行比较。如果它们相同，那么我们立即知道所有字段都没有改变，所以我们进入下一行，这是一个简单的 INT 比较。但是用于进行哈希的算法仅在应用程序代码中，因此无论是用于调试客户案例还是通过标记至少有一个字段发生更改的行（来自我们的应用程序的更改）来寻找将某些处理卸载到后端服务的方法与在较新的导入文件中查找更改相反），我无能为力。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。这将是一个在数据库中拥有相当简单的业务逻辑的绝佳机会，即使不是用于正常处理；在数据库中拥有相当于编码值而无法理解其含义的内容使得解决问题变得非常困难。

如果有兴趣在不编写任何代码的情况下查看其中的一些功能，[SQL#](http://www.sqlsharp.com/)（我是其作者）的免费版本具有 RegEx 函数、自定义聚合 (UDA)、自定义类型 (UDT) 等。

# bash - 使用命令的结果作为 bash 中的参数？

> ID：58207
> 
> 赞同：73
> 
> 时间：2008-09-12T02:38:10.563
> 
> 标签：bash, command-line

要为文件夹中的所有音乐创建播放列表，我在 bash 中使用以下命令：

```
ls > list.txt 
```

我想使用`pwd`命令的结果作为播放列表的名称。

就像是：

```
ls > ${pwd}.txt 
```

但这不起作用 - 谁能告诉我我需要使用什么语法来做这样的事情？

**编辑：**正如评论中提到的，pwd 最终会给出一个绝对路径，所以我的播放列表最终会在某个目录中被命名为 .txt - d'oh！所以我必须修剪路径。感谢您发现这一点 - 我可能会花很长时间想知道我的文件去了哪里！

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-12T02:42:06.047

最好的方法是使用`"$(command substitution)"`（感谢[Landon](https://stackoverflow.com/a/58233/1899640)）：

```
ls > "$(pwd).txt" 
```

您有时还会看到人们使用较旧的反引号表示法，但这在嵌套和转义方面有[几个缺点：](https://stackoverflow.com/questions/4708549/what-is-the-difference-between-command-and-command-in-shell-programming)

```
ls > "`pwd`.txt" 
```

注意，未处理的替换`pwd`是绝对路径，所以上面的命令在与工作目录相同的目录下创建了一个同名的文件，但带有`.txt`扩展名。Thomas Kammeyer 指出该`basename`命令会删除前导目录，因此这将在当前目录中创建一个带有该目录名称的文本文件：

```
ls > "$(basename "$(pwd)").txt" 
```

也感谢 erichui 提出路径中的空格问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-12T02:57:52.420

这等效于反引号解决方案：

```
ls > $(pwd).txt 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-12T02:53:16.910

照你说的做，你可以试试：

```
ls > `pwd`.txt 
```

这将使用完整的路径名，这应该没问题。请注意，如果您在您的主目录（可能位于 /home/hoboben）中执行此操作，您将尝试在上面的目录中创建 /home/hoboben.txt，这是一个文本文件。

这是你想要的吗？

如果您希望该目录包含一个以它命名的文件，您将获取当前目录的基本名称并将其与 .txt 附加到 pwd。

现在，与其使用 pwd 命令……为什么不使用 PWD 环境变量呢？

例如：

```
ls > $PWD.txt 
```

或者

```
ls > ${PWD}.txt 
```

可能是您在第二个示例中试图记住的内容。

如果您在 /home/hoboben 并且想要创建 /home/hoboben/hoboben.txt，请尝试：

```
ls > ${PWD}/${PWD##*/}.txt 
```

如果您这样做，该文件将包含其自己的名称，因此大多数情况下，您可以通过以下几种方法之一来解决此问题。只要您不使用 -a 标志（然后可选地重命名生成的文件），您就可以重定向到其他地方并移动文件或以点开头的文件命名文件以将其隐藏在 ls 命令中。

我编写自己的脚本来管理音乐文件的目录层次结构，并使用名为“.info”的子目录，例如，在一些备用文件中包含曲目数据（基本上，我以这种方式“隐藏”元数据）。效果很好，因为我的需求很简单，而且我的收藏很小。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-12T02:59:47.720

我怀疑问题可能是其中一个目录名称中有空格。例如，如果您的工作目录是“/home/user/music/artist name”。Bash 会感到困惑，认为您正在尝试重定向到 /home/user/music/artist 和 name.txt。你可以用双引号解决这个问题

```
ls > "$(pwd).txt" 
```

此外，您可能不想重定向到 $(pwd).txt。在上面的示例中，您将输出重定向到文件“/home/user/music/artist name.txt”

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-12T02:42:57.590

语法是：

```
ls > `pwd`.txt 
```

那是 '~' 下面的 '`' 字符，而不是常规的单引号。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-12T02:53:57.717

使用上述方法将创建比当前目录高一级的文件。如果您希望播放列表全部转到一个目录，您需要执行以下操作：

```
#!/bin/sh

MYVAR=`pwd | sed "s|/|_|g"`
ls > /playlistdir/$MYVAR-list.txt 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-06T18:29:57.587

剥离除目录名称以外的所有内容

```
ls >/playlistdir/${PWD##/*}.txt 
```

这可能不是您想要的，因为您不知道文件在哪里（除非您更改 ls 命令）

用“_”替换“/”

```
ls >/playlistdir/${PWD//\//_}.txt 
```

但是播放列表看起来很难看，甚至可能不适合选择窗口

因此，这将为您提供一个简短的可读名称和文件内的可用路径

```
ext=.mp3 #leave blank for all files
for FILE in "$PWD/*$ext"; do echo "$FILE";done >/playlistdir/${PWD##/*}.txt 
```

# .net - 您能否推荐用于 .NET Winforms 应用程序的低成本自动化测试工具？

> ID：58213
> 
> 赞同：5
> 
> 时间：2008-09-12T02:42:26.810
> 
> 标签：.net, winforms, testing

寻找一种自动化测试工具来支持 .NET Winforms 客户端服务器商业应用程序的功能/回归测试。顶级产品：HP QuickTest Pro、Borland SilkTest、IBM Rational Functional Tester 和 Compuware TestPartner 价格在 5-10K 之间。您会推荐用于功能/回归测试的成本较低的工具集吗？需要允许 BA/QA 分析师能够高效地参与测试用例开发的工具。所以我排除了像 xUnit 这样完全供程序员使用的单元测试工具。然而，我还想要一个提供灵活脚本支持的工具，以允许测试更广泛的问题（可能有开发人员支持）。

请将您的答案限制在一个推荐的工具上。如果您的建议已经得到回答，请投票以创建可用工具的排名。

谢谢

相关问题：[Windows 上的自动化 GUI 测试工具](https://stackoverflow.com/questions/120359/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T03:00:05.957

[TestComplete](http://www.automatedqa.com/products/testcomplete/)是一个不错的选择。它以实惠的价格拥有所有功能。我们在这里的公司使用了一年，到目前为止一切都很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T02:57:51.187

AutoIT/AutoHotKey 是免费的（我同时使用这两者）。他们正在编写语言，您的测试人员需要知道如何编写语言。AutoIT 使用 VB，因此很容易上手。

我们使用它的方式是通过自动化鼠标、鼠标点击和键盘按下来替换用户输入。您可以观察（并等待）窗口打开，然后根据需要关闭它们。本质上，它只是模拟人类测试人员在集成测试或完全回归测试期间会做什么。

要求 BA/QA 分析师学习脚本语言可能有点多，但话又说回来，它不是很复杂。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-13T18:55:50.660

适合/健身。

我们已经开始使用[Fit](http://fitnesse.org/) & [Fitnesse for .NET](http://sourceforge.net/projects/fitnessedotnet)。作为开源产品，价格合适。基于 Wiki 的测试开发对于我们的 QA 工程师来说已经足够好了。编写夹具需要大量的开发人员支持。
因此，让开发人员参与进来是当前的难题，因为他们已经习惯了 xUnit。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-09T23:24:22.370

使用 .NET 框架 (System.Windows.Automation) 的[Microsoft UI 自动化](http://msdn.microsoft.com/en-us/library/ms753107.aspx)部分。它将自动处理类名称更改、按钮位置/大小更改等事情。（换句话说，SilkTest 等传统工具打破的所有事情。）另外，您还将构建可访问性支持（如果您想向需要与屏幕阅读器技术兼容的美国政府等销售产品，这一点很重要）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-19T16:42:02.973

一种低成本的工具是自己编写。这就是我们所做的。

我们使用 IronPython 来编写我们的测试。这是一种很棒的语言。它是一种完整的 .NET 语言，因此它可以无缝调用您的 .NET 产品代码，无论它是 C# 还是其他语言。我们在 Python 标准库模块“unittest”之上构建我们的测试。

这对于单元测试来说是开箱即用的。对于功能测试，我们必须创建一个重要的框架，以允许我们的测试启动应用程序，并为我们的测试提供帮助方法来单击 GUI 按钮、在文本框中键入文本等。

总的来说，我们对结果感到满意。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-31T18:19:12.957

测试完成还不够好。我们正在使用 Eclipse TPTP 进行所有 Windows 应用程序的自动化开发。它是免费的、开源的和可靠的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T20:40:43.840

也许[Ranorex](http://www.ranorex.com/)的软件可以帮助您？我在尝试评估它时只玩了几个小时：没有长期使用它的经验。

在我看来，产品组合（针对其自动化 API 生成 VB/C#/python 代码的记录器 - 当它运行时 - 重放记录的动作）对于回归测试非常有效。但是，由于生成代码和必须将其粘贴/集成到您自己的测试运行器框架中的性质，您肯定需要开发人员来支持测试开发。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T05:21:28.500

传统的 QTP 不会适用于所有 Windows 应用程序 (.NET) 吗？当代码的复杂性非常高并且随之而来的手动测试成本巨大时，应该使用自动化工具代替手动测试。QTP 也适用于 Web 应用程序，当它对某些 ASP.NET 应用程序无法正常运行时，就会出现问题，这意味着您必须进入代码并找出 QTP 无法正常运行的原因。我只是想知道如何处理这样的事情。它被称为危机管理，其中失败可能导致灾难性的灾难。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-31T15:56:30.640

Silk、Compuware、Mercury 都不是很好的 Winforms 自动化开发工具。它们都是很好的 Web GUI 测试工具。最好的是 Visual Studio 2010。使用它，你会说 Ahhhhhhh... Wowwwwww。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-09-25T06:12:48.073

对于 winforms 自动化/测试，您绝对应该查看[White](http://white.codeplex.com/)！

# c# - Rendering graphics in C#

> ID：58230
> 
> 赞同：9
> 
> 时间：2008-09-12T02:56:32.610
> 
> 标签：c#, gdi+, xna, rendering

Is there another way to render graphics in C# beyond [GDI+](https://en.wikipedia.org/wiki/Graphics_Device_Interface#Windows_XP) and [XNA](http://en.wikipedia.org/wiki/Microsoft_XNA)?

(For the development of a tile map editor.)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-12T02:59:41.463

[SDL.NET](http://cs-sdl.sourceforge.net/) is the solution I've come to love. If you need 3D on top of it, you can use Tao.OpenGL to render inside it. It's fast, industry standard ([SDL](http://en.wikipedia.org/wiki/Simple_DirectMedia_Layer), that is), and cross-platform.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T03:02:41.020

Yes, I have written a Windows Forms control that wraps DirectX 9.0 and provides direct pixel level manipulation of the video surface.

I actually wrote another post on Stack Overflow asking if there are other better approaches: *[Unsafe C# and pointers for 2D rendering, good or bad?](https://stackoverflow.com/questions/55963/unsafe-c-and-pointers-for-2d-rendering-good-or-bad)*

While it is relatively high performance, it requires the unsafe compiler option as it uses pointers to access the memory efficiently. Hence the reason for this earlier post.

This is a high level of the required steps:

1.  Download the DirectX SDK.
2.  Create a new C# [Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms) project and reference the installed Microsoft DirectX assembly.
3.  Initialize a new DirectX Device object with Presentation Parameters (windowed, back buffering, etc.) you require.
4.  Create the Device, taking care to record the surface "Pitch" and current display mode (bits per pixel).
5.  When you need to display something, `Lock` the backbuffer surface and store the returned pointer to the start of surface memory.
6.  Use pointer arithmetic, calculate the actual pixel position in the data based on the surface pitch, bits per pixel and the actual x/y pixel coordinate.
7.  In my case for simplicity I am sticking to 32 bpp, meaning setting a pixel is as simple as: *(surfacePointer + (y * pitch + x))=Color.FromARGB(255,0,0);
8.  When finished drawing, `Unlock` the back buffer surface. Present the surface.
9.  Repeat from step 5 as required.

Be aware that taking this approach you need to be very careful about checking the current display mode (pitch and bits per pxiel) of the target surface. Also you will need to have a strategy in place to deal with window resizing or changes of screen format while your program is running.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T04:33:40.083

*   Managed DirectX (Microsoft.DirectX namespace) for faster 3D graphics. It's a solid .NET wrapper over DirectX API, which comes with a bit of performance hit for creating .NET objects and marshalling. Unless you are writing a full featured modern 3D engine, it will work fine.

*   Window Presentation Foundation (WPF) (Windows.Media namespace) - best choice for 2D graphics. Also has limited 3D abilities. Aimed to replace Windows Forms with vector, hardware accelerated resolution-independent framework. Very convenient, supports several flavours of custom controls, resources, data binding, events and commands... also has a few WTFs. Speed is usually faster than GDI and slower than DirectX, and depends greatly on how you do things (seen something to work 60 times faster after rewriting in a sensible way). We had a success implementing 3 1280x1024 screens full of real-time indicators, graphs and plots on a single (and not the best) PC.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T03:21:38.277

You could try looking into WPF, using Visual Studio and/or Expression Blend. I'm not sure how sophisticated you're trying to get, but it should be able to handle a simple editor. Check out this [MSDN Article](http://msdn.microsoft.com/en-us/library/ms742562.aspx) for more info.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T13:09:07.000

You might look into the [Cairo graphics library](https://en.wikipedia.org/wiki/Cairo_(graphics)). The [Mono](http://en.wikipedia.org/wiki/Mono_%28software%29) project has bindings for C#.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-30T13:37:19.540

[Cairo](http://igorbrejc.net/development/c/welcome-to-cairo) is an option. I'm currently rewriting my mapping software using both GDI+ and Cairo. It has a tile map generator, among other features.

# .net - 显示 MenuItem 的工具提示

> ID：58245
> 
> 赞同：15
> 
> 时间：2008-09-12T03:05:23.823
> 
> 标签：.net, winforms

我有一个菜单，其中包含一些最近使用的文件路径。这些文件的路径可能很长，因此文本有时会像“C:\Progra...\foo.txt”一样被剪切

当用户将鼠标悬停在项目上时，我想弹出一个带有完整路径的工具提示，但这对于 .NET 2.0 中的[Tooltip](http://msdn.microsoft.com/en-us/library/system.windows.forms.tooltip.aspx)类似乎是不可能的。

我错过了一些明显的东西吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-12T03:15:53.033

如果您使用[System.Windows.Forms.MenuItem](http://msdn.microsoft.com/en-us/library/system.windows.forms.menuitem.aspx "菜单项成员")类创建菜单项，您将没有“ToolTipText”属性。

您应该使用[System.Windows.Forms.ToolStripMenuItem](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripmenuitem.aspx "ToolStripMenuItem 类")类，它是 .Net Framework 2.0 中的新类，并且包含“ToolTipText”属性。

您还必须记住在 MenuStrip 控件上指定 ShowItemToolTips = True

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-07-12T02:51:46.937

在 MenusTrip 上设置“ShowItemToolTips = True”并在 ToolStripMenuItem 上设置您的 ToolTipText

```
yourMenuStrip.ShowItemToolTips = true;
yourToolStripMenuItem.ToolTipText = "some txt"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T03:11:56.177

可能是我误解了你的问题，但是你为什么需要使用这个`Tooltip`类？您可以将文本分配给[ToolTipText](http://msdn.microsoft.com/en-us/library/aa978609%28VS.71%29.aspx)属性，它将显示给用户。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T03:16:23.140

工具提示通过以下方式手动设置：

```
testToolStripMenuItem2.ToolTipText = "My tooltip text"; 
```

例如，MenuItem 可以是该菜单群的一部分：具有菜单项和子菜单项的菜单条。（如果您使用 Visual Studio，此管道代码会在设计器文件后面的代码中自动为您生成）

```
MenuStrip menuStrip1;    
ToolStripMenuItem testToolStripMenuItem; // Menu item on menu bar
menuStrip1.Items.Add(testToolStripMenuItem);

ToolStripMenuItem testToolStripMenuItem2; // Sub menu item
testToolStripMenuItem.DropDownItems.Add(testToolStripMenuItem2) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-10T00:55:40.777

有一篇关于 CodeProject 的文章实现了具有自定义工具提示支持的 ToolStrip 的派生版本。这在默认工具提示支持不够灵活的情况下可能很有用。 [http://www.codeproject.com/Tips/376643/ToolStrip-with-custom-ToolTip](http://www.codeproject.com/Tips/376643/ToolStrip-with-custom-ToolTip)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-12T03:11:15.603

[也许您忘记使用SetToolTip](http://msdn.microsoft.com/en-us/library/system.windows.forms.tooltip.settooltip.aspx)将工具提示与控件相关联。

# visual-studio - 在外部驱动器上编译代码

> ID：58247
> 
> 赞同：1
> 
> 时间：2008-09-12T03:06:13.803
> 
> 标签：visual-studio, hardware

为了在机器（我在办公室的工作站和我的个人笔记本电脑）之间切换时让事情变得更容易，我考虑过尝试使用外部硬盘驱动器来存储我的工作目录。具体来说，我正在查看 Firewire 800 驱动器（大多数是 5400 rpm 8mb 缓存）。我想知道是否有人有使用 Visual Studio 项目执行此操作的经验以及他们看到的性能影响。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T03:11:30.873

这取决于项目的大小。吞吐量很低，延迟很高，所以你会受到各种方式的打击，但是由于延迟，如果你有很多小文件而不是几个大文件，你会受到更大的打击。

您是否考虑过简单地携带 GIT 或其他分布式存储库并在移动时更新机器存储库？然后您可以在本地编译并处理驱动器和流动服务器。由于只会移动更改，因此它应该更快，并且您的代码将在更多地方“备份”。

如果您忘记了驱动器、驱动器损坏或丢失/被盗，那么您仍然可以坐在 PC 前进行编程，如果您在使用的最后一台 PC 上不会丢失任何代码，或者丢失的代码很少（这将是无论如何，稍后会通过重新同步进行更新）。

如果您以后不想携带驱动器，那么这只是一个跳跃和一个跳跃，而不是简单地使用网络在系统之间移动更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T03:08:42.830

我使用 vmware，虚拟机位于外部 USB 驱动器上。性能很好。您可能会在更改驱动器名称时遇到一些问题 - 如果您使用虚拟机，这不是问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T03:09:15.997

诚然，我在一个以个人信息和知识产权为王的行业工作，但我根本不喜欢这个想法。那个硬盘消失了，你有一个大问题。为什么不能远程桌面进入工作机？

**编辑**Stipud Spelingg

# .net - .Net Windows 服务中的 UnhandledException 处理程序

> ID：58280
> 
> 赞同：26
> 
> 时间：2008-09-12T04:06:20.087
> 
> 标签：.net, vb.net, exception-handling, windows-services

是否可以在 Windows 服务中使用 UnhandledException 处理程序？

通常我会使用一个自定义构建的异常处理组件来进行日志记录、电话回家等。这个组件向 System.AppDomain.CurrentDomain.UnhandledException 添加了一个处理程序，但据我所知，这并没有取得任何成就，因此赢得了 Windows 服务我最终在我的 2 个（或 4 个）服务入口点中使用了这种模式：

```
 Protected Overrides Sub OnStart(ByVal args() As String)
        ' Add code here to start your service. This method should set things
        ' in motion so your service can do its work.
        Try
            MyServiceComponent.Start()
        Catch ex As Exception
            'call into our exception handler
            MyExceptionHandlingComponent.ManuallyHandleException (ex)
            'zero is the default ExitCode for a successfull exit, so if we set it to non-zero
            ExitCode = -1
            'So, we use Environment.Exit, it seems to be the most appropriate thing to use
            'we pass an exit code here as well, just in case.
            System.Environment.Exit(-1)
        End Try
    End Sub 

```

有没有办法我的自定义异常处理组件可以更好地处理这个问题，这样我就不必用混乱的异常处理管道填充我的 OnStart 了？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-12T07:30:04.107

好的，我现在对此进行了更多研究。当您在 .Net 中创建 Windows 服务时，您会创建一个继承自 System.ServiceProcess.ServiceBase 的类（在 VB 中，它隐藏在 .Designer.vb 文件中）。然后，您可以覆盖 OnStart 和 OnStop 函数，以及 OnPause 和 OnContinue（如果您选择）。这些方法是从基类中调用的，所以我对反射器做了一些探索。OnStart 由 System.ServiceProcess.ServiceBase 中称为 ServiceQueuedMainCallback 的方法调用。我机器上的版本“System.ServiceProcess, Version=2.0.0.0”反编译如下：

```
 Private Sub ServiceQueuedMainCallback(ByVal state As Object)
    Dim args As String() = DirectCast(state, String())
    Try 
        Me.OnStart(args)
        Me.WriteEventLogEntry(Res.GetString("StartSuccessful"))
        Me.status.checkPoint = 0
        Me.status.waitHint = 0
        Me.status.currentState = 4
    Catch exception As Exception
        Me.WriteEventLogEntry(Res.GetString("StartFailed", New Object() { exception.ToString }), EventLogEntryType.Error)
        Me.status.currentState = 1
    Catch obj1 As Object
        Me.WriteEventLogEntry(Res.GetString("StartFailed", New Object() { String.Empty }), EventLogEntryType.Error)
        Me.status.currentState = 1
    End Try
    Me.startCompletedSignal.Set
End Sub 

```

因此，因为 Me.OnStart(args) 是从 Try Catch 块的 Try 部分中调用的，所以我假设 OnStart 方法中发生的任何事情都被该 Try Catch 块有效包装，因此发生的任何异常在技术上都不会被处理为它们实际上是在 ServiceQueuedMainCallback Try Catch 中处理的。所以 CurrentDomain.UnhandledException 至少在启动例程期间实际上从未发生过。其他 3 个入口点（OnStop、OnPause 和 OnContinue）都以类似的方式从基类调用。

所以我“认为”这解释了为什么我的异常处理组件在启动和停止时无法捕获 UnhandledException，但我不确定它是否解释了为什么在 OnStart 中设置的计时器在触发时不会导致 UnhandledException。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T06:25:51.767

您可以订阅[AppDomain.UnhandledException 事件](http://msdn.microsoft.com/en-us/library/system.appdomain.unhandledexception.aspx)。如果您有消息循环，则可以绑定到[Application.ThreadException 事件](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.threadexception.aspx)。

# asp.net - Excel 类似于 ASP.NET 的服务器端控件

> ID：58289
> 
> 赞同：3
> 
> 时间：2008-09-12T04:18:39.607
> 
> 标签：asp.net, excel, servercontrols

我们需要增加用于在我们的 web 应用程序上编辑的网格的功能，我们的经理一直引用 Excel 作为数据网格的完美示例：/ 他仍然没有真正理解类似电子表格的控件没有' t 存在开箱即用，但我想我还是会做一些搜索。

我在 Google 上找到了一些产品，但想知道是否有人对任何此类控件有任何反馈（显然越便宜或*越*自由越好）

**编辑**我们目前确实有 Telerik 控件，但“当前”要求是一个控件，可以从一行复制和粘贴（例如）3 个单元格并将它们粘贴到另一行，Telerik 的逐行编辑没有真的剪了。我们目前正在与基于“Excel”的解决方案竞争，这对于赢得周围的用户来说总是一场噩梦，他们总是更喜欢结构的灵活性

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T04:22:00.330

更新：随着 Silverlight 的快速临近，也许您可​​以使用真正的 excel 控件。

[Devexpress](http://www.devexpress.com/Products/NET/Controls/ASP/Grid/)为 web 和 windows 提供了强大的网格控件。它不是免费的，我想没有什么能真正匹配 Excel。但是一旦用户开始使用它，他们就希望每个应用程序都使用它。检查这些[视频](http://www.devexpress.com/Products/NET/Controls/ASP/Grid/quickstart.xml)，尤其是数据分组之一。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-18T05:08:11.730

您可以考虑使用原生 Excel 功能的 3rd 方工具。论坛上最热门的：

*   [设置 Excel 单元格](http://www.aspose.com/)

*   [.NET 的 ComponentOne XLS](http://www.componentone.com/)

*   或[Excel Jetcell .NET](http://www.devtriogroup.com/ExcelJetcell/Default.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-18T12:06:10.437

这可能与您的问题没有直接关系，但是在服务器端，您是否考虑过需要执行哪些操作来模仿 Excel？您可能想查看[SpreadsheetGear](http://www.spreadsheetgear.com/)它将为您提供完整的宏功能。

它们具有我尚未使用的新图表功能，但它们应该可以与 Asp.net 一起使用。

# python - 如何在 Python 中获取套接字的外部 IP？

> ID：58294
> 
> 赞同：10
> 
> 时间：2008-09-12T04:21:51.237
> 
> 标签：python, sockets

当我调用`socket.getsockname()`一个套接字对象时，它会返回我机器内部 IP 和端口的元组。但是，我想检索我的外部 IP。这样做最便宜、最有效的方式是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-12T04:23:53.853

如果没有外部服务器的合作，这是不可能的，因为您和另一台计算机之间可能存在任意数量的 NAT。如果它是自定义协议，您可以要求其他系统报告它连接到的地址。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-12T04:24:34.473

我能想到的唯一能保证给你的方法是点击[http://whatismyip.com/](http://whatismyip.com/)之类的服务来获取它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-29T04:11:24.903

[https://github.com/bobeirasa/mini-scripts/blob/master/externalip.py](https://github.com/bobeirasa/mini-scripts/blob/master/externalip.py)

```
'''
Finds your external IP address
'''

import urllib
import re

def get_ip():
    group = re.compile(u'(?P<ip>\d+\.\d+\.\d+\.\d+)').search(urllib.URLopener().open('http://jsonip.com/').read()).groupdict()
    return group['ip']

if __name__ == '__main__':
    print get_ip() 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-04-08T07:59:33.130

您需要使用外部系统来执行此操作。

DuckDuckGo 的 IP 答案将以 JSON 格式为您提供您想要的内容！

```
import requests

def detect_public_ip():
    try:
        # Use a get request for api.duckduckgo.com
        raw = requests.get('https://api.duckduckgo.com/?q=ip&format=json')
        # load the request as json, look for Answer.
        # split on spaces, find the 5th index ( as it starts at 0 ), which is the IP address
        answer = raw.json()["Answer"].split()[4]
    # if there are any connection issues, error out
    except Exception as e:
        return 'Error: {0}'.format(e)
    # otherwise, return answer
    else:
        return answer

public_ip = detect_public_ip()
print(public_ip) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T01:17:04.173

导入套接字

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect(("msn.com",80))

s.getsockname()

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-13T10:10:36.577

```
print (urllib.urlopen('http://automation.whatismyip.com/n09230945.asp').read()) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-03-07T14:34:48.980

获取公共 IP 的最简单方法是使用此

```
import requests

IP = requests.get('https://api.ipify.org/').text
print(f'Your IP is: {IP}') 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-15T14:46:48.980

使用[http://whatismyip.com来源中建议的地址](http://whatismyip.com)

```
import urllib
def get_my_ip_address():
    whatismyip = 'http://www.whatismyip.com/automation/n09230945.asp'
    return urllib.urlopen(whatismyip).readlines()[0] 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-01-04T17:26:20.183

* * *

您需要连接到外部服务器并从响应中获取您的公共 IP

* * *

**像这样**：

```
 import requests

   myPublic_IP = requests.get("http://wtfismyip.com/text").text.strip()

   print("\n[+] My Public IP: "+ myPublic_IP+"\n") 
```

# c# - 用于处理 PowerPoint 文件的工具

> ID：58300
> 
> 赞同：0
> 
> 时间：2008-09-12T04:32:15.237
> 
> 标签：c#, .net, powerpoint

您知道用于处理 PowerPoint 文件的**托管工具吗？**

该工具应该是 100% 托管代码，并提供处理`.ppt`和`.pptx`文件的选项。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-12T04:48:51.843

好吧，100% 托管可能会走上艰难的道路，但是，您可以使用 .NET 代码中的[Office PIA](http://www.microsoft.com/downloads/details.aspx?familyid=59DAEBAA-BED4-4282-A28C-B864D8BFA513)。Joel Spolsky 有[一篇文章](http://www.joelonsoftware.com/items/2008/02/19.html)讨论您的各种选择。

# java - 有没有办法使用 Java 截取屏幕截图并将其保存到某种图像中？

> ID：58305
> 
> 赞同：133
> 
> 时间：2008-09-12T04:36:44.007
> 
> 标签：java, image, screenshot

正如标题所说的那样简单：你可以只使用 Java 命令来截取屏幕截图并保存吗？或者，我是否需要使用特定于操作系统的程序来截取屏幕截图，然后将其从剪贴板上抓取？

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2008-09-12T04:56:20.733

信不信由你，您实际上可以使用[`java.awt.Robot`](http://java.sun.com/javase/6/docs/api/java/awt/Robot.html#createScreenCapture(java.awt.Rectangle))“创建包含从屏幕读取的像素的图像”。然后，您可以将该图像写入磁盘上的文件。

我刚试了一下，整个事情结束了：

```
Rectangle screenRect = new Rectangle(Toolkit.getDefaultToolkit().getScreenSize());
BufferedImage capture = new Robot().createScreenCapture(screenRect);
ImageIO.write(capture, "bmp", new File(args[0])); 
```

注意：这只会捕获主监视器。有关多显示器支持，请参阅[GraphicsConfiguration 。](http://java.sun.com/javase/6/docs/api/java/awt/GraphicsConfiguration.html)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-05-29T09:01:25.283

我从不喜欢使用 Robot，所以我自己做了一个简单的方法来制作 JFrame 对象的屏幕截图：

```
public static final void makeScreenshot(JFrame argFrame) {
    Rectangle rec = argFrame.getBounds();
    BufferedImage bufferedImage = new BufferedImage(rec.width, rec.height, BufferedImage.TYPE_INT_ARGB);
    argFrame.paint(bufferedImage.getGraphics());

    try {
        // Create temp file
        File temp = File.createTempFile("screenshot", ".png");

        // Use the ImageIO API to write the bufferedImage to a temporary file
        ImageIO.write(bufferedImage, "png", temp);

        // Delete temp file when program exits
        temp.deleteOnExit();
    } catch (IOException ioe) {
        ioe.printStackTrace();
    }
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-08-09T22:17:48.323

如果您想捕获所有监视器，可以使用以下代码：

```
GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
GraphicsDevice[] screens = ge.getScreenDevices();

Rectangle allScreenBounds = new Rectangle();
for (GraphicsDevice screen : screens) {
    Rectangle screenBounds = screen.getDefaultConfiguration().getBounds();

    allScreenBounds.width += screenBounds.width;
    allScreenBounds.height = Math.max(allScreenBounds.height, screenBounds.height);
}

Robot robot = new Robot();
BufferedImage screenShot = robot.createScreenCapture(allScreenBounds); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-06-21T06:49:11.990

```
public void captureScreen(String fileName) throws Exception {
   Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();
   Rectangle screenRectangle = new Rectangle(screenSize);
   Robot robot = new Robot();
   BufferedImage image = robot.createScreenCapture(screenRectangle);
   ImageIO.write(image, "png", new File(fileName));
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-12-22T13:48:47.013

```
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Rectangle;
import java.awt.Robot;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.image.BufferedImage;
import java.io.File; 
import javax.imageio.ImageIO;
import javax.swing.*;  

public class HelloWorldFrame extends JFrame implements ActionListener {

JButton b;
public HelloWorldFrame() {
    this.setVisible(true);
    this.setLayout(null);
    b = new JButton("Click Here");
    b.setBounds(380, 290, 120, 60);
    b.setBackground(Color.red);
    b.setVisible(true);
    b.addActionListener(this);
    add(b);
    setSize(1000, 700);
}
public void actionPerformed(ActionEvent e)
{
    if (e.getSource() == b) 
    {
        this.dispose();
        try {
            Thread.sleep(1000);
            Toolkit tk = Toolkit.getDefaultToolkit(); 
            Dimension d = tk.getScreenSize();
            Rectangle rec = new Rectangle(0, 0, d.width, d.height);  
            Robot ro = new Robot();
            BufferedImage img = ro.createScreenCapture(rec);
            File f = new File("myimage.jpg");//set appropriate path
            ImageIO.write(img, "jpg", f);
        } catch (Exception ex) {
            System.out.println(ex.getMessage());
        }
    }
}

public static void main(String[] args) {
    HelloWorldFrame obj = new HelloWorldFrame();
}
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-06-26T23:57:18.203

```
GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();  
GraphicsDevice[] screens = ge.getScreenDevices();       
Rectangle allScreenBounds = new Rectangle();  
for (GraphicsDevice screen : screens) {  
       Rectangle screenBounds = screen.getDefaultConfiguration().getBounds();        
       allScreenBounds.width += screenBounds.width;  
       allScreenBounds.height = Math.max(allScreenBounds.height, screenBounds.height);
       allScreenBounds.x=Math.min(allScreenBounds.x, screenBounds.x);
       allScreenBounds.y=Math.min(allScreenBounds.y, screenBounds.y);
      } 
Robot robot = new Robot();
BufferedImage bufferedImage = robot.createScreenCapture(allScreenBounds);
File file = new File("C:\\Users\\Joe\\Desktop\\scr.png");
if(!file.exists())
    file.createNewFile();
FileOutputStream fos = new FileOutputStream(file);
ImageIO.write( bufferedImage, "png", fos ); 
```

bufferedImage 将包含一个完整的屏幕截图，这是用三台显示器测试的

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-29T11:24:02.523

你可以用它`java.awt.Robot`来完成这个任务。

下面是服务器的代码，它将捕获的屏幕截图保存为您的目录中的图像。

```
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.SocketTimeoutException;
import java.sql.SQLException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;

import javax.imageio.ImageIO;

public class ServerApp extends Thread
{
       private ServerSocket serverSocket=null;
       private static Socket server = null;
       private Date date = null;
       private static final String DIR_NAME = "screenshots";

   public ServerApp() throws IOException, ClassNotFoundException, Exception{
       serverSocket = new ServerSocket(61000);
       serverSocket.setSoTimeout(180000);
   }

public void run()
   {
       while(true)
      {
           try
           {
              server = serverSocket.accept();
              date = new Date();
                  DateFormat dateFormat = new SimpleDateFormat("_yyMMdd_HHmmss");
              String fileName = server.getInetAddress().getHostName().replace(".", "-");
              System.out.println(fileName);
              BufferedImage img=ImageIO.read(ImageIO.createImageInputStream(server.getInputStream()));
              ImageIO.write(img, "png", new File("D:\\screenshots\\"+fileName+dateFormat.format(date)+".png"));
              System.out.println("Image received!!!!");
              //lblimg.setIcon(img);
          }
         catch(SocketTimeoutException st)
         {
               System.out.println("Socket timed out!"+st.toString());
 //createLogFile("[stocktimeoutexception]"+stExp.getMessage());
                  break;
             }
             catch(IOException e)
             {
                  e.printStackTrace();
                  break;
         }
         catch(Exception ex)
        {
              System.out.println(ex);
        }
      }
   }

   public static void main(String [] args) throws IOException, SQLException, ClassNotFoundException, Exception{
          ServerApp serverApp = new ServerApp();
          serverApp.createDirectory(DIR_NAME);
          Thread thread = new Thread(serverApp);
            thread.start();
   }

private void createDirectory(String dirName) {
    File newDir = new File("D:\\"+dirName);
    if(!newDir.exists()){
        boolean isCreated = newDir.mkdir();
    }
 }
} 
```

这是在线程上运行的客户端代码，几分钟后它正在捕获用户屏幕的屏幕截图。

```
package com.viremp.client;

import java.awt.AWTException;
import java.awt.Dimension;
import java.awt.Rectangle;
import java.awt.Robot;
import java.awt.Toolkit;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.net.Socket;
import java.util.Random;

import javax.imageio.ImageIO;

public class ClientApp implements Runnable {
    private static long nextTime = 0;
    private static ClientApp clientApp = null;
    private String serverName = "192.168.100.18"; //loop back ip
    private int portNo = 61000;
    //private Socket serverSocket = null;

    /**
     * @param args
     * @throws InterruptedException 
     */
    public static void main(String[] args) throws InterruptedException {
        clientApp = new ClientApp();
        clientApp.getNextFreq();
        Thread thread = new Thread(clientApp);
        thread.start();
    }

    private void getNextFreq() {
        long currentTime = System.currentTimeMillis();
        Random random = new Random();
        long value = random.nextInt(180000); //1800000
        nextTime = currentTime + value;
        //return currentTime+value;
    }

    @Override
    public void run() {
        while(true){
            if(nextTime < System.currentTimeMillis()){
                System.out.println(" get screen shot ");
                try {
                    clientApp.sendScreen();
                    clientApp.getNextFreq();
                } catch (AWTException e) {
                    // TODO Auto-generated catch block
                    System.out.println(" err"+e);
                } catch (IOException e) {
                    // TODO Auto-generated catch block
                    e.printStackTrace();
                } catch(Exception e){
                    e.printStackTrace();
                }

            }
            //System.out.println(" statrted ....");
        }

    }

    private void sendScreen()throws AWTException, IOException {
           Socket serverSocket = new Socket(serverName, portNo);
             Toolkit toolkit = Toolkit.getDefaultToolkit();
             Dimension dimensions = toolkit.getScreenSize();
                 Robot robot = new Robot();  // Robot class 
                 BufferedImage screenshot = robot.createScreenCapture(new Rectangle(dimensions));
                 ImageIO.write(screenshot,"png",serverSocket.getOutputStream());
                 serverSocket.close();
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-10-31T13:31:02.260

Toolkit 根据 PPI 返回像素，因此在 Windows 中使用 PPI> 100% 时不会为整个屏幕创建屏幕截图。我建议这样做：

```
DisplayMode displayMode = GraphicsEnvironment.getLocalGraphicsEnvironment().getScreenDevices()[0].getDisplayMode();
Rectangle screenRectangle = new Rectangle(displayMode.getWidth(), displayMode.getHeight());
BufferedImage screenShot = new Robot().createScreenCapture(screenRectangle); 
```

# algorithm - 查找两个任意顶点之间所有连接的图算法

> ID：58306
> 
> 赞同：119
> 
> 时间：2008-09-12T04:36:51.637
> 
> 标签：algorithm, language-agnostic, graph-theory

我正在尝试确定完成下述任务的最佳时间效率算法。

我有一组记录。对于这组记录，我有连接数据，指示该组中的记录对如何相互连接。这基本上表示一个无向图，记录是顶点，连接数据是边。

集合中的所有记录都具有连接信息（即不存在孤立记录；集合中的每条记录都连接到集合中的一个或多个其他记录）。

我想从集合中选择任意两条记录，并能够显示所选记录之间的所有简单路径。“简单路径”是指路径中没有重复记录的路径（即仅限有限路径）。

注意：两个选择的记录总是不同的（即开始和结束顶点永远不会相同；没有循环）。

例如：

```
    如果我有以下记录：
        甲、乙、丙、丁、乙

    以下代表连接：
        (A,B),(A,C),(B,A),(B,D),(B,E),(B,F),(C,A),(C,E),
        (C,F),(D,B),(E,C),(E,F),(F,B),(F,C),(F,E)

        [其中 (A,B) 表示记录 A 连接到记录 B]

```

如果我选择 B 作为我的开始记录，E 作为我的结束记录，我希望找到所有通过记录连接的简单路径，这些路径将记录 B 连接到记录 E。

```
   连接 B 到 E 的所有路径：
      B->E
      B->F->E
      B->F->C->E
      B->A->C->E
      B->A->C->F->E

```

这是一个例子，实际上我可能有包含数十万条记录的集合。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-09-12T07:25:43.867

看来这可以通过图形的深度优先搜索来完成。**深度优先搜索将找到两个节点之间的所有非循环路径。**该算法应该非常快并且可以扩展到大型图形（图形数据结构是稀疏的，因此它只使用所需的内存）。

我注意到您在上面指定的图形只有一个有方向的边（B，E）。这是一个错字还是真的是一个有向图？该解决方案无论如何都有效。抱歉，我无法在 C 语言中做到这一点，我在这方面有点弱。不过，我希望您能够毫不费力地翻译这段 Java 代码。

**图.java：**

```
import java.util.HashMap;
import java.util.LinkedHashSet;
import java.util.LinkedList;
import java.util.Map;
import java.util.Set;

public class Graph {
    private Map<String, LinkedHashSet<String>> map = new HashMap();

    public void addEdge(String node1, String node2) {
        LinkedHashSet<String> adjacent = map.get(node1);
        if(adjacent==null) {
            adjacent = new LinkedHashSet();
            map.put(node1, adjacent);
        }
        adjacent.add(node2);
    }

    public void addTwoWayVertex(String node1, String node2) {
        addEdge(node1, node2);
        addEdge(node2, node1);
    }

    public boolean isConnected(String node1, String node2) {
        Set adjacent = map.get(node1);
        if(adjacent==null) {
            return false;
        }
        return adjacent.contains(node2);
    }

    public LinkedList<String> adjacentNodes(String last) {
        LinkedHashSet<String> adjacent = map.get(last);
        if(adjacent==null) {
            return new LinkedList();
        }
        return new LinkedList<String>(adjacent);
    }
} 
```

**搜索.java：**

```
import java.util.LinkedList;

public class Search {

    private static final String START = "B";
    private static final String END = "E";

    public static void main(String[] args) {
        // this graph is directional
        Graph graph = new Graph();
        graph.addEdge("A", "B");
        graph.addEdge("A", "C");
        graph.addEdge("B", "A");
        graph.addEdge("B", "D");
        graph.addEdge("B", "E"); // this is the only one-way connection
        graph.addEdge("B", "F");
        graph.addEdge("C", "A");
        graph.addEdge("C", "E");
        graph.addEdge("C", "F");
        graph.addEdge("D", "B");
        graph.addEdge("E", "C");
        graph.addEdge("E", "F");
        graph.addEdge("F", "B");
        graph.addEdge("F", "C");
        graph.addEdge("F", "E");
        LinkedList<String> visited = new LinkedList();
        visited.add(START);
        new Search().depthFirst(graph, visited);
    }

    private void depthFirst(Graph graph, LinkedList<String> visited) {
        LinkedList<String> nodes = graph.adjacentNodes(visited.getLast());
        // examine adjacent nodes
        for (String node : nodes) {
            if (visited.contains(node)) {
                continue;
            }
            if (node.equals(END)) {
                visited.add(node);
                printPath(visited);
                visited.removeLast();
                break;
            }
        }
        for (String node : nodes) {
            if (visited.contains(node) || node.equals(END)) {
                continue;
            }
            visited.addLast(node);
            depthFirst(graph, visited);
            visited.removeLast();
        }
    }

    private void printPath(LinkedList<String> visited) {
        for (String node : visited) {
            System.out.print(node);
            System.out.print(" ");
        }
        System.out.println();
    }
} 
```

程序输出：

```
B E 
B A C E 
B A C F E 
B F E 
B F C E 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-16T19:20:44.037

美国国家标准与技术研究院 (NIST) 在线算法和数据结构词典将此问题列为“[所有简单路径”](https://xlinux.nist.gov/dads/HTML/allSimplePaths.html)，并建议进行[深度优先搜索](https://xlinux.nist.gov/dads/HTML/depthfirst.html)。CLRS 提供相关算法。

[在这里](http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=1084515)可以找到使用 Petri 网的巧妙技术

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-12T07:48:29.787

这是我想出的伪代码。这不是任何特定的伪代码方言，但应该足够简单易懂。

任何人都想把这个分开。

*   [p] 是表示当前路径的顶点列表。

*   [x] 是满足条件的路径列表

*   [s] 是源顶点

*   [d] 是目标顶点

*   [c] 是当前顶点（PathFind 例程的参数）

假设有一种查找相邻顶点的有效方法（第 6 行）。

```
     1 路径列表 [p]
     2 ListOfPathLists [x]
     3 个顶点 [s]、[d]

     4 寻路（顶点[c]）
     5 将 [c] 添加到列表 [p] 的尾部
     6 对于与 [c] 相邻的每个顶点 [v]
     7 如果 [v] 等于 [d] 则
     8 在 [x] 中保存列表 [p]
     9 Else 如果 [v] 不在列表 [p] 中
    10 寻路（[v]）
    11 下一个
    12 从 [p] 中删除尾部
    13 返回

```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-02-21T01:36:30.963

[由于这个答案](https://stackoverflow.com/questions/58306/graph-algorithm-to-find-all-connections-between-two-arbitrary-vertices/26429707#26429707)中给出的现有非递归 DFS 实现似乎被破坏了，让我提供一个真正有效的实现。

我已经用 Python 编写了这个，因为我发现它非常易读并且没有实现细节（并且因为它有`yield`用于实现[generators](https://wiki.python.org/moin/Generators)的方便关键字），但它应该很容易移植到其他语言。

```
# a generator function to find all simple paths between two nodes in a
# graph, represented as a dictionary that maps nodes to their neighbors
def find_simple_paths(graph, start, end):
    visited = set()
    visited.add(start)

    nodestack = list()
    indexstack = list()
    current = start
    i = 0

    while True:
        # get a list of the neighbors of the current node
        neighbors = graph[current]

        # find the next unvisited neighbor of this node, if any
        while i < len(neighbors) and neighbors[i] in visited: i += 1

        if i >= len(neighbors):
            # we've reached the last neighbor of this node, backtrack
            visited.remove(current)
            if len(nodestack) < 1: break  # can't backtrack, stop!
            current = nodestack.pop()
            i = indexstack.pop()
        elif neighbors[i] == end:
            # yay, we found the target node! let the caller process the path
            yield nodestack + [current, end]
            i += 1
        else:
            # push current node and index onto stacks, switch to neighbor
            nodestack.append(current)
            indexstack.append(i+1)
            visited.add(neighbors[i])
            current = neighbors[i]
            i = 0 
```

这段代码维护了两个并行堆栈：一个包含当前路径中较早的节点，另一个包含节点堆栈中每个节点的当前邻居索引（这样我们可以在弹出节点时恢复遍历节点的邻居堆栈）。我同样可以很好地使用单个堆栈（节点，索引）对，但我认为双堆栈方法更具可读性，并且对于其他语言的用户来说可能更容易实现。

这段代码还使用了一个单独的`visited`集合，它总是包含当前节点和堆栈上的任何节点，让我有效地检查一个节点是否已经是当前路径的一部分。如果您的语言碰巧有一个“有序集”数据结构，它提供了高效的类似堆栈的推送/弹出操作*和*高效的成员资格查询，您可以将它用于节点堆栈并摆脱单独的`visited`集合。

或者，如果您为节点使用自定义的可变类/结构，您可以只在每个节点中存储一个布尔标志，以指示它是否已作为当前搜索路径的一部分被访问。当然，如果您出于某种原因希望这样做，此方法不会让您在同一个图上并行运行两个搜索。

下面是一些测试代码，演示了上面给出的函数是如何工作的：

```
# test graph:
#     ,---B---.
#     A   |   D
#     `---C---'
graph = {
    "A": ("B", "C"),
    "B": ("A", "C", "D"),
    "C": ("A", "B", "D"),
    "D": ("B", "C"),
}

# find paths from A to D
for path in find_simple_paths(graph, "A", "D"): print " -> ".join(path) 
```

在给定的示例图上运行此代码会产生以下输出：

```
A -> B -> C -> D
A -> B -> D
A -> C -> B -> D
A -> C -> D

```

请注意，虽然这个示例图是无向的（即它的所有边都是双向的），但该算法也适用于任意有向图。例如，删除`C -> B`边（通过`B`从 的邻居列表中删除`C`）产生相同的输出，除了第三条路径 ( `A -> C -> B -> D`)，这不再可能。

* * *

**附言。**很容易构造像这样的简单搜索算法（以及这个线程中给出的其他算法）性能很差的图。

例如，考虑在无向图上查找从 A 到 B 的所有路径的任务，其中起始节点 A 有两个邻居：目标节点 B（除 A 之外没有其他邻居）和节点 C，它是[集团的一部分](https://en.wikipedia.org/wiki/Clique_%28graph_theory%29)*n* +1 个节点，如下所示：

```
graph = {
    "A": ("B", "C"),
    "B": ("A"),
    "C": ("A", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O"),
    "D": ("C", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O"),
    "E": ("C", "D", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O"),
    "F": ("C", "D", "E", "G", "H", "I", "J", "K", "L", "M", "N", "O"),
    "G": ("C", "D", "E", "F", "H", "I", "J", "K", "L", "M", "N", "O"),
    "H": ("C", "D", "E", "F", "G", "I", "J", "K", "L", "M", "N", "O"),
    "I": ("C", "D", "E", "F", "G", "H", "J", "K", "L", "M", "N", "O"),
    "J": ("C", "D", "E", "F", "G", "H", "I", "K", "L", "M", "N", "O"),
    "K": ("C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O"),
    "L": ("C", "D", "E", "F", "G", "H", "I", "J", "K", "M", "N", "O"),
    "M": ("C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "N", "O"),
    "N": ("C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "O"),
    "O": ("C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N"),
} 
```

很容易看出 A 和 B 之间的唯一路径是直接路径，但是从节点 A 开始的幼稚 DFS 将浪费 O( *n* !) 时间无用地探索集团内的路径，即使（对人类而言）很明显这些路径都不可能通向 B。

也可以构造具有相似属性的[DAG](https://en.wikipedia.org/wiki/Directed_acyclic_graph)，例如，通过让起始节点 A 连接目标节点 B 和两个其他节点 C [1]和 C [2]，这两个节点都连接到节点 D [1]和 D [2]，这两个节点都连接到 E [1]和 E [2]，依此类推。对于这样排列的*n*层节点，简单地搜索从 A 到 B 的所有路径最终会浪费 O(2 ^(*n*) ) 时间检查所有可能的死胡同，然后再放弃。

当然，从派系中的一个节点（C 除外）或从 DAG 的最后一层向目标节点 B 添加一条边，*将*创建从 A 到 B 的指数级大量可能路径，并且纯粹的局部搜索算法无法真正提前判断它是否会找到这样的边缘。因此，从某种意义上说，这种幼稚搜索的[输出敏感性](https://en.wikipedia.org/wiki/Output-sensitive_algorithm)差是由于他们缺乏对图的全局结构的认识。

虽然有各种预处理方法（如迭代消除叶节点、搜索单节点顶点分隔符等）可用于避免其中一些“指数时间死胡同”，但我不知道有什么通用的在*所有*情况下都可以消除它们的预处理技巧。一个通用的解决方案是在搜索的每一步检查目标节点是否仍然可以访问（使用子搜索），如果不是，则尽早回溯——但是，这会显着减慢搜索速度（最坏的情况是，与图的大小成正比）对于许多*不*包含这种病态死角的图。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-11-25T00:28:31.737

与二楼相比，这是一个逻辑上更好看的递归版本。

```
public class Search {

private static final String START = "B";
private static final String END = "E";

public static void main(String[] args) {
    // this graph is directional
    Graph graph = new Graph();
    graph.addEdge("A", "B");
    graph.addEdge("A", "C");
    graph.addEdge("B", "A");
    graph.addEdge("B", "D");
    graph.addEdge("B", "E"); // this is the only one-way connection
    graph.addEdge("B", "F");
    graph.addEdge("C", "A");
    graph.addEdge("C", "E");
    graph.addEdge("C", "F");
    graph.addEdge("D", "B");
    graph.addEdge("E", "C");
    graph.addEdge("E", "F");
    graph.addEdge("F", "B");
    graph.addEdge("F", "C");
    graph.addEdge("F", "E");
    List<ArrayList<String>> paths = new ArrayList<ArrayList<String>>();
    String currentNode = START;
    List<String> visited = new ArrayList<String>();
    visited.add(START);
    new Search().findAllPaths(graph, seen, paths, currentNode);
    for(ArrayList<String> path : paths){
        for (String node : path) {
            System.out.print(node);
            System.out.print(" ");
        }
        System.out.println();
    }   
}

private void findAllPaths(Graph graph, List<String> visited, List<ArrayList<String>> paths, String currentNode) {        
    if (currentNode.equals(END)) { 
        paths.add(new ArrayList(Arrays.asList(visited.toArray())));
        return;
    }
    else {
        LinkedList<String> nodes = graph.adjacentNodes(currentNode);    
        for (String node : nodes) {
            if (visited.contains(node)) {
                continue;
            } 
            List<String> temp = new ArrayList<String>();
            temp.addAll(visited);
            temp.add(node);          
            findAllPaths(graph, temp, paths, node);
        }
    }
}
} 
```

程序输出

```
B A C E 

B A C F E 

B E

B F C E

B F E 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-02-12T08:24:28.677

C代码中的解决方案。它基于使用最少内存的 DFS。

```
#include <stdio.h>
#include <stdbool.h>

#define maxN    20  

struct  nodeLink
{

    char node1;
    char node2;

};

struct  stack
{   
    int sp;
    char    node[maxN];
};   

void    initStk(stk)
struct  stack   *stk;
{
    int i;
    for (i = 0; i < maxN; i++)
        stk->node[i] = ' ';
    stk->sp = -1;   
}

void    pushIn(stk, node)
struct  stack   *stk;
char    node;
{

    stk->sp++;
    stk->node[stk->sp] = node;

}    

void    popOutAll(stk)
struct  stack   *stk;
{

    char    node;
    int i, stkN = stk->sp;

    for (i = 0; i <= stkN; i++)
    {
        node = stk->node[i];
        if (i == 0)
            printf("src node : %c", node);
        else if (i == stkN)
            printf(" => %c : dst node.\n", node);
        else
            printf(" => %c ", node);
    }

}

/* Test whether the node already exists in the stack    */
bool    InStack(stk, InterN)
struct  stack   *stk;
char    InterN;
{

    int i, stkN = stk->sp;  /* 0-based  */
    bool    rtn = false;    

    for (i = 0; i <= stkN; i++)
    {
        if (stk->node[i] == InterN)
        {
            rtn = true;
            break;
        }
    }

    return     rtn;

}

char    otherNode(targetNode, lnkNode)
char    targetNode;
struct  nodeLink    *lnkNode;
{

    return  (lnkNode->node1 == targetNode) ? lnkNode->node2 : lnkNode->node1;

}

int entries = 8;
struct  nodeLink    topo[maxN]    =       
    {
        {'b', 'a'}, 
        {'b', 'e'}, 
        {'b', 'd'}, 
        {'f', 'b'}, 
        {'a', 'c'},
        {'c', 'f'}, 
        {'c', 'e'},
        {'f', 'e'},               
    };

char    srcNode = 'b', dstN = 'e';      

int reachTime;  

void    InterNode(interN, stk)
char    interN;
struct  stack   *stk;
{

    char    otherInterN;
    int i, numInterN = 0;
    static  int entryTime   =   0;

    entryTime++;

    for (i = 0; i < entries; i++)
    {

        if (topo[i].node1 != interN  && topo[i].node2 != interN) 
        {
            continue;   
        }

        otherInterN = otherNode(interN, &topo[i]);

        numInterN++;

        if (otherInterN == stk->node[stk->sp - 1])
        {
            continue;   
        }

        /*  Loop avoidance: abandon the route   */
        if (InStack(stk, otherInterN) == true)
        {
            continue;   
        }

        pushIn(stk, otherInterN);

        if (otherInterN == dstN)
        {
            popOutAll(stk);
            reachTime++;
            stk->sp --;   /*    back trace one node  */
            continue;
        }
        else
            InterNode(otherInterN, stk);

    }

        stk->sp --;

}

int    main()

{

    struct  stack   stk;

    initStk(&stk);
    pushIn(&stk, srcNode);  

    reachTime = 0;
    InterNode(srcNode, &stk);

    printf("\nNumber of all possible and unique routes = %d\n", reachTime);

} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-10-17T16:44:02.613

这可能晚了，但这里是来自 Casey 的 Java 中相同的 C# 版本的 DFS 算法，用于使用堆栈遍历两个节点之间的所有路径。与往常一样，递归的可读性更好。

```
 void DepthFirstIterative(T start, T endNode)
    {
        var visited = new LinkedList<T>();
        var stack = new Stack<T>();

        stack.Push(start);

        while (stack.Count != 0)
        {
            var current = stack.Pop();

            if (visited.Contains(current))
                continue;

            visited.AddLast(current);

            var neighbours = AdjacentNodes(current);

            foreach (var neighbour in neighbours)
            {
                if (visited.Contains(neighbour))
                    continue;

                if (neighbour.Equals(endNode))
                {
                    visited.AddLast(neighbour);
                    printPath(visited));
                    visited.RemoveLast();
                    break;
                }
            }

            bool isPushed = false;
            foreach (var neighbour in neighbours.Reverse())
            {
                if (neighbour.Equals(endNode) || visited.Contains(neighbour) || stack.Contains(neighbour))
                {
                    continue;
                }

                isPushed = true;
                stack.Push(neighbour);
            }

            if (!isPushed)
                visited.RemoveLast();
        }
    } 
```

```
这是要测试的示例图：

    // 示例图。数字是边缘 id
    // 1 3       
    // A --- B --- C ----
    // | | 2 |
    // | 4 ----- D |
    // ------------------

```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-12T04:49:42.543

我最近解决了一个与此类似的问题，而不是我只对最短的解决方案感兴趣。

我使用了“广度优先”迭代搜索，它使用了一个状态队列，每个状态都包含一个记录，其中包含图表上的当前点和到达那里的路径。

您从队列中的单个记录开始，该记录具有起始节点和空路径。

代码的每一次迭代都将项目从列表的头部取出，并检查它是否是一个解决方案（到达的节点是你想要的，如果是，我们就完成了），否则，它构造一个新的具有连接到当前节点的节点的队列项，以及基于前一个节点的路径的修改路径，并在末尾附加了新的跳转。

现在，您可以使用类似的方法，但是当您找到解决方案时，不要停止，而是将该解决方案添加到您的“找到的列表”并继续。

您需要跟踪访问过的节点列表，这样您就永远不会回溯自己，否则您将陷入无限循环。

如果您想要更多伪代码发表评论或其他内容，我会详细说明。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-12T07:24:47.927

我认为你应该描述你背后的真正问题。我这样说是因为你要求一些时间效率高的东西，但问题的答案似乎成倍增长！

因此，我不希望有比指数算法更好的算法。

我会回溯并浏览整个图表。为了避免循环，沿途保存所有访问过的节点。当您返回时，取消标记该节点。

使用递归：

```
static bool[] visited;//all false
Stack<int> currentway; initialize empty

function findnodes(int nextnode)
{
if (nextnode==destnode)
{
  print currentway 
  return;
}
visited[nextnode]=true;
Push nextnode to the end of currentway.
for each node n accesible from nextnode:
  findnodes(n);
visited[nextnode]=false; 
pop from currenteay
} 
```

或者那是错的？

编辑：哦，我忘了：您应该通过利用该节点堆栈来消除递归调用

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-07-29T10:48:24.187

基本原则是您不必担心图形。这是称为动态连接问题的标准问题。有以下几种方法可以实现节点是否连接：

1.  快速查找
2.  快速联合
3.  改进的算法（两者的结合）

这是我尝试过的最小时间复杂度 O(log*n) 的 C 代码，这意味着对于 65536 个边列表，它需要 4 次搜索，而对于 2^65536，它需要 5 次搜索。我正在分享我的算法实现：[普林斯顿大学的算法课程](https://www.coursera.org/course/algs4partI)

**提示：您可以从上面共享的链接中找到 Java 解决方案，并附有适当的解释。**

```
/* Checking Connection Between Two Edges */

#include<stdio.h>
#include<stdlib.h>
#define MAX 100

/*
  Data structure used

vertex[] - used to Store The vertices
size - No. of vertices
sz[] - size of child's
*/

/*Function Declaration */
void initalize(int *vertex, int *sz, int size);
int root(int *vertex, int i);
void add(int *vertex, int *sz, int p, int q);
int connected(int *vertex, int p, int q);

int main() //Main Function
{ 
char filename[50], ch, ch1[MAX];
int temp = 0, *vertex, first = 0, node1, node2, size = 0, *sz;
FILE *fp;

printf("Enter the filename - "); //Accept File Name
scanf("%s", filename);
fp = fopen(filename, "r");
if (fp == NULL)
{
    printf("File does not exist");
    exit(1);
}
while (1)
{
    if (first == 0) //getting no. of vertices
    {
        ch = getc(fp);
        if (temp == 0)
        {
            fseek(fp, -1, 1);
            fscanf(fp, "%s", &ch1);
            fseek(fp, 1, 1);
            temp = 1;
        }
        if (isdigit(ch))
        {
            size = atoi(ch1);
            vertex = (int*) malloc(size * sizeof(int));     //dynamically allocate size  
            sz = (int*) malloc(size * sizeof(int));
            initalize(vertex, sz, size);        //initialization of vertex[] and sz[]
        }
        if (ch == '\n')
        {
            first = 1;
            temp = 0;
        }
    }
    else
    {
        ch = fgetc(fp);
        if (isdigit(ch))
            temp = temp * 10 + (ch - 48);   //calculating value from ch
        else
        {
            /* Validating the file  */

            if (ch != ',' && ch != '\n' && ch != EOF)
            {
                printf("\n\nUnkwown Character Detected.. Exiting..!");

                exit(1);
            }
            if (ch == ',')
                node1 = temp;
            else
            {
                node2 = temp;
                printf("\n\n%d\t%d", node1, node2);
                if (node1 > node2)
                {
                    temp = node1;
                    node1 = node2;
                    node2 = temp;
                }

                /* Adding the input nodes */

                if (!connected(vertex, node1, node2))
                    add(vertex, sz, node1, node2);
            }
            temp = 0;
        }

        if (ch == EOF)
        {
            fclose(fp);
            break;
        }
    }
}

do
{
    printf("\n\n==== check if connected ===");
    printf("\nEnter First Vertex:");
    scanf("%d", &node1);
    printf("\nEnter Second Vertex:");
    scanf("%d", &node2);

    /* Validating The Input */

    if( node1 > size || node2 > size )
    {
        printf("\n\n Invalid Node Value..");
        break;
    }

    /* Checking the connectivity of nodes */

    if (connected(vertex, node1, node2))
        printf("Vertex %d and %d are Connected..!", node1, node2);
    else
        printf("Vertex %d and %d are Not Connected..!", node1, node2);

    printf("\n 0/1:  ");

    scanf("%d", &temp);

} while (temp != 0);

free((void*) vertex);
free((void*) sz);

return 0;
}

void initalize(int *vertex, int *sz, int size) //Initialization of graph
{
int i;
for (i = 0; i < size; i++)
{
    vertex[i] = i;
    sz[i] = 0;
}
}
int root(int *vertex, int i)    //obtaining the root
{
while (i != vertex[i])
{
    vertex[i] = vertex[vertex[i]];
    i = vertex[i];
}
return i;
}

/* Time Complexity for Add --> logn */
void add(int *vertex, int *sz, int p, int q) //Adding of node
{
int i, j;
i = root(vertex, p);
j = root(vertex, q);

/* Adding small subtree in large subtree  */

if (sz[i] < sz[j])
{
    vertex[i] = j;
    sz[j] += sz[i];
}
else
{
    vertex[j] = i;
    sz[i] += sz[j];
}

}

/* Time Complexity for Search -->lg* n */

int connected(int *vertex, int p, int q) //Checking of  connectivity of nodes
{
/* Checking if root is same  */

if (root(vertex, p) == root(vertex, q))
    return 1;

return 0;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-03-04T19:29:11.673

# find_paths[s, t, d, k]

这个问题很老了，已经回答了。然而，没有一个可能显示出更灵活的算法来完成同样的事情。所以我会把我的帽子扔进戒指。

我个人觉得这种形式的算法`find_paths[s, t, d, k]`很有用，其中：

*   s 是起始节点
*   t 是目标节点
*   d 是要搜索的最大深度
*   k 是要查找的路径数

使用你的编程语言的无穷形式，`d`将给`k`你所有的路径§。

§ 显然，如果您使用的是有向图并且您想要所有*无向*路径之间的所有无向路径`s`，`t`您将不得不以两种方式运行：

```
find_paths[s, t, d, k] <join> find_paths[t, s, d, k] 
```

* * *

### 辅助函数

我个人喜欢递归，虽然它有时会很困难，但首先让我们定义我们的辅助函数：

```
def find_paths_recursion(graph, current, goal, current_depth, max_depth, num_paths, current_path, paths_found)
  current_path.append(current)

  if current_depth > max_depth:
    return

  if current == goal:
    if len(paths_found) <= number_of_paths_to_find:
      paths_found.append(copy(current_path))

    current_path.pop()
    return

  else:
    for successor in graph[current]:
    self.find_paths_recursion(graph, successor, goal, current_depth + 1, max_depth, num_paths, current_path, paths_found)

  current_path.pop() 
```

### 主功能

有了这些，核心功能就变得微不足道了：

```
def find_paths[s, t, d, k]:
  paths_found = [] # PASSING THIS BY REFERENCE  
  find_paths_recursion(s, t, 0, d, k, [], paths_found) 
```

* * *

首先，让我们注意一些事情：

*   上面的伪代码是语言的混搭——但最像 python（因为我只是在里面编码）。严格的复制粘贴是行不通的。
*   `[]`是一个未初始化的列表，将其替换为您选择的编程语言的等价物
*   `paths_found`通过**引用**传递。很明显，递归函数不返回任何东西。妥善处理。
*   这里`graph`假设某种形式的`hashed`结构。有很多方法可以实现图。无论哪种方式，都会为您提供有*向*`graph[vertex]`图中的相邻顶点列表- 相应地进行调整。
**   这假设您已进行预处理以移除“带扣”（自环）、循环和多边*

 ** * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-12T05:11:02.630

这是我脑海中的一个想法：

1.  找到一个连接。（深度优先搜索可能是一个很好的算法，因为路径长度并不重要。）
2.  禁用最后一段。
3.  尝试从先前禁用的连接之前的最后一个节点找到另一个连接。
4.  转到 2 直到没有更多的连接。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-12T08:29:27.647

据我所知，Ryan Fox（[58343](https://stackoverflow.com/questions/58306/graph-algorithm-to-find-all-connections-between-two-arbitrary-vertices#58343)、Christian（[58444](https://stackoverflow.com/questions/58306/graph-algorithm-to-find-all-connections-between-two-arbitrary-vertices#58444)）和您自己（[58461](https://stackoverflow.com/questions/58306/graph-algorithm-to-find-all-connections-between-two-arbitrary-vertices#58461)）给出的解决方案都差不多。我不相信广度优先遍历在这种情况下会有所帮助，因为你会没有得到所有的路径。例如，使用边`(A,B)`, `(A,C)`, `(B,C)`,你会得到路径`(B,D)`和，但不是。`(C,D)``ABD``ACD``ABCD`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-12-07T10:56:23.023

我找到了一种枚举所有路径的方法，包括包含循环的无限路径。

[http://blog.vjeux.com/2009/project/project-shortest-path.html](http://blog.vjeux.com/2009/project/project-shortest-path.html)

**寻找原子路径和循环**

```
Definition 
```

我们要做的是找到从 A 点到 B 点的所有可能路径。由于涉及到循环，您不能只遍历并枚举它们。相反，您必须找到不循环的原子路径和最小的可能循环（您不希望循环重复自身）。

我对原子路径的第一个定义是不通过同一个节点两次的路径。但是，我发现这并没有采取所有的可能性。经过一番反思，我发现节点并不重要，但边缘很重要！所以原子路径是一条不经过同一条边两次的路径。

这个定义很方便，它也适用于循环：点 A 的原子循环是从点 A 到点 A 的原子路径。

**执行**

```
Atomic Paths A -> B 
```

为了获得从点 A 开始的所有路径，我们将从点 A 递归遍历图。在遍历子节点时，我们将创建一个链接子节点 -> 父节点，以便了解我们的所有边已经越过了。在我们去那个孩子之前，我们必须遍历那个链表并确保指定的边还没有被遍历。

当我们到达目的地点时，我们可以存储我们找到的路径。

```
Freeing the list 
```

当你想释放链表时会出现问题。它基本上是一棵以相反顺序链接的树。一个解决方案是双链接该列表，当找到所有原子路径时，从起​​点释放树。

但一个聪明的解决方案是使用引用计数（灵感来自垃圾收集）。每次向父级添加链接时，都会在其引用计数中添加一个。然后，当你到达路径的尽头时，当引用计数等于 1 时，你向后自由移动。如果它更高，你只需删除一个并停止。

```
Atomic Cycle A 
```

寻找 A 的原子循环与寻找从 A 到 A 的原子路径相同。但是我们可以做一些优化。首先，当我们到达目的地点时，我们只想在边成本之和为负时保存路径：我们只想经历吸收循环。

如您之前所见，在寻找原子路径时正在遍历整个图。相反，我们可以将搜索区域限制在包含 A 的强连通分量。找到这些分量需要使用 Tarjan 算法对图进行简单的遍历。

**结合原子路径和循环**

至此，我们有了从 A 到 B 的所有原子路径以及每个节点的所有原子循环，留给我们来组织一切以获得最短路径。从现在开始，我们将研究如何在原子路径中找到原子循环的最佳组合。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-09-22T21:38:20.423

正如其他一些海报所描述的那样，简而言之，问题是使用深度优先搜索算法递归搜索图形以查找通信端节点之间的所有路径组合。

算法本身从你给它的起始节点开始，检查它的所有传出链接，并通过展开出现的搜索树的第一个子节点来进行，逐步深入搜索，直到找到目标节点，或者直到它遇到一个节点没有孩子。

然后搜索回溯，返回到尚未完成探索的最新节点。

我最近写了一篇关于这个主题的[博客，在这个过程中发布了一个示例 C++ 实现。](http://technical-recipes.com/?p=1142)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-08-26T18:39:39.993

添加到 Casey Watson 的回答中，这是另一个 Java 实现。用起始节点初始化访问节点。

```
private void getPaths(Graph graph, LinkedList<String> visitedNodes) {
                LinkedList<String> adjacent = graph.getAdjacent(visitedNodes.getLast());
                for(String node : adjacent){
                    if(visitedNodes.contains(node)){
                        continue;
                    }
                    if(node.equals(END)){
                        visitedNodes.add(node);
                        printPath(visitedNodes);
                        visitedNodes.removeLast();
                    }
                    visitedNodes.add(node);
                    getPaths(graph, visitedNodes);
                    visitedNodes.removeLast();  
                }
            } 
```

# javascript - Firefox 中 Flash 之上的 CSS / JavaScript 导航菜单

> ID：58317
> 
> 赞同：6
> 
> 时间：2008-09-12T04:47:42.670
> 
> 标签：javascript, css, flash, navigation

我的网站有一个内置在 CSS 和 JavaScript 中的下拉菜单，可以在 Flash 动画上下拉。在 IE (6&7) 中，下拉菜单会出现在 Flash 动画上，然而，在 Firefox (2&3) 中，菜单会出现在 Flash 动画下方。有没有办法让这个动态菜单在 Firefox 中流过 Flash？

![替代文字](https://lh3.ggpht.com/guterl/SMnyzAeha6I/AAAAAAAAABI/BGWJes9d9FA/s288/ie_sample.gif)

在 IE 7 中，Flash 上方出现菜单：

在 Firefox 中，菜单出现在 Flash 下：（我该如何解决这个问题？！）

![替代文字](https://lh3.ggpht.com/guterl/SMnyzHYVLrI/AAAAAAAAABQ/924qQaD3K0o/s288/firefox_sample.gif)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-12T06:02:37.843

尝试将 wmode 设置为透明 - 请参见[此处](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_15523)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T07:48:26.387

wmode=opaque 似乎对我有用

我在这里做的：www.toolgal.com，将鼠标悬停在顶部导航的产品菜单上

担

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-27T08:51:14.027

使用 z-index 并将菜单设置为 100 之类的值，将 flash 电影设置为负值，例如.....比如说 -1。

干杯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T05:07:03.733

您是否尝试过 iframe 技巧（即在菜单后面浮动 iframe，从而将 hte flash 图层放在后面。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T06:08:16.130

iframe-trick 仅适用于 IE（低于 IE7），因此它可能永远不会在 Firefox 中提供帮助。

我会尝试启用 wmode=transparent，以便 Flash 内容不会获得自己的 HWND

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:20:10.107

启用 wmode=transparent 是要走的路。但也请注意，Linux 中的 Firefox 不遵守这一点，并且闪存将始终位于顶部。

# .net - 如何测试 WPF 用户界面？

> ID：58340
> 
> 赞同：63
> 
> 时间：2008-09-12T05:08:09.610
> 
> 标签：.net, wpf, testing

使用带有[MVC](http://en.wikipedia.org/wiki/Model-view-controller) / [MVP](http://msdn.microsoft.com/en-us/magazine/cc188690.aspx)架构的 win 表单，我通常会使用一个类来包装视图以测试 UI，同时为模型和控制器/演示器使用模拟。包装类将通过属性和事件使 UI 中的大多数内容成为测试运行器的可观察属性。

这是测试 WPF 应用程序的可行方法吗？有没有更好的办法？有什么需要注意的问题吗？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-23T09:41:59.243

至于测试本身，您可能最好使用[UI 自动化](https://msdn.microsoft.com/library/ms747327.aspx)框架。或者，如果您想要更流畅且独立于 wpf/winforms/win32/swt 的框架使用方式，您可以从 Codeplex 下载[White](http://www.codeplex.com/white)（前提是您能够在您的环境中使用开源代码）。

对于陷阱；如果您尝试测试您的视图，您可能会遇到一些线程问题。例如，如果您正在运行 NUnit，默认的 testrunner 将在 MTA（多线程 Appartment）中运行，而 WPF 需要作为 STA（单线程 Appartment）运行。[Mike Two](http://miketwo.blogspot.com/2007/03/unit-testing-wpf-controls-with.html)在单元测试 WPF 方面非常容易上手，但没有考虑线程问题。Josh Smith 在[这篇文章](http://joshsmithonwpf.wordpress.com/2007/07/09/using-nunit-with-wpf/)中对线程问题有一些想法，他还指出了 Chris Hedgate 的[这篇文章](http://www.hedgate.net/articles/2007/01/08/instantiating-a-wpf-control-from-an-nunit-test/)。Chris 使用 Peter Provost 的[CrossThreadTestRunner](http://www.peterprovost.org/blog/post/NUnit-and-Multithreaded-Tests-CrossThreadTestRunner.aspx)的修改版本以更友好的方式包装 MTA/STA 问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-10-26T20:40:08.753

2016 更新：**使用免费的 TestStack.White 框架来自动化 WPF UI 测试**

*   [Project White 已被放弃](http://white.codeplex.com/)，但它的继任者[TestStack.White](http://teststackwhite.readthedocs.io/en/latest/GettingStarted/)可通过 NuGet 包获得。
*   TestStack.White 具有用于[启动 WPF 应用程序](http://teststackwhite.readthedocs.io/en/latest/#getting-hold-of-a-window)、[查找](http://teststackwhite.readthedocs.io/en/latest/#finding-a-ui-item-and-performing-action)窗口/[用户控制元素](http://teststackwhite.readthedocs.io/en/latest/UIItems/#wpf-items)、[单击按钮/元素](http://teststackwhite.readthedocs.io/en/latest/GettingStarted/#finding-a-ui-item-and-performing-action)、模拟[鼠标和键盘](http://teststackwhite.readthedocs.io/en/latest/AdvancedTopics/MouseAndKeyboard/)事件、[等待](http://teststackwhite.readthedocs.io/en/latest/AdvancedTopics/Waiting/)等的实用方法。
*   将启动 WPF 应用程序、单击按钮并检查结果的示例如下所示：

    ```
    using TestStack.White;
    using TestStack.White.UIItems;
    using TestStack.White.Factory;

    [TestMethod]
    public void TestDoSomething()
    {
        //Opens the app
        var app = Application.Launch("MyApp.exe");

        //Finds the main window (this and above line should be in [TestInitialize])
        var window = app.GetWindow("My App Window Title", InitializeOption.NoCache);

        //Finds the button (see other Get...() methods for options)
        var btnMyButton = window.Get<Button>("btnMyButtonWPFname");

        //Simulate clicking
        btnMyButton.Click();

        //Gets the result text box 
        //Note: TextBox/Button is in TestStack.White.UIItems namespace
        var txtMyTextBox = window.Get<TextBox>("txtMyTextBox");

        //Check for the result
        Assert.IsTrue(txtMyTextBox.Text == "my expected result");

        //Close the main window and the app (preferably in [TestCleanup])
        app.Close();
    } 
    ```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-12T05:13:43.937

@马特大卫，

请阅读文档并查看 Microsoft [CompositeWPF](http://www.codeplex.com/CompositeWPF)（又名 Prism）的代码示例。这是一个专门为教授如何以测试驱动的方式处理 MVP/MVC 架构而创建的项目。他们的示例应用程序包含针对演示者\控制器的单元测试和非常酷的 UI 验收测试（他们使用[White 框架](http://www.codeplex.com/white)来模拟用户操作）

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-12T06:03:42.817

**手动。**如果这就是你所得到的，我不是自动化*UI 测试的忠实拥护者。*我不确定 WPF 指南（需要通过 aku 的链接阅读）.. 因为可以说它们仍在巩固...... WPF 从“什么是正确的方式”的角度来看并没有稳定下来。除非您使用这些不断发展的框架之一..我会保守地努力

*   无情地测试（自动化的，最好是TDDed）逻辑/演示器/控制器。*我不是在提倡马虎或嗜睡*。
*   **保持 UI 皮肤薄，并让一些讨厌的测试人员**通过探索性测试对其进行（手动）破解——在 UI 方面，没有什么比“来自地狱的测试人员”更好的了。努力：自动化这种测试的收益比是巨大的，没有抓住一切，没有意义......除了安抚高层'看经理！没有手！自测用户界面！

PS：你可能想看[这个（Mary Poppendieck 的 Google Talk on Lean）.. 尤其是关于在测试中自动化的部分](http://video.google.com/videoplay?docid=-5105910452864283694)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-07-18T06:59:01.917

由于 Coded UI 框架在 Visual Studio 版本 2019 ( [Deprecated Coded UI](https://docs.microsoft.com/de-de/visualstudio/test/use-ui-automation-to-test-your-code?view=vs-2019) ) 之后过期，Microsoft 建议使用带有 WinAppDriver 的 Appium 来测试 Windows 应用程序（桌面和 UWP）。您可以直接使用 Appium（带有 WinAppDriver）或 WinAppDriver 来运行测试（[带有或不带有 Appium 的 WinAppDriver](https://github.com/Microsoft/WinAppDriver/wiki/WinAppDriver-and-Appium)）。

**WinAppDriver 直接**

以下是直接使用 WinAppDriver 的简短描述：

*   下载并安装 WinAppDriver：

    [WinAppDriver 发布](https://github.com/microsoft/WinAppDriver/releases)

*   在 Windows 设置中启用开发者模式

*   启动 WinAppDriver：

    C:\Program Files (x86)\Windows 应用程序驱动程序\WinAppDriver.exe

*   创建一个新的 Visual Studio 2019 单元测试项目 (.NET Framework)

*   添加 NuGet 包：~~Appium.WebDriver~~ Microsoft.WinAppDriver.Appium.WebDriver（来自 Microsoft 的评论：建议使用 WinAppDriver NuGet 包来充分利用 Actions API 的高级输入。）

*   添加一个新类 DesktopSession：

```
 public class DesktopSession
    {
        protected const string WindowsApplicationDriverUrl = "http://127.0.0.1:4723";
        private const string NotepadAppId = @"C:\Windows\System32\notepad.exe";

        protected static WindowsDriver<WindowsElement> session;
        protected static WindowsElement editBox;

        public static void Setup(TestContext context)
        {
            // Launch a new instance of Notepad application
            if (session == null)
            {
                // Create a new session to launch Notepad application
                var appCapabilities = new DesiredCapabilities();
                appCapabilities.SetCapability("app", NotepadAppId);
                appCapabilities.SetCapability("platformName", "Windows");
                appCapabilities.SetCapability("deviceName ", "WindowsPC");
                session = new WindowsDriver<WindowsElement>(new Uri(WindowsApplicationDriverUrl), appCapabilities);
                Assert.IsNotNull(session);
                Assert.IsNotNull(session.SessionId);

                // Set implicit timeout to 1.5 seconds to make element search to retry every 500 ms for at most three times
                session.Manage().Timeouts().ImplicitWait = TimeSpan.FromSeconds(1.5);

                // Keep track of the edit box to be used throughout the session
                editBox = session.FindElementByClassName("Edit");
                Assert.IsNotNull(editBox);
            }
        }

        public static void TearDown()
        {
            // Close the application and delete the session
            if (session != null)
            {
                session.Close();

                try
                {
                    // Dismiss Save dialog if it is blocking the exit
                    session.FindElementByName("Nicht speichern").Click();
                }
                catch { }

                session.Quit();
                session = null;
            }
        }

        [TestInitialize]
        public void TestInitialize()
        {
            // Select all text and delete to clear the edit box
            editBox.SendKeys(Keys.Control + "a" + Keys.Control);
            editBox.SendKeys(Keys.Delete);
            Assert.AreEqual(string.Empty, editBox.Text);
        }
    } 
```

*   更改 UnitTest1 类中的代码

```
 [TestClass]
        public class UnitTest1 : DesktopSession
        {
            [TestMethod]
            public void EditorEnterText()
            {
                Thread.Sleep(TimeSpan.FromSeconds(2));
                editBox.SendKeys("abcdeABCDE 12345");
                Assert.AreEqual(@"abcdeABCDE 12345", editBox.Text);
            }

            [ClassInitialize]
            public static void ClassInitialize(TestContext context)
            {
                Setup(context);
            }

            [ClassCleanup]
            public static void ClassCleanup()
            {
                TearDown();
            }
        } 
```

*   运行你的测试

（示例代码主要复制自[WinAppDriver .NotepadTest](https://github.com/microsoft/WinAppDriver/tree/master/Samples/C%23/NotepadTest)）。

**Appium 与 WinAppDriver**

如果你想使用 Appium 运行测试，那么你必须在你的机器上安装正确版本的 WinAppDriver。Appium 的安装程序还应该在您的机器上安装正确版本的 WinAppDriver（请为所有用户安装 Appium）。就我而言，不幸的是，这不起作用。所以我看一下文件：

```
C:\Program Files\Appium\resources\app\node_modules\appium\node_modules\appium-windows-driver\lib\installer.js 
```

在这里您将找到正确的版本和下载路径：

```
const WAD_VER = "1.1";
const WAD_DL = `https://github.com/Microsoft/WinAppDriver/releases/download/v${WAD_VER}/WindowsApplicationDriver.msi`; 
```

如果你安装了正确的 WinAppDriver，你就可以启动 Appium。

*重要提示*：您必须更改 ApplicationDriverUrl

```
protected const string WindowsApplicationDriverUrl = "http://127.0.0.1:4723/wd/hub"; 
```

工具：

*   [WindowsAppDriver UI 记录器](https://github.com/microsoft/WinAppDriver/tree/master/Tools/UIRecorder)

[WindowsAppDriver 和 UI REcorder 发布](https://github.com/microsoft/WinAppDriver/releases) 或下载[WinAppDriver 存储库](https://github.com/microsoft/WinAppDriver/releases)并在子目录 tools\UIRecorder 中构建 WinAppDriverUIRecorder.sln

[介绍 WinAppDriver UI 记录器](https://blogs.windows.com/windowsdeveloper/2018/06/20/introducing-winappdriver-ui-recorder/#jR4rmH2V4zpbYIe0.97)

*   inspect.exe：需要 Windows SDK（查看 C:\Program Files (x86)\Windows Kits\10\bin）

其他链接： [WinAppDriver FAQ](https://github.com/Microsoft/WinAppDriver/wiki/Frequently-Asked-Questions/289a8b325d3ddab9f08b4398c49163a9a136f607#running-on-a-remote-machine) [Appium](http://appium.io/)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2020-08-06T16:09:44.567

这个问题仍然是相关的，但许多答案已经过时了。[@deadpikle在](https://stackoverflow.com/questions/58340/how-to-test-a-wpf-user-interface#comment105831827_40271736)[评论](https://stackoverflow.com/questions/58340/how-to-test-a-wpf-user-interface#comment105831827_40271736) 中提出了一个很好的解决方案，我试过了，我想把它作为答案，以便更多人看到。

所以，这里有一个库[https://github.com/FlaUI/FlaUI](https://github.com/FlaUI/FlaUI)。这是 WPF 应用程序的快速入门指南：

1.  从 nuget 安装 FlaUI.UIA3

2.  写这个来测试应用程序是否正确运行（但插入你的字符串文字）：

    ```
    using FlaUI.Core;
    using FlaUI.Core.AutomationElements;
    using FlaUI.UIA3;
    using FluentAssertions;
    using System;
    using Xunit;

    namespace Functional
    {
        public sealed class General : IDisposable
        {
            private readonly Application _app = Application.Launch(@"..\App.exe");

            [Fact]
            public void AppStarts()
            {
                using var automation = new UIA3Automation();
                Window window = _app.GetMainWindow(automation, TimeSpan.FromSeconds(3));

                window.Should().NotBeNull("null means the window failed to load");

                window.Title.Should().Be("App title",
                    "otherwise, it could be message box with error in case of the wrong configuration");
            }

            public void Dispose()
            {
                _app.Close();
                _app.Dispose();
            }
        }
    } 
    ```

此代码在 GitHub Actions 管道中也能很好地工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-04T16:02:54.647

一定要看看 TestAutomationFX.com。一个人可以投入（好吧，我做过）很多时间来尝试捕捉/记录与 White 的事件。（在我的任务开始时，我忽略了其他地方提到的一两个帖子）。

我当然第二点关于最好的测试类型不是 UI 测试。

但是，如果有人打算在 UI 中做一些可自动化的事情来解决其他类型测试覆盖的缺点，那么 TAFX 似乎是那里最快的途径。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T20:49:09.167

尝试使用 Ranorex V2.0 实现 WPF 自动化。使用 RanoreXPath 和 Ranorex 存储库，测试自动化代码可以与识别信息完全分离。Ranorex 还提供了基于 RanoreXPath 对象的捕获/回放编辑器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-15T15:49:33.407

我会推荐 TestAutomationFX 以及简单的 ui 测试自动化。TestAutomationFX 允许您使用 wpf 的 netAdvantage 工具，它不适用于白色和 QTP。TestAutomationFX 具有易于使用的界面，它与 Visual Studio 集成，并具有用于记录用户事件的良好记录器。

# visual-studio-2008 - VS2008 上的最近项目面板不适用于全新安装

> ID：58353
> 
> 赞同：1
> 
> 时间：2008-09-12T05:17:21.710
> 
> 标签：visual-studio-2008

VS2008 Professional 开始页面上的“最近项目”面板似乎无法正常工作，并且一直保持空白。

我在我们的 3 个开发人员 VS2008 安装中注意到了这一点，事实上，所有从 2005 年开始没有更新而是从头开始安装的安装。我通常将此视为一种好奇心，但现在我有一台新笔记本电脑和全新安装的 VS2008，这也发生在我身上，我已经将这种现象从古董升级为烦恼。

任何人都知道这是一个错误还是我在某处缺少设置。

谢谢

**编辑**谢谢，但工具 | 选项 | 环境 | 一般 | “最近使用列表中显示的项目”默认设置为 6

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T05:25:02.863

是工具| 选项 | 环境 | 一般 | “最近使用列表中显示的项目”设置为大于 0 的数字？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-22T02:21:48.047

终于搞定了！

最近的项目由开始菜单中的最近文档驱动（或至少共享一个“显示”标志）。

出于某种原因，我们的国有企业隐藏了这一点。

以下两项都需要设置为 0：

HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoRecentDocsHistory HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\NoRecentDocsMenu

# algorithm - 算法/数据结构设计面试题

> ID：58354
> 
> 赞同：53
> 
> 时间：2008-09-12T05:17:35.470
> 
> 标签：algorithm, data-structures

在候选人筛选过程中，您发现哪些简单的算法或数据结构相关的“白板”问题是有效的？

我有一些简单的方法可以用来验证解决问题的能力，可以简单地表达，但有一些机会应用一些启发式方法。

我用于初级开发人员的基础知识之一是：

> 编写一个 C# 方法，该方法接受一个包含一组单词（一个句子）的字符串，并将这些单词向右旋转 X 个位置。当句子最后位置的单词被旋转时，它应该出现在结果字符串的前面。

当候选人回答这个问题时，我希望看到他们可以使用 .NET 数据结构和方法（string.Join、string.Split、List 等）来解决问题。我还寻找他们来识别优化的特殊情况。就像单词需要旋转的次数并不是真正的 X，而是 X % 的单词数。

您在面试候选人时使用了哪些白板问题，以及您在答案中寻找哪些内容（不需要发布实际答案）。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-12T05:25:04.220

我喜欢经典的“LinkedList 和 ArrayList（或链表和数组/向量之间）有什么区别，为什么要选择其中一个？”

我希望得到的答案包括以下讨论：

*   插入性能
*   迭代性能
*   内存分配/重新分配影响
*   从开头/中间/结尾删除元素的影响
*   知道（或不知道）列表的最大大小如何影响决策

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-12T05:35:17.080

有一次我在大学面试微软的时候，那个人问我如何检测链表中的循环。

前一周在课堂上讨论了问题的最佳解决方案后，我开始告诉他。

他告诉我，“不，不，每个人都给我那个解决方案。给我一个不同的解决方案。”

我认为我的解决方案是最优的。他说：“我知道这是最优的。给我一个次优的。”

同时，这是一个很好的问题。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-12T12:26:11.697

最近面试的时候，经常被要求实现一个数据结构，一般是LinkedList或者HashMap。这两者都很容易在短时间内完成，但很难消除无能的人。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-24T12:05:30.700

这不一定涉及 OOP 功能，但在我们上一组采访中，我们使用了从[本月错误](http://www.gimpel.com/html/bugs.htm)列表中选择的错误代码。看着候选人发现错误显示了他们的分析能力，显示了如何解释别人的代码

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-12T05:22:26.130

1.  编写一个接受字符串的方法，如果该字符串是数字，则返回 true。（任何使用正则表达式作为面试最有效答案的方法）
2.  请编写一个不包含开关并返回基类型为“X”的类型的抽象工厂方法。（寻找模式，寻找反射，寻找它们不回避并使用 if else if）
3.  请用标记“|;|”分割字符串“every;thing|;|else|;|in|;|he;re”。（至少在.net中不允许使用多字符标记，所以寻找创造力，最好的解决方案是彻底破解）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-15T14:41:03.797

图很困难，因为如果需要的不仅仅是算法的草图，大多数非平凡的图问题往往需要大量的实际代码来实现。很多问题往往归结为候选人是否知道最短路径和图遍历算法，是否熟悉循环类型和检测，以及他们是否知道复杂性界限。我认为很多关于这些东西的问题都归结为琐事，而不是现场的创造性思维能力。

我认为与树相关的问题往往涵盖了图形问题的大部分困难，但没有那么多的代码复杂性。

我喜欢 Project Euler 问题，它要求找到一棵树下最昂贵的路径（16/67）；共同祖先是一个很好的热身，但很多人都看过。要求某人设计一个树类，执行遍历，然后找出他们可以从哪些遍历中重建一棵树，这也可以对数据结构和算法实现有所了解。Stern-Brocot 编程挑战也很有趣，并且可以在板上快速开发 ( [http://online-judge.uva.es/p/v100/10077.html](http://online-judge.uva.es/p/v100/10077.html) )。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-12T13:39:29.850

用这样的任何问题跟进：“您如何改进此代码，以便维护它的开发人员可以轻松地弄清楚它是如何工作的？”

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-24T11:46:19.997

实现一个函数，给定一个可能是循环的链表，交换前两个元素，第三个元素和第四个元素，等等......

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-12T06:21:33.680

我喜欢查看这个人实际编写的代码，并让他们向我解释。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-18T04:35:16.880

一个简单的方法是让他们从头开始编写对树的广度优先搜索。是的，如果你知道你在做什么，那是微不足道的。但是很多程序员不知道如何解决它。

我觉得更有用的一个如下。我已经用多种语言给出了这个，这是一个 Perl 版本。首先，我给他们以下代码示例：

```
# @a and @b are two arrays which are already populated.
my @int;
OUTER: for my $x (@a) {
  for my $y (@b) {
    if ($x eq $y) {
      push @int, $x;
      next OUTER;
    }
  }
} 
```

然后我问他们以下问题。我慢慢地问他们，给人们思考的时间，并愿意给他们轻推：

1.  这段代码完成后，@int 中的内容是什么？
2.  这段代码投入生产，有性能问题追溯到这段代码。解释潜在的性能问题。（如果他们在苦苦挣扎，我会问如果@a 和@b 各有 100,000 个元素，需要进行多少次比较。我*不是*在寻找具体的术语，只是粗略估计。）
3.  没有代码，建议加快速度。（如果他们提出了一个易于编码的方向，我会要求他们编码。如果他们想到一个解决方案会导致@int 以任何方式（例如，通常的顺序）被更改，我会推动查看他们是否意识到他们不应该在检查是否重要之前编写修复代码。）

如果他们提出了一个稍微（或非常）错误的解决方案，以下愚蠢的数据集将发现您遇到的大多数错误：

```
@a = qw(
  hello
  world
  hello
  goodbye
  earthlings
);
@b = qw(
  earthlings
  say
  hello
  earthlings
); 
```

我猜大约 2/3 的候选人没有通过这个问题。我还没有遇到过遇到问题的称职程序员。我发现具有良好常识和很少编程背景的人在这方面比具有几年经验的普通程序员做得更好。

我建议将这些问题用作过滤器。不要雇用某人，因为他们可以回答这些问题。但如果他们不能回答这些问题，那就不要雇用他们。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-18T04:40:32.373

要求他们为众所周知的迭代解决方案（即斐波那契等——如果需要，我们给他们一个迭代函数）编写一个**递归算法，然后让他们计算它的运行时间。**

很多时候，递归函数涉及树数据结构。这个人未能认出的次数让我感到困惑。在您看到它是一个树结构之前，计算运行时间变得有点困难......

我发现这个问题涉及很多领域。即，他们的代码阅读能力（如果给他们一个迭代函数），代码编写能力（因为他们编写了一个递归函数），算法，数据结构（用于运行时）......

# c# - 在安全处理异常时避免首次机会异常消息

> ID：58380
> 
> 赞同：77
> 
> 时间：2008-09-12T05:48:36.800
> 
> 标签：c#, .net, exception

以下代码捕获 EOS 异常

```
using (var reader = new BinaryReader(httpRequestBodyStream)) {

    try {
        while (true) {
            bodyByteList.Add(reader.ReadByte());
        }
    } catch (EndOfStreamException) { }
} 
```

那么为什么我仍然会在我的控制台中收到第一次机会异常呢？

> mscorlib.dll 中发生了“System.IO.EndOfStreamException”类型的第一次机会异常

有没有办法隐藏这些第一次机会异常消息？

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2008-09-13T18:48:25.280

为避免看到消息，请右键单击输出窗口并取消选中“异常消息”。

但是，如果您想知道何时抛出异常而不设置断点和重新配置调试器，那么看到它们发生可能会很好。

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-09-12T05:56:34.847

“第一次机会”异常的意义在于您正在看到它们的预处理程序，以便您可以在调试期间在抛出点时停止它们。“第二次机会”异常是没有适当处理程序的异常。有时您想捕获“第一次机会”异常，因为重要的是要查看抛出异常时发生的情况，即使有人正在捕获它。

没什么好担心的。这是正常行为。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-12T06:06:14.260

1.  在 Visual Studio 中，您可以更改调试器处理（中断）异常的方式的设置。

    转到调试 > 异常。（请注意，这可能不在您的菜单中，具体取决于您的 Visual Studio 环境设置。如果不是，请使用“自定义”菜单将其添加到您的菜单中。）

    在那里，您会看到一个异常对话框以及何时中断它们。

    在“Common Language Runtime Exceptions”行中，您可以取消选择 throwed （这应该不会再让您担心第一次机会异常），如果需要，您还可以取消选择 User-unhandeled（我不推荐）。

2.  您收到的消息不应出现在控制台中，而应出现在 Visual Studio 的“输出”窗口中。如果是后者，那么我还没有找到删除它的可能性，但是如果您在没有 Visual Studio 的情况下运行应用程序，它就不会出现。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-12T06:32:37.210

与 Java 不同，.NET 异常在处理能力方面相当昂贵，在正常和成功的执行路径中应避免处理异常。

您不仅可以避免控制台窗口中的混乱，而且您的性能也会得到提高，并且它会使像 .NET CLR Exceptions 这样的性能计数器更有意义。

在此示例中，您将使用

```
while (reader.PeekChar() != -1)
{
    bodyByteList.Add(reader.ReadByte());
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-10-26T11:32:55.293

我遇到了这个问题，无法弄清楚异常是在哪里引发的。所以我的解决方案是让 Visual Studio 停止执行这种异常。

1.  导航到“调试/异常”
2.  展开“公共语言运行时异常”树。
3.  展开“系统”分支。
4.  向下滚动到“NullReferenceException”所在的位置，选中“throw”复选框，取消选中“user-handled”。
5.  调试您的项目。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-04-18T18:16:17.170

如果您想更好地控制这些消息，可以添加一个处理程序：

```
Friend Sub AddTheHandler()
AddHandler AppDomain.CurrentDomain.FirstChanceException, AddressOf FirstChanceExceptionHandler
End Sub

<Conditional("DEBUG")>
Friend Sub FirstChanceExceptionHandler( source As Object,  e As Runtime.ExceptionServices.FirstChanceExceptionEventArgs)
' Process first chance exception

End Sub 
```

这使您可以像其他评论中提到的那样使它们静音，但仍确保您能够意识到它们。如果我将消息和时间戳记到文本文件中，我发现很高兴看到我真的扔了多少。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-05-09T21:49:50.337

实际上，如果每秒有很多异常，您可以通过检查 reader.EndOfStream-value 来获得更好的性能。打印出这些异常消息的速度非常慢，并且将它们隐藏在 Visual Studio 中不会加快任何速度。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-08-07T21:23:20.477

在 VB.NET 中：

```
<DebuggerHidden()> _
Public Function Write(ByVal Text As String) As Boolean
   ... 
```

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2008-09-12T05:50:17.637

我认为流正在引发此异常，因此您的尝试范围缩小以捕获它。

在不同的范围内添加更多的 try catch 组合，直到你在它实际被抛出的地方捕获它，但它似乎发生在你使用的外部，因为流对象不是在使用的范围内创建的。

# .net - 在数组中保存一个开放的泛型类型？

> ID：58384
> 
> 赞同：2
> 
> 时间：2008-09-12T05:52:05.043
> 
> 标签：.net, generics

我正面临 .NET 泛型的问题。我想做的是保存一组泛型类型（GraphicsItem）：

```
public class GraphicsItem<T>
{
    private T _item;

    public void Load(T item)
    {
        _item = item;
    }
} 
```

如何将这种开放的泛型类型保存在数组中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T07:50:38.567

实现一个非通用接口并使用它：

```
public class GraphicsItem<T> : IGraphicsItem
{
    private T _item;

    public void Load(T item)
    {
        _item = item;
    }

    public void SomethingWhichIsNotGeneric(int i)
    {
        // Code goes here...
    }
}

public interface IGraphicsItem
{
    void SomethingWhichIsNotGeneric(int i);
} 
```

然后将该接口用作列表中的项目：

```
var values = new List<IGraphicsItem>(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T06:18:20.207

如果要存储异构GrpahicsItem 即GraphicsItem< X> 和GrpahicsItem< Y> 需要从公共基类派生出来，或者实现公共接口。另一种选择是将它们存储在 List<object>

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T06:22:01.900

您是否尝试在非泛型方法中创建 GraphicsItem 数组？

您不能执行以下操作：

```
static void foo()
{
  var _bar = List<GraphicsItem<T>>();
} 
```

然后稍后填写列表。

更有可能你正在尝试做这样的事情？

```
static GraphicsItem<T>[] CreateArrays<T>()
{
    GraphicsItem<T>[] _foo = new GraphicsItem<T>[1];

    // This can't work, because you don't know if T == typeof(string)
    // _foo[0] = (GraphicsItem<T>)new GraphicsItem<string>();

    // You can only create an array of the scoped type parameter T
    _foo[0] = new GraphicsItem<T>();

    List<GraphicsItem<T>> _bar = new List<GraphicsItem<T>>();

    // Again same reason as above
    // _bar.Add(new GraphicsItem<string>());

    // This works
    _bar.Add(new GraphicsItem<T>());

    return _bar.ToArray();
} 
```

请记住，您将需要一个泛型类型引用来创建一个泛型类型的数组。这可以在方法级别（在方法后使用 T）或在类级别（在类后使用 T）。

如果您希望该方法返回 GraphicsItem 和 GraphicsItem 的数组，则让 GraphicsItem 从非泛型基类 GraphicsItem 继承并返回该数组。但是，您将失去所有类型的安全性。

希望有帮助。

# macos - Windows 上的 Mac 字体渲染

> ID：58399
> 
> 赞同：7
> 
> 时间：2008-09-12T06:16:33.317
> 
> 标签：macos, fonts, rendering

我喜欢 Mac OS*精美*呈现字体的方式（不仅仅是浏览器）。我想知道我们是否可以在 Windows 上运行的浏览器中以某种方式获得相同的渲染？

有人推荐了 sIFR，但我想这在我需要使用非标准字体时很有用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T13:40:36.953

查看**GDI++/FreeType**（[链接](http://free.flop.jp/gdi++/)、[链接](http://offset.skew.org/wiki/User:Mjb/GDI%2B%2B)）。它是 Windows 的高度可配置的字体渲染替代品。通过一些提示、抗锯齿等配置，您应该能够相当接近 OSX 风格的字体渲染。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-09-12T01:11:00.863

使用 mactype

[https://code.google.com/p/mactype/](https://code.google.com/p/mactype/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T06:17:44.327

不确定这是否是一个设置，但当然，Windows 上的 Safari 使用 OS X 渲染算法进行渲染。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-12T06:57:42.203

Brad 是对的：如果您想要 Mac 字体渲染算法，请使用 Safari。

如果您想了解更多详细信息，Jeff 和 Joel 之前都曾在博客上讨论过这个问题（毫不奇怪，大约在 Safari 为 Windows 发布的时候）：

[http://www.codinghorror.com/blog/archives/000885.html](http://www.codinghorror.com/blog/archives/000885.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T07:11:23.217

我假设您希望能够在全球范围内使用，或者至少在 IE/Firefox 中使用，而不仅仅是像其他人建议的那样安装 Safari。

早在 Mac OS X 仍处于开发阶段的时候，就有计划发布适用于 Windows 的 Cocoa 框架，以允许使用它编写的应用程序通过重新编译在 Windows 上本地运行。我怀疑一组 Cocoa windows 库（不是黄色框吗？）会给你 Mac OS X 风格的字体渲染，但我认为它从未发布过（尽管你可能可以获得非常旧的 beta 版本它来自某个地方，我感觉其中一些是 WebObjects 的一部分或类似的东西）。

我怀疑 Safari 的 Windows 版本正在使用 Windows 的 Cocoa 库的内部版本，这就是它具有 Mac OS X 字体渲染的原因（尽管我相信最近的夜间构建至少可以选择使用 Windows 的本机字体渲染）谁在抱怨它看起来不合适）。

无论如何，长篇大论，除非您要编写自己的字体渲染器，否则我认为没有任何简单的方法可以做到（除了使用 Safari）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-13T13:06:08.470

> 有人推荐了 sIFR，但我想这在我需要使用非标准字体时很有用？

sIFR 不会给您预期的效果。与 Windows 的 ClearType 一样，Flash 的抗锯齿（sIFR 使用）针对像素网格进行优化，而不是针对字体的准确表示。

您也许可以使用 Safari 捆绑的 CoreGraphics 库来进行字体渲染，但您可能会违反 Apple 的许可协议（尤其是当您尝试发布您的应用程序时……）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-04T00:24:05.710

我正在编写一个 Java 应用程序，用字体做一些有趣的事情，并与一些图形设计师一起工作，他们想要你所说的那种字体渲染。通过打开分数指标（即亚像素字形放置精度）和抗锯齿，我能够非常接近，这是 Mac 和 Windows 字体渲染之间的主要区别。对于较大的 TrueType 字体看起来相当不错。

这是我使用的 Java 代码。这一切都是用他们的原生字体渲染引擎完成的（我相信它可能是 FreeType，不确定）。

```
g.setFont(new Font("Century Schoolbook", Font.PLAIN, 36));
g.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS,
                   RenderingHints.VALUE_FRACTIONALMETRICS_ON);
g.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
                   RenderingHints.VALUE_TEXT_ANTIALIAS_ON); 
```

现在只要我能弄清楚如何使 OpenType CFF 字体工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-31T20:43:06.207

Microsoft Powertoy [Cleartype Tuner](http://www.microsoft.com/typography/ClearTypePowerToy.mspx)可让您调整 Cleartype 的工作方式。它可能会有所帮助。~~不确定它是否适用于比 Windows XP 更新的任何东西。~~

![Cleartype 调谐器](https://i.stack.imgur.com/vUQRr.png)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-05-05T14:24:42.810

您可以等到 IE9，它显然具有更好的文本渲染，使用 DirectX：http: [//blogs.msdn.com/ie/archive/2009/11/18/an-early-look-at-ie9-for-developers .aspx](http://blogs.msdn.com/ie/archive/2009/11/18/an-early-look-at-ie9-for-developers.aspx)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-05-07T16:54:55.597

如果你想在 firefox 中渲染 mac osx，你必须使用扩展 Anti-Aliasing Tuner：

[https://addons.mozilla.org/firefox/addon/anti-aliasing-tuner/](https://addons.mozilla.org/firefox/addon/anti-aliasing-tuner/)

只需将抗锯齿模式设置为默认模式，将渲染模式设置为小字体和大字体的大纲即可。

# .net - WPF 应用程序在启动时失败并出现 TypeInitializationException

> ID：58425
> 
> 赞同：23
> 
> 时间：2008-09-12T07:06:37.627
> 
> 标签：.net, wpf, prism

我有一个简单的 WPF 应用程序，我正在尝试启动它。我正在遵循 Microsoft 模式和实践“WPF 的复合应用程序指南”。我已按照他们的说明进行操作，但是我的 WPF 应用程序立即失败并出现“TypeInitializationException”。

InnerException 属性显示“'System.Windows.Navigation.BaseUriHelper' 的类型初始化程序引发了异常。”

这是我的 app.xaml：

```
<Application x:Class="MyNamespace.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Application.Resources>         
    </Application.Resources>
</Application> 
```

这是我的 app.xaml.cs（在“public App()”处抛出异常）：

```
public partial class App : Application
{
    public App()
    {
        Bootstrapper bootStrapper = new Bootstrapper();
        bootStrapper.Run();
    }
} 
```

我已将“App”类设置为项目中的启动对象。

什么会误入歧途？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-12T07:51:05.803

谢谢@ima，您的回答为我指明了正确的方向。我正在使用一个 app.config 文件，它包含以下内容：

```
<configuration>
  <startup>
    <supportedRuntime version="v2.0.50727" sku="Client"/>
  </startup>
  <configSections>
    <section name="modules" type="Microsoft.Practices.Composite.Modularity.ModulesConfigurationSection, Microsoft.Practices.Composite"/>
  </configSections>
  <modules>
    <module assemblyFile="Modules/MyNamespace.Modules.ModuleName.dll" moduleType="MyNamespace.Modules.ModuleName.ModuleClass" moduleName="Name"/>
  </modules>
</configuration> 
```

似乎问题出在 <startup> 元素上，因为当我删除它时，应用程序运行良好。我很困惑，因为 Visual Studio 2008 在我选中该框以利用 3.5 SP1 中可用的“客户端配置文件”时添加了这一点。

在检查和取消选中该框后，我最终得到了这样的配置文件：

```
<configuration>
  <configSections>
    <section name="modules" type="Microsoft.Practices.Composite.Modularity.ModulesConfigurationSection, Microsoft.Practices.Composite"/>
  </configSections>
  <modules>
    <module assemblyFile="Modules/MyNamespace.Modules.ModuleName.dll" moduleType="MyNamespace.Modules.ModuleName.ModuleClass" moduleName="Name"/>
  </modules>
  <startup>
    <supportedRuntime version="v2.0.50727" sku="Client"/>
  </startup>
</configuration> 
```

哪个有效！

我不确定为什么 app.config 中元素的顺序很重要——但似乎确实如此。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-01-24T02:25:32.043

**App.config**文件中的任何错误都可能导致错误，例如在行尾的拼写错误，例如`*`在行尾`...</startup>`有一个额外的“*” `...</startup>*`。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-12T07:25:52.463

你使用 .config 文件吗？如果是这样，请检查它是否有错误。此类初始化错误通常由无效的 XML 触发：如果 XAML 中没有错误，则首先要查看 XML 配置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-04-28T20:12:16.060

深入跟踪 InnerExceptions ，您可能会发现以下错误：

`"Only one <configSections> element allowed per config file and if present must be the first child of the root <configuration> element"`

此顺序更改发生在 Visual Studio EntityFramework Wizard 将 connectionStrings 元素添加到顶部之后

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-09-22T15:02:28.770

如果您只看到 TypeInitializationException 而没有任何原因或没有详细说明问题所在，请在 Visual Studio 选项中禁用“仅我的代码”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-09-08T22:36:31.313

对我来说，我已将应用程序设置从另一个应用程序复制到我的 app.config 到一个名为“userSettings”的新部分中。但是，还需要将“configSections”添加到定义“userSettings”的 app.config 中。我删除了 userSettings 部分，然后编辑了应用程序设置并保存了它。如果它们不存在，VS 会自动为您创建正确的“userSettings”和“configSections”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T10:48:51.700

您有两个名为“模块”的部分。将两个模块定义放在一个名为“模块”的部分中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-20T16:59:33.137

我遇到了类似的情况。在搜索了一周的时间后，我找到了解决方案，它确实对我有用。它解决了由于相同问题而出现的2-3个问题。

请按照以下步骤操作： 检查注册表中的 WPF 键（不存在）：HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\v3.0\Setup\Windows Presentation Foundation 我的问题是由于注册表中缺少上述键。

您可以在注册表中修改和使用以下详细信息：（实际上，您可以保存在文件中并在注册表中导入）

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP\v3.0\Setup\Windows Presentation Foundation] @="WPF v3.0.6920.1453" "Version"="3.0.6920.1453" "WPFReferenceAssembliesPathx86"="C:\ Program Files\Reference Assemblies\Microsoft\Framework\v3.0\" "WPFCommonAssembliesPathx86"="C:\Windows\System32\" "InstallRoot"="C:\Windows\Microsoft.NET\Framework\v3.0\WPF\ " "InstallSuccess"=dword:00000001 "ProductVersion"="3.0.6920.1453" "WPFNonReferenceAssembliesPathx86"="C:\Windows\Microsoft.NET\Framework\v3.0\WPF\"

我相信它会起作用。

祝一切顺利。

问候，

乌梅什

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-02-19T00:13:42.830

就我而言，这是需要添加的：

```
<configSections>
<!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 -->
<section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" /> 
```

App.config 部分（VS 2015 .NET 4.5.2）

打开之前构建的任何 WPF 项目，检查构建，如果确定 - 检查并比较两个项目中的 App.config

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-11T10:37:40.880

对我来说，我重命名了我的应用程序名称并导致了这个错误。我有一个服务器和客户端应用程序。服务器应用程序没有这个问题。所以我检查了服务器和客户端的 App.config 文件。我发现

```
<startup>
<supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6.1" />
</startup>

<configSections>
<section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
<!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 -->
</configSections> 
```

客户端和服务器中 <configSections> 标记上方的 <startup> 标记采用了另一种方式，因此我将粘贴的启动标记复制到 configSections 标记下并且它起作用了。像这样。

```
<configSections>
<section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
<!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 -->
</configSections>

<startup>
<supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6.1" />
</startup> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-04T17:37:56.200

我遇到了同样的错误。上面提到的建议对我不起作用。运行后我收到以下错误

```
System.TypeInitializationException
  HResult=0x80131534
  Message=The type initializer for 'System.Windows.Application' threw an exception.
  Source=PresentationFramework
  StackTrace:
   at System.Windows.Application..ctor()
   at ShortBarDetectionSystem.App..ctor()
   at ShortBarDetectionSystem.App.Main()

Inner Exception 1:
TypeInitializationException: The type initializer for 'System.Windows.Navigation.BaseUriHelper' threw an exception.

Inner Exception 2:
TypeInitializationException: The type initializer for 'MS.Internal.TraceDependencyProperty' threw an exception.

Inner Exception 3:
ConfigurationErrorsException: Configuration system failed to initialize

Inner Exception 4:
ConfigurationErrorsException: Section or group name 'oracle.manageddataaccess.client' is already defined. Updates to this may only occur at the configuration level where it is defined. (C:\ShortBarDetectionSystem\code\framework\TypeInitializationException\ver0_1\ShortBarDetectionSystem\ShortBarDetectionSystem\bin\x64\Debug\GrateBarDefectDetectionSystem.exe.Config line 4) 
```

我的 exe.config 文件第 4 行出现错误。.exe.config 文件是：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="oracle.manageddataaccess.client" type="OracleInternal.Common.ODPMSectionHandler, Oracle.ManagedDataAccess, Version=4.122.21.1, Culture=neutral, PublicKeyToken=89b483f429c47342" />
  </configSections>
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.7.2" />
  </startup>
  <system.data>
    <DbProviderFactories>
      <remove invariant="Oracle.ManagedDataAccess.Client" />
      <add name="ODP.NET, Managed Driver" invariant="Oracle.ManagedDataAccess.Client" description="Oracle Data Provider for .NET, Managed Driver" type="Oracle.ManagedDataAccess.Client.OracleClientFactory, Oracle.ManagedDataAccess, Version=4.122.21.1, Culture=neutral, PublicKeyToken=89b483f429c47342" />
    </DbProviderFactories>
  </system.data>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Runtime.CompilerServices.Unsafe" publicKeyToken="b03f5f7f11d50a3a" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Text.Json" publicKeyToken="cc7b13ffcd2ddd51" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration> 
```

但是经过反复试验，我发现删除 configSections

```
<configSections>
    <section name="oracle.manageddataaccess.client" type="OracleInternal.Common.ODPMSectionHandler, Oracle.ManagedDataAccess, Version=4.122.21.1, Culture=neutral, PublicKeyToken=89b483f429c47342" />
  </configSections> 
```

为我工作。

# sql - 基于 SQL 集的范围

> ID：58429
> 
> 赞同：3
> 
> 时间：2008-09-12T07:09:22.800
> 
> 标签：sql, sql-server

如何让 SQL 重复一些基于集合的操作任意次数而不循环？如何让 SQL 对一系列数字执行操作？我基本上是在寻找一种方法来进行基于集合的 for 循环。

我知道我可以创建一个包含整数的小表，比如从 1 到 1000，然后将其用于该范围内的范围操作。

例如，如果我有那个表，我可以进行选择以查找数字 100-200 的总和，如下所示：

```
select sum(n) from numbers where n between 100 and 200 
```

有任何想法吗？我有点在寻找适用于 T-SQL 的东西，但任何平台都可以。

[编辑] 我有自己的解决方案，使用 SQL CLR 非常适用于 MS SQL 2005 或 2008。[见下文。](https://stackoverflow.com/questions/58429/sql-set-based-range#59657)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T15:30:35.840

我认为对您的问题的简短回答是使用 WITH 子句来生成您自己的子句。

不幸的是，数据库中的大牌没有内置可查询的数字范围伪表。或者，更一般地说，简单的纯 SQL 数据生成功能。就个人而言，我认为这是一个**巨大**的失败，因为如果他们这样做了，就可以将当前锁定在过程脚本（T-SQL、PL/SQL 等）中的大量代码移动到纯 SQL 中，这对性能和代码复杂性有许多好处。

所以无论如何，从一般意义上来说，您需要的是动态生成数据的能力。

Oracle 和 T-SQL 都支持可用于执行此操作的 WITH 子句。它们在不同的 DBMS 中的工作方式略有不同，MS 称它们为“通用表表达式”，但它们在形式上非常相似。将这些与递归结合使用，您可以相当轻松地生成一系列数字或文本值。这是它可能的样子......

在 Oracle SQL 中：

```
WITH
  digits AS  -- Limit recursion by just using it for digits.
    (SELECT
      LEVEL - 1 AS num
    FROM
      DUAL
    WHERE
      LEVEL < 10
    CONNECT BY
      num = (PRIOR num) + 1),
  numrange AS
    (SELECT
      ones.num
        + (tens.num * 10)
        + (hundreds.num * 100)
        AS num
    FROM
      digits ones
      CROSS JOIN
        digits tens
      CROSS JOIN
        digits hundreds
    WHERE
      hundreds.num in (1, 2)) -- Use the WHERE clause to restrict each digit as needed.
SELECT
  -- Some columns and operations
FROM
  numrange
  -- Join to other data if needed 
```

诚然，这非常冗长。Oracle 的递归功能是有限的。语法很笨拙，性能不佳，并且仅限于 500 个（我认为）嵌套级别。这就是为什么我选择只对前 10 位数字使用递归，然后交叉（笛卡尔）连接将它们组合成实际数字。

我自己没有使用过 SQL Server 的公用表表达式，但由于它们允许自引用，因此递归比 Oracle 中的要简单得多。性能是否具有可比性，以及嵌套限制是什么，我不知道。

无论如何，递归和 WITH 子句在创建需要动态生成的数据集的查询时是非常有用的工具。然后通过查询这个数据集，对值进行操作，就可以得到各种不同类型的生成数据。聚合、复制、组合、排列等等。您甚至可以使用此类生成的数据来帮助汇总或深入研究其他数据。

**更新：**我只想补充一点，一旦您开始以这种方式处理数据，您就会对 SQL 的新思维方式敞开心扉。它不仅仅是一种脚本语言。它是一种相当健壮的数据驱动的[声明性语言](http://en.wikipedia.org/wiki/Declarative_programming_language)。有时使用起来很痛苦，因为多年来它一直缺乏增强功能来帮助减少复杂操作所需的冗余。但尽管如此，它非常强大，并且是一种将数据集作为算法的目标和驱动程序的相当直观的方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T18:12:04.830

我创建了一个非常适合此目的的 SQL CLR 表值函数。

```
SELECT n FROM dbo.Range(1, 11, 2) -- returns odd integers 1 to 11
SELECT n FROM dbo.RangeF(3.1, 3.5, 0.1) -- returns 3.1, 3.2, 3.3 and 3.4, but not 3.5 because of float inprecision. !fault(this) 
```

这是代码：

```
using System;
using System.Data.SqlTypes;
using Microsoft.SqlServer.Server;
using System.Collections;

[assembly: CLSCompliant(true)]
namespace Range {
    public static partial class UserDefinedFunctions {
        [Microsoft.SqlServer.Server.SqlFunction(DataAccess = DataAccessKind.None, IsDeterministic = true, SystemDataAccess = SystemDataAccessKind.None, IsPrecise = true, FillRowMethodName = "FillRow", TableDefinition = "n bigint")]
        public static IEnumerable Range(SqlInt64 start, SqlInt64 end, SqlInt64 incr) {
            return new Ranger(start.Value, end.Value, incr.Value);
        }

        [Microsoft.SqlServer.Server.SqlFunction(DataAccess = DataAccessKind.None, IsDeterministic = true, SystemDataAccess = SystemDataAccessKind.None, IsPrecise = true, FillRowMethodName = "FillRowF", TableDefinition = "n float")]
        public static IEnumerable RangeF(SqlDouble start, SqlDouble end, SqlDouble incr) {
            return new RangerF(start.Value, end.Value, incr.Value);
        }

        public static void FillRow(object row, out SqlInt64 n) {
            n =  new SqlInt64((long)row);
        }

        public static void FillRowF(object row, out SqlDouble n) {
            n = new SqlDouble((double)row);
        }
    }

    internal class Ranger : IEnumerable {
        Int64 _start, _end, _incr;

        public Ranger(Int64 start, Int64 end, Int64 incr) {
            _start = start; _end = end; _incr = incr;
        }

        public IEnumerator GetEnumerator() {
            return new RangerEnum(_start, _end, _incr);
        }
    }

    internal class RangerF : IEnumerable {
        double _start, _end, _incr;

        public RangerF(double start, double end, double incr) {
            _start = start; _end = end; _incr = incr;
        }

        public IEnumerator GetEnumerator() {
            return new RangerFEnum(_start, _end, _incr);
        }
    }

    internal class RangerEnum : IEnumerator {
        Int64 _cur, _start, _end, _incr;
        bool hasFetched = false;

        public RangerEnum(Int64 start, Int64 end, Int64 incr) {
            _start = _cur = start; _end = end; _incr = incr;
            if ((_start < _end ^ _incr > 0) || _incr == 0)
                throw new ArgumentException("Will never reach end!");
        }

        public long Current {
            get { hasFetched = true; return _cur; }
        }

        object IEnumerator.Current {
            get { hasFetched = true; return _cur; }
        }

        public bool MoveNext() {
            if (hasFetched) _cur += _incr;
            return (_cur > _end ^ _incr > 0);
        }

        public void Reset() {
            _cur = _start; hasFetched = false;
        }
    }

    internal class RangerFEnum : IEnumerator {
        double _cur, _start, _end, _incr;
        bool hasFetched = false;

        public RangerFEnum(double start, double end, double incr) {
            _start = _cur = start; _end = end; _incr = incr;
            if ((_start < _end ^ _incr > 0) || _incr == 0)
                throw new ArgumentException("Will never reach end!");
        }

        public double Current {
            get { hasFetched = true; return _cur; }
        }

        object IEnumerator.Current {
            get { hasFetched = true; return _cur; }
        }

        public bool MoveNext() {
            if (hasFetched) _cur += _incr;
            return (_cur > _end ^ _incr > 0);
        }

        public void Reset() {
            _cur = _start; hasFetched = false;
        }
    }
} 
```

我像这样部署它：

```
create assembly Range from 'Range.dll' with permission_set=safe -- mod path to point to actual dll location on disk.
go
create function dbo.Range(@start bigint, @end bigint, @incr bigint)
  returns table(n bigint)
  as external name [Range].[Range.UserDefinedFunctions].[Range]
go
create function dbo.RangeF(@start float, @end float, @incr float)
  returns table(n float)
  as external name [Range].[Range.UserDefinedFunctions].[RangeF]
go 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T14:56:22.083

这基本上是揭示 SQL 不太理想的事情之一。我在想也许正确的方法是构建一个创建范围的函数。（或发电机。）

我相信您问题的正确答案基本上是“您不能”。（对不起。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-26T13:45:24.840

You can use a common table expression to do this in SQL2005+.

```
WITH CTE AS
(
    SELECT 100 AS n
    UNION ALL
    SELECT n + 1 AS n FROM CTE WHERE n + 1 <= 200
)
SELECT n FROM CTE 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T08:36:01.967

如果使用 SQL Server 2000 或更高版本，您可以使用**table 数据类型**来避免创建普通表或临时表。然后使用正常的表操作就可以了。

使用此解决方案，您基本上可以在内存中拥有一个表结构，您几乎可以像使用真实表一样使用它，但性能要高得多。

我在这里找到了一个很好的讨论：[临时表与表数据类型](http://www.odetocode.com/articles/365.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T16:55:02.753

这是一个你永远不应该使用的黑客：

```
select sum(numberGenerator.rank)
from
(
select
    rank =  ( select count(*)  
              from reallyLargeTable t1 
              where t1.uniqueValue > t2.uniqueValue ), 
    t2.uniqueValue id1, 
    t2.uniqueValue id2
from reallyLargeTable t2 
) numberGenerator
where rank between 1 and 10 
```

您可以使用 SQL 2005 中的 Rank() 或 Row_Number 函数简化此操作

# arrays - 用于连接例如字符串数组的算法

> ID：58431
> 
> 赞同：14
> 
> 时间：2008-09-12T07:10:21.237
> 
> 标签：arrays, algorithm, string, language-agnostic

一段时间以来，我一直想知道，连接字符串数组的一个漂亮、干净的解决方案可能是什么样的。示例：我有 ["Alpha", "Beta", "Gamma"] 并且想将字符串合并为一个，用逗号分隔 - “Alpha, Beta, Gamma”。

现在我知道大多数编程语言为此提供了某种连接方法。我只是想知道如何实现这些。当我上入门课程时，我经常尝试单干，但始终没有找到令人满意的算法。一切看起来都相当混乱，问题是你不能只循环遍历数组，连接字符串，因为你会添加一个太多的逗号（在最后一个字符串之前或之后）。我不想检查循环中的条件。我真的不想在循环之前/之后添加第一个或最后一个字符串（我想这可能是最好的方法？）。

有人可以告诉我一个优雅的解决方案吗？或者告诉我为什么没有更优雅的东西？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-12T07:15:44.047

我为此类问题找到的最优雅的解决方案是这样的（在伪代码中）

```
separator = ""
foreach(item in stringCollection)
{
    concatenatedString += separator + item
    separator = ","
} 
```

您只需运行循环，并且仅在设置分隔符的第二次之后。所以第一次它不会被添加。它不像我希望的那样干净，所以我仍然会添加注释，但它比 if 语句或在循环外添加第一个或最后一个项目要好。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-12T07:33:35.127

所有这些解决方案都是不错的，但是对于底层库来说，分隔符的独立性和不错的速度都很重要。假设语言具有某种形式的字符串生成器，这是一个符合要求的函数。

```
public static string join(String[] strings, String sep) {
  if(strings.length == 0) return "";
  if(strings.length == 1) return strings[0];
  StringBuilder sb = new StringBuilder();
  sb.append(strings[0]);
  for(int i = 1; i < strings.length; i++) {
    sb.append(sep);
    sb.append(strings[i]);
  }
  return sb.toString();
} 
```

编辑：我想我应该提到为什么这会更快。主要原因是因为任何时候你调用 c = a + b; 底层构造通常是 c = (new StringBuilder()).append(a).append(b).toString();。通过重用相同的字符串构建器对象，我们可以减少我们产生的分配和垃圾的数量。

在有人插话优化是邪恶的之前，我们正在谈论实现一个通用的库函数。可接受的、可扩展的性能是它们的要求之一。需要很长时间的连接是不会经常使用的连接。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-12T08:39:50.773

现在大多数语言——例如 perl（Jon Ericson 提到）、php、javascript——都有一个 join() 函数或方法，这是迄今为止最优雅的解决方案。更少的代码是更好的代码。

作为对 Mendelt Siebenga 的回应，如果您确实需要手动解决方案，我会选择三元运算符，例如：

```
separator = ","
foreach (item in stringCollection)
{
    concatenatedString += concatenatedString ? separator + item : item
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-12T07:18:48.987

我通常会选择类似...

```
list = ["Alpha", "Beta", "Gamma"];
output = "";
separator = "";
for (int i = 0; i < list.length ; i++) {
  output = output + separator;
  output = output + list[i];
  separator = ", ";
} 
```

这是有效的，因为在第一遍中，分隔符为空（因此您在开始时不会得到逗号，但在随后的每一遍中，您在添加下一个元素之前添加一个逗号。

您当然可以将其展开一点以使其更快一些（一遍又一遍地分配给分隔符并不理想），尽管我怀疑这是编译器可以自动为您做的事情。

最后，我怀疑这就是大多数语言级别的连接函数归结为的原因。只不过是语法糖，但它确实很甜。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-12T07:21:29.917

对于纯粹的优雅，典型的递归函数式语言解决方案非常好。这不是实际的语言语法，但你明白了（它也被硬编码为使用逗号分隔符）：

加入（[]）=“”

加入（[x]）=“x”

加入（[x，休息]）=“x”，+加入（休息）

实际上，您会以更通用的方式编写它，以重用相同的算法，但抽象出数据类型（不必是字符串）和操作（不必在中间用逗号连接） . 然后它通常被称为“reduce”，许多函数式语言都内置了它，例如在 Lisp 中将列表中的所有数字相乘：

(减少#'*'(1 2 3 4 5)) => 120

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-14T13:14:51.750

@Mendelt Siebenga

字符串是编程语言中的基石对象。不同的语言以不同的方式实现字符串。的实现`join()`强烈依赖于字符串的底层实现。伪代码不反映底层实现。

`join()`在 Python 中考虑。它可以很容易地使用：

```
print ", ".join(["Alpha", "Beta", "Gamma"])
# Alpha, Beta, Gamma 
```

它可以很容易地实现如下：

```
def join(seq, sep=" "):
    if not seq:         return ""
    elif len(seq) == 1: return seq[0]
    return reduce(lambda x, y: x + sep + y, seq)

print join(["Alpha", "Beta", "Gamma"], ", ")
# Alpha, Beta, Gamma 
```

以及如何`join()`在 C 中实现方法（取自[trunk](http://svn.python.org/view/python/trunk/Objects/stringobject.c?rev=66119&view=markup)）：

```
PyDoc_STRVAR(join__doc__,
"S.join(sequence) -> string\n\
\n\
Return a string which is the concatenation of the strings in the\n\
sequence.  The separator between elements is S.");

static PyObject *
string_join(PyStringObject *self, PyObject *orig)
{
    char *sep = PyString_AS_STRING(self);
    const Py_ssize_t seplen = PyString_GET_SIZE(self);
    PyObject *res = NULL;
    char *p;
    Py_ssize_t seqlen = 0;
    size_t sz = 0;
    Py_ssize_t i;
    PyObject *seq, *item;

    seq = PySequence_Fast(orig, "");
    if (seq == NULL) {
        return NULL;
    }

    seqlen = PySequence_Size(seq);
    if (seqlen == 0) {
        Py_DECREF(seq);
        return PyString_FromString("");
    }
    if (seqlen == 1) {
        item = PySequence_Fast_GET_ITEM(seq, 0);
        if (PyString_CheckExact(item) || PyUnicode_CheckExact(item)) {
            Py_INCREF(item);
            Py_DECREF(seq);
            return item;
        }
    }

    /* There are at least two things to join, or else we have a subclass
     * of the builtin types in the sequence.
     * Do a pre-pass to figure out the total amount of space we'll
     * need (sz), see whether any argument is absurd, and defer to
     * the Unicode join if appropriate.
     */
    for (i = 0; i < seqlen; i++) {
        const size_t old_sz = sz;
        item = PySequence_Fast_GET_ITEM(seq, i);
        if (!PyString_Check(item)){
#ifdef Py_USING_UNICODE
            if (PyUnicode_Check(item)) {
                /* Defer to Unicode join.
                 * CAUTION:  There's no gurantee that the
                 * original sequence can be iterated over
                 * again, so we must pass seq here.
                 */
                PyObject *result;
                result = PyUnicode_Join((PyObject *)self, seq);
                Py_DECREF(seq);
                return result;
            }
#endif
            PyErr_Format(PyExc_TypeError,
                     "sequence item %zd: expected string,"
                     " %.80s found",
                     i, Py_TYPE(item)->tp_name);
            Py_DECREF(seq);
            return NULL;
        }
        sz += PyString_GET_SIZE(item);
        if (i != 0)
            sz += seplen;
        if (sz < old_sz || sz > PY_SSIZE_T_MAX) {
            PyErr_SetString(PyExc_OverflowError,
                "join() result is too long for a Python string");
            Py_DECREF(seq);
            return NULL;
        }
    }

    /* Allocate result space. */
    res = PyString_FromStringAndSize((char*)NULL, sz);
    if (res == NULL) {
        Py_DECREF(seq);
        return NULL;
    }

    /* Catenate everything. */
    p = PyString_AS_STRING(res);
    for (i = 0; i < seqlen; ++i) {
        size_t n;
        item = PySequence_Fast_GET_ITEM(seq, i);
        n = PyString_GET_SIZE(item);
        Py_MEMCPY(p, PyString_AS_STRING(item), n);
        p += n;
        if (i < seqlen - 1) {
            Py_MEMCPY(p, sep, seplen);
            p += seplen;
        }
    }

    Py_DECREF(seq);
    return res;
} 
```

* * *

请注意，上面的`Catenate everything.`代码只是整个函数的一小部分。

在伪代码中：

```
/* Catenate everything. */
for each item in sequence
    copy-assign item
    if not last item
        copy-assign separator 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-12T07:38:29.547

' 伪代码假设从零开始

```
结果字符串 = 输入数组 [0]
n = 1
而 n （小于） Number_Of_Strings
    结果字符串（连接）“，”
    ResultString（连接） InputArray[n]
    n = n + 1
环形

```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-12T08:21:42.673

在 Perl 中，我只使用**join**命令：

```
$ echo "Alpha
Beta
Gamma" | perl -e 'print(join(", ", map {chomp; $_} <> ))'
Alpha, Beta, Gamma 
```

（**地图**的东西主要是为了创建一个列表。）

在没有内置的语言（如 C）中，我使用简单的迭代（未经测试）：

```
for (i = 0; i < N-1; i++){
    strcat(s, a[i]);
    strcat(s, ", ");
}
strcat(s, a[N]); 
```

当然，在向其添加更多字节之前 ，您需要检查*s的大小。*

您必须对[第一个条目](https://stackoverflow.com/questions/58431/algorithm-for-joining-eg-an-array-of-strings#58454)或最后一个条目进行特殊处理。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-12T22:25:35.190

收集不同的语言实现？
这是一个 Smalltalk 版本，供您娱乐：

```
join:collectionOfStrings separatedBy:sep

  |buffer|

  buffer := WriteStream on:''.
  collectionOfStrings 
      do:[:each | buffer nextPutAll:each ]
      separatedBy:[ buffer nextPutAll:sep ].
  ^ buffer contents. 
```

当然，上面的代码已经在标准库中找到了：

集合 >> asStringWith:

所以，使用它，你会写：

```
#('A' 'B' 'C') asStringWith:',' 
```

**但这是我的主要观点**：

我想更加强调一个事实，即强烈推荐使用 StringBuilder（或 Smalltalk 中所谓的“WriteStream”）。不要在循环中使用“+”连接字符串 - 结果将是许多中间丢弃的字符串。如果你有一个好的垃圾收集器，那很好。但有些不是，需要回收大量内存。StringBuilder（和WriteStream，它的祖父）使用缓冲区加倍甚至自适应增长算法，它需要*更少*的临时内存。

但是，如果您要连接的只是几个小字符串，则不在乎，然后“+”它们；使用 StringBuilder 的额外工作实际上可能适得其反，直到实现和语言相关的字符串数量。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-15T16:10:26.657

## Perl 6

```
sub join( $separator, @strings ){
  my $return = shift @strings;
  for @strings -> ( $string ){
    $return ~= $separator ~ $string;
  }
  return $return;
} 
```

*是的，我知道这是没有意义的，因为 Perl 6 已经有一个连接函数。*

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-14T19:21:54.923

`join()`Ruby 中的函数：

```
def join(seq, sep) 
  seq.inject { |total, item| total << sep << item } or "" 
end

join(["a", "b", "c"], ", ")
# => "a, b, c" 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-14T20:37:40.063

`join()`在 Perl 中：

```
use List::Util qw(reduce);

sub mjoin($@) {$sep = shift; reduce {$a.$sep.$b} @_ or ''}

say mjoin(', ', qw(Alpha Beta Gamma));
# Alpha, Beta, Gamma 
```

或没有`reduce`：

```
 sub mjoin($@) 
 {
   my ($sep, $sum) = (shift, shift); 
   $sum .= $sep.$_ for (@_); 
   $sum or ''
 } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T20:36:36.210

**在 Java 5 中，使用单元测试：**

```
import junit.framework.Assert;
import org.junit.Test;

public class StringUtil
{
    public static String join(String delim, String... strings)
    {
        StringBuilder builder = new StringBuilder();

        if (strings != null)
        {
            for (String str : strings)
            {
                if (builder.length() > 0)
                {
                    builder.append(delim);
                }

                builder.append(str);
            }
        }           

        return builder.toString();
    }

    @Test
    public void joinTest()
    {
        Assert.assertEquals("", StringUtil.join(", ", null));
        Assert.assertEquals("", StringUtil.join(", ", ""));
        Assert.assertEquals("", StringUtil.join(", ", new String[0]));
        Assert.assertEquals("test", StringUtil.join(", ", "test"));
        Assert.assertEquals("foo, bar", StringUtil.join(", ", "foo", "bar"));
        Assert.assertEquals("foo, bar, baz", StringUtil.join(", ", "foo", "bar", "baz"));
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-12T07:40:44.177

以下不再与语言无关（但这对于讨论无关紧要，因为实现很容易移植到其他语言）。我尝试用命令式编程语言实现 Luke 的（理论上最好的）解决方案。任君挑选；我的 C#。一点也不优雅。但是，（没有任何测试）我可以想象它的性能相当不错，因为递归实际上是尾递归。

我的挑战：给出更好的递归实现（用命令式语言）。你说“更好”是什么意思：更少的代码，更快，我愿意接受建议。

```
private static StringBuilder RecJoin(IEnumerator<string> xs, string sep, StringBuilder result) {
    result.Append(xs.Current);
    if (xs.MoveNext()) {
        result.Append(sep);
        return RecJoin(xs, sep, result);
    } else
        return result;
}

public static string Join(this IEnumerable<string> xs, string separator) {
    var i = xs.GetEnumerator();
    if (!i.MoveNext())
        return string.Empty;
    else
        return RecJoin(i, separator, new StringBuilder()).ToString();
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-05T17:39:59.060

在 C# 中使用 String.join 方法

[http://msdn.microsoft.com/en-us/library/57a79xd0.aspx](http://msdn.microsoft.com/en-us/library/57a79xd0.aspx)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-17T06:14:03.873

我在 lisp 中编写了解决方案的递归版本。如果列表的长度大于 2，它将尽可能将列表分成两半，然后尝试合并子列表

```
 (defun concatenate-string(list)
       (cond ((= (length list) 1) (car list))
             ((= (length list) 2) (concatenate 'string (first list) "," (second list)))
             (t (let ((mid-point (floor (/ (- (length list) 1) 2))))
                   (concatenate 'string 
                                (concatenate-string (subseq list 0 mid-point))
                                ","
                                (concatenate-string (subseq list mid-point (length list))))))))

    (concatenate-string '("a" "b")) 
```

我尝试将分而治之的策略应用于该问题，但我想这并没有比普通迭代产生更好的结果。请让我知道这是否可以做得更好。

我还对算法获得的递归进行了分析，可[在此处](http://www4.ncsu.edu/~rfcornel/analysis.pdf)获得。

# sql-server - T-SQL 中的随机加权选择

> ID：58457
> 
> 赞同：26
> 
> 时间：2008-09-12T07:44:16.740
> 
> 标签：sql-server, tsql, random

如何根据所有候选行的应用权重随机选择 T-SQL 中的表行？

例如，我在一个表中有一组行，权重分别为 50、25 和 25（加起来为 100 但不需要），我想随机选择其中一个，其统计结果相当于相应的重量。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-18T01:26:24.850

Dane 的回答包括以引入平方律的方式进行自连接。`(n*n/2)`连接后的行，表中有 n 行。

更理想的是能够只解析表一次。

```
DECLARE @id int, @weight_sum int, @weight_point int
DECLARE @table TABLE (id int, weight int)

INSERT INTO @table(id, weight) VALUES(1, 50)
INSERT INTO @table(id, weight) VALUES(2, 25)
INSERT INTO @table(id, weight) VALUES(3, 25)

SELECT @weight_sum = SUM(weight)
FROM @table

SELECT @weight_point = FLOOR(((@weight_sum - 1) * RAND() + 1))

SELECT
    @id = CASE WHEN @weight_point < 0 THEN @id ELSE [table].id END,
    @weight_point = @weight_point - [table].weight
FROM
    @table [table]
ORDER BY
    [table].Weight DESC 
```

这将通过表格，设置`@id`为每条记录的`id`值，同时递减`@weight`点。最终，`@weight_point`意志变负。这意味着`SUM`所有前面的权重都大于随机选择的目标值。这是我们想要的记录，所以从那时起我们设置`@id`为它自己（忽略表中的任何 ID）。

这只遍历表一次，但即使选择的值是第一条记录，也必须遍历整个表。因为平均位置是表格的一半（如果按权重排序则更少）编写循环可能会更快......（特别是如果权重在公共组中）：

```
DECLARE @id int, @weight_sum int, @weight_point int, @next_weight int, @row_count int
DECLARE @table TABLE (id int, weight int)

INSERT INTO @table(id, weight) VALUES(1, 50)
INSERT INTO @table(id, weight) VALUES(2, 25)
INSERT INTO @table(id, weight) VALUES(3, 25)

SELECT @weight_sum = SUM(weight)
FROM @table

SELECT @weight_point = ROUND(((@weight_sum - 1) * RAND() + 1), 0)

SELECT @next_weight = MAX(weight) FROM @table
SELECT @row_count   = COUNT(*)    FROM @table WHERE weight = @next_weight
SET @weight_point = @weight_point - (@next_weight * @row_count)

WHILE (@weight_point > 0)
BEGIN
    SELECT @next_weight = MAX(weight) FROM @table WHERE weight < @next_weight
    SELECT @row_count   = COUNT(*)    FROM @table WHERE weight = @next_weight
    SET @weight_point = @weight_point - (@next_weight * @row_count)
END

-- # Once the @weight_point is less than 0, we know that the randomly chosen record
-- # is in the group of records WHERE [table].weight = @next_weight

SELECT @row_count = FLOOR(((@row_count - 1) * RAND() + 1))

SELECT
    @id = CASE WHEN @row_count < 0 THEN @id ELSE [table].id END,
    @row_count = @row_count - 1
FROM
    @table [table]
WHERE
    [table].weight = @next_weight
ORDER BY
    [table].Weight DESC 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-12T07:45:06.160

您只需将所有候选行的权重相加，然后在该总和中选择一个随机点，然后选择与该所选点协调的记录（每条记录都递增地携带一个累积的权重总和）。

```
DECLARE @id int, @weight_sum int, @weight_point int
DECLARE @table TABLE (id int, weight int)

INSERT INTO @table(id, weight) VALUES(1, 50)
INSERT INTO @table(id, weight) VALUES(2, 25)
INSERT INTO @table(id, weight) VALUES(3, 25)

SELECT @weight_sum = SUM(weight)
FROM @table

SELECT @weight_point = ROUND(((@weight_sum - 1) * RAND() + 1), 0)

SELECT TOP 1 @id = t1.id
FROM @table t1, @table t2
WHERE t1.id >= t2.id
GROUP BY t1.id
HAVING SUM(t2.weight) >= @weight_point
ORDER BY t1.id

SELECT @id 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-12T13:41:07.040

如果您有很多记录，那么“递增地携带一个累积 [原文如此] 重量总和”部分会很昂贵*。*如果您也已经有广泛的分数/权重（即：范围足够宽，大多数记录权重都是唯一的。1-5 星可能不会削减它），您可以执行类似的操作来选择权重值. 我在这里使用 VB.Net 进行演示，但这也可以在纯 Sql 中轻松完成：

```
Function PickScore()
    'Assume we have a database wrapper class instance called SQL and seeded a PRNG already
    'Get count of scores in database
    Dim ScoreCount As Double = SQL.ExecuteScalar("SELECT COUNT(score) FROM [MyTable]")
    ' You could also approximate this with just the number of records in the table, which might be faster.

    'Random number between 0 and 1 with ScoreCount possible values
    Dim rand As Double = Random.GetNext(ScoreCount) / ScoreCount

    'Use the equation y = 1 - x^3 to skew results in favor of higher scores
    ' For x between 0 and 1, y is also between 0 and 1 with a strong bias towards 1
    rand = 1 - (rand * rand * rand)

    'Now we need to map the (0,1] vector to [1,Maxscore].
    'Just find MaxScore and mutliply by rand
    Dim MaxScore As UInteger = SQL.ExecuteScalar("SELECT MAX(Score) FROM Songs")
    Return MaxScore * rand
End Function 
```

运行这个，并选择最大分数小于返回权重的记录。如果不止一条记录共享该分数，请随机选择它。这里的优点是您不必保留任何总和，并且您可以调整用于适合您的口味的概率方程。但同样，它在更大的分数分布情况下效果最好。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-18T14:57:55.477

使用随机数生成器执行此操作的方法是集成概率密度函数。使用一组离散值，您可以计算前缀总和（直到这个值的所有值的总和）并存储它。使用此选项，您可以选择大于随机数的最小前缀总和（累计到日期）值。

在数据库上，必须更新插入后的后续值。如果更新的相对频率和数据集的大小不会使执行此操作的成本过高，则意味着可以从单个 s-argable（可以通过索引查找解决的谓词）查询中获得适当的值.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-06-28T19:38:57.770

如果您需要获取一组样本（例如，您想从 5M 行的集合中抽取 50 行），其中每行都有一个名为`Weight`which的列，`int`并且较大的值意味着更多的权重，您可以使用此函数：

```
SELECT * 
FROM 
(
    SELECT TOP 50 RowData, Weight 
    FROM MyTable 
    ORDER BY POWER(RAND(CAST(NEWID() AS VARBINARY)), (1.0/Weight)) DESC
) X 
ORDER BY Weight DESC 
```

[这里的关键是使用 POWER( ) 函数，如此处](https://stackoverflow.com/a/18282419/1555435)所示

关于选择随机函数的参考在[这里](https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms189108(v=sql.105))和[这里](https://technet.microsoft.com/en-us/library/aa175776(v=sql.80).aspx)

或者，您可以使用：

```
1.0 * ABS(CAST(CHECKSUM(NEWID()) AS bigint)) / CAST(0x7FFFFFFF AS INT) 
```

由于[这个](https://stackoverflow.com/questions/1045138/how-do-i-generate-random-number-for-each-row-in-a-tsql-select)问题`BIGINT`，您将校验和转换为：`INT`

> 因为校验和返回一个 int，并且 int 的范围是 -2^31 (-2,147,483,648) 到 2^31-1 (2,147,483,647)，所以如果结果恰好是 -2,147,483,648，abs() 函数会返回溢出错误！机会显然非常低，大约 40 亿分之一，但是我们每天在 ~1.8b 行表上运行它，所以它大约每周发生一次！修复是在 abs 之前将校验和转换为 bigint。

# operating-system - Web 程序员、客户端或服务器首选的操作系统是什么？

> ID：58463
> 
> 赞同：2
> 
> 时间：2008-09-12T07:50:56.443
> 
> 标签：operating-system

您更喜欢在哪个操作系统上编程？客户端或服务器

虽然有一个学派认为，如果您（主要是）进行 Web 编程（或其他基于服务器的代码），您应该为您的开发机器使用服务器操作系统，因为它更接近您的应用程序将运行的环境。

更新：我应该补充一下，这确实是针对 Windows 人群的

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T08:01:36.183

好的，我知道您主要是在谈论 Windows，但是...

我曾经在 windows 上开发以部署在 *nix 服务器上。当然，这种工作方式有*很多*陷阱，但你只是习惯了它。

2005 年 10 月，我切换到 Linux，最初是作为一个实验，但我再也没有回去。有一个陡峭的学习曲线。我认为在处理 *nix 10 年后我已经非常了解它，但与我在台式机上使用它所学到的数量相比，我一无所知。

工作流的开发和部署到类似平台变得更加顺畅。

最近，我们甚至开始挑选运行 Ubuntu 服务器的服务器，以便它们最接近我们的 Ubuntu 桌面开发机器。

如果您在谈论桌面版和服务器版之间的区别，我想您不必担心。如果您在一个操作系统上开发以在另一个操作系统上进行部署，我会考虑更改您的桌面平台。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T07:58:28.297

> 有一个学派认为，如果您（主要是）进行 Web 编程（或其他基于服务器的代码），您应该为您的开发机器使用服务器操作系统

我认为这更适用于*“系统程序员”*而不是网络*“应用程序程序员”*。为什么？深入了解这个平台绝对有很大的价值，就像一个人会日复一日地与操作系统一起生活等等。但不是每个人都可以或应该需要去那里。

虽然我的主要生产环境是 RHEL4，但 Linux 在桌面上不适合我——事实上，它让我发疯。不过，我发现在 OSX 上工作已经足够接近了。而且我只是*喜欢*在我的 Mac 上工作，而不是在 XP 盒子上工作。

我正在做 Java 的事情，*“一次编写，到处运行”*的宣传实际上对我有用。:)

> 更新：我应该补充一下，这确实是针对 Windows 人群的

迟到了一分钟，有点短;）也许你也应该编辑标题......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T10:24:19.757

似乎问题更多是关于是否使用*同一操作系统*的服务器或客户端版本。所以我的回答是：客户应该没问题。您可以在 Windows、OS X 和 Linux 的客户端版本上开发和测试多种风格的 Web 应用程序。OS X 和 Linux 显然通过预装 Apache 使基于 Apache 的应用程序更容易一些，但是下载 XAMPP 或 WAMPP 也可以迅速将 Windows 机器变成一个可靠的 LAMP 应用程序开发平台。

如果您正在使用 ASP.NET，您的开发工具（如果您使用 Visual Studio 系列中的某些东西）具有内置的测试服务器机制。

因此，除非您有其他需要服务器版本的需要，否则我会坚持使用客户端。钱少了，而且你真的不需要服务器版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T08:02:00.503

客户端与服务器操作系统问题仅在 MS 平台上相关。即使在那里，这也取决于您正在开发什么。

据我了解，对于 Sharepoint 开发，您需要一个服务器操作系统来运行您的代码如果您只是在做普通的 ASP.Net 东西，那么这主要是个人喜好。

*编辑* 正如 Tyler 评论的那样，您可以在 Vista 上运行 MOSS/WSS，但不支持它。或者，您可以在客户端操作系统上开发并在 VM 中的服务器操作系统上运行 sharepoint。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T07:54:14.673

无论您实际谈论的是哪种操作系统，都无关紧要。您可能编写的大多数应用程序都不需要担心差异（如果确实存在的话）。只有在极少数情况下，您可能会使用某些特定功能，这些功能可能仅在您的操作系统的“服务器”版本上可用。

还有其他考虑因素，例如默认情况下调整 Windows 服务器版本以减少对桌面程序的优先级和关注，而更多地关注文件缓存等内容。就个人而言，我总是会选择我选择的操作系统的“客户端”版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T07:56:42.763

我个人使用 Windows Vista，但那是因为它是我喜欢的并且我可以很好地使用它。但老实说，这并不重要，你的操作系统应该是你喜欢的东西，并且拥有你需要的工具来提高工作效率。

我想说您的测试环境是您需要尽可能接近生产环境的环境。我在 Vista 上使用 RoR 编写，但在与我的 Web 服务器相同的 Linux VM 设置中对其进行测试，并且在工作中我们有一个安装了 IIS6 的 Win2k3 服务器来测试我们的 .Net 站点，但我使用 IIS7 在 Vista 上进行开发。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T08:01:29.210

我使用 Windows Server 2003 设置为工作站。[这是](http://win2k3.msfn.org/)我用了几年的指南。真喜欢它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T08:43:51.760

这将是一个有点奇怪的答案，但作为工作站（我知道），我是 Windows 2008 和 Hyper-V 的忠实粉丝。基本上我只会在我的工作站上安装类似 Office 的软件，所有的开发都将在虚拟机中进行。

假设没有可用的 Win2k8/Hyper-V，我很乐意接受一些旧的 WinXP（但带有虚拟 PC）。

Hyper-V 允许您从运行的任何 .VHD VM 中获得出色的性能。Virtual PC 和 Virtual Server 都是免费的（就像在啤酒中一样），您可以设置大量基础架构，允许您重新利用虚拟机（即基础机器、差异磁盘、撤消磁盘）。.VHD 也是可互换的，因此您可以重新托管以前喜欢的 .VHD 供其他开发人员在某些虚拟服务器上享受，或者他们可以复制它，重命名虚拟机并享受您准备好的环境一些虚拟PC！

这对于在不到 10 分钟的时间内让团队成员加快速度（环境方面）非常棒。您还可以使用它来非常快速地配置机器，否则这些机器需要数天时间来设置/配置。

别介意从不同操作系统进行测试的更好能力，或者能够使用撤消磁盘回滚更改，虚拟机是救生员！**开始虚拟化人！**

对于虚拟机/差异磁盘的一些巨大好处，请考虑[Andrew Connell 的这篇文章](http://www.andrewconnell.com/blog/articles/UseVirtualPCsDifferencingDisksToYourAdvantage.aspx)。

# ruby - 如何从 Ruby 程序发送邮件？

> ID：58478
> 
> 赞同：9
> 
> 时间：2008-09-12T08:02:55.730
> 
> 标签：ruby, email

我想从 Ruby 应用程序发送电子邮件。是否有核心语言调用来执行此操作，或者是否有我应该使用的库？最好的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T08:28:51.500

如果您不想使用[ActionMailer](http://wiki.rubyonrails.org/rails/pages/ActionMailer)，您可以使用[Net::SMTP](http://www.ruby-doc.org/stdlib/libdoc/net/smtp/rdoc/index.html)（用于实际发送）和[tmail](https://github.com/mikel/tmail)一起轻松创建电子邮件（包含多个部分等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T15:26:10.203

```
require 'net/smtp'
SMTP_SERVER = 'mailserver01' #change to your server

def send_emails(sender_address, recipients, subject, message_body)
    recipients.each do |recipient_address|
        message_header =''
        message_header << "From: <#{sender_address}>\r\n"
        message_header << "To: <#{recipient_address}>\r\n"
        message_header << "Subject: #{subject}\r\n"
        message_header << "Date: " + Time.now.to_s + "\r\n"
        message = message_header + "\r\n" + message_body + "\r\n"
        Net::SMTP.start(SMTP_SERVER, 25) do |smtp|
            smtp.send_message message, sender_address, recipient_address
        end
    end
end
send_emails('sender@domain.com',['recip1@test.com', 'recip2@other.com'],'test Email',"Hi there this is a test email hope you like it") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T08:08:17.323

我使用 [Net::SMTP](http://www.ruby-doc.org/stdlib/libdoc/net/smtp/rdoc/index.html)库

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T15:57:58.307

[RubyMail](http://www.rfc20.org/rubymail/ "红宝石邮件")是一个用于 Ruby 的电子邮件处理库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T15:43:34.170

我知道这是一个迟到的答案，但这刚刚发布：

[http://adam.blog.heroku.com/past/2008/11/2/pony_the_express_way_to_send_email_from_ruby/](http://adam.blog.heroku.com/past/2008/11/2/pony_the_express_way_to_send_email_from_ruby/)

可能有用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-12T08:18:54.987

您还可以考虑查看作为 Rails 的一部分提供但不依赖于 Rails的[ActionMailer组件。](http://wiki.rubyonrails.org/rails/pages/ActionMailer)

# ruby - 在 Ruby 中按名称以编程方式访问变量

> ID：58482
> 
> 赞同：24
> 
> 时间：2008-09-12T08:08:40.927
> 
> 标签：ruby, variables

我不完全确定这在 Ruby 中是否可行，但希望有一种简单的方法可以做到这一点。我想声明一个变量，然后找出变量的名称。也就是说，对于这个简单的片段：

```
foo = ["goo", "baz"] 
```

如何取回数组的名称（此处为“foo”）？如果确实有可能，这是否适用于任何变量（例如，标量、散列等）？

编辑：这就是我基本上想要做的。我正在编写一个包含三个重要变量的类的 SOAP 服务器，验证代码本质上是这样的：

```
 [foo, goo, bar].each { |param|
      if param.class != Array
        puts "param_name wasn't an Array. It was a/an #{param.class}"
        return "Error: param_name wasn't an Array"
      end
      } 
```

那么我的问题是：我可以用 foo、goo 或 bar 替换 'param_name' 的实例吗？这些对象都是数组，所以到目前为止我收到的答案似乎不起作用（除了重新设计整个事情 ala [dbr's answer](https://stackoverflow.com/questions/58482/ruby-get-a-variables-name#58870)）

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-15T14:41:51.843

如果你把你的问题转过来怎么办？与其尝试从变量中获取名称，不如从名称中获取变量：

```
["foo", "goo", "bar"].each { |param_name|
  param = eval(param_name)
  if param.class != Array
    puts "#{param_name} wasn't an Array. It was a/an #{param.class}"
    return "Error: #{param_name} wasn't an Array"
  end
  } 
```

如果有可能根本没有定义一个变量（而不是不是一个数组），您可能希望在“param = ...”行的末尾添加“rescue nil”以保持 eval从抛出异常...

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-14T23:43:22.643

您需要重新设计您的解决方案。即使你*能*做到（你不能），这个问题也根本没有合理的答案。

想象一个 get_name 方法。

```
a = 1
get_name(a) 
```

每个人都可能同意这应该返回“a”

```
b = a
get_name(b) 
```

它应该返回“b”还是“a”，还是包含两者的数组？

```
[b,a].each do |arg|
  get_name(arg)
end 
```

它应该返回 'arg'、'b' 还是 'a' ？

```
def do_stuff( arg )
  get_name(arg)
do
do_stuff(b) 
```

它应该返回“arg”、“b”还是“a”，或者可能是所有这些的数组？即使它确实返回了一个数组，顺序是什么，我怎么知道如何解释结果？

上述所有问题的答案都是“这取决于我当时想要的特定事物”。我不确定如何为 Ruby 解决这个问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-12T12:53:08.900

看来您正在尝试解决一个更容易解决的问题..

为什么不将数据存储在哈希中？如果你这样做..

```
data_container = {'foo' => ['goo', 'baz']} 
```

..然后获得'foo'的名字是完全微不足道的。

也就是说，您没有为问题提供任何背景信息，因此您可能无法做到这一点。

*[编辑]*澄清后，我看到了问题，但我认为这不是问题.. 使用 [foo, bar, bla]，相当于说`['content 1', 'content 2', 'etc']`. 实际的变量名称是（或者更确切地说，应该是）完全不相关的。如果变量的名称很重要，那正是哈希存在的原因。

问题不在于迭代 [foo, bar] 等，而是 SOAP 服务器如何返回数据和/或您如何尝试使用它的根本问题。

我想说，解决方案是让 SOAP 服务器返回哈希值，或者，既然你知道总会有三个元素，你能不做类似的事情吗？

```
{"foo" => foo, "goo" => goo, "bar"=>bar}.each do |param_name, param|
      if param.class != Array
        puts "#{param_name} wasn't an Array. It was a/an #{param.class}"
        puts "Error: #{param_name} wasn't an Array"
      end
end 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-12T12:35:59.003

好的，它也可以在实例方法中工作，并且根据您的特定要求（您在评论中提出的要求），您可以这样做：

```
local_variables.each do |var|
  puts var if (eval(var).class != Fixnum)
end 
```

只需替换`Fixnum`为您的特定类型检查即可。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T08:17:38.330

我不知道有什么方法可以获取局部变量名。但是，您可以使用该`instance_variables`方法，这将返回对象中所有实例变量名称的数组。

简单调用：

```
object.instance_variables 
```

或者

```
self.instance_variables 
```

获取所有实例变量名称的数组。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-12T11:35:16.403

建立在[joshmsmoore](https://stackoverflow.com/users/5004/joshsmooremyopenidcom)上，这样的事情可能会做到：

```
# Returns the first instance variable whose value == x
# Returns nil if no name maps to the given value
def instance_variable_name_for(x)
  self.instance_variables.find do |var|
    x == self.instance_variable_get(var)
  end
end 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-12T11:53:16.330

有`Kernel::local_variables`，但我不确定这是否适用于方法的本地变量，而且我不知道您是否可以以某种方式操作它以执行您希望实现的操作。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-06-10T17:28:39.413

好问题。我完全理解你的动机。让我首先指出，有某些特殊对象，在某些情况下，知道它们被分配到的变量。这些特殊对象例如。`Module`实例，`Class`实例和`Struct`实例：

```
Dog = Class.new
Dog.name # Dog 
```

问题是，这仅在执行赋值的变量是常量时才有效。（我们都知道 Ruby 常量只不过是情绪敏感的变量。）因此：

```
x = Module.new # creating an anonymous module
x.name #=> nil # the module does not know that it has been assigned to x
Animal = x # but will notice once we assign it to a constant
x.name #=> "Animal" 
```

对象知道它们被分配了哪些变量的这种行为通常被称为*常量魔法*（因为它仅限于常量）。但是这种非常受欢迎的*常量魔法*只适用于某些对象：

```
Rover = Dog.new
Rover.name #=> raises NoMethodError 
```

幸运的是，[我写了一个 gem`y_support/name_magic`](https://github.com/boris-s/y_support)，它会为你解决这个问题：

```
 # first, gem install y_support
require 'y_support/name_magic'

class Cat
  include NameMagic
end 
```

事实上，这只适用于常量（即以大写字母开头的变量）并不是一个很大的限制。事实上，它让您可以随意命名或不命名您的对象：

```
tmp = Cat.new # nameless kitty
tmp.name #=> nil
Josie = tmp # by assigning to a constant, we name the kitty Josie
tmp.name #=> :Josie 
```

不幸的是，这不适用于数组文字，因为它们是在内部构造的，没有使用依赖的`#new`方法。`NameMagic`因此，要实现您想要的，您将必须继承子类`Array`：

```
require 'y_support/name_magic'
class MyArr < Array
  include NameMagic
end

foo = MyArr.new ["goo", "baz"] # not named yet
foo.name #=> nil
Foo = foo # but assignment to a constant is noticed
foo.name #=> :Foo

# You can even list the instances
MyArr.instances #=> [["goo", "baz"]]
MyArr.instance_names #=> [:Foo]

# Get an instance by name:
MyArr.instance "Foo" #=> ["goo", "baz"]
MyArr.instance :Foo #=> ["goo", "baz"]

# Rename it:
Foo.name = "Quux"
Foo.name #=> :Quux

# Or forget the name again:
MyArr.forget :Quux
Foo.name #=> nil

# In addition, you can name the object upon creation even without assignment
u = MyArr.new [1, 2], name: :Pair
u.name #=> :Pair
v = MyArr.new [1, 2, 3], ɴ: :Trinity
v.name #=> :Trinity 
```

我通过搜索当前 Ruby 对象空间的*所有命名空间中的所有常量来实现常量魔术模仿行为。*这浪费了几分之一秒，但由于只执行一次搜索，一旦对象找出它的名称，就没有性能损失。未来，Ruby 核心团队[已经承诺`const_assigned`hook](http://bugs.ruby-lang.org/issues/7149)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-12T15:17:52.970

你不能，你需要回到绘图板并重新设计你的解决方案。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T20:17:49.867

Foo 只是一个保存指向数据的指针的位置。数据不知道它指向什么。在 Smalltalk 系统中，您可以向 VM 询问指向对象的所有指针，但这只会让您获得包含 foo 变量的对象，而不是 foo 本身。在 Ruby 中没有真正的方法来引用变量。正如一个答案所提到的，您仍然可以在数据中放置一个标签来引用它来自哪里等，但通常这不是解决大多数问题的好方法。您可以首先使用散列来接收值，或者使用散列传递给循环，以便您知道用于验证目的的参数名称，如 DBR 的答案。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-15T23:22:59.750

最接近您问题的真正答案的是使用 Enumerable 方法 each_with_index 而不是 each，因此：

```
my_array = [foo, baz, bar]
my_array.each_with_index do |item, index|
  if item.class != Array
    puts "#{my_array[index]} wasn't an Array. It was a/an #{item.class}"
  end
end 
```

我从您传递给 each/each_with_index 的块中删除了 return 语句，因为它没有做/没有任何意义。each 和 each_with_index 都返回它们正在操作的数组。

这里还有一些关于块中的作用域值得注意的地方：如果您在块之外定义了一个变量，那么它将在其中可用。换句话说，您可以直接在块内引用 foo、bar 和 baz。反之则不然：您第一次在块内创建的变量在块外将不可用。

最后，do/end 语法是多行代码块的首选，但这只是风格问题，尽管它在任何最近的 ruby​​ 代码中都是通用的。

# seo - 获得良好的 Google PageRank

> ID：58484
> 
> 赞同：11
> 
> 时间：2008-09-12T08:10:47.753
> 
> 标签：seo, google-search, pagerank

在 SEO 中，人们经常谈论 Google [PageRank](http://en.wikipedia.org/wiki/PageRank)。这是一个陷阱 22，因为在您的网站实际上很大并且您并不真正需要搜索引擎之前，大网站不太可能链接到您并提高您的 PageRank！

有人告诉我，最简单的方法是简单地获得几个高质量的链接来指向一个网站以提高它的 PageRank。我还被告知，谷歌特别关注某些开放目录，例如 dmoz.org（因为它们是人工管理的链接）。任何人都可以谈论这个的有效性或建议另一个网站/技术来提高网站的 PageRank 吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-12T08:12:04.863

## 有很棒的内容

没有什么比拥有**内容**或提供人们感兴趣的服务更能帮助您的谷歌排名了。如果您的网站比竞争对手更好并解决了真正的需求，您自然会产生更多的流量和入站链接。

## 让您的内容保持新鲜

## 使用包含关键字的友好网址

**好**：[http ://cars.com/products/cars/ford/focus/](http://cars.com/products/cars/ford/focus/)

**不好**：[http ://cars.com/p?id=1232](http://cars.com/p?id=1232)

## 确保页面标题相关且结构良好

**例如**：在法国买房：。在法国购买房产

## 使用描述您网站的域名

**好**：[http ://cars.com/](http://cars.com/)

**不好**：[http ://somerandomunrelateddomainname.com/](http://somerandomunrelateddomainname.com/)

**示例** 在 Google 中输入汽车，在前 5 个链接中，所有 4 个在域中都有汽车：[http ://www.google.co.uk/search?q=car](http://www.google.co.uk/search?q=car)

## 使其可访问

确保人们可以阅读您的内容。这包括各种不同的受众

*   残疾人：视力、运动、认知障碍等。

*   搜索机器人

    特别要确保搜索机器人可以阅读您网站上的每个相关页面。搜索机器人经常被使用**javascript**链接页面或使用框架/ **flash** / **silverlight**阻止。一种简单的方法是拥有一个站点地图页面，该页面可以访问整个站点，将其划分为类别/子类别等。

*   下层浏览器

## 自动提交您的站点地图

大多数搜索引擎都允许您提交网站上的页面列表，包括上次更新的时间。

谷歌：[https ://www.google.com/webmasters/tools/docs/en/about.html](https://www.google.com/webmasters/tools/docs/en/about.html)

## 入站链接

尽可能多地宣传您的网站，以增加链接到您的人的可能性。如果合适的话，关于您的网站的博客/播客。将其列在在线目录中（如果适用）。

## 参考

*   [搜索引擎优化公司的谷歌搜索引擎排名因素](http://www.seomoz.org/article/search-ranking-factors)
*   [创建对 Google 友好的网站：最佳做法](http://www.google.com/support/webmasters/bin/topic.py?topic=8522%3E)
*   [维基百科 - 搜索引擎优化](http://en.wikipedia.org/wiki/Search_engine_optimization)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-12T08:31:24.023

好内容。

经常更新它。

阅读并消化[创建对 Google 友好的网站：最佳实践](http://www.google.com/support/webmasters/bin/topic.py?topic=8522)中的所有内容。

在网络上保持活跃。在博客中发表评论，在电子邮件、即时通讯、推特中与人真诚地对应。

我不太确定域名。维基百科？这意味着什么？莫斯拉？那是什么词？谷歌？是一个错字。雅虎？听起来像巧克力饮料 Yoohoo。

无论如何，尝试为域名添加关键字会让您感到厌烦。它可以被解释为未来的 SEO 技术（如果还没有的话！）

回复所有电子邮件。回复博客评论。友善和乐于助人。

去看[garyvee](http://twitter.com/garyvee)的比零[更好](http://garyvaynerchuk.com/2008/08/12/better-than-zero/)。这会激励你。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T10:22:28.077

如果合适的话，拥有博客是保持内容新鲜的好方法，尤其是在您经常发帖的情况下。CMS 也会很方便，因为它减少了更新的摩擦。最好的方法是用户生成的内容，因为其他人使您的网站更大和更新，他们很可能会从其他网站链接到他们的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T08:13:57.823

Google 不希望您必须专门设计您的网站以获得良好的 PageRank。拥有受欢迎的内容和精心设计的网站自然会为您带来想要的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-14T14:09:09.853

一个简单的技巧是使用

谷歌站长工具 [https://www.google.com/webmasters/tools](https://www.google.com/webmasters/tools)

[您可以使用http://www.xml-sitemaps.com/](http://www.xml-sitemaps.com/)生成站点地图

然后，不要错过使用 www.google.com/analytics/

并且要小心，大多数 SEO 指南都不正确，公平竞争并不总是好的方法。例如，每个人都说向 .edu 网站发送垃圾邮件是不好的和无效的，但它是有效的。

# algorithm - 找到一个公共乘数以将十进制数转换为整数的算法

> ID：58493
> 
> 赞同：4
> 
> 时间：2008-09-12T08:18:38.373
> 
> 标签：algorithm, math

我有一个可能有多达 8 位小数的数字数组，我需要找到可以将它们相乘的最小公数，以便它们都是整数。我需要这个，所以所有原始数字都可以乘以相同的比例，并由一个只处理整数的密封系统处理，然后我可以检索结果并将它们除以公共乘数以获得我的相对结果.

目前我们对数字进行一些检查并乘以 100 或 1,000,000，但 *sealed 系统完成的处理在处理大数字时可能会变得非常昂贵，因此仅仅为了它而将所有内容乘以一百万并不是真的一个很好的选择。作为一个近似值，每次乘以 10 倍时，密封算法的成本就会增加 10 倍。

什么是最有效的算法，它也会给出最好的结果，以完成我需要的东西，是否有我需要的数学名称和/或公式？

*密封系统并不是真正密封的。我拥有/维护它的源代码，但它有 100,000 多行专有魔法，并且已经过彻底的错误和性能测试，出于多种原因，更改它以处理浮点数不是一种选择。它是一个系统，它创建一个由 X 乘 Y 单元组成的网格，然后将 X 乘 Y 的矩形放入网格中，“专有魔法”发生并吐出结果——显然这是一个极其简化的现实版本，但它是一个足够好的近似值。

到目前为止，有一些很好的答案，我想知道我应该如何选择“正确”的答案。一开始我认为唯一公平的方法是创建每个解决方案并对其进行性能测试，但后来我意识到纯速度并不是唯一相关的因素——更准确的解决方案也非常相关。无论如何我都编写了性能测试，但目前我正在使用“直觉”公式根据速度和准确性选择正确的答案。

我的性能测试处理 1000 组不同的 100 个随机生成的数字。每个算法都使用相同的随机数集进行测试。算法是用 .Net 3.5 编写的（尽管到目前为止与 2.0 兼容）我非常努力地使测试尽可能公平。

*   Greg – 乘以大数然后除以 GCD – 63 毫秒
*   Andy – 字符串解析 – 199 毫秒
*   Eric – Decimal.GetBits – 160 毫秒
*   Eric – 二进制搜索 – 32 毫秒
*   Ima - 抱歉，我无法弄清楚如何在 .Net 中轻松实现您的解决方案（我不想花太长时间在上面）
*   比尔——我认为你的答案与格雷格的很接近，所以没有实施。我敢肯定它会更快，但可能不太准确。

所以 Greg 的乘以大数然后除以 GCD”解决方案是第二快的算法，它给出了最准确的结果，所以现在我称之为正确的。

我真的希望 Decimal.GetBits 解决方案是最快的，但它非常慢，我不确定这是由于将 Double 转换为 Decimal 还是由于 Bit 掩码和移位。使用 BitConverter.GetBytes 和此处包含的一些知识应该有一个类似的可用解决方案：http: [//blogs.msdn.com/bclteam/archive/2007/05/29/bcl-refresher-floating-point- types-the-good-the-bad-and-the-ugly-inbar-gazit-matthew-greig.aspx](http://blogs.msdn.com/bclteam/archive/2007/05/29/bcl-refresher-floating-point-types-the-good-the-bad-and-the-ugly-inbar-gazit-matthew-greig.aspx)但每次我读到那篇文章时，我的眼睛一直在发呆，最终我没时间尝试实现一个解决方案。

如果有人能想到更好的方法，我总是对其他解决方案持开放态度。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T08:21:43.077

我会乘以足够大的值（100,000,000 小数点后 8 位），然后除以结果数字的[GCD](http://en.wikipedia.org/wiki/Greatest_common_divisor)。你最终会得到一堆最小的整数，你可以将它们提供给其他算法。得到结果后，反转过程以恢复您的原始范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T11:19:02.137

如果你想找到某个整数 N 使得 N*x 也是一组浮点数的精确整数，给定集合中的 x 都是整数，那么你有一个基本上无法解决的问题。假设 x = 您的类型可以表示的最小正浮点数，例如 10^-30。如果您将所有数字乘以 10^30，然后尝试用二进制表示它们（否则，您为什么还要努力使它们成为整数？），那么您将基本上丢失其他数字的所有信息溢出。

所以这里有两个建议：

1.  如果您可以控制所有相关代码，请找到另一种方法。例如，如果你有一些只接受 int 的函数，但你有浮点数，并且你想将你的浮点数填充到函数中，只需重写或重载这个函数以接受浮点数。
2.  如果您无法控制需要 int 的系统部分，则选择您关心的精度，接受有时您将不得不丢失一些信息（但在某种意义上它总是“小” )，然后将所有浮点数乘以该常数，然后四舍五入到最接近的整数。

顺便说一句，如果你处理的是分数，而不是浮点数，那么这是一个不同的游戏。如果你有一堆分数 a/b, c/d, e/f; 并且您想要一个最小公倍数 N 使得 N*(每个分数) = 一个整数，然后 N = a *b* c / gcd(a,b,c); 和 gcd(a,b,c) = gcd(a, gcd(b, c))。您可以使用[欧几里得算法](http://en.wikipedia.org/wiki/Euclidean_algorithm)来找到任意两个数字的 gcd。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T23:01:05.710

1.  将所有数字乘以 10，直到得到整数。
2.  除以 2,3,5,7，而您仍然拥有所有整数。

我认为这涵盖了所有情况。

```
2.1 * 10/7 -> 3
0.008 * 10^3/2^3 -> 1 
```

这是假设你的乘数可以是一个有理分数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T08:36:29.360

你用什么语言编程？就像是

```
myNumber.ToString().Substring(myNumber.ToString().IndexOf(".")+1).Length 
```

将为您提供 C# 中双精度的小数位数。您可以通过它运行每个数字并找到最大的小数位数（x），然后将每个数字乘以 10 的 x 次方。

编辑：出于好奇，这个只能将整数传递给的密封系统是什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T09:03:59.093

Greg：很好的解决方案，但是计算一个包含 100 多个数字的数组中常见的 GCD 会不会有点贵？你会怎么做呢？对两个数字进行 GCD 很容易，但对于 100，它变得更加复杂（我认为）。

邪恶的安迪：我正在.Net 中编程，你提出的解决方案与我们现在所做的非常匹配。我不想将它包含在我最初的问题中，因为我希望有一些跳出框框（或无论如何是我的框框）的想法，并且我不想用潜在的解决方案来污染人们的答案。虽然我没有任何可靠的性能统计数据（因为我没有任何其他方法可以比较它），但我知道字符串解析会相对昂贵，而且我认为纯数学解决方案可能更有效。公平地说，当前的字符串解析解决方案正在生产中，并且还没有关于它的性能的投诉（它甚至在一个单独的 VB6 格式的系统中生产，也没有任何投诉）。就是感觉不太对劲

也就是说，我仍然对任何其他解决方案持开放态度，无论是纯数学的还是其他的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T10:47:54.117

在循环中获取每个数字的尾数和指数作为整数。您可以将 frexp 用于指数，但我认为尾数需要位掩码。找到最小指数。在尾数中查找最高有效数字（循环查找最后一个“1”） - 或简单地使用预定义的有效数字数。你的倍数就像 2^(numberOfDigits-minMantissa)。“类似”是因为我不记得偏差/偏移量/范围，但我认为这个想法很清楚。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T22:26:20.753

所以基本上你想确定每个数字小数点后的位数。

如果你有数字的二进制表示，这会更容易。在你的程序中，数字是从有理数还是科学记数法转换而来的？如果是这样，您可以跳过较早的转换并轻松得多。否则，您可能希望将每个数字传递给用 C 编写的外部 DLL 中的函数，您可以在其中直接使用浮点表示。或者您可以将数字转换为十进制并使用[Decimal.GetBits](http://msdn.microsoft.com/en-us/library/system.decimal.getbits(VS.71).aspx)做一些工作。

我能想到的最快的方法是按照你的条件找到最小的必要的 10 次方（或 2，或其他），如前所述。但不是在循环中进行，而是通过对可能的幂进行二进制搜索来节省一些计算。假设最多 8 个，例如：

```
int NumDecimals( double d )
{
   // make d positive for clarity; it won't change the result
   if( d<0 ) d=-d;

   // now do binary search on the possible numbers of post-decimal digits to 
   // determine the actual number as quickly as possible:

   if( NeedsMore( d, 10e4 ) )
   {
      // more than 4 decimals
      if( NeedsMore( d, 10e6 ) )
      {
          // > 6 decimal places
          if( NeedsMore( d, 10e7 ) ) return 10e8;
          return 10e7;
      }
      else
      {
         // <= 6 decimal places
         if( NeedsMore( d, 10e5 ) ) return 10e6;
         return 10e5;
      }
   }
   else
   {
      // <= 4 decimal places
      // etc...
   }

}

bool NeedsMore( double d, double e )
{
   // check whether the representation of D has more decimal points than the 
   // power of 10 represented in e.
   return (d*e - Math.Floor( d*e )) > 0;
} 
```

PS：您不会将证券价格传递给期权定价引擎吗？它的味道完全...

# c# - 使用 .NET，如何根据文件签名而不是扩展名找到文件的 mime 类型

> ID：58510
> 
> 赞同：258
> 
> 时间：2008-09-12T08:35:39.347
> 
> 标签：c#, mime, mime-types

我正在寻找一种简单的方法来获取文件扩展名不正确或未给出的 mime 类型，仅在 .Net 中类似于[此问题。](https://stackoverflow.com/questions/51438/getting-a-files-mime-type-in-java)

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2008-09-15T09:08:17.527

最后我确实使用了 urlmon.dll。我认为会有一种更简单的方法，但这很有效。我包含代码以帮助其他人，并允许我在需要时再次找到它。

```
using System.Runtime.InteropServices; 
```

...

```
 [DllImport(@"urlmon.dll", CharSet = CharSet.Auto)]
    private extern static System.UInt32 FindMimeFromData(
        System.UInt32 pBC,
        [MarshalAs(UnmanagedType.LPStr)] System.String pwzUrl,
        [MarshalAs(UnmanagedType.LPArray)] byte[] pBuffer,
        System.UInt32 cbSize,
        [MarshalAs(UnmanagedType.LPStr)] System.String pwzMimeProposed,
        System.UInt32 dwMimeFlags,
        out System.UInt32 ppwzMimeOut,
        System.UInt32 dwReserverd
    );

    public static string getMimeFromFile(string filename)
    {
        if (!File.Exists(filename))
            throw new FileNotFoundException(filename + " not found");

        byte[] buffer = new byte[256];
        using (FileStream fs = new FileStream(filename, FileMode.Open))
        {
            if (fs.Length >= 256)
                fs.Read(buffer, 0, 256);
            else
                fs.Read(buffer, 0, (int)fs.Length);
        }
        try
        {
            System.UInt32 mimetype;
            FindMimeFromData(0, null, buffer, 256, null, 0, out mimetype, 0);
            System.IntPtr mimeTypePtr = new IntPtr(mimetype);
            string mime = Marshal.PtrToStringUni(mimeTypePtr);
            Marshal.FreeCoTaskMem(mimeTypePtr);
            return mime;
        }
        catch (Exception e)
        {
            return "unknown/unknown";
        }
    } 
```

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2011-08-23T12:50:06.927

我找到了一个硬编码的解决方案，我希望我能帮助别人：

```
public static class MIMEAssistant
{
  private static readonly Dictionary<string, string> MIMETypesDictionary = new Dictionary<string, string>
  {
    {"ai", "application/postscript"},
    {"aif", "audio/x-aiff"},
    {"aifc", "audio/x-aiff"},
    {"aiff", "audio/x-aiff"},
    {"asc", "text/plain"},
    {"atom", "application/atom+xml"},
    {"au", "audio/basic"},
    {"avi", "video/x-msvideo"},
    {"bcpio", "application/x-bcpio"},
    {"bin", "application/octet-stream"},
    {"bmp", "image/bmp"},
    {"cdf", "application/x-netcdf"},
    {"cgm", "image/cgm"},
    {"class", "application/octet-stream"},
    {"cpio", "application/x-cpio"},
    {"cpt", "application/mac-compactpro"},
    {"csh", "application/x-csh"},
    {"css", "text/css"},
    {"dcr", "application/x-director"},
    {"dif", "video/x-dv"},
    {"dir", "application/x-director"},
    {"djv", "image/vnd.djvu"},
    {"djvu", "image/vnd.djvu"},
    {"dll", "application/octet-stream"},
    {"dmg", "application/octet-stream"},
    {"dms", "application/octet-stream"},
    {"doc", "application/msword"},
    {"docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"},
    {"dotx", "application/vnd.openxmlformats-officedocument.wordprocessingml.template"},
    {"docm","application/vnd.ms-word.document.macroEnabled.12"},
    {"dotm","application/vnd.ms-word.template.macroEnabled.12"},
    {"dtd", "application/xml-dtd"},
    {"dv", "video/x-dv"},
    {"dvi", "application/x-dvi"},
    {"dxr", "application/x-director"},
    {"eps", "application/postscript"},
    {"etx", "text/x-setext"},
    {"exe", "application/octet-stream"},
    {"ez", "application/andrew-inset"},
    {"gif", "image/gif"},
    {"gram", "application/srgs"},
    {"grxml", "application/srgs+xml"},
    {"gtar", "application/x-gtar"},
    {"hdf", "application/x-hdf"},
    {"hqx", "application/mac-binhex40"},
    {"htm", "text/html"},
    {"html", "text/html"},
    {"ice", "x-conference/x-cooltalk"},
    {"ico", "image/x-icon"},
    {"ics", "text/calendar"},
    {"ief", "image/ief"},
    {"ifb", "text/calendar"},
    {"iges", "model/iges"},
    {"igs", "model/iges"},
    {"jnlp", "application/x-java-jnlp-file"},
    {"jp2", "image/jp2"},
    {"jpe", "image/jpeg"},
    {"jpeg", "image/jpeg"},
    {"jpg", "image/jpeg"},
    {"js", "application/x-javascript"},
    {"kar", "audio/midi"},
    {"latex", "application/x-latex"},
    {"lha", "application/octet-stream"},
    {"lzh", "application/octet-stream"},
    {"m3u", "audio/x-mpegurl"},
    {"m4a", "audio/mp4a-latm"},
    {"m4b", "audio/mp4a-latm"},
    {"m4p", "audio/mp4a-latm"},
    {"m4u", "video/vnd.mpegurl"},
    {"m4v", "video/x-m4v"},
    {"mac", "image/x-macpaint"},
    {"man", "application/x-troff-man"},
    {"mathml", "application/mathml+xml"},
    {"me", "application/x-troff-me"},
    {"mesh", "model/mesh"},
    {"mid", "audio/midi"},
    {"midi", "audio/midi"},
    {"mif", "application/vnd.mif"},
    {"mov", "video/quicktime"},
    {"movie", "video/x-sgi-movie"},
    {"mp2", "audio/mpeg"},
    {"mp3", "audio/mpeg"},
    {"mp4", "video/mp4"},
    {"mpe", "video/mpeg"},
    {"mpeg", "video/mpeg"},
    {"mpg", "video/mpeg"},
    {"mpga", "audio/mpeg"},
    {"ms", "application/x-troff-ms"},
    {"msh", "model/mesh"},
    {"mxu", "video/vnd.mpegurl"},
    {"nc", "application/x-netcdf"},
    {"oda", "application/oda"},
    {"ogg", "application/ogg"},
    {"pbm", "image/x-portable-bitmap"},
    {"pct", "image/pict"},
    {"pdb", "chemical/x-pdb"},
    {"pdf", "application/pdf"},
    {"pgm", "image/x-portable-graymap"},
    {"pgn", "application/x-chess-pgn"},
    {"pic", "image/pict"},
    {"pict", "image/pict"},
    {"png", "image/png"}, 
    {"pnm", "image/x-portable-anymap"},
    {"pnt", "image/x-macpaint"},
    {"pntg", "image/x-macpaint"},
    {"ppm", "image/x-portable-pixmap"},
    {"ppt", "application/vnd.ms-powerpoint"},
    {"pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"},
    {"potx","application/vnd.openxmlformats-officedocument.presentationml.template"},
    {"ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"},
    {"ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"},
    {"pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"},
    {"potm","application/vnd.ms-powerpoint.template.macroEnabled.12"},
    {"ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"},
    {"ps", "application/postscript"},
    {"qt", "video/quicktime"},
    {"qti", "image/x-quicktime"},
    {"qtif", "image/x-quicktime"},
    {"ra", "audio/x-pn-realaudio"},
    {"ram", "audio/x-pn-realaudio"},
    {"ras", "image/x-cmu-raster"},
    {"rdf", "application/rdf+xml"},
    {"rgb", "image/x-rgb"},
    {"rm", "application/vnd.rn-realmedia"},
    {"roff", "application/x-troff"},
    {"rtf", "text/rtf"},
    {"rtx", "text/richtext"},
    {"sgm", "text/sgml"},
    {"sgml", "text/sgml"},
    {"sh", "application/x-sh"},
    {"shar", "application/x-shar"},
    {"silo", "model/mesh"},
    {"sit", "application/x-stuffit"},
    {"skd", "application/x-koan"},
    {"skm", "application/x-koan"},
    {"skp", "application/x-koan"},
    {"skt", "application/x-koan"},
    {"smi", "application/smil"},
    {"smil", "application/smil"},
    {"snd", "audio/basic"},
    {"so", "application/octet-stream"},
    {"spl", "application/x-futuresplash"},
    {"src", "application/x-wais-source"},
    {"sv4cpio", "application/x-sv4cpio"},
    {"sv4crc", "application/x-sv4crc"},
    {"svg", "image/svg+xml"},
    {"swf", "application/x-shockwave-flash"},
    {"t", "application/x-troff"},
    {"tar", "application/x-tar"},
    {"tcl", "application/x-tcl"},
    {"tex", "application/x-tex"},
    {"texi", "application/x-texinfo"},
    {"texinfo", "application/x-texinfo"},
    {"tif", "image/tiff"},
    {"tiff", "image/tiff"},
    {"tr", "application/x-troff"},
    {"tsv", "text/tab-separated-values"},
    {"txt", "text/plain"},
    {"ustar", "application/x-ustar"},
    {"vcd", "application/x-cdlink"},
    {"vrml", "model/vrml"},
    {"vxml", "application/voicexml+xml"},
    {"wav", "audio/x-wav"},
    {"wbmp", "image/vnd.wap.wbmp"},
    {"wbmxl", "application/vnd.wap.wbxml"},
    {"wml", "text/vnd.wap.wml"},
    {"wmlc", "application/vnd.wap.wmlc"},
    {"wmls", "text/vnd.wap.wmlscript"},
    {"wmlsc", "application/vnd.wap.wmlscriptc"},
    {"wrl", "model/vrml"},
    {"xbm", "image/x-xbitmap"},
    {"xht", "application/xhtml+xml"},
    {"xhtml", "application/xhtml+xml"},
    {"xls", "application/vnd.ms-excel"},                        
    {"xml", "application/xml"},
    {"xpm", "image/x-xpixmap"},
    {"xsl", "application/xml"},
    {"xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},
    {"xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"},
    {"xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"},
    {"xltm","application/vnd.ms-excel.template.macroEnabled.12"},
    {"xlam","application/vnd.ms-excel.addin.macroEnabled.12"},
    {"xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"},
    {"xslt", "application/xslt+xml"},
    {"xul", "application/vnd.mozilla.xul+xml"},
    {"xwd", "image/x-xwindowdump"},
    {"xyz", "chemical/x-xyz"},
    {"zip", "application/zip"}
  };

  public static string GetMIMEType(string fileName)
  {
    //get file extension
    string extension = Path.GetExtension(fileName).ToLowerInvariant();

    if (extension.Length > 0 && 
        MIMETypesDictionary.ContainsKey(extension.Remove(0, 1)))
    {
      return MIMETypesDictionary[extension.Remove(0, 1)];
    }
    return "unknown/unknown";
  }
} 
```

* * *

## 回答 #3

> 赞同：99
> 
> 时间：2012-11-28T21:27:55.757

编辑：只需使用[Mime Detective](https://github.com/Muraad/Mime-Detective)

我使用字节数组序列来确定给定文件的正确 MIME 类型。与仅查看文件名的文件扩展名相比，这样做的好处是，如果用户要重命名文件以绕过某些文件类型上传限制，文件扩展名将无法捕捉到这一点。另一方面，通过字节数组获取文件签名将阻止这种恶作剧行为的发生。

这是 C# 中的一个示例：

```
public class MimeType
{
    private static readonly byte[] BMP = { 66, 77 };
    private static readonly byte[] DOC = { 208, 207, 17, 224, 161, 177, 26, 225 };
    private static readonly byte[] EXE_DLL = { 77, 90 };
    private static readonly byte[] GIF = { 71, 73, 70, 56 };
    private static readonly byte[] ICO = { 0, 0, 1, 0 };
    private static readonly byte[] JPG = { 255, 216, 255 };
    private static readonly byte[] MP3 = { 255, 251, 48 };
    private static readonly byte[] OGG = { 79, 103, 103, 83, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0 };
    private static readonly byte[] PDF = { 37, 80, 68, 70, 45, 49, 46 };
    private static readonly byte[] PNG = { 137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82 };
    private static readonly byte[] RAR = { 82, 97, 114, 33, 26, 7, 0 };
    private static readonly byte[] SWF = { 70, 87, 83 };
    private static readonly byte[] TIFF = { 73, 73, 42, 0 };
    private static readonly byte[] TORRENT = { 100, 56, 58, 97, 110, 110, 111, 117, 110, 99, 101 };
    private static readonly byte[] TTF = { 0, 1, 0, 0, 0 };
    private static readonly byte[] WAV_AVI = { 82, 73, 70, 70 };
    private static readonly byte[] WMV_WMA = { 48, 38, 178, 117, 142, 102, 207, 17, 166, 217, 0, 170, 0, 98, 206, 108 };
    private static readonly byte[] ZIP_DOCX = { 80, 75, 3, 4 };

    public static string GetMimeType(byte[] file, string fileName)
    {

        string mime = "application/octet-stream"; //DEFAULT UNKNOWN MIME TYPE

        //Ensure that the filename isn't empty or null
        if (string.IsNullOrWhiteSpace(fileName))
        {
            return mime;
        }

        //Get the file extension
        string extension = Path.GetExtension(fileName) == null
                               ? string.Empty
                               : Path.GetExtension(fileName).ToUpper();

        //Get the MIME Type
        if (file.Take(2).SequenceEqual(BMP))
        {
            mime = "image/bmp";
        }
        else if (file.Take(8).SequenceEqual(DOC))
        {
            mime = "application/msword";
        }
        else if (file.Take(2).SequenceEqual(EXE_DLL))
        {
            mime = "application/x-msdownload"; //both use same mime type
        }
        else if (file.Take(4).SequenceEqual(GIF))
        {
            mime = "image/gif";
        }
        else if (file.Take(4).SequenceEqual(ICO))
        {
            mime = "image/x-icon";
        }
        else if (file.Take(3).SequenceEqual(JPG))
        {
            mime = "image/jpeg";
        }
        else if (file.Take(3).SequenceEqual(MP3))
        {
            mime = "audio/mpeg";
        }
        else if (file.Take(14).SequenceEqual(OGG))
        {
            if (extension == ".OGX")
            {
                mime = "application/ogg";
            }
            else if (extension == ".OGA")
            {
                mime = "audio/ogg";
            }
            else
            {
                mime = "video/ogg";
            }
        }
        else if (file.Take(7).SequenceEqual(PDF))
        {
            mime = "application/pdf";
        }
        else if (file.Take(16).SequenceEqual(PNG))
        {
            mime = "image/png";
        }
        else if (file.Take(7).SequenceEqual(RAR))
        {
            mime = "application/x-rar-compressed";
        }
        else if (file.Take(3).SequenceEqual(SWF))
        {
            mime = "application/x-shockwave-flash";
        }
        else if (file.Take(4).SequenceEqual(TIFF))
        {
            mime = "image/tiff";
        }
        else if (file.Take(11).SequenceEqual(TORRENT))
        {
            mime = "application/x-bittorrent";
        }
        else if (file.Take(5).SequenceEqual(TTF))
        {
            mime = "application/x-font-ttf";
        }
        else if (file.Take(4).SequenceEqual(WAV_AVI))
        {
            mime = extension == ".AVI" ? "video/x-msvideo" : "audio/x-wav";
        }
        else if (file.Take(16).SequenceEqual(WMV_WMA))
        {
            mime = extension == ".WMA" ? "audio/x-ms-wma" : "video/x-ms-wmv";
        }
        else if (file.Take(4).SequenceEqual(ZIP_DOCX))
        {
            mime = extension == ".DOCX" ? "application/vnd.openxmlformats-officedocument.wordprocessingml.document" : "application/x-zip-compressed";
        }

        return mime;
    }

} 
```

请注意，我处理 DOCX 文件类型的方式不同，因为 DOCX 实际上只是一个 ZIP 文件。在这种情况下，一旦我确认它具有该序列，我只需检查文件扩展名。对于某些人来说，这个示例还远未完成，但您可以轻松添加自己的示例。

如果你想添加更多的 MIME 类型，你可以[从这里](http://www.mircscripts.org/showdoc.php?type=code&id=2933)获取许多不同文件类型的字节数组序列。此外，[这是另一个](http://www.garykessler.net/library/file_sigs.html)关于文件签名的好资源。

如果所有其他方法都失败了，我经常做的是逐步浏览我正在寻找的特定类型的几个文件，并在文件的字节序列中寻找一个模式。最后，这仍然是基本的验证，不能用于100%的文件类型确定证明。

* * *

## 回答 #4

> 赞同：84
> 
> 时间：2008-09-12T09:44:11.070

在 Urlmon.dll 中，有一个名为`FindMimeFromData`.

从文档

> MIME 类型检测或“数据嗅探”是指从二进制数据中确定适当的 MIME 类型的过程。最终结果取决于服务器提供的 MIME 类型标头、文件扩展名和/或数据本身的组合。通常，只有前 256 个字节的数据是重要的。

因此，从文件中读取前（最多）256 个字节并将其传递给`FindMimeFromData`.

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2012-09-01T15:45:10.777

如果您使用的是 .NET Framework 4.5 或更高版本，现在有一个 MimeMapping.GetMimeMapping(filename) 方法，该方法将返回一个字符串，其中包含传递的文件名的正确 Mime 映射。请注意，这使用文件扩展名，而不是文件本身中的数据。

文档位于[http://msdn.microsoft.com/en-us/library/system.web.mimemapping.getmimemapping](http://msdn.microsoft.com/en-us/library/system.web.mimemapping.getmimemapping)

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2009-11-06T05:31:34.637

您也可以查看注册表。

```
 using System.IO;
    using Microsoft.Win32;

    string GetMimeType(FileInfo fileInfo)
    {
        string mimeType = "application/unknown";

        RegistryKey regKey = Registry.ClassesRoot.OpenSubKey(
            fileInfo.Extension.ToLower()
            );

        if(regKey != null)
        {
            object contentType = regKey.GetValue("Content Type");

            if(contentType != null)
                mimeType = contentType.ToString();
        }

        return mimeType;
    } 
```

您将不得不以一种或另一种方式进入 MIME 数据库——无论它们是从扩展名还是从幻数映射的有点微不足道——Windows 注册表就是这样一个地方。对于独立于平台的解决方案，尽管必须将这个数据库与代码（或作为独立库）一起提供。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2020-02-02T13:50:36.047

`HeyRed.Mime.MimeGuesser.GuessMimeType`如果您想在非 Windows 环境中托管 ASP.NET 解决方案，来自 Nuget 的解决方案将是终极解决方案。

文件扩展名映射非常不安全。如果攻击者上传无效的扩展名，映射字典将允许例如在 .jpg 文件中分发可执行文件。因此，始终使用内容嗅探库来了解真正的内容类型。

```
 public  static string MimeTypeFrom(byte[] dataBytes, string fileName)
 {
        var contentType = HeyRed.Mime.MimeGuesser.GuessMimeType(dataBytes);
        if (string.IsNullOrEmpty(contentType))
        {
            return HeyRed.Mime.MimeTypesMap.GetMimeType(fileName);
        }
  return contentType; 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-02-24T18:01:55.427

我使用混合解决方案：

```
 using System.Runtime.InteropServices;

    [DllImport (@"urlmon.dll", CharSet = CharSet.Auto)]
    private extern static System.UInt32 FindMimeFromData(
        System.UInt32 pBC, 
        [MarshalAs(UnmanagedType.LPStr)] System.String pwzUrl,
        [MarshalAs(UnmanagedType.LPArray)] byte[] pBuffer,
        System.UInt32 cbSize,
        [MarshalAs(UnmanagedType.LPStr)] System.String pwzMimeProposed,
        System.UInt32 dwMimeFlags,
        out System.UInt32 ppwzMimeOut,
        System.UInt32 dwReserverd
    );

    private string GetMimeFromRegistry (string Filename)
    {
        string mime = "application/octetstream";
        string ext = System.IO.Path.GetExtension(Filename).ToLower();
        Microsoft.Win32.RegistryKey rk = Microsoft.Win32.Registry.ClassesRoot.OpenSubKey(ext);
        if (rk != null && rk.GetValue("Content Type") != null)
            mime = rk.GetValue("Content Type").ToString();
        return mime;
    }

    public string GetMimeTypeFromFileAndRegistry (string filename)
    {
        if (!File.Exists(filename))
        {
           return GetMimeFromRegistry (filename);
        }

        byte[] buffer = new byte[256];

        using (FileStream fs = new FileStream(filename, FileMode.Open))
        {
            if (fs.Length >= 256)
                fs.Read(buffer, 0, 256);
            else
                fs.Read(buffer, 0, (int)fs.Length);
        }

        try
        {            
            System.UInt32 mimetype;

            FindMimeFromData(0, null, buffer, 256, null, 0, out mimetype, 0);

            System.IntPtr mimeTypePtr = new IntPtr(mimetype);

            string mime = Marshal.PtrToStringUni(mimeTypePtr);

            Marshal.FreeCoTaskMem(mimeTypePtr);

            if (string.IsNullOrWhiteSpace (mime) || 
                mime =="text/plain" || mime == "application/octet-stream")                    
            {
                return GetMimeFromRegistry (filename);
            }

            return mime;
        }
        catch (Exception e)
        {
            return GetMimeFromRegistry (filename);
        }
    } 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2020-05-19T14:35:24.153

我写了一个 mime 类型的验证器。请与您分享。

```
private readonly Dictionary<string, byte[]> _mimeTypes = new Dictionary<string, byte[]>
    {
        {"image/jpeg", new byte[] {255, 216, 255}},
        {"image/jpg", new byte[] {255, 216, 255}},
        {"image/pjpeg", new byte[] {255, 216, 255}},
        {"image/apng", new byte[] {137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82}},
        {"image/png", new byte[] {137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82}},
        {"image/bmp", new byte[] {66, 77}},
        {"image/gif", new byte[] {71, 73, 70, 56}},
    };

private bool ValidateMimeType(byte[] file, string contentType)
    {
        var imageType = _mimeTypes.SingleOrDefault(x => x.Key.Equals(contentType));

        return file.Take(imageType.Value.Length).SequenceEqual(imageType.Value);
    } 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-11-11T23:40:59.067

我认为正确的答案是 Steve Morgan 和 Serguei 答案的结合。这就是 Internet Explorer 的工作方式。pinvoke 调用`FindMimeFromData`仅适用于 26 种硬编码的 mime 类型。此外，即使可能存在更具体、更合适的 mime 类型，它也会给出模棱两可的 mime 类型（例如`text/plain`or ）。`application/octet-stream`如果它没有给出好的 mime 类型，您可以去注册表获取更具体的 mime 类型。服务器注册表可以有更多最新的 mime 类型。

参考： http: [//msdn.microsoft.com/en-us/library/ms775147 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms775147(VS.85).aspx)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-05-09T19:11:03.197

此类使用以前的答案以 3 种不同的方式进行尝试：基于扩展的硬编码、FindMimeFromData API 和使用注册表。

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.InteropServices;

using Microsoft.Win32;

namespace YourNamespace
{
    public static class MimeTypeParser
    {
        [DllImport(@"urlmon.dll", CharSet = CharSet.Auto)]
        private extern static System.UInt32 FindMimeFromData(
                System.UInt32 pBC,
                [MarshalAs(UnmanagedType.LPStr)] System.String pwzUrl,
                [MarshalAs(UnmanagedType.LPArray)] byte[] pBuffer,
                System.UInt32 cbSize,
                [MarshalAs(UnmanagedType.LPStr)] System.String pwzMimeProposed,
                System.UInt32 dwMimeFlags,
                out System.UInt32 ppwzMimeOut,
                System.UInt32 dwReserverd
        );

        public static string GetMimeType(string sFilePath)
        {
            string sMimeType = GetMimeTypeFromList(sFilePath);

            if (String.IsNullOrEmpty(sMimeType))
            {
                sMimeType = GetMimeTypeFromFile(sFilePath);

                if (String.IsNullOrEmpty(sMimeType))
                {
                    sMimeType = GetMimeTypeFromRegistry(sFilePath);
                }
            }

            return sMimeType;
        }

        public static string GetMimeTypeFromList(string sFileNameOrPath)
        {
            string sMimeType = null;
            string sExtensionWithoutDot = Path.GetExtension(sFileNameOrPath).Substring(1).ToLower();

            if (!String.IsNullOrEmpty(sExtensionWithoutDot) && spDicMIMETypes.ContainsKey(sExtensionWithoutDot))
            {
                sMimeType = spDicMIMETypes[sExtensionWithoutDot];
            }

            return sMimeType;
        }

        public static string GetMimeTypeFromRegistry(string sFileNameOrPath)
        {
            string sMimeType = null;
            string sExtension = Path.GetExtension(sFileNameOrPath).ToLower();
            RegistryKey pKey = Registry.ClassesRoot.OpenSubKey(sExtension);

            if (pKey != null && pKey.GetValue("Content Type") != null)
            {
                sMimeType = pKey.GetValue("Content Type").ToString();
            }

            return sMimeType;
        }

        public static string GetMimeTypeFromFile(string sFilePath)
        {
            string sMimeType = null;

            if (File.Exists(sFilePath))
            {
                byte[] abytBuffer = new byte[256];

                using (FileStream pFileStream = new FileStream(sFilePath, FileMode.Open))
                {
                    if (pFileStream.Length >= 256)
                    {
                        pFileStream.Read(abytBuffer, 0, 256);
                    }
                    else
                    {
                        pFileStream.Read(abytBuffer, 0, (int)pFileStream.Length);
                    }
                }

                try
                {
                    UInt32 unMimeType;

                    FindMimeFromData(0, null, abytBuffer, 256, null, 0, out unMimeType, 0);

                    IntPtr pMimeType = new IntPtr(unMimeType);
                    string sMimeTypeFromFile = Marshal.PtrToStringUni(pMimeType);

                    Marshal.FreeCoTaskMem(pMimeType);

                    if (!String.IsNullOrEmpty(sMimeTypeFromFile) && sMimeTypeFromFile != "text/plain" && sMimeTypeFromFile != "application/octet-stream")
                    {
                        sMimeType = sMimeTypeFromFile;
                    }
                }
                catch {}
            }

            return sMimeType;
        }

        private static readonly Dictionary<string, string> spDicMIMETypes = new Dictionary<string, string>
        {
            {"ai", "application/postscript"},
            {"aif", "audio/x-aiff"},
            {"aifc", "audio/x-aiff"},
            {"aiff", "audio/x-aiff"},
            {"asc", "text/plain"},
            {"atom", "application/atom+xml"},
            {"au", "audio/basic"},
            {"avi", "video/x-msvideo"},
            {"bcpio", "application/x-bcpio"},
            {"bin", "application/octet-stream"},
            {"bmp", "image/bmp"},
            {"cdf", "application/x-netcdf"},
            {"cgm", "image/cgm"},
            {"class", "application/octet-stream"},
            {"cpio", "application/x-cpio"},
            {"cpt", "application/mac-compactpro"},
            {"csh", "application/x-csh"},
            {"css", "text/css"},
            {"dcr", "application/x-director"},
            {"dif", "video/x-dv"},
            {"dir", "application/x-director"},
            {"djv", "image/vnd.djvu"},
            {"djvu", "image/vnd.djvu"},
            {"dll", "application/octet-stream"},
            {"dmg", "application/octet-stream"},
            {"dms", "application/octet-stream"},
            {"doc", "application/msword"},
            {"docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"},
            {"dotx", "application/vnd.openxmlformats-officedocument.wordprocessingml.template"},
            {"docm","application/vnd.ms-word.document.macroEnabled.12"},
            {"dotm","application/vnd.ms-word.template.macroEnabled.12"},
            {"dtd", "application/xml-dtd"},
            {"dv", "video/x-dv"},
            {"dvi", "application/x-dvi"},
            {"dxr", "application/x-director"},
            {"eps", "application/postscript"},
            {"etx", "text/x-setext"},
            {"exe", "application/octet-stream"},
            {"ez", "application/andrew-inset"},
            {"gif", "image/gif"},
            {"gram", "application/srgs"},
            {"grxml", "application/srgs+xml"},
            {"gtar", "application/x-gtar"},
            {"hdf", "application/x-hdf"},
            {"hqx", "application/mac-binhex40"},
            {"htc", "text/x-component"},
            {"htm", "text/html"},
            {"html", "text/html"},
            {"ice", "x-conference/x-cooltalk"},
            {"ico", "image/x-icon"},
            {"ics", "text/calendar"},
            {"ief", "image/ief"},
            {"ifb", "text/calendar"},
            {"iges", "model/iges"},
            {"igs", "model/iges"},
            {"jnlp", "application/x-java-jnlp-file"},
            {"jp2", "image/jp2"},
            {"jpe", "image/jpeg"},
            {"jpeg", "image/jpeg"},
            {"jpg", "image/jpeg"},
            {"js", "application/x-javascript"},
            {"kar", "audio/midi"},
            {"latex", "application/x-latex"},
            {"lha", "application/octet-stream"},
            {"lzh", "application/octet-stream"},
            {"m3u", "audio/x-mpegurl"},
            {"m4a", "audio/mp4a-latm"},
            {"m4b", "audio/mp4a-latm"},
            {"m4p", "audio/mp4a-latm"},
            {"m4u", "video/vnd.mpegurl"},
            {"m4v", "video/x-m4v"},
            {"mac", "image/x-macpaint"},
            {"man", "application/x-troff-man"},
            {"mathml", "application/mathml+xml"},
            {"me", "application/x-troff-me"},
            {"mesh", "model/mesh"},
            {"mid", "audio/midi"},
            {"midi", "audio/midi"},
            {"mif", "application/vnd.mif"},
            {"mov", "video/quicktime"},
            {"movie", "video/x-sgi-movie"},
            {"mp2", "audio/mpeg"},
            {"mp3", "audio/mpeg"},
            {"mp4", "video/mp4"},
            {"mpe", "video/mpeg"},
            {"mpeg", "video/mpeg"},
            {"mpg", "video/mpeg"},
            {"mpga", "audio/mpeg"},
            {"ms", "application/x-troff-ms"},
            {"msh", "model/mesh"},
            {"mxu", "video/vnd.mpegurl"},
            {"nc", "application/x-netcdf"},
            {"oda", "application/oda"},
            {"ogg", "application/ogg"},
            {"pbm", "image/x-portable-bitmap"},
            {"pct", "image/pict"},
            {"pdb", "chemical/x-pdb"},
            {"pdf", "application/pdf"},
            {"pgm", "image/x-portable-graymap"},
            {"pgn", "application/x-chess-pgn"},
            {"pic", "image/pict"},
            {"pict", "image/pict"},
            {"png", "image/png"}, 
            {"pnm", "image/x-portable-anymap"},
            {"pnt", "image/x-macpaint"},
            {"pntg", "image/x-macpaint"},
            {"ppm", "image/x-portable-pixmap"},
            {"ppt", "application/vnd.ms-powerpoint"},
            {"pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"},
            {"potx","application/vnd.openxmlformats-officedocument.presentationml.template"},
            {"ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"},
            {"ppam","application/vnd.ms-powerpoint.addin.macroEnabled.12"},
            {"pptm","application/vnd.ms-powerpoint.presentation.macroEnabled.12"},
            {"potm","application/vnd.ms-powerpoint.template.macroEnabled.12"},
            {"ppsm","application/vnd.ms-powerpoint.slideshow.macroEnabled.12"},
            {"ps", "application/postscript"},
            {"qt", "video/quicktime"},
            {"qti", "image/x-quicktime"},
            {"qtif", "image/x-quicktime"},
            {"ra", "audio/x-pn-realaudio"},
            {"ram", "audio/x-pn-realaudio"},
            {"ras", "image/x-cmu-raster"},
            {"rdf", "application/rdf+xml"},
            {"rgb", "image/x-rgb"},
            {"rm", "application/vnd.rn-realmedia"},
            {"roff", "application/x-troff"},
            {"rtf", "text/rtf"},
            {"rtx", "text/richtext"},
            {"sgm", "text/sgml"},
            {"sgml", "text/sgml"},
            {"sh", "application/x-sh"},
            {"shar", "application/x-shar"},
            {"silo", "model/mesh"},
            {"sit", "application/x-stuffit"},
            {"skd", "application/x-koan"},
            {"skm", "application/x-koan"},
            {"skp", "application/x-koan"},
            {"skt", "application/x-koan"},
            {"smi", "application/smil"},
            {"smil", "application/smil"},
            {"snd", "audio/basic"},
            {"so", "application/octet-stream"},
            {"spl", "application/x-futuresplash"},
            {"src", "application/x-wais-source"},
            {"sv4cpio", "application/x-sv4cpio"},
            {"sv4crc", "application/x-sv4crc"},
            {"svg", "image/svg+xml"},
            {"swf", "application/x-shockwave-flash"},
            {"t", "application/x-troff"},
            {"tar", "application/x-tar"},
            {"tcl", "application/x-tcl"},
            {"tex", "application/x-tex"},
            {"texi", "application/x-texinfo"},
            {"texinfo", "application/x-texinfo"},
            {"tif", "image/tiff"},
            {"tiff", "image/tiff"},
            {"tr", "application/x-troff"},
            {"tsv", "text/tab-separated-values"},
            {"txt", "text/plain"},
            {"ustar", "application/x-ustar"},
            {"vcd", "application/x-cdlink"},
            {"vrml", "model/vrml"},
            {"vxml", "application/voicexml+xml"},
            {"wav", "audio/x-wav"},
            {"wbmp", "image/vnd.wap.wbmp"},
            {"wbmxl", "application/vnd.wap.wbxml"},
            {"wml", "text/vnd.wap.wml"},
            {"wmlc", "application/vnd.wap.wmlc"},
            {"wmls", "text/vnd.wap.wmlscript"},
            {"wmlsc", "application/vnd.wap.wmlscriptc"},
            {"wrl", "model/vrml"},
            {"xbm", "image/x-xbitmap"},
            {"xht", "application/xhtml+xml"},
            {"xhtml", "application/xhtml+xml"},
            {"xls", "application/vnd.ms-excel"},                                                
            {"xml", "application/xml"},
            {"xpm", "image/x-xpixmap"},
            {"xsl", "application/xml"},
            {"xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},
            {"xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"},
            {"xlsm","application/vnd.ms-excel.sheet.macroEnabled.12"},
            {"xltm","application/vnd.ms-excel.template.macroEnabled.12"},
            {"xlam","application/vnd.ms-excel.addin.macroEnabled.12"},
            {"xlsb","application/vnd.ms-excel.sheet.binary.macroEnabled.12"},
            {"xslt", "application/xslt+xml"},
            {"xul", "application/vnd.mozilla.xul+xml"},
            {"xwd", "image/x-xwindowdump"},
            {"xyz", "chemical/x-xyz"},
            {"zip", "application/zip"}
        };
    }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-11-08T14:18:16.973

我发现这个很有用。对于 VB.NET 开发人员：

```
 Public Shared Function GetFromFileName(ByVal fileName As String) As String
        Return GetFromExtension(Path.GetExtension(fileName).Remove(0, 1))
    End Function

    Public Shared Function GetFromExtension(ByVal extension As String) As String
        If extension.StartsWith("."c) Then
            extension = extension.Remove(0, 1)
        End If

        If MIMETypesDictionary.ContainsKey(extension) Then
            Return MIMETypesDictionary(extension)
        End If

        Return "unknown/unknown"
    End Function

    Private Shared ReadOnly MIMETypesDictionary As New Dictionary(Of String, String)() From { _
         {"ai", "application/postscript"}, _
         {"aif", "audio/x-aiff"}, _
         {"aifc", "audio/x-aiff"}, _
         {"aiff", "audio/x-aiff"}, _
         {"asc", "text/plain"}, _
         {"atom", "application/atom+xml"}, _
         {"au", "audio/basic"}, _
         {"avi", "video/x-msvideo"}, _
         {"bcpio", "application/x-bcpio"}, _
         {"bin", "application/octet-stream"}, _
         {"bmp", "image/bmp"}, _
         {"cdf", "application/x-netcdf"}, _
         {"cgm", "image/cgm"}, _
         {"class", "application/octet-stream"}, _
         {"cpio", "application/x-cpio"}, _
         {"cpt", "application/mac-compactpro"}, _
         {"csh", "application/x-csh"}, _
         {"css", "text/css"}, _
         {"dcr", "application/x-director"}, _
         {"dif", "video/x-dv"}, _
         {"dir", "application/x-director"}, _
         {"djv", "image/vnd.djvu"}, _
         {"djvu", "image/vnd.djvu"}, _
         {"dll", "application/octet-stream"}, _
         {"dmg", "application/octet-stream"}, _
         {"dms", "application/octet-stream"}, _
         {"doc", "application/msword"}, _
         {"dtd", "application/xml-dtd"}, _
         {"dv", "video/x-dv"}, _
         {"dvi", "application/x-dvi"}, _
         {"dxr", "application/x-director"}, _
         {"eps", "application/postscript"}, _
         {"etx", "text/x-setext"}, _
         {"exe", "application/octet-stream"}, _
         {"ez", "application/andrew-inset"}, _
         {"gif", "image/gif"}, _
         {"gram", "application/srgs"}, _
         {"grxml", "application/srgs+xml"}, _
         {"gtar", "application/x-gtar"}, _
         {"hdf", "application/x-hdf"}, _
         {"hqx", "application/mac-binhex40"}, _
         {"htm", "text/html"}, _
         {"html", "text/html"}, _
         {"ice", "x-conference/x-cooltalk"}, _
         {"ico", "image/x-icon"}, _
         {"ics", "text/calendar"}, _
         {"ief", "image/ief"}, _
         {"ifb", "text/calendar"}, _
         {"iges", "model/iges"}, _
         {"igs", "model/iges"}, _
         {"jnlp", "application/x-java-jnlp-file"}, _
         {"jp2", "image/jp2"}, _
         {"jpe", "image/jpeg"}, _
         {"jpeg", "image/jpeg"}, _
         {"jpg", "image/jpeg"}, _
         {"js", "application/x-javascript"}, _
         {"kar", "audio/midi"}, _
         {"latex", "application/x-latex"}, _
         {"lha", "application/octet-stream"}, _
         {"lzh", "application/octet-stream"}, _
         {"m3u", "audio/x-mpegurl"}, _
         {"m4a", "audio/mp4a-latm"}, _
         {"m4b", "audio/mp4a-latm"}, _
         {"m4p", "audio/mp4a-latm"}, _
         {"m4u", "video/vnd.mpegurl"}, _
         {"m4v", "video/x-m4v"}, _
         {"mac", "image/x-macpaint"}, _
         {"man", "application/x-troff-man"}, _
         {"mathml", "application/mathml+xml"}, _
         {"me", "application/x-troff-me"}, _
         {"mesh", "model/mesh"}, _
         {"mid", "audio/midi"}, _
         {"midi", "audio/midi"}, _
         {"mif", "application/vnd.mif"}, _
         {"mov", "video/quicktime"}, _
         {"movie", "video/x-sgi-movie"}, _
         {"mp2", "audio/mpeg"}, _
         {"mp3", "audio/mpeg"}, _
         {"mp4", "video/mp4"}, _
         {"mpe", "video/mpeg"}, _
         {"mpeg", "video/mpeg"}, _
         {"mpg", "video/mpeg"}, _
         {"mpga", "audio/mpeg"}, _
         {"ms", "application/x-troff-ms"}, _
         {"msh", "model/mesh"}, _
         {"mxu", "video/vnd.mpegurl"}, _
         {"nc", "application/x-netcdf"}, _
         {"oda", "application/oda"}, _
         {"ogg", "application/ogg"}, _
         {"pbm", "image/x-portable-bitmap"}, _
         {"pct", "image/pict"}, _
         {"pdb", "chemical/x-pdb"}, _
         {"pdf", "application/pdf"}, _
         {"pgm", "image/x-portable-graymap"}, _
         {"pgn", "application/x-chess-pgn"}, _
         {"pic", "image/pict"}, _
         {"pict", "image/pict"}, _
         {"png", "image/png"}, _
         {"pnm", "image/x-portable-anymap"}, _
         {"pnt", "image/x-macpaint"}, _
         {"pntg", "image/x-macpaint"}, _
         {"ppm", "image/x-portable-pixmap"}, _
         {"ppt", "application/vnd.ms-powerpoint"}, _
         {"ps", "application/postscript"}, _
         {"qt", "video/quicktime"}, _
         {"qti", "image/x-quicktime"}, _
         {"qtif", "image/x-quicktime"}, _
         {"ra", "audio/x-pn-realaudio"}, _
         {"ram", "audio/x-pn-realaudio"}, _
         {"ras", "image/x-cmu-raster"}, _
         {"rdf", "application/rdf+xml"}, _
         {"rgb", "image/x-rgb"}, _
         {"rm", "application/vnd.rn-realmedia"}, _
         {"roff", "application/x-troff"}, _
         {"rtf", "text/rtf"}, _
         {"rtx", "text/richtext"}, _
         {"sgm", "text/sgml"}, _
         {"sgml", "text/sgml"}, _
         {"sh", "application/x-sh"}, _
         {"shar", "application/x-shar"}, _
         {"silo", "model/mesh"}, _
         {"sit", "application/x-stuffit"}, _
         {"skd", "application/x-koan"}, _
         {"skm", "application/x-koan"}, _
         {"skp", "application/x-koan"}, _
         {"skt", "application/x-koan"}, _
         {"smi", "application/smil"}, _
         {"smil", "application/smil"}, _
         {"snd", "audio/basic"}, _
         {"so", "application/octet-stream"}, _
         {"spl", "application/x-futuresplash"}, _
         {"src", "application/x-wais-source"}, _
         {"sv4cpio", "application/x-sv4cpio"}, _
         {"sv4crc", "application/x-sv4crc"}, _
         {"svg", "image/svg+xml"}, _
         {"swf", "application/x-shockwave-flash"}, _
         {"t", "application/x-troff"}, _
         {"tar", "application/x-tar"}, _
         {"tcl", "application/x-tcl"}, _
         {"tex", "application/x-tex"}, _
         {"texi", "application/x-texinfo"}, _
         {"texinfo", "application/x-texinfo"}, _
         {"tif", "image/tiff"}, _
         {"tiff", "image/tiff"}, _
         {"tr", "application/x-troff"}, _
         {"tsv", "text/tab-separated-values"}, _
         {"txt", "text/plain"}, _
         {"ustar", "application/x-ustar"}, _
         {"vcd", "application/x-cdlink"}, _
         {"vrml", "model/vrml"}, _
         {"vxml", "application/voicexml+xml"}, _
         {"wav", "audio/x-wav"}, _
         {"wbmp", "image/vnd.wap.wbmp"}, _
         {"wbmxl", "application/vnd.wap.wbxml"}, _
         {"wml", "text/vnd.wap.wml"}, _
         {"wmlc", "application/vnd.wap.wmlc"}, _
         {"wmls", "text/vnd.wap.wmlscript"}, _
         {"wmlsc", "application/vnd.wap.wmlscriptc"}, _
         {"wrl", "model/vrml"}, _
         {"xbm", "image/x-xbitmap"}, _
         {"xht", "application/xhtml+xml"}, _
         {"xhtml", "application/xhtml+xml"}, _
         {"xls", "application/vnd.ms-excel"}, _
         {"xml", "application/xml"}, _
         {"xpm", "image/x-xpixmap"}, _
         {"xsl", "application/xml"}, _
         {"xslt", "application/xslt+xml"}, _
         {"xul", "application/vnd.mozilla.xul+xml"}, _
         {"xwd", "image/x-xwindowdump"}, _
         {"xyz", "chemical/x-xyz"}, _
         {"zip", "application/zip"} _
        } 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-11-22T02:12:45.483

如果有人愿意，他们可以将优秀的 perl 模块[File::Type](http://search.cpan.org/~pmison/File-Type-0.22/lib/File/Type.pm)移植到 .NET。在代码中是一组文件头幻数查找每个文件类型或正则表达式匹配。

这是一个 .NET 文件类型检测库[http://filetypedetective.codeplex.com/](http://filetypedetective.codeplex.com/)但它目前只检测到少量文件。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-03-18T09:36:46.127

此答案是作者答案（Richard Gourlay）的副本，但根据 Rohland 指向[http://www.pinvoke.net的评论进行了改进以解决 IIS 8 / win2012 上的问题（其中功能会导致应用程序池崩溃） /default.aspx/urlmon.findmimefromdata](http://www.pinvoke.net/default.aspx/urlmon.findmimefromdata)

```
using System.Runtime.InteropServices; 
```

...

```
public static string GetMimeFromFile(string filename)
{

    if (!File.Exists(filename))
        throw new FileNotFoundException(filename + " not found");

    const int maxContent = 256;

    var buffer = new byte[maxContent];
    using (var fs = new FileStream(filename, FileMode.Open))
    {
        if (fs.Length >= maxContent)
            fs.Read(buffer, 0, maxContent);
        else
            fs.Read(buffer, 0, (int) fs.Length);
    }

    var mimeTypePtr = IntPtr.Zero;
    try
    {
        var result = FindMimeFromData(IntPtr.Zero, null, buffer, maxContent, null, 0, out mimeTypePtr, 0);
        if (result != 0)
        {
            Marshal.FreeCoTaskMem(mimeTypePtr);
            throw Marshal.GetExceptionForHR(result);
        }

        var mime = Marshal.PtrToStringUni(mimeTypePtr);
        Marshal.FreeCoTaskMem(mimeTypePtr);
        return mime;
    }
    catch (Exception e)
    {
        if (mimeTypePtr != IntPtr.Zero)
        {
            Marshal.FreeCoTaskMem(mimeTypePtr);
        }
        return "unknown/unknown";
    }
}

[DllImport("urlmon.dll", CharSet = CharSet.Unicode, ExactSpelling = true, SetLastError = false)]
private static extern int FindMimeFromData(IntPtr pBC,
    [MarshalAs(UnmanagedType.LPWStr)] string pwzUrl,
    [MarshalAs(UnmanagedType.LPArray, ArraySubType = UnmanagedType.I1, SizeParamIndex = 3)] byte[] pBuffer,
    int cbSize,
    [MarshalAs(UnmanagedType.LPWStr)] string pwzMimeProposed,
    int dwMimeFlags,
    out IntPtr ppwzMimeOut,
    int dwReserved); 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-06-06T19:25:37.800

@Steve Morgan 和 @Richard Gourlay 这是一个很好的解决方案，谢谢。一个小缺点是，当文件中的字节数为 255 或更低时，mime 类型有时会产生“application/octet-stream”，这对于预期会产生“text/plain”的文件来说有点不准确。我已更新您的原始方法以解决这种情况，如下所示：

如果文件中的字节数小于或等于 255，并且推导出的 mime 类型为“application/octet-stream”，则创建一个新的字节数组，该数组由重复 n 次直到总数的原始文件字节组成字节数 >= 256。然后重新检查该新字节数组上的 mime 类型。

修改方法：

```
Imports System.Runtime.InteropServices

<DllImport("urlmon.dll", CharSet:=CharSet.Auto)> _
Private Shared Function FindMimeFromData(pBC As System.UInt32, <MarshalAs(UnmanagedType.LPStr)> pwzUrl As System.String, <MarshalAs(UnmanagedType.LPArray)> pBuffer As Byte(), cbSize As System.UInt32, <MarshalAs(UnmanagedType.LPStr)> pwzMimeProposed As System.String, dwMimeFlags As System.UInt32, _
ByRef ppwzMimeOut As System.UInt32, dwReserverd As System.UInt32) As System.UInt32
End Function
Private Function GetMimeType(ByVal f As FileInfo) As String
    'See http://stackoverflow.com/questions/58510/using-net-how-can-you-find-the-mime-type-of-a-file-based-on-the-file-signature
    Dim returnValue As String = ""
    Dim fileStream As FileStream = Nothing
    Dim fileStreamLength As Long = 0
    Dim fileStreamIsLessThanBByteSize As Boolean = False

    Const byteSize As Integer = 255
    Const bbyteSize As Integer = byteSize + 1

    Const ambiguousMimeType As String = "application/octet-stream"
    Const unknownMimeType As String = "unknown/unknown"

    Dim buffer As Byte() = New Byte(byteSize) {}
    Dim fnGetMimeTypeValue As New Func(Of Byte(), Integer, String)(
        Function(_buffer As Byte(), _bbyteSize As Integer) As String
            Dim _returnValue As String = ""
            Dim mimeType As UInt32 = 0
            FindMimeFromData(0, Nothing, _buffer, _bbyteSize, Nothing, 0, mimeType, 0)
            Dim mimeTypePtr As IntPtr = New IntPtr(mimeType)
            _returnValue = Marshal.PtrToStringUni(mimeTypePtr)
            Marshal.FreeCoTaskMem(mimeTypePtr)
            Return _returnValue
        End Function)

    If (f.Exists()) Then
        Try
            fileStream = New FileStream(f.FullName(), FileMode.Open, FileAccess.Read, FileShare.ReadWrite)
            fileStreamLength = fileStream.Length()

            If (fileStreamLength >= bbyteSize) Then
                fileStream.Read(buffer, 0, bbyteSize)
            Else
                fileStreamIsLessThanBByteSize = True
                fileStream.Read(buffer, 0, CInt(fileStreamLength))
            End If

            returnValue = fnGetMimeTypeValue(buffer, bbyteSize)

            If (returnValue.Equals(ambiguousMimeType, StringComparison.OrdinalIgnoreCase) AndAlso fileStreamIsLessThanBByteSize AndAlso fileStreamLength > 0) Then
                'Duplicate the stream content until the stream length is >= bbyteSize to get a more deterministic mime type analysis.
                Dim currentBuffer As Byte() = buffer.Take(fileStreamLength).ToArray()
                Dim repeatCount As Integer = Math.Floor((bbyteSize / fileStreamLength) + 1)
                Dim bBufferList As List(Of Byte) = New List(Of Byte)
                While (repeatCount > 0)
                    bBufferList.AddRange(currentBuffer)
                    repeatCount -= 1
                End While
                Dim bbuffer As Byte() = bBufferList.Take(bbyteSize).ToArray()
                returnValue = fnGetMimeTypeValue(bbuffer, bbyteSize)
            End If
        Catch ex As Exception
            returnValue = unknownMimeType
        Finally
            If (fileStream IsNot Nothing) Then fileStream.Close()
        End Try
    End If
    Return returnValue
End Function 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-03-05T23:58:14.520

IIS 7 或更高版本

使用此代码，但您需要成为服务器上的管理员

```
public bool CheckMimeMapExtension(string fileExtension)
        {
            try
            {

                using (
                ServerManager serverManager = new ServerManager())
                {   
                    // connects to default app.config
                    var config = serverManager.GetApplicationHostConfiguration();
                    var staticContent = config.GetSection("system.webServer/staticContent");
                    var mimeMap = staticContent.GetCollection();

                    foreach (var mimeType in mimeMap)
                    {

                        if (((String)mimeType["fileExtension"]).Equals(fileExtension, StringComparison.OrdinalIgnoreCase))
                            return true;

                    }

                }
                return false;
            }
            catch (Exception ex)
            { 
                Console.WriteLine("An exception has occurred: \n{0}", ex.Message);
                Console.Read();
            }

            return false;

        } 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-10-16T10:48:04.993

当使用 Windows Azure Web 角色或在有限信任中运行您的应用程序的任何其他主机时，请不要忘记您将无权访问注册表或非托管代码。混合方法 - try-catch-for-registry 和内存字典的组合看起来像是一个很好的解决方案，它包含了所有的东西。

我使用这段代码来做到这一点：

```
public class DefaultMimeResolver : IMimeResolver
{
    private readonly IFileRepository _fileRepository;

    public DefaultMimeResolver(IFileRepository fileRepository)
    {
        _fileRepository = fileRepository;
    }

    [DllImport(@"urlmon.dll", CharSet = CharSet.Auto)]
    private static extern System.UInt32 FindMimeFromData(
        System.UInt32 pBC, [MarshalAs(UnmanagedType.LPStr)] System.String pwzUrl,
         [MarshalAs(UnmanagedType.LPArray)] byte[] pBuffer,
         System.UInt32 cbSize,
         [MarshalAs(UnmanagedType.LPStr)] System.String pwzMimeProposed,
         System.UInt32 dwMimeFlags,
         out System.UInt32 ppwzMimeOut,
         System.UInt32 dwReserverd);

    public string GetMimeTypeFromFileExtension(string fileExtension)
    {
        if (string.IsNullOrEmpty(fileExtension))
        {
            throw new ArgumentNullException("fileExtension");
        }

        string mimeType = GetMimeTypeFromList(fileExtension);

        if (String.IsNullOrEmpty(mimeType))
        {
            mimeType = GetMimeTypeFromRegistry(fileExtension);
        }

        return mimeType;
    }

    public string GetMimeTypeFromFile(string filePath)
    {
        if (string.IsNullOrEmpty(filePath))
        {
            throw new ArgumentNullException("filePath");
        }

        if (!File.Exists(filePath))
        {
            throw new FileNotFoundException("File not found : ", filePath);
        }

        string mimeType = GetMimeTypeFromList(Path.GetExtension(filePath).ToLower());

        if (String.IsNullOrEmpty(mimeType))
        {
            mimeType = GetMimeTypeFromRegistry(Path.GetExtension(filePath).ToLower());

            if (String.IsNullOrEmpty(mimeType))
            {
                mimeType = GetMimeTypeFromFileInternal(filePath);
            }
        }

        return mimeType;
    }

    private string GetMimeTypeFromList(string fileExtension)
    {
        string mimeType = null;

        if (fileExtension.StartsWith("."))
        {
            fileExtension = fileExtension.TrimStart('.');
        }

        if (!String.IsNullOrEmpty(fileExtension) && _mimeTypes.ContainsKey(fileExtension))
        {
            mimeType = _mimeTypes[fileExtension];
        }

        return mimeType;
    }

    private string GetMimeTypeFromRegistry(string fileExtension)
    {
        string mimeType = null;
        try
        {
            RegistryKey key = Registry.ClassesRoot.OpenSubKey(fileExtension);

            if (key != null && key.GetValue("Content Type") != null)
            {
                mimeType = key.GetValue("Content Type").ToString();
            }
        }
        catch (Exception)
        {
            // Empty. When this code is running in limited mode accessing registry is not allowed.
        }

        return mimeType;
    }

    private string GetMimeTypeFromFileInternal(string filePath)
    {
        string mimeType = null;

        if (!File.Exists(filePath))
        {
            return null;
        }

        byte[] byteBuffer = new byte[256];

        using (FileStream fileStream = _fileRepository.Get(filePath))
        {
            if (fileStream.Length >= 256)
            {
                fileStream.Read(byteBuffer, 0, 256);
            }
            else
            {
                fileStream.Read(byteBuffer, 0, (int)fileStream.Length);
            }
        }

        try
        {
            UInt32 MimeTypeNum;

            FindMimeFromData(0, null, byteBuffer, 256, null, 0, out MimeTypeNum, 0);

            IntPtr mimeTypePtr = new IntPtr(MimeTypeNum);
            string mimeTypeFromFile = Marshal.PtrToStringUni(mimeTypePtr);

            Marshal.FreeCoTaskMem(mimeTypePtr);

            if (!String.IsNullOrEmpty(mimeTypeFromFile) && mimeTypeFromFile != "text/plain" && mimeTypeFromFile != "application/octet-stream")
            {
                mimeType = mimeTypeFromFile;
            }
        }
        catch
        {
            // Empty. 
        }

        return mimeType;
    }

    private readonly Dictionary<string, string> _mimeTypes = new Dictionary<string, string>
        {
            {"ai", "application/postscript"},
            {"aif", "audio/x-aiff"},
            {"aifc", "audio/x-aiff"},
            {"aiff", "audio/x-aiff"},
            {"asc", "text/plain"},
            {"atom", "application/atom+xml"},
            {"au", "audio/basic"},
            {"avi", "video/x-msvideo"},
            {"bcpio", "application/x-bcpio"},
            {"bin", "application/octet-stream"},
            {"bmp", "image/bmp"},
            {"cdf", "application/x-netcdf"},
            {"cgm", "image/cgm"},
            {"class", "application/octet-stream"},
            {"cpio", "application/x-cpio"},
            {"cpt", "application/mac-compactpro"},
            {"csh", "application/x-csh"},
            {"css", "text/css"},
            {"dcr", "application/x-director"},
            {"dif", "video/x-dv"},
            {"dir", "application/x-director"},
            {"djv", "image/vnd.djvu"},
            {"djvu", "image/vnd.djvu"},
            {"dll", "application/octet-stream"},
            {"dmg", "application/octet-stream"},
            {"dms", "application/octet-stream"},
            {"doc", "application/msword"},
            {"docx", "application/vnd.openxmlformats-officedocument.wordprocessingml.document"},
            {"dotx", "application/vnd.openxmlformats-officedocument.wordprocessingml.template"},
            {"docm", "application/vnd.ms-word.document.macroEnabled.12"},
            {"dotm", "application/vnd.ms-word.template.macroEnabled.12"},
            {"dtd", "application/xml-dtd"},
            {"dv", "video/x-dv"},
            {"dvi", "application/x-dvi"},
            {"dxr", "application/x-director"},
            {"eps", "application/postscript"},
            {"etx", "text/x-setext"},
            {"exe", "application/octet-stream"},
            {"ez", "application/andrew-inset"},
            {"gif", "image/gif"},
            {"gram", "application/srgs"},
            {"grxml", "application/srgs+xml"},
            {"gtar", "application/x-gtar"},
            {"hdf", "application/x-hdf"},
            {"hqx", "application/mac-binhex40"},
            {"htc", "text/x-component"},
            {"htm", "text/html"},
            {"html", "text/html"},
            {"ice", "x-conference/x-cooltalk"},
            {"ico", "image/x-icon"},
            {"ics", "text/calendar"},
            {"ief", "image/ief"},
            {"ifb", "text/calendar"},
            {"iges", "model/iges"},
            {"igs", "model/iges"},
            {"jnlp", "application/x-java-jnlp-file"},
            {"jp2", "image/jp2"},
            {"jpe", "image/jpeg"},
            {"jpeg", "image/jpeg"},
            {"jpg", "image/jpeg"},
            {"js", "application/x-javascript"},
            {"kar", "audio/midi"},
            {"latex", "application/x-latex"},
            {"lha", "application/octet-stream"},
            {"lzh", "application/octet-stream"},
            {"m3u", "audio/x-mpegurl"},
            {"m4a", "audio/mp4a-latm"},
            {"m4b", "audio/mp4a-latm"},
            {"m4p", "audio/mp4a-latm"},
            {"m4u", "video/vnd.mpegurl"},
            {"m4v", "video/x-m4v"},
            {"mac", "image/x-macpaint"},
            {"man", "application/x-troff-man"},
            {"mathml", "application/mathml+xml"},
            {"me", "application/x-troff-me"},
            {"mesh", "model/mesh"},
            {"mid", "audio/midi"},
            {"midi", "audio/midi"},
            {"mif", "application/vnd.mif"},
            {"mov", "video/quicktime"},
            {"movie", "video/x-sgi-movie"},
            {"mp2", "audio/mpeg"},
            {"mp3", "audio/mpeg"},
            {"mp4", "video/mp4"},
            {"mpe", "video/mpeg"},
            {"mpeg", "video/mpeg"},
            {"mpg", "video/mpeg"},
            {"mpga", "audio/mpeg"},
            {"ms", "application/x-troff-ms"},
            {"msh", "model/mesh"},
            {"mxu", "video/vnd.mpegurl"},
            {"nc", "application/x-netcdf"},
            {"oda", "application/oda"},
            {"ogg", "application/ogg"},
            {"pbm", "image/x-portable-bitmap"},
            {"pct", "image/pict"},
            {"pdb", "chemical/x-pdb"},
            {"pdf", "application/pdf"},
            {"pgm", "image/x-portable-graymap"},
            {"pgn", "application/x-chess-pgn"},
            {"pic", "image/pict"},
            {"pict", "image/pict"},
            {"png", "image/png"},
            {"pnm", "image/x-portable-anymap"},
            {"pnt", "image/x-macpaint"},
            {"pntg", "image/x-macpaint"},
            {"ppm", "image/x-portable-pixmap"},
            {"ppt", "application/vnd.ms-powerpoint"},
            {"pptx", "application/vnd.openxmlformats-officedocument.presentationml.presentation"},
            {"potx", "application/vnd.openxmlformats-officedocument.presentationml.template"},
            {"ppsx", "application/vnd.openxmlformats-officedocument.presentationml.slideshow"},
            {"ppam", "application/vnd.ms-powerpoint.addin.macroEnabled.12"},
            {"pptm", "application/vnd.ms-powerpoint.presentation.macroEnabled.12"},
            {"potm", "application/vnd.ms-powerpoint.template.macroEnabled.12"},
            {"ppsm", "application/vnd.ms-powerpoint.slideshow.macroEnabled.12"},
            {"ps", "application/postscript"},
            {"qt", "video/quicktime"},
            {"qti", "image/x-quicktime"},
            {"qtif", "image/x-quicktime"},
            {"ra", "audio/x-pn-realaudio"},
            {"ram", "audio/x-pn-realaudio"},
            {"ras", "image/x-cmu-raster"},
            {"rdf", "application/rdf+xml"},
            {"rgb", "image/x-rgb"},
            {"rm", "application/vnd.rn-realmedia"},
            {"roff", "application/x-troff"},
            {"rtf", "text/rtf"},
            {"rtx", "text/richtext"},
            {"sgm", "text/sgml"},
            {"sgml", "text/sgml"},
            {"sh", "application/x-sh"},
            {"shar", "application/x-shar"},
            {"silo", "model/mesh"},
            {"sit", "application/x-stuffit"},
            {"skd", "application/x-koan"},
            {"skm", "application/x-koan"},
            {"skp", "application/x-koan"},
            {"skt", "application/x-koan"},
            {"smi", "application/smil"},
            {"smil", "application/smil"},
            {"snd", "audio/basic"},
            {"so", "application/octet-stream"},
            {"spl", "application/x-futuresplash"},
            {"src", "application/x-wais-source"},
            {"sv4cpio", "application/x-sv4cpio"},
            {"sv4crc", "application/x-sv4crc"},
            {"svg", "image/svg+xml"},
            {"swf", "application/x-shockwave-flash"},
            {"t", "application/x-troff"},
            {"tar", "application/x-tar"},
            {"tcl", "application/x-tcl"},
            {"tex", "application/x-tex"},
            {"texi", "application/x-texinfo"},
            {"texinfo", "application/x-texinfo"},
            {"tif", "image/tiff"},
            {"tiff", "image/tiff"},
            {"tr", "application/x-troff"},
            {"tsv", "text/tab-separated-values"},
            {"txt", "text/plain"},
            {"ustar", "application/x-ustar"},
            {"vcd", "application/x-cdlink"},
            {"vrml", "model/vrml"},
            {"vxml", "application/voicexml+xml"},
            {"wav", "audio/x-wav"},
            {"wbmp", "image/vnd.wap.wbmp"},
            {"wbmxl", "application/vnd.wap.wbxml"},
            {"wml", "text/vnd.wap.wml"},
            {"wmlc", "application/vnd.wap.wmlc"},
            {"wmls", "text/vnd.wap.wmlscript"},
            {"wmlsc", "application/vnd.wap.wmlscriptc"},
            {"wrl", "model/vrml"},
            {"xbm", "image/x-xbitmap"},
            {"xht", "application/xhtml+xml"},
            {"xhtml", "application/xhtml+xml"},
            {"xls", "application/vnd.ms-excel"},
            {"xml", "application/xml"},
            {"xpm", "image/x-xpixmap"},
            {"xsl", "application/xml"},
            {"xlsx", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"},
            {"xltx", "application/vnd.openxmlformats-officedocument.spreadsheetml.template"},
            {"xlsm", "application/vnd.ms-excel.sheet.macroEnabled.12"},
            {"xltm", "application/vnd.ms-excel.template.macroEnabled.12"},
            {"xlam", "application/vnd.ms-excel.addin.macroEnabled.12"},
            {"xlsb", "application/vnd.ms-excel.sheet.binary.macroEnabled.12"},
            {"xslt", "application/xslt+xml"},
            {"xul", "application/vnd.mozilla.xul+xml"},
            {"xwd", "image/x-xwindowdump"},
            {"xyz", "chemical/x-xyz"},
            {"zip", "application/zip"}
        };
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-28T05:20:36.013

我最终使用了 Netomatix 的 Winista MimeDetector。创建帐户后可以免费下载源代码：http: [//www.netomatix.com/Products/DocumentManagement/MimeDetector.aspx](http://www.netomatix.com/Products/DocumentManagement/MimeDetector.aspx)

```
MimeTypes g_MimeTypes = new MimeTypes("mime-types.xml");
sbyte [] fileData = null;

using (System.IO.FileStream srcFile = new System.IO.FileStream(strFile, System.IO.FileMode.Open))
{
    byte [] data = new byte[srcFile.Length];
    srcFile.Read(data, 0, (Int32)srcFile.Length);
    fileData = Winista.Mime.SupportUtil.ToSByteArray(data);
}

MimeType oMimeType = g_MimeTypes.GetMimeType(fileData); 
```

这是此处回答的另一个问题的一部分：[Urlmon.dll 中 FindMimeFromData 方法的替代方法，该方法具有更多 MIME 类型](https://stackoverflow.com/questions/15300567/alternative-to-findmimefromdata-method-in-urlmon-dll-one-which-has-more-mime-typ/15595571#15595571) 在我看来，此问题的最佳解决方案。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-12-05T07:59:25.290

我发现运行此代码的几个问题：

```
UInt32 mimetype;
FindMimeFromData(0, null, buffer, 256, null, 0, out mimetype, 0); 
```

如果您尝试使用 x64/Win10 运行它，您将得到

```
AccessViolationException "Attempted to read or write protected memory.
This is often an indication that other memory is corrupt" 
```

感谢这篇文章[PtrToStringUni 在 Windows 10](https://stackoverflow.com/questions/51037460/ptrtostringuni-doesnt-work-in-windows-10)和 @xanatos中不起作用

我修改了我的解决方案以在 x64 和 .NET Core 2.1 下运行：

```
 [DllImport("urlmon.dll", CharSet = CharSet.Unicode, ExactSpelling = true, 
    SetLastError = false)]
    static extern int FindMimeFromData(IntPtr pBC,
        [MarshalAs(UnmanagedType.LPWStr)] string pwzUrl,
        [MarshalAs(UnmanagedType.LPArray, ArraySubType=UnmanagedType.I1, 
        SizeParamIndex=3)]
        byte[] pBuffer,
        int cbSize,
        [MarshalAs(UnmanagedType.LPWStr)] string pwzMimeProposed,
        int dwMimeFlags,
        out IntPtr ppwzMimeOut,
        int dwReserved);

   string getMimeFromFile(byte[] fileSource)
   {
            byte[] buffer = new byte[256];
            using (Stream stream = new MemoryStream(fileSource))
            {
                if (stream.Length >= 256)
                    stream.Read(buffer, 0, 256);
                else
                    stream.Read(buffer, 0, (int)stream.Length);
            }

            try
            {
                IntPtr mimeTypePtr;
                FindMimeFromData(IntPtr.Zero, null, buffer, buffer.Length,
                    null, 0, out mimeTypePtr, 0);

                string mime = Marshal.PtrToStringUni(mimeTypePtr);
                Marshal.FreeCoTaskMem(mimeTypePtr);
                return mime;
            }
            catch (Exception ex)
            {
                return "unknown/unknown";
            }
   } 
```

谢谢

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-12-17T09:19:06.973

您好，我已将 Winista.MimeDetect 项目改编为 .net 核心/框架，并回退到 urlmon.dll 随意使用它：[nuget package](https://www.nuget.org/packages/Winista.MimeDetect)。

```
 //init
   var mimeTypes = new MimeTypes();

   //usage by filepath
   var mimeType1 = mimeTypes.GetMimeTypeFromFile(filePath); 
```

# asp.net - 单元测试 ASP.NET MVC 重定向

> ID：58513
> 
> 赞同：17
> 
> 时间：2008-09-12T08:38:29.043
> 
> 标签：asp.net, asp.net-mvc, unit-testing

如何对 MVC 重定向进行单元测试？

```
public ActionResult Create(Product product)
{
    _productTask.Save(product);
    return RedirectToAction("Success");   
}

public ActionResult Success()
{ 
     return View();
} 
```

[Ayende 的](http://www.ayende.com/Blog/archive/2007/12/13/Dont-like-visibility-levels-change-that.aspx)方法仍然是最好的方法吗，预览 5：

```
 public static void RenderView(this Controller self, string action) 
 {
    typeof(Controller).GetMethod("RenderView").Invoke(self,new object[] { action} ); 
 } 
```

必须这样做似乎很奇怪，尤其是当 MVC 团队表示他们正在编写可测试的框架时。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-12T12:29:02.860

```
[TestFixture]
public class RedirectTester
{
    [Test]
    public void Should_redirect_to_success_action()
    {
        var controller = new RedirectController();
        var result = controller.Index() as RedirectToRouteResult;
        Assert.That(result, Is.Not.Null);
        Assert.That(result.Values["action"], Is.EqualTo("success"));
    }
}

public class RedirectController : Controller
{
    public ActionResult Index()
    {
        return RedirectToAction("success");
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-01-26T15:27:03.423

这适用于使用 NUnit 的 ASP.NET MVC 5：

```
 [Test]
    public void ShouldRedirectToSuccessAction()
    {
        var controller = new RedirectController();
        var result = controller.Index() as RedirectToRouteResult;

        Assert.That(result.RouteValues["action"], Is.EqualTo("success"));
    } 
```

如果你想测试你正在重定向到不同的控制器（比如 NewController），断言将是：

```
Assert.That(result.RouteValues["controller"], Is.EqualTo("New")); 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-12T12:09:53.030

您可以对返回的 ActionResult 进行断言，您需要将其转换为适当的类型，但它确实允许您使用基于状态的测试。在 Web 上搜索应该会找到一些有用的链接，但这里[只是一个](http://sebastienlachance.com/2008/05/06/testing-controllers-in-aspnet-mvc-aka-actionresult/)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-06-16T22:05:38.470

您可以使用 Mvc.Contrib.TestHelper 提供用于测试重定向的断言。看看[http://kbochevski.blogspot.com/2010/06/unit-testing-mvcnet.html](http://kbochevski.blogspot.com/2010/06/unit-testing-mvcnet.html)和代码示例。这可能会有所帮助。

# .net - 组合枚举

> ID：58517
> 
> 赞同：29
> 
> 时间：2008-09-12T08:42:07.583
> 
> 标签：.net, vb.net, enums

有没有办法在 VB.net 中组合枚举？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-12T08:54:08.600

我相信你想要的是一个标志类型的枚举。

您需要将 Flags 属性添加到枚举的顶部，然后您可以将枚举与 'Or' 关键字组合在一起。

像这样：

```
<Flags()> _
Enum CombinationEnums As Integer
  HasButton = 1
  TitleBar = 2
  [ReadOnly] = 4
  ETC = 8
End Enum 
```

**注意：**右边的数字总是两倍大（2 的幂） - 这需要能够分离已设置的各个标志。

使用 Or 关键字组合所需的标志：

```
Dim settings As CombinationEnums
settings = CombinationEnums.TitleBar Or CombinationEnums.Readonly 
```

这会将 TitleBar 和 Readonly 设置为枚举

要检查已设置的内容：

```
If (settings And CombinationEnums.TitleBar) = CombinationEnums.TitleBar Then
  Window.TitleBar = True
End If 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T09:06:53.220

您可以使用 FlagsAttribute 来装饰 Enum，这样您就可以组合 Enum：

```
<FlagsAttribute> _
Public Enumeration SecurityRights
None = 0
Read = 1
Write = 2
Execute = 4 
```

然后像这样调用它们（UserPriviltes 类）：

```
Public Sub New ( _
    options As SecurityRights _
)

New UserPrivileges(SecurityRights.Read OR SecurityRights.Execute) 
```

它们有效地组合在一起（位数学），因此上述用户在一个花哨的 SecurityRights 变量中同时拥有 Read 和 Execute。

要检查用户是否有特权，您可以使用 AND（更多按位数学）来检查用户枚举值和您要检查的枚举值：

```
//Check to see if user has Write rights
If (user.Privileges And SecurityRights.Write = SecurityRigths.Write) Then
    //Do something clever...
Else
    //Tell user he can't write.
End If 
```

HTH，泰勒

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T08:49:11.577

如果您开始使用 enum flags()，这里有一篇很好的[文章](http://www.codeguru.com/vb/sample_chapter/article.php/c12963 "VB 标志")。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T08:50:36.923

如果我正确理解您的问题，您想组合不同的枚举类型。所以一个变量可以存储来自两个不同枚举之一的值，对吗？如果您询问存储组合一个枚举类型的两个不同值，您可以查看 Dave Arkell 的解释

枚举只是带有一些语法糖的整数。因此，如果您确保没有重叠，您可以通过转换为 int 来组合它们。

但它不会产生漂亮的代码。我大部分时间都尽量避免使用枚举。通常，如果您让枚举在您的代码中滋生，那么它们会产生重复的 case 语句和其他混乱的反模式只是时间问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T08:52:29.493

组合`Enum`s 的关键是确保该值是 2 的幂（1、2、4、8 等），以便您可以对它们执行位操作（`|=` `&=`）。这些`Enum`s 可以用`Flags`属性标记。Windows 窗体控件上的`Anchor`属性就是此类控件的一个示例。如果它被标记为标志，Visual Studio 将允许您检查值，而不是在属性设计器的下拉列表中选择单个值。

# version-control - 可交付成果的版本控制

> ID：58520
> 
> 赞同：4
> 
> 时间：2008-09-12T08:43:54.117
> 
> 标签：version-control, deployment

我们需要在多个不同位置的许多开发人员之间定期同步数十个二进制文件（项目可执行文件和 DLL），以便每个开发人员都有一个最新的环境来构建和测试。由于项目的性质，必须经常和按需进行更新（隔夜更新是不够的）。这并不漂亮，但我们坚持了一段时间。

我们决定使用常规版本（源代码）控制系统：将所有内容作为二进制文件放入其中，在测试前获取最新版本，并在测试后签入更新的 DLL。

它工作得很好，但是版本控制客户端有很多对我们没有意义的功能，人们有时会感到困惑。

有没有更适合这项任务的工具？或者可能是一种完全不同的方法？

**更新：**

我需要澄清一下，它不是一个紧密集成的项目——更像是具有大量“插件”的可扩展系统，包括第三方插件。我们需要确保这些模块插件能够很好地与彼此的最新版本和核心一起工作。最初考虑了建议的集中构建，但这不是一个选项。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T08:56:07.893

我可能会看看rsync。

只需创建一个 .CMD 文件，其中包含对 rsync 的调用以及所有正确的参数，然后让人们调用它。rsync 在决定需要传输文件的哪一部分时非常聪明，因此即使涉及大文件，它也会非常快。

rsync 不做的是解决冲突（甚至检测），但在您描述的场景中，它更像是从 rsync 旨在处理的中心位置读取。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T05:24:00.647

另一种选择是[统一](http://www.cis.upenn.edu/~bcpierce/unison/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T08:55:44.603

您应该研究持续集成并拥有某种集中的构建过程。我只能想象你目前的方法正在经历的那种地狱。

显然，这无助于保持本地文件同步，但我认为您的流程存在更大的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T05:19:18.693

[Subversion](http://subversion.tigris.org) handles binary files really well, is pretty fast, and scriptable. [VisualSVN](http://www.visualsvn.com/) and [TortoiseSVN](http://www.tortoisesvn.net) make dealing with Subversion very easy too.

You could set up a folder that's checked out from Subversion with all your binary files (that all developers can push and update to) then just type "svn update" at the command line, or use TortoiseSVN: right click on the folder, click "SVN Update" and it'll update all the files and tell you what's changed.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T09:46:48.303

构建项目应该是一个集中的过程，以便尽快进行更好的控制，从长远来看，您的解决方案将是 caos。无论如何，这就是我要做的。

*   为每个项目创建源文件、资源、文档等的常用存储库。
*   为资源创建一个存储库。每个项目都将有最新的二进制版本以及任何所需的资源、文件等。为每个项目保持良好的文件夹结构，以便开发人员可以直接“引用”文件。
*   为最终的构建创建一个存储库，它将保存实际的稳定版本。这将获得稳定的文件，以自动方式（如果可能）从签入的源中完成。这将包含真实的产品、用于集成测试的真实版本等。

虽然远非完美，但您将能够定义完善的协议。在此处签入您的最新 dll，在此处从最新源生成“真实”版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T09:48:10.670

在可执行文件和库中嵌入“what”字符串怎么样？然后，您可以将所需的版本列表与清单同步。

我们倾向于使用 CVS id 字符串作为 what 字符串的一部分。

`const char cvsid[] = "@(#)INETOPS_filter_ip_$Revision: 1.9 $";`

输入命令

`what filter_ip | grep INETOPS`

返回

`INETOPS_filter_ip_$Revision: 1.9 $`

我们对所有可交付成果执行此操作，以便我们可以查看库和可执行文件包中的版本是否与关联清单中的列表匹配。

HTH。

干杯，

抢

# wix - 如何使用 WiX 创建事件日志源

> ID：58538
> 
> 赞同：62
> 
> 时间：2008-09-12T09:09:47.177
> 
> 标签：wix, event-log, eventlog-source

我正在为使用自定义事件日志源的网站创建安装程序。我希望我们基于 WiX 的安装程序在安装期间创建该事件日志源。

有谁知道使用 WiX 框架执行此操作的最佳方法。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-09-12T11:01:18.797

Wix 为创建事件日志源提供了开箱即用的支持。

假设您使用 Wix 3，您首先需要向您的 Votive 项目或命令行添加对 WixUtilExtension 的引用。然后，您可以在组件下添加 EventSource 元素：

```
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

    <Component ...>
        ...
        <util:EventSource Log="Application" Name="*source name*"
           EventMessageFile="*path to message file*"/>
        ...
    </Component> 
```

如果这是一个 .NET 项目，您可以使用框架目录中的 EventLogMessages.dll 作为消息文件。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-22T00:52:53.470

只是为了节省一些时间 - 如果您尝试使用应用程序日志和 .NET 消息，您可以剪切粘贴以下代码：

```
<Util:EventSource
 xmlns:Util="http://schemas.microsoft.com/wix/UtilExtension"
 Name="ROOT Builder"
 Log="Application"
 EventMessageFile="%SystemRoot%\Microsoft.NET\Framework\v2.0.50727\EventLogMessages.dll"
/> 
```

注意：上面的路径现在是正确的..

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-02-17T13:47:10.663

内置更灵活的东西怎么样：

```
EventMessageFile="[NETFRAMEWORK20INSTALLROOTDIR]EventLogMessages.dll" 
```

或者

```
EventMessageFile="[NETFRAMEWORK40FULLINSTALLROOTDIR]EventLogMessages.dll" 
```

和

```
EventMessageFile="[NETFRAMEWORK40FULLINSTALLROOTDIR64]EventLogMessages.dll" 
```

# oracle - 使用 Oracle OLE DB 提供程序时如何解决 SQL 查询参数映射问题？

> ID：58540
> 
> 赞同：10
> 
> 时间：2008-09-12T09:12:56.870
> 
> 标签：oracle, ssis

尝试使用 Oracle OLE DB 提供程序输入带有参数的 SQL 查询时，出现以下错误：

> 无法从 SQL 命令中提取参数。提供程序可能无法帮助解析命令中的参数信息。在这种情况下，请使用“来自变量的 SQL 命令”访问模式，其中整个 SQL 命令都存储在一个变量中。
> 附加信息：
> 提供程序无法派生参数信息，并且尚未调用 SetParameterInfo。（适用于 Oracle 的 Microsoft OLE DB 提供程序）

我已经尝试按照这里的建议，但不太明白需要什么：[针对 Oracle 的参数化查询](http://microsoftdw.blogspot.com/2005/11/parameterized-queries-against-oracle.html)

有任何想法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-12T14:24:12.083

要扩展问题中给出的链接：

1.  创建包变量
2.  双击包变量名称。（这允许您访问变量的属性）
3.  将属性“EvaluateAsExpression”设置为 true
4.  在表达式生成器中输入查询。
5.  将 OLE DB 源查询设置为变量中的 SQL 命令

表达式构建器可以使用变量动态创建表达式以创建“参数化查询”。
所以下面的“正常”查询：

```
select * from book where book.BOOK_ID = ? 
```

可以在表达式生成器中写为：

```
"select * from book where book.BOOK_ID = " + @[User::BookID] 
```

然后，您可以使用表达式构建器进行空值处理和数据转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-07-20T10:25:29.710

如果您使用数据流任务并使用 OLE DB 源，并且您需要参数化您的查询：

1.  创建变量以保存“完整”的查询语句：右键单击包外的空白区域 - 然后单击变量：

[![变量](https://i.stack.imgur.com/yLvNJ.jpg)](https://i.stack.imgur.com/yLvNJ.jpg)

单击变量窗口上的添加变量：

[![在此处输入图像描述](https://i.stack.imgur.com/AgX1w.jpg)](https://i.stack.imgur.com/AgX1w.jpg)

使名称是`SQL_DTFLOW_FULL`或您可以轻松理解的名称。`variable data type`是_`STRING`

2.  创建变量以保存您的参数。

即，完整的查询语句是：

```
SELECT * FROM BOOK WHERE BOOK_ID = @BookID --@BookID is SQL Parameter 
```

在上面的示例中，我只有一个参数：@BookID，所以我需要创建一个变量来保存我的参数。添加更多变量取决于您的查询。

[![参数添加](https://i.stack.imgur.com/M4siL.jpg)](https://i.stack.imgur.com/M4siL.jpg)

给它起名字`SQL_DTFLOW_BOOKID`

`variable data type`是_`STRING`

因此，您需要使您的 SSIS 整洁，并且变量按可理解的部分进行排序。

尝试使变量名称为`SQL_{TASK NAME}_{VariableName}`

3.  为`SQL_DTFLOW_FULL`变量创建表达式，单击数字 1，然后开始填充数字 2。使用字符串块使您的 SQL 语句成为正确的 SQL 语句。字符串块通常在开头和结尾使用“双引号”。将变量与字符串块连接起来。

[![表达](https://i.stack.imgur.com/5UEVk.jpg)](https://i.stack.imgur.com/5UEVk.jpg)

单击评估表达式，以显示结果，以确保您的查询正确，将查询结果复制粘贴到 SSMS。

使用您自己的逻辑确保变量不受 SQL 注入的影响。（利用你的开发者直觉）

4.  打开数据流任务，双击项目打开 OLE DB 源编辑器。

[![数据流](https://i.stack.imgur.com/Vb3tM.jpg)](https://i.stack.imgur.com/Vb3tM.jpg)

*   选择数据访问模式：`SQL Command From Variable`
*   选择变量名称：`SQL_DTFLOW_FULL`
*   单击预览以确保其正常工作。

这就是我防止这种 SSIS 失败案例的全部方法。由于我使用这种方式，我从来没有遇到过这个问题，你知道，SSIS 有点奇怪。

`SQL_DTFLOW_FULL`要更改变量值，请在数据流任务之前设置它，每次更改变量值时，变量的 SQL 结果都会发生变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-09-24T13:12:44.357

就我而言，问题是我在 sql 中以 /* */ 的正常形式进行了注释，并且我也将列别名作为“列名”而不是 [列名]。

一旦我删除它们，它就可以工作。

也尝试有你的参数？WHERE 子句中而不是 JOINS 中的语句，这也是问题的一部分。

# html - - How to show the whole height of referenced page?

> ID：58543
> 
> 赞同：8
> 
> 时间：2008-09-12T09:18:11.210
> 
> 标签：html, iframe

I have an application that I would like to embed inside our companies CMS. The only way to do that (I am told), is to load it in an `<iframe>`.

Easy: just set `height` and `width` to `100%`! Except, it doesn't work.

I did find out about setting `frameborder` to `0`, so it at least *looks* like part of the site, but I'd prefer not to have an ugly scrollbar *inside* a page that allready has one.

Do you know of any tricks to do this?

**EDIT:** I think I need to clarify my question somewhat:

*   the company CMS displays the fluff and stuff for our whole website
*   most pages created through the CMS
*   my application isn't, but they will let me embedd it in an `<iframe>`
*   I have no control over the `iframe`, so any solution must work from the referenced page (according to the `src` attribute of the `iframe` tag)
*   the CMS displays a footer, so setting the height to 1 million pixels is not a good idea

Can I access the parent pages DOM from the referenced page? This might help, but I can see some people might not want this to be possible...

This technique seems to work ([gleaned](http://bytes.com/forum/thread91876.html) from several sources, but inspired by the [link](http://brondsema.net/blog/index.php/2007/06/06/100_height_iframe) from the accepted answer:

In parent document:

```
<iframe id="MyIFRAME" name="MyIFRAME" 
    src="http://localhost/child.html"
    scrolling="auto" width="100%" frameborder="0">
    no iframes supported...
</iframe> 
```

In child:

```
<!-- ... -->
<body>
<script type="text/javascript">
    function resizeIframe() {

        var docHeight;
        if (typeof document.height != 'undefined') {
            docHeight = document.height;
        }
        else if (document.compatMode && document.compatMode != 'BackCompat') {
            docHeight = document.documentElement.scrollHeight;
        }
        else if (document.body 
            && typeof document.body.scrollHeight != 'undefined') {
            docHeight = document.body.scrollHeight;
        }

        // magic number: suppress generation of scrollbars...
        docHeight += 20;

        parent.document.getElementById('MyIFRAME').style.height = docHeight + "px";    
    }
    parent.document.getElementById('MyIFRAME').onload = resizeIframe;
    parent.window.onresize = resizeIframe;
</script>               
</body> 
```

**BTW:** This will only work if parent and child are in the same domain due to a restriction in JavaScript for security reasons...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T09:28:50.500

You could either just use a scripting language to include the page into the parent page, other wise, you might want to try one of these javascript methods:

[http://brondsema.net/blog/index.php/2007/06/06/100_height_iframe](http://brondsema.net/blog/index.php/2007/06/06/100_height_iframe) [http://www.experts-exchange.com/Web_Development/Web_Languages-Standards/PHP/Q_22840093.html](http://www.experts-exchange.com/Web_Development/Web_Languages-Standards/PHP/Q_22840093.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T09:55:33.773

Provided that your iframe is hosted on the same server as the containing page, you can [access it via javascript](http://www.esqsoft.com/javascript_examples/iframe_talks_to_parent/).

There are a number of suggested methods for [setting the iframe to the full height of the contents](http://www.programmersheaven.com/2/FAQ-JavaScript-Set-Iframe-Width-Height-Onload), each with varying degrees of success - a google for this problem shows that it's quite a common one, with no real, one-size-fits-all consensus solution i'm afraid!

Several people have reported that [this script](http://www.dynamicdrive.com/dynamicindex17/iframessi2.htm) does the trick, but may need [some modification](http://www.daniweb.com/forums/post258858-4.html) for your specific case (again, assuming your iframe and parent page are on the same domain).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T09:35:11.343

I might be missing something here, but adding `scrolling=no` as an attribute to the `iframe` tag normally gets rid of the scrollbars.

# java - java中的无痛资源管理

> ID：58547
> 
> 赞同：6
> 
> 时间：2008-09-12T09:24:49.603
> 
> 标签：java, resources

在 C++ 中，我们在构造函数中获取资源并在析构函数中释放它。

因此，当函数中间出现异常时，不会出现资源泄漏或锁定互斥锁或其他任何情况。

AFAIK java 类没有析构函数。那么如何在Java中进行资源管理。

例如：

```
public int foo() {    
    Resource f = new Resource();
    DoSomething(f);
    f.Release();
} 
```

如果 DoSomething 抛出异常，如何释放资源？我们不能在整个代码中放置 try\catch 块，可以吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T09:27:57.007

是的，您可以并且应该在代码周围放置 try/catch/finally 块。在 C# 中有一个简写的“使用”语句，但在 Java 中你会遇到：

```
public int foo() {
    Resource f = new Resource();
    try {
        DoSomething(f);
    }
    finally {
        f.Release();
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-10-23T13:15:43.040

这个问题可以追溯到 2008 年，因此与 Java 6 有关。从那时起，Java 7 已经发布，其中包含自动资源管理的新功能。有关与 Java 7 相关的最新问题，请参阅此问题：

[自动资源释放的java技术？“及时清理”？](https://stackoverflow.com/questions/6628611/java-techniques-for-automatic-resource-release-prompt-cleanup)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T12:28:25.107

可以使用 Execute around idiom 来分解 try/finally（以及异常和算法）。但是语法非常冗长。

```
public int foo() {
    withResource(new WithResource() { public void run(Resource resource) {
        doSomething(resource);
    }});
}

...

public interface WithResource {
    void run(Resource resource);
}

public static void withResource(WithResource handler) {
    Resource resource = new Resource();
    try {
        handler.run(resource);
    } finally {
        resource.release();
    }
} 
```

如果你抽象的比 try/finally 更多，这种事情会更有意义。例如，使用 JDBC，您可以执行语句、遍历结果、关闭资源并包装异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T09:35:12.620

如果您希望 using 块参与 Java 闭包辩论：S

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-12T09:45:59.037

很抱歉让您失望了，但在 Java 中，我们**确实**使用 try\catch\finally 阻塞了很多。对于“很多”，我的意思是**A LOT**。我有时确实希望 Java 有 C# using 块。大多数情况下，您不需要释放资源，因为 Java 的垃圾收集器会处理这些问题。

但是，异常确实可以使错误处理更加清晰。您可以编写自己的异常并在您正在执行的任何操作中捕获它们。不再向用户返回任意错误代码！

# eclipse - 如何配置 Firebug 以使用 Eclipse/Netbeans 作为编辑器

> ID：58551
> 
> 赞同：4
> 
> 时间：2008-09-12T09:27:47.600
> 
> 标签：eclipse, netbeans, firebug

我想使用真正的 IDE 结合 Firebug 来编辑 javascript 文件。在 Firebug 的“添加编辑器”对话框中，我可以指定可执行文件和参数。所以问题实际上是如何从命令行在 Eclipse/Netbeans 中打开文件。

允许我在打开新的 Eclipse/netbeans 实例和重用已经运行的实例之间进行选择的额外积分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T12:45:15.223

恐怕不是一个确切的答案，但这些信息可能会有所帮助。

[Eclipse 帮助 - 运行 Eclipse](http://help.eclipse.org/help21/index.jsp?topic=/org.eclipse.platform.doc.user/tasks/running_eclipse.htm)
[Fireclipse：从 FF 直接调试到 Eclipse](http://ajaxian.com/archives/fireclipse-debug-from-ff-straight-into-eclipse)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T23:24:18.830

我还没有尝试过，但看起来很有趣[Javascript Debug Toolkit 2.0.0](http://code.google.com/p/jsdt/wiki/newFeatures)

我也听说[aptana](http://www.aptana.com/)很不错

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-12T14:33:26.997

有没有想过反过来呢？这意味着要启动 eclipse，启动一个包含 Firebug 的调试会话？

如果这可能是一个答案，请参阅为[Aptana Studio](http://www.aptana.com/studio)[安装 JavaScript 调试](http://www.aptana.com/docs/index.php/Installing_the_JavaScript_debugger)器下的说明。有一个选项可以在 eclipse 中安装 Aptana，而不是加载整个东西。

**警告：**我从未尝试过，但我目前使用 Aptana 来编写 Rails，也许我会在不久的将来使用它。

# c++ - 如何调整 Eclipse 的 C++ 索引器？

> ID：58554
> 
> 赞同：2
> 
> 时间：2008-09-12T09:28:55.287
> 
> 标签：c++, eclipse, eclipse-cdt, indexer, lazy-c++

我使用 Eclipse 作为我的 C++ 项目的 IDE，我希望它告诉我给定符号的定义位置以及函数的参数是什么。

但是，有一个问题：我还使用[Lazy C++](http://www.lazycplusplus.com/)，这是一个采用单个源文件并生成 .h 和 .cpp 文件的工具。这些 .lzz 文件看起来像头文件，但这个工具支持一些非常温和的语法优势，比如将嵌套的命名空间组合成一个限定名称。此外，它有一些特殊的标签来告诉工具具体放在哪里（在头文件或源文件中）。

所以我典型的 SourceFile.lzz 看起来像这样：

```
$hdr
#include <iosfwd>
#include "ProjectA/BaseClass.h"
$end

$src
#include <iostream>
#include "ProjectB/OtherClass.h"
$end

// Forward declarations
namespace BigScope::ProjectB
{
  class OtherClass;
}

namespace BigScope::ProjectA
{
  class MyClass : public ProjectA::BaseClass
  {
    void SomeMethod(const ProjectB::OtherClass& Foo) { }
  }
} 
```

如您所见，它仍然是可识别的 C++，但有一些附加功能。

出于某种原因，CDT 的索引器似乎不想索引任何东西，我也不知道出了什么问题。在索引器视图中，它向我显示了一棵空树，但告诉我它有大约 15000 个符号和更多内容，我似乎无法访问这些内容。

所以这是我的**问题**：我怎样才能让索引器输出更多关于它正在做什么以及为什么它会失败的信息，我可以调整它而不只是使用 GUI 可访问的选项吗？

谢谢，

卡尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-12T15:16:52.597

我想它是其中之一：

*   Eclipse 不想在树中显示非 C++ 资源（我有这个问题）

*   您没有启用“首选项 > C/C++ > 索引器 > 索引所有文件”。

*   您想使用“Full C/C++ Indexer”而不是“Fast C/C++ Indexer”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T20:59:53.777

CDT 解析器/索引器无法识别这样的奇怪扩展。您唯一能做的就是在 Paths and Symbols 属性页上定义宏来欺骗解析器。`$hdr`尝试为,`$end`和`$src`空体创建宏。这样预处理器将删除它们并且解析器不会阻塞它们。

# windows - 如何远程获取 Windows 机器上文件的校验和？

> ID：58558
> 
> 赞同：0
> 
> 时间：2008-09-12T09:31:40.163
> 
> 标签：windows, jakarta-ee, wmi, checksum

我正在尝试使用自动发现工具检查远程 J2EE 应用程序服务器中的 JAR 文件何时更改了内容。目前，系统使用 WMI 下载整个 JAR 以在本地对其进行校验，这对于大型 JAR 来说速度很慢。

对于 UNIXy 服务器（和带有 Cygwin 的 Windows 服务器），我可以通过 SSH 登录并运行`md5sum foo.jar`. 理想情况下，我想避免在远程服务器上安装额外的软件（可能有数千个），那么有没有一种在普通 Windows 服务器上执行此操作的好方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T09:39:57.820

你可以试试[Sysinternals PSExec 工具](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)。您需要远程机器上可用的校验和实用程序。不幸的是，自从他们成为微软的一部分后，他们没有提供任何源代码。

或者，您可以在远程机器上安装 Cygwin SSH 守护程序并使用 ssh，但这有点复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T10:35:28.217

Microsoft 有一个[免费的校验和工具](http://www.microsoft.com/downloads/details.aspx?FamilyID=B3C93558-31B7-47E2-A663-7365C1686C08&displaylang=en)，您可以使用上面的 PSExec 运行。

# hibernate - 如何使用休眠条件仅返回对象的一个 元素而不是整个对象？

> ID：58561
> 
> 赞同：36
> 
> 时间：2008-09-12T09:33:55.790
> 
> 标签：hibernate, criteria

例如，我试图只获取对象 bob 的 id 列表，而不是 bob 的列表。可以使用 HQL 请求，但我会知道是否可以使用条件？

一个例子 ：

```
final StringBuilder hql = new StringBuilder();
hql.append( "select bob.id from " )
    .append( bob.class.getName() ).append( " bob " )
    .append( "where bob.id > 10");

final Query query = session.createQuery( hql.toString() );
return query.list(); 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-12T10:28:12.510

我认为您可以使用 Projections 来做到这一点，例如

```
Criteria.forClass(bob.class.getName())
        .add(Restrictions.gt("id", 10))
        .setProjection(Projections.property("id"))
        ); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-06-15T22:12:58.203

同样，您还可以：

```
Criteria criteria = session.createCriteria(bob.class);

criteria.add(Expression.gt("id", 10));

criteria.setProjection(Projections.property("id"));

criteria.addOrder(Order.asc("id"));

return criteria.list(); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-12T13:52:29.150

或 setProjection(Projections.id())

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-23T11:02:04.437

[http://www.devarticles.com/c/a/Java/Hibernate-Criteria-Queries-in-Depth/2/](http://www.devarticles.com/c/a/Java/Hibernate-Criteria-Queries-in-Depth/2/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-08-21T04:05:11.950

```
SessionFactory sessionFactory;    
Criteria crit=sessionFactory.getCurrentSession().createCriteria(Model.class);
crit.setProjection(Projections.property("id"));
List result = crit.list(); 
```

此代码将为您提供模型类中的 id 列表，例如`[1,2,3]`. 如果您想获取数组列表，请`[{"id":1},{"id":2}]`使用以下代码

```
SessionFactory sessionFactory;    
Criteria crit=sessionFactory.getCurrentSession().createCriteria(Model.class); 
crit.setProjection(Projections.property("id").as("id")); 
List result = crit.setResultTransformer(Criteria.ALIAS_TO_ENTITY_MAP).list(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-16T18:30:34.753

另一种选择（虽然有点不像休眠）是使用“原始”sql，如下所示：

```
List<Long> myList = session.createSQLQuery("select single_column from table_name")
          .addScalar("single_column", StandardBasicTypes.LONG).list(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-05-13T06:43:37.637

你可以这样做

```
 bob bb=null;

    Criteria criteria = session.createCriteria(bob.class);  
    criteria.add(Restrictions.eq("id",id));

    bb = (bob) criteria.uniqueResult(); 
```

作为限制，您可以添加您的条件

# linux - Linux 上的核心转储文件：如何获取打开文件的信息？

> ID：58564
> 
> 赞同：35
> 
> 时间：2008-09-12T09:38:38.667
> 
> 标签：linux, crash, coredump

我有一个来自可能存在文件描述符泄漏的进程的核心转储文件（它打开文件和套接字，但显然有时忘记关闭其中一些）。有没有办法找出进程在崩溃之前打开了哪些文件和套接字？我无法轻易重现崩溃，因此分析核心文件似乎是获得错误提示的唯一方法。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-15T18:43:05.913

如果您有一个核心文件并且您已经使用调试选项 (-g) 编译了程序，您可以看到核心转储的位置：

```
$ gcc -g -o something something.c
$ ./something
Segmentation fault (core dumped)
$ gdb something core 
```

您可以使用它来进行一些事后调试。一些 gdb 命令：bt 打印堆栈，fr 跳转到给定的堆栈帧（参见 bt 的输出）。

现在，如果您想查看在分段错误时打开了哪些文件，只需处理 SIGSEGV 信号，然后在处理程序中，只需转储 /proc/PID/fd 目录的内容（即使用 system('ls -l /proc /PID/fs') 或 execv)。

有了这些信息，您可以轻松找到导致崩溃的原因、打开了哪些文件以及崩溃和文件描述符泄漏是否相关。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-12T13:55:25.630

您最好的选择是为任何使您的程序崩溃的信号（SIGSEGV 等）安装一个信号处理程序。

然后，在信号处理程序中，检查 /proc/self/fd，并将内容保存到文件中。以下是您可能会看到的示例：

```
Anderson cxc # ls -l  /proc/8247/fd
total 0
lrwx------ 1 root root 64 Sep 12 06:05 0 -> /dev/pts/0
lrwx------ 1 root root 64 Sep 12 06:05 1 -> /dev/pts/0
lrwx------ 1 root root 64 Sep 12 06:05 10 -> anon_inode:[eventpoll]
lrwx------ 1 root root 64 Sep 12 06:05 11 -> socket:[124061]
lrwx------ 1 root root 64 Sep 12 06:05 12 -> socket:[124063]
lrwx------ 1 root root 64 Sep 12 06:05 13 -> socket:[124064]
lrwx------ 1 root root 64 Sep 12 06:05 14 -> /dev/driver0
lr-x------ 1 root root 64 Sep 12 06:05 16 -> /temp/app/whatever.tar.gz
lr-x------ 1 root root 64 Sep 12 06:05 17 -> /dev/urandom 
```

然后你可以从你的信号处理程序返回，你应该像往常一样得到一个核心转储。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-12-19T01:09:11.687

我跳转到此信息的方法之一就是`strings`在核心文件上运行。例如，当我最近在核心上运行文件时，由于文件夹的长度，我会得到一个截断的参数列表。我知道我的运行会从我的主目录打开文件，所以我只是运行：

```
strings core.14930|grep jodie 
```

但这是一个我有一根针和一个干草堆的例子。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-12T09:53:50.500

您可以尝试使用`strace`来查看`open`,`socket`并`close`调用程序。

编辑：我认为您无法从核心获取信息；最多它会在某个地方有文件描述符，但这仍然没有给你实际的文件/套接字。（假设您可以区分打开和关闭的文件描述符，我也对此表示怀疑。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T10:15:05.363

如果程序忘记关闭这些资源，可能是因为发生了以下情况：

```
fd = open("/tmp/foo",O_CREAT);
//do stuff
fd = open("/tmp/bar",O_CREAT); //Oops, forgot to close(fd) 
```

现在我不会在内存中拥有 foo 的文件描述符。

如果这没有发生，您可能能够找到文件描述符编号，但话又说回来，这不是很有用，因为它们在不断变化，当您开始调试时，您将不知道它实际上意味着哪个文件当时。

我真的认为您应该使用 strace、lsof 和朋友来现场调试。

如果有办法从核心转储中做到这一点，我也很想知道它:-)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-09-16T15:40:49.903

最近在我的错误故障排除和分析过程中，我的客户向我提供了一个在他的文件系统中生成的 coredump，他离开站以便快速扫描文件并读取其内容我使用了命令

字符串 core.67545 > coredump.txt，后来我能够在文件编辑器中打开文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-12T09:50:07.610

核心转储是进程在崩溃时可以访问的内存的副本。根据泄漏的发生方式，它可能丢失了对句柄的引用，因此它可能被证明是无用的。

lsof 列出系统中所有当前打开的文件，您可以检查其输出以查找泄漏的套接字或文件。是的，您需要运行该过程。您可以使用特定的用户名运行它，以轻松识别您正在调试的进程中哪些是打开的文件。

我希望其他人有更好的信息:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T09:56:03.210

另一种找出进程打开了哪些文件的方法 - 再次，仅在运行时 - 是查看 /proc/PID/fd/ ，其中包含打开文件的符号链接。

# vim - 在 Vim 中，选择、删除或注释掉大部分多屏文本的最佳方法是什么？

> ID：58584
> 
> 赞同：25
> 
> 时间：2008-09-12T09:56:51.447
> 
> 标签：vim, vi

在像 Eclipse 这样的 IDE 中选择大量跨越多个屏幕的文本相当容易，因为您可以使用鼠标，但是选择和删除多屏幕文本块或将三个大型方法写入另一个的最佳方法是什么文件，然后在无法使用鼠标的情况下通过 putty/ssh 使用 Vim 时将其删除以进行测试？

我可以轻松地拖到行尾或拖到代码块的末尾，但是如果文本延伸到许多屏幕上，或者里面有很多空行，我觉得我的双手被 Vim 捆绑。有什么解决办法吗？

还有一个相关的问题：有没有办法以某种方式选择 40 行，然后将它们全部注释掉（使用“#”或“//”），这在大多数 IDE 中很常见？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-12T10:02:39.373

好吧，首先，您可以设置`vim`为使用鼠标，这将允许您像在`Eclipse`.

您也可以使用 Visual selection - `v`，默认情况下。选择后，您可以`yank`,`cut`等。

至于注释掉块，我通常用 选择它`VISUAL`，然后做

```
:'<,'>s/^/# / 
```

将每行的开头替换为`#`. （`'<`和`'>`标记是视觉选择的开始和和。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-12T10:18:04.717

使用标记。

转到要删除的文本块的顶部并输入

```
ma 
```

在那条线上的任何地方。不需要结肠。

然后转到块的末尾并输入以下内容：

```
:'a,.d 
```

Entering为光标下的字符`ma`设置了标记。`a`

移动到文本块底部后输入的命令显示“从包含标记`a`( `'``a`) 描述的字符的行到当前行 ( `.`) `d`elete。”

这种东西也可以用于其他事情。

```
:'a,.ya b     - yank from 'a to current line and put in buffer 'b'
:'a,.ya B     - yank from 'a to current line and append to buffer 'b'
:'a,.s/^/#/   - from 'a to current line, substitute '#' for line begin
(i.e. comment out in Perl)
:'s,.s#^#//#  - from 'a to current line, substitute '//' for line begin
(i.e. comment out in C++) 
```

**NB** `'a`（撇号-a）是指包含由 标记的字符的行`a`。`一个`(backtick-a) refers to the character marked by``。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-12T11:29:26.357

`CTRL`要插入注释，请使用-选择行的开头字符`v`（按块视觉，而不是“v”字符逐行视觉或“V”逐行视觉）。然后使用“I”进入插入模式，在第一行输入您的注释字符（例如“#”），最后使用“Esc”进入正常模式。瞧！

要删除评论，请使用 blockwise-visual 选择评论并使用“ `x`”删除它们。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-12T10:01:05.180

使用可视块命令 v （或 V 用于整行和`C`-`V`用于矩形块）。在视觉块模式下，您可以使用任何运动命令，包括搜索；我经常使用 } 跳到下一个空白行。标记块后，您可以将其 :w 写入文件、删除、拉动或其他任何方式。如果您执行命令并且视觉块消失，请使用 gv 重新选择相同的块。有关更多信息，请参阅 :help visual-change。

我认为 vim 附带了一些特定于语言的脚本，这些脚本可以以适合您选择的语言的方式执行诸如注释代码块之类的操作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-12T10:05:37.557

按`V`（大写 V）然后按`40j`选择 40 行，然后按`d`删除它们。或者正如@zigdon 回复的那样，您可以将它们注释掉。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-12T10:12:16.183

视觉模式是您主要问题的解决方案。至于注释掉代码段，vim.org上有很多插件，我现在用的是tComment.vim。

还有一种巧妙的方法可以在没有插件的情况下注释掉一个块。假设您在 python 中工作，# 是注释字符。对您希望井号所在的列进行可视化块选择，然后键入 I#ESCAPE。要进入可视块模式，请在 windows 上按 Cq 或在 linux 上按 Cv。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-12T12:57:01.997

我的块评论技术：

`Ctrl`+`V` 开始分块视觉模式。

做出你的选择。

在选择仍处于活动状态时，`Shift`+ `I`。这使您进入列插入模式。

键入您的注释字符“#”或“//”或其他任何内容。

ESC键。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-12T11:06:05.227

或者你可能想试试这个脚本......

[http://www.vim.org/scripts/script.php?script_id=23](http://www.vim.org/scripts/script.php?script_id=23)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-20T18:08:39.580

对于注释行，我建议使用以下插件之一：

[增强评论](http://www.vim.org/scripts/script.php?script_id=23)

[书呆子评论者](http://www.vim.org/scripts/script.php?script_id=1218)

这些天我发现自己更多地使用 NERD，但我已经使用 EnhancedCommentify 多年了。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-12T10:01:37.533

使用`Shift`+`V`进入可视模式，然后您可以选择行并删除/更改它们。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-18T09:26:23.110

如果您想对一系列行执行操作，并且您知道行号，则可以将该范围放在命令行上。例如，要删除第 20 到 200 行，您可以执行以下操作：

```
:20,200d 
```

要将第 20 行到 200 行移动到第 300 行所在的位置，您可以使用：

```
:20,200m300 
```

等等。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-15T18:38:41.043

我通常注释掉 40 行的方法是将光标放在第一行并输入命令：

:.,+40s/^/# /

（这里向前 40 行，用散列、空格替换行首）似乎比其他一些建议的方法长一点，但我喜欢用键盘而不是鼠标来做事。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-08T15:40:36.330

您应该知道正常模式命令 [count] `CTRL`- `D`。它可以选择将 'scroll' 选项从 10 更改为 [count]，然后向下滚动那么多行。再次按`CTRL`-`D`将再次向下滚动相同的行。

所以尝试输入

```
V     "visual line selection mode
30    "optionally set scroll value to 30
CTRL-D  "jump down a screen, repeated as necessary
y      " yank your selection 
```

CTRL-U 的工作方式相同，但向上滚动。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-06-09T16:27:47.317

第一个答案目前不太正确？要注释掉选择，请按 ':' 并输入命令 :'<,'>s/^/# /g

('<, '> - 会自动出现)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-12T10:03:43.630

v 进入可视块模式，您可以在其中像在大多数常用编辑器中使用 shift 一样进行选择，稍后您可以使用普通命令执行通常可以执行的任何操作（替换 :'<,'>s/^/#/ 以添加注释, 例如) 其中 '<,'> 表示选定的视觉块而不是所有文本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-15T18:46:40.307

标记将是您想要开始的最简单的**mb ，而****我**是您想要结束的地方，一旦完成，您几乎可以做任何您想做的事情

```
:'b,'ed 
```

**从标记b**删除到标记**e**

在可视模式下注释掉 40 行

```
V40j:s/^/#/ 
```

将从你开始序列的地方注释掉 40 行

# linux - 测量 Linux 多线程应用程序的堆栈使用情况

> ID：58614
> 
> 赞同：6
> 
> 时间：2008-09-12T10:19:53.450
> 
> 标签：linux, multithreading, stack

我正在为 Linux 嵌入式平台开发一个多线程应用程序。

目前，我将每个线程的堆栈大小（通过 pthread_set_attr）设置为一个相当大的默认值。我想将每个线程的值微调为更小的值，以减少我的应用程序的内存使用量。我可以通过反复试验将每个线程的堆栈大小设置为逐渐减小的值，直到程序崩溃，但是应用程序使用约 15 个线程，每个线程具有完全不同的功能/属性，因此这种方法非常耗时。

我更喜欢能够直接测量每个线程的堆栈使用情况。是否有一些实用人员可以推荐这样做？（例如，我来自 vxWorks 背景，使用 vxWorks shell 中的 'ti' 命令直接提供堆栈使用情况的统计信息以及有关任务状态的其他有用信息。）

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2015-03-04T13:44:23.380

这里有两个工具可以测量 Linux 应用程序中（本机 pthread）堆栈的使用情况：

*   [瓦尔格林德](http://valgrind.org "瓦尔格林德")
*   [堆栈使用](https://github.com/d99kris/stackusage "堆栈使用")

**瓦尔格林德**

用法：

```
valgrind --tool=drd --show-stack-usage=yes PROG 
```

Valgrind 是一个稳定而强大的工具，不仅用于测量堆栈使用情况。但它可能不支持所有嵌入式 CPU 型号。

**堆栈使用**

用法：

```
stackusage PROG 
```

Stackusage 是一个轻量级工具，专为测量线程堆栈使用情况而设计，对于大多数配备 glibc 的嵌入式 Linux 平台来说应该是可移植的。在这一点上，它可能不像 Valgrind/drd 那样经过充分测试或成熟。

完全披露：我是 Stackusage 的作者。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T10:30:09.260

我不知道有什么好的工具，但作为最后的手段，您可以在应用程序中包含一些代码来检查它，类似于以下内容：

```
__thread void* stack_start;
__thread long stack_max_size = 0L;

void check_stack_size() {
  // address of 'nowhere' approximates end of stack
  char nowhere;
  void* stack_end = (void*)&nowhere;
  // may want to double check stack grows downward on your platform
  long stack_size = (long)stack_start - (long)stack_end;
  // update max_stack_size for this thread
  if (stack_size > stack_max_size)
    stack_max_size = stack_size;
} 
```

check_stack_size() 函数必须在一些嵌套最深的函数中调用。

然后作为线程中的最后一条语句，您可以将 stack_max_size 输出到某处。

stack_start 变量必须在线程开始时初始化：

```
void thread_proc() {
  char nowhere;
  stack_start = (void*)&nowhere;
  // do stuff including calls to check_stack_size()
  // in deeply nested functions
  // output stack_max_size here
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T13:38:25.050

参考 Tobi 的回答：`pthread_attr_getstackaddr`如果在线程初始化时设置变量很困难，您可以随时使用获取堆栈的基础。然后，您可以在自己的函数中获取自动变量的地址，以确定此时堆栈的深度。

# delphi - 德尔福网络编程

> ID：58618
> 
> 赞同：4
> 
> 时间：2008-09-12T10:23:30.680
> 
> 标签：delphi, network-programming, udp

我有一个用 Delphi 2006 编写的经典客户端/服务器（胖客户端和数据库）程序。当客户端满足某些条件时，我需要非常快速地通知所有其他客户端。到目前为止，这是使用 UDP 广播完成的，但这不再可行，因为客户端现在从 LAN 外部连接，并且 UDP 广播仅限于本地网络。

我知道 Indy 库，但不确定要使用哪些组件以及如何构建它。我猜我需要有一个客户端连接到的服务器来接收和分发消息......？有什么样品可以让我开始吗？

是否还有其他我应该考虑的组件集或技术？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T10:36:00.727

简单的答案是 Delphi（和其他工具）中可用的标准协议不允许反向通知。我研究了一个我想使用 SOAP 的项目。他们都假设客户端询问服务器，服务器响应，仅此而已。

对我来说，解决方案是 RemObjects SDK。这允许您向客户端发送通知，并且通知可以包含您喜欢的任何数据（就像客户端到服务器一样）。我自己使用 SuperTCP 连接，但它也适用于其他人。它仍然可以为必须使用它的客户端提供 SOAP 接口，但是对于您可以同时控制客户端和服务器的地方，它工作得非常好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T17:24:16.270

使用 Delphi 有一些非常简单的方法可以做到这一点，尽管我确信 RemObjects SDK 也能很好地工作。

1.  有一个中央服务器，上面有一个 * TIdTCPServer 监听 *。然后每个客户端都有一个*TIdTCPClient*。它们连接到服务器并**阻塞** *等待***服务器写入**的读取。一旦服务器通过侦听套接字接收到通知，它就会向每个等待的客户端*广播。*这几乎是所有客户的即时通知。
2.  有一个中央服务器，上面有一个**TIdTCPServer 正在侦听**。然后每个客户端都有一个**TIdTCPClient**。这些客户端可以*“ping”*服务器以定期请求更新（使用会话令牌来维护状态）。间隔的频率决定了通知的速度。当其中一个客户端需要通知其他客户端时，它只通知服务器。然后，服务器使用*消息队列*列出所有活动的客户端会话，并为每个会话添加通知。然后下次每个客户端连接时，它都会向它发出通知并将其从队列中删除。
3.  在数据库中维护一个*会话表*，每个客户端都会定期更新他们有一个活动会话，并在断开连接时将其自身删除。您将需要一个删除死会话的维护过程。然后，您有一个*消息队列表*，客户端可以为每个当前活动会话写入一行更新。然后其他客户端可以定期 ping 该表以查看其会话是否有任何待处理的通知，如果有，它可以读取它们，对它们进行操作，然后删除它们。
4.  某种*对等*方法是客户端通过数据库中的信息相互了解，然后它们直接相互连接并通知或请求通知（取决于防火墙和 NAT 配置）。稍微复杂一点，但可能。

显然，实施的选择将取决于您的设置和需求。调整将是必要的，以获得最佳结果。

为此，您需要的组件是**TIdTCPServer**（侦听器）和**TIdTCPClient**（发送器）。两者都在 Delphi 的 Indy 库中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T18:59:56.263

[http://www.overbyte.be](http://www.overbyte.be)的ICS 组件很棒。a.) 比 Indy 更好的兼容性 b.) PostCard ware 很好的例子和支持。使用 TClientSocket 和 TServerSocket

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:33:42.573

FirebirdSQL 项目使用通知的概念作为向客户端发送字符串的服务器-客户端连接。为此，数据库服务器使用另一个端口。并要求客户端注册通过 API 调用接收某种类型的通知是很有趣的。

您可以使用相同的想法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-20T22:33:32.820

RabbitMQ 应该符合您的要求。服务器是免费的，可以使用。您只需要一个客户端来连接、推送/发送消息和获取/拉取通知消息

服务器：[http](http://www.rabbitmq.com/download.html) ://www.rabbitmq.com/download.html 做一个google客户端或者自己实现

干杯

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T10:28:15.490

您应该能够将多播 UDP 用于相同目的。唯一的区别是从每个客户端加入多播组。

[http://en.wikipedia.org/wiki/IP_Multicast](http://en.wikipedia.org/wiki/IP_Multicast)

[http://en.wikipedia.org/wiki/Internet_Group_Management_Protocol](http://en.wikipedia.org/wiki/Internet_Group_Management_Protocol)

**编辑：**澄清一下，多播让您加入与多播 IP 地址关联的给定“组”。发送到该地址的任何数据包都将到达已加入该组的每个客户端

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-20T21:32:40.220

您可以观看 weonlydo wodVPN 组件，该组件允许您创建强大的 UDP 打孔并获得端口转发或普通 VPN（带有完善的网络适配器），因此您可以在 NAT 后面连接两台 PC。

我将这个控件用于我们的通信程序并且工作得很好。

# winapi - 默认按钮大小？

> ID：58620
> 
> 赞同：9
> 
> 时间：2008-09-12T10:25:32.330
> 
> 标签：winapi

如何创建一个按钮控件（具有`CreateWindow`窗口`BUTTON`类），它具有与其他 Windows 应用程序一致的标准系统范围大小（尤其是高度）？我当然应该考虑 DPI 和其他设置。

> **备注：**使用`USE_CW_DEFAULT`for 宽度和高度会导致 0、0 大小的按钮，因此这不是解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-12T10:36:16.173

这就是 MSDN 不得不说的：[设计规范和指南 - 视觉设计：布局](http://msdn.microsoft.com/en-us/library/ms997619.aspx)。

按钮的默认大小为 50x14 DLU，可以使用为[GetDialogBaseUnits](http://msdn.microsoft.com/en-us/library/ms645475(VS.85).aspx)显示的示例计算像素。

MapDialogRect函数似乎为您进行计算[。](http://msdn.microsoft.com/en-us/library/ms645502(VS.85).aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-12T11:03:03.470

## 在完美无忧的世界...

要创建标准尺寸按钮，我们必须这样做：

```
LONG units = GetDialogBaseUnits();
m_hButton = CreateWindow(TEXT("BUTTON"), TEXT("Close"), 
                 WS_VISIBLE | WS_CHILD | BS_DEFPUSHBUTTON, 
                 0, 0, MulDiv(LOWORD(units), 50, 4), MulDiv(HIWORD(units), 14, 8),
                 hwnd, NULL, hInst, NULL); 
```

其中**50**和**14**是各自的 DLU 维度，**4**和**8**分别是水平和垂直对话模板单元，基于[`GetDialogBaseUnits()`函数](http://msdn.microsoft.com/en-us/library/ms645475(VS.85).aspx)文档注释。

* * *

## 没有什么是完美的

**但**正如 Anders 指出的那样，这些指标是基于系统字体的。如果您的窗口使用 shell 对话框字体或任何不会让您眼睛流血的字体，那么您几乎只能靠自己了。

要获得您自己的“对话框”基本单位，您必须检索当前文本度量`GetTextMetrics()`并使用字符高度和平均宽度（`tmHeight`分别`tmAveCharWidth`是`TEXTMETRIC`结构体）并自己使用 MulDiv 翻译它们，**除非**您在对话框中，否则`MapDialogRect()`将为您完成所有工作。

请注意，它`tmAveCharWidth`仅近似于实际的平均字符宽度，因此建议[`GetTextExtentPoint32()`](http://msdn.microsoft.com/en-us/library/dd144938.aspx)在字母字符集上使用函数。

看：

*   [Visual C++中如何根据当前字体计算对话框单位](http://support.microsoft.com/kb/145994)
*   [如何使用非基于系统的字体计算对话框基本单位](http://support.microsoft.com/kb/125681)

* * *

## 更简单的选择

如果按钮是您想要自动调整大小的唯一控件，您还可以使用[`BCM_GETIDEALSIZE`](http://msdn.microsoft.com/en-us/library/bb775961(VS.85).aspx)消息[`Button_GetIdealSize()`](http://msdn.microsoft.com/en-us/library/bb761851(VS.85).aspx)宏（仅限 Windows XP 及更高版本）来检索适合按钮包含的任何内容的最佳宽度和高度，尽管在按钮周围没有应用任何边距时它看起来很丑陋文本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T15:55:42.613

@macbirdie：你不应该使用 GetDialogBaseUnits()，它基于默认的系统字体（丑陋的位图字体）。你应该使用 MapDialogRect()

# delphi - 如何用 Delphi 散列一个字符串？

> ID：58621
> 
> 赞同：26
> 
> 时间：2008-09-12T10:26:31.517
> 
> 标签：delphi, hash, cryptography, md5

如何使用 Delphi 对字符串进行 MD5 哈希？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-12T10:28:23.117

如果你想要一个 MD5 摘要并安装了[Indy](http://www.indyproject.org)组件，你可以这样做：

```
uses SysUtils, IdGlobal, IdHash, IdHashMessageDigest;

with TIdHashMessageDigest5.Create do
try
    Result := TIdHash128.AsHex(HashValue('Hello, world'));
finally
    Free;
end; 
```

[Delphi Cryptography Package](http://www.cityinthesky.co.uk/opensource/dcpcrypt/)支持最流行的算法：

*   哈弗
*   MD4、MD5
*   成熟MD-128，成熟MD-160
*   SHA-1、SHA-256、SHA-384、SHA-512、
*   老虎

**更新** `DCPCrypt`现在由[Warren Postma](https://stackoverflow.com/users/84704/warren-p)维护，源代码可以在[这里](https://bitbucket.org/wpostma/dcpcrypt2010)找到。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2013-08-14T13:44:52.133

如果你想要一个十六进制的**MD5 哈希**字符串并且你已经安装了**Delphi XE 1**，那么你有**Indy 10** .5.7 组件，你可以这样做：

> 使用 IdGlobal、IdHash、IdHashMessageDigest；

```
class function getMd5HashString(value: string): string;
var
    hashMessageDigest5 : TIdHashMessageDigest5;
begin
    hashMessageDigest5 := nil;
    try
        hashMessageDigest5 := TIdHashMessageDigest5.Create;
        Result := IdGlobal.IndyLowerCase ( hashMessageDigest5.HashStringAsHex ( value ) );
    finally
        hashMessageDigest5.Free;
    end;
end; 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-17T13:30:53.700

I usually use DCPCrypt2 ([Delphi Cryptography Package](http://www.cityinthesky.co.uk/opensource/dcpcrypt/)) from David Barton ([City in the Sky](http://www.cityinthesky.co.uk/opensource/)).

It is also contains the following Encryption Algorithms:

*   Blowfish
*   Cast 128
*   Cast 256
*   DES, 3DES
*   Ice, Thin Ice, Ice2
*   IDEA
*   Mars
*   Misty1
*   RC2, RC4, RC5, RC6
*   Rijndael (the new AES)
*   Serpent
*   Tea
*   Twofish

**Update** `DCPCrypt` is now maintained by [Warren Postma](https://stackoverflow.com/users/84704/warren-p) and source can be found [here](https://bitbucket.org/wpostma/dcpcrypt2010).

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2020-03-09T15:40:21.137

为什么不使用`system.Hash`RTL 的单元，它还包含自 Delphi Seattle 以来的 MD5 哈希算法？

```
MD5HashCode := THashMD5.GetHashString(ClearTextString); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-01-25T03:20:07.763

这是对 devstopfix 答案的修改，已被接受。

在当前的 Indy 版本中，您可以更轻松地散列字符串和流。例子：

```
function MD5String(str: String): String;
begin
  with TIdHashMessageDigest5.Create do
    try
      Result := HashStringAsHex(str);
    finally
      Free;
    end;
end; 
```

使用`HashString`, `HashStringAsHex`, `HashBytes`, `HashBytesAsHex`, `HashStream`, `HashStreamAsHex`. 优点是还可以指定文本编码

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-01-17T13:59:43.007

Spring For Delphi 项目 - [http://www.spring4d.org](http://www.spring4d.org) - 实现了许多 SHAxxx 散列、MD5 散列以及许多 CRC 函数

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-09-14T06:15:32.237

如果您只想使用字典，而不是在寻找安全性，那么：
在 Delphi 2009 及更高版本中，可以使用以下命令创建字符串的哈希值

**[`BobJenkinsHash`](http://docwiki.embarcadero.com/VCL/en/Generics.Defaults.BobJenkinsHash)`(Value, Length(Value) * SizeOf(Value), 0)`**

其中 Value 是一个字符串。

[http://docwiki.embarcadero.com/VCL/en/Generics.Defaults.BobJenkinsHash](http://docwiki.embarcadero.com/VCL/en/Generics.Defaults.BobJenkinsHash)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-12T16:41:06.920

您还可以将 WindowsCrypto API 与 Delphi 一起使用：

*   [一般加密和哈希演示和资源](http://www.davinciunltd.com/code/delphi-cryptography/)

那里有一个包含所有 CryptoAPI 的单元。您还可以使用现在开源的 Lockbox。

最后，您可以使用 Delphi 支持几乎任何哈希算法。Indy 示例可能是您在 Delphi 中最接近本机的示例，因为大多数版本的 Delphi 都包含 Indy。对于其余部分，您将需要使用库或编写更多代码来访问 CryptoAPI 或自己实现它。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-12-14T13:21:13.400

[TurboPower 密码箱](http://lockbox.seanbdurkin.id.au/tiki-index.php)支持：

*   MD-5,
*   SHA-1 和
*   整个 SHA-2 系列，包括最近发布的 SHA-512/224 和 SHA-512/256 哈希。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-03-09T14:26:39.910

使用 ICS，您只需调用位于 OverbytecsMD5 单元中的 StrMD5 函数。

除了该特定功能之外，还有更多适用于其他数据类型和场景的 MD5 功能。还有其他哈希方法，例如 SHA。

# python - 如何使用 Doxygen 记录 Python 代码

> ID：58622
> 
> 赞同：99
> 
> 时间：2008-09-12T10:26:40.033
> 
> 标签：python, documentation, python-sphinx, doxygen, docstring

我喜欢用 Doxygen 创建 C 或 PHP 代码的文档。我有一个即将到来的 Python 项目，我想我记得 Python 没有`/* .. */`注释，并且还有自己的自我文档工具，这似乎是 Python 的文档方式。

由于我熟悉 Doxygen，如何使用它来生成 Python 文档？有什么特别需要我注意的吗？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-01-30T21:30:02.833

doxypy输入过滤器允许您[以](https://pypi.python.org/pypi/doxypy/)标准 Python 文档字符串格式使用几乎所有 Doxygen 的格式化标签。我用它来记录一个大型的混合 C++ 和 Python 游戏应用程序框架，它运行良好。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-09-12T11:11:03.123

这[记录在 doxygen 网站上](http://www.doxygen.nl/manual/docblocks.html#pythonblocks)，但在这里总结一下：

你可以使用 doxygen 来记录你的 Python 代码。您可以使用 Python 文档字符串语法：

```
"""@package docstring
Documentation for this module.

More details.
"""

def func():
    """Documentation for a function.

    More details.
    """
    pass 
```

在这种情况下，注释将被 doxygen 提取，但您将无法使用任何[特殊的 doxygen 命令](http://www.doxygen.nl/manual/commands.html#cmd_intro)。

**或者**`#`您可以（类似于 doxygen 下的 C 风格语言）将成员之前第一行的注释标记 ( ) 加倍：

```
## @package pyexample
#  Documentation for this module.
#
#  More details.

## Documentation for a function.
#
#  More details.
def func():
    pass 
```

在这种情况下，您可以使用特殊的 doxygen 命令。没有特定的 Python 输出模式，但您显然可以通过设置`OPTMIZE_OUTPUT_JAVA`为`YES`.

老实说，我对这种差异感到有些惊讶——似乎一旦 doxygen 可以检测到 ## 块或“””块中的注释，大部分工作就完成了，你就可以使用特殊命令了无论哪种情况。也许他们希望人们使用“””来遵守更多的 Pythonic 文档实践，这会干扰特殊的 doxygen 命令？

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2016-02-13T08:16:17.877

最后，您只有两个选择：

您使用 Doxygen 生成内容，或者使用 Sphinx* 生成内容。

1.  **Doxygen**：它不是大多数 Python 项目的首选工具。但是，如果您必须处理用 C 或 C++ 编写的其他相关项目，这可能是有道理的。为此，您可以使用[doxypypy](https://github.com/Feneric/doxypypy)改进 Doxygen 和 Python 之间的集成。

2.  **Sphinx**：用于记录 Python 项目的事实上的工具。您在这里有三个选项：手动、半自动（存根生成）和全自动（类似 Doxygen）。

    1.  对于手动 API 文档，您有 Sphinx [autodoc](http://www.sphinx-doc.org/en/stable/ext/autodoc.html)。编写带有嵌入式 API 生成元素的用户指南非常棒。
    2.  对于半自动，您有 Sphinx [autosummary](http://www.sphinx-doc.org/en/stable/ext/autosummary.html)。您可以将构建系统设置为调用 sphinx-autogen 或使用`autosummary_generate`配置设置 Sphinx。您将需要使用自动摘要设置页面，然后手动编辑页面。你有选择，但我对这种方法的经验是它需要太多的配置，最后即使在创建新模板之后，我也发现了错误并且无法准确地确定哪些公开为公共 API，哪些不公开。我的观点是这个工具非常适合需要手动编辑的存根生成，仅此而已。就像是手动结束的捷径。
    3.  全自动。这已经被批评了很多次，很长一段时间以来，我们都没有一个很好的与 Sphinx 集成的全自动 Python API 生成器，直到[AutoAPI](http://autoapi.readthedocs.org/)出现，这是一个新手。这是迄今为止 Python 中自动生成 API 的最佳方式（注意：无耻的自我推销）。

还有其他选项需要注意：

*   [Breathe](https://breathe.readthedocs.org/)：这是一个非常好的想法，当您使用其他使用 Doxygen 的其他语言处理几个相关项目时，这很有意义。这个想法是使用 Doxygen XML 输出并将其提供给 Sphinx 以生成您的 API。因此，您可以保留 Doxygen 的所有优点并统一 Sphinx 中的文档系统。理论上厉害。现在，在实践中，我最后一次检查项目还没有准备好投入生产。
*   [pydoctor](https://github.com/twisted/pydoctor)*: Very particular. Generates its own output. It has some basic integration with Sphinx, and some nice features.

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-12T21:04:48.063

据我了解，Sphinx 主要是用于格式化独立于源代码编写的文档的工具。

对于从 Python 文档字符串生成 API 文档，主要的工具是[pdoc](https://github.com/BurntSushi/pdoc)和[pydoctor](https://launchpad.net/pydoctor)。这是 pydoctor 为[Twisted](http://twistedmatrix.com/documents/current/api)和[Bazaar](http://starship.python.net/crew/mwh/bzrlibapi/)生成的 API 文档。

当然，如果您只是想在处理内容时查看文档字符串，可以使用“ [pydoc](https://docs.python.org/2/library/pydoc.html) ”命令行工具以及`help()`交互式解释器中可用的功能。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-12T13:48:59.313

另一个非常好的文档工具是[sphinx](http://www.sphinx-doc.org/en/master/index.html)。它将用于即将发布的 python 2.6[文档](http://docs.python.org/dev/)，并被[django](http://docs.djangoproject.com/en/dev/)和许多其他 python 项目使用。

从狮身人面像网站：

*   **输出格式**：HTML（包括 Windows HTML 帮助）和 LaTeX，用于可打印的 PDF 版本
*   **广泛的交叉引用**：函数、类、词汇表术语和类似信息的语义标记和自动链接
*   **层次结构**：文档树的简单定义，自动链接到兄弟姐妹、父母和孩子
*   **自动索引**：通用索引以及模块索引
*   **代码处理**：使用 Pygments 荧光笔自动高亮显示
*   **扩展**：自动测试代码片段，包含来自 Python 模块的文档字符串等

# .net - 发送 HTML 电子邮件时出现“引用打印行超过 76 个字符”警告

> ID：58630
> 
> 赞同：7
> 
> 时间：2008-09-12T10:31:35.543
> 
> 标签：.net, html, email

我在我的 VB.NET 应用程序中编写了一些代码来发送 HTML 电子邮件（在本例中，是丢失密码提醒）。

当我测试电子邮件时，它被我的垃圾邮件过滤器吃掉了。它得分很差的一件事是因为以下问题：

```
MIME_QP_LONG_LINE RAW：带引号的可打印行超过 76 个字符
```

我已经查看了电子邮件的来源，我已经将每行超过 76 个字符的行分成两行，中间有一个 CR+LF，但这并没有解决问题。

谁能指出我正确的方向？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T10:52:52.777

引用的可打印将 8 位字符扩展为“={HEX-Code}”，从而使消息更长。也许你刚刚达到这个极限？

您是否尝试过以 70 个字符中断消息？这应该为每行几个字符提供空间。

或者您只需使用 Base64 对电子邮件进行编码 - 所有邮件客户端都可以处理。

或者您只需将 Content-Transfer-Encoding 设置为 8bit 并发送未编码的数据。我知道这些天没有邮件服务器无法处理 8 位字节。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-15T12:02:41.230

这是 System.Net.Mail.MailMessage 中的 Quoted-Printable 编码实现中的一个错误，它已经存在了很长时间，但显然现在已修复，截至 .Net 4 Beta 2。

[http://connect.microsoft.com/VisualStudio/feedback/details/156052/mailmessage-body-encoding-quoted-printable-violates-rfcs-soft-line-breaks-requirements](http://connect.microsoft.com/VisualStudio/feedback/details/156052/mailmessage-body-encoding-quoted-printable-violates-rfcs-soft-line-breaks-requirements)

一种解决方法是改用 Base64 编码（即使以这样的非人类可读编码发送纯文本 MIME 部分不是一种好的做法）。要求类的用户在发送消息之前手动拆分消息的行不是一个通用的解决方案，因为修改后的消息不是他们想要发送的（例如，它可能包含一个超过 76 个字符的链接，等等不能拆分）。只要实现正确，Quoted-Printable 可以处理编码*前*长度超过 76 个字符的消息。

# vba - 在 Outlook 宏中执行 MailItem.Move 时如何保留 RecipientTime？

> ID：58633
> 
> 赞同：1
> 
> 时间：2008-09-12T10:34:14.430
> 
> 标签：vba, outlook

在 Outlook 2003 宏中；有没有办法在不更改 ReceivedTime-header 的情况下在文件夹之间移动消息？

我目前使用的方法`MailItem.Move`。但这会自动将`ReceivedTime`属性设置为当前时间，这并不是我真正想要的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T13:31:52.567

我刚刚尝试将邮件项从我的收件箱移动到已删除的项目文件夹，它似乎保持接收时间没有问题......

您可能想尝试使用 MailItem.copy 函数并移动生成的 mailitem 对象，但就像我说的那样，我没有看到同样的问题......

希望有帮助...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-26T10:55:04.417

执行 item.Save() 然后执行 item.Move()，它将标记当前时间戳。

# algorithm - 如何将一组多边形转换为位图

> ID：58638
> 
> 赞同：3
> 
> 时间：2008-09-12T10:36:38.807
> 
> 标签：algorithm, gis, arcgis, arcgis-js-api

如何获取一组包含任意值的多边形并创建相应的位图，其中每个像素都包含该位置的多边形值？

为了将问题置于上下文中，我的多边形包含有关多边形内每平方公里平均人数的信息。我需要创建一个栅格/位图，其中包含代表 200 米箱中人口的像素。

我过去做过类似的事情，我使用多边形通过绘制位图并填充值来创建蒙版，然后将位图转换为我可以操作的数组。我敢肯定有更好的方法来做到这一点！

我根据要求进一步澄清了这个问题。

1.  有多个多边形，每个多边形是一组向量
2.  每个多边形都有一个唯一值
3.  多边形不重叠

谢谢

缺口

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-12T12:13:10.417

你用的是什么GIS软件？ArcGIS 在 ArcGIS 9.2 或更高版本中提供了多边形转栅格工具，该工具可作为 PolygonToRaster_conversion 函数编写脚本。

```
PolygonToRaster_conversion (in_features, value_field, out_raster_dataset, cell_assignment, priority_field, cellsize) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T12:22:13.220

这可能不是您所需要的，但如果您想绘制多边形（或相反地在多边形的基础上读取多边形图像的像素），那么一种解决方案是滚动您自己的[多边形填充工具](http://www.cs.rit.edu/~icss571/filling/index.html)。坦率地说，这很有趣，而且非常值得学习。

但是你的问题对我来说不是很清楚。你能给出更好的描述吗？

*   您的任意多边形集是实际图像，还是矢量（即点列表）点，还是 ???
*   每个多边形是否有一个值，或者每个多边形是否有一组您要绘制的值？
*   所以每个多边形都有一个相关的人口值数组，你想用它来纹理化多边形？

-亚当

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-28T19:30:45.130

这是一个有趣的项目。假设多边形是凸的，这就是我要做的：

```
 have a NY * 2 array of x positions: int x[NY][2]
foreach polygon
  clear the array to -1
  for each edge line
    foreach horizontal raster line iy intersecting the line
      generate ix, the x position where the raster intersects the line
      if x[iy][0] == -1, set it to ix, else set x[iy][1] to ix
    end foreach iy
  end foreach edge
  foreach iy
    fill the pixels between x[iy][0] and x[iy][1] with the polygons label
  end foreach iy
end foreach polygon 
```

这比听起来要复杂一些，因为您需要心理训练才能将光栅坐标视为要标记的像素，而不是它们之间的不可见线。否则，你会被边界问题搞糊涂。

对此的一个很好的测试是，如果你有一个面积为零的多边形，比如它由从 A 点到 B 点再回到 A 点的边缘组成，它应该不会点亮任何像素。另一个测试是如果你有一个高 2 个单位的平行四边形，并且它的顶部和底部边缘是 2 个单位宽，它应该恰好亮 4 个像素。

如果多边形不是凸的，那就有点不同了。无论边缘与光栅线相交的位置，都将所有像素从那里切换到任意选择的 X 坐标，例如“屏幕”的左边缘。完成所有边缘后，只有内部像素会被切换奇数次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T11:34:41.163

ImageMagick 可以从svg 转换成png，也许你可以看一下代码，或者干脆创建svg 并使用IM 进行转换？[邋遢](http://scruffy.rubyforge.org/ "邋遢")做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T12:38:34.210

@尼克R

> 我最初使用的是 ArcGIS 9.2，但它不适用于 C# 和 64 位，所以我现在使用 GDAL ( [http://www.gdal.org](http://www.gdal.org) )。

[gdal_rasterize](http://www.gdal.org/gdal_rasterize.html)不正是你想要的吗？

# c# - 如何使用 C# 从文件中获取 EXIF 数据

> ID：58649
> 
> 赞同：77
> 
> 时间：2008-09-12T10:43:49.070
> 
> 标签：c#, exif, photography

我想用 C# 编写一个小程序，它会检查我的 jpeg 照片，例如，将它们分类到过时的文件夹中（使用我的约会约定，该死的......）。

有谁知道以编程方式获取 EXIF 数据（例如日期和时间）或曝光的相对简单的方法？谢谢！

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-08-12T21:34:19.207

正如建议的那样，您可以使用一些 3rd 方库，或者手动执行（这不是很多工作），但最简单和最灵活的可能是使用 .NET 中的内置功能。有关更多信息，请参阅：

*   [System.Drawing.Image.PropertyItems](http://msdn.microsoft.com/en-us/library/system.drawing.image.propertyitems.aspx)属性

*   [System.Drawing.Imaging.PropertyItem](http://msdn.microsoft.com/en-us/library/system.drawing.imaging.propertyitem.aspx)类

*   [如何：读取图像元数据](http://msdn.microsoft.com/en-us/library/xddt0dz7.aspx)

我说“它是最灵活的”，因为 .NET 不会尝试以任何方式解释或合并数据。对于每个 EXIF，您基本上都会得到一个字节数组。这可能是好是坏，取决于您实际想要多少控制。

另外，我应该指出，属性列表实际上并不直接对应于 EXIF 值。EXIF 本身存储在具有重叠 ID 的多个表中，但 .NET 将所有内容放在一个列表中并重新定义某些项目的 ID。但只要您不关心精确的 EXIF ID，您应该可以使用 .NET 映射。

* * *

**编辑：**可以在不加载完整图像的情况下执行此答案：[https ://stackoverflow.com/a/552642/2097240](https://stackoverflow.com/a/552642/2097240)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-01T08:00:51.110

看看这个[元数据提取器](https://www.drewnoakes.com/code/exif/)。~~它是用 Java 编写的，但也已移植到 C#。~~我已经使用 Java 版本编写了一个小实用程序来根据日期和模型标签重命名我的 jpeg 文件。非常容易使用。

* * *

**EDIT** *元数据提取器*也支持 .NET。这是一个非常快速和简单的库，用于从图像和视频中访问元数据。

它完全支持 Exif，以及 IPTC、XMP 和许多其他类型的元数据，包括 JPEG、PNG、GIF、PNG、ICO、WebP、PSD 等文件类型。

```
var directories = ImageMetadataReader.ReadMetadata(imagePath);

// print out all metadata
foreach (var directory in directories)
foreach (var tag in directory.Tags)
    Console.WriteLine($"{directory.Name} - {tag.Name} = {tag.Description}");

// access the date time
var subIfdDirectory = directories.OfType<ExifSubIfdDirectory>().FirstOrDefault();
var dateTime = subIfdDirectory?.GetDateTime(ExifDirectoryBase.TagDateTime); 
```

它可以通过[NuGet](https://www.nuget.org/packages/MetadataExtractor/)和[GitHub 上的代码获得](https://github.com/drewnoakes/metadata-extractor-dotnet)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-11T22:24:46.810

这是另一个[类似 SO question](https://stackoverflow.com/questions/280003/how-do-i-retrieve-the-properties-of-a-photo-taken-on-a-digital-camera-using-net/636606#636606)的链接，该问题的答案指向.Net中关于[“阅读、写作和照片元数据”的这篇好文章。](http://www.vsj.co.uk/dotnet/display.asp?id=649)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-10-25T09:21:19.293

您可以使用[F-Spot](http://f-spot.org/)等应用程序使用的[TagLib#](https://github.com/mono/taglib-sharp)。除了 Exif，它还能读取大量的图像、音频和视频元数据格式。

我也喜欢[ExifUtils](https://code.google.com/p/exif-utils/) API，但它有问题并且没有积极开发。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-12T10:53:06.130

Image 类具有 PropertyItems 和 PropertyIdList 属性。你可以使用它们。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-12T10:49:18.247

从 JPEG 图像中获取 EXIF 数据包括：

1.  寻找提到 EXIF 数据开头的 JPEG 标记。例如，通常 oxFFE1 是在编码 EXIF 数据时插入的标记，它是 EXIF 数据所在的应用程序段。
2.  解析从 0xFFE1 到 0xFFE2 的所有数据。此数据将是 JPEG 编码文件中的字节流。
3.  这些字节的 ASCII 等效项将包含与图像日期、相机型号名称、曝光等相关的各种信息......

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-02-03T02:43:06.433

Phil Harvey的命令行工具[ExifTool](http://www.sno.phy.queensu.ca/~phil/exiftool/)可以处理数十种图像格式——包括大量专有的 RAW 格式——并且可以处理各种元数据格式，包括 EXIF、GPS、IPTC、XMP、JFIF。

非常易于使用，重量轻，令人印象深刻的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-08-11T05:32:29.243

最近，我使用了这个[.NET Metadata API](https://products.groupdocs.com/metadata/net)。我还写了[一篇](https://blog.groupdocs.com/2020/05/13/manage-exif-data-in-csharp-net-for-jpeg-png-tiff-webp-images/)关于它的博客文章，展示了使用 C# 从图像中读取、更新和删除 EXIF 数据。

```
using (Metadata metadata = new Metadata("image.jpg"))
{
    IExif root = metadata.GetRootPackage() as IExif;
    if (root != null && root.ExifPackage != null)
    {
        Console.WriteLine(root.ExifPackage.DateTime);
     }
} 
```

# windows - Windows CDROM 弹出

> ID：58670
> 
> 赞同：11
> 
> 时间：2008-09-12T10:53:52.540
> 
> 标签：windows, winapi

有谁知道在 Windows 2000 或更高版本上以编程方式关闭 CD 托盘的方法？存在打开的 CD 托盘，但我似乎无法将其关闭，尤其是在 W2k 下。

如果可能的话，我特别在寻找一种从批处理文件中执行此操作的方法，但是 API 调用就可以了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T21:24:35.067

我有点喜欢使用 DeviceIOControl，因为它让我可以弹出任何类型的可移动驱动器（例如 USB 和闪存盘以及 CD 托盘）。使用 DeviceIOControl 正确弹出磁盘的代码是（只需添加正确的错误处理）：

```
bool ejectDisk(TCHAR driveLetter)
{
  TCHAR tmp[10];
  _stprintf(tmp, _T("\\\\.\\%c:"), driveLetter);
  HANDLE handle = CreateFile(tmp, GENERIC_READ, FILE_SHARE_WRITE, 0, OPEN_EXISTING, 0, 0);
  DWORD bytes = 0;
  DeviceIoControl(handle, FSCTL_LOCK_VOLUME, 0, 0, 0, 0, &bytes, 0);
  DeviceIoControl(handle, FSCTL_DISMOUNT_VOLUME, 0, 0, 0, 0, &bytes, 0);
  DeviceIoControl(handle, IOCTL_STORAGE_EJECT_MEDIA, 0, 0, 0, 0, &bytes, 0);
  CloseHandle(handle);
  return true;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-12T11:28:03.583

这是使用 Win32 API 的简单方法：

```
 [DllImport("winmm.dll", EntryPoint = "mciSendStringA", CharSet = CharSet.Ansi)]
        protected static extern int mciSendString(string lpstrCommand,StringBuilder lpstrReturnString,int uReturnLength,IntPtr hwndCallback);

 public void OpenCloseCD(bool Open)
 {
    if (Open)
    {
        mciSendString("set cdaudio door open", null, 0, IntPtr.Zero);
    }
    else
    {
        mciSendString("set cdaudio door closed", null, 0, IntPtr.Zero);
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-05-28T17:11:26.633

我注意到 Andreas Magnusson 的回答与 Explorer 的“弹出”按钮的作用并不完全相同。具体来说，使用 Andreas 的代码在 Explorer 中驱动器没有灰显，但如果您使用了 Eject 命令，驱动器就会灰显。所以我做了一些调查。

我在从资源管理器（Windows 7 SP1 64 位）运行 Eject 命令时运行了 API Monitor。我还发现了一篇很好的（现已失效的）MSKB 文章 165721，标题为[How To Ejecting Removable Media in Windows NT/Windows 2000/Windows XP](http://web.archive.org/web/20150511141059/https://support.microsoft.com/en-us/kb/165721 "如何在 Windows NT/Windows 2000/Windows XP 中弹出可移动媒体")。文章中最有趣的部分引述如下：

> 1.  使用 GENERIC_READ|GENERIC_WRITE、FILE_SHARE_READ|FILE_SHARE_WRITE 和 OPEN_EXISTING 调用 CreateFile。lpFileName 参数应该是 \\.\X: （其中 X 是真正的驱动器号）。所有其他参数都可以为零。
> 2.  通过 DeviceIoControl 发出 FSCTL_LOCK_VOLUME IOCTL 来锁定卷。如果任何其他应用程序或系统正在使用该卷，则此 IOCTL 将失败。一旦这个函数成功返回，应用程序就可以保证该卷不被系统中的任何其他东西使用。
> 3.  通过发出 FSCTL_DISMOUNT_VOLUME IOCTL 卸载卷。这会导致文件系统删除有关该卷的所有信息，并丢弃它保留的有关该卷的任何内部信息。
> 4.  确保可以通过发出 IOCTL_STORAGE_MEDIA_REMOVAL IOCTL 来删除媒体。在调用此 IOCTL 之前，将 PREVENT_MEDIA_REMOVAL 结构的 PreventMediaRemoval 成员设置为 FALSE。这会阻止设备阻止媒体被移除。
> 5.  使用 IOCTL_STORAGE_EJECT_MEDIA IOCTL 弹出媒体。如果设备不允许自动弹出，则可以跳过 IOCTL_STORAGE_EJECT_MEDIA 并指示用户移除媒体。
> 6.  关闭第一步获得的卷句柄或发出 FSCTL_UNLOCK_VOLUME IOCTL。这允许驱动器被其他进程使用。

Andreas 的回答，MSKB 的文章，以及我对 Explorer 的 API 嗅探，可以总结如下：

1.  `CreateFile`调用打开卷。（所有方法）。
2.  `DeviceIoControl`用 调用[`FSCTL_LOCK_VOLUME`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364575%28v=vs.85%29.aspx)。（所有方法）。
3.  `DeviceIoControl`用 调用[`FSCTL_DISMOUNT_VOLUME`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364562%28v=vs.85%29.aspx)。（仅限 Andreas 和 MSKB 方法。资源管理器由于某种原因不会调用它。这个 IOCTL 似乎是影响驱动器在资源管理器中是否变灰的原因。我不确定资源管理器为什么不调用它）。
4.  `DeviceIoControl`调用[`IOCTL_STORAGE_MEDIA_REMOVAL`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa363416(v=vs.85).aspx)和`PREVENT_MEDIA_REMOVAL`成员设置为`FALSE`（MSKB 和资源管理器方法。安德烈亚斯的答案中缺少此步骤）。
5.  `DeviceIoControl`使用[`IOCTL_STORAGE_EJECT_MEDIA`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa363406(v=vs.85).aspx)（Andreas 和 MSKB 文章）或`IOCTL_DISK_EJECT_MEDIA`（Explorer；请注意此 IOCTL 已过时并替换为 STORAGE IOCTL。不确定为什么 Explorer 仍使用旧的）调用。

最后，我决定遵循 MSKB 文章中概述的程序，因为它似乎是最彻底和最完整的程序，并以 MSKB 文章为后盾。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-12T10:58:03.017

[Nircmd](http://www.nirsoft.net/utils/nircmd.html)是一个非常方便的免费命令行实用程序，具有多种选项，包括打开和关闭 CD 托盘。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-03T09:14:06.753

要关闭驱动器托盘，请按照[此处](https://stackoverflow.com/a/30512979/3969362)所述进行操作，但不要将 DeviceIoControl 与 IOCTL_STORAGE_EJECT_MEDIA 一起使用，您需要使用 IOCTL_STORAGE_LOAD_MEDIA 调用 DeviceIoControl。

# architecture - 现代文本编辑器架构示例

> ID：58671
> 
> 赞同：10
> 
> 时间：2008-09-12T10:54:45.597
> 
> 标签：architecture, text-editor

我正在寻找现代文本编辑器的设计\架构指导。

*现代*文本编辑器意味着：

*   它支持语法高亮
*   它具有自动完成功能（类似于 IntelliSense）
*   它具有高级导航功能（增量搜索等）

以下属性将是一个加号：

*   以托管语言（Java、任何 .NET 语言）实现
*   模块化架构
*   插件支持

我对*文本编辑器相关*的设计\架构文档\文章、开源项目的链接非常感兴趣。

我对一般建议、OOP/设计模式书籍广告**不**感兴趣。

目前我正在分析[SharpDevelop 代码编辑器](http://sharpdevelop.net/OpenSource/SD/)源代码。类似项目的链接将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-15T15:09:39.000

最终的文本编辑器当然是 emacs。我发现[The Craft of Text Editing 或 Emacs for the Modern World](http://www.finseth.com/craft/)是编写编辑器基础知识的优秀自学指南。这些示例都是用普通的旧 C 语言编写的，文本可能看起来有些过时（它是 1991 年的），但基本思想仍然有效，并且您完全理解编辑器*为什么*会这样工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T10:57:52.983

[SharpDevelop](http://sharpdevelop.net/OpenSource/SD/)的编辑器不错，也是开源的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T14:58:33.647

基于 Java 的编辑器“jEdit”是文本编辑器体系结构的一个很好的例子，具有插件支持、强大的用户社区和良好的抽象。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T19:36:04.930

您可以查看[xacc.ide](http://xacc.wordpress.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T10:58:41.937

您还可以查看[Scintilla](http://www.scintilla.org/)的源代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-12T11:35:17.823

它可能不是您想要的，它基于 Mozilla，但为了完整起见：

[Open Komodo](http://www.openkomodo.com/)是 ActiveState 的一项倡议，旨在创建一个用于构建开发人员环境的开源平台。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T14:30:06.583

你看过vim吗？它支持自动补全、语法高亮、增量搜索、集成构建等。它是模块化的，并且它的许多更高级的功能都是作为插件实现的，这些插件可以随它一起提供，也可以单独找到（例如，svn 集成、代码索引） cscope/ctags，通过 ssh 进行透明读/写）。

它有用于用多种语言（例如，python、ruby、perl）编写插件的 api，以及它自己的扩展语言（'vimscript'）。

我不知道他们在高级架构文档方面有什么，但是有一个活跃的社区和一个开发人员邮件列表，如果您开始挖掘源代码，应该能够回答有关它如何工作的具体问题。

# visual-studio - Visual Studio 2008 抱怨受信任的位置。该怎么办？

> ID：58679
> 
> 赞同：0
> 
> 时间：2008-09-12T10:58:23.483
> 
> 标签：visual-studio, security, assemblies

今天早上我在搞乱[RhinoMocks](http://www.ayende.com/projects/rhino-mocks.aspx)并且无法运行我的测试，因为 RhinoMocks.dll 不在“受信任的位置”。该程序集位于我的 c:\documents and settings\\My Documents\Visual Studio 2008\Projects （等等）文件夹中。这是怎么回事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T10:59:44.603

您是否从 Internet 下载了一个 zip 文件，然后使用标准资源管理器工具将其解压缩。我认为这会将目录标记为不受信任，Visual Studio 会检测到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T11:00:57.547

根据我的阅读，有很多事情会导致这种情况。然而，针对我的特殊情况的解决方法是“解锁”DLL 文件。因为我是从 Internet 上下载的 zip，所以 XP 已在该文件上放置了一个块。右键单击文件并单击“取消阻止”就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T20:01:30.717

右键单击文件或位置，然后选择属性。在最底部，您应该看到“取消阻止”按钮。单击它并按确定。

# php - 如何对 Web 应用程序中的所有输出进行 HTML 编码？

> ID：58694
> 
> 赞同：6
> 
> 时间：2008-09-12T11:05:57.363
> 
> 标签：php, asp.net, jsp

我想在我的 Web 应用程序中防止 XSS 攻击。我发现 HTML Encoding 输出确实可以防止 XSS 攻击。现在的问题是我如何对应用程序中的每个输出进行 HTML 编码？我有办法自动化吗？

我感谢 JSP、ASP.net 和 PHP 的答案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-13T17:02:05.707

**您不应该**做的一件事是在输入数据进入时对其进行过滤。人们经常建议这样做，因为它是最简单的解决方案，但会导致问题。

输入数据可以发送到多个地方，除了作为 HTML 输出。例如，它可能存储在数据库中。过滤发送到数据库的数据的规则与过滤 HTML 输出的规则有很大的不同。如果您在输入时对所有内容进行 HTML 编码，那么您最终会在数据库中使用 HTML。（这也是为什么 PHP 的“魔术引号”功能是个坏主意的原因。）

您无法预测输入数据将经过的所有地方。安全的方法是在数据发送到某个地方**之前**准备好数据。如果要将其发送到数据库，请转义单引号。如果要输出 HTML，请转义 HTML 实体。一旦它被发送到某个地方，如果您仍然需要处理数据，请使用原始的未转义版本。

这是更多的工作，但您可以通过使用模板引擎或库来减少它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T11:31:31.390

您不想对所有 HTML 进行编码，您只想对您输出的任何用户输入进行 HTML 编码。

对于 PHP：[htmlentities](http://us.php.net/htmlentities)和[htmlspecialchars](http://us.php.net/manual/en/function.htmlspecialchars.php)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T02:48:24.890

对于 JSP，您也可以使用 c:out 标签，它默认转义 XML。这意味着您可以将属性绑定为原始元素：

```
<input name="someName.someProperty" value="<c:out value='${someName.someProperty}' />" /> 
```

当绑定到字符串时， someName.someProperty 将包含 XML 输入，但是当输出到页面时，它会自动转义以提供 XML 实体。这对于页面验证的链接特别有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T11:57:59.487

我用来转义所有用户输入的一个好方法是为 smarty 编写一个修饰符，它转义传递给模板的所有变量；附有 |unescape 的除外。这样，您只授予对您明确授予访问权限的元素的 HTML 访问权限。

我没有那个修饰符了；但在这里可以找到大约相同的版本：

[http://www.madcat.nl/martijn/archives/16-Using-smarty-to-prevent-HTML-injection..html](http://www.madcat.nl/martijn/archives/16-Using-smarty-to-prevent-HTML-injection..html)

在新的 Django 1.0 版本中，它的工作方式完全相同，杰伊 :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T12:11:28.347

您可以将 echo / print 等包装在您自己的方法中，然后您可以使用这些方法来转义输出。即代替

```
echo "blah"; 
```

采用

```
myecho('blah'); 
```

如果需要，您甚至可以设置第二个参数来关闭转义。

在一个项目中，我们在输出函数中有一个调试模式，它使通过我们方法的所有输出文本不可见。然后我们知道屏幕上留下的任何东西都没有逃脱！追踪那些顽皮的未转义位非常有用:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-12T13:23:44.007

我个人的偏好是认真编码来自数据库、业务层或来自用户的*任何内容。*

在 ASP.Net 中，这是通过使用`Server.HtmlEncode(string)`.

对任何内容进行编码的原因是，即使您可能认为是布尔值或数字的属性也可能包含恶意代码（例如，复选框值，如果它们执行不当可能会以字符串形式返回。如果您之前没有对它们进行编码将输出发送给用户，那么你就有了漏洞）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T11:18:23.717

如果您确实对每个输出进行了 HTML 编码，用户将看到 <html> 的纯文本。而不是一个正常运行的网络应用程序。

编辑：如果你对每一个输入进行 HTML 编码，你将无法接受包含 < 等的外部密码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T14:19:54.887

真正保护自己免受此类攻击的唯一方法是严格过滤您接受的所有输入，特别是（但不完全是）来自应用程序公共区域的输入。我建议您看一下 Daniel Morris 的[PHP 过滤类](http://www.phpclasses.org/browse/package/2189.html)（一个完整的解决方案）以及[Zend_Filter](http://framework.zend.com/manual/en/zend.filter.html)包（您可以用来构建自己的过滤器的类的集合）。

在 Web 开发方面，PHP 是我选择的语言，因此对我的回答中的偏见表示歉意。

基兰。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-13T17:54:51.040

Joel 有一篇关于软件的好文章（我认为让错误的代码看起来不正确，我在手机上，否则我会有一个 URL 给你），其中涵盖了匈牙利符号的正确使用。简短的版本将类似于：

```
Var dsFirstName, uhsFirstName : String;

Begin

uhsFirstName := request.queryfields.value['firstname'];

dsFirstName := dsHtmlToDB(uhsFirstName); 
```

基本上用**“us”**作为不安全字符串的前缀，**“ds”**作为数据库安全的前缀，**“hs”**作为 HTML 安全的前缀。您只想在实际需要的地方进行编码和解码，而不是全部。但是通过使用它们的前缀来推断有用的含义，查看您的代码，如果有什么不对劲，您会很快发现。无论如何，您将需要不同的编码/解码功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-02-01T00:06:02.160

输出编码是迄今为止最好的防御。验证输入的好处有很多，但不是 100% 的防御。如果数据库通过攻击（即 ASPROX）感染了 XSS，错误或恶意输入验证将不起作用。输出编码仍然有效。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-01-16T11:51:11.633

OWASP 有一个很好的 API 来编码 HTML 输出，既可以用作 HTML 文本（例如段落或`<textarea>`内容），也可以用作属性的值（例如`<input>`拒绝表单后的标签）：

```
encodeForHTML($input) // Encode data for use in HTML using HTML entity encoding
encodeForHTMLAttribute($input) // Encode data for use in HTML attributes. 
```

该项目（PHP 版本）托管在[http://code.google.com/p/owasp-esapi-php/](http://code.google.com/p/owasp-esapi-php/)下，也可用于其他一些语言，例如 .NET。

请记住，您应该对*所有内容*（不仅是用户输入）进行编码，而且应该*尽可能晚地*进行编码（不是在存储在数据库中时，而是在输出 HTTP 响应时）。

# xcopy - 用于复制大量文件的 XCopy 的替代品？

> ID：58697
> 
> 赞同：5
> 
> 时间：2008-09-12T11:07:18.423
> 
> 标签：xcopy

情况：我有一台糟糕的笔记本电脑。让它变得糟糕的一件事是电池没电了，电源线毫不费力地从后面拉出来。

我最近收到了一台非常不错的笔记本电脑，我正在将所有东西从旧的复制到新的。我正在尝试将 c:*.* 从旧机器 xcopy 到外部硬盘驱动器，但由于电源线经常拔出，xcopy 经常被中断。

我需要的是 XCopy 中的一个开关，它将复制除目标文件夹中已经存在的文件之外的所有内容——与 /U 开关的行为完全相反。

有谁知道这样做的方法？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-12T11:10:45.497

我发现 RoboCopy 是 xcopy 的一个很好的替代品。它更好地支持高延迟连接并支持恢复副本。

### 参考

[维基百科 - robocopy](http://en.wikipedia.org/wiki/Robocopy)

### 下载

**编辑**Robocopy 是作为 Windows Vista 和 Windows Server 2008 的标准功能引入的。

*   Robocopy 作为 Windows Server 2003 资源工具包的一部分提供，可以从[Microsoft 下载站点下载](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)。

*   [在 technet http://technet.microsoft.com/en-us/magazine/cc160891.aspx](http://technet.microsoft.com/en-us/magazine/cc160891.aspx)上还为 RoboCopy 发布了一个非常简单的 GUI

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-12T11:31:19.533

/D 可能是您正在寻找的。我发现它的备份速度非常快，因为没有复制现有文件。

```
xcopy "O:\*.*" N:\Whatever /C /D /S /H 

/C Continues copying even if errors occur. 
/D:m-d-y Copies files changed on or after the specified date. 
    If no date is given, copies only those files whose source time 
    is newer than the destination time. 
/S Copies directories and subdirectories except empty ones. 
/H Copies hidden and system files also. 
```

更多信息： http: [//www.computerhope.com/xcopyhlp.htm](http://www.computerhope.com/xcopyhlp.htm)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T11:19:09.703

[我是TeraCopy](http://www.codesector.com/teracopy.php)的忠实粉丝。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-09-15T15:56:17.387

[Beyond Compare 3](http://www.scootersoftware.com/index.php)是我见过的最好的实用程序。它使一切都非常容易评估，并且非常容易操作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T12:18:08.300

不清楚您是否只想要一个命令行工具，但微软的免费[SyncToy](http://en.wikipedia.org/wiki/SyncToy)程序非常适合维护一对卷之间的复制。它支持在一个或两个方向上推送更改。也就是说，它支持几种不同类型的复制模式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-12T05:07:20.007

XcopyGUI。用于 xcopy 的小型独立 GUI 前端。自由。[http://lorenstuff.weebly.com/](http://lorenstuff.weebly.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-17T15:33:22.033

```
robocopy c:\sourceDirectory\*.* d:\destinationDirectory\*.* /R:5 /W:3 /Z /XX /TEE 
```

这将适用于您替代 xCopy ... 恕我直言的最佳方法

祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T11:16:36.310

我建议使用[rsync](http://optics.ph.unimelb.edu.au/help/rsync/rsync_pc1.html)，有几个端口可用，但[cwrsync](http://www.itefix.no/i2/node/10650)似乎在 Windows 上运行良好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-12T11:20:36.457

[同音](http://www.cis.upenn.edu/~bcpierce/unison/)呢？

# sql-server - 如何登录 T-SQL

> ID：58709
> 
> 赞同：14
> 
> 时间：2008-09-12T11:17:23.937
> 
> 标签：sql-server, tsql, logging, ado.net, sql

我正在使用 ADO.NET 访问 SQL Server 2005，并且希望能够从我正在调用的 T-SQL 存储过程内部进行日志记录。这有可能吗？

使用 ADO.NET 时，我无法看到“打印”语句的输出，因为我只想使用日志记录来调试理想的解决方案是从 SysInternals 向 DebugView 发出消息。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-12T11:23:54.233

我认为写入日志表将是我的偏好。

或者，当您使用 2005 时，您可以编写一个简单的 SQLCLR 过程来包装 EventLog。

或者，如果您想写入 SQL 日志，可以使用**xp_logevent**

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-13T10:00:18.107

我按照 Eric Z Beard 的建议通过编写 SQLCLR 程序解决了这个问题。程序集必须使用强名称密钥文件进行签名。

```
using System;
using System.Data;
using System.Data.SqlClient;
using System.Data.SqlTypes;
using Microsoft.SqlServer.Server;

public partial class StoredProcedures
{
    [Microsoft.SqlServer.Server.SqlProcedure]
    public static int Debug(string s)
    {
        System.Diagnostics.Debug.WriteLine(s);
            return 0;
        }
    }
} 
```

创建了一个密钥和一个登录名：

```
USE [master]
CREATE ASYMMETRIC KEY DebugProcKey FROM EXECUTABLE FILE =
'C:\..\SqlServerProject1\bin\Debug\SqlServerProject1.dll'

CREATE LOGIN DebugProcLogin FROM ASYMMETRIC KEY DebugProcKey 

GRANT UNSAFE ASSEMBLY TO DebugProcLogin 
```

将其导入 SQL Server：

```
USE [mydb]
CREATE ASSEMBLY SqlServerProject1 FROM
'C:\..\SqlServerProject1\bin\Debug\SqlServerProject1.dll' 
WITH PERMISSION_SET = unsafe

CREATE FUNCTION dbo.Debug( @message as nvarchar(200) )
RETURNS int
AS EXTERNAL NAME SqlServerProject1.[StoredProcedures].Debug 
```

然后我能够使用登录 T-SQL 程序

```
exec Debug @message = 'Hello World' 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-12T11:20:47.423

您可以通过简单地插入新行来登录到表，也可以实现 CLR 存储过程来写入文件。

写入表时要小心，因为如果操作发生在事务中并且事务回滚，您的日志条目将消失。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-12T11:22:33.080

从 SQL 存储过程中记录日志最好对数据库本身进行。T-SQL 可以写入文件，但它并不是真正为它设计的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-12T11:24:13.467

有[PRINT](http://msdn.microsoft.com/en-us/library/ms176047%28SQL.90%29.aspx)命令，但我更喜欢登录到表中以便您可以查询它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T23:06:15.190

您可以从存储过程中将行写入日志表。正如其他人所指出的那样，您可以使用 CLR 或 xp_logevent 不遗余力地写入某些文本文件或其他日志，但您似乎需要比此类用途实际更多的容量。

当事务失败时，就会出现棘手的情况（正是这些情况您真正需要您的日志）。由于在这些事务期间发生的任何日志记录都将与它们所属的事务一起回滚，因此最好有一个日志记录 API，您的客户端可以使用它来记录错误。这可以是一个简单的 DAL，既可以记录到同一个数据库，也可以记录到共享数据库。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-19T18:04:43.730

*对于它的价值，我发现当我没有为我的 SqlConnection 分配 InfoMessage 处理程序时：*

```
sqlConnection.InfoMessage += new SqlInfoMessageEventHandler(MySqlConnectionInfoMessageHandler); 
```

*InfoMessageHandler 的签名如下所示：*

```
MySqlConnectionInfoMessageHandler(object sender, SqlInfoMessageEventArgs e) 
```

*然后我的存储过程中的 PRINT 语句不会出现在 DbgView 中。*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T13:48:45.977

您可以使用输出变量来传回消息，但这依赖于 proc 执行时没有错误。

```
create procedure usp_LoggableProc 

@log varchar(max) OUTPUT 

as

-- T-SQL statement here ...

select @log = @log + 'X is foo' 
```

然后在您的 ADO 代码中：

```
string log = (string)SqlCommand.Parameters["@log"].Value; 
```

您可以使用 raiserror 使用您需要的信息创建您自己的自定义错误，这些信息将通过您的 ADO 代码中的常用 SqlException Errors 集合提供给您：

```
RAISERROR('X is Foo', 10, 1) 
```

嗯，但是是的，不禁感觉只是为了调试，在你的情况下，只需像其他人建议的那样将 varchar 消息插入错误表，并在调试时从中选择 *。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-15T08:18:54.830

您可能需要检查[Log4TSQL](http://log4tsql.codeplex.com/ "Raycoon Log4TSQL")。它为 SQL Server 2005 - 2008 中的存储过程和触发器提供数据库日志记录。您可以在每个过程/触发器的基础上设置单独的、独立的日志级别。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-10T07:16:28.190

通过 cmdshell 使用 cmd 命令

我在寻找这个问题的答案时发现了这一点。 [https://www.databasejournal.com/features/mssql/article.php/1467601/A-general-logging-t-sql-process-to-write-to-txt-files.htm](https://www.databasejournal.com/features/mssql/article.php/1467601/A-general-logging-t-sql-process-to-write-to-txt-files.htm)

```
select @cmdtxt = "echo " + @logEntry + " >> drive:\path\filename.txt"
exec master..xp_cmdshell @cmdtxt 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-09-16T04:57:01.460

我一直在寻找一种方法来做到这一点，因为我正在尝试调试一些复杂的、链接的、存储的过程，所有这些都由外部 API 调用，并且在事务的上下文中运行。

我一直在将诊断消息写入日志文件，但如果事务回滚，新的日志条目会随着回滚而消失。我找到了一个方法！而且效果很好。它已经为我节省了很多很多小时的调试时间。

1.  使用登录名的安全上下文创建指向同一 SQL 实例的链接服务器。就我而言，最简单的方法是使用 localhost 循环地址 127.0.0.1

2.  将链接服务器设置为启用 RPC，而不是“启用分布式事务的提升”。这意味着通过该服务器的调用将在您的事务上下文之外进行。

3.  在您的日志记录过程中，（我在下面摘录了一个示例）如果您处于事务中，则使用该过程通过环回链接服务器写入日志表。如果你不是，你可以用通常的方式写信给它。通过链接服务器写入比直接 DML 慢得多。

瞧！我的进程内日志记录在回滚中幸存下来，当事情向南时，我可以找出内部正在发生的事情。

想到这一点，我不能说是功劳——我在 Google 工作了一段时间后找到了这种方法，但我对结果感到非常满意，我觉得我必须分享它。

```
USE TX
GO

CREATE PROCEDURE dbo.LogError(@errorSource Varchar(32), @msg Varchar(400))
AS BEGIN
    SET NOCOUNT ON
       IF @@TRANCOUNT > 0 
            EXEC [127.0.0.1].TX.dbo.LogError @errorSource, @msg 
       ELSE
           INSERT INTO TX.dbo.ErrorLog(source_module, message)
               SELECT @errorSource, @msg
 END
 GO 
```

# python - 您将如何设计一个非常“Pythonic”的 UI 框架？

> ID：58711
> 
> 赞同：13
> 
> 时间：2008-09-12T11:18:04.293
> 
> 标签：python, user-interface, frameworks

我一直在玩 Ruby 库“鞋子”。基本上，您可以通过以下方式编写 GUI 应用程序：

```
Shoes.app do
  t = para "Not clicked!"
  button "The Label" do
    alert "You clicked the button!" # when clicked, make an alert
    t.replace "Clicked!" # ..and replace the label's text
  end
end 
```

这让我想到——我将如何在 Python 中设计一个类似的好用的 GUI 框架？一个没有通常的绑定，基本上是 C* 库的包装器（在 GTK、Tk、wx、QT 等的情况下）

鞋子从 Web 开发（如`#f0c2f0`样式颜色符号、CSS 布局技术等`:margin => 10`）和 ruby​​（以合理的方式广泛使用块）中获取东西

Python 缺乏“红宝石块”使得（隐喻的）直接端口不可能：

```
def Shoeless(Shoes.app):
    self.t = para("Not clicked!")

    def on_click_func(self):
        alert("You clicked the button!")
        self.t.replace("clicked!")

    b = button("The label", click=self.on_click_func) 
```

没有那么干净，也不会*那么*灵活，我什至不确定它是否可以实施。

使用装饰器似乎是一种将代码块映射到特定操作的有趣方式：

```
class BaseControl:
    def __init__(self):
        self.func = None

    def clicked(self, func):
        self.func = func

    def __call__(self):
        if self.func is not None:
            self.func()

class Button(BaseControl):
    pass

class Label(BaseControl):
    pass

# The actual applications code (that the end-user would write)
class MyApp:
    ok = Button()
    la = Label()

    @ok.clicked
    def clickeryHappened():
        print "OK Clicked!"

if __name__ == '__main__':
    a = MyApp()
    a.ok() # trigger the clicked action 
```

基本上，装饰器函数存储函数，然后当动作发生（例如，单击）时，将执行适当的函数。

各种东西的范围（比如`la`上面例子中的标签）可能相当复杂，但它似乎以一种相当简洁的方式可行..

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-12T13:13:57.947

你实际上可以做到这一点，但它需要使用元类，这是*深奥*的魔法（有龙）。[如果您想了解元类， IBM](http://www.ibm.com/developerworks/linux/library/l-pymeta.html)提供了一系列文章，这些文章在介绍这些想法的同时又不会让您费尽心思。

来自像 SQLObject 这样的 ORM 的源代码也可能会有所帮助，因为它使用了同样的声明性语法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-02T19:30:23.107

我从不满意 David Mertz 在 IBM 发表的关于 metaclsses 的文章，所以我最近写了自己的[metaclass 文章](http://askawizard.blogspot.com/2008/09/metaclasses-python-saga-part-4_30.html)。享受。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-03T00:15:11.567

这是非常做作的，根本不是 Pythonic，但这是我尝试使用新的“with”语句进行半字面翻译的尝试。

```
with Shoes():
  t = Para("Not clicked!")
  with Button("The Label"):
    Alert("You clicked the button!")
    t.replace("Clicked!") 
```

最困难的部分是处理 Python 不会给我们提供包含多个语句的匿名函数这一事实。为了解决这个问题，我们可以创建一个命令列表并运行这些...

无论如何，这是我运行它的后端代码：

```
context = None

class Nestable(object):
  def __init__(self,caption=None):
    self.caption = caption
    self.things = []

    global context
    if context:
      context.add(self)

  def __enter__(self):
    global context
    self.parent = context
    context = self

  def __exit__(self, type, value, traceback):
    global context
    context = self.parent

  def add(self,thing):
    self.things.append(thing)
    print "Adding a %s to %s" % (thing,self)

  def __str__(self):
    return "%s(%s)" % (self.__class__.__name__, self.caption)

class Shoes(Nestable):
  pass

class Button(Nestable):
  pass

class Alert(Nestable):
  pass

class Para(Nestable):
  def replace(self,caption):
    Command(self,"replace",caption)

class Command(Nestable):
  def __init__(self, target, command, caption):
    self.command = command
    self.target  = target
    Nestable.__init__(self,caption)

  def __str__(self):
    return "Command(%s text of %s with \"%s\")" % (self.command, self.target, self.caption)

  def execute(self):
    self.target.caption = self.caption 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-03T08:48:06.617

```
## All you need is this class:

class MainWindow(Window):
    my_button = Button('Click Me')
    my_paragraph = Text('This is the text you wish to place')
    my_alert = AlertBox('What what what!!!')

    @my_button.clicked
    def my_button_clicked(self, button, event):
        self.my_paragraph.text.append('And now you clicked on it, the button that is.')

    @my_paragraph.text.changed
    def my_paragraph_text_changed(self, text, event):
        self.button.text = 'No more clicks!'

    @my_button.text.changed
    def my_button_text_changed(self, text, event):
        self.my_alert.show()

## The Style class is automatically gnerated by the framework
## but you can override it by defining it in the class:
##
##      class MainWindow(Window):
##          class Style:
##              my_blah = {'style-info': 'value'}
##
## or like you see below:

class Style:
    my_button = {
        'background-color': '#ccc',
        'font-size': '14px'}
    my_paragraph = {
        'background-color': '#fff',
        'color': '#000',
        'font-size': '14px',
        'border': '1px solid black',
        'border-radius': '3px'}

MainWindow.Style = Style

## The layout class is automatically generated
## by the framework but you can override it by defining it
## in the class, same as the Style class above, or by
## defining it like this:

class MainLayout(Layout):
    def __init__(self, style):
        # It takes the custom or automatically generated style class upon instantiation
        style.window.pack(HBox().pack(style.my_paragraph, style.my_button))

MainWindow.Layout = MainLayout

if __name__ == '__main__':
    run(App(main=MainWindow)) 
```

在 python 中使用一些元类 python 魔法知识会相对容易。我有。以及 PyGTK 的知识。我也有。得到想法？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-15T13:18:54.633

使用一些元类魔法来保持排序，我有以下工作。我不确定它是多么的 Pythonic，但创建简单的东西很有趣。

```
class w(Wndw):
  title='Hello World'
  class txt(Txt):  # either a new class
    text='Insert name here'
  lbl=Lbl(text='Hello') # or an instance
  class greet(Bbt):
    text='Greet'
    def click(self): #on_click method
      self.frame.lbl.text='Hello %s.'%self.frame.txt.text

app=w() 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-02T18:23:10.670

据我所知，这样做的唯一尝试是[Hans Nowak 的蜡](http://zephyrfalcon.org/labs/dope_on_wax.html)（不幸的是，它已经死了）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-02T19:09:45.240

最接近 ruby​​ish 块的是 pep343 中的 with 语句：

[http://www.python.org/dev/peps/pep-0343/](http://www.python.org/dev/peps/pep-0343/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-03T09:18:40.797

如果您将[PyGTK](http://www.pygtk.org/)与[glade](http://glade.gnome.org/)和[这个 glade wrapper](http://www.pixelbeat.org/libs/libglade.py)一起使用，那么 PyGTK 实际上会变得有点 Pythonic。至少一点点。

基本上，您在 Glade 中创建 GUI 布局。您还可以在 glade 中指定事件回调。然后你为你的窗口写一个类，如下所示：

```
class MyWindow(GladeWrapper):
    GladeWrapper.__init__(self, "my_glade_file.xml", "mainWindow")
    self.GtkWindow.show()

    def button_click_event (self, *args):
        self.button1.set_label("CLICKED") 
```

在这里，我假设我在某处有一个名为*button1*的 GTK 按钮，并且我将*button_click_event*指定为*单击*的回调。林间空地包装器在事件映射方面付出了很多努力。

如果我要设计一个 Pythonic GUI 库，我会支持类似的东西，以帮助快速开发。唯一的区别是我会确保小部件也有一个更 Pythonic 的界面。当前的 PyGTK 类对我来说似乎非常 C，除了我使用 foo.bar(...) 而不是 bar(foo, ...) 尽管我不确定我会做些什么不同的事情。可能允许 Django 模型风格的声明性方式在代码中指定小部件和事件，并允许您通过迭代器访问数据（这很有意义，例如小部件列表可能），尽管我还没有真正考虑过。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-12T13:40:35.527

也许不像 Ruby 版本那么流畅，但是像这样的东西怎么样：

```
from Boots import App, Para, Button, alert

def Shoeless(App):
    t = Para(text = 'Not Clicked')
    b = Button(label = 'The label')

    def on_b_clicked(self):
        alert('You clicked the button!')
        self.t.text = 'Clicked!' 
```

[就像贾斯汀所说](https://stackoverflow.com/questions/58711/how-would-you-design-a-very-pythonic-ui-framework#58917)，要实现这一点，您需要在 class 上使用自定义元类，并在and`App`上使用一堆属性。这实际上不会太难。`Para``Button`

接下来遇到的问题是：如何跟踪事物在类定义中出现的*顺序？*在 Python 2.x 中，无法知道是否`t`应该高于`b`或相反，因为您将类定义的内容作为 python 接收`dict`。

但是，在 Python 3.0中，[元类正在](http://www.python.org/dev/peps/pep-3115/)以几种（次要）方式进行更改。其中之一是`__prepare__`方法，它允许您提供自己的自定义类字典对象来代替使用——这意味着您将能够跟踪项目的定义顺序，并在窗口中相应地定位它们。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-13T14:20:42.083

这可能过于简单化了，我认为尝试以这种方式制作通用 ui 库不是一个好主意。另一方面，您可以使用这种方法（元类和朋友）来简化现有 ui 库的某些用户界面类的定义，并根据应用程序实际可以节省大量时间和代码行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-02T17:48:06.700

我有着同样的问题。我想为 Python 的任何 GUI 工具包创建一个包装器，该工具包易于使用，并受到鞋子的启发，但需要是一种 OOP 方法（针对 ruby​​ 块）。

更多信息请访问：[http ://wiki.alcidesfonseca.com/blog/python-universal-gui-revisited](http://wiki.alcidesfonseca.com/blog/python-universal-gui-revisited)

欢迎任何人加入该项目。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-02T20:37:49.680

如果你真的想编写 UI，你可以尝试获得类似于 django 的 ORM 的东西；像这样获得一个简单的帮助浏览器：

```
class MyWindow(Window):
    class VBox:
        entry = Entry()
        bigtext = TextView()

        def on_entry_accepted(text):
            bigtext.value = eval(text).__doc__ 
```

这个想法是将一些容器（如窗口）解释为简单的类，将一些容器（如表、v/hbox）解释为对象名称，并将简单的小部件解释为对象。

我认为不必为窗口内的所有容器命名，因此需要一些快捷方式（例如通过名称将旧式类识别为小部件）。

关于元素的顺序：在上面的 MyWindow 中，您不必跟踪它（窗口在概念上是一个单槽容器）。在其他容器中，您可以尝试跟踪顺序，假设每个小部件构造函数都可以访问一些全局小部件列表。这就是它在 django (AFAIK) 中的完成方式。

这里很少有技巧，那里很少调整......仍然需要考虑的事情很少，但我相信这是可能的......并且可以使用，只要您不构建复杂的用户界面。

不过我对 PyGTK+Glade 很满意。UI 对我来说只是一种数据，它应该被视为数据。需要调整的参数太多（比如不同位置的间距），最好使用 GUI 工具来管理。因此，我在 Glade 中构建我的 UI，保存为 xml 并使用 gtk.glade.XML() 进行解析。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-02T21:03:49.173

就个人而言，我会尝试在 GUI 框架中实现类似于 API 的[JQuery 。](http://docs.jquery.com/Main_Page)

```
class MyWindow(Window):
    contents = (
        para('Hello World!'),
        button('Click Me', id='ok'),
        para('Epilog'),
    )

    def __init__(self):
        self['#ok'].click(self.message)
        self['para'].hover(self.blend_in, self.blend_out)

    def message(self):
        print 'You clicked!'

    def blend_in(self, object):
        object.background = '#333333'

    def blend_out(self, object):
        object.background = 'WindowBackground' 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-03T02:37:06.600

这是一种使用基于类的元编程而不是继承来进行 GUI 定义的方法。

这是 Django/SQLAlchemy 的灵感来源，因为它在很大程度上基于元编程，并将您的 GUI 代码与“代码代码”分开。我还认为它应该像 Java 那样大量使用布局管理器，因为当您删除代码时，没有人愿意不断调整像素对齐。我也认为如果我们可以拥有类似 CSS 的属性会很酷。

这是一个粗略的头脑风暴示例，它将显示一个顶部带有标签的列，然后是一个文本框，然后是一个用于单击底部的按钮以显示一条消息。

```
从 happygui.controls 导入 *

MAIN_WINDOW = 窗口（宽度=“500px”，高度=“350px”，
    my_layout=ColumnLayout(padding="10px",
        my_label=Lab​​el(text="你叫什么名字？", bold=True, align="center"),
        my_edit=EditBox(placeholder=""),
        my_btn=Button(text="CLICK ME!", on_click=Handler('module.file.btn_clicked')),
    ),
)
MAIN_WINDOW.show()

def btn_clicked(sender): # 很容易在 handlers.py 文件中
    名称 = MAIN_WINDOW.my_layout.my_edit.text
    # 同样的事情：name = sender.parent.my_edit.text
    # 最佳实践，不受结构变化影响：MAIN_WINDOW.find('my_edit').text
    MessageBox("你的名字是'%s'" % ()).show(modal=True)

```

要注意的一件很酷的事情是您可以通过说来引用 my_edit 的输入`MAIN_WINDOW.my_layout.my_edit.text`。在窗口的声明中，我认为能够在函数 kwargs 中任意命名控件是很重要的。

这是仅使用绝对定位的同一个应用程序（控件将出现在不同的位置，因为我们没有使用花哨的布局管理器）：

```
从 happygui.controls 导入 *

MAIN_WINDOW = 窗口（宽度=“500px”，高度=“350px”，
    my_label=Lab​​el(text="What's your name Kiddo?", bold=True, align="center", x="10px", y="10px", width="300px", height="100px"),
    my_edit=EditBox(placeholder="", x="10px", y="110px", width="300px", height="100px"),
    my_btn=Button(text="CLICK ME!", on_click=Handler('module.file.btn_clicked'), x="10px", y="210px", width="300px", height="100px"),
)
MAIN_WINDOW.show()

def btn_clicked(sender): # 很容易在 handlers.py 文件中
    名称 = MAIN_WINDOW.my_edit.text
    # 同样的事情：name = sender.parent.my_edit.text
    # 最佳实践，不受结构变化影响：MAIN_WINDOW.find('my_edit').text
    MessageBox("你的名字是'%s'" % ()).show(modal=True)

```

我还不完全确定这是否是一个超级棒的方法，但我绝对认为它走在正确的道路上。我没有时间更多地探索这个想法，但如果有人把它作为一个项目，我会喜欢他们的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-02T20:48:23.247

声明性不一定比功能性恕我直言更多（或更少）pythonic。我认为分层方法是最好的（自下而上）：

1.  接受和返回 python 数据类型的本机层。
2.  一个功能性的动态层。
3.  一个或多个声明性/面向对象的层。

类似于[Elixir](http://elixir.ematia.de/trac/wiki) + [SQLAlchemy](http://www.sqlalchemy.org/)。

# c++ - 用于 C/C++ 应用程序的开源 PDF 库？

> ID：58730
> 
> 赞同：95
> 
> 时间：2008-09-12T11:31:20.190
> 
> 标签：c++, c, pdf, open-source

我希望能够从我的（本机）C++ Windows 应用程序生成 PDF 输出。是否有任何免费/开源库可用于执行此操作？

我查看了[这个问题](https://stackoverflow.com/questions/177/how-do-i-programmatically-create-a-pdf-in-my-net-application)的答案，但它们大多与.Net 有关。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-12T11:35:25.373

[自由哈鲁](https://github.com/libharu/libharu)

> Haru 是一个免费的、跨平台的、开源的软件库，用于生成用 ANSI-C 编写的 PDF。它可以用作静态库（.a、.lib）和共享库（.so、.dll）。

自己没有尝试过，但也许它可以帮助你

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-06T16:16:04.010

我参与了一个需要 pdf 报告的项目。在网上搜索后，我找到了 PoDoFo 库。看起来很健壮。我不需要所有的功能，所以我创建了一个包装器来抽象出一些复杂性。并不太难。你可以在这里找到图书馆：

[http://podofo.sourceforge.net/](http://podofo.sourceforge.net/)

享受！

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-12T11:41:50.570

如果您有勇气并愿意自己动手​​，您可以从 PostScript 库开始，并利用 Adob​​e 的[免费在线 PDF 参考](http://www.adobe.com/devnet/acrobat/pdfs/pdf_reference_1-7.pdf)来扩充它以处理 PDF 。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-12T12:00:05.690

这取决于您的需求。一些工具包更擅长绘图，其他工具包更适合编写文本。[Cairo](http://en.wikipedia.org/wiki/Cairo_(graphics))非常适合绘图（它支持多种屏幕和文件类型，包括 pdf），但它可能不适合良好的排版。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-01-03T00:56:04.880

PDF 鹰嘴豆泥。请参阅[http://pdfhummus.com/](http://pdfhummus.com/) - 包含处理 PDF 文件所需的所有功能，但渲染除外。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-10-24T07:36:47.377

[jagpdf](http://www.jagpdf.org)似乎就是其中之一。它是用 C++ 编写的，但提供了 C API。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-12T11:57:45.243

*   [LibHaru](http://libharu.org/wiki/Main_Page)似乎被许多人使用。

一种非开源方法是：[PDF Creator Pilot](http://www.colorpilot.com/pdflibrary.html)，它提供了更多的语言选项，包括 C++、C#、Delphi、ASP、ASP.NET、VB、VB.NET、VBScript、PHP 和 Python

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-05-13T11:52:12.470

muPdf 库看起来很有前途：[http ://mupdf.com/](http://mupdf.com/)

还有一个开源查看器：[http ://blog.kowalczyk.info/software/sumatrapdf/free-pdf-reader.html](http://blog.kowalczyk.info/software/sumatrapdf/free-pdf-reader.html)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-11-24T09:56:10.363

试试[wkhtmltopdf](http://www.cyberciti.biz/open-source/html-to-pdf-freeware-linux-osx-windows-software/)

软件功能

跨平台。开源。使用 webkit 将任何网页转换为 PDF 文档。您可以添加页眉和页脚。TOC 生成。批处理模式转换。可以在带有 XServer 的 Linux 服务器上运行（必须安装 X11 客户端库）。可以通过绑定到 libwkhtmltox 直接由 PHP 或 Python 使用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-02-13T19:30:14.000

[http://wxcode.sourceforge.net/docs/wxpdfdoc/](http://wxcode.sourceforge.net/docs/wxpdfdoc/)

与 wxWidgets 库一起使用。

# .net - 面试题：WPF开发者

> ID：58739
> 
> 赞同：182
> 
> 时间：2008-09-12T11:36:58.227
> 
> 标签：.net, wpf

每个 WPF 开发人员都应该知道什么？

**入门级**

*   强大的 .NET 2.0 背景并愿意学习！
*   解释依赖属性？
*   什么是风格？
*   什么是模板？
*   捆绑
*   基类之间的区别：Visual、UIElement、FrameworkElement、Control
*   视觉与逻辑树？
*   属性更改通知（INotifyPropertyChange 和 ObservableCollection）
*   ResourceDictionary - 由 a7an 添加
*   用户控件 - 由 a7an 添加
*   气泡和隧道路由策略之间的区别 - 由 Carlo 添加
*   为什么微软要引入另一种标记语言？
*   XAML

**中级**

*   路由事件和命令
*   转换器 - 由 Artur Carvalho 添加
*   解释 WPF 的 2-pass 布局引擎？
*   如何实现面板？
*   互操作性（WPF/WinForms）
*   [混合](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend)/[苹果酒](http://en.wikipedia.org/wiki/TransGaming_Technologies#Cider)- 由 a7an 添加
*   动画和故事板
*   [ClickOnce 部署](http://en.wikipedia.org/wiki/ClickOnce)
*   皮肤/主题
*   自定义控件
*   工作线程如何更新 UI？
*   DataTemplate 与 HierarchicalDataTemplate
*   ItemsControl vs ItemsPresenter vs ContentControl vs ContentPresenter
*   不同类型的触发器

**高级的**

*   附加行为的例子？
*   什么是棱镜、CAL 和 CAG？
*   工作线程如何更新 UI？
*   WPF 3D - 由 a7an 添加
*   Silverlight 2 和 WPF 之间的差异
*   MVVM/MVP - 由 a7an 添加
*   WPF 性能调优
*   像素着色器
*   Freezables 的目的

还有其他~~“技巧”~~问题要问吗？

您希望您的 WPF 开发人员了解 blend 吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-17T08:59:44.460

I'm surprised no one has mentioned basic knowledge of XAML yet. Knowing what XAML is, and the ability to do some basic editing using XAML rather than a graphical design tool. Mid-level developers should be able to knock up form / graphic prototypes using a tool like XAMLPad.

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-07-12T12:21:07.993

就我个人而言，我会让他们坐在标准的开发人员构建机器前，并要求他们完成一些任务。没有问题，只需在几个小时后看看他们的代码是什么样的（如果任务更长，则更多）。

根据实际的现实生活编程测试的结果，我做出招聘决定的失败率为零。

任务不必太难。过去，我使用过一个简单的每日消息应用程序，消息保存在数据库或 XML 文件和一个简单的用户界面中。确保你要求他们很好地组织它（因为任务足够小，如果他们觉得有兴趣，可以在一个班级里完成）。

在上面的问题中，我想说你无法很好地了解它们是否真的有好处。一个潜在的候选人实际上可以阅读这些并创建听起来很棒的罐头答案。所有这些都表明候选人可以说是可以说的，但对工作本身来说，重要的是他们是否会走路。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-15T21:50:32.063

我会将绑定和转换器放在入门级，因为这就是您在 WPF 中花费大量时间的方式。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-12T11:41:22.490

在我看来相当不错的清单。
但是我不会在面试时问*棘手的问题。*面试本身就有足够的压力，技巧性的问题即使是技术高超的人也会感到困惑。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-10-03T13:42:58.977

就个人而言，我会将“工作线程如何更新 UI”放在入门级下面。中级，如果你真的需要的话。如果一个入门级的程序员能够理解逻辑树和可视化树之间的区别，他们应该明白如何从后台线程更新 UI。

在我的组织中，我们在没有 Blend 的情况下进行了很多 WPF 开发。我不是特别喜欢 Blend，所以我有点偏见，但我认为 Blend 技能应该是一个不错的选择。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-07-12T12:05:20.377

WPF 开发人员应该牢牢掌握将 XAML 与代码隐藏分开的能力，并且能够详细讨论该线的绘制位置。

能够以她选择的语言设置模型，然后使用 XAML 通过数据绑定、数据模板、控件模板、样式、触发器、值转换器和用户控件来显示该模型上的视图，这对于 mid 来说是一项相当基本的任务级程序员。（尽管如果要求某人“发自内心地”创建控制模板之类的东西，则应给予少量余地。）

确实， WPF 中*有很多*内容，如果没有 MSDN 论坛和有关该主题的深入书籍，“随便捡起来”将是一项艰巨的任务。出于这个原因，我认为毅力和向他人学习的能力是任何级别的最高要求。

对于入门级 WPF 程序员，我不期望 WPF 本身有任何知识，但我需要了解面向对象的原则、将 UI 与业务逻辑分离以及熟悉类似的事件模型。以类似于 WPF（使用 DockPanel 容器等）的样式布置 UI 元素的经验是一个加分项。

编辑：另外，科林麦凯所说的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-03-16T15:35:36.783

一般的 GUI 编程/图形经验和 cs 知识怎么样？如果是全职工作，恕我直言，如果他（或她）有很强的背景，他是否必须在前几个月花一些时间学习 WPF，这并不重要。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-12T18:12:32.003

**入门级**

*   属性更改通知（INotifyPropertyChange 和 ObservableCollection）
*   资源字典
*   用户控件

**中级**

*   混合/苹果酒
*   动画和故事板
*   ClickOnce 部署

**高级的**

*   WPF 3D
*   Silverlight 2 和 WPF 之间的差异
*   MVVM/MVP
*   WPF 性能调优
*   像素着色器

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-04-22T14:10:26.553

*   线程和Dispatchers是什么关系？
*   Freezables的目的是什么？
*   属性和依赖属性有什么区别？为什么要使用一个或另一个？

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-12T13:38:07.030

*   转换器（简单和多）。
*   互操作性。

我想我更喜欢会知道**Blend**的开发人员。他/她可以轻松地与设计师交流，并且比仅用 xaml 编写更快地完成一些基本的设计师工作。

该列表很有趣，也许指向主题的链接会有所帮助。

干杯

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-08-17T21:29:08.113

另一个真正基本的事情是气泡和隧道路由策略之间的区别。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2010-07-20T05:51:34.000

入门级

*   UX设计知识
*   业务对象的声明式绑定知识
*   命令用法

高级的

*   资源优化和性能调优
*   模块化和可扩展性
*   异步编程模型

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-01T18:24:56.427

中级或高级

*   皮肤/主题
*   自定义控件

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-06-13T17:43:53.930

*   DataTemplate 与 HierarchicalDataTemplate
*   ItemsControl vs ItemsPresenter vs ContentControl vs ContentPresenter
*   不同类型的触发器
*   如何通过 StoryBoard 制作动画

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-14T09:59:35.743

中级或高级：WinForms 和 WPF InterOp。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-01T15:13:00.040

我认为 WPF 应用程序的生命周期——从创建到运行时应该包含在初学者级别的问题中。在不知情的情况下，很难相信一个真正的 WPF 开发人员。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-02T09:19:33.937

我一般会使用 WPF 部署扩展 ClickOnce 部署，因为最好了解每个模型的限制和特性（仅限 ClickOnce、XBAP、浏览器）。不过，将其置于中等水平似乎是公平的。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-04-11T13:52:07.790

了解单元测试及其对您如何使用 WPF 的影响是我将在入门级时提出的一项基本技能。人们可以学习细节，但如果他们没有考虑过软件设计的基础知识，那么你就有问题了。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-11-28T13:55:33.560

放入数据模板选择器：[http](http://www.switchonthecode.com/tutorials/wpf-tutorial-how-to-use-a-datatemplateselector) : //www.switchonthecode.com/tutorials/wpf-tutorial-how-to-use-a-datatemplateselector 对 MVVM 根据值换出模板有很大帮助。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-03-25T10:53:53.050

样式提供了一种机制，让您可以在应用程序中应用主题并在您想要的特定实例中覆盖该主题。样式被定义为资源；事实上，它们是在定义资源的 XAML 文件的同一部分中定义的。

# .net - 将枚举属性数据绑定到 WPF 中的组合框

> ID：58743
> 
> 赞同：267
> 
> 时间：2008-09-12T11:38:18.223
> 
> 标签：.net, wpf

以以下代码为例：

```
public enum ExampleEnum { FooBar, BarFoo }

public class ExampleClass : INotifyPropertyChanged
{
    private ExampleEnum example;

    public ExampleEnum ExampleProperty 
    { get { return example; } { /* set and notify */; } }
} 
```

我想要将属性 ExampleProperty 数据绑定到 ComboBox，以便它显示选项“FooBar”和“BarFoo”并在 TwoWay 模式下工作。理想情况下，我希望我的 ComboBox 定义看起来像这样：

```
<ComboBox ItemsSource="What goes here?" SelectedItem="{Binding Path=ExampleProperty}" /> 
```

目前，我在我的窗口中安装了 ComboBox.SelectionChanged 和 ExampleClass.PropertyChanged 事件的处理程序，我在其中手动进行绑定。

有更好的或某种规范的方式吗？您通常会使用转换器吗？如何使用正确的值填充 ComboBox？我现在什至不想开始使用 i18n。

**编辑**

所以回答了一个问题：如何使用正确的值填充 ComboBox。

通过 ObjectDataProvider 从静态 Enum.GetValues 方法检索 Enum 值作为字符串列表：

```
<Window.Resources>
    <ObjectDataProvider MethodName="GetValues"
        ObjectType="{x:Type sys:Enum}"
        x:Key="ExampleEnumValues">
        <ObjectDataProvider.MethodParameters>
            <x:Type TypeName="ExampleEnum" />
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
</Window.Resources> 
```

这可以用作我的 ComboBox 的 ItemsSource：

```
<ComboBox ItemsSource="{Binding Source={StaticResource ExampleEnumValues}}"/> 
```

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2010-12-09T13:35:06.373

您可以创建自定义标记扩展。

使用示例：

```
enum Status
{
    [Description("Available.")]
    Available,
    [Description("Not here right now.")]
    Away,
    [Description("I don't have time right now.")]
    Busy
} 
```

在 XAML 的顶部：

```
 xmlns:my="clr-namespace:namespace_to_enumeration_extension_class 
```

接着...

```
<ComboBox 
    ItemsSource="{Binding Source={my:Enumeration {x:Type my:Status}}}" 
    DisplayMemberPath="Description" 
    SelectedValue="{Binding CurrentStatus}"  
    SelectedValuePath="Value"  /> 
```

以及实施...

```
public class EnumerationExtension : MarkupExtension
  {
    private Type _enumType;

    public EnumerationExtension(Type enumType)
    {
      if (enumType == null)
        throw new ArgumentNullException("enumType");

      EnumType = enumType;
    }

    public Type EnumType
    {
      get { return _enumType; }
      private set
      {
        if (_enumType == value)
          return;

        var enumType = Nullable.GetUnderlyingType(value) ?? value;

        if (enumType.IsEnum == false)
          throw new ArgumentException("Type must be an Enum.");

        _enumType = value;
      }
    }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
      var enumValues = Enum.GetValues(EnumType);

      return (
        from object enumValue in enumValues
        select new EnumerationMember{
          Value = enumValue,
          Description = GetDescription(enumValue)
        }).ToArray();
    }

    private string GetDescription(object enumValue)
    {
      var descriptionAttribute = EnumType
        .GetField(enumValue.ToString())
        .GetCustomAttributes(typeof (DescriptionAttribute), false)
        .FirstOrDefault() as DescriptionAttribute;

      return descriptionAttribute != null
        ? descriptionAttribute.Description
        : enumValue.ToString();
    }

    public class EnumerationMember
    {
      public string Description { get; set; }
      public object Value { get; set; }
    }
  } 
```

* * *

## 回答 #2

> 赞同：197
> 
> 时间：2011-04-27T11:13:39.030

在视图模型中，您可以拥有：

```
public MyEnumType SelectedMyEnumType 
{
    get { return _selectedMyEnumType; }
    set { 
            _selectedMyEnumType = value;
            OnPropertyChanged("SelectedMyEnumType");
        }
}

public IEnumerable<MyEnumType> MyEnumTypeValues
{
    get
    {
        return Enum.GetValues(typeof(MyEnumType))
            .Cast<MyEnumType>();
    }
} 
```

在 XAML 中，`ItemSource`绑定到`MyEnumTypeValues`并`SelectedItem`绑定到 `SelectedMyEnumType`.

```
<ComboBox SelectedItem="{Binding SelectedMyEnumType}" ItemsSource="{Binding MyEnumTypeValues}"></ComboBox> 
```

* * *

## 回答 #3

> 赞同：108
> 
> 时间：2012-09-13T22:26:58.907

我不喜欢在 UI 中使用枚举的名称。我更喜欢使用不同的用户值（`DisplayMemberPath`）和不同的值（在这种情况下为枚举）（`SelectedValuePath`）。这两个值可以打包`KeyValuePair`并存储在字典中。

XAML

```
<ComboBox Name="fooBarComboBox" 
          ItemsSource="{Binding Path=ExampleEnumsWithCaptions}" 
          DisplayMemberPath="Value" 
          SelectedValuePath="Key"
          SelectedValue="{Binding Path=ExampleProperty, Mode=TwoWay}" > 
```

C＃

```
public Dictionary<ExampleEnum, string> ExampleEnumsWithCaptions { get; } =
    new Dictionary<ExampleEnum, string>()
    {
        {ExampleEnum.FooBar, "Foo Bar"},
        {ExampleEnum.BarFoo, "Reversed Foo Bar"},
        //{ExampleEnum.None, "Hidden in UI"},
    };

private ExampleEnum example;
public ExampleEnum ExampleProperty
{
    get { return example; }
    set { /* set and notify */; }
} 
```

编辑：与 MVVM 模式兼容。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2008-09-12T11:54:40.540

我不知道在 XAML-only 中是否可行，但请尝试以下操作：

为您的 ComboBox 命名，以便您可以在代码隐藏中访问它：“typesComboBox1”

现在尝试以下

```
typesComboBox1.ItemsSource = Enum.GetValues(typeof(ExampleEnum)); 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2015-01-27T14:58:30.997

使用 ObjectDataProvider：

```
<ObjectDataProvider x:Key="enumValues"
   MethodName="GetValues" ObjectType="{x:Type System:Enum}">
      <ObjectDataProvider.MethodParameters>
           <x:Type TypeName="local:ExampleEnum"/>
      </ObjectDataProvider.MethodParameters>
 </ObjectDataProvider> 
```

然后绑定到静态资源：

```
ItemsSource="{Binding Source={StaticResource enumValues}}" 
```

[在这个博客上](https://druss.co/2015/01/wpf-binding-itemssource-to-enum/)找到这个解决方案

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2011-10-07T09:35:22.637

根据[ageektrapped](http://www.ageektrapped.com/blog/the-missing-net-7-displaying-enums-in-wpf/)提供的已接受但现已删除的答案，我创建了一个精简版，没有一些更高级的功能。所有代码都包含在此处，以允许您复制粘贴它而不会被链接腐烂阻止。

我使用`System.ComponentModel.DescriptionAttribute`which 真正用于设计时描述。如果您不喜欢使用此属性，您可以创建自己的属性，但我认为使用此属性确实可以完成工作。如果您不使用该属性，则名称将默认为代码中枚举值的名称。

```
public enum ExampleEnum {

  [Description("Foo Bar")]
  FooBar,

  [Description("Bar Foo")]
  BarFoo

} 
```

这是用作项目源的类：

```
public class EnumItemsSource : Collection<String>, IValueConverter {

  Type type;

  IDictionary<Object, Object> valueToNameMap;

  IDictionary<Object, Object> nameToValueMap;

  public Type Type {
    get { return this.type; }
    set {
      if (!value.IsEnum)
        throw new ArgumentException("Type is not an enum.", "value");
      this.type = value;
      Initialize();
    }
  }

  public Object Convert(Object value, Type targetType, Object parameter, CultureInfo culture) {
    return this.valueToNameMap[value];
  }

  public Object ConvertBack(Object value, Type targetType, Object parameter, CultureInfo culture) {
    return this.nameToValueMap[value];
  }

  void Initialize() {
    this.valueToNameMap = this.type
      .GetFields(BindingFlags.Static | BindingFlags.Public)
      .ToDictionary(fi => fi.GetValue(null), GetDescription);
    this.nameToValueMap = this.valueToNameMap
      .ToDictionary(kvp => kvp.Value, kvp => kvp.Key);
    Clear();
    foreach (String name in this.nameToValueMap.Keys)
      Add(name);
  }

  static Object GetDescription(FieldInfo fieldInfo) {
    var descriptionAttribute =
      (DescriptionAttribute) Attribute.GetCustomAttribute(fieldInfo, typeof(DescriptionAttribute));
    return descriptionAttribute != null ? descriptionAttribute.Description : fieldInfo.Name;
  }

} 
```

您可以像这样在 XAML 中使用它：

```
<Windows.Resources>
  <local:EnumItemsSource
    x:Key="ExampleEnumItemsSource"
    Type="{x:Type local:ExampleEnum}"/>
</Windows.Resources>
<ComboBox
  ItemsSource="{StaticResource ExampleEnumItemsSource}"
  SelectedValue="{Binding ExampleProperty, Converter={StaticResource ExampleEnumItemsSource}}"/> 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-16T16:06:52.380

你可以考虑这样的事情：

1.  定义文本块的样式，或您想用来显示枚举的任何其他控件：

    ```
    <Style x:Key="enumStyle" TargetType="{x:Type TextBlock}">
        <Setter Property="Text" Value="&lt;NULL&gt;"/>
        <Style.Triggers>
            <Trigger Property="Tag">
                <Trigger.Value>
                    <proj:YourEnum>Value1<proj:YourEnum>
                </Trigger.Value>
                <Setter Property="Text" Value="{DynamicResource yourFriendlyValue1}"/>
            </Trigger>
            <!-- add more triggers here to reflect your enum -->
        </Style.Triggers>
    </Style> 
    ```

2.  定义 ComboBoxItem 的样式

    ```
    <Style TargetType="{x:Type ComboBoxItem}">
        <Setter Property="ContentTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Tag="{Binding}" Style="{StaticResource enumStyle}"/>
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
    ```

3.  添加一个组合框并使用您的枚举值加载它：

    ```
    <ComboBox SelectedValue="{Binding Path=your property goes here}" SelectedValuePath="Content">
        <ComboBox.Items>
            <ComboBoxItem>
                <proj:YourEnum>Value1</proj:YourEnum>
            </ComboBoxItem>
        </ComboBox.Items>
    </ComboBox> 
    ```

如果你的枚举很大，你当然可以在代码中做同样的事情，省去很多打字。我喜欢这种方法，因为它使本地化变得容易 - 你定义所有模板一次，然后，你只更新你的字符串资源文件。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-07-13T19:12:28.320

我最喜欢的方法是使用 a `ValueConverter`，以便 ItemsSource 和 SelectedValue 都绑定到同一个属性。这**不需要额外的属性**来保持你的 ViewModel 干净整洁。

```
<ComboBox ItemsSource="{Binding Path=ExampleProperty, Converter={x:EnumToCollectionConverter}, Mode=OneTime}"
          SelectedValuePath="Value"
          DisplayMemberPath="Description"
          SelectedValue="{Binding Path=ExampleProperty}" /> 
```

以及转换器的定义：

```
public static class EnumHelper
{
  public static string Description(this Enum e)
  {
    return (e.GetType()
             .GetField(e.ToString())
             .GetCustomAttributes(typeof(DescriptionAttribute), false)
             .FirstOrDefault() as DescriptionAttribute)?.Description ?? e.ToString();
  }
}

[ValueConversion(typeof(Enum), typeof(IEnumerable<ValueDescription>))]
public class EnumToCollectionConverter : MarkupExtension, IValueConverter
{
  public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
  {
    return Enum.GetValues(value.GetType())
               .Cast<Enum>()
               .Select(e => new ValueDescription() { Value = e, Description = e.Description()})
               .ToList();
  }
  public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
  {
    return null;
  }
  public override object ProvideValue(IServiceProvider serviceProvider)
  {
    return this;
  }
} 
```

该转换器适用于任何枚举。`ValueDescription`只是一个带有`Value`属性和`Description`属性的简单类。您可以轻松地使用`Tuple`with `Item1`and`Item2`或`KeyValuePair`with `Key`and`Value`而不是 Value and Description 或您选择的任何其他类，只要它可以包含该枚举值的枚举值和字符串描述。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-02-20T09:54:40.497

这是使用辅助方法的通用解决方案。这也可以处理任何底层类型的枚举（byte、sbyte、uint、long 等）

辅助方法：

```
static IEnumerable<object> GetEnum<T>() {
    var type    = typeof(T);
    var names   = Enum.GetNames(type);
    var values  = Enum.GetValues(type);
    var pairs   =
        Enumerable.Range(0, names.Length)
        .Select(i => new {
                Name    = names.GetValue(i)
            ,   Value   = values.GetValue(i) })
        .OrderBy(pair => pair.Name);
    return pairs;
}//method 
```

查看型号：

```
public IEnumerable<object> EnumSearchTypes {
    get {
        return GetEnum<SearchTypes>();
    }
}//property 
```

组合框：

```
<ComboBox
    SelectedValue       ="{Binding SearchType}"
    ItemsSource         ="{Binding EnumSearchTypes}"
    DisplayMemberPath   ="Name"
    SelectedValuePath   ="Value"
/> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-04-26T03:46:35.840

如果您使用的是 MVVM，根据@rudigrobler 的回答，您可以执行以下操作：

将以下属性添加到**ViewModel**类

```
public Array ExampleEnumValues => Enum.GetValues(typeof(ExampleEnum)); 
```

然后在 XAML 中执行以下操作：

```
<ComboBox ItemsSource="{Binding ExampleEnumValues}" ... /> 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-06-30T15:48:42.533

这是一个`DevExpress`基于投票最高的答案的具体答案`Gregor S.`（目前有 128 票）。

这意味着我们可以在整个应用程序中保持样式一致：

![在此处输入图像描述](https://i.stack.imgur.com/khGqs.png)

不幸的是，原始答案不适用于`ComboBoxEdit`来自 DevExpress 的未经一些修改。

首先，用于的 XAML `ComboBoxEdit`：

```
<dxe:ComboBoxEdit ItemsSource="{Binding Source={xamlExtensions:XamlExtensionEnumDropdown {x:myEnum:EnumFilter}}}"
    SelectedItem="{Binding BrokerOrderBookingFilterSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
    DisplayMember="Description"
    MinWidth="144" Margin="5" 
    HorizontalAlignment="Left"
    IsTextEditable="False"
    ValidateOnTextInput="False"
    AutoComplete="False"
    IncrementalFiltering="True"
    FilterCondition="Like"
    ImmediatePopup="True"/> 
```

不用说，您需要指向`xamlExtensions`包含 XAML 扩展类（定义如下）的命名空间：

```
xmlns:xamlExtensions="clr-namespace:XamlExtensions" 
```

我们必须指向`myEnum`包含枚举的命名空间：

```
xmlns:myEnum="clr-namespace:MyNamespace" 
```

然后，枚举：

```
namespace MyNamespace
{
    public enum EnumFilter
    {
        [Description("Free as a bird")]
        Free = 0,

        [Description("I'm Somewhat Busy")]
        SomewhatBusy = 1,

        [Description("I'm Really Busy")]
        ReallyBusy = 2
    }
} 
```

XAML 的问题是我们不能使用`SelectedItemValue`，因为这会引发错误，因为 setter 无法访问（您的疏忽，`DevExpress`）。所以我们必须修改我们`ViewModel`的直接从对象中获取值：

```
private EnumFilter _filterSelected = EnumFilter.All;
public object FilterSelected
{
    get
    {
        return (EnumFilter)_filterSelected;
    }
    set
    {
        var x = (XamlExtensionEnumDropdown.EnumerationMember)value;
        if (x != null)
        {
            _filterSelected = (EnumFilter)x.Value;
        }
        OnPropertyChanged("FilterSelected");
    }
} 
```

为了完整起见，这里是原始答案的 XAML 扩展（稍微重命名）：

```
namespace XamlExtensions
{
    /// <summary>
    ///     Intent: XAML markup extension to add support for enums into any dropdown box, see http://bit.ly/1g70oJy. We can name the items in the
    ///     dropdown box by using the [Description] attribute on the enum values.
    /// </summary>
    public class XamlExtensionEnumDropdown : MarkupExtension
    {
        private Type _enumType;

        public XamlExtensionEnumDropdown(Type enumType)
        {
            if (enumType == null)
            {
                throw new ArgumentNullException("enumType");
            }

            EnumType = enumType;
        }

        public Type EnumType
        {
            get { return _enumType; }
            private set
            {
                if (_enumType == value)
                {
                    return;
                }

                var enumType = Nullable.GetUnderlyingType(value) ?? value;

                if (enumType.IsEnum == false)
                {
                    throw new ArgumentException("Type must be an Enum.");
                }

                _enumType = value;
            }
        }

        public override object ProvideValue(IServiceProvider serviceProvider)
        {
            var enumValues = Enum.GetValues(EnumType);

            return (
                from object enumValue in enumValues
                select new EnumerationMember
                       {
                           Value = enumValue,
                           Description = GetDescription(enumValue)
                       }).ToArray();
        }

        private string GetDescription(object enumValue)
        {
            var descriptionAttribute = EnumType
                .GetField(enumValue.ToString())
                .GetCustomAttributes(typeof (DescriptionAttribute), false)
                .FirstOrDefault() as DescriptionAttribute;

            return descriptionAttribute != null
                ? descriptionAttribute.Description
                : enumValue.ToString();
        }

        #region Nested type: EnumerationMember
        public class EnumerationMember
        {
            public string Description { get; set; }
            public object Value { get; set; }
        }
        #endregion
    }
} 
```

*免责声明：我与 DevExpress 没有任何关系。Telerik 也是一个很棒的图书馆。*

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-12-17T01:01:58.963

看到某些过于复杂的解决方案如何成为最微不足道的问题的“标准（反）模式”令人痛苦：`MarkupExtension`应该避免实现 a 的开销和复杂性，尤其是用属性装饰枚举值。只需实现一个数据模型。

通常，向用户显示枚举值名称是一个坏主意。枚举并不意味着在 UI 中显示。它们是在编程上下文中使用的常量。值名称不用于显示。它们是针对工程师的，因此这些名称通常使用特殊的语义和词汇，就像科学词汇并不意味着公众可以理解一样。不要犹豫，为显示的值创建一个专用源。

当涉及到本地化时，问题变得更加明显。
这就是为什么所有发布的答案都只是过度设计的原因。他们使一个非常简单的问题看起来像一个关键问题。
事实上，最简单的解决方案是最好的。原始问题的主题绝对*不是*例外。
我强烈建议不要提供任何答案。尽管它们可能有效，但它们给一个微不足道的问题增加了不必要的复杂性。

请注意，您始终可以通过调用 static [`Enum.GetValues`](https://docs.microsoft.com/en-us/dotnet/api/system.enum.getvalues?view=net-6.0#System_Enum_GetValues_System_Type_)or将枚举转换为其值或值名称的列表[`Enum.GetNames`](https://docs.microsoft.com/en-us/dotnet/api/system.enum.getnames?view=net-6.0)，它们都返回`IEnumerable`您可以直接分配给`ComboBox.ItemsSource`属性的 an，例如，通过数据绑定。

```
IEnumerable<ExampleEnum> values = Enum.GetValues<ExampleEnum>();
IEnumerable<string> names = Enum.GetNames<ExampleEnum>(); 
```

通常，在定义枚举时，您不会考虑 UI。
枚举值名称不是根据 UI 设计规则选择的。
通常，UI 标签和文本通常是由没有开发人员或程序员背景的人创建的。他们通常提供本地化应用程序所需的所有翻译。
不将 UI 与应用程序混合使用有很多很好的理由。
您永远不会在设计一个类并为它的属性命名`DataGrid`时考虑到 UI（例如，列）。您可能希望列标题包含空格等。
异常消息针对开发人员而不是用户的原因相同。您绝对不想用属性装饰每个属性、每个异常、枚举或任何数据类型或成员，以便在特定 UI 上下文中提供对用户有意义的显示名称。
你不想让 UI 设计渗入你的代码库并污染你的类。
应用程序及其用户界面——这是两个不同的问题。
添加这个抽象的或虚拟的额外分离层允许例如添加不应显示的枚举值。或者更一般地说，修改代码而不必破坏或修改 UI。

您应该使用一个*简单* `IValueConverter`的或专用的类来提供这些显示值作为绑定源，而不是使用属性和实现加载额外的逻辑来提取它们的值（使用反射）。
坚持最常见的模式并为`ComboBox`项目实现数据模型，其中类具有枚举类型的属性作为成员，这有助于您识别`ComboBox.SelectedItem`（如果您需要枚举值）：

**示例枚举.cs**

```
// Define enumeration without minding any UI elements and context
public enum ExampleEnum 
{ 
    FooBar = 0, 
    BarFoo 
} 
```

**ExampleClass.cs**

```
// Define readable enum display values in the UI context.
// Display names can come from a localizable resource.
public class BindingSource : INotifyPropertyChanged
{
    public BindingSource()
    {
        ItemModels = new List<ItemModel> 
        {
            new ItemModel { Label = "Foo Bar Display", Value = ExampleEnum.FooBar },
            new ItemModel { Label = "Bar Foo Display", Value = ExampleEnum.BarFoo }
        }
    }

    public List<ItemModel> ItemModels { get; }

    private ItemModel selectedItemModel;
    public ItemModel SelectedItemModel { get => selectedItemModel; => set and notify; }
} 
```

**项目模型.cs**

```
public class ItemModel
{   
    public string Label { get; set; }
    public ExampleEnum Value { get; set; }
} 
```

**主窗口.xaml**

```
<Window>
  <Window.DataContext>
    <BindingSource />
  </Window.DataContext>

  <ComboBox ItemsSource="{Binding ItemModels}"
            DisplayMemberName="DisplayValue"
            SelectedItem="{Binding SelectedItemModel}" />
</Window> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-12T12:29:23.687

尝试使用

```
<ComboBox ItemsSource="{Binding Source={StaticResource ExampleEnumValues}}"
    SelectedValue="{Binding Path=ExampleProperty}" /> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-01-15T18:44:40.743

代码

```
 public enum RULE
    {
        [Description( "Любые, без ограничений" )]
        any,
        [Description( "Любые если будет три в ряд" )]
        anyThree,
        [Description( "Соседние, без ограничений" )]
        nearAny,
        [Description( "Соседние если будет три в ряд" )]
        nearThree
    }

    class ExtendRULE
    {
        public static object Values
        {
            get
            {
                List<object> list = new List<object>();
                foreach( RULE rule in Enum.GetValues( typeof( RULE ) ) )
                {
                    string desc = rule.GetType().GetMember( rule.ToString() )[0].GetCustomAttribute<DescriptionAttribute>().Description;
                    list.Add( new { value = rule, desc = desc } );
                }
                return list;
            }
        }
    } 
```

XAML

```
<StackPanel>
   <ListBox ItemsSource= "{Binding Source={x:Static model:ExtendRULE.Values}}" DisplayMemberPath="desc" SelectedValuePath="value" SelectedValue="{Binding SelectedRule}"/>
   <ComboBox ItemsSource="{Binding Source={x:Static model:ExtendRULE.Values}}" DisplayMemberPath="desc" SelectedValuePath="value" SelectedValue="{Binding SelectedRule}"/>                        
</StackPanel> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-11-10T21:41:04.403

我创建了一个开源[CodePlex](https://toastspopuphelpballoon.codeplex.com/)项目来执行此操作。[您可以从此处](https://www.nuget.org/packages/Mantin.Controls.Wpf.EnumComboBox)下载 NuGet 包。

```
<enumComboBox:EnumComboBox EnumType="{x:Type demoApplication:Status}" SelectedValue="{Binding Status}" /> 
```

# c# - 在 C# 中复制目录的全部内容

> ID：58744
> 
> 赞同：584
> 
> 时间：2008-09-12T11:38:52.607
> 
> 标签：c#, .net, directory, copy

我想在 C# 中将目录的全部内容从一个位置复制到另一个位置。

似乎没有办法使用`System.IO`没有大量递归的类来做到这一点。

如果我们添加对 的引用，我们可以使用 VB 中的一种方法`Microsoft.VisualBasic`：

```
new Microsoft.VisualBasic.Devices.Computer().
    FileSystem.CopyDirectory( sourceFolder, outputFolder ); 
```

这似乎是一个相当丑陋的黑客。有没有更好的办法？

* * *

## 回答 #1

> 赞同：614
> 
> 时间：2010-09-29T15:03:50.057

容易得多

```
private static void CopyFilesRecursively(string sourcePath, string targetPath)
{
    //Now Create all of the directories
    foreach (string dirPath in Directory.GetDirectories(sourcePath, "*", SearchOption.AllDirectories))
    {
        Directory.CreateDirectory(dirPath.Replace(sourcePath, targetPath));
    }

    //Copy all the files & Replaces any files with the same name
    foreach (string newPath in Directory.GetFiles(sourcePath, "*.*",SearchOption.AllDirectories))
    {
        File.Copy(newPath, newPath.Replace(sourcePath, targetPath), true);
    }
} 
```

* * *

## 回答 #2

> 赞同：258
> 
> 时间：2008-09-12T12:01:19.027

嗯，我想我误解了这个问题，但我会冒险。以下简单的方法有什么问题？

```
public static void CopyFilesRecursively(DirectoryInfo source, DirectoryInfo target) {
    foreach (DirectoryInfo dir in source.GetDirectories())
        CopyFilesRecursively(dir, target.CreateSubdirectory(dir.Name));
    foreach (FileInfo file in source.GetFiles())
        file.CopyTo(Path.Combine(target.FullName, file.Name));
} 
```

**编辑**由于这篇文章对一个同样简单的问题的简单答案获得了令人印象深刻的反对票，让我添加一个解释。**请** *在投票前阅读此内容*。

首先，**此代码无意替代**问题中的代码。它仅用于说明目的。

`Microsoft.VisualBasic.Devices.Computer.FileSystem.CopyDirectory`做一些额外的正确性测试（例如源和目标是否是有效目录，源是否是目标的父级等），而这些测试在这个答案中是缺失的。该代码可能也更加优化。

也就是说，代码*运行良好*。多年来，它*已经*（几乎相同）在成熟软件中使用。除了所有 IO 处理固有的变化无常（例如，如果用户在您的代码写入 USB 驱动器时手动拔出 USB 驱动器会发生什么？），没有已知问题。

特别要指出的是，这里使用递归绝对不是问题。无论在理论上（从概念上讲，这是最优雅的解决方案）还是在实践中：*这段代码不会溢出堆栈*。堆栈足够大，甚至可以处理深度嵌套的文件层次结构。早在堆栈空间成为问题之前，文件夹路径长度限制就开始了。

请注意，*恶意用户*可能能够通过使用每个一个字母的深度嵌套目录来打破这一假设。我没试过这个。但只是为了说明这一点：为了使此代码在典型计算机上溢出，目录必须嵌套*数千*次。这根本不是一个现实的场景。

* * *

## 回答 #3

> 赞同：151
> 
> 时间：2009-03-27T18:35:37.213

[从MSDN](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx)复制：

```
using System;
using System.IO;

class CopyDir
{
    public static void Copy(string sourceDirectory, string targetDirectory)
    {
        DirectoryInfo diSource = new DirectoryInfo(sourceDirectory);
        DirectoryInfo diTarget = new DirectoryInfo(targetDirectory);

        CopyAll(diSource, diTarget);
    }

    public static void CopyAll(DirectoryInfo source, DirectoryInfo target)
    {
        Directory.CreateDirectory(target.FullName);

        // Copy each file into the new directory.
        foreach (FileInfo fi in source.GetFiles())
        {
            Console.WriteLine(@"Copying {0}\{1}", target.FullName, fi.Name);
            fi.CopyTo(Path.Combine(target.FullName, fi.Name), true);
        }

        // Copy each subdirectory using recursion.
        foreach (DirectoryInfo diSourceSubDir in source.GetDirectories())
        {
            DirectoryInfo nextTargetSubDir =
                target.CreateSubdirectory(diSourceSubDir.Name);
            CopyAll(diSourceSubDir, nextTargetSubDir);
        }
    }

    public static void Main()
    {
        string sourceDirectory = @"c:\sourceDirectory";
        string targetDirectory = @"c:\targetDirectory";

        Copy(sourceDirectory, targetDirectory);
    }

    // Output will vary based on the contents of the source directory.
} 
```

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2008-09-12T11:46:59.217

或者，如果您想走硬路线，请添加对 Microsoft.VisualBasic 项目的引用，然后使用以下内容：

```
Microsoft.VisualBasic.FileIO.FileSystem.CopyDirectory(fromDirectory, toDirectory); 
```

但是，使用其中一个递归函数是一种更好的方法，因为它不必加载 VB dll。

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2008-09-12T12:30:07.037

试试这个：

```
Process proc = new Process();
proc.StartInfo.UseShellExecute = true;
proc.StartInfo.FileName = Path.Combine(Environment.SystemDirectory, "xcopy.exe");
proc.StartInfo.Arguments = @"C:\source C:\destination /E /I";
proc.Start(); 
```

您的 xcopy 参数可能会有所不同，但您明白了。

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2011-11-05T17:43:33.783

这个网站总是帮了我很多，现在轮到我用我所知道的来帮助其他人了。

我希望我下面的代码对某人有用。

```
string source_dir = @"E:\";
string destination_dir = @"C:\";

// substring is to remove destination_dir absolute path (E:\).

// Create subdirectory structure in destination    
    foreach (string dir in System.IO.Directory.GetDirectories(source_dir, "*", System.IO.SearchOption.AllDirectories))
    {
        System.IO.Directory.CreateDirectory(System.IO.Path.Combine(destination_dir, dir.Substring(source_dir.Length + 1)));
        // Example:
        //     > C:\sources (and not C:\E:\sources)
    }

    foreach (string file_name in System.IO.Directory.GetFiles(source_dir, "*", System.IO.SearchOption.AllDirectories))
    {
        System.IO.File.Copy(file_name, System.IO.Path.Combine(destination_dir, file_name.Substring(source_dir.Length + 1)));
    } 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2010-03-27T00:47:20.137

递归复制文件夹而不递归以避免堆栈溢出。

```
public static void CopyDirectory(string source, string target)
{
    var stack = new Stack<Folders>();
    stack.Push(new Folders(source, target));

    while (stack.Count > 0)
    {
        var folders = stack.Pop();
        Directory.CreateDirectory(folders.Target);
        foreach (var file in Directory.GetFiles(folders.Source, "*.*"))
        {
            File.Copy(file, Path.Combine(folders.Target, Path.GetFileName(file)));
        }

        foreach (var folder in Directory.GetDirectories(folders.Source))
        {
            stack.Push(new Folders(folder, Path.Combine(folders.Target, Path.GetFileName(folder))));
        }
    }
}

public class Folders
{
    public string Source { get; private set; }
    public string Target { get; private set; }

    public Folders(string source, string target)
    {
        Source = source;
        Target = target;
    }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-12T11:57:20.597

这是我用于此类 IO 任务的实用程序类。

```
using System;
using System.Runtime.InteropServices;

namespace MyNameSpace
{
    public class ShellFileOperation
    {
        private static String StringArrayToMultiString(String[] stringArray)
        {
            String multiString = "";

            if (stringArray == null)
                return "";

            for (int i=0 ; i<stringArray.Length ; i++)
                multiString += stringArray[i] + '\0';

            multiString += '\0';

            return multiString;
        }

        public static bool Copy(string source, string dest)
        {
            return Copy(new String[] { source }, new String[] { dest });
        }

        public static bool Copy(String[] source, String[] dest)
        {
            Win32.SHFILEOPSTRUCT FileOpStruct = new Win32.SHFILEOPSTRUCT();

            FileOpStruct.hwnd = IntPtr.Zero;
            FileOpStruct.wFunc = (uint)Win32.FO_COPY;

            String multiSource = StringArrayToMultiString(source);
            String multiDest = StringArrayToMultiString(dest);
            FileOpStruct.pFrom = Marshal.StringToHGlobalUni(multiSource);
            FileOpStruct.pTo = Marshal.StringToHGlobalUni(multiDest);

            FileOpStruct.fFlags = (ushort)Win32.ShellFileOperationFlags.FOF_NOCONFIRMATION;
            FileOpStruct.lpszProgressTitle = "";
            FileOpStruct.fAnyOperationsAborted = 0;
            FileOpStruct.hNameMappings = IntPtr.Zero;

            int retval = Win32.SHFileOperation(ref FileOpStruct);

            if(retval != 0) return false;
            return true;
        }

        public static bool Move(string source, string dest)
        {
            return Move(new String[] { source }, new String[] { dest });
        }

        public static bool Delete(string file)
        {
            Win32.SHFILEOPSTRUCT FileOpStruct = new Win32.SHFILEOPSTRUCT();

            FileOpStruct.hwnd = IntPtr.Zero;
            FileOpStruct.wFunc = (uint)Win32.FO_DELETE;

            String multiSource = StringArrayToMultiString(new string[] { file });
            FileOpStruct.pFrom = Marshal.StringToHGlobalUni(multiSource);
            FileOpStruct.pTo =  IntPtr.Zero;

            FileOpStruct.fFlags = (ushort)Win32.ShellFileOperationFlags.FOF_SILENT | (ushort)Win32.ShellFileOperationFlags.FOF_NOCONFIRMATION | (ushort)Win32.ShellFileOperationFlags.FOF_NOERRORUI | (ushort)Win32.ShellFileOperationFlags.FOF_NOCONFIRMMKDIR;
            FileOpStruct.lpszProgressTitle = "";
            FileOpStruct.fAnyOperationsAborted = 0;
            FileOpStruct.hNameMappings = IntPtr.Zero;

            int retval = Win32.SHFileOperation(ref FileOpStruct);

            if(retval != 0) return false;
            return true;
        }

        public static bool Move(String[] source, String[] dest)
        {
            Win32.SHFILEOPSTRUCT FileOpStruct = new Win32.SHFILEOPSTRUCT();

            FileOpStruct.hwnd = IntPtr.Zero;
            FileOpStruct.wFunc = (uint)Win32.FO_MOVE;

            String multiSource = StringArrayToMultiString(source);
            String multiDest = StringArrayToMultiString(dest);
            FileOpStruct.pFrom = Marshal.StringToHGlobalUni(multiSource);
            FileOpStruct.pTo = Marshal.StringToHGlobalUni(multiDest);

            FileOpStruct.fFlags = (ushort)Win32.ShellFileOperationFlags.FOF_NOCONFIRMATION;
            FileOpStruct.lpszProgressTitle = "";
            FileOpStruct.fAnyOperationsAborted = 0;
            FileOpStruct.hNameMappings = IntPtr.Zero;

            int retval = Win32.SHFileOperation(ref FileOpStruct);

            if(retval != 0) return false;
            return true;
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-03-02T08:39:25.227

tboswell 的替换证明版本（对文件路径中的重复模式具有弹性）

```
public static void copyAll(string SourcePath , string DestinationPath )
{
   //Now Create all of the directories
   foreach (string dirPath in Directory.GetDirectories(SourcePath, "*", SearchOption.AllDirectories))
      Directory.CreateDirectory(Path.Combine(DestinationPath ,dirPath.Remove(0, SourcePath.Length ))  );

   //Copy all the files & Replaces any files with the same name
   foreach (string newPath in Directory.GetFiles(SourcePath, "*.*",  SearchOption.AllDirectories))
      File.Copy(newPath, Path.Combine(DestinationPath , newPath.Remove(0, SourcePath.Length)) , true);
    } 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-07-17T08:14:57.967

它可能不具备性能感知能力，但我将它用于 30MB 的文件夹，并且它运行良好。另外，我不喜欢这么简单的任务所需的所有代码量和递归。

```
var src = "c:\src";
var dest = "c:\dest";
var cmp = CompressionLevel.NoCompression;
var zip = source_folder + ".zip";

ZipFile.CreateFromDirectory(src, zip, cmp, includeBaseDirectory: false);
ZipFile.ExtractToDirectory(zip, dest_folder);

File.Delete(zip); 
```

*注意：ZipFile 在 .NET 4.5+ 的 System.IO.Compression 命名空间中可用*

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2018-11-21T04:24:40.437

我的解决方案基本上是对@Termininja 答案的修改，但是我对其进行了一些改进，它似乎比接受的答案快 5 倍以上。

```
public static void CopyEntireDirectory(string path, string newPath)
{
    Parallel.ForEach(Directory.GetFileSystemEntries(path, "*", SearchOption.AllDirectories)
    ,(fileName) =>
    {
        string output = Regex.Replace(fileName, "^" + Regex.Escape(path), newPath);
        if (File.Exists(fileName))
        {
            Directory.CreateDirectory(Path.GetDirectoryName(output));
            File.Copy(fileName, output, true);
        }
        else
            Directory.CreateDirectory(output);
    });
} 
```

编辑：将@Ahmed Sabry 修改为完全并行的 foreach 确实会产生更好的结果，但是代码使用递归函数，在某些情况下并不理想。

```
public static void CopyEntireDirectory(DirectoryInfo source, DirectoryInfo target, bool overwiteFiles = true)
{
    if (!source.Exists) return;
    if (!target.Exists) target.Create();

    Parallel.ForEach(source.GetDirectories(), (sourceChildDirectory) =>
        CopyEntireDirectory(sourceChildDirectory, new DirectoryInfo(Path.Combine(target.FullName, sourceChildDirectory.Name))));

    Parallel.ForEach(source.GetFiles(), sourceFile =>
        sourceFile.CopyTo(Path.Combine(target.FullName, sourceFile.Name), overwiteFiles));
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-02-03T10:51:12.683

d4nt 的答案略有改进，因为如果您在服务器和开发机器上工作，您可能想要检查错误并且不必更改 xcopy 路径：

```
public void CopyFolder(string source, string destination)
{
    string xcopyPath = Environment.GetEnvironmentVariable("WINDIR") + @"\System32\xcopy.exe";
    ProcessStartInfo info = new ProcessStartInfo(xcopyPath);
    info.UseShellExecute = false;
    info.RedirectStandardOutput = true;
    info.Arguments = string.Format("\"{0}\" \"{1}\" /E /I", source, destination);

    Process process = Process.Start(info);
    process.WaitForExit();
    string result = process.StandardOutput.ReadToEnd();

    if (process.ExitCode != 0)
    {
        // Or your own custom exception, or just return false if you prefer.
        throw new InvalidOperationException(string.Format("Failed to copy {0} to {1}: {2}", source, destination, result));
    }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-09-22T10:38:04.213

这是我的代码希望这有帮助

```
 private void KCOPY(string source, string destination)
    {
        if (IsFile(source))
        {
            string target = Path.Combine(destination, Path.GetFileName(source));
            File.Copy(source, target, true);
        }
        else
        {
            string fileName = Path.GetFileName(source);
            string target = System.IO.Path.Combine(destination, fileName);
            if (!System.IO.Directory.Exists(target))
            {
                System.IO.Directory.CreateDirectory(target);
            }

            List<string> files = GetAllFileAndFolder(source);

            foreach (string file in files)
            {
                KCOPY(file, target);
            }
        }
    }

    private List<string> GetAllFileAndFolder(string path)
    {
        List<string> allFile = new List<string>();
        foreach (string dir in Directory.GetDirectories(path))
        {
            allFile.Add(dir);
        }
        foreach (string file in Directory.GetFiles(path))
        {
            allFile.Add(file);
        }

        return allFile;
    }
    private bool IsFile(string path)
    {
        if ((File.GetAttributes(path) & FileAttributes.Directory) == FileAttributes.Directory)
        {
            return false;
        }
        return true;
    } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-04-05T22:38:42.843

如果您喜欢 Konrad 的流行答案，但您希望其`source`本身成为 下的文件夹`target`，而不是将其子项放在该`target`文件夹下，则代码如下。它返回新创建的`DirectoryInfo`，这很方便：

```
public static DirectoryInfo CopyFilesRecursively(DirectoryInfo source, DirectoryInfo target)
{
  var newDirectoryInfo = target.CreateSubdirectory(source.Name);
  foreach (var fileInfo in source.GetFiles())
    fileInfo.CopyTo(Path.Combine(newDirectoryInfo.FullName, fileInfo.Name));

  foreach (var childDirectoryInfo in source.GetDirectories())
    CopyFilesRecursively(childDirectoryInfo, newDirectoryInfo);

  return newDirectoryInfo;
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-07-19T19:03:07.790

你可以随时使用[这个](https://docs.microsoft.com/en-us/dotnet/standard/io/how-to-copy-directories)，取自微软的网站。

```
static void Main()
{
    // Copy from the current directory, include subdirectories.
    DirectoryCopy(".", @".\temp", true);
}

private static void DirectoryCopy(string sourceDirName, string destDirName, bool copySubDirs)
{
    // Get the subdirectories for the specified directory.
    DirectoryInfo dir = new DirectoryInfo(sourceDirName);

    if (!dir.Exists)
    {
        throw new DirectoryNotFoundException(
            "Source directory does not exist or could not be found: "
            + sourceDirName);
    }

    DirectoryInfo[] dirs = dir.GetDirectories();
    // If the destination directory doesn't exist, create it.
    if (!Directory.Exists(destDirName))
    {
        Directory.CreateDirectory(destDirName);
    }

    // Get the files in the directory and copy them to the new location.
    FileInfo[] files = dir.GetFiles();
    foreach (FileInfo file in files)
    {
        string temppath = Path.Combine(destDirName, file.Name);
        file.CopyTo(temppath, false);
    }

    // If copying subdirectories, copy them and their contents to new location.
    if (copySubDirs)
    {
        foreach (DirectoryInfo subdir in dirs)
        {
            string temppath = Path.Combine(destDirName, subdir.Name);
            DirectoryCopy(subdir.FullName, temppath, copySubDirs);
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2021-09-06T06:28:43.450

这是一个简洁有效的解决方案：

```
namespace System.IO {
  public static class ExtensionMethods {

    public static void CopyTo(this DirectoryInfo srcPath, string destPath) {
      Directory.CreateDirectory(destPath);
      Parallel.ForEach(srcPath.GetDirectories("*", SearchOption.AllDirectories), 
        srcInfo => Directory.CreateDirectory($"{destPath}{srcInfo.FullName[srcPath.FullName.Length..]}"));
      Parallel.ForEach(srcPath.GetFiles("*", SearchOption.AllDirectories), 
        srcInfo => File.Copy(srcInfo.FullName, $"{destPath}{srcInfo.FullName[srcPath.FullName.Length..]}", true));
      });
    }

  }
} 
```

要使用：

```
new DirectoryInfo(sourcePath).CopyTo(destinationPath); 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-12T11:49:20.537

对不起之前的代码，它仍然有错误:(（陷入了最快的枪问题）。在这里它经过测试并且可以工作。关键是 SearchOption.AllDirectories，它消除了显式递归的需要。

```
string path = "C:\\a";
string[] dirs = Directory.GetDirectories(path, "*.*", SearchOption.AllDirectories);
string newpath = "C:\\x";
try
{
    Directory.CreateDirectory(newpath);
}
catch (IOException ex)
{
    Console.WriteLine(ex.Message);
}
for (int j = 0; j < dirs.Length; j++)
{
    try
    {
        Directory.CreateDirectory(dirs[j].Replace(path, newpath));
    }
    catch (IOException ex)
    {
        Console.WriteLine(ex.Message);
    }
}

string[] files = Directory.GetFiles(path, "*.*", SearchOption.AllDirectories);
for (int j = 0; j < files.Length; j++)            
{
    try
    {
        File.Copy(files[j], files[j].Replace(path, newpath));
    }
    catch (IOException ex)
    {
        Console.WriteLine(ex.Message);
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-03-26T22:07:01.713

这是 DirectoryInfo a la [FileInfo.CopyTo](http://msdn.microsoft.com/en-us/library/5axsfwbc.aspx)的扩展方法（注意`overwrite`参数）：

```
public static DirectoryInfo CopyTo(this DirectoryInfo sourceDir, string destinationPath, bool overwrite = false)
{
    var sourcePath = sourceDir.FullName;

    var destination = new DirectoryInfo(destinationPath);

    destination.Create();

    foreach (var sourceSubDirPath in Directory.EnumerateDirectories(sourcePath, "*", SearchOption.AllDirectories))
        Directory.CreateDirectory(sourceSubDirPath.Replace(sourcePath, destinationPath));

    foreach (var file in Directory.EnumerateFiles(sourcePath, "*", SearchOption.AllDirectories))
        File.Copy(file, file.Replace(sourcePath, destinationPath), overwrite);

    return destination;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-08-10T13:02:25.680

使用这个类。

```
public static class Extensions
{
    public static void CopyTo(this DirectoryInfo source, DirectoryInfo target, bool overwiteFiles = true)
    {
        if (!source.Exists) return;
        if (!target.Exists) target.Create();

        Parallel.ForEach(source.GetDirectories(), (sourceChildDirectory) => 
            CopyTo(sourceChildDirectory, new DirectoryInfo(Path.Combine(target.FullName, sourceChildDirectory.Name))));

        foreach (var sourceFile in source.GetFiles())
            sourceFile.CopyTo(Path.Combine(target.FullName, sourceFile.Name), overwiteFiles);
    }
    public static void CopyTo(this DirectoryInfo source, string target, bool overwiteFiles = true)
    {
        CopyTo(source, new DirectoryInfo(target), overwiteFiles);
    }
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-03-24T06:31:43.027

一种只有一个循环的变体，用于复制所有文件夹和文件：

```
foreach (var f in Directory.GetFileSystemEntries(path, "*", SearchOption.AllDirectories))
{
    var output = Regex.Replace(f, @"^" + path, newPath);
    if (File.Exists(f)) File.Copy(f, output, true);
    else Directory.CreateDirectory(output);
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-10-20T20:45:35.780

比任何代码都好（使用递归的 DirectoryInfo 的扩展方法）

```
public static bool CopyTo(this DirectoryInfo source, string destination)
    {
        try
        {
            foreach (string dirPath in Directory.GetDirectories(source.FullName))
            {
                var newDirPath = dirPath.Replace(source.FullName, destination);
                Directory.CreateDirectory(newDirPath);
                new DirectoryInfo(dirPath).CopyTo(newDirPath);
            }
            //Copy all the files & Replaces any files with the same name
            foreach (string filePath in Directory.GetFiles(source.FullName))
            {
                File.Copy(filePath, filePath.Replace(source.FullName,destination), true);
            }
            return true;
        }
        catch (IOException exp)
        {
            return false;
        }
    } 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-04-09T15:33:34.380

复制并替换文件夹的所有文件

```
 public static void CopyAndReplaceAll(string SourcePath, string DestinationPath, string backupPath)
    {
            foreach (string dirPath in Directory.GetDirectories(SourcePath, "*", SearchOption.AllDirectories))
            {
                Directory.CreateDirectory($"{DestinationPath}{dirPath.Remove(0, SourcePath.Length)}");
                Directory.CreateDirectory($"{backupPath}{dirPath.Remove(0, SourcePath.Length)}");
            }
            foreach (string newPath in Directory.GetFiles(SourcePath, "*.*", SearchOption.AllDirectories))
            {
                if (!File.Exists($"{ DestinationPath}{newPath.Remove(0, SourcePath.Length)}"))
                    File.Copy(newPath, $"{ DestinationPath}{newPath.Remove(0, SourcePath.Length)}");
                else
                    File.Replace(newPath
                        , $"{ DestinationPath}{newPath.Remove(0, SourcePath.Length)}"
                        , $"{ backupPath}{newPath.Remove(0, SourcePath.Length)}", false);
            }
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-05-04T09:01:47.333

下面的代码是微软建议[的how-to-copy-directories](https://docs.microsoft.com/en-us/dotnet/standard/io/how-to-copy-directories) ，它由亲爱的[@iato](https://stackoverflow.com/a/45199038/1951524)共享， 但它**只是递归复制源文件夹的子目录和文件，**而**不是复制它自己的源文件夹**（如右键单击->复制）。

但在这个答案下面**有一个棘手的方法：**

```
private static void DirectoryCopy(string sourceDirName, string destDirName, bool copySubDirs = true)
        {
            // Get the subdirectories for the specified directory.
            DirectoryInfo dir = new DirectoryInfo(sourceDirName);

            if (!dir.Exists)
            {
                throw new DirectoryNotFoundException(
                    "Source directory does not exist or could not be found: "
                    + sourceDirName);
            }

            DirectoryInfo[] dirs = dir.GetDirectories();
            // If the destination directory doesn't exist, create it.
            if (!Directory.Exists(destDirName))
            {
                Directory.CreateDirectory(destDirName);
            }

            // Get the files in the directory and copy them to the new location.
            FileInfo[] files = dir.GetFiles();
            foreach (FileInfo file in files)
            {
                string temppath = Path.Combine(destDirName, file.Name);
                file.CopyTo(temppath, false);
            }

            // If copying subdirectories, copy them and their contents to new location.
            if (copySubDirs)
            {
                foreach (DirectoryInfo subdir in dirs)
                {
                    string temppath = Path.Combine(destDirName, subdir.Name);
                    DirectoryCopy(subdir.FullName, temppath, copySubDirs);
                }
            }
        } 
```

如果你想递归地复制**源**文件夹和**子文件夹的****内容**，你可以像这样简单地使用它：

 ****```
string source = @"J:\source\";
string dest= @"J:\destination\";
DirectoryCopy(source, dest); 
```

但是如果你想复制**它自己的源目录**（类似于你右键单击源文件夹并单击复制然后在你单击粘贴的目标文件夹中）你应该像这样使用：

```
 string source = @"J:\source\";
 string dest= @"J:\destination\";
 DirectoryCopy(source, Path.Combine(dest, new DirectoryInfo(source).Name)); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-05-10T18:59:55.337

下面的代码将所有文件从同一文件夹结构中的给定模式的源复制到目标：

```
public static void Copy()
        {
            string sourceDir = @"C:\test\source\";
            string destination = @"C:\test\destination\";

            string[] textFiles = Directory.GetFiles(sourceDir, "*.txt", SearchOption.AllDirectories);

            foreach (string textFile in textFiles)
            {
                string fileName = textFile.Substring(sourceDir.Length);
                string directoryPath = Path.Combine(destination, Path.GetDirectoryName(fileName));
                if (!Directory.Exists(directoryPath))
                    Directory.CreateDirectory(directoryPath);

                File.Copy(textFile, Path.Combine(directoryPath, Path.GetFileName(textFile)), true);
            }
        } 
```

[![在此处输入图像描述](https://i.stack.imgur.com/LlIax.png)](https://i.stack.imgur.com/LlIax.png)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-10-31T17:58:30.877

只是想添加我的版本。它可以处理目录和文件，如果目标文件存在，它可以覆盖或跳过。

```
public static void Copy(
    string source,
    string destination,
    string pattern = "*",
    bool includeSubFolders = true,
    bool overwrite = true,
    bool overwriteOnlyIfSourceIsNewer = false)
{
    if (File.Exists(source))
    {
        // Source is a file, copy and leave
        CopyFile(source, destination);
        return;
    }

    if (!Directory.Exists(source))
    {
        throw new DirectoryNotFoundException($"Source directory does not exists: `{source}`");
    }

    var files = Directory.GetFiles(
        source,
        pattern,
        includeSubFolders ?
            SearchOption.AllDirectories :
            SearchOption.TopDirectoryOnly);

    foreach (var file in files)
    {
        var newFile = file.Replace(source, destination);
        CopyFile(file, newFile, overwrite, overwriteOnlyIfSourceIsNewer);
    }
}

private static void CopyFile(
    string source,
    string destination,
    bool overwrite = true,
    bool overwriteIfSourceIsNewer = false)
{
    if (!overwrite && File.Exists(destination))
    {
        return;
    }

    if (overwriteIfSourceIsNewer && File.Exists(destination))
    {
        var sourceLastModified = File.GetLastWriteTimeUtc(source);
        var destinationLastModified = File.GetLastWriteTimeUtc(destination);
        if (sourceLastModified <= destinationLastModified)
        {
            return;
        }

        CreateDirectory(destination);
        File.Copy(source, destination, overwrite);
        return;
    }

    CreateDirectory(destination);
    File.Copy(source, destination, overwrite);
}

private static void CreateDirectory(string filePath)
{
    var targetDirectory = Path.GetDirectoryName(filePath);
    if (targetDirectory != null && !Directory.Exists(targetDirectory))
    {
        Directory.CreateDirectory(targetDirectory);
    }
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-11-23T19:08:55.690

此代码的属性：

*   没有并行任务，性能较差，但想法是逐个文件处理，因此您可以记录或停止。
*   可以跳过隐藏文件
*   可以按修改日期跳过
*   文件复制错误是否可以中断（您选择）
*   为 SMB 使用 64K 缓冲区并`FileShare.ReadWrite`避免锁定
*   个性化您的异常消息
*   对于 Windows

> ***Notes***
> `ExceptionToString()`是一个个人扩展，它试图获取内部异常并显示堆栈。将其替换为`ex.Message`或任何其他代码。
> `log4net.ILog _log`我使用 ==Log4net== 你可以用不同的方式制作你的日志。

```
/// <summary>
/// Recursive Directory Copy
/// </summary>
/// <param name="fromPath"></param>
/// <param name="toPath"></param>
/// <param name="continueOnException">on error, continue to copy next file</param>
/// <param name="skipHiddenFiles">To avoid files like thumbs.db</param>
/// <param name="skipByModifiedDate">Does not copy if the destiny file has the same or more recent modified date</param>
/// <remarks>
/// </remarks>
public static void CopyEntireDirectory(string fromPath, string toPath, bool continueOnException = false, bool skipHiddenFiles = true, bool skipByModifiedDate = true)
{
    log4net.ILog _log = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);
    string nl = Environment.NewLine;

    string sourcePath = "";
    string destPath = "";
    string _exMsg = "";

    void TreateException(Exception ex)
    {
        _log.Warn(_exMsg);
        if (continueOnException == false)
        {
            throw new Exception($"{_exMsg}{nl}----{nl}{ex.ExceptionToString()}");
        }
    }

    try
    {
        foreach (string fileName in Directory.GetFileSystemEntries(fromPath, "*", SearchOption.AllDirectories))
        {
            sourcePath = fileName;
            destPath = Regex.Replace(fileName, "^" + Regex.Escape(fromPath), toPath);

            Directory.CreateDirectory(Path.GetDirectoryName(destPath));

            _log.Debug(FileCopyStream(sourcePath, destPath,skipHiddenFiles,skipByModifiedDate));
        }
    }
    // Directory must be less than 148 characters, File must be less than 261 characters
    catch (PathTooLongException)
    {
        throw new Exception($"Both paths must be less than 148 characters:{nl}{sourcePath}{nl}{destPath}");
    }
    // Not enough disk space. Cancel further copies
    catch (IOException ex) when ((ex.HResult & 0xFFFF) == 0x27 || (ex.HResult & 0xFFFF) == 0x70)
    {
        throw new Exception($"Not enough disk space:{nl}'{toPath}'");
    }
    // used by another process
    catch (IOException ex) when ((uint)ex.HResult == 0x80070020)
    {
        _exMsg = $"File is being used by another process:{nl}'{destPath}'{nl}{ex.Message}";
        TreateException(ex);
    }
    catch (UnauthorizedAccessException ex)
    {
        _exMsg = $"Unauthorized Access Exception:{nl}from:'{sourcePath}'{nl}to:{destPath}";
        TreateException(ex);
    }
    catch (Exception ex)
    {
        _exMsg = $"from:'{sourcePath}'{nl}to:{destPath}";
        TreateException(ex);
    }
}

/// <summary>
/// File Copy using Stream 64K and trying to avoid locks with fileshare
/// </summary>
/// <param name="sourcePath"></param>
/// <param name="destPath"></param>
/// <param name="skipHiddenFiles">To avoid files like thumbs.db</param>
/// <param name="skipByModifiedDate">Does not copy if the destiny file has the same or more recent modified date</param>
public static string FileCopyStream(string sourcePath, string destPath, bool skipHiddenFiles = true, bool skipByModifiedDate = true)
{
    // Buffer should be 64K = 65536‬ bytes 
    // Increasing the buffer size beyond 64k will not help in any circunstance,
    // as the underlying SMB protocol does not support buffer lengths beyond 64k."
    byte[] buffer = new byte[65536];

    if (!File.Exists(sourcePath))
        return $"is not a file: '{sourcePath}'";

    FileInfo sourcefileInfo = new FileInfo(sourcePath);
    FileInfo destFileInfo = null;
    if (File.Exists(destPath))
        destFileInfo = new FileInfo(destPath);

    if (skipHiddenFiles)
    {
        if (sourcefileInfo.Attributes.HasFlag(FileAttributes.Hidden))
            return $"Hidden File Not Copied: '{sourcePath}'";
    }

    using (FileStream input = sourcefileInfo.Open(FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
    using (FileStream output = new FileStream(destPath, FileMode.OpenOrCreate, FileAccess.Write, FileShare.ReadWrite, buffer.Length))
    {
        if (skipByModifiedDate && destFileInfo != null)
        {
            if (destFileInfo.LastWriteTime < sourcefileInfo.LastWriteTime)
            {
                input.CopyTo(output, buffer.Length);
                destFileInfo.LastWriteTime = sourcefileInfo.LastWriteTime;
                return $"Replaced: '{sourcePath}'";
            }
            else
            {
                return $"NOT replaced (more recent or same file): '{sourcePath}'";
            }
        }
        else
        {
            input.CopyTo(output, buffer.Length);
            destFileInfo = new FileInfo(destPath);
            destFileInfo.LastWriteTime = sourcefileInfo.LastWriteTime;
            return $"New File: '{sourcePath}'";
        }
    }
} 
```

# google-analytics - 如何从 Google Analytics 获取原始日志？

> ID：58750
> 
> 赞同：12
> 
> 时间：2008-09-12T11:42:11.833
> 
> 标签：google-analytics

是否可以从 Google Analytic 获取原始日志？是否有任何工具可以从 GA 生成原始日志？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-16T02:05:40.470

不，您无法获取原始日志，但没有什么能阻止您将完全相同的数据记录到您自己的 Web 服务器日志中。查看[Urchin 代码](https://ssl.google-analytics.com/urchin.js)并借用它，将以下两行更改为指向您的 Web 服务器。

```
var _ugifpath2="http://www.google-analytics.com/__utm.gif";
if (_udl.protocol=="https:") _ugifpath2="https://ssl.google-analytics.com/__utm.gif"; 
```

您需要创建一个`__utm.gif`文件，以便它们不会在日志中显示为 404。

显然，您需要将命中中的变量解析到您的 Web 服务器日志中。Apache 中的日志行看起来像这样。从中解析出所有你想要的东西会很“有趣”，但是谷歌分析从基本的 JavaScript 标记中得到的一切都是这样的。

```
127.0.0.1 - - [02/Oct/2008:10:17:18 +1000] "GET /__utm.gif?utmwv=1.3&utmn=172543292&utmcs=ISO-8859-1&utmsr=1280x1024&utmsc=32-bit&utmul=en-us&utmje=1&utmfl=9.0%20%20r124&utmdt=My%20Web%20Page&utmhn=www.mydomain.com&utmhid=979599568&utmr=-&utmp=/urlgoeshere/&utmac=UA-1715941-2&utmcc=__utma%3D113887236.511203954.1220404968.1222846275.1222906638.33%3B%2B__utmz%3D113887236.1222393496.27.2.utmccn%3D(organic)%7Cutmcsr%3Dgoogle%7Cutmctr%3Dsapphire%2Btechnologies%2Bsite%253Arumble.net%7Cutmcmd%3Dorganic%3B%2B HTTP/1.0" 200 35 "http://www.mydomain.com/urlgoeshere/" "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.19 (KHTML, like Gecko) Chrome/0.2.153.1 Safari/525.19" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T11:44:23.903

不，但是你为什么不直接使用你的网络服务器的日志呢？GA 的价值不在于他们收集的数据，而在于聚合/分析。这就是为什么它不被称为谷歌原始数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-13T06:43:36.263

请查看这篇文章，该文章解释了获取 Google 分析数据的黑客攻击。 [http://blogoscoped.com/archive/2008-01-17-n73.html](http://blogoscoped.com/archive/2008-01-17-n73.html)

此外，如果您可以等待某个时间，那么官方的 Google 分析博客表示他们正在开发数据导出 API，但目前它处于私有 Beta 版。 [http://analytics.blogspot.com/2008/10/more-enterprise-class-features-added-to.html](http://analytics.blogspot.com/2008/10/more-enterprise-class-features-added-to.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-07-04T16:50:15.597

与原始数据与汇总数据不完全相同，但似乎“非抽样”数据仅适用于高级帐户：

“非抽样报告仅适用于使用最新版 Google Analytics（分析）的高级帐户。”
[http://support.google.com/analytics/bin/answer.py?hl=en&answer=2601061](http://support.google.com/analytics/bin/answer.py?hl=en&answer=2601061)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:54:07.447

您可以获得分析数据，但这需要一些黑客攻击。

在任何分析报告中，单击屏幕顶部的“电子邮件”按钮。设置电子邮件以转到您的地址（或服务器上的新地址）并将格式更改为 csv 或 xml。

然后，您可以使用 php（或其他语言）检查电子邮件帐户，解析电子邮件并将附件导入系统。

在 evolt.org 上有一篇题为“传入邮件和 PHP”的文章：http: [//evolt.org/incoming_mail_and_php](http://evolt.org/incoming_mail_and_php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-11T19:05:07.657

不，但还有其他付费服务，例如[Mixpanel](https://mixpanel.com/docs/api-documentation/data-export-api "Mixpanel 数据导出 API")和[KISSmetrics](http://support.kissmetrics.com/apis/data/data-export-setup "KISSmetrics 数据导出")，它们具有数据导出 API。比尝试构建自己的分析服务要容易得多，但要花钱。

# ruby-on-rails - 在 Rails 中进行每用户数据库连接的最佳方法是什么

> ID：58755
> 
> 赞同：6
> 
> 时间：2008-09-12T11:44:14.980
> 
> 标签：ruby-on-rails

在中进行每用户数据库连接的最佳方法是什么`Rails`？

我意识到这是一个糟糕的 Rails 设计实践，但我们正在逐步替换现有的每个用户使用一个数据库的 Web 应用程序。完全重新设计/重写是不可行的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-12T14:01:09.207

在您的应用程序控制器中放置类似的内容。我正在使用子域加上“_clientdb”来选择数据库的名称。我所有的数据库都使用相同的用户名和密码，所以我可以从 db 配置文件中获取它。

希望这可以帮助！

```
class ApplicationController < ActionController::Base

  before_filter :hijack_db

  def hijack_db
    db_name = request.subdomains.first + "_clientdb"

    # lets manually connect to the proper db
    ActiveRecord::Base.establish_connection(
      :adapter  => ActiveRecord::Base.configurations[ENV["RAILS_ENV"]]['adapter'],
      :host     => ActiveRecord::Base.configurations[ENV["RAILS_ENV"]]['host'],
      :username => ActiveRecord::Base.configurations[ENV["RAILS_ENV"]]['username'],
      :password => ActiveRecord::Base.configurations[ENV["RAILS_ENV"]]['password'],
      :database => db_name
    )
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T11:55:07.807

看看[ActiveRecord::Base.establish_connection](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001397)。这就是您连接到不同数据库服务器的方式。我无法提供更多帮助，因为我不知道您如何识别用户或将其映射到它的数据库，但我想主数据库将拥有该信息（并且连接信息应该在 database.yml 文件中）。

祝你好运。

# performance - 推送或拉取近乎实时的自动化服务器？

> ID：58757
> 
> 赞同：4
> 
> 时间：2008-09-12T11:45:38.830
> 
> 标签：performance, automation, networking

我们目前正在开发一种服务器，客户端通过该服务器请求对特定数据元素的更改感兴趣，并且当该数据更改时，服务器将数据推送回客户端。关于客户轮询这些数据是否更好，在工作中存在激烈的争论。

就性能、可扩展性和网络负载而言，在近实时环境中传输数据的理想方法是什么？

**更新：** 这是一个关于 UI 更新的[链接](http://ayende.com/Blog/archive/2009/02/16/pull-vs.-push-models-for-ui-updates.aspx)，提供了一些思考的食物。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T11:59:16.050

可能没有适合每种情况的理想方法，但推送通常更好并且更频繁地使用。它允许优化服务器缓存和数据传输，这有助于提高性能和可扩展性，并通过避免客户端请求和空响应来减少网络流量。服务器以自己的节奏运行并在准备好时向客户端提供数据可能是一个重要的优势。

行业标准 - 例如 OPC、GID - 都支持。服务器将更新推送给订阅的客户端，但客户端可以将一些很少使用的数据拉出来，而不用担心订阅。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T11:49:16.120

只要客户端启动连接（以通过防火墙和 NAT 问题），任何一种方式都可以。

如果您需要发送几种不同类型的数据，您可能希望让客户端指定他想要的类型，但每个连接只需要一次。然后，您可以让服务器继续发送更新，因为它拥有它们。

在没有客户端不断请求更新的情况下让服务器发送更新会减少网络流量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T11:53:05.253

你在客户端有什么？许多防火墙允许传出请求但阻止传入请求。换句话说，如果您正在穿越 Internet，除非您发送电子邮件，否则拉取可能是您唯一的选择。

# .net - 用于刻录 DVD 的 SDK

> ID：58768
> 
> 赞同：1
> 
> 时间：2008-09-12T11:56:26.853
> 
> 标签：.net, sdk, image-capture, dvd-burning

我需要将 DVD 写入功能添加到我正在处理的应用程序中。但是，它需要能够写出长时间从相机“实时”抓取的文件。我不能等到所有文件都被捕获后才开始将它们写入 DVD，我需要在进行过程中将它们分块写入。

我看过[IMAPI v2](http://msdn.microsoft.com/en-us/library/aa364806(VS.85).aspx)，但主要问题似乎是您需要在开始刻录过程之前将其指向您计划写入磁盘的所有文件。我知道它必须有“会话”的概念，这意味着您可以在最终“关闭”它之前分几个部分写入 DVD。

但我想知道是否有任何其他 DVD 写入 SDK 允许您不断地将文件写入 DVD，特别是仅在内存中的文件。如果我不必在将捕获的图像刻录到 DVD 之前将它们写得很硬，那会更有效率。

该解决方案需要在 Windows XP 和 vista 上的 .NET 下工作

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T11:57:45.367

.Net的[Primo 刻录引擎](http://www.primoburner.com/)运行良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T14:23:22.413

通常，您必须在开始编写会话之前准备好数据。您可以做的是在开始第一个会话之前抓取第一张图像，然后在后台抓取其余图像并在它们被分页时编写新会话。

此外，vbAccelerator 有一个很棒[的 .NET IMAPI Wrapper](http://www.vbaccelerator.com/home/net/code/Libraries/Writing_CDs/IMAPI/article.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-16T17:38:56.653

将您的光学媒体格式化为[实时文件系统](http://en.wikipedia.org/wiki/Live_File_System)（[增量数据包写入](http://en.wikipedia.org/wiki/Packet_writing)，而不是使用带有 IMAPIv2 的母盘格式），然后您将能够仅使用[CopyFile](http://msdn.microsoft.com/en-us/library/windows/desktop/aa363851%28v=vs.85%29.aspx)添加任何文件， 而无需创建新会话。

这样，每次您想在新会话中添加新文件时，您都不会浪费导入/导出空间......

请注意，为确保在 Windows Vista 上创建的磁盘的兼容性，应选择 UDF 2.01 或更低版本。

# vim - 如何将多个选项卡行粘贴到 Vi 中？

> ID：58774
> 
> 赞同：24
> 
> 时间：2008-09-12T11:59:15.817
> 
> 标签：vim, vi

我想将从桌面上剪切的内容粘贴到在 Vi 中打开的文件中。

但是，如果我将嵌入的选项卡粘贴到整个页面上。

我认为这是某种视觉模式更改，但找不到命令。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-12T12:14:02.100

## 如果您使用的是普通 vi：

你可能有`autoindent`。要在粘贴时将其关闭：

```
<Esc> :set noai

<paste all you want>

<Esc> :set ai 
```

我有`.exrc`以下快捷方式：

```
map ^P :set noai^M
map ^N :set ai^M 
```

请注意，这些必须是实际的控制字符 - 使用 - 插入它们`Ctrl`等等。`V` `Ctrl``P`

## 如果你使用 vim：

使用该[`paste`](http://www.vim.org/htmldoc/options.html#%27paste%27)选项。除了禁用`autoindent`它还会设置其他选项，例如`textwidth`和`wrapmargin`粘贴友好的默认值：

```
<Esc> :set paste

<paste all you want>

<Esc> :set nopaste 
```

您还可以设置一个键来切换粘贴模式。我`.vimrc`的有以下行：

```
set pastetoggle=<C-P> " Ctrl-P toggles paste mode 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T12:09:39.990

如果你使用VIM，你可以使用"*p（即双引号、星号、字母p）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T19:32:20.923

我发现如果我首先将选项卡行复制到文本编辑器中，然后将它们从那里重新复制到 vim，那么选项卡是正确的。

# windows - 使用进度在 Windows 命令行上复制文件

> ID：58782
> 
> 赞同：41
> 
> 时间：2008-09-12T12:01:53.110
> 
> 标签：windows, batch-file, scripting

我需要使用 Windows 命令行（默认在 XP Pro 或更高版本上可用）复制文件并在此过程中显示进度。

进度指示器可以在终端或 GUI 窗口中。它旨在用于批处理文件脚本。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2011-02-12T13:10:00.620

我使用带有 /z 开关的复制命令通过网络驱动器进行复制。也适用于本地驱动器之间的复制。在 XP 家庭版上测试。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-12T12:07:12.117

[机械复制](http://en.wikipedia.org/wiki/Robocopy)：

> **Robocopy**或“强大的文件复制”是一个[命令行](https://en.wikipedia.org/wiki/Command_line_interface)目录和/或文件复制[命令](https://en.wikipedia.org/wiki/Command_(computing))。Robocopy 在功能上取代了[Xcopy](https://en.wikipedia.org/wiki/Xcopy)，具有更多选项。从 Windows NT 4.0 开始，它已作为[Windows 资源工具包](https://en.wikipedia.org/wiki/Windows_Resource_Kit)的一部分提供，并且首次作为标准功能引入[Windows Vista](https://en.wikipedia.org/wiki/Windows_Vista)和[Windows Server 2008](https://en.wikipedia.org/wiki/Windows_Server_2008)中。命令是`robocopy`...

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-09-08T22:14:20.150

[Esentutl](http://technet.microsoft.com/en-us/library/hh875546.aspx) /y 选项允许复制带有进度条的 （单个）文件文件，如下所示：

![在此处输入图像描述](https://i.stack.imgur.com/2r7Td.jpg)

该命令应如下所示：

```
esentutl /y "FILE.EXT" /d "DEST.EXT" /o 
```

该命令在每台 windows 机器上都可用，但该`y`选项在 windows vista 中提供。由于它仅适用于单个文件，因此对于小文件看起来不是很有用。其他限制是该命令不能覆盖文件。[***这是***](https://github.com/npocmaka/batch.scripts/blob/master/fileUtils/progressCopy.bat)一个检查目的地的包装脚本，如果需要可以删除它（通过传递可以看到帮助`/h`）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-08-12T21:49:56.097

关于所有这些方法的一些有趣的时间安排。如果您有千兆连接，则不应使用 /z 标志，否则会降低连接速度。Robocopy 或 dism 是唯一可以全速运行并显示进度条的工具。wdscase 用于从 WDS 服务器进行多播，如果您要对 5 台以上的计算机进行映像，可能会更快。为了获得 1:17 的时间，我以 920Mbps 的速度最大化了千兆连接，所以你不会同时在两个连接上得到它。另请注意，将较小的 wim 索引从较大的 wim 文件中导出的时间比仅复制整个文件的时间要长。

```
Model  Exe       OS       switches     index    size    time   link speed 
8760w  dism      Win8     /export-wim  index 1  6.27GB  2:21   link 1Gbps
8760w  dism      Win8     /export-wim  index 2  7.92GB  1:29   link 1Gbps
6305   wdsmcast  winpe32  /trans-file  res.RWM  7.92GB  6:54   link 1Gbps
6305   dism      Winpe32  /export-wim  index 1  6.27GB  2:20   link 1Gbps
6305   dism      Winpe32  /export-wim  index 2  7.92GB  1:34   link 1Gbps
6305   copy      Winpe32  /z           Whole    7.92GB  25:48  link 1Gbps
6305   copy      Winpe32  none         Wim      7.92GB  1:17   link 1Gbps
6305   xcopy     Winpe32  /z /j        Wim      7.92GB  23:54  link 1Gbps
6305   xcopy     Winpe32  /j           Wim      7.92GB  1:38   link 1Gbps
6305   VBS.copy  Winpe32               Wim      7.92    1:21   link 1Gbps
6305   robocopy  Winpe32               Wim      7.92    1:17   link 1Gbps 
```

如果您没有可用的 robocopy.exe，为什么不从您复制文件的网络共享中运行它呢？就我而言，我更喜欢这样做，这样我就不必在每次想要进行更改然后更新数十个闪存驱动器时重新构建我的 WinPE boot.wim 文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T12:19:07.733

这个 technet[链接](http://blogs.technet.com/askperf/archive/2007/05/08/slow-large-file-copy-issues.aspx)有一些用于复制大文件的好信息。我使用了文章中提到的交换服务器实用程序，它显示了进度并在内部使用非缓冲复制功能以加快传输速度。

在另一种情况下，我使用了 robocopy。[Robocopy GUI](http://technet.microsoft.com/en-us/magazine/cc160891.aspx)使您更容易获得正确的命令行选项。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-04T03:46:44.707

这是我使用的脚本：

```
@ECHO off
SETLOCAL ENABLEDELAYEDEXPANSION
mode con:cols=210 lines=50
ECHO Starting 1-way backup of MEDIA(M:) to BACKUP(G:)...
robocopy.exe M:\ G:\ *.* /E /PURGE /SEC /NP /NJH /NJS /XD "$RECYCLE.BIN" "System Volume Information" /TEE /R:5 /COPYALL /LOG:from_M_to_G.log
ECHO Finished with backup.
pause 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-29T01:01:19.797

如果您想复制文件并查看“进度”，我建议在批处理中使用下面的脚本，我从另一个脚本中使用它作为基础

我在脚本复制游戏文件时使用了进度条和百分比核王座：

```
@echo off
title NTU Installer
setlocal EnableDelayedExpansion

@echo Iniciando instalacao...
if not exist "C:\NTU" (
    md "C:\NTU
)
if not exist "C:\NTU\Profile" (
    md "C:\NTU\Profile"
)
ping -n 5 localhost >nul

for %%f in (*.*) do set/a vb+=1
set "barra="
::loop da barra
for /l %%i in (1,1,70) do set "barra=!barra!Û"
rem barra vaiza para ser preenchida
set "resto="
rem loop da barra vazia
for /l %%i in (1,1,110) do set "resto=!resto!"
set i=0
rem carregameno de arquivos
for %%f in (*.*) do (
    >>"log_ntu.css" (
        copy "%%f" "C:\NTU">nul
        echo Copiado:%%f
    )
    cls
    set /a i+=1,percent=i*100/vb,barlen=70*percent/100
    for %%a in (!barlen!) do echo  !percent!%% /                         
    [!barra:~0,%%a!%resto%]
    echo Instalado:[%%f] / Complete:[!percent!%%/100%]
    ping localhost -n 1.9  >nul
)
xcopy /e "Profile" "C:\NTU\Profile">"log_profile.css"              

@echo Criando atalho na area de trabalho...
copy "NTU.lnk" "C:\Users\%username%\Desktop">nul
ping localhost -n 4  >nul

@echo Arquivos instalados!
pause 
```

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2008-09-12T12:07:02.787

您可以轻松地编写一个程序来执行此操作，我已经编写了几个程序，显示在复制文件时复制的字节。如果您有兴趣，请发表评论，我会发布一个链接。

# visual-studio - 您使用什么工具来计算 Visual Studio 项目中的源代码行数？

> ID：58783
> 
> 赞同：7
> 
> 时间：2008-09-12T12:05:01.823
> 
> 标签：visual-studio, code-analysis

我知道周围有很多行数工具。有没有一些简单的东西不是你使用的其他大包的一部分？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-12T12:08:24.343

[Slick Edit Gadgets](http://www.slickedit.com/index.php?option=com_content&view=article&id=78&Itemid=90)有一个很好的报告，它按代码行、空格和注释进行了细分。该插件是免费的，并且相对较小。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T12:11:33.120

对不起，如果这不是一个直接的答案，但这些天我更喜欢使用代码度量工具或分析器而不是代码行。 [Ants profiler](http://www.red-gate.com/products/ants_profiler/index.htm)和[NDepend](http://www.ndepend.com)是立即想到的两个。

只是这些工具可以让您真正掌握软件的大小/复杂性，代码行数是一个非常原始的指标。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-17T16:12:00.797

我使用这个 Python 脚本：

```
import os, sys
total_count = 0
for root, dirs, filenames in os.walk(sys.argv[1]):
  dirs[:] = [ # prune search path
    dir for dir in dirs
    if dir.lower() not in ('.svn', 'excludefrombuild')]
  for filename in filenames:
    if os.path.splitext(filename)[1].lower() in ('.cpp', '.h'):
      fullname = os.path.join(root, filename)
      count = 0
      for line in open(fullname): count += 1
      total_count += count
      print count, fullname
print total_count 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-03T04:55:30.093

如果您有 Visual Studio 2008 Team Developer 或 Team Suite 版本，您可以使用[Code Metrics](http://www.geekzone.co.nz/vs2008/4773)在 Visual Studio 中[直接获取它们](http://blogs.msdn.com/habibh/archive/2009/10/27/how-to-count-the-lines-of-code-loc-in-your-application-using-visual-studio.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T12:26:02.587

您可以使用这个相对较小的包中的 find 和 wc，[http://unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)

像

```
find . -name *.cs -exec wc -l {} \; 
```

或者，如果你手边有一台 linux 机器，你可以安装驱动器并这样做，它会给你一个大概的数字。您可以复杂化以删除评论等。但鉴于您只想要一个大概的数字，不应该是必要的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-26T23:33:13.817

在解决方案资源管理器中右键单击项目，然后选择“计算代码指标”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T15:42:38.883

不确定这是否适用于 VS08 ...[代码项目](http://www.codeproject.com/KB/macros/LineCounterAddin.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T14:40:10.303

我也使用过这个简单的 C# 制作工具。

[http://richnewman.wordpress.com/2007/07/09/c-visual-basic-and-c-net-line-count-utility-version-2/](http://richnewman.wordpress.com/2007/07/09/c-visual-basic-and-c-net-line-count-utility-version-2/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-01T18:21:51.930

Exact Magic 的 StodioTools 包（免费）显示 Executable LoC 以及其他指标。这是 VisualStudio 2008 的插件。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-04T08:04:36.400

Project Line Counter 很酷，但是你需要一个更新的 .reg 文件来支持 VS 2008 和更高版本。我的网站上有一个 Visual Studio 2010 的 .reg 文件：[http ://www.onemanmmo.com/index.php?cmd=newsitem&comment=news.1.41.0 CodeProject](http://www.onemanmmo.com/index.php?cmd=newsitem&comment=news.1.41.0) [http://www](http://www.codeproject.com/KB/macros/linecount.aspx) 的讨论中有一些说明[.codeproject.com/KB/macros/linecount.aspx](http://www.codeproject.com/KB/macros/linecount.aspx)包含有关使其与 Visual Studio 2008 一起运行的信息。

# sharepoint - 检索关联的共享服务提供商的名称？

> ID：58809
> 
> 赞同：2
> 
> 时间：2008-09-12T12:24:39.563
> 
> 标签：sharepoint, moss, sharedservicesprovider

您如何以编程方式检索与特定 Sharepoint Web 应用程序关联的共享服务提供商的名称？

我有一个自定义解决方案需要：

1.  枚举其部署到的所有 Web 应用程序
2.  找出每个 Web 应用程序关联的共享服务提供者
3.  访问安装在 SSP 上的业务数据目录以检索一些数据
4.  枚举这些 Web 应用程序中的所有网站集
5.  根据数据在网站集中执行各种任务

第 1、3、4 和 5 点我算出来了，但第 2 点有点麻烦。我想避免在任何地方对 SSP 名称进行硬编码，并且不需要场管理员手动编辑配置文件。我需要的所有信息都在 Sharepoint 配置数据库中，我只需要知道如何通过对象模型访问它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T12:46:45.427

不幸的是，我知道没有支持的方式可以做到这一点。相关类是 Microsoft.Office.Server.Administration 命名空间中的 SharedResourceProvider，位于 Microsoft.Office.Server DLL 中。它被标记为内部所以预反射：

```
SharedResourceProvider sharedResourceProvider = ServerContext.GetContext(SPContext.Current.Site).SharedResourceProvider;
string sspName = sharedResourceProvider.Name; 
```

反思后：

```
ServerContext sc = ServerContext.GetContext(SPContext.Current.Site);
PropertyInfo srpProp = sc.GetType().GetProperty(
    "SharedResourceProvider", BindingFlags.NonPublic | BindingFlags.Instance);
object srp = srpProp.GetValue(sc, null);
PropertyInfo srpNameProp = srp.GetType().GetProperty(
    "Name", BindingFlags.Public | BindingFlags.Instance);
string sspName = (string)srpNameProp.GetValue(srp, null); 
```

另一种方法是在不推荐的配置数据库上编写 SQL 查询。

# javascript - vim 中的 Javascript 语法高亮显示

> ID：58825
> 
> 赞同：50
> 
> 时间：2008-09-12T12:32:33.257
> 
> 标签：javascript, vim, editing, vim-syntax-highlighting

有没有其他人发现 VIM 的 Javascript 语法突出显示次优？我发现有时我需要滚动以调整语法突出显示，因为有时它会神秘地放弃所有突出显示。

是否有任何解决方法或方法来解决这个问题？我正在使用 vim 7.1。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-12T13:28:16.133

你可能想试试这个[改进的 Javascript 语法荧光笔](http://www.vim.org/scripts/script.php?script_id=1491)，而不是 VIMRUNTIME 附带的那个。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-04-13T17:09:26.193

嗯，我修改了[易兆的 Javascript Syntax](http://www.vim.org/scripts/script.php?script_id=1491)，并添加了 Ajax 关键字支持，还突出显示了 DOM 方法等。

在这里，它远非完美，因为我还是 Vim 的新手，但到目前为止它对我有用。[我的 Javascript 语法](http://www.vim.org/scripts/script.php?script_id=3425)。如果你能修复，添加功能，请做。

更新：~~我忘记了这些语法高亮仅在您将它们包含在自己的颜色方案中时才会显示，就像我在颜色方案中所做的那样`Nazca`。我将测试是否可以将这些行添加到我修改后的语法文件中。~~

遵循[github](https://github.com/jelera/vim-javascript-syntax)中新版本的 javascript 语法文件，因为不再需要修改您当前的颜色方案。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-12T15:04:26.620

语法着色同步可能需要调整。我发现在某些情况下我需要更改它。

语法同步 (":help syn-sync") 控制 vim 如何跟踪和刷新其对着色代码的解析，以便它可以开始在文件中的任何位置绘制。

默认值并不总是对我有用，所以有时我发现自己在发布

```
:syn sync fromstart 
```

我建议阅读下的文档

```
:help syn-sync 
```

或者只是检查

```
:help syntax 
```

并找到关于同步的部分。

在四个可用的基本选项中做出明智的决定。我维护到功能键的映射，以在“fromstart”和“ccomment”模式之间切换，并仅清除同步设置。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2016-12-01T17:52:12.583

这是一篇非常老的帖子，但我遇到了同样的事情：有时语法高亮在查看`.html`文件中的 javascript 部分时会停止工作。正如 OP 所提到的，一个快速的解决方法是向上滚动，然后神奇地再次开始突出显示。

今天我发现了根本问题和一个很好的解决方案。在 Vim 中，语法高亮使用上下文来派生正确的高亮，其中上下文由前几行定义。可以通过发出指定在当前行之前使用多少行`:syntax sync minlines=200`。在这种情况下，它将使用多达 200 行作为上下文。可以通过运行来使用整个文件（对于长文件可能会很慢）`:syntax sync fromstart`。

一旦我发现，我将此行添加到我的`.vimrc`：

```
autocmd BufEnter *.html :syntax sync fromstart 
```

通过这样做，`.html`文件将使用整个文件作为上下文。因此，无论 JS 部分有多长，javascript 部分都将始终正确突出显示。希望这对其他人有帮助！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-12T17:40:20.083

为了快速而肮脏的修复，有时我只是上下滚动并重新调整突出显示。`Ctrl`+`L`屏幕重绘也可以修复它。

# asp.net - ASP.NET 自定义控件和“动态”事件模型

> ID：58827
> 
> 赞同：2
> 
> 时间：2008-09-12T12:33:49.417
> 
> 标签：asp.net, events, custom-server-controls

好的，我不确定它的标题是否完全准确，欢迎提出建议！

我正在创建一个 ASP.NET 自定义控件，这对我来说还是比较新的东西，所以请多多包涵。

我正在考虑事件模型。由于我们没有使用 Web 控件，因此没有从按钮触发事件，而是使用适当的参数手动调用**__doPostBack 。**然而，这显然意味着在选择选项时会发生很多回发（选择时呈现不同的方式）。

随着时间的推移，我将需要使这更加 Ajax-y 和响应，因此我需要更改事件绑定以调用本地 Javascript。

所以，我在想我应该能够切换控件的“模式”，它可以使用回发和处理本身，或者您可以指定要调用的 Javascript 函数名称而不是 doPostBack。

*   您对此有何看法？
*   我是否以错误的方式从控件中引发事件？（在这里完全接受建议！）
*   你会如何处理类似的问题？

    * * *

## 编辑 - 澄清

*   我正在创建一个自定义呈现控件（即从 WebControl 继承）。
*   我们没有使用现有的 Web 控件，因为我们希望完全控制呈现的输出。
*   AFAIK 从自定义呈现的控件中获取服务器端事件的唯一方法是从呈现的元素调用 doPostBack （如果错误，请更正！）。
*   ASP.NET MVC 不是一个选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T12:51:34.817

很奇怪。您正在使用 ASP.NET 服务器控件和自定义控件，但您没有使用 Web 控件？你是手动调用 __doPostBack 吗？

你喜欢用艰难的方式做事吗？

如果我仍在使用服务器控件模型而不是 MVC，我会在那个傻瓜上拍打 ASP.NET Ajax 控件并收工。你所做的就像在 T 型车上装了一个鼓风机。这可能很有趣，很有趣，但是当你完成所有艰苦的工作之后，你真正拥有的是什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-22T07:35:06.343

我一直在对此进行更多研究，并在需要时遇到了如何将 Javascript 注入客户端。这显然将在使控件更具响应性和更少往返服务器方面发挥重要作用。

例如：[RegisterClientScriptBlock](http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager.registerclientscriptblock.aspx)。

期待更多的玩这个，随时参与进来！

# sql - 左连接中的歧义（仅限 Oracle？）

> ID：58831
> 
> 赞同：4
> 
> 时间：2008-09-12T12:37:34.977
> 
> 标签：sql, oracle, join

我的老板在我创建的查询中发现了一个错误，我不明白这个错误背后的原因，尽管查询结果证明他是正确的。这是修复前的查询（简化版）：

```
select PTNO,PTNM,CATCD
from PARTS 
left join CATEGORIES on (CATEGORIES.CATCD=PARTS.CATCD); 
```

这是修复之后：

```
select PTNO,PTNM,PARTS.CATCD
from PARTS 
left join CATEGORIES on (CATEGORIES.CATCD=PARTS.CATCD); 
```

错误是，CATCD 列显示空值，即查询结果包括来自表 CATEGORIES 而不是 PARTS 的结果。这是我不明白的：如果原始查询中存在歧义，为什么 Oracle 不抛出错误？据我了解，在左连接的情况下，查询（PARTS）中的“主”表在歧义方面具有优先权。我错了，还是只是没有正确考虑这个问题？

更新：

这是一个修改后的示例，其中不引发歧义错误：

```
CREATE TABLE PARTS (PTNO NUMBER, CATCD NUMBER, SECCD NUMBER);

CREATE TABLE CATEGORIES(CATCD NUMBER);

CREATE TABLE SECTIONS(SECCD NUMBER, CATCD NUMBER);

select PTNO,CATCD 
from PARTS 
left join CATEGORIES on (CATEGORIES.CATCD=PARTS.CATCD) 
left join SECTIONS on (SECTIONS.SECCD=PARTS.SECCD) ; 
```

有人有线索吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T13:06:24.017

> 这是查询（简化版）

我认为通过简化查询，您消除了错误的真正原因:-)

你用的是什么oracle版本？Oracle 10g ( 10.2.0.1.0 ) 提供：

```
create table parts (ptno number , ptnm number , catcd number);  
create table CATEGORIES (catcd number);

select PTNO,PTNM,CATCD from PARTS  
left join CATEGORIES on (CATEGORIES.CATCD=PARTS.CATCD); 
```

我得到 ORA-00918: column ambiguously defined

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T13:04:42.510

对引发错误的 SQL 服务器感兴趣（应该如此）

```
select id
from sysobjects s
left join syscolumns c on s.id = c.id 
```

服务器：消息 209，级别 16，状态 1，行 1 不明确的列名称“id”。

```
select id
from sysobjects 
left join syscolumns  on sysobjects.id = syscolumns.id 
```

服务器：消息 209，级别 16，状态 1，行 1 不明确的列名称“id”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T13:29:49.000

根据我的经验，如果您创建这样的查询，当存在这样的字段重叠时，数据结果将从联接的右侧而不是左侧拉出 CATCD。

因此，由于此连接将包含来自 PARTS 的所有记录，而只有一些来自 CATEGORIES 的记录，因此只要右侧没有数据，CATCD 字段中就会有 NULL。

通过将列显式定义为来自 PARTS（即左侧），假设该字段在 PARTS 中有数据，您将获得一个非空值。

请记住，使用 LEFT JOIN，您只能保证左侧表中的字段中的数据，右侧很可能有空列。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T15:55:35.863

这可能是 Oracle 优化器中的一个错误。我可以使用 3 个表在查询中重现相同的行为。直觉上，它似乎确实应该产生一个错误。如果我用以下任何一种方式重写它，它确实会产生错误：

(1) 使用旧式外连接

```
select ptno, catcd
from parts, categories, sections
where categories.catcd (+) = parts.catcd
  and sections.seccd (+) = parts.seccd 
```

(2) 显式隔离两个连接

```
select ptno, catcd
from (
  select ptno, seccd, catcd
  from parts
  left join categories on (categories.CATCD=parts.CATCD) 
)
left join sections on (sections.SECCD=parts.SECCD) 
```

我使用 DBMS_XPLAN 来获取有关查询执行的详细信息，这确实显示了一些有趣的东西。该计划基本上是外连接 PARTS 和 CATEGORIES，投影该结果集，然后将其外连接到 SECTIONS。有趣的是，在第一个外连接的投影中，它只包括 PTNO 和 SECCD——它不包括前两个表中的任何一个的 CATCD。因此，最终结果是从第三个表中获取 CATCD。

但我不知道这是原因还是结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T13:17:42.477

我正在使用 Oracle 9.2.0.8.0。它确实给出了错误“ORA-00918：列不明确定义”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-12T18:44:39.867

恐怕我不能告诉你为什么你没有得到例外，但我可以假设它为什么选择 CATEGORIES 的专栏版本而不是 PARTS 的版本。

> 据我了解，在左连接的情况下，查询（PARTS）中的“主”表在歧义方面具有优先权

目前尚不清楚“主”是指左连接中的左表，还是“驱动”表，正如您从概念上看到的查询......但在任何一种情况下，您所看到的“主”表您编写的查询不一定是该查询的实际执行中的“主”表。

我的猜测是，Oracle 只是使用它在执行查询时遇到的第一个表中的列。并且由于 SQL 中的大多数单独操作不需要先命中一个表，因此 DBMS 将在解析时决定首先扫描哪个最有效。尝试获取查询的执行计划。我怀疑它可能会显示它首先击中类别，然后是部分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-18T15:55:54.230

这是使用 ANSI 样式联接时某些 Oracle 版本的已知错误。正确的行为是得到 ORA-00918 错误。

无论如何，最好指定您的表名；这样，当您碰巧添加一个名称也在另一个表中使用的新列时，您的查询不会中断。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T13:00:56.993

无论如何，通常建议具体并完全限定所有列名，因为它可以为优化器节省一些工作。当然在 SQL Server 中。

从我可以从[Oracle docs](http://www.oracle.com/technology/index.html)中收集到的信息，似乎只有在选择列表中选择列名两次，或者在选择列表中选择一次，然后再在其他地方（如 order by 子句）时才会抛出。

也许您发现了一个“未记录的功能”:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-12T13:19:12.240

像 HollyStyles 一样，我在 Oracle 文档中找不到任何可以解释您所看到内容的内容。

PostgreSQL、DB2、MySQL 和 MSSQL 都拒绝运行第一个查询，因为它不明确。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-12T13:42:18.580

@Pat：对于您的查询，我在这里遇到了同样的错误。我的查询比我最初发布的要复杂一点。我现在正在研究一个可重现的简单示例。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T15:57:10.227

您应该问自己的一个更大的问题是 - 为什么我的零件表中有一个类别代码在类别表中不存在？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-08-11T18:23:51.523

这是 Oracle 9i 中的一个错误。如果您使用 ANSI 表示法连接 2 个以上的表，它不会检测列名中的歧义，并且如果不使用别名，则可能返回错误的列。

如前所述，它在 10g 中是固定的，因此如果不使用别名，则会返回错误。

# c++ - 使用 GCC 预编译的头文件

> ID：58841
> 
> 赞同：98
> 
> 时间：2008-09-12T12:42:58.350
> 
> 标签：c++, gcc, precompiled-headers

任何人都成功地获得了与 GCC 一起使用的预编译头文件吗？我的尝试没有运气，也没有看到很多关于如何设置它的好例子。我已经尝试过 cygwin gcc 3.4.4 并在 Ubuntu 上使用 4.0。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-05-29T14:59:42.410

我肯定取得了成功。首先，我使用了以下代码：

```
 #include <boost/xpressive/xpressive.hpp>
#include <iostream>

using namespace std;
using namespace boost::xpressive;

//A simple regex test
int main()
{
    std::string hello( "hello world!" );

    sregex rex = sregex::compile( "(\\w+) (\\w+)!" );
    smatch what;

    if( regex_match( hello, what, rex ) )
    {
        std::cout << what[0] << '\n'; // whole match
        std::cout << what[1] << '\n'; // first capture
        std::cout << what[2] << '\n'; // second capture
    }
    return 0;
} 
```

这只是来自 Boost Xpressive 的一个问候世界（请参阅下面的链接）。首先，我使用`-H`gcc 中的选项进行编译。它显示了它使用的大量标题列表。然后，我查看了我的 IDE (code::blocks) 正在生成的编译标志，并看到如下内容：

`g++ -Wall -fexceptions -g -c main.cpp -o obj/Debug/main.o`

所以我写了一个命令来编译带有完全相同标志的 Xpressive.hpp 文件：

`sudo g++ -Wall -fexceptions -g /usr/local/include/boost/xpressive/xpressive.hpp`

我再次编译了原始代码`-H`并得到了这个输出：

```
g++ -Wall -fexceptions -H -g -c main.cpp -o obj/Debug/main.o
！/usr/local/include/boost/xpressive/xpressive.hpp.gch
主文件
. /usr/include/c++/4.4/iostream
.. /usr/include/c++/4.4/x86_64-linux-gnu/bits/c++config.h
.. /usr/include/c++/4.4/ostream
.. /usr/include/c++/4.4/istream
主文件

```

这 ！意味着编译器能够使用预编译的头文件。x 表示它无法使用它。使用适当的编译器标志至关重要。我取下 -H 并进行了一些速度测试。预编译的标头从 14 秒提高到 11 秒。不错，但也不是很好。

注意：这是示例的链接：http: [//www.boost.org/doc/libs/1_43_0/doc/html/xpressive/user_s_guide.html#boost_xpressive.user_s_guide.examples](http://www.boost.org/doc/libs/1_43_0/doc/html/xpressive/user_s_guide.html#boost_xpressive.user_s_guide.examples)我无法让它在邮政。

顺便说一句：我正在使用以下 g++

`g++ (Ubuntu 4.4.3-4ubuntu5) 4.4.3`

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-07-28T00:52:58.353

[首先，请参阅此处的文档](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)。

您像任何其他文件一样编译头文件，但您将输出放在后缀为`.gch`.

`stdafx.h.gch`因此，例如，如果您预编译 stdafx.h，您将拥有一个预编译的标头，只要您包含该标头，就会自动搜索该标头`stdafx.h`

例子：

stdafx.h：

```
#include <string>
#include <stdio.h> 
```

一个.cpp：

```
#include "stdafx.h"
int main(int argc, char**argv)
{
  std::string s = "Hi";
  return 0;
} 
```

然后编译为：

> `> g++ -c stdafx.h -o stdafx.h.gch`
> `> g++ a.cpp`
> `> ./a.out`

即使您在第 1 步后删除了 stdafx.h，您的编译也将正常工作。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-13T14:49:55.883

调用 gcc 的方式与为源文件调用它的方式相同，但使用头文件。

例如

```
g++ $(CPPFLAGS) test.h 
```

这会生成一个名为 test.h.gch 的文件

每次 gcc 搜索 test.h 时，它首先查找 test.h.gch，如果找到它，它会自动使用它。

更多信息可以在[GCC Precompiled Headers下找到](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-05-25T14:25:31.973

`-x`C++ 预编译头文件的说明符是`-x c++-header`，而不是`-x c++`。PCH 的示例用法如下。

`pch.h`：

```
// Put your common include files here: Boost, STL as well as your project's headers. 
```

`main.cpp`：

```
#include "pch.h"
// Use the PCH here. 
```

像这样生成 PCH：

```
$ g++ -x c++-header -o pch.h.gch -c pch.h 
```

`pch.h.gch`必须与要在同一目录中`pch.h`才能使用，因此请确保从所在目录执行上述命令`pch.h`。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-12T13:40:00.600

过去我曾经设法让预编译的头文件在 gcc 下工作，我记得当时也有问题。要记住的是，如果不满足某些条件，gcc 将忽略文件（header.h.gch 或类似文件），可以在[gcc 预编译头文件页面](http://gcc.gnu.org/onlinedocs/gcc/Precompiled-Headers.html)上找到其列表。

通常，最安全的做法是让您的构建系统首先编译 .gch 文件，使用与源代码的其余部分相同的命令行选项和可执行文件。这可以确保文件是最新的并且没有细微的差异。

首先让它与一个人为的示例一起工作可能也是一个好主意，只是为了消除您的问题特定于项目中的源代码的可能性。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-03-06T21:14:48.297

*确保`-include your_header.h`*

这就是我预编译和使用`bits/stdc++.h`集合的方式。

代码

```
#include <bits/stdc++.h> 
```

然后我通过使用 -H 编译我的文件并查看输出来找到 lib

```
g++ sol.cpp -H -O3 -pthread -lm -std=c++14 -o executable 
```

我看到的地方

```
. /usr/include/x86_64-linux-gnu/c++/7/bits/stdc++.h 
```

所以我在当前目录中创建了一个新目录并从那里`bits`复制。`stdc++.h`

然后我跑了

```
g++ bits/stdc++.h -O3 -std=c++14  -pthread 
```

这产生了`bits/stdc++.gch`

通常我通过编译我的代码

```
g++ sol.cpp -O3 -pthread -lm -std=c++14 -o executable 
```

，但我不得不将其修改为

```
g++ sol.cpp -include bits/stdc++.h -O3 -pthread -lm -std=c++14 -o executable 
```

因为它只决定`.gch`归档而不是归档`.h`，**`-include bits/stdc++.h`** 这对我来说很关键。要记住的另一件事是，您必须`*.h`使用与编译`*.cpp`. 当我没有包含`-O3`或`-pthread`它忽略了`*.gch`预编译的标头时。

要检查一切是否正确，您可以通过比较结果来测量时差

```
time g++ sol.cpp ... 
```

或运行

```
g++ sol.cpp -H -O3 -pthread -lm -std=c++14 -o executable 
```

再次寻找头文件路径，如果你现在得到`!`库路径之前，例如

```
! ./bits/stdc++.h.gch
.... 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-15T05:11:32.470

关于文件扩展名的一个微妙提示，因为我没有给予足够的关注，所以让我感到困惑：`.gch`扩展名被添加到预编译文件的全名中，它不会替换`.h`. 如果你弄错了，编译器将找不到它并且默默地不起作用。

precomp.h => 预压缩。**h.gch**

不是：

precomp.h => 预压缩。**gch**

使用 gcc`-H`检查它是否正在查找/使用它。

# c++ - 我可以在 GDB 中的“内存访问”上设置断点吗？

> ID：58851
> 
> 赞同：260
> 
> 时间：2008-09-12T12:46:28.200
> 
> 标签：c++, debugging, gdb, breakpoints, memory-access

我正在通过 gdb 运行应用程序，并且我想在任何时候访问/更改特定变量时设置断点。有没有这样做的好方法？我也对在 C/C++ 中监视变量以查看它是否/何时更改的其他方法感兴趣。

* * *

## 回答 #1

> 赞同：307
> 
> 时间：2008-09-12T14:35:50.667

*watch*只在写时中断，*rwatch*让你在读时中断，*awatch*让你在读/写时中断。

您可以在内存位置设置读取观察点：

```
gdb$ rwatch *0xfeedface
Hardware read watchpoint 2: *0xfeedface 
```

但一个限制适用于 rwatch 和 awatch 命令；您不能在表达式中使用 gdb 变量：

```
gdb$ rwatch $ebx+0xec1a04f
Expression cannot be implemented with read/access watchpoint. 
```

所以你必须自己扩展它们：

```
gdb$ print $ebx 
$13 = 0x135700
gdb$ rwatch *0x135700+0xec1a04f
Hardware read watchpoint 3: *0x135700 + 0xec1a04f
gdb$ c
Hardware read watchpoint 3: *0x135700 + 0xec1a04f

Value = 0xec34daf
0x9527d6e7 in objc_msgSend () 
```

**编辑：**哦，顺便说一句。您需要硬件**或软件支持**。软件显然要慢得多。要了解您的操作系统是否支持硬件观察点，您可以查看*can-use-hw-watchpoints*环境设置。

```
gdb$ show can-use-hw-watchpoints
Debugger's willingness to use watchpoint hardware is 1. 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2015-07-03T08:53:07.877

您要查找的内容称为*watchpoint*。

**用法**

`(gdb) watch foo`: 观察**变量的值** `foo`

`(gdb) watch *(int*)0x12345678`**：观察地址**指向的值，转换为你想要的任何类型

`(gdb) watch a*b + c/d`：观察任意**复杂的表达式**，在程序的母语中有效

观察点分为三种：

*   **watch : 发生***写入*时gdb 将中断
*   **rwatch**：gdb 将在发生*读取*时中断
*   **awatch** : gdb 在*这两种情况下都会中断*

您可以选择更适合您需要的。

有关更多信息，请查看[此](https://sourceware.org/gdb/onlinedocs/gdb/Set-Watchpoints.html)内容。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-06-08T19:26:38.877

假设第一个答案是指类似 C 的语法`(char *)(0x135700 +0xec1a04f)`，那么答案`rwatch *0x135700+0xec1a04f`是不正确的。正确的语法是`rwatch *(0x135700+0xec1a04f)`.

那里缺少`()`s 给我自己尝试使用观察点带来了很大的痛苦。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-12T13:00:06.763

我刚刚尝试了以下方法：

```
 $ cat gdbtest.c
 int abc = 43;

 int main()
 {
   abc = 10;
 }
 $ gcc -g -o gdbtest gdbtest.c
 $ gdb gdbtest
 ...
 (gdb) watch abc
 Hardware watchpoint 1: abc
 (gdb) r
 Starting program: /home/mweerden/gdbtest 
 ...

 Old value = 43
 New value = 10
 main () at gdbtest.c:6
 6       }
 (gdb) quit 
```

所以这似乎是可能的，但你似乎确实需要一些硬件支持。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-26T16:05:37.657

如上所述，使用 watch 查看何时写入变量，读取时使用 rwatch，读取/写入时使用 awatch。但是，请注意，要使用此命令，您必须中断程序，并且当您中断程序时，变量必须在范围内：

> 使用 watch 命令。watch 命令的参数是一个被计算的表达式。这意味着您要设置观察点的变量必须在当前范围内。因此，要在非全局变量上设置观察点，您必须设置一个断点，当变量在范围内时将停止您的程序。您在程序中断后设置观察点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-01-06T16:14:28.483

[除了asksol](https://stackoverflow.com/users/5577/asksol)和[Paolo M](https://stackoverflow.com/users/2508150/paolo-m)已经回答/评论的内容

起初我没有读明白，为什么我们需要转换结果。虽然我读到了这个：[https](https://sourceware.org/gdb/onlinedocs/gdb/Set-Watchpoints.html) ://sourceware.org/gdb/onlinedocs/gdb/Set-Watchpoints.html ，但它对我来说并不直观......

所以我做了一个实验让结果更清楚： 代码：（假设 int main() 在第 3 行； int i=0 在第 5 行，其他代码.. 来自第 10 行）

```
int main()
{
int i = 0;
int j;
i = 3840 // binary 1100 0000 0000 to take into account endianness
other code..
} 
```

然后我第一次尝试使用可执行文件启动 gdb，我在变量的位置设置断点而不进行强制转换，以下是显示的结果

```
Thread 1 "testing2" h
Breakpoint 2 at 0x10040109b: file testing2.c, line 10.
(gdb) s
7           i = 3840;
(gdb) p i
$1 = 0
(gdb) p &i
$2 = (int *) 0xffffcbfc
(gdb) watch *0xffffcbfc
Hardware watchpoint 3: *0xffffcbfc
(gdb) s
[New Thread 13168.0xa74]

Thread 1 "testing2" hit Breakpoint 2, main () at testing2.c:10
10          b = a;
(gdb) p i
$3 = 3840
(gdb) p *0xffffcbfc
$4 = 3840
(gdb) p/t *0xffffcbfc
$5 = 111100000000 
```

正如我们所见，我设置的第 10 行出现断点。gdb 没有中断，因为尽管变量 i 经历了更改，但被监视的位置没有改变（由于字节序，因为它继续保持全 0）

在我的第二次尝试中，我对变量的地址进行了强制转换以监视所有 sizeof(int) 字节。这次：

```
(gdb) p &i
$6 = (int *) 0xffffcbfc
(gdb) p i
$7 = 0
(gdb) watch *(int *) 0xffffcbfc
Hardware watchpoint 6: *(int *) 0xffffcbfc
(gdb) b 10
Breakpoint 7 at 0x10040109b: file testing2.c, line 10.
(gdb) i b
Num     Type           Disp Enb Address            What
6       hw watchpoint  keep y                      *(int *) 0xffffcbfc
7       breakpoint     keep y   0x000000010040109b in main at testing2.c:10
(gdb) n
[New Thread 21508.0x3c30]

Thread 1 "testing2" hit Hardware watchpoint 6: *(int *) 0xffffcbfc

Old value = 0
New value = 3840

Thread 1 "testing2" hit Breakpoint 7, main () at testing2.c:10
10          b = a; 
```

gdb break 因为它检测到值已更改。

# emacs - Emacs 中的矩形函数

> ID：58872
> 
> 赞同：16
> 
> 时间：2008-09-12T12:53:35.560
> 
> 标签：emacs

我在几个地方读到 emacs 中的矩形函数非常有用。我已经阅读了一些关于它们的信息，但我不太明白为什么。我的意思是，当你想删除一个段落时，你标记第一行/列，然后标记最后一个，这实际上是一个矩形，对吧？但是你仍然可以使用普通的杀...

那么你会用它们做什么样的转变呢？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-12T12:57:50.560

如果文本文件的列中有数据，`M-x delete-rectangle`或者`M-x kill-rectangle`您可以删除单列数据。同样，`M-x yank-rectangle`将粘贴在一列文本中。

例如，采用以下文本：

```
1\. alligator    alphorn
2\. baboon       bugle
3\. crocodile    cornet
4\. dog          didgeridoo
5\. elephant     euphonium 
6\. fish         flugelhorn   
7\. gopher       guitar 
```

从鳄鱼的 a 到吉他的 g 中选择。选择的开始和结束标记出矩形的两个对角。输入`M-x kill-rectangle`，您立即拥有：

```
1\. alphorn
2\. bugle
3\. cornet
4\. didgeridoo
5\. euphonium 
6\. flugelhorn
7\. guitar 
```

接下来将标记放在顶行的末尾，如果需要添加几个空格，然后输入`M-x yank-rectangle`和ta-da！您已对列重新排序：

```
1\. alphorn      alligator    
2\. bugle        baboon       
3\. cornet       crocodile    
4\. didgeridoo   dog          
5\. euphonium    elephant     
6\. flugelhorn   fish         
7\. guitar       gopher 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-12T17:03:00.440

我喜欢将矩形用于两个主要目的，在每一行插入相同的文本，或者删除一列文本（类似于 Dave Webb 的答案）。

这些有 2 个有用的快捷方式，`C-x r k`将杀死一个矩形并`C-x r t`插入（还有其他带`C-x r`前缀的矩形命令，但这些是我使用的）。

因此，假设您想要获取一些代码并对其进行格式化，以便您可以将其发布在 Stack Overflow 帖子中……您需要以 4 个空格作为前缀。所以，转到第一行的开头，`C-SPC`进行标记，然后转到最后一行的开头，然后`C-x r t <SPC> <SPC> <SPC> <SPC> <RET>`就可以了！然后，您可以将其复制并粘贴到 Stack Overflow 中。我遇到了更复杂的情况，这很有用，你实际上有想要在特定位置的每一行插入的文本。

所以另一种情况，比如戴夫韦伯的情况，如果你想杀死一个矩形，`C-x r k`尽管使用，因为它要快得多;-)

另外，根据我刚开始时打印的[参考卡，您可以执行以下操作：](http://refcards.com/docs/gildeas/gnu-emacs/emacs-refcard-a4.pdf)

*   `C-x r r`: 复制到寄存器
*   `C-x r y`: 拉出一个矩形
*   `C-x r o`：打开一个矩形，向右移动文本（不管这意味着什么......）
*   `C-x r c`：空白一个矩形（我假设这意味着用空格替换它，但你必须尝试一下才能看到）
*   `C-x r t`: 带文本的前缀（如上所述）
*   `C-x r k`: 杀戮（如上所述）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-05-31T09:55:55.377

在 emacs24+ 中还有用于编号行的功能：

```
(rectangle-number-lines START END START-AT &optional FORMAT)

Insert numbers in front of the region-rectangle.

START-AT, if non-nil, should be a number from which to begin
counting.  FORMAT, if non-nil, should be a format string to pass
to `format' along with the line count.  When called interactively
with a prefix argument, prompt for START-AT and FORMAT. 
```

它`C-x r N`默认绑定到。

# visual-studio-2008 - 如何在 VS2008 中启用行号？

> ID：58874
> 
> 赞同：23
> 
> 时间：2008-09-12T12:54:01.660
> 
> 标签：visual-studio-2008

我似乎找不到那个选项。

确定在里面？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-12T12:55:04.153

那将是工具>选项

文本编辑器 > 所有语言 > 行号（在右下角）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-05T15:52:43.790

不要忘记勾选表格底部的“[x] Show all settings”，否则您将无法看到“All Languages”。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-12T12:55:58.770

转到工具 - 选项 - 文本编辑器 - 所有语言 - 常规，然后检查行号以显示所有文件的行号。

如果您只想查看（或不查看）特定文件的行号，您可以通过转到文本编辑器 - 常规页面来覆盖此全局设置。

[你知道吗...如何在编辑器中显示行号？](http://blogs.msdn.com/saraford/archive/2007/08/30/did-you-know-how-to-show-line-numbers-in-the-editor.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-12T12:55:24.637

工具 -> 选项 -> 文本编辑器 -> 所有语言。靠近底部。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T12:55:40.830

主菜单 > 工具 > 选项
文本编辑器（树）> C# > 显示组（行号复选框）

那很简单 ：）

# .net - 我应该为一个独立的 ASP.NET Web 应用程序使用多个程序集吗？

> ID：58878
> 
> 赞同：4
> 
> 时间：2008-09-12T12:55:34.853
> 
> 标签：.net, asp.net, web-applications, coding-style

来自企业 IT 环境的标准总是为每一层、业务逻辑、数据访问创建一个类库项目，有时还为特定类型创建更大的隔离。

现在我正在开发自己的 Web 应用程序项目，我认为没有必要以这种方式隔离我的代码。

我没有多个应用程序需要共享此逻辑或服务启用它。我也没有看到部署方案有任何优势。

我倾向于将所有工件放在一个 Web 应用程序中，并在逻辑上由项目文件夹分隔。

我想知道社区的想法。

* * *

让我添加更多信息...

我正在使用 MVC 预览版 5 编写此应用程序，因此框架中继承的关注点分离将支持单元测试。我喜欢对一切进行测试！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T13:00:28.260

从最简单的事情开始，并在需要时增加复杂性。听起来好像单个组件就可以很好地满足您的情况。但是，请注意不要让 A 层访问 B 层的内部成员而违反这些层。这将使得以后将这些层拉入单独的组件变得更加困难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T13:06:23.363

我想说这取决于您对测试和单元测试的重视程度。

如果您打算只进行用户/手动测试，或者基本上只使用从 UI 向下测试，那么它并没有真正的区别。

另一方面，如果您打算进行某种单元测试或业务规则验证，那么将您的工作分成不同的程序集绝对是有意义的。

即使对于较小的个人项目，我发现随着项目的进行，这种方法使我的生活更轻松。我仍然使用相同的解决方案运行所有内容，只是使用 UI 的 Web 项目、业务规则/应用程序逻辑的库和 DAL 的另一个库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T13:12:55.220

您仍然应该将逻辑层分成适当的项目。

这是一个很好的工程实践，无论您是 1 名开发人员还是 100 名开发人员。将代码集中在一个地方的负面影响是它会让您重构或复制代码以进行扩展。

# java - 在 VisualVM 中向下钻取

> ID：58886
> 
> 赞同：9
> 
> 时间：2008-09-12T12:57:55.787
> 
> 标签：java, visualvm

我刚刚安装了 Java 1.6_07，所以我可以尝试使用 VisualVM 进行分析。它告诉我我的应用程序花费了 60% 的时间`sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run`

我如何知道它在那段时间做了什么？它有多少时间在等待调用它或做其他事情？什么叫它，它叫什么？我似乎找不到任何方法可以像 Quantify 或 Perl 分析器那样深入到更深层次。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T12:25:23.657

我没有使用 VisualVM 的经验——但是 JRockit 的分析器*确实*提供了这些信息；您可以考虑改用它。

**更新：**可以在[此处](https://stackoverflow.com/questions/14762/please-recommend-a-java-profiler)找到带有 java 分析器列表的问题，供有足够代表的用户查看已删除的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T14:25:16.217

您的应用程序是否使用基于 TCP 的 RMI？如果不是，这是否可能是由检测 VM 引起的 heisenbug？我假设 VisualVM 必须使用 RMI 调用来弄清楚 JVM 中发生了什么......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-26T10:44:53.867

我已经开始使用[新的 VisualVM 1.2 了](https://visualvm.dev.java.net/)。它允许分析 CPU 并使用调用图向下钻取。试试看。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-17T21:18:33.807

使用 1.3.2 也看到这是我遇到的报告挂断。在 1.3.2 中，如果您执行线程转储并查找此调用，您可以看到它在该线程的调用链中的位置。不确定 Yuval F 是指这个还是别的什么。查找调用链以查看它正在调用什么等等，向下查看它正在调用什么等等。

# c# - 使用 C# 将 SVG 转换为 PNG

> ID：58910
> 
> 赞同：111
> 
> 时间：2008-09-12T13:09:44.820
> 
> 标签：c#, .net, png, svg

我一直在尝试使用 C# 将 SVG 图像转换为 PNG，而无需编写太多代码。任何人都可以推荐一个库或示例代码来执行此操作吗？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2012-10-14T16:54:14.533

[使用库http://svg.codeplex.com/](http://svg.codeplex.com/)（较新版本 @ [GIT](https://github.com/vvvv/SVG)， @ [NuGet](https://www.nuget.org/packages/Svg/) ）有一种更简单的方法。这是我的代码

```
var byteArray = Encoding.ASCII.GetBytes(svgFileContents);
using (var stream = new MemoryStream(byteArray))
{
    var svgDocument = SvgDocument.Open(stream);
    var bitmap = svgDocument.Draw();
    bitmap.Save(path, ImageFormat.Png);
} 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-09-12T13:11:39.043

您可以调用 inkscape 的命令行版本来执行此操作：

[http://harriyott.com/2008/05/converting-svg-images-to-png-in-c.aspx](http://harriyott.com/2008/05/converting-svg-images-to-png-in-c.aspx)

还有一个 C# SVG 渲染引擎，主要设计用于允许 SVG 文件在 web 上的 codeplex 上使用，如果这是您的问题，它可能满足您的需求：

**原始项目**
[http://www.codeplex.com/svg](http://www.codeplex.com/svg)

**带有修复和更多活动的分叉：**（2013 年 7 月添加）
[https://github.com/vvvv/SVG](https://github.com/vvvv/SVG)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-08-09T22:25:02.430

当我不得不在服务器上光栅化 svgs 时，我最终使用 P/Invoke 来调用 librsvg 函数（您可以从 GIMP 图像编辑程序的 Windows 版本中获取 dll）。

```
[DllImport("kernel32.dll", SetLastError = true)]
static extern bool SetDllDirectory(string pathname);

[DllImport("libgobject-2.0-0.dll", SetLastError = true)]
static extern void g_type_init(); 

[DllImport("librsvg-2-2.dll", SetLastError = true)]
static extern IntPtr rsvg_pixbuf_from_file_at_size(string file_name, int width, int height, out IntPtr error);

[DllImport("libgdk_pixbuf-2.0-0.dll", CallingConvention = CallingConvention.Cdecl, CharSet = CharSet.Ansi)]
static extern bool gdk_pixbuf_save(IntPtr pixbuf, string filename, string type, out IntPtr error, __arglist);

public static void RasterizeSvg(string inputFileName, string outputFileName)
{
    bool callSuccessful = SetDllDirectory("C:\\Program Files\\GIMP-2.0\\bin");
    if (!callSuccessful)
    {
        throw new Exception("Could not set DLL directory");
    }
    g_type_init();
    IntPtr error;
    IntPtr result = rsvg_pixbuf_from_file_at_size(inputFileName, -1, -1, out error);
    if (error != IntPtr.Zero)
    {
        throw new Exception(Marshal.ReadInt32(error).ToString());
    }
    callSuccessful = gdk_pixbuf_save(result, outputFileName, "png", out error, __arglist(null));
    if (!callSuccessful)
    {
        throw new Exception(error.ToInt32().ToString());
    }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-14T05:34:40.297

我正在为此使用[蜡染。](http://xmlgraphics.apache.org/batik/)完整的德尔福代码：

```
procedure ExecNewProcess(ProgramName : String; Wait: Boolean);
var
  StartInfo : TStartupInfo;
  ProcInfo : TProcessInformation;
  CreateOK : Boolean;
begin
  FillChar(StartInfo, SizeOf(TStartupInfo), #0);
  FillChar(ProcInfo, SizeOf(TProcessInformation), #0);
  StartInfo.cb := SizeOf(TStartupInfo);
  CreateOK := CreateProcess(nil, PChar(ProgramName), nil, nil, False,
              CREATE_NEW_PROCESS_GROUP + NORMAL_PRIORITY_CLASS,
              nil, nil, StartInfo, ProcInfo);
  if CreateOK then begin
    //may or may not be needed. Usually wait for child processes
    if Wait then
      WaitForSingleObject(ProcInfo.hProcess, INFINITE);
  end else
    ShowMessage('Unable to run ' + ProgramName);

  CloseHandle(ProcInfo.hProcess);
  CloseHandle(ProcInfo.hThread);
end;

procedure ConvertSVGtoPNG(aFilename: String);
const
  ExecLine = 'c:\windows\system32\java.exe -jar C:\Apps\batik-1.7\batik-rasterizer.jar ';
begin
  ExecNewProcess(ExecLine + aFilename, True);
end; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-14T16:04:43.360

要添加到@Anish 的响应，如果您在将 SVG 导出到图像时遇到看不到文本的问题，您可以创建一个递归函数来循环遍历 SVGDocument 的子项，尝试将其转换为 SvgText 如果可能（添加您自己的错误检查）并设置字体系列和样式。

```
 foreach(var child in svgDocument.Children)
    {
        SetFont(child);
    }

    public void SetFont(SvgElement element)
    {
        foreach(var child in element.Children)
        {
            SetFont(child); //Call this function again with the child, this will loop
                            //until the element has no more children
        }

        try
        {
            var svgText = (SvgText)parent; //try to cast the element as a SvgText
                                           //if it succeeds you can modify the font

            svgText.Font = new Font("Arial", 12.0f);
            svgText.FontSize = new SvgUnit(12.0f);
        }
        catch
        {

        }
    } 
```

让我知道是否有问题。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-02-24T21:45:17.203

您可以为此使用 altsoft xml2pdf lib

# sql-server - 执行级联删除的嵌套 SQL Server 事务

> ID：58916
> 
> 赞同：0
> 
> 时间：2008-09-12T13:12:59.760
> 
> 标签：sql-server, transactions, nested, cascade

假设我有一个名为 Companies 的表，它有一个 DepartmentID 列。还有一个包含 EmployeeID 列的部门表。当然，我也有一个 Employee 表。问题是我想删除一家公司，所以首先我必须删除每个部门的所有员工，然后是公司中的所有部门。级联删除不是一个选项，因此我希望使用嵌套事务。我是 SQL 新手，非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T13:36:48.750

我不确定你为什么需要在这里嵌套事务。您只需要一笔实际交易：

```
BEGIN TRAN

DELETE FROM Employee
    FROM Employee
    INNER JOIN Department ON Employee.DepartmentID = Department.DepartmentID
    INNER JOIN Company ON Department.CompanyID = Company.CompanyID
    WHERE Company.CompanyID = @CompanyID

DELETE FROM Department
    FROM Department
    INNER JOIN Company ON Department.CompanyID = Company.CompanyID
    WHERE Company.CompanyID = @CompanyID

DELETE FROM Company
    WHERE Company.CompanyID = @CompanyID

COMMIT TRAN 
```

请注意双 FROM，这不是拼写错误，它是在 DELETE 中执行 JOIN 的正确 SQL 语法。

每个语句都是原子的，整个 DELETE 要么成功要么失败，这在这种情况下并不重要，因为整个批处理要么成功要么失败。

顺便说一句-我认为你的关系倒退了。Department 没有 EmployeeID，Employee 会有 DepartmentID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T13:25:09.637

我没有回答你的问题，但是外键*是*要走的路，为什么它不是一个选项？

至于嵌套事务，它们是：

```
BEGIN
  delete from Employee where departmentId = 1;
  BEGIN
     delete from Department where companyId = 2;
     BEGIN
        delete from Company where companyId = 2;
     END
  END
END 
```

以编程方式它看起来当然不同，但这取决于您使用的平台

# .net - ASP.NET 如何将控件呈现为 HTML？

> ID：58925
> 
> 赞同：31
> 
> 时间：2008-09-12T13:17:46.393
> 
> 标签：.net, asp.net

我有任何 ASP.NET 控件。我想要 HTML 字符串 怎么获取控件的 HTML 字符串？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-12T13:19:54.750

这似乎有效。

```
public string RenderControlToHtml(Control ControlToRender)
{
    System.Text.StringBuilder sb = new System.Text.StringBuilder();
    System.IO.StringWriter stWriter = new System.IO.StringWriter(sb);
    System.Web.UI.HtmlTextWriter htmlWriter = new System.Web.UI.HtmlTextWriter(stWriter);
    ControlToRender.RenderControl(htmlWriter);
    return sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-09-24T15:57:31.877

如果控件不是页面的一部分，则接受的答案`David Basarab`将不起作用。`a7drew`的答案似乎不必要的复杂 - 不需要在`Context`or中`Server.Execute`。

```
private string RenderControl()
{
    var sb = new System.Text.StringBuilder();
    using (var stWriter = new System.IO.StringWriter(sb))
    using (var htmlWriter = new HtmlTextWriter(stWriter))
    {
        var p = new Page();
        var ctrl = (YourControl)p.LoadControl("~/controls/building blocks/YourControl.ascx");
        ctrl.Visible = true;

        // do your own init logic if needed

        p.Controls.Add(ctrl);
        ctrl.RenderControl(htmlWriter);
        return sb.ToString();
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-12T15:34:25.503

如果您的控件是 Web 用户控件，您可以通过以下方式访问它从另一个页面或处理程序发出的 HTML：

```
public void GetHtmlFromMySweetControl(HttpContext context)
{
    HttpRequest httpRequest = context.Request;
    HttpResponse httpResponse = context.Response;

    string foo = httpRequest["foo"];

    Page pageHolder = new Page();
    string path = "~/usercontrols/MySweetControl.ascx";
    MySweetControl ctrl = (MySweetControl)pageHolder.LoadControl(path);
    ctrl.BindProducts(foo);
    pageHolder.Controls.Add(ctrl);

    StringWriter sw = new StringWriter();
    context.Server.Execute(pageHolder, sw, false);
    httpResponse.Write(sw.ToString());
} 
```

# visual-studio - Visual Studio 2005 中是否有“构建页面”的键盘快捷键？

> ID：58933
> 
> 赞同：1
> 
> 时间：2008-09-12T13:20:27.573
> 
> 标签：visual-studio

“构建页面”是您可以添加到工具栏的项目之一，以仅编译您正在处理的 ASPX 页面或 ASCX 控件。它有键盘快捷键吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T13:27:28.523

我总是使用`Ctrl`++ `Shift`，`B`它重建了整个解决方案。

您还可以通过单击工具/选项/键盘并向下滚动到构建选项来配置自己的键盘快捷键。（有 Build.BuildPage 或 Build.BuildSelection ...）

# visual-studio - 如何在 Visual Studio 2005 / 2008 (ASP.NET, C#) 中永久删除断点

> ID：58935
> 
> 赞同：10
> 
> 时间：2008-09-12T13:21:50.673
> 
> 标签：visual-studio

通常，当我在 Visual Studio 的某行上设置断点时，程序会在那里运行并停止。伟大的。然后我将单击红色圆圈（或按 F9）将其删除。显然我不希望我的程序一直停在那里。问题是下次我刷新页面时断点又回来了！永久删除它的唯一方法是打开断点窗口并将其删除。为什么会发生这种情况，我该如何改变这种行为？

我注意到这些不断返回的断点在断点窗口中旁边有一个小加号，当您单击时 - 打开许多断点的子行。这有什么关系？

谢谢， 阿丁

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-12T13:30:54.863

有用的组合键：要永久删除所有断点，请按 CTRL + SHIFT + F9。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-12T13:27:26.760

只需在调试器关闭时清除断点。当您在调试时清除或添加断点时，该操作仅持续该调试会话。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-12T18:09:31.170

当一个用户提供的断点在多个位置绑定时，断点窗口中的加号就在那里。例如，当在同一个调试会话中多次加载单个文件时，可能会发生这种情况。+ 可让您查看它绑定的每个位置。

@Joel：在调试会话期间修改断点不会使您的更改成为暂时的，尽管在某些情况下（如原始问题），实际行为可能不明显。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-08T10:52:01.590

我已经向 MS 发布了修复它的建议： [https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=391642](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=391642)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-04T15:29:42.493

似乎是因为 Visual Studio 允许在单行上设置多个断点，即在单独的子条款中，在架构上它允许多个相同的断点。界面不一定反映这一点，您会看到断点的删除是以图形方式删除它，但不是以编程方式删除它的所有实例。

查看**Debug > Windows > Breakpoints**窗口显示了一行上给定的一组断点，它们存储在该行项下的子树中。在查看此列表时删除断点将显示行为，即从与该行关联的列表中仅删除一系列相同断点中的一个。通过删除断点行项目及其所有子项目，它将完全删除断点的所有实例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-14T20:34:48.820

使用断点窗口 (Ctrl + Alt + B) 擦除断点。

在调试时，当您遇到断点时，请查看 BreakPoint 窗口中的粗体。

然后，右键单击它并选择删除。

# .net - 如何在 VB.NET 中切换 Caps Lock？

> ID：58937
> 
> 赞同：5
> 
> 时间：2008-09-12T13:22:03.200
> 
> 标签：.net, windows, vb.net

使用 VB.NET，如何切换 Caps Lock 的状态？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-12T13:24:50.713

试试[这个](http://social.msdn.microsoft.com/forums/en-US/vbgeneral/thread/718c0860-ab1a-4a0a-98af-a101cdfecf4e/)：

```
Public Class Form1
    Private Declare Sub keybd_event Lib "user32" (ByVal bVk As Byte, ByVal bScan As Byte, ByVal dwFlags As Integer, ByVal dwExtraInfo As Integer)
    Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
            Call keybd_event(System.Windows.Forms.Keys.CapsLock, &H14, 1, 0)
            Call keybd_event(System.Windows.Forms.Keys.CapsLock, &H14, 3, 0)
        End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-12T13:24:33.193

来自：[http ://www.vbforums.com/showthread.php?referrerid=61394&t=537891](http://www.vbforums.com/showthread.php?referrerid=61394&t=537891)

```
Imports System.Runtime.InteropServices

Public Class Form2

    Private Declare Sub keybd_event Lib "user32" ( _
        ByVal bVk As Byte, _
        ByVal bScan As Byte, _
        ByVal dwFlags As Integer, _
        ByVal dwExtraInfo As Integer _
    )
    Private Const VK_CAPITAL As Integer = &H14
    Private Const KEYEVENTF_EXTENDEDKEY As Integer = &H1
    Private Const KEYEVENTF_KEYUP As Integer = &H2

    Private Sub Button1_Click( _
        ByVal sender As System.Object, _
        ByVal e As System.EventArgs _
    ) Handles Button1.Click

        ' Toggle CapsLock

        ' Simulate the Key Press
        keybd_event(VK_CAPITAL, &H45, KEYEVENTF_EXTENDEDKEY Or 0, 0)

        ' Simulate the Key Release
        keybd_event(VK_CAPITAL, &H45, KEYEVENTF_EXTENDEDKEY Or KEYEVENTF_KEYUP, 0)
    End Sub

End Class 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-11-09T18:45:37.150

我用这个

```
Private Declare Sub keybd_event Lib "user32" (ByVal bVk As Byte, ByVal bScan As Byte, ByVal dwFlags As Integer, ByVal dwExtraInfo As Integer)
Private Const KEYEVENTF_EXTENDEDKEY As Integer = &H1
Private Const KEYEVENTF_KEYUP As Integer = &H2
'put this where you want to turn caps lock on or off
keybd_event(VK_NUMLOCK, &H45, KEYEVENTF_EXTENDEDKEY Or 0, 0)
keybd_event(VK_NUMLOCK, &H45, KEYEVENTF_EXTENDEDKEY Or KEYEVENTF_KEYUP, 0) 
```

# java - JComboBox 选择更改监听器？

> ID：58939
> 
> 赞同：161
> 
> 时间：2008-09-12T13:24:16.580
> 
> 标签：java, swing, jcombobox, itemlistener

每当从`JComboBox`.

我遇到的问题是没有明显的`addSelectionListener()`方法。

我试过使用`actionPerformed()`，但它永远不会触发。

没有覆盖 的模型`JComboBox`，我没有想法。

如何在`JComboBox`?**上收到选择更改的通知？

**编辑：**我必须道歉。事实证明我使用了一个行为不端的子类`JComboBox`，但我会留下这个问题，因为你的回答很好。

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2008-09-12T13:32:22.160

它应该响应[ActionListeners](http://docs.oracle.com/javase/7/docs/api/java/awt/event/ActionListener.html)，如下所示：

```
combo.addActionListener (new ActionListener () {
    public void actionPerformed(ActionEvent e) {
        doSomething();
    }
}); 
```

[@John Calsbeek](https://stackoverflow.com/a/58965/1429387)正确地指出这`addItemListener()`也行得通。但是，您可能会得到 2 `ItemEvents`，一个用于取消选择先前选择的项目，另一个用于选择新项目。只是不要同时使用这两种事件类型！

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2013-01-20T12:28:37.360

`ItemListener`实现代码示例

```
class ItemChangeListener implements ItemListener{
    @Override
    public void itemStateChanged(ItemEvent event) {
       if (event.getStateChange() == ItemEvent.SELECTED) {
          Object item = event.getItem();
          // do something with object
       }
    }       
} 
```

现在我们将只获得选定的项目。

然后只需将侦听器添加到您的 JComboBox

```
addItemListener(new ItemChangeListener()); 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-12T13:33:50.613

如果jodonnell的解决方案失败，我会尝试接口的`itemStateChanged()`方法。[`ItemListener`](http://java.sun.com/javase/6/docs/api/java/awt/event/ItemListener.html)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-07-24T23:08:03.207

下面是创建一个 ComboBox，为项目选择更改添加一个侦听器：

```
JComboBox comboBox = new JComboBox();

comboBox.setBounds(84, 45, 150, 20);
contentPane.add(comboBox);

JComboBox comboBox_1 = new JComboBox();
comboBox_1.setBounds(84, 97, 150, 20);
contentPane.add(comboBox_1);
comboBox.addItemListener(new ItemListener() {
    public void itemStateChanged(ItemEvent arg0) {
        //Do Something
    }
}); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-02-02T19:38:08.893

你可以试试这些

```
 int selectedIndex = myComboBox.getSelectedIndex(); 
```

-或者-

```
Object selectedObject = myComboBox.getSelectedItem(); 
```

-或者-

```
String selectedValue = myComboBox.getSelectedValue().toString(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-02-02T22:23:08.327

我最近一直在寻找这个相同的解决方案，并设法找到一个简单的解决方案，而无需为最后一个选定项目和新选定项目分配特定变量。这个问题虽然很有帮助，但并没有提供我需要的解决方案。这解决了我的问题，我希望它能解决你和其他人的问题。谢谢。

[我如何获得上一个或最后一个项目？](https://stackoverflow.com/questions/14647439/how-to-get-previous-last-item-jcombobox)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-11-05T06:29:38.153

你可以用 jdk >= 8 做到这一点

```
getComboBox().addItemListener(this::comboBoxitemStateChanged); 
```

所以

```
public void comboBoxitemStateChanged(ItemEvent e) {
    if (e.getStateChange() == ItemEvent.SELECTED) {
        YourObject selectedItem = (YourObject) e.getItem();
        //TODO your actitons
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-08-17T17:18:48.653

我用这个：

```
 cb = new JComboBox<String>();
    cb.setBounds(10, 33, 46, 22);
    panelConfig.add(cb);
    for(int i = 0; i < 10; ++i)
    {
        cb.addItem(Integer.toString(i));
    }
    cb.addItemListener(new ItemListener()
    {
        @Override
        public void itemStateChanged(ItemEvent e)
        {
            if(e.getID() == temEvent.ITEM_STATE_CHANGED)
            {
                if(e.getStateChange() == ItemEvent.SELECTED)
                {
                    JComboBox<String> cb = (JComboBox<String>) e.getSource();
                    String newSelection = (String) cb.getSelectedItem();
                    System.out.println("newSelection: " + newSelection);
                }
            }
        }
    }); 
```

# sql - 从存储过程 Transact-SQL SQL Server 中访问结果集

> ID：58940
> 
> 赞同：37
> 
> 时间：2008-09-12T13:24:24.630
> 
> 标签：sql, sql-server, tsql

我正在使用 SQL Server 2005，我想知道如何从 transact-sql 中访问不同的结果集。以下存储过程返回两个结果集，例如，如何从另一个存储过程访问它们？

```
CREATE PROCEDURE getOrder (@orderId as numeric) AS
BEGIN   
    select order_address, order_number from order_table where order_id = @orderId
    select item, number_of_items, cost from order_line where order_id = @orderId
END 
```

我需要能够单独遍历两个结果集。

编辑：只是为了澄清问题，我想测试存储过程。我有一组从 VB.NET 客户端使用的存储过程，它们返回多个结果集。这些不会更改为表值函数，实际上我根本无法更改程序。改变程序不是一种选择。

过程返回的结果集不是相同的数据类型或列数。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-12T13:48:13.370

简短的回答是：你做不到。

从 T-SQL 中，如果不按照其他人的建议更改存储过程，就无法访​​问嵌套存储过程调用的多个结果。

完整地说，如果过程返回单个结果，您可以使用以下语法将其插入到临时表或表变量中：

```
INSERT INTO #Table (...columns...)
EXEC MySproc ...parameters... 
```

您可以对返回多个结果的过程使用相同的语法，但它只会处理第一个结果，其余的将被丢弃。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-18T20:02:33.440

通过创建一个包含内部数据集的 SQL2005 CLR 存储过程，我很容易做到这一点。

您会看到，一个新的 SqlDataAdapter 默认情况下会将一个多结果集存储过程填充到一个多表数据集中。这些表中的数据可以依次插入到您希望编写的调用存储过程中的#Temp 表中。 **dataset.ReadXmlSchema**将向您显示每个结果集的架构。

**第 1 步：开始编写 sproc，它将从多结果集 sproc 中读取数据**

一种。根据架构为每个结果集创建一个单独的表。

```
CREATE PROCEDURE [dbo].[usp_SF_Read] AS
SET NOCOUNT ON;
CREATE TABLE #Table01 (Document_ID VARCHAR(100)
  , Document_status_definition_uid INT
  , Document_status_Code VARCHAR(100) 
  , Attachment_count INT
  , PRIMARY KEY (Document_ID)); 
```

湾。此时您可能需要声明一个游标来重复调用您将在此处创建的 CLR 存储过程：

**第 2 步：制作 CLR Sproc**

```
Partial Public Class StoredProcedures
    <Microsoft.SqlServer.Server.SqlProcedure()> _
    Public Shared Sub usp_SF_ReadSFIntoTables()

    End Sub
End Class 
```

一种。使用 连接`New SqlConnection("context connection=true")`。

湾。设置一个命令对象 (cmd) 以包含多结果集存储过程。

C。使用以下命令获取所有数据：

```
 Dim dataset As DataSet = New DataSet
    With New SqlDataAdapter(cmd)
        .Fill(dataset) ' get all the data.
    End With
'you can use dataset.ReadXmlSchema at this point... 
```

d。遍历每个表并将每一行插入适当的临时表（您在上面的第一步中创建）。

**最后一点：** 根据我的经验，您可能希望在表之间强制执行一些关系，以便知道每条记录来自哪个批次。

这就是它的全部！

〜肖恩，西雅图附近

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-08-23T22:21:28.563

你也可以做一些事情。将可选参数 N int 添加到您的存储过程中。默认值 N 为 -1。如果 N 的值为 -1，则执行您的每一项选择。否则，进行第 N 次选择，并且仅进行第 N 次选择。

例如，

```
if (N = -1 or N = 0)
    select ...

if (N = -1 or N = 1)
    select ... 
```

未指定 N 的 sproc 调用者将获得包含多个表的结果集。如果您需要从另一个存储过程中提取这些表中的一个或多个，只需调用指定 N 值的存储过程即可。您必须为要提取的每个表调用存储过程一次。如果您需要来自结果集中的多个表，则效率低下，但它确实适用于纯 TSQL。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T21:52:05.883

请注意，INSERT INTO ... EXEC 语句有一个额外的、未记录的限制：它不能嵌套。也就是说，EXEC 调用的存储过程（或它依次调用的任何过程）本身不能执行 INSERT INTO ... EXEC。似乎每个进程都有一个累积结果的暂存器，如果它们是嵌套的，当调用者打开它时你会得到一个错误，然后被调用者尝试再次打开它。

Matthieu，您需要为每种“类型”的结果维护单独的临时表。此外，如果您多次执行相同的操作，您可能需要在该结果中添加一个额外的列，以指示它来自哪个调用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-06T19:37:21.500

遗憾的是，不可能做到这一点。当然，问题是没有允许它的 SQL 语法。当然，它发生在“幕后”，但是您无法在 TSQL 中获得这些其他结果，只能通过 ODBC 或其他方式从应用程序中获得。

与大多数事情一样，有一种方法可以绕过它。诀窍是在 TSQL 中使用 ole 自动化来创建一个 ADODB 对象，该对象依次打开每个结果集并将结果写入您指定的表（或对结果集执行任何您想要的操作）。如果您喜欢疼痛，也可以在 DMO 中进行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-12T13:36:12.667

有两种方法可以轻松做到这一点。要么将结果粘贴到临时表中，然后从存储过程中引用临时表。另一种选择是将结果放入用作 OUTPUT 变量的 XML 变量中。

然而，这两种选择各有利弊。对于临时表，您需要将代码添加到创建调用过程的脚本中，以在修改过程之前创建临时表。此外，您应该在过程结束时清理临时表。

使用 XML，它可能会占用大量内存并且速度很慢。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T13:31:51.117

您可以将它们选择到临时表中或编写表值函数以返回结果集。正在询问如何遍历结果集？

# unit-testing - 使用 PHPUnit 对具有多种用户类型的网站进行单元测试的最佳方法

> ID：58969
> 
> 赞同：3
> 
> 时间：2008-09-12T13:35:08.567
> 
> 标签：unit-testing, types, phpunit

我开始学习如何使用 PHPUnit 来测试我正在开发的网站。我遇到的问题是我定义了五种不同的用户类型，我需要能够使用不同类型测试每个类。我目前有一个用户类，我想将它传递给每个函数，但我不知道如何传递它或测试可能返回为正确与否的不同错误。

**编辑：**我应该说。我有一个用户类，我想将此类的不同实例传递给每个单元测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T14:33:08.073

如果您的各种用户类继承自父用户类，那么我建议您对测试用例类使用相同的继承结构。

考虑以下示例类：

```
class User
{
    public function commonFunctionality()
    {
        return 'Something';
    }

    public function modifiedFunctionality()
    {
        return 'One Thing';
    }
}

class SpecialUser extends User
{
    public function specialFunctionality()
    {
        return 'Nothing';
    }

    public function modifiedFunctionality()
    {
        return 'Another Thing';
    }
} 
```

您可以对测试用例类执行以下操作：

```
class Test_User extends PHPUnit_Framework_TestCase
{
    public function create()
    {
        return new User();
    }

    public function testCommonFunctionality()
    {
        $user = $this->create();
        $this->assertEquals('Something', $user->commonFunctionality);
    }

    public function testModifiedFunctionality()
    {
        $user = $this->create();
        $this->assertEquals('One Thing', $user->commonFunctionality);
    }
}

class Test_SpecialUser extends Test_User
{
    public function create() {
        return new SpecialUser();
    }

    public function testSpecialFunctionality()
    {
        $user = $this->create();
        $this->assertEquals('Nothing', $user->commonFunctionality);
    }

    public function testModifiedFunctionality()
    {
        $user = $this->create();
        $this->assertEquals('Another Thing', $user->commonFunctionality);
    }
} 
```

因为每个测试都依赖于您可以覆盖的 create 方法，并且因为测试方法是从父测试类继承的，所以父类的所有测试都将针对子类运行，除非您覆盖它们以更改预期的行为。

这在我有限的经验中非常有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T13:38:57.747

如果您想测试实际的 UI，您可以尝试使用 Selenium (www.openqa.org) 之类的东西。它允许您用 PHP（我假设它可以与 phpUnit 一起使用）编写代码来驱动浏览器。

另一种方法是使用一个通用方法，每个测试都可以为您的不同用户类型调用该方法。即，类似“ValidatePage”的东西，然后您可以从 TestAdminUser 或 TestRegularUser 调用它，并让该方法简单地对您期望的内容执行相同的基本验证..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T12:46:23.227

只要确保你没有在这里遇到**反模式**。也许你在构造函数中做了太多的工作？或者也许这些实际上应该是不同的类？**测试通常会为您提供有关代码设计的**线索。听他们说。

# .net - 如何在 VB.NET 中获取 Caps Lock 的当前状态？

> ID：58976
> 
> 赞同：11
> 
> 时间：2008-09-12T13:37:16.347
> 
> 标签：.net, windows, vb.net

如何使用 VB.NET 确定 Caps Lock 是否已激活？

[这是我之前的问题](https://stackoverflow.com/questions/58937/how-do-i-toggle-caps-lock-in-vbnet)的后续。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-12T13:41:04.043

[Control.IsKeyLocked(Keys) 方法 - MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.iskeylocked.aspx)

```
Imports System
Imports System.Windows.Forms
Imports Microsoft.VisualBasic

Public Class CapsLockIndicator

    Public Shared Sub Main()
        if Control.IsKeyLocked(Keys.CapsLock) Then
            MessageBox.Show("The Caps Lock key is ON.")
        Else
            MessageBox.Show("The Caps Lock key is OFF.")
        End If
    End Sub 'Main
End Class 'CapsLockIndicator 
```

* * *

C#版本：

```
using System;
using System.Windows.Forms;

public class CapsLockIndicator
{
    public static void Main()
    {
        if (Control.IsKeyLocked(Keys.CapsLock)) {
            MessageBox.Show("The Caps Lock key is ON.");
        }
        else {
            MessageBox.Show("The Caps Lock key is OFF.");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T13:40:43.593

我不是 VB.NET 方面的专家，所以我只想到了 PInvoke：

```
Declare Function GetKeyState Lib "user32" 
   Alias "GetKeyState" (ByValnVirtKey As Int32) As Int16

Private Const VK_CAPSLOCK = &H14

If GetKeyState(VK_CAPSLOCK) = 1 Then ... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-03-28T13:31:04.953

创建一个设置为 5 毫秒并启用的 Timer。
然后制作一个名为`label1`. 之后，尝试以下代码（在计时器事件处理程序中）。

```
Private Sub Timer1_Tick(sender As Object, e As EventArgs) Handles Timer1.Tick
    If My.Computer.Keyboard.CapsLock = True Then
        Label1.Text = "Caps Lock Enabled"
    Else
        Label1.Text = "Caps Lock Disabled"
    End If
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-28T15:24:22.447

[.rp](https://stackoverflow.com/a/58993/7444103)发布的解决方案有效，但与`Me.KeyDown`事件处理程序冲突。
我有一个 sub 在按下 enter 时调用登录功能（如下所示）。状态有效且不
与.`My.Computer.Keyboard.CapsLock``Me.Keydown`

```
Private Sub WindowLogin_KeyDown(sender As Object, e As KeyEventArgs) Handles Me.KeyDown

    If Keyboard.IsKeyDown(Key.Enter) Then
        Call SignIn()
    End If

End Sub 
```

# java - 接口隔离原则背后的原因是什么？

> ID：58988
> 
> 赞同：26
> 
> 时间：2008-09-12T13:40:17.947
> 
> 标签：java, oop, solid-principles, design-principles, interface-segregation-principle

接口隔离原则 (ISP) 说，许多特定于客户端的接口优于一个通用接口。为什么这很重要？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-12T13:45:54.407

ISP 声明：

> 不应强迫客户依赖他们不使用的方法。

ISP 涉及到重要的特性——[内聚](http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29)和[耦合](http://en.wikipedia.org/wiki/Coupling_%28computer_science%29)。
理想情况下，您的组件必须高度定制。它提高了代码的健壮性和可维护性。

执行 ISP 可为您带来以下好处：

*   高[内聚](http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29)- 更好的可理解性、鲁棒性
*   低[耦合](http://en.wikipedia.org/wiki/Coupling_%28computer_science%29)- 更好的可维护性，高抗更改性

如果您想了解有关软件设计原则的更多信息，请获取《[敏捷软件开发、原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0135974445)》一书的副本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-08-01T16:15:46.030

界面隔离是SOLID原则上的“我”，在深入第一个之前，让我们解释一下后者是什么意思。

SOLID 可以被认为是专家提出的一组最佳实践和建议（意味着它们已经被证明过），以便为我们如何设计应用程序提供可靠的基础。这些实践力求使我们的应用程序更易于维护、扩展、调整和扩展。

**我为什么要关心 SOLID 编程？**

首先，你必须意识到你不会永远在你所在的地方。如果我们使用标准和众所周知的架构，我们可以确定我们的代码将很容易被我们之后的其他开发人员维护，而且我相信您不会想要处理修复代码的任务'没有应用任何已知的方法，因为它很难理解。

**接口隔离原则。**

知道我们知道什么是 SOLID 原则，我们可以更详细地了解接口隔离原则，但是接口隔离到底说了什么？

> “不应强迫客户实施他们不会使用的不必要的方法”</p>

这意味着有时我们倾向于使用很多方法来制作接口，这在一定程度上可能很好，但是这很容易被滥用，我们最终会得到实现空方法或无用方法的类，这当然会增加额外的代码和负担到我们的应用程序。想象一下，你在单个接口中声明了很多方法，如果你喜欢视觉辅助一个正在实现接口但确实需要几个方法的类，它看起来像这样：

![在此处输入图像描述](https://i.stack.imgur.com/V6p8i.png)

另一方面，如果您正确应用接口隔离并将接口拆分为更小的子集，您可以确保实现那些只需要的：

![在此处输入图像描述](https://i.stack.imgur.com/M0eWu.png)

看！好多了！执行此原则将使您具有低耦合性，这有助于更好的可维护性和对更改的高抵抗力。因此，您可以真正利用接口的使用并在真正需要的时候实现方法。现在让我们回顾一个不太抽象的示例，假设您声明了一个名为 Reportable 的接口

```
public interface Reportable {

        void printPDF();
        void printWord();
        void printExcel();
        void printPPT();
        void printHTML();

} 
```

而且你有一个客户端，只导出Excel格式的一些数据，你可以实现接口，但你只需要实现excel方法吗？答案是否定的，即使您不打算使用它们，您也必须为所有方法编写实现代码，这可能会导致大量垃圾代码，从而使代码难以维护。

**记住保持简单，不要重复自己，你会发现你已经在不知不觉中使用了这个原则。**

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-12T13:47:05.167

它简化了任何一个客户端将使用的接口，并删除了他们可能在他们不需要的接口部分上开发的依赖项。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-12T17:07:35.403

一个原因是，拥有许多接口，每个接口的方法数量最少，这样更容易实现每个接口并正确实现它们。一个大的界面可能是不守规矩的。此外，在场景中使用焦点接口使代码更易于维护，因为您可以看到正在使用对象的哪个方面（例如，IComparable 接口让您知道该对象仅用于给定场景中的比较）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-12-13T09:24:10.043

该原则主要用于双重目的

*   使代码更具可读性和可管理性。

*   促进对类的单一责任（高凝聚力）。当然，为什么一个类应该有一个对行为没有影响的方法？为什么不直接删除它。这就是 ISP 的意义所在

设计师必须向 ISP 提出一些问题

*   用 ISP 实现什么
*   如何分析任何 ISP 违规的现有代码

为了进一步讨论，我还必须补充一点，这个原则并不是最严格意义上的“原则”，因为在某些情况下，将 ISP 应用于设计，而不是提高可读性，可能会使对象结构变得不可读和混乱不必要的代码。您可能会在 java.awt.event 包中观察到这一点

更多在我的博客：[http ://design-principle-pattern.blogspot.in/2013/12/interface-segregation-principle.html](http://design-principle-pattern.blogspot.in/2013/12/interface-segregation-principle.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-10-14T11:45:30.457

[ISP](https://en.wikipedia.org/wiki/Interface_segregation_principle)很重要。

ISP 的基本思想：不应强迫客户依赖它不使用的方法。

这个原则似乎更符合逻辑。理想情况下，客户端不应实现客户端不使用的方法。

有关代码示例，请参阅下面的 SE 问题：

[接口隔离原则——程序到接口](https://stackoverflow.com/questions/9249832/interface-segregation-principle-program-to-an-interface/35382190#35382190)

好处：

1.  **灵活性**：在没有 ISP 的情况下，您有一个通用 FAT 接口和许多实现它的类。假设您有 1 个接口和 50 个类。如果接口发生变化，则所有 50 个类都必须更改其实现。

    使用 ISP，您可以将通用 FAT 接口划分为细粒度的小接口。如果小粒度接口发生变化，只有实现该接口的类会受到影响。

2.  **可维护性和易用性**：由于更改仅限于细粒度接口而不是通用 FACT 接口，因此代码维护更容易。不相关的代码不再是实现类的一部分。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-05-31T15:38:29.627

[罗伯特马丁](https://drive.google.com/file/d/0BwhCYaYDn8EgOTViYjJhYzMtMzYxMC00MzFjLWJjMzYtOGJiMDc5N2JkYmJi/view)关于这个主题的论文给出了一个很少被提及的解释：

> 客户端对接口施加的反向力。

如果两个类直接依赖于第三类的两种不同方法，则会增加对前两个类中的任何一个的更改会影响另一个的可能性。

假设我们有三个类：`Red`、`Green`和`Blue`。

`Red`两者`Green`都取决于`Blue`，但每个都取决于不同的方法。这意味着这`Red`取决于一种方法，`Blue`但不使用另一种方法。同样，`Green`取决于`Blue`，但仅使用一种方法，而不使用另一种方法。

违反原则是因为每个都依赖于一个类 -`Red`但至少没有使用它的一个方法*。*`Green``Blue`

 *这可能会产生什么问题？

*   我需要改变`Red`，我也`Blue`需要改变以适应`Red`.
*   我没有改变具体的方法`Blue`，`Green`取决于，但仍然`Green`依赖`Blue`，我已经改变了`Blue`，这仍然会影响`Green`。
*   因此，我的更改`Red`可能会产生影响`Blue`，因为它们导致我更改了一个两者都依赖的类。

这就是“倒退的力量”。我们有时会因为客户的需要而更改课程。如果该课程有不同的客户将其用于不同的事情，我们就有影响他们的风险。

如前所述，接口隔离原则的简单定义是：

> 不应强迫任何客户依赖它不使用的方法。

在罗伯特·马丁论文的上述观点和上述观点之间，很明显，对 ISP 的许多解释实际上是在谈论其他原则。

*   具有大量方法的类或接口是不可取的，但不是专门因为 ISP。他们可能违反单一职责。但是 ISP 违规不在大接口或大类中 -如果它们不使用大接口的所有方法，则在*依赖于大接口的类中。*如果他们使用所有方法，听起来仍然很混乱，但这与 ISP 无关。
*   实现接口但为某些方法抛出异常的类是不好的，但这也不是 ISP。ISP 是关于*依赖*于接口的类，而不是*实现*接口的类。

如果我们用谷歌搜索“接口隔离”，大多数包含代码示例的顶级结果都展示了*没有完全实现*接口的类，这不是 ISP 的重点。有些人甚至错误地重申了这一原则：

> 接口隔离原则指出不应强迫客户端实现他们不使用的接口

...但这*不是*原则。定义文件提到了违反 ISP 的副作用，但指出它们是 Liskov Substitution 违规。

> 此外，每次将新接口添加到基类时，都必须在派生类中实现（或允许默认）该接口。实际上，相关的做法是将这些接口作为 nil 虚函数而不是纯虚函数添加到基类中；特别是这样派生类就不必承担实现它们的需要。正如我们在本专栏的第二篇文章中了解到的那样，这种做法*违反了 Liskov 替换原则（LSP），导致了维护和可重用性问题。*

更重要的是，说客户端不应该实现它不使用的方法甚至没有意义。接口的*客户端*不实现他们使用或不使用的方法——他们使用它的方法。的客户端`List<E>`不*实现*的方法和属性`List<E>`。它*调用*的方法和属性`List<E>`。

我并不是要夸张地引用这篇论文，就好像它是神圣的令状或什么的。但是如果我们要使用文章中描述的原理的名称（文章本身的名称），那么我们还应该考虑该文章中包含的实际定义和解释。*******