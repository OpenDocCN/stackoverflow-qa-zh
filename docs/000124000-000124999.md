# StackOverflow 问答 000124000-000124999

# globalization - 为什么软件对双向文本（希伯来语、阿拉伯语）的支持如此差？

> ID：124002
> 
> 赞同：5
> 
> 时间：2008-09-23T21:25:35.963
> 
> 标签：globalization, standards-compliance, bidi

虽然大多数操作系统和 Web 浏览器对[双向文本](http://en.wikipedia.org/wiki/Bi-directional_text)（例如希伯来语和阿拉伯语）提供了很好的支持，但大多数商业和开源软件却没有：

*   除了原始的记事本和 Visual Studio 编辑器之外，大多数文本编辑器都做得很差。（我尝试了几十个）。
*   我找不到任何文件比较工具做得不错 - 甚至没有 Beyond-Compare。
*   处理图表和报告的软件和软件包也是如此。

我有一些问题：

*   你和我一样痛苦吗？
*   你写的软件是双向兼容的吗？你有关于它的错误报告吗？
*   你甚至知道所涉及的问题是什么？你为他们测试吗？
*   关于如何使软件世界成为双向语言使用者的更好场所的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T21:46:52.933

我认为这个问题主要有两个答案：

1）大多数语言都是从左到右阅读的，所以人们要么认为没有它就可以逃脱，要么一开始就根本不考虑它。

2）可能很难支持它，这取决于您的项目是什么。如果您的工具/库不支持它，您的软件可能也不支持。这不仅在编程意义上很难，而且当程序员不熟悉从右到左的语言时，很难做到这一点。据我了解，要真正正确地支持双向文本，UI 中的某些内容也必须翻转以看起来“正确”。

我对此有所了解的唯一原因是因为我和一个以阿拉伯语为母语的人一起工作，我已经和他谈了一点。我对它还不是很了解。我们的产品最近才开始支持阿拉伯语，而我并未参与其中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T21:32:42.310

> 你和我一样痛苦吗？

不，这可能就是答案：大多数人不知道双向语言是如何工作的。例如，我在使用它时遇到了一些麻烦。因为我对那个话题很感兴趣，所以我前一阵子阅读了 pango 资源，这可能是支持糟糕的第二个原因：很难做对。

我认为 GNOME 项目是对双向用户界面的最佳支持之一，这要归功于 Pango（当然我无法验证这一点，因为我无法发现问题）。

但是因为你说的“开源”：我认为开源项目的全球化支持总体上是突出的。Linux 糟透了几乎一切，但国际化是他们做对的事情。

gettext 仍然是少数几个拥有（我知道半生不熟但）工作多元化系统的翻译系统之一。

> 你写的软件是双向兼容的吗？你有关于它的错误报告吗？

可能不是。我目前正在开发一个网络发布软件，这是我到目前为止还没有测试过的东西之一:-(

> 你甚至知道所涉及的问题是什么？你为他们测试吗？

双向支持并非没有直接的路线图。所以没有对他们进行测试，我从我为 Plurk 编写的翻译界面中知道问题出在哪里。

> 关于如何使软件世界成为双向语言使用者的更好场所的任何建议？

对于一个开源项目：请那些知道问题出在哪里的人来帮助你。对于封闭源？雇一个知道的人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T21:36:06.513

如果您将一个字符串分解为子字符串并单独显示它们，您将破坏操作系统的双向渲染，如果您添加一些主要是无辜的符号（例如 - 例如），您将弄乱文本显示。

编写双向兼容软件你必须知道的两件事是：

1.  始终显示整个字符串，切勿尝试显示较大字符串的一部分。
2.  始终使用双向文本测试任何格式代码。

如果你正在编写一个文本编辑器、文字处理器或任何需要高端排版的东西，而你不能遵循上面的规则 1，那么编写一个双向渲染引擎是一项繁重的工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:33:50.357

很简单，让更多双向语言的人表达他们的担忧！由于双向语言用户如此之少，我想双向文本支持在大多数人的优先级列表中相当低。但是，您和其他双向语言使用者文件报告的错误越多，解决的问题就越多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T21:40:12.307

我是左撇子，处理物理世界中的类似问题。企业主要迎合大多数人，这是少数人的自然组成部分。

如果您认为双向文本存在问题，您应该在某个时候检查一下[土耳其语 i](http://msdn.microsoft.com/en-us/library/ms994325.aspx#cltsafcode_topic4)问题。

无论如何，我认为要么文本处理将变得非常标准化，并且库将正确地做事，要么你必须等到应用程序变得足够大以保证添加良好的支持。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T00:22:39.657

我知道 Flash 中的 ltr 文本令人头疼——我听说它对网页来说更容易，尽管你必须小心处理字符串的方式，以免它们混淆。

这是一个非常主观的问题，顺便说一句，一个不可能找到“解决方案”的问题——你确定这是问这个问题的正确地方吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-03-06T00:50:29.973

我自己一直在研究如何将原生 BiDi 添加到 Android。到目前为止的结果：很多工作，Android 几乎没有真正的 BiDi。

问题是计算机的世界都是关于互联网和共享的，尤其是开源软件。这意味着主要语言是问题，如果您注意到英语实际上是标准语言，而其他（主要是西方）语言作为附带翻译提供。

我说阿拉伯语/希伯来语/英语。对于计算机，我几乎只使用英语，用阿拉伯语/希伯来语表示本地内容（新闻、在线电视等），这些内容可以被网络浏览器很好地处理。然而，自从我购买了三星 Galaxy 并开始更新固件后，我开始注意到问题有多大:(

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:46:39.500

关于一些答案的注释 - 没有“双向语言”。语言是从左到右或从右到左（或从上到下......）。如果文本或字符串同时包含希伯来语和英语，则它可以是双向的。

关于这个问题，Firefox 似乎对我很有效。还有 MSWord，这几乎是我使用希伯来语的所有内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T00:18:30.510

*关于如何使软件世界成为双向语言使用者的更好场所的任何建议？*

不幸的是，除非有更多的 RTL 语言使用者参与全球事务，否则我认为情况不会好转*……*这似乎不太可能。

目前我们有以色列，这是一个技术非常先进的社会，但非常小，几乎所有受过教育的人都会说英语。还有一些阿拉伯国家和其他使用阿拉伯文字的国家，根据我所看到的研究，它们产生和消耗的信息几乎没有西方世界那么多。

# c# - 如何克服数据流任务中的 vs_needsnewmetadata 错误？

> ID：124005
> 
> 赞同：6
> 
> 时间：2008-09-23T21:26:30.983
> 
> 标签：c#, ssis, packages, configuration-files

我有一个 SSIS 包，可以将表中的数据从一个 SQL Server 2005 复制到另一个 SQL Server 2005。我通过“数据流”任务执行此操作。在包配置文件中，我公开了目标表名称。

问题是当我在配置文件中更改目标表名（通过记事本）时，我收到以下错误“vs_needsnewmetadata”。我想我理解这个问题......当我第一次设置包时，目标表列映射是固定的。

问题：使用 ssis 包完成上述操作的最简单方法是什么？

我已经在线阅读了有关以编程方式设置元数据的信息，但我想避免这种情况。我还编写了一个 C# 控制台应用程序，它做的一切都很好......所有表等都在 app.config 中指定......但显然这个解决方案还不够好。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T21:30:00.067

您是否在 Data Source Destination 属性上将 DelayValidation 设置为 False？如果没有，请尝试。

编辑：当然这应该是延迟验证为真，所以它只是继续尝试而不是检查。此外，与其在记事本中更改包，为什么不将表名放入变量中，将变量放入目标的表达式中，然后在 .DtsConfig 配置文件中公开变量？然后你可以毫无危险地改变它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-13T09:45:06.267

匹配区分大小写的源目标列已经为我完成了工作。

就像在我的例子`SrNo_prod`中是 dev 中的列并使用它我们开发了 dtsx，而它是`SrNo_Prod`在 prod 中创建的，在将 case 更改为`P`to之后`p`，我们成功执行了包。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T07:50:43.977

Check if the new destination table has the same columns as the old one.

I believe the error occurs if the columns are different, and the destination can no longer map its input columns to the table columns. If two tables have the same schema, this error should not occur.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T23:00:31.053

如果您所做的只是将数据从一台 SQL2005 服务器复制到另一台服务器，我只需创建一个链接服务器并使用存储过程来复制数据。SSIS 包是多余的。

[如何创建链接服务器](http://msdn.microsoft.com/en-us/library/aa560998.aspx)

创建链接服务器后，您只需编写类似...

```
INSERT INTO server1.dbo.database1.table1(id,name)
SELECT id, name FROM server2.dbo.database1.table1 
```

就 SSIS 包而言，我总是不得不重新打开并重建包，以便在修改表列属性时更新元数据。

# sql-server - SQL Server Management Studio 2005 - 更改备份位置的默认目录

> ID：124031
> 
> 赞同：11
> 
> 时间：2008-09-23T21:30:54.997
> 
> 标签：sql-server, sql-server-2005, configuration, ssms

使用 MS SQL Server Management Studio 2005 - 恢复数据库：

*   恢复数据库
*   `(*) From Device:`
*   点击“ `...`”按钮
*   `Backup media: File`
*   点击“ `Add`”按钮
*   弹出窗口：“ `Locate Backup File`”

该窗口默认为`C:\Program Files\Microsoft SQL Server\MSSQL.1\Backup`

如何将 MS SQL Server Management Studio 配置为查看`D:\data\databases\`
而不是查看 `C:\Program Files\Microsoft SQL Server\MSSQL.1\Backup`？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-23T21:47:23.820

在注册表中，编辑`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL.1\MSSQLServer\BackupDirectory`指向的值`d:\data\databases`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T21:48:27.093

它存储在注册表中。

在我的电脑上，它在...

HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Microsoft SQL Server\MSSQL.1\MSSQLServer

有一个名为 BackupDirectory 的注册表项

我怀疑注册表项将位于您的不同位置（我有 64 位 vista）。我在注册表中搜索了“MSSQL.1\Backup”以找到它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T19:55:31.443

为方便起见，这里有一个 reg 文件条目来执行此操作：

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL.1\MSSQLServer]
"BackupDirectory"="D:\\data\\databases\\" 
```

# ruby - ruby 命令行开关 -rubygems & -r 不兼容吗？

> ID：124035
> 
> 赞同：6
> 
> 时间：2008-09-23T21:31:24.857
> 
> 标签：ruby, rubygems

我最近将一个 ruby​​ 库转换为 gem，这似乎破坏了命令行的可用性

作为图书馆工作得很好

```
 $ ruby -r foobar -e 'p FooBar.question' # => "answer" 
```

作为 gem，irb 知道如何从命令行开关中要求 gem

```
 $ irb -rubygems -r foobar
  irb(main):001:0> FooBar.question # => "answer" 
```

但红宝石本身同样失败：

```
 $ ruby -rubygems -r foobar -e 'p FooBar.question'
  ruby: no such file to load -- foobar (LoadError) 
```

我现在必须这样做，这看起来很难看：

```
 ruby -rubygems -e 'require "foobar"; p FooBar.question' # => "answer" 
```

或者有没有办法让两个开关工作？

*注意*：我知道 gem 可以为每个有用的方法添加一个 bin/program，但我不喜欢不必要地污染命令行命名空间

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T21:39:03.747

-rubygems 实际上与 -r ubygems 相同。

据我了解，它不会与您的搜索路径混淆，但我认为它也不会向您的 -r 搜索路径添加任何内容。我能够做这样的事情：

```
ruby -rubygems -r /usr/lib/ruby/gems/myhelpfulclass-0.0.1/lib/MyHelpfulClass -e "puts MyHelpfulClass" 
```

MyHelpfulClass.rb 存在于上面指定的 lib 目录中。

这很糟糕，但它至少表明你可以有多个 -r quire 指令。

作为一个稍微不那么难看的解决方法，您可以向 ruby​​ 库搜索路径添加其他项目（在 *nix 中以冒号分隔，在 Windows 中以分号分隔）。

```
export RUBYLIB=/usr/lib/ruby/gems/1.8/gems/myhelpfulclass-0.0.1/lib
ruby -rubygems -r MyHelpfulClass -e "puts MyHelpfulClass" 
```

如果不想弄乱环境变量，可以自己在加载路径中加点东西：

```
ruby -I /usr/lib/ruby/gems/1.8/gems/myhelpfulclass-0.0.1/lib \
   -rubygems -r MyHelpfulClass -e "puts MyHelpfulClass" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-04T19:48:28.763

注意：ruby 1.8 存在此问题，但在 ruby​​ 1.9 中已解决。

在 1.8 上，如果您通过 指定两个库`-r`，ruby 将尝试加载每个库而不注意`$LOAD_PATH`. 但是 ruby `$LOAD_PATH`​​gems 确实发生了变化，因此可以找到宝石。

它使用的原因`irb`是它`irb` *确实*关注`$LOAD_PATH`变化。

不幸的是，我发现最好的解决方法是使用更详细的形式：

```
ruby -rubygems -e 'require "foobar"; p FooBar.question' 
```

但是，如果您使用迭代器，疼痛不会随着库的数量线性增加：

```
ruby -rubygems -e '%w(rake rspec).each{|r| require r }' 
```

# .net - MEF 是 System.Addin 的替代品吗？

> ID：124040
> 
> 赞同：17
> 
> 时间：2008-09-23T21:32:06.557
> 
> 标签：.net, inversion-of-control, mef

> **可能重复：**
> [在 MEF 和 MAF (System.AddIn) 之间进行选择](https://stackoverflow.com/questions/835182/choosing-between-mef-and-maf-system-addin)

托管可扩展性框架是 System.Addin 的替代品吗？或者它们是互补的？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T14:32:42.810

简短的回答不，不是。System.Addin 允许您将加载项隔离到单独的应用程序域/进程中。它还提供版本控制功能。这些功能对于许多客户尤其是大型 ISV 而言至关重要。另一方面，MEF 被设计为可扩展性的简单编程模型。两者可以协同工作，相得益彰。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-23T21:36:49.617

它在 MSDN 论坛中被触及：

[与 AddIn 库的比较？](http://social.msdn.microsoft.com/forums/en-US/MEFramework/thread/cf6b7cbc-1123-4b32-9810-c235d9606b66)

还有 Krzysztof Cwalina 在他关于 MEF 发布的博客中写道：

[托管可扩展性框架](http://blogs.msdn.com/kcwalina/archive/2008/04/25/MEF.aspx)

**摘要**：他们并肩生活。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-25T11:41:04.307

..只有两个链接供进一步参考：

*   [SO问题：在MEF和MAF（System.AddIn）之间进行选择](https://stackoverflow.com/questions/835182/choosing-between-mef-and-maf-system-addin)
*   [Kent Boogaart 博客：MAF 和 MEF](http://kentb.blogspot.com/2009/02/maf-and-mef.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-25T08:26:19.460

顺便说一句，前段时间我开发了所谓的 IsolatingCatalog，它是用于提供部件隔离的 MEF 目录。您可以指示它，以便在单独的应用程序域/进程中创建您的部件。WCF 用于 IPC。[在这里](http://pwlodek.blogspot.com/2011/07/isolating-mef-components.html)查看。

# web-services - 你在你的网络服务中放了什么？

> ID：124055
> 
> 赞同：0
> 
> 时间：2008-09-23T21:35:21.243
> 
> 标签：web-services, architecture

我有一个网站（ASP.NET）和一些用于项目（用 C# 编写）的 winforms（.Net 2.0）。我将 web 服务 (IIS6) 用于在企业内部发送电子邮件之类的任务。

我认为 Web 服务很好，但我想**根据您的经验**，在 Web 服务中应该和不应该是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T21:51:29.630

好吧，听起来您的面向服务架构有限（至少，我认为您正在这样做），根据 Gartner 的说法，这意味着您很快就会变得富有。:)

我发现 SOA 对我的好处实际上归结为所涉及系统的异构性（听起来您的系统不符合条件，因为它都是 .NET），而 SOA 的负面影响主要是因为 XML 的冗长性质。诚然， SOA*不需要*XML，但它是当前的大多数，恕我直言。

但是如果你不关心带宽/解析惩罚，谁在乎呢？也许您不是每分钟处理 10,000 个服务电话。使用这种实现方式，您将遵循[DRY](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)，只是使用 WS 而不是 sub，并且您遵循本质上与多个系统兼容的标准。

还有更糟糕的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:56:27.247

在我看来：

Web 服务应该保留给那些

1.  您不能或不想分发；或者，
2.  需要认真扩展的代码。

一个示例是多个应用程序需要访问的自定义业务逻辑。

您不想放入 Web 服务的代码包括：

1.  基于性能的代码；
2.  仅适用于相关应用程序的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:22:52.893

Web 服务/SOA 的新趋势似乎是或多或少地公开一个您的主机应用程序可以使用的轻量级中间层。与通过服务（如您的示例中）公开的单个方法调用不同，面向 SOA 的应用程序具有广泛的数据/操作合同，充当“传统”中间层组件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T19:29:23.773

尽可能少，同时仍然有用。

默认情况下，不要将返回对象的每个字段都放在返回数据中，也不要暴露现有类的每个方法。

也读[这个](http://www.infoq.com/articles/API-Design-Joshua-Bloch)...

# asp.net - SQL Server 2005 与 ASP.net 日期时间格式混淆

> ID：124066
> 
> 赞同：0
> 
> 时间：2008-09-23T21:38:22.780
> 
> 标签：asp.net, sql-server-2005, datetime, culture

我发现了一个关于堆栈溢出的类似问题，但它并没有真正回答我的问题。我需要确保我的 asp.net 应用程序将日期 dd/mm/yyyy 格式化为与我的 SQL Server 2005 相同。

如何验证服务器的日期文化（如果是这样的话）是否与我对应用程序的编程方式相匹配？是否有特定的数据库设置和操作系统设置？它是特定于表的吗？我不想改变我的日子和月份。

谢谢你

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T21:49:12.630

当您从数据库中获取 DateTime 时，它​​应该采用非培养格式（如 DateTime 对象，基于自某个日期以来的滴答数）。只有当您将该值转换为字符串时，您才需要关注文化。在这些情况下，您可以使用 yourDateTimeValue.ToString("dd/MM/yyyy", CultureInfo.InvariantCulture) 来确保信息正确显示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:06:09.407

我相信如果您使用 SqlParameters，ADO.NET 会处理剩下的事情，您不必担心。此外，它对防御 SQL 注入攻击也有好处！:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T21:49:30.930

** 请注意，因为 SQL DateTime 列不可为空，其最小值为 1/1/1753，而 .net DateTimes 不可为空，最小值为 1/1/0001。**

如果您从真实的 DateTime 列中提取数据，默认情况下它将始终采用相同的标准格式。要将数据保存到列中，您可能需要在参数中指定 SqlDbType.DateTime。

[我从http://bytes.com/forum/thread767920.html](http://bytes.com/forum/thread767920.html)撕掉了这个：

com.Parameters.Add("@adate", SqlDbType.DateTime).Value = DateTime.Now;

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T22:02:51.317

好吧，如果您将日期时间字段保留在数据库中，则不必担心。

只要您将应用程序中的日期保持为强类型（DateTime 变量）并通过带有 DBParameter/SqlParameter 的准备好的语句发送日期，您的数据库就会按原样使用它们。

如果您在代码中使用字符串来保存日期，一些强制转换将确保您发送正确的值：

```
string sqlCmd = @"SELECT *
   FROM MyTable
   WHERE MyDateField = CONVERT(datetime, '{0}', 101)";

// assuming myDateString is a string with a date in the local format
sqlCmd = string.Format(sqlCmd,
    Convert.ToDateTime(myDateString).ToString("yyyyMMdd")); 
```

（代码很丑，但希望它能够理解）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-20T20:27:26.957

正如其他人所提到的，就文化上存储日期时间而言，您应该没问题。我建议您将所有时间存储为标准 UTC 时间。在 SQL Server 2005 及更早的版本中，无法存储时区信息，但如果所有内容都以通用时间存储，则应该没问题，因为稍后可以将时间转换为本地时间。

SQL Server 2008 确实有一些知道时区的数据类型，如果您使用的是 .NET 3.5，则有一些工具可以帮助处理/转换时区。

绝对以通用格式保存时间。如果您必须在多个时区工作，这将改变世界。

# php - php 字符串连接，性能

> ID：124067
> 
> 赞同：72
> 
> 时间：2008-09-23T21:38:46.837
> 
> 标签：php, string, concatenation

在 Java 和 C# 等语言中，字符串是不可变的，一次构建一个字符串的计算成本可能很高。在上述语言中，有一些库类可以降低这种成本，例如 C#`System.Text.StringBuilder`和 Java `java.lang.StringBuilder`。

php（4 或 5；我对两者都感兴趣）是否共享此限制？如果是这样，是否有类似的问题可用的解决方案？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-23T21:47:50.403

不，PHP 中没有 stringbuilder 类的类型，因为字符串是可变的。

话虽这么说，有不同的方式来构建一个字符串，这取决于你在做什么。

例如，echo 将接受逗号分隔的标记作为输出。

```
// This...
echo 'one', 'two';

// Is the same as this
echo 'one';
echo 'two'; 
```

这意味着您可以在不实际使用连接的情况下输出复杂的字符串，这会更慢

```
// This...
echo 'one', 'two';

// Is faster than this...
echo 'one' . 'two'; 
```

如果您需要在变量中捕获此输出，您可以使用[输出缓冲函数来](http://us3.php.net/outcontrol)实现。

此外，PHP 的数组性能非常好。如果你想做一个逗号分隔的值列表，只需使用 implode()

```
$values = array( 'one', 'two', 'three' );
$valueList = implode( ', ', $values ); 
```

最后，确保您熟悉[PHP 的字符串类型](http://us3.php.net/types.string)及其不同的分隔符，以及每个分隔符的含义。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2013-05-03T19:49:33.273

我对此很好奇，所以我进行了测试。我使用了以下代码：

```
<?php
ini_set('memory_limit', '1024M');
define ('CORE_PATH', '/Users/foo');
define ('DS', DIRECTORY_SEPARATOR);

$numtests = 1000000;

function test1($numtests)
{
    $CORE_PATH = '/Users/foo';
    $DS = DIRECTORY_SEPARATOR;
    $a = array();

    $startmem = memory_get_usage();
    $a_start = microtime(true);
    for ($i = 0; $i < $numtests; $i++) {
        $a[] = sprintf('%s%sDesktop%sjunk.php', $CORE_PATH, $DS, $DS);
    }
    $a_end = microtime(true);
    $a_mem = memory_get_usage();

    $timeused = $a_end - $a_start;
    $memused = $a_mem - $startmem;

    echo "TEST 1: sprintf()\n";
    echo "TIME: {$timeused}\nMEMORY: $memused\n\n\n";
}

function test2($numtests)
{
    $CORE_PATH = '/Users/shigh';
    $DS = DIRECTORY_SEPARATOR;
    $a = array();

    $startmem = memory_get_usage();
    $a_start = microtime(true);
    for ($i = 0; $i < $numtests; $i++) {
        $a[] = $CORE_PATH . $DS . 'Desktop' . $DS . 'junk.php';
    }
    $a_end = microtime(true);
    $a_mem = memory_get_usage();

    $timeused = $a_end - $a_start;
    $memused = $a_mem - $startmem;

    echo "TEST 2: Concatenation\n";
    echo "TIME: {$timeused}\nMEMORY: $memused\n\n\n";
}

function test3($numtests)
{
    $CORE_PATH = '/Users/shigh';
    $DS = DIRECTORY_SEPARATOR;
    $a = array();

    $startmem = memory_get_usage();
    $a_start = microtime(true);
    for ($i = 0; $i < $numtests; $i++) {
        ob_start();
        echo $CORE_PATH,$DS,'Desktop',$DS,'junk.php';
        $aa = ob_get_contents();
        ob_end_clean();
        $a[] = $aa;
    }
    $a_end = microtime(true);
    $a_mem = memory_get_usage();

    $timeused = $a_end - $a_start;
    $memused = $a_mem - $startmem;

    echo "TEST 3: Buffering Method\n";
    echo "TIME: {$timeused}\nMEMORY: $memused\n\n\n";
}

function test4($numtests)
{
    $CORE_PATH = '/Users/shigh';
    $DS = DIRECTORY_SEPARATOR;
    $a = array();

    $startmem = memory_get_usage();
    $a_start = microtime(true);
    for ($i = 0; $i < $numtests; $i++) {
        $a[] = "{$CORE_PATH}{$DS}Desktop{$DS}junk.php";
    }
    $a_end = microtime(true);
    $a_mem = memory_get_usage();

    $timeused = $a_end - $a_start;
    $memused = $a_mem - $startmem;

    echo "TEST 4: Braced in-line variables\n";
    echo "TIME: {$timeused}\nMEMORY: $memused\n\n\n";
}

function test5($numtests)
{
    $a = array();

    $startmem = memory_get_usage();
    $a_start = microtime(true);
    for ($i = 0; $i < $numtests; $i++) {
        $CORE_PATH = CORE_PATH;
        $DS = DIRECTORY_SEPARATOR;
        $a[] = "{$CORE_PATH}{$DS}Desktop{$DS}junk.php";
    }
    $a_end = microtime(true);
    $a_mem = memory_get_usage();

    $timeused = $a_end - $a_start;
    $memused = $a_mem - $startmem;

    echo "TEST 5: Braced inline variables with loop-level assignments\n";
    echo "TIME: {$timeused}\nMEMORY: $memused\n\n\n";
}

test1($numtests);
test2($numtests);
test3($numtests);
test4($numtests);
test5($numtests); 
```

...并得到以下结果。附图片。显然， sprintf 是效率最低的方法，无论是在时间还是内存消耗方面。编辑：在另一个选项卡中查看图像，除非你有鹰眼。 ![在此处输入图像描述](https://i.stack.imgur.com/QUQwR.jpg)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-04-19T20:17:16.230

在 PHP 中不需要 StringBuilder 类比。

我做了几个简单的测试：

在 PHP 中：

```
$iterations = 10000;
$stringToAppend = 'TESTSTR';
$timer = new Timer(); // based on microtime()
$s = '';
for($i = 0; $i < $iterations; $i++)
{
    $s .= ($i . $stringToAppend);
}
$timer->VarDumpCurrentTimerValue();

$timer->Restart();

// Used purlogic's implementation.
// I tried other implementations, but they are not faster
$sb = new StringBuilder(); 

for($i = 0; $i < $iterations; $i++)
{
    $sb->append($i);
    $sb->append($stringToAppend);
}
$ss = $sb->toString();
$timer->VarDumpCurrentTimerValue(); 
```

在 C# (.NET 4.0) 中：

```
const int iterations = 10000;
const string stringToAppend = "TESTSTR";
string s = "";
var timer = new Timer(); // based on StopWatch

for(int i = 0; i < iterations; i++)
{
    s += (i + stringToAppend);
}

timer.ShowCurrentTimerValue();

timer.Restart();

var sb = new StringBuilder();

for(int i = 0; i < iterations; i++)
{
    sb.Append(i);
    sb.Append(stringToAppend);
}

string ss = sb.ToString();

timer.ShowCurrentTimerValue(); 
```

**结果：**

10000 次迭代：
1) PHP，普通连接：~6ms
2) PHP，使用 StringBuilder：~5 ms
3) C#，普通连接：~520ms
4) C#，使用 StringBuilder：~1ms

100000 次迭代：
1) PHP，普通连接：~63ms
2) PHP，使用 StringBuilder：~555ms
3) C#，普通连接：~91000ms // !!!
4) C#，使用 StringBuilder：~17ms

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-23T23:08:42.283

当您进行定时比较时，差异是如此之小以至于它不是很相关。选择使您的代码更易于阅读和理解的选择会带来更多收益。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-08-17T02:32:14.443

我知道你在说什么。我刚刚创建了这个简单的类来模拟 Java StringBuilder 类。

```
class StringBuilder {

  private $str = array();

  public function __construct() { }

  public function append($str) {
    $this->str[] = $str;
  }

  public function toString() {
    return implode($this->str);
  }

} 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-23T21:48:52.023

PHP 字符串是可变的。您可以像这样更改特定字符：

```
$string = 'abc';
$string[2] = 'a'; // $string equals 'aba'
$string[3] = 'd'; // $string equals 'abad'
$string[5] = 'e'; // $string equals 'abad e' (fills character(s) in between with spaces) 
```

您可以将字符附加到这样的字符串：

```
$string .= 'a'; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-09-27T10:29:12.867

我在本文末尾编写了代码来测试不同形式的字符串连接，它们在内存和时间足迹上几乎完全相同。

我使用的两种主要方法是将字符串相互连接，然后用字符串填充数组，然后将它们内爆。我在 php 5.6 中使用 1MB 字符串添加了 500 个字符串（所以结果是 500MB 字符串）。在测试的每次迭代中，所有内存和时间足迹都非常接近（大约 $IterationNumber*1MB）。两个测试的运行时间分别为 50.398 秒和 50.843 秒，这很可能在可接受的误差范围内。

不再引用的字符串的垃圾收集似乎非常直接，即使没有离开范围。由于字符串是可变的，因此实际上不需要额外的内存。

**但是**，以下测试表明，在连接字符串时，峰值内存使用量有所*不同*。

```
$OneMB=str_repeat('x', 1024*1024);
$Final=$OneMB.$OneMB.$OneMB.$OneMB.$OneMB;
print memory_get_peak_usage(); 
```

结果 = 10,806,800 字节（~10MB 没有初始 PHP 内存占用）

```
$OneMB=str_repeat('x', 1024*1024);
$Final=implode('', Array($OneMB, $OneMB, $OneMB, $OneMB, $OneMB));
print memory_get_peak_usage(); 
```

结果 = 6,613,320 字节（~6MB 没有初始 PHP 内存占用）

因此，实际上在内存方面非常大的字符串连接中可能存在显着差异（我在创建非常大的数据集或 SQL 查询时遇到过这样的示例）。

但根据数据，即使这个事实也是有争议的。例如，将 1 个字符连接到一个字符串以获得 5000 万字节（即 5000 万次迭代）在 5.97 秒内最多需要 50,322,512 字节（~48MB）。在执行数组方法时，最终使用 7,337,107,176 字节（~6.8GB）在 12.1 秒内创建了数组，然后又花费了 4.32 秒来组合数组中的字符串。

Anywho...下面是我在开头提到的基准代码，它显示方法几乎相同。它输出一个漂亮的 HTML 表格。

```
<?
//Please note, for the recursion test to go beyond 256, xdebug.max_nesting_level needs to be raised. You also may need to update your memory_limit depending on the number of iterations

//Output the start memory
print 'Start: '.memory_get_usage()."B<br><br>Below test results are in MB<br>";

//Our 1MB string
global $OneMB, $NumIterations;
$OneMB=str_repeat('x', 1024*1024);
$NumIterations=500;

//Run the tests
$ConcatTest=RunTest('ConcatTest');
$ImplodeTest=RunTest('ImplodeTest');
$RecurseTest=RunTest('RecurseTest');

//Output the results in a table
OutputResults(
  Array('ConcatTest', 'ImplodeTest', 'RecurseTest'),
  Array($ConcatTest, $ImplodeTest, $RecurseTest)
);

//Start a test run by initializing the array that will hold the results and manipulating those results after the test is complete
function RunTest($TestName)
{
  $CurrentTestNums=Array();
  $TestStartMem=memory_get_usage();
  $StartTime=microtime(true);
  RunTestReal($TestName, $CurrentTestNums, $StrLen);
  $CurrentTestNums[]=memory_get_usage();

  //Subtract $TestStartMem from all other numbers
  foreach($CurrentTestNums as &$Num)
    $Num-=$TestStartMem;
  unset($Num);

  $CurrentTestNums[]=$StrLen;
  $CurrentTestNums[]=microtime(true)-$StartTime;

  return $CurrentTestNums;
}

//Initialize the test and store the memory allocated at the end of the test, with the result
function RunTestReal($TestName, &$CurrentTestNums, &$StrLen)
{
  $R=$TestName($CurrentTestNums);
  $CurrentTestNums[]=memory_get_usage();
  $StrLen=strlen($R);
}

//Concatenate 1MB string over and over onto a single string
function ConcatTest(&$CurrentTestNums)
{
  global $OneMB, $NumIterations;
  $Result='';
  for($i=0;$i<$NumIterations;$i++)
  {
    $Result.=$OneMB;
    $CurrentTestNums[]=memory_get_usage();
  }
  return $Result;
}

//Create an array of 1MB strings and then join w/ an implode
function ImplodeTest(&$CurrentTestNums)
{
  global $OneMB, $NumIterations;
  $Result=Array();
  for($i=0;$i<$NumIterations;$i++)
  {
    $Result[]=$OneMB;
    $CurrentTestNums[]=memory_get_usage();
  }
  return implode('', $Result);
}

//Recursively add strings onto each other
function RecurseTest(&$CurrentTestNums, $TestNum=0)
{
  Global $OneMB, $NumIterations;
  if($TestNum==$NumIterations)
    return '';

  $NewStr=RecurseTest($CurrentTestNums, $TestNum+1).$OneMB;
  $CurrentTestNums[]=memory_get_usage();
  return $NewStr;
}

//Output the results in a table
function OutputResults($TestNames, $TestResults)
{
  global $NumIterations;
  print '<table border=1 cellspacing=0 cellpadding=2><tr><th>Test Name</th><th>'.implode('</th><th>', $TestNames).'</th></tr>';
  $FinalNames=Array('Final Result', 'Clean');
  for($i=0;$i<$NumIterations+2;$i++)
  {
    $TestName=($i<$NumIterations ? $i : $FinalNames[$i-$NumIterations]);
    print "<tr><th>$TestName</th>";
    foreach($TestResults as $TR)
      printf('<td>%07.4f</td>', $TR[$i]/1024/1024);
    print '</tr>';
  }

  //Other result numbers
  print '<tr><th>Final String Size</th>';
  foreach($TestResults as $TR)
    printf('<td>%d</td>', $TR[$NumIterations+2]);
  print '</tr><tr><th>Runtime</th>';
    foreach($TestResults as $TR)
      printf('<td>%s</td>', $TR[$NumIterations+3]);
  print '</tr></table>';
}
?> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-23T21:43:03.457

是的。他们是这样。例如，如果您想同时回显几个字符串，请使用

```
回声 str1,str2,str3
```

代替

```
回声 str1.str2.str3
```

让它更快一点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T22:03:39.803

首先，如果您不需要连接字符串，请不要这样做：这样做总是会更快

```
echo $a,$b,$c; 
```

比

```
echo $a . $b . $c; 
```

但是，至少在 PHP5 中，字符串连接确实非常快，尤其是在给定字符串只有一个引用的情况下。我猜解释器在`StringBuilder`内部使用了类似的技术。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-10-02T22:58:21.230

我刚遇到这个问题：

$str .= '字符串连接。';

对比

$str = $str 。'字符串连接。';

到目前为止，似乎没有人对此进行过比较。50.000 次迭代和 php 7.4 的结果非常疯狂：

字符串 1：0.0013918876647949

字符串 2：1.1183910369873

因素：803 !!!

```
$currentTime = microtime(true);
$str = '';
for ($i = 50000; $i > 0; $i--) {
    $str .= 'String concatenation. ';
}
$currentTime2 = microtime(true);
echo "String 1: " . ( $currentTime2 - $currentTime);

$str = '';
for ($i = 50000; $i > 0; $i--) {
    $str = $str . 'String concatenation. ';
}
$currentTime3 = microtime(true);
echo "<br>String 2: " . ($currentTime3 - $currentTime2);

echo "<br><br>Faktor: " . (($currentTime3 - $currentTime2) / ( $currentTime2 - $currentTime)); 
```

有人可以证实这一点吗？我遇到了这个问题，因为我通过读取并仅将想要的行再次附加到字符串中来从大文件中删除一些行。

使用 .= 在这里解决了我所有的问题。在我超时之前！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T22:20:05.020

如果您在 PHP 字符串中放置变量值，我知道使用内联变量包含会稍微快一些（这不是它的正式名称 - 我不记得是什么了）

```
$aString = 'oranges';
$compareString = "comparing apples to {$aString}!";
echo $compareString
   comparing apples to oranges! 
```

必须在双引号内才能工作。也适用于数组成员（即

```
echo "You requested page id {$_POST['id']}"; 
```

)

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2008-09-23T21:42:55.080

在 php 中没有这样的限制，php 可以将 strng 与 dot(.) 运算符连接起来

```
$a="hello ";
$b="world";
echo $a.$b; 
```

输出“你好世界”

# networking - 网络主机名中的这些缩写是什么意思？

> ID：124076
> 
> 赞同：2
> 
> 时间：2008-09-23T21:40:18.283
> 
> 标签：networking, hostname, traceroute

当我使用traceroute时，我经常在路由的主机名中看到缩写，例如“ge”、“so”、“ic”、“gw”、“bb”等。我猜“bb”是骨干网的意思。

有谁知道这些字符串的缩写，或者知道任何其他常见的缩写？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T21:44:49.100

这些是转换为小写的 ISO-3166-1 Alpha2 地理域 ID。

*   ge - 格鲁吉亚
*   gw - 几内亚比索
*   所以 - 索马里
*   bb - 巴巴多斯
*   ic - 冰岛的旧代码？

只需查找 ISO-3166 以获取国家/地区代码的完整列表。以及用于地理域列表的 RFC 1700。

您能否提供您的其中一个跟踪路由的输出？

使用 bb 表示主干，gw 表示网关的主机名倾向于将它们放在主机名的开头，例如 bb1.toto.com.au 或 gw2.wtf.co.uk。

当您从左到右遍历时，这遵循名称中更具体到不太具体的元素的命名约定。

地理域几乎总是位于主机名的末尾。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:05:01.203

您提供的示例使我认为这与国家/地区代码无关。

我想这正是您的想法：ISP 网络管理员在命名他们的服务器时使用了快捷方式。

*   bb = 骨干
*   gw = 网关
*   ic = 互连？
*   格 = ?
*   所以=堆栈溢出？:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T22:38:17.847

它们不太可能是国家代码。当您负责大型网络时，您会提出对您有意义的命名方案，混合地理和功能符号，但不会太冗长，因为打字太浪费。

例如，gw 始终代表网关。ge 通常表示“外部网关”，即“友好”网络的边界网关。ix 代表互换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T22:09:40.163

除非它们是顶级域名（例如“foo.bb”而不是“bb.example.net”），否则它们是由拥有该域名的组织选择的，记住如果你拥有一个域名，你就拥有所有子域。在这种情况下，您可以随意调用它。没有规范，人们称之为许多不同的东西。

有许多 2 级顶级域，每个国家/地区一个。例如，.fr 代表法国。更多信息：[http ://en.wikipedia.org/wiki/CcTLD](http://en.wikipedia.org/wiki/CcTLD)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T21:55:09.137

简洁版本; 国家代码

可能不完全正确，但是...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:58:54.603

国家代码的完整列表位于 http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm 其他顶级域 (TLD) 位于：http://www.icann.org/en/registries /listing.html

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-06T16:49:28.710

实际上，“ge”很可能代表“千兆以太网”，路由器上的端口以接口名称命名是很常见的。

因此，路由器上的第一个 Gig-E 端口通常会有一个包含“ge0”或类似名称的主机名。

您还会看到：

*   “fa”表示“快速以太网”（在 Cisco 路由器上）
*   “s0”代表“串行”（即 E1 或 T1 端口）
*   “lo0”代表“环回”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-11T00:00:56.130

`so = sonet, pos = packet over sonet xe= ten gigabit ge= gigabit`

# ruby - 如何快速切分大数据文件？

> ID：124079
> 
> 赞同：5
> 
> 时间：2008-09-23T21:41:20.933
> 
> 标签：ruby, data-files

我想以相当快速和有效的方式对大型数据文件进行切片和切块，直至演出。如果我使用 UNIX 的“CUT”之类的东西，它会非常快，即使在 CYGWIN 环境中也是如此。

我已经尝试开发各种 Ruby 脚本并对其进行基准测试来处理这些文件，并且总是以冰冷的结果结束。

你会在 Ruby 中做什么来让这条狗不那么慢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T21:43:14.627

这个问题让我想起了 Tim Bray 的[Wide Finder 项目](http://www.tbray.org/ongoing/When/200x/2007/09/20/Wide-Finder)。他可以使用 Ruby 读取 Apache 日志文件并找出哪些文章被获取最多的最快方法是使用以下脚本：

```
counts = {}
counts.default = 0

ARGF.each_line do |line|
   if line =~ %r{GET /ongoing/When/\d\d\dx/(\d\d\d\d/\d\d/\d\d/[^ .]+) }
     counts[$1] += 1
   end
end

keys_by_count = counts.keys.sort { |a, b| counts[b] <=> counts[a] }
keys_by_count[0 .. 9].each do |key|
    puts "#{counts[key]}: #{key}"
end 
```

> 在去年的 1.67Ghz PowerBook 上，这段代码花费了 7.5 秒的 CPU 时间，13.5 秒的时间，处理了一百万个并更改了大约四分之一 g 的记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:50:01.630

我猜您的 Ruby 实现在处理之前正在读取整个文件。Unix 的剪切通过一次读取一个字节并*立即*转储到输出文件来工作。当然会涉及一些缓冲，但不会超过几 KB。

我的建议：尝试使用尽可能少的分页或回溯进行就地处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T22:20:42.540

为什么不将它们结合在一起 - 使用 cut 来做它最擅长的事情并使用 ruby​​ 来提供胶水/增值以及 CUT 的结果？您可以通过将它们放在反引号中来运行 shell 脚本，如下所示：

```
puts `cut somefile > foo.fil`
# process each line of the output from cut
f = File.new("foo.fil")
f.each{|line|
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T21:56:20.163

我怀疑问题是红宝石正在读取内存中的整个文件。运行命令时查看内存和磁盘使用情况进行验证。

我猜主要原因是因为 cut 是用 C 编写的并且只做一件事，所以它可能已经被编译成非常金属。它可能并没有比调用系统调用做更多的事情。

然而，ruby 版本可以同时做很多事情。在 ruby​​ 中调用方法比 C 函数调用慢得多。

记住老年和背叛在 unix 中击败了青年和技能：[http ://ridiculousfish.com/blog/archives/2006/05/30/old-age-and-treachery/](http://ridiculousfish.com/blog/archives/2006/05/30/old-age-and-treachery/)

# c# - 在 WinForms 中实现干净的 UI 功能同时保持体面的解耦架构的最佳方法是什么？

> ID：124096
> 
> 赞同：5
> 
> 时间：2008-09-23T21:45:55.603
> 
> 标签：c#, .net, winforms

我倾向于使用相当自我记录的 void doSomething() 方法来实现 UI 功能，即如果用户按下此按钮然后执行此操作，然后启用此列表框、禁用该按钮等。这是最好的方法吗？是否有更好的通用 UI 管理模式，即如何控制控件何时启用/禁用/等。等取决于用户输入？

通常我觉得我正在转向“无所不能的大类”反模式，因为似乎与“主要”表单类交互。通常，即使我在使用相对模块化的设计实现的类中包含私有状态变量，我仍然发现它增长得如此之快，这太荒谬了。

那么人们能否给我一些好的建议，让我在不落入这些陷阱的情况下制作高质量、可测试、解耦的 WinForms 设计？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T21:51:00.690

如果您想将 UI 的逻辑放在单独的类中，您可以尝试[MVP ..](http://danbunea.blogspot.com/2005/11/model-view-presenter-is-testing_27.html)

正如 Martin Fowler 或 Michael Feathers 所说，在模型视图演示器中，UI 的逻辑被分离到一个称为演示器的类中，它处理来自用户的所有输入，并告诉“哑”视图显示什么以及何时显示。该模式的特殊可测试性来自于这样一个事实，即整个视图可以用一个模拟对象替换，这样最重要的部分 Presenter 可以很容易地单独进行单元测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T21:51:08.583

使用 MVP 模式对 winforms 来说非常好。

看看[http://www.objectmentor.com/resources/articles/TheHumbleDialogBox.pdf](http://www.objectmentor.com/resources/articles/TheHumbleDialogBox.pdf)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T21:49:07.777

我只会将 UI 逻辑放在 Form 类中，并将任何应用程序逻辑放在它自己的类中：

```
class Form1 : Form
 {  
    void Button1_Click
     { 
       Program.DoCommand1();
     }
 }

static class Program
{
  internal static void DoCommand1() {/* ... */}
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T21:52:23.060

我最近一直在做的一件事是利用 .NET 的部分类特性来处理一些较大的类型表单。如果我有一个带有 5 个不同选项卡的选项卡控件。我将创建部分类并将文件命名为 CardImportMethods.cs、ManageLookupTables.cs 等，同时将其全部保留为 CentralizedForm 类的一部分。

即使只有 UI 逻辑，在管理这些事情时，这种分解也会有所帮助。

# python - 在同一项目中的应用程序之间传递 url

> ID：124108
> 
> 赞同：1
> 
> 时间：2008-09-23T21:47:35.567
> 
> 标签：python, django, web-services, development-environment

我正在尝试模拟一个 API，并在 Django 中使用单独的应用程序来表示不同的 Web 服务。我希望 App A 接收与 App B 对应的链接并解析`json`响应。

有没有办法动态地构造 App B 的 url，这样我就可以在开发中测试代码，并且在投入生产之前不会改变太多？问题是我不能使用 localhost 作为链接的一部分。

我目前正在使用 urllib，但最终我想做一些不那么 hacky 并且更适合 Web 服务`REST`范例的事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T21:51:15.323

你可以做类似的事情

```
if settings.DEBUG:
  other = "localhost"
else:
  other = "somehost" 
```

并使用 other 来构建外部 URL。通常，您在 DEBUG 模式下编码并在非 DEBUG 模式下部署。settings.DEBUG 是一个“标准”的 Django 东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T22:52:54.130

“Django 中的单独应用程序”是指具有通用设置的单独应用程序吗？也就是说，同一个 Django 站点（或项目）内的两个应用程序？

如果是这样，{% url %} 标签将为设置文件中列出的任何应用程序生成正确的绝对 URL。

如果有单独的 Django 服务器具有单独的设置，那么您就会遇到 URI 设计的标准 Internet 问题。您的 URI 只能与更改的主机名保持一致。

```
- http://localhost/some/path - development

- http://123.45.67.78/some/path - someone's laptop who's running a server for testing

- http://qa.mysite.com/some/path - QA

- http://www.mysite.com/some/path - production 
```

您永远不需要提供主机信息，因此您的所有链接都是`<A HREF="/some/path/">`.

一般来说，这种方法效果最好。您可以将某人的随机笔记本电脑用作测试服务器；您可以使用 ifconfig 获取 IP 地址。

# c# - 当您已经相当了解 C# 时，是否值得学习 Java？

> ID：124115
> 
> 赞同：7
> 
> 时间：2008-09-23T21:48:46.967
> 
> 标签：c#, java

由于 C# 在很多方面都是 Java 的直接衍生品，我想知道在对 C# 进行了相当合理的了解之后，学习 Java 是否有任何优势？

**注意：**请提供清晰、直接的建议而不是讨论，以符合 SO 指南。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T21:52:36.880

如果您想使用 Java 编程，请学习 Java。真的就是这么简单。

模式、算法和设计理念不会有太大的不同，以至于自学一门语言就足够了。

然而，Java 在比 C# 更多的平台上运行得很好（尽管 mono 正在发生变化），所以如果你想涉足与平台无关的代码，你可以试试 Java。你会注意到它的边缘有点粗糙，但不像去 C++ 或 C。

-亚当

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T23:48:59.660

两者之间的语法差异并不大，尽管您会得到很多 .NET 特定代码，例如在 Java 中找不到的 [] 标记。但我确实发现 API 和开发方法完全不同。每个后端都非常不同，在 .NET 中，一些高效且运行良好的代码可能不适合 Java，反之亦然。

我在这两个方面都工作过，如果你在 Java 中工作，你将不得不习惯的限制是在 IDE 中。在开发速度和易于部署方面，没有任何 IDE 可以与 Visual Studio 相提并论。（无论如何，海事组织）。

我从几个 Java 项目中得到了很多。你会学到很多不同的编程技术和方法。具体来说，我建议在 J2EE 中工作，不同之处肯定会让您感觉使用不同的语言和技术。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T01:10:26.797

我将给出与其他人不同的答案。如果您正在为 Windows 平台编写应用程序，我看不到任何好处。我说这是您的“工作”的原因取决于了解该平台。我只能假设您的工作取决于它，否则，您为什么要投入其中（希望这是有道理的）。

我的建议是不要停止学习，而是学习其他东西，这会给你一个完全不同的观点。具体来说，我建议学习一些动态或功能性的东西。例如可能是 F#，或者试试 Ruby 或 Python。我认为这是对时间的更好投资。

我的 .02 美元。

-基思

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T21:54:18.217

我主要是一个 Java 人，但在这里和那里做了一点 C#。IMO 两者之间没有足够的区别来真正从拓宽您的编程视野中获得很多好处。通常，当我想学习一门新语言时，我想找到一些能够迫使我从不同的角度看待程序的东西。Java 的视角与 C# 基本相同。一些高级语言功能的工作方式存在一些差异，并且 API 在某些地方有所不同，但总体而言，Java 和 C# 都是内存管理的、静态类型的 OO 语言。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-21T11:59:52.130

作为一个新人[对 C# 和 JAVA 了解不多]，我会建议你这样做。

如果您正在寻找工作：

投资于学习 C# 和 Java 的差异。这是因为，它会增加你的价值，减少你找工作的时间。

如果您需要一个项目 [用 Java 完成]：

那么，显然你必须学习正确！

如果您正在寻找更新的技术：

不要在 Java 上浪费时间，选择 Python、Ruby 或 Erlang。这是因为，C# 和 java 的 80% 是相同的，而您将只学习剩余的 20%（最多），我觉得这是浪费时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T00:54:38.223

这里有两个考虑。

如果您想学习以便在 Java 环境中工作，那么学习 Java 显然是朝着这个方向迈出的一步。在某些方面应该是相当直截了当的，因为 C# 和 Java 之间的实质性差异相对较小。根据您使用的具体技术，您使用的支持堆栈可能存在一些实现差异，但在原始语言术语中几乎没有差异。

但是，如果您想学习 Java 以进一步发展您的个人发展，那么我会说您最好花时间学习一些可以让您更加舒展的东西。像 Python、Ruby 或 Erlang 这样的语言将真正扩展你作为程序员的视野。这些中的每一个都需要与您在 Java 或 C# 中发现的略有不同的思维方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T21:51:03.467

绝对地。很多工作都特别想要java。学习了 Java 并能够令人信服地把它写在你的简历上意味着你不必与没有太多线索的 HR 和招聘人员争吵。

而且由于除了少数地方之外两者都或多或少相同，因此它的投资回报率非常好。更不用说它开辟了使用其他框架的可能性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:59:31.777

C# 和 Java 之间的相似之处使您可以更快地了解 Java。原则是一样的，你在找工作或做你自己的项目时通过选择更适合项目的平台获得竞争优势（基于项目的商业方面，以及可扩展性问题，因为你可以根据需要在 Linux 服务器上扩展 Java，而无需额外的许可费用）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T22:01:53.347

我非常了解 Java，并且必须为工作项目学习 C#。这很轻松，在这个过程中我学到了很多关于*两种*语言的知识。

Java 还将提供整个“一次编写，到处运行”的功能，并为进行基于 unix/linux 服务器的集成项目开辟了道路。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T00:21:51.140

这个问题的答案更多地取决于您自己的个人情况，而不是语言之间的相似之处。如果您有时间学习 Java，那很好，但是您可以利用这段时间做一些更有价值的事情吗？

如果您专注于走微软路线，那么以花时间深入了解 C# 或学习可以让您更有价值的微软产品为代价来学习 Java 并不是一件好事，例如.NET 3.5 框架中的新项目。

在 .NET 世界中学习的内容绰绰有余，无需学习与大多数企业环境中的使用无关的语言。

成为通才可以让您对发展有更广阔的视野，但成为专家可以更直接地赚钱。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-08-13T06:03:49.180

我相信学习任何语言，无论是 Java 还是 c# 都应该是最全面和最好的，因为会有数百人知道 50% 和 60%，如果你知道 50 或 60，你将无法有所作为% 也只需剩下的 40% 或 50%。这将使您在其他人中脱颖而出。而是任何一种语言都是 100%

# c# - .NET + 复制大量内存技巧

> ID：124117
> 
> 赞同：4
> 
> 时间：2008-09-23T21:48:56.610
> 
> 标签：c#, .net, memory-management

早在过去，就曾使用过一些技巧（通常用于块外帧缓冲区），将大块内存从一个位置复制到另一个位置。

现在我正在使用 C# 工作，我发现需要每秒大约 60 次将字节数组（大小约为 32k）从一个内存位置移动到另一个内存位置。

不知何故，我不认为 for 循环中的逐字节复制在这里是最佳的。

有谁知道在仍然停留在纯托管代码中的同时做这种工作的好技巧？

如果没有，我愿意做一些 P/Invoking 或进入不安全模式，但如果可以的话，出于跨平台的原因，我想保持管理。

编辑：我写的一些基准代码只是为了好玩：

> 逐字节：15.6192
> 
> 每个循环 4 字节：15.6192
> 
> 块复制：0

```
Byte[] src = new byte[65535];
            Byte[] dest = new byte[65535];
            DateTime startTime, endTime;

            startTime = DateTime.Now;
            for (int k = 0; k < 60; k++)
            {
                for (int i = 0; i < src.Length; i++)
                {
                    dest[i] = src[i];
                }
            }
            endTime = DateTime.Now;

            Console.WriteLine("Byte by Byte: " + endTime.Subtract(startTime).TotalMilliseconds);

            startTime = DateTime.Now;
            for (int k = 0; k < 60; k++)
            {
                int i = 0;
                while (i < src.Length)
                {
                    if (i + 4 > src.Length)
                    {
                        // Copy the remaining bytes one at a time.
                        while(i < src.Length)
                        {
                            dest[i] = src[i];
                            i++;
                        }
                        break;
                    }

                    dest[i] = src[i];
                    dest[i + 1] = src[i + 1];
                    dest[i + 2] = src[i + 2];
                    dest[i + 3] = src[i + 3];

                    i += 4;                    
                }
            }
            endTime = DateTime.Now;

            Console.WriteLine("4 Bytes per loop: " + endTime.Subtract(startTime).TotalMilliseconds);

            startTime = DateTime.Now;
            for (int k = 0; k < 60; k++)
            {
                Buffer.BlockCopy(src, 0, dest,0, src.Length);
            }
            endTime = DateTime.Now;

            Console.WriteLine("Block Copy: " + endTime.Subtract(startTime).TotalMilliseconds); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T21:52:31.997

我认为你可以指望 Buffer.BlockCopy() 做正确的事

[http://msdn.microsoft.com/en-us/library/system.buffer.blockcopy.aspx](http://msdn.microsoft.com/en-us/library/system.buffer.blockcopy.aspx)

# asp.net - Enterprise Server 上的 IIS 6.0 - 内存限制

> ID：124118
> 
> 赞同：1
> 
> 时间：2008-09-23T21:48:59.167
> 
> 标签：asp.net, windows, iis-6

我们希望将 Web 服务器从 Windows 2003 切换到 Windows 2003 Enterprise（64 位）以使用 8GB 的​​ RAM。IIS 6.0 和 ASPNET 1.1 应用程序是否能够从更改中受益？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T14:16:28.330

由于 ASP.Net 1.1 不支持 x64，因此您只能使用 32 位工作进程运行 IIS 6。/3GB 开关在 x64 上没有任何作用，但 x64 本身为 32 位进程提供了 4 GB 而不是 2GB，因此您将为工作进程提供更多内存。

您需要将 AppPools 设置为 32 位：

```
cscript %SystemDrive%\inetpub\AdminScripts\adsutil.vbs set w3svc/AppPools/Enable32bitAppOnWin64 1 
```

您可以考虑将 ASP.net 内存从应用程序的 60% 调整到 80%，我们已经取得了一些成功。

```
<system.web> 
  <processModel memoryLimit="80" />
</system.web> 
```

当您达到 1.2GB 到 1.6GB 的范围时，这会给应用程序池带来压力。

其他需要考虑的事情是，大多数 ASP.Net 1.1 应用程序在 2.0 应用程序池中运行时都没有问题，允许您轻松地将 1.1 32 位应用程序转换为 2.0 64 位应用程序。这不需要任何重新编译，只需将应用程序池更改为 2.0，然后使用上述 ADSUTIL.VBS 脚本（设置为 0 而不是 1）切换到 x64。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T22:33:41.867

我的理解是，在 ASP.NET 1.1 中存在 3 GB 的虚拟地址空间限制，并且它从未与 64 位兼容，尽管 2.0 是。

您可以让 IIS 6.0 在 64 位操作系统上运行 32 位（即 ASP.NET 1.1），但它将处于 32 位模式（以及托管的任何其他内容，包括 ASP.NET 2.0 站点）。

[微软关于在 32 位和 64 位之间切换的文章](http://support.microsoft.com/?id=894435)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:37:22.747

内存限制为 2GB，除非您在进程上使用 /3GB 开关，这将为进程本身使用 1GB 的内核空间。使用 IIS 超过 3GB 的唯一方法是运行 64 位版本。

# c# - 如何使用 VSTO 2005 SE 使用 C# Excel 加载项创建 Excel 2003 UDF

> ID：124121
> 
> 赞同：1
> 
> 时间：2008-09-23T21:49:13.143
> 
> 标签：c#, excel, vsto, add-in, user-defined-functions

我看到一篇关于使用 VBA 在 VSTO 托管代码中创建 Excel UDF 的文章：http: [//blogs.msdn.com/pstubbs/archive/2004/12/31/344964.aspx](http://blogs.msdn.com/pstubbs/archive/2004/12/31/344964.aspx)。

但是，我想在使用 VSTO 2005 SE 的 C# Excel 插件中使用它，有人可以帮忙吗？

我尝试了 Romain 指出的技术，但是在尝试加载 Excel 时出现以下异常：

> 无法找到或无法加载自定义程序集。您仍然可以编辑和保存文档......

细节：

```
Type mismatch. (Exception from HRESULT: 0x80020005 (DISP_E_TYPEMISMATCH))

************** Exception Text **************
System.Runtime.InteropServices.COMException (0x80020005): Type mismatch. (Exception from HRESULT: 0x80020005 (DISP_E_TYPEMISMATCH))
at Microsoft.Office.Interop.Excel._Application.Run(Object Macro, Object Arg1, Object Arg2, Object Arg3, Object Arg4, Object Arg5, Object Arg6, Object Arg7, Object Arg8, Object Arg9, Object Arg10, Object Arg11, Object Arg12, Object Arg13, Object Arg14, Object Arg15, Object Arg16, Object Arg17, Object Arg18, Object Arg19, Object Arg20, Object Arg21, Object Arg22, Object Arg23, Object Arg24, Object Arg25, Object Arg26, Object Arg27, Object Arg28, Object Arg29, Object Arg30)
at ExcelWorkbook4.ThisWorkbook.ThisWorkbook_Startup(Object sender, EventArgs e) in C:\projects\ExcelWorkbook4\ExcelWorkbook4\ThisWorkbook.cs:line 42
at Microsoft.Office.Tools.Excel.Workbook.OnStartup()
at ExcelWorkbook4.ThisWorkbook.FinishInitialization() in C:\projects\ExcelWorkbook4\ExcelWorkbook4\ThisWorkbook.Designer.cs:line 66
at Microsoft.VisualStudio.Tools.Applications.Runtime.AppDomainManagerInternal.ExecutePhase(String methodName)
at Microsoft.VisualStudio.Tools.Applications.Runtime.AppDomainManagerInternal.ExecuteCustomizationStartupCode()
at Microsoft.VisualStudio.Tools.Applications.Runtime.AppDomainManagerInternal.ExecuteCustomization(IHostServiceProvider serviceProvider)

************** Loaded Assemblies ************** 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T11:20:18.787

您还应该看看 ExcelDna - [http://www.codeplex.com/exceldna](http://www.codeplex.com/exceldna)。ExcelDna 允许托管程序集通过本机 .xll 接口向 Excel 公开用户定义的函数 (UDF) 和宏。该项目是开源的，可以免费用于商业用途。

您的用户定义函数可以用 C#、Visual Basic、F#、Java（使用 IKVM.NET）编写，并且可以编译为 .dll 或通过基于文本的脚本文件公开。支持从 Excel 97 到 Excel 2007 的 Excel 版本。

使用 .xll 接口而不是制作自动化插件的一些优点包括：

*   支持旧版本的 Excel，
*   部署更容易，因为不需要 COM 注册，并且对工作表公式中用户定义函数的引用不会绑定到加载项的位置，并且
*   通过 ExcelDna 公开的 UDF 函数的性能非常出色。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T08:14:41.550

使用简单的自动化插件创建 UDF 非常容易。您必须创建一个专用程序集并使其在 COM 中可见。遗憾的是，您无法在托管 VSTO Excel 插件中定义 UDF。

无论如何，有一个解决方法，我发现它非常有限。[本讨论对此进行了](http://www.bokebb.com/dev/english/1990/posts/199082529.shtml)描述。基本上，您的插件需要在每个工作簿中注入一些 VB 代码来注册它包含的 UDF。

# xml - 向上移动 XML 节点的子节点

> ID：124123
> 
> 赞同：1
> 
> 时间：2008-09-23T21:49:21.240
> 
> 标签：xml, xslt, command-line-interface

想象一下，我有以下 XML 文件：

<a>之前<b>中间</b>之后</a>

我想把它转换成这样的东西：

<a>前中后</a>

换句话说，我想获取某个节点的所有子节点，并将它们按顺序移动到父节点。这就像执行以下命令：“mv ./directory/* .”，但用于 xml 节点。

我想在使用 unix 命令行工具时做到这一点。我一直在尝试使用 xmlstarlet，它是一个强大的命令行 XML 操纵器。我尝试做这样的事情，但它不起作用

echo "<a>之前<b>中间</b>之后</a>" | xmlstarlet ed -m "//b/*" ".."

更新：XSLT 模板很好，因为它们可以从命令行调用。

我的目标是“从 XHTML 页面中删除链接”，换句话说，用链接标记的内容替换链接所在的位置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T05:22:55.783

示例输入文件 (test.xml)：

```
<?xml version="1.0" encoding="UTF-8"?>
<test>
<x>before<y>middle</y>after</x>
<a>before<b>middle</b>after</a>
<a>before<b>middle</b>after</a>
<x>before<y>middle</y>after</x>
<a>before<b>middle</b>after</a>
<embedded>foo<a>before<b>middle</b>after</a>bar</embedded>
</test> 
```

XSLT 样式表 (collapse.xsl:

```
 <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

      <xsl:template match="@*|node()">
        <xsl:copy>
          <xsl:apply-templates select="@*|node()"/>
        </xsl:copy>
      </xsl:template>

      <xsl:template match="a">
        <xsl:copy>
          <xsl:value-of select="."/>
        </xsl:copy>
      </xsl:template>

    </xsl:stylesheet> 
```

使用 XmlStarlet 运行

```
xml tr collapse.xsl test.xml 
```

产生：

```
<?xml version="1.0"?>
<test>
<x>before<y>middle</y>after</x>
<a>beforemiddleafter</a>
<a>beforemiddleafter</a>
<x>before<y>middle</y>after</x>
<a>beforemiddleafter</a>
<embedded>foo<a>beforemiddleafter</a>bar</embedded>
</test> 
```

样式表中的第一个模板是基本的身份转换（只需复制整个输入 XML 文档）。第二个模板专门匹配您想要“折叠”的元素，并且只复制标签并插入元素的字符串值（=后代节点的字符串值的串联）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:04:31.080

在 XSLT 中，您可以只写：

```
<xsl:template match="a"><a><xsl:apply-templates /></a></xsl:template>

<xsl:template match="a/b"><xsl:value-of select="."/></xsl:template> 
```

你会得到：

```
<a>beforemiddleafter</a> 
```

因此，如果您想以简单的方式执行此操作，您可以创建一个 XSL 样式表并通过它运行您的 XML 文件。

但是，我意识到这不是您所说的（使用 Unix 命令行）。我对Unix一无所知，所以也许其他人可以填补空白，例如。某种可以执行上述操作的命令行调用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T08:44:15.713

如果您的实际目标是从网页中删除链接，那么您应该使用这样的样式表，它匹配所有 XHTML`<a>`元素（我假设您使用的是 XHTML？），并简单地将模板应用于其内容：

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:h="http://www.w3.org/1999/xhtml"
  exclude-result-prefixes="h">

<!-- Don't copy the <a> elements, just process their content -->
<xsl:template match="h:a">
  <xsl:apply-templates />
</xsl:template>

<!-- identity template; copies everything by default -->
<xsl:template match="node()|@*">
  <xsl:copy>
    <xsl:apply-templates select="@*|node()" />
  </xsl:copy>
</xsl:template>

</xsl:stylesheet> 
```

此样式表将处理您在要保留的元素中*嵌套*`<a>`某些内容的情况，例如：

```
<p>Here is <a href="....">some <em>linked</em> text</a>.</p> 
```

你会想出来：

```
<p>Here is some <em>linked</em> text.</p> 
```

它将处理您将链接嵌套在通常的父级（`<p>`元素）和元素之间的意外元素中的情况`<a>`，例如：

```
<p>Here is <em>some <a href="...">linked</a> text</em>.</p> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-04T07:55:36.513

使用 xmlstarlet：

```
xmlstr='<a>before<b>middle</b>after</a>'
updatestr="$(echo "$xmlstr" | xmlstarlet sel -T -t -m "/a/b" -v '../.' -n | sed -n '1{p;q;}')"
echo "$xmlstr" | xmlstarlet ed -u "/a" -v "$updatestr" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T13:50:06.283

你试过这个吗？

`file.xml`

```
<r>
    <a>start<b>middle</b>end</a>
</r> 
```

`template.xsl`

```
<xsl:template match="/">
    <a><xsl:value-of select="r/a" /></a>
</xsl:template> 
```

`output`

```
<a>startmiddleend</a> 
```

# java - 为什么在 .NET 中不检查异常？

> ID：124143
> 
> 赞同：42
> 
> 时间：2008-09-23T21:52:24.603
> 
> 标签：java, .net, exception

我知道谷歌搜索可以找到合适的答案，但我更喜欢听听您的个人（也许是技术）意见。
**Java和C#在抛出异常方面存在差异的主要原因是什么？**
在 Java 中，抛出异常的方法的签名必须使用“throws”关键字，而在 C# 中，您在编译时不知道是否会抛出异常。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-09-24T09:04:14.583

在文章[The Trouble with Checked Exceptions](http://www.artima.com/intv/handcuffs.html)和 Anders Hejlsberg（C# 语言的设计者）自己的声音中，C# 不支持在 Java 中发现和验证的检查异常有三个主要原因：

*   **对检查的异常中立**

    > “C# 在检查异常问题上基本上保持沉默。一旦知道了更好的解决方案——相信我，我们会继续考虑它——我们可以回去并真正落实到位。”</p>

*   **带有检查异常的版本控制**

    > “在新版本的 throws 子句中添加新异常会破坏客户端代码。这就像向接口添加方法一样。发布接口后，它实际上是不可变的，……”</p>
    > 
    > “人们认为异常的重要之处在于处理它们，这很有趣。这不是关于异常的重要内容。在我看来，在编写良好的应用程序中，try finally 与 try catch 的比率是 10 比 1。或者在 C# 中， [`using`](http://msdn.microsoft.com/en-us/library/aa664736.aspx)语句，类似于 try finally。”</p>

*   **检查异常的可扩展性**

    > “在较小的情况下，已检查的异常非常诱人……当您开始构建大型系统时，麻烦就开始了，您在其中与四五个不同的子系统进行通信。每个子系统抛出四到十个异常。现在，每次你走上聚合阶梯时，你都会在你下面有这个指数级的层次结构，你必须处理的异常。你最终不得不声明 40 个你可能抛出的异常......它只是气球失控了。”</p>

Anson [Horton](http://blogs.msdn.com/ansonh/) ( Visual C# Program Manager）还列出了以下原因（有关每个点的详细信息，请参阅文章）：

*   版本控制
*   生产力和代码质量
*   让类作者区分已 *检查*和*未检查*的异常是不切实际的
*   难以确定接口的正确异常。

有趣的是，尽管如此，C# 确实支持给定方法通过[`<exception>`](http://msdn.microsoft.com/en-us/library/w1htk11d.aspx)标记抛出的异常的文档，编译器甚至不厌其烦地验证引用的异常类型确实存在。但是，没有在调用站点或该方法的使用处进行检查。

您可能还想查看[Exception Hunter](http://www.red-gate.com/products/exception_hunter/index.htm)，这是[Red Gate Software](http://www.red-gate.com/)的一个商业工具，它使用静态分析来确定和报告方法抛出的异常，并且可能未被捕获：

> Exception Hunter 是一种新的分析工具，它可以在您发布之前发现并报告您的函数可能抛出的一组可能的异常。有了它，您可以轻松快速地定位到未处理的异常，直至抛出异常的代码行。获得结果后，您可以在将应用程序发布到野外之前决定需要处理哪些异常（使用一些异常处理代码）。

最后，[Thinking in Java](http://www.mindview.net/Books/TIJ/)的作者[Bruce Eckel](http://mindview.net/Etc/About/about.html)有一篇文章叫《<a href="http://www.mindview.net/Etc/Discussions/CheckedExceptions" rel="noreferrer">Does Java 需要检查异常吗？ ”，这可能也值得一读，因为为什么 C# 中不存在已检查异常的问题通常在与 Java 的比较中根深蒂固。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-23T21:57:26.637

因为对检查异常的响应几乎总是：

```
try {
  // exception throwing code
} catch(Exception e) {
   // either
   log.error("Error fooing bar",e);
   // OR
   throw new RuntimeException(e);
} 
```

如果您确实知道在抛出特定异常时可以做些什么，那么您可以捕获它然后处理它，否则它只是安抚编译器的咒语。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-23T21:57:22.517

C# 的基本设计理念是实际捕获异常很少有用，而在异常情况下清理资源非常重要。我认为可以公平地说`using`（IDisposable 模式）是他们对检查异常的回答。有关更多信息，请参见 [1]。

1.  [http://www.artima.com/intv/handcuffs.html](http://www.artima.com/intv/handcuffs.html)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-23T22:08:30.227

到 .NET 被设计时，Java 已经检查异常有一段时间了，Java 开发人员充其量将这个特性视为~~[有争议的](http://andersnoras.com/blogs/anoras/archive/2007/07/16/look-mom-no-checked-exception.aspx)~~ [有争议](https://web.archive.org/web/20081012105853/http://andersnoras.com/blogs/anoras/archive/2007/07/16/look-mom-no-checked-exception.aspx)的。因此.NET 设计者[选择](http://www.artima.com/intv/handcuffs.html)不在 C# 语言中包含它。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-27T23:47:02.333

从根本上说，是否应该处理异常是*调用者*的属性，而不是函数的属性。

例如，在某些程序中，处理 IOException 没有任何价值（考虑临时命令行实用程序来执行数据处理；它们永远不会被“用户”使用，它们是专家使用的专业工具）。在某些程序中，在调用“附近”的某个点处理 IOException 是有价值的（也许如果您为配置文件获取 FNFE，您将返回到某些默认值，或者查看其他位置，或类似的东西自然）。在其他程序中，您希望它在处理之前很久就冒泡（例如，您可能希望它中止直到它到达 UI，此时它应该提醒用户出现问题。

这些情况中的每一个都取决于*应用程序*，而不是*库*。然而，除了经过检查的异常，做出决定的是*图书馆。*Java IO 库决定它将使用已检查异常（这强烈鼓励在调用本地处理），而在某些程序中，更好的策略可能是非本地处理，或者根本不处理。

这显示了在实践中检查异常的真正缺陷，它比表面的（尽管也很重要）缺陷要根本得多，太多人会编写愚蠢的异常处理程序只是为了让编译器闭嘴。我描述的问题即使在经验丰富、尽职尽责的开发人员编写程序时也是一个问题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-23T22:15:22.973

有趣的是，微软研究院的人已经在[Spec#](http://research.microsoft.com/SpecSharp/ "规格#")中添加了检查异常，这是他们 C# 的超集。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-12T15:20:43.080

[安德斯本人在本期](http://www.se-radio.net/podcast/2008-05/episode-97-interview-anders-hejlsberg)软件工程广播播客中回答了这个问题

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T21:58:31.220

由于工作变动，我从 Java 转到了 C#。起初，我有点担心这种差异，但在实践中，它并没有产生任何影响。

可能是因为我出身C++，有异常声明，但不常用。我编写每一行代码，就好像它可以抛出一样——总是在 Disposable 周围使用 using 并考虑我应该在最后做的清理工作。

回想起来，Java 中 throws 声明的传播并没有真正让我得到任何东西。

我想说一个函数绝对不会抛出 - 我认为这会更有用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T22:06:51.933

除了已经编写的响应之外，没有检查异常在许多情况下对您有很大帮助。检查异常使泛型更难实现，如果您阅读了闭包提案，您会注意到每个单独的闭包提案都必须以一种相当丑陋的方式解决检查异常。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-23T22:42:48.273

我有时会错过 C#/.NET 中的已检查异常。

我想除了 Java 之外没有其他著名的平台拥有它们。也许 .NET 的人只是顺其自然……

# java - 我应该永远不再使用原始类型吗？

> ID：124148
> 
> 赞同：16
> 
> 时间：2008-09-23T21:53:01.437
> 
> 标签：java, types

在 Java 中混合使用原始数据类型及其各自的包装类可能会导致很多错误。以下示例说明了该问题：

```
int i = 4;
...
if (i == 10)
  doStuff(); 
```

稍后您发现您希望变量*i*被定义或未定义，因此您将上述实例更改为：

```
Integer i = null; 
```

现在相等检查失败。

始终使用原始包装类是一种好的 Java 实践吗？显然它会尽早解决一些错误，但是这样做的缺点是什么？它会影响性能或应用程序的内存占用吗？有什么偷偷摸摸的陷阱吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T22:00:15.583

使用盒装类型*确实*存在性能和内存问题。

在进行比较时（例如`(i == 10)`），java 必须在进行比较之前对类型进行拆箱。即使使用`i.equals(TEN)`方法调用，它也比 == 语法更昂贵且（IMO）丑陋。

重新记忆，对象必须存储在堆上（这也会影响性能）以及存储值本身。

一个偷偷摸摸的陷阱？`i.equals(j)`当我是`null`。

我总是使用原语，除非它*可能*是`null`，但`null`在这些情况下总是在比较之前检查。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T21:59:16.053

首先，从使用原语切换到使用对象只是为了能够将其设置为空，这可能是一个糟糕的设计决策。我经常与我的同事争论 null 是否是哨兵值，我的意见通常是它不是（因此不应该像哨兵值那样被禁止），但在这种特殊情况下，你要去无法将其用作哨兵值。请不要。创建一个指示整数是否有效的布尔值，或者创建一个将布尔值和整数包装在一起的新类型。

通常，当使用较新版本的 Java 时，我发现我不需要显式创建或强制转换为原语的对象版本，因为在 1.5（可能是 1.5 本身）中添加了自动装箱支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T22:45:51.153

我建议一直使用原语，除非你真的有“空”的概念。

是的，虚拟机现在做了自动装箱和所有这些，但它可能导致一些非常奇怪的情况，你会在你真的没想到的代码行中得到一个空指针异常，你必须开始做空检查在每一个数学运算上。如果您开始混合类型并获得奇怪的自动装箱行为，您也可以开始获得一些不明显的行为。

对于浮点数/双精度数，您可以将 NaN 视为 null，但请记住 NaN != NaN，因此您仍然需要像 !Float.isNaN(x) 这样的特殊检查。

如果有支持原始类型的集合而不是浪费时间/装箱开销，那就太好了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T22:01:45.580

在您的示例中， if 语句将正常，直到您超过 127（因为整数自动装箱将缓存高达 127 的值并为每个数字返回相同的实例，直到该值）

所以它比你呈现的更糟糕......

```
if( i == 10 ) 
```

会像以前一样工作，但是

```
if( i == 128 ) 
```

将失败。正是出于这样的原因，我总是在需要时明确地创建对象，并且如果可能的话，倾向于坚持使用原始变量

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T22:00:20.450

Java POD 类型的存在是有原因的。除了开销之外，您不能对对象进行正常操作。Integer 是一个对象，需要分配和垃圾收集。一个 int 不是。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T23:31:44.693

如果该值可以为空，您可能会发现在您的设计中需要其他东西。

有两种可能性 - 值只是数据（无论是否填写，代码都不会有任何不同），或者它实际上表明您在这里有两种不同类型的对象（如果存在，则代码的行为会有所不同）一个值而不是空值）

如果它只是用于显示/存储的数据，您可能会考虑使用真正的 DTO——一个根本没有它作为一流成员的 DTO。这些通常有一种方法可以检查是否已设置值。

如果您在某个时候检查 null，您可能希望使用子类，因为当有一个差异时，通常会有更多。至少您想要一种比“如果primitiveIntValue == null”更好的方法来表明您的差异，这并不意味着什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:37:26.690

不要仅仅为了获得这种便利而转向非原始人。使用布尔值来指示该值是否已设置。如果您不喜欢该解决方案并且您知道您的整数将处于某个合理的限制（或不关心偶尔的失败），请使用特定值来指示“未初始化”，例如 Integer.MIN_VALUE。但这是一个比布尔值安全得多的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T03:36:55.313

当您到达“稍后”时，需要在重构期间完成更多工作。尽可能使用原语。（资本期）如果需要更多功能，则制作 POJO。在我看来，原始包装类最适合用于需要通过网络传输的数据，即网络应用程序。随着系统“增长”，允许空值作为可接受的值会导致令人头疼的问题。太多代码被浪费或遗漏，以保护应该是简单的比较。

# javascript - 在给定的时间后使 div 很好地消失

> ID：124166
> 
> 赞同：6
> 
> 时间：2008-09-23T21:55:32.053
> 
> 标签：javascript, css, html, fade

`<div>`在给定时间后淡出效果的最佳方法是什么（不使用一些可用的 JavaScript 库）。

我正在寻找一种非常轻量级的解决方案，不需要将庞大的 JavaScript 库发送到浏览器。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T21:58:38.240

不知道为什么你会如此反对使用像 jQuery 这样的东西，这会使完成这个效果几乎是微不足道的，但本质上，你需要对 -moz-opacity、opacity 和 filter:alpha CSS 规则进行一系列更改在 setTimeout() 中。

或者，使用 jQuery，并在 setTimeout 中包装一个 fadeOut() 调用。你的选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T22:23:00.770

这是一些可以做到这一点的javascript。我在某个地方的 javascript 教程网站上找到了它（我无法再次找到它）并对其进行了修改。

```
var TimeToFade = 200.0;

function fade(eid)
{
    var element = document.getElementById(eid);
    if(element == null) return;

    if(element.FadeState == null)
    {
        if(element.style.opacity == null || element.style.opacity == ''
               || element.style.opacity == '1') {
            element.FadeState = 2;
        } else {
            element.FadeState = -2;
        }
    }

    if(element.FadeState == 1 || element.FadeState == -1) {
        element.FadeState = element.FadeState == 1 ? -1 : 1;
        element.FadeTimeLeft = TimeToFade - element.FadeTimeLeft;
    } else {
        element.FadeState = element.FadeState == 2 ? -1 : 1;
        element.FadeTimeLeft = TimeToFade;
        setTimeout("animateFade(" + new Date().getTime()
           + ",'" + eid + "')", 33);
    }
}

function animateFade(lastTick, eid)
{
    var curTick = new Date().getTime();
    var elapsedTicks = curTick - lastTick;

    var element = document.getElementById(eid);

    if(element.FadeTimeLeft <= elapsedTicks) {
        element.style.opacity = element.FadeState == 1 ? '1' : '0';
        element.style.filter = 'alpha(opacity = '
            + (element.FadeState == 1 ? '100' : '0') + ')';
        element.FadeState = element.FadeState == 1 ? 2 : -2;
        element.style.display = "none";
        return;
    }

    element.FadeTimeLeft -= elapsedTicks;
    var newOpVal = element.FadeTimeLeft/TimeToFade;
    if(element.FadeState == 1) {
        newOpVal = 1 - newOpVal;
    }

    element.style.opacity = newOpVal;
    element.style.filter = 'alpha(opacity = ' + (newOpVal*100) + ')';

    setTimeout("animateFade(" + curTick + ",'" + eid + "')", 33);
} 
```

以下 html 显示了它是如何工作的：

```
<html><head>
    <script type="text/javascript" src="fade.js"></script>
</head><body>
    <div id="fademe" onclick="fade( 'fademe' )">
        <p>This will fade when you click it</p>
    </div>
</body></html> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T21:58:42.590

这些天来，我总是会为此使用一个库——他们取得的进步是惊人的，而且单是跨浏览器的功能就值得了。所以这个答案是非答案。我只想指出，jQuery 全部为 15kB。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T22:00:27.407

使用带有初始时间的 setTimeout 来触发淡入淡出例程，然后使用带有低计时器的 setTimeout 来逐步检查图像的不透明度级别，直到它消失。

然而，jQuery 可以降低到大约 15k，并且是客户端的一次性下载，所以我不会称它为巨大的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T00:12:41.863

试试 YUI（雅虎用户界面）动画库：http: [//developer.yahoo.com/yui/animation/](http://developer.yahoo.com/yui/animation/)

不要重新发明轮子。图书馆是我们的朋友。:-)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-23T21:59:34.117

我知道你不喜欢图书馆，但我建议你看看 moo.fx：[http://moofx.mad4milk.net/](http://moofx.mad4milk.net/) - 我认为它就像 3k。

jQuery 也非常小。

# bash - Bash 变量范围

> ID：124167
> 
> 赞同：116
> 
> 时间：2008-09-23T21:56:10.850
> 
> 标签：bash, scope, pipe

请向我解释为什么最后一个`echo`语句是空白的？我希望`XCODE`在 while 循环中将其增加到 1 的值：

```
#!/bin/bash
OUTPUT="name1 ip ip status" # normally output of another command with multi line output

if [ -z "$OUTPUT" ]
then
        echo "Status WARN: No messages from SMcli"
        exit $STATE_WARNING
else
        echo "$OUTPUT"|while read NAME IP1 IP2 STATUS
        do
                if [ "$STATUS" != "Optimal" ]
                then
                        echo "CRIT: $NAME - $STATUS"
                        echo $((++XCODE))
                else
                        echo "OK: $NAME - $STATUS"
                fi
        done
fi

echo $XCODE 
```

我尝试使用以下语句而不是`++XCODE`方法

```
XCODE=`expr $XCODE + 1` 
```

它也不会在 while 语句之外打印。我想我在这里遗漏了一些关于变量范围的东西，但是 ol' 手册页没有向我展示。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2008-09-23T22:29:16.607

因为您正在通过管道进入 while 循环，所以创建了一个子 shell 来运行 while 循环。

现在这个子进程拥有自己的环境副本，并且不能将任何变量传递回其父进程（就像在任何 unix 进程中一样）。

因此，您需要进行重组，以免进入循环。或者，您可以在一个函数中运行，例如，`echo`您希望从子流程返回的值。

[http://tldp.org/LDP/abs/html/subshel​​ls.html#SUBSHELL](http://tldp.org/LDP/abs/html/subshells.html#SUBSHELL)

* * *

## 回答 #2

> 赞同：120
> 
> 时间：2008-09-23T22:37:40.080

问题是与管道放在一起的进程在子shell中执行（因此有自己的环境）。管内发生的`while`任何事情都不会影响管外的任何事情。

您可以通过将管道重写为来解决您的具体示例

```
while ... do ... done <<< "$OUTPUT" 
```

也许

```
while ... do ... done < <(echo "$OUTPUT") 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-11-27T16:24:09.820

这也应该有效（因为 echo 和 while 在同一个子shell中）：

```
#!/bin/bash
cat /tmp/randomFile | (while read line
do
    LINE="$LINE $line"
done && echo $LINE ) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-11-02T16:49:48.510

另一种选择：

```
#!/bin/bash
cat /some/file | while read line
do
  var="abc"
  echo $var | xsel -i -p  # redirect stdin to the X primary selection
done
var=$(xsel -o -p)  # redirect back to stdout
echo $var 
```

编辑：在这里， xsel 是一个要求（安装它）。或者，您可以使用 xclip: `xclip -i -selection clipboard` 而不是 `xsel -i -p`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T22:03:29.100

```
 #!/bin/bash
 OUTPUT="name1 ip ip status"
+export XCODE=0;
 if [ -z "$OUTPUT" ]
----

                     echo "CRIT: $NAME - $STATUS"
-                    echo $((++XCODE))
+                    export XCODE=$(( $XCODE + 1 ))
             else

echo $XCODE 
```

看看这些变化是否有帮助

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-04-11T17:33:36.783

另一种选择是将结果从子 shell 输出到文件中，然后在父 shell 中读取。就像是

```
#!/bin/bash
EXPORTFILE=/tmp/exportfile${RANDOM}
cat /tmp/randomFile | while read line
do
    LINE="$LINE $line"
    echo $LINE > $EXPORTFILE
done
LINE=$(cat $EXPORTFILE) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-08-24T13:04:02.057

当我制作自己的小杜时，我解决了这个问题：

```
ls -l | sed '/total/d ; s/  */\t/g' | cut -f 5 | 
( SUM=0; while read SIZE; do SUM=$(($SUM+$SIZE)); done; echo "$(($SUM/1024/1024/1024))GB" ) 
```

关键是我用 ( ) 制作了一个包含我的 SUM 变量和 while 的子 shell，但是我通过管道进入整个 ( ) 而不是 while 本身，这避免了陷阱。

# delphi - 模拟 PHP 函数 parse_url 的 Delphi/FreePascal 库或函数

> ID：124170
> 
> 赞同：2
> 
> 时间：2008-09-23T21:56:29.913
> 
> 标签：delphi, parsing, freepascal, url-parsing

我在 Object Pascal 中做一个站点地图生成器，需要一个好的函数或库来模拟 PHP 上的[parse_url](http://php.net/manual/en/function.parse-url.php)函数。

有谁知道有什么好的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T22:30:16.883

我不熟悉 PHP 上的 parse_url 函数，但您可以尝试[Indy中包含的](http://www.indyproject.org/ "印地项目主页。")[TIdURI](http://www.indyproject.org/docsite/html/TIdURI.html "TIdURI 类的在线文档")类（该类又包含在最新的 Delphi 版本中）。我认为他们也将其移植到了 FreePascal。

> TIdURI 是封装通用资源标识符的 TObject 后代，如 Internet 标准文档中所述：
> 
> > [RFC 1630 - WWW 中的通用资源标识符](http://www.rfc-editor.org/rfc/rfc1630.txt)
> 
> TIdURI 为使用构成 URI 的组件部分（包括：协议、主机、端口、路径、文档和书签）来组装和反汇编 URI 提供方法和属性。

如果这不起作用，请给出一个具体示例来说明您要完成的工作-*您要从 URL 中解析出什么*。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T09:11:45.780

Freepascal 具有带有 ParseURI 功能的单元 URIParser。如何使用它的示例可以在[Freepascal 的源代码](http://svn.freepascal.org/cgi-bin/viewvc.cgi/tags/release_2_2_2/packages/fcl-net/examples/testuri.pp?revision=11487&view=markup)中的示例之一中找到。或者一个更容易理解的[老例子。](http://ejemplos.mis-algoritmos.com/archives/346)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T01:55:46.197

小心 Indy 的 TIdURI 类。它应该是一个通用的解析器，但它有一些错误和设计缺陷，使其无法成为一个完全兼容的解析器。我目前正在从头开始为 Indy 11 编写一个新类来替换 TIdURI。它将是一个完全兼容的 URI 解析器，它还将支持 IRI (RFC 3987) 解析。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T06:21:18.233

如果您使用的是 wininet.dll，您还可以使用他们的[InternetCrackUrl](http://msdn.microsoft.com/en-us/library/aa384376(VS.85).aspx "InternetCrackUrl") API。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T22:00:33.197

[URI RFC](http://www.ietf.org/rfc/rfc2396.txt)列出了这个用于 URI 解析的正则表达式：

```
 ^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?
   12            3  4          5       6  7        8 9 
```

这些组的数字在哪里：

```
 $1 = http:
  $2 = http
  $3 = //www.ics.uci.edu
  $4 = www.ics.uci.edu
  $5 = /pub/ietf/uri/
  $6 = <undefined>
  $7 = <undefined>
  $8 = #Related
  $9 = Related 
```

对于此 URI：

```
 http://www.ics.uci.edu/pub/ietf/uri/#Related 
```

正则表达式非常简单，并且没有使用正则表达式库必须提供的特殊功能，因此请使用与您的 pascal 实现兼容的功能，然后就可以了。

# python - Wide Finder 挑战的 Python 和 Perl 解决方案比较

> ID：124171
> 
> 赞同：8
> 
> 时间：2008-09-23T21:57:11.893
> 
> 标签：python, performance, perl, analysis

[如果您能将获奖的 O'Rourke 的 Perl 解决方案](http://www.cs.ucsd.edu/~sorourke/wf.pl)与[Lundh 的 Python 解决](http://effbot.org/zone/wide-finder.htm)方案进行比较，我将不胜感激，因为我对 Perl 的了解还不够好，无法理解那里发生了什么。更具体地说，我想知道是什么赋予了 Perl 版本 3x 的优势：算法优势、C 扩展的质量、其他因素？

[宽查找器：结果](http://www.tbray.org/ongoing/When/200x/2007/10/30/WF-Results)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T22:39:07.550

perl 的更好的正则表达式实现是故事的一部分。然而，这无法解释为什么 perl 实现可以更好地扩展。处理器越多，差异越大。由于某种原因，python 实现在那里存在问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T22:14:18.200

Perl 针对文本处理进行了大量优化。有很多因素，很难说确切的区别是什么。文本在内部表示完全不同（utf-8 与 utf-16/utf-32），正则表达式引擎也完全不同。Python 的正则表达式引擎是一个自定义的引擎，不如 perl 的那么常用。与基本上是“语言核心”的 Perl 相比，很少有开发人员致力于它（我认为它基本上没有维护）。

毕竟 Perl 是*文本*处理语言。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-09T00:28:26.927

Many-core Engine (MCE) has been released for Perl. MCE does quite well at this, even when reading directly from disk with 8 workers (cold cache). Compare to wf_mmap. MCE follows a bank queuing model when reading input data. Look under the images folder for slides on it.

The source code is hosted at [http://code.google.com/p/many-core-engine-perl/](http://code.google.com/p/many-core-engine-perl/)

The perl documentation can be read at [https://metacpan.org/module/MCE](https://metacpan.org/module/MCE)

An implementation of the Wide Finder with MCE is provided under examples/tbray/

[https://metacpan.org/source/MARIOROY/MCE-1.514/examples/tbray/](https://metacpan.org/source/MARIOROY/MCE-1.514/examples/tbray/)

Enjoy MCE.

```
Script....:  baseline1  baseline2  wf_mce1  wf_mce2  wf_mce3  wf_mmap
Cold cache:      1.674      1.370    1.252    1.182    1.174    3.056
Warm cache:      1.236      0.923    0.277    0.106    0.098    0.092 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T17:47:10.713

Perl 实现使用[mmap](http://en.wikipedia.org/wiki/Mmap)系统调用。该调用所做的是建立一个指向进程的指针，该指针似乎是程序的正常内存段或缓冲区。它将文件的内容映射到内存区域。与普通文件 IO（读取）相比，这样做有性能优势——一个是不需要用户空间库调用来访问数据，另一个是通常需要较少的复制操作（例如：在内核和用户空间）。

Perl 的字符串和正则表达式是基于 8 位字节的（例如与 Java 的 utf16 相反），因此 Perl 的本机“字符类型”与映射文件的编码相同。

当正则表达式引擎对 mmap 支持的变量进行操作时，它通过映射的内存区域直接访问文件数据——无需通过 Perl 的 IO 函数，甚至 libc 的 IO 函数。

mmap 可能主要负责与使用普通 Python IO 库的 Python 版本的性能差异——这还引入了寻找换行符的开销。

Perl 程序还支持 -J 来并行处理，其中 oepen "-|" 导致一个 fork() ，其中父级中的文件句柄指向子级的标准输出。子进程将其结果序列化到标准输出，父进程将它们反序列化以协调和汇总结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-02T07:12:44.030

> Perl 实现使用 mmap 系统调用。

这个。它避免了缓冲区复制并提供异步 I/O。

# sql - 如何在 T-SQL 中执行相当于“SHOW TABLES”的操作？

> ID：124205
> 
> 赞同：45
> 
> 时间：2008-09-23T22:02:03.410
> 
> 标签：sql, tsql, sql-server-2005

我想根据表名在我的 SQL Server 2005 Express 数据库中查找表。在`MySQL`我会使用`SHOW TABLES LIKE "Datasheet%"`，但在`T-SQL`这会引发错误（它尝试查找`SHOW`存储过程并失败）。

这可能吗？如果可以，怎么做？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-23T22:14:56.453

我知道您已经接受了答案，但为什么不使用更简单的[sp_tables](https://msdn.microsoft.com/en-us/library/ms186250.aspx)呢？

```
sp_tables 'Database_Name' 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-09-23T22:06:33.727

这将为您提供当前数据库中的表列表：

```
Select Table_name as "Table name"
From Information_schema.Tables
Where Table_type = 'BASE TABLE' and Objectproperty 
(Object_id(Table_name), 'IsMsShipped') = 0 
```

其他一些有用的 T-SQL 位可以在这里找到：http: [//www.devx.com/tips/Tip/28529](http://www.devx.com/tips/Tip/28529)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-08-04T04:30:00.900

试试这个：

```
USE your_database
go
Sp_tables
go 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-23T22:05:46.100

试试这个

```
SELECT * FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME LIKE 'Datasheet%' 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T22:04:48.880

试试这个 ：

```
select * from information_schema.columns
where table_name = 'yourTableName' 
```

也寻找其他`information_schema`意见。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-05-26T12:08:19.177

不知道 TABLE NAME 的人将无法根据上述答案获得结果。

试试这个

```
SELECT * FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA='dbo'; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-23T23:18:28.750

而且，由于[INFORMATION_SCHEMA 是 SQL-92 标准的一部分](http://www.petefreitag.com/item/666.cfm)，很多数据库都支持它——包括[MySQL](http://dev.mysql.com/doc/refman/5.0/en/tables-table.html)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-23T22:06:23.307

尝试关注

```
SELECT table_name
FROM information_schema.tables
WHERE
table_name LIKE 'Datasheet%' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-08T00:22:18.570

尝试一下 ：

```
SELECT * FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME LIKE '%' 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-23T22:55:42.207

`MS`正在慢慢淘汰`information_schema`视图以外的方法。因此，为了向前兼容，请始终使用这些。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-02-29T11:26:15.870

我知道这是一个老问题，但我刚刚遇到它。

通常我会说访问 information_schema.tables 视图，但在发现 PDO 无法从不同的数据对象访问该数据库时，我需要找到不同的方式。`sp_tables 'Database_Name`使用非特权用户或 PDO 时，看起来是一种更好的方法。

# chm - HTML 帮助研讨会在编译 CHM 时崩溃

> ID：124206
> 
> 赞同：4
> 
> 时间：2008-09-23T22:02:05.297
> 
> 标签：chm

尝试使用 Microsoft HTML Help Workshop 构建 CHM。当我单击编译时，HTML Help Workshop 状态如下：

> 发生内部错误。错误记录已保存到 c:\os.err。

该文件的唯一内容是：

> （（今天的日期和时间））
> Microsoft HTML Help Workshop 版本 4.74.8702
> HHA 版本 4.74.8702
> htmlproc.cpp(114)：断言失败：(pszTmp == m_pCompiler->m_pHtmlMem->psz)

该错误仅发生在少数选定的大型项目中，并且在命令行和 HTML Help Workshop GUI 中都会发生。

是什么导致此错误发生，如何修复我的项目以通过编译器运行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T19:51:56.100

Microsoft HTML 帮助编译器对路径名称大小有一些未说明的要求。

将项目移动到更接近根驱动器的目录（即“C:\helpsystem\”）并将项目内的文件夹重命名为更小的名称，从而减少了路径名的大小，以便项目可以编译。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T00:40:45.057

我发现 Microsoft HTML Help Workshop 使用起来有点微妙。您是否已安装所有先决条件？尝试从命令行运行编译器 hhc.exe。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-04-16T10:50:10.347

需要注意的另一件事是错误 413 - 请求实体太大错误。

我不确定 HTML Help Workshop 有*多大*，但我的 htm 文件超过 2MB，是一个大表格，它会导致 HTML Help Workshop 在处理它时崩溃。

虽然这不是同一个问题，但这是我需要的提示 -[我不是第一个在 SO](https://superuser.com/questions/330418/file-size-limits-for-chm-html-help-format-files) ..

# imap - IMAP：“立即”删除，不通过垃圾文件夹？

> ID：124207
> 
> 赞同：1
> 
> 时间：2008-09-23T22:02:21.943
> 
> 标签：imap

我目前通过以下步骤从收件箱中过滤一些邮件：

```
select inbox
pick messages
set \Deleted tag 
```

然后在选择垃圾箱后重复该过程。

有没有更直接的方式来处理这些消息？还是只是邮件服务器的功能，删除邮件将其放入垃圾箱，并从垃圾箱中永久删除它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T22:15:45.530

我相信您必须在设置标签已删除后调用 EXPUNGE。

[RFC 3501](http://www.faqs.org/rfcs/rfc3501.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:12:41.700

不确定您在哪里进行这些操作。IMAP 本身并没有指定您将内容移动到垃圾箱文件夹。通常，IMAP 会让您将邮件标记为已删除，并将其保留在收件箱中，但标记为已删除。然后，您可以选择“清除”文件夹，该文件夹实际上将删除所有标记为删除的项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T22:25:02.623

使用我的邮件客户端（thunderbird），要直接删除而不是发送到垃圾箱，我按住 Shift 键和 Delete 键。

# c# - 使用 C# 和 RhinoMocks 进行测试驱动开发的最佳实践

> ID：124210
> 
> 赞同：88
> 
> 时间：2008-09-23T22:03:18.900
> 
> 标签：c#, unit-testing, tdd, rhino-mocks

为了帮助我的团队编写可测试的代码，我想出了这个简单的最佳实践列表，以使我们的 C# 代码库更具可测试性。（其中一些观点提到了 Rhino Mocks 的限制，这是一个 C# 的模拟框架，但这些规则也可能适用于更普遍的情况。）有没有人有任何他们遵循的最佳实践？

为了最大限度地提高代码的可测试性，请遵循以下规则：

1.  **先写测试，再写代码。**原因：这可确保您编写可测试的代码，并且每一行代码都得到为其编写的测试。

2.  **使用依赖注入设计类。**原因：你不能模拟或测试看不见的东西。

3.  **使用 Model-View-Controller 或 Model-View-Presenter 将 UI 代码与其行为分开。**原因：允许在最小化无法测试的部分（UI）的同时测试业务逻辑。

4.  **不要编写静态方法或类。** 原因：静态方法很难或不可能隔离，Rhino Mocks 无法模拟它们。

5.  **对接口进行编程，而不是类。**原因：使用接口澄清了对象之间的关系。接口应该定义对象从其环境中需要的服务。此外，可以使用 Rhino Mocks 和其他模拟框架轻松模拟接口。

6.  **隔离外部依赖。**原因：无法测试未解决的外部依赖项。

7.  **将您打算模拟的方法标记为虚拟。**原因：Rhino Mocks 无法模拟非虚拟方法。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-24T05:32:30.427

绝对是一个很好的清单。以下是一些关于它的想法：

> **先写测试，再写代码。**

我同意，在高水平上。但是，我会更具体：“先编写一个测试，然后编写*足够的*代码以通过测试，然后重复。” 否则，我担心我的单元测试看起来更像集成或验收测试。

> **使用依赖注入设计类。**

同意。当一个对象创建自己的依赖项时，您无法控制它们。控制反转/依赖注入为您提供控制，允许您使用模拟/存根/等隔离被测对象。这就是孤立地测试对象的方式。

> **使用 Model-View-Controller 或 Model-View-Presenter 将 UI 代码与其行为分开。**

同意。请注意，即使是演示者/控制器也可以使用 DI/IoC 进行测试，方法是为其提供一个 stubbed/mocked 视图和模型。查看[Presenter First](http://www.atomicobject.com/pages/Presenter+First) TDD 了解更多信息。

> **不要编写静态方法或类。**

不确定我是否同意这一点。可以在不使用模拟的情况下对静态方法/类进行单元测试。所以，也许这是您提到的 Rhino Mock 特定规则之一。

> **对接口进行编程，而不是类。**

我同意，但原因略有不同。接口为软件开发人员提供了极大的灵活性——不仅仅是对各种模拟对象框架的支持。例如，没有接口就无法正确支持 DI。

> **隔离外部依赖。**

同意。使用接口隐藏您自己的外观或适配器（视情况而定）后面的外部依赖项。这将允许您将您的软件与外部依赖项隔离开来，无论是 Web 服务、队列、数据库还是其他东西。当您的团队不控制依赖项（也称为外部）时，这一点*尤其重要。*

> **将您打算模拟的方法标记为虚拟。**

这是 Rhino Mocks 的限制。在喜欢手动编码存根而不是模拟对象框架的环境中，这不是必需的。

而且，有几点需要考虑：

**使用创造设计模式。**这将有助于 DI，但它也允许您隔离该代码并独立于其他逻辑对其进行测试。

**[使用Bill Wake 的 Arrange/Act/Assert 技术](http://weblogs.java.net/blog/wwake/archive/2003/12/tools_especiall.html)编写测试。**这种技术可以非常清楚地说明哪些配置是必要的、实际测试的内容以及预期的内容。

**不要害怕推出自己的模拟/存根。**通常，您会发现使用模拟对象框架会使您的测试非常难以阅读。通过自己滚动，您将完全控制您的模拟/存根，并且您将能够使您的测试保持可读性。（请参阅上一点。）

**避免将单元测试中的重复重构为抽象基类或设置/拆卸方法的诱惑。**这样做会隐藏试图理解单元测试的开发人员的配置/清理代码。在这种情况下，每个单独测试的清晰性比重构重复更重要。

**实施持续集成。**在每个“绿色条”上签入您的代码。构建您的软件并在每次签入时运行您的全套单元测试。（当然，这本身不是一种编码实践；但它是一个令人难以置信的工具，可以让您的软件保持清洁和完全集成。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T05:44:57.337

如果您正在使用 .Net 3.5，您可能需要查看[Moq](https://github.com/Moq/moq4)模拟库 - 它使用表达式树和 lambdas 来删除大多数其他模拟库的非直观记录回复习语。

查看此[快速入门](https://github.com/Moq/moq4/wiki/Quickstart)以了解您的测试用例变得多么直观，这是一个简单的示例：

```
// ShouldExpectMethodCallWithVariable
int value = 5;
var mock = new Mock<IFoo>();

mock.Expect(x => x.Duplicate(value)).Returns(() => value * 2);

Assert.AreEqual(value * 2, mock.Object.Duplicate(value)); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T05:42:26.207

[了解假货、模拟物和存根](http://martinfowler.com/articles/mocksArentStubs.html)之间的区别以及何时使用它们。

避免使用模拟过度指定交互。这使测试变得[脆弱](http://www.martinfowler.com/bliki/TestCancer.html)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-06T02:23:23.750

这是一个非常有帮助的帖子！

我要补充一点，了解上下文和被测系统 (SUT) 始终很重要。当您在现有代码遵循相同原则的环境中编写新代码时，遵循 TDD 原则要容易得多。但是，当您在非 TDD 遗留环境中编写新代码时，您会发现您的 TDD 工作会迅速膨胀，远远超出您的估计和预期。

对于你们中的一些人来说，他们生活在一个完全学术的世界中，时间线和交付可能并不重要，但在软件就是金钱的环境中，有效利用 TDD 工作至关重要。

TDD 高度服从[边际收益递减](http://en.wikipedia.org/wiki/Diminishing_returns)法则。简而言之，在达到最大回报点之前，您在 TDD 上所做的努力会变得越来越有价值，之后投入到 TDD 上的后续时间的价值就会越来越少。

我倾向于相信 TDD 的主要价值在于边界（黑盒）以及系统任务关键区域的偶尔白盒测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-09-06T19:45:38.720

针对接口进行编程的真正原因不是为了让 Rhino 的生活更轻松，而是为了阐明代码中对象之间的关系。接口应该定义对象从其环境中需要的服务。一个类提供该服务的特定实现。阅读 Rebecca Wirfs-Brock 关于角色、职责和协作者的“对象设计”一书。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T00:06:29.197

好清单。您可能想要确定的一件事——我不能给你太多建议，因为我自己刚刚开始考虑它——是什么时候一个类应该在不同的库、命名空间、嵌套命名空间中。您甚至可能想事先找出一个库和命名空间列表，并要求团队必须开会并决定合并两个/添加一个新的。

哦，只是想到了我做的一些你可能也想做的事情。我通常有一个单元测试库，每个类策略都有一个测试夹具，其中每个测试都进入相应的命名空间。我也倾向于拥有另一个更[BDD 风格](http://behaviour-driven.org/)的测试库（集成测试？） 。这使我可以编写测试来指定方法应该做什么以及应用程序应该做什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T13:27:15.153

这是另一个我认为我喜欢做的事情。

如果您计划从单元测试 Gui 而不是从 TestDriven.Net 或 NAnt 运行测试，那么我发现将单元测试项目类型设置为控制台应用程序而不是库更容易。这允许您手动运行测试并在调试模式下逐步执行它们（前面提到的 TestDriven.Net 实际上可以为您做）。

此外，我总是喜欢打开一个 Playground 项目来测试我不熟悉的代码和想法。这不应该检查到源代码管理中。更好的是，它应该仅位于开发人员机器上的单独源代码控制存储库中。

# performance - GPGPU（通用GPU）开发的优缺点是什么？

> ID：124222
> 
> 赞同：5
> 
> 时间：2008-09-23T22:06:11.857
> 
> 标签：performance, optimization, hpc

我想知道在 GPGPU 开发中帮助您的关键是什么，当然还有哪些限制是您无法接受的。

我想到了：

*   关键优势：这些东西的原始力量
*   关键约束：内存模型

你有什么看法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T06:00:16.037

你必须小心你如何解释蒂姆·斯威尼在 Ars 采访中的陈述。他说拥有两个独立的平台（CPU 和 GPU），一个适合单线程性能，一个适合面向吞吐量的计算，随着我们的应用程序和硬件相互发展，很快就会成为过去。

GPU 摆脱了 CPU 的技术限制，这使得可以说更自然的算法（如光线追踪和光子映射）在合理的分辨率和帧速率下几乎不可撤销。GPU 出现了，它具有完全不同和限制性的编程模型，但对于煞费苦心地编码到该模型的应用程序，吞吐量可能提高 2 或 3 个数量级。这两种机器模型具有（并且仍然具有）本质上不同的编码风格、语言（OpenGL、DirectX、着色器语言与传统桌面语言）和工作流程。这使得代码重用，甚至算法/编程技能重用变得极其困难，并且将任何想要使用密集并行计算基础的开发人员束缚在这种限制性编程模型中。

最后，我们将达到这样一个点，即这种密集的计算基板同样可以对 CPU 进行编程。尽管这些大规模并行加速器中的一个“核心”（尽管执行线程，例如 G80 上的 SM，并不完全是传统意义上的核心）和现代 x86 桌面之间仍然存在相当大的性能差异核心，两个因素推动这两个平台的融合：

*   英特尔和 AMD 正朝着 x86 芯片上更多、更简单的内核发展，将硬件与 GPU 融合在一起，随着时间的推移，这些单元变得更加粗粒度和可编程）。
*   这种力量和其他力量正在催生许多新的应用程序，这些应用程序可以利用数据或线程级并行 (DLP/TLP)，有效地利用这种基板。

因此，蒂姆所说的是，这两个不同的平台将在更大程度上融合，例如，[OpenCl 所能](http://en.wikipedia.org/wiki/OpenCL)提供的。采访中的重要引述：

> TS：不，我清楚地知道你要去哪里。在下一代控制台中，您可以拥有由单个非商品芯片组成的控制台。它可能是一个通用处理器，无论它是从过去的 CPU 架构还是 GPU 架构演变而来，它可能以完全同质的方式运行一切——图形、人工智能、声音和所有这些系统。这是一个非常有趣的前景，因为它可以极大地简化工具集和创建软件的过程。
> 
> 现在，在发布 Unreal 3 的过程中，我们必须使用多种编程语言。我们使用一种编程语言编写像素着色器，另一种编写游戏代码，然后在 PlayStation 3 上，我们使用另一种编译器编写代码以在 Cell 处理器上运行。所以 PlayStation 3 最终成为一个特殊的挑战，因为你拥有来自不同供应商的三种完全不同的处理器，它们具有不同的指令集、不同的编译器和不同的性能技术。因此，很多复杂性是不必要的，并且使负载平衡更加困难。
> 
> 例如，当您拥有三个具有不同编程能力的不同芯片时，您通常会让其中两个芯片大部分时间处于闲置状态，而另一个则被用尽。但是如果架构是完全统一的，那么你可以随时在芯片的任何部分运行任何任务，并通过这种方式获得最佳的性能折衷。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:12:56.770

我发现这篇文章很有趣，因为随着 CPU 的速度和内核数量的不断增加，GPU 将不再是必要的。

[http://arstechnica.com/articles/paedia/gpu-sweeney-interview.ars](http://arstechnica.com/articles/paedia/gpu-sweeney-interview.ars)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T05:45:46.010

曾经因为他们的并行架构和额外的芯片很有趣，这些芯片大多是空闲的，因此可以用于一般用途的编程任务 -

见 - [http://en.wikipedia.org/wiki/CUDA](http://en.wikipedia.org/wiki/CUDA)

但面对楼上的回答，它可能不太相关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T11:20:31.253

关键优势是 gigaflops - 原始功率。缺点包括有限的、非正交的指令集和编程模型。

这是一份调查报告： [http ://graphics.idav.ucdavis.edu/publications/print_pub?pub_id=907](http://graphics.idav.ucdavis.edu/publications/print_pub?pub_id=907)

维基百科文章是一个很好的开始。

Lou Franco 提到了对 Tim Sweeney 的采访；这是他演讲的幻灯片，其中包含更多详细信息： [http ://www.scribd.com/doc/5687/The-Next-Mainstream-Programming-Language-A-Game-Developers-Perspective-by-Tim-斯威尼](http://www.scribd.com/doc/5687/The-Next-Mainstream-Programming-Language-A-Game-Developers-Perspective-by-Tim-Sweeney)

也可能会四处寻找：http: [//gpgpu.org](http://gpgpu.org)

# windows - Git 可以在 Windows 上运行吗？

> ID：124235
> 
> 赞同：16
> 
> 时间：2008-09-23T22:09:28.713
> 
> 标签：windows, git, version-control, dvcs

我一直在 Linux 上工作，我对 Windows 一无所知，甚至没有 Windows 机器。Git 现在可以在 Windows 上运行吗？还是我使用它给我的 Windows 朋友带来了问题？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T22:26:49.777

据我所知，[msysgit](http://code.google.com/p/msysgit/)在 Windows Vista 下运行良好。

这是在检查 Ruby on Rails 的插件和应用程序的整个 2 个月的经验之后 :-)

无论如何，安装起来轻而易举，没问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T00:00:13.547

即使使用 gui 工具（gitk 和 git gui），使用来自[Cygwin](http://www.cygwin.com/)的 git，我也没有遇到任何问题。Cygwin 人非常有责任心，并且有一个庞大的社区可供引导。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T21:33:05.750

是的，它确实。[在 GitCasts 上](http://www.gitcasts.com/posts/git-on-windows)查看此截屏视频。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-09T11:48:05.937

您还应该检查[Git-Extensions](http://code.google.com/p/gitextensions/)，它添加​​了 git 命令作为 shell 扩展 - 与 msysgit 配合得很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-09T11:51:55.990

到目前为止，在版本 0.4 中有一个用于 GIT 的 Tortoise 端口：

*   [乌龟 GIT](http://code.google.com/p/tortoisegit/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-17T09:03:53.920

我听说过它的好消息，但对我（以及我工作的日本公司）来说，一个症结是缺乏跨平台的 Unicode 文件名支持。这取决于该特定功能对您是否重要。

请参阅[msysgit 错误跟踪器中的第 80 期](http://code.google.com/p/msysgit/issues/detail?id=80)。

请参阅[哪些 DVCS 支持 Unicode 文件名？](https://stackoverflow.com/questions/829682/what-dvcs-support-unicode-filenames)我问过这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T22:14:42.583

它有效，但效果不佳。如果你谷歌一下，你会发现[使用 MinGW 的端口](http://code.google.com/p/msysgit)。主要问题是不稳定和一些非常类似于 Linux 的工具（gittk）。如果你真的需要它，你应该能够过得去。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-11T00:29:43.070

在您主要使用 Eclipse 作为 IDE 的情况下，有一个名为 EGit 的优秀团队提供程序，它非常易于安装。检查这个： http: [//www.eclipse.org/egit/](http://www.eclipse.org/egit/)

# sql-server - 在 MS SQL Server 中管理大量表的最佳方法是什么？

> ID：124237
> 
> 赞同：4
> 
> 时间：2008-09-23T22:10:05.060
> 
> 标签：sql-server, performance, scalability

这个问题与另一个问题有关：
[拥有多个文件组有助于加快我的数据库吗？](https://stackoverflow.com/questions/108445/will-having-multiple-filegroups-help-speed-up-my-database)

我们正在开发的软件是一个分析工具，它使用 MS SQL Server 2005 来存储关系数据。初始分析可能很慢（因为我们正在处理数百万或数十亿行数据），但快速调用以前的分析有性能要求，因此我们“保存”每个分析的结果。

我们目前的方法是将分析结果保存在一系列“特定于运行”的表中，并且分析非常复杂，以至于每次分析可能会得到多达 100 个表。通常，这些表每次分析使用几百 MB（与我们数百 GB 或有时多个 TB 的源数据相比，这很小）。但总的来说，磁盘空间对我们来说不是问题。每组表都特定于一个分析，在许多情况下，这为我们提供了比引用源数据更大的性能改进。

一旦我们积累了足够多的已保存分析结果，这种方法就开始失效——在我们添加更强大的归档/清理功能之前，我们的测试数据库已攀升至数*百万*张表。但是，即使在生产中，拥有超过 100,000 张桌子对我们来说也不是一件容易的事。Microsoft 对 sysobjects 的大小（约 20 亿个）设置了一个非常巨大的理论限制，但是一旦我们的数据库增长到超过 100,000 个左右，像 CREATE TABLE 和 DROP TABLE 这样的简单查询就会显着减慢。

我们有一些空间来讨论我们的方法，但我认为如果没有更多上下文，这可能很难做到，所以我想更笼统地问这个问题：如果我们被迫创建这么多表，管理的最佳方法是什么他们？多个文件组？多个模式/所有者？多个数据库？

另一个注意事项：我对“简单地解决问题”（即增加 RAM、CPU 功率、磁盘速度）的想法并不感到兴奋。但我们也不排除它，特别是如果（例如）有人可以明确地告诉我们添加 RAM 或使用多个文件组将对管理大型系统目录产生什么影响。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T00:00:48.663

在没有首先查看整个系统的情况下，我的第一个建议是将历史运行保存在组合表中，其中 RunID 作为键的一部分 - 维度模型也可能与此处相关。该表可以分区以进行改进，这也将允许您将表分散到其他文件组中。

另一种可能性是将每次运行放在自己的数据库中，然后将它们分离，仅根据需要附加它们（并且以只读形式）

CREATE TABLE 和 DROP TABLE 可能表现不佳，因为主数据库或模型数据库没有针对这种行为进行优化。

我还建议与 Microsoft 讨论您选择的数据库设计。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T22:42:34.560

这些表都是不同的结构吗？如果它们是相同的结构，您可能会使用单个分区表。

如果它们是不同的结构，但只是同一组维度列的子集，您仍然可以将它们存储在同一个表的分区中，并且在不适用的列中使用空值。

如果这是分析（可能是衍生定价计算？），您可以将计算运行的结果转储到平面文件中，并通过从平面文件加载来重用您的计算。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:25:26.413

这似乎是您正在使用的一个非常有趣的问题/应用程序。我很想从事这样的工作。:)

你有一个非常大的问题表面积，这使得很难开始提供帮助。您的帖子中有几个解决方案参数不明显。例如，您计划将运行分析表保留多长时间？还有很多其他问题需要问。

您将需要认真的数据仓库和数据/表分区的组合。根据您要保留和存档的数据量，您可能需要开始对表格进行反规范化和展平。

这将是一个很好的案例，直接联系 Microsoft 可以互惠互利。Microsoft 获得了一个向其他客户展示的好案例，并且您可以直接从供应商那里获得帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-17T16:42:13.197

我们最终将数据库拆分为多个数据库。所以主数据库包含一个“数据库”表，它引用一个或多个“运行”数据库，每个数据库都包含不同的分析结果集。然后主“运行”表包含一个数据库 ID，检索保存结果的代码包括所有查询的相关数据库前缀。

这种方法使每个数据库的系统目录更加合理，它提供了核心/永久表和动态/运行表之间更好的分离，并且它也使备份和归档更易于管理。它还允许我们将数据拆分到多个物理磁盘上，尽管使用多个文件组也可以做到这一点。总体而言，鉴于我们目前的要求，它现在对我们来说运行良好，并且基于预期的增长，我们认为它也将适用于我们。

我们还注意到，SQL 2008 倾向于比 SQL 2000 和 SQL 2005 更好地处理大型系统目录。（当我发布这个问题时，我们还没有升级到 2008 年。）

# php - Mysql导致PHP - 数组或对象？

> ID：124240
> 
> 赞同：28
> 
> 时间：2008-09-23T22:10:15.857
> 
> 标签：php, mysql, arrays, object

一段时间以来一直在使用**PHP/MySQL**`mysql_fetch_object()` ，我想知道使用vs `mysql_fetch_assoc()`/是否有任何特定的优势（性能或其他方面） `mysql_fetch_array()`。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-23T22:25:46.817

性能方面，您使用什么并不重要。不同之处在于 mysql_fetch_object 返回对象：

```
while ($row = mysql_fetch_object($result)) {
    echo $row->user_id;
    echo $row->fullname;
} 
```

mysql_fetch_assoc() 返回关联数组：

```
while ($row = mysql_fetch_assoc($result)) {
    echo $row["userid"];
    echo $row["fullname"];
} 
```

和 mysql_fetch_array() 返回数组：

```
while ($row = mysql_fetch_array($result)) {
    echo $row[0];
    echo $row[1] ;
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-08-11T21:26:08.450

`mysql_fetch_array`使您的代码难以阅读=维护噩梦。您无法一目了然地看到您的对象正在处理哪些数据。它稍微快一点，但如果这对您很重要，您正在处理大量数据，PHP 可能不是正确的方法。

`mysql_fetch_object`有一些缺点，特别是如果你基于它的数据库层。

*   列名可能不是有效的 PHP 标识符，例如，`tax-allowance`或者`user.id`如果您的数据库驱动程序为您提供了查询中指定的列名。然后你必须开始`{}`到处使用。

*   如果你想根据它的名字来获取一个列，在一些变量中，你还必须开始使用变量属性`$row->{$column_name}`，而数组语法`$row[$column_name]`

*   如果您指定类名，则不会调用构造函数。

*   如果你不指定类名，你会得到一个`stdClass`，这并不比数组好。

`mysql_fetch_assoc`是三者中最容易使用的，我喜欢这在对象和数据库结果行之间的代码中给出的区别......

```
$object->property=$row['column1'];
$object->property=$row[$column_name];
foreach($row as $column_name=>$column_value){...} 
```

虽然许多 OOP 粉丝（我也是 OOP 粉丝）喜欢将*所有内容都*转换为对象的想法，但我认为关联数组是数据库中行的更好模型，而不是对象，因为在我看来，对象是一组属性以及对其采取行动的方法，而该行只是数据，应该这样处理，而不需要进一步复杂化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-27T10:48:08.863

需要记住的一点是：数组可以很容易地添加到内存缓存中（eaccelerator、XCache、..），而对象则不能（它们需要在存储时序列化并在每次检索时反序列化！）。

当您想要添加内存缓存支持时，您可以切换到使用数组而不是对象 - 但到那时您可能已经更改了很多代码，这些代码使用以前使用的对象类型返回值。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T22:15:28.807

获取一个数组`mysql_fetch_array()`让您可以通过 foreach 循环或 for 循环遍历结果集。`mysql_fetch_object()`不能被 for 循环遍历。

不确定这是否重要，只是想我会提到它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-28T10:47:04.353

此外，如果您最终希望将 Memcaching 应用于您的 MySQL 结果，您可能需要选择数组。似乎存储数组类型比存储对象类型结果更安全。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T22:21:27.577

```
while ($Row = mysql_fetch_object($rs)) {
    // ...do stuff...
} 
```

……我一直都是这样做的。我更喜欢使用对象而不是数组来收集数据，因为它可以更好地组织数据，而且我知道我尝试向对象添加任意属性的可能性要小于尝试添加索引的可能性到一个数组（在我使用 PHP 的前几年，我认为你不能只为一个对象分配任意属性，所以不这样做是根深蒂固的）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T22:42:58.897

速度方面，`mysql_fetch_object()`与 相同`mysql_fetch_array()`，并且几乎与 一样快`mysql_fetch_row()`。

此外，`mysql_fetch_object()`您将只能通过相应的字段名称访问字段数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T22:17:12.577

我认为所有这些功能之间的差异微不足道，尤其是与代码可读性相比。

如果您担心这种优化，请使用`mysql_fetch_row()`. 它是最快的，因为它不使用关联数组（例如 $row[2]），但是用它来破坏你的代码是最容易的。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-23T23:07:02.380

我投反对票`mysql_fetch_array()`

因为您返回了数字索引的列和列名，所以这会创建一个两倍大的数组。如果您不需要调试代码并查看其内容，那很好。但是对于我们其他人来说，调试变得更加困难，因为您必须以一种奇怪的格式处理两倍的数据。

我有时会遇到一个使用此功能的项目，然后当我调试时，我认为出现了严重错误，因为我的数据中混合了数字列。

所以以理智的名义，请不要使用此功能，它会使代码维护更加困难

# asp.net - 标准的 asp.net 验证器是否与 Ajax 和更新面板一起使用？

> ID：124249
> 
> 赞同：1
> 
> 时间：2008-09-23T22:13:14.820
> 
> 标签：asp.net, validation

从后面的代码中使用 Page.Validate() 时，我遇到了验证器未触发的问题（没有显示预期的错误消息）。验证器放置在 Ajax 更新面板中。

似乎有可下载的 Ajax 版本的验证器。我不确定我是否需要这些，或者 VS 2008 SP1 是否已经拥有它们。当通过按钮发布表单时，验证器会工作，但当我按需执行 Page.Validate() 时它们不会。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T23:05:03.180

是的，验证器确实在 UpdatePanel 中工作，但您至少需要使用 ASP.NET 2.0 的 SP1。如果您使用 SP1，则不需要也不应该使用验证器的“ajax 版本”。

有关此主题的更多详细信息，请参见此处：

[StackOverflow：UpdatePanel 中的 ASP.NET 验证器](https://stackoverflow.com/questions/32814/aspnet-validators-inside-an-updatepanel#32996)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T23:10:04.370

我不想强制更新。在某些情况下，我想在用户更改某些表单元素的值时验证某些表单元素。当我的用户更改说单选按钮或下拉列表时，会发生自动回发。当回发发生时，我希望验证控件像我点击提交按钮一样触发。

这些导致回发的控件已打开“原因验证”。另一个测试是在导致回发的控件的事件处理程序中，我有一个 Page.Validate()。

问题是为什么按钮回发会触发验证，而不是另一个导致回发的控件？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T23:24:22.510

也许我们可以从顶部拿走它。你能回答这些吗？

*   您使用的是 .NET 2.0 SP1 或更高版本吗？
*   您的验证器控件是在 UpdatePanel 内部还是外部？
*   您是否在禁用 javascript 的情况下使用您的网站（不太可能）？

请注意，您的验证器**必须**位于更新后的 UpdatePanel 中，以便它们显示错误消息。如果它们不在更新的 UpdatePanel 中，则验证器无法更改它们在浏览器上的外观。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T04:43:23.750

我最终使用了一个自定义验证器，并在后面的代码中进行了自己的验证，并设置了自定义验证器的错误消息。这样我就有了更大的灵活性并且它奏效了。使用 Ajax，感觉就像是客户端验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T22:21:44.703

您是否在更新面板上调用了更新？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T22:23:33.373

它们不久前被包含在 .Net 框架的更新中，所以是的，你在 VS2008 SP1 中有它们。我发现了一个问题，即 CustomValidators 的服务器端方法会触发两次而没有“邪恶”效果，但除此之外它们工作正常。

至于您遇到的具体问题，也许验证器不在更新面板内，或者其他面板最终被发布的任何控件刷新，而不是您想要的控件？或者甚至在某个地方定义了一些 ValidationGroups 并且只有这些最终被验证？不看代码很难说。

但是确保显示您的验证器很容易：MyUpdatePanel.Update() 将强制刷新。

# ruby-on-rails - 如何滚动重启杂种集群

> ID：124250
> 
> 赞同：7
> 
> 时间：2008-09-23T22:13:17.050
> 
> 标签：ruby-on-rails, deployment, capistrano, mongrel

任何人都知道一种通过 capistrano 以“滚动”方式重新启动杂种集群的好方法，例如，一次一个杂种。如果每个人都有一点等待时间，让杂种也加载 rails 应用程序，那就太好了。

我已经进行了一些搜索，但没有找到太多，所以在我自己潜入 mongrel_cluster gem 之前寻求帮助。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T03:51:00.997

我更同意跷跷板的方法，而不是您正在寻求的滚动方法。问题是您最终会遇到负载平衡可能在您转换时让用户在应用程序的不同版本之间来回切换的情况。

我们提出的解决方案（在找到我们不使用的 SeeSaw 之前）是让一半的杂种从负载均衡器中脱机。关闭它们。更新它们。启动它们。让这些杂种在负载均衡器中重新联机，然后关闭另一半。关闭下半场。更新下半场。启动它们。这极大地减少了同时运行两个不同版本的应用程序的时间。我写了一个 Windows bat 文件来做到这一点。（不建议在 Windows 上部署，顺便说一句）

需要注意的是，进行数据库迁移会使整个方法有点危险，这一点非常重要。如果您只有附加迁移，您可以在部署之前的任何时间运行这些迁移。如果要删除列，则需要在部署后执行。如果要重命名列，最好将其拆分为创建新列并将数据复制到其中迁移以在部署之前运行，并使用单独的脚本在部署后删除旧列。事实上，如果您没有特别努力地组织它们，通常在生产数据库上使用常规迁移可能很危险。所有这些都指向更频繁的交付，因此每次更新的风险和复杂性都更低，但这是另一个回应的主题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T01:50:04.640

Seesaw 是[Rails Oceania Rubyforge 项目](http://rubyforge.org/projects/rails-oceania/)中的一个 gem ，它为 mongrel 集群提供了这种功能。但是，该项目可能会遭受一些自 2007 年以来没有发布过的比特腐烂。即使只是为了扼杀想法，仍然值得一看 :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T01:54:02.977

```
#!/bin/bash
for PIDFILE in /tmp/mongrel.*; do
  PID=$(cat ${PIDFILE})
  kill ${PID}
  ${RUN_MONGREL_CMD} ${PID}
  sleep 2
done 
```

# visual-studio-2008 - Visual Studio 2008 文档

> ID：124254
> 
> 赞同：2
> 
> 时间：2008-09-23T22:14:10.853
> 
> 标签：visual-studio-2008

我已经为 Visual Studio 2008 SP1 安装了 MSDN 库，但是，Visual Studio 中的动态帮助仍然会生成 RTM 文档资源管理器。有人知道如何将其更改为 SP1 版本吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T00:08:17.397

有时您会看到其他人在同样的事情上苦苦挣扎，这很快就会提醒您并不孤单。

所以这是你必须做的：

1.  使用**regedit.exe**打开**注册表编辑器**
***   导航到`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Help\0x0409`- 0x0409 用于美国英语。*   `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Help\0x0409\Collection`是一种指向具有首选集合的子键的指针。*   检查哪些子项是您刚刚安装*的 Visual Studio 2008 SP1 的 MSDN 库的帮助集合**   复制您在步骤 4 中找到的子项名称。*   将 的值更新为`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\9.0\Help\0x0409\Collection`复制的子键的值。*   现在 Visual Studio 在使用动态帮助时会打开您刚刚安装的帮助集合。**

 ****注意：**您可能必须在执行这些步骤后重新启动 Visual Studio 才能使它们生效。

# asp.net - 您将如何允许用户在 Web 应用程序中编辑附件？

> ID：124258
> 
> 赞同：3
> 
> 时间：2008-09-23T22:14:53.957
> 
> 标签：asp.net, file

我们使用 ASP.NET 创建了一个 Web 应用程序，它允许用户上传文档并将它们附加到业务实体，如客户、联系人等。

该应用程序在 Intranet 上运行，所有文件都通过 Web 应用程序上传到服务器上的共享文件夹中。

我想直接从网页上让用户**打开**实际文件，对其进行**编辑**，然后**将更改保存**回原始位置。这在 Windows 环境中**是小菜一碟**，我只是想知道在 Web 环境中处理这个问题的最佳方法是什么（如果有的话）？

这些文件通常是 Word 文档、Excel 文档和图像。

**澄清**

我们将以列表格式显示所有附件。我们希望用户可以单击编辑链接并在适当的应用程序中打开文件，例如 Microsoft Word 或 Microsoft Excel。我认为 Windows 中的文件关联已经可以处理这个问题。我们只是想节省我们的用户下载原始文件、进行更改、删除旧文件和上传新文件的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T22:19:18.470

SharePoint 通过公开 Word 和 Excel 知道如何处理的 FrontPage 扩展来做到这一点。

如果您想查看 ASP.NET 的商业产品，该产品允许您使用 AJAX 编辑图像（无需安装软件），我在一家拥有 AJAX 的公司工作（[Atalasoft](http://atalasoft.com)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T22:19:53.163

WebDAV 可能是您想要的。（自由）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T13:09:01.327

我正在尝试使用 file:// 而不是 http:// 来做一些事情，但基于浏览器它确实是零星的。似乎在 IE 中可以正常工作，在 Firefox 中还可以，在 Chrome 中无济于事。

看起来我可能只是被下载、编辑和重新上传文档所困。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-19T01:12:52.120

如果您的所有客户端计算机都是 Windows，请将服务器上的共享文件夹映射到每个客户端上的相同驱动器号并使用 file:// 格式。

假设您将 \ServerName\ShareName 共享给 H: 在每个客户端的计算机上，您可以将链接设为 file://h:\pat_to_the_file_under_your_share\fileName.doc

如果不是客户的每一台计算机都在 Windows 中，那么您可以尝试如下创建链接（不确定是否有效）：

file://\ServerName\ShareName\pat_to_the_file_under_your_share\fileName.doc

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T01:35:55.223

听起来您想要类似 eRoom 的东西，其中浏览器与一个组件一起工作，该组件拦截来自 http 的流，将其存储在临时文件夹中，然后启动 Word 或 Excel 并允许您编辑流。

您可能必须创建一个组件来干预并创建文件的临时本地副本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T19:26:49.117

该工具应该可以满足您的需求。

[http://www.dlitools.com/dlitools/dlitoolsHome.nsf/0FA6B8B31F831F468525736B0001C606/4BBD7E8684EA8DB78525754E006C63A3?OpenDocument](http://www.dlitools.com/dlitools/dlitoolsHome.nsf/0FA6B8B31F831F468525736B0001C606/4BBD7E8684EA8DB78525754E006C63A3?OpenDocument)

# php - PHP中的对象排序

> ID：124266
> 
> 赞同：44
> 
> 时间：2008-09-23T22:16:45.717
> 
> 标签：php, arrays, sorting

什么是在 PHP 中对对象进行排序的优雅方法？我很想完成类似的事情。

```
$sortedObjectArary = sort($unsortedObjectArray, $Object->weight); 
```

基本上指定我想要排序的数组以及我想要排序的字段。我研究了多维数组排序，那里可能有一些有用的东西，但我没有看到任何优雅或明显的东西。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-23T22:20:54.770

手册中几乎逐字记录：

```
function compare_weights($a, $b) { 
    if($a->weight == $b->weight) {
        return 0;
    } 
    return ($a->weight < $b->weight) ? -1 : 1;
} 

usort($unsortedObjectArray, 'compare_weights'); 
```

如果您希望对象能够自行排序，请参见此处的示例 3：http: [//php.net/usort](http://php.net/usort)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-08-24T00:07:27.230

对于 php >= 5.3

```
function osort(&$array, $prop)
{
    usort($array, function($a, $b) use ($prop) {
        return $a->$prop > $b->$prop ? 1 : -1;
    }); 
} 
```

请注意，这使用匿名函数/闭包。可能会发现查看 php 文档很有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T23:01:14.000

如果您想要那种级别的控制，您甚至可以将排序行为构建到您正在排序的类中

```
class thingy
{
    public $prop1;
    public $prop2;

    static $sortKey;

    public function __construct( $prop1, $prop2 )
    {
        $this->prop1 = $prop1;
        $this->prop2 = $prop2;
    }

    public static function sorter( $a, $b )
    {
        return strcasecmp( $a->{self::$sortKey}, $b->{self::$sortKey} );
    }

    public static function sortByProp( &$collection, $prop )
    {
        self::$sortKey = $prop;
        usort( $collection, array( __CLASS__, 'sorter' ) );
    }

}

$thingies = array(
        new thingy( 'red', 'blue' )
    ,   new thingy( 'apple', 'orange' )
    ,   new thingy( 'black', 'white' )
    ,   new thingy( 'democrat', 'republican' )
);

print_r( $thingies );

thingy::sortByProp( $thingies, 'prop1' );

print_r( $thingies );

thingy::sortByProp( $thingies, 'prop2' );

print_r( $thingies ); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-01-05T20:13:45.107

对于该比较功能，您可以这样做：

```
function cmp( $a, $b )
{ 
    return $b->weight - $a->weight;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T22:22:03.207

usort 函数 ( [http://uk.php.net/manual/en/function.usort.php](http://uk.php.net/manual/en/function.usort.php) ) 是你的朋友。就像是...

```
function objectWeightSort($lhs, $rhs)
{
   if ($lhs->weight == $rhs->weight)
     return 0;

   if ($lhs->weight > $rhs->weight)
     return 1;

   return -1;
}

usort($unsortedObjectArray, "objectWeightSort"); 
```

请注意，任何数组键都将丢失。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T22:22:31.193

您可以使用[usort()](http://php.net/usort)函数并制作自己的比较函数。

```
$sortedObjectArray = usort($unsortedObjectArray, 'sort_by_weight');

function sort_by_weight($a, $b) {
    if ($a->weight == $b->weight) {
        return 0;
    } else if ($a->weight < $b->weight) {
        return -1;
    } else {
        return 1;
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2022-02-20T16:41:50.740

从 2022 年开始更新 - 对对象数组进行排序：

```
usort($array, fn(object $a, object $b): int => $a->weight <=> $b->weight); 
```

完整示例：

```
$array = [
    (object) ['weight' =>  5],
    (object) ['weight' => 10],
    (object) ['weight' =>  1],
];

usort($array, fn(object $a, object $b): int => $a->weight <=> $b->weight);
// Now, $array is sorted by objects' weight.

// display example :
echo json_encode($array); 
```

输出：

```
[{"weight":1},{"weight":5},{"weight":10}] 
```

文档链接：

*   [排序](https://php.net/usort)
*   [飞船操作员](https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.spaceship-op)(PHP 7.0)
*   [标量类型声明](https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.scalar-type-declarations)(PHP 7.0)
*   [返回类型声明](https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.return-type-declarations)(PHP 7.0)
*   [箭头函数](https://www.php.net/manual/en/functions.arrow.php)(PHP 7.4)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T02:22:58.680

根据您尝试解决的问题，您可能还会发现 SPL 接口很有用。例如，实现 ArrayAccess 接口将允许您像访问数组一样访问您的类。此外，实现 SeekableIterator 接口可以让您像数组一样循环遍历对象。通过这种方式，您可以对对象进行排序，就好像它是一个简单的数组一样，可以完全控制它为给定键返回的值。

更多细节：

*   [Zend 文章](http://devzone.zend.com/article/2565-The-Standard-PHP-Library-SPL)
*   [PHPriot 文章](http://www.phpriot.com/articles/oop-with-spl-php-5/2)
*   [PHP 手册](http://us2.php.net/manual/en/book.spl.php)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-12T00:26:53.893

```
function PHPArrayObjectSorter($array,$sortBy,$direction='asc')
{
    $sortedArray=array();
    $tmpArray=array();
    foreach($this->$array as $obj)
    {
        $tmpArray[]=$obj->$sortBy;
    }
    if($direction=='asc'){
        asort($tmpArray);
    }else{
        arsort($tmpArray);
    }

    foreach($tmpArray as $k=>$tmp){
        $sortedArray[]=$array[$k];
    }

    return $sortedArray;

} 
```

例如 =>

```
$myAscSortedArrayObject=PHPArrayObjectSorter($unsortedarray,$totalMarks,'asc');

$myDescSortedArrayObject=PHPArrayObjectSorter($unsortedarray,$totalMarks,'desc'); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-02-24T20:42:42.960

[您可以使用Nspl中的](https://github.com/ihor/Nspl)[sorted](https://github.com/ihor/Nspl#sortedsequence-reversed--false-key--null-cmp--null)函数发布几乎相同的代码：

```
use function \nspl\a\sorted;
use function \nspl\op\propertyGetter;
use function \nspl\op\methodCaller;

// Sort by property value
$sortedByWeight = sorted($objects, propertyGetter('weight'));

// Or sort by result of method call
$sortedByWeight = sorted($objects, methodCaller('getWeight')); 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2008-09-23T22:27:34.050

如果您想探索 PHP 中 lambda 样式函数的完整（可怕）范围，请参阅： [http ://docs.php.net/manual/en/function.create-function.php](http://docs.php.net/manual/en/function.create-function.php)

# javascript - 最简单的 SOAP 示例

> ID：124269
> 
> 赞同：255
> 
> 时间：2008-09-23T22:17:03.513
> 
> 标签：javascript, soap

使用 Javascript 的最简单的 SOAP 示例是什么？

为了尽可能有用，答案应该：

*   具有功能性（换句话说，实际工作）
*   发送至少一个可以在代码中其他地方设置的参数
*   处理至少一个可以在代码中其他地方读取的结果值
*   使用大多数现代浏览器版本
*   在不使用外部库的情况下尽可能清晰和简短

* * *

## 回答 #1

> 赞同：215
> 
> 时间：2012-07-09T22:30:04.920

这是我可以创建的最简单的 JavaScript SOAP 客户端。

```
<html>
<head>
    <title>SOAP JavaScript Client Test</title>
    <script type="text/javascript">
        function soap() {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.open('POST', 'https://somesoapurl.com/', true);

            // build SOAP request
            var sr =
                '<?xml version="1.0" encoding="utf-8"?>' +
                '<soapenv:Envelope ' + 
                    'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ' +
                    'xmlns:api="http://127.0.0.1/Integrics/Enswitch/API" ' +
                    'xmlns:xsd="http://www.w3.org/2001/XMLSchema" ' +
                    'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">' +
                    '<soapenv:Body>' +
                        '<api:some_api_call soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">' +
                            '<username xsi:type="xsd:string">login_username</username>' +
                            '<password xsi:type="xsd:string">password</password>' +
                        '</api:some_api_call>' +
                    '</soapenv:Body>' +
                '</soapenv:Envelope>';

            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4) {
                    if (xmlhttp.status == 200) {
                        alert(xmlhttp.responseText);
                        // alert('done. use firebug/console to see network response');
                    }
                }
            }
            // Send the POST request
            xmlhttp.setRequestHeader('Content-Type', 'text/xml');
            xmlhttp.send(sr);
            // send request
            // ...
        }
    </script>
</head>
<body>
    <form name="Demo" action="" method="post">
        <div>
            <input type="button" value="Soap" onclick="soap();" />
        </div>
    </form>
</body>
</html> <!-- typo --> 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-11-08T04:46:36.763

浏览器处理 XMLHttpRequest 的方式有很多怪癖，这个 JS 代码将适用于所有浏览器：
[https ://github.com/ilinsky/xmlhttprequest](https://github.com/ilinsky/xmlhttprequest)

此 JS 代码将 XML 转换为易于使用的 JavaScript 对象：
[http ://www.terracoder.com/index.php/xml-objectifier](http://www.terracoder.com/index.php/xml-objectifier)

上面的 JS 代码可以包含在页面中，以满足您无外部库的要求。

```
var symbol = "MSFT"; 
var xmlhttp = new XMLHttpRequest();
xmlhttp.open("POST", "http://www.webservicex.net/stockquote.asmx?op=GetQuote",true);
xmlhttp.onreadystatechange=function() {
 if (xmlhttp.readyState == 4) {
  alert(xmlhttp.responseText);
  // http://www.terracoder.com convert XML to JSON 
  var json = XMLObjectifier.xmlToJSON(xmlhttp.responseXML);
  var result = json.Body[0].GetQuoteResponse[0].GetQuoteResult[0].Text;
  // Result text is escaped XML string, convert string to XML object then convert to JSON object
  json = XMLObjectifier.xmlToJSON(XMLObjectifier.textToXML(result));
  alert(symbol + ' Stock Quote: $' + json.Stock[0].Last[0].Text); 
 }
}
xmlhttp.setRequestHeader("SOAPAction", "http://www.webserviceX.NET/GetQuote");
xmlhttp.setRequestHeader("Content-Type", "text/xml");
var xml = '<?xml version="1.0" encoding="utf-8"?>' +
 '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ' +
                'xmlns:xsd="http://www.w3.org/2001/XMLSchema" ' +
                'xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' + 
   '<soap:Body> ' +
     '<GetQuote xmlns="http://www.webserviceX.NET/"> ' +
       '<symbol>' + symbol + '</symbol> ' +
     '</GetQuote> ' +
   '</soap:Body> ' +
 '</soap:Envelope>';
xmlhttp.send(xml);
// ...Include Google and Terracoder JS code here... 
```

另外两个选项：

*   JavaScript SOAP 客户端：
    [http ://www.guru4.net/articoli/javascript-soap-client/en/](http://www.guru4.net/articoli/javascript-soap-client/en/)

*   从 WSDL 生成 JavaScript：
    [https ://cwiki.apache.org/confluence/display/CXF20DOC/WSDL+to+Javascript](https://cwiki.apache.org/confluence/display/CXF20DOC/WSDL+to+Javascript)

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-09-24T02:22:22.270

**~~除非 Web 服务与您的页面位于同一域中，否则无法使用直接的 JavaScript 来完成此操作。~~编辑：在 2008 年和 IE<10 中，这不能使用直接的 javascript 来完成，除非该服务与您的页面位于同一域中。**

如果 Web 服务在另一个域上[并且您必须支持 IE<10]，那么您将必须在您自己的域上使用代理页面来检索结果并将其返回给您。如果您不需要旧的 IE 支持，那么您需要将 CORS 支持添加到您的服务中。无论哪种情况，您都应该使用 timyates 建议的 lib 之类的东西，因为您不想自己解析结果。

如果 Web 服务在您自己的域中，则不要使用 SOAP。没有充分的理由这样做。如果 Web 服务位于您自己的域中，则对其进行修改，以便它可以返回 JSON，从而省去处理 SOAP 带来的所有麻烦的麻烦。

简短的回答是：不要从 javascript 发出 SOAP 请求。使用 Web 服务从另一个域请求数据，如果这样做，则在服务器端解析结果并以 js 友好的形式返回它们。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2014-11-13T20:05:37.337

您可以使用[jquery.soap 插件](https://github.com/doedje/jquery.soap)为您完成工作。

> 此脚本使用 $.ajax 发送 SOAPEnvelope。它可以将 XML DOM、XML 字符串或 JSON 作为输入，并且响应也可以作为 XML DOM、XML 字符串或 JSON 返回。

来自网站的示例用法：

```
$.soap({
    url: 'http://my.server.com/soapservices/',
    method: 'helloWorld',

    data: {
        name: 'Remy Blom',
        msg: 'Hi!'
    },

    success: function (soapResponse) {
        // do stuff with soapResponse
        // if you want to have the response as JSON use soapResponse.toJSON();
        // or soapResponse.toString() to get XML string
        // or soapResponse.toXML() to get XML DOM
    },
    error: function (SOAPResponse) {
        // show error
    }
}); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-09-23T19:07:46.840

有没有人试过这个？[https://github.com/doedje/jquery.soap](https://github.com/doedje/jquery.soap)

看起来很容易实现。

例子：

```
$.soap({
url: 'http://my.server.com/soapservices/',
method: 'helloWorld',

data: {
    name: 'Remy Blom',
    msg: 'Hi!'
},

success: function (soapResponse) {
    // do stuff with soapResponse
    // if you want to have the response as JSON use soapResponse.toJSON();
    // or soapResponse.toString() to get XML string
    // or soapResponse.toXML() to get XML DOM
},
error: function (SOAPResponse) {
    // show error
}
}); 
```

将导致

```
<soap:Envelope
xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
  <soap:Body>
    <helloWorld>
        <name>Remy Blom</name>
        <msg>Hi!</msg>
    </helloWorld>
  </soap:Body>
</soap:Envelope> 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-10-26T14:11:16.467

托马斯：

JSON 是前端使用的首选，因为我们可以轻松查找。因此，您无需处理 XML。因此，如果不使用库，SOAP 会很痛苦。有人提到 SOAPClient，这是一个很好的库，我们从它开始用于我们的项目。然而它有一些限制，我们不得不重写它的大部分。它已作为[SOAPjs](http://sourceforge.net/projects/soapjs/)发布，支持将复杂对象传递到服务器，并包含一些示例代理代码以使用来自其他域的服务。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-09-17T20:06:20.577

[使用 JavaScript 轻松使用 SOAP Web 服务](http://www.techrepublic.com/article/easily-consume-soap-web-services-with-javascript/58/)->[清单 B](http://www.techrepublic.com/html/tr/sidebars/5887775-1.html)

```
function fncAddTwoIntegers(a, b)
{
    varoXmlHttp = new XMLHttpRequest();
    oXmlHttp.open("POST",
 "http://localhost/Develop.NET/Home.Develop.WebServices/SimpleService.asmx'",
 false);
    oXmlHttp.setRequestHeader("Content-Type", "text/xml");
    oXmlHttp.setRequestHeader("SOAPAction", "http://tempuri.org/AddTwoIntegers");
    oXmlHttp.send(" \
<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' \
xmlns:xsd='http://www.w3.org/2001/XMLSchema' \
 xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'> \
  <soap:Body> \
    <AddTwoIntegers xmlns='http://tempuri.org/'> \
      <IntegerOne>" + a + "</IntegerOne> \
      <IntegerTwo>" + b + "</IntegerTwo> \
    </AddTwoIntegers> \
  </soap:Body> \
</soap:Envelope> \
");
    return oXmlHttp.responseXML.selectSingleNode("//AddTwoIntegersResult").text;
} 
```

这可能无法满足您的所有要求，但它是实际回答您问题的开始。（我将*XMLHttpRequest()*切换为*ActiveXObject("MSXML2.XMLHTTP")*）。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-05-11T09:43:36.890

```
<html>
 <head>
    <title>Calling Web Service from jQuery</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#btnCallWebService").click(function (event) {
                var wsUrl = "http://abc.com/services/soap/server1.php";
                var soapRequest ='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">   <soap:Body> <getQuote xmlns:impl="http://abc.com/services/soap/server1.php">  <symbol>' + $("#txtName").val() + '</symbol>   </getQuote> </soap:Body></soap:Envelope>';
                               alert(soapRequest)
                $.ajax({
                    type: "POST",
                    url: wsUrl,
                    contentType: "text/xml",
                    dataType: "xml",
                    data: soapRequest,
                    success: processSuccess,
                    error: processError
                });

            });
        });

        function processSuccess(data, status, req) { alert('success');
            if (status == "success")
                $("#response").text($(req.responseXML).find("Result").text());

                alert(req.responseXML);
        }

        function processError(data, status, req) {
        alert('err'+data.state);
            //alert(req.responseText + " " + status);
        } 

    </script>
</head>
<body>
    <h3>
        Calling Web Services with jQuery/AJAX
    </h3>
    Enter your name:
    <input id="txtName" type="text" />
    <input id="btnCallWebService" value="Call web service" type="button" />
    <div id="response" ></div>
</body>
</html> 
```

听听最好的 JavaScript with SOAP 教程和示例。

[http://www.codeproject.com/Articles/12816/JavaScript-SOAP-Client](http://www.codeproject.com/Articles/12816/JavaScript-SOAP-Client)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-02-04T21:55:00.813

一些很好的例子（和一个现成的 JavaScript SOAP 客户端！）在这里： http: [//plugins.jquery.com/soap/](http://plugins.jquery.com/soap/)

检查自述文件，并注意同源浏览器限制。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-04-04T10:20:37.337

问题是“使用 Javascript 的最简单的 SOAP 示例是什么？”

这个答案是[Node.js](https://nodejs.org/en/)环境中的一个示例，而不是浏览器。（让我们将脚本命名为soap-node.js）我们将以[欧洲PMC的公共SOAP Web服务](http://europepmc.org/SoapWebServices)为例来获取一篇文章的参考列表。

```
const XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;
const DOMParser = require('xmldom').DOMParser;

function parseXml(text) {
    let parser = new DOMParser();
    let xmlDoc = parser.parseFromString(text, "text/xml");
    Array.from(xmlDoc.getElementsByTagName("reference")).forEach(function (item) {
        console.log('Title: ', item.childNodes[3].childNodes[0].nodeValue);
    });

}

function soapRequest(url, payload) {
    let xmlhttp = new XMLHttpRequest();
    xmlhttp.open('POST', url, true);

    // build SOAP request
    xmlhttp.onreadystatechange = function () {
        if (xmlhttp.readyState == 4) {
            if (xmlhttp.status == 200) {
                parseXml(xmlhttp.responseText);
            }
        }
    }

    // Send the POST request
    xmlhttp.setRequestHeader('Content-Type', 'text/xml');
    xmlhttp.send(payload);
}

soapRequest('https://www.ebi.ac.uk/europepmc/webservices/soap', 
    `<?xml version="1.0" encoding="UTF-8"?>
    <S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
    <S:Header />
    <S:Body>
        <ns4:getReferences xmlns:ns4="http://webservice.cdb.ebi.ac.uk/"
            xmlns:ns2="http://www.scholix.org"
            xmlns:ns3="https://www.europepmc.org/data">
            <id>C7886</id>
            <source>CTX</source>
            <offSet>0</offSet>
            <pageSize>25</pageSize>
            <email>ukpmc-phase3-wp2b---do-not-reply@europepmc.org</email>
        </ns4:getReferences>
    </S:Body>
    </S:Envelope>`); 
```

在运行代码之前，需要安装两个包：

```
npm install xmlhttprequest
npm install xmldom 
```

现在您可以运行代码：

```
node soap-node.js 
```

您将看到如下输出：

```
Title:  Perspective: Sustaining the big-data ecosystem.
Title:  Making proteomics data accessible and reusable: current state of proteomics databases and repositories.
Title:  ProteomeXchange provides globally coordinated proteomics data submission and dissemination.
Title:  Toward effective software solutions for big biology.
Title:  The NIH Big Data to Knowledge (BD2K) initiative.
Title:  Database resources of the National Center for Biotechnology Information.
Title:  Europe PMC: a full-text literature database for the life sciences and platform for innovation.
Title:  Bio-ontologies-fast and furious.
Title:  BioPortal: ontologies and integrated data resources at the click of a mouse.
Title:  PubMed related articles: a probabilistic topic-based model for content similarity.
Title:  High-Impact Articles-Citations, Downloads, and Altmetric Score. 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-24T00:09:18.207

最简单的示例包括：

1.  获取用户输入。
2.  编写与此类似的 XML SOAP 消息

    ```
    <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                   xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
      <soap:Body>
        <GetInfoByZIP xmlns="http://www.webserviceX.NET">
          <USZip>string</USZip>
        </GetInfoByZIP>
      </soap:Body>
    </soap:Envelope> 
    ```

3.  使用 XHR 将消息发布到 Web 服务 url

4.  解析 webservice 的 XML SOAP 响应与此类似

    ```
    <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns:xsd="http://www.w3.org/2001/XMLSchema">
     <soap:Body>
      <GetInfoByZIPResponse xmlns="http://www.webserviceX.NET">
       <GetInfoByZIPResult>
        <NewDataSet xmlns="">
         <Table>
          <CITY>...</CITY>
          <STATE>...</STATE>
          <ZIP>...</ZIP>
          <AREA_CODE>...</AREA_CODE>
          <TIME_ZONE>...</TIME_ZONE>
         </Table>
        </NewDataSet>
       </GetInfoByZIPResult>
      </GetInfoByZIPResponse>
     </soap:Body>
    </soap:Envelope> 
    ```

5.  向用户展示结果。

但是没有外部 JavaScript 库会很麻烦。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-17T08:06:15.777

```
function SoapQuery(){
  var namespace = "http://tempuri.org/";
  var site = "http://server.com/Service.asmx";
  var xmlhttp = new ActiveXObject("Msxml2.ServerXMLHTTP.6.0");
  xmlhttp.setOption(2,  13056 );  /* if use standard proxy */
  var args,fname =  arguments.callee.caller.toString().match(/ ([^\(]+)/)[1]; /*Имя вызвавшей ф-ции*/
  try { args =   arguments.callee.caller.arguments.callee.toString().match(/\(([^\)]+)/)[1].split(",");  
    } catch (e) { args = Array();};
  xmlhttp.open('POST',site,true);  
  var i, ret = "", q = '<?xml version="1.0" encoding="utf-8"?>'+
   '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+
   '<soap:Body><'+fname+ ' xmlns="'+namespace+'">';
  for (i=0;i<args.length;i++) q += "<" + args[i] + ">" + arguments.callee.caller.arguments[i] +  "</" + args[i] + ">";
  q +=   '</'+fname+'></soap:Body></soap:Envelope>';
            // Send the POST request
            xmlhttp.setRequestHeader("MessageType","CALL");
            xmlhttp.setRequestHeader("SOAPAction",namespace + fname);
            xmlhttp.setRequestHeader('Content-Type', 'text/xml');
            //WScript.Echo("Запрос XML:" + q);
            xmlhttp.send(q);
     if  (xmlhttp.waitForResponse(5000)) ret = xmlhttp.responseText;
    return ret;
  };

function GetForm(prefix,post_vars){return SoapQuery();};
function SendOrder2(guid,order,fio,phone,mail){return SoapQuery();};

function SendOrder(guid,post_vars){return SoapQuery();}; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-08-22T07:00:41.477

Angularjs $http 包装基于[XMLHttpRequest](https://docs.angularjs.org/api/ng/service/$http)。只要在标题内容设置下面的代码就可以了。

```
"Content-Type": "text/xml; charset=utf-8" 
```

例如：

```
function callSoap(){
var url = "http://www.webservicex.com/stockquote.asmx";
var soapXml = "<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:web=\"http://www.webserviceX.NET/\"> "+
         "<soapenv:Header/> "+
         "<soapenv:Body> "+
         "<web:GetQuote> "+
         "<web:symbol></web:symbol> "+
         "</web:GetQuote> "+
         "</soapenv:Body> "+
         "</soapenv:Envelope> ";

    return $http({
          url: url,  
          method: "POST",  
          data: soapXml,  
          headers: {  
              "Content-Type": "text/xml; charset=utf-8"
          }  
      })
      .then(callSoapComplete)
      .catch(function(message){
         return message;
      });

    function callSoapComplete(data, status, headers, config) {
        // Convert to JSON Ojbect from xml
        // var x2js = new X2JS();
        // var str2json = x2js.xml_str2json(data.data);
        // return str2json;
        return data.data;

    }

} 
```

# ruby-on-rails - 有谁知道 Ruby On Rails 的任何跨平台 GUI 日志查看器？

> ID：124275
> 
> 赞同：10
> 
> 时间：2008-09-23T22:19:43.883
> 
> 标签：ruby-on-rails, ruby, user-interface, logging

我厌倦了使用：

```
tail -f development.log 
```

跟踪我的 Rails 日志。相反，我想要在网格中显示信息并允许我对每个日志消息进行排序、过滤和查看堆栈跟踪的东西。

有谁知道用于显示 Rails 日志的 GUI 工具。理想情况下，我想要一个独立的应用程序（不是 Netbeans 或 Eclipse 中的东西）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T22:21:42.600

FWIW 我在 GitHub 上启动了[这个项目](http://github.com/SamSaffron/logviewer/tree/master)来尝试解决这个问题，它远非功能性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T07:47:16.203

Splunk，有一个限制为 500mb 的免费版本，但具有与完整版相同的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:23:21.190

您也许可以使用[http://logging.apache.org/chainsaw/index.html](http://logging.apache.org/chainsaw/index.html)。好久没用了，不过我觉得它的日志解析器应该是可配置的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T02:20:23.500

我喜欢将 Exception Logger 插件用于实时站点。我可以访问[http://domain.com/logged_exceptions](http://domain.com/logged_exceptions)并阅读所有在生产中抛出的未处理异常以及完整的堆栈跟踪。从那里开始，很容易编写测试来查找和纠正问题。[这里](http://railscasts.com/episodes/104)有一个关于这个话题的完整的 railscast 。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T05:47:34.533

几天前我问了同样的[问题，并得到了关于 Splunk、BareTail 和 tail [一直在使用 Chainsaw 直到现在] 的建议。](https://stackoverflow.com/questions/144807/java-log-viewer)

电锯对我来说不太好用。这是越野车和无响应。所以我研究了 Splunk，结果证明它对于查看日志来说是一个很大的过度杀伤力。尾巴对我来说似乎有点太原始了。因此，如果您使用的是 Windows，我会说 BareTail 是您最好的选择。

高温高压

# asp.net - 有没有办法在 WinForm/Console/VSTest 应用程序中使用 XmlSiteMapProvider？

> ID：124280
> 
> 赞同：3
> 
> 时间：2008-09-23T22:20:35.190
> 
> 标签：asp.net, unit-testing, navigation, sitemap, provider

我想知道是否有在非 asp.net 应用程序中使用标准 XmlSiteMapProvider 的解决方法，例如 WinForm/Console，或者在我的情况下是 VS Unit Test 应用程序。

以下代码失败，因为它无法`.sitemap`在私有`GetConfigDocument`方法中创建文件路径。

```
XmlSiteMapProvider provider = new XmlSiteMapProvider();
NameValueCollection providerAttributes = new NameValueCollection();
providerAttributes.Add("siteMapFile", "Web.sitemap");
provider.Initialize("XmlSiteMapReader", providerAttributes);
provider.BuildSiteMap(); 
```

我觉得正确的解决方案是编写另一个提供程序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T20:29:50.673

我不明白为什么不。它只是一个实现接口的提供者。您可能不需要很多功能，但您可以访问 API 以获取它为您提供的功能。您的 WinForms 屏幕可以简单地使用 Url 进行标识，以便您可以确定您在层次结构中的位置。

您可能需要做的是创建提供程序的自定义实现，因为它将使用 HttpContext 获取当前 Web 请求的 Url 以识别当前位置，而您需要以不同的方式获取该值。这可能会很棘手，因为您的 WinForm 应用程序可能会同时显示多个窗口。如果您知道一次只显示一个窗口，您可以使用在访问 SiteMap API 之前设置的静态值。

现在，如果您必须完成所有工作，您必须质疑使用 API 的价值。可能没有足够的好处使它值得。

# perl - worker MPM 下 mod_perl 中的进程内协调

> ID：124291
> 
> 赞同：3
> 
> 时间：2008-09-23T22:22:07.357
> 
> 标签：perl, multithreading, apache2, mutex

我需要在 mod_perl 中做一些简单的时区计算。DateTime 不是一个选项。我需要做的很容易通过设置 $ENV{TZ} 并使用 localtime 和 POSIX::mktime 来完成，但是在线程 MPM 下，我需要确保一次只有一个线程与环境混为一谈。（我不关心本地时间的其他用途等）

如何使用互斥锁或其他锁定策略来序列化（在非编组意义上）对环境的访问？我看过的[文档](http://perl.apache.org/docs/2.0/api/APR/ThreadMutex.html)没有很好地解释我将如何为这种用途创建互斥锁。也许我只是不了解您如何创建互斥锁。

更新：是的，我知道需要使用 Env::C 来设置 TZ。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T14:01:58.593

由于这个问题，mod_perl 2 实际上处理 %ENV 散列的方式与 mod_perl 1 不同。在 mod_perl 1 中，%ENV 直接绑定到 environ 结构，因此更改 %ENV 会改变环境。在 mod_perl 2 中，%ENV 哈希是从 environ 填充的，但不会传回更改。

这意味着您不能再使用 $ENV{TZ} 来调整时区——尤其是在线程环境中。[Apache2::Localtime](http://webkist.wordpress.com/2008/05/16/apache2localtime/)模块将使其适用于非线程情况（通过使用 Env::C），但在线程 MPM 中运行时，这将是一个坏消息。

mod_perl 源代码 (src/modules/perl/modperl_env.c) 中有一些关于此问题的评论：

```
/* * XXX: what we do here might change:
 *      - make it optional for %ENV to be tied to r->subprocess_env
 *      - make it possible to modify environ
 *      - we could allow modification of environ if mpm isn't threaded
 *      - we could allow modification of environ if variable isn't a CGI
 *        variable (still could cause problems)
 */
/*
 * problems we are trying to solve:
 *      - environ is shared between threads
 *          + Perl does not serialize access to environ
 *          + even if it did, CGI variables cannot be shared between threads!
 * problems we create by trying to solve above problems:
 *      - a forked process will not inherit the current %ENV
 *      - C libraries might rely on environ, e.g. DBD::Oracle
 */ 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T05:18:54.857

（重复我在 PerlMonks 上说过的话……）

```
BEGIN {
    my $mutex;

    sub that {
        $mutex ||= APR::ThreadMutex->new( $r->pool() );
        $mutex->lock();

        $ENV{TZ}= ...;
        ...

        $mutex->unlock();
    }
} 
```

但是，当然，lock() 应该发生在 c'tor 中，而 unlock() 应该发生在 d'tor 中，除了一次性的 hack。

更新：请注意，在子例程中如何初始化 $mutex 存在竞争条件（两个线程可以几乎同时第一次调用 that()）。您很可能希望在创建（附加）线程之前初始化 $mutex，但我不清楚“worker”Apache MPM 的详细信息以及如何轻松完成此操作。如果有一些代码“提前”运行，只需从那里调用 that() 即可消除竞争。

这一切都表明 APR::ThreadMutex 的接口更安全：

```
BEGIN {
    my $mutex;

    sub that {
        my $autoLock= APR::ThreadMutex->autoLock( \$mutex );
        ...
        # Mutex automatically released when $autoLock destroyed
    }
} 
```

请注意，autoLock() 获取对 undef 的引用会导致它在初始化 $mutex 时使用互斥锁来防止竞争。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T02:08:12.803

如果您使用的是 apache 1.3，那么您不需要使用互斥锁。Apache 1.3 产生了许多工作进程，每个工作进程执行一个线程。在这种情况下，您可以编写：

```
{
    local $ENV{TZ} = whatever_I_need_it_to_be();

    # Do calculations here.
} 
```

更改变量`local`意味着它恢复到块末尾的前一个值，但仍会传递到从该块中进行的任何子例程调用。这几乎肯定是你想要的。由于每个进程都有自己独立的环境，因此您不会使用此技术更改其他进程的环境。

对于 apache 2，我不知道它在分叉和线程方面使用什么模型。如果它保持相同的方法来分叉进程并且每个进程都有一个线程，那么你很好。

如果 apache 2 使用诚实至善的真实线程，那超出了我的详细知识范围，但我希望另一个可爱的 stackoverflow 人可以提供帮助。

万事如意，

```
Paul 
```

# sql - 如何在不使用 Visual Studio 的情况下部署托管存储过程？

> ID：124295
> 
> 赞同：7
> 
> 时间：2008-09-23T22:23:02.113
> 
> 标签：sql, stored-procedures, clr

我读过的所有内容都表明，在创建托管存储过程时，在 Visual Studio 中单击鼠标右键并选择部署。这很好用，但是如果我想在 Visual Studio 之外将它部署到多个不同的位置怎么办？我尝试使用在 SQL 中构建的项目的 dll 创建程序集，虽然它确实添加了程序集，但它没有从程序集中创建程序。有没有人想出如何在不使用 Visual Studio 的情况下直接在 SQL 中执行此操作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T23:24:38.703

将程序集 DLL 文件复制到各种服务器上的本地驱动器。然后在数据库中注册您的程序集：

```
create assembly [YOUR_ASSEMBLY]
from '(PATH_TO_DLL)' 
```

...然后您创建一个引用 DLL 中适当公共方法的函数：

```
create proc [YOUR_FUNCTION]
as
external name [YOUR_ASSEMBLY].[NAME_SPACE].[YOUR_METHOD] 
```

请务必使用 [ 括号，尤其是在 NAME_SPACE 周围。命名空间中可以有任意数量的点，但 SQL 标识符不能，除非这些部分被方括号明确分隔开。当我第一次使用 SQL CLR 时，这是许多令人头疼的问题。

需要明确的是，[YOUR_ASSEMBLY] 是您在 SQL 中定义的名称；[NAME_SPACE] 是 DLL 内的 .NET 命名空间，可以在其中找到您的方法；[YOUR_METHOD] 只是该命名空间中方法的名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-20T13:45:10.637

为上面的@kcrumley 的anwser 添加更多细节/说明：

[NAME_SPACE] 是完全限定的**类型名称**，而不仅仅是命名空间
——也就是说，如果你的类`StoredProcedures`在命名空间中被调用`My.Name.Space`，你必须使用`[My.Name.Space.StoredProcedures]`[NAME_SPACE] 部分。

如果您的托管存储过程在一个没有定义命名空间的类中，您只需使用裸类名称（例如`[StoredProcedures]`）。

我也努力想弄清楚如何添加带有参数/参数的过程。因此，这里有一个示例供其他尝试这样做的人使用：

```
CREATE PROCEDURE [YOUR_FUNCTION] 
( 
    @parameter1 int,
    @parameter2 nvarchar
) 
WITH EXECUTE AS CALLER 
AS
EXTERNAL NAME [YOUR_ASSEMBLY].[StoredProcedures].[YOUR_FUNCTION] 
```

# ruby-on-rails - 跨多个控制器的小部件数据

> ID：124296
> 
> 赞同：3
> 
> 时间：2008-09-23T22:23:19.663
> 
> 标签：ruby-on-rails, ruby

假设我有一个小部件，它显示关于我在网站上有多少帖子或评论的摘要信息。

跨控制器保留此信息的最简洁方法是什么？

在应用程序控制器中包含实例变量似乎是个坏主意。有一个为每个控制器加载数据的前置过滤器闻起来像代码重复。

我必须使用像 Cells Plugin ( [http://cells.rubyforge.org/](http://cells.rubyforge.org/) ) 这样的插件还是有更简单的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T02:06:39.017

大概，您有​​一个显示此信息的部分。您可以将获取所需数据的方法放在 ApplicationHelper 中，或者作为类方法放在您从中获取数据的任何模型上。然后在需要显示时在部分中调用该方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T17:46:03.597

我最终做了类似的事情：

在控制器/application.rb

```
def load_sidebar
  @posts = Post.find(:all)
end 
```

为了在各种操作中包含侧边栏，我这样做了：

```
before_filter :load_sidebar, :only => [ :index ] #load from application.rb file 
```

我将侧边栏设为共享部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:15:36.250

```
def load_sidebar
  @posts = Post.find(:all)
end 
```

您提到您正在显示摘要信息。如果您真的不想将所有帖子加载到内存中，可以执行以下操作。

```
def load_sidebar
  @post_count = Post.count(:id)
end 
```

# java - 在 Java 应用程序中管理时间的最佳方法是什么？

> ID：124299
> 
> 赞同：2
> 
> 时间：2008-09-23T22:24:12.437
> 
> 标签：java, hibernate

所以我正在使用休眠并使用管理时间的应用程序。在 24 小时制中处理时间的最佳方法是什么？

在此应用程序开始时我不需要担心 TimeZone 问题，但最好确保在开始时内置此功能。

我也在使用hibernate，仅供参考

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T22:32:43.383

将它们存储为 ts = System.currentTimeMillis()。该格式实际上是时区安全的，因为它以 UTC 格式返回时间。

如果您只需要时间部分，好吧，我不知道 Hib 中的内置类型，但是编写自己的类型 Time24 很简单——只需实现 org.hibernate.UserType 或 org.hibernate.CompositeUserType (load=nullSafeGet和 store=nullSafeSet 方法）。

请参阅[http://docs.jboss.org/hibernate/core/3.3/reference/en/html/mapping.html#mapping-types-custom](http://docs.jboss.org/hibernate/core/3.3/reference/en/html/mapping.html#mapping-types-custom)

但无论如何，我仍然会节省绝对时间。将来可能会有所帮助。

PS这一切都假设存储日期出于某种原因是不可能的。Date 中的 TimeZone 有时会妨碍您，真的。;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T04:44:08.547

我建议您考虑使用 Joda，[http://joda-time.sourceforge.net/](http://joda-time.sourceforge.net/)，它提供了比核心日期和日历实现更直观和可控的时间处理功能。JSR 310 实际上是在 Java 7 中包含一个新的时间 API 的提议，该 API 将主要基于 Joda。Joda 还提供了依赖于时区的时间处理和独立于时区的时间处理，这可以减轻处理间隔时的困难。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T22:46:46.487

使用 java.util.Date 有什么问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T02:12:34.947

`java.util.Date`应该使用；不是很长（而且绝对不是`Calendar`）。

如果您使用注释，请务必使用`@Temporal`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-08T19:51:49.077

我最近还发现了另一个似乎是对 JODA 的响应的库。 [http://www.date4j.net/](http://www.date4j.net/)

优点列在项目主页上。

# sharepoint - 从 SharePoint 中的问题跟踪列表中删除“类别”字段

> ID：124301
> 
> 赞同：9
> 
> 时间：2008-09-23T22:24:48.770
> 
> 标签：sharepoint

当我在 SharePoint 中创建问题跟踪列表时，我无法删除它默认添加为问题内容类型的一部分的类别选择字段。我查看了列表定义，但找不到任何关于不允许删除列的明确内容。有谁知道为什么删除按钮没有出现？有没有办法删除这个字段？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:19:24.497

Toni 的解决方案确实有效，但要小心 - 这也会从当前使用的每个问题跟踪列表中删除类别字段以及创建的任何未来问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-18T14:15:03.633

为了节省时间和保留功能，我决定采用不那么突兀的方法并将类别列重命名为“。” 并设置了默认的下拉选项“.”。它几乎不引人注意并且快速/容易做到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:54:48.387

我知道我在各种字段中都遇到了类似的字段问题，一旦添加了字段，就无法删除它。

有时可以创建代码来删除该字段，但在我遇到的大多数情况下，我们不得不隐藏该字段以防止它出现。

这需要转而使用 Powershell 和 SharePoint 对象模型来进行更改。

在我们的大多数实现中，我们发现创建具有自定义功能的自定义解决方案要好得多，该自定义功能使用 XML 格式添加自定义列表和字段来执行此操作。然后可以根据您的需要创建一个列表模板。

这样做可以让我们以可重复的方式更好地控制结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T23:19:11.570

1.  转到：门户 > 站点设置 > 站点内容类型库 > 站点内容类型
2.  选择问题内容类型
3.  选择类别
4.  单击新页面上的删除按钮

为我工作，刚刚尝试过。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-01T20:49:37.240

我还没有找到从 SharePoint 中的问题跟踪列表中删除类别字段的方法，但我确实发现可以重新调整它的用途。您可以将选择列表值更改为您想要的任何值，包括“Active”、“Resolved”和“Closed”。

将类别字段重新用作状态字段似乎很荒谬，特别是因为状态字段默认包含在问题跟踪列表中。但是您可以删除状态字段，然后将类别字段用作状态字段——这可能更经常使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-27T13:11:48.327

不知道还有没有人看这个。我采取的选择是：

1.  创建自定义列表（不是问题跟踪列表）。
2.  允许管理列表中的内容类型。然后使该列隐藏在列表内容类型中。这样您就不会破坏网站内容类型。（只是列表内容类型）。

# email - 在 webapp 中处理未送达的电子邮件

> ID：124304
> 
> 赞同：14
> 
> 时间：2008-09-23T22:25:10.687
> 
> 标签：email

我们有一个典型的商业网络应用程序，它允许我们的用户向他们的客户发送带有产品的电子邮件。我们在 FROM 字段中设置用户电子邮件，以便客户端可以直接回复用户。问题是由于 SMTP 协议，未送达的电子邮件通知会返回到我们的电子邮件地址（我们发送电子邮件的帐户地址）。

您知道处理这些未送达电子邮件的优雅方式吗？我的意思是让发件人知道他的邮件没有送达的最简单方法。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-23T22:49:27.353

首先，重要的是要了解“发件人：”标头（收件人在其电子邮件客户端中看到）和发件人地址（也称为信封返回路径，或 SMTP“MAIL FROM”命令的参数）之间的区别）。发件人地址是无法传递电子邮件时退回邮件的位置，因此是另一个名称返回路径。

SMTP 不限制您使用哪个地址作为发件人地址（除非它必须在语法上有效），但是您使用的任何 SMTP 客户端库都可能，因此您需要检查一下。

更改发件人地址是您可以做一些聪明的事情来帮助检测电子邮件退回并将它们报告回网络应用程序或发件人的地方。您将看到的最常见的事情是在发件人地址中对*收件人*地址进行编码，例如使用这样的发件人地址：sender+recipient=recipientdomain.com@senderdomain.com。负责 senderdomain.com 的 MTA 需要知道将 sender+foo@senderdomain.com 的所有电子邮件传送到 sender@senderdomain.com ——但这是一个相当普遍的要求。然后，您获取收到的电子邮件，而不是尝试从内容中的退回邮件（可能是任何格式）中找出收件人是谁，您可以直接从收件人地址获取它。

您也可以做更复杂的事情，例如对收件人地址进行散列处理，使其在发件人地址中不直接可见，例如 sender+e72fab38fb@senderdomain.com。您可以为已发送的电子邮件添加一些标识符，以防您向同一个地址发送多封电子邮件并想知道哪一封被退回。

这些技巧称为[可变信封返回路径](http://en.wikipedia.org/wiki/Variable_envelope_return_path)或 VERP，通常由邮件列表软件实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T22:32:38.703

电子邮件有 3 个“标题”。

1.  从。
    *   这就是用户眼中的“发起者”
2.  回复。
    *   如果有意回复，这是发送电子邮件的地方
3.  返回路径。
    *   这是在目的地不存在的情况下路由电子邮件的地方。

你可能想设置第三个:)

（请注意，有些服务器根本不回复这些丢失的邮件，因为最近垃圾邮件发送者已经将不属于他们自己的地址放在那里，使用自动回复系统进行第三部分退回攻击，将电子邮件服务器变成一个开放的中继！ )

有关详细信息，请参阅本文档的第 4.4 节：http: [//www.faqs.org/rfcs/rfc822.html](http://www.faqs.org/rfcs/rfc822.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T22:31:11.453

您究竟使用哪个例程来发送电子邮件？我们使用 HTTP put_lines 通过原始 SMTP 发送电子邮件，并且回复会退回到我们在 FROM: 字段中指定的地址。

查看您的 SMTP API 包装器是否有回复：字段

某些 API 可能不提供该功能，因为它增加了垃圾邮件的可能性。

# c# - IsolationLevel.RepeatableRead 防止重复

> ID：124313
> 
> 赞同：2
> 
> 时间：2008-09-23T22:26:50.293
> 
> 标签：c#, sql-server, database, transactions, data-access-layer

我正在开发一个应用程序，该应用程序应该在收到 PayPal 即时付款通知时创建产品（如运输保险单）。不幸的是，PayPal 有时会发送重复的通知。此外，还有另一个第三方在从 PayPal 获取更新时同时执行 Web 服务更新。

这是所涉及的数据库表的基本图。

```
// table "package"
// columns packageID, policyID, other data...
// 
// table "insurancepolicy"
// columns policyID, coverageAmount, other data... 
```

这是我想要做的基本图表：

```
using (SqlConnection conn = new SqlConnection(...))
{
  sqlTransaction sqlTrans = conn.BeginTransaction(IsolationLevel.RepeatableRead);

  // Calls a stored procedure that checks if the foreign key in the transaction table has a value.
  if (PackageDB.HasInsurancePolicy(packageID, conn))
  { 
    sqlTrans.Commit();
    return false;
  }

  // Insert row in foreign table.
  int policyID = InsurancePolicyDB.Insert(coverageAmount, conn);
  if (policyID <= 0)
  {
    sqlTrans.Rollback();
    return false;
  }

  // Assign foreign key to parent table.  If this fails, roll back everything.
  bool assigned = PackageDB.AssignPolicyID(packageID, policyID, conn);
  if (!assigned)
  {
    sqlTrans.Rollback();
    return false;
  }
} 
```

如果有两个（或更多）线程（或进程或应用程序）同时执行此操作，我希望第一个线程在没有 policyID 时锁定“包”行，直到创建策略并分配 policyID到包装表。然后在将 policyID 分配给包表后，将释放锁。我希望调用相同代码的另一个线程在读取包行时会暂停，以确保它首先没有 policyID。当第一个事务的锁被释放时，我希望第二个事务将看到 policyID 在那里，因此返回而不在策略表中插入任何行。

注意：由于 CRUD 数据库设计，每个存储过程都涉及读取（选择）、创建（插入）或更新。

这是RepeatableRead事务隔离的正确使用吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T23:50:14.990

我相信您实际上想要可序列化的隔离级别。问题是两个线程可以通过 HasInsurancePolicyCheck（尽管我不知道 InsurancePolicyDB.Insert 会做什么或为什么会返回 0）

为此，您还有许多其他选择。一种是使用消息队列并自己串行处理这些请求。另一种方法是使用[sp_getapplock](http://msdn.microsoft.com/en-us/library/ms189823.aspx)并锁定该包独有的某个键。这样，您就不会锁定更多的行或表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T00:40:42.077

`insert into Policy`如果只是在尝试插入重复项时遇到一些唯一性表约束，它会更安全、更干净。提高隔离级别会降低并发性并导致其他令人讨厌的问题，例如死锁。

另一种方法是始终插入 Policy 行，如果 Package 已附加到 Policy，则将其回滚：

```
begin tran (read committed)

/* tentatively insert new Policy */
insert Policy

/* attach Package to Policy if it's still free */
update Package
  set Package.policy_id = @policy_id
  where Package.package_id = @package_id and Package.policy_id is null

if @@rowcount > 0
  commit
else
  rollback 
```

当冲突很少发生时，这最有效，这似乎是你的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T16:03:35.837

我同意 aaronjensen 回复中的“消息队列”想法。如果您担心多个并发线程试图同时更新同一行数据，则应该让线程将其数据插入工作队列，然后由单个线程按顺序处理。这显着减少了数据库的争用，因为目标表仅由一个线程而不是“N”个线程更新，并且工作队列操作仅限于消息线程的插入和数据处理线程的读取/更新。

# mysql - 盲目更新还是在哪里更新？

> ID：124314
> 
> 赞同：1
> 
> 时间：2008-09-23T22:27:28.980
> 
> 标签：mysql, optimization, sql-update

我有一个表格，其中包含有关游戏中城市的信息，您可以每回合建造一座建筑物，并以“usedBuilding”值记录。

每一回合我都会运行一个脚本，将 usedBuilding 更改为 0，问题是，以下两种方式中哪一种更快，使用哪种方式实际上是否重要？

```
UPDATE cities SET usedBuilding = 0;
UPDATE cities SET usedBuilding = 0 WHERE usedBuilding = 1; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T23:28:49.223

一般来说，第二种情况（使用 WHERE）子句会更快——因为它不会在未使用的行上导致触发器评估、事务日志记录、索引更新等。

可能 - 根据 0/1 值的分布，更新所有行而不是进行比较实际上可能更快 - 但这是一个相当退化的情况。

由于约 95% 的查询成本是 I/O，使用 WHERE 子句要么没有区别（因为列没有索引，而你正在执行表扫描），要么有很大的不同（如果列被索引，或分区表等）。无论哪种方式，它都不会受到伤害。

我怀疑对于您所说的数据量，您不会注意到执行计划或速度的差异 - 这使得它充其量是学术性的，最坏的情况是过早优化。因此，我建议您选择对您的应用程序有意义的任何逻辑。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T22:30:23.903

如果 usedBuilding 被索引，使用 where 子句会更快，因为它只会访问/更新 usedBuilding 为 true 的行。如果它没有被索引，那么无论如何你都会进行全表扫描，所以它不会产生太大（任何？）差异。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T22:34:06.000

在循环中尝试两种方式数千次并计时！这可能取决于：该表中实际有多少记录，以及它们是否都适合内存或必须分页到磁盘。在您运行更新之前有多少建筑物的值为 1（我猜这可能是 1）。

使用哪种方式并不重要，但最短的可能会出错。你不写的代码不能有错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T22:54:03.973

这些转弯多久发生一次？您希望此表中有多少行？如果答案是“少于每秒一次”和“少于 10000”，请不要担心。

当然，除非你碰巧对此有某种学术兴趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T22:31:33.370

使“更新城市 SET usedBuilding = 0;”的交易数量似乎减少了。执行比更具体的查询。我能想到的反对这一点的主要原因是，如果您的专栏中有多个州。如果它只是一个布尔值，那么它会很好，但您可能需要花一些时间思考是否总是如此。

索引还可以使用 WHERE 子句使执行计划更有效。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T22:34:02.990

获得明确答案的最佳方法是在不同场景下使用大量样本数据进行分析。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T22:42:03.703

除非您拥有类似于 usedBuilding = 1 值的 2% 的东西，否则索引根本不会帮助您。

然而，这两个陈述在逻辑上是不同的，并且可能意味着完全不同的事情。但是，如果对于您的情况，它们是相同的，则使用没有 where 子句的那个。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T05:31:27.043

你到底会有多少行？我怀疑对于一个小型的网络游戏，你真的不在乎。

如果您要对“城市”表进行多次更新，如果可能的话，最好在一个 UPDATE 语句中完成所有这些更新。

Making any change to a row probably takes just as much I/O as writing the entire row (except of course updating indexed columns also requires index writes), so you lose out by making several UPDATEs which hit lots of rows.

But if you have, say, <1000 rows, you really don't care :)

# mobile-browser - 使用 Wap 拥有蜂窝网页是否值得？

> ID：124318
> 
> 赞同：2
> 
> 时间：2008-09-23T22:28:30.303
> 
> 标签：mobile-browser, wap

既然现在蜂窝拥有比以前更好的浏览器，那么为蜂窝开发[WAP](http://en.wikipedia.org/wiki/WAP_Push#WAP_Push)网页是否值得？

我有一个 PHP 网站，我想增加使用便携式设备来使用它。是否值得实施。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T22:33:20.217

坦率地说，没有。我写过 WAP 页面（很痛苦），我从未见过有人使用 WAP 浏览器，而对于世界上使用 WAP 浏览器的 4.25 人来说，有[WAP 网关](http://en.wikipedia.org/wiki/WAP_gateway)。

除非您的网站旨在提供人们会定期重新加载的 WAP 友好内容（例如，bitesize），否则提供一个带有用户可以拨打的电话号码的静态页面可能更具成本效益，这样您就可以*阅读*他们想要的内容，而不是花任何时间在WAP上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:32:22.760

这取决于您所针对的设备。如果您想让尽可能多的设备访问您的站点，那么您最好专门针对不同的设备功能进行定制，其中一些设备将仅支持 WAP。但是，如果您只想定位更高端、更现代的设备（诺基亚智能手机、iPhone、G1 等），那么您可以构建一个“传统”HTML/CSS 站点，它会呈现得很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T19:58:55.360

移动互联网不仅仅关乎技术，还关乎不同的用例和设计。我推荐阅读：

[为](http://www.sitepoint.com/article/designing-for-mobile-web/)移动 Web 设计和
[移动 Web 设计：提示和技巧](http://www.cameronmoll.com/archives/000577.html)

# c++ - 游戏编程

> ID：124322
> 
> 赞同：2
> 
> 时间：2008-09-23T22:30:14.823
> 
> 标签：c++

我可以使用哪些库在 C++ 游戏编程中进行运动和混合？我需要有关声音、图像、扩展算法的库，例如 2xsai 和 super eagle。我需要像 fblend 和 motion 这样的库。如何在devcpp中编译fblend的功能？2d 游戏......并且库应该与 devcpp 兼容

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T22:53:26.983

我主要将这两个库用于 3d 游戏：

[SDL](http://www.libsdl.org/index.php)

> Simple DirectMedia Layer 是一个跨平台多媒体库，旨在通过 OpenGL 和 2D 视频帧缓冲区提供对音频、键盘、鼠标、操纵杆、3D 硬件的低级访问。

[颂](http://www.ode.org/)

> ODE 是一个用于模拟刚体动力学的开源高性能库。它功能齐全、稳定、成熟且独立于平台，具有易于使用的 C/C++ API。它具有先进的关节类型和集成的摩擦检测。ODE 可用于模拟车辆、虚拟现实环境中的物体和虚拟生物。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T23:50:37.020

[DevMaster](http://www.devmaster.net/engines/)是一个不错的起点。

检查[Irrlicht](http://irrlicht.sourceforge.net/) - 最好的免费引擎之一。这很容易开始和开始。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T23:45:31.250

[Gosu](http://code.google.com/p/gosu/)是一个紧凑、周到的 C++ 库（也带有 Ruby 绑定）。我现在正在将 Gosu 用于一个项目，它实现了它的承诺：它确实是最小的，但它不会妨碍你。

或者，还有[SDL。SDL 最终是一个相当低级的 API，用于使用 OpenGL 处理 2D 图形。](http://www.libsdl.org/)

[](http://www.libsdl.org/)

[我曾经一直使用](http://www.libsdl.org/)[ClanLib](http://clanlib.org/)。它的功能非常丰富。然而，它的发展似乎异常缓慢，我最终继续前进。不过，这当然值得一看。

对于 2D 中的基本物理，您可能会发现[Box2D](http://www.box2d.org/)很有用。不幸的是，它的文档有些糟糕和混乱，但总的来说它是一个很好的库。如果您只是要做 2D 工作，那么使用 3D 物理引擎肯定是过分的，并且会使您的工作变得比需要的更难。

尽管我强烈推荐使用这些库之一，但并不是绝对必要的。完全可以直接使用 OpenGL 或 Direct3D 构建游戏。如果您计划实施相当高级的图形技术，则此路线更可取。

正如 Ben 所说，[gamedev.net](http://www.gamedev.net)是一个解决游戏开发问题的绝佳场所。多年来，我一直在查看那里的论坛。

最后，我在这里列出了一个不完整的免费游戏开发技术，包括 C++ 以外的语言库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T22:52:37.517

你肯定想看看着色器。着色器允许您使用世界数据或前一帧数据来装饰当前场景。这样做相对容易使用着色器创建运动模糊和其他效果。

我建议阅读[http://gamedev.net](http://gamedev.net)并查看一些名为 Game Programming Gems 的书籍。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-03-06T17:36:43.870

开始使用 GNU Emacs (gnu.org/software/emacs) 和 gcc (gcc.gnu.org 或 mingwm.org 用于 windows 版本)。熟悉操作系统的外壳（命令行），足以创建文件、更改目录和复制/移动文件。

阅读一些关于 Emacs 的特性（几乎没完没了），然后开始（IDE 的存在只是为了向您隐藏命令行）。

SDL 让您以跨平台的方式访问计算机的视频卡，它还可以播放声音，并且有许多第三方插件（SDL Image、SDL TTF 等等）。但是，它不提供 3d 功能，请为此使用 OpenGL（您可以将 SDL 与 OpenGL 一起使用）。我建议在 SDL2.0 之前从 SDL1.2 开始，因为它更简单。www.libsdl.org/release/SDL-1.2.15/docs/html/ 是开始学习 SDL1.2 的好地方。

SDL1.2 不提供任何原始绘图例程，这不是问题，如果您进行互联网搜索，您会发现许多算法可以在一个简单的文件中实现。

OpenAL 是一个 3d 声音库。

我在这篇文章中提到的所有软件都存在开源版本。

# c# - .NET 通用方法问题

> ID：124325
> 
> 赞同：5
> 
> 时间：2008-09-23T22:30:44.823
> 
> 标签：c#, .net, generics

我试图掌握 .NET 泛型的概念并在我自己的代码中实际使用它们，但我一直遇到问题。

有人可以尝试向我解释为什么以下设置无法编译吗？

```
public class ClassA
{
    ClassB b = new ClassB();

    public void MethodA<T>(IRepo<T> repo) where T : ITypeEntity
    {
        b.MethodB(repo);
    }
}

public class ClassB
{
    IRepo<ITypeEntity> repo;

    public void MethodB(IRepo<ITypeEntity> repo)
    {
        this.repo = repo;
    }
} 
```

我收到以下错误：
无法从 IRepo<'T> 转换为 IRepo<'ITypeEntity>

MethodA 使用 IRepo<'DetailType> 对象参数调用，其中 DetailType 继承自 ITypeEntity。

我一直认为这应该编译，因为我将 MethodA 中的 T 限制为 ITypeEntity 类型。

任何想法或反馈都会非常有帮助。

谢谢。

**编辑：** Nick R 有一个很好的建议，但不幸的是，在我的上下文中，我没有选择制作 ClassA Generic。B类可能是。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T22:52:22.383

好吧，这编译好了。我基本上重新定义了类以采用通用参数。这在您的上下文中可能没问题。

```
public interface IRepo<TRepo>
{
}

public interface ITypeEntity
{
}

public class ClassA<T> where T : ITypeEntity
{
    ClassB<T> b = new ClassB<T>();
    public void MethodA(IRepo<T> repo)
    {
        b.MethodB(repo);
    }
}
public class ClassB<T> where T : ITypeEntity
{
    IRepo<T> repo;
    public void MethodB(IRepo<T> repo)
    {
        this.repo = repo;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T23:16:06.307

使用泛型时，继承的工作方式不同。正如 Smashery 指出的那样，即使 TypeA 继承自 TypeB，myType<TypeA> 也不会继承自 myType<TypeB>。

因此，您不能调用定义为 MethodA(myType<TypeB> b) 并期望 myType<TypeB> 的方法，而是给它一个 myType<TypeA> 。有问题的类型必须完全匹配。因此，以下内容将无法编译：

```
myType<TypeA> a; // This should be a myType<TypeB>, even if it contains only TypeA's

public void MethodB(myType<TypeB> b){ /* do stuff */ }

public void Main()
{
  MethodB(a);
} 
```

因此，在您的情况下，您需要将 IRepo<ITypeEntity> 传递给 MethodB，即使它仅包含 DetailTypes。您需要在两者之间进行一些转换。如果您使用的是通用 IList，则可以执行以下操作：

```
public void MethodA<T>(IList<T> list) where T : ITypeEntity
{
  IList<T> myIList = new List<T>();

  foreach(T item in list)
  {
    myIList.Add(item);
  }

  b.MethodB(myIList);
} 
```

我希望这是有帮助的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T22:46:27.733

这个问题是一个棘手的问题。DetailType 可能继承自 ITypeEntity，但实际上不是 ITypeEntity。您的 DetailType 实现可能会引入不同的功能，因此 DetailType 实现 ITypeEntity 但不等于 ITypeEntity。我希望这是有道理的...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T22:53:00.417

> 我收到以下错误：无法从 IRepo<'T> 转换为 IRepo<'ITypeEntity>

你得到这个编译错误是因为*和*`IRepo<T>`不是`IRepo<ITypeEntity>`一回事。后者是前者的专业化。是*泛型类型定义*，其中类型参数 T 是占位符，并且是泛型类型定义的*构造泛型类型*，其中类型参数 T from 被指定为。*`IRepo<T>`*`IRepo<ITypeEntity>`*`ITypeEntity`***

 ***> 我一直认为这应该编译，因为我将 MethodA 中的 T 限制为 ITypeEntity 类型。

约束在`where`这里没有帮助，因为它只约束您可以在调用站点为 T 提供的类型`MethodA`。

以下是 MSDN 文档中的术语（请参阅[.NET Framework 中的泛型](http://msdn.microsoft.com/en-us/library/ms172192.aspx)）可能会有所帮助：

*   泛型类型定义是用作模板的类、结构或接口声明，并带有用于它可以包含或使用的类型的占位符。例如，`Dictionary<<K, V>`类可以包含两种类型：键和值。因为它只是一个模板，所以您不能创建作为泛型类型定义的类、结构或接口的实例。

*   泛型类型参数或类型参数是泛型类型或方法定义中的占位符。`Dictionary<K, V>`泛型类型有两个类型参数 K 和 V，它们表示其键和值的类型。

*   构造泛型类型或构造类型是为泛型类型定义的泛型类型参数指定类型的结果。

*   泛型类型参数是替代泛型类型参数的任何类型。

*   通用术语泛型类型包括构造类型和泛型类型定义。

*   约束是对泛型类型参数的限制。例如，您可以将类型参数限制为实现`IComparer<T>`泛型接口的类型，以确保可以对类型的实例进行排序。您还可以将类型参数约束为具有特定基类、具有默认构造函数或引用类型或值类型的类型。泛型类型的用户不能替换不满足约束的类型参数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T22:54:19.947

请参阅[@monoxide](https://stackoverflow.com/questions/110121/logic-and-its-application-to-collectionsgeneric-and-inheritance)的问题

[正如我在那里所说](https://stackoverflow.com/questions/110121/logic-and-its-application-to-collectionsgeneric-and-inheritance#110137)的，查看 Eric Lippert 关于泛型的逆变和协变的系列文章将使这一点更加清晰。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T22:47:04.037

如果 B 是 A 的子类，那并不意味着它`Class<B>`是 的子类`Class<A>`。因此，出于同样的原因，如果你说“`T`是一个`ITypeEntity`”，那并不意味着“`IRepo<T>`是一个`IRepo<ITypeEntity>`”。如果你想让它工作，你可能必须编写自己的转换方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T22:48:18.027

T 是一个类型变量，在使用中将绑定到特定类型。该限制确保该类型将表示实现 ITypeEntity 的类型的**子集**，不包括实现接口的其他类型。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T22:51:48.547

在编译时，即使您对其进行约束，编译器也只知道 MethodA 中的 T 是引用类型。它不知道它被限制为什么类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T22:52:32.103

这是对泛型的冗余使用，如果 T 只能是 ITypeEntity 的实例，则不应使用泛型。

泛型适用于当您有多种类型可以在某物内部时。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T23:59:58.150

在将你的头脑围绕在泛型方法的上下文中，请允许我给你一个简单的泛型函数。它是 VB 的 IIf()（立即 if）的通用等价物，它本身就是对 C 风格的三元运算符 (?) 的拙劣模仿。它对任何事情都没有用，因为真正的三元运算符更好，但也许它会帮助您了解通用函数是如何构建的以及它们应该在什么上下文中应用。

```
T IIF<T>(bool Expression, T TruePart, T FalsePart)
{
    return Expression ? TruePart : FalsePart;
} 
```

# javascript - 如何在 JavaScript 中将“对象”转换为函数？

> ID：124326
> 
> 赞同：47
> 
> 时间：2008-09-23T22:30:54.573
> 
> 标签：javascript, function, properties

JavaScript 允许将函数视为对象——如果您首先将变量定义为函数，则随后可以向该函数添加属性。你如何做相反的事情，并向“对象”添加一个函数？

这有效：

```
var foo = function() { return 1; };
foo.baz = "qqqq"; 
```

此时，`foo()`调用该函数，并`foo.baz`具有值“qqqq”。

但是，如果您先进行属性分配部分，那么您如何随后将函数分配给变量？

```
var bar = { baz: "qqqq" }; 
```

我现在可以做些什么来安排`bar.baz`值“qqqq”*并* `bar()`调用该函数？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-23T23:27:40.520

在这里很容易混淆，但你不能（容易或清楚地或据我所知）做你想做的事。希望这将有助于解决问题。

首先，Javascript 中的每个对象都继承自 Object 对象。

```
//these do the same thing
var foo = new Object();
var bar = {}; 
```

其次，函数**是 Javascript**中的对象。具体来说，它们是一个 Function 对象。Function 对象继承自 Object 对象。检查[函数构造函数](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function)

```
var foo = new Function();
var bar = function(){};
function baz(){}; 
```

一旦将变量声明为“对象”，就不能（容易或清楚地或据我所知）将其转换为函数对象。您需要声明一个 Function 类型的新对象（使用函数构造函数，为变量分配匿名函数等），并从旧对象复制方法的任何属性。

最后，预料到一个可能的问题，即使将某些东西声明为函数，您也不能（据我所知）更改 functionBody/source。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-23T22:46:58.607

似乎没有标准的方法来做到这一点，但这是可行的。

但是，为什么，这是个问题。

```
function functionize( obj , func )
{ 
   out = func; 
   for( i in obj ){ out[i] = obj[i]; } ; 
   return out; 
}

x = { a: 1, b: 2 }; 
x = functionize( x , function(){ return "hello world"; } );
x()   ==> "hello world" 
```

根本没有其他方法可以实现这一点，做

```
x={}
x() 
```

将返回“类型错误”。因为“x”是一个“对象”，你不能改变它。它和尝试做的一样明智

```
 x = 1
 x[50] = 5
 print x[50] 
```

它行不通。1 是整数。整数没有数组方法。你做不到。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-05-23T14:24:17.387

对象类型是函数，对象本身是函数实例化。

```
alert([Array, Boolean, Date, Function, Number, Object, RegExp, String].join('\n\n')) 
```

显示（在 FireFox 中）：

```
function Array() {
    [native code]
}

function Boolean() {
    [native code]
}

function Date() {
    [native code]
}

function Function() {
    [native code]
}

function Number() {
    [native code]
}

function Object() {
    [native code]
}

function RegExp() {
    [native code]
}

function String() {
    [native code]
} 
```

特别要注意 Function 对象 ,`function Function() { [native code] }`被定义为递归关系（使用自身的递归定义）。

[另外，请](https://stackoverflow.com/questions/124326/how-to-convert-an-object-into-a-function-in-javascript/124402#124402)注意，关于`1[50]=5`. 这确实为 Number 对象分配了一个属性，并且是有效的 Javascript。观察，

```
alert([
  [].prop="a",
  true.sna="fu",
  (new Date()).tar="fu",
  function(){}.fu="bar",
  123[40]=4,
  {}.forty=2,
  /(?:)/.forty2="life",
  "abc".def="ghi"
].join("\t")) 
```

显示

```
a   fu  fu  bar 4   2   life    ghi 
```

根据 Javascript 的“参与规则”正确解释和执行。

当然，总会有皱纹和表现出来`=`。分配给变量时，对象通常与其值“短路”，而不是完整的实体。这是布尔对象和布尔值的问题。

显式对象识别解决了这个问题。

```
x=new Number(1);  x[50]=5;  alert(x[50]); 
```

“重载”是一个相当合法的 Javascript 练习，并且明确地得到了一些机制的认可，`prototyping`尽管代码混淆可能是一种危险。

最后说明：

```
alert(  123 . x = "not"  );

alert( (123). x = "Yes!" );  /* ()'s elevate to full object status */ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T22:48:39.960

使用临时变量：

```
var xxx = function()... 
```

然后复制原始对象的所有属性：

```
for (var p in bar) { xxx[p] = bar[p]; } 
```

最后将具有旧属性的新函数重新分配给原始变量：

```
bar = xxx; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-10T04:21:31.960

```
var A = function(foo) {                                                                                                      
  var B = function() {                                                                                                       
    return A.prototype.constructor.apply(B, arguments);
  };
  B.prototype = A.prototype;                                                                                                 
  return B;                                                                                                                  
}; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-06-12T17:19:35.997

注意：以我如何解决问题的方式写的帖子。我不是 100% 确定它在 OP 的情况下是否可用。

我在寻找一种方法来转换在服务器上创建并通过 JSON / ajax 传递给客户端的对象时发现了这篇文章。

这实际上使我处于与 OP 相同的情况，我想将一个对象转换为一个函数，以便能够在客户端上创建它的实例。

最后我想出了这个，它正在工作（至少到目前为止）：

```
var parentObj = {}

parentObj.createFunc = function (model)
{
    // allow it to be instantiated
    parentObj[model._type] = function()
    {
        return (function (model)
        {
            // jQuery used to clone the model
            var that = $.extend(true, null, model);
            return that;
        })(model);
    }
} 
```

然后可以像这样使用：

```
var data = { _type: "Example", foo: "bar" };
parentObject.createFunc(data);
var instance = new parentObject.Example(); 
```

在我的情况下，我实际上希望拥有与生成的对象实例相关联的函数，并且还能够在实例化它时传入参数。

所以我的代码是：

```
var parentObj = {};
// base model contains client only stuff
parentObj.baseModel =
{
    parameter1: null,
    parameter2: null,
    parameterN: null, 
    func1: function ()
    {
        return this.parameter2;
    },
    func2: function (inParams) 
    {
        return this._variable2;
    }
}

// create a troop type
parentObj.createModel = function (data)
{
    var model = $.extend({}, parentObj.baseModel, data);
    // allow it to be instantiated
    parentObj[model._type] = function(parameter1, parameter2, parameterN)
    {
        return (function (model)
        {
            var that = $.extend(true, null, model);
            that.parameter1 = parameter1;
            that.parameter2 = parameter2;
            that.parameterN = parameterN;
            return that;
        })(model);
    }
} 
```

并被称为：

```
// models received from an AJAX call
var models = [
{ _type="Foo", _variable1: "FooVal", _variable2: "FooVal" },
{ _type="Bar", _variable1: "BarVal", _variable2: "BarVal" },
{ _type="FooBar", _variable1: "FooBarVal", _variable2: "FooBarVal" }
];

for(var i = 0; i < models.length; i++)
{
    parentObj.createFunc(models[i]);
} 
```

然后可以使用它们：

```
var test1 = new parentObj.Foo(1,2,3);
var test2 = new parentObj.Bar("a","b","c");
var test3 = new parentObj.FooBar("x","y","z");

// test1.parameter1 == 1
// test1._variable1 == "FooVal"
// test1.func1() == 2

// test2.parameter2 == "a"
// test2._variable2 == "BarVal"
// test2.func2() == "BarVal"

// etc 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-23T22:39:22.697

> JavaScript 允许将函数视为对象——您可以向函数添加属性。你如何做相反的事情，并为一个对象添加一个函数？

你似乎有点困惑。JavaScript 中的函数*是*对象。而且**变量*是*可变**的。你不会期望这会起作用：

```
var three = 3;
three = 4;
assert(three === 3); 
```

...那么您为什么期望将函数分配给您的变量会以某种方式保留其先前的值？也许一些注释会为您澄清一些事情：

```
// assigns an anonymous function to the variable "foo"
var foo = function() { return 1; }; 
// assigns a string to the property "baz" on the object 
// referenced by "foo" (which, in this case, happens to be a function)
foo.baz = "qqqq"; 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-10-26T21:36:02.813

```
var bar = { 
    baz: "qqqq",
    runFunc: function() {
        return 1;
    }
};

alert(bar.baz); // should produce qqqq
alert(bar.runFunc()); // should produce 1 
```

我想你正在寻找这个。

也可以这样写：

```
function Bar() {
    this.baz = "qqqq";
    this.runFunc = function() {
        return 1;
    }
}

nBar = new Bar(); 

alert(nBar.baz); // should produce qqqq
alert(nBar.runFunc()); // should produce 1 
```

# c++ - C++ 处理非常大的整数

> ID：124332
> 
> 赞同：26
> 
> 时间：2008-09-23T22:32:27.737
> 
> 标签：c++, rsa, biginteger, integer

我正在使用 RSA 算法进行加密/解密，为了解密文件，您必须处理一些相当大的值。更具体地说，像

```
P = C^d % n
  = 62^65 % 133 
```

现在，这确实是唯一不合适的计算。我曾尝试使用 Matt McCutchen 的 BigInteger 库，但在链接过程中出现了很多编译器错误，例如：

```
encryption.o(.text+0x187):encryption.cpp: undefined reference to `BigInteger::BigInteger(int)'

encryption.o(.text+0x302):encryption.cpp: undefined reference to `operator<<(std::ostream&, BigInteger const&)'

encryption.o(.text$_ZNK10BigIntegermlERKS_[BigInteger::operator*(BigInteger const&) const]+0x63):encryption.cpp: undefined reference to `BigInteger::multiply(BigInteger const&, BigInteger const&)' 
```

所以我想知道处理来自 RSA 算法的真正大整数的最佳方法是什么。

我听说有可能将你的变量声明为双长，所以......

```
long long decryptedCharacter; 
```

但我不确定可以存储多大的整数。

* * *

例如，我尝试使用 dev C++ 编译和运行以下程序：

```
#include iostream

#include "bigint\BigIntegerLibrary.hh"

using namespace std;

int main()
{
    BigInteger a = 65536;
    cout << (a * a * a * a * a * a * a * a);
    return 0;
} 
```

然后我得到这些错误。

Derek，我认为通过包含该`BigIntegerLibrary.hh`文件，编译器将遍历并编译它将使用的所有必要文件。

我应该如何尝试编译上述程序以解决链接错误？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T23:03:18.100

Tomek，听起来您没有正确链接到 BigInteger 代码。我认为你应该解决这个问题而不是寻找一个新的图书馆。我查看了源代码，并且`BigInteger::BigInteger(int)`最明确地定义了。简单的一瞥表明其他人也是如此。

您得到的链接错误意味着您要么忽略编译 BigInteger 源代码，要么在链接时忽略包含生成的目标文件。请注意，BigInteger 源使用“cc”扩展名而不是“cpp”，因此请确保您也在编译这些文件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T22:43:26.773

我建议使用[gmp](http://gmplib.org/)，它可以处理任意长的整数并且具有不错的 C++ 绑定。

当前硬件/软件上的 afaik long long 是 64 位的，因此 unsigned 可以处理高达 (2**64)-1 == 18446744073709551615 的数字，这比您必须处理 RSA 的数字小得多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T23:45:39.450

如果您没有将 RSA 用作学校作业或其他东西，那么我建议您查看 crypto++ 库[http://www.cryptopp.com](http://www.cryptopp.com)

糟糕地实施加密货币非常容易。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T22:36:28.257

要查看 long long 的大小，请尝试以下操作：

```
#include <stdio.h>

int main(void) {
    printf("%d\n", sizeof(long long));

    return 0;
} 
```

在我的机器上它返回 8 这意味着 8 个字节可以存储 2^64 个值。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-23T22:46:25.660

对于 RSA，您需要一个 bignum 库。这些数字太大了，无法容纳 64 位长。我曾经有一个大学同事，他得到了一个实施 RSA 的任务，包括建立他自己的 bignum 库。

碰巧的是，Python 有一个 bignum 库。编写 bignum 处理程序小到足以适合计算机科学任务，但仍然有足够的陷阱使其成为一项不平凡的任务。他的解决方案是使用 Python 库生成测试数据来验证他的 bignum 库。

您应该能够获得其他 bignum 库。

或者，尝试在 Python 中实现一个原型，看看它是否足够快。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-02-24T22:10:11.460

这是我的方法，它结合了使用平方+模幂的快速求幂，从而减少了所需的空间。

```
long long mod_exp (long long n, long long e, long long mod)
{
  if(e == 1)
  {
       return (n % mod);
  }
  else
  {
      if((e % 2) == 1)
      {
          long long temp = mod_exp(n, (e-1)/2, mod);
          return ((n * temp * temp) % mod);
      }
      else
      {
          long long temp = mod_exp(n, e/2, mod);
          return ((temp*temp) % mod); 
      }
  }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-02-24T22:29:06.823

确保 RSA 实施的安全性不仅仅是大数字。一个简单的 RSA 实现往往会通过侧通道泄漏私人信息，尤其是时间（简单来说：计算时间取决于处理的数据，这允许攻击者恢复一些，可能是全部的私钥位）。良好的 RSA 实现会实施对策。

此外，除了模幂运算之外，还有整个填充业务，这在概念上并不难，但与所有 I/O 和解析代码一样，存在细微错误的空间。最容易编写的代码是已经由其他人编写的代码。

另一点是，一旦您的 RSA 代码启动并运行，您可能会开始设想扩展和其他情况，例如“如果我要使用的私钥不在 RAM 中而是在智能卡中怎么办？”。一些现有的 RSA 实现实际上是可以处理的 API。在 Microsoft 世界中，您想查找集成在 Windows 中的[CryptoAPI 。](http://msdn.microsoft.com/en-us/library/aa380255(VS.85).aspx)您可能还想查看[NSS](http://www.mozilla.org/projects/security/pki/nss/)，它是 Firefox 浏览器用于 SSL 的。

总而言之：您*可以*从大整数构建符合 RSA 的实现，但这比通常看起来更难以正确执行，因此我的建议是使用现有的 RSA 实现。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-24T17:58:55.797

Openssl 也有一个可以使用的[Bignum类型。](https://www.openssl.org/docs/crypto/bn.html)我已经使用它并且效果很好。如果需要，可以很容易地用 C++ 或 Objective-C 等 oo 语言进行封装。

[https://www.openssl.org/docs/crypto/bn.html](https://www.openssl.org/docs/crypto/bn.html)

另外，如果您不知道，要找到 x^y % z 形式的方程的答案，请查找一种称为模幂的算法。大多数加密或 bignum 库将具有专门用于此计算的功能。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-23T22:38:58.610

我会试用[GMP](http://gmplib.org/)库——它很健壮，经过良好测试，并且通常用于这种类型的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T00:03:44.523

我在使用[LibTomCrypt](https://github.com/libtom/libtomcrypt)库来满足我的加密需求方面取得了很大的成功。它快速、精简且便携。它可以为你做你的 RSA，或者如果你想只处理数学。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-23T22:36:18.070

long int 通常是 64 位，这可能不足以处理这么大的整数。您可能需要某种 bigint 库。

另请参阅Stack Overflow 上的[这个问题](https://stackoverflow.com/questions/117429/inputting-large-numbers-in-c#117472)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-23T22:36:52.437

查看您的编译器文档。一些编译器定义了诸如 __int64 之类的类型，这些类型为您提供了它们的大小。也许你有一些可用的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-23T22:38:50.577

请注意：__int64 和 long long 是非标准扩展。不能保证所有 C++ 编译器都支持这两者。C++是基于C89的（98年出来的，所以不能基于C99）

（从 C99 开始，C 就支持 'long long'）

顺便说一句，我认为 64 位整数不能解决这个问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T23:03:03.840

事实上，您在使用某些 biginteger 库时遇到问题并不意味着这是一种不好的方法。

使用 long long 绝对是一种不好的方法。

正如其他人所说，已经使用 biginteger 库可能是一种好方法，但是您必须发布更多关于您使用提到的库的详细信息，以便我们能够帮助您解决这些错误。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-18T19:26:45.103

我在编写 RSA 实现时使用了 GMP。

# c# - A way of casting a base type to a derived type

> ID：124336
> 
> 赞同：48
> 
> 时间：2008-09-23T22:32:54.460
> 
> 标签：c#, oop, inheritance, design-patterns

I'm not sure if this is a strange thing to do or not, or if it is some how code smell...but I was wondering if there was a way (some sort of oop pattern would be nice) to "cast" a base type to a form of its derived type. I know this makes little sense as the derived type will have additional functionality that the parent doesn't offer which is in its self not fundamentally sound. But is there some way to do this? Here is a code example to so I can better explain what I"m asking.

```
public class SomeBaseClass {
    public string GetBaseClassName {get;set;}
    public bool BooleanEvaluator {get;set;}
}

public class SomeDerivedClass : SomeBaseClass {
    public void Insert(SqlConnection connection) {
          //...random connection stuff
          cmd.Parameters["IsItTrue"].Value = this.BooleanEvalutar;
          //...
    }
}

public static void Main(object[] args) {
    SomeBaseClass baseClass = new SomeBaseClass();
    SomeDerivedClass derClass = (SomeDerivedClass)baseClass; 
    derClass.Insert(new sqlConnection());
} 
```

I know this seems goofy but is there any way to accomplish something of this sort?

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-23T22:37:16.460

Not soundly, in "managed" languages. This is *downcasting*, and there is no sane down way to handle it, for exactly the reason you described (subclasses provide more than base classes - where does this "more" come from?). If you really want a similar behaviour for a particular hierarchy, you could use constructors for derived types that will take the base type as a prototype.

One could build something with reflection that handled the simple cases (more specific types that have no addition state). In general, just redesign to avoid the problem.

Edit: Woops, can't write conversion operators between base/derived types. An oddity of Microsoft trying to "protect you" against yourself. Ah well, at least they're no where near as bad as Sun.

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-24T00:15:02.077

Try composition instead of inheritance!

It seems to me like you'd be better off passing an instance of SomeBaseClass to the SomeDerivedClass (which will no longer derive base class, and should be renamed as such)

```
public class BooleanHolder{       
    public bool BooleanEvaluator {get;set;}
}

public class DatabaseInserter{
    BooleanHolder holder;

    public DatabaseInserter(BooleanHolder holder){
        this.holder = holder;
    }

    public void Insert(SqlConnection connection) {
          ...random connection stuff
          cmd.Parameters["IsItTrue"].Value = holder.BooleanEvalutar;
          ...
    }
}

public static void Main(object[] args) {
    BooleanHolder h = new BooleanHolder();
    DatabaseInserter derClass = new DatabaseInserter(h);
    derClass.Insert(new sqlConnection);
} 
```

Check out [http://www.javaworld.com/javaworld/jw-11-1998/jw-11-techniques.html](http://www.javaworld.com/javaworld/jw-11-1998/jw-11-techniques.html) (page 3):

> Code reuse via composition Composition provides an alternative way for Apple to reuse Fruit's implementation of peel(). Instead of extending Fruit, Apple can hold a reference to a Fruit instance and define its own peel() method that simply invokes peel() on the Fruit.

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-09-26T09:25:41.900

Personally I don't think it's worth the hassle of using Inheritance in this case. Instead just pass the base class instance in in the constructor and access it through a member variable.

```
private class ExtendedClass //: BaseClass - like to inherit but can't
{
    public readonly BaseClass bc = null;
    public ExtendedClass(BaseClass b)
    {
        this.bc = b;
    }

    public int ExtendedProperty
    {
        get
        {
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-23T22:46:43.850

Downcasting makes sense, if you have an Object of derived class but it's referenced by a reference of base class type and for some reason You want it back to be referenced by a derived class type reference. In other words You can downcast to reverse the effect of previous upcasting. But You can't have an object of base class referenced by a reference of a derived class type.

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-05-01T21:02:07.373

I'm not saying I recommend this. But you could turn base class into JSON string and then convert it to the derived class.

```
SomeDerivedClass layer = JsonConvert.DeserializeObject<SomeDerivedClass>(JsonConvert.SerializeObject(BaseClassObject)); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-23T22:53:59.387

No, this is not possible. In a managed language like C#, it just won't work. The runtime won't allow it, even if the compiler lets it through.

You said yourself that this seems goofy:

```
SomeBaseClass class = new SomeBaseClass();
SomeDerivedClass derClass = (SomeDerivedClass)class; 
```

So ask yourself, is `class` actually an instance of `SomeDerivedClass`? No, so the conversion makes no sense. If you need to convert `SomeBaseClass` to `SomeDerivedClass`, then you should provide some kind of conversion, either a constructor or a conversion method.

It sounds as if your class hierarchy needs some work, though. In general, it *shouldn't* be possible to convert a base class instance into a derived class instance. There should generally be data and/or functionality that do not apply to the base class. If the derived class functionality applies to *all* instances of the base class, then it should either be rolled up into the base class or pulled into a new class that is not part of the base class hierarchy.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-04-13T12:17:02.507

C# language doesn't permit such operators, but you can still write them and they work:

```
[System.Runtime.CompilerServices.SpecialName]
public static Derived op_Implicit(Base a) { ... }

[System.Runtime.CompilerServices.SpecialName]
public static Derived op_Explicit(Base a) { ... } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T23:14:02.957

Yes - this is a code smell, and pretty much nails down the fact that your inheritance chain is broken.

My *guess* (from the limited sample) is that you'd rather have DerivedClass operate on an instance of SomeBaseClass - so that "DerivedClass *has a* SomeBaseClass", rather than "DerivedClass *is a* SomeBaseClass". This is known as "favor composition over inheritance".

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-12T11:22:57.773

As others have noted, the casting you suggest is not really possible. Would it maybe be a case where the [Decorator pattern](http://oreilly.com/catalog/hfdesignpat/chapter/ch03.pdf)(Head First extract) can be introduced?

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-19T14:54:44.650

Have you thought about an interface that what is currently your base class and your derived class both would implement? I don't know the specifics of why you're implementing this way but it might work.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T22:37:51.187

That cannot work. Go look at the help page linked by the compile error.

The best solution is to use factory methods here.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T22:39:30.810

This is called downcasting and Seldaek's suggestion to use the "safe" version is sound.

Here's a pretty decent [description with code samples](http://en.csharp-online.net/Hello,_CSharp%E2%80%941.14.2_Unboxing_Leaves_Us_Downcast).

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T23:01:32.830

This is not possible because how are you going to get the "extra" that the derived class has. How would the compiler know that you mean derivedClass1 and not derivedClass2 when you instantiate it?

I think what you are really looking for is the factory pattern or similar so you can instantiate objects without really knowing the explicit type that's being instantiate. In your example, having the "Insert" method would be an interface that instance the factory returns implements.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-14T20:27:25.863

I dont know why no one has said this and i may have miss something but you can use the as keyword and if you need to do an if statement use if.

```
SomeDerivedClass derClass = class as SomeDerivedClass; //derClass is null if it isnt SomeDerivedClass
if(class is SomeDerivedClass)
    ; 
```

-edit- [I asked this question long ago](https://stackoverflow.com/questions/1572250/a-real-use-for-as-and-is)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-03-13T15:27:16.323

I've recently been in the need of extending a simple DTO with a derived type in order to put some more properties on it. I then wanted to reuse some conversion logic I had, from internal database types to the DTOs.

The way I solved it was by enforcing an empty constructor on the DTO classes, using it like this:

```
class InternalDbType {
    public string Name { get; set; }
    public DateTime Date { get; set; }
    // Many more properties here...
}

class SimpleDTO {
    public string Name { get; set; }
    // Many more properties here...
}

class ComplexDTO : SimpleDTO {
    public string Date { get; set; }
}

static class InternalDbTypeExtensions {
    public static TDto ToDto<TDto>(this InternalDbType obj) where TDto : SimpleDTO, new() {
        var dto = new TDto {
            Name = obj.Name
        }
    }
} 
```

I can then reuse the conversion logic from the simple DTO when converting to the complex one. Of course, I will have to fill in the properties of the complex type in some other way, but with many, many properties of the simple DTO, this really simplifies things IMO.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-08-21T09:21:25.603

As many answers have pointed out, you can't downcast which makes total sense.

However, in your case, `SomeDerivedClass` doesn't have properties that will be 'missing'. So you could create an extension method like this:

```
public static T ToDerived<T>(this SomeBaseClass baseClass) 
    where T:SomeBaseClass, new()
{
    return new T()
    {
        BooleanEvaluator = baseClass.BooleanEvaluator,
        GetBaseClassName = baseClass.GetBaseClassName
    };
} 
```

So you aren't casting, just converting:

```
SomeBaseClass b = new SomeBaseClass();
SomeDerivedClass c = b.ToDerived<SomeDerivedClass>(); 
```

This only really works if all of the data in the base class is in the form of readable and writable properties.

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2012-01-24T16:22:45.737

C++ handles it using a constructor. [C++ Typecasting](http://www.cplusplus.com/doc/tutorial/typecasting/). It seems like an oversight to me. Many of you have brought up the issue of what would the process do with the extra properties. I would answer, what does the compiler do when it creates the derived class when the programmer does not set the properties? I have handled this situation similar to C++. I create a constructor that takes the base class then manually set the properties in the constructor. This is definitely preferable to setting a variable in the derived class and breaking the inheritance. I would also choose it over a factory method because I think the resulting code would be cleaner looking.

# asp.net - 如何将同一解决方案中的多个网站项目发布到一个文件夹？

> ID：124355
> 
> 赞同：1
> 
> 时间：2008-09-23T22:38:52.590
> 
> 标签：asp.net, visual-studio-2005, web

我想将多个网站项目保存在一个解决方案中，并且我想将它们一起发布在一个文件夹中。这样做的步骤是什么？我可以发布整个解决方案吗？我猜这个解决方案只是一个包含不同网站项目的容器。我想将所有这些小型网站项目发布到一个地方，并且我想使用单个页面来对整个应用程序进行身份验证。如何在一个位置发布这些多个网站？我必须管理 web.config 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T22:49:29.880

听起来您真正需要的是一个 Web 项目（我建议您使用 Web 应用程序项目而不是 Web“站点”项目……但这是另一个话题）。

如果它们都共享共同的身份验证和根文件夹，为什么要分开它们？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T23:00:27.543

您可以在 NAnt 构建脚本上使用 MsBuild 来执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T16:32:48.320

我会认真考虑将项目合并为 1，特别是如果它们将使用相同的身份验证系统。合并后，您将能够使用继承的 MasterPages 轻松地为每个部分赋予其自己的“外观”，同时仍保持网站的风格。

# asp.net-mvc - 重用 MVC 架构；有两层 UI：ASP.NET MVC 和 .NET Winforms

> ID：124358
> 
> 赞同：8
> 
> 时间：2008-09-23T22:39:08.733
> 
> 标签：asp.net-mvc, winforms, refactoring, reusability

虽然我的问题可能看起来很抽象，但我希望不是。假设我开发了一个应用程序，一个 ASP.NET MVC 站点，然后我的任务是为这个应用程序构建一个 Winforms 客户端，我可以从现有应用程序中重用多少以及如何重用？

我定义了模型，定义了控制器和视图。他们都运作良好。

现在老板来要求一个 Winforms 客户端，我希望我可以重用模型和控制器（前提是我将它们放在不同的程序集中），而不仅仅是重用视图（ASPX 视图）。

这可以做到吗？如何？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T22:58:17.720

我以前做过这个，不是用 asp.net MVC，而是用纯 asp.net web 表单。我使用了一个本土的 MVP（模型-视图-演示者）模式，并且允许在 WinForms 应用程序中使用演示者（== 控制器）的绝对最重要的事情是不引用*与*系统有关的任何内容.web

因此，您需要做的第一件事是引入接口来包装任何请求、响应、Web 等内容，并让每个 Presenter 通过依赖注入接受这些接口（或通过其他技术使它们对 Presenters 可用），然后如果 Presenter 使用那些而不是实际的 system.web 东西。

例子：

想象一下，您想将控制权从页面 A 转移到页面 B（在您的 winforms 应用程序中，您可能希望关闭表单 A，然后打开表单 B）。

界面：

```
public interface IRuntimeContext
{
  void TransferTo(string destination);
} 
```

网络实现：

```
public class AspNetRuntimeContext
{
  public void TransferTo(string destination)
  {
    Response.Redirect(destination);
  }
} 
```

winform实现：

```
public class WinformsRuntimeContext
{
  public void TransferTo(string destination)
  {
    var r = GetFormByName(destination);
    r.Show();
  }
} 
```

现在演示者（在您的情况下为控制器）：

```
public class SomePresenter
{
  private readonly runtimeContext;
  public SomePresenter(IRuntimeContext runtimeContext)
  {
    this.runtimeContext = runtimeContext;
  }

  public void SomeAction()
  {
    // do some work

    // then transfer control to another page/form
    runtimeContext.TransferTo("somewhereElse");
  }
} 
```

我没有详细查看 asp.net MVC 实现，但我希望这可以给您一些迹象，表明启用您所追求的场景可能需要做很多工作。

相反，您可能要考虑接受必须为不同平台重新编码视图和控制器，而是专注于保持控制器非常精简并将大部分代码放在可以共享的服务层中。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-15T13:32:27.017

看看[Northwind 入门套件](http://www.codeplex.com/NSK)（不要被 Northwind 位推迟） - 它具有附加到分层架构的各种 GUI，包括 MVC 和 Winforms。

它完全符合您的要求。

# ruby-on-rails - 在 Rails 应用程序中运行异步作业的最佳方式是什么？

> ID：124360
> 
> 赞同：15
> 
> 时间：2008-09-23T22:39:24.647
> 
> 标签：ruby-on-rails, asynchronous

我知道有几个插件可以进行异步处理。哪一个是最好的，为什么？

我知道的有：

*   [背景DRb](http://backgroundrb.rubyforge.org/)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-04T05:21:53.130

我会将 DJ（延迟工作）添加到列表中 - [http://blog.leetsoft.com/2008/2/17/delayed-job-dj](http://blog.leetsoft.com/2008/2/17/delayed-job-dj)

github 的人最近给了它一个很好的评价：http: [//github.com/blog/197-the-new-queue](http://github.com/blog/197-the-new-queue)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T22:53:36.127

如果您可能有几个这样的过程，并且您想将它们排队，那么starling 和 workling 似乎很有趣（请参阅[截屏视频）。](http://railscasts.com/episodes/128-starling-and-workling)

您可能还会对使用 rake 进行后台进程的[上一个截屏视频](http://railscasts.com/episodes/127-rake-in-background)感兴趣，而未来的截屏视频可能是关于同一问题的另一种解决方案。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T08:09:17.833

某件事是否是“最佳”解决方案实际上取决于您要解决的问题是什么。在某些情况下，最好的解决方案将是最轻量级的解决方案，而在其他情况下则是最重量级的解决方案。

[**BackgroundRb**](http://backgroundrb.rubyforge.org/)可能是功能最全的 Rails 后台作业处理器，但它也是最复杂的，因此需要更多投资才能掌握它。BackgroundRb 可能可以处理大多数用例，从简单到复杂。

我听说过关于 Ara T. Howard 的[**后台作业**](http://codeforpeople.rubyforge.org/svn/bj/trunk/README)(Bj) 的好消息，引用自述文件是*Rails 的脑死简单零管理后台优先级队列*。这是一个更轻量级的解决方案，因此在大多数情况下可能比 BackgroundRb 更可取。

如果您想要的只是一个不常见的离线批处理式处理的解决方案，那么[`**script/runner**`](http://wiki.rubyonrails.org/rails/pages/RunnerScript)所有 Rails 应用程序附带的解决方案就绰绰有余了。

如需进一步阅读，您可能需要查看[Rails Wiki](http://wiki.rubyonrails.org/rails)中的[HowToRunBackgroundJobsInRails](http://wiki.rubyonrails.org/rails/pages/HowToRunBackgroundJobsInRails)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-12-12T16:56:30.243

Resque 也可以帮助您。

这是一个非常好的工具，用于创建后台作业、将这些作业放置在多个队列中并稍后处理它们。

Github 的人已经创建并使用了它。

下面的文章可能会帮助您入门：

[http://rubylearning.com/blog/2010/11/08/do-you-know-resque/](http://rubylearning.com/blog/2010/11/08/do-you-know-resque/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-23T22:52:42.213

[BackgrounDRb](http://backgroundrb.rubyforge.org/) - 优点：功能齐全，消息传递，缺点：线程化（eek - Rails 不是线程安全的！），复杂

[守护进程生成器](http://github.com/dougal/daemon_generator/tree/master)- 优点：简单，运行作业，仅此而已！，缺点：没有那些花哨的消息传递的东西。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T15:15:17.937

Starling + Workling 插件非常简单。此外，它使用简单、经过测试和可扩展的 Memcached。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T14:31:15.700

我们使用 Cron。易于设置，易于维护，并且始终有效。

BackgroundRb 会吃掉你的大脑。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-04T04:56:18.753

BackgrounDRb 没有线程，它完全基于进程。如果他想同时处理 IO 绑定任务，它只有一个用户可以使用的线程池功能。

尝试 1.1 版本，让我（在我的博客上）或邮件列表上知道任何问题。

# visual-studio-2005 - AD 锁定我的帐户

> ID：124364
> 
> 赞同：1
> 
> 时间：2008-09-23T22:41:24.470
> 
> 标签：visual-studio-2005, active-directory

我在 Visual Studio 2005 中开发了一个应用程序。每当我运行该应用程序时，活动目录都会锁定我的帐户域。我真的不明白我做错了什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T22:53:23.957

我不能确切地告诉你是什么原因造成的，但这里有一些故障排除技巧。安装 Microsoft 的**[帐户锁定和管理工具](http://www.microsoft.com/downloads/details.aspx?FamilyID=7af2e69c-91f3-4e63-8629-b999adde0b9e&DisplayLang=en)**，这样您就可以获得有关锁定原因和时间的更多详细信息。

这是一篇出色的调试文章，它可以引导您完成所有操作，并且比我在这里重复它更足智多谋：**[实施和解决帐户锁定问题](http://www.windowsecurity.com/articles/Implementing-Troubleshooting-Account-Lockout.html)**

使用这些工具，您可以查看它是否是您的应用程序中使用的过时凭据、错误的密码过载，或者您的应用程序不喜欢您的 AD 策略不喜欢的其他地方的一些安全性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T22:46:13.773

您的应用程序是否正在尝试访问网络资源，例如数据库、网络文件或 Web 服务器？

您是否不小心硬编码了一些过时的网络凭据（用户名和密码）？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T22:47:22.863

你在使用模拟吗？检查您的 web.config 以获取帐户信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T22:49:37.243

您是否对数据库、SSAS 多维数据集或其他对 AD 帐户使用用户/密码身份验证的项目进行身份验证？

如果是这种情况，并且您的应用程序尝试使用错误密码进行三次登录，AD 可能会锁定您的帐户（取决于其设置）。分析服务对此非常不利。

奈杰尔。

# regex - 递归浏览目录并替换字符串的 Shell 脚本

> ID：124374
> 
> 赞同：3
> 
> 时间：2008-09-23T22:44:44.277
> 
> 标签：regex, scripting

我需要递归搜索目录并在找到的所有文件中用另一个字符串（比如[http://development:port/URI](http://development:port/URI)）替换一个字符串（比如 http [://production:port/URI](http://production:port/URI)）。任何人都可以帮忙吗？

如果该脚本可以打印出它修改的文件并将搜索/替换模式作为输入参数，那就更好了。

问候。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T22:50:49.050

寻找 。-类型 f | xargs sed -is/模式/替换/g

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T22:49:13.500

试试这个：

```
find . -type f | xargs grep -l development | xargs perl -i.bak -p -e 's(http://development)(http://production)g' 
```

另一种反馈稍多的方法：

```
find . -type f | while read file
do
    grep development $file && echo "modifying $file" && perl -i.bak -p -e 's(http://development)(http://prodution)g' $file
done 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T22:48:35.060

听起来您会从间接层中受益。（但是，谁不会呢？）

我在想你可以只在一个位置使用特殊字符串。在运行时引用配置设置，或者在构建时使用正确的字符串生成这些文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-17T15:39:42.083

不要在工作的 SVN/CVS 目录中尝试上述操作，因为它还会修补 .svn/.cvs，这绝对不是您想要的。例如，要避免 .svn 修改，请使用：

```
find . -type f | fgrep -v .svn | xargs sed -i 's/pattern/replacement/g' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T09:03:15.480

使用`zsh`高级 globing，您只能使用一个命令。例如：

```
sed -i 's:pattern:target:g' ./** 
```

高温高压

# excel - 从 Excel VBA 编辑嵌入式 PowerPoint

> ID：124375
> 
> 赞同：4
> 
> 时间：2008-09-23T22:44:49.453
> 
> 标签：excel, powerpoint, vba

我在 Excel 工作簿中有一个嵌入的 PowerPoint 演示文稿。如何使用 VBA 编辑它（打开、复制幻灯片、向幻灯片添加数据、关闭）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T03:16:06.900

**1\. 向您的 VBA 应用程序添加对 PowerPoint 对象模型的引用**

在 VBA 窗口中，选择**工具 | 参考**
查找**Microsoft Powerpoint 12.0 对象库**并检查它

**2\. 选择并激活 PowerPoint 演示对象**

```
ActiveSheet.Shapes("Object 1").Select
Selection.Verb Verb:=xlOpen 
```

注意：此代码假定 PowerPoint 对象被命名为**Object 1**（查看左上角以查看它的真正名称）并且它位于活动工作表上。

**3.获取Presentation对象的引用**

```
Dim p As PowerPoint.Presentation
Set p = Selection.Object 
```

**4\. 操纵它**

您可以使用演示对象的所有方法和属性。这是添加幻灯片的示例：

```
p.Slides.Add 1, ppLayoutBlank 
```

**5.取消选择**

最简单的方法就是选择一个单元格。

```
[a1].Select 
```

希望有帮助！

# algorithm - 您将如何生成默认的用户个人资料图片？

> ID：124376
> 
> 赞同：13
> 
> 时间：2008-09-23T22:44:51.560
> 
> 标签：algorithm, identicon

我一直在欣赏 StackOverflow 的默认被子状个人资料图片（我注意到它也在[Fail Blog](http://failblog.org/)上）并且很好奇两者都使用什么程序来生成它们。

但我真正想知道的是：**如果你要设计系统来创建默认头像，你会怎么做？**

我正在寻找有关您将使用什么算法的想法，以及您如何将图像与用户相关联，无论是与他们的用户名相关，还是他们的进度的一些描述（即图像变得更复杂，或更大，因为他们获得了声誉）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T22:46:41.617

FWIW，默认图片是由[gravatar](http://gravatar.com)生成的，这就是为什么你会在这个网站上看到它们的原因。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T22:48:11.053

它被称为[Identicon](http://en.wikipedia.org/wiki/Identicon)。~~在 Stackoverflow 上，~~ **Gravatar**使用您的 IP 地址生成图像。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T22:48:49.320

这是一篇社论，不一定是答案。

本网站上的这些自动生成的头像来自一项服务（Gravatar），该服务专门专注于提供头像，因此是他们业务的核心。对于不是专门用于生成和显示头像的应用程序，我只会使用一个空的占位符（如 Facebook）。这是一个简洁的功能，但是当一个简单的占位符同样有效时，值得您花时间开发吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T22:47:42.210

一个非常好的图像来源是[火焰分形](http://en.wikipedia.org/wiki/Fractal_flame)。它们的计算成本相当高，因此应考虑简单地从[电羊](http://www.electricsheep.org/)之类的项目中采购它们或让它们由用户的计算机渲染，以减轻工作负担。

谁不想要这样的默认个人资料图片？

[替代文字 http://sheepserver.net/v2d6/gen/202/124809/icon.jpg](http://sheepserver.net/v2d6/gen/202/124809/icon.jpg) [替代文字 http://sheepserver.net/v2d6/gen/202/124805/icon.jpg](http://sheepserver.net/v2d6/gen/202/124805/icon.jpg) [替代文字 http://sheepserver。 net/v2d6/gen/202/125373/i77.jpg](http://sheepserver.net/v2d6/gen/202/125373/i77.jpg) [替代文字 http://sheepserver.net/v2d6/gen/202/125431/i116.jpg](http://sheepserver.net/v2d6/gen/202/125431/i116.jpg)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T22:51:38.517

几年前我做过类似的事情，我使用 POV-Ray 生成带有圆环（torii ？）和球体的小 3D 场景。有很多参数需要调整，例如每个对象的位置、大小和颜色。

POV-Ray 是一个可编写脚本的 3D 渲染引擎，您可以在[此处](http://www.povray.org/)找到它。

不幸的是，我的图像看起来都太相似了。我喜欢在这个网站上使用 Gravatar 的标识。我认为对称性很有帮助，并且形状足够独特，您可以相当清楚地识别用户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T22:47:16.280

使用 Julia 集或类似的东西，并将初始条件设置为用户电子邮件地址的哈希值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T22:48:14.157

我会使用 jpeg 服务器工具（aspjpg 或类似工具）在加载时操作图像，以便在他们的个人资料图片中显示他们的徽章。事实上，使用任何工具来动态生成图像都非常酷。应用某种 3d 或 flash 技术来动态创建图像，使用随机变量来改变眼睛间距或面部结构，这也是非常糟糕的。但是，这是一个奇怪的问题。哈哈！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-07T01:56:37.597

在 ruby​​ 中有一个库[http://github.com/swdyh/quilt](http://github.com/swdyh/quilt)来生成它！

# windows - 如何在 Hyper-V 中与 VM 实例共享主机 VPN 连接？

> ID：124378
> 
> 赞同：8
> 
> 时间：2008-09-23T22:45:48.937
> 
> 标签：windows, networking, hyper-v, connectivity

我在 Server 2008 上运行我的工作站，并在该服务器上的 Hyper-V VM 中运行一些服务器。我使用 VPN 从主操作系统（主机）连接到我的公司 LAN，但我的 VM 没有看到公司 LAN 中的服务器。互联网和本地访问我的家庭网络工作正常。每个 VM 都有一个虚拟网络适配器。

我应该怎么做才能让它发挥作用？

也许我需要提供更多细节，如果需要，请询问。

**更多细节：**

*   无法启动多个 VPN 连接
*   不通过主机使用 NAT
*   VM 从家庭网络路由器 (DHCP) 获取 IP 地址

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T20:05:36.363

就像我说的那样，您需要设置一些路线。通过作为网关的主机添加到您的公司 LAN 的路由。仅凭您告诉我它是从家里 DHCPP 获取它的事实就告诉我这就是问题所在。您的虚拟机只能看到 1 个默认网关，那就是互联网。虚拟机根本不知道主机上有 VPN。添加该路由（在 VM 机器上）会导致您的 VM 向您公司网络的子网发出的任何请求都通过您的主机而不是家庭路由器进行路由。

添加如下内容：

```
route ADD 10.0.0.0 MASK 255.0.0.0 192.168.1.30 
```

在您的虚拟机上会这样做：对 10\. 的任何请求*。*.* 网络将通过 IP 地址为 192.168.1.30 的计算机进行路由。所以用你的公司局域网替换 10.0.0.0 和子网，用你的主机 IP 替换 192 ip。那应该解决这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T23:15:29.037

您使用的是什么类型的 VPN？您使用的是内置的 windows VPN 客户端，还是必须安装客户端？

您可以在每个 VM 上独立设置 VPN 客户端，前提是您可以同时进行多个连接。

我不认为设置路由会起作用，因为那样您还需要在公司网络上设置路由。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T23:08:27.010

在您的路由表中设置一些路由。这实际上取决于它的设置方式，但是如果您可以在主机上正常访问您的公司网络，那么请在您的 vm 机器中设置路由。

另外，由于我不熟悉该 VM，因此 VMWares 之类的网络适配器是否桥接适配器？如果是这样，您需要设置路由以路由到您的主机。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T23:33:22.537

让我确定一些更清楚的事情。您的服务器就像它们在物理上与您的主机分开一样。因此，考虑到这一点，它们需要像分开一样进行设置。这意味着他们需要路由表中的路由。为什么？因为现在他们的默认路由是通过您的网关而不是您的主机到互联网。

简而言之，如果它们不是虚拟机并且它们是网络上的真实服务器，请按照您的方式处理问题。

但正如我在最初的回答中所问的那样，它们是否像 VMWare 桥接适配器。如果他们是我所说的立场。如果他们不是，那就另当别论了。例如，如果它们与您的主机在 NAT 中设置，VPN 应该已经可以工作。任何其他情况都需要进一步调查和更多信息。

# php - 连接中断。加载页面时重置与服务器的连接

> ID：124392
> 
> 赞同：2
> 
> 时间：2008-09-23T22:47:27.530
> 
> 标签：php, mysql, firefox

我正在使用 FF3 调用属于 MySQL/PHP Web 应用程序的 PHP 脚本。我在本地主机上运行 XAMPP。我得到的是：

> 连接中断
> 在页面加载时重置与服务器的连接。协商连接时网络链接中断。请再试一次。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-05-26T05:53:47.993

有许多可能的解决方案......取决于“为什么”......所以它最终会有点反复试验。在全新安装时，这很难确定。但是，如果您最近进行了“重大”更改，则可以开始寻找 - 比如修改虚拟主机或添加/启用 XDebug。

这是我过去使用/做过/尝试过的事情的清单

*   检查无限循环......特别是循环通过一个 SQL 提取结果，该结果在 99% 的时间内都有效，除了 1% 没有。在一种情况下，我使用前两个查询的结果作为 for 循环的上限和下限 ... 偶尔会得到 UINT max ... har har har ( *vomit* )的上限

*   将 ./php/libmysql.dll 复制到 windows/system32 目录（特别是如果您`Parent: child process exited with status 3221225477 -- Restarting`在日志文件中看到...请查看：[http](http://www.java-samples.com/showtutorial.php?tutorialid=1050) ://www.java-samples.com/showtutorial.php?tutorialid=1050 ）

*   如果您在运行时修改 PHP 的 error_reporting ...会做这种邪恶的黑客行为吗？*咳咳*）

*   如果您将 MySQL 转换为 MyISAM 或 mysqli 以外的其他内容

> MySQL 存在与 MyISAM、UTF8 字符集和索引相关的已知错误 (http://bugs.mysql.com/bug.php?id=4541) 解决方案是使用 InnoDB 方言 (例如 sql `set GLOBAL storage_engine='InnoDb';`)

*   这样做会改变新表的创建方式……这可能会*稍微*改变结果返回到 fetch 语句的方式……导致无限循环、格式错误的数据集等（尽管此更改不应挂起数据库本身）

其他有用的项目是在其配置文件中增加 PHP 和 apache 的调试报告并重新启动服务器。日志文件有时会提供至少问题可能出在*哪里的线索。*如果它在您的页面内容完成后发生，则更有可能在 php 设置中。如果是在页面构建期间，请检查您的 PHP 代码。等等等等。

希望上面的洗衣清单有一天能对某人有所帮助……可能是我自己，当我再次遇到它并回到这里寻找“我上次是怎么解决的？” ... :)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-16T23:31:27.607

您的脚本可能会陷入无限循环。如果这不适用，那么我会检查 TimB 建议的错误日志。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T22:54:51.973

听起来您正在调用的 PHP 脚本在没有返回有效响应的情况下失败。根据您设置的日志记录级别，这应该会在 Apache 日志文件中生成一个错误，这将使您对问题有所了解。我不熟悉 XAMPP，但您应该能够找出日志的位置，并查找在您向 PHP 脚本发出请求时发生的错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-06T04:43:00.850

将 libmysql.dll 复制到 apache\bin 文件夹可能会帮助您克服这个奇怪的错误

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-19T08:37:36.643

我解决了这个问题**升级 xampp\php\ext\xdebug\php_xdebug.dll** （更改为 php xdebug v.2.0.5-5.3-vc9 ）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-01T02:43:57.873

我有同样的问题，这就是我所做的。

我通过 php cli 脚本发出了 http get 命令，结果我在某处两次声明了一个类。

顺便说一句，我在 Mac 上使用 AMPPS

希望这对某人有所帮助！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T23:12:32.223

如果您在旧的 selfssl 工具（iis 6）中使用 Windows 2008 Server（iis 7）中的 ssl 证书，那就是问题所在。有时，Microsoft 会发布可以破坏所有这些旧证书的补丁。解决方案是再次生成它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T23:34:27.353

尝试在启用 Firebug 的情况下发出请求，看看你能从中得到什么信息；我总是发现使用 wget 有助于查看原始 HTTP 交互，而不必担心 Firefox 的 UI 元素会干扰。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-20T23:39:37.233

复制`libmysql.dll`到`apache\bin`文件夹可以帮助您克服这个奇怪的错误

确实，这帮助我解决了这个问题

> 加载页面时重置与服务器的连接。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-01T08:10:12.293

万一问题不起作用，这对我有用。1\. 我为 PHP 获得了一个新的 zip 目录并将其与 apache 连接 2\. 我在新 php 中搜索了 libmysql 并将其插入到 apache/bin 中，它是那里需要的 libmysql.dll 而不是 mySQL/ 的一种形式垃圾桶。

好的，至少那是有效的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-30T01:17:52.417

我遇到了一个非常相似的问题-不适用于提出此问题的人-但可能对正在阅读此页面的其他人有所帮助...

我遇到了一个问题，在某些情况下 PHP 5.4 + eAccelerator = 连接重置。任何日志文件中都没有错误输出，并且只发生在某些 URL 上，因此难以诊断。原来它只发生在某些 PHP 代码/某些 PHP 文件中，并且是由于与特定 PHP 代码和 eAccelerator 的一些不兼容。最简单的解决方案是禁用该特定站点的 eAccelerator，方法是将以下内容添加到 .htaccess 文件

php_flag eaccelerator.enable 0

php_flag eaccelerator.optimizer 0

（或 php.ini 中的等效行）：

eaccelerator.enable="0"

eaccelerator.optimizer="0"

# ruby-on-rails - 使用（restful）rails 时事务何时开始

> ID：124396
> 
> 赞同：7
> 
> 时间：2008-09-23T22:48:09.697
> 
> 标签：ruby-on-rails, ruby, rest, transactions

是否整个宁静动词都在一个包罗万象的事务之下？也就是说，如果我在处理 UPDATE、DELETE 或 CREATE 操作的任何时候在验证或回调中引发错误，我在以前的回调中执行的每个数据库操作是否也会回滚？简而言之，在任何回调或验证上引发错误是否会使该动词操作的数据库中根本没有发生任何变化？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T23:08:15.327

默认情况下，事务中没有编写数据库代码，您需要在代码中告诉它这样做。

```
def create
  Model.transaction do
    Model.create!(params[:model])
    Model.association.create!(params[:association])
  end
  rescue ActiveRecord::RecordNotSaved, ActiveRecord::RecordInvalid
    flash[:notice] = "That record could not be saved."
    render :action => "new"
end 
```

使用#create！方法将尝试保存记录，如果它们失败，它们将引发异常，然后回滚已在事务块内执行的任何代码。

如果您不挽救该操作，您将被重定向到（我认为）公共目录中的 405.html（如果存在）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T23:37:03.433

> 是否整个宁静动词都在一个包罗万象的事务之下？

不

> 如果我在处理 UPDATE、DELETE 或 CREATE 操作的任何时候在验证或回调中引发错误，我在以前的回调中执行的每个数据库操作是否也会回滚？

不。

> 在任何回调或验证上引发错误是否会使数据库中对该动词操作完全没有更改？

不。

如果您想要这种行为，您可以在控制器中显式创建事务（参见其他用户提供的示例），或者使用 an`around_filter`将行为附加到您的所有 restful 操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T23:07:25.267

一些方法（创建、销毁）会立即进入数据库。事务通过在从 ActiveRecord 派生的类上使用事务方法发生，如下所示：

```
Student.transaction do
  Course.transaction do
    course.enroll(student)
    student.units += course.units
  end
end 
```

（这个例子是针对多个数据库的。对于单个数据库，您只需要一个事务。）

然后，您可以回滚这些事务，事务中引发的异常会在回滚后传播。

这取决于具有事务的数据库。

注意：保存和销毁都包含在事务中。

# gcc - 使用内部函数时如何让 GCC 使用两个以上的 SIMD 寄存器？

> ID：124405
> 
> 赞同：12
> 
> 时间：2008-09-23T22:49:22.830
> 
> 标签：gcc, assembly, x86, sse, simd

我正在编写一些代码并尝试使用 SIMD 内在函数 SSE2/3 来加速它。我的代码具有这样的性质，以至于我需要将一些数据加载到 XMM 寄存器中并对其进行多次操作。当我查看生成的汇编代码时，似乎 GCC 不断将数据刷新回内存，以便重新加载 XMM0 和 XMM1 中的其他内容。我正在为 x86-64 编译，所以我有 15 个寄存器。为什么 GCC 只使用两个，我该怎么做才能让它使用更多？有什么方法可以“固定”寄存器中的某个值吗？我在变量定义中添加了“register”关键字，但生成的汇编代码是相同的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T22:58:57.500

是的你可以。[Explicit Reg Vars](http://gcc.gnu.org/onlinedocs/gcc/Explicit-Reg-Vars.html)讨论了将变量固定到特定寄存器所需的语法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T23:06:46.703

如果您要为每个内在函数指定单独的寄存器，那么您最好只编写程序集目录，特别是考虑到 gcc 在许多情况下不必要地悲观内在函数的讨厌习惯。

# .net - 使用 .Net，我如何确定一个类型是否为 Numeric ValueType？

> ID：124411
> 
> 赞同：49
> 
> 时间：2008-09-23T22:50:40.173
> 
> 标签：.net, reflection

但这里有一个例子：

```
Dim desiredType as Type
if IsNumeric(desiredType) then ... 
```

**编辑：**我只知道类型，而不是值作为字符串。

好的，很遗憾我必须循环浏览 TypeCode。

但这是一个很好的方法：

```
 if ((desiredType.IsArray))
      return 0;

 switch (Type.GetTypeCode(desiredType))
 {
      case 3:
      case 6:
      case 7:
      case 9:
      case 11:
      case 13:
      case 14:
      case 15:
          return 1;
 }
 ;return 0; 
```

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2011-03-03T15:24:52.837

这里晚了几年，但这是我的解决方案（您可以选择是否包含布尔值）。解决 Nullable 情况。包括 XUnit 测试

```
/// <summary>
/// Determines if a type is numeric.  Nullable numeric types are considered numeric.
/// </summary>
/// <remarks>
/// Boolean is not considered numeric.
/// </remarks>
public static bool IsNumericType( Type type )
{
    if (type == null)
    {
        return false;
    }

    switch (Type.GetTypeCode(type))
    {
        case TypeCode.Byte:
        case TypeCode.Decimal:
        case TypeCode.Double:
        case TypeCode.Int16:
        case TypeCode.Int32:
        case TypeCode.Int64:
        case TypeCode.SByte:
        case TypeCode.Single:
        case TypeCode.UInt16:
        case TypeCode.UInt32:
        case TypeCode.UInt64:
            return true;
        case TypeCode.Object:
            if ( type.IsGenericType && type.GetGenericTypeDefinition() == typeof(Nullable<>))
            {
               return IsNumericType(Nullable.GetUnderlyingType(type));
            }
            return false;
    }
    return false;
}

/// <summary>
/// Tests the IsNumericType method.
/// </summary>
[Fact]
public void IsNumericTypeTest()
{
    // Non-numeric types
    Assert.False(TypeHelper.IsNumericType(null));
    Assert.False(TypeHelper.IsNumericType(typeof(object)));
    Assert.False(TypeHelper.IsNumericType(typeof(DBNull)));
    Assert.False(TypeHelper.IsNumericType(typeof(bool)));
    Assert.False(TypeHelper.IsNumericType(typeof(char)));
    Assert.False(TypeHelper.IsNumericType(typeof(DateTime)));
    Assert.False(TypeHelper.IsNumericType(typeof(string)));

    // Arrays of numeric and non-numeric types
    Assert.False(TypeHelper.IsNumericType(typeof(object[])));
    Assert.False(TypeHelper.IsNumericType(typeof(DBNull[])));
    Assert.False(TypeHelper.IsNumericType(typeof(bool[])));
    Assert.False(TypeHelper.IsNumericType(typeof(char[])));
    Assert.False(TypeHelper.IsNumericType(typeof(DateTime[])));
    Assert.False(TypeHelper.IsNumericType(typeof(string[])));
    Assert.False(TypeHelper.IsNumericType(typeof(byte[])));
    Assert.False(TypeHelper.IsNumericType(typeof(decimal[])));
    Assert.False(TypeHelper.IsNumericType(typeof(double[])));
    Assert.False(TypeHelper.IsNumericType(typeof(short[])));
    Assert.False(TypeHelper.IsNumericType(typeof(int[])));
    Assert.False(TypeHelper.IsNumericType(typeof(long[])));
    Assert.False(TypeHelper.IsNumericType(typeof(sbyte[])));
    Assert.False(TypeHelper.IsNumericType(typeof(float[])));
    Assert.False(TypeHelper.IsNumericType(typeof(ushort[])));
    Assert.False(TypeHelper.IsNumericType(typeof(uint[])));
    Assert.False(TypeHelper.IsNumericType(typeof(ulong[])));

    // numeric types
    Assert.True(TypeHelper.IsNumericType(typeof(byte)));
    Assert.True(TypeHelper.IsNumericType(typeof(decimal)));
    Assert.True(TypeHelper.IsNumericType(typeof(double)));
    Assert.True(TypeHelper.IsNumericType(typeof(short)));
    Assert.True(TypeHelper.IsNumericType(typeof(int)));
    Assert.True(TypeHelper.IsNumericType(typeof(long)));
    Assert.True(TypeHelper.IsNumericType(typeof(sbyte)));
    Assert.True(TypeHelper.IsNumericType(typeof(float)));
    Assert.True(TypeHelper.IsNumericType(typeof(ushort)));
    Assert.True(TypeHelper.IsNumericType(typeof(uint)));
    Assert.True(TypeHelper.IsNumericType(typeof(ulong)));

    // Nullable non-numeric types
    Assert.False(TypeHelper.IsNumericType(typeof(bool?)));
    Assert.False(TypeHelper.IsNumericType(typeof(char?)));
    Assert.False(TypeHelper.IsNumericType(typeof(DateTime?)));

    // Nullable numeric types
    Assert.True(TypeHelper.IsNumericType(typeof(byte?)));
    Assert.True(TypeHelper.IsNumericType(typeof(decimal?)));
    Assert.True(TypeHelper.IsNumericType(typeof(double?)));
    Assert.True(TypeHelper.IsNumericType(typeof(short?)));
    Assert.True(TypeHelper.IsNumericType(typeof(int?)));
    Assert.True(TypeHelper.IsNumericType(typeof(long?)));
    Assert.True(TypeHelper.IsNumericType(typeof(sbyte?)));
    Assert.True(TypeHelper.IsNumericType(typeof(float?)));
    Assert.True(TypeHelper.IsNumericType(typeof(ushort?)));
    Assert.True(TypeHelper.IsNumericType(typeof(uint?)));
    Assert.True(TypeHelper.IsNumericType(typeof(ulong?)));

    // Testing with GetType because of handling with non-numerics. See:
    // http://msdn.microsoft.com/en-us/library/ms366789.aspx

    // Using GetType - non-numeric
    Assert.False(TypeHelper.IsNumericType((new object()).GetType()));
    Assert.False(TypeHelper.IsNumericType(DBNull.Value.GetType()));
    Assert.False(TypeHelper.IsNumericType(true.GetType()));
    Assert.False(TypeHelper.IsNumericType('a'.GetType()));
    Assert.False(TypeHelper.IsNumericType((new DateTime(2009, 1, 1)).GetType()));
    Assert.False(TypeHelper.IsNumericType(string.Empty.GetType()));

    // Using GetType - numeric types
    // ReSharper disable RedundantCast
    Assert.True(TypeHelper.IsNumericType((new byte()).GetType()));
    Assert.True(TypeHelper.IsNumericType(43.2m.GetType()));
    Assert.True(TypeHelper.IsNumericType(43.2d.GetType()));
    Assert.True(TypeHelper.IsNumericType(((short)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(((int)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(((long)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(((sbyte)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(2f.GetType()));
    Assert.True(TypeHelper.IsNumericType(((ushort)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(((uint)2).GetType()));
    Assert.True(TypeHelper.IsNumericType(((ulong)2).GetType()));
    // ReSharper restore RedundantCast

    // Using GetType - nullable non-numeric types
    bool? nullableBool = true;
    Assert.False(TypeHelper.IsNumericType(nullableBool.GetType()));
    char? nullableChar = ' ';
    Assert.False(TypeHelper.IsNumericType(nullableChar.GetType()));
    DateTime? nullableDateTime = new DateTime(2009, 1, 1);
    Assert.False(TypeHelper.IsNumericType(nullableDateTime.GetType()));

    // Using GetType - nullable numeric types
    byte? nullableByte = 12;
    Assert.True(TypeHelper.IsNumericType(nullableByte.GetType()));
    decimal? nullableDecimal = 12.2m;
    Assert.True(TypeHelper.IsNumericType(nullableDecimal.GetType()));
    double? nullableDouble = 12.32;
    Assert.True(TypeHelper.IsNumericType(nullableDouble.GetType()));
    short? nullableInt16 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableInt16.GetType()));
    short? nullableInt32 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableInt32.GetType()));
    short? nullableInt64 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableInt64.GetType()));
    sbyte? nullableSByte = 12;
    Assert.True(TypeHelper.IsNumericType(nullableSByte.GetType()));
    float? nullableSingle = 3.2f;
    Assert.True(TypeHelper.IsNumericType(nullableSingle.GetType()));
    ushort? nullableUInt16 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableUInt16.GetType()));
    ushort? nullableUInt32 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableUInt32.GetType()));
    ushort? nullableUInt64 = 12;
    Assert.True(TypeHelper.IsNumericType(nullableUInt64.GetType()));
} 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-23T22:56:28.117

您可以使用以下`Type.GetTypeCode()`方法确定变量是否为数字：

```
TypeCode typeCode = Type.GetTypeCode(desiredType);

if (typeCode == TypeCode.Double || typeCode == TypeCode.Integer || ...)
     return true; 
```

您需要在“...”部分完成所有可用的数字类型；）

更多详细信息：[TypeCode 枚举](http://msdn.microsoft.com/en-us/library/system.typecode.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T23:04:02.480

伟大的文章在这里[探索 IsNumeric for C#](http://www.hanselman.com/blog/ExploringIsNumericForC.aspx)。

**选项1：**

引用 Microsoft.VisualBasic.dll，然后执行以下操作：

```
if (Microsoft.VisualBasic.Information.IsNumeric("5"))
{
 //Do Something
} 
```

**选项 2：**

```
public static bool Isumeric (object Expression)
{
    bool f;
    ufloat64 a;
    long l;

    IConvertible iConvertible = null;
    if ( ((Expression is IConvertible)))
    {
       iConvertible = (IConvertible) Expression;
    }

    if (iConvertible == null)
{
   if ( ((Expression is char[])))
   {
       Expression = new String ((char[]) Expression);
       goto IL_002d; // hopefully inserted by optimizer
   }
   return 0;
}
IL_002d:
TypeCode typeCode = iConvertible.GetTypeCode ();
if ((typeCode == 18) || (typeCode == 4))
{
    string str = iConvertible.ToString (null);
   try
   {
        if ( (StringType.IsHexOrOctValue (str, l)))
   {
        f = true;
        return f;
   }
}
catch (Exception )
{
    f = false;
    return f;
};
return DoubleType.TryParse (str, a);
}
return Utils.IsNumericTypeCode (typeCode);
}

internal static bool IsNumericType (Type typ)
{
bool f;
TypeCode typeCode;
if ( (typ.IsArray))
{
    return 0;
}
switch (Type.GetTypeCode (typ))
{
case 3: 
case 6: 
case 7: 
case 9: 
case 11: 
case 13: 
case 14: 
case 15: 
   return 1;
};
return 0;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-05-22T19:18:45.137

如果您有对实际对象的引用，这里有一个简单的 C# 解决方案，非常简单：

```
 /// <summary>
    /// Determines whether the supplied object is a .NET numeric system type
    /// </summary>
    /// <param name="val">The object to test</param>
    /// <returns>true=Is numeric; false=Not numeric</returns>
    public static bool IsNumeric(ref object val)
    {
        if (val == null)
            return false;

        // Test for numeric type, returning true if match
        if 
            (
            val is double || val is float || val is int || val is long || val is decimal || 
            val is short || val is uint || val is ushort || val is ulong || val is byte || 
            val is sbyte
            )
            return true;

        // Not numeric
        return false;
    } 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-07-29T19:13:54.647

感谢@SFun28 和@nawfal（谢谢！），我使用了他们的两个答案，稍作调整并提出了这些扩展方法：

```
public static class ReflectionExtensions
{
    public static bool IsNullable(this Type type) {
        return
            type != null &&
            type.IsGenericType && 
            type.GetGenericTypeDefinition() == typeof(Nullable<>);
    }

    public static bool IsNumeric(this Type type) {
        if (type == null || type.IsEnum)
            return false;

        if (IsNullable(type))
            return IsNumeric(Nullable.GetUnderlyingType(type));

        switch (Type.GetTypeCode(type)) {
            case TypeCode.Byte:
            case TypeCode.Decimal:
            case TypeCode.Double:
            case TypeCode.Int16:
            case TypeCode.Int32:
            case TypeCode.Int64:
            case TypeCode.SByte:
            case TypeCode.Single:
            case TypeCode.UInt16:
            case TypeCode.UInt32:
            case TypeCode.UInt64:
                return true;
            default:
                return false;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-03-07T17:18:47.173

我知道这是一个非常晚的答案，但这是我使用的功能：

```
public static bool IsNumeric(Type type)
{
    var t = Nullable.GetUnderlyingType(type) ?? type;
    return t.IsPrimitive || t == typeof(decimal);
} 
```

如果您想排除`char`为数字类型，则可以使用以下示例：

```
return (t.IsPrimitive || t == typeof(decimal)) && t != typeof(char); 
```

[根据 MSDN](https://msdn.microsoft.com/en-us/library/system.type.isprimitive(v=vs.110).aspx)：

> 基本类型是 Boolean、Byte、SByte、Int16、UInt16、Int32、UInt32、Int64、UInt64、IntPtr、UIntPtr、Char、Double 和 Single。

注意：此检查包括**IntPtr**和**UIntPtr**。

这是与通用扩展方法相同的功能（我知道这不适用于 OP 的情况，但其他人可能会发现它很有用）：

```
public static bool IsNumeric<T>(this T value)
{
    var t = Nullable.GetUnderlyingType(value.GetType()) ?? value.GetType();
    return t.IsPrimitive || t == typeof(decimal);
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-01-18T12:41:05.840

这就是 MS 如何在`System.Dynamic.Utils.TypeUtils`内部类中实现它的。结果他们不认为`System.Decimal`是数字类型（`Decimal`从枚举中省略）。有趣的是，MS 发现`System.Char`类型是数字的。否则，它与 SFun28 的答案完全相同。**我想他的回答是“更正确”。**

```
internal static bool IsNumeric(Type type)
{
    type = type.GetNonNullableType();
    if (!type.IsEnum)
    {
        switch (Type.GetTypeCode(type))
        {
        case TypeCode.Char:
        case TypeCode.SByte:
        case TypeCode.Byte:
        case TypeCode.Int16:
        case TypeCode.UInt16:
        case TypeCode.Int32:
        case TypeCode.UInt32:
        case TypeCode.Int64:
        case TypeCode.UInt64:
        case TypeCode.Single:
        case TypeCode.Double:
            return true;
        }
    }
    return false;
}

//where GetNonNullableType is defined as

internal static Type GetNonNullableType(this Type type)
{
    if (type.IsNullableType())
    {
        return type.GetGenericArguments()[0];
    }
    return type;
}

//where IsNullableType is defined as

internal static bool IsNullableType(this Type type)
{
    return type.IsGenericType && type.GetGenericTypeDefinition() == typeof(Nullable<>);
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-03-15T17:30:47.557

```
''// Return true if a type is a numeric type.
Private Function IsNumericType(ByVal this As Type) As Boolean
    ''// All the numeric types have bits 11xx set whereas non numeric do not.
    ''// That is if you include char type which is 4(decimal) = 100(binary).
    If this.IsArray Then Return False
    If (Type.GetTypeCode(this) And &HC) > 0 Then Return True
    Return False
End Function 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-08-07T14:35:38.363

您现在可以使用 .NET Framework 方法

```
typeof(decimal?).IsNumericType() 
```

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2008-09-23T23:12:32.697

使用 Type.IsValueType() 和 TryParse()：

```
public bool IsInteger(Type t)
{
   int i;
   return t.IsValueType && int.TryParse(t.ToString(), out i);
} 
```

# sql - SQL Server 中是否有一个 Max 函数，它接受两个值，例如 .NET 中的 Math.Max？

> ID：124417
> 
> 赞同：575
> 
> 时间：2008-09-23T22:52:03.837
> 
> 标签：sql, sql-server, max

我想写一个这样的查询：

```
SELECT o.OrderId, MAX(o.NegotiatedPrice, o.SuggestedPrice)
FROM Order o 
```

但这不是`MAX`函数的工作方式，对吧？它是一个聚合函数，因此它需要一个参数，然后返回所有行的 MAX。

有谁知道如何按照我的方式做？

* * *

## 回答 #1

> 赞同：537
> 
> 时间：2012-02-25T23:55:17.270

如果您使用的是 SQL Server 2008（或更高版本），那么这是更好的解决方案：

```
SELECT o.OrderId,
       (SELECT MAX(Price)
        FROM (VALUES (o.NegotiatedPrice),(o.SuggestedPrice)) AS AllPrices(Price))
FROM Order o 
```

所有的信用和投票都应该[归于 Sven 对相关问题的回答，“SQL MAX of multiple columns？”](https://stackoverflow.com/a/6871572/2865345)
我说这是“*最佳答案*”，因为：

1.  它不需要使用 UNION、PIVOT、UNPIVOT、UDF 和疯狂的 CASE 语句使您的代码复杂化。
2.  它不受处理空值问题的困扰，它处理得很好。
3.  用“MIN”、“AVG”或“SUM”替换“MAX”很容易。您可以使用任何聚合函数来查找许多不同列的聚合。
4.  您不限于我使用的名称（即“AllPrices”和“Price”）。您可以选择自己的名字，以便下一个人更容易阅读和理解。
5.  您可以使用 SQL Server 2008 的[derived_tables](http://msdn.microsoft.com/en-us/library/ms177634.aspx)找到多个聚合，如下所示：
    SELECT MAX(a), MAX(b) FROM (VALUES (1, 2), (3, 4), (5, 6), (7, 8), (9, 10) ) AS MyTable(a, b)

* * *

## 回答 #2

> 赞同：244
> 
> 时间：2008-11-16T11:45:57.837

可以在一行中完成：

```
-- the following expression calculates ==> max(@val1, @val2)
SELECT 0.5 * ((@val1 + @val2) + ABS(@val1 - @val2)) 
```

**编辑：** *如果您正在处理非常大的数字，则必须将值变量转换为 bigint 以避免整数溢出。*

* * *

## 回答 #3

> 赞同：182
> 
> 时间：2008-09-23T23:03:06.697

如果您想使用与示例类似的语法，则需要制作 a ，但是您能否像其他人所说的那样，`User-Defined Function`用语句相当容易地做您想做的事情，内联。`CASE`

`UDF`可能是这样的：

```
create function dbo.InlineMax(@val1 int, @val2 int)
returns int
as
begin
  if @val1 > @val2
    return @val1
  return isnull(@val2,@val1)
end 
```

......你会这样称呼它......

```
SELECT o.OrderId, dbo.InlineMax(o.NegotiatedPrice, o.SuggestedPrice) 
FROM Order o 
```

* * *

## 回答 #4

> 赞同：134
> 
> 时间：2008-09-23T22:56:15.887

我不这么认为。前几天我想要这个。我得到的最接近的是：

```
SELECT
  o.OrderId,
  CASE WHEN o.NegotiatedPrice > o.SuggestedPrice THEN o.NegotiatedPrice 
     ELSE o.SuggestedPrice
  END
FROM Order o 
```

* * *

## 回答 #5

> 赞同：119
> 
> 时间：2016-06-21T01:57:13.170

为什么不试试**IIF**功能（需要 SQL Server 2012 及更高版本）

```
IIF(a>b, a, b) 
```

就是这样。

（提示：要小心其中一个`null`是`a>b``b`

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2010-05-20T14:09:08.580

```
DECLARE @MAX INT
@MAX = (SELECT MAX(VALUE) 
               FROM (SELECT 1 AS VALUE UNION 
                     SELECT 2 AS VALUE) AS T1) 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2019-02-13T21:16:36.823

在 SQL Server 2012 或更高版本中，您可以使用`IIF`和`ISNULL`（或`COALESCE`）的组合来获得 2 个值的最大值。
即使其中 1 个为 NULL。

```
IIF(col1 >= col2, col1, ISNULL(col2, col1)) 
```

或者，如果您希望它在两者都为 NULL 时返回 0

```
IIF(col1 >= col2, col1, COALESCE(col2, col1, 0)) 
```

*示例片段：*

```
-- use table variable for testing purposes
declare @Order table 
(
  OrderId int primary key identity(1,1),
  NegotiatedPrice decimal(10,2),
  SuggestedPrice decimal(10,2)
);

-- Sample data
insert into @Order (NegotiatedPrice, SuggestedPrice) values
(0, 1),
(2, 1),
(3, null),
(null, 4);

-- Query
SELECT 
     o.OrderId, o.NegotiatedPrice, o.SuggestedPrice, 
     IIF(o.NegotiatedPrice >= o.SuggestedPrice, o.NegotiatedPrice, ISNULL(o.SuggestedPrice, o.NegotiatedPrice)) AS MaxPrice
FROM @Order o 
```

*结果：*

```
OrderId NegotiatedPrice SuggestedPrice  MaxPrice
1       0,00            1,00            1,00
2       2,00            1,00            2,00
3       3,00            NULL            3,00
4       NULL            4,00            4,00 
```

但是如果一个人需要多列的最大值呢？
然后我建议对 VALUES 的聚合进行 CROSS APPLY。

例子：

```
SELECT t.*
, ca.[Maximum]
, ca.[Minimum], ca.[Total], ca.[Average]
FROM SomeTable t
CROSS APPLY (
   SELECT 
    MAX(v.col) AS [Maximum], 
    MIN(v.col) AS [Minimum], 
    SUM(v.col) AS [Total], 
    AVG(v.col) AS [Average]
   FROM (VALUES (t.Col1), (t.Col2), (t.Col3), (t.Col4)) v(col)
) ca 
```

这具有额外的好处，即可以同时计算其他事物。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-09-24T02:41:39.137

其他答案很好，但如果你不得不担心有 NULL 值，你可能需要这个变体：

```
SELECT o.OrderId, 
   CASE WHEN ISNULL(o.NegotiatedPrice, o.SuggestedPrice) > ISNULL(o.SuggestedPrice, o.NegotiatedPrice)
        THEN ISNULL(o.NegotiatedPrice, o.SuggestedPrice)
        ELSE ISNULL(o.SuggestedPrice, o.NegotiatedPrice)
   END
FROM Order o 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2010-10-21T15:53:22.500

子查询可以访问外部查询中的列，因此您可以使用[这种方法](http://sqlblogcasts.com/blogs/simons/archive/2006/05/08/Neat-trick-to-find-max-value-of-multiple-columns.aspx)来使用聚合，例如`MAX`跨列。（当涉及更多列时可能更有用）

```
;WITH [Order] AS
(
SELECT 1 AS OrderId, 100 AS NegotiatedPrice, 110 AS SuggestedPrice UNION ALL
SELECT 2 AS OrderId, 1000 AS NegotiatedPrice, 50 AS SuggestedPrice
)
SELECT
       o.OrderId, 
       (SELECT MAX(price)FROM 
           (SELECT o.NegotiatedPrice AS price 
            UNION ALL SELECT o.SuggestedPrice) d) 
        AS MaxPrice 
FROM  [Order]  o 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2018-09-12T13:14:01.600

```
SELECT o.OrderId,   
--MAX(o.NegotiatedPrice, o.SuggestedPrice)  
(SELECT MAX(v) FROM (VALUES (o.NegotiatedPrice), (o.SuggestedPrice)) AS value(v)) as ChoosenPrice  
FROM Order o 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2020-10-13T02:07:35.067

试试这个。它可以处理超过 2 个值

```
SELECT Max(v) FROM (VALUES (1), (2), (3)) AS value(v) 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-09-24T09:56:59.183

[我会使用kcrumley](https://stackoverflow.com/questions/124417/is-there-a-max-function-in-sql-server-that-takes-two-values-like-mathmax-in-net#124474)提供的解决方案 只需稍微修改它以处理 NULL

```
create function dbo.HigherArgumentOrNull(@val1 int, @val2 int)
returns int
as
begin
  if @val1 >= @val2
    return @val1
  if @val1 < @val2
    return @val2

 return NULL
end 
```

**编辑在**[Mark](https://stackoverflow.com/users/2199/mark-brackett) 评论后修改。正如他在 3 值逻辑 x > NULL 或 x < NULL 中正确指出的那样，应始终返回 NULL。换句话说，未知的结果。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-06-26T16:51:24.433

SQL Server 2012 引入[`IIF`](http://msdn.microsoft.com/en-us/library/hh213574%28v=sql.110%29.aspx)：

```
SELECT 
    o.OrderId, 
    IIF( ISNULL( o.NegotiatedPrice, 0 ) > ISNULL( o.SuggestedPrice, 0 ),
         o.NegotiatedPrice, 
         o.SuggestedPrice 
    )
FROM 
    Order o 
```

使用 时建议处理 NULL `IIF`，因为 a`NULL`在您的任一侧`boolean_expression`都会导致`IIF`返回`false_value`（而不是`NULL`）。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2014-02-24T15:20:25.087

它就像这样简单：

```
CREATE FUNCTION InlineMax
(
    @p1 sql_variant,
    @p2 sql_variant
)  RETURNS sql_variant
AS
BEGIN
    RETURN CASE 
        WHEN @p1 IS NULL AND @p2 IS NOT NULL THEN @p2 
        WHEN @p2 IS NULL AND @p1 IS NOT NULL THEN @p1
        WHEN @p1 > @p2 THEN @p1
        ELSE @p2 END
END; 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-09-23T23:02:26.057

我可能不会这样做，因为它比已经提到的 CASE 构造效率低 - 除非，也许，你有两个查询的覆盖索引。无论哪种方式，它都是解决类似问题的有用技术：

```
SELECT OrderId, MAX(Price) as Price FROM (
   SELECT o.OrderId, o.NegotiatedPrice as Price FROM Order o
   UNION ALL
   SELECT o.OrderId, o.SuggestedPrice as Price FROM Order o
) as A
GROUP BY OrderId 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2008-10-13T08:18:46.010

哎呀，我刚刚发布了[这个问题的欺骗](https://stackoverflow.com/questions/196256/returning-the-largest-of-2-columns-in-sql-server)......

答案是，没有像[Oracle 的 Greatest](http://techonthenet.com/oracle/functions/greatest.php)那样的内置函数，但是您可以使用 UDF 为 2 列实现类似的结果，注意，这里使用 sql_variant 非常重要。

```
create table #t (a int, b int) 

insert #t
select 1,2 union all 
select 3,4 union all
select 5,2

-- option 1 - A case statement
select case when a > b then a else b end
from #t

-- option 2 - A union statement 
select a from #t where a >= b 
union all 
select b from #t where b > a 

-- option 3 - A udf
create function dbo.GREATEST
( 
    @a as sql_variant,
    @b as sql_variant
)
returns sql_variant
begin   
    declare @max sql_variant 
    if @a is null or @b is null return null
    if @b > @a return @b  
    return @a 
end

select dbo.GREATEST(a,b)
from #t 
```

[克里斯托夫](https://stackoverflow.com/users/3241/kristof)

发布了这个答案：

```
create table #t (id int IDENTITY(1,1), a int, b int)
insert #t
select 1,2 union all
select 3,4 union all
select 5,2

select id, max(val)
from #t
    unpivot (val for col in (a, b)) as unpvt
group by id 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2010-10-21T15:46:23.173

对于上面关于大数的答案，您可以在加法/减法之前进行乘法运算。它有点笨重，但不需要演员表。（我不能说速度，但我认为它仍然很快）

> 选择 0.5 * ((@val1 + @val2) + ABS(@val1 - @val2))

更改为

> 选择@val1*0.5+@val2*0.5 + ABS(@val1*0.5 - @val2*0.5)

如果您想避免强制转换，至少是另一种选择。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2016-10-24T14:35:00.267

这是一个应该处理空值并将与旧版本的 MSSQL 一起使用的案例示例。这是基于其中一个流行示例中的内联函数：

```
case
  when a >= b then a
  else isnull(b,a)
end 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2019-02-12T15:26:26.177

```
 -- Simple way without "functions" or "IF" or "CASE"
 -- Query to select maximum value
 SELECT o.OrderId
  ,(SELECT MAX(v)
   FROM (VALUES (o.NegotiatedPrice), (o.SuggestedPrice)) AS value(v)) AS MaxValue
  FROM Order o; 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2021-04-14T17:23:11.943

**就在这里。**

T-SQL 现在支持 GREATEST/LEAST 函数：

> [MAX/MIN 作为非聚合函数](https://feedback.azure.com/forums/908035-sql-server/suggestions/32902729-max-min-as-non-aggregate-function)
> 
> 这现在适用于 Azure SQL 数据库和 SQL 托管实例。它将滚动到 SQL Server 的下一个版本。

**[逻辑函数 - 最棒的 (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/functions/logical-functions-greatest-transact-sql?view=sql-server-ver15)**

> 此函数返回一个或多个表达式列表中的最大值。
> 
> ```
> GREATEST ( expression1 [ ,...expressionN ] ) 
> ```

所以在这种情况下：

```
SELECT o.OrderId, GREATEST(o.NegotiatedPrice, o.SuggestedPrice)
FROM Order o 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-09-23T22:57:18.003

你可以这样做：

```
select case when o.NegotiatedPrice > o.SuggestedPrice 
then o.NegotiatedPrice
else o.SuggestedPrice
end 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-09-23T22:57:20.297

```
SELECT o.OrderID
CASE WHEN o.NegotiatedPrice > o.SuggestedPrice THEN
 o.NegotiatedPrice
ELSE
 o.SuggestedPrice
END AS Price 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-06-07T16:37:43.873

```
CREATE FUNCTION [dbo].[fnMax] (@p1 INT, @p2 INT)
RETURNS INT
AS BEGIN

    DECLARE @Result INT

    SET @p2 = COALESCE(@p2, @p1)

    SELECT
        @Result = (
                   SELECT
                    CASE WHEN @p1 > @p2 THEN @p1
                         ELSE @p2
                    END
                  )

    RETURN @Result

END 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2017-04-20T15:16:38.137

这是@Scott Langham 的简单 NULL 处理答案：

```
SELECT
      o.OrderId,
      CASE WHEN (o.NegotiatedPrice > o.SuggestedPrice OR o.SuggestedPrice IS NULL) 
         THEN o.NegotiatedPrice 
         ELSE o.SuggestedPrice
      END As MaxPrice
FROM Order o 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2017-09-06T11:55:00.267

这是一个带有 NULL 处理的 IIF 版本（基于 Xin 的回答）：

```
IIF(a IS NULL OR b IS NULL, ISNULL(a,b), IIF(a > b, a, b)) 
```

逻辑如下，如果其中一个值为 NULL，则返回不为 NULL 的那个（如果两者都为 NULL，则返回 NULL）。否则返回较大的那个。

MIN 也可以这样做。

```
IIF(a IS NULL OR b IS NULL, ISNULL(a,b), IIF(a < b, a, b)) 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2017-10-04T14:48:42.157

```
select OrderId, (
    select max([Price]) from (
        select NegotiatedPrice [Price]
        union all
        select SuggestedPrice
    ) p
) from [Order] 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-02-18T19:42:05.477

以最简单的形式...

```
CREATE FUNCTION fnGreatestInt (@Int1 int, @Int2 int )
RETURNS int
AS
BEGIN

    IF @Int1 >= ISNULL(@Int2,@Int1)
        RETURN @Int1
    ELSE
        RETURN @Int2

    RETURN NULL --Never Hit

END 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2015-12-07T12:45:35.557

对于 SQL Server 2012：

```
SELECT 
    o.OrderId, 
    IIF( o.NegotiatedPrice >= o.SuggestedPrice,
         o.NegotiatedPrice, 
         ISNULL(o.SuggestedPrice, o.NegiatedPrice) 
    )
FROM 
    Order o 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-02-13T20:49:58.923

扩展 Xin 的答案并假设比较值类型是 INT，这种方法也适用：

```
SELECT IIF(ISNULL(@A, -2147483648) > ISNULL(@B, -2147483648), @A, @B) 
```

这是带有示例值的完整测试：

```
DECLARE @A AS INT
DECLARE @B AS INT

SELECT  @A = 2, @B = 1
SELECT  IIF(ISNULL(@A, -2147483648) > ISNULL(@B, -2147483648), @A, @B)
-- 2

SELECT  @A = 2, @B = 3
SELECT  IIF(ISNULL(@A, -2147483648) > ISNULL(@B, -2147483648), @A, @B)
-- 3

SELECT  @A = 2, @B = NULL
SELECT  IIF(ISNULL(@A, -2147483648) > ISNULL(@B, -2147483648), @A, @B)
-- 2    

SELECT  @A = NULL, @B = 1
SELECT  IIF(ISNULL(@A, -2147483648) > ISNULL(@B, -2147483648), @A, @B)
-- 1 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2019-11-27T14:37:36.273

在 MemSQL 中执行以下操作：

```
-- DROP FUNCTION IF EXISTS InlineMax;
DELIMITER //
CREATE FUNCTION InlineMax(val1 INT, val2 INT) RETURNS INT AS
DECLARE
  val3 INT = 0;
BEGIN
 IF val1 > val2 THEN
   RETURN val1;
 ELSE
   RETURN val2;
 END IF; 
END //
DELIMITER ;

SELECT InlineMax(1,2) as test; 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2017-11-13T00:27:23.287

在 Presto 中，您可以使用

```
SELECT array_max(ARRAY[o.NegotiatedPrice, o.SuggestedPrice]) 
```

# java - 为什么 Hibernate 似乎是为短期会话而设计的？

> ID：124453
> 
> 赞同：2
> 
> 时间：2008-09-23T22:58:52.680
> 
> 标签：java, hibernate

我知道这是一个主观问题，但为什么 Hibernate 似乎是为短期会话而设计的？通常在我的应用程序中，我创建 DAO 来抽象我的数据层，但由于我无法预测实体对象将如何使用，它的一些集合是延迟加载的，或者我应该说一旦会话关闭就无法加载。

为什么他们不设计它以使其自动重新打开会话，或者让会话始终保持打开状态？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T23:06:03.273

因为一旦您移出事务边界，您就无法在不启动新事务的情况下再次访问数据库。“以防万一”进行长时间运行的交易是一件坏事（tm）。

我猜你想从你的视图中延迟加载对象 - 看看[这里](http://www.hibernate.org/43.html)的一些选项。我更喜欢准确定义我的会话外观方法将返回多少对象映射。我发现这使得单元测试和性能测试我的业务层变得更容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T02:11:30.907

我在一个使用 EJB 和 Hibernate 的桌面应用程序上工作。我们必须`lazy=false`到处设置，因为当对象被序列化时，它们就失去了从后端获取的能力。不幸的是，事情就是这样。

如果您关心性能，您可以在后端使用缓存，这样您的非延迟提取就不会那么痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T23:02:27.320

您正在寻找 OpenSessionInView 模式，它本质上是一个概念过滤器（有时实现为 servlet 过滤器），用于检测何时需要透明地重新打开会话。几个框架实现了这一点，因此它会自动处理它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T23:38:42.850

我正在编写一个桌面应用程序，因此使用过滤器不适用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T00:14:45.743

连接是一种稀缺资源，一旦你用完它们就需要回收。如果您还使用连接池，那么在需要时获取另一个连接池应该很快。这是您必须用来使网站扩展的架构——即使您是桌面应用程序，它们的用例也可能集中在可扩展的网站上。

如果您查看 MS ADO.NET，您会发现类似的焦点是在短时间内保持连接打开——它们有一个完整的离线模型，用于更新断开连接的数据，然后在您准备好时应用到数据库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T05:30:06.967

Hibernate 被设计为一种将对象映射到关系数据库表的方法。它很好地完成了这项工作。但是，它不能一直取悦所有人。我认为学习初始化是如何工作的有一些复杂性，但是一旦你掌握了它，它就有意义了。我不知道它是否一定是“设计”来专门激怒你，这就是它发生的方式。

如果它要神奇地重新打开非 web 应用程序中的会话，我认为学习框架的复杂性将远远超过好处。

# optimization - 如何在 Lua 中预先设置数组的大小？

> ID：124455
> 
> 赞同：9
> 
> 时间：2008-09-23T22:59:08.920
> 
> 标签：optimization, lua

我有一个 Lua 程序，它似乎比它应该的要慢。我怀疑问题是我一次向关联数组添加一个值，并且表每次都必须分配新内存。

似乎确实有一个 table.setn 函数，但在 Lua 5.1.3 下它失败了：

```
stdin:1: 'setn' is obsolete
stack traceback:
        [C]: in function 'setn'
        stdin:1: in main chunk
        [C]: ? 
```

我从谷歌搜索中收集到这个功能在 Lua 5.1 中被贬值了，但我找不到什么（如果有的话）取代了这个功能。

你知道如何在 Lua 中预先设置表格的大小吗？

或者，当您将对象添加到表时，是否有其他方法可以避免内存分配？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T12:49:26.150

让我更专注于你的问题：

> 一次将值添加到关联数组

Lua 中的表是关联的，但以数组形式 (1..N) 使用它们是优化的。他们在内部有双面。

所以.. 如果您确实在关联地添加值，请遵循上述规则。

如果您使用索引 1..N，您可以通过设置 t[100000]= 来强制重新调整一次大小。这应该一直有效，直到 Lua 源中指定的优化数组大小限制 (2^26 = 67108864)。在那之后，一切都是关联的。

ps 旧的 'setn' 方法只处理数组部分，所以它对关联使用没有用（忽略那些答案）。

pps 你研究过保持 Lua 高性能的一般技巧吗？即知道表的创建，宁愿重用一个表而不是创建一个新的，使用'local print=print'等来避免全局访问。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-28T22:28:38.490

```
static int new_sized_table( lua_State *L )
{
    int asize = lua_tointeger( L, 1 );
    int hsize = lua_tointeger( L, 2 );
    lua_createtable( L, asize, hsize );
    return( 1 );
}

...

lua_pushcfunction( L, new_sized_table );
lua_setglobal( L, "sized_table" ); 
```

然后，在 Lua 中，

```
array = function(size) return sized_table(size,0) end

a = array(10) 
```

作为快速运行此程序的技巧，您可以将 C 添加到`lua.c`.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T23:28:45.603

我不认为你可以 - 它不是一个数组，它是一个关联数组，就像一个 perl 哈希或一个 awk 数组。

[http://www.lua.org/manual/5.1/manual.html#2.5.5](http://www.lua.org/manual/5.1/manual.html#2.5.5)

我认为您无法从 Lua 方面有意义地预设其大小。

但是，如果您在 C 端分配数组，则

```
void lua_createtable (lua_State *L, int narr, int nrec); 
```

可能是你需要的。

> 创建一个新的空表并将其推入堆栈。新表已为 nrec 数组元素和 nrec 非数组元素预先分配了空间。当您确切知道表将包含多少元素时，此预分配很有用。否则你可以使用函数 lua_newtable。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-28T01:48:58.677

虽然这不能回答您的主要问题，但它回答了您的第二个问题：

> 或者，当您将对象添加到表时，是否有其他方法可以避免内存分配？

如果您在自定义应用程序中运行 Lua，正如我猜测的那样，因为您进行 C 编码，我建议您用 Loki 的小值分配器替换分配器，它减少了我的内存分配 100+ 倍。这通过避免往返内核来提高性能，并使我成为一个更快乐的程序员:)

无论如何，我尝试了其他分配器，但它们更通用，并提供不利于 Lua 应用程序的保证（例如线程安全和大对象分配等），也可以编写自己的小对象分配器良好的一周编程和调试得到了恰到好处，在寻找可用的解决方案之后，Loki 的分配器是我为这个问题找到的最简单和最快的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T07:29:41.143

仍然有一个内部的 luaL_setn，你可以编译 Lua 使其暴露为 table.setn。但看起来它无济于事，因为代码似乎没有做任何预扩展。

（此外，setn 上面评论的 setn 与 Lua 表的数组部分有关，您说您正在使用该表作为关联数组）

好的部分是，即使你一个一个地添加元素，Lua 也不会那样增加数组。相反，它使用了更合理的策略。您仍然可以为更大的数组获得多个分配，但性能比每次都获得新的分配要好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-28T15:39:02.003

如果您在代码中使用特定数量的项目声明您的表，如下所示：

```
local tab = { 0, 1, 2, 3, 4, 5, ... , n } 
```

然后 Lua 将创建至少已为`n`项目分配内存的表。

但是，Lua 使用 2x 增量内存分配技术，因此向表中添加项目很少会强制重新分配。

# .net - .net - 如何注册启动脚本？

> ID：124457
> 
> 赞同：7
> 
> 时间：2008-09-23T22:59:36.877
> 
> 标签：.net, ajax, debugging, startupscript, clientscriptmanager

我对 .net 的经验有限。我的应用程序抛出了一个错误 this.dateTimeFormat is undefined 我追踪到了一个已知的 ajax 错误。发布的解决方法是：

“将以下内容注册为启动脚本：”

```
Sys.CultureInfo.prototype._getAbbrMonthIndex = function(value)
{
if (!this._upperAbbrMonths) {
this._upperAbbrMonths = this._toUpperArray(this.dateTimeFormat.AbbreviatedMonthNames);
}
return Array.indexOf(this._upperAbbrMonths, this._toUpper(value));
}; 
```

那么我该怎么做呢？我是否将脚本添加到我的 aspx 文件的底部？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T23:02:24.607

您将使用[ClientScriptManager.RegisterStartupScript()](http://msdn.microsoft.com/en-us/library/z9h4dk8y.aspx)

```
string str = @"Sys.CultureInfo.prototype._getAbbrMonthIndex = function(value) { 
    if (!this._upperAbbrMonths) { 
        this._upperAbbrMonths = this._toUpperArray(this.dateTimeFormat.AbbreviatedMonthNames);
    }
    return Array.indexOf(this._upperAbbrMonths, this._toUpper(value));
 };";

if(!ClientScriptManager.IsStartupScriptRegistered("MyScript"){
  ClientScriptManager.RegisterStartupScript(this.GetType(), "MyScript", str, true)
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-13T10:26:02.020

我在我的 Web 应用程序中遇到了同样的问题（this.datetimeformat 未定义），确实是由于 Microsoft Ajax 中的一个错误，并且此函数覆盖了 MS Ajax 中的错误导致函数。

但是上面的代码有一些问题。这是正确的版本。

```
string str = @"Sys.CultureInfo.prototype._getAbbrMonthIndex = function(value) { 
    if (!this._upperAbbrMonths) { 
        this._upperAbbrMonths = this._toUpperArray(this.dateTimeFormat.AbbreviatedMonthNames);
    }
    return Array.indexOf(this._upperAbbrMonths, this._toUpper(value));
 };";

ClientScriptManager cs = Page.ClientScript;
if(!cs.IsStartupScriptRegistered("MyScript"))
{
    cs.RegisterStartupScript(this.GetType(), "MyScript", str, true);
} 
```

Put in the Page_Load event of your web page in the codebehind file. If you're using Master Pages, put it in the your child page, and not the master page, because the code in the child pages will execute before the Master page and if this is in the codebehind of Master page, you will still get the error if you're using AJAX on the child pages.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T23:01:26.233

把它放在页面的标题部分

# php - 如何在 PHP 中发出异步 HTTP 请求

> ID：124462
> 
> 赞同：234
> 
> 时间：2008-09-23T23:00:53.440
> 
> 标签：php, http, asynchronous

PHP中有没有办法进行异步HTTP调用？我不关心响应，我只想做类似的事情`file_get_contents()`，但在执行我的其余代码之前不要等待请求完成。这对于在我的应用程序中触发某种“事件”或触发长流程非常有用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2010-05-27T21:14:03.160

我之前接受的答案不起作用。它仍在等待响应。这确实有效，取自[How do I make an asynchronous GET request in PHP?](https://stackoverflow.com/questions/962915/how-do-i-make-an-asynchronous-get-request-in-php)

```
function post_without_wait($url, $params)
{
    foreach ($params as $key => &$val) {
      if (is_array($val)) $val = implode(',', $val);
        $post_params[] = $key.'='.urlencode($val);
    }
    $post_string = implode('&', $post_params);

    $parts=parse_url($url);

    $fp = fsockopen($parts['host'],
        isset($parts['port'])?$parts['port']:80,
        $errno, $errstr, 30);

    $out = "POST ".$parts['path']." HTTP/1.1\r\n";
    $out.= "Host: ".$parts['host']."\r\n";
    $out.= "Content-Type: application/x-www-form-urlencoded\r\n";
    $out.= "Content-Length: ".strlen($post_string)."\r\n";
    $out.= "Connection: Close\r\n\r\n";
    if (isset($post_string)) $out.= $post_string;

    fwrite($fp, $out);
    fclose($fp);
} 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2010-02-13T18:22:58.120

如果您控制要异步调用的目标（例如您自己的“longtask.php”），您可以从该端关闭连接，两个脚本将并行运行。它是这样工作的：

1.  quick.php 通过 cURL 打开 longtask.php（这里没有魔法）
2.  longtask.php 关闭连接并继续（神奇！）
3.  连接关闭时 cURL 返回 quick.php
4.  两个任务并行继续

我已经尝试过了，它工作得很好。但是 quick.php 不会知道 longtask.php 正在做什么，除非您在进程之间创建某种通信方式。

在执行其他任何操作之前，请在 longtask.php 中尝试此代码。它将关闭连接，但仍会继续运行（并抑制任何输出）：

```
while(ob_get_level()) ob_end_clean();
header('Connection: close');
ignore_user_abort();
ob_start();
echo('Connection Closed');
$size = ob_get_length();
header("Content-Length: $size");
ob_end_flush();
flush(); 
```

该代码是从[PHP 手册的用户贡献的注释](http://www.php.net/manual/en/features.connection-handling.php#71172)中复制而来的，并有所改进。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-23T23:35:26.947

您可以通过使用 exec() 来调用可以执行 HTTP 请求的东西来做一些诡计，例如`wget`，但是您必须将程序的所有输出定向到某个位置，例如文件或 /dev/null，否则 PHP 进程将等待该输出.

如果您想将进程与 apache 线程完全分开，请尝试类似（我对此不确定，但希望您明白）：

```
exec('bash -c "wget -O (url goes here) > /dev/null 2>&1 &"'); 
```

这不是一个好生意，您可能需要像 cron 作业这样调用心跳脚本的东西，该脚本轮询实际的数据库事件队列以执行真正的异步事件。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2018-07-09T06:02:24.450

截至 2018 年，[Guzzle](http://docs.guzzlephp.org/en/stable/index.html)已成为 HTTP 请求的事实上的标准库，用于多个现代框架。它是用纯 PHP 编写的，不需要安装任何自定义扩展。

它可以很好地进行异步 HTTP 调用，甚至可以在需要进行 100 个 HTTP 调用但不想一次运行超过 5 个时将[它们汇集起来。](http://docs.guzzlephp.org/en/stable/quickstart.html#concurrent-requests)

## 并发请求示例

```
use GuzzleHttp\Client;
use GuzzleHttp\Promise;

$client = new Client(['base_uri' => 'http://httpbin.org/']);

// Initiate each request but do not block
$promises = [
    'image' => $client->getAsync('/image'),
    'png'   => $client->getAsync('/image/png'),
    'jpeg'  => $client->getAsync('/image/jpeg'),
    'webp'  => $client->getAsync('/image/webp')
];

// Wait on all of the requests to complete. Throws a ConnectException
// if any of the requests fail
$results = Promise\unwrap($promises);

// Wait for the requests to complete, even if some of them fail
$results = Promise\settle($promises)->wait();

// You can access each result using the key provided to the unwrap
// function.
echo $results['image']['value']->getHeader('Content-Length')[0]
echo $results['png']['value']->getHeader('Content-Length')[0] 
```

请参阅[http://docs.guzzlephp.org/en/stable/quickstart.html#concurrent-requests](http://docs.guzzlephp.org/en/stable/quickstart.html#concurrent-requests)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2015-05-19T00:27:32.257

你可以使用这个库：[https ://github.com/stil/curl-easy](https://github.com/stil/curl-easy)

这很简单：

```
<?php
$request = new cURL\Request('http://yahoo.com/');
$request->getOptions()->set(CURLOPT_RETURNTRANSFER, true);

// Specify function to be called when your request is complete
$request->addListener('complete', function (cURL\Event $event) {
    $response = $event->response;
    $httpCode = $response->getInfo(CURLINFO_HTTP_CODE);
    $html = $response->getContent();
    echo "\nDone.\n";
});

// Loop below will run as long as request is processed
$timeStart = microtime(true);
while ($request->socketPerform()) {
    printf("Running time: %dms    \r", (microtime(true) - $timeStart)*1000);
    // Here you can do anything else, while your request is in progress
} 
```

您可以在下面看到上述示例的控制台输出。它将显示简单的实时时钟，指示请求正在运行多少时间：

* * *

![动画片](https://i.stack.imgur.com/qc3wI.gif)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2010-03-13T07:18:03.687

```
/**
 * Asynchronously execute/include a PHP file. Does not record the output of the file anywhere. 
 *
 * @param string $filename              file to execute, relative to calling script
 * @param string $options               (optional) arguments to pass to file via the command line
 */ 
function asyncInclude($filename, $options = '') {
    exec("/path/to/php -f {$filename} {$options} >> /dev/null &");
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2015-02-21T13:36:54.697

1.  `CURL`使用设置低来伪造请求中止`CURLOPT_TIMEOUT_MS`

2.  设置`ignore_user_abort(true)`为在连接关闭后继续处理。

使用此方法，无需过于依赖操作系统、浏览器和 PHP 版本，通过标头和缓冲区实现连接处理

**主进程**

```
function async_curl($background_process=''){

    //-------------get curl contents----------------

    $ch = curl_init($background_process);
    curl_setopt_array($ch, array(
        CURLOPT_HEADER => 0,
        CURLOPT_RETURNTRANSFER =>true,
        CURLOPT_NOSIGNAL => 1, //to timeout immediately if the value is < 1000 ms
        CURLOPT_TIMEOUT_MS => 50, //The maximum number of mseconds to allow cURL functions to execute
        CURLOPT_VERBOSE => 1,
        CURLOPT_HEADER => 1
    ));
    $out = curl_exec($ch);

    //-------------parse curl contents----------------

    //$header_size = curl_getinfo($ch, CURLINFO_HEADER_SIZE);
    //$header = substr($out, 0, $header_size);
    //$body = substr($out, $header_size);

    curl_close($ch);

    return true;
}

async_curl('http://example.com/background_process_1.php'); 
```

**后台进程**

```
ignore_user_abort(true);

//do something... 
```

**注意**

> 如果您希望 cURL 在不到一秒的时间内超时，您可以使用 CURLOPT_TIMEOUT_MS，尽管“类 Unix 系统”上存在一个错误/“功能”，如果该值小于 1000 毫秒，则会导致 libcurl 立即超时并出现错误“ cURL 错误 (28): 已超时”。这种行为的解释是：
> 
> [...]
> 
> 解决方案是使用 CURLOPT_NOSIGNAL 禁用信号

**资源**

*   [curl超时小于1000ms总是失败？](https://stackoverflow.com/questions/7987584/curl-timeout-less-than-1000ms-always-fails)

*   [http://www.php.net/manual/en/function.curl-setopt.php#104597](http://www.php.net/manual/en/function.curl-setopt.php#104597)

*   [http://php.net/manual/en/features.connection-handling.php](http://php.net/manual/en/features.connection-handling.php)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-03-03T06:06:10.823

swoole 扩展。[https://github.com/matyhtf/swoole](https://github.com/matyhtf/swoole) PHP 的异步和并发网络框架。

```
$client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_ASYNC);

$client->on("connect", function($cli) {
    $cli->send("hello world\n");
});

$client->on("receive", function($cli, $data){
    echo "Receive: $data\n";
});

$client->on("error", function($cli){
    echo "connect fail\n";
});

$client->on("close", function($cli){
    echo "close\n";
});

$client->connect('127.0.0.1', 9501, 0.5); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-02-08T19:20:42.280

让我告诉你我的方式:)

需要在服务器上安装 nodejs

（我的服务器发送 1000 个 https 获取请求仅需 2 秒）

url.php：

```
<?
$urls = array_fill(0, 100, 'http://google.com/blank.html');

function execinbackground($cmd) { 
    if (substr(php_uname(), 0, 7) == "Windows"){ 
        pclose(popen("start /B ". $cmd, "r"));  
    } 
    else { 
        exec($cmd . " > /dev/null &");   
    } 
} 
fwite(fopen("urls.txt","w"),implode("\n",$urls);
execinbackground("nodejs urlscript.js urls.txt");
// { do your work while get requests being executed.. }
?> 
```

urlscript.js >

```
var https = require('https');
var url = require('url');
var http = require('http');
var fs = require('fs');
var dosya = process.argv[2];
var logdosya = 'log.txt';
var count=0;
http.globalAgent.maxSockets = 300;
https.globalAgent.maxSockets = 300;

setTimeout(timeout,100000); // maximum execution time (in ms)

function trim(string) {
    return string.replace(/^\s*|\s*$/g, '')
}

fs.readFile(process.argv[2], 'utf8', function (err, data) {
    if (err) {
        throw err;
    }
    parcala(data);
});

function parcala(data) {
    var data = data.split("\n");
    count=''+data.length+'-'+data[1];
    data.forEach(function (d) {
        req(trim(d));
    });
    /*
    fs.unlink(dosya, function d() {
        console.log('<%s> file deleted', dosya);
    });
    */
}

function req(link) {
    var linkinfo = url.parse(link);
    if (linkinfo.protocol == 'https:') {
        var options = {
        host: linkinfo.host,
        port: 443,
        path: linkinfo.path,
        method: 'GET'
    };
https.get(options, function(res) {res.on('data', function(d) {});}).on('error', function(e) {console.error(e);});
    } else {
    var options = {
        host: linkinfo.host,
        port: 80,
        path: linkinfo.path,
        method: 'GET'
    };        
http.get(options, function(res) {res.on('data', function(d) {});}).on('error', function(e) {console.error(e);});
    }
}

process.on('exit', onExit);

function onExit() {
    log();
}

function timeout()
{
console.log("i am too far gone");process.exit();
}

function log() 
{
    var fd = fs.openSync(logdosya, 'a+');
    fs.writeSync(fd, dosya + '-'+count+'\n');
    fs.closeSync(fd);
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-06-18T15:20:42.127

您可以使用非阻塞套接字和 PHP 的 pecl 扩展之一：

*   [http://php.net/事件](http://php.net/event)
*   [http://php.net/libevent](http://php.net/libevent)
*   [http://php.net/ev](http://php.net/ev)
*   [https://github.com/m4rw3r/php-libev](https://github.com/m4rw3r/php-libev)

您可以使用在代码和 pecl 扩展之间为您提供抽象层的库：[https ://github.com/reactphp/event-loop](https://github.com/reactphp/event-loop)

你也可以使用异步 http-client，基于之前的库：[https ://github.com/reactphp/http-client](https://github.com/reactphp/http-client)

查看其他 ReactPHP 库：[http: //reactphp.org](http://reactphp.org)

小心使用异步模型。我建议在 youtube 上观看此视频：[http ://www.youtube.com/watch?v=MWNcItWuKpI](http://www.youtube.com/watch?v=MWNcItWuKpI)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-02-27T12:35:17.583

```
class async_file_get_contents extends Thread{
    public $ret;
    public $url;
    public $finished;
        public function __construct($url) {
        $this->finished=false;
        $this->url=$url;
    }
        public function run() {
        $this->ret=file_get_contents($this->url);
        $this->finished=true;
    }
}
$afgc=new async_file_get_contents("http://example.org/file.ext"); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-12-02T07:58:07.293

# 事件扩展

[事件](https://pecl.php.net/package/event)扩展非常合适。它是[Libevent](http://libevent.org/)库的一个端口，专为事件驱动 I/O 而设计，主要用于网络。

我编写了一个示例 HTTP 客户端，它允许调度多个 HTTP 请求并异步运行它们。

这是一个基于[事件](https://pecl.php.net/package/event)扩展的示例 HTTP 客户端类。

该类允许调度多个 HTTP 请求，然后异步运行它们。

# http-client.php

```
<?php
class MyHttpClient {
  /// @var EventBase
  protected $base;
  /// @var array Instances of EventHttpConnection
  protected $connections = [];

  public function __construct() {
    $this->base = new EventBase();
  }

  /**
   * Dispatches all pending requests (events)
   *
   * @return void
   */
  public function run() {
    $this->base->dispatch();
  }

  public function __destruct() {
    // Destroy connection objects explicitly, don't wait for GC.
    // Otherwise, EventBase may be free'd earlier.
    $this->connections = null;
  }

  /**
   * @brief Adds a pending HTTP request
   *
   * @param string $address Hostname, or IP
   * @param int $port Port number
   * @param array $headers Extra HTTP headers
   * @param int $cmd A EventHttpRequest::CMD_* constant
   * @param string $resource HTTP request resource, e.g. '/page?a=b&c=d'
   *
   * @return EventHttpRequest|false
   */
  public function addRequest($address, $port, array $headers,
    $cmd = EventHttpRequest::CMD_GET, $resource = '/')
  {
    $conn = new EventHttpConnection($this->base, null, $address, $port);
    $conn->setTimeout(5);

    $req = new EventHttpRequest([$this, '_requestHandler'], $this->base);

    foreach ($headers as $k => $v) {
      $req->addHeader($k, $v, EventHttpRequest::OUTPUT_HEADER);
    }
    $req->addHeader('Host', $address, EventHttpRequest::OUTPUT_HEADER);
    $req->addHeader('Connection', 'close', EventHttpRequest::OUTPUT_HEADER);
    if ($conn->makeRequest($req, $cmd, $resource)) {
      $this->connections []= $conn;
      return $req;
    }

    return false;
  }

  /**
   * @brief Handles an HTTP request
   *
   * @param EventHttpRequest $req
   * @param mixed $unused
   *
   * @return void
   */
  public function _requestHandler($req, $unused) {
    if (is_null($req)) {
      echo "Timed out\n";
    } else {
      $response_code = $req->getResponseCode();

      if ($response_code == 0) {
        echo "Connection refused\n";
      } elseif ($response_code != 200) {
        echo "Unexpected response: $response_code\n";
      } else {
        echo "Success: $response_code\n";
        $buf = $req->getInputBuffer();
        echo "Body:\n";
        while ($s = $buf->readLine(EventBuffer::EOL_ANY)) {
          echo $s, PHP_EOL;
        }
      }
    }
  }
}

$address = "my-host.local";
$port = 80;
$headers = [ 'User-Agent' => 'My-User-Agent/1.0', ];

$client = new MyHttpClient();

// Add pending requests
for ($i = 0; $i < 10; $i++) {
  $client->addRequest($address, $port, $headers,
    EventHttpRequest::CMD_GET, '/test.php?a=' . $i);
}

// Dispatch pending requests
$client->run(); 
```

## 测试.php

这是服务器端的示例脚本。

```
<?php
echo 'GET: ', var_export($_GET, true), PHP_EOL;
echo 'User-Agent: ', $_SERVER['HTTP_USER_AGENT'] ?? '(none)', PHP_EOL; 
```

## 用法

```
php http-client.php 
```

*样本输出*

```
Success: 200
Body:
GET: array (
  'a' => '1',
)
User-Agent: My-User-Agent/1.0
Success: 200
Body:
GET: array (
  'a' => '0',
)
User-Agent: My-User-Agent/1.0
Success: 200
Body:
GET: array (
  'a' => '3',
)
... 
```

*（修剪。）*

[请注意，该代码专为CLI SAPI](http://php.net/manual/en/features.commandline.introduction.php)中的长期处理而设计。

* * *

对于自定义协议，请考虑使用低级 API，即[缓冲区事件](http://docs.php.net/manual/en/class.eventbufferevent.php)、[缓冲区](http://docs.php.net/manual/en/class.eventbuffer.php)。对于 SSL/TLS 通信，我建议将低级 API 与 Event 的[ssl context](http://docs.php.net/manual/en/class.eventsslcontext.php)结合使用。例子：

*   [SSL 回显服务器](https://bitbucket.org/osmanov/pecl-event/src/41be9821b69ce996d59b750ecdbd9c07dffe192b/examples/ssl-echo-server/server.php?at=master&fileviewer=file-view-default)
*   [SSL 客户端](https://bitbucket.org/osmanov/pecl-event/src/41be9821b69ce996d59b750ecdbd9c07dffe192b/examples/ssl-echo-server/client.php?at=master&fileviewer=file-view-default)

* * *

虽然 Libevent 的 HTTP API 很简单，但它不如缓冲区事件灵活。例如，HTTP API 当前不支持自定义 HTTP 方法。但是几乎可以使用低级 API 实现任何协议。

# 电动车扩展

我还编写了另一个 HTTP 客户端的示例，该客户端使用[Ev](https://pecl.php.net/package/ev)扩展和[非阻塞模式](http://docs.php.net/manual/en/function.socket-set-nonblock.php)的[套接字](http://docs.php.net/manual/en/book.sockets.php)。该代码比基于 Event 的示例稍微冗长，因为 Ev 是一个通用的事件循环。它不提供特定于网络的功能，但它的观察者尤其能够监听封装到套接字资源中的文件描述符。`EvIo`

这是一个基于[Ev](https://pecl.php.net/package/ev)扩展的示例 HTTP 客户端。

Ev 扩展实现了一个简单而强大的通用事件循环。它不提供特定于网络的观察者，但它的[I/O 观察者](http://docs.php.net/manual/en/class.evio.php)可用于[套接字](http://docs.php.net/manual/en/book.sockets.php)的异步处理。

以下代码显示了如何安排 HTTP 请求以进行并行处理。

# http-client.php

```
<?php
class MyHttpRequest {
  /// @var MyHttpClient
  private $http_client;
  /// @var string
  private $address;
  /// @var string HTTP resource such as /page?get=param
  private $resource;
  /// @var string HTTP method such as GET, POST etc.
  private $method;
  /// @var int
  private $service_port;
  /// @var resource Socket
  private $socket;
  /// @var double Connection timeout in seconds.
  private $timeout = 10.;
  /// @var int Chunk size in bytes for socket_recv()
  private $chunk_size = 20;
  /// @var EvTimer
  private $timeout_watcher;
  /// @var EvIo
  private $write_watcher;
  /// @var EvIo
  private $read_watcher;
  /// @var EvTimer
  private $conn_watcher;
  /// @var string buffer for incoming data
  private $buffer;
  /// @var array errors reported by sockets extension in non-blocking mode.
  private static $e_nonblocking = [
    11, // EAGAIN or EWOULDBLOCK
    115, // EINPROGRESS
  ];

  /**
   * @param MyHttpClient $client
   * @param string $host Hostname, e.g. google.co.uk
   * @param string $resource HTTP resource, e.g. /page?a=b&c=d
   * @param string $method HTTP method: GET, HEAD, POST, PUT etc.
   * @throws RuntimeException
   */
  public function __construct(MyHttpClient $client, $host, $resource, $method) {
    $this->http_client = $client;
    $this->host        = $host;
    $this->resource    = $resource;
    $this->method      = $method;

    // Get the port for the WWW service
    $this->service_port = getservbyname('www', 'tcp');

    // Get the IP address for the target host
    $this->address = gethostbyname($this->host);

    // Create a TCP/IP socket
    $this->socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
    if (!$this->socket) {
      throw new RuntimeException("socket_create() failed: reason: " .
        socket_strerror(socket_last_error()));
    }

    // Set O_NONBLOCK flag
    socket_set_nonblock($this->socket);

    $this->conn_watcher = $this->http_client->getLoop()
      ->timer(0, 0., [$this, 'connect']);
  }

  public function __destruct() {
    $this->close();
  }

  private function freeWatcher(&$w) {
    if ($w) {
      $w->stop();
      $w = null;
    }
  }

  /**
   * Deallocates all resources of the request
   */
  private function close() {
    if ($this->socket) {
      socket_close($this->socket);
      $this->socket = null;
    }

    $this->freeWatcher($this->timeout_watcher);
    $this->freeWatcher($this->read_watcher);
    $this->freeWatcher($this->write_watcher);
    $this->freeWatcher($this->conn_watcher);
  }

  /**
   * Initializes a connection on socket
   * @return bool
   */
  public function connect() {
    $loop = $this->http_client->getLoop();

    $this->timeout_watcher = $loop->timer($this->timeout, 0., [$this, '_onTimeout']);
    $this->write_watcher = $loop->io($this->socket, Ev::WRITE, [$this, '_onWritable']);

    return socket_connect($this->socket, $this->address, $this->service_port);
  }

  /**
   * Callback for timeout (EvTimer) watcher
   */
  public function _onTimeout(EvTimer $w) {
    $w->stop();
    $this->close();
  }

  /**
   * Callback which is called when the socket becomes wriable
   */
  public function _onWritable(EvIo $w) {
    $this->timeout_watcher->stop();
    $w->stop();

    $in = implode("\r\n", [
      "{$this->method} {$this->resource} HTTP/1.1",
      "Host: {$this->host}",
      'Connection: Close',
    ]) . "\r\n\r\n";

    if (!socket_write($this->socket, $in, strlen($in))) {
      trigger_error("Failed writing $in to socket", E_USER_ERROR);
      return;
    }

    $loop = $this->http_client->getLoop();
    $this->read_watcher = $loop->io($this->socket,
      Ev::READ, [$this, '_onReadable']);

    // Continue running the loop
    $loop->run();
  }

  /**
   * Callback which is called when the socket becomes readable
   */
  public function _onReadable(EvIo $w) {
    // recv() 20 bytes in non-blocking mode
    $ret = socket_recv($this->socket, $out, 20, MSG_DONTWAIT);

    if ($ret) {
      // Still have data to read. Append the read chunk to the buffer.
      $this->buffer .= $out;
    } elseif ($ret === 0) {
      // All is read
      printf("\n<<<<\n%s\n>>>>", rtrim($this->buffer));
      fflush(STDOUT);
      $w->stop();
      $this->close();
      return;
    }

    // Caught EINPROGRESS, EAGAIN, or EWOULDBLOCK
    if (in_array(socket_last_error(), static::$e_nonblocking)) {
      return;
    }

    $w->stop();
    $this->close();
  }
}

/////////////////////////////////////
class MyHttpClient {
  /// @var array Instances of MyHttpRequest
  private $requests = [];
  /// @var EvLoop
  private $loop;

  public function __construct() {
    // Each HTTP client runs its own event loop
    $this->loop = new EvLoop();
  }

  public function __destruct() {
    $this->loop->stop();
  }

  /**
   * @return EvLoop
   */
  public function getLoop() {
    return $this->loop;
  }

  /**
   * Adds a pending request
   */
  public function addRequest(MyHttpRequest $r) {
    $this->requests []= $r;
  }

  /**
   * Dispatches all pending requests
   */
  public function run() {
    $this->loop->run();
  }
}

/////////////////////////////////////
// Usage
$client = new MyHttpClient();
foreach (range(1, 10) as $i) {
  $client->addRequest(new MyHttpRequest($client, 'my-host.local', '/test.php?a=' . $i, 'GET'));
}
$client->run(); 
```

## 测试

假设`http://my-host.local/test.php`脚本正在打印以下内容的转储`$_GET`：

```
<?php
echo 'GET: ', var_export($_GET, true), PHP_EOL; 
```

然后`php http-client.php`命令的输出将类似于以下内容：

```
<<<<
HTTP/1.1 200 OK
Server: nginx/1.10.1
Date: Fri, 02 Dec 2016 12:39:54 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: close
X-Powered-By: PHP/7.0.13-pl0-gentoo

1d
GET: array (
  'a' => '3',
)

0
>>>>
<<<<
HTTP/1.1 200 OK
Server: nginx/1.10.1
Date: Fri, 02 Dec 2016 12:39:54 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: close
X-Powered-By: PHP/7.0.13-pl0-gentoo

1d
GET: array (
  'a' => '2',
)

0
>>>>
... 
```

*（修剪）*

请注意，在 PHP 5 中，*套接字*扩展可能会记录`EINPROGRESS`、`EAGAIN`和`EWOULDBLOCK` `errno`值的警告。可以使用以下命令关闭日志

```
error_reporting(E_ERROR); 
```

# 关于守则的“其余部分”

> 我只想做类似的事情`file_get_contents()`，但不要等待请求完成后再执行我的其余代码。

例如，应该与网络请求并行运行的代码可以在[Event timer](http://php.net/manual/en/event.timer.php)或 Ev 的[idle watcher](http://php.net/manual/en/class.evidle.php)的回调中执行。您可以通过观看上面提到的示例轻松弄清楚。否则，我将添加另一个示例:)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-08-29T20:28:07.257

我发现这个包非常有用且非常简单：[https ://github.com/amphp/parallel-functions](https://github.com/amphp/parallel-functions)

```
<?php

use function Amp\ParallelFunctions\parallelMap;
use function Amp\Promise\wait;

$responses = wait(parallelMap([
    'https://google.com/',
    'https://github.com/',
    'https://stackoverflow.com/',
], function ($url) {
    return file_get_contents($url);
})); 
```

它将并行加载所有 3 个 url。您还可以在闭包中使用类实例方法。

例如，我使用基于此包的 Laravel 扩展[https://github.com/spatie/laravel-collection-macros#parallelmap](https://github.com/spatie/laravel-collection-macros#parallelmap)

这是我的代码：

```
 /**
     * Get domains with all needed data
     */
    protected function getDomainsWithdata(): Collection
    {
        return $this->opensrs->getDomains()->parallelMap(function ($domain) {
            $contact = $this->opensrs->getDomainContact($domain);
            $contact['domain'] = $domain;
            return $contact;
        }, 10);
    } 
```

它在 10 个并行线程中加载所有需要的数据，而不是 50 秒没有异步它只在 8 秒内完成。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-05-13T23:38:24.153

当我向任何页面的特定 URL 进行 POST 时，这是我自己的 PHP 函数......示例：*** 我的函数的使用......

```
 <?php
        parse_str("email=myemail@ehehehahaha.com&subject=this is just a test");
        $_POST['email']=$email;
        $_POST['subject']=$subject;
        echo HTTP_POST("http://example.com/mail.php",$_POST);***

    exit;
    ?>
    <?php
    /*********HTTP POST using FSOCKOPEN **************/
    // by ArbZ

function HTTP_Post($URL,$data, $referrer="") {

    // parsing the given URL
    $URL_Info=parse_url($URL);

    // Building referrer
    if($referrer=="") // if not given use this script as referrer
        $referrer=$_SERVER["SCRIPT_URI"];

    // making string from $data
    foreach($data as $key=>$value)
        $values[]="$key=".urlencode($value);
        $data_string=implode("&",$values);

    // Find out which port is needed - if not given use standard (=80)
    if(!isset($URL_Info["port"]))
        $URL_Info["port"]=80;

    // building POST-request: HTTP_HEADERs
    $request.="POST ".$URL_Info["path"]." HTTP/1.1\n";
    $request.="Host: ".$URL_Info["host"]."\n";
    $request.="Referer: $referer\n";
    $request.="Content-type: application/x-www-form-urlencoded\n";
    $request.="Content-length: ".strlen($data_string)."\n";
    $request.="Connection: close\n";
    $request.="\n";
    $request.=$data_string."\n";

    $fp = fsockopen($URL_Info["host"],$URL_Info["port"]);
    fputs($fp, $request);
    while(!feof($fp)) {
        $result .= fgets($fp, 128);
    }
    fclose($fp); //$eco = nl2br();

    function getTextBetweenTags($string, $tagname) {
        $pattern = "/<$tagname ?.*>(.*)<\/$tagname>/";
        preg_match($pattern, $string, $matches);
        return $matches[1];
    }
    //STORE THE FETCHED CONTENTS to a VARIABLE, because its way better and fast...
    $str = $result;
    $txt = getTextBetweenTags($str, "span"); $eco = $txt;  $result = explode("&",$result);
    return $result[1];
    <span style=background-color:LightYellow;color:blue>".trim($_GET['em'])."</span>
    </pre> "; 
}
</pre> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-06-09T23:56:38.397

这是一个工作示例，只需运行它并随后打开 storage.txt 即可查看神奇的结果

```
<?php
    function curlGet($target){
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $target);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $result = curl_exec ($ch);
        curl_close ($ch);
        return $result;
    }

    // Its the next 3 lines that do the magic
    ignore_user_abort(true);
    header("Connection: close"); header("Content-Length: 0");
    echo str_repeat("s", 100000); flush();

    $i = $_GET['i'];
    if(!is_numeric($i)) $i = 1;
    if($i > 4) exit;
    if($i == 1) file_put_contents('storage.txt', '');

    file_put_contents('storage.txt', file_get_contents('storage.txt') . time() . "\n");

    sleep(5);
    curlGet($_SERVER['HTTP_HOST'] . $_SERVER['SCRIPT_NAME'] . '?i=' . ($i + 1));
    curlGet($_SERVER['HTTP_HOST'] . $_SERVER['SCRIPT_NAME'] . '?i=' . ($i + 1)); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-12-28T18:15:13.433

ReactPHP 异步 http 客户端
[https://github.com/shuchkin/react-http-client](https://github.com/shuchkin/react-http-client)

通过 Composer 安装

```
$ composer require shuchkin/react-http-client 
```

异步 HTTP GET

```
// get.php
$loop = \React\EventLoop\Factory::create();

$http = new \Shuchkin\ReactHTTP\Client( $loop );

$http->get( 'https://tools.ietf.org/rfc/rfc2068.txt' )->then(
    function( $content ) {
        echo $content;
    },
    function ( \Exception $ex ) {
        echo 'HTTP error '.$ex->getCode().' '.$ex->getMessage();
    }
);

$loop->run(); 
```

在 CLI 模式下运行 php

```
$ php get.php 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-04-18T19:37:54.150

Symfony HttpClient 是异步的[https://symfony.com/doc/current/components/http_client.html](https://symfony.com/doc/current/components/http_client.html)。

例如你可以

```
use Symfony\Component\HttpClient\HttpClient;

$client = HttpClient::create();
$response1 = $client->request('GET', 'https://website1');
$response2 = $client->request('GET', 'https://website1');
$response3 = $client->request('GET', 'https://website1');
//these 3 calls with return immediately
//but the requests will fire to the website1 webserver

$response1->getContent(); //this will block until content is fetched
$response2->getContent(); //same 
$response3->getContent(); //same 
```

* * *

## 回答 #18

> 赞同：-4
> 
> 时间：2012-04-30T11:34:23.610

嗯，超时时间可以设置为毫秒，见[http://www.php.net/manual/en/function.curl-setopt中的“CURLOPT_CONNECTTIMEOUT_MS”](http://www.php.net/manual/en/function.curl-setopt)

# database - 有哪些很棒的在线数据库建模工具？

> ID：124467
> 
> 赞同：48
> 
> 时间：2008-09-23T23:01:28.087
> 
> 标签：database, open-source, modeling

你最喜欢的开源数据库设计/建模工具是什么？

我正在寻找一个支持多个数据库的数据库，尤其是 Firebird SQL，但我在 Google 上找不到。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-23T23:27:57.870

我以前用过[DBDesigner](http://fabforce.net/dbdesigner4/)。它是一个开源工具。你可以检查一下。不确定它是否符合您的需求。

祝你好运！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T23:32:22.007

您是指“表格的图形表示”中的设计还是简单的“工程设计”。如果是后者，请使用[FlameRobin](http://www.flamerobin.org)，0.9.0 版本刚刚发布。

如果是前者，则使用[DBDesigner](http://fabforce.net/dbdesigner4/)。是的，它使用Java。

或者，也许您的意思更像是 MS Access。那么[科喜](http://www.kexi-project.org/)应该适合你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T11:49:23.690

S.Lott 插入了一条评论，但它应该是一个答案：看到[同样的问题](https://stackoverflow.com/questions/114538/visually-designing-a-database-structure)。

## 编辑

*由于它不像我想要的那样明显，因此以下是 S.Lott 在另一个问题中的回答的逐字副本：*

> 我是来自 Tigris.org的[ARGO UML的忠实粉丝。](http://argouml.tigris.org/)使用标准 UML 表示法绘制漂亮的图片。它会生成一些代码，但主要是 Java 类，它不是 SQL DDL，因此可能与您想要做的不够接近。
> 
> 您可以查看[数据建模工具](http://www.databaseanswers.org/modelling_tools.htm)列表，看看是否有比 Argo UML 更好的东西。此列表中的许多项目都是免费或便宜的。
> 
> 此外，如果您使用的是[Eclipse](http://www.eclipse.org/)或[NetBeans](http://www.netbeans.org/)，则有许多设计插件，其中一些可能具有您正在寻找的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T23:35:47.523

[DB Designer Fork](http://sourceforge.net/projects/dbdesigner-fork)项目声称它可以生成 FireBird sql 脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T00:27:24.637

我喜欢[Clay](http://www.azzurri.jp/en/clay/index.html) Eclipse 插件。我只将它与 MySQL 一起使用，但它声称支持 Firebird。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T18:10:52.690

您可能想查看[IBExpert 个人版](http://ibexpert.net/ibe/index.php?n=Main.IBExpert)。虽然不是开源的，但这是一个非常好的设计、构建和管理 Firebird 和 InterBase 数据库的工具。

个人版是免费的，但一些更高级的功能不可用。尽管如此，即使没有华丽的附加功能，免费版本也非常强大。

# sql-server - Rails 的 SQL Server 适配器

> ID：124481
> 
> 赞同：3
> 
> 时间：2008-09-23T23:05:25.520
> 
> 标签：sql-server, ruby-on-rails, windows, ruby

试图在 Windows 上找到用于 rails 的 sqlserver 适配器。

我试过从（没有运气）得到它：

gem install activerecord-sqlserver-adapter --source= [http://gems.rubyonrails.org](http://gems.rubyonrails.org)

我还能在哪里得到这个宝石？

***更新：***

确保以管理员身份运行命令提示符。右键单击命令提示符，然后单击“以管理员身份运行”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T23:27:36.857

我刚刚运行了您所做的确切命令行，并且 gem 安装得很好。

问题：

1.  你在运行Vista吗？

    *   如果是这样，请确保以管理员权限运行命令提示符，以便它可以写入 gems 文件夹
2.  你有最新版本的宝石吗？

    *   运行`gem --version`看看你有什么，如果不是 1.2.0，然后运行`gem update --system`获取最新的

# c# - C# HttpWebRequest 命令获取目录列表

> ID：124492
> 
> 赞同：14
> 
> 时间：2008-09-23T23:08:03.907
> 
> 标签：c#, http

我需要一个简短的代码片段来从 HTTP 服务器获取目录列表。

谢谢

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-23T23:20:37.277

代码之前的一些重要注意事项：

1.  必须将 HTTP 服务器配置为允许列出所需目录的目录；
2.  因为目录列表是普通的 HTML 页面，所以没有定义目录列表格式的标准；
3.  由于考虑**2**，您处于必须为每个服务器放置特定代码的地方。

我的选择是使用正则表达式。这允许快速解析和定制。您可以获得每个站点的特定正则表达式模式，这样您就有了一个非常模块化的方法。如果您计划在不更改源代码的情况下使用新站点支持来增强解析模块，请使用外部源将 URL 映射到正则表达式模式。

从[http://www.ibiblio.org/pub/打印目录列表的示例](http://www.ibiblio.org/pub/)

```
namespace Example
{
    using System;
    using System.Net;
    using System.IO;
    using System.Text.RegularExpressions;

    public class MyExample
    {
        public static string GetDirectoryListingRegexForUrl(string url)
        {
            if (url.Equals("http://www.ibiblio.org/pub/"))
            {
                return "<a href=\".*\">(?<name>.*)</a>";
            }
            throw new NotSupportedException();
        }
        public static void Main(String[] args)
        {
            string url = "http://www.ibiblio.org/pub/";
            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
            using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
            {
                using (StreamReader reader = new StreamReader(response.GetResponseStream()))
                {
                    string html = reader.ReadToEnd();
                    Regex regex = new Regex(GetDirectoryListingRegexForUrl(url));
                    MatchCollection matches = regex.Matches(html);
                    if (matches.Count > 0)
                    {
                        foreach (Match match in matches)
                        {
                            if (match.Success)
                            {
                                Console.WriteLine(match.Groups["name"]);
                            }
                        }
                    }
                }
            }

            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T23:09:51.983

**基本理解：**

目录列表只是由 Web 服务器生成的 HTML 页面。每个 Web 服务器都以自己的方式生成这些 HTML 页面，因为 Web 服务器没有列出这些目录的标准方法。

获取目录列表的最佳方法是简单地向您想要目录列表的 URL 发出 HTTP 请求，并尝试从返回给您的 HTML 中解析和提取所有链接。

要解析 HTML 链接，请尝试使用[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)。

**目录浏览：**

您要从中列出目录的 Web 服务器必须打开目录浏览，才能获得其目录中文件的 HTML 表示。因此，只有在 HTTP 服务器希望您能够获得时，您才能获得目录列表。

**HTML 敏捷包的一个简单示例：**

```
HtmlDocument doc = new HtmlDocument();
doc.Load(strURL);
foreach(HtmlNode link in doc.DocumentElement.SelectNodes("//a@href")
{
HtmlAttribute att = link"href";
//do something with att.Value;
} 
```

**更清洁的替代品：**

如果可能在您的情况下，更简洁的方法是使用预期的目录列表协议，如文件传输协议 (FTP)、SFTP（FTP 类似通过 SSH）或 FTPS（FTP 通过 SSL）。

**如果目录浏览没有打开怎么办：**

如果 web 服务器没有打开目录浏览，那么就没有简单的方法来获取目录列表。

在这种情况下，您可以做的最好的事情是从给定的 URL 开始，跟踪同一页面上的所有 HTML 链接，并尝试根据这些 HTML 页面上资源的相对路径自己构建目录的虚拟列表。但是，这不会为您提供 Web 服务器上实际文件的完整列表。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-10-10T19:06:19.037

我刚刚在上面进行了修改，发现这是最好的

```
public static class  GetallFilesFromHttp
{
    public static string GetDirectoryListingRegexForUrl(string url)
    {
        if (url.Equals("http://ServerDirPath/"))
        {
            return "\\\"([^\"]*)\\\""; 
        }
        throw new NotSupportedException();
    }
    public static void ListDiractory()
    {
        string url = "http://ServerDirPath/";
        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
        using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
        {
            using (StreamReader reader = new StreamReader(response.GetResponseStream()))
            {
                string html = reader.ReadToEnd();

                Regex regex = new Regex(GetDirectoryListingRegexForUrl(url));
                MatchCollection matches = regex.Matches(html);
                if (matches.Count > 0)
                {
                    foreach (Match match in matches)
                    {
                        if (match.Success)
                        {
                            Console.WriteLine(match.ToString());
                        }
                    }
                }
            }
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-10-16T21:33:09.560

**当我无法访问 ftp 服务器时，以下代码对我很有效：**

```
public static string[] GetFiles(string url)
{
    List<string> files = new List<string>(500);
    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
    using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
    {
        using (StreamReader reader = new StreamReader(response.GetResponseStream()))
        {
            string html = reader.ReadToEnd();

            Regex regex = new Regex("<a href=\".*\">(?<name>.*)</a>");
            MatchCollection matches = regex.Matches(html);

            if (matches.Count > 0)
            {
                foreach (Match match in matches)
                {
                    if (match.Success)
                    {
                        string[] matchData = match.Groups[0].ToString().Split('\"');
                        files.Add(matchData[1]);
                    }
                }
            }
        }
    }
    return files.ToArray();
} 
```

**但是，当我确实可以访问 ftp 服务器时，以下代码的运行速度要快得多：**

```
public static string[] getFtpFolderItems(string ftpURL)
{
    FtpWebRequest request = (FtpWebRequest)WebRequest.Create(ftpURL);
    request.Method = WebRequestMethods.Ftp.ListDirectory;

    //You could add Credentials, if needed 
    //request.Credentials = new NetworkCredential("anonymous", "password");

    FtpWebResponse response = (FtpWebResponse)request.GetResponse();

    Stream responseStream = response.GetResponseStream();
    StreamReader reader = new StreamReader(responseStream);

    return reader.ReadToEnd().Split("\r\n".ToCharArray(), StringSplitOptions.RemoveEmptyEntries);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-22T19:02:55.207

谢谢你的好帖子。对我来说，下面的模式效果更好。

```
<AHREF=\\"\S+\">(?<name>\S+)</A> 
```

我还在[http://regexhero.net/tester](http://regexhero.net/tester)对其进行了测试。

要在您的 C# 代码中使用它，您必须在 i 模式中的任何反斜杠和双引号之前添加更多反斜杠 ()

> `<AHREF=\\"\S+\">(?<name>\S+)</A>`

例如，在 GetDirectoryListingRegexForUrl 方法中，您应该使用类似这样的东西

> 返回 "< A HREF=\\"\S+\\">(?\S+)";

干杯!

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T23:11:14.383

你不能，除非你想要的特定目录启用了目录列表并且没有默认文件（通常是 index.htm、index.html 或 default.html，但总是可配置的）。只有这样，您才会看到一个目录列表，通常会用 HTML 标记并需要解析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T23:26:43.177

[您也可以为WebDAV](http://www.webdav.org/specs/rfc2518.html)设置服务器。

# .net - 返回 IDataReader 的 .net COM+ 对象

> ID：124513
> 
> 赞同：0
> 
> 时间：2008-09-23T23:15:39.193
> 
> 标签：.net, com+

我创建了一个派生自 ServicedComponent 的 .net 类，并将其注册到 COM+。该组件实现的接口有一个返回 IDataReader 的方法。当我从客户端应用程序调用服务组件时，一切正常，我可以调用返回 IDataReader 的方法没有问题，但是一旦我调用对象上的方法，我就会得到异常：“System.Runtime.Remoting.RemotingException：这个远程处理代理没有通道接收器，这意味着服务器没有注册的服务器通道正在侦听，或者此应用程序没有合适的客户端通道与服务器通信。”

我稍微修改了我的代码，并意识到如果我创建自己的可序列化（具有 Serializable 属性）的 IDataReader 实现，它将起作用。如果实现派生自 MarshalByRefObject 则失败。

那么，是否可以通过 COM+ ServicedComponents 的引用返回标准 .net 对象，如果可以，我需要做些什么来实现它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T04:29:33.517

当您的 COM+ 客户端和 COM+ 组件都受到管理时，CLR 会尝试变得“智能”并尝试切换到使用 .Net 远程处理作为通信通道。

要使此方案起作用，您可以为实现 IDataReader 的对象注册一个远程处理通道。

不幸的是，我无法访问几年前所做的代码，因此我无法发布示例。:-(

# wpf - WPF 图表库

> ID：124540
> 
> 赞同：9
> 
> 时间：2008-09-23T23:30:14.103
> 
> 标签：wpf, diagram

您以前使用过哪些免费或开源的 WPF 图表库？我正在写我的论文，没有钱支付商业替代品。

有效的答案应该支持撤消/重做、导出到 XML 并希望有好的文档。

我正在构建一个开源 UML / 数据库图表工具。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-26T14:05:19.573

sukram has a excellent series on CodeProject... it's a MUST READ!

*   [Part 1](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part1.aspx)
*   [Part 2](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part2.aspx)
*   [Part 3](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part3.aspx)
*   [Part 4](http://www.codeproject.com/KB/WPF/WPFDiagramDesigner_Part4.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T22:59:19.333

这是 WPF 的一个漂亮的图表控件：

[http://www.codeproject.com/KB/WPF/SpiderControl.aspx](http://www.codeproject.com/KB/WPF/SpiderControl.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T23:35:10.393

您正在寻找什么样的图表？WPF有一套很棒的基本控制[库](http://msdn.microsoft.com/en-us/library/ms751808.aspx)，支持大多数数学绘图模型，如样条曲线、直线、折线、圆弧等

# windows - 什么是 DLL 文件，它们是如何工作的？

> ID：124549
> 
> 赞同：279
> 
> 时间：2008-09-23T23:33:39.243
> 
> 标签：windows, winapi, dll

DLL 文件究竟是如何工作的？似乎有很多，但我不知道它们是什么或它们是如何工作的。

那么，与他们有什么关系呢？

* * *

## 回答 #1

> 赞同：355
> 
> 时间：2008-09-23T23:34:19.197

**什么是 DLL？**

动态链接库 (DLL) 类似于 EXE，但它们不能直接执行。它们类似于 Linux/Unix 中的 .so 文件。也就是说，DLL是MS对共享库的实现。

DLL 非常像 EXE，文件格式本身是相同的。EXE 和 DLL 都基于可移植可执行 (PE) 文件格式。DLL 还可以包含 COM 组件和 .NET 库。

**DLL 包含什么？**

DLL 包含 EXE 或其他 DLL 使用的函数、类、变量、UI 和资源（例如图标、图像、文件……）。

**图书馆类型：**

在几乎所有操作系统上，都有两种类型的库。静态库和动态库。在 Windows 中，文件扩展名如下：静态库 (.lib) 和动态库 (.dll)。主要区别在于静态库在编译时链接到可执行文件；而动态链接库直到运行时才链接。

**有关静态和动态库的更多信息：**

您通常不会在计算机上看到静态库，因为静态库直接嵌入在模块（EXE 或 DLL）中。动态库是一个独立的文件。

DLL 可以随时更改，并且只有在 EXE 显式加载 DLL 时才会在运行时加载。静态库一旦在 EXE 中编译就无法更改。可以单独更新 DLL，而无需更新 EXE 本身。

**加载 DLL：**

程序在启动时通过 Win32 API LoadLibrary 或当它是另一个 DLL 的依赖项时加载 DLL。程序使用 GetProcAddress 加载函数或 LoadResource 加载资源。

**进一步阅读：**

请查看[MSDN](http://msdn.microsoft.com/en-us/library/1ez7dh12.aspx)或[Wikipedia](http://en.wikipedia.org/wiki/Dynamic-link_library)以进一步阅读。也是这个答案的来源。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-24T06:05:09.020

**什么是 DLL？**

DLL 文件是二进制文件，可以包含可执行代码和图像等资源。与应用程序不同，这些文件不能直接执行，但应用程序会在需要时加载它们（或在启动期间一次性加载）。

**它们重要吗？**

大多数应用程序将在启动时加载它们所需的 DLL 文件。如果没有找到其中任何一个，系统将根本无法启动该过程。

**DLL 文件可能需要其他 DLL 文件**

与应用程序需要 DLL 文件一样，DLL 文件可能依赖于其他 DLL 文件本身。如果在依赖链中找不到这些 DLL 文件之一，则不会加载应用程序。这可以使用任何依赖遍历器工具轻松调试，例如[Dependency Walker](http://en.wikipedia.org/wiki/Dependency_Walker)。

**系统文件夹里有这么多**

大多数系统功能以 DLL 文件的形式向用户程序公开，因为它们是共享代码/资源的标准形式。每个功能都单独保存在不同的 DLL 文件中，以便只加载所需的 DLL 文件，从而减少系统的内存限制。

**已安装的应用程序也使用 DLL 文件**

如上所述，DLL 文件也成为物理分离功能的一种形式。好的应用程序也会尝试在绝对需要之前不加载 DLL 文件，从而减少内存需求。这也会导致应用程序附带大量 DLL 文件。

**DLL 地狱**

然而，当共享 DLL 文件和需要它们的程序之间存在版本不匹配时，系统升级经常会破坏其他程序。系统检查点和DLL缓存等一直是M$解决这个问题的举措。.NET 平台可能根本不会遇到这个问题。

**我们如何知道 DLL 文件中的内容？**

[您必须使用像DUMPBIN](http://support.microsoft.com/kb/177429)或 Dependency Walker 这样的外部工具，它不仅可以显示 DLL 文件中包含哪些公开可见的函数（称为导出），还可以显示它需要哪些其他 DLL 文件以及从这些 DLL 文件中导出哪些该 DLL 文件是依赖的。

**我们如何创建/使用它们？**

请参阅供应商提供的编程文档。对于 C++，请参阅 MSDN 中的[LoadLibrary](http://msdn.microsoft.com/en-us/library/windows/desktop/ms684175%28v=vs.85%29.aspx)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-23T23:49:43.153

假设您正在制作一个使用库中的某些函数的可执行文件。

如果您使用的库是**静态**的，则链接器将直接从库中复制这些函数的目标代码并将它们插入到可执行文件中。

现在，如果运行这个可执行文件，它就拥有了它需要的所有东西，所以可执行文件加载器只需将它加载到内存中并运行它。

如果库是**动态**的，则链接器将不会插入目标代码，而是会插入一个存根，该存根基本上表示此函数位于此**DLL**中的此位置。

现在，如果运行此可执行文件，则缺少可执行文件的位（即存根），因此加载程序会通过可执行文件修复丢失的存根。只有在解决了所有存根之后，才允许运行可执行文件。

要查看实际情况，请删除或重命名 DLL，并观察加载程序在您尝试运行可执行文件时如何报告丢失的 DLL 错误。

因此名称为**动态链接库**，链接过程的一部分是由可执行加载程序在运行时动态完成的。

最后一点，如果您不链接到 DLL，那么链接器将不会插入存根，但是 Windows 仍然提供**GetProcAddress** API，允许您在可执行文件启动后很长时间加载执行 DLL 函数入口点。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-23T23:39:18.963

DLL 文件包含一个**导出表**，它是一个可以由调用程序查找的符号列表。这些符号通常是具有[C 调用约定](http://gcc.gnu.org/onlinedocs/gnat_ugn_unw/C-Calling-Convention.html)( [__stcall](http://en.wikipedia.org/wiki/X86_calling_conventions#syscall) ) 的函数。导出表还包含函数的地址。

有了这些信息，调用程序就可以调用 DLL 中的函数，即使它在编译时没有访问 DLL 的权限。

*[介绍动态链接库](http://mirrors.zoreil.com/webclub.kcom.ne.jp/ma/colinp/win32/dll/intro.html)*有更多信息。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-23T23:42:57.363

DLL（动态链接库）和 SL（共享库，在 UNIX 下等效）只是可执行代码库，它们可以在加载时动态链接到可执行文件中。

静态库在编译时插入到可执行文件中，并从那时起固定。它们会增加可执行文件的大小并且无法共享。

动态库有以下优点：

1/ 它们是在运行时而不是编译时加载的，因此它们可以独立于可执行文件进行更新（您在 Windows 中看到的所有那些花哨的窗口和对话框都来自 DLL，因此您的应用程序的外观可以在没有您的情况下改变必须重写它）。

2/ 因为它们是独立的，所以代码可以在多个可执行文件之间共享 - 这可以节省内存，因为如果您使用单个 DLL 运行 100 个应用程序，内存中可能只有一个 DLL 副本。

它们的主要缺点是优势#1 - 让您的应用程序独立更改 DLL 可能会导致您的应用程序停止工作或开始以奇怪的方式运行。DLL 版本控制在 Windows 下往往不能很好地管理，这导致了古怪的命名为“DLL Hell”。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-23T23:36:41.357

[http://support.microsoft.com/kb/815065](http://support.microsoft.com/kb/815065)

> DLL 是一个库，其中包含可由多个程序同时使用的代码和数据。例如，在 Windows 操作系统中，Comdlg32 DLL 执行常见的对话框相关功能。因此，每个程序都可以使用此 DLL 中包含的功能来实现打开对话框。这有助于促进代码重用和有效的内存使用。
> 
> 通过使用 DLL，可以将程序模块化为单独的组件。例如，会计程序可以按模块销售。如果安装了该模块，则每个模块都可以在运行时加载到主程序中。因为模块是分开的，所以程序的加载时间更快，并且仅在请求该功能时才加载模块。
> 
> 此外，更新更容易应用于每个模块，而不会影响程序的其他部分。例如，您可能有一个工资计划，并且税率每年都在变化。当这些更改被隔离到 DLL 时，您可以应用更新而无需再次构建或安装整个程序。

[http://en.wikipedia.org/wiki/Dynamic-link_library](http://en.wikipedia.org/wiki/Dynamic-link_library)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-07-21T12:01:59.270

DLL 是一种文件扩展名和被称为“动态链接库”的文件格式，用于保存 Windows 程序的多个代码和过程。软件和游戏在 DLL 文件的基础上运行；创建 DLL 文件是为了让多个应用程序可以同时使用它们的信息。

如果您想获取有关 DLL 文件的更多信息或遇到任何错误，请阅读以下帖子。 [https://www.bouncegeek.com/fix-dll-errors-windows-586985/](https://www.bouncegeek.com/fix-dll-errors-windows-586985/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-23T23:36:34.743

DLL（动态链接库）包含一个或多个应用程序或服务使用的资源。它们可以包含类、图标、字符串、对象、接口以及开发人员需要存储的几乎所有东西，除了 UI。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-12-17T21:12:06.177

根据微软

(DLL) 动态链接库是包含应用程序运行所需的数据、代码或资源的文件。这些是由 Windows 生态系统创建的文件，可以在两个或多个应用程序之间共享。

When a program or software runs on Windows, much of how the application works depends on the DLL files of the program. For instance, if a particular application had several modules, then how each module interacts with each other is determined by the Windows DLL files.

If you want detailed explanation, check these useful resources

[What are dll files](https://support.microsoft.com/en-us/help/815065/what-is-a-dll) , [About Dll files](https://windowsmaximizer.com/blog/about-windows-dll-files/)

# grails - 带有 YUI 表示例的 Grails

> ID：124571
> 
> 赞同：2
> 
> 时间：2008-09-23T23:38:23.787
> 
> 标签：grails, yui

有没有人有一个使用 YUI 库中的表对象的例子。更具体地说，我想从 JSON 或 SQL 动态加载它？

[http://www.grails.org/YUI+Plugin](http://www.grails.org/YUI+Plugin)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T21:07:05.537

我刚刚找到了这个例子。这个周末会试一试。看起来正是我想要的。

[http://marceloverdijk.blogspot.com/2008/06/grails-yui-datatable-example.html](http://marceloverdijk.blogspot.com/2008/06/grails-yui-datatable-example.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T01:30:10.040

来自 YUI 文档：[DataTable 示例](http://developer.yahoo.com/yui/examples/datatable/index.html)。特别是，这里有[一个使用 JSON 和 XmlHttpRequest 的示例](http://developer.yahoo.com/yui/examples/datatable/dt_xhrjson.html)。

# java - Java equals()：反映还是不反映

> ID：124585
> 
> 赞同：9
> 
> 时间：2008-09-23T23:44:01.170
> 
> 标签：java, reflection, equals

这个问题与为具有大量字段的对象覆盖 equals() 方法特别相关。首先，让我说这个大对象不能在不违反 OO 原则的情况下分解成多个组件，所以告诉我“没有一个类应该有超过 x 个字段”是没有帮助的。

继续前进，当我忘记检查其中一个字段是否相等时，问题就解决了。因此，我的 equals 方法不正确。然后我想使用反射：

```
--code removed because it was too distracting-- 
```

这篇文章的目的不一定是重构代码（这甚至不是我正在使用的代码），而是获取关于这是否是一个好主意的输入。

**优点：**

*   如果添加了新字段，则会自动包含该字段

*   该方法比 30 个 if 语句简洁得多

**缺点：**

*   如果添加了一个新字段，它会自动包含在内，有时这是不可取的
*   性能：这必须更慢，我觉得没有必要打破分析器
*   在比较中将某些要忽略的字段列入白名单有点难看

有什么想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T23:49:02.497

如果您出于性能原因确实想要列入白名单，请考虑使用注释来指示要比较的字段。此外，如果您的字段没有很好的`equals()`.

PS如果你走这条路`equals()`，别忘了做类似的事情`hashCode()`。

PPS 我相信您已经考虑[过 HashCodeBuilder](http://commons.apache.org/lang/api/org/apache/commons/lang/builder/HashCodeBuilder.html)和[EqualsBuilder](http://commons.apache.org/lang/api/org/apache/commons/lang/builder/EqualsBuilder.html)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-06T12:43:50.437

使用 Eclipse，FFS！

删除您拥有的 hashCode 和 equals 方法。

右键单击该文件。

选择 Source->Generate hashcode and equals...

完毕！不再担心反射。

对添加的每个字段重复此操作，您只需使用大纲视图删除您的两个方法，然后让 Eclipse 自动生成它们。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T11:43:10.237

如果您确实采用反射方法，那么 EqualsBuilder 仍然是您的朋友：

```
 public boolean equals(Object obj) {
    return EqualsBuilder.reflectionEquals(this, obj);
 } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T02:08:27.890

如果您担心，这里有一个想法：

1/ 在添加/删除字段时忘记更新用于检查相等性的大量 if 语句。

2/ 在 equals() 方法中执行此操作的性能。

尝试以下操作：

a/ 在您的 equals() 方法中恢复使用长长的 if 语句序列。

b/ 有一个函数，它包含一个字段列表（在一个字符串数组中），它会根据实际情况检查该列表（即反映的字段）。如果它们不匹配，它将引发异常。

c/ 在此对象的构造函数中，对该函数进行同步的一次性调用（类似于单例模式）。换句话说，如果这是该类构造的第一个对象，则调用上面（b）中描述的检查函数。

如果您没有更新 if 语句以匹配反映的字段，那么当您运行程序时，异常会立即显现出来；然后您修复 if 语句并更新上面 (b) 中的字段列表。

对象的后续构造不会执行此检查，您的 equals() 方法将以最大可能的速度运行。

尽我所能，我无法找到这种方法的任何真正问题（StackOverflow 上可能存在更伟大的思想） - 对于运行一次行为的每个对象构造都有一个额外的条件检查，但这似乎相当小。

如果你足够努力，你仍然可以让你的 if 语句与你的字段列表和反映的字段不同步，但例外情况将确保你的字段列表与反映的字段匹配，你只需确保更新 if 语句和字段同时列出。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T23:51:48.653

您始终可以在 equals 方法中注释您想要/不想要的字段，这应该是一个简单明了的更改。

性能显然与实际比较对象的频率有关，但是很多框架都使用哈希映射，因此您的 equals 可能比您想象的更多地使用。

此外，说到哈希映射，您对 hashCode 方法也有同样的问题。

最后，您真的需要比较所有字段是否相等吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T00:02:48.533

您的代码中有一些错误。

1.  你不能假设`this`和`obj`是同一类。事实上，它被明确允许为`obj`任何其他类。您可以开始，`if ( ! obj instanceof myClass ) return false;`但这*仍然不正确*，因为`obj`可能是具有`this`可能重要的附加字段的子类。
2.  你必须用一个简单的支持`null`值`obj``if ( obj == null ) return false;`
3.  您不能将`null`和空字符串视为相等。`null`而是特殊对待。这里最简单的方法是从比较开始`Field.get(obj) == Field.get(this)`。如果它们都相等或恰好都指向同一个对象，则速度很快。（注意：这也是一种优化，因为这是一个缓慢的例程，所以您需要它。）如果失败，您可以使用 fast`if ( Field.get(obj) == null || Field.get(this) == null ) return false;`来处理恰好是`null`. 最后你可以使用通常的`equals()`.
4.  你没有使用`foundMismatch`

我同意汉克的观点`[HashCodeBuilder][1]`，这`[EqualsBuilder][2]`是一个更好的方法。它易于维护，不需要大量样板代码，并且您可以避免所有这些问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-06T11:44:25.423

您可以使用注释从检查中排除字段

例如

```
@IgnoreEquals
String fieldThatShouldNotBeCompared; 
```

然后当然您检查泛型 equals 方法中是否存在注释。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T23:52:26.857

如果您可以访问字段的名称，为什么不将您不想包含的字段始终以“local”或“nochk”或类似名称开头作为标准。

然后你将所有以这个开头的字段列入黑名单（代码不是那么难看）。

我不怀疑它有点慢。您需要决定是否要根据执行速度交换易于更新。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-24T00:05:53.253

看看 org.apache.commons.EqualsBuilder：

[http://commons.apache.org/proper/commons-lang/javadocs/api-3.2/org/apache/commons/lang3/builder/EqualsBuilder.html](http://commons.apache.org/proper/commons-lang/javadocs/api-3.2/org/apache/commons/lang3/builder/EqualsBuilder.html)

# php - c 和 php 的压缩库

> ID：124586
> 
> 赞同：3
> 
> 时间：2008-09-23T23:44:22.760
> 
> 标签：php, c, compression

为了节省网络流量，我想压缩我的数据。唯一的诀窍是我的客户端是 ac 应用程序，服务器是 php。我正在寻找可用于 c 和 php 的开源压缩库。

我想我可以编写一个外部 c 应用程序来解压缩我的数据，但我试图避免在服务器上产生额外的进程。

有知道的请贴出来！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T23:48:58.490

gzip 是最流行的压缩方案之一（如果不是最流行的）。PHP[从版本 4 开始支持它](http://php.net/zlib)。如果您需要更好的压缩，请[考虑 bzip2](http://us2.php.net/manual/en/book.bzip2.php)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T23:48:55.103

[Zlib](http://www.zlib.net/)提供 C API，也是 PHP 功能 API 的一部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T23:53:45.187

Php[支持](http://www.php.net/filters.compression)zlib 压缩，对于 c 压缩，您可以使用[zlib](http://www.zlib.net/)，但如果您想压缩网络通信，您应该再考虑一下 - 对于您的服务器而言，负载可能太多了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T23:48:07.680

[ZLIB](http://www.zlib.net/)

[这是](http://www.php.net/zlib)从 PHP 访问 zlib 的页面。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T23:48:47.787

您可能可以指示您的 Web 服务器在 HTTP 级别为您压缩数据，然后您就不必担心任何一端。对于 Apache，请查看[mod_deflate](http://httpd.apache.org/docs/2.0/mod/mod_deflate.html)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T23:55:13.747

这取决于您要传输的数据。如果是文本，请在 apache 上使用 mod_gzip（我假设您正在使用它）。我已经看到了大约 70% 的文本压缩。但是，如果您正在处理二进制数据，例如图像和视频，请使用更可压缩的媒体格式。

# python - 我知道 Perl 5。学习 Perl 6 而不是转向 Python 有什么好处？

> ID：124604
> 
> 赞同：26
> 
> 时间：2008-09-23T23:50:48.063
> 
> 标签：python, perl, raku

来自 Perl 5 背景，迁移到 Perl 6 或 Python 有哪些优势？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-24T00:54:03.857

从 Perl 切换到 Python 没有任何优势。从 Python 切换到 Perl 也没有任何优势。他们都同样有能力。根据你所知道的和你试图解决的问题来选择你的工具，而不是基于某种概念，即一种在某种程度上天生就比另一种更好。

唯一真正的优势是如果您从一种您不知道的语言切换到您知道的语言，在这种情况下您的工作效率可能会提高。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-24T07:28:18.447

Python 没有[*Junctions*](http://en.wikipedia.org/wiki/Perl_6#Junctions)。事实上，我认为到目前为止只有 Perl 有 Junctions。:-)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-24T00:55:42.260

在我看来，Python 的语法更干净、更简单、更一致。您可以在任何地方定义相同的嵌套数据结构，无论您打算将它们传递给函数（或从函数返回）还是直接使用它们。我非常喜欢 Perl，但是一旦我学会了足够多的 Python 来“获得”它，我就再也没有回头。

根据我的经验，Python 的随机片段往往比 Perl 的随机片段更具可读性。差异实际上归结为每种语言的文化，Perl 用户通常喜欢聪明，而 Python 用户更喜欢清晰。这并不是说你不能拥有清晰的 Perl 或狡猾的 Python，但这些都不太常见。

两者都是很好的语言，可以解决许多相同的问题。我个人倾向于 Python，如果没有其他原因，它似乎正在获得动力，而 Perl 似乎正在将用户流失到 Python 和 Ruby。

请注意上面的大量黄鼠狼词。老实说，这真的取决于个人喜好。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-23T23:53:44.373

Perl 通常比 python 更适合快速单行，尤其是涉及文本/正则表达式
[http://novosial.org/perl/one-liner/](http://novosial.org/perl/one-liner/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-24T07:51:23.697

Python 有一个巨大的优势：它已实现，有一个相当稳定的编译器。

Perl 6（2019 年更名为 Raku）是一种颇具远见的语言，在 2015 年发布了[稳定的编译器](https://rakudo.org/)和测试规范。它有一组非常酷的特性，其中包括：联结、语法（是的，你可以用 Raku 编写完整的解析器“正则表达式”）、字形级别的 unicode 处理和惰性列表。

在您的特定情况下，当您了解 Perl 5 时，您将很快熟悉 Raku（née Perl 6）语法。

有关 Raku 具有哪些酷炫功能的更全面列表，请参阅[https://raku.org/](https://raku.org/)或[常见问题解答](https://docs.raku.org/language/faq)。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-11-09T19:29:41.197

Python 的一个主要优势是现在可以以生产就绪的格式使用。

如果您需要与 Java 或 .net clr 密切合作，Python 有 Jython 和 IronPython。

Perl 6 的优点是基于与 Perl (1-5) 相同的原理；如果您喜欢 Perl，出于同样的原因，您也会喜欢 Perl 6。（有不止一种方法可以做到，等等）

Perl 6 还具有仅部分实现的优势：如果您想破解语言内部结构或帮助定义标准库，这是开始使用 Perl 6 的好时机。

**编辑**：（2011）现在仍然是破解 Perl6 内部结构的好时机，但现在有一个更加成熟、可用的 Perl6 发行版，[Rakudo Star](http://rakudo.org/how-to-get-rakudo "乐道之星")。如果您今天想使用 Perl6，那是一个不错的选择。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-24T14:49:34.160

您还没有说明为什么要离开 Perl*。如果我的水晶球今天还在工作，那是因为你不完全了解这种语言，所以它让你感到沮丧。

坚持使用 Perl 并好好学习这门语言。如果你这样做了，那么有一天你将成为一位大师，并且知道为什么你的问题是无关紧要的。启蒙降临到那些寻求它的人身上。

*   你称它为“Perl5”，但没有这样的语言。:P

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-11-28T00:26:46.243

IMO python的正则表达式，特别是。当您尝试将 perl 的 /e 运算符表示为 in 时，会变得非常慢。所以有疑问，您可能需要继续使用 Perl5 :-)`s/whatever/somethingelse/**e**`

# php - "SELECT * FROM users WHERE id IN ()" == FAIL

> ID：124606
> 
> 赞同：4
> 
> 时间：2008-09-23T23:51:14.007
> 
> 标签：php, mysql

我有一个名为 sqlf() 的函数，它模拟准备好的语句。例如，我可以执行以下操作：

```
$sql = sqlf("SELECT * FROM Users WHERE name= :1 AND email= :2",'Big "John"','bj@example.com') ;

```

由于各种原因，我不能使用准备好的语句，但我想效仿它们。我遇到的问题是像这样的查询

```
$sql = sqlf("SELECT * FROM Users WHERE id IN (:1)",array(1,2,3) );

```

我的代码有效，但它因空数组而失败，例如以下引发 mysql 错误：

```
SELECT * FROM Users WHERE id IN ();

```

有没有人有什么建议？我应该如何将空数组转换为可以注入 IN 子句的 sql？替换 NULL 将不起作用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T23:52:30.337

Null 是唯一可以保证不在集合中的值。为什么它不是一个选项？其他任何东西都可以看作是潜在集合的一部分，它们都是值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T00:09:55.537

我会说传递一个空数组作为 IN() 子句的参数是一个错误。调用此函数时，您可以控制查询的语法，因此您还应对输入负责。我建议在调用函数之前检查参数是否为空。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T00:01:40.673

是否有可能使用 sqlf 检测空数组并将 SQL 更改为没有 IN 子句？

或者，您可以在将 SQL 传递给“真正的”SQL 执行程序之前对其进行后处理，以便删除“IN ()”部分，尽管您必须采取各种诡计来查看必须删除哪些其他元素，以便：

```
SELECT * FROM Users WHERE id IN ();
SELECT * FROM Users WHERE a = 7 AND id IN ();
SELECT * FROM Users WHERE id IN () OR a = 9; 
```

会成为：

```
SELECT * FROM Users;
SELECT * FROM Users WHERE a = 7;
SELECT * FROM Users WHERE a = 9; 
```

根据您的 SQL 的复杂性，这可能会变得很棘手——您基本上需要一个完整的 SQL 语言解释器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T00:08:18.990

如果您的类似准备函数只是用等效参数替换 :1，您可以尝试让您的查询包含类似 (':1') 的内容，这样如果 :1 为空，它会解析为 ('')，这不会导致解析错误（但是，如果该字段可以具有空白值，则可能会导致不良行为——尽管如果它是 int，这不是问题）。但是，这不是一个非常干净的解决方案，您最好检测数组是否为空，并简单地使用缺少“IN (:1)”组件的替代版本的查询。（如果这是 WHERE 子句中的唯一逻辑，那么大概您不想选择所有内容，因此您根本不会执行查询。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T04:45:59.913

我会使用零，假设您的“id”列是一个自动分配数字的伪键。

据我所知，大多数品牌的数据库中的自动密钥生成器都是从 1 开始的。这是一种约定，而不是要求（标准 SQL 中没有定义自动编号的字段）。但是这个约定很常见，你可能可以依赖它。

由于零可能永远不会出现在您的“id”列中，因此当您的输入数组为空时，您可以在 IN() 谓词中使用此值，并且它永远不会匹配。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-24T00:04:00.573

我能想到的唯一方法是让你的`sqlf()`函数扫描，看看在“IN (”之后是否有特定的替换，然后如果传递的变量是一个空数组，放入你肯定知道的东西'不在该列中：`"m,znmzcb~~1"`例如。这是一个 hack，当然，但它会起作用。

如果你想更进一步，你能改变你的函数，以便有不同类型的替换吗？看起来您的函数扫描冒号后跟一个数字。为什么不添加另一种类型，例如 @ 后跟一个数字，这对于清空数组来说是很聪明的（这使您不必扫描和猜测变量是否应该是一个数组）。

# asp.net - 迭代类，即。用于 asp.net 的 bean

> ID：124615
> 
> 赞同：1
> 
> 时间：2008-09-23T23:55:12.547
> 
> 标签：asp.net, class, javabeans

假设我有一个类，它使用 getter 和 setter 来存储用户信息，并且填充了来自 XML 文件的数据。我将如何迭代该类的所有实例，就像使用 java bean 和标记库一样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T01:00:28.053

对于输出格式化的 HTML，您有几个选择。我可能会做的是在代码隐藏上创建一个属性，以访问您想要迭代的对象集合。然后，我将在 .aspx 页面本身上编写用于迭代和格式化它们的逻辑。例如，.aspx 页面：

```
[snip]
<body>
    <form id="form1" runat="server">
        <% Somethings.ForEach(s => { %>
            <h1><%=s.Name %></h1>
            <h2><%=s.Id %></h2>
        <% }); %>
    </form>
</body>
</html> 
```

然后是代码隐藏：

```
[snip]
public partial class _Default : System.Web.UI.Page
    {
        protected List<Something> Somethings { get; private set; }
        protected void Page_Load(object sender, EventArgs e)
        {
            Somethings = GetSomethings(); // Or whatever populates the collection

        }
[snip] 
```

您还可以查看使用转发器控件并将 DataSource 设置为您的集合。这与上面的代码几乎相同，但我认为这种方式更清晰（在我看来）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T00:48:16.973

这假设您可以获取类的所有实例并将它们添加到通用列表中。

```
List<YourClass> myObjects = SomeMagicMethodThatGetsAllInstancesOfThatClassAndAddsThemtoTheCollection();
foreach (YourClass instance in myObjects)
{
Response.Write(instance.PropertyName.ToString();
} 
```

如果您不想指定每个属性名称，您可以使用反射，（请参阅 PropertyInfo）并这样做。同样，不确定这是否是您的意图。

# c++ - 在 C++ 中计算矩阵的伪逆

> ID：124623
> 
> 赞同：4
> 
> 时间：2008-09-23T23:58:24.347
> 
> 标签：c++, matrix-inverse, recipe

我正在寻找在 C++ 中计算矩阵的 Moore-Penrose 伪逆，有人可以指出我的库实现或数值配方吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T00:13:22.207

您需要“单值分解”，您可以[在此处](http://www.nrbook.com/a/bookcpdf/c2-6.pdf)从 C 中的数字食谱中找到 C 实现。

[这个其他站点](https://planetmath.org/Pseudoinverse)描述了如何使用单值分解来计算伪逆。

# java - 使用 Java 的 ImageIO 将像素数组转换为 Image 对象？

> ID：124630
> 
> 赞同：28
> 
> 时间：2008-09-24T00:00:12.237
> 
> 标签：java, image, awt, toolkit, javax.imageio

我目前正在使用以下代码将像素值数组（最初使用 java.awt.image.PixelGrabber 对象创建）转换为 Image 对象：

```
public Image getImageFromArray(int[] pixels, int width, int height) {
    MemoryImageSource mis = new MemoryImageSource(width, height, pixels, 0, width);
    Toolkit tk = Toolkit.getDefaultToolkit();
    return tk.createImage(mis);
} 
```

*是否可以使用 ImageIO 包中的类来实现相同的结果，这样我就不必使用 AWT 工具包了？*

Toolkit.getDefaultToolkit() 似乎不是 100% 可靠，有时会抛出 AWTError，而 ImageIO 类应该始终可用，这就是我对更改方法感兴趣的原因。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-24T02:08:37.950

您可以在不使用 ImageIO 的情况下创建图像。只需使用与像素数组内容匹配的图像类型创建一个 BufferedImage。

```
public static Image getImageFromArray(int[] pixels, int width, int height) {
            BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);
            WritableRaster raster = (WritableRaster) image.getData();
            raster.setPixels(0,0,width,height,pixels);
            return image;
        } 
```

使用 PixelGrabber 时，不要忘记在调用`getImageFromArray`. 在 PixelGrabber javadoc的[handlepixelmethod](http://java.sun.com/javase/6/docs/api/java/awt/image/PixelGrabber.html)中有一个例子。完成此操作后，请确保 BufferedImage 构造函数中的图像类型为`BufferedImage.TYPE_INT_ARGB`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T22:53:05.773

使用栅格，我在创建with`ArrayIndexOutOfBoundsException`时得到了一个偶数。但是，使用为我工作的方法。`BufferedImage``TYPE_INT_ARGB``setRGB(...)``BufferedImage`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-03T10:14:57.637

BufferedImage.getData() 上的 JavaDoc 说：“作为图像数据**副本的光栅。”**

这段代码对我有用，但我怀疑它的效率：

```
 // Получаем картинку из массива.
        int[] pixels = new int[width*height];
            // Рисуем диагональ.
            for (int j = 0; j < height; j++) {
                for (int i = 0; i < width; i++) {
                    if (i == j) {
                        pixels[j*width + i] = Color.RED.getRGB();
                    }
                    else {
                        pixels[j*width + i] = Color.BLUE.getRGB();
                        //pixels[j*width + i] = 0x00000000;
                    }
                }
            }

BufferedImage pixelImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);    
    pixelImage.setRGB(0, 0, width, height, pixels, 0, width); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T01:51:30.037

我在使用 java.awt.Robot 抓取屏幕截图（或屏幕的一部分）方面取得了很大的成功，但要使用 ImageIO，您需要将其存储在 BufferedImage 而不是内存图像源中。然后您可以调用 ImageIO 的一种静态方法并保存文件。尝试类似：

```
// Capture whole screen
Rectangle region = new Rectangle(Toolkit.getDefaultToolkit().getScreenSize());
BufferedImage capturedImage = new Robot().createScreenCapture(region);

// Save as PNG
File imageFile = new File("capturedImage.png");
ImageIO.write(capturedImage, "png", imageFile); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-04T20:09:12.830

由于这是在 SO 上用 ImageIO 标记的投票率最高的问题之一，我认为即使问题已经过时，仍然有更好的解决方案的空间。:-)

查看我在 GitHub 上的开源 imageio 项目中的[BufferedImageFactory.java类。](https://github.com/haraldk/TwelveMonkeys/blob/master/common/common-image/src/main/java/com/twelvemonkeys/image/BufferedImageFactory.java)

有了它，你可以简单地写：

```
BufferedImage image = new BufferedImageFactory(image).getBufferedImage(); 
```

另一个好处是，作为最坏的情况，这种方法的性能（时间）与`PixelGrabber`该线程中已经基于 - 的示例具有大致相同的性能（时间）。对于大多数常见情况（通常是 JPEG），它的速度大约是原来的两倍。无论如何，它使用更少的内存。

作为附带奖励，原始图像的颜色模型和像素布局被保留，而不是使用默认颜色模型转换为 int ARGB。这可能会节省额外的内存。

（PS：如果有人感兴趣，工厂还支持子采样、感兴趣区域和进度侦听器。:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-06-21T15:21:03.130

我有同样的问题，其他人都试图应用这个问题的正确答案，我的 int 数组实际上得到了一个 OutOfboundException 我修复了它添加了一个索引，因为数组的长度必须是 widht*height*3 在这之后我无法获取图像，所以我修复了它，将光栅设置为图像

```
public static Image getImageFromArray(int[] pixels, int width, int height) {
        BufferedImage image = new BufferedImage(width, height,     BufferedImage.TYPE_INT_ARGB);
        WritableRaster raster = (WritableRaster) image.getData();
        raster.setPixels(0,0,width,height,pixels);
        image.setData(raster); 
        return image;
    } 
```

如果你像这样在 jframe 上的标签上显示它，你可以看到图像

```
 JFrame frame = new JFrame();
    frame.getContentPane().setLayout(new FlowLayout());
    frame.getContentPane().add(new JLabel(new ImageIcon(image)));
    frame.pack();
    frame.setVisible(true); 
```

在 imageIcon() 上设置图像。最后一条建议您可以尝试将 Bufferedimage.TYPE_INT_ARGB 更改为与您从该类型获得的数组匹配的图像非常重要我有一个 0 和 -1 的数组所以我使用了这种类型 BufferedImage.TYPE_3BYTE_BGR

# c# - 远程检查 IP 端口状态

> ID：124638
> 
> 赞同：1
> 
> 时间：2008-09-24T00:02:04.340
> 
> 标签：c#, tcp, remoting, udp, ip

我发现了一篇关于在机器上获取活动 tcp/udp 连接的文章。

[http://www.codeproject.com/KB/IP/iphlpapi.aspx](http://www.codeproject.com/KB/IP/iphlpapi.aspx)

然而，我的问题是我需要能够远程确定活动连接 - 以查看特定端口是否正在运行或正在侦听而不篡改机器。

这可能吗？

看起来不像本机，否则可能会造成安全问题。另一种方法是查询远程服务，然后可以在本地机器上进行必要的调用。

有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T00:03:24.243

[Nmap](http://nmap.org)是您正在寻找的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T00:03:10.950

如果远程计算机不知道，就无法知道哪些端口是打开的。但是您可以在端口上运行的程序不知道的情况下确定信息（即不干扰程序）。

**使用 SYN 扫描：**

为了建立连接，TCP 使用三次握手。这可以被利用来在程序不知道的情况下找出端口是否打开。

握手工作如下：

1.  客户端通过向服务器发送 SYN 来执行主动打开。
2.  服务器回复一个 SYN-ACK。
3.  通常，客户端将 ACK 发送回服务器。但是这一步被跳过了。

> SYN 扫描是最流行的 TCP 扫描形式。端口扫描器不使用操作系统的网络功能，而是自己生成原始 IP 数据包，并监控响应。这种扫描类型也称为“半开扫描”，因为它实际上从未打开完整的 TCP 连接。端口扫描器生成一个 SYN 数据包。如果目标端口是开放的，它将以 SYN-ACK 数据包响应。扫描仪主机以 RST 数据包响应，在握手完成之前关闭连接。
> 
> 使用原始网络有几个优点，使扫描仪可以完全控制发送的数据包和响应超时，并允许详细报告响应。关于哪种扫描对目标主机的侵入性较小存在争议。SYN 扫描的优点是单个服务永远不会真正接收到连接，而某些服务可能会因连接扫描而崩溃。但是，握手期间的 RST 可能会导致某些网络堆栈出现问题，尤其是打印机等简单设备。无论哪种方式，都没有确凿的论据。

[来源维基百科](http://en.wikipedia.org/wiki/Port_scanner)

如下所述，我认为[nmap](http://nmap.org/)可以做SYN扫描。

**使用套接字进行 TCP 端口扫描：**

确定哪些端口打开的一种方法是打开该端口的套接字。或者到一个不同的端口，它会像你提到的那样为你找到信息。

例如从命令提示符或终端：

```
telnet google.com 80 
```

**UDP端口扫描：**

如果 UDP 数据包被发送到未打开的端口，系统将响应 ICMP 端口不可达消息。您可以使用此方法来确定端口是打开还是关闭。但是接收程序会知道。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T05:49:29.000

[neouser99](https://stackoverflow.com/questions/124638/checking-ip-port-state-remotely#124643) (et al) 建议使用[NMAP](http://nmap.org/)。如果您要做的只是检测远程计算机上打开的端口，NMAP 非常好。

但是从您的问题的声音来看，您实际上是在尝试确定远程计算机上打开*和*连接的端口。如果您想要一个通用的监控解决方案，包括连接的端口，那么您可以在您的远程计算机上安装一个 snmp 服务器。有两个[MIB](http://en.wikipedia.org/wiki/Management_information_base)可让您检查端口状态，它们是[TCP-MIB](https://www.rfc-editor.org/rfc/rfc4022) ::tcpConnectionTable 和[UDP-MIB](https://www.rfc-editor.org/rfc/rfc4113) ::udpEndpointTable。

[net-snmp](http://www.net-snmp.org/)中提供的守护程序（服务器）很可能已获得对这些 mib 的支持。

# ruby - 如何在 Ruby 中生成成对距离数组？

> ID：124647
> 
> 赞同：1
> 
> 时间：2008-09-24T00:04:53.707
> 
> 标签：ruby, algorithm

假设我有一个代表一组点的数组：

```
x = [2, 5, 8, 33, 58] 
```

如何生成所有成对距离的数组？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T00:28:31.250

```
x = [2, 5, 8, 33, 58]
print x.collect {|n| x.collect {|i| (n-i).abs}}.flatten 
```

我认为这样做可以。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T20:07:10.870

如果你真的想要一个数组而不是矩阵，这是 O(n^2/2) 而不是 O(n^2)。

```
result=[]
x.each_index{|i| (i+1).upto(x.size-1){|j| result<<(x[i]-x[j]).abs}} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T02:51:41.660

```
x.map{|i| x.map{|j| (i-j).abs } } 
```

给

```
[[0, 3, 6, 31, 56],
 [3, 0, 3, 28, 53],
 [6, 3, 0, 25, 50],
 [31, 28, 25, 0, 25],
 [56、53、50、25、0]]
```

（通过使用'pp'而不是puts打印它来格式化它）

和

```
x.map{|i| x.map{|j| (i-j).abs } }.flatten 
```

给

```
[0, 3, 6, 31, 56, 3, 0, 3, 28, 53, 6, 3, 0, 25, 50, 31, 28, 25, 0, 25, 56, 53, 50, 25, 0 ]
```

如果你真的想要一个数组

# silverlight - 如何在 Silverlight 中赋予文本框焦点？

> ID：124649
> 
> 赞同：32
> 
> 时间：2008-09-24T00:05:13.147
> 
> 标签：silverlight, textbox, focus

在我的 Silverlight 应用程序中，我似乎无法将焦点放在 TextBox 控件上。根据各种帖子的建议，我将 IsTabStop 属性设置为 True，并且我正在使用 TextBox.Focus()。虽然 UserControl_Loaded 事件正在触发，但 TextBox 控件没有获得焦点。我在下面包含了我非常简单的代码。我错过了什么？谢谢。

***页面.xaml***

```
<UserControl x:Class="TextboxFocusTest.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Loaded="UserControl_Loaded" 
    Width="400" Height="300">

    <Grid x:Name="LayoutRoot" Background="White">        
        <StackPanel Width="150" VerticalAlignment="Center">            
            <TextBox x:Name="RegularTextBox" IsTabStop="True" />    
        </StackPanel>        
    </Grid>
</UserControl> 
```

***页面.xaml.cs***

```
using System.Windows;
using System.Windows.Controls;

namespace PasswordTextboxTest
{
    public partial class Page : UserControl
    {
        public Page()
        {
            InitializeComponent();
        }

        private void UserControl_Loaded(object sender, RoutedEventArgs e)
        {
            RegularTextBox.Focus();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-24T19:03:58.307

我在 silverlight.net 上找到了这个，并且能够通过在调用 RegularTextBox.Focus() 之前添加对 System.Windows.Browser.HtmlPage.Plugin.Focus() 的调用来让它为我工作：

```
 private void UserControl_Loaded(object sender, RoutedEventArgs e)
   {        
      System.Windows.Browser.HtmlPage.Plugin.Focus();
      RegularTextBox.Focus();
   } 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-04-14T15:09:03.387

```
Plugin.Focus(); 
```

对我不起作用。

打电话

```
 Dispatcher.BeginInvoke(() => { tbNewText.Focus();}); 
```

从 Load 事件开始。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-01-27T18:16:15.977

感谢 Santiago Palladino Dispatcher 完美地为我工作。我正在做的是：

this.Focus(); 然后 Dispatcher.BeginInvoke(() => { tbNewText.Focus();});

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-10-16T10:27:31.727

我解决了放入控制构造函数：

```
this.TargetTextBox.Loaded += (o, e) => { this.TargetTextBox.Focus(); }; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T02:05:12.170

你确定你没有真正集中注意力吗？Beta 2 中有一个已知错误，您可以集中注意力并可以打字，但您不会得到插入符号或边框。解决方法是在调用 Focus() 之前在文本框上调用 UpdateLayout()。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T14:01:16.600

我会尝试在整个控件加载后几毫秒执行 Focus 方法的 UserLoaded 事件上添加 DispatcherTimer；也许问题就在那里。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-08T20:53:51.627

我还需要打电话

Deployment.Current.Dispatcher.BeginInvoke(() => myTextbox.Focus());

有趣的是，当我在 TextBlock 上单击鼠标、折叠 TextBlock 并使 TextBox 可见时，此调用发生在事件处理程序内部。如果我没有通过 dispatcher.BeginInvoke 跟踪它，它将不会获得焦点。

-麦克风

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T00:47:33.637

您设置焦点的代码是正确的，因为如果您添加一个调用相同代码的按钮，它可以完美地工作：

```
<StackPanel Width="150" VerticalAlignment="Center">
    <TextBox x:Name="RegularTextBox" IsTabStop="True" />
    <Button Click="UserControl_Loaded">
        <TextBlock Text="Test"/>
    </Button>
</StackPanel> 
```

所以我假设这与 Focus() 需要某种用户交互有关。我无法让它与 UserControl 上的 MouseMove 事件一起工作，但放置一个 KeyDown 事件来设置焦点是可行的（尽管模板不会更新为焦点模板）。

```
Width="400" Height="300" Loaded="UserControl_Loaded" KeyDown="UserControl_KeyDown"> 
```

对我来说似乎是一个错误......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-12T09:38:46.047

对于浏览器外的应用程序`System.Windows.Browser.HtmlPage.Plugin.Focus();`不存在。

有关其他想法，请参阅[我的问题](https://stackoverflow.com/questions/1892891/how-to-set-focus-on-textbox-in-silverlight-4-out-of-browser-popup)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-12-16T10:05:28.443

它适用于 SL4 和 IE7 以及 Firefox 3.6.12

最后缺少的“一块”使重点工作（对我来说）是设置 .TabIndex 属性

```
 System.Windows.Browser.HtmlPage.Plugin.Focus();
        txtUserName.IsTabStop = true;
        txtPassword.IsTabStop = true;

        if (txtUserName.Text.Trim().Length != 0)
        {
            txtPassword.UpdateLayout();
            txtPassword.Focus();
            txtPassword.TabIndex = 0;
        }
        else
        {
            txtUserName.UpdateLayout();
            txtUserName.Focus();
            txtUserName.TabIndex = 0;
        } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-05-01T09:41:30.560

我的个人资料不足以评论@Jim BG 的[答案](https://stackoverflow.com/a/129167/1278807)，但对我有用的是在 RichTextBox 上添加 Loaded 事件的处理程序，并在该处理程序内添加

```
System.Windows.Browser.HtmlPage.Plugin.Focus();
<YourTextBox>.UpdateLayout()
<YourTextBox>.Focus(); 
```

但是，它只适用于 IE 和 FF。要让它在 Chrome 和 Safari 上运行，请滚动到底[部](http://social.msdn.microsoft.com/Forums/en-US/silverlightarchieve/thread/429a3905-1f19-4e1e-abbf-40feb267da54/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T03:03:13.950

我忘了一件事...我还没有找到一种方法可以可靠地强制将焦点集中在页面上的 Silverlight 应用程序上（它可以在某些浏览器上运行，而不能在其他浏览器上运行）。

因此，Silverlight 应用程序本身可能没有焦点。在我开始期待键盘输入以确保 silverlight 应用程序具有焦点之前，我通常会诱骗用户单击按钮或类似的东西。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-01-13T21:31:52.033

我也遇到了这个问题，但它与这里已经回答的情况不同。

如果您`BusyIndicator`在视图期间完全显示和隐藏了一个控件，则如果您有类似的线条，控件将不会获得焦点

```
Dispatcher.BeginInvoke(() => { myControl.Focus();}); 
```

在加载事件中。

相反，您需要在BusyIndi​​cator 显示设置为 false*后调用该行代码。*

我在[这里](https://stackoverflow.com/questions/8855639/binding-a-usercontrol-to-a-custom-busyindicator-control)有一个相关的问题，以及这种情况的解决方案。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-08-25T12:18:49.340

确实是令人讨厌的行为。我找到了一个简单直接的解决方案：

（VB代码）

```
 Me.Focus()
    Me.UpdateLayout()

    Me.tbx_user_num.Focus()
    Me.tbx_user_num.UpdateLayout() 
```

这里的每个元素都是必不可少的，至少根据我的项目（VB2010 SL4 OutOfBrowser）。

归功于： http: [//www.dotnetspark.com/kb/1792-set-focus-to-textbox-silverlight-3.aspx](http://www.dotnetspark.com/kb/1792-set-focus-to-textbox-silverlight-3.aspx)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-03-06T09:40:46.940

以上答案都没有直接对我有用，我所做的是我在 MainPage() 构造函数中添加了这个事件：

```
this.Loaded += new RoutedEventHandler(MainPage_Loaded); 
```

并处理如下：

```
 void MainPage_Loaded(object sender, RoutedEventArgs e)
    {
        System.Windows.Browser.HtmlPage.Plugin.Focus();
        RegularTextBox.Focus();
    } 
```

我的 Silverlight 版本是 4。

# svn - 你集成了 Mantis 和 Subversion 吗？

> ID：124650
> 
> 赞同：8
> 
> 时间：2008-09-24T00:05:50.943
> 
> 标签：svn, mantis, scmbug

我主要做Windows开发。我们使用[Mantis](http://www.mantisbt.org/)和[Subversion](http://subversion.tigris.org/)进行开发，但它们没有集成在一起，实际上它们位于不同的服务器上。

我做了一些关于将两者整合在一起的谷歌搜索，并遇到了[这篇文章](http://alt-tag.com/blog/archives/2006/11/integrating-mantis-and-subversion/)。看起来很有趣。

我想知道是否有人正在这样做或已经这样做以及您的经历是什么。如果您有不同的解决方案，我也有兴趣知道！

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T18:18:05.213

我将 Mantis 与 SVN 一起使用。就像那个链接说的那样，虽然我把正则表达式放在提交后，所以如果提交消息不相关，它不会尝试更新错误，这使得非错误更新提交的响应速度稍快一些。

我的 Mantis 安装也在不同的服务器上。我在Mantis 1.1.6 中使用[curl](http://curl.haxx.se/)调用[php方法。](http://www.mantisbt.org/bugs/view.php?id=8847)

把它放在你的 post-commit.cmd 钩子中（你需要下载[草莓 perl](http://strawberryperl.com/)并从中获取 perl.exe 和 perl510.dll，你不需要其余的）

```
c:\tools\perl c:\tools\mantis_urlencode.pl %1 %2  > c:\temp\postcommit_mantis.txt
if %ERRORLEVEL% NEQ 0 exit /b 0

c:\tools\curl -s -d user=svn -d @c:\temp\postcommit_mantis.txt http://swi-sgi-l-web1.ingrnet.com/mantis/core/checkincurl.php 
```

并将其放入 mantis_urlencode.pl

```
$url = `svnlook log -r $ARGV[1] $ARGV[0]`;

# check the string contains the matching regexp, 
# quit if it doesn't so we don't waste time contacting the webserver
# this is the g_source_control_regexp value in mantis.

exit 1 if not $url =~ /\b(?:bug|issue|mantis)\s*[#]{0,1}(\d+)\b/i;

$url = $url . "\n" . `svnlook dirs-changed -r $ARGV[1] $ARGV[0]`;

#urlencode the string
$url =~ s/([^\w\-\.\@])/$1 eq " "?"+":  sprintf("%%%2.2x",ord($1))/eg;

print "log=$url";

exit 0; 
```

如果你想从 VSS 迁移，有很多脚本，包括我在[codeplex](http://vss2svn.codeplex.com/Wiki/View.aspx)上写的一个。

这一切都很好，我们一直在使用它，而且它足够快以至于不会注意到它的存在。只需键入“Fixed Mantis #1234”，它就会解决该错误并为其添加错误注释。该脚本还将已修改的目录也添加到错误注释中（我尝试显示更改的文件，但太多有损于易于理解）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-12T17:29:36.750

我们使用 scmbug 将 SVN 链接到 Bugzilla 已经有一段时间了。在我们最近升级到 Bugzilla 3.2 之前工作得很好，这破坏了集成。scmbug 团队需要一点时间才能赶上 SCM 工具的新版本，这是可以理解的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-02T02:08:42.400

这是我们使用的[Subversion 提交后脚本](https://gist.github.com/762207)。它使用 PHP 来运行 Mantis checkin PHP 脚本，如原始帖子中[此链接中所建议的那样。](http://alt-tag.com/blog/archives/2006/11/integrating-mantis-and-subversion/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T00:08:00.470

我遇到了[scmbug](http://freshmeat.net/projects/scmbug/)。看起来它将把像 Mantis 这样的东西连接到像 Subversion 这样的东西上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-27T13:44:08.627

我们按照您链接中的步骤进行操作 - 唯一的区别是在 Windows 上您使用的是 post-commit.bat。如果您向下滚动，则有人发布示例。我们对其进行了修改，因此它记录了更改的文件以及更改了它们的人 - 对批处理文件的相当简单的破解。我们尝试在某一时刻包含差异 - 但很快就很明显这样做是一个坏主意，因为某些签入的大小。

它工作得非常好，我真的很高兴 - 现在我必须将我们所有的 Sourcesafe 东西转移到......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-04T02:31:02.533

我个人使用 VisualSVN 服务器和公共 Mantis 错误跟踪器在我的本地开发环境中使用私有 SVN 存储库。我不得不稍微更改 checkin.php 文件以处理来自 Web 服务器的调用（借助此网页：[http](http://www.mantisbt.org/bugs/view.php?id=8847) ://www.mantisbt.org/bugs/view.php?id=8847 ）

我制作了一个简短的 C# 控制台应用程序来处理此问题，而不是批处理文件，因此它更具可配置性并支持远程或本地 checkin.php 文件。

如果您有兴趣，我已经在我的博客上发布了一篇关于源代码的文章：http: [//mp4m.org/blog/svn-and-mantis-bug-tracker-integration/](http://mp4m.org/blog/svn-and-mantis-bug-tracker-integration/)

希望有帮助！

# svn - 学习如何使用 Subversion

> ID：124667
> 
> 赞同：18
> 
> 时间：2008-09-24T00:10:17.907
> 
> 标签：svn, version-control

对于开发人员类型的人来说，这可能是一个非常愚蠢的新手问题，但我很茫然:(我一直在尝试学习如何使用 Subversion 来保存我的代码历史，但我正在找到它相当混乱。我阅读了 Subversion 附带的“书”，但我没有发现它有多大帮助。我使用的是 Windows，我下载了 TortoiseSVN GUI。

我真正想知道的只是创建一个新项目，在其中放入一个文件（任何旧文件），然后更新该文件，这样我就可以看到它是如何工作的。我创建了一个“存储库”（在 svn_repository/test 中），如果有人能告诉我应该如何创建一个新文件/将一个文件放入其中，然后更新该文件，我会非常高兴： ）知道我的运气，这将是“将文件拖放到目录中”这样简单的事情。抱歉问了这么愚蠢的问题！

此外，如果有人能告诉我如何让它与 Zend Studio 一起工作，那将是非常棒的一点。谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T00:23:10.793

subversion repo 的推荐目录结构包含三个文件夹：“branches”、“tags”和“trunk”。因此，在新文件夹中方便的地方创建这些文件夹。

右键单击这些文件夹的父文件夹，转到 TortoiseSVN 并选择 Import。输入您在此处创建的存储库的 url（即[https://JUNK:8443/svn/Test/](https://JUNK:8443/svn/Test/)是我刚刚在本地计算机上创建的一个）。点击确定按钮，文件夹将被导入。

现在浏览到您希望存储库在本地计算机上的位置（我已经转到 C:\workspace\test）。右键单击并转到 SVN Checkout。

现在，您想从存储库的主干中签出，因此更改存储库 URL 以反映这一点 ( [https://JUNK:8443/svn/Test/trunk/](https://JUNK:8443/svn/Test/trunk/) )。点击确定按钮。

在此目录中创建一个新文件。右键单击它并转到 TortoiseSVN，然后添加。点击确定，该文件现在被标记为 repo 的新文件。右键单击文件的父文件夹，您应该会看到 SVN Update 和 SVN Commit。SVN 更新将使用存储库中的文件刷新本地文件。SVN Commit 会将已更改的本地文件发送回存储库。

玩得开心 ：）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T00:27:03.343

通常当我创建一个新项目时，我必须参考[SVN 快速入门](http://svnbook.red-bean.com/nightly/en/svn.intro.quickstart.html)指南。

它会带您完成创建新存储库、初始导入以及如何签出和签入文件（在命令行上）。

这本书很有帮助，但是在您使用版本控制一段时间并更好地理解这些概念之后，您会从中获得最大的价值。

（注意下面粗体字的术语）

如果您使用 TortoiseSVN，您必须**创建**存储库，然后在启动时**导入**您的文件（如果有的话）。之后，您将**项目****签出**到**工作文件夹**，并且可以在工作文件夹中创建文件，然后轻松**添加它们。**创建存储库后，您只能通过 Subversion 客户端通过它进行交互。

 ******* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T01:05:07.260

你要求一个单一文件的项目，所以在这里。我对 Tortoise 不够熟悉，无法以这种方式运行您，但我会列出命令，希望您可以通过在文件资源管理器中单击鼠标右键来自己弄清楚如何执行每个步骤。实际上，您只需要做五件事：创建存储库、签出、“添加”文件以使其受版本控制、签入和登录。其余的将在稍后到来。

另外，以后有人可能会搜索不使用 Tortoise 的learing subversion，他们会找到这个问题。

```
# create an empty repository
svnadmin create myrepos

# check out a working copy of the empty repository
svn co file://full/path/to/myrepos workingcopy

# create an empty file in workingcopy (nothing to do with SVN - use 
# File > New > Text Document if you like)
cd workingcopy
touch mycode

# place it under version control, then tell the repository what you've done.
svn add mycode
svn ci -m "My first ever checkin comment! File created."

# Now we're developing. Go edit the file. Come back when you're done.

# Check it back in
svn ci -m "First version of project"

# Go edit it again

# Check it in again
svn ci -m "Made my project better"

# See what we've done so far
svn log mycode 
```

就是这样。这是对单个文件进行版本控制的最低要求。现在重新阅读 SVN 书籍的开头，删除 myrepos，然后重新开始，因为您可能希望按照它告诉您的方式构建您的第一个适当的存储库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T00:12:12.473

看看这个[问题](https://stackoverflow.com/questions/35670/begining-svn#35701)，它对从 svn 开始有一些很好的指导

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T00:17:34.223

我真的很喜欢将 AnkhSvn 与 Tortoise 结合使用。它适用于 Visual Studio。当我建立自己的存储库时，我使用了 VisualSVN，它需要 2 秒才能运行，并且不涉及任何 apache 或 LAMP 的东西。刚开箱即用。至于使用它，请尝试在线免费书籍以了解源代码控制的全部内容。然后访问一个网站，例如[http://blog.taragana.com/index.php/archive/5-minutes-guide-to-subversion/](http://blog.taragana.com/index.php/archive/5-minutes-guide-to-subversion/)以获取有关如何使用它的快速教程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T00:13:12.627

存储库是 Subversion 自己管理文件的地方 - 您不会直接访问存储库中的文件。如果您已经创建了存储库，那么下一步是从存储库到某个工作目录进行 Checkout。（此工作目录不应是存储库的子目录。）

结帐后，将文件放在那里，然后右键单击以添加它。从那时起，其他操作应该更有意义。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T00:35:49.233

[SVN Book](http://svnbook.red-bean.com/)有一个名为“Subversion 快速入门指南”的附录，它快速介绍了非常基础的内容。这是一个快速概述。

对于初始设置，我在 SVN 服务器上创建了一个临时文件夹，我将在其中设置我的站点结构。这只是一个临时文件夹，我在完成初始设置后将其删除。我通常将其称为 C:\tmpRepository。然后我在那里为我的项目名称创建一个新文件夹。因此，假设您的项目名称是 test。我会创建 c:\tmpRepositories\test。在该文件夹中创建三个文件夹：分支、标签、主干。然后将您的项目文件复制到主干目录中。

现在打开命令提示符并键入以下内容以创建新的存储库。svnadmin 创建 c:\AppRepositories\test。我只是将所有源代码保存在 AppRepositories 文件夹中，然后使用新文件夹设置每个项目。

接下来，我们需要使用临时目录中的文件加载我们的新存储库。因此，在命令提示符打开的情况下，我们运行： svn import c:\tmpRepositories\test file:///c:/AppRepositories/test -m "initial import"

就是这样！然后在您的开发计算机上安装 TortoiseSVN。您需要在计算机上设置一个位置，用于存储文件的工作副本。我通常只是在 C: 驱动器上创建一个名为“WorkingCode”的文件夹。打开该文件夹，右键单击并选择 SVN Checkout。在存储库的 URL 下，输入 svn://servername/test。确保结帐目录正确。

砰！您现在应该在主干目录 (c:\workingcode\test\trunk) 中看到所有代码文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T00:47:59.173

prags 写了一本关于使用 Subversion 的好书：http: [//www.pragprog.com/titles/svn2/pragmatic-version-control-using-subversion](http://www.pragprog.com/titles/svn2/pragmatic-version-control-using-subversion)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T00:17:39.810

我发现 TortoiseSVN 非常令人困惑，尤其是与 SVN Book 结合使用时。但话又说回来，我不是一个非常面向 GUI 的人。

使用命令行 SVN 客户端通读本书，直到您了解基本概念。不要跳过任何章节！

然后，您可以评估 GUI，如果那时您甚至需要一个。

# java - 从集合中选择一个随机元素

> ID：124671
> 
> 赞同：200
> 
> 时间：2008-09-24T00:12:17.747
> 
> 标签：java, algorithm, language-agnostic, random, set

如何从集合中选择随机元素？我对在 Java 中从 HashSet 或 LinkedHashSet 中选择随机元素特别感兴趣。也欢迎其他语言的解决方案。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-09-24T00:17:08.267

```
int size = myHashSet.size();
int item = new Random().nextInt(size); // In real life, the Random object should be rather more shared than this
int i = 0;
for(Object obj : myhashSet)
{
    if (i == item)
        return obj;
    i++;
} 
```

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2008-09-24T00:43:03.633

一个有点相关的你知道吗：

有一些有用的方法[`java.util.Collections`](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html)可以洗牌整个集合：[`Collections.shuffle(List<?>)`](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#shuffle-java.util.List-)和[`Collections.shuffle(List<?> list, Random rnd)`](https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#shuffle-java.util.List-java.util.Random-).

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2011-04-14T20:06:48.913

`ArrayList`使用 an和 a的 Java 快速解决方案`HashMap`：[元素 -> 索引]。

动机：我需要一组具有`RandomAccess`属性的项目，尤其是从集合中选择一个随机项目（参见`pollRandom`方法）。二叉树中的随机导航是不准确的：树不是完全平衡的，这不会导致均匀分布。

```
public class RandomSet<E> extends AbstractSet<E> {

    List<E> dta = new ArrayList<E>();
    Map<E, Integer> idx = new HashMap<E, Integer>();

    public RandomSet() {
    }

    public RandomSet(Collection<E> items) {
        for (E item : items) {
            idx.put(item, dta.size());
            dta.add(item);
        }
    }

    @Override
    public boolean add(E item) {
        if (idx.containsKey(item)) {
            return false;
        }
        idx.put(item, dta.size());
        dta.add(item);
        return true;
    }

    /**
     * Override element at position <code>id</code> with last element.
     * @param id
     */
    public E removeAt(int id) {
        if (id >= dta.size()) {
            return null;
        }
        E res = dta.get(id);
        idx.remove(res);
        E last = dta.remove(dta.size() - 1);
        // skip filling the hole if last is removed
        if (id < dta.size()) {
            idx.put(last, id);
            dta.set(id, last);
        }
        return res;
    }

    @Override
    public boolean remove(Object item) {
        @SuppressWarnings(value = "element-type-mismatch")
        Integer id = idx.get(item);
        if (id == null) {
            return false;
        }
        removeAt(id);
        return true;
    }

    public E get(int i) {
        return dta.get(i);
    }

    public E pollRandom(Random rnd) {
        if (dta.isEmpty()) {
            return null;
        }
        int id = rnd.nextInt(dta.size());
        return removeAt(id);
    }

    @Override
    public int size() {
        return dta.size();
    }

    @Override
    public Iterator<E> iterator() {
        return dta.iterator();
    }
} 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2014-08-20T17:03:58.023

这比接受答案中的 for-each 循环快：

```
int index = rand.nextInt(set.size());
Iterator<Object> iter = set.iterator();
for (int i = 0; i < index; i++) {
    iter.next();
}
return iter.next(); 
```

`Iterator.hasNext()`for-each 构造在每个循环上调用，但由于`index < set.size()`，该检查是不必要的开销。我看到速度提高了 10-20%，但是 YMMV。（此外，无需添加额外的 return 语句即可编译。）

请注意，此代码（以及大多数其他答案）可以应用于任何 Collection，而不仅仅是 Set。以通用方法形式：

```
public static <E> E choice(Collection<? extends E> coll, Random rand) {
    if (coll.size() == 0) {
        return null; // or throw IAE, if you prefer
    }

    int index = rand.nextInt(coll.size());
    if (coll instanceof List) { // optimization
        return ((List<? extends E>) coll).get(index);
    } else {
        Iterator<? extends E> iter = coll.iterator();
        for (int i = 0; i < index; i++) {
            iter.next();
        }
        return iter.next();
    }
} 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2018-07-19T01:15:32.860

在 Java 8 中：

```
static <E> E getRandomSetElement(Set<E> set) {
    return set.stream().skip(new Random().nextInt(set.size())).findFirst().orElse(null);
} 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-09-24T19:38:30.237

如果您想在 Java 中执行此操作，您应该考虑将元素复制到某种随机访问集合（例如 ArrayList）中。因为，除非您的集合很小，否则访问所选元素的成本会很高（O(n) 而不是 O(1)）。[ed: 列表副本也是 O(n)]

或者，您可以寻找另一个更符合您要求的 Set 实现。Commons Collections中的[ListOrderedSet](http://commons.apache.org/collections/api-release/org/apache/commons/collections/set/ListOrderedSet.html)看起来很有希望。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-24T00:16:32.073

**在 Java 中：**

```
Set<Integer> set = new LinkedHashSet<Integer>(3);
set.add(1);
set.add(2);
set.add(3);

Random rand = new Random(System.currentTimeMillis());
int[] setArray = (int[]) set.toArray();
for (int i = 0; i < 10; ++i) {
    System.out.println(setArray[rand.nextInt(set.size())]);
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-12-04T22:18:05.157

```
List asList = new ArrayList(mySet);
Collections.shuffle(asList);
return asList.get(0); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-12-08T06:53:11.080

这与接受的答案 (Khoth) 相同，但删除了不必要的变量`size`和`i`变量。

```
 int random = new Random().nextInt(myhashSet.size());
    for(Object obj : myhashSet) {
        if (random-- == 0) {
            return obj;
        }
    } 
```

尽管取消了上述两个变量，但上述解决方案仍然是随机的，因为我们依赖随机（从随机选择的索引开始）`0`在每次迭代中自行递减。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-23T03:51:32.583

Clojure 解决方案：

```
(defn pick-random [set] (let [sq (seq set)] (nth sq (rand-int (count sq))))) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T00:51:41.397

Perl 5

```
@hash_keys = (keys %hash);
$rand = int(rand(@hash_keys));
print $hash{$hash_keys[$rand]}; 
```

这是一种方法。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-07-20T13:45:31.713

C++。这应该相当快，因为​​它不需要遍历整个集合或对其进行排序。[假设它们支持tr1](http://en.wikipedia.org/wiki/C%2B%2B_Technical_Report_1)，这应该适用于大多数现代编译器。如果没有，您可能需要使用 Boost。

即使您不使用 Boost，Boost 文档也有助于解释这一点[。](http://www.boost.org/doc/libs/1_43_0/doc/html/unordered/buckets.html)

诀窍是利用数据已被划分为桶的事实，并快速识别随机选择的桶（以适当的概率）。

```
//#include <boost/unordered_set.hpp>  
//using namespace boost;
#include <tr1/unordered_set>
using namespace std::tr1;
#include <iostream>
#include <stdlib.h>
#include <assert.h>
using namespace std;

int main() {
  unordered_set<int> u;
  u.max_load_factor(40);
  for (int i=0; i<40; i++) {
    u.insert(i);
    cout << ' ' << i;
  }
  cout << endl;
  cout << "Number of buckets: " << u.bucket_count() << endl;

  for(size_t b=0; b<u.bucket_count(); b++)
    cout << "Bucket " << b << " has " << u.bucket_size(b) << " elements. " << endl;

  for(size_t i=0; i<20; i++) {
    size_t x = rand() % u.size();
    cout << "we'll quickly get the " << x << "th item in the unordered set. ";
    size_t b;
    for(b=0; b<u.bucket_count(); b++) {
      if(x < u.bucket_size(b)) {
        break;
      } else
        x -= u.bucket_size(b);
    }
    cout << "it'll be in the " << b << "th bucket at offset " << x << ". ";
    unordered_set<int>::const_local_iterator l = u.begin(b);
    while(x>0) {
      l++;
      assert(l!=u.end(b));
      x--;
    }
    cout << "random item is " << *l << ". ";
    cout << endl;
  }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-12-08T07:03:09.133

上面的解决方案是在延迟方面说话，但不保证每个索引被选中的概率相等。
如果需要考虑这一点，请尝试水库采样。[http://en.wikipedia.org/wiki/Reservoir_sampling](http://en.wikipedia.org/wiki/Reservoir_sampling)。
Collections.shuffle() （正如少数人所建议的那样）使用一种这样的算法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-24T00:15:45.023

既然你说“也欢迎其他语言的解决方案”，这里是 Python 的版本：

```
>>> import random
>>> random.choice([1,2,3,4,5,6])
3
>>> random.choice([1,2,3,4,5,6])
4 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-24T00:18:46.077

您不能只获取集合/数组的大小/长度，生成一个介于 0 和大小/长度之间的随机数，然后调用其索引与该数字匹配的元素吗？HashSet 有一个 .size() 方法，我很确定。

在伪代码中 -

```
function randFromSet(target){
 var targetLength:uint = target.length()
 var randomIndex:uint = random(0,targetLength);
 return target[randomIndex];
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-24T00:19:08.043

PHP，假设“set”是一个数组：

```
$foo = array("alpha", "bravo", "charlie");
$index = array_rand($foo);
$val = $foo[$index]; 
```

Mersenne Twister 函数更好，但 PHP 中没有与 array_rand 等效的 MT。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-24T00:35:18.223

Javascript解决方案；）

```
function choose (set) {
    return set[Math.floor(Math.random() * set.length)];
}

var set  = [1, 2, 3, 4], rand = choose (set); 
```

或者：

```
Array.prototype.choose = function () {
    return this[Math.floor(Math.random() * this.length)];
};

[1, 2, 3, 4].choose(); 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-24T01:46:43.247

[图标](http://en.wikipedia.org/wiki/Icon_(programming_language))有一个集合类型和一个随机元素运算符，一元“？”，所以表达式

```
? set( [1, 2, 3, 4, 5] ) 
```

将产生一个介于 1 和 5 之间的随机数。

随机种子在程序运行时被初始化为 0，因此每次运行时都会产生不同的结果，请使用`randomize()`

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-24T03:32:31.383

**在 C# 中**

```
 Random random = new Random((int)DateTime.Now.Ticks);

        OrderedDictionary od = new OrderedDictionary();

        od.Add("abc", 1);
        od.Add("def", 2);
        od.Add("ghi", 3);
        od.Add("jkl", 4);

        int randomIndex = random.Next(od.Count);

        Console.WriteLine(od[randomIndex]);

        // Can access via index or key value:
        Console.WriteLine(od[1]);
        Console.WriteLine(od["def"]); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-24T04:28:29.457

在口齿不清

```
(defun pick-random (set)
       (nth (random (length set)) set)) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-04-15T23:14:41.527

在数学中：

```
a = {1, 2, 3, 4, 5}

a[[ ⌈ Length[a] Random[] ⌉ ]] 
```

或者，在最近的版本中，只需：

```
RandomChoice[a] 
```

* * *

这收到了反对票，可能是因为它缺乏解释，所以这里是：

`Random[]`生成 0 到 1 之间的伪随机浮点数。乘以列表的长度，然后使用上限函数向上舍入到下一个整数。然后从 中提取该索引`a`。

由于哈希表功能经常使用 Mathematica 中的规则完成，并且规则存储在列表中，因此可以使用：

```
a = {"Badger" -> 5, "Bird" -> 1, "Fox" -> 3, "Frog" -> 2, "Wolf" -> 4}; 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-12-18T21:06:08.993

刚刚怎么样

```
public static <A> A getRandomElement(Collection<A> c, Random r) {
  return new ArrayList<A>(c).get(r.nextInt(c.size()));
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-12-22T14:05:55.163

为了好玩，我写了一个基于拒绝采样的 RandomHashSet。这有点 hacky，因为 HashMap 不允许我们直接访问它的表，但它应该可以正常工作。

它不使用任何额外的内存，并且查找时间是 O(1) 摊销的。（因为 java HashTable 很密集）。

```
class RandomHashSet<V> extends AbstractSet<V> {
    private Map<Object,V> map = new HashMap<>();
    public boolean add(V v) {
        return map.put(new WrapKey<V>(v),v) == null;
    }
    @Override
    public Iterator<V> iterator() {
        return new Iterator<V>() {
            RandKey key = new RandKey();
            @Override public boolean hasNext() {
                return true;
            }
            @Override public V next() {
                while (true) {
                    key.next();
                    V v = map.get(key);
                    if (v != null)
                        return v;
                }
            }
            @Override public void remove() {
                throw new NotImplementedException();
            }
        };
    }
    @Override
    public int size() {
        return map.size();
    }
    static class WrapKey<V> {
        private V v;
        WrapKey(V v) {
            this.v = v;
        }
        @Override public int hashCode() {
            return v.hashCode();
        }
        @Override public boolean equals(Object o) {
            if (o instanceof RandKey)
                return true;
            return v.equals(o);
        }
    }
    static class RandKey {
        private Random rand = new Random();
        int key = rand.nextInt();
        public void next() {
            key = rand.nextInt();
        }
        @Override public int hashCode() {
            return key;
        }
        @Override public boolean equals(Object o) {
            return true;
        }
    }
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-02-24T20:20:06.930

Java 8 最简单的方法是：

```
outbound.stream().skip(n % outbound.size()).findFirst().get() 
```

其中`n`是一个随机整数。当然它的性能不如`for(elem: Col)`

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-04-28T15:22:01.443

使用[番石榴](https://github.com/google/guava)，我们可以比 Khoth 的回答做得更好：

```
public static E random(Set<E> set) {
  int index = random.nextInt(set.size();
  if (set instanceof ImmutableSet) {
    // ImmutableSet.asList() is O(1), as is .get() on the returned list
    return set.asList().get(index);
  }
  return Iterables.get(set, index);
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2021-08-03T17:03:01.183

Java 8+ 流：

```
 static <E> Optional<E> getRandomElement(Collection<E> collection) {
        return collection
                .stream()
                .skip(ThreadLocalRandom.current()
                .nextInt(collection.size()))
                .findAny();
    } 
```

基于[Joshua Bone的](https://stackoverflow.com/users/9910647/joshua-bone)[回答](https://stackoverflow.com/a/51412979/2239025)，但略有变化：

*   忽略 Streams 元素顺序，以略微提高并行操作的性能
*   使用当前线程的 ThreadLocalRandom
*   接受任何 Collection 类型作为输入
*   返回提供的 Optional 而不是 null

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-24T00:28:40.873

PHP，使用 MT：

```
$items_array = array("alpha", "bravo", "charlie");
$last_pos = count($items_array) - 1;
$random_pos = mt_rand(0, $last_pos);
$random_item = $items_array[$random_pos]; 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-12-27T00:13:39.323

不幸的是，这在任何标准库集容器中都无法有效地完成（优于 O(n)）。

这很奇怪，因为很容易将随机选择函数添加到散列集和二进制集。在一个不稀疏的哈希集中，您可以尝试随机条目，直到获得成功。对于二叉树，您可以在左子树或右子树之间随机选择，最多 O(log2) 步。我已经实现了下面的演示：

```
import random

class Node:
    def __init__(self, object):
        self.object = object
        self.value = hash(object)
        self.size = 1
        self.a = self.b = None

class RandomSet:
    def __init__(self):
        self.top = None

    def add(self, object):
        """ Add any hashable object to the set.
            Notice: In this simple implementation you shouldn't add two
                    identical items. """
        new = Node(object)
        if not self.top: self.top = new
        else: self._recursiveAdd(self.top, new)
    def _recursiveAdd(self, top, new):
        top.size += 1
        if new.value < top.value:
            if not top.a: top.a = new
            else: self._recursiveAdd(top.a, new)
        else:
            if not top.b: top.b = new
            else: self._recursiveAdd(top.b, new)

    def pickRandom(self):
        """ Pick a random item in O(log2) time.
            Does a maximum of O(log2) calls to random as well. """
        return self._recursivePickRandom(self.top)
    def _recursivePickRandom(self, top):
        r = random.randrange(top.size)
        if r == 0: return top.object
        elif top.a and r <= top.a.size: return self._recursivePickRandom(top.a)
        return self._recursivePickRandom(top.b)

if __name__ == '__main__':
    s = RandomSet()
    for i in [5,3,7,1,4,6,9,2,8,0]:
        s.add(i)

    dists = [0]*10
    for i in xrange(10000):
        dists[s.pickRandom()] += 1
    print dists 
```

我得到 [995, 975, 971, 995, 1057, 1004, 966, 1052, 984, 1001] 作为输出，所以分布接缝很好。

我自己也为同样的问题苦苦挣扎，我还没有决定天气这个更有效的选择的性能提升是否值得使用基于 python 的集合的开销。我当然可以改进它并将其翻译成 C，但今天这对我来说工作量太大了 :)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-11-11T19:43:58.540

你也可以将集合转移到数组使用数组它可能会在小规模上工作我看到for循环中投票最多的答案是O（n）反正

```
Object[] arr = set.toArray();

int v = (int) arr[rnd.nextInt(arr.length)]; 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-02-04T15:50:10.963

如果您真的只想从 中选择“任何”对象`Set`，而不保证随机性，最简单的方法是获取迭代器返回的第一个对象。

```
 Set<Integer> s = ...
    Iterator<Integer> it = s.iterator();
    if(it.hasNext()){
        Integer i = it.next();
        // i is a "random" object from set
    } 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-03-27T10:52:44.437

使用 Khoth 的答案作为起点的通用解决方案。

```
/**
 * @param set a Set in which to look for a random element
 * @param <T> generic type of the Set elements
 * @return a random element in the Set or null if the set is empty
 */
public <T> T randomElement(Set<T> set) {
    int size = set.size();
    int item = random.nextInt(size);
    int i = 0;
    for (T obj : set) {
        if (i == item) {
            return obj;
        }
        i++;
    }
    return null;
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-08-07T23:05:33.803

如果您不介意第 3 方库，[Utils](https://github.com/RKumsher/utils)库有一个[IterableUtils](https://github.com/RKumsher/utils/blob/master/src/main/java/com/github/rkumsher/collection/IterableUtils.java)，它有一个 randomFrom(Iterable iterable) 方法，该方法将采用 Set 并从中返回一个随机元素

```
Set<Object> set = new HashSet<>();
set.add(...);
...
Object random = IterableUtils.randomFrom(set); 
```

它位于 Maven 中央存储库中：

```
<dependency>
  <groupId>com.github.rkumsher</groupId>
  <artifactId>utils</artifactId>
  <version>1.3</version>
</dependency> 
```

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2016-01-04T15:10:55.023

如果设置大小不大，则可以使用数组来完成。

```
int random;
HashSet someSet;
<Type>[] randData;
random = new Random(System.currentTimeMillis).nextInt(someSet.size());
randData = someSet.toArray();
<Type> sResult = randData[random]; 
```

* * *

## 回答 #34

> 赞同：-2
> 
> 时间：2011-03-02T02:06:33.087

读完这个帖子后，我能写的最好的是：

```
static Random random = new Random(System.currentTimeMillis());
public static <T> T randomChoice(T[] choices)
{
    int index = random.nextInt(choices.length);
    return choices[index];
} 
```

# c# - 如何从同一网络但不同域的计算机中找到可用的 ldap 服务器？

> ID：124674
> 
> 赞同：1
> 
> 时间：2008-09-24T00:12:46.887
> 
> 标签：c#, active-directory, ldap

我的公司有与活动目录/LDAP 集成的代码，用于集中用户名/密码登录。目前，配置页面只能显示链接到当前计算机所在的 Exchange 域的 LDAP 服务器。我想列出所有可用的 LDAP 服务器，类似于您在 Windows 资源管理器中查看“Microsoft Windows 网络”时的情况。截至目前，我无法通过 LDAP 或其他方式获取此信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T00:25:07.373

您可以尝试以下几件事：

1.  您可以在 DNS 中查找您所在域的 SRV 记录。这些看起来像 _protoname._transportname.domain.tld - 我怀疑这可能是您已经在做的事情。
2.  您可以尝试使用[RFC 2608](https://www.rfc-editor.org/rfc/rfc2608)中记录的[服务定位协议](http://en.wikipedia.org/wiki/Service_Location_Protocol)。
3.  可能有一些特定于 MS 的方法来查找我不知道的这些服务。
4.  您可以尝试暴力端口扫描。（形式不佳）

# asp.net - 您可以为标准 ASP.NET Web 表单验证器进行自定义客户端 javascript 验证吗？

> ID：124682
> 
> 赞同：18
> 
> 时间：2008-09-24T00:14:38.740
> 
> 标签：asp.net, jquery, webforms, validation

您可以为标准 ASP.NET Web 表单验证器进行自定义客户端 javascript 验证吗？

例如，使用 asp:RequiredFieldValidator 不理会服务器端代码，但使用 jQuery 实现您自己的客户端通知以突出显示字段或背景颜色。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-24T02:56:47.197

是的，我已经这样做了。我使用 Firebug 找出了 Dot.Net JS 函数，然后劫持了验证器函数

以下内容将应用于所有验证者，并且纯粹是客户端。我使用它来更改显示 ASP.Net 验证的方式，而不是实际执行验证的方式。它必须包含在 $(document).ready() 中，以确保它覆盖原始的 ASP.net 验证。

```
/**
 * Re-assigns a couple of the ASP.NET validation JS functions to
 * provide a more flexible approach
 */
function UpgradeASPNETValidation(){
    // Hi-jack the ASP.NET error display only if required
    if (typeof(Page_ClientValidate) != "undefined") {
        ValidatorUpdateDisplay = NicerValidatorUpdateDisplay;
        AspPage_ClientValidate = Page_ClientValidate;
        Page_ClientValidate = NicerPage_ClientValidate;
   }
}

/**
 * Extends the classic ASP.NET validation to add a class to the parent span when invalid
 */
function NicerValidatorUpdateDisplay(val){
    if (val.isvalid){
        // do custom removing
        $(val).fadeOut('slow');
    } else {
        // do custom show
        $(val).fadeIn('slow');
    }
}

/**
 * Extends classic ASP.NET validation to include parent element styling
 */
function NicerPage_ClientValidate(validationGroup){
    var valid = AspPage_ClientValidate(validationGroup);

    if (!valid){
        // do custom styling etc
        // I added a background colour to the parent object
        $(this).parent().addClass('invalidField');
    }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T03:04:30.780

标准的**CustomValidator**有一个**[ClientValidationFunction](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.customvalidator.clientvalidationfunction.aspx)**属性：

```
<asp:CustomValidator ControlToValidate="Text1" 
                     ClientValidationFunction="onValidate" />

<script type='text/javascript'>
function onValidate(validatorSpan, eventArgs)
 { eventArgs.IsValid = (eventArgs.Value.length > 0);
   if (!eventArgs.IsValid) highlight(validatorSpan);
 }
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T02:47:54.893

您可以做的是挂钩验证器并分配一个新的评估方法，如下所示：

```
 <script type="text/javascript">
        rfv.evaluationfunction = validator;

        function validator(sender, e) {
            alert('rawr');
        }
    </script> 
```

rfv 是我的必填字段验证器的 ID。您必须在页面底部执行此操作，以便在注册验证器的 javascript 后分配它。

使用 CustomFieldValidator 并分配其客户端验证属性要容易得多。

```
<asp:CustomValidator ControlToValidate="txtBox" ClientValidationFunction="onValidate" />

<script type='text/javascript'>
function onValidate(sender, e)
 { 
     alert('do validation');
 }
</script> 
```

[在此处](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.customvalidator.clientvalidationfunction.aspx)和[此处](http://msdn.microsoft.com/en-us/library/aa719700(VS.71).aspx)查看文档。

# java - 如何使用 getPathInfo() 映射 Servlet 以获取额外的路径信息

> ID：124685
> 
> 赞同：0
> 
> 时间：2008-09-24T00:15:09.190
> 
> 标签：java, tomcat, rest, servlets

我遇到了一个问题，Tomcat 将额外的路径信息视为 servlet 名称的一部分。这破坏了我们的 web 应用程序中的一堆 RESTFul 功能（我们使用额外的路径信息而不是 ?name=value 对来进行爬虫友好链接）。

它以前可以正常工作，但是在添加显式映射并删除`Invoker`我们以前用于为 servlet 提供服务的 servlet 后它就坏了。例如考虑以下链接：

> [http://mydomain.com/servlet/MyServlet/param1/param2/param3](http://mydomain.com/servlet/MyServlet/param1/param2/param3)

`MyServlet`曾经被正确调用，并且“/param1/param2/param3”`getPathInfo()`在`HttpServletRequest`.

现在，Tomcat 似乎正在尝试将 MyServlet/param1/param2/param3 作为 servlet 加载：

> [23/Sep/2008:16:44:23 -0700]“GET /servlet/MyServlet/param1/param2/param3 HTTP/1.0”404

这是它们在 web.xml 中定义和映射的方式，只需点击“ [http://mydomain.com/servlet/MyServlet](http://mydomain.com/servlet/MyServlet) ”即可。

```
<servlet>
  <servlet-name>MyServlet</servlet-name>
  <servlet-class>com.myclass.etcetera.MyServlet</servlet-class>
</servlet>

<servlet-mapping>
  <servlet-name>MyServlet</servlet-name>
  <url-pattern>/servlet/MyServlet</url-pattern>
</servlet-mapping> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T00:47:15.197

您需要将其映射到 /servlet/MyServlet/*

您缺少尾随的“/ *”。

# python - ConfigParser 使用的配置文件中 DEFAULT 部分的预期用途是什么？

> ID：124692
> 
> 赞同：38
> 
> 时间：2008-09-24T00:16:34.867
> 
> 标签：python, parsing, configuration-files

我已经使用 ConfigParser 很长一段时间来进行简单的配置。困扰我很久的一件事是 DEFAULT 部分。我不确定什么是合适的用途。我已经阅读了文档，但我真的很想看到一些关于它使用的巧妙示例以及它如何影响文件中的其他部分（真正说明了可能发生的事情的类型）。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-24T00:49:13.460

我通过谷歌搜索“windows ini”“默认部分”[在这里](http://www.enfoldsystems.com/software/proxy/docs/4.0/configuringmanually.html#the-default-section)找到了解释。摘要：您在 [DEFAULT] 部分中输入的任何内容都会传播到其他所有部分。使用链接网站中的示例，假设我有一个名为 test1.ini 的配置文件：

```
[host 1]
lh_server=192.168.0.1
vh_hosts = PloneSite1:8080
lh_root = PloneSite1

[host 2]
lh_server=192.168.0.1
vh_hosts = PloneSite2:8080
lh_root = PloneSite2 
```

我可以使用 ConfigParser 阅读此内容：

```
>>> cp = ConfigParser.ConfigParser()
>>> cp.read('test1.ini')
['test1.ini']
>>> cp.get('host 1', 'lh_server')
'192.168.0.1' 
```

但我注意到两个部分的 lh_server 是相同的；而且，事实上，我意识到对于我可能添加的大多数主机来说都是一样的。所以我可以这样做，如 test2.ini：

```
[DEFAULT]
lh_server=192.168.0.1

[host 1]
vh_root = PloneSite1
lh_root = PloneSite1

[host 2]
vh_root = PloneSite2
lh_root = PloneSite2 
```

尽管这些部分没有 lh_server 密钥，但我仍然可以访问它们：

```
>>> cp.read('test2.ini')
['test2.ini']
>>> cp.get('host 1', 'lh_server')
'192.168.0.1' 
```

阅读链接页面，了解更多使用 DEFAULT 部分中的变量替换以进一步简化 INI 文件的示例。

# web-services - Web 服务还是自定义协议？

> ID：124695
> 
> 赞同：3
> 
> 时间：2008-09-24T00:17:38.983
> 
> 标签：web-services, web-applications

我没有使用网络服务的经验。从历史上看，我曾使用专有通信协议（即使它们碰巧是 XML）构建客户端-服务器系统。我只花了几个小时查看 Axis2，它让我的脊椎不寒而栗。WS 的学习曲线让我害怕，看到所有的 XML 围绕着这么少的功能让我怀疑是否值得这么麻烦。

您如何决定是否需要使用 Web 服务或自定义通信协议？每种方法的优点/缺点是什么，它们最适合哪些用例？

**请发布明确的指导方针，而不是意见片:)**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T00:27:37.133

构建 RESTful Web API；那么您将获得很多使用其他方法（SOAP、XML-RPC 等）无法获得的自动缓存等好处

有关更多详细信息，请参阅[此帖子](https://stackoverflow.com/questions/106546/performance-of-soap-vs-xml-rpc-or-rest#106701)

另一个好处是，如果您构建一个 RESTful API 供您的代码使用，您可以潜在地让您的用户也利用它——他们经常对您的产品有您从未梦想过的用途。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T00:25:01.680

W3C 定义的“Web 服务”是指使用 SOAP over HTTP。在大多数情况下，SOAP 是严重的矫枉过正。仅当您向全世界提供公共服务时才真正合适（IMO），例如用于与您的网站交互的API。

其他任何东西（尤其是内部、私人通信）很少需要比 XML-RPC 更复杂的东西。只有当性能是一个问题时，您才应该考虑更精简的协议；XML-RPC 是如此简单且得到广泛支持，以至于开发和调试的便利性足以弥补使用臃肿的 XML 所带来的性能损失。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T00:27:33.153

请记住，有许多框架使 Web 服务编程变得非常琐碎。在 VB/C# 世界中，.Net 让它成为一种乐趣。我不太确定其他语言的特定框架，但我相信大多数至少有一个。

Web 服务的实现和重用的标准化和简单性使它们非常有吸引力。如前所述——是的，它们使通信变得非常冗长。如果您对此感到担心，为什么不计算一下您实际传输的数据量。很有可能，以当前的网络和互联网速度，这将是微不足道的——即使有 XML 开销。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T00:41:06.117

我总是将自定义数据格式作为最后的手段，而不是第一次使用。您使用哪种广泛使用的方法取决于您，但您不太可能在使用 Web 服务模型时出错。

可维护性和可扩展性是主要优点。使用广泛使用的技术，您的解决方案将更容易被其他人理解，而且您可以使用现成的库作为[消费者](http://extjs.com/deploy/dev/examples/grid/edit-grid.html)和[提供者](http://www.xfront.com/REST-Web-Services.html "这实际上是 REST 的抽象，但可以很好地快速介绍 Web 服务如何正常工作")。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T00:23:21.480

我最近打破了我的自定义协议习惯。我现在在服务器端使用 Apache，在客户端使用 libCurl 和 libxml2 来加载和解析用 C++ 编写的 XML。

服务器端可以是 PHP，也可以是用更严肃的语言编写的 CGI。取决于你想做什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T00:23:27.377

Web 服务的优点是有点标准，因此您从未听说过的程序可以使用您编写的 Web 服务。使用 HTTP 可以帮助他们通过代理和其他网络障碍进行通信，而无需您进行任何额外的工作。XML 虽然相当冗长和丑陋，但在调试时比二进制数据更容易阅读。

当您通过网络传输内容时，对 xml 的序列化/反序列化不太可能成为性能的限制因素。这可能会有点麻烦，尽管为您做这件事的图书馆会有很大帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T00:24:33.163

在我个人（老胡闹的家伙）看来，Web 服务只应用作向第三方（即其他公司、组织外的人等）提供您的一些内部信息的一种方式。当然，这*也是*XML 的初衷。:-)

如果您可以访问包含应用程序所需信息的数据库的直接连接 - 这就是要走的路。它更快更简单——这在应用程序开发中意味着“更好”和“更少错误”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T01:31:09.057

SOAP 和 XML —— “所有 XML 所包含的功能如此之少，让我怀疑它是否值得麻烦。”

完全。SOAP 是重量级的，并且——在很大程度上——解决了整个 Java 技术栈中对静态绑定的需求。

另一方面，REST 的重量要轻得多。此外，带有 JSON 的 REST 或带有 YAML 的 REST 非常轻量级，并且非常容易实现。它建立在现成的 HTTP 协议之上。

REST 要求您定义资源（通过 URI 命名）和基于规范 CRUD 规则（GET、POST、PUT 和 DELETE）的事务。非常简单和规范。

# c# - 查询以检索组节点的名称

> ID：124721
> 
> 赞同：2
> 
> 时间：2008-09-24T00:25:22.707
> 
> 标签：c#, .net, linq, linq-to-xml

如果我将诸如此类的一些 XML 加载到 XDocument 对象中：

```
<Root>
    <GroupA>
        <Item attrib1="aaa" attrib2="000" />
    </GroupA>
    <GroupB>
        <Item attrib1="bbb" attrib2="111" />
        <Item attrib1="ccc" attrib2="222" />
        <Item attrib1="ddd" attrib2="333" />
    </GroupB>
    <GroupC>
        <Item attrib1="eee" attrib2="444" />
        <Item attrib1="fff" attrib2="555" />
    </GroupC>
</Root> 
```

检索组节点名称的查询是什么样的？

例如，我想返回一个查询：

```
GroupA
GroupB
GroupC 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T00:35:05.040

像这样的东西：

```
XDocument doc; // populate somehow

// this will give the names as XName
var names = from child in doc.Root.Elements()
            select child.Name;

// if you want just the local (no-namespaces) name as a string, use this
var simpleNames = from child in doc.Root.Elements()
                  select child.Name.LocalName; 
```

# user-interface - 在 GUI 中打破事件循环

> ID：124722
> 
> 赞同：17
> 
> 时间：2008-09-24T00:25:42.473
> 
> 标签：user-interface, events

在编写 GUI 时，我经常遇到以下问题：假设您有一个模型和一个控制器。控制器有一个小部件`W`，用于显示`X`模型的属性。

因为模型可能会从控制器外部更改（可能有其他控制器使用相同的模型、撤消操作等），所以控制器会监听模型的更改。控制器还监听小部件上的事件`W`并相应地更新属性`X`。

现在，会发生以下情况：

1.  中的值`W`已更改
2.  生成事件，调用**控制器中的处理程序**
3.  **控制器**`X`在**模型**中设置新值
***   **模型**发出事件，因为它已被更改*   **控制器**从**模型**接收更改事件***   **控制器**获取的值`X`并将其设置在小部件中*   转到 1。****

 ****有几种可能的解决方案：

1.  修改控制器以在模型更新时设置一个标志，如果设置了此标志，则不对来自模型的任何事件做出反应。
2.  暂时断开控制器（或告诉模型一段时间不要发送任何事件）
3.  冻结小部件中的任何更新

过去，我通常选择选项 1，因为这是最简单的事情。它的缺点是用标志使你的类变得混乱，但其他方法也有它们的缺点。

只是为了记录，我在几个 GUI 工具包中遇到了这个问题，包括 GTK+、Qt 和 SWT，所以我认为它与工具包无关。

有什么最佳实践吗？还是我使用的架构完全错误？

`X`@Shy：这是某些情况下的解决方案，但是如果从控制器外部更改（例如，使用命令模式进行撤消/重做时），您仍然会得到一轮多余的事件，因为值已经改变，`W`被更新并触发一个事件。为了防止对模型进行另一次（无用的）更新，必须吞下小部件生成的事件。
在其他情况下，模型可能更复杂，简单检查究竟发生了什么变化可能不可行，例如复杂的树视图。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T00:29:55.100

处理此问题的标准 QT 方法以及他们非常有用的教程中建议的方法是，仅当新值与当前值不同时才更改控制器中的值。
这是信号具有语义的方式`valueChanged()`

[看这个教程](http://doc.trolltech.com/4.2/tutorial-t7.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T00:45:03.800

通常您应该响应小部件中的输入事件而不是更改事件。这可以防止发生这种类型的循环。

1.  用户更改小部件中的输入
2.  小部件发出更改事件（滚动完成/单击输入/鼠标离开等）
3.  控制器响应，转换为模型中的更改
4.  模型发出事件
5.  控制器响应，更改小部件中的值
6.  发出值更改事件，但控制器未监听

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T00:36:38.233

指示更新工作的标志。您可以将它们包装在 BeginUpdate 和 EndUpdate 等方法中。

# javascript - XMLHttpRequest Post 上的 send() 数据参数的最大长度

> ID：124742
> 
> 赞同：10
> 
> 时间：2008-09-24T00:31:25.220
> 
> 标签：javascript, ajax, xmlhttprequest

`XMLHttpRequest`您可以在主要浏览器实现的发送方法中使用的字符串数据长度是否有文档记录？

`XMLHttpRequest`当数据超过大约 3k 时，我遇到了一个 JavaScript Post 在 FireFox 3 中失败的问题。我假设 Post 的行为与传统的 Form Post 相同。

W3C 文档提到 send 方法的数据参数是 DOMString 但我不确定主要浏览器如何实现它。

这是我的 JavaScript 的简化版本，如果 bigText 超过 3k 则失败，否则它可以工作......

```
var xhReq = createXMLHttpRequest();

function createXMLHttpRequest() {
  try { return new ActiveXObject("Msxml2.XMLHTTP"); } catch (e) {}
  try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) {}
  try { return new XMLHttpRequest(); } catch(e) {}
  alert("XMLHttpRequest not supported");
  return null;
}

function mySubmit(id, bigText) {
  var url    = "SubmitPost.cfm";
  var params = "id=" + id + "&bigtext=" + encodeURI(bigText);

  xhReq.open("POST", url, true);

  //Send the header information along with the request
  xhReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhReq.setRequestHeader("Content-length", params.length);
  xhReq.setRequestHeader("Connection", "close");

  xhReq.onreadystatechange = onPostSubmit;
  xhReq.send(params);
}

function onPostSubmit() {

  if (xhReq.readyState==4 || xhReq.readyState=="complete")
     { 
     if (xhReq.status != 200)
        {
        alert('BadStatus');
        return;
        }
    } 
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T00:41:05.353

我相信最大长度不仅取决于浏览器，还取决于网络服务器。例如，Apache HTTP 服务器有一个[LimitRequestBody 指令](http://httpd.apache.org/docs/2.0/mod/core.html#limitrequestbody)，它允许从 0 字节到 2GB 的任何数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T00:44:47.577

根据[XMLRPC 规范](http://www.xmlrpc.com/spec)，唯一真正的限制是整数和双精度数的大小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T12:53:34.523

您没有指定它是如何失败的，但是您的编码不正确。您应该使用 encodeURIComponent 而不是 encodeURI。

默认情况下，客户端上请求实体主体的最大大小可能仅受可用内存的限制。正如已经指出的那样，服务器可能会拒绝超过一定大小的实体主体。例如，IIS 6 和 7 具有 200KB 的默认限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-27T20:46:01.073

Nginx 的配置必须在[client_max_body_size](http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size)完成，并且可以设置为任何值，例如 20m 用于 20MiB 或设置为 0 以禁用它。

```
vim /etc/nginx/nginx.conf 
```

保存并关闭文件，将更改应用到 nginx.conf，然后测试 -t 并发送信号 -s 以重新加载：

```
/usr/sbin/nginx -t
/usr/sbin/nginx -s reload 
```

语法：client_max_body_size 大小；

默认值：client_max_body_size 1m；

上下文：http、服务器、位置

设置客户端请求正文的最大允许大小，在“Content-Length”请求标头字段中指定。如果请求中的大小超过配置的值，则会向客户端返回 413（请求实体太大）错误。请注意，浏览器无法正确显示此错误。将 size 设置为 0 将禁用对客户端请求正文大小的检查。

# networking - 嗅探网络流量以寻找病毒/间谍软件的迹象

> ID：124745
> 
> 赞同：12
> 
> 时间：2008-09-24T00:33:51.500
> 
> 标签：networking, sysadmin, virus, sniffing, spyware

如何将系统连接到网络并嗅探与病毒/间谍软件相关的流量？我想插入网线，启动适当的工具并让它扫描数据以查找任何问题迹象。我不希望这能找到所有东西，这不是为了防止最初的感染，而是帮助确定是否有任何东西试图主动感染其他系统/导致网络问题。

除非流量非常明显，否则运行常规网络嗅探器并手动查看结果是不好的，但我无法找到任何工具来自动扫描网络数据流。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T00:37:08.810

我强烈建议在靠近网络核心的某台机器上运行[Snort](http://www.snort.org/)，并从核心网络路径的某处跨越（镜像）一个（或多个）端口到相关机器。

Snort 能够扫描它看到的网络流量，并在发现可疑情况时通过各种方法自动通知您。如果需要，甚至可以进一步采取措施，在发现某些东西时自动断开设备等。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-24T00:39:44.530

1.  使用[snort](http://www.snort.org/)：一个开源的网络入侵预防和检测系统。

2.  [Wireshark](http://www.wireshark.org/)，以前的 ethereal 是一个很棒的工具，但不会通知您或扫描病毒。Wireshark 是一个免费的数据包嗅探器和协议分析器。

3.  使用 netstat -b 命令查看哪些进程打开了哪些端口。

4.  使用[CPorts](http://www.nirsoft.net/utils/cports.html)查看端口列表和相关程序，并能够关闭这些端口。

5.  下载免费的防病毒程序，例如[免费的 AVG](http://free.avg.com/)。

6.  更紧密地设置防火墙。

7.  设置网关计算机以让所有网络流量通过。将上述建议改为网关计算机。您将检查整个网络，而不仅仅是一台计算机。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T00:36:49.077

您可以让[Snort](http://www.snort.org/)扫描流量以查找病毒。我认为这将是您的最佳解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T01:03:29.073

对于观看本地网络流量，您最好的选择（使用不错的交换机）是将您的交换机设置为将所有数据包路由到特定接口（以及它通常发送的任何接口）。这使您可以通过将流量转储到特定端口来监控整个网络。

但是，在 100 兆位网络上，您需要交换机上的千兆端口将其插入或过滤协议（例如，修剪 HTTP、FTP、打印、来自文件服务器的流量等）或交换机的缓冲区会立即填满，它会开始丢弃它需要的任何数据包（并且您的网络性能会下降）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T00:42:59.343

这种方法的问题在于，当今大多数网络都在交换机上，而不是集线器上。因此，如果您将带有数据包嗅探器的机器插入交换机，它将只能看到进出嗅探机的流量；和网络广播。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T00:48:13.057

作为[Ferruccio](https://stackoverflow.com/questions/124745/sniffing-network-traffic-for-signs-of-virusesspyware#124768)评论的后续行动，您将需要找到一些绕过开关的方法。

许多网络交换机可以选择设置端口镜像，以便所有流量（无论目的地如何）都将被复制或“镜像”到指定端口。如果您可以配置您的交换机来执行此操作，那么您将能够在此处连接您的网络嗅探器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T01:46:05.727

[Network Magic](http://www.networkmagic.com/)，如果您不介意非开源的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T04:41:24.670

您可以使用 IDS、硬件或软件 [http://en.wikipedia.org/wiki/Intrusion-detection_system](http://en.wikipedia.org/wiki/Intrusion-detection_system)

# javascript - javascript中是否需要互斥锁？

> ID：124764
> 
> 赞同：112
> 
> 时间：2008-09-24T00:40:43.030
> 
> 标签：javascript, multithreading, mutex

我看过这个链接：[在 JavaScript 中实现互斥](http://www.developer.com/lang/jscript/article.php/3592016)。另一方面，我读到 javascript 中没有线程，但这到底是什么意思？

当事件发生时，它们可以在代码中的什么位置中断？

如果JS中没有线程，我是否需要在JS中使用互斥锁？

具体来说，我想知道使用`setTimeout()`and调用`XmlHttpRequest`的函数`onreadystatechange`对全局可访问变量的影响。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-09-24T01:04:31.787

Javascript被定义为*可重入*语言，这意味着没有线程暴露给用户，实现中可能存在线程。诸如异步回调之类的函数`setTimeout()`需要等待脚本引擎休眠才能运行。

这意味着事件中发生的所有事情都必须在处理下一个事件之前完成。

话虽如此，如果您的代码在执行某些操作时期望值在触发异步事件和调用回调之间不发生变化，则您可能需要互斥锁。

例如，如果您有一个数据结构，您单击一个按钮并发送一个调用回调的 XmlHttpRequest 以破坏性方式更改数据结构，并且您有另一个按钮直接更改相同的数据结构，在事件发生之间触发并且当执行回调时，用户可能在回调之前单击并更新了数据结构，这可能会丢失值。

虽然您可以创建这样的竞争条件，但很容易在您的代码中防止这种情况发生，因为每个函数都是原子的。实际上，这将是大量工作并且需要一些奇怪的编码模式来创建竞争条件。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2011-02-22T14:21:08.007

这个问题的答案虽然在给出时是正确的，但有点过时了。如果查看不使用 webworkers 的客户端 javascript 应用程序，仍然是正确的。

关于 web-workers 的文章：
[使用 webworkers 的 javascript 中的多线程](http://xebee.xebia.in/2010/11/02/multithreading-in-javascript-with-web-workers/)
[Mozilla on webworkers](https://developer.mozilla.org/En/Using_web_workers)

这清楚地表明通过 web-workers 的 javascript 具有多线程功能。关于这个问题是javascript中需要互斥锁吗？我不确定这一点。但是这个stackoverflow帖子似乎相关：
[N Asynchronous Threads的互斥](https://stackoverflow.com/questions/3693550/mutual-exclusion-for-n-asynchronous-threads)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-07-20T09:53:40.520

正如@william 指出的那样，

> 如果您的代码在执行某些操作时期望值在触发异步事件和调用回调之间不发生变化，则您可能需要互斥锁。

这可以进一步概括 - 如果您的代码在异步请求解决之前需要对资源进行独占控制，那么您可能需要一个互斥锁。

一个简单的示例是您有一个按钮，该按钮触发 ajax 调用以在后端创建记录。您可能需要一些代码来保护您免于触发快乐的用户点击离开，从而创建多条记录。有很多方法可以解决这个问题（例如禁用按钮，在 ajax 成功时启用）。你也可以使用一个简单的锁：

```
var save_lock = false;
$('#save_button').click(function(){
    if(!save_lock){
        //lock
        save_lock=true;
        $.ajax({
            success:function()
                //unlock
                save_lock = false;  
            }
        });
    }
} 
```

我不确定这是否是最好的方法，我很想看看其他人如何处理 javascript 中的互斥，但据我所知，这是一个简单的互斥锁，而且很方便。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-02-08T17:35:31.217

是的，在访问选项卡/窗口之间共享的资源时，Javascript 中可能需要互斥锁，例如**localStorage**。

例如，如果用户打开了两个选项卡，如下所示的简单代码是不安全的：

```
function appendToList(item) {
    var list = localStorage["myKey"];
    if (list) {
        list += "," + item;
    }
    else {
        list = item;
    }
    localStorage["myKey"] = list;
} 
```

在 localStorage 项目“获取”和“设置”之间，另一个选项卡可能已经修改了该值。这通常不太可能，但可能 - 您需要自己判断与您的特定情况下的任何争用相关的可能性和风险。

有关更多详细信息，请参阅以下文章：

*   [等等，别碰那个：互斥锁和 JavaScript - Medium Engineering](https://medium.engineering/wait-dont-touch-that-a211832adc3a)
*   [JavaScript 并发和锁定 HTML5 localStorage - Benjamin Dumke-von der Eh，Stackoverflow](http://balpha.de/2012/03/javascript-concurrency-and-locking-the-html5-localstorage/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T00:55:41.947

JavaScript 是单线程的……虽然 Chrome 可能是一个新的野兽（我认为它也是单线程的，但是每个选项卡都有自己的 JavaScript 线程……我没有详细研究过，所以不要引用我的话那里）。

但是，您确实需要担心的一件事是您的 JavaScript 将如何处理以不同顺序返回的多个 ajax 请求。所以，你真正需要担心的是确保你的 ajax 调用以一种方式处理，如果结果返回的顺序与你发送它们的顺序不同，它们不会踩到对方的脚。

这也适用于超时......

当 JavaScript 发展多线程时，可能会担心互斥锁之类的......

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-28T05:47:00.070

JavaScript*语言*可以是多线程的，但 javascript 引擎的浏览器嵌入一次只运行一个回调（onload、onfocus、<script> 等）（大概是每个选项卡）。William 关于在注册和接收回调之间使用 Mutex 进行更改的建议不应因此而过于字面意思，因为您不希望阻止干预回调，因为将解锁它的回调将被阻止在当前回调后面！（哇，谈论线程的英语糟透了。）在这种情况下，如果设置了标志，您可能想要按照重新调度当前事件的方式做一些事情，无论是字面意思还是使用 setTimeout() 之类的方法。

如果您使用不同的 JS 嵌入，并且一次执行多个线程，它可能会有点冒险，但由于 JS 可以如此轻松地使用回调并锁定属性访问上的对象，显式锁定几乎没有必要. 但是，如果为使用多线程的通用代码（例如，游戏脚本）设计的嵌入也没有提供一些显式锁定原语，我会感到惊讶。

对不起文字墙！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-24T01:04:33.800

事件是有信号的，但 JavaScript 执行仍然是单线程的。

我的理解是，当发出事件信号时，引擎会停止当前正在执行的操作以运行事件处理程序。处理程序完成后，将恢复脚本执行。如果事件处理程序更改了一些共享变量，那么恢复的代码将看到这些更改“出乎意料”。

如果你想“保护”共享数据，简单的布尔标志就足够了。

# web-applications - 您使用什么来部署 Web 应用程序？

> ID：124780
> 
> 赞同：6
> 
> 时间：2008-09-24T00:47:48.957
> 
> 标签：web-applications, deployment, automation

我们正在寻求自动化我们的 Web 应用程序部署，特别是在从本地开发到远程服务器时。

我们当前的堆栈是远程的 LAMP，本地的 MAMP，但我很感兴趣的是，不管他们的环境如何，人们都在使用什么来完成这项任务？

我不仅仅是在谈论移动文件，我还意味着考虑其他任务，例如：

*   设置数据库模式
*   管理配置
*   部署所需的其他任务（创建日志文件等）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T00:55:52.977

在可能的情况下，**我更喜欢使用 Ant 等自动化部署**，甚至 FTP 部署也可以相当容易地处理。自动化部署，很像自动化构建，将猜测工作和错误排除在流程之外，并且根据定义，至少为新程序员理解流程提供了最少必要的文档（即构建脚本）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T01:51:29.147

以前的公司使用的东西之一是——信不信由你——RPM 文件。当我们构建我们的软件时，它的所有不同部分都将被打包成 RPM 文件，然后部署到服务器上。

1.  集群中的主服务器具有所有服务器及其角色的列表，用于确定每台服务器需要哪些包。
2.  部署阶段将检查每台服务器上的版本并确定哪些服务器需要升级。每台服务器都会获得它需要的任何新包的副本，
3.  每个服务器都将通过部署脚本安装其软件包，该脚本将管理安装前和安装后的检查和任务。
4.  部署脚本将触发一个单独的进程，即配置管理系统，以读取配置模板以生成服务器所需的任何服务的配置文件（基于其角色列表），并将这些服务发送给服务器
5.  部署系统将为每个系统生成一个需要采取的操作列表（要重新启动的服务），并将这些操作呈现给管理更新的操作员。然后，操作员将执行重新启动（如果更新发生在客户的计划维护窗口期间，或者我们有一个中午服务重新启动的工作订单），或者为夜间工作人员创建一张包含任务列表的工单做完了。

RPM 是一个可怕的 hack，但由于我们的客户都在运行 Red Hat Linux（根据我们的要求），它非常有意义。如果我有选择，我会选择像 Debian 或 Ubuntu 这样的系统，并设置一个系统都可以从中提取的存储库。尽管如此，它仍然适用于数百个客户端，总共有数千个服务器。挺整洁的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T00:55:03.167

当它需要上线时，我们使用“svn export”。将我们的代码保持在版本控制之下，并让我们在测试盒或本地计算机上积极开发它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T01:19:12.657

我还没有尝试过，但我正在考虑将来使用[Fabric ：](http://pypi.python.org/pypi/Fabric/)

> Fabric 是一个简单的 Pythonic 远程部署工具。
> 
> 它旨在将文件上传到并行或串行的多个服务器并在其上运行 shell 命令。这些命令在任务（常规 python 函数）中分组并在“fabfile”中指定。
> 
> 它有点像一个愚蠢的 Capistrano，除了它是用 Python 编写的，不要指望你要部署 Rails 应用程序，并且“put”命令可以工作。
> 
> 与 Capistrano 不同，Fabric 希望保持小巧、轻便、易于更改且不受任何特定框架的约束。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-22T11:07:59.473

[Capistrano](http://www.capify.org/)非常适合这种事情。它来自 Ruby on Rails 生态系统，最初与部署 Rails 应用程序密切相关。由于很多人注意到它对于远程服务器控制很方便，因此它变得更加通用。

无需额外设置，Capistrano：

*   使用 SSH 连接到应用服务器
*   将 Subversion 中的最新源代码签出到一个新的、过时的文件夹
*   通过更新一个或两个符号链接来激活新版本
*   重新加载应用程序服务器

所有这一切都具有回滚功能。

另一个不错的选择是使用操作系统的打包系统（RPM、deb/apt 等）。这往往需要对您的操作系统及其策略非常熟悉，但如果您知道自己在做什么，则非常适合其他工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T00:50:48.980

rsync->很棒的工具

但是，答案取决于您的环境。你用什么来控制源代码？你用什么构建系统？等等。

Web 服务器的部署只不过是一个“cp”命令，具体取决于更改了哪些文件。您需要构建一个流程来跟踪更改的文件，从源代码管理中提取这些文件，然后推送这些更改。在处理 PHP 文件时，如何知道要推送哪些文件？那就是问题所在。你解决它，你会没事的。cp 文件和“部署”它们的工具是简单的部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T00:56:19.420

我是 .NET 人，所以对我们来说是 CruiseControl + nant

不过，我听说过关于[Jet Brains TeamCity](http://www.jetbrains.com/teamcity/index.html)的好消息。

# winapi - GetPrivateProfileString 奇数

> ID：124786
> 
> 赞同：5
> 
> 时间：2008-09-24T00:49:16.237
> 
> 标签：winapi, unicode, encoding, ini

我只是在修补从 .NET 调用 kernel32 中的 GetPrivateProfileString 和 GetPrivateProfileSection 并遇到了一些我不明白的奇怪问题。

让我们从这个咒语开始：

```
 Private Declare Unicode Function GetPrivateProfileString Lib "kernel32" Alias "GetPrivateProfileStringW" ( _
    ByVal lpApplicationName As String, _
    ByVal lpKeyName As String, _
    ByVal lpDefault As String, _
    ByVal lpReturnedString() As Char, _
    ByVal nSize As Int32, _
    ByVal lpFileName As String) As Int32 
```

如果我传递一个 lpApplicationName（部分），没有 lpKeyName 和 lpDefault，我应该得到该部分的所有密钥，并且确实我这样做了：50% 的时间。

如果 ini 文件的 lpApplicationName 从第一行开始，则缓冲区不返回任何内容。如果 lpApplicationName stats 在文件的第二行，它会返回预期值。

起初我虽然在 Declare 中使用 W 版本和 Unicode，但更改这些似乎没有任何效果。

我错过了什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T01:00:17.757

检查您打开的文件是否有[字节顺序标记](http://en.wikipedia.org/wiki/Byte-order_mark)（几个字节标记文本编码的类型）。

这些 Windows API 调用似乎不理解字节顺序标记，并导致它们错过第一部分（因此，如果有空行，一切正常）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T01:06:43.840

好决定。在 VS.NET 中编辑 ini 文件当然是（Duh）添加一个 utf-8 BOM。嗯。在记事本中打开它并执行 SaveAs ASCII 会产生预期的结果。

如此明显。这么迟钝。又过了一个小时。:-)

谢谢！-=克里斯

# version-control - 顾问的源代码控制？

> ID：124809
> 
> 赞同：2
> 
> 时间：2008-09-24T00:56:46.703
> 
> 标签：version-control

任何人都可以推荐一个适用于大多数断开连接的顾问的良好源代码控制 (SCC) 吗？我更喜欢允许一个人保存到本地存储库中的东西，然后一旦将“同步”连接到服务器，但我从未见过这样的功能。建议？[首选与标准 IDE 集成 SCCI API 的 Windows 解决方案]。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T00:58:58.743

任何分布式版本控制服务都会这样做。查看[Mercurial](http://www.selenic.com/mercurial/)或[Git](http://git.or.cz/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T00:59:22.063

你可能想看看[git](http://en.wikipedia.org/wiki/Git_(software))。

它允许您在本地提交内容，然后重新同步回另一个副本。它非常分散，它[似乎可以在 Windows 中工作。](http://kylecordes.com/2008/03/22/git-windows-works/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T01:00:48.770

在这种情况下，Git 可能是一个不错的选择。

来自维基百科：“Git 为每个开发人员提供了整个开发历史的本地副本，并且更改从一个这样的存储库复制到另一个存储库。这些更改作为额外的开发分支导入，并且可以以与本地开发的分支相同的方式合并。”

[http://git.or.cz/](http://git.or.cz/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T01:04:54.780

假设您使用的是 Windows，我建议使用 TortoiseSVN 在客户端 ( [http://tortoisesvn.tigris.org/](http://tortoisesvn.tigris.org/) ) 将本地文件夹同步到服务器端基于 VisualSVN 服务器的存储库 ( [http:// www.visualsvn.com/](http://www.visualsvn.com/)）。

全部免费提供。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T00:59:58.647

如果您想要一个完整的本地存储库，**听起来您可能想查看[Mercurial](http://www.selenic.com/mercurial/wiki/)**。除了快速查看之外，我没有使用过它，但它看起来非常有趣且功能强大，并且据我所知，它提供了一个分布式源代码控制过程，该过程复制了存储库，允许断开连接的用户仍然可以访问他们没有的东西连接时不要“结帐”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T01:11:03.720

对于 Windows，使用 Mercurial 会更好。特别是如果您熟悉 Subversion。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T00:58:32.503

Git 可能是获得你想要的东西的壁橱里的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T00:59:51.003

Bazaar 支持这种[工作流程](http://bazaar-vcs.org/Workflows?highlight=(workflows)#head-8b6348176ddc592bc64a124bd917e88569615def)。它在 git 中也可以，但在 bzr 中更直观，恕我直言。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T00:59:54.717

抱歉不能解决您希望将其合并到多个存储库但 Windows 上的 SVN + TortoiseSVN 是一个很好的组合。如果您使用 VS，还有适用于 SVN 的 Visual Studio 插件。

如果您需要第三方 SVN 提供商，我使用[SVNRepository.com](http://www.svnrepository.com/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T01:02:28.953

您需要一个分布式源代码控制。

维基百科有一个很好的源代码控制[比较表](http://en.wikipedia.org/wiki/Comparison_of_revision_control_software)。我会说选择最适合您需求的分布式源代码控制。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T01:04:58.337

大多数系统（cvs、svn、git 等）都可以做到这一点。至于连接时会自动同步的应用程序；我不会推荐这个。最好是故意提交。根据您使用存储库的方式，自动签入可能会破坏存储库中的活动副本，或者传入尚未测试的代码。

在 Windows 中用于颠覆的一个不错的客户端是 TortoiseSVN。[http://tortoisesvn.net/](http://tortoisesvn.net/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-02T14:15:22.750

如果喜欢 GUI，请检查[plastic](http://www.plasticscm.com/xpproducts/xpcore/xpdistributed.aspx)。它既可以断开连接（实际上是分布式的，在您的笔记本电脑上使用您自己的服务器）也可以集中式工作

# .net - 无法从程序集错误中加载类型

> ID：124841
> 
> 赞同：145
> 
> 时间：2008-09-24T01:09:34.630
> 
> 标签：.net

在尝试学习 Castle Windsor 的 Fluent Interface 时，我编写了以下简单的测试：

```
using NUnit.Framework;
using Castle.Windsor;
using System.Collections;
using Castle.MicroKernel.Registration;

namespace WindsorSample {
    public class MyComponent : IMyComponent {
        public MyComponent(int start_at) {
            this.Value = start_at;
        }
        public int Value { get; private set; }
    } 
    public interface IMyComponent {
        int Value { get; }
    }

    [TestFixture]
    public class ConcreteImplFixture {
        [Test]
        public void ResolvingConcreteImplShouldInitialiseValue() {
            IWindsorContainer container = new WindsorContainer();
            container.Register(Component.For<IMyComponent>().ImplementedBy<MyComponent>().Parameters(Parameter.ForKey("start_at").Eq("1")));
            IMyComponent resolvedComp = container.Resolve<IMyComponent>();
            Assert.AreEqual(resolvedComp.Value, 1); 
        }
    }
} 
```

当我通过 TestDriven.NET 执行测试时，出现以下错误：

```
System.TypeLoadException : Could not load type 'Castle.MicroKernel.Registration.IRegistration' from assembly 'Castle.MicroKernel, Version=1.0.3.0, Culture=neutral, PublicKeyToken=407dd0808d44fbdc'.
at WindsorSample.ConcreteImplFixture.ResolvingConcreteImplShouldInitialiseValue() 
```

当我通过 NUnit GUI 执行测试时，我得到：

```
WindsorSample.ConcreteImplFixture.ResolvingConcreteImplShouldInitialiseValue:
System.IO.FileNotFoundException : Could not load file or assembly 'Castle.Windsor, Version=1.0.3.0, Culture=neutral, PublicKeyToken=407dd0808d44fbdc' or one of its dependencies. The system cannot find the file specified. 
```

如果我打开我在 Reflector 中引用的程序集，我可以看到它的信息是：

```
Castle.MicroKernel, Version=1.0.3.0, Culture=neutral, PublicKeyToken=407dd0808d44fbdc 
```

并且它肯定包含**Castle.MicroKernel.Registration.IRegistration**

会发生什么？

我应该提一下，虽然我从未使用过 nant，但二进制文件是从[Castle 的最新版本中](http://builds.castleproject.org/cruise/DownloadBuild.castle?number=956)获取的，所以我没有费心从源代码重新编译，只是将文件放在 bin 目录中。我还应该指出，我的项目编译没有问题。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-04-24T02:21:14.060

如果您有一个项目引用另一个项目（例如引用“类库”的“Windows 应用程序”类型）并且两者具有相同的程序集名称，您将收到此错误。您可以强命名引用的项目，或者（甚至更好）重命名引用项目的程序集（在 VS 中项目属性的“应用程序”选项卡下）。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2008-09-24T01:13:10.987

程序集是否在全局程序集缓存 (GAC) 或任何可能覆盖您认为正在加载的程序集的位置？这通常是加载了不正确的程序集的结果，对我来说，这意味着我通常在 GAC 中有一些东西会覆盖我在 bin/Debug 中的版本。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-03-28T03:17:49.783

上面没有提到我的解决方案，所以我想我会把我的答案添加到长尾......

我最终在 web.config 中对不再使用的类（an `HttpHandler`）进行了旧引用（并且不再是有效引用）。出于某种原因，在 Studio 中运行时它被忽略了（或者我的开发设置中仍然可以访问该类？）所以我只有在尝试部署到 IIS 时才收到此错误。我在 web.config 中搜索了程序集名称，删除了未使用的处理程序引用，然后这个错误消失了，一切正常。希望这对其他人有帮助。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2014-05-11T11:13:37.233

我有同样的问题，对我来说它与命名空间或项目命名无关。

但正如一些用户暗示的那样，它与仍在引用的旧程序集有关。

我建议删除所有项目的所有“bin”/binary 文件夹并重新构建整个解决方案。这清除了任何可能过时的程序集，之后 MEF 毫无问题地导出了我的所有插件。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-10-27T15:13:10.217

我收到了这个错误，我在 StackOverflow 或其他地方找不到任何解决它的方法，但是[bmoeskau](https://stackoverflow.com/a/2531775/3195477)对这个问题的回答为我指明了修复的正确方向，但尚未作为答案提及。我的答案与原始问题并不严格相关，但我将其发布在这里是假设遇到此问题的人会通过搜索谷歌或类似的东西找到这里（就像我一个月后一样，当这再次咬我时） , 啊！）。

我的程序集在 GAC 中，因此理论上只有一个版本的程序集可用。 **除了**IIS 有助于缓存旧版本并给我这个错误。我刚刚在 GAC 中更改、重建并重新安装了程序集。一种可能的解决方案是使用任务管理器杀死**w3wp.exe**。这迫使 IIS 从 GAC 重新读取程序集：问题已解决。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-03-04T21:09:04.187

在考虑类名后我遇到了这个问题：
`Could not load type 'Namspace.OldClassName' from assembly 'Assembly name...'.`

停止 IIS 并删除其中的内容`Temporary ASP.NET Files`为我修复了它。

根据您的项目（32/64 位、.net 版本等），正确的`Temporary ASP.NET Files`不同：

*   64 位
    `%systemroot%\Microsoft.NET\Framework64\{.netversion}\Temporary ASP.NET Files\`
*   32 位
    `%systemroot%\Microsoft.NET\Framework\{.netversion}\Temporary ASP.NET Files\`
*   在我的开发机器上它是（因为它的 IIS Express 可能？）
    `%temp%\Temporary ASP.NET Files`

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2014-12-06T21:04:53.977

如果这个错误是由更改命名空间引起的，请确保该项目的文件夹重命名为相同的名称，然后关闭 VS.NET 用记事本编辑有问题的项目并替换那里的节点

"根命名空间>New_Name_Of_Folder_Of_Your_Project_Namespace"根命名空间> "程序集名称>New_Name_Of_Folder_Of_Your_Project_Namespace"程序集名称>

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-04-21T13:05:20.187

当我遇到这样的问题时，我发现 FUSLOGVW 工具非常有用。它正在检查程序集绑定信息并为您记录。有时缺少库，有时 GAC 正在加载不同的版本。有时引用库的平台会导致问题。这个工具清楚地说明了依赖项的绑定是如何被解决的，这可能真的可以帮助你调查/调试你的问题。

Fusion Log Viewer / fuslogvw / Assembly Binding Log Viewer。在此处查看更多/下载：http: [//msdn.microsoft.com/en-us/library/e74a18c4.aspx](http://msdn.microsoft.com/en-us/library/e74a18c4.aspx)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-24T01:14:37.190

Version=1.0.3.0 表示 Castle RC3，但是流畅的界面是在 RC3 发布几个月后开发的。因此，您似乎遇到了版本控制问题。也许您在 GAC 中注册了 Castle RC3，它正在使用那个...

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-08T17:07:07.563

我偶尔会收到此消息，并且总是在 GAC 中进行程序集

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-04-21T12:58:48.013

删除我的 .pdb 文件为我解决了这个问题。我猜这与 dll 是使用 ILMerge 创建的这一事实有关。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-04-12T22:35:53.150

也许不太可能，但对我来说，这是由于我的应用程序试图加载具有相同程序集名称的库（xxx.exe 加载 xxx.dll）。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-05-23T13:51:47.863

当您在 GAC 中部署了一个版本的程序集但尚未使用您可能已在 IDE 的程序集中添加的新类进行更新时，通常会发生这种情况。因此，请确保 GAC 上的程序集已使用您可能在项目中所做的更改进行更新。

例如，如果您有一个 Common 类库，并且在该类库中您有 Common.ClassA 类型并将其部署到 GAC 强命名。您稍后会添加另一个名为 Common.ClassB 的类型，然后在 IDE 上运行您的代码，而无需首先使用新添加的 Common.ClassB 类型部署您对 Common 的 GAC 所做的更改。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-02-08T09:54:24.560

只是遇到另一个原因：

在发布模式下运行单元测试，但正在加载的库是尚未更新的调试模式版本

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-10-19T14:02:31.710

只是遇到另一个原因：

我使用的是用 ILRepack 创建的合并程序集。您从中查询类型的程序集必须是第一个传递给 ILRepack 的程序集，否则它的类型将不可用。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-01-06T16:46:02.863

另一个解决方案：相互指向并由 Visual Studio 缓存的旧 DLL

`C:\Users\[yourname]\AppData\Local\Microsoft\VisualStudio\10.0\ProjectAssemblies`

退出 VS，删除此文件夹中的所有内容，并且 Bob 是你的叔叔。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-02-18T11:41:17.090

我遇到过同样的问题。我刚刚通过 GAC 更新程序集解决了这个问题。

要在开发机器上使用 gacutil，请访问： `Start -> programs -> Microsoft Visual studio 2010 -> Visual Studio Tools -> Visual Studio Command Prompt (2010)`.

我使用这些命令分别卸载和重新安装。

```
gacutil /u myDLL

gacutil /i "C:\Program Files\Custom\mydllname.dll" 
```

注意：在我的情况下，我没有卸载我的 dll，我刚刚用当前路径更新了 dll。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2018-08-31T13:29:27.070

当我尝试在一个程序集中加载一个类型（通过反射）时，我遇到了这种情况，该程序集中是针对弹出此错误的应用程序通用的不同版本的引用构建的。

因为我确信在两个版本的程序集中类型都没有改变，所以我最终创建了一个自定义程序集解析器，它将丢失的程序集映射到我的应用程序已经加载的程序集。最简单的方法是向程序类添加一个静态构造函数，如下所示：

```
using System.Reflection
static Program()
{
    AppDomain.CurrentDomain.AssemblyResolve += (sender, e) => {
        AssemblyName requestedName = new AssemblyName(e.Name);

        if (requestedName.Name == "<AssemblyName>")
        {
            // Load assembly from startup path
            return Assembly.LoadFile($"{Application.StartupPath}\\<AssemblyName>.dll");
        }
        else
        {
            return null;
        }
    };
} 
```

这当然假设程序集位于应用程序的启动路径中并且可以很容易地进行调整。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-09-20T20:58:50.757

您可以通过 *.config 中的绑定重定向来解决此问题。[http://blogs.msdn.com/b/dougste/archive/2006/09/05/741329.aspx](http://blogs.msdn.com/b/dougste/archive/2006/09/05/741329.aspx)对在较新的框架中使用较旧的 .net 组件进行了很好的讨论。 [http://msdn.microsoft.com/en-us/library/eftw1fys(vs.71).aspx](http://msdn.microsoft.com/en-us/library/eftw1fys(vs.71).aspx)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-03-09T00:57:32.580

在桌面可执行项目中更新引用的 dll 后，我得到了同样的错误。问题是这里的人们提到了一个旧的参考并且很容易修复，但这里没有提到，所以我认为它可能会节省其他人的时间。

无论如何，我更新了 dll A 并从另一个引用的 dll 中得到了错误，我们在这里将其称为 B，其中 dll A 引用了 dll B。

更新 dll B 解决了这个问题。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-05-20T12:46:50.953

将您的 DLL 添加到 GAC（全局程序集缓存）

Visual Studio 命令提示符 => 以管理员身份运行

gacutil /i "dll 文件路径"

您可以看到添加的程序集 C:\Windows\system32\

它还将解决 SSIS 脚本任务中缺少 dll 或“无法加载文件或程序集”的问题

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-10-04T15:45:48.450

我在使用 MSTest 作为测试框架的 Visual Studio 2017 中遇到了类似的问题。在运行一些（不是全部）单元测试时，我收到了 System.TypeLoadException 异常，但这些单元测试在调试时会通过。我最终做了以下解决问题的方法：

1.  在解决方案中打开 Local.testsettings 文件
2.  转到“单元测试”设置
3.  取消选中“对测试目录中的程序集使用加载上下文”。复选框

采取这些步骤后，所有单元测试在运行时开始通过。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2018-10-23T21:17:28.903

在解决方案中删除程序集的签名后，我遇到了与上述相同的情况。这些项目不会建立。

我发现其中一个项目引用了 StrongNamer NuGet 包，它修改了构建过程并尝试对未签名的 Nuget 包进行签名。

删除 StrongNamer 包后，我能够再次构建项目而无需对程序集进行签名/强命名。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2020-08-06T18:53:39.490

如果这是一个 Windows 应用程序，请尝试在全局程序集缓存 (GAC) 中检查重复项。某些东西正在覆盖您的 bin / 调试版本。

如果这是一个网络应用程序，您可能需要在服务器上删除并重新上传。如果您要发布，您可能需要选中发布前删除所有现有文件复选框。根据 Visual Studio 版本，它应该位于 Publish > Settings > File Publish Options [![发布前删除所有现有文件](https://i.stack.imgur.com/xp0ya.png)](https://i.stack.imgur.com/xp0ya.png)

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-01-09T09:32:52.497

我想提一些额外的事情并做一个结论。

通常，正如其他人所解释的，当在运行时加载预期类型（在现有程序集中）出现问题时，会引发此异常。更具体地说，只要加载过时的程序集（并且不包含所需的类型）。或者当已经加载了不包含预期类型的​​具有不同版本或构建的程序集时。

另外，我必须提到它似乎很少，但可能是运行时限制或编译器错误（假设编译器没有否定某些东西，只是编译了有问题的代码），但运行时抛出`System.TypeLoadException`异常。是的; 这实际上发生在我身上！

**一个例子（女巫发生在我身上）**

考虑一个`struct`在自身内部定义其自己类型的可为空字段。定义这样的归档不可为空，会给您带来编译时错误并阻止您构建（显然这种行为有一个合乎逻辑的原因）。但是提交的可空结构呢？实际上，可空值类型`Nullable<T>`在后面。由于 c# 编译器没有阻止我以这种方式定义，我尝试了它并构建了项目。但是我得到了运行时异常`System.TypeLoadException: 'Could not load type 'SomeInfo' from assembly ... '`，并且在我的环境中加载我的代码部分似乎是问题（否则，我们可能会说：编译器至少没有真正执行编译过程）：

```
public struct SomeInfo
{
   public SomeInfo? Parent { get; } 

   public string info { get; }
} 
```

我的环境规格：

*   视觉工作室 2019 16.4.4
*   语言版本：c# 7.3
*   项目类型：netstandard 2.0.3 库
*   运行时：经典的 DotNetFramework 4.6.1

（我检查并确保编译的程序集是最新的并且实际上是新编译的。甚至，我扔掉了所有 bin 目录并刷新了整个项目。甚至我在一个新的解决方案中创建了一个新项目并进行了测试，但是这样的结构产生异常。）

这似乎是一个运行时限制（逻辑上或技术上）或错误或其他相同的问题，因为 Visual Studio 不会阻止我编译而且我的代码的其他更新部分（不包括这个结构）执行得很好。将 更改`struct`为 a `class`，编译后的程序集也包含并执行该类型。

我不知道详细解释为什么会在我的环境中发生这种行为，但是我遇到了这种情况。

**结论**

检查情况：

*   当 GAC 中已经存在覆盖所引用程序集的相同（可能较旧）程序集时。

*   当需要重新编译但没有自动执行（因此引用的程序集没有更新）并且需要手动执行构建或修复解决方案构建配置时。

*   当自定义工具或中间件或第三方可执行文件（例如测试运行工具或 IIS）从缓存的内容中加载该程序集的旧版本并且需要清理某些内容或导致重置某些内容时。

*   当未适当的配置导致自定义工具或中间件或加载程序集的第三方可执行文件要求不再存在的类型并且需要更新配置或清理某些内容时（例如`web.config`在 IIS 部署文件中删除 http 处理程序正如@Brian-Moeskau 所说）

*   当运行时执行已编译的程序集存在逻辑或技术问题时（例如，当编译器编译有问题的代码时，正在使用的运行时无法理解或执行它），正如我所面临的。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-03-18T06:05:57.997

通常找不到dll，或者dll存在，但是找不到新的类。

1.  如果dll不存在，直接更新dll

2.  如果有dll，把它拿下来，用ILSPY看看里面有没有报错的类。

如果没有，请重建 dll 并再次上传。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-05-12T14:01:52.583

我尝试了上述大部分方法，但没有一个对我有用。

这是我的问题。

我将 ac# 项目从本地计算机 (Windows 10) 移动到服务器 (Windows Server 2008 R2)。尝试从我的 UnitTest 项目运行测试时，我开始收到“无法加载程序集”错误。

这是我的解决方案。

我从作为单元测试项目 .NET 框架的解决方案中删除了测试项目。我还确保删除该项目。然后，我创建了一个新的 MSTest 测试项目 .NET Core 项目。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-07-22T23:00:22.497

尝试在解决方案中加载`Blazor`组件时出现此错误，该`.NET 5 C# MVC`解决方案将`Blazor`组件分解为解决方案中自己的项目：

[![在此处输入图像描述](https://i.stack.imgur.com/eyHOn.png)](https://i.stack.imgur.com/eyHOn.png)

我的 DTO 对象专门用于这些`Blazor`东西，并且没有对`AspNetCore.Mvc`东西的引用（因为它会中断`Blazor`）。

奇怪的是，当我尝试仅使用我需要的对象加载组件时，就像这样（在 中`MVC View`）：

```
<component type="typeof(My.Client.Components.MyComponent)" render-mode="WebAssemblyPrerendered"
       param-OpenYearMonth="Model.OpenYearMonth?.ToDTO()" /> 
```

我在浏览器控制台中收到与 OP 相同的错误。但是，由于某些奇怪的原因，只需添加一个额外的虚拟参数就可以正常加载：

```
<component type="typeof(My.Client.Components.MyComponent)" render-mode="WebAssemblyPrerendered"
       param-Whatever="new List<My.DTO.Models.Whatever>()"
       param-OpenYearMonth="Model.OpenYearMonth?.ToDTO()" /> 
```

我**认为**问题是在没有加载 DTO 程序集的情况下渲染组件？也许？这没有多大意义，当然看起来像是`MVC`or中的一个错误`Blazor`……但我想至少有一些解决方法。我还尝试做一些`Task.Delay`实验，认为 DTO 程序集可能仍在加载或其他什么，但这没有帮助。我还尝试在其中创建一个局部变量并将`View`该`Model.OpenYearMonth?.ToDTO()`局部变量传递给组件......再次没有帮助。当然，我也尝试了这篇文章答案中的所有解决方案，但都没有帮助。不要问这个问题浪费了多少小时......

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-10-07T10:11:14.623

有一个类似的 System.TypeLoadException：无法加载类型“引用的程序集”。**'不存在的类'扩展**。

我为引用的程序集添加了一个新的字符串扩展，将它与第二个程序集一起部署，该程序集也已更改（并使用了引用的程序集）到 Web 应用程序 bin 文件夹。

尽管 Web 应用程序使用了引用的程序集，但它没有使用新的扩展方法。我知道我通过不更改引用程序集的程序集版本（只是文件版本）来保持二进制兼容性，并假设它将由 Web 应用程序程序集加载。

看来，Web 应用程序程序集仍不会从其 bin 文件夹中加载所引用程序集的较新文件版本。

为了解决这个问题，我只是重新编译了 Web 应用程序程序集并重新部署了它。

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2015-04-03T09:01:04.047

我刚刚通过使用命令提示符运行 iisreset 命令解决了这个问题......当我遇到此类错误时，我总是做的第一件事。

# sql - 数据库行中的标志，最佳实践

> ID：124844
> 
> 赞同：37
> 
> 时间：2008-09-24T01:12:08.273
> 
> 标签：sql, database, flags

我是出于好奇而问这个的。基本上我的问题是，当你有一个数据库需要一个行条目来拥有像标志一样的东西时，最佳实践是什么？一个很好的例子是堆栈溢出的标记，或者 bugzilla 中的操作系统字段。可以为给定条目设置标志的任何子集。

通常，我做 c 和 c++ 工作，所以我的直觉反应是使用无符号整数字段作为一组可以翻转的位......但我知道这不是一个好的解决方案，原因有几个。其中最明显的是可扩展性，我可以拥有多少个标志会有一个硬性上限。

我还可以想到一些其他解决方案，它们可以更好地扩展，但会出现性能问题，因为它们需要多次选择才能获取所有信息。

那么，这样做的“正确”方法是什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-24T01:23:45.483

一般来说，我避免使用位掩码字段。它们将来很难阅读，并且需要对数据有更深入的了解才能理解。

之前已经提出了关系解决方案。鉴于您概述的示例，我将创建类似这样的内容（在 SQL Server 中）：

```
 CREATE TABLE Users (
  UserId INT IDENTITY(1, 1) PRIMARY KEY,
  FirstName VARCHAR(50),
  LastName VARCHAR(50),
  EmailAddress VARCHAR(255)
);

CREATE TABLE Badges (
  BadgeId INT IDENTITY(1, 1) PRIMARY KEY,
  [Name] VARCHAR(50),
  [Description] VARCHAR(255)
);

CREATE TABLE UserBadges (
  UserId INT REFERENCES Users(UserId),
  BadgeId INT REFERENCES Badges(BadgeId)
); 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-24T01:19:03.000

如果您确实需要从一组封闭的标志（例如 stackoverflow 徽章）中进行无限选择，那么“关系方式”将是创建一个标志表和一个将这些标志与您的目标实体相关联的单独表。因此，用户、标志和 usersToFlags。

但是，如果空间效率是一个严重的问题而查询能力不是，那么无符号掩码几乎也可以工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T01:19:17.413

在很多情况下，这取决于很多事情——比如你的数据库后端。例如，如果您使用的是 MySQL，那么[SET 数据类型](https://dev.mysql.com/doc/refman/8.0/en/set.html)正是您想要的。

基本上，它只是一个位掩码，每个位都分配了值。MySQL 最多支持 64 位值（意味着 64 种不同的切换）。如果你只需要 8 个，那么每行只需要一个字节，这是非常棒的节省。

如果您在一个字段中确实有超过 64 个值，那么您的字段可能会变得更加复杂。您可能想要扩展为 BLOB 数据类型，这只是 MySQL 没有固有理解的一组原始位。使用它，您可以创建任意数量的位字段，MySQL 很乐意将其视为二进制、十六进制或十进制值，但您需要。如果您需要超过 64 个选项，请根据您的应用程序创建尽可能多的字段。缺点是很难使该字段具有人类可读性。[BIT 数据类型](https://dev.mysql.com/doc/refman/8.0/en/bit-type.html)也限制为 64 。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T17:57:57.437

如果标志具有非常不同的含义并且直接在 SQL 查询或 VIEWS 中使用，那么使用多个类型的列**`BOOLEAN`**可能是一个好主意。

将每个标志放入一个额外的列中，因为无论如何您都将分别阅读和修改它们。如果你想对标志进行分组，只需给它们的列名一个公共前缀，即代替：

```
CREATE TABLE ... (
    warnings INTEGER,
    errors   INTEGER,
    ...
) 
```

你应该使用：

```
CREATE TABLE ... (
    warning_foo BOOLEAN,
    warning_bar BOOLEAN,
    warning_...
    error_foo   BOOLEAN,
    error_bar   BOOLEAN,
    error_...   BOOLEAN,
    ...
) 
```

虽然 MySQL 没有 BOOLEAN 类型，但您可以为此目的使用准标准 TINYINT(1)，并将其仅设置为 0 或 1。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-26T12:21:57.373

**一种非常相关的方法**

对于没有 set 类型的数据库，您可以打开一个新表来表示为其设置了每个标志的实体集。

例如，对于“Students”表，您可以有“RegisteredStudents”、“SickStudents”、TroublesomeStudents 等表。每个表只有一列：student_id。如果您只想知道哪些学生是“已注册”或“生病”，这实际上会非常快，并且在每个 DBMS 中的工作方式都相同。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T05:40:49.447

如果您的数据库支持，我建议使用 BOOLEAN 数据类型。

否则，最好的方法是使用 NUMBER(1) 或等效项，并在列上放置一个检查约束，将有效值限制为 (0,1)，如果需要，可能为 NULL。如果没有内置类型，则使用数字比使用字符列更容易产生歧义。（true 的值是多少？“T”或“Y”或“t”）

这样做的好处是您可以使用 SUM() 来计算 TRUE 行的数量。

```
SELECT COUNT(1), SUM(ActiveFlag)
FROM myusers; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T01:39:21.157

如果标志不止几个，或者将来可能会出现，我将使用单独的标志表和它们之间的多对多表。

如果有一些标志并且我永远不会在 WHERE 中使用它们，我将使用 SET() 或位域或其他任何东西。它们易于阅读且更紧凑，但查询起来很痛苦，有时甚至更令人头疼的是 ORM。

如果只有几个标志——而且永远只有几个标志——那么*我*将只创建几个 BIT/BOOLEAN/etc 列。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-01T00:28:42.923

当我考虑在数据库中存储位掩码标志（类似于 OP 最初使用整数）的最佳方法时，遇到了这个问题。

其他答案都是有效的解决方案，但我认为值得一提的是，如果您选择将位掩码直接存储在数据库中，您可能不必屈服于可怕的查询问题。

如果您正在开发使用位掩码的应用程序，并且您确实希望将它们作为一个整数或字节列存储在数据库中，那么请继续这样做。以后，您可以自己编写一个小实用程序，该实用程序将从您的主工作表中的位掩码生成另一个标志表（以您选择的任何行/列模式）。然后，您可以对该计算/派生表执行普通 SQL 查询。

这样，您的应用程序就可以方便地仅读取/写入位掩码字段/列。但是，如果以后有必要，您仍然可以使用 SQL 真正深入研究您的数据。

# opengl - 对于非游戏来说，OpenGL 仍然比 Direct3D 更好吗？

> ID：124851
> 
> 赞同：24
> 
> 时间：2008-09-24T01:15:50.777
> 
> 标签：opengl, directx, direct3d

标准模型是 OpenGL 用于专业应用程序 (CAD)，而 Direct3D 用于游戏。

随着 openGL 3.0 的崩溃，openGl 仍然是技术 3D 应用程序 (cad/GIS) 的自然选择吗？
是否有 Direct3D 的场景库？

（当然 Direct3D 只是 windows。）

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-05T00:27:35.970

D3D 让您支付微软的“战略税”。也就是说，D3D 服务于两个主人。一是为您提供功能和性能。二是保证对其他MS产品和Windows平台的普遍锁定。这对您有一些后果：

1.  D3D 应用程序只能在 Windows（包括 Xbox）上运行。也许你现在不认为这很重要。但是，如果您想在 Mac、Linux、PS3、未来的游戏机等平台上运行，您可能会很高兴您选择了独立于平台的选择。

2.  MS可以做出一些武断的决定。D3D 的下一个版本是否只能在需要新硬件、价格昂贵且很多人不想升级到的操作系统上运行？他们会做出一些你不同意的其他未来决定吗？

3.  从历史上看，OpenGL 一直引领 D3D 快速展示新的硬件功能。这是因为标准中有一种机制供供应商添加他们自己的扩展，并且这些扩展最终会被合并到主要规范中。D3D 是 MS 想要的任何东西，肯定有供应商的意见，但 MS 拥有否决权。您可能很容易陷入类似于 Vista 的情况，在这种情况下，MS 决定不向旧 DX 公开新的硬件功能，而只在 Vista 上提供新的 DX。这对于游戏开发者来说是一件相当头疼的事情。

现在，这就是为什么“专业应用程序”（CAD、动画、科学可视化、GIS 等）会青睐 OGL 的原因——像这样的应用程序想要稳定多年，需要持续维护和改进，并希望在许多平台上运行。这与游戏形成对比，游戏经常只在一个平台上发布，但通常不会“维护”（可能不会有 2.0，三年后另一个操作系统的更新，不需要支持旧硬件等）。游戏需要最大的性能，并且只需要在很短的时间窗口和固定数量的平台上运行。如果他们无论如何都需要以 Windows 为目标并且 D3D 速度更快，那可能是正确的选择，因为负面的 D3D 后果不会像 CAD 应用程序那样伤害他们，比如说。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-24T06:27:30.997

像往常一样，这取决于您的情况。

根据我的经验，目前（2008 年）Windows 上的 OpenGL 驱动程序质量比 Direct3D 驱动程序质量差得多**。**如果您的情况是您无法合理地要求您的客户始终拥有最新的驱动程序，或者告诉他们将显卡更换为具有更好 OpenGL 驱动程序的显卡，那么 OpenGL 是一个非常糟糕的选择。在这种情况下，我会选择 Windows 上的 D3D 渲染器和 OS X/Linux 上的 OpenGL 渲染器（如果你必须支持这些平台的话）。

拥有两个渲染器并不*难*。根据我的经验，解决驱动程序错误比编写和支持渲染代码路径需要更多时间*。*

当然，在某些（特定）情况下，D3D 不具备所需的功能，例如四缓冲同步锁相输出；或 Windows XP 上的几何着色器支持。

简而言之：如果您想在 Windows 上获得更好的驱动程序，请使用 D3D。如果您不太关心驱动程序的质量，或者需要 OpenGL 而不是 D3D 中的功能，那么请使用 OpenGL。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-02T03:17:55.587

也许您应该尝试一个抽象层，例如[OGRE](http://www.ogre3d.org/)，它可以让您在 DirectX 和 OpenGL 之间切换而无需重写任何东西？它还添加了很多功能，并且不是面向游戏的，但非常通用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-04T08:29:16.950

这并不能直接回答您的问题（抱歉），但我是从事 Direct3D 工作的原始人之一，呵呵：

> 是否有 Direct3D 的场景库？

Direct3D（nee Reality Lab）曾经只是一个场景图库:-)

遗憾的是不再提供 Direct3D 保留模式......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T01:19:45.213

Direct3D 仅在 Windows 和 XBox 上可用。如果您计划针对 Unix 或 Mac，除了 Windows，OpenGL 是一个不错的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-11-20T02:26:00.727

对我来说，作为一家大型 CAD 公司的图形程序员，目前有三件事保留了 OpenGL 的优势，转而支持 Direct3D (10/11) 用于现有的 CAD/DCC 应用程序：

1.  **遗产**。大多数 CAD 软件都或多或少地紧贴 OpenGL 概念。围绕 D3D 理念重写所有内容并不总是易于管理（从技术上讲，这取决于公司投入资源的能力/意愿）。

    其次，如果出现问题（功能方面和/或性能方面），它可能会产生负面影响，并且公司不会冒险因为 API 和架构切换而延迟主要版本。

2.  **人民**。那些老男孩行业的人相当保守。他们更愿意花费金钱/时间来处理 IHV 处理他们可能遇到的所有 OpenGL 驱动程序问题，或者根本不建议使用来自特定 IHV（例如 Intel 或 ATI）的图形。

    另外，我相信波音、空中客车、TMC、宝马等汽车/航空航天行业的客户并不关心只有 Quadros 的工作站。就软件许可价格而言，硬件仍然很便宜。

3.  **未来趋势**。随着 Llano、Larrabee、Fermi 等下一代处理器和随后的产品的出现，绝对值得投资研发预算来为这些未来硬件（在图形和非图形任务）。

    CAD 行业有巨大的周期，如果不是真正的颠覆性技术，它就不会移动。因此，对于大型 CAD 玩家来说，D3D 可能来得有点晚（当然 Autodesk 除外，这是一个特例）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-02T03:07:22.647

不是这样的答案，但有趣的是，最新版本的 AutoCAD 让您可以在“3dconfig”设置选项中选择使用 OpenGL 或 Direct3D 驱动程序。从根本上说，AutoCAD 是一个仅限 Windows 的应用程序，因此它们（最终）支持 Direct3D 是有意义的。有关详细信息，请参阅[AutoDesk 白皮书的](http://images.autodesk.com/adsk/files/autodesk_vista_wp.v5(lowres).pdf)第 15 页。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-01T05:35:00.740

每个人都想相信的答案是肯定的，但真正的答案是，这取决于。

大约 50% 的硬件无法将 OpenGL 运行到任何合理的水平。要查看此示例，请阅读使用 OpenGL 的 Google Sketchup 的常见问题解答

> SketchUp 的性能在很大程度上依赖于显卡驱动程序以及支持 OpenGL 1.5 或更高版本的能力。从历史上看，人们发现 ATI Radeon 卡和基于英特尔的 SketchUp 卡存在问题。我们目前不建议将这些显卡与 SketchUp 一起使用。( [Google Sketchup 的硬件和软件要求](http://sketchup.google.com/support/bin/answer.py?hl=en&answer=36208)

所以，如果您正在编写一个 CAD 应用程序并且您不介意告诉您的客户，“您必须有一个兼容 OpenGL 的视频卡”，那么答案是肯定的。

相反，如果您正在创建一个最终用户应用程序（例如 Google 地球），那么可悲的答案是，如果您想进入整个市场，就必须同时编写应用程序的 D3D 和 GL 版本。

# javascript - 如何使用 JavaScript 以编程方式选择元素？

> ID：124854
> 
> 赞同：7
> 
> 时间：2008-09-24T01:17:48.760
> 
> 标签：javascript, html, firefox, dom

我有`<img>`一个 HTML 文档，我想突出显示它，就好像用户使用鼠标突出显示它一样。有没有办法使用 JavaScript 做到这一点？

我只需要它在 Mozilla 中工作，但欢迎提供任何和所有信息。

*编辑：我想选择图像的原因实际上不是让它看起来突出显示，而是这样我就可以使用 XPCOM 将所选图像复制到剪贴板。所以实际上必须选择 img 才能工作。*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-24T01:42:34.067

这是一个选择页面上第一张图片的示例（如果您在 Firebug 的此页面上对其进行测试，它将是 Stack Overflow 徽标）：

```
var s = window.getSelection()
var r = document.createRange();
r.selectNode(document.images[0]);
s.addRange(r) 
```

相关文件：

*   [http://developer.mozilla.org/en/DOM/window.getSelection](http://developer.mozilla.org/en/DOM/window.getSelection)
*   [http://developer.mozilla.org/en/DOM/range.selectNode](http://developer.mozilla.org/en/DOM/range.selectNode)
*   [http://developer.mozilla.org/en/DOM/Selection/addRange](http://developer.mozilla.org/en/DOM/Selection/addRange)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-09T19:41:10.933

您可能还想在 s.addRange(r) 之前调用 s.removeAllRanges()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T01:42:51.540

你到底想做什么？如果您使用的是 XPCOM，那么您可能正在编写一个应用程序或一个扩展程序；你不能直接获取图像数据并把它放在剪贴板上吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T01:46:28.253

我个人选择元素的选择是 jquery：

然后要获得您选择的元素是：

$("img#YOURIMAGEHER​​E").focus();

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-24T01:21:42.243

您可以交换图像的来源，如 img.src = "otherimage.png";

实际上，我曾经这样做过，您可以做一些事情来预加载图像。

我什至在图像元素上设置了特殊属性，例如 swap-image="otherimage.png"，然后搜索具有它的任何元素，并设置处理程序以自动交换图像......你可以做一些有趣的事情。

* * *

对不起，我误解了这个问题！但无论如何，对于那些有兴趣做我正在谈论的事情的人，这里是我的意思的一个例子（粗略的实现，我建议使用像 jQuery 这样的框架来改进它，但只是为了让你继续前进）：

```
<html>
<body>
<script language="javascript">
function swap(name) {
  document.getElementById("image").src = name;
}
</script>
<img id="image" src="test1.png"
     onmouseover="javascript:swap('test0.png');"
     onmouseout="javascript:swap('test1.png');">
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-24T01:39:12.140

“highLight”解决方案的基本思想是好的，但是您可能想为img设置一个“静态”边框样式（在css中定义），其尺寸与highLight方法中指定的尺寸相同，所以它不会导致调整大小。

另外，我相信如果你将调用改为“highLight(this)”，函数def改为“highLight(obj)”，那么你可以跳过“document.getElementById()”调用（以及“img”的“id”属性），只要你改用“obj.style.border”。

您可能还需要正确拼写“highLight”。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-24T01:30:42.550

给 img 标签一个 ID。使用 document.getElementById('id')。

```
<script type="text/javascript" language="javascript">
function highLight()
{
  var img = document.getElementById('myImage');
  img.style.border = "inset 2px black";
}
</script>
<img src="whatever.gif" id="myImage" onclick="hightLight()" /> 
```

编辑:: 你可以尝试 .focus 给它焦点。

# c++ - 如何防止通过“新”运算符分配类？（我想确保我的 RAII 类始终分配在堆栈上。）

> ID：124856
> 
> 赞同：49
> 
> 时间：2008-09-24T01:18:46.463
> 
> 标签：c++, operator-overloading, c++-faq

我想确保我的 RAII 类始终分配在堆栈上。

如何防止通过“新”运算符分配类？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-24T01:18:59.350

您需要做的就是将类的新运算符声明为私有：

```
class X
{
    private: 
      // Prevent heap allocation
      void * operator new   (size_t);
      void * operator new[] (size_t);
      void   operator delete   (void *);
      void   operator delete[] (void*);

    // ...
    // The rest of the implementation for X
    // ...
}; 
```

将“operator new”设为私有可以有效地防止类外的代码使用“new”来创建 X 的实例。

要完成这些操作，您应该隐藏“运算符删除”和两个运算符的数组版本。

从 C++11 开始，您还可以显式删除函数：

```
class X
{
// public, protected, private ... does not matter
    static void *operator new     (size_t) = delete;
    static void *operator new[]   (size_t) = delete;
    static void  operator delete  (void*)  = delete;
    static void  operator delete[](void*)  = delete;
}; 
```

**相关问题：** [是否可以防止对象的堆栈分配并只允许使用“新”来启动它？](https://stackoverflow.com/questions/124880/is-it-possible-to-prevent-stack-allocation-of-an-object-and-only-allow-it-to-be)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T02:27:10.340

我不相信你的动机。

在免费商店创建 RAII 课程有充分的理由。

例如，我有一个 RAII 锁类。我有一条通过代码的路径，其中只有在某些条件成立时才需要锁定（它是一个视频播放器，如果我已经加载并播放了视频，我只需要在渲染循环期间保持锁定；如果没有加载，我不需要它）。因此，在免费存储上创建锁（使用`unique_ptr`）的能力非常有用；它允许我使用相同的代码路径，无论我是否必须取出锁。

即是这样的：

```
unique_ptr<lock> l;
if(needs_lock)
{
    l.reset(new lock(mtx));
}
render(); 
```

如果我只能在堆栈上创建锁，我就做不到......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T05:45:04.810

**@DrPizza：**

你有一个有趣的观点。请注意，在某些情况下，RAII 习语不一定是可选的。

无论如何，解决您的困境的更好方法可能是向您的锁构造函数添加一个参数，指示是否需要锁。例如：

```
class optional_lock
{
    mutex& m;
    bool dolock;

public:
    optional_lock(mutex& m_, bool dolock_)
        : m(m_)
        , dolock(dolock_)
    {
        if (dolock) m.lock();
    }
    ~optional_lock()
    {
        if (dolock) m.unlock();
    }
}; 
```

然后你可以写：

```
optional_lock l(mtx, needs_lock);
render(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T11:28:53.003

在我的特殊情况下，如果不需要锁，则互斥锁甚至都不存在，所以我认为这种方法更难适应。

我想我真正难以理解的是禁止在免费商店中创建这些对象的理由。

# asp.net - ASP.Net 中动态内容的选项

> ID：124863
> 
> 赞同：1
> 
> 时间：2008-09-24T01:19:35.697
> 
> 标签：asp.net, ajax, iframe, user-controls

在 ASP.Net 网站中创建有状态的动态内容有哪些选择？

这是我的场景。我有一个具有多个嵌套内容区域的站点。顶层是与功能区域`Catalog`、`Subscriptions`、相关联的操作`Settings`。

当您单击功能操作时，我想动态添加特定于该操作的内容。例如，当单击目录时，我想显示包含目录文件夹和文件的树，以及右侧的区域以获取详细信息。

当用户单击树时，我希望在详细信息区域中加载上下文相关的详细信息（例如管理文件的属性或选项）。

* * *

我从`UserControls`. 只要我不断将所有内容加载到页面中，它们就可以正常工作，并且永远不要让任何内容消失。一个消失后，`ViewState`页面就炸了，因为视图状态树无效。

（我不想继续将内容加载到我的页面中，因为我不希望响应太大）

因此，我的下一个方法是将动态区域替换为`IFrames`. 然后我不会实例化 a `UserControl`，而是更改我的`IFrame`. 由于内容`IFrames`是独立的页面，我没有遇到任何`ViewState`问题。

但是，我担心这`IFrames`可能是一个糟糕的设计选择，但不完全理解为什么。该网站是不公开的，所以搜索引擎不是问题。

* * *

所以，最后回答我的问题。

对于这种情况，我有哪些选择？如果我选择 Ajax 解决方案 (jQuery)，我是否必须维护自己的 ViewState？还有其他我应该考虑的因素吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T02:06:10.140

动态添加的控件不会保留在视图状态中，这就是使用 AJAX 或 iframe 或其他任何东西都无关紧要的原因。

一种可能的解决方法是在回发时重新填充控件。这个问题是页面生命周期（简化）是：

1.  初始化
    *   加载视图状态
    *   加载回发数据
    *   呼叫控制加载事件
    *   调用加载事件
    *   呼叫控制事件
    *   控制预渲染
    *   预渲染
    *   保存视图状态
    *   卸下

这意味着重新添加动态控件的唯一地方是初始化——否则发布的数据（或视图状态信息）不会加载到该控件中。但通常，由于在 Initialize 中还没有 Viewstat/postback 数据，您的代码没有确定需要添加哪些控件所需的信息。

在这种情况下，我发现的唯一其他解决方法是使用名为[DynamicControlsPlaceholder](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)的第 3 方控件。这工作得很好，并将控制信息保留在视图状态中。

* * *

在您的特定情况下，似乎没有那么多选择/案例。将所有不同的控件集放在页面中是否可行，并将它们放在 asp:placeholder 控件中，然后根据选择的内容将其中一个设置为可见？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T01:30:24.347

您有许多不同的选择，是的，IFrame 是一个糟糕的设计选择。

第一个选项是 AJAX 解决方案。这样就没有真正的视图状态场景，只是你在网络服务器来回传递数据，根据需要动态构建 UI。

下一个选项是每次动态添加给定帖子所需的控件。这样做的方式是，在页面生命周期的开始，您需要完全按照上次发送的方式重建页面，然后转储所有不需要的控件，只构建那些需要的控件.

第三种选择是使用母版页。您的顶级内容可能位于母版页本身，并具有指向网站内各个页面的链接。

我肯定给了足够的时间，我可以想出更多，但这三个只是从阅读你的问题中出现的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T03:01:59.133

其他一些选项：

1.  内容*似乎*只是动态的。您在页面上加载了足够的控件来处理任何事情，并且只实际*显示*您需要的内容。这样可以省去很多混乱视图状态等的麻烦，但这意味着您的页面占用的空间更大。
2.  动态地将控件添加到页面。你已经在玩这个了，所以你已经看到了这里的一些问题。请记住，为回发创建动态控件的位置是在 Page_Init() 事件中，如果您希望它们是有状态的，则需要将该状态保留在某个地方。我推荐一个数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T04:37:13.773

如上所述，动态控件和视图状态不能很好地混合在一起——但这是一件好事，因为即使他们这样做了，复杂动态页面的视图状态也会变得如此臃肿，以至于性能会降低到零

使用 Ajax [我喜欢 AJAX PRO，因为它使用起来非常简单] 并自己管理页面状态 [在会话、数据库表或任何适合您的场景中]。这将有点复杂，但结果将是高效和响应的：每个页面只能更新需要更改的内容，并且您不会一直来回吹动巨大的视图状态字符串

# xml - XML Schema (XSD) 验证工具？

> ID：124865
> 
> 赞同：271
> 
> 时间：2008-09-24T01:19:54.137
> 
> 标签：xml, validation, xsd, schema

在办公室，我们目前正在编写一个应用程序，它将根据给定的模式生成 XML 文件。我们在 .XSD 文件中有架构。

是否有可用于自动化测试的工具或库来检查生成的 XML 是否与架构匹配？

我们更喜欢适合商业用途的免费工具，尽管我们不会捆绑模式检查器，因此它只需要开发人员在开发过程中使用。

如果这有什么不同的话，我们的开发语言是 C++，尽管我认为它不应该，因为我们可以生成 xml 文件，然后通过在测试中调用单独的程序进行验证。

* * *

## 回答 #1

> 赞同：248
> 
> 时间：2008-09-24T19:41:21.853

经过一番研究，我认为最好的答案是[Xerces](http://xerces.apache.org/)，因为它实现了所有 XSD，是跨平台的并且被广泛使用。我[在 github 上创建了一个小型 Java 项目，](https://github.com/amouat/xsd-validator)以使用默认的 JRE 解析器（通常是 Xerces）从命令行进行验证。这可以在 Windows/Mac/Linux 上使用。

如果您更愿意使用它，还可以使用Xerces的[C++ 版本。](https://xerces.apache.org/xerces-c/)StdInParse[实用程序](http://xerces.apache.org/xerces-c/stdinparse-3.html)可用于从命令行调用它。此外，下面的评论者指出了这个[更完整的包装实用程序](http://jmvanel.free.fr/xsd/)。

您还可以使用 xmllint，它是[libxml](http://xmlsoft.org/)的一部分。您可能已经安装了它。示例用法：

```
xmllint --noout --schema XSD_FILE XML_FILE 
```

一个问题是 libxml 没有实现所有规范，所以你可能会遇到问题:(

或者，如果您在 Windows 上，则可以使用[msxml](http://msdn.microsoft.com/en-us/library/ms763742.aspx)，但您需要某种包装器来调用它，例如此[DDJ 文章](http://www.ddj.com/architect/184416391)中描述的 GUI 。但是，Windows 上的大多数人似乎都使用 XML 编辑器，例如 Notepad++（如[Nate 的回答](https://stackoverflow.com/a/1088659/4332)中所述）或[SteveC 建议的](https://stackoverflow.com/a/3915105/4332)[XML Notepad 2007](http://www.microsoft.com/en-us/download/details.aspx?id=7973) （还有几个商业编辑器，我不会在这里提及）。

最后，不幸的是，您会发现不同的程序会给出不同的结果。这主要是由于 XSD 规范的复杂性。您可能希望使用多种工具来测试您的架构。

**更新**：我在一篇[博文](http://www.adrianmouat.com/bit-bucket/2013/11/xml-schema-validation/)中对此进行了扩展。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2009-07-06T18:52:47.600

[Notepad++](http://notepad-plus.sourceforge.net)有一个名为[XML Tools](http://docs.notepad-plus-plus.org/index.php?title=Plugin_Central#X)的插件，它提供针对 XSD 的 XML 验证和验证。

[您可以在此处](http://when-others-then-null.blogspot.co.uk/2012/12/Validate-XML-against-an-XSD-using-npp.html)查看如何使用它。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-24T01:49:01.710

[xmlstarlet](http://xmlstar.sourceforge.net)是一个命令行工具，它将执行此操作以及更多操作：

```
$ xmlstarlet val --帮助
XMLStarlet 工具包：验证 XML 文档
用法：xmlstarlet val <options> [ <xml-file-or-uri> ... ]
<选项>
  -w 或 --well-formed - 仅验证格式正确（默认）
  -d 或 --dtd <dtd-file> - 根据 DTD 验证
  -s 或 --xsd <xsd-file> - 验证 XSD 架构
  -E 或 --embed - 使用嵌入式 DTD 进行验证
  -r 或 --relaxng <rng-file> - 验证 Relax-NG 模式
  -e 或 --err - 在 stderr 上打印详细的错误消息
  -b 或 --list-bad - 仅列出不验证的文件
  -g 或 --list-good - 仅列出验证的文件
  -q 或 --quiet - 不列出文件（仅返回结果代码）

注意：由于 XML 模式不完整，因此尚未完全支持
      libxml2 中的支持（参见 http://xmlsoft.org）

XMLStarlet 是一个用于查询/编辑/检查/转换的命令行工具包
XML 文档（更多信息参见 http://xmlstar.sourceforge.net/）

```

在您的情况下，用法如下：

```
xmlstarlet val --xsd your_schema.xsd your_file.xml 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-10-12T13:19:29.750

对于 Windows，有免费的[XML Notepad 2007](http://www.microsoft.com/downloads/en/details.aspx?familyid=72d6aa49-787d-4118-ba5f-4f30fe913628&displaylang=en)。您可以选择 XSD 对其进行验证

更新：更好的是，使用带有 XML 工具插件的 Notepad++

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-02T12:49:09.270

DecisionSoft的在线[XML Schema Validator](http://tools.decisionsoft.com/schemaValidate/)允许您根据给定的模式检查 XML 文件。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T01:44:17.993

我使用 Xerces：

[http://xerces.apache.org/xerces-c/](http://xerces.apache.org/xerces-c/)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-09T08:25:37.510

[在http://www.xml-buddy.com](http://www.xml-buddy.com/ValidatorBuddy.htm)上提供了一个用于快速简单地验证 XML 的 XML 编辑器

您只需要运行安装程序，然后您就可以使用易于使用的桌面应用程序或命令行来验证您的 XML 文件。此外，您还可以获得对 Schematron 和 RelaxNG 的支持。还支持批量验证...

2012 年 1 月 13 日更新：命令行工具可免费使用，并使用 Xerces 作为 XML 解析器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-11-23T16:45:21.880

我只是在学习模式。我正在使用 RELAX NG 并使用 xmllint 进行验证。我对来自 xmlllint 的错误感到沮丧。我希望他们能提供更多信息。

如果 XML 中有错误的属性，则 xmllint 会告诉您不受支持的属性的名称。但是，如果您在 XML 中缺少某个属性，您只会收到一条消息，指出无法验证该元素。

我正在使用非常复杂的规则处理一些非常复杂的 XML，而且我是新手，因此跟踪缺少哪个属性需要很长时间。

更新：我刚刚找到了一个我非常喜欢的 java 工具。它可以像 xmllint 一样从命令行运行，并且支持 RELAX NG：[https ://msv.dev.java.net/](https://msv.dev.java.net/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-28T11:31:53.617

我发现这个来自“corefiling”的在线验证器非常有用 -
[http://www.corefiling.com/opensource/schemaValidate.html](http://www.corefiling.com/opensource/schemaValidate.html)

在尝试了一些工具来验证我的 xsd 之后，这是给我详细错误信息的工具 - 所以我能够修复架构中的错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-05T19:33:56.763

[http://www.xmlvalidation.com/](http://www.xmlvalidation.com/)

（请务必选中“针对外部 XML 模式进行验证”框）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-10-08T10:43:37.857

一种从 XML 验证和生成 XSD 的出色可视化工具是 IntelliJ IDEA，直观且简单。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-10-10T21:44:40.417

您可以将 XML 架构连接到 Microsoft Visual Studio 的 Intellisense。此选项为您提供实时验证和自动完成功能，这真是太棒了。

我在我的免费 Microsoft Visual C++ 2010 Express 副本上运行了这个确切的场景。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-05-22T18:53:33.610

我倾向于使用 Microsoft 的 xsd 来帮助从 .NET 文件生成 xsd。我还使用 xmlstarlet 解析出部分 xml。最后一个对您有用的免费工具是 altovaxml，可从以下 URL 获得：[http](http://www.altova.com/download_components.html) ://www.altova.com/download_components.html 。

这使我可以扫描所有 xml 文件，通过解析 xml 来选择要使用的 xsd。

```
# Function:
#    verifyschemas - Will validate all xml files in a configuration directory against the schemas in the passed in directory
# Parameters:
#    The directory where the schema *.xsd files are located.  Must be using dos pathing like: VerifySchemas "c:\\XMLSchemas\\"
# Requirements:
#    Must be in the directory where the configuration files are located
#
verifyschemas()
{
    for FILENAME in $(find . -name '*.xml' -print0 | xargs -0)
    do
        local SchemaFile=$1$(getconfignamefromxml $FILENAME).xsd
        altovaxml /validate $FILENAME /schema $SchemaFile > ~/temp.txt 2> /dev/null
        if [ $? -ne 0 ]; then
            printf "Failed to verify: "
            cat ~/temp.txt | tail -1 | tr -d '\r'
            printf "    - $FILENAME with $SchemaFile\n"
        fi
    done
} 
```

要生成 xml，我使用： xsd DOTNET.dll /type:CFGCLASS & rename schema0.xsd CFGCLASS.xsd

要获取我使用的 xsd 名称： xmlstarlet sel -t -m /XXX/* -v local-name() $1 | sed 's/$//'

这允许我使用 xml 文件中的元素标记来获取正确的 XSD。

最终结果是我可以调用 bash 函数来扫描所有 XML 文件并验证它们。即使它们位于多个子目录中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-07-22T06:13:46.413

另一个在线 XML Schema (XSD) 验证器：[http](http://www.utilities-online.info/xsdvalidation/) ://www.utilities-online.info/xsdvalidation/ 。

# zip - .doc 格式如何工作？

> ID：124869
> 
> 赞同：15
> 
> 时间：2008-09-24T01:23:02.773
> 
> 标签：zip, format, docx, doc

我最近了解了 .docx 文件的基本结构（它是一个特殊结构的 zip 存档）。但是，docx 的格式不像 doc。

doc文件如何工作？文件格式、结构等是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T01:31:48.883

这不是您问题的直接答案，但我强烈建议您阅读 Joel Spolsky 的文章，[为什么 Microsoft Office 文件格式如此复杂？（以及一些解决方法）](http://www.joelonsoftware.com/items/2008/02/19.html)。它将让您深入了解 .doc 格式的复杂程度以及原因。Joel 还对 .doc 格式包含的内容进行了非常基本的概述：

> 您会看到，Excel 97-2003 文件是 OLE 复合文档，它们本质上是单个文件中的文件系统。这些非常复杂，您必须阅读另外 9 页的规范才能弄清楚。这些“规范”看起来更像是 C 数据结构，而不是我们传统上认为的规范。它是一个完整的分层文件系统。

（引用是指 Excel 文件，但它也适用于 Word 文档）。内容丰富的文章，有助于理解为什么 .docx 和 ODF 文件的结构和设计在从外部角度检查时更加合乎逻辑。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-24T01:25:10.597

二进制 .doc 文件的完整格式记录在[此 pdf](http://download.microsoft.com/download/0/B/E/0BE8BDD7-E5E8-422A-ABFD-4342ED7AD886/Word97-2007BinaryFileFormat(doc)Specification.pdf)中（来自[.doc 的 Wikipedia 文章](http://en.wikipedia.org/wiki/DOC_(computing))）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T01:37:11.897

MS Word DOC 格式背后的基本思想是一个 OLE 复合文档，正如 Kibbee 已经写的那样，它基本上是一个内存转储。这是一种非常复杂且令人费解的文档存储方式，但是如果您曾经真正深入研究过 Word 应用程序，您就会知道它有多么疯狂的功能，如果您在商业环境中使用过它，您将拥有一个很好的感受它如何与 Office 系列中的其他程序集成。

通常，OLE 复合文档是非常可扩展的结构，它允许您将各种数据填充到一个文件中，甚至在某种程度上可以处理您没有安装应用程序的数据。例如，如果您将 Equation 对象（来自 MS Equation Editor）插入到文档中，它将被存储为子对象，就像文件中的文件一样，但该对象不仅包含 Equation Editor 所需的数据为了编辑和渲染它，它还存储了一个通用位图（或元文件，也许）表示，因此它可以在没有安装方程式编辑器的机器上显示，尽管没有编辑。

这就是*为什么*，因为您必须*如何*阅读其他人已经链接到的规范；）

但是，如果您想以简单的方式处理文件，请确保您的软件在安装了 Word 的 Windows 计算机上运行，​​然后使用 COM/OLE 自动化打开和操作文档。那时您不必担心文件格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T01:27:59.843

.doc 格式相当复杂。与大多数 Microsoft 格式一样，它反映了版本和旧支持之间的长期变化历史。他们不久前发布了它，所以如果您想查看它（以及其他 Office 2007 之前的格式），请[点击此处](http://msdn.microsoft.com/en-us/library/cc313153%28v=office.12%29.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T02:00:14.210

Doc 是 word 文档的二进制格式 - 这是[Microsoft Office Word 97-2007 Binary File Format Specification [*.doc]](http://download.microsoft.com/download/0/B/E/0BE8BDD7-E5E8-422A-ABFD-4342ED7AD886/Word97-2007BinaryFileFormat(doc)Specification.pdf)文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T01:28:33.257

有 Microsoft Word 的 .doc，然后有纯文本 .doc。听起来您想知道专有的 Microsoft 格式。

来自[维基百科](http://en.wikipedia.org/wiki/DOC_(computing))：

> DOC 格式因 Microsoft Office Word 格式而异。最高 97 的 Word 版本使用与 97 和 2003 之间的 Microsoft Word 版本不同的格式。

直到 Word 2007 中[.docx](http://en.wikipedia.org/wiki/DOCX)，虽然是打包文件，但不一定是 .zip 存档。它是一个结构化的 XML 文档。

# c# - 什么是温莎城堡，我为什么要关心？

> ID：124871
> 
> 赞同：198
> 
> 时间：2008-09-24T01:23:36.547
> 
> 标签：c#, dependency-injection, inversion-of-control, castle-windsor

我是一名长期的 Windows 开发人员，对 win32 和早期的 COM 有过初步了解。自 2001 年以来，我一直在使用 .NET，因此我非常精通 C# 和 CLR。在我开始参加 Stack Overflow 之前，我从未听说过温莎城堡。我已经阅读了温莎城堡的“入门”指南，但没有点击。

教这条老狗新技巧，并告诉我为什么要将 Castle Windsor 集成到我的企业应用程序中。

* * *

## 回答 #1

> 赞同：373
> 
> 时间：2008-09-24T01:31:16.417

Castle Windsor 是一种反转控制工具。还有其他人喜欢它。

它可以为您提供具有预构建和预连接依赖项的对象。 **通过反射和配置而不是“新”运算符创建的整个对象图。**

从这里开始：http: [//tech.groups.yahoo.com/group/altdotnet/message/10434](http://tech.groups.yahoo.com/group/altdotnet/message/10434)

* * *

假设您有一个电子邮件发送课程。电子邮件发件人。假设您有另一个类 WorkflowStepper。在 WorkflowStepper 中，您需要使用 EmailSender。

你总是可以说`new EmailSender().Send(emailMessage);`

但这 - 使用`new`- 会产生难以改变的紧密耦合。（毕竟这是一个小小的人为的例子）

那么，如果不是在 WorkflowStepper 中新建这个坏男孩，而是将它传递给构造函数呢？

因此，无论谁调用它，都必须更新 EmailSender。

`new WorkflowStepper(emailSender).Step()`

想象一下，您有数百个只有一个职责的小类（google SRP）..您在 WorkflowStepper 中使用了其中的一些：

`new WorkflowStepper(emailSender, alertRegistry, databaseConnection).Step()`

想象一下，不用担心`EmailSender`写作时的细节`WorkflowStepper`或`AlertRegistry`

你只是担心你正在处理的问题。

想象一下整个对象和依赖关系图（树）在运行时连接起来，所以当你这样做时：

`WorkflowStepper stepper = Container.Get<WorkflowStepper>();`

您可以真正处理`WorkflowStepper`在需要它们的地方自动填充的所有依赖项。

## 没有`new`

它只是*发生*了——因为它知道什么需要什么。

您可以使用设计更好的 DRY 代码以可测试和可重复的方式编写更少的缺陷。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-08-11T13:00:28.233

Mark Seemann 写了一本关于 DI（依赖注入）的优秀书籍，它是 IOC 的一个子集。他还比较了一些容器。我不能足够推荐这本书。书名是：《.Net 中的依赖注入》[https://www.manning.com/books/dependency-injection-in-dot-net](https://www.manning.com/books/dependency-injection-in-dot-net)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-02-18T18:46:09.450

我认为 IoC 是朝着提高生产力和开发团队（包括 PM、BA 和 BO）的乐趣的正确方向迈进的垫脚石。它有助于在开发人员和测试之间建立关注点分离。它在架构设计时让您高枕无忧，因为框架可能进出灵活。

实现 IoC（CW 或 Ninject 等）目标的最佳方法是消除政治 #1 和 #2，从而消除开发人员在开发时伪装错误理解的需要。这两个解决方案似乎与 IoC 无关？他们是 ：）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-03-07T18:07:37.787

Castle Windsor 是`Dependency Injection container.`这意味着您可以在此帮助下注入您的依赖项并使用它们，而无需借助 new 关键字创建它们。例如，假设您编写了一个存储库或服务，并且希望在许多地方使用它，您需要先注册您的服务/存储库，然后将其注入所需的位置后即可开始使用。你可以看看下面我学习城堡温莎的教程。

[链接](https://www.codeproject.com/Articles/543810/Dependency-Injection-and-Unit-Of-Work-using-Castle)。

希望它会帮助你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-03-22T12:17:02.243

简单地说。想象一下，你的代码中有一些类，需要一些简单的配置值来完成它的工作。这意味着创建该类的实例的所有内容都需要获取这些依赖项，因此您通常最终不得不重构类加载，只需将一些配置传递到创建实例的位置。

所以要么大量的类被不必要地改变，你将配置值集中到一个大的配置类中，这也很糟糕......或者最糟糕的是仍然去服务定位器！

IoC 允许您的类轻松获得所有依赖项，并更明确地管理实例的生命周期。

# c++ - 是否可以防止对象的堆栈分配，只允许用“new”实例化它？

> ID：124880
> 
> 赞同：53
> 
> 时间：2008-09-24T01:27:01.263
> 
> 标签：c++, c++-faq

是否可以防止对象的堆栈分配并只允许在堆上使用“new”来启动它？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-09-24T01:32:04.497

您可以这样做的一种方法是将构造函数设为私有，并且只允许通过返回指针的静态方法进行构造。例如：

```
class Foo
{
public:
    ~Foo();
    static Foo* createFoo()
    {
        return new Foo();
    }
private:
    Foo();
    Foo(const Foo&);
    Foo& operator=(const Foo&);
}; 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2012-10-02T20:07:19.110

在 C++11 的情况下

```
class Foo
{
  public:
    ~Foo();
    static Foo* createFoo()
    {
        return new Foo();
    }

    Foo(const Foo &) = delete; // if needed, put as private
    Foo & operator=(const Foo &) = delete; // if needed, put as private
    Foo(Foo &&) = delete; // if needed, put as private
    Foo & operator=(Foo &&) = delete; // if needed, put as private

  private:
    Foo();
}; 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-24T01:31:50.443

您可以制作构造函数`private`，然后提供`public`静态工厂方法来创建对象。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-11-20T02:59:23.347

以下允许公共构造函数，并将通过在运行时抛出来停止堆栈分配。注意`thread_local`是 C++11 关键字。

```
class NoStackBase {
    static thread_local bool _heap;
protected:
    NoStackBase() {
        bool _stack = _heap;
        _heap = false;
        if (_stack)
            throw std::logic_error("heap allocations only");
    }
public:
    void* operator new(size_t size) throw (std::bad_alloc) { 
        _heap = true;
        return ::operator new(size);
    }
    void* operator new(size_t size, const std::nothrow_t& nothrow_value) throw () {
        _heap = true;
        return ::operator new(size, nothrow_value);
    }
    void* operator new(size_t size, void* ptr) throw () {
        _heap = true;
        return ::operator new(size, ptr);
    }
    void* operator new[](size_t size) throw (std::bad_alloc) {
        _heap = true;
        return ::operator new[](size);
    }
    void* operator new[](size_t size, const std::nothrow_t& nothrow_value) throw () {
        _heap = true;
        return ::operator new[](size, nothrow_value);
    }
    void* operator new[](size_t size, void* ptr) throw () {
        _heap = true;
        return ::operator new[](size, ptr);
    }
};

bool thread_local NoStackBase::_heap = false; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-08-22T17:14:07.450

这应该可以在 C++20 中使用破坏运算符删除，请参阅[p0722r3](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p0722r3.html)。

```
#include <new>

class C
{
private:
  ~C() = default;
public:
  void operator delete(C *c, std::destroying_delete_t)
  {
    c->~C();
    ::operator delete(c);
  }
}; 
```

请注意，私有析构函数会阻止它用于动态存储持续时间以外的任何其他用途。但是销毁操作符 delete 允许通过删除表达式将其销毁（因为在这种情况下，删除表达式不会隐式调用析构函数）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-24T01:37:39.837

您可以创建一个为对象提供抽象接口的头文件，以及返回指向在堆上创建的对象的指针的工厂函数。

```
// Header file

class IAbstract
{
    virtual void AbstractMethod() = 0;

public:
    virtual ~IAbstract();
};

IAbstract* CreateSubClassA();
IAbstract* CreateSubClassB();

// Source file

class SubClassA : public IAbstract
{
    void AbstractMethod() {}
};

class SubClassB : public IAbstract
{
    void AbstractMethod() {}
};

IAbstract* CreateSubClassA()
{
    return new SubClassA;
}

IAbstract* CreateSubClassB()
{
    return new SubClassB;
} 
```

# c# - 使用 WebBrowser Winforms Control 通过 SSL 访问 Intranet

> ID：124885
> 
> 赞同：2
> 
> 时间：2008-09-24T01:29:01.197
> 
> 标签：c#, .net, user-interface, browser

我有一个内部使用的 .Net 2.0 应用程序，我们想使用 WebBrowser 控件来访问一些 Web 资源。我们希望使用 SSL 使用自签名证书为这些站点添加加密。

我的问题是，是否有办法禁用有关来自不受信任来源的 SSL 密钥的所有警告？我想避免必须在运行该应用程序的每个工作站中安装密钥。

欢迎任何其他有关如何执行此操作的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T02:33:22.463

我不相信有解决这个问题的方法，当您通过 WebBrowser 控件（或 Internet Explorer）访问上述 Web 资源时，您总是会收到警告，但是您可以通过组策略分发**根**证书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T09:14:18.777

您可以通过挂钩对话框来做到这一点（正如上面的人发送链接一样），但随后实施 SSL 将毫无意义。因为当攻击进行 MITM 攻击时，您将忽略警告并继续进行。您的安装程序可能会首先安装证书。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T14:36:07.013

我有一个解决这个elventear的方法。它是我正在编写的代码项目文章的一部分，该文章说明了您在处理安全性和 WebBrowser 控件时可以执行的各种“技巧”。当它可用时，我会在这里提供建议。

# .net - 如何在 WindowsC++/CLI 中获取应用程序的可执行文件名？

> ID：124886
> 
> 赞同：20
> 
> 时间：2008-09-24T01:29:02.320
> 
> 标签：.net, winapi, c++-cli

我需要根据可执行名称更改应用程序的功能。没什么大不了的，只是改变了显示的字符串和一些内部标识符。该应用程序是用本地代码和 .Net C++-CLI 代码混合编写的。

我研究过的两种方法是在 Win32 中解析 GetCommandLine() 函数并在 .Net 中填充 AppDomain 和其他内容。但是，使用 GetCommandLine 并不总是有效，因为从调试器运行时命令行为空。.Net AppDomain 的东西似乎需要很多东西。

那么在 C++/CLI 中确定可执行文件名称的最好/最简单/最有效的方法是什么？（我有点希望我错过了 .Net 中提供的一些简单的东西。）

编辑：我应该提到的一件事是，这是一个使用 C++/CLI 的 Windows GUI 应用程序，因此无法访问传统的 C 风格的 main 函数，它使用 Windows WinMain() 函数。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-24T01:31:38.227

使用 0 作为模块句柄调用[GetModuleFileName() 。](http://msdn.microsoft.com/en-us/library/ms683197(VS.85).aspx)

**注意：**如果没有main，你*也*可以使用`argv[0]`参数到main或调用。`GetCommandLine()`但是，请记住，这些方法不一定会为您提供可执行文件的完整路径。他们将返回用于启动程序的相同字符串。`GetModuleFileName()`相反，调用将始终为您提供完整的路径和文件名。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-24T02:27:31.977

费鲁乔的回答很好。这是一些示例代码：

```
TCHAR exepath[MAX_PATH+1];

if(0 == GetModuleFileName(0, exepath, MAX_PATH+1))
    MessageBox(_T("Error!"));

MessageBox(exepath, _T("My executable name")); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-24T01:33:12.217

使用`argv`参数`main`：

```
int main(int argc, char* argv[])
{
    printf("%s\n", argv[0]);  //argv[0] will contain the name of the app.
    return 0;
} 
```

您可能需要扫描字符串以删除目录信息和/或扩展名，但名称会在那里。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T06:54:51.320

使用 __argv[0]

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T01:45:27.617

Assembly 上有一个静态方法，可以在 .NET 中为您获取它。

```
Assembly.GetEntryAssembly().FullName 
```

编辑：我没有意识到你想要文件名......你也可以通过调用：

```
Assembly.GetEntryAssembly().CodeBase 
```

这将为您提供程序集的完整路径（包括文件名）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-21T14:25:32.197

我可以确认它在 win64/visual studio 2017/MFC 下工作

```
TCHAR szFileName[MAX_PATH + 1];
GetModuleFileName(NULL, szFileName, MAX_PATH + 1);
auto exe = CString(szFileName); 
```

exe 包含 exe 的完整路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-05T09:56:38.767

根据[MSDN](https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea?redirectedfrom=MSDN)：

> 全局变量`_pgmptr`自动初始化为可执行文件的全路径，可用于检索可执行文件的全路径名。

# c# - XMLDocument.Load(url) 通过代理

> ID：124932
> 
> 赞同：13
> 
> 时间：2008-09-24T01:43:49.430
> 
> 标签：c#, xml, proxy

我有一些代码基本上使用 XMLDocument.Load(uri) 方法读取 XML 文档，该方法工作正常，但如果通过代理进行调用，则效果不佳。

我想知道是否有人知道通过代理进行此调用（或达到相同效果）的方法？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T03:37:52.650

这是我最终使用的代码：

```
WebProxy wp = new WebProxy(Settings.Default.ProxyAddress);
wp.Credentials = new NetworkCredential(Settings.Default.ProxyUsername, Settings.Default.ProxyPassword);
WebClient wc = new WebClient();
wc.Proxy = wp;

MemoryStream ms = new MemoryStream(wc.DownloadData(url));
XmlTextReader rdr = new XmlTextReader(ms);
return XDocument.Load(rdr); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-17T13:20:57.907

使用lomaxx的答案但改变

```
MemoryStream ms = new MemoryStream(wc.DownloadData(url));
XmlTextReader rdr = new XmlTextReader(url); 
```

到

```
MemoryStream ms = new MemoryStream(wc.DownloadData(url));
XmlTextReader rdr = new XmlTextReader(ms); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-24T01:54:21.543

您是否必须向代理提供凭据？

如果是这样，这应该会有所帮助：“从文件读取时向 XmlResolver 提供身份验证凭据” [http://msdn.microsoft.com/en-us/library/aa720674.aspx](http://msdn.microsoft.com/en-us/library/aa720674.aspx)

基本上，你...

1.  使用 URL 创建 XmlTextReader
2.  设置读取器的 XmlResolver 的 Credentials 属性
3.  创建一个 XmlDocument 实例并将读取器传递给 Load 方法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T01:50:12.567

您不能将 XMLDocument 配置为使用代理。您可以使用 WebRequest 或 WebClient 类通过代理加载数据并将获得的响应流传递给 XMLDocument

您也可以尝试使用 XmlTextReader 类。它允许您设置网络凭据。详情见：

[从文件读取时向 XmlResolver 提供身份验证凭据](http://msdn.microsoft.com/en-us/library/aa720674.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T01:52:51.063

您需要使用[WebProxy](http://msdn.microsoft.com/en-us/library/system.net.webproxy(VS.80).aspx)和 WebRequest 来下载 xml，然后对其进行解析。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-29T07:28:27.767

实际上，您可以使用 Windows 代理配置，而不是存储在应用程序的设置中。我相信这是现在的标准，因此不必在每个程序中配置代理，即查看 Chrome 的代理指向 Windows 的设置

```
IWebProxy wp = WebRequest.GetSystemWebProxy();                  
wp.Credentials = WebRequest.GetSystemWebProxy().Credentials;                    
WebClient wc = new WebClient();
wc.Proxy = wp; 
```

# javascript - 如何让 Ajax.Autocompleter 在不输入的情况下执行请求？

> ID：124935
> 
> 赞同：3
> 
> 时间：2008-09-24T01:44:48.913
> 
> 标签：javascript, ajax, scriptaculous, autocomplete

我正在使用 scriptaculous 的 Ajax.Autocompleter 进行不同过滤器的搜索。

[http://github.com/madrobby/scriptaculous/wikis/ajax-autocompleter](http://github.com/madrobby/scriptaculous/wikis/ajax-autocompleter)

过滤器要求我将数据动态地传递到自动完成器中，我已经从以下链接成功地学会了这样做。

[http://www.simpltry.com/2007/01/30/ajaxautocompleter-dynamic-parameters/](http://www.simpltry.com/2007/01/30/ajaxautocompleter-dynamic-parameters/)

现在，我有多个过滤器和一个搜索框。如何让自动完成器在*不* 输入输入但单击新过滤器的情况下发出请求？

这是一个用例来澄清。页面加载完毕，有多个过滤器（只是带有 onclicks 的链接），以及一个附加了自动完成器的输入字段。我键入一个查询并执行自动完成器请求。然后，我单击一个不同的过滤器，我希望使用相同的查询执行另一个请求，但过滤器不同。

或者更简洁地说，我如何让自动完成器*在我想要的时候*执行请求，而不是依赖于输入来触发它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-05T22:59:46.460

我还发现 activate() 方法效果很好。这是我的示例代码....

```
<script type="text/javascript">
    /*<![CDATA[*/

    var autocomp1 = new Ajax.Autocompleter("search", "AjaxResultsListPlaceholder", "ajaxServerSideSearchHandler.php", {
            frequency: 1,
            minChars: 10,
            indicator: "AjaxWorkingPleaseWaitPlaceholder",
            } );

    /*]]>*/
</script>

<form id="theform">
    <input type="text" id="search" name="search" value="" />
    <input type="button" id="btn_search" name="btn_search" value="Search" onclick="autocomp1.activate();" />
    <div id="AjaxWorkingPleaseWaitPlaceholder" style="display: none; border: 1px solid #ffaaaa;">
    </div>
    <div id="AjaxResultsListPlaceholder" style="display: none;; border: 1px solid #aaffaa;">
    </div>

</form> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T20:17:35.727

回答我自己的问题：假按键。它确保发出请求，并且下拉框变得可见。这是我伪造按键的功能，它考虑了 IE 和 Firefox 的差异。

```
 function fakeKeyPress(input_id) {
    var input = $(input_id);
    if(input.fireEvent) {
      // ie stuff
      var evt = document.createEventObject();
      evt.keyCode = 67;
      $(input_id).fireEvent("onKeyDown", evt);
    } else { 
      // firefox stuff
      var evt = document.createEvent("KeyboardEvent");
      evt.initKeyEvent('keydown', true, true, null, false, false, false, false, 27, 0);
      var canceled = !$(input_id).dispatchEvent(evt);
    }
  } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-06T19:08:16.410

```
var autoCompleter = new Ajax.Autocompleter(/* exercise for the reader */);
// Magic happens
autoCompleter.activate(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T02:13:06.363

在查看了 Scriptaculous 源代码以了解[按键时会发生什么](http://github.com/madrobby/scriptaculous/tree/master/src/controls.js#L162)，我建议您尝试调用`onObserverEvent()`。

```
var autoCompleter = new Ajax.Autocompleter(/* exercise for the reader */);
// Magic happens
autoCompleter.onObserverEvent(); 
```

# c# - C# 文件读/写文件共享似乎不起作用

> ID：124946
> 
> 赞同：17
> 
> 时间：2008-09-24T01:48:25.083
> 
> 标签：c#, binary, fileshare

我的问题是基于继承大量我无法做的遗留代码。基本上，我有一个可以产生数据块的设备。一个库将调用设备来创建该数据块，出于某种原因，我不完全理解并且即使我想也无法更改，将该数据块写入磁盘。

此写入不是即时的，但最多可能需要 90 秒。在那个时候，用户想要获得正在生成的数据的部分视图，所以我想要一个消费者线程来读取另一个库正在写入磁盘的数据。

在我接触这个遗留代码之前，我想用我完全控制的代码来模拟这个问题。我使用 C#，表面上是因为它提供了很多我想要的功能。

在生产者类中，我有这段代码创建一个随机数据块：

```
FileStream theFS = new FileStream(this.ScannerRawFileName, 
  FileMode.OpenOrCreate, FileAccess.Write, FileShare.Read);
//note that I need to be able to read this elsewhere...
BinaryWriter theBinaryWriter = new BinaryWriter(theFS);
int y, x;
for (y = 0; y < imheight; y++){
    ushort[] theData= new ushort[imwidth];
    for(x = 0; x < imwidth;x++){
       theData[x] = (ushort)(2*y+4*x);
    }
    byte[] theNewArray = new byte[imwidth * 2];
    Buffer.BlockCopy(theImage, 0, theNewArray, 0, imwidth * 2);
    theBinaryWriter.Write(theNewArray);
    Thread.Sleep(mScanThreadWait); //sleep for 50 milliseconds
    Progress = (float)(y-1 >= 0 ? y-1 : 0) / (float)imheight;
}
theFS.Close(); 
```

到目前为止，一切都很好。此代码有效。当前版本（使用 FileStream 和 BinaryWriter）似乎与使用 File.Open 具有相同的选项和正在写入磁盘的 ushort[] 上的 BinaryFormatter 等效（尽管速度较慢，因为复制）。

但后来我添加了一个消费者线程：

```
FileStream theFS;
if (!File.Exists(theFileName)) {
    //do error handling
    return;
}
else {
     theFS = new FileStream(theFileName, FileMode.Open, 
        FileAccess.Read, FileShare.Read);
            //very relaxed file opening
}
BinaryReader theReader = new BinaryReader(theFS);

//gotta do this copying in order to handle byte array swaps
//frustrating, but true.
byte[] theNewArray = theReader.ReadBytes(
   (int)(imheight * imwidth * inBase.Progress) * 2);
ushort[] theData = new ushort[((int)(theNewArray.Length/2))];
Buffer.BlockCopy(theNewArray, 0, theData, 0, theNewArray.Length); 
```

现在，theNewArray 的声明可能会被破坏，并会导致某种读取溢出。但是，这段代码永远不会走得那么远，因为它总是总是在尝试打开新的 FileStream 时中断，并出现 System.IO.IOException 异常，表明另一个进程已打开该文件。

我正在按照 MSDN 上的 FileStream 文档中所述设置 FileAccess 和 FileShare 枚举，但似乎我无法做我想做的事情（即，在一个线程中写入，在另一个线程中读取）。我意识到这个应用程序有点不正统，但是当我涉及到实际设备时，我将不得不做同样的事情，但使用 MFC。

无论如何，我忘记了什么？我想要做的是否可能，因为它在文档中已尽可能指定？

谢谢！毫米波

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-24T02:29:48.837

您的使用者必须指定 FileShare.ReadWrite。

通过尝试在消费者中以 FileShare.Read 的形式打开文件，您是在说“我想打开文件并让其他人同时阅读它”......因为**已经**有一个调用失败的写入器，你必须允许与阅读器并发写入。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T02:22:05.687

我没有时间对此进行测试，但我认为您可能需要调用 BinaryWriter 的 Flush 方法

```
FileStream theFS = new FileStream(this.ScannerRawFileName, 
  FileMode.OpenOrCreate, FileAccess.Write, FileShare.Read);
//note that I need to be able to read this elsewhere...
BinaryWriter theBinaryWriter = new BinaryWriter(theFS);
int y, x;
for (y = 0; y < imheight; y++){
    ushort[] theData= new ushort[imwidth];
    for(x = 0; x < imwidth;x++){
       theData[x] = (ushort)(2*y+4*x);
    }
    byte[] theNewArray = new byte[imwidth * 2];
    Buffer.BlockCopy(theImage, 0, theNewArray, 0, imwidth * 2);
    theBinaryWriter.Write(theNewArray);
    Thread.Sleep(mScanThreadWait); //sleep for 50 milliseconds
    Progress = (float)(y-1 >= 0 ? y-1 : 0) / (float)imheight;
    theBinaryWriter.Flush();
}
theFS.Close(); 
```

对不起，我没有时间测试这个。我在创建一个与此类似的文件时遇到了问题（尽管不准确），并且缺少“Flush”是罪魁祸首。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T02:31:22.640

我相信 Chuck 是对的，但请记住，这样做的唯一原因是文件系统足够智能，可以序列化您的读/写；您没有锁定文件资源 - 这不是一件好事:)

# performance - dTrace 脚本和工具

> ID：124952
> 
> 赞同：5
> 
> 时间：2008-09-24T01:50:39.663
> 
> 标签：performance, profiling, sun, bsd, dtrace

我最近开始使用 dTrace 并注意到它有多棒。它是一个完美的分析工具，无需程序员在他们的应用程序中设置数百个探针。

我在这里和那里找到了一些不错的衬里和示例脚本，但我想知道其他人可能想要分享哪些脚本、工具和链接。

顺便说一句，有人试过 Chimes 吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T01:53:08.643

这是我发现有用的一些链接

关于 dTrace 的 Powerpoint 演示文稿：

[http://www.nbl.fi/~nbl97/solaris/dtrace/dtt_present.pdf](http://www.nbl.fi/~nbl97/solaris/dtrace/dtt_present.pdf)

200 多个有用的脚本：

[http://www.brendangregg.com/](http://www.brendangregg.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T02:50:01.113

今年我在 OSCON 参加了 Theo Schlossnagle 的[全栈内省速成课程](http://lethargy.org/~jesus/archives/123-OSCON2008-Presentation.html)演讲。在该演示文稿中，他给出了几个使用 D-Trace 语言的示例，并且在上面的链接中还有一些额外的实用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T02:01:04.130

值得注意的是，由于 Apple 和 Sun 的实现存在差异，来自 Solaris 的 dtrace 脚本可能无法（很可能不会）在 Leopard 上运行，反之亦然。我不确定 FreeBSD 的版本。

主要问题是操作系统提供了一组不同的探针。有时探针会以不同的名称提供。有时它们会或多或少地从一个操作系统到另一个操作系统。只是一个陷阱，以防您遇到由于某种原因无法工作的脚本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T21:49:27.493

不幸的是，dTrace 仅在/用于 Solaris OS 中实现。来自 sun 的人建议我将我所有的 php 应用程序移植到 Solaris，并“dtrace”它们。经过优化以再次将它们移植到我以前的操作系统上。

# php - glob() - 按上次修改的日期时间戳对文件数组进行排序

> ID：124958
> 
> 赞同：56
> 
> 时间：2008-09-24T01:51:54.230
> 
> 标签：php, arrays, sorting, filemtime

我正在尝试按日期顺序显示一组文件（最后修改）。

我已经完成了这个购买循环遍历数组并将其排序到另一个数组中，但是有没有更简单（更有效）的方法来做到这一点？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-09-24T02:19:13.853

> **自 PHP 7.2.0 起，警告** `create_function()`已被弃用。强烈建议不要依赖此功能。

为了后代，如果在接受的答案中链接的论坛帖子丢失或某些人不清楚，则需要的相关代码是：

```
<?php

$myarray = glob("*.*");
usort($myarray, create_function('$a,$b', 'return filemtime($a) - filemtime($b);'));

?> 
```

在我的系统上对此进行了测试，并验证了它是否根据需要按文件 mtime 排序。我也使用了类似的方法（用 Python 编写）来确定我网站上最后更新的文件。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2010-07-21T11:40:00.750

```
<?php
$items = glob('*', GLOB_NOSORT);
array_multisort(array_map('filemtime', $items), SORT_NUMERIC, SORT_DESC, $items); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2016-03-10T19:33:10.310

此解决方案与[接受的答案](https://stackoverflow.com/a/125047/3294262)相同，使用匿名函数¹更新：

```
$myarray = glob("*.*");

usort( $myarray, function( $a, $b ) { return filemtime($a) - filemtime($b); } ); 
```

* * *

¹ [匿名函数](http://php.net/manual/en/functions.anonymous.php)已于 2010 年在 PHP 中引入。原始答案日期为 2008 年。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2020-03-01T14:28:48.067

自**PHP 7.4**起，最好的解决方案是使用带箭头函数的自定义排序：

```
usort($myarray, fn($a, $b) => filemtime($a) - filemtime($b)); 
```

您还可以使用 spaceship 运算符，它适用于各种比较，而不仅仅是整数比较。在这种情况下它不会有任何区别，但在所有排序操作中使用它是一个好习惯。

```
usort($myarray, fn($a, $b) => filemtime($a) <=> filemtime($b)); 
```

如果你想以相反的顺序排序，你可以否定条件：

```
usort($myarray, fn($a, $b) => -(filemtime($a) - filemtime($b)));
// or 
usort($myarray, fn($a, $b) => -(filemtime($a) <=> filemtime($b))); 
```

* * *

请注意，`filemtime()`重复调用对性能不利。请应用[memoization](https://en.wikipedia.org/wiki/Memoization)以提高性能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-01-30T16:19:23.527

这可以通过更好的性能来完成。`usort()`接受的答案中的 会调用很多`filemtime()`次。PHP 使用快速排序算法，其平均性能为`1.39*n*lg(n)`. 该算法`filemtime()`每次比较调用两次，因此我们将对 10 个目录条目进行大约 28 次调用，对 100 个条目进行 556 次调用，对 1000 个条目进行 8340 次调用等。以下代码对我来说很好，并且性能很好：

```
exec ( stripos ( PHP_OS, 'WIN' ) === 0 ? 'dir /B /O-D *.*' : 'ls -td1 *.*' , $myarray ); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-07-08T19:42:12.620

## 2020 年 - 如果您关心性能，请考虑不要使用`glob()`！

如果您想扫描一个文件夹中的大量文件，而不需要特殊的通配符、规则集或任何`exec()`，

我建议`scandir()`，或者`readdir()`。

`glob()`慢很多，在Windows上甚至更慢。

* * *

> **引用：** [aalfinn](https://github.com/aalfiann)
> 
> 为什么 glob 在这个基准测试中看起来更慢？因为如果你这样写，glob 会递归到子目录`"mydir/*"`。
> 
> 只要确保没有任何子目录可以使 glob 快速运行。
> 
> `"mydir/*.jpg"`更快，因为 glob 不会尝试获取子目录中的文件。

* * *

> **基准：** `glob()` vs`scandir()`
> 
> [http://www.spudsdesign.com/benchmark/index.php?t=dir2](http://www.spudsdesign.com/benchmark/index.php?t=dir2)（外部）

* * *

> **讨论：** `readdir()` vs`scandir()`
> 
> [readdir vs scandir](https://stackoverflow.com/questions/8692764/readdir-vs-scandir)（stackoverflow）

* * *

> `readdir()`或`scandir()`结合这些，以获得非常简洁的性能。
> 
> **PHP 7.4**
> 
> `usort( $myarray, function( $a, $b ) { return filemtime($a) - filemtime($b); } );`
> 
> **来源：** [https ://stackoverflow.com/a/60476123/3626361](https://stackoverflow.com/a/60476123/3626361)
> 
> **PHP 5.3.0 及更新版本**
> 
> `usort($myarray, fn($a, $b) => filemtime($a) - filemtime($b));`
> 
> **来源：** [https ://stackoverflow.com/a/35925596/3626361](https://stackoverflow.com/a/35925596/3626361)

* * *

> **如果你想更深入的兔子洞：**
> 
> 目录迭代器
> 
> * * *
> 
> [https://www.php.net/manual/en/class.directoryiterator.php](https://www.php.net/manual/en/class.directoryiterator.php)
> 
> [https://www.php.net/manual/en/directoryiterator.construct.php](https://www.php.net/manual/en/directoryiterator.construct.php)（阅读评论！）
> 
> [http://paulyg.github.io/blog/2014/06/03/directoryiterator-vs-filesystemiterator.html](http://paulyg.github.io/blog/2014/06/03/directoryiterator-vs-filesystemiterator.html)
> 
> [DirectoryIterator 和 FileSystemIterator 的区别](https://stackoverflow.com/questions/12532064/difference-between-directoryiterator-and-filesystemiterator)

* * *

## 最后但同样重要的是，我的演示！

```
<?php
function files_attachment_list($id, $sort_by_date = false, $allowed_extensions = ['png', 'jpg', 'jpeg', 'gif', 'doc', 'docx', 'pdf', 'zip', 'rar', '7z'])
{
    if (empty($id) or !is_dir(sprintf('files/%s/', $id))) {
        return false;
    }
    $out = [];
    foreach (new DirectoryIterator(sprintf('files/%s/', $id)) as $file) {
        if ($file->isFile() == false || !in_array($file->getExtension(), $allowed_extensions)) {
            continue;
        }

        $datetime = new DateTime();
        $datetime->setTimestamp($file->getMTime());
        $out[] = [
            'title' => $file->getFilename(),
            'size' => human_filesize($file->getSize()),
            'modified' => $datetime->format('Y-m-d H:i:s'),
            'extension' => $file->getExtension(),
            'url' => $file->getPathname()
        ];
    }

    $sort_by_date && usort($out, function ($a, $b) {
        return $a['modified'] > $b['modified'];
    });

    return $out;
}

function human_filesize($bytes, $decimals = 2)
{
    $sz = 'BKMGTP';
    $factor = floor((strlen($bytes) - 1) / 3);
    return sprintf("%.{$decimals}f", $bytes / pow(1024, $factor)) . @$sz[$factor];
}

// returns a file info array from path like '/files/123/*.extensions'
// extensions = 'png', 'jpg', 'jpeg', 'gif', 'doc', 'docx', 'pdf', 'zip', 'rar', '7z'
// OS specific sorting
print_r( files_attachment_list(123) );

// returns a file info array from the folder '/files/456/*.extensions'
// extensions = 'txt', 'zip'
// sorting by modified date (newest first)
print_r( files_attachment_list(456, true, ['txt','zip']) ); 
```

# php - 在 Linux 中使用 PHP 创建 Word 文档

> ID：124959
> 
> 赞同：60
> 
> 时间：2008-09-24T01:52:26.430
> 
> 标签：php, linux, ms-word, document

PHP 在 linux 环境中创建 word 文档的可用解决方案是什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2011-11-08T03:58:37.280

[PHPWord](https://phpword.readthedocs.io/)可以生成 docx 格式的 Word 文档。它还可以使用现有的 .docx 文件作为模板 - 模板变量可以以 ${varname} 格式添加到文档中

它有一个 LGPL 许可证，并且代码附带的示例对我来说效果很好。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-24T02:07:48.280

### 真实的 Word 文档

如果您需要生成“真正的”Word 文档，则需要基于 Windows 的 Web 服务器和 COM 自动化。我强烈推荐[Joel](http://www.joelonsoftware.com/items/2008/02/19.html)关于这个主题的文章。

### *用于欺骗 Word 打开原始 HTML 的*虚假HTTP 标头**

 *一个相当常见（但不可靠）的替代方案是：

```
header("Content-type: application/vnd.ms-word");
header("Content-Disposition: attachment; filename=document_name.doc");

echo "<html>";
echo "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=Windows-1252\">";
echo "<body>";
echo "<b>Fake word document</b>";
echo "</body>";
echo "</html>" 
```

确保您不使用外部样式表。一切都应该在同一个文件中。

请注意，这不会**发送**实际的 Word 文档。它只是诱使浏览器将其作为下载提供并默认为`.doc`文件扩展名。旧版本的 Word 通常会在没有任何警告/安全消息的情况下打开它，并且只需将原始 HTML 导入 Word。PHP 发送该误导性`Content-Type`标题并不构成真正的文件格式转换。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-25T08:05:05.480

OpenOffice 模板 + OOo 命令行界面。

1.  手动创建带有占位符的 ODT 模板，例如 [%value-to-replace%]
2.  在 PHP 中使用真实数据实例化模板时，解压缩模板 ODT（它是一个压缩的 XML），然后针对 XML 运行用实际值替换占位符的文本。
3.  将 ODT 拉回
4.  通过 OpenOffice 命令行界面运行转换 ODT -> DOC。

有可用的工具和库来简化每个步骤。

可能会有帮助。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-14T06:48:14.970

到目前为止，使用 PHP 在 Linux 上创建 DOC 文件的最简单方法是使用 Zend 框架组件**phpLiveDocx**。

从项目网站：

“phpLiveDocx 允许开发人员通过将来自 PHP 的结构化数据与在文字处理器中创建的模板相结合来生成文档。生成的文档可以保存为 PDF、DOCX、DOC 或 RTF 文件。概念与邮件合并相同。”

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-03-31T22:40:22.507

[OpenTBS](http://www.tinybutstrong.com/opentbs.php)可以使用模板技术在 PHP 中创建 DOCX 动态文档。

无需临时文件，无需命令行，全部在 PHP 中。

它可以添加或删除图片。创建的文档可以生成为 HTML 下载文件、保存在服务器上的文件或 PHP 中的二进制内容。

它还可以合并 OpenDocument 文件（ODT、ODS、ODF...）

[http://www.tinybutstrong.com/opentbs.php](http://www.tinybutstrong.com/opentbs.php)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-11-09T21:37:06.440

按照 Ivan Krechetov 的回答，这里有一个函数可以为 docx 和 odt 进行邮件合并（实际上只是简单的文本替换），而不需要额外的库。

```
function mailMerge($templateFile, $newFile, $row)
{
  if (!copy($templateFile, $newFile))  // make a duplicate so we dont overwrite the template
    return false; // could not duplicate template
  $zip = new ZipArchive();
  if ($zip->open($newFile, ZIPARCHIVE::CHECKCONS) !== TRUE)
    return false; // probably not a docx file
  $file = substr($templateFile, -4) == '.odt' ? 'content.xml' : 'word/document.xml';
  $data = $zip->getFromName($file);
  foreach ($row as $key => $value)
    $data = str_replace($key, $value, $data);
  $zip->deleteName($file);
  $zip->addFromString($file, $data);
  $zip->close();
  return true;
} 
```

这会将 [Person Name] 替换为 Mina，将 [Person Last Name] 替换为 Mooo：

```
$replacements = array('[Person Name]' => 'Mina', '[Person Last Name]' => 'Mooo');
$newFile = tempnam_sfx(sys_get_temp_dir(), '.dat');
$templateName = 'personinfo.docx';
if (mailMerge($templateName, $newFile, $replacements))
{
  header('Content-type: application/msword');
  header('Content-Disposition: attachment; filename=' . $templateName);
  header('Accept-Ranges: bytes');
  header('Content-Length: '. filesize($file));
  readfile($newFile);
  unlink($newFile);
} 
```

请注意，如果要替换的字符串太笼统，此函数可能会损坏文档。尝试使用详细的替换字符串，例如 [Person Name]。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T14:38:32.533

Apache 项目有一个名为[POI](http://poi.apache.org/)的库，可用于生成 MS Office 文件。它是一个 Java 库，但优点是它可以毫无问题地在 Linux 上运行。这个库有其局限性，但它可能会为您完成这项工作，而且使用起来可能比尝试运行 Word 更简单。

另一种选择是 OpenOffice，但我不能完全推荐它，因为我从未使用过它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-07-24T02:04:07.260

```
<?php
function fWriteFile($sFileName,$sFileContent="No Data",$ROOT)
    {
        $word = new COM("word.application") or die("Unable to instantiate Word");
        //bring it to front
        $word->Visible = 1;
        //open an empty document
        $word->Documents->Add();
        //do some weird stuff
        $word->Selection->TypeText($sFileContent);
        $word->Documents[1]->SaveAs($ROOT."/".$sFileName.".doc");
        //closing word
        $word->Quit();
        //free the object
        $word = null;
        return $sFileName;
    }
?>

<?php
$PATH_ROOT=dirname(__FILE__);
$Return ="<table>";
$Return .="<tr><td>Row[0]</td></tr>";
 $Return .="<tr><td>Row[1]</td></tr>";
$sReturn .="</table>";
fWriteFile("test",$Return,$PATH_ROOT);
?> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T07:33:10.510

有 2 个选项可以创建高质量的 Word 文档。使用 COM 与 word 通信（这至少需要一个 windows php 服务器）。使用 openoffice 及其 API 来创建和保存 word 格式的文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-26T15:45:38.093

看看 PHP COM 文档（评论很有帮助）[http://us3.php.net/com](http://us3.php.net/com)

# c++ - C++ 中的存在图

> ID：124966
> 
> 赞同：4
> 
> 时间：2008-09-24T01:54:56.643
> 
> 标签：c++, stl, map

我想要一个类似[std::map](http://en.wikipedia.org/wiki/Map_%28C++%29)的东西，但我只想看看该项目是否存在，我实际上不需要一个键和一个值。我应该使用什么？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-24T01:56:53.220

看起来你需要一个[std::set](http://en.cppreference.com/w/cpp/container/set)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T02:04:01.333

如果您想要与 相同类型的行为`std::map`，那么您想要`std::set`.

如果您正在混合插入/删除和查询操作，那么`std::set`可能是最好的选择。但是，如果您可以先填充集合，然后使用查询跟随它，则可能值得查看使用`std::vector`、对其进行排序，然后使用二分搜索来检查向量中是否存在。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T15:49:33.547

如果你真的只需要存在，甚至不需要命令，你需要一个`unordered_set`. 它可以从您最喜欢的 C++0x 供应商或[boost.org 获得](http://boost.org)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T02:05:45.320

如果您的数据是数字的，您可以使用针对空间优化的 std::vector：

```
D:\Temp>type vectorbool.cpp
#include <iostream>
#include <vector>

using namespace std;

int main() {
        vector<bool> vb(10);
        vb[5] = true;

        for (vector<bool>::const_iterator ci = vb.begin(); ci != vb.end(); ++ci) {
                cout << *ci << endl;
        }
}

D:\Temp>cl /nologo /W4 /EHsc vectorbool.cpp
vectorbool.cpp

D:\Temp>vectorbool.exe
0
0
0
0
0
1
0
0
0
0 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T10:36:51.637

你可能应该看看[`stl::set`](http://www.cplusplus.com/reference/stl/set/)你需要什么。A[`stl::bitset`](http://www.cplusplus.com/reference/stl/bitset/)是另一种选择。

这将取决于您需要如何使用将定义哪些更好的信息。A`set`是一个有序的数据结构，插入、查找和删除需要O(LOG N)时间。但是，如果您需要**遍历**标记为“存在”的所有值，那么这`set`是要走的路。

如果您只需要标记和查找某物是集合成员的**事实**`bitset`，那么这可能对您更好。插入、查找和删除只需要 O(1)，但你只能收集`int`值。遍历所有标记的值将花费 O(N)，因为您需要遍历整个集合以找到设置为 的成员`true`。您可以将它与[stl::map](http://www.cplusplus.com/reference/stl/map/)一起使用，以将您拥有的值映射到所需的数值`bitset`。

查看您需要对集合中的值执行的操作，您应该能够选择适当的数据结构

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T07:13:05.910

您可以继续将 std::map 用于所需目的。

要检查地图中是否存在特定项目（键类型），您可以使用以下代码：

```
if (mapObj.count(item) != 0)
{
   // item exists
} 
```

如前所述， std::set 也可以完成这项工作。有趣的是，set 和 map 在内部都表示为 Trees。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T22:40:09.800

如果键是值，那么您也可以考虑使用“bloom 过滤器”而不是集合。

# winapi - 在 Windows 中使用或不使用域的登录用户名

> ID：124967
> 
> 赞同：1
> 
> 时间：2008-09-24T01:56:12.770
> 
> 标签：winapi, visual-c++, mfc

是否有直接的 API 来获取当前登录用户的域名？那么，当机器在域上时它会返回类似“域\用户”的东西，但同时当机器不在域上时它会返回“用户”？如果没有，获取此信息的最佳方式是什么？

我注意到有一个 LookupAccountName 函数——这会是正确的方向吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T02:00:49.797

尝试[GetUserNameEx()](http://msdn.microsoft.com/en-us/library/ms724435(VS.85).aspx)。它支持各种名称格式。

# c - 低于底层普通 bsd 套接字

> ID：124968
> 
> 赞同：8
> 
> 时间：2008-09-24T01:56:22.800
> 
> 标签：c, sockets, network-programming

你如何在 C 中做低级套接字，例如：实际发送一个 SYN。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T02:00:10.983

您真正想要的是原始套接字……您可以使用原始套接字接口完全控制标头和标志，但对它们进行编程更具挑战性。这是一个很好的入门教程：[http](http://www.cs.binghamton.edu/~steflik/cs455/rawip.txt) ://www.cs.binghamton.edu/~steflik/cs455/rawip.txt 。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T01:59:51.687

原始套接字是您的朋友。

有一些[关于这个问题](https://stackoverflow.com/questions/110341/tcp-handshake-with-sockraw-socket)的有用信息的链接。

另请参阅 Steven 的“Unix 网络编程”的第 25 章“原始套接字”

如果您正在尝试跨平台代码，您可能会发现[libpcap](http://en.wikipedia.org/wiki/Libpcap)是一个有用的替代方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T01:59:40.047

您想使用[原始套接字](http://mixter.void.ru/rawip.html)。在 *nix 中，您需要是 root 才能创建原始套接字。我不确定在 Windows 中是否可行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T01:59:25.070

我怀疑 nmap 源将是一个很好的查看位置。

# c# - 具有行号的 Windows 窗体文本框？

> ID：124975
> 
> 赞同：7
> 
> 时间：2008-09-24T01:58:08.960
> 
> 标签：c#, .net, winforms

我正在为我正在编写的应用程序寻找免费的 winforms 组件。我基本上需要一个在侧栏中包含行号的文本框。能够将其中的数据制成表格也将是一大优势。

有谁知道可以做到这一点的预制组件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T02:44:55.803

参考[韦恩的帖子](https://stackoverflow.com/questions/124975/windows-forms-textbox-that-has-line-numbers#125093)，这里是相关代码。它使用 GDI 在文本框旁边绘制行号。

```
Public Sub New()
    MyBase.New()

    'This call is required by the Windows Form Designer.
    InitializeComponent()

    'Add any initialization after the InitializeComponent() call
    SetStyle(ControlStyles.UserPaint, True)
    SetStyle(ControlStyles.AllPaintingInWmPaint, True)
    SetStyle(ControlStyles.DoubleBuffer, True)
    SetStyle(ControlStyles.ResizeRedraw, True)
End Sub

Private Sub RichTextBox1_SelectionChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles RichTextBox1.SelectionChanged
    FindLine()
    Invalidate()
End Sub

Private Sub FindLine()
    Dim intChar As Integer

    intChar = RichTextBox1.GetCharIndexFromPosition(New Point(0, 0))
    intLine = RichTextBox1.GetLineFromCharIndex(intChar)
End Sub

Private Sub DrawLines(ByVal g As Graphics, ByVal intLine As Integer)
    Dim intCounter As Integer, intY As Integer

    g.Clear(Color.Black)

    intCounter = intLine + 1
    intY = 2
    Do
        g.DrawString(intCounter.ToString(), Font, Brushes.White, 3, intY)
        intCounter += 1

        intY += Font.Height + 1
        If intY > ClientRectangle.Height - 15 Then Exit Do
    Loop
End Sub

Protected Overrides Sub OnPaint(ByVal e As System.Windows.Forms.PaintEventArgs)
    DrawLines(e.Graphics, intLine)
End Sub

Private Sub RichTextBox1_VScroll(ByVal sender As Object, ByVal e As System.EventArgs) Handles RichTextBox1.VScroll
    FindLine()
    Invalidate()
End Sub

Private Sub RichTextBox1_UserScroll() Handles RichTextBox1.UserScroll
    FindLine()
    Invalidate()
End Sub 
```

RichTextBox 像这样被覆盖：

```
Public Class UserControl1
Inherits System.Windows.Forms.RichTextBox

Public Event UserScroll()

Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
    If m.Msg = &H115 Then
        RaiseEvent UserScroll()
    End If

    MyBase.WndProc(m)
End Sub
End Class 
```

（xtremedotnettalk.com 论坛上的 divil 代码。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T02:20:13.710

查看[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/) C# 编译器/IDE 源代码。他们有一个带有行号的复杂文本框。您可以查看源代码，弄清楚他们在做什么，然后自己实施。

这是我引用的示例： [alt text http://community.sharpdevelop.net/photos/mattward/images/original/FeatureTourQuickClassBrowser.aspx](http://community.sharpdevelop.net/photos/mattward/images/original/FeatureTourQuickClassBrowser.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T02:33:47.627

有一个项目的代码可在[http://www.xtremedotnettalk.com/showthread.php?s=&threadid=49661&highlight=RichTextBox](http://www.xtremedotnettalk.com/showthread.php?s=&threadid=49661&highlight=RichTextBox)。

您可以使用用户/密码登录该站点以下载 zip 文件：bugmenot/bugmenot

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-06T07:13:48.717

CodePlex for .net 中有一个源代码编辑组件， [http://www.codeplex.com/ScintillaNET](http://www.codeplex.com/ScintillaNET)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-10T18:58:03.217

这是一些执行此操作的 C# 代码。它基于 Wayne 引用的来自 xtremedotnettalk.com 的代码。我进行了一些更改以使其实际显示编辑器文本，而原始文本没有这样做。但是，公平地说，原始代码作者确实提到它需要工作。

这是代码（NumberedTextBox.cs）

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Text;
using System.Windows.Forms;

namespace NumberedTextBoxLib {
  public partial class NumberedTextBox : UserControl {
    private int lineIndex = 0;

    new public String Text {
      get {
        return editBox.Text;
      }
      set {
        editBox.Text = value;
      }
    }

    public NumberedTextBox() {
      InitializeComponent();
      SetStyle(ControlStyles.UserPaint, true);
      SetStyle(ControlStyles.AllPaintingInWmPaint, true);
      SetStyle(ControlStyles.OptimizedDoubleBuffer, true);
      SetStyle(ControlStyles.ResizeRedraw, true);
      editBox.SelectionChanged += new EventHandler(selectionChanged);
      editBox.VScroll += new EventHandler(OnVScroll);
    }

    private void selectionChanged(object sender, EventArgs args) {
      FindLine();
      Invalidate();
    }

    private void FindLine() {
      int charIndex = editBox.GetCharIndexFromPosition(new Point(0, 0));
      lineIndex = editBox.GetLineFromCharIndex(charIndex);
    }

    private void DrawLines(Graphics g) {
      int counter, y;
      g.Clear(BackColor);
      counter = lineIndex + 1;
      y = 2;
      int max = 0;
      while (y < ClientRectangle.Height - 15) {
        SizeF size = g.MeasureString(counter.ToString(), Font);
        g.DrawString(counter.ToString(), Font, new SolidBrush(ForeColor), new Point(3, y));
        counter++;
        y += (int)size.Height;
        if (max < size.Width) {
          max = (int) size.Width;
        }
      }
      max += 6;
      editBox.Location = new Point(max, 0);
      editBox.Size = new Size(ClientRectangle.Width - max, ClientRectangle.Height);
    }

    protected override void OnPaint(PaintEventArgs e) {
      DrawLines(e.Graphics);
      e.Graphics.TranslateTransform(50, 0);
      editBox.Invalidate();
      base.OnPaint(e);
    }

    ///Redraw the numbers when the editor is scrolled vertically
    private void OnVScroll(object sender, EventArgs e) {
      FindLine();
      Invalidate();
    }

  }
} 
```

这是 Visual Studio 设计器代码 (NumberedTextBox.Designer.cs)

```
 namespace NumberedTextBoxLib {
  partial class NumberedTextBox {
    /// Required designer variable.
    private System.ComponentModel.IContainer components = null;

    /// Clean up any resources being used.
    protected override void Dispose(bool disposing) {
      if (disposing && (components != null)) {
        components.Dispose();
      }
      base.Dispose(disposing);
    }

    /// Required method for Designer support - do not modify 
    /// the contents of this method with the code editor.
    private void InitializeComponent() {
      this.editBox = new System.Windows.Forms.RichTextBox();
      this.SuspendLayout();
      // 
      // editBox
      // 
      this.editBox.AcceptsTab = true;
      this.editBox.Anchor = ((System.Windows.Forms.AnchorStyles) ((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom)
                  | System.Windows.Forms.AnchorStyles.Left)
                  | System.Windows.Forms.AnchorStyles.Right)));
      this.editBox.Location = new System.Drawing.Point(27, 3);
      this.editBox.Name = "editBox";
      this.editBox.Size = new System.Drawing.Size(122, 117);
      this.editBox.TabIndex = 0;
      this.editBox.Text = "";
      this.editBox.WordWrap = false;
      // 
      // NumberedTextBox
      // 
      this.Controls.Add(this.editBox);
      this.Name = "NumberedTextBox";
      this.Size = new System.Drawing.Size(152, 123);
      this.ResumeLayout(false);

    }

    private System.Windows.Forms.RichTextBox editBox;
  }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-07-31T14:42:47.520

我想这取决于字体大小，我使用“Courier New, 9pt, style=bold”

*   添加了平滑滚动的修复，（不是逐行）
*   当滚动值超过 16 位时，添加了对大文件的修复。

**NumberedTextBox.cs**

```
public partial class NumberedTextBox : UserControl
{
    private int _lines = 0;

    [Browsable(true), 
        EditorAttribute("System.ComponentModel.Design.MultilineStringEditor, System.Design","System.Drawing.Design.UITypeEditor")]
    new public String Text
    {
        get
        {
            return editBox.Text;
        }
        set
        {
            editBox.Text = value;
            Invalidate();
        }
    }

    private Color _lineNumberColor = Color.LightSeaGreen;

    [Browsable(true), DefaultValue(typeof(Color), "LightSeaGreen")]
    public Color LineNumberColor {
        get{
            return _lineNumberColor;
        }
        set
        {
            _lineNumberColor = value;
            Invalidate();
        }
    }

    public NumberedTextBox()
    {
        InitializeComponent();

        SetStyle(ControlStyles.UserPaint, true);
        SetStyle(ControlStyles.AllPaintingInWmPaint, true);
        SetStyle(ControlStyles.OptimizedDoubleBuffer, true);
        SetStyle(ControlStyles.ResizeRedraw, true);
        editBox.SelectionChanged += new EventHandler(selectionChanged);
        editBox.VScroll += new EventHandler(OnVScroll);
    }

    private void selectionChanged(object sender, EventArgs args)
    {
        Invalidate();
    }

    private void DrawLines(Graphics g)
    {
        g.Clear(BackColor);
        int y = - editBox.ScrollPos.Y;
        for (var i = 1; i < _lines + 1; i++)
        {
            var size = g.MeasureString(i.ToString(), Font);
            g.DrawString(i.ToString(), Font, new SolidBrush(LineNumberColor), new Point(3, y));
            y += Font.Height + 2;
        }
        var max = (int)g.MeasureString((_lines + 1).ToString(), Font).Width + 6;
        editBox.Location = new Point(max, 0);
        editBox.Size = new Size(ClientRectangle.Width - max, ClientRectangle.Height);
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        _lines = editBox.Lines.Count();
        DrawLines(e.Graphics);
        e.Graphics.TranslateTransform(50, 0);
        editBox.Invalidate();
        base.OnPaint(e);
    }

    private void OnVScroll(object sender, EventArgs e)
    {
        Invalidate();
    }

    public void Select(int start, int length)
    {
        editBox.Select(start, length);
    }

    public void ScrollToCaret()
    {
        editBox.ScrollToCaret();
    }

    private void editBox_TextChanged(object sender, EventArgs e)
    {
        Invalidate();
    }
}

public class RichTextBoxEx : System.Windows.Forms.RichTextBox
{
    private double _Yfactor = 1.0d;

    [DllImport("user32.dll")]
    static extern IntPtr SendMessage(IntPtr hWnd, Int32 wMsg, Int32 wParam, ref Point lParam);

    private enum WindowsMessages
    {
        WM_USER = 0x400,
        EM_GETSCROLLPOS = WM_USER + 221,
        EM_SETSCROLLPOS = WM_USER + 222
    }

    public Point ScrollPos
    {
        get
        {
            var scrollPoint = new Point();
            SendMessage(this.Handle, (int)WindowsMessages.EM_GETSCROLLPOS, 0, ref scrollPoint);
            return scrollPoint;
        }
        set
        {
            var original = value;
            if (original.Y < 0)
                original.Y = 0;
            if (original.X < 0)
                original.X = 0;

            var factored = value;
            factored.Y = (int)((double)original.Y * _Yfactor);

            var result = value;

            SendMessage(this.Handle, (int)WindowsMessages.EM_SETSCROLLPOS, 0, ref factored);
            SendMessage(this.Handle, (int)WindowsMessages.EM_GETSCROLLPOS, 0, ref result);

            var loopcount = 0;
            var maxloop = 100;
            while (result.Y != original.Y)
            {
                // Adjust the input.
                if (result.Y > original.Y)
                    factored.Y -= (result.Y - original.Y) / 2 - 1;
                else if (result.Y < original.Y)
                    factored.Y += (original.Y - result.Y) / 2 + 1;

                // test the new input.
                SendMessage(this.Handle, (int)WindowsMessages.EM_SETSCROLLPOS, 0, ref factored);
                SendMessage(this.Handle, (int)WindowsMessages.EM_GETSCROLLPOS, 0, ref result);

                // save new factor, test for exit.
                loopcount++;
                if (loopcount >= maxloop || result.Y == original.Y)
                {
                    _Yfactor = (double)factored.Y / (double)original.Y;
                    break;
                }
            }
        }
    }
} 
```

**NumberedTextBox.Designer.cs**

```
partial class NumberedTextBox
{
    /// <summary> 
    /// Required designer variable.
    /// </summary>
    private System.ComponentModel.IContainer components = null;

    /// <summary> 
    /// Clean up any resources being used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
    protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        base.Dispose(disposing);
    }

    #region Component Designer generated code

    /// <summary> 
    /// Required method for Designer support - do not modify 
    /// the contents of this method with the code editor.
    /// </summary>
    private void InitializeComponent()
    {
        this.editBox = new WebTools.Controls.RichTextBoxEx();
        this.SuspendLayout();
        // 
        // editBox
        // 
        this.editBox.AcceptsTab = true;
        this.editBox.Anchor = ((System.Windows.Forms.AnchorStyles)((((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Bottom) 
        | System.Windows.Forms.AnchorStyles.Left) 
        | System.Windows.Forms.AnchorStyles.Right)));
        this.editBox.BorderStyle = System.Windows.Forms.BorderStyle.None;
        this.editBox.Location = new System.Drawing.Point(27, 3);
        this.editBox.Name = "editBox";
        this.editBox.ScrollPos = new System.Drawing.Point(0, 0);
        this.editBox.Size = new System.Drawing.Size(120, 115);
        this.editBox.TabIndex = 0;
        this.editBox.Text = "";
        this.editBox.WordWrap = false;
        this.editBox.TextChanged += new System.EventHandler(this.editBox_TextChanged);
        // 
        // NumberedTextBox
        // 
        this.BorderStyle = System.Windows.Forms.BorderStyle.FixedSingle;
        this.Controls.Add(this.editBox);
        this.Name = "NumberedTextBox";
        this.Size = new System.Drawing.Size(150, 121);
        this.ResumeLayout(false);

    }

    private RichTextBoxEx editBox;

    #endregion
} 
```****************