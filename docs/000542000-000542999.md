# StackOverflow 问答 000542000-000542999

# c++ - 用 C++ 样式注释替换 C 样式注释

> ID：542006
> 
> 赞同：9
> 
> 时间：2009-02-12T16:05:02.793
> 
> 标签：c++, comments

如何自动将所有 C 样式注释 ( `/* comment */`) 替换为 C++ 样式注释 ( `// comment`)？

这必须在几个文件中自动完成。任何解决方案都可以，只要它有效。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-12T17:44:44.223

这个工具可以完成这项工作： [https ://github.com/cenit/jburkardt/tree/master/recomment](https://github.com/cenit/jburkardt/tree/master/recomment)

> RECOMMENT 是一个 C++ 程序，它将 C 风格的注释转换为 C++ 风格的注释。

它还处理其他人提到的所有非平凡案例：

> 此代码包含佛罗里达州墨尔本 JDS Uniphase 的 Steven Martin 于 2005 年 4 月 28 日提供的建议和编码。这些建议允许程序忽略字符串的内部内容（否则可能看起来像是开始或结束注释），处理带有尾随注释的代码行，以及处理带有尾随代码位的注释。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-12T16:17:04.857

这不是一个小问题。

```
int * /* foo 
  /* this is not the beginning of a comment.

int * */ var = NULL; 
```

你想用什么来代替它？任何真正的替换有时都需要分割线。

```
int * // foo
  // this is not the beginning of a comment.
// int *
var = NULL; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T16:17:43.277

你打算如何处理这样的情况：

```
void CreateExportableDataTable(/*[out, retval]*/ IDispatch **ppVal)
{
 //blah
} 
```

注意括号内的注释......这是在生成的代码中记录事物的常用方法，或者在类的实现中提及默认参数值等。我通常不喜欢使用这种注释，但它们很常见，需要考虑。我不认为您可以在不经过深思熟虑的情况下将它们转换为 C++ 样式的注释。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T16:44:02.810

我和那些在你的问题中发表评论的人在一起。为什么这样做？就别管了。

它浪费时间，在版本控制中添加了无用的提交，有搞砸的风险

编辑：从 OP 的评论中添加详细信息

> 首选 C++ 风格注释的根本原因是您可以注释掉其中可能包含注释的代码块。如果该注释是 C 风格的，则代码的这种块注释不是直截了当的。– 未知（雅虎）

这可能是一件公平/好的事情，但我对此有两条评论：

*   我知道没有人会主张更改所有现有代码 - 这是对新代码的偏好。（海事组织）
*   如果您觉得需要“注释掉代码”（另一种不确定的做法），那么您可以根据需要进行 - 而不是在此之前

看来你还想用c风格的注释来屏蔽一段代码？或者你打算使用 // 来屏蔽很多行？

一种替代方法是针对这种情况的预处理器#ifdef。我对此感到畏缩，但这与注释掉行/块一样糟糕。两者都不应该留在生产代码中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T16:25:47.970

这是一个 Python 脚本，它将（大部分）完成这项工作。它处理大多数边缘情况，但它不处理字符串内的注释字符，尽管这应该很容易修复。

```
#!/usr/bin/python

import sys

out = ''
in_comment = False

file = open(sys.argv[1], 'r+')
for line in file:
    if in_comment:
        end = line.find('*/')
        if end != -1:
            out += '//' + line[:end] + '\n'
            out += ' ' * (end + 2) + line[end+2:]
            in_comment = False
        else:
            out += '//' + line
    else:
        start = line.find('/*')
        cpp_start = line.find('//')
        if start != -1 and (cpp_start == -1 or cpp_start > start):
            out += line[:start] + '//' + line[start+2:]
            in_comment = True
        else:
            out += line

file.seek(0)
file.write(out) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-01-17T15:28:37.150

我最近将我们存储库中所有文件的所有 C 样式注释转换为 C++ 样式。由于找不到可以自动执行此操作的工具，因此我编写了自己的工具：[c-comments-to-cpp](https://github.com/mbitsnbites/c-comments-to-cpp)

这不是万无一失的，但比我尝试过的任何其他方法（包括推荐）都要好。除此之外，它还支持转换 Doxygen 样式的注释，例如：

```
/**
* @brief My foo struct.
*/
struct foo {
  int bar;  /*!< This is a member.
                 It also has a meaning. */
}; 
```

转换为：

```
/// @brief My foo struct.
struct foo {
  int bar;  ///< This is a member.
            ///< It also has a meaning.
}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T16:10:29.067

为什么不编写一个 C 应用程序来解析它自己的源文件？您可以通过相对简单的正则表达式查询找到 /* 注释 */ 部分。然后，您可以用换行符+“//”替换换行符。

无论如何，只是一个想法。祝你好运。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T16:17:05.777

如果您编写应用程序/脚本来处理 C 源文件，请注意以下几点：

*   字符串中的注释字符
*   行中间的注释字符（您可能不想拆分代码行）

您最好尝试找到一个了解如何将代码实际解析为代码的应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T16:17:08.367

如果只有“几个文件”，真的有必要编写程序吗？在文本编辑器中打开它在实践中可能会更快，除非有一大堆评论。emacs 有一个`comment-region`命令（不出所料）评论一个区域，所以它只是放弃有问题的'/*'和'*/'的情况。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-12T16:27:27.543

您可能想尝试一些建议：

a) 编写您自己的代码（C/Python/任何您喜欢的语言）来替换注释。类似于正则表达式所说的内容或这种天真的解决方案**“可能”**有效：[除非像 one rmeador 这样的情况，Darron 发布]

```

对于文件中的行：
    如果行 [0] == "\*"：
       buf = '//' + 行中除 '\*' 之外的所有字符
       标志 = 真
    如果标志 = 真：
       如果行以 '*/' 结尾：
          剥离 '*/'
          标志 = 假
       添加 '//' + 行到 buf

```

b) 找到一个工具来做这件事。（如果我找到它们，我会查找一些并发布。）

c) 几乎所有现代 IDE（如果您正在使用的话）或文本编辑器都具有自动注释功能。然后，您可以手动打开每个文件，选择注释行，决定如何处理这种情况并使用加速器（例如 Ctrl + M）注释 C++ 样式。然后，您可以再次使用您的判断来简单地“查找和替换”所有“/*”和“*/”。我已将 Gedit 配置为使用“代码注释”插件来执行此操作。我不记得我在 Vim 中的操作方式。我相信可以很容易地找到这个。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-12T13:58:53.600

非常老的问题，我知道，但我只是使用“纯 emacs”实现了这一点。简而言之，解决方案如下所示：

运行`M-x query-replace-regexp`。出现提示时，输入

```
/\*\(\(.\|^J\)*?\)*\*/ 
```

作为要搜索的正则表达式。这`^J`是一个换行符，您可以通过按`^Q`（在大多数键盘中为 Ctrl+Q）输入，然后按 enter 键。然后输入

```
//\,(replace-regexp-in-string "[\n]\\([ ]*?\\)   \\([^ ]\\)" "\n\\1// \\2" \1)) 
```

作为替换表达式。

本质上，这个想法是您使用两个嵌套的正则表达式搜索。主要的只是找到 C 风格的注释（`*?`急切的重复非常方便）。然后，使用 elisp 表达式*仅在注释文本内*执行第二次替换。在这种情况下，我正在寻找后跟空格的换行符，并将最后三个空格字符替换为`//`，这对于保留注释格式非常有用（不过，只有在所有注释都缩进时才有效）。

对辅助正则表达式的更改将使此方法在其他情况下起作用，例如

```
//\,(replace-regexp-in-string "[\n]" " " \1)) 
```

只会将原始注释的全部内容放入单个 C++ 样式的注释中。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2014-04-02T16:05:50.277

来自 PHP 团队约定...如果提出问题，则必须存在一些推理。只要知道就回答。

> 永远不要使用 C++ 风格的注释（即 // 注释）。始终使用 C 风格的注释。PHP 是用 C 语言编写的，旨在在任何符合 ANSI-C 的编译器下编译。尽管许多编译器在 C 代码中接受 C++ 样式的注释，但您必须确保您的代码也可以与其他编译器一起编译。此规则的唯一例外是特定于 Win32 的代码，因为 Win32 端口是特定于 MS-Visual C++ 的，并且已知此编译器接受 C 代码中的 C++ 样式注释。

# c# - C# 中带有 https 的 HttpWebRequest

> ID：542024
> 
> 赞同：9
> 
> 时间：2009-02-12T16:08:20.040
> 
> 标签：c#, .net, https, httpwebrequest

这段代码不起作用；它正在登录使用 https 协议的网站。如何解决这个问题呢？`GetRequestStream()`代码随时随地停止，说协议违反异常未处理..

```
string username = "user";
string password = "pass";
HttpWebRequest request = (HttpWebRequest)WebRequest.Create("https://moje.azet.sk/prihlasenie.phtml?KDE=www.azet.sk%2Findex.phtml%3F");
request.UserAgent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.0.3705)";

Console.WriteLine(request.GetRequestStream());

using (StreamWriter writer = new StreamWriter(request.GetRequestStream(), Encoding.ASCII))
{
    writer.Write("nick=" + username + "&password=" + password);
}

HttpWebResponse response = (HttpWebResponse)request.GetResponse();
//Retrieve your cookie that id's your session
//response.Cookies

using (StreamReader reader = new StreamReader(response.GetResponseStream()))
{
    Console.WriteLine(reader.ReadToEnd());
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:18:23.230

在调用 GetRequestStream 之前将请求方法设置为发布

像

```
request.Method = "POST";

using (StreamWriter writer = new StreamWriter(request.GetRequestStream(), Encoding.ASCII))
{
    writer.Write("nick=" + username + "&password=" + password);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T16:33:05.533

我的猜测是您遇到的问题是由于您正在执行 GET 请求而不是 POST 请求这一事实（就像其他人建议的那样）。此外，我注意到该页面上密码字段的实际名称是“heslo”而不是“password”。此错字不会导致 Web 服务器不返回响应，但会导致其他问题，因为服务器正在寻找要与密码值一起发布的特定变量名称。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:22:20.223

您可能还想事先计算出您发布的内容的总长度，并将其设置为请求的 ContentLength。见[MSDN](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse.aspx "MSDN：HttpWebRequest.GetResponse 方法")：

> 当 HttpWebRequest 类上设置的属性发生冲突时，会在多种情况下引发 ProtocolViolationException。如果应用程序将 ContentLength 属性和 SendChunked 属性设置为 true，然后发送 HTTP GET 请求，则会发生此异常。如果应用程序尝试将分块发送到仅支持 HTTP 1.0 协议的服务器，则会发生此异常，而该协议不受支持。**如果应用程序在未设置 ContentLength 属性的情况下尝试发送数据，**或者当缓冲被禁用且处于保活连接（KeepAlive 属性为真）时 SendChunked 为假，则会发生此异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-05T04:57:55.073

这对我有用：

```
 var request = WebRequest.Create(_url);
    request.PreAuthenticate = true;
    request.Credentials = new NetworkCredential(_userName, _password); 
```

# c++ - VC++ 6中“for循环”的终止条件是否刷新？

> ID：542028
> 
> 赞同：0
> 
> 时间：2009-02-12T16:08:32.113
> 
> 标签：c++, visual-c++, for-loop, visual-c++-6, termination

```
for (int i = 0 ; i < stlVector.size() ; i++)
{ 
    if (i == 10)
    { 
        stlVector.erase(stlVector.begin() + 5 )
    }
} 
```

终止条件部分“stlVector.size()”是否考虑了“stlVector.erase(...)”？换句话说，每次循环迭代都会刷新 stlVector.size() 吗？我现在无法测试它，所以我在这里发布了一个问题。

提前谢谢！

最好的祝福，

正补

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:22:48.023

为了清楚起见，不要从循环刷新任何东西的角度来考虑它。每次检查条件时（在每次循环开始时），都会在 stlVector 变量上调用 size() 方法，并返回向量的当前大小。

erase() 方法减小了向量的大小，所以下次调用 size() 时，返回的值会更小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T16:13:55.707

是的，它确实！

```
stlVector.size () // is called for evey iteration 
```

因此，对于每个循环，您都将重新评估测试“i < stlVector.size ()”！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T16:14:27.030

是的，对每个循环都进行了测试，但有副作用。

for 循环只是一个很好的约定 - for 循环很容易分解为 while 循环：

```
for (int i = 0 ; i < stlVector.size() ; i++)
{ 
    if (i == 10)
    { 
        stlVector.erase(stlVector.begin() + 5 )
    }
} 
```

变成：

```
int i = 0 ;

while(i < stlVector.size())
{ 
    if (i == 10)
    { 
        stlVector.erase(stlVector.begin() + 5 )
    }
    i++;
} 
```

-亚当

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T16:29:05.217

是的，确实如此，但不要这样做！如果要从向量中删除元素，请在另一个循环中执行。在这种情况下，您将删除 i 索引之后的元素：没有任何东西可以保证 stlVector[i+5] 元素存在。如果你从向量中删除第 i 个元素，你的计数就会被破坏，因为你可以在不检查元素的情况下跳转元素。

最安全的方法是将要删除的 stlVector 上的元素的引用存储在另一个向量上，然后在此辅助向量上执行 stlVector.erase(auxVector[i]) 进行迭代。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-13T08:11:31.333

我希望您提供的代码只是“幻想代码”（正如一位评论者所说），以给出您正在尝试做的事情类型的具体示例。

但是以防万一：**您给出的循环将跳过第 12 个元素**（即最初在 中的元素`stlVector[11]`），因为在检查`stlVector[10]`时删除了较早的元素，导致所有后面的元素向前分流一个位置，但您仍然`i`在最后增加的循环。因此，下一次迭代将查看`stlVector[11]`哪个元素实际上是最初在`stlVector[12]`. 要解决此问题，您需要`--i`在调用`erase()`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-14T11:01:53.677

总是重新评估确定！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T16:33:21.213

另外，澄清一下，因为您询问是否“在 VC++ 6 中”以这种方式完成。

“继续条件”在每个版本的 C、C++、C# 和 Java 中的每个循环上重新评估。

如果任何编译器不生成执行此操作的代码，则它已损坏，*必须*避免。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T16:40:25.657

正如其他人所说，是的，每次通过循环都会重新评估条件。这就是为什么一个常见的性能优化是：

```
int saveSize = someExpensiveComputation();

for (int i = 0 ; i < saveSize ; i++)
{ 
    foo(i);
} 
```

其中循环条件的计算成本很高，而不是

```
for (int i = 0 ; i < someExpensiveComputation(); i++)
{ 
    foo(i);
} 
```

在循环中每次迭代都不必要地完成昂贵的计算。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T16:14:49.900

是的，它减小了尺寸。更多信息在[这里](http://www.cplusplus.com/reference/stl/vector/erase.html)

# version-control - 何时使用标签/标签以及何时分支？

> ID：542029
> 
> 赞同：30
> 
> 时间：2009-02-12T16:08:34.283
> 
> 标签：version-control, tfs

使用 TFS，你什么时候标记你的代码，什么时候分支？

TFS 中是否有主线/主干的概念？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-12T18:51:17.417

TFS 中的标签是一种标记文件集合的方式。标签包含一堆文件和文件的版本。这是一种非常低成本的方式来标记哪些文件版本构成构建等。

可以将分支视为 TFS 中不同目录中文件（某个版本）的副本（TFS 知道这是一个分支，并且会记住它是哪个文件和版本的分支）。

正如 Eric Sink 所说，[树枝就像小狗](http://www.ericsink.com/scm/scm_branches.html)。它需要一些照顾和喂养。

就个人而言，我经常标记但很少分支。我为每个构建创建一个标签，但只有当我知道我需要处理历史版本或者我需要与主代码行隔离工作时才会分支。您可以从任何时间点创建一个分支（也可以创建一个标签），这样可以很好地工作，这意味着我们周围没有未使用的分支。

希望有帮助，

马丁。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-12T16:15:14.063

在任何 VCS 中，通常在您想要代码快照时进行标记，以供将来参考。当您想要开发新功能时，您可以分支，而不会干扰当前代码。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-12-07T16:26:27.023

Andrew 声称标记比分支更懒惰。在大多数情况下它实际上更有效，而不是懒惰。标签可以允许用户在任何时间点获取项目，保留为版本或构建更改的文件的历史记录，并在任何时候分支/使用代码，然后合并回主分支。与 Andrew 所说的不同，建议您仅在需要一组以上的二进制文件时才进行分支 - 例如，当 QC 和 Dev 开发同时进行时，或者当您需要对旧版本应用修补程序时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T16:14:26.517

我总是将标签视为懒人的分支。如果您要做的事情如此重要以至于它需要一个完整的源代码标签，那么最好用一个分支来表示这一点，以便与该工作相关的所有任务都在一个有组织的地方，只有受影响的代码。

然而，分支非常强大，值得学习。TFS 不是最好的源代码控制，但也不是最差的。TFS 确实支持树干的概念，所有分支也从该树干发芽。

[我会推荐这是一个阅读最佳实践的好地方](http://vsarbranchingguide.codeplex.com/)——至少就 TFS 而言。

# java - 自定义日期格式 mmm:ss

> ID：542031
> 
> 赞同：2
> 
> 时间：2009-02-12T16:08:36.933
> 
> 标签：java

有没有办法将日期格式化为 mmm:ss 而不是 hh:mm:ss？基本上，7:15:28 应该显示为 435:28。

SimpleDateFormat 类不支持这种格式，有没有我自己必须或必须自己实现一种变体的格式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T16:21:19.027

您必须自己实现它，但您应该记住，实现 Formatter 并不是一项简单的任务，因为它有许多 l10n 考虑因素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T08:13:00.033

如果您只想将 Date 格式化为您指定的格式（不包括 Date 的其他部分），您可以非常简单地做到这一点：

```
 public String format(Date date) {      
      Calendar cal = new GregorianCalendar();
      cal.setTime(date);
      return cal.get(Calendar.HOUR) * 60 + cal.get(Calendar.MINUTE) + ":" + cal.get(Calendar.SECOND);      
   } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T07:46:25.073

您可以使用[Joda Time](http://joda-time.sourceforge.net/)构建自定义格式化程序。使用 DateTimeFormatterBuilder 类，您至少可以显示一天中的分钟数：

```
import org.joda.time.format.DateTimeFormatter;
import org.joda.time.format.DateTimeFormatterBuilder;

DateTimeFormatter customFormat = new DateTimeFormatterBuilder()
      .appendMinuteOfDay(1)
      .appendLiteral(':')
      .appendSecondOfMinute(2)
      .toFormatter();
System.out.println(customFormat.print(System.currentTimeMillis())); 
```

# ruby-on-rails - 您如何将 SSL 与 InstantRails 结合以实现安全的本地开发？

> ID：542033
> 
> 赞同：0
> 
> 时间：2009-02-12T16:08:44.673
> 
> 标签：ruby-on-rails, ssl, windows-vista, paypal

我正在使用 InstantRails（在 Vista 上），我正处于希望将 Rails 应用程序与 PayPal 集成的阶段（通过网络支付标准定期计费 - 不需要 ActiveMerchant）。为我的本地开发/测试目的启用 HTTPS 的最佳分步过程是什么？

我正在使用 InstantRails 附带的默认 Mongrel/Apache 设置。

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T16:47:50.773

使用 openSSL 生成私钥和自签名证书。

这里有很好的说明： [http ://www.akadia.com/services/ssh_test_certificate.html](http://www.akadia.com/services/ssh_test_certificate.html)

OpenSSL HOWTO：[http ://www.openssl.org/docs/HOWTO/certificates.txt](http://www.openssl.org/docs/HOWTO/certificates.txt)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T06:08:13.780

有一个用于 Rails 的插件，也称为 ssl_requirement，您可以使用它来非常轻松地告诉应用程序需要通过 ssl 完成哪些操作。它非常方便，我认为是 DHH 写的。

# php - PHP：file_get_contents($loc) 失败

> ID：542046
> 
> 赞同：13
> 
> 时间：2009-02-12T16:10:49.487
> 
> 标签：php

我刚刚将一个项目从本地主机移动到我的远程服务器，并注意到我的一些脚本停止工作。最重要的是它依赖于`file_get_contents()`从另一个脚本中获取 JSON 值。

PHP 版本为 5.2.4
`allow_url_fopen`已开启

> 警告：：：失败`file_get_contents()` `[function.file-get-contents]`：名称或服务未知`php_network_getaddresses``getaddrinfo``/var/www/html/2009/functions/functions.products.php``line 5`
> 
> 警告：：`file_get_contents(http://data.example.com/new-data.php) [function.file-get-contents]`无法打开流：`Success in /var/www/html/2009/functions/functions.products.php`打开`line 5`

正在运行脚本：`http://www.example.com`
传递给函数的位置是`http://data.example.com/new-data.php`

**注意**：同一个域名，但是两个不同的服务器。

```
function getData() {
  $location = "http://data.mysite.com/new-data.php";
  $contents = file_get_contents($location);
  $jsonVars = json_decode($contents);
  return $jsonVars
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-12T16:39:05.643

> 名称或服务未知

DNS 坏了。你`ping data.mysite.com`能从机器上的一个shell（假设你有一个）？

现在尝试用`data.mysite.com`固定的 IP 地址替换。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-07-12T08:29:04.567

您也可以尝试卷曲：

```
$curl = curl_init();
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_URL, 'http://url.url');
$result = curl_exec($curl);
curl_close($curl); 
```

你得到你想要的`$result`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T16:28:33.797

查看远程服务器上的 /etc/hosts。如果为空，则需要向其添加“127.0.0.1 localhost”。

除非它是环回接口命中外部机器的 VPS 品种之一；在这些上，您需要使用您的 VPS 的 IP 号码而不是 127.0.0.1。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-08-28T12:50:00.003

如果您确定这不是 DNS 问题，请尝试重新启动 Apache。在挠头 20 分钟后，这为我解决了这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T16:22:03.610

请提供更多信息，$contents 是否包含任何内容？如果您希望它作为 php 数组，请记住执行 json_decode($contents, true) ，否则它会返回一个 stdClass。

解析主机名可能有问题吗？data.mysite.com 和 mysite.com 是同一台机器吗？

# visual-studio - 你如何保持 Visual Studio 选项卡的排序

> ID：542047
> 
> 赞同：6
> 
> 时间：2009-02-12T16:10:50.470
> 
> 标签：visual-studio, visual-studio-2008

是否有内置方式或免费插件可以保持打开文件的标签栏按字母顺序排序？排序后，如何让 CTRL-PageUP/DOWN（或其他快捷方式）向左/向右跳转，而不是最近查看最多/最少查看的文件。

谢谢，库尔特

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2018-02-01T18:11:59.787

在 VS 2017 中，使用 Productivity Power Tools 扩展，您可以导航到：

工具 > 选项 > 生产力电动工具 > 自定义文档井

在这里，您将看到“排序”部分，您可以在其中选择“按字母顺序”。

应用新设置后，CTRL + PAGE DOWN（或者在我的情况下，CTRL + ALT + PAGE DOWN）只会在下一个/上一个窗口之间翻转。

--

在 VS 2019 中，他们[无法移植自定义文档井扩展](https://developercommunity.visualstudio.com/idea/465490/update-support-for-custom-document-well-to-visual.html)，因此您必须[投票支持将此功能添加到 Visual Studio](https://developercommunity.visualstudio.com/idea/477172/tab-sorting-in-document-well.html)。

--

我没有 VS 2008，所以我不确定到达这些设置的路径是否完全相同。如果您无法找到它，您应该能够从扩展和更新模块（也位于 TOOLS 下）安装 Productivity Power Tools。

希望有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T16:17:05.043

它并不完美，但关闭当前编辑器选项卡的**X**左侧的向下三角形确实按字母顺序显示所有当前打开的文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:14:46.327

我使用 ReSharper 的“[转到...](http://www.jetbrains.com/resharper/features/navigation_search.html#Go_to_Symbol) ”：

[![转到文件](https://i.stack.imgur.com/j2aok.png)](https://i.stack.imgur.com/j2aok.png)
[（来源：[jetbrains.com](http://www.jetbrains.com/resharper/features/screenshots/40/navigation_gotofile.png)）]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-05-23T08:50:23.020

使用 omagerio 的 VS Studio 扩展“按名称排序选项卡/打开编辑器”。

关闭所有标签。

转到此扩展程序设置并取消选中“按完整路径排序”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T17:43:14.360

我总是将 VS 从选项卡切换到 MDI。使用标签，工作一段时间后，标签栏会变得毫无意义。

我使用 Resharper 和 Ctrl-T 和 CamelCase(CC) 来上课，或者使用简单的老式 Ctrl-Tab。

# theory - NP-完全归约（理论上）

> ID：542053
> 
> 赞同：3
> 
> 时间：2009-02-12T16:11:29.143
> 
> 标签：theory, complexity-theory, np-complete

我想嵌入 3 个 NP-Complete 问题（其中 2 个已知是 NP-Complete，其中 1 个是我自己的想法）。我看到了“[这个问题](https://stackoverflow.com/questions/141779/solving-the-np-complete-problem-in-xkcd)”，并在理论上重新解释了嵌入问题：

*   服务员就是小偷。
*   桌子是商店。
*   食物是具有不同重量的有价值的物品。
*   小偷在抢劫之前知道所有物品的价格和重量。
*   他的目标是最有效的抢劫（使用的背包的最大容量，获得最有价值的物品）抢劫（至少获得 1 件物品）所有商店（完成抢劫之旅的最短路径，也访问每个商店 1 次）。

这部分是嵌入 2 个 NP-Complete 问题。

我的想法是，更多的物品意味着更多的袋子重量。更大的袋子重量会成倍地减慢小偷的速度。所以小偷的另一个目标应该是尽快完成抢劫。

此时，我不确定我的想法是否真的是 NP-Complete。也许，“重力”不仅仅是一个 NP 完全问题。但也许是在旅行推销员和背包问题的背景下。

所以我的问题是：

1.  小偷NP的减速也完全吗？

2.  是否有可能将这三个嵌入式问题简化为一个简单的 NP 完全问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:20:11.103

好的，这*有点*难以理解，但我想我明白了要点。

XKCD 动画片向您展示了使现实生活中的问题成为 NP 完全问题是多么容易。（当然，由于大多数菜单的项目数量较少且价格统一，因此也很容易表明存在一个微不足道的答案。）

我认为您所指的“嵌入”一个NP完全问题的想法是找到一个多时间减少；我已经在SO的其他地方[完全写了。](https://stackoverflow.com/questions/308213/explaining-computational-complexity-theory/309507#309507)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:06:32.647

这有点令人困惑，但这是我对一些可能问题的回答。

两个 NP 完全问题的组合将是 NP 完全的。事实上，一个 NP 完全问题与任何其他问题的组合将是 NP 完全的。

我不知道如何评估重力问题本身是否是 NP 完全的，因为它本身不是。如果点之间的时间取决于距离和背包重量，那么它是 NP 完全的，因为它是旅行推销员问题的一部分。如果没有，那么正确的解决方案是拾取从最轻到最重的物体。

组合问题是两个问题的组合（偷哪些物品，走哪条路线），对我来说，这两个问题看起来并不比这两个问题更有趣，因为你可以解决一个问题而不必担心另一个问题。添加与权重相关的延迟可以将问题耦合在一起，因此它们不是独立的，但是您需要一个评估函数，而不是您可以多快提交最佳盗窃（最佳盗窃是它自己的问题，然后它只是一个修改后的 TSP）。

你也不能解决问题，把它们结合起来，把它们复杂化，然后再做一个更简单的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:18:02.670

老实说，我不知道你在问什么。但您可能会问如何通过将一个问题 NP 完全转换为另一个 NP 完全问题来证明它。

答案是您编写一个在多项式时间内运行的算法，将问题转换为已知的 NP 完全问题，然后编写另一个多项式算法将解决方案转换回来。

有关详细信息，请阅读一本不错的教科书或查看[Wikipedia 页面](http://en.wikipedia.org/wiki/NP-complete)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:29:38.773

感谢有用的评论，卡通给了我一个关于嵌入问题的想法。我写的时候有点着急，所以写错了很多。我的主要语言也不是英语，所以编辑让我的问题更容易理解。我还想要更多的集思广益的评论。

> 查理马丁，感谢您的链接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T18:27:15.090

携带额外重量的成本本身不是问题，而是旅行商问题的边缘权重的参数化。

这个问题的决策版本仍然是 NP 完全的，因为 a）我们仍然可以快速检查给定的游览成本是否小于 k，因此它在 NP 中，并且 b）哈密顿循环仍然减少到我们的 TSP 与携带成本（因为我们只是将所有边权重设置为 1，并将所有携带成本设置为 0）。

换句话说，持有成本只是让我们的 TSP 变得更难，所以它仍然是 NP 难的（并且可以用来解决任何 NP 完全问题），但它并没有让我们无法快速检查提出的解决方案变得足够困难到决策问题：“这次旅行的成本是否低于 c？”，所以它仍然是 NP 完全的。

背包问题的（NP-complete）决策版本是独立的，可以用 TSP 问题顺序求解。

所以整个问题是 NP 完全的，如果我们将 TSP 问题和背包问题归约为 SAT（通常不会在这个方向上进行归约，但理论上是可能的），那么我们可以将两者一起编码为一个 SAT 实例.

# vba - 从函数传递和接收数组

> ID：542062
> 
> 赞同：1
> 
> 时间：2009-02-12T16:12:17.440
> 
> 标签：vba, excel

我在 Excel 中制作了一堆二维数组，并编写了一个函数将相同的数据放入每个数组的副本中。我不太确定我是否得到了正确的语法部分。

该函数称为“填充”，旧数组“旧”和新数组“新”。我使用名称“块”作为变量名称之间的传递。

所以，我的代码中的行是：

```
New = Fill(Block:=Old()) 
```

我的功能的第一行是：

```
Function Fill(Block() As Variant) As Variant 
```

这给了我一个“旧”数组的类型不匹配错误，说它需要一个数组。让我觉得功能没问题，等待正确的类型，但没有收到。

我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:19:02.730

自从我进行 VBA 编程以来已经有一段时间了，但我认为以下内容更有可能是正确的：

```
NewArray = Fill(OldArray)

Function Fill(Block As Variant) As Variant

  Fill = Block

End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T10:53:33.667

这里有一些说明为什么您可能会遇到您所做的错误。如果函数需要特定类型，则必须将变量声明为该类型。

```
Sub FillThis()
'Declare OldArray as Variant '
'because that is what the function '
'requires. '
Dim OldArray As Variant
'Similarly ...'
Dim StringPart As String

    'ByRef, so the variable will be '
    'changed by the function. '
    'Note that ByRef is the default. '
    Fill OldArray

    For i = 0 To 4
      Debug.Print OldArray(i)
    Next

    StringPart = "Part 1"
    GetString StringPart
    Debug.Print StringPart
End Sub

'In this example, Fill is not being returned, '
'so there is no need to declare it as anything '
Function Fill(ByRef OldArray As Variant)
'The Array must be dimensioned '
ReDim OldArray(4)

    For i = 0 To 4
        OldArray(i) = i + 1
    Next

End Function

Function GetString(ByRef StringPart As String)
    StringPart = StringPart & " Add a Bit"
End Function 
```

# css - 使用行高移动边框时的CSS标题？

> ID：542064
> 
> 赞同：1
> 
> 时间：2009-02-12T16:12:43.197
> 
> 标签：css

我正在使用以下 CSS：

```
h2 {
    font-weight: normal;
    border-bottom: 1px solid #DDD;
    font-size: 1.6em;
    font-style: italic;
}

h2 span {
    position: absolute;
    top: 7px;
    padding-right: 6px;
    background-color: #F9F9EE;
} 
```

像这样使用时：

```
<h2><span>abc</span></h2> 
```

产生以下效果：

```
abc ------------------ 
```

文本“abc”是标题内容，而虚线是正在移动的边框。只要您只在页面上使用一次，以下方法就可以很好地工作。我的问题是，我怎样才能在不使用绝对定位甚至线高的情况下达到相同的效果，因为我怀疑其中一个或两个都是罪魁祸首。

我确实记得在一些博客上看到过相同的效果，但网址让我忘记了。

谢谢你。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:06:29.090

正如 Rory 所提到的，在 H2 标签上使用相对位置可以在不使用图像的情况下解决问题。

```
h2 {
    font-weight: normal;
    border-bottom: 1px solid #DDD;
    font-size: 1.6em;
    font-style: italic;
    position:relative;
}

h2 span {
    position: absolute;
    top: -0.8em;
    padding-right: 6px;
    background-color: #F9F9EE;
} 
```

这适用于我用于测试的三种浏览器（IE、Firefox 和 Chrome）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:19:58.327

我不完全确定您要做什么以及问题到底是什么，但是添加`position: relative;`到 h2 样式将创建一个定位容器，跨度`position: absolute;`将在其中计算其值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T22:25:32.113

尝试这个：

```
h2 {
  font-weight: normal;
  border-bottom: 1px solid #DDD;
  font-size: 1.6em;
  height: 0.75em;
  margin-bottom: 1.85em;
  overflow: visible;
  font-style: italic;
}

h2 span {
  padding-right: 6px;
  background-color: #F9F9EE;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:52:14.660

我没有看到你在 Firefox 中描述的效果，只有在 IE6 中。

实现此效果的一种方法是使用单像素背景图像，在 div 高度的 50% 处水平平铺。它不是那么好，因为您必须使用图像，但它应该看起来像您想要的那样，而不会影响 HTML。

我建议像：

```
h2 {
    font-weight: normal;
    font-size: 1.6em;
    font-style: italic;
    background: url(pixel.png) repeat-x 0% 50%;
}

h2 span {
    padding-right: 6px;
    background-color: #F9F9EE;
} 
```

我已经在 IE6 和 Firefox 中检查过它，在同一页面上多次使用它。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T17:06:12.240

我最喜欢的方法是：

```
<fieldset class="blah">
    <legend>Heading</legend>
content...
</fieldset> 
```

然后添加

```
fieldset.blah {border-top: 1px solid #999;} 
```

在你的 CSS 中。希望有帮助。

# svn - 从 SVN 存储库中删除文件而不删除本地副本

> ID：542065
> 
> 赞同：219
> 
> 时间：2009-02-12T16:12:59.623
> 
> 标签：svn, tortoisesvn

如何在不从我的文件系统中删除它的情况下“删除”已经在 SVN 存储库中的文件？

欢迎使用 TortoiseSVN 或命令行说明。

以下工作，但我希望有更好的东西：

1.  将文件复制到存储库之外的其他位置。
2.  SVN 删除文件。
3.  犯罪
4.  将文件复制回来，并确保在以后的提交中忽略它们。

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2009-02-12T16:18:39.330

```
svn delete --keep-local the_file 
```

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2009-02-12T16:19:09.717

[删除文件和文件夹](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-rename.html#tsvn-dug-rename-delete)

> 如果要从存储库中删除项目，但将其作为未版本控制的文件/文件夹保留在本地，请使用扩展上下文菜单 → 删除（保留本地）。右键单击资源管理器列表窗格（右窗格）中的项目时，您必须按住 Shift 键才能在扩展的上下文菜单中看到它。

**完全删除：**
鼠标右键→菜单→删除

**删除并保留本地：**
Shift + 鼠标右键单击 → 菜单 → 删除

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2009-02-12T16:19:02.447

在 TortoiseSVN 中，您还可以`Shift`+ 右键单击​​以获取包含“删除（保留本地）”的菜单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T16:44:01.983

重命名您的文件，提交包括“已删除”文件在内的更改，并且不包括新的（重命名的）文件。

重命名您的文件。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-03-06T11:47:54.700

当你想从 SVN 中删除一个 xxx.java 文件时：

1.  转到文件所在的工作区路径。
2.  从文件夹中删除该文件 (xxx.java)
3.  右键单击并提交，然后将打开一个窗口。
4.  从文件夹中选择您删除的文件（xxx.java），然后再次右键单击并删除..它将从SVN中删除该文件。

# .net - 扫描正在运行的 .NET 应用程序以获取字符串值

> ID：542084
> 
> 赞同：1
> 
> 时间：2009-02-12T16:15:57.963
> 
> 标签：.net, debugging

我必须调试一个庞大的程序，我想知道是否有办法扫描正在运行的 .NET 应用程序的内存占用，并找到一个设置为特定值的字符串属性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:24:05.197

您可以使用 Red Gate 的 Ants Profiler 之类的工具。我用过几次，效果还不错。但实际上任何内存分析器都可能会告诉你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T09:33:07.970

您可以使用一些内存分析器来拍摄内存快照。快照包括收集快照时有关 .NET 实例分配和活动实例的数据。

使用 Ants Profiler、Jetbrains dotTrace profiler [http://www.jetbrains.com/profiler/](http://www.jetbrains.com/profiler/)或 Memprofiler [http://www.memprofiler.com/](http://www.memprofiler.com/)

# architecture - javaEE 应用程序布局

> ID：542098
> 
> 赞同：1
> 
> 时间：2009-02-12T16:18:12.870
> 
> 标签：architecture, jakarta-ee

我的任务是在 javaEE 中编写一个新的 webapp，这对我来说是第一次。我对 java 语言很熟悉，但我以前的所有项目都在 .net 中。所以我已经下载了 netbeans，我可能会使用 Hibernate，然后开始深入研究。我的问题是，布置 javaEE 应用程序的最佳方式是什么？所有数据访问都应该通过netbeans吗？有人告诉我尽可能多地使用 Web 服务，以便将数据拉入和拉出系统很容易，并且与 javaEE 企业应用程序相比，我已经阅读了在单独的 Web 应用程序中创建 Web 服务的教程。这真的是它应该工作的方式吗？与我在 .net 中习惯的相比，只是想把我的头绕在这个问题上。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T16:51:22.293

我建议看看[Maven](http://maven.apache.org)。Maven 具有原型的概念，可以帮助您布局和构建示例项目。例如，如果您正在构建一个 EAR 文件，则有一个[用于设置 EAR 的原型](http://maven.apache.org/plugins/maven-archetype-plugin/examples/site.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-12-12T08:32:58.190

我建议您查看以下解决方案：

1.  [AppFuse 是一个用于在 JVM 上构建 Web 应用程序的全栈框架](https://github.com/appfuse/appfuse)
2.  [弹簧保险丝](http://www.jaxio.com/en/celerio.html)
3.  [使用 Maven 3 设置 JAVA EE 7 项目](http://www.adam-bien.com/roller/abien/entry/setting_up_java_ee_7)

# sharepoint - 是否可以从 Excel 工作表填充 SharePoint 列表？

> ID：542108
> 
> 赞同：5
> 
> 时间：2009-02-12T16:20:09.497
> 
> 标签：sharepoint, list

因此，您可以将列表导出到电子表格，但您可以反其道而行之吗？最好来自 Excel 工作表。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T16:27:06.673

转到 sharepoint 和 upder 自定义列表中的创建菜单，单击导入电子表格。键入列表的名称，浏览到电子表格并单击导入。

您还可以通过在电子表格上制作列表然后将其发布到 sharepoint 来持续同步电子表格和列表。

1.  打开你的工作表
2.  选择您的数据
3.  点击 Ctrl+l
4.  点击确定
5.  右键列表
6.  发布列表
7.  类型共享点站点的名称
8.  共享点列表的名称
9.  点击完成

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:26:37.173

是的，您可以从 Excel 2003 执行此操作 :( 有点限制。有[一种解决方法](http://msdn.microsoft.com/en-us/library/bb462636(office.11).aspx)可以从 Excel 2007 执行相同操作...

但是，为了获得最佳结果，您应该使用 Access 2007，因为它为您提供了所需的一切。它允许您执行与 Web 界面相同的操作。

# java - JSP - 保存集合

> ID：542110
> 
> 赞同：1
> 
> 时间：2009-02-12T16:20:37.390
> 
> 标签：java, jsp, struts, jstl

[警告] 我是 JSP/Struts/JSTL 的新手。这可能是一个新手问题:)

我有一个包含集合的表单：

```
public class ServiceForm extends AbstractForm
{   
    private List<SrvDO> allSrv = new ArrayList<SrvDO> ();  
} 
```

我可以使用 JSP 在我的表单中正确查看对象数据。该页面显示 5 个输入框，其中包含正确来自数据库的数据：

```
<c:forEach items="${serviceForm.allSrv}" var="srv">                     
    <html:text name="srv" property="nbDays"/>   
 </c:forEach>   

<html:submit/> 
```

但是当我按下提交按钮时，表单不包含“nbDays”的更新数据。我仍然看到与更新前相同的数据。我错过了对 struts 说的什么：对于每个 srv，更新“nbDays”数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T18:18:24.953

[在春季论坛](http://forum.springframework.org/showthread.php?t=54509)上找到了答案：

> 您的 form:input 标签不知道也不应该知道它在另一个标签中使用的事实。这就是为什么您需要包含索引。

所以解决方案是：

```
<html:text property="allSrv[${srvSta.index}].nbDays"/> 
```

# version-control - 您是否为特定的发布/路径或分支创建标签/标签？

> ID：542111
> 
> 赞同：0
> 
> 时间：2009-02-12T16:21:07.590
> 
> 标签：version-control, branch

如果您有产品的 1.0 版本，或者说 1.1 甚至是补丁，您会创建标签/标签还是分支？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:24:26.383

Eric Sink 写了一系列关于版本控制的来龙去脉的精彩[文章。](http://www.ericsink.com/scm/source_control.html)我建议使用这些作为起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:28:51.177

取决于版本控制系统。我会分支不兼容（主要版本号）更改，并标记兼容（次要版本号）更改。这导致了关于什么是兼容的，什么是不兼容的整个讨论，虽然......

或者，只需使用 Subversion，您通常会在其中使用“svn copy”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:40:54.953

我通常不分支，但只标记版本。这样，我可以稍后在需要时进行分支。由于 CVS 中的分支非常昂贵，因此在您真正需要它们之前尽量避免使用它们。对于所有其他 VCS 工具，分支非常便宜，您可以根据需要进行操作，因此也不需要过早的操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T22:57:50.307

这在一定程度上取决于您使用的工具（版本控制系统），如果它具有健全的分支和标记。

在[Git](http://git-scm.com)中，我会使用诸如`v1.0`,之类的标签`v1.1`来指向*确切的*版本（标签不会改变），因此如果有人告诉您 1.0 版中存在错误，您就会确切地知道它包含什么。如果需要长期维护，我会使用`maint-1.0`和之类的分支`maint-1.1`来收集过去版本的维护错误修复，并不时标记新的次要版本，例如`v1.0.1`, 或`v1.1.5`.

高温高压

# wpf - WPF绑定到不变的属性

> ID：542124
> 
> 赞同：3
> 
> 时间：2009-02-12T16:24:23.963
> 
> 标签：wpf, data-binding, mvvm

我正在使用 MVVM 模式，并且我有一个带有 Start Date 属性的 POCO（在我的模型中）。

我想在 WPF 窗口/用户控件上的控件中显示自开始日期以来经过的时间...

我看不到如何将 ModelView 属性绑定到 UI 控件并让它自动更新此持续时间...有人可以建议一种方法吗？

我可以使用某些东西（计时器或线程）来更新我的 ModelView 上的持续时间属性，但我只是看不到任何其他方式，因为据我了解，UI 只会在属性值更改时更新。但是，我的 POCO 上的开始日期并没有改变，只是经过的时间在改变，这是一个计算值。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:59:22.257

你在正确的轨道上。查看Martin Fowler 页面上 的[演示模型模式。](http://martinfowler.com/eaaDev/PresentationModel.html)

基本思想是为 UI 构建一个模型（ViewModel）并让 UI 与之同步。要在 UI 中显示的每一位信息，都应该在 ViewModel 中具有相应的字段或属性（尽管它们可能是从模型中的值检索或派生的）.. ViewModel 使存储视图状态/会话状态变得容易（例如当前在一个UserList 中选择的项目）这在Model 类后面是不存在的。

由于您想在 UI 中显示“经过的时间”值，因此您的 ViewModel 应该有一个名为 ElapsedTimeSince 的属性。您的 WPF 视图有一个数据绑定到此属性的控件。现在根据您的需要，确保您有一个线程/计时器事件，该事件使用当前时间和模型的 StartDate 属性定期重新评估属性值。您的 UI 应反映更新后的值。

# java - 更有效地从 Jar 中提取文件

> ID：542127
> 
> 赞同：2
> 
> 时间：2009-02-12T16:24:28.143
> 
> 标签：java, jar, compression, zip

我正在扩展一个实用程序类，它捆绑了一组图像和 .xml 描述文件。目前我将所有文件保存在一个目录中并从那里加载它们。该目录如下所示：

```
8.png
8.xml
9.png
9.xml
10.png
10.xml
...
...
50.png
50.xml
... 
```

这是我当前的构造函数。它快如闪电，可以完成我需要它做的事情。（我已经删除了一些错误检查以使其更易于阅读）：

```
public DivineFont(String directory ) {

    File dir = new File(directory);

    //children is an array that looks like this: '10.fnt', '11.fnt', etc.
    String[] children = dir.list(fntFileFilter);

    fonts = new Hashtable<Integer, AngelCodeFont>(100);

    AngelCodeFont buffer;
    int number;
            String fntFile;
            String imgFile;

    for(int k = 0; k < children.length; k++ ) {
        number = Integer.parseInt( children[k].split("\\.")[0] );
        fntFile = directory + File.separator + number + ".xml";
        imgFile = directory + File.separator + number + ".png";
        buffer = new AngelCodeFont(fntFile, imgFile);

        fonts.put(number, buffer);
    }
} 
```

为了 webstart 和清洁，我一直在尝试从 Jar 加载这些资源。我已经让它工作了，但是加载时间从瞬间变成了几秒钟，这是不可接受的。这是我尝试过的代码（再次，错误检查被剥离）：

（这不是做我想做的事情的*最好*方法，它是一个模型，看看这个想法是否有效。它没有。两个 for 循环绝不是问题的根源；它是创建所有那些减慢它的 InputStreams 的过程）

```
public DivineFont(String jarFileName ) {

    JarFile jarfile = new JarFile(jarFileName);
    Enumeration<JarEntry> em = jarfile.entries();
    ArrayList<Integer> fontHeights = new ArrayList<Integer>(100);
    for (Enumeration em1 = jarfile.entries(); em1.hasMoreElements(); ) {
        String fileName = em1.nextElement().toString();
        if( fileName.endsWith(".fnt") ) {
            fontHeights.add( Integer.parseInt(fileName.split("\\.")[0] ) );
        }
    }

    fonts = new Hashtable<Integer, AngelCodeFont>(100);

    AngelCodeFont buffer;
    int number;

    for(int k = 0; k < fontHeights.size(); k++ ) {
        number = fontHeights.get(k);
        InputStream fntFileStream = jarfile.getInputStream(jarfile.getEntry(number + ".xml"));
        InputStream pngFileStream = jarfile.getInputStream(jarfile.getEntry(number + ".png"));
        buffer = new AngelCodeFont(String.valueOf(number), fntFileStream, pngFileStream );

        fonts.put(number, buffer);

    }
} 
```

除了我在这里尝试过的方式之外，任何人都知道使用 .jar 文件的更好方法吗？这是[AngelCodeFont API](http://slick.cokeandcode.com/javadoc/org/newdawn/slick/AngelCodeFont.html)。如果绝对有必要，我可以为此提交一个补丁，但我宁愿不必这样做。在我看来，可能有一种方法可以做我想做的事，我只是不熟悉它。

我并不是非常反对快速将 jar 转储到临时目录然后从那里读取文件，但是如果有办法直接从 jar 中快速读取，我宁愿这样做。

另外：压缩根本不是问题。我使用罐​​子的唯一原因是包装问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T16:33:05.427

*打开*JAR 是一项非常昂贵的操作。因此，您可能希望打开 JAR 一次并将`JarFile`实例保存在某个静态字段中。在您的情况下，您还需要读取所有条目并将它们保存在哈希图中，以便即时访问所需的资源。

另一种解决方案是将 JAR 放在类路径中并使用

```
DivineFont.class.getContextClassLoader().getResource*("/8.png"); 
```

注意“/”！如果省略它，Java 将在找到文件 DivineFont.class 的同一目录（包）中搜索。

从类路径获取东西在 Java 中已经被优化到死。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-14T19:06:07.617

嗯，我找到了答案。我最初的问题的答案是“错误的问题”。Jar 文件不是问题，它是我用来加载图像的库。

当我从文件系统加载时，图像被命名为“38.png”等。当我从 Jar 加载时，我只是将其命名为“38”。

库中的图像加载器类使用名称的文件扩展名来标识要使用的图像加载器。如果没有文件扩展名，它会使用较慢的基本图像加载器。当我改变这一行时：

```
buffer = new AngelCodeFont(String.valueOf(number), fntFileStream, pngFileStream ); 
```

到这一行：

```
buffer = new AngelCodeFont( number + ".png", fntFileStream, pngFileStream ); 
```

我们有自己的赢家。

无论如何，感谢您的帮助。我花了几个小时才弄清楚这一点，但如果不是因为您的帖子，我可能会继续认为责任在于 Java 而不是我正在使用的库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:30:44.537

Jar 文件操作可能非常昂贵，Java 类库已经实现了这种资源加载（可能尽可能高效。）

另外，一旦你在 webstart 中，你的 jar 文件名会被弄乱，所以你最终可能不得不探索类路径上的每个 jar 文件来加载你的资源（我已经做到了！丑陋！）

相反，请使用[Class.getResourceAsStream(String resourceName)](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String))。我没有对其进行分析，但我没有注意到它明显比直接文件访问慢。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-12T16:30:49.847

[这个库](http://www.quicklz.com/)可能不会像你需要的那样压缩，但它会更快......

# c# - 使用 Moq 模拟 HttpContext Response.Output

> ID：542132
> 
> 赞同：8
> 
> 时间：2009-02-12T16:25:46.830
> 
> 标签：c#, asp.net-mvc, mocking, moq, httpcontext

我一直在使用[Hanselman 博客](http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx)中的 MvcMockHelpers 类来传递一个模拟的 HttpContext。我们对其进行了一些扩展，以添加一些我们需要的身份验证数据，并且在大多数情况下，这非常棒。

我们遇到的问题是我们提供给控制器的上下文在 HttpContext.Response.Output 中有一个空值，这会导致一些异常被抛出。我不确定要添加什么才能使其正常工作。

这是现有的 FakeHttpConext() 方法：

```
public static HttpContextBase FakeHttpContext()
{
    var context = new Mock<HttpContextBase>();
    var request = new Mock<HttpRequestBase>();
    var response = new Mock<HttpResponseBase>();
    var session = new Mock<HttpSessionStateBase>();
    var server = new Mock<HttpServerUtilityBase>();

    // Our identity additions ...
    var user = new Mock<IPrincipal>();
    OurIdentity identity = (OurIdentity)Thread.CurrentPrincipal.Identity;

    context.Expect(ctx => ctx.Request).Returns(request.Object);
    context.Expect(ctx => ctx.Response).Returns(response.Object);
    context.Expect(ctx => ctx.Session).Returns(session.Object);
    context.Expect(ctx => ctx.Server).Returns(server.Object);
    context.Expect(ctx => ctx.User).Returns(user.Object);
    context.Expect(ctx => ctx.User.Identity).Returns(identity);
    return context.Object;
} 
```

这是爆炸方法（它是 MVC Contrib 项目的 XmlResult 的一部分）：

```
public override void ExecuteResult(ControllerContext context)
{
    if (_objectToSerialize != null)
    {
       var xs = new XmlSerializer(_objectToSerialize.GetType());
       context.HttpContext.Response.ContentType = "text/xml";
       xs.Serialize(context.HttpContext.Response.Output, _objectToSerialize);
    }
} 
```

当引用 context.HttpContext.Response.Output 时，我需要在 FakeHttpContext 方法中添加什么来防止出现 null 异常？

**澄清：我正在寻找的解决方案需要在 Moq 中完成，而不是 Rhino。**我在问题标题中提到了起订量，但在问题正文中忽略了这一点。很抱歉有任何混淆。

**解决** 方法 我在 FakeHttpContext() 方法中添加了以下两行代码：

```
var writer = new StringWriter();
context.Expect(ctx => ctx.Response.Output).Returns(writer); 
```

这可以防止空异常。不确定它是否是一个长期的好答案，但它现在有效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T18:22:30.093

在[MvcContrib](https://archive.codeplex.com/?p=mvccontrib)的测试中，文件 MvcMockHelps 显示了它是如何完成的。

# reporting-services - Reporting Services 使用的 CPU 不会超过 25%

> ID：542148
> 
> 赞同：2
> 
> 时间：2009-02-12T16:27:28.560
> 
> 标签：reporting-services

我已经建立了一个创建快速 PDF 报告的解决方案。目前，我似乎无法让 Reporting Services 使用它可用的所有资源。系统似乎不受 IO 限制、CPU 限制或内存限制。关于试图弄清楚它为什么会这样运行的任何建议？

该应用程序不受网络 IO 限制，它是多线程的，处理器数量是 2 倍。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T14:27:55.310

SQL Server Reporting Services 将同时运行的报告数量限制为 2 个临时报告和 2 个同时 Web 报告。这是服务器强加的硬限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T16:31:39.220

这是不使用多线程方法的情况吗？机器是否 100% 使用处理器的一个核心，这就是瓶颈？

编辑：很抱歉，在您提到它已经是多线程之前，这只是一个想法。恐怕我无法提供更多建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:38:15.693

Robin Day 可能是对的，但是如果您使用支持超线程的处理器，您*可以*通过在 BIOS 中关闭它来获得性能优势。您可以尝试 A/B 性能测试。

您还可以检查 SQL 实例（当您说报告服务时，您的意思是 SSRS 对吗？）没有设置处理器关联。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:50:53.540

> 关于试图弄清楚它为什么会这样运行的任何建议？

a) 有一个 API 可以将整个进程限制在一个 CPU 上：使用`GetProcessAffinityMask`.

b）“线程状态”和“线程等待原因”是两个性能计数器……也许您可以阅读本文以了解为什么我们认为应该运行的线程不是。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T16:53:31.663

应用程序的所有线程都在争夺一个锁。使用分析器查看某处是否存在拥塞。

如果您有四个内核，那就可以解释为什么您会看到 25% 的整体 CPU 使用率。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-12T16:31:27.253

也许服务器无法通过网络传递更多数据（所以它是网络 IO 绑定的）？

# wireshark - wireshark：仅捕获数据层

> ID：542149
> 
> 赞同：2
> 
> 时间：2009-02-12T16:27:35.237
> 
> 标签：wireshark, encryption

有没有办法只捕获数据层而忽略wireshark中的上层？如果没有，是否有不同的数据包转储实用程序可以做到这一点？每个数据包最好有 1 个文件！

我在找什么：一个只将数据（有效负载）层转储到文件的实用程序。

这是与编程相关的......！我真正想做的是比较所有数据报，以便开始了解第三方编码/协议。理想情况下，最好的是一个比较多个文件的十六进制比较实用程序！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:43:57.210

您应该尝试右键单击数据包并选择“Follow TCP Stream”。然后您可以将 TCP 通信保存到原始文件中以供进一步处理。这样你就不会得到所有的 TCP/IP 协议垃圾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T16:35:53.657

Wireshark 中有一个限制捕获大小的功能，但似乎 68bytes 是最小值。有一些选项可以在一定数量的千字节、兆字节、千兆字节后启动新文件，但最小的也是 1 千字节，所以可能没用。

我建议查看 pcap 库并自己滚动。我过去使用 PERL Net::Pcap 库完成了这项工作，但也可以轻松地用其他语言完成。

如果你有 Unix/Linux 可用，你也可以看看 tcpdump。您可以使用 -s 限制捕获的数据量。例如，“-s 14”通常会为您提供以太网标头，我认为这就是您所说的数据链路层的意思。还有一些选项可以通过使用 -C 指定文件大小来控制创建文件的频率。所以理论上如果你将文件大小设置为捕获大小，每个数据包你会得到一个文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-15T18:33:32.530

使用`tshark`我只能通过解码为 telnet 并打印字段 telnet.data 来打印数据

```
tshark -r file.pcap -d tcp.port==80,telnet -T fields -e telnet.data

GET /test.js HTTP/1.1\x0d\x0a,User-Agent: curl/7.35.0\x0d\x0a,Host: 127.0.0.1\x0d\x0a,Accept: */*\x0d\x0a,\x0d\x0a

HTTP/1.1 404 Not Found\x0d\x0a,Server: nginx/1.4.6 (Ubuntu)\x0d\x0a,Date: Fri, 15 Jan 2016 11:32:58 GMT\x0d\x0a,Content-Type: text/html\x0d\x0a,Content-Length: 177\x0d\x0a,Connection: keep-alive\x0d\x0a,\x0d\x0a,<html>\x0d\x0a,<head><title>404 Not Found</title></head>\x0d\x0a,<body bgcolor=\"white\">\x0d\x0a,<center><h1>404 Not Found</h1></center>\x0d\x0a,<hr><center>nginx/1.4.6 (Ubuntu)</center>\x0d\x0a,</body>\x0d\x0a,</html>\x0d\x0a 
```

不完美，但它足以满足我的需要，我希望它可以帮助一些人。

# sql - Moving a SQL 2000 cube to SQL 2005

> ID：542163
> 
> 赞同：0
> 
> 时间：2009-02-12T16:30:44.493
> 
> 标签：sql, data-warehouse, cubes

I have been tasked with moving a cube which is in SQL 2000 to SQL 2005\. It would appear that the Dimensions and Measures are all coming from one table. Is this possible in SQL 2005 or do I need to restructure the data into multiple Dim/Fact tables, and is there any way to easily move a SQL 2000 cube into SQL 2005?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T14:03:36.260

There is such a thing as a fact-dimension in SSAS 2005\. My guess is you would not need to restructure the data in order to migrate the cube. There is a migration wizard in SSMS that will migrate SSAS 2000 cubes over to SSAS 2005.

# asp.net - 使用 GridView HyperLinkField 设置 CategoryID

> ID：542166
> 
> 赞同：2
> 
> 时间：2009-02-12T16:31:29.017
> 
> 标签：asp.net, database, gridview, hyperlink

我正在使用asp.net，并且正在使用gridview。我将 GridView 中的一个字段设置为表示类别名称的 HyperLinkField。我从数据库中提取名称和 ID，但我永远无法确定它们是什么，因为它们是单独添加的。我希望能够通过查询字符串将更改的 CategoryId 传递到另一个页面。如何使用 GridView 执行此操作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:49:10.970

在您的超链接字段中，将 DataNavigateUrlFields 设置为您的 ID 列，并将 DataNavigateUrlFormatString 设置为要导航到的 Url（其中 {0} 将替换为 ID）

```
<asp:HyperLinkField 
    DataNavigateUrlFields="ID" 
    DataNavigateUrlFormatString="Target.aspx?ID={0}"
    DataTextField="Name" 
    Target="_blank">
</asp:HyperLinkField> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-12T16:43:32.357

您可以使用 a`<asp:TemplateField />`作为列之一而不是 a`<asp:BoundField />`

代码示例：

```
<asp:TemplateField HeaderText="Name">
    <ItemTemplate>
       <a href="/new_page?categoryId=<%#Container.DataItem("id")"><%#Container.DataItem("name")</a>
    </ItemTemplate>
</asp:TemplateField> 
```

可能有一种更简洁的方法来执行此操作，而不是使用锚元素，但您应该明白这一点。

# tfs - 在 TFS 中，一旦我有了构建定义设置，如何修改任务列表等？

> ID：542173
> 
> 赞同：0
> 
> 时间：2009-02-12T16:32:40.903
> 
> 标签：tfs, msbuild

我设置了我的构建定义，在使用 Team Explorer GUI 设置我的构建时，我所做的就是这些吗？

看来我现在唯一要做的就是编辑 msbuild .proj 文件？

是否有用于此的 GUI 或从此处进行的所有手动编辑？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T16:49:25.823

目前 Visual Studio 中没有 MSBuild 编辑器，但我读到 Visual Studio Team System 2010 中会有一个（一个基于 Workflow Foundation 渲染器）。

如果你真的想要一个 GUI，你可以试试[Microsoft Build Sidekick v2](http://www.attrice.info/msbuild/)，但它不是免费的（55 美元）而且在我看来不是很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T21:53:13.057

在 TFS 2008 中，一些关于构建的信息可以通过 GUI 进行编辑，但不多。如果您右键单击构建定义并选择编辑构建定义，您可以更改工作区映射、保留策略、放置位置和触发器。要更改任何其他内容，您需要编辑 .proj 文件。

你想做什么？如果你问一个具体的问题，你可能会得到有趣的答案。

# wcf - netstat 说 443 已打开，但我无法使用 telnet 连接到它.. 为什么？

> ID：542178
> 
> 赞同：5
> 
> 时间：2009-02-12T16:33:50.150
> 
> 标签：wcf, tcp, ssh, windows-server-2003, telnet

我已经构建了一个自托管的 wcf 服务器，使用`wsHttpBinding`. 我正在运行 Win 2003 服务器 R2 SP2。

如果我将其配置为监听`http://localhost:443/MyService`，一切正常。我可以`http://localhost:443/MyService`使用 Internet Explorer 连接，并收到标准的“错误请求”消息

现在，如果我尝试切换到 HTTPS，我会看到一个奇怪的现象。

这是我所做的：

1.  我已经将我的 wcf 配置文件从`http://localhost`to`https://localhost`和 from`Security=None`更改为`Security=Transport`（如许多 wcf 教程中所述）
2.  我已经像这样注册了我的 HTTP 端口：

    ```
    httpcfg delete ssl -i 0.0.0.0:443

    httpcfg set ssl -i 0.0.0.0:443 -h ea2e450ef9d4... 
    ```

请注意，我使用的证书是“真实证书”（即由受信任的 CA 颁发，即 Comodo）。服务器响应证书中提到的 NS 上的 ping。

现在，以下将超时：

```
Microsoft Telnet> open localhost 443 
```

这是`netstat`（Pid '4' 是 'System' 进程）的输出：

```
netstat -nao

  Proto  Local Adress         Remote Adress          State           Pid
  TCP    0.0.0.0:443          0.0.0.0:0              Listening       4 
```

这是我在 telnet 中发出 open 命令时捕获的[TCPView的屏幕截图：](http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx)

[替代文字 http://img26.imageshack.us/img26/3376/tcpview2si6.jpg](http://img26.imageshack.us/img26/3376/tcpview2si6.jpg)

我有点疑惑。对我来说，如果`netstat`说服务器正在监听 443，那么到 443 的 telnet 连接不应该超时，而且我应该至少有一个空白提示，希望我输入一些加密的东西 :)

到目前为止，我已经尝试过：

1.  完全按照 MSDN 教程从头开始重做所有步骤
2.  使用端口 10443 而不是 443
3.  禁用防火墙
4.  使用自签名证书

我不知道接下来要尝试什么..有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:53:17.593

telnet 客户端不会知道发送正确构造的请求来启动 https 握手，所以我想 ssl 安全服务器只是在等待更多数据。

telnet 客户端当然不会知道如何处理来自 ssl 安全服务器的响应（它肯定不会提示您发送数据）。只有在 https 握手完成后才能进行通信。

您需要使用知道如何握手的客户端。[openssl 二进制文件可以开箱即用。](http://www.utahsysadmin.com/2007/11/08/testing-httphttps-through-telnetopenssl/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:37:05.540

Telnet 不能用于与加密网络通信。

查看此[microsfot](http://support.microsoft.com/kb/279466)说明。它说*“注意：此示例假定 Web 服务器配置为使用默认 HTTP 端口 (TCP 80)。如果 Web 服务器正在侦听不同的端口，请在示例的第一行替换该端口号。此外，此示例无法通过 HTTPS/SSL 连接（默认情况下为 TCP 443）正常工作，因为 telnet 客户端无法协商建立 SSL 会话所需的加密命令。虽然可以通过 HTTPS/SSL 端口进行初始连接，但没有发出 GET 请求时返回数据。”*

更新：查看此其他说明*[如何：确定 SSL 连接是否在 Web 服务器或中间设备上不起作用](http://support.microsoft.com/?scid=kb%3Ben-us%3B290051&x=8&y=11)*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:53:01.820

正如 FerrariB 所说，telnet 不执行打开 SSL 连接所需的协商。Telnet 对证书和加密一无所知。因此，您可以保证无法通过 telnet 与 HTTPS 端口 443 进行通信。你将不得不找到另一种方法来做你想做的任何事情。

例如，查看有关[TLS](http://en.wikipedia.org/wiki/Transport_Layer_Security#How_it_works)的 Wikipedia 页面，其中直接显示：

> 如果上述任一步骤失败，则 TLS 握手失败，并且不会创建连接。

这正是您尝试使用 telnet 与 SSL 端点通信时所看到的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-07T12:55:03.153

1.  在命令提示符下：`netstat -nao |find "443"` 最后一列显示一个数字： [pic no.1](https://i.stack.imgur.com/wbsRW.png)

2.  现在在 pid 列的第 1 部分打开 task manager.find 结果编号（如果未启用 pid，请从视图选项卡中选择它）程序名称显示使用该端口的程序。

3.  禁用使用端口的程序/在我的情况下，我从服务中停止了它

# mfc - MFC - How can I disable a list item?

> ID：542185
> 
> 赞同：2
> 
> 时间：2009-02-12T16:36:09.740
> 
> 标签：mfc, clistctrl

I have a CListCtrl with checkboxes. I want to be able to disable one of the items so that the user cannot click the checkbox. Is this possible? If so, how?

**Edit:** Found the specifics on how to hide a checkbox in another question [Need only some rows in a CListCtrl control to have check boxes](https://stackoverflow.com/questions/190667)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:47:58.230

Shortly: Not easily possible.

You'll need to sub-class the `CListCtrl` and implement this behavior on your own or download for example the [MFC Grid Control](http://www.codeguru.com/Cpp/controls/controls/gridcontrol/article.php/c2179) that allows you to do that.

As for the removing check-boxes idea, yes, that might be possible, MSDN:

> Version 4.70\. Enables check boxes for items in a list-view control. When set to this style, the control creates and sets a state image list with two images using DrawFrameControl. State image 1 is the unchecked box, and state image 2 is the checked box. **Setting the state image to zero** **removes the check box.**

# postgresql - 当我按下 Home 键簇中的任何键时，为什么 psql 会插入波浪号？

> ID：542186
> 
> 赞同：3
> 
> 时间：2009-02-12T16:36:19.007
> 
> 标签：postgresql, keymapping, tilde

我在 FreeBSD 上使用**psql 8.2.3 。**每次我按**Insert**、**Home**、**Delete**、**End**、**Page Up**或**Page Down**时，都会插入一个波浪号 ( `~`) 字符，而不是执行键的预期功能。为什么会发生这种情况，我该如何解决？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:38:32.397

正如[Endlessdeath 的回答](https://stackoverflow.com/questions/542186/why-is-psql-inserting-a-tilde-when-i-press-any-of-the-keys-in-the-home-key-cluste/542350#542350)中提到的，这原来是操作系统（**FreeBSD**）的键映射问题，*而不是* **psql**。您可以通过为`inputrc`.

您可以使用以下内容在您的主目录中创建一个名为的文件`.inputrc`：

```
set meta-flag on
set input-meta on
set convert-meta off
set output-meta on

"\e[1~": beginning-of-line
"\e[4~": end-of-line
"\e[5~": beginning-of-history
"\e[6~": end-of-history
"\e[3~": delete-char
"\e[2~": quoted-insert
"\e[5C": forward-word
"\e[5D": backward-word 
```

或者，您可以为所有用户创建一个全局文件。一个常见的做法是在与上面相同的行中创建或添加文件，`/usr/local/etc/inputrc`然后将变量导出到`/etc/profile`：

```
export INPUTRC=/usr/local/etc/inputrc 
```

确保它`/etc/profile`是由你的 shell 提供的（大多数默认情况下），你很高兴。请注意，在您注销并再次登录之前，不会获取该文件。

以下是此问题的一些其他资源：

*   [http://bsdpants.blogspot.com/2007/08/make-home-and-end-keys-work.html](http://bsdpants.blogspot.com/2007/08/make-home-and-end-keys-work.html)
*   [http://www.cyberciti.biz/tips/freebsd-how-to-customized-home-del-insert-keys-for-bash-shell.html](http://www.cyberciti.biz/tips/freebsd-how-to-customized-home-del-insert-keys-for-bash-shell.html)
*   [http://www.ibb.net/~anne/keyboard.html](http://www.ibb.net/~anne/keyboard.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:10:23.900

这不应该是一个 psql 问题——它是特定于操作系统的。在[谷歌上快速搜索](http://fixunix.com/bsd/538417-home-end-delete-page-up-down-keys-not-working.html)可能会有所帮助。

# c# - C# 是否有 LINQ to HTML 或其他一些好的 .Net HTML 操作 API？

> ID：542194
> 
> 赞同：21
> 
> 时间：2009-02-12T16:40:05.813
> 
> 标签：c#, .net, linq

我有一个 C# WPF 应用程序，它需要使用在网页上作为 HTML 表公开的数据。

[从这个 url 获得灵感后，](http://blogs.msdn.com/bethmassi/archive/2008/04/25/querying-html-with-linq-to-xml.aspx)我尝试使用 Linq to Xml 来解析 Html 文档，但这仅在 HTML 文档格式非常好的情况下才有效（并且其中没有任何注释或 HTML 实体）。我已经设法使用这种技术获得了一个可行的解决方案，但这远非理想。

我正在寻找一个用于解析 HTML 的解决方案。我以前破解过“解决方案”，但它们很脆弱。我正在寻求一种强大的解析/操作文档的方法。理想情况下，我想要一些能让任务像 Javascript/JQuery 一样简单的东西。

有谁知道用于解析/操作 HTML 的好的 .Net 库或实用程序？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T16:57:21.140

~~即使它不是基于 LINQ，~~我建议研究 CodePlex 的[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)。

*注意：Html Agility Pack 现在支持 Linq to Objects（通过 LINQ to Xml Like 接口）*

从 HTML 敏捷包页面：

> 这是一个敏捷的 HTML 解析器，它构建一个读/写 DOM 并支持普通的 XPATH 或 XSLT（实际上你不必了解 XPATH 或 XSLT 就可以使用它，不用担心......）。它是一个 .NET 代码库，允许您解析“网络之外”的 HTML 文件。解析器对“真实世界”格式错误的 HTML 非常宽容。对象模型与 System.Xml 的提议非常相似，但用于 HTML 文档（或流）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-03T07:52:31.527

这里有一个 LINQ to HTML 库：

[http://www.superstarcoders.com/linq-to-html.aspx](http://www.superstarcoders.com/linq-to-html.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T16:51:31.340

HTML 的格式很少足以让您可靠地使用 LINQ to XML。可以想象，您可能会找到一个 HTML“清洁器”，它*可以*很好地修复格式以供阅读，但没有说它有多强大。

我假设这是一个从您无法控制的 HTML 表格中读取的“屏幕抓取工具”。在这种情况下不要强调鲁棒性，屏幕抓取本质上是脆弱的。如果您的要求是一成不变的，那么将刮板设计为在您正在抓取的 HTML 发生变化时可以轻松更新。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T16:55:28.087

我必须在最近的一个项目中这样做，并且我使用了 LINQ to XML。如果您知道它总是干净的 XHTML，那么您可能可以很容易地递归复制 DOM，但我使用 DevComponents HTMLDocument 类库 ( [http://www.devcomponents.com/htmldoc/](http://www.devcomponents.com/htmldoc/) ) 将 HTML 转换为 XML 然后拉将其转换为 XElement。这减少了将 HTML 放入 XElement 层次结构的挑战。需要注意的是它会阻塞脚本元素，所以我通过蛮力删除了这些元素。

```
 /// <summary>
    /// Extracts an HtmlDocument DOM to an XElement DOM that can be queried using LINQ to XML.
    /// </summary>
    /// <param name="htmlDocument">HtmlDocument containing DOM of page to extract.</param>
    /// <returns>HTML content as <see cref="XElement" /> for consumption by LINQ to XML.</returns>
    public XElement ExtractXml(HtmlDocument htmlDocument) {
        XmlDocument xmlDoc = htmlDocument.ToXMLDocument();

        // Find and remove all script tags from XML DOM or LINQ to XML will choke on XElement.Parse(XmlDocument).
        IList<XmlNode> nodes = new List<XmlNode>();
        foreach (XmlNode node in xmlDoc.GetElementsByTagName("script"))
            nodes.Add(node);
        foreach (XmlNode node in nodes)
            node.ParentNode.RemoveChild(node);

        return XElement.Parse(xmlDoc.OuterXml);
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T22:17:27.807

我在这里发布了一些提供“LINQ to HTML”功能的代码：

[寻找 C# HTML 解析器](https://stackoverflow.com/questions/100358/looking-for-c-html-parser/624410#624410)

# c# - 跟踪浏览器组件中的操作

> ID：542199
> 
> 赞同：0
> 
> 时间：2009-02-12T16:41:59.117
> 
> 标签：c#, .net, interop, browser, webkit

我是 ac# 开发人员，我*相信*我想要实现的目标是摆脱 .NET 组件中的一些下降的领域，所以我正在寻找关于我在外部使用哪些 .NET 可以与之交互的建议。

我的要求是在 WPF/Winforms 应用程序中有一个嵌入式 Web 浏览器控件，**但**我还需要跟踪以下内容：

1.  用户交互，即他们访问的页面、提交的表单点击等。
2.  DOM 操作和遍历

我在这里猜测，但似乎我可能需要开始查看开源 html/web 浏览器，例如 WebKit 等。这是正确的轨道，还是目前有任何可用的控件/COM 对象形式的东西，我可以直接使用。

干杯，克里斯。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:48:25.263

您应该能够使用 Visual Studio 中的 webbrowser 控件完成第 1 点，但我认为 DOM 操作不可用，我知道您可以遍历所有标签。 [参考](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser_members.aspx)

# asp.net - 在asp .net中的登录代码中需要帮助

> ID：542203
> 
> 赞同：0
> 
> 时间：2009-02-12T16:43:04.857
> 
> 标签：asp.net, authentication, login

有人请通过修改此代码来帮助我。在我的登录页面中，我有三列登录名、用户名、密码。在登录名中，我保留了包含两个列表项管理员和用户的下拉列表。所以当我选择管理员、用户名、密码时，它应该转到所需的目标页面，当我选择用户、用户名、密码时，它应该转到另一个所需的目标页面。这是我的代码。请帮我......

登录.aspx：

```
<asp:Label ID="lblLogin" runat="server" Text="Login" CssClass="Label"></asp:Label>      
<asp:DropDownList ID="DropDownList1" runat="server" AutoPostBack="True">
                                      <asp:ListItem>Admin</asp:ListItem>
                                        <asp:ListItem>User</asp:ListItem>
                                    </asp:DropDownList>            
<asp:Label ID="lblUserName" runat="server" Text="User Name"</asp:Label>                           
                            <asp:TextBox ID="TxtUserName" runat="server" TextMode="SingleLine"></asp:TextBox>                
                            <asp:Label ID="lblPassword" runat="server" Text="Password" CssClass="Label"></asp:Label>                      
                            <asp:TextBox ID="TxtPassword" runat="server" TextMode="Password"></asp:TextBox>                           
                        <td align="center">
                           <asp:Button ID="BtnLogin" runat="server" Text="Login"
                                 onclick="BtnLogin_Click"/> 
```

登录.aspx.cs：

```
protected void BtnLogin_Click(object sender, EventArgs e)
{
    Session["UserName"] = TxtUserName.Text;  
    Login lg = new Login();        
    if ((lg.GetLogin(TxtUserName.Text, TxtPassword.Text) == 1))
    {
        Response.Redirect("c1.aspx");
    }       
    else
    {           
        Lbl1.Text = "Sorry,Invalid UserName or Password";
    } 
```

登录.cs：

```
public  class Login
{    public string str = ConfigurationManager.ConnectionStrings["ConnectionString"].ToString();
public int GetLogin(string UserName, string Password)
{
    SqlConnection con = new SqlConnection(str);      
    SqlDataAdapter da = new SqlDataAdapter("select * from Login where UserName='"+UserName+"' and Password='"+Password+"'",con);       
    DataSet ds = new DataSet();
    da.Fill(ds);
    if (ds.Tables[0].Rows.Count > 0)
    {
        if ((ds.Tables[0].Rows[0].ItemArray[1].ToString() == UserName) && (ds.Tables[0].Rows[0].ItemArray[2].ToString() == Password))
        {
            return 1;
        }
        else
        {
            return 0;
        }
    }
    else
    {
        return -1;
    }
} 
```

谢谢， 马苏姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:52:41.633

首先，您打开您的应用程序以进行 SQL 注入攻击。我建议至少使用存储过程来针对您的数据库查询登录凭据，以尽量减少这种风险。
用户输入的第一条规则 - 不信任用户输入。
可能值得看看这个问题以获得进一步的帮助：

[避免sql注入攻击的最佳方法是什么](https://stackoverflow.com/questions/1973/what-is-the-best-way-to-avoid-sql-injection-attacks)

至于您请求帮助的问题，如果 GetLogin() 方法成功，您当然只需要根据下拉列表的选定值做出重定向的决定。

```
protected void BtnLogin_Click(object sender, EventArgs e)
{
    Session["UserName"] = TxtUserName.Text;  
    Login lg = new Login();        
    if ((lg.GetLogin(TxtUserName.Text, TxtPassword.Text) == 1))
    {
        if(DropDownList1.SelectedValue == "Admin")
        {
            Response.Redirect("c1.aspx");
        }
        else if(DropDownList1.SelectedValue == "User")
        {
            Response.Redirect("c2.aspx");
        }
    }       
    else
    {           
        Lbl1.Text = "Sorry,Invalid UserName or Password";
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:01:59.943

您可能希望查看[使用基于角色的安全性实现表单身份验证](http://www.codeproject.com/KB/web-security/formsroleauth.aspx)。然后，您可以根据用户是否具有特定角色进行重定向。就像是 -

```
//if (HttpContext.Current.User.Identity.IsAuthenticated)
//{
    if (User.IsInRole("Administrator"))
    {
    Response.Redirect("myAdminPage.aspx");
    }
    else if (User.IsInRole("User"))
    {
    Response.Redirect("myUserPage.aspx");
    }
//}
    else
    {
    Lbl1.Text = "Sorry,Invalid UserName or Password";
    } 
```

# rss - 从命令行发布到 RSS

> ID：542211
> 
> 赞同：2
> 
> 时间：2009-02-12T16:44:05.553
> 
> 标签：rss, development-environment, build-environment

从 Windows 命令行，我希望能够发布到 RSS 提要。我想象这样的事情：

```
rsspub @builds "Build completed without errors." 
```

然后，有人可以去我的电脑：

**[http://xp64-Matt:9090/builds/rss.xml](http://xp64-Matt:9090/builds/rss.xml)**

并且会有一个带有日期和时间的新条目以及简单的文本“构建完成且没有错误”。

我希望提要本身在不同的端口上运行，所以我不会与 IIS 或 Apache 或任何我需要在我的计算机上日常运行的其他东西抗争。

这样的事情存在吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:52:10.663

这是一个简单的 .Net 3.5 C# 程序，它将创建一个 RSS XML 文件，您可以将其存储在 IIS webroot 中：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml;
using System.IO;

namespace CommandLineRSS
{
    class Program
    {
        static void Main( string[] args )
        {
            var file = args[ 0 ];
            var newEntry = args[ 1 ];

            var xml = new XmlDocument();

            if ( File.Exists( file ) )
                xml.Load( file );
            else
                xml.LoadXml( @"<rss version='2.0'><channel /></rss>" );

            var xmlNewEntry = Create( (XmlElement)xml.SelectSingleNode( "/rss/channel" ), "item" );
            Create( xmlNewEntry, "title" ).InnerText = newEntry;
            Create( xmlNewEntry, "pubDate" ).InnerText = DateTime.Now.ToString("R");

            xml.Save( file );
        }

        private static XmlElement Create( XmlElement parent, string tag )
        {
            var a = parent.OwnerDocument.CreateElement( tag );
            parent.AppendChild( a );
            return a;
        }
    }
} 
```

然后你可以这样称呼它：

```
CommandLineRSS.exe c:\inetpub\wwwroot\builds.xml "Build completed with errors." 
```

# python - 如何在 Python 的 while(expression) 循环中进行变量赋值？

> ID：542212
> 
> 赞同：15
> 
> 时间：2009-02-12T16:44:14.633
> 
> 标签：python, syntax, while-loop, expression

我有变量分配，以便直接在while循环中返回分配的值并将其与空字符串进行比较。

这是我在 PHP 中的做法：

```
while((name = raw_input("Name: ")) != ''):
    names.append(name) 
```

我正在尝试做的在功能上与此相同：

```
names = []
while(True):
    name = raw_input("Name: ")
    if (name == ''):
        break
    names.append(name) 
```

有没有办法在 Python 中做到这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-13T02:58:59.960

```
from functools import partial

for name in iter(partial(raw_input, 'Name:'), ''):
    do_something_with(name) 
```

或者如果你想要一个列表：

```
>>> names = list(iter(partial(raw_input, 'Name: '), ''))
Name: nosklo
Name: Andreas
Name: Aaron
Name: Phil
Name: 
>>> names
['nosklo', 'Andreas', 'Aaron', 'Phil'] 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-12T16:49:06.230

您可以将其包装`raw_input()`成生成器：

```
def wrapper(s):
    while True:
        result = raw_input(s)
        if result = '': break
        yield result

names = wrapper('Name:') 
```

这意味着我们回到了原点，但代码更复杂。因此，如果您需要包装现有方法，则需要使用[nosklo](https://stackoverflow.com/users/17160/nosklo)的方法。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-12T16:48:34.577

不，对不起。这是一个常见问题解答，在这里解释得很好：

在[Pydocs](http://docs.python.org/faq/design.html#why-can-t-i-use-an-assignment-in-an-expression "http://docs.python.org/faq/design.html#why-can-ti-use-an-assignment-in-an-expression")和[Fredrik Lundh 的博客](http://effbot.org/pyfaq/why-can-t-i-use-an-assignment-in-an-expression.htm "http://effbot.org/pyfaq/why-can-ti-use-an-assignment-in-an-expression.htm")中。

> 不允许在 Python 表达式中赋值的原因是其他语言中常见的、难以发现的错误。
> 
> 已经提出了许多替代方案。大多数是节省一些打字但使用任意或神秘的语法或关键字的技巧，并且不符合语言更改建议的简单标准：它应该直观地向尚未被引入该结构的人类读者提出正确的含义。
> 
> 一个有趣的现象是，大多数有经验的 Python 程序员都认识这个`while True`习语，并且似乎并没有过多地错过表达式构造中的赋值。只有新来者表示强烈希望将其添加到语言中。
> 
> 有另一种拼写方式，看起来很有吸引力：
> 
> ```
> line = f.readline() while line:
>     ... # do something with line...
>     line = f.readline() 
> ```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-15T22:23:29.413

我只晚了 7 年，但还有另一种解决方案。这不是我能想到的最佳解决方案，但它突出了 StopIteration 异常的一个有趣用途。您可以为块读取文件/套接字执行类似的循环，并很好地处理超时等。

```
names=[]
try:
    while True:
        f = raw_input()
        if not f:
            raise StopIteration
        else:
            names.append(f)
except StopIteration:
    pass

print names 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-13T11:45:03.303

```
names = []
for name in iter(lambda: raw_input("Name: "), ''):
    names.append(name) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-10-09T14:08:51.213

[PEP 572](https://www.python.org/dev/peps/pep-0572/)提出了**赋值表达式**并已被接受。从 Python 3.8 开始，您将能够编写：

```
while name := input("Name: "):
    names.append(name) 
```

引用 PEP 的[语法和语义](https://www.python.org/dev/peps/pep-0572/#syntax-and-semantics)部分以获得更多示例：

```
# Handle a matched regex
if (match := pattern.search(data)) is not None:
    # Do something with match

# A loop that can't be trivially rewritten using 2-arg iter()
while chunk := file.read(8192):
   process(chunk)

# Reuse a value that's expensive to compute
[y := f(x), y**2, y**3]

# Share a subexpression between a comprehension filter clause and its output
filtered_data = [y for x in data if (y := f(x)) is not None] 
```

# .net - 如何使记录的实例（httpwebrequest）保持活动状态并用它查询另一个页面？

> ID：542216
> 
> 赞同：1
> 
> 时间：2009-02-12T16:45:40.513
> 
> 标签：.net, httpwebrequest, connection, keep-alive

在我通过 httpwebrequest 使用 POST 变量成功登录网站并通过 HttpWebResponse 获得响应后..如何使用“当前登录”实例查询其他网站？我将它保存到某个变量吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:44:30.597

`POST`变量是在服务器端访问的，用户状态通常会存储在 cookie 中或会话中。

该类`HttpWebResponse`提供了一个`Cookies`集合，您可以使用该集合保存加密的身份验证数据或会话密钥，以供将来`HttpWebRequest`在`HttpWebRequest.CookieContainer`.

当然，这都是假设初始请求以其中一种形式存储用户认证数据。

# c# - 加载 BitmapSource 并在 WPF -> IOException 中使用相同的名称保存

> ID：542217
> 
> 赞同：5
> 
> 时间：2009-02-12T16:47:02.023
> 
> 标签：c#, wpf, load, bitmap, save

当我尝试保存之前加载的 BitmapSource 时，`System.IO.IOException`会抛出 a 说明另一个进程正在访问该文件并且无法打开文件流。

如果我只保存而不提前加载，一切正常。

加载代码：

```
BitmapImage image = new BitmapImage();

image.BeginInit();
image.UriSource = uri;

if (decodePixelWidth > 0)
image.DecodePixelWidth = decodePixelWidth;

image.EndInit(); 
```

保存代码：

```
using (FileStream fileStream = new FileStream(Directory + "\\" + FileName + ".jpg", FileMode.Create))
{
    JpegBitmapEncoder encoder = new JpegBitmapEncoder();
    encoder.Frames.Add(BitmapFrame.Create((BitmapImage)image));
    encoder.QualityLevel = 100;
    encoder.Save(fileStream);
} 
```

似乎在加载图像数据后，文件仍然被锁定，并且在打开它的应用程序仍在运行时永远无法覆盖。任何想法如何解决这个问题？非常感谢任何解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T12:01:37.000

受到我对这个问题的评论的启发，我通过将所有字节读入内存流并将其用作 BitmapImage 的 Sreamsource 来解决问题。

这个完美地工作：

```
if (File.Exists(filePath))
{
    MemoryStream memoryStream = new MemoryStream();

    byte[] fileBytes = File.ReadAllBytes(filePath);
    memoryStream.Write(fileBytes, 0, fileBytes.Length);
    memoryStream.Position = 0;

    image.BeginInit();
    image.StreamSource = memoryStream;

    if (decodePixelWidth > 0)
        image.DecodePixelWidth = decodePixelWidth;

    image.EndInit();
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-28T15:14:11.050

这是基于原始加载代码的另一种解决方案：

```
var image = new BitmapImage();
image.BeginInit();

// overwrite cache if already exists, to refresh image
image.CreateOptions = BitmapCreateOptions.IgnoreImageCache;
// load into memory and unlock file
image.CacheOption = BitmapCacheOption.OnLoad;

image.UriSource = uri;
if (decodePixelWidth > 0) image.DecodePixelWidth = decodePixelWidth;
image.EndInit(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T18:20:03.333

将以下行添加到您的加载代码中：

```
image.CacheOption = BitmapCacheOption.OnLoad; 
```

这将加载打开文件，将其读入内存，并在*image.EndInit*期间将其全部关闭。*BitmapCacheOption.Default*的默认值具有打开文件、将其读入内存但尚未在*image.EndInit*期间关闭它的奇怪行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T17:22:40.540

现在我不确定这是否可以应用于 BitmapImage 但我在将修改后的图像保存到 GDI+ 中的原始文件时遇到了非常相似的[问题](https://stackoverflow.com/questions/253435/saving-a-modified-image-to-the-original-file-using-gdi)

从文件加载图像的方法保持文件上的锁处于打开状态，直到图像对象被释放。

也许它与 bitmapimage.urisource 相同。如果不玩，您可以将图像复制到内存中并处理原件从而解锁文件吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T20:50:05.847

将 CacheOption 设置为 BitmapCacheOption.OnLoad，不会解决您的问题。我认为有一个错误，但我遇到了同样的问题。最后，我将图像加载到内存流并在将图像保存到文件之前处理了 BitmapImage。

# c# - 抽象类 - 我是在想这件事还是做对了？

> ID：542218
> 
> 赞同：1
> 
> 时间：2009-02-12T16:47:23.410
> 
> 标签：c#, generics, abstract-class

所以我使用 CollectionBase 作为自定义集合的继承类。我通过一个抽象类使用 CollectionBase，这样我就不会重复知识（遵循 DRY 原则）。抽象类也被定义为泛型类。这是我实施课程的方式：

```
 public abstract class GenericCollectionBase<T,C> : CollectionBase
 {
      //Indexders, virtual methods for Add, Contains, IndexOf, etc
 } 
```

我利用它，所以我不必在 10 多个类中实现这些基本方法。

我的问题是，当我像这样覆盖 Equals 方法时，我是否走得太远了：

```
 public override bool Equals(object obj)
    {
        if (obj is C)
        {
            GenericCollectionBase<T, C> collB = 
                obj as GenericCollectionBase<T, C>;

            if (this.Count == collB.Count)
            {
                for (int i = 0; i < this.Count; ++i)
                {
                    if (!this[i].Equals(collB[i]))
                        return false;
                }
                return true;
            }
        }
        return false;
    } 
```

我是否试图用我的摘要完成太多，还是以正确的方式做这件事？

编辑：这是为 .Net 2.0 编写的，无法访问 3.5 来利用 LINQ 之类的东西

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:52:12.320

我不相信你试图完成太多。如果一个抽象类根本没有任何实现，或者其他定义功能的方法，那么它们就是接口。

我唯一要改变的是使用`EqualityComparer<T>`而不是 equals 来比较`this[i]`and `collB[i]`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:57:45.770

好吧，首先，这很奇怪：

```
 if (obj is C)
    {
        GenericCollectionBase<T, C> collB = obj as GenericCollectionBase<T, C>; 
```

我假设你的意思是：

```
 GenericCollectionBase<T, C> collB = obj as GenericCollectionBase<T, C>;
    if (collB != null)
    {
        ... 
```

我认为你想多了，除非你真的，真的需要两个具有相同内容的*不同*集合被认为是平等的。我会将这个逻辑放在另一个方法中，以便显式调用或在相等比较器中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:51:23.323

对 IDictionary 进行扩展方法会更有用。还有像 LINQ 中的 Intersect 这样的方法可能很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-15T14:43:14.393

我不知道你是否试图完成太多，但我认为你试图完成错误的事情。在某些情况下，您可能希望集合具有这种类型的相等性，但它应该是可选的，并且从类型的名称中显而易见。我已经使用您正在使用的相等类型创建了一个 ListValue<>，但它也始终是不可变的。

此外，如果您要进行这种类型的相等性检查，使用 object.ReferenceEquals 的初始测试可以使您在将对象与其自身进行比较时不必遍历大型集合。

# java - 文本清理和替换：从 Java 中的文本中删除 \n

> ID：542226
> 
> 赞同：25
> 
> 时间：2009-02-12T16:48:50.677
> 
> 标签：java, string

我正在清理我的 Java 代码中的传入文本。文本包含很多“\n”，但不是换行，而是字面上的“\n”。我正在使用 String 类中的 replaceAll()，但无法删除“\n”。这似乎不起作用：

```
String string;
string = string.replaceAll("\\n", ""); 
```

这也不是：

```
String string;
string = string.replaceAll("\n", ""); 
```

我猜这最后一个被标识为实际的新行，因此文本中的所有新行都将被删除。

此外，什么是从字符串中删除不同模式的错误文本的有效方法。我正在使用正则表达式来检测它们，比如 HTML 保留字符等和 replaceAll，但每次我使用 replaceAll 时，都会读取整个字符串，对吗？

**更新**：感谢您的精彩回答。我在这里扩展了这个问题：
[文本替换效率](https://stackoverflow.com/questions/542770/text-replacement-efficiency)
我专门询问效率：D

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-12T16:58:07.563

Hooknc 是对的。我只想发表一点解释：

编译器完成后，“\\n”转换为“\n”（因为您转义了反斜杠）。所以正则表达式引擎看到“\n”并认为新行，并会删除那些（而不是你拥有的文字“\n”）。

"\n" 由编译器转换为真正的新行。所以换行符被发送到正则表达式引擎。

"\\\\n" 很难看，但正确。编译器会移除转义序列，因此正则表达式引擎会看到“\\n”。正则表达式引擎看到两个反斜杠并知道第一个反斜杠将其转义，以便转换为检查文字字符“\”和“n”，从而为您提供所需的结果。

Java 很好（它是我工作的语言），但必须考虑基本上双重转义正则表达式可能是一个真正的挑战。为了更有趣，StackOverflow 似乎也喜欢尝试翻译反斜杠。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-12T16:53:22.180

我认为你需要添加更多的斜线......

```
String string;
string = string.replaceAll("\\\\n", ""); 
```

说明：斜线的数量与“\n”本身是Java中的受控字符这一事实有关。

因此，要在某处获取“\n”的真实字符，我们需要使用“\n”。如果打印出来给我们：“\”

您正在寻找替换文件中的所有“\n”。但是您不想替换控件“\n”。所以你尝试了“\n”，它将被转换为字符“\n”。很棒，但也许没有那么多。我的猜测是，replaceAll 方法现在实际上将使用“\n”字符创建一个正则表达式，该字符将被误读为控制字符“\n”。

呼，快完成了。

使用 replaceAll("\\n", "") 将首先转换正则表达式将使用的 "\\n" -> "\n"。然后“\n”将在正则表达式中使用，实际上代表您的“\n”文本。这就是您要替换的内容。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-12T17:03:44.633

而不是使用正则表达式的 String.replaceAll()，您最好使用 String.replace()，它执行简单的字符串替换（如果您至少使用 Java 1.5）。

```
String replacement = string.replace("\\n", ""); 
```

应该做你想做的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-09-20T03:01:27.570

```
string = string.replaceAll(""+(char)10, " "); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-29T08:27:20.493

试试这个。希望能帮助到你。

```
raw = raw.replaceAll("\t", "");
raw = raw.replaceAll("\n", "");
raw = raw.replaceAll("\r", ""); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-16T09:38:56.440

其他答案已经充分涵盖了如何使用`replaceAll`，以及如何根据需要转义反斜杠。

从 1.5\. 开始，还有[`String.replace(CharSequence, CharSequence)`](http://download.oracle.com/javase/6/docs/api/java/lang/String.html#replace%28java.lang.CharSequence,%20java.lang.CharSequence%29)执行文字字符串替换的功能。这可以大大简化字符串替换的许多问题，因为不需要转义任何正则表达式元字符，如`.`, `*`, `|`, 和 yes,`\`本身。

因此，给定一个可以包含子字符串`"\n"`（not `'\n'`）的字符串，我们可以按如下方式删除它们：

```
String before = "Hi!\\n How are you?\\n I'm \n   good!";
System.out.println(before);
// Hi!\n How are you?\n I'm 
//   good!

String after = before.replace("\\n", "");

System.out.println(after);
// Hi! How are you? I'm 
//   good! 
```

注意，如果你坚持使用`replaceAll`，你可以通过使用来防止丑陋[`Pattern.quote`](http://download.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html#quote%28java.lang.String%29)：

```
System.out.println(
    before.replaceAll(Pattern.quote("\\n"), "")
);
// Hi! How are you? I'm 
//   good! 
```

`Pattern.quote`当您获得一个必须按字面匹配而不是作为正则表达式模式的任意字符串时，您也应该使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-07T08:38:48.783

我使用这个解决方案来解决这个问题：

```
String replacement = str.replaceAll("[\n\r]", ""); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-12T15:49:19.717

通常 \n 工作正常。否则，您可以选择多个 replaceAll 语句。首先在文本上应用一个replaceAll，然后在文本上再次重新应用replaceAll。应该做你正在寻找的东西。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2011-06-22T01:54:20.183

我相信这`replaceAll()`是一项昂贵的手术。以下解决方案可能会表现更好：

```
String temp = "Hi \n Wssup??";          
System.out.println(temp);

StringBuilder result = new StringBuilder();

StringTokenizer t = new StringTokenizer(temp, "\n");

while (t.hasMoreTokens()) {
    result.append(t.nextToken().trim()).append("");
}
String result_of_temp = result.toString();

System.out.println(result_of_temp); 
```

# javascript - 在 Javascript 中，如何使用 '/' 和 '/g' 中的变量对字符串执行全局替换？

> ID：542232
> 
> 赞同：87
> 
> 时间：2009-02-12T16:49:52.467
> 
> 标签：javascript, regex, string

我想在 Javascript 中使用 String.replace 执行字符串的全局替换。

在我读到的文档中，我可以使用 /g 来做到这一点，例如；

```
var mystring = mystring.replace(/test/g, mystring); 
```

这将替换 mystring 中的所有匹配项。表达式没有引号。

但是如果我有一个变量要查找，我怎么能在没有引号的情况下做到这一点？

我试过这样的事情：

```
var stringToFind = "test"; 
```

//第一次尝试

```
mystring = mystring.replace('/' + stringToFind + '/g', mystring); 
```

//第二次尝试，一点意义都没有

```
mystring = mystring.replace(/stringToFind/g, mystring); 
```

但他们不工作。有任何想法吗？

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2009-02-12T16:53:38.027

```
var mystring = "hello world test world";
var find = "world";
var regex = new RegExp(find, "g");
alert(mystring.replace(regex, "yay")); // alerts "hello yay test yay" 
```

如果您需要这个功能

```
 replaceGlobally(original, searchTxt, replaceTxt) {
    const regex = new RegExp(searchTxt, 'g');
    return original.replace(regex, replaceTxt) ;
  } 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-02-12T17:01:25.730

对于正则表达式，`new RegExp(stringtofind, 'g');`. 但。如果 'find' 包含正则表达式中的特殊字符，它们将具有其正则表达式含义。因此，如果您尝试替换“。” 在带有“x”的“abc.def”中，你会得到“xxxxxxx”——哎呀。

如果您想要的只是简单的字符串替换，则不需要正则表达式！这是普通的字符串替换习语：

```
mystring= mystring.split(stringtofind).join(replacementstring); 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2014-01-15T21:04:25.137

正则表达式比字符串搜索慢得多。因此，使用转义的搜索字符串创建正则表达式并不是最佳方式。即使循环字符串会更快，但我建议使用内置的预编译方法。

这是进行快速全局字符串替换的一种快速而干净的方法：

```
sMyString.split(sSearch).join(sReplace); 
```

就是这样。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-02-13T04:35:43.473

```
String.prototype.replaceAll = function (replaceThis, withThis) {
   var re = new RegExp(RegExp.quote(replaceThis),"g"); 
   return this.replace(re, withThis);
};

RegExp.quote = function(str) {
     return str.replace(/([.?*+^$[\]\\(){}-])/g, "\\$1");
};

var aa = "qwerr.erer".replaceAll(".","A");
alert(aa); 
```

[类似的帖子](https://stackoverflow.com/questions/494035/how-do-you-pass-a-variable-to-a-regular-expression-javascript/500471#500471)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2018-08-28T21:24:24.200

You can use the following solution to perform a global replace on a string with a variable inside '/' and '/g':

```
myString.replace(new RegExp(strFind, 'g'), strReplace); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-12T16:56:55.743

那是一个正则表达式，而不是一个字符串。使用 RegExp 对象的构造函数来动态创建正则表达式。

```
var r = new RegExp(stringToFind, 'g');
mystring.replace(r, 'some replacement text'); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-12T16:55:56.760

尝试：

```
var stringToFind = "test";
mystring = mystring.replace(new RegExp(stringToFind, "g"), mystring); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T16:57:13.060

如果要插入变量，则需要使用 RegExp 对象

[https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Regular_Expressions](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Regular_Expressions)

例子：

```
var str = "This is my name";
var replace = "i";
var re = new RegExp(replace, 'g')    

str = str.replace(re, 'p');
alert(str); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-06-14T00:17:13.060

**动态全局替换**

我来到这个线程寻找一个稍微复杂一点的解决方案，这里没有回答。我现在找到了答案，所以我将发布它以防其他人发现它有用。

我想做一个动态的全局替换，替换字符串基于原始匹配。

例如，使用全局查找替换将所有单词的首字母大写（例如“cat sat mat”变成“Cat Sat Mat”）。这是如何做到这一点的。

```
function capitaliseWords(aString) {
    // Global match for lowercase letters following a word boundary
    var letters = aString.match(/\b[a-z]/g), i, letterMatch;
    // Loop over all matched letters
    for( i = 0; i < letters.length; i++ ) {
        // Replace the matched letters with upper case versions
        letterMatch = new RegExp('\\b'+letters[i]); // EDIT - slight fix
        aString = aString.replace(letterMatch, letters[i].toUpperCase());
    }
    // Return our newly capitalised string
    return aString;
}

alert( capitaliseWords("cat sat mat") ); // Alerts "Cat Sat Mat" 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-12-02T15:19:22.440

您可以使用以下方法

看到这个功能：

```
function SetValue()
{
    var txt1='This is a blacK table with BLack pen with bLack lady';
    alert(txt1);
    var txt2= txt1.replace(/black/gi,'green');
    alert(txt2);
} 
```

***句法：***

> /search_string/{g|gi}

在哪里

*   g 是全局区分大小写的替换
*   gi 是全局不区分大小写的替换

你可以检查这个 JSBIN 链接

[http://jsbin.com/nohuroboxa/edit?html,js,输出](http://jsbin.com/nohuroboxa/edit?html,js,output)

* * *

## 回答 #11

> 赞同：-23
> 
> 时间：2009-02-12T18:35:54.007

你可以使用prototype.js吗？如果是这样，您可以使用 String.gsub，例如

```
var myStr = "a day in a life of a thing";
 var replace = "a";
 var resultString = myStr.gsub(replace, "g");
 // resultString will be "g day in g life of g thing" 
```

它也将采用正则表达式。对我来说，这是解决它的更优雅的方法之一。[prototypejs gsub 文档](http://www.prototypejs.org/api/string/gsub)

# java - 用于 GUI 构建的 Java 的 AWT 或 Swing？

> ID：542234
> 
> 赞同：3
> 
> 时间：2009-02-12T16:50:12.450
> 
> 标签：java, swing, awt

我需要为服务器监控过程编写一个相当简单的 GUI。它将有几个选项卡，这些选项卡导致日志拖尾、资源计数以及开始和顶部控制。这里没有什么花哨的。哪个 Java 框架，AWT 或 Swing，对于这么简单的事情更有意义。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-12T16:52:57.313

摇摆是要走的路。这是一个更干净的编程接口，看起来更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T16:52:31.947

使用 Swing 或[SWT](http://www.eclipse.org/swt/)，因为 AWT 没有内置选项卡。

从[Java 6 Update 10](http://java.sun.com/developer/technicalArticles/javase/java6u10/)开始，Swing 有了全新的外观和感觉，即“Nimbus 外观和感觉”。它看起来很棒而且非常快，因为它使用矢量图形。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T17:17:59.577

如果您在 Swing 和 AWT 之间进行选择，Swing 是您的最佳选择。

如果您有灵活性，我至少会考虑[SWT](http://www.eclipse.org/swt/)。它速度更快，与平台的外观和感觉相匹配，并且似乎在发布之间减少了移植障碍和回归问题。设置您的第一个项目（获得正确的 jar 等）有一个小障碍，但除此之外，它并不难工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T17:29:08.583

AWT 是第一个 Java GUI 框架，它有很多缺陷并被 Swing 所取代。它仍在 JDK 中的主要原因是为了向后兼容，并且因为某些类被 Swing 重用。

然而，未来（即使是桌面）可能是[JavaFX](http://www.sun.com/software/javafx/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T16:53:46.467

如果您打算将您的 gui 移动到多个平台上，那么请使用 AWT。否则，Swing 会为您提供更广泛的组件集供您使用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-09T12:38:22.880

如果您正在寻找更好看的 GUI，您可以在此地址查看实质外观包：[https ://substance.dev.java.net/see.html](https://substance.dev.java.net/see.html)

# functional-programming - 硬件辅助垃圾收集

> ID：542235
> 
> 赞同：30
> 
> 时间：2009-02-12T16:50:15.710
> 
> 标签：functional-programming, garbage-collection, hardware

我正在考虑函数式语言可以更直接地与其硬件相关联的方式，并且想知道垃圾收集的任何硬件实现。

这将显着加快速度，因为硬件本身将隐式处理所有收集，而不是某些环境的运行时。

这是 LISP Machines 所做的吗？有没有对这个想法进行进一步的研究？这是否太特定于域？

想法？反对？讨论。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-13T20:05:45.500

由于分代收集，我不得不说跟踪和复制*并不是*GC 的巨大瓶颈。

有什么帮助的是硬件辅助的 READ 屏障，它在进行堆栈扫描和标记堆时消除了“停止世界”暂停的需要。

Azul Systems 已经做到了这一点： [http](http://www.azulsystems.com/products/compute_appliance.htm) : //www.azulsystems.com/products/compute_appliance.htm 他们在 JavaOne 上发表了关于他们的硬件修改如何实现完全无暂停 GC 的演示。

另一个改进是用于跟踪记忆集的硬件辅助写入屏障。

分代 GC，对于 G1 或 Garbage First，更是如此，通过仅扫描分区并保留跨分区指针的记忆集列表来减少它们必须扫描的堆数量。

问题是这意味着任何时候 mutator 设置一个指针，它也必须在适当的 rememered 集中放置一个条目。因此，即使您不进行 GC，您也有（小）开销。如果你能减少这个，你将减少 GC 所需的暂停时间和整体程序性能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T16:59:53.550

一个明显的解决方案是使用大于可用 RAM 的内存指针，例如，32 位机器上的 34 位指针。或者，当您只有 16MB 的 RAM (2^24) 时，使用 32 位机器的最高 8 位。苏黎世联邦理工学院的[Oberon 机器使用这种方案取得了很大的成功，直到 RAM 变得太便宜。](http://en.wikipedia.org/wiki/Oberon_(programming_language))那是在 1994 年左右，所以这个想法已经很老了。

这为您提供了一些可以存储对象状态的位（例如“这是一个新对象”和“我刚刚触摸了这个对象”）。在进行 GC 时，更喜欢带有“这是新的”的对象并避免“刚刚接触”。

这实际上可能会看到复兴，因为没有人拥有 2^64 字节的 RAM（= 2^67 位；宇宙中大约有 10^80 ~ 2^240 个原子，因此可能永远不可能拥有那么多*RAM*）。*这意味着如果*虚拟机可以告诉操作系统如何映射内存，您可以在今天的机器中使用几个位。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T20:50:01.843

是的。查看这2篇论文的相关工作部分：

[https://research.microsoft.com/en-us/um/people/simonpj/papers/parallel-gc/index.htm](https://research.microsoft.com/en-us/um/people/simonpj/papers/parallel-gc/index.htm) [http://www.filpizlo.com/papers/pizlo-ismm2007-stopless.pdf](http://www.filpizlo.com/papers/pizlo-ismm2007-stopless.pdf)

或者在这个：

[http://researcher.watson.ibm.com/researcher/files/us-bacon/Bacon12StallFree.pdf](http://researcher.watson.ibm.com/researcher/files/us-bacon/Bacon12StallFree.pdf)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T17:06:41.740

有[一篇关于 lambda the Ultimate 的文章](http://lambda-the-ultimate.org/node/2552)描述了如何需要一个支持 GC 的虚拟内存管理器来实现真正高效的 GC，而如今 VM 映射主要由硬件完成。这个给你 ：）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-08-15T03:27:02.353

你是一名研究生，听起来对我来说是一个研究资助的好话题。[查看 FPGA 设计和计算机架构，在http://www.opencores.org/](http://www.opencores.org/)上有大量免费的处理器设计可用

垃圾收集可以作为后台任务实现，它已经用于并行操作。

皮特

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T16:59:28.933

我很确定应该存在一些原型。但是开发和生产硬件特定功能非常昂贵。在硬件层面实现 MMU 或 TLB 需要很长时间，这很容易实现。

GC 太大而无法有效地实现到硬件级别。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-13T00:39:59.367

较旧的 sparc 系统具有可用于标记地址的标记内存（33 位）。今天没装？

这来自他们的 LISP 遗产 IIRC。

我的一个朋友构建了一个分代 GC，它通过从原语中窃取一点来标记。它工作得更好。

所以，是的，它可以做到，但是 nodody 不再需要标记东西了。

runT1mes 关于硬件辅助分代 GC 的评论值得一读。

给定一个足够大的门阵列（想到顶点 III），支持 GC 活动的增强型 MMU 将是可能的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T17:02:07.663

可能这里需要的最相关的数据是，目前在垃圾收集上花费了多少时间（占 CPU 时间的百分比）？这可能不是问题。

如果我们确实这样做了，我们必须考虑到硬件正在“在我们背后”欺骗内存。我想这将是“另一个线程”，用现代的话来说。如果正在检查某些内存可能不可用（也许可以通过双端口内存解决），当然如果 HWGC 要移动东西，那么它必须锁定其他进程，以免干扰它们. 并以适合所使用的架构和语言的方式进行。所以，是的，特定领域。

看看刚刚出现了什么……[在另一篇文章](https://stackoverflow.com/questions/541832/know-of-any-java-garbage-collection-log-analysis-tools/ "在另一个问题")中……查看 java 的 GC 日志。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-12T22:26:12.160

我认为最大的问题是 CPU 寄存器和堆栈。在 GC 期间您必须做的一件事是遍历系统中的所有指针，这意味着知道这些指针是什么。如果这些指针之一当前位于 CPU 寄存器中，那么您也必须遍历它。同样，如果您在堆栈上有一个指针。因此，每个堆栈帧都必须有某种映射说明什么是指针，什么不是指针，并且在进行任何 GC 遍历之前，您必须将任何指针取出到内存中。

您还会遇到闭包和延续的问题，因为突然您的堆栈不再是一个简单的 LIFO 结构。

显而易见的方法是永远不要将指针保存在 CPU 堆栈或寄存器中。相反，您将每个堆栈帧作为指向其前身的对象。但这会扼杀性能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-03-28T21:42:13.523

上世纪 80 年代，麻省理工学院的几位伟人创造了[SCHEME-79](http://dspace.mit.edu/handle/1721.1/6334)芯片，该芯片直接解释了 Scheme 的一种方言，采用 LISP DSL 设计，*并*内置了 hardware-gc。

![Scheme-79 模具](https://i.stack.imgur.com/ZSmcy.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-12T16:58:09.983

为什么它会“加快速度”？硬件到底应该做什么？它仍然需要遍历对象之间的所有引用，这意味着它必须遍历主内存中的一大块数据，这也是它需要时间的主要原因。你会从中得到什么？您认为通过硬件支持可以更快地完成哪个特定操作？垃圾收集器中的大部分工作只是跟踪指针/引用，偶尔将活动对象从一个堆复制到另一个堆。这与 CPU 已经支持的指令有何不同？

话虽如此，您为什么认为我们*需要*更快的垃圾收集？现代 GC 已经可以非常快速和高效，以至于它基本上是一个已解决的问题。

# c - C：修改通过 typedef 传递的 int 指针的最佳方法是什么？

> ID：542238
> 
> 赞同：1
> 
> 时间：2009-02-12T16:50:30.750
> 
> 标签：c, pointers, typedef

我有一个 typedef int my_type 并且我有一个看起来像的函数

```
void my_func (my_type* x); 
```

我应该如何使用这个函数来修改 x 使用最佳实践？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T16:52:26.877

您可以在函数中使用取消引用运算符“*”：

```
void my_func (my_type* x)
{
  assert(x); // To protect from NULL pointer as mentioned in com.

  *x = 5; //for example
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:27:39.070

如果您使用 typedef，您基本上会创建一个新类型。与所有其他类型一样，只需像使用任何其他类型一样使用该类型。只要确保与 typed 一致——如果您将 my_type 用于变量，则在该变量的任何地方都使用它。如果将该类型传递给函数，请在函数中使用该类型，即使您知道该类型只是一个 int。等等 ...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:59:30.730

如果您想通过分配进行修改，请使用 claferri 的答案。如果要修改成员（如果 my_type 是结构），请执行以下操作：

```
void my_func(my_type* x) {
  x->member = 5;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-15T10:27:29.167

使用 * 运算符取消引用 x!

# asp.net - asp.net ajax updatepanel 和播放声音

> ID：542242
> 
> 赞同：0
> 
> 时间：2009-02-12T16:51:08.300
> 
> 标签：asp.net, ajax, updatepanel

我想在 asp.net updatepanel 更新时播放声音。ajax面板更新时是否有一种免费且简单的方式来播放声音？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T17:01:40.740

您必须将事件附加到 endRequest 事件：

```
Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(EndRequestHandler); 
```

以上是 Asp.Net ajax，您必须解析并确定回发是否来自更新面板的更新。让跨浏览器兼容的声音播放的唯一真正方法是在 Flash 对象中触发它。IE 和 FF 有不同的方法来发出声音。

# javascript - 按钮需要点击两次才能触发功能

> ID：542247
> 
> 赞同：3
> 
> 时间：2009-02-12T16:52:12.913
> 
> 标签：javascript, onclick

我知道这很难理解，但请试一试。看一下屏幕截图。

小输入框的名称是`murl`。

`add()`用于提交表单。如果`murl`为空，则必须直接提交表单，如果它不为空，则`murl`必须根据数据库检查条目是否存在。如果它不存在`add()`被调用。

**问题是`button`必须单击两次才能触发该功能。**

按钮上的代码是：

```
<button type="button" value="My button value" onclick="javascript: niju();" name="microsubmit" id="microsubmit">button</button> 
```

该按钮调用的 JavaScript 是：

```
function niju()
{
    var flag=1;
    var micro=document.getElementById('murl').value;

    $('#microsubmit').click(function()
    {

        if(micro=="")
        {
            add();
        }
        else
        {
            //remove all the class add the messagebox classes and start fading
            $("#msgbox")
                .removeClass()
                .addClass('messagebox')
                .text('Checking...')
                .fadeIn("slow");

            //check the username exists or not from ajax
            $.post("<?php echo SITE_ROOT;?>inc/user_availability.php",
                { murl: $("input:murl").val()  },
                function(data)
                {
                    if(data=='no') //if username not avaiable
                    {
                        $("#msgbox").fadeTo(200,0.1,function() //start fading the messagebox
                        {
                            //add message and change the class of the box and start fading
                            $(this)
                                .html('This User name Already exists')
                                .addClass('messageboxerror')
                                .fadeTo(900,1);

                            flag=0;
                        });
                    }
                    else
                    {
                        $("#msgbox")
                            //start fading the messagebox
                            .fadeTo(200,0.1,function()
                            {
                                //add message and change the class of the box and start fading
                                $(this)
                                    .html('Username available to register')
                                    .addClass('messageboxok')
                                    .fadeTo(900,1);   

                                flag=1;
                                add();
                            });
                    }
                });
        }
    });

    if(micro=="" && flag==1)
    {
        add();
    }
} 
```

截屏：

[![截屏](https://i.stack.imgur.com/IC13Z.jpg)](http://img294.imageshack.us/my.php?image=screenhunter001am9.jpg)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T17:15:52.997

必须单击它两次，因为您在函数内定义`#microsubmit`'`click`事件。因此，第一次单击时绑定事件处理程序，第二次事件处理程序就位并被触发。我还没有讨论您要完成的工作背后的逻辑，但我的猜测是，如果您将事件绑定器移到函数之外并确保所有变量都在正确的范围内，那么它将起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:19:23.193

第一次加载页面时，单击处理程序不会与按钮挂钩，只有在您第一次单击按钮时才调用 niju() 并挂钩单击事件。你需要做类似的事情

```
$(document).ready() { 
   niju();
} 
```

并从按钮声明中删除 onclick

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:20:06.107

将您的标志移出功能 niju。

```
 var flag=1;
function niju()
{
} 
```

# c# - 如何以线程安全的方式调整 Listview 列的大小 - C#

> ID：542263
> 
> 赞同：0
> 
> 时间：2009-02-12T16:53:57.810
> 
> 标签：c#

我在单独的线程上对数据库进行了查询，并在返回时调用了线程安全调用。但是创建了一个例外 - 我做错了什么？

注意我还填充了列表视图，但为了清楚起见将其省略了

```
 private void ThreadSafeListView()
    {

        if (this.listView1.InvokeRequired)
        {
            try
            {
                ThreadSafe Operation d = new ThreadSafeOperation(ThreadSafeListView);
                this.Invoke(d );
            }
            catch { }
        }
        else
        {

            listView1.Columns[0].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
            listView1.Columns[1].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
            listView1.Columns[2].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
            listView1.Columns[3].AutoResize(ColumnHeaderAutoResizeStyle.HeaderSize);
            listView1.Columns[4].AutoResize(ColumnHeaderAutoResizeStyle.HeaderSize);

        }
    } 
```

异常详细信息= InvalidOperationException：“跨线程操作无效：控件'listView1'从创建它的线程以外的线程访问。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:00:36.217

抛出什么异常？如果它仍然是线程安全的异常，那么可能是因为您没有从需要调用的项目中调用。尝试：

```
listView1.Invoke(d) 
```

而不是

```
this.Invoke(d) 
```

理论上这是形式，所以它应该可以工作，但没有关于异常的更多信息，这是我唯一的猜测。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:21:42.343

我放弃了……我只是在转动我的轮子，所以我……

```
void listView1_Resize(object sender, EventArgs e)
    {
        listView1.Columns[0].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
        listView1.Columns[1].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
        listView1.Columns[2].AutoResize(ColumnHeaderAutoResizeStyle.ColumnContent);
        listView1.Columns[3].AutoResize(ColumnHeaderAutoResizeStyle.HeaderSize);

    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-11T05:52:58.110

```
//Here ilv is the List, who's column are to be resized
//Get the current column widths
ArrayList widths = new ArrayList();
foreach (ColumnHeader ch in ilv.Columns)
{
    widths.Add(ch.Width);
}

//Get the total width of all the columns
int total_width = 0;
for (int i = 0; i < widths.Count; i++)
{
     total_width += (int)widths[i];
}

//Calculate percentages and resize the columns.
for (int i = 0; i < widths.Count; i++)
{
    double c_width = (int)widths[i];
    double pect = (c_width / total_width);

    //get the new width, leave out 25 pixels for scrollbar
    double n_width = (ilv.Width - 25) * pect;
    n_width = Math.Round(n_width, 0);

    //MessageBox.Show(c_width + " - " + pect + " - " + n_width);
    ilv.Columns[i].Width = (int)n_width;                    
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-24T02:17:04.380

你可以这样做：

```
private void listViewEx_ColumnWidthChanging(object sender, ColumnWidthChangingEventArgs e)
{
    e.Cancel = true;
    e.NewWidth = 60;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-24T02:21:56.453

您可以执行以下代码...

首先获取listview onload的值..

然后将其存储在一个变量中，在`ColumnWidthChanging`事件属性中执行此代码，如下所示...

```
 e.cancel = true;
     e.NewWidth = // the declared variable in which you store the list view with value in the onload function of the form 
```

例子是这样的

```
 int a = 100;
    e.cancel =true;
    e.e.NewWidth = a; 
```

就这样

# sql-server-2005 - 远程连接需要 Sql Server 代理？

> ID：542265
> 
> 赞同：1
> 
> 时间：2009-02-12T16:54:22.113
> 
> 标签：sql-server-2005, configuration, connection

我正在使用以下连接字符串连接到远程 sql server 实例

"网络库=DBMSSOCN；数据源=xx.xxx.x.xxx,1433；初始目录=MyDatabase；用户ID=MyUserId；密码=MyPassword；连接超时=120；"

1.  Sql Server 浏览器正在运行
2.  仅允许使用 TCP/IP 进行本地和远程连接

应用程序随机连接失败，引用以下 SqlException

TCP Provider, error: 0 - 连接尝试失败，因为连接方在一段时间后没有正确响应，或者建立连接失败，因为连接的主机没有响应

连接代码如下

```
using (SqlConnection connection = new SqlConnection(m_ConnectionString))
{
    connection.Open(); // falls over here
} 
```

我想到了端口 1433 上的防火墙配置，但为什么防火墙有时允许连接，有时不允许连接？

是否需要运行 Sql Server 代理？如果是这样，为什么 MSDN 上对 Sql Server Agent 的描述在这方面并不明显？

谢谢！

编辑：尝试在防火墙上添加一个明确的规则来打开 1433 到目前为止一切都很好，但可能再次随机性很难说我是否修复了

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:56:00.363

不，不需要运行 SQL Server 代理。SQL Server 代理只需要在 SQL Server 上执行计划任务。

这可能是网络问题。你能ping通服务器吗？如果是这样，请尝试使用 /t 连续 ping 它并查看是否所有数据包都到达。

这也可能是 SQL 服务器负载的问题。服务器是空闲还是负载不足？

您能否在 SQL 服务器或同一 LAN 上本地测试应用程序以查看问题是否仍然存在？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:58:16.613

好吧，您现在不需要运行 SQL Server 代理，该错误表明您正在从场景中获得超时。

有多种原因可能会导致您被阻止。也许防火墙被配置为一次只允许某个端口上的一定数量的连接。或者数据库本身正在限制连接数。您的互联网速度很慢，您正在达到 120 秒的超时时间。名单还在继续。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-08T20:34:25.347

您的 SQL Server 数据库将进入休眠状态。第一次尝试连接它时，它必须重新启动并且您的连接超时。

确保选项“自动关闭”设置为“假”。这可以防止它在最后一个连接关闭后自行关闭。

[http://itknowledgeexchange.techtarget.com/sql-server/auto-close-is-almost-as-bad-as-auto-grow/](http://itknowledgeexchange.techtarget.com/sql-server/auto-close-is-almost-as-bad-as-auto-grow/)

# delphi - 如何使 TLinkLabel 在 Delphi 中工作？

> ID：542267
> 
> 赞同：13
> 
> 时间：2009-02-12T16:55:07.370
> 
> 标签：delphi, linklabel

我在表单上放了一个 TLinkLabel，用包含有效 HTML 链接的标题填充它，并得到一些漂亮的蓝色下划线文本。当我运行程序时，我希望它会调用 Firefox（我的默认浏览器）并自动打开链接。显然情况并非如此。

帮助文件说我必须在 OnLinkClick 事件处理程序中对此进行编码。但是，它没有说明如何做到这一点。它将传入一个名为“Link”的字符串值。我怎么说“调用默认浏览器并打开链接”？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-12T17:36:33.917

您可以调用 ShellExecute。我为通用调用编写了此方法，并且应该适用于您的情况。

```
procedure ShellOpen(const Url: string; const Params: string = '');
begin
  ShellAPI.ShellExecute(0, 'Open', PChar(Url), PChar(Params), nil, SW_SHOWNORMAL);
end; 
```

在您的代码中，您应该调用它

```
procedure TForm1.LinkLabelClick(Sender: TObject);
begin
  ShellOpen(LinkLabel.Caption);
end; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-04-22T13:13:31.537

我在使用 delphi 2010 附带的 TLinkLabel 时遇到各种问题。a **)**控件不会呈现为超链接，而是呈现为表单上的简单标签文本。**b）**即使我设置了 Cursor 属性，光标也不会改变以指出这是一个链接。**c)** OnLinkClick 事件根本不会触发。我正在使用 Windows 7。

因此，就我而言，TLinkLabel 没有做*任何*应有的事情，而且毫无用处。ShellExecute 是唯一的解决方案，必须放在 OnClick 事件中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-13T05:51:13.120

`TLinkLabel`提供一个*看起来像*链接的标签。作为程序员，你的工作就是让它表现*得像*一个链接，因为只有你才能知道你的程序中的链接应该是什么样子。您希望标签使用标签中的 URL 自动打开用户的默认 Web 浏览器，但这不是链接的唯一作用。例如：

*   Internet Explorer 不是我的默认浏览器，但是当我在 Internet Explorer 中单击链接时，我不希望链接页面在 Firefox 中打开。
*   当我单击帮助程序中的链接时，我希望链接的主题出现在帮助程序中，而不是任何 Web 浏览器中。
*   Eclipse 中的首选项页面非常复杂。一页上的设置有时与另一页上的设置相关。这些页面上的链接可将用户直接带到相关页面。在这种情况下，没有涉及 URL 和 HTML，但它们仍然是带有下划线文本的标签。

一些程序试图在新窗口中打开链接与重新使用旧窗口之间提供选择。在不知道正在使用哪个浏览器的情况下，您无法实现该功能。您的程序可能会为用户提供忽略默认浏览器设置并始终使用特定浏览器设置的选择。为此，您的 UI 控件不能对程序应该做什么做出太多假设。

我猜您指的`TLinkLabel`是 Delphi 附带的控件。（我的版本没有这样的组件。）我想 Delphi 控件是为了模仿[.Net 类库中的那个](http://msdn.microsoft.com/en-us/library/system.windows.forms.linklabel.aspx)。它可以容纳多个链接，每个链接可以做不同的事情。

如果您想要一个始终对 URL 执行 shell 的默认操作的控件，请考虑使用不同的`TLinkLabel`; [Alexander Bach 的作品](http://www.filegate.net/pascal-net/pasdelph/)完全符合您的预期。它来自 Delphi 3，但在所有更高版本（包括 Delphi 2009）中也应该不加修改地工作。如果您查看代码，您会看到它是如何工作的。[`ShellExecute`](http://msdn.microsoft.com/en-us/library/bb762153.aspx)正如[塞萨尔的回答](https://stackoverflow.com/questions/542267/542472#542472)所表明的那样，它只是调用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-07-31T00:38:00.517

大声笑，这很有趣。因此，与其将 crHandPoint 设置为光标、彩色和带下划线的字体并将 OnClick 事件填充为标准 TLabel，我们拥有知道链接标签的组件，并且我需要提供相同的 On(Link)Click 事件:))

唯一的好处是它可以更容易地将链接嵌入到一些文本中，并且它使用系统样式的链接......

ps：真的你必须`Some text with <a href="some URL">link</a>`投入和`Caption`设置`OnLinkClick`...`ShellExecute`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-15T14:53:41.317

我使用了一个名为[TInternetLabel](http://www.google.com/search?sclient=psy&hl=en&site=webhp&source=hp&q=TInternetLabel)的控件。它完全符合您的要求：单击它会打开浏览器，因此您不必将代码放入 OnClick 事件中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-11-17T21:37:47.320

我尝试了这个解决方案，但它仍然在 Delphi XE4 中出现问题，可能是因为 ShellOpen 不理解标题中的 HTML 代码。对我有用的是 Cesar Romero（基本代码）、Adam Feistner（标题中的 HTML 代码）和旧解决方案的组合：

* * *

*   将 URL 放在提示字段中。
*   换行： **ShellOpen(LinkLabel.Caption);** 到 **ShellOpen(LinkLabel.Hint);**

这对我有用。

# .net - 禁用 ASP.NET 事件验证

> ID：542275
> 
> 赞同：4
> 
> 时间：2009-02-12T16:57:10.610
> 
> 标签：.net, asp.net, eventvalidation

我们已经厌倦了在我们的 Web 应用程序中收到有关“无效回发或回调参数”的异常。什么情况会导致此错误？

在与用户交谈后，我们确定了一个可能的原因是当他们单击导致回发的内容时，然后在初始回发完成之前单击其他内容。

禁用事件验证有什么危害？值得一提的是，我们安装了[SecureIIS](http://www.eeye.com/html/products/secureiis/index.html)以提高安全性。

**更新**：在某些地方，我们使用 Javascript 来修改某些控件值，例如下拉列表选项（我们这样做是为了提供更好的用户体验 - 减少回发）。这很可能导致错误。我们对所有用户输入进行了严格的编辑，因此我们将继续禁用 EventValidation。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T17:00:16.297

事件验证验证这些值没有被手动篡改，例如超出所涉及的控制所允许的范围。例如，如果您有一个包含三个选项 1、2 或 3 的下拉列表……如果用户（或恶意中间人）将值更改为 4，则验证将失败。

只要您在每个处理程序中进行自己的检查以确保传入的值是有效的，并且您的代码的结构使得意外输入不会导致任何事情发生（最安全），您就可以关闭验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-31T17:15:44.620

FWIW，我也安装了 SecureIIS 多年，并且没有遇到任何这些问题。

# asp.net - Webpart 连接 asp.net VB

> ID：542280
> 
> 赞同：2
> 
> 时间：2009-02-12T16:57:50.873
> 
> 标签：asp.net, vb.net, web-parts

我对 vb.net asp.net webparts 有以下问题。我试图在 webparts 之间创建一个静态连接，但我遇到了一个问题，即：

> 找不到 ID 为“Ucl_Diary_Summary1”的连接提供程序 Web 部件

我将以下内容定义为我的 iterface：

```
Public Interface IDiaryPartsProvider

    function Test as String

End Interface 
```

我有以下作为我的消费者（用户控件）：

```
Partial Class UsrCtrls_Diary_ucl_DiaryAwaitingReview
    Inherits System.Web.UI.UserControl

    <ConnectionConsumer("Test", "myID")> _
    Public Sub GetTextTransferInterface(ByVal provider As IDiaryPartsProvider)
        Dim a As String = provider.Test()
        UserMsgBox(a.ToString, Me.Page)
    End Sub

End Class 
```

我将以下内容定义为我的提供者（用户控件）：

```
Partial Class UsrCtrls_Diary_Diary_Summary
    Inherits System.Web.UI.UserControl

    Implements IWebPart, IDiaryPartsProvider

    <ConnectionProvider("myID")> _
    Public Function Test() As String Implements IDiaryPartsProvider.Test
        Return "this is a test"
    End Function
End Class 
```

我的 default.aspx 如下：

```
<%@ Register Src="UsrCtrls/Diary/ucl_Diary_Summary.ascx" TagName="ucl_Diary_Summary"
    TagPrefix="uc4" %>
<%@ Register Src="UsrCtrls/Diary/ucl_DiaryAwaitingReview.ascx" TagName="ucl_DiaryAwaitingReview"
    TagPrefix="uc5" %>

<asp:WebPartManager ID="WebPartManager1" runat="server">
            <StaticConnections>
                <asp:WebPartConnection ID="cnn"
                ConsumerID="Ucl_DiaryAwaitingReview1"
                ProviderID="Ucl_Diary_Summary1"
                />
            </StaticConnections>
        </asp:WebPartManager>

<asp:WebPartZone ID="zoneDiaryTopLeft" runat="server" EmptyZoneText="Add WebPart Here" DragHighlightColor="#454777" HeaderText=" ">

                                    <ZoneTemplate>
                                    <asp:Panel ID="pnl1" runat="server" title="Claims Awaiting Review">
                                    <asp:UpdatePanel ID="udp_TopLeft" runat="server" ChildrenAsTriggers="False" UpdateMode="Conditional">
                                    <ContentTemplate>
                                        <uc5:ucl_DiaryAwaitingReview ID="Ucl_DiaryAwaitingReview1" runat="server" title="Claims Awaiting Review" />
                                        </ContentTemplate>
                                    </asp:UpdatePanel>
                                    </asp:Panel>
                                    </ZoneTemplate>
</asp:WebPartZone>

<asp:WebPartZone ID="zoneDiaryTopRight" runat="server" EmptyZoneText="Add WebPart Here" DragHighlightColor="#454777" HeaderText=" ">
                        <ZoneTemplate>
                        <asp:Panel ID="PNL2" runat="server" title="Diary Summary">
                       <asp:UpdatePanel ID="udp_TopRight" runat="server" ChildrenAsTriggers="False" UpdateMode="Conditional">
                        <ContentTemplate>
                            <uc4:ucl_Diary_Summary ID="Ucl_Diary_Summary1" runat="server" Title="Diary Summary" />
                        </ContentTemplate>
                        </asp:UpdatePanel>
                        </asp:Panel>
                        </ZoneTemplate>
</asp:WebPartZone> 
```

我只能假设它是因为我有我的 webparts - usercontrol 包装在一个面板中（用于滚动），还有一个我用来刷新的 updatepanel，那么我如何让它看到 usercontrol？

提前致谢。

詹姆士。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T04:46:12.390

我没有机会详细查看您的消息，但问题似乎与您的提供商有关。它应该返回一个对象，该对象实现了用于与消费者通信的接口（通常是对自身的引用）。

查看以下资源以获取更多信息：

[介绍 ASP.NET Web 部件连接](http://msdn.microsoft.com/en-us/magazine/cc188696.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T11:43:39.360

我最终发现了我的问题/解决方案。

Rob，你是对的，我需要传回实现接口的对象的实例，而且，您不能为静态连接引用用户控件，该静态连接是其他两个控件的子控件，即面板和更新面板。我做这一切都错了。我对其进行了更改，以便更新面板位于用户控件内而不是默认页面上。这样，所有特定（Web 部件）组件都是自包含的。

另外，回到返回实例的原始项目，我替换了以下内容：

```
Public Function Test() As String Implements IDiaryPartsProvider.Test
    Return "this is a test"
End Function 
```

和：

```
 <ConnectionProvider("myID")> _
Public Function Test() As IDiaryPartsProvider
    Return me
End Function

Public ReadOnly Property Test() As String Implements IDiaryPartsProvider.Test
    Get
        Return "This is a test"
    End Get
End Property 
```

希望这可以帮助某人！

詹姆士。

# c# - 防止在浏览器刷新时重新提交 web 表单而不丢失视图状态

> ID：542284
> 
> 赞同：4
> 
> 时间：2009-02-12T16:58:32.713
> 
> 标签：c#, asp.net, browser, webforms

**重复：** [当浏览器重新加载/返回时，如何防止再次写入数据库？](https://stackoverflow.com/questions/305684/how-can-i-prevent-database-being-written-to-again-when-the-browser-does-a-reload)

* * *

如果用户从浏览器请求刷新，是否有一种很好的优雅方法可以阻止 .aspx 页面重新提交表单数据？

理想情况下不会丢失视图状态。

**编辑：**对我来说最优雅的解决方案是将相关控件包装在 asp.net ajax UpdatePanel 中。塔大家。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:01:36.090

生成唯一标识符并将其插入也存储在服务器上的页面中。在提交表单时存储它，并且不要让该值多次传递。

**更新**：这是唯一“正确”的方法。当我这么说时，我的意思是在服务器端存储一些东西。任何基于客户端行为的东西都可能有问题。这些实现不关心潜在的浏览器错误、不兼容、禁用javascript、连接超时等。

服务器端的某些东西需要知道这个特定的动作已经被执行并在服务器端停止它。我强调这一点，因为通常需要这样做以阻止客户刷新和制作多个订单（以及可能的多个账单）。这也允许客户端在服务器实际上没有接收到并采取行动（例如在超时的情况下）时优雅地刷新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:59:46.360

[发布后重定向](http://en.wikipedia.org/wiki/Post/Redirect/Get)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:04:37.580

没有优雅的方式，但有选择。如其他答案之一所述，您可以执行 HTTP 重定向响应。另一种解决方案是通过 Ajax 等方式或通过 iframe 提交。

# c# - 桌面到 Windows 移动通信

> ID：542287
> 
> 赞同：2
> 
> 时间：2009-02-12T16:59:27.703
> 
> 标签：c#, .net, windows-mobile, smartphone

我想让桌面应用程序触发 Windows Mobile 6 标准设备（智能手机）上的事件。

如何让智能手机和桌面通信？

我在哪里可以找到一些这样的代码示例？我正在使用 C#...

* * *

澄清：

它不会与 USB 对接。我想使用无线局域网。

我想在我的应用程序中触发一个已经在智能手机上运行的事件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:14:31.440

一种解决方案是使用 RAPI。如果您这样做，请查看[OpenNETCF](http://www.opennetcf.com/)上的 RAPI 通信库。这是 SDK 函数的 C# 包装器。

使用 RAPI，您可以执行以下操作：

*   将文件从桌面复制到移动设备，反之亦然
*   从桌面启动移动设备上的进程

我想很难有一个使用 RAPI 的消息交换机制。为此目的使用蓝牙或 Wi-Fi 通信会更容易。Code Project上的[这篇](http://www.codeproject.com/KB/mobile/WiMoSilencio.aspx)文章就是一个很好的例子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:03:04.353

智能手机是否通过 USB 连接到此桌面？如果是这样，请查看 RAPI（“Windows Mobile Remote API”），它允许桌面上的软件调用设备上的 API。RAPI 记录在 Windows Mobile SDK 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:06:00.713

您可以从桌面使用[RAPI API 。](http://msdn.microsoft.com/en-us/library/aa458022.aspx)没有直接的“触发此事件”类型的调用，但您始终可以创建自己的 RAPI 扩展来执行此操作并调用[CeRapiInvoke](http://msdn.microsoft.com/en-us/library/aa458342.aspx)。[这里](http://opennetcf.com/FreeSoftware/DesktopCommunication/tabid/90/Default.aspx)有一个用于 RAPI 调用的免费、开源托管包装器。

# python - 有没有用 Python 编写的好的构建框架？

> ID：542289
> 
> 赞同：16
> 
> 时间：2009-02-12T16:59:28.967
> 
> 标签：python, build-process, build-automation

我从 NAnt 切换到使用 Python 编写构建自动化脚本。我很好奇是否有任何值得使用的构建框架类似于 Make、Ant 和 NAnt，而是基于 Python。例如，Ruby 有 Rake。蟒蛇呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-12T17:01:59.787

试试[SCons](http://www.scons.org/)

或者您是否正在寻找只是为了构建 python 项目的东西？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T17:19:27.000

以下看起来不错，但我还没有使用它们（还）：

*   [摊铺机](http://www.blueskyonmars.com/projects/paver/)
*   [华夫](http://code.google.com/p/waf/)
*   [做它](http://python-doit.sourceforge.net/)

摊铺机看起来特别有前途。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-08T08:04:06.047

[Python wiki](http://wiki.python.org)维护一个[关于 python 构建和部署工具](http://wiki.python.org/moin/ConfigurationAndBuildTools)的页面。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-01T11:41:00.253

我的快速通关：SCons 相当成熟，也面向其他语言（es C++） Waf 与 ant/maven 非常相似，所以如果你习惯于 ant/maven，你会更喜欢它

Paver 非常面向 Python，如果您不知道如何开始，这似乎是一个不错的选择。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-13T08:37:06.403

还有[Fabric](http://www.nongnu.org/fab/)，但它专门针对部署而不是通用*构建*。

# windows-xp - 从 Windows XP 命令行创建快捷方式（.LNK 文件）的本机方法是什么？

> ID：542291
> 
> 赞同：6
> 
> 时间：2009-02-12T16:59:41.990
> 
> 标签：windows-xp, shortcut, command-prompt

## 编辑！

很抱歉改变每个人的问题，但我真的只是问：

如何在尽可能少的外部帮助的情况下从命令行创建快捷方式 (.LNK) 文件？我真的不想运行 VBscript 或下载程序来为我做这件事。真的**那么**难吗？

感谢所有在我还不知道自己在问什么时提供出色答案的人！

* * *

这个问题的原标题是：

> Windows 相当于 Unix ln -s 用于从命令行创建快捷方式？

这个问题的原始问题文本是：

> 在 *nix 上，我可以使用`ln -s`.
> 
> 如何使用 Windows XP 命令提示符**本地**创建文件的快捷方式？
> 
> [注意：[这](https://stackoverflow.com/questions/346107/creating-a-shortcut-for-a-exe-from-a-batch-file)不是我想要采取的方法。我想像 Windows 那样做。我想以正确的方式去做。]

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T17:19:52.410

Windows XP 及更高版本具有该`fsutil`命令，可以创建文件的“硬链接”。

看：

*   [MSDN：硬链接和连接点](http://msdn.microsoft.com/en-us/library/aa365006.aspx)
*   [JSI 提示 10153：Windows XP FSUTIL.EXE HARDLINK CREATE 命令](http://windowsitpro.com/article/articleid/85206/jsi-tip-10153-the-windows-xp-fsutilexe-hardlink-create-command.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T17:08:38.787

XP 没有符号链接。在 Vista 上，命令是 mklink。快捷方式不是符号链接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T17:13:40.210

这不是原生 Windows 调用，但您可能应该查看[Windows Sysinternals 的 Junction](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx)。这是一个质量很好的非常方便的工具。

如果您不想依赖外部软件，您应该查看[kb205524](http://support.microsoft.com/kb/205524)以了解创建连接点的本地方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T17:02:48.753

[http://www.ss64.com/nt/shortcut.html](http://www.ss64.com/nt/shortcut.html) 编辑：对不起，我删除了。..但这是一个旧的NT命令...不知道它是否在XP上有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T17:06:37.497

我的系统上有一个名为 shortcut.exe 的文件。老实说，我不知道我从哪里得到它。:-( 但是快速搜索找到了以下网站：

[http://www.optimumx.com/download/#Shortcut](http://www.optimumx.com/download/#Shortcut)

也许这对你有用？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T17:10:18.130

[`mklink`](http://technet.microsoft.com/en-us/library/cc753194.aspx) `link target`

不幸的是，这只适用于 Vista/Server 2008 或更新版本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T17:17:50.950

实际上 NTFS 确实支持符号链接。参见[维基百科 NTFS_symbolic_link](http://en.wikipedia.org/wiki/NTFS_symbolic_link)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T17:16:56.630

Windows 使用的文件系统支持软链接。
尽管任何标准 Windows 工具都没有公开此功能。

不过，有一些可用的开源工具可以解决问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T17:53:41.910

每个人似乎都在绕圈子，但我还没有看到有人真正站出来说：NTFS 支持称为“连接点”的东西，它们非常相似，但比符号链接稍微有用。这些不同于快捷方式和硬链接。我经常使用它们在我系统上的同一位置构建我们软件的不同版本（只需将构建目录链接重新指向不同的 SVN 结帐）。我为此使用的工具称为[ntfslink](http://elsdoerfer.name/=ntfslink). 该页面还包含对 NTFS 连接点如何工作以及哪些版本的 Windows 支持哪些功能的很好的解释。我在 Win Server 2k3 上使用它。ntfslink 程序是一个 shell 扩展，但还有其他类似的实用程序可以从命令行运行。如果您想从您正在开发的任何应用程序中以编程方式创建它们，也可以使用 Windows API 函数来创建它们。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-06T10:28:52.723

我不知道这是否完全回答了这个问题，但它确实让生活更轻松！

转到安装程序的位置。创建 .EXE 或启动文件的快捷方式。将快捷方式放在桌面上，以便您知道它在哪里！然后将快捷方式拖到开始按钮（在 XP 中）。当开始菜单出现时，将其放在小线上方（使其保持可见）。嘿 presto - 一个即时创建的 .LNK 文件，Windows 为您完成所有工作（是的，这确实有效，当我在这里阅读问题时，我刚刚完成了它/解决了它。）

# .net - 如何在安装时自动允许我的服务与桌面交互？

> ID：542293
> 
> 赞同：1
> 
> 时间：2009-02-12T16:59:46.983
> 
> 标签：.net, windows-services, permissions, installutil

我有一个由 .NET 2.0 的`installutil /i`命令安装的 Windows 服务。它使用以下帐户安装服务，并使用密码：

```
NT AUTHORITY\LocalService 
```

当我运行我的服务时`net start <serviceName>`，我得到

```
Error 5: Access Denied 
```

要删除它，我必须打开`services.msc`并从属性中提供服务

```
Logon As -> Local System Account
         -> Allow Service to interact with desktop. 
```

我可以将整个“clicky”业务放入本机 .NET C# 代码或 WMI 或其他批处理脚本的代码中吗？无论如何，我都会使用批处理脚本，所以两者都可以。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T18:24:05.907

想出了一个答案，非常感谢我给予充分信任的以下网页。

[链接文本](http://weblogs.asp.net/avnerk/archive/2007/05/08/setting-windows-service-account-c-and-wmi.aspx)

这是我的解决方案，只需根据需要更改您的服务名称。将其放入 C# 控制台应用程序并运行它:)

```
static void Main(string[] args)
{
    string serviceName = "SERVICE_NAME_HERE"; 
    string objPath = string.Format("Win32_Service.Name='{0}'", serviceName);
    using (ManagementObject service = new ManagementObject(new ManagementPath(objPath)))
    {
        object[] wmiParams = new object[11];
        wmiParams[6] = "LocalSystem";
        wmiParams[7] = "";
        service.InvokeMethod("Change", wmiParams);
    }
} 
```

}

# c# - 如何使用 .NET 2.0 以编程方式复制 SQL Server 2000 表？

> ID：542296
> 
> 赞同：2
> 
> 时间：2009-02-12T17:00:13.440
> 
> 标签：c#, .net, sql-server, sql-server-2000

我想备份一个表，将副本保存在另一个名称的同一数据库中。我想使用 .NET 2.0（最好是 C#）以编程方式进行。有人可以指出我该怎么办？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T17:10:11.390

只需将此查询发送到服务器：

```
SELECT * INTO [BackupTable] FROM [OriginalTable] 
```

这将从头开始创建备份表（如果它已经存在则会引发错误）。对于大桌子，请准备好一段时间。这应该模仿数据类型、排序规则和 NULL（NULL 或 NOT NULL），但不会复制索引、键或类似的约束。

如果您需要帮助将 sql 查询发送到数据库，那是另一个问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T17:10:25.833

一种方法是在 SQL 中使用 INTO 以这种方式简单地执行普通查询：

```
SELECT * 
INTO NewTableName 
FROM ExistingTableName 
```

这会自动创建一个新表并插入旧表的行。

另一种方法是使用命名空间中的**SqlBulkCopy**`System.Data.SqlClient`。有一篇很好的 CodeProject 文章解释了如何做到这一点：

[使用 C#.Net 进行 SQL 批量复制](http://www.codeproject.com/KB/database/SqlBulkCopy.aspx)

> 程序员通常需要传输生产数据进行测试或分析。将大量数据从任何资源复制到 SQL Server 的最简单方法是 BulkCopying。.NET Framework 2.0 在 ADO.NET“System.Data.SqlClient”命名空间中包含一个类：SqlBulkCopy。大容量复制操作通常有两个独立的阶段。
> 
> 在第一阶段，您将获得源数据。源可以是各种数据平台，例如 Access、Excel、SQL。您必须在将源数据包装在 DataTable 或任何实现 IDataReader 的 DataReader 类中的代码中获取源数据。之后，在第二阶段，您必须连接目标 SQL 数据库并执行大容量复制操作。
> 
> .Net 中的大容量复制操作是将大量数据复制到 SQL Server 的一种非常快速的方法。原因是 Bulkcopy Sql Server 机制。逐行插入所有数据，一个接一个，非常耗费时间和系统资源。但是批量复制机制一次处理所有数据。所以数据插入变得非常快。

代码非常简单：

```
// Establishing connection

SqlConnectionStringBuilder cb = new SqlConnectionStringBuilder(); 
cb.DataSource = "SQLProduction"; 
cb.InitialCatalog = "Sales"; 
cb.IntegratedSecurity = true;
SqlConnection cnn = new SqlConnection(cb.ConnectionString);  

// Getting source data

SqlCommand cmd = new SqlCommand("SELECT * FROM PendingOrders",cnn); 
cnn.Open(); 
SqlDataReader rdr = cmd.ExecuteReader(); 

// Initializing an SqlBulkCopy object

SqlBulkCopy sbc = new SqlBulkCopy("server=.;database=ProductionTest;" +
                                  "Integrated Security=SSPI"); 

// Copying data to destination
sbc.DestinationTableName = "Temp"; 
sbc.WriteToServer(rdr); 

// Closing connection and the others

sbc.Close(); 
rdr.Close(); 
cnn.Close(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:27:10.333

您可以使用**SQL Server 管理对象**( [SMO](http://msdn.microsoft.com/en-us/library/ms162169.aspx) )。您可以制作数据库（数据和模式）的副本。您可以设置很多选项。以下示例复制整个数据库：

```
// Connect to the server
Server server = new Server(".");

// Get the database to copy
Database db = server.Databases["MyDatabase"];

// Set options
Transfer transfer = new Transfer(db);
transfer.CopyAllObjects = true;
transfer.DropDestinationObjectsFirst = true;
transfer.CopySchema = true;
transfer.CopyData = true;
transfer.DestinationServer = ".";
transfer.DestinationDatabase = "MyBackupDatabase";
transfer.Options.IncludeIfNotExists = true;

// Transfer Schema and Data
transfer.TransferData(); 
```

您可以[在 MSDN 上找到 Transfer Class 的文档](http://msdn.microsoft.com/en-us/library/ms162563.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:10:32.980

至少，您可以执行“SELECT * INTO NEWTable FROM OldTable”。

你想创建所有的索引/约束等吗？

编辑：添加到 splattne 的评论中，您必须获取要复制的表的 Table 实例的句柄。使用 Script 方法获取它将生成的脚本。修改脚本字符串以用新名称替换旧名称并在数据库上运行它。

EDIT2：http: [//msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.table.table.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.table.table.aspx)

[http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.tableviewtabletypebase.script.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.tableviewtabletypebase.script.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T17:12:21.260

根据表中有多少记录，从 C# 和用户界面执行此操作可能是一个非常糟糕的主意。

对于小表，使用以下 SQL 创建表 table2 (field1 int, field2 varchar(10))——当然使用实际的字段名称和数据类型）

插入 table2 (field1, field2) 从 table1 中选择 field1, field2

我建议创建表创建一次然后插入，以便您可以多次向表中添加记录。选择进入只会工作一次。

# c# - 用 C# 解析 XML？

> ID：542304
> 
> 赞同：2
> 
> 时间：2009-02-12T17:01:24.890
> 
> 标签：c#, xml, dictionary, parsing

我正在为一个涉及大量 XML 解析的学校项目工作。我正在用 C# 编码，但我还没有找到一种“合适的”方法来解析这个 XML。我看过几种不同的方法，但还没有搞定；所以我来找你了。理想情况下，我正在寻找类似于 Python 中的 Beautiful Soup 的东西（有点）。

我想知道是否有任何方法可以像这样转换 XML：

```
<config>
    <bgimg>C:\\background.png</bgimg>
    <nodelist>
        <node>
            <oid>012345</oid>
            <image>C:\\image.png</image>
            <label>EHRV</label>
            <tooltip>
                <header>EHR Viewer</header>
                <body>Version 1.0</body>
                <icon>C:\\ico\ehrv.png</icon>
            </tooltip>
            <msgSource>8181:iqLog</msgSource>
        </nodes>
    </nodeList>
<config> 
```

像这样进入数组/Hastable/Dictionary/Other：

```
Array
(
["config"] => array
    (
    ["bgimg"] => "C:\\background.png"
    ["nodelist"] => array
        (
        ["node"] => array
            (
            ["oid"] => "012345"
            ["image"] => "C:\\image.png"
            ["label"] => "Version 1.0"
            ["tooltip"] => array
                (
                ["header"] => "EHR Viewer"
                ["body"] => "Version 1.0"
                ["icon"] => "C:\\ico\ehrv.png"
                )
            ["msgSource"] => "8181:iqLog"
            )
        )
    )
) 
```

即使只是给我一个体面的资源来浏览也会非常有帮助。万分感谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T17:04:24.617

我会研究[Linq to Xml](http://msdn.microsoft.com/en-us/library/bb308959.aspx#linqoverview_topic7)。这为您提供了一个类似于 Xml 文件的对象结构，并且相当容易遍历。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T17:04:03.883

[XmlDocument](http://cache.gawker.com/assets/images/gawker/2009/02/flier.jpg) + [XPath](http://www.w3schools.com/XPath/default.asp)几乎是您在 .NET 中解析 XML 所需要的一切。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:26:49.213

最佳方法将取决于您在解析数据后实际想要对数据执行的操作。

如果您想以结构化但不绑定到 XML 的方式传递它，[XML 序列化](http://www.developer.com/net/csharp/article.php/3110371)可能是您最好的选择。这也将使您最接近您所描述的内容，尽管您将处理对象图而不是嵌套图。

如果您只是在寻找一种方便的格式来查询特定的数据位，那么最好的选择是[LINQ to Xml](http://msdn.microsoft.com/en-us/library/bb308960.aspx)。或者，您可以使用[System.Xml](http://msdn.microsoft.com/en-us/library/system.xml.aspx)命名空间中更传统的类（以 XmlDocument 开头）并使用 XPath 进行查询。

您也可以使用这些技术中的任何一种（或[XmlTextReader](http://msdn.microsoft.com/en-us/library/system.xml.xmltextreader.aspx)）作为构建块来创建您描述的数据结构，但是，除非有一些特殊需要，否则我认为它不会比其他方法为您提供更多的多功能性.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T17:06:05.563

在 C# 中必须有 1/2 打不同的方法来做到这一点。我最喜欢使用`System.Xml`命名空间，尤其是`System.Xml.Serialization`.

您使用名为 xsd.exe 的命令行工具将 xml 示例转换为 xsd 架构文件（提示：确保您的节点列表在示例中有多个节点），然后在架构上再次使用它以将其转换为您可以将 C# 类文件加载到项目中并轻松与`System.Xml.Serialization.XmlSerializer`该类一起使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T17:06:58.603

使用老式的 XmlDocument 并不丢人：

```
var xml = "<config>hello world</config>";
var doc = new System.Xml.XmlDocument();
doc.LoadXml(xml);
var nodes = doc.SelectNodes("/config"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T17:09:49.847

您应该大胆地使用 LINQ to [XML](http://msdn.microsoft.com/en-us/library/bb308959.aspx#linqoverview_topic7)，AKA XLINQ。有一个不错的工具叫做[LINQPad](http://www.linqpad.net/)，你应该去看看。它有很好的功能，从一个全面的示例库到允许您通过 Linq to SQL 直接查询 SQL 数据库。最重要的是，它可以让您在将查询放入代码之前对其进行测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T17:23:20.657

我个人使用 XPathDocument、XPathNavigator 和 XPathNodeIterator，例如

```
XPathDocument xDoc = new XPathDocument(CHOOSE SOURCE!);

XPathNavigator xNav = xDoc.CreateNavigator();

XPathNodeIterator iterator = xNav.Select("nodes/node[@SomePredicate = 'SomeValue']");

while (iterator.MoveNext())
{
    string val = iterator.Current.SelectSingleNode("nodeWithValue");

    // etc etc
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T17:06:01.650

您还可以使用序列化将 XML 文本转换回强类型类实例。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T17:09:38.740

我个人喜欢使用类将 XML 元素映射到类，反之亦然`System.Xml.Serialization.XmlSerializer`。

[http://msdn.microsoft.com/es-es/library/system.xml.serialization.xmlserializer(VS.80).aspx](http://msdn.microsoft.com/es-es/library/system.xml.serialization.xmlserializer(VS.80).aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T12:39:59.067

是的，我同意.. linq 方式非常好。我特别喜欢您使用它编写 XML 的方式。

使用“对象中的对象”方式要简单得多。

# c# - ASP.NET 访问临时目录被拒绝

> ID：542312
> 
> 赞同：15
> 
> 时间：2009-02-12T17:02:22.813
> 
> 标签：c#, asp.net, exception

我今天在许多不同的服务器上遇到了这个问题。

**System.UnauthorizedAccessException：访问临时目录被拒绝。**

服务器最近没有动过。我唯一想到的是Windows更新破坏了某些东西..有什么想法吗？

尝试从 asp.net 页面访问 web 服务时会发生这种情况

```
System.UnauthorizedAccessException: Access to the temp directory is denied.  Identity 'NT AUTHORITY\NETWORK SERVICE' under which XmlSerializer is running does not have sufficient permission to access the temp directory.  CodeDom will use the user account the process is using to do the compilation, so if the user doesnt have access to system temp directory, you will not be able to compile.  Use Path.GetTempPath() API to find out the temp directory location.
       at System.Xml.Serialization.Compiler.Compile(Assembly parent, String ns, XmlSerializerCompilerParameters xmlParameters, Evidence evidence)
       at System.Xml.Serialization.TempAssembly.GenerateAssembly(XmlMapping[] xmlMappings, Type[] types, String defaultNamespace, Evidence evidence, XmlSerializerCompilerParameters parameters, Assembly assembly, Hashtable assemblies)
       at System.Xml.Serialization.TempAssembly..ctor(XmlMapping[] xmlMappings, Type[] types, String defaultNamespace, String location, Evidence evidence)
       at System.Xml.Serialization.XmlSerializer.FromMappings(XmlMapping[] mappings, Evidence evidence)
       at System.Web.Services.Protocols.XmlReturn.GetInitializers(LogicalMethodInfo[] methodInfos)
       at System.Web.Services.Protocols.HttpServerType..ctor(Type type)
       at System.Web.Services.Protocols.HttpServerProtocol.Initialize()
       at System.Web.Services.Protocols.ServerProtocol.SetContext(Type type, HttpContext context, HttpRequest request, HttpResponse response)
       at System.Web.Services.Protocols.ServerProtocolFactory.Create(Type type, HttpContext context, HttpRequest request, HttpResponse response, Boolean& abortProcessing) 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T17:08:40.723

您是否检查过临时文件夹的权限？在这些情况下，最简单快捷的解决方案通常是重新运行*aspnet_regiis -i*命令以重新安装 asp.net 框架，该框架还会重置所需文件夹的权限。如果做不到这一点，请尝试使用[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)检查正在发生的事情并相应地修改权限。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-10-08T10:25:14.540

我有同样的问题，以上都没有解决我们的问题——我们通过更改每个应用程序池站点运行的设置来临时恢复服务——你可以通过进入应用程序池来做到这一点——>身份选项卡并更改用户从网络服务到本地用户——虽然我们找出了问题所在（不推荐这样做——所以如果您选择这样做，请确保您了解后果）

然后我们找到了一个关于 Temp\TMP 映射以及如何修复它们的[链接——这不是我们的问题](http://support.microsoft.com/default.aspx?scid=kb;en-us;825791)

在另一个[站点上](http://social.msdn.microsoft.com/Forums/en-US/tfswebaccess/thread/c43238f8-a2ef-4503-aec6-fbf46870d8a4)（如其他答案中所述），我们曾经`Path.GetTempPath()`看到 CLR 实际在寻找什么，结果证明是

> C:\WINDOWS\system32\config\systemprofile\Local Settings\Temp 文件夹

然后，我们使用[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)来验证这实际上是正确的，当我们更改此文件夹的权限时，它可以正常工作。我们仍然不确定 CLR 为何选择停止使用默认临时目录，但我们确实找到了有关它如何做出该决定的链接。[如何选择 GetTempPath](https://stackoverflow.com/questions/2365307/what-determines-the-return-value-of-path-gettemppath)。

更新：我们终于弄清楚当有人决定重复错误时，我们的 Temp 文件夹 PATH 是如何更改的！问题是*有人决定实时运行的*[**CLR Profiler**](http://msdn.microsoft.com/en-us/library/ff650691.aspx) 会更改临时目录的所有权限，所以如果您还不知道这一点，我不建议在 Prod 服务器上运行它。

 ** * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:09:23.247

无论突然变化的原因是什么，您都可以使用异常中描述的步骤来解决问题。

调用 Path.GetTempPath 找出它认为的临时目录是什么，它可能不是你认为的那样。

转到该目录并为用户“网络服务”提供所需的权限，可能是读/写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:17:46.923

确实它是一个在 IIS 中运行的网站？并访问 Web 服务。

它要么作为 ASPNET、匿名运行，要么模拟连接的用户，或者最终 Web 服务本身作为“用户”连接。

无论它是哪个用户，都可能无权访问临时目录。奇怪的是什么都没有改变:)。但是，Windows Service Pack 可以更改安全设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-11T17:43:49.110

Windows Server 2003 - IIS 6.0 - 同样的问题。c:\windows\temp = 当前临时目录 - 按照 cgreeno 的建议使用 procmon 可以让我看到访问被拒绝。我授予用户“所有人”对 c:\windows\temp 文件夹的完全权限，但仍然被拒绝访问。授予组合中所有用户（本地系统、网络服务、应用程序池身份用户等）的完全权限访问权限，但没有帮助。试过 ASPNET_REGIIS -ir 但没有帮助。

我创建了一个新的本地系统用户“tempuser”并分配给本地“管理员”组。我导航到 Windows 服务并停止了“万维网发布”、“IIS Admin”和“HTTP SSL”。我将“tempuser”分配给所有三个服务。我尝试启动每个服务，但由于各种原因它们未能启动。然后我将所有 3 项服务都放回用户“本地系统”，突然我的访问被拒绝错误消失了。不知道为什么。我的 App Pool 用户遇到了其他文件系统错误，但现在也可以正常工作。似乎将本地系统帐户与 Windows 服务的分配出现了问题。

*** 更新 ***

问题又来了。很奇怪...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-26T07:35:27.787

在我的情况下，防病毒（COMDO）对此负责......在防病毒更新后，它刚刚开始阻止访问我的本地服务的临时文件夹（不是全部，只是少数）......弄清楚它有点棘手......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-03-11T08:48:55.377

转到 roslyn 文件夹（进入项目的 bin 文件夹）并在运行应用程序池的用户处添加读/写权限

# .net - DateTimePicker 控件在特定场景下的使用

> ID：542328
> 
> 赞同：1
> 
> 时间：2009-02-12T17:06:12.380
> 
> 标签：.net, winforms, datetimepicker

这个问题与客户为我正在设计的应用程序请求的特定功能有关。基本上，客户希望 DateTimePicker 在选择日期后提示问题。

这听起来很简单，但是，我很难完成这个简单的任务。

1.  **如果我提示 OnCloseUp** - 键盘输入将不会执行此事件
2.  **如果我提示 OnValueChanged** - 每次更改日期时都会触发事件
3.  **如果我提示 OnLeave** - 事件会触发一些。例如，单击工具条时不会触发。我想避免这种方法，因为它只会在用户点击离开控件时触发。

所以基本上，我试图想出在用户从 dateTimePicker 控件中选择日期后提示用户的最佳方式。

我对构建自定义控件也没有任何问题。我已经开始制作一个，因为我还需要允许 NULL 值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:13:40.990

我会使用 OnValueChanged 事件。在他们更改值后，提出问题。如果他们回答错误（例如 - 问：你确定吗？答：不。）然后重置日期选择器并将焦点返回到它。

这个例子有点乱，但它有效。

```
Private is_reset As Boolean = False
Private Sub DateTimePicker1_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DateTimePicker1.ValueChanged

    Dim answer As Integer
    If Not is_reset Then
        answer = MsgBox("Are you Sure?", MsgBoxStyle.YesNo)
        is_reset = False
    End If

    If answer = MsgBoxResult.No Then
        is_reset = True
        DateTimePicker1.Value = Now
        DateTimePicker1.Select()
    End If 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:14:49.413

“选择日期”是指：

1.  用鼠标选择日期，或
2.  使用键盘输入/更改日期，然后将焦点移至另一个控件。

那么，`OnCloseUp`和`OnValidate`/的组合怎么样`OnLeave`？

从观察`OnValueChanged`事件开始。如果有人开火，请设置一个更改的标志。

如果他们使用鼠标进行选择，您可以使用提示符显示`OnCloseUp`并重置您更改的标志。然后`OnValueChanged`再次关注事件。

当`OnValidate`or`OnLeave`触发，并且您的标志已设置（大概是在使用键盘更改日期之后），然后显示提示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T13:45:02.420

我最终编写了一个自定义控件来以正确的方式处理这个问题。我创建了一个带有按钮的文本框，并添加了一个 MonthCalendar 控件。

文本框+按钮打开 MonthCalendar 控件。现在选择日期时间的唯一方法是通过 MonthCalendar。您不能从文本框中进行选择。我还创建了一个在选择日期时触发的自定义事件。它完美地工作。下面的代码：

```
Public Class CustomDatePicker

  'Variables
  Friend WithEvents cal As MonthCalendar
  Private _isCalendarVisible As Boolean = False
  Private _currentSelectedDate As DateTime = Nothing

  'Events
  Public Event OnDateTimeSet(ByVal sender As Object, ByVal dateValue As DateTime)
  Public Event OnDateCleared(ByVal sender As Object)

  'Constructor
  Public Sub New()
    InitializeComponent()
  End Sub

  'Onload
  Private Sub CustomDatePicker_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
    'Initially setup calendar
    cal = New MonthCalendar
    cal.Name = "Calendar"
    cal.MaxSelectionCount = 1
    cal.BringToFront()
    cal.Location = New Point(Me.Location.X + 5, Me.Location.Y + 25)
    Me.Parent.Controls.Add(cal)
    cal.Hide()
    _isCalendarVisible = False
  End Sub

  'Returns the currently selected date from the TextBox field
  Public ReadOnly Property CurrentSelectedDate()
    Get
      Return _currentSelectedDate
    End Get
  End Property

  'Display calendar
  Private Sub ShowCalendar()

    'Close any other custom date controls that are open on the parent form
    Dim cont As Control
    For Each cont In Parent.Controls
      If (cont.GetType().Name = "CustomDatePicker") Then
        CType(cont, CustomDatePicker).HideCalendar()
      End If
    Next

    'display the calendar
    If Not (_isCalendarVisible) Then
      tbxSelectedDate.BackColor = Color.Cornsilk
      cal.BringToFront()
      cal.Show()
      cal.Focus()
      _isCalendarVisible = True
      btnCalendarToggle.Checked = True
    End If

  End Sub

  'Hide the Calendar
  Private Sub HideCalendar()
    If (_isCalendarVisible) Then
      tbxSelectedDate.BackColor = Color.White
      cal.Hide()
      _isCalendarVisible = False
      btnCalendarToggle.Checked = False
      tbxSelectedDate.Focus()
    End If
  End Sub

  'Display the selected datetime into the textbox
  Private Sub SetDateTime()
    Me.tbxSelectedDate.Text = FormatDateTime(cal.SelectionRange.Start, DateFormat.LongDate)
    _currentSelectedDate = FormatDateTime(cal.SelectionRange.Start, DateFormat.LongDate)
    RaiseEvent OnDateTimeSet(Me, _currentSelectedDate)
  End Sub

  'Event when selection is made in the Calendar
  Private Sub Calendar_Selection(ByVal sender As System.Object, ByVal e As System.Windows.Forms.DateRangeEventArgs) Handles cal.DateSelected
    SetDateTime()
    HideCalendar()
  End Sub

  'Handle the keyboard events associated with the calendar control
  Private Sub Calendar_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles cal.KeyPress
    If e.KeyChar = ChrW(Keys.Return) Then
      SetDateTime()
      HideCalendar()
    ElseIf e.KeyChar = ChrW(Keys.Escape) Then
      HideCalendar()
    End If
  End Sub

  'Handles keypresses on the textbox field
  Private Sub tbxSelectedDate_KeyUp(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles tbxSelectedDate.KeyUp
    If (e.KeyCode = Keys.Down) Then
      ShowCalendar()
    ElseIf (e.KeyCode = Keys.Delete) Then
      tbxSelectedDate.Text = ""
    End If
  End Sub

  'Show the calendar when button is clicked
  Private Sub btnCalendarToggle_MouseUp(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles btnCalendarToggle.MouseUp
    ToggleCalendar()
  End Sub

  'Show the calendar when button is 'clicked' via ENTER on keyboard
  Private Sub btnCalendarToggle_KeyPress(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyPressEventArgs) Handles btnCalendarToggle.KeyPress
    If e.KeyChar = ChrW(Keys.Return) Then
      ToggleCalendar()
    End If
  End Sub

  'Toggle calender.  If on, turn off.  If off, turn on.
  Private Sub ToggleCalendar()
    If Not (_isCalendarVisible) Then
      ShowCalendar()
      btnCalendarToggle.Checked = True
    Else
      HideCalendar()
      btnCalendarToggle.Checked = False
    End If
  End Sub

  'When textbox value is changed, check to see if it was cleared.  If cleared, raiseevent.
  Private Sub tbxSelectedDate_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tbxSelectedDate.TextChanged
    If (tbxSelectedDate.Text = "") Then
      _currentSelectedDate = Nothing
      RaiseEvent OnDateCleared(Me)
    End If
  End Sub 
```

# eclipse - 每当在 Eclipse 中打开新编辑器时，我如何得到通知？

> ID：542338
> 
> 赞同：5
> 
> 时间：2009-02-12T17:07:24.093
> 
> 标签：eclipse, eclipse-plugin, eclipse-pde

我有一个视图希望收到所有当前打开的编辑器的通知。我在哪里可以添加一个监听器来实现这一点？

我期待 WorkbenchPage 或 EditorManager 有一些合适的监听器注册表，但我找不到它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T21:19:31.057

您的视图是否使用[`org.eclipse.ui.IPartListener2`](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/api/org/eclipse/ui/IPartListener2.html)?

这就是使用此[EditorListener](http://www.koders.com/java/fidC16A4CE2FC6A7F818AD035376967CA06F87DBA4F.aspx?s=EditorListener+IPartListener2#L27)的原因，它的工作是针对给定视图对 Editor 事件（包括打开和关闭）做出反应

```
public class EditorListener implements ISelectionListener, IFileBufferListener,
IPartListener2 {
    protected BytecodeOutlineView view;

    EditorListener(BytecodeOutlineView view){
        this.view = view;
    }

[...] 

    /**
     * @see org.eclipse.ui.IPartListener2#partOpened(org.eclipse.ui.IWorkbenchPartReference)
     */
    public void partOpened(IWorkbenchPartReference partRef) {
        view.handlePartVisible(partRef.getPart(false));
    } 
```

* * *

现在，如果您`ViewPart`直接实现 an `IPartListener2`，它可以将自己注册到各种`Editors`，就像这样[`BytecodeReferenceView`](http://www.koders.com/java/fid44B9CA94742C6FE34142932F9531FB5E438F338E.aspx?s=EditorListener+IPartListener2)

```
public class BytecodeReferenceView extends ViewPart implements IPartListener2, ISelectionListener {

    [...]

    public void createPartControl(Composite parent) {
        browser = new Browser(parent, SWT.BORDER);
        browser.setText(BytecodeOutlinePlugin.getResourceString(NLS_PREFIX
            + "empty.selection.text"));
        final IWorkbenchWindow workbenchWindow = getSite().getWorkbenchWindow();
        workbenchWindow.getPartService().addPartListener(this);
    [...] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:15:35.930

我认为你在正确的轨道上。您需要监听 IWorkbenchPage [IPartService](http://download.eclipse.org/eclipse/downloads/documentation/2.0/html/plugins/org.eclipse.platform.doc.isv/reference/api/org/eclipse/ui/IPartService.html)事件：

```
page.addPartListener(new IPartListener() {
    partOpened(IWorkbenchPart part) {
        ...
    }

    ...
}); 
```

# oracle - 如何解决 Oracle 数据库服务器错误？

> ID：542340
> 
> 赞同：0
> 
> 时间：2009-02-12T17:08:28.600
> 
> 标签：oracle, oracle10g, connectivity

我的团队继承了一个基于 Oracle 的 Web 应用程序，他们对 Oracle 数据库服务器相当缺乏经验。

Oracle 10g 服务器在具有大量磁盘空间的 Windows 2003 Server 上运行，并且有时会丢失所有连接，应用程序停止工作，甚至 SQL Plus 都无法连接到数据库服务器。

但是当我们检查 Windows 服务管理器时，它说服务已启动并正在运行。重新启动通常可以解决问题，但我们需要对其进行适当的故障排除，以便我们知道是什么原因造成的，这样我们就可以避免它再次发生。

我们应该从哪里开始寻找线索？我们应该调查哪些关键日志文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:13:48.620

在服务器上，您应该有一个名为 ORACLE_HOME 的环境变量，它指示 Oracle 安装的根目录。Oracle 跟踪/转储文件夹很可能在此处。搜索名为“bdump”（背景转储）的文件夹。这就是主日志文件（称为警报日志）以及后台进程生成的跟踪文件所在的位置。将有一个名为“udump”的相邻文件，其中包含用户进程生成的任何跟踪文件。

但是，我真正的建议是，您应该聘请了解 Oracle 的人或让 Oracle Support 参与其中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:11:45.363

警报日志将是第一个要检查的文件。

它可能位于 $ORACLE_HOME/admin/bdump 并（可能）称为 alert_DATABASE-SID.log

它包含数据库执行的大部分重要操作，以及发生的任何重要错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T19:23:11.460

我不得不同意 cagcowboy。检查警报日志是否有错误。如果没有错误，则维护一个 sysdba 登录到数据库，当它挂起时，尝试进行挂起分析。参见关于hanganalyze 的metalink note 215858.1。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:13:28.260

你试过[`tnsping`](http://www.orafaq.com/wiki/Tnsping)吗？我们偶尔会遇到需要 DBA 协助的侦听器问题。 `tnsping`是我们用来进行分类的诊断工具。

如果可能的话，我会建议聘用一位经验丰富的 Oracle DBA。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-28T07:22:38.213

检查警报日志以了解 Db 的结构。有时错误设置的参数会导致挂起或性能下降。或者您可以关闭并以挂载模式启动，然后检查 v$parameter 值是否存在问题。设置总内存非常重要。

# cocoa - Display logging output in Cocoa

> ID：542353
> 
> 赞同：2
> 
> 时间：2009-02-12T17:10:39.657
> 
> 标签：cocoa, pyobjc

What is the best way to display constantly updated logging output using Cocoa Components? The output is line-based and generated by the application. Appending lines should be fast, and the view should automatically scroll to the bottom. All in all, it should work and look like basic standard out in a terminal.

My code is written in Python, using the PyObjC bridge. I'm looking for approaches/examples I can adapt, Objective-C code is welcome.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T18:40:20.423

It seems that there are two options: (1) use an NSTableView and (2) use an NSTextView. Console.app appears to use an NSTableView but an NSTextView is probably less code.

For (1), I would write an NSTableDataSource that returns the appropriate line (either from memory or from disk) for `tableView_objectValueForTableColumn_rowIndex_` and the total number of log lines for `numberOfRowsInTableView_`. Set this data source as the dataSource for an NSTableView. You may need to call `tableView.reloadData()` to redisplay the data when a new log line comes in. Assuming the table view is embedded in an NSScrollView (the default if you create the table view in Interface Builder), you can scroll to the bottom with this method from the Apple Scroll View Programming Guide (easily translated to Python)

```
- (void)scrollToBottom:sender;
{
    NSPoint newScrollOrigin;

    // assume that the scrollview is an existing variable
    if ([[scrollview documentView] isFlipped]) {
        newScrollOrigin=NSMakePoint(0.0,NSMaxY([[scrollview documentView] frame])
                                       -NSHeight([[scrollview contentView] bounds]));
    } else {
        newScrollOrigin=NSMakePoint(0.0,0.0);
    }

    [[scrollview documentView] scrollPoint:newScrollOrigin];

} 
```

Obviously, this code assumes that you've got an IBOutlet to the scroll view.

For (2), you can add a line to the end of the text view with `textView.textStorage().appendString_(new_log + '\n')` (assuming there isn't already a newline on the end). You can force the enclosing scroll view to scroll to the end (indirectoy) by calling `textView.setSelectedRange_(NSMakeRange(textView.textStorage().length(),0))`

# linux - 使用什么 Linux/Unix 软件将 html 或 pdf 转换为 doc？

> ID：542357
> 
> 赞同：6
> 
> 时间：2009-02-12T17:12:23.817
> 
> 标签：linux, doc

我需要尽可能准确地将 css 样式的 (x)html 或 pdf 转换为 doc，并从 cli 在 Linux（如果可能的话也可以在 Mac 上）执行此操作。不幸的是，OpenOffice 无法处理布局。有没有这样的软件或库，免费的商业？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T18:24:22.817

你可以试试[media-convert.com](http://media-convert.com/)

# c# - Visual Studio 与 Visual Web 开发人员

> ID：542359
> 
> 赞同：5
> 
> 时间：2009-02-12T17:12:54.317
> 
> 标签：c#, asp.net-mvc, visual-studio, ide, visual-web-developer

我正在尝试使用**ASP.NET MVC**编写一个 Web 应用程序。我更喜欢**C#**作为编程语言。

哪个 IDE 更适合用于此目的？**Visual Studio**或**Visual Web 开发人员**？

IDE 的特点是什么？使用其中一个有什么好处？

提前致谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-12T17:18:28.280

据我了解，[Visual Web Developer](http://www.microsoft.com/express/vwd/) (VWD) 只是开发基于 Web 的解决方案所必需的[Visual Studio](http://www.microsoft.com/visualstudio/en-us/default.mspx)组件的免费版本。

这是您在 Visual Studio 2008 (VS2008) 专业版中获得的[VWD 缺少的功能列表。](http://blogs.msdn.com/mikhailarkhipov/archive/2006/06/26/647516.aspx)简而言之，VWD Express 2005

> 1.  不能与其他附加组件或第三方工具一起**扩展**
>     
>     
> 2.  **仅支持网站项目 (2005)。**您不能将类库项目或 Web 控件库项目添加到解决方案中。
>     
>     
> 
> **UPDATED-VWD 2008 SP1 还允许在解决方案中使用 Web 应用程序和类库项目**。
> 
> 3.  **缺乏**结合**源代码控制的能力**
>     
>     
> 4.  没有**辅助功能检查器**
>     
>     
> 5.  **缺乏****自动生成本地化资源的**能力
>     
>     
> ***   **无法将调试器附加到进程**
>     
>     *   没有**原生代码调试****

 **VWD 与 VS2008 相比的明显优势在于它是免费的，如果您可以在缺少功能的情况下巧妙地使用它，那么它可能是您更实用的选择。如果这些功能是您无法缺少的，那么 VS2008 可能是一项明智的投资——您还可以获得其他 Express 产品（Visual Basic 2008、Visual C# 2008 等）所缺少的所有功能。

查看[MSDN 的 Visual Studio 2005 比较图表](http://msdn.microsoft.com/en-us/vstudio/aa700921.aspx)。我找不到 2008 年的，但会怀疑它非常相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:21:39.850

Visual Studio 将允许您整合源代码控制并将调试附加到 IIS 进程。

作为一个单独开发一些纯 ASP.NET-MVC 应用程序的开发人员，Web Developer 会做，对于认真的工作，你真的需要工作室。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:29:16.523

我认为您也缺乏在没有 Visual Studio 的情况下发布网站的能力，您当然可以运行网站，但它不会构建用于发布的二进制文件，对于 Web 开发人员，您必须将源发布到 iis。

# javascript - 与 javascript Internet Explorer 的 Flash 交互

> ID：542360
> 
> 赞同：0
> 
> 时间：2009-02-12T17:13:05.843
> 
> 标签：javascript, flash, internet-explorer, interaction

我有一个与 javascript 函数交互的 flash 对象。除了在 IE（所有版本）中我尝试使用 swfobject 和经典嵌入之外，交互在每个浏览器中都可以正常工作。AllowScriptAccess 设置为“始终”。这个缺陷有什么原因吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:44:02.430

如果您使用的是 ExternalInterface，则问题可能与您尝试在 JavaScript 中引用对象的方式有关。 [看看我对这个问题的回答](https://stackoverflow.com/questions/472026/problem-with-flash-externalinterface-on-google-app-engine#472184)——它可能不是完全相同的问题，但我的回答提供了一个在 IE 上测试过的 ExternalInterface 的端到端示例，所以你可能想将它与你的自己看看是否有任何遗漏或不合适的地方。

但是，如果这没有帮助，请尝试发布一些代码，这样我们就可以看看发生了什么，也许可以更具体地诊断问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T18:07:15.073

如果您从文件运行测试而不是在网络服务器上进行测试，则可能是因为安全设置。

# asp.net - application_start 意外触发 asp.net

> ID：542369
> 
> 赞同：6
> 
> 时间：2009-02-12T17:14:27.603
> 
> 标签：asp.net, global-asax, web-applications

我正在查看一个 asp.net 应用程序，该应用程序在 global.asax 内部开始调用应用程序内的数据库。这些调用运行大约需要 3 秒（取决于 SQL 缓存计划）。我注意到当我第一次重新部署时应用程序运行**缓慢。**我把它归结为应用程序启动时对数据库的调用。然而，几分钟后，应用程序再次需要时间来加载。

为了找出发生了什么，我已经写入了一个日志文件（见下文）。从这个文件中，您可以看到当多个请求第一次命中应用程序时，应用程序启动会多次触发。然后似乎 application_start 以随机方式触发（2-10分钟内的任何时间）。

根据我对 application_starts 工作原理的理解，它应该只在应用程序 FIRST 启动时触发，但它似乎是从多个客户端随机触发的！根据 MSDN *“应用程序启动时第一次触发 Application_Start 事件。”*

谁能帮我弄清楚发生了什么？我正在使用 IIS6 和 .net 2.0。它是我缺少的应用程序池设置吗？

非常感谢里波

```
[12/02/2009 16:16:58] 91.84.25.241 - Application started, Sub MyRules started
[12/02/2009 16:17:06] 65.55.51.34 - Application started, Sub MyRules started
[12/02/2009 16:17:07] 91.84.25.241 - Application started, Sub MyRules completed
[12/02/2009 16:17:10] 65.55.51.34 - Application started, Sub MyRules completed
[12/02/2009 16:17:26] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:30] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:30] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:33] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:33] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:36] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:36] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:39] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:42] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:48] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:48] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:52] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:17:52] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:17:54] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:18:27] 91.84.25.241 - Application started, Sub MyRules started
[12/02/2009 16:18:31] 91.84.25.241 - Application started, Sub MyRules completed
[12/02/2009 16:18:31] 212.115.51.229 - Application started, Sub MyRules started
[12/02/2009 16:18:33] 212.115.51.229 - Application started, Sub MyRules completed
[12/02/2009 16:29:26] 167.230.38.115 - Application started, Sub MyRules started
[12/02/2009 16:29:28] 167.230.38.115 - Application started, Sub MyRules completed
[12/02/2009 16:29:34] 82.110.42.84 - Application started, Sub MyRules started
[12/02/2009 16:29:37] 82.110.42.84 - Application started, Sub MyRules completed
[12/02/2009 16:29:38] 82.110.42.84 - Application started, Sub MyRules started
[12/02/2009 16:29:41] 82.110.42.84 - Application started, Sub MyRules completed
[12/02/2009 16:32:53] 99.142.1.97 - Application started, Sub MyRules started
[12/02/2009 16:32:57] 99.142.1.97 - Application started, Sub MyRules completed
[12/02/2009 16:32:57] 99.142.1.97 - Application started, Sub MyRules started
[12/02/2009 16:33:01] 99.142.1.97 - Application started, Sub MyRules completed
[12/02/2009 16:33:01] 99.142.1.97 - Application started, Sub MyRules started
[12/02/2009 16:33:06] 99.142.1.97 - Application started, Sub MyRules completed
[12/02/2009 16:33:06] 99.142.1.97 - Application started, Sub MyRules started
[12/02/2009 16:33:10] 99.142.1.97 - Application started, Sub MyRules completed
[12/02/2009 16:33:11] 99.142.1.97 - Application started, Sub MyRules started
[12/02/2009 16:33:16] 99.142.1.97 - Application started, Sub MyRules completed
[12/02/2009 16:36:15] 65.55.51.34 - Application started, Sub MyRules started
[12/02/2009 16:36:17] 65.55.51.34 - Application started, Sub MyRules completed
[12/02/2009 16:41:37] 119.123.226.156 - Application started, Sub MyRules started
[12/02/2009 16:41:37] 62.49.121.122 - Application started, Sub MyRules started
[12/02/2009 16:41:40] 62.49.121.122 - Application started, Sub MyRules completed
[12/02/2009 16:41:40] 119.123.226.156 - Application started, Sub MyRules completed
[12/02/2009 16:41:41] 62.49.121.122 - Application started, Sub MyRules started
[12/02/2009 16:41:44] 62.49.121.122 - Application started, Sub MyRules completed
[12/02/2009 16:45:17] 84.70.249.242 - Application started, Sub MyRules started
[12/02/2009 16:45:19] 84.70.249.242 - Application started, Sub MyRules completed
[12/02/2009 16:47:03] 80.41.121.68 - Application started, Sub MyRules started
[12/02/2009 16:47:05] 80.41.121.68 - Application started, Sub MyRules completed
[12/02/2009 16:47:29] 81.179.26.249 - Application started, Sub MyRules started
[12/02/2009 16:47:31] 81.179.26.249 - Application started, Sub MyRules completed
[12/02/2009 16:47:59] 81.136.179.170 - Application started, Sub MyRules started
[12/02/2009 16:47:59] 81.136.179.170 - Application started, Sub MyRules started
[12/02/2009 16:48:02] 81.136.179.170 - Application started, Sub MyRules completed
[12/02/2009 16:48:02] 81.136.179.170 - Application started, Sub MyRules started
[12/02/2009 16:48:02] 81.136.179.170 - Application started, Sub MyRules completed
[12/02/2009 16:48:02] 81.136.179.170 - Application started, Sub MyRules started
[12/02/2009 16:48:04] 81.136.179.170 - Application started, Sub MyRules completed
[12/02/2009 16:48:04] 81.136.179.170 - Application started, Sub MyRules completed
[12/02/2009 16:52:35] 69.34.161.80 - Application started, Sub MyRules started
[12/02/2009 16:52:35] 69.34.161.80 - Application started, Sub MyRules started
[12/02/2009 16:52:35] 69.34.161.80 - Application started, Sub MyRules started
[12/02/2009 16:52:38] 69.34.161.80 - Application started, Sub MyRules completed
[12/02/2009 16:52:38] 69.34.161.80 - Application started, Sub MyRules started
[12/02/2009 16:52:39] 69.34.161.80 - Application started, Sub MyRules completed
[12/02/2009 16:52:39] 69.34.161.80 - Application started, Sub MyRules completed
[12/02/2009 16:52:40] 69.34.161.80 - Application started, Sub MyRules completed 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-12T18:32:48.460

检查应用程序在什么情况下会重新启动。最近我们正在向 bin 文件夹写入一些日志条目，并且发生了完全相同的事情，我们不明白原因。**然后终于意识到对 bin 文件夹进行任何修改都会导致应用程序重新启动。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:17:57.017

检查事件日志，某些原因导致应用程序池回收。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-24T19:12:06.637

我在多次调用 Application_Start 时遇到问题，事实证明这是因为我设置了多个实例。愚蠢的错误，但我想指出它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-31T22:13:19.677

我不知道为什么，但我在我的日志中看到了同样的事情。可能是因为它花费的时间太长并且您同时有多个请求？无论如何，为了安全起见，我添加了以下代码：

```
public class MvcApplication : HttpApplication
{
    private static volatile bool hasRegisteredBgTasks = false;
    private static object registeredBgTasksLock = new object();

    protected void Application_Start()
    {
        lock (registeredBgTasksLock)
        {
            if (hasRegisteredBgTasks)
            {
                return;
            }
            // Actual start up code.
            hasRegisteredBgTasks = true;
        }
    }

    // Other Application methods...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-11T17:18:13.993

原来是一个泄漏的dll...

# iis-6 - httpHandler 适用于虚拟目录但不适用于类似配置的网站

> ID：542374
> 
> 赞同：0
> 
> 时间：2009-02-12T17:15:16.277
> 
> 标签：iis-6, httphandler, virtual-directory

我正在建立一个大量使用 httpHandlers 的第三方网站。当在 2003/IIS6 机器上配置为默认站点下的虚拟目录时，一切都按预期工作。但是，当在同一台机器上配置为独立站点时，指向同一目录和 web.config，httpHandlers 不起作用（404）。

我尝试了对处理程序标签的路径值的各种更改，但没有结果。页面本身以及应用程序的代码似乎都在独立站点内执行 find。

我可能会遗漏任何明显的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:57:18.903

找到我自己的答案，是一件很简单的事情。

安装程序包安装了站点的虚拟目录版本，并负责添加文件扩展名映射。独立版是手动配置的，因此我错过了添加映射。

解决。

# iphone - 如何从 UISegmentcontroller 获取值

> ID：542376
> 
> 赞同：0
> 
> 时间：2009-02-12T17:15:46.883
> 
> 标签：iphone, uisegmentedcontrol

我通过 Interface Builder 创建了段控制。创建了一个 IBAction 并链接到段控制器的值更改选项。

```
- (IBAction)GenderBttonAction:(id)sender {
    printf("\n Segemt Controll");
   } 
```

当我单击段控制器时，此方法正在调用，但我将如何获得段控制器的选定索引值。请帮助我亲爱的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T17:29:00.330

```
((UISegmentedControl *)sender).selectedSegmentIndex; 
```

:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-03T01:20:48.197

我在 view controller.m 中使用以下代码来表示启动模态控制器，它似乎对我很有用。

```
- (void)viewDidLoad 
{
    NSArray *segmentContent = [NSArray arrayWithObjects:
                               NSLocalizedString(@"view 1", @""),
                               NSLocalizedString(@"view 2", @""),
                               NSLocalizedString(@"Close", @""),
                               nil];
     //or images insted of text
     //NSArray *segmentContent = [NSArray arrayWithObjects:
        //                          [UIImage imageNamed:@"pic.png"],
        //                          [UIImage imageNamed:@"spic.png"],
        //                          [UIImage imageNamed:@"close.png"],
        //                          nil]];

    UISegmentedControl *segmentedControl = [[UISegmentedControl alloc] initWithItems:segmentContent];
    segmentedControl.selectedSegmentIndex = UISegmentedControlNoSegment;
    segmentedControl.momentary = YES; // option
    segmentedControl.autoresizingMask = UIViewAutoresizingFlexibleWidth;
    segmentedControl.segmentedControlStyle = UISegmentedControlStyleBar;
    segmentedControl.frame = CGRectMake(0, 0, 160, 30);
    [segmentedControl addTarget:self action:@selector(segmentAction:) forControlEvents:UIControlEventValueChanged];
    UIBarButtonItem *segments = [[UIBarButtonItem alloc] initWithCustomView:segmentedControl];
    [segmentedControl release];
    self.navigationItem.rightBarButtonItem = segments;
    self.navigationItem.title = @"My title";
    [segments release]; 
```

然后添加选择操作，如果您启动了模态控制器，最后一个是关闭语句。

```
- (IBAction)segmentAction:(id)sender
{
    UISegmentedControl *segmentedControl = (UISegmentedControl *)sender;
    switch ([sender selectedSegmentIndex])
    {
        case 0: 
        {   

// Do stuff like launch a modal controller. But don't forget to add this all into your modal controller views to get back out :)
InfoViewController *infoViewController = [[InfoViewController alloc] initWithNibName:@"InfoViewController" bundle:nil];
            UINavigationController *aInfoViewController = [[UINavigationController alloc] initWithRootViewController:infoViewController];
            [self presentModalViewController:aInfoViewController animated:YES];

        break;
    }
    case 1: 
    {

// do stuff

break;
    }
    case 2: 
    {
        [self.parentViewController dismissModalViewControllerAnimated:YES];         
        break;
    }
}
NSLog(@"Segment clicked: %d", segmentedControl.selectedSegmentIndex);
} 
```

如果需要通过这种方式关闭模态框，请使用下面的方法。

```
- (IBAction)dismissAction:(id)sender
{
    [self.parentViewController dismissModalViewControllerAnimated:YES];
} 
```

并且不要忘记在相同的相应 h 文件中声明操作/方法。

```
- (IBAction)dismissAction:(id)sender; 
```

希望这可以帮助。

真诚的，柯克

# c# - 在 Windows 窗体应用程序表单中嵌入文件资源管理器实例

> ID：542378
> 
> 赞同：12
> 
> 时间：2009-02-12T17:16:40.127
> 
> 标签：c#, winforms, explorer

我的（C#，.NET 3.5）应用程序生成文件，除了引发可以捕获和响应的事件之外，我还想以表单的形式向用户显示目标文件夹。文件列表以与其他信息相同的形式显示。

我正在使用`WebBrowser`控件 ( `System.Windows.Forms.WebBrowser`) 的一个实例，然后导航到该文件夹​​。这显示了资源管理器窗口的一些默认视图，文件摘要面板位于左侧，文件位于“Tiles”（大图标和文本）视图中。

例如，

```
wb.Navigate(@"c:\path\to\folder\"); 
```

我想抑制面板并在详细信息视图中查看文件列表。用户可以通过右键单击上下文菜单来访问它，但我希望它自动出现。

我宁愿不必构建自己的 TreeView、DataGridView 或其他任何东西；WebBrowser 控件“免费”完成所有更新和重新排序以及诸如此类的事情。

有没有更好的办法？要使用的不同控件或要传递给控件的一些附加参数？

如果我可以捕获事件（例如，文件被选择/重命名/双击等），那就更好了！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-22T03:04:53.043

警告：包含大量代码的长帖子。

当您将 Web 浏览器控件导航到文件系统文件夹时，Web 浏览器控件会承载一个 shell 视图窗口，该窗口又承载资源管理器列表视图。事实上，这与 Explorer 进程以及文件对话框和 Internet Explorer 所做的完全相同。这个 shell 窗口不是一个控件，因此没有可以在其上调用的方法或可以订阅的事件，但它可以接收窗口消息并且可以被子类化。

事实证明，处理自动将视图设置为 Details 的问题部分实际上非常简单。在 Web 浏览器控件的 Navigated 事件中，只需找到 shell 视图窗口的句柄并向其发送带有特定 shell 常量 (SHVIEW_REPORT) 的 WM_COMMAND 消息。这是一个未记录的命令，但它在包括 Windows 2008 在内的所有 Windows 平台上都受支持，并且几乎可以肯定会在 Windows 7 上。添加到 Web 浏览器表单的一些代码证明了这一点：

```
 private delegate int EnumChildProc(IntPtr hwnd, IntPtr lParam);

    [DllImport("user32.dll", SetLastError = true)]
    private static extern IntPtr SendMessage(IntPtr hWnd, int Msg,
        IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll", SetLastError = true)]
    private static extern int EnumChildWindows(IntPtr hWndParent,
        EnumChildProc lpEnumFunc, IntPtr lParam);

    [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    private static extern int GetClassName(IntPtr hWnd, StringBuilder lpClassName,
        int nMaxCount);

    private const int WM_COMMAND = 0x0111;
    private const int SHVIEW_REPORT = 0x702C;
    private const string SHELLVIEW_CLASS = "SHELLDLL_DefView";

    private IntPtr m_ShellView;

    void webBrowser1_Navigated(object sender, WebBrowserNavigatedEventArgs e)
    {
        m_ShellView = IntPtr.Zero;
        EnumChildWindows(webBrowser1.Handle, EnumChildren, IntPtr.Zero);
        if (m_ShellView != IntPtr.Zero)
        {
            SendMessage(m_ShellView, WM_COMMAND, (IntPtr)SHVIEW_REPORT, (IntPtr)0);
        }
    }

    private int EnumChildren(IntPtr hwnd, IntPtr lParam)
    {
        int retval = 1;

        StringBuilder sb = new StringBuilder(SHELLVIEW_CLASS.Length + 1);
        int numChars = GetClassName(hwnd, sb, sb.Capacity);
        if (numChars == SHELLVIEW_CLASS.Length)
        {
            if (sb.ToString(0, numChars) == SHELLVIEW_CLASS)
            {
                m_ShellView = hwnd;
                retval = 0;
            }
        }

        return retval;
    } 
```

每次 Web 浏览器导航到新窗口时（包括从资源管理器视图中打开文件夹时），都会创建一个新的 shell 视图窗口，因此必须在每个 Navigated 事件中将消息重新发送到新窗口。

对于您问题的第二部分，您希望从资源管理器列表视图中接收事件。这比第一部分要困难得多。为此，您需要对列表视图窗口进行子类化，然后监视您感兴趣的窗口消息（例如 WM_LBUTTONDBLCLK）。为了对窗口进行子类化，您需要创建自己的从 NativeWindow 类派生的类，并为其分配您需要监视的窗口的句柄。然后，您可以覆盖其 Window 过程并根据需要处理各种消息。下面是一个创建双击事件的示例 - 它相对简单，但要广泛访问资源管理器列表视图可能需要比您愿意做的更多工作。

将此添加到您的表单中：

```
 private ExplorerListView m_Explorer;

    void OnExplorerItemExecuted(object sender, ExecuteEventArgs e)
    {
        string msg = string.Format("Item to be executed: {0}{0}{1}", 
            Environment.NewLine, e.SelectedItem);
        e.Cancel = (MessageBox.Show(msg, "", MessageBoxButtons.OKCancel) 
            == DialogResult.Cancel);
    } 
```

这两行到 Navigated 事件处理程序（就在 SendMessage 之后）：

```
 m_Explorer = new ExplorerListView(m_ShellView);
    m_Explorer.ItemExecuted += OnExplorerItemExecuted; 
```

然后添加以下类：

```
class ExplorerListView : NativeWindow
{

    public event EventHandler<ExecuteEventArgs> ItemExecuted;

    [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    private static extern IntPtr SendMessage(IntPtr hWnd, int Msg,
        IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    private static extern IntPtr FindWindowEx(IntPtr hwndParent,
        IntPtr hwndChildAfter, string lpszClass, string lpszWindow);

    private const int WM_LBUTTONDBLCLK = 0x0203;

    private const int LVM_GETNEXTITEM = 0x100C;
    private const int LVM_GETITEMTEXT = 0x1073;

    private const int LVNI_SELECTED = 0x0002;

    private const string EXPLORER_LISTVIEW_CLASS = "SysListView32";

    public ExplorerListView(IntPtr shellViewHandle)
    {
        base.AssignHandle(FindWindowEx(shellViewHandle, IntPtr.Zero, 
            EXPLORER_LISTVIEW_CLASS, null));
        if (base.Handle == IntPtr.Zero)
        {
            throw new ArgumentException("Window supplied does not encapsulate an explorer window.");
        }
    }

    protected override void WndProc(ref Message m)
    {
        switch (m.Msg)
        {
            case WM_LBUTTONDBLCLK:
                if (OnItemExecution() != 0) return;
                break;
            default:
                break;
        }
        base.WndProc(ref m);
    }

    private int OnItemExecution()
    {
        int cancel = 0;
        ExecuteEventArgs args = new ExecuteEventArgs(GetSelectedItem());
        EventHandler<ExecuteEventArgs> temp = ItemExecuted;
        if (temp != null)
        {
            temp(this, args);
            if (args.Cancel) cancel = 1;
        }
        return cancel;
    }

    private string GetSelectedItem()
    {
        string item = null;

        IntPtr pStringBuffer = Marshal.AllocHGlobal(2048);
        IntPtr pItemBuffer = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(LVITEM)));

        int selectedItemIndex = SendMessage(base.Handle, LVM_GETNEXTITEM, (IntPtr)(-1), (IntPtr)LVNI_SELECTED).ToInt32();
        if (selectedItemIndex > -1)
        {
            LVITEM lvi = new LVITEM();
            lvi.cchTextMax = 1024;
            lvi.pszText = pStringBuffer;
            Marshal.StructureToPtr(lvi, pItemBuffer, false);
            int numChars = SendMessage(base.Handle, LVM_GETITEMTEXT, (IntPtr)selectedItemIndex, pItemBuffer).ToInt32();
            if (numChars > 0)
            {
                item = Marshal.PtrToStringUni(lvi.pszText, numChars);
            }
        }

        Marshal.FreeHGlobal(pStringBuffer);
        Marshal.FreeHGlobal(pItemBuffer);

        return item;
    }

    struct LVITEM
    {
        public int mask;
        public int iItem;
        public int iSubItem;
        public int state;
        public int stateMask;
        public IntPtr pszText;
        public int cchTextMax;
        public int iImage;
        public IntPtr lParam;
        public int iIndent;
        public int iGroupId;
        int cColumns; // tile view columns
        public IntPtr puColumns;
        public IntPtr piColFmt;
        public int iGroup;

    }
}

public class ExecuteEventArgs : EventArgs
{
    public string SelectedItem { get; private set; }
    public bool Cancel { get; set; }

    internal ExecuteEventArgs(string selectedItem)
    {
        SelectedItem = selectedItem;
    }
} 
```

这应该让你知道你需要做什么。如果您想要的不仅仅是相当简单的事件，您可能需要寻找替代控件，尽管从我在免费和低成本区域中看到的情况来看，有一些相当不错的控件，但它们都有一些怪癖并且不会提供无缝的资源管理器经验。

请记住，此代码很快就组合在一起，没有错误处理或注释，并且忽略了多个问题，例如多个选定的项目，因此将其用作指南，风险自负。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-21T10:05:46.503

为了处理重命名、删除和进行其他自定义，您需要编写自己的文件资源管理器。WebBrowser 控件不适合您的需要。它只是 ActiveX 组件的包装器。
您应该查看[此 codeproject 文章](http://www.codeproject.com/KB/miscctrl/FileBrowser.aspx)。它包含文件资源管理器的实现。[文件浏览器示例](http://www.c-sharpcorner.com/UploadFile/ssrivastav/AdvancedFileExplorerusingCSharpandWindowsForms11232005033710AM/AdvancedFileExplorerusingCSharpandWindowsForms.aspx)不多：
[一二](http://www.c-sharpcorner.com/UploadFile/satisharveti/enhancedWinExplorer02092009014722AM/enhancedWinExplorer.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T06:44:12.797

LogicNP 软件有两个控件（FileView 和 ShComboBox），可以满足您的需求： [http ://www.ssware.com/fldrview.htm](http://www.ssware.com/fldrview.htm)

您可以从他们的页面下载试用版，但许可证约为 130 美元。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-28T01:41:05.653

我写了一个库，也许可以帮助你。您可以在以下网址找到它： http: [//gong-shell.sourceforge.net/](http://gong-shell.sourceforge.net/)

您要查找的控件是 ShellView。那里也有关于如何用几行代码创建一个简单的 Windows 资源管理器克隆的教程。

**Note for .NET 4.0 users**: Gong-shell is currently broken for 4.0\. The framework introduced changes in Interop and it will build just fine but cause different issues when interfacing with shell32 (notably the shellicon api, leading to an unmanaged null pointer dereference).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T00:18:56.217

如果您很高兴仅使用 Windows Vista 并包装[COM](http://en.wikipedia.org/wiki/Component_Object_Model)控件，则[IExplorerBrowser](http://msdn.microsoft.com/en-us/library/bb761909.aspx)可能可以满足您的需要。

[这篇 The Code Project 文章](http://www.codeproject.com/KB/vista/ExplorerBrowser.aspx)展示了它在[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)程序中的使用，但[至少有其他人](http://relatedterms.com/ViewThread.aspx?t=1624655)在经过一番努力后似乎已经让它在 C# 中工作。

较新的 API 提供了比简单地拦截消息更多的可编程性，但它（显然）对旧平台毫无用处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T11:24:30.913

[在这里](http://www.codeproject.com/KB/list/FileSystemListView.aspx)查看这篇文章，它展示了如何在 .NET 和 WinForms 中执行此操作。这样做可以完全控制用户看到的内容。

我已经在我的一个应用程序中使用了它，并且效果非常好。您可以显示图标/详细信息/列表视图，它会阻止用户移动到其他目录（这通常是显示标准文件/目录对话框的问题。

我用它来显示如下屏幕[http://img7.imageshack.us/img7/7647/screenshotbaf.png](http://img7.imageshack.us/img7/7647/screenshotbaf.png)：

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-30T23:45:18.837

You may want to look at the ExplorerBrowser object.

See [http://blogs.msdn.com/ieinternals/archive/2009/12/30/Windows-7-Web-Browser-Control-will-not-browse-file-system.aspx](http://blogs.msdn.com/ieinternals/archive/2009/12/30/Windows-7-Web-Browser-Control-will-not-browse-file-system.aspx) for more details.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T10:05:23.010

如果要打开不同的窗口来显示目标文件夹的内容，可以使用 System.Windows.Forms.OpenFileDialog 或 SaveFileDialog，或者从 FileDialog 继承并扩展它。

要允许用户选择文件夹，您可以使用 FolderBrowserDialog，尽管作为用户我不喜欢该控件。

这是否有帮助，或者您绝对必须在表单中嵌入控件？

阿萨夫

# sql-server - 复制时 SQL Server 触发器

> ID：542379
> 
> 赞同：4
> 
> 时间：2009-02-12T17:16:41.297
> 
> 标签：sql-server, sql-server-2008, triggers, replication

我需要创建一个 SQL Server 数据库，它将通过某些复制机制从另一个数据库接收更新。我需要编写将在发生此复制时执行的插入、更新和删除触发器。

我有触发器经验，但没有复制经验。

我应该使用事务复制还是合并复制，还是有关系？

设计为在执行简单 SQL 插入语句时运行的触发器是否也会在复制发生时运行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:35:58.240

MSDN 上的[CREATE TRIGGER 语法](http://msdn.microsoft.com/en-us/library/ms189799(SQL.90).aspx)：

```
CREATE TRIGGER
...
[ NOT FOR REPLICATION ] 
```

这表明在复制时执行是触发器的默认行为，可以通过指定来禁用`NOT FOR REPLICATION`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T17:38:44.503

这要看情况。

如果您打算应用的更新是隔离表，即给定表的所有数据仅来自发布者，那么您可以使用事务复制。

另一方面，如果您希望合并表格内容（即订单表格），并在两个站点都放置订单，那么您可能需要考虑使用合并复制。

关于触发器，您可以应用“不用于复制”配置来控制它们的行为。请参阅以下文章以供参考。

[http://msdn.microsoft.com/en-us/library/ms152529.aspx](http://msdn.microsoft.com/en-us/library/ms152529.aspx)

干杯，约翰

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T05:36:23.570

您提供的信息很难回答您的问题。我在您的问题中添加了一些评论，要求您提供澄清信息。

这是 MSDN 上的一篇文章，应该有所帮助：http: [//msdn.microsoft.com/en-us/library/ms152529.aspx](http://msdn.microsoft.com/en-us/library/ms152529.aspx)

默认情况下，除非指定“NOT FOR REPLICATION”，否则触发器将在复制期间触发。它们的工作方式与简单插入语句的工作方式相同。

事务复制和合并复制非常不同，但触发器对于这两个选项的行为相似。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T09:44:34.693

有几个替代选项可供您使用，而不是触发器。

1.  您可以修改订户（目标）数据库上的复制过程。
2.  如果使用 2008，您可以在订阅服务器上为您想要“做某事”的表使用更改跟踪，然后创建一个批处理来处理“基于集合”的数据而不是单个行。例如，运行每个 X 的 SSIS 包。

# hibernate - JPA 和 Hibernate Fetch 忽略关联？

> ID：542381
> 
> 赞同：0
> 
> 时间：2009-02-12T17:17:02.747
> 
> 标签：hibernate, jpa, hql, jpql

我在 ArrayList 中有具有一对多拥有关系（对象 B）的 JPA 实体（对象 A）。

我希望能够查询（Hibernate 或 JPA）对象 A，而无需在 One-Many ArrayList 中返回任何关联对象 B 的实例（无代理或其他）。

理想情况下，返回的 ArrayList 将为 null 或空。

这可能吗？在粗略的伪代码中，这就是我想要的：

“来自 ObjectA，其中 ObjectA.id=5 不包括 ObjectB”

或者

“从 ObjectA 中选择一个 FETCH IGNORE a.ObjectBs 其中 a.id=5”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T17:47:20.397

如果 ObjectA 中的 ObjectBs 的关联是惰性的，则 ObjectBs 不会随您的查询返回，除非您的查询指定获取它们。

如果您在会话关闭后访问任何 ObjectB，您将收到 LazyInitializationException，因为您的 ObjectB 未加载到内存中。

# asp.net - 为 Visual Studio 2008 推荐的操作系统

> ID：542382
> 
> 赞同：5
> 
> 时间：2009-02-12T17:17:04.273
> 
> 标签：asp.net, visual-studio-2008, operating-system

在使用 Visual Studio 2008 及其 asp.net 框架时，您会推荐哪种操作系统？我只会将它用于 Web 开发，而 Visual Studio 是我唯一需要的东西。

我在具有 2GB 内存的 2Ghz 笔记本电脑上进行所有编程。我应该坚持使用XP吗？Windows Server 2008/2005 还是 Vista？我应该使用 64 位版本吗？

钱不是问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T17:21:42.733

我会根据我的服务器操作系统选择我的桌面操作系统，以便拥有相同版本的 IIS。如果服务器使用 2003，可以选择~~XP~~ *Windows XP x64*。如果它使用2008，你应该选择Vista。

即使您的服务器运行 2003，您也可以选择 Vista 来学习 IIS 7 的新功能，从而为您选择升级到 2008 的那一天做好准备。

我真的认为没有理由运行 32 位，除非您打算使用一些不支持 64 位的组件（例如 WSE 2.0）。

因此，如果您运行 Windows server 2003 并希望安全起见，Vista 64 位或~~XP~~ *Windows XP x64可能是最佳选择。*

顺便说一句，如果您喜欢 Beta 版软件，您可以使用 Windows 7 Beta。我目前正在结合 VS2008 运行它，并且几乎没有问题。

**EDIT:** Windows XP 32 Bit is not recommended since it uses IIS 5.1\. The 64 bit version uses IIS 6.0 and is therefore the only recommended version of XP.

Furthermore, all the mentioned configurations should work fine with 2 GB of memory (including Vista and 7). However, if you plan to work with very large solutions and several instances of visual studio, memory consuming add-ins such as Resharper or your application in itself will be very memory consuming, an upgrade to 4 GB should be considered.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T17:21:42.483

我有 XP，没有理由抱怨。

旁白：“钱不是问题”——我一直想用这句话。还没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T17:19:46.390

我在XP上使用VS2008，内存较少，没有问题。这真的不应该只是个人喜好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T17:23:54.367

With only 2GB of memory, I'd recommend going with 32-bit XP.

While you can code on a Windows Server OS, you may find that they are tuned quite differently. For example, Server 2008 shares a lot of code with Vista, but the audio stack has a considerably higher latency than you would want on a desktop OS.

See: Larry Osterman's article [Why do people think that a server SKU works well as a general purpose operating system?](http://blogs.msdn.com/larryosterman/archive/2009/01/08/why-do-people-think-that-a-server-sku-works-well-as-a-general-purpose-operating-system.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T17:31:48.687

I've been doing all my development in Vista x64 lately and have found it to be quite usable. So that would be and is my choice.

If money isn't an object I'd really suggest sticking another 2 gigs of ram in your laptop. It shouldn't be all that expensive and the additional ram is really useful (and absolutely necessary if you're planning on doing anything like running a VM).

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T17:40:22.923

I run Visual Studio 2008 on a 2GHz/2GB RAM laptop with Vista Ultimate, all work PCs are 2GB RAM desktops with VS2008/Vista Business - with no issues.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T17:49:16.303

I know this is about a recommended OS, but if you're after getting the best *performance* from Visual Studio, how about this gem, straight from ScottGu's mouth!

[Tip/Trick: Hard Drive Speed and Visual Studio Performance](http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx)

Scott seems to think having a *fast* hard-disk will considerably improve hard-disk performance, and I have to agree with him. He also gives some recommendations for memory and CPU.

I would also say that, OS-wise, Windows XP is fine, as is Vista. I run VS2005 & VS2008 on both XP and Vista (both 32-bit) and from the OS perspective, there's really no difference.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-13T02:51:55.233

I've found 2005 and 2008 to run pretty equally with XP32 and Vista32\. There may be some edge cases with Vista, but I have yet to experience them with asp.net.

HOWEVER, the 32/64 question is another one altogether: [Team is Going from XP32 to XP64 for .NET Development - Any Gotchas?](https://stackoverflow.com/questions/534941/team-is-going-from-xp32-to-xp64-for-net-development-any-gotchas)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T17:27:51.160

I usually mirror whatever environment things will be used most in. We're pretty XPrific around here, so I've been using VS2008 there.

# java - java.lang.AbstractMethodError: javax.servlet.jsp.PageContext.getELContext()Ljavax/el/ELContext;

> ID：542383
> 
> 赞同：1
> 
> 时间：2009-02-12T17:17:18.890
> 
> 标签：java, jsp, jstl, jsp-tags

我正在尝试设置一个我将在自定义 JSP 标记中引用的变量，所以我的 JSP 中有这样的内容：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:set var="path" value="test"/> 
```

但是，当 JSP 运行时出现此错误：

```
java.lang.AbstractMethodError: javax.servlet.jsp.PageContext.getELContext()Ljavax/el/ELContext;
    at org.apache.taglibs.standard.tag.common.core.SetSupport.doEndTag(SetSupport.java:140) 
```

我正在运行带有 JSTL 1.2 的 Tomcat 5.5 和 Java 1.5。

我在这里做错了吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-03-05T19:03:46.820

这似乎出现了很多。我们将 Hadoop 作为依赖项，并且必须进行多次排除。其中一些可能是多余的，但这最终奏效了。我应该注意到，在我开始将 Jasper 排除在底部之前，没有任何变化。

```
<exclusions>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>jsp-2.1</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>jsp-api-2.1</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>jsp-api</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>servlet-api</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>servlet-api-2.5</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>jetty</artifactId>
    </exclusion>
    <exclusion>
        <groupId>org.mortbay.jetty</groupId>
        <artifactId>jetty-util</artifactId>
    </exclusion>
    <exclusion>
        <groupId>tomcat</groupId>
        <artifactId>jasper-compiler</artifactId>
    </exclusion>
    <exclusion>
        <groupId>tomcat</groupId>
        <artifactId>jasper-runtime</artifactId>
    </exclusion>
</exclusions> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:32:24.223

看起来你可能有一些版本问题，也许是某种冲突的 jar 文件。看[这里](http://faq.javaranch.com/view?JstlTagLibDefinitions)，也许会有所帮助。如果您无法解决它，您需要提供有关您的运行时环境的更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T10:36:38.550

Tomcat 5.5 不支持 JSTL 1.2 使用的 Servlet API 2.5。

升级到 Tomcat 6.0 或降级 Servlet/JSP/JSTL 版本。

见[http://tomcat.apache.org/whichversion.html](http://tomcat.apache.org/whichversion.html)

# asp.net-mvc - ASP.NET MVC - 以一种形式处理多个对象

> ID：542389
> 
> 赞同：5
> 
> 时间：2009-02-12T17:18:10.183
> 
> 标签：asp.net-mvc

我有一个我坚持的场景 - 我有一个域对象，它附加了一组对象。像这样的东西：

```
public class Person
{
   public string Name { get; set; }
   public IList<PhoneNumber> PhoneNumbers {get; set; }
   public IList<Address> Addresses { get; set; }
} 
```

客户想要的 UI 有一个用于添加和编辑的输入表单。用户可以为每个人输入 0 到多个电话/地址。如何处理将值集合发布回控制器？

我可以想到几种方法，但它们看起来都很暴力而且不是很优雅。是否有处理此类问题的最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T21:04:54.740

框架通过使用特殊的“表单布局”来支持它。Phil Haack 有一篇关于这个的文章，[看看这个](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx)

编辑 Scott Hanselman ( [http://www.hanselman.com/blog/ASPNETWireFormatForModelBindingToArraysListsCollectionsDictionaries.aspx](http://www.hanselman.com/blog/ASPNETWireFormatForModelBindingToArraysListsCollectionsDictionaries.aspx) ) 刚刚发布了关于此的更新。此外，在 RC1 中，似乎（昨晚遇到了这个 mysel）索引需要从 0 开始并稳步增加（至少如果你对 IList “绑定”）

Edit2 链接似乎不起作用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T11:02:50.360

在提到的 Hanselman 的帖子中，他写道您不需要索引，您只需为输入框使用相同的名称，并且有一个数组参数在起作用，它就可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:31:53.910

在过去，我为此使用了 railsy 约定。

```
<input name="Parent[childObjectType][serial_number]" type="textbox" value="" /> 
```

所以对于你的情况

```
<input name="Person[PhoneNumber][1]" type="TextBox" value="555-1212" />
<input name="Person[PhoneNumber][2]" type="TextBox" value="555-555-1212" /> 
```

并且您可以增加序列号并在 javascript 中复制元素以获得多个，并在您的操作中使用 formCollection，这将为您提供获取这些元素的方法。

mvc 团队的默认设置是为此操作使用 ModelBinder 和点语法。然而，这使得 jquery 和其他 javascript 框架阻碍了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:53:54.233

我已经开始使用 json 和 jQuery 在服务器端使用 JSON.NET 和 JsonFilter 将复杂类型发布到控制器操作，它会自动获取您的 json 对象并将其序列化为等效的 C# 类型。我发现这是一个非常干净的解决方案并且更容易测试。您可以查看这篇文章并下载示例代码，让您开始了解如何操作。这很简单。

[http://blogger.forgottenskies.com/?p=252](http://blogger.forgottenskies.com/?p=252)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-27T17:09:39.110

我已经这样做了好几次，并以 Phil Haack 的帖子为指导。上次我想出了如何使它与编辑器模板一起工作。在这里发布这个希望它可以帮助其他人（或者我，如果我忘记了）。

我在这里的示例是使用地址（为简洁起见，仅使用一个属性）。

**地址视图模型.cs**

```
public class AddressViewModel
{
    public string Address1 { get; set; }
} 
```

**地址视图模型.cs**

```
public class AddressViewModels : List<AddressViewModel>
{
} 
```

**PersonViewModel.cs**

```
public class PersonViewModel
{
    public AddressViewModels HomeAddresses { get; set; }
} 
```

**AddressViewModel.cshtml（编辑器模板）**

```
@model AddressViewModel

<div>
    @Html.LabelFor(m => m.Address1)
    @Html.TextBoxFor(m => m.Address1)
</div> 
```

**AddressViewModels.cshtml（编辑器模板）**

```
@model AddressViewModels
@for (var i = 0; i < Model.Count; i++)
{
    @Html.Hidden("Index", i)
    @Html.EditorFor(m => Model[i])
} 
```

**个人.cshtml**

```
@model Person

<h3>Edit Addresses</h3>
@Html.EditorFor(m => m.HomeAddresses)
<button type="submit">Save</button> 
```

**呈现的 HTML**

```
<input id="HomeAddresses_Index" name="HomeAddresses.Index" type="hidden" value="0">
<label for="HomeAddresses_1__Address1">Address 1</label>
<input id="HomeAddresses_1__Address1" name="HomeAddresses[1].Address1" type="text" value="P.O.Box 123" >
<button type="submit">Save</button> 
```

# c# - 使用网络登录从 Windows 服务创建 GUI

> ID：542390
> 
> 赞同：3
> 
> 时间：2009-02-12T17:18:18.547
> 
> 标签：c#, winapi, windows-services, windows-xp

我一直在阅读很多关于从 Windows 服务执行 GUI 应用程序的内容。当服务以 SYSTEM 用户身份运行时（我使用的是 Windows XP），“允许服务与桌面交互”复选框对我有用。现在我需要服务作为域中定义的用户（来自网络）运行。一切正常（即使没有用户登录机器），但没有显示 GUI（即使同一个网络用户登录！）。我知道 GUI 正在运行，只是它们被隐藏了。这是为什么？如果用户登录（例如由 SYSTEM 用户创建并允许与桌面交互！），有没有办法显示它们？如果是这样，如果登录的用户与运行服务的用户不同，它会起作用吗？

* * *

### 编辑：

@casperOne：我看到了您的解决方案，人们（甚至您）一直在发布相同的解决方案。不过，就我而言，我确信我在一个安全的环境中运行，并且一次只有一个用户会登录到一台机器上。没有什么可以简单地取消隐藏 GUI 吗？为什么这适用于用户 SYSTEM 允许与桌面交互而不是与其他用户交互？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T17:21:10.427

您的方法是完全错误的，并且在 Vista 上部署时将不起作用。

服务不应该假设与桌面进行交互的登录会话。

相反，您应该有第二个应用程序，它在用户登录（或某个其他时间点）时运行，它与服务通信，然后在接收到来自服务的通知/响应时显示 UI 元素。

有关更多信息，请参阅其他问题（和答案）：

[如何检测是否可以显示窗口？](https://stackoverflow.com/questions/466199/how-to-detect-if-a-window-can-be-shown)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T07:13:04.757

即使在 XP 上，它也不能在未加入域的机器上工作（如果您有多个用户使用快速用户切换，弹出窗口会出现在错误的桌面上或根本没有桌面上）。

至于微软为何改变这一点，请快速搜索“Shatter Attack”——通过将服务代码与桌面隔离，他们完全切断了整个安全漏洞系列。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T08:53:43.603

简短的回答：不，你不能这样做

长答案：不。

基本上，微软正在做出改变以进一步防止这种情况。正如 casperOne 所说，您需要将 UI 组件与服务分开。

# wpf - 如何取消用户的 WPF TreeView 点击？

> ID：542392
> 
> 赞同：14
> 
> 时间：2009-02-12T17:18:32.867
> 
> 标签：wpf, treeview, savechanges

我有一个带有 Treeview 控件的 WPF 应用程序。

当用户单击树上的节点时，页面上的其他 TextBox、ComboBox 等控件将填充适当的值。

然后，用户可以更改这些值并通过单击“保存”按钮保存他或她的更改。

但是，如果用户选择了不同的 Treeview 节点而不保存他或她的更改，我想显示一个警告并有机会取消该选择。

[MessageBox：继续并放弃未保存的更改？确定/取消 http://img522.imageshack.us/img522/2897/discardsj3.gif](http://img522.imageshack.us/img522/2897/discardsj3.gif)

XAML...

```
<TreeView Name="TreeViewThings"
    ...
    TreeViewItem.Unselected="TreeViewThings_Unselected"
    TreeViewItem.Selected="TreeViewThings_Selected" > 
```

视觉基本...

```
Sub TreeViewThings_Unselected(ByVal sender As System.Object, _
                              ByVal e As System.Windows.RoutedEventArgs)
    Dim OldThing As Thing = DirectCast(e.OriginalSource.DataContext, Thing)
    If CancelDueToUnsavedChanges(OldThing) Then
        '这里放取消代码
    万一
结束子

子 TreeViewThings_Selected（ByVal 发件人作为 System.Object，_
                            ByVal e As System.Windows.RoutedEventArgs)
    将 NewThing 调暗为 Thing = DirectCast(e.OriginalSource.DataContext, Thing)
    PopulateControlsFromThing(NewThing)
结束子

```

如何取消那些取消选择/选择事件？

* * *

更新：我问了一个后续问题...
[如何正确处理带有 MessageBox 确认的 PreviewMouseDown 事件？](https://stackoverflow.com/questions/543312/how-do-i-properly-handle-a-previewmousedown-event-with-a-messagebox-confirmation)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-10-27T00:22:42.237

**更新**

意识到我可以将逻辑放在 SelectedItemChanged 中。更清洁的解决方案。

Xaml

```
<TreeView Name="c_treeView"
          SelectedItemChanged="c_treeView_SelectedItemChanged">
    <TreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}">
            <Setter Property="IsSelected" Value="{Binding Path=IsSelected, Mode=TwoWay}" />
        </Style>
    </TreeView.ItemContainerStyle>
</TreeView> 
```

后面的代码。我有一些类是 TreeView 的 ItemsSource，所以我创建了一个接口 (MyInterface)，为所有这些类公开 IsSelected 属性。

```
private MyInterface m_selectedTreeViewItem = null;
private void c_treeView_SelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)
{
    if (m_selectedTreeViewItem != null)
    {
        if (e.NewValue == m_selectedTreeViewItem)
        {
            // Will only end up here when reversing item
            // Without this line childs can't be selected
            // twice if "No" was pressed in the question..   
            c_treeView.Focus();   
        }
        else
        {
            if (MessageBox.Show("Change TreeViewItem?",
                                "Really change",
                                MessageBoxButton.YesNo,
                                MessageBoxImage.Question) != MessageBoxResult.Yes)
            {
                EventHandler eventHandler = null;
                eventHandler = new EventHandler(delegate
                {
                    c_treeView.LayoutUpdated -= eventHandler;
                    m_selectedTreeViewItem.IsSelected = true;
                });
                // Will be fired after SelectedItemChanged, to early to change back here
                c_treeView.LayoutUpdated += eventHandler;
            }   
            else
            {
                m_selectedTreeViewItem = e.NewValue as MyInterface;
            }        
        }
    }
    else
    {
        m_selectedTreeViewItem = e.NewValue as MyInterface;
    }
} 
```

我还没有发现在按“否”后它不会恢复到上一个​​项目的任何情况。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-03-22T07:11:43.113

我必须解决同样的问题，但在我的应用程序的多个树视图中。我派生了 TreeView 并添加了事件处理程序，部分使用 Meleak 的解决方案，部分使用来自该论坛的扩展方法：[http ://forums.silverlight.net/t/65277.aspx/1/10](http://forums.silverlight.net/t/65277.aspx/1/10)

我想我会和你分享我的解决方案，所以这是我处理“取消节点更改”的完整可重用 TreeView：

```
public class MyTreeView : TreeView
{
    public static RoutedEvent PreviewSelectedItemChangedEvent;
    public static RoutedEvent SelectionCancelledEvent;

    static MyTreeView()
    {
        PreviewSelectedItemChangedEvent = EventManager.RegisterRoutedEvent("PreviewSelectedItemChanged", RoutingStrategy.Bubble,
                                                                           typeof(RoutedPropertyChangedEventHandler<object>), typeof(MyTreeView));

        SelectionCancelledEvent = EventManager.RegisterRoutedEvent("SelectionCancelled", RoutingStrategy.Bubble,
                                                                   typeof(RoutedEventHandler), typeof(MyTreeView));
    }

    public event RoutedPropertyChangedEventHandler<object> PreviewSelectedItemChanged
    {
        add { AddHandler(PreviewSelectedItemChangedEvent, value); }
        remove { RemoveHandler(PreviewSelectedItemChangedEvent, value); }
    }

    public event RoutedEventHandler SelectionCancelled
    {
        add { AddHandler(SelectionCancelledEvent, value); }
        remove { RemoveHandler(SelectionCancelledEvent, value); }
    }

    private object selectedItem = null;
    protected override void OnSelectedItemChanged(RoutedPropertyChangedEventArgs<object> e)
    {
        if (e.NewValue == selectedItem)
        {
            this.Focus();

            var args = new RoutedEventArgs(SelectionCancelledEvent);
            RaiseEvent(args);
        }
        else
        {
            var args = new RoutedPropertyChangedEventArgs<object>(e.OldValue, e.NewValue, PreviewSelectedItemChangedEvent);
            RaiseEvent(args);

            if (args.Handled)
            {
                EventHandler eventHandler = null;
                eventHandler = delegate
                {
                    this.LayoutUpdated -= eventHandler;

                    var treeViewItem = this.ContainerFromItem(selectedItem);
                    if (treeViewItem != null)
                        treeViewItem.IsSelected = true;
                };

                this.LayoutUpdated += eventHandler;
            }
            else
            {
                selectedItem = this.SelectedItem;
                base.OnSelectedItemChanged(e);
            }
        }
    }
}

public static class TreeViewExtensions
{
    public static TreeViewItem ContainerFromItem(this TreeView treeView, object item)
    {
        if (item == null) return null;

        var containerThatMightContainItem = (TreeViewItem)treeView.ItemContainerGenerator.ContainerFromItem(item);

        return containerThatMightContainItem ?? ContainerFromItem(treeView.ItemContainerGenerator, treeView.Items, item);
    }

    private static TreeViewItem ContainerFromItem(ItemContainerGenerator parentItemContainerGenerator, ItemCollection itemCollection, object item)
    {
        foreach (var child in itemCollection)
        {
            var parentContainer = (TreeViewItem)parentItemContainerGenerator.ContainerFromItem(child);
            var containerThatMightContainItem = (TreeViewItem)parentContainer.ItemContainerGenerator.ContainerFromItem(item);

            if (containerThatMightContainItem != null)
                return containerThatMightContainItem;

            var recursionResult = ContainerFromItem(parentContainer.ItemContainerGenerator, parentContainer.Items, item);
            if (recursionResult != null)
                return recursionResult;
        }
        return null;
    }
} 
```

这是一个使用示例（包含 MyTreeView 的窗口的代码隐藏）：

```
 private void theTreeView_PreviewSelectedItemChanged(object sender, RoutedPropertyChangedEventArgs<object> e)
    {
        if (e.OldValue != null)
            e.Handled = true;
    }

    private void theTreeView_SelectionCancelled(object sender, RoutedEventArgs e)
    {
        MessageBox.Show("Cancelled");
    } 
```

在树视图中选择第一个节点后，所有其他节点更改都被取消并显示一个消息框。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-19T15:21:58.300

您实际上不能将逻辑放入 OnSelectedItemChanged 方法中，如果存在逻辑，则 Selected Item 实际上已经更改。

正如另一张海报所建议的，PreviewMouseDown 处理程序是实现逻辑的更好位置，但是，仍然需要完成大量的工作。

下面是我的 2 美分：

首先是我实现的 TreeView：

```
public class MyTreeView : TreeView
{
    static MyTreeView( )
    {
        DefaultStyleKeyProperty.OverrideMetadata(
            typeof(MyTreeView),
            new FrameworkPropertyMetadata(typeof(TreeView)));
    }

    // Register a routed event, note this event uses RoutingStrategy.Tunnel. per msdn docs
    // all "Preview" events should use tunneling.
    // http://msdn.microsoft.com/en-us/library/system.windows.routedevent.routingstrategy.aspx
    public static RoutedEvent PreviewSelectedItemChangedEvent = EventManager.RegisterRoutedEvent(
        "PreviewSelectedItemChanged",
        RoutingStrategy.Tunnel,
        typeof(CancelEventHandler),
        typeof(MyTreeView));

    // give CLR access to routed event
    public event CancelEventHandler PreviewSelectedItemChanged
    {
        add
        {
            AddHandler(PreviewSelectedItemChangedEvent, value);
        }
        remove
        {
            RemoveHandler(PreviewSelectedItemChangedEvent, value);
        }
    }

    // override PreviewMouseDown
    protected override void OnPreviewMouseDown(MouseButtonEventArgs e)
    {
        // determine which item is going to be selected based on the current mouse position
        object itemToBeSelected = this.GetObjectAtPoint<TreeViewItem>(e.GetPosition(this));

        // selection doesn't change if the target point is null (beyond the end of the list)
        // or if the item to be selected is already selected.
        if (itemToBeSelected != null && itemToBeSelected != SelectedItem)
        {
            bool shouldCancel;

            // call our new event
            OnPreviewSelectedItemChanged(out shouldCancel);
            if (shouldCancel)
            {
                // if we are canceling the selection, mark this event has handled and don't
                // propogate the event.
                e.Handled = true;
                return;
            }
        }

        // otherwise we want to continue normally
        base.OnPreviewMouseDown(e);
    }

    protected virtual void OnPreviewSelectedItemChanged(out bool shouldCancel)
    {
        CancelEventArgs e = new CancelEventArgs( );
        if (PreviewSelectedItemChangedEvent != null)
        {
            // Raise our event with our custom CancelRoutedEventArgs
            RaiseEvent(new CancelRoutedEventArgs(PreviewSelectedItemChangedEvent, e));
        }
        shouldCancel = e.Cancel;
    }
} 
```

一些扩展方法来支持 TreeView 在鼠标下查找对象。

```
public static class ItemContainerExtensions
{
    // get the object that exists in the container at the specified point.
    public static object GetObjectAtPoint<ItemContainer>(this ItemsControl control, Point p)
        where ItemContainer : DependencyObject
    {
        // ItemContainer - can be ListViewItem, or TreeViewItem and so on(depends on control)
        ItemContainer obj = GetContainerAtPoint<ItemContainer>(control, p);
        if (obj == null)
            return null;

        // it is worth noting that the passed _control_ may not be the direct parent of the
        // container that exists at this point. This can be the case in a TreeView, where the
        // parent of a TreeViewItem may be either the TreeView or a intermediate TreeViewItem
        ItemsControl parentGenerator = obj.GetParentItemsControl( );

        // hopefully this isn't possible?
        if (parentGenerator == null)
            return null;

        return parentGenerator.ItemContainerGenerator.ItemFromContainer(obj);
    }

    // use the VisualTreeHelper to find the container at the specified point.
    public static ItemContainer GetContainerAtPoint<ItemContainer>(this ItemsControl control, Point p)
        where ItemContainer : DependencyObject
    {
        HitTestResult result = VisualTreeHelper.HitTest(control, p);
        DependencyObject obj = result.VisualHit;

        while (VisualTreeHelper.GetParent(obj) != null && !(obj is ItemContainer))
        {
            obj = VisualTreeHelper.GetParent(obj);
        }

        // Will return null if not found
        return obj as ItemContainer;
    }

    // walk up the visual tree looking for the nearest ItemsControl parent of the specified
    // depObject, returns null if one isn't found.
    public static ItemsControl GetParentItemsControl(this DependencyObject depObject)
    {
        DependencyObject obj = VisualTreeHelper.GetParent(depObject);
        while (VisualTreeHelper.GetParent(obj) != null && !(obj is ItemsControl))
        {
            obj = VisualTreeHelper.GetParent(obj);
        }

        // will return null if not found
        return obj as ItemsControl;
    }
} 
```

最后但并非最不重要的是利用 RoutedEvent 子系统的自定义 EventArgs。

```
public class CancelRoutedEventArgs : RoutedEventArgs
{
    private readonly CancelEventArgs _CancelArgs;

    public CancelRoutedEventArgs(RoutedEvent @event, CancelEventArgs cancelArgs)
        : base(@event)
    {
        _CancelArgs = cancelArgs;
    }

    // override the InvokeEventHandler because we are going to pass it CancelEventArgs
    // not the normal RoutedEventArgs
    protected override void InvokeEventHandler(Delegate genericHandler, object genericTarget)
    {
        CancelEventHandler handler = (CancelEventHandler)genericHandler;
        handler(genericTarget, _CancelArgs);
    }

    // the result
    public bool Cancel
    {
        get
        {
            return _CancelArgs.Cancel;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-14T02:03:20.443

CAMS_ARIES：

XAML：

代码 ：

```
 private bool ManejarSeleccionNodoArbol(Object origen)
    {
        return true;  // with true, the selected nodo don't change
        return false // with false, the selected nodo change
    }

    private void Arbol_PreviewMouseDown(object sender, MouseButtonEventArgs e)
    {            
        if (e.Source is TreeViewItem)
        {
            e.Handled = ManejarSeleccionNodoArbol(e.Source);
        }
    }

    private void Arbol_PreviewKeyDown(object sender, KeyEventArgs e)
    {
        if (e.Source is TreeViewItem)
        {
           e.Handled=ManejarSeleccionNodoArbol(e.Source);
        }
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T18:49:23.430

您不能像取消事件那样取消事件，例如 Closing 事件。但是，如果您缓存最后选择的值，则可以撤消它。秘诀是您必须在不重新触发 SelectionChanged 事件的情况下更改选择。这是一个例子：

```
 private object _LastSelection = null;
    private void OnSelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        if (IsUpdated)
        {
            MessageBoxResult result = MessageBox.Show("The current record has been modified. Are you sure you want to navigate away? Click Cancel to continue editing. If you click OK all changes will be lost.", "Warning", MessageBoxButton.OKCancel, MessageBoxImage.Hand);
            switch (result)
            {
                case MessageBoxResult.Cancel:
                    e.Handled = true;
                    // disable event so this doesn't go into an infinite loop when the selection is changed to the cached value
                    PersonListView.SelectionChanged -= new SelectionChangedEventHandler(OnSelectionChanged);
                    PersonListView.SelectedItem = _LastSelection;
                    PersonListView.SelectionChanged += new SelectionChangedEventHandler(OnSelectionChanged);
                    return;
                case MessageBoxResult.OK:
                    // revert the object to the original state
                    LocalDataContext.Persons.GetOriginalEntityState(_LastSelection).CopyTo(_LastSelection);
                    IsUpdated = false;
                    Refresh();
                    break;
                default:
                    throw new ApplicationException("Invalid response.");
            }
        }

        // cache the selected item for undo
        _LastSelection = PersonListView.SelectedItem;
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T17:34:04.560

与其选择 Selected/Unselected，更好的方法可能是挂钩 PreviewMouseDown。处理 Selected 和 Unselected 事件的前提是当您收到通知时该事件已经发生。没有什么可以取消的，因为它已经发生了。

另一方面，预览事件是可取消的。这不是您想要的确切事件，但它确实为您提供了防止用户选择其他节点的机会。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-11T10:58:03.063

您可以创建派生自 TreeView 的自定义控件，然后重写 OnSelectedItemChanged 方法。

在调用基础之前，您可以首先使用 CancelEventArgs 参数触发自定义事件。如果 parameter.Cancel 变为 true，则不要调用 base，而是选择旧项目（注意 OnSelectedItemChanged 将再次被调用）。

不是最好的解决方案，但至少这将逻辑保留在树控件内，并且选择更改事件触发的次数不会超过需要的次数。此外，您无需关心用户是否单击了树、使用了键盘或者选择是否以编程方式更改。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T17:33:37.917

由于该`SelectedItemChanged`事件是在`SelectedItem`已经更改后触发的，因此此时您无法真正取消该事件。

您可以做的是监听鼠标点击并在`SelectedItem`更改之前取消它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-11T00:43:59.393

我为 1 个树视图和一次显示 1 个文档解决了这个问题。此解决方案基于可附加到普通树视图的可附加行为：

```
<TreeView Grid.Column="0"
       ItemsSource="{Binding TreeViewItems}"
       behav:TreeViewSelectionChangedBehavior.ChangedCommand="{Binding SelectItemChangedCommand}"
       >
     <TreeView.ItemTemplate>
         <HierarchicalDataTemplate ItemsSource="{Binding Children}">
             <StackPanel Orientation="Horizontal">
                 <TextBlock Text="{Binding Name}"
                         ToolTipService.ShowOnDisabled="True"
                         VerticalAlignment="Center" Margin="3" />
             </StackPanel>
         </HierarchicalDataTemplate>
     </TreeView.ItemTemplate>
     <TreeView.ItemContainerStyle>
         <Style TargetType="{x:Type TreeViewItem}">
             <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
             <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
         </Style>
     </TreeView.ItemContainerStyle>
</TreeView> 
```

行为的代码是这样的：

```
/// <summary>
/// Source:
/// http://stackoverflow.com/questions/1034374/drag-and-drop-in-mvvm-with-scatterview
/// http://social.msdn.microsoft.com/Forums/de-DE/wpf/thread/21bed380-c485-44fb-8741-f9245524d0ae
/// 
/// Attached behaviour to implement the SelectionChanged command/event via delegate command binding or routed commands.
/// </summary>
public static class TreeViewSelectionChangedBehavior
{
#region fields
/// <summary>
/// Field of attached ICommand property
/// </summary>
private static readonly DependencyProperty ChangedCommandProperty = DependencyProperty.RegisterAttached(
  "ChangedCommand",
  typeof(ICommand),
  typeof(TreeViewSelectionChangedBehavior),
  new PropertyMetadata(null, OnSelectionChangedCommandChange));

/// <summary>
/// Implement backing store for UndoSelection dependency proeprty to indicate whether selection should be
/// cancelled via MessageBox query or not.
/// </summary>
public static readonly DependencyProperty UndoSelectionProperty =
  DependencyProperty.RegisterAttached("UndoSelection",
  typeof(bool),
  typeof(TreeViewSelectionChangedBehavior),
  new PropertyMetadata(false, OnUndoSelectionChanged));
#endregion fields

#region methods
#region ICommand changed methods
/// <summary>
/// Setter method of the attached ChangedCommand <seealso cref="ICommand"/> property
/// </summary>
/// <param name="source"></param>
/// <param name="value"></param>
public static void SetChangedCommand(DependencyObject source, ICommand value)
{
  source.SetValue(ChangedCommandProperty, value);
}

/// <summary>
/// Getter method of the attached ChangedCommand <seealso cref="ICommand"/> property
/// </summary>
/// <param name="source"></param>
/// <returns></returns>
public static ICommand GetChangedCommand(DependencyObject source)
{
  return (ICommand)source.GetValue(ChangedCommandProperty);
}
#endregion ICommand changed methods

#region UndoSelection methods
public static bool GetUndoSelection(DependencyObject obj)
{
  return (bool)obj.GetValue(UndoSelectionProperty);
}

public static void SetUndoSelection(DependencyObject obj, bool value)
{
  obj.SetValue(UndoSelectionProperty, value);
}
#endregion UndoSelection methods

/// <summary>
/// This method is hooked in the definition of the <seealso cref="ChangedCommandProperty"/>.
/// It is called whenever the attached property changes - in our case the event of binding
/// and unbinding the property to a sink is what we are looking for.
/// </summary>
/// <param name="d"></param>
/// <param name="e"></param>
private static void OnSelectionChangedCommandChange(DependencyObject d, DependencyPropertyChangedEventArgs e)
{
  TreeView uiElement = d as TreeView;  // Remove the handler if it exist to avoid memory leaks

  if (uiElement != null)
  {
      uiElement.SelectedItemChanged -= Selection_Changed;

      var command = e.NewValue as ICommand;
      if (command != null)
      {
          // the property is attached so we attach the Drop event handler
          uiElement.SelectedItemChanged += Selection_Changed;
      }
  }
}

/// <summary>
/// This method is called when the selection changed event occurs. The sender should be the control
/// on which this behaviour is attached - so we convert the sender into a <seealso cref="UIElement"/>
/// and receive the Command through the <seealso cref="GetChangedCommand"/> getter listed above.
/// 
/// The <paramref name="e"/> parameter contains the standard EventArgs data,
/// which is unpacked and reales upon the bound command.
/// 
/// This implementation supports binding of delegate commands and routed commands.
/// </summary>
/// <param name="sender"></param>
/// <param name="e"></param>
private static void Selection_Changed(object sender, RoutedPropertyChangedEventArgs<object> e)
{
  var uiElement = sender as TreeView;

  // Sanity check just in case this was somehow send by something else
  if (uiElement == null)
      return;

  ICommand changedCommand = TreeViewSelectionChangedBehavior.GetChangedCommand(uiElement);

  // There may not be a command bound to this after all
  if (changedCommand == null)
      return;

  // Check whether this attached behaviour is bound to a RoutedCommand
  if (changedCommand is RoutedCommand)
  {
      // Execute the routed command
      (changedCommand as RoutedCommand).Execute(e.NewValue, uiElement);
  }
  else
  {
      // Execute the Command as bound delegate
      changedCommand.Execute(e.NewValue);
  }
}

/// <summary>
/// Executes when the bound boolean property indicates that a user should be asked
/// about changing a treeviewitem selection instead of just performing it.
/// </summary>
/// <param name="d"></param>
/// <param name="e"></param>
private static void OnUndoSelectionChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
{
  TreeView uiElement = d as TreeView;  // Remove the handler if it exist to avoid memory leaks

  if (uiElement != null)
  {
      uiElement.PreviewMouseDown -= uiElement_PreviewMouseDown;

      var command = (bool)e.NewValue;
      if (command == true)
      {
          // the property is attached so we attach the Drop event handler
          uiElement.PreviewMouseDown += uiElement_PreviewMouseDown;
      }
  }
}

/// <summary>
/// Based on the solution proposed here:
/// Source: http://stackoverflow.com/questions/20244916/wpf-treeview-selection-change
/// </summary>
/// <param name="sender"></param>
/// <param name="e"></param>
private static void uiElement_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
  // first did the user click on a tree node?
  var source = e.OriginalSource as DependencyObject;
  while (source != null && !(source is TreeViewItem))
      source = VisualTreeHelper.GetParent(source);

  var itemSource = source as TreeViewItem;
  if (itemSource == null)
      return;

  var treeView = sender as TreeView;
  if (treeView == null)
      return;

  bool undoSelection = TreeViewSelectionChangedBehavior.GetUndoSelection(treeView);
  if (undoSelection == false)
      return;

  // Cancel the attempt to select an item.
  var result = MessageBox.Show("The current document has unsaved data. Do you want to continue without saving data?", "Are you really sure?",
                               MessageBoxButton.YesNo, MessageBoxImage.Question, MessageBoxResult.No);

  if (result == MessageBoxResult.No)
  {
      // Cancel the attempt to select a differnet item.
      e.Handled = true;
  }
  else
  {
      // Lets disable this for a moment, otherwise, we'll get into an event "recursion"
      treeView.PreviewMouseDown -= uiElement_PreviewMouseDown;

      // Select the new item - make sure a SelectedItemChanged event is fired in any case
      // Even if this means that we have to deselect/select the one and the same item
      if (itemSource.IsSelected == true )
          itemSource.IsSelected = false;

      itemSource.IsSelected = true;

      // Lets enable this to get back to business for next selection
      treeView.PreviewMouseDown += uiElement_PreviewMouseDown;
  }
}
#endregion methods
} 
```

在此示例中，我显示了一个阻止消息框，以便在 PreviewMouseDown 事件发生时阻止它。然后处理该事件以表示选择已取消，或者不处理该事件以让树视图本身通过选择即将被选择的项目来处理事件。

如果用户决定继续，该行为然后调用视图模型中的绑定命令（PreviewMouseDown 事件不由附加行为处理，并且调用绑定命令。

我猜消息框显示可以通过其他方式完成，但我认为它必须在这里阻止事件发生，因为否则无法取消它（？）。因此，我可能想到的关于此代码的唯一改进是绑定一些字符串以使显示的消息可配置。

我写了一篇包含可下载示例的文章，因为这是一个难以解释的领域（必须对缺失的部分做出许多假设，并且可能并不总是被所有读者共享）

这是一篇包含我的结果的文章：http: [//www.codeproject.com/Articles/995629/Cancelable-TreeView-Navigation-for-Documents-in-WP](http://www.codeproject.com/Articles/995629/Cancelable-TreeView-Navigation-for-Documents-in-WP)

请对此解决方案发表评论，如果您发现有改进的余地，请告诉我。

# c# - 如何使用 IAccessible 在 Firefox 中访问文档的 HTML

> ID：542395
> 
> 赞同：4
> 
> 时间：2009-02-12T17:19:31.600
> 
> 标签：c#, firefox, accessibility, iaccessible

我可以使用以下代码从 Firefox 窗口获取 IAccessible 对象：

```
Guid guid = new Guid("{618736E0-3C3D-11CF-810C-00AA00389B71}");
object obj = null;
int ret = AccessibleObjectFromWindow(hWnd, 
    (uint) OBJID.WINDOW, ref guid, ref obj);
Accessibility.IAccessible acc = (Accessibility.IAccessible)obj; 
```

但是，我不确定从这里去哪里。我需要从文档中获取完整的 HTML。我知道 IAccessible.get_accValue() 方法，但我不确定如何在 Firefox 中使用它。任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-21T14:58:56.010

显然您无法使用 IAccessible 获得完整的 HTML 源代码。我发现了这个，但它在 FF3.5 中不起作用：

```
IServiceProvider *pServProv = NULL;
pAccessible->QueryInterface(IID_IServiceProvider, (void**)&pServProv);
ISimpleDOMNode *pSimpleDOMNode;
if (pServProv) {
  const GUID refguid = {0x0c539790, 0x12e4, 0x11cf, 0xb6, 0x61,
                        0x00, 0xaa, 0x00, 0x4c, 0xd6, 0xd8};
  HRESULT result = pServProv->QueryService(refguid, IID_ISimpleDOMNode,
                                           (void**)&pSimpleDOMNode);
  if (SUCCEEDED(hresult) && pSimpleDOMNode != NULL) {
    /* This is a Mozilla node! Use special ISimpleDOMNode methods described in
      ISimpleDOMNode.idl. */
  }
} 
```

我还发现了这个，它在 FF3.5 中也不起作用：

```
HRESULT hr = AccessibleObjectFromWindow(hwnd, OBJID_CLIENT,
      IID_IAccessible, (void**)&pAccessible);
if (SUCCEEDED(hr) && pAccessible != NULL) {
HRESULT hr = pAccessible->QueryInterface(
      IID_ISimpleDOMNode, (void**)&pSimpleDOMNode);
} 
```

我被困住了。:(

# linux - ColdFusion/Linux multipart/form-data 编码文件上传问题

> ID：542396
> 
> 赞同：1
> 
> 时间：2009-02-12T17:19:32.287
> 
> 标签：linux, forms, coldfusion, enctype

我在 Linux 上的 ColdFusion 中发布了一个表格。表单有一个文件字段。CF 要求表单标签上的 enctype="multipart/form-data" 属性。如果我有这个，我得到一个“JRun Servlet 错误 - 500 没有这样的文件或目录”

如果我取出属性，表单会发布，我会收到 CF“enctype=multipart/form-data”错误。

该怎么办？

这是表格的精简版：

```
 <form action="post.cfm" name="form2" id="port_form" method="post" enctype="multipart/form-data">
      <input type="text" id="name" name="name" value="#port_name#"><br>
      <input type="file" id="before" name="before"><br>
      <input type="hidden" name="port_id" value="#port_id#" />
      <button type="submit" name="post"> Post Portfolio Item </button>  
 </form> 
```

这是我要发布到的页面 (post.cfm)

```
 <cfif form.before neq "">
    <cfinvoke component = "#application.cfcPath#.file" method = "upload" returnVariable = "beforeFile" theField="before">
 <cfelse>
    <cfset beforeFile = ''>
 </cfif>

 <cfif form.after neq "">
    <cfinvoke component = "#application.cfcPath#.file" method = "upload" returnVariable = "afterFile" theField="after">
 <cfelse>
    <cfset afterFile = ''>
 </cfif>    

 <cfinvoke component = "#application.cfcPath#.portfolio" method = "post" beforeFile="#beforeFile#" afterFile="#afterFile#">

 <cfif form.port_id eq 0>
    <cfset message = "The Portfolio Item has been successfully inserted.">
 <cfelse>
    <cfset message = "The Portfolio Item has been successfully updated.">
 </cfif>

 <cf_forward fuseaction="#fusebox.circuit#.home" message="#message#"> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T15:35:16.290

可能的原因是服务器找不到上传的临时文件。

您是否尝试过在没有组件包装的情况下进行上传？

简单地

```
<cfif StructKeyExists(Form, "before") AND Form.before NEQ "">
<cffile
    action="upload"
    filefield="before"
    destination="#AbsPathToStoreFile#"
    >
</cfif>

<cfdump var="#cffile#"> 
```

如果失败，也许您将能够看到更多详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T02:34:54.073

您可能已经尝试过，但是您是否尝试过路径和文件名中的全部大写或全部小写？有时 CF 会破坏大写/小写的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T15:46:32.160

我想知道 CF 试图将文件保存到的临时文件夹是否不可访问（权限）或配置不正确。

您应该尝试使用 CFFILE 标记并指定您有权访问的文件夹。

# apache-flex - 使用 ant，有谁知道如何构建由包含资源包的 SWC（您已构建）组成的 SWF？

> ID：542405
> 
> 赞同：3
> 
> 时间：2009-02-12T17:21:27.087
> 
> 标签：apache-flex, ant, build, flexbuilder

我正在尝试编写一个 ant 构建脚本来构建我小组的 flex 应用程序，但我遇到了一些障碍，我希望 SO 上的某个人以前见过这些障碍。

我们有两个项目构建到 SWC 中，这些组件包含资源包。一个 SWC 需要另一个 SWC。我们有一个项目构建到我们的应用程序（SWF）中，它使用了两个 SWC。

当我构建 SWC 时，我没有收到关于找不到资源包的投诉，当我在 winzip 中打开 SWC 时，我可以看到这些包（例如，在 /locale/EN_US 中）

然而，当我构建 SWF 时，我收到关于无法在两个 swc 中找到资源包的抱怨，但没有关于无法找到任何其他资源包（如 flex 框架的资源包）的抱怨。这是我从 ant 那里得到的信息：

```
[mxmlc] Error: Unable to resolve resource bundle "whatever" for locale "en_US".
[mxmlc] 
```

当然，我不是第一个遇到这个问题的人，所以有人知道这里有什么问题吗？我是在构建错误的 SWC 还是 SWF？

作为参考，这是我使用 compc 的构建任务之一（由于某种原因，我无法显示开始目标标记）

```
 <path id="facet.sourcePath">
        <pathelement location="${flex.facet.src}"/>
    </path>
    <property name="facet.sourcePath" refid="facet.sourcePath"/>
    <echo message="sourcePath is ${facet.sourcePath}"/>
    <fileset dir="${facet.sourcePath}" id="facet.sources">
        <include name="**/*.as"/>
    </fileset>
    <pathconvert property="facet.classes" pathsep=" " refid="facet.sources">
        <compositemapper>
            <chainedmapper>
                <globmapper from="*.as" to="*"/>
                <globmapper from="${facet.sourcePath}\*" to="*" handledirsep="true" />
            </chainedmapper>
            <chainedmapper>
                <globmapper from="*.mxml" to="*"/>      
                <globmapper from="${facet.sourcePath}\*" to="*" handledirsep="true" />
            </chainedmapper>
        </compositemapper>                     
    </pathconvert>           
    <echo message="classes: ${facet.classes}"/>
    <compc output="${flex.lib.output}/${facet.swc.name}" locale="EN_US" 
                include-classes="${facet.classes}" directory="false"
                target-player="10.0.0" 
                >
        <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>
        <include-resource-bundles bundle="foo"/>
        <include-resource-bundles bundle="bar"/>
        <include-resource-bundles bundle="whatever"/>
        <sp path-element="${flex.facet.dir}/locale/{locale}"/>
        <keep-as3-metadata name="Bindable"/>
        <keep-as3-metadata name="Remotable"/>
        <keep-as3-metadata name="Embed"/>
        <keep-as3-metadata name="Event"/>
        <keep-as3-metadata name="ResourceBundle"/>
        <source-path path-element="${flex.facet.src}"/>
    <compiler.library-path append="true" dir="${flex.framework.lib}">
      <include name="*.swc"/>
      <include name="../locale/${locale}"/>
    </compiler.library-path>
    <compiler.library-path append="true" dir="${flex.rsm.lib}">
      <include name="*.swc"/>
    </compiler.library-path>
  </compc>
</target> 
```

这是我的 mxmlc 任务：

```
<target name="flex.webapp.compile" description="compiles your flex app">
      <mxmlc file="${flex.webapp.src}\RSM.mxml"
           output="${flex.webapp.deploy}\ant_test\RSM.swf"
           use-network="true" 
           keep-generated-actionscript="true" 
           debug="true" 
           locale="en_US"
           incremental="true"
           actionscript-file-encoding="utf-8" 
           target-player="10.0.0" 
        >
        <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>
        <include-resource-bundles bundle="RSM"/>
        <source-path path-element="${FLEX_HOME}/frameworks"/>   
        <source-path path-element="${flex.webapp.src}" />         
        <source-path path-element="${flex.webapp.dir}/locale/en_US" />
        <source-path path-element="${flex.rsm.lib}" />
        <sp path-element="${flex.core.dir}/locale/{locale}"/>
        <sp path-element="${flex.facet.dir}/locale/{locale}" /> 
        <compiler.library-path append="true" dir="${flex.framework.lib}">
            <include name="*.swc"/>
            <!--include name="../locale/${locale}"/-->
        </compiler.library-path>
        <compiler.library-path append="true" dir="${flex.rsm.lib}">
            <include name="*.swc"/>
            <include name="../locale/${locale}" />          
            <!--include name="rsm_rb.swc" /-->
        </compiler.library-path>
    </mxmlc>
</target> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T17:32:10.643

啊！

在盯着这个问题看了好几个小时后，我意识到这个问题一直在盯着我看。
compc 任务使用'locale="EN_US"'，mxmlc 任务使用'locale="en_US"'。
如果有人发布“你遇到过的最愚蠢的工作问题是什么？”，这就是我的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-25T12:33:59.717

顺便说一句，它不必那么复杂（即使在 linux 控制台中！），您所需要的只是包含库......

```
daemonna@NES-KOS-29:~/Desktop/FlexUnit4Turnkey_4.0_sdk_4.0.fxp_FILES/src$ mxmlc -library-path=../libs -locale=en_US App.mxml 
Loading configuration file /home/daemonna/Frameworks/flex_sdk_4.1.0.16076/frameworks/flex-config.xml
Error: Unable to resolve resource bundle "components" for locale "en_US".
....bla bla bla...
Error: Unable to resolve resource bundle "controls" for locale "en_US".

daemonna@NES-KOS-29:~/Desktop/FlexUnit4Turnkey_4.0_sdk_4.0.fxp_FILES/src$ mxmlc -library-path=../libs -library-**path=/home/daemonna/Frameworks/flex_sdk_4.1.0.16076/frameworks/locale/en_US/** -locale=en_US App.mxml 
Loading configuration file /home/daemonna/Frameworks/flex_sdk_4.1.0.16076/frameworks/flex-config.xml
/home/daemonna/Desktop/FlexUnit4Turnkey_4.0_sdk_4.0.fxp_FILES/src/App.swf (37964 bytes) 
```

# asp.net - ASP.NET：将值从用户控件传递到页面？

> ID：542410
> 
> 赞同：5
> 
> 时间：2009-02-12T17:21:52.140
> 
> 标签：asp.net, user-controls

我在 ASP.NET（使用 VB）中创建一个用户控件，它使用文本框上的自动完成 ajax 控件来获取值。然后我希望页面回发并根据从该控件传递给它的任何值运行一些代码。问题是，我不完全确定如何做到这一点。我确信这很容易，我应该知道，但我不知道。

提前致谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T17:26:19.243

在您的用户控件中公开该值的属性

```
Public Property SomeValue() As String
Get
    Return textbox1.Text
End Get
End Property 
```

然后在您的 aspx 页面加载中，只需引用用户控件的值。

```
userControl1.SomeValue 
```

编辑，我只是​​尝试将我的语法更改为 vb.net，我实际上并不知道 vb，因此该语法可能正确也可能不正确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:24:31.697

((NameOfPage)this.Page).VariableOnPage = this.Foobar;

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:27:56.713

在用户控件的代码隐藏中公开一个属性，例如

```
public TextBox UserControlTextBox
{
    return this.TextBoxInstance;
} 
```

然后从你的页面只需调用

```
UserControlInstance.UserControlTextBox.Text; 
```

# sql-server - 公开可用的 SQL Server 复制发布者

> ID：542412
> 
> 赞同：1
> 
> 时间：2009-02-12T17:23:07.303
> 
> 标签：sql-server, replication

我正在试用 SQL Server 2008 Express Edition，并且有兴趣尝试复制功能。是否有可以设置复制订阅的公开数据库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-21T18:18:14.433

您不能按照某些建议使用 sql server express edition 的第二个副本。快速版本不能在复制的两端工作。Express 只能是订阅者，不能是发布者。您需要更高版本才能成为发布者。

但是，如果您只是想尝试一下，可以下载支持复制的免费试用版。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-21T18:06:48.407

不可以，但是您可以在同一台计算机上设置 SQL Server 的第二个实例（开发人员、标准或企业）并在它们之间进行复制，或者使用第二台计算机或计算机上的虚拟机。如需免费的虚拟化解决方案，请查看 VMware Server。这对于学习这样的事情非常有用，您想测试事情如何与涉及的多台机器一起工作。

[http://www.vmware.com/products/server/](http://www.vmware.com/products/server/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T17:28:31.533

从来没听说过。

发布者的 SQL Server 平台需要对其进行管理更改，以便将您的 SQL Server 实例添加为订阅者，因此您不太可能找到所需的内容。

也就是说，如果你遇到什么让我知道。

干杯，约翰

# c# - 有没有办法在运行时从列表框中清除空白值？

> ID：542413
> 
> 赞同：1
> 
> 时间：2009-02-12T17:23:13.043
> 
> 标签：c#, asp.net

我从数据库中的表中提取数据并将其作为数据源分配给列表框。如果列表框中有一个空白项，它会显示如下：

1.  全部

3.  红色的

4.  绿
5.  蓝色的

删除列表框中空白的最佳方法是什么。如果有空白，则始终位于第二个位置。我打算尝试测试第二个位置是否包含空白文本，但我不知道该怎么做。

谢谢， XaiSoft

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:25:47.203

我想说最好的办法是在将其绑定到列表框之前从数据源中删除空白项。

你如何做到这一点取决于你的数据来自哪里以及你对它有多少控制权。

您可以向仅返回非空白项的数据库添加一个视图；如果您使用的是 LINQ to SQL，则可以修改查询，使其仅返回非空白项；您可以将项目复制到列表中并自己删除空白项目（如果您将它们放在列表框中，我想不会有太多项目）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:36:12.950

将事件连接到列表框的数据绑定。如果数据项为空或具有无效字符串，则不要添加它，否则继续添加它。

或者自己循环遍历数据源，只添加需要的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-28T14:51:24.123

我用了

```
physicalChannelComboBox.Items.Remove(""); 
```

问题是它只会清理一件物品，你需要做的次数与你拥有的空物品一样多……也许不是最好的解决方案……但它确实有效。

# sharepoint - 从共享点下载文件时出现随机错误

> ID：542418
> 
> 赞同：1
> 
> 时间：2009-02-12T17:25:15.130
> 
> 标签：sharepoint, sharepoint-2007

我正在使用 Sharepoint 2007 来托管由我的应用程序生成的 Excel 2007 文件，以便内部客户端可以下载它们。但是，有时（而且似乎是随机的）较大的文件无法下载（Internet Explorer 和 Firefox 声称下载成功，但文件的大小比预期的要小并且不可用）。Sharepoint 中的文件很好，因为有时它们下载正常（所以尝试几次后我可以成功下载任何文件）。

任何想法是什么原因造成的，是否有任何可用的解决方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-11T09:38:32.080

您可以发布一个片段来显示代码中发生的事情吗？IIS的文件下载功能存在许多问题，因为整个过程取决于网络故障等多种因素

请参考[链接文字](http://support.microsoft.com/kb/812406)

# sql - UPDATE 使用两个表，串联

> ID：542419
> 
> 赞同：5
> 
> 时间：2009-02-12T17:25:22.430
> 
> 标签：sql, oracle, sql-update

我需要创建此查询中涉及的两个表，并且我不确定如何连接这两个表以进行更新。

我有一个 ITEM 和 CONSUMER_ITEMS 表。ITEM 表中的每个项目都有一个不同的代码和一个 UPC 代码。我需要将带有 ITEM.UPC_CODE 的字符串连接到 CONSUMER_ITEMS.NEW_ITEM_CODE 其中 CONSUMER_ITEMS.ITEM_CODE = (ITEM.ITEM_CODES 的特定列表)

我将如何更新 CONSUMER_ITEMS.NEW_ITEM_CODE 字段？

它本质上等于“字符串”|| ITEM.UPC 但我如何引用 CONSUMER_ITEMS.ITEM_CODE 以等于要更新的​​ ITEM_CODES 列表中的特定 ITEM_CODE。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T17:34:32.877

听起来像你想要的：

```
UPDATE consumer_items ci
SET    new_item_code = (SELECT 'string' || item.upc_code
                        FROM   item
                        WHERE  item.item_code = ci.item_code
                       )
WHERE  ci.item_code IN ('a','b','c'); 
```

或者，假设表之间存在外键关系并且 consumer_items 具有主键，这应该有效：

```
UPDATE (SELECT ci.id, ci.new_item_code, item.upc_code
        FROM   consumer_items ci
               JOIN item ON item.item_code = ci.item_code
        WHERE  ci.item_code IN ('a','b','c')
       ) v
SET v.new_item_code = 'string' || v.upc_code 
```

编辑：添加 WHERE 子句

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:46:52.127

对，看起来不错，但 item.item_code = ci.item_code 不起作用，因为：

```
SELECT distinct i.code, i.upc
FROM item i, consumer_items ci 
WHERE i.ccode = '123132' 
AND i.scode = 'ACTIVE' 
AND i.upc IS NOT NULL 
AND ci.item_code = i.code 
AND i.code IN 
    (SELECT DISTINCT tr.item_code 
     FROM t_r tr
     WHERE tr.category = 'RRE') 
AND ci.NEW_ITEM_CODE IS NULL 
```

这是与那些经常用于更新 CONSUMER_ITEMS 的代码相关联的 CODES 和 UPC 的不同列表。

```
new_item_code = (SELECT 'string' || item.upc_code FROM item WHERE item.item_code = (SELECT distinct i.code, i.upc
FROM item i, consumer_items ci 
WHERE i.ccode = '123132' 
AND i.scode = 'ACTIVE' 
AND i.upc IS NOT NULL 
AND ci.item_code = i.code 
AND i.code IN 
    (SELECT DISTINCT tr.item_code 
     FROM t_r tr
     WHERE tr.category = 'RRE') 
AND ci.NEW_ITEM_CODE IS NULL)); 
```

似乎不起作用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T18:10:31.103

i.ITEM_CODE、i.UPC 的列表是这样的：

```
014940  070182132137
018266  929245021085
018268  729245021108
018418  029245022815
018419  129245022822
018420  229245022839
018421  529245022846
018422  929245022853 
```

第一列是项目代码，第二列是 UPC。这是在项目表上。

CONSUMER_ITEMS 表本质上也有一个 CONSUMER_ITEMS.ITEM_CODE。这就是 LINK，但它也有一个名为 CONSUMER_ITEMS.NEW_ITEM_CODE 的字段。我们想用上面列表中相应 ITEM_CODE 中的 UPC 填充 NEW_ITEM_CODE，并连接 'string' || 上面的 UPC 代码。

我们如何生成该列表是：

```
SELECT distinct i.code, i.upc
FROM item i, consumer_items ci 
WHERE i.ccode = '123434' 
AND i.scode = 'ACTIVE' 
AND i.upc IS NOT NULL 
AND ci.item_code = i.code 
AND i.code IN 
(SELECT DISTINCT tr.item_code 
 FROM tr_table tr 
 WHERE tr.category = 'RRE') 
AND ci.NEW_ITEM_CODE IS NULL 
```

这会生成上面的 ITEM_CODE、UPC 列表。我需要更新与上述代码匹配的 CONSUMER_ITEMS。具体来说，我需要更新他们的 NEW_ITEM_CODE 字段，这些字段为空，对应的 UPC 与字符串连接。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2010-02-17T19:34:39.890

/*+ BYPASS_UJVC */

如果您收到以下 oracle 错误 - ORA-01779：无法修改映射到非键保留表的列，请使用此提示

# ruby - CruiseControl.rb SVN 访问被拒绝

> ID：542421
> 
> 赞同：1
> 
> 时间：2009-02-12T17:25:46.140
> 
> 标签：ruby, svn, cruisecontrol, cruisecontrol.rb

我遇到了一个问题，我可以完美地将项目添加到 CC.rb，但是当我启动服务时，每次使用 Subversion 检查更新版本时，我都会收到“拒绝访问”消息。

我正在运行 --trace 并从项目的工作目录运行它正在尝试的确切命令：

```
svn --non-interactive log --limit 1 --revision HEAD:1 --verbose --xml 
```

导致响应按预期返回。

谁能指出我正确的方向？

**更新**

转移到 http，因为 https 似乎是很多头痛的根源，但这并没有帮助。

我还在源头上进行了黑客攻击，以使用上述命令传递我的用户名和密码，但这也没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:28:06.027

如果您使用 SSL，请确保运行脚本的用户帐户具有 SSL 的缓存证书权限。

这适用于 Cruisecontrol.net，它是一个在 Windows 中作为非常特定的用户运行的服务。您可能需要弄清楚 ruby​​.exe 的模拟规则，以确定它是否作为网络服务运行，或者您是否可以让它作为您自己运行。

这是一个关于如何使 cc.rb 作为 Windows 服务运行并表现得像 cc.net 的链接，尽管重量仍然更轻。抱歉，错误的链接实际上在[nabble](http://www.nabble.com/Install-Cruisecontrol.rb-as-a-windows-service-td13707720.html)上，你需要 cygwin。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T16:17:55.330

如果您使用从他们的 git repo 中提取的最新版本的 CruiseControl.rb，它应该可以解决您的问题（至少它对我有用）。

git 命令是：

> git clone git://rubyforge.org/cruisecontrolrb.git

如果您在 Windows 上运行，则可能需要安装 git。您可以在此处获取 msysgit：[http ://code.google.com/p/msysgit/downloads/list](http://code.google.com/p/msysgit/downloads/list)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T16:44:54.253

自从我使用 CruiseControl.rb 已经有一段时间了，但我确实记得它使用存储在机器上的通用凭据来进行身份验证/访问 SVN 存储库。这很好，因为它们不需要每次都输入，但是当开发人员（或其他一些进程）使用不同于 CruiseControl 预期的凭据从该机器连接到 SVN 存储库时，会引起很多麻烦。您可能需要检查以查看这是否正在发生/发生。我相信这可能已在最新版本中修复，或者至少作为功能/错误修复在队列中。

# c# - 在这种情况下我将如何使用 LINQ2XML？

> ID：542426
> 
> 赞同：2
> 
> 时间：2009-02-12T17:26:53.580
> 
> 标签：c#, .net, xml, linq, linq-to-xml

我的 LINQ2XML 查询已经完成了我的目标的一半：

```
var XMLDoc = XDocument.Load("WeatherData.xml");

var maximums = from tempvalue in 
                   XMLDoc.Descendants("temperature").Elements("value")
               where tempvalue.Parent.Attribute("type").Value == "maximum"
               select (string)tempvalue;

var minimums = from tempvalue in 
                   XMLDoc.Descendants("temperature").Elements("value")
               where tempvalue.Parent.Attribute("type").Value == "minimum"
               select (string)tempvalue;

List<string> MaxTemps = maximums.ToList();
List<string> MinTemps = minimums.ToList(); 
```

但是，我无法从 XML 文档中获取时间信息，因为我必须匹配布局键信息（请参阅 XML 注释），并且我想知道在 LINQ 中加入这个的最佳解决方案是什么我现有查询的时间数据：

***（顺便说一下，这个 XML 数据来自一个 Web 服务）***

```
<?xml version="1.0" encoding="utf-8"?>
<dwml>
  <data>
    <time-layout>
      <!--        Maximums Key         -->
      <layout-key>k-p24h-n7-1</layout-key>
      <start-valid-time>2009-02-09T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-09T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-10T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-10T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-11T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-11T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-12T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-12T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-13T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-13T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-14T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-14T19:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-15T07:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-15T19:00:00-05:00</end-valid-time>
    </time-layout>
    <time-layout>
      <!--        Minimums Key         -->
      <layout-key>k-p24h-n7-2</layout-key>
      <start-valid-time>2009-02-08T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-09T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-09T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-10T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-10T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-11T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-11T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-12T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-12T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-13T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-13T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-14T08:00:00-05:00</end-valid-time>
      <start-valid-time>2009-02-14T19:00:00-05:00</start-valid-time>
      <end-valid-time>2009-02-15T08:00:00-05:00</end-valid-time>
    </time-layout>
    <parameters>
      <!--                                     1st Key   -->
      <temperature type="maximum" time-layout="k-p24h-n7-1">
        <value>44</value>
        <value>57</value>
        <value>55</value>
        <value>40</value>
        <value>39</value>
        <value>34</value>
        <value>33</value>
      </temperature>
      <!--                                     2nd Key   -->
      <temperature type="minimum" time-layout="k-p24h-n7-2">
        <value>24</value>
        <value>38</value>
        <value>46</value>
        <value>35</value>
        <value>25</value>
        <value>27</value>
        <value>23</value>
      </temperature>
    </parameters>
  </data>
</dwml> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T18:34:16.787

我会先把它分解成更小的部分。首先，我将时间布局按摩成更可行的形式，按布局键分组，有效的开始时间和有效的结束时间相互关联：

```
var timeLayouts =
    from tempvalue in XMLDoc.Descendants("time-layout")
    let tempStartTimes = tempvalue.Elements("start-valid-time").
            Select((x, i) => new { Index = i, ValidDateTime = (DateTime)x })
    let tempEndTimes = tempvalue.Elements("end-valid-time").
            Select((x, i) => new { Index = i, ValidDateTime = (DateTime)x })
    select new
    {
        LayoutKey = tempvalue.Element("layout-key").Value,
        ValidTimeRanges =
            from s in tempStartTimes
            from e in tempEndTimes
            where s.Index == e.Index
            select new 
            { 
                Index = s.Index, 
                ValidStartDateTime = s.ValidDateTime, 
                ValidEndDateTime = e.ValidDateTime 
            }
    }; 
```

然后，我将以几乎相同的方式按摩参数：

```
var parameters =
    from tempvalue in XMLDoc.Descendants("temperature")
    select new
    {
        TemperatureType = (string) tempvalue.Attribute("type"),
        TimeLayout = (string) tempvalue.Attribute("time-layout"),
        Temperatures = tempvalue.Elements("value").Select((x, i) =>
            new { Index = i, Temperature = (int)x })
    }; 
```

从那里开始，获得最大值和最小值并不难：

```
var maximums =
    from p in parameters
    where p.TemperatureType == "maximum"
    from tl in timeLayouts
    where tl.LayoutKey == p.TimeLayout
    from tr in tl.ValidTimeRanges
    from t in p.Temperatures
    where tr.Index == t.Index
    select new { tr.ValidStartDateTime, tr.ValidEndDateTime, 
        t.Temperature };

var minimums =
    from p in parameters
    where p.TemperatureType == "minimum"
    from tl in timeLayouts
    where tl.LayoutKey == p.TimeLayout
    from tr in tl.ValidTimeRanges
    from t in p.Temperatures
    where tr.Index == t.Index
    select new { tr.ValidStartDateTime, tr.ValidEndDateTime, 
        t.Temperature }; 
```

如果您想简化一些表示（例如，您可以将布局和参数扁平化为更“表格”的东西），您可以采用其他方式，它只需要一些调整。

# asp.net - Asp.net 表单身份验证登录循环

> ID：542429
> 
> 赞同：7
> 
> 时间：2009-02-12T17:27:35.560
> 
> 标签：asp.net, webforms, forms-authentication, cookieless

当您使用无 cookie 会话并且无法将 login.aspx 的名称更改为 httphandler 时，如何解决无限登录循环问题？

即，当具有管理员权限的用户点击注销按钮并将返回到受限页面的 url 传递给 login.aspx 时，另一个没有管理员权限的用户尝试登录，他们将被重定向回登录页面。

我遇到过这个[解决方案](http://erlend.oftedal.no/blog/?blogid=55)，但我无法将 login.aspx 的名称更改为 http 处理程序，并且 isauthenticated 函数似乎在具有无 cookie 身份验证的 aspx 页面中不起作用，因为表单身份验证票似乎已从 url 中删除当重定向回登录页面时。

**编辑：**

因为这个应用程序已经在生产中，所以我无法更改登录/注销/超时过程的页面流程或重命名登录页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T01:07:49.633

在 login.aspx 页面登录后，检查用户是否被授权访问 returnUrl 中的页面。您可以使用 UrlAuthorizationModule 的这种方法（如果最适合您，也可以使用自定义方法）：

```
System.Web.Security.UrlAuthorizationModule.CheckUrlAccessForPrincipal(

     returnUrl,
     userPrincipal, 
     GET"); 
```

如果用户未获得授权，只需重定向到用户可以访问的页面。

获取用户主体：

```
var roles = System.Web.Security.Roles.GetRolesForUser(username);

var principal = new System.Security.Principal.GenericPrincipal(

   new System.Security.Principal.GenericIdentity(username), 

   roles

); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-15T05:32:00.747

几个选项...

一、用户注销时手动重定向回Login.aspx，所以没有ReturnURL。在您的页面上进行与会话超时匹配的元刷新，这样用户就不会点击他们突然无法访问的资源。

二、总是在Login.aspx的Page_Load中注销某人。嘿，为什么不呢？我可以想到一些原因，但也许它们不适用于您的情况。

三、忽略ReturnURL。您不必调用 RedirectFromLoginPage！将用户重定向到登录时的默认登录页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T18:01:14.590

我们遇到了类似的问题，我通过以下方式修复了它：

```
If "LogOut".Equals(e.CommandName) Then
    FormsAuthentication.SignOut()
    Response.Redirect("~/Login.aspx")
End If 
```

然后在 Login.aspx 中，如果 PostBackUrl 包含将用户发送回 Login.aspx 的 ReturnUrl 参数，我们将其更改为 Login.aspx。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T21:27:50.303

你能改变页面流程吗？

我的意思是，当用户无权访问资源时，而不是重定向回 l​​ogin.aspx 页面，而是将他们重定向到信息页面。

此页面解释了重定向的原因，并为他们提供了如下选项：

```
1\. Click here to login as another user.
2\. Click here to request access to the page.
3\. Click here to login again, if your session has expired. 
```

这将消除循环引用，从而消除问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T08:06:12.070

添加一个 http 模块来检查 Request.UrlReferrer 是否是登录页面，如果是，则检查他们是否有权访问 Request.Url，如果没有，则将它们重定向到“您无权查看此页面”。页。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-20T13:32:44.237

尽管您说您不能将 login.aspx 的名称更改为 HTTP 处理程序，但您是否尝试过添加 HTTP 301 重定向，以便在请求 login.aspx 时服务器将用户重定向到 HTTP 处理程序，例如 login.ashx？

# .net - WebPart 入门

> ID：542435
> 
> 赞同：0
> 
> 时间：2009-02-12T17:28:06.930
> 
> 标签：.net, asp.net, web-parts

在我工作的地方，该部门有自己的 Intranet 站点（不是 Sharepoint！），它与主要公司的站点是分开的。主页是由 150 多个不同的链接组成的混杂，这些链接分为大约 20 个类别。这是一个真正的混乱页面。

我想做的是把这个页面变成一个站点地图。我会将所有链接放入站点地图从中提取的数据库中。这部分几乎已经完成。然后我想创建一个新的主页，该主页使用 Web 部件和此站点地图来创建类似 MyYahoo 或 iGoogle 的体验。

这个想法是创建许多控件，这些控件可以由每个用户自行决定包含在页面上，其中许多控件使用站点地图作为其内容的数据源。我将拥有控件，因此用户可以从站点地图添加一个完整的组、单个链接，甚至将一组链接组合到一个公共标题下（并且还包括此控件的多个自定义实例）。我们也有一些内部的 RSS 提要，所以我想要一个能够向页面添加 RSS 提要的控件。

当所有这些都完成后，它将使我们能够根据可以使用的 webpart 小部件构建新功能，而不是需要为我们需要的每个小功能创建一个新页面。我还希望能够创建模板，以便具有类似工作职能的用户可以从包含他们作为基础所需的大部分内容的页面开始，而不是每个用户都需要从头开始。这一切都相当雄心勃勃。

但是，我很难将我的头包裹在 webparts 上。它应该非常简单，但我只是没有看到它是如何组合在一起的。有人可以指点我一个好的指南或教程吗？谷歌搜索结果的第一页对`webpart tutorial`我没有帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T17:34:51.253

我相信你会在谷歌上找到很多教程。我从以下链接中了解了 WebParts 阅读。看看它是否对您也有帮助... [http://www.developer.com/net/asp/article.php/3618431](http://www.developer.com/net/asp/article.php/3618431) [http://www.code-magazine.com/Article.aspx?quickid=0701081](http://www.code-magazine.com/Article.aspx?quickid=0701081)

# perl - 如何在 Perl 脚本中包含所有/部分“子模块”？

> ID：542436
> 
> 赞同：4
> 
> 时间：2009-02-12T17:28:19.630
> 
> 标签：perl, perl-module

我首先要说我在创建 Perl 模块方面一点经验都没有，所以如果我离开这里，我很抱歉。

假设我正在创建一些模块：

```
foo::bar
foo::bar::a
foo::bar::b 
```

因为我不知道它们叫什么，所以我将 a.pm 和 b.pm 模块称为“子模块”，因为它们与 bar.pm 模块相关，但仍然可能有些独立。

所以我的一个 Perl 脚本可以使用 foo::bar::a，另一个脚本可以使用 foo::bar::b，也许我还有另一个脚本需要使用“a”和“b”中的函数。而不是这样说：

```
use foo::bar;
use foo::bar::a qw(one two);
use foo::bar::b; 
```

我想做这样的事情：

```
use foo::bar qw(:a :b); 
```

在我看来，这将使我的脚本可以访问 bar.pm、a.pm 和 b.pm 中的所有内容。

我测试了这样的东西，我显然错了。

这样的事情可能吗？我想我可以让 bar.pm 使用 a.pm 和 b.pm，然后使用“包装器”函数将调用传递给“子模块”，但似乎会有更简单的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T17:55:39.253

查看我的[Test::Data](http://search.cpan.org/dist/Test-Data)模块以获取有关执行此操作的示例。即使你可以做到这一点，我从来没有非常喜欢这个结果。您可能需要考虑使用插件或 Mixin 方法。[CPAN](http://search.cpan.org)上有一些模块可以帮助解决这个问题。

这`import`是我为 Test::Data 编写的自定义：

```
子导入
    {
    我的 $self = 班次；
    我的 $caller = 来电者；

    foreach 我的 $package (@_)
        {
        我的 $full_package = "Test::Data::$package";
        eval "需要 $full_package; 1";
        如果（$@）
            {
            carp "不能要求 Test::Data::$package: $@";
            }

        $full_package->export($caller);
        }

    }

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T17:37:19.640

是的，你可以这么做。它可能涉及在 foo::bar 中编写自定义的“子导入”，以您想要的方式解释传入的参数。

可能您现在正在使用 Exporter，问题在于它不支持您的语法。您会发现 Exporter 实现的模块语法没有什么特别之处；这只是一个常见的约定。不过，您可能想看看它是如何开展业务的，以深入了解您想要的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:03:35.547

如果你不知道一个模块叫什么，你为什么要包括它？您不需要包含它。仅在需要它的（调用）模块中包含一个模块，而不是其他任何地方。

那就是：如果你正在使用它，那么“使用”它。如果您不使用它，请不要“使用”它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:52:18.620

还可以尝试查看[Class::MixinFactory](https://metacpan.org/pod/Class::MixinFactory)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T18:18:24.377

是的，但是您必须安装自己的导入子：

```
use strict;
use warnings;

package ab;
use base qw<Exporter>;
our @EXPORT_OK;
our %EXPORT_TAGS;
BEGIN { 
    @EXPORT_OK   = qw<>;
    %EXPORT_TAGS = ( a => 1, b => 1, all => \@EXPORT_OK );
}

sub setup_part { 
    #use Smart::Comments;
    my $code = shift;
    my $mini_path = "foo/bar/$code.pm";
    return if exists $INC{$mini_path};
    require $mini_path; 
    my $arr_ref 
        = do { no strict 'refs';
            \@{Symbol::qualify( 'EXPORT_OK', $code )};
        };
    $code->import( @$arr_ref );
    push @EXPORT_OK, @$arr_ref;
    $EXPORT_TAGS{$code} = [ @$arr_ref ];
    return;
}

sub import { 
    my ( $package_name, @imports ) = @_;
    my %import_hash = map { $_ => 1 } @imports;
    if ( exists $import_hash{':all'} ) { 
        @import_hash{qw<:a :b>} = ( 1, 1 );
    }
    foreach my $import ( grep { exists $import_hash{$_} } qw<:a :b> ) { 
        setup_part( substr( $import, 1 ));
    }
    goto &{Exporter->can( 'import' )};
}

1; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-09T06:42:44.567

我一直在寻找类似于最近的解决方案。我知道 - 太旧的线程 - 但我想评论**brian d foy的答案（2009***年 2 月 12 日 17:55*），但遗憾的是我没有足够的声誉来完成这个。这就是为什么我将我的评论添加为新的回复。

 **他的回答帮助我解决了与最近类似的问题。但如果与`use lib`.

我有一堆看起来像`A::B::*`. 这些应该由通用模块加载到脚本中`A::B`。所有这些模块都在加载脚本所在目录下的文件中。使用**brian d foy**建议的机制，我们可以得到许多*子程序重新定义的错误*。为了避免所有这些，我相信，我找到了一个更好的解决方案，比`no warnings 'redefine'`. 现在我们可以自由使用`use lib`，`no warnings 'redefine'`或者`shift @INC, ...`在主脚本中。

```
    子导入{
        @TAGS = (@_);
        我的 $me = shift @TAGS;

        (我的 $pm = $me) =~ s|::|/|g;
        $pm .= ".pm";

        ( $dir = $INC{$pm} ) =~ s/\.pm$//;
        foreach ( glob "$dir/*.pm" ) {
            /(\w+)\.pm$/;
            我的 $module = "${me}::$1";

            eval "使用 $module qw(:all)"; # 您可以自由使用导出列表中的任何项目
            die "$me: Error while loading $module from $_: $@\n" if $@;
        }

        # 从每个 A::B::*::EXPORT_OK 手动填写 @EXPORT_OK 和 %EXPORT_TAGS
        # ...

        转到 &{ Exporter->can( "import" ) };
    }

```

# jquery - 使用 Visual Studio 2008 让智能感知适用于 .js 文件中的 JQuery 和 javascript

> ID：542439
> 
> 赞同：6
> 
> 时间：2009-02-12T17:28:48.693
> 
> 标签：jquery, visual-studio, intellisense

我遵循了 ScottGu 关于使用 -vsdoc.js 文件启用 javascript 智能感知的建议。

[http://weblogs.asp.net/scottgu/archive/2008/11/21/jquery-intellisense-in-vs-2008.aspx](http://weblogs.asp.net/scottgu/archive/2008/11/21/jquery-intellisense-in-vs-2008.aspx)

现在，当我在我的 HTML/ASPX 文件中编写 javascript 时，我得到了智能感知。我将大部分 javascript 编写在单独的 javascript 文件中，这些文件使用如下脚本标签附加到我的代码中：

```
<script type="text/javascript" src="./js/myhappyjavascript.js"></script> 
```

在这样的文件中，我没有得到智能感知，这是我最需要它的地方。有谁知道我怎样才能让 jquery 上的智能感知也在那里工作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-12T17:32:00.370

没错，加

```
/// <reference path="path-to-jquery" /> 
```

在你的 js 文件的开头。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T21:46:09.277

您还可以在 js 文件的开头包含对您的 aspx 页面的引用，并且智能感知的行为就像您在页面上一样。

```
/// <reference path="mypage.aspx" /> 
```

您可能想查看参考标记的参考。

[http://blogs.msdn.com/webdevtools/archive/2007/11/06/jscript-intellisense-a-reference-for-the-reference-tag.aspx](http://blogs.msdn.com/webdevtools/archive/2007/11/06/jscript-intellisense-a-reference-for-the-reference-tag.aspx)

# c# - 窗户类型

> ID：542444
> 
> 赞同：0
> 
> 时间：2009-02-12T17:30:08.220
> 
> 标签：c#, coderush-xpress

CodeRush 文件搜索工具“快速文件导航”看起来与常规“查找”窗口非常相似。那是什么类型的窗口/表单？

我们如何创建保留在 VS IDE 中的窗口（我猜是 MDI）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T22:26:27.917

Gishu 是对的，在 WinForms 中也是如此：`Form.WindowStyle = WindowStyle.ToolWindow`. 我使用[SandDock](http://www.divil.co.uk/net/controls/sanddock/)来获取 Visual Studio IDE 可停靠环境。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T17:45:07.997

我相信它们被称为 ToolWindows。WPF Window 类有一个[WindowStyle 属性](http://msdn.microsoft.com/en-us/library/system.windows.window.windowstyle.aspx)，可让您获得该外观。请参阅链接末尾的图像。

至于创建留在 VS IDE 中的可停靠工具窗口，谷歌是您的提供者。我发现[这个](http://www.mztools.com/articles/2006/mz2006007.aspx)看起来像你需要的。

但是工具窗口可以超出父表单的范围......至少VS find-in-files 窗口可以。

# asp.net - 如何在 asp.net 项目之间重用 html/js/server 端代码？

> ID：542448
> 
> 赞同：2
> 
> 时间：2009-02-12T17:31:05.660
> 
> 标签：asp.net, version-control, visual-sourcesafe, code-reuse

我们有一个博客系统，我们出售给许多不同的客户（包括在许多不同的项目中）。该系统包括许多不同的文件——几个 aspx 页面、一个或两个 ascx 控件、一个 css 文件、一个 javascript 文件和一些 codebehind/vb.net 实用程序文件。一般来说，这个模块的 90% 以上在客户之间是相同的——但当然每个客户都想要一些定制——从装饰性的 html/css 更改到服务器/客户端逻辑调整。

目前，要将我们的博客系统部署到一个新项目，我们只需复制文件（从我们处理的上一个项目中）并根据需要自定义文件……但现在我们有 10 个独特且不兼容的博客系统副本。仅仅让博客系统在每个项目中工作需要相当多的时间——并且将改进从新的博客系统传播到旧的系统和维护是一个真正令人头疼的问题。

理想情况下，我们会有一个博客系统文件的“黄金副本”，用于一般 (90%) 案例。我们可以将那个黄金副本添加到一个新项目中，让一个博客系统几乎可以立即运行——但是我们可以根据需要添加或自定义文件。更好的是——随着我们对“黄金副本”的改进，这些更改可以轻松部署到我们所有的站点——同时尊重我们为客户所做的定制。

我知道我们可以添加新的 css 文件来更改基类并添加新的 vb.net 类来覆盖基本服务器端逻辑——但我真的不确定如何处理 aspx、ascx 和 js 文件。 **理想情况下，我们可以找到基于文件或源代码安全的解决方案——例如，如果存在带有自定义的新文件，它将自动覆盖黄金文件中任何相应的标记/js/etc。** 当然，我们对所有解决方案持开放态度——这似乎是一个很常见的场景，所以我希望有人能开发出“最佳实践”。我所描述的甚至可能吗？任何建议或方向都非常感谢 - 在此先感谢！

谢恩

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T14:32:07.173

You could use your source control system and Visual Studio to do this, but it could get messy if your successful (many clients). If you took this approach, here’s how I would do it.

1.  Separate the code into 2 structures or Visual Studio projects. The common code (the 90% you mention) and the customized code (the other 10%).

2.  Create an initial structure or baseline in your source control system. This is the most generic version of the two code sets.

3.  Branch the customized portion of the code for each client.

4.  Branch the common code portion when you have bug fixes or other updates. Within Visual Studio you could either create 1 project and merge the directories or use 2 different projects combined under one solution.

Hope that helps.

# xml - 用于缩进 XML 文件的正则表达式

> ID：542455
> 
> 赞同：3
> 
> 时间：2009-02-12T17:32:38.450
> 
> 标签：xml, regex, pretty-print

是否可以编写一个 REGEX（搜索替换），在 XML 字符串上运行时会输出缩进很好的 XML 字符串？

如果是这样，那是什么正则表达式 :)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T17:36:21.450

如果您不使用正则表达式，这样做会简单得多。事实上，我什至不确定正则表达式是否可行。

大多数语言都有 XML 库，可以使这项任务变得非常简单。您使用什么语言？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T18:42:15.053

> 是否可以编写在 XML 字符串上运行时的 REGEX（搜索替换）[...anything]

不。

Use an XML parser to read the string, then an XML serialiser to write it back out in ‘pretty’ mode.

Each XML processor has its own options so it depends on platform, but here is the somewhat long-winded way that works on DOM Level 3 LS-compliant implementations:

```
input= implementation.createLSInput();
input.stringData= unprettyxml;
parser= implementation.createLSParser(implementation.MODE_SYNCHRONOUS, null);
document= parser.parse(input);
serializer= implementation.createLSSerializer();
serializer.domConfig.setParameter("format-pretty-print", true);
prettyxml= serializer.writeToString(document); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T17:41:16.230

我不知道正则表达式是否可以单独执行任意 XML 输入的漂亮打印格式。您需要程序应用正则表达式来查找标签、定位匹配的结束标签（如果标签不是自闭合的）等等。使用正则表达式来解决这个问题实际上是使用了错误的工具来完成这项工作。打印 XML 最简单的方法是使用 XML 解析器，将其读入，设置适当的序列化选项，然后将 XML 序列化回来。

为什么要使用正则表达式来解决这个问题？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T17:49:49.703

为此使用正则表达式将是一场噩梦。根据节点的层次结构跟踪缩进级别几乎是不可能的。也许 perl 的 5.10 正则表达式引擎可能会有所帮助，因为它现在是可重入的。但是我们不要走那条路……此外，您还需要考虑可以嵌入 XML 声明的 CDATA 部分，这些声明需要被缩进忽略并保持原样。

坚持使用 DOM。正如另一个答案中所建议的那样，一些库已经提供了一个可以为您缩进 DOM 树的函数。如果不构建一个将比创建和维护将执行相同任务的正则表达式简单得多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-30T09:12:34.327

The dark voodoo regexp as described here works great.
[http://www.perlmonks.org/?node_id=261292](http://www.perlmonks.org/?node_id=261292)
Its main advantage against using XML::LibXMl and others is that it's an order of magnitude faster.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T17:37:47.203

这只能通过多个正则表达式来实现，它的执行类似于状态机。

您正在寻找的东西更适合现成的解析器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-10T19:57:26.487

From [this link](http://www.experts-exchange.com/questions/21046521/Format-XML-string-into-pretty-indented-XML.html):

```
 private static Regex indentingRegex=new Regex(@"\<\s*(?<tag>[\w\-]+)(\s+[\w\-]+\s*=\s*""[^""]*""|'[^']*')*\s*\>[^\<]*\<\s*/\s*\k<tag>\s*\>|\<[!\?]((?<=!)--((?!--\>).)*--\>|(""[^""]*""|'[^']'|[^>])*\>)|\<\s*(?<closing>/)?\s*[\w\-]+(\s+[\w\-]+\s*=\s*""[^""]*""|'[^']*')*\s*((/\s*)|(?<opening>))\>|[^\<]*", RegexOptions.ExplicitCapture|RegexOptions.Singleline);

  public static string IndentXml(string xml) {
        StringBuilder result=new StringBuilder(xml.Length*2);
        int indent=0;
        for (Match match=indentingRegex.Match(xml); match.Success; match=match.NextMatch()) {
              if (match.Groups["closing"].Success)
                    indent--;
              result.AppendFormat("{0}{1}\r\n", new String(' ', indent*2), match.Value);
              if (match.Groups["opening"].Success&&(!match.Groups["closing"].Success))
                    indent++;
        }
        return result.ToString();
  } 
```

# tfs - TFS 构建，我应该将自定义任务添加到哪个文件？

> ID：542461
> 
> 赞同：1
> 
> 时间：2009-02-12T17:34:32.173
> 
> 标签：tfs, tfsbuild

我是 TFS 构建的新手。

我现在正在查看 .proj 文件，我看到它引用了 microsoft.teamfoundation.build.targets 文件。

我应该将自定义任务添加到哪个文件？该文件位于何处（如果不是 .proj 文件）？

我想添加一个自定义任务来运行 dotfuscator（命令行工具）并将 .xml 文件作为参数传递给它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:41:02.720

您可以将自定义步骤添加到主项目文件中，或者如果您想将两者分开，您可以创建自己的目标文件。您应该不理会 microsoft.teamfoundation.build.targets！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T20:23:43.920

将自定义目标添加到主 TFSBuild.proj 文件。Microsoft 包含许多目标名称，旨在通过在 TFSBuild.proj 文件中创建具有该名称的目标来覆盖它们。

例如，我有一个目标可以运行并创建我的 Wix 安装程序、压缩文档等，并且它位于

在 Team Build 过程结束时发生的目标，就在所有内容都被复制到放置位置之前。

有关可以在 TFS2008 构建中覆盖的所有目标的参考，请参阅 MSDN 中的以下文章：

[http://msdn.microsoft.com/en-us/library/aa337604.aspx](http://msdn.microsoft.com/en-us/library/aa337604.aspx)

祝你好运，

马丁。

# unit-testing - 单元测试 jsp 2.0 .tag 文件

> ID：542465
> 
> 赞同：2
> 
> 时间：2009-02-12T17:35:26.837
> 
> 标签：unit-testing, jsp-tags

人们如何测试 jsp 2.0 标签？具有 .tag 扩展名的那些基本上是 jsp 文件，对传递参数有一些额外的支持。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:54:09.943

我们这样做的方法是将 jsp 页面作为测试夹具并通过 selenium 运行断言。几乎不是一个“快速”的单元测试，但也没有你担心的那么低效。

无论如何，您都希望该硒测试装置运行，对吗？我们将它用于一些单元测试，例如固定装置，并以系统的方式运行 JsUnit 测试。

# open-source - 需要关于源标头中大量修改的 OSS 代码（BSD、Apache 等）的归属/版权的建议

> ID：542470
> 
> 赞同：10
> 
> 时间：2009-02-12T17:36:22.357
> 
> 标签：open-source, licensing

我有一个关于使用许可许可（BSD、Apache、MIT 等）源的问题，其中原始代码和借用代码之间的界限可能非常模糊。

我们非常乐意按照许可的要求披露原始来源的版权。

我想知道的具体情况是如何正确更新我修改过的文件中的源头。

假设你有一些来自另一个项目的源代码，你想使用它。它包含如下标题。

```
/*
 * Copyright (C) 2006, 2007 John Doe.
 * Copyright (C) 2008, 2009 Project comitters.
 * All rights reserved.
 *
 * The software in this package is published under the terms of the BSD
 * style license a copy of which has been included with this distribution in
 * the LICENSE.txt file.
 * 
 * Created on 07\. March 2004 by John Doe
 */ 
```

对于一个微不足道的错误修复，我只会做我的小改动，将其发送到上游并希望修复被合并。当它发生时，我会放弃我的补丁版本并回到主线。

有时我想使用源作为起点。它会随着时间的推移而发生变化，并进行重新设计和改进。它可能类似于原始代码，但到那时它肯定是我们自己的工作。

那么用我自己的替换那个标题可以吗？我应该只写“基于 John Doe 的原始 XYZ”之类的东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T17:39:23.893

BSD 系列许可证明确禁止您修改或删除其标题。

编辑：我想我应该更深入地了解这一点。

本质上，您使用他们的代码作为您自己的代码的基础。由于这种影响，您仍然受原始许可证的约束，因此必须保持原始归属不变。

# reporting-services - SSRS - OutOf MemoryException - 可以显示的行数是否有限制

> ID：542471
> 
> 赞同：4
> 
> 时间：2009-02-12T17:36:27.333
> 
> 标签：reporting-services, matrix, max, rows, rdl

我创建了一个 rdl 文档，它指向一个返回 90 000 行的 proc，但我遇到了内存不足的异常。报表项目可以处理的行数是否有限制？

目前，我已将驱动我的报告的 proc 更改为仅选择 Top 90 000。我的规范是能够创建一个包含 120 000 行的报告。我的报告是一个矩阵。

我发誓上周我生成了一份包含 106800 行的报告，但现在我突然不能了。

我已经编写了一个渲染扩展，当我进入代码时，这是异常的一部分。

> eInfo：2/12/2009 12:03:53 PM prairieFyre.ReportActions.RenderReport：错误呈现报告 Microsoft.Reporting.WinForms.LocalProcessingException：本地报告处理过程中发生错误。---> Microsoft.ReportingServices.ReportProcessing.ReportProcessingException：报告处理中发生意外错误。---> System.OutOfMemoryException：引发了“System.OutOfMemoryException”类型的异常。在 System.IO.MemoryStream.set_Capacity(Int32 value) 在 System.IO.MemoryStream.EnsureCapacity(Int32 value) 在 System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count) 在 System.IO.BinaryWriter .Write(String value) 在 Microsoft.ReportingServices.ReportProcessing.Persistence.IntermediateFormatWriter.ReportServerBinaryWriter.WriteString(String stringValue) ....

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:45:16.453

除了您的硬件配置之外，我认为没有限制。如果您在 32 位机器上，正在处理它的工作进程的可用内存不到 2 GB，当您考虑内核模式内存时，可能接近 1 GB。如果您要提供这样的大型报告，您可能需要一个 64 位设置，至少有 4 GB 或更多内存。此设置将允许工作进程分配超过 2 gig 的可用内存来完成这些大型请求而不会出现问题。

如果硬件升级不是一个选项，您也可以考虑这些替代方案。

*   您说该报告是矩阵报告，因此听起来您并未向用户显示所有数据，而是对其进行汇总。您能否在数据库中预先汇总一些此类数据，然后仅使用 SSRS 进行显示？

*   由于报告只不过是一个 XML 文件，因此可以从 SQL 服务器内或使用某些脚本或进程构建报告 XML 字符串。这可能是很多工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-08-02T11:52:46.197

堆栈表明用于存储报表执行结果的 MemoryStream 不能增加（加倍）它的大小。

这通常是由地址空间碎片引起的，通常无法通过添加硬件来解决。

Microsoft ReportViewer 可以处理的数据量受到限制，因为它旨在将中间报告执行结果存储在 MemoryStream 中，不幸的是，它需要二次增长量的连续可用地址空间，这在通常的 .NET 应用程序中（2GB 地址空间) 不大于 256MB，而且通常比这小得多。

例如，在此流中，所有字段值、聚合值、表达式和图像都被存储，因此大小直接取决于添加到报告中的数据集的大小。

要分析 .NET 应用程序的地址空间和对象，最好使用 WinDBG（Windows 调试工具）和 SOS 扩展进行调试。

分析地址碎片的有用命令是：

*   !address -摘要
*   流明
*   !EEHeap -gc
*   !DumpHeap -stat

在这种特殊情况下，可以通过预先聚合已经在数据源中而不是在矩阵中的值来减少数据量。

知识库文章“使用 SQL Server Reporting Services 时可能会收到 'System.OutOfMemoryException' 错误消息”[1] 提供了更多提示。

[1]： http: [//support.microsoft.com/kb/909678](http://support.microsoft.com/kb/909678)使用 SQL Server Reporting Services 时出现“System.OutOfMemoryException”错误消息

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-27T22:51:05.343

检查您的 interactiveHeight 属性是否未设置为 0。 [https://web.archive.org/web/20150515073010/http://www.bidn.com/blogs/MMilligan/bidn-blog/2903/ssrs-gotcha-interactiveheight =0](https://web.archive.org/web/20150515073010/http://www.bidn.com/blogs/MMilligan/bidn-blog/2903/ssrs-gotcha-interactiveheight=0)

# asp.net - 适用于 .NET 平台的最佳 Web 特定拼写检查器？

> ID：542475
> 
> 赞同：0
> 
> 时间：2009-02-12T17:38:01.370
> 
> 标签：asp.net, spell-checking

我们目前正在查看下面列出的产品，但我想看看其他人在使用什么。

[http://www.aspnetspell.com/](http://www.aspnetspell.com/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-15T12:37:04.837

如果你仍然觉得它很有趣，看看这个 WebSpellCheker，这里是链接 - [http://www.spellchecker.net/](http://www.spellchecker.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:48:28.363

我过去使用过 Infragistics WinForm SpellChecker，效果很好。

这是他们的 ASP WebSpellChecker 的链接

[http://www.infragistics.com/dotnet/netadvantage/aspnet/webspellchecker.aspx#Overview](http://www.infragistics.com/dotnet/netadvantage/aspnet/webspellchecker.aspx#Overview)

# svn - 从 ClearCase 迁移到 SVN 的最佳策略是什么？

> ID：542479
> 
> 赞同：16
> 
> 时间：2009-02-12T17:38:45.017
> 
> 标签：svn, migration, clearcase

我们正在考虑从 ClearCase 迁移到 Subversion。该项目已经存在了一段时间（7 年），我们积极支持三个“主要”版本（分支），以及旧版本中的一些偶尔修复。这个项目相当大——大约 200 万行 java 代码。

我很好奇是否有人做过类似的迁移。

*   SVN能处理这么大的项目吗？
*   迁移所有历史版本/分支是否有意义？可以有选择地执行此操作的工具吗？
*   这样一个项目的迁移过程需要多长时间，迁移过程中的有效工作方式是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T20:56:33.640

由于进行了几次此类迁移，我认为：

*   您不需要将 ClearCase 版本的*所有*历史记录导入 SVN。大多数时候（根据我的经验），除非您真正需要细粒度的历史修订检查，否则只需要标记版本（一致应用于给定集合的所有文件的版本）。

*   您需要考虑迁移期间的***重组***：导入什么？留下什么？您是否希望 SVN 内容*准确*反映存储在 ClearCase VOB 中的文件结构？有时，此类迁移是重新考虑其中一些文件组织的机会（通常通过对某些目录进行简单的重命名规则）。

*   ClearCase 2 SVN 方式的迁移更快，因为 SVN 以存储库为中心并提交一组文件，而 ClearCase 以文件为中心并逐个文件提交（慢得多）

*   如果明确标识了要导入的文件集，则可以多次重复迁移过程，这意味着您可以在第一次（大）导入发生时继续在 ClearCase 中工作，然后将基线（UCM 标签）放在您的代码，并仅重新导入增量，从而有效地结束迁移过程。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-03T08:01:38.480

首先是一些资源：

1.  [Clearvision CC2SVN 工具](http://www.clearvision-cm.com/products/clearcase-and-subversion-complete-integration.html)
2.  [Polarion 的 SVN 进口商](http://www.polarion.com/products/svn/svn_importer.php)
3.  [CollabNet 上的文章和资源](http://blogs.open.collab.net/svn/2007/04/migration_from_.html)

实际存储库的大小、文件数量或其大小不是 SVN 的限制因素。开发人员的数量、更改的并发性、集成和发布过程的复杂性、合并和目录版本控制（重构）的需要可能会给大型项目带来问题。如果您的项目很大，但它相当稳定，开发人员数量少，分支数量少，并且不需要将大量修复程序向后移植到几个先前的版本，那么 SVN 应该可以满足您的需求。

我编写了一个自定义迁移工具，将数据从 ClearCase 中带出，这不是一件容易的事。每两个系统都有不同的数据模型和对数据的操作。我不建议尝试编写任何自定义迁移工具，因为实际上很难以任何有意义的方式从 ClearCase 中获取数据。有关商业解决方案限制的详细信息，我建议联系资源中链接的解决方案提供商。

我个人会尝试带入尽可能多的数据，但您必须了解 SVN 与 ClearCase 相比的局限性。在此迁移过程中，任何目录版本控制（重构）历史都可能会丢失。SVN 不支持像 ClearCase 这样的稀疏分支，如果您使用任务分支，这可能会使您的 SVN 存储库的大小膨胀。在这种情况下，您可能只想将自己限制在系统分支上。ClearCase 中的文件具有单独的分支结构，而 SVN 具有每个产品的分支，这将导致在此过程中进行大量的分支翻译。通过将自己限制在系统分支上，并且可能只在这些分支上标记版本以在系列中完全集成标签，您可以为自己省去很多麻烦。如果您的团队正在使用 UCM，您几乎可以忘记所有 UCM 元数据。

时间框架很大程度上取决于所使用的工具。对于像您这样的大型项目，它甚至可能需要数周时间。由于某些奇怪的原因，ClearCase 数据库即使在读取操作时也有很多锁定，并且所有内容都有一个中央表，这会在大规模访问中产生很多问题，例如迁移会导致。我第一次在比你的大一点的产品上运行我的工具时，我们估计它会运行 3 年，经过大量优化、并行化和增量迁移后，它减少到大约一周。但预计根据工具的完成情况，它所花费的时间可能会有很大差异。尽管由于您迁移到 SVN 并且您将忽略来自 ClearCase 的许多历史记录和元数据，但您的迁移应该会快得多。

ClearVision 在其页面上提到其 CC2SVN 工具可以在这两种产品之间架起一座桥梁。虽然我没有使用这个工具，但如果它像我假设的那样工作，它会让你在一些处理后同步 2 个存储库，这将允许你在周末切换，而开发停机时间为零。如果这不可能，请尝试要求一些替代方案，例如增量迁移，您首先迁移到某个日期，然后迁移自该日期以来更改的较小数据块。

Very important part of the process is the post migration phase. Please do not discount the headaches the switch will bring to your developers. You must not underestimate the need for training and clear documentation. You will also need a trained support team in your software engineering department capable to operate both SCM systems and to explain to developers how to do things they were used to in the new system. This is actually a point that could break your neck in the migration. Developers resist any change and whatever advantages SVN brings to the project, it is in essence much inferior system. ClearCase gives your developers so much flexibility they will never have with SVN and unless you bring them on board early on in the process, you can lose them or worse, get the whole migration reversed, declared a disaster and lose your own job.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T17:59:14.593

如果您决定搬家，可以查看这个 stackoverflow 问题。
[推荐工具从clearcase到svn迁移](https://stackoverflow.com/questions/57494/recommendation-on-tools-to-migrate-from-clearcase-to-svn)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T17:52:13.143

1.  是的，Subversion 可以处理非常大的项目。例如，所有[Apache 项目](http://svn.apache.org/viewvc/)都在一个单一的 Subversion 存储库中，子项目是简单的子文件夹
2.  如果转换所有历史记录有意义，那么您必须自己决定。但是有很多可用的工具。可以在[这里](http://blogs.open.collab.net/svn/2007/06/subversion-conn.html)找到一篇好的博客文章。
3.  我不知道这样的转换需要多长时间。但是您可以先尝试一小部分并测量时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-27T07:57:20.367

Another option is [Migrate2SVN](http://www.clearvision-cm.com/clearcase-subversion-migration.html). The developer (Clearvision) has just released v2.0 and it appears to include many, MANY improvements over the Polarion software and other methods mention above.

# nhibernate - NHibernate 通用组件

> ID：542482
> 
> 赞同：1
> 
> 时间：2009-02-12T17:39:58.073
> 
> 标签：nhibernate, nhibernate-mapping

如何在 NHibernate 中创建通用组件映射，我有一个类 Pair{virtual T First{get;set}，virtual T Second{get;set;}}，我试图用类似这样的东西来映射它，但它不起作用

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T18:05:46.007

它奏效了，诀窍是我必须使用 `，而我正在使用 '

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T19:30:10.693

我认为您可以映射该类，但您必须在映射中明确声明将使用哪种类型作为泛型参数，如下所示：

```
 <class name="GenericClass`1[ConcreteType], assembly"
         table="table">
        <id name="Id">
            <generator class="identity"/>
        </id>
    </class> 
```

在你的情况下，我想它会是：

```
 <class name="Pair`1[Namespace.TheClass], assembly"
         table="table">
        <id name="Id">
            <generator class="identity"/>
        </id>
    <many-to-one name="First" class="Namespace.TheClass, assembly"/>
    </class> 
```

作为一个组件：

```
<component name="Property" class="Pair`1[Namespace.TheClass], assembly">
    <many-to-one name="First" class="Namespace.TheClass, assembly"/>
</component> 
```

如果您想使用相同的泛型类或具有另一种类型的组件作为泛型参数，则必须为该特定情况创建另一个映射。

# algorithm - 找到最佳数量的拉米风格集的算法？

> ID：542483
> 
> 赞同：3
> 
> 时间：2009-02-12T17:40:18.273
> 
> 标签：algorithm

我正在开发一种纸牌游戏，它使用三张纸牌组成的拉米式套牌。从随机选择的卡片中，我需要算法来挑选出哪些卡片可以让我获得最多的套数。

我所说的“拉米式三件套”是指：

*   所有三张牌都具有相同的价值，例如三个杰克。或者
*   所有三张牌都是相同的花色并按顺序排列，就像 7, 8, 9 都是方块。

例如，给定牌：6D, 7D, 7C, 7H, 8D, 8C, 9C, 10H
我可以组成一组：{7D, 7C, 7H}，但那将是我唯一能摆脱的一组，这不是最佳的。
这种情况下的最佳集合是： { {6D, 7D, 8D}, {7C, 8C, 9C} }

我试过蛮力（排列所有给定的卡片，看看排列中的匹配顺序），但事实证明这太慢了。这个问题感觉它与其他已解决的问题有相似之处，这就是我在这里问的原因。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:41:50.747

如果您有 N 张卡片 (N = 8)，您可以在 N * (N - 1) * (N - 2) 时间内枚举集合中所有不同的三元组（N = 8，您得到 336）。这是相当快的。检查三元组中的哪些是“拉米式”集合，并将它们作为整数三元组存储在表中（整数表示卡片的序列号）。

这是第一步。第二步现在进行组合优化，计算最优选择。执行此操作的简单方法是使用回溯搜索。您在找到的三元组上运行索引（'i'）。首先，您尝试在解决方案中包含第 i 个三元组，然后递归地从索引 i+1 继续；然后您回溯并确定第 i 个三元组*不在*解决方案中，然后递归地从 i+1 继续。对此有很多优化，但对于小型集，它会工作得很好。

这是它如何与您的示例一起使用的：

牌：6D、7D、7C、7H、8D、8C、9C、10H

让我们列举所有可能的三元组：

```
Cards        Index triple
6D 7D 8D     <0, 1, 4>
7D 7C 7H     <1, 2, 3>
7C 8C 9C     <2, 5, 6> 
```

完整的回溯搜索是这样的：

```
Decide on <0, 1, 4>:
  <0, 1, 4> INCLUDED:
     <1, 2, 3> CLASHES with <0, 1, 4>
     Decide on <2, 5, 6>:
       <2, 5, 6> INCLUDED:
          Solution with 2 sets (* BEST SOLUTION)
       <2, 5, 6> EXCLUDED:
          Solution with 1 sets
  <0, 1, 4> EXCLUDED:
     Decide on <1, 2, 3>:
        <1, 2, 3> INCLUDED:
           <2, 5, 6> CLASHES with <1, 2, 3>
           Solution with 1 sets
        <1, 2, 3> EXCLUDED:
           Decide on <2, 5, 6>:
             <2, 5, 6> INCLUDED:
                Solution with 1 set
             <2, 5, 6> EXCLUDED:
                Solution with 0 sets 
```

然后您选择具有最多集合的解决方案（标有星号）。

这很容易实现。尝试一下！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:56:18.017

我的直觉方法是从发现所有可能的系列开始，检查每张卡片并寻找可以用该卡片组成系列的东西（即连续的东西和相同值的东西。）一旦你得到了所有可能的系列，这应该是一个非常快速的操作，除非你有大量的卡片，然后你可以制作一张地图，其中的集合排除了其他集合的包含（它们使用相同的卡片。）在这一点上，甚至置换所有合法的集合的组合（对于我没有的每个集合；如果我可以在我当前的集合中合法使用它，请尝试添加它；重复）应该足够快以提供服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:05:24.233

要找到所有可能的有效三元组，您可以执行 2 个步骤：

```
1\. sort cards first ascending by number, then by suit, as you did
   in your example and look what triples you can get
2\. now sort a second time, but first by suit and then by number 
   and look what triples you can get

In step 1) you can just look sequencially for 3 same numbers => O(n)
In step 2) the same, but now looking for 3 sequential numbers of the same suit. => O(n) 
```

合并这两个结果会给你所有可能的三元组。如果我没记错的话，此时您遇到了[最大集打包](http://en.wikipedia.org/wiki/Set_packing)的 NP-hard 问题，因为您想要获得非重叠三元组的最大子集。由于卡的数量是有限的并且不是那么高，您可以使用例如 antti.huima 提到的回溯算法来解决这个问题。

# sql - 带选择的 SQL 插入语句

> ID：542484
> 
> 赞同：1
> 
> 时间：2009-02-12T17:40:18.447
> 
> 标签：sql, sql-server-2005

我有以下 SQL 语句

```
INSERT INTO A_Table (field1, field2) 
  SELECT field1, field2 FROM B_Table
  WHERE field1 NOT IN (
    SELECT field1 FROM A_Table); 
```

基本上，我需要将所有数据从 B_Table 复制到 A_Table，并带有一个约束：B_Table 中的 field1 在 A_Table 中不存在。我需要添加这个约束，因为 field1 是一个键。

它看起来像一个冲突：不在 A_Table 中的字段 1 从 B_Table 复制到 A_Table。在插入过程中，从 B_Table 复制的记录将存在于 A_Table 中。不确定它是否有效，或任何意想不到的结果？

也许没关系。最后一个SELECT缓存在临时表中，插入时不刷新？

顺便说一句，我的 SQL Server 是 Microsoft SQL Server 2005。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T17:55:03.263

如果您将查询视为两个单独的语句，也许会有所帮助

选择语句

```
 SELECT field1, field2 FROM B_Table
  WHERE field1 NOT IN (
    SELECT field1 FROM A_Table) 
```

这给了你一些结果

现在你将这些结果插入你的表 A_table

```
INSERT INTO A_Table (field1, field2) 
```

完成此操作的代码是

```
INSERT INTO A_Table (field1, field2)
  SELECT field1, field2 FROM B_Table
  WHERE field1 NOT IN (
    SELECT field1 FROM A_Table) 
```

这基本上就是你发布的内容

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:44:34.893

SQL 语句的执行就像一切都立即发生一样。没有时间点（从逻辑上讲）指令已部分执行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T17:50:17.283

SELECT 的结果集是在任何插入发生之前确定的，因此不存在冲突。否则，这样的陈述永远不会安全。有点像代码：

```
x = 1;
x = x + x + 1; 
```

评估右侧，然后才分配给左侧的变量 - 否则谁知道 x 会如何结束！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T17:56:09.453

您的插入语句将按照此 SQL 的演示工作 -

```
CREATE TABLE #temp1 (id INT IDENTITY(1,1) PRIMARY KEY CLUSTERED , [name] NVARCHAR(20))
CREATE TABLE #temp2 (id INT IDENTITY(1,1) PRIMARY KEY CLUSTERED , [name] NVARCHAR(20))

INSERT INTO #temp1 ([name])
VALUES ('name1')
INSERT INTO #temp1 ([name])
VALUES ('name2')
INSERT INTO #temp1 ([name])
VALUES ('name3')
INSERT INTO #temp1 ([name])
VALUES ('name4')
INSERT INTO #temp2 ([name])
VALUES ('Othername1')
INSERT INTO #temp2 ([name])
VALUES ('Othername2')

INSERT INTO #temp2 (name)
SELECT name FROM #temp1
WHERE id NOT IN (SELECT id FROM #temp2)

SELECT * FROM #temp1
SELECT * FROM #temp2

DROP TABLE #temp1
DROP TABLE #temp2 
```

结果是

**温度1**

id 名称

1名称1
2 名称2
3 名称3
4名称4

**温度2**

id 名称

1 其他名称1 2 其他名称
2 3 名称
3
4 名称4

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T17:44:15.223

好吧，看起来该查询无法以其当前形式工作，因为您没有在子查询中指定列。很可能它仍在执行，并且假设您的意思是`not in (null)`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T17:52:21.477

它应该工作得很好。

您应该始终设置一个测试环境，您可以在其中尝试一些东西，看看会发生什么。在搞砸数据库之前，您永远不想依赖陌生人的建议！

# sql-server - PHP mssql_connect 在命令行中有效，但在 Apache 中无效

> ID：542491
> 
> 赞同：1
> 
> 时间：2009-02-12T17:43:43.883
> 
> 标签：sql-server, apache, command-line

只是想分享一个我在尝试`mssql_connect()`从 ubuntu 机器连接到远程 MSSQL Server 时遇到的问题。使用相同的 php.ini 文件和正确的权限，当我通过命令行而不是在浏览器中运行连接脚本时，将建立连接。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T17:44:00.980

经过大量论坛挖掘后，我遇到了这个问题：添加 putenv("TDSVER=70"); 到您的脚本或您的 ntwdblib.dll 的任何版本。tds 库和 MS ntwdblib 使用两种不同的协议。希望这可以帮助。

# sql-server - SSIS Excel导入强制不正确的列类型

> ID：542497
> 
> 赞同：52
> 
> 时间：2009-02-12T17:44:30.637
> 
> 标签：sql-server, excel, types, ssis

我正在尝试使用 SSIS 将电子表格导入我们的数据库。出于某种原因，SSIS 想要相信其中两列是 Double 类型，当它们包含字符数据时。我尝试将列重新映射为 nvarchar(255) 但它仍然不想选择它认为是双倍的数据，因为其中有字符。如果我尝试编辑 SSIS 包并更改 Excel 源中的列类型，它不会让我更改错误输出中列的类型，如果常规输出和错误输出列没有，则会给我一个错误匹配。

为什么 SSIS 坚持这些列是 Double 的？我怎样才能强迫它意识到这些是字符串？为什么微软的一切都不能完全正常工作？

**编辑：**

我找到了这个：

*   [PRB：DTS 向导可能无法检测 SQL Server 中混合数据的 Excel 列类型](https://support.microsoft.com/ar-sa/help/236605/prb-dts-wizard-may-not-detect-excel-column-type-for-mixed-data-in-sql)

我对数据进行了排序，以便混合数据类型位于顶部，然后猜猜看：问题*反转了*。它不再导入字符数据，而是停止导入纯数字数据。显然有人不认为 12345 可以表示为一个字符串......

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-12T18:03:38.280

我以前见过这个问题，不是 SSIS 是 Excel 的问题。Excel 对第一几行进行采样，然后推断数据类型，即使您将其显式设置为文本也是如此。您需要做的就是将它放入 SSIS 包中的 Excel 文件连接字符串中。该指令告诉 Excel 这些列包含混合数据类型，并提示它在确定该列是数字类型之前进行额外检查，而实际上它不是。

```
;Extended Properties="IMEX=1" 
```

它应该适用于此（在大多数情况下）。更安全的做法是将 Excel 数据导出到制表符分隔的文本并使用 SSIS 导入。

*   [http://blogs.acceleration.net/ryan/archive/2005/01/11/477.aspx](http://blogs.acceleration.net/ryan/archive/2005/01/11/477.aspx)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-23T01:52:07.630

您可以将（即强制）列数据转换为文本...试试这个（注意：这些说明基于 Excel 2007）...

以下步骤应强制 Excel 将列视为文本：

使用 Excel 打开电子表格。

通过单击列标题选择包含“主要是数字数据”的整个列。

单击功能区菜单上的数据选项卡。

选择文本到列。这将打开将文本转换为列向导。

-在第 1 步：单击下一步

-在第 2 步：单击下一步

-在第 3 步：选择文本并单击完成

保存您的 Excel 工作表。

使用 SQL Server 2005 导入数据向导重试导入。

此外，这是另一个问题的链接，该问题有其他回复：

[导入数据向导不喜欢我为列选择的数据类型](https://stackoverflow.com/questions/779754/import-data-wizard-does-not-like-data-type-i-choose-for-a-column/779956#779956)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-08-04T16:41:17.970

接受的答案中没有提到的一件事是“IMEX = 1”参数必须进入*以下*引用的部分：

```
...;Extended Properties="..."; 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-08-03T13:32:39.697

;IMEX=1; 并不总是有效...关于 Excel 中 [混合数据类型的所有信息：Excel 列中的混合数据类型](http://microsoft-ssis.blogspot.com/2011/06/mixed-data-types-in-excel-column.html)

![在此处输入图像描述](https://i.stack.imgur.com/7cleR.jpg)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-06-16T18:01:17.247

另一种解决方法是使用顶部的字符数据对电子表格进行排序，从而导致 Excel 将列视为字符串，并导入所有内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-07-06T23:49:41.847

您还可以更改注册表以查看比前 8 行更多的值。我已经使用了这种方法并且效果很好。

[http://support.microsoft.com/kb/281517](http://support.microsoft.com/kb/281517)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-05T21:40:55.907

那么 IMEX=1 对我不起作用。Reynier Booysen 的建议也没有。（我不知道这是否有所不同，但我使用的是 SQL Server 2008r2）。可以在 [http://social.msdn.microsoft.com/Forums/en-US/sqlintegrationservices/thread找到对一些变通办法的很好解释以及为什么 IMEX=1 仅限于每个电子表格的前八行的一些解释/78b87712-8ffe-4c72-914b-f1c031ba6c75](http://social.msdn.microsoft.com/Forums/en-US/sqlintegrationservices/thread/78b87712-8ffe-4c72-914b-f1c031ba6c75)

希望这可以帮助

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-16T10:13:08.440

我使用了以下食谱：

1.  将数据从 Excel 导入 Access
2.  将数据从 Access 导入 SQL Server

它对我有用......

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-14T00:44:00.997

有一段时间，我一直在用这个问题把头撞到墙上。在我们的环境中，我们使用来自供应商的各种格式的价格文件，其中一些具有超过一百万条记录。此问题通常发生在以下情况：

*   OLEDB 驱动程序扫描的行似乎包含数字，但稍后在记录集中确实包含混合值，或者
*   字段确实只包含数字，但源有一些格式为文本（通常是 Excel 文件）。

问题是，即使您将外部输入列设置为所需的数据类型，每次运行包时都会扫描文件，并动态更改为 OLEDB 驱动程序认为该字段应为的任何内容。

我们的源文件通常包含字段标题（文本）和价格（数字字段），这给了我一个简单的解决方案：

**第一步：**

*   更改您的 SQL 语句以包含标题字段。这会强制 SSIS 将所有字段视为文本，包括价格字段。

**对于混合领域：**

*   您的初始问题已解决，因为您的字段现在是文本，但您的输出中仍然有一个标题行。
*   通过更改 SQL WHERE 子句以排除标题值，例如“WHERE NOT([F4]='Price')”，防止标题行进入您的输出

**对于数字字段：**

*   使用 OLE DB 源的高级编辑器，将价格字段（或任何其他数字字段）的输出列设置为数字数据类型。这会导致在这些字段中包含文本的任何记录（包括标题记录）失败，但会强制对另存为文本的数值进行转换。

*   设置错误输出以忽略数字字段上的失败。

*   或者，如果您仍然需要重定向数字字段的任何错误，请通过更改 SQL WHERE 子句以排除标题值来删除标题行，然后，

*   设置错误输出以重定向此字段上的失败。

显然，此方法仅适用于您有标题字段的情况，但希望这对你们中的一些人有所帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-18T18:32:10.483

选项 1\. 使用 Visual Basic 遍历每一列并将每一列格式化为文本。

使用 Text-to-Columns 菜单，不要更改分隔符，将“General”更改为“Text”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-04-03T13:26:04.367

我有同样的问题。问题出在**Excel Source**任务中。当您第一次设置此任务时，该任务将连接到指定的 Excel 文件（通过 Excel 连接）并根据当前电子表格决定每列的类型。

因此，如果您设置**Excel 源**任务，只需确保应该是文本的列中只有文本。这意味着**Excel 源**任务将始终假定任何后续电子表格将具有相同的格式并将*12345*读取为文本，因为在设置任务时该列是文本。

希望这是有道理的！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-12-10T12:52:46.763

我有同样的问题，单列中有多个数据类型值，包只加载数值。保持所有更新为空。

**解决方案**

要解决此问题，更改 excel 数据类型是解决方案之一。在 Excel 中**复制列数据**并粘贴到不同的文件中。**删除该列**并将**新列作为文本数据类型插入**，并将复制的数据粘贴到新列中。

现在在 ssis 包中**删除并重新创建 Excel 源**表和目标表，将列**数据类型更改为 varchar**。

这将起作用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-11-16T12:01:00.693

如果 excel 电子表格中的多个列具有相同的名称，则会发生这种错误。使列名不同后，该包将起作用。有时在检查列名称时会忽略隐藏列。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-07-12T14:20:56.017

1.  单击功能区菜单上的文件，然后单击选项。
2.  单击高级，然后在计算此工作簿时，选中将精度设置为显示复选框，然后单击确定。

3.  单击确定。

4.  在工作表中，选择要设置格式的单元格。

5.  在主页选项卡上，单击数字旁边的对话框启动器按钮图像。

6.  在类别框中，单击数字。

7.  在小数位数框中，输入要显示的小数位数。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-12-06T15:29:19.983

这对我有用。在 Excel 中选择有问题的列 - 突出显示整列。将格式更改为“文本”。保存 Excel 文件。

在您的 SSIS 包中，转到数据流窗格进行导入。双击 Excel 源节点。它应该警告您类型已更改，并询问您是否要重新映射它们。单击是。执行现在应该起作用并带来所有价值。

注意：我使用的是 Excel 2013 和 Visual Studio 2015，但我认为这些说明也适用于早期版本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-08-06T20:45:30.353

我花了一点时间才意识到我的包中错误的来源。最终我发现数据被转换为空（`Example: from "06" to "NULL"`），我通过源文件连接（`Excel Source> Edit> Connection Manager> Sheet='MySheet'> Preview...`）中的预览找到了这个。当我阅读 James 的帖子以编辑连接字符串以具有扩展属性时，我感到很兴奋：`;Extended Properties="IMEX=1"`. 但这对我不起作用。

我能够通过将 Excel 工作表中的单元格格式从“数字”更改为“文本”来解决该错误。更改格式后，上传过程运行成功！我的连接字符串如下所示：`Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\\myServer\d$\Folder1\Folder2\myFile.xlsx;Extended Properties="EXCEL 12.0 XML;HDR=NO";`

这是一些解决我的错误消息的屏幕截图。

**错误**：*Excel 文件连接的元数据* [![在此处输入图像描述](https://i.stack.imgur.com/j2eAr.png)](https://i.stack.imgur.com/j2eAr.png)

**错误来源**：*“一般”格式* [![在此处输入图像描述](https://i.stack.imgur.com/q2Svb.png)](https://i.stack.imgur.com/q2Svb.png)

**错误来源已更改**：*“文本”格式* [![在此处输入图像描述](https://i.stack.imgur.com/SCrd9.png)](https://i.stack.imgur.com/SCrd9.png)

**错误修复**：*Excel 文件连接的元数据* [![在此处输入图像描述](https://i.stack.imgur.com/oh9vM.png)](https://i.stack.imgur.com/oh9vM.png)

# sql - 如何创建参数化 SQL 查询？我为什么要？

> ID：542510
> 
> 赞同：96
> 
> 时间：2009-02-12T17:47:27.867
> 
> 标签：sql, vb.net, sql-parametrized-query

我听说“每个人”都在使用参数化的 SQL 查询来防止 SQL 注入攻击，而不必验证每一个用户输入。

你怎么做到这一点？使用存储过程时你会自动得到这个吗？

所以我的理解是非参数化的：

```
cmdText = String.Format("SELECT foo FROM bar WHERE baz = '{0}'", fuz) 
```

这会参数化吗？

```
cmdText = String.Format("EXEC foo_from_baz '{0}'", fuz) 
```

还是我需要做一些更广泛的事情来保护自己免受 SQL 注入？

```
With command
    .Parameters.Count = 1
    .Parameters.Item(0).ParameterName = "@baz"
    .Parameters.Item(0).Value = fuz
End With 
```

除了安全考虑之外，使用参数化查询还有其他优点吗？

更新：这篇很棒的文章链接到 Grotok 的一个问题引用中。 [http://www.sommarskog.se/dynamic_sql.html](http://www.sommarskog.se/dynamic_sql.html)

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-02-12T17:55:22.827

问题中的`EXEC`示例**不会**被参数化。您需要参数化查询（某些圈子中的准备语句）以防止这样的输入造成损坏：

> ';DROP TABLE 栏;--

尝试将其放入您的`fuz`变量中（或者不要，如果您重视`bar`表格）。更微妙和破坏性的查询也是可能的。

下面是如何使用 Sql Server 处理参数的示例：

```
Public Function GetBarFooByBaz(ByVal Baz As String) As String
    Dim sql As String = "SELECT foo FROM bar WHERE baz= @Baz"

    Using cn As New SqlConnection("Your connection string here"), _
        cmd As New SqlCommand(sql, cn)

        cmd.Parameters.Add("@Baz", SqlDbType.VarChar, 50).Value = Baz
        Return cmd.ExecuteScalar().ToString()
    End Using
End Function 
```

存储过程有时被认为可以防止 SQL 注入。但是，大多数时候您仍然必须使用查询参数调用它们，否则它们没有帮助。如果您*专门*使用存储过程，那么您可以关闭应用程序用户帐户的 SELECT、UPDATE、ALTER、CREATE、DELETE 等（除了 EXEC 之外的所有内容）的权限，并通过这种方式获得一些保护。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-12T17:58:10.527

绝对是最后一个，即

> 还是我需要做一些更广泛的事情......？（是的，`cmd.Parameters.Add()`）

参数化查询有两个主要优点：

*   安全性：这是避免[SQL 注入](http://en.wikipedia.org/wiki/SQL_injection)漏洞的好方法
*   性能：如果您定期使用不同的参数调用相同的查询，则参数化查询可能允许数据库缓存您的查询，这是性能提升的重要来源。
*   额外：您不必担心数据库代码中的日期和时间格式问题。同样，如果您的代码将在非英语语言环境的机器上运行，您将不会遇到小数点/小数点逗号的问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T17:53:02.473

您想使用最后一个示例，因为这是唯一真正参数化的示例。`Type`除了安全问题（这比您想象的要普遍得多）之外，最好让 ADO.NET 处理参数化，因为如果不检查每个参数的值，您就无法确定传入的值是否需要单引号.

[编辑] 这是一个例子：

```
SqlCommand command = new SqlCommand(
    "select foo from bar where baz = @baz",
    yourSqlConnection
);

SqlParameter parameter = new SqlParameter();
parameter.ParameterName = "@baz";
parameter.Value = "xyz";

command.Parameters.Add(parameter); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T17:57:01.947

大多数人会通过服务器端编程语言库来做到这一点，例如 PHP 的 PDO 或 Perl DBI。

例如，在 PDO 中：

```
$dbh=pdo_connect(); //you need a connection function, returns a pdo db connection

$sql='insert into squip values(null,?,?)';

$statement=$dbh->prepare($sql);

$data=array('my user supplied data','more stuff');

$statement->execute($data);

if($statement->rowCount()==1){/*it worked*/} 
```

这负责转义您的数据以进行数据库插入。

一个优点是您可以使用一个准备好的语句多次重复插入，从而获得速度优势。

例如，在上面的查询中，我可以准备一次语句，然后循环从一堆数据创建数据数组，并根据需要重复 ->execute 多次。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T17:56:05.803

您的命令文本需要如下所示：

```
cmdText = "SELECT foo FROM bar WHERE baz = ?"

cmdText = "EXEC foo_from_baz ?" 
```

然后添加参数值。这种方式可确保 con 值最终仅用作值，而如果变量 fuz 设置为，则使用另一种方法

```
"x'; delete from foo where 'a' = 'a" 
```

你能看到会发生什么吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-27T03:28:57.967

这是一个从 SQL 开始的简短类，您可以从那里构建并添加到类中。

MySQL

```
Public Class mysql

    'Connection string for mysql
    Public SQLSource As String = "Server=123.456.789.123;userid=someuser;password=somesecurepassword;database=somedefaultdatabase;"

    'database connection classes

    Private DBcon As New MySqlConnection
    Private SQLcmd As MySqlCommand
    Public DBDA As New MySqlDataAdapter
    Public DBDT As New DataTable
    Public BindSource As New BindingSource
    ' parameters
    Public Params As New List(Of MySqlParameter)

    ' some stats
    Public RecordCount As Integer
    Public Exception As String

    Function ExecScalar(SQLQuery As String) As Long
        Dim theID As Long
        DBcon.ConnectionString = SQLSource
        Try
            DBcon.Open()
            SQLcmd = New MySqlCommand(SQLQuery, DBcon)
            'loads params into the query
            Params.ForEach(Sub(p) SQLcmd.Parameters.AddWithValue(p.ParameterName, p.Value))

            'or like this is also good
            'For Each p As MySqlParameter In Params
            ' SQLcmd.Parameters.AddWithValue(p.ParameterName, p.Value)
            ' Next
            ' clears params
            Params.Clear()
            'return the Id of the last insert or result of other query
            theID = Convert.ToInt32(SQLcmd.ExecuteScalar())
            DBcon.Close()

        Catch ex As MySqlException
            Exception = ex.Message
            theID = -1
        Finally
            DBcon.Dispose()
        End Try
        ExecScalar = theID
    End Function

    Sub ExecQuery(SQLQuery As String)

        DBcon.ConnectionString = SQLSource
        Try
            DBcon.Open()
            SQLcmd = New MySqlCommand(SQLQuery, DBcon)
            'loads params into the query
            Params.ForEach(Sub(p) SQLcmd.Parameters.AddWithValue(p.ParameterName, p.Value))

            'or like this is also good
            'For Each p As MySqlParameter In Params
            ' SQLcmd.Parameters.AddWithValue(p.ParameterName, p.Value)
            ' Next
            ' clears params

            Params.Clear()
            DBDA.SelectCommand = SQLcmd
            DBDA.Update(DBDT)
            DBDA.Fill(DBDT)
            BindSource.DataSource = DBDT  ' DBDT will contain your database table with your records
            DBcon.Close()
        Catch ex As MySqlException
            Exception = ex.Message
        Finally
            DBcon.Dispose()
        End Try
    End Sub
    ' add parameters to the list
    Public Sub AddParam(Name As String, Value As Object)
        Dim NewParam As New MySqlParameter(Name, Value)
        Params.Add(NewParam)
    End Sub
End Class 
```

微软 SQL/Express

```
Public Class MSSQLDB
    ' CREATE YOUR DB CONNECTION
    'Change the datasource
    Public SQLSource As String = "Data Source=someserver\sqlexpress;Integrated Security=True"
    Private DBCon As New SqlConnection(SQLSource)

    ' PREPARE DB COMMAND
    Private DBCmd As SqlCommand

    ' DB DATA
    Public DBDA As SqlDataAdapter
    Public DBDT As DataTable

    ' QUERY PARAMETERS
    Public Params As New List(Of SqlParameter)

    ' QUERY STATISTICS
    Public RecordCount As Integer
    Public Exception As String

    Public Sub ExecQuery(Query As String, Optional ByVal RunScalar As Boolean = False, Optional ByRef NewID As Long = -1)
        ' RESET QUERY STATS
        RecordCount = 0
        Exception = ""
        Dim RunScalar As Boolean = False

        Try
            ' OPEN A CONNECTION
            DBCon.Open()

            ' CREATE DB COMMAND
            DBCmd = New SqlCommand(Query, DBCon)

            ' LOAD PARAMS INTO DB COMMAND
            Params.ForEach(Sub(p) DBCmd.Parameters.Add(p))

            ' CLEAR PARAMS LIST
            Params.Clear()

            ' EXECUTE COMMAND & FILL DATATABLE
            If RunScalar = True Then
                NewID = DBCmd.ExecuteScalar()
            End If
            DBDT = New DataTable
            DBDA = New SqlDataAdapter(DBCmd)
            RecordCount = DBDA.Fill(DBDT)
        Catch ex As Exception
            Exception = ex.Message
        End Try

        ' CLOSE YOUR CONNECTION
        If DBCon.State = ConnectionState.Open Then DBCon.Close()
    End Sub

    ' INCLUDE QUERY & COMMAND PARAMETERS
    Public Sub AddParam(Name As String, Value As Object)
        Dim NewParam As New SqlParameter(Name, Value)
        Params.Add(NewParam)
    End Sub
End Class 
```

# iframe - 更改正在 iframe 中加载的页面的请求标头

> ID：542513
> 
> 赞同：2
> 
> 时间：2009-02-12T17:48:30.487
> 
> 标签：iframe, http-headers

我正在使用 Appweb 服务器（迷你 http 服务器）并在使用 https 打开网页时遇到问题。该页面被截断，当查看 HTTP 响应标头时发现 Web 服务器正在以块的形式发送响应（传输编码集），这就是根本原因。这似乎是网络服务器中的一个错误。

我再次构建了网络服务器，禁用了 Http 分块支持，发现页面加载正常。此页面正在 iframe 中加载。

我不想为所有网页禁用 Http 分块，因为它可能会降低其他页面的某些性能。因此，我想知道是否有一种方法可以为 iframe 中加载的页面设置自定义请求标头，以便我将单独发送该网页不支持的 http 分块。

谢谢，
纳加基兰

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-25T14:17:53.097

除非您分发浏览器，否则您将无法指定 IE/Firefox/Safari/etc 的时间。设置 TE 标头。您可以在处理标头之前在网络服务器的请求处理程序中注册回调，并删除 TE 标头，但是...

不幸的是，TE: 客户端标头只必须出现在也具有 Connect: 标头的请求中，这些标头通常仅位于管道的开头和结尾（请参阅[rfc2616](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.39)），这意味着如果浏览器已经在重用连接您不想分块的页面，那么您就不走运了。

一个小技巧：您可以考虑嵌入第二个禁用分块的网络服务器实例，并从那里只提供问题页面。显然，这需要在不同的虚拟主机或端口上运行服务器。

如果您的供应商可以修复错误，这是最理想的，但我知道您无法选择时间:-)

# log4net - log4net 与 MS 日志记录应用程序块

> ID：542515
> 
> 赞同：7
> 
> 时间：2009-02-12T17:48:38.973
> 
> 标签：log4net, enterprise-library, application-blocks

我正在尝试了解使用 log4netor 企业库日志记录应用程序块 (LAB) 登录应用程序的利弊。我知道一件事 LAB 使用起来有点困难，然后 log4net。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T18:22:46.333

我使用 Log4Net。它已经与我使用的各种其他库（NHibernate）集成在一起，因此很有意义。

如果您想阅读更多内容，我有 Log4Net 简介。 [http://elegantcode.com/2007/12/07/getting-started-with-log4net/](http://elegantcode.com/2007/12/07/getting-started-with-log4net/)

此外，就像 Will 关于 LAB 所说的那样，可能很难配置（通过 xml 配置文件完成），但 Log4net 非常稳定。此外，您可以将 Log4Net 配置为执行几乎任何您想做的事情（文本文件、滚动文本文件、登录到数据库、事件查看器等）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-12T18:15:58.143

我用过 Log4Net，但我不太喜欢它。它绝对有从另一种语言翻译的 API 的感觉。然而，它已经有几年了，所以从那时起它很可能已经得到了改进。

我更喜欢 LAB 的配置，但是当 LAB 不工作时，几乎不可能弄清楚为什么。最烦人的事情……它可以完美地工作，然后似乎无缘无故地突然停止。我已经放弃了它（我使用的最后一个版本是 4.1），直到他们弄清楚如何使它易于调试。

我会说如果您使用其他应用程序块，请坚持使用 LAB。但是要准备好在花了一周时间尝试调试日志失败后放弃它。如果您不使用其他块，请使用 Log4Net。

此外，如果您正在编写 Web 应用程序，请查看[ELMAH](http://code.google.com/p/elmah/)。它更像是一个错误报告模块，但您可以通过手动引发事件将其用于基本日志记录。

# c# - 动态 WinForm 又名问卷

> ID：542516
> 
> 赞同：1
> 
> 时间：2009-02-12T17:48:41.327
> 
> 标签：c#, winforms, layout, controls, user-interface

我正在将*ASP.Net Web App*转换为*C# WinForm App*。我正在努力转换特定页面。这个页面是一个问卷，每个答案（通常是 rdo）决定下一个问题是什么。

我原本以为只显示所有问题并相应地设置**只读属性**。不幸的是，要解决这个问题还有很多问题，因为我绝对希望避免让最终用户不得不滚动。

然后我想我可以将不断变化的问题分组到面板上并适当地设置**可见标志**。这是有效的，但它很快成为*“下一个人”的噩梦。*

接下来，我想我可以创建所有问题控件的*集合*，并在它们动态回答时构建表单。

*   这是一个好主意吗？

*   我该怎么做呢？

*   收藏？

*   或者，我是否过度思考这个（一个常见问题）并且有一个更简单的解决方案？

*   您需要先了解更多细节吗？

* * *

谢谢你，祝你有美好的一天！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T17:52:28.433

如何创建一个“问题模板”作为带有标签、单选按钮等的用户控件，并为其赋予问题文本和可选答案列表等属性？当您添加每个问题时，这将简化动态构建表单的工作。这不是一个完整的答案，我理解，但这可能是一个起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T17:59:01.850

我会以某种格式（例如 XML）来描述这个状态机（就是这样），然后从中自动生成 WinForms 代码。至于实际的 UI 方法，一种方法是使用选项卡控件 - 制作几个选项卡页面（当然没有标题），并用与您的问题相关的内容填充每个页面。然后，只需添加连接到您的状态机的导航逻辑。就是这样！

# java - 移动端视频流服务器

> ID：542517
> 
> 赞同：1
> 
> 时间：2009-02-12T17:48:57.583
> 
> 标签：java, mobile, symbian, s60, rtsp

我看过视频流到手机。我想知道我们是否有可以安装在手机上的流媒体服务器，并将视频从手机上的摄像头流式传输到另一台设备。我想在我的诺基亚 N70 手机上使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T18:54:22.013

[QIK](http://qik.com/)就是这样做的。他们支持很多诺基亚手机，但不幸的是，N70 似乎不在其中。如果您正在寻找构建自己的应用程序，可能没有用，但至少它表明它可以完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T18:36:23.477

可以，但是由于处理器限制（通常是 200-600MHz 32 位 ARM 或类似设备），手机无法实时压缩高分辨率视频。此外，即使使用高速 3G 连接，带宽也非常低。

这两个限制意味着您可能会找到 CIF 分辨率，并且偶尔会发现帧速率较慢的 VGA 分辨率流，但获得比这更好的东西并非易事。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T07:00:00.117

设备到设备会很困难——但是，如果你使用中介，你可能会有更好的运气。像 Qik 这样的东西从设备广播到您的网站，然后让第二个设备连接到该流 - 类似于 Quicktime Broadcaster（与移动设备无关）如何将其单个流发送到流服务器，然后处理分发。

就像亚当上面提到的那样，我不期望高质量。即使超过 3g、10fps+ 和 QCIF+ 视频也可能相当不可靠。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T07:09:55.723

见过[大佬](http://bambuser.com/node/70403)吗？一种可以从手机和网络摄像头实时流式传输的视频流服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T05:00:47.397

有不少服务

1.  [奇克](http://qik.com)
2.  [凯特电视](http://kyte.tv)
3.  优流

# c# - TransactionScope 与 LINQ to SQL 中的事务

> ID：542525
> 
> 赞同：77
> 
> 时间：2009-02-12T17:50:23.820
> 
> 标签：c#, linq, linq-to-sql, transactions

LINQ to SQL 中的经典事务模式有什么区别，例如：

```
using(var context = Domain.Instance.GetContext())
{
    try
    {
        context.Connection.Open();
        context.Transaction = context.Connection.BeginTransaction();
        /*code*/
        context.Transaction.Commit();
    }
    catch
    {
        context.Transaction.Rollback();
    }         
} 
```

与 TransactionScope 对象

```
using (var context = Domain.Instance.GetContext())
using (var scope = new TransactionScope())
{
    try
    {
        /*code*/
        scope.Complete();
    }
    catch
    {
    }
} 
```

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-02-12T18:41:06.193

应该注意的是，使用时[`TransactionScope`](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.aspx)不需要`try/catch`您拥有的构造。您只需调用[`Complete`](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.complete.aspx)范围即可在退出范围时提交事务。

话虽如此，`TransactionScope`通常是更好的选择，因为它允许您嵌套调用可能需要事务的其他方法，而无需传递事务状态。

调用对象时，如果您想在同一事务中执行其他操作，但使用不同的方法，则必须传递该事务对象[`BeginTransaction`](http://msdn.microsoft.com/en-us/library/xfh66ye8.aspx)。[`DbConnection`](http://msdn.microsoft.com/en-us/library/system.data.common.dbconnection.aspx)

使用`TransactionScope`，只要范围存在，它将处理[`Transaction`](http://msdn.microsoft.com/en-us/library/system.transactions.transaction.aspx)在线程上注册到当前的所有内容，从而使您的代码更清晰，更易于维护。

最重要的是，您还可以使用其他可以参与事务的资源，而不仅仅是与数据库的连接。

应该注意的是，在您需要充分利用连接和数据库操作的情况下，您可能不想使用`TransactionScope`; 即使针对单个数据库，您也有可能使用分布式事务协调器并将事务转换为分布式事务（即使对于单个数据库连接）。

在这些情况下，在混淆设计的同时，您可能需要考虑传递特定于连接的事务。

*或者*，如果您知道您将始终如一地使用一个资源（并且在同一个线程上），您可能希望创建一个对您的连接/事务进行引用计数的类。

您将创建一个在构造时创建资源/增加计数的类。它还将实现[`IDisposable`](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)（当计数为零时，您将递减/释放/提交/中止），并将计数存储在已[`ThreadStaticAttribute`](http://msdn.microsoft.com/en-us/library/system.threadstaticattribute.aspx)应用于它的变量中。

这允许您将事务管理与逻辑代码分开，并且仍然相当有效地保持单一资源（而不是升级到分布式事务）。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-02-12T18:36:15.393

Linq2SQL 将使用隐式事务。如果您的所有更新都在一次提交中完成，您可能不需要自己处理事务。

从文档（强调我的）：

> 当您调用 SubmitChanges 时，LINQ to SQL 会检查调用是否在事务范围内，或者事务属性 (IDbTransaction) 是否设置为用户启动的本地事务。**如果未找到任何事务，LINQ to SQL 将启动一个本地事务 (IDbTransaction) 并使用它来执行生成的 SQL 命令。**成功完成所有 SQL 命令后，LINQ to SQL 提交本地事务并返回。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2011-10-04T22:52:42.110

一个很大的不同（从惨痛的教训中吸取了教训）——TransactionScope 使用 MS DTC 进行事务管理。

如果您的应用程序只需要管理数据库事务，并且不涉及服务或远程调用，则可以通过使用数据库原生事务 (DbTransactions) 来跳过与 MS DTC 相关的潜在问题。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-05-18T13:39:19.030

TransactionScope 为所有资源管理器（SQL 服务器、活动目录、文件系统……）提供统一管理。此外，可以编写自己的资源管理器：检测事务范围的代码，加入它并像 SQL 服务器一样工作：像事务的其他参与者一样提交或恢复更改。我认为 TransactionScope 是主流，忘记了 MS SQL 原生事务，直到陷入巨大的陷阱： **Windows Server 2008 WEB 版带有受限的分布式事务协调器服务和事务范围仅适用于单台计算机。** 如果 IIS 和 SQL 服务器安装在不同的计算机上，您的 ASP.NET 应用程序将在此系统上失败。考虑到大多数公共域提供商提供的 Windows Server WEB 版本和 SQL Server 位于不同的服务器上。这意味着，您必须使用显式事务管理来处理本机事务……</p>

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-12T18:16:37.797

我相信它们与 TransactionScope 类将与 ADO.NET 底层连接接口以创建和提交或回滚事务基本相同。刚刚创建 TransactionScope 类是为了使使用 ADO.NET 持久性更清晰。

**编辑：**澄清我关于[casperOne 添加的](https://stackoverflow.com/questions/542525/transactionscope-vs-transaction-in-linq-to-sql/542704#542704)声明，它将创建事务的 TransactionScope，然后连接将看到由 TransactionScope 创建的事务并使用它，因为它可用。

# ruby - Ruby 远程 HTTP 发布

> ID：542551
> 
> 赞同：2
> 
> 时间：2009-02-12T17:57:02.790
> 
> 标签：ruby

你如何在 ruby​​ 中进行远程 HTTP 发布（请求）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T18:47:42.170

使用 Net::HTTP。正确但无效的示例（因为 Google 仅支持 GET - 抱歉，我想不出任何打开的 POST 表单）：

```
require 'net/http'
require 'uri'

result = Net::HTTP.post_form(URI.parse("http://google.com/search"), {"q" => "Rick Astley"}) 
```

[文档](http://www.ruby-doc.org/stdlib/libdoc/net/http/rdoc/classes/Net/HTTP.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T13:03:39.837

如果服务器符合 REST，您应该查看[rest-client](http://github.com/adamwiggins/rest-client/tree/master)或[ActiveResource](http://github.com/rails/rails/tree/master/activeresource)。

# asp.net - SOAP/asmx/WebMethods 的自定义（IDictionary）XML 序列化？

> ID：542556
> 
> 赞同：1
> 
> 时间：2009-02-12T17:58:01.447
> 
> 标签：asp.net, web-services, xml-serialization

使用 ASP.NET WebServices，默认情况下您不能传递任何 IDictionary 对象，因为不支持 IDictionaries 的 xml 序列化。我找到了各种序列化字典的[方法](http://blogs.msdn.com/psheill/archive/2005/04/09/406823.aspx)（[http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx，http://blogs.msdn.com/psheill/archive/2005/04](http://weblogs.asp.net/pwelter34/archive/2006/05/03/444961.aspx) [/09/406823.aspx](http://blogs.msdn.com/psheill/archive/2005/04/09/406823.aspx) , [http://www.mattberther.com/2004/06/14/serializing-an-idictionary-object/](http://www.mattberther.com/2004/06/14/serializing-an-idictionary-object/)）但是，我找不到任何方法可以将它连接到 Asp.NET 网络中方法。

有没有办法将它连接起来，以便我可以将 IDictionaries 与 WebMethods 一起使用？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T18:23:22.260

取决于您如何调用这些方法，我们将 .net 2.0 方法与“Web 引用”一起使用，您会注意到 WSDL 生成的类是部分的，我们创建了一个（Web 引用名称）.cs 文件并具有以下内容：

```
 public partial class WebReferenceName : System.Web.Services.Protocols.SoapHttpClientProtocol 
{
    // Overload the WSDL generated method that only takes a simple array
    public ReturnType MethodName(List  collection)
    {
        // redirect the call to the wsdl generated method with the appropriate parameters
        return this.MethodName(collection.ToArray());
    }
} 
```

重载将允许您使用任一类型的集合调用方法名称

在 Web 服务端，您可以从简单的集合转换回更强大的集合，很可能使用更强大的集合 ctor。其中一个 ctor 可能会使用一个简单的集合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T18:54:20.263

问题是 - 你想在哪里传递字典？如果您只是想教您的服务如何序列化字典，那么在您的字典类上实现 IXmlSerializable 接口，并按照您的喜好对其进行序列化。

问题将出在客户端上。Java 客户端应该如何反序列化您发送的内容？就此而言，.NET 客户端如何知道如何做到这一点？当使用旧的 ASMX Web 服务让客户端做一些特别的事情时，没有好的方法。这是发明 WCF 的众多原因之一。

> ID：542564
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# crystal-reports - Crystal Reports 2008 中的静态参数列表

> ID：542568
> 
> 赞同：2
> 
> 时间：2009-02-12T18:02:38.550
> 
> 标签：crystal-reports

我有一个静态用户名列表作为 CR2008 中的参数。我希望能够使用 CR 语法将数据库值添加到选定的用户并使用它进行查询。

例如，如果报表运行者从我的参数列表中选择 Doe, John，我需要使用类似的方式查询数据库

```
If {?prmUsers} = "Doe, John" then variableA = "doejoh" And variableB = "john.doe@gmail.com" 
```

选择将类似于：

```
Declare @BeginDate SmallDateTime
Declare @EndDate SmallDateTime
Set @BeginDate = '2009-01-19'
Set @EndDate = '2009-01-23'

SELECT DISTINCT
    DateTime,
    [Recipient-Address],
    [Message-Subject],
    [Sender-Address]
FROM
    dbo.Logs
WHERE
    LEFT([Recipient-Address], 6) IN ( 'doejoh' ) OR
    LEFT([Recipient-Address], 10) IN ( 'john.doe@g' )
    AND DateTime BETWEEN @BeginDate + ' 00:00:00' And @EndDate + ' 23:59:59' 
```

当然，报表运行器可以选择多个名称。 **有什么想法**吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-01-12T00:18:51.340

这在“罐装”Crystal Reports 中是不可能的。您的解决方法是创建一个运行您的报告的应用程序。然后，您可以设计提示以按照上述方式工作，并将“最终”参数值应用于报告。

# css - 在运行时禁用 CTRL/Wheel 缩放效果

> ID：542576
> 
> 赞同：9
> 
> 时间：2009-02-12T18:04:36.237
> 
> 标签：css, effects, zooming, mousewheel

如何在某些元素上使用 css 或 javascript 禁用 ctrl/wheel 缩放效果。我创建了一个在应用缩放效果时会失真的菜单栏。我想仅对某些元素禁用它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T18:10:00.293

更好的主意：设计您的布局，使其足够强大以处理此类更改。即使您修复了字体大小（一开始不应该这样做），您也无法禁用它们，因此您不妨优雅地响应缩放。

事实是，如果浏览器对所有元素进行同等缩放，那么您的页面应该看起来和工作方式与以前完全相同（除了，你知道，更大），除非您在设计中的某个地方采取了一些懒惰的快捷方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-15T08:33:38.740

IE 和 Firefox 的解决方案：

```
var obj=document.body;  // obj=element for example body
// bind mousewheel event on the mouseWheel function
if(obj.addEventListener)
{
    obj.addEventListener('DOMMouseScroll',mouseWheel,false);
    obj.addEventListener("mousewheel",mouseWheel,false);
}
else obj.onmousewheel=mouseWheel;

function mouseWheel(e)
{
    // disabling
    e=e?e:window.event;
    if(e.ctrlKey)
    {
        if(e.preventDefault) e.preventDefault();
        else e.returnValue=false;
        return false;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T18:07:00.597

你不能；这是浏览器功能，而不是文档功能。

话虽如此，如果你使用 CSS 的 style="font-size: 9px;"，你可以覆盖文本大小。浏览器缩放仍然有效，并且浏览器字体大小的更改将产生一些重新格式化的效果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-30T04:27:55.127

这是我的问题：我一直使用 em 进行设计，它们的工作原理很神奇。但是通过整页缩放，我的背景也被放大了。如果我有一个重复的图案作为主要背景，我不希望它变得像素化。它们确实帮助我们避免了一些工作，比如实现 Doug Bowman 的 CSS 滑动门，但现在我不得不忍受模糊的标签。

我还有另一个全页缩放问题，至少在今天的浏览器中实现了：我是那些将我的浏览器设置为 12pt 字体而不是 16pt 的“那些”人之一。每隔一段时间，我就会遇到一个（当然是固定宽度的）网站，它将文本调整为很小的大小（我猜他们在尝试制作时使用 0.9em 或其他东西，而不是 14px更小）。我通常只会放大一两个档次，一切都会好起来的。但是，使用整页缩放时，图像的缩放比例很差，而且我有一个水平滚动条。

第一个问题的解决方案是允许背景图像标签中的某种处理指令禁止对该元素进行整页缩放。或者可能是文档头部的某些内容。如果浏览器真的想要公平，他们也可以给用户一个他们可以设置的选项来覆盖 no-zoom 指令，所以如果他们愿意，他们可以无论如何都可以缩放。第二个问题的解决方案是全页缩放首先以 16px/em 的速率将所有 px 转换为 em，*然后*缩小到您的文本大小，而不是使用您的文本大小将 px 转换为 em根据。然后向上滚动到 16 像素将使图像按预期大小完美。

# java - 如何重置或终止 JVM 上下文？

> ID：542580
> 
> 赞同：0
> 
> 时间：2009-02-12T18:06:28.087
> 
> 标签：java, jvm

我正在通过`java <class file>`命令运行一个简单的 java 客户端。java 命令实际上是由系统进程调用的。这是在 Unix 上。

我们遇到了 X11 Display 的问题。所以我们`export DISPLAY=:0.0`在启动文件中添加了显示问题就解决了。现在，当`export DISPLAY=:0.0`从启动文件中删除该行并再次运行 java 客户端时，我们无法恢复到旧状态，即，我们不再收到 X11 显示错误。所以有一些东西在系统上持续存在。有什么方法可以确保在运行客户端之前杀死 JVM 上下文？

我们已经杀死了触发 java 客户端的进程，然后重新启动该进程以再次运行 java 客户端。但没有成功回到旧状态。

[编辑] 我忘了提到我已经在停止文件中尝试过“取消设置显示”。启动文件在环境启动时运行，而停止文件在环境关闭时运行。我也尝试过无头模式，但这对我们的程序不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T18:30:07.017

如果您之前在当前 shell 中执行过 export 命令（甚至从启动文件中），那么该值就在您的环境中。取消设置（或获得具有干净环境的新外壳）是摆脱环境设置的唯一方法。

我建议在您的启动脚本中添加一行来回显 $DISPLAY，以便在您解决问题时可以清楚地看到当前设置的内容。

如果您的进程实际上不需要 xwindows 显示，您应该以无头模式启动 JVM。详情在[这里](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/headless/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T18:12:00.023

您可能在 shell 中设置了 DISPLAY 环境。尝试输入“export DISPLAY=”或“unset DISPLAY”。

# perl - 如何使用 LWP::Simple 处理代理服务器？

> ID：542588
> 
> 赞同：4
> 
> 时间：2009-02-12T18:08:32.653
> 
> 标签：perl, proxy, lwp

如何向此脚本添加代理支持？

```
use LWP::Simple;

$url = "http://stackoverflow.com";
$word = "how to ask";
$content = get $url;
if($content =~ m/$word/)
{
print "Found $word";
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-12T18:17:11.447

访问底层 LWP::UserAgent 对象并设置代理。LWP::Simple 导出`$ua`变量，因此您可以这样做：

```
使用 LWP::Simple qw( $ua get );
$ua->proxy('http', 'http://myproxy.example.com');
我的 $content = get('http://www.example.com/');

```

# delphi - 我应该在哪里设置像 {$STRINGCHECKS OFF} 这样的编译器选项？

> ID：542590
> 
> 赞同：0
> 
> 时间：2009-02-12T18:09:20.403
> 
> 标签：delphi

如果我将它放在 .dpr 或任何其他单位中，它会被全局考虑吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:16:25.067

我不这么认为。IIRC 的规则是 dpr 或单元中的任何内容都是该文件的本地文件。如果您将其放入项目选项中（在条件下），那么它是全局的。许多作者将这些内容放入文本文件中，然后在每个单元的顶部执行 {$I MyConditionals.txt}。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T22:30:06.643

项目 -> 选项 -> Delphi 编译器 -> 代码生成，将“字符串格式检查”设置为 OFF。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T18:29:28.250

一些编译器指令的范围与其他指令不同。有些影响整个应用程序，有些只影响它们所在的单元，有些只影响它们所在的代码。例如，

```
{$WARNINGS OFF}  // Turn off warning messages from compiler
procedure SomeProcedureThatHasAnAsmBlock;
begin
  asm
    // Some assembler code that generates warnings, but
    // that you know is actually right. These warnings
    // are usually like "expression always evaluates to false"
    // or something like that.
  end;
end;
{$WARNINGS ON}   // Turn warnings back on for other code 
```

由于 {$STRINGCHECKS} 没有记录（至少在我拥有的 D2009 帮助文件的版本中），因此很难知道它的范围是什么。CodeGear 的 Barry Kelly 有时会在这里，他负责编译器本身。也许他会徘徊并能够提供帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T18:48:49.123

IIRC，您可以在“项目选项”窗口中全局关闭它。

# python - 我应该使用 Django 的 contrib 应用程序还是自己构建？

> ID：542594
> 
> 赞同：3
> 
> 时间：2009-02-12T18:10:45.910
> 
> 标签：python, django, django-contrib

Django 应用程序具有自己的功能和设计。如果您的要求与 contib 应用程序的功能没有 100% 匹配，您最终会自定义和调整应用程序。我觉得这比仅仅构建自己的应用程序来满足您的要求需要更多的努力。

你怎么看？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T18:34:34.137

这一切都取决于。我们需要与 contrib.flatpages 98% 相似的东西。我们本可以对其进行猴子补丁，但我们认为代码非常简单，我们只需复制和分叉即可。结果很好。

另一方面，使用 contrib.auth 执行此操作可能是一个糟糕的举动，因为它与 contrib.admin 和 contrib.session 交互。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-14T12:10:03.747

在构建自己的应用程序之前，我还会检查第三方可重复使用的应用程序。许多列在[Django Plug(g)ables](http://djangoplugables.com/)上，大多数托管在[Google Code](http://code.google.com/search/?q=django#q=django)、[GitHub](http://github.com/search?type=Repositories&language=python&q=django&repo=&langOverride=&x=15&y=15&start_value=1)或[BitBucket](http://bitbucket.org/repo/all/?name=django)上。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T21:22:15.213

django.contrib 中的大多数应用程序都编写得非常好并且具有高度的可扩展性。

不太喜欢评论的工作方式？对其中的模型和表单进行子类化，添加您自己的功能，并且您有一个适合您的站点架构的工作评论系统，并且不费吹灰之力。

我认为当你扩展 contrib 应用程序时最好的部分是你并没有真正做任何 hacky，你只是在编写（大部分）常规 Python 代码来添加功能。

# asp.net - 实体框架：Singletonish ObjectContext - 好、坏还是想太多？

> ID：542595
> 
> 赞同：9
> 
> 时间：2009-02-12T18:10:46.720
> 
> 标签：asp.net, entity-framework

这个想法是创建一个公开上下文但在 Web 应用程序中处理它的存储的类。

目前这就是我所拥有的：

```
public class EntityContext
{

    private static String MAIN_CONTEXT_KEY = "MainContext";
    private static TISQLEntities _context;

    public static void RemoveContext()
    {
        if (
            HttpContext.Current != null 
            && 
            HttpContext.Current.Items[MAIN_CONTEXT_KEY] != null
           )
        {
            ((TISQLEntities)HttpContext.Current.Items[MAIN_CONTEXT_KEY]).Dispose();
            HttpContext.Current.Items[MAIN_CONTEXT_KEY] = null;
        }

        if (_context != null)
        {
            _context.Dispose();
            _context = null;
        }
    }

    public static TISQLEntities Context
    {
        get
        {
            if (HttpContext.Current == null)
            {
                if (_context == null)
                {
                    _context = new TISQLEntities();
                }

                return _context;
            }

            if (HttpContext.Current.Items[MAIN_CONTEXT_KEY] == null)
            {
                HttpContext.Current.Items[MAIN_CONTEXT_KEY] = new TISQLEntities();
            }

            return (TISQLEntities)HttpContext.Current.Items[MAIN_CONTEXT_KEY];
        }
    }
} 
```

然后在 Global.asax 文件中：

```
protected void Application_EndRequest(object sender, EventArgs e)
{
    EntityContext.RemoveContext();
} 
```

这个想法是，如果这是与 Web 应用程序一起运行的，则在第一次需要时创建上下文（并保存到当前的 HttpContext），并在请求结束时删除。

如果这是 UnitTest 情况，则反对在第一次需要时创建并在 TestCleanup 中删除（在这篇文章中不那么重要，只是想澄清 _context 对象）。

现在这背后的想法是至少不必这样做：

```
using(TISQLEntities context = new TISQLEntities())
{
  ....
} 
```

每次想查询。我意识到这可能是我懒惰，但我只是认为它更容易和更清洁：

```
EntityContext.Context.User.Select(...) 
```

并避免在大多数情况下我尽量避免的“使用”。最重要的是，我不会为每个回发创建 9001 个上下文。

现在我很好奇的是我是不是在想这个？我应该继续为每个需要的方法创建一个上下文吗？在回帖中说我必须：

*   从 ID 获取用户
*   从 id 获取站点
*   将站点添加到用户（user.Site = foundSite）
*   保存用户

这可能需要至少 3 个上下文。实体框架是否足够聪明，可以随时继续创建上下文？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T18:54:53.727

您正在实现相当于 NHibernate 的每个请求会话模式，这是 NHibernate 中的一个很好的构造。虽然我不能说 100% 肯定它适用于 EF，但它很可能是适用的。对其他会话管理模式的进一步扩展是每个业务会话的会话，它允许 NHibernate 通过断开和重新连接会话而不是销毁和创建会话来在 HttpSession 的持续时间内延长保持会话的时间。如果 EF 允许类似的功能而不是保持静态开放连接，您可以通过我的个人资料在我的博客上查看我是如何使用 AOP 实现该模式的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-26T11:35:02.440

查看[此博客条目](http://cgeers.wordpress.com/2009/02/21/entity-framework-objectcontext/)，其中提供了有关为实体框架上下文创建单例的更多详细信息，以及为什么这在 ASP.NET 中不起作用，并提出了一个与您建议的类似的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T17:20:46.940

如果你想用它的 Session 来实现 NHibernate 那样的东西，我认为拥有这种模式是个好主意。我确信在 LinqToSql 中，上下文对象的实现更像是一个入口点类，它充当一个门面。我想认为 LinqToEntities 是相似的。您可以有一个工厂实现来为您的模型获取数据上下文，您可以在其中回收数据上下文。如果您采用单例方式，请考虑单例对象的瓶颈、可用性和责任。

# python - os.path.splitext 相对于常规 .split 的好处？

> ID：542596
> 
> 赞同：42
> 
> 时间：2009-02-12T18:10:51.370
> 
> 标签：python

在[另一个问题](https://stackoverflow.com/questions/541390/extracting-extension-from-filename-in-python)中，投票清楚地表明该`os.path.splitext`函数优于简单的`.split('.')[-1]`字符串操作。有没有人有时间来解释为什么会这样？它更快，或更准确，还是什么？我愿意接受它有更好的地方，但我不能立即看到它可能是什么。至少在简单的情况下，导入整个模块来做到这一点可能会有点过分吗？

编辑：操作系统的特殊性是一个巨大的胜利，并不是很明显；但即使我也应该看到“如果没有点怎么办”的情况！感谢大家对图书馆使用的一般评论。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-12T18:17:46.767

好吧，不同的操作系统有不同的实现。这意味着如果在 Mac 上提取文件扩展名的逻辑与在 Linux 上的不同，这种区别将由这些东西处理。我不知道有任何这样的区别，所以可能没有。

* * *

**编辑**：[@Brian](https://stackoverflow.com/users/9493/brian)评论说，像这样的示例`/directory.ext/file`当然不适用于简单的`.split('.')`调用，并且您必须知道目录可以使用扩展名，以及在某些操作系统上，正斜杠是有效的目录分隔符这一事实.

这只是强调*使用库例程，除非您有充分的理由不*参与我的回答。

谢谢[@Brian](https://stackoverflow.com/users/9493/brian)。

* * *

此外，如果文件没有扩展名，则必须构建逻辑来处理这种情况。如果您尝试拆分的内容是以反斜杠结尾的目录名称怎么办？没有文件名也没有扩展名。

规则应该是，除非您有特定理由不使用执行您想要的功能的库函数，否则请使用它。这将避免您必须维护和修复其他人拥有完美解决方案的代码。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-12T18:16:40.870

os.path.splitext 将正确处理文件没有扩展名并返回空字符串的情况。.split 将返回文件的名称。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-12T18:18:16.327

`splitext()`反向搜索'.' 并在找到扩展部分后立即返回。`split('.')`将对所有“。”进行前向搜索。字符，因此几乎总是较慢。换句话说`splitext()`，它是专门为返回扩展名而编写的，不像`split()`.

（如果您想检查实现，请参阅 Python 源代码中的 posixpath.py）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-12T18:16:57.860

存在不使用“。”的操作系统。作为扩展分隔符。

（值得注意的是，RISC OS 按照惯例使用“/”，因为“.”在那里用作路径分隔符。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T18:16:00.590

获得文件扩展名的明确定义和记录的方法总是比随意拆分字符串更可取，因为该方法由于各种原因会更加脆弱。

编辑：这不是特定于语言的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T18:17:08.030

1.  适合工作的正确工具
2.  已经作为 Python 标准库的一部分进行了彻底的调试和测试 - 没有因您的手动版本中的错误而引入的错误（例如，如果没有扩展名，或者文件是 UNIX 上的隐藏文件，如“.bashrc”，或者是多个扩展名吗？）
3.  为此目的，该函数对传递的文件名具有有用的返回值（basename，ext），这在某些情况下可能比必须手动拆分路径更有用（同样，边缘情况在确定基本名称 - 分机）

担心导入模块的唯一原因是担心开销——在绝大多数情况下，这不太可能是一个问题，如果它那么紧，那么在此之前，Python 中的其他开销可能会是一个更大的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T18:16:55.550

第一个也是最明显的区别是，当没有扩展时，split 调用没有默认逻辑。

这也可以通过正则表达式来完成，以使其在没有额外包含的情况下表现为 1 衬里，但如果扩展不存在，则仍返回空字符串。

此外，路径库可以处理具有不同文件夹分隔符的路径的不同上下文。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T18:15:59.313

在对提供此解决方案的答案的评论中：

> “如果文件没有扩展名，这将错误地返回文件名而不是空字符串。”

并非每个文件都有扩展名。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T18:23:06.317

除了是标准的并因此保证可用之外，`os.path.splitext`：

**处理边缘情况**- 就像缺少扩展名一样。
**提供保证**- 除了正确返回扩展名（如果存在）之外，它还保证`root`+`ext`将始终返回完整路径。
**是跨平台**的 - 在 Python 源代码中实际上有三个不同版本的 os.path，它们是根据 Python 认为你在哪个操作系统上调用的。
**更具可读性**- 考虑您的版本要求用户知道数组可以用负数索引。

顺便说一句，它不应该更快。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T09:44:25.913

1) 简单的 split('.')[-1] 对于 C:\foo.bar\Makefile 这样的路径将无法正常工作，因此您需要先使用 os.path.basename() 提取 basename，甚至在此情况下它将无法正确拆分没有扩展名的文件。os.path.splitext 在后台执行此操作。

2）尽管 os.path.splitext 是跨平台解决方案，但它并不理想。让我们看一下带有前导点的特殊文件，例如.cvsignore、.bzrignore、.hgignore（它们在一些VCS 中作为特殊文件非常流行）。os.path.splitext 将返回整个文件名作为扩展名，尽管它似乎不适合我。因为在这种情况下，没有扩展名的名称是空字符串。虽然这是 Python 标准库的预期行为，但它可能不是用户实际想要的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-10-08T06:21:59.313

我不确定 Python 是否已移植到 VMS 平台上，但假设它已移植 (*)：

*   文件名通常采用以下格式：$device-dir-subdir$filename.$type;$version (**)

我希望您意识到使用仅受*您*所接触的系统影响的窄范围方法对于长期代码可维护性并不是最佳的，并且这种做法特别不利于在大型软件中混合和匹配不同的软件组件项目。

本质上，在后一种情况下，成功概率（可靠性）类似于

> R(t)=1-(1-Ri)^n

现在您可以看到糟糕/不完整的软件实现如何导致错误的程序。更广泛地说，正是由于这些错误，移植软件很困难。

(*) 嗯，谷歌搜索很快发现：[https](https://www.vmspython.org)
://www.vmspython.org (**) 在这里查看正则表达式大战！[https://stackoverflow.com/a/4465456/1574494](https://stackoverflow.com/a/4465456/1574494)

# tsql - 查询优化 TSQL 和其他

> ID：542603
> 
> 赞同：0
> 
> 时间：2009-02-12T18:12:45.763
> 
> 标签：tsql, query-optimization

假设我有一个类似下面的 sql 语句，变量 @FOO 在代码的前面某处设置：

```
SELECT FIELDLIST 
FROM TABLE 
WHERE 
(FIELD = @FOO OR @FOO IS NULL) 
```

查询优化器是否足够聪明，可以先执行 OR 的第二面（@FOO IS NULL），因为（另一个假设）执行空值检查比执行字段比较更快？

我做了一些非正式的基准测试，不仅没有看到差异，而且我的尝试得到了不同的结果时间，这使我无法进行适当的比较。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T23:54:50.340

简短的回答...

**是**的，优化器足够聪明。

更长的答案...

SQL 是声明性的而不是命令性的：您的查询是对结果必须满足的条件的描述，而*不是*关于如何生成这些结果的分步说明。

优化器以最有效的顺序执行查询。它不能保证以任何特定的顺序评估您的条款，甚至根本评估它们 - 如果它可以在不评估特定条款的情况下获得正确的结果，那么它为什么要打扰呢？

任何特定查询的实际评估顺序是一个实现细节，并且可以随时间变化（例如，随着表的统计信息的变化）。

在实践中，优化器偶尔会出错，但在这种特殊情况下 - 将变量与 NULL 与从表或索引中读取进行比较 - 我认为它不太可能搞砸，尽管您可能想[考虑使用`OPTION(RECOMPILE)`或`OPTION(OPTIMIZE FOR ...)`](http://technet.microsoft.com/en-us/library/ms181714.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T18:15:57.987

尝试使用相反顺序的子句对其进行测试：

```
SELECT FIELDLIST 
FROM TABLE 
WHERE 
(@FOO IS NULL OR FIELD = @FOO) 
```

您可能会发现第一个测试会使第二个测试短路，但反之亦然。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T10:23:51.857

根据我的经验，有时使用两个查询和一个“UNION”而不是“OR”子句会更快。

```
SELECT FIELDLIST 
FROM TABLE 
WHERE 
(FIELD = @FOO)

UNION

SELECT FIELDLIST 
FROM TABLE 
WHERE 
(@FOO IS NULL) 
```

这种方法有重复 SELECT 语句的缺点，但是 1500% 的性能提升证明了它的合理性。当然，这取决于数据库结构（在我的情况下它非常糟糕，我无法更改它）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T18:14:51.763

首先应用更快的条件是足够聪明的，假设它可以判断在一般情况下哪个比较会更快。在这种情况下，NULL 检查几乎总是更快，因为它必须从表达式的每一侧最多比较一个字节，并且可以将其分解。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T18:29:07.067

如果此查询位于存储过程中，则此处可能起作用的一个因素是“参数嗅探”。这可能导致不一致的查询响应时间。要解决此问题，请在 sproc 中声明一个内部变量并将此变量分配给参数值，然后在 where 子句中使用内部变量或在 sproc 中使用[RECOMPILE](http://www.sqlmag.com/Article/ArticleID/94369/sql_server_94369.html)子句。关于这个主题有很多链接。

# asp.net - 如何阻止（或取消阻止）ASP.NET 错误记录器 Elmah？

> ID：542604
> 
> 赞同：0
> 
> 时间：2009-02-12T18:14:32.763
> 
> 标签：asp.net, elmah, ashx, axd

有人以有意或无意阻止 ELMAH 的方式配置了我的服务器。我希望我知道那是什么。我当前的服务器管理员也无法弄清楚是什么阻止了它。

线索至今

*   错误消息是**“不提供这种类型的页面......它已被明确禁止”**

*   普通的 .ashx 处理程序工作得很好。（HelloWorld.ashx 有效）

*   我在完全信任中运行。

*   我在 Win 2000，IIS 5

*   机器配置没有对 ELMAH 的任何引用（我的 web.config 也没有）

*   ELMAH_Error 表存在，但没有条目。

*   我的 ELMAH 应用程序在我的机器上运行良好（即显示错误日志）。

*   我更新了 Handler 部分以将名称更改为 Elmha.ashx，而不是 elmah.axd。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-26T23:05:30.317

这发生在我无权访问 Windows 应用程序错误日志的服务器上。在得到那个之后，很明显elmah和blowery一起玩得不好（头球已经发出错误）。

# c# - 使用 Infragistics UltraDateTimeEditor for WinForms 查看时间

> ID：542606
> 
> 赞同：5
> 
> 时间：2009-02-12T18:15:38.033
> 
> 标签：c#, vb.net, winforms, infragistics

默认情况下，UltraDateTimeEditor 只显示日期。除了日期之外，我还需要更改哪些设置来显示/设置时间？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T18:21:31.077

该`MaskInput`属性应具有类似的值`{LOC}mm/dd/yyyy hh:mm tt`。

文档链接：

*   [使用 MaskInput 属性](http://devcenter.infragistics.com/Support/KnowledgeBaseArticle.Aspx?ArticleID=2333)

*   [MaskInput 属性](http://help.infragistics.com/Help/Doc/WinForms/2011.2/CLR2.0/html/infragistics2.Win.UltraWinEditors.v11.2~Infragistics.Win.UltraWinEditors.UltraDateTimeEditor~MaskInput.html)

# oop - 这是糟糕的 oop 设计吗？

> ID：542620
> 
> 赞同：3
> 
> 时间：2009-02-12T18:17:49.683
> 
> 标签：oop

想象一下，我有一个名为 IVehicle 的接口。

从这个界面，我派生了几个具体的类型，例如公共汽车和汽车（都可以移动、减速、关闭引擎等）。我的界面没有字段。

拥有一个具有字段（例如车辆的最高速度）的类并由每种具体类型使用它会是糟糕的设计吗？这会是糟糕的设计吗？另外，如果我在这个类中存储状态（例如使用字段），那么它必须是静态的吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T18:19:10.227

你在谈论一个抽象类，不，这不是糟糕的设计。这就是它们的用途（基本上是接口，但有一些基本的实现）。

状态不必静态存储。每次创建 Car、Bus 等时，都会有这个类的完整实现（以派生类之一的形式）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-12T18:21:44.743

我会添加`TopSpeed`到界面作为这样的属性：

```
interface IVehicle
{
    void Move();
    void SlowDown();
    void SwitchOffEngine();

    Int32 TopSpeed { get; }
} 
```

然后你在你的具体实体中实现接口，如下所示：

```
class Car : IVehicle
{
    public void Move() { }
    public void SlowDown() { }
    public void SwitchOffEngine() { }

    public int TopSpeed
    {
        get { return 120; }
    }
}

class Bus : IVehicle
{
    public void Move() { }
    public void SlowDown() { }
    public void SwitchOffEngine() { }

    public int TopSpeed
    {
        get { return 98; }
    }
} 
```

我认为这将是最好的方法，并且不需要基类。

我认为这是最好的方法的原因是因为`TopSpeed`它是特定于实现的属性，在基类中没有任何意义。由于基类无论如何都需要任何实现设置此值，我认为最好更改接口以包含它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-12T18:26:51.690

在您的情况下，您并没有破坏 OO-

**IVehicle**定义“如果你是一辆车，你应该能做什么”

**AbstractVehicle**定义“如果你是一辆车，这是你应该能够做的最低限度，这就是你应该做的”

**ConcreteVehicle**定义“我是一辆车，这是我做事的方式，因为我是一辆车”

您不需要将所有属性都设置为静态。诸如 Max speed 或 Top speed 之类的东西可以保持静态，但您也可以将它们保持为 const，您的电话。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T18:20:11.800

只是为了消除一些混乱......

接口不能有字段。

但是，它可以具有属性。必须由实现接口的对象通过代码来实现的属性。

除非您计划通过接口将对象的引用转换回具体类型，否则您应该将一些有意义的属性放入接口中，否则您将无法访问它们。

换句话说，如果你有这个：

```
IVehicle vehicle = GetVehicle();
// want to get speed of vehicle?
Car car = (Car)vehicle;
Double speed = car.Speed; 
```

公共属性应该放在公共接口中。由于车辆是一个移动的物体，所以有速度是有意义的。

然而，引擎的数量对飞机和一些船有意义，但对汽车没有意义，因此这种类型的信息可能必须定位到一些更具体的界面中。

静态意味着在实例之间共享，我怀疑这是一个好主意。

但是，使用接口而不是仅仅使用类层次结构来将对象的访问和使用与其实际类型和标识分开的总体计划是一个好主意，并且会带来好的设计。

最好的计划是选择对您的模型有意义的抽象级别并继续使用。您可以很容易地过度设计这样的解决方案。例如，您可能会意识到有些车辆根本没有引擎，有些车辆可以在多个维度上移动（即不仅向前/向后，而且向上/向下、侧向等），然后选择关卡适合您的模型是一个好的开始。

例如，如果您要模拟一个县必须处理的交通问题，那么飞机是否可以向前/向后移动或是否配备垂直可旋转发动机是没有意义的，因此您可能不应该尝试将其设计成解决方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T18:22:51.403

我第二个 DannySmurf，抽象类非常有用。我经常在类库中使用 hide-the-abstract-class-behind-an-interface 模式，这样我就可以将所有实现类，甚至抽象父类作为内部类，也就是说，我不暴露对客户端的实现。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T18:27:00.237

我认为你应该使用超类而不是接口。因此，IVehicle 接口很可能是多余的，您应该只拥有名为 Vehicle 的抽象超类。由于确实每辆车都可以移动，因此可以测量其速度，因此您可以将速度作为字段添加到超类中。

这个速度字段绝不是静态的，因为它将为车辆的每个具体实例实例化；如果您有两条总线，它们可能具有不同的速度，因此该字段不能是静态的，但必须特定于实例。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T21:52:11.773

如果您“向接口添加字段”，它将不再是接口并成为基类。这可能是坏的，也可能不是，取决于你的喜好。

使用接口并避免带有成员变量的基类的模式非常好。在将接口传递给系统的另一部分的情况下，它特别有用。

但是如果没有特定的上下文，就没有*绝对*的规则说“你必须使用接口作为基类”。在您的基类中使用私有成员变量*可能*是您正在寻找的功能的初步近似。使用派生类中定义的私有函数的另一种解决方案更加冗长，仅凭这一点*可能*会使您的代码更难理解（尽管，如果您组织中的每个人都这样做，那将不是问题）。

这取决于你想完成什么。它还取决于您的组织、应用程序中使用的标准，甚至取决于您使用的语言（例如，如果您使用带有 getter 和 setter 的语言，您可以在以后更轻松地替换成员变量）。

成员变量是否为静态是一个单独的问题。当且仅当它在类的生命周期内不会改变时，您应该使成员成为静态成员。“最高速度”听起来符合这个标准。某些语言，例如 c++，具有“静态函数”的概念，其结果不会改变。我想你也可以使用它，但我发现这个添加的概念太混乱了，不值得。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T21:54:09.133

> 拥有一个具有字段（例如车辆的最高速度）的类并由每种具体类型使用它会是糟糕的设计吗？这会是糟糕的设计吗？

不。

恕我直言，C++ 中继承的困难（我不太了解 Java 和其他语言的情况）有助于建立“非叶类应该是抽象的”的传统（它实际上是“更有效的 C++”中的一项）斯科特迈耶斯，如果我没记错的话）。但是，如果有的话，将字段和具体功能放在基类中并不是糟糕的 OO 设计。

在某些语言中，遵循此策略可能会有所回报。在经典的 OO 及其标志语言（Eiffel）中，this（如果您的设计引导您做出选择，则具有具体、有用的基类）正是要走的路。有一些语言机制旨在解决由于代码的多态使用或多重继承而可能遇到的任何潜在问题。

所以，这不是糟糕的 OO 设计；这是肯定的。但是您应该考虑到，在某些语言中，您的自然想法可能传统上会被避免使用不太自然但更实际的替代方案。

通过“您的设计引导您做出选择”，我的意思是在您的程序中创建“车辆”的实例是有意义的。如果这是真的（例如，因为您正在设计一个可以使用“车辆”的视频游戏），那么您的设计就是正确的。如果在您的软件试图解决的问题中，创建车辆毫无意义（例如，因为您正在管理一个停车位，并且不允许*任何东西*“只是车辆”——相反，您需要有摩托车、汽车，货车，等等），那么您的设计当然应该使车辆抽象。但对此没有普遍的答案。

> 另外，如果我在这个类中存储状态（例如使用字段），那么它必须是静态的吗？

不。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-12T18:24:18.327

> 拥有一个具有字段（例如车辆的最高速度）的类并由每种具体类型使用它会是糟糕的设计吗？这会是糟糕的设计吗？

不，不错的设计。另一种方法是为每个字段设置一个抽象/纯虚拟属性（例如最高速度）......如果您有很多这些属性，并且属性很简单（例如只返回一个数字，实际上*不要做*任何事情复杂）那么您对包含专用属性值的类的想法似乎比拥有更多抽象/纯虚拟属性更简单。

> 另外，如果我在这个类中存储状态（例如使用字段），那么它必须是静态的吗？

如果它是静态的，如果它适用于该类的每个实例，则可以。例如，可以将“最高速度”定义为静态（所有公共汽车都具有相同的最高速度），但不能将“当前速度”定义为“当前速度”（不同的公共汽车在任何给定时刻实际上以不同的速度行驶）。

* * *

为了清楚起见，我认为您建议的设计是这样的：

```
interface IVehicle
{
  void accelerate();
}

sealed class VehicleProperties
{
  const int topSpeed;
}

class VehicleImplementation : IVehicle
{
  //const data
  const VehicleProperties vehicleProperties;
  //non-const instance/state data
  int currentSpeed;
  //ctor
  VehicleImplementation(VehicleProperties vehicleProperties)
  {
    this.vehicleProperties = vehicleProperties;
  }
  //implement IVehicle methods
  void accelerate()
  {
    if (currentSpeed => vehicleProperties.topSpeed)
      return;
    ... else todo: accelerate ...
  }
}

class Car : VehicleImplementation
{
  //static properties associated with the Car type
  static VehicleProperties carProperties = new VehicleProperties(120);
  //ctor
  Car()
    : VehicleImplementation(carProperties)
  {}
  //IVehicle methods already implemented by
  //the VehicleImplementation base class
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-15T17:59:59.340

是的，这是个坏主意。您对 IVehicle 的定义非常笼统，但您仍然做出了一些假设。首先是 max-speed 属性可能没有相同的度量单位。Car 类型的孩子可能具有以法定英里为单位测量的最大速度，而 Boat 或 Aircraft 之一将使用海里。有关此类问题的更多信息在[Codewrights Tale 关于对象身份的帖子中进行](http://codewright.blogspot.com/2009/01/identity-crisis.html)了讨论。我们的文化已经接受但从未完全检查过的继承存在一些微妙的问题。如果您想了解这些微妙之处，请研究 FAA 必须如何处理“飞机”含义的定义，以便可以以某种表面上的理智来定义法规。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-12T18:21:02.030

你是特定语言的。例如，在 C++ 中，没有接口，但您可以像使用接口一样使用抽象类。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-12T21:40:04.923

另一种方法，以及我如何区分常见场景的抽象类和接口，是：

- 接口中的所有自定义行为 - 基类中使用的公共字段，可根据需要使用和设置。

> 我经常在类库中使用 hide-the-abstract-class-behind-an-interface 模式，这样我就可以将所有实现类，甚至抽象父类作为内部类，也就是说，我不暴露对客户端的实现。

有这样的例子吗？

# c# - 带有格式的评估堆栈跟踪

> ID：542645
> 
> 赞同：1
> 
> 时间：2009-02-12T18:23:43.850
> 
> 标签：c#, asp.net, data-binding, gridview, stack-trace

我想获取一个在其消息中具有堆栈跟踪的 EventLog 条目并将其绑定到 GridView。如果我使用 Eval("Message") 并将其放在标签或 <p> 中，它会显示，但堆栈跟踪会被粉碎在一起。

如果我在 TextBox 中评估它，它会保留其格式。

有没有办法将此堆栈跟踪值评估为某种文字类型控件并保留格式？

我试过 Server.HtmlEncode(Eval("Message")) 没有成功。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:27:39.800

听起来您需要将换行符转换为 HTML 换行符。尝试这样的事情：

```
String htmlMessage = e.Message.Replace("\n", "<br/>"); 
```

# asp.net - 无需认证即可获取用户身份

> ID：542646
> 
> 赞同：0
> 
> 时间：2009-02-12T18:23:57.810
> 
> 标签：asp.net, authentication, web-config

我有一个将文件写入 NETAPP 的 ASP.NET 应用程序。它很挑剔，我们让它工作的唯一方法是在 web.config 中设置`<identity impersonate="true"/>`和删除`<authentication.../>`标签。这允许应用程序写入 NETAPP（在幕后使用适当的权限监控），但现在我的应用程序无法判断谁在实际使用它。是否有另一种方法可以在不强制用户登录的情况下获取用户 ID？这是一个内部应用程序，因此只能从具有登录用户的工作站运行。有任何想法吗？

编辑：我不是 IIS 专家，但我相信该应用程序已设置为在某个特权帐户下运行以使其正常工作。如果无法获取用户 ID，我也在寻找其他设置方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T18:30:29.840

*   在 web.config 中将身份验证设置为“Windows”
*   在 IIS 中关闭网站的“匿名访问”
*   在 IIS 中为网站打开“集成 Windows 身份验证”
*   在您的 web.config 中打开身份模拟

我相信这会做你需要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T18:30:30.557

一种可能性是我将写作部分移至 Web 服务，以便该服务可以获得所有必要的权限，而不会影响我的应用程序的运行方式。不过，这是很多工作，所以我希望有一个更简单的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T18:32:38.897

如果您有集成 Windows 身份验证，那么

```
string username = HttpContext.Current.Request["LOGON_USER"]; 
```

根据评论进行编辑；也许您真正想要的解决方案是禁用整个应用程序的模拟，只模拟需要模拟的所需位。

有关如何完成此操作的更多详细信息，请参阅此页面。

[http://www.west-wind.com/WebLog/posts/1572.aspx](http://www.west-wind.com/WebLog/posts/1572.aspx)

# tfs - 如何回滚 TFS 项目的先前版本？

> ID：542662
> 
> 赞同：3
> 
> 时间：2009-02-12T18:27:29.660
> 
> 标签：tfs

不知何故，我签入了一个删除整个文件夹（带有子文件夹和 ASP.net 文件）的 Web 项目版本。我想要这些文件，我可以牺牲最新的签入，因为我可以轻松地再次复制它。

如何告诉 TF 服务器回滚到当前版本之前的版本？

# apache-flex - 无法使用 Flex 从剪贴板获取文件数据

> ID：542664
> 
> 赞同：1
> 
> 时间：2009-02-12T18:27:49.610
> 
> 标签：apache-flex, file, drag-and-drop, air, clipboard

给定：具有以下事件的 Flex TileList：

```
<mx:nativeDragDrop>
  <![CDATA[
    if(event.clipboard.hasFormat(ClipboardFormats.FILE_LIST_FORMAT)) {
      var files:Array = event.clipboard.getData(ClipboardFormats.FILE_LIST_FORMAT) as Array;

      for each(var file:File in files)
      {
        // file.data is null here!
      }

      this.listData.refresh();
    }
  ]]>
</mx:nativeDragDrop> 
```

我正在尝试从我拖入此 TileList 的 jpeg 创建一个缩略图列表。Image.source 可以使用 url 来显示图像，但我需要先缩小图像（嗨 rez 照片）我已经完成了缩放部分，除了我需要文件中的 BitmapData 并且 file.data 为 null。

另外，我试过这个：

```
var x:URLRequest = new URLRequest(value.file.url); // this is a local file (e.g. file:///C:/somefile.jpg)
var b:Bitmap = new Bitmap(x.data as BitmapData); 
```

数据也为空！太令人沮丧了。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T19:53:14.697

我假设这是 AIR 应用程序的一部分。（无法从普通的 Flex 应用程序访问剪贴板。）

我没有使用 AIR 的经验，但是您的第二个代码块显然是错误的。实例`URLRequest`本身什么也不做，它只是一个存储请求详细信息的静态对象。为了从该 URL 获取数据，您需要创建一个`Loader`，并将请求传递给该加载器，如下所示：

```
var req:URLRequest = new URLRequest(value.file.url); // this is a local file (e.g. file:///C:/somefile.jpg)
var ldr:Loader = new Loader();
ldr.addEventListener(Event.COMPLETE, function(event:Event):void {
   var b:Bitmap = event.target.content as Bitmap;
});
ldr.load(req); 
```

当然，您必须填写`Event.COMPLETE`处理程序。请注意，`Loader`该类可用于加载 SWF 和图像对象，对于所有其他内容，您必须自己使用`URLLoader`和解析数据。

关于该块，这是[文档](http://livedocs.adobe.com/flex/3/langref/)`nativeDragDrop`中的一个片段：

> 通常，nativeDragEnter 或 nativeDragOver 事件的处理程序会评估正在拖动的数据以及允许的拖动操作，以确定交互式对象是否可以接受放置。要指定交互式对象是合格的目标，事件处理程序必须调用 NativeDragManager.acceptDrop() 函数，并传入对该对象的引用。如果用户在指定对象上释放鼠标按钮，则该对象成为放置目标并调度 nativeDragDrop 事件。

你打电话`NativeDragManager.acceptDrop()`正常吗？

# .net - .NET：如何让 Escape 关闭 MessageBox.Show()？

> ID：542672
> 
> 赞同：16
> 
> 时间：2009-02-12T18:30:45.300
> 
> 标签：.net, winforms, dialog, modal-dialog

假设代码：

```
MessageBox.Show(this, 
       "Would you like the differential girdle spring on the up-end of the grammeters?", 
       "Smi-Boloid Stater Slots", 
       MessageBoxButtons.YesNo, 
       MessageBoxIcon.Warning); 
```

[![替代文字](https://i.stack.imgur.com/GUFMo.png)](https://i.stack.imgur.com/GUFMo.png)

如果用户按下**Escape**，我希望它关闭消息框，并且该`Show()`方法可以返回`DialogResult.None`。

相关问题：如何启用 MessageBox.Show 右上角的“X”以让用户中止？

* * *

有点像 Windows 资源管理器确认对话框如何让您按转义键中止。

有点像 Internet Explorer 确认对话框如何让您按转义键中止。

有点像 Outlook 确认对话框如何让您按转义键中止。

有点像宇宙历史上的每一个对话框都让用户按下退出键，或者单击 X，以便说：

> “我不知道你在问我什么，请不要破坏我的电脑。”

* * *

[来自 Vista UX 指南](http://msdn.microsoft.com/en-us/library/aa511268.aspx)

> **仅使用是和否按钮来回答是或否问题。**主要指令应该自然地表达为是或否的问题。对于是或否问题，切勿使用 OK 和 Cancel。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T18:35:08.800

您必须使用枚举值“MessageBoxButtons.YesNoCancel”启用“取消”选项

这将返回 DialogResult.Cancel

[![在此处输入图像描述](https://i.stack.imgur.com/ZDxGF.png)](https://i.stack.imgur.com/ZDxGF.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T18:37:33.393

我不相信这是可能的，尽管典型的等价物是使用*Cancel指定**[MessageBoxButtons](https://msdn.microsoft.com/en-us/library/system.windows.forms.messageboxbuttons(v=vs.110).aspx)*标志之一（在您的情况下特别是 YesNoCancel）。

 *如果你真的想要的话，用这个特性重新创建你自己的 MessageBox 函数应该是相当简单的，尽管*Cancel*确实可以完成这项工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T18:36:58.980

除了其他答案之外，允许用户使用转义关闭对话框可能是不好的做法，除非它显示“取消”按钮，因为这与用户期望的 Windows 应用程序的默认行为不同，并且他们可能不确定哪个操作他们只是按了退出键。

如前所述，添加“取消”按钮将自动创建所需的效果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T18:35:51.603

我怀疑如果你包含 MessageBoxButtons.YesNoCancel，默认情况下 Escape 被连接到取消，这将返回一个取消的 MessageBoxResult。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T18:38:24.657

我认为`MessageBox`（WinForms 和 WPF 中的那个）是最好重新定义的组件之一。它的行为是如此僵化，以至于几乎不可能进行任何形式的重构。简而言之，自己动手——这样你就可以让 Escape 关闭它，以及你可能需要的任何其他东西。

CodePlex 上有一个名为[InfoBox](http://www.codeplex.com/InfoBox)的项目可能对您有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T19:04:38.853

听起来 MessageBoxButtons.OkCancel 是您正在寻找的东西，您只是挂断了问题与 Ok/Cancel 不匹配的事实。

理论上，您可以编写自己的 MessageBox 表单，它执行相同的操作并将 No 与 Escape 键相关联，这将完全实现您想要的，但需要一些额外的工作。

另一种选择是改写您的问题，例如：

```
MessageBox.Show(this, "The following operation will format your computer.\r\nPress Ok to continue, Cancel to abort", "Confirm Format", MessageBoxButtons.OkCancel, MessageBoxIcon.Warning); 
```

只是一个例子，但它可能是解决您的困境的最简单的解决方案。

# java - 如何从 .NET 应用程序访问 HSQL DB？

> ID：542674
> 
> 赞同：2
> 
> 时间：2009-02-12T18:32:03.657
> 
> 标签：java, odbc, hsqldb

是否可以从位于同一台计算机上的 .net 应用程序访问在服务器模式下运行的 HSQLDB 数据库？hsqldb 似乎没有任何 odbc 驱动程序（免费提供）。我错过了吗？

Sun 的 jdbc odbc 桥接器似乎允许通过 jdbc 连接连接到 odbc 数据源，但在这种情况下我需要相反的情况：能够创建将我连接到 jdbc 源的 odbc 连接。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T03:26:43.200

运行基于 hsqldb 的[H2](http://h2database.com/)。然后，通过 postgresql 驱动程序使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-28T08:42:05.200

根据他们的网站[hsqldb.org](http://hsqldb.org/)：

> **.NET 和 ODBC 开发：**
> 
> HSQLDB 核心开发人员 Campbell Boucher-Burnet 开发了 HSQLDB 1.8.x 的 .NET 端口。发展处于后期阶段。其他核心开发人员 Blaine Simpson 一直在为 HSQLDB 2.0 开发 ODBC 驱动程序。这目前适用于直接语句并支持 Windows 和 Linux。这两项工作的代码都可以从 SVN 存储库下载。

所以你可能想检查他们的[SVN 存储库](http://sourceforge.net/projects/hsqldb/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:44:12.703

谷歌的一些解决方案：

*   [Easysoft ODBC-JDBC 网关](http://www.easysoft.com/products/data_access/odbc_jdbc_gateway/)
*   [odbcjdbc 在 sourceforge](http://odbcjdbc.sourceforge.net/)中使用 JNI
*   来自 OpenLink[的 ODBC-JDBC 桥驱动程序](http://uda.openlinksw.com/odbc/st/odbc-jdbc-bridge-st/)

# c# - 需要自定义货币格式才能与 String.Format 一起使用

> ID：542690
> 
> 赞同：13
> 
> 时间：2009-02-12T18:36:01.933
> 
> 标签：c#, currency, string.format

我正在尝试在 C# 中使用 String.Format("{0:c}", somevalue) 但很难弄清楚如何配置输出以满足我的需求。以下是我的需求：

1.  0 输出到空白
2.  1.00 输出到 1.00 美元
3.  10.00 输出到 10.00 美元
4.  100.00 输出到 100.00 美元
5.  1000.00 输出到 $1,000.00

我试过 String.Format("{0:c}", somevalue) 但对于零值，它输出 $0.00 这不是我想要的。我也尝试过 String.Format("{0:$0,0.00;$(0,0.00);#}", somevalue)，但对于 1.0，它输出 $01.00。String.Format("{0:$0.00;$(0.00);#}", somevalue) 适用于大多数情况，但当 somevalue 为 1000.00 时，输出为 $1000.00。

是否有适合上述所有 5 种情况的格式？我读过的所有文档都只详细介绍了基础知识，并没有涉及这种类型的场景。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-12T18:56:39.013

如果你使用

```
string.Format("{0:$#,##0.00;($#,##0.00);''}", value) 
```

您将获得零值的“”，其他值也应正确格式化。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T18:38:50.647

尝试这样的事情：

```
String currency = (number == 0) ? String.Empty : number.ToString("c"); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T18:57:48.073

根据您是否始终对所有货币值使用相同的数据类型，您可以编写一个扩展方法，以便始终满足您的情况。例如，如果您使用的是十进制类型：

```
public static string ToCurrencyString (this decimal value)
{
  if (value == 0)
    return String.Empty;
  return value.ToString ("C");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:08:03.103

[这是](http://dylanbeattie.blogspot.com.ar/2010/09/net-string-formatting-cheat-sheet.html)一个很好的参考资料，您可能会觉得有用，它总结了这些数据：http: [//blog.stevex.net/string-formatting-in-csharp/](http://blog.stevex.net/string-formatting-in-csharp/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-11-12T21:19:29.807

“C”货币格式非常好，直到您需要 0 的空白。这里有两种方法，上面提到的一种，类似于我使用的给您 0 的空白的方法：

```
// one way
string.Format("{0:$#,##0.00;($#,##0.00);''}", somevalue)

// another way
somevalue.ToString("$#,##0.00;($#,##0.00);''") 
```

如果您喜欢这种代码风格（就像我一样），第二种技术感觉更“流畅”。

# windows - 在 Windows 上用于视频捕获的 DirectShow 替代方案

> ID：542693
> 
> 赞同：4
> 
> 时间：2009-02-12T18:36:37.330
> 
> 标签：windows, directshow, video-capture

我正在考虑更新当前使用 DirectShow 进行视频捕获的程序。虽然 DirectShow 似乎运行良好，但我想知道是否有任何更强大或最新的 SDK 或 API 值得我研究。一些有用的功能将是：

1.  在捕获期间提供一致的帧速率（NTSC 帧之间为 33 毫秒）。
2.  使用 DirectShow 兼容的捕获设备。
3.  不需要在客户的 PC 上安装额外的许可证。
4.  允许同时预览和硬件编码视频。
5.  能够集成到 C++/MFC 应用程序中。

我研究了[LeadTools Multimedia Capture SDK](http://www.leadtools.com/SDK/Multimedia/Multimedia-Capture.htm)和[VisioForge Capture SDK](http://www.visioforge.com/index.php?option=com_content&task=view&id=12&Itemid=28)和[Microsoft Media Foundation](http://msdn.microsoft.com/en-us/library/ms694197.aspx)，但只是想知道其他人成功使用了什么，然后再将时间或金钱投入这些替代方案之一。我不在乎这是商业产品还是开源产品。

编辑：虽然我很欣赏解决我的特定问题的尝试，但这个问题应该是关于 DirectShow 的替代品。因此，我删除了对我的具体问题的所有引用。解决这个问题需要等待另一个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:05:46.883

相当多的捕获板都带有自己的计时器。

您可以尝试查询您的源过滤器`IReferenceClock`并使用它自己的计时器，该计时器通常比 PC 的计时器更准确。

如果您使用，那么从在 Sample Grabber 的输入引脚上调用回调函数的那一刻起`ISampleGrabber`，回调函数就会被调用*微秒*`Receive`，它们在源代码中只有几行。

似乎您的帧源时序不准确（不是中设置的时序`IMediaSample`，而是传递帧的实际时序）。

产生帧的源过滤器是什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-12T23:08:13.890

DirectShow API 非常好，我在 windows 平台上从未发现过更好的。DirectShow 已被[Media Foundation](http://en.wikipedia.org/wiki/Media_Foundation)取代，后者仅是 Vista（及更高版本）操作系统。

在人们开始使用媒体基金会进行大规模开发之前，我们将不得不等待 XP 死去……

请问您为什么要寻找 DirectShow 的替代品 - 它是一个非常受支持的 API - 在 MSDN 上有很好的记录，并且在 MSDN 上有一个非常活跃和[友好](http://social.msdn.microsoft.com/Forums/en-us/windowsdirectshowdevelopment/threads)的 DirectShow 开发论坛。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T21:19:30.657

VideoLan 可能是您的一个选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T18:48:16.100

问题可能只是您用于计时的方法。你在使用[高性能定时器 API](http://msdn.microsoft.com/en-us/library/ms644904.aspx)吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-17T16:22:10.710

FFmpeg 可以接收 directshow 输入并对其进行操作，而且它是免费的。AviSynth 也可能...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-08T13:42:55.453

LeadTools 和 VisioForge SDK 只是 DirectShow 的包装器 + 来自它们的一些自定义过滤器！在 Windows PC 上捕获 DirectShow 没有真正的替代方案。也许在带有 MediaFoundation 的 Win8 上？一些硬件供应商有自己的捕获程序，但大多数只使用 DirectShow。

我认为你的问题不是 DirectShow。您的回调工作多长时间？因为如果您对图像进行一些分析，那么您需要快速执行此操作。重要的不是回调中的时间，而是您获得的 mediasample 中的演示时间！这应该是预览示例中的 +33ms。

# sql - 如何将 2 个 select 语句合并为一个？

> ID：542705
> 
> 赞同：57
> 
> 时间：2009-02-12T18:41:39.093
> 
> 标签：sql, select, conditional

当谈到 SQL 语法时，我是个菜鸟。

当然，我有一张有很多行和列的表：P 可以说它看起来像这样：

```
 AAA BBB CCC DDD
-----------------------
Row1 | 1   A   D   X
Row2 | 2   B   C   X
Row3 | 3   C   D   Z 
```

现在我想创建一个高级选择语句，它给我这个组合（这里是伪 SQLish）：

```
select 'Test1', * from TABLE Where CCC='D' AND DDD='X'
select 'Test2', * from TABLE Where CCC<>'D' AND DDD='X' 
```

输出将是：

```
Test1, 1, A, D, X
Test2, 2, B, C, X 
```

我如何将这两个 select 语句组合成一个不错的 select 语句？

如果我像下面这样复杂化 SQL（因为我自己的 SQL 语句包含一个存在语句），它会起作用吗？我只想知道如何组合选择，然后尝试将其应用到我更高级的 SQL 中。

```
select 'Test1', * from TABLE Where CCC='D' AND DDD='X' AND exists(select ...)
select 'Test2', * from TABLE Where CCC<>'D' AND DDD='X' AND exists(select ...) 
```

我的 REAL SQL 语句是这样的：

```
select Status, * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00' 
```

这给了我一个结果。但是我想将它与这个选择语句的副本结合起来，并在末尾添加一个 AND，并且“状态”字段将被更改为像“已删除”这样的字符串。

```
select 'DELETED', * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00'
AND NOT (BoolField05=1) 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-02-12T18:49:40.743

你在这里有两个选择。第一个是有两个结果集，它们将根据`WHERE`子句中的条件设置“Test1”或“Test2”，然后将`UNION`它们放在一起：

```
select 
    'Test1', * 
from 
    TABLE 
Where 
    CCC='D' AND DDD='X' AND exists(select ...)
UNION
select 
    'Test2', * 
from 
    TABLE
Where
    CCC<>'D' AND DDD='X' AND exists(select ...) 
```

这可能是一个问题，因为您将有效地扫描/查找 TABLE 两次。

另一种解决方案是从表中选择一次，然后根据 TABLE 中的条件设置“Test1”或“Test2”：

```
select 
    case 
        when CCC='D' AND DDD='X' AND exists(select ...) then 'Test1'
        when CCC<>'D' AND DDD='X' AND exists(select ...) then 'Test2'
    end,
    * 
from 
    TABLE 
Where 
    (CCC='D' AND DDD='X' AND exists(select ...)) or
    (CCC<>'D' AND DDD='X' AND exists(select ...)) 
```

这里的问题是您必须在`CASE`语句和`WHERE`语句中复制过滤条件。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-12T18:45:44.047

如果它们来自同一张桌子，我认为[`UNION`](http://www.devguru.com/technologies/t-sql/7118.asp)是您正在寻找的命令。

（如果您需要从不同表的列中选择值，则应该查看[`JOIN`](http://www.w3schools.com/Sql/sql_join.asp)...）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-13T10:28:19.490

感谢您的输入。尝试了这里提到的东西，这些是我要工作的两个：

```
(
select 'OK', * from WorkItems t1
where exists(select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00'
AND (BoolField05=1)
)
UNION
(
select 'DEL', * from WorkItems t1
where exists(select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00'
AND NOT (BoolField05=1)
) 
```

和

```
select 
    case
        when
            (BoolField05=1)
    then 'OK'
    else 'DEL'
        end,
        *
from WorkItems t1
Where
            exists(select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
            AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
            AND TimeStamp>'2009-02-12 18:00:00' 
```

其中哪一个是最有效的（编辑：第二个，因为它只扫描表一次），**是否有可能使它更有效**？（BoolField=1）实际上是一个变量（dyn sql），可以包含表上的任何where语句。

我在 MS SQL 2005 上运行。尝试了 Quassnoi 示例，但没有按预期工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-07-03T10:06:00.643

```
select t1.* from 
(select * from TABLE Where CCC='D' AND DDD='X') as t1,
(select * from TABLE Where CCC<>'D' AND DDD='X') as t2 
```

另一种方法来做到这一点！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T18:45:56.650

```
select Status, * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00'

UNION

select 'DELETED', * from WorkItems t1
where  exists (select 1 from workitems t2 where t1.TextField01=t2.TextField01 AND (BoolField05=1) )
AND TimeStamp=(select max(t2.TimeStamp) from workitems t2 where t2.TextField01=t1.TextField01) 
AND TimeStamp>'2009-02-12 18:00:00'
AND NOT (BoolField05=1) 
```

也许这样就行了。不过，我无法从这里对其进行测试，而且我不确定您使用的是哪个版本的 SQL。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T18:46:30.957

[Union 命令是您所需要的。](http://www.w3schools.com/sql/sql_union.asp) 如果这不起作用，您可能需要改进您所处的环境。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T18:49:55.580

在选择中使用 case 并在 where close 中使用 OR

像这样的东西，我没有测试过，但它应该可以工作，我想......

```
select case when CCC='D' then 'test1' else 'test2' end, *
from table
where (CCC='D' AND DDD='X') or (CCC<>'D' AND DDD='X') 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T18:52:38.163

我想这就是你要找的：

```
SELECT CASE WHEN BoolField05 = 1 THEN Status ELSE 'DELETED' END AS MyStatus, t1.*
FROM WorkItems t1
WHERE (TextField01, TimeStamp) IN(
  SELECT TextField01, MAX(TimeStamp)
  FROM WorkItems t2
  GROUP BY t2.TextField01
  )
AND TimeStamp > '2009-02-12 18:00:00' 
```

如果您使用的是 Oracle 或 MS SQL 2005 及更高版本，那么您可以这样做：

```
SELECT *
FROM (
  SELECT CASE WHEN BoolField05 = 1 THEN Status ELSE 'DELETED' END AS MyStatus, t1.*,
     ROW_NUMBER() OVER (PARTITION BY TextField01 ORDER BY TimeStamp DESC) AS rn
  FROM WorkItems t1
) to
WHERE rn = 1 
```

，效率更高。

# c# - 在给定的场景中使用 ninject/autofac

> ID：542707
> 
> 赞同：0
> 
> 时间：2009-02-12T18:41:55.990
> 
> 标签：c#, dependency-injection, ninject, autofac

我有一些提供者，比如说 -

```
<Providers>
    <Provider Type="Providers.IM"  Name="Im"/>
    <Provider Type="Providers.Web" Name="Web"/>
    ...
</Provider> 
```

这些提供商中的每一个都可以给我一个会话：

```
<Sessions>
    <Session Name="GoogleIM" Provider="Im"  URL="..." />
    <Session Name="YahooIM"  Provider="Im"  URL="..." />
    <Session Name="YahooWeb" Provider="Web" URL="..." />
    ...
</Session> 
```

目前，我通过查看提供者、实例化类型和注入 URL（手动）来实例化“命名”会话。

我可以使用会话工厂，它可能必须理解 url 并返回正确的会话。

有没有办法用 ninject/autofac 更优雅/更简单地处理这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T19:01:02.933

我可能无法正确理解您的设置，但我相信您可以使用 Ninject 轻松处理此类操作。您可能希望创建一个基本接口并让您的所有对象都实现它。您的 Ninject 绑定将使用 Context 来确定要加载哪个类来代替您的接口类型。我使用 Ninject 的上下文绑定编写了一个简短的教程：http: [//frickinsweet.com/ryanlanciaux.com/post/Real-Ultimate-Power--Dependency-Injection-with-Ninject.aspx](http://frickinsweet.com/ryanlanciaux.com/post/Real-Ultimate-Power--Dependency-Injection-with-Ninject.aspx)

# c# - ASP.NET C# 通过 FTPwebRequest 问题上传 MemoryStream 内容

> ID：542709
> 
> 赞同：2
> 
> 时间：2009-02-12T18:42:26.160
> 
> 标签：c#, asp.net, memorystream, ftpwebrequest

这应该很简单，并且上传作品。但是当我在 FTP 服务器上打开上传的文件时，它会显示二进制数据，这些数据只是一些看起来像 [][][][] 的奇怪字符，并且文件大小正确。如何添加表明该文件是 XML 的属性或标题？

```
 public bool ProcessBatch(MemoryStream memStream)
    {
        bool result = true;
        FTPaddress = DistributionResources.ftpServer;
        CompleteFTPPath = DistributionResources.ftpPath;

        request = (FtpWebRequest)FtpWebRequest.Create(FTPaddress + CompleteFTPPath);
        request.Credentials = new NetworkCredential("username", "password");
        request.Method = WebRequestMethods.Ftp.UploadFile;
        request.UsePassive = true;
        request.UseBinary = true;
        request.KeepAlive = false;

        try
        {

            byte[] buffer = new byte[memStream.Length];

            memStream.Read(buffer, 0, buffer.Length);
            memStream.Close();

            using (Stream reqStream = request.GetRequestStream())
            {
                reqStream.Write(buffer, 0, buffer.Length);
            }

            //Gets the FtpWebResponse of the uploading operation
            response = (FtpWebResponse)request.GetResponse();
            Console.WriteLine(response.StatusDescription); //Display response

        }
        catch(Exception ex)
        {
            result = false;
        }

        return result;
    } 
```

非常感谢你

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T18:44:31.850

尝试不使用`request.UseBinary = true`

换句话说，使用`request.UseBinary = false`. 否则，它会将内容作为二进制数据上传，这可能就是您看到它在服务器上以这种方式显示的原因。

例如，如果您在 windows 中使用命令行 FTP 客户端，则必须在输入文本文件`ascii`之前显式键入。`put`同样的原则可能适用于此。

# shell - 谁调用这个函数？

> ID：542710
> 
> 赞同：3
> 
> 时间：2009-02-12T18:43:17.047
> 
> 标签：shell, ctags, code-search-engine

在我的上一份工作（遗留 FORTRAN 77 代码）中，我们有交叉引用文件，其中列出了哪些子例程称为其他子例程、在哪些文件中定义了子例程、哪些公共块包含哪些变量、哪些子例程包含哪些公共块等。这些是然后由 grep 交叉引用文件的 shell 脚本使用，并会告诉您有关程序设计的信息。

我现在在一家新公司（C++ 代码），我找到了 ctags 来替换其中的一些功能。我最想念的一件事是我们称为“who.calls”的命令，它列出了哪些子例程（我的意思是函数或方法，必须习惯于 OO-speak）调用给定的子例程。例如，如果子程序`foo`调用子程序`bar`：

```
>who.calls bar
foo 
```

关于如何在不重新设计旧公司的编程环境的情况下做到这一点的任何建议？我正在寻找可以在命令行中使用的超级正则表达式或其他方法，但我愿意接受其他方法，这些方法采用一些完全不同的方法来给我相同的信息。我基本上想在不运行调试器的情况下发现一个调试函数堆栈。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:47:40.703

您可能要考虑使用[doxygen](http://www.doxygen.nl/)。它可以生成向您显示整个调用树和类结构的网页，以及提取格式正确的注释来记录类和方法，就像 Javadocs 为 java 所做的那样。

另一种可能性是开始使用 IDE。在使用 vi（然后是 gvim）和 ctags 25 年后，我最近加入了 21 世纪并开始使用 Eclipse（我正在做 Java，但我见过 Eclipse 的 C++ 插件）。除了能够做标签可以做的所有事情，它还可以把你带到当前方法的所有调用者。最重要的是，它内置了一个非常棒的交互式调试器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T19:13:51.107

对于命令行使用，请尝试[cscope](http://cscope.sourceforge.net/)；它应该能够回答这个问题等等：

> *   允许搜索代码：
>     *   所有对符号的引用
>     *   全局定义
>     *   函数调用的函数
>     *   函数调用函数
>     *   文本字符串
>     *   正则表达式模式
>     *   一份文件
>     *   文件包括文件

它不是为 C++ 编写的，但可能能够处理搜索 C++ 代码库（有[一些警告](http://cscope.sourceforge.net/cscope_man_page.html)）。

如果您正在寻找基于 Web 的界面，请考虑在服务器上运行并索引您的修订控制系统的[OpenGrok 。](http://opengrok.github.io/OpenGrok/)它没有您要特别寻找的搜索，但它可以通过符号搜索来近似它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T18:53:43.730

SlickEdit 可以标记项目中的每个符号，包括库，以在“显示引用”中显示。它将是 who.calls 加一，其中加一是定义。它是基于源的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T19:23:12.600

[GNU Global](http://www.gnu.org/software/global/)在基于 Unix 的系统上为我完成了这项工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-22T20:41:33.187

可以在[SD Source Code Search Engine](http://www.semanticdesigns.com/Products/SearchEngine)找到一个对语言敏感的源代码搜索引擎。它可以同时处理多种语言。可以对特定语言的模式或跨语言的模式执行搜索（例如“查找涉及 TAX 的标识符”）。通过对语言标记敏感，可以减少误报的数量，从而为用户节省时间。它理解 C、C++、C#、COBOL、Java、ECMAScript、Java、XML、Verilog、VHDL 和许多其他语言，特别是 FORTRAN。

使用这个工具很容易找到在 Fortran 中调用 X 的人；只需搜索所有标识符“X”。您输入的实际查询是这样的：I=X（“任何名为 X 的标识符”）。这会找到整个源代码库中的所有引用。

# apache-flex - 在 Flash Player 10 中检测 GPU 渲染

> ID：542712
> 
> 赞同：6
> 
> 时间：2009-02-12T18:44:30.930
> 
> 标签：apache-flex, flash, actionscript-3, gpu

显然，在 Flash 10 中，您可以使用 GPU 来计算着色器，如果用户没有兼容的 gpu，它就会退回到 cpu。问题是cpu计算过滤器的速度很慢，如果它不能使用gpu，它会很好检测，并且使用更少的效果。如果使用 gpu 渲染，是否可以使用 actionscript 进行检测？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T19:34:34.630

为什么不测量做某事所花费的时间，如果花费的时间太长，你就禁用一些效果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T09:33:09.263

如果着色器是指使用像素弯曲工具包编译的东西，它们不会在 GPU 上运行。看：

[http://www.kaourantin.net/2008/05/adobe-pixel-bender-in-flash-player-10.html](http://www.kaourantin.net/2008/05/adobe-pixel-bender-in-flash-player-10.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:01:12.043

据我所知，没有用于此的 API，我认为这就是 Adob​​e 建议将其使用限制为每个 HTML 页面 1 个 SWF 并不鼓励将其用于横幅等的原因，因为它对 CPU / 内存来说可能*非常*昂贵。

我想一个优雅的解决方法是让你的用户选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T19:28:21.620

Adobe在非windows平台上依赖OpenGL来使用硬件加速，而在OpenGL中则没有这种区别。为了保持跨平台的一致性（这是 Flash 的优势之一），这是可取的行为。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T21:56:19.657

在 ActionScript 3 中有[Capabilities](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/system/Capabilities.html)类。也许你在那里找到了你要找的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-28T04:42:14.247

要检测 GPU 加速，您可以读取[wmodeGPU](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/display/Stage.html#wmodeGPU) stage 属性。

# apache-flex - 在 Flash 9 或 10 中水平翻转 BitmapData

> ID：542716
> 
> 赞同：1
> 
> 时间：2009-02-12T18:45:44.840
> 
> 标签：apache-flex, flash

代表我的同事问：

我们正在开发一个使用 Flash 9（和 Flex，但这并不相关）的 Facebook 应用程序。

我们有一个相当复杂的系统来绘制一个带有附件的对象，其中附件可以具有任意比例、旋转和相对于基础对象的位置。

我们最近开始添加更多功能，包括水平翻转对象的能力。对于应用程序的相似但不相同的部分，我们可以简单地应用负水平比例来水平翻转对象。

但是，当尝试使用图形 api 和 graphics.beginBitmapFill() 手动绘制对象时，我们遇到了困难。根据一些搜索结果，我们**应该**能够通过为传递给 beginBitmapFill() 的矩阵分配一个负的水平比例来实现这一点，但这不起作用。

有任何想法吗？

编辑：谢谢大家。我们将测试这些，我会让你知道它是如何工作的。

编辑：我选了一个！我的同事说：“另一个可能也可以，但只是……不行。” :)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T20:52:58.670

你的矩阵是如何构造的？您需要确保在翻转 x 刻度的同时，您还需要将其再次平移到其宽度上。这是一个在舞台中使用 MovieClip 的示例，然后将其绘制到位图并水平翻转

```
import flash.display.*;
import flash.geom.*;

var toFlip : MovieClip;

var matrix : Matrix = new Matrix();
matrix.scale(-1,1);
matrix.translate(toFlip.width, 0);

var bitmapData : BitmapData = new BitmapData(toFlip.width, toFlip.height, false, 0xFFFF0000);
bitmapData.draw(toFlip, matrix);
var bitmap : Bitmap = new Bitmap(bitmapData);

addChild(bitmap); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:26:10.843

给你，这可能不是 100% 有效，但如果你向它传递一个 BitmapData 对象，它会返回给你完全相同的水平翻转的对象。

```
function flipBitmapDataHorizontal (b:BitmapData):BitmapData
{
    var pixelList:Array = new Array();
    var pixelIndex:uint = 0;

    var i:uint;
    var j:uint;

    for(i = 0; i<b.height; i++){
        for(j = b.width; j>0; j--){
            var nextPixel:uint = b.getPixel32(j,i);
            pixelList.push(nextPixel);
            pixelIndex++;
        }
    }

    var newB:BitmapData = new BitmapData(b.width,b.height);
    var curPixel:uint = 0;

    for(i = 0; i<b.height; i++){
        for(j = 0; j<b.width; j++){
            newB.setPixel32(j,i,pixelList[curPixel++]);
        }
    }

    return newB;
} 
```

# c# - 我处理长文件路径的 WINAPI 调用有什么问题？

> ID：542720
> 
> 赞同：2
> 
> 时间：2009-02-12T18:46:27.210
> 
> 标签：c#, winapi, file-copying

我一直在试图找出在 Windows 中使用深路径复制文件的最佳方法（文件，而不是文件夹，所以 robocopy 是不可能的）。我能想出的最佳解决方案是编写自己的解决方案。我已经能够编写代码来处理具有 10,000 个字符深度路径的列表目录，但使用相同的方法似乎不适用于实际复制文件。我厌倦了使用带有 \?\ 前缀的 System.IO 库，这似乎不起作用。

```
[DllImport("kernel32.dll", CharSet = CharSet.Unicode)]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool CopyFile(string lpExistingFileName, string lpNewFileName,
   bool bFailIfExists);

public static bool CopyFile(string source, string dest)
{
    source = fixPathForLong(source);
    dest = fixPathForLong(dest);

    return CopyFile(source, dest, false);
}

private static string fixPathForLong(String path)
{
    if (!path.StartsWith(@"\\?\"))
        path = @"\\?\" + path;
    return path;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-09-29T21:42:27.113

您应该改为调用函数 CopyFileW 吗？注意最后的W。另外，我不知道您是否使用的是 UNC 路径。如果是这样，您需要使用“\\?\UNC\”作为前缀。

这是一篇关于长路径处理的好文章

[http://blogs.msdn.com/bclteam/archive/2007/02/13/long-paths-in-net-part-1-of-3-kim-hamilton.aspx](http://blogs.msdn.com/bclteam/archive/2007/02/13/long-paths-in-net-part-1-of-3-kim-hamilton.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T18:54:58.767

如果对 CopyFile 的调用（不是您的重载，P/Invoke 声明）返回 false，我将抛出 Win32Exception：

```
public static void CopyFile(string source, string dest)
{
    source = fixPathForLong(source);
    dest = fixPathForLong(dest);

    if (!CopyFile(source, dest, false))
    {
        throw new Win32Exception();
    }
} 
```

Win32Exception 类的默认构造函数将调用 GetLastError 并为您提供有关操作失败原因的更详细的错误信息。

# c# - 处理动态（运行时）控件的事件 - VB.NET

> ID：542724
> 
> 赞同：2
> 
> 时间：2009-02-12T18:48:05.397
> 
> 标签：c#, vb.net, dynamic, runtime, controls

我有一个在运行时创建并添加到表单的 WebBrowser 控件。

如何将此控件连接到可以在运行时处理其事件的子程序？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T18:49:34.800

使用[AddHandler](http://msdn.microsoft.com/en-us/library/7taxzxka(VS.80).aspx)

例如

```
AddHandler Obj.Ev_Event, AddressOf EventHandler 
```

以及当你想摆脱它时（当你用完它时应该摆脱它）

```
RemoveHandler Obj.Ev_Event, AddressOf EventHandler 
```

在你的情况下，你可能有类似的东西

```
Dim web as New WebBrowser()
AddHandler web.DocumentCompleted, AddressOf HandleDocumentCompleted 
```

假设您创建了一个名为 HandleDocumentCompleted 的事件处理程序

根据您的需要，您还可以在声明 Web 浏览器时使用[WithEvents](http://msdn.microsoft.com/en-us/library/stf7ebaz(VS.71).aspx)关键字；请参阅[文档](http://msdn.microsoft.com/en-us/library/stf7ebaz(VS.71).aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T19:08:49.450

使用的替代方法`AddHandler`是 VB 中的声明性事件语法。要使用它，请使用关键字*声明*控件（作为私有成员） 。`WithEvents`然后，`Handles`可以在方法上使用关键字来处理适当的事件：

```
Private WithEvents m_WebBrowser As WebBrowser

Private Sub WebBrowser_Navigate(ByVal sender As Object, ByVal e As WebBrowserNavigatedEventArgs) Handles m_WebBrowser.Navigate
    MsgBox("Hi there")
End Sub

Private Sub SomeActionThatCreatesTheControl()
    m_WebBrowser = New WebBrowser()
End Sub 
```

这种方法主要有两个优点：

*   不需要`RemoveHandler`，
*   无需手动连接所有事件处理程序：这是自动完成的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T18:59:08.630

*   您将需要使用 AddHandler 和 RemoveHandler。
*   如果您通过 AddHandler 手动添加事件，请务必使用 RemoveHandler 将其删除（在适当的位置）。
*   键入“AddHandler NameOfControl”。将通过智能感知提供可用事件的列表。
*   Intellisense、文档（或“错误列表”）也会为您提供事件处理程序的“签名”。

```
 Private Sub WebBrowser1_Navigate(ByVal sender As Object, ByVal e As WebBrowserNavigatedEventArgs)

End Sub

Private Sub Form1_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
    RemoveHandler WebBrowser1.Navigated, AddressOf WebBrowser1_Navigate
End Sub

Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
    AddHandler WebBrowser1.Navigated, AddressOf WebBrowser1_Navigate        
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T18:53:14.497

我通过检查表单设计器生成的代码了解到这一点。从那里复制其中一个示例，如果您环顾四周，您可能会学到一些关于在运行时设置控件的其他有价值的东西。

在 C# 中，它使用 += 完成，在以函数作为参数的类的事件成员上，但我没有方便的 VB.net 来检查自己......对不起。

编辑：这是 Daniel L 在他的回答中很好地描述的[AddHandler](http://msdn.microsoft.com/en-us/library/7taxzxka.aspx)，并且在[msdn](http://msdn.microsoft.com/en-us/library/7taxzxka.aspx)中有详细的描述。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-12T14:29:13.450

例子

AddHandler SharedTimer.Tick, AddressOf SharedTimer_Tick

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-18T11:43:31.960

'我有一种方法可以在某些情况下发现控件并添加处理程序。
'这是一个简化的例子。
'是否可以在运行时传入处理程序？

```
Private Sub Example(byval ph as Placeholder)
  for each ctrl as control in ph.controls
    if typeof (ctrl) is textbox then
      dim cb as checkbox = ctrl
      AddHandler cb.DataBinding, AddressOf MyHandler
    end if
  next
end sub 
```

“我想做更多这样的事情......

```
Private Sub Example(byval ph as Placeholder, **byref method as delagate**)
  for each ctrl as control in ph.controls
    if typeof (ctrl) is textbox then
      dim cb as checkbox = ctrl
      AddHandler cb.DataBinding, **method**
    end if
  next
end sub 
```

我遇到的问题是调用该方法。这不起作用：

```
Example(myPlaceholder, addressof MyRuntimeHandler) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-19T11:19:54.083

您可以使用 Addhandler 语句来执行这些操作。您可以像这样在运行时将任何事件处理程序添加到网络浏览器

```
AddHandler WebBrowser1.xEvent, AddressOf WebBrowser1EventHandler
```

同样，您可以使用 RemoveHandler，它将事件与事件处理程序断开连接，如下所示：

```
RemoveHandler WebBrowser1.XEvent, AddressOf WebBrowser1EventHandler
```

# prototypejs - 获取一个属性id，设置为另一个属性id

> ID：542725
> 
> 赞同：0
> 
> 时间：2009-02-12T18:48:12.573
> 
> 标签：prototypejs, scriptaculous, setattribute

我目前正在使用 scriptaculous 和原型将元素从一个 div 拖放到另一个，并根据所删除元素的“src”附加一个新元素，从而创建一个新的可拖动元素。

我需要做的是在创建后将已删除元素的 id 分配给新元素。

我尝试了很多不同的方法，这是最新的：

```
$$('.image').each(function(stack) {
new Draggable(stack, { revert: true, ghosting: true }); 
}); 
```

...

```
onDrop: function(stack) {
      var added = new Element('img');
      added.src = stack.readAttribute('src');
      var imageid = stack.identify();
      added.setAttribute('id', imageid); 
```

显然我有点新手，想象一下我现在已经很远了。感谢任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T23:05:43.407

您的大部分代码看起来都不错，但是我想确保放置的 div 对象是可放置的。Draggable 类没有 onDrop 回调函数。如果您查看文档，它有一个 onStart、onDrag、change 和 onEnd。尝试使用 onEnd 代替。

[http://wiki.github.com/madrobby/scriptaculous/draggable](http://wiki.github.com/madrobby/scriptaculous/droppables) [http://wiki.github.com/madrobby/scriptaculous/droppables](http://wiki.github.com/madrobby/scriptaculous/droppables)

# iphone - 我可以使用 CGAffineTransformMakeRotation 将视图旋转 360 度以上吗？

> ID：542739
> 
> 赞同：28
> 
> 时间：2009-02-12T18:52:12.300
> 
> 标签：iphone, cocoa-touch, core-animation, core-graphics

我正在编写一个 iPhone 应用程序，并且我有一个我想向外旋转的图像。

目前我的代码看起来像这样（包装在 beginAnimations/commitAnimations 块中）：

```
scale = CGAffineTransformScale(CGAffineTransformIdentity, 5.0f, 5.0f);
swirl = CGAffineTransformRotate(scale, M_PI);
[player setTransform:swirl];    
[player setAlpha:0.0f]; 
```

但我发现如果我尝试将旋转角度更改为 4*M_PI，它根本不会旋转。是否可以使用 CGAffineTransformRotate 进行 720˚ 旋转，还是我必须切换到另一种技术？

如果我必须切换到另一种技术，您会建议使用另一个线程（或计时器）自己制作动画，还是 OpenGL 是更好的选择？

谢谢，
布莱克。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-09-14T19:39:36.037

您可以将视图旋转一定数量的弧度，无论它是小于完整旋转还是完整旋转的多个倍数，而无需将旋转拆分为多个部分。例如，以下代码将每秒旋转一次视图，持续指定的秒数。您可以轻松地对其进行修改，以通过一定数量的旋转或一定数量的弧度来旋转视图。

```
- (void) runSpinAnimationWithDuration:(CGFloat) duration;
{
    CABasicAnimation* rotationAnimation;
    rotationAnimation = [CABasicAnimation animationWithKeyPath:@"transform.rotation.z"];
    rotationAnimation.toValue = [NSNumber numberWithFloat: M_PI * 2.0 /* full rotation*/ * rotations * duration ];
    rotationAnimation.duration = duration;
    rotationAnimation.cumulative = YES;
    rotationAnimation.repeatCount = 1.0; 
    rotationAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];

    [myView.layer addAnimation:rotationAnimation forKey:@"rotationAnimation"];
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T19:53:30.497

可以，但您需要将动画拆分为半圆旋转。我提供了一个示例来回答[这个问题](https://stackoverflow.com/questions/486609/how-can-i-use-animation-in-cocos2d/493680#493680)，使用重复的 CABasicAnimation 应用于视图下方的图层。正如我在那里建议的那样，将这些半旋转作为 CAKeyframeAnimation 的一部分可能是构建它的更好方法，因为动画会更平滑（在我的示例中，半旋转之间有轻微的障碍），你可以这样做在开始和结束时有一个很好的加速/减速。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T22:01:41.313

标题回答：是的，CGAffineTransform 可以旋转超过 360 度就好了。
对问题的回答：是的，但是您不能为它设置动画，因为没有任何东西可以设置动画。

请记住，[仿射变换是一个矩阵](http://tinyurl.com/bp2e8x)，而旋转矩阵包含*预先计算*的正弦和余弦数。好像你说：

```
CGFloat angle = 4.0 * M_PI;
NSAffineTransformStruct matrix = {
    .m11 = cos(angle),
    .m12 = sin(angle),
    .m21 = -sin(angle),
    .m22 = cos(angle),
    .tx = 0.0,
    .ty = 0.0
};
NSAffineTransform *transform = [NSAffineTransform transform];
[transform setTransformStruct:matrix]; 
```

`cos`现在，让我们回顾一下and的一些示例值`sin`：

*   `cos(0π)`= 1
*   `sin(0π)`= 0
*   `cos(2π)`= 1
*   `sin(2π)`= 0
*   `cos(4π)`= 1
*   `sin(4π)`= 0

请记住，**矩阵不包含角度——它只包含 cosine 和 sine**。并且这些值不会从一个圆的倍数变为另一个。因此，没有任何动画。

（请注意，Calculator.app 给出 cos(xπ) 和 sin(xπ) 的错误结果。尝试 Grapher、[calc](http://isthe.com/chongo/tech/comp/calc/)或[Google](http://tinyurl.com/aztfkw)。）

您需要将动画分割成一个圆圈的多个部分。布拉德·拉森建议的半圆就可以了。

# javascript - DOM 和 Javascript

> ID：542741
> 
> 赞同：1
> 
> 时间：2009-02-12T18:52:30.100
> 
> 标签：javascript, dom

我让用户重新配置表中一组行的位置，让他们能够上下移动它们。更改是通过交换 DOM 中的节点来完成的。

在用户移动行之后，当我查看源代码时，我看到 HTML 处于原始状态（在用户进行任何更改之前）。

有人可以解释为什么会这样吗？我的理解是，当我们进行任何 DOM 操作时，底层的 HTML 也会发生变化。

**编辑：这是否意味着在服务器端，当尝试在用户更改后获取状态时，我将能够得到我需要的东西？我正在使用 C#/ASP.NET。可能是因为这是一个 HTML 表（不是 ASP.NET 服务器控件），它没有维护更改的状态吗？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:54:17.067

查看源代码时，您正在查看浏览器最初下载的内容。要查看当前状态，请使用像Firefox 的[Firebug](https://addons.mozilla.org/firefox/addon/1843)或IE的[DebugBar这样的插件](http://www.debugbar.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T19:02:26.597

@您的编辑：

除非您有一些脚本告诉服务器更新的顺序是什么（即 javascript 调用服务器端脚本，将新顺序传递给它），否则您的服务器将无法知道用户做了什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:39:54.010

关于。您的编辑 - 不，您必须自己跟踪对行顺序的更改。

我建议你在每一行上放一个 id，然后在提交按钮上点击一些 javascript，查看当时行的顺序，并将它们的 id 的逗号分隔列表放入隐藏的输入字段中。

隐藏输入的内容将被发送到您的服务器：解析它以确定行的顺序。

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T18:54:55.007

这只是您的浏览器不显示更新源的问题。

Firefox 有几个附加组件可以让您在更改发生时查看更改。我建议尝试 Firebug。我相信，来自 MS 的 IE 开发人员工具具有类似的功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T19:13:41.123

对于您问题的第二部分，它不会在服务器端维护这些更改的状态，因为浏览器永远不会将该信息发送回服务器。服务器知道已对 HTML 进行更改的唯一方法是您将有关用户更改的信息发送回服务器。

因此，您可以让页面向服务器发出 AJAX 回调，让其知道对页面进行了哪些更改，或者您可以使用隐藏的表单字段来存储有关 HTML 的元信息（在本例中为表行，将在行顺序更改时更新），然后有一个提交按钮，该按钮将有关所做更改的信息发布回服务器。

服务器无法查看对 DOM 所做的确切 HTML 修改，您已通过将其发送回服务器来提供该信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T19:22:17.670

Firebug 的 DOM 视图向您显示了它当时呈现的确切状态。查看源代码不会。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T20:57:26.100

Google Chrome 有一项功能，您可以右键单击一个元素并选择“检查元素”，它会显示运行时 DOM。

# internationalization - 更改文件编码

> ID：542744
> 
> 赞同：6
> 
> 时间：2009-02-12T18:53:16.710
> 
> 标签：internationalization, character-encoding

我在某些 HTML 页面中遇到字符编码[问题。](https://stackoverflow.com/questions/539661/server-side-includes-and-character-encoding)看来问题的原因是某些 .html 文件没有保存为 UTF-8 编码文件。尽管我已指示 Eclipse 将这些文件保存为 UTF-8，但当我在浏览器中打开它们时，它表明这些文件是 ISO-8859-1。

如何将这些文件的编码更改为 UTF-8？

**更新：**我已经在每个网页的部分中包含以下内容

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
```

我正在使用 Apache Web 服务器。

谢谢， 多纳尔

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T19:39:22.747

您可能需要更改 Web 服务器向客户端发送的内容类型标头。

编辑：虽然这确实适用于这种特殊情况，但在其他情况下使用工具来更改其他海报所建议的文件编码可能是更好的解决方案。YMMV。

* * *

在 Eclipse 中保存为 UTF-8 的说明（我意识到您已经拥有）：

您可能应该更改工作区中 HTML 文档的默认编码。

这适用于 Eclipse 3.4。如果您有不同的版本，这可能会略有不同。

转到窗口->首选项
在首选项窗口中转到常规->内容类型
此时，您可以为首选项窗口底部附近的文件指定“默认编码”。展开“文本”并选择 HTML。在“默认编码”条目中，输入 UTF-8。然后点击右侧的“更新”。

此后，所有 HTML 文件都应以 UTF-8 格式保存。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T19:02:35.830

UTF-8 的问题在于这些文件的开头没有神奇的字节序列 - 浏览器检测 UTF-8 的唯一机会是通过 XML 声明、HTML 元标记或一些启发式方法作为后备。

确保在 HTML 的标头中有 XML 编码声明或一些 HTML 元标记。

```
<?xml version="1.0" encoding="utf-8"?> 
```

如果是 XHTML，则在 DOCTYPE 下方，或者

```
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
```

在头部。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T19:03:27.700

您可以使用[iconv](http://www.gnu.org/software/libiconv/)将文件从一种字符编码转换为另一种。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T19:03:52.940

尝试添加

```
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
```

到您的 html 文件的 head 部分，或确保您的服务器使用 Content-Type http 标头提供文件。如果没有这些，浏览器只能猜测字符编码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-14T11:16:53.167

在 Eclipse 3.7 中，转到：

Windows > 首选项 > 常规 > 工作区

在“文本文件编码”下设置您需要的文件编码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T20:00:05.257

据我所知，在 Eclipse 中设置字符编码实际上并不转换文件——它只是告诉 Eclipse 你希望如何解释它们。最好的办法是使用 Adam 建议的转换器工具。

# flash - Flash 开发 - 发布

> ID：542747
> 
> 赞同：2
> 
> 时间：2009-02-12T18:54:11.763
> 
> 标签：flash, actionscript-3

我正在使用 Flash Develop，并且创建了一个 ActionScript 3.0 项目。它启动并读取一个 xml 文件，其中包含图像的 url。我已将 url 保留在与 swf 相同的文件夹中。好的，所以我发布了，我有一个编译好的 SWF，它在 bin 文件夹中。如果我然后复制这个文件夹，例如通过发布文件夹，swf 不会启动，我没有收到任何警告或任何东西，我已经复制并粘贴了包含已编译 swf 的 bin 文件夹。我检查了 swf，它包含我创建的所有包。任何人都知道为什么当我将 bin 文件夹复制到其他地方时它不会播放？

干杯，

安德鲁

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T19:32:49.470

您必须告诉 Adob​​e Flash Player 您的应用程序是受信任的，即它可以访问本地文件。仅当您使用 file:// 协议访问闪存程序时才需要这样做；将其上传到 Web 服务器后，它将顺利运行。

要授予对 flash 程序的本地访问权限，请打开`My Documents\Application Data\Macromedia\Flash Player\#Security\FlashPlayerTrust\`目录，创建一个名为 的文本文件`<MyFlashApp>.cfg`，然后将包含 flash 程序的目录路径粘贴到此文件中。因此，该文件应包含一行，不需要尾随反斜杠。（我不知道这条路径的 Unix 对应物是什么。）

FlashDevelop 会自动为您创建的每个 Flash 项目执行此操作。

# asp.net - 通过 jQuery 将更多的 Web 表示逻辑移动到 javascript

> ID：542759
> 
> 赞同：4
> 
> 时间：2009-02-12T18:58:05.873
> 
> 标签：asp.net, javascript, jquery

我正在 asp.net 中构建一个新的基于 Web 的应用程序。我们的后端有返回 JSON 的现有 WCF/REST 服务。我还有一个 JavaScript 库，它为我在客户端调用/使用这些 JSON 服务。这使应用程序能够进行客户端 AJAX 调用并执行客户端转发器之类的操作（Rick Strahl 已发布关于使用 jQuery 执行此操作的帖子）。这很好用，并提供了一种活泼的 web 2.0 感觉。

问题是，考虑到我拥有的后端和一个用于管道的 JS 库——我是否应该完全在客户端构建所有主要的列表控件和其他功能？我已经用这个构建了几页，在我的代码中看不到任何东西有点令人不快！我正在尝试就这种方法的优缺点发表意见。

同样，构建了 JS 库，构建了后端 - 所以这只是我应该使用 jQuery（客户端转发器等）还是更传统的服务器端方法来构建页面和逻辑的问题。

非常欢迎提出想法和建议！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T19:40:01.013

在客户端构建所有内容肯定会产生一些负面影响。它可能会给使用屏幕阅读器的视力受损用户带来问题——阅读器通常支持部分但不是全部的 javascript。至少值得使用屏幕阅读器尝试该网站。我相信它也会影响搜索引擎索引——GoogleBot 或类似的网络爬虫不会在页面上看到任何东西。

我用过一些以这种方式工作的调查软件，我也可以说它让客户端的调试变得相当痛苦。

可以有一个中间地带，其中页面的基本结构正常加载，表格和列表使用 AJAX 加载，并带有可用链接（对于使用 javascript 的用户将隐藏）以重新加载所有数据存在的页面.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:11:24.267

您能否确保您的受众在浏览您的网站时始终启用 JavaScript？如果你能提出这个要求，那么如果你认为这会更容易，那就继续用 JS 做前端。如果你不能保证，那么你需要在服务器端进行，这样没有 JavaScript 的用户就可以真正看到输出。你不希望人们看到一堆什么都没有，对吧？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T01:47:40.803

这是一个很好的问题，我也在努力解决。我目前关心的只是我们同时控制客户端和服务器的 Intranet 情况。在这些情况下，我的感觉是最好采取中间立场。我认为其他开发人员可以查看 .aspx 并理解页面的要点很重要。

例如，如果需要显示一个数据表，那么不要将其作为 json 发送出去，然后在客户端进行模板化，这样就不能很好地显示意图，而是将其作为普通的 ASP.NET datagrid html 片段发送。位于 .aspx 上的数据网格至少显示了显示表格数据的意图。而且这样做可能也更容易。

现在，假设您想要显示一个非常精美的数据网格，仅使用 ASP.NET 很难做到这一点。我仍然会将它作为一个简单的数据网格发送，因为 jQuery 可以在客户端上对其进行切片和切块，而不是 ASP.NET 在服务器上可以轻松得多。并且可能这也会节省一些带宽。（哦，我总是关闭所有 ViewState！）我尝试让 ASP.NET 来做语义，以及它擅长的简单的事情，而让 jQuery 来做剩下的事情。

在实践中，事情变得更加复杂和模糊。作为一个长期从事 Model View Presenter 的人，我开始将 View 和 Presenter 视为存在于客户端上。.aspx 页面只是显示页面要点的模板。代码隐藏 (.aspx.cs) 只不过是委托给模型的一个薄层。

虽然我对这种架构的结果非常满意，但我仍然对它隐约感到不舒服，主要是因为我无法使用可靠的旧 NUnit 对演示者进行单元测试，而且还因为 jQuery 和 JavaScript 如此强大以至于它就像在玩炸药。

通常的架构专家都沉默了，这一切都太新了。我 100% 肯定，很多人早在 30 年前就已经准确地研究过这种情况，而且迟早会在你所看到的任何地方详细讨论。但这是我们现在所处的一个非常有趣的情况，我希望更多的人愿意投入他们的 2 美分。马丁福勒在哪里？斯科特·贝尔韦尔？鲍伯叔叔？

麦克风

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:15:40.807

我对这种方法很感兴趣。它允许您匆忙显示页面并懒惰地显示存储库中的列表和其他内容。

# sql - 每条记录都有 StartDate 和 EndDate 。在这两个字段中使用时，我应该给 NULL 一个特殊的含义吗？

> ID：542760
> 
> 赞同：3
> 
> 时间：2009-02-12T18:58:11.160
> 
> 标签：sql, database-design

所以，我有一个表，其中 StartDate 和 EndDate 用于确定记录的活动性。我想使用 NULL 来让维护者不必为某些记录制造一些疯狂的日期。例如，如果在 EndDate 中使用 NULL 时定义为正无穷大，那么数据维护者就不需要为长期记录提出类似 1-1-2100 的内容。

我可以自己推测一些权衡：将 NULL 定义为无穷大意味着更清洁的数据和消除定期维护工作，但这也意味着更长的查询和存储过程。所以我想知道你们在现实世界中是如何看待这个问题的。

编辑：意见大约是一半。如果我已经澄清 StartDate 和 EndDate 仅用于确定 where 子句中记录的活动性，并且从未出现在选择列表中，那会倾斜吗？我需要阅读的一个主题可能是索引。谢谢大家。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T19:12:56.307

如果您的记录中的任何一个是`StartDate`，那么以下条件：`EndDate``NULL`

```
BETWEEN StartDate AND EndDate 
```

永远不会匹配这个记录。

您需要执行以下操作：

```
BETWEEN IFNULL(StartDate, '01.01.1000') AND IFNULL(EndDate, '01.01.3000') 
```

，当然，这对索引不利。

当然，您可以创建一个基于函数的索引，但无论如何您都需要为其提供一个常量。

*总结：如果你想要性能，使用常量，不要使用 NULL*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T19:03:27.250

我之前为此目的使用过 NULL 没有任何问题，但我还没有开发过任何大规模的应用程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T19:27:50.623

NULL 已经有了意义，将 NULL 解释为有效数据值会导致歧义。当查询运行并返回数据时，结果 NULL 的含义是什么？如何区分失败状态和有效 Max 状态？

定义最小和最大常量，让 Null 为 Null。

很棒的评论：
**@Haoest** - 你说得对，一个 Null 与一组 Null 不一样，我并不清楚。SQL 在处理 Null 时的行为将需要更多代码来进行更多检查。SQL 在查找 Null 时的结果可能与程序员的直觉[NULL(SQL)](http://en.wikipedia.org/wiki/Null_(SQL))不匹配。
**@ MBCook** - 很棒的链接，希望我自己发布 - 谢谢

更新：一旦查询或函数在该日期有 Null，那么您将不再知道 Null 是否已分配，因为它意味着 Max 或因为 Null 已在查询中传播。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T19:04:29.210

在这种情况下，我肯定会使用 null 。存储过程和查询没什么大不了的。

如果你有一个像'2100-01-01'这样的值，那么只要看看它，我会认为它是一个有效值。如果我看到 NULL，我认为它具有特殊含义（除了缺乏价值，尽管有时，仅此而已，这很好）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T19:05:46.633

我倾向于使用定义的最小和最大日期而不是空值。主要是因为，至少在 C# 中，当您从数据库中获取数据时，您必须开始处理 Nullable 类型，我觉得这很烦人。

它还倾向于使查询更容易。如果我使用 Max 的结束日期进行查询，那么我会得到所有具有最大结束日期的日期，以及所有结束日期小于 max 的日期，这通常是我想要的。如果我有空值，那么我必须进行连接以获取小于最大值和空值的日期。希望这是有道理的。

我想，最重要的是，我是从开发人员的可用性的角度来解决这些问题，而不是数据库用户，所以这就是我的观点所在。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T19:06:54.650

我会说你自己的猜测是非常正确的。这确实是一种权衡类型的情况。

我个人的偏好是不允许在日期类型字段中使用 NULL，并且始终使用“高值”来表示结束日期。对我来说，这极大地简化了我必须针对开始/结束日期执行的所有查询，并防止我在多个查询中进行大量 NULL 检查。

也就是说，这取决于应用程序。如果我必须在日期字段中有 NULL，我会使用它们，但如果我可以用真实的日期代替，我会的。当然，使用真实日期的缺点是它只是一个*真实*日期，并且不再具有 NULL 的标准数据库定义，即*没有*数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T21:53:26.247

我会尝试尽可能长时间地使用 NULL 值。

我对 EndDate 列中的 NULL 的理解是，到目前为止还没有定义结束日期。这与从开始日期到结束日期有效的记录是一致的。

我同意你不能直接指定的 Quassnoi

```
BETWEEN StartDate AND EndDate 
```

但不是他的建议（这使得使用索引/索引变得困难），这个也可以：

```
(somedate >= StartDate or StartDate is null)
AND
(somedate <= EndDate or EndDate is null) 
```

AFAIK 这将允许使用索引，但请检查您的具体情况的执行计划。

使用“特殊”开始/结束日期的缺点是可执行性。如果您所有的数据库访问都是通过具有或多或少强制性库的特定程序语言，您也许可以完成这项工作。但是，如果您有不同的访问路径（直接 SQL、不同的语言/库），这将很难做到。

可能还有第三种方法：对 DML 语句使用 NULL，然后将触发器更改为预定义的最小值/最大值。那么选择可能会更容易。但是使用触发器正在打开另一罐蠕虫......

我的结论：这种情况是数据库 NULL 的一个不错的用途。根据我的经验，我还没有遇到严重的性能问题。但我同意额外的 NULL 处理有点麻烦。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T19:07:02.670

我认为使用 null 比一些任意的特殊值更好。如果没有别的，看到一个空值会让你停下来思考它可能意味着什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T19:10:04.173

如果您确实使用“结束日期”字段（甚至“开始日期”字段）的默认“系统”日期，请确保在代码（可能还有数据库架构）的某处记录这些日期的含义。这将使那些追随您的人更容易理解其他任意日期的含义。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-12T19:27:44.787

如果您在数据库中使用 NULL 日期，请确保使用 DateTime？（可为空的 C#）在您的代码中，这将使您的生活更轻松:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-06-09T00:48:13.127

在您的数据库中使用 NULL 日期。使用日期时间？在您的 C# 代码中。

避免使用魔法值。

# debugging - Flex Builder，调试 - 自动日志控制台输出

> ID：542761
> 
> 赞同：0
> 
> 时间：2009-02-12T18:58:12.377
> 
> 标签：debugging, logging, console, flexbuilder

我可以让 Flex Builder 将控制台窗口中的所有输出存储到日志文件吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-20T12:05:01.370

转到运行/调试配置，选择“通用”选项卡。

在此页面上，您会找到一个复选框，允许您将输出发送到文件

# c# - C# 将字符串转换为其等效的 byte[]

> ID：542766
> 
> 赞同：7
> 
> 时间：2009-02-12T19:00:23.463
> 
> 标签：c#, string, encoding, hex, byte

在这一点上，大多数人会想“啊，我发这个……”

```
byte[] dataB= System.Text.Encoding.ASCII.GetBytes(data); 
```

但是..我遇到的问题是我需要字节的确切值，而无需编码，只需要每个字节的纯值。例如，如果字符串的值为 (0xFF32)，我希望它也将其转换为 {255,50}。他这样做的原因是我有一个文件格式，我正在尝试读取将 int 存储为字节的文件格式保存它们，然后在程序打开时读取它们。

这是我到目前为止所拥有的：

```
...
dialog.InitialDirectory =
    Environment.GetFolderPath(System.Environment.SpecialFolder.Desktop) +
    "/Test";

dialog.Title="Open File";

if (dialog.ShowDialog(this) == DialogResult.OK)
{
    StreamReader reader = new StreamReader(dialog.FileName);
    string data = reader.ReadToEnd();
    reader.Close();
    byte[] fileC = System.Text.Encoding.ASCII.GetBytes(data);
    File_Read(dialog.FileName,fileC);
}
... 
```

因此，当我尝试读取文件时，它会将 0xFF 的文件转换为 0x3F，因为 0xFF 大于 127 并且 0x3F 是一个？。

对不起，如果我看起来有点困惑:)

谢谢，迈克尔

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-12T19:05:53.203

问题在于您的方法开始：

> 我需要没有编码的字节的确切值

...

> 例如，如果字符串的值为 (0xFF32)

这有点像看着一幅油画并说，“我想要那幅画的字节，没有编码。” 这没有意义。文本与二进制数据不同。一旦你明白了这一点，就很容易找到问题的根源。您真正想要的是*文件*的内容作为字节数组。这很简单，因为文件是二进制数据！如果它不是真正的文本，你不应该首先将它作为文本阅读。幸运的是，.NET 使这变得非常容易：

```
byte[] fileC = File.ReadAllBytes(dialog.FileName); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-12T19:02:25.253

> 但是..我遇到的问题是我需要字节的确切值，而无需编码，只需要每个字节的纯值。

然后使用这个：

```
byte[] dataB = System.Text.Encoding.Unicode.GetBytes(data); 
```

它返回由 .NET 字符串内部存储的字节。

但这一切都是 codswallop：一个字符串*总是*链接到一个特定的编码，没有办法绕过它。例如，如果文件包含无效的 Unicode 代码序列（可能会发生）或通过规范化，上述操作将失败。既然你显然不*想要*一个`string`，就不要读一个。改为将文件作为二进制数据读取。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-05-07T09:36:35.217

//将字符串转换为字节数组

```
public static byte[] StrToByteArray(string str)
{
    System.Text.UTF8Encoding  encoding=new System.Text.UTF8Encoding();
    return encoding.GetBytes(str);
} 
```

//将字节数组转换为字符串

```
public string ByteArrayToStr(byte [] dBytes)
{
System.Text.UTF8Encoding enc = new System.Text.UTF8Encoding();
return enc.GetString(dBytes);
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T19:01:59.733

使用[BinaryReader](http://msdn.microsoft.com/en-us/library/ms143295.aspx)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T19:05:52.437

为什么要从字符串转换？你不能直接把文件的内容读成字节吗？

```
byte[] fileC = File.ReadAllBytes(dialog.FileName); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T19:05:44.747

如果您想要字节，请使用 Stream！

你到底为什么要搞乱TextReader？

编辑：

根据您的示例，您正在打开一个文件，因此只需使用 FileStream。

# java - 文本替换效率

> ID：542770
> 
> 赞同：4
> 
> 时间：2009-02-12T19:01:46.160
> 
> 标签：java, string, performance

我之前的问题的扩展：
[文本清理和替换：从 Java 中的文本中删除 \n](https://stackoverflow.com/questions/542226/text-cleaning-and-replacement-delete-n-from-a-text-in-java)

我正在清理这个传入的文本，它来自一个带有不规则文本的数据库。这意味着, 没有标准或规则。一些包含 HTML 字符，如 ®、&trade、<，而另一些则以这种形式出现：”、– 等。其他时候，我只使用 < 和 > 获取 HTML 标记。

我正在使用 String.replace 按其含义替换字符（这应该没问题，因为我使用的是 UTF-8 对吧？），并使用 replaceAll() 使用正则表达式删除 HTML 标签。

除了为每个替换调用 replace() 函数并编译**HTML**标记正则表达式之外，是否有任何建议可以使这种替换有效？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T19:23:32.723

我的第一个建议是衡量最简单的方法的性能（可能是多次 replace/replaceAll 调用）。是的，它可能效率低下。通常最简单的方法是低效的。你需要问自己：**你有多在乎？**

您是否有样本数据和性能可接受的阈值？如果你不这样做，那是第一个停靠港。然后测试朴素的实现，看看它是否真的*有*问题。（请记住，字符串替换几乎肯定只是您正在做的事情的*一部分*。当您从数据库中获取文本开始时，这很*可能*最终成为瓶颈。）

一旦您确定替换确实是瓶颈，就值得进行一些测试以查看替换的哪些*部分*导致了最大的问题 - 听起来您正在执行几种不同类型的替换。你越能缩小范围越好：你可能会发现最简单的代码中真正的瓶颈是由一些很容易以*相当*简单的方式提高效率的东西引起的，而试图优化*一切*会困难得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T19:18:21.347

用 replaceAll 替换会遇到性能瓶颈。

如果你想提高性能

1.  不要使用替换 - 字符串是不可变的。每次调用替换时都会创建副本
2.  不要使用正则表达式（replaceAll）——尽管被编译它并没有那么糟糕。
3.  使用 StringBuilder 解析和替换您自己的字符串

您这边的一些代码可能有助于讨论。

```
String str = ...
StringBuilder sb = new StringBuilder();
for (int i = 0; i < str.length(); i++) {
  char toAppend = 'a';
  switch (str.charAt(i)) {
     case '&' : toAppend = '&'; break;
     case ...
      ...
      default: toAppend = str.charAt(i);
    }
   sb.append(toAppend);
  } 
```

这是来自：[太阳论坛](http://forums.sun.com/thread.jspa?threadID=723094&start=0&tstart=0)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T19:52:20.733

字符串替换是Java很慢，我认为你应该使用更快的语言

在这里你有代码示例如何在程序集中替换字符串

[http://szabgab.com/talks/fundamentals_of_perl/replace-string-in-assembly-code.html](http://szabgab.com/talks/fundamentals_of_perl/replace-string-in-assembly-code.html)

# frameworks - 有没有好的基于工作队列的框架？

> ID：542771
> 
> 赞同：3
> 
> 时间：2009-02-12T19:01:48.673
> 
> 标签：frameworks, queue

我一直在考虑编写一个基于工作队列概念的 Web 框架（想想 Struts、Ruby on Rails、Seaside）。我正在寻找是否有人以前做过这样的框架。

我很高兴查看用于处理请求和返回结果的框架，但*不是*Web (HTTP)。我*不是*在寻找一个工作队列系统（想想 Starling、Workling、Amazon 的队列服务、JMS）本身，而是一个在其上运行的处理系统。

我对语言不是那么挑剔；我最感兴趣的是评论和/或经验教训。（因此，仍处于起步阶段的基于队列的系统可能不太受关注。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-15T20:37:39.420

我不确定这是否是您的意思，但听起来很像[Twisted](http://twistedmatrix.com/trac/)。它不公开实际的工作队列，但它以异步工作项为中心。[在此处](http://twistedmatrix.com/projects/core/documentation/howto/async.html)查看延迟的描述

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T06:37:18.543

ASP.Net 的 Windows Workflow Foundation 怎么样？

[http://msdn.microsoft.com/en-us/netframework/aa663328.aspx](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-24T22:48:53.497

查看[beanstalkd](http://xph.us/software/beanstalkd/)或更重量级的消息队列系统，例如[ActiveMQ](http://activemq.apache.org/)

# sql-server - 仅从 SQL Server 中的 DateTime 列中选择分组中获取日期

> ID：542780
> 
> 赞同：11
> 
> 时间：2009-02-12T19:04:06.933
> 
> 标签：sql-server, sql-server-2005

我需要根据日期对一些记录进行分组，但它是一个日期和时间字段，我需要忽略 is 的时间部分，而只按日期部分分组 - 这是我的 SQL 的现状：

```
SELECT   
    AutoShipItems.CustomerID,AutoShipItems.NextOrderDate,
    Customer.FirstName,Customer.LastName, Customer.EmailAddress
FROM        
    AutoShipItems 
        INNER JOIN    Customer ON 
            AutoShipItems.CustomerID =Customer.CustomerID
WHERE     
    (AutoShipItems.NextOrderDate <= GETDATE())
GROUP BY 
    AutoShipItems.CustomerID, AutoShipItems.NextOrderDate, 
    Customer.FirstName, Customer.LastName, 
    Customer.EmailAddress
ORDER BY 
    AutoShipItems.NextOrderDate 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-12T19:08:12.353

您可以按以下方式分组：

```
cast(floor(cast(AutoShipItems.NextOrderDate as float)) as datetime) 
```

我将它放入一个标量用户定义函数中以使其更容易：

```
create function [dbo].[xfn_TrimTimeFromDateTime]
(
    @date as datetime
)
returns datetime with schemabinding as
begin
    --- Convert to a float, and get the integer that represents it.
    --- And then convert back to datetime.
    return cast(floor(cast(@date as float)) as datetime)
end 
```

然后你会这样称呼它：

```
GROUP BY
    AutoShipItems.CustomerID, 
    dbo.xfn_TrimTimeFromDateTime(AutoShipItems.NextOrderDate), 
    Customer.FirstName, Customer.LastName, Customer.EmailAddress 
```

请注意，您可能必须更改 SELECT 子句中的值，因为您现在按不同的东西进行分组。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-12T19:07:17.410

```
cast (x as date) 
```

或者

```
year(x)
month(x)
day(x) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-12-28T12:35:36.977

您可以将[日期](https://msdn.microsoft.com/en-us/library/bb630352.aspx)类型与`convert`或一起使用`cast`。

```
convert(date, @x) 
```

或者

```
cast(@x as date) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T19:13:10.953

那这个呢：

```
select convert(datetime, convert(varchar(10), getdate(), 112)) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T06:45:01.647

如果只是关于分组，您也可以将 datetime 表达式转换为 int。

Simple`CAST(datetime AS int)`实际上将日期时间四舍五入到最近的日期，而不是丢弃时间部分。因此，

```
CAST(datetime - 0.5 AS int) 
```

其他方式：

```
CAST(CAST(datetime AS float) AS int) 
```

（与日期时间不同，浮点数在转换为 int 时会被截断。）

我更喜欢前者，因为它更短。不过，不确定哪个在性能方面更好。不过，这个问题可能只出现在非常大的数据阵列上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T19:12:55.463

有关仅日期函数的三个不同版本，请参阅[此链接](http://www.sql-server-helper.com/functions/get-date-only.aspx)。这是我最终使用的一个：

```
CREATE FUNCTION [dbo].[fn_GetDateOnly]  ( @pInputDate    DATETIME )
RETURNS DATETIME
BEGIN

    RETURN CAST(CONVERT(VARCHAR(10), @pInputDate, 111) AS DATETIME)

END 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T19:13:53.620

您也可以只使用普通的旧 SQL 转换函数。最后一个参数允许您提供预定义的日期格式，其中一些会删除时间。这是修改后的查询。

```
SELECT    AutoShipItems.CustomerID, convert(nvarchar(10), AutoShipItems.NextOrderDate, 110) as NextOrderDate ,Customer.FirstName,Customer.LastName, 
                     Customer.EmailAddress
FROM        AutoShipItems INNER JOIN
                     Customer ON AutoShipItems.CustomerID =Customer.CustomerID
WHERE     (AutoShipItems.NextOrderDate <= GETDATE())
GROUP BY AutoShipItems.CustomerID, convert(nvarchar(10), AutoShipItems.NextOrderDate, 110) , Customer.FirstName, Customer.LastName, 
                     Customer.EmailAddress
ORDER BY AutoShipItems.NextOrderDate 
```

# ruby-on-rails - 使用带有 %s 和 % 以及多个字符串替换参数的 print 而不是 sprintf

> ID：542787
> 
> 赞同：1
> 
> 时间：2009-02-12T19:05:46.307
> 
> 标签：ruby-on-rails, ruby, string, syntax, printing

在以下 ruby​​ 代码中，输出变为：“x y”

```
x = "x %s"
y = "y"
z = "z"
print x % y %z 
```

%z 被忽略。

我希望输出为“xy z”。

**为了理解 Ruby 语法的可能性和限制，我只想使用 print 命令以及 %s 和 % 标志**。我知道如何使用 sprintf 来做到这一点，但我想知道是否有办法只使用“打印”命令来做到这一点。

所以我尝试在变量“x”的定义中添加第二个 %s：

```
x = "x %s %s"
y = "y"
z = "z"
print x % y %z 
```

但我得到了这个错误：

```
in `%': too few arguments (ArgumentError) 
```

使用 sprintf 你可以这样做：

```
x = "x %s %s"
y = "y"
z = "z"
print (sprintf(x, y, z)) 
```

输出将是我想要的：

```
x y z 
```

但这太容易了。

***有没有办法只用'print'（不是sprintf）而不使用#{}或将y和z组合成一个数组作为[y，z]？***

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T19:09:24.317

我实际上不明白你想做什么，但是：

```
irb(main):001:0> x = "x %s"
=> "x %s"
irb(main):002:0> y = "y %s"
=> "y %s"
irb(main):003:0> z = "z"
=> "z"
irb(main):004:0> print x % y % z
x y z=> nil 
```

和：

```
irb(main):006:0> x = "x %s %s"
=> "x %s %s"
irb(main):007:0> y = "y"
=> "y"
irb(main):008:0> z = "z"
=> "z"
irb(main):009:0> x % [y,z]
=> "x y z" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T19:13:29.423

使用`print "x #{y} #{z}"`.

我无法通过 Google 轻松找到很多[文档](http://www.ruby-doc.org/core/classes/Kernel.html#M005993)......但是这里有一些页面展示了这种用法：

[http://www.rubycentral.com/pickaxe/tut_expressions.html](http://www.rubycentral.com/pickaxe/tut_expressions.html)

[http://linuxgazette.net/issue81/ramankutty.html](http://linuxgazette.net/issue81/ramankutty.html)

[http://metacpan.org/pod/Inline::Ruby](http://metacpan.org/pod/Inline::Ruby)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T20:31:17.367

共识似乎是您无法避免使用 #{} 替换语法。并且 % 符号似乎仅在您使用数组 [y,z] 将两个变量组合成一个单元时才有效。

我真正想要的，虽然是某种方式来做到这一点：

打印 x % y, z

没有将 y 和 z 变量合二为一。

也许这是不可能的，您要么必须：

1.  使用 #{} 替换
2.  将 y 和 z 组合成一个数组，然后调用 print x % [y,z]
3.  像这样使用 sprintf： print (sprintf(x, y, z))

并将 x 定义为：

x = "x %s %s"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:52:27.223

这可能是你想要的吗？：

```
irb(main):001:0> x = "x %s %s"
=> "x %s %s"
irb(main):002:0> y = "y"
=> "y"
irb(main):003:0> z = "z"
=> "z"
irb(main):004:0> print x % [y,z]
x y z=> nil 
```

# reporting-services - 将布尔类型的参数从 SSRS 传递到 PL/SQL

> ID：542793
> 
> 赞同：2
> 
> 时间：2009-02-12T19:06:27.960
> 
> 标签：reporting-services, types, boolean

您能否告诉我是否有办法将布尔类型的参数从报告服务传递到 PL/SQL？我尝试在 PL/SQL 中使用布尔数据类型，但这不允许我创建数据集。

我的报告有一个单选按钮，要求按 asc 或 desc 排序。我正在考虑从程序方面对其进行排序。我的报告没有任何分组。我可以在 SSRS 端使用这个值对表格进行排序吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-13T12:16:43.940

如果您想在 SQL 语句中使用参数值，您可能会尝试的一件事是拥有一个可用于更改 SQL 语句的参数。例如，有一个名为 SortOrder 的字符串参数，它允许项目（非查询）：

```
Value    Label
--------------------
ASC      Ascending
DESC     Descending 
```

然后您可以使用它来更改您的 SQL 语句。您的 SQL 语句可以作为字符串传递，因此您的数据源可能如下所示：

```
="SELECT * "
&"FROM MyTable "
&"ORDER BY SomeField " & Parameters!SortOrder.Value 
```

如果您真的想使用单选按钮，那么您可以执行以下操作：

```
="SELECT * "
&"FROM MyTable "
&"ORDER BY SomeField " & IF(Parameters!SortOrder.Value, "ASC", "DESC") 
```

# asp.net - 运行计划任务的最佳方式

> ID：542804
> 
> 赞同：236
> 
> 时间：2009-02-12T19:08:45.317
> 
> 标签：asp.net, windows, iis, scheduled-tasks

今天，我们构建了一个控制台应用程序，用于为我们的 ASP.NET 网站运行计划任务。但我认为这种方法有点容易出错并且难以维护。你如何执行你的计划任务（在 windows/IIS/ASP.NET 环境中）

更新：

任务示例：

*   从数据库中的电子邮件队列发送电子邮件
*   从数据库中删除过时的对象
*   从 Google AdWords 检索统计信息并在数据库中填写表格。

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-02-12T19:13:16.337

[Jeff Atwood 为 Stackoverflow 提供的这项技术](https://blog.stackoverflow.com/2008/07/easy-background-tasks-in-aspnet/)是我遇到的最简单的方法。它依赖于 ASP.NET 缓存系统中内置的“缓存项已删除”回调机制

更新： Stackoverflow 已经超越了这种方法。它仅在网站运行时有效，但它是一种非常简单的技术，对许多人都很有用。

另请查看[Quartz.NET](http://quartznet.sourceforge.net/)

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2009-02-12T19:16:51.693

我所有的网站任务（需要安排）都保存在网站内，并从一个特殊页面调用。然后我编写了一个简单的 Windows 服务，它每隔一段时间就会调用这个页面。一旦页面运行，它就会返回一个值。如果我知道还有更多工作要做，我会立即再次运行该页面，否则我将在稍后运行它。这对我来说非常有效，并将我的所有任务逻辑都保留在 Web 代码中。在编写简单的 Windows 服务之前，我使用 Windows 调度程序每 x 分钟调用一次页面。

运行它的另一种便捷方法是使用[Pingdom 之](http://pingdom.com)类的监控服务。将他们的 http 检查指向运行您的服务代码的页面。让页面返回结果，然后可用于触发 Pingdom 在出现问题时发送警报消息。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-02-12T20:01:23.053

创建[自定义 Windows 服务](https://msdn.microsoft.com/en-us/library/zt39148a(v=vs.110).aspx)。

我将一些关键任务任务设置为计划的控制台应用程序，但发现它们难以维护。我创建了一个带有“心跳”的 Windows 服务，它会每隔几分钟检查一次我的数据库中的时间表。效果非常好。

话虽如此，我仍然使用计划的控制台应用程序来完成大多数非关键维护任务。如果它没有坏，就不要修理它。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-02-13T02:33:51.910

我发现这对所有相关人员来说都很容易：

*   创建 Web 服务方法，例如 DoSuchAndSuchProcess
*   创建一个调用此 Web 方法的控制台应用程序。
*   在任务计划程序中计划控制台应用程序。

使用这种方法，所有业务逻辑都包含在您的 Web 应用程序中，但您可以使用 Windows 任务管理器或任何其他商业任务管理器来启动它并记录任何返回信息，例如执行报告。使用 Web 服务而不是发布到页面有一点优势，因为从 Web 服务获取返回数据更容易。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-10-22T13:33:36.077

为什么要重新发明轮子，使用 Threading 和 Timer 类。

```
 protected void Application_Start()
    {
        Thread thread = new Thread(new ThreadStart(ThreadFunc));
        thread.IsBackground = true;
        thread.Name = "ThreadFunc";
        thread.Start();
    }

    protected void ThreadFunc()
    {
        System.Timers.Timer t = new System.Timers.Timer();
        t.Elapsed += new System.Timers.ElapsedEventHandler(TimerWorker);
        t.Interval = 10000;
        t.Enabled = true;
        t.AutoReset = true;
        t.Start();
    }

    protected void TimerWorker(object sender, System.Timers.ElapsedEventArgs e)
    {
        //work args
    } 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-03-29T16:32:01.873

使用 Windows 调度程序运行网页。

为了防止恶意用户或搜索引擎蜘蛛运行它，当您设置计划任务时，只需使用查询字符串调用网页，即：mypage.aspx?from=scheduledtask

然后在页面加载中，只需使用一个条件： if (Request.Querystring["from"] == "scheduledtask") { //executetask }

这样，任何搜索引擎蜘蛛或恶意用户都无法执行您的计划任务。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-02-04T17:30:10.147

这个库就像一个魅力 [http://www.codeproject.com/KB/cs/tsnewlib.aspx](http://www.codeproject.com/KB/cs/tsnewlib.aspx)

它允许您通过 .NET 代码直接管理 Windows 计划任务。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-13T17:13:49.500

此外，如果您的应用程序使用 SQL SERVER，您可以使用 SQL 代理来安排您的任务。这是我们通常放置重复出现的数据驱动代码（电子邮件提醒、计划维护、清除等）的地方。SQL 代理内置的一个很棒的功能是失败通知选项，它可以在关键任务失败时提醒您。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-12T19:12:50.643

我不确定您的意思是哪种计划任务。如果您的意思是“每小时刷新 foo.xml”类型的任务，请使用 Windows 计划任务系统。（“at”命令，或通过控制器。）让它运行控制台应用程序或请求启动该过程的特殊页面。

编辑：我应该补充一点，这也是让您的 IIS 应用程序在预定点运行的好方法。因此，假设您想每 30 分钟检查一次数据库并向用户发送有关某些数据的电子邮件提醒，您可以使用计划任务来请求此页面，从而让 IIS 处理事物。

如果您的需求更复杂，您可能会考虑创建一个 Windows 服务并让它运行一个循环来执行您需要的任何处理。这还具有分离代码以进行扩展或管理目的的好处。不利的一面是，您需要处理 Windows 服务。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-12T19:13:56.803

如果您拥有服务器，则应使用 Windows 任务调度程序。使用 AT/? 从命令行查看选项。

否则，在基于 Web 的环境中，您可能不得不做一些令人讨厌的事情，例如设置另一台机器以按时间间隔向某个页面发出请求。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-12T19:43:05.030

我已经在一个 ASP.NET 项目中成功使用了[Abidar （这里有一些](http://nayyeri.net/blog/abidar-1.0-beta-1/)[背景信息](http://nayyeri.net/blog/abidar-1.0-beta-1/)）。

此方法的唯一问题是，如果 ASP.NET Web 应用程序从内存中卸载（即由于使用率低），任务将无法运行。我尝试过的一件事是创建一个任务，每 5 分钟访问一次 Web 应用程序，使其保持活动状态，但这似乎不能可靠地工作，所以现在我使用 Windows 调度程序和基本控制台应用程序来代替它。

理想的解决方案是创建 Windows 服务，尽管这可能是不可能的（即，如果您使用的是共享托管环境）。从维护的角度来看，它还使事情变得更容易，以便将内容保留在 Web 应用程序中。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-12T19:18:30.707

这是另一种方式：

1) 创建一个“心跳”web 脚本，负责在任务到期或逾期启动时启动它们。

2）在某处（最好在同一Web服务器上）创建一个预定进程，该进程命中webscript并强制它定期运行。（例如，使用 IE 或 whathaveyou 悄悄启动 heatbeat 脚本的 windows 调度任务）

任务代码包含在 Web 脚本中的事实纯粹是为了将代码保留**在**Web 应用程序代码库中（假设两者相互依赖），这对于 Web 开发人员来说更容易管理.

另一种方法是创建一个可执行的服务器脚本/程序，它自己完成所有计划工作，并将可执行文件本身作为计划任务运行。这可以允许 Web 应用程序和计划任务之间的基本解耦。因此，如果您需要在 Web 应用程序/数据库可能已关闭或无法访问的情况下运行计划任务，您应该采用这种方法。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-08-04T18:36:49.993

您可以使用“ThreadPool.RegisterWaitForSingleObject”方法轻松创建间隔运行代码的 Windows 服务。它真的很流畅，很容易设置。与使用框架中的任何计时器相比，此方法是一种更简化的方法。

请查看以下链接以获取更多信息：

**使用 Windows 服务在 .NET 中运行定期进程：http:**
[//allen-conway-dotnet.blogspot.com/2009/12/running-periodic-process-in-net-using.html](http://allen-conway-dotnet.blogspot.com/2009/12/running-periodic-process-in-net-using.html)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-12T19:13:31.110

我们也使用控制台应用程序。如果您使用 Log4net 等日志工具，您可以正确监控它们的执行。此外，我不确定它们如何比网页更难维护，因为如果设计得当，您可能会在两者之间共享一些相同的代码库。

如果您反对让这些任务定时运行，您可以在网站的管理部分中有一个网页作为队列。用户提出运行任务的请求，然后它会在 MyProcessQueue 表中插入一个空白的时间戳记录，并且您的计划任务每​​ X 分钟检查一次 MyProcessQueue 中的新记录。这样，它只在客户希望它运行时运行。

希望这些建议有所帮助。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-12T19:15:53.817

一种选择是设置 Windows 服务并让它调用您的计划任务。

在我使用过的 Winforms 中，Timers put 认为这在 ASP.NET 中效果不佳

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2010-04-25T11:42:36.387

.NET 的新任务计划程序类库

注意：自创建此库以来，Microsoft 为 Windows Vista 引入了新的任务计划程序（Task Scheduler 2.0）。该库是 Task Scheduler 1.0 接口的包装器，该接口在 Vista 中仍然可用，并且与 Windows XP、Windows Server 2003 和 Windows 2000 兼容。

[http://www.codeproject.com/KB/cs/tsnewlib.aspx](http://www.codeproject.com/KB/cs/tsnewlib.aspx)

# sql-server - 我应该如何处理每小时发生的更新？

> ID：542825
> 
> 赞同：0
> 
> 时间：2009-02-12T19:14:39.453
> 
> 标签：sql-server, database-design

我有一张桌子：

加州

*   ca_id
*   安置_id
*   废话
*   废话

该表每小时都​​会从数据仓库中更新新的唯一位置。现在，最终用户想要跟踪这些展示位置的状态。

我正在考虑添加一个每小时更新一次的新表：

CA_状态

*   安置_id
*   记录状态
*   last_updated_on

选项1：

向placement_id 添加唯一约束。实现一些机制（可能是触发器？），如果放置存在，则更新 record_status 和 last_updated_on 字段。如果没有创建新记录。然后我可以通过placement_id 将它与CA 表连接起来，并获取每个展示位置的最新状态。

选项 2

我可以在placement_id 上转储唯一约束。这将使表格随着任何展示位置的最新记录状态增长。当我加入时，我`MAX(last_updated_on)`可以获得最新的记录状态。

选项 3：

将 CA_Status 表全部转储到一起。将新属性添加到 CA 表并执行类似于选项 1 的操作

如果选项 1 触发了要走的路？

如果选项 2 这会使我的桌子不必要地变大。

* * *

更新：我想使用选项 1 我真的不需要 CA_Status 表。我可以将这些字段合并到 CA 表中并相应地更新。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T19:19:34.323

我的投票是选项 1。只要确保如果您对小时性能进行大量更新，触发器不会对触发器造成巨大影响。

什么将更新发送到数据库？如果它是一个书面程序，它将需要更多的数据库调用来排列所有鸭子以这种方式插入/更新 CA_Status。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T19:21:46.410

在 MS SQL 2005 及更高版本中，您可以增长表并像这样选择：

```
SELECT placement_id, update_time, anything_else
FROM (
  SELECT m.*, ROW_NUMBER() OVER (PARTITION BY placement_id ORDER BY update_time) AS rn
  FROM mytable m
  ) mo
WHERE rn = 1 
```

这是最有效的，因为这将使用索引扫描，没有连接和触发器。

当然，如果您使用`MS SQL 2008`并且不想保留历史记录，您可以像这样添加数据：

```
MERGE
INTO mytable
USING VALUES(@new_id, @new_time, @new_data)
ON placement_id = @new_id
WHEN MATCHED THEN
 UPDATE
 SET update_time = @new_time,
     anything_else = @new_data
WHEN NOT MATCHED THEN
 INSERT (placement_id, update_time, anything_else)
 VALUES(@new_id, @new_time, @new_data) 
```

如果该位置不存在，这将插入该位置，如果存在则更新它 - 仍然没有 tirggers。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-28T16:15:06.673

由于您可以完全控制该过程，因此选项 3 对我来说似乎是最简单的。

record_status 和 last_updated_on 到 CA 表中，并将这些字段包含在您的 INSERT 语句中。

如果您的要求是每次更改 CA 表时都更改 record_status 和 last_updated_on，那么可以使用 on UPDATE 触发器。

但是，您说您可以完全控制业务逻辑层。因此，更改 UPDATE 语句以更新这些字段也是最简单的方法。

除非，您需要跟踪每小时的状态变化。然后需要一个单独的表来保存这些更改。

# wix - WIX 合并模块：尝试使用 $(var.Project.TargetFileName)

> ID：542832
> 
> 赞同：2
> 
> 时间：2009-02-12T19:17:52.783
> 
> 标签：wix, wix3, votive

我在 VS 2005 ( .wxs ) 中创建了一个简单的 Wix 3 合并模块

```
<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Module Id="TestMergeModule" Language="1033" Version="1.0.0.0">
    <Package Id="ef2a568e-a8db-4213-a211-9261c26031aa" Manufacturer="Me" InstallerVersion="200" />
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="MergeRedirectFolder">
        <Component Id="Test_ModuleComponent" Guid="{1081C5BC-106E-4b89-B14F-FFA71B0987E1}">
          <File Id="Test" Name="$(var.Project.TargetFileName)" Source="$(var.Project.TargetPath)" DiskId="1" />
        </Component>
      </Directory>
    </Directory>
  </Module>
</Wix> 
```

我已经添加了项目“项目”作为对这个合并模块的引用，但是我继续收到这个错误

> 错误 7 未定义的预处理器变量“$(var.Project.TargetFileName)”。

任何建议，我相信我只是在这里遗漏了明显的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T19:45:35.197

良好的实践要求您始终认为这是您的问题并且它不是错误，但是在浪费了很多时间之后，我想我只是检查一下，而且看起来可能是因为 C++ 项目不支持这我的是 ）

来自 WIX3[错误报告页面](http://sourceforge.net/tracker/index.php?func=detail&aid=1975405&group_id=105970&atid=642714)

> 日期：2008-10-17 14:53 发件人：jasongin 任何 C++ 项目都不是 MSBuild。VS 中的 C++ 项目使用更难互操作的不同项目系统。这就是为什么 Votive v3 还不支持对 C++ 项目的引用。我们知道 C++ 项目引用是一个重要的特性，但它还没有完成。该工作由功能请求 1585281 跟踪。

这是一个[开放的功能请求](http://sourceforge.net/tracker/index.php?func=detail&aid=1585281&group_id=105970&atid=642717)..但现在看来已经有很长时间了，所以不确定它是否会被修复:-(

# java - 如何使 JOptionPane 对话框在任务栏上显示为任务？

> ID：542844
> 
> 赞同：18
> 
> 时间：2009-02-12T19:21:06.940
> 
> 标签：java, user-interface, swing, taskbar, joptionpane

## 编辑：

问题遵循横向规则；我自己的回答先于它。

[在Oscar Reyes](https://stackoverflow.com/users/20654/oscar-reyes)的帮助下，我制定了这个解决方案：

```
import javax.swing.JOptionPane;
import javax.swing.JFrame;

public class MyApp extends JFrame {
    public static void main(String [] args) {
        new MyApp();
    }

    public MyApp() {
        super("MyApp");
        setUndecorated(true);
        setVisible(true);
        setLocationRelativeTo(null);
        String i = JOptionPane.showInputDialog(this, "Enter your name:", getTitle(), JOptionPane.QUESTION_MESSAGE);
        if(null != i) {
            JOptionPane.showInputDialog(this, "Your name is:", getTitle(), JOptionPane.INFORMATION_MESSAGE, null, null, i.concat(i));
        }
        dispose();
    }
} 
```

请注意，我也在 JOptionPane.showInputDialog 中显示我的输出。这样，输出在文本字段中突出显示，因此我可以简单地按`CTRL`+`C`将输出复制到系统剪贴板，然后按`ESC`关闭应用程序。

* * *

我为我的微不足道的应用程序创建了一个微不足道的 GUI。我的应用程序提示输入带有 的单个输入`JOptionPane.showInputDialog`，执行计算，然后显示带有 的单个输出`JOptionPane.showMessageDialog`。我有时会切换到最大化的浏览器窗口或其他要从中复制的东西，然后想切换回我的 JOptionPane 对话框以粘贴到其中。

我想让我的 JOptionPane 对话框在任务栏上显示为一个任务，这样我就可以像几乎任何其他正在运行的程序一样切换到它。我更喜欢 JOptionPane 的简单性，而不是必须创建 JFrame、FlowLayout、Icon、JTextField、JButton、ActionListener 等等。

*   JOptionPane 可以在任务栏上显示为任务吗？
*   如果是这样，我如何让它出现？
*   如果没有，还有其他类似单线的东西`JOptionPane.show[whatever]dialog()`吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-12T20:05:49.110

*   JOptionPane 可以在任务栏上显示为任务吗？

不

*   如果没有，还有什么像 JOptionPane.show[whatever]dialog() 这样的单行代码吗？

不完全是一个班轮（但一些额外的 6 行：P）

我敢打赌，您可以很容易地将所有这些都放在一个实用方法中，并在需要时通过一次调用来调用它。

以下代码将为您的应用添加一个任务栏。

```
import javax.swing.JFrame;
import javax.swing.JOptionPane;

public class OptionTest { 
    public static void main ( String [] args ) { 

        JFrame frame = new JFrame("My dialog asks....");

        frame.setUndecorated( true );
        frame.setVisible( true );
        frame.setLocationRelativeTo( null );

        String message = JOptionPane.showInputDialog(frame,
            "Would this be enough?.", 
            "My dialog asks....", 
            JOptionPane.INFORMATION_MESSAGE);

        System.out.println( "Got " + message );

        frame.dispose();
    }
} 
```

顺便说一句，在 Windows Vista 中，我可以使用 Alt+Tab 切换到 OptionPane 而无需其他任何东西（尽管我在任务栏中看不到你说的）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-16T08:34:42.203

这个问题取决于平台。在我的系统上，带有 OpenBox 的 Debian Linux，JOptionPanes 总是出现在任务栏上。我无法阻止任何 JDialog 出现在任务栏上。

# ruby - 如何拯救 Ruby 中的 eval？

> ID：542845
> 
> 赞同：40
> 
> 时间：2009-02-12T19:21:27.673
> 
> 标签：ruby, exception, eval, rescue

我试图弄清楚如何挽救`eval()`在 Ruby 1.8.6 中编写代码时出现的语法错误。

我期望以下 Ruby 代码：

```
#!/usr/bin/ruby

good_str = "(1+1)"
bad_str = "(1+1"    # syntax error: missing closing paren

begin
    puts eval(good_str)
    puts eval(bad_str)
rescue => exc
    puts "RESCUED!"
end 
```

运行时产生以下结果：

```
2
RESCUED! 
```

相反，我得到的是：

```
2
eval_rescue.rb:8: (eval):1: compile error (SyntaxError)
(eval):1: syntax error, unexpected $end, expecting ')' 
```

由 eval 方法引发的 SyntaxError 似乎正在 eval 中的某个地方被救出，而我没有机会自己处理它。

任何人都知道如何获得我想要的行为（即，让我的“救援”子句从“评估”中捕获错误）？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-02-12T19:47:03.977

布伦特已经得到了一个可行的[答案](https://stackoverflow.com/questions/542845/how-to-rescue-an-eval-in-ruby/542857#542857)，但我建议从你可以逃脱的最小的例外中拯救出来。这可以确保您不会意外吞食您不想要的东西。

因此，

```
begin
  puts eval(good_str)
  puts eval(bad_str)
rescue SyntaxError => se
  puts 'RESCUED!'
end 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-12T19:25:42.513

嗯，这很容易...

事实证明，默认情况下，“rescue”语句不会捕获**所有**异常，而只会捕获 StandardError 的子类。SyntaxError 是 StandardError 的兄弟/表亲，而不是它的子类，因此除非明确告知，否则救援语句不会捕获它。

要让救援块捕获**所有**异常，您需要将代码更改为以下内容：

```
#!/usr/bin/ruby

good_str = "(1+1)"
bad_str = "(1+1"    # syntax error: missing closing paren

begin
    puts eval(good_str)
    puts eval(bad_str)
rescue Exception => exc
    puts "RESCUED!"
end 
```

注意“rescue”行的变化，从“rescue => exc”到“rescue Exception => exc”。

现在，当你运行代码时，你会得到想要的结果：

```
2
RESCUED! 
```

# c# - 如何将图像插入 RichTextBox？

> ID：542850
> 
> 赞同：29
> 
> 时间：2009-02-12T19:22:33.740
> 
> 标签：c#, vb.net, image, richtextbox, rtf

我看到的大多数示例都说将其放在剪贴板上并使用粘贴，但这似乎不是很好，因为它会覆盖剪贴板。

我确实看到[了一种](http://www.codeproject.com/KB/edit/csexrichtextbox.aspx)使用 pinvoke 手动将图像放入 RTF 以将图像转换为 wmf 的方法。这是最好的方法吗？我还能做更直接的事情吗？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-02-20T05:16:16.690

最直接的方法是修改 RTF 代码以自己插入图片。

在 RTF 中，图片是这样定义的：

'{' \pict (brdr?& shading?& picttype & pictsize & metafileinfo?) data '}' 问号表示控制字是可选的。“数据”只是十六进制格式的文件内容。如果要使用二进制，请使用 \bin 控制字。

例如：

```
{\pict\pngblip\picw10449\pich3280\picwgoal5924\pichgoal1860 hex data}
{\pict\pngblip\picw10449\pich3280\picwgoal5924\pichgoal1860\bin binary data} 
```

\pict = 开始一个图片组，\pngblip = png 图片 \picwX = 图片宽度（X 为像素值） \pichX = 图片高度 \picwgoalX = 图片所需宽度，单位为缇

因此，要插入图片，您只需打开图片，将数据转换为十六进制，将这些数据加载到字符串中并在其周围添加 RTF 代码即可定义 RTF 图片。现在，您有一个包含图片数据的自包含字符串，您可以将其插入到文档的 RTF 代码中。不要忘记结束的“}”

接下来，您从 RichTextBox (rtbBox.Rtf) 中获取 RTF 代码，将图片插入到适当的位置，并设置 rtbBox.Rtf 的代码

您可能遇到的一个问题是 .NET RTB 对 RTF 标准没有很好的支持。

我刚刚制作了一个小应用程序*，它允许您快速测试 RTB 中的一些 RTF 代码并查看它如何处理它。您可以在此处下载： [RTB 测试器](http://your-translations.com/toys/)( [http://your-translations.com/toys](http://your-translations.com/toys) )。

您可以将一些 RTF 内容（例如来自 Word）粘贴到左侧 RTF 框中，然后单击“显示 RTF 代码”以在右侧 RTF 框中显示 RTF 代码，或者您可以将 RTF 代码粘贴到右侧 RTB 中并单击在“应用 RTF 代码”上查看左侧的结果。

当然你也可以随意编辑代码，方便测试RichTextBox是否支持你需要的命令，或者学习如何使用RTF控制字。

您可以在线下载 RTF 的完整规范。

* * *

NB这只是我在5分钟内拍打的小东西，所以我没有实现文件打开或保存，拖放或其他文明的东西。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-12-26T15:05:14.593

我使用以下代码首先从剪贴板获取数据，将其保存在内存中，将图像设置在剪贴板中，将其粘贴到富文本框中，最后恢复剪贴板中的数据。

```
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
    OpenFileDialog1.Filter = "All files |*.*"
    OpenFileDialog1.Multiselect = True
    Dim orgdata = Clipboard.GetDataObject

    If OpenFileDialog1.ShowDialog = Windows.Forms.DialogResult.OK Then
        For Each fname As String In OpenFileDialog1.FileNames
            Dim img As Image = Image.FromFile(fname)
            Clipboard.SetImage(img)
            RichTextBox1.Paste()

        Next
    End If
    Clipboard.SetDataObject(orgdata)
End Sub 
```

OpenFileDailog1、RichTextBox1 和 Button1 分别是打开文件对话框、富文本框和按钮控件。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-21T09:19:09.960

```
private void toolStripButton1_Click(object sender, EventArgs e)
    {
        FileDialog fDialog = new OpenFileDialog();
        fDialog.CheckFileExists = true;
        fDialog.CheckPathExists = true;
        fDialog.RestoreDirectory = true;
        fDialog.Title = "Choose file to import";
        if (fDialog.ShowDialog() == DialogResult.OK)
        {
            string lstrFile = fDialog.FileName;
            Bitmap myBitmap = new Bitmap(lstrFile);
            // Copy the bitmap to the clipboard.
            Clipboard.SetDataObject(myBitmap);
            DataFormats.Format format = DataFormats.GetFormat(DataFormats.Bitmap);
            // After verifying that the data can be pasted, paste
            if(top==true && this.rtTop.CanPaste(format))
            {
                rtTop.Paste(format);
            }
            if (btmLeft == true && this.rtBottomLeft.CanPaste(format))
            {
                rtBottomLeft.Paste(format);
            }
            if (btmCenter == true && this.rtBottomCenter.CanPaste(format))
            {
                rtBottomCenter.Paste(format);
            }
            if (btmRight == true && this.rtBottomRight.CanPaste(format))
            {
                rtBottomRight.Paste(format);
            }
        }
    } 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-20T05:28:52.073

这是我破解富文本控件的方法：

在写字板或 MS-WORD 中插入所需的图像。将文件另存为“rtf”。在记事本中打开 rtf 文件以查看原始 rtf 代码。将所需的标签和内容复制到富文本框的“rtf”属性（附加到现有文本）。

涉及一些试验和错误，但有效。

在 C# 中，我使用带有必要 rtf 代码的占位符 StringBuilder 对象。然后我只是附加图像路径。

这是一种无需学习 RTF 语法的解决方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-08-24T21:04:39.613

我在新线程中发布的我自己的版本，显然我应该在这里搜索并发布它。无论如何，再次使用剪贴板，非常容易。

```
private void button1_Click(object sender, EventArgs e)
    {
        openFileDialog1.Filter = "Images |*.bmp;*.jpg;*.png;*.gif;*.ico";
        openFileDialog1.Multiselect = false;
        openFileDialog1.FileName = "";
        DialogResult result = openFileDialog1.ShowDialog();
        if (result == DialogResult.OK)
        {
            Image img = Image.FromFile(openFileDialog1.FileName);
            Clipboard.SetImage(img);
            richTextBox1.Paste();
            richTextBox1.Focus();
        }
        else
        {
            richTextBox1.Focus();
        }

    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-25T19:09:40.690

如果您使用 C++，则可以通过 OLE 来实现。更具体地说，如果您在 Google 上搜索 ImageDataObject，它将显示 C++ 代码如何将 HBITMAP 插入 RTF 控件。一个链接在[这里](http://www.koders.com/cpp/fidA880C3A7551B3EEC5FBF2279E2BE77753DFEE038.aspx?s=mdef:insert)。

现在，我不知道这如何转化为 .Net 代码。我目前没有时间仔细研究细节。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-13T15:43:04.037

我也在为同样的任务寻找一些东西并找到了这个->

[http://sourceforge.net/projects/netrtfwriter/](http://sourceforge.net/projects/netrtfwriter/)

您可以生成所需的任何类型的 RTF 文本，然后根据需要使用它。结构很好的示例，它将自动感知正在使用的图像类型（jpg/jpeg/png 等）并适用于我一直在使用的图像文件。如果您赶时间，那么这是一个很棒的 RTF 生成器！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-10T23:49:07.430

我所做的只是在 c# 中制作了一个小的图片框控件，并确保它隐藏在另一个足够大的对象后面以隐藏它。然后我做了一个按钮来插入图片，它用图片加载了图片框，然后把它放在了richTextBox中，然后它清除了图片框控件。

这是代码。

```
 private void InsertPicture_Click(object sender, EventArgs e)
    {

                    {
            if (openFileDialog4.ShowDialog() == DialogResult.OK)
            {
                // Show the Open File dialog. If the user clicks OK, load the 
                // picture that the user chose.   
                pictureBox2.Load(openFileDialog4.FileName);
                Clipboard.SetImage(pictureBox2.Image);
                pictureBox2.Image = null;
                this.richTextBox1.Paste();

            }
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-20T01:03:02.247

插入代码以使用剪贴板执行此操作后，输入`Clipboard.Clear();`. 它运作良好，它不会清除*所有内容*，仅清除最后添加到剪贴板的项目。

完整代码：

```
private void addPictureToRTB()
{
    using (OpenFileDialog ofd = new OpenFileDialog() { Filter = "Pictures|*.png" })
    {
         if (ofd.ShowDialog() == DialogResult.OK)
         {
               ClipBoard.SetImage(Image.FromFile(ofd.FileName));
               richTextBox.Paste();
               Clipboard.Clear();
         }
    }
} 
```

然后在需要的地方引用这个函数。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2018-10-08T13:55:28.427

几个小时寻找解决方案以在不损失质量的情况下插入图像并用透明图像/ png 修复灰色背景

```
 // assuming the image is in your Resources
                var img = Resources.ImageWithTransparentBckgrnd;
                var g = Graphics.FromImage(img);
                using (var ms = new MemoryStream())
                {
                    img.Save(ms, ImageFormat.Png);
                    IntPtr ipHdc = g.GetHdc();
                    Metafile mf = new Metafile(ms, ipHdc);
                    g = Graphics.FromImage(mf);
                    g.FillEllipse(Brushes.White, 0, 0, 16, 16); // size you want to fill in
                    g.Dispose();
                    mf.Save(ms, ImageFormat.Png);
                    IDataObject dataObject = new DataObject();
                    dataObject.SetData("PNG", false, ms);
                    Clipboard.SetDataObject(dataObject, false);
                    richTextBox1.Paste();
                    SendKeys.Send("{RIGHT}");
                    richTextBox1.Focus();
                } 
```

# apache - 阿帕奇重定向（ .mydomain。 到 mydomain.com）

> ID：542853
> 
> 赞同：0
> 
> 时间：2009-02-12T19:23:36.250
> 
> 标签：apache, mod-rewrite

在 apache 的虚拟主机中，我想将所有请求重定向`<anything>.mydomain.<anything>`到`mydomain.com`.

但是，由于某种原因，下面的重写规则被忽略了。为什么？

```
RewriteCond %{REMOTE_HOST}  ^.*mydomain.*
RewriteRule ^(.*)$ http://mydomain.com [R=301,L] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:35:03.133

您可以使用此规则将每个请求重定向到主机以外的`example.com`主机`example.com`：

```
RewriteCond %{HTTP_HOST}  !^example\.com$
RewriteRule ^ http://example.com%{REQUEST_URI} [R=301,L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:38:08.443

`%{REMOTE_HOST}`指的是访问您网站的计算机的名称 - 从*服务器的*角度来看，它是“远程”的。正如 Gumbo 指出的那样，您应该使用`%{HTTP_HOST}`.

# ruby-on-rails - 在 Rails 中测试时如何设置 HTTP_REFERER？

> ID：542856
> 
> 赞同：88
> 
> 时间：2009-02-12T19:25:05.543
> 
> 标签：ruby-on-rails, ruby, testing

我正在尝试测试控制器，但出现此错误。我理解错误，但不知道如何修复它。

```
test: on CREATE to :user with completely invalid email should respond with 
  redirect
(UsersControllerTest):ActionController::RedirectBackError: 
  No HTTP_REFERER was set in the request to this action, 
  so redirect_to :back could not be called successfully. 
If this is a test, make sure to specify request.env["HTTP_REFERER"]. 
```

在哪里指定？我试过这个：

```
setup { post :create, { :user => { :email => 'invalid@abc' } }, 
  { 'referer' => '/sessions/new' } } 
```

但是得到了同样的错误。

确切地用什么来指定它？我想我希望它返回到的视图的 URI：

```
'/sessions/new' 
```

这就是他们的意思吗？

* * *

好的，事实证明他们的意思是这样做：

```
setup do
  @request.env['HTTP_REFERER'] = 'http://localhost:3000/sessions/new'
  post :create, { :user => { :email => 'invalid@abc' } }, {}
end 
```

有人可以告诉我记录在哪里吗？我想了解该信息的背景。

如果域不是“localhost:3000”怎么办？如果它是“localhost:3001”或其他什么？有什么办法可以预料到吗？

为什么这不起作用：

```
setup { post :create, { :user => { :email => 'invalid@abc' } }, 
  { 'referer' => '/sessions/new' } } 
```

Rails 文档[明确说](http://apidock.com/rails/ActionController/Integration/Session/post)这就是您设置标题的方式。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-02-12T19:41:51.180

他们的建议转化为以下内容：

```
setup do
  @request.env['HTTP_REFERER'] = 'http://test.com/sessions/new'
  post :create, { :user => { :email => 'invalid@abc' } }
end 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2011-09-01T20:08:11.730

接受的答案不适用于集成测试，因为该`@request`变量不存在。

根据[RailsGuides](http://guides.rubyonrails.org/testing.html#helpers-available-for-integration-tests)，您可以将标题传递给助手。

## 导轨 <= 4：

```
test "blah" do
  get root_path, {}, {'HTTP_REFERER' => 'http://foo.com'}
  ...
end 
```

## 导轨 >= 5：

```
test "blah" do
  get root_path, params: { id: 12 }, headers: { "HTTP_REFERER" => "http://foo.com" }
  ...
end 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-03-02T19:24:31.417

回答这个问题：

> 为什么这不起作用：

```
setup { post :create, { :user => { :email => 'invalid@abc' } }, 
{ 'referer' => '/sessions/new' } } 
```

它不起作用，因为[您链接到的 Rails 文档](http://apidock.com/rails/ActionController/Integration/Session/post)记录的类与您可能正在使用的类不同。

您链接到`ActionController::Integration:Session`. 我猜您正在编写功能测试（如果您使用 Test::Unit）或控制器测试（如果您使用 Rspec）。无论哪种方式，您可能正在使用`ActionController::TestCase`或其子类。反过来，它包括模块`ActionController::TestProcess`。

`ActionController::TestProcess`提供了一种`get`方法，其参数与.`get`提供的方法不同`ActionController::Integration:Session`。（烦人，是吗？）方法签名是这样的：

```
 def get(action, parameters = nil, session = nil, flash = nil) 
```

可悲的是，没有 headers 参数。但至少设置`@request.env['HTTP_REFERER']`有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-11-21T09:37:52.947

在 Rails3 中，我遇到了同样的错误：
要在相应的控制器中摆脱这个，为“redirect_to :back”提供救援

示例：`redirect_to :back rescue redirect_to required_path`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-27T06:19:05.157

```
setup do
  @request.env['HTTP_REFERER'] = 'http://test.com/sessions/new'
  post :create, { :user => { :email => 'invalid@abc' } }
end 
```

在 Rails 2.2.2 中，上述代码块从未运行过实际测试。这么说

发布：创建，{ :user => { :email => 'invalid@abc' } }

线路没有运行。您可以简单地摆脱设置块并使用

```
@request.env['HTTP_REFERER'] = 'http://test.com/sessions/new'
post :create, { :user => { :email => 'invalid@abc' } } 
```

反而。它应该设置引用者

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-19T10:58:45.473

对上述问题最直接的解决方案是使用相关标头发出请求。Rails 会自动读取这个标题。

```
post '/your-custom-route', {}, {'HTTP_REFERER': 'http://www.your-allowed-domain.com'} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-06T07:20:06.097

目前，我使用的是 Rails 5.2.1，我在控制器内部的存根请求引用的方法如下：

```
let(:stub_referer) { some_path(some_param) }
before do
  request.headers.merge! referer: stub_referer
  get :some_action, format: :html
end 
```

# latex - 数字后的段落没有缩进？

> ID：542862
> 
> 赞同：32
> 
> 时间：2009-02-12T19:27:04.413
> 
> 标签：latex, indentation, paragraph

我的文档的默认样式是段落缩进。没关系。但是对于跟随在图形或其他对象之后的段落，我不需要缩进。

手动使用`\noindent`效果不佳，因为您不知道最终输出中哪个段落将跟随图形（LaTeX 会自动放置图形）。

*所以我需要输出*中数字后面的段落不缩进（在 tex 源代码中你看不到哪些是缩进的）。怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-02T14:57:21.563

看起来检查哪些段落出现在数字之后并`\noindent`手动放在每个人面前是唯一的方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-04-28T07:26:13.660

我通常只是在数字后面加上“\\”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T19:44:33.267

这似乎是一个非常奇怪的要求（也很难满足）。该`figure`环境适用于与文本流相关但不属于文本流的对象。

以下是您可能考虑的替代方法的一些建议：

*   如果你坚持，你可以对人物的位置施加一些适度的控制。请参阅[LaTex 中的浮动和图片问题](https://stackoverflow.com/questions/518284/problem-with-float-and-pictures-in-latex)。

*   您可以增加分隔数字和正文的空格数量。查找`\textfloatsep`、`\intextsep`、`\abovecaptionskip`和`\belowcaptionskip`。

*   您可以尝试使用[`float`](http://www.ctan.org/tex-archive/macros/latex/contrib/float/)or[`wrapfig`](http://www.ctan.org/tex-archive/macros/latex/contrib/wrapfig/)包中的一些工具。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-12T16:26:59.737

我的出版商需要同样的东西（所以不缩进任何段落或不做这种奇怪的事情的建议是毫无疑问的）。\

我没有找到任何自动解决方案。相反，我将尽可能多的数字放置在页面的顶部或底部，然后在所有内联放置的数字之后手动插入 \noindent 不幸的是，由于 'h' 标志只是一个必须编译的建议，检查输出，放置缩进，编译，检查输出而不是缩进，我花了大约 1 个小时来买一本 300 页的书。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T19:38:31.533

自从我深入研究乳胶以来已经有一段时间了，所以我希望我只是提供一个粗略的想法是可以的 - 我完全不确定它是否会起作用：

IIRC，latex 允许您定义自己的[计数器](http://www.personal.ceu.hu/tex/counters.htm)。您可以更改图形格式环境以增加自定义计数器，然后使段落代码设置条件缩进（仅当计数器等于 1 时），然后使其重置计数器。

（也找不到我的乳胶书，我老婆拿走了！）

编辑：对此有更多想法 - 看看 topnumber/bottomnumber 计数器，Latex 使用它们来计算它在页面上放置了多少个浮点数。您将需要使用非常相似的结构。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-09-18T17:31:39.580

可以放在`\setlength{\parindent}{0em}`前面`\begin{document}`。我使用以下内容：

```
\setlength{\parident}{0em}
\setlength{\parskip}{1cm}
\begin{document}
  ............. 
```

请注意，`\parskip`将段落之间的间距设置为 1 厘米。

# sql-server-2008 - SQL Server Enterprise 与 Standard 的优势 (2008)

> ID：542865
> 
> 赞同：2
> 
> 时间：2009-02-12T19:28:02.307
> 
> 标签：sql-server-2008, compare

我正在研究在 SQL Server 2008 上运行单实例 Web 应用程序。就速度而言，企业版与标准版相比有哪些具体优势。我不是在看事物的管理和报告方面，我理解 Enterprise 在这方面要好得多，而只是从原始速度的角度来看。根据[此处找到](http://www.microsoft.com/sqlserver/2008/en/us/editions-compare.aspx)的信息，我只能找到一些差异。

1.  并行索引操作 - 仅在您创建或更改索引时才重要。对日常速度没有任何影响。

2.  表和索引分区 - 如果一切都在同一个磁盘/RAID 阵列上，这真的会有所不同吗？

3.  仅限于 4 个 CPU - 我知道这是物理处理器插槽的数量，而不是内核，并且我不打算需要具有超过 4 个插槽的服务器。如果我这样做，SQL Server Enterprise 的额外成本将可以忽略不计。或者我可以只在多台机器上使用复制，标准版也支持。

基本上，归根结底，Enterprise 真的值得为单个实例 Web 应用程序[支付额外的现金（8487 美元 + CAL 与 885 美元 + CAL）吗？](http://www.microsoft.com/sqlserver/2008/en/us/pricing.aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T19:53:01.200

我不相信 CAL 许可证允许您将 SQL Server 放在 Web 服务器应用程序后面。您必须购买每处理器许可证才能执行此操作。即使没有，如果您有超过 25 个用户/设备，则每处理器模型的成本更低（您需要为每个用户或每个连接的设备提供一个 CAL）。

Enterprise 的每处理器定价为 24,999 美元，Standard 的每处理器定价为 5,999 美元。您还可以查看网络版，每月 15 美元。每个处理器。

在回答您的问题时，有一些诸如索引视图之类的东西，但是如果您的用户总数少于 10,000 个，那么您的架构和查询设计对性能的影响将比标准版或 Web 版中未包含的任何功能更大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T19:57:47.803

简而言之-鉴于您担心性能，我认为额外的现金不值得，除非您需要广泛使用完整镜像和您提到的其他额外功能。

以下链接可能会有所帮助：

[SQLServer2008 标准 VS 工作组](http://dotnetbutchering.blogspot.com/2008/09/sqlserver-sqlserver2008-workgroup-vs.html)

[SQLServer2008 版本之间的差异](http://msdn.microsoft.com/en-us/library/cc645993.aspx)- 类似于您那里的版本

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T08:17:53.510

您确实需要使用处理器许可。关于许可的问题比您想象的要复杂得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:56:13.847

除非您将拥有庞大的数据库，否则不值得，将额外的钱花在调整数据库设计上。

# database - 数据库模式规范化检查器？

> ID：542866
> 
> 赞同：9
> 
> 时间：2009-02-12T19:28:10.840
> 
> 标签：database, database-normalization, genexus

我有兴趣了解像这样操作的工具：

给定一个数据库模式和一些数据，建议该模式是否可能以任何特定的规范形式结构化，然后说明如何分解该模式以产生进一步的规范化。

基本上，一个用于数据库模式设计的静态分析工具。

像其他静态分析工具一样，这样的数据库工具不需要产生完美的结果（我怀疑这样的“完美”工具在计算上是可行的），或者适用于所有数据库系统，或者免费/开源，或其他任何东西。该工具不必是独立的；它可以捆绑为一些复杂的 IDE 功能。我只是想知道外面有什么。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T20:18:47.537

像您描述的工具，它试图分析您的数据和元数据并建议您*可能的*非规范化结构，会经常给出**错误的建议**，这会使微软助手 Clippy 看起来像是一个不可或缺的作家助手。

![在此处输入图像描述](https://i.stack.imgur.com/pOsPS.png)

规范化过程涉及将软件需求映射到逻辑数据模型。分析工具无法比您更好地了解您的数据需求。所以它不能从不正确的数据库设计中推断出它的哪些部分是错误的。

我了解您已对问题进行了限定，并且您对该工具的功能的期望有限。但是您会希望它对普通的日常任务有用——但即使对于最简单的情况，它也不可靠。

与静态代码分析工具相比。假设您编写了一个应用程序并将其交付给您的客户，而客户说“为什么我不能从这个应用程序发送电子邮件？” 静态代码分析工具如何告诉您您省略了所需的功能？它无法知道这些要求。

同样，数据库规范化分析工具如何知道该`UserAccount`表是否适合具有单个`MobilePhoneNumber`属性，或者是否更适合将电话号码分隔到另一个表中以便单个用户可以列出多个电话？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-25T06:37:15.837

可以做到，并且至少有 2 种商用工具可以为您进行标准化：GeneXus 和 DeKlarit。他们使用一个名为[NormalizationBySynthesis的过程](http://c2.com/cgi/wiki?NormalizationBySynthesis)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-28T08:00:06.250

我也想过这个问题。这在理论上是可能的，并且有一些关于这个主题的研究论文。www.dbtools.cs.cornell.edu 曾经有一个很酷的工具。这是由著名作家 Raghu Ramakrishnan 开发的。他目前在雅虎研究部。您可以参考以下论文以获取更多信息

1.  迪德里希，T. 和 Miton,J.,(1988)，“数据库规范化的新方法和快速算法”，数据库系统上的 ACM 事务，13(3),339-365。
2.  Bernstein, PA(1986)，“从函数依赖中综合第三范式关系”，ACM 数据库系统事务，第 1 卷。第 4 期，第 277-298 页。
3.  JMathNorm：使用 Mathematica 的数据库规范化工具，计算机科学讲义；卷。4488，第七届计算科学国际会议论文集，第二部分，阿里·亚兹奇，齐亚·卡拉卡亚

第三个链接非常有趣。以下是论文摘要：

> 本文是关于设计一个名为 JMathNorm 的完整交互式工具，用于使用 Mathematica 进行关系数据库 (RDB) 规范化。它是由同一作者 [1] 开发的原型的扩展，除了现有的第三范式 (3NF) 模块外，还包括第二范式 (2NF) 和 Boyce-Codd 范式 (BCNF)。本研究中开发的工具是完整的，可用于实时数据库设计，并有助于向数学背景有限的学生教授 DB 规范化的基本概念。JMathNorm 还支持交互使用模块来试验基本的集合操作，例如闭包、以及与模块一起完全闭合以获得功能依赖集的最小覆盖并测试候选键的属性。JMathNorm 的 GUI 界面是用 Java 编写的，并利用 Mathematica 的 JLink 工具来驱动 Mathematica 内核。

我也对这个问题的答案非常感兴趣。如果有人遇到过工具，请告诉我们！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-06-08T12:59:43.800

开源工具 SchemaSpy 检测到一些“异常”，例如“没有索引的表”或“标记为‘可为空’和‘必须唯一’的列”。这些异常之一是**“列名递增的表，可能表示非规范化”**

[http://schemaspy.sourceforge.net/](http://schemaspy.sourceforge.net/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T19:39:10.580

我认为这很难实现。

比如一张桌子

```
Id | Name | Surname | SSN 
```

处于 1NF 中，并且

```
Id | Name | Surname | Mobile 
```

不是，但你既不能从设计上也不能从数据上说，只能从字段名上说。

我曾经见过一个超声检查数据库，它实际上在一个表中同时包含`GENDER`和`LMP`（末次月经）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T19:33:30.500

这是不可能的。

规范化是根据*功能依赖关系*定义的

1.  不能用SQL表达
2.  无法从数据中推断

您可以查看一个表格，例如

```
A | B
--+--
1 | 1
1 | 2 
```

并推断出 B*不*依赖于 A（因为它对于 A 的单个值有两个不同的值），但是您永远不能推断出依赖关系*确实*存在，例如 A 可能依赖于 B，也可能不依赖于 B。

# c# - 具有依赖程序集的 IE 托管 Windows 控件

> ID：542870
> 
> 赞同：0
> 
> 时间：2009-02-12T19:29:01.773
> 
> 标签：c#, winforms, internet-explorer, controls

我正在使用需要托管在 Internet Explorer 中的 Windows 窗体用户控件。[可以在此处](http://www.15seconds.com/issue/030610.htm)和[此处](http://www.c-sharpcorner.com/UploadFile/jdivine/UserControlInInternetExplorer11172005231420PM/UserControlInInternetExplorer.aspx)找到有关我尝试复制的技术的信息。

但是，该控件无法在浏览器中加载，因为它依赖于多个其他依赖 dll。有没有办法让依赖程序集与控件一起下载？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-19T16:14:08.510

我还使用此方法在 html 页面上托管 WinForms-Controls。我发现 internetexplorer 试图在网络服务器的根目录中找到依赖的 dll。Cave：internetexplorer 不会在 web 应用程序的根目录中查找 dll。

让我告诉你一个例子。我构建了一个录音机控件 Recorder.dll。此控件使用 RecLib.dll。我在本地 IIS 上有一个名为 Recorder 的 WebApp，并使用 http//localhost/Recorder/default.aspx 中的 dll 类 ID 指向“localhost/Recorder/Recorder.dll#...” 我已将 Recorder.dll 放到c:\inetpub\wwwroot\Recorder\Recorder.dll。然后我必须把 RecLib.dll 放到 c:\inetpub\wwwroot\RecLib.dll。这是因为 IE 试图在 http//localhost/Reclib.dll 找到库

希望我能让你更清楚。

# nhibernate - 在 NHibernate 中设置 PerWebRequest 生活方式

> ID：542871
> 
> 赞同：1
> 
> 时间：2009-02-12T19:29:42.897
> 
> 标签：nhibernate, ioc-container, perwebrequest

我有一个非常基本的 NHibernate 设置。我没有使用 Castle Widnsor 或任何类似的东西在我的代码中执行 IoC。我想要做的就是将我的 Lifestyle 设置为 PerWebRequest，但如果不返回代码并更新它以使用 IoC 库，我无法弄清楚如何做到这一点。

有没有办法在配置文件中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:48:06.377

您必须编写一个 HttpModule，它在 BeginRequest 事件上创建一个会话并在 EndRequest 事件中处理它。

Billy McCafferty有[一篇](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)关于 codeproject 的文章。你也可以看看 Ayende [Rhino.Commons](https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/rhino-commons/Rhino.Commons.NHibernate/)的东西。

# c# - C#如何将子窗体链接到父窗体？

> ID：542873
> 
> 赞同：1
> 
> 时间：2009-02-12T19:29:53.237
> 
> 标签：c#

我有一个 Windows 表单应用程序，它有一个弹出用于数据输入的子表单，当您点击“保存”时，子表单会关闭。但是，如果我不关闭子窗体并单击另一个程序，例如 Outlook，OUTlook 会出现在顶部，但我的子窗体仍位于 Outlook 上方。我是否需要将其链接到父级以便它们不能分开？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T20:20:37.500

正在创建数据输入对话框，并将[TopMost](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.topmost.aspx)属性设置为 true。

这将使它停留在所有其他本身未设置为最高（大多数）的窗口的操作上。这通常对最终用户来说很烦人，而且很少有对话框真正值得使用。

# c# - 如何检查是否在 web.config 中启用了调试

> ID：542875
> 
> 赞同：47
> 
> 时间：2009-02-12T19:31:00.600
> 
> 标签：c#, asp.net, debugging

我有一些来自我的 VB.NET 1.1 天的代码，允许我动态检查是否在 web.config 中启用了调试。如果我可以简单地让网络管理员启用调试，我想为什么要重新发明轮子来打开/关闭日志记录。这是我在 VB.NET 中使用的代码，效果很好：

```
ConfigurationSettings.GetConfig("system.web/compilation").Debug.ToString() 
```

当我想将它转换为 C# 并在 .NET 3.5 中使用它时，我遇到了一些麻烦，它不起作用。此外，我想使用较新的 ConfigurationManager.GetSection 构造。谁能建议如何最好地读取该`system.web/compilation/debug=true|false`值？

非常感激！

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-02-12T19:38:55.167

采用：

```
HttpContext.Current.IsDebuggingEnabled 
```

此属性实际上查看 web.config 配置设置。如果您使用 Reflector 查看它，您会发现它使用一些内部类获取实际的 ConfigurationSection 对象。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-12T19:44:44.997

以下应该工作

```
var cfg=(System.Web.Configuration.CompilationSection) ConfigurationManager.GetSection("system.web/compilation");
if (cfg.Debug)
{
...
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-12-09T11:09:18.457

-编辑-我知道这并没有像您要求 Web.Config 那样专门回答问题 - 它立即建议一个 web.app，并且不是在“运行时”决定的，但它确实提供了一个好方法检查它是否是调试模式。

另一方面，在同一个应用程序上，您并不理想地在调试模式和发布模式之间互换。-结束编辑-

使用条件编译怎么样？

[http://msdn.microsoft.com/en-us/library/aa691099(v=vs.71).aspx](http://msdn.microsoft.com/en-us/library/aa691099(v=vs.71).aspx)

```
bool isDebuggingEnabled = false

#if debug
   isDebuggingEnabled = true;
#endif 
```

这肯定是最有意义的，并且不需要任何具体的参考？

只需确保`DEBUG`在您的项目中打开常量（见图）

![在此处输入图像描述](https://i.stack.imgur.com/tWFO0.png)

# events - C++/CLI 为事件生成丑陋的 raise_XXX 方法

> ID：542876
> 
> 赞同：1
> 
> 时间：2009-02-12T19:31:16.667
> 
> 标签：events, c++-cli

我正在用 C++/CLI 编写我的自定义事件（我几乎只关心添加/删除方法），如下所示：

```
 event EventHandler<XyzEventArgs^> ^Xyz
    {
        void add(EventHandler<XyzEventArgs^> ^handler);
        void remove(EventHandler<XyzEventArgs^> ^handler);
        void raise(Object ^sender, XyzEventArgs ^e);
    } 
```

一切都很好，但是当我查看 C# 下的 Intellisense 时，它​​显示了一个丑陋的公共 raise_Xyz 方法。

关于如何在不将我的活动设为私有的情况下隐藏它的任何想法？

非常感谢任何帮助。

**编辑：**

> 我能够通过使用不同的可见性修饰符（在我的情况下是内部的）标记它们来消除公共 raise_Xyz 方法。这几乎意味着不能从课堂之外引发事件。这对我来说没问题。然而，我注意到，即使是简单的事件
> 
> ```
> public:
> event EventHandler ^XXX; 
> ```
> 
> 生成 raise_XXX 方法并且它们受到保护。有什么方法可以防止这种情况发生吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T14:37:52.533

*请注意，这适用于 ECMA-372 规范。c# 4 更改了编译器创建的事件机制脚手架，因此 C++/CLI 也可能更改*

因为事件由生成相关脚手架的*编译器*处理（或允许您为它们制作自己的脚手架），所以必然会生成一堆方法来执行此操作。

C++/CLI 与大多数其他 .Net 语言的不同之处在于它的事件糖*允许*子类引发在基类上声明的事件。

```
 public ref class Class1
    {
    public:
        event EventHandler^ MyEvent;
    };

    public ref class Class2 : Class1
    {
    public:
        void Foo()
        {
            this->MyEvent(this, gcnew System::EventArgs());
        }
    }; 
```

这编译（并运行）就好了。与等效的 c# 进行比较

```
 public class Class1
    {
        public event EventHandler MyEvent;
    }

    public class Class2 : Class1
    {
        public void Foo()
        {
        base.MyEvent(this, new System::EventArgs());
        }
    } 
```

这将拒绝编译说：

> 事件 'Class1.MyEvent' 只能出现在 += 或 -= 的左侧（在类型 'Class1' 中使用时除外）

为了让 C++/CLI 做到这一点，它必须将 raise_Xxx 方法公开为受保护的。暴露默认维护事件的底层委托字段将是危险的，并且不允许类在没有自动委托支持字段的情况下以自己的方式实现事件的灵活性。

如果您不希望子类能够执行此操作（或查看它），那么将其设置为内部对于程序集外部的代码来说是一种有效的解决方案。

请注意，C++ CLI 规范定义了事件脚手架的命名约定

> ### 18.2.2 为活动保留的成员名称
> 
> 对于事件 E（第 18.5 节），保留以下名称：
> 
> *   添加_E
> *   删除_E
> *   raise_E

所以这不是可以改变的

# ruby - 使用 Ruby Daemons gem 检测停止

> ID：542877
> 
> 赞同：5
> 
> 时间：2009-02-12T19:32:29.910
> 
> 标签：ruby, daemon

我正在使用 ruby[​​ 守护进程](http://raa.ruby-lang.org/project/daemons/)gem。想知道如何在停止操作中添加一些额外的步骤？希望我能检测到停止被调用，并添加一些额外的代码。有谁知道我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T22:59:36.400

查看守护程序 gem 代码，它看起来并没有为此目的提供明显的扩展点。但是，我想知道（在守护进程中）您是否可以捕获守护进程在“停止”发生时发送的 KILL/TERM 信号......？

```
trap("TERM") do
  # execute your extra code here
end 
```

或者，您可以安装 at_exit 挂钩：-

```
at_exit do
  # execute your extra code here
end 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-25T21:24:03.220

Rapleaf[在他们的博客上有一篇非常好的文章，](http://web.archive.org/web/20090525050606/http://blog.rapleaf.com/dev/?p=19)关于 Daemons gem 的扩展，这可能是您正在寻找的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-31T08:53:44.433

阅读 Daemons 文档后，我发现[#run 方法](http://www.rubydoc.info/gems/daemons/Daemons.run)`:stop_proc`中有一个选项

> :stop_proc 守护进程收到停止请求时将调用的 proc（仅适用于 :load 和 :proc 模式）

所以基本上你可以将它作为一个选项传递给[#run](http://www.rubydoc.info/gems/daemons/Daemons.run)或[#run_proc](http://www.rubydoc.info/gems/daemons/Daemons.run_proc)方法

[[原始答案的链接到 ruby​​forge](https://web.archive.org/web/http://daemons.rubyforge.org:80/Daemons.html#method-c-run)]

# cocoa-touch - iPhone上的样式分段控制按钮？

> ID：542888
> 
> 赞同：2
> 
> 时间：2009-02-12T19:36:16.577
> 
> 标签：cocoa-touch

是否可以更改 iPhone 原生按钮的样式？例如，我想对部分按钮文本使用较小的字体大小，而对另一个使用较大的字体大小 - 类似于

```
<small>pick a</small><big>color</big> 
```

我还想使用形成右箭头形状而不是矩形的按钮。就像是：

```
---------------------------------
\ Color  \   Size    \    Shape  \
/        /           /           /
---------------------------------- 
```

有什么可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-15T04:52:43.807

最简单的选择是使用带有自定义图像的圆角矩形按钮，不幸的是，这不能满足您可调整大小的文本要求（除非您有每种尺寸的图像）。

*   将圆角矩形按钮添加到视图

*   在检查器中：
    - 将类型切换为“自定义”
    - 将背景设置为新按钮的图像 -
    将文本放在“标题”中

如果要使用按钮的文本属性（标题），请务必为按钮图像使用背景

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:46:54.273

我认为你不能轻易做到。您可能必须继承[`UISegmentedControl`](https://developer.apple.com/iphone/library/documentation/UIKit/Reference/UISegmentedControl_Class/Reference/UISegmentedControl.html)并覆盖一堆方法。要在按钮文本上获得不同大小的字体，您必须创建几个`UILabel`s 作为子视图，并为每个子视图提供适当的文本和字体大小，然后将它们布置好。要获得右箭头形状，您需要重写`drawRect:`绘制控件背景的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-20T03:42:42.543

您可以将 UIView 子类化并将多个 UIButton 堆叠在一起。要让每个按钮形成一个右箭头形状，您只需使用可拉伸图像并将 UIButtons 背景设置为此 UImage：

```
UIImage* buttonImage =[[UIImage imageNamed:@"arrowImage.png"] 
       stretchableImageWithLeftCapWidth:5.0 topCapHeight:0.0]; 
```

这是一个很好的起点：[https ://github.com/boctor/idev-recipes/tree/master/CustomSegmentedControls](https://github.com/boctor/idev-recipes/tree/master/CustomSegmentedControls)

我玩过这个并进行了修改，因此我可以自定义每个段的宽度和其他一些调整，这是我的 fork：[https ://github.com/janfsd/idev-recipes/tree/master/CustomSegmentedControls](https://github.com/janfsd/idev-recipes/tree/master/CustomSegmentedControls)

您可以进一步自定义其中之一以接受每个按钮的文本大小参数以满足您的需求。

# apache-flex - Flex 应用程序嵌入旧版 Flash 8 应用程序并与之通信

> ID：542890
> 
> 赞同：1
> 
> 时间：2009-02-12T19:36:50.960
> 
> 标签：apache-flex, flash, actionscript-3, actionscript-2

我目前维护一个用 Flash 8 (AS2) 编写的应用程序，用于嵌入和控制一些自动生成的 SWF。自动生成的 SWF 也是 Flash 8（实际上，它们至少在 7 中工作，甚至可能更早），因此我当前的应用程序能够直接引用嵌入式 SWF 中的变量和函数。

我们现在正在开发这个应用程序的新版本，用 Flex 编写。我们需要复制当前应用程序的嵌入和控制自动生成的 AS2 SWF 的功能。但是，基于 AS3 的 SWF 不能引用嵌入的基于 AS2 的 SWF 中的变量或函数。不幸的是，我们无法控制自动生成工具，因此我们无法将其更改为输出基于 AS3 的 SWF。

让 AS3 和 AS2 SWF 进行通信的唯一真正解决方案是使用 LocalConnection。我需要创建一个包装器 AS2 SWF，它会加载自动生成的 SWF 并充当代理，通过 LocalConnection 与我的 Flex 应用程序通信并对自动生成的 SWF 执行任何需要执行的操作。但是，这有一个问题。代理 SWF 需要知道要使用的 LocalConnection ID，但我找不到与它通信 ID 的方法（我不能硬编码一些随机 ID，因为我需要能够支持多个实例应用程序同时）。

有没有人解决这个问题？有没有办法为嵌入式 SWF 获取某种唯一标识符？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T22:51:16.483

不确定我是否完全了解该应用程序是如何工作的，如果我错了，请原谅。如果 flex 实例必须加载 AVM1 代理，是否可以通过包含生成的 ID 的 URL 注入 flash-var 以供 LocalConnection 使用？

除了您的评论，刚刚添加了如何将变量发送到 AVM1 电影。这至少在本地工作正常（未在网络上测试）：

**AS3 - FP10**：

```
loader = new Loader();

var request:URLRequest = new URLRequest("as2proxy.swf");
var variables:URLVariables = new URLVariables();
variables.id = "local_connection_id";
request.data = variables;

loader.load(request); 
```

**AS2 - FP7**（*“as2proxy.swf”*时间轴上的第一帧）：

```
trace(id); // (_root.id) 
```

顺便说一句，从 Libspark 中偶然发现了以下课程： [http ://www.libspark.org/svn/as3/ForcibleLoader/src/org/libspark/utils/ForcibleLoader.as](http://www.libspark.org/svn/as3/ForcibleLoader/src/org/libspark/utils/ForcibleLoader.as)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:09:10.443

两者可以通过服务器（即中介）进行通信吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-15T00:37:47.807

这是一篇关于跨 AVM 边界通信主题的相当复杂的文章：

[http://asserttrue.com/articles/2006/05/16/library-type-assets-in-actionscript-3-0-using-assets-created-with-current-releases-of-flash-authoring](http://asserttrue.com/articles/2006/05/16/library-type-assets-in-actionscript-3-0-using-assets-created-with-current-releases-of-flash-authoring)

# diff - 如何读取 .rej 文件，即

> ID：542895
> 
> 赞同：29
> 
> 时间：2009-02-12T19:38:51.627
> 
> 标签：diff, patch

我无法将补丁应用到我的源代码树，这不是常见的`-p`剥离问题。`patch`能够找到要修补的文件。

具体来说，我的问题是如何读取/解释在几个大块上失败时创建的`.rej`文件。`patch`我见过的大多数关于`patch`/的讨论`diff`都不包括这个。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-12T20:16:50.427

一个简单的例子：

```
$ echo -e "line 1\nline 2\nline 3" > a
$ sed -e 's/2/b/' <a >b
$ sed -e 's/2/c/' <a >c
$ diff a b > ab.diff
$ patch c < ab.diff
$ cat c.rej
***************
*** 2
- line 2
--- 2 -----
+ line b 
```

如您所见：旧文件包含第 2 行，新文件*应*包含第 b 行。但是，它实际上包含行 c（在拒绝文件中不可见）。

其实解决此类问题最简单的方法就是从.diff/.patch文件中取出diff片段，插入到需要打补丁的文件的合适位置，然后手动对比代码，看看是哪几行实际造成冲突。

或者 - 或者：获取原始文件（未修改），对其进行修补并在文件上运行三路合并。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-02-19T16:41:36.477

[Wiggle](http://linux.die.net/man/1/wiggle)是在补丁不成功时应用 .rej 文件的绝佳工具。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-12-16T07:45:22.373

我不是处理补丁文件的专家，但我想根据我对它们包含的信息的理解，对如何阅读它们进行一些澄清。

你的`.rej`文件会告诉你：

*   原始文件和 .rej 文件之间的区别；
*   问题代码在原始文件中的开始位置，该文​​件中的行数；
*   以及代码在新文件中的开始位置，以及该文件中的行数。

因此，鉴于此消息，在我的 .rej 文件的开头注明：

`diff a/www/js/app.js b/www/js/app.js (rejected hunks) @@ -4,12 +4,24 @@`

我看到对于我的问题`www/js/app`文件`a/www/js/app.js`（第二行`b/www/js/`的逗号`@@ -4,12, +4,24 @@`），并从新版本文件的第 4 行开始，持续 24 行（`@@ -4,12, +4,24 @@`.

[有关更多信息，请参阅http://blog.humphd.org/vocamus-906/](http://blog.humphd.org/vocamus-906/)上的补丁文件的出色概述（包含我上面提到的信息，以及添加的行和/或文件版本之间的详细信息）。

当然欢迎任何更正或澄清。

# sql - INSTR 或 CHARINDEX 的平台无关 SQL 语句

> ID：542904
> 
> 赞同：2
> 
> 时间：2009-02-12T19:41:38.793
> 
> 标签：sql, sql-server, oracle, standards, platform-independent

我在为 Oracle 和 MS SQL 服务器编写 SQL 语句时遇到问题。我想编写 SQL 以便它在两者中都有效。我不想搞乱设置数据库类型变量和切换

我有一列课程名称，其值如下：

> 9RA923.2008W
> 
> 1223.200710
> 
> P0033330.200901

我想选择“。”的所有内容。

在甲骨文我使用这个：

```
SELECT substr(bom_course_id, instr(bom_course_id, '.')+1) FROM ... 
```

在 MSSQL Server 中，我可以使用它：

```
SELECT SUBSTRING(bom_course_id, CHARINDEX('.', bom_course_id)+1 ) FROM ... 
```

有没有人有一个聪明的方法，我可以选择点后的最后一个字符，在 Oracle 或 MS SQL 中使用相同的 SQL 语句。

不幸的是，我不知道“。”之前或之后会有多少个字符。它也不完全是数字，我不能只指望数字。

我真的希望有一个 SQL 标准。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T21:44:35.287

您是否考虑过将选择隐藏在数据库视图中？从应用程序的角度来看，它只是一个没有函数的普通 SELECT，所有特定于数据库的东西都保留在数据库中。

可能不适合所有人，但它是一个想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T00:38:45.523

查看[此链接](http://sqlzoo.net/lfun)，我没有看到实现您想要做的事情的标准方法。

```
ORACLE uses: INSTR
SQL SERVER uses: PATINDEX, CHARINDEX

ORACLE uses: SUBSTR
SQL SERVER uses: SUBSTRING 
```

我想不出获得字符位置的通用方法。

*VIEW*可能是最简单的方法，或者*在客户端应用程序*本身中进行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T19:45:28.537

你能把它转换成一个数字然后只取小数部分吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:55:00.900

如果两个数据库上的区域设置相同，则可以使用

```
SELECT DISTINCT CAST(CAST(bom_course_id AS FLOAT) AS INTEGER) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T19:58:26.600

您可以编写一个名为 RIGHT 的 Oracle 函数，它的作用与 SQL Server 相同，然后在您的 SQL 中使用它。

[这里](http://www.planet-source-code.com/URLSEO/vb/scripts/ShowCode!asp/txtCodeId!1184/lngWid!5/anyname.htm)只是一个实现的例子。

编辑：阅读您的评论后，RIGHT 功能对您的情况并没有真正的帮助。然后您需要将相应的 SQL Server 函数映射到 Oracle。

# c# - 将代码从 C# 转换为 Python 所需的帮助

> ID：542908
> 
> 赞同：3
> 
> 时间：2009-02-12T19:42:23.863
> 
> 标签：c#, .net, python, ironpython

您能否将此代码从 C# 转换为 Python 以在 IronPython 上运行？

我对 Python 没有任何经验。

```
using System;
using Baz;

namespace ConsoleApplication
{
  class Program
  {
    static void Main()
    {
        Portal foo = new Portal("Foo"); 
        Agent bar = new Agent("Bar");

        foo.Connect("127.0.0.1", 1234); 
        foo.Add(bar);

        bar.Ready += new Agent.ReadyHandler(bar_Ready);               
    }

    static void bar_Ready(object sender, string msg)
    {    
       Console.WriteLine(msg.body);  
    }
}
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T19:52:06.867

实例化不需要类型定义。调用相同的方法，直接分配委托。前面的答案是绝对正确的，您需要**更多**上下文才能将 C# 应用程序“转换”为 Python；它不仅仅是语法。

```
foo = Portal("Foo")

bar = Agent("bar")

foo.Connect("ip", 1234)

foo.Add(bar)

bar.Ready = bar_Ready

def bar_Ready(sender, msg):

    print msg.body 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T19:51:16.040

如果您查看以下链接，我认为它最适合您：

[http://www.learningpython.com/2006/10/02/ironpython-hello-world-tutorial/](http://www.learningpython.com/2006/10/02/ironpython-hello-world-tutorial/) [http://msdn.microsoft.com/en-us/magazine/cc300810.aspx](http://msdn.microsoft.com/en-us/magazine/cc300810.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-02T13:52:47.147

或者，如果您真的很懒惰，可以使用开发人员融合中的[C# 到 Python 转换器！](http://www.developerfusion.com/tools/convert/csharp-to-python/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-11-17T20:40:08.953

如果其他人有这个问题，SharpDevelop 有一个转换实用程序可以在 C# 和 IronPython、VB.NET 或 Boo 之间进行转换 [http://community.sharpdevelop.net/blogs/mattward/archive/2009/05/11/ConvertingCSharpVBNetCodeToIronPython.aspx](http://community.sharpdevelop.net/blogs/mattward/archive/2009/05/11/ConvertingCSharpVBNetCodeToIronPython.aspx)

# asp.net-mvc - ASP.NET MVC：模型中的空属性值？

> ID：542912
> 
> 赞同：0
> 
> 时间：2009-02-12T19:43:07.653
> 
> 标签：asp.net-mvc

考虑以下视图摘录：

```
<%= Html.TextBox("Something", Model.Property.SubProperty.Value) %> 
```

我可以处理 Property 和 SubProperty 为 null 的情况：

```
<% if( Model.Property != null || Model.Property.SubProperty != null ) { %>
<%= Html.TextBox("Something", Model.Property.SubProperty.Value) %>
<% } %> 
```

但我觉得这不是很干净。有人有想法吗？

我正在考虑自动映射器。好主意 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:55:19.090

也许您应该考虑让您的控制器为视图提供一个更适合其需求的对象。

# c# - 测试 ac# DateTime 是分钟、小时、月等的最佳方法是什么

> ID：542915
> 
> 赞同：0
> 
> 时间：2009-02-12T19:43:44.657
> 
> 标签：c#, datetime, predicate

我需要测试 DateTime 是否在某个时间单位的开头，以用于各种单位。这是我现在正在使用的代码：

```
/// ignoring milliseconds all the way down

bool IsMinute(DateTime dt)
{
  return dt.Second == 0;
}

bool IsHour(DateTime dt) 
{
  return dt.Second == 0 && dt.Minute == 0;
}  

bool IsDay(DateTime dt) 
{
  return dt.Date == dt;
}

bool IsMonth(DateTime dt) 
{
  return dt.Date == dt && dt.Day == 1;
}

bool IsYear(DateTime dt) 
{
  return dt.Date == dt && dt.DayOfYear == 1;
} 
```

有什么改进的想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T19:48:18.140

（编辑：IsMonth 很好，因为它首先检查它是否只是一个日期。）

您可能希望将这些链接在一起 - 例如，您的 IsMinute 可能应该检查毫秒。与其将该测试也添加到 IsHour，不如先让 IsHour 检查 IsMinute。链接很简单：

```
bool IsHour(DateTime dt) 
{
    return IsMinute(dt) && dt.Minute == 0;
} 
```

另一种选择可能是使它们成为扩展方法：

```
public static bool IsHour(this DateTime dt) 
{
    return dt.IsMinute() && dt.Minute == 0;
} 
```

无论哪种方式，我肯定会让它们成为静态的:)

# python - 在vim中突出显示不匹配的括号

> ID：542929
> 
> 赞同：14
> 
> 时间：2009-02-12T19:47:23.650
> 
> 标签：python, vim, syntax-highlighting

在 vim 中编写 python 代码时，我被不匹配的括号反复烧伤。我喜欢它们在 C 代码中的处理方式——vim 以红色突出显示不匹配括号后面的所有花括号。我`c.vim`简要地查看了语法文件以试图理解它，但处理括号错误的部分非常复杂。谁能解释该代码的工作原理并建议我如何为 python 代码编写类似的东西？

带有不匹配括号的示例 C 代码：

```
int main(void
{  /* brace highlighted in red */
}  /* brace highlighted in red */ 
```

由于 python 代码没有要突出显示的花括号，因此我们必须选择其他内容（可能是其他括号）。

顺便说一句，我尝试了[这个 vim 插件](http://www.vim.org/scripts/script.php?script_id=350)，但我对这种行为不满意。

编辑：

我正在使用 python 生成 C++ 代码（一种喜欢括号和分号的语言）。`file.write()`我有一个讨厌的习惯，就是在方法调用中留下尾随括号。如果我能让 vim 使这个错误在视觉上更明显，那就太好了。

**更新：**

好的，这是我到目前为止所尝试的。

```
:syn region pParen transparent start="(" end=")" contains=ALL
:syn match pError display ")"
:hi def link pError Error 
```

**不幸的是，所有这一切都是将所有平衡**括号的右括号突出显示为错误，这与我想要做的相反。我真的不明白我在这里做什么（只是从现有的 C 语法文件中复制而来）。如果有人能解释我做了什么（错误），我将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T21:55:23.577

你可以让 vim 做相反的事情：做一个

> :set showmatch

它将突出显示匹配的括号。当它不突出某些东西时，你会知道你什么时候不平衡。

我还假设您熟悉 '%' 命令，它会将您弹回匹配的元素。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-02T14:07:48.780

如果我理解正确并且您正在尝试查看 C 代码（在 python 中生成）中不匹配的括号，我建议您从[Dr Chip's Site](http://www.drchip.org/astronaut/vim/#RAINBOW)安装 rainbow.vim 。这将根据缩进级别以不同颜色突出显示大括号，并根据您的要求以红色突出显示不匹配的大括号。截图[http://img294.imageshack.us/img294/8586/rainbow.jpg http://img294.imageshack.us/img294/8586/rainbow.jpg](http://img294.imageshack.us/img294/8586/rainbow.jpg "彩虹大括号错误")

安装、下载**`rainbow.vim`**并放入`vimfiles/after/syntax/c/`（如果该目录不存在，则创建此目录）。

在 Linux 上，这将是`~/.vim/after/syntax/c/rainbow.vim`

在 Windows 上，它可能在`c:\vim\vimfiles\after\syntax\c\rainbow.vim`或可能在其他地方，请参阅`:help runtimepath`.

请注意，有些插件与 冲突`rainbow.vim`，但让它们合作并不难。

如果您试图在 python 代码中突出显示不匹配的括号，您可以修改 rainbow.vim 以使用 python 语法集群而不是 C 语法集群，但这有点复杂，但您可以使用类似的东西（奇普博士彩虹代码的修改版）：

```
syn cluster pyParenGroup contains=pythonString,pythonRawString,pythonEscape,pythonNumber,pythonBuiltin,pythonException
syn match pyParenError display ')'
syn region  pyParen     transparent matchgroup=hlLevel0 start='(' end=')' contains=@pyParenGroup,pyParen1
syn region  pyParen1        transparent matchgroup=hlLevel1 start='(' end=')' contains=@pyParenGroup,pyParen2
syn region  pyParen2        transparent matchgroup=hlLevel2 start='(' end=')' contains=@pyParenGroup,pyParen3
syn region  pyParen3        transparent matchgroup=hlLevel3 start='(' end=')' contains=@pyParenGroup,pyParen4
syn region  pyParen4        transparent matchgroup=hlLevel4 start='(' end=')' contains=@pyParenGroup,pyParen5
syn region  pyParen5        transparent matchgroup=hlLevel5 start='(' end=')' contains=@pyParenGroup,pyParen6
syn region  pyParen6        transparent matchgroup=hlLevel6 start='(' end=')' contains=@pyParenGroup,pyParen7
syn region  pyParen7        transparent matchgroup=hlLevel7 start='(' end=')' contains=@pyParenGroup,pyParen8
syn region  pyParen8        transparent matchgroup=hlLevel8 start='(' end=')' contains=@pyParenGroup,pyParen9
syn region  pyParen9        transparent matchgroup=hlLevel9 start='(' end=')' contains=@pyParenGroup,pyParen
hi link pyParenError Error

if &bg == "dark"
    hi default   hlLevel0 ctermfg=red         guifg=red1
    hi default   hlLevel1 ctermfg=yellow      guifg=orange1      
    hi default   hlLevel2 ctermfg=green       guifg=yellow1      
    hi default   hlLevel3 ctermfg=cyan        guifg=greenyellow  
    hi default   hlLevel4 ctermfg=magenta     guifg=green1       
    hi default   hlLevel5 ctermfg=red         guifg=springgreen1 
    hi default   hlLevel6 ctermfg=yellow      guifg=cyan1        
    hi default   hlLevel7 ctermfg=green       guifg=slateblue1   
    hi default   hlLevel8 ctermfg=cyan        guifg=magenta1     
    hi default   hlLevel9 ctermfg=magenta     guifg=purple1
else
    hi default   hlLevel0 ctermfg=red         guifg=red3
    hi default   hlLevel1 ctermfg=darkyellow  guifg=orangered3
    hi default   hlLevel2 ctermfg=darkgreen   guifg=orange2
    hi default   hlLevel3 ctermfg=blue        guifg=yellow3
    hi default   hlLevel4 ctermfg=darkmagenta guifg=olivedrab4
    hi default   hlLevel5 ctermfg=red         guifg=green4
    hi default   hlLevel6 ctermfg=darkyellow  guifg=paleturquoise3
    hi default   hlLevel7 ctermfg=darkgreen   guifg=deepskyblue4
    hi default   hlLevel8 ctermfg=blue        guifg=darkslateblue
    hi default   hlLevel9 ctermfg=darkmagenta guifg=darkviolet
endif 
```

编辑：

作为测试，我从[ftp://ftp.vim.org/pub/vim/pc/下载](ftp://ftp.vim.org/pub/vim/pc/)**了 gvim70.zip**和**vim70rt.zip**（这些是 Vim 7.0 的 Windows 版本）。我将这两个文件解压缩到一个新目录并从. 我**没有**存储在“C:\Documents and Settings”中的任何 vim 配置，所以运行这个 vim 与运行“vanilla”配置相同。然后，我从[amk.ca/python/simple/pyprint.html](http://www.amk.ca/python/simple/pyprint.html)下载了一段示例代码，并将上述代码复制到名为 code.vim 的文件中。在 gVim 中，我输入了. 它在白色背景窗口中打开，没有语法突出显示。然后我进入`gvim.exe``vim/vim70/gvim.exe`**`pyprint.py``:e pyprint.py``:syntax on`，它打开了默认的语法突出显示。我在第 8 行添加了第二个`)`字符。最后，我输入`:source code.vim`了 ，这使得第二个`)`字符以红色突出显示。**

 **我还在 Linux（使用 Vim 7.2）上执行了这个测试，输入以下命令序列：

```
cd ~
mv .vimrc old_dot_vimrc
mv .gvimrc old_dot_gvimrc
mv .vim old_dot_vim
vim pyprint.py
:e pyprint.py
" Add extra bracket here!
:syntax on
:source code.vim 
```

再次，第二个括号突出显示，其他一切似乎正常。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T21:52:21.647

止损解决方案：

```
:imap ( ()<C-[>i 
```

这将使得每次您键入左括号时，它都会自动放入右侧并让您处于键入之间的位置。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T22:54:55.633

不确定它是否会或多或少让您感到困惑，但您可以查看`lisp.vim`语法文件（尤其`g:lisp_rainbow`是处理的部分）以了解如何突出显示匹配的括号。

如果您设法突出显示所有匹配的括号，则可以让剩余的括号（即不匹配的括号）具有默认的错误突出显示。这就是 lisp 文件似乎正在做的事情。

### 编辑：这个怎么样：

```
syn match parenError ")"
syn region matchingParens transparent start="(" end=")" contains=matchingParens
hi parenError guifg=red 
```

如果你`:syn clear`运行这些，它似乎工作。请注意，`syn`命令的执行顺序很重要。Per ，**最后**`:h :syn-priority`匹配的规则是生效的规则，这可能是您的规则突出显示文件中所有结尾括号的原因。

 **### 编辑＃2：

c.vim 实际上正在做的是突出显示**任何** `{}`内部`()`，无论一切是否正确关闭。尝试`({})`在 C 模式下输入，它仍然突出显示`{}`为错误。

我认为这种方法不能用于直接测试 a`(`与 unmatched `)`，因为`:syn region`不关心结束模式是否存在。

因此，您必须找到不应该属于 Python 的特定内容`()`。然后与`"(\_[^)]*the_forbidden_something"`. 我对 Python 的了解还不够，无法知道那可能是什么。

如果不出意外，你可以这样做：

```
syn match openParen "(\_[^)]*\%$" 
```

它与文件结尾之前没有闭合括号的开放括号匹配。如果它根本找不到任何关闭的括号，这将失败，这意味着它甚至不会 catch `(()<EOF>`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-02T14:51:30.610

您是否尝试过使用[matchit.vim](http://www.vim.org/scripts/script.php?script_id=39 "matchit.vim")？它支持各种匹配，并且*应该*在 Python 中工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T16:33:47.077

作为一种解决方法，我在 vim 网站上发现[了这个缩进脚本](http://www.vim.org/scripts/script.php?script_id=974)，据说它在缩进 Python 代码方面做得更好。当您以不平衡的括号结束一行时，它会缩进下一行以与开放的括号对齐。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-17T16:15:19.867

插件[vim-matchopen 可以满足](https://github.com/arnar/vim-matchopen)您的需求

![](https://i.imgur.com/wmSvzRm.png)
突出显示颜色会根据您的配色方案而变化

# algorithm - 任何算法难题都可以以纯粹的功能方式实现吗？

> ID：542934
> 
> 赞同：2
> 
> 时间：2009-02-12T19:49:13.723
> 
> 标签：algorithm, language-agnostic, functional-programming

我一直在考虑编程语言设计，并从[Wikipedia 上的声明式编程](http://en.wikipedia.org/wiki/Declarative_programming#Definition)的定义：

> 这与命令式编程不同，后者需要对要运行的算法进行详细描述。

再往下：

> ... 任何非强制性的编程风格。...

然后它继续表达函数式语言，因为它们不是命令式的，它们本质上是声明性的。

然而，这让我想知道，纯粹的函数式编程语言是否能够解决任何算法问题，或者是否基于该语言中可用的函数的约束？

我最感兴趣的是关于这个主题的一般想法，虽然如果具体的例子可以说明这一点，我当然欢迎他们。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-12T19:54:50.883

根据[Church-Turing 命题](http://en.wikipedia.org/wiki/Church-Turing_thesis)，

> 三个计算过程（递归、λ演算和图灵机）被证明是等价的"

其中图灵机可以理解为“程序性”，而 lambda 演算可以理解为“功能性”。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-12T19:53:32.463

是的，Haskell、Erlang 等都是图灵完备的语言。原则上，你不需要可变状态来解决问题，因为你总是可以创建一个新对象而不是改变旧对象。当然，Brainfuck 也是图灵完备的。换句话说，仅仅因为一个算法**可以**用函数式语言表达并不意味着它不是非常尴尬。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-14T00:01:41.203

好的，Church 和 Turing 证明了这是*可能的*，但我们实际上如何*做*一些事情呢？

用纯函数式重写命令式代码是我经常分配给本科生的一个练习：

*   每个可变变量都成为函数参数
*   使用递归重写循环
*   每个 goto 都表示为带有参数的函数调用

有时出来的结果是一团糟，但结果往往出奇的优雅。唯一真正的技巧是不要传递永远不会改变的参数，而是让它们在外部环境中绑定。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T22:26:39.630

函数式编程的最大区别在于它避免了可变状态。命令式编程通常会更新变量，而函数式编程将定义新的只读值。

这会影响性能的主要地方是使用可更新数组的算法。命令式实现可以在 O(1) 时间内更新数组元素，而纯函数式实现的最佳实现是 O(log N)（使用排序树）。

请注意，函数式语言通常有一些方法可以使用具有 O(1) 访问时间的可更新数组（例如，Haskell 提供了它的状态转换器 monad）。但是，这可以说是一种命令式编程方法……这没有错；毕竟，您想为特定工作使用最好的工具。

不过，O(log N) 增量数组更新的函数式风格并不全是坏事，因为函数式算法似乎很适合并行化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-06-10T14:30:21.503

*[作为对@SteveB 答案](https://stackoverflow.com/a/542958/1562315)的评论发布时间过长。*

函数式编程和命令式编程具有相同的能力：一个能做什么，另一个能做什么。据说它们是*图灵完备*的。图灵机可以计算的函数*正是*递归函数论和λ演算所表达的。

但是，教会-图灵论点本身是无关紧要的。它断言*任何*计算都可以由图灵机执行。这将一个非正式的想法 - 计算 - 与一个正式的想法 - 图灵机联系起来。还没有人发现任何我们认为是图灵机无法完成的计算。将来有人会发现这样的东西吗？谁能告诉。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T21:44:42.633

使用状态单子，您可以在 Haskell 中以命令式风格进行编程。

因此，对于 Haskell 本质上是声明性的断言需要持保留态度。从积极的方面来说，它相当于命令式编程语言，在实际意义上也没有完全忽略效率。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T22:05:29.980

虽然我完全同意援引 Church-Turing 论文的答案，但这实际上引出了一个有趣的问题。如果我有一个并行计算问题（在严格的数学意义上不是算法），例如多个生产者/消费者队列或多台机器之间的一些网络协议，这可以通过图灵机充分建模吗？它可以被模拟，但如果我们模拟它，我们就失去了我们在问题中具有并行性的目的（因为我们可以在图灵机上找到更简单的算法）。那么，如果我们不失去问题固有的并行性（以及我们对它感兴趣的原因），我们就不能删除状态的概念呢？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-10T12:11:22.127

我记得在某处读到，当以纯功能方式解决时，有些问题可能会更难，但我似乎找不到参考。

如上所述，主要问题是阵列更新。虽然编译器在某些情况下可能会在后台使用可变数组，但必须保证整个程序中只存在一个对该数组的引用。

如果您不使用不纯的构造，这不仅是一个很难的数学事实，而且在实践中也是一个问题。

在更主观的方面，声明所有图灵完备语言都是等价的，这仅在狭义的数学意义上是正确的。[Paul Graham](http://en.wikipedia.org/wiki/Paul_Graham)在“The Blub Paradox”一节中探讨了超越[平均水平的问题。](http://www.paulgraham.com/avg.html)

诸如图灵完备性之类的正式结果可能被证明是正确的，但它们不一定有用。[旅行商问题](http://en.wikipedia.org/wiki/Travelling_salesman_problem)可能是 NP 完全的，但推销员一直在旅行。似乎他们不觉得有必要遵循“最佳”路径，因此该定理无关紧要。

注意：我并不是要抨击函数式编程，因为我真的很喜欢它。重要的是要记住它不是灵丹妙药。

# stored-procedures - sql sp 年或年月

> ID：542937
> 
> 赞同：0
> 
> 时间：2009-02-12T19:50:16.217
> 
> 标签：stored-procedures, dry

我有一些需要年份和月份的 SP：

```
Create PROCEDURE Report(
    @targetYear int,
    @targetMonth int
) 
```

并通过以下方式查询：

```
select sum(col) where year(dateTime) = @targetYear and month(dateTime) = @targetMonth 
```

然后我只有一年一样的东西

```
Create PROCEDURE Report(
    @targetYear int
) 
```

并像这样查询它：

```
select sum(col) where year(dateTime) = @targetYear 
```

当然，逻辑比 sum(col) 更复杂

我的问题是，我如何编写这个 SP，这样逻辑就不会在两个 SP 之间重复，即使这意味着当我的意思是全年时，目标月份传递 0？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T19:57:11.863

我喜欢乔尔的回答，除了如果你把零作为月份传递，他的回答将不起作用。您将需要 @targetMonth=0 例如：

```
SELECT sum(col) 
WHERE year(dateTime) = @TargetYear AND 
(@targetMonth = 0 OR month(dateTime) = @targetMonth) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T19:54:00.230

```
SELECT sum(col) 
FROM [yourtable]
WHERE year(dateTime) = @TargetYear 
    AND (@targetMonth < 0 OR month(dateTime) = @targetMonth) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T20:00:15.317

存储过程可以有一个可选参数：

```
Create PROCEDURE Report( @targetYear int, @targetMonth int = null ) 
```

可以使用参数调用它，也可以不调用它：

```
exec Report 2009
exec Report 2009, 2 
```

然后在您的逻辑中检查是否为空：

```
SELECT sum(col) 
FROM [yourtable]
WHERE (year(dateTime) = @TargetYear and @targetMonth = null)
  OR (year(dateTime) = @TargetYear AND @targetMonth = month(dateTime)) 
```

或者

```
SELECT sum(col) 
FROM [yourtable]
WHERE year(dateTime) = @TargetYear 
  AND (@targetMonth = null OR year(dateTime) = @TargetYear) 
```

# javascript - 如何计算两个日期之间的天数？

> ID：542938
> 
> 赞同：496
> 
> 时间：2009-02-12T19:50:25.873
> 
> 标签：javascript, date

例如，给定输入框中的两个日期：

```
<input id="first" value="1/1/2000"/>
<input id="second" value="1/1/2001"/>

<script>
  alert(datediff("day", first, second)); // what goes here?
</script> 
```

如何在 JavaScript 中获取两个日期之间的天数？

* * *

## 回答 #1

> 赞同：480
> 
> 时间：2009-02-12T20:43:50.020

这是一个**快速而肮脏**的实现`datediff`，作为解决问题中提出的问题的概念证明。它依赖于这样一个事实，即您可以通过减去它们来获得两个日期之间经过的毫秒数，这会将它们强制转换为其原始数值（自 1970 年初以来的毫秒数）。

```
// new Date("dateString") is browser-dependent and discouraged, so we'll write
// a simple parse function for U.S. date format (which does no error checking)
function parseDate(str) {
    var mdy = str.split('/');
    return new Date(mdy[2], mdy[0]-1, mdy[1]);
}

function datediff(first, second) {
    // Take the difference between the dates and divide by milliseconds per day.
    // Round to nearest whole number to deal with DST.
    return Math.round((second-first)/(1000*60*60*24));
}

alert(datediff(parseDate(first.value), parseDate(second.value)));
```

```
<input id="first" value="1/1/2000"/>
<input id="second" value="1/1/2001"/>
```

您应该知道“正常”日期 API（名称中没有“UTC”）在用户浏览器的本地时区中运行，因此通常如果您的用户处于您不使用的时区，您可能会遇到问题期望，并且您的代码将不得不处理夏令时转换。您应该仔细阅读 Date 对象及其方法的文档，对于任何更复杂的内容，强烈考虑使用为日期操作提供更安全和强大 API 的库。

*   [数字和日期 -- MDN JavaScript 指南](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates)
*   [`Date`-- MDN JavaScript 参考](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)

[此外，出于说明目的，代码片段为了简洁起见对[对象使用](https://www.w3.org/TR/html5/browsers.html#named-access-on-the-window-object)[命名访问`window`](https://www.w3.org/TR/html5/browsers.html#named-access-on-the-window-object)，但在生产中，您应该使用标准化 API，例如[getElementById](https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById)，或者更有可能使用一些 UI 框架。]

* * *

## 回答 #2

> 赞同：230
> 
> 时间：2012-06-28T20:13:36.273

在撰写本文时，只有一个其他答案正确处理了 DST（夏令时）转换。以下是位于加利福尼亚的系统的结果：

```
 1/1/2013- 3/10/2013- 11/3/2013-
User       Formula                      2/1/2013  3/11/2013  11/4/2013  Result
---------  ---------------------------  --------  ---------  ---------  ---------
Miles                   (d2 - d1) / N   31        0.9583333  1.0416666  Incorrect
some         Math.floor((d2 - d1) / N)  31        0          1          Incorrect
fuentesjr    Math.round((d2 - d1) / N)  31        1          1          Correct
toloco     Math.ceiling((d2 - d1) / N)  31        1          2          Incorrect

N = 86400000 
```

虽然`Math.round`返回正确的结果，但我认为它有点笨拙。相反，通过在 DST 开始或结束时显式考虑 UTC 偏移量的变化，我们可以使用精确的算术：

```
function treatAsUTC(date) {
    var result = new Date(date);
    result.setMinutes(result.getMinutes() - result.getTimezoneOffset());
    return result;
}

function daysBetween(startDate, endDate) {
    var millisecondsPerDay = 24 * 60 * 60 * 1000;
    return (treatAsUTC(endDate) - treatAsUTC(startDate)) / millisecondsPerDay;
}

alert(daysBetween($('#first').val(), $('#second').val())); 
```

## 解释

JavaScript 日期计算很棘手，因为`Date`对象在 UTC 内部存储时间，而不是本地时间。例如，2013 年 3 月 10 日上午 12:00 太平洋标准时间 (UTC-08:00) 存储为 2013 年 3 月 10 日上午 8:00 UTC 和 2013 年 3 月 11 日上午 12:00 太平洋夏令时间 ( UTC-07:00) 存储为 2013 年 3 月 11 日上午 7:00 UTC。这一天，当地时间午夜到午夜，UTC 时间只有 23 小时！

尽管当地时间的一天可以多于或少于 24 小时，但 UTC 的一天总是正好是 24 小时。¹上面显示的`daysBetween`方法利用了这一事实，首先调用`treatAsUTC`将本地时间调整为 UTC 午夜，然后再进行减法和除法。

^(1\. JavaScript 忽略闰秒。)

* * *

## 回答 #3

> 赞同：131
> 
> 时间：2009-02-13T01:50:13.807

获取两个日期之间差异的最简单方法：

```
var diff = Math.floor((Date.parse(str2) - Date.parse(str1)) / 86400000); 
```

你会得到不同的天数（如果一个或两个都无法解析，则为 NaN）。解析日期以毫秒为单位给出结果，要按天获得，您必须将其除以`24 * 60 * 60 * 1000`

如果你想要它除以天、小时、分钟、秒和毫秒：

```
function dateDiff( str1, str2 ) {
    var diff = Date.parse( str2 ) - Date.parse( str1 ); 
    return isNaN( diff ) ? NaN : {
        diff : diff,
        ms : Math.floor( diff            % 1000 ),
        s  : Math.floor( diff /     1000 %   60 ),
        m  : Math.floor( diff /    60000 %   60 ),
        h  : Math.floor( diff /  3600000 %   24 ),
        d  : Math.floor( diff / 86400000        )
    };
} 
```

这是我重构的 James 版本：

```
function mydiff(date1,date2,interval) {
    var second=1000, minute=second*60, hour=minute*60, day=hour*24, week=day*7;
    date1 = new Date(date1);
    date2 = new Date(date2);
    var timediff = date2 - date1;
    if (isNaN(timediff)) return NaN;
    switch (interval) {
        case "years": return date2.getFullYear() - date1.getFullYear();
        case "months": return (
            ( date2.getFullYear() * 12 + date2.getMonth() )
            -
            ( date1.getFullYear() * 12 + date1.getMonth() )
        );
        case "weeks"  : return Math.floor(timediff / week);
        case "days"   : return Math.floor(timediff / day); 
        case "hours"  : return Math.floor(timediff / hour); 
        case "minutes": return Math.floor(timediff / minute);
        case "seconds": return Math.floor(timediff / second);
        default: return undefined;
    }
} 
```

* * *

## 回答 #4

> 赞同：123
> 
> 时间：2013-08-21T16:17:25.800

我建议使用 moment.js 库（[http://momentjs.com/docs/#/displaying/difference/](http://momentjs.com/docs/#/displaying/difference/)）。它可以正确处理夏令时，并且通常非常适合使用。

例子：

```
var start = moment("2013-11-03");
var end = moment("2013-11-04");
end.diff(start, "days")
1 
```

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2017-11-08T13:34:39.130

## 脚步

1.  设置开始日期
2.  设置结束日期
3.  计算差异
4.  将毫秒转换为天

## 原生 JS

```
const startDate  = '2020-01-01';
const endDate    = '2020-03-15';

const diffInMs   = new Date(endDate) - new Date(startDate)
const diffInDays = diffInMs / (1000 * 60 * 60 * 24); 
```

* * *

## 评论

我知道这不是您的问题的一部分，但总的来说，由于许多边缘情况，我不建议在 vanilla JavaScript 中进行任何日期计算或操作，而是使用[date-](https://date-fns.org) fns 、[Luxon](https://moment.github.io/luxon/)或[moment.js之类的库。](https://momentjs.com)

* * *

## 使用库

### 日期-fns

[https://date-fns.org/v2.16.1/docs/differenceInDays](https://date-fns.org/v2.16.1/docs/differenceInDays)

```
const differenceInDays = require('date-fns/differenceInDays');

const startDate  = '2020-01-01';
const endDate    = '2020-03-15';

const diffInDays = differenceInDays(new Date(endDate), new Date(startDate)); 
```

### 卢克森

[https://moment.github.io/luxon/docs/class/src/datetime.js~DateTime.html#instance-method-diff](https://moment.github.io/luxon/docs/class/src/datetime.js%7EDateTime.html#instance-method-diff)

```
const { DateTime } = require('luxon');

const startDate  = '2020-01-01';
const endDate    = '2020-03-15';

const diffInDays = DateTime.fromISO(endDate).diff(DateTime.fromISO(startDate), 'days').toObject().days; 
```

### Moment.js

[https://momentjs.com/docs/#/displaying/difference/](https://momentjs.com/docs/#/displaying/difference/)

```
const moment = require('moment');

const startDate  = '2020-01-01';
const endDate    = '2020-03-15';

const diffInDays = moment(endDate).diff(moment(startDate), 'days'); 
```

### RunKit 上的示例

[https://runkit.com/marcobiedermann/5f573e211e85e7001a37ab00](https://runkit.com/marcobiedermann/5f573e211e85e7001a37ab00)

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2009-02-12T20:45:34.680

我会继续[抓住这个小实用程序](http://mattkruse.com/javascript/date/date.js)，在其中你会找到适合你的功能。这是一个简短的示例：

```
 <script type="text/javascript" src="date.js"></script>
        <script type="text/javascript">
            var minutes = 1000*60;
            var hours = minutes*60;
            var days = hours*24;

            var foo_date1 = getDateFromFormat("02/10/2009", "M/d/y");
            var foo_date2 = getDateFromFormat("02/12/2009", "M/d/y");

            var diff_date = Math.round((foo_date2 - foo_date1)/days);
            alert("Diff date is: " + diff_date );
        </script> 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2015-04-30T20:03:16.593

使用 Moment.js

```
var future = moment('05/02/2015');
var start = moment('04/23/2015');
var d = future.diff(start, 'days'); // 9
console.log(d);
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2013-11-19T21:40:57.910

JS 中的日期值是日期时间值。

因此，直接日期计算是不一致的：

```
(2013-11-05 00:00:00) - (2013-11-04 10:10:10) < 1 day 
```

例如，我们需要转换 de 2nd date：

```
(2013-11-05 00:00:00) - (2013-11-04 00:00:00) = 1 day 
```

该方法可以在两个日期截断工厂：

```
var date1 = new Date('2013/11/04 00:00:00');
var date2 = new Date('2013/11/04 10:10:10'); //less than 1
var start = Math.floor(date1.getTime() / (3600 * 24 * 1000)); //days as integer from..
var end = Math.floor(date2.getTime() / (3600 * 24 * 1000)); //days as integer from..
var daysDiff = end - start; // exact dates
console.log(daysDiff);

date2 = new Date('2013/11/05 00:00:00'); //1

var start = Math.floor(date1.getTime() / (3600 * 24 * 1000)); //days as integer from..
var end = Math.floor(date2.getTime() / (3600 * 24 * 1000)); //days as integer from..
var daysDiff = end - start; // exact dates
console.log(daysDiff);
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2015-04-30T07:58:39.553

最好使用 UTC 时间摆脱 DST、Math.ceil、Math.floor 等：

```
var firstDate = Date.UTC(2015,01,2);
var secondDate = Date.UTC(2015,04,22);
var diff = Math.abs((firstDate.valueOf() 
    - secondDate.valueOf())/(24*60*60*1000)); 
```

这个例子给出了 109 天的差异。`24*60*60*1000`是以毫秒为单位的一天。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2016-01-11T05:07:54.063

要计算两个给定日期之间的天数，您可以使用以下代码。我在这里使用的日期是 2016 年 1 月 1 日和 2016 年 12 月 31 日

```
var day_start = new Date("Jan 01 2016");
var day_end = new Date("Dec 31 2016");
var total_days = (day_end - day_start) / (1000 * 60 * 60 * 24);
document.getElementById("demo").innerHTML = Math.round(total_days);
```

```
<h3>DAYS BETWEEN GIVEN DATES</h3>
<p id="demo"></p>
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2016-07-13T16:19:13.037

可以使用以下公式计算跨不同 TZ 的两个日期之间的完整证明天数差异：

```
var start = new Date('10/3/2015');
var end = new Date('11/2/2015');
var days = (end - start) / 1000 / 60 / 60 / 24;
console.log(days);
// actually its 30 ; but due to daylight savings will show 31.0xxx
// which you need to offset as below
days = days - (end.getTimezoneOffset() - start.getTimezoneOffset()) / (60 * 24);
console.log(days);
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2021-04-29T02:54:32.510

试试这个

```
let today = new Date().toISOString().slice(0, 10)

const startDate  = '2021-04-15';
const endDate    = today;

const diffInMs   = new Date(endDate) - new Date(startDate)
const diffInDays = diffInMs / (1000 * 60 * 60 * 24);

alert( diffInDays  );
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-03-15T14:21:16.430

我认为解决方案不正确 100% 我会使用**ceil**而不是**floor**， round 可以，但它不是正确的操作。

```
function dateDiff(str1, str2){
    var diff = Date.parse(str2) - Date.parse(str1); 
    return isNaN(diff) ? NaN : {
        diff: diff,
        ms: Math.ceil(diff % 1000),
        s: Math.ceil(diff / 1000 % 60),
        m: Math.ceil(diff / 60000 % 60),
        h: Math.ceil(diff / 3600000 % 24),
        d: Math.ceil(diff / 86400000)
    };
} 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-03-27T12:01:58.737

当我想在两个日期进行一些计算时发现了这个问题，但是日期有小时和分钟值，我修改了@michael-liu 的答案以满足我的要求，它通过了我的测试。

差异天数`2012-12-31 23:00`，`2013-01-01 01:00`应等于 1。（2 小时）差异天数`2012-12-31 01:00`，`2013-01-01 23:00`应等于 1。（46 小时）

```
function treatAsUTC(date) {
    var result = new Date(date);
    result.setMinutes(result.getMinutes() - result.getTimezoneOffset());
    return result;
}

var millisecondsPerDay = 24 * 60 * 60 * 1000;
function diffDays(startDate, endDate) {
    return Math.floor(treatAsUTC(endDate) / millisecondsPerDay) - Math.floor(treatAsUTC(startDate) / millisecondsPerDay);
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2015-04-02T20:59:46.687

这可能不是最优雅的解决方案，但我认为它似乎用相对简单的代码回答了这个问题。你不能使用这样的东西：

```
function dayDiff(startdate, enddate) {
  var dayCount = 0;

  while(enddate >= startdate) {
    dayCount++;
    startdate.setDate(startdate.getDate() + 1);
  }

return dayCount; 
} 
```

这是假设您将日期对象作为参数传递。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2016-11-21T12:32:05.913

```
var start= $("#firstDate").datepicker("getDate");
var end= $("#SecondDate").datepicker("getDate");
var days = (end- start) / (1000 * 60 * 60 * 24);
 alert(Math.round(days)); 
```

[jsfiddle](https://jsfiddle.net/AravindhGopi/tbwa1m8c/4/)示例:)

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2009-02-12T20:16:23.143

从 DatePicker 小部件中使用[formatDate怎么样？](http://docs.jquery.com/UI/Datepicker/%24.datepicker.formatDate)您可以使用它来转换时间戳格式的日期（自 1970 年 1 月 1 日以来的毫秒数），然后进行简单的减法。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2014-12-02T02:49:58.067

```
Date.prototype.days = function(to) {
  return Math.abs(Math.floor(to.getTime() / (3600 * 24 * 1000)) - Math.floor(this.getTime() / (3600 * 24 * 1000)))
}

console.log(new Date('2014/05/20').days(new Date('2014/05/23'))); // 3 days

console.log(new Date('2014/05/23').days(new Date('2014/05/20'))); // 3 days
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2017-01-21T23:59:23.463

```
function timeDifference(date1, date2) {
  var oneDay = 24 * 60 * 60; // hours*minutes*seconds
  var oneHour = 60 * 60; // minutes*seconds
  var oneMinute = 60; // 60 seconds
  var firstDate = date1.getTime(); // convert to milliseconds
  var secondDate = date2.getTime(); // convert to milliseconds
  var seconds = Math.round(Math.abs(firstDate - secondDate) / 1000); //calculate the diffrence in seconds
  // the difference object
  var difference = {
    "days": 0,
    "hours": 0,
    "minutes": 0,
    "seconds": 0,
  }
  //calculate all the days and substract it from the total
  while (seconds >= oneDay) {
    difference.days++;
    seconds -= oneDay;
  }
  //calculate all the remaining hours then substract it from the total
  while (seconds >= oneHour) {
    difference.hours++;
    seconds -= oneHour;
  }
  //calculate all the remaining minutes then substract it from the total 
  while (seconds >= oneMinute) {
    difference.minutes++;
    seconds -= oneMinute;
  }
  //the remaining seconds :
  difference.seconds = seconds;
  //return the difference object
  return difference;
}
console.log(timeDifference(new Date(2017,0,1,0,0,0),new Date()));
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2019-01-25T19:52:01.323

简单、轻松、精致。此函数将每 1 秒调用一次以更新时间。

```
const year = (new Date().getFullYear());
const bdayDate = new Date("04,11,2019").getTime(); //mmddyyyy

// countdown
let timer = setInterval(function () {

    // get today's date
    const today = new Date().getTime();

    // get the difference
    const diff = bdayDate - today;

    // math
    let days = Math.floor(diff / (1000 * 60 * 60 * 24));
    let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    let seconds = Math.floor((diff % (1000 * 60)) / 1000);

}, 1000); 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2015-12-16T16:56:23.090

如果你有两个 unix 时间戳，你可以使用这个函数（为了清楚起见，稍微详细一点）：

```
// Calculate number of days between two unix timestamps
// ------------------------------------------------------------
var daysBetween = function(timeStampA, timeStampB) {
    var oneDay = 24 * 60 * 60 * 1000; // hours * minutes * seconds * milliseconds
    var firstDate = new Date(timeStampA * 1000);
    var secondDate = new Date(timeStampB * 1000);
    var diffDays = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime())/(oneDay)));
    return diffDays;
}; 
```

例子：

```
daysBetween(1096580303, 1308713220); // 2455 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2016-09-20T01:48:41.053

**使用毫秒**时要小心。

**date.getTime()**返回毫秒，用毫秒进行数学**运算需要包括**

*   夏令时 (DST)
*   检查两个日期是否具有相同的时间（小时、分钟、秒、毫秒）
*   确保天数差异需要什么行为：2016 年 9 月 19 日 - 2016 年 9 月 29 日 = 1 天或 2 天差异？

上面评论中的示例是迄今为止我找到的最佳解决方案 [https://stackoverflow.com/a/11252167/2091095](https://stackoverflow.com/a/11252167/2091095)。但是，如果您想计算所涉及的所有天数，请对其结果使用**+1 。**

```
function treatAsUTC(date) {
    var result = new Date(date);
    result.setMinutes(result.getMinutes() - result.getTimezoneOffset());
    return result;
}

function daysBetween(startDate, endDate) {
    var millisecondsPerDay = 24 * 60 * 60 * 1000;
    return (treatAsUTC(endDate) - treatAsUTC(startDate)) / millisecondsPerDay;
}

var diff = daysBetween($('#first').val(), $('#second').val()) + 1; 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2015-07-02T09:03:10.143

我在 Angular 中遇到了同样的问题。我做副本，因为否则他会覆盖第一次约会。两个日期都必须有时间 00:00:00（显然）

```
 /*
* Deze functie gebruiken we om het aantal dagen te bereken van een booking.
* */
$scope.berekenDagen = function ()
{
    $scope.booking.aantalDagen=0;

    /*De loper is gelijk aan de startdag van je reservatie.
     * De copy is nodig anders overschijft angular de booking.van.
     * */
    var loper = angular.copy($scope.booking.van);

    /*Zolang de reservatie beschikbaar is, doorloop de weekdagen van je start tot einddatum.*/
    while (loper < $scope.booking.tot) {
        /*Tel een dag op bij je loper.*/
        loper.setDate(loper.getDate() + 1);
        $scope.booking.aantalDagen++;
    }

    /*Start datum telt natuurlijk ook mee*/
    $scope.booking.aantalDagen++;
    $scope.infomsg +=" aantal dagen: "+$scope.booking.aantalDagen;
}; 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2016-07-21T13:43:33.270

我使用下面的代码来试验新闻帖子的发布日期功能。我根据发布日期和当前日期计算分钟或小时或天或年。

```
var startDate= new Date("Mon Jan 01 2007 11:00:00");
var endDate  =new Date("Tue Jan 02 2007 12:50:00");
var timeStart = startDate.getTime();
var timeEnd = endDate.getTime();
var yearStart = startDate.getFullYear();
var yearEnd   = endDate.getFullYear();
if(yearStart == yearEnd)
 {
  var hourDiff = timeEnd - timeStart; 
  var secDiff = hourDiff / 1000;
  var minDiff = hourDiff / 60 / 1000; 
  var hDiff = hourDiff / 3600 / 1000; 
  var myObj = {};
  myObj.hours = Math.floor(hDiff);
  myObj.minutes = minDiff  
  if(myObj.hours >= 24)
   {
    console.log(Math.floor(myObj.hours/24) + "day(s) ago")
   } 
 else if(myObj.hours>0)
  {
   console.log(myObj.hours +"hour(s) ago")
  }
 else
  {
   console.log(Math.abs(myObj.minutes) +"minute(s) ago")
  }
}
else
{
var yearDiff = yearEnd - yearStart;
console.log( yearDiff +" year(s) ago");
} 
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2016-09-07T14:02:38.603

如果你想要一个带日期的 DateArray 试试这个：

```
<script>
        function getDates(startDate, stopDate) {
        var dateArray = new Array();
        var currentDate = moment(startDate);
        dateArray.push( moment(currentDate).format('L'));

        var stopDate = moment(stopDate);
        while (dateArray[dateArray.length -1] != stopDate._i) {
            dateArray.push( moment(currentDate).format('L'));
            currentDate = moment(currentDate).add(1, 'days');
        }
        return dateArray;
      }
</script> 
```

[调试片段](http://i.stack.imgur.com/tIg1o.png)

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2017-09-19T05:50:41.727

计算两个日期之间天数的简单方法是删除它们的两个时间分量，即将小时、分钟、秒和毫秒设置为 0，然后减去它们的时间，并用毫秒的时间将其替换为一天。

```
var firstDate= new Date(firstDate.setHours(0,0,0,0));
var secondDate= new Date(secondDate.setHours(0,0,0,0));
var timeDiff = firstDate.getTime() - secondDate.getTime();
var diffDays =timeDiff / (1000 * 3600 * 24); 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2017-02-18T05:28:44.880

```
function formatDate(seconds, dictionary) {
    var foo = new Date;
    var unixtime_ms = foo.getTime();
    var unixtime = parseInt(unixtime_ms / 1000);
    var diff = unixtime - seconds;
    var display_date;
    if (diff <= 0) {
        display_date = dictionary.now;
    } else if (diff < 60) {
        if (diff == 1) {
            display_date = diff + ' ' + dictionary.second;
        } else {
            display_date = diff + ' ' + dictionary.seconds;
        }
    } else if (diff < 3540) {
        diff = Math.round(diff / 60);
        if (diff == 1) {
            display_date = diff + ' ' + dictionary.minute;
        } else {
            display_date = diff + ' ' + dictionary.minutes;
        }
    } else if (diff < 82800) {
        diff = Math.round(diff / 3600);
        if (diff == 1) {
            display_date = diff + ' ' + dictionary.hour;
        } else {
            display_date = diff + ' ' + dictionary.hours;
        }
    } else {
        diff = Math.round(diff / 86400);
        if (diff == 1) {
            display_date = diff + ' ' + dictionary.day;
        } else {
            display_date = diff + ' ' + dictionary.days;
        }
    }
    return display_date;
} 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2019-01-23T03:09:21.137

我从其他答案中汲取了一些灵感，并使输入具有自动卫生功能。我希望这可以作为对其他答案的改进。

```
//use best practices by labeling your constants.
let MS_PER_SEC = 1000
  , SEC_PER_HR = 60 * 60
  , HR_PER_DAY = 24
  , MS_PER_DAY = MS_PER_SEC * SEC_PER_HR * HR_PER_DAY
;

//let's assume we get Date objects as arguments, otherwise return 0.
function dateDiffInDays(date1, date2) {
    if (!date1 || !date2) {
      return 0;
    }
    return Math.round((date2.getTime() - date1.getTime()) / MS_PER_DAY);
}

// new Date("dateString") is browser-dependent and discouraged, so we'll write
// a simple parse function for U.S. date format. (by @Miles)
function parseDate(str) {
    if (str && str.length > 7 && str.length < 11) {
      let mdy = str.split('/');
      return new Date(mdy[2], mdy[0]-1, mdy[1]);
    }
    return null;
}

function calcInputs() {
  let date1 = document.getElementById("date1")
    , date2 = document.getElementById("date2")
    , resultSpan = document.getElementById("result")
  ;
  if (date1 && date2 && resultSpan) {
    //remove non-date characters
    let date1Val = date1.value.replace(/[^\d\/]/g,'')
      , date2Val = date2.value.replace(/[^\d\/]/g,'')
      , result = dateDiffInDays(parseDate(date1Val), parseDate(date2Val))
    ;
    date1.value = date1Val;
    date2.value = date2Val;
    resultSpan.innerHTML = result + " days";
  }
}
window.onload = function() { calcInputs(); };

//some code examples
console.log(dateDiffInDays(parseDate("1/15/2019"), parseDate("1/30/2019")));
console.log(dateDiffInDays(parseDate("1/15/2019"), parseDate("2/30/2019")));
console.log(dateDiffInDays(parseDate("1/15/2000"), parseDate("1/15/2019")));
```

```
<input id="date1" type="text" value="1/1/2000" size="6" onkeyup="calcInputs();" />
<input id="date2" type="text" value="1/1/2019" size="6" onkeyup="calcInputs();"/>
Result: <span id="result"></span>
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2020-12-09T22:04:55.477

### 单线和小

```
const diff=(e,t)=>Math.floor((new Date(e).getTime()-new Date(t).getTime())/1000*60*60*24);

// or

const diff=(e,t)=>Math.floor((new Date(e).getTime()-new Date(t).getTime())/86400000);

// or

const diff=(e,t)=>Math.floor((new Date(e).getTime()-new Date(t).getTime())/864e5);

// or

const diff=(e,t)=>Math.floor((new Date(e)-new Date(t))/864e5);

// or

const diff=(a,b)=>(new Date(a)-new Date(b))/864e5|0; 

// use
diff('1/1/2001', '1/1/2000') 
```

### 对于打字稿

```
const diff=(e,t)=>Math.floor((new Date(e).getTime()-new Date(t).getTime())/86400000); 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2020-12-12T14:19:48.327

我最近有同样的问题，并且来自 Java 世界，我立即开始搜索 JavaScript 的 JSR 310 实现。JSR 310 是 Java 的日期和时间 API（标准从 Java 8 开始提供）。我认为 API 设计得非常好。

幸运的是，有一个 Javascript 的直接端口，称为[**js-joda**](https://js-joda.github.io/js-joda/)。

首先，将 js-joda 包含在`<head>`：

```
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/js-joda/1.11.0/js-joda.min.js"
    integrity="sha512-piLlO+P2f15QHjUv0DEXBd4HvkL03Orhi30Ur5n1E4Gk2LE4BxiBAP/AD+dxhxpW66DiMY2wZqQWHAuS53RFDg=="
    crossorigin="anonymous"></script> 
```

然后只需执行以下操作：

```
let date1 = JSJoda.LocalDate.of(2020, 12, 1);
let date2 = JSJoda.LocalDate.of(2021, 1, 1);
let daysBetween = JSJoda.ChronoUnit.DAYS.between(date1, date2); 
```

现在`daysBetween`包含之间的天数。请注意，结束日期是*唯一*的。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2017-09-28T10:31:54.027

更好的解决方案

> 忽略时间部分

如果两个日期相同，它将返回 0。

```
function dayDiff(firstDate, secondDate) {
  firstDate = new Date(firstDate);
  secondDate = new Date(secondDate);
  if (!isNaN(firstDate) && !isNaN(secondDate)) {
    firstDate.setHours(0, 0, 0, 0); //ignore time part
    secondDate.setHours(0, 0, 0, 0); //ignore time part
    var dayDiff = secondDate - firstDate;
    dayDiff = dayDiff / 86400000; // divide by milisec in one day
    console.log(dayDiff);
  } else {
    console.log("Enter valid date.");
  }
}

$(document).ready(function() {
  $('input[type=datetime]').datepicker({
    dateFormat: "mm/dd/yy",
    changeMonth: true,
    changeYear: true
  });
  $("#button").click(function() {
    dayDiff($('#first').val(), $('#second').val());
  });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<input type="datetime" id="first" value="12/28/2016" />
<input type="datetime" id="second" value="12/28/2017" />
<input type="button" id="button" value="Calculate">
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2018-09-09T10:55:20.703

投稿，日期为 1970-01-01 之前和 2038-01-19 之后

```
function DateDiff(aDate1, aDate2) {
  let dDay = 0;
  this.isBissexto = (aYear) => {
    return (aYear % 4 == 0 && aYear % 100 != 0) || (aYear % 400 == 0);
  };
  this.getDayOfYear = (aDate) => {
    let count = 0;
    for (let m = 0; m < aDate.getUTCMonth(); m++) {
      count += m == 1 ? this.isBissexto(aDate.getUTCFullYear()) ? 29 : 28 : /(3|5|8|10)/.test(m) ? 30 : 31;
    }
    count += aDate.getUTCDate();
    return count;
  };
  this.toDays = () => {
    return dDay;
  };
  (() => {
    let startDate = aDate1.getTime() <= aDate2.getTime() ? new Date(aDate1.toISOString()) : new Date(aDate2.toISOString());
    let endDate = aDate1.getTime() <= aDate2.getTime() ? new Date(aDate2.toISOString()) : new Date(aDate1.toISOString());
    while (startDate.getUTCFullYear() != endDate.getUTCFullYear()) {
      dDay += (this.isBissexto(startDate.getFullYear())? 366 : 365) - this.getDayOfYear(startDate) + 1;
      startDate = new Date(startDate.getUTCFullYear()+1, 0, 1);
    }
    dDay += this.getDayOfYear(endDate) - this.getDayOfYear(startDate);
  })();
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2019-11-28T09:34:47.583

在这种情况下使用 moment 会容易得多，你可以试试这个：

```
 let days = moment(yourFirstDateString).diff(moment(yourSecondDateString), 'days'); 
```

它将为您提供整数值，例如 1、2、5、0 等，因此您可以轻松使用条件检查，例如：

```
if(days < 1) { 
```

此外，还有一件事是您可以获得更准确的时间差结果（以十进制形式，如 1.2、1.5、0.7 等）来获得这种结果，使用以下语法：

```
let days = moment(yourFirstDateString).diff(moment(yourSecondDateString), 'days', true); 
```

如果您有任何进一步的疑问，请告诉我

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2015-12-03T12:15:29.917

```
 function validateDate() {
        // get dates from input fields
        var startDate = $("#startDate").val();
        var endDate = $("#endDate").val();
        var sdate = startDate.split("-");
        var edate = endDate.split("-");
        var diffd = (edate[2] - sdate[2]) + 1;
        var leap = [ 0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];
        var nonleap = [ 0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];
        if (sdate[0] > edate[0]) {
            alert("Please enter End Date Year greater than Start Date Year");
            document.getElementById("endDate").value = "";
            diffd = "";
        } else if (sdate[1] > edate[1]) {
            alert("Please enter End Date month greater than Start Date month");
            document.getElementById("endDate").value = "";
            diffd = "";
        } else if (sdate[2] > edate[2]) {
            alert("Please enter End Date greater than Start Date");
            document.getElementById("endDate").value = "";
            diffd = "";
        } else {
            if (sdate[0] / 4 == 0) {
                while (sdate[1] < edate[1]) {
                    diffd = diffd + leap[sdate[1]++];
                }
            } else {
                while (sdate[1] < edate[1]) {
                    diffd = diffd + nonleap[sdate[1]++];
                }
            }
            document.getElementById("numberOfDays").value = diffd;
        }
    } 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2017-05-04T12:12:09.297

您可以使用 UnderscoreJS 进行格式化和计算差异。

**演示** [https://jsfiddle.net/sumitridhal/8sv94msp/](https://jsfiddle.net/sumitridhal/8sv94msp/)

```
 var startDate = moment("2016-08-29T23:35:01");
var endDate = moment("2016-08-30T23:35:01");  

console.log(startDate);
console.log(endDate);

var resultHours = endDate.diff(startDate, 'hours', true);

document.body.innerHTML = "";
document.body.appendChild(document.createTextNode(resultHours));
```

```
body { white-space: pre; font-family: monospace; }
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2017-07-25T20:40:28.157

其他答案的书签版本，提示您输入两个日期：

```
javascript:(function() {
    var d = new Date(prompt("First Date or leave blank for today?") || Date.now());
    prompt("Days Between", Math.round(
        Math.abs(
            (d.getTime() - new Date(prompt("Date 2")).getTime())
                /(24*60*60*1000)
             )
        ));
})(); 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2017-10-02T15:54:43.000

这个答案基于另一个答案（最后的链接），是关于两个日期之间的差异。
您可以看到它是如何工作的，因为它很简单，还包括将差异拆分
为时间单位（我制作的一个函数）并转换为 UTC 以停止时区问题。

```
function date_units_diff(a, b, unit_amounts) {
    var split_to_whole_units = function (milliseconds, unit_amounts) {
        // unit_amounts = list/array of amounts of milliseconds in a
        // second, seconds in a minute, etc., for example "[1000, 60]".
        time_data = [milliseconds];
        for (i = 0; i < unit_amounts.length; i++) {
            time_data.push(parseInt(time_data[i] / unit_amounts[i]));
            time_data[i] = time_data[i] % unit_amounts[i];
        }; return time_data.reverse();
    }; if (unit_amounts == undefined) {
        unit_amounts = [1000, 60, 60, 24];
    };
    var utc_a = new Date(a.toUTCString());
    var utc_b = new Date(b.toUTCString());
    var diff = (utc_b - utc_a);
    return split_to_whole_units(diff, unit_amounts);
}

// Example of use:
var d = date_units_diff(new Date(2010, 0, 1, 0, 0, 0, 0), new Date()).slice(0,-2);
document.write("In difference: 0 days, 1 hours, 2 minutes.".replace(
   /0|1|2/g, function (x) {return String( d[Number(x)] );} ));
```

## 我上面的代码是如何工作的

可以使用[Date](http://www.w3schools.com/jsref/jsref_obj_date.asp)对象计算日期/时间差（以毫秒为单位）：

```
var a = new Date(); // Current date now.
var b = new Date(2010, 0, 1, 0, 0, 0, 0); // Start of 2010.

var utc_a = new Date(a.toUTCString());
var utc_b = new Date(b.toUTCString());
var diff = (utc_b - utc_a); // The difference as milliseconds. 
```

然后计算出该差异的秒数，将其除以 1000 将
毫秒转换为秒，然后将结果更改为整数（整数）以删除
毫秒（该小数的小数部分）`var seconds = parseInt(diff/1000)`：。
此外，我可以使用相同的过程获得更长的时间单位，例如：
- (whole) *minutes*，将*秒*除以 60 并将结果更改为整数，
- *hours*，将*分钟*除以 60 并将结果更改为整数。

我创建了一个函数来执行将差异拆分为
整个时间单位的过程，命名为`split_to_whole_units`，使用此演示：

```
console.log(split_to_whole_units(72000, [1000, 60]));
// -> [1,12,0] # 1 (whole) minute, 12 seconds, 0 milliseconds. 
```

*这个答案是基于[这个另一个](https://stackoverflow.com/a/1968175/3787376)。*

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-06-12T08:31:20.813

我只有以毫秒为单位的两个时间戳，所以我必须用 moment.js 做一些额外的步骤来获得两者之间的天数。

```
const getDaysDiff = (fromTimestamp, toTimestamp) => {
    // set timezone offset with utcOffset if needed
    let fromDate = moment(fromTimestamp).utcOffset(8);
    let toDate = moment(toTimestamp).utcOffset(8);
    // get the start moment of the day
    fromDate.set({'hour':0, 'minute': 0, 'second': 0, 'millisecond': 0});
    toDate.set({'hour':0, 'minute': 0, 'second': 0, 'millisecond': 0});
    let diffDays = toDate.diff(fromDate, 'days');

    return diffDays;
}

getDaysDiff(1528889400000, 1528944180000)// 1 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-01-23T14:45:57.783

**如果我们想计算我们的年龄，这有点不同的答案**

```
 {
      birthday: 'April 22, 1993',
      names: {
        first: 'Keith',
        last: 'Buckley'
      }
    },
    {
      birthday: 'January 3, 1975',
      names: {
        first: 'Larry',
        last: 'Heep'
      }
    },
    {
      birthday: 'February 12, 1944',
      names: {
        first: 'Linda',
        last: 'Bermeer'
      }
    }
  ];
const cleanPeople = people.map(function ({birthday, names:{first, last}}) {
      // birthday, age, fullName;
      const now = new Date();
      var age =  Math.floor(( Date.parse(now) - Date.parse(birthday)) / 31536000000);
      return {
        age,
        fullName:`${first} ${last}`
      }
    });
    console.log(cleanPeople);
    console.table(cleanPeople); 
```

* * *

## 回答 #40

> 赞同：-3
> 
> 时间：2018-08-29T04:29:54.400

我有同样的问题，但如果你在 SQL Query 上完成它会更好：

```
DateDiff(DAY, StartValue,GETDATE()) AS CountDays 
```

查询会自动生成一列`CountDays`

# c# - 增量 .NET 代码覆盖率工具？

> ID：542947
> 
> 赞同：3
> 
> 时间：2009-02-12T19:52:37.973
> 
> 标签：c#, .net, unit-testing, testing, build-automation

我正在寻找一种工具（最好是免费的）来分析我们的 C# 解决方案的增量代码覆盖率。我的意思是我不想知道所有代码甚至命名空间的总代码覆盖率是多少，而只想知道自上次签入以来更改的新代码行或可能更改的代码行。（我们使用颠覆来进行源代码控制。）

我想将此工具称为我们自动构建过程的一部分，并在有人签入代码覆盖率低于 X% 的新代码时进行报告。

有谁知道完成此任务的工具？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T20:06:36.863

[NDepend](http://www.ndepend.com/Features.aspx)拥有以下优势：

> NDepend 从 NCover™ 和 Visual Studio Team System™ 收集代码覆盖率数据。从这些数据中，NDepend 推断出一些关于方法、类型、命名空间和程序集的指标：PercentageCoverage、NbLinesOfCodeCovered、NbLinesOfCodeNotCovered 和 BranchCoverage（仅来自 NCover）。
> 
> 这些指标可以与其他 NDepend 功能结合使用。例如，您可以知道自上次发布以来添加或重构了哪些代码，并且没有完全被测试覆盖。您可以编写一个 CQL 约束来持续检查一组类是否 100% 被覆盖。您可以列出哪些复杂方法需要更多测试。

我似乎记得 NDepend 能够与早期构建的数据进行比较，所以看起来 NDepend 和[NCover的组合](http://www.ncover.com/) *可能会*奏效。不过自己没试过。.)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T10:23:40.470

我使用[PartCover](http://sourceforge.net/projects/partcover/)来分析我的单元测试以获得良好的效果。对于您要查找的数据，您可以使用控制台工具并从报告 xml 中提取`visit`和`len`计数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T20:53:32.490

根据 .Net 的版本，您可以免费使用 NCover。但是，如果您使用的是较新版本的 .net，它就不会那么便宜了。您可能仍然需要编写自己的样式表来解析 NCover 的结果，以便具体了解您的要求。

除此之外，除非您想自己编写，否则我没有听说过或见过其他工具可以做到这一点。

NCover 基本上使用 .Net Profiling API，所以理论上你也可以这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-29T14:24:30.547

除了 Rythmis 的答案之外，我还提供了这篇博文，详细解释了 NDepend 与 NCover 或 VSTS 覆盖率相结合如何回答这个问题： [你确定添加和重构的代码被测试覆盖了吗？](http://codebetter.com/blogs/patricksmacchia/archive/2008/07/10/are-you-sure-added-and-refactored-code-is-covered-by-tests.aspx)

# gcc - 当包装器的版本与特定于平台的二进制文件不同时，gcc 是否工作？

> ID：542953
> 
> 赞同：2
> 
> 时间：2009-02-12T19:53:50.653
> 
> 标签：gcc

我理解 gcc、/usr/bin/gcc（以及与 gcc 相关的其他位，如 ld）的方式是一个小型包装器，它委托给系统上其他地方的特定于平台的二进制文件。

那么，如果您有一个比 /usr/bin/gcc 落后几个版本的交叉编译器，编译是否仍能正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T19:58:13.560

是的，整个想法是允许 gcc 以不同的版本安装，并为不同的目标平台（以任意组合）并行安装。

/usr/bin/gcc 只是使用 fork+exec 来调用实际的编译器。提供给 gcc 的命令行参数只传递给实际的编译器，但有两个例外：-V 和 -b。后者选择目标平台，前者选择编译器的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:02:08.323

您不会使用 /usr/bin/gcc 进行交叉编译。相反，您将在另一个前缀中安装另一个编译器。例如，如果您在 debian/ubuntu 上，您可以通过以下方式安装 ming (win32) 交叉编译器：

apt-get 安装 mingw32

这将与正常的 gcc 完美结合。

# delphi - Delphi：如何创建具有特定秒数的静音 MP3 文件？

> ID：542960
> 
> 赞同：2
> 
> 时间：2009-02-12T19:55:04.300
> 
> 标签：delphi, audio, mp3

我需要创建一个静音秒数的 mp3 文件吗？

以编程方式执行此操作的方法是什么？

编辑：它不需要重新插入到 mp3 中，只需一个包含 x 秒长的静音的 mp3 文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T20:50:21.250

你只是想要一个 X 秒长的 MP3，只是沉默，还是你想将沉默注入现有的 MP3？

这有点复杂。默认情况下，Windows XP 安装了低质量的 MPEG 编码编解码器。如果您滚动到底部有关于 Wave 文件的信息，您可以在同一页面上找到一些关于[使用 Delphi 编码到 MP3的信息。](http://www.efg2.com/Lab/Library/Delphi/Graphics/Multimedia.htm)虽然有些链接坏了。

这是一个两步过程，您需要生成一个波形，然后将该波形编码为 MP3 文件。MP3 文件有一个标题和块，所以你不能只循环几次 40 毫秒的 mp3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T20:05:13.933

编码一个非常短（约 40 毫秒）的静音波形文件，并将生成的 mp3 块作为数组放入源代码中。该块可以以 32kbit 编码（这是可能的最低比特率 iirc）。

或者，您必须链接到任何 mp3 编码库（即 LAME）并为其提供静音以输出结果。

# javascript - gmail如何实现“添加邮件链接”功能？

> ID：542961
> 
> 赞同：0
> 
> 时间：2009-02-12T19:55:09.450
> 
> 标签：javascript, html, css, gmail

我想知道gmail如何实现其**添加邮件**功能的链接-它是一个改变它的显示的div吗？是另一层吗？或者是别的什么？

提前致谢，

盎司收音机。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T20:36:57.757

你说的是其中之一吗？

### 添加链接表单

[GMail 添加链接 1 http://www.kalleload.net/uploads/thumbnails/bxpwxqpauzxe.png](http://www.kalleload.net/uploads/jrwddejjnheh.png)

### 浮动链接工具栏

[GMail 添加链接 2 http://www.kalleload.net/uploads/thumbnails/rrdkcg_tuqjfypvmlra.png](http://www.kalleload.net/uploads/rrdkcg/tuqjfypvmlra.png)

（点击图片放大）

**编辑：**

主要的秘密是你想把你的盒子从 HTML 流中拉出来。这很容易使用，`position: absolute;`然后使用`top`、和定位框。`left``right``bottom`

例如，这是一个代码片段（[完整代码示例](http://pastry.se/10100/)）：

```
.box {
    background: #fff;
    border: 3px solid #333;
    left: 2.00em;
    padding: 2.00em;
    position: absolute;
    top: 2.00em;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:27:50.900

带有 DOM 操作的异步 javascript 服务器回调。不仅仅是在一个大 div 中交换 html，而是只在需要的地方和需要的时候更新内容。

# sql-server - T-SQL 事务如何不是线程安全的？

> ID：542964
> 
> 赞同：2
> 
> 时间：2009-02-12T19:56:02.443
> 
> 标签：sql-server, multithreading, tsql, transactions, transaction-isolation

以下（经过清理的）代码有时会产生这些错误：

> 无法删除表“database.dbo.Table”，因为它不存在或您没有权限。
> 数据库中已经有一个名为“表”的对象。

```
begin transaction  
    if exists (select 1 from database.Sys.Tables where name ='Table') 
        begin drop table database.dbo.Table end 

    Select top 3000 *
    into database.dbo.Table
    from OtherTable
commit

select * from database.dbo.Table 
```

代码可以同时运行多次。有谁知道为什么会断？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T20:03:56.963

我能问一下你为什么先这样做吗？您真的应该考虑使用临时表或提出其他解决方案。

我不肯定 DDL 语句在事务中的行为与 DML 语句的行为相同，并且看到一篇博客文章具有奇怪的行为并在 DDL 中创建存储过程。

除此之外，您可能希望验证您的事务隔离级别并将其设置为序列化。

# 编辑

基于快速测试，我在两个不同的连接中运行了相同的 sql，当我创建了表但没有提交事务时，第二个事务被阻塞了。所以看起来这应该有效。我仍然会警告这种类型的设计。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T21:45:44.393

您在代码的哪一部分阻止对该资源的多次访问？

```
begin transaction  
    if exists (select 1 from database.Sys.Tables where name ='Table') 
        begin drop table database.dbo.Table end 

    Select top 3000 *
    into database.dbo.Table
    from OtherTable
commit 
```

开始交易没有这样做。它只是为添加到表的任何行设置提交/回滚方案。

(if exists, drop) 是一个竞争条件，以及使用 (select..into) 重新创建表。多人同时进入该代码肯定会导致各种错误。一些创建其他人刚刚销毁的表，另一些删除不再存在的表，还有一些删除一些正忙于插入的表。啊！

考虑其他人的临时表建议，或者在关键资源繁忙时使用应用程序锁来阻止其他人输入此代码。删除/创建事务不是您想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T20:17:19.067

如果您只是在此过程中使用此表，我建议您使用临时表或 ram 表，具体取决于数据量。我经常使用 ram 表来避免任何交易成本并节省磁盘活动。

# cocoa-touch - iphone：如何获取触地事件的位置？

> ID：542972
> 
> 赞同：1
> 
> 时间：2009-02-12T19:57:41.673
> 
> 标签：cocoa-touch

我有一个空的基于视图的应用程序。我想对屏幕上每次触摸的 x,y 坐标做一些事情。我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T20:02:01.490

覆盖

```
- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event 
```

函数（来自 NSRespondrer 类）。您可以从视图类中覆盖它。“touches”变量包含一组“UITouch”实例，您可以在视图中查询位置。

# javascript - 如何检测是否以编程方式生成了 onscroll 事件？

> ID：542973
> 
> 赞同：3
> 
> 时间：2009-02-12T19:57:44.920
> 
> 标签：javascript, html

我希望在用户滚动时触发处理程序，但我不希望它在浏览器代表用户滚动时发生。例如，下面的文档作为 onload 的一部分自行滚动。这会触发我的 onscroll 处理程序，但我不希望它这样做。即使我删除了 onload，仍然存在一个问题：如果用户滚动然后重新加载页面，则处理程序会在重新加载时触发。再说一次，我不想那样。

处理程序可以检测到是谁导致它被解雇吗？

```
<html>
 <body onscroll="alert('scroll detected')"
       onload="window.scrollBy(0, document.height)">
  aaa<br/>bbb<br/>ccc<br/>ddd<br/>eee<br/>fff<br/>ggg<br/>hhh<br/>iii<br/>
  jjj<br/>kkk<br/>lll<br/>mmm<br/>nnn<br/>ooo<br/>ppp<br/>qqq<br/>rrr<br/>
  sss<br/>ttt<br/>uuu<br/>vvv<br/>www<br/>xxx<br/>yyy<br/>zzz
 </body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-13T10:35:16.103

每当您以编程方式移动屏幕时设置（布尔）标志如何，并在移动完成时再次取消设置？然后您的滚动侦听器将首先检查该标志，并根据该标志进行操作？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T10:28:31.847

仅检查操作的结果（文档已滚动）时，您无法确定导致该操作的原因。

检查某个动作前后某些属性的状态变化将帮助您确定动作的原因，假设这些相关属性的变化取决于变化的原因。

您应该考虑可能与滚动文档的操作相关的属性，然后考虑这些属性可能如何变化：

*   由于文档被滚动
*   当一个人执行滚动时
*   当浏览器执行滚动时

当一个人滚动文档时，他们可以：

*   点击一个键（向下箭头、向上箭头、向下翻页、向上翻页、ctrl-end、ctrl-home）
*   将指针移到滚动条上，单击一下，远离滚动条

以下事件模式将指示一个人滚动：

*   按下与滚动相关的键*或*鼠标移出浏览器画布（移到滚动条上）
*   文件滚动

在浏览器执行操作的情况下，文档只是滚动而没有任何先前的相关键或鼠标事件。

通过观察滚动事件发生之前发生的情况，您应该能够确定该操作是否由人发起。虽然这当然可能难以实现，但逻辑是合理的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T23:36:07.157

简而言之：你不能

虽然，使用自定义事件在诸如 Prototype 之类的 javascript 库的帮助下做这样的事情会很容易：

```
<script language="javascript">
    document.observe('user:scrolling', function() { alert('yay!'); });
</script>
...
<body onscroll="document.fire('user:scrolling')"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T20:08:48.137

如何在`onscroll`事件期间添加`document.onReady`事件，而不是在 body 命令中内联？我认为这应该允许浏览器在添加`onScroll`事件之前滚动到该位置。

另一种选择是在文档完全呈现后几百毫秒添加一个`setTimeout()`调用函数来添加事件。`onscroll`

# asp.net - 在 CI 构建期间自动更改源代码控制下的 web.config

> ID：542975
> 
> 赞同：1
> 
> 时间：2009-02-12T19:58:10.533
> 
> 标签：asp.net, version-control, continuous-integration, web-config

我正在与几个朋友一起在 ASP.NET MVC 网站上工作。该项目在 SVN 中维护，我设置了 CC.Net 以检查最新版本并自动构建并部署到预生产服务器。默认构建配置设置为调试，但自动构建设置为构建零售。一切正常，除了**`<compilation debug="">`**当前设置为 true 的 web.config 中。我希望能够**`<compilation debug="">`**根据构建风格指定 true 或 false 。

我已经考虑过两种不同的解决方案来解决这个问题。

我可以有一个修改值的构建前/构建后步骤。但是，web.config 文件受源代码控制，因此在自动构建中对其进行修改将使其在构建机器上被签出。我也可以有额外的步骤来恢复它。

我也可以不让 web.config 受源代码控制，而是在构建期间将 web.config.base 文件用作源以生成 web.config 文件。这种方法的问题是大多数工具直接修改 web.config，我们必须手动将这些更改合并回基本文件中。而且由于没有迹象表明任何工具何时更改了 web.config，因此我们必须在任何签入时查找更改。这不仅成为繁琐的手动步骤，而且还容易出错。

这两种方法都行得通，但都有一些缺点。我希望有一种更优雅的方式来做到这一点。因此问题是——你们如何处理在 CI 构建期间修改受源代码控制的 web.config？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T20:04:00.410

您可以查看[Web 部署项目](http://www.microsoft.com/DOWNLOADS/details.aspx?FamilyID=0aa30ae8-c73b-4bdd-bb1b-fe697256c459&displaylang=en)VS 插件。[Scott Guthrie 在这篇文章](http://weblogs.asp.net/scottgu/archive/2005/11/06/429723.aspx)中做了很好的解释。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:04:17.650

为什么不使用可以编辑 XML 的命令行实用程序修改 web.config 作为构建步骤的一部分？

例如，获取一个命令行实用程序，其工作方式如下：

```
xml_mod.exe web.config [xpath-of-value-to-change] [new-value] 
```

然后每个调试/发布（零售）有不同的价值..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T20:05:15.557

为什么不直接使 web.config 读/写而不从源代码管理中检查出来，在构建过程中进行所需的更改然后丢弃它们？

AFAIK SVN 无论如何都有文件读/写。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T23:54:19.310

我们有一个

*   用于开发的 web.config
*   web.config.cert 由 hudson 部署到我们的证书环境
*   web.config.prod 用于生产

这使我们可以在其中放置特定于环境的注释和值，而这些通常必须放在某些文档中，并且肯定会被忽略。

就像我说的，我们在每次构建时都将 Hudson 部署到我们的 cert 环境，所以它只是复制目录，删除 web.config 并将 web.config.cert 重命名为 web.config

你可能想看看 Hudson，我想我从来没有听说过有人选择 CC.net 而不是 Hudson，如果他们有能力选择的话:)

# java - 使用 HeapDumpOnOutOfMemoryError 参数进行 JBoss 的堆转储

> ID：542979
> 
> 赞同：193
> 
> 时间：2009-02-12T19:58:42.857
> 
> 标签：java, memory-leaks, jboss, heap-memory

`-XX:+HeapDumpOnOutOfMemoryError`有人告诉我，当我们的应用程序出现内存不足错误时，我可以将参数添加到我的 JVM 启动选项到我的 JBoss 启动脚本中以获取堆转储。我想知道这些数据在哪里被转储？它只是到控制台，还是到某个日志文件？如果只是到控制台，如果我没有通过控制台登录到Unix服务器怎么办？

* * *

## 回答 #1

> 赞同：263
> 
> 时间：2009-02-12T20:14:39.887

以下是[Oracle 文档](http://www.oracle.com/technetwork/java/javase/clopts-139448.html)的内容：

> 默认情况下，堆转储是在 VM 工作目录中名为 java_pid .hprof 的文件中创建的*，*如上例所示。您可以使用该选项指定替代文件名或目录`-XX:HeapDumpPath=`。例如`-XX:HeapDumpPath=/disk2/dumps` 将导致在`/disk2/dumps` 目录中生成堆转储。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2013-12-10T13:54:08.293

您可以从 UNIX 控制台查看此转储。

堆转储的路径将在您放置上述变量的位置之后作为变量提供。

例如：

```
-XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=${DOMAIN_HOME}/logs/mps" 
```

您可以在上述路径上从控制台查看转储。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-10-26T23:27:31.363

我发现很难理解“VM 的工作目录”是什么意思。在我的示例中，我使用 Java Service Wrapper 程序来执行一个 jar - 转储文件是在我放置包装程序的目录中创建的，例如 c:\myapp\bin。我发现这是因为文件可能非常大，并且在我发现它们的位置之前它们已经填满了硬盘驱动器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-09-26T14:13:57.963

如果您没有使用“-XX:HeapDumpPath”选项，那么在 JBoss EAP/As 的情况下，默认情况下堆转储文件将在“JBOSS_HOME/bin”目录中生成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-07-08T13:51:22.953

如果只配置 -XX:+HeapDumpOnOutOfMemoryError 参数，则在 JBOSS_HOME/bin 目录下会为 OpenJDK/Oracle JDK 生成 heapdump。如果您使用的是 IBM JDK，那么 heapdump 将在 /tmp 目录下创建为 phd 文件。-XX:HeapDumpPath 选项为我们配置自定义头泵路径位置提供了更多可行性（-XX:HeapDumpPath=/my-custom-jboss-server-path/）。建议在您的环境中配置此参数，因为它会在 OutOfMemory 错误时收集堆转储，以分析应用程序的内存泄漏问题或检查应用程序中的任何大对象保留。

# django - 当 django 启动时，我想要一个单独的过程 - 是否有一种可接受的方式来做到这一点？

> ID：542980
> 
> 赞同：2
> 
> 时间：2009-02-12T19:59:27.100
> 
> 标签：django, startup, hook

我正在考虑让 settings.py 开始这个过程，但这看起来有点难看。

我真的不想制作自定义启动脚本，也不能真正让这个过程的启动变得懒惰。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T20:26:00.873

您也许可以在您的模型类之一上注册“类准备”信号的侦听器并从那里触发您的进程。但是，我认为这样做的必要性很可能是设计气味，或者是尾巴摇摆不定的情况。

[http://docs.djangoproject.com/en/dev/ref/signals/#class-prepared](http://docs.djangoproject.com/en/dev/ref/signals/#class-prepared)

我很想知道为什么您的设计需要这样做，但这可能会让我们偏离主题。

# asp.net - 以编程方式为 Web 应用程序中的子目录设置 ASP.NET 授权

> ID：542986
> 
> 赞同：1
> 
> 时间：2009-02-12T20:01:07.610
> 
> 标签：asp.net, asp.net-membership

我有一个使用 CreateUserWizard 注册新用户的 ASP.NET 应用程序。我的注册过程的一部分是为用户创建一个“主目录”，他们可以在其中上传文件。

我想使用 ASP.NET 授权功能来限制对“主目录”的访问。只有分配给目录的注册用户才应该有访问权限。

我想我知道如何使用 Web.config 以声明方式执行此操作。我可以执行以下操作：

```
<?xml version="1.0"?>
<configuration>
.
.
<location path="UserHomeDirectories">
   <system.web>
     <authorization>
       <deny users="?"/>
     </authorization>
   </system.web>
</location>

<location path="UserHomeDirectories/MyUser">
   <system.web>
     <authorization>
       <allow users="MyUser"/>
       <deny users="*"/>
     </authorization>
   </system.web>
</location>
.
.
. 
```

[这篇文章](https://stackoverflow.com/questions/266188/web-config-editing-for-membership-role-authorization) *几乎*回答了我的问题，但是有人可以帮助我解决我的特殊情况吗？还有一件事：修改 Web.config 不会重新启动应用程序吗？（即当我在`CreatedUser`CreateUserWizard 类的事件处理程序中的目录创建/授权代码中的代码运行时？）

感谢您的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T20:10:07.197

您可以在用户文件夹中放置一个新属性，而不是`location`在应用程序范围内使用该属性。`web.config`在这个新文件中，您为该特定文件夹指定授权规则，它们将覆盖应用程序范围的规则。

由于这不会更改您的原始`web.config`文件，因此您的应用程序不会重新启动。

# python - 在 Python 中间接调用内置运算符

> ID：542987
> 
> 赞同：2
> 
> 时间：2009-02-12T20:01:23.037
> 
> 标签：python

假设您有一个小型计算器程序，该程序将数字和一个运算符作为输入对这些数字执行，然后打印出应用指定运算的结果。因此，如果您输入“4 + 5”，它将打印出“9”。很简单，对吧？好吧，我想要写的是这样的：

```
a, op, b = raw_input().split()
print somehowInvokeOperator(op, a, b) 
```

问题在于“somehowInvokeOperator()”部分。有没有办法做到这一点而不求助于（a）eval（）或（b）某种类型的字典映射键，如“+”和“-”到执行适当操作的函数？getattr() 似乎不适用于此。我真的不需要这段代码来做任何事情，我只是想看看这是否可以在 Python 中像在其他动态语言中一样优雅地解决。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T20:10:19.723

基本上不，您至少需要一个字典或函数来将运算符字符映射到它们的实现。它实际上比这复杂一点，因为并非所有运算符都采用这种形式`a [op] b`，所以通常你需要做一些解析；请参阅[https://docs.python.org/library/operator.html](https://docs.python.org/library/operator.html)以获得完整的对应列表，以及您可能希望用于运算符实现的函数。

如果您只是想实现像 + - * / % ** 这样的二元算术运算符，那么字典应该就足够了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T20:03:17.307

如果你真的想这样做，你需要标准`operator`模块。另请参阅[模拟数字类型](http://docs.python.org/reference/datamodel.html#object.__add__)。而且，是的，一本充满功能的字典将是实现这一目标的完美动态方式。

```
import operator
operations = {'+' : operator.add}
result = operations[op](a, b) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T20:42:14.173

警告：这根本不是pythonic！（违背了[Python 之禅的](http://www.python.org/dev/peps/pep-0020/)每一条规则！）

这是一本*神奇*的单行字典：

```
ops = eval( '{%s}'%','.join([('\''+op + '\' : lambda a,b: a ' + op + ' b') for op in '+-*/%']) ) 
```

这定义了你的字典..你可以使用

```
ops['+'](10,4) #returns 14 
```

基本思想是将每个运算符映射到一个 lambda 函数：

```
{ '+' : lambda a,b: a + b } 
```

# c# - 在另一个线程中动态地将控件添加到 WinForms

> ID：542989
> 
> 赞同：2
> 
> 时间：2009-02-12T20:01:49.247
> 
> 标签：c#, vb.net, winforms, multithreading, user-interface

我有一个包含数据网格视图、绑定源、文件资源管理器控件等的 Winform...

我需要动态地将几个控件（自定义用户控件）添加到面板（如 Panel.Controls.Add(...)）。这个过程可能很慢。

我想向用户显示一条消息（等待）。

什么是最好的方法？我使用 Backgroundworker 但我有问题，我的应用程序没有响应并且 datagridview 没有显示垂直滚动条，还有另一个奇怪的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T20:06:18.703

对于这样的 gui 操作，线程可能不是您的最佳选择。所有控件都应该在同一个线程上创建。

而是在表单底部放置一个状态栏控件。在状态栏上，包括一个进度条和一个标签。添加控件时，通过在标签中包含消息并递增进度条在状态栏上指示这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T20:20:49.777

我怀疑向 WinForm 添加控件可能会很慢。恕我直言，可能会降低性能的是获取绑定到它们的数据。因此，您可以例如在新线程中加载数据，一旦加载，将其绑定到控件：

```
ThreadPool.QueueUserWorkItem(o =>
{
    // Simulate some expensive data fetch.
    Thread.Sleep(1000);
    string[] data = new[] { "value1", "value2" };

    if (InvokeRequired)
    {
        Action a = () => { listBox1.DataSource = data; };
        // Ensure that all UI updates are done on the main thread
        Invoke(a);
    }
}); 
```

# iis-7 - 实时监控 IIS 7 上的活动 Web 连接（可能限制单个 IP）？

> ID：542993
> 
> 赞同：3
> 
> 时间：2009-02-12T20:02:08.713
> 
> 标签：iis-7, webserver, monitoring, connection

我们开发了一个 Web 应用程序，用于管理不同用户全天在上游带宽非常有限的 Web 服务器上下载的文件和资源。

有什么方法可以实时监控到 IIS (7.0) 的各个连接占用了多少上行带宽？

理想情况下，我们希望查看每个活动 IIS 连接的列表、实时传送到每个连接的 KB/s 以及目标 IP 地址。

作为超级奖励：有没有办法单独限制连接/IP，以免它们占用所有带宽？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T18:06:11.013

一些专业级软件防火墙允许您这样做。[如果您配置 IIS 以使每个工作进程易于与其他工作进程区分开来，则可以使用诸如Net Limiter](http://www.netlimiter.com/)之类的软件来完成您想要的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-25T04:08:09.263

您是否查看过[比特率限制](http://learn.iis.net/page.aspx/148/bit-rate-throttling-configuration-walkthrough/)模块？它可用于以指定的比特率限制媒体和非媒体文件。

# javascript - 如何阻止进一步的 JavaScript 事件执行

> ID：542994
> 
> 赞同：0
> 
> 时间：2009-02-12T20:02:33.707
> 
> 标签：javascript, asp.net, dom-events, infragistics

我在表单上使用 Infragistics 网格并处理单元格上的多个客户端事件（例如单元格单击、单元格编辑之前、单元格更新之前等）。

在单元格单击事件中，我正在生成一个辅助窗口（成功），如下所示：

```
var convChartWindow = window.open("conversioncharts/" + currentCell.getValue() + ".html", "chart", "location=0,0, status=1, scrollbars=1, width=" + screen.width + ", height=175");        
convChartWindow.focus(); 
```

但是，`convChartWindow`不保持焦点，并被父窗口覆盖。在此之后我的其他单元格事件都没有触发，但似乎有一些 Infragistics JavaScript 在运行。

我可以在`.focus()`上述内容之后放置一些东西以防止进一步的 JavaScript 运行并将焦点保持在正确的窗口上吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T20:38:14.587

调用这个：

```
// Prevents event bubble up or any usage after this is called.
// pE - event object
function StopEvent(pE)
{
   if (!pE)
     if (window.event)
       pE = window.event;
     else
       return;
  if (pE.cancelBubble != null)
     pE.cancelBubble = true;
  if (pE.stopPropagation)
     pE.stopPropagation();
  if (pE.preventDefault)
     pE.preventDefault();
  if (window.event)
     pE.returnValue = false;
  if (pE.cancel != null)
     pE.cancel = true;
}  // StopEvent 
```

这是从这里截取的：[What is equivalent of 'event.returnValue=false' in Firefox](http://forums.asp.net/t/1071858.aspx)

由 Peter Blum 撰写
参见：[PeterBlum.com](http://www.peterblum.com/Home.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:10:44.670

我不知道基础设施是什么。我假设它是一些你无法控制的框架。如果我是你，我会尝试以下方法：

1）设置超时以在 1000 毫秒后将焦点移回窗口，或设置超时循环以将焦点设置到您需要的窗口。这是一个黑客。

2）找出哪些函数会触发破坏你生活的事件，在你的代码中覆盖这些函数并添加一个标志，以防止它们做坏事

3）最后，至少读一下： [http](http://www.quirksmode.org/js/events_order.html) ://www.quirksmode.org/js/events_order.html 那里可能对你有用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T20:11:15.447

让子窗口在打开时调用焦点本身。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T20:18:18.253

如果运行您提供的代码的函数中还有其他内容，请尝试使用：

```
break; 
```

后：

```
convChartWindow.focus(); 
```

# php - += 是做什么用的？

> ID：542995
> 
> 赞同：9
> 
> 时间：2009-02-12T20:02:41.583
> 
> 标签：php

我认为这是一个愚蠢的问题，但我在 php 上找不到它。为什么在下面的代码中有一个 + 和 =：

```
function calculateRanking()
{
    $created = $this->getCreated();

    $diff = $this->getTimeDifference($created, date('F d, Y h:i:s A'));

    $time = $diff['days'] * 24;
    $time += $diff['hours'];
    $time += ($diff['minutes'] / 60);
    $time += (($diff['seconds'] / 60)/60);

    $base = $time + 2;        

    $this->ranking = ($this->points - 1) / pow($base, 1.5);

    $this->save();
} 
```

这是 $time 具有所有这些值，还是将所有值添加到 $time？

谢谢

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-12T20:04:50.097

它将所有这些值添加到时间中。

```
something += somethingelse 
```

是一个捷径

```
something = something + somethingelse 
```

-亚当

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-12T20:04:22.093

```
$time += $diff['hours']; 
```

和说的一样

```
$time = $time + $diff['hours']; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-12T20:05:16.350

`a += 2;`相当于`a = a + 2;`

曾经使用某些语言（尤其是非常古老的 C 编译器），编译器使用第一个选项生成更好的代码。它现在仍然存在，因为它是一个常见的成语，习惯它的人认为它更清晰。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T20:09:45.967

在其他现代语言中的 C、C++ 中有很多这样的速记运算符。

```
a -= b;   // a = a - b;
a *= b;   // a = a * b;
a &= b;   // a = a & b; 
```

等等等等等等。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T20:05:51.280

x += 10 只是写 x = x + 10 的更短的方式。

在这种情况下，代码正在从时差结构中查找以小时为单位的时差。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T20:06:09.970

$val = $val + $otherval 的快捷操作符。

这仅适用于数值

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-12T20:08:11.367

让我们替换一些东西以使其更容易理解。

+= 与以下相同：

```
$time = $diff['days'] * 24;
$time = $time + $diff['hours'];
$time = $time + ($diff['minutes'] / 60);
$time = $time + (($diff['seconds'] / 60)/60); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-12T21:23:27.007

我只是想补充一点，这些信息确实在 PHP 网站上的[操作符](http://us.php.net/manual/en/language.operators.php)部分，或者更具体地说，[赋值操作符](http://us.php.net/manual/en/language.operators.assignment.php)部分。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-12T20:12:52.450

此外，“a += b”是一个表达式，其值可以立即再次使用，

```
(((((a += b) *= c) += d) * e) += f); 
```

比打字少得多

```
a = a + b;
a = a * c;
a = a + d;
a = a * e;
a = a + f; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-02-01T03:10:00.487

**如果两个操作数都是数组**，`$a += $b`也是 的简写[`array_merge($a, $b)`](https://secure.php.net/manual/en/function.array-merge.php#40205)。此函数将两个数组合二为一，丢弃 中`$b`已存在的任何键`$a`。

```
$arr1 = array(4 => "four", 1 => "one", 2 => "two");
$arr2 = array("three", "four", "five");
$arr1 += $arr2;
print_r ($arr1);

// outputs:
Array
(
    [4] => four
    [1] => one
    [2] => two
    [0] => three
)

$arr1 = array(4 => "four", 1 => "one", 2 => "two");
$arr2 = array("three", "four", "five");
$arr2 += $arr1;
print_r ($arr2);

// outputs:
Array
(
    [0] => three
    [1] => four
    [2] => five
    [4] => four
) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-08T05:12:44.037

根据你的代码

```
$time += $diff['hours'];
$time += ($diff['minutes'] / 60);
$time += (($diff['seconds'] / 60)/60); 
```

类似于以下内容：-

```
$time = $time + $diff['hours'];
$time = $time + ($diff['minutes'] / 60);
$time = $time + (($diff['seconds'] / 60)/60); 
```

# asp.net - ASP.NET 和新的图表控件

> ID：542998
> 
> 赞同：0
> 
> 时间：2009-02-12T20:03:23.017
> 
> 标签：asp.net

我正在查看 asp:chart 文档，但看不到您在 ChartArea 上设置“ChartType”的位置。如何制作简单的 2D 饼图？我根本看不到您在哪里设置类型。

**注意：** 改编 Gordon 对 ASP.NET 的回答。足够接近让我走上正确的道路。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T20:11:13.170

```
using System.Windows.Forms.DataVisualization.Charting;
...

// Populate series data
double[]    yValues = {65.62, 75.54, 60.45, 34.73, 85.42};
string[]    xValues = {"France", "Canada", "Germany", "USA", "Italy"};
chart1.Series["Default"].Points.DataBindXY(xValues, yValues);

// Set Pie chart type
chart1.Series["Default"].ChartType = SeriesChartType.Pie;

// Set labels style
chart1.Series["Default"]["PieLabelStyle"] = "Outside"; 
```**********