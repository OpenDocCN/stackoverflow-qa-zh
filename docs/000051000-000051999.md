# StackOverflow 问答 000051000-000051999

# java - Java 桌面应用程序框架

> ID：51002
> 
> 赞同：17
> 
> 时间：2008-09-09T00:11:34.030
> 
> 标签：java, eclipse, netbeans, desktop, platform

我正在设计和构建一个桌面应用程序。我正在考虑使用 eclipse 或 netbeans 作为这个应用程序的基础。但是，我从来没有在这两个平台上构建过。我个人倾向于使用netbeans，因为它看起来像那个平台是一个更容易学习的曲线。但是，我想问那些在这些平台上实际构建过的人，在此之前哪个更容易使用？

我个人对 easer 的定义如下：

*   易于上手

*   一致且符合逻辑的 API

*   良好的文档

*   易于构建和部署

非常感谢，

乔什

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T00:42:40.477

关于 Eclipse RCP 平台，我不能说太多。我会推荐它用于任何 Java 桌面应用程序开发。

它是免费的，有很棒的教程，并允许跨平台开发使用本机操作系统窗口工具包的丰富桌面应用程序，这意味着您的应用程序在任何平台上看起来都是本机的。它还有一个干净的 API，不会妨碍您，使部署到任何平台变得轻而易举。

如果你有兴趣看看这本书：[http ://www.amazon.com/Eclipse-Rich-Client-Platform-Applications/dp/0321334612](https://rads.stackoverflow.com/amzn/click/com/0321334612)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T00:40:57.470

*   **易于使用**：我有在 Eclipse 上开发的经验，我不得不说理解它的开发模型并不容易。当然，对于基本的东西，它有一些使事情变得更容易的向导，但对于更复杂的东西，它就很难了。我不了解 Netbeans，但我听说它更容易。
*   **一致的 API**：我认为 Eclipse 在这方面胜出。它在 OSGI 上运行（虽然带来了一些复杂性），并且几乎所有东西都有插件扩展。它似乎是插件开发的首选平台，所以我可以假设它是可靠的。
*   **文档**：Eclipse 胜出。eclipse 站点的帮助非常好，邮件列表中有很多用户问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T00:24:01.940

我使用 Eclipse 作为框架基础，但它主要是使用 SWT——我们并没有真正使用太多的 RCP。

这真的取决于你在写什么，但从我从使用 Eclipse 中学到的东西，它真的只适合编写一个涉及使用各种视图编辑数据的应用程序（就像编辑代码一样）。

任何更随机的事情都可能导致您开始将框架推向非设计的方向并导致大规模失败。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T00:25:19.253

您将使用 Swing 来开发您的应用程序，因为任何其他窗口框架只有在您具有先前的知识或适当的背景时才有用。

您可以依靠[http://www.javadocking.com/](http://www.javadocking.com/)来简化您的应用程序。

如果您的应用程序要求高度集中在用户界面上，也许您可​​以看看另一个方向，例如 Adob​​e Air。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T01:17:09.457

RCP 具有更大的学习曲线，但是一旦您学习了基础知识，Eclipse IDE 本身就可以很好地支持构建 RCP 应用程序。我只为 NetBeans 构建了一个插件（没有构建一个成熟的应用程序），学习曲线比 RCP 应用程序要小。[Eclipse Rich Client Platform: Designing, Coding, and Packaging Java(TM) Applications](https://rads.stackoverflow.com/amzn/click/com/0321334612)一书详细介绍了构建 RCP 应用程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T08:08:24.883

在认为 RCP 仅用于构建文本编辑器之前，请查看[http://www.eclipse.org/community/rcp.php](http://www.eclipse.org/community/rcp.php)上的一些开源应用程序。谢谢。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T06:29:08.137

[Eclipse RCP 简介。](http://www.vogella.de/articles/RichClientPlatform/article.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T17:22:36.017

我对两者都做了一些工作，但只针对相对简单的应用程序。两者似乎具有大致相同的能力。我个人更喜欢 Netbeans 平台，因为它对我来说更有意义。

您还应该考虑 JSR-296，即 Swing 应用程序框架。它为构建 Swing 应用程序、管理应用程序资源、状态等提供了一个基本框架，但没有 Netbeans 和 Eclipse 那么多的“包袱”。Netbeans IDE 有许多用于在 SAF 上构建应用程序的工具。有关更多信息，请参阅[https://appframework.dev.java.net/](https://appframework.dev.java.net/)。

如果不了解您的应用程序的更多信息，就很难指出这两个平台的适当优势/劣势。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-17T00:47:02.807

我有一个类似的任务，我也在考虑不同的框架。我对 Eclipse（大约 4 个月的 RCP 开发）和现在的 Netbeans（玩了几天）有一些经验。恕我直言，这些框架太复杂了。您最终只是调试 Eclipse 特定的插件加载器，试图找出为什么会得到 ClassNotFoundException 或 NullPointer。NetBeans 也有同样的情况：只要您按照教程进行操作，就可以在某种程度上读取 xml 配置文件并从中创建 UI，这很酷。当然，你不能使用其他 IDE 开发和基于 Eclipse 的 RCP，NB 也非常嫉妒它的使用（除非你像我一样做一些 hack）。我缺乏的是一种清晰的方法来调试我的线程从主要到执行的操作。相反，我总是被告知我必须做什么来避免异常。所以每次我试图拉出新的东西时，我都必须保持手指交叉。它从来没有第一次成功。现在我考虑了我需要的功能，并寻找针对特定功能的小型项目，例如插件管理。而且有很多。只需编译您需要的功能列表，然后通过将较小的框架集成到您的项目中来开始添加它们。这也是有道理的，因为您的项目最终应该消耗更少的 RAM。只需编译您需要的功能列表，然后通过将较小的框架集成到您的项目中来开始添加它们。这也是有道理的，因为您的项目最终应该消耗更少的 RAM。只需编译您需要的功能列表，然后通过将较小的框架集成到您的项目中来开始添加它们。这也是有道理的，因为您的项目最终应该消耗更少的 RAM。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-01T17:44:30.163

如果您真的想避免跨平台维护，请使用 Swing。这将为您购买所有平台。RCP 需要每个平台的本地库。

我们对 Swing 有很好的体验。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-17T13:30:23.413

当你真的需要一个构建在上面的平台时，我会使用 eclipse RCP，而不仅仅是像 swing 或 swt 这样的“小部件”。RCP 坚如磐石、始终如一、模块化且非常灵活。一旦掌握了它，您将获得巨大的收益。作为一个平台，它为您提供最常用的东西——偏好、配置、自动更新、布局管理、品牌和类似的东西。您构建的是产品，而不是应用程序。但是一开始的学习曲线非常陡峭。

另一方面，Swing 不是平台，您将通过编写我上面提到的自己的东西来重新发明轮子。但是，是的，swing 学习和上手的速度更快。我认为它更适合寿命较短的小型应用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-11-20T03:53:57.920

在打开 RCP 仅用于构建东西之前，[请查看 http://www.eclipse.org/community/rcp.php](http://www.eclipse.org/community/rcp.php)上的一些开源应用程序。

# flash - ActionScript 3.0 中缺少运算符重载

> ID：51007
> 
> 赞同：15
> 
> 时间：2008-09-09T00:23:28.447
> 
> 标签：flash, actionscript-3

我在 ActionScript 中最怀念的一件事是缺少运算符重载，尤其是 ==。我通过在我的类中添加一个“比较”方法来解决这个问题，但这在很多情况下并没有帮助，比如当你想使用内置字典之类的东西时。

有没有解决这个问题的好方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-09T06:52:00.353

没有。

但是将`equals`方法添加到您自己的类中并没有什么坏处。我尝试`==` 在比较对象时从不使用（对于对象也是如此`===`，对于对象也是如此），因为它只检查*身份*。

遗憾的是，Flash 和 Flex 中的所有集合都假定身份是唯一需要的平等衡量标准。

Flex中有提示说有人想一次性缓解这个问题，但好像被放弃了：有一个接口叫[IUID](http://livedocs.adobe.com/flex/201/langref/mx/core/IUID.html)，在*Flex开发者指南*中提到过，但是没有在任何地方使用。甚至 Flex 中的集合也没有使用它来确定相等性。而且由于您正在寻求 Flash 的解决方案，它可能对您没有任何帮助。

我在我的博客上写了更多关于这个（在 Flex 的上下文中）的内容：[没有平等吗？](http://blog.iconara.net/2007/11/25/architectural-atrocities-part-8-is-there-no-equality/).

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-01-24T17:02:46.190

是的，它可以做到（但要小心，它的hacky）： http: [//filimanjaro.com/2012/operators-overloading-in-as3-javascript-too-%E2%80%93-workaround/](http://filimanjaro.com/2012/operators-overloading-in-as3-javascript-too-%E2%80%93-workaround/)

在教程中，我写了关于 +=、-= 运算符重载的文章。但是==也可以，如果不清楚，我可以写更多。

啊，这种方法有一些缺点（在极少数情况下甚至可能很危险）。三思而后行，在生产中使用它之前。

**编辑：**

经过测试，似乎 +=, -= 的技巧不适用于 == 运算符（这是有道理的）。抱歉误导信息。

# python - 在python中找到2次之间差异的最简单方法是什么？

> ID：51010
> 
> 赞同：13
> 
> 时间：2008-09-09T00:28:58.420
> 
> 标签：python, datetime, time

我有 2 个时间值，它们的类型为`datetime.time`. 我想找出他们的不同之处。显而易见的事情是 t1 - t2，但这不起作用。它适用于类型的对象，`datetime.datetime`但不适用于`datetime.time`. 那么最好的方法是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-09T00:53:24.320

也有点傻，但是您可以尝试选择任意一天并每次都嵌入其中，使用`datetime.datetime.combine`，然后减去：

```
>>> import datetime
>>> t1 = datetime.time(2,3,4)
>>> t2 = datetime.time(18,20,59)
>>> dummydate = datetime.date(2000,1,1)
>>> datetime.datetime.combine(dummydate,t2) - datetime.datetime.combine(dummydate,t1)
datetime.timedelta(0, 58675) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-09T00:42:31.287

您可以将两者都转换为[timedelta 对象](http://docs.python.org/lib/datetime-timedelta.html)并将它们相互减去，这将处理结转。例如：

```
>>> import datetime as dt
>>> t1 = dt.time(23, 5, 5, 5)
>>> t2 = dt.time(10, 5, 5, 5)
>>> dt1 = dt.timedelta(hours=t1.hour, minutes=t1.minute, seconds=t1.second, microseconds=t1.microsecond)
>>> dt2 = dt.timedelta(hours=t2.hour, minutes=t2.minute, seconds=t2.second, microseconds=t2.microsecond)
>>>  print(dt1-dt2)
13:00:00
>>> print(dt2-dt1)
-1 day, 11:00:00
>>> print(abs(dt2-dt1))
13:00:00 
```

Python 中的负 timedelta 对象得到一个负的 day 字段，而其他字段为正。您可以事先检查：比较适用于时间对象和 timedelta 对象：

```
>>> dt2 < dt1
True
>>> t2 < t1
True 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-20T16:13:22.197

Python 有 pytz ( [http://pytz.sourceforge.net](http://pytz.sourceforge.net) ) 模块，可用于“时间”对象的算术运算。它也处理 DST 偏移量。上面的页面有许多示例说明了 pytz 的用法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T00:37:28.507

这似乎不受支持，因为在 datetime.time 中没有处理溢出的好方法。我知道这不是直接的答案，但也许比我有更多 python 经验的人可以更进一步。有关更多信息，请参阅：[http ://bugs.python.org/issue3250](http://bugs.python.org/issue3250)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-09T00:47:48.343

首先，请注意 datetime.time 是一天中的时间，独立于给定的一天，因此任何两个 datetime.time 值之间的差异将小于 24 小时。

一种方法是将两个 datetime.time 值转换为可比较的值（例如毫秒），然后找出差异。

```
t1, t2 = datetime.time(...), datetime.time(...)

t1_ms = (t1.hour*60*60 + t1.minute*60 + t1.second)*1000 + t1.microsecond
t2_ms = (t2.hour*60*60 + t2.minute*60 + t2.second)*1000 + t2.microsecond

delta_ms = max([t1_ms, t2_ms]) - min([t1_ms, t2_ms]) 
```

这有点蹩脚，但它的工作原理。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-20T16:16:44.450

以毫秒为单位检索时间，然后进行减法。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-11-04T21:05:21.760

如果您需要快速的东西，Environment.TickCount 似乎运作良好。

int start = Environment.TickCount

...做点什么（）

int elapsedtime = Environment.TickCount - 开始

乔恩

# windows-xp - 对 WinXP PS/2 触摸板驱动程序进行逆向工程的最佳工具？

> ID：51011
> 
> 赞同：1
> 
> 时间：2008-09-09T00:31:42.250
> 
> 标签：windows-xp, reverse-engineering, drivers, black-box

我有一个 PS/2 触摸板，我想为它编写一个驱动程序（我只是一个网络人，所以这对我来说是一个陌生的领域）。触摸板带有一个 Windows XP 驱动程序，该驱动程序显然会发送消息以启用/禁用点击点击。我试图找出它正在发送什么消息，但我不知道如何开始。像“Syser Debugger”这样的软件可以工作吗？我想拦截发送到 PS/2 总线的传出消息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-09T01:07:09.730

如果您想找出正在发送的“消息”，IDA Pro 对您没有多大用处。您应该意识到这对大多数 Web 开发人员来说是一个很大的进步，但您已经知道了吗？

我会首先决定您是否真的需要在驱动程序级别工作，通常这是内核级别。用户模式级别可能是您首先要查看的位置。使用诸如 WinSpy 或其他 Windows 调试工具之类的工具来找出驱动程序软件传递的[消息](http://msdn.microsoft.com/en-us/library/ms644927.aspx)以及控制面板中的鼠标配置小程序。您可以使用称为[SendMessage()](http://msdn.microsoft.com/en-us/library/ms644950(VS.85).aspx)的 Windows API 函数将消息从用户模式发送到应用程序。

设备驱动程序开发的第一站应该是[Windows DDK 文档](http://www.microsoft.com/whdc/devtools/wdk/default.mspx)和[OSR Online](http://www.osronline.com/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T07:16:56.733

[我建议阅读http://www.synaptics.com/decaf/utilities/ACF126.pdf](http://www.synaptics.com/decaf/utilities/ACF126.pdf)此处提供的突触触摸板规格（笔记本上安装的大多数触摸板都是突触的） 我相信在第 18 页上，您会找到您想要的功能正在找。至少你会知道会发生什么。

因此，触摸板驱动程序很可能会将来自用户模式的命令“转换”为这个 PS/2 命令。

我不知道触摸板 PS/2 驱动程序的细节，但我看到用户模式面板与驱动程序通信的两种主要方式： - 更新注册表中的某些键（这实际上很常见） - 驱动程序提供了一个用户模式应用程序打开并写入特定命令的备用“通道”

在设置/重置功能时，您可能想尝试使用 sysinternals 的进程监视器来记录注册表活动。至于选项 2，您可能想尝试使用 OSR 的 IRP 跟踪器，看看面板和驱动程序之间是否有任何特定的通信（以来回的形式或 IRP 的形式）。在这种情况下，有点需要内核编程知识。Windows 内核调试器也可能有助于查看 PS/2 驱动程序是否有一些备用通道。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T00:53:42.040

看看[IDA Pro](http://www.hex-rays.com/idapro/) - 交互式反汇编程序。这是一个了不起的反汇编程序。

如果你想调试，而不仅仅是逆向工程，试试 SmidgeonSoft 的 PEBrowse Professional [Interactive](http://www.smidgeonsoft.prohosting.com/pebrowse-pro-interactive-debugger.html)

# apache-flex - 在 Flex 应用程序中显示 HTML

> ID：51013
> 
> 赞同：2
> 
> 时间：2008-09-09T00:35:32.007
> 
> 标签：apache-flex, actionscript-3

我有一些 HTML 是通过我的 Flex 应用程序外部的富文本编辑器生成的，但想在 Flex 中显示它。

HTML 是简单的 HTML 标签，例如样式、锚点和可能的图像标签，是否有控件可以让我在 flex 中呈现此 HTML，还是我必须卷起袖子自己动手？

任何想法表示赞赏...谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-09T01:18:21.670

如果 HTML*真的很*简单，你可以在普通的 label 或 textarea 组件中显示它，如果它更复杂，我会引用我[在这个问题中](https://stackoverflow.com/questions/22909/is-there-some-way-to-show-html-content-inside-flash)回答的内容。那里的讨论也有更多信息。

> 如果它是复杂的 HTML 和 Javascript，一种可能的方法是[HTMLComponent](http://drumbeatinsight.com/htmlcomponent)，一种在 Flash 上使用 iframe 的方法，使其看起来就像 HTML 在您的应用程序中一样。然而，这种方法也有一些缺点——其中大部分都[在 Deitte.com](http://www.deitte.com/archives/2008/07/dont_use_iframe.htm)上进行了详细描述。
> 
> 如果它可以离线，你可以使用 Air（它有一个内置的 mx:HTML 组件）。[Deitte.com](http://www.deitte.com/archives/2008/07/an_air_version.htm)也详细介绍了这种技术。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T06:40:52.550

查看 and 上的文档[`mx.controls.Label`](http://livedocs.adobe.com/flex/2/langref/mx/controls/Label.html#htmlText)（[`flash.text.TextField`](http://livedocs.adobe.com/flex/2/langref/flash/text/TextField.html#htmlText)这是在 Flex中的 a`Text`或控件中显示文本的内容）。`Label`该`TextField`文件指出

> <img> 标签允许您在文本字段中嵌入外部图像文件（JPEG、GIF、PNG）、SWF 文件和影片剪辑。文本会自动围绕您嵌入文本字段的图像流动。要使用此标签，您必须将文本字段设置为多行并换行。

这意味着您可以通过将其属性设置为包含标签的某些 HTML 来`Text`在 Flex 中的组件中显示图像。您不能使用，因为它不是多行的。`htmlText``<img>``Label`

我注意到，如果文本字段中显示的图像与围绕它们的文本左对齐或右对齐（例如`align="left"`），则文本字段无法正确测量其高度。如果您打算使用对齐的图像，您可能需要在下面添加一些额外的间距来应对这种情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-03T13:00:09.483

您将不得不使用 flex iFrame 控件。它不是一个 100% 的 flash 解决方案，它结合了一些 js 调用，但对我来说非常完美。

[您可以从 github https://github.com/flex-users/flex-iframe](https://github.com/flex-users/flex-iframe)获取最新的源代码

这是组件作者的一些示例代码。

```
<!---
    A basic example application showing how to embed a local html page in a Flex application.

    @author Alistair Rutherford
-->
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
                xmlns:flexiframe="http://code.google.com/p/flex-iframe/"
                horizontalAlign="center"
                verticalAlign="middle"
                viewSourceURL="srcview/index.html">

    <!-- Example project presentation -->
    <mx:ApplicationControlBar dock="true">
        <mx:Text selectable="false">
            <mx:htmlText><![CDATA[<font color="#000000" size="12"><b>flex-iframe - Simple html example</b><br>This example shows how to embed a simple Html page in a Flex application.</font>]]></mx:htmlText>
        </mx:Text>
    </mx:ApplicationControlBar>

    <!-- HTML content stored in a String -->
    <mx:String id="iFrameHTMLContent">
        <![CDATA[
            <html>
                <head>
                    <title>About</title>
                </head>
                <body>
                    <div>About</div>
                    <p>Simple HTML Test application. This test app loads a page of html locally.</p>
                    <div>Credits</div>
                    <p> </p>
                    <p>IFrame.as is based on the work of</p>
                    <ul>
                      <li><a href="http://coenraets.org/" target="_top">Christophe Coenraets</a></li>
                      <li><a href="http://www.deitte.com/" target="_top">Brian Deitte</a></li>
                    </ul>
                </body>
            </html>
        ]]>
    </mx:String>

    <!-- Example using the 'source' property -->
    <mx:Panel title="A simple Html page embedded with the 'source' property"
              width="80%"
              height="80%">

        <flexiframe:IFrame id="iFrameBySource"
                           width="100%"
                           height="100%"
                           source="about.html"/>
    </mx:Panel>

    <!-- Example using the 'content' property -->
    <mx:Panel title="A simple Html page embedded with the 'content' property"
              width="80%"
              height="80%">

        <flexiframe:IFrame id="iFrameByContent"
                           width="100%"
                           height="100%"
                           content="{iFrameHTMLContent}"/>
    </mx:Panel>

</mx:Application> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T15:30:56.283

@mmattax

Indeed you can display images in a TextArea component. The approach [is not entirely without problems though](http://aralbalkan.com/239)...

# php - 确定 PHP 代码的性能后果

> ID：51017
> 
> 赞同：6
> 
> 时间：2008-09-09T00:39:44.430
> 
> 标签：php, performance

如果您不熟悉内部结构，如何确定 PHP 代码的性能影响？有没有办法弄清楚你的代码是如何被执行的（除了简单的负载测试）？我正在寻找诸如内存使用、算法执行时间之类的东西。

也许 Joel 会说，“先学习 C，然后再阅读内部原理”，但我现在真的没有时间学习 C（尽管实际上我很愿意）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T00:56:19.663

使用[Xdebug](http://www.xdebug.org/)扩展来分析 PHP 代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T08:10:05.300

如果您不熟悉 valgrind 或类似内容，请添加到@Jordi Bunster 的答案中......

在 Xdebug 中进行分析后，您可以在 KCacheGrind 或 WinCacheGrind 中打开转储的配置文件，以获取代码中花费时间的图形视图。

幸运的是，xdebug 文档也详细解释了这一点以及如何解释结果：http: [//xdebug.org/docs/profiler](http://xdebug.org/docs/profiler)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T15:08:58.047

即使您熟悉内部结构，您仍然应该对您的假设进行负载测试。我喜欢使用[PEAR Benchmark](http://pear.php.net/package/Benchmark)包来比较不同的代码。

如果您可以隔离代码，则可以使负载测试保持简单。一种典型的技术是多次运行每个选项，看看哪个更快。例如，如果你有一堂课，你可以编写一个测试用例，让它通过它的步伐并运行几次。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-09T06:37:16.160

您可以使用低级方法，例如粘贴`microtime()`和`memory_get_usage()`调用代码，也可以使用现有的分析解决方案之一：

1.  [Xdebug](http://xdebug.org/)（免费，开源）
2.  [Zend Studio/调试器](http://www.zend.com/en/products/studio/features#debug)分析（商业）
3.  [Zend 服务器代码跟踪](http://www.zend.com/products/server/zend-server-code-tracing)（商业）
4.  [xhprof](http://mirror.facebook.net/facebook/xhprof/doc.html)（免费，开源）

像往常一样，商业工具有漂亮的图形用户界面和漂亮的图片，但要花钱，免费的是免费的，但你可能需要投入更多的时间。

此外，PHP CGI 二进制文件有一个带有`-T`选项的基准测试模式，许多人尝试运行`php-cgi -T 100 yourscript.php`来做一个穷人的基准测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-03T17:28:55.317

请参阅[SD PHP Profiler](http://www.semanticdesigns.com/Products/Profilers/PHPProfiler.html)，了解一种可以以图形方式向您显示 PHP 应用程序花费时间的工具。

# postgresql - PostgreSQL 进程“在事务中空闲”是什么意思？

> ID：51019
> 
> 赞同：96
> 
> 时间：2008-09-09T00:40:53.413
> 
> 标签：postgresql

[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)进程“在事务中空闲”是什么意思？

在我正在查看的服务器上，“ps ax | grep postgres”的输出我看到 9 个 PostgreSQL 进程，如下所示：

```
postgres: user db 127.0.0.1(55658) idle in transaction 
```

这是否意味着某些进程已挂起，等待提交事务？任何指向相关文档的指针表示赞赏。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-09T01:07:21.900

[PostgreSQL 手册](http://www.postgresql.org/docs/8.3/interactive/monitoring-ps.html)指出这意味着事务是打开的（在 BEGIN 内部）并且处于空闲状态。很可能是使用正在思考或打字的显示器连接的用户。我的系统上也有很多。

但是，如果您使用 Slony 进行复制，[Slony-I FAQ](http://slony1.projects.postgresql.org/slony1-1.2.6/doc/adminguide/faq.html)建议`idle in transaction`可能意味着网络连接突然终止。查看该常见问题解答中的讨论以获取更多详细信息。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-16T22:55:20.637

如此处所述：[Re: BUG #4243: Idle in transaction](http://archives.postgresql.org/pgsql-bugs/2008-06/msg00102.php)最好检查您的 pg_locks 表以查看被锁定的内容，这可能会让您更好地了解问题所在。

# ruby - 在 Ruby 中引发异常与抛出异常有什么区别？

> ID：51021
> 
> 赞同：186
> 
> 时间：2008-09-09T00:41:03.070
> 
> 标签：ruby, exception

Ruby 有两种不同的异常机制：Throw/Catch 和 Raise/Rescue。

为什么我们有两个？

什么时候应该使用一个而不是另一个？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2012-01-01T06:18:28.930

*   `raise`, `fail`, `rescue`, 和`ensure`处理**错误**，也称为**异常**
*   `throw`并且`catch`是**控制流**

> 与其他语言不同，Ruby 的 throw 和 catch 不用于异常。相反，它们提供了一种在不需要进一步工作时提前终止执行的方法。（格林，2011）

`while`可以使用简单的`return`. 终止多层控制流，如嵌套循环，可以使用`throw`.

> 虽然 raise 和 rescue 的异常机制非常适合在出现问题时放弃执行，但在正常处理期间能够跳出一些深度嵌套的构造有时会很好。这就是 catch 和 throw 派上用场的地方。（托马斯和亨特，2001）

### 参考

1.  格林，阿维迪。“投、接、举、救……我好糊涂！” Ruby 学习博客。Np，2011 年 7 月 11 日。网络。2012 年 1 月 1 日。http [://rubylearning.com/blog/2011/07/12/throw-catch-raise-rescue--im-so-confused/](http://rubylearning.com/blog/2011/07/12/throw-catch-raise-rescue--im-so-confused/)。
2.  托马斯、戴夫和安德鲁·亨特。“编程红宝石。” : 实用程序员指南。Np，2001 年。网络。2015 年 9 月 29 日。http [://ruby-doc.com/docs/ProgrammingRuby/html/tut_exceptions.html](http://ruby-doc.com/docs/ProgrammingRuby/html/tut_exceptions.html)。

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2008-09-09T00:50:02.753

我认为[http://hasno.info/ruby-gotchas-and-caveats](http://hasno.info/ruby-gotchas-and-caveats)对差异有一个不错的解释：

> 接/投与举/救不同。catch/throw 允许您将块快速退出到为特定符号定义捕获的点，引发救援是涉及 Exception 对象的真正异常处理内容。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-12-03T16:42:02.623

[https://coderwall.com/p/lhkkug/don-t-confuse-ruby-s-throw-statement-with-raise](https://coderwall.com/p/lhkkug/don-t-confuse-ruby-s-throw-statement-with-raise)提供了一个很好的解释，我怀疑我可以改进。总而言之，我从博客文章中截取了一些代码示例：

1.  `raise`/是您从其他语言（或 Python 的/ ）熟悉的/构造`rescue`最接近的类似物。如果您遇到了错误情况并且您将使用另一种语言来解决它，那么您应该使用 Ruby。`throw``catch``raise``except``throw``raise`

2.  Ruby 的`throw`/`catch`让你中断执行并爬上堆栈寻找`catch`（like `raise`/ `rescue`dos），但实际上并不意味着错误条件。它应该很少使用，并且仅用于当“遍历堆栈直到找到相应的`catch`”行为对您正在编写的算法有意义但将其`throw`视为对应于错误是没有意义的健康）状况。

    [Ruby 中的 catch 和 throw 有什么用？](https://stackoverflow.com/questions/3716801/what-is-catch-and-throw-used-for-in-ruby/)`throw`提供了一些关于/`catch`构造的好用的建议。

它们之间的具体行为差异包括：

*   `rescue Foo`将拯救`Foo`包括`Foo`. `catch(foo)`只会捕获*相同的对象，`Foo`* . 您不仅不能传递`catch`类名来捕获它的实例，而且它甚至不会进行相等比较。例如

    ```
    catch("foo") do
      throw "foo"
    end 
    ```

    会给你一个`UncaughtThrowError: uncaught throw "foo"`（或`ArgumentError`2.2 之前的 Ruby 版本）

*   可以列出多个救援条款...

    ```
    begin
      do_something_error_prone
    rescue AParticularKindOfError
      # Insert heroism here.
    rescue
      write_to_error_log
      raise
    end 
    ```

    而多个`catch`es需要嵌套...

    ```
    catch :foo do
      catch :bar do
        do_something_that_can_throw_foo_or_bar
      end
    end 
    ```

*   一个bare`rescue`等价于`rescue StandardError`并且是一个惯用的构造。“裸`catch`”，如`catch() {throw :foo}`，永远不会捕获任何东西，也不应该使用。

# web-applications - 在 Haskell 中编写 Web 应用程序的最简单方法是什么？

> ID：51022
> 
> 赞同：19
> 
> 时间：2008-09-09T00:41:03.803
> 
> 标签：web-applications, haskell

我想在我的项目中更多地使用 Haskell，我认为如果我可以开始将它用于 Web 应用程序，那真的会有所帮助。我已经尝试过一次或两次，但在起步时遇到了麻烦。是否有更简单/更传统（更像灯）的框架可供我使用，还是我应该再试一次？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-04-17T19:22:29.817

截至 2011 年的最佳工具是：

*   [折断](http://snapframework.com/)
*   [是的](http://www.yesodweb.com/)；或者
*   [Happstack](http://happstack.com/)

围绕 Haskell 的 Web 开发社区一直在这些社区之间的竞争中蓬勃发展。

作者甚至在这里比较他们的框架：[比较 Haskell 的 Snap 和 Yesod Web 框架](https://stackoverflow.com/questions/5645168/comparing-haskells-snap-and-yesod-web-frameworks)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T00:59:59.177

如果您决定使用 HApps，您可能需要查看这个正在开发为 HApps 应用程序的优秀示例驱动教程： [HApps 教程](http://happstutorial.com:5001/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-04-26T09:08:50.923

我以最高功能/代码大小比的想法开发了 MFlow。MFlow 没有考虑其他框架，而是最大限度地使用 Haskell 来解决 Web 应用程序的问题，从而大幅降低 Web 编程中的噪音和错误率。MFlow 应用程序中的整个导航在编译时是安全的。它使用标准网络库：WAI、formlets、stm、blaze-html..

自己判断：这是一个包含三页的完整应用程序。在一个循环中，它要求两个数字并显示总和。您可以随意按下后退按钮：

```
module Main where
import MFlow.Wai.Blaze.Html.All

main= do
   addMessageFlows  [("sum", transient . runFlow $ sumIt )]
   wait $ run 8081 waiMessageFlow

sumIt= do
   setHeader $ html . body
   n1 <- ask $  p << "give me the first number"  ++>  getInt Nothing
   n2 <- ask $  p << "give me the second number" ++>  getInt Nothing
   ask $ p << ("the result is " ++ show (n1 + n2)) ++> wlink () << p << "click here" 
```

只需稍作修改，即可使状态持久化。

[http://hackage.haskell.org/package/MFlow](http://hackage.haskell.org/package/MFlow)

这里有例子：http: [//haskell-web.blogspot.com.es/](http://haskell-web.blogspot.com.es/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T06:21:32.253

这是[来自 wiki 的有关 Haskell 的网络相关博客文章列表](http://haskell.org/haskellwiki/Blog_articles/Web)。

此外，下一个大的 Haskell Web 框架是[WASH](http://www.informatik.uni-freiburg.de/~thiemann/haskell/WASH/)。

并且有一个[基于域特定语言的 Apple webobjects](http://www.cs.uu.nl/wiki/WebFunctions/WebHome)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-10-22T18:43:13.253

[Web 应用程序接口](http://hackage.haskell.org/package/wai)WAI 是一个非常好的基础层，您可以在其上构建应用程序。有很多关于 hackage 的不错的库，用于路由、模板等，它们与 WAI 结合使用效果很好，这就是我所做的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T15:16:46.410

您可以使用 CGI 和 (x)html 组合库，如 wiki 的[Haskell Web Development](http://www.haskell.org/haskellwiki/Practical_web_programming_in_Haskell)文章中所列。可以在 Haskell 中的[实用 Web 编程中找到有关 Haskell](http://www.haskell.org/haskellwiki/Applications_and_libraries/Web_programming)中 Web 编程的库、框架等的更大概述。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-10-21T09:54:42.610

Yesod 将是一个不错的选择，您可以在线找到 O'Reilly 的[Yesod Web Framework Book](http://www.yesodweb.com/book)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T08:52:44.047

还有[Hope](http://hope.bringert.net/about)（链接已贬值），尽管它似乎没有像[HApps](http://happs.org/)和[WASH](http://www2.informatik.uni-freiburg.de/~thiemann/WASH/)那样获得那么多的牵引力。然而，该网站也已经安静了大约一年。

# database - 非关系型数据库系统

> ID：51027
> 
> 赞同：6
> 
> 时间：2008-09-09T00:46:48.487
> 
> 标签：database

还有哪些其他类型的数据库系统。我最近遇到了以非关系方式处理数据的 couchDB。这让我想到了其他人正在使用的其他模型。

所以，我想知道还有哪些其他类型的数据模型。（我不是在寻找任何细节，只是想看看其他人是如何处理数据存储的，我的兴趣纯粹是学术性的）

我已经知道的有：

1.  关系型数据库（mysql、postgres 等）
2.  基于文档的方法（couchDB、lotus notes）
3.  键/值对 (BerkeleyDB)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-09T00:47:54.473

[db4o](http://www.db4o.com)

从“关于”页面引用：

> db4o 是开放源代码对象数据库，它使 Java 和 .NET 开发人员只需一行代码即可存储和检索任何应用程序对象，无需预定义或维护单独的、严格的数据模型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T00:59:45.380

较旧的非关系数据库：

[网络数据库](http://en.wikipedia.org/wiki/Network_database)

[分层数据库](http://en.wikipedia.org/wiki/Hierarchical_database)

当关系变得可行时，两者大多都过时了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-15T02:29:27.650

[语义网](http://en.wikipedia.org/wiki/Semantic_web)也是一种非关系型数据存储范式。没有关系，所有元数据都以与数据相同的方式存储，每个实体都可能有自己独特的属性集。实现 RDF（语义 Web 标准）的开源项目包括[Jena](http://jena.sourceforge.net/)和[Sesame](http://www.openrdf.org/about.jsp)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T01:05:28.783

[面向列的数据库](http://en.wikipedia.org/wiki/Column-oriented_DBMS)也有点不同。他们中的许多确实支持标准的关系数据库 SQL。这些通常用于数据仓库类型的应用程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-17T14:20:06.110

我想详细了解 Bill Karwin 关于语义网和三联商店的回答，因为这是我目前正在研究的内容，我对此有话要说。

Triplestore 背后的想法是存储基于图的数据库，其数据模型源于 RDF。使用 RDF，您可以描述节点和节点之间的关联（换句话说，边）。数据按三元组组织：

```
start node ----relation----> end node 
```

（在 RDF 演讲中：主语--谓语--> 宾语）。有了这个非常简单的数据模型，任何数据网络都可以通过添加越来越多的三元组来表示，只要你给节点和关系赋予意义。

RDF 非常通用，它是一个基于图的数据模型，非常适合用于查找所有三元组的搜索条件，该三元组具有主语、谓语或宾语的特定组合，可以任意组合。最终，通过一种称为 SPARQL 的查询语言，您还可以执行更复杂的查询，该操作归结为对图的图同构搜索，无论是在拓扑方面还是在节点边含义方面（我们将看到这个一会儿）。SPARQL 只允许您选择（和类似的）查询。没有删除，没有插入，没有更新。您查询的信息（例如您感兴趣的特定节点）被映射到一个表中，这是您查询的结果。

现在，拓扑本身并不意味着什么。为此，发明了一种模式语言。实际上，不止一种，在某些情况下，称它们为模式语言是非常有限的。今天最著名和使用的是 RDF-Schema、OWL（Lite 和 Full），它们早于过时的 DAML+OIL。这些语言的重点是，简化东西，为节点（通过授予它们一种类型，也称为三元组）和关系（边）赋予意义。此外，您可以定义这些关系的“范围”和“域”，或者说什么类型是起始节点，什么类型是结束节点：例如，您可以说属性“numberOfWheels”只能应用将 Vehicle 类型的节点连接到非零整数值。

```
 ns:MyFiat --rdf:type--> ns:Vehicle
 ns:MyFiat --ns:numberOfWheels-> 4 
```

现在，您可以在两个方向使用这些本体：验证和推理。今天的验证并不那么花哨，但我已经看到了使用实例。推理是今天很酷的东西，因为它允许推理。推理基本上采用包含一组三元组的 RDF 图，采用本体，将它们混合到包含“推理引擎”的三元组数据库中，并且推理引擎根据您的本体描述发明三元组。示例：假设您只是将此信息存储在数据库中

```
ns:MyFiat --ns:numberOfWheels--> 4 
```

没有别的了。没有指定关于这个节点的类型，但推理引擎会自动添加一个三元组，说明

```
ns:MyFiat --rdf:type--> ns:Vehicle 
```

因为您在本体中说过，只有 Vehicle 类型的对象才能由属性 numberOfWheels 描述。

相反，您可以使用推理引擎根据本体验证您的数据，从而拒绝不符合要求的数据（有点像 XML-Schema for XML）。在这种情况下，您将需要两个三元组才能使三元组成功接受您的数据。

Triplestore 的其他特性是公式和上下文感知存储。公式是描述假设事物的陈述（像往常一样，三元组主谓宾语）。我从来没有使用过公式，所以我不会详细介绍我不知道的东西。上下文感知基本上是子图：存储三元组的问题是您无法说明这些三元组的来源。假设您有两个经销商，他们描述了相同价格的组件。一个说价格是 5.99，另一个说是 4.99。如果您只是将两个三元组都存储到数据库中，那么您现在对谁陈述每个信息一无所知。有两种方法可以解决这个问题。

一是物化。具体化意味着您存储额外的三元组来描述另一个三元组。这很浪费，而且让生活变得地狱，因为你必须具体化你存储的每一个三元组。另一种方法是上下文感知。具有上下文感知存储就像能够将一堆三元组装入一个带有标签（上下文标识符）的容器中。您现在可以将此标识符用作附加语句的主题，从而在单个操作中描述一堆三元组。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-15T01:13:38.957

我们一直在研究的面向非关系文档的数据库是[Apache CouchDB](http://incubator.apache.org/couchdb/)。

> Apache CouchDB 是一个分布式、容错和无模式的面向文档的数据库，可通过 RESTful HTTP/JSON API 访问。除其他功能外，它还提供具有双向冲突检测和解决的强大的增量复制功能，并且可以使用面向表的视图引擎（以 JavaScript 作为默认视图定义语言）进行查询和索引。

我们的兴趣是提供一个分布式访问用户首选项存储，该存储不受形状变化的影响，我们可以从 Java 序列化首选项对象，并使用基于 XULRunner 的客户端应用程序的 Javascript 轻松访问这些对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-09T00:48:35.080

亚马逊的[SimpleDB](http://www.amazon.com/gp/browse.html?node=342335011)不是非关系型的吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-09T00:49:33.253

正如 Eric 所提到的，db4o 是一个[面向对象的数据库管理系统](http://en.wikipedia.org/wiki/Object_database)(OODBMS)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-09T00:53:01.763

有基于对象的数据库（例如 Gemstore）。Google 的 Big-Table 和 Amason 的 Simple Storage 我不确定您会如何分类，但两者都是基于 map-reduce 的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-04T15:27:09.133

还有所谓的“倒排索引”或“倒排列表”数据库。Software AG 的**Adabas**产品就是一个例子。与分层数据库一样，这些数据库由于遗留问题或在某些情况下（通常是高端事务应用程序）的性能优势而继续在大型企业或大学环境中使用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-16T13:41:39.947

# 4\. 导航。包括树/层次结构和图形/网络。

文件系统、语义网、XML、对象数据库、CODASYL 和许多其他都属于这一类。

这4个差不多。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-13T15:57:26.193

有 BASE 系统（基本可用、软状态、最终一致），它们与保存大量数据的简单数据模型配合得很好。Google 的 BigTable、Dojo 的 Persevere、Amazon 的 Dynamo、Facebook 的 Cassandra 就是一些例子。

见[链接](http://queue.acm.org/detail.cfm?id=1394128)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-04-17T13:39:14.897

照明相关数据库是一种新的革命性非关系数据库。关联数据库管理系统 (CDBMS) 独立于数据模型，旨在有效处理分析系统环境中的计划外、即席查询。与关系数据库管理系统或面向列的数据库不同，相关数据库使用基于值的存储 (VBS) 架构，其中每个唯一数据值仅存储一次，并且自动生成的索引系统维护所有值的上下文（数据是100% 索引）。使用自然语言而不是 SQL (NoSQL) 执行查询。

了解更多信息：www.datainnovationsgroup.com

# windows - 在没有可见控制台窗口的窗口中创建后台进程

> ID：51028
> 
> 赞同：7
> 
> 时间：2008-09-09T00:47:21.603
> 
> 标签：windows, haskell

如何在没有创建可见命令窗口的情况下在 Windows 上使用 Haskell 创建后台进程？

我编写了一个定期运行备份进程的 Haskell 程序，但每次运行它时，都会在所有窗口的顶部打开一个命令窗口。我想摆脱这个窗口。最简单的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T17:00:11.687

您确实应该告诉我们您当前是如何尝试执行此操作的，但是在我的系统（使用 linux）上，以下代码段将运行命令而无需打开新的终端窗口。它应该在 Windows 上以相同的方式工作。

```
module Main where
import System
import System.Process
import Control.Monad

main :: IO ()
main = do
  putStrLn "Running command..."
  pid <- runCommand "mplayer song.mp3" -- or whatever you want
  replicateM_ 10 $ putStrLn "Doing other stuff"
  waitForProcess pid >>= exitWith 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-12T02:54:20.183

感谢您到目前为止的回复，但我找到了自己的解决方案。我确实尝试了很多不同的东西，从按照建议编写一个 vbs 脚本到一个名为 hstart 的独立程序。hstart 工作......但它创建了一个我不太喜欢的单独进程，因为我无法以正常方式杀死它。但我找到了一个更简单的解决方案，只需要 Haskell 代码。

我之前的代码是对 runCommand 的简单调用，它确实弹出了窗口。您可以使用的替代功能是具有更多选项的[runProcess 。](http://hackage.haskell.org/packages/archive/process/1.0.0.0/doc/html/System-Process.html#v%3ArunProcess)通过查看 ghc 源代码文件 runProcess.c，我发现当您为所有 STDIN、STOUT 和 STDERR 提供重定向时，会设置 CREATE_NO_WINDOW 标志。所以这就是你需要做的，为那些提供重定向。我的测试程序如下所示：

```
import System.Process
import System.IO
main = do
  inH <- openFile "in" ReadMode
  outH <- openFile "out" WriteMode
  runProcess "rsync.bat" [] Nothing Nothing (Just inH) (Just outH) (Just outH) 
```

这行得通！再次没有命令窗口！需要注意的是，您需要一个空文件供 inH 作为 STDIN 读入，尽管在我的情况下不需要它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T00:59:53.790

我能想到的最简单的方法是从 Windows Shell 脚本（vbs 或 cmd）中运行 rsync 命令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T14:13:47.093

我对Haskell一无所知，但几个月前我在一个C项目中遇到了这个问题。

在不弹出任何窗口的情况下执行外部程序的最佳方法是使用带有“open”动词的 ShellExecuteEx() API 函数。如果您在 Haskell 中可以使用 ShellExecuteEx()，那么您应该能够实现您想要的。

C 代码如下所示：

```
SHELLEXECUTEINFO Info;
BOOL b;

// Execute it
memset (&Info, 0, sizeof (Info));
Info.cbSize = sizeof (Info);
Info.fMask = SEE_MASK_NOCLOSEPROCESS | SEE_MASK_FLAG_NO_UI;
Info.hwnd = NULL;
Info.lpVerb = "open";
Info.lpFile = "rsync.exe";
Info.lpParameters = "whatever parameters you like";
Info.lpDirectory = NULL;
Info.nShow = SW_HIDE;
b = ShellExecuteEx (&Info);
if (b)
   {
   // Looks good; if there is an instance, wait for it
   if (Info.hProcess)
      {
      // Wait
      WaitForSingleObject (Info.hProcess, INFINITE);
      }
   } 
```

# c++ - C++ 或 C 中的 foo(void) 和 foo() 有区别吗？

> ID：51032
> 
> 赞同：270
> 
> 时间：2008-09-09T00:48:23.630
> 
> 标签：c++, c, arguments

考虑这两个函数定义：

```
void foo() { }

void foo(void) { } 
```

这两者有什么区别吗？如果不是，为什么会有`void`争论？审美原因？

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2008-09-09T01:34:28.060

在**C**中：

*   `void foo()`意思是“一个函数`foo`采用未指定数量的未指定类型的参数”
*   `void foo(void)`意思是“一个`foo`不带参数的函数”

在**C++**中：

*   `void foo()`意思是“一个`foo`不带参数的函数”
*   `void foo(void)`意思是“一个`foo`不带参数的函数”

因此，通过编写`foo(void)`，我们在两种语言之间实现了相同的解释并使我们的头文件多语言（尽管我们通常需要对头文件做更多的事情以使它们真正跨语言；也就是说，将它们包装在一个`extern "C"`if 我们正在编译C++）。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-09T00:55:08.467

我知道您的问题与 C++ 相关，但是当涉及到 C 时，可以在[K&R](https://en.wikipedia.org/wiki/The_C_Programming_Language)中找到答案，第 72-73 页：

> 此外，如果函数声明不包含参数，如
> 
> ```
> double atof(); 
> ```
> 
> 这也被认为意味着对 atof 的论点没有任何假设；关闭所有参数检查。空参数列表的这种特殊含义旨在允许旧的 C 程序使用新的编译器进行编译。但是将它与新程序一起使用是个坏主意。如果函数接受参数，则声明它们；如果不带参数，请使用 void。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-04-25T08:20:57.650

**C++11 N3337 标准草案**

没有区别。

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf)

*附录 C“兼容性”C.1.7 第 8 条：声明符*说：

> 8.3.5 更改：在 C++ 中，使用空参数列表声明的函数不接受任何参数。在 C 中，空参数列表意味着函数参数的数量和类型未知。
> 
> 例子：
> 
> ```
> int f();
> // means int f(void) in C ++
> // int f( unknown ) in C 
> ```
> 
> 基本原理：这是为了避免错误的函数调用（即，使用错误数量或类型的参数调用函数）。
> 
> 对原始特征的影响：改变定义明确的特征的语义。此功能在 C 中被标记为“过时”。

*8.5.3 功能*说：

> 4\. parameter-declaration-clause 确定在调用函数时可以指定的参数及其处理。[...] 如果参数声明子句为空，则该函数不接受任何参数。参数列表（void）相当于空参数列表。

**C99**

正如 C++11 所提到的，`int f()`没有指定任何关于参数的内容，并且已过时。

它可以导致工作代码或 UB。

我已经详细解释了 C99 标准：[https ://stackoverflow.com/a/36292431/895245](https://stackoverflow.com/a/36292431/895245)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T00:53:03.790

在 C 中，您在空函数引用中使用 void，以便编译器有一个原型，并且该原型“没有参数”。在 C++ 中，您不必告诉编译器您有一个原型，因为您不能省略原型。

# usability - 普通开发人员应该遵循哪些好的可用性指南？

> ID：51050
> 
> 赞同：28
> 
> 时间：2008-09-09T01:00:38.530
> 
> 标签：usability, ui-guidelines

我不是可用性专家，我真的不想成为其中的一员。

我只需要在编写用户界面时可以遵循的一小部分经验法则，以便我的产品具有良好的可用性。

起初我认为这个问题很容易回答“使用你的常识”，但如果它在我们开发人员中如此普遍，我们作为一个群体就不会以我们糟糕的界面而闻名。

有什么建议么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-09T01:15:08.573

![简单](https://i.stack.imgur.com/G5Xcl.png)

资料来源：[http ://stuffthathappens.com/blog/wp-content/uploads/2008/03/simplicity.png](http://stuffthathappens.com/blog/wp-content/uploads/2008/03/simplicity.png)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-09T01:03:17.493

阅读[史蒂夫·克鲁格 (Steve Krug) 的《不要让我思考》](https://rads.stackoverflow.com/amzn/click/com/0321344758)。这是一个很好的起点，也是一个简单的短读。

编辑：虽然这主要是为了网络可用性，但即使你正在做富客户端，它仍然是一个很好的阅读。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-17T17:10:58.270

真的只有两件事：

1.  “当程序的行为完全符合用户的预期时，用户界面就是精心设计的”——[引](http://www.joelonsoftware.com/uibook/fog0000000249.html)自 Joel Spolsky 的[《程序员用户界面设计》](http://www.joelonsoftware.com/BuytheBooks.html)
2.  将您的设计呈现在用户面前。真正的最终用户是最好的，但对于轻量级、快速的反馈，你无法击败走廊可用性测试，即抓住一个同事。

如果你记住 Joel 的建议，并确保你得到关于你所做的任何事情的反馈**并采取行动，**即迭代，你就不会走得太远。我会赞同 Steve Krug 的[Don't Make Me Think](http://www.sensible.com/buythebook.html)的推荐——这可能是我读过的最好的与工作相关的书，没有之一，它同样适用于桌面软件和网站。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-09T01:04:49.300

*   不要让事情以不同于用户期望的方式工作（即在 Web 表单中使用 Ajax 时打破“返回”按钮
*   跟随 KISS 校长

确实，某人发布的任何规则都将是主题的变体： **不要让您的用户思考**

“Don't Make Me Think”已经发布，另见 [Design of Everyday Things](https://rads.stackoverflow.com/amzn/click/com/0465067107)和[Designing with Web Standards](https://rads.stackoverflow.com/amzn/click/com/0321385551)，它们也非常适合轻量级的可用性阅读。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-09T02:21:55.777

Avoid [modes](http://www.osnews.com/story/18904/Common_Usability_Terms_pt_V_Modes). It's frustrating to a user when input works sometimes but not others, or does different things at different times.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-17T19:55:11.433

Here are some simple rules:

*   Fewer clicks are better.
*   Frequently used features should be easier to find.
*   Features for "advanced" users can be harder to find than the ones above.

Think about the number of mouse/keyboard clicks it takes a user to get to something.

PS - please don't tell the Microsoft Office 2008 people about this; the poor little guys would cry themselves to sleep tonight! :)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-09T01:07:42.490

我要给某人的最重要的一条建议是首先在 UI 上工作。笔和纸等等。这样，您就不会下意识地将按钮与函数、输入字段与变量等耦合。

最好的 UI 可能会让人难以编写代码，如果您的后端代码大部分是编写的，它会破坏您的思维。

除此之外，我会指出[Apple 的 Human Interface Guidelines](http://developer.apple.com/documentation/UserExperience/Conceptual/AppleHIGuidelines/XHIGIntro/chapter_1_section_1.html)。当然，如果您的平台不是 OS X，请使用带有大量盐分的 OS X 部分。在 OS X 中有效的东西可能在 Windows 上无效。你应该接受你平台的习语。

除了 OS X 的东西，该文档在基础上有一些很好的起点。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-09T12:40:30.463

我建议阅读[Enso](http://humanized.com/)创作者的这些[博客文章。](http://humanized.com/weblog/)

当然，他们会重复《日常事物
[的设计》](https://rads.stackoverflow.com/amzn/click/com/0465067107) 和《[关于面孔](https://rads.stackoverflow.com/amzn/click/com/0470084111)》等书籍中的指南/想法/建议，但尽管如此，这些帖子还是包含了很多见解，并且（IMO）它们是一本不错的读物。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T07:37:47.290

考虑将使用您的应用程序的用户。他们为什么使用它以及在什么情况下使用它？

*   大多数是专业用户吗？他们知道应用程序所在的领域并经常使用该应用程序吗？然后不要害怕在屏幕上添加大量数据，只要它为用户按逻辑排列（通常不是按字母顺序 :-)。想想股票经纪人或飞机驾驶舱的交易屏幕。
*   用户是临时用户吗？把事情简单化。避免上下文切换（每次在屏幕上保留所有/尽可能多的任务所需数据）。不要打破对 gui 小部件正常工作方式的期望。设计失败。
*   中间有什么？允许用户在 UI 中成长。跟踪使用情况，以便您以后确定用户似乎花费最多时间的地方，从而改进应用程序中最常用的区域。
*   在朋友和同事身上测试你的应用程序（走廊测试），看看他们是否能够有效地使用它。

这是一个开始。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-12T09:18:04.137

**（1）** **共同的行动应该尽可能少的努力，并且应该是显而易见的**；另一方面，很少需要的操作可能需要很多步骤，并且可以隐藏在菜单和对话框后面。为此，您应该始终通过列出**用例**来描述用户想要对应用程序执行的操作。

**(2)** UI**应该是自记录的**。该手册应集成在应用程序的对话框和菜单中，因为用户无需阅读单独的手册。例如，键盘快捷方式应显示在代表与其关联的操作的菜单项中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-10-10T02:14:37.570

What information does your user need, put that on the screen and nothing else. If you cannot define what the user needs - get another user.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-10-10T02:40:07.363

请记住，您的应用程序将是用户必须处理的众多应用程序之一。不要做事只是为了与众不同或 kewl。不要想出不寻常的图形、行为、术语或交互。使用标准的操作系统控件、约定、实用程序和行为。

让您的应用与其他应用互操作；允许剪切和粘贴数据，以其他应用程序可以读取的格式保存您的数据，并允许从其他应用程序导入数据而不是使用您的 UI。

如果您正在制作桌面应用程序，请不要尝试接管用户的计算机。保留用户的 Documents 文件夹、任务栏和应用程序首选项。不要更改计算机上已安装的任何内容。允许脚本或命令行交互。

如果您正在制作 Web 应用程序，请不要尝试接管浏览器。不要试图颠覆标准的菜单栏、历史、布局或字体。允许用户使用 Javascript 更改页面。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-03-12T10:32:31.333

除了这里的其他建议外，我还推荐[Jenifer Tidwell 的 Designing Interfaces](http://oreilly.com/catalog/9780596008031)作为熟悉 UI 约定的好方法。
此外，[The inmates are running the asylum By Alan Cooper](http://books.google.com/books?id=04cFCVXC_AUC&dq=inmates+are+running+the+asylum&printsec=frontcover&source=bn&hl=en&ei=BxeaS7uCL8yNjAersPmjDA&sa=X&oi=book_result&ct=result&resnum=4&ved=0CBsQ6AEwAw#v=onepage&q=&f=false)非常适合提供有关如何处理交互设计的见解。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-12T09:25:46.240

为高级用户提供键盘快捷键（即使它像“按回车键搜索”一样简单）

不要一次在屏幕上放太多。

如果您弹出一个消息框，您的用户通常不会阅读它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-03-12T09:48:18.413

*   **简单**胜于复杂
*   复杂胜于复杂（消除“嵌套 ifs”）
*   **直观**（好的元素不需要解释）
*   **遵循约定**（例如，下划线表示链接，红色表示错误，标签转到下一个字段等）
*   使用语义来应用逻辑（首先读取标题，然后读取段落）
*   空格很重要

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-03-12T10:38:20.480

Don't Make Me Think 的一个很好的后续是[Robert Hoekman](http://www.rhjr.net/)的[Designing the Obvious](https://rads.stackoverflow.com/amzn/click/com/032145345X)。它更专注于 Web 应用程序，而不是像 Krug 那样的网站。

# windows - 批处理文件删除超过 N 天的文件

> ID：51054
> 
> 赞同：720
> 
> 时间：2008-09-09T01:05:28.707
> 
> 标签：windows, date, batch-file, file-io, cmd

我正在寻找一种方法来删除批处理文件中超过 7 天的所有文件。我在网上搜索过，发现了一些包含数百行代码的示例，以及其他需要安装额外命令行实用程序才能完成任务的示例。

只需几行代码，就可以[在 BASH中完成类似的事情。](https://stackoverflow.com/questions/25785/delete-all-but-the-most-recent-x-files-in-bash)似乎至少可以为 Windows 中的批处理文件完成一些简单的操作。我正在寻找一种在标准 Windows 命令提示符下工作的解决方案，无需任何额外的实用程序。请不要使用 PowerShell 或 Cygwin。

* * *

## 回答 #1

> 赞同：1141
> 
> 时间：2008-09-09T01:18:27.380

享受：

```
forfiles -p "C:\what\ever" -s -m *.* -d <number of days> -c "cmd /c del @path" 
```

有关更多详细信息，请参阅[`forfiles`文档](http://ss64.com/nt/forfiles.html)。

有关更多好东西，请参阅*[Windows XP 命令行的 AZ 索引](http://www.ss64.com/nt/)*。

如果您的计算机上没有`forfiles`安装，请将其从任何[Windows Server 2003](http://en.wikipedia.org/wiki/Windows_Server_2003)复制到您的 Windows XP 计算机上的`%WinDir%\system32\`. 这是可能的，因为 EXE 在 Windows Server 2003 和 Windows XP 之间完全兼容。

Windows 和 Windows Server 的更高版本默认安装了它。

对于 Windows 7 和更新版本（包括 Windows 10）：

语法发生了一些变化。因此更新的命令是：

```
forfiles /p "C:\what\ever" /s /m *.* /D -<number of days> /C "cmd /c del @path" 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2011-05-27T08:40:36.753

运行以下[命令](https://technet.microsoft.com/en-us/library/cc733145.aspx)：

```
ROBOCOPY C:\source C:\destination /mov /minage:7
del C:\destination /q 
```

通过 robocopy 将所有文件（使用 /mov 移动文件然后删除它们，而不是 /move 移动整个文件树然后删除）移动到另一个位置，然后在该路径上执行删除命令，你就是所有好的。

此外，如果您有一个包含大量数据的目录，您可以使用`/mir`switch

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-08-24T14:55:55.933

Ok 有点无聊，想出了这个，其中包含我的一个穷人的 Linux 时代替换版本，仅限日常使用（没有时间保留）：

7daysclean.cmd

```
@echo off
setlocal ENABLEDELAYEDEXPANSION
set day=86400
set /a year=day*365
set /a strip=day*7
set dSource=C:\temp

call :epoch %date%
set /a slice=epoch-strip

for /f "delims=" %%f in ('dir /a-d-h-s /b /s %dSource%') do (
    call :epoch %%~tf
    if !epoch! LEQ %slice% (echo DELETE %%f ^(%%~tf^)) ELSE echo keep %%f ^(%%~tf^)
)
exit /b 0

rem Args[1]: Year-Month-Day
:epoch
    setlocal ENABLEDELAYEDEXPANSION
    for /f "tokens=1,2,3 delims=-" %%d in ('echo %1') do set Years=%%d& set Months=%%e& set Days=%%f
    if "!Months:~0,1!"=="0" set Months=!Months:~1,1!
    if "!Days:~0,1!"=="0" set Days=!Days:~1,1!
    set /a Days=Days*day
    set /a _months=0
    set i=1&& for %%m in (31 28 31 30 31 30 31 31 30 31 30 31) do if !i! LSS !Months! (set /a _months=!_months! + %%m*day&& set /a i+=1)
    set /a Months=!_months!
    set /a Years=(Years-1970)*year
    set /a Epoch=Years+Months+Days
    endlocal& set Epoch=%Epoch%
    exit /b 0 
```

## 用法

`set /a strip=day*7`：将保留天数更改为**7**。

`set dSource=C:\temp`: 这是检查文件的起始目录。

## 笔记

这是非破坏性代码，它将显示会发生什么。

改变 ：

```
if !epoch! LEQ %slice% (echo DELETE %%f ^(%%~tf^)) ELSE echo keep %%f ^(%%~tf^) 
```

类似于：

```
if !epoch! LEQ %slice% del /f %%f 
```

所以文件实际上被删除了

**二月**：硬编码为 28 天。Bissextile 岁月是一个地狱，真的。如果有人有一个不会添加 10 行代码的想法，请继续发布，以便我将其添加到我的代码中。

**epoch**：我没有考虑时间，因为需要删除早于某个日期的文件，花费数小时/分钟将删除本应保留的文件。

## 局限性

**epoch**理所当然地认为您的短日期格式是 YYYY-MM-DD。它需要适应其他设置或运行时评估（读取 sShortTime、用户绑定配置、在过滤器中配置正确的字段顺序并使用过滤器从参数中提取正确的数据）。

我有没有提到我讨厌这个编辑器的自动格式化？它删除了空白行，复制粘贴是地狱。

我希望这有帮助。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2011-06-08T07:46:04.857

```
forfiles /p "v:" /s /m *.* /d -3 /c "cmd /c del @path" 
```

你应该这样做`/d -3`（3天前）这对我来说很好。所以所有复杂的批次都可能在垃圾桶里。`forfiles`也不支持 UNC 路径，因此请与特定驱动器建立网络连接。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-08-24T15:11:15.987

看看我对[类似问题的](https://stackoverflow.com/questions/324267/batch-file-to-delete-files-older-than-a-specified-date)[回答](https://stackoverflow.com/questions/324267/batch-file-to-delete-files-older-than-a-specified-date/324349#324349)：

```
REM del_old.bat
REM usage: del_old MM-DD-YYY
for /f "tokens=*" %%a IN ('xcopy *.* /d:%1 /L /I null') do if exist %%~nxa echo %%~nxa >> FILES_TO_KEEP.TXT
for /f "tokens=*" %%a IN ('xcopy *.* /L /I /EXCLUDE:FILES_TO_KEEP.TXT null') do if exist "%%~nxa" del "%%~nxa" 
```

这将删除早于给定日期的文件。我敢肯定它可以修改为从当前日期起 7 天返回。

**更新：**我注意到 HerbCSO 对上述脚本进行了改进。我建议改用[他的版本](https://stackoverflow.com/questions/324267/batch-file-to-delete-files-older-than-a-specified-date/1180746#1180746)。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-12-14T06:46:25.030

我的命令是

```
forfiles -p "d:\logs" -s -m*.log -d-15 -c"cmd /c del @PATH\@FILE" 
```

`@PATH`- 在我的情况下只是路径，所以我不得不使用`@PATH\@FILE`

也不`forfiles /?`适用于我，但`forfiles`（没有“？”）工作正常。

我唯一的问题是：如何添加多个掩码（例如“ *.log|* .bak”）？

[关于我在这里下载](ftp://ftp.microsoft.com/ResKit/y2kfix/x86/)的 forfiles.exe 的所有这些（在 win XP 上）

但如果您使用的是 Windows 服务器，forfiles.exe 应该已经存在，并且它与 ftp 版本不同。这就是为什么我应该修改命令。

对于 Windows Server 2003，我使用以下命令：

```
forfiles -p "d:\Backup" -s -m *.log -d -15 -c "cmd /c del @PATH" 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-07-25T15:37:04.677

对于 Windows 2012 R2，以下将起作用：

```
 forfiles /p "c:\FOLDERpath" /d -30 /c "cmd /c del @path" 
```

要查看将被删除的文件，请使用此

```
 forfiles /p "c:\FOLDERpath" /d -30 /c "cmd /c echo @path @fdate" 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-02-08T15:13:11.533

批处理文件经常需要解决与日期/时间相关的问题。但是命令行解释器**cmd.exe**没有用于日期/时间计算的功能。许多使用额外控制台应用程序或脚本的良好工作解决方案已经在这里、Stack Overflow 的其他页面和其他网站上发布。

基于日期/时间的操作的共同点是要求将日期/时间字符串转换为自确定日期以来的秒数。非常常见的是 1970-01-01 00:00:00 UTC。但是根据支持特定任务所需的日期范围，也可以使用任何较晚的日期。

[Jay](https://stackoverflow.com/users/151152/jay)发布了[7daysclean.cmd](https://stackoverflow.com/a/1322886/3074564)，其中包含用于命令行解释器**cmd.exe**的快速“日期到秒”解决方案。但它没有考虑闰年正确。[JR](https://stackoverflow.com/users/381472/j-r)发布了一个[附加组件](https://stackoverflow.com/a/3161104/3074564)，将当年的闰日考虑在内，但忽略了自基准年以来的其他闰年，即自 1970 年以来。

自 20 年以来，我一直使用使用小型 C 函数创建一次的静态表（数组），以便在我用 C/C++ 编写的应用程序中的日期/时间转换函数中快速获取包括 1970 年 1 月 1 日以来的闰日在内的天数。

这种非常快速的表格方法也可以在使用**FOR**命令的批处理代码中使用。所以我决定编写批处理子例程`GetSeconds`，它计算自 1970-01-01 00:00:00 UTC 以来传递给该例程的日期/时间字符串的秒数。

**注意：**不考虑闰秒，因为 Windows 文件系统也不支持闰秒。

首先，表格：

1.  自 1970-01-01 00:00:00 UTC 以来每年的天数，包括闰日。

    ```
    1970 - 1979:     0   365   730  1096  1461  1826  2191  2557  2922  3287
    1980 - 1989:  3652  4018  4383  4748  5113  5479  5844  6209  6574  6940
    1990 - 1999:  7305  7670  8035  8401  8766  9131  9496  9862 10227 10592
    2000 - 2009: 10957 11323 11688 12053 12418 12784 13149 13514 13879 14245
    2010 - 2019: 14610 14975 15340 15706 16071 16436 16801 17167 17532 17897
    2020 - 2029: 18262 18628 18993 19358 19723 20089 20454 20819 21184 21550
    2030 - 2039: 21915 22280 22645 23011 23376 23741 24106 24472 24837 25202
    2040 - 2049: 25567 25933 26298 26663 27028 27394 27759 28124 28489 28855
    2050 - 2059: 29220 29585 29950 30316 30681 31046 31411 31777 32142 32507
    2060 - 2069: 32872 33238 33603 33968 34333 34699 35064 35429 35794 36160
    2070 - 2079: 36525 36890 37255 37621 37986 38351 38716 39082 39447 39812
    2080 - 2089: 40177 40543 40908 41273 41638 42004 42369 42734 43099 43465
    2090 - 2099: 43830 44195 44560 44926 45291 45656 46021 46387 46752 47117
    2100 - 2106: 47482 47847 48212 48577 48942 49308 49673 
    ```

    只有在 C/C++ 中使用无符号 32 位变量，即无符号长（或无符号整数）时，才能计算 2039 年到 2106 年的秒数，纪元从 1970 年 1 月 1 日开始。

    但是**cmd.exe**对数学表达式使用带符号的 32 位变量。因此最大值为 2147483647 (0x7FFFFFFF)，即 2038-01-19 03:14:07。

2.  1970 年至 2106 年的闰年信息（否/是）。

    ```
    1970 - 1989: N N Y N N N Y N N N Y N N N Y N N N Y N
    1990 - 2009: N N Y N N N Y N N N Y N N N Y N N N Y N
    2010 - 2029: N N Y N N N Y N N N Y N N N Y N N N Y N
    2030 - 2049: N N Y N N N Y N N N Y N N N Y N N N Y N
    2050 - 2069: N N Y N N N Y N N N Y N N N Y N N N Y N
    2070 - 2089: N N Y N N N Y N N N Y N N N Y N N N Y N
    2090 - 2106: N N Y N N N Y N N N N N N N Y N N
                                     ^ year 2100 
    ```

3.  到当年每个月的第一天的天数。

    ```
     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
    Year with 365 days:  0  31  59  90 120 151 181 212 243 273 304 334
    Year with 366 days:  0  31  60  91 121 152 182 213 244 274 305 335 
    ```

使用这些表格将日期转换为自 1970-01-01 以来的秒数非常容易。

**请注意！**

日期和时间字符串的格式取决于 Windows 区域和语言设置。分配给环境变量的分隔符和标记顺序`Day`以及`Month`在`Year`第一个**FOR**循环中`GetSeconds`必须根据需要调整为本地日期/时间格式。

如果环境变量**DATE**中的日期格式与命令**FOR** on使用的日期格式不同，则需要调整环境变量的日期字符串`%%~tF`。

例如，当扩展`%DATE%`为时扩展为下面的代码，可以将第 4 行修改为：`Sun 02/08/2015``%%~tF``02/08/2015 07:38 PM`

```
call :GetSeconds "%DATE:~4% %TIME%" 
```

这导致只传递给子程序`02/08/2015`- 没有工作日缩写的 3 个字母和分隔空格字符的日期字符串。

或者，以下可用于以正确格式传递当前日期：

```
call :GetSeconds "%DATE:~-10% %TIME%" 
```

现在日期字符串中的最后 10 个字符被传递给函数`GetSeconds`，因此环境变量**DATE**的日期字符串是否带有工作日都没有关系，只要日期和月份总是按预期顺序使用 2 位数字，即格式`dd/mm/yyyy` 或`dd.mm.yyyy`.

这是带有解释注释的批处理代码，它仅输出要删除的文件以及要保留在`C:\Temp`文件夹树中的文件，请参见第一个**FOR**循环的代码。

```
@echo off
setlocal EnableExtensions DisableDelayedExpansion
rem Get seconds since 1970-01-01 for current date and time.
call :GetSeconds "%DATE% %TIME%"
rem Subtract seconds for 7 days from seconds value.
set /A "LastWeek=Seconds-7*86400"

rem For each file in each subdirectory of C:\Temp get last modification date
rem (without seconds -> append second 0) and determine the number of seconds
rem since 1970-01-01 for this date/time. The file can be deleted if seconds
rem value is lower than the value calculated above.

for /F "delims=" %%# in ('dir /A-D-H-S /B /S "C:\Temp"') do (
    call :GetSeconds "%%~t#:0"
    set "FullFileName=%%#"
    setlocal EnableDelayedExpansion
    rem if !Seconds! LSS %LastWeek% del /F "!FullFileName!"
    if !Seconds! LEQ %LastWeek% (
        echo Delete "!FullFileName!"
    ) else (
        echo Keep   "!FullFileName!"
    )
    endlocal
)
endlocal
goto :EOF

rem No validation is made for best performance. So make sure that date
rem and hour in string is in a format supported by the code below like
rem MM/DD/YYYY hh:mm:ss or M/D/YYYY h:m:s for English US date/time.

:GetSeconds
rem If there is " AM" or " PM" in time string because of using 12 hour
rem time format, remove those 2 strings and in case of " PM" remember
rem that 12 hours must be added to the hour depending on hour value.

set "DateTime=%~1"
set "Add12Hours=0"
if not "%DateTime: AM=%" == "%DateTime%" (
    set "DateTime=%DateTime: AM=%"
) else if not "%DateTime: PM=%" == "%DateTime%" (
    set "DateTime=%DateTime: PM=%"
    set "Add12Hours=1"
)

rem Get year, month, day, hour, minute and second from first parameter.

for /F "tokens=1-6 delims=,-./: " %%A in ("%DateTime%") do (
    rem For English US date MM/DD/YYYY or M/D/YYYY
    set "Day=%%B" & set "Month=%%A" & set "Year=%%C"
    rem For German date DD.MM.YYYY or English UK date DD/MM/YYYY
    rem set "Day=%%A" & set "Month=%%B" & set "Year=%%C"
    set "Hour=%%D" & set "Minute=%%E" & set "Second=%%F"
)
rem echo Date/time is: %Year%-%Month%-%Day% %Hour%:%Minute%:%Second%

rem Remove leading zeros from the date/time values or calculation could be wrong.
if "%Month:~0,1%"  == "0" if not "%Month:~1%"  == "" set "Month=%Month:~1%"
if "%Day:~0,1%"    == "0" if not "%Day:~1%"    == "" set "Day=%Day:~1%"
if "%Hour:~0,1%"   == "0" if not "%Hour:~1%"   == "" set "Hour=%Hour:~1%"
if "%Minute:~0,1%" == "0" if not "%Minute:~1%" == "" set "Minute=%Minute:~1%"
if "%Second:~0,1%" == "0" if not "%Second:~1%" == "" set "Second=%Second:~1%"

rem Add 12 hours for time range 01:00:00 PM to 11:59:59 PM,
rem but keep the hour as is for 12:00:00 PM to 12:59:59 PM.
if %Add12Hours% == 1 if %Hour% LSS 12 set /A Hour+=12

set "DateTime="
set "Add12Hours="

rem Must use two arrays as more than 31 tokens are not supported
rem by command line interpreter cmd.exe respectively command FOR.
set /A "Index1=Year-1979"
set /A "Index2=Index1-30"

if %Index1% LEQ 30 (
    rem Get number of days to year for the years 1980 to 2009.
    for /F "tokens=%Index1% delims= " %%Y in ("3652 4018 4383 4748 5113 5479 5844 6209 6574 6940 7305 7670 8035 8401 8766 9131 9496 9862 10227 10592 10957 11323 11688 12053 12418 12784 13149 13514 13879 14245") do set "Days=%%Y"
    for /F "tokens=%Index1% delims= " %%L in ("Y N N N Y N N N Y N N N Y N N N Y N N N Y N N N Y N N N Y N") do set "LeapYear=%%L"
) else (
    rem Get number of days to year for the years 2010 to 2038.
    for /F "tokens=%Index2% delims= " %%Y in ("14610 14975 15340 15706 16071 16436 16801 17167 17532 17897 18262 18628 18993 19358 19723 20089 20454 20819 21184 21550 21915 22280 22645 23011 23376 23741 24106 24472 24837") do set "Days=%%Y"
    for /F "tokens=%Index2% delims= " %%L in ("N N Y N N N Y N N N Y N N N Y N N N Y N N N Y N N N Y N N") do set "LeapYear=%%L"
)

rem Add the days to month in year.
if "%LeapYear%" == "N" (
    for /F "tokens=%Month% delims= " %%M in ("0 31 59 90 120 151 181 212 243 273 304 334") do set /A "Days+=%%M"
) else (
    for /F "tokens=%Month% delims= " %%M in ("0 31 60 91 121 152 182 213 244 274 305 335") do set /A "Days+=%%M"
)

rem Add the complete days in month of year.
set /A "Days+=Day-1"

rem Calculate the seconds which is easy now.
set /A "Seconds=Days*86400+Hour*3600+Minute*60+Second"

rem Exit this subroutine.
goto :EOF 
```

为了获得最佳性能，最好删除所有注释，即在 0-4 个前导空格之后以**rem开头的所有行。**

并且数组也可以做得更小，即将时间范围从 1980-01-01 00:00:00 减少到 2038-01-19 03:14:07，如上面的批处理代码当前支持的那样，例如到 2015-01 -01 到 2019-12-31，因为下面的代码使用它真正删除文件`C:\Temp`夹树中超过 7 天的文件。

此外，下面的批处理代码针对 24 小时时间格式进行了优化。

```
@echo off
setlocal EnableExtensions DisableDelayedExpansion
call :GetSeconds "%DATE:~-10% %TIME%"
set /A "LastWeek=Seconds-7*86400"

for /F "delims=" %%# in ('dir /A-D-H-S /B /S "C:\Temp"') do (
    call :GetSeconds "%%~t#:0"
    set "FullFileName=%%#"
    setlocal EnableDelayedExpansion
    if !Seconds! LSS %LastWeek% del /F "!FullFileName!"
    endlocal
)
endlocal
goto :EOF

:GetSeconds
for /F "tokens=1-6 delims=,-./: " %%A in ("%~1") do (
    set "Day=%%B" & set "Month=%%A" & set "Year=%%C"
    set "Hour=%%D" & set "Minute=%%E" & set "Second=%%F"
)
if "%Month:~0,1%"  == "0" if not "%Month:~1%"  == "" set "Month=%Month:~1%"
if "%Day:~0,1%"    == "0" if not "%Day:~1%"    == "" set "Day=%Day:~1%"
if "%Hour:~0,1%"   == "0" if not "%Hour:~1%"   == "" set "Hour=%Hour:~1%"
if "%Minute:~0,1%" == "0" if not "%Minute:~1%" == "" set "Minute=%Minute:~1%"
if "%Second:~0,1%" == "0" if not "%Second:~1%" == "" set "Second=%Second:~1%"
set /A "Index=Year-2014"
for /F "tokens=%Index% delims= " %%Y in ("16436 16801 17167 17532 17897") do set "Days=%%Y"
for /F "tokens=%Index% delims= " %%L in ("N Y N N N") do set "LeapYear=%%L"
if "%LeapYear%" == "N" (
    for /F "tokens=%Month% delims= " %%M in ("0 31 59 90 120 151 181 212 243 273 304 334") do set /A "Days+=%%M"
) else (
    for /F "tokens=%Month% delims= " %%M in ("0 31 60 91 121 152 182 213 244 274 305 335") do set /A "Days+=%%M"
)
set /A "Days+=Day-1"
set /A "Seconds=Days*86400+Hour*3600+Minute*60+Second"
goto :EOF 
```

有关 Windows 上的日期和时间格式以及文件时间比较的更多信息，请参阅我在[“找出文件是否在批处理文件中超过 4 小时”的](https://stackoverflow.com/a/32670346/3074564)回答，其中包含有关文件时间的大量附加信息。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2012-04-27T22:41:04.387

对于 Windows Server 2008 R2：

```
forfiles /P c:\sql_backups\ /S /M *.sql /D -90 /C "cmd /c del @PATH" 
```

这将删除所有超过*90*天的*.sql文件。*

 ** * *

## 回答 #10

> 赞同：8
> 
> 时间：2011-01-26T01:36:21.123

复制此代码并将其另存为`DelOldFiles.vbs`.

在 CMD 中的用法：`cscript //nologo DelOldFiles.vbs 15`

15 表示删除过去 15 天之前的文件。

```
 'copy from here
    Function DeleteOlderFiles(whichfolder)
       Dim fso, f, f1, fc, n, ThresholdDate
       Set fso = CreateObject("Scripting.FileSystemObject")
       Set f = fso.GetFolder(whichfolder)
       Set fc = f.Files
       Set objArgs = WScript.Arguments
       n = 0
       If objArgs.Count=0 Then
           howmuchdaysinpast = 0
       Else
           howmuchdaysinpast = -objArgs(0)
       End If
       ThresholdDate = DateAdd("d", howmuchdaysinpast, Date)   
       For Each f1 in fc
     If f1.DateLastModified<ThresholdDate Then
        Wscript.StdOut.WriteLine f1
        f1.Delete
        n = n + 1    
     End If
       Next
       Wscript.StdOut.WriteLine "Deleted " & n & " file(s)."
    End Function

    If Not WScript.FullName = WScript.Path & "\cscript.exe" Then
      WScript.Echo "USAGE ONLY IN COMMAND PROMPT: cscript DelOldFiles.vbs 15" & vbCrLf & "15 means to delete files older than 15 days in past."
      WScript.Quit 0   
    End If

    DeleteOlderFiles(".")
 'to here 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2011-11-14T14:56:03.840

使用文件。

有不同的版本。早期的使用 unix 样式参数。

我的版本（用于服务器 2000 - 注意开关后没有空格）-

```
forfiles -p"C:\what\ever" -s -m*.* -d<number of days> -c"cmd /c del @path" 
```

要将 forfiles 添加到 XP，请从[ftp://ftp.microsoft.com/ResKit/y2kfix/x86/获取 exe](ftp://ftp.microsoft.com/ResKit/y2kfix/x86/)

并将其添加到 C:\WINDOWS\system32

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2010-07-01T19:38:57.160

考虑到闰年，如何对[7daysclean.cmd进行修改？](https://stackoverflow.com/a/1322886/3074564)

不到 10 行代码就可以完成！

```
set /a Leap=0
if (Month GEQ 2 and ((Years%4 EQL 0 and Years%100 NEQ 0) or Years%400 EQL 0)) set /a Leap=day
set /a Months=!_months!+Leap 
```

* * *

**莫菲编辑：**

由于语法无效， [JR](https://stackoverflow.com/users/381472/j-r)提供的上述条件始终为**false 。**

并且`Month GEQ 2`也是错误的，因为在闰年必须在 3 月到 12 月的月份中再增加一天 86400 秒，而不是在 2 月。

[在Jay](https://stackoverflow.com/users/151152/jay)发布的批处理文件**7daysclean.cmd**中考虑闰日的工作代码将是：

```
set "LeapDaySecs=0"
if %Month% LEQ 2 goto CalcMonths
set /a "LeapRule=Years%%4"
if %LeapRule% NEQ 0 goto CalcMonths
rem The other 2 rules can be ignored up to year 2100.
set /A "LeapDaySecs=day"
:CalcMonths
set /a Months=!_months!+LeapDaySecs 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-04-26T10:57:48.070

IMO，JavaScript 正在逐渐成为一种通用脚本标准：它可能比任何其他脚本语言在更多的产品中可用（在 Windows 中，它可以使用 Windows Scripting Host）。我必须清理很多文件夹中的旧文件，所以这里有一个 JavaScript 函数可以做到这一点：

```
// run from an administrator command prompt (or from task scheduler with full rights):  wscript jscript.js
// debug with:   wscript /d /x jscript.js

var fs = WScript.CreateObject("Scripting.FileSystemObject");

clearFolder('C:\\temp\\cleanup');

function clearFolder(folderPath)
{
    // calculate date 3 days ago
    var dateNow = new Date();
    var dateTest = new Date();
    dateTest.setDate(dateNow.getDate() - 3);

    var folder = fs.GetFolder(folderPath);
    var files = folder.Files;

    for( var it = new Enumerator(files); !it.atEnd(); it.moveNext() )
    {
        var file = it.item();

        if( file.DateLastModified < dateTest)
        {
            var filename = file.name;
            var ext = filename.split('.').pop().toLowerCase();

            if (ext != 'exe' && ext != 'dll')
            {
                file.Delete(true);
            }
        }
    }

    var subfolders = new Enumerator(folder.SubFolders);
    for (; !subfolders.atEnd(); subfolders.moveNext())
    {
        clearFolder(subfolders.item().Path);
    }
} 
```

对于要清除的每个文件夹，只需向 clearFolder() 函数添加另一个调用。此特定代码还保留 exe 和 dll 文件，并清理子文件夹。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2015-04-02T18:58:30.410

我可以为这个已经很有价值的线程添加一个不起眼的贡献吗？我发现其他解决方案可能会删除实际的错误文本，但忽略了表示我的应用程序失败的 %ERRORLEVEL% 。并且我合法地想要 %ERRORLEVEL% ，只要它不是“未找到文件”错误。

**一些例子：**

**具体调试和消除错误：**

```
forfiles /p "[file path...]\IDOC_ARCHIVE" /s /m *.txt /d -1 /c "cmd /c del @path" 2>&1 |  findstr /V /O /C:"ERROR: No files found with the specified search criteria."2>&1 | findstr ERROR&&ECHO found error||echo found success 
```

**使用 oneliner 返回 ERRORLEVEL 成功或失败：**

```
forfiles /p "[file path...]\IDOC_ARCHIVE" /s /m *.txt /d -1 /c "cmd /c del @path" 2>&1 |  findstr /V /O /C:"ERROR: No files found with the specified search criteria."2>&1 | findstr ERROR&&EXIT /B 1||EXIT /B 0 
```

**在其他代码中间的批处理文件的上下文中，使用 oneliner 将 ERRORLEVEL 保持为零以便成功（ver > nul 重置 ERRORLEVEL）：**

```
forfiles /p "[file path...]\IDOC_ARCHIVE" /s /m *.txt /d -1 /c "cmd /c del @path" 2>&1 |  findstr /V /O /C:"ERROR: No files found with the specified search criteria."2>&1 | findstr ERROR&&ECHO found error||ver > nul 
```

**对于 SQL Server 代理 CmdExec 作业步骤，我选择了以下内容。我不知道这是否是一个错误，但步骤中的 CmdExec 只识别第一行代码：**

```
cmd /e:on /c "forfiles /p "C:\SQLADMIN\MAINTREPORTS\SQL2" /s /m *.txt /d -1 /c "cmd /c del @path" 2>&1 |  findstr /V /O /C:"ERROR: No files found with the specified search criteria."2>&1 | findstr ERROR&&EXIT 1||EXIT 0"&exit %errorlevel% 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2018-03-16T13:33:56.510

天哪，已经有很多答案了。**我发现一个简单方便的方法是使用&**参数从单个 Windows 命令行指令按顺序执行 ROBOCOPY.EXE 两次。

```
ROBOCOPY.EXE SOURCE-DIR TARGET-DIR *.* /MOV /MINAGE:30 & ROBOCOPY.EXE SOURCE-DIR TARGET-DIR *.* /MOV /MINAGE:30 /PURGE 
```

在此示例中，它通过选择所有超过 30 天的文件 ( *. ) 并将它们移动到目标文件夹来工作。*第二个命令通过添加**PURGE**命令再次执行相同的操作，这意味着删除源文件夹中不存在的目标文件夹中的文件。所以本质上，第一个命令 MOVES 文件和第二个 DELETES 因为在调用第二个命令时它们不再存在于源文件夹中。

请查阅 ROBOCOPY 的文档并在测试时使用 /L 开关。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-12-08T00:56:02.620

如果您有 XP 资源工具包，您可以使用 robocopy 将所有旧目录移动到一个目录中，然后使用 rmdir 删除那个：

```
mkdir c:\temp\OldDirectoriesGoHere
robocopy c:\logs\SoManyDirectoriesToDelete\ c:\temp\OldDirectoriesGoHere\ /move /minage:7
rmdir /s /q c:\temp\OldDirectoriesGoHere 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2014-01-02T23:04:16.127

我认为[e.James 的回答](https://stackoverflow.com/a/1322976/1284754)很好，因为它早在 Windows 2000 SP4（可能更早）就可以与未修改的 Windows 版本一起使用，但它需要写入外部文件。这是一个修改后的版本，它在保持兼容性的同时不创建外部文本文件：

```
REM del_old.cmd
REM usage: del_old MM-DD-YYYY
setlocal enabledelayedexpansion
for /f "tokens=*" %%a IN ('xcopy *.* /d:%1 /L /I null') do @if exist "%%~nxa" set "excludefiles=!excludefiles!;;%%~nxa;;"
for /f "tokens=*" %%a IN ('dir /b') do @(@echo "%excludefiles%"|FINDSTR /C:";;%%a;;">nul || if exist "%%~nxa" DEL /F /Q "%%a">nul 2>&1) 
```

忠实于原始问题，如果您使用天数作为参数调用它，它会在一个脚本中为您完成所有数学运算：

```
REM del_old_compute.cmd
REM usage: del_old_compute N
setlocal enabledelayedexpansion
set /a days=%1&set cur_y=%DATE:~10,4%&set cur_m=%DATE:~4,2%&set cur_d=%DATE:~7,2%
for /f "tokens=1 delims==" %%a in ('set cur_') do if "!%%a:~0,1!"=="0" set /a %%a=!%%a:~1,1!+0
set mo_2=28&set /a leapyear=cur_y*10/4
if %leapyear:~-1% equ 0 set mo_2=29
set mo_1=31&set mo_3=31&set mo_4=30&set mo_5=31
set mo_6=30&set mo_7=31&set mo_8=31&set mo_9=30
set mo_10=31&set mo_11=30&set mo_12=31
set /a past_y=(days/365)
set /a monthdays=days-((past_y*365)+((past_y/4)*1))&&set /a past_y=cur_y-past_y&set months=0
:setmonth
set /a minusmonth=(cur_m-1)-months
if %minusmonth% leq 0 set /a minusmonth+=12
set /a checkdays=(mo_%minusmonth%)
if %monthdays% geq %checkdays% set /a months+=1&set /a monthdays-=checkdays&goto :setmonth
set /a past_m=cur_m-months
set /a lastmonth=cur_m-1
if %lastmonth% leq 0 set /a lastmonth+=12
set /a lastmonth=mo_%lastmonth%
set /a past_d=cur_d-monthdays&set adddays=::
if %past_d% leq 0 (set /a past_m-=1&set adddays=)
if %past_m% leq 0 (set /a past_m+=12&set /a past_y-=1)
set mo_2=28&set /a leapyear=past_y*10/4
if %leapyear:~-1% equ 0 set mo_2=29
%adddays%set /a past_d+=mo_%past_m%
set d=%past_m%-%past_d%-%past_y%
for /f "tokens=*" %%a IN ('xcopy *.* /d:%d% /L /I null') do @if exist "%%~nxa" set "excludefiles=!excludefiles!;;%%~nxa;;"
for /f "tokens=*" %%a IN ('dir /b') do @(@echo "%excludefiles%"|FINDSTR /C:";;%%a;;">nul || if exist "%%~nxa" DEL /F /Q "%%a">nul 2>&1) 
```

注意：上面的代码考虑了闰年，以及每个月的确切天数。唯一的最大值是自 0/0/0 以来的总天数（之后它返回负数年）。

注意：数学只有一种方式；它无法从负输入中正确获取未来日期（它会尝试，但可能会超过该月的最后一天）。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-08-15T15:29:17.110

**ROBOCOPY**非常适合我。最初建议我的伊曼。但是不要将文件/文件夹移动到临时目录然后删除临时文件夹的内容，而是将文件**移动到垃圾箱！！！**

这是我的备份批处理文件的几行，例如：

```
SET FilesToClean1=C:\Users\pauls12\Temp
SET FilesToClean2=C:\Users\pauls12\Desktop\1616 - Champlain\Engineering\CAD\Backups

SET RecycleBin=C:\$Recycle.Bin\S-1-5-21-1480896384-1411656790-2242726676-748474

robocopy "%FilesToClean1%" "%RecycleBin%" /mov /MINLAD:15 /XA:SH /NC /NDL /NJH /NS /NP /NJS
robocopy "%FilesToClean2%" "%RecycleBin%" /mov /MINLAD:30 /XA:SH /NC /NDL /NJH /NS /NP /NJS 
```

它会清除我的“临时”文件夹中超过 15 天的任何内容，以及 AutoCAD 备份文件夹中超过 30 天的任何内容。我使用变量是因为行可能会很长，我可以将它们重用于其他位置。您只需要找到与您的登录关联的回收站的 dos 路径。

这是在我的工作计算机上，它可以工作。我知道你们中的一些人可能有更多的限制性权利，但还是试试吧；）在谷歌搜索关于 ROBOCOPY 参数的解释。

干杯!

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2021-02-24T01:56:55.080

**删除所有超过 3 天的文件**

```
forfiles -p "C:\folder" -m *.* -d -3 -c "cmd  /c del /q @path" 
```

**删除超过 3 天的目录**

```
forfiles -p "C:\folder" -d -3 -c "cmd  /c IF @isdir == TRUE rd /S /Q @path" 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-09-09T14:24:49.830

你也许可以解决这个问题。您可以看一下[这个问题](https://stackoverflow.com/questions/51837/open-one-of-a-series-of-files-using-a-batch-file)，以获取更简单的示例。当您开始比较日期时，复杂性就来了。判断日期是否更大可能很容易，但如果您需要实际获取两个日期之间的差异，则需要考虑许多情况。

换句话说 - 不要试图发明这个，除非你真的不能使用第三方工具。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2013-12-19T00:01:20.220

这没什么了不起的，但是我今天需要做这样的事情并将其作为计划任务等运行。

批处理文件 DelFilesOlderThanNDays.bat 下面带有示例 exec w/params：

> DelFilesOlderThanNDays.bat **7** *C:\dir1\dir2\dir3\logs* ***.log**

```
echo off
cls
Echo(
SET keepDD=%1
SET logPath=%2 :: example C:\dir1\dir2\dir3\logs
SET logFileExt=%3
SET check=0
IF [%3] EQU [] SET logFileExt=*.log & echo: file extention not specified (default set to "*.log")
IF [%2] EQU [] echo: file directory no specified (a required parameter), exiting! & EXIT /B 
IF [%1] EQU [] echo: number of days not specified? :)
echo(
echo: in path [ %logPath% ]
echo: finding all files like [ %logFileExt% ]
echo: older than [ %keepDD% ] days
echo(
::
::
:: LOG
echo:  >> c:\trimLogFiles\logBat\log.txt
echo: executed on %DATE% %TIME% >> c:\trimLogFiles\logBat\log.txt
echo: ---------------------------------------------------------- >> c:\trimLogFiles\logBat\log.txt
echo: in path [ %logPath% ] >> c:\trimLogFiles\logBat\log.txt
echo: finding all files like [ %logFileExt% ] >> c:\trimLogFiles\logBat\log.txt
echo: older than [ %keepDD% ] days >> c:\trimLogFiles\logBat\log.txt
echo: ---------------------------------------------------------- >> c:\trimLogFiles\logBat\log.txt
::
FORFILES /p %logPath% /s /m %logFileExt% /d -%keepDD% /c "cmd /c echo @path" >> c:\trimLogFiles\logBat\log.txt 2<&1
IF %ERRORLEVEL% EQU 0 (
 FORFILES /p %logPath% /s /m %logFileExt% /d -%keepDD% /c "cmd /c echo @path"
)
::
::
:: LOG
IF %ERRORLEVEL% EQU 0 (
 echo:  >> c:\trimLogFiles\logBat\log.txt
 echo: deleting files ... >> c:\trimLogFiles\logBat\log.txt
 echo:  >> c:\trimLogFiles\logBat\log.txt
 SET check=1
)
::
::
IF %check% EQU 1 (
 FORFILES /p %logPath% /s /m %logFileExt% /d -%keepDD% /c "cmd /c del @path"
)
::
:: RETURN & LOG
::
IF %ERRORLEVEL% EQU 0 echo: deletion successfull! & echo: deletion successfull! >> c:\trimLogFiles\logBat\log.txt
echo: ---------------------------------------------------------- >> c:\trimLogFiles\logBat\log.txt 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-03-14T10:05:30.180

扩展 aku 的答案，我看到很多人询问 UNC 路径。简单地将 unc 路径映射到驱动器号将使 forfiles 满意。例如，可以在批处理文件中以编程方式完成驱动器的映射和取消映射。

```
net use Z: /delete
net use Z: \\unc\path\to\my\folder
forfiles /p Z: /s /m *.gz /D -7 /C "cmd /c del @path" 
```

这将删除所有 .gz 扩展名超过 7 天的文件。如果你想确保 Z: 在使用它之前没有映射到其他任何东西，你可以做一些简单的事情

```
net use Z: \\unc\path\to\my\folder
if %errorlevel% equ 0 (
    forfiles /p Z: /s /m *.gz /D -7 /C "cmd /c del @path"
) else (
    echo "Z: is already in use, please use another drive letter!"
) 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-05-19T08:49:54.263

这个是为我做的。它适用于日期，您可以减去所需的年数以及时返回：

```
@echo off

set m=%date:~-7,2%
set /A m
set dateYear=%date:~-4,4%
set /A dateYear -= 2
set DATE_DIR=%date:~-10,2%.%m%.%dateYear% 

forfiles /p "C:\your\path\here\" /s /m *.* /d -%DATE_DIR% /c "cmd /c del @path /F"

pause 
```

在某些情况下`/F`，`cmd /c del @path /F`强制删除特定文件，该文件可以是只读的。

这`dateYear`是年份变量，您可以根据自己的需要更改减法

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-07-14T23:47:10.803

我的脚本删除超过特定年份的文件：

```
@REM _______ GENERATE A CMD TO DELETE FILES OLDER THAN A GIVEN YEAR
@REM _______ (given in _olderthanyear variable)
@REM _______ (you must LOCALIZE the script depending on the dir cmd console output)
@REM _______ (we assume here the following line's format "11/06/2017  15:04            58 389 SpeechToText.zip")

@set _targetdir=c:\temp
@set _olderthanyear=2017

@set _outfile1="%temp%\deleteoldfiles.1.tmp.txt"
@set _outfile2="%temp%\deleteoldfiles.2.tmp.txt"

  @if not exist "%_targetdir%" (call :process_error 1 DIR_NOT_FOUND "%_targetdir%") & (goto :end)

:main
  @dir /a-d-h-s /s /b %_targetdir%\*>%_outfile1%
  @for /F "tokens=*" %%F in ('type %_outfile1%') do @call :process_file_path "%%F" %_outfile2%
  @goto :end

:end
  @rem ___ cleanup and exit
  @if exist %_outfile1% del %_outfile1%
  @if exist %_outfile2% del %_outfile2%
  @goto :eof

:process_file_path %1 %2
  @rem ___ get date info of the %1 file path
  @dir %1 | find "/" | find ":" > %2
  @for /F "tokens=*" %%L in ('type %2') do @call :process_line "%%L" %1
  @goto :eof

:process_line %1 %2
  @rem ___ generate a del command for each file older than %_olderthanyear%
  @set _var=%1
  @rem  LOCALIZE HERE (char-offset,string-length)
  @set _fileyear=%_var:~0,4%
  @set _fileyear=%_var:~7,4%
  @set _filepath=%2
  @if %_fileyear% LSS %_olderthanyear% echo @REM %_fileyear%
  @if %_fileyear% LSS %_olderthanyear% echo @del %_filepath%
  @goto :eof

:process_error %1 %2
  @echo RC=%1 MSG=%2 %3
  @goto :eof 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-11-12T09:09:13.430

更灵活的方法是使用[`FileTimeFilterJS.bat`](https://github.com/npocmaka/batch.scripts/blob/master/hybrids/jscript/FileTimeFilterJS.bat)：

```
@echo off

::::::::::::::::::::::
set "_DIR=C:\Users\npocmaka\Downloads"
set "_DAYS=-5"
::::::::::::::::::::::

for /f "tokens=* delims=" %%# in ('FileTimeFilterJS.bat  "%_DIR%" -dd %_DAYS%') do (
    echo deleting  "%%~f#"
    echo del /q /f "%%~f#"
) 
```

该脚本将允许您使用天、分钟、秒或小时等度量。选择天气以按创建、访问或修改时间过滤文件 列出某个日期之前或之后（或两个日期之间）的文件 选择是否显示文件或目录（或两者） 是否递归

# resharper - R# 插件类似于 CodeRush “语句高亮”

> ID：51088
> 
> 赞同：2
> 
> 时间：2008-09-09T01:45:24.383
> 
> 标签：resharper, codehighlighter

请参阅此处[http://www.hanselman.com/blog/InSearchOfThePerfectMonospacedProgrammersFontInconsolata.aspx](http://www.hanselman.com/blog/InSearchOfThePerfectMonospacedProgrammersFontInconsolata.aspx) - 需要更好的描述 - 突出显示语句块 - 例如在链接上的图片中，“语句块”用垂直线分组。我知道这是 CodeRush 的一个功能 - R# 是否有类似的东西，或者有一个插件来做同样的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T02:02:56.213

R# 有一个名为 Highlight current line 的功能，您必须在 ReSharper 选项中启用该功能。这在深色背景、高对比度主题上看起来像废话，所以如果你使用一个，我建议进入 Visual Studio 选项，在字体和颜色下，然后转到“ReSharper - 当前行”，并使背景颜色变暗与背景没有太大的对比。

R# 还具有匹配的大括号突出显示，在相同的 VS 选项对话框下也可以进行颜色配置。

这能回答你的问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-25T21:37:52.337

我使用当前可用的最新版本的 ReSharper - ReSharper 4.5 - 但不幸的是，我不相信有任何功能可以在匹配的大括号之间绘制一条垂直线，如您引用的屏幕截图所示。

我觉得 Ben 提到的有用的功能是匹配的大括号突出显示，但是只有当您的光标靠近左大括号或右大括号时才会生效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-17T05:43:43.617

Notepad ++ 有一个很好的大括号匹配功能，垂直线匹配大括号。它不是VS，所以我只在遇到一些令人困惑的JS时才使用它，剪切和粘贴，找出大括号并返回VS。如果 VS 或 R# 中存在这种功能，那就太好了。

# sql - SQL：聚合函数和分组依据

> ID：51092
> 
> 赞同：3
> 
> 时间：2008-09-09T01:49:32.093
> 
> 标签：sql, oracle, aggregate

考虑 Oracle`emp`表。我想用 和 得到薪水最高的`department = 20`员工`job = clerk`。还假设没有“empno”列，并且主键涉及许多列。你可以这样做：

```
select * from scott.emp
where deptno = 20 and job = 'CLERK'
and sal =  (select max(sal) from scott.emp
            where deptno = 20 and job = 'CLERK') 
```

这可行，但我必须复制测试 deptno = 20 和 job = 'CLERK'，这是我想避免的。有没有更优雅的方式来写这个，也许使用`group by`? 顺便说一句，如果这很重要，我正在使用 Oracle。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-09T01:58:32.883

以下是稍微过度设计的，但对于“top x”查询来说是一个很好的 SQL 模式。

```
SELECT 
 * 
FROM 
 scott.emp
WHERE 
 (deptno,job,sal) IN
 (SELECT 
   deptno,
   job,
   max(sal) 
  FROM 
   scott.emp
  WHERE 
   deptno = 20 
   and job = 'CLERK'
  GROUP BY 
   deptno,
   job
  ) 
```

另请注意，这将适用于 Oracle 和 Postgress（我认为），但不适用于 MS SQL。对于 MS SQL 中的类似内容，请参阅问题[SQL Query to get latest price](https://stackoverflow.com/questions/49404/sql-query-to-get-latest-price#49424)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T08:00:40.893

如果我确定目标数据库，我会选择 Mark Nold 的解决方案，但如果您想要一些与方言无关的 SQL*，请尝试

```
SELECT * 
FROM scott.emp e
WHERE e.deptno = 20 
AND e.job = 'CLERK'
AND e.sal = (
  SELECT MAX(e2.sal) 
  FROM scott.emp e2
  WHERE e.deptno = e2.deptno 
  AND e.job = e2.job
) 
```

*我相信这应该适用于任何地方，但我没有测试它的环境。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T14:04:05.790

在 Oracle 中，我会使用分析函数来执行此操作，因此您只需查询一次 emp 表：

```
SELECT *
  FROM (SELECT e.*, MAX (sal) OVER () AS max_sal
          FROM scott.emp e
         WHERE deptno = 20 
           AND job = 'CLERK')
 WHERE sal = max_sal 
```

它更简单、更容易阅读、更高效。

如果要修改它以列出所有部门的此信息，则需要在 OVER 中使用“PARTITION BY”子句：

```
SELECT *
  FROM (SELECT e.*, MAX (sal) OVER (PARTITION BY deptno) AS max_sal
          FROM scott.emp e
         WHERE job = 'CLERK')
 WHERE sal = max_sal
ORDER BY deptno 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T03:24:11.430

那太棒了！我不知道您可以将 (x, y, z) 与 SELECT 语句的结果进行比较。这适用于 Oracle。

作为其他读者的旁注，上述查询在“（deptno，job，sal）”之后缺少“=”。也许堆栈溢出格式化程序吃了它（？）。

再次感谢马克。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T11:51:12.977

在 Oracle 中，您还可以使用 EXISTS 语句，这在某些情况下更快。

例如... SELECT name, number FROM cust WHERE cust IN (SELECT cust_id FROM big_table) 并输入 > SYSDATE -1 会很慢。

但是 SELECT name, number FROM cust **c** WHERE EXISTS ( SELECT cust_id FROM big_table **WHERE cust_id=c.cust_id** ) 并输入 > SYSDATE -1 会非常快，并且有适当的索引。您也可以将其与多个参数一起使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T20:39:04.983

有很多解决方案。您还可以通过简单地添加表别名并加入列名来保留原始查询布局，但查询中仍然只有一次 DEPTNO = 20 和 JOB = 'CLERK'。

```
SELECT 
  * 
FROM 
  scott.emp emptbl
WHERE
  emptbl.DEPTNO = 20 
  AND emptbl.JOB = 'CLERK'
  AND emptbl.SAL =  
    (
      select 
        max(salmax.SAL) 
      from 
        scott.emp salmax
      where 
        salmax.DEPTNO = emptbl.DEPTNO
        AND salmax.JOB = emptbl.JOB
    ) 
```

还可以注意到，关键字“ALL”可用于这些类型的查询，这将允许您删除“MAX”功能。

```
SELECT 
  * 
FROM 
  scott.emp emptbl
WHERE
  emptbl.DEPTNO = 20 
  AND emptbl.JOB = 'CLERK'
  AND emptbl.SAL >= ALL  
    (
      select 
        salmax.SAL
      from 
        scott.emp salmax
      where 
        salmax.DEPTNO = emptbl.DEPTNO
        AND salmax.JOB = emptbl.JOB
    ) 
```

我希望这会有所帮助并且有意义。

# memory - Ubuntu 32 bit maximum address space

> ID：51093
> 
> 赞同：4
> 
> 时间：2008-09-09T01:49:55.760
> 
> 标签：memory, ubuntu, operating-system

Jeff covered this a while back [on his blog](http://www.codinghorror.com/blog/archives/000811.html) in terms of 32 bit Vista.

Does the same 32 bit 4 GB memory cap that applies in 32 bit Vista apply to 32 bit Ubuntu? Are there any 32 bit operating systems that have creatively solved this problem?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T08:28:41.870

Ubuntu服务器在内核中开启了PAE，桌面版默认没有开启这个功能。

顺便说一句，这解释了为什么 Ubuntu 服务器不能在某些硬件模拟器中工作，而桌面版则可以

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T01:58:07.237

Yes, 32 bit ubuntu has the same memory limitations.

There are exceptions to the 4GB limitation, but they are application specific... As in, Microsoft Sql Server can use 16 gigabytes with "Physical address Extensions" [PAE] configured and supported and... ugh [http://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=3703755&SiteID=17](http://forums.microsoft.com/TechNet/ShowPost.aspx?PostID=3703755&SiteID=17)

Also drivers in ubuntu and windows both reduce the amount of memory available from the 4GB address space by mapping memory from that 4GB to devices. Graphics cards are particularly bad at this, your 256MB graphics card is using up at least 256MB of your address space...

If you can [your drivers support it, and cpu is new enough] install a 64 bit os. Your 32 bit applications and games will run fine.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T02:01:08.790

Well, with windows, there's something called [PAE](http://en.wikipedia.org/wiki/Physical_Address_Extension), which means you can access up to 64 GB of memory on a windows machine. The downside is that most apps don't support actually using more than 4 GB of RAM. Only a small number of apps, like SQL Server are programmed to actually take advantage of all the extra memory.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T01:56:55.900

In theory, all 32-bit OSes have that problem. You have 32 bits to do addressing.

```
2^32 bits / 2^10 (bits per kb) / 2^10 (kb per mb) / 2^10 (mb per gb) = 2^2 = 4gb. 
```

Although there are some ways around it. (Look up the jump from 16-bit computing to 32-bit computing. They hit the same problem.)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-09T08:46:20.890

PAE 似乎有些混乱。PAE 是“页面地址扩展”，绝不是 Windows 功能。这是英特尔在他们的 Pentium II（和更新的）芯片中放入的一个 hack，允许机器访问 64GB 内存。在 Windows 上，应用程序需要明确支持 PAE，但在开源世界中，可以根据自己的喜好编译和优化包。在 Ubuntu（和其他 Linux 发行版）上可能使用超过 4GB 内存的软件包是在 PAE 支持下编译的。这包括所有特定于服务器的软件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T01:58:01.030

Linux supports a technology called PAE that lets you use more than 4GB of memory, however I don't know whether Ubuntu has it on by default. You may need to compile a new kernel.

Edit: Some threads on the Ubuntu forums suggest that the server kernel has PAE on by default, you could try installing that.

# security - 支付处理器 - 如果我想在我的网站上接受信用卡，我需要知道什么？

> ID：51094
> 
> 赞同：260
> 
> 时间：2008-09-09T01:50:45.913
> 
> 标签：security, e-commerce, pci-dss

[这个问题](https://stackoverflow.com/questions/2556/whats-the-best-online-payment-processing-solution)讨论了不同的支付处理器以及它们的成本，但我正在寻找如果我想接受信用卡支付我需要做什么的答案？

假设我需要为客户*存储*信用卡号，因此依赖信用卡处理器完成繁重工作的明显解决方案不可用。

[PCI 数据安全](https://www.pcisecuritystandards.org/security_standards/pci_dss.shtml)，这显然是存储信用卡信息的标准，有很多通用要求，但是[如何实现它们](http://en.wikipedia.org/wiki/PCI_DSS)呢？

那么像[Visa](http://usa.visa.com/merchants/risk_management/cisp_payment_applications.html)这样拥有自己最佳实践的供应商呢？

我需要有钥匙扣访问机器吗？如何在物理上保护它免受建筑物中的黑客攻击？或者，如果有人拿到了带有 sql server 数据文件的备份文件怎么办？

备份呢？周围是否有该数据的其他物理副本？

提示：[如果您有一个商家帐户，您应该协商他们向您收取“交换加价”而不是分层定价。](http://transfs.com/blog/) 通过分层定价，他们将根据使用的 Visa/MC 类型向您收取不同的费率——即。他们向您收取更多附加有丰厚奖励的卡。交换加计费意味着您只需向处理器支付 Visa/MC 向他们收取的费用，外加固定费用。（Amex 和 Discover 直接向商家收取自己的费率，因此这不适用于这些卡。您会发现 Amex 费率在 3% 范围内，而 Discover 可能低至 1%。Visa/MC 在2% 的范围）。 [该服务应该为您进行谈判](http://transfs.com/)（我没有使用它，这不是广告，我不隶属于该网站，

*这篇博客文章提供了[处理信用卡的完整纲要](http://blog.boxedice.com/2009/05/20/taking-payments-online-merchant-account-payment-processor-fees/)（特别是针对英国）。*

* * *

也许我用错了这个问题，但我正在寻找这样的提示：

1.  使用[SecurID](http://www.rsa.com/node.aspx?id=1156)或[eToken](http://www.aladdin.com/etoken/)将额外的密码层添加到物理框。
2.  确保盒子在带有物理锁或钥匙密码组合的房间内。

* * *

## 回答 #1

> 赞同：237
> 
> 时间：2008-09-09T19:06:50.930

不久前，我在一家我工作的公司经历了这个过程，我计划很快在我自己的企业中再次经历这个过程。如果您有一些网络技术知识，那确实还不错。否则，您最好使用 Paypal 或其他类型的服务。

该过程首先设置**[商家帐户](https://stackoverflow.com/questions/2556/whats-the-best-online-payment-processing-solution)**并绑定到您的银行帐户。您可能需要向您的银行查询，因为许多主要银行都提供商户服务。您可能能够获得交易，因为您已经是他们的客户，但如果没有，那么您可以货比三家。如果您计划接受 Discover 或 American Express，它们将是分开的，因为它们为他们的卡提供商家服务，没有绕过这个。还有其他一些特殊情况。这是一个申请过程，请做好准备。

接下来，您将需要购买一个**SSL 证书**，当信用卡信息通过公共网络传输时，您可以使用它来保护您的通信。有很多供应商，但我的经验法则是选择一个在某种程度上是品牌名称的。他们越为人所知，您的客户可能对他们的了解就越好。

接下来，您将需要找到与您的网站一起使用的**[支付网关](http://en.wikipedia.org/wiki/Payment_gateway)**。虽然这可以是可选的，具体取决于您的大小，但大多数情况下不会。你将需要一个。支付网关供应商提供了一种与您将与之通信的 Internet 网关 API 进行通信的方式。大多数供应商通过其 API 提供 HTTP 或 TCP/IP 通信。他们将代表您处理信用卡信息。两个供应商是[Authorize.Net](http://www.authorize.net/)和[PayFlow Pro](https://www.paypal.com/cgi-bin/webscr?cmd=_payflow-pro-overview-outside)。我在下面提供的链接包含有关其他供应商的更多信息。

怎么办？对于初学者，有一些关于您的应用程序必须遵守传输交易的指南。在进行所有设置的过程中，有人会查看您的网站或应用程序，并确保您遵守指南，例如使用 SSL，并且您有使用条款和政策文档，说明用户提供给您的信息的用途为了。不要从其他网站窃取这个。想出你自己的，如果你需要聘请律师。大多数这些事情都属于迈克尔在他的问题中提供的 PCI 数据安全链接。

如果您打算存储信用卡号码，那么您最好准备好在内部采取一些安全措施来保护信息。确保存储信息的服务器只有需要访问权限的成员才能访问。像任何良好的安全性一样，您可以分层做事。您放置的层数越多越好。如果您愿意，可以使用密钥卡类型安全性，例如[SecureID](http://www.rsa.com/node.aspx?id=1156)或[eToken](http://www.aladdin.com/etoken/default.aspx)保护服务器所在的房间。如果您买不起密钥卡路线，请使用两键方法。允许有权进入房间的人注销钥匙，该钥匙与他们已经携带的钥匙一起使用。他们需要两把钥匙才能进入房间。接下来，您使用策略保护与服务器的通信。我的策略是，唯一通过网络与它通信的是应用程序，并且该信息是加密的。服务器不应以任何其他形式访问。对于备份，我使用[truecrypt](http://www.truecrypt.org/)加密备份将保存到的卷。每当数据被删除或存储在其他地方时，您再次使用 truecrypt 来加密数据所在的卷。基本上无论数据在哪里，都需要加密。确保所有获取数据的过程都带有审计线索。使用日志访问服务器机房，尽可能使用摄像头，等等……另一个措施是对数据库中的信用卡信息进行加密。这确保只能在您的应用程序中查看数据，您可以在其中强制执行谁可以查看信息。

我使用[pfsense](http://www.pfsense.com/)作为我的防火墙。我使用紧凑型闪存卡运行它并设置了两台服务器。一种是用于冗余的故障转移。

我发现了 Rick Strahl 的这篇[博客文章](http://www.west-wind.com/presentations/aspnetecommerce/aspnetecommerce.asp)，它极大地帮助理解了做电子商务以及通过 Web 应用程序接受信用卡需要什么。

好吧，结果证明这是一个很长的答案。我希望这些提示有所帮助。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-09T19:48:50.847

问自己以下问题：*为什么要首先存储信用卡号*？很有可能你没有。事实上，如果您*确实*存储了它们并设法让其中一个被盗，您可能会承担一些严重的责任。

我编写了一个存储信用卡号的应用程序（因为交易是离线处理的）。这是一个很好的方法：

*   获取 SSL 证书！
*   创建一个表单以从用户那里获取 CC#。
*   加密 CC# 的一部分（不是全部！）并将其存储在您的数据库中。（我建议中间 8 位数字。）使用强加密方法和密钥。
*   将 CC# 的其余部分邮寄给处理您的交易的人（可能是您自己），并附上要处理的人的 ID。
*   稍后登录时，您将输入 ID 和 CC# 的邮寄部分。您的系统可以解密另一部分并重新组合以获得完整号码，以便您可以处理交易。
*   最后，删除在线记录。我偏执的解决方案是在删除之前用随机数据覆盖记录，以消除取消删除的可能性。

这听起来需要做很多工作，但是由于从不在任何地方记录完整的 CC#，黑客很难在您的网络服务器上找到任何有价值的东西。相信我，这值得安心。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-20T19:57:19.700

PCI 1.2 文档刚刚发布。它提供了如何实施 PCI 合规性以及要求的过程。你可以在这里找到完整的文档：

[https://www.pcisecuritystandards.org/security_standards/pci_dss.shtml](https://www.pcisecuritystandards.org/security_standards/pci_dss.shtml)

长话短说，为专门用于存储 CC 信息的服务器（通常是 DB 服务器）创建一个单独的网段。尽可能隔离数据，并确保仅存在访问数据所需的最低限度的访问权限。存储时对其进行加密。切勿存储 PAN。清除旧数据并轮换您的加密密钥。

示例不要：

*   不要让可以在数据库中查找一般信息的同一帐户查找 CC 信息。
*   不要将 CC 数据库与 Web 服务器放在同一台物理服务器上。
*   不允许外部（Internet）流量进入您的 CC 数据库网段。

示例执行：

*   使用单独的数据库帐户来查询抄送信息。
*   禁止通过防火墙/访问列表到 CC 数据库服务器的所有但需要的流量
*   将 CC 服务器的访问权限限制为一组有限的授权用户。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-20T07:08:27.753

我想添加一个您可能希望考虑的非技术评论

我的一些客户经营电子商务网站，其中包括一些拥有中等规模商店的客户。这两者，虽然他们当然可以选择不实施支付网关，但他们获取 cc 号码，将其临时加密在线存储并手动处理。

他们这样做是因为欺诈的高发率和手动处理允许他们在填写订单之前进行额外的检查。有人告诉我，他们拒绝了超过 20% 的交易——手动处理肯定需要额外的时间，在一种情况下，他们有一名员工除了处理交易什么都不做，但支付工资的成本显然低于他们的如果他们只是通过在线网关传递 cc 号码，就会曝光。

这两个客户都在提供具有转售价值的实物商品，因此特别容易受到影响，对于欺诈性销售不会导致任何实际损失的软件等项目，您的里程会有所不同，但值得考虑的是在线网关的技术方面如果实施这样真的是你想要的。

编辑：自从创建这个答案以来，我想添加一个警示故事，并说这是一个好主意的时候已经过去了。

为什么？因为我知道另一位采用类似方法的联系人。卡详细信息被加密存储，网站通过 SSL 访问，处理后立即删除号码。你觉得安全吗？

没有——他们网络上的一台机器被密钥记录木马感染了。结果，他们被确定为数起信用卡伪造分数的来源——因此被处以巨额罚款。

因此，我现在**从不**建议任何人自己处理信用卡。此后，支付网关变得更具竞争力和成本效益，欺诈措施也得到了改善。现在的风险已经不值得了。

我可以删除这个答案，但我认为最好保留编辑作为警示故事。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-06-27T00:16:51.547

请记住，使用 SSL 将卡号从浏览器发送到服务器就像当您将卡交给餐厅的收银员时用拇指遮住您的信用卡号：您的拇指 (SSL) 会阻止餐厅中的其他顾客（网络）从看到卡，但是一旦卡在收银员（网络服务器）手中，卡就不再受到 SSL 交换的保护，收银员可以用那张卡做任何事情。访问已保存的卡号只能由 Web 服务器上的安全性阻止。即，网络上的大多数卡片盗窃不是在传输过程中完成的，而是通过突破糟糕的服务器安全性和窃取数据库来完成的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-28T21:29:17.590

为什么要打扰 PCI 合规性？充其量你会削减你的手续费的一小部分。这是其中一种情况，您必须确保这是您想要在开发前期和随着时间的推移跟上最新要求的时间所做的事情。

在我们的案例中，使用订阅型网关并将其与商家帐户配对是最有意义的。订阅精明的网关允许您跳过所有 PCI 合规性，只做正确的交易处理。

我们使用 TrustCommerce 作为我们的网关，并对他们的服务/定价感到满意。他们有多种语言的代码，使集成变得非常容易。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-09-15T11:02:52.087

请务必掌握 PCI 所需的额外工作和预算。PCI 可能需要巨额的外部审计费用和内部努力/支持。还要注意可以单方面对您征收的罚款/处罚，通常与“犯罪”的规模严重不成比例。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-09T01:56:34.900

整个过程有很多。最简单的方法是使用类似于贝宝的服务，这样您就不会真正处理任何信用卡数据。除此之外，要获得批准在您的网站上提供信用卡服务还需要做很多事情。您可能应该与您的银行以及签发您的商家 ID 的人员交谈，以帮助您设置流程。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-09T10:48:59.600

正如其他人所提到的，进入这一领域的最简单方法是使用[Paypal](http://www.paypal.com/)、[Google checkout](http://www.google.com/checkout)或[Nochex](http://www.nochex.com/)。但是，如果您打算进行大量业务，您可能希望查找“升级”到更高级别的站点集成服务，例如[WorldPay](http://worldpay.com/)、[NetBanx（英国）](http://www.netbanx.com/)或[Neteller（美国）](http://www.neteller-group.com/)。所有这些服务都相当容易设置。而且我知道 Netbanx 可以方便地集成到一些现成的购物车解决方案中，例如[Intershop](http://www.intershop.com/)（因为我写了其中一些）。除此之外，您正在考虑与银行系统（及其 APAX 系统）直接集成，但这很难，此时您还需要向信用卡公司证明您正在安全地处理信用卡号码（如果你每月没有拿走 10 万美元的价值）。

从头到尾工作的成本/收益是早期选项更容易（更快/更便宜）设置，让您为每笔交易支付相当高的手续费。后期的设置成本要高得多，但从长远来看，您支付的费用会更少。

大多数非专用解决方案的另一个优点是您不需要保护加密的信用卡号码的安全。那是别人的问题:-)

# excel - 使用 VB 宏修改电子表格

> ID：51098
> 
> 赞同：2
> 
> 时间：2008-09-09T01:56:09.503
> 
> 标签：excel, vba

我有两个电子表格......当一个以某种方式被修改时，我想要一个宏运行，以适当的方式修改第二个。我已经隔离了我需要采取行动的事件（修改特定列中的任何单元格），我似乎无法找到有关访问和修改另一个电子表格的任何具体信息（该电子表格位于不同的 LAN也共享...虽然用户可以访问两者）。

任何帮助都会很棒。关于如何执行此操作或类似内容的参考与具体的代码示例一样好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T02:07:50.927

在 Excel 中，您可能只需编写代码来打开另一个工作表，对其进行修改，然后保存数据。

有关更多信息，请参阅[本教程](http://pubs.logicalexpressions.com/Pub0009/LPMArticle.asp?ID=302)。

稍后我将不得不编辑我的 VBA，所以假设这是伪代码，但它应该看起来像：

```
Dim xl: Set xl = CreateObject("Excel.Application")
xl.Open "\\the\share\file.xls"

Dim ws: Set ws = xl.Worksheets(1)
ws.Cells(0,1).Value = "New Value"
ws.Save

xl.Quit constSilent 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T08:09:38.203

您可以在一行中打开电子表格：

```
Workbooks.Open FileName:="\\the\share\file.xls" 
```

并将其称为活动工作簿：

```
Range("A1").value = "New value" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T08:47:40.887

在您的对象中复制以下内容`ThisWorkbook`以查看特定更改。在这种情况下，当您将一个数值增加到另一个数值时。

注意：您必须用下划线替换`Workbook-SheetChange`和。`Workbook-SheetSelectionChange`例如：`Workbook_SheetChange`并且`Workbook_SheetSelectionChange`下划线在 Markdown 代码中被转义。

```
Option Explicit
Dim varPreviousValue As Variant ' required for IsThisMyChange() . This should be made more unique since it's in the global space.

Private Sub Workbook-SheetChange(ByVal Sh As Object, ByVal Target As Range)
  ' required for IsThisMyChange()
  IsThisMyChange Sh, Target
End Sub

Private Sub Workbook-SheetSelectionChange(ByVal Sh As Object, ByVal Target As Range)
  '  This implements and awful way of accessing the previous value via a global.
  '  not pretty but required for IsThisMyChange()
  varPreviousValue = Target.Cells(1, 1).Value ' NB: This is used so that if a Merged set of cells if referenced only the first cell is used
End Sub

Private Sub IsThisMyChange(Sh As Object, Target As Range)
  Dim isMyChange As Boolean
  Dim dblValue As Double
  Dim dblPreviousValue As Double

  isMyChange = False

  ' Simple catch all. If either number cant be expressed as doubles, then exit.
  On Error GoTo ErrorHandler
  dblValue = CDbl(Target.Value)
  dblPreviousValue = CDbl(varPreviousValue)
  On Error GoTo 0 ' This turns off "On Error" statements in VBA.

  If dblValue > dblPreviousValue Then
     isMyChange = True
  End If

  If isMyChange Then
    MsgBox ("You've increased the value of " & Target.Address)
  End If

  ' end of normal execution
  Exit Sub

ErrorHandler:
  ' Do nothing much.
  Exit Sub

End Sub 
```

如果您希望基于此更改另一个工作簿，我会考虑先检查该工作簿是否已经打开......或者甚至更好地设计一个可以批量处理所有更改并立即执行的解决方案。根据您的收听不断更改另一个电子表格可能会很痛苦。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T16:45:07.707

在玩了一段时间之后，我发现迈克尔的伪代码是最接近的，但我是这样做的：

```
Dim xl As Excel.Application
Set xl = CreateObject("Excel.Application")
xl.Workbooks.Open "\\owghome1\bennejm$\testing.xls"
xl.Sheets("Sheet1").Select 
```

然后，操作表格......可能是这样的：

```
xl.Cells(x, y).Value = "Some text" 
```

完成后，使用这些行完成：

```
xl.Workbooks.Close
xl.Quit 
```

如果进行了更改，将提示用户在文件关闭之前保存文件。可能有一种自动保存的方法，但这种方法实际上更好，所以我就这样离开了。

感谢所有的帮助！

# language-agnostic - 斯巴达编程

> ID：51108
> 
> 赞同：9
> 
> 时间：2008-09-09T02:05:36.627
> 
> 标签：language-agnostic, styles, spartan

我真的很喜欢[Jeff](http://www.codinghorror.com/blog/archives/001148.html)在[Spartan Programming](http://ssdl-wiki.cs.technion.ac.il/wiki/index.php/Spartan_programming)上的帖子。我同意这样的代码阅读起来很有趣。不幸的是，我不太确定与它一起工作是否一定是一种乐趣。

多年来，我一直阅读并坚持“一行一个表达式”的做法。当许多编程书籍用示例代码反驳这个建议时，我已经打了一场好仗并坚持了自己的立场：

```
while (bytes = read(...))
{
   ...
}

while (GetMessage(...))
{
   ...
} 
```

最近，出于更实际的原因，我提倡每行一个表达式 - 调试和生产支持。从生产中获取一个在“第 65 行”声明 NullPointer 异常的日志文件，内容如下：

```
ObjectA a = getTheUser(session.getState().getAccount().getAccountNumber()); 
```

令人沮丧并且完全可以避免。没有使用可以选择“最有可能”为空对象的代码的专家......这是一个真正的实际痛苦。

在单步执行代码时，每行一个表达式也有很大帮助。我假设大多数现代编译器可以优化掉我刚刚创建的所有多余的临时对象。

我尽量保持整洁——但是用显式对象来弄乱我的代码有时确实会让人感到费力。它通常不会使代码更易于浏览 - 但在跟踪生产中的内容或单步执行我或其他人的代码时，它确实派上了用场。

*你*提倡什么风格，你能在实际意义上合理化它吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-09T03:26:01.690

在**The Pragmatic Programmer** Hunt 和 Thomas 讨论了一项他们称之为 Demeter 定律的研究，它侧重于将功能与模块以外的模块耦合。通过允许一个函数在它的耦合中永远不会达到第 3 级，您可以显着减少错误的数量并提高代码的可维护性。

所以：

> ObjectA a = getTheUser(session.getState().getAccount().getAccountNumber());

接近重罪，因为我们在老鼠洞里有 4 个物体。这意味着要更改其中一个对象中的某些内容，我必须知道您在此方法中调用了整个堆栈。多么痛苦。

更好的：

> Account.getUser();

请注意，这与现在在模拟软件中非常流行的表达形式的编程背道而驰。代价是无论如何你都有一个紧密耦合的接口，而富有表现力的语法只是让它更容易使用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T02:46:22.207

我认为理想的解决方案是在极端之间找到平衡。没有办法编写适合所有情况的规则；它带有经验。将每个中间变量声明在自己的行中会增加阅读代码的难度，这也会造成维护的困难。出于同样的原因，如果您内联中间值，调试会更加困难。

“甜蜜点”在中间的某个地方。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T02:08:19.727

每行一个表达式。

没有理由混淆您的代码。输入几个额外术语所花费的额外时间，可以节省调试时间。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T03:01:43.217

我倾向于在可读性方面犯错，不一定是可调试性。您提供的示例绝对应该避免，但我认为明智地使用多个表达式可以使代码更简洁和易于理解。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-09T03:44:03.100

我通常属于“越短越好”的阵营。你的例子很好：

```
ObjectA a = getTheUser(session.getState().getAccount().getAccountNumber()); 
```

如果我看到超过四行而不是一行，我会感到畏缩——我认为这不会使它更容易阅读或理解。你在这里展示它的方式，很明显你正在挖掘一个对象。这不是更好：

```
obja State = session.getState();
objb Account = State.getAccount();
objc AccountNumber = Account.getAccountNumber();
ObjectA a = getTheUser(AccountNumber); 
```

这是一个折衷方案：

```
objb Account = session.getState().getAccount();
ObjectA a = getTheUser(Account.getAccountNumber()); 
```

但我还是更喜欢单行表达式。这是一个轶事原因：我现在很难重新阅读和错误检查 4-liner 是否存在愚蠢的错别字；单行没有这个问题，因为字符更少。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-11-28T13:54:27.877

```
ObjectA a = getTheUser(session.getState().getAccount().getAccountNumber()); 
```

这是一个不好的例子，可能是因为你只是从头顶写了一些东西。`a`您正在为名为type的变量分配名为`ObjectA`的函数的返回值`getTheUser`。
所以让我们假设你写了这个：

```
User u = getTheUser(session.getState().getAccount().getAccountNumber()); 
```

我会像这样打破这个表达：

```
Account acc = session.getState().getAccount();
User user = getTheUser( acc.getAccountNumber() ); 
```

我的理由是：我将如何看待我正在使用这段代码做什么？
我可能会想：“首先我需要从会话中获取帐户，然后我让用户使用该帐户的号码”。

代码应该按照您的想法阅读。变量应指涉及的主要实体；与其属性无关（所以我不会将帐号存储在变量中）。

要记住的第二个因素是：在这种情况下，我是否需要再次引用该实体？
例如，如果我要从会话状态中提取更多内容，我会引入`SessionState state = session.getState()`.

这一切似乎都很明显，但恐怕我很难用语言表达为什么它是有道理的，不是以英语为母语的人等等。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T09:48:31.460

可维护性和可读性是王道。幸运的是，更短通常意味着更具可读性。

这里有一些我喜欢用来切片和切块代码的技巧：

*   **变量名称**：你会如何向团队中的其他人描述这个变量？你*不会*说“numberOfLinesSoFar 整数”。你会说“numLines”或类似的东西 - 易于理解且简短。不要假装维护者根本不知道代码，但要确保你自己能弄清楚变量是什么，即使你忘记了自己编写它的行为。是的，这很明显，但它比我看到的许多编码人员投入的努力更值得，所以我先列出它。
*   **控制流**：一次避免大量结束子句（C++ 中的一系列 }）。通常，当您看到这种情况时，有一种方法可以避免它。一个常见的情况是

：

```
if (things_are_ok) {
  // Do a lot of stuff.
  return true;
} else {
  ExpressDismay(error_str);
  return false;
} 
```

可以替换为

```
if (!things_are_ok) return ExpressDismay(error_str);
// Do a lot of stuff.
return true; 
```

如果我们可以让 ExpressDismay（或其包装器）返回 false。

另一种情况是：

*   **循环迭代**：越标准越好。对于较短的循环，当变量从不使用时，最好使用单字符迭代器，除非作为单个对象的索引。

我在这里争论的特殊情况是反对使用 STL 容器的“正确”方式：

```
for (vector<string>::iterator a_str = my_vec.begin(); a_str != my_vec.end(); ++a_str) 
```

更冗长，并且需要在循环中重载指针运算符 *a_str 或 a_str->size()。对于具有快速随机访问的容器，以下内容更容易阅读：

```
for (int i = 0; i < my_vec.size(); ++i) 
```

在循环体中引用 my_vec[i]，这不会让任何人感到困惑。

最后，我经常看到编码人员为他们的行数计数感到自豪。但重要的不是行号！我不确定实现这一点的最佳方式，但如果你对你的编码文化有任何影响，我会尝试将奖励转向那些拥有紧凑类的人:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-09T10:25:47.377

很好的解释。我认为这是一般[分而治](http://en.wikipedia.org/wiki/Divide_and_conquer_algorithm)之心态的版本。

# winapi - Win32 List-View Control SubItem padding for custom-drawn SubItems?

> ID：51109
> 
> 赞同：7
> 
> 时间：2008-09-09T02:06:13.707
> 
> 标签：winapi, listview, custom-draw

When using custom-draw (NM_CUSTOMDRAW) to draw the entire contents of a ListView SubItem (in Report/Details view), it would be nice to be able to apply the same left and right padding in my custom paint method that is applied by the control itself for non-custom-drawn items.

Is there a way to programmatically retrieve this padding value? Is it related to the width of a particular character (" " or "w" or something?) or is it a fixed value (6px on left and 3px on right or something) or...?

EDIT: To clarify, **I want to add the same padding to my NM_CUSTOMDRAWn SubItems that the control adds to items that it draws**, and the metric that I'm looking for, for example, is the white space between the beginning of the 2nd column and the word "Siamese" in the following screenshot (*Note: screenshot from MSDN added to help explain my question*):

[![List View in Report View](https://i.stack.imgur.com/yTHoy.png)](https://i.stack.imgur.com/yTHoy.png)
[(source: [microsoft.com](https://msdn.microsoft.com/Bb774735.lv_detailsview(en-us,VS.85).png))]

Note that the word "Siamese" is aligned with the header item ("Breed"). I would like to be able to guarantee the same alignment for custom-drawn items.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-21T01:39:21.040

使用 ListView Header 消息 HDM_GETBITMAPMARGIN 查看[链接文本](http://msdn.microsoft.com/en-us/library/bb775314(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-12-09T16:01:52.510

这样做的方法是使用 ListView_GetColumn() 检索相应列的格式，然后检查检索到的 myLVCOLUMN.mask

```
LVCOLUMN myLVCOLUMN;
myLVCOLUMN.mask=LVCF_FMT;
ListView_GetColumn(hwnd,nCol,&myLVCOLUMN); 
```

那么当我们绘制属于该列的对应标签时

```
if(myLVCOLUMN.fmt & LVCFMT_CENTER)
    DrawText(x,x,x,x, DT_CENTER | DT_WORD_ELLIPSIS );
else if (myLVCOLUMN.fmt & LVCFMT_RIGHT)
    DrawText(x,x,x,x, DT_RIGHT | DT_WORD_ELLIPSIS );
else
    DrawText(x,x,x,x, DT_LEFT | DT_WORD_ELLIPSIS ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T06:25:57.373

ListView_GetSubItemRect (LVM_GETSUBITEMTECT)

[http://msdn.microsoft.com/en-us/library/ms930172.aspx](http://msdn.microsoft.com/en-us/library/ms930172.aspx)

尽管文档说了什么，我怀疑 LVIR_LABEL 只返回返回项目文本的边界矩形，根据 ListView_GetItemRect。

（这只是一直困扰着我，因为我在玩 NM_CUSTOMDRAW 时实际上已经在某个地方看到了答案）。

在评论 2 后编辑：

我想您已经看过 NMLVCUSTOMDRAW，如果您愿意使用 6.0 版的话。有rcText。我不会，因为我使用的是 Win2K。

鉴于您的发现，我会回到使用 ListView_GetItemRect 获取 LVIR_LABEL 并将其与 LVIR_BOUNDS 进行比较并使用差异的建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T01:35:12.503

只能猜测没有看到你的输出。

几点建议：如果您使用的是 DrawTextEx 函数，您是否尝试过 DT_INTERNAL 等？

您是否不小心放入了空白图像/图标。

在经典屏幕模式下看起来还可以吗？如果是这样，我会查看 XP Theme 功能，看看是否发生了某些事情。

第一次评论后的后期编辑：

我想知道矩形的大小是否与文本周围的 LVN_ENDLABELEDIT 编辑框所需的空间相匹配，因此文本不会移动（或焦点矩形）？

我想您可以将 LVM_GETITEMRECT 的结果与第一列的 LVIR_LABEL 进行比较，并将差异用作左边框。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T10:50:48.643

我假设*GetSystemMetrics()*是您需要查看的。我认为**SM_CXEDGE**和**SM_CYEDGE**可能是您想要的值，但不要引用我的话。;-)

# php - 在没有 PECL 扩展的 PHP5 中获取本地文件的 MIME 类型？

> ID：51110
> 
> 赞同：0
> 
> 时间：2008-09-09T02:07:26.437
> 
> 标签：php, mime

`mime_content_type()`已弃用。

如何使用但不使用这种不推荐使用的方法或扩展名来查找`MIME type`本地文件？`PHP5``PECL fileinfo`

编辑：这就是我害怕的。不幸的是，他们弃用了一个内置函数，转而支持一个需要扩展但并不总是可用的函数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T02:12:32.617

如果您不能使用 fileinfo 扩展名，并且您不想使用 mime_content_type，那么您的选择是有限的。

您很可能需要根据文件扩展名进行查找。mime_content_type 做了一些更智能的事情，实际上是在文件中查找特殊数据来确定 mime 类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T10:38:23.743

getID3 [()](http://getid3.sourceforge.met "获取 ID3")库是一个快速且简单的大多数时间选项。最初以获取 MP3 ID3 数据的项目命名，该库的功能远不止于此，而且对于各种常见或奇怪的文件元数据任务非常方便。

我用它来获取在线图像和视频工具的 MIME 类型的文件。在我完成的所有测试中，我没有看到 getID3 错误地获取 MIME 类型。

我还用它来检查 QuickTime 视频是否有流媒体提示。我提到这是多功能性的一个例子。

第二个更耗时的选项是按照已经建议的方式滚动您自己的 MIME 类型检查器。如果您有一个 MIME 魔术文件，则可以通过将文件数据的前 n 个字节与从您的 MIME 魔术文件派生的 MIME 类型查找表进行比较来比查找文件扩展名更进一步。

一个典型的 MIME 魔术文件将包含超过 500 组 MIME 类型，这可能会导致比较缓慢（需要进行大量检查）。在您的家庭滚动解决方案中硬编码 10 种最常见的 MIME 类型检查将对此有所帮助。

# c# - What's the best way to detect if an IDataReader is empty?

> ID：51113
> 
> 赞同：10
> 
> 时间：2008-09-09T02:08:36.557
> 
> 标签：c#, ado.net

It seems like IDataReader.Read() is always true at least one time (If I'm wrong about this let me know.) So how do you tell if it has no records without just wrapping it in a try/catch?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-09T02:14:40.613

```
if(dr.Read())
{
   //do stuff
}
else
{
 //it's empty
} 
```

usually you'll do this though:

```
while(dr.Read())
{
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T02:15:31.643

Yes, if you want to use the interface then Read until false is the only way to test. If you are looking for a generic `IDataReader` implementation, you could try `DbDataReader` and use the `HasRows` property.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-22T12:06:10.907

你可以`System.Data.IDataReader`投到`System.Data.Common.DbDataReader`

```
using (System.Data.IDataReader IReader = ICommand.ExecuteReader())
{
    if (((System.Data.Common.DbDataReader)IReader).HasRows)
    {
        //do stuff
    }
} // End Using IReader 
```

这是纯粹的邪恶，但它（通常）有效；）

（假设您的实例`IDataReader`是由自定义 ADO.NET 提供程序实现的，而不是您的某些自定义愚蠢类，它只是实现`IDataReader`而不是从`DbDataReader`[which implements `IDataReader`] 派生）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-04-23T16:35:00.843

刚刚偶然发现这个问题并想出了这个......

```
bool isBeforeEoF;

do
{
    isBeforeEoF = reader.Read();

    if (isBeforeEoF)
    {
        yield return new Foo()
        {
            StreamID = (Guid)reader["ID"],
            FileType = (string)reader["Type"],
            Name = (string)reader["Name"],
            RelativePath = (string)reader["RelativePath"]
        };         
    }

} while (isBeforeEoF); 
```

# asp.net - 没有 Microsoft SQL Server 的 ASP.NET 3.5 - 我会失去什么？

> ID：51114
> 
> 赞同：2
> 
> 时间：2008-09-09T02:09:25.760
> 
> 标签：asp.net, mysql, .net-3.5

我刚刚被分配使用 ASP.net 3.5 和 MySQL 做一个 CMS。我是 ASP.NET 开发的新手（使用 C# 就足够了），**我想知道当我没有选择使用 Microsoft SQL Server 时，我会失去哪些主要的 ASP.NET 和一般 .NET 功能。**

我已经通过快速谷歌搜索知道我失去了 LINQ（我真的很期待使用它来构建我的模型层！），但我不确定我会失去哪些其他方便的功能。由于我一直依赖假设您使用 MS SQL Server 的 ASP.net 教程，我觉得我的大部分 ASP.net 知识变得无效。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-09T02:13:31.040

您可以在许多 ORM 中利用 MySql，其中之一是 NHibernate。在大多数情况下，您可以将其视为在 SQL Server 或 Oracle 上运行。使用 Linq2NHibernate，您可以获得很好的 LINQ 语法。

您会失去 SqlDataSource 控件，但有些人会争辩说这实际上是一种祝福 :)

当然你会失去 Linq2SQL。EntityFramework 将在发布后不久拥有第 3 方适配器 MySql、Oracle 和其他一些适配器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T15:08:28.477

你不会失去 LINQ，你会失去 LINQtoSQL。LINQ 本身更通用，因为它可以用于任何实现 iQueryable 的东西。

你失去了 SqlDataSource，没什么大不了的。

您失去了服务器资源管理器为您与 sql server 所做的一些集成，这也没什么大不了的。

就我而言，您不会丢失任何非常重要的东西，也不应该丢失任何 .net 知识。大多数示例使用 sql server 作为默认值，但可以轻松更改它们以使用另一个数据库。

还有一些使用 MySql 的开源 .net CMS 包，看看[cuyahoga](http://www.cuyahoga-project.org/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T02:15:33.240

由于丢失通知服务，您也会丢失[SqlCacheDependency](http://msdn.microsoft.com/en-us/library/ms178604.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T05:15:18.090

想到的一些事情：

*   asp.net 有很好的“自动”用户管理（身份验证）系统。我认为它只适用于 SQL Server，但可能有一种方法可以让它在其他数据库上运行。这些教程通常假设 SQL Server（或用于开发的基于文件的内置数据库）
*   与 asp.net 无关，但对任何项目都很有用的是 SQLCLR，我发现它是 sql server 的一个很好的补充。允许您将在业务级别（支持 dll 或类）中编写的逻辑委托给 SP 中的 sql server，但 SP 是用 vb.net/c# 编写的
*   [通知服务](http://msdn.microsoft.com/en-us/library/ms170722(SQL.90).aspx)

# sql-server - SQL Server“带加密”语句的用处

> ID：51124
> 
> 赞同：5
> 
> 时间：2008-09-09T02:16:44.510
> 
> 标签：sql-server, encryption

最近，我和一个朋友正在讨论如何保护 SQL Server 数据库中的存储过程代码。

从遥远的记忆中，我很确定“加密”在所有版本的 SQL Server 中都非常容易被破解，但是他说它在 SQL 2005 中得到了很大的改进。因此，我没有认真地将其视为安全选项在我曾经工作过的任何系统中。

那么在什么情况下可以使用“加密”，什么时候应该不惜一切代价避免呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T02:24:29.607

它可用于向不经意的观察者隐藏您的代码，但正如您所说：它很容易被规避。

它真的不可能是任何其他方式，因为服务器需要解密代码才能执行它。它基本上是 DRM，并且由于与所有其他 DRM 相同的原因而失败 - 您不能同时隐藏数据并允许访问它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T05:02:38.370

@Blorgbeard

很好的回应，关于“WITH ENCRYPTION”的 MSDN 文档似乎同意你的观点，现在称它为“混淆”而不是加密。

然而，我遇到了一些完全不了解这一点的开发人员。希望这个问题/回答也能告知其他人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-20T04:04:34.663

是的，它很容易坏掉。上周我遇到了一种情况，我必须解密几个前开发人员为我的客户加密的存储过程。解密后，我付出了适度的努力，我不会依赖它来保护知识产权、密码、用户 ID 的任何方法。真的什么都有。

# c# - 你如何修改文本框控件制表位

> ID：51126
> 
> 赞同：1
> 
> 时间：2008-09-09T02:21:26.823
> 
> 标签：c#, .net, winforms

当您使用 Windows 窗体 TextBox 时，默认的制表位（空格）数为 8。您如何修改它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T02:23:01.937

首先添加以下命名空间

```
using System.Runtime.InteropServices; 
```

然后在类声明后添加以下内容：

```
private const int EM_SETTABSTOPS = 0x00CB;
[DllImport("User32.dll", CharSet = CharSet.Auto)]
public static extern IntPtr SendMessage(IntPtr h, 
 int msg, 
 int wParam, 
 int [] lParam); 
```

然后将以下内容添加到 Form_Load 事件中：

```
// define value of the Tab indent 
int[] stops = {16}; 
// change the indent 
SendMessage(this.textBox1.Handle, EM_SETTABSTOPS, 1, stops); 
```

# c# - 如何从 C# 中的 XML Web 服务获取值？

> ID：51129
> 
> 赞同：4
> 
> 时间：2008-09-09T02:24:08.283
> 
> 标签：c#, xml, web-services

在 C# 中，如果我需要打开 HTTP 连接、下载 XML 并从结果中获取一个值，我该怎么做？

为了保持一致性，假设 Web 服务位于 www.webservice.com，如果您将 POST 参数 fXML=1 传递给它，它会返回给您

```
<xml><somekey>somevalue</somekey></xml> 
```

我希望它吐出“somevalue”。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T02:30:19.360

我认为首先阅读此内容会很有用：

[创建和使用 Web 服务](http://aspnet.4guysfromrolla.com/articles/062602-1.aspx)（在 .NET 中）

这是一系列关于如何在 .NET 中使用 Web 服务的教程，包括如何使用 XML 输入（反序列化）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T04:31:03.610

我使用这段代码，效果很好：

```
System.Xml.XmlDocument xd = new System.Xml.XmlDocument;
xd.Load("http://www.webservice.com/webservice?fXML=1");
string xPath = "/xml/somekey";
// this node's inner text contains "somevalue"
return xd.SelectSingleNode(xPath).InnerText; 
```

* * *

编辑：我刚刚意识到你在谈论一个网络服务，而不仅仅是普通的 XML。在您的 Visual Studio 解决方案中，尝试右键单击解决方案资源管理器中的引用并选择“添加 Web 引用”。将出现一个对话框询问 URL，您可以将其粘贴到：“ [http://www.webservice.com/webservice.asmx](http://www.webservice.com/webservice.asmx) ”。VS 会自动生成你需要的所有助手。然后你可以打电话：

```
com.webservice.www.WebService ws = new com.webservice.www.WebService();
// this assumes your web method takes in the fXML as an integer attribute
return ws.SomeWebMethod(1); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T02:38:11.573

你可以使用类似的东西：

```
var client = new WebClient();
var response = client.UploadValues("www.webservice.com", "POST", new NameValueCollection {{"fXML", "1"}});
using (var reader = new StringReader(Encoding.UTF8.GetString(response)))
{
    var xml = XElement.Load(reader);
    var value = xml.Element("somekey").Value;
    Console.WriteLine("Some value: " + value);                
} 
```

注意我没有机会测试这段代码，但它应该可以工作:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T08:23:43.707

值得补充的是，如果您需要专门使用 POST 而不是 SOAP，那么您可以配置 Web 服务以接收 POST 调用：

查看 MSDN 上的页面： [使用 ASP.NET 创建的 XML Web 服务的配置选项](http://msdn.microsoft.com/en-us/library/aa719747(VS.71).aspx)

# architecture - Define realtime on the web for business

> ID：51135
> 
> 赞同：8
> 
> 时间：2008-09-09T02:30:05.337
> 
> 标签：architecture

It drives me nuts to hear business proponents using the term realtime for web-based systems. I'm becoming the crazy in the room, chanting, "There is no such thing as realtime on the web! We're in banking, not the rocket launch/ship navigation/airplane autopilot business!"

Anyone have anything better for performance specifications than realtime, or its horrible hybrid, near-realtime?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-09T02:36:19.953

In the banking industry most of the time "real time" means the opposite of "end-of-day".

Because there was no such thing as internet/intranet/LANs/WANs in the old days, all balancing is done at "end-of-day". Transactions done in one branch with a certain bank account are oblivious of the transactions done in another; all of the balance resolution will occur during end of day. When mainframes came in the same rule applied: resolutions are done by computer by a long-running-process usually run between 9PM and 12 midnight.

This is the reason behind terms such as "current balance" and "available balance", e.g., available balance is what has been determined by the end-of-day process as an account's balance for the previous day; current balance is what it's supposed to be, but you can't touch it yet since the bank is not sure if you've made some transaction somewhere else.

With the advent of ATMs, the internet, and other interconnectivity technologies, "real time" balance resolution is now possible: a withdrawal, an online transaction, a purchase debit, etc will immediately be reflected in the customers' bank accounts without the need to wait for end-of-day processing.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T02:38:28.623

Immediate? Instant? Live (no, wait, Microsoft owns that word these days, don't they?)?

More seriously, "realtime" is probably not confusing for anyone who doesn't have a process-control / embedded-system background. Have a comforting beverage and worry about other things.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T02:34:54.483

Real-time means one thing to an embedded programmer. It means something else to a normal person. If my online balance always matches my ATM/bank-teller's balance, I would call that pretty real-time. If I can transfer money between accounts, refresh the screen, and immediately see the completed transfer, I would call that real-time.

If you web backend just prints out orders for human intervention, or dumps user-commands in a file for offline batch processing, that would not be realtime.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T06:08:22.133

实时意味着当你有一组任务为了执行一个任务而执行时，如果一个任务的完成时间超过了定义的时间，整个过程就会失败，系统可能会崩溃。例如，用于控制火星探测车的应用程序被认为是实时应用程序，即使在地球上触发的命令需要 8 分钟才能到达车辆，而车载摄像头的图像需要 8 分钟才能到达地球。因此，即使在采取行动和看到结果之间有 16 分钟的延迟，也可以将其定义为实时的，因为如果延迟超过 16 分钟的计划延迟，则车辆可能会与岩石或岩石发生碰撞的巨大风险。陷入抑郁。

回到您的示例，我没有看到 ATM 机，或者上述余额是实时的，它们可能是在线的或更新的，但不是实时的，因为如果需要更多的时间来完成一个系统，您不会崩溃在 ATM 取款。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T02:33:07.403

Inline? As in actions happen **inline** with your actions as opposed to out-of-band or end of the day batch jobs.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T15:35:03.967

您如何定义嵌入式系统的“实时”？我想说一个体面的定义是“一个能够比输入之间的平均时间更快地处理和响应输入的系统”。换句话说，与为其提供数据的系统相比，该系统在处理方面永远不会落后。使用这个定义，网络上的一切都是实时系统，因为落后的网络服务器往往无法访问（即斜线效应）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-22T22:52:29.587

It's a marketing term that means "really fast", like maybe < 1 second.

Obviously it can't mean the same thing as when people talk about real-time embedded systems, real-time operating systems, etc. The web is too big and heterogeneous for that.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-22T18:45:54.063

实时系统的一个定义（来自安全关键系统世界）是一个系统，其正确性取决于其响应的及时性。

这同样适用于实时网络交易系统——股票价值在几秒钟内就会过时，对于具有毫秒准确性要求的嵌入式航空电子电传操纵系统而言。

# sql-server - How to insert a row into a dataset using SSIS?

> ID：51139
> 
> 赞同：0
> 
> 时间：2008-09-09T02:33:47.307
> 
> 标签：sql-server, ssis

I'm trying to create an SSIS package that takes data from an XML data source and for each row inserts another row with some preset values. Any ideas? I'm thinking I could use a DataReader source to generate the preset values by doing the following:

```
SELECT 'foo' as 'attribute1', 'bar' as 'attribute2' 
```

The question is, how would I insert one row of this type for every row in the XML data source?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T15:28:57.587

我不确定我是否理解这个问题......我的假设是你有*n*条记录从你的数据源进入 SSIS，并且你希望你的输出有*n* * 2 条记录。

为此，您可以执行以下操作：

*   多播以创建输入数据的多个副本
*   派生列转换以在副本上设置“预设”值
*   种类
*   合并

我是否在正确的轨道上/你想要完成什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T03:13:51.610

我从来没有尝试过，但看起来你可以使用[派生列转换](http://msdn.microsoft.com/en-us/library/ms141069(SQL.90).aspx)来做到这一点：将属性 1 的表达式设置为 ，将属性 2`"foo"`的表达式设置为`"bar"`。

然后，您将转换原始数据源，然后仅使用目标中的派生列。如果您仍然需要原始源，您可以多播它以创建一个副本。

根据文档，至少我认为这会起作用。YMMV。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T21:56:53.717

我可能会切换到使用脚本任务并将您的逻辑放在那里。您仍然可以利用 SSIS 中的文件读取和其他对象来保存一些代码。

# windows - Win32 ToolTip disappears never to re-appear with Commctl 6

> ID：51146
> 
> 赞同：8
> 
> 时间：2008-09-09T02:41:26.853
> 
> 标签：windows, winapi

I'm creating a [ToolTip](http://msdn.microsoft.com/en-us/library/bb760250(VS.85).aspx) window and adding tools to it using the flags TTF_IDISHWND | TTF_SUBCLASS. (c++, win32)

I have a manifest file such that my program uses the new WindowsXP themes (comctrl32 version 6).

When I hover over a registered tool, the tip appears.
Good.
When I click the mouse, the tip disappears.
Ok.
However, moving away from the tool and back again does not make the tip re-appear. I need to hover over a different tool and then come back to my tool to get the tip to come back.

When I remove my manifest file (to use the older non-XP comctrl32), the problem goes away.

After doing some experimentation, I discovered the following differences between ToolTips in Comctl32 version 5 (old) and Comctl32 version 6 (new):

*   New TTF_TRANSPARENT ToolTips (when used In-Place) actually return HTCLIENT from WM_NCITTEST if a mouse button is down, thus getting WM_LBUTTONDOWN and stealing focus for a moment before vanishing. This causes the application's border to flash.

*   Old TTF_TRANSPARENT ToolTips always return HTTRANSPARENT from WM_NCHITTEST, and thus never get WM_LBUTTONDOWN themselves and never steal focus. (This seems to be just aesthetic, but may impact the next point...)

*   New ToolTips seem not to get WM_TIMER events after a mouse-click, and only resume getting (a bunch of) timer events after being de-activated and re-activated. Thus, they do not re-display their tip window after a mouse click and release.

*   Old ToolTips get a WM_TIMER message as soon as the mouse is moved again after click/release, so they are ready to re-display their tip.

Thus, as a comctl32 workaround, I had to:

*   subclass the TOOLTIPS_CLASS window and always return HTTRANSPARENT from WM_NCHITTEST if the tool asked for transparency.

*   avoid using TTF_SUBCLASS and rather process the mouse messages myself so I could de-activate/re-activate upon receiving WM_xBUTTONUP.

I assume that the change in internal behavior was to accommodate the new "clickable" features in ToolTips like hyperlinks, but the hover behavior appears to be thus broken.

Does anyone know of a better solution than my subclass workaround? Am I missing some other point?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T13:21:41.823

您不是唯一一个遇到这些 DLLS 之间的工具提示兼容性问题的人。

**我**也对主题通用控件中的新工具提示感到困惑。在添加清单和主题化我们的应用程序之前，我们已经在使用鼠标消息和激活/停用提示 - 所以听起来你所做的并不太疯狂。

我们仍然面临着随着鼠标移动（不仅仅是在悬停时）不断发送 TTN_NEEDTEXT 消息、大提示定位问题（可能不是新事物）以及发送奇怪的 unicode 消息而不是 ANSI 版本（我计划在某个时候作为问题发布）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T07:23:15.677

我不知道，但这听起来像是一个非常“难”的问题（从某种意义上说，所有现实世界的问题都非常难）。我敢打赌，根本问题与焦点的设置有关。手动执行此操作的 Windows 是邪恶的，并且通常会遇到各种错误。

# c# - 如何确定一个进程是否已经在使用 c# 运行？

> ID：51148
> 
> 赞同：28
> 
> 时间：2008-09-09T02:54:06.637
> 
> 标签：c#, winforms, external-process

我有 C# winforms 应用程序需要不时启动一个外部 exe，但如果一个进程已经在运行，我不希望启动另一个进程，而是切换到它。

那么在下面的示例中，我将如何在 C# 中这样做呢？

```
using System.Diagnostics;

...

Process foo = new Process();

foo.StartInfo.FileName = @"C:\bar\foo.exe";
foo.StartInfo.Arguments = "Username Password";

bool isRunning = //TODO: Check to see if process foo.exe is already running

if (isRunning)
{
   //TODO: Switch to foo.exe process
}
else
{
   foo.Start(); 
} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-09T02:58:09.653

这应该为你做。

[检查流程](http://www.dreamincode.net/code/snippet1541.htm)

```
//Namespaces we need to use
using System.Diagnostics;

public bool IsProcessOpen(string name)
{
    //here we're going to get a list of all running processes on
    //the computer
    foreach (Process clsProcess in Process.GetProcesses()) {
        //now we're going to see if any of the running processes
        //match the currently running processes. Be sure to not
        //add the .exe to the name you provide, i.e: NOTEPAD,
        //not NOTEPAD.EXE or false is always returned even if
        //notepad is running.
        //Remember, if you have the process running more than once, 
        //say IE open 4 times the loop thr way it is now will close all 4,
        //if you want it to just close the first one it finds
        //then add a return; after the Kill
        if (clsProcess.ProcessName.Contains(name))
        {
            //if the process is found to be running then we
            //return a true
            return true;
        }
    }
    //otherwise we return a false
    return false;
} 

```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-09T03:35:58.780

您也可以使用 LINQ，

```
var processExists = Process.GetProcesses().Any(p => p.ProcessName.Contains("<your process name>")); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-09T03:09:34.710

我在 VB 运行时中使用了 AppActivate 函数来激活现有进程。您必须将 Microsoft.VisualBasic dll 导入 C# 项目。

```
using System;
using System.Diagnostics;
using Microsoft.VisualBasic;

namespace ConsoleApplication3
{
    class Program
    {
        static void Main(string[] args)
        {
            Process[] proc = Process.GetProcessesByName("notepad");
            Interaction.AppActivate(proc[0].MainWindowTitle);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-09T03:01:27.693

[您可以使用Process.GetProcesses](http://msdn.microsoft.com/en-us/library/1f3ys1f9.aspx)方法简单地枚举进程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-05-23T08:26:41.043

我发现 Mutex 不像在控制台应用程序中那样工作。因此，使用 WMI 查询可以使用任务管理器窗口看到的进程将解决您的问题。

使用这样的东西：

```
static bool isStillRunning() {
   string processName = Process.GetCurrentProcess().MainModule.ModuleName;
   ManagementObjectSearcher mos = new ManagementObjectSearcher();
   mos.Query.QueryString = @"SELECT * FROM Win32_Process WHERE Name = '" + processName + @"'";
   if (mos.Get().Count > 1)
   {
        return true;
    }
    else
        return false;
} 
```

注意：添加程序集引用“System.Management”以启用智能感知类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T03:07:23.483

我认为您的问题的完整答案需要了解当您的应用程序确定 foo.exe 的实例已经在运行时会发生什么，即“//TODO：切换到 foo.exe 进程”实际上是什么意思？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-09T03:43:28.687

在过去的项目中，我需要防止进程多次执行，因此我在该进程的 init 部分添加了一些代码，该代码创建了一个命名互斥锁。在继续该过程的其余部分之前，已创建并获取了该 mutext。如果进程可以创建互斥体并获取它，那么它是第一个运行的。如果另一个进程已经控制了互斥锁，那么失败的不是第一个，所以它立即退出。

由于对特定硬件接口的依赖，我只是试图阻止第二个实例运行。根据您对“切换到”行的需求，您可能需要更具体的解决方案，例如进程 ID 或句柄。

此外，我可以访问我试图启动的进程的源代码。如果不能修改代码，添加互斥锁显然不是一种选择。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-09T04:29:19.153

要记住两个问题：

1.  您的示例涉及在命令行上放置密码。秘密的明文表示可能是一个安全漏洞。

2.  枚举进程时，问问自己真正想枚举哪些进程。所有用户，还是只是当前用户？如果当前用户登录了两次（两个桌面）怎么办？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-09T03:50:13.427

> Mnebuerquo 写道：
> 
> > 此外，我可以访问我试图启动的进程的源代码。如果不能修改代码，添加互斥锁显然不是一种选择。

我没有对我要运行的进程的源代码访问权限。

一旦我发现它已经在运行，我最终使用进程 MainWindowHandle 切换到进程：

```
[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
 public static extern bool SetForegroundWindow(IntPtr hWnd); 
```

# windows - Why does clicking a child window not always bring the application to the foreground?

> ID：51150
> 
> 赞同：6
> 
> 时间：2008-09-09T02:58:15.067
> 
> 标签：windows, winapi

When an application is behind another applications and I click on my application's taskbar icon, I expect the entire application to come to the top of the z-order, even if an app-modal, WS_POPUP dialog box is open.

However, some of the time, for some of my (and others') dialog boxes, only the dialog box comes to the front; the rest of the application stays behind.

I've looked at Spy++ and for the ones that work correctly, I can see WM_WINDOWPOSCHANGING being sent to the dialog's parent. For the ones that leave the rest of the application behind, WM_WINDOWPOSCHANGING is not being sent to the dialog's parent.

I have an example where one dialog usually brings the whole app with it and the other does not. Both the working dialog box and the non-working dialog box have the same window style, substyle, parent, owner, ontogeny.

In short, both are WS_POPUPWINDOW windows created with DialogBoxParam(), having passed in identical HWNDs as the third argument.

Has anyone else noticed this behavioral oddity in Windows programs? What messages does the TaskBar send to the application when I click its button? Who's responsibility is it to ensure that *all* of the application's windows come to the foreground?

In my case the base parentage is an MDI frame...does that factor in somehow?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-11-22T05:14:03.430

我知道这已经很老了，但我只是偶然发现它，我知道答案。

在您已经看到（和编写）的应用程序中，将对话框带到前台并**没有**将主窗口随之打开，开发人员只是忽略了指定对话框的所有者。

这适用于模态窗口，如对话框和消息框，以及非模态窗口。设置无模式弹出窗口的所有者也会始终保持弹出窗口高于其所有者。

在 Win32 API 中，弹出对话框或消息框的函数将所有者窗口作为参数：

```
INT_PTR DialogBox(
    HINSTANCE hInstance,
    LPCTSTR lpTemplate,
    HWND hWndParent,      /* this is the owner */
    DLGPROC lpDialogFunc
);

int MessageBox(
    HWND hWnd,            /* this is the owner */
    LPCTSTR lpText,
    LPCTSTR lpCaption,
    UINT uType
); 
```

同样，在 .NET WinForms 中，可以指定所有者：

```
public DialogResult ShowDialog(
    IWin32Window owner
)

public static DialogResult Show(
    IWin32Window owner,
    string text
) /* ...and other overloads that include this first parameter */ 
```

此外，在 WinForms 中，很容易设置无模式窗口的所有者：

```
public void Show(
    IWin32Window owner,
) 
```

或者，等效地：

```
form.Owner = this;
form.Show(); 
```

在直接的 WinAPI 代码中，可以在创建窗口时设置无模式窗口的所有者：

```
HWND CreateWindow(
    LPCTSTR lpClassName,
    LPCTSTR lpWindowName,
    DWORD dwStyle,
    int x,
    int y,
    int nWidth,
    int nHeight,
    HWND hWndParent, /* this is the owner if dwStyle does not contain WS_CHILD */
    HMENU hMenu,
    HINSTANCE hInstance,
    LPVOID lpParam
); 
```

或之后：

```
SetWindowLong(hWndPopup, GWL_HWNDPARENT, (LONG)hWndOwner); 
```

或（64 位兼容）

```
SetWindowLongPtr(hWndPopup, GWLP_HWNDPARENT, (LONG_PTR)hWndOwner); 
```

请注意，MSDN 对[SetWindowLong[Ptr]](http://msdn.microsoft.com/en-us/library/ms644898(VS.85).aspx)有以下说法：

> 不要使用 GWLP_HWNDPARENT 索引调用**SetWindowLongPtr**来更改子窗口的父级。而是使用[SetParent](http://msdn.microsoft.com/en-us/library/ms633541(VS.85).aspx)函数。

这有点误导，因为它似乎暗示上面的最后两个片段是错误的。事实并非如此。调用`SetParent`会将预期的弹出窗口变成父窗口的子窗口（设置它的*位*`WS_CHILD`），而不是使其成为拥有的窗口。上面的代码是使现有弹出窗口成为拥有窗口的正确方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-19T04:08:19.307

当您单击任务栏图标时，Windows 将向您的应用程序发送**WM_ACTIVATE**消息。

您确定您的代码将**WM_ACTIVATE**消息传递给**DefWindowProc**窗口过程进行处理吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T03:16:05.490

对话框的父窗口设置是否正确？

发布此内容后，我启动了自己的 Windows 窗体应用程序并重现了您描述的问题。我有两个对话框，一个可以正常工作，另一个不能正常工作，我看不出任何直接原因是为什么它们的行为不同。如果我发现，我会更新这篇文章。

雷蒙德陈你在哪里！

# css - 有没有办法用 CSS 选择列表的最后一项？

> ID：51156
> 
> 赞同：11
> 
> 时间：2008-09-09T03:11:59.463
> 
> 标签：css, css-selectors

假设我有一个如下列表：

*   项目1
*   项目2
*   第 3 项

是否有一个 CSS 选择器可以让我直接选择列表的最后一项？在这种情况下，第 3 项。

干杯!

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-09T03:14:58.100

不是我知道的。传统的解决方案是用 class="first" & class="last" 标记第一个和最后一个项目，以便您识别它们。

CSS psudo-class [first-child](http://www.w3.org/TR/CSS2/selector.html#first-child)将为您提供第一项，但并非所有浏览器都支持它。CSS3 也会有[last-child](http://www.w3.org/TR/2001/CR-css3-selectors-20011113/#last-child-pseudo)（目前 Firefox、Safari 支持，但 IE 6/7/beta 8 不支持）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T09:49:00.587

在得到适当支持之前，您需要按照建议为“最后一个”项目添加一个类。不过，您不必手动执行此操作。如果您可以点击 javascript，请查看以下任一选项：

*   [jQuery :last-child 选择器](http://docs.jquery.com/Selectors/lastChild)
*   [让 Elements 的孩子与后代保持一致](http://www.alistapart.com/articles/keepelementskidsinlinewithoffspring)（Alex Bischoff 的列表分开文章），一种特定的、轻量级的方法

两者都可以避免“污染”您的标记，并且如果您的风格是“不错的补充”而不是“必须具备”的设计功能，则完全可以接受。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-04T20:27:47.663

这个问题的答案应该更新！IE9 + Firefox（前一阵子）+ Chrome、Safari 全部支持：`last-of-type`或`last-child`

# java - Weblogic 默认处理程序可以显示上下文列表吗？

> ID：51157
> 
> 赞同：1
> 
> 时间：2008-09-09T03:13:18.367
> 
> 标签：java, jakarta-ee, weblogic

在 Jetty 中，如果在 '/' 处没有部署，则[DefaultHandler](http://www.mortbay.org/jetty/jetty-6/xref/org/mortbay/jetty/handler/DefaultHandler.html)会显示已知上下文的列表。这在开发过程中非常有用。

是否可以配置 BEA Weblogic 以提供类似的便利？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-15T17:10:13.890

您可以编写一个小型 webapp，它连接到`Weblogic JMX`并显示已部署 webapps 的列表，并将该 webapps 部署在“/”处。

# javascript - 如何在 JavaScript 中对字符串进行排序

> ID：51165
> 
> 赞同：462
> 
> 时间：2008-09-09T03:25:15.343
> 
> 标签：javascript, string

我有一个对象列表，我希望根据`attr`字符串类型的字段进行排序。我尝试使用`-`

```
list.sort(function (a, b) {
    return a.attr - b.attr
}) 
```

但发现这`-`似乎不适用于 JavaScript 中的字符串。如何根据字符串类型的属性对对象列表进行排序？

* * *

## 回答 #1

> 赞同：814
> 
> 时间：2008-09-09T03:29:17.300

[`String.prototype.localeCompare`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/String/localeCompare)根据您的示例使用：

```
list.sort(function (a, b) {
    return ('' + a.attr).localeCompare(b.attr);
}) 
```

我们强制 a.attr 为字符串以避免异常。[自 Internet Explorer 6](https://docs.microsoft.com/en-us/scripting/javascript/reference/localecompare-method-string-javascript)`localeCompare`和 Firefox 1起已受支持。您可能还会看到使用的以下代码不尊重语言环境：

```
if (item1.attr < item2.attr)
  return -1;
if ( item1.attr > item2.attr)
  return 1;
return 0; 
```

* * *

## 回答 #2

> 赞同：195
> 
> 时间：2014-10-10T08:39:42.707

## 更新的答案（2014 年 10 月）

我对这个字符串自然排序顺序感到非常恼火，所以我花了一些时间来调查这个问题。我希望这有帮助。

### 长话短说

`localeCompare()`角色支持很糟糕，只需使用它。正如所指出的`Shog9`，您的问题的答案是：

```
return item1.attr.localeCompare(item2.attr); 
```

### 在所有自定义 javascript“自然字符串排序顺序”实现中发现的错误

那里有很多自定义实现，试图更精确地进行字符串比较，称为“自然字符串排序顺序”

在“玩”这些实现时，我总是注意到一些奇怪的“自然排序”选择，或者更确切地说是错误（或者在最好的情况下是遗漏）。

通常，无法正确处理特殊字符（空格、破折号、与号、括号等）。

然后，您会发现它们在不同的地方混杂在一起，通常可能是：

*   有些会在大写“Z”和小写“a”之间
*   有些会在“9”和大写“A”之间
*   有些会在小写“z”之后

当人们期望特殊字符全部“组合”在一个地方时，可能除了空格特殊字符（它始终是第一个字符）。也就是说，要么全部在数字之前，要么全部在数字和字母之间（小写和大写一个接一个地“在一起”），或者全部在字母之后。

我的结论是，当我开始添加几乎不常见的字符（即带有变音符号或破折号、感叹号等字符的字符）时，它们都无法提供一致的顺序。

定制实现的研究：

*   `Natural Compare Lite` [https://github.com/litejs/natural-compare-lite](https://github.com/litejs/natural-compare-lite)：无法一致排序[https://github.com/litejs/natural-compare-lite/issues/1](https://github.com/litejs/natural-compare-lite/issues/1)和[http://jsbin.com/bevututodavi/ 1/edit?js,console](http://jsbin.com/bevututodavi/1/edit?js,console)，基本拉丁字符排序[http://jsbin.com/bevututodavi/5/edit?js,console](http://jsbin.com/bevututodavi/5/edit?js,console)
*   `Natural Sort` [https://github.com/javve/natural-sort](https://github.com/javve/natural-sort)：始终无法排序，请参阅问题[https://github.com/javve/natural-sort/issues/7](https://github.com/javve/natural-sort/issues/7)并查看基本拉丁字符排序[http://jsbin。 com/cipimosedoqe/3/edit?js,控制台](http://jsbin.com/cipimosedoqe/3/edit?js,console)
*   `Javascript Natural Sort` [https://github.com/overset/javascript-natural-sort](https://github.com/overset/javascript-natural-sort)：自 2012 年 2 月以来似乎被忽视了，未能始终如一地排序，请参阅问题[https://github.com/overset/javascript-natural-sort/issues/16](https://github.com/overset/javascript-natural-sort/issues/16)
*   `Alphanum` [http://www.davekoelle.com/files/alphanum.js](http://www.davekoelle.com/files/alphanum.js)，无法一致排序，请参阅[http://jsbin.com/tuminoxifuyo/1/edit?js,console](http://jsbin.com/tuminoxifuyo/1/edit?js,console)

### 浏览器的原生“自然字符串排序顺序”实现通过`localeCompare()`

`localeCompare()`IE6+ 支持最旧的实现（没有语言环境和选项参数），请参阅[http://msdn.microsoft.com/en-us/library/ie/s4esdbwz](http://msdn.microsoft.com/en-us/library/ie/s4esdbwz(v=vs.94).aspx) (v=vs.94).aspx（向下滚动到 localeCompare( ） 方法）。内置`localeCompare()`方法在排序方面做得更好，甚至是国际和特殊字符。使用该`localeCompare()`方法的唯一问题是[“使用的语言环境和排序顺序完全依赖于实现”。换句话说，当使用诸如 stringOne.localeCompare(stringTwo) 之类的 localeCompare 时：Firefox、Safari、Chrome 和 IE 对字符串有不同的排序顺序。](https://code.google.com/p/v8/issues/detail?id=459)

浏览器原生实现的研究：

*   [http://jsbin.com/beboroyifomu/1/edit?js,console](http://jsbin.com/beboroyifomu/1/edit?js,console) - 与 localeCompare() 的基本拉丁字符比较[http://jsbin.com/viyucavudela/2/](http://jsbin.com/viyucavudela/2/) - 与 localeCompare() 的基本拉丁字符比较，用于测试IE8
*   [http://jsbin.com/beboroyifomu/2/edit?js,console](http://jsbin.com/beboroyifomu/2/edit?js,console) - 字符串比较中的基本拉丁字符：字符串与字符单独时的一致性检查
*   [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare) - IE11+ 支持新的语言环境和选项参数

### “字符串自然排序顺序”的难点

实现一个可靠的算法（意思是：一致但也涵盖广泛的字符）是一项非常艰巨的任务。UTF8 包含[超过 2000 个字符](http://en.wikipedia.org/wiki/UTF-8)并[涵盖超过 120 种脚本（语言）](http://www.unicode.org/standard/supported.html)。最后，此任务有一些规范，称为“Unicode 排序算法”，可在[http://www.unicode.org/reports/tr10/](http://www.unicode.org/reports/tr10/)找到。您可以在我发布的这个问题上找到更多信息[https://softwareengineering.stackexchange.com/questions/257286/is-there-any-language-agnostic-specification-for-string-natural-sorting-order](https://softwareengineering.stackexchange.com/questions/257286/is-there-any-language-agnostic-specification-for-string-natural-sorting-order)

## 定论

因此，考虑到我遇到的 javascript 自定义实现提供的当前支持水平，我们可能永远不会看到任何接近支持所有这些字符和脚本（语言）的东西。因此，我宁愿使用浏览器的本地 localeCompare() 方法。是的，它确实具有跨浏览器不一致的缺点，但基本测试表明它涵盖了更广泛的字符，允许可靠且有意义的排序顺序。

正如 所指出的`Shog9`，您的问题的答案是：

```
return item1.attr.localeCompare(item2.attr); 
```

### 进一步阅读：

*   [https://softwareengineering.stackexchange.com/questions/257286/is-there-any-language-agnostic-specification-for-string-natural-sorting-order](https://softwareengineering.stackexchange.com/questions/257286/is-there-any-language-agnostic-specification-for-string-natural-sorting-order)
*   [你如何在 JavaScript 中进行字符串比较？](https://stackoverflow.com/questions/51165/how-do-you-do-string-comparison-in-javascript)
*   [Javascript：自然排序的字母数字字符串](https://stackoverflow.com/questions/2802341/natural-sort-of-text-and-numbers-javascript)
*   [排序数字和字母元素的数组（自然排序）](https://stackoverflow.com/questions/4373018/sort-array-of-numeric-alphabetical-elements-natural-sort/)
*   [对混合的字母/数字数组进行排序](https://stackoverflow.com/questions/4340227/sort-mixed-alpha-numeric-array)
*   [https://web.archive.org/web/20130929122019/http://my.opera.com/GreyWyvern/blog/show.dml/1671288](https://web.archive.org/web/20130929122019/http://my.opera.com/GreyWyvern/blog/show.dml/1671288)
*   [https://web.archive.org/web/20131005224909/http://www.davekoelle.com/alphanum.html](https://web.archive.org/web/20131005224909/http://www.davekoelle.com/alphanum.html)
*   [http://snipplr.com/view/36012/javascript-natural-sort/](http://snipplr.com/view/36012/javascript-natural-sort/)
*   [http://blog.codinghorror.com/sorting-for-humans-natural-sort-order/](http://blog.codinghorror.com/sorting-for-humans-natural-sort-order/)

感谢 Shog9 的好回答，我相信这让我朝着“正确”的方向前进

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2016-11-01T06:28:02.517

# 答案（在现代 ECMAScript 中）

```
list.sort((a, b) => (a.attr > b.attr) - (a.attr < b.attr)) 
```

或者

```
list.sort((a, b) => +(a.attr > b.attr) || -(a.attr < b.attr)) 
```

# 描述

将布尔值转换为数字会产生以下结果：

*   `true`->`1`
*   `false`->`0`

考虑三种可能的模式：

*   x 大于 y: `(x > y) - (y < x)`-> `1 - 0`->`1`
*   x 等于 y：`(x > y) - (y < x)`-> `0 - 0`->`0`
*   x 小于 y: `(x > y) - (y < x)`-> `0 - 1`->`-1`

（选择）

*   x 大于 y: `+(x > y) || -(x < y)`-> `1 || 0`->`1`
*   x 等于 y：`+(x > y) || -(x < y)`-> `0 || 0`->`0`
*   x 小于 y: `+(x > y) || -(x < y)`-> `0 || -1`->`-1`

所以这些逻辑等价于典型的排序比较器函数。

```
if (x == y) {
    return 0;
}
return x > y ? 1 : -1; 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2019-09-22T13:34:01.940

由于字符串可以直接在 javascript 中进行比较，这将完成这项工作

```
list.sort(function (a, b) {
    return a.attr > b.attr ? 1: -1;
}) 
```

排序函数中的减法仅在需要非字母（数字）排序时使用，当然它不适用于字符串

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-09T03:29:42.930

您应该在此处使用 > 或 < 和 ==。所以解决方案是：

```
list.sort(function(item1, item2) {
    var val1 = item1.attr,
        val2 = item2.attr;
    if (val1 == val2) return 0;
    if (val1 > val2) return 1;
    if (val1 < val2) return -1;
}); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2019-03-14T01:55:29.977

嵌套三元箭头函数

```
(a,b) => (a < b ? -1 : a > b ? 1 : 0) 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-02-07T18:06:20.243

我为此困扰了很长时间，所以我终于研究了这个，并给了你这个冗长的理由来解释为什么事情会这样。

从[规格](http://ecma262-5.com/ELS5_HTML.htm)：

```
Section 11.9.4   The Strict Equals Operator ( === )

The production EqualityExpression : EqualityExpression === RelationalExpression
is evaluated as follows: 
- Let lref be the result of evaluating EqualityExpression.
- Let lval be GetValue(lref).
- Let rref be the result of evaluating RelationalExpression.
- Let rval be GetValue(rref).
- Return the result of performing the strict equality comparison 
  rval === lval. (See 11.9.6) 
```

所以现在我们去 11.9.6

```
11.9.6   The Strict Equality Comparison Algorithm

The comparison x === y, where x and y are values, produces true or false. 
Such a comparison is performed as follows: 
- If Type(x) is different from Type(y), return false.
- If Type(x) is Undefined, return true.
- If Type(x) is Null, return true.
- If Type(x) is Number, then
...
- If Type(x) is String, then return true if x and y are exactly the 
  same sequence of characters (same length and same characters in 
  corresponding positions); otherwise, return false. 
```

就是这样。**应用于字符串的三等号运算符返回真，前提是参数是完全相同的字符串（相同的长度和对应位置的相同字符）。**

`===`当我们尝试比较可能来自不同来源但我们知道最终将具有相同值的字符串时，这将起作用 - 这是我们代码中内联字符串的常见场景。例如，如果我们有一个名为 的变量`connection_state`，并且我们想知道它`['connecting', 'connected', 'disconnecting', 'disconnected']`现在处于以下哪种状态，我们可以直接使用`===`.

但还有更多。就在 11.9.4 之上，有一个简短的说明：

```
NOTE 4     
  Comparison of Strings uses a simple equality test on sequences of code 
  unit values. There is no attempt to use the more complex, semantically oriented
  definitions of character or string equality and collating order defined in the 
  Unicode specification. Therefore Strings values that are canonically equal
  according to the Unicode standard could test as unequal. In effect this 
  algorithm assumes that both Strings are already in normalized form. 
```

唔。现在怎么办？外部获得的字符串可以而且很可能会是奇怪的 unicodey，我们的温柔`===`不会公正对待它们。进来`localeCompare`救援：

```
15.5.4.9   String.prototype.localeCompare (that)
    ...
    The actual return values are implementation-defined to permit implementers 
    to encode additional information in the value, but the function is required 
    to define a total ordering on all Strings and to return 0 when comparing
    Strings that are considered canonically equivalent by the Unicode standard. 
```

我们现在可以回家了。

**tl;博士;**

要比较 javascript 中的字符串，请使用`localeCompare`; 如果您知道字符串没有非 ASCII 组件，因为它们是例如内部程序常量，那么`===`也可以使用。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-10-30T16:05:36.703

解释为什么问题中的方法不起作用：

```
let products = [
    { name: "laptop", price: 800 },
    { name: "phone", price:200},
    { name: "tv", price: 1200}
];
products.sort( (a, b) => {
    {let value= a.name - b.name; console.log(value); return value}
});

> 2 NaN 
```

字符串之间的减法返回 NaN。

与@Alejadro 的回答相呼应，正确的做法是——

`products.sort( (a,b) => a.name > b.name ? 1 : -1 )`

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2021-12-21T02:39:29.657

在javascript中，我们使用`.localCompare`方法对字符串进行排序

对于打字稿

```
const data = ["jane", "mike", "salome", "ababus", "buisa", "dennis"];

const sort = (arr: string[], mode?: 'desc' | 'asc') => 
  !mode || mode === "asc"
    ? arr.sort((a, b) => a.localeCompare(b))
    : arr.sort((a, b) => b.localeCompare(a));

console.log(sort(data, 'desc'));// [ 'salome', 'mike', 'jane', 'dennis', 'buisa', 'ababus' ]
console.log(sort(data, 'asc')); // [ 'ababus', 'buisa', 'dennis', 'jane', 'mike', 'salome' ] 
```

对于 JS

```
const data = ["jane", "mike", "salome", "ababus", "buisa", "dennis"];

/**
 * @param {string[]} arr
 * @param {"asc"|"desc"} mode
 */
const sort = (arr, mode = "asc") =>
  !mode || mode === "asc"
    ? arr.sort((a, b) => a.localeCompare(b))
    : arr.sort((a, b) => b.localeCompare(a));

console.log(sort(data, 'desc'));// [ 'salome', 'mike', 'jane', 'dennis', 'buisa', 'ababus' ]
console.log(sort(data, 'asc')); // [ 'ababus', 'buisa', 'dennis', 'jane', 'mike', 'salome' ] 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-06-24T21:45:13.350

应该有升序和降序功能

```
if (order === 'asc') {
  return a.localeCompare(b);
}
return b.localeCompare(a); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-09-01T21:41:22.050

```
list.sort(function(item1, item2){
    return +(item1.attr > item2.attr) || +(item1.attr === item2.attr) - 1;
}) 
```

他们如何工作示例：

```
+('aaa'>'bbb')||+('aaa'==='bbb')-1
+(false)||+(false)-1
0||0-1
-1

+('bbb'>'aaa')||+('bbb'==='aaa')-1
+(true)||+(false)-1
1||0-1
1

+('aaa'>'aaa')||+('aaa'==='aaa')-1
+(false)||+(true)-1
0||1-1
0 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-10-24T18:15:33.813

在您最初问题的操作中，您正在执行以下操作：

```
item1.attr - item2.attr 
```

因此，假设这些是数字（即 item1.attr = "1", item2.attr = "2"），只要您确保类型，您仍然可以使用“===”运算符（或其他严格的评估器）。以下应该有效：

```
return parseInt(item1.attr) - parseInt(item2.attr); 
```

如果它们是 alphaNumeric，则使用 localCompare()。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-31T12:32:54.937

直接使用 sort() 没有任何`-`或`<`

```
const areas = ['hill', 'beach', 'desert', 'mountain']
console.log(areas.sort())

// To print in descending way
console.log(areas.sort().reverse())
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-01-28T08:36:58.827

如果您想控制语言环境（或大小写或重音），请使用[`Intl.collator`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Collator/Collator)：

```
const collator = new Intl.Collator();
list.sort((a, b) => collator.compare(a.attr, b.attr)); 
```

您可以像这样构造整理器：

```
new Intl.Collator("en");
new Intl.Collator("en", {sensitivity: "case"});
... 
```

请参阅上面的文档链接。

Note: unlike some other solutions, it handles `null, undefined` the JS way, i.e. moves them to the end.

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2018-04-23T20:45:28.537

```
<!doctype html>
<html>
<body>
<p id = "myString">zyxtspqnmdba</p>
<p id = "orderedString"></p>
<script>
var myString = document.getElementById("myString").innerHTML;
orderString(myString);
function orderString(str) {
    var i = 0;
    var myArray = str.split("");
    while (i < str.length){
        var j = i + 1;
        while (j < str.length) {
            if (myArray[j] < myArray[i]){
                var temp = myArray[i];
                myArray[i] = myArray[j];
                myArray[j] = temp;
            }
            j++;
        }
        i++;
    }
    var newString = myArray.join("");
    document.getElementById("orderedString").innerHTML = newString;
}
</script>
</body>
</html> 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2019-04-09T10:29:57.257

```
var str = ['v','a','da','c','k','l']
var b = str.join('').split('').sort().reverse().join('')
console.log(b) 
```

# c# - 用 Linq To SQL 和 DTO 分离关注点

> ID：51176
> 
> 赞同：11
> 
> 时间：2008-09-09T03:40:22.373
> 
> 标签：c#, linq, dto-mapping

我最近开始了一个新的 webforms 项目，并决定将业务类与任何 DBML 引用分开。我的业务层类改为访问离散的数据层方法，并返回 DTO 的集合。所以数据层可能会像下面这样投射 DTO：

```
(from c in dataContext.Customers
where c.Active == true 
select new DTO.Customer
{
   CustomerID = c.CustomerID,
   Name = c.CustomerName,
   ...
}).ToList() 
```

尽管构建 DTO 对象会增加工作量，但这感觉像是在业​​务层和数据层之间紧密绑定的更好方法，这意味着我可以在没有数据库的情况下测试业务层。

我的问题是，这是一种好的做法吗？，有没有一种方法可以生成 DTO（可能通过 SQLMetal），以及随着项目的进展我可能会遇到哪些其他问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T03:54:51.950

我不知道这是否是最佳实践，但我在不久前编写了类似的代码，因为我也觉得我可以通过在我的应用程序中使用我自己的类而不是 LINQ 设计器生成的类来改进关注点分离.

您可能需要考虑从数据访问方法中仅返回 IQueryable<Customer> 而不是 IList<Customer>。由于 IQueryable<T> 继承自 IEnumerable<T> ，因此您的应用程序的其余部分应该能够很好地处理它。您也可以在真正需要时将其转换为列表。

这样做的好处是您可以很容易地动态修改查询并最大限度地减少从 SQL Server 返回的数据量。

例如，如果您的方法签名是 IQueryable<Customer> GetCustomers() 您可以通过调用 GetCustomers().Where(c => c.CustomerID == 101).Single();

在此示例中，只会从数据库返回一条记录，而我想目前您的代码将返回所有客户，或者您需要编写单独的方法（因此是非常重复的代码）来满足您可能想要的所有不同事物过滤。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T03:45:02.847

在我看来，在大多数情况下，处理 LINQ 时不需要 DTO 对象。生成的 LINQ 类可以轻松测试。LINQ 使您能够使用相同的查询来查询来自不同来源的数据。它使您能够针对对象列表而不是真实数据库来测试您的查询。

# search - 使用 iThenticate 服务进行内容比较的替代方法是什么？

> ID：51179
> 
> 赞同：2
> 
> 时间：2008-09-09T03:41:12.280
> 
> 标签：search, drm, plagiarism-detection

[使用iThenticate](http://www.ithenticate.com)服务进行内容比较的替代方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T12:22:08.017

[关于剽窃检测](http://en.wikipedia.org/wiki/Plagiarism_detection)的维基百科页面有一个商业和免费服务列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-07T20:51:42.653

如果您选择不使用 iThenticate， 我通常推荐[Copyscape](http://www.copyscape.com)和/或[eTBlast 。](http://etest.vbi.vt.edu/etblast3/)

# visual-studio - 如何阻止 Visual Studio 在块注释期间自动插入星号？

> ID：51180
> 
> 赞同：38
> 
> 时间：2008-09-09T03:41:23.480
> 
> 标签：visual-studio

我用这个把头发扯掉了。如果我在 VS.NET 2005+ 中开始块注释`/*`然后回车，Visual Studio 坚持我有另一个星号`*`。我知道有一个选项可以关闭它，但我就是找不到。有人知道如何关闭此功能吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-09T03:51:15.343

[这篇文章](http://forums.msdn.microsoft.com/en-US/csharpide/thread/a41e3652-efe2-4f81-ad3e-94994974fcb2/)解决了你的问题。它的要点是：

```
Text Editor > C# > Advanced > Generate XML documentation comments for /// 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-03-30T20:29:35.737

[Visual Studio 2015 Update 2](https://www.visualstudio.com/en-us/news/vs2015-update2-vs.aspx)（终于）解决了这个问题！

已添加到`Tools > Options > Text Editor > C# > Advanced`命名的新选项`Insert * at the start of new lines when writing /* */ comments`。

禁用此选项可防止编辑器自动为块注释添加星号前缀。只用了 7.5 年和 4 个主要版本 :)

[![在此处输入图像描述](https://i.stack.imgur.com/iNcjt.png)](https://i.stack.imgur.com/iNcjt.png)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-11-23T00:35:01.210

试试这个：

```
#if false

    whatever you want here
    and here

#endif 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-01T04:33:39.073

工具->选项。

取消选中 Text Editor > C# > Advanced > Generate XML documentation comments for ///

# javascript - JavaScript 字符串是不可变的吗？我需要 JavaScript 中的“字符串生成器”吗？

> ID：51185
> 
> 赞同：273
> 
> 时间：2008-09-09T03:44:54.110
> 
> 标签：javascript, string

javascript 使用不可变或可变字符串吗？我需要一个“字符串生成器”吗？

* * *

## 回答 #1

> 赞同：331
> 
> 时间：2011-01-17T21:03:35.843

它们是不可变的。您不能使用类似的内容更改字符串中的字符`var myString = "abbdef"; myString[2] = 'c'`。字符串操作方法，例如[`trim`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/trim)，[`slice`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/slice)返回新字符串。

同样，如果你有两个对同一个字符串的引用，修改一个不会影响另一个

```
let a = b = "hello";
a = a + " world";
// b is not affected 
```

但是，我一直听到 Ash 在他的回答中提到的内容（使用 Array.join 进行连接更快），所以我想测试连接字符串的不同方法并将最快的方法抽象为 StringBuilder。我写了一些测试来看看这是不是真的（不是！）。

这是我认为最快的方法，尽管我一直认为添加方法调用可能会使它变慢......

```
function StringBuilder() {
    this._array = [];
    this._index = 0;
}

StringBuilder.prototype.append = function (str) {
    this._array[this._index] = str;
    this._index++;
}

StringBuilder.prototype.toString = function () {
    return this._array.join('');
} 
```

这是性能速度测试。他们三个人都创建了一个由`"Hello diggity dog"`十万次连接成一个空字符串组成的巨大字符串。

我创建了三种类型的测试

*   使用`Array.push`和`Array.join`
*   使用数组索引来避免`Array.push`，然后使用`Array.join`
*   直字符串连接

然后我通过将它们抽象为和[http://jsperf.com/string-concat-without-sringbuilder/5](http://jsperf.com/string-concat-without-sringbuilder/5)`StringBuilderConcat`创建了相同的三个测试，请去那里运行测试，这样我们就可以得到一个很好的样本。请注意，我修复了一个小错误，因此测试数据被擦除，一旦有足够的性能数据，我将更新表。转到[http://jsperf.com/string-concat-without-sringbuilder/5](http://jsperf.com/string-concat-without-sringbuilder/5)获取旧数据表。`StringBuilderArrayPush``StringBuilderArrayIndex`

如果您不想点击链接，这里有一些数字（Ma5rch 2018 中的最新更新）。每个测试的数字是 1000 次操作/秒（**越高越好**）

| 浏览器 | 指数 | 推 | 康卡特 | SBIndex | SBPush | SBConcat |
| --- | --- | --- | --- | --- | --- | --- |
| 铬 71.0.3578 | 988 | 1006 | 2902 | 963 | 1008 | 2902 |
| 火狐 65 | 1979 | 1902 | 2197 | 1917年 | 1873年 | 1953年 |
| 边缘 | 593 | 373 | 952 | 361 | 415 | 444 |
| 爆炸者 11 | 655 | 532 | 761 | 537 | 567 | 387 |
| 歌剧 58.0.3135 | 1135 | 1200 | 4357 | 1137 | 1188 | 4294 |

**发现**

*   如今，所有常青浏览器都能很好地处理字符串连接。`Array.join`只对 IE 11 有帮助

*   总体而言，Opera 是最快的，是 Array.join 的 4 倍

*   Firefox 排在第二位，`Array.join`在 FF 中仅稍慢一点，但在 Chrome 中则慢得多（3 倍）。

*   Chrome 排名第三，但字符串 concat 比 Array.join 快 3 倍

*   创建 StringBuilder 似乎不会对性能产生太大影响。

希望其他人觉得这很有用

**不同的测试用例**

由于@RoyTinker 认为我的测试存在缺陷，因此我创建了一个新案例，它不会通过连接相同的字符串来创建大字符串，它每次迭代都使用不同的字符。字符串连接似乎仍然更快或同样快。让我们运行这些测试。

我建议每个人都应该继续考虑其他方法来测试它，并随时在下面添加新的链接到不同的测试用例。

[http://jsperf.com/string-concat-without-sringbuilder/7](http://jsperf.com/string-concat-without-sringbuilder/7)

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-09-09T03:51:12.723

来自[犀牛书](http://oreilly.com/catalog/9780596000486/)：

> 在 JavaScript 中，字符串是不可变的对象，这意味着其中的字符可能不会被更改，并且对字符串的任何操作实际上都会创建新的字符串。字符串是按引用分配的，而不是按值分配的。通常，当一个对象通过引用分配时，通过一个引用对该对象所做的更改将通过对该对象的所有其他引用可见。但是，由于字符串无法更改，因此您可以对字符串对象进行多次引用，而不必担心字符串值会在您不知情的情况下更改

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-09T03:55:55.880

**性能提示：**

如果您必须连接大字符串，请将字符串部分放入数组并使用该`Array.Join()`方法获取整个字符串。对于连接大量字符串，这可以快很多倍。

JavaScript中没有`StringBuilder`。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2018-09-09T08:06:21.190

只是为了澄清像我这样的简单头脑（来自[MDN](https://developer.mozilla.org/en-US/docs/Glossary/Mutable)）：

> 不可变对象是对象一旦创建，其状态就无法更改。
> 
> 字符串和数字是不可变的。

不可变意味着：

> 您可以使变量名指向一个新值，但之前的值仍保存在内存中。因此需要垃圾收集。
> 
> `var immutableString = "Hello";`
> 
> // 在上面的代码中，创建了一个带有字符串值的新对象。
> 
> `immutableString = immutableString + "World";`
> 
> // 我们现在将“World”附加到现有值。

看起来我们正在改变字符串“immutableString”，但我们没有。反而：

> 在“immutableString”附加一个字符串值时，会发生以下事件：
> 
> 1.  检索“immutableString”的现有值
> 2.  “World”附加到“immutableString”的现有值
> 3.  然后将结果值分配给新的内存块
> 4.  “immutableString”对象现在指向新创建的内存空间
> 5.  以前创建的内存空间现在可用于垃圾收集。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-10-14T14:18:34.947

字符串类型值是不可变的，**但**使用 String() 构造函数创建的 String 对象是可变的，因为它是一个对象，您可以向其添加新属性。

```
> var str = new String("test")
undefined
> str
[String: 'test']
> str.newProp = "some value"
'some value'
> str
{ [String: 'test'] newProp: 'some value' } 
```

同时，虽然可以添加新的属性，但不能更改已经存在的属性

[Chrome 控制台中的测试屏幕截图](http://i.stack.imgur.com/m9y8P.png)

总之，1.所有字符串类型的值（原始类型）都是不可变的。2、String对象是可变的，但它所包含的字符串类型值（原始类型）是不可变的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-08-18T14:16:30.490

**字符串是不可变的**——它们不能改变，我们只能创建新的字符串。

例子：

```
var str= "Immutable value"; // it is immutable

var other= statement.slice(2, 10); // new string 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-09T04:15:57.173

关于您关于 ASP.NET Ajax 中的 StringBuilder 的问题（在您对 Ash 的回复的评论中），专家们似乎对此不同意。

Christian Wenz 在他的*Programming ASP.NET AJAX* (O'Reilly) 一书中说，“这种方法对内存没有任何可测量的影响（事实上，实现似乎比标准方法慢一点）。”

另一方面，Gallo 等人在他们的*ASP.NET AJAX in Action* (Manning) 一书中说：“当要连接的字符串数量较大时，字符串生成器成为避免性能大幅下降的重要对象。”

我想您需要自己进行基准测试，结果也可能因浏览器而异。但是，即使它没有提高性能，对于习惯于使用 C# 或 Java 等语言使用 StringBuilder 进行编码的程序员来说，它仍然可能被认为是“有用的”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-02T11:41:35.850

这是一个迟到的帖子，但我没有在答案中找到好的书名。

这是一本可靠的书中的明确内容：

> 字符串在 ECMAScript 中是不可变的，这意味着一旦它们被创建，它们的值就不能改变。要更改变量保存的字符串，必须销毁原始字符串并用另一个包含新值的字符串填充变量... *—Professional JavaScript for Web Developers，第 3 版，第 43 页*

现在，引用 Rhino 书摘录的答案关于字符串不变性是正确的，但错误地说“字符串是通过引用分配的，而不是通过值分配的”。（可能他们最初的意思是把这些词放在相反的地方）。

“引用/值”的误解在“专业 JavaScript”，名为“原始和引用值”的章节中得到了澄清：

> 五种原始类型...[是]：未定义、空值、布尔值、数字和字符串。据说这些变量是按值访问的，因为您正在操作存储在变量中的实际值。 *——面向 Web 开发人员的专业 JavaScript，第 3 版，第 85 页*

这与*对象*相反：

> 当您操作一个对象时，您实际上是在处理对该对象的引用，而不是实际的对象本身。出于这个原因，这些值被称为通过引用访问。*——面向 Web 开发人员的专业 JavaScript，第 3 版，第 85 页*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-09T03:50:05.177

JavaScript 字符串确实是不可变的。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-09T03:50:51.303

Javascript 中的字符串是不可变的

# arrays - 如何从 Perl 中的数组中获取哈希值？

> ID：51195
> 
> 赞同：14
> 
> 时间：2008-09-09T03:51:31.927
> 
> 标签：arrays, perl, hash, perl-data-structures

我想在 perl 中编写一个小的“DBQuery”函数，这样我就可以有一个发送 SQL 语句并接收回的单行程序和一个哈希数组，即一个记录集。但是，我遇到了 Perl 语法问题（可能还有一些奇怪的指针/引用问题），这使我无法从从数据库中获取的哈希中打包信息。下面的示例代码演示了该问题。

我可以使用以下语法从数组内的哈希中获取数据“Jim”：

```
print $records[$index]{'firstName'} 
```

返回“吉姆”

但是如果我首先将数组中的哈希记录复制到它自己的哈希变量中，那么奇怪的是我无法再访问该哈希中的数据：

```
 %row = $records[$index];
    $row{'firstName'}; 
```

返回“”（空白）

这是显示问题的完整示例代码。任何帮助表示赞赏：

```
 my @records = (
   {'id' => 1, 'firstName' => 'Jim'},
   {'id' => 2, 'firstName' => 'Joe'}
);
my @records2 = ();

$numberOfRecords = scalar(@records);
print "number of records: " . $numberOfRecords . "\n";
for(my $index=0; $index < $numberOfRecords; $index++) {

   #works
   print 'you can print the records like this: ' . $records[$index]{'firstName'} . "\n";

   #does NOT work
   %row = $records[$index];
   print 'but not like this: ' . $row{'firstName'} . "\n";

} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-09T04:03:09.247

嵌套数据结构包含哈希*引用*，而不是哈希。

```
# Will work (the -> dereferences the reference)
$row = $records[$index];
print "This will work: ", $row->{firstName}, "\n";

# This will also work, by promoting the hash reference into a hash
%row = %{ $records[$index] };
print "This will work: ", $row{firstName}, "\n"; 
```

如果您曾经遇到过一个深层的 Perl 数据结构，您可能会受益于使用[Data::Dumper](http://search.cpan.org/perldoc?Data::Dumper)将其打印成人类可读（和 Perl 可解析）的形式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T04:08:39.093

哈希数组实际上并不包含哈希，而是对哈希的*引用*。这一行：

```
%row = $records[$index]; 
```

为 %row 分配一个条目。关键是*标量*：

```
 {'id' => 1, 'firstName' => 'Jim'}, 
```

这是对哈希的引用，而值为空白。

你真正想做的是：

```
$row = $records[$index];
$row->{'firstName'}; 
```

要不然：

```
$row = %{$records[$index];}
$row{'firstName'}; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T06:48:39.740

其他人评论了哈希与哈希引用。我觉得应该提到的另一件事是您的 DBQuery 功能 - 似乎您正在尝试做一些已经内置在 DBI 中的事情？如果我正确理解您的问题，您正在尝试复制类似[selectall_arrayref 的内容](http://search.cpan.org/~timb/DBI-1.607/DBI.pm#selectall_arrayref)：

> 此实用程序方法将“prepare”、“execute”和“fetchall_arrayref”组合到一个调用中。它返回对数组的引用，其中包含对获取的每一行数据的数组（或哈希，见下文）的引用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T23:33:44.783

为了添加上面可爱的答案，让我补充一点，您应该始终、始终、始终（是的，三个“始终”）在代码顶部使用“使用警告”。如果您这样做了，您将收到警告“参考在 -e 第 1 行预期的偶数大小列表中找到”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T04:05:10.007

你在你的数组中实际拥有的是一个 hashref，而不是一个散列。如果您不理解这个概念，可能值得阅读[perlref](http://perldoc.perl.org/perlref.html)文档。

得到你需要做的哈希

```
my %hash = %{@records[$index]}; 
```

例如。

```
my @records = (
     {'id' => 1, 'firstName' => 'Jim'}, 
     {'id' => 2, 'firstName' => 'Joe'}
  );

  my %hash = %{$records[1]};

  print $hash{id}."\n"; 
```

虽然。我不确定您为什么要这样做，除非出于学术目的。否则，我建议在 DBI 模块中使用 fetchall_hashref/fetchall_arrayref 或使用 Class::DBI 之类的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T09:22:17.283

还要注意一个好的 perl 习惯用法是

```
对于我的 $rowHR (@records) {
   我的 %row = %$rowHR;
   ＃管他呢...
}
```

遍历列表。

# sharepoint - 可以从子站点创建页面隐藏 STP 模板吗？

> ID：51202
> 
> 赞同：0
> 
> 时间：2008-09-09T03:58:06.920
> 
> 标签：sharepoint, templates, moss

使用 add-template stsadm 命令添加模板时，创建子站点时每个人都可以使用该模板。有没有办法让它只在创建网站集时可用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T07:27:49.410

转到站点操作 -> 站点设置 -> 查看所有站点设置 -> 站点模板和页面布局，然后从允许的项目列表中删除站点模板。

Gary Lapointe 也可能对其进行了 stsadm 扩展；检查[stsadm.blogspot.com](http://stsadm.blogspot.com)

毛罗·马苏奇 [http://www.brantas.co.uk](http://www.brantas.co.uk)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T15:28:27.087

上述博客文章的 url，用于使用 stsadm 扩展隐藏 stp 模板，是[http://stsadm.blogspot.com/2007/08/set-available-site-templates.html](http://stsadm.blogspot.com/2007/08/set-available-site-templates.html)

> 下面是如何从网站集的可用模板列表中删除模板的示例：
> 
> > stsadm –o gl-removeavailablesitetemplate –url“ [http://intranet/](http://intranet/) ”-template“WIKI#0”-lcid 1033 -resetallsubsites

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T17:24:24.127

谢谢毛罗。我希望有一个不需要访问每个网站集的**解决方案，但看起来可能没有一个！**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T22:39:15.927

科姆拉德，

stsadm.blogspot.com 可能又是答案，您可以列出所有网站集，然后使用 edward 发布的命令删除网站模板。这可能有助于使事情变得更快！

虽然每个网站集只需要执行一次，但所有子网站（据我所知）都从父网站继承其设置。

# ruby-on-rails - 在 Rails 2.1.x 中处理 RoutingError 的最佳方法？

> ID：51210
> 
> 赞同：2
> 
> 时间：2008-09-09T04:08:54.427
> 
> 标签：ruby-on-rails, ruby, routing

我正在使用 Rails 2.1 中的 routing.rb 代码，并试图让它达到我可以对找不到适当路径时抛出的 RoutingError 异常做一些有用的事情的地步。

这是一个有点棘手的问题，因为有些类型的 URL 只是简单的 BAD：/azenv.php 机器人攻击，在 URL 中键入 /bar/foo/baz 的人，等等......我们不想要那。

然后是微妙的路由问题，我们确实希望收到通知：例如 /artists/ 或 ///。在这些情况下，我们可能希望或不抛出错误......或者我们让 Google 向我们发送过去有效但不再是因为人们删除它们的 URL。

在每种情况下，我都想要一种方法来包含、分析和过滤我们返回的路径，或者至少是某种 Railsy 方法来管理通过正常的“fallback catchall”url 的路由。这存在吗？

编辑：

所以这里的代码是：

```
# File vendor/rails/actionpack/lib/action_controller/rescue.rb, line 141

def rescue_action_without_handler(exception)
 log_error(exception) if logger
 erase_results if performed?

 # Let the exception alter the response if it wants.
 # For example, MethodNotAllowed sets the Allow header.
 if exception.respond_to?(:handle_response!)
   exception.handle_response!(response)
 end

 if consider_all_requests_local || local_request?
   rescue_action_locally(exception)
 else
  rescue_action_in_public(exception)
 end
end 
```

所以我们最好的选择是覆盖 log_error(exception) 以便我们可以根据异常过滤掉异常。所以在 ApplicationController

```
def log_error(exception)
    message = '...'
    if should_log_exception_as_debug?(exception)
      logger.debug(message)
    else
      logger.error(message)
    end
end

def should_log_exception_as_debug?(exception)
   return (ActionController::RoutingError === exception)
end 
```

在我们需要不同的控制器逻辑、路由等的地方添加额外的逻辑。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T12:11:19.327

不！不要在你的控制器上实现 method_missing ！请尽量避免 action_missing。

经常被吹捧的模式是添加一条路线：

```
map.connect '*', :controller => 'error', :action => 'not_found' 
```

您可以在哪里显示适当的错误。

Rails 也有一个名为rescue_action_in_public 的机制，您可以在其中编写自己的错误处理逻辑——我们真的应该清理它并鼓励人们使用它。PDI！:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T08:14:53.090

有 method_missing 方法。您可以在应用程序控制器中实现它并捕获所有丢失的操作，可能会记录这些操作并重定向到相关控制器的索引操作。这种方法会忽略无法路由到控制器的所有内容，这与您想要的非常接近。

或者，我只记录所有错误，提取 URL 并按发生的次数对其进行排序。

# python - 如何在 Python 中编写下载进度指示器？

> ID：51212
> 
> 赞同：57
> 
> 时间：2008-09-09T04:09:15.503
> 
> 标签：python, http

我正在编写一个小应用程序来通过 http 下载文件（例如，[在此处](https://stackoverflow.com/questions/22676/how-do-i-download-a-file-over-http-using-python#22776)描述）。

我还想包含一个小的下载进度指示器，显示下载进度的百分比。

这是我想出的：

```
    sys.stdout.write(rem_file + "...")    
    urllib.urlretrieve（rem_file，loc_file，reporthook=dlProgress）

    def dlProgress（计数，块大小，总大小）：
      百分比 = int(count*blockSize*100/totalSize)
      sys.stdout.write("%2d%%" % percent)
      sys.stdout.write("\b\b\b")
      sys.stdout.flush()

```

输出：我的文件名... 9%

还有其他想法或建议吗？

有点烦人的是终端中百分比的第一位数字上的闪烁光标。有没有办法防止这种情况？有没有办法隐藏光标？

**编辑：**

在 dlProgress 和 '\r' 代码中使用全局变量作为文件名的更好选择：

```
    global rem_file # 在 dlProgress 中使用的全局变量

    urllib.urlretrieve（rem_file，loc_file，reporthook=dlProgress）

    def dlProgress（计数，块大小，总大小）：
      百分比 = int(count*blockSize*100/totalSize)
      sys.stdout.write("\r" + rem_file + "...%d%%" % percent)
      sys.stdout.flush()

```

输出：我的文件名...9%

光标出现在行的末尾。好多了。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-09T04:48:28.203

[在http://pypi.python.org/pypi/progressbar/2.2](http://pypi.python.org/pypi/progressbar/2.2)有一个 Python 的文本进度条库 ，您可能会发现它很有用：

> 这个库提供了一个文本模式的进度条。这通常用于显示长时间运行的操作的进度，提供处理正在进行的视觉线索。
> 
> ProgressBar 类管理进度，行的格式由许多小部件给出。小部件是一个对象，可能会根据进度状态以不同方式显示。有三种类型的小部件： - 一个字符串，它总是显示自己；- 一个 ProgressBarWidget，每次调用 update 方法时可能返回不同的值；- 一个 ProgressBarWidgetHFill，它类似于 ProgressBarWidget，不同之处在于它会扩展以填充行的剩余宽度。
> 
> 进度条模块非常易于使用，但功能非常强大。并自动支持可用时自动调整大小等功能。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-09T04:21:09.157

你也可以试试：

```
sys.stdout.write("\r%2d%%" % percent)
sys.stdout.flush() 
```

在字符串的开头使用单个回车而不是多个退格。您的光标仍会闪烁，但它会在百分号之后而不是第一个数字下方闪烁，并且使用一个控制字符而不是三个控制字符可能会减少闪烁。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-03-15T21:52:32.137

对于它的价值，这是我用来让它工作的代码：

```
from urllib import urlretrieve
from progressbar import ProgressBar, Percentage, Bar

url = "http://......."
fileName = "file"
pbar = ProgressBar(widgets=[Percentage(), Bar()])
urlretrieve(url, fileName, reporthook=dlProgress)

def dlProgress(count, blockSize, totalSize):
    pbar.update( int(count * blockSize * 100 / totalSize) ) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-09T04:14:37.393

如果您使用该`curses` 软件包，您可以更好地控制控制台。它还以更高的代码复杂性为代价，除非您正在开发基于控制台的大型应用程序，否则它可能是不必要的。

对于一个简单的解决方案，您始终可以将旋转轮放在状态消息的末尾（`|, \, -, /`在闪烁的光标下实际上看起来不错的字符序列。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-02T14:01:43.940

我使用了这段代码：

```
url = (<file location>)
file_name = url.split('/')[-1]
u = urllib2.urlopen(url)
f = open(file_name, 'wb')
meta = u.info()
file_size = int(meta.getheaders("Content-Length")[0])
print "Downloading: %s Bytes: %s" % (file_name, file_size)

file_size_dl = 0
block_sz = 8192
while True:
    buffer = u.read(block_sz)
    if not buffer:
        break

    file_size_dl += len(buffer)
    f.write(buffer)
    status = r"%10d [%3.2f%%]" % (file_size_dl, file_size_dl * 100\. / file_size)
    status = status + chr(8)*(len(status)+1)
    print status,

f.close() 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-04-18T14:43:56.927

```
def download_progress_hook(count, blockSize, totalSize):
  """A hook to report the progress of a download. This is mostly intended for users with slow internet connections. Reports every 5% change in download progress.
  """
  global last_percent_reported
  percent = int(count * blockSize * 100 / totalSize)

  if last_percent_reported != percent:
    if percent % 5 == 0:
      sys.stdout.write("%s%%" % percent)
      sys.stdout.flush()
    else:
      sys.stdout.write(".")
      sys.stdout.flush()

    last_percent_reported = percent

urlretrieve(url, filename, reporthook=download_progress_hook) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T10:04:19.397

对于小文件，您可能需要这些行以避免疯狂的百分比：

sys.stdout.write("\r%2d%%" % percent)

sys.stdout.flush()

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-14T08:31:23.217

这就是我这样做可以帮助你： [https ://github.com/mouuff/MouDownloader/blob/master/api/download.py](https://github.com/mouuff/MouDownloader/blob/master/api/download.py)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-02-10T04:38:33.730

像往常一样，晚会迟到了。这是一个支持报告进度的实现，例如 core `urlretrieve`：

```
import urllib2

def urlretrieve(urllib2_request, filepath, reporthook=None, chunk_size=4096):
    req = urllib2.urlopen(urllib2_request)

    if reporthook:
        # ensure progress method is callable
        if hasattr(reporthook, '__call__'):
            reporthook = None

        try:
            # get response length
            total_size = req.info().getheaders('Content-Length')[0]
        except KeyError:
            reporthook = None

    data = ''
    num_blocks = 0

    with open(filepath, 'w') as f:
        while True:
            data = req.read(chunk_size)
            num_blocks += 1
            if reporthook:
                # report progress
                reporthook(num_blocks, chunk_size, total_size)
            if not data:
                break
            f.write(data)

    # return downloaded length
    return len(data) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-18T05:23:42.140

为避免像 106% 或类似的进度值，请遵循以下逻辑

```
percent = min(int(count * blockSize * 100 / totalSize), 100) 
```

# svn - 您将如何为内部软件项目组织 Subversion 存储库？

> ID：51217
> 
> 赞同：19
> 
> 时间：2008-09-09T04:19:24.997
> 
> 标签：svn, version-control

我在一家主要业务与软件无关的公司工作。大多数使用源代码控制的文档都是由开发团队为商业或开源项目编写的。作为编写内部软件的人，我可以说工作的完成方式与商业或开源环境不同。此外，还有需要与代码保持同步的存储过程和数据库脚本。

特别是，我希望获得有关如何最好地考虑内部软件来构建存储库的建议。大多数文档都建议使用主干、分支、标签等。以及使生产、测试​​和开发环境与存储库中的相应部分保持同步的程序等。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-09T05:35:14.253

仅在您如何组织它们的意义上，设置 SVN 存储库可能会很棘手。在我们设置 SVN 之前，我实际上是 RTFM 的在线[Subversion 手册](http://svnbook.red-bean.com/)，其中讨论了存储库的组织技术以及您应该提前考虑的一些问题，即如果您决定改变主意，在创建存储库后不能做什么. 我建议在设置之前通过本手册。

对于我们来说，作为顾问，我们通过 SVN 进行定制和内部软件开发以及一些文档管理。为每个客户创建一个存储库并为我们自己创建一个存储库符合我们的利益。在每个存储库中，我们为每个项目（软件或其他）创建了文件夹。这使我们能够按存储库和客户端甚至存储库中的项目来划分安全访问。更深入地讲，我们为每个软件项目创建了“工作”、“标签”和“分支”文件夹。我们通常使用“release_w.xyz”作为标准的标签将发布放在“标签”中。

在您的情况下，为了使存储过程、脚本和其他相关文档保持同步，您可以创建一个项目文件夹，然后在该“工作”文件夹下，然后在该“代码”下，在它旁边的“脚本”等。然后当您将工作版本标记为发布时，您最终会将它们全部标记在一起。

```
\Repository
   \ProjectX
      \Working
         \Code       
         \Scripts
         \Notes       
      \Tags
      \Branches 
```

至于非代码，我建议按项目或文档类型（手册、政策等）直接文件夹布局。通常带有文档并取决于您公司的运营方式，仅具有版本历史记录/日志就足够了。

我们在 Windows 上运行 SVN 以及[WebSVN](http://websvn.tigris.org/)，它是一个很棒的开源存储库查看器。我们使用它让客户可以通过网络访问他们的代码，这一切都由底层的 Subversion 安全性驱动。在内部，我们使用[TortoiseSVN](http://tortoisesvn.tigris.org/)来管理存储库、提交、更新、导入等。

另一件事是培训应被视为部署的一个组成部分。刚接触版本控制的用户可能很难理解发生了什么。我们发现向他们提供功能说明（在创建项目时执行此操作，在更新时执行此操作等）在他们学习概念时非常有帮助。我们创建了一个“沙盒”存储库，用户可以在其中使用文档和文件夹来练习他们想要的所有内容，您可能会发现这对于尝试建立哪些策略也很有用。

祝你好运！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T04:41:20.277

对于颠覆，还有[Assembla](http://www.assembla.com/)，它带有[Trac](http://trac.edgewall.org/)和其他有用的工具。它是免费的，或者如果您需要更多空间或每个项目的用户，您可以付费购买一个帐户。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-10T19:39:40.860

发布此问题后，我与一位建议我阅读这篇文章的同事交谈：

[http://www.codinghorror.com/blog/archives/000968.html](http://www.codinghorror.com/blog/archives/000968.html)

简而言之，它提倡程序员更加注意分支。它帮助我看到没有正确的方法来组织我们的存储库。对于我们的团队，我们将有一个主干和两个用于测试和开发的长期分支。此外，我们将为每个任务创建单独的分支，并在我们将任务升级到测试和生产时合并来自任务分支的更改。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T04:24:03.237

您可以使用 www.unfuddle.com 之类的服务来设置免费的 SVN 或 GIT 存储库。

我们使用 Unfuddle，它真的很棒。有免费和付费版本（取决于您的需要）。

或者，您当然可以设置本地副本。有很多教程可以通过谷歌找到：[http ://www.google.com/search?rlz=1C1GGLS_enUS291&aq=f&sourceid=chrome&ie=UTF-8&q=set+up+svn](http://www.google.com/search?rlz=1C1GGLS_enUS291&aq=f&sourceid=chrome&ie=UTF-8&q=set+up+svn)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T05:07:38.343

您的项目的一个存储库可能就足够了。我喜欢按项目索引布局的典型方法（请参阅[O'Reilly Subversion 书中](http://svnbook.red-bean.com/)的[本节](http://svnbook.red-bean.com/en/1.1/ch04s07.html#svn-ch-4-sect-7.1)）：

```
/first-project/trunk
/first-project/branches
/first-project/tags
/another-project/trunk
/another-project/branches
/another-project/tags
/common-stuff/trunk
/common-stuff/branches
/common-stuff/tags 
```

请记住，您以后可以随时重新组织存储库。

此外，对于内部的东西，我更喜欢 FSFS 作为数据存储，而不是 Berkeley DB。FSFS 更具弹性，对于小型团队/项目来说，结帐速度并不是很关心。您可以自己[比较](http://svnbook.red-bean.com/en/1.1/ch05.html#svn-ch-5-sect-1.3)和决定。

该配方的其他标准部分包括[Trac](http://trac.edgewall.org/)和一个用于在 LAN 上托管存储库的最小 Linux 服务器。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-20T01:09:34.097

我同意使用主干/分支/标签的通用约定。除此之外，我认为您可能正在寻找类似我在[如何组织版本控制存储库中的答案？](https://stackoverflow.com/questions/222827/how-do-you-organize-your-version-control-repository#304036).

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-09T05:02:12.850

对于我的公司，我使用 svn+ssh 和基于密钥的身份验证。您可以使用 Windows 客户端和 linux 客户端执行此操作。一旦您直接使用 ssh 密钥登录而不是输入密码，这将非常容易使用。

[这是一篇关于设置 svn+ssh](http://svn.haxx.se/dev/archive-2004-03/0253.shtml)并附有安全说明的文章。如果您了解所有这些内容并遵循这些步骤，那么您将有一个良好的开端。

[本文](http://svn.apache.org/repos/asf/subversion/trunk/notes/ssh-tricks)介绍了多种方法来进一步保护 svn 帐户的 ssh 登录。

我建议专门为 svn 访问创建帐户，而不能访问该服务器。我的猜测是您将使用每日构建或自动化脚本来更新您存储在数据库中的过程。每日构建可以有自己的特殊帐户和自己的 ssh 密钥。我不喜欢我的自动化工具以与人类用户相同的登录名运行（所以我知道哪个工具坏了）。

如果您不了解所有的安全技巧，搜索 google 可以获得一些帮助。如果您遇到问题，请先设置一个没有安全技巧的设备。这使得故障排除更简单一些。

祝你好运，享受源代码控制带来的好处！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T20:46:16.203

我相信遵循基本模式，项目目录下有主干、标签、分支。我通常喜欢像这样设置顶层

Projects 保存所有单个项目或模块 Releases 保存涉及多个模块的发布标签用户保存私有用户分支 Admin 保存我的钩子脚本、备份脚本等。

如果您的产品由多个模块组成，这些模块都可能是特定版本的不同标签（一个环来绑定它们等等），则发布标签很有用。它使源代码托管和开发人员可以轻松参考构成第 1 版或第 2 版的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-09T04:30:18.230

如[本线程](https://stackoverflow.com/questions/49601/is-there-a-barebones-windows-version-control-system-thats-suitable-for-only-one#49722)所述，分布式 VCS（git、Mercurial）是比集中式 VCS 更好的模型，因为分支创建容易、分支合并容易、无需设置特殊服务器、无需网络访问工作等优点。如果您将独自工作，DVCS 允许您在需要时将人员整合到您的项目中。

无论如何，直接回答您的问题，设置 SVN 的一种方法是为每个项目创建一个存储库，并根据是否共享存储过程、脚本和库，在每个项目树上为脚本和存储过程创建一个目录，或共享代码的完整存储库。

# regex - 正则表达式匹配有效日期

> ID：51224
> 
> 赞同：73
> 
> 时间：2008-09-09T04:30:42.957
> 
> 标签：regex, date

我正在尝试编写一个验证日期的正则表达式。正则表达式需要匹配以下内容

*   月/日/年年
*   月/日/年
*   个位数月份可以以前导零开头（例如：03/12/2008）
*   个位数的天数可以以前导零开头（例如：2008 年 3 月 2 日）
*   不能包括 2 月 30 日或 2 月 31 日（例如：2/31/2008）

到目前为止我有

```
^(([1-9]|1[012])[-/.]([1-9]|[12][0-9]|3[01])[-/.](19|20)\d\d)|((1[012]|0[1-9])(3[01]|2\d|1\d|0[1-9])(19|20)\d\d)|((1[012]|0[1-9])[-/.](3[01]|2\d|1\d|0[1-9])[-/.](19|20)\d\d)$ 
```

这匹配正确，但仍包括 2/30/2008 和 2/31/2008。

有人有更好的建议吗？

**编辑：**我在 RegExLib 上找到[了答案](http://regexlib.com/REDetails.aspx?regexp_id=112)

```
^((((0[13578])|([13578])|(1[02]))[\/](([1-9])|([0-2][0-9])|(3[01])))|(((0[469])|([469])|(11))[\/](([1-9])|([0-2][0-9])|(30)))|((2|02)[\/](([1-9])|([0-2][0-9]))))[\/]\d{4}$|^\d{4}$ 
```

它匹配遵循 MM/DD/YYYY 格式的所有有效月份。

感谢大家的帮助。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2008-09-09T04:37:15.310

这不是正则表达式的适当使用。你最好使用

```
[0-9]{2}/[0-9]{2}/[0-9]{4} 
```

然后检查高级语言的范围。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2012-01-07T07:58:11.307

这是匹配所有有效日期（包括闰年）的 Reg ex。接受的格式 mm/dd/yyyy 或 mm-dd-yyyy 或 mm.dd.yyyy 格式

`^(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[1,3-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$`

*礼貌[阿西克·艾哈迈德](http://www.advancedqtp.com/forums/index.php?topic=4394.0)*

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2016-10-28T16:45:10.893

我来到这里是因为这个问题的标题很宽泛，我正在寻找一个可以用来匹配特定日期格式（如 OP）的正则表达式。但后来我发现，正如许多答案和评论已经全面强调的那样，在提取混入质量差或非结构化源数据的日期时，有许多陷阱使得构建有效模式非常棘手。

在我对这些问题的探索中，我提出了一个系统，它使您能够通过将四个更简单的子表达式排列在一起来构建正则表达式，这些子表达式在分隔符上匹配，并按顺序排列年、月和日字段的有效范围你需要。

这些都是 ：-

**分隔符**

```
[^\w\d\r\n:] 
```

这将匹配任何不是单词字符、数字字符、回车符、换行符或冒号的内容。必须有冒号以防止在看起来像日期的时间上匹配（请参阅我的测试数据）

您可以优化这部分模式以加快匹配速度，但这是检测大多数有效分隔符的良好基础。

但是请注意；它将匹配带有混合分隔符的字符串，例如 2/12-73，实际上可能不是有效日期。

**年份值**

```
(\d{4}|\d{2}) 
```

这匹配一组两位或四位数字，在大多数情况下这是可以接受的，但如果您正在处理 0-999 年或 9999 年之后的数据，您需要决定如何处理它，因为在大多数情况下是 1、3或 > 4 位数年份是垃圾。

**月份值**

```
(0?[1-9]|1[0-2]) 
```

匹配 1 到 12 之间的任何数字，带或不带前导零 - 注意：0 和 00 不匹配。

**日期值**

```
(0?[1-9]|[12]\d|30|31) 
```

匹配 1 到 31 之间的任何数字，带或不带前导零 - 注意：0 和 00 不匹配。

**此表达式匹配日期、月份、年份格式的日期**

```
(0?[1-9]|[12]\d|30|31)[^\w\d\r\n:](0?[1-9]|1[0-2])[^\w\d\r\n:](\d{4}|\d{2}) 
```

但它也会匹配一些年份、月份日期。它还应该与边界运算符一起预订，以确保选择整个日期字符串并防止从格式不正确的数据中提取有效的子日期，即没有边界标签 20/12/194 匹配为 20/12/19 和101/12/1974 匹配为 01/12/1974

将下一个表达式的结果与上一个表达式的结果与废话部分（下）中的测试数据进行比较

```
\b(0?[1-9]|[12]\d|30|31)[^\w\d\r\n:](0?[1-9]|1[0-2])[^\w\d\r\n:](\d{4}|\d{2})\b 
```

此正则表达式中没有验证，因此将匹配格式正确但无效的日期，例如 31/02/2001。这是一个数据质量问题，正如其他人所说，您的正则表达式不需要验证数据。

因为您（作为开发人员）无法保证您确实需要在代码中执行和处理额外验证的源数据的质量，所以如果您尝试匹配**和**验证 RegEx 中的数据，它会变得非常混乱并且难以支持没有**非常**简洁的文档。

垃圾进垃圾出。

话虽如此，如果您确实有日期值不同的混合格式，那么您必须尽可能多地提取；您可以像这样将几个表达式组合在一起；

**这个（灾难性的）表达式匹配 DMY 和 YMD 日期**

```
(\b(0?[1-9]|[12]\d|30|31)[^\w\d\r\n:](0?[1-9]|1[0-2])[^\w\d\r\n:](\d{4}|\d{2})\b)|(\b(0?[1-9]|1[0-2])[^\w\d\r\n:](0?[1-9]|[12]\d|30|31)[^\w\d\r\n:](\d{4}|\d{2})\b) 
```

但是您无法判断像 1973 年 6 月 9 日这样的日期是 9 月 6 日还是 6 月 9 日。我正在努力想一个不会在某个地方引起问题的场景，这是一种不好的做法，你不应该那样处理它 - 找到数据所有者并用治理锤击打他们.

最后，如果你想匹配一个没有分隔符的 YYYYMMDD 字符串，你可以去掉一些不确定性，表达式看起来像这样

```
\b(\d{4})(0[1-9]|1[0-2])(0[1-9]|[12]\d|30|31)\b 
```

但请再次注意，它将匹配格式正确但无效的值，例如 20010231（2 月 31 日！）:)

**测试数据**

在试验这个线程中的解决方案时，我最终得到了一个测试数据集，其中包括各种有效和无效日期以及一些您可能希望或可能不希望匹配的棘手情况，即可以匹配为日期和日期的时间多行。

我希望这对某人有用。

```
Valid Dates in various formats

Day, month, year
2/11/73
02/11/1973
2/1/73
02/01/73
31/1/1973
02/1/1973
31.1.2011
31-1-2001
29/2/1973
29/02/1976 
03/06/2010
12/6/90

month, day, year
02/24/1975 
06/19/66 
03.31.1991
2.29.2003
02-29-55
03-13-55
03-13-1955
12\24\1974
12\30\1974
1\31\1974
03/31/2001
01/21/2001
12/13/2001

Match both DMY and MDY
12/12/1978
6/6/78
06/6/1978
6/06/1978

using whitespace as a delimiter

13 11 2001
11 13 2001
11 13 01 
13 11 01
1 1 01
1 1 2001

Year Month Day order
76/02/02
1976/02/29
1976/2/13
76/09/31

YYYYMMDD sortable format
19741213
19750101

Valid dates before Epoch
12/1/10
12/01/660
12/01/00
12/01/0000

Valid date after 2038

01/01/2039
01/01/39

Valid date beyond the year 9999

01/01/10000

Dates with leading or trailing characters

12/31/21/
31/12/1921AD
31/12/1921.10:55
12/10/2016  8:26:00.39
wfuwdf12/11/74iuhwf
fwefew13/11/1974
01/12/1974vdwdfwe
01/01/99werwer
12321301/01/99

Times that look like dates

12:13:56
13:12:01
1:12:01PM
1:12:01 AM

Dates that runs across two lines

1/12/19
74

01/12/19
74/13/1946

31/12/20
08:13

Invalid, corrupted or nonsense dates

0/1/2001
1/0/2001
00/01/2100
01/0/2001
0101/2001
01/131/2001
31/31/2001
101/12/1974
56/56/56
00/00/0000
0/0/1999
12/01/0
12/10/-100
74/2/29
12/32/45
20/12/194

2/12-73 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-13T21:28:43.710

## 可维护的 Perl 5.10 版本

```
/
  (?:
      (?<month> (?&mon_29)) [\/] (?<day>(?&day_29))
    | (?<month> (?&mon_30)) [\/] (?<day>(?&day_30))
    | (?<month> (?&mon_31)) [\/] (?<day>(?&day_31))
  )
  [\/]
  (?<year> [0-9]{4})

  (?(DEFINE)
    (?<mon_29> 0?2 )
    (?<mon_30> 0?[469]   | (11) )
    (?<mon_31> 0?[13578] | 1[02] )

    (?<day_29> 0?[1-9] | [1-2]?[0-9] )
    (?<day_30> 0?[1-9] | [1-2]?[0-9] | 30 )
    (?<day_31> 0?[1-9] | [1-2]?[0-9] | 3[01] )
  )
/x 
```

您可以在此版本中按名称检索元素。

```
say "Month=$+{month} Day=$+{day} Year=$+{year}"; 
```

（没有尝试限制年份的值。）

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-04-12T09:44:16.847

在以下格式下控制日期有效性：

> YYYY/MM/DD 或 YYYY-MM-DD

我建议您使用以下正则表达式：

```
(((19|20)([2468][048]|[13579][26]|0[48])|2000)[/-]02[/-]29|((19|20)[0-9]{2}[/-](0[4678]|1[02])[/-](0[1-9]|[12][0-9]|30)|(19|20)[0-9]{2}[/-](0[1359]|11)[/-](0[1-9]|[12][0-9]|3[01])|(19|20)[0-9]{2}[/-]02[/-](0[1-9]|1[0-9]|2[0-8]))) 
```

火柴

> 2016-02-29 | 2012-04-30 | 2019/09/31

不匹配

> 2016-02-30 | 2012-04-31 | 2019/09/35

如果您只想允许 '/' 或 '-' 分隔符，您可以自定义它。此 RegEx 严格控制日期的有效性并验证 28,30 和 31 天的月份，甚至闰年的 29/02 月份。

试试吧，它工作得很好，可以防止你的代码出现很多错误！

仅供参考：我为 SQL 日期时间做了一个变体。你会在那里找到它（寻找我的名字）：[正则表达式来验证时间戳](https://stackoverflow.com/questions/1057716/regular-expression-to-validate-a-timestamp)

欢迎反馈:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-09T04:34:14.243

听起来您为此目的过度扩展了正则表达式。我要做的是使用正则表达式来匹配一些日期格式，然后使用单独的函数来验证如此提取的日期字段的值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-13T20:56:42.570

## Perl 扩展版

注意`/x`修饰符的使用。

```
/^(
      (
        ( # 31 day months
            (0[13578])
          | ([13578])
          | (1[02])
        )
        [\/]
        (
            ([1-9])
          | ([0-2][0-9])
          | (3[01])
        )
      )
    | (
        ( # 30 day months
            (0[469])
          | ([469])
          | (11)
        )
        [\/]
        (
            ([1-9])
          | ([0-2][0-9])
          | (30)
        )
      )
    | ( # 29 day month (Feb)
        (2|02)
        [\/]
        (
            ([1-9])
          | ([0-2][0-9])
        )
      )
    )
    [\/]
    # year
    \d{4}$

  | ^\d{4}$ # year only
/x 
```

原来的

```
^((((0[13578])|([13578])|(1[02]))[\/](([1-9])|([0-2][0-9])|(3[01])))|(((0[469])|([469])|(11))[\/](([1-9])|([0-2][0-9])|(30)))|((2|02)[\/](([1-9])|([0-2][0-9]))))[\/]\d{4}$|^\d{4}$ 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-01-21T00:03:21.327

如果您没有使上述建议起作用，我使用它，因为它可以获取任何日期，我通过 50 个链接运行此表达式，并且它获取了每个页面上的所有日期。

```
^20\d\d-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(0[1-9]|[1-2][0-9]|3[01])$ 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-04-29T17:53:16.907

此正则表达式使用匹配的分隔符验证 01-01-2000 和 12-31-2099 之间的日期。

```
^(0[1-9]|1[012])([- /.])(0[1-9]|[12][0-9]|3[01])\2(19|20)\d\d$ 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-11-23T18:00:48.723

```
 var dtRegex = new RegExp(/[1-9\-]{4}[0-9\-]{2}[0-9\-]{2}/);
    if(dtRegex.test(date) == true){
        var evalDate = date.split('-');
        if(evalDate[0] != '0000' && evalDate[1] != '00' && evalDate[2] != '00'){
            return true;
        }
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-09T04:36:22.380

正则表达式并不是为了验证数字范围（当它前面的数字恰好是 2 并且前面的数字恰好低于 6 时，这个数字必须是从 1 到 5）。只需在正则表达式中查找数字放置模式即可。如果您需要验证日期的质量，请将其放入日期对象 js/c#/vb 中，并在那里询问数字。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-09T04:43:17.607

我知道这不能回答您的问题，但是您为什么不使用日期处理例程来检查它是否是有效日期？即使您使用 (?!31/0?2) 之类的负前瞻断言修改正则表达式（即不匹配 31/2 或 31/02），您仍然会遇到在非闰年接受 29 02 的问题以及关于单个分隔符日期格式。

如果您想真正验证日期，问题并不容易，请查看此[论坛主题](http://discuss.joelonsoftware.com/default.asp?joel.3.229443.10)。

有关示例或更好的方法，在 C# 中，请查看[此链接](http://www.codeguru.com/columns/dotnettips/article.php/c7547)

如果您使用其他平台/语言，请告诉我们

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-13T21:42:45.657

# Perl 6 版本

```
rx{
  ^

  $<month> = (\d ** 1..2)
  { $<month> <= 12 or fail }

  '/'

  $<day> = (\d ** 1..2)
  {
    given( +$<month> ){
      when 1|3|5|7|8|10|12 {
        $<day> <= 31 or fail
      }
      when 4|6|9|11 {
        $<day> <= 30 or fail
      }
      when 2 {
        $<day> <= 29 or fail
      }
      default { fail }
    }
  }

  '/'

  $<year> = (\d ** 4)

  $
} 
```

在您使用它来检查输入后，这些值可以在, ,中`$/`或单独使用。（这些只是访问值的语法）`$<month>``$<day>``$<year>``$/`

没有尝试检查年份，或者它与非闰年的 2 月 29 日不匹配。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-09T04:45:27.647

如果您要坚持使用正则表达式执行此操作，我建议您使用以下方法：

```
( (0?1|0?3| <...> |10|11|12) / (0?1| <...> |30|31) |
  0?2 / (0?1| <...> |28|29) ) 
/ (19|20)[0-9]{2} 
```

这*可能*使阅读和理解成为可能。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-09-11T04:50:15.827

`/(([1-9]{1}|0[1-9]|1[0-2])\/(0[1-9]|[1-9]{1}|[12]\d|3[01])\/[12]\d{3})/`

这将验证以下内容 -

*   一位和 2 位数的日期，范围从 1 到 31。例如，1、01、11、31。
*   单个和 2 位数月份，范围从 1 到 12。例如。1、01、12。
*   4 位数年份。例如。2021 年，1980 年。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-10-21T12:56:45.993

一种稍微不同的方法，可能对您有用，也可能没用。

我在 php.ini 中。

与此相关的项目永远不会有早于 2008 年 1 月 1 日的日期。因此，我采用输入的“日期”并使用 strtotime()。如果答案是 >= 1199167200，那么我有一个对我有用的日期。如果输入了看起来不像日期的内容，则返回 -1。如果输入 null，它会返回今天的日期编号，因此您需要先检查非 null 条目。

适用于我的情况，也许你的也是？

# python - 如何使用 Python 检索网页的页面标题？

> ID：51233
> 
> 赞同：85
> 
> 时间：2008-09-09T04:38:55.527
> 
> 标签：python, html

如何使用 Python 检索网页的页面标题（标题 html 标记）？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-09-09T10:32:54.037

[这是@Vinko Vrsalovic 答案](https://stackoverflow.com/a/51242/4279)的简化版本：

```
import urllib2
from BeautifulSoup import BeautifulSoup

soup = BeautifulSoup(urllib2.urlopen("https://www.google.com"))
print soup.title.string 
```

笔记：

*   *soup.title*在 html 文档中的**任意位置**找到第一个*title*元素

***   *title.string*假设它只有**一个**子节点，并且该子节点是一个**字符串**** 

 **对于[beautifulsoup 4.x](http://www.crummy.com/software/BeautifulSoup/bs4/doc/)，使用不同的导入：

```
from bs4 import BeautifulSoup 
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2008-09-09T04:49:38.463

我将始终使用[lxml](http://lxml.de/)来完成此类任务。你也可以用[beautifulsoup](http://www.crummy.com/software/BeautifulSoup/)。

```
import lxml.html
t = lxml.html.parse(url)
print(t.find(".//title").text) 
```

根据评论编辑：

```
from urllib2 import urlopen
from lxml.html import parse

url = "https://www.google.com"
page = urlopen(url)
p = parse(page)
print(p.find(".//title").text) 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2017-01-31T12:46:48.390

无需导入其他库。Request 内置了此功能。

```
>> hearders = {'headers':'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:51.0) Gecko/20100101 Firefox/51.0'}
>>> n = requests.get('http://www.imdb.com/title/tt0108778/', headers=hearders)
>>> al = n.text
>>> al[al.find('<title>') + 7 : al.find('</title>')]
u'Friends (TV Series 1994\u20132004) - IMDb' 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-09T05:45:39.280

mechanize Browser 对象有一个 title() 方法。所以[这篇文章](https://stackoverflow.com/questions/51233/how-can-i-retrieve-the-page-title-of-a-webpage-using-python#51242)的代码可以重写为：

```
from mechanize import Browser
br = Browser()
br.open("http://www.google.com/")
print br.title() 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-09T04:51:09.583

对于这样一个简单的任务，这可能有点过头了，但是如果您打算做更多的事情，那么从这些工具（机械化，BeautifulSoup）开始会更明智，因为它们比替代品（urllib 获取内容和正则表达式）更容易使用或其他解析 html 的解析器）

友情链接： [BeautifulSoup](http://crummy.com/software/BeautifulSoup) [机械化](http://wwwsearch.sourceforge.net/mechanize/)

```
#!/usr/bin/env python
#coding:utf-8

from bs4 import BeautifulSoup
from mechanize import Browser

#This retrieves the webpage content
br = Browser()
res = br.open("https://www.google.com/")
data = res.get_data() 

#This parses the content
soup = BeautifulSoup(data)
title = soup.find('title')

#This outputs the content :)
print title.renderContents() 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2016-04-15T15:07:10.240

使用[HTMLParser](https://docs.python.org/3.4/library/html.parser.html)：

```
from urllib.request import urlopen
from html.parser import HTMLParser

class TitleParser(HTMLParser):
    def __init__(self):
        HTMLParser.__init__(self)
        self.match = False
        self.title = ''

    def handle_starttag(self, tag, attributes):
        self.match = tag == 'title'

    def handle_data(self, data):
        if self.match:
            self.title = data
            self.match = False

url = "http://example.com/"
html_string = str(urlopen(url).read())

parser = TitleParser()
parser.feed(html_string)
print(parser.title)  # prints: Example Domain 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2019-06-02T16:16:55.790

使用soup.select_one 定位标题标签

```
import requests
from bs4 import BeautifulSoup as bs

r = requests.get('url')
soup = bs(r.content, 'lxml')
print(soup.select_one('title').text) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-06-22T10:57:50.733

使用正则表达式

```
import re
match = re.search('<title>(.*?)</title>', raw_html)
title = match.group(1) if match else 'No title' 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-06-15T13:05:59.557

`soup.title.string`实际上返回一个 unicode 字符串。要将其转换为普通字符串，您需要执行 `string=string.encode('ascii','ignore')`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-12-19T05:49:45.033

这是一个容错`HTMLParser`实现。
您几乎可以扔任何东西`get_title()`而不会破坏它，如果发生任何意外情况 `get_title()`将返回`None`。
下载页面时， 无论页面中使用的字符集如何，都会将`Parser()`其编码为忽略任何错误。将数据转换为任何其他编码`ASCII`将是微不足道的。只需添加一个编码参数并将函数重命名为. 默认情况下会在损坏的 html 上中断，甚至会在不匹配的标签等琐碎的事情上中断。为了防止这种行为，我用一个忽略错误的函数替换了 's error 方法。`to_ascii()``UTF-8``to_encoding()`
`HTMLParser()``HTMLParser()`

```
#-*-coding:utf8;-*-
#qpy:3
#qpy:console

''' 
Extract the title from a web page using
the standard lib.
'''

from html.parser import HTMLParser
from urllib.request import urlopen
import urllib

def error_callback(*_, **__):
    pass

def is_string(data):
    return isinstance(data, str)

def is_bytes(data):
    return isinstance(data, bytes)

def to_ascii(data):
    if is_string(data):
        data = data.encode('ascii', errors='ignore')
    elif is_bytes(data):
        data = data.decode('ascii', errors='ignore')
    else:
        data = str(data).encode('ascii', errors='ignore')
    return data

class Parser(HTMLParser):
    def __init__(self, url):
        self.title = None
        self.rec = False
        HTMLParser.__init__(self)
        try:
            self.feed(to_ascii(urlopen(url).read()))
        except urllib.error.HTTPError:
            return
        except urllib.error.URLError:
            return
        except ValueError:
            return

        self.rec = False
        self.error = error_callback

    def handle_starttag(self, tag, attrs):
        if tag == 'title':
            self.rec = True

    def handle_data(self, data):
        if self.rec:
            self.title = data

    def handle_endtag(self, tag):
        if tag == 'title':
            self.rec = False

def get_title(url):
    return Parser(url).title

print(get_title('http://www.google.com')) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-02-17T02:36:03.247

`urlopen`在 Python3 中，我们可以从库`urllib.request`中调用方法`BeautifulSoup`来`bs4`获取页面标题。

```
from urllib.request import urlopen
from bs4 import BeautifulSoup
html = urlopen("https://www.google.com")
soup = BeautifulSoup(html, 'lxml')
print(soup.title.string) 
```

在这里，我们使用最有效的解析器“lxml”。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-05-03T11:32:00.833

使用 lxml...

从根据 Facebook opengraph 协议标记的页面元中获取它：

```
import lxml.html.parse
html_doc = lxml.html.parse(some_url)

t = html_doc.xpath('//meta[@property="og:title"]/@content')[0] 
```

或将 .xpath 与 lxml 一起使用：

```
t = html_doc.xpath(".//title")[0].text 
```

# c# - 如何使用 MySqlParameter 有条件地将列设置为其默认值？

> ID：51238
> 
> 赞同：2
> 
> 时间：2008-09-09T04:47:33.070
> 
> 标签：c#, .net, mysql, sql, mysql-parameter

我在存储用户帐户的 MySql 数据库中有一个表。其中一列 expires 存储到期日期，但默认为 NULL。我需要能够删除到期日期并将其设置回默认值。

目前，我所有的 CRUD 例程都是使用带有参数的 MySqlCommand 编写的。这可以直接使用 MySqlParameter 完成，还是我必须创建一个备用命令对象来处理这种可能性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T04:02:21.970

问题是 DBNull，这样做：

```
command.Parameters.AddWithValue("@parameter", null); 
```

编译确定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T05:31:47.957

不清楚你在说什么条件。如果要将列设置为默认值，可以使用[DbNull.Value](http://msdn.microsoft.com/en-us/library/system.dbnull.value.aspx)；

```
command.AddWithValue("@param", DbNull.Value);

or

command.Parameters.Add("@param", <data type>).Value = DBNull.Value; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-22T19:20:24.633

我通常在代码中将默认/空白的值设置为 null，然后在执行查询之前，运行以下循环：

```
foreach(MySqlParameter param in cmd.Parameters)
    if (param.Value == null) param.Value = DBNull.Value; 
```

# wcf - 如何将文件上传到 WCF 服务？

> ID：51256
> 
> 赞同：20
> 
> 时间：2008-09-09T05:27:00.137
> 
> 标签：wcf, web-services

我已经构建了一个 WCF 服务来接受文件并将其写入磁盘。前端包含一个带有 SWFUpload 的页面，该页面在客户端处理上传。显然，SWFUpload 使用以下内容类型发布数据：multipart/form-data。

我认为这没问题，但在服务方面我得到了一个错误。错误是“ProtocolException”，需要文本/xml。我在绑定中尝试了不同的消息编码，但似乎没有任何效果。

如何使用 multipart/form-data 上传此文件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-09T05:40:05.457

@jdiaz，

@JasonS 是对的，要上传文件，您需要将其作为字节流传输。您需要使用[WCF 流](http://msdn2.microsoft.com/en-us/library/ms733742.aspx)。例如关于如何通过 WCF 上传文件，请参阅[http://kjellsj.blogspot.com](http://kjellsj.blogspot.com)的[文章](http://kjellsj.blogspot.com/2007/02/wcf-streaming-upload-files-over-http.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T05:59:22.853

如果您希望它是标准的，您想要使用的可能是[MTOM 。](http://www.w3.org/TR/soap12-mtom/)使用它，您可以拥有 MIME 多部分消息。

然后，您必须将文件作为流读取并将其填充到请求的参数之一中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-27T05:04:58.233

可能是您的 WCF 服务以 .NET Framework 3.5 为目标，而您的 IIS 在 .NET Framework 4.0 上运行。在这种情况下（框架不匹配），您需要修改您的服务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T05:36:34.280

我相信您将不得不将文件作为字节数组传输到 WCF。在发送到您的服务之前，您需要处理来自 SWFUpload 的帖子并转换为字节数组。

# database - 在 Informix 上查找长时间运行的查询？

> ID：51262
> 
> 赞同：3
> 
> 时间：2008-09-09T05:42:49.570
> 
> 标签：database, informix

如何找出 Informix 数据库服务器上长时间运行的查询是什么？我有一个正在耗尽 CPU 的查询，并想找出查询是什么。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-22T19:46:08.910

如果查询当前正在运行，请观察**onstat -g act -r 1**输出并查找***rstcb***不为 0的项目

```
Running threads:
 tid     tcb             rstcb            prty status                vp-class      name
 106     c0000000d4860950 0                2    running               107soc        soctcppoll
 107     c0000000d4881950 0                2    running               108soc        soctcppoll
 564457  c0000000d7f28250 c0000000d7afcf20 2    running                 1cpu        CDRD_10 
```

在此示例中，第三行是当前正在运行的内容。如果您有多个具有非零 rstcb 值的行，那么请注意寻找始终或几乎始终存在的行。这很可能是您正在寻找的会话。

**c0000000d7afcf20**是我们对此示例感兴趣的地址。

使用**onstat -u | grep c0000000d7afcf20**查找会话

```
c0000000d7afcf20 Y--P--- 22887    informix -        c0000000d5b0abd0 0    5     14060    3811 
```

这将为您提供会话 ID，在我们的示例中为**22887**。使用**onstat -g ses 22887** 列出有关该会话的信息。在我的示例中，它是一个系统会话，因此在 onstat -g ses 输出中看不到任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T23:53:02.620

好的，我花了一点时间才弄清楚如何连接到 sysmaster。JDBC 连接字符串是：

> jdbc:informix-sqli://dbserver.local:1526/sysmaster:INFORMIXSERVER=mydatabase

端口号与连接到实际数据库时的端口号相同。也就是说，如果您的连接字符串是：

> jdbc:informix-sqli://database:1541/crm:INFORMIXSERVER=crmlive

那么 sysmaster 连接字符串是：

> jdbc:informix-sqli://database:1541/sysmaster:INFORMIXSERVER=crmlive

还发现[了这个 wiki 页面](http://www.informixfaq.com/wiki/doku.php/wiki:sysmaster)，其中包含许多用于对 sysmaster 表进行操作的 SQL 查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T06:13:13.097

这是因为建议的答案是针对 DB2，而不是 Informix。

sysmaster 数据库（Informix 共享内存的虚拟关系数据库）可能包含您所寻找的信息。这些页面可能会帮助您入门：

*   [http://docs.rinet.ru/InforSmes/ch22/ch22.htm](http://docs.rinet.ru/InforSmes/ch22/ch22.htm)
*   [http://www.informix.com.ua/articles/sysmast/sysmast.htm](http://www.informix.com.ua/articles/sysmast/sysmast.htm)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-09T15:12:52.053

```
SELECT ELAPSED_TIME_MIN,SUBSTR(AUTHID,1,10) AS AUTH_ID, 
AGENT_ID, APPL_STATUS,SUBSTR(STMT_TEXT,1,20) AS SQL_TEXT
FROM SYSIBMADM.LONG_RUNNING_SQL
WHERE ELAPSED_TIME_MIN > 0
ORDER BY ELAPSED_TIME_MIN DESC 
```

学分：[SQL 查看长时间运行的查询](http://it.toolbox.com/blogs/db2luw/sql-to-view-long-running-queries-13577)

# sql - 您查询哪个表/视图以选择 Oracle 模式中的所有表名？

> ID：51264
> 
> 赞同：3
> 
> 时间：2008-09-09T05:46:34.037
> 
> 标签：sql, oracle

您查询什么对象来选择 Oracle 模式中的所有表名？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T06:16:42.140

查看您有权访问的所有表格

```
select table_name from all_tables where owner='<SCHEMA>'; 
```

为当前登录的模式选择所有表（例如，您的表）

```
select table_name from user_tables; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T05:52:55.380

您正在寻找：

```
从用户表中选择表名；

```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-09T05:49:07.103

您可以使用：

```
select tabname from tabs 
```

获取模式中存在的表的名称。

# java - Solaris 上 Java/C++ 的高可用性和可扩展平台

> ID：51266
> 
> 赞同：9
> 
> 时间：2008-09-09T05:52:23.680
> 
> 标签：java, c++, scalability, solaris, high-availability

我有一个在 Solaris 上混合了 Java 和 C++ 的应用程序。代码的 Java 方面运行 Web UI 并在我们正在与之交谈的设备上建立状态，而 C++ 代码对从设备返回的数据进行实时处理。共享内存用于将设备状态和上下文信息从 Java 代码传递到 C++ 代码。Java 代码使用 PostgreSQL 数据库来保持其状态。

我们遇到了一些非常严重的性能瓶颈，现在我们可以扩展的唯一方法是增加内存和 CPU 数量。由于共享内存设计，我们被困在一个物理盒子上。

* * *

这里真正的大热门是 C++ 代码。Web 界面相当轻松地用于配置设备；我们真正苦苦挣扎的地方是处理设备在配置后提供的数据量。

我们从设备返回的每条数据都有一个标识符，它指向设备上下文，我们需要查找它。现在有一系列由 Java/UI 代码维护并由 C++ 代码引用的共享内存对象，这就是瓶颈。由于这种架构，我们无法将 C++ 数据处理转移到另一台机器上。我们需要能够横向扩展，以便不同的机器可以处理各种设备子集，但随后我们就失去了进行上下文查找的能力，这就是我要解决的问题：如何卸载真实的-时间数据处理到其他盒子，同时仍然能够参考设备上下文。

我应该指出，我们无法控制设备本身使用的协议，而且这种情况不可能发生变化。

* * *

我们知道我们需要摆脱这种情况，以便能够通过向集群添加更多机器来进行横向扩展，而我正处于研究如何做到这一点的早期阶段。

现在，我将 Terracotta 视为一种扩展 Java 代码的方法，但我还没有弄清楚如何扩展 C++ 以匹配。

除了扩展性能外，我们还需要考虑高可用性。应用程序需要几乎始终可用——不是绝对 100%，这不符合成本效益，但我们需要做一些合理的工作来应对机器中断。

如果你必须承担我被赋予的任务，你会怎么做？

*编辑：根据@john channing 提供的数据，我正在研究 GigaSpaces 和 Gemstone。Oracle Coherence 和 IBM ObjectGrid 似乎仅限于 java。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T09:00:54.337

我要做的第一件事是构建系统模型以映射数据流并尝试准确了解瓶颈所在。如果您可以将系统建模为[管道](http://en.wikipedia.org/wiki/Pipeline_(software))，那么您应该能够使用约束理论（大多数文献是关于优化业务流程，但它同样适用于软件）来不断提高性能并消除瓶颈。

接下来，我将收集一些准确描述系统性能的硬性经验数据。你无法管理你无法衡量的东西，这是一种陈词滥调，但我看到很多人试图基于预感优化软件系统并惨遭失败。

然后我会使用[帕累托原则（80/20 规则）](http://en.wikipedia.org/wiki/Pareto_principle)来选择能够产生最大收益的少数事情，并只关注那些。

为了横向扩展 Java 应用程序，我广泛使用了[Oracle Coherence](http://www.oracle.com/technology/products/coherence/index.html)。虽然有些人认为它是一个非常昂贵的[分布式哈希表](http://en.wikipedia.org/wiki/Distributed_hash_table)，但功能比这要丰富得多，例如，您可以直接从[C++ 代码](http://coherence.oracle.com/pages/viewpage.action?pageId=1343579)访问缓存中的数据。

水平扩展 Java 代码的其他替代方案是[Giga Spaces](http://www.gigaspaces.com/)、[IBM Object Grid](http://www.infoq.com/news/IBM-ObjectGrid-Cache)或[Gemstone Gemfire](http://www.gemstone.com/)。

如果您的 C++ 代码是无状态的并且纯粹用于数字运算，您可以考虑使用[ICE Grid](http://www.zeroc.com/icegrid/index.html)分发该过程，它具有您正在使用的所有语言的绑定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T06:05:04.523

您需要横向和向外扩展。也许像[消息队列](http://en.wikipedia.org/wiki/Java_Message_Service)这样的东西可能是前端和处理之间的后端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T12:29:07.923

安德鲁，（除了建模为管道等），测量事物很重要。您是否对代码运行了分析器并获得了大部分时间花费在哪里的指标？

对于数据库代码，它多久更改一次？你现在在看缓存吗？我假设您已经查看了数据上的索引等以加快 Db 速度？

您在前端的流量是多少？你在缓存网页吗？（不难说使用JMS类型的api在组件之间进行通信。然后您可以将Web Page组件放在一台（或多台）机器上，然后将集成代码（c ++）放在另一台机器上，对于许多JMS产品通常有本地 C++ api，即 ActiveMQ 浮现在脑海中），但它确实有助于了解 Web（JSP ？）、C++、数据库操作中有多少时间。

数据库是存储业务数据，还是也用于在 Java 和 C++ 之间传递数据？您说您使用的是共享内存而不是 JNI 吗？APP中目前存在什么级别的多线程？您会将代码描述为本质上是同步的还是异步的？

Solaris 代码和必须维护的设备之间是否存在物理关系（即是否所有设备都使用 c++ 代码注册，或者可以指定）。IE。如果您要在前端放置一个 Web 负载均衡器，而今天只放置 2 台机器，那么哪些设备是由预先或预先初始化的盒子管理的？

什么是 HA 要求？IE。只是状态信息？HA 可以通过集群会话数据仅在 Web 层完成吗？

数据库是否在另一台机器上运行？

数据库有多大？您是否优化了查询，即。尝试使用显式内部/外部连接有时有助于与嵌套子查询（sometmes）。（再次查看 sql 统计信息）。

# c# - 在运行时更改属性的参数

> ID：51269
> 
> 赞同：69
> 
> 时间：2008-09-09T05:55:53.360
> 
> 标签：c#, reflection, attributes

我不确定是否可以在运行时更改属性的参数？例如，在程序集中，我有以下类

```
public class UserInfo
{
    [Category("change me!")]
    public int Age
    {
        get;
        set;
    }
    [Category("change me!")]
    public string Name
    {
        get;
        set;
    }
} 
```

这是由第三方供应商提供的类，**我无法更改代码**。但是现在我发现上面的描述并不准确，当我将上面类的实例绑定到属性网格时，我想将“更改我”类别名称更改为其他名称。

我可以知道该怎么做吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-09T06:10:53.433

好吧，您每天都会学到新东西，显然我撒了谎：

> 通常没有意识到的是，您可以在运行时相当容易地更改属性**实例**值。原因当然是，创建的属性类的实例是完全正常的对象，可以不受限制地使用。例如，我们可以获取对象：
> 
> ```
> ASCII[] attrs1=(ASCII[])
>     typeof(MyClass).GetCustomAttributes(typeof(ASCII), false); 
> ```
> 
> …更改其公共变量的值并显示它已更改：
> 
> ```
> attrs1[0].MyData="A New String";
> MessageBox.Show(attrs1[0].MyData); 
> ```
> 
> ...最后创建另一个实例并显示其值未更改：
> 
> ```
> ASCII[] attrs3=(ASCII[])
>     typeof(MyClass).GetCustomAttributes(typeof(ASCII), false);
>  MessageBox.Show(attrs3[0].MyData); 
> ```

[http://www.vsj.co.uk/articles/display.asp?id=713](http://www.vsj.co.uk/articles/display.asp?id=713)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-01-22T00:21:27.300

万一其他人走这条路，答案是你可以通过反射来做到这一点，除非你不能，因为框架中有一个错误。以下是您的操作方法：

```
Dim prop As PropertyDescriptor = TypeDescriptor.GetProperties(GetType(UserInfo))("Age")
Dim att As CategoryAttribute = DirectCast(prop.Attributes(GetType(CategoryAttribute)), CategoryAttribute)
Dim cat As FieldInfo = att.GetType.GetField("categoryValue", BindingFlags.NonPublic Or BindingFlags.Instance)
cat.SetValue(att, "A better description") 
```

一切都很好，除了更改所有属性的类别属性，而不仅仅是“年龄”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-03T12:36:27.147

您可以很容易地对大多数常见属性进行子类化以提供这种可扩展性：

```
using System;
using System.ComponentModel;
using System.Windows.Forms;
class MyCategoryAttribute : CategoryAttribute {
    public MyCategoryAttribute(string categoryKey) : base(categoryKey) { }

    protected override string GetLocalizedString(string value) {
        return "Whad'ya know? " + value;
    }
}

class Person {
    [MyCategory("Personal"), DisplayName("Date of Birth")]
    public DateTime DateOfBirth { get; set; }
}

static class Program {
    [STAThread]
    static void Main() {
        Application.EnableVisualStyles();
        Application.Run(new Form { Controls = {
           new PropertyGrid { Dock = DockStyle.Fill,
               SelectedObject = new Person { DateOfBirth = DateTime.Today}
           }}});
    }
} 
```

还有更复杂的选项涉及编写 custom `PropertyDescriptor`，通过或- 公开`TypeConverter`，但这通常是矫枉过正。`ICustomTypeDescriptor``TypeDescriptionProvider`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-08-11T23:35:28.603

不幸的是，属性并不意味着在运行时改变。你基本上有两个选择：

1.  `System.Reflection.Emit`使用如下所示重新创建一个类似的类型。

2.  请您的供应商添加此功能。如果您使用的是 Xceed.WpfToolkit.Extended，您可以从[这里](https://wpftoolkit.codeplex.com/SourceControl/latest)下载源代码并轻松实现一个类似的接口，该接口`IResolveCategoryName`将在运行时解析属性。我做了更多的事情，在编辑 a 中的数值时添加更多功能（如限制）非常容易`DoubleUpDown`，`PropertyGrid`等等。

    ```
    namespace Xceed.Wpf.Toolkit.PropertyGrid
    {
        public interface IPropertyDescription
        {
            double MinimumFor(string propertyName);
            double MaximumFor(string propertyName);
            double IncrementFor(string propertyName);
            int DisplayOrderFor(string propertyName);
            string DisplayNameFor(string propertyName);
            string DescriptionFor(string propertyName);
            bool IsReadOnlyFor(string propertyName);
        }
    } 
    ```

对于第一个选项：但是，这缺乏适当的属性绑定来将结果反映回正在编辑的实际对象。

```
 private static void CreatePropertyAttribute(PropertyBuilder propertyBuilder, Type attributeType, Array parameterValues)
    {
        var parameterTypes = (from object t in parameterValues select t.GetType()).ToArray();
        ConstructorInfo propertyAttributeInfo = typeof(RangeAttribute).GetConstructor(parameterTypes);
        if (propertyAttributeInfo != null)
        {
            var customAttributeBuilder = new CustomAttributeBuilder(propertyAttributeInfo,
                parameterValues.Cast<object>().ToArray());
            propertyBuilder.SetCustomAttribute(customAttributeBuilder);
        }
    }
    private static PropertyBuilder CreateAutomaticProperty(TypeBuilder typeBuilder, PropertyInfo propertyInfo)
    {
        string propertyName = propertyInfo.Name;
        Type propertyType = propertyInfo.PropertyType;

        // Generate a private field
        FieldBuilder field = typeBuilder.DefineField("_" + propertyName, propertyType, FieldAttributes.Private);

        // Generate a public property
        PropertyBuilder property = typeBuilder.DefineProperty(propertyName, PropertyAttributes.None, propertyType,
            null);

        // The property set and property get methods require a special set of attributes:
        const MethodAttributes getSetAttr = MethodAttributes.Public | MethodAttributes.HideBySig;

        // Define the "get" accessor method for current private field.
        MethodBuilder currGetPropMthdBldr = typeBuilder.DefineMethod("get_" + propertyName, getSetAttr, propertyType, Type.EmptyTypes);

        // Intermediate Language stuff...
        ILGenerator currGetIl = currGetPropMthdBldr.GetILGenerator();
        currGetIl.Emit(OpCodes.Ldarg_0);
        currGetIl.Emit(OpCodes.Ldfld, field);
        currGetIl.Emit(OpCodes.Ret);

        // Define the "set" accessor method for current private field.
        MethodBuilder currSetPropMthdBldr = typeBuilder.DefineMethod("set_" + propertyName, getSetAttr, null, new[] { propertyType });

        // Again some Intermediate Language stuff...
        ILGenerator currSetIl = currSetPropMthdBldr.GetILGenerator();
        currSetIl.Emit(OpCodes.Ldarg_0);
        currSetIl.Emit(OpCodes.Ldarg_1);
        currSetIl.Emit(OpCodes.Stfld, field);
        currSetIl.Emit(OpCodes.Ret);

        // Last, we must map the two methods created above to our PropertyBuilder to 
        // their corresponding behaviors, "get" and "set" respectively. 
        property.SetGetMethod(currGetPropMthdBldr);
        property.SetSetMethod(currSetPropMthdBldr);

        return property;

    }

    public static object EditingObject(object obj)
    {
        // Create the typeBuilder
        AssemblyName assembly = new AssemblyName("EditingWrapper");
        AppDomain appDomain = System.Threading.Thread.GetDomain();
        AssemblyBuilder assemblyBuilder = appDomain.DefineDynamicAssembly(assembly, AssemblyBuilderAccess.Run);
        ModuleBuilder moduleBuilder = assemblyBuilder.DefineDynamicModule(assembly.Name);

        // Create the class
        TypeBuilder typeBuilder = moduleBuilder.DefineType("EditingWrapper",
            TypeAttributes.Public | TypeAttributes.AutoClass | TypeAttributes.AnsiClass |
            TypeAttributes.BeforeFieldInit, typeof(System.Object));

        Type objType = obj.GetType();
        foreach (var propertyInfo in objType.GetProperties())
        {
            string propertyName = propertyInfo.Name;
            Type propertyType = propertyInfo.PropertyType;

            // Create an automatic property
            PropertyBuilder propertyBuilder = CreateAutomaticProperty(typeBuilder, propertyInfo);

            // Set Range attribute
            CreatePropertyAttribute(propertyBuilder, typeof(Category), new[]{"My new category value"});

        }

        // Generate our type
        Type generetedType = typeBuilder.CreateType();

        // Now we have our type. Let's create an instance from it:
        object generetedObject = Activator.CreateInstance(generetedType);

        return generetedObject;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-10T20:16:40.757

鉴于 PropertyGrid 的选定项目是“年龄”：

```
SetCategoryLabelViaReflection(MyPropertyGrid.SelectedGridItem.Parent,
    MyPropertyGrid.SelectedGridItem.Parent.Label, "New Category Label"); 
```

其中`SetCategoryLabelViaReflection()`定义如下：

```
private void SetCategoryLabelViaReflection(GridItem category,
                                           string oldCategoryName,
                                           string newCategoryName)
{
    try
    {
        Type t = category.GetType();
        FieldInfo f = t.GetField("name",
                                 BindingFlags.NonPublic | BindingFlags.Instance);
        if (f.GetValue(category).Equals(oldCategoryName))
        {
            f.SetValue(category, newCategoryName);
        }
    }
    catch (Exception ex)
    {
        System.Diagnostics.Trace.Write("Failed Renaming Category: " + ex.ToString());
    }
} 
```

至于以编程方式设置所选项目，您希望更改其父类别；有许多简单的解决方案。谷歌“将焦点设置为特定的 PropertyGrid 属性”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-09T17:07:37.480

你解决问题了吗？

以下是实现可接受解决方案的可能步骤。

1.  尝试创建一个子类，重新定义您需要更改属性的所有`[Category]`属性（用 标记它们`new`）。例子：

> ```
> public class UserInfo
> {
>  [Category("Must change")]
>  public string Name { get; set; }
> }
> 
> public class NewUserInfo : UserInfo
> {
>  public NewUserInfo(UserInfo user)
>  {
>  // transfer all the properties from user to current object
>  }
> 
>  [Category("Changed")]
>  public new string Name {
> get {return base.Name; }
> set { base.Name = value; }
>  }
> 
> public static NewUserInfo GetNewUser(UserInfo user)
> {
> return NewUserInfo(user);
> }
> }
> 
> void YourProgram()
> {
> UserInfo user = new UserInfo();
> ...
> 
> // Bind propertygrid to object
> 
> grid.DataObject = NewUserInfo.GetNewUser(user);
> 
> ...
> 
> } 
> ```

**稍后编辑：** *如果您有大量可能需要重写属性的属性，则此部分解决方案不可行。这是第二部分到位的地方：*

2.  当然，如果类不可继承，或者您有很多对象（和属性），这将无济于事。您需要创建一个全自动代理类来获取您的类并创建一个动态类，应用属性，当然还要在两个类之间建立连接。这有点复杂，但也是可以实现的。只需使用反射，您就走在了正确的道路上。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-16T15:39:00.333

这是一种“作弊”的方法：

如果属性参数有固定数量的恒定潜在值，则可以为参数的每个潜在值定义一个单独的属性（并为每个属性赋予稍微不同的属性），然后动态切换您引用的属性。

在 VB.NET 中，它可能如下所示：

```
Property Time As Date

<Display(Name:="Month")>
ReadOnly Property TimeMonthly As Date
    Get
        Return Time
    End Get
End Property

<Display(Name:="Quarter")>
ReadOnly Property TimeQuarterly As Date
    Get
        Return Time
    End Get
End Property

<Display(Name:="Year")>
ReadOnly Property TimeYearly As Date
    Get
        Return Time
    End Get
End Property 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-09T06:05:37.627

我真的不这么认为，除非有一些时髦的反射可以把它拉下来。属性装饰是在编译时设置的，据我所知是固定的

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-20T10:59:33.210

同时，我得出了一个部分解决方案，源自以下文章：

1.  [ICustomTypeDescriptor，第 1 部分](http://msdn.microsoft.com/en-us/magazine/cc163816.aspx)
2.  [ICustomTypeDescriptor，第 2 部分](http://msdn.microsoft.com/en-us/magazine/cc163804.aspx)
3.  [在运行时向（从）PropertyGrid 添加（删除）项目](http://www.codeproject.com/KB/tabs/Dynamic_Propertygrid.aspx)

基本上，您将创建一个通用类`CustomTypeDescriptorWithResources<T>`，它将通过反射和加载`Description`以及`Category`从文件中获取属性（我想您需要显示本地化文本，以便可以使用资源文件（`.resx`））

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2013-11-05T11:29:49.227

您可以在运行时在类级别（不是对象）更改属性值：

```
var attr = TypeDescriptor.GetProperties(typeof(UserContact))["UserName"].Attributes[typeof(ReadOnlyAttribute)] as ReadOnlyAttribute;
attr.GetType().GetField("isReadOnly", BindingFlags.NonPublic | BindingFlags.Instance).SetValue(attr, username_readonly); 
```

# java - 将java编译为本机代码的性能提升？

> ID：51276
> 
> 赞同：11
> 
> 时间：2008-09-09T06:05:02.870
> 
> 标签：java, performance

这些天将java编译为本机代码是否有任何性能，或者现代热点编译器最终会随着时间的推移而这样做吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T08:08:20.000

最近这里有一个类似的讨论，关于[字节码比本机代码有什么优势？](https://stackoverflow.com/questions/48144/what-are-advantages-of-bytecode-over-native-code). 您可以在该线程中找到有趣的答案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T10:37:23.963

还有一些轶事证据。我从事过一些性能关键的实时交易金融应用程序。我同意弗兰克的观点，几乎每次你的问题都不是缺乏编译，而是你的算法或数据结构。现代热点编译器非常适合使用正确的代码，例如[CERN Colt 库](http://acs.lbl.gov/~hoschek/colt/)在 90% 范围内是针对数值工作的已编译、优化的 Fortran。

如果您担心速度，我真的会推荐一个好的分析器并获得关于您的瓶颈所在的证据 - 我使用[YourKit](http://www.yourkit.com/)并且非常高兴。

在过去的几年里，我们只在一个实例中使用原生编译代码来提高速度，这样我们就可以使用[CUDA](http://www.nvidia.com/object/cuda_home.html#)并获得一些出色的 GPU 性能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T22:56:20.567

你的问题有点大，答案差别很大

*   是否使用即时编译 (JIT)
*   在你使用的时候，你的进程是否执行了很长时间

所有最近的 JVM 都使用 JIT，但在旧 JVM 上，java 代码比本地代码慢几倍。

如果您有一个长时间运行的服务器或一次又一次执行相同代码的批处理，那么差异和上限非常低。

我们用 C++ 和 Java 编写了相同的批次，并使用不同的数据集运行它，结果差异大约 3 秒，数据集需要 5 分钟到几个小时。

但要小心，它们是特殊情况，会有重要区别，例如需要大量内存的批处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T06:28:56.260

内存性能还是CPU性能？还是这些天都一样？

我唯一的证据是轶事并且在不同的平台上：在将一堆需要 CPU 的应用程序移植到 C# (.NET 2.0) 之后，我没有注意到性能的实质性损失（我不认为 10% 是实质性的）。编写良好的代码似乎在各种架构上都表现良好。

大多数应用程序花费/浪费时间：

*   不会从静态（编译时）分析中受益的 IO 操作。
*   不会从静态分析中受益的错误算法。
*   关键 CPU 内部循环中的错误内存布局。虽然编译器在技术上可以帮助我们，但我还没有看到真正的编译器做任何有趣的事情。

因此，根据我的经验，除非您正在编写视频编解码器，否则编译 Java 应用程序与仅依赖热点编译器相比没有任何好处。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2013-09-06T19:51:21.990

在六种不同的实现中尝试了 Hello-World，只是为了检查开销，差异是惊人的。Java 表现出色，而编译语言表现同样出色。如果需要，我可以证明所有证据（以可重复的方式）。

# integration - 使用旧应用程序进行单点登录的策略

> ID：51279
> 
> 赞同：3
> 
> 时间：2008-09-09T06:05:57.377
> 
> 标签：integration, single-sign-on, legacy

我想知道人们使用什么策略来减少旧应用程序的登录以及他们发现它们的效果如何？

我们有一个基于 ASP.Net 的 Intranet，并且拥有很多遗留应用程序，但不是全部。我们也有 BizTalk，并且也在考虑使用它的 SSO 引擎。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T06:12:55.037

在工作量/返工和单点登录的便利性之间的一个很好的折衷方案是继续在旧版应用程序中维护用户、权限、角色等的列表。进行必要的更改以根据用户帐户（通常是他们的 Windows 或网络帐户）自动将用户登录到您的应用程序。

我目前正在运行几个使用这种登录方法的应用程序，这使它们看起来更加集成，即使它们不是。

我们发现的另一个优势是它可以阻止人们将密码共享给遗留应用程序。他们不太可能分发管理员密码，这也让其他人可以访问他们的电子邮件或工资单详细信息！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T06:19:33.677

每个应用程序有多个身份存储？可能不是单点登录解决方案，但您是否尝试过寻找更有针对性的解决方案，例如 MS Identity Lifecycle Manager？它将简化应用程序之间的身份同步，并且它也是可插拔的，这意味着您可以连接自己的代码来进行不同系统之间的同步。因此，如果您更改 ILM 门户中的身份信息（即登录信息），您可以将这些信息传播到不同的系统。配置和取消配置身份也是如此。单点入口。
我想您也可以将 biztalk 用于类似的事情。

至于真正的单点登录解决方案，您只需登录一次，无需再次登录到不同的应用程序。我还没有找到一个。

我想如果你的遗留应用程序有一个可插入的身份提供程序模块，它是可行的，这意味着你可以自定义登录系统以连接到你的单一身份真实来源，无论它可能是什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T07:40:15.977

我们对遗留账户做了两件事。（旧版基于 Web 的应用程序）

我们首先将旧帐户映射到其系统登录帐户（在 Windows Active Directory 中运行）。

然后将外观登录屏幕应用于旧应用程序（基于 Web）的顶部，这将请求 AD 登录，然后将反向映射到旧应用程序登录帐户并使用旧应用程序为用户分配适当的权限系统安全模型。用户收到了一个会话令牌，为他们打开了大门。

这给了我们不必改造遗留应用程序的好处（例如，会发生的情况是应用程序 x 只有数字作为 ID，并且用户使用 Windows 登录（字母数字），并且还从客户端的角度实现了伪单点登录。

另一个有意义的选项是在新的登录屏幕上，它将检查多个安全存储库，因此即使用户没有决定使用他们的 windows 登录，他们仍然可以使用旧帐户名登录。显然，这确实有一些副作用，但也可以帮助缓解最终用户有时会在系统之间移动的过渡痛苦。

还有像[Citrix XenApp Single Signon](http://www.citrix.com/English/ps2/products/subfeature.asp?contentID=163988)这样的程序采用完全不同的方法来解决这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T12:01:26.380

除了 Jimmy 关于使用 ILM 的观点之外，这个特定系统确实允许与 AD PCNS（密码更改通知服务）服务集成，该服务可以与 ILM 一起使用（ILM“看到”密码更改事件并可以将其发布到其他消费应用程序/services) 至少确保当用户的密码在一个系统中更改时，它会反映到其他系统中。

# javascript - 访问受限 URI 被拒绝代码：1012

> ID：51283
> 
> 赞同：28
> 
> 时间：2008-09-09T06:12:10.450
> 
> 标签：javascript, jquery, ajax, xss

您如何在 FireFox 3 上解决这个 Ajax 跨站点脚本问题？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-09T06:19:47.997

如果你使用 jQuery，它有一个回调函数来克服这个问题：

[http://docs.jquery.com/Ajax/jQuery.ajax#options](http://docs.jquery.com/Ajax/jQuery.ajax#options)

> 从 jQuery 1.2 开始，如果指定 JSONP 回调，则可以加载位于另一个域中的 JSON 数据，可以像这样：“myurl?callback=?”。jQuery 自动替换 ? 使用正确的方法名称调用，调用您指定的回调。或者，如果您将 dataType 设置为“jsonp”，则会自动将回调添加到您的 Ajax 请求中。

或者，您可以向服务器端脚本发出 ajax 请求，该脚本为您执行跨域调用，然后将数据传递回您的脚本

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-24T20:04:18.363

为了更新答案（我想，主要是为了我稍后寻找这个答案时的好处），如果正在加载 XML 或其他内容，您可以随时询问用户他是否允许我们使用此代码从另一个站点读取：

```
try {
    if (netscape.security.PrivilegeManager.enablePrivilege)
        netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
} catch (e) { 
    alert("Sorry, browser security settings won't let this program run."); 
    return; 
} 
```

（来自 RESTful Web 服务书）但是，这仅适用于 Firefox，当从本地文件加载 html 文件时。所以，没那么有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-01T11:33:17.997

另一种解决方案：如果您只需要标头，则可以将“HEAD”指定为方法，它不会触发安全问题。例如，如果您只想知道网页是否存在。

```
var client = new XMLHttpRequest();
client.open("HEAD", my_url, false);
client.send(null);
if(client.readyState != 4 || client.status != 200) //if we failed
    alert("can't open web page"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T06:22:21.847

更多细节会很好：您正在使用哪个 AJAX 库，您想要实现什么，您是如何做到的。

例如，它可以是跨域的 Ajax 请求，这是不允许的。在这种情况下使用[JSON](http://www.json.org/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-14T05:53:52.293

我最近遇到了这个问题，它是在我作为 AJAX 加载本地请求时，而不是跨站点脚本问题。此外，吉米本人似乎也有同样的问题。这似乎是FF安全问题，这篇文章描述了[访问受限uri被拒绝“代码：”1012问题的原因和解决方案](http://jquery-howto.blogspot.com/2008/12/access-to-restricted-uri-denied-code.html)。

> 抱歉，在 FireFox 3 上使用 JQuery $.ajax 时遇到了该错误。尝试了 jsonp 建议，但我认为这只适用于可以提供 json 的东西。我正在尝试创建一个基于本地 html 文件的示例混搭，该混搭将从 Yahoo!Finance 提取数据，但它们提供 .csv，所以我认为我是 SOL。– 吉米钱德拉（9 月 9 日 17:20）

我希望你会发现它有用。

# sql-server - 如何在 SVN/Other 存储库中保留存储过程和其他脚本？

> ID：51288
> 
> 赞同：13
> 
> 时间：2008-09-09T06:19:51.337
> 
> 标签：sql-server, svn, tortoisesvn, repository

任何人都可以提供一些真实示例，说明如何最好地将视图、存储过程和函数的脚本文件保存在 SVN（或其他）存储库中。

显然，一种解决方案是将所有不同组件的脚本文件放在一个目录或多个目录中，并简单地使用 TortoiseSVN 等将它们保存在 SVN 中，然后每当要进行更改时，我将脚本加载到 Management Studio 等中.我真的不想要这个。

我真正喜欢的是某种可以定期（每晚？）运行的批处理脚本，它将导出在给定时间范围内更改的所有存储过程/视图等，然后将它们提交给 SVN。

想法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-09T06:31:14.600

对我来说，听起来你不想正确使用修订控制。

> 显然，一种解决方案是将所有不同组件的脚本文件放在一个目录或多个目录中，然后简单地使用 TortoiseSVN 等将它们保存在 SVN 中

这是应该做的。您将拥有正在处理的本地副本（开发新的、调整旧的等），并且随着单个组件/过程/等完成，您将单独提交它们，直到您必须重新开始该过程。

仅仅因为距离上次提交已经“X”次而提交半完成的代码是草率的，并且肯定会导致其他使用存储库的人感到悲伤。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T06:29:40.457

我发现最好像对待任何其他可编译代码一样对待存储过程：代码存在于存储库中，您检查它以进行更改并将其加载到您的开发工具中以编译或部署代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T07:02:55.023

您可以创建一个批处理文件并安排它：

*   删除脚本目录的内容
*   使用[ExportSQLScript 之](http://www.codeplex.com/ExportSQLScript)类的东西将所有对象导出到脚本/脚本
*   svn 提交

请注意：尽管您将拥有受源代码控制的对象，但您不会拥有数据或其进程（是重命名的字段，还是 1 个新字段和 1 个已删除？）。

这种方法非常适合维护变更历史。但是，当然，您永远不应该自动提交到“生产构建”（除非您喜欢损坏的构建）。

尽管您没有要求它：这种方法也不会生成一组将升级当前数据库的脚本。您将只有初始创建脚本。记录数据进程和创建升级脚本超出了基本的源代码控制系统。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T06:57:33.587

我会为此推荐[Redgate](http://www.red-gate.com/) SQL Compare - 它允许您比较数据库版本并生成更改脚本 - 它也很容易编写脚本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T18:37:19.457

根据您扩展的问题，您真的想使用 DDL 触发器。查看[这篇文章](http://www.sqlteam.com/article/using-ddl-triggers-in-sql-server-2005-to-capture-schema-changes)，详细介绍如何为您的数据库创建变更日志系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T06:47:24.827

不确定您的价格范围，但[DB Ghost](http://www.innovartis.co.uk/)可能是您的选择。

我不为这家公司工作（或拥有该产品），但在我研究同一问题时，该产品看起来很有前途。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T07:50:44.067

我应该更具描述性。有问题的数据库是用于内部 ERP 系统的，因此我们没有很多版本的数据库，只有生产/测试/开发。当我们完成更改请求、一些新奇特的功能或其他东西时，我们只需执行一个脚本或一系列脚本来更新测试数据库上的相关过程，如果一切顺利，那么我们对生产也做同样的事情。

所以我并不真正追求完整的模式脚本本身，只是可以随着时间的推移跟踪对存储过程的各种编辑。例如， PROCESS_INVOICE 会做一些事情。它在三月份以一些小的方式进行了更新。在 5 月之后的某个时间，人们发现在极少数情况下，客户会收到双重发票（或其他一些疯狂的极端情况）。我希望能够看到随着时间的推移这个过程发生了什么。目前这里设置开发环境的方式我没有，我正在尝试改变。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-09T18:28:15.657

我可以推荐 DBPro，它是 Visual Studio Team Edition 的一部分。几个月来一直使用它来存储 Team Foundation Server 中数据库的所有部分以及部署和数据库比较等。

当然，正如其他人提到的，它确实取决于您的环境和价格范围。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T02:54:32.547

我编写了一个实用程序，用于将我的数据库的所有相关部分转储到我使用 SVN 的目录结构中。我从来没有尝试将它合并到管理器中，但是，如果你有兴趣，它就在这里：[http ://www.relucantdba.com/dbas-and-programmers/sqltools/svnforsql2005.aspx](http://www.reluctantdba.com/dbas-and-programmers/sqltools/svnforsql2005.aspx)

它是免费的，而且因为我经常运行它，所以你知道任何错误都会很快得到修复。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-09-09T08:07:36.990

您可以随时尝试将 SourceSafe 与 SQL Server 集成。这是一个快速入门：[链接](http://msdn.microsoft.com/en-us/library/ms181089(VS.80).aspx)。要使用它，您必须拥有 Managment Studio Developers Edition。

# javascript - 将 Silverlight 类型传递给 Microsoft AJAX 并传递参数验证

> ID：51289
> 
> 赞同：1
> 
> 时间：2008-09-09T06:20:44.610
> 
> 标签：javascript, ajax, silverlight, asp.net-ajax, htmlbridge

我正在开发一个希望利用 Microsoft ASP.NET AJAX 客户端库的 Silverlight 应用程序。我正在使用作为 Silverlight 2 一部分的 HTML Bridge 调用该库。Silverlight 对在 JavaScript 和托管代码之间传递类型提供了很好的支持，但现在我遇到了一个问题。

Microsoft ASP.NET AJAX 客户端库包括一个“类型系统”，框架所做的其中一件事是验证参数的类型是否正确。我正在调用的特定函数是`Sys.Application.addHistoryPoint`，验证代码如下所示：

```
var e = Function.validateParams(arguments, [
    {name: "state", type: Object},
    {name: "title", type: String, mayBeNull: true, optional: true}
]); 
```

我尝试将各种 CLR 类型作为状态参数传递（C# 结构、[ScriptableTypes]、字典类型等。每次我收到错误时：

> “Sys.ArgumentTypeException：‘函数’类型的对象无法转换为‘对象’类型

这个错误显然来自参数验证......但是为什么 ASP.NET AJAX 认为我的类型是函数？有人了解 MS AJAX 中的类型验证吗？

我知道我可以做一些变通方法，比如调用`HtmlPage.Window.Eval("...")`并将我的 JS 集成作为字符串传递，但我不想这样做。我想传递一个真正的 .NET 类型作为状态参数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T03:27:09.337

[我在这里](http://pietschsoft.com/post/2008/06/Silverlight-and-JavaScript-Interop-Basics.aspx)找到了一个很好的概述，但即使是那个概述似乎也涵盖了除了你提到的那个之外的所有场景。我想知道这是否不能完成，因为 javascript 对象确实是函数（或多或少）。

如果您编写了一个可以使用字符串创建状态对象的包装函数怎么办？

# c - 在程序中检查网络状态和控制 PPP

> ID：51296
> 
> 赞同：3
> 
> 时间：2008-09-09T06:32:42.430
> 
> 标签：c, linux, networking, embedded, ppp

所以我在 linux 下使用蜂窝调制解调器运行 PPP。我正在编写的程序需要在发送任何数据之前知道链接是否处于活动状态。

我有哪些检查选项

*   如果链接可用
*   如果它路由到我控制的服务器（它不会像我之前所说的那样进入互联网）

另外，重新启动它的最佳方法是什么 - 我希望程序控制它何时启动和停止，所以我认为 init.d 不合适。using`system()`似乎没有给出 PID，除了调用`fork()`的笨拙之外还有其他选择吗？`exec??()`

C on Linux on ARM（使用 buildroot 的自定义分发）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T00:11:32.820

您可以使用`ip-up`pppd 的脚本功能让它在 IP 接口启动并准备好时执行程序。详细信息在[pppd(8) 手册页](http://ppp.samba.org/pppd.html)中 - 搜索“ip-up”。

要重新启动 pppd，请使用`linkname`参数设置已知的 pidfile 名称 ( `/var/run/ppp-name.pid`)。也使用该`persist`选项。当你想重启 pppd 时，发送`SIGHUP`信号。同样，这在手册页中有描述。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T06:57:03.290

你可以解析`/proc/net/route`.

# django - 一个非常简单的博客的最快方法是什么？

> ID：51311
> 
> 赞同：7
> 
> 时间：2008-09-09T06:54:32.937
> 
> 标签：django, blogs

我即将开始一个新项目，并想在一个非常简单的博客中记录它的开发。

我的要求是：

*   自托管在我基于 Gentoo 的 LAMP 堆栈上（这似乎排除了博主）
*   集成到基于 django 的网站中（如 www.myproject.com/about、www.myproject.com/blog 等，而不是 www.myproject.com 和 blog.myproject.com 上完全不同的网站）
*   很少或没有*特定于博客引擎的*学习曲线（不想仅仅为了博客而学习 API，但必须更深入地了解 Django 才能自己动手）根据到目前为止的答案，这有可能不包括 Wordpress

我是不是该

a) 安装博客引擎 X（请注明 X）

b) 使用 django 手动发布一种在我的网站上发布新条目和页面的方式，以按时间降序显示帖子

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-09T06:57:48.233

安装[WordPress](http://wordpress.org/)。它是最常见的引擎是有原因的。它是 PHP，但可以在您的环境中正常运行。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-09T10:07:18.387

**如果你是完美主义者，那就自己动手吧**。

*   这并不难
*   你学到了一些有用的东西
*   你会得到你想要的和需要*的*

请注意，您可能会陷入对抗垃圾评论、修复安全漏洞等的泥潭。但这可能是一个有趣的项目。

**如果您是实用型并准备面对一些集成**难题，请使用现有的引擎，如[WadcomBlog](http://vss.73rus.com/wadcomblog/) (Python) 或[PyBlosxom](http://pyblosxom.sourceforge.net/)，或完全不同的引擎，如 MovableType 或 WordPress。

这是一个简单的[Django 博客示例](http://www.rossp.org/blog/2006/jun/08/django-blog-redux/)，可以帮助您入门。

Phil Haack 撰写的[这篇文章](http://haacked.com/archive/2006/10/06/Rolling_Your_Own_Blog_Engine.aspx)滚动博客引擎的一些优点和缺点。

杰夫克罗夫特显然也[推出了自己](http://jeffcroft.com/blog/2006/may/02/django-non-programmers/)的产品。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-09T07:24:47.593

我最近尝试了 WordPress，非常失望。只要您不想定制任何东西，一切都很好。但是假设你想安装一个插件来处理 Markdown 编辑。麻烦开始了。WordPress 的插件架构被严重搞砸了。在 Markdown 的情况下，这意味着不存在好的解决方案。现有的插件是一系列（非常有据可查的）黑客攻击，它们会在硬盯着时分崩离析。

我从来没有打算为 WordPress 写一点代码，但在过去的几天里，我一直在深入研究 PHP，破解插件和 WordPress 核心，以使其适用于我的特殊场景（这真的不是那么特别，我只是一个完美主义者）。很遗憾，因为 WordPress 的文档不仅仅是零散的。我不再使用它了，我`grep`是为了功能并阅读源代码。总而言之，这是不太令人愉快的开源项目之一。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-09T07:16:14.417

您可以花费数小时甚至数天时间使用插件、主题等自定义 Wordpress... 我会使用 0 安装解决方案，例如博客 ( [https://www.blogger.com/start](https://www.blogger.com/start) )
您甚至可以使用我们自己的域如果你需要的话，用它命名。

编辑：另外，如果你被 slashdotted、digged 或 redditted，谷歌可以处理流量，你的服务器可能不能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T06:57:37.860

对我来说，[Wordpress](http://wordpress.org/)仍然是设置和使用最快和最简单的。它可以扩展到做几乎任何事情，或者你可以让它变得非常简单。在 PHP 上运行，但除非您想为其编写插件，否则您永远不需要编写代码

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T09:17:03.393

看看[Blosxom](http://www.blosxom.com/)。它是基于文件的，所以没有复杂的数据库。基本思想已经移植到不同的语言中，pyblosxom 是在 Python 中的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-09T09:33:55.240

我将 PyBlosxom 用于我的个人博客，如果您需要一些简约的东西，我认为它非常有用。部署很简单，因为您只需要 python 运行时和 cgi。不过，如果你打算使用它，你可能至少需要对 python 有一些基本的了解。

> 看看 Blosxom。它是基于文件的，所以没有复杂的数据库。基本思想已经移植到不同的语言中，pyblosxom 是在 Python 中的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-18T20:34:52.390

我在一个周末花了大约 6 个小时为我的个人博客编写了引擎，其中包含评论、标签、简化标记、站点地图、提要等。这很有趣，我学到了很多 Django。

如果您决定采用这种方式，请查看[通用视图](https://docs.djangoproject.com/en/1.4/ref/generic-views/)，这个 Django 功能将为您节省大量工作（并学习一些有用的技巧）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-09T09:14:46.190

我自己还没有尝试过（除了演示），但我已经为[Chyrp](http://chyrp.net)添加了书签，这样如果我需要建立一个快速简单的博客（就像你描述的那样），我可以试试这个。所以检查一下，可能对你来说是个不错的选择。

# java - 在 Java 中查找所有驱动器号

> ID：51320
> 
> 赞同：18
> 
> 时间：2008-09-09T07:01:14.577
> 
> 标签：java, windows

对于我正在做的一个项目。我需要在文件系统上寻找可执行文件。对于 UNIX 衍生产品，我假设用户在强大的 $PATH 变量中拥有该文件，但在 Windows 上没有这样的东西。

我可以安全地假设该文件在文件系统中最多有 2 层，但我不知道它将在什么驱动器上。我必须尝试所有驱动器，但我不知道如何列出所有可用驱动器（分配了一个字母）。

有什么帮助吗？

**编辑：**我知道有一个 %PATH% 变量，但它不像在 UNIX 系统中那样集成。例如，我正在寻找的应用程序是 OpenOffice。此类软件通常不在 %PATH% 中。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-09T07:08:30.783

[http://docs.oracle.com/javase/7/docs/api/java/io/File.html#listRoots()](http://docs.oracle.com/javase/7/docs/api/java/io/File.html#listRoots())

```
File[] roots = File.listRoots();
for(int i = 0; i < roots.length ; i++)
    System.out.println("Root["+i+"]:" + roots[i]); 
```

谷歌：列出驱动java，第一次点击:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-01T19:17:38.593

到处寻找可能会非常混乱。

看看 CD-ROM 驱动器，它会旋转起来。那可能会很吵。

查看网络驱动器，它可能非常慢。也许服务器已关闭，您可能需要等待几分钟，直到它超时。

也许（对于 Windows 机器）您应该只查看开始菜单。如果没有任何东西指向 OOo，它可能没有安装。如果是，则用户可能是高级用户，手动指出位置不会有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T07:07:58.617

Windows 确实有一个 PATH 环境变量。它具有与 Unix 不同的语法，因为它使用分号 (;) 作为分隔符而不是冒号 (:)，并且您必须注意可能包含空格的引号字符串。但是，它就在那里。

如果这个其他程序的安装程序将它自己的目录添加到 PATH 环境变量中，那么您可以依赖它。但是，正如您所提到的，Windows 安装程序通常不需要将应用程序路径添加到 PATH，因为它们会安装开始菜单快捷方式或其他东西。

对于 Java 中的驱动器号，一种方法是全部尝试，最多只有 24 个（C 到 Z）有用。或者，您可以掏出并运行“net use”并解析结果，尽管这有点混乱。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-01-19T09:22:24.767

使用 JNI。这非常适合 C++ 代码。您不仅可以列出所有驱动器，还可以获取相应的驱动器类型（可移动、本地磁盘或 cd-rom、dvd-rom...等）

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-09T07:04:28.733

当然[在 Windows 中](http://en.wikipedia.org/wiki/Environment_variable#System_path_variables)`PATH`有一个环境变量。

> > `%PATH%` 此变量包含一个以分号分隔的目录列表，命令解释器将在其中搜索可执行文件。等效于 UNIX $PATH 变量。

# web-applications - 如何为 webapps 的现场安装（最好是跨平台的）实施许可证管理？

> ID：51338
> 
> 赞同：6
> 
> 时间：2008-09-09T07:20:11.363
> 
> 标签：web-applications, licensing

我有一个在基于 Gentoo 的 LAMP 堆栈上运行的 Web 应用程序。我的客户将软件作为服务购买，我托管一切。但是，在客户自己的网络内有一些现场部署的需求。

目前，由于我托管系统，应用程序中没有内置许可证管理。我根据用户帐户和数据容量计费（它是一个用于计量数据的处理和分析应用程序），我只是设置客户支付的任何费用，而客户不能自己设置这些东西。即使没有现场安装，也应该改变它以获得更好的可扩展性。

我正在寻找一个许可证管理框架和/或您自己实施或在其他地方看到效果良好的典型方法。我的要求是：

*   “足够安全”而不是“军用级”
*   非常不突兀
*   防止许可证所有者在仅获得一个许可证时在多个工厂中运行系统
*   使用户账户数量和数据容量合理防篡改，易于升级/降级
*   在没有 Internet 连接的情况下工作（拥有一个完全独立的系统将是选择现场解决方案的要点），但如果在安装期间必须有一个临时连接可能是可以接受的

对于某些现场场景，可能需要某些特定的操作系统，通常是某些版本的 Windows Server，但各种 Linux 发行版也越来越受欢迎，尤其是在公共部门。

从用户的角度来看，我对 FogBugz 中的许可证管理很满意，从供应商的角度来看，Joel Spolsky 似乎很满意，而且它是跨平台的，所以它会作为我的一个很好的参考的目标。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T22:11:13.993

Don't. Every hour that you spend writing a license key system is an hour that you are not spending fixing bugs or adding features. By writing a license management system, you are spending resources in order to reduce the value of your product!

Copyright your code, have a lawyer and be ready to prosecute anyone who violates your copyright, and call it a day.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T19:44:40.727

我见过一家公司使用预构建的 linux VM 映像部署他们的现场 Web 系统。客户端在 VMWare 下运行它，您无需担心客户端系统上的实际操作系统。另外，他们不为运行 Web 服务器的实际 linux 系统提供登录名，因此最终用户实际上无法进入并修改任何内容。

我不确定他们如何处理许可限制，但他们在那里。每当客户端请求更多用户许可证时，可能会提供更新的 VM 映像。

尽管这并不能直接解决防止多个实例运行的需要。我想您总是可以根据系统配置进行某种激活密钥系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T07:23:48.717

我相信您可以在大多数操作系统上获得 cpu 的序列号；您可以使用它，毕竟如果他们移植 cpu 是否可以安全地假设旧机器将不再使用？

其次，可以使用 Web 服务来找出当前的数据容量以及客户已支付的费用。

# sql - 如何使用 LINQ to SQL 处理 IN 子查询？

> ID：51339
> 
> 赞同：55
> 
> 时间：2008-09-09T07:20:51.330
> 
> 标签：sql, linq, linq-to-sql

我有点坚持这一点。基本上我想在 LINQ to SQL 中执行类似以下 SQL 查询的操作：

```
SELECT f.* 
FROM Foo f
WHERE f.FooId IN (
    SELECT fb.FooId
    FROM FooBar fb
    WHERE fb.BarId = 1000
) 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-09-09T08:51:32.783

# 在 LINQ to SQL 中实现 IN 的一般方法

```
var q = from t1 in table1
        let t2s = from t2 in table2
                  where <Conditions for table2>
                  select t2.KeyField
        where t2s.Contains(t1.KeyField)
        select t1; 
```

# 在 LINQ to SQL 中实现 EXISTS 的一般方法

```
var q = from t1 in table1
        let t2s = from t2 in table2
                  where <Conditions for table2>
                  select t2.KeyField
        where t2s.Any(t1.KeyField)
        select t1; 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-09-09T08:39:47.273

看看[这篇文章](http://blog.wekeroad.com/2008/02/27/creating-in-queries-with-linq-to-sql)。基本上，如果你想得到IN的等价物，你需要先构造一个内部查询，然后使用Contains()方法。这是我的翻译尝试：

```
var innerQuery = from fb in FoorBar where fb.BarId = 1000 select fb.FooId;
var result = from f in Foo where innerQuery.Contains(f.FooId) select f;
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T07:26:53.377

```
from f in Foo
    where f.FooID ==
        (
            FROM fb in FooBar
            WHERE fb.BarID == 1000
            select fb.FooID

        )
    select f; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T07:25:42.083

尝试使用两个单独的步骤：

```
// create a Dictionary / Set / Collection fids first
var fids = (from fb in FooBar
            where fb.BarID = 1000
            select new { fooID = fb.FooID, barID = fb.BarID })
            .ToDictionary(x => x.fooID, x => x.barID);

from f in Foo
where fids.HasKey(f.FooId)
select f 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-06T16:58:49.437

// 首先创建一个 Dictionary / Set / Collection fids

[查找其他文章](http://www.doyouknow.in/How.aspx)

```
var fids = (from fb in FooBar
            where fb.BarID = 1000
            select new { fooID = fb.FooID, barID = fb.BarID })
            .ToDictionary(x => x.fooID, x => x.barID);

from f in Foo
where fids.HasKey(f.FooId)
select f 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T07:34:57.130

试试这个

```
var fooids = from fb in foobar where fb.BarId=1000 select fb.fooID
var ff = from f in foo where f.FooID = fooids select f 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T18:02:41.813

```
var foos = Foo.Where<br>
( f => FooBar.Where(fb.BarId == 1000).Select(fb => fb.FooId).Contains(f.FooId)); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-06T17:21:15.507

// 首先创建一个 Dictionary / Set / Collection fids

[查找其他文章](http://www.doyouknow.in/DoYouKnow/How.aspx)

```
var fids = (from fb in FooBar where fb.BarID = 1000 select new { fooID = fb.FooID, barID = fb.BarID }) .ToDictionary(x => x.fooID, x => x.barID);

from f in Foo where fids.HasKey(f.FooId) select f 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-01-23T07:32:35.993

```
from f in foo
where f.FooID equals model.FooBar.SingleOrDefault(fBar => fBar.barID = 1000).FooID
select new
{
f.Columns
}; 
```

# c# - 实现用户定义的显示顺序 UI

> ID：51342
> 
> 赞同：2
> 
> 时间：2008-09-09T07:24:12.167
> 
> 标签：c#, asp.net, visual-studio-2005

我有一个按特定顺序显示的产品列表。商店管理员可以通过将“热门”项目移动到列表顶部来重新分配显示顺序。**实现管理功能UI** [asp.net C#]的最佳方式是什么？Products 表有一个 [displayOrder(int)] 字段，用于确定显示顺序。

我正在寻找一些直观和简单的东西。

谢谢你。

ps 我想我没有说清楚，我正在寻找 UI 建议比什么都重要。

解决方案：ReorderList 效果很好，这篇[文章](http://weblogs.asp.net/justinsaraceno/archive/2008/02/22/reorderlist-with-objectdatasource.aspx)也有帮助。此外，请确保您的数据源中有 OldValuesParameterFormatString="{0}"。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T07:26:53.767

每个产品都需要一个 Rank 字段（也可以是 DisplayOrder 字段）。
当管理员增加或减少产品时，更新排名值。
当您需要列出产品时，请执行按 DESC 排名顺序排序的选择查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T07:40:54.793

使用 AJAX 你可以实现一个 Reoder 列表控件你可以在这里找到更多信息[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ReorderList/ReorderList.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ReorderList/ReorderList.aspx)

毛罗

[http://www.brantas.co.uk](http://www.brantas.co.uk/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T07:39:18.073

我正在使用“订单”列/属性来实现这一点，人们在其中输入数字，如 10、20、30（我有升序）。我有一个带有用于输入订单的文本框的项目列表，以及一个“应用订单”按钮，可将新值保存到数据库并在页面上重新排序/重新加载应用了新排序的项目。

我不禁止为两个项目输入相同的值，我按名称对它们进行排序作为第二个排序参数，或者如果无关紧要，将其留给数据库随意排序。我相信这样说是可以理解的，它似乎是一个每个人都容易理解的有序列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T07:39:18.713

如果可以修改数据库，请添加 IsHot 列。然后按 IsHot 和 DisplayOrder 排序（按该顺序）。这将使产品保持正确的顺序，并且“热”产品将冒泡到顶部。

# knowledge-management - 你如何开始知识转移？

> ID：51349
> 
> 赞同：14
> 
> 时间：2008-09-09T07:27:39.957
> 
> 标签：knowledge-management

您是否使用正式活动来让 IT 部门的人们交谈？就像在社交场所举行的**每月聚会、****内部维基/聊天**空间或只是一个定期的“信息市场”，其中包含您的员工为您的员工制作的一些**关于技术或项目的演示文稿？**您是邀请销售人员参加，还是仅限程序员参加？

你如何让人们参与这些活动？你允许他们把工作时间花在知识转移上吗？还是您将其理解为工作时间不可分割的一部分？

我想知道如何监控知识转移本身的进度。您如何在项目中发现关键的单人失败点？有几种方法可以避免它，例如人员交换或修复错误的“fifo”尝试。

*注意：*好的，这是一个非常嘈杂的问题，我希望在发表一些评论后修复它。很抱歉混淆了。

**编辑**：我个人的经验是，人们开始贡献的门槛非常高。看起来他们不会花（最少的）额外时间来编辑我们的 wiki，或者在下午花一个小时与开发人员讨论技术话题。就像人们不喜欢我们的 wiki、文档管理系统或会议一样。也许是因为它都是免费使用的，而不是管理层强迫的。但我不喜欢强迫人们参与其中——但这是正确的方式吗？

一个例子：我们的 wiki 包含有关项目的页面，告诉谁参与它以便在遇到问题时获得第一个联系。但是除了我和同事之外没有人在创建这个页面......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T07:45:33.970

我认为以上所有。但是你忘记了最重要的方法。

传递知识的最有效方式是让人们一起工作。您可能会考虑进行一对一的代码审查，甚至是结对编程，并将知识转移作为工作的一个组成部分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T08:27:00.580

知识转移和知识管理有一个缺点。他们似乎花费了很多：如果每个人都知道我所知道的，我还需要吗？我一直在让别人跟上进度，我从中得到了什么？

做这件事的最好方法就是做一个例子。分享你的知识；在 wiki 中，写博客，谈论它，让它易于访问，并谈论你从中获得的好处：更少的人来打断你问你的东西，因为他们甚至不用起床就能很容易地得到答案。并告诉他们你还在那里。

这与所有其他提到的事情实际上会胜出。还有一件事：在我离开后（我主动），我的一个雇主继续支付我工资的 1/3 一年，只是为了保持我的知识库正常运行。他必须吗？不，反正那是他的财产。但这激发了仍在为他工作的人们分享他们的知识。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T07:34:51.377

我认为这取决于您尝试转移的知识。我发现了以下内容：

技术知识：带有屏幕截图和简短演示的“如何指导” - 类似于您在会议上看到新功能的方式。这样做的额外好处是，当您离开公司时，您所拥有的一切都会记录在案。

解决问题：非正式讨论、简短的内部项目、经验教训和每个人都负责更新的内部常见问题解答系统。

软技能（人际交往能力）：社交会议/郊游/非正式活动等。

不过，衡量这一点会很困难，因为无论你如何转移你的知识，总会有不同程度的吸收，毕竟，仅仅因为我以一种方式做某事并不意味着它是正确的。另一位开发人员/设计师/经理可能有不同的方式来做同样的事情并获得相同的最终结果。

毛罗

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T08:01:45.350

在我的工作场所，我们使用维基。工作场所足够小（约 20 人），因此您可以随时询问参与特定项目最多的人，但是在询问“专家”之前，您应该先在 wiki 上进行搜索。如果您在 wiki 中找不到您的答案，那么您应该在与您的同事讨论后添加它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T08:16:25.487

一个字：午饭

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T09:24:32.953

你应该鼓励人们去做你想让他们做的事情。你应该“喂动物”。看看stackoverflow；你觉得徽章怎么样？为什么你认为这种奇妙的事物存在？感谢**自我**，没有什么是你做不到的。给他们徽章，真正的徽章，可穿戴的徽章。他们会带着幸福穿，他们会带着幸福去做。

顺便说一句，是的，我是老板 :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T10:21:41.957

虽然我还是一名学生，但当我在 12 个月前有工作经验时，公司内的所有 IT 部门（我在该地区拥有多个矿山的大公司“工作”）每天都会召开电话会议，每个员工会说他们一直在做什么等，然后谈论他们发现的新事物以及任何其他有趣的花絮。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-19T16:01:28.757

到目前为止我见过的几种方法：

*   Wiki 适用于内部知识，例如环境、项目特定主题。

*   开门政策

*   鼓励提问。

*   自愿介绍。找出谁拥有特殊知识，并让设置一个关于它的简短演示变得容易和有吸引力。

*   项目验尸文件。在项目完成或终止后，由项目团队外部人员主持的总结会议。

*   强制演示。

    *   上线时的项目演示。使用的技术等
    *   如果有人被派去参加会议，他应该有一个关于他看到的新技术的介绍。

# javascript - 如何在通过 JavaScript 加载图像时显示微调器

> ID：51352
> 
> 赞同：56
> 
> 时间：2008-09-09T07:33:36.790
> 
> 标签：javascript, jquery, dom

我目前正在开发一个 Web 应用程序，该应用程序有一个显示单个图表（.png 图像）的页面。在此页面的另一部分，有一组链接，当单击这些链接时，整个页面会重新加载并且看起来与之前完全相同，除了页面中间的图表。

我想要做的是，当在页面上单击链接时，页面上的图表会发生变化。这将大大加快速度，因为页面大约有 100kb 大，并且真的不想为了显示这个而重新加载整个页面。

我一直在使用以下代码通过 JavaScript 执行此操作，该 JavaScript 到目前为止有效

```
document.getElementById('chart').src = '/charts/10.png'; 
```

问题是当用户点击链接时，图表可能需要几秒钟的时间才会改变。这使用户认为他们的点击没有做任何事情，或者系统响应缓慢。

我想要发生的是显示一个微调器/颤动器/状态指示器，代替加载图像时的位置，因此当用户单击链接时，他们至少知道系统已经接受了他们的输入并正在做一些事情.

我尝试了一些建议，甚至使用 psudo 超时来显示微调器，然后轻弹回图像。

我有一个很好的建议是使用以下

```
<img src="/charts/10.png" lowsrc="/spinner.gif"/> 
```

这将是理想的，除了微调器明显小于正在显示的图表。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-09T18:51:31.887

我已经使用这样的东西来预加载图像，然后在图像完成加载时自动回调我的 javascript。您需要在设置回调之前检查完成，因为图像可能已经被缓存并且它可能不会调用您的回调。

```
function PreloadImage(imgSrc, callback){
  var objImagePreloader = new Image();

  objImagePreloader.src = imgSrc;
  if(objImagePreloader.complete){
    callback();
    objImagePreloader.onload=function(){};
  }
  else{
    objImagePreloader.onload = function() {
      callback();
      //    clear onLoad, IE behaves irratically with animated gifs otherwise
      objImagePreloader.onload=function(){};
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-09T18:54:32.787

您可以显示一个静态图像，该图像会产生[旋转轮的视觉错觉，例如这些](http://www.ritsumei.ac.jp/~akitaoka/saishin-e.html)。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-05-13T15:28:09.990

使用**jQuery的****load()**方法，可以轻松地在加载图像后立即执行某些操作：

 **```
$('img.example').load(function() {
  $('#spinner').fadeOut();
}); 
```

见：[http ://api.jquery.com/load-event/](http://api.jquery.com/load-event/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-09T08:00:13.903

使用 setTimeout() 函数（[更多信息](http://www.w3schools.com/js/js_timing.asp)）的强大功能 - 这允许您设置一个计时器以在将来触发函数调用，并且调用它**不会**阻止当前/其他函数的执行（异步）。

在图表图像上方放置一个包含微调器的 div，并将其 css 显示属性设置为无：

```
<div>&nbsp;<img src="spinner.gif" id="spinnerImg" style="display: none;" /></div> 
```

*当微调器被隐藏时，nbsp 会阻止 div 折叠。没有它，当您切换微调器的显示时，您的布局将“抽搐”*

```
function chartOnClick() {
  //How long to show the spinner for in ms (eg 3 seconds)
  var spinnerShowTime = 3000

  //Show the spinner
  document.getElementById('spinnerImg').style.display = "";

  //Change the chart src
  document.getElementById('chart').src = '/charts/10.png';

  //Set the timeout on the spinner
  setTimeout("hideSpinner()", spinnerShowTime);
}

function hideSpinner() {
  document.getElementById('spinnerImg').style.display = "none";
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-22T13:05:18.313

使用 CSS 将加载动画设置为图像容器的居中背景图像。

然后在加载新的大图时，首先将src设置为预加载的透明1像素gif。

例如

```
document.getElementById('mainimg').src = '/images/1pix.gif';
document.getElementById('mainimg').src = '/images/large_image.jpg';

```

加载 large_image.jpg 时，背景将通过 1pix 透明 gif 显示。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-05-25T06:32:57.110

基于 Ed 的回答，我希望看到类似的内容：

```
function PreLoadImage( srcURL, callback, errorCallback ) {
     var thePic = new Image();

     thePic.onload = function() {
          callback();
          thePic.onload = function(){};
     }

     thePic.onerror = function() {
          errorCallback();
     }
     thePic.src = srcURL;
} 
```

您的回调可以在适当的位置显示图像并处理/隐藏微调器，并且 errorCallback 可以防止您的页面“沙滩球”。所有事件驱动，没有计时器或轮询，而且您不必添加额外的 if 语句来检查图像是否在您设置事件时完成加载 - 因为它们是预先设置的，无论如何快速加载图像。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-10-02T04:42:00.480

我喜欢 @duddle 的 jquery 方法，但发现 load() 并不总是被调用（例如从 IE 的缓存中检索图像时）。我改用这个版本：

```
$('img.example').one('load', function() {
  $('#spinner').remove();
}).each(function() {
  if(this.complete) {
    $(this).trigger('load');
  }
}); 
```

这最多调用一次加载，如果已经完成加载，则立即调用。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-11-24T06:19:41.430

前段时间我写了一个 jQuery 插件来处理自动显示微调器[http://denysonique.github.com/imgPreload/](http://denysonique.github.com/imgPreload/)

查看它的源代码应该可以帮助您检测何时显示微调器并将其显示在加载图像的中心。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-09T07:42:27.097

将微调器放在与图表大小相同的 div 中，您知道高度和宽度，因此您可以使用相对定位将其正确居中。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-10T20:37:19.630

除了 lowsrc 选项，我还在' 容器`background-image`上使用了 a 。`img`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-06-21T09:45:48.560

请注意，如果图像 src 不存在（http 404 错误），也会调用回调函数。为避免这种情况，您可以检查图像的宽度，例如：

```
if(this.width == 0) return false; 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-09T08:24:26.390

@iAn 的解决方案对我来说看起来不错。我唯一要改变的是不使用 setTimeout，而是尝试挂钩图像“加载”事件。这样，如果图像的下载时间超过 3 秒，您仍然会得到微调器。

另一方面，如果下载时间较短，您将获得微调器的时间不到 3 秒。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-11-04T14:56:20.343

我会添加一些随机数字以避免浏览器缓存。

# .net - 基于 Licenses.licx 的 .Net 组件许可模型如何工作？

> ID：51363
> 
> 赞同：52
> 
> 时间：2008-09-09T07:49:56.720
> 
> 标签：.net

我遇到了多个使用许可方案的第三方 .Net 组件供应商。在评估副本上，组件显示为带有 nag-screen 或水印或一些此类指示器。在许可的机器上，会创建一个**Licenses.licx** - 看起来*只是*程序集全名/标识符。构建客户端程序集时必须包含此文件。

*   这个模型是如何工作的？从组件供应商和用户的角度来看。
*   .licx 文件有什么用途？是不是应该办理登机手续？*我们在签入错误/正确的 .licx 文件时遇到了许多问题，以及其他问题*

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-04-02T09:08:45.173

这是不正确的。licx 文件非常重要，它是构建宿主应用程序所必需的，其中嵌入了正确的许可证信息。因此，将 licx 文件也包含在源代码管理中至关重要。否则，在另一台机器上检查源代码的人将无法获得 licx 文件，并且构建可能会失败或没有 exe 中使用的组件的正确许可证信息。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-09T08:32:22.063

几乎所有关于 .Net 许可的内容都[在此处](http://www.developer.com/net/csharp/article.php/3074001)进行了解释。没必要重写，我想。

如果可以的话，最好从源代码管理中的项目中排除许可证文件。否则，编辑视觉组件可能会让人头疼。此外，不需要将许可证文件存储在源代码控制存储库中。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-11-30T22:02:25.790

这是一篇关于这个主题的好文章：[点击这里](http://www.textcontrol.com/en_US/blog/archive/20091015/)

为了部署带有 TX Text Control 等许可组件的应用程序，必须正确许可 EXE 文件。

.NET 许可机制建议将许可添加到 EXE - 调用程序集。

**---- 详细情况如何？**

如果将 TextControl 从 Visual Studio 工具箱拖放到表单中，Visual Studio 会创建一个 licenses.licx 文件并包含许可证信息。该文件与您的项目文件位于同一文件夹中。

**重要提示：licenses.licx 文件不包含许可证字符串本身。它只包含有关许可组件的信息**。如果是 TX 文本控件 (TXTextControl.TextControl)，则添加以下字符串：

```
TXTextControl.TextControl, TXTextControl, Version=15.0.700.500, Culture=neutral, PublicKeyToken=6b83fe9a75cfb638 
```

如您所见，它包含命名空间和控件名称、程序集版本、文化信息和唯一的公钥标记。基于该信息，许可证编译器 (lc.exe) 编译将嵌入到可执行程序集中的真实许可证字符串。lc.exe 是 Visual Studio 在构建过程中使用的 .NET Framework SDK 的一个小实用程序。

**---- 如果我在用户控件中使用 TX 文本控件怎么办？**

在这种情况下，您还需要将许可证添加到主可执行文件。因此，您可以简单地将 TextControl 拖放到主项目的虚拟表单中，以便自动添加 licenses.licx 文件和引用。

After that, you can remove the TextControl from that form again. Or you can simply copy or create a licenses.licx file to the main project folder. In this case, you need to add a reference to TX Text Control manually as well.

# io - DataInputStream.skipBytes(n) 什么时候不能跳过 n 个字节？

> ID：51380
> 
> 赞同：10
> 
> 时间：2008-09-09T08:19:01.533
> 
> 标签：io, java

[DataInput.skipBytes](http://java.sun.com/j2se/1.4.2/docs/api/java/io/DataInput.html#skipBytes(int))的Sun 文档指出它“尝试从输入流中跳过 n 个字节的数据，丢弃跳过的字节。但是，它可能会跳过一些较小的字节数，可能为零。这可能是由于多种条件中的任何一种；在跳过 n 个字节之前到达文件末尾只是一种可能性。”

1.  除了到达文件末尾，为什么`skipBytes()`不能跳过正确的字节数？（`DataInputStream`我使用的将包装 a`FileInputStream`或 a `PipedInputStream`。）

2.  如果我确实想跳过 n 个字节并抛出一个`EOFException`如果这导致我转到文件末尾，我应该使用`readFully()`并忽略生成的字节数组吗？或者，还有更好的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T08:33:02.903

1）可能没有那么多数据可供读取（管道的另一端可能还没有发送那么多数据），并且实现类可能是非阻塞的（即它只会返回它所能返回的，而不是等待足够的数据来满足请求）。

但是，我不知道是否有任何实现实际上以这种方式运行，但该接口旨在允许它。

另一种选择只是文件在读取过程中被关闭。

2) readFully() （总是等待足够的输入，否则失败）或在循环中调用skipBytes()。我认为前者可能更好，除非阵列真的很大。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-20T12:41:28.303

我今天遇到了这个问题。它正在读取虚拟机上的网络连接，所以我想可能有很多原因导致这种情况发生。我通过简单地强制输入流跳过字节直到它跳过我想要的字节数来解决它：

```
int byteOffsetX = someNumber; //n bytes to skip
int nSkipped = 0;

nSkipped = in.skipBytes(byteOffsetX);
while (nSkipped < byteOffsetX) {
    nSkipped = nSkipped + in.skipBytes(byteOffsetX - nSkipped);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T13:08:43.990

事实证明，readFully() 增加了比我愿意忍受的更多的性能开销。

最后我妥协了：我调用了一次 skipBytes()，如果返回的字节数少于正确的字节数，我就调用 readFully() 来获取剩余的字节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T11:08:00.397

乔什·布洛赫最近公布了这一点。这是一致的， InputStream.read 不能保证读取尽可能多的字节。但是，作为 API 方法，它是完全没有意义的。InputStream 也应该有 readFully。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-16T13:18:21.383

根据文档，`readFully()`这是唯一有效且*保证*有效的方法。

实际的 Oracle 实现是......令人困惑：

```
public final int skipBytes(int n) throws IOException {
    int total = 0;
    int cur = 0;

    while ((total<n) && ((cur = (int) in.skip(n-total)) > 0)) {
        total += cur;
    }

    return total;
} 
```

为什么在与具有基本相同的合同`skip()`时循环调用？如果以下两个都成立，那么以这种方式实现它是非常有意义的：保证*仅*在 EOF 上跳过少于请求的内容，*并*保证尽可能跳过至少一个字节（就像这样做一样）。`skipBytes()``skip()``skipBytes()` **`skip()``read()`**

 **更糟糕的是，它`skip()`实际上是使用 实现的`read()`，这意味着它实际上*完成*了这项工作。它只是不*承诺*这样做，这意味着其他实现可能无法这样做（如果在未来的版本中更改，即使是 Oracle 也可能在未来失败）。

为了完全安全： call `readBytes()`，如果它不起作用，分配一个临时缓冲区并调用`readFully()`（如果需要跳过任意大量数据的能力，请在此处使用循环）。

另一方面，`skipBytes()`循环调用是没有意义的。至少在 Oracle 实现中，因为它已经是一个循环。

# java - 所有的 Java 小程序都去哪儿了？

> ID：51390
> 
> 赞同：55
> 
> 时间：2008-09-09T08:30:38.120
> 
> 标签：java, applet

在 java 还年轻的时候，人们对写小程序很兴奋。他们很酷，很受欢迎，有一段时间。现在，我再也见不到他们了。相反，我们有 flash、javascript 和大量其他 Web 应用程序构建技术。

为什么网站不再使用 java applet？

我也很好奇：从历史上看，你认为为什么会发生这种情况？有什么不同的方法可以让 Java 小程序保持活力？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-09T08:39:12.530

我认为 Java 小程序被 Flash 和 ActionScript（无意的双关语）所掩盖，对于当时使用的 Java 小程序（动画 + 有状态的应用程序）更容易使用。

Flash 在这方面的成功反过来归功于其更小的文件大小，以及受益于 Sun 与 Microsoft 的诉讼，这导致 Microsoft 在 Netscape 消亡和 IE 占据主导地位的时候从 Internet Explorer 中删除了 MSJVM。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-09T08:46:25.727

1) AWT 为可怕的 UI 设计。Swing 对此进行了改进，但为时已晚，因为...
2) 微软在浏览器中放弃了对 Java 的支持（其专有的 MSJVM），在此之前，它只支持它发布的最后一个版本，大约是 JDK 1.1兼容的。
3）所以今天你不能确定一个小程序会在大多数非开发人员机器上运行，不像闪存。

顺便说一句，ActiveX 也是如此。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-19T18:42:48.307

对于它的价值，Sun 再次将资金和资源投入到小程序中。他们在[JDK 1.6.10](http://java.sun.com/developer/technicalArticles/javase/java6u10/)中进行了一些非常显着的改进，以减轻过去展示的许多“笨拙”小程序。例如，通过此更新，您可以在加载小程序时显示自己的自定义加载图像/动画，并且该插件已被大量使用以提高性能。

他们还着手与 Flash 和 Silverlight - [JavaFX](http://www.sun.com/software/javafx/)直接竞争。

市场是否会对此做出反应还有待观察，但鉴于 Flash 在市场上的主导地位，这对 Sun 而言无疑是一个令人着迷的举动。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-09T08:40:01.907

等到 Java 的 GUI API 不再那么糟糕时，每个人都在使用 Flash。即使在今天，Java 在制作精美图形方面也远不及 Flash。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-09T08:44:30.910

我认为这是因为 java 是“真实的”，即。通用语言。要制作小程序，您必须编写代码，并且没有任何快捷方式。

现在 Flash 等已经出现，您几乎可以通过为您的网站制作很酷的动画来随意放置。这是一个低得多的入门门槛——您不必知道如何编程即可使 Flash 动画正常工作。因此闪存激增，Java 小程序几乎不再使用。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-09T08:45:25.573

我认为小程序是微软和 Sun 之战中的附带损害。

起初，JVM 加载速度非常慢，并且需要太多内存。然后，当计算能力的提高使 JVM 成为可能时，Sun 努力尝试控制 Java 的所有事物：

> 作为 Sun 在 3 月对 Microsoft 提起的另一项私人反垄断诉讼的一部分，Sun 寻求初步禁令，要求 Microsoft 在 Windows XP 操作系统中包含当前的 Java 虚拟机 (JVM)。微软表示，本周包含 JVM 的决定是与 Sun 的最新法律纠葛的直接结果，但微软计划在 2004 年 1 月 1 日之后取消对 Windows 中 Java 的支持。[微软逆转，将在 Windows XP 中包含 Java VM - 目前](http://www.crn.com/it-channel/18828525)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-09T16:25:01.897

他们花了很长时间才加载并开始在浏览器中运行，然后对于很多人来说他们没有工作。当他们最终加载时，界面又丑又笨重。我认为糟糕的用户体验是让小程序过时的一大步。

因此，要回答最初的问题，我有一个自己的问题——你问“为什么网站不再使用 java applet”，而我的回答是“为什么会有人想要？”

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-09T08:38:42.297

我在学术环境中经常看到它们（托管在部门或教师网站上），但你说得对，它们不是很受欢迎。

但是，请记住，Java 的伟大承诺已经实现。我们有 Flash、Java Applet、Silverlight 和不断改进的 JavaScript 框架。

现在，如果我添加个人意见 - 我认为 Java 小程序不优雅。它们往往看起来很丑陋，Java 运行时在操作系统中的存在广为人知（就运行时视觉效果、更新和丑陋的安装程序而言）。Flash 的富媒体环境和透明（且无处不在）的部署要好得多。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-09T08:36:38.840

人们仍然使用小程序。但你是对的，那里有很多不同的解决方案。例如，看看[javafx](http://java.sun.com/javafx/)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-09T08:38:17.727

我认为兼容性问题是一个大问题。最值得注意的是 IE 和 Microsoft 的 Java VM，它们并没有像以前那样符合标准。

即使使用 Sun JVM，您也可能会遇到问题。我有两个第 3 方 Applet 需要不同版本的 Java，这会导致各种问题，这让我很开心。[Sun 已尝试通过用Java Web Start](http://java.sun.com/javase/technologies/desktop/javawebstart/index.jsp)替换 Applets 来解决这个问题， Java Web Start会在浏览器中为您提供一个链接，该链接在它自己的窗口中而不是在浏览器内部启动应用程序。（理论上，使用 JWS，您可以使用不同的虚拟机拥有不同的应用程序，但它似乎对我来说从来没有像它应该的那样工作。）

JavaScript 的进步也使得开发更丰富的网页成为可能，所以很多过去只能在 Applet 中完成的事情现在可以通过 AJAX 完成。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-02T11:39:50.540

首先，他们没有走。您仍然可以在 Web 上找到很多小程序，很多人使用它们专门用于演示算法等。
优点：可以利用现有的库（数学、物理、排序、图形等），并且比 Flash 更快。
不便之处：针对最近的 JVM 可能有风险（尽管 Sun 在自动更新方面做得很好，看起来很多人已经在使用 Java 1.6），加载时间有点慢（尽管已经取得了很大的进展） .

你仍然可以找到很多游戏小程序，比如[Bookworm](http://www.en.zylom.com/game/118/bookworm.html "书呆子")，还有一个额外的优势，也许是已经完成了在手机上运行它们的部分工作......

其次，我可以预测对 JavaFX 的兴趣会重新获得。类固醇上的小程序，能够打破“小程序丑陋”的传说...... :-)

最后，像[Processing](http://processing.org/ "覆盖")这样的库让创建图形密集型小程序变得超级容易，你可以在网上找到很多，例如。在[OpenProcessing](http://openprocessing.org/ "开放式处理")上，最差的（编程初学者）几乎是最好的！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-09T08:35:20.467

我想知道JVM实际上有多广泛？在 Flash 的情况下，IE5 预装了它，给它一个庞大的自动用户群。但除非 JVM 包含在操作系统安装中，否则用户不会拥有它。我想作为开发人员，您的目标是最大的安装基础，这意味着选择 Flash 而不是 Java。

到处都有 Java 小程序；虽然绝对不普遍。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-09T08:36:27.157

我相信正是他们的丑陋让他们远离了现代网络。flash 带来了设计，javascript 带来了在客户端上制作一些很酷的东西的便捷方式。作为浏览器中的一个盒子（就像一个闪光灯，但更丑陋），applet 技术被放弃了。

实际上，唯一可能遗漏的是在 Web 内部进行“客户端-服务器”类型的通信的可能性，因为 java 小程序可以有一个有状态的连接。另一方面，您必须在另一侧放置一些服务器并为其打开一个端口，这对于共享托管环境来说是太多的家务活。

小程序仍然存在于一些不同的区域，例如道路、隧道、发电厂等的控制中心。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2013-09-19T17:36:07.067

人们仍在使用小程序，至少对于我正在合作的公司而言。这些小程序主要由内部用户使用。

我觉得小程序有它的好处，作为在服务器端使用Java的公司，很可能会拥有大量精通Java的人才。

尽管 Javascript、HTML/CSS 或 flash 等其他技术可能更流行或更奇特，但可以更好地利用人才库来使用 Java 小程序创建 Web 应用程序，因为这是一种他们已经通过与服务器端的东西。

Java 人才库使用 Java 小程序解决方案以比任何其他技术更高的准确性来交付变更请求可能会更快。

有时，技术解决方案中最重要的是它的功能以及需要为他们提供支持的人员对变化做出反应的速度。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-09T08:40:43.900

JVM 非常普遍，尤其是在企业世界中，至少在我工作过的地方，总是安装了 JVM。

我目前正在开发一个 Java Applet，但总的来说，除非必须，否则我永远不会使用 Applet。但话又说回来，我也不会使用 Flash 或 Silverlight。小程序的加载时间很慢，并且在网页中显得格格不入。此外，Macromedia/Adobe 已经超越了优秀的小程序。

# .net - 您可以加载.Net 表单作为控件吗？

> ID：51407
> 
> 赞同：7
> 
> 时间：2008-09-09T08:45:43.607
> 
> 标签：.net, winforms

我想通过反射将桌面应用程序加载为另一个应用程序中的控件。

我正在反映的应用程序是一个遗留应用程序 - 我无法对其进行更改。

我可以动态访问表单，但不能将其作为控件加载。

在 .Net Form 中展开 Control，我可以将反射的 Form 分配为 Control，但它会引发运行时异常。

表单不能作为控件加载。

有没有办法将表单转换为控件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-09T09:06:08.193

是的，这很好用。我现在正在开发一个 .NET 应用程序，它将表单加载到主机表单的面板中。

相关片段：

```
// setup the new form
form.TopLevel = false;
form.FormBorderStyle = FormBorderStyle.None;
form.Dock = DockStyle.Fill;
form.Show ( );

// add to the panel's list of child controls
panelFormHost.Controls.Add ( form ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T09:01:14.490

您应该能够将表单添加到父表单的控件集合中......

看这里： [http://vbcity.com/forums/topic.asp?tid=30539](http://vbcity.com/forums/topic.asp?tid=30539)

如果失败，请尝试使用适配器模式创建一个容器，其中包含您的旧表单，然后将其加载到 MDI 中？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T09:10:50.067

你得到什么异常？控件本身是否有可能给出异常（与框架相比）？也许在原始应用程序中调用了一些没有被调用的 Main 函数？

# python - 在python中传递命名变量参数

> ID：51412
> 
> 赞同：12
> 
> 时间：2008-09-09T08:46:51.920
> 
> 标签：python, variadic-functions

假设我有以下方法：

```
def methodA(arg, **kwargs):
    pass

def methodB(arg, *args, **kwargs):
    pass 
```

在methodA中，我希望调用methodB，传递kwargs。但是，似乎如果我定义`methodA`如下，第二个参数将作为位置参数而不是命名变量参数传递。

```
def methodA(arg, **kwargs):
    methodB("argvalue", kwargs) 
```

如何确保 methodA 中的 **kwargs 作为 **kwargs 传递给 methodB？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-09T08:50:34.143

将星号放在 kwargs 变量之前。这使得 Python 将变量（假定为字典）作为关键字参数传递。

```
methodB("argvalue", **kwargs) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T15:28:30.033

顺便说一句：当使用函数而不是方法时，您还可以使用 functools.partial：

```
import functools

def foo(arg, **kwargs):
    ...

bar = functools.partial(foo, "argvalue") 
```

最后一行将定义一个函数“bar”，当调用该函数时，将调用 foo 并将第一个参数设置为“argvalue”，并且所有其他函数都刚刚传递：

```
bar(5, myarg="value") 
```

将会通知

```
foo("argvalue", 5, myarg="value") 
```

不幸的是，这不适用于方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T08:49:02.397

一些实验，我想出了这个：

def methodA(arg, **kwargs): methodB("argvalue", **kwargs)

现在似乎很明显...

# ruby - 如何在 Ruby 中获取 Fixnum 的以 10 为底的对数？

> ID：51420
> 
> 赞同：2
> 
> 时间：2008-09-09T08:56:23.287
> 
> 标签：ruby, math, logarithm

我想使用 Ruby 获取 Fixnum 的以 10 为底的对数，但发现未定义 n.log 或 n.log10。Math::log 已定义，但使用的基数不同于 10。

获得 Fixnum 以 10 为底的对数的最简单方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-09T09:00:35.553

有

```
Math::log10 (n) 
```

并且还有一个对数的性质`logx(y) = log(y)/log(x)`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T08:59:00.067

阅读模块 Math 的文档，答案非常明显：

```
Math::log10(n) 
```

这给出了 n 的以 10 为底的对数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T08:59:16.790

[Math.log10](http://www.ruby-doc.org/core-1.8.7/classes/Math.html#M001197) (numeric) => float 返回以 10 为底的对数

# c# - 在 TextBox 中显示来自 XMLDataSource 的数据

> ID：51429
> 
> 赞同：0
> 
> 时间：2008-09-09T09:02:17.063
> 
> 标签：c#, xmldatasource

谁能给我一些关于如何使用代码（C#）在文本框中显示 XPath 查询结果的指示？应用 XPath 查询后，我的数据源*似乎*（重新）正确绑定，但我找不到如何获取结果数据。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T12:09:10.593

XMLDataSource 旨在与数据绑定控件一起使用。ASP.NET 的 TextBox 不是数据绑定控件。所以要完成你想要的，你要么必须找到一个带有数据绑定的文本框控件，要么以其他方式显示结果。

例如，您可以使用[Repeater 控件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeater.aspx)并为其创建自己的呈现模板。

```
<asp:Repeater id="Repeater1" runat="server" datasource="XMLds">
  <ItemTemplate>
    <input type="text" value="<%# XPath("<path to display field>")%>" />
  </ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T09:52:53.057

如果能够给你一个体面的答案，更多的信息会很好。您是否有任何可以在此处发布的现有代码片段？

一般的想法是使用 XmlDataSource.XPath 属性作为 XmlDataSource.Data 属性的过滤器。您是否尝试在文本框中显示 Data 道具的内容？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T10:12:49.030

根据 DropDownList 中的选择，当 SelectedIndexChanged 事件触发时，XMLDataSource 对象的 XPath 会更新：

```
protected void ddl_SelectedIndexChanged(object sender, EventArgs e)
{
    XMLds.XPath = "/controls/control[@id='AuthorityType']/item[@text='" + ddl.SelectedValue + "']/linkedValue";
    XMLds.DataBind();
} 
```

XPath 字符串很好，我可以输出并测试它是否正常工作并解析到正确的节点。我遇到的问题是获取应该存储在 XmlDataSource 中的数据；具体来说，获取数据并将其输出到 TextBox 中。我希望能够将其作为上述功能的一部分，即

```
protected void ddl_SelectedIndexChanged(object sender, EventArgs e)
{
    XMLds.XPath = "/controls/control[@id='AuthorityType']/item[@text='" + ddl.SelectedValue + "']/linkedValue";
    XMLds.DataBind();
    myTextBox.Text = <FieldFromXMLDataSource>;
} 
```

感谢您的时间。

# c++ - 如何在非托管 C++ 应用程序中托管许可的 .Net 控件？

> ID：51436
> 
> 赞同：3
> 
> 时间：2008-09-09T09:08:55.847
> 
> 标签：c++, .net, unmanaged

我需要在纯非托管 C++ 应用程序中托管和运行托管控件。这该怎么做？

运行未经许可的控件通常很简单：

```
if (SUCCEEDED(ClrCreateManagedInstance(type, iid, &obj)))
{
    // do something with obj
} 
```

然而，当使用许可控件时，我们需要以某种方式将 .licx 文件嵌入到项目中（参考[应用程序许可](http://www.developer.com/net/net/article.php/11087_3074001_2)）。在非托管 C++ 应用程序中，必要的胶水似乎不起作用。lc.exe 工具应该能够将许可证作为程序集资源嵌入，但是我们没有挥动正确的调用，或者它静默失败。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T09:30:04.687

答案取决于您使用的特定组件。请联系您的组件服务台或阅读有关部署其组件所需的文档。**基本上，组件开发人员可以自由地实施他们认为合适**
的许可。使用 .licx 文件，组件需要能够通过 GetKey 和 IsValidKey（在您发布的链接中解释）执行开发人员希望执行的任何操作。因此，如果 GetKey 在组件目录中检查 .licx 文件 - 您只需要确保其存在即可。*AFAIK 客户端程序集除了实例化控件之外不需要做任何事情。*

 ***此外，如果您发布组件的名称和您正在使用的 lc.exe 命令，人们可以看看..

# java - 如何获取文件的媒体类型（MIME 类型）？

> ID：51438
> 
> 赞同：370
> 
> 时间：2008-09-09T09:11:06.603
> 
> 标签：java, mime

如何使用 Java 从文件中获取媒体类型（MIME 类型）？到目前为止，我已经尝试过 JMimeMagic 和 Mime-Util。第一个给了我内存异常，第二个没有正确关闭它的流。

您将如何探测文件以确定其实际类型（不仅仅是基于扩展名）？

* * *

## 回答 #1

> 赞同：343
> 
> 时间：2012-01-23T14:49:23.020

在 Java 7 中，您现在可以只使用[`Files.probeContentType(path)`](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType%28java.nio.file.Path%29).

* * *

## 回答 #2

> 赞同：233
> 
> 时间：2009-05-11T12:21:22.840

很遗憾，

```
mimeType = file.toURL().openConnection().getContentType(); 
```

不起作用，因为这种 URL 的使用会导致文件被锁定，例如，它是不可删除的。

但是，你有这个：

```
mimeType= URLConnection.guessContentTypeFromName(file.getName()); 
```

还有以下内容，它的优点是超越了仅仅使用文件扩展名，并查看了内容

```
InputStream is = new BufferedInputStream(new FileInputStream(file));
mimeType = URLConnection.guessContentTypeFromStream(is);
 //...close stream 
```

但是，正如上面的评论所建议的，内置的 mime 类型表非常有限，不包括例如 MSWord 和 PDF。所以，如果你想概括，你需要超越内置库，使用例如 Mime-Util（这是一个很棒的库，同时使用文件扩展名和内容）。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2017-02-14T15:24:20.833

使用[Apache Tika](http://tika.apache.org)，您只需要**三行代码**：

```
File file = new File("/path/to/file");
Tika tika = new Tika();
System.out.println(tika.detect(file)); 
```

如果您有一个 groovy 控制台，只需粘贴并运行此代码即可使用它：

```
@Grab('org.apache.tika:tika-core:1.14')
import org.apache.tika.Tika;

def tika = new Tika()
def file = new File("/path/to/file")
println tika.detect(file) 
```

请记住，它的 API 很丰富，它可以解析“任何东西”。从 tika-core 1.14 开始，您拥有：

```
String  detect(byte[] prefix)
String  detect(byte[] prefix, String name)
String  detect(File file)
String  detect(InputStream stream)
String  detect(InputStream stream, Metadata metadata)
String  detect(InputStream stream, String name)
String  detect(Path path)
String  detect(String name)
String  detect(URL url) 
```

有关更多信息，请参阅[apidocs](http://tika.apache.org/1.14/api/)。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-12-14T17:02:50.520

JAF API 是 JDK 6 的一部分。查看`javax.activation`包。

最有趣的类是`javax.activation.MimeType`- 一个实际的 MIME 类型持有者 - 和`javax.activation.MimetypesFileTypeMap`- 其实例可以将 MIME 类型解析为文件的 String 的类：

```
String fileName = "/path/to/file";
MimetypesFileTypeMap mimeTypesMap = new MimetypesFileTypeMap();

// only by file name
String mimeType = mimeTypesMap.getContentType(fileName);

// or by actual File instance
File file = new File(fileName);
mimeType = mimeTypesMap.getContentType(file); 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2013-05-18T16:14:54.453

[Apache Tika](https://tika.apache.org/)在[tika-core](https://search.maven.org/artifact/org.apache.tika/tika-core)中提供了基于流前缀中的魔法标记的 mime 类型检测。`tika-core`不获取其他依赖项，这使其与当前未维护的[Mime Type Detection Utility](http://sourceforge.net/projects/mime-util/)一样轻量级。

简单的代码示例（Java 7），使用变量`theInputStream`和`theFileName`

```
try (InputStream is = theInputStream;
        BufferedInputStream bis = new BufferedInputStream(is);) {
    AutoDetectParser parser = new AutoDetectParser();
    Detector detector = parser.getDetector();
    Metadata md = new Metadata();
    md.add(Metadata.RESOURCE_NAME_KEY, theFileName);
    MediaType mediaType = detector.detect(bis, md);
    return mediaType.toString();
} 
```

请注意，`MediaType.detect(...)`不能直接使用（[TIKA-1120](https://issues.apache.org/jira/browse/TIKA-1120)）。[https://tika.apache.org/1.24/detection.html](https://tika.apache.org/1.24/detection.html)提供了更多提示。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2012-12-15T06:23:39.707

如果您是 Android 开发人员，您可以使用实用程序类`android.webkit.MimeTypeMap`将 MIME 类型映射到文件扩展名，反之亦然。

以下代码段可能会对您有所帮助。

```
private static String getMimeType(String fileUrl) {
    String extension = MimeTypeMap.getFileExtensionFromUrl(fileUrl);
    return MimeTypeMap.getSingleton().getMimeTypeFromExtension(extension);
} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2011-08-01T13:34:59.857

来自[玫瑰印地亚](http://www.roseindia.net/java/java-get-example/get-mime-type.shtml)：

```
FileNameMap fileNameMap = URLConnection.getFileNameMap();
String mimeType = fileNameMap.getContentTypeFor("alert.gif"); 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2013-09-05T15:20:30.407

**如果你被 java 5-6 卡住了，**那么这个来自[servoy开源产品](https://github.com/Servoy/servoy-client/blob/e7f5bce3c3dc0f0eb1cd240fce48c75143a25432/servoy_shared/src/com/servoy/j2db/util/MimeTypes.java#L34)的实用程序类。

你只需要这个功能

```
public static String getContentType(byte[] data, String name) 
```

它探测内容的第一个字节并根据该内容而不是文件扩展名返回内容类型。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2013-06-25T16:07:42.463

> 我只是想知道大多数人如何从 Java 文件中获取 mime 类型？

我已经发布了我的[SimpleMagic](http://256stuff.com/sources/simplemagic/) Java 包，它允许从文件和字节数组中确定内容类型（mime 类型）。它旨在读取和运行 Unix file(1) 命令魔法文件，这些文件是大多数 ~Unix OS 配置的一部分。

我尝试了 Apache Tika，但它具有*大量*依赖项，`URLConnection`不使用文件的字节，而且`MimetypesFileTypeMap`只查看文件名。

使用 SimpleMagic，您可以执行以下操作：

```
// create a magic utility using the internal magic file
ContentInfoUtil util = new ContentInfoUtil();
// if you want to use a different config file(s), you can load them by hand:
// ContentInfoUtil util = new ContentInfoUtil("/etc/magic");
...
ContentInfo info = util.findMatch("/tmp/upload.tmp");
// or
ContentInfo info = util.findMatch(inputStream);
// or
ContentInfo info = util.findMatch(contentByteArray);

// null if no match
if (info != null) {
   String mimeType = info.getMimeType();
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2017-09-25T14:03:28.770

用我的 5 美分筹码：

**总长，博士**

我使用[MimetypesFileTypeMap](https://docs.oracle.com/javase/7/docs/api/javax/activation/MimetypesFileTypeMap.html)并将任何不存在且我特别需要的 mime 添加到 mime.types 文件中。

*现在，长读：*

首先，MIME 类型列表*很大*，请参见此处：[https ://www.iana.org/assignments/media-types/media-types.xhtml](https://www.iana.org/assignments/media-types/media-types.xhtml)

我喜欢先使用JDK提供的标准工具，如果不行，我会去找别的东西。

**根据文件扩展名确定文件类型**

从 1.6 开始，Java 具有 MimetypesFileTypeMap，正如上面的答案之一所指出的那样，它是确定 mime 类型的最简单方法：

```
new MimetypesFileTypeMap().getContentType( fileName ); 
```

在它的普通实现中，这并没有多大作用（即它适用于.html，但不适用于.png）。但是，添加您可能需要的任何内容类型都非常简单：

1.  在项目的 META-INF 文件夹中创建名为“mime.types”的文件
2.  为您需要的每种 mime 类型添加一行，默认实现不提供（有数百种 mime 类型，并且列表随着时间的推移而增长）。

png 和 js 文件的示例条目为：

```
image/png png PNG
application/javascript js 
```

对于 mime.types 文件格式，请在此处查看更多详细信息：[https ://docs.oracle.com/javase/7/docs/api/javax/activation/MimetypesFileTypeMap.html](https://docs.oracle.com/javase/7/docs/api/javax/activation/MimetypesFileTypeMap.html)

**从文件内容确定文件类型**

从 1.7 开始，Java 具有[java.nio.file.spi.FileTypeDetector ，它定义了一个标准 API，用于以](http://docs.oracle.com/javase/7/docs/api/java/nio/file/spi/FileTypeDetector.html)*特定于实现的方式*确定文件类型。

要获取文件的 mime 类型，您只需使用[Files](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#probeContentType(java.nio.file.Path))并在代码中执行此操作：

```
Files.probeContentType(Paths.get("either file name or full path goes here")); 
```

API 定义提供了支持从文件名或文件内容（魔术字节）确定文件 mime 类型的工具。这就是为什么[probeContentType()](http://docs.oracle.com/javase/7/docs/api/java/nio/file/spi/FileTypeDetector.html#probeContentType(java.nio.file.Path))方法会抛出 IOException，以防此 API 的实现使用提供给它的 Path 来实际尝试打开与其关联的文件。

同样，这个（JDK 附带的）的普通实现还有很多不足之处*。*

在遥远星系中的某个理想世界中，所有这些试图解决文件到mime-type问题的库都将简单地实现[java.nio.file.spi.FileTypeDetector](http://docs.oracle.com/javase/7/docs/api/java/nio/file/spi/FileTypeDetector.html)，您将放入首选实现库的 jar文件到你的类路径中，就是这样。

在现实世界中，您需要 TL、DR 部分，您应该找到名称旁边有最多星号的库并使用它。对于这种特殊情况，我不需要一个（还;））。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-09-21T17:03:51.317

我尝试了几种方法来做到这一点，包括@Joshua Fox 所说的第一种方法。但是有些人无法识别常见的模仿类型，例如 PDF 文件，而其他人则无法信任假文件（我尝试使用扩展名更改为 TIF 的 RAR 文件）。正如@Joshua Fox 以肤浅的方式所说，我发现的解决方案是使用[MimeUtil2](https://mvnrepository.com/artifact/eu.medsea.mimeutil/mime-util/2.1.2)，如下所示：

```
MimeUtil2 mimeUtil = new MimeUtil2();
mimeUtil.registerMimeDetector("eu.medsea.mimeutil.detector.MagicMimeMimeDetector");
String mimeType = MimeUtil2.getMostSpecificMimeType(mimeUtil.getMimeTypes(file)).toString(); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-02-23T14:16:41.323

这是我发现的最简单的方法：

```
byte[] byteArray = ...
InputStream is = new BufferedInputStream(new ByteArrayInputStream(byteArray));
String mimeType = URLConnection.guessContentTypeFromStream(is); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-05-10T18:14:47.530

阿帕奇蒂卡。

```
<!-- https://mvnrepository.com/artifact/org.apache.tika/tika-parsers -->
<dependency>
    <groupId>org.apache.tika</groupId>
    <artifactId>tika-parsers</artifactId>
    <version>1.24</version>
</dependency> 
```

和两行代码。

```
Tika tika=new Tika();
tika.detect(inputStream); 
```

下面的截图

[![在此处输入图像描述](https://i.stack.imgur.com/zGTrB.png)](https://i.stack.imgur.com/zGTrB.png)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-12-29T18:52:30.053

简单和最佳选项从文件位置检索内容 mime 类型。

**使用这个进口**

```
import java.nio.file.Files;
import java.nio.file.Path; 
```

**代码**

```
String type = Files.probeContentType(Path.of(imagePath)); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-08-19T09:26:03.283

文件上传最好使用两层验证。

首先，您可以检查 mimeType 并对其进行验证。

其次，您应该将文件的前 4 个字节转换为十六进制，然后将其与幻数进行比较。那么这将是检查文件验证的一种非常安全的方法。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-02-03T01:44:33.573

您只需一行即可完成： **MimetypesFileTypeMap().getContentType(new File("filename.ext"))**。查看完整的测试代码（Java 7）：

```
import java.io.File;
import javax.activation.MimetypesFileTypeMap;
public class MimeTest {
    public static void main(String a[]){
         System.out.println(new MimetypesFileTypeMap().getContentType(
           new File("/path/filename.txt")));
    }
} 
```

此代码产生以下输出：**text/plain**

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2019-11-11T06:13:48.927

如果您正在使用 Servlet，并且您可以使用 Servlet 上下文，则可以使用：

```
getServletContext().getMimeType( fileName ); 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2020-11-03T21:44:13.460

我找不到任何可以检查`video/mp4`MIME 类型的内容，所以我制定了自己的解决方案。我碰巧观察到 Wikipedia 是错误的，并且`00 00 00 18 66 74 79 70 69 73 6F 6D`文件签名不正确。第四个字节（`18`）和所有`70`（排除）在其他有效`mp4`文件中发生了很大变化之后。

此代码本质上是代码的复制/粘贴，`URLConnection.guessContentTypeFromStream`但针对`video/mp4`.

```
BufferedInputStream bis = new BufferedInputStream(new ByteArrayInputStream(content));
String mimeType = URLConnection.guessContentTypeFromStream(bis);

// Goes full barbaric and processes the bytes manually
if (mimeType == null){
    // These ints converted in hex ar:
    // 00 00 00 18 66 74 79 70 69 73 6F 6D
    // which are the file signature (magic bytes) for .mp4 files
    // from https://www.wikiwand.com/en/List_of_file_signatures
    // just ctrl+f "mp4"
    int[] mp4_sig = {0, 0, 0, 24, 102, 116, 121, 112};

    bis.reset();
    bis.mark(16);
    int[] firstBytes = new int[8];
    for (int i = 0; i < 8; i++) {
        firstBytes[i] = bis.read();
    }
    // This byte doesn't matter for the file signature and changes
    mp4_sig[3] = content[3];

    bis.reset();
    if (Arrays.equals(firstBytes, mp4_sig)){
        mimeType = "video/mp4";
    }
} 
```

针对 10 个不同的`.mp4`文件成功测试。

编辑：[这是一个有用的链接（如果它仍然在线），您可以在其中找到多种类型的示例](http://mirrors.standaloneinstaller.com/video-sample/)。我不拥有这些视频，也不知道谁拥有，但它们对于测试上述代码很有用。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2021-10-27T11:02:01.113

实际上，[Apache Tika 检测器](https://tika.apache.org/2.1.0/detection.html) `Tika.detect(File)`是最好的选择，并且比`Files.probeContentType(path)`.

检查这个包含示例和代码示例[的快速参考。](https://dzone.com/articles/determining-file-types-java)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-04-26T11:33:13.907

在 Spring **MultipartFile**文件中；

> org.springframework.web.multipart.MultipartFile

`file.getContentType();`

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-04-04T18:16:47.870

检测文件的[媒体类型](https://www.iana.org/assignments/media-types/media-types.xhtml)¹的解决方案包含以下部分：

*   文件签名列表（参见[Kessler 的列表](https://www.garykessler.net/library/file_sigs.html)、[维基百科的列表](https://en.wikipedia.org/wiki/List_of_file_signatures)和[Space Maker 的列表](https://github.com/veniware/Space-Maker/blob/master/FileSignatures.cs)）
*   媒体类型列表
*   媒体类型到文件扩展名的映射
*   将文件签名与`File`、`Path`或`InputStream`数据源进行比较

如果您复制代码，请记住给予信用。

# StreamMediaType.java

在下面的代码`-1`中，意味着跳过比较该索引处的字节；a`-2`表示文件类型签名的结尾。这会检测二进制格式，主要是图像和一些纯文本格式变体（HTML、SVG、XML）。该代码最多使用数据源标头中的前 11 个“魔术”字节。欢迎进行缩短逻辑的优化和改进。

```
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Path;
import java.util.LinkedHashMap;
import java.util.Map;

import static com.keenwrite.io.MediaType.*;
import static java.lang.System.arraycopy;

public class StreamMediaType {
  private static final int FORMAT_LENGTH = 11;
  private static final int END_OF_DATA = -2;

  private static final Map<int[], MediaType> FORMAT = new LinkedHashMap<>();

  static {
    //@formatter:off
    FORMAT.put( ints( 0x3C, 0x73, 0x76, 0x67, 0x20 ), IMAGE_SVG_XML );
    FORMAT.put( ints( 0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A ), IMAGE_PNG );
    FORMAT.put( ints( 0xFF, 0xD8, 0xFF, 0xE0 ), IMAGE_JPEG );
    FORMAT.put( ints( 0xFF, 0xD8, 0xFF, 0xEE ), IMAGE_JPEG );
    FORMAT.put( ints( 0xFF, 0xD8, 0xFF, 0xE1, -1, -1, 0x45, 0x78, 0x69, 0x66, 0x00 ), IMAGE_JPEG );
    FORMAT.put( ints( 0x49, 0x49, 0x2A, 0x00 ), IMAGE_TIFF );
    FORMAT.put( ints( 0x4D, 0x4D, 0x00, 0x2A ), IMAGE_TIFF );
    FORMAT.put( ints( 0x47, 0x49, 0x46, 0x38 ), IMAGE_GIF );
    FORMAT.put( ints( 0x8A, 0x4D, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A ), VIDEO_MNG );
    FORMAT.put( ints( 0x25, 0x50, 0x44, 0x46, 0x2D, 0x31, 0x2E ), APP_PDF );
    FORMAT.put( ints( 0x38, 0x42, 0x50, 0x53, 0x00, 0x01 ), IMAGE_PHOTOSHOP );
    FORMAT.put( ints( 0x25, 0x21, 0x50, 0x53, 0x2D, 0x41, 0x64, 0x6F, 0x62, 0x65, 0x2D ), APP_EPS );
    FORMAT.put( ints( 0x25, 0x21, 0x50, 0x53 ), APP_PS );
    FORMAT.put( ints( 0xFF, 0xFB, 0x30 ), AUDIO_MP3 );
    FORMAT.put( ints( 0x49, 0x44, 0x33 ), AUDIO_MP3 );
    FORMAT.put( ints( 0x3C, 0x21 ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x68, 0x74, 0x6D, 0x6C ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x68, 0x65, 0x61, 0x64 ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x62, 0x6F, 0x64, 0x79 ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x48, 0x54, 0x4D, 0x4C ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x48, 0x45, 0x41, 0x44 ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x42, 0x4F, 0x44, 0x59 ), TEXT_HTML );
    FORMAT.put( ints( 0x3C, 0x3F, 0x78, 0x6D, 0x6C, 0x20 ), TEXT_XML );
    FORMAT.put( ints( 0xFE, 0xFF, 0x00, 0x3C, 0x00, 0x3f, 0x00, 0x78 ), TEXT_XML );
    FORMAT.put( ints( 0xFF, 0xFE, 0x3C, 0x00, 0x3F, 0x00, 0x78, 0x00 ), TEXT_XML );
    FORMAT.put( ints( 0x42, 0x4D ), IMAGE_BMP );
    FORMAT.put( ints( 0x23, 0x64, 0x65, 0x66 ), IMAGE_X_BITMAP );
    FORMAT.put( ints( 0x21, 0x20, 0x58, 0x50, 0x4D, 0x32 ), IMAGE_X_PIXMAP );
    FORMAT.put( ints( 0x2E, 0x73, 0x6E, 0x64 ), AUDIO_BASIC );
    FORMAT.put( ints( 0x64, 0x6E, 0x73, 0x2E ), AUDIO_BASIC );
    FORMAT.put( ints( 0x52, 0x49, 0x46, 0x46 ), AUDIO_WAV );
    FORMAT.put( ints( 0x50, 0x4B ), APP_ZIP );
    FORMAT.put( ints( 0x41, 0x43, -1, -1, -1, -1, 0x00, 0x00, 0x00, 0x00, 0x00 ), APP_ACAD );
    FORMAT.put( ints( 0xCA, 0xFE, 0xBA, 0xBE ), APP_JAVA );
    FORMAT.put( ints( 0xAC, 0xED ), APP_JAVA_OBJECT );
    //@formatter:on
  }

  private StreamMediaType() {
  }

  public static MediaType getMediaType( final Path path ) throws IOException {
    return getMediaType( path.toFile() );
  }

  public static MediaType getMediaType( final java.io.File file )
    throws IOException {
    try( final var fis = new FileInputStream( file ) ) {
      return getMediaType( fis );
    }
  }

  public static MediaType getMediaType( final InputStream is )
    throws IOException {
    final var input = new byte[ FORMAT_LENGTH ];
    final var count = is.read( input, 0, FORMAT_LENGTH );

    if( count > 1 ) {
      final var available = new byte[ count ];
      arraycopy( input, 0, available, 0, count );
      return getMediaType( available );
    }

    return UNDEFINED;
  }

  public static MediaType getMediaType( final byte[] data ) {
    assert data != null;

    final var source = new int[]{
      0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

    for( int i = 0; i < data.length; i++ ) {
      source[ i ] = data[ i ] & 0xFF;
    }

    for( final var key : FORMAT.keySet() ) {
      int i = -1;
      boolean matches = true;

      while( ++i < FORMAT_LENGTH && key[ i ] != END_OF_DATA && matches ) {
        matches = key[ i ] == source[ i ] || key[ i ] == -1;
      }

      if( matches ) {
        return FORMAT.get( key );
      }
    }

    return UNDEFINED;
  }

  private static int[] ints( final int... data ) {
    final var magic = new int[ FORMAT_LENGTH ];
    int i = -1;
    while( ++i < data.length ) {
      magic[ i ] = data[ i ];
    }

    while( i < FORMAT_LENGTH ) {
      magic[ i++ ] = END_OF_DATA;
    }

    return magic;
  }
} 
```

# 媒体类型.java

根据[IANA 媒体类型](https://www.iana.org/assignments/media-types/media-types.xhtml)列表定义文件格式。请注意，文件扩展名映射在`MediaTypeExtension`. 它的`getExtension`功能依赖于 Apache 的 FilenameUtils 类。

```
import java.io.File;
import java.io.IOException;
import java.nio.file.Path;

import static MediaType.TypeName.*;
import static MediaTypeExtension.getMediaType;
import static org.apache.commons.io.FilenameUtils.getExtension;

public enum MediaType {
  APP_ACAD( APPLICATION, "acad" ),
  APP_JAVA_OBJECT( APPLICATION, "x-java-serialized-object" ),
  APP_JAVA( APPLICATION, "java" ),
  APP_PS( APPLICATION, "postscript" ),
  APP_EPS( APPLICATION, "eps" ),
  APP_PDF( APPLICATION, "pdf" ),
  APP_ZIP( APPLICATION, "zip" ),
  FONT_OTF( "otf" ),
  FONT_TTF( "ttf" ),
  IMAGE_APNG( "apng" ),
  IMAGE_ACES( "aces" ),
  IMAGE_AVCI( "avci" ),
  IMAGE_AVCS( "avcs" ),
  IMAGE_BMP( "bmp" ),
  IMAGE_CGM( "cgm" ),
  IMAGE_DICOM_RLE( "dicom_rle" ),
  IMAGE_EMF( "emf" ),
  IMAGE_EXAMPLE( "example" ),
  IMAGE_FITS( "fits" ),
  IMAGE_G3FAX( "g3fax" ),
  IMAGE_GIF( "gif" ),
  IMAGE_HEIC( "heic" ),
  IMAGE_HEIF( "heif" ),
  IMAGE_HEJ2K( "hej2k" ),
  IMAGE_HSJ2( "hsj2" ),
  IMAGE_X_ICON( "x-icon" ),
  IMAGE_JLS( "jls" ),
  IMAGE_JP2( "jp2" ),
  IMAGE_JPEG( "jpeg" ),
  IMAGE_JPH( "jph" ),
  IMAGE_JPHC( "jphc" ),
  IMAGE_JPM( "jpm" ),
  IMAGE_JPX( "jpx" ),
  IMAGE_JXR( "jxr" ),
  IMAGE_JXRA( "jxrA" ),
  IMAGE_JXRS( "jxrS" ),
  IMAGE_JXS( "jxs" ),
  IMAGE_JXSC( "jxsc" ),
  IMAGE_JXSI( "jxsi" ),
  IMAGE_JXSS( "jxss" ),
  IMAGE_KTX( "ktx" ),
  IMAGE_KTX2( "ktx2" ),
  IMAGE_NAPLPS( "naplps" ),
  IMAGE_PNG( "png" ),
  IMAGE_PHOTOSHOP( "photoshop" ),
  IMAGE_SVG_XML( "svg+xml" ),
  IMAGE_T38( "t38" ),
  IMAGE_TIFF( "tiff" ),
  IMAGE_WEBP( "webp" ),
  IMAGE_WMF( "wmf" ),
  IMAGE_X_BITMAP( "x-xbitmap" ),
  IMAGE_X_PIXMAP( "x-xpixmap" ),
  AUDIO_BASIC( AUDIO, "basic" ),
  AUDIO_MP3( AUDIO, "mp3" ),
  AUDIO_WAV( AUDIO, "x-wav" ),
  VIDEO_MNG( VIDEO, "x-mng" ),
  TEXT_HTML( TEXT, "html" ),
  TEXT_MARKDOWN( TEXT, "markdown" ),
  TEXT_PLAIN( TEXT, "plain" ),
  TEXT_XHTML( TEXT, "xhtml+xml" ),
  TEXT_XML( TEXT, "xml" ),
  TEXT_YAML( TEXT, "yaml" ),

  /*
   * When all other lights go out.
   */
  UNDEFINED( TypeName.UNDEFINED, "undefined" );

  public enum TypeName {
    APPLICATION,
    AUDIO,
    IMAGE,
    TEXT,
    UNDEFINED,
    VIDEO
  }

  private final String mMediaType;
  private final TypeName mTypeName;
  private final String mSubtype;

  MediaType( final String subtype ) {
    this( IMAGE, subtype );
  }

  MediaType( final TypeName typeName, final String subtype ) {
    mTypeName = typeName;
    mSubtype = subtype;
    mMediaType = typeName.toString().toLowerCase() + '/' + subtype;
  }

  public static MediaType valueFrom( final File file ) {
    assert file != null;
    return fromFilename( file.getName() );
  }

  public static MediaType fromFilename( final String filename ) {
    assert filename != null;
    return getMediaType( getExtension( filename ) );
  }

  public static MediaType valueFrom( final Path path ) {
    assert path != null;
    return valueFrom( path.toFile() );
  }

  public static MediaType valueFrom( String contentType ) {
    if( contentType == null || contentType.isBlank() ) {
      return UNDEFINED;
    }

    var i = contentType.indexOf( ';' );
    contentType = contentType.substring(
      0, i == -1 ? contentType.length() : i );

    i = contentType.indexOf( '/' );
    i = i == -1 ? contentType.length() : i;
    final var type = contentType.substring( 0, i );
    final var subtype = contentType.substring( i + 1 );

    return valueFrom( type, subtype );
  }

  public static MediaType valueFrom(
    final String type, final String subtype ) {
    assert type != null;
    assert subtype != null;

    for( final var mediaType : values() ) {
      if( mediaType.equals( type, subtype ) ) {
        return mediaType;
      }
    }

    return UNDEFINED;
  }

  public boolean equals( final String type, final String subtype ) {
    assert type != null;
    assert subtype != null;

    return mTypeName.name().equalsIgnoreCase( type ) &&
      mSubtype.equalsIgnoreCase( subtype );
  }

  public boolean isType( final TypeName typeName ) {
    return mTypeName == typeName;
  }

  public String getSubtype() {
    return mSubtype;
  }

  @Override
  public String toString() {
    return mMediaType;
  }
} 
```

# MediaTypeExtension.java

最后一块拼图是`MediaType`s 到它们已知和常见/流行的文件扩展名的映射。这允许基于文件扩展名的双向查找。

```
import static MediaType.*;
import static java.util.List.of;

public enum MediaTypeExtension {
  MEDIA_APP_ACAD( APP_ACAD, of( "dwg" ) ),
  MEDIA_APP_PDF( APP_PDF ),
  MEDIA_APP_PS( APP_PS, of( "ps" ) ),
  MEDIA_APP_EPS( APP_EPS ),
  MEDIA_APP_ZIP( APP_ZIP ),

  MEDIA_AUDIO_MP3( AUDIO_MP3 ),
  MEDIA_AUDIO_BASIC( AUDIO_BASIC, of( "au" ) ),
  MEDIA_AUDIO_WAV( AUDIO_WAV, of( "wav" ) ),

  MEDIA_FONT_OTF( FONT_OTF ),
  MEDIA_FONT_TTF( FONT_TTF ),

  MEDIA_IMAGE_APNG( IMAGE_APNG ),
  MEDIA_IMAGE_BMP( IMAGE_BMP ),
  MEDIA_IMAGE_GIF( IMAGE_GIF ),
  MEDIA_IMAGE_JPEG( IMAGE_JPEG,
                    of( "jpg", "jpe", "jpeg", "jfif", "pjpeg", "pjp" ) ),
  MEDIA_IMAGE_PNG( IMAGE_PNG ),
  MEDIA_IMAGE_PSD( IMAGE_PHOTOSHOP, of( "psd" ) ),
  MEDIA_IMAGE_SVG( IMAGE_SVG_XML, of( "svg" ) ),
  MEDIA_IMAGE_TIFF( IMAGE_TIFF, of( "tiff", "tif" ) ),
  MEDIA_IMAGE_WEBP( IMAGE_WEBP ),
  MEDIA_IMAGE_X_BITMAP( IMAGE_X_BITMAP, of( "xbm" ) ),
  MEDIA_IMAGE_X_PIXMAP( IMAGE_X_PIXMAP, of( "xpm" ) ),

  MEDIA_VIDEO_MNG( VIDEO_MNG, of( "mng" ) ),

  MEDIA_TEXT_MARKDOWN( TEXT_MARKDOWN, of(
    "md", "markdown", "mdown", "mdtxt", "mdtext", "mdwn", "mkd", "mkdown",
    "mkdn" ) ),
  MEDIA_TEXT_PLAIN( TEXT_PLAIN, of( "txt", "asc", "ascii", "text", "utxt" ) ),
  MEDIA_TEXT_R_MARKDOWN( TEXT_R_MARKDOWN, of( "Rmd" ) ),
  MEDIA_TEXT_R_XML( TEXT_R_XML, of( "Rxml" ) ),
  MEDIA_TEXT_XHTML( TEXT_XHTML, of( "xhtml" ) ),
  MEDIA_TEXT_XML( TEXT_XML ),
  MEDIA_TEXT_YAML( TEXT_YAML, of( "yaml", "yml" ) ),

  MEDIA_UNDEFINED( UNDEFINED, of( "undefined" ) );

  private final MediaType mMediaType;
  private final List<String> mExtensions;

  MediaTypeExtension( final MediaType mediaType ) {
    this( mediaType, of( mediaType.getSubtype() ) );
  }

  MediaTypeExtension(
    final MediaType mediaType, final List<String> extensions ) {
    assert mediaType != null;
    assert extensions != null;
    assert !extensions.isEmpty();

    mMediaType = mediaType;
    mExtensions = extensions;
  }

  public String getExtension() {
    return mExtensions.get( 0 );
  }

  public static MediaTypeExtension valueFrom( final MediaType mediaType ) {
    for( final var type : values() ) {
      if( type.isMediaType( mediaType ) ) {
        return type;
      }
    }

    return MEDIA_UNDEFINED;
  }

  boolean isMediaType( final MediaType mediaType ) {
    return mMediaType == mediaType;
  }

  static MediaType getMediaType( final String extension ) {
    final var sanitized = sanitize( extension );

    for( final var mediaType : MediaTypeExtension.values() ) {
      if( mediaType.isType( sanitized ) ) {
        return mediaType.getMediaType();
      }
    }

    return UNDEFINED;
  }

  private boolean isType( final String sanitized ) {
    for( final var extension : mExtensions ) {
      if( extension.equalsIgnoreCase( sanitized ) ) {
        return true;
      }
    }

    return false;
  }

  private static String sanitize( final String extension ) {
    return extension == null ? "" : extension.toLowerCase();
  }

  private MediaType getMediaType() {
    return mMediaType;
  }
} 
```

* * *

用途：

```
// EXAMPLE -- Detect media type
//
final File image = new File( "filename.jpg" );
final MediaType mt = StreamMediaType.getMediaType( image );

// Tricky! The JPG could be a PNG in disguise.
if( mt.isType( MediaType.TypeName.IMAGE ) ) {

  if( mt == MediaType.IMAGE_PNG ) {
    // Nice try! Sneaky sneak.
  }
}

// EXAMPLE -- Get typical media type file name extension
//
final String ext = MediaTypeExtension.valueFrom( MediaType.IMAGE_SVG_XML ).getExtension();

// EXAMPLE -- Get media type from HTTP request
//
final var url = new URL( "https://localhost/path/file.ext" );
final var conn = (HttpURLConnection) url.openConnection();
final var contentType = conn.getContentType();
MediaType mediaType = valueFrom( contentType );

// Fall back to stream detection probe
if( mediaType == UNDEFINED ) {
  mediaType = StreamMediaType.getMediaType( conn.getInputStream() );
}

conn.disconnect(); 
```

你明白了。

* * *

简短的图书馆评论：

*   [Apache Tika](https://tika.apache.org/) -- 600kb 膨胀，需要多行配置和多个 JAR 文件。
*   [jMimeMagic](https://github.com/arimus/jmimemagic/) -- 未完成，需要多行配置。
*   [MimeUtil2——](http://mime-util.sourceforge.net/)相当大，不能开箱即用。
*   [FileTypeDetector](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/spi/FileTypeDetector.html) -- 与 JDK 捆绑在一起，比山松甲虫出没的森林还要臭。
*   [Files.probeContentType](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/nio/file/spi/FileTypeDetector.html) - 检测是特定于平台的，被认为是不可靠的（[来源](https://stackoverflow.com/a/65966588/59087)）。
*   [MimetypesFileTypeMap](https://docs.oracle.com/javase/7/docs/api/javax/activation/MimetypesFileTypeMap.html) -- 与activation.jar 捆绑在一起，使用文件扩展名。

* * *

用于测试的示例音频、视频和图像文件：

*   [http://mirrors.standaloneinstaller.com/video-sample/](http://mirrors.standaloneinstaller.com/video-sample/)
*   [https://www.w3.org/People/mimasa/test/imgformat/](https://www.w3.org/People/mimasa/test/imgformat/)

* * *

¹ “MIME 类型”是一个已弃用的术语。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-12-07T11:17:48.840

如果您在 linux 操作系统上工作，则有一个命令行`file --mimetype`：

```
String mimetype(file){

   //1\. run cmd
   Object cmd=Runtime.getRuntime().exec("file --mime-type "+file);

   //2 get output of cmd , then 
    //3\. parse mimetype
    if(output){return output.split(":")[1].trim(); }
    return "";
} 
```

然后

```
mimetype("/home/nyapp.war") //  'application/zip'

mimetype("/var/www/ggg/au.mp3") //  'audio/mp3' 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-05-26T12:35:24.087

在尝试了各种其他库后，我选择了 mime-util。

```
<groupId>eu.medsea.mimeutil</groupId>
      <artifactId>mime-util</artifactId>
      <version>2.1.3</version>
</dependency>

File file = new File("D:/test.tif");
MimeUtil.registerMimeDetector("eu.medsea.mimeutil.detector.MagicMimeMimeDetector");
Collection<?> mimeTypes = MimeUtil.getMimeTypes(file);
System.out.println(mimeTypes); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-11-23T13:26:18.497

```
public String getFileContentType(String fileName) {
    String fileType = "Undetermined";
    final File file = new File(fileName);
    try
    {
        fileType = Files.probeContentType(file.toPath());
    }
    catch (IOException ioException)
    {
        System.out.println(
                "ERROR: Unable to determine file type for " + fileName
                        + " due to exception " + ioException);
    }
    return fileType;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-05-17T09:09:01.267

```
File file = new File(PropertiesReader.FILE_PATH);
MimetypesFileTypeMap fileTypeMap = new MimetypesFileTypeMap();
String mimeType = fileTypeMap.getContentType(file);
URLConnection uconnection = file.toURL().openConnection();
mimeType = uconnection.getContentType(); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-07-31T20:33:50.153

我用下面的代码做到了。

```
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

public class MimeFileType {

    public static void main(String args[]){

        try{
            URL url = new URL ("https://www.url.com.pdf");

            HttpURLConnection connection = (HttpURLConnection) url.openConnection();
            connection.setRequestMethod("GET");
            connection.setDoOutput(true);
            InputStream content = (InputStream)connection.getInputStream();
            connection.getHeaderField("Content-Type");

            System.out.println("Content-Type "+ connection.getHeaderField("Content-Type"));

            BufferedReader in = new BufferedReader (new InputStreamReader(content));

        }catch (Exception e){

        }
    }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-01-13T05:51:10.010

检查流或文件的魔术字节：

[https://stackoverflow.com/a/65667558/3225638](https://stackoverflow.com/a/65667558/3225638)

它使用纯 Java，但需要您定义`enum`要检测的类型。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-05-18T12:35:32.717

如果您想要一种将文件扩展名映射到 mime 类型的可靠（即一致）方式，我使用的是：

[https://github.com/jjYBdx4IL/misc/blob/master/text-utils/src/main/java/com/github/jjYBdx4IL/utils/text/MimeType.java](https://github.com/jjYBdx4IL/misc/blob/master/text-utils/src/main/java/com/github/jjYBdx4IL/utils/text/MimeType.java)

它包括一个捆绑的 mime 类型数据库，并且通过使用数据库初始化“程序化”条目，基本上颠倒了 javax.activation 的 MimetypesFileTypeMap 类的逻辑。这样，库定义的类型总是优先于非捆绑资源中可能定义的类型。

# java - Java IPC 的最佳实践

> ID：51452
> 
> 赞同：13
> 
> 时间：2008-09-09T09:20:37.393
> 
> 标签：java, multithreading

在多线程 Java 应用程序中进行进程间通信的最佳方法是什么。

它应该是高性能的（所以请不要使用 JMS），易于实现且可靠，以便对象和数据只能绑定到一个线程？

欢迎任何想法！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-09T09:43:22.173

你能澄清一下吗？您是指单个 JVM 中的 IPC 吗？（多线程，是的，但在操作系统级别只有一个进程。）或者您的意思是多个 JVM？（以及真正的操作系统级进程间通信。）

如果它是第一个，那么可能是**java.util.concurrent**之外的东西，比如[ConcurrentLinkedQueue](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html)就可以了。（我使用 java.util.concurrent 中的类在我的线程之间传递消息并成功。）

如果是后者，那么我只是猜测并建议看一下**[RMI](http://java.sun.com/javase/technologies/core/basic/rmi/index.jsp)**，尽管我认为它不符合完全可靠的条件——你必须更多地“动手”来管理它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-09T10:29:51.393

假设场景 1 JVM，那么确实有多个线程 java.util.concurrent 是要看的地方，特别是各种 Queue 实现。然而，在此之上的抽象可能会很好，并且[Jetlang](http://code.google.com/p/jetlang/)看起来非常有趣，是轻量级的 Java 消息传递。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T09:54:56.623

我建议查看整个[java.util.concurrent](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/package-summary.html)包，它有多个用于处理并发的类和线程之间的不同通信方式。一切都取决于您想要实现的目标，因为您的问题很笼统。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-27T02:16:37.717

您应该使用生产者/消费者队列。通过这样做，您可以避免多线程编程的陷阱：竞争条件和死锁。此外，如果您使用像 Disruptor 或 MentaQueue 这样的无锁队列，它不仅更简单、更清洁，而且速度更快。我写了一篇博客文章，详细讨论了这一点，并展示了如何获得 < 100 纳秒的延迟：[具有 2 位纳秒延迟的线程间通信](http://mentablog.soliveirajr.com/2012/11/inter-thread-communication-with-2-digit-nanosecond-latency/)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-05-15T08:42:41.500

我刚刚在 github ( [http://github.com/caplogic/mappedbus](http://github.com/caplogic/mappedbus) ) 上添加了 MappedBus，它是一个高效的 IPC 库，它使多个 Java 进程/JVM 能够通过交换消息进行通信，并且它使用内存映射文件进行传输。吞吐量已测量为 4000 万条消息/秒。

# asp.net - 杀死服务器上的 Excel.EXE

> ID：51462
> 
> 赞同：12
> 
> 时间：2008-09-09T09:31:41.157
> 
> 标签：asp.net, excel

> **可能重复：**
> [如何在 C# 中正确清理 Excel 互操作对象](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c)

假设 ASP.NET Web 应用程序在服务器上生成自动 Excel 报告。一旦处理结束，我们如何杀死服务器端 Excel.EXE。我故意提出这个问题，因为我相信垃圾收集器即使在 Excel 文件关闭后也不会清理 Excel 可执行文件。

任何指针都会有帮助吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-09T09:36:32.847

很抱歉这么说，我不是想聪明，但是……**不要把办公室放在服务器上！！！**

如果我理解正确的话！:)

**编辑：**即使我为此被贬低了，我永​​远*不会*提倡在服务器上运行 Office - 过去事实证明这对我来说**太**痛苦了。

话虽如此，我和水晶报表现在也是如此；-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T12:37:44.890

我同意不在服务器上运行 Office。并不是说我在这件事上有任何选择:)

使用 taskkill 选项要记住的一件事是，除非您专门为此计划（又名 - 单例），否则您可能有多个 Excel 副本（或任何其他 Office 应用程序）正在运行，并且无意中关闭了错误的实例。

另请注意，根据[http://support.microsoft.com/kb/257757](http://support.microsoft.com/kb/257757)

> Microsoft 目前不推荐也不支持任何无人值守、非交互式客户端应用程序或组件（包括 ASP、ASP.NET、DCOM 和 NT 服务）的 Microsoft Office 应用程序自动化，因为 Office 可能表现出不稳定的行为和/或在此环境中运行 Office 时出现死锁。

作为替代方案，有一个名为[Aspose Cells](http://www.aspose.com/categories/file-format-components/aspose.cells-for-.net-and-java/default.aspx)的产品提供了一种产品，该产品旨在允许您在服务器环境中以编程方式使用 Excel 工作表。作为免责声明，我从未亲自使用过该产品，但我从过去与我共事过的几个人那里听说过。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-20T23:30:09.820

我有更多时间考虑这个答案，现在建议使用 XML 方法和 Open XML Office 电子表格格式。

这里有一些很好的链接，可以开始使用代码构建办公文档。 [http://msdn.microsoft.com/en-us/magazine/cc163478.aspx](http://msdn.microsoft.com/en-us/magazine/cc163478.aspx) [http://msdn.microsoft.com/en-us/library/bb735940(office.12).aspx](http://msdn.microsoft.com/en-us/library/bb735940(office.12).aspx)

只需在 SQL Server 上使用 SSIS。它提供了导出到 Excel 的能力。不要在服务器上运行office。或者在 aspose 或电子表格设备上浪费钱。

GC 确实可以工作，只是您没有正确使用它，请遵循此模式...

```
 private void killExcel()
        {
          xlApp.Quit();
          Marshal.ReleaseCOMObject(xlApp);
          if(xlApp != null)
          {
            xlApp = null;
          }
          GC.WaitForPendingFinalizers();
          GC.Collect();
          GC.WaitForPendingFinalizers();
          GC.Collect();
        } 
```

让你的 Excel 操作类实现 IDisposable，然后在 Dispose 方法中粘贴 killExcel()。

更新：另请注意，有时开发人员仍会看到 Excel.exe 在任务管理器中运行。在假设上述代码不起作用之前，请检查运行代码的进程是否也已关闭。对于 VSTO 或 COM 插件，检查 Word/powerpoint/其他 excel 实例是否也已关闭，因为仍有 GC 根返回到启动过程。一旦关闭，Excel.exe 进程将关闭。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-23T13:23:42.723

我有一个类似的问题。虽然“taskkill excel.exe”或枚举所有“excel”进程并杀死它们确实有效，但这会杀死所有正在运行的 Excel 进程。你最好只杀死你当前正在使用的实例。

这是我用来完成此操作的代码。它使用 PInvoke（参见[此处](http://www.pinvoke.net/default.aspx/user32/GetWindowThreadProcessId.html)）从 Excel.Application 实例（以下示例中的 Me.ExcelInstance）中获取 ProcessID。

```
Dim ExcelPID As Integer
GetWindowThreadProcessId(New IntPtr(Me.ExcelInstance.Hwnd), ExcelPID)

If ExcelPID > 0 Then
   Dim ExcelProc As Process = Process.GetProcessById(ExcelPID)
   If ExcelProc IsNot Nothing Then ExcelProc.Kill()
End If 
```

请注意，由于 PInvoke，这可能不适用于所有平台……迄今为止，这是我发现的唯一可靠方法。我还尝试通过枚举所有 Excel 进程并将 Process.MainModule.BaseAddress 与 Excel.Application.Hinstance 进行比较来找到正确的 PID。

```
'DO NOT USE THIS METHOD, for demonstration only    
For Each p as Process in ExcelProcesses
        Dim BaseAddr As Integer = p.MainModule.BaseAddress.ToInt32()
        If BaseAddr = Me.ExcelInstance.Hinstance Then
            p.Kill()
            Exit For
        End If
Next 
```

这**不是**找到正确进程的可靠方法，因为 BaseAddress 有时对于多个进程似乎是相同的（导致杀死错误的 PID）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T09:36:25.857

你在使用 VSTO 吗？完成它对我有用后，您可以关闭 Excel 应用程序`excelobject.Quit();`，但我不再在服务器端使用 Excel。

您可以查看 Excel 的 XML 架构来构建没有 Excel 本身的 Excel 文件。查看[CarlosAg Excel Writer](http://www.carlosag.net/Tools/ExcelXmlWriter/Default.aspx)，它的功能完全相同。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-09T09:35:29.337

您需要的命令是“taskkill”。

[http://technet.microsoft.com/en-us/library/bb491009.aspx](http://technet.microsoft.com/en-us/library/bb491009.aspx)

```
> taskkill excel.exe 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-09T09:37:15.293

:)。[我在这里](http://madcoderspeak.blogspot.com/2006/07/die-die-excel-you-fiend.html)用 Excel 记下了我的小冲突。它也有一些我经过大量搜索后找到的链接。希望能帮助到你。
基本上 Excel 是一种痛苦，即使它可以自动化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-09T11:33:49.397

除了对 mdb 文件的数据访问之外，我也不建议在服务器上使用办公应用程序。

我完全可以理解，有时它是必要的。在那些情况下，我会推荐以下内容：

*   创建一个单独的服务器，这是唯一的功能。（让您以最小的影响重新启动）。
*   让服务器实现排队请求的机制
*   保持一个线程处理队列。这使您能够跟踪办公应用程序，在必要时将其终止，然后继续运行，而不会影响任何排队的作业或其他应用程序。

如果您绝对需要在同一台服务器上执行此操作，那么至少在它自己的应用程序池中实现上述内容。

限制自己保留一个工作队列并且只有一个 Excel 实例（或任何其他办公应用程序）让你用 TaskKill 或 .Kill() 放弃它而不会失去工作。

我相信如果你把它保持在一个线程中，那么你很少需要杀死它。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-12T20:19:35.737

我使用[电子表格](http://spreadsheetgear.com/)工具在服务器上生成 XL 报告，效果非常好。我们不必担心EXCEL过程..

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-09T12:45:25.187

实际上，我不久前有一个与此类似的问题-[使用 Office 自动化时检查挂起的 Office 进程](https://stackoverflow.com/questions/9905/check-for-hung-office-process-when-using-office-automation)-对该问题的一些回答可能对您有用。

此外，我必须同意其他人所说的关于将任何 Office 产品远离服务器的说法；但是，由于您正在使用 Excel，因此生成[Excel XML 文档](http://office.microsoft.com/en-us/excel/HA102063961033.aspx)可能是可行的。您可以执行此操作而无需执行任何 Office 自动化，并且该过程相当简单。对于简单的基于网格的电子表格，我发现它比尝试使用 Excel 自动化它要容易一些。[Office Open XML](http://en.wikipedia.org/wiki/Office_Open_XML)非常强大，并且允许更复杂的报告以及更多的工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-09T09:51:42.700

结束工作后，您需要安全地处理所有 COM 互操作对象。“全部”我的意思是绝对**全部**：集合属性值等等。我在设置过程中创建了堆栈对象并推送了对象：

```
Stack<object> comObjectsToRelease = new Stack<object>();
...
Log("Creating VBProject object.");
VBProject vbProject = workbook.VBProject;
comObjectsToRelease.Push(vbProject);
...
finally
{
    if(excel != null)
    {
        Log("Quiting Excel.");
        excel.Quit();
        excel = null;
    }
    while (comObjectsToRelease.Count > 0)
    {
        Log("Releasing {0} COM object.", comObjectsToRelease.GetType().Name);
        Marshal.FinalReleaseComObject(comObjectsToRelease.Pop());
    }               
    Log("Invoking garbage collection.");
    GC.Collect();
} 
```

如果 Excel 仍然存在，则必须手动将其杀死。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-09T11:02:22.797

我遇到了类似的问题并使用了以下代码：

```
System.Diagnostics.Process[] procs = System.Diagnostics.Process.GetProcesses();
for (int i = 0; i < procs.Length; i++)
{
  if(procs[i].ProcessName == "EXCEL")
  {
    procs[i].Kill();
  }
} 
```

这工作得很好，但我真的会考虑在服务器上使用 Office。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-14T18:44:28.897

最好的方法是使用专门构建的库，例如 Aspose 的库来生成电子表格或填充模板。下一个最佳方法是在适合您需要的情况下使用 xml 格式进行办公。一种有时适合的轻量级方法是创建一个包含一个表的 HTML 文件，并使用 .xls 扩展名对其进行命名。Excel 会很高兴地阅读它，但它的功能非常有限。

这些是我使用过的选项（但不多）。还有一个叫做 Microsoft Office Sharepoint Server 的东西，但我不知道它真的能让你做多少。

也就是说，您的问题正在发生，因为当您调用常规 Excel 库时，您实际上是在完全独立于 .Net 的情况下启动 Excel，并且实际上只是使用代理库与之对话。这与使用 WCF 和服务的情况几乎相同。您不会期望服务会因为客户端应用程序使用完它而死掉。更糟糕的是，Excel 是一种非托管资源，根本不会被处置/最终确定/垃圾收集。.Net 运行时不知道 Excel，它只知道那些代理。Application.quit 是您需要的，您可能还需要显式释放创建的 com 对象。

# uml - 你如何在 UML 类图中显示事件？

> ID：51464
> 
> 赞同：15
> 
> 时间：2008-09-09T09:33:55.053
> 
> 标签：uml, visio

在为文档创建顶级类图时，我经常感到困惑。方法和属性/字段易于建模。我通常最终添加一个名为 EvChanged 的​​方法来指示 .Net 事件已更改。

显示类型发布特定事件的正确方法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-19T04:35:46.760

只需将 «event» 构造型添加到分类器属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T15:40:57.350

我发现 onEventName() 是事件回调最简单的命名方案，但是如何指示对象可以广播哪些事件我还没有找到任何解决方案。如果某些工具支持它，则允许定制容器（除了属性和方法约束器）的扩展 UML 类图可能是一种替代方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-19T04:25:29.903

我认为没有任何特定的 UML 表示法可以显示 Class 可以广播的事件。要显示 Class 可以接收的事件，您需要一个 Reception 元素。这与带有«signal»关键字的操作具有相似的符号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-28T22:23:14.710

我在模型中创建了一个原型，“PublishedEvent”，具有操作的 BaseClass。我将刻板印象应用于课堂上的操作。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-09T13:57:07.010

不是我喜欢给出的答案类型，但[微软](http://office.microsoft.com/en-us/visio/HP815503691033.aspx)在 Office 网站上有一个答案。

# sql - 如何在 Oracle 中重置序列？

> ID：51470
> 
> 赞同：188
> 
> 时间：2008-09-09T09:36:39.320
> 
> 标签：sql, database, oracle, sequence

在[PostgreSQL](http://en.wikipedia.org/wiki/PostgreSQL)中，我可以这样做：

```
ALTER SEQUENCE serial RESTART WITH 0; 
```

是否有甲骨文等价物？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-09-18T15:34:52.270

[这是一个从 Oracle 大师Tom Kyte](http://asktom.oracle.com)将任何序列重置为 0 的好程序。在下面的链接中也对利弊进行了很好的讨论。

```
tkyte@TKYTE901.US.ORACLE.COM> 
create or replace
procedure reset_seq( p_seq_name in varchar2 )
is
    l_val number;
begin
    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by -' || l_val || 
                                                          ' minvalue 0';

    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by 1 minvalue 0';
end;
/ 
```

从此页面：[动态 SQL 重置序列值](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:951269671592)
另一个很好的讨论也在这里：[如何重置序列？](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1119633817597)

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2008-09-09T09:46:29.030

真正的重启是不可能的[AFAIK](http://en.wiktionary.org/wiki/AFAIK)。（如果我错了，请纠正我！）。

但是，如果要将其设置为 0，则可以删除并重新创建它。

如果要将其设置为特定值，可以将 INCREMENT 设置为负值并获取下一个值。

也就是说，如果您的序列为 500，则可以通过将其设置为 100

```
ALTER SEQUENCE serial INCREMENT BY -400;
SELECT serial.NEXTVAL FROM dual;
ALTER SEQUENCE serial INCREMENT BY 1; 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2013-10-30T03:31:27.340

```
alter sequence serial restart start with 1; 
```

此功能在 18c 中正式添加，但自 12.1 起非官方可用。

在 12.1 中使用这个未记录的特性可以说是安全的。尽管[官方文档中](http://docs.oracle.com/database/121/SQLRF/statements_2014.htm#SQLRF00817)*没有*包含该语法，但它是由 Oracle 包[DBMS_METADATA_DIFF](http://docs.oracle.com/database/121/ARPLS/d_metadiff.htm#ARPLS354)生成的。我在生产系统上使用过几次。但是，我创建了一个 Oracle 服务请求，他们证实这不是文档错误，该功能确实不受支持。

在 18c 中，该功能没有出现在 SQL Language Syntax 中，但包含在[Database Administrator's Guide](https://docs.oracle.com/en/database/oracle/oracle-database/18/admin/managing-views-sequences-and-synonyms.html)中。

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2010-05-19T14:56:29.633

这是我的方法：

1.  删除序列
2.  重新创建它

例子：

```
--Drop sequence

DROP SEQUENCE MY_SEQ;

-- Create sequence 

create sequence MY_SEQ
minvalue 1
maxvalue 999999999999999999999
start with 1
increment by 1
cache 20; 
```

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2011-05-19T17:35:59.060

我的方法是对[Dougman 示例](https://stackoverflow.com/questions/51470/how-do-i-reset-a-sequence-in-oracle/93633#93633)的小幅扩展。

扩展是...

传入种子值作为参数。为什么？我喜欢称将序列重置为*某个表中使用的最大 ID*的东西。我最终从另一个脚本调用这个过程，该脚本对一大堆序列执行多次调用，将 nextval 重置回某个足够高的级别，在我使用序列的值作为唯一标识符的情况下不会导致主键违规。

它还尊重以前的*minvalue*。如果所需的**p_val**或*现有的最小值*高于当前或计算的下一个值，它实际上可能*会将下一个值推得更高。*

 ***最重要的是，可以调用它来重置为指定值，然后等到最后看到包装器“修复我的所有序列”过程。

```
create or replace
procedure Reset_Sequence( p_seq_name in varchar2, p_val in number default 0)
is
  l_current number := 0;
  l_difference number := 0;
  l_minvalue user_sequences.min_value%type := 0;

begin

  select min_value
  into l_minvalue
  from user_sequences
  where sequence_name = p_seq_name;

  execute immediate
  'select ' || p_seq_name || '.nextval from dual' INTO l_current;

  if p_Val < l_minvalue then
    l_difference := l_minvalue - l_current;
  else
    l_difference := p_Val - l_current;
  end if;

  if l_difference = 0 then
    return;
  end if;

  execute immediate
    'alter sequence ' || p_seq_name || ' increment by ' || l_difference || 
       ' minvalue ' || l_minvalue;

  execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_difference;

  execute immediate
    'alter sequence ' || p_seq_name || ' increment by 1 minvalue ' || l_minvalue;
end Reset_Sequence; 
```

该过程本身很有用，但现在让我们添加另一个调用它并使用序列命名约定以编程方式指定所有内容并查找现有表/字段中使用的最大值...

```
create or replace
procedure Reset_Sequence_to_Data(
  p_TableName varchar2,
  p_FieldName varchar2
)
is
  l_MaxUsed NUMBER;
BEGIN

  execute immediate
    'select coalesce(max(' || p_FieldName || '),0) from '|| p_TableName into l_MaxUsed;

  Reset_Sequence( p_TableName || '_' || p_Fieldname || '_SEQ', l_MaxUsed );

END Reset_Sequence_to_Data; 
```

现在我们用煤气做饭！

上面的过程将检查表中字段的最大值，从表/字段对构建序列名称，并使用检测到的最大值调用*“Reset_Sequence” 。*

接下来是这个难题的最后一块，锦上添花……

```
create or replace
procedure Reset_All_Sequences
is
BEGIN

  Reset_Sequence_to_Data( 'ACTIVITYLOG', 'LOGID' );
  Reset_Sequence_to_Data( 'JOBSTATE', 'JOBID' );
  Reset_Sequence_to_Data( 'BATCH', 'BATCHID' );

END Reset_All_Sequences; 
```

在我的实际数据库中，大约有一百个其他序列通过这种机制被重置，因此在上面的那个过程中还有 97 次对*Reset_Sequence_to_Data的调用。*

爱它？讨厌它？冷漠？

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2010-11-04T18:53:27.913

以下脚本将序列设置为所需的值：

给定一个新创建的名为 PCS_PROJ_KEY_SEQ 的序列和表 PCS_PROJ：

```
BEGIN
   DECLARE
      PROJ_KEY_MAX       NUMBER := 0;
      PROJ_KEY_CURRVAL   NUMBER := 0;
   BEGIN

    SELECT MAX (PROJ_KEY) INTO PROJ_KEY_MAX FROM PCS_PROJ;
    EXECUTE IMMEDIATE 'ALTER SEQUENCE PCS_PROJ_KEY_SEQ INCREMENT BY ' || PROJ_KEY_MAX;
    SELECT PCS_PROJ_KEY_SEQ.NEXTVAL INTO PROJ_KEY_CURRVAL FROM DUAL;
    EXECUTE IMMEDIATE 'ALTER SEQUENCE PCS_PROJ_KEY_SEQ INCREMENT BY 1';

END;
END;
/ 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-07-29T17:23:58.290

这个[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)重新启动了我的序列：

```
Create or Replace Procedure Reset_Sequence  
  is
  SeqNbr Number;
begin
   /*  Reset Sequence 'seqXRef_RowID' to 0    */
   Execute Immediate 'Select seqXRef.nextval from dual ' Into SeqNbr;
   Execute Immediate 'Alter sequence  seqXRef increment by - ' || TO_CHAR(SeqNbr) ;
   Execute Immediate 'Select seqXRef.nextval from dual ' Into SeqNbr;
   Execute Immediate 'Alter sequence  seqXRef increment by 1';
END; 
```

/

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-02-10T17:09:03.527

在 Oracle 中还有另一种重置序列的方法：设置`maxvalue`和`cycle`属性。当`nextval`序列的 命中 时`maxvalue`，如果`cycle`设置了属性，那么它将再次从`minvalue`序列的 开始。

与设置负数相比，此方法的优点`increment by`是可以在重置过程运行时继续使用序列，从而减少您需要采取某种形式的中断来进行重置的机会。

for 的值`maxvalue`必须大于 current ，因此下面的过程包括一个可选参数，允许缓冲区以防在过程中选择 和设置属性`nextval`之间再次访问序列。`nextval``cycle`

```
create sequence s start with 1 increment by 1;

select s.nextval from dual
connect by level <= 20;

   NEXTVAL
----------
         1 
...
        20

create or replace procedure reset_sequence ( i_buffer in pls_integer default 0)
as
  maxval pls_integer;
begin

  maxval := s.nextval + greatest(i_buffer, 0); --ensure we don't go backwards!
  execute immediate 'alter sequence s cycle minvalue 0 maxvalue ' || maxval;
  maxval := s.nextval;
  execute immediate 'alter sequence s nocycle maxvalue 99999999999999';

end;
/
show errors

exec reset_sequence;

select s.nextval from dual;

   NEXTVAL
----------
         1 
```

目前的过程仍然允许另一个会话获取值 0，这对您来说可能是也可能不是问题。如果是，您可以随时：

*   设置`minvalue 1`在第一个改变
*   排除第二次`nextval`提取
*   移动语句以将`nocycle`属性设置到另一个过程中，以便在以后运行（假设您要这样做）。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-12-11T04:06:00.290

1）假设您创建一个如下所示的序列：

```
CREATE SEQUENCE TESTSEQ
INCREMENT BY 1
MINVALUE 1
MAXVALUE 500
NOCACHE
NOCYCLE
NOORDER 
```

2) 现在你从 SEQUENCE 中获取值。假设我已经取了四次，如下所示。

```
SELECT TESTSEQ.NEXTVAL FROM dual
SELECT TESTSEQ.NEXTVAL FROM dual
SELECT TESTSEQ.NEXTVAL FROM dual
SELECT TESTSEQ.NEXTVAL FROM dual 
```

3) 执行上述四个命令后，SEQUENCE 的值为 4。现在假设我再次将 SEQUENCE 的值重置为 1。遵循以下步骤。按照相同的顺序执行所有步骤，如下所示：

1.  `ALTER SEQUENCE TESTSEQ INCREMENT BY -3;`
2.  `SELECT TESTSEQ.NEXTVAL FROM dual`
3.  `ALTER SEQUENCE TESTSEQ INCREMENT BY 1;`
4.  `SELECT TESTSEQ.NEXTVAL FROM dual`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-04-25T15:08:49.363

Jezus，所有这些编程都只是为了重新启动索引......也许我是个白痴，但是对于 pre-oracle 12（它具有重新启动功能），一个简单的问题是什么：

```
drop sequence blah;
create sequence blah 
```

?

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-15T15:17:57.640

改变序列的 INCREMENT 值，增加它，然后再改变它是非常轻松的，而且你有额外的好处，你不必重新建立所有的授权，就像你放弃/重新创建序列一样。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-03-25T15:51:05.743

您可以使用 CYCLE 选项，如下所示：

```
CREATE SEQUENCE test_seq
MINVALUE 0
MAXVALUE 100
START WITH 0
INCREMENT BY 1
CYCLE; 
```

在这种情况下，当序列达到 MAXVALUE (100) 时，它将循环到 MINVALUE (0)。

在递减序列的情况下，序列将循环到 MAXVALUE。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-06-04T19:08:46.083

我创建了一个块来重置我的所有序列：

```
DECLARE
    I_val number;
BEGIN
    FOR US IN
        (SELECT US.SEQUENCE_NAME FROM USER_SEQUENCES US)
    LOOP
        execute immediate 'select ' || US.SEQUENCE_NAME || '.nextval from dual' INTO l_val;
        execute immediate 'alter sequence ' || US.SEQUENCE_NAME || ' increment by -' || l_val || ' minvalue 0';
        execute immediate 'select ' || US.SEQUENCE_NAME || '.nextval from dual' INTO l_val;
        execute immediate 'alter sequence ' || US.SEQUENCE_NAME || ' increment by 1 minvalue 0';
    END LOOP;
END; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-08-14T19:32:49.663

这是一个更强大的过程，用于更改序列返回的下一个值，以及更多。

*   首先，它可以防止 SQL 注入攻击，因为传入的字符串都不用于直接创建任何动态 SQL 语句，
*   其次，它防止下一个序列值设置在最小或最大序列值的范围之外。将`next_value`是 !=`min_value`和介于`min_value`和之间`max_value`。
*   第三，它在清理时会考虑当前（或建议的）`increment_by`设置以及所有其他序列设置。
*   第四，除第一个之外的所有参数都是可选的，除非指定，否则将当前序列设置作为默认值。如果未指定可选参数，则不采取任何操作。
*   最后，如果您尝试更改不存在（或不属于当前用户）的序列，它将引发`ORA-01403: no data found`错误。

这是代码：

```
CREATE OR REPLACE PROCEDURE alter_sequence(
    seq_name      user_sequences.sequence_name%TYPE
  , next_value    user_sequences.last_number%TYPE := null
  , increment_by  user_sequences.increment_by%TYPE := null
  , min_value     user_sequences.min_value%TYPE := null
  , max_value     user_sequences.max_value%TYPE := null
  , cycle_flag    user_sequences.cycle_flag%TYPE := null
  , cache_size    user_sequences.cache_size%TYPE := null
  , order_flag    user_sequences.order_flag%TYPE := null)
  AUTHID CURRENT_USER
AS
  l_seq user_sequences%rowtype;
  l_old_cache user_sequences.cache_size%TYPE;
  l_next user_sequences.min_value%TYPE;
BEGIN
  -- Get current sequence settings as defaults
  SELECT * INTO l_seq FROM user_sequences WHERE sequence_name = seq_name;

  -- Update target settings
  l_old_cache := l_seq.cache_size;
  l_seq.increment_by := nvl(increment_by, l_seq.increment_by);
  l_seq.min_value    := nvl(min_value, l_seq.min_value);
  l_seq.max_value    := nvl(max_value, l_seq.max_value);
  l_seq.cycle_flag   := nvl(cycle_flag, l_seq.cycle_flag);
  l_seq.cache_size   := nvl(cache_size, l_seq.cache_size);
  l_seq.order_flag   := nvl(order_flag, l_seq.order_flag);

  IF next_value is NOT NULL THEN
    -- Determine next value without exceeding limits
    l_next := LEAST(GREATEST(next_value, l_seq.min_value+1),l_seq.max_value);

    -- Grab the actual latest seq number
    EXECUTE IMMEDIATE
        'ALTER SEQUENCE '||l_seq.sequence_name
            || ' INCREMENT BY 1'
            || ' MINVALUE '||least(l_seq.min_value,l_seq.last_number-l_old_cache)
            || ' MAXVALUE '||greatest(l_seq.max_value,l_seq.last_number)
            || ' NOCACHE'
            || ' ORDER';
    EXECUTE IMMEDIATE 
      'SELECT '||l_seq.sequence_name||'.NEXTVAL FROM DUAL'
    INTO l_seq.last_number;

    l_next := l_next-l_seq.last_number-1;

    -- Reset the sequence number
    IF l_next <> 0 THEN
      EXECUTE IMMEDIATE 
        'ALTER SEQUENCE '||l_seq.sequence_name
            || ' INCREMENT BY '||l_next
            || ' MINVALUE '||least(l_seq.min_value,l_seq.last_number)
            || ' MAXVALUE '||greatest(l_seq.max_value,l_seq.last_number)
            || ' NOCACHE'
            || ' ORDER';
      EXECUTE IMMEDIATE 
        'SELECT '||l_seq.sequence_name||'.NEXTVAL FROM DUAL'
      INTO l_next;
    END IF;
  END IF;

  -- Prepare Sequence for next use.
  IF COALESCE( cycle_flag
             , next_value
             , increment_by
             , min_value
             , max_value
             , cache_size
             , order_flag) IS NOT NULL
  THEN
    EXECUTE IMMEDIATE 
      'ALTER SEQUENCE '||l_seq.sequence_name
          || ' INCREMENT BY '||l_seq.increment_by
          || ' MINVALUE '||l_seq.min_value
          || ' MAXVALUE '||l_seq.max_value
          || CASE l_seq.cycle_flag
             WHEN 'Y' THEN ' CYCLE' ELSE ' NOCYCLE' END
          || CASE l_seq.cache_size
             WHEN 0 THEN ' NOCACHE'
             ELSE ' CACHE '||l_seq.cache_size END
          || CASE l_seq.order_flag
             WHEN 'Y' THEN ' ORDER' ELSE ' NOORDER' END;
  END IF;
END; 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-09-29T05:25:27.473

在我的项目中，一旦有人在不使用序列的情况下手动输入记录，因此我必须手动重置序列值，为此我在下面的 sql 代码片段中编写：

```
declare
max_db_value number(10,0);
cur_seq_value number(10,0);
counter number(10,0);
difference number(10,0);
dummy_number number(10);

begin

-- enter table name here
select max(id) into max_db_value from persons;
-- enter sequence name here
select last_number into cur_seq_value from user_sequences where  sequence_name = 'SEQ_PERSONS';

difference  := max_db_value - cur_seq_value;

 for counter in 1..difference
 loop
    -- change sequence name here as well
    select SEQ_PERSONS.nextval into dummy_number from dual;
 end loop;
end; 
```

请注意，如果序列滞后，上述代码将起作用。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-04-28T20:05:20.337

我做了一个替代方案，用户不需要知道值，系统获取并使用变量来更新。

```
--Atualizando sequence da tabela SIGA_TRANSACAO, pois está desatualizada
DECLARE
 actual_sequence_number INTEGER;
 max_number_from_table INTEGER;
 difference INTEGER;
BEGIN
 SELECT [nome_da_sequence].nextval INTO actual_sequence_number FROM DUAL;
 SELECT MAX([nome_da_coluna]) INTO max_number_from_table FROM [nome_da_tabela];
 SELECT (max_number_from_table-actual_sequence_number) INTO difference FROM DUAL;
IF difference > 0 then
 EXECUTE IMMEDIATE CONCAT('alter sequence [nome_da_sequence] increment by ', difference);
 --aqui ele puxa o próximo valor usando o incremento necessário
 SELECT [nome_da_sequence].nextval INTO actual_sequence_number from dual;
--aqui volta o incremento para 1, para que futuras inserções funcionem normalmente
 EXECUTE IMMEDIATE 'ALTER SEQUENCE [nome_da_sequence] INCREMENT by 1';
 DBMS_OUTPUT.put_line ('A sequence [nome_da_sequence] foi atualizada.');
ELSE
 DBMS_OUTPUT.put_line ('A sequence [nome_da_sequence] NÃO foi atualizada, já estava OK!');
END IF;
END; 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-01-08T15:35:00.180

以下是如何使所有自增序列匹配实际数据：

1.  创建一个过程来强制执行下一个值，如该线程中所述：

    ```
    CREATE OR REPLACE PROCEDURE Reset_Sequence(
        P_Seq_Name IN VARCHAR2,
        P_Val      IN NUMBER DEFAULT 0)
    IS
      L_Current    NUMBER                      := 0;
      L_Difference NUMBER                      := 0;
      L_Minvalue User_Sequences.Min_Value%Type := 0;
    BEGIN
      SELECT Min_Value
      INTO L_Minvalue
      FROM User_Sequences
      WHERE Sequence_Name = P_Seq_Name;
      EXECUTE Immediate 'select ' || P_Seq_Name || '.nextval from dual' INTO L_Current;
      IF P_Val        < L_Minvalue THEN
        L_Difference := L_Minvalue - L_Current;
      ELSE
        L_Difference := P_Val - L_Current;
      END IF;
      IF L_Difference = 0 THEN
        RETURN;
      END IF;
      EXECUTE Immediate 'alter sequence ' || P_Seq_Name || ' increment by ' || L_Difference || ' minvalue ' || L_Minvalue;
      EXECUTE Immediate 'select ' || P_Seq_Name || '.nextval from dual' INTO L_Difference;
      EXECUTE Immediate 'alter sequence ' || P_Seq_Name || ' increment by 1 minvalue ' || L_Minvalue;
    END Reset_Sequence; 
    ```

2.  创建另一个过程以协调所有序列与实际内容：

    ```
    CREATE OR REPLACE PROCEDURE RESET_USER_SEQUENCES_TO_DATA
    IS
      STMT CLOB;
    BEGIN
      SELECT 'select ''BEGIN'' || chr(10) || x || chr(10) || ''END;'' FROM (select listagg(x, chr(10)) within group (order by null) x FROM ('
        || X
        || '))'
      INTO STMT
      FROM
        (SELECT LISTAGG(X, ' union ') WITHIN GROUP (
        ORDER BY NULL) X
        FROM
          (SELECT CHR(10)
            || 'select ''Reset_Sequence('''''
            || SEQ_NAME
            || ''''','' || coalesce(max('
            || COL_NAME
            || '), 0) || '');'' x from '
            || TABLE_NAME X
          FROM
            (SELECT TABLE_NAME,
              REGEXP_SUBSTR(WTEXT, 'NEW\.(\S*) IS NULL',1,1,'i',1) COL_NAME,
              REGEXP_SUBSTR(BTEXT, '(\.|\s)([a-z_]*)\.nextval',1,1,'i',2) SEQ_NAME
            FROM USER_TRIGGERS
            LEFT JOIN
              (SELECT NAME BNAME,
                TEXT BTEXT
              FROM USER_SOURCE
              WHERE TYPE = 'TRIGGER'
              AND UPPER(TEXT) LIKE '%NEXTVAL%'
              )
            ON BNAME = TRIGGER_NAME
            LEFT JOIN
              (SELECT NAME WNAME,
                TEXT WTEXT
              FROM USER_SOURCE
              WHERE TYPE = 'TRIGGER'
              AND UPPER(TEXT) LIKE '%IS NULL%'
              )
            ON WNAME             = TRIGGER_NAME
            WHERE TRIGGER_TYPE   = 'BEFORE EACH ROW'
            AND TRIGGERING_EVENT = 'INSERT'
            )
          )
        ) ;
      EXECUTE IMMEDIATE STMT INTO STMT;
      --dbms_output.put_line(stmt);
      EXECUTE IMMEDIATE STMT;
    END RESET_USER_SEQUENCES_TO_DATA; 
    ```

笔记：

1.  过程从触发器代码中提取名称并且不依赖于命名约定
2.  要在执行前检查生成的代码，请在最后两行切换注释

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2019-11-18T22:03:48.357

对我有用的存储过程

```
create or replace
procedure reset_sequence( p_seq_name in varchar2, tablename in varchar2 )
is
    l_val number;
    maxvalueid number;
begin
    execute immediate 'select ' || p_seq_name || '.nextval from dual' INTO l_val;
    execute immediate 'select max(id) from ' || tablename INTO maxvalueid;
    execute immediate 'alter sequence ' || p_seq_name || ' increment by -' || l_val || ' minvalue 0';
    execute immediate 'select ' || p_seq_name || '.nextval from dual' INTO l_val;
    execute immediate 'alter sequence ' || p_seq_name || ' increment by '|| maxvalueid ||' minvalue 0';  
    execute immediate 'select ' || p_seq_name || '.nextval from dual' INTO l_val;
    execute immediate 'alter sequence ' || p_seq_name || ' increment by 1 minvalue 0';
end; 
```

如何使用存储过程：

```
execute reset_sequence('company_sequence','company'); 
```

# winapi - GDI 和 GDI+ 中的多边形填充模式

> ID：51475
> 
> 赞同：1
> 
> 时间：2008-09-09T09:41:14.613
> 
> 标签：winapi, gdi+, gdi

当前设备上下文中的系统默认多边形填充模式是`ALTERNATE`（正如我从 Petzold 关于 Windows 编程的书中了解到的那样），并且这个[`Polygon`](http://msdn.microsoft.com/en-us/library/ms533274(VS.85).aspx)模式用于 Win32 函数，除非您使用[`SetPolyFillMode`](http://msdn.microsoft.com/en-us/library/ms536642(VS.85).aspx).

**我的问题是**：GDI+ [`Graphics::FillPolygon`](http://msdn.microsoft.com/en-us/library/ms535958(VS.85).aspx)（`FillMode`在其签名中没有参数）方法是否也使用当前设备上下文填充模式或设置众所周知的默认值，然后在调用它之前设置回模式集？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T09:43:06.950

我不知道我脑海中的答案，但您可以尝试通过在通话前后检索填充模式来找出答案。如果它没有不同，它要么没有被改变，要么被改变然后被改变回来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-26T21:31:53.187

我查看了参考源和没有填充模式的 FillPolygon，只需调用 FillPolygon，填充模式为交替。

具有填充模式的 FillPolygone 调用名为 GdipFillPolygonI 的方法，但我找不到有关该方法的任何信息。

# xml - 您知道 XML 语法的哪些可用替代方法？

> ID：51492
> 
> 赞同：28
> 
> 时间：2008-09-09T09:54:41.383
> 
> 标签：xml, syntax, yaml

对我来说，**可用**意味着：

*   它在现实世界中使用
*   它有工具支持。（至少一些简单的编辑器）
*   它具有人类可读的语法（请不要使用尖括号）

此外，我希望它尽可能接近 XML，即必须支持属性和属性。所以，请不要[使用 YAML](http://en.wikipedia.org/wiki/YAML)。目前，我想到的只有一种匹配的语言 - [JSON](http://en.wikipedia.org/wiki/JSON)。你知道其他的选择吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-04-02T16:53:50.263

YAML 是 JSON 的 100% 超集，因此拒绝 YAML 然后考虑使用 JSON 是没有意义的。YAML 完成了 JSON 所做的一切，但 YAML 也提供了更多功能（如引用）。

除了使用 DTD 验证文档之外，我想不出任何 XML 可以做 YAML 做不到的事情，根据我的经验，这从来不值得付出这些开销。但是 YAML 比 XML 更快、更容易输入和阅读。

至于属性或属性，如果您考虑一下，它们并没有真正“添加”任何东西......这只是将某些东西写为节点的属性而不是将其放在自己的子节点中的符号快捷方式。但是，如果您喜欢这种便利，您通常可以使用 YAML 的内联列表/哈希来模拟它。例如：

```
<!-- XML -->
<Director name="Spielberg">
    <Movies>
        <Movie title="Jaws" year="1975"/>
        <Movie title="E.T." year="1982"/>
    </Movies>
</Director>

# YAML
Director: 
    name: Spielberg
    Movies:
      - Movie: {title: E.T., year: 1975}
      - Movie: {title: Jaws, year: 1982} 
```

对我来说，不必为每个节点标签编写两次的奢侈，再加上免于所有尖括号垃圾的自由，使 YAML 成为首选。实际上，我还喜欢缺少正式的标记属性，因为在我看来，这似乎总是 XML 的灰色区域，它不必要地为基本相同的概念引入了两组语法（在编写和遍历时）。YAML 完全消除了这种混淆。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-09T09:56:13.673

[JSON](http://www.json.org/)是一个很好的替代方案，并且有多种语言的工具。它在网络客户端中非常容易使用，因为它是原生 javascript。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-08-19T09:19:13.107

# TL;博士

这里没有提到 Prolog，但它是我所知道的用于表示数据的最佳格式。Prolog 程序本质上描述了实体之间具有复杂关系的数据库。Prolog 解析起来非常简单，其唯一的竞争对手可能是该域中的 S 表达式。

# 完整版本

程序员经常“忘记” XML 的实际组成部分。通常指的是它的一小部分。XML 是一种非常复杂的格式，至少包含以下部分：[DTD 模式语言](https://www.w3.org/TR/xmlschema-1/)、[XSD 模式语言](https://www.w3.org/TR/xmlschema11-1/)、[XSLT 转换语言](https://www.w3.org/TR/xslt20/)、[RNG 模式语言](https://www.oasis-open.org/committees/relax-ng/spec-20011203.html)和[XPath](https://www.w3.org/TR/xpath-31/)（加上 XQuery）语言——它们都是 XML 标准的一部分。另外，还有一些像[E4X](http://www.ecma-international.org/publications/files/ECMA-ST-WITHDRAWN/Ecma-357.pdf)这样的伪经。它们中的每一个都有自己的版本、相当多的重叠、不兼容等。在野外很少有 XML 解析器实现所有这些。更不用说流行解析的多个怪癖和错误，其中一些会导致显着的安全问题，例如[https://en.wikipedia.org/wiki/XML_external_entity_attack](https://en.wikipedia.org/wiki/XML_external_entity_attack)。

因此，寻找 XML*替代方案*并不是一个好主意。您可能根本不想处理 XML 之类的东西。

YAML 可能是第二差的选择。它没有 XML 大，但它的设计也是为了覆盖所有基础......每个基础超过十次......以无人能想到的不同和独特的方式。我还没有听说过一个正常工作的 YAML 解析器。Ruby 是一种经常使用 YAML 的语言，它因此出了名的[搞砸了](https://www.sitepoint.com/anatomy-of-an-exploit-an-in-depth-look-at-the-rails-yaml-vulnerability/)。迄今为止我见过的所有 YAML 解析器都是[libyaml的副本](https://bitbucket.org/xi/libyaml)，它本身是一种手写的（不是从正式描述生成的）类型的解析器，其代码的正确性非常难以验证（函数跨越数百行，控制流复杂）。正如已经提到的，它完全包含 JSON……在少数 Unicode 编码技术之上……在同一个文档中，可能还有一堆你不想听到的其他东西。

另一方面，JSON 与其他两个完全不同。您可以在等待从 Maven Nexus 下载 JSON 解析器工件时编写 JSON 解析器。它可以做的很少，但至少你知道它的能力。没有惊喜。（除了与字符串中的字符转义和双打编码有关的一些差异）。没有隐蔽的利用。你不能在里面写评论。多行字符串看起来很糟糕。无论您所说的属性和属性之间的区别是什么，您都可以通过更多嵌套的字典来实现。

假设，尽管您想纠正 XML 的错误……好吧，那么流行的东西，如 YAML 或 JSON 就不会这样做。不知何故，时尚和理性思维在七十年代中期的某个时候分道扬镳。所以，你必须回到从 McCarthy、Hoare、Codd 和 Kowalski 开始的地方，弄清楚你想要表达的是什么，然后看看对于你是什么来说，最好的表达技术是什么试图代表:)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-11T15:03:57.323

我发现[S-Expressions](http://en.wikipedia.org/wiki/S-expression)是表示结构化数据的好方法。这是一种非常简单的格式，易于生成和解析。它不支持属性，但像 YAML 和 JSON 一样，它不需要。属性只是 XML 限制冗长的一种方式。更简单、更清晰的格式只是不需要它们。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-09T10:17:59.300

[杰夫在这里](http://www.codinghorror.com/blog/archives/001114.html)和[这里](http://www.codinghorror.com/blog/archives/001139.html)写了这篇文章。这应该可以帮助您入门。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-09T10:20:41.150

你的要求有点不可能。你想要一些接近 XML 的东西，但可能拒绝最接近的没有尖括号 (YAML) 的等价物。

尽管我不喜欢它，为什么不直接使用 XML？您永远不必真正阅读 XML（我想除了调试之外），有大量荒谬的工具可供使用。

几乎所有不是 XML 的东西都不会被广泛使用，因此工具支持会更少。

JSON 可能是等效的，但它几乎同样不可读.. 但同样，您不必实际阅读它（将其加载到您使用的任何语言中，并且应该将其转换为本机数组/字典/变量/任何）。

哦，我确实发现 JSON*比*XML 更易于解析：我在 Javascript 和 simplejson Python 模块中使用过它 - 关于一个命令，它很好地转换为原生 Python dict 或 Javascript 对象（因此得名！）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-05-09T20:48:59.843

[AXON](http://intellimath.bitbucket.org/axon)涵盖了最好的 XML 和 JSON 。让我们用几个例子来解释一下。

**AXON 可以被认为是 XML 数据的较短形式。**

XML

```
<person>
   <name>Frank Martin</name>
   <age>32</age>
 </person> 
```

轴突

```
person{
  name{"Frank Martin"}
  age{32}} 
```

或者

```
person
  name:
    "Frank Martin"
  age:
    32 
```

XML

```
<person name="Frank Martin" age="32" /> 
```

轴突

```
person{name:"Frank Martin" age:32} 
```

或者

```
person
  name: "Frank Martin"
  age: 32 
```

**AXON 包含某种形式的 JSON。**

JSON

```
{"name":"Frank Martin" "age":32 "birth":"1965-12-24"} 
```

轴突

```
{name:"Frank Martin" age:32 birth:1965-12-24} 
```

**AXON 可以表示类 XML 和类 JSON 数据的组合。**

轴突

```
table {
  fields {
    ("id" "int") ("val1" "double") ("val2" "int") ("val3" "double")
  }
  rows {
    (1 3.2 123 -3.4)
    (2 3.5 303 2.4)
    (3 2.3 235 -1.2)
  }
} 
```

或者

```
table
  fields
    ("id" "int")
    ("val1" "double")
    ("val2" "int") 
    ("val3" "double")
  rows
    (1 3.2 123 -3.4)
    (2 3.5 303 2.4)
    (3 2.3 235 -1.2) 
```

现在有可用的 python 库[pyaxon](http://pypi.python.org/pypi/pyaxon)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-09T09:58:21.593

我会推荐 JSON ......但既然你已经提到它，也许你应该看看[Google 协议缓冲区](http://google-opensource.blogspot.com/2008/07/protocol-buffers-googles-data.html)。

编辑：协议缓冲区以编程方式使用（有 c++、java、python 的绑定...），因此它们可能不适合您的目的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-09T09:59:22.183

我认为[Clearsilver](http://www.clearsilver.net/)是一个很好的选择。他们甚至在[这里](http://www.clearsilver.net/docs/compare_w_xmlxslt.hdf)有一个比较页面和一个使用它的[项目](http://www.clearsilver.net/examples.hdf)列表

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-04T10:38:16.637

YAML 是功能极其齐全且通常人类可读的格式，但它的致命弱点是复杂性，正如我们今年冬天看到的 Rails 漏洞所证明的那样。由于 Ruby 作为一种配置语言在 Ruby 中无处不在，Github 的 Tom Preston-Werner 加紧创建了一个名为 TOML 的合理替代方案。它立即获得了巨大的吸引力，并具有强大的工具支持。我强烈建议任何查看 YAML 的人检查一下：

[https://github.com/mojombo/toml](https://github.com/mojombo/toml)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-12-03T22:19:21.097

对于存储类似代码的数据，[LES](http://loyc.net/les/)（Loyc 表达式语法）是一种新兴的替代方案。我注意到很多人将 XML 用于类似代码的构造，例如支持条件、命令调用，有时甚至是循环的构建系统。这些事情在 LES 中看起来很自然：

```
// LES code has no built-in meaning. This just shows what it looks like.
[DelayedWrite]
Output(
    if version > 4.0 {
        $ProjectDir/Src/Foo;
    } else {
        $ProjectDir/Foo;
    }
); 
```

不过，它还没有很好的工具支持。目前唯一的 LES 库是用于 C# 的。目前已知只有一个应用程序使用 LES：[LLLPG](http://www.codeproject.com/Articles/664785/A-New-Parser-Generator-for-Csharp)。它支持“属性”，但它们类似于 C# 属性或 Java 注释，而不是 XML 属性。

从理论上讲，您可以将 LES 用于数据或标记，但没有关于如何做到这一点的标准：

```
body {
    '''Click here to use the World's '''
    a href="http://google.com" {
        strong "most popular"; " search engine!"
    };
};

point = (2, -3);
tasteMap = { "lemon" -> sour; "sugar" -> sweet; "grape" -> yummy }; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-09T10:38:56.860

如果您对尖括号过敏，那么 JSON、[HDF](http://www.clearsilver.net/docs/man_hdf.hdf) (ClearSilver) 和[OGDL](http://ogdl.sourceforge.net/)是我唯一知道的。

经过一番谷歌搜索，我还在这里找到了一个替代列表：http:
[//web.archive.org/web/20060325012720/www.pault.com/xmlalternatives.html](http://web.archive.org/web/20060325012720/www.pault.com/xmlalternatives.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-09T10:53:37.450

AFAIK、JSON 和 YAML 在数据结构方面是完全等价的。YAML 只是少了括号和引号之类的东西。所以我看不出你是如何拒绝一个并保留另一个。

此外，我看不出 XML 的尖括号比 JSON 的方括号、大括号和引号更不“可读”。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-02T07:06:45.023

XML 的替代品确实有很多，但其中许多的主要问题似乎是库可能不适用于每种选择的语言，而且这些库的实现相对困难。

如果与键值对（例如哈希表）相比，解析树结构本身可能并不那么令人愉快。如果一个哈希表实例满足了它的所有键都是字符串并且它的所有值都是字符串的要求，那么实现 hashtable2string() 和 string2hashtable() 就相对不费力了。

我一直在 PHP 和 JavaScript 之间的 AJAX 中使用哈希表序列化以及我开发的格式，称为 ProgFTE（程序员友好文本交换），并在以下位置进行了描述：

[http://martin.softf1.com/g/n//a2/doc/progfte/index.html](http://martin.softf1.com/g/n//a2/doc/progfte/index.html)

可以在 Kibuvits Ruby 库中找到 ProgFTE 实现的 Ruby 版本： [http ://rubyforge.org/projects/kibuvits/](http://rubyforge.org/projects/kibuvits/)

# perl - 在 Perl 中应用编码标准是否有任何好的自动化框架？

> ID：51499
> 
> 赞同：9
> 
> 时间：2008-09-09T10:01:06.640
> 
> 标签：perl, frameworks, coding-style, perl-critic

我知道的一个是[Perl::Critic](http://search.cpan.org/dist/Perl-Critic/)

到目前为止，我的谷歌搜索多次尝试都没有结果。:-(

有人在这里有什么建议吗？

任何根据我们的编码标准配置 Perl::Critic 并在代码库上运行它的资源将不胜感激。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-15T13:12:17.130

在设置个人资料方面，您尝试过`perlcritic --profile-proto`吗？这会将您安装的所有策略及其所有选项以及两者的描述（包括它们的默认值）以 perlcriticrc 格式发送到标准输出。保存并编辑以匹配您想要的内容。每当您升级 Perl::Critic 时，您可能希望再次运行此命令并与您当前的 perlcriticrc 进行比较，以便您可以查看对现有策略的任何更改并选择任何新策略。

在定期运行 perlcritic 方面，设置一个[Test::Perl::Critic](http://search.cpan.org/dist/Test-Perl-Critic/)测试以及其他测试。这对新代码有好处。

对于您现有的代码，请改用[Test::Perl::Critic::Progressive](http://search.cpan.org/dist/Test-Perl-Critic-Progressive/)。T::P::C::Progressive 在你第一次运行时会成功，但会保存违规次数；此后，如果任何计数上升，T::P::C::Progressive 将抱怨。需要注意的一件事是当您恢复源代码控制系统中的更改时。（您正在使用一个，不是吗？）假设我签入更改并运行测试，并且我的更改减少了 P::C 违规的数量。后来，事实证明我的更改很糟糕，所以我恢复到旧代码。由于计数减少，T::P::C::Progressive 测试将失败。此时最简单的做法是删除历史文件（默认位置 t/.perlcritic-history）并再次运行。它应该重现您的旧计数，并且您可以编写新内容以再次降低它们。

Perl::Critic 附带了很多策略，但是有一堆策略的附加分发。看看[Task::Perl::Critic](http://search.cpan.org/dist/Task-Perl-Critic/)和 [Task::Perl::Critic::IncludingOptionalDependencies](http://search.cpan.org/dist/Task-Perl-Critic-IncludingOptionalDependencies/)。

您不需要让一个 perlcriticrc 处理您的所有代码。为要测试的每组文件创建单独的 perlcriticrc 文件，然后为每个文件创建一个单独的测试。例如，在[http://perlcritic.tigris.org/source/browse/perlcritic/trunk/Perl-Critic/xt/author/](http://perlcritic.tigris.org/source/browse/perlcritic/trunk/Perl-Critic/xt/author/)上查看 P::C 本身的作者测试。运行作者测试时，有一个测试运行 P::C 的所有代码，第二个测试仅在策略上应用附加规则，第三个测试批评 P::C 的测试。

我个人认为每个人都应该在“残酷”的严重级别上运行，但要淘汰他们不同意的政策。Perl::Critic 并不完全自律；即使是 P::C 开发人员也不同意康威所说的一切。查看 Perl::Critic 本身使用的 perlcriticrc 文件，并在 Perl::Critic 代码中搜索“## nocritic”的实例；我现在数了143。

（是的，我是 Perl::Critic 开发人员之一。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T10:41:18.370

[大多数文体](http://perltidy.sourceforge.net/)标准都有不同之处。perlcritic 可以使用[.perlcritic 文件](http://search.cpan.org/~thaljef/Perl-Critic-1.092/lib/Perl/Critic.pm#CONFIGURATION)轻松配置。我个人在一级使用它，但我禁用了一些策略。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-10T20:40:45.657

除了“自动化框架”，我强烈推荐 Damian Conway 的*Perl Best Practices*。我不同意 100% 的他的建议，但大多数时候他都在努力。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T22:03:31.353

上面提到[Devel::Prof](http://metacpan.org/pod/Devel::Prof)的帖子可能真的意味着[Devel::Cover](http://metacpan.org/pod/Devel::Cover)（获取测试套件的代码覆盖率）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-09T10:20:42.147

像：

*   [http://metacpan.org/pod/Perl::Critic](http://metacpan.org/pod/Perl::Critic)
*   [http://www.slideshare.net/joshua.mcadams/an-introduction-to-perl-critic/](http://www.slideshare.net/joshua.mcadams/an-introduction-to-perl-critic/)

看起来是个不错的工具！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T09:43:49.300

一个很好的组合是 perlcritic 与 EPIC for Eclipse - hit `CTRL`- `SHIFT`- `C`（或您首选的配置快捷方式），并且您的代码在 perlcritic 发现有问题的地方用警告指示器标记​​。比记得在签入前运行它要好得多。与 perlcritic 一样，它会获取您的 .perlcriticrc 以便您可以自定义规则。我们将 .perlcriticrc 保存在版本控制中，以便每个人都获得相同的标准。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T09:24:24.127

除了美观的最佳实践之外，我总是发现在我的单元测试套件上运行 Devel::Prof 来检查测试覆盖率很有用。

# linux - 在哪里可以找到在 linux 2.6.21.5-cfs-v19 上运行的 arm 目标的 gdb

> ID：51501
> 
> 赞同：0
> 
> 时间：2008-09-09T10:04:03.467
> 
> 标签：linux, gdb, arm

我有一个基于 ARM11 的硬件板，它运行 Linux 内核版本。2.6.21.5-cfs-v19。我的应用程序在这个 ARM-LINUX 板上运行。为了进行源代码级调试，我曾经在 linux 板的命令提示符下使用 gdb 的应用程序，这是与板 linux 版本的一些早期版本一起使用的。

使用这个版本 2.6.21.5-cfs-v19，我没有用于板子的相关版本的 gdb。我试图四处寻找这个版本的 linux 的 gdb 和它的 arm 端口，但没有多大成功。谁能指出我可以在哪里获得用于上述操作系统和板配置的 gdb 的独立可执行文件或相同的源，我可以尝试为该目标编译。

-广告。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T21:50:41.860

前段时间我发表了[一篇](http://www.linux.com/feature/121735)关于使用 GDB 和 GDBServer 进行跨目标调试的文章。那里的目标处理器是PPC7450，但它相当详细，所以也许你会发现它很有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T12:03:57.907

[使用OpenEmbedded](http://wiki.openembedded.net/index.php/Main_Page)可能会有一些运气。如果没有可以立即使用的预编译版本，那么设置一个 OE 交叉编译环境并不难。

另一种选择可能是在板上安装 gdb-server，如[本博](http://dominion.thruhere.net/koen/cms/using-gdbserver)文中所述。

# python - 提高 Python 的可读性？

> ID：51502
> 
> 赞同：4
> 
> 时间：2008-09-09T10:05:36.770
> 
> 标签：python, readability

最近我真的很喜欢 Python 编程。我来自一个对基于 C 的编码的强烈热爱的背景，在那里一切可能都比它应该的更复杂（但至少在你的胸前有头发）。因此，对于不需要大量速度的更复杂的事情，从 C 语言切换到 Python 对编写项目来说更像是一个福音而不是祸根。

然而，从肉眼所见的方括号、括号和结构的土地上，我遇到了一个小问题：我发现 Python 难以阅读。

例如，除非我盯着它看，否则我很难解读以下文本块（我不喜欢这样做）：

```
if foo:
   bar = baz
   while bar not biz:
      bar = i_am_going_to_find_you_biz_i_swear_on_my_life()

did_i_not_warn_you_biz()
my_father_is_avenged() 
```

问题出现在 if 块的末尾：所有的标签然后突然回到一个不和谐的块感觉几乎令人不安。作为一种解决方案，我开始像这样编写我的 Python 代码：

```
if foo:
   bar = baz
   while bar not biz:
      bar = i_am_going_to_find_you_biz_i_swear_on_my_life()
   #-- while --
#-- if --

did_i_not_warn_you_biz()
my_father_is_avenged() 
```

出于某种奇怪的原因，这让我更能阅读自己的代码。但我很好奇：有没有其他人遇到我的奇怪问题找到更简单的方法来使他们的标签式代码更具可读性？在这对我来说成为一个巨大的习惯之前，我很想知道是否有更好的方法来做到这一点。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-09T14:58:52.277

学习一门新的编程语言的一部分是学习阅读该语言的代码。像这样的拐杖可能会让你更容易阅读自己的代码，但它会阻碍学习如何阅读其他人的 Python 代码的过程。我真的认为你最好摆脱块注释的结尾并习惯普通的 Python。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-09T10:33:05.457

我喜欢在块周围放置空白行以使控制流更加明显。例如：

```
if foo:
   bar = baz

   while bar not biz:
      bar = i_am_going_to_find_you_biz_i_swear_on_my_life()

did_i_not_warn_you_biz()
my_father_is_avenged() 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-09T10:08:28.183

您可以尝试增加缩进大小，但总的来说，我只想说，放松，它会随着时间的推移而出现。我不认为试图让 Python 看起来像 C 是一个很好的主意。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-09T10:43:27.803

与其专注于使现有结构更具可读性，不如专注于构建更具逻辑性的结构。制作更小的块，尽量不要过度嵌套块，制作更小的函数，并尝试更多地思考你的代码流。

如果您无法快速确定代码的结构，您可能应该考虑重构并添加一些注释。代码流应该总是立即显现出来——你想得越多，你的代码就越难维护。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T10:24:46.787

也许最好的办法是在您的编辑器中打开“显示空白”。然后你会看到每行标签的距离（通常是一堆点），当它发生变化时会更加明显。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-16T15:40:49.153

```
from __future__ import braces 
```

需要我多说？:)

说真的，[PEP 8](http://www.python.org/dev/peps/pep-0008/) 'Blank lines', §4 是官方的做法。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-09T15:09:04.137

我会考虑了解有关 Python 语法的更多细节。通常，如果一段代码看起来很奇怪，通常有更好的方法来编写它。例如，在上面的例子中：

```
bar = foo if baz else None
while bar not biz:
    bar = i_am_going_to_find_you_biz_i_swear_on_my_life()

did_i_not_warn_you_biz()
my_father_is_avenged() 
```

虽然这是一个很小的变化，但它可能有助于提高可读性。另外，老实说，我从来没有使用过 while 循环，所以有一个很好的改变，你最终会得到一个简洁的列表理解或 for 循环。;)

# beta - 如何只制作网站测试版的某些部分？

> ID：51519
> 
> 赞同：2
> 
> 时间：2008-09-09T10:18:13.370
> 
> 标签：beta

大多数网站要么完全发布，要么处于测试阶段。

但是，如果您有一个大型站点，并且其中一些部分仍处于测试阶段，而其他部分则不是，会发生什么情况。

你如何有效地与客户沟通？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T10:26:51.803

也许看看 Facebook、Bloglines、Gmail 是如何做到的？

就像“我们正在进行这个测试版，过来看看有新东西的同一个网站，但如果它不起作用，请使用旧部分”

也许你可以注册“测试版功能”的 gmail 实验室

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T10:22:08.557

如果您以某种方式进入测试版网站的一部分，也许您可​​以弹出一个模式，他们每次都必须同意。我不会在每个页面上都有它，因为它很烦人，所以如果有确定的方法可以进入网站的那部分，我只会使用这种方法（例如，人们不会来到 beta 部分的随机部分通过谷歌或其他东西）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T10:23:57.163

我用于非网络软件的一种方法是改变背景。因此，例如，如果您的普通站点倾向于具有纯白色背景，则可以让 beta 站点在背景图像中具有重复的 beta 文本。您想让它变得相当微弱，以便它存在但不会影响整体体验。

另一个微妙但存在的选项就是更改标题栏。

或者你可以像谷歌那样做，这是一个大型网站，其中一些处于测试阶段。查看[Google 实验性搜索](http://www.google.com/experimental/)。基本上该站点没有什么不同，但很难意外到达。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T10:26:21.680

有几种方法。

1.  通过两个域（例如*www.domain.com*和*beta.domain.com ）提供对站点的访问，并且只允许通过**beta.domain.com*访问站点的 beta 部分。

    人们将访问相同的代码库，但只有在指定了 beta 子域后才能访问 beta 部分。尝试访问网站的测试版部分将解释这一点并告诉他们如何访问测试版。

2.  强烈将应用程序的 beta 部分标记为 beta，并强制用户承认他们可以使用带有某种协议屏幕的 beta 功能。当他们第一次尝试使用测试版功能时，他们会看到协议屏幕。该功能的后续使用将突出显示“该网站的 thios 部分处于测试阶段，使用后果自负。”

# python - 如何在 Python 中获取绝对文件路径

> ID：51520
> 
> 赞同：928
> 
> 时间：2008-09-09T10:19:32.727
> 
> 标签：python, path, relative-path, absolute-path

给定一个路径，例如`"mydir/myfile.txt"`，如何在 Python 中找到文件相对于当前工作目录的绝对路径？例如在 Windows 上，我可能会得到：

```
"C:/example/cwd/mydir/myfile.txt" 
```

* * *

## 回答 #1

> 赞同：1354
> 
> 时间：2008-09-09T10:21:03.987

```
>>> import os
>>> os.path.abspath("mydir/myfile.txt")
'C:/example/cwd/mydir/myfile.txt' 
```

如果它已经是绝对路径也可以：

```
>>> import os
>>> os.path.abspath("C:/example/cwd/mydir/myfile.txt")
'C:/example/cwd/mydir/myfile.txt' 
```

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2014-10-24T01:05:02.140

您可以使用新的 Python 3.4 库`pathlib`。（您也可以使用 . 为 Python 2.6 或 2.7 获取它`pip install pathlib`。）作者[写道](http://www.python.org/dev/peps/pep-0428/#abstract)：“这个库的目的是提供一个简单的类层次结构来处理文件系统路径和用户对其执行的常见操作。”

在 Windows 中获取绝对路径：

```
>>> from pathlib import Path
>>> p = Path("pythonw.exe").resolve()
>>> p
WindowsPath('C:/Python27/pythonw.exe')
>>> str(p)
'C:\\Python27\\pythonw.exe' 
```

或者在 UNIX 上：

```
>>> from pathlib import Path
>>> p = Path("python3.4").resolve()
>>> p
PosixPath('/opt/python3/bin/python3.4')
>>> str(p)
'/opt/python3/bin/python3.4' 
```

文档在这里：[https ://docs.python.org/3/library/pathlib.html](https://docs.python.org/3/library/pathlib.html)

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-12T06:53:25.507

安装一个第三方[路径模块](https://github.com/jaraco/path)（在 上找到[`PyPI`](https://pypi.org/project/path/)），它将所有函数和其他相关函数包装`os.path`到一个对象上的方法中，可以在使用字符串的任何地方使用：

```
>>> from path import path
>>> path('mydir/myfile.txt').abspath()
'C:\\example\\cwd\\mydir\\myfile.txt' 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2019-03-07T00:56:38.690

```
import os
os.path.abspath(os.path.expanduser(os.path.expandvars(PathNameString))) 
```

请注意，如果文件（或目录）名称和位置的给定表达式可能包含前导（波浪号指用户的主目录），并且处理任何其他环境变量（如），则这`expanduser`是必需的（在 Unix 上）。`~/``expandvars``$HOME`

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2018-12-27T20:41:38.840

Python 3.4+[`pathlib`](https://docs.python.org/3/library/pathlib.html)的更新实际上回答了这个问题：

```
from pathlib import Path

relative = Path("mydir/myfile.txt")
absolute = relative.absolute()  # absolute is a Path object 
```

如果您只需要一个临时字符串，请记住，您可以使用`Path`具有所有相关功能的对象[`os.path`](https://docs.python.org/3/library/os.path.html)，当然包括[`abspath`](https://docs.python.org/3/library/os.path.html#os.path.abspath)：

```
from os.path import abspath

absolute = abspath(relative)  # absolute is a str object 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2013-03-10T17:11:57.077

今天你也可以使用`unipath`基于`path.py`：[http ://slugo.scrapping.cc/python/unipath/的包](http://sluggo.scrapping.cc/python/unipath/)

```
>>> from unipath import Path
>>> absolute_path = Path('mydir/myfile.txt').absolute()
Path('C:\\example\\cwd\\mydir\\myfile.txt')
>>> str(absolute_path)
C:\\example\\cwd\\mydir\\myfile.txt
>>> 
```

我建议使用这个包，因为它为[常见的 os.path 实用程序提供了一个干净的接口](http://sluggo.scrapping.cc/python/unipath/Unipath-current/README.html)。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2019-02-28T15:26:52.820

这**总是**获得当前脚本的正确文件名，即使它是从另一个脚本中调用的。使用时特别有用`subprocess`。

```
import sys,os

filename = sys.argv[0] 
```

从那里，您可以通过以下方式获取脚本的完整路径：

```
>>> os.path.abspath(filename)
'/foo/bar/script.py' 
```

它还可以通过`/..`在目录层次结构中“向上”附加任意多次来更轻松地导航文件夹。

要获取 cwd：

```
>>> os.path.abspath(filename+"/..")
'/foo/bar' 
```

对于父路径：

```
>>> os.path.abspath(filename+"/../..")
'/foo' 
```

通过`"/.."`与其他文件名组合，您可以访问系统中的任何文件。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-08-30T14:44:28.137

您可以使用它来获取特定文件的绝对路径。

```
from pathlib import Path

fpath = Path('myfile.txt').absolute()

print(fpath) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-04-03T21:12:44.600

如果你在 Mac 上

```
import os
upload_folder = os.path.abspath("static/img/users") 
```

这将为您提供完整的路径：

```
print(upload_folder) 
```

将显示以下路径：

```
>>>/Users/myUsername/PycharmProjects/OBS/static/img/user 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2022-02-08T06:20:05.677

> 给定一个路径，例如`mydir/myfile.txt`，如何在 Python 中找到文件相对于当前工作目录的绝对路径？

我会这样做，

```
import os.path
os.path.join( os.getcwd(), 'mydir/myfile.txt' ) 
```

那返回`'/home/ecarroll/mydir/myfile.txt'`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-07-04T19:09:56.030

如果有人使用 python 和 linux 并寻找文件的完整路径：

```
>>> path=os.popen("readlink -f file").read()
>>> print path
abs/path/to/file 
```

# c# - 更改结构列表中元素的值

> ID：51526
> 
> 赞同：74
> 
> 时间：2008-09-09T10:23:29.503
> 
> 标签：c#, struct, value-type

我有一个结构列表，我想更改一个元素。例如 ：

```
MyList.Add(new MyStruct("john");
MyList.Add(new MyStruct("peter"); 
```

现在我想改变一个元素：

```
MyList[1].Name = "bob" 
```

但是，每当我尝试这样做时，都会出现以下错误：

> 无法修改 System.Collections.Generic.List.this[int]' 的返回值，因为它不是变量

如果我使用类列表，则不会出现问题。

我想答案与结构是一种值类型有关。

那么，如果我有一个结构列表，我应该将它们视为*只读*吗？如果我需要更改列表中的元素，那么我应该使用类而不是结构吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-09T10:56:06.587

不完全的。将类型设计为类或结构不应由您将其存储在集合中的需要驱动:) 您应该查看所需的“语义”

您看到的问题是由于值类型语义。每个值类型变量/引用都是一个新实例。当你说

```
Struct obItem = MyList[1]; 
```

发生的情况是创建了一个新的结构实例，并且所有成员都被一一复制。这样您就有了 MyList[1] 的克隆，即 2 个实例。现在如果你修改obItem，它不会影响原来的。

```
obItem.Name = "Gishu";  // MyList[1].Name still remains "peter" 
```

现在在这里忍受我 2 分钟（这需要一段时间才能吞下.. 这对我来说确实如此:) 如果您确实需要将结构存储在集合中并像您在问题中指出的那样进行修改，您将不得不您的结构公开一个接口（*但是这将导致装箱*）。然后，您可以通过引用装箱对象的接口引用来修改实际结构。

下面的代码片段说明了我刚才所说的

```
public interface IMyStructModifier
{
    String Name { set; }
}
public struct MyStruct : IMyStructModifier ...

List<Object> obList = new List<object>();
obList.Add(new MyStruct("ABC"));
obList.Add(new MyStruct("DEF"));

MyStruct temp = (MyStruct)obList[1];
temp.Name = "Gishu";
foreach (MyStruct s in obList) // => "ABC", "DEF"
{
    Console.WriteLine(s.Name);
}

IMyStructModifier temp2 = obList[1] as IMyStructModifier;
temp2.Name = "Now Gishu";
foreach (MyStruct s in obList) // => "ABC", "Now Gishu"
{
    Console.WriteLine(s.Name);
} 
```

HTH。好问题。
**更新：** @Hath - 你让我跑来检查我是否忽略了这么简单的事情。（如果 setter 属性和方法没有，那将是不一致的 - .Net 宇宙仍然是平衡的 :)
*Setter 方法不起作用*
obList2[1] 返回一个其状态将被修改的副本。列表中的原始结构保持不变。所以 Set-via-Interface 似乎是唯一的方法。

```
List<MyStruct> obList2 = new List<MyStruct>();
obList2.Add(new MyStruct("ABC"));
obList2.Add(new MyStruct("DEF"));
obList2[1].SetName("WTH");
foreach (MyStruct s in obList2) // => "ABC", "DEF"
{
    Console.WriteLine(s.Name);
} 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-09T10:27:56.700

```
MyList[1] = new MyStruct("bob"); 
```

C# 中的结构几乎总是被设计为不可变的（也就是说，一旦它们被创建就无法改变它们的内部状态）。

在您的情况下，您要做的是替换指定数组索引中的整个结构，而不是尝试仅更改单个属性或字段。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-09T22:22:50.867

结构并不是“不可变的”。

真正的根本问题是结构是值类型，而不是引用类型。因此，当您从列表中拉出对结构的“引用”时，它正在创建整个结构的新副本。因此，您对其所做的任何更改都会更改副本，而不是列表中的原始版本。

像 Andrew 所说，您必须替换整个结构。就这一点而言，尽管我认为您必须首先问自己为什么要使用结构（而不​​是类）。确保您没有围绕过早的优化问题进行操作。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-12-19T07:59:41.553

具有暴露字段或允许通过属性设置器进行突变的结构没有任何问题。然而，响应方法或属性获取器而发生变异的结构是危险的，因为系统将允许在临时结构实例上调用方法或属性获取器；如果方法或 getter 对结构进行更改，这些更改最终将被丢弃。

不幸的是，正如您所注意到的，.net 中内置的集合在暴露其中包含的值类型对象方面确实很弱。您最好的选择通常是执行以下操作：

```
  MyStruct temp = myList[1];
  temp.Name = "阿尔伯特";
  我的列表 [1] = 温度；

```

有点烦人，而且根本不是线程安全的。仍然是对类类型 List 的改进，其中做同样的事情可能需要：

```
  myList[1].Name = "阿尔伯特";

```

但它可能还需要：

```
  myList[1] = myList[1].Withname("Albert");

```

或许

```
  myClass temp = (myClass)myList[1].Clone();
  temp.Name = "阿尔伯特";
  我的列表 [1] = 温度；

```

或者可能是其他一些变化。除非检查 myClass 以及将事物放入列表的其他代码，否则真的无法知道。如果不检查无权访问的程序集中的代码，则完全有可能无法知道第一种形式是否安全。相比之下，如果 Name 是 MyStruct 的一个公开字段，那么我为更新它提供的方法将起作用，无论 MyStruct 包含什么其他内容，或者无论在代码执行之前 myList 可能做了什么其他事情，或者他们可能期望什么之后做。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-07-05T02:39:00.327

除了其他答案之外，我认为解释编译器抱怨的原因可能会有所帮助。

当您调用 时`MyList[1].Name`，与数组不同，它`MyList[1]`实际上是在后台调用索引器方法。

每当方法返回结构的实例时，您都会获得该结构的副本（除非您使用 ref/out）。

因此，您将获得一个副本并在副本`Name`上设置属性，该副本即将被丢弃，因为该副本没有存储在任何地方的变量中。

[本](http://reinventingthewheel.azurewebsites.net/ModifyStruct.aspx)教程更详细地描述了正在发生的事情（包括生成的 CIL 代码）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-27T02:31:37.157

从 C#9 开始，我不知道有任何方法可以通过引用从通用容器中提取结构，包括`List<T>`. 正如杰森奥尔森的回答所说：

*真正的根本问题是结构是值类型，而不是引用类型。因此，当您从列表中拉出对结构的“引用”时，它正在创建整个结构的新副本。因此，您对其所做的任何更改都会更改副本，而不是列表中的原始版本。*

所以，这可能是非常低效的。SuperCat 的答案，即使它是正确的，通过将更新的结构复制回列表来加剧效率低下。

如果您对最大化结构的性能感兴趣，请使用数组而不是`List<T>`. 数组中的索引器返回对结构的引用，并且不像`List<T>`索引器那样复制整个结构。此外，数组比`List<T>`.

如果您需要随着时间的推移增加数组，那么创建一个类似 的泛型类`List<T>`，但在下面使用数组。

有一个替代解决方案。创建一个包含该结构的类并创建公共方法来调用该结构的方法以获得所需的功能。使用 a`List<T>`并为 T 指定类。该结构也可以通过 ref 返回方法或 ref 属性返回，该方法返回对该结构的引用。

这种方法的优点是它可以与任何通用数据结构一起使用，例如`Dictionary<TKey, TValue>`. 当从 a 中拉出一个结构时`Dictionary<TKey, TValue>`，它也会将该结构复制到一个新实例中，就像`List<T>`. 我怀疑所有 C# 通用容器都是如此。

代码示例：

```
public struct Mutable
{
   private int _x;

   public Mutable(int x)
   {
      _x = x;
   }

   public int X => _x; // Property

   public void IncrementX() { _x++; }
}

public class MutClass
{
   public Mutable Mut;
   //
   public MutClass()
   {
      Mut = new Mutable(2);
   }

   public MutClass(int x)
   {
      Mut = new Mutable(x);
   }

   public ref Mutable MutRef => ref Mut; // Property

   public ref Mutable GetMutStruct()
   {
      return ref Mut;
   }
}

private static void TestClassList()
{
   // This test method shows that a list of a class that holds a struct
   // may be used to efficiently obtain the struct by reference.
   //
   var mcList = new List<MutClass>();
   var mClass = new MutClass(1);
   mcList.Add(mClass);
   ref Mutable mutRef = ref mcList[0].MutRef;
   // Increment the x value defined in the struct.
   mutRef.IncrementX();
   // Now verify that the X values match.
   if (mutRef.X != mClass.Mut.X)
      Console.Error.WriteLine("TestClassList: Error - the X values do not match.");
   else
      Console.Error.WriteLine("TestClassList: Success - the X values match!");
} 
```

控制台窗口上的输出：

```
TestClassList: Success - the X values match! 
```

对于以下行：

```
ref Mutable mutRef = ref mcList[0].MutRef; 
```

我最初无意中在等号后遗漏了 ref。编译器没有抱怨，但它确实生成了结构的副本，并且在运行时测试失败了。添加 ref 后，它运行正确。

# backup - 什么是可管理的长时间存储电子邮件的方法？

> ID：51528
> 
> 赞同：3
> 
> 时间：2008-09-09T10:23:55.290
> 
> 标签：backup, email

如果您有一个向客户发送电子邮件的站点，并且您想保存邮件的副本，那么有效的策略是什么？

如果您将它保存到数据库中的一个表中（例如，创建一个名为 Mail 的表），它会很快变得非常大。

我见过的一些策略是：

1.  保存到文件系统
2.  运行计划任务以清除数据库中的旧条目 - 但你最终没有副本；
3.  为每个时间范围创建一个单独的表（每年一个，或每个月一个）

你使用了哪些策略？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T10:30:53.153

我不同意 gmail 是业务数据的有效备份。

为什么要将您的业务信息委托给不提供服务保证或您无法控制的提供商？

对我来说毫无意义。

根据您需要访问此信息的频率，我会说使用文件系统或数据库存档。至少这样，您可以控制自己的数据。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T10:28:15.250

您要保存的数据保存在数据库中。唯一合理的例外是大型二进制数据（图像、视频）。谁在乎桌子有多大？如果邮件是自动化的并且是基于模板的，那么无论如何你只需要保存可变部分。无论您在何处保存它，其大小都将大致相同，但您可能已经有一种机制来备份您的数据库，因此您不必发明一个来处理数百万个文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T10:28:50.020

很多假设： 1\. 您正在运行 windows / 想要在 windows 中存档 2\. 在邮件中搜索的能力很重要。

由于您正在向您的客户发送邮件，因此您没有任何理由不能密送您自己的邮件帐户。假设您在自己的服务器上有一个合适的帐户，那么我会考虑使用[MailStore (home)](http://www.mailstore.com/en/mailstore-home.aspx)从您的帐户中提取邮件并将它们放入它自己的压缩数据库中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T10:33:37.123

另一种选择（取决于电子邮件内容）是不保存电子邮件，但确保您可以通过归档生成电子邮件的原始内容来*重新创建电子邮件。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T10:29:14.200

这取决于您的电子邮件的内容。如果它包含大图像。我会喜欢文件系统。否则，如果您的 Mail 表很快变得非常大，我会选择单独的表，归档死客户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T10:34:14.313

我们将电子邮件保存到数据库表中。它真的没有那么快变得那么大。我们有一个包含 32,000 封电子邮件的表格（它们也是大型电子邮件，每封电子邮件 50kb），经过压缩，文件仅使用 16MB。

如果您要发送大量电子邮件，那么请知道 GMail（免费）目前只允许 7GB 的数据。我很乐意将它保存在磁盘上。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T11:10:56.083

我会考虑实施某种通用归档功能。您如何实现这取决于您的特定检索需求。

例如，如果您只想检索某个月份发送给特定客户的电子邮件，那么将它们存储在文件系统上的适当层次中（必要时将它们压缩）应该很容易做到。您可能希望在数据库表中记录已发送电子邮件的列表，并带有*指向*适当目录的指针，但目录和文件的命名约定可能就足够了

您可能不需要非常频繁地访问非常旧的电子邮件，因此您可以将这些电子邮件存档到 DVD，例如，如果在线存储存在问题

如果您想经常搜索电子邮件的实际内容，那么您将不得不将内容放在数据库表中或使用 Lucerne 之类的索引器来检查存储在磁盘上的文件

# svn - 您如何处理遗留代码（和数据）？

> ID：51530
> 
> 赞同：0
> 
> 时间：2008-09-09T10:24:44.710
> 
> 标签：svn, version-control, project-management, legacy

我目前正在通过添加一些新项目并将遗留代码和来自几个旧存储库的数据合并到其中来重组我的本地 Subversion 存储库。

当我过去这样做时，我通常将遗留代码放在一个专用的“遗留”文件夹中，以免“干扰”新的和“结构良好”的代码树。但是，本着重构的精神，我觉得这有点不对。理论上，遗留代码会随着时间的推移被重构并移动到新的位置，但实际上这种情况很少发生。

你如何处理你的遗留代码？尽管我很想将旧罪藏在“遗产”文件夹中，再也不会看它，但在某种程度上，我希望通过强迫它生活在存储库中更“健康”的居民中，也许是遗产代码有一天会更好地康复吗？

（是的，我们都知道[我们不应该重写东西](http://www.joelonsoftware.com/articles/fog0000000069.html)，但这是我的“有趣”存储库，而不是我的商业项目......）

**更新**

我不担心跟踪各种版本的技术方面。我知道如何为此使用标签和分支。这更多是心理方面的，因为我更喜欢在存储库中有一个“整洁”的结构，这使得导航更容易——对人类来说。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T10:31:39.327

有一天，所有代码都变成了“遗留”，为什么要分开呢？源代码控制是按项目/分支或项目/平台/分支以及那种层次结构。谁在乎它的牙齿有多长？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T10:30:04.043

标记是颠覆中非常便宜的操作。在开始重构时以及在进行过程中的常规阶段标记您的代码。这样，仍然可以轻松访问旧的（但功能代码）作为您闪亮的新（但损坏的代码）的参考。:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T10:49:09.957

使用*外部定义*（[svn:externals](http://svnbook.red-bean.com/en/1.7/svn.advanced.externals.html)属性）来引用您的遗留代码，就像您使用第三方存储库一样。

然后，您可以将重构工作与依赖项目分开，并且（使用固定修订版引用，即 -r1234）非常明确地说明依赖项目所依赖的遗留代码的修订版。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:32:11.407

这是您的免费心理分析：

您在这里拥有的是一种根深蒂固的愿望，即修复您的遗留代码，使其不再是遗留代码。当你把它藏起来时，你只是在压抑这种欲望，试图避免它，因为这是一种不舒服的感觉。如果你把它放在外面，两种情况之一会发生：它最终会让你发疯，你将不得不自杀，或者（更乐观地），你会被提醒每一个混乱的部分，然后直到你最终分解并清理它。

不要隐藏混乱；打扫。否则它迟早会回来咬你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T10:27:14.163

这取决于您所说的*legacy*。如果说遗留您的真正意思是“来自一些已退役的应用程序的代码，它非常糟糕，我们将永远不会再使用它”，那么它应该与您当前的代码分开。如果它来自您当前的项目，但由其他人编写，或者不符合您当前的标准，请正常对待它，但将其标记为将来在您的问题跟踪器中重新考虑。

# .net - 确定一个类使用多少内存？

> ID：51540
> 
> 赞同：8
> 
> 时间：2008-09-09T10:28:47.667
> 
> 标签：.net, memory

我试图找到一种方法来确定在运行时给定类在 .NET 中使用了多少内存。使用`Marshal.SizeOf()`已淘汰，因为它仅适用于值类型。有没有办法准确检查一个类使用了多少内存？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T10:34:01.040

我最近才开始研究这种类型的东西，但我发现内存分析器可以提供有关应用程序中对象实例的非常详细的信息。

以下是值得尝试的一对：

*   [蚂蚁探查器](http://www.red-gate.com/Products/ants_profiler/index.htm)
*   [.NET 内存分析器](http://memprofiler.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T13:34:12.197

我同意内存分析器是获取所需信息的最简单方法。除了前面提到的两个，我推荐 JetBrains [dotTrace](http://www.jetbrains.com/profiler/index.html)，它既是性能分析器，也是内存分析器。

如果您想自己做，并且愿意深入了解 CLR，您可以使用[.NET Profiling API](http://msdn.microsoft.com/en-us/library/ms404386.aspx)，这是一个非托管 API（如 Microsoft 所说）：“使分析器能够监视程序由公共语言运行时 (CLR) 执行。” 它不完全是为休闲使用而设计的，但它确实具有大量的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T14:55:32.360

只需链接到相关的 SO 问题：

*   [sizeof() 等效于引用类型？](https://stackoverflow.com/questions/26570/sizeof-equivalent-for-reference-types)

# c++ - 在项目中查找未使用的文件

> ID：51548
> 
> 赞同：4
> 
> 时间：2008-09-09T10:32:18.127
> 
> 标签：c++, version-control, file

我们正在迁移我们的作品存储库，因此我想在将源树中存在的所有未引用文件移入漂亮的新鲜（空）存储库之前对其进行剔除。

到目前为止，我已经手动完成并找到了所有我知道的未引用文件，但我想知道我是否已经全部抓住了它们。一种方法是手动将项目文件逐个文件移动到新文件夹，并查看编译时会出现什么问题。这需要整整一周，所以我需要一个自动化工具。

人们有什么建议？

澄清：
1）它是C++。
2）文件混合。我正在寻找已被其他人取代但已在存储库中腐烂的文件 - 例如 file_iter.h 未被程序中的任何其他文件引用但保留在存储库中以防万一有人想从1996 年！现在我们正在移动到一个新的存储库，我们可以安全地丢弃所有不再使用的文件。
3) Lint 只发现未使用的包含 - 不是未使用的文件（我面前有 7.5 手册）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T10:36:21.813

你已经用**c++**标记了这篇文章，所以我假设这是有问题的语言。如果这是存储库中唯一的内容，那么为每个文件名对存储库中的所有文件进行 grep 处理应该不会太难，以便为您提供一个良好的起点。如果存储库包含其他文件（元数据、支持文件、资源等），那么您可能需要手动完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T21:23:39.713

我无法为它提供现有的工具，但我希望您可以从构建工具中获得大量此类信息（可能需要付出一些努力）。通常，您至少可以让构建工具打印它将运行的命令，而无需实际运行它们。（例如，`-n`选项`make`and`bjam`执行此操作。）您应该能够从中提取至少使用过的源文件。

使用可以获取给定源文件`-MM`的`g++`所有非系统头文件。输出是`make`规则的形式，但是通过一些过滤，这应该不是问题。

我不知道这是否有帮助；这正是我会在你的情况下尝试的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T22:58:23.030

实际上，您可以通过运行“整个项目分析”（其中所有文件一起分析而不是单独分析）来间接使用 Lint 执行此操作。

将其配置为忽略除未引用的变量/枚举/函数等警告之外的所有内容，它应该为您提供一个合理的指标，表明死木所在的位置，而这些问题不会被代码库中的任何其他问题所掩盖。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T10:42:49.270

像 lint 这样的静态源代码分析工具可能会完成这项工作。他们会告诉你一段代码是否永远不会被调用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T11:18:38.060

你看过[Source-Navigator](http://sourcenav.sourceforge.net/)吗？它可以用作 IDE，但我发现它非常擅长分析源代码结构。例如，它可以找出您的源代码中在哪里以及是否使用了某个方法。

我不知道它是否可以编写脚本，但这对您来说可能是一个很好的起点。

# python - 为什么 SQL 聚合函数比 Python 和 Java（或可怜人的 OLAP）慢得多

> ID：51553
> 
> 赞同：15
> 
> 时间：2008-09-09T10:33:39.620
> 
> 标签：python, sql, optimization, aggregate, olap

我需要一个真正的 DBA 的意见。Postgres 8.3 在我的 Macbook Pro 上执行此查询需要 200 毫秒，而 Java 和 Python 在 20 毫秒（350,000 行）内执行相同的计算：

```
SELECT count(id), avg(a), avg(b), avg(c), avg(d) FROM tuples; 
```

这是使用 SQL 数据库时的正常行为吗？

架构（该表包含对调查的回复）：

```
CREATE TABLE tuples (id integer primary key, a integer, b integer, c integer, d integer);

\copy tuples from '350,000 responses.csv' delimiter as ',' 
```

我在 Java 和 Python 中为上下文编写了一些测试，它们粉碎了 SQL（纯 python 除外）：

```
java   1.5 threads ~ 7 ms    
java   1.5         ~ 10 ms    
python 2.5 numpy   ~ 18 ms  
python 2.5         ~ 370 ms 
```

即使 sqlite3 与 Postgres 竞争，尽管它假设所有列都是字符串（相比之下：即使在 Postgres 中仅使用切换到数字列而不是整数也会导致 10 倍的减速）

我尝试过但没有成功的调整包括（盲目地遵循一些网络建议）：

```
increased the shared memory available to Postgres to 256MB    
increased the working memory to 2MB
disabled connection and statement logging
used a stored procedure via CREATE FUNCTION ... LANGUAGE SQL 
```

所以我的问题是，我在这里的体验是否正常，这就是我在使用 SQL 数据库时可以期待的吗？我可以理解 ACID 必须付出代价，但在我看来这有点疯狂。我不是要求实时游戏速度，但由于 Java 可以在 20 毫秒内处理数百万次双打，我感到有点嫉妒。

有没有更好的方法以便宜的方式进行简单的 OLAP（无论是在资金方面还是在服务器复杂性方面）？我研究过 Mondrian 和 Pig + Hadoop，但对维护另一个服务器应用程序并不太兴奋，也不确定它们是否会有所帮助。

* * *

没有 Python 代码和 Java 代码可以说是在内部完成所有工作。我只生成了 4 个数组，每个数组有 350,000 个随机值，然后取平均值。我不包括时间中的生成，只包括平均步骤。java 线程计时使用 4 个线程（每个数组平均一个），过大但绝对是最快的。

sqlite3 计时由 Python 程序驱动，并从磁盘运行（不是：内存：）

我意识到 Postgres 在幕后做了更多工作，但大部分工作对我来说并不重要，因为这是只读数据。

Postgres 查询不会更改后续运行的时间。

我重新运行了 Python 测试，包括将其从磁盘中脱机。时间大大减慢到近 4 秒。但我猜 Python 的文件处理代码几乎是用 C 语言编写的（尽管可能不是 csv lib？）所以这向我表明 Postgres 也没有从磁盘流式传输（或者你是正确的，我应该低头在谁写了他们的存储层之前！）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-09T12:31:26.437

我会说你的测试方案并不是很有用。为了完成 db 查询，db 服务器要经过几个步骤：

1.  解析 SQL
2.  制定查询计划，即决定使用哪些索引（如果有）、优化等。
3.  如果使用了索引，则在其中搜索指向实际数据的指针，然后转到数据中的适当位置或
4.  如果没有使用索引，则扫描*整个表*以确定需要哪些行
5.  将数据从磁盘加载到临时位置（希望但不一定是内存）
6.  执行 count() 和 avg() 计算

因此，在 Python 中创建一个数组并获取平均值基本上会跳过所有这些步骤，只保存最后一个。由于磁盘 I/O 是程序必须执行的最昂贵的操作之一，因此这是测试中的一个主要缺陷（另请参阅我之前在此处提出的[这个问题的答案）。](https://stackoverflow.com/questions/26021/how-is-data-compression-more-effective-than-indexing-for-search-performance)即使您在其他测试中从磁盘读取数据，过程也完全不同，很难判断结果的相关性。

要获得有关 Postgres 花费时间的更多信息，我建议进行以下测试：

*   将查询的执行时间与没有聚合函数的 SELECT 进行比较（即剪切步骤 5）
*   如果您发现聚合导致显着减慢，请尝试 Python 是否执行得更快，通过比较中的普通 SELECT 获取原始数据。

要加快查询速度，请先减少磁盘访问。我非常怀疑是聚合需要时间。

有几种方法可以做到这一点：

*   缓存数据（在内存中！）以供后续访问，无论是通过数据库引擎自己的功能还是使用 memcached 等工具
*   减少存储数据的大小
*   优化索引的使用。有时这可能意味着完全跳过索引使用（毕竟，它也是磁盘访问）。对于 MySQL，我似乎记得如果您假设查询获取表中所有数据的 10% 以上，建议跳过索引。
*   如果您的查询充分利用了索引，我知道对于 MySQL 数据库，将索引和数据放在单独的物理磁盘上会有所帮助。但是，我不知道这是否适用于 Postgres。
*   如果由于某种原因无法在内存中完全处理结果集，则还可能存在更复杂的问题，例如将行交换到磁盘。但我会放弃这种研究，直到遇到无法找到另一种解决方法的严重性能问题，因为它需要了解你的过程中的许多底层细节。

**更新：**

*我刚刚意识到您似乎没有使用上述查询的索引，而且很可能也没有使用任何索引，所以我对索引的建议可能没有帮助。对不起。不过，我想说聚合不是问题，但磁盘访问才是问题。无论如何，我会把索引的东西留在里面，它可能还有一些用处。*

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-09T14:26:28.297

Postgres 做的比看起来要多得多（一开始就保持数据一致性！）

如果值不必 100% 正确，或者表很少更新，但您经常运行此计算，您可能需要查看物化视图以加快计算速度。

（注意，我没有在 Postgres 中使用物化视图，它们看起来有点 hacky，但可能适合您的情况）。

[物化视图](http://jonathangardner.net/tech/w/PostgreSQL/Materialized_Views)

还要考虑实际连接到服务器的开销以及将请求发送到服务器并返回所需的往返行程。

我认为这样的事情需要 200 毫秒非常好，在我的 oracle 服务器上进行快速测试，具有大约 500k 行且没有索引的相同表结构，大约需要 1 - 1.5 秒，这几乎只是 oracle 吸取数据离盘。

真正的问题是，200ms 够快吗？

- - - - - - - 更多的 - - - - - - - - - -

我对使用物化视图解决这个问题很感兴趣，因为我从来没有真正玩过它们。这是在甲骨文中。

首先，我创建了一个每分钟刷新的 MV。

```
create materialized view mv_so_x 
build immediate 
refresh complete 
START WITH SYSDATE NEXT SYSDATE + 1/24/60
 as select count(*),avg(a),avg(b),avg(c),avg(d) from so_x; 
```

刷新时，没有返回任何行

```
SQL> select * from mv_so_x;

no rows selected

Elapsed: 00:00:00.00 
```

刷新后，它比执行原始查询快得多

```
SQL> select count(*),avg(a),avg(b),avg(c),avg(d) from so_x;

  COUNT(*)     AVG(A)     AVG(B)     AVG(C)     AVG(D)
---------- ---------- ---------- ---------- ----------
   1899459 7495.38839 22.2905454 5.00276131 2.13432836

Elapsed: 00:00:05.74
SQL> select * from mv_so_x;

  COUNT(*)     AVG(A)     AVG(B)     AVG(C)     AVG(D)
---------- ---------- ---------- ---------- ----------
   1899459 7495.38839 22.2905454 5.00276131 2.13432836

Elapsed: 00:00:00.00
SQL> 
```

如果我们插入到基表中，结果是不能立即查看查看MV。

```
SQL> insert into so_x values (1,2,3,4,5);

1 row created.

Elapsed: 00:00:00.00
SQL> commit;

Commit complete.

Elapsed: 00:00:00.00
SQL> select * from mv_so_x;

  COUNT(*)     AVG(A)     AVG(B)     AVG(C)     AVG(D)
---------- ---------- ---------- ---------- ----------
   1899459 7495.38839 22.2905454 5.00276131 2.13432836

Elapsed: 00:00:00.00
SQL> 
```

但稍等片刻，MV 将在幕后更新，并快速返回结果。

```
SQL> /

  COUNT(*)     AVG(A)     AVG(B)     AVG(C)     AVG(D)
---------- ---------- ---------- ---------- ----------
   1899460 7495.35823 22.2905352 5.00276078 2.17647059

Elapsed: 00:00:00.00
SQL> 
```

这并不理想。首先，它不是实时的，插入/更新不会立即可见。此外，无论您是否需要，您都会运行一个查询来更新 MV（这可以调整到任何时间范围，或按需调整）。但是，这确实显示了 MV 可以让最终用户觉得它有多快，如果您可以接受不完全符合秒级精度的值。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-10T02:29:45.767

我用 MySQL 重新测试了指定 ENGINE = MEMORY 并且它没有改变任何东西（仍然是 200 毫秒）。使用内存数据库的 Sqlite3 也提供了类似的时间（250 毫秒）。

[这里](https://stackoverflow.com/questions/51553/why-are-sql-aggregate-functions-so-much-slower-than-python-and-java-or-poor-man#53303)的数学看起来是正确的（至少是大小，因为这就是 sqlite db 的大小:-)

我只是不购买磁盘原因缓慢的论点，因为有所有迹象表明这些表都在内存中（postgres 的人都警告不要过于努力地将表固定到内存，因为他们发誓操作系统会比程序员做得更好)

为了澄清时间，Java 代码不是从磁盘读取，如果 Postgres 从磁盘读取并计算一个复杂的查询，这将是一个完全不公平的比较，但这真的不是重点，数据库应该足够聪明，可以带来一个小的将表放入内存并预编译存储过程恕我直言。

更新（回应下面的第一条评论）：

*我不确定如何在不使用聚合函数的情况下以公平的方式测试查询，因为如果我选择所有行，它将花费大量时间序列化和格式化所有内容。我并不是说缓慢是由于聚合功能，它仍然可能只是并发性、完整性和朋友的开销。我只是不知道如何将聚合隔离为唯一的自变量。*

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T13:50:18.477

这些是非常详细的答案，但它们大多是在回避问题，考虑到数据很容易放入内存、需要并发读取但不需要写入并且一遍又一遍地使用相同的查询进行查询，我如何在不离开 Postgres 的情况下获得这些好处。

是否可以预编译查询和优化计划？我原以为存储过程会这样做，但它并没有真正帮助。

为了避免磁盘访问，有必要将整个表缓存在内存中，我可以强制 Postgres 这样做吗？我认为它已经这样做了，因为重复运行后查询仅在 200 毫秒内执行。

我可以告诉 Postgres 该表是只读的，因此它可以优化任何锁定代码吗？

我认为可以用空表估计查询构建成本（时间范围为 20-60 毫秒）

我仍然不明白为什么 Java/Python 测试无效。Postgres 并没有做更多的工作（尽管我还没有解决并发方面，只是缓存和查询构造）

更新：我认为通过将 350,000 通过驱动程序和序列化步骤拉入 Python 以运行聚合来比较 SELECTS 是不公平的，甚至也不能省略聚合，因为格式化和显示的开销很难与定时。如果两个引擎都在内存数据中运行，那应该是苹果对苹果的比较，但我不确定如何保证这已经发生。

我不知道如何添加评论，也许我没有足够的声誉？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-10T01:47:32.590

我自己是一个 MS-SQL 人，我们会使用[DBCC PINTABLE](http://msdn.microsoft.com/en-us/library/ms178015.aspx)来保持表的缓存，并使用[SET STATISTICS IO](http://msdn.microsoft.com/en-us/library/ms184361.aspx)来查看它是从缓存而不是磁盘读取的。

我在 Postgres 上找不到任何模仿 PINTABLE 的东西，但[pg_buffercache](http://www.postgresql.org/docs/current/static/pgbuffercache.html)似乎提供了有关缓存中内容的详细信息——您可能想检查一下，看看您的表是否真的被缓存了。

信封计算的快速回溯让我怀疑您正在从磁盘分页。假设 Postgres 使用 4 字节整数，则每行有 (6 * 4) 字节，因此您的表最小为 (24 * 350,000) 字节 ~ 8.4MB。假设您的 HDD 上的持续吞吐量为 40 MB/s，您正在查看大约 200 毫秒来读取数据（[正如所指出的](https://stackoverflow.com/questions/51553/why-are-sql-aggregate-functions-so-much-slower-than-python-and-java-or-poor-man#51668)，这应该是几乎所有时间都花在的地方）。

除非我在某个地方搞砸了我的数学，否则我看不出您如何能够将 8MB 读入您的 Java 应用程序并在您显示的时间处理它 - 除非该文件已经被驱动器或您的操作系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T11:43:10.967

我认为您的结果并不令人惊讶——如果有的话，Postgres 是如此之快。

一旦有机会缓存​​数据，Postgres 查询是否第二次运行得更快？为了更公平一点，您对 Java 和 Python 的测试应该首先涵盖获取数据的成本（理想情况下从磁盘加载数据）。

如果此性能级别在实践中对您的应用程序来说是一个问题，但由于其他原因您需要 RDBMS，那么您可以查看[memcached](http://www.danga.com/memcached/)。然后，您将对原始数据进行更快的缓存访问，并可以在代码中进行计算。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-09T13:04:15.077

RDBMS 通常为您做的另一件事是通过保护您免受另一个进程的同时访问来提供并发性。这是通过放置锁来完成的，并且有一些开销。

如果您正在处理完全不变的静态数据，特别是如果您处于基本的“单用户”场景中，那么使用关系数据库不一定会给您带来太多好处。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-10T09:45:20.150

您是否使用 TCP 访问 Postgres？在那种情况下，Nagle 正在搞乱你的时间安排。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-09T14:10:06.667

您需要将 postgres 的缓存增加到整个工作集适合内存的程度，然后才能期望看到与使用程序在内存中执行它的性能相当。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-09T15:34:19.943

感谢甲骨文的时间安排，这就是我正在寻找的东西（虽然令人失望:-)

物化视图可能值得考虑，因为我认为我可以为大多数用户预先计算最有趣的查询形式。

我不认为查询往返时间应该很高，因为我在运行 Postgres 的同一台机器上运行查询，所以它不会增加太多延迟？

我还检查了缓存大小，似乎 Postgres 依赖于操作系统来处理缓存，他们特别提到 BSD 是理想的操作系统，所以我认为 Mac OS 应该非常聪明地将表带入记忆。除非有人考虑到更具体的参数，否则我认为更具体的缓存是我无法控制的。

最后我大概可以忍受 200 毫秒的响应时间，但是知道 7 毫秒是一个可能的目标让我感到不满意，因为即使是 20-50 毫秒的时间也会让更多的用户有更多的最新查询并摆脱许多缓存和预先计算的黑客。

我刚刚使用 MySQL 5 检查了时间，它们比 Postgres 稍差。所以除非有一些重大的缓存突破，我想这就是我可以期待的关系数据库路线。

我希望我能投票赞成你的一些答案，但我还没有足够的分数。

# c - 如何自动查找未使用的#include 指令？

> ID：51561
> 
> 赞同：27
> 
> 时间：2008-09-09T10:38:25.507
> 
> 标签：c

通常，在编写新代码时，您会发现缺少 #include，因为该文件无法编译。很简单，您添加所需的#include。但是后来你以某种方式重构了代码，现在不再需要几个#include 指令。我如何发现哪些不再需要？

当然，我可以手动删除部分或全部#include 行并将它们添加回来，直到文件再次编译，但这在具有数千个文件的大型项目中并不可行。是否有任何工具可以帮助自动化任务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T10:41:43.563

您可以使用[PC-Lint/FlexeLint](http://www.gimpel.com/)来做到这一点。

不同寻常的是，该工具没有免费的操作系统版本。

您可以通过引用传递而不是通过值传递和前向声明来删除#includes。这是因为编译器不需要在编译时知道对象的大小。但是，这将需要代表您进行大量的手动工作。好处是它会减少你的编译时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T11:25:11.663

您可以编写一个“蛮力”命令行工具，将#includes 逐个注释掉并测试编译是否仍然有效。让我知道你什么时候开始工作。;0)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T11:47:38.477

[这篇文章](http://gamesfromwithin.com/physical-structure-and-c-part-1-a-first-look)解释了一种使用 Doxygen 的解析来移除#include 的技术。这只是一个 perl 脚本，所以它很容易使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-06T00:14:25.067

有一个名为 includator 的 Eclipse 插件，它有助于管理 C/C++ 项目中的包含依赖项

[http://includator.com/](http://includator.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-29T11:35:38.843

这是适用于单个***.cpp****或*****.h**文件在编辑器中打开，通过 include 注释 include 并运行编译：**

 **```
Sub RemoveNotUsedIncludes()

'Check if already processed; Exit if so
ActiveDocument.Selection.FindText "//INCLUDE NOT USED", dsMatchFromStart
IF ActiveDocument.Selection <> "" THEN
    ActiveDocument.Selection.SetBookmark
    MsgBox "Already checked"
    ActiveDocument.Selection.ClearBookmark
    EXIT SUB
END IF

'Find first #include; Exit if not found
ActiveDocument.Selection.FindText "#include", dsMatchFromStart
IF ActiveDocument.Selection = "" THEN
    MsgBox "No #include found"
    EXIT SUB
END IF

Dim FirstIncludeLine
FirstIncludeLine = ActiveDocument.Selection.CurrentLine

FOR i=1 TO 200

    'Test build
    ActiveDocument.Selection.SetBookmark
    ActiveDocument.Selection = "//CHECKING... #include"
    Build
    ActiveDocument.Undo
    ActiveDocument.Selection.ClearBookmark

    IF Errors = 0 THEN
        'If build failed add comment
        ActiveDocument.Selection.EndOfLine
        ActiveDocument.Selection = " //INCLUDE NOT USED"
    END IF

    'Find next include
    ActiveDocument.Selection.EndOfLine
    ActiveDocument.Selection.FindText "#include"

    'If all includes tested exit
    IF ActiveDocument.Selection.CurrentLine = FirstIncludeLine THEN EXIT FOR

NEXT 
```

结束子

当然，它可以改进为在整个项目上工作。

# javascript - JavaScript 文化敏感货币格式

> ID：51564
> 
> 赞同：6
> 
> 时间：2008-09-09T10:40:03.833
> 
> 标签：javascript, localization, currency

如何以 JavaScript 中文化感知的方式格式化与货币相关的数据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T10:47:12.147

Dojo 有一个可识别区域设置的[货币格式化程序](http://api.dojotoolkit.org/jsdoc/dojo/HEAD/dojo.currency.format)。

如果你不想仅仅为了这个功能而在你的项目中包含 Dojo，那么也许你可以在你的后端本地化货币？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2021-03-05T17:46:57.273

所以我知道这是一个老问题，但如果其他人出现在寻找类似的答案，在现代 JavaScript 中你可以使用

```
new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(number) 
```

有关更多信息，请参阅参考文档。

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-28T14:57:57.560

Number.toLocaleString（在 JavaScript 1.5，ECMAScript 3rd Edition 中实现）

```
var number = 3500;
console.log(number.toLocaleString()); /* Displays "3,500" in English locale */ 
```

[MDN 上的文档](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Number/toLocaleString)。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-09T11:48:45.837

有一个 Number.localeFormat 函数，但我不确定它是你想要的

[http://msdn.microsoft.com/en-gb/library/bb310813.aspx](http://msdn.microsoft.com/en-gb/library/bb310813.aspx)

# ruby - 确定 Ruby 中的文件类型

> ID：51572
> 
> 赞同：78
> 
> 时间：2008-09-09T10:46:50.540
> 
> 标签：ruby, content-type, mime-types, file-type

如何**可靠地**确定文件的类型？文件扩展名分析是不可接受的。一定有类似于 UNIX file(1) 命令的 ruby​​esque 工具？

这是关于 MIME 或内容类型，而不是文件系统分类，例如目录、文件或套接字。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-05-23T14:52:32.480

有一个红宝石绑定可以满足`libmagic`您的需要。它以名为[ruby​​-filemagic](https://rubygems.org/gems/ruby-filemagic/versions/0.7.1)的 gem 形式提供：

```
gem install ruby-filemagic 
```

要求`libmagic-dev`。

该文档似乎有点薄，但这应该可以帮助您入门：

```
$ irb 
irb(main):001:0> require 'filemagic' 
=> true
irb(main):002:0> fm = FileMagic.new
=> #<FileMagic:0x7fd4afb0>
irb(main):003:0> fm.file('foo.zip') 
=> "Zip archive data, at least v2.0 to extract"
irb(main):004:0> 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-11T15:41:08.193

如果你在 Unix 机器上试试这个：

```
mimetype = `file -Ib #{path}`.gsub(/\n/,"") 
```

我不知道有任何纯 Ruby 解决方案可以像“文件”一样可靠地工作。

编辑添加：根据您运行的操作系统，您可能需要使用“i”而不是“I”来获取文件以返回 mime 类型。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-11-07T09:20:35.803

我发现炮击是最可靠的。为了在 Mac OS X 和 Ubuntu Linux 上兼容，我使用了：

`file --mime -b myvideo.mp4`
**视频/mp4；字符集=二进制**

如果可以的话，Ubuntu 还会打印视频编解码器信息，这非常酷：

`file -b myvideo.mp4`
**ISO 媒体，MPEG v4 系统，版本 2**

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-05-19T14:57:48.660

您可以根据文件的魔术头使用这种可靠的方法：

```
def get_image_extension(local_file_path)
  png = Regexp.new("\x89PNG".force_encoding("binary"))
  jpg = Regexp.new("\xff\xd8\xff\xe0\x00\x10JFIF".force_encoding("binary"))
  jpg2 = Regexp.new("\xff\xd8\xff\xe1(.*){2}Exif".force_encoding("binary"))
  case IO.read(local_file_path, 10)
  when /^GIF8/
    'gif'
  when /^#{png}/
    'png'
  when /^#{jpg}/
    'jpg'
  when /^#{jpg2}/
    'jpg'
  else
    mime_type = `file #{local_file_path} --mime-type`.gsub("\n", '') # Works on linux and mac
    raise UnprocessableEntity, "unknown file type" if !mime_type
    mime_type.split(':')[1].split('/')[1].gsub('x-', '').gsub(/jpeg/, 'jpg').gsub(/text/, 'txt').gsub(/x-/, '')
  end  
end 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2019-08-09T14:14:03.843

这是作为对此[答案](https://stackoverflow.com/a/56933/199712)的评论添加的，但实际上应该是它自己的答案：

```
path = # path to your file

IO.popen(
  ["file", "--brief", "--mime-type", path],
  in: :close, err: :close
) { |io| io.read.chomp } 
```

我可以确认它对我有用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-09-17T14:04:24.440

如果您使用的是 File 类，则可以根据@PatrickRichie 的回答使用以下函数对其进行扩充：

```
class File
    def mime_type
        `file --brief --mime-type #{self.path}`.strip
    end

    def charset
        `file --brief --mime #{self.path}`.split(';').second.split('=').second.strip
    end
end 
```

而且，如果您使用的是 Ruby on Rails，则可以将其放入 config/initializers/file.rb 并在整个项目中使用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-05-10T17:05:17.737

对于那些通过搜索引擎来到这里的人来说，在纯 ruby​​ 中找到 MimeType 的一种现代方法是使用[mimemagic](https://github.com/minad/mimemagic) gem。

```
require 'mimemagic'

MimeMagic.by_magic(File.open('tux.jpg')).type # => "image/jpeg" 
```

如果您觉得只使用文件扩展名是安全的，那么您可以使用[mime-types](https://github.com/mime-types/ruby-mime-types) gem：

```
MIME::Types.type_for('tux.jpg') => [#<MIME::Type: image/jpeg>] 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-18T16:21:08.740

你可以试试[shared-mime](http://shared-mime.rubyforge.org/) (gem install shared-mime-info)。需要使用 Freedesktop shared-mime-info 库，但同时进行文件名/扩展名检查以及“魔术”检查...我自己试了一下，但我没有 freedesktop shared-mime-info不幸的是，数据库已安装并且必须做“真正的工作”，但这可能是您正在寻找的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-04-20T20:35:51.057

使用魔术字节并返回匹配类型的符号的纯 Ruby 解决方案：

[https://github.com/SixArm/sixarm_ruby_magic_number_type](https://github.com/SixArm/sixarm_ruby_magic_number_type)

我写的，所以如果你有建议，请告诉我。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-20T17:51:53.523

我最近发现了[mimetype-fu](http://github.com/mattetti/mimetype-fu)。

获取文件的 MIME 类型似乎是最简单可靠的解决方案。

唯一需要注意的是，在 Windows 机器上它只使用文件扩展名，而在基于 *Nix 的系统上它工作得很好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-01-25T16:02:40.327

到目前为止我发现的最好的：

[http://bogomips.org/mahoro.git/](http://bogomips.org/mahoro.git/)

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-09-03T14:24:07.073

红宝石很好。 [ruby 的 mime 类型](http://rubyforge.org/projects/mime-types/)

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-09-09T11:10:42.340

你可以试试[MIME::Types for Ruby](http://mime-types.rubyforge.org/)。

> 该库允许识别文件可能的 MIME 内容类型。MIME 内容类型的标识基于文件的文件扩展名。

# java - 好的Java图算法库？

> ID：51574
> 
> 赞同：237
> 
> 时间：2008-09-09T10:47:34.047
> 
> 标签：java, algorithm, graph

有没有人对任何用于图形算法的 Java 库有很好的经验。我试过[JGraph](http://www.jgraph.com/jgraph.html)，发现没问题，google 里有很多不同的。是否有人实际在生产代码中成功使用或会推荐？

澄清一下，我不是在寻找生成图形/图表的库，而是在寻找有助于图形算法的库，例如最小生成树、Kruskal 算法节点、边等。理想情况下，它具有一些好的算法/数据一个不错的 Java OO API 中的结构。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-09-09T19:28:21.427

如果您使用的是 JGraph，您应该尝试一下专为算法设计的[JGraphT 。](http://jgrapht.org/)它的功能之一是使用 JGraph 库进行可视化。它仍在开发中，但相当稳定。前段时间分析过JGraphT算法的复杂度。其中一些不是最快的，但如果您要自己实现它们并且需要显示图表，那么它可能是最佳选择。我真的很喜欢使用它的 API，因为我很快就不得不编写一个处理图形并在以后显示它的应用程序。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2009-05-12T21:06:57.403

概括：

*   如果您对数据结构和算法更感兴趣，请使用[JGraphT 。](https://github.com/jgrapht/jgrapht/)
*   如果您的主要关注点是可视化，则使用[JGraph 。](https://www.jgraph.com/jgraph.html)
*   [Jung](http://jung.sourceforge.net/)、[yWorks](http://www.yworks.com)和[BFG](http://bfo.com/products/graph/)是人们尝试使用的其他东西。
*   [Prefuse](https://github.com/prefuse/Prefuse)是不可以的，因为必须重写大部分内容。
*   如果您只需要良好的数据结构，请使用[Google Guava 。](https://github.com/google/guava/wiki/GraphsExplained)
*   [阿帕奇共享图](http://commons.apache.org/sandbox/commons-graph/)。目前处于休眠状态，但提供了许多算法的实现。有关已实现算法的列表，请参见[https://issues.apache.org/jira/browse/SANDBOX-458](https://issues.apache.org/jira/browse/SANDBOX-458)，并与 Jung、GraphT、Prefuse、[jBPT 进行比较](https://github.com/jbpt/codebase)

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-09-09T14:49:18.833

查看[JGraphT](http://jgrapht.org/)以获得一个非常简单且功能强大的 Java 图形库，它做得非常好，为了消除任何混淆，*它与 JGraph 不同*。一些[示例代码](https://github.com/jgrapht/jgrapht/wiki/HelloWorld)：

```
UndirectedGraph<String, DefaultEdge> g =
        new SimpleGraph<String, DefaultEdge>(DefaultEdge.class);

    String v1 = "v1";
    String v2 = "v2";
    String v3 = "v3";
    String v4 = "v4";

    // add the vertices
    g.addVertex(v1);
    g.addVertex(v2);
    g.addVertex(v3);
    g.addVertex(v4);

    // add edges to create a circuit
    g.addEdge(v1, v2);
    g.addEdge(v2, v3);
    g.addEdge(v3, v4);
    g.addEdge(v4, v1); 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2008-09-09T11:36:03.463

[JUNG](http://jung.sourceforge.net/)是一个很好的可视化选择，并且有一套相当不错的可用图算法，包括用于随机图创建、重新布线等的几种不同机制。我还发现它通常很容易在必要时扩展和调整.

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2013-05-22T19:04:37.680

Apache Commons 提供[commons-graph](http://commons.apache.org/sandbox/commons-graph/)。在 [http://svn.apache.org/viewvc/commons/sandbox/graph/trunk/](http://svn.apache.org/viewvc/commons/sandbox/graph/trunk/)下可以查看源代码。示例 API 用法[也在 SVN](http://svn.apache.org/viewvc/commons/sandbox/graph/trunk/src/test/java/org/apache/commons/graph/model/BaseMutableGraphTestCase.java?view=markup)中。有关已实现算法的列表，请参见[https://issues.apache.org/jira/browse/SANDBOX-458](https://issues.apache.org/jira/browse/SANDBOX-458)，并与 Jung、GraphT、Prefuse、[jBPT 进行比较](https://github.com/jbpt/codebase)

如果您只需要良好的数据结构，请使用[Google Guava 。](https://github.com/google/guava/wiki/GraphsExplained)

[JGraphT](https://github.com/jgrapht/jgrapht)是一个图形库，实现了许多算法，并且（在我看来）具有良好的图形模型。[你好世界的例子](https://github.com/jgrapht/jgrapht/wiki/HelloWorld)。许可证：LGPL+EPL。

[JUNG2](http://jung.sourceforge.net)也是一个 BSD 许可的库，其数据结构类似于 JGraphT。它提供了 JGraphT 目前缺少的布局算法。最近的提交是从 2010 年开始，包`hep.aida.*`是 LGPL（通过[colt 库](http://acs.lbl.gov/software/colt/license.html)，[由 JUNG 导入](http://jung.sourceforge.net/download.html)）。这可以防止 JUNG 被用于 ASF 和 ESF 旗下的项目。也许应该使用[github fork](http://github.com/rortian/jung2)并删除该依赖项。[提交 f4ca0cd](https://github.com/rortian/jung2/commit/f4ca0cdcd3312589cbb48de7350b84cbff6067b9)是最后一次 CVS 提交的镜像。当前的提交似乎删除了可视化功能。[提交 d0fb491c](https://github.com/rortian/jung2/commit/d0fb491c0b5d2156e12df3a344521cfe7581c3d8)添加一个`.gitignore`.

[Prefuse](https://github.com/prefuse/Prefuse)使用矩阵结构存储图，这对于稀疏图而言内存效率不高。许可证：BSD

[Eclipse Zest](http://www.eclipse.org/gef/zest/)内置了图形布局算法，可以独立于 SWT 使用。请参阅[org.eclipse.zest.layouts.algorithms](http://git.eclipse.org/c/gef/org.eclipse.zest.git/tree/org.eclipse.zest.layouts/src/org/eclipse/zest/layouts/algorithms)。使用的图形结构是[Eclipse Draw2d](http://www.eclipse.org/gef/draw2d/)之一，其中[节点是显式对象](http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.draw2d.doc.isv/reference/api/org/eclipse/draw2d/graph/DirectedGraph.html)，而不是通过泛型注入（就像在 Apache Commons Graph、JGraphT 和 JUNG2 中发生的那样）。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-03-24T09:12:30.383

[http://neo4j.org/](http://neo4j.org/)是一个图形数据库，包含许多图形算法，并且比大多数内存库更好地扩展。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-09T11:20:13.173

在一个大学项目中，我玩弄了 yWorks 的[yFiles](http://www.yworks.com)，发现它有相当不错的 API。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2014-01-31T18:56:25.003

查看[蓝图](https://github.com/tinkerpop/blueprints/wiki)：

蓝图是属性图数据模型的接口、实现、补充和测试套件的集合。Blueprints 类似于 JDBC，但用于图形数据库。在 TinkerPop 开源软件堆栈中，Blueprints 作为基础技术用于：

[Pipes](http://pipes.tinkerpop.com/)：一个惰性的数据流框架

[Gremlin](http://gremlin.tinkerpop.com/)：一种图​​遍历语言

[Frames](http://frames.tinkerpop.com/)：一个对象到图的映射器

[Furnace](http://furnace.tinkerpop.com/)：图形算法包

[Rexster](http://rexster.tinkerpop.com/)：图形服务器

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-02-23T20:05:49.150

如果您喜欢图形算法，JDSL（Java 中的数据结构库）应该足够好 - [http://www.cs.brown.edu/cgc/jdsl/](http://www.cs.brown.edu/cgc/jdsl/)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2010-05-16T16:23:13.270

[http://incubator.apache.org/hama/](http://incubator.apache.org/hama/)是 Hadoop 上用于海量矩阵和图形数据的分布式科学包。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-09T11:05:42.833

对于可视化，我们小组在[prefuse](http://prefuse.org/)方面取得了一些成功。我们将它扩展到处理建筑底板和气泡图，它并没有太多抱怨。他们也有一个名为 Flare 的新 Flex 工具包，它使用非常相似的 API。

更新：我不得不同意评论，我们最终编写了很多自定义功能/解决了前置限制。我不能说从头开始会更好，因为我们能够通过使用 prefuse 从第一天开始展示进步。另一方面，如果我们要对相同的东西进行第二次实现，我可能会跳过前言，因为我们会更好地理解需求。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-06-07T10:44:12.090

试试 Annas，它是一个易于掌握的开源图形包

[http://annas.googlecode.com](http://annas.googlecode.com)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2014-01-25T08:23:28.563

确信 Graph 可以简单地表示为：

```
class Node {
   int value;
   List<Node> adj;
} 
```

并自己实现大多数您觉得有趣的算法。如果您在有关图表的一些练习/学习会议中遇到这个问题，那么这是要考虑的最佳库。;)

对于最常见的算法，您还可以更喜欢邻接矩阵：

```
class SparseGraph {
  int[] nodeValues;
  List<Integer>[] edges;     
} 
```

或一些操作的矩阵：

```
class DenseGraph {
  int[] nodeValues;
  int[][] edges;     
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-09-09T14:13:10.480

我不知道我是否将其称为生产就绪，但有[jGABL](http://jgabl.sourceforge.net/)。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-09-25T13:07:04.113

如果你需要性能，你可以看看 Grph。该图书馆由法国大学和 CNRS/Inria 开发。

[http://www.i3s.unice.fr/~hogie/grph/](http://www.i3s.unice.fr/~hogie/grph/)

该项目是主动和被动的支持提供！

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-01-19T14:47:33.677

可以在此处找到 java 中的教学图算法实现（由 Sedgewick 等人教授）： [http ://algs4.cs.princeton.edu/code/](http://algs4.cs.princeton.edu/code/)

我是在参加 coursera 上的这些特殊算法课程时被介绍给他们的（也是由 Sedgewick 教授教授的）：

[https://www.coursera.org/course/algs4partI](https://www.coursera.org/course/algs4partI)

[https://www.coursera.org/course/algs4partII](https://www.coursera.org/course/algs4partII)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-09T11:22:27.257

如果您实际上是在寻找图表库而不是节点/边缘图库，我建议您在 Big Faceless Graph 库 ( [BFG](http://big.faceless.org/products/graph/) ) 上大手大脚。它比 JFreeChart 更容易使用，看起来更好，运行更快，输出选项更多，真的没有可比性。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-06-05T11:27:01.457

JGraph 来自[http://mmengineer.blogspot.com/2009/10/java-graph-floyd-class.html](http://mmengineer.blogspot.com/2009/10/java-graph-floyd-class.html)

提供强大的软件来处理图形（直接或非直接）。还生成 Graphivz 代码，可以看到图形表示。您可以将自己的代码算法打包，例如：回溯代码。该软件包提供了一些算法：Dijkstra、回溯最小路径成本等。

# java - Java 泛型：将 Object o 的类与

> ID：51582
> 
> 赞同：26
> 
> 时间：2008-09-09T10:54:10.537
> 
> 标签：java, generics

假设我有以下课程：

```
public class Test<E> {
    public boolean sameClassAs(Object o) {
        // TODO help!
    }
} 
```

我将如何检查`o`与 相同的课程`E`？

```
Test<String> test = new Test<String>();
test.sameClassAs("a string"); // returns true;
test.sameClassAs(4); // returns false; 
```

我无法更改方法签名，`(Object o)`因为我正在覆盖超类，因此不要选择我的方法签名。

我也宁愿不尝试进行强制转换，然后在失败时捕获产生的异常。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-09T11:16:30.907

的实例`Test`没有关于`E`运行时是什么的信息。因此，您需要将 a 传递`Class<E>`给 Test 的构造函数。

```
public class Test<E> {
    private final Class<E> clazz;
    public Test(Class<E> clazz) {
        if (clazz == null) {
            throw new NullPointerException();
        }
        this.clazz = clazz;
    }
    // To make things easier on clients:
    public static <T> Test<T> create(Class<T> clazz) {
        return new Test<T>(clazz);
    }
    public boolean sameClassAs(Object o) {
        return o != null && o.getClass() == clazz;
    }
} 
```

如果您想要“instanceof”关系，请使用`Class.isAssignableFrom`而不是`Class`比较。注意，`E`将需要是非泛型类型，出于同样的原因`Test`需要`Class`对象。

有关 Java API 中的示例，请参阅`java.util.Collections.checkedSet`和类似内容。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-09T11:09:35.650

我一直使用的方法如下。这是一种痛苦，有点难看，但我还没有找到更好的。您必须在构造时传递类类型，因为当泛型被编译时，类信息会丢失。

```
public class Test<E> {
    private Class<E> clazz;
    public Test(Class<E> clazz) {
       this.clazz = clazz;
    }
    public boolean sameClassAs(Object o) {
        return this.clazz.isInstance(o);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T11:03:43.683

我只能让它像这样工作：

```
public class Test<E> {  

    private E e;  

    public void setE(E e) {  
        this.e = e;  
    }

    public boolean sameClassAs(Object o) {  

        return (o.getClass().equals(e.getClass()));  
    }

    public boolean sameClassAs2(Object o) {  
        return e.getClass().isInstance(o);  
    }
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-19T11:11:13.513

我只是想做同样的事情，我刚刚意识到的一个巧妙的技巧是你可以尝试强制转换，如果强制转换失败，则会抛出 ClassCastException。你可以抓住它，然后做任何事情。

所以你的 sameClassAs 方法应该如下所示：

```
public boolean sameClassAs(Object o) {
    boolean same = false;
    try {
        E t = (E)o;
        same = true;
    } catch (ClassCastException e) {
        // same is false, nothing else to do
    } finally {
        return same;
    }
} 
```

# project-management - 工作更新推特

> ID：51584
> 
> 赞同：7
> 
> 时间：2008-09-09T10:55:04.437
> 
> 标签：project-management, project-planning, knowledge-management

如果您每天或每周向项目负责人发送工作/进度报告，我想知道您是否会考虑使用[Twitter](http://twitter.com)或类似服务进行这些更新。

假设您在远程工作或与分布式团队一起工作，并且项目负责人很难了解人们正在研究的主题，以及问题/时间消费者在哪里，您是否会设置一些私人帐户（甚至私人公司内部服务）向您的同事广播进度更新？

**编辑**感谢您提供这些产品的链接，但您是否已经在公司中使用其中一种？用于现实生活中的专业用途？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-09T11:01:32.330

试试[Laconica](http://laconi.ca/)：一个类似 Twitter 的开源系统，您可以在自己的服务器上运行。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T10:59:29.403

查看[http://www.yammer.com](http://www.yammer.com)以获取企业版 twitter。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T11:35:23.793

也许试试[营火](http://www.campfirenow.com/)或[大本营](http://www.basecamphq.com/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T06:32:39.627

我们在我的团队中使用 Laconica，它对于您想要发送给整个团队但不值得浪费电子邮件的那些更新非常有用。

由于只有我的团队在使用我们拥有的 Laconica 安装，因此我将 RSS 用于公共提要，并将其集成到 SharePoint 中。

因此，虽然我们团队中的开发人员和 PM 使用 Twhirl 来管理发送和接收更新，但管理层仍然能够直接在我们的团队网站上查看更新。

这是非常透明的，因为除了最初注册之外，实际上没有人必须去我设置的 Laconica 实例做任何事情。

查看这篇文章，了解我如何将 Laconica 与 SharePoint 集成：[如何将 Laconica 更新流集成到 SharePoint？](https://stackoverflow.com/questions/107872/how-can-i-integrate-laconica-update-stream-into-sharepoint)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T10:59:52.053

保密性和信息安全性如何？我敢肯定，运营 IM 服务的公司会是更好的选择。

我认为 Twitter 和类似服务可用作吸引客户和潜在客户的营销工具。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T11:03:48.860

或者，在 Laconica 上方称为[Identi.ca](http://identi.ca/)的层。在[IT Conversations](http://itc.conversationsnetwork.org/shows/detail3791.html)上与 Identi.ca 的创始人就这种用法进行了很好的讨论。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T19:19:14.540

我的许多同事都在 Twitter 上发布工作更新，注意不要泄露公司机密信息。从那些从事开放商业开发项目的人那里，我什至看到 Twitter 更新表明他们正在从事哪个工作项目。冷静。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T06:57:32.017

我可以看到以这种方式使用 twitter 的吸引力。在我工作的地方，我们基本上会向公司的其他所有人发送每日项目“快照”。随着公司的发展（我们现在接近 35 名员工），阅读（或至少归档/删除）所有收到的状态电子邮件变得有点负担。但是，我不知道我可以看到 Twitter 取代这些电子邮件，因为这些电子邮件不一定应该告诉某人某事何时完成，而是告诉某人我今天正在做什么，以及我即将完成的工作项目在未来。

我想我们的大部分项目更新实际上都是更频繁地亲自完成的。对于较大的项目，我们现在采用所谓的“[燃尽](http://blog.versionone.net/blog/2006/04/burndown_charts.html)”。这基本上意味着我们收集以快速重新估计项目剩余的工作量，然后生成一个漂亮的图表，该图表应该显示项目是否处于正轨。

当有更直接的事情，或者如果有人无法进行讨论/通知时，我们也会偶尔发送电子邮件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-27T18:12:38.940

我会考虑这些报告的目的是什么，然后找到一个强调该目标而不是后勤噩梦的解决方案:)

Twitter 可能仅适用于更新的保质期短，并且将它们分散在其他更新中不会造成破坏性的情况。

像这样的任何 3rd 方服务也存在保密问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-19T20:24:57.597

查看[https://presentlyapp.com/](https://presentlyapp.com/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-09T12:41:07.863

WordPress的[Prologue 主题](http://en.blog.wordpress.com/2008/01/28/introducing-prologue/)在设计时就考虑到了这一点。

# c# - 访问泛型对象的非泛型成员

> ID：51586
> 
> 赞同：3
> 
> 时间：2008-09-09T10:56:45.103
> 
> 标签：c#, .net, generics

有没有办法收集（例如在列表中）多个不共享公共超类的“通用”对象？如果是这样，我怎样才能访问它们的共同属性？

例如：

```
class MyObject<T>
{
   public T Value { get; set; }
   public string Name { get; set; }

   public MyObject(string name, T value)
   {
      Name = name;
      Value = value;
   }
}

var fst = new MyObject<int>("fst", 42);
var snd = new MyObject<bool>("snd", true);

List<MyObject<?>> list = new List<MyObject<?>>(){fst, snd};

foreach (MyObject<?> o in list)
   Console.WriteLine(o.Name); 
```

显然，这是伪代码，这是行不通的。

此外，我不需要访问 .Value 属性（因为那不是类型安全的）。

**编辑：**现在我一直在考虑这个，可以为此使用子类。但是，我认为这意味着我必须为每种新类型编写一个新的子类。

* * *

@Grzenio 是的，这完全回答了我的问题[。](https://stackoverflow.com/questions/51586/accessing-non-generic-members-of-a-generic-object#51621)当然，现在我需要复制整个共享界面，但这不是什么大问题。我早该想到的...

@aku 你对鸭子打字是对的[。](https://stackoverflow.com/questions/51586/accessing-non-generic-members-of-a-generic-object#51611)我不希望可以访问两种完全随机类型的对象。

但我认为泛型对象会共享某种通用接口，因为除了参数化的类型之外，它们完全相同。显然，这不是自动的情况。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-09T11:13:54.483

我认为这在 C# 中是不可能的，因为 MyObject 不是 MyObject 的基类。我通常做的是定义一个接口（一个“普通”接口，不是通用的）并使 MyObject 实现该接口，例如

```
interface INamedObject
{
    string Name {get;}
} 
```

然后你可以使用界面：

```
List<INamedObject> list = new List<INamedObject>(){fst, snd};

foreach (INamedObject o in list)
   Console.WriteLine(o.Name); 
```

它回答了你的问题吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T11:06:50.977

C# 不支持鸭子类型。您有 2 个选择：接口和继承，否则您无法访问不同类型对象的相似属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T11:24:03.883

最好的方法是添加一个公共基类，否则你可以回退到反射。

# sql-server - 如何修复 SSIS 中的多步 OLE DB 操作错误？

> ID：51589
> 
> 赞同：25
> 
> 时间：2008-09-09T10:58:57.377
> 
> 标签：sql-server, ssis

我正在尝试制作一个 DTS 包以在同一服务器上的两个数据库之间传输数据，但出现以下错误。Iv 读到，当您在不同的数据库类型之间传输并且丢失精度时，可能会发生多步 OLE DB 操作生成的错误，但这里不是这种情况。如何检查列元数据？

> 错误：数据流任务中的 0xC0202009，piTech [183]​​：发生 OLE DB 错误。错误代码：0x80040E21。OLE DB 记录可用。来源：“Microsoft SQL Native Client”Hresult：0x80040E21 描述：“多步 OLE DB 操作生成错误。检查每个 OLE DB 状态值（如果可用）。没有完成任何工作。”。
> 
> 错误：数据流任务中的 0xC0202025，piTech [183]​​：无法创建 OLE DB 访问器。验证列元数据是否有效。
> 
> 错误：数据流任务中的 0xC004701A，DTS.Pipeline：组件“piTech”（183）未能通过预执行阶段并返回错误代码 0xC0202025。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-10-01T11:02:02.653

看看字段的属性（类型、长度、默认值等），它们应该是相同的。

我在使用 SQL Server 2008 R2 时遇到了这个问题，因为字段的长度不相等。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-10-22T17:26:03.163

当源表包含 TEXT 列而目标不是 TEXT 列时，此错误很常见。如果您以前没有遇到（或忘记！）它，它可能是一个真正的吃货。

将文本列转换为字符串并将截断时的错误条件设置为忽略。这通常可以作为此错误的解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-09T14:36:38.443

此查询应识别潜在问题的列...

```
SELECT * 
FROM [source].INFORMATION_SCHEMA.COLUMNS src
    INNER JOIN [dest].INFORMATION_SCHEMA.COLUMNS dst 
        ON dst.COLUMN_NAME = src.COLUMN_NAME
WHERE dst.CHARACTER_MAXIMUM_LENGTH < src.CHARACTER_MAXIMUM_LENGTH 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-06-21T09:11:46.367

`'-2147217887' message 'IDispatch error #3105' source 'Microsoft OLE DB Service Components' description 'Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.'."`

这也是我面临的。问题在于我将 SQLOLEDB.1 提供程序更改为 SQLNCLI11 *，而没有*在连接字符串中提及兼容模式。当我`DataTypeCompatibility=80;`在连接字符串中设置它时，问题就解决了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-08-04T10:46:11.383

这个问题主要是由于文件末尾的空行，删除这些并运行作业。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-10-09T17:36:34.643

对我来说，答案是我将两个参数传递给并执行 SQL 任务，但只使用一个。我正在做一些测试，并使用第二个参数注释掉了一段代码。我忽略了删除参数映射。

因此，如果您使用的是执行 SQL 任务，请确保在参数映射中传入正确数量的参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T11:04:15.520

您可以使用`SELECT * FROM INFORMATION_SCHEMA.COLUMNS`，但我怀疑您是从源数据库的脚本创建的目标数据库，因此它们的列很可能是相同的。

一些比较可能会带来一些东西。

这些类型的错误有时也来自尝试将太多数据插入到 varchar 列中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-13T09:23:37.983

当我将数据从旧数据库传输到新数据库时，我遇到了类似的问题，我收到了上面的错误。然后我运行了以下脚本

`SELECT * FROM [source].INFORMATION_SCHEMA.COLUMNS src INNER JOIN [dest].INFORMATION_SCHEMA.COLUMNS dst ON dst.COLUMN_NAME = src.COLUMN_NAME WHERE dst.CHARACTER_MAXIMUM_LENGTH < src.CHARACTER_MAXIMUM_LENGTH`

并发现我的列在字符大小等方面略有不同。然后我尝试将表格更改为不起作用的新表格结构。然后，我将旧数据库中的数据传输到 Excel 中，并将数据从 excel 导入到 100% 工作的新数据库中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-16T12:04:38.180

还要检查脚本是否没有批处理分隔符命令（删除单行上的“GO”语句）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-01-15T11:29:32.743

在我的情况下，问题是设置执行 SQL 任务的变量，在映射参数名称的参数中，（在 OLEDB 中必须是您在存储过程中调用的参数的位置），我有 1，但第一个参数从 0 开始，所以我改变了它，瞧！

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-07-25T20:32:21.420

当尝试进行插入并且字段编码不为空并且尝试插入空值时，也会发生此错误。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2015-11-07T00:11:07.147

将 csv 传输到 mssql 时出现此错误，我将列转换为 DT_NTEXT，mssql 上的某些列设置为 nvarchar(255)。

将它们设置为 nvarchar(max) 解决了它。

# c++ - 是否需要销毁 char * = "string" 或 char * = new char[6]？

> ID：51592
> 
> 赞同：16
> 
> 时间：2008-09-09T10:59:38.620
> 
> 标签：c++, memory

我认为这`char* = "string"`与`char* = new char[6]`. 我相信这些字符串是在堆而不是堆栈上创建的。那么，当我用完它们时，我是否需要销毁它们或释放它们的内存，或者它们是否会被自己销毁？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-09T11:02:44.480

`malloc`不需要。当您使用函数（在 C 中）或`new`运算符（在 C++ 中）手动分配内存时，您只需要手动释放字符串。如果不使用`malloc`or `new`，则`char*`or 字符串将在堆栈上创建或作为编译时常量。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-09T11:04:51.120

不，当你说：

```
const char* c = "Hello World!"; 
```

您将 c 分配给一个“预先存在的”字符串常量，它与以下内容不同：

```
char* c = new char[6]; 
```

只有在后一种情况下，您才在堆上分配内存。所以你会在完成后调用 delete 。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T11:02:20.410

> 我假设当我做`char* = "string"`与`char* = new char[6]`.

不，第一个做的是创建一个常量。修改它是未定义的行为。但要回答你的问题；不，你不必摧毁它们。只是一个说明，总是`std::string`尽可能使用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-12T05:25:07.043

游戏的名称是“只摧毁你创造的东西”。这是对：

1.  `malloc`/`free`
2.  `calloc`/`free`
3.  `new`/`delete`
4.  `new []`/`delete []`

由于您使用 . 创建了第二个字符串`new []`，因此您有责任使用 . 销毁它`delete []`。完成后打电话`delete [] string2`。

现在，如果您的代码足够复杂并且难以跟踪删除，请考虑使用范围指针或自动指针。boost 库中的[`boost::scoped_ptr`](http://www.boost.org/doc/libs/1_44_0/libs/smart_ptr/scoped_ptr.htm)类是一个很好的起点。还要查看[RAII](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)成语，非常方便和有用的东西。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-09T11:02:11.003

他们不一样。您的第一个示例是一个常量字符串，因此绝对不是从堆中分配的。您的第二个示例是 6 个字符的运行时内存分配，它来自堆。你不想删除你的第一个例子，但你需要`delete []`你的第二个例子。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T11:01:15.467

您不知道字符串文字的存储位置。它甚至可能是只读内存，因此您的代码应为：

```
const char* c = "string"; 
```

并且应该像任何其他动态分配的内存区域一样*delete d**新的 char 数组。*

 ** * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-05T12:26:23.890

**让我们看看 GCC 4.8 x86-64 Linux 做了什么**

程序：

```
#include <cstdio>
int main() {
    const char *s = "abc";
    char *sn = new char[4];
    sn[3] = '\0';
    std::printf("%s\n", s);
    std::printf("%s\n", sn);
} 
```

编译和反编译：

```
g++ -c -ggdb -o a.o -std=c++98 a.cpp
objdump -CSr a.o 
```

输出包含：

```
 const char *s = "abc";
 8:   48 c7 45 f0 00 00 00    movq   $0x0,-0x10(%rbp)
 f:   00 
                     c: R_X86_64_32S .rodata
  char *sn = new char[4];
10:   bf 04 00 00 00          mov    $0x4,%edi
15:   e8 00 00 00 00          callq  1a <main+0x1a>
                        16: R_X86_64_PC32       operator new[](unsigned long)-0x4
1a:   48 89 45 f8             mov    %rax,-0x8(%rbp) 
```

解释：

*   `char *s = "abc"`进入`.rodata`。所以你不能`free`以任何方式。
*   `char *sn = new char[4];`来自 的输出`operator new[]`。所以你应该尽可能释放它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-09T11:04:50.513

new 始终是分配，而定义字符串内联实际上将数据嵌入程序本身并且无法更改（某些编译器通过巧妙的技巧允许这样做，不要打扰）。

一些编译器键入内联字符串，因此您无法修改缓冲区。

```
char* const sz1 = "string"; // embedded string, immutable buffer
char* sz2 = new char[10]; // allocated string, should be deleted 
```

# exception - Apache XML-RPC 异常处理

> ID：51593
> 
> 赞同：3
> 
> 时间：2008-09-09T10:59:41.867
> 
> 标签：exception, xml-rpc

从通过 Apache 的 XML-RPC 实现返回的异常中提取原始异常的最简单方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T14:09:05.793

事实证明，从 Apache 异常中获取原因异常是正确的。

```
} catch (XmlRpcException rpce) {
    Throwable cause = rpce.getCause();
    if(cause != null) {
        if(cause instanceof ExceptionYouCanHandleException) {
            handler(cause);
        }
        else { throw(cause); }
    }
    else { throw(rpce); }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T21:49:50.227

根据[XML-RPC 规范](http://www.xmlrpc.com/spec)，它返回 xml 中的“故障”。

这是您所指的“异常”还是您指的是在进行 XML-RPC 调用时生成的 Java 异常？

**故障示例**

```
HTTP/1.1 200 OK
Connection: close
Content-Length: 426
Content-Type: text/xml
Date: Fri, 17 Jul 1998 19:55:02 GMT
Server: UserLand Frontier/5.1.2-WinNT

<?xml version="1.0"?>
<methodResponse>
  <fault>
    <value>
      <struct>
      <member>
        <name>faultCode</name>
        <value><int>4</int></value>
      </member>
      <member>
        <name>faultString</name>
        <value>
          <string>Too many parameters.</string>
        </value>
      </member>
      </struct>
    </value>
  </fault>
</methodResponse> 
```

# git - 如何在 IIS 上设置 Git 裸 HTTP 可用存储库

> ID：51619
> 
> 赞同：33
> 
> 时间：2008-09-09T11:11:45.300
> 
> 标签：git, version-control, iis-7, dvcs

我的服务器已经在 TCP 端口 80 和 443 上运行 IIS。我想通过 Internet 为我的所有团队成员提供一个集中的“推/拉”Git 存储库。

所以我应该使用 HTTP 或 HTTPS。

但是我不能使用 Apache，因为 IIS 已经在端口 80 和 443 上连接了监听套接字！有没有办法通过*IIS*发布 Git 存储库？Git 使用 WebDAV 吗？

**更新。**似乎 Git HTTP 安装是只读的。这很可悲。我打算将稳定分支保留在构建服务器上，并使用推送挂钩重新部署。除了为该分支使用 SVN 之外，还有人看到解决方法吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2010-10-25T14:16:06.423

**Bonobo Git 服务器**

[https://bonobogitserver.com/](https://bonobogitserver.com/)

* * *

**GitAspx** - 杰里米·斯金纳 (Jeremy Skinner)

[https://github.com/JeremySkinner/git-dot-aspx/](https://github.com/JeremySkinner/git-dot-aspx/)

[https://github.com/JeremySkinner/git-dot-aspx/downloads](https://github.com/JeremySkinner/git-dot-aspx/downloads)

*安装说明*

[https://www.jeremyskinner.co.uk/2010/10/19/gitaspx-0-3-available/](https://www.jeremyskinner.co.uk/2010/10/19/gitaspx-0-3-available/)

* * *

**Git 网页**

[https://gitweb.codeplex.com/](https://gitweb.codeplex.com/)

* * *

**WebGitNET**

[https://github.com/otac0n/WebGitNet](https://github.com/otac0n/WebGitNet)

* * *

***或者...***（非 IIS，但强烈推荐，免费和开源）

**Gitea**（Gogs 的分支）：[https ://gitea.io](https://gitea.io)

**高斯：[https :](https://gogs.io) **//gogs.io****

 ****SCM Manager**允许您在同一托管进程下轻松设置**Git**、**Hg**和**SVN的修订控制端点。**支持 HTTP/HTTPS 以及内置的用户身份验证。

[https://www.scm-manager.org](https://www.scm-manager.org)
[https://bitbucket.org/sdorra/scm-manager/](https://bitbucket.org/sdorra/scm-manager/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-16T18:37:09.570

Git 应该支持 webdav，并且应该与任何 webdav 服务器一起使用。但是，与本机 git 协议相比，它确实很慢。

[http://www.kernel.org/pub/software/scm/git/docs/howto/setup-git-server-over-http.txt](http://www.kernel.org/pub/software/scm/git/docs/howto/setup-git-server-over-http.txt)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-20T15:20:07.853

如今，Git 在 Windows 上的表现还不错。

如果您想在 IIS 已经在使用 SVN 端口 443 和/或 80 时使用它，请尝试[http://gstoolkit.codeplex.com/wikipage?title=SvnReverseProxy&ProjectName=gstoolkit](http://gstoolkit.codeplex.com/wikipage?title=SvnReverseProxy&ProjectName=gstoolkit)上的工具，这是一个允许 IIS 的反向代理通过 SVN 透明地传递到后端 VisualSVN 服务器（在端口 8080 上的同一台机器上运行）。

不过，我仍在尝试让 WebDAV 和 Git 在 Windows 上运行。（通过 Apache 或 IIS 的 WebDAV）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-19T23:21:07.400

有一种方法可以在没有 cygwin 的情况下使用 MSysGit 设置 Git。 [http://java2cs2.blogspot.com/2010/03/setup-git-server-on-windows-machine.html](http://java2cs2.blogspot.com/2010/03/setup-git-server-on-windows-machine.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-04T20:48:53.273

试试这个使用 SCM-Manager 和 IIS 的指令：[Hosting Git, SVN and Hg (Mercurial) repositories on Windows with IIS](http://www.helicontech.com/articles/hosting-git-svn-and-hg-mercurial-repositories-on-windows-with-iis/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-26T20:03:44.603

[https://github.com/projectkudu/kudu](https://github.com/projectkudu/kudu)是 Azure 部署背后的引擎。这可能对仍在问这个问题的人有所帮助......

# wpf - 设计师和开发人员一起工作

> ID：51624
> 
> 赞同：34
> 
> 时间：2008-09-09T11:16:47.253
> 
> 标签：wpf, silverlight, communication

WPF 和 Silverlight 丰富的演示功能意味着像我这样的开发人员现在将更频繁地与图形设计师密切合作，就像我的下一个项目一样。

有没有人有任何提示和经验（从两个角度来看）让这件事变得更顺利？

例如，当我最近向设计师提到源代码控制时，我很快就被告知你不能对图形、图像等进行源代码控制，所以这是浪费时间。所以我回答：好的，但是 WPF/Silverlight 中的 XAML 文件呢？

[Scott Hanselman 在播客](http://www.hanselminutes.com/default.aspx?showID=138)中谈到了这个话题，但他更关注工具，而我对沟通问题/方面更感兴趣。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-09T21:47:23.463

我发现的一件事是，作为开发人员，您如何设计代码会极大地影响设计人员可以用它做什么。通常，您从 Web 下载 Silverlight 或 WPF 示例应用程序并在 Blend 中打开它，只是让 Blend 崩溃，因为代码在设计器中运行不佳。如果它没有崩溃，它就很少看起来像正在运行的应用程序。

我最近在澳大利亚和新西兰的 Tech Ed 发表了关于可以应用于“可设计性设计”的技术的演讲。包括一个简短的列表：

1.  编写可以利用数据绑定的代码。Model-View-ViewModel 或演示模式非常适合这种情况。

2.  为您的服务依赖项提供“设计时”存根。如果您要绑定的类进行 Web 服务调用，请确保将 Web 服务客户端替换为一个存根类，该存根类返回设计器在 blend 中使用的“虚拟数据”。这可以通过 IoC 和依赖注入轻松完成，如果 HtmlPage.IsEnabled == false 则注入一个实现。

3.  通过使用数据绑定，您可以限制 XAML 文件中的“命名元素”数量。如果您在后面编写大量代码，最终会将您的 C# 代码与命名元素（例如 txtName 或 txtAddress）耦合，从而使设计人员很容易“搞砸”。

4.  使用命令模式而不是单击事件处理程序后面的代码。通过将事件的调用者与处理程序松散耦合，您可以拥有较少命名的元素，并且您可以让设计人员自由选择按钮或菜单项来调用特定命令。

5.  在 Blend 中测试您的代码！即使您认为自己是一个纯粹的开发人员，您也应该测试您的代码是否可以被工具使用，并努力在设计时获得最佳体验。有些人会争辩说，一个工具不应该影响你的软件设计，就像有些人抱怨“为可测试性而设计”，并且做出软件设计决策只是为了让代码更可测试。我认为这是一件很聪明的事情，也是让真正的设计师-开发人员工作流程顺利进行的唯一方法。

其他提示是从小处着手。如果您的设计师是 XAML、WPF 和 Silverlight 的新手，请先将他们介绍给项目团队，并让他们使用他们熟悉的工具进行一些基本设计。让他们在 Adob​​e Illustrator 中制作一些按钮和插图，然后将其导出到 XAML，并向他们展示如何直接利用他们的设计资源。继续介绍越来越多的产品，希望他们对此感兴趣并希望改用 Blend。这是一个学习曲线，但它肯定是值得的！

祝你好运！

[PS：我已经在我的博客http://jonas.follesoe.no](http://jonas.follesoe.no)上写了关于模式和设计友好代码的分配。您还可以找到指向我的 Tech Ed 演讲视频记录的链接，以及许多进一步阅读该主题的链接。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-09T11:36:51.013

我花了 4 个月时间在一个与设计师密切合作的项目上，但他仍然没有掌握 CVS 的基本概念（这不是我选择的源代码控制系统）。我在这里说的是模板文件、JavaScript 和 CSS。他并不愚蠢，这只是其中一件让他的工作变得更加困难的事情，所以他拒绝完全投入其中。

就我而言，我必须真正强调几乎所有的 JavaScript 都依赖于标记，当他将他的纯 CSS、基于 DIV 的布局更改为基于表格的布局时，我没有告诉我我所有的 JS 都在运行打破。

在项目过程中，我自己和设计师经常在工作之余和我相处得很好，并在工作之余踢足球，就我们各自的职责进行了非常激烈的交流。如果我对他不够了解，无法通过这些交流，那么我认为这将创造一个难以忍受的工作环境。因此，我认为在你们双方以及与某种类型的经理或项目主管之间确定项目期间双方的期望是很重要的。

就我而言，最近几乎没有问题，因为 CVS 的情况已经解决，而且他不能随心所欲地改变加价的想法。设计师不是尝试创建模板文件并直接处理它们，而是只处理静态文件，我有责任将它们插入我的模板文件中。

这都是关于沟通和双方的一点妥协。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-09T11:27:22.080

这可能有点离题（我专门回答您关于源代码控制和图形的问题），但您*可以*将二进制数据（图像等）放入源代码控制（我认为在很多情况下应该） - - 它们只是占用更多磁盘空间，您不能使用差异视图以任何有意义的方式分析发生了什么变化，但您获得的是记录每个修订、回滚能力和轻松归档能力的提交消息历史记录（用 SVN 术语*标记修订*）一起属于特定版本/版本的所有文件（无论是视觉资产、文档、源代码等）。您的构建系统也更容易从源代码管理中获取构建特定版本软件所需的所有内容。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-09T11:33:09.803

让平面设计师参与早期的设计和建筑课程。

你想让他们参与进来，以揭示错位的假设，并建立一种合作模式，而不是在墙上来回扔东西。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-16T06:54:48.790

最初，设想专业设计师将在 Expression Blend 中工作，而开发人员将在 Visual Studio 中工作，对一组共享的源文件进行更改。虽然这样做当然是可能的（只要您定期仔细检查您没有破坏其他开发人员或设计工具所期望的内容），开发人员社区的许多成员，包括微软内部的一些成员，已经发现保持 Blend 和 Visual Studio 项目活动分开的好处——甚至到手动剪切和粘贴经过仔细重构的 Blend 生成的 Xaml 版本到“官方”VStudio 项目源中，而不是让设计人员和开发人员直接在单个项目上进行操作共享代码库。微软'

[Real_World_WPF_DesignersAndDevelopersWorkingTogether](http://channel9.msdn.com/posts/Charles/Real-World-WPF--Designers-and-Developers-working-together/)

吸取的主要教训之一是，您不能为项目配备完全不了解彼此领域的设计师和开发人员。开发人员需要对 Blend 足够熟悉，以便他们可以为设计人员提供有用的 UI 外壳供设计人员进行装饰，以及设计人员可以设计交互性的有用数据“存根”，并且设计人员需要对他们不了解的开发问题有足够的了解不要做诸如删除控件并用自定义视觉元素替换它们之类的事情——没有意识到它们破坏了与原始控件相关的所有功能。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-10T18:42:19.097

微软对设计师/开发人员工作流程结合的愿景在现实生活中似乎肯定会失败。我在一个相当大的 WPF 项目上工作了大约 4 个月，其中涉及 2 个专门的设计资源。以下是微软似乎经常忘记的一些事实。

*   设计师通常更喜欢使用 Mac（我公司的设计师是 100% Mac - 0% Windows）
*   Blend 不能在 Mac 上运行（就 VM 解决方案而言——设计师通常不喜欢在外国操作系统中运行奇怪的应用程序等令人讨厌的解决方案）。
*   设计师使用他们的行业工具 - Photoshop 和 Illustrator。时期。
*   今天日程安排的激进通常不会为设计师提供足够的时间来学习全新的应用程序/设计环境（如 Blend）。

因此，鉴于上述情况，我注意到这创造了一种新的工作类型——要么是一个技术含量很高的设计师，要么是一个图形开明的程序员。基本上，可以采用原始形式的设计资产（通常是 .psd 或插画格式）并根据需要将这些应用到申请流程的人。

我原来就是那个人（图形开明的程序员）。我花了很多时间从 Illustrator 文件中导出 XAML，在必要时手动清理它们，并使这些资产在 Blend 或 VS 中易于使用显示对象。有时我会采用设计元素并使用混合重新绘制它（通常当原始资产是基于位图的并且将其转换为矢量更有意义时）。

我的应用程序可能并不典型——因为它的图形非常丰富，分辨率独立性是主要目标之一，因为它需要在多种分辨率和纵横比上看起来不错（想想在当今的环境中为电视设计的困难——事情有在低分辨率标清中看起来不错，并且可以很好地扩展到高分辨率高清）。

总之，我认为 WPF 是一项了不起的技术，并且绝对是微软朝着正确方向迈出的一步。然而，它并不是将设计师集成到开发过程中的最终解决方案——除非您重新定义设计师的角色。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-02-17T16:44:50.323

我是 Felix Corke，你提到的 hanselman 播客的设计师，所以这里有几点来自真正的创意而不是开发人员。

我花了很长时间才习惯了开发人员工具——几年前我第一次开始做 xaml 工作时，我从未听说过 Visual Studio、C# 或任何类型的源代码控制。它们对我来说就像 Illustrator 或 3DsMax 对你一样陌生。

我最大的一点是不能指望设计师知道开发人员的做法——请准备好做大量的手把手。您不必学习任何新东西，而设计师将进入应用程序开发的一个全新的可怕方面。我把一些解决方案和签到弄得一团糟（现在仍然如此）。

令人高兴的是，我学会了成为一个专注于设计的集成者，而不是一个单纯的创意者，也许这是你需要在项目中包含的角色。这是我为我们的美丽和极客制作的插图 - Mix 的设计师/开发人员会议 - 如果你们中的任何一个在光谱的任何一端都太过分了，那么可能很难理解另一个是如何工作的以及他们应该扮演什么角色。

![替代文字](https://blackspike.com/permanent/dev-designer.png)

很高兴回答任何具体问题！

ps 你不想在源代码管理中使用 100Mb+ .psd 文件；）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-02T15:04:51.783

我非常相信 Integrator 方法，这确实是我必须执行的角色，以使我们的 WPF 工作取得成功。

Laurent Bugnion 对此有一篇[文章](http://geekswithblogs.net/lbugnion/archive/2007/05/13/WPF-The-integrator.aspx)，描述了我在说什么。[Robby Ingebretsen](http://nerdplusart.com/)也是这种方法的忠实拥护者。

但基本上，必须有人填补开发人员世界和设计师世界之间存在的“差距”。通常发生的情况是，此人来自开发人员世界或设计师世界。如果他们来自开发人员世界，那么他们可能是具有设计师倾向的开发人员（他们负责外观、应用程序中的视觉效果、屏幕布局等）。如果他们来自设计师世界，那么他们就不会害怕代码，并且喜欢时不时地潜入代码以获得动画或任何闪闪发光的东西。

然而，无论他们来自哪个世界，他们通常都必须培养他们以前从未有过的技能。就我而言，我是喜欢用户界面层的开发人员，因此我会说我是一名具有设计师倾向的开发人员。为了弥补这一差距并与我们的图形设计师进行富有成效的对话，我不得不学习一大堆设计师类型的技能，比如：学习使用 Expression Design、XAM 3D 等。

Shannon Braun 最近在当地的开发者大会上就开发者/设计师的关系以及社区为他们发现的工作流程做了一个演讲。我没有参加会议，但我认为他的[幻灯片](http://www.sysknowlogy.com/2008/09/09/UI+Designer+And+Developer+Workflow.aspx)对此事进行了很好的讨论。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-08-05T23:56:06.997

设计师在多大程度上认为有权远离构建软件产品所涉及的整个工作，这是一个更大的问题，需要解决。不要迎合任何设计师表达的不必知道他们的工作如何融入整体的权利。

在设计师社区中成长起来的那种明显的专业化是软件开发行业面临的最大工业成熟度问题之一。这是一种专业化程度，可以预见地创造更多的返工和更长的周期时间。

这也是开发人员幸福地不知道交互设计和实现的权利感。

极端专业化始终是生产力问题的指数乘数。通过采用促进学习文化的流程从组织上解决它。这是大多数其他生产行业已经实现的成熟度，而软件却严重落后。

在过度专业化、工作队列和缓冲区之间发生切换的开发工作流程中的每个地方。软件仍然是少数几个没有认识到这是我们面临的最大问题之一的行业之一。这在 Microsoft 社区中更加严重，因为由于 Microsoft 通过其工具和指导长期存在过度专业化，过度专业化似乎变得越来越正常。除非您有能力像微软那样在开发工作上浪费那么多钱，否则您应该寻找更了解流程和生产力问题的方法。

因此，不会测试的开发人员和不会编码的测试人员是同一种工业不成熟的表现。

您不会从 TFS 的 Scrum 模板中学到任何这些。微软在让敏捷思维发挥作用方面落后了很多年，即使是在最基本的形式中，现在我们正在进入精益思维，微软距离尝试将精益思维融入其产品线还有三到五年的时间. 不要等待微软告诉你如何塑造团队和工作流程。你现在可以向微软几年后最终关注的人学习。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-08T16:58:15.577

根据我的经验，除非（小）团队中的每个人都能够执行此角色，否则集成者或“设计者”角色确实需要参与此过程。这是一种非常罕见的情况。通常你会发现开发人员非常擅长开发，但在设计/可用性方面不是很好，而设计师在美学/可用性方面很出色，但不想或没有受过足够的编码来编码。拥有一个可以跨越两个世界并“说这种语言”的人非常重要。

集成商需要将正在开发的控件与设计师正在创建的设计资产进行协调。在我们当前的项目中，我们有 6 名活跃的开发人员和 2 名来自外部商店的设计师。我是这个项目的集成商，我大部分时间都在 Expression Blend 中度过。开发人员主要在 VS 中工作，创建符合我们产品规范的控件，而设计车间正在设计最终产品的外观。设计师在 Illustrator 中工作。我的工作是获取 Illustrator 文件并从中创建控件样式，然后将它们应用于我们开发团队开发的控件。随着我们转向对 PSD 和 AI 文件提供原生支持的 Blend 3，这项任务变得更加容易。

在应用程序主干的单独解决方案中为您的应用程序创建“外观”非常有帮助，然后稍后将您的 ResourceDictionaries 合并到主应用程序中。您可以获得正确的外观和感觉，而不会太陷入可能仍然不完整的控件中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-01-21T12:43:57.827

自从您提到 SL 以来，我将假设您指的是 RIA 项目。

我曾与 Adob​​e 一起设计和开发应用程序和服务的许多 RIA 项目。

基于我作为 UX 和视觉设计师 14 年的经验和一些编程经验，我能给你的最好的建议虽然与你们相比可悲。

**接受你们不会互相理解。**

程序员思考应该完成**什么功能，设计师思考功能应该****如何**表现。

对于开发人员来说，按钮大多是通用的，但对于设计人员来说并非如此。设计师在组合中思考，开发者在框架中思考。

所以要学会理解你的责任是不同的。

您的开发人员确实需要考虑您的代码的通用性，并且不能将所有内容都视为唯一且硬编码的组合。那是除非你能以某种方式自动化这种独特性。

设计者确实需要将应用程序或服务视为某种独特的。这可能意味着按钮不是按钮。可能有不同的尺寸或颜色或其他烦恼。

因此，通过承认您了解设计师的责任并确保他了解您的责任，确保您与设计师建立良好的关系。

这并不是说您对制作世界上最好的应用程序不感兴趣。只是其中一些设计决策需要花费大量时间。

确保你非常清楚设计师应该如何为你提供服务，这样你就不会浪费他或你自己的时间。什么格式，资产？命名？

从一个范式传递到另一个范式所涉及的所有事物。

最重要的是沟通和尊重他们不知道如何做 JavaScript 或如何理解 CVS 的基本思想。

大多数开发人员你不知道如何调整字距以挽救他们的生命，寡妇是什么，如何最好地分层 FireWorks 或创建照片般逼真的图标，想出一个好的标语或让乔用 4 个字平均理解的东西。您不知道什么是网格或对齐方式，并且您倾向于在黑色上使事物变成绿色和紫色。

设计师应该明白，仅仅因为你处理编程并不意味着你是一个机器人，你不能有创造性的想法和解决方案。他还应该尝试至少学习如何编写伪程序，以便他了解制作项目所涉及的内容。

最重要的是。不要开始争论 Mac 与 PC :) 项目因此被取消。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-09T11:43:58.483

坦率地说，您应该告诉设计师图像可以、应该并且“将被放入源代码控制中！” :)

这可能有点不合常规，您将无法进行合并或任何类似性质的事情，但会有修订和历史记录等。图像也可以嵌入到资源文件中，该文件也可以进入源代码控制.

XAML 可以（并且应该）置于源代码管理中，并且作为其标记文件，它将受益于所有功能。

至于与设计师合作的技巧，仅凭那条评论就吓坏了我，所以这一切都归结为你正在与谁合作。我会以一种很好的方式解释基本的最佳实践，然后从那里开始。

# c - C中的文件描述符分配

> ID：51627
> 
> 赞同：4
> 
> 时间：2008-09-09T11:18:58.967
> 
> 标签：c, file-descriptor

在 C 中创建套接字或打开/创建文件时，分配给套接字/文件的文件描述符是否保证是可用的最低值描述符？C 规范在这方面对文件描述符分配有什么看法（如果有的话）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T11:45:42.893

它不能保证是最低的，并且取决于实现*(1)*。然而，一般来说，分配打开文件描述符的例程使用一种方法，可以让您第一次打开。可能是在几个较低的释放之后立即给您留下比您预期的更高的描述符。

不过，我能想到知道这一点的唯一原因是 select 函数，如果您将需要检查的最高文件描述符传递给它，它会加速。

*(1)*请注意，遵循 IEEE 标准的那些实现确实保证了文件的最低未使用描述符，但这可能不适用于套接字。并非每个实现都遵循 IEEE 标准的 open()，因此如果您正在编写可移植软件，最好不要依赖它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T11:21:06.433

我认为您不会在 C 规范中找到它，更有可能是您的操作系统的规范。我在 Linux 中的经验是它总是最低的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T11:26:15.687

我会用另一个问题来反驳这个问题——为什么这很重要？您不应该将文件描述符与任何东西进行比较（除非检查 stdin/stdout/stderr）或用它做数学运算。只要它适合 int （并且保证），这就是您真正需要知道的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T11:27:41.660

史蒂夫 M 是对的；C 没有套接字的概念，它的文件 I/O 函数使用 [pointer to a] FILE 对象，而不是描述符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T12:48:08.830

@aib open()、close()、lseek()、read()、write() 都使用文件描述符。我几乎从不使用流进行 I/O。

@Kyle 这很重要，因为 select() 之类的语句。知道最高描述符可以提高性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-27T20:59:27.053

C规范说它依赖于实现。如果您正在查看 Unix 实现，open(2) 的手册页显示“成功调用返回的文件描述符将是当前未为进程打开的编号最小的文件描述符。”

如果您尝试将特定文件附加到特定描述符，这会有所帮助。假设您想将 stderr 重定向到 /dev/null。就像是

关闭（2）；open("/dev/null", O_WRONLY);

应该这样做。当然，您应该捕获 open 返回的 fd 并确保它是 2。

# c# - 如何发现 USB 存储设备和可写 CD/DVD 驱动器 (C#)

> ID：51645
> 
> 赞同：5
> 
> 时间：2008-09-09T11:28:30.423
> 
> 标签：c#, .net-2.0

如何在给定时间发现任何可用的 USB 存储设备和/或 CD/DVD 刻录机（使用 C# .Net2.0）。

我想向用户展示可以存储文件以进行物理删除的设备选择——即不是硬盘驱动器。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-09T11:46:05.780

```
using System.IO;

DriveInfo[] allDrives = DriveInfo.GetDrives();
foreach (DriveInfo d in allDrives)
{
  if (d.IsReady && d.DriveType == DriveType.Removable)
  {
    // This is the drive you want...
  }
} 
```

DriveInfo 类文档在这里：

[http://msdn.microsoft.com/en-us/library/system.io.driveinfo.aspx](http://msdn.microsoft.com/en-us/library/system.io.driveinfo.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T11:35:44.230

这是用于检查连接到计算机的任何可移动驱动器或 CDRom 驱动器的 VB.NET 代码：

```
Me.lstDrives.Items.Clear()
For Each item As DriveInfo In My.Computer.FileSystem.Drives
    If item.DriveType = DriveType.Removable Or item.DriveType = DriveType.CDRom Then
        Me.lstDrives.Items.Add(item.Name)
    End If
Next 
```

将此代码修改为 ac# 等效代码并不难，而且还有更多*driveType*可用。
[来自 MSDN：](http://msdn.microsoft.com/en-us/library/system.io.drivetype.aspx)

*   **未知：** 驱动器类型未知。
*   **NoRootDirectory：** 驱动器没有根目录。
*   **可移动：** 驱动器是可移动存储设备，例如软盘驱动器或 USB 闪存驱动器。
*   **固定：** 驱动器是固定磁盘。
*   **网络：** 驱动器是网络驱动器。
*   **CDRom：** 驱动器是一种光盘设备，例如 CD 或 DVD-ROM。
*   **Ram：** 驱动器是 RAM 磁盘。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T11:47:39.443

在 c# 中，您可以使用 System.IO.DriveInfo 类获得相同的结果

```
using System.IO;

public static class GetDrives
{
    public static IEnumerable<DriveInfo> GetCDDVDAndRemovableDevices()
    {
        return DriveInfo.GetDrives().
            Where(d => d.DriveType == DriveType.Removable
            && d.DriveType == DriveType.CDRom);
    }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-05T19:05:56.897

这是 VB.NET 的完整模块：
Imports System.IO
Module GetDriveNamesByType
Function GetDriveNames(Optional ByVal DType As DriveType = DriveType.Removable) As ListBox
For Each DN As System.IO.DriveInfo In My.Computer.FileSystem.Drives
If DN .DriveType = DType Then
GetDriveNames.Items.Add(DN.Name)
End If
Next
End Function
End Module

```
'Drive Types <br>
'Unknown: The type of drive is unknown. <br>
'NoRootDirectory: The drive does not have a root directory. <br>
'Removable: The drive is a removable storage device, such as a floppy disk drive or a USB flash drive. <br>
'Fixed: The drive is a fixed disk. <br>
'Network: The drive is a network drive. <br>
'CDRom: The drive is an optical disc device, such as a CD or DVD-ROM. <br>
'Ram: The drive is a RAM disk. <br> 
```

# agile - 现成的软件如何适应敏捷开发？

> ID：51649
> 
> 赞同：3
> 
> 时间：2008-09-09T11:31:03.977
> 
> 标签：agile

也许我对敏捷开发的理解没有达到应有的水平，但我很好奇当最终系统的需求和知识应该是什么时，敏捷开发人员可能会如何使用现成的 (OTS) 软件以我理解的速度变化（通常在每次开发迭代之后）。

* * *

我看到了两种我特别感兴趣的情况：

(1) OTS 系统满足初始要求集，除了可能集成到现有系统之外，几乎没有修改。然而，在开发的几次迭代中，这个系统在不重写核心代码的情况下已经不能满足需求。开发人员必须选择要么花更多时间学习此 OTS 软件背后的核心代码，要么将其丢弃并从头开始构建。两者都会对开发时间和项目成本产生巨大影响。

(2) 最初的需求不像任何现有的OTS系统可用，但最终当客户接受产品时，由于需求的增加和减少，它最终与现有的解决方案非常相似。如果开发人员有更多的需求并在前期花费更多的时间来解决这些问题，则可以使用此解决方案而不是再次构建。该项目已交付，但较晚且成本高于必要。

* * *

作为一名软件工程师，我的部分职责（正如我被教导的那样）是以尽可能低的成本（除其他外）按时向客户交付高质量的软件。敏捷开发允许高质量的软件，但在某些情况下，可能不明显有更好的替代方案，直到为时已晚并且花费了太多钱。

我的问题是：

1.  现成的软件如何适应敏捷开发？
2.  敏捷经理和敏捷开发人员如何处理这些情况？
3.  敏捷范式对这些案例有什么看法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T12:48:37.440

## 场景1：

无论组件的 OTS 特性如何，都会发生这种情况。敏捷并不意味着近视......你需要了解大块......框架位并事先花时间思考。也就是说，您只能根据您所知道的内容进行构建.. 仅延迟到最后一个负责任的时刻。然后您需要选择一个替代方案并开始使用它。（我会避免第三方应用程序，除非在内部开发它的成本是不可行的......但这只是我）。对多种解决方案进行原型设计，以检查已知需求列表的可行性。保持松散耦合（可替换），易于更改和全面测试。如果您要继续进行黑客攻击或重写，您需要考虑哪个对业务具有更好的价值并选择该选项。它下来了'现在我们在这里，什么'

## 场景2：

尽管与团队花费 2-3 个月试图“最终确定”需求但发现市场需求或客户的想法已经发生变化并且“现在我们希望这样”相比，这种情况发生的可能性很小。再一次，这是一个问题，即在采取行动之前，您准备调查和探索的时间点是多少。明智地决定你所拥有的任何信息。事后诸葛亮总是 20-20，但客户不会永远等待。您不能等到需求合并以适应已知的 OTS 组件的时间点:)

**敏捷说做任何有意义的事，去掉非增值活动:) 敏捷不是灵丹妙药。**只是我的 2 敏捷美分 :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T11:40:12.610

本身并不是一个严格的答案，但我认为在以下情况下使用现成的软件作为软件解决方案中的一个组件会非常有益：

*   它的数据是开放的，例如一个开放的数据库或与之交互的网络服务
*   现成的系统可以使用与您解决方案的其余部分类似的编程范例*轻松定制*
*   它可以无缝适应您的其他工作流程

我非常喜欢不重新发明轮子，并且使用您的开发技能来设计现成解决方案之间的“胶水”可能是一个巨大的胜利。

请记住，“开放”是重要的部分，供应商通常会吹捧他们的解决方案是开放的，但实际上并非如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T11:47:14.733

我想我在某处读到过，如果在迭代过程中你发现你的工作量比你最初认为的多 20%，那么你应该放弃冲刺并开始计划一个新的冲刺，同时考虑到额外的工作。

因此，这意味着与业务部门重新计划，看看他们是否仍然希望在您了解更多之后继续执行原始要求。

在我们公司，我们还在 sprint 之前使用原型设计来尝试在 sprint 出现之前识别这些情况。当然，这仍然可能无法确定您描述的那种情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:07:30.967

C2 wiki 讨论：[http ://c2.com/cgi/wiki?BuyDontBuild](http://c2.com/cgi/wiki?BuyDontBuild)

# orm - 如何处理在域模型中没有表示的查询？

> ID：51653
> 
> 赞同：5
> 
> 时间：2008-09-09T11:34:07.180
> 
> 标签：orm

这不是特定于任何语言的，它只是关于最佳实践。我正在使用 JPA/Hibernate（但它可以是任何其他 ORM 解决方案），我想知道你们如何处理这种情况：假设您有一个查询返回的东西没有由您的任何域类。您是否创建了一个特定的类来表示该特定查询？您是否在其他类型的对象（数组、地图...）中返回查询 其他解决方案？我想了解您的经验和最佳实践。

PS 实际上，我正在为特定查询创建特定的对象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T12:39:56.227

我们的情况听起来与您的情况相似。

我们使用单独的对象来报告跨越多个域对象的数据。我们的约定是这些将由数据库中的视图支持，因此我们将它们称为视图对象。我们通常使用它们将复杂数据汇总为平面格式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T12:39:24.683

将功能包装在某种管理器中的想法总是很好。它允许更好的测试，并因此管理模式更改。

还允许在应用程序中更轻松地重用。千万不要直接把sql放进去！！！。对于 Hibernate，我发现 HQL 非常适合这一点。特别是，如果您可以使用命名查询。还要小心添加过滤器值等使用“字符串附加”，使用参数（我们可以说 SQL 注入吗？）。即使 SQL 在 join 或 where 条件方面是动态的，在某种管理器中具有函数总是最好的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T12:43:27.593

@DrPizza

我会更具体。我们在一个数据库中有三个表

```
USER
PROJECT
TASK
USER to TASK 1:n
PROJECT to TASK 1:n 
```

我有一个查询，它返回所有项目的列表，但也显示一些分组信息（所有任务、打开的任务、关闭的任务）。返回时，查询如下所示

```
PROJECTID: 1
NAME: New Web Site
ALLTASK: 10
OPENTASK: 7
CLOSEDTASK: 3 
```

我没有任何可以表示此信息的域类，并且我不想在 Project 类中创建特定方法（如 getAllTask​​s、getOpenTasks），因为这些方法中的每一个都会触发一个新查询。所以问题是：我创建一个新类（类似于 ProjectTasksQuery）只是为了保存这些信息？我在数组或地图中返回信息？还有什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T12:22:57.143

我通常编写一个使用 SQL 执行查询的函数，然后将结果放入列表或字典中（在 Java 中，我会使用 ArrayList 或 HashMap）。

如果我发现自己经常这样做，我可能会创建一个新文件来保存所有这些查询。否则，我只会让它们在需要/使用的任何文件中发挥作用。

由于我们专门讨论 Java，我当然不会在单独的文件中创建新类。但是，对于仅在一个类中需要的查询，您可以创建一个私有静态内部类，其中仅包含生成该类所需的查询所需的函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T14:40:08.187

[阅读有关数据传输对象](http://en.wikipedia.org/wiki/Data_Transfer_Object)的内容后，您可能会感觉好些。有些人[根本不喜欢它们](http://anirudhvyas.com/root/2008/04/19/abuses-of-dto-pattern-in-java-world/)，但如果你觉得它很适合你，那可能就是。

# c# - (N)Hibernate - 是否可以将多个表动态映射到一个类

> ID：51654
> 
> 赞同：2
> 
> 时间：2008-09-09T11:34:07.510
> 
> 标签：c#, nhibernate, hibernate, orm, gis

我有这样的情况，我使用 GIS 软件，它将有关 GIS 对象的信息存储到每个类型/类别的 GIS 对象（道路、河流、建筑物、海洋……）的单独数据库表中，并保留它存储的元数据表有关类名及其 DB 表的信息。

这些不同类的GIS 对象共享一些参数，即Description 和ID。我想用一个通用的 C# 类（我们称之为 GisObject）来表示所有这些不同的 GIS 类，这足以满足我需要从应用程序的非 GIS 部分执行的操作，该应用程序列出了给定 GIS 的 GIS 对象班级。

对我来说，问题是如何使用 NHibernate 映射这些对象，以便在创建 C# GisObject 以接收和**使用表名作为**将从元表中读取的参数时向 NHibernate 解释（它可以分两个步骤，我可以在第一步中手动获取表名，然后在拉取 GisObject 数据时将其传递给 NHibernate）。

有没有人处理过这种情况，可以做到吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T13:08:51.790

听起来在这里做的最简单的事情可能是创建一个包含所有常见 GIS 成员的抽象基类，然后继承其他 X 类，这些类只具有必要的 NHibernate 映射。然后，我将使用工厂模式使用您的元数据创建特定类型的对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T13:50:33.017

@Brian Chiasson

不幸的是，创建所有 GIS 数据类不是一个选项，因为类是在应用程序中动态创建的。每个相同类型的 GIS 数据都应该是一个类，但我的用户有可能获取新的数据集并将其放入数据库中。我不知道我的用户将在应用程序中拥有哪些类。因此，前面的每类映射模型不起作用，因为明天将有另一个新的数据库表，并且需要使用新映射创建新类。

@all 有可能在我的 GisObject 类的 XML 配置文件中编写我自己的自定义查询，然后在数据访问类中使用

```
string qs = getSession().getNamedQuery(queryName); 
```

并使用字符串替换注入数据库名称（通过替换一些占位符字符串），我将作为参数传递。

```
qs = qs.replace(":tablename:", tableName); 
```

您如何看待该解决方案？我知道这可能是一个不受控制的环境中的安全风险，其中表名将作为用户输入获取，但在这种情况下，我有一个元表，其中包含我之前将阅读的 GIS 数据类的正确和有效表名调用查询以获取特定类 GIS 对象的数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T11:51:39.340

一种方法是声明一个接口，比如 IGisObject，它具有在接口上声明的公共属性。然后实现一个映射到每个表的具体类。这样，它们仍然是 IGisObject 类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T11:59:11.647

您可以看看 Ayende 在这里所说的内容：[MultiTable Entities](http://www.ayende.com/Blog/archive/2007/04/24/Multi-Table-Entities-in-NHibernate.aspx)。

但是由于您有单独的表格，我认为它不会起作用。您还可以查看[nhuuser 组](http://groups.google.com/group/nhusers)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-10T05:34:32.763

我想我会问这个问题，为什么您要直接在数据库中查找 GIS 数据，而不是使用通常为您提供抽象的 API。如果这是一个 ESRI 系统，则有一些工具允许您在其 GIS 对象中创建静态数据库视图，然后可能从那时起它可能适合数据提取。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-19T01:15:24.980

从 NHibernate 文档中，您可以使用[继承映射](http://www.hibernate.org/hib_docs/nhibernate/html/inheritance.html)之一。

You might also have a separate class for each table, but have them all implement some common interface

# python - 使用python的卷上剩余的跨平台空间

> ID：51658
> 
> 赞同：76
> 
> 时间：2008-09-09T11:36:39.093
> 
> 标签：python, windows, linux, macos, diskspace

我需要一种在 Linux、Windows 和 OS X 上使用 python 来确定磁盘卷上剩余空间的方法。我目前正在解析各种系统调用（df、dir）的输出来实现这一点——有更好的方法吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2010-03-03T14:45:23.103

```
import ctypes
import os
import platform
import sys

def get_free_space_mb(dirname):
    """Return folder/drive free space (in megabytes)."""
    if platform.system() == 'Windows':
        free_bytes = ctypes.c_ulonglong(0)
        ctypes.windll.kernel32.GetDiskFreeSpaceExW(ctypes.c_wchar_p(dirname), None, None, ctypes.pointer(free_bytes))
        return free_bytes.value / 1024 / 1024
    else:
        st = os.statvfs(dirname)
        return st.f_bavail * st.f_frsize / 1024 / 1024 
```

请注意，您*必须*传递目录名称`GetDiskFreeSpaceEx()`才能工作（`statvfs()`适用于文件和目录）。您可以从带有`os.path.dirname()`.

另请参阅 和 的[`os.statvfs()`](https://docs.python.org/3/library/os.html#os.fstatvfs)文档[`GetDiskFreeSpaceEx`](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364937(v=vs.85).aspx)。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2015-04-29T12:43:17.000

使用. [_](https://pypi.org/project/psutil/) _ `pip install psutil`然后，您可以使用以下方法获取可用空间量（以字节为单位）：

```
import psutil
print(psutil.disk_usage(".").free) 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2013-10-12T09:20:42.553

您可以将[wmi](https://pypi.python.org/pypi/WMI/)模块用于 windows，将 os.statvfs 用于 unix

用于窗户

```
import wmi

c = wmi.WMI ()
for d in c.Win32_LogicalDisk():
    print( d.Caption, d.FreeSpace, d.Size, d.DriveType) 
```

对于 unix 或 linux

```
from os import statvfs

statvfs(path) 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2018-02-01T04:52:30.650

# 如果您正在运行 python3：

使用名称正则`shutil.disk_usage()`化`os.path.realpath('/')`作品：

```
from os import path
from shutil import disk_usage

print([i / 1000000 for i in disk_usage(path.realpath('/'))]) 
```

或者

```
total_bytes, used_bytes, free_bytes = disk_usage(path.realpath('D:\\Users\\phannypack'))

print(total_bytes / 1000000) # for Mb
print(used_bytes / 1000000)
print(free_bytes / 1000000) 
```

为您提供以 MB 为单位的总空间、已用空间和可用空间。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-11-13T09:22:14.867

如果您不喜欢添加另一个依赖项，您可以为 windows 使用 ctypes 直接调用 win32 函数调用。

```
import ctypes

free_bytes = ctypes.c_ulonglong(0)

ctypes.windll.kernel32.GetDiskFreeSpaceExW(ctypes.c_wchar_p(u'c:\\'), None, None, ctypes.pointer(free_bytes))

if free_bytes.value == 0:
   print 'dont panic' 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-08-11T07:11:52.253

从 Python 3.3 开始，您可以使用来自 Windows 和 UNIX 标准库的[shutil.disk_usage("/").free](https://docs.python.org/3/library/shutil.html#shutil.disk_usage) :)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-07-21T09:02:48.297

一个很好的跨平台方式是使用 psutil：[http](http://pythonhosted.org/psutil/#disks) ://pythonhosted.org/psutil/#disks （请注意，您需要 psutil 0.3.0 或更高版本）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-09T23:48:07.137

您可以使用[df](http://man.he.net/?section=all&topic=df)作为跨平台的方式。它是[GNU 核心实用程序](http://www.gnu.org/software/coreutils/)的一部分。这些是预期存在于每个操作系统上的核心实用程序。但是，默认情况下它们没有安装在 Windows 上（这里，[GetGnuWin32](http://getgnuwin32.sourceforge.net/)派上用场了）。

*df*是一个命令行实用程序，因此是脚本编写所需的包装器。例如：

```
from subprocess import PIPE, Popen

def free_volume(filename):
    """Find amount of disk space available to the current user (in bytes) 
       on the file system containing filename."""
    stats = Popen(["df", "-Pk", filename], stdout=PIPE).communicate()[0]
    return int(stats.splitlines()[1].split()[3]) * 1024 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-09T11:40:26.697

os.statvfs [()](https://docs.python.org/2.7/library/os.html)函数是为类 Unix 平台（包括 OS X）获取该信息的更好方法。Python 文档说“可用性：Unix”，但值得检查它是否在您的 Python 版本中也适用于 Windows（即文档可能不是最新的）。

否则，您可以使用[pywin32](http://sourceforge.net/projects/pywin32/)库直接调用[GetDiskFreeSpaceEx](http://msdn.microsoft.com/en-us/library/aa364937(VS.85).aspx)函数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-03-08T06:53:17.783

下面的代码在 Windows 上返回正确的值

```
import win32file    

def get_free_space(dirname):
    secsPerClus, bytesPerSec, nFreeClus, totClus = win32file.GetDiskFreeSpace(dirname)
    return secsPerClus * bytesPerSec * nFreeClus 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-09T11:47:20.380

我不知道任何跨平台的方法来实现这一点，但也许对您来说一个好的解决方法是编写一个检查操作系统并为每个系统使用最佳方法的包装类。

对于 Windows，win32 扩展中有[GetDiskFreeSpaceEx](http://aspn.activestate.com/ASPN/docs/ActivePython/2.2/PyWin32/win32api__GetDiskFreeSpaceEx_meth.html)方法。

# model-driven - 元建模工具

> ID：51660
> 
> 赞同：5
> 
> 时间：2008-09-09T11:38:54.893
> 
> 标签：model-driven

哪些工具可用于元建模？

尤其是开发图表编辑器，目前正在尝试[Eclipse GMF](http://www.eclipse.org/modeling/gmf/)

想知道还有哪些其他选择？有什么可以比较的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-03T13:11:40.110

由于许多方面，您的问题对于一个单一的答案来说太宽泛了。

首先，元建模不是一个固定的术语，而是一个非常模糊的东西，包括模型的建模模型和像MDA这样的术语。

其次，开发图表编辑器有很多选择——采用 Eclipse 方式肯定是一个不错的选择。

为了让您至少开始在 Eclipse 部门：

*   看看 MOF，这是来自 OMG（维护 UML 的家伙）的“元建模”架构
*   从那里接近 EMOF，它是由 Ecore 的化身中的 Eclipse 建模框架支持的子集。
*   在 GMF 之上构建一些东西可能确实是一个好主意，因为这是 Eclipse 平台的现有图表编辑器所采用的方式（例如 Omondo 的 EclipseUML）
*   Eclipse 环境中存在许多可以利用 Ecore 的工具——我只是希望 GMF 建立在 Ecore 本身之上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:59:52.857

[Dia](http://www.gnome.org/projects/dia/)有一个用于此的 API——我能够通过更改箭头样式轻松地将他们的 UML 编辑器转换为基本的 ER 建模工具。使用我在 sourceforge 中找到的数据库逆向工程工具（获取模式并吐出 dia 文件），您可以使用它来记录数据库。虽然我所做的相当简单，但 API 非常简单，我很快就知道如何进行更改。

如果你想试试 Smalltalk 曾经有一个名为[DOME](http://www.cs.cmu.edu/afs/cs.cmu.edu/project/nectar-adamb/web/DomeRelease.html)的 Smalltalk 元案例框架可以做这种事情。如果您下载[VisualWorks](http://www.cincomsmalltalk.com)，DOME 是贡献的包之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-07T16:40:41.790

GMF 就是一个很好的例子。它的核心是[EMF/Ecore](http://www.eclipse.org/emf/)，就像 computerkram sais 一样。Ecore 也用于 Eclipse 的[UML2](http://www.eclipse.org/uml2)的基础。GMF 的著名用例和概念证明当然是[UML2 工具](http://www.eclipse.org/modeling/mdt/?project=uml2tools)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T11:41:21.220

虽然通常是 UML 工具，但我会看[StarUML](http://staruml.sourceforge.net/en/)。它支持[超出已内置模块的附加模块](http://staruml.sourceforge.net/en/modules.php)。如果它没有您需要的内置或模块，我想您可以自己制作，但我不知道这有多难。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T16:43:50.380

元建模主要在 Smalltalk 中完成。

您可能想看看 MOOSE ( [http://moose.unibe.ch](http://moose.unibe.ch) )。有许多用于程序理解的工具正在开发中。大多数都是基于 Smalltalk 的。还有一些 java 和 c++ 的工作。

最令人印象深刻的两个工具是 CodeCity 和 Mondrian。CodeCity 可以随着时间的推移可视化代码开发，Mondrian 提供可脚本化的可视化技术。

当然还有经典的 HotDraw，它也可以在 java 中使用。

对于 Web 开发，还有 Magritte，为 Seaside 提供元描述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-22T16:41:20.900

我强烈建议您将 DSM（领域特定建模）作为一个通用主题，元建模直接相关。有一些基于 Eclipse 的工具，例如 GMF，目前需要 Java 编码，但可以很好地与其他 Eclipse 工具和 UML 集成。但是，还有另外两个课程。

1.  MetaCase 我将其称为纯 DSM 工具，因为它专注于允许开发人员/建模人员几乎无需编码即可创建可用的图形模型。此外，它可以轻松部署以供其他人使用。GMF 和微软的 Beta 软件工厂/DSM 工具属于这一类。

2.  纯元建模工具，不适用于 DSM 工具、代码生成等。我不关注这些工具，因为我对为中小企业、领域专家和其他人生成工具的应用程序感兴趣，以使用并为活动项目贡献价值，而不是为了模型而建模，或者只是文档和理论。

如果您想了解更多关于数字 1 的信息，即 DSM/元建模的工具应用程序，请查看我的帖子[“DSMForum.org 很棒的资源，值得一看”。](http://modelarchitecture.blogspot.com/2009/05/dsmforumorg-great-resources-worth-look.html)或者直接导航到 DSMForum.org

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-02T21:58:04.110

如果您对与建模而非代码生成相关的内容感兴趣，请查看[adoxx.org](http://www.adoxx.org)。作为一个元建模平台，它确实提供了快速开发您自己的 DSL 的功能和机制，并允许您专注于模型需求（业务需求、概念级设计/规范）。有一个来自学术界和实践的活跃社区，参与开发基于该平台的原型和商业应用程序。可能很有趣...

# migration - 将数据库从一个 Informix IDS 11 服务器复制到另一个的最简单方法是什么

> ID：51673
> 
> 赞同：3
> 
> 时间：2008-09-09T11:46:10.677
> 
> 标签：migration, rdbms, informix, administration

源数据库相当大。目标数据库不会自动增长。它们在不同的机器上。

我来自 MS SQL Server，MySQL 背景和 IDS11 似乎过于复杂（我敢肯定，有充分的理由）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T00:28:28.600

将数据从一台服务器移动到另一台服务器的一种方法是使用 dbexport 命令备份数据库。

然后在将备份文件复制到目标服务器后运行 dbimport 命令。

要创建新数据库，您需要使用 onmonitor 工具为新数据库创建 DBSpace，此时您可以使用来自其他服务器的现有文件。

然后，您需要使用 dbaccess 工具在目标服务器上创建数据库。dbaccess 工具有一个允许您创建数据库的数据库选项。创建数据库时，您指定要使用的 DBSpace。

源数据库可能由许多块组成，您还需要将它们复制并附加到新数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-03T03:35:50.730

你有几个选择。

dbexport/dbimport
onunload/onload
HPL（高性能加载程序）选项。

我个人使用过 onunload/onload 和 dbexport/dbimport。我没有使用HPL。我正在使用 IDS 10。

**onunload/onload** [IBM 文档](http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.mig.doc/mig138.htm)

*   以页面大小的块将原始数据库备份到磁盘或磁带*   更快（特别是如果你去磁盘）*   如果数据库服务器位于不同的操作系统或硬件上，或者它们只是具有不同的页面大小，则会出现问题。

    **dbexport/dbimport** [IBM 文档](http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.mig.doc/mig138.htm)
    *   在分隔的 ascii 文件中备份数据库*   将数据库的 ascii 模式写入一个巨大的纯文本文件中，包括所有用户、表、视图、索引等。有关数据库结构的所有内容。*   也为数据库的每个表单独的纯文本文件*   没那么快*   任何包含错误数据的表、任何语法不正确的视图等的 dbimport 问题（这可能是一件好事，一个识别和清理的机会）*   ***当你跑进冰淇淋店买冰淇淋时，不要把这条胶带留在汽车的前座上（否则你会上新闻的）。*** 另请阅读...不是一种非常安全的移动数据的方式。:)*   ***限制：***需要对源数据库的独占访问权限。

    这是从文档开始的好地方 -->[数据库服务器之间的数据迁移](http://publib.boulder.ibm.com/infocenter/idshelp/v10/index.jsp?topic=/com.ibm.mig.doc/mig138.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T06:19:00.523

正如其他人所提到的，最简单的方法是 dbexport/dbimport。

最快的方法是使用高性能加载程序 onpload。如果你有很多数据，但表格数量不多，这绝对值得追求。IIUG 网站上有一些零碎的东西可能有助于编写 HPL 脚本以生成您需要的所有配置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T15:35:02.463

如果两台机器都使用相同版本的 IDS，那么另一种选择是使用 ontape 在一台机器上备份并在另一台机器上恢复。您可以使用 STDIO 选项，然后将备份流式传输到可以从 STDIO 恢复的另一台机器上。

来自“用于高可用性和分布的数据复制”红皮书：

```
ontape -s -L 0 -F | rsh secondary_server "ontape –p" 
```

您还可以通过主机创建无密码 ssh 连接并以更安全的方式进行传输。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T12:45:58.677

你用过导出工具吗？如果您首先将数据库置于静止模式，然后您可以实际复制 DBSpaces（我认为是 dbspaces 工具......现在已经有几年了），曾经有一种方法。

因为使用informix，您曾经能够指定用于表的DBSpaces（甚至可能在alter table 中？）。

检查 - dbaccess 工具 - 有一个导出命令。
将数据库置于静止模式或关闭，复制 dbspaces，然后附加表，告诉它指向新的 dbspaces 文件。（dbspaces 工具可能值得一看。我这里有手册。它们是 9.2，但它不应该改变太多）。

# algorithm - 图形（图表）算法

> ID：51680
> 
> 赞同：5
> 
> 时间：2008-09-09T11:48:24.057
> 
> 标签：algorithm, charts, graph

有没有人有一个体面的算法来计算轴最小值和最大值？

在为给定的一组数据项创建图表时，我希望能够给出算法：

*   集合中的最大值 (y)
*   集合中的最小值 (y)
*   出现在轴上的刻度线数量
*   **必须**显示为刻度的可选值（例如，显示 +ve 和 -ve 值时为零）

算法应该返回

*   最大轴值
*   最小的轴值（尽管可以从最大值、间隔大小和刻度数推断出）
*   区间大小

刻度线应该有规律的间隔应该是“合理的”大小（例如 1、3、5，甚至可能是 2.5，但不再是 sig figs）。

可选值的存在会扭曲这一点，但如果没有该值，最大的项目应该出现在顶部两个刻度线之间，底部两个刻度线之间的最小值。

这是一个与语言无关的问题，但如果周围有 C#/.NET 库，那就太棒了；）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T11:31:08.367

好的，这是我为我们的一个应用程序提出的。请注意，它不处理您提到的“可选值”场景，因为我们的可选值始终为 0，但您应该不难修改。

数据会不断地添加到系列中，因此我们只需通过检查每个添加的数据点来保持 y 值的范围是最新的；这是非常便宜且易于跟踪的。相同的最小值和最大值是特殊情况：间距为 0 表示不应绘制任何标记。

这个解决方案与上面 Andrew 的建议没有什么不同，只是它以一种稍微笨拙的方式处理了指数乘数的一些任意分数。

最后，此示例使用 C# 编写。希望能帮助到你。

```
 private float GetYMarkerSpacing()
    {
        YValueRange range   = m_ScrollableCanvas.
                    TimelineCanvas.DataModel.CurrentYRange;
        if ( range.RealMinimum == range.RealMaximum )
        {
            return 0;
        }

        float   absolute    = Math.Max(
                    Math.Abs( range.RealMinimum ),
                    Math.Abs( range.RealMaximum ) ),
            spacing     = 0;
        for ( int power = 0; power < 39; ++power )
        {
            float   temp    = ( float ) Math.Pow( 10, power );
            if ( temp <= absolute )
            {
                spacing = temp;
            }
            else if ( temp / 2 <= absolute )
            {
                spacing = temp / 2;
                break;
            }
            else if ( temp / 2.5 <= absolute )
            {
                spacing = temp / 2.5F;
                break;
            }
            else if ( temp / 4 <= absolute )
            {
                spacing = temp / 4;
                break;
            }
            else if ( temp / 5 <= absolute )
            {
                spacing = temp / 5;
                break;
            }
            else
            {
                break;
            }
        }

        return spacing;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T13:22:44.347

我一直在使用 jQuery [flot](http://code.google.com/p/flot/)图形库。它是开源的，并且可以很好地生成轴/刻度线。我建议查看它的代码并从中汲取一些想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T10:55:32.243

我可以推荐以下内容：

*   设置视觉上吸引人的最小主要行数。这将取决于您提供的数据的性质和您正在做的绘图的大小，但 7 是一个相当不错的数字
*   根据 1、2、5、10 等的级数选择指数和乘数，这将至少为您提供最少的主要行数。（即（最大-最小）/（比例 x 10 ^ 指数）>= minimum_tick_marks）
*   找到适合您范围内的指数和乘数的最小整数倍。这将是第一个主要刻度。其余的刻度都是由此派生的。

这用于允许任意缩放数据并且似乎运行良好的应用程序。

# windows - Name of the process with highest cpu usage

> ID：51684
> 
> 赞同：6
> 
> 时间：2008-09-09T11:52:04.893
> 
> 标签：windows, performance, operating-system

I have a [Samurize](http://www.samurize.com/modules/news/) config that shows a CPU usage graph similar to Task manager.

How do I also display the name of the process with the current highest CPU usage percentage?

I would like this to be updated, at most, once per second. Samurize can call a command line tool and display it's output on screen, so this could also be an option.

* * *

Further clarification:

I have investigated writing my own command line c# .NET application to enumerate the array returned from System.Diagnostics.Process.GetProcesses(), but the Process instance class does not seem to include a CPU percentage property.

Can I calculate this in some way?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T13:05:09.770

What you want to get its the instant CPU usage (kind of)...

Actually, the instant CPU usage for a process does not exists. Instead you have to make two measurements and calculate the average CPU usage, the formula is quite simple:

> AvgCpuUsed = [TotalCPUTime(process,time2) - TotalCPUTime(process,time1)] / [time2-time1]

The lower Time2 and Time1 difference is, the more "instant" your measurement will be. Windows Task Manager calculate the CPU use with an interval of one second. I've found that is more than enough and you might even consider doing it in 5 seconds intervals cause the act of measuring itself takes up CPU cycles...

So, first, to get the average CPU time

```
 using System.Diagnostics;

float GetAverageCPULoad(int procID, DateTme from, DateTime, to)
{
  // For the current process
  //Process proc = Process.GetCurrentProcess();
  // Or for any other process given its id
  Process proc = Process.GetProcessById(procID);
  System.TimeSpan lifeInterval = (to - from);
  // Get the CPU use
  float CPULoad = (proc.TotalProcessorTime.TotalMilliseconds / lifeInterval.TotalMilliseconds) * 100;
  // You need to take the number of present cores into account
  return CPULoad / System.Environment.ProcessorCount;
} 
```

now, for the "instant" CPU load you'll need an specialized class:

```
 class ProcLoad
{
  // Last time you checked for a process
  public Dictionary<int, DateTime> lastCheckedDict = new Dictionary<int, DateTime>();

  public float GetCPULoad(int procID)
  {
    if (lastCheckedDict.ContainsKey(procID))
    {
      DateTime last = lastCheckedDict[procID];
      lastCheckedDict[procID] = DateTime.Now;
      return GetAverageCPULoad(procID, last, lastCheckedDict[procID]);
    }
    else
    {
      lastCheckedDict.Add(procID, DateTime.Now);
      return 0;
    }
  }
} 
```

You should call that class from a timer (or whatever interval method you like) for **each process you want to monitor**, if you want all the processes just use the [Process.GetProcesses](http://msdn.microsoft.com/en-us/library/1f3ys1f9.aspx) static method

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-07-11T11:20:49.027

Building on Frederic's answer and utilizing the code at the bottom of the page [here](http://blogs.msdn.com/b/powershell/archive/2012/07/13/join-object.aspx) (for an example of usage see [this](http://blogs.msdn.com/b/powershell/archive/2012/10/04/joining-multiple-tables-grouping-and-evaluating-totals.aspx) post) to join the full set of processes gotten from `Get-Process`, we get the following:

```
$sampleInterval = 3

$process1 = Get-Process |select Name,Id, @{Name="Sample1CPU"; Expression = {$_.CPU}}

Start-Sleep -Seconds $sampleInterval

$process2 = Get-Process | select Id, @{Name="Sample2CPU"; Expression = {$_.CPU}}

$samples = Join-Object -Left $process1 -Right $process2 -LeftProperties Name,Sample1CPU -RightProperties Sample2CPU -Where {$args[0].Id -eq $args[1].Id}

$samples | select Name,@{Name="CPU Usage";Expression = {($_.Sample2CPU-$_.Sample1CPU)/$sampleInterval * 100}} | sort -Property "CPU Usage" -Descending | select -First 10 | ft -AutoSize 
```

Which gives an example output of

```
Name                  CPU Usage
----                  ---------
firefox        20.8333333333333
powershell_ise 5.72916666666667
Battle.net               1.5625
Skype                    1.5625
chrome                   1.5625
chrome         1.04166666666667
chrome         1.04166666666667
chrome         1.04166666666667
chrome         1.04166666666667
LCore          1.04166666666667 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T12:13:35.807

You might be able to use [Pmon.exe](http://commandwindows.com/server2003tools.htm) for this. You can get it as part of the [Windows Resource Kit tools](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd) (the link is to the Server 2003 version, which can apparently be used in XP as well).

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T12:31:07.887

```
Process.TotalProcessorTime 
```

[http://msdn.microsoft.com/en-us/library/system.diagnostics.process.totalprocessortime.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.totalprocessortime.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-20T06:07:06.063

Somehow

`Get-Process | Sort-Object CPU -desc | Select-Object -first 3 | Format-Table CPU,ProcessName,TotalProcessorTime -hidetableheader`

wasn't getting the CPU information from the remote machine. I had to come up with this.

`Get-Counter '\Process(*)\% Processor Time' | Select-Object -ExpandProperty countersamples | Select-Object -Property instancename, cookedvalue| Sort-Object -Property cookedvalue -Descending| Select-Object -First 10| ft -AutoSize`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-26T23:24:04.767

Thanks for the formula, Jorge. I don't quite understand why you have to divide by the number of cores, but the numbers I get match the Task Manager. Here's my powershell code:

```
$procID = 4321

$time1 = Get-Date
$cpuTime1 = Get-Process -Id $procID | Select -Property CPU

Start-Sleep -s 2

$time2 = Get-Date
$cpuTime2 = Get-Process -Id $procID | Select -Property CPU

$avgCPUUtil = ($cpuTime2.CPU - $cpuTime1.CPU)/($time2-$time1).TotalSeconds *100 / [System.Environment]::ProcessorCount 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-16T20:03:50.557

You can also do it this way :-

```
public Process getProcessWithMaxCPUUsage()
    {
        const int delay = 500;
        Process[] processes = Process.GetProcesses();

        var counters = new List<PerformanceCounter>();

        foreach (Process process in processes)
        {
            var counter = new PerformanceCounter("Process", "% Processor Time", process.ProcessName);
            counter.NextValue();
            counters.Add(counter);
        }
        System.Threading.Thread.Sleep(delay);
        //You must wait(ms) to ensure that the current
        //application process does not have MAX CPU
        int mxproc = -1;
        double mxcpu = double.MinValue, tmpcpu;
        for (int ik = 0; ik < counters.Count; ik++)
        {
            tmpcpu = Math.Round(counters[ik].NextValue(), 1);
            if (tmpcpu > mxcpu)
            {
                mxcpu = tmpcpu;
                mxproc = ik;
            }

        }
        return processes[mxproc];
    } 
```

Usage:-

```
static void Main()
    {
        Process mxp=getProcessWithMaxCPUUsage();
        Console.WriteLine(mxp.ProcessName);
    } 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-09-09T12:56:59.290

With PowerShell:

```
Get-Process | Sort-Object CPU -desc | Select-Object -first 3 | Format-Table CPU,ProcessName -hidetableheader 
```

returns somewhat like:

```
 16.8641632 System
   12.548072 csrss
  11.9892168 powershell 
```

# delphi - 是否可以使用 ClickOnce 部署本机 Delphi 应用程序

> ID：51686
> 
> 赞同：9
> 
> 时间：2008-09-09T11:53:07.353
> 
> 标签：delphi, deployment, clickonce

是否可以在没有用于启动 Delphi 应用程序的存根 C# exe 的情况下使用 ClickOnce 部署本机 Delphi 应用程序？

同样的问题适用于 VB6、C++ 和其他本地 Windows 应用程序。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-07-19T01:35:06.913

就个人而言，当我的应用程序时间戳与服务器不同步时，我建立了自己的机制来启动自我更新过程。不是太难，但这不是一项简单的任务。

顺便说一句，对于 Delphi，您可以使用一些第三方帮助：

[http://www.tmssoftware.com/site/wupdate.asp](http://www.tmssoftware.com/site/wupdate.asp)

更新：

对于我的实现：

MyApp.EXE 将以 3 种不同的模式运行

1.  MyApp.EXE 没有任何参数。这通常会启动应用程序。

    1.1 它做的第一件事就是用服务器验证它自己的文件时间。

    1.2 如果需要更新，它会将更新的文件下载到名为“MyApp-YYYY-MM-DD-HH-MM-SS.exe”的文件中

    1.3 然后用命令参数调用“MyApp-YYYY-MM-DD-HH-MM-SS.exe”

    ```
    MyApp-YYYY-MM-DD-HH-MM-SS.exe  --update MyApp.EXE 
    ```

    1.4 终止此应用程序。

    1.5 如果不需要更新，则应用程序将从 1.1 正常启动

2.  MyApp.EXE——更新“文件名”。

    2.1 尝试每 100 毫秒将自身复制到“文件名”，直到成功。

    2.2 成功时调用“FILENAME”

    2.3 调用“FILNAME --delete MyApp-YYYY-MM-DD-HH-MM-SS.exe”删除自身。

    2.4 终止

3.  MyApp.EXE --删除“文件名”

    3.1 尝试每 500 毫秒删除一次文件“FILENAME”，直到成功。

    3.2 终止

我已经在我的应用程序中使用了这个方案 7 年并且效果很好。当出现问题时调试可能会非常痛苦，因为这些步骤涉及许多过程。我建议您进行大量跟踪记录，以便更简单地进行故障排除。

祝你好运

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T16:07:26.953

不，您的应用程序的入口点需要是托管代码。

这是来自 Brian Noyes 的[博客文章](http://www.softinsight.com/bnoyes/CommentView,guid,5df8d49a-2a4e-45a6-af95-a0300c5ea5cd.aspx#commentstart)，他是 ClickOnce 的主要作者之一，也是[Smart Client Deployment with ClickOnce](https://rads.stackoverflow.com/amzn/click/com/0321197690)的作者。

> 如果您的应用程序确实是旧的（即 VB6、MFC、ATL 等），例如在非托管代码可执行文件中，那么不，您不能通过 ClickOnce 将其部署为可执行文件。

公认的解决方法似乎是启动主 exe 的托管代码存根 exe。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T11:58:41.583

我不能 100% 确定这是否可以在没有存根的情况下完成，但这篇文章可能会提供一些见解：

[操作方法：在托管程序集中使用 COM 组件为非托管应用程序部署 ClickOnce](http://blogs.msdn.com/g/archive/2008/06/06/sample-demonstrating-clickonce-deployment-of-com-component-implemented-in-managed-assembly-without-using-gac-or-registry-and-without-requiring-admin-rights.aspx)

# c++ - MFC 应用程序中的灯箱样式对话框

> ID：51687
> 
> 赞同：4
> 
> 时间：2008-09-09T11:53:23.360
> 
> 标签：c++, user-interface, mfc

有没有人在 MFC/非 .net 应用程序的模式对话框上实现灯箱样式背景调光。
我认为程序必须是这样的：

脚步：

1.  获取对话框父级 HWND 或 CWnd*

2.  获取父窗口的矩形并在该窗口上绘制一个半透明的覆盖

3.  允许对话框执行它的模态绘制例程，例如 DoModal()

是否有任何现有的库/框架可以做到这一点，或者在 MFC 中放置半透明覆盖的最佳方法是什么？
**编辑**如果您不知道“灯箱样式”的含义，这是我要实现的目标的模型
**Some App**：
![替代文字](https://farm4.static.flickr.com/3065/2843243996_8a4536f516_o.png)

带有灯箱对话框
![替代文字](https://farm4.static.flickr.com/3280/2842409249_4a1c7f5810_o.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-10T15:13:03.387

这是我根据 Brian 的链接所做的*
首先创建一个具有以下属性的对话框资源：

*   边界**错误**
*   3D 外观**FALSE**
*   客户端**FALSE**
*   弹出样式
*   静态边缘**FALSE**
*   透明**TRUE**
*   标题栏**FALSE**

你应该最终得到一个没有框架或任何东西的对话框窗口，只有一个灰色的框。覆盖 Create 函数，如下所示：

```
BOOL LightBoxDlg::Create(UINT nIDTemplate, CWnd* pParentWnd)
{

    if(!CDialog::Create(nIDTemplate, pParentWnd))
        return false;
    RECT rect;
    RECT size;

    GetParent()->GetWindowRect(&rect);
    size.top = 0;
    size.left = 0;
    size.right = rect.right - rect.left;
    size.bottom = rect.bottom - rect.top;
    SetWindowPos(m_pParentWnd,rect.left,rect.top,size.right,size.bottom,NULL);

    HWND hWnd=m_hWnd;  
    SetWindowLong (hWnd , GWL_EXSTYLE ,GetWindowLong (hWnd , GWL_EXSTYLE ) | WS_EX_LAYERED ) ;
    typedef DWORD (WINAPI *PSLWA)(HWND, DWORD, BYTE, DWORD);
    PSLWA pSetLayeredWindowAttributes;
    HMODULE hDLL = LoadLibrary (_T("user32"));
    pSetLayeredWindowAttributes = 
        (PSLWA) GetProcAddress(hDLL,"SetLayeredWindowAttributes");
    if (pSetLayeredWindowAttributes != NULL) 
    {
        /*
        * Second parameter RGB(255,255,255) sets the colorkey 
        * to white LWA_COLORKEY flag indicates that color key 
        * is valid LWA_ALPHA indicates that ALphablend parameter 
        * is valid - here 100 is used
        */
        pSetLayeredWindowAttributes (hWnd, 
            RGB(255,255,255), 100, LWA_COLORKEY|LWA_ALPHA);
    }

    return true;
} 
```

然后在图像编辑器（比如 48x48）中创建一个小的黑色位图，并将其作为位图资源（在本例中为 IDB_BITMAP1）
覆盖 WM_ERASEBKGND 消息：

```
BOOL LightBoxDlg::OnEraseBkgnd(CDC* pDC)
{

    BOOL bRet = CDialog::OnEraseBkgnd(pDC);

    RECT rect;
    RECT size;
    m_pParentWnd->GetWindowRect(&rect);
    size.top = 0;
    size.left = 0;
    size.right = rect.right - rect.left;
    size.bottom = rect.bottom - rect.top;

    CBitmap cbmp;
    cbmp.LoadBitmapW(IDB_BITMAP1);
    BITMAP bmp;
    cbmp.GetBitmap(&bmp);
    CDC memDc;
    memDc.CreateCompatibleDC(pDC);
    memDc.SelectObject(&cbmp);
    pDC->StretchBlt(0,0,size.right,size.bottom,&memDc,0,0,bmp.bmWidth,bmp.bmHeight,SRCCOPY);

    return bRet;
} 
```

在所需对话框的 DoModal 中实例化它，像模态对话框一样创建它，即在堆栈上（或堆，如果需要），手动调用它的创建，显示它然后在它的顶部创建你的实际模态对话框：

```
INT_PTR CAboutDlg::DoModal()
{
    LightBoxDlg Dlg(m_pParentWnd);//make sure to pass in the parent of the new dialog
    Dlg.Create(LightBoxDlg::IDD);
    Dlg.ShowWindow(SW_SHOW);

    BOOL ret = CDialog::DoModal();

    Dlg.ShowWindow(SW_HIDE);
    return ret;
} 
```

这会产生与我上面的模型 **完全相同的结果**

*还有一些需要改进的地方，比如在没有创建对话框的情况下进行操作以及其他一些一般性的整理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T14:13:24.007

我认为您只需要创建一个窗口并设置透明度。CodeProject 上有一个 MFC [CGlassDialog 示例](http://www.codeproject.com/KB/dialog/CGlassDialog.aspx)可能会对您有所帮助。还有[一篇](http://www.codeproject.com/KB/winsdk/quaker1.aspx)关于如何使用 Win32 API 执行此操作的文章。

# winapi - Vista BEX 错误

> ID：51690
> 
> 赞同：6
> 
> 时间：2008-09-09T11:58:31.133
> 
> 标签：winapi, windows-vista

最近，我在加载 jar 时（大概）让 IE7 在 Vista 上崩溃，并出现以下错误：

```
Problem signature:
  Problem Event Name:        BEX
  Application Name:          iexplore.exe
  Application Version:       7.0.6001.18000
  Application Timestamp:     47918f11
  Fault Module Name:         ntdll.dll
  Fault Module Version:      6.0.6001.18000
  Fault Module Timestamp:    4791a7a6
  Exception Offset:          00087ba6
  Exception Code:            c000000d
  Exception Data:            00000000
  OS Version:                6.0.6001.2.1.0.768.3
  Locale ID:                 1037
  Additional Information 1:  fd00
  Additional Information 2:  ea6f5fe8924aaa756324d57f87834160
  Additional Information 3:  fd00
  Additional Information 4:  ea6f5fe8924aaa756324d57f87834160 
```

谷歌搜索发现这类问题在[Vista中](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.vc.mfc&tid=d511c635-3c99-431d-8118-526d3e3fff00&cat=&lang=&cr=&sloc=&p=1)[很](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1194672&SiteID=1) [常见](http://support.mozilla.com/tiki-view_forum_thread.php?locale=eu&comments_parentId=101420&forumId=1) [，](http://www.eggheadcafe.com/software/aspnet/29930817/bex-problem.aspx) 并且与[Java](http://www.gomanuals.com/java_not_working_on_windows_vista.shtml)有关（尽管 SUN[否定](http://weblogs.java.net/blog/chet/archive/2006/10/java_on_vista_y.html)了）。我也认为这与DEP有关。我没有找到官方的 Microsoft Kb。

所以，问题是：

*   BEX 代表什么？
*   它是关于什么的？
*   如何处理此类错误？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-03T10:51:45.090

BEX=缓冲区溢出异常。有关详细信息，请参阅[http://technet.microsoft.com/en-us/library/cc738483.aspx](http://technet.microsoft.com/en-us/library/cc738483.aspx)。但是，c000000d 是 STATUS_INVALID_PARAMETER；technet 文章主要讨论状态 c0000005 或 c0000409（访问冲突/DEP）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T22:55:47.343

Java 和 IE7 不喜欢很好地一起玩。只需关闭 DEP，它就会正常工作。

[http://www.tech-recipes.com/rx/1261/vista_disable_dep_noexecute_protection_fix_explorer_crashing/](http://www.tech-recipes.com/rx/1261/vista_disable_dep_noexecute_protection_fix_explorer_crashing/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T00:18:40.603

转到Internet Explorer选项/高级/安全/取消选中启用内存保护以减轻攻击的框，这对我有用

转到Internet Explorer选项/高级/安全/取消选中启用内存保护以减轻攻击的框，这对我有用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-28T22:45:53.463

很可能有一个插件与 IE 混淆。

你可以试试这个。1\. 打开 IE 2\. 切换到高级选项卡。3\. 单击重置 Internet Explorer 设置按钮。4\. 单击重置以确认操作。5\. 重置过程完成后单击关闭。6\. 在设置框中取消选中启用第三方浏览器扩展选项。7\. 单击应用，单击确定。

在此之后，检查它是否有效，如果有效，则一次启用一个插件，直到找到罪魁祸首。然后卸载它并在需要时重新安装它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-09T03:37:50.083

只需尝试禁用 bing 或 msn 工具栏 - 应该可以解决问题。

# c# - 使用 Properties.Settings.Default 的属性默认值

> ID：51700
> 
> 赞同：0
> 
> 时间：2008-09-09T12:10:27.623
> 
> 标签：c#, .net, settings

我正在使用 .Net 2 和正常的方式来存储我的设置。我将我的自定义对象序列化为 xml。我正在尝试检索属性的默认值（但不重置其他属性）。我用：

```
ValuationInput valuationInput = (ValuationInput) Settings.Default.Properties["ValuationInput"].DefaultValue; 
```

但它似乎返回一个字符串而不是 ValuationInput 并引发异常。

我做了一个快速破解，效果很好：

```
string valuationInputStr = (string) 
Settings.Default.Properties["ValuationInput"].DefaultValue;
XmlSerializer xmlSerializer = new XmlSerializer(typeof(ValuationInput));
ValuationInput valuationInput = (ValuationInput) xmlSerializer.Deserialize(new StringReader(valuationInputStr)); 
```

但这真的很难看——当我使用所有工具定义强类型设置时，我不想自己序列化默认值，我想像读取当前值一样读取它：`ValuationInput valuationInput = Settings.Default.ValuationInput;`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T12:29:14.303

在某些时候，某些地方将不得不使用 Xml 反序列化，无论是您还是设置类中的包装器。您总是可以通过一种方法将其抽象出来，以从您的业务逻辑中删除“丑陋”的代码。

```
public static T FromXml<T>(string xml)
{
    XmlSerializer xmlser = new XmlSerializer(typeof(T));
    using (System.IO.StringReader sr = new System.IO.StringReader(xml))
    {
        return (T)xmlser.Deserialize(sr);
    }
} 
```

[http://www.vonsharp.net/PutDownTheXmlNodeAndStepAwayFromTheStringBuilder.aspx](http://www.vonsharp.net/PutDownTheXmlNodeAndStepAwayFromTheStringBuilder.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T12:45:14.327

@Grzenio，

你为什么不直接使用你的对象类型？您可以在“项目属性”->“设置”选项卡上设置设置类型。您可以通过单击类型列下拉列表中的浏览来选择您的类型。

来自 MSDN 的引用：

> 应用程序设置可以存储为 XML 可序列化或具有实现 ToString/FromString 的 TypeConverter 的任何数据类型

这样您就可以拥有强类型设置，即 (ValuationInput) Settings.Default.Properties["ValuationInput"].DefaultValue; 将返回一个对象而不是字符串。

# macos - 邮件消息链接处理

> ID：51701
> 
> 赞同：1
> 
> 时间：2008-09-09T12:10:44.817
> 
> 标签：macos, applescript

我编写了一个 AppleScript，当它与 Windows 网络链接一起提供时，会将其转换为我们办公室服务器的正确 smb:// 等效项，安装网络驱动器，然后在 Finder 中打开请求的文件夹。

我在一个应用程序中内置了这个，它只需要一个粘贴的网络路径。理想情况下，我需要在单击 Mail.app 电子邮件消息中的链接时触发它，以便它可以检查链接的格式是否正确，如果是，则运行脚本并尝试安装驱动器并在 Finder 中加载文件夹。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T12:26:54.323

为了做到这一点，我认为您需要创建一个在 OS X 启动服务中注册为 smb:// 链接的默认角色处理程序的 Cocoa 应用程序。

我在另一个问题上写了一些关于如何做到这一点的东西：[如何将 Cocoa 应用程序设置为默认 Web 浏览器？](https://stackoverflow.com/questions/49510/how-do-you-set-your-cocoa-application-as-the-default-web-browser#49512)

如果有纯 AppleScript 解决方案或仅处理 Mail.app 中的链接的方法，我不知道。

# c# - 将 XML 文件读入 C# DataSet 的问题

> ID：51741
> 
> 赞同：6
> 
> 时间：2008-09-09T12:30:32.943
> 
> 标签：c#, .net, xml, .net-2.0

我得到了一个 .xml 文件，我需要将其作为 DataSet 读入我的代码（作为背景，该文件是通过在 C# 中创建一个`DataSet`并调用创建的`dataSet.WriteXml(file, XmlWriteMode.IgnoreSchema)`，但这是由其他人完成的）。

.xml 文件的形状如下：

```
 <?xml version="1.0" standalone="yes"?>
 <NewDataSet>
  <Foo>
    <Bar>abcd</Bar>
    <Foo>efg</Foo>
  </Foo>
  <Foo>
    <Bar>hijk</Bar>
    <Foo>lmn</Foo>
  </Foo>
</NewDataSet> 
```

使用 C# 和 .NET 2.0，我使用以下代码读取文件：

```
 DataSet ds = new DataSet();
        ds.ReadXml(file); 
```

使用断点，之后`line ds.Tables[0]`看起来像这样（使用破折号代替我无法正确格式化的下划线）：

```
Bar     Foo-Id    Foo-Id-0
abcd     0         null
null     1         0
hijk     2         null
null     3         2 
```

我找到了一种解决方法（我知道有很多）并且能够成功读取.xml，但是我想了解为什么`ds.ReadXml(file)`以这种方式执行，所以我将来可以避免这个问题。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-09T13:24:06.793

*这对于您的嵌套*Foo 标签似乎是正确的：

```
<NewDataSet>  
  <Foo>              <!-- Foo-Id: 0 -->
    <Bar>abcd</Bar>
    <Foo>efg</Foo>   <!-- Foo-Id: 1, Parent-Id: 0 -->
  </Foo>
  <Foo>              <!-- Foo-Id: 2 -->
    <Bar>hijk</Bar>
    <Foo>lmn</Foo>   <!-- Foo-Id: 3, Parent-Id: 2 -->
  </Foo>
</NewDataSet> 
```

因此，这正确地成为您的结果中的 4 条记录，父子键为“Foo-Id-0”

尝试：

```
<NewDataSet>  
  <Rec>              <!-- Rec-Id: 0 -->
    <Bar>abcd</Bar>
    <Foo>efg</Foo>   
  </Rec>
  <Rec>              <!-- Rec-Id: 1 -->
    <Bar>hijk</Bar>
    <Foo>lmn</Foo>   
  </Rec>
</NewDataSet> 
```

这应该导致：

```
Bar     Foo        Rec-Id
abcd    efg        0
hijk    lmn        1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T12:48:44.180

这些是我的观察，而不是完整的答案：

我的猜测（没有尝试自己重新生成它）是，当 DataSet 试图将层次结构“扁平化”为关系数据结构时，可能会发生一些事情。

1）从关系数据库的角度思考数据；没有明显的主键字段来标识集合中的每个 Foo 元素，因此 DataSet 自动使用文件中的序号位置作为自动生成的字段，称为 Foo-Id。

2）实际上有两个元素称为“Foo”，因此这可能解释了为“Foo-Id-0”列生成了一个奇怪的名称（它为该列自动生成了一个唯一名称 - 我想你可以想到这作为 DataSet 中的容错行为）。

# asp.net - .Net 3.5 SP1 的 HTTP 错误

> ID：51751
> 
> 赞同：2
> 
> 时间：2008-09-09T12:35:35.943
> 
> 标签：asp.net, .net-3.5

我有一个 ASP.Net 网站在 IE 中的 AJAX 回发（包括 ASP.Net AJAX 和第 3 部分控件）上失败。火狐工作正常。如果我将网站安装在另一台没有 .Net 3.5 SP1 的机器上，它会按预期工作。

当它失败时，Fiddler 显示我收到 405“不允许的方法”。该表单似乎发布到我正在查看的页面以外的页面。

对于损坏的网站（使用 SP1）上的页面，表单的操作是“#”。对于没有 SP1 的网站上的同一页面，表单的操作是“Default.aspx”。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-09T12:46:47.647

查看以下 Microsoft 知识库文章：

[http://support.microsoft.com/kb/216493](http://support.microsoft.com/kb/216493)

如果您使用的是 IIS4 或 IIS5，这可能是问题所在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-09T12:49:06.423

SP1 更改了 HtmlForm 控件，以便它尊重 action 属性，而以前的版本忽略了它。听起来你在损坏的页面上有这样的东西：

```
<form runat="server" action="#"> 
```

去掉这个动作，应该没问题：

```
<form runat="server"> 
```

更多信息在这里： [http ://forums.asp.net/t/1305800.aspx](http://forums.asp.net/t/1305800.aspx)

# vsto - VSTO 中的特殊单元

> ID：51754
> 
> 赞同：3
> 
> 时间：2008-09-09T12:36:49.120
> 
> 标签：vsto

我正在尝试在 VSTO 项目中使用针对 3.5 框架和 Excel2007 的 c# 的 SpecialCells 方法。

这是我的代码：

```
Excel.Worksheet myWs = (Excel.Worksheet)ModelWb.Worksheets[1];

Range myRange = myWs.get_Range("A7", "A800");

//Range rAccounts = myRange.SpecialCells(XlCellType.xlCellTypeConstants, XlSpecialCellsValue.xlTextValues);

Range rAccounts = myWs.Cells.SpecialCells(XlCellType.xlCellTypeConstants, XlSpecialCellsValue.xlTextValues); 
```

当我运行它时，它会引发异常......

```
System.Exception._COMPlusExceptionCode with a value of -532459699 
```

请注意，如果我切换（取消注释一个并注释另一个）上面的 Range rAccounts 行，我会得到相同的异常。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-09T14:55:20.910

我想通了...工作表受到保护！

```
myWs.Unprotect(Properties.Settings.Default.PasswordSheet); 
```

修复它...对于那些在家玩耍的人...完成后不要忘记保护床单。

```
myWs.Protect(Properties.Settings.Default.PasswordSheet, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing); 
```

# c# - 从 C# 打印堆栈跟踪信息

> ID：51768
> 
> 赞同：51
> 
> 时间：2008-09-09T12:45:34.140
> 
> 标签：c#, parsing, error-handling, stack-trace

作为我们产品中一些错误处理的一部分，我们想转储一些堆栈跟踪信息。但是，我们体验到许多用户只会截取错误消息对话框的屏幕截图，而不是向我们发送程序中可用的完整报告的副本，因此我想在此对话框中提供一些最小的堆栈跟踪信息。

我机器上的 .NET 堆栈跟踪如下所示：

```
at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)
at System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, Int32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions options, SECURITY_ATTRIBUTES secAttrs, String msgPath, Boolean bFromProxy)
at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access, FileShare share, Int32 bufferSize, FileOptions options)
at System.IO.StreamReader..ctor(String path, Encoding encoding, Boolean detectEncodingFromByteOrderMarks, Int32 bufferSize)
at System.IO.StreamReader..ctor(String path)
at LVKWinFormsSandbox.MainForm.button1_Click(Object sender, EventArgs e) in C:\Dev\VS.NET\Gatsoft\LVKWinFormsSandbox\MainForm.cs:line 36 
```

我有这个问题：

格式看起来是这样的：

```
at <class/method> [in file:line ##] 
```

但是，*at*和*in*关键字，我认为如果它们运行，例如，挪威 .NET 运行时而不是我安装的英文运行时，它们将被本地化。

有什么方法可以让我以与语言无关的方式分离这个堆栈跟踪，这样我就可以只显示那些条目的文件和行号？

换句话说，我想从上面的文字中得到这些信息：

```
C:\Dev\VS.NET\Gatsoft\LVKWinFormsSandbox\MainForm.cs:line 36 
```

您可以提供的任何建议都会有所帮助。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-09T13:01:01.107

您应该能够通过说获得 StackTrace 对象而不是字符串

```
var trace = new System.Diagnostics.StackTrace(exception); 
```

然后，您可以自己查看框架，而无需依赖框架的格式。

另请参阅：[StackTrace 参考](http://msdn.microsoft.com/en-us/library/system.diagnostics.stacktrace.aspx)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-08-06T14:08:48.937

这是我用来执行此操作的代码，没有例外

```
public static void LogStack()
{
  var trace = new System.Diagnostics.StackTrace();
  foreach (var frame in trace.GetFrames())
  {
    var method = frame.GetMethod();
    if (method.Name.Equals("LogStack")) continue;
    Log.Debug(string.Format("{0}::{1}", 
        method.ReflectedType != null ? method.ReflectedType.Name : string.Empty,
        method.Name));
  }
} 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-05-22T13:26:59.303

只是为了让这成为一个 15 秒的复制粘贴答案：

```
static public string StackTraceToString()
{
    StringBuilder sb = new StringBuilder(256);
    var frames = new System.Diagnostics.StackTrace().GetFrames();
    for (int i = 1; i < frames.Length; i++) /* Ignore current StackTraceToString method...*/
    {
        var currFrame = frames[i];
        var method = currFrame.GetMethod();
        sb.AppendLine(string.Format("{0}:{1}",                    
            method.ReflectedType != null ? method.ReflectedType.Name : string.Empty,
            method.Name));
    }
    return sb.ToString();
} 
```

（基于林德霍尔姆的回答）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-01-08T17:34:01.423

或者还有更短的版本..

```
Console.Write(exception.StackTrace); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T13:06:03.683

作为替代方案，log4net 虽然有潜在危险，但比 System.Diagnostics 给了我更好的结果。基本上在 log4net 中，您有一个用于各种日志级别的方法，每个级别都有一个异常参数。因此，当您传递第二个异常时，它会将堆栈跟踪打印到您配置的任何附加程序。

例子：`Logger.Error("Danger!!!", myException );`

根据配置，输出看起来像

```
System.ApplicationException: Something went wrong.
   at Adapter.WriteToFile(OleDbCommand cmd) in C:\Adapter.vb:line 35
   at Adapter.GetDistributionDocument(Int32 id) in C:\Adapter.vb:line 181
   ... 
```

# xml - 在单元测试中验证 XML 的最佳方法是什么？

> ID：51771
> 
> 赞同：10
> 
> 时间：2008-09-09T12:46:21.063
> 
> 标签：xml, unit-testing, language-agnostic, dtd

我有一个带有`ToString`生成 XML 的方法的类。我想对其进行单元测试以确保它生成有效的 xml。我有一个 DTD 来验证 XML。

**我应该将 DTD 作为字符串包含在单元测试中以避免依赖**它，还是有更聪明的方法来做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T12:49:48.810

如果您的程序在正常执行期间根据 DTD 验证 XML，那么您应该从您的程序获取 DTD 的任何地方获取 DTD。

如果不是并且 DTD 非常短（只有几行），那么将它作为字符串存储在您的代码中可能是可以的。

否则，我会将它放在一个外部文件中，并让您的单元测试从该文件中读取它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T13:14:38.767

我过去使用过[XmlUnit](http://xmlunit.sourceforge.net/)，发现它很有用。

它可用于根据模式验证 XML 或将您的 XML 与字符串进行比较。理解 XML 的解析规则就足够聪明了。例如，它知道“<e1/>”等价于“<e1></e1>”，并且可以配置为忽略或包含空格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-04T14:46:46.173

在单元测试中使用 DTD 来测试其有效性是一回事，测试正确的内容是另一回事。

您可以使用 DTD 检查生成的 xml 的有效性，我只需按照您在程序中执行的方式阅读即可。我个人不会将它内联（作为字符串）；您的应用程序代码和单元测试之间总是存在依赖关系。当生成的 xml 发生变化时，DTD 也会发生变化。

为了测试正确的内容，我会选择[XMLUnit](http://www.xmlunit.org)。

使用 XMLUnit 断言 xml：

```
XMLUnit.setIgnoreWhitespace(true);
XMLUnit.setIgnoreDiffBetweenTextAndCDATA(true);

Diff diff = new Diff(expectedDocument, obtainedDocument);
XMLAssert.assertXMLIdentical("xml invalid", diff, true); 
```

您可能会遇到的一件事是生成的 xml 可能包含不断变化的标识符（id/uid 属性等）。这可以通过在断言生成的 xml 时使用[DifferenceListener来解决。](http://www.xmlunit.org/api/java/master/org/custommonkey/xmlunit/DifferenceListener.html)

这种DifferenceListener的示例实现：

```
public class IgnoreVariableAttributesDifferenceListener implements DifferenceListener {

    private final List<String> IGNORE_ATTRS;
    private final boolean ignoreAttributeOrder;

    public IgnoreVariableAttributesDifferenceListener(List<String> attributesToIgnore, boolean ignoreAttributeOrder) {
        this.IGNORE_ATTRS = attributesToIgnore;
        this.ignoreAttributeOrder = ignoreAttributeOrder;
    }

    @Override
    public int differenceFound(Difference difference) {
        // for attribute value differences, check for ignored attributes
        if (difference.getId() == DifferenceConstants.ATTR_VALUE_ID) {
            if (IGNORE_ATTRS.contains(difference.getControlNodeDetail().getNode().getNodeName())) {
                return RETURN_IGNORE_DIFFERENCE_NODES_IDENTICAL;
            }
        }
        // attribute order mismatch (optionally ignored)
        else if (difference.getId() == DifferenceConstants.ATTR_SEQUENCE_ID && ignoreAttributeOrder) {
            return RETURN_IGNORE_DIFFERENCE_NODES_IDENTICAL;
        }
        // attribute missing / not expected
        else if (difference.getId() == DifferenceConstants.ATTR_NAME_NOT_FOUND_ID) {
            if (IGNORE_ATTRS.contains(difference.getTestNodeDetail().getValue())) {
                return RETURN_IGNORE_DIFFERENCE_NODES_IDENTICAL;
            }
        }

        return RETURN_ACCEPT_DIFFERENCE;
    }

    @Override
    public void skippedComparison(Node control, Node test) {
        // nothing to do
    }
} 
```

使用差异监听器：

```
 XMLUnit.setIgnoreWhitespace(true);
    XMLUnit.setIgnoreDiffBetweenTextAndCDATA(true);

    Diff diff = new Diff(expectedDocument, obtainedDocument);
    diff.overrideDifferenceListener(new IgnoreVariableAttributesDifferenceListener(Arrays.asList("id", "uid"), true));

    XMLAssert.assertXMLIdentical("xml invalid", diff, true); 
```

# arrays - 动态上的 Haxe 迭代

> ID：51781
> 
> 赞同：5
> 
> 时间：2008-09-09T12:51:05.017
> 
> 标签：arrays, for-loop, loops, haxe, iterable

我有一个类型的变量，`Dynamic`我肯定知道它的一个字段，我们称之为它`a`，实际上是一个数组。但是当我写

```
var d : Dynamic = getDynamic();
for (t in d.a) {
} 
```

我在第二行收到编译错误：

> 您不能迭代动态值，请指定 Iterator 或 Iterable

我怎样才能使它可编译？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T13:00:59.407

Haxe 不能迭代`Dynamic`变量（正如编译器所说）。

您可以通过多种方式使其工作，其中这一种可能是最简单的（取决于您的情况）：

```
var d : {a:Array<Dynamic>} = getDynamic();
for (t in d.a) { ... } 
```

您还可以更改`Dynamic`为数组内容的类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-15T21:17:42.347

另一种方法是使用额外的临时变量和显式类型：

```
var d = getDynamic();
var a: Array<Dynamic> = d.a;
for (t in a) { ... } 
```

# c# - 如何在 C#/VisualStudio 2008 中导出代码文档？

> ID：51782
> 
> 赞同：20
> 
> 时间：2008-09-09T12:53:47.553
> 
> 标签：c#, .net, visual-studio-2008, xml-documentation

我一直很重视使用 C# xml 语法为类和方法编写漂亮的代码注释。我一直希望以后能够轻松地导出它们。

今天我实际上必须这样做，但我很难找出方法。有什么我想念的吗？我想去*Menu->Build->Build Code Documentation*，但是那里没有选择。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-09T12:57:06.873

实际上它在项目属性中。构建选项卡，输出部分，XML 文档文件，然后输入文件名。它将建立在项目的每个构建上。

[之后，您可以使用Sandcastle](http://www.microsoft.com/downloads/details.aspx?FamilyId=E82EA71D-DA89-42EE-A715-696E3A4873B2&displaylang=en)构建实际帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T12:56:19.217

如果您不介意使用 3rd 方工具，您可以尝试[NDOC](http://ndoc.sourceforge.net/)或[SandCastle 。](http://www.codeplex.com/Sandcastle)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:00:23.450

[Sandcastle](http://www.codeplex.com/Sandcastle)非常适合生成文档，它支持几种不同的生成格式。据我所知，它没有任何 Visual Studio 集成，但有一个可用的[SandcastleGUI](http://www.inchl.nl/SandcastleGUI/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:56:37.713

如果您使用的是 LINQ to SQL，请小心，因为您将无法轻松地将可持续的注释添加到自动生成的对象中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-02T16:49:28.010

迟到的评论，但值得补充的是，即使 Sandcastle 已被封存，[Sandcastle 帮助文件生成器](https://shfb.codeplex.com/)仍在积极开发中，我发现在处理这种情况时它非常强大且直接 - 安装到丰富的 .chm 和 .html /.asp 几个小时后输出。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-06-18T17:56:43.347

以前的答案确实过时了。以下是一些更现代的选择：

*   [DocFX](https://dotnet.github.io/docfx/)：这可能是您最好的选择，因为它可以在 Linux、macOS 和 Windows 上运行，并且受到 .NET 基金会的支持。
*   [Sandcastle Help File Builder (SHFB)](https://github.com/EWSoftware/SHFB)：这个仍然受支持，但它可能不那么活跃。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-23T13:31:12.633

最初的 NDoc 项目（其他人提到）已经死了，但是有一个名为[NDoc3](https://sourceforge.net/projects/ndoc3/)的新项目。

NDoc3 支持 .NET 2.0 - 3.5。它目前作为测试版提供，对我来说效果很好。我不确定该项目是否仍然有效——最后一个测试版是在 2009 年 4 月发布的。

# serialization - 如何序列化一个图结构？

> ID：51783
> 
> 赞同：31
> 
> 时间：2008-09-09T12:54:05.087
> 
> 标签：serialization, graph-theory

平面文件和关系数据库为我们提供了一种序列化结构化数据的机制。XML 非常适合序列化非结构化的树状数据。

但是很多问题最好用图表来表示。例如，热模拟程序将使用通过电阻边缘相互连接的温度节点。

那么序列化图结构的最佳方法是什么？我知道 XML 在某种程度上可以做到这一点——就像关系数据库可以序列化复杂的对象网络一样：它通常可以工作，但很容易变得丑陋。

我知道 graphviz 程序使用的点语言，但我不确定这是最好的方法。这个问题可能是学术界可能正在研究的问题，我很想参考任何讨论这个问题的论文。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-09T13:04:14.093

你如何在内存中表示你的图表？
基本上你有两个（好的）选择：

*   [邻接表表示](http://en.wikipedia.org/wiki/Adjacency_list)
*   [邻接矩阵表示](http://en.wikipedia.org/wiki/Adjacency_matrix)

其中邻接表表示最适合用于稀疏图，而矩阵表示最适合用于密集图。

如果您使用此类表示，则可以改为序列化这些表示。

如果它必须是*人类可读*的，您仍然可以选择创建自己的序列化算法。例如，您可以像使用任何“普通”矩阵一样写下矩阵表示：只需打印列和行，以及其中的所有数据，如下所示：

```
 1  2  3
1 #t #f #f
2 #f #f #t
3 #f #t #f 
```

（这是一种非优化、非加权表示，但可用于有向图）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-09T13:12:52.640

XML 中的关系通常由父/子关系表示。XML 可以处理图形数据，但不能以这种方式处理。要处理 XML 中的图形，您应该使用[xs:ID](http://www.zvon.org/xxl/xmlSchema2001Reference/Standard/xmlschema-2.html#ID)和[xs:IDREF](http://www.zvon.org/xxl/xmlSchema2001Reference/Standard/xmlschema-2.html#IDREF)模式类型。

在一个示例中，假设 node/@id 是 xs:ID 类型，而 link/@ref 是 xs:IDREF 类型。以下 XML 显示了三个节点 1 -> 2 -> 3 -> 1 的循环。

```
<data>
  <node id="1"> 
    <link ref="2"/>
  </node>
  <node id="2">
    <link ref="3"/>
  </node>
  <node id="3">
    <link ref="1"/>
  </node>
</data> 
```

许多开发工具也支持 ID 和 IDREF。我使用了 Java 的 JAXB（Java XML 绑定。它通过[@XmlID](http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlID.html)和[@XmlIDREF](http://java.sun.com/javase/6/docs/api/javax/xml/bind/annotation/XmlIDREF.html)注释支持这些。您可以使用纯 Java 对象构建图形，然后使用 JAXB 处理实际的 XML 序列化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-09T12:58:56.417

XML 非常冗长。每当我这样做时，我都会自己动手。这是一个 3 节点有向无环图的示例。它非常紧凑，可以完成我需要做的所有事情：

```
0: foo
1: bar
2: bat
----
0 1
0 2
1 2 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:03:53.627

您可能熟悉的一个示例是 Java 序列化。这通过图有效地序列化，每个对象实例都是一个节点，每个引用都是一个边。使用的算法是递归的，但会跳过重复项。所以伪代码将是：

```
serialize(x):
    done - a set of serialized objects
    if(serialized(x, done)) then return
    otherwise:
         record properties of x
         record x as serialized in done
         for each neighbour/child of x: serialize(child) 
```

当然，另一种方式是作为节点和边的列表，可以作为 XML 或任何其他首选的序列化格式或作为邻接矩阵来完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T03:07:21.917

邻接表和邻接矩阵是在内存中表示图形的两种常用方式。在这两者之间做出决定时，您需要做出的第一个决定是您想要优化的内容。例如，如果您需要获取顶点的邻居列表，则邻接列表非常快。另一方面，如果您正在对边是否存在进行大量测试或有马尔可夫链的图形表示，那么您可能更喜欢邻接矩阵。

您需要考虑的下一个问题是您需要多少才能适应内存。在大多数情况下，图中边的数量远小于可能边的总数，邻接列表会更有效，因为您只需要存储实际存在的边。一个快乐的媒介是以压缩稀疏行格式表示邻接矩阵，其中您保留从左上角到右下角的非零条目的向量，相应的向量指示可以在哪些列中找到非零条目，以及第三个向量，指示列条目向量中每一行的开始。

```
[[0.0, 0.0, 0.3, 0.1]
 [0.1, 0.0, 0.0, 0.0]
 [0.0, 0.0, 0.0, 0.0]
 [0.5, 0.2, 0.0, 0.3]] 
```

可以表示为：

```
vals: [0.3, 0.1, 0.1, 0.5, 0.2, 0.3]
cols: [2,   3,   0,   0,   1,   4]
rows: [0,        2, null,  4] 
```

压缩稀疏行实际上是一个邻接列表（列索引的功能相同），但该格式更适合矩阵运算。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T13:01:23.150

在一个不那么学术、更实用的注释中，在[CubicTest](http://cubictest.openqa.org)中，我们使用[Xstream](http://xstream.codehaus.org/) (Java) 来序列化与 xml 之间的测试。Xstream 处理图形结构的对象关系，因此您可能会从查看它的源代码和生成的 xml 中学到一两件事。不过，您对*丑陋*的部分是正确的，生成的 xml 文件看起来并不漂亮。

# java - 如何从 Java 代码生成 UML 图（尤其是序列图）？

> ID：51786
> 
> 赞同：444
> 
> 时间：2008-09-09T12:56:05.347
> 
> 标签：java, uml, reverse-engineering, diagram

如何从现有 Java 代码生成 UML 图（尤其是序列图）？

* * *

## 回答 #1

> 赞同：261
> 
> 时间：2012-01-05T23:04:28.887

# [ObjectAid UML 资源管理器](http://www.objectaid.com/home)

是我用的。它很容易从存储库中**[安装：](https://www.objectaid.com/install-objectaid)**

```
Name:     ObjectAid UML Explorer
Location: http://www.objectaid.com/update/current 
```

并产生了相当不错的 UML 图：

![截屏](https://i.stack.imgur.com/QPnZD.png)

## 来自网站的描述：

> ObjectAid UML Explorer 与其他 UML 工具不同。它使用 UML 符号来显示现有代码的图形表示，与您的文本编辑器一样准确和最新，同时非常易于使用。几个独特的功能使这成为可能：
> 
> *   您的源代码和库是显示的模型，它们不会被反向工程成不同的格式。
> *   如果您在 Eclipse 中更新您的代码，您的图表也会随之更新；无需对源代码进行逆向工程。
> *   重构会更新您的图表以及源代码。当您重命名一个字段或移动一个类时，您的图表只会反映更改而不会失去同步。
> *   Eclipse 工作区中的所有图表都会根据需要进行重构更改。如有必要，它们会从您的版本控制系统中检出。
> *   图表完全集成到 Eclipse IDE 中。您可以将 Java 类从任何其他视图拖到图表上，并且与图表相关的信息会显示在其他适用的视图中。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2012-06-10T04:06:18.013

编辑：如果您是设计师，那么[Papyrus](http://www.papyrusuml.org)是您的最佳选择，它非常先进且功能齐全，但如果您只想绘制一些 UML 图并易于安装，那么[ObjectAid](http://objectaid.com/) 非常酷，它不需要任何插件我刚刚将它安装在 Eclipse-Java EE 上，效果很好！

* * *

**更新 2013 年 10 月 11 日**

我最初的帖子是在 2012 年 6 月，很多东西都发生了变化，很多工具都在增长，而其他工具却没有。由于我要回去做一些建模并得到一些对帖子的回复，我决定再次安装纸莎草纸，并将再次研究其他可能的 UML 建模解决方案。UML 生成（具有同步功能）对于软件设计人员而言非常重要，但对于普通开发人员而言。

我希望 papyrus 有直接的方法将逆向工程类转换为 UML 类图，如果逆向工程具有同步功能，那就太酷了，但不幸的是，papyrus 项目充满了功能，我认为那里的开发人员已经掌握了很多，因为还有很多您对纸莎草纸所做的操作可能不会给您任何回应，并且什么也没有发生，但这无论如何都超出了这个问题的范围。

**答案**（2013 年 10 月 11 日）

**工具**

1.  下载纸莎草纸
2.  转到帮助 -> 安装新软件...
3.  在*Work with:*下拉列表中，选择*--All Available Sites--*
4.  在过滤器中，输入*Papyrus*
5.  安装完成后重启Eclipse
6.  重复步骤 1-3，这一次，安装*Modisco*

**脚步**

1.  在你的 java 项目中（假设它叫做 MyProject）创建一个文件夹，例如 UML
2.  右键单击项目名称 -> Discovery -> Discoverer -> Discover Java and inventory model from java project，将生成一个名为 MyProject_kdm.xmi 的文件。 ![在此处输入图像描述](https://i.stack.imgur.com/4PnYJ.png)
3.  右键单击项目名称文件--> 新建--> 纸莎草模型-> 并将其命名为 MyProject。
4.  将生成的三个文件 MyProject.di , MyProject.notation, MyProject.uml 移动到 UML 文件夹中
5.  右键单击 MyProject_kdm.xmi -> Discovery -> Discoverer -> 从 KDM 代码中发现 UML 模型，您将获得一个属性对话框，将序列化属性设置为 TRUE 以生成名为 MyProject.uml 的文件 ![在此处输入图像描述](https://i.stack.imgur.com/x4YZO.png)

6.  将在根目录生成的 MyProject.uml 移动到 UML 文件夹，Eclipse 会询问您是否要替换它，单击是。我们在这里所做的是用生成的模型替换了一个空模型。

7.  ALT+W -> 显示视图 -> papyrus -> 模型浏览器

8.  在该视图中，您会发现您的课程如图所示 ![在此处输入图像描述](https://i.stack.imgur.com/VLL54.png)

9.  在视图中右键单击根模型-> 新建图表![在此处输入图像描述](https://i.stack.imgur.com/jIBGE.png)

10.  然后开始从视图中抓取类到图表

**一些功能**

*   显示类元素（变量、函数等）右键单击任何类->过滤器->显示/隐藏内容瞧！

*   您可以从 Window -> pereferences -> papyrus -> class diagram 进行默认的友好颜色设置

*   一个非常重要的设置是当你放下类时**排列**它们会变得狭窄，右键单击类图中的任何空白区域，然后单击全部排列

*   模型浏览器视图中的箭头可以抓取到图表以显示概括、实现等

*   毕竟，您的设置将显示类似的图表 ![在此处输入图像描述](https://i.stack.imgur.com/CEPI8.png)

*   据我所知，同步不可用，您需要手动导入任何新类。

仅此而已，除非您真的需要，否则不要购买商业产品，纸莎草纸实际上很棒而且很复杂，而是捐赠或其他东西。

免责声明：我和纸莎草纸人没有任何关系，其实一开始我并不喜欢纸莎草纸，直到我做了很多研究并耐心地体验了它。当我尝试其他免费工具时，我会再次回到这篇文章。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-09-09T13:23:22.723

你的代码库是什么？Java 还是 C++？

[![替代文字](https://i.stack.imgur.com/c8TO1.png)](http://marketplace.eclipse.org/content/euml2-free-edition)

> eUML2 for Java 是一个功能强大的 UML 建模器，专为 Eclipse 中的 Java 开发人员设计。免费版可用于商业用途。它支持以下功能：
> 
> *   CVS 和团队支持
> *   专为具有多个可定制模型视图的大型项目而设计
> *   符合 Helios 标准
> *   实时代码/模型同步
> *   符合 UML2.1 并支持 OMG XMI
> *   JDK 1.4 和 1.5 支持
> *   商业版提供：
>     
>     
> *   高级逆向工程
>     
>     
> *   强大的真实依赖分析工具
> *   UML 配置文件和 MDD
> *   数据库工具
> *   可定制的模板支持

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2017-07-21T13:43:30.850

> 我是作者之一，所以答案可能有偏见。它是开源的（Apache 2.0），但插件不是免费的。如果您在本地克隆和构建它，则无需付费（显然）。

在 Intellij IDEA 上，ZenUML 可以从 Java 代码生成序列图。 [![在此处输入图像描述](https://i.stack.imgur.com/UcsWi.gif)](https://i.stack.imgur.com/UcsWi.gif)

[在https://plugins.jetbrains.com/plugin/12437-zenuml-support](https://plugins.jetbrains.com/plugin/12437-zenuml-support)上查看

源代码：[https ://github.com/ZenUml/jetbrains-zenuml](https://github.com/ZenUml/jetbrains-zenuml)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-10-24T08:38:27.267

[PlantUML](http://plantuml.sourceforge.net/)怎么样？不是为了逆向工程！！！这是在你编码之前进行工程设计的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2016-08-18T12:21:44.633

我开发了一个**Maven 插件，**它既可以作为插件目标从 CLI 运行，也可以作为依赖项导入并以编程方式使用解析器，`@see Main#main()`以了解如何操作。

它递归地**呈现所需包的[PlantUML](http://plantuml.com/classes.html) src 代码**，您可以在需要时手动编辑（希望您不会）。然后，通过将代码粘贴到 plantUML 页面中，或者通过下载植物的 jar，您可以将 UML 图渲染为 png 图像。

在这里查看[https://github.com/juanmf/Java2PlantUML](https://github.com/juanmf/Java2PlantUML)

示例输出图： [![在此处输入图像描述](https://i.stack.imgur.com/kkUpH.png)](https://i.stack.imgur.com/kkUpH.png)

任何贡献都非常受欢迎。它有一组自定义输出的过滤器，但我还没有在插件 CLI 参数中公开这些过滤器。

**请务必注意，它不仅限于您的 *.java 文件，它还可以从您的 maven 依赖项中呈现 UML 图 src。这对于理解您所依赖的库非常方便。它实际上使用反射检查编译的类，因此不需要源**

成为第一个在 GitHub 上为它加注星标的人：P

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-08T23:14:59.167

I would recommend [EclipseUML from Omondo](http://www.omondo.com) for general usage, although I did experience some problems a few months back, with my web projects. They had a free edition at one point in time, but that is supposedly no longer promoted.

If you are really keen on reverse engineering sequence diagrams from source code, I would recommend [jTracert](http://code.google.com/p/jtracert/).

As far as Eclipse projects themselves are concerned, the [Eclipse UML2 Tools](http://wiki.eclipse.org/MDT-UML2Tools) project might support reverse engineering, although I've have never seen its use in practice.

The [MoDisco](http://www.eclipse.org/gmt/modisco/) (Model Discovery) project Eclipse GMT project seems to be clearer in achieving your objective. The [list of technology specific tools](http://www.eclipse.org/gmt/modisco/technologies/) would be a good place to start with.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-05T10:14:15.733

您也可以尝试使用 netbeans UML 建模器。我用它来生成我在 Eclipse 项目中使用的 javacode。您甚至可以在 netbeans 中导入 eclipse 项目，并使 eclipse 设置与 netbeans 项目设置保持同步。

我尝试了几个用于 Eclipse 的 UML 建模器，但对它们并不满意。它们要么不稳定，要么复杂，要么就是丑陋。;-)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-04-28T12:42:18.217

我发现[Green](http://green.sourceforge.net/)插件使用起来非常简单，可以从源代码生成类图。试试看 ：）。只需将插件复制到您的插件目录即可。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-07-18T12:11:07.517

使用 IntelliJ IDEA。要生成类图选择包并按`Ctrl`+ `Alt`+ `U`：[![在此处输入图像描述](https://i.stack.imgur.com/WBXpI.png)](https://i.stack.imgur.com/WBXpI.png)

默认情况下，它只显示类名而不是所有依赖项。要更改它：右键单击 -> 显示类别...并显示依赖项： [![在此处输入图像描述](https://i.stack.imgur.com/DFsXM.png)](https://i.stack.imgur.com/DFsXM.png)

要生成依赖关系图（UML 部署图）并使用 maven go View -> Tool Windows -> Maven Projects 并按`Ctrl`+ `Alt`+ `U`： [![在此处输入图像描述](https://i.stack.imgur.com/HblBN.png)](https://i.stack.imgur.com/HblBN.png)

结果： [![在此处输入图像描述](https://i.stack.imgur.com/7HQhD.png)](https://i.stack.imgur.com/7HQhD.png)

也可以生成更多其他图表。请参阅[文档](https://www.jetbrains.com/help/idea/working-with-diagrams.html)。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-02-03T10:08:39.093

您可以为 Eclipse 3.5 使用 EclipseUML 的 30 天评估版本：[http](http://www.uml2.org/eclipse-java-galileo-SR2-win32_eclipseUML2.2_package_may2010.zip) ://www.uml2.org/eclipse-java-galileo-SR2-win32_eclipseUML2.2_package_may2010.zip 这不是最新的 3.6 版本，但非常好，而且不需要您购买它来进行测试和逆向工程。

逆向工程：[http ://www.forum-omondo.com/documentation_eclipseuml_2008/reverse/reverse/reverse_engineering_example.html](http://www.forum-omondo.com/documentation_eclipseuml_2008/reverse/reverse/reverse_engineering_example.html)

现场闪存演示：[http ://www.ejb3.org/reverse.swf](http://www.ejb3.org/reverse.swf)

EclipseUML Omondo 是世界上最好的 Java 工具。在这个实时 java 同步市场上似乎只有 eUML 可以与之竞争，但是 eUML 在代码中添加了模型标签，这真的非常非常糟糕，对我来说绝对不行。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-22T11:53:00.840

到目前为止，我用于逆向工程和往返 java -> UML 的最佳工具是[Borland 的 Together](http://www.borland.com/products/together/default.aspx)。它基于 Eclipse（不仅仅是一个插件）并且运行良好。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-10-05T16:32:51.267

我注意到 Intellij 的 SequenceDiagram 插件也是一个不错的选择。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-08-03T06:39:36.073

I suggest PlantUML. this tools is very usefull and easy to use. PlantUML have a plugin for Netbeans that you can create UML diagram from your java code.

you can install PlantUML plugin in the netbeans by this method:

Netbeans Menu -> Tools -> Plugin

Now select Available Plugins and then find PlantUML and install it.

For more information go to website: www.plantuml.com

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-09-15T11:49:58.417

Java 的另一个建模工具是（我的）网站[GitUML](https://www.gituml.com)。从存储在 GitHub 存储库中的 Java 或 Python 代码生成 UML 图。

GitUML 的一个关键思想是解决“文档”的问题之一：图表总是过时的。使用 GitUML，当您使用 git 推送代码时，图表会自动更新。

浏览社区 UML 图，那里有一些 Java 设计模式。浏览流行的 GitHub 存储库并可视化其中的架构和模式。

[![图表浏览器](https://i.stack.imgur.com/hjt0p.png)](https://i.stack.imgur.com/hjt0p.png)

使用点击创建图表。没有拖放编辑器，只需单击要可视化的存储库树中的类：

[![选择要可视化的 java 类](https://i.stack.imgur.com/O6ARG.png)](https://i.stack.imgur.com/O6ARG.png)

底层技术是基于 PlantUML 的，这意味着您可以使用额外的 PlantUML 标记来优化您的图表。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-07T23:20:24.917

有一个名为[binarydoc的](https://github.com/fuiny/binarydoc-docker)**免费**工具，它可以从Java 方法的（而不是源代码）生成, 或( ) 。`UML Sequence Diagram``Control Flow Graph``CFG``bytecode`

[这是为java.net.AbstractPlainSocketImpl.getInputStream](https://openjdk.binarydoc.org/net.java/openjdk/13.0/method?classfilelocation=java.net.abstractplainsocketimpl&seq=19&methodname=getInputStream)生成的 java 方法的示例图**binarydoc**：

*   **方法的**控制流程图**`java.net.AbstractPlainSocketImpl.getInputStream`：**

 **[![控制流图](https://i.stack.imgur.com/xuV2z.png)](https://i.stack.imgur.com/xuV2z.png)

*   **方法的**UML序列图**`java.net.AbstractPlainSocketImpl.getInputStream`：**

 **[![UML 序列图](https://i.stack.imgur.com/fQ3HW.png)](https://i.stack.imgur.com/fQ3HW.png)

# c# - 如何使用 System.Net.Mail 设置 SMTP 信封 MAIL FROM？

> ID：51793
> 
> 赞同：13
> 
> 时间：2008-09-09T12:58:22.313
> 
> 标签：c#, .net, smtp

当您使用 C# 和 System.Net.Mail 命名空间发送电子邮件时，您可以在 MailMessage 对象上设置“发件人”和“发件人”属性，但这些都不允许您创建 MAIL FROM 和发件人地址进入彼此不同的DATA部分。MAIL FROM 设置为“From”属性值，如果设置“Sender”，它只会在 DATA 部分添加另一个标题字段。这导致“代表 A@B.COM 来自 X@Y.COM”，这不是您想要的。我错过了什么吗？

用例控制代表其他人发送的新闻通讯等的 NDR 目的地。

我目前正在使用[aspNetEmail](http://www.aspnetemail.com/)而不是 System.Net.Mail，因为它允许我正确执行此操作（就像大多数其他 SMTP 库一样）。对于 aspNetEmail，这是使用 EmailMessage.ReversePath 属性完成的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-16T23:02:27.613

`MailMessage.Sender`将始终插入一个`Sender`标题（在您的电子邮件客户端中被解释为*代表）。*

如果您使用的`Network`投递方式`SmtpClient`，`.Sender`也会更改信封中的发件人。使用`PickupDirectoryFromIis`传递方法将由 IIS 来确定信封发件人，而 IIS 将使用`From`地址，而不是`Sender`地址。

[MSDN 上有一个类似的问题。](http://social.msdn.microsoft.com/Forums/en-US/ncl/thread/a26c273a-18eb-4143-8631-233088977b21/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T20:13:16.690

我刚刚找到了如何做到这一点：

*   mail.From 指定对最终用户可见的电子邮件
*   mail.Sender 指定信封 MAIL FROM

就是这样（即使我花了一段时间才弄清楚）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-09-27T13:50:49.303

如果添加以下行，则在邮件标题中设置 Return-Path 和 Reply-To 标题。

```
Dim strReplyTo As String = "email@domain.tld"
message.ReplyToList.Add(strReplyTo)
message.Headers.Add("Return-Path", strReplyTo) 
```

如果您单击回复电子邮件设置为回复地址

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:17:09.023

你是这个意思吗：

```
//create the mail message
 MailMessage mail = new MailMessage();

 //set the addresses
 mail.From = new MailAddress("me@mycompany.com");
 mail.To.Add("you@yourcompany.com");

 //set the content
 mail.Subject = "This is an email";
 mail.Body = "this is a sample body with html in it. <b>This is bold</b> <font color=#336699>This is blue</font>";
 mail.IsBodyHtml = true;

 //send the message
 SmtpClient smtp = new SmtpClient("127.0.0.1");
 smtp.Send(mail); 
```

来自[http://www.systemnetmail.com/faq/3.1.2.aspx](http://www.systemnetmail.com/faq/3.1.2.aspx)

# .net - 堆栈溢出的编辑控制

> ID：51808
> 
> 赞同：4
> 
> 时间：2008-09-09T13:02:06.067
> 
> 标签：.net, asp.net, text-editor

我现在输入的编辑控件，其所有按钮和规则都可以免费使用吗？

我的网络项目也是基于 .Net 的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-09T13:03:46.857

它是[WMD](http://wmd-editor.com/) Markdown 编辑器，它是免费的，而且似乎很容易使用。只需包含它的 javascript 并且（在最简单的情况下），它只是附加到它找到的第一个文本区域。

这里有一些关于[Markdown 的 Perl 实现的](http://daringfireball.net/projects/markdown/)信息，根据该站点，WMD 是 100% 兼容的。

[@Chris Upchurch](https://stackoverflow.com/questions/51808#51822) 从技术上讲，当前版本不是开源的，只是免费使用。不过，下一个版本应该使用 MIT 许可证发布。

> > > > “现在完全免费使用。下一个版本将在 MIT 风格的许可下开源。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T13:04:13.563

我不知道这个控件，但 TinyMCE 是：

[http://tinymce.moxiecode.com/](http://tinymce.moxiecode.com/)

这是wordpress等使用的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:06:10.517

[WMD 编辑器](http://wmd-editor.com/)是完全免费的（在单词的语音和啤酒意义上）。它在 MIT 风格的许可下可用。

# .net - 是否有动态生成 sql 的标准方法？

> ID：51827
> 
> 赞同：12
> 
> 时间：2008-09-09T13:08:30.730
> 
> 标签：.net, sql

我想问一下其他程序员如何生成动态 SQL 字符串以作为 SQLCommand 对象的 CommandText 执行。

我正在生成包含用户生成的 WHERE 子句和 SELECT 字段的参数化查询。有时查询很复杂，我需要对不同部分的构建方式进行大量控制。

目前，我正在使用许多循环和 switch 语句来生成必要的 SQL 代码片段并创建所需的 SQL 参数对象。这种方法很难遵循，它使维护成为一件真正的苦差事。

有没有更清洁、更稳定的方法来做到这一点？

有什么建议么？

编辑：为我以前的帖子添加细节：

1.  由于要求，我无法真正模板化我的查询。只是变化太大了。
2.  我必须允许聚合函数，比如 Count()。这对 Group By/Having 条款有影响。它还会导致嵌套的 SELECT 语句。反过来，这会影响所使用的列名
3.  一些联系人数据存储在 XML 列中。用户可以将这些数据连同其他关系列一起查询。后果是 xmlcolumns 不能出现在 Group By 子句[sql 语法] 中。
4.  我正在使用一种使用 Row_Number() SQL 函数的高效分页技术。结果是我必须使用 Temp 表，然后在选择我的子集之前获取@@rowcount，以避免第二次查询。

我将展示一些代码（恐怖！），以便你们了解我正在处理的内容。

```
sqlCmd.CommandText = "DECLARE @t Table(ContactId int, ROWRANK int" + declare
      + ")INSERT INTO @t(ContactId, ROWRANK" + insertFields + ")"//Insert as few cols a possible
      + "Select ContactID, ROW_NUMBER() OVER (ORDER BY " + sortExpression + " "
      + sortDirection + ") as ROWRANK" // generates a rowrank for each row
      + outerFields
      + " FROM ( SELECT c.id AS ContactID"
      + coreFields
      + from         // sometimes different tables are required 
      + where + ") T " // user input goes here.
      + groupBy+ " "
      + havingClause //can be empty
      + ";"
      + "select @@rowcount as rCount;" // return 2 recordsets, avoids second query
      + " SELECT " + fields + ",field1,field2" // join onto the other cols n the table
      +" FROM @t t INNER JOIN contacts c on t.ContactID = c.id" 
      +" WHERE ROWRANK BETWEEN " + ((pageIndex * pageSize) + 1) + " AND " 
      + ( (pageIndex + 1) * pageSize); // here I select the pages I want 
```

在此示例中，我正在查询 XML 数据。对于纯关系数据，查询要简单得多。每个部分变量都是 StringBuilders。Where 子句的构建方式如下：

```
// Add Parameter to SQL Command
AddParamToSQLCmd(sqlCmd, "@p" + z.ToString(), SqlDbType.VarChar, 50, ParameterDirection.Input, qc.FieldValue);
// Create SQL code Fragment
where.AppendFormat(" {0} {1} {2} @p{3}", qc.BooleanOperator, qc.FieldName, qc.ComparisonOperator, z); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T13:18:13.173

我需要在我最近的一个项目中这样做。这是我用于生成 SQL 的方案：

*   查询的每个组件都由一个对象表示（在我的例子中，它是一个映射到数据库中表的 Linq-to-Sql 实体）。所以我有以下类：Query、SelectColumn、Join、WhereCondition、Sort、GroupBy。这些类中的每一个都包含与查询的该组件相关的所有详细信息。
*   最后五个类都与一个 Query 对象相关。因此 Query 对象本身具有每个类的集合。
*   每个类都有一个方法，可以为它所代表的查询部分生成 SQL。因此，创建整体查询最终调用 Query.GenerateQuery() 依次枚举所有子集合并调用它们各自的 GenerateQuery() 方法

它仍然有点复杂，但最终您知道查询的每个单独部分的 SQL 生成源自何处（而且我不认为有任何大的 switch 语句）。并且不要忘记使用 StringBuilder。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T15:12:37.530

我们创建了自己的 FilterCriteria 对象，它是一种*黑盒*动态查询构建器。它具有 SelectClause、WhereClause、GroupByClause 和 OrderByClause 的集合属性。它还包含 CommandText、CommandType 和 MaximumRecords 的属性。

然后，我们将 FilterCriteria 对象传递给我们的数据逻辑，它针对数据库服务器执行它，并将参数值传递给执行动态代码的存储过程。

对我们来说效果很好......并将 SQL 生成很好地包含在一个对象中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:14:22.527

您可以尝试 CodeSmith 等代码生成工具使用的方法。创建带有占位符的 SQL 模板。在运行时，将模板读入字符串并将占位符替换为实际值。这仅在所有 SQL 代码都遵循一个模式时才有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:50:38.897

Gulzar 和 Ryan Lanciaux 在提到 CodeSmith 和 ORM 时提出了很好的观点。在生成动态 SQL 时，其中任何一个都可能减轻或消除您当前的负担。您当前使用参数化 SQL 的方法是明智的，因为它可以很好地防止 SQL 注入攻击。

如果没有要评论的实际代码示例，很难为您当前使用的循环和 switch 语句提供明智的替代方案。但是由于您提到您正在设置 CommandText 属性，因此我建议您在实现中使用 string.Format （如果您还没有使用它）。我认为它可能使您的代码更容易重组，从而提高可读性和理解性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T13:52:58.267

通常是这样的：

```
string query= "SELECT {0} FROM .... WHERE {1}"
StringBuilder selectclause = new StringBuilder();
StringBuilder wherecaluse = new StringBuilder();

// .... the logic here will vary greatly depending on what your system looks like

MySqlcommand.CommandText = String.Format(query, selectclause.ToString(), whereclause.ToString()); 
```

我也刚刚开始使用 ORM。你可能想看看其中之一。ActiveRecord / Hibernate 是谷歌的一些很好的关键字。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T15:04:26.847

如果您真的需要从代码中执行此操作，那么 ORM 可能是尝试保持其清洁的方法。

但是我想提供一个运行良好的替代方案，并且可以避免伴随动态查询出现的性能问题，因为更改 SQL 需要创建新的查询计划，对索引有不同的要求。

创建一个接受所有可能参数的存储过程，然后在 where 子句中使用类似这样的内容：

```
where...
and (@MyParam5 is null or @MyParam5 = Col5) 
```

然后，从代码中，将参数值设置为 DBNull.Value 在它不适用时要简单得多，而不是更改您生成的 SQL 字符串。

您的 DBA 对您会更满意，因为他们将有一个地方可以进行查询调优，SQL 将易于阅读，并且他们不必深入探查器跟踪来查找由您生成的许多不同查询代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T13:13:06.507

出于好奇，您是否考虑过使用 ORM 来管理您的数据访问。您尝试实现的许多功能可能已经存在。这可能值得一看，因为最好不要重新发明轮子。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-09T14:07:25.863

[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)已经解决了动态 SQL 生成的问题（我更喜欢[NHibernate](http://www.hibernate.org/343.html) / [ActiveRecord](http://www.castleproject.org/activerecord/index.html)）。使用这些工具，您可以通过遍历用户输入并生成表达式对象数组来创建具有未知数量条件的查询。然后使用该自定义表达式集执行内置查询方法。

```
List<Expression> expressions = new List<Expression>(userConditions.Count);
foreach(Condition c in userConditions)
{
    expressions.Add(Expression.Eq(c.Field, c.Value));
}
SomeTable[] records = SomeTable.Find(expressions); 
```

还有更多的“表达式”选项：不相等、大于/小于、null/not-null 等。我刚刚编写的“条件”类型，您可能可以将用户输入填充到有用的类中。

# command-line - 使用批处理文件打开一系列文件中的一个

> ID：51837
> 
> 赞同：6
> 
> 时间：2008-09-09T13:12:31.313
> 
> 标签：command-line, batch-file, dos, cmd

基于此结构，我最多有 4 个文件（注意前缀是日期）

*   0830文件名.txt
*   0907文件名.txt
*   0914文件名.txt
*   0921文件名.txt

我想打开最近的一个（0921filename.txt）。我怎样才能在批处理文件中做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-09T13:27:14.617

此方法使用实际的文件修改日期，以确定哪个是最新的文件：

```
@echo off
for /F %%i in ('dir /B /O:-D *.txt') do (
    call :open "%%i"
    exit /B 0
)
:open
    start "dummy" "%~1"
exit /B 0 
```

但是，此方法按字母顺序选择最后一个文件（或第一个，按反向字母顺序），因此如果文件名一致 - 它会起作用：

```
@echo off
for /F %%i in ('dir /B *.txt^|sort /R') do (
    call :open "%%i"
    exit /B 0
)
:open
    start "dummy" "%~1"
exit /B 0 
```

您实际上必须选择哪种方法更适合您。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T13:46:03.603

抱歉，我向这个问题发送了垃圾邮件，但我真的很想发布**The Real Answer**。如果您希望您的 BATCH 脚本*解析*和*比较*文件名中的日期，那么您可以使用如下内容：

```
@echo off

rem Enter the ending of the filenames.
rem Basically, you must specify everything that comes after the date.
set fn_end=filename.txt

rem Do not touch anything bellow this line.
set max_month=00
set max_day=00

for /F %%i in ('dir /B *%fn_end%') do call :check "%%i"
call :open %max_month% %max_day%
exit /B 0

:check
    set name=%~1
    set date=%name:~0,4%
    set month=%date:~0,2%
    set day=%date:~2,2%
    if /I %month% GTR %max_month% (
        set max_month=%month%
        set max_day=%day%
    ) else if /I %month% EQU %max_month% (
        set max_month=%month%
        if /I %day% GTR %max_day% (
            set max_day=%day%
        )
    )
exit /B 0

:open
    set date=%~1
    set month=%~2
    set name=%date%%month%%fn_end%
    start "dummy" "%name%"
exit /B 0 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-09T13:37:21.863

一个班轮，使用 EXIT 技巧：

```
FOR /F %%I IN ('DIR *.TXT /B /O:-D') DO NOTEPAD %%I & EXIT 
```

**编辑：**

@pam：你说得对，我假设文件按日期顺序排列，但你可以将命令更改为：

```
FOR /F %%I IN ('DIR *.TXT /B /O:-N') DO NOTEPAD %%I & EXIT 
```

然后你有文件列表按名称以相反的顺序排序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:24:30.987

给你...（希望没有人打败我...）（您需要将文件保存为 lasttext.bat 或其他文件）这将打开/运行最旧的 .txt 文件

```
dir *.txt /b /od > systext.bak 
FOR /F %%i in (systext.bak) do set sysRunCommand=%%i 
call %sysRunCommand%
del systext.bak /Y 
```

可能只有XP。看看 DOS 的强大功能。
虽然这会按日期获取最新的文件名 - 而不是按文件名..

如果要获取最新的文件名，请将 /od 更改为 /on 。
如果要对其他内容进行排序，请在第二行添加“排序”命令。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-09T13:22:48.933

使用正则表达式解析出相关整数并进行比较。

# visual-studio - MS Visual Studio 可以在 CPU 上使用 2 个或 4 个内核编译项目吗？

> ID：51845
> 
> 赞同：9
> 
> 时间：2008-09-09T13:17:02.333
> 
> 标签：visual-studio

它是标志的任何编译器选项吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T13:19:51.047

如果您设置一个指向 MsBuild 的外部工具来构建具有多进程标志 /m 的解决方案，则可以。

Scott Hanselman 写了一篇关于如何实现这一点的[好文章](http://www.hanselman.com/blog/FasterBuildsWithMSBuildUsingParallelBuildsAndMulticoreCPUs.aspx)，所以我不会重复他已经做过的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-09T13:23:23.813

MSDN 回答您的问题：

[使用多个处理器构建项目](http://msdn.microsoft.com/en-us/library/bb383805.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-05T14:58:53.090

万一有人遇到这种情况，VS2012 引入了并行构建作为[标准功能](http://visualstudiomagazine.com/articles/2012/03/01/more-power.aspx)。引用文章：

> Visual Studio 2010 包含“最大并行项目构建数”选项。尽管没有任何限制的迹象，但此 IDE 选项仅适用于 C++ 项目。幸运的是，此限制不再适用于 Visual Studio 11。相反，现在也完全支持其他语言的并行构建。要查看此内容，请在构建具有大量项目的解决方案的同时运行 Process Explorer 的副本。您将看到创建了多个 MSBuild 实例——与“最大并行项目构建数”中指定的一样多。

# c++ - 在 Visual Studio (2005) 下使用 Makefile 而不是解决方案/项目文件

> ID：51859
> 
> 赞同：11
> 
> 时间：2008-09-09T13:22:29.683
> 
> 标签：c++, visual-studio, makefile

有没有人有使用 Visual Studio C++ 构建的生成文件（在 VS 2005 下）而不是使用项目/解决方案设置的经验。对我们来说，项目/解决方案的工作方式并不直观，当您尝试使用特定编译时间标志调整构建时会导致配置爆炸。

在 Unix 下，很容易设置一个 makefile，它的默认选项被用户设置（或其他配置设置）覆盖。但是在 Visual Studio 中做这些类型的事情似乎很困难。

例如，我们有一个需要为 3 个不同平台构建的项目。每个平台可能有多个配置（例如调试、发布和其他几个）。对于一个新成立的项目，我的目标之一是拥有一个可以让所有平台构建在一起的解决方案，这使得构建和测试代码更改更容易，因为您不必打开 3 个不同的解决方案来测试您的代码。但是 Visual Studio 将需要 3 *（基本配置数量）配置。即PC调试、X360调试、PS3调试等。

似乎makefile解决方案在这里要好得多。包含一些基本的批处理文件或脚本，很容易将配置扩展保持在最低限度，并且只为我们必须执行的所有不同构建维护一小部分文件。

但是，我没有使用 Visual Studio 下的 makefile 的经验，并且想知道其他人是否有可以分享的经验或问题。

谢谢。

（编辑后提到这些是 C++ 版本）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-09T13:45:36.523

我发现大型项目的 makefile 有一些好处，主要与统一项目设置的位置有关。如果源文件列表、包含路径、预处理器定义等都在 makefile 或其他构建配置文件中，则管理它们会稍微容易一些。对于多种配置，添加包含路径意味着您需要确保通过 Visual Studio 的繁琐项目属性手动更新每个配置，随着项目规模的扩大，这可能会变得非常乏味。

使用大量自定义构建工具的项目也更易于管理，例如，如果您需要编译像素/顶点着色器，或者在没有原生 VS 支持的情况下使用其他语言编写代码。

但是，您仍然需要有各种不同的项目配置，因为您需要为每个配置区分构建工具的调用（例如，传递不同的命令行选项来制作）。

立即想到的缺点：

*   较慢的构建：VS 在调用外部工具方面并不是特别快，甚至在确定是否需要首先构建项目时也不是特别快。
*   尴尬的项目间依赖关系：设置起来很繁琐，依赖者会导致基础项目构建，并且更容易确保它们以正确的顺序构建。我在让 SCons 做这件事方面取得了一些成功，但要做好工作总是一个挑战。
*   丢失了一些有用的 IDE 功能：编辑并继续是主要功能！

简而言之，您将花费更少的时间来管理您的项目配置，而是花更多的时间来引导 Visual Studio 正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T13:26:32.420

[Visual Studio 是在MSBuild](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)配置文件之上构建的。您可以将 *proj 和 *sln 文件视为 makefile。它们允许您完全自定义构建过程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:28:36.500

虽然在技术上是可行的，但它在 Visual Studio 中并不是一个非常友好的解决方案。它会一直和你战斗。

我建议你看看[NAnt](http://nant.sf.net)。这是一个非常强大的构建系统，您基本上可以在其中做任何您需要做的事情。

我们的 NAnt 脚本在每次构建时都会这样做：

1.  将数据库迁移到最新版本
2.  从数据库生成 C# 实体
3.  在我们的“主”解决方案中编译每个项目
4.  运行所有单元测试
5.  运行所有集成测试

此外，我们的构建服务器利用这一点并增加了 1 个任务，即生成 Sandcastle 文档。

如果您不喜欢 XML，您还可以查看[Rake](http://rake.rubyforge.org/) (ruby)、[Bake/BooBuildSystem](http://code.google.com/p/boo-build-system/) (Boo) 或[Psake](http://codebetter.com/blogs/james.kovacs/archive/2008/06/27/introducing-psake.aspx) (PowerShell)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T13:26:41.357

您可以使用 nant 单独构建项目，从而替换解决方案并拥有 1 个编码解决方案而没有构建解决方案。

要记住的一件事是，vs 2005 及更高版本的解决方案和 csproj 文件是 msbuild 脚本。因此，如果您熟悉 msbuild，您可能能够使用现有文件，使 vs 更容易，并使您的部署更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T14:58:49.217

我们的设置与您描述的类似。我们支持至少 3 个不同的平台，因此我们发现使用[CMake](http://www.cmake.org/HTML/index.html)来管理不同的 Visual Studio 解决方案。设置可能有点痛苦，但它几乎可以归结为阅读文档和一些教程。通过转到项目和解决方案的属性，您应该能够做几乎所有可以做的事情。不确定您是否可以将所有三个平台构建一起存在于同一个解决方案中，但您可以使用[CruiseControl](http://www.cmake.org/HTML/index.html)来处理您的构建，并根据需要经常运行您的测试脚本。

# visual-c++ - VC++ 和 MapPoint OCX 控制对话框问题

> ID：51866
> 
> 赞同：1
> 
> 时间：2008-09-09T13:23:24.533
> 
> 标签：visual-c++, mappoint

我正在编写一个基于 VC++ MFC 对话框的应用程序，它需要在其中嵌入 Microsoft MapPoint。为此，我使用 MS VC++ .NET 2003 和 MapPoint Europe 2006 来执行此操作，但遇到问题，因为当我选择“插入 ActiveX 控件”时，选项列表中没有出现 MapPoint 控件。我尝试手动注册`mappointcontrol.ocx`似乎`regsvr32`成功但控件仍然没有出现在列表中。

谁能建议我在这里做错了什么，以及任何可能的解决方案。

谢谢

伊恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T15:28:07.653

您是否尝试过使用 ActiveX 控件测试容器？它在控件列表中吗？在测试容器中使用注册按钮怎么样？

还要检查注册表以查看它是否已注册。您应该在 HKEY-CLASSES-ROOT\controlName 中有一个条目，其中包含指向 UUID 的 CLSID 元素。该 UUID 还应该位于 HKEY-CLASSES-ROOT\CLSID\uuid 中，并且具有指向 DLL 的 LocalServer32 条目和指向 controlName 的 ProgID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T15:05:03.427

我现在已经让 Mappoint 控件工作了，但方式略有不同。该控件确实出现在测试容器可以使用的控件列表中。我已经尝试重新注册它并取消注册它，但是当我尝试“插入 ActiveX 控件”时它仍然没有出现在控件列表中。但是，如果我使用“添加/删除工具箱项目”，我可以将其添加到工具箱中，然后将其拖到我的应用程序中，它可以正常工作。我不确定为什么这种方法有效，但它确实有效，我可以继续我的编码。

非常感谢您对此提供的所有帮助。

# asp.net - 如何强制我的 ASP.net 2.0 应用程序重新编译

> ID：51870
> 
> 赞同：7
> 
> 时间：2008-09-09T13:25:36.743
> 
> 标签：asp.net, .net-2.0

我有一个 ASP.net 2.0 应用程序，并且对源文件（cs 文件）进行了一些更改。我上传了更改并相信它会自动重新编译。我在 MY_APP/bin 中也有编译好的 dll。我检查了它，发现它没有重新编译。请理解我是新手。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-09T13:28:31.087

我的#1 方法是在 xml 声明标记之后，在 web 配置文件的顶部添加空格。

它强制节点重新缓存和重新编译。我们甚至在管理员深处有一个名为 Flush.aspx 的页面来为我们做这件事。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T13:42:09.590

我使用与 ChanChan 类似的方法，但我在 web.config 中添加了注释而不是空格，以指示编辑配置的时间/原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:31:01.503

最好在进行 .cs 更改后实际运行构建。

你在哪里运行它？这是用于调试还是生产？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T13:27:30.047

在 VS 菜单中，您有 Build -> Rebuild Solution

# visual-studio - 用于打印代码的最佳 Visual Studio 插件是什么

> ID：51871
> 
> 赞同：11
> 
> 时间：2008-09-09T13:26:12.030
> 
> 标签：visual-studio, visual-studio-extensions

我认为它必须包括的一些功能是：

1.  打印整个解决方案
2.  能够打印行号
3.  正确选择编码字体和大小以提高可读性
4.  漂亮的标题信息
5.  打印区域的能力崩溃了

几个功能补充：

1.  在方法/类之后自动插入分页符
2.  保持长行可读（几乎所有当前的实现都被破坏了）

*注意：需要打印代码的原因有很多……一个很好的原因是托管。*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-09T13:43:09.633

我将[PrettyCode.Print 用于 .NET](http://submain.com/?nav=products.pcp.net)。它可以完成您列表中的所有内容，等等。（我用它来打印版权注册文件的代码摘录，这与您的托管案例类似。）

打开一个非常大的解决方案有点慢，但不是令人难以忍受，而且输出质量非常好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-09T13:31:54.747

试试 StarPrint 的[VSNETcodePrint](http://starprint2000.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-09T13:48:06.970

几个功能补充：

*   在方法/类之后自动插入分页符
*   保持长行可读（几乎所有当前的实现都被破坏了）

# regex - 正则表达式查找/替换的用例

> ID：51884
> 
> 赞同：7
> 
> 时间：2008-09-09T13:30:38.727
> 
> 标签：regex, editor

我最近和一位同事讨论了编辑器。他使用了一个不太受欢迎的编辑器，而我使用了另一个（我不会说是哪一个，因为它不相关，我想避免编辑器的火焰战争）。我是说我不太喜欢他的编辑器，因为它不允许您使用正则表达式进行查找/替换。

他说他从来不想这样做，这很令人惊讶，因为我发现自己一直在做这件事。然而，在我的脑海中，我无法想出超过一两个例子。这里的任何人都可以提供一些他们发现正则表达式查找/替换在他们的编辑器中有用的时间示例吗？以下是我从那时起能够想出的作为我实际必须做的事情的例子：

1.  从文件中的每一行中去掉一行的开头，如下所示：
    `Line 25634 :`
    `Line 632157 :`

2.  取几十个带有标准标题的文件，每个文件略有不同，并一次从所有文件中删除前 19 行。

3.  将 MySQL select 语句的结果通过管道传输到文本文件中，然后删除所有格式化垃圾并将其重新格式化为 Python 字典，以便在简单脚本中使用。

4.  在没有转义逗号的 CSV 文件中，将每行第 8 列的第一个字符替换为大写 A。

5.  给定一堆 GDB 堆栈跟踪，其中包括
    `#3 0x080a6d61 in _mvl_set_req_done (req=0x82624a4, result=27158) at ../../mvl/src/mvl_serv.c:850`
    除函数名称之外的每一行中的所有内容。

其他人有任何现实生活中的例子吗？下次出现这种情况时，我想更充分地准备列出为什么这个功能有用的好例子。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-09T13:35:49.650

就在上周，我使用正则表达式查找/替换将 CSV 文件转换为 XML 文件。

真的很简单，只需切掉每个字段（幸运的是它没有任何转义的逗号），然后用适当的标签代替逗号将其推回。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-09T13:41:11.540

正则表达式使使用单词边界替换整个单词变得容易。

```
(\b\w+\b) 
```

因此，您可以替换文件中不需要的单词，而不会干扰像**斯肯索普这样的单词**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T00:17:40.397

昨天我为 Oracle 表创建了一个创建表语句，并使用 JDBC 和 PreparedStatements 将字段转换为 setString() 方法调用。该表的字段名称已映射到我的类属性，因此正则表达式搜索和替换非常适合。

创建表格文本：

```
...
field_1 VARCHAR2(100) NULL,
field_2 VARCHAR2(10) NULL,
field_3 NUMBER(8) NULL,
field_4 VARCHAR2(100) NULL,
.... 
```

我的正则表达式搜索：

```
/([a-z_])+ .*?,?/ 
```

我的替代品：

```
pstmt.setString(1, \1); 
```

结果：

```
...
pstmt.setString(1, field_1);
pstmt.setString(1, field_2);
pstmt.setString(1, field_3);
pstmt.setString(1, field_4);
.... 
```

然后，我为每个调用手动设置位置 int 并在必要时将方法更改为 setInt() （和其他方法），但这对我来说很方便。我实际上将它用于类似领域的三四次方法调用转换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-09T13:45:21.547

我喜欢使用正则表达式来重新格式化这样的项目列表：

```
int item1
double item2 
```

至

```
public void item1(int item1){
}
public void item2(double item2){
} 
```

这可以节省大量时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T14:34:38.480

当有人向我发送列中的患者访问号码列表（例如 100-200）并且我需要它们以“0000000444”、“000000004445”格式时，我一直使用它。为我创造奇迹！

我还用它来提取电子邮件中的电子邮件地址。我经常发送群组电子邮件，所有退回的退货都会在一封电子邮件中返回。因此，我正则表达式将它们全部拉出，然后将它们放入字符串 var 中以从数据库中删除。

我什至写了一个小对话框程序来将正则表达式应用于我的剪贴板。它抓取内容并应用正则表达式，然后将其加载回剪贴板。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-14T00:05:07.550

我在 Web 开发中一直使用它的一件事是剥离其 HTML 标记的一些文本。为了安全起见，或者为了显示新闻文章的预览，可能需要执行此操作来清理用户输入。例如，如果您的文章包含大量用于格式化的 HTML 标签，您不能只执行 LEFT(article_text,100) + '...' （加上“阅读更多”链接）并将其呈现在页面上通过拆分 HTML 标签来破坏页面的风险。

此外，我不得不在链接到不再存在的图像的数据库记录中去除 img 标签。我们不要忘记 Web 表单验证。如果您想让用户在 Web 表单中输入正确的电子邮件地址（从语法上讲），这是彻底检查它的唯一方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-03T17:37:19.750

我刚刚将一个长字符序列粘贴到一个字符串文字中，现在我想将它分解成一个较短的字符串文字的串联，这样它就不会换行。我也希望它是可读的，所以我只想在空格之后打破。我选择整个字符串（减去引号）并使用此正则表达式进行选择中的全部替换：

```
/.{20,60} / 
```

...和这个替换：

```
/$0"¶         + "/ 
```

...其中 pilcrow 是实际的换行符，并且空格的数量因事件而异。结果：

```
String s = "I recently discussed editors with a co-worker. He uses one "
         + "of the less popular editors and I use another (I won't say "
         + "which ones since it's not relevant and I want to avoid an "
         + "editor flame war). I was saying that I didn't like his "
         + "editor as much because it doesn't let you do find/replace "
         + "with regular expressions."; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-18T01:57:04.530

我同意你对第 3、4 和 5 点的看法，**但**不一定**同意**第1**和****第**2**点**。

 ******在某些情况下，使用匿名键盘宏更容易实现**1**和**2 。**

我的意思是执行以下操作：

1.  将光标定位在第一行
2.  开始键盘宏录制
3.  修改第一行
4.  将光标定位在下一行
5.  停止记录。

现在修改下一行所需要做的就是重复宏。

我可以不支持正则表达式，但不能不支持匿名键盘宏。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-12T18:57:31.910

每当我尝试替换跨多行的值时，Regex 都非常方便。或者当我想用包含换行符的东西替换一个值时。

我也喜欢你可以匹配正则表达式中的内容，而不是使用 $# 语法替换完整匹配来输出你想要维护的匹配部分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-09T13:46:39.437

我对任何编辑器做的第一件事就是试图找出它是正则表达式的奇怪之处。我用它所有的时间。没什么特别疯狂的，但是当您必须在不同类型的文本之间复制/粘贴内容时，它会很方便 - SQL <-> PHP 是我最常做的一种 - 而且您不想放屁进行相同的更改 500次。

# profile - 分析时的操作系统开销？

> ID：51887
> 
> 赞同：1
> 
> 时间：2008-09-09T13:31:28.443
> 
> 标签：profile

我正在 Intel Core-2Duo 平台上对 Microsoft VS 2005 中的 C 代码进行分析。我测量了我的函数所消耗的时间（秒：毫秒）。但我对这种测量的准确性有些怀疑，因为操作系统不会连续运行我的应用程序，而是在我的代码执行之间安排其他应用程序/服务。（虽然我在执行配置文件时没有运行主要应用程序运行，Windows 仍然会有很多自己的代码，它将通过抢占我的应用程序来运行。）。由于这一切，我认为分析编号（我的应用程序运行所花费的时间）不准确。

所以我的问题是有什么方法可以找出操作系统开销，在典型的 Windows 系统（我运行 Windows XP）上调度开销，例如，如果我的应用程序说它运行了 60 毫秒，那么在 60 毫秒中，真正的时间是多少？我的应用程序使用。由于被操作系统安排的其他任务抢占了，它闲置了多少时间？

或者

根据您在做类似事情时遇到的经验，至少有没有任何可能的数字来获得这样的操作系统开销？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T13:41:50.433

@Kogus：即使我在调试器之外运行（独立应用程序。从命令提示符）它仍然可能被操作系统抢占并导致我的应用程序消耗的时间测量不正确。

不是吗？

-广告

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T13:50:39.273

我认为您将在粒度方面遇到一些问题。查看类似的问题[GetLocalTime() API 时间分辨率](https://stackoverflow.com/questions/49668/getlocaltime-api-time-resolution)和是否[保证 gettimeofday() 具有微秒分辨率？](https://stackoverflow.com/questions/88/is-gettimeofday-guaranteed-to-be-of-microsecond-resolution)

此外，您可能想查看包含 timeit.exe（类似于unix/linux 上的）的[Windows 资源工具包工具，以提供经过时间和处理时间。](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)`time`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-09T13:33:49.467

**建议**

尝试在多 CPU 系统上运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T13:36:26.607

1 - 在您的代码中添加一些调试日志（当然包括时间戳），并在调试器之外运行它

2 -*在*调试器中再次运行

3 - 重复多次，以获得统计上有效的数据。

4 - 比较。

如果独立与调试器的平均执行时间存在显着差异，那么您应该怀疑操作系统（或调试器挂钩本身的开销......）。如果没有区别，那就不要出汗。

*Edit0：显然调试消息有自己的一些开销。即使从调试器运行，您也可能希望将这些保留在代码中。这样，独立和调试器都运行相同的代码。*

*Edit1：我误解了这个问题。我认为您担心的是——在调试时——操作系统可能会比正常执行模式更频繁地中断您的应用程序。如果您想知道您的应用实际花费了多少时间，只需将花费的时间与任务管理器中的“CPU 时间”进行比较即可。*

*Edit2：将[GetProcessTimes](http://msdn.microsoft.com/en-us/library/ms683223(VS.85).aspx)为您的进程返回的时间与实际执行时间进行比较。区别在于 CPU 花费在其他人身上的时间。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T13:44:14.780

最好的方法是使用专用的分析工具。那里有很多。我已经有几年没有使用过 C 语言了，希望其他人能够提供更好的建议。当您使用 Visual Studio 2005 时，这可能是一个不错的起点： [AQ](http://www.automatedqa.com/products/aqtime/)，但我从未使用过它。

# c# - 激活单实例应用程序的主窗体

> ID：51898
> 
> 赞同：9
> 
> 时间：2008-09-09T13:35:10.870
> 
> 标签：c#, .net, winforms

在 C# Windows Forms 应用程序中，我想检测该应用程序的另一个实例是否已在运行。如果是，则激活正在运行的实例的主窗体并退出该实例。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-09T13:37:27.137

Scott Hanselman详细[回答](http://www.hanselman.com/blog/TheWeeklySourceCode31SingleInstanceWinFormsAndMicrosoftVisualBasicdll.aspx)了您的问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-09T13:36:17.903

这是我目前在应用程序的 Program.cs 文件中所做的事情。

```
// Sets the window to be foreground
[DllImport("User32")]
private static extern int SetForegroundWindow(IntPtr hwnd);

// Activate or minimize a window
[DllImportAttribute("User32.DLL")]
private static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);
private const int SW_RESTORE = 9;

static void Main()
{
    try
    {
        // If another instance is already running, activate it and exit
        Process currentProc = Process.GetCurrentProcess();
        foreach (Process proc in Process.GetProcessesByName(currentProc.ProcessName))
        {
            if (proc.Id != currentProc.Id)
            {
                ShowWindow(proc.MainWindowHandle, SW_RESTORE);
                SetForegroundWindow(proc.MainWindowHandle);
                return;   // Exit application
            }
        }

        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());
    }
    catch (Exception ex)
    {
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T10:05:48.783

您可以使用此类检测并在其之后激活您的实例：

```
 // Detect existing instances
        string processName = Process.GetCurrentProcess().ProcessName;
        Process[] instances = Process.GetProcessesByName(processName);
        if (instances.Length > 1)
        {
            MessageBox.Show("Only one running instance of application is allowed");
            Process.GetCurrentProcess().Kill();
            return;
        }
        // End of detection 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-09T13:45:58.910

阿库，这是一个很好的资源。不久前我回答了一个与此类似的问题。你可以在这里查看我的[答案](https://stackoverflow.com/questions/19147/what-is-the-correct-way-to-create-a-single-instance-application#19326)。即使这是针对 WPF，您也可以在 WinForms 中使用相同的逻辑。

# visual-studio - 关于持续集成系统的建议

> ID：51925
> 
> 赞同：8
> 
> 时间：2008-09-09T13:47:10.060
> 
> 标签：visual-studio, svn, continuous-integration

我们目前正在评估与 Visual Studio 2008 (C#) 和 Subversion 交互的不同应用程序，以自动构建我们的核心库。我们希望每晚执行一次构建，并通过电子邮件将所做的更改列表发送给每个开发人员，或者将最新版本推送到每个工作站。您对这些工具有何经验？有什么建议？

* * *

**推荐软件**

*   [巡航控制.NET](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)
*   [哈德逊](http://hudson-ci.org/)
*   [团队城市](http://www.jetbrains.com/teamcity/)

**推荐文章**

*   [持续集成：从理论到实践第 2 版 (CC.net)](http://dotnet.org.za/cjlotz/archive/2008/01/15/continuous-integration-from-theory-to-practice-2nd-edition.aspx)
*   [使用 Hudson 自动化您的 ASP.NET 构建和部署过程](http://blogs.freshlogicstudios.com/Posts/View.aspx?Id=87a1c0f7-a75e-4f1a-8d3a-6c52c6ad9f46)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-09T13:49:54.517

Cruise Control.net (ccnet) 可以满足您的所有需求。它很容易使用，只要确保如果你要将它作为服务运行，你给它一个帐户并且不要让它作为网络服务运行，这样你就可以在 Intranet 盒子上赋予它权限并让它做xcopy 部署。

它具有各种电子邮件模式，失败时，全部，失败后修复等等。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-09T14:08:43.440

[Hudson](http://hudson-ci.org/)是我见过的最简单的持续集成/日常构建工具。不确定它是否满足您的所有要求。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-09T13:54:21.620

看看 JetBrain 的（ReSharper 背后的人）[TeamCity](http://www.jetbrains.com/teamcity/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T13:50:17.400

我已经将[cc.net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)与 nant 和 msbuild 一起使用并取得了巨大成功，强烈推荐它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-09T14:05:23.480

在我的上一个雇主，我用 cc.net 建立了一个构建服务器。预计至少需要一两天的时间来设置它。我将 cc.net 与 nant 和 msbuild 一起使用。这些项目在功能上有很多重叠，因此考虑如何设置所有内容可能是个好主意。

我最终解决的设置是服务器上的 cc.net 以从 subversion 中检索项目并启动 nant 脚本。nant 用于调用 msbuild 来构建 Visual Studio .sln 文件并执行所有其他构建步骤，例如运行测试等。

我也快速浏览了teamcity。乍一看，它看起来比 cc.net 好多了，但我还没有时间尝试。这当然值得一试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-09T14:32:52.307

我使用 CC.Net 以及 SubVersion 和 MSBuild 来完成此任务。[这](http://dotnet.org.za/cjlotz/archive/2008/01/15/continuous-integration-from-theory-to-practice-2nd-edition.aspx)是一个很好的实施指南，我发现它非常有帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T14:41:56.620

关于使用 cc.net 和 msbuild 的一些花絮。如果您正在构建 C/C+= 项目，那么 msbuild 至少在 VS 2005（可能更早）中是不可靠的。我没有用 VS 2008 测试过。我们发现有时 msbuild 可以正常工作，有时不能。在尝试解决该问题时，我们发现 vcbuild.exe 在构建 C/C++ 解决方案时似乎可以很好地代替 msbuild。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-28T21:16:25.260

如果您使用[trac](http://trac.edgewall.com)进行问题跟踪，则[bitten](http://bitten.edgewall.com)插件运行良好。它不是特定于平台的（我们在工作时在 Windows 和 Linux 上运行它，分别使用 msbuild/mstest 和 make/gcc/cpptest）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-06-20T07:31:07.817

我正在使用 hudsons Jenkins 进行日常构建。它真的很容易设置和维护。它有很多插件可以完全满足我们的要求。

# arrays - 如何检查groovy数组/哈希/集合/列表中的元素？

> ID：51927
> 
> 赞同：141
> 
> 时间：2008-09-09T13:47:51.790
> 
> 标签：arrays, list, groovy

如何判断数组是否包含元素？我认为可能有类似`[1, 2, 3].includes(1)`的东西会评估为`true`.

* * *

## 回答 #1

> 赞同：266
> 
> 时间：2008-09-15T10:09:55.413

一些语法糖

```
1 in [1,2,3] 
```

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2008-09-15T20:44:19.883

.contains() 是列表的最佳方法，但对于地图，您需要使用 .containsKey() 或 .containsValue()

```
[a:1,b:2,c:3].containsValue(3)
[a:1,b:2,c:3].containsKey('a') 
```

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2008-09-09T13:58:24.870

对于列表，使用`contains`：

```
[1,2,3].contains(1) == true 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-02T18:35:56.597

如果你真的想在 ArrayList 上包含方法，只需添加它：

```
ArrayList.metaClass.includes = { i -> i in delegate } 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-01-22T06:30:49.610

您可以使用 Membership 运算符：

```
def list = ['Grace','Rob','Emmy']
assert ('Emmy' in list) 
```

[会员运营商 Groovy](https://docs.groovy-lang.org/latest/html/documentation/#_membership_operator)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-12-31T18:20:33.317

在对象集合（例如域）上使用 .contains() 的重要问题。如果域声明包含 EqualsAndHashCode 或其他一些 equals() 实现以确定这些 Ojbect 是否相等，并且您已将其设置为...

```
import groovy.transform.EqualsAndHashCode
@EqualsAndHashCode(includes = "settingNameId, value") 
```

然后 .contains(myObjectToCompareTo) 将使用集合中每个对象实例的数据评估 myObjectToCompareTo 中的数据。因此，如果您的 equals 方法不符合标准，而我的方法不是，您可能会看到意想不到的结果。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-10-08T16:41:53.670

```
def fruitBag = ["orange","banana","coconut"]
def fruit = fruitBag.collect{item -> item.contains('n')} 
```

我是这样做的，所以如果有人正在寻找它，它就可以工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-23T14:43:31.693

您还可以将匹配项与正则表达式一起使用，如下所示：

```
boolean bool = List.matches("(?i).*SOME STRING HERE.*") 
```

# .net - 在构建服务器上运行 T4 模板时 System.Xml.Linq.XDocument 上的 TypeLoadException

> ID：51931
> 
> 赞同：0
> 
> 时间：2008-09-09T13:50:12.457
> 
> 标签：.net, t4, typeloadexception

我在构建服务器上使用 TextTransform.exe 运行 T4 模板时遇到问题。在我的开发机器上，模板完美运行。错误信息如下。

> 错误：运行转换：System.TypeLoadException：无法实例化类型 System.Xml.Linq.XDocument

构建服务器上有 Windows 2008 SDK，我的机器有 VS 2008。我认为它可能找不到 System.Data.Xml，所以我确保 dll 存在于同一目录中，但没有运气。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-09T13:55:41.397

听起来您的服务器可能没有安装 .NET 3.5。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-09T16:35:11.810

我安装了 .NET 3.5 SP1 并解决了问题

# excel - 如何在 Excel 中创建状态对话框

> ID：51941
> 
> 赞同：3
> 
> 时间：2008-09-09T13:54:58.763
> 
> 标签：excel, vba

我在 Excel 中创建了一个数据库报告生成器。我正在尝试创建一个对话框，在程序运行时显示状态信息。

当我生成报告时，虽然出现了对话框，但我无法刷新/更新它显示的信息。大多数情况下，对话框仅部分显示。我曾尝试使用 .repaint 方法，但仍然得到相同的结果。在生成报告后，我只看到完整的对话框。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-09T13:58:36.523

我使用 Excel 自己的状态栏（在窗口左下方）来显示我过去开发的类似应用程序的进度信息。

如果您只想显示进度的文本更新，它会非常有效，并且根本不需要更新对话框。

好的@JonnyGold，这是我使用的那种东西的一个例子......

```
Sub StatusBarExample()
    Application.ScreenUpdating = False 
    ' turns off screen updating
    Application.DisplayStatusBar = True 
    ' makes sure that the statusbar is visible
    Application.StatusBar = "Please wait while performing task 1..."
    ' add some code for task 1 that replaces the next sentence
    Application.Wait Now + TimeValue("00:00:02")
    Application.StatusBar = "Please wait while performing task 2..."
    ' add some code for task 2 that replaces the next sentence
    Application.Wait Now + TimeValue("00:00:02")
    Application.StatusBar = False 
    ' gives control of the statusbar back to the programme
End Sub 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-09T13:59:46.410

尝试在循环中添加**DoEvents**调用。这应该允许表单重新绘制并接受其他请求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-18T12:15:56.787

下面的代码在 Excel（XP 或更高版本）中执行操作时效果很好。

对于在 Excel 之外发生的操作，例如连接到数据库和检索数据，最好的方法是在操作之前和之后显示对话框（例如*“获取数据”*、*“获取数据”*）

创建一个名为**"frmStatus"**的表单，在表单上放置一个名为**"Label1"**的标签。

设置表单属性**'ShowModal' = false**，这允许代码在显示表单时运行。

```
Sub ShowForm_DoSomething()

    Load frmStatus
    frmStatus.Label1.Caption = "Starting"
    frmStatus.Show
    frmStatus.Repaint
'Load the form and set text

    frmStatus.Label1.Caption = "Doing something"
    frmStatus.Repaint

'code here to perform an action

    frmStatus.Label1.Caption = "Doing something else"
    frmStatus.Repaint

'code here to perform an action

    frmStatus.Label1.Caption = "Finished"
    frmStatus.Repaint
    Application.Wait (Now + TimeValue("0:00:01"))
    frmStatus.Hide
    Unload frmStatus
'hide and unload the form

End Sub 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-22T04:16:25.387

在您的工作簿中插入一张空白工作表重命名工作表，例如。“信息”

```
Sheets("information").Select
Range("C3").Select
ActiveCell.FormulaR1C1 = "Updating Records"
Application.ScreenUpdating = False
Application.Wait Now + TimeValue("00:00:02") 
```

*继续宏*

```
Sheets("information").Select
Range("C3").Select
Application.ScreenUpdating = True
ActiveCell.FormulaR1C1 = "Preparing Information"
Application.ScreenUpdating = False
Application.Wait Now + TimeValue("00:00:02") 
```

*继续宏*

等等 或者在现有工作表的某处选择一个空白单元格，而不是插入新工作表

```
Range("C3").Select
ActiveCell.FormulaR1C1 = "Updating Records"
Application.ScreenUpdating = False
Application.Wait Now + TimeValue("00:00:02") 
```

ETC

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-09T13:56:56.637

该对话框也在同一个 UI 线程上运行。所以，它太忙了，无法重新粉刷自己。不确定 VBA 是否具有良好的多线程功能。

# c++ - 你知道编辑/翻译资源（.rc）文件的好程序吗？

> ID：51948
> 
> 赞同：8
> 
> 时间：2008-09-09T13:57:24.357
> 
> 标签：c++, windows, visual-studio, mfc, internationalization

我正在多语言环境中构建 C++/MFC 程序。我有一种主要（国家）语言和三种国际语言。每次我向程序添加功能时，我都必须使国际语言与国内语言保持同步。Visual Studio 中的资源编辑器不是很有帮助，因为我经常会留下未翻译的字符串、对话框等。

我想知道你们是否知道可以编辑资源（.rc）文件和

*   构建一个文件，其中仅包含要翻译的字符串及其各自的 ID，并接受另一种语言的相同（或相似）文件（这将很有帮助，因为通常翻译是由其他人完成的），或者
*   处理翻译本身，允许同时查看不同语言的相同字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T16:06:31.093

你可以看看 Sisulizer [http://www.sisulizer.com](http://www.sisulizer.com)。虽然很贵。我们正在评估它是否可以在我的公司使用，以管理正在进行的翻译的头痛。我在他们的关于页面上读到该公司是由离开 Multilizer 和其他类似公司的人创立的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T11:24:50.077

查看[appTranslator](http://www.apptranslator.com/)，它相对便宜且效果很好。开发它的人对增强请求和错误报告非常敏感，所以你得到了很好的支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-15T18:14:03.800

这是我用来生成资源文件以进行不同语言测试的脚本。它只是解析来自 babelfish 的响应，因此翻译的质量与醉酒猴子所做的一样高，但它对于测试等很有用

* * *

```
for i in $trfile
do
    key=`echo $i | sed 's/^\(.*\)=\(.*\)$/\1/g'`
    value=`echo $i | sed 's/^\(.*\)=\(.*\)$/\2/g'`
    url="http://babelfish.altavista.com/tr?doit=done&intl=1&tt=urltext&lp=$langs&btnTrTxt=Translate&trtext=$value"
    wget -O foo.html -A "$agent" "$url" *&> /dev/null
    tx=`grep "<td bgcolor=white class=s><div style=padding:10px;>" foo.html`
    tx=`echo $tx | iconv -f latin1 -t utf-8 | sed 's/<td bgcolor=white class=s><div style=padding:10px;>\(.*\)<\/div><\/td>/\1/g'`
    echo $key=$tx
done

rm foo.html 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T06:21:42.280

查看[Lingobit Localizer](http://www.lingobit.com/)。昂贵，但非常值得。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-13T03:51:46.730

根据我的经验，国际化需要的不仅仅是翻译字符串。许多字符串在翻译时需要更多的对话框空间。因此，能够为每种语言自定义对话框很有用。否则，您必须为翻译后的字符串创建带有额外空间的对话框，这样在以英语显示时看起来不太理想。

很久以前，我正在为 MFC 应用程序使用翻译工具，但生产该软件的公司停止销售它。当我试图找到价格合理的替代品时，我没有找到。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T22:12:27.167

我们正在使用 Multilizer ( [http://www.multilizer.com/](http://www.multilizer.com/) )，虽然有时使用起来有点棘手，但最后有点耐心，它工作得很好。

我们甚至有一个翻译网站，翻译人员可以下载我们的项目，然后使用 Multilizer 命令行功能上传翻译。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-09T17:34:49.060

如果没有，则很容易遍历资源中的所有字符串并将它们与国际资源进行比较。你可以用一个简单的网格来做到这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T05:12:27.620

最后，我们最终构建了自己的外部工具来管理它。我们的开发人员在英语字符串表中工作，每个自动构建都会将我们添加/更改和删除的字符串发送给翻译管理器。他还可以随时从旧版本运行报告，以确定翻译所需的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-13T05:16:02.360

查看[RC-WinTrans](http://www.schaudin.com/web/Home.aspx)。它是我公司使用的商业工具。它基本上将我们的 .RC 文件（或 .resx 文件）导入数据库，然后我们将其发送到不同的办公室进行翻译。然后，该工具可以从数据库中为每种语言导出翻译的 .RC 文件（或 .resx 文件）。它甚至有一个基本的对话框编辑器，因此翻译人员可以调整对话框中各种控件的大小，以确保翻译的文本适合。

它还接受许多命令行参数并具有 COM 自动化接口，因此您可以更轻松地将其集成到构建过程中。它对我们来说效果很好，我们实际上有成千上万的字符串和对话框等。

（我们目前有版本 7，所以我所说的可能与他们最新的版本 8 有点不同。）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T08:38:38.700

也可以试试 AppTranslator： http: [//www.apptranslator.com/](http://www.apptranslator.com/)。它有一个内置的资源编辑器，例如，翻译人员可以在需要时放大一个文本框。它为开发人员和翻译人员提供单独的版本等等。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-19T15:21:47.027

使用 .rc 文件和 Visual Studio 管理本地化和翻译并不是一个好主意。通过 exe 开始本地化要聪明得多（尽管违反直觉）。在这里阅读原因： http: [//www.apptranslator.com/misconceptions.html](http://www.apptranslator.com/misconceptions.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-08-23T23:12:58.183

我最近写了这个，它集成到 VS 中：

[https://github.com/ekkis/Powershell/blob/master/MT.ps1](https://github.com/ekkis/Powershell/blob/master/MT.ps1)

主要是因为我对那里的解决方案不满意。您需要从 M$ 获取客户 ID（但他们免费为您提供 200 万字/月的翻译 - 还不错）

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-20T14:42:20.903

[ResxCrunch](http://resxcrunch.com)即将推出，它将在一个表中编辑多种语言的多个资源文件。

# c++ - 如何从 C++ 中的字符串获取文件扩展名

> ID：51949
> 
> 赞同：90
> 
> 时间：2008-09-09T13:57:34.107
> 
> 标签：c++, string, filenames, file-extension

给定一个字符串`"filename.conf"`，我如何验证扩展部分？

我需要一个跨平台的解决方案。

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2008-09-09T14:23:01.410

这是不是太简单的解决方案？

```
#include <iostream>
#include <string>

int main()
{
  std::string fn = "filename.conf";
  if(fn.substr(fn.find_last_of(".") + 1) == "conf") {
    std::cout << "Yes..." << std::endl;
  } else {
    std::cout << "No..." << std::endl;
  }
} 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-09T14:20:06.003

最好的方法是不编写任何代码，而是调用现有方法。在 Windows 中，[PathFindExtension](http://msdn.microsoft.com/en-us/library/bb773587(VS.85).aspx "路径查找扩展")方法可能是最简单的。

那你为什么不自己写呢？

好吧，以 strrchr 为例，当您在以下字符串“c:\program files\AppleGate.Net\readme”上使用该方法时会发生什么？“.Net\readme”是扩展名吗？编写适用于一些示例案例的东西很容易，但编写适用于所有案例的东西可能要困难得多。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-09-09T14:27:16.157

您必须确保处理多于一个点的文件名。示例：`c:\.directoryname\file.name.with.too.many.dots.ext`不会被`strchr`or正确处理`find.`

我最喜欢的是具有扩展（路径）功能的[boost 文件系统库](http://www.boost.org/doc/libs/release/libs/filesystem/index.html)

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-09T14:20:02.947

假设您可以访问 STL：

```
std::string filename("filename.conf");
std::string::size_type idx;

idx = filename.rfind('.');

if(idx != std::string::npos)
{
    std::string extension = filename.substr(idx+1);
}
else
{
    // No extension found
} 
```

**编辑：**这是一个跨平台解决方案，因为您没有提到平台。如果您专门使用 Windows，则需要利用线程中其他人提到的 Windows 特定功能。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2012-10-09T02:46:37.127

其他人提到了提升，但我只是想添加实际的代码来做到这一点：

```
#include <boost/filesystem.hpp>
using std::string;
string texture         = foo->GetTextureFilename();
string file_extension  = boost::filesystem::extension(texture);
cout << "attempting load texture named " << texture
     << "    whose extensions seems to be " 
     << file_extension << endl;
// Use JPEG or PNG loader function, or report invalid extension 
```

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2018-06-15T19:28:58.903

使用 C++17 及其[`std::filesystem::path::extension`](http://en.cppreference.com/w/cpp/filesystem/path/extension)（该库是 boost::filesystem 的继承者），您将使您的语句比使用 eg 更具表现力`std::string`。

```
#include <iostream>
#include <filesystem> // C++17
namespace fs = std::filesystem;

int main()
{
    fs::path filePath = "my/path/to/myFile.conf";
    if (filePath.extension() == ".conf") // Heed the dot.
    {
        std::cout << filePath.stem() << " is a valid type."; // Output: "myFile is a valid type."
    }
    else
    {
        std::cout << filePath.filename() << " is an invalid type."; // Output: e.g. "myFile.cfg is an invalid type"
    }
} 
```

另见[std::filesystem::path::stem](http://en.cppreference.com/w/cpp/filesystem/path/stem)、[std::filesystem::path::filename](http://en.cppreference.com/w/cpp/filesystem/path/filename)。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2010-12-22T03:30:11.947

实际上 STL 可以在没有太多代码的情况下做到这一点，我建议你了解一下 STL，因为它可以让你做一些花哨的事情，无论如何这就是我使用的。

```
std::string GetFileExtension(const std::string& FileName)
{
    if(FileName.find_last_of(".") != std::string::npos)
        return FileName.substr(FileName.find_last_of(".")+1);
    return "";
} 
```

如果找不到将返回“”的扩展名，此解决方案将始终返回扩展名，即使在“this.abcdesmp3”之类的字符串上也是如此。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-07-30T10:26:03.017

其实最简单的方法是

```
char* ext;
ext = strrchr(filename,'.') 
```

要记住的一件事：如果`'.'`文件名中不存在，则 ext 将是`NULL`.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-11-17T11:26:13.373

我自己今天偶然发现了这个问题，即使我已经有了一个工作代码，但我发现它在某些情况下不起作用。

虽然有些人已经建议使用一些外部库，但我更喜欢编写自己的代码用于学习目的。

一些答案包括我最初使用的方法（寻找最后一个“。”），但我记得在linux上隐藏文件/文件夹以“。”开头。因此，如果文件文件被隐藏并且没有扩展名，则整个文件名将被用作扩展名。为了避免这种情况，我写了这段代码：

```
bool getFileExtension(const char * dir_separator, const std::string & file, std::string & ext)
{
    std::size_t ext_pos = file.rfind(".");
    std::size_t dir_pos = file.rfind(dir_separator);

    if(ext_pos>dir_pos+1)
    {
        ext.append(file.begin()+ext_pos,file.end());
        return true;
    }

    return false;
} 
```

我还没有完全测试过，但我认为它应该可以工作。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2015-05-02T17:14:11.360

我会选择[`boost::filesystem::extension`](http://www.boost.org/doc/libs/1_58_0/libs/filesystem/doc/reference.html#path-extension)（[`std::filesystem::path::extension`](https://en.cppreference.com/w/cpp/filesystem/path/extension)使用 C++17），但如果你不能使用 Boost 而你只需要验证扩展，一个简单的解决方案是：

```
bool ends_with(const std::string &filename, const std::string &ext)
{
  return ext.length() <= filename.length() &&
         std::equal(ext.rbegin(), ext.rend(), filename.rbegin());
}

if (ends_with(filename, ".conf"))
{ /* ... */ } 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-09T14:03:36.807

```
_splitpath, _wsplitpath, _splitpath_s, _wsplitpath_w 
```

这仅适用于 Windows（平台 SDK）

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-12-13T21:34:53.073

使用 std::string 的 find/rfind 可以解决这个问题，但是如果您经常使用路径，那么您应该查看 boost::filesystem::path ，因为它会使您的代码比摆弄原始字符串索引/迭代器更干净。

我建议提升，因为它是一个高质量、经过良好测试、（开源和商业）免费且完全可移植的库。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-01-23T23:49:40.923

对于 char 数组类型的字符串，您可以使用：

```
#include <ctype.h>
#include <string.h>

int main()
{
    char filename[] = "apples.bmp";
    char extension[] = ".jpeg";

    if(compare_extension(filename, extension) == true)
    {
        // .....
    } else {
        // .....
    }

    return 0;
}

bool compare_extension(char *filename, char *extension)
{
    /* Sanity checks */

    if(filename == NULL || extension == NULL)
        return false;

    if(strlen(filename) == 0 || strlen(extension) == 0)
        return false;

    if(strchr(filename, '.') == NULL || strchr(extension, '.') == NULL)
        return false;

    /* Iterate backwards through respective strings and compare each char one at a time */

    for(int i = 0; i < strlen(filename); i++)
    {
        if(tolower(filename[strlen(filename) - i - 1]) == tolower(extension[strlen(extension) - i - 1]))
        {
            if(i == strlen(extension) - 1)
                return true;
        } else
            break;
    }

    return false;
} 
```

除了文件名之外，还可以处理文件路径。适用于 C 和 C++。并且跨平台。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2011-07-25T20:05:31.170

使用 System::String 的 NET/CLI 版本

```
 System::String^ GetFileExtension(System::String^ FileName)
   {
       int Ext=FileName->LastIndexOf('.');
       if( Ext != -1 )
           return FileName->Substring(Ext+1);
       return "";
   } 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-11-08T22:49:49.370

好的答案，但我看到他们中的大多数都有一些问题：首先，我认为一个好的答案应该适用于具有路径标题的完整文件名，它也应该适用于 linux 或 windows，或者如上所述它应该是跨平台的。对于大多数答案；如果文件名没有扩展名但路径中包含点的文件夹名，则该函数将无法返回正确的扩展名：一些测试用例的示例如下：

```
 const char filename1 = {"C:\\init.d\\doc"}; // => No extention
    const char filename2 = {"..\\doc"}; //relative path name => No extention
    const char filename3 = {""}; //emputy file name => No extention
    const char filename4 = {"testing"}; //only single name => No extention
    const char filename5 = {"tested/k.doc"}; // normal file name => doc
    const char filename6 = {".."}; // parent folder => No extention
    const char filename7 = {"/"}; // linux root => No extention
    const char filename8 = {"/bin/test.d.config/lx.wize.str"}; // ordinary path! => str 
```

对于 filename1 和 filename4，“ *brian newman ”建议将失败。*对于 filename1，大多数基于反向查找的其他答案都将失败。我建议在您的源代码中包含以下方法：这是函数返回扩展名的第一个字符的索引或给定字符串的长度（如果未找到）。

```
size_t find_ext_idx(const char* fileName)
{
    size_t len = strlen(fileName);
    size_t idx = len-1;
    for(size_t i = 0; *(fileName+i); i++) {
        if (*(fileName+i) == '.') {
            idx = i;
        } else if (*(fileName + i) == '/' || *(fileName + i) == '\\') {
            idx = len - 1;
        }
    }
    return idx+1;
} 
```

您可以在您的 c++ 应用程序中使用上面的代码，如下所示：

```
std::string get_file_ext(const char* fileName)
{
    return std::string(fileName).substr(find_ext_idx(fileName));
} 
```

最后一点在某些情况下，a 文件夹被赋予文件名作为参数，并在文件夹名称中包含一个点，该函数将返回文件夹的点尾，因此最好首先让用户检查给定的名称是文件名而不是文件夹名称。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-08-19T20:03:06.383

我使用这两个函数来获取*扩展名*和*不带扩展名*的文件名：

```
std::string fileExtension(std::string file){

    std::size_t found = file.find_last_of(".");
    return file.substr(found+1);

}

std::string fileNameWithoutExtension(std::string file){

    std::size_t found = file.find_last_of(".");
    return file.substr(0,found);    
} 
```

这些`regex`方法针对某些额外要求：

```
std::string fileExtension(std::string file){

    std::regex re(".*[^\\.]+\\.([^\\.]+$)");
    std::smatch result;
    if(std::regex_match(file,result,re))return result[1];
    else return "";

}

std::string fileNameWithoutExtension(std::string file){

    std::regex re("(.*[^\\.]+)\\.[^\\.]+$");
    std::smatch result;
    if(std::regex_match(file,result,re))return result[1];
    else return file;

} 
```

正则表达式方法满足的额外要求：

1.  如果*文件名*是这样`.config`或类似的，*扩展*名将是一个空字符串，*没有扩展名的文件*名将是`.config`.
2.  如果文件名没有任何扩展名，则扩展名将是一个空字符串，*没有扩展名*的文件名将是*文件名*不变。

* * *

**编辑：**

额外的要求也可以通过以下方式来满足：

```
std::string fileExtension(const std::string& file){
    std::string::size_type pos=file.find_last_of('.');
    if(pos!=std::string::npos&&pos!=0)return file.substr(pos+1);
    else return "";
}

std::string fileNameWithoutExtension(const std::string& file){
    std::string::size_type pos=file.find_last_of('.');
    if(pos!=std::string::npos&&pos!=0)return file.substr(0,pos);
    else return file;
} 
```

**笔记：**

在上述函数中只传递文件名（而不是路径）。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-08-19T21:20:33.447

这是我想出的解决方案。然后，我注意到它与@serengeor 发布的内容相似。

它与`std::string`and一起使用`find_last_of`，但如果修改为使用`char`数组 and ，基本思想也将起作用`strrchr`。它处理隐藏文件和代表当前目录的额外点。它独立于平台。

```
string PathGetExtension( string const & path )
{
  string ext;

  // Find the last dot, if any.
  size_t dotIdx = path.find_last_of( "." );
  if ( dotIdx != string::npos )
  {
    // Find the last directory separator, if any.
    size_t dirSepIdx = path.find_last_of( "/\\" );

    // If the dot is at the beginning of the file name, do not treat it as a file extension.
    // e.g., a hidden file:  ".alpha".
    // This test also incidentally avoids a dot that is really a current directory indicator.
    // e.g.:  "alpha/./bravo"
    if ( dotIdx > dirSepIdx + 1 )
    {
      ext = path.substr( dotIdx );
    }
  }

  return ext;
} 
```

单元测试：

```
int TestPathGetExtension( void )
{
  int errCount = 0;

  string tests[][2] = 
  {
    { "/alpha/bravo.txt", ".txt" },
    { "/alpha/.bravo", "" },
    { ".alpha", "" },
    { "./alpha.txt", ".txt" },
    { "alpha/./bravo", "" },
    { "alpha/./bravo.txt", ".txt" },
    { "./alpha", "" },
    { "c:\\alpha\\bravo.net\\charlie.txt", ".txt" },
  };

  int n = sizeof( tests ) / sizeof( tests[0] );

  for ( int i = 0; i < n; ++i )
  {
    string ext = PathGetExtension( tests[i][0] );
    if ( ext != tests[i][1] )
    {
      ++errCount;
    }
  }

  return errCount;
} 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-01-26T22:08:19.140

您可以使用**strrchr()**查找最后出现的 .(dot) 并获取基于 .(dot) 的扩展文件。例如检查下面的代码。

```
#include<stdio.h>

void GetFileExtension(const char* file_name) {

    int ext = '.';
    const char* extension = NULL;
    extension = strrchr(file_name, ext);

    if(extension == NULL){
        printf("Invalid extension encountered\n");
        return;
    }

    printf("File extension is %s\n", extension);
}

int main()
{
    const char* file_name = "c:\\.directoryname\\file.name.with.too.many.dots.ext";
    GetFileExtension(file_name);
    return 0;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-05-11T07:56:33.820

尝试使用[strstr](http://www.cplusplus.com/reference/clibrary/cstring/strstr/)

```
char* lastSlash;
lastSlash = strstr(filename, "."); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-08-07T10:13:12.187

或者你可以使用这个：

```
 char *ExtractFileExt(char *FileName)
    {
        std::string s = FileName;
        int Len = s.length();
        while(TRUE)
        {
            if(FileName[Len] != '.')
                Len--;
            else
            {
                char *Ext = new char[s.length()-Len+1];
                for(int a=0; a<s.length()-Len; a++)
                    Ext[a] = FileName[s.length()-(s.length()-Len)+a];
                Ext[s.length()-Len] = '\0';
                return Ext;
            }
        }
    } 
```

此代码是跨平台的

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-03-02T11:03:54.327

如果你使用 Qt 库，你可以试试[QFileInfo](http://qt-project.org/doc/qt-4.8/qfileinfo.html)的[suffix()](http://qt-project.org/doc/qt-4.8/qfileinfo.html#suffix)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-04-28T16:51:00.783

这是一个将路径/文件名作为字符串并将扩展名作为字符串返回的函数。它都是标准的 c++，并且应该适用于大多数平台的跨平台。

与此处的其他几个答案不同，它根据 PathFindExtensions 的文档处理 Windows 的 PathFindExtension 处理的奇怪情况。

```
wstring get_file_extension( wstring filename )
{
    size_t last_dot_offset = filename.rfind(L'.');
    // This assumes your directory separators are either \ or /
    size_t last_dirsep_offset = max( filename.rfind(L'\\'), filename.rfind(L'/') );

    // no dot = no extension
    if( last_dot_offset == wstring::npos )
        return L"";

    // directory separator after last dot = extension of directory, not file.
    // for example, given C:\temp.old\file_that_has_no_extension we should return "" not "old"
    if( (last_dirsep_offset != wstring::npos) && (last_dirsep_offset > last_dot_offset) )
        return L"";

    return filename.substr( last_dot_offset + 1 );
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-12-17T10:59:05.337

如果您将扩展名视为最后一个点以及它后面的可能字符，但前提是它们不包含目录分隔符，则以下函数返回扩展名起始索引，如果未找到扩展名，则返回 -1。当你拥有它时，你可以做任何你想做的事情，比如剥离扩展名、更改它、检查它等。

```
long get_extension_index(string path, char dir_separator = '/') {
    // Look from the end for the first '.',
    // but give up if finding a dir separator char first
    for(long i = path.length() - 1; i >= 0; --i) {
        if(path[i] == '.') {
            return i;
        }
        if(path[i] == dir_separator) {
            return -1;
        }
    }
    return -1;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-01-20T17:24:16.507

我使用 PathFindExtension() 函数来知道它是否是一个有效的 tif 文件。

```
#include <Shlwapi.h>
bool A2iAWrapperUtility::isValidImageFile(string imageFile)
{
    char * pStrExtension = ::PathFindExtension(imageFile.c_str());

    if (pStrExtension != NULL && strcmp(pStrExtension, ".tif") == 0)
    {
        return true;
    }

    return false;
} 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2015-11-16T06:46:55.667

如果你碰巧使用[Poco](http://pocoproject.org/)库，你可以这样做：

```
#include <Poco/Path.h>

...

std::string fileExt = Poco::Path("/home/user/myFile.abc").getExtension(); // == "abc" 
```

# .net - 如何允许程序集（单元测试）访问另一个程序集的内部属性？

> ID：51950
> 
> 赞同：81
> 
> 时间：2008-09-09T13:58:03.153
> 
> 标签：.net, unit-testing

我希望我的核心程序集不公开某个类，并且我仍然希望能够对其进行测试。我怎样才能做到这一点 ？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-09-09T13:59:55.380

[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute(VS.80).aspx)属性来救援！

只需添加：

```
[assembly:InternalsVisibleToAttribute("UnitTestAssemblyName")] 
```

到您的核心类 AssemblyInfo.cs 文件

有关最佳实践，请参阅[Friend Assemblies（C# 编程指南） 。](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/assemblies-gac/friend-assemblies)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-09T14:17:10.520

如果您的程序集被强命名，则使用 InternalsVisible 您需要指定公钥（注意：完整密钥**不是**公钥令牌）例如...

```
[assembly: System.Runtime.CompilerServices.InternalsVisibleTo("BoardEx_BusinessObjects.Tests, 
  PublicKey=0024000004800000940000000602000000240000525341310004000001000100fb3a2d8 etc etc")] 
```

以下技巧对于在不使用 cmd 行的情况下获取公钥非常有用...

[http://www.andrewconnell.com/blog/archive/2006/09/15/4587.aspx](http://www.andrewconnell.com/blog/archive/2006/09/15/4587.aspx)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-09T15:40:21.177

我将我的单元测试与它正在测试的代码放在同一个程序集中。这对我来说是有道理的，因为我认为“测试自己”是课程的一个特征，以及“初始化自己”和“描述自己”之类的东西。

我听到了一些反对这种方法的声音，但其中很少有人有说服力。

**它伤害了性能**呸，我说！没有硬数据就不要优化！也许如果您计划通过慢速链接下载程序集，那么最小化程序集大小是值得的。

**这是一个安全风险**。仅当您的测试中有秘密时。不要那样做。

现在，你的情况和我的不同，所以也许它对你有意义，也许它不会。你必须自己弄清楚。

另外：在 C# 中，我曾经尝试将我的单元测试放在一个名为“Tests”的类中，该类嵌套在它正在测试的类中。这使得事情的正确组织变得显而易见。它还避免了当“Foo”类的测试在名为“FooTests”的类中时发生的名称重复。但是，我可以访问的单元测试框架拒绝接受未标记为“公开”的测试。这意味着您正在测试的课程不能是“私人的”。我想不出任何充分的理由要求测试是“公共的”，因为没有人真正将它们称为公共方法——一切都是通过反射来实现的。如果您曾经为 .Net 编写过单元测试框架，请考虑允许非公开测试，看在我的份上！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-09T14:32:26.177

我建议不要这么麻烦......如果你真的想对你的“内部”类进行单元测试，只需将它们隐藏在一个只有你的内部代码最终会使用的命名空间中。除非您正在编写一个 .NET 框架规模的框架，否则您实际上并不**需要**那种级别的隐藏。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-09T14:01:33.880

您可以使用反射（就像 MS 测试项所做的那样），或者您可以将单元测试程序集声明为核心程序集的朋友。

另一种选择是将单元测试放在同一个程序集中。

# c# - 如何从查询字符串中删除项目以进行重定向？

> ID：51964
> 
> 赞同：8
> 
> 时间：2008-09-09T14:03:13.673
> 
> 标签：c#, asp.net, webforms

在我的基本页面中，我需要从查询字符串中删除一个项目并重定向。我无法使用

```
Request.QueryString.Remove("foo") 
```

因为该集合是只读的。有没有办法在不遍历集合并重新构建它的情况下获取查询字符串（除了那个项目）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-10-27T19:05:57.617

您可以通过处理原始查询字符串的副本来避免触及原始查询字符串。然后，您可以将页面重定向到包含修改后的查询字符串的 url，如下所示：

```
 var nvc = new NameValueCollection();

    nvc.Add(HttpUtility.ParseQueryString(Request.Url.Query));

    nvc.Remove("foo");

    string url = Request.Url.AbsolutePath;

    for (int i = 0; i < nvc.Count; i++)
        url += string.Format("{0}{1}={2}", (i == 0 ? "?" : "&"), nvc.Keys[i], nvc[i]);

    Response.Redirect(url); 
```

**更新：**

事实证明，我们可以像这样简化代码：

```
 var nvc = HttpUtility.ParseQueryString(Request.Url.Query);

    nvc.Remove("foo");

    string url = Request.Url.AbsolutePath + "?" + nvc.ToString();

    Response.Redirect(url); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-09T14:21:42.223

您必须重建 url 然后重定向。像这样的东西：

```
string url = Request.RawUrl;

NameValueCollection params = Request.QueryString;
for (int i=0; i<params.Count; i++)
{
    if (params[i].GetKey(i).ToLower() == "foo")
    {
        url += string.Concat((i==0 ? "?" : "&"), params[i].GetKey(i), "=", params.Get(i));
    }
}
Response.Redirect(url); 
```

无论如何，我没有测试它或任何东西，但它应该可以工作（或者至少让你朝着正确的方向前进）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-09T14:14:58.620

```
Response.Redirect(String.Format("nextpage.aspx?{0}", Request.QueryString.ToString().Replace("foo", "mangledfoo"))); 
```

我快速破解，节省你一点。但是 foo 不会出现在 nextpge.aspx 中等待它的代码:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-09T14:26:10.917

有趣的问题。我没有看到任何真正可行的替代手动复制集合的方法，因为*CopyTo*只允许您获取值（而不是键）。

我认为[HollyStyles 的 Hack](https://stackoverflow.com/questions/51964/how-do-i-remove-items-from-the-query-string-for-redirection#51981)会起作用（尽管我会担心在 QueryString 中放置一个 Replace - obv。取决于用例），但有一件事困扰着我。

**如果目标页面没有读取它，为什么需要从 QueryString 中删除它？**

它会被忽略吗？

如果做不到这一点，我认为您只需要咬紧牙关并创建一个 util 方法来为您更改集合。

### 更新 - 来自 OP 的回应

啊啊啊！我现在明白了，是的，我在使用 SiteMap 对字符串进行完整比较时遇到了类似的问题。

由于更改其他源代码（即搜索）是不可能的，我可能会说最好对字符串进行替换。虽然公平地说，如果您经常遇到类似的代码，同样可以快速设置一个实用函数来克隆集合，并从中过滤出一组值。

这样您就不必再担心此类问题了:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-17T14:52:26.557

`HttpUtility.ParseQueryString(Request.Url.Query)`回报是`QueryStringValueCollection`。它继承自`NameValueCollection`.

```
 var qs = HttpUtility.ParseQueryString(Request.Url.Query);
    qs.Remove("foo"); 

    string url = "~/Default.aspx"; 
    if (qs.Count > 0)
       url = url + "?" + qs.ToString();

    Response.Redirect(url); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-09T15:15:33.420

> **搜索页面将“&terms=”附加到查询字符串以突出显示，因此它搞砸了。**

只有其他选项是正则表达式替换。如果您*确定*&terms 位于集合的中间某处，请将尾随 & 留在正则表达式中，如果您*确定*它在末尾，则删除尾随 & 并将替换字符串“&”更改为 String.Empty

```
Response.Redirect(String.Format("nextpage.aspx?{0}", Regex.Replace(Request.QueryString.ToString(), "&terms=.*&", "&")); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-18T23:27:02.910

`Request.Url.GetLeftPart(UriPartial.Path)`应该这样做

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-02T10:44:55.227

我发现这是一个更优雅的解决方案

```
var qs = HttpUtility.ParseQueryString(Request.QueryString.ToString());
qs.Remove("item");
Console.WriteLine(qs.ToString()); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-29T12:56:30.537

这是一个使用 LINQ 的解决方案，`Request.QueryString`它允许在需要时对 qs 参数进行复杂过滤。

下面的示例显示我过滤掉`uid`参数以创建一个准备好重定向的相对 url。

前：`http://www.domain.com/home.aspx?color=red&uid=1&name=bob`

后：`~/home.aspx?color=red&name=bob`

**从 url 中删除 QS 参数**

```
var rq = this.Request.QueryString;
var qs = string.Join("&", rq.Cast<string>().Where(k => k != "uid").Select(k => string.Format("{0}={1}", k, rq[k])).ToArray());
var url = string.Concat("~", Request.RawUrl.Split('?')[0], "?", qs); 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-09T14:17:34.403

您可以克隆集合，然后重定向到包含克隆（和修改）集合的页面吗？

我知道这并不比迭代好多少……

# sql-server - 如何检测 READ_COMMITTED_SNAPSHOT 是否启用？

> ID：51969
> 
> 赞同：136
> 
> 时间：2008-09-09T14:07:11.823
> 
> 标签：sql-server, isolation-level, read-committed-snapshot

在 Microsoft SQL Server 中，有没有办法检测数据库是否通过 T-SQL 命令设置了其隔离级别`ALTER DATABASE <database> SET READ_COMMITTED_SNAPSHOT ON;`？

我找不到在 T-SQL 或通过 Management Studio 的 GUI 中检测到这一点的简单方法。

* * *

## 回答 #1

> 赞同：204
> 
> 时间：2008-09-09T14:10:50.580

```
SELECT is_read_committed_snapshot_on FROM sys.databases 
WHERE name= 'YourDatabase' 
```

返回值：

*   **1**：`READ_COMMITTED_SNAPSHOT`选项为**ON**。隔离级别下的读操作`READ COMMITTED`基于快照扫描，不获取锁。
*   **0**（默认）：`READ_COMMITTED_SNAPSHOT`选项为**OFF**。`READ COMMITTED`隔离级别下的读操作使用[共享（S）锁](https://docs.microsoft.com/en-us/previous-versions/sql/sql-server-2008-r2/ms175519(v=sql.105))。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-07-09T22:58:29.427

1.  根据[DBCC USEROPTIONS (Transact-SQL)](https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-useroptions-transact-sql)：

> 当数据库选项 READ_COMMITTED_SNAPSHOT 设置为 ON 并且事务隔离级别设置为“已提交读”时，DBCC USEROPTIONS 报告“已提交读快照”的隔离级别。实际的隔离级别是读提交的。

2.  同样在 SQL Server Management Studio 中，在 Options->Miscellaneous 下的数据库属性中，有“Is Read Committed Snapshot On”选项状态

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-06T03:44:31.637

SQL2005 和 2012 都没有`DBCC USEROPTIONS`显示`is_read_committed_snapshot_on`：

```
Set Option  Value
textsize    2147483647
language    us_english
dateformat  mdy
datefirst   7
lock_timeout    -1
quoted_identifier   SET
arithabort  SET
ansi_null_dflt_on   SET
ansi_warnings   SET
ansi_padding    SET
ansi_nulls  SET
concat_null_yields_null SET
isolation level read committed 
```

# iphone - 跨平台移动开发做了哪些工作？

> ID：51988
> 
> 赞同：89
> 
> 时间：2008-09-09T14:18:23.543
> 
> 标签：iphone, android, blackberry, mobile, webos

是否有任何有据可查的或开源项目针对`iPhone`,`Blackberry`和`Android`? 还有其他平台更适合这种努力吗？请注意，我特别询问的是客户端软件，而不是 Web 应用程序，尽管有关跨多个移动平台使用 Web 应用程序的困难的任何信息也很有趣。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2010-08-10T12:35:10.697

HTML5 标准支持发布独立的*HTML5*应用程序。本质上，*HTML5*应用程序是一组*HTML5*、*JavaScript*和*CSS*文件，它们将在桌面或设备的浏览器中独立运行。您可以像任何其他程序一样分发它们，包括在**iPhone的***iStore*上销售它们。

 **目前对此的支持不完整，但在未来一两年内可能会大大改善。

Google for *HTML5*应用程序以获取信息和资源。对 HTML5 的一个很好的介绍是[Mark Pilgrim 的在线书籍“Dive Into HTML5”](http://fortuito.us/diveintohtml5/table-of-contents.html)。这是一项正在进行中的工作，但已经足够完整以供使用。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-04-30T11:57:16.683

对于这个问题，有 2 个 [newish] 解决方案：

[机车](http://www.rhomobile.com/)

和

[电话间隙](http://www.phonegap.com/)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-11-08T22:57:24.593

我认为跨平台移动成功的最佳机会是 Web。只需为您想要实现的目标编写一个[非常简单的 Web应用程序。](http://geo.webvm.net/)它应该可以在诺基亚 S60 浏览器、Iphone 和 Android 上运行。

这已经是很多移动设备了...

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-09-16T15:40:30.730

Appcelerator、PhoneGap（被 Adob​​e 收购，加上它现在被标准化为 Apache Cordova）、Intel XDK（以前称为 appMobi）和 Rhodes（被摩托罗拉解决方案收购）都是开源的，并创建混合应用程序（本机包含 html ui，有可能添加一些本机控件）。

如果是游戏，你唯一的专业选择是可以用于商业开发的免费引擎是 Unity3D。对于 2D 游戏，cocos2d-x 也可用。此外，Vuforia 可用于 AR 和 LiquidFun 用于物理。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-06-16T05:40:47.080

[XMLVM](http://www.xmlvm.org/overview/)（通过[Coke 和 Code](http://www.cokeandcode.com/node/1393)）和[EdgeLib](http://www.edgelib.com/)目前似乎是最成熟的选择。EdgeLib 主要针对游戏开发者，根据 Coke and Code 的说法，XMLVM 开发者很难接触。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-09T14:35:53.733

iPhone 使用 Objective C、具有 RIM 功能的 Blackberry Java SE 和 Android 另一个自定义版本的 Java。我可能会看到如何将后两者结合起来，但是没有在 iPhone 上运行 Java 应用程序的功能（没有越狱）。

到目前为止，我见过的最好的选择是[Qt](http://en.wikipedia.org/wiki/Qt_(toolkit))之类的东西，它将在 Windows CE 上运行，几乎可以肯定很快将在 Symbian、一些 Java 平台和三个主要桌面操作系统上运行。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-19T13:28:36.890

[redfivelabs](http://www.redfivelabs.com/default.aspx)为 S60 平台实现了 .Net compact 框架

[Appcelerator 的Titanium Mobile](http://www.appcelerator.com/products/titanium-mobile-application-development/)看起来很有趣。您使用 HTML 和 Javascript 开发您的应用程序并上传到他们的服务器，在那里它被编译成目标平台的本机应用程序（目前是 iPhone 和 Android）

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-09T15:30:30.717

对于 iPhone，目前还没有开源这样的概念，因为 Apple iPhone SDK NDA 禁止发布代码。他们还禁止在任何非 Apple 网站甚至非 Apple 讨论论坛上发布有关 iPhone 开发的代码。一旦 NDA 到期（会永远吗？），我们将开始拥有开源 iPhone 应用程序。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-08-22T07:37:17.703

这里还没有提到**惊讶的 MoSync**。

*更新（2014 年 1 月至今）：*该项目[已被放弃](https://groups.google.com/forum/#!topic/mosync-dev/PaYzr5ENw-g)。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-16T05:04:36.000

我开始使用一个非常酷的跨平台 SDK，叫做 EdgeLib。它允许您使用简单的 API，您可以将项目编译到各种平台：Windows Mobile Pocket PC、Windows Mobile Smartphone、Symbian Series 60、Series 80、Series 90、Symbian UIQ、Gamepark Holdings GP2X、Gizmondo 和 Windows 桌面. 我知道 iPhone、Blackberry 和 Android 不在该列表中，但开发人员提到这些平台在他们的路线图上。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-17T22:14:53.627

EdgeLib 看起来很有希望，并且已经发布了[iPhone 测试版](http://www.edgelib.com/index.php?node=iphone)，但尚未开放。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-01-05T17:39:10.650

[jQuery Mobile Alpha 2 发布](http://jquerymobile.com/)
[Nimblekit](http://www.nimblekit.com/)
[Sencha](http://www.sencha.com/products/touch/)
[Phonegap](http://www.phonegap.com/)
[Appcelerator](http://www.appcelerator.com/products/titanium-mobile-application-development/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-12T22:07:00.007

好吧，黑莓实际上并没有 Java SE，它们有 Java ME，以及RIM 提供*的许多附加库。*安卓也是如此。您将在移动设备上看到的唯一跨平台应用程序可能是用严格的 Java ME 编写的，它可以在大多数设备上运行。然而，就像不同浏览器之间的 JavaScript 一样，Java ME 也有跨不同设备的怪癖，因此可能需要更改源代码。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-04-29T09:12:50.013

我发现一个用于 dat MoMinis 游戏的游戏引擎可供分发，并在 Android、Blackberry、Symbian 和 J2me 设备上受支持。MoMinis 游戏包括各种休闲游戏——包括街机、益智、时间管理、策略和大脑训练手机游戏。

[莫米尼斯](http://www.mominis.com/)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-17T22:39:15.783

*Symbian OS 上的 S60*有很多有趣的项目正在发生，这些项目与桌面/服务器语言相关，以移动应用程序。一些有趣的：-

Python：[sourceforge](http://sourceforge.net/projects/pys60)
Ruby：[ruby-symbian](http://sourceforge.net/projects/pys60)
Mozilla：[mozilla](https://wiki.mozilla.org/Mobile/Symbian/NSPR)
S60Webkit：[S60browser](http://opensource.nokia.com/projects/S60browser/)
POSIX：[openc_cpp](http://www.forum.nokia.com/main/resources/technologies/openc_cpp/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-26T11:21:00.897

我们有一个名为 RAMP 的跨平台移动开发平台。它涵盖了从 midp 1 到 Android 的功能手机和智能手机。该平台主要针对安全的商业应用程序，但它是可插拔的，因此您几乎可以用它做任何事情。

有关更多信息和平台访问权限，请查看：

[虚拟移动技术](http://ramp.virtualmobiletech.com/)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-05-26T21:50:06.623

Phonsai 是跨平台移动开发市场上的新产品，“无需编码”它是自己动手移动开发和内容管理的混合体您可以自定义所有应用程序。没有模板。它是SaaS。完全基于 web，带有 java web start。使用 2000 款手机型号。非常简单的 GUI，无需编码。只需复制和粘贴。它具有创建、发送和报告模块。最后，它内部有 4 个仿真器，因此它是一个所见即所得的概念。[您可以通过http://phonsai.com](http://phonsai.com)联系 Phonsai******************************