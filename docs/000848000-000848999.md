# StackOverflow 问答 000848000-000848999

# .net - 应用程序异常和系统异常的区别

> ID：848017
> 
> 赞同：17
> 
> 时间：2009-05-11T13:04:32.377
> 
> 标签：.net, exception

我想知道[System.ApplicationException](https://msdn.microsoft.com/en-us/library/System.ApplicationException)和[System.Exception](https://msdn.microsoft.com/en-us/library/system.exception(v=vs.110).aspx)之间的区别。

谁能解释

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-11T13:07:30.607

最初它们旨在将 BCL 定义和用户定义的异常分开。ApplicationException 旨在成为所有用户定义异常的基类。这个想法是它会给你一种清晰的方法来区分框架异常和自定义异常。

不幸的是，该政策从一开始就没有执行，因此在 BCL 中与该规则存在许多矛盾。当前的建议是不要继承这些异常。

这是关于这个主题的一篇不错的博客文章：

*   [http://blogs.msdn.com/kcwalina/archive/2006/06/23/644822.aspx](http://blogs.msdn.com/kcwalina/archive/2006/06/23/644822.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-13T02:21:03.180

所有异常都派生自异常基类。异常可以通过编程方式生成，也可以由系统生成。Application Exception 作为所有应用程序特定异常类的基类。它派生自 Exception 但不提供任何扩展功能。您应该从 Application Exception 派生您的自定义应用程序异常。当我们想要定义用户定义的异常时使用应用程序异常。而系统异常都是由.NET定义的

# visual-studio - keybd_event() 在带有 IE 保护模式的 ACTIVEX 模块中不起作用

> ID：848018
> 
> 赞同：0
> 
> 时间：2009-05-11T13:04:38.103
> 
> 标签：visual-studio, delphi, internet-explorer, activex

keybd_event() 在具有保护模式的 ACTIVEX 模块中不起作用 - 我正在使用模拟按键的 activex，但它对新的 IE8 没有任何作用。

```
 keybd_event(VK_SPACE, MapVirtualKey(VK_SPACE, 0), 0, 0);
  keybd_event(VK_SPACE, MapVirtualKey(VK_SPACE, 0), KEYEVENTF_KEYUP, 0); 
```

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:16:48.210

恐怕不是。[为了提供更高的安全性，IE8 现在托管在具有有限权限](http://blogs.msdn.com/ie/archive/2008/03/11/ie8-and-loosely-coupled-ie-lcie.aspx)的单独进程中加载​​的选项卡和加载项。就像 Chrome 和新的 FireFox 4 一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T01:49:49.593

我对 BHO 也有同样的问题。它最初工作，然后停止，有时还会使 iexplore.exe 选项卡实例崩溃。

我发现 ieframe.dll 的 IE8 版本似乎正在使用[Detours 库](http://research.microsoft.com/en-us/projects/detours/)来挂钩几个 Windows API，包括 SendInput 和 keybd_event。

# delphi - 如何在代码中有效地旋转位图

> ID：848025
> 
> 赞同：19
> 
> 时间：2009-05-11T13:06:51.373
> 
> 标签：delphi, image-processing, image-manipulation, rotation

有没有比简单地使用倒置坐标进行嵌套循环更快的方法将*大*位图旋转 90 度或 270 度？

位图为 8bpp，通常为 2048x2400x8bpp

目前我通过简单地复制参数反转来做到这一点，大致（伪代码：

```
for x = 0 to 2048-1
  for y = 0 to 2048-1
    dest[x][y]=src[y][x]; 
```

（实际上我用指针来做，速度更快，但幅度大致相同）

GDI 对于大图像非常慢，并且纹理（GF7 卡）的 GPU 加载/存储时间与当前 CPU 时间相同。

任何提示，指针？就地算法甚至会更好，但速度比就地更重要。

目标是德尔福，但它更像是一个算法问题。SSE(2) 向量化没问题，这对我来说在汇编程序中编码已经足够大了

* * *

**跟进尼尔斯的回答**

*   图像 2048x2700 -> 2700x2048
*   编译器 Turbo Explorer 2006 已开启优化。
*   Windows：电源方案设置为“始终开启”。（**重要！！！！**）
*   机器：Core2 6600 (2.4 GHz)

使用旧程序的时间：32 毫秒（第 1 步）

步长为 8 的时间：12ms

步长为 16 的时间：10 毫秒

步长 32+ 的时间：9ms

同时我还在 Athlon 64 X2 (5200+ iirc) 上进行了测试，那里的速度比原来的四倍多一点（80 到 19 毫秒）。

加速是值得的，谢谢。也许在夏天的几个月里，我会用 SSE(2) 版本来折磨自己。但是我已经考虑过如何解决这个问题，我想我会用完 SSE2 寄存器来直接实现：

```
for n:=0 to 7 do
  begin
    load r0, <source+n*rowsize> 
    shift byte from r0 into r1
    shift byte from r0 into r2
    ..
    shift byte from r0 into r8
  end; 
store r1, <target>   
store r2, <target+1*<rowsize>
..
store r8, <target+7*<rowsize> 
```

所以 8x8 需要 9 个寄存器，但 32 位 SSE 只有 8 个。无论如何，这是夏天的事情:-)

请注意，指针的事情是我出于本能而做的，但它实际上可能有一些东西，如果你的尺寸没有硬编码，编译器就不能把 mul 变成一个班次。虽然现在 muls an sich 很便宜，但它们也会产生更多的注册压力 afaik。

代码（通过从“naieve”rotate1 实现中减去结果来验证）：

```
const stepsize = 32;
procedure rotatealign(Source: tbw8image; Target:tbw8image);

var stepsx,stepsy,restx,resty : Integer;
   RowPitchSource, RowPitchTarget : Integer;
   pSource, pTarget,ps1,ps2 : pchar;
   x,y,i,j: integer;
   rpstep : integer;
begin
  RowPitchSource := source.RowPitch;          // bytes to jump to next line. Can be negative (includes alignment)
  RowPitchTarget := target.RowPitch;        rpstep:=RowPitchTarget*stepsize;
  stepsx:=source.ImageWidth div stepsize;
  stepsy:=source.ImageHeight div stepsize;
  // check if mod 16=0 here for both dimensions, if so -> SSE2.
  for y := 0 to stepsy - 1 do
    begin
      psource:=source.GetImagePointer(0,y*stepsize);    // gets pointer to pixel x,y
      ptarget:=Target.GetImagePointer(target.imagewidth-(y+1)*stepsize,0);
      for x := 0 to stepsx - 1 do
        begin
          for i := 0 to stepsize - 1 do
            begin
              ps1:=@psource[rowpitchsource*i];   // ( 0,i)
              ps2:=@ptarget[stepsize-1-i];       //  (maxx-i,0);
              for j := 0 to stepsize - 1 do
               begin
                 ps2[0]:=ps1[j];
                 inc(ps2,RowPitchTarget);
               end;
            end;
          inc(psource,stepsize);
          inc(ptarget,rpstep);
        end;
    end;
  // 3 more areas to do, with dimensions
  // - stepsy*stepsize * restx        // right most column of restx width
  // - stepsx*stepsize * resty        // bottom row with resty height
  // - restx*resty                    // bottom-right rectangle.
  restx:=source.ImageWidth mod stepsize;   // typically zero because width is 
                                          // typically 1024 or 2048
  resty:=source.Imageheight mod stepsize;
  if restx>0 then
    begin
      // one loop less, since we know this fits in one line of  "blocks"
      psource:=source.GetImagePointer(source.ImageWidth-restx,0);    // gets pointer to pixel x,y
      ptarget:=Target.GetImagePointer(Target.imagewidth-stepsize,Target.imageheight-restx);
      for y := 0 to stepsy - 1 do
        begin
          for i := 0 to stepsize - 1 do
            begin
              ps1:=@psource[rowpitchsource*i];   // ( 0,i)
              ps2:=@ptarget[stepsize-1-i];       //  (maxx-i,0);
              for j := 0 to restx - 1 do
               begin
                 ps2[0]:=ps1[j];
                 inc(ps2,RowPitchTarget);
               end;
            end;
         inc(psource,stepsize*RowPitchSource);
         dec(ptarget,stepsize);
       end;
    end;
  if resty>0 then
    begin
      // one loop less, since we know this fits in one line of  "blocks"
      psource:=source.GetImagePointer(0,source.ImageHeight-resty);    // gets pointer to pixel x,y
      ptarget:=Target.GetImagePointer(0,0);
      for x := 0 to stepsx - 1 do
        begin
          for i := 0 to resty- 1 do
            begin
              ps1:=@psource[rowpitchsource*i];   // ( 0,i)
              ps2:=@ptarget[resty-1-i];       //  (maxx-i,0);
              for j := 0 to stepsize - 1 do
               begin
                 ps2[0]:=ps1[j];
                 inc(ps2,RowPitchTarget);
               end;
            end;
         inc(psource,stepsize);
         inc(ptarget,rpstep);
       end;
    end;
 if (resty>0) and (restx>0) then
    begin
      // another loop less, since only one block
      psource:=source.GetImagePointer(source.ImageWidth-restx,source.ImageHeight-resty);    // gets pointer to pixel x,y
      ptarget:=Target.GetImagePointer(0,target.ImageHeight-restx);
      for i := 0 to resty- 1 do
        begin
          ps1:=@psource[rowpitchsource*i];   // ( 0,i)
          ps2:=@ptarget[resty-1-i];       //  (maxx-i,0);
          for j := 0 to restx - 1 do
            begin
              ps2[0]:=ps1[j];
              inc(ps2,RowPitchTarget);
            end;
       end;
    end;
end; 
```

**更新 2 泛型**

我试图在 Delphi XE 中将此代码更新为泛型版本。我因为 QC 99703 失败了，论坛的人已经确认它也存在于 XE2 中。请投票给它:-)

**更新 3 泛型** 现在可以在 XE10 中使用

**更新 4**

[在 2017 年，我在8x8 立方体的 8bpp 图像](http://www.stack.nl/%7Emarcov/rot8x8.txt)的汇编器版本上做了一些工作，以及关于 shuffle 瓶颈的相关[SO 问题，Peter Cordes 慷慨地帮助了我。](https://stackoverflow.com/questions/47478010/sse2-8x8-byte-matrix-transpose-code-twice-as-slow-on-haswell-then-on-ivy-bridge)这段代码仍然有一个错过的机会，并且仍然需要另一个循环平铺级别再次将多个 8x8 块迭代聚合成更大的伪迭代，例如 64x64。现在又是整行了，这很浪费。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-11T13:34:05.287

是的，有更快的方法来做到这一点。

您的简单循环大部分时间都在缓存未命中。之所以会发生这种情况，是因为您在一个紧密的循环中在非常不同的地方接触了大量数据。更糟糕的是：你的记忆位置正好是两个的幂。这是缓存性能最差的大小。

如果您改进内存访问的局部性，则可以改进此旋转算法。

一种简单的方法是使用与整个位图相同的代码自行旋转每个 8x8 像素块，并包装另一个循环，将图像旋转拆分为每个 8x8 像素的块。

例如这样的事情（未检查，对 C 代码感到抱歉。我的 Delphi 技能不是最新的）：

```
 // this is the outer-loop that breaks your image rotation
 // into chunks of 8x8 pixels each:
 for (int block_x = 0; block_x < 2048; block_x+=8)
 {
    for (int block_y = 0; blocky_y < 2048; block_y+=8)
    { 
       // this is the inner-loop that processes a block
       // of 8x8 pixels.
       for (int x= 0; x<8; x++)
         for (int y=0; y<8; y++)
            dest[x+block_x][y+block_y] = src[y+block_y][x+block_x]
    }
 } 
```

还有其他方法。您可以在 Hilbert-Order 或 Morton-Order 中处理数据。理论上这会更快一些，但代码会复杂得多。

顺便说一句 - 既然你提到 SSE 是你的选择。请注意，您可以在 SSE 寄存器中旋转 8x8 字节块。让它工作有点棘手，但看看 SSE 矩阵转置代码应该会让你开始，因为它是同一件事。

* * *

**编辑：**

刚刚检查：

使用 8x8 像素的块大小，代码运行 ca。在我的机器上快 5 倍。块大小为 16x16，它的运行速度提高了 10 倍。

似乎尝试不同的块大小是个好主意。

这是我使用的（非常简单的）测试程序：

```
#include <stdio.h>
#include <windows.h>

char temp1[2048*2048];
char temp2[2048*2048];

void rotate1 (void)
{
  int x,y;
  for (y=0; y<2048; y++)
  for (x=0; x<2048; x++)
    temp2[2048*y+x] = temp1[2048*x+y];
}

void rotate2 (void)
{
  int x,y;
  int bx, by;

  for (by=0; by<2048; by+=8)
  for (bx=0; bx<2048; bx+=8)
  for (y=0; y<8; y++)
  for (x=0; x<8; x++)
    temp2[2048*(y+by)+x+bx] = temp1[2048*(x+bx)+y+by];
}

void rotate3 (void)
{
  int x,y;
  int bx, by;

  for (by=0; by<2048; by+=16)
  for (bx=0; bx<2048; bx+=16)
  for (y=0; y<16; y++)
  for (x=0; x<16; x++)
    temp2[2048*(y+by)+x+bx] = temp1[2048*(x+bx)+y+by];
}

int main (int argc, char **args)
{
  int i, t1;

  t1 = GetTickCount();
  for (i=0; i<20; i++) rotate1();
  printf ("%d\n", GetTickCount()-t1);

  t1 = GetTickCount();
  for (i=0; i<20; i++) rotate2();
  printf ("%d\n", GetTickCount()-t1);

  t1 = GetTickCount();
  for (i=0; i<20; i++) rotate3();
  printf ("%d\n", GetTickCount()-t1);

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:22:00.803

如果您可以使用 C++，那么您可能需要查看[Eigen](http://eigen.tuxfamily.org)。

它是一个 C++ 模板库，它使用*SSE（2 和更高版本）和 AltiVec 指令集，并优雅地回退到非矢量化代码*。

> 快速地。（见基准）。
> 表达式模板允许在适当的时候智能地删除临时变量并启用惰性求值——Eigen 会自动处理这一点并在大多数情况下也处理别名。
> 对 SSE（2 和更高版本）和 AltiVec 指令集执行显式矢量化，并优雅地回退到非矢量化代码。表达式模板允许对整个表达式全局执行这些优化。
> 使用固定大小的对象，可以避免动态内存分配，并且在有意义时展开循环。
> 对于大型矩阵，需要特别注意缓存友好性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:16:41.193

您*可以*通过在缓存对齐的块中而不是按行进行复制来改进它，因为目前任一 src dest 的步幅都将是未命中的（取决于 delphi 是 row major 还是 column major ）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T13:59:25.967

如果图像不是正方形，则无法就地执行。即使您在方形图像中工作，变换也不利于就地工作。

如果您想尝试更快地做事，您可以尝试利用行步幅来使其工作，但我认为您会做的最好的事情是从源代码中一次读取 4 个字节，并且然后将其写入 dest 中的四个连续行。这应该会减少您的一些开销，但我预计不会有超过 5% 的改进。

# active-directory - 活动目录

> ID：848029
> 
> 赞同：2
> 
> 时间：2009-05-11T13:08:15.207
> 
> 标签：active-directory, ldap

如何使用 LDAP 从 Active Directory 中获取已删除对象的详细信息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-03-04T15:03:52.303

删除的对象存储在单独的容器中，检索对象可以在[这个 technet 站点](http://technet.microsoft.com/en-us/library/dd379509%28v=ws.10%29.aspx)上查看。

它是内置功能，应具有 Windows Server 2008 或更高版本的操作系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T15:07:55.470

在 MSDN 上有一篇[很好的文章，介绍了使用 .NET 框架](http://msdn.microsoft.com/en-us/magazine/cc188700.aspx#S4)[DirectorySearcher](http://msdn.microsoft.com/en-us/library/system.directoryservices.directorysearcher.aspx)类在 Active Directory 中查找 tombstone 对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:46:03.527

*此答案来自坐在我旁边的承包商[Rodney Anderson](http://mailto:itconsultant@mail.uch.org)，他恰好对 AD 非常了解。他说给他发电子邮件有任何问题（提供链接）

使用 dsquery。

[http://support.microsoft.com/kb/258310（LDAP](http://support.microsoft.com/kb/258310) 查询）

...另一种方法是使用以下命令从命令行进行 DSquery 您应该能够检索保留在墓碑中的大多数属性（所有内容都在一行中）：请记住，此查询不一定会返回所有属性它们保存在墓碑中 - 列表的一些关键对象和更改是硬编码的，无论 searchflags 状态如何，都将保留在墓碑中。这是我使用的解决方案，需要对其域进行一些调整。dsquery * cn=schema,cn=configuration,dc=yourcomin,dc=com -filter "(&(objectClass=AttributeSchema)(searchFlags:1.2.840.113556.1.4.803:=8))" -scope 子树 -attr 名称

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-07T10:34:50.787

您可以使用 DirectorySearcher 列出已删除的对象，并将 Tombstone 属性设置为 true

```
using(DirectorySearcher srch = new DirectorySearcher(de))
    {
        //to return only deleted objects otherwise you can give any valid LDAP filter
        srch.Filter = "isDeleted=TRUE";

        // Instruct the DirectorySearcher to return deleted objects
        srch.Tombstone = true;

        srch.FindAll();
        //...

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-26T21:52:12.477

不幸的是，已删除的对象并没有那么多可用的数据。根据我的经验，只保留了大约足够的数据，以便能够将删除复制到其他 DC。您可以通过 System.DriectoryServices 获得可用的内容。其中一些似乎与安全有关，并且不希望人们四处寻找旧物品。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-10-29T12:33:31.560

要使用 LDAP 服务器从活动目录中获取已删除对象的详细信息，在获取详细信息之前，我们应该了解管理限制。这些管理限制例如 InitRecvTimeout、MaxActiveQueries、MaxConnections、MaxConnIdleTime、MaxPageSize、MaxPoolThreads、MaxQueryDuration、MaxValRange。

一旦我们意识到管理的限制，我们应该能够默认用户设置。

在此之后查看当前策略设置...在命令提示符下键入 LDAP 设置按回车键，然后输入连接，然后一旦所有连接都显示在那里，然后查看哪些所有连接不可见。这会让你知道谁在 LDAP 上删除了所有用户。

# c# - 访问创建者对象

> ID：848030
> 
> 赞同：0
> 
> 时间：2009-05-11T13:08:25.003
> 
> 标签：c#, forms, object

我在 C# 中有一个简单的 Windows 应用程序，有 3 种形式。第一个窗体是主窗体（它的名字是 FrmMain），第二个是 FrmData，第三个是 FrmShow。在主表单（FrmMain）中，我从第二种表单（FrmData）创建了一个实例并显示它：

```
 public partial class FrmMain : Form
    {
        public Form FrmModifyData; //for FrmData
        int PersonCode;
        public FrmMain()
        {
            InitializeComponent();
        }

        private void btnShowDataForm_Click(object sender, EventArgs e)
        {
            FrmModifyData= new FrmData();  
            FrmModifyData.ShowDialog();

        }
    } 
```

但我无法从 FrmModifyData 访问像*PersonCode*这样的 FrmMain 字段。如何访问创建者对象的字段？

注意：我是初学者。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T13:11:55.747

您需要向 FrmModifyData 类添加一个属性以获取 FrmMain 类的实例。然后你可以这样做：

```
FrmModifyData = new FrmData();
FrmModifyData.ParentData = this;
FrmModifyData.ShowDialog(); 
```

然后在 FrmModifyData 中，您可以访问 FrmMain 的公共成员。显然，这是一种快速和肮脏的方式，并且不是很可重用，所以我建议向 FrmModifyData 添加更明确的属性，只包含您需要使用的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T13:10:39.523

如果要访问 PersonCode 字段，则应将其声明为 public。没有可见性修饰符将其设为私有，因此无法从其他情况下访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-07T10:57:02.453

我会把它做成这样的。通过这种方式，您可以以其他形式使用 FrmModifyData。

我知道这是一篇旧帖子，但是是的，你确实读过它:)

```
public partial class FrmMain : Form
{
    // public Form FrmModifyData; <-- do not declare it in your FrmMain 
    // (is't a modal dialog, so you won't get more instances)

    public int PersonCode {get; set;}

    public FrmMain()
    {
        InitializeComponent();
    }

    private void btnShowDataForm_Click(object sender, EventArgs e)
    {
        FrmData FrmModifyData = new FrmData();
        FrmModifyData.PersonCode = this.PersonCode;
        DialogResult result = FrmModifyData.ShowDialog();
        if(result == DialogResult.Ok)
        {
            // do something with the result
            this.PersonCode = FrmModifyData.PersonCode;

        }

    }
} 
```

# c# - 在 MVC 中对视图、控制器、模型进行分组

> ID：848034
> 
> 赞同：3
> 
> 时间：2009-05-11T13:10:27.433
> 
> 标签：c#, asp.net-mvc

也许我错了，但我真的不喜欢 MVC 应用程序的当前结构，而且我认为在大型项目中它会导致维护麻烦。

那么有没有办法将相关的控制器、视图、模型组合在一起，就像我有画廊模块一样，我希望它的所有控制器、视图、模型都被分组在画廊文件夹下。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T13:25:51.187

[区域](http://blog.codeville.net/2008/11/05/app-areas-in-aspnet-mvc-take-2/)听起来像您正在寻找的东西。这将允许您对控制器/视图/等进行分组。除非我误解了这个问题？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T13:33:44.883

Phil Haack[在这里讨论了这个问题](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)，这是我面临的同样问题，但尚未正确克服。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T13:33:14.463

从它的声音来看，你正在违背 MVC 的基本原则，即模型、视图和控制器的分离，而不是你希望通过使用模块来拆分 90 度。

我不完全确定以任何方式将其拆分为模块会带来什么好处，因为我希望您拥有一个 GalleryController。您可能需要分组的“实体”最多的地方是视图，每个 GalleryController 操作可能有一个或多个，但它们位于自己的文件夹中，无论如何都提供了您正在寻找的那种功能。

最后是模型。显然我不知道你的项目，所以我不知道它是如何布局的，但是模型通常不存在用于一个控制器（或你的情况下的模块）。例如 - 我有用户、公司、车辆等的模型。这些模型是我的数据结构的共享表示，与模块无关，因为用户可能会在网页上看到它。我不能将它们拆分为模块，因为重点是它们由整个应用程序共享。

所以......实际上是视图可能会有点混乱，但它们已经根据它们的控制器分成文件夹。话虽如此，如果更适合您的需求，您可以将它们移动一下。对于其余部分，没有必要，因为如果您想使用“适当的”MVC（即模块化模型）或不需要（即只有一个控制器），您不应该这样做。如果您的控制器变得太大，只需为您想要拆分的任何功能创建一个单独的模块。我认为这是你应该得到的模块化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:13:42.303

我找到了一个相对简单的解决方案，使用 IIS 配置来模拟区域。不需要对现有 MVC 框架进行扩展。

在您的解决方案下为站点中所需的每个区域（例如根、博客、论坛、App1、App2）创建一个新的 MVC 项目。如果您需要任何通用的支持代码或通用模型，请将其放在 MVC 项目所依赖的单独 dll 项目中。

在 IIS 中，将站点根目录配置为指向根项目目录。在站点根目录下创建指向每个子区域项目目录的 Web 应用程序。

在为每个子区域配置路由映射时，不要在路由中包含应用程序的名称。IIS 似乎为您解决了这个问题。（例如“ShowPost/{postname}”，而不是“/Blog/ShowPost/{postname}”）

好处是您可以独立于路由系统更改 Web 应用程序的名称，并且每个应用程序都认为它与整个服务器一起运行。

# c# - 监控注册表更改

> ID：848038
> 
> 赞同：0
> 
> 时间：2009-05-11T13:11:07.353
> 
> 标签：c#, .net, registry

> **可能重复：**
> [如何创建 Windows 注册表观察程序？](https://stackoverflow.com/questions/846366/how-to-create-a-windows-registry-watcher)

.net 中是否有任何类可以用来监视注册表中值的任何更改，类似于 FileSystemWatcher 的工作方式。

因此，如果值发生更改，则会引发一个事件。

或任何其他建议这样做会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T13:14:18.110

不确定是否有内置功能，但您可以通过使用计时器轻松创建自己的功能，检查键的值，记住该值，并在下一次滴答时再次比较它，看看值是否不同.

# linux - 如何获取与 TCP 套接字关联的接口名称/索引？

> ID：848040
> 
> 赞同：10
> 
> 时间：2009-05-11T13:11:19.320
> 
> 标签：linux, sockets, tcp

我正在编写一个 TCP 服务器，它需要知道每个连接来自哪个接口。我无法使用地址/子网来推断使用了哪个接口，因为可能存在具有相同地址/子网值的接口。它是基于 Linux 的，并且不需要可移植代码。

我能找到的只是获取所有接口或按索引获取单个接口的函数。我找不到任何方法来获取与接受的 TCP 套接字关联的接口。

有任何想法吗？我错过了什么？

编辑：重申一下，在我的情况下，IP 地址不是唯一的。目标地址（服务器本身）和源地址（客户端）都不是。是的，这是一个非常极端的IP方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2016-06-23T09:38:44.520

用于`getsockname()`获取 TCP 连接本地端的 IP。然后使用`getifaddrs()`找到对应的接口：

```
struct sockaddr_in addr;
struct ifaddrs* ifaddr;
struct ifaddrs* ifa;
socklen_t addr_len;

addr_len = sizeof (addr);
getsockname(sock_fd, (struct sockaddr*)&addr, &addr_len);
getifaddrs(&ifaddr);

// look which interface contains the wanted IP.
// When found, ifa->ifa_name contains the name of the interface (eth0, eth1, ppp0...)
for (ifa = ifaddr; ifa != NULL; ifa = ifa->ifa_next)
{
    if (ifa->ifa_addr)
    {
        if (AF_INET == ifa->ifa_addr->sa_family)
        {
            struct sockaddr_in* inaddr = (struct sockaddr_in*)ifa->ifa_addr;

            if (inaddr->sin_addr.s_addr == addr.sin_addr.s_addr)
            {
                if (ifa->ifa_name)
                {
                    // Found it
                }
            }
        }
    }
}
freeifaddrs(ifaddr); 
```

上面只是一个肮脏的例子，需要一些修改：

1.  添加缺失的错误检查
2.  IPv6 支持

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T20:49:10.543

一般来说，您不需要知道数据包将在哪个接口上发送/接收；这是内核路由表的工作。很难找到套接字的接口，因为确实没有直接关联。数据包的路由可以根据路由信息在套接字的生命周期内改变。

对于数据报 (UDP) 套接字，您可以使用`getsockopt(s, IPPROTO_IP, IP_PKTINFO, ...)`; 见`getsockopt(2)`和`ip(7)`。

对于流 (TCP) 套接字，一种选择可能是打开多个侦听套接字，一个用于系统上的每个接口，并用于`setsockopt(s, SOL_SOCKET, SO_BINDTODEVICE, ...)`将每个套接字绑定到一个接口；见`setsockopt(2)`和`socket(7)`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-04-18T19:11:57.077

下面是一些用于查找套接字接口名称的 C++11 代码：

```
std::string to_string(sockaddr_in const& addr)
{
    char buf[INET_ADDRSTRLEN];
    if (inet_ntop(AF_INET, &addr.sin_addr, buf, sizeof(buf)) == nullptr)
    {
        std::clog << "inet_ntop: " << strerror(errno) << '\n';
        return {};
    }
    return buf;
}

std::string to_string(sockaddr_in6 const& addr)
{
    char buf[INET6_ADDRSTRLEN];
    if (inet_ntop(AF_INET6, &addr.sin6_addr, buf, sizeof(buf)) == nullptr)
    {
        std::clog << "inet_ntop: " << strerror(errno) << '\n';
        return {};
    }
    return buf;
}

std::string to_string(sockaddr_storage const& addr, socklen_t len)
{
    switch (addr.ss_family)
    {
    case AF_INET:
    {
        auto& a = reinterpret_cast<sockaddr_in const&>(addr);
        if (len < sizeof(a))
        {
            std::clog << "Invalid sockaddr length: " << len << '\n';
            return {};
        }
        return to_string(a);
    }
    case AF_INET6:
    {
        auto& a = reinterpret_cast<sockaddr_in6 const&>(addr);
        if (len < sizeof(a))
        {
            std::clog << "Invalid sockaddr length: " << len << '\n';
            return {};
        }
        return to_string(a);
    }
    default:
    {
        std::clog << "Invalid sockaddr family: " << addr.ss_family << '\n';
        return {};
    }
    }
}

std::string get_iface_name(sockaddr_in const& addr)
{
    ifaddrs *ifa = nullptr;
    if (getifaddrs(&ifa) == -1)
    {
        std::clog << "getifaddrs: " << strerror(errno) << '\n';
        return {};
    }
    std::unique_ptr<ifaddrs, void(*)(ifaddrs*)>
        finally{ifa, freeifaddrs};

    for (; ifa; ifa = ifa->ifa_next)
    {
        if (!ifa->ifa_addr)
            continue;
        if (!ifa->ifa_name)
            continue;
        if (ifa->ifa_addr->sa_family != AF_INET)
            continue;
        auto& a = reinterpret_cast<sockaddr_in&>(*ifa->ifa_addr);
        if (a.sin_addr.s_addr == addr.sin_addr.s_addr)
            return ifa->ifa_name;
    }

    std::clog << "No interface found for IPv4 address " << to_string(addr) << '\n';
    return {};
}

std::string get_iface_name(sockaddr_in6 const& addr)
{
    ifaddrs *ifa = nullptr;
    if (getifaddrs(&ifa) == -1)
    {
        std::clog << "getifaddrs: " << strerror(errno) << '\n';
        return {};
    }
    std::unique_ptr<ifaddrs, void(*)(ifaddrs*)>
        finally{ifa, freeifaddrs};

    for (; ifa; ifa = ifa->ifa_next)
    {
        if (!ifa->ifa_addr)
            continue;
        if (!ifa->ifa_name)
            continue;
        if (ifa->ifa_addr->sa_family != AF_INET6)
            continue;
        auto& a = reinterpret_cast<sockaddr_in6&>(*ifa->ifa_addr);
        if (memcmp(a.sin6_addr.s6_addr,
                   addr.sin6_addr.s6_addr,
                   sizeof(a.sin6_addr.s6_addr)) == 0)
            return ifa->ifa_name;
    }

    std::clog << "No interface found for IPv6 address " << to_string(addr) << '\n';
    return {};
}

std::string get_iface_name(sockaddr_storage const& addr, socklen_t len)
{
    switch (addr.ss_family)
    {
    case AF_INET:
    {
        auto& a = reinterpret_cast<sockaddr_in const&>(addr);
        if (len < sizeof(a))
        {
            std::clog << "Invalid sockaddr length: " << len << '\n';
            return {};
        }
        return get_iface_name(a);
    }
    case AF_INET6:
    {
        auto& a = reinterpret_cast<sockaddr_in6 const&>(addr);
        if (len < sizeof(a))
        {
            std::clog << "Invalid sockaddr length: " << len << '\n';
            return {};
        }
        return get_iface_name(a);
    }
    default:
    {
        std::clog << "Invalid sockaddr family: " << addr.ss_family << '\n';
        return {};
    }
    }
}

std::string get_iface_name(int sockfd)
{
    sockaddr_storage addr;
    socklen_t len = sizeof(addr);
    if (getsockname(sockfd, (sockaddr*)&addr, &len) == -1)
    {
        std::clog << "getsockname: " << strerror(errno) << '\n';
        return {};
    }
    std::clog << "getsockname '" << to_string(addr, len) << '\'' << '\n';
    return get_iface_name(addr, len);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T14:28:45.500

内核路由表决定在哪个接口上发送数据包，因此能够绑定设备。粗略浏览“Linux Socket Programming, Warren W. Gay”表明指定接口是不好的，并且由于内核的动态（防火墙、转发），它更复杂。

我建议更改您的 IP 方案，以便 IP 信息通过以与 ifconfig 相同的方式查找来告诉您您的接口，否则您将在脚部设计方面为自己开枪。

1) 从 TCP 会话中获取 IP 信息 2) 查找可能对哪些接口有效

不过，我会继续查看内核 API。您不需要知道这一点，抽象的存在有很多充分的理由。

**额外的思考** 考虑到这一点，如果两个接口都使用相同的 IP，那么客户端地址范围路由肯定存在差异（否则两个接口都会被使用）。您的服务器可以根据客户端 IP 检查路由表

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T14:24:31.657

我认为在接受（）传入连接之后使用getsockname（）可能就是您所追求的。两个函数getsockname() 和getpeername() 分别获取套接字绑定的本地地址和远程地址。两者都应该对完全连接的 TCP 套接字有效。

编辑：虽然根据手册页这对于 OpenBSD 似乎是正确的，但 Linux 手册页差异很大，因此在 Linux 上 accept() 之后的 getsockname() 几乎可以肯定是没有用的。教我使用我的记忆而不是检查一切。*叹*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T13:18:48.507

查看目标地址。

每个接口通常绑定到一个唯一的地址。如果将多个接口绑定在一起，则使用哪一个可能并不重要。

唯一的例外是在使用 ipv6 任播时，但即便如此，您通常不会在具有相同 IP 的同一主机上拥有多个接口。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-14T17:15:11.003

在查看了似乎具有间接相似功能的 Wireshark 和 iftop 的源代码后，我正在添加另一个答案和一个潜在的解决方案。

在我看来，您可以使用 libpcap 来嗅探接口。假设您可以识别 TCP/IP 会话的某些独特部分，那么您可以使用过滤器和会话跟踪相当简单地将其跟踪到接口。

没有内核模块（它与线程配合得很好）

[http://www.ex-parrot.com/pdw/iftop/](http://www.ex-parrot.com/pdw/iftop/)一些简单的资源可以在 www.tcpdump.org/ 上查看 libpcap

我认为您也可以使用它来匹配 VLAN。

Wireshark 也可能对调试有用。希望这可以帮助！从那以后它就一直在我的脑海里。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-12T09:34:14.507

显然不是我深入研究过的东西，更不用说尝试了，这可能是“太疯狂了，它可能会起作用”的篮子……

如果它真的只适用于 Linux，您可以编写一个自定义[netfilter](http://www.netfilter.org/)模块来跟踪传入的连接并记录它们进入的接口，并将该信息写入某处以供您的服务器应用程序读取。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-12T14:27:51.830

Kieron 建议编写一个 netfilter 模块可能是一种尝试方法，但我不想为这个解决方案编写我的第一个内核模块。

我提出了另一种使用源 NAT 并将连接的源端口转换为与连接源相关联的选项。我可以为每个网络分配端口范围并在服务器中检查它。唯一的问题是 iptables 中的源 NAT 是在 POSTROUTING 链中完成的，我不确定它是否用于该主机接受的连接，所以我可能需要使用另一台服务器。

这里没有简单的解决方案，太糟糕了，我无法从套接字获取接口名称/索引......

# c# - 在 C# 3.5 中填充网格

> ID：848044
> 
> 赞同：0
> 
> 时间：2009-05-11T13:11:57.897
> 
> 标签：c#, wpf, .net-3.5, datagrid, google-docs

昨天我安装了 C# 3.5，今天在这里阅读“使用 Google Data API 使用 C# 访问 Google 电子表格”的主题时，我决定尝试一下。

所以我决定写一个例子，即：1）获取第一个电子表格的第一个工作表的数据馈送，该名称包含用户插入的字符串段 2）用数据填充网格

好吧，我必须分开，用电子表格值数据填充二维数组或列表列表。我一直在寻找一个控件来将数据放入并动态生成它，因为我事先不知道工作表的行或列。

我的直觉告诉我，我可以用 Dataset 更改 List>，然后开始尝试 IntelliSense 向我抛出的不同控件。我知道我应该先读一本书，但我迫不及待地不先尝试。

Xaml

```
<DockPanel Background="LightSteelBlue">

    <!-- Standard input -->
    <DockPanel DockPanel.Dock="Top" Margin="5">
        <TextBlock Margin="10,0,5,0" VerticalAlignment="Center">Username:</TextBlock>
        <TextBox x:Name="username" Width="120" Padding="5,0,5,0" Text="username@gmail.com" />
        <TextBlock Margin="10,0,5,0" VerticalAlignment="Center">Password:</TextBlock>
        <TextBox x:Name="password" Width="120" Padding="5,0,5,0" Text="password" />
        <TextBlock Margin="10,0,5,0" VerticalAlignment="Center">Workbook:</TextBlock>
        <TextBox x:Name="workbookname" Width="120" Padding="5,0,5,0" Text="name" />
        <Button x:Name="getData" Margin="5,0,0,0" Padding="5,0,5,0" Content="Get _Data" Click="getData_Click" />
    </DockPanel>

    <!-- Grid display -->
    <ListBox Name="lb2"/>

</DockPanel> 
```

和 c#

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

using System.Collections;
using Google.GData.Client;
using Google.GData.Extensions;
using Google.GData.Spreadsheets;

namespace getGoogleDocsSpreadsheetData
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private bool RunSample(
            String g_username,
            String g_password,
            String g_spreadsheetname
        ){
            SpreadsheetsService service = new SpreadsheetsService("Margus-stackoverflow_example-1");
            service.setUserCredentials(g_username, g_password);
            CellFeed cfeed = null;

            try {
                //get CellFeed of first Worksheet of first Spreadsheet, that contains _spreadsheetname
                cfeed = ((CellFeed)service.Query(new CellQuery(
                    ((WorksheetEntry)(service.Query(new WorksheetQuery(
                        ((SpreadsheetEntry)(
                            from fe in service.Query(new SpreadsheetQuery()).Entries
                            where fe.Title.Text.Contains(g_spreadsheetname)
                            select fe
                        ).First()).Links.FindService(
                            GDataSpreadsheetsNameTable.WorksheetRel,
                            null
                        ).HRef.ToString())).Entries.First())
                    ).Links.FindService(
                        GDataSpreadsheetsNameTable.CellRel,
                        null
                    ).HRef.ToString()))
                );

                /* get data to array
                string[,] values = new string
                    [(from sr in cfeed.Entries select ((CellEntry)sr).Cell.Row).Max()+1
                    ,(from sr in cfeed.Entries select ((CellEntry)sr).Cell.Column).Max()+1];

                foreach (CellEntry curCell in cfeed.Entries)
                    values[curCell.Cell.Row,curCell.Cell.Column] = curCell.Cell.Value;
                 */

                /* get data to list of list of string */
                List<List<string>> lists = new List<List<string>>();

                for (int i = 0; i < 1+ (
                    from sr in cfeed.Entries 
                    select ((CellEntry)sr).Cell.Row).Max(); i++
                ){
                    List<string> x = new List<string>();
                    for (int j = 0; j < 1+ (
                        from sr in cfeed.Entries 
                        select ((CellEntry)sr).Cell.Column).Max(); j++
                    )
                    x.Add(default(string));

                    lists.Add(x);
                }

                foreach (CellEntry curCell in cfeed.Entries)
                    (lists[(int)curCell.Cell.Row])[(int)curCell.Cell.Column] = curCell.Cell.Value;

                //fill datagrid
                this.lb2.ItemsSource = lists;              
            } catch (Exception e){
                System.Console.WriteLine("I exeeded failing!\n" + e.StackTrace);
                return false;
            }

            return true;
        }

        private void getData_Click(object sender, RoutedEventArgs e)
        {
            RunSample(
                this.username.Text,
                this.password.Text,
                this.workbookname.Text);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T13:50:56.170

我在 WPFToolkit 中使用了这个：

```
<my:DataGrid Margin="0,29,0,0" Name="dataGridView" xmlns:my="http://schemas.microsoft.com/wpf/2008/toolkit" AlternatingRowBackground="AliceBlue" ItemsSource="{Binding Path=.}" CanUserResizeRows="False" ClipboardCopyMode="IncludeHeader" IsReadOnly="True" IsTabStop="True" AutoGeneratedColumns="dataGridView_AutoGeneratedColumns" /> 
```

后面有一些代码来填充它：

```
private DataTable dataTable;

public Constructor()
{
    ....
    this.dataTable = new DataTable();

    dataGridView.DataContext = dataTable;
    ....
} 
```

# asp.net - 如果我只是在做一个查找表，我应该使用自动生成的主键吗？

> ID：848045
> 
> 赞同：3
> 
> 时间：2009-05-11T13:12:10.410
> 
> 标签：asp.net, sql, performance

我有一个有两个 varchar(Max) 列的表

```
Column 1      Column 2
-----------------------
URLRewitten   OriginalURL 
```

它是我为 asp.net webforms 站点重写的 url 的一部分。

当一个 url 进来时，我会检查它是否在表中，如果它是我使用 OriginalURL。

我的问题是，如果我所做的只是查询表中的 url，并且数据库中没有其他表会链接到该表，它是否需要专用的主键字段？像自动号码？这会使查询更快吗？

以及如何使查询运行得更快？

编辑：我确实对 URLRewitten 有一个独特的限制。

编辑：我使用这张桌子的方式..

*   当有新请求进来时查询.. 搜索 URLRewitten 以找到 OriginalURL
*   当需要在网站上显示链接时，我在 OriginalURL 上查询以找到我应该使用的 URLRewitten url。
*   向表中添加新 url 时，我确保它不存在。

这就是我所做的所有查询.. 目前。

两列一起将是唯一的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T13:17:42.597

你需要一个主键吗？是的。总是。但是，在您的情况下，OriginalURL 看起来可能是您的主键（我假设对于 OriginalURL 中的给定值，URLRewritten 的值不会超过一个）。

这就是所谓的“自然键”（数据本身的一个组成部分就其性质而言是唯一的）。这些可能很方便，尽管我发现在大多数情况下它们通常比它们的价值更麻烦，所以是的，我会推荐某种不透明的键（意味着与行中的数据无关的键，而不是识别单行）。是否需要自动编号取决于您。这当然很方便，尽管标识列有自己的优点和缺点。

现在我想我会建议创建两件事：

1.  标识列表上的主键
2.  对 OriginalURL 的唯一约束以强制执行数据完整性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T13:18:50.970

无论如何，我都会在其中放一个...它会使更新或复制现有规则变得更加容易...

即这更容易

```
UPDATE Rules SET OriginalURL = 'http://www.domain.com' WHERE ID = 1

--OR

INSERT INTO Rules SELECT OriginalUrl, NewUrl FROM Rules WHERE ID = 1 
```

比这个

这更容易

```
UPDATE Rules SET OriginalURL = "http://www.domain.com" WHERE OriginalURL = 'http://old.domain.com'

--OR

INSERT INTO Rules SELECT OriginalUrl, NewUrl FROM Rules WHERE OriginalURL = 'http://old.domain.com' 
```

在性能方面，如果您要通过 OriginalURL 进行搜索，您应该在该列中添加一个索引，

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T13:23:01.677

我会使用 OriginalURL 作为您的主键，因为我认为这是唯一的。假设您使用的是 SQL-Server，您可以在 RewrittenURL 上创建一个索引，并将 OrigionalURL 作为“包含列”，以加快查询的性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T13:18:46.197

当您搜索最近的事件时，标识列可以提供帮助：

```
select top 100 * from table order by idcolumn desc 
```

我们必须知道您正在运行什么样的查询，然后才能寻找一种使查询速度更快的方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T13:19:23.230

当您在 URLRewritten 列上进行查询时，我认为添加自动生成的主键不会对您有所帮助。

您的 URLRewritten 列上有索引吗？如果没有，请创建一个：这应该会大大提高您的查询速度（也许只是让 URLRewritten 成为您的主键？）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T13:20:18.363

我认为添加自动生成的主键不会使您的查询更快。

不过有几点需要考虑：

1.  我不太确定，永远不会有任何东西链接到这个表:(。
2.  我见过很多人询问如何从这样的表中删除重复项——使用主键更容易。
3.  为了使这个查询更快，我们需要更多地了解这个表和使用它的方法......

在我看来，**每个表**都必须有自动生成的主键（即 MSSQL 中的标识）。

我不相信独特的自然键。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T13:22:33.770

是的，应该有一个主键，因为您可以在该主键上设置 INDEX 以便快速访问

# ruby-on-rails - 如何在rails中的模拟对象中加载夹具以进行测试？

> ID：848046
> 
> 赞同：1
> 
> 时间：2009-05-11T13:12:11.360
> 
> 标签：ruby-on-rails

我有一个应该从网络上获取数据的 gem，但是当我在测试时，我想使用一个模拟对象。我希望能够使用 rails 固定装置在模拟对象中加载数据。模拟对象在[这里](http://github.com/dsimard/spreedly-gem/blob/eadfbf4afa1d3fb3eae4006bab60a7f320717401/lib/spreedly/mock.rb)。

我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-06-01T22:44:07.877

快进 4 年，现在有一个宝石。

[网络模拟](https://github.com/bblimke/webmock)。gem 基本上会关闭所有传出的 api 调用，然后在错误响应中插入一堆代码供您粘贴。从那里，您可以将其调整为该响应所需的代码需求。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-11T14:55:55.510

> 如果您有任何问题或要求，请发送电子邮件至 support@spreedly.com。

这是一个通过订阅赚钱的商业网站。他们应该非常愿意为您提供所需的帮助。

# javascript - JavaScript项目符号列表生成

> ID：848060
> 
> 赞同：1
> 
> 时间：2009-05-11T13:17:46.370
> 
> 标签：javascript

我使用的是 Rails 2.2，以及标准的 JavaScript 库，我们也使用 jQuery。

鉴于此，谁能告诉我创建 UI 组件的起点，该组件允许用户创建项目符号列表、添加项目符号/删除项目符号/缩进子项目符号等？我不一定要使用我们已经拥有的库，但认为它更可取。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T13:25:43.030

您是否尝试过 TinyMCE 之类的东西？您可以对其进行自定义以具有您想要的任何控件。

[http://tinymce.moxiecode.com/](http://tinymce.moxiecode.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T13:46:00.517

[树视图插件](http://bassistance.de/jquery-plugins/jquery-plugin-treeview/)会为你做吗？它不是一个项目符号列表，而是一个现成的组件，允许您创建一组有序的元素。

# sqlite - 在 SQLite 中使用 bool > date > null 排序

> ID：848071
> 
> 赞同：1
> 
> 时间：2009-05-11T13:19:27.613
> 
> 标签：sqlite, sql-order-by

我有一个 looooooooooooong SELECT 以 ORDER BY 结尾，可以包含以下值：

*   选中（1 或 0）
*   日期 (YYYY-MM-DD)
*   时间 (HH:MM:SS)

我想通过以下方式订购查询结果：

```
|__checked = 0
|            |__ date ASC
|            |__ time ASC
|            |__ date && time are null  
|__checked = 1
             |__ date ASC
             |__ time ASC
             |__ date && time are null 
```

现在，我得到了一些简单的东西，比如“ORDER BY i1.checked, date, time”，但问题在于日期和时间为空的项目保持在顶部。

* * *

如果您认为需要所有数据来找到合适的解决方案，这里就是整个查询。不要尖叫。

```
SELECT i1._id AS _id, i1.title AS title, i1.checked AS checked, 

   // count the children (-1 is because the closure table include a relation between any item and itself)   
   (count( c1.item_id )  - 1) AS children_count, 

   // count the unchecked children 
   (SELECT (COUNT(DISTINCT i2._id) ) 
   FROM item AS i2 JOIN closure AS c2 ON (i2._id = c2.item_id) 
   WHERE c2.ancestor_id = i1._id 
   AND i2.checked = 0  
   AND c2.item_id NOT IN (0, i1._id)) AS unchecked_children_count, 

   // get the closest deadlines among the children :
   // if there is a date but no time, time is set to 00:00:00
   // if there is a time but not date, date is set to today
   // if there is no date nor time, both are set to an empty string

   // date
   ifnull(nullif((SELECT ifnull(nullif(i3.date, ""), date()) AS subdate
                  FROM item AS i3 JOIN closure AS c3 ON (i3._id = c3.item_id) 
                  WHERE c3.ancestor_id = i1._id
                  AND (i3.date OR i3.time) 
                  ORDER By subdate, ifnull(nullif(i3.time, ""), "00:00:00") 
                  LIMIT 1), ""), "") AS date, 

   // time           
   ifnull(nullif((SELECT ifnull(nullif(i4.time, ""), "00:00:00") AS subtime
                  FROM item AS i4 JOIN closure AS c4 ON (i4._id = c4.item_id) 
                  WHERE c4.ancestor_id = i1._id 
                  AND (i4.date OR i4.time) 
                  ORDER By ifnull(nullif(i4.date, ""), date()), subtime 
                  LIMIT 1), ""), "") AS time 

FROM item AS i1 JOIN closure AS c1 ON ( i1._id = c1.ancestor_id ) 
WHERE i1.parent_id = 0
AND c1.item_id != 0 

GROUP BY c1.ancestor_id 

ORDER BY i1.checked, date, time 
```

这些项目被组织在一个带有 parent_id 和一个闭包表的树中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T13:25:52.297

```
ORDER BY il.checked, 
         CASE WHEN date IS NULL AND time IS NULL THEN 1 ELSE 0 END, 
         date, time 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T13:25:45.680

您可以在围绕所有 sql 的包装选择中创建一个额外的`temp`列，以允许您添加人工订单。

```
SELECT
    EACH_COLUMN
    , ...
    , CASE WHEN DATECol IS NULL AND TimeCol is NULL THEN 0 
         WHEN TimeCol is NULL THEN 1
         WHEN DATECol IS NULL THEN 2
         ELSE 3 END As ORDERCOL...

FROM
(
     INNER MESS OF ALL THE STUFF IN YOUR QUERY
)

ORDER BY
    ORDERCol DESC --Preserves order of BothCols Populated, Null Dates Next, Null Times Next, Both Nulls Last
    , Checked
    , Date
    , Time 
```

# logging - 什么是最好的网络日志分析软件？

> ID：848077
> 
> 赞同：0
> 
> 时间：2009-05-11T13:20:23.197
> 
> 标签：logging, browser, web

我们目前正在使用 SurfStats，我目前正在试用 Sawmill 作为可能的替代品，因为它不需要 Google Analytics 所做的代码注入。

是否有更好的软件包可用，或者注入自己的代码（网站是 ASP.Net - VS2003）并编写自己的分析应用程序更好？有没有人有这样做的经验？

非常感谢帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T13:34:14.240

[在这里](https://stackoverflow.com/questions/844684/website-analytics-haveamint-com-or-google-analytics)看看我的一个类似问题，很多人给出了几种不同的选择

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:13:18.467

微软的[logparser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)很不错。

杰夫阿特伍德在[这里描述它](http://www.codinghorror.com/blog/archives/000369.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T13:12:55.120

发现[Sawmill](http://www.sawmill.net/)确实非常好！虽然很贵。

# c# - C# 2.0 中的堆栈集合缺少 shift 和 unshift

> ID：848082
> 
> 赞同：3
> 
> 时间：2009-05-11T13:22:42.740
> 
> 标签：c#, collections, .net-2.0

奇怪的是，堆栈集合似乎缺少相当基本的 shift 和 unshift 方法*，我正在使用 2.0，所以我不能只是扩展它们。

是否有任何合理的技术或替代集合类来使这些方法可用？我也需要推送和弹出。

编辑：看起来我想要的集合确实是一个[双端队列](http://en.wikipedia.org/wiki/Double-ended_queue)，很高兴不是 C# 原生的:(

目前不能使用第三方库，所以我将使用笨重的 LinkedList（我说笨拙是因为读取和删除是两个操作中的一个），但我认为我会向任何使用 PowerCollections 方法的人推荐可以使用它。或者更好的是，升级到扩展方法。

*叹*

* * *

* 抱歉，我没有意识到这些是不常见的术语，我以为我只是不知道在 API 中的哪里可以找到它们。以供参考：

shift = 删除第一个元素

unshift = 在集合开始处插入元素

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T13:32:25.477

我会说使用[`LinkedList<T>`](http://msdn.microsoft.com/en-us/library/he2s3bh7.aspx). 它具有从前面添加和删除的方法，以及从后面添加和删除的方法。我从来没有听说过换档和不换档，但我假设这就是它的意思。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-11T13:25:00.987

从未听说过堆栈中的移位/取消移位。Stack 类确实提供了`Pop`、`Peek`和`Push`虽然。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-11T13:46:06.197

You are using the wrong class if you want a shift/unshift method. A `stack` is a Last-In First-Out (LIFO) data structure.

If you want shift/unshift without pop and push, use a `Queue`. If you want both, I recommend using `Deque` from the [PowerCollections](http://powercollections.codeplex.com/ "PowerCollections") library

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T13:29:52.940

只要您使用面向 2.0 的 C# 3.0，就可以[伪造扩展方法。](https://stackoverflow.com/questions/707145/extension-method-in-c-2-0)

你能描述一下什么是换档/取消换档操作吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T13:44:39.537

By definition **Stack** class represents a way of managing elements in a collection using the Last In First Out (LIFO) technique for adding and removing elements. LIFO simply means that the last element added to a collection will automatically be the first one removed.

The functionality you want from it is something custom, but easily can be achieved in following way

```
public class MyStack<T>:Stack<T>{
  public void Shift(T item){
     // load stack into internal ordered list
     // clear stack content
     // insert into internal list at desired location
     // populate stack with content from internal list
  }
  public void Unshift(T item){
     // load stack into internal ordered list
     // clear stack content
     // insert into internal list at desired location
     // populate stack with content from internal list
  }
} 
```

and seems this it-s all :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-23T00:09:10.533

This is not exactly the best, but it comes close to being a Javascript array with shift/unshift and push/pop. Its does not hide the inner workings, and you can index any item you want. I has the basic functionality though.

```
 public class JSList<T> : List<T>
{
    public JSList() : base() {}

    /// <summary>
    /// this the add item to the start of the list
    /// </summary>
    /// <param name="v"></param>
    public void Shift(T v)
    {
        this.Insert(0, v);
    }

    /// <summary>
    /// remove item at the start of the list
    /// </summary>
    /// <returns></returns>
    public T Unshift()
    {
        var toreturn = default(T);
        if (this.Count > 0)
        {
            toreturn = this[0];
            this.RemoveAt(0);
        }
        return toreturn;
    }

    /// <summary>
    /// Adds object to end of the list
    /// </summary>
    /// <param name="v"></param>
    public void Push(T v)
    {
        this.Add(v);
    }

    /// <summary>
    /// removes an item at the end of the list
    /// </summary>
    /// <returns></returns>
    public T Pop()
    {
        var toreturn = default(T);
        if (this.Count > 0)
        {
            toreturn = this[this.Count - 1];
            this.RemoveAt(this.Count - 1);
        }
        return toreturn;
    }

    public T Peek()
    {
        return this[this.Count - 1];
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T14:02:13.760

```
Shift ==> Stack.Pop
Unshift ==> Stack.Push 
```

`Unshift` doesn't return the number of elements in the Stack, you have the `Stack.Count` property for that.

Also, there's `Stack.Peek`, to get the first element without removing it.

[Stack<T> class](http://msdn.microsoft.com/en-us/library/06wcad5h.aspx)

# c# - 如何使用 C# 获取 PDF 文件中的彩色页数？

> ID：848083
> 
> 赞同：4
> 
> 时间：2009-05-11T13:22:45.377
> 
> 标签：c#, pdf

给定一个带有彩色和黑白页面的 PDF 文件，C# 有什么方法可以在给定的页面中找出哪些是彩色的，哪些是黑白的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T06:45:08.433

我的建议是将每个页面呈现为图像，然后检查每个像素的 RGB 值是否彼此不相等。如果每个像素的 R=G=B，那么它就是灰度图像。

然后，您可以根据页面是彩色页面还是黑白页面等对页面执行操作（例如将页面提取到另一个文档或打印页面）。

这可以通过使用我公司的 PDF 开发人员库[Quick PDF](http://www.quickpdflibrary.com/)或可能通过 Kenneth 建议的开源 PDF 库之一来实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:33:38.830

缺少解析所有后记内容，可能不是。PDF 页面上没有标志表明它是或不是黑白或彩色。因此，您必须检查放置在页面上的每个元素的颜色，以确定它是否为颜色。我不确定有哪些库可用于在 C# 上阅读 PDF，但您需要一个能够阅读所有元素的库。

同样，页面上的任何图像都需要检查颜色，这并不简单。彩色图像格式可以保存黑白图像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T22:00:05.507

查看：

[PDF-分析器](http://www.is-soft.de/pdfanalyzer/produkte.htm)

我使用他的工具进行文本提取和 pdf 分析。非常便宜，免版税，并且运行良好。我认为 GetPDFColourStyle 作为[PDFLayoutPlus](http://www.is-soft.de/pdfanalyzer/prod12.htm)库的一部分应该可以解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-24T00:23:58.143

有一个解决方案。

您可以解析每个页面的内容字节并查找诸如“rg、RG、k、K、sc、SC、scn、SCN”之类的颜色运算符，并读出每个页面中定义的所有颜色值和颜色空间。

看看这个例子：**[http ://habjan.blogspot.com/2013/09/proof-of-concept-converting-pdf-files.html](http://habjan.blogspot.com/2013/09/proof-of-concept-converting-pdf-files.html)**

它实现/解析所有颜色运算符，我认为这将是一个很好的起点和参考，可以帮助您编写所需的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-23T03:27:23.520

将每一页转换为位图图像，然后查看图像中的每个像素，您将能够捕捉颜色，然后区分彩色页面。

有关更多详细信息，请参阅[此帖子](https://stackoverflow.com/q/18757027/1834352)。

注意：如果您是为了打印而检测这种颜色，那么您必须检测 CMYK 颜色而不是 RGB，CMYK 是打印机标准颜色模式，RGB 是显示颜色模式。

# sql-server - XQuery in SQL server doing SUM over zero value

> ID：848085
> 
> 赞同：11
> 
> 时间：2009-05-11T13:23:16.950
> 
> 标签：sql-server, xml, tsql, xquery

I'm trying to extract monetary sums stored in some poorly formated xml columns (there is no schema defined for the XML column which I guess is part of the problem). I'm getting a conversion error whenever I encounter a node with 0 as its value.

Example:

```
select xml.value('sum(/List/value)', 'numeric') sum
from (select cast('<List><value>1</value><value>2</value></List>' as xml) xml) a 
```

gives the sum 3 while:

```
select xml.value('sum(/List/value)', 'numeric') sum
from (select cast('<List><value>0</value><value>0</value></List>' as xml) xml) a 
```

raises the error: "Error converting data type nvarchar to numeric."

Any idea how I can make my query return 0 when summing up a list of zero-valued nodes?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T14:17:08.333

Your comment suggests an answer to your problem.

Instead of converting to numeric, convert to float. Scientific notation will convert to float.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-06-30T21:55:46.393

you can also use and if statement like this:

```
@x.value('if (sum(/List/value) = 0) then 0 else sum(/List/value)', 'numeric') 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-08-13T15:09:04.753

I stumbled across this question, and ultimately an answer, while looking at a similar issue with integers. Despite the delay since the last answer, I'm adding here in case it helps anyone else in future.

First your basic answer:

```
select xml.value('xs:decimal(sum(/List/value))', 'numeric') sum
from (select cast('<List><value>0</value><value>0</value></List>' as xml) xml) a 
```

In XQuery you can cast the value to a standard XML Schema type, which will then be handled correctly by SQL Server.

PLEASE NOTE: the default "numeric" in SQL Server does not have any decimal places(scale of "0")! You probably intended to do something more like:

```
select xml.value('xs:decimal(sum(/List/value))', 'numeric(20,5))') sum
from (select cast('<List><value>0</value><value>0</value></List>' as xml) xml) a 
```

(you cannot get SQL Server to infer the precision or scale from the value returned from the Xml, you must explicitly specify it)

Finally, the actual issue that I personally needed to address was almost exactly the same, except I was dealing with integers, which also struggle with the xml representation of "0" `double` values:

```
select xml.value('xs:int(sum(/List/value))', 'int') sum
from (select cast('<List><value>0</value><value>0</value></List>' as xml) xml) a 
```

**UPDATE:** The problem with the decimal-handling solution I posted above (converting to decimal in XQuery before SQL gets to parsing the value) is that the *aggregation* actually happens with the (assumed/inferred) floating point (double) data type. If the values you have stored in your Xml require a high degree of precision, this may actually be the wrong thing to do - the floating-point aggregation may actually result in a loss of data. EG here we lose the last digit of the number we are summing:

```
select xml.value('xs:decimal(sum(/List/value))', 'numeric(28, 0)') sum
from (select cast('<List>
        <value>1000000000000000000000000001</value>
        <value>1000000000000000000000000001</value>
    </List>' as xml) xml) a 
```

(comes out to "2000000000000000000000000000", which is wrong)

This issue equally applies to other approaches offered here, such as explicitly reading the value as "float" in T-SQL.

To avoid this, here's a final option using an XQuery FLWOR expression to set the data type *before* the aggregation operation. In this case, the aggregation occurs correctly, and we have the correct summed value (while also handling "0" values if/when they occur):

```
select xml.value('sum(for $r in /List/value return xs:decimal($r))', 'numeric(28, 0)') sum
from (select cast('<List>
        <value>1000000000000000000000000001</value>
        <value>1000000000000000000000000001</value>
    </List>' as xml) xml) a 
```

(comes out to "2000000000000000000000000002", the correct value)

# vb6 - 如何使用 VB6 复制打开的文件？

> ID：848087
> 
> 赞同：3
> 
> 时间：2009-05-11T13:24:34.467
> 
> 标签：vb6

我有一个将文件附件上传到数据库 BLOB 字段的旧版 VB6 应用程序。除非用户打开文件，否则它工作正常。

我尝试创建文件的副本，然后上传该副本，但令我惊讶的是，每当您尝试复制用户打开的文件时，FileCopy 过程都会出现“权限被拒绝”错误。

这让我很吃惊，因为您可以在 Windows 资源管理器中复制打开的文件，并且我假设 FileCopy 方法使用与资源管理器相同的 API 调用。

无论如何，我的问题是：**如何在 VB6 中复制打开的文件？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T13:33:07.177

**回答我自己的问题：**

[根据这篇文章](http://support.microsoft.com/kb/172711)，对我有用的答案如下所述。

1 - 将此声明添加到 VB 文件中：

```
Declare Function apiCopyFile Lib "kernel32" Alias "CopyFileA" _
      (ByVal lpExistingFileName As String, _
      ByVal lpNewFileName As String, _
      ByVal bFailIfExists As Long) As Long 
```

2 - 为该函数创建一个小包装器，如下所示：

```
Sub CopyFileEvenIfOpen(SourceFile As String, DestFile As String)
  Dim Result As Long
   If Dir(SourceFile) = "" Then
     MsgBox Chr(34) & SourceFile & Chr(34) & " is not valid file name."
   Else
     Result = apiCopyFile(SourceFile, DestFile, False)
   End If
End Sub 
```

3 - 将我之前对 FileCopy 的调用替换为：

```
CopyFileEvenIfOpen sourceFile, tempFile 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T23:24:55.557

如果您想在不使用 api 的情况下做同样的事情：

函数 SharedFilecopy（ByVal SourcePath 作为字符串，ByVal DestinationPath 作为字符串）

```
Dim FF1 As Long, FF2 As Long
Dim Index As Long
Dim FileLength As Long
Dim LeftOver As Long
Dim NumBlocks As Long
Dim filedata As String
Dim ErrCount As Long
On Error GoTo ErrorCopy
'-------------
'Copy the file
'-------------
Const BlockSize = 32767
FF1 = FreeFile
Open SourcePath$ For Binary Access Read As #FF1
FF2 = FreeFile
Open DestinationPath For Output As #FF2
Close #FF2

Open DestinationPath For Binary As #FF2

Lock #FF1: Lock #FF2

FileLength = LOF(FF1)
NumBlocks = FileLength \ BlockSize
LeftOver = FileLength Mod BlockSize

filedata = String$(LeftOver, 32)

Get #FF1, , filedata
Put #FF2, , filedata
filedata = ""
filedata = String$(BlockSize, 32)

For Index = 1 To NumBlocks
    Get #FF1, , filedata
    Put #FF2, , filedata
Next Index
Unlock #FF1: Unlock #FF2
SharedFilecopy = True 
```

退出副本：

```
Close #FF1, #FF2 
```

退出函数

错误复制：ErrCount = ErrCount + 1

如果 ErrCount > 2000 那么

```
SharedFilecopy = False

Resume exitcopy 
```

别的

```
Resume 
```

万一

结束功能

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-09-13T22:07:56.917

更短的解决方案：

1-项目->参考。检查“Microsoft 脚本运行时”

2-使用这个：

```
Dim fso As New FileSystemObject 
fso.CopyFile file1, file2 
```

# javascript - jQuery，悬停方法和闭包

> ID：848088
> 
> 赞同：3
> 
> 时间：2009-05-11T13:24:52.907
> 
> 标签：javascript, jquery, closures

一段时间以来一直在努力解决 Javascript 闭包问题，试图将大脑包裹在函数范围内，但我认为它们正在包裹着我。我看过很多帖子（Nyman 的帖子最有帮助），但显然还是不明白。尝试在 jQuery 中的悬停方法上运行循环。需要悬停功能来最终触发一个以上的动作，但现在很高兴让它们使用单​​个图像交换。

```
$(document).ready(function() {

    imageSource = []; 
    imageSource[0] = 'images/img0.png'  //load 0 position with "empty" png
    imgArea = [];

    for (var i=1; i<11; i++) {

        (function( ){  //anonymous function for scope

            imageSource[i] = 'images/img' + i + '.png';
            imgArea[i] = '#areamap_Img' + i;

            // running console.log here gives expected values for both

            $(imgArea[i]).hover(   //imgArea[i] (selector) works correctly here

                function() {
                    $('#imgSwap').attr('src',imageSource[i]);  // imageSource[i] is undefined here
                },
                function() {
                    $('#imgSwap').attr('src','images/img0.png');
                });

        })(); // end anonymous function and execute

    }; // for loop

}); 
```

尝试使用匿名函数从另一个 jQuery 帖子中确定范围的想法。似乎工作正常，但在第一个悬停函数中为数组值抛出了一个未定义的值，我猜是因为它是一个内部函数（硬编码的图像源在那里正常工作）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T13:33:03.057

您的闭包确实存在问题，这与您对 var 的使用有关`i`。由于您的匿名函数没有本地版本`i`，因此它使用的是上面函数的版本。`i`但是，当它稍后尝试访问时， `i`== 11（因为这就是导致循环终止的原因）。要解决此问题，您需要`i`在每个匿名函数中声明一个本地版本，如下所示：

```
for (var i=1; i<11; i++) {

    (function( ){  //anonymous function for scope                
            var index = i; // The important part!

            // It's not technically necessary to use 'index' here, but for good measure...
            imageSource[index] = 'images/img' + index + '.png';
            imgArea[index] = '#areamap_Img' + index;

            $(imgArea[index]).hover(

                    function() {
                            $('#imgSwap').attr('src',imageSource[index]);  // Here's where `index` is necesssary.
                    },
                    function() {
                            $('#imgSwap').attr('src','images/img0.png');
                    });

    })(); // end anonymous function and execute

}; // for loop 
```

此外，您的代码中存在一个小问题，您应该修复它只是为了更好地衡量。您没有正确访问局部变量；你应该使用：

```
var imageSource = []; 
var imageSource[0] = 'images/img0.png'  //load 0 position with "empty" png
var imgArea = [] 
```

如果没有“var”，您将声明和访问全局变量。（如果这是您的预期行为，那么我道歉。）

# php - 如何在 PHP 中获取用户的 IP 地址？

> ID：848091
> 
> 赞同：2
> 
> 时间：2009-05-11T13:25:18.240
> 
> 标签：php

### 复制：

> [如何使用 php 找到用户的 IP 地址？](https://stackoverflow.com/questions/55768/how-do-i-find-a-users-ip-address-with-php)

编辑：服务器是一个通过 suPHP 运行 PHP5 的 Debian linux 机器。以上帖子已阅读。此代码涵盖了所有提到的点，但仍返回未知地址。

我的代码总是要求知道远程 IP 地址。一旦我们可以获得一些访问的IP地址，我们是否选择代理地址并不重要。

下面的函数是我们目前使用的，但是在超过 20% 的套件中，服务器会陷入未知情况，并且 $_SERVER 变量中没有任何内容。

```
function getip()
{
    if ( $_SERVER["HTTP_CLIENT_IP"] && strcasecmp($_SERVER["HTTP_CLIENT_IP"], "unknown") )
    {
        $ip = $_SERVER["HTTP_CLIENT_IP"];
    }
    else if ( $_SERVER["HTTP_X_FORWARDED_FOR"] && strcasecmp($_SERVER["HTTP_X_FORWARDED_FOR"], "unknown") )
    {
        $ip = $_SERVER["HTTP_X_FORWARDED_FOR"];
    }
    else if (getenv("REMOTE_ADDR") && strcasecmp(getenv("REMOTE_ADDR"), "unknown"))
    {
        $ip = getenv("REMOTE_ADDR");
    }
    else if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], "unknown"))
    {
        $ip = $_SERVER['REMOTE_ADDR'];
    }
    else
    {
        $ip = "unknown: ".var_dump($_SERVER, true);
    }
    return($ip);
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T13:39:01.437

[通过 google 找到的一些随机博客](http://roshanbh.com.np/2007/12/getting-real-ip-address-in-php.html)。有趣的代码其实是在评论里，而不是博主提到的。

```
function getIpAddress() 
{
    return (empty($_SERVER['HTTP_CLIENT_IP'])?(empty($_SERVER['HTTP_X_FORWARDED_FOR'])?
    $_SERVER['REMOTE_ADDR']:$_SERVER['HTTP_X_FORWARDED_FOR']):$_SERVER['HTTP_CLIENT_IP']);
}

function getRealIpAddr()
{
    if (!empty($_SERVER['HTTP_CLIENT_IP']))   //check ip from share internet
    {
      $ip=$_SERVER['HTTP_CLIENT_IP'];
    }
    elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR']))   //to check ip is pass from proxy
    {
      $ip=$_SERVER['HTTP_X_FORWARDED_FOR'];
    }
    else
    {
      $ip=$_SERVER['REMOTE_ADDR'];
    }
    return $ip;
} 
```

# windows - 如何为子控件绘制透明区域？

> ID：848101
> 
> 赞同：1
> 
> 时间：2009-05-11T13:29:31.397
> 
> 标签：windows, mfc, transparency, tabcontrol, paint

我有一个 CTabCtrl 子类，我正在尝试覆盖 WM_PAINT 来执行自定义绘图。唯一的问题是，当我更改选定的选项卡时，我会在对话框中留下伪影，在新代码绘制在顶部之前，旧的绘制代码还没有被擦除。（标准选项卡控件使选定选项卡显示比未选定选项卡大 2 个像素，因此当您从选定选项更改为非选定选项时，您会留下以前的绘画工件）。

“重新粉刷”这个区域的最佳方法是什么？我尝试将父控件的 DC 和 BitBlt'ing 放到子 DC 上，但这不起作用，因为父 DC 已经包含此控件的图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T01:25:45.930

您是否也覆盖了 WM_ERASEBACKGROUND 消息？您可能应该这样做并擦除控件中的区域。

如果您不想替换所有绘图逻辑，可以使用[DrawThemeParentBackground来绘制背景（XP 及更高版本）。](http://msdn.microsoft.com/en-us/library/bb773306.aspx)

# apache-flex - 如何将 php 页面的链接提供给具有 flex 状态的另一个 URL？

> ID：848107
> 
> 赞同：4
> 
> 时间：2009-05-11T13:31:12.297
> 
> 标签：apache-flex, flash-html-interaction

如果我想直接导航到某个 flex 应用程序的第二个状态，则必须从另一个 php 页面提供链接。怎么做？如果我给出正常的 URL，它无论如何都会让我进入第一个状态。但我希望它直接进入第二个状态。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T13:32:54.773

通过 flashvars 传递状态。然后使用传入的任何内容来定义状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T13:35:22.570

最好的方法是使用深度链接。它需要更多的工作，但无论如何在您的应用程序中还有其他好处。

[http://livedocs.adobe.com/flex/3/html/help.html?content=deep_linking_1.html](http://livedocs.adobe.com/flex/3/html/help.html?content=deep_linking_1.html)

基本上，您只需提供 url 并在末尾添加额外信息，例如：

[http://myurl.com/myapplication.html#state=second](http://myurl.com/myapplication.html#state=second)

另一种方法是像 Zack 所说的那样通过 flashvars 传递状态，然后在 creationComplete 上更改您的状态。

# .net - nhibernate和虚拟类属性？

> ID：848108
> 
> 赞同：18
> 
> 时间：2009-05-11T13:31:22.813
> 
> 标签：.net, nhibernate

刚刚阅读 nHibernate，为什么类属性必须是虚拟的？

这背后的原因是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-11T13:33:33.493

我建议您阅读[NHibernate 中的所有内容都必须是虚拟的吗？](http://web.archive.org/web/20090401144951/http://davybrion.com/blog/2009/03/must-everything-be-virtual-with-nhibernate/)

> 对这个问题的快速回答是：因为我们需要成员是虚拟的才能执行我们的延迟加载魔法/巫术。
> 
> 不过，更长的答案更有趣。任何真正的 ORM 必须具备的一个重要特性是透明的延迟加载。如果您通过 ORM 检索对象，您不希望它自动拉入整个对象图（无论如何默认情况下都不是），但您不希望在代码中乱扔检查是否已加载某些关联然而，然后在必要时加载它们。这是 ORM 的职责。理想情况下，如果尚未检索到数据，您希望能够访问属性并让 ORM 在首次访问这些属性时加载必要的数据。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T15:54:07.377

正如安德鲁所说，属性是虚拟的以触发延迟加载。这里解释一下为什么会这样： 在运行时 NHibernate 会用代理对象代替你的真实属性对象。一旦它们被访问，代理对象就知道如何为您获取真实对象。将属性标记为虚拟允许这种替换发生。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-07-19T01:48:33.080

如果您不使用上述非虚拟方法，您可以简单地添加`SetProperty`以下代码段：

```
 NHibernate.Cfg.Configuration cfg = new NHibernate.Cfg.Configuration().SetProperty(NHibernate.Cfg.Environment.UseProxyValidator, Boolean.FalseString) 
```

这只是关闭导致错误的验证，确保您没有使用非虚拟方法，因为 NHibernate 将无法代理它们（如原始错误所建议的那样）。

# .net - 通过 ADO.Net 从 DB 中获取特定行

> ID：848123
> 
> 赞同：0
> 
> 时间：2009-05-11T13:34:55.097
> 
> 标签：.net

我有一个包含 10 条记录的表。我想从中获取第 5 行和第 7 行。有没有办法在 ADO.NET 中实现这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T13:43:16.437

如果您的表真的那么小（即 10 行），为什么不只检索所有 10 行，然后遍历它们以到达第 5 行/第 7 行……就直接选择它们而言……您的表怎么样关键的。即什么决定了第 5 行和第 7 行是什么？

您是否在查询中应用 ORDER BY...

如果您想根据某些特定顺序从顶部获得第 7 行，您可以做一些 UGLY Like。

```
SELECT 
    Top 1 * 
FROM 
(
    SELECT 
        Top 7 * 
    FROM 
        TABLE ORDER BY 1 ASC
) as a
ORDER BY 1 DESC 
```

或者，如果您正在使用具有 RowNumber() 函数的 SQL2005/Oracle/另一个 DBMS，例如用于分页，那么它也可以工作，但这完全取决于表的结构、您正在使用的数据库以及如何使用您正在检索该信息...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T13:44:05.047

通常，当您返回查询时，您不会恢复特定的行。这次您的第 5 行可能是一些特定数据，但可能随时更改，因为没有数据库引擎可以确保查询将返回该特定行，除非您可以使用 where 子句明确指定它。
在您想要返回特定行的奇怪情况下，这将根据您使用的数据库而改变（您可以在 oracle 中使用 rownumber 的组合，或在 sql server 中使用 top ）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:43:09.150

这在很大程度上取决于您使用的数据库类型。不同的数据库（如 SQL Server 和 MySQL）有不同的处理“分页”的方法，这基本上是您想要完成的。即使是不同的版本，如 SQL Server 2000，其方法也与 2005 等不同。

这是[一个](http://www.wwwcoder.com/main/parentid/191/site/2124/68/default.aspx)可以帮助您开始理解概念和实现的资源。这是[另一个](http://cf-bill.blogspot.com/2007/01/select-specific-row-in-sql-server-2005.html)可能更接近您正在寻找的东西。

# c++ - 编写良好的 C++ 示例

> ID：848126
> 
> 赞同：7
> 
> 时间：2009-05-11T13:36:33.173
> 
> 标签：c++, coding-style

我目前正在学习 C++，并想开始阅读其他源代码以获取提示。我想知道是否有人有我可以看看的写得很好的 C++ 的例子（而不是从中吸取坏习惯）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T13:43:35.030

您可能已经发现，C++ 代码示例的 Internet 资源有很多。StackOverflow、CodeProject 等都有源码的例子。但当然，就质量和教育价值而言，它们无处不在。

我认为，在这方面，书籍仍然胜过互联网。没有什么可以替代去书店，翻阅几本书，然后挑选一本你觉得可读的书。它们已经过校对（与互联网提交的内容不同），因此样本更有可能有效且质量更高。

虽然这些书通常有一小段代码或一些功能，但它们通常附带一张 CD 或 URL，可以为您提供更全面的示例。

O'Reilly、Thinking in C++、Petzold 和 Wrox（以及更多）都有关于 C++ 的好书。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T13:44:18.493

[Boost](http://www.boost.org)库？它通常被认为是编写的一些最高质量的 C++ 代码。（不过，除非您自己是 C++ 大师，否则其中的很多内容或多或少都难以阅读）

一般来说，我建议您不要谨慎使用这种方法。在 C++ 中，源代码可能不会像许多其他语言那样提供丰富的信息。

如果你看到一些 Python 代码，你几乎可以假设它是正确的，只要它运行。如果它是由似乎知道自己在做什么的人写的，你甚至可以认为它写得很好。

在 C++ 中，每条规则都存在许多令人讨厌的陷阱和微妙的例外，您真的需要知道自己在做什么。遵循什么编译，什么似乎有效，或者你在别人的源代码中看到什么是危险的，并且几乎可以保证你迟早会得到一个依赖于未定义行为的程序，并且会在你崩溃时崩溃至少期待它。

如果我是你，我会尽量坚持书本。有一些写得很好，除了让你看到一些源代码之外，还“正确地”教你语言。只要您坚持使用知名作者，就可以确保他们不会教您任何坏习惯或让您陷入不可移植的代码中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T13:46:37.333

在我看来，如果您阅读了一本好的 C++ 书籍（例如“The C++ Programming Language”、“(More) Effective C++”或“Exceptional C++”）。您不仅会学习良好的实践，还应该了解如何编写代码。

当然，这些书中的样本大多是人造的。如果您阅读“真实世界的应用程序”，您总是会遇到非常丑陋的代码片段，但有时不仅有一个很好的干净解决方案（或者一个不太干净的解决方案在条款上更有效）速度）。

所以我不知道是否最好从实际应用程序开始，因为由于代码大小和复杂性，它们也可能非常庞大，而 Books 中的示例代码紧凑且布局清晰。

我认为对于初学者来说，最好阅读我列出的书籍等参考资料。如果您在将来的某个时候必须灵活并且必须生成丑陋的代码，那么您至少会知道它是丑陋的代码，而不会将其误认为“应该是这样的”；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-14T02:55:14.173

如果您已经对 C++ 有一点了解，那么通读开源软件会很有教育意义。如果您刚刚开始，我想[Boost](http://www.boost.org)库将在您的脑海中浮现。您可以从[WebKit](http://trac.webkit.org/browser)项目开始，这是一个极好的资源。谷歌还发布了很多他们的源代码，这些代码也非常干净：[Protocol Buffers](http://code.google.com/apis/protocolbuffers/)就是一个很好的例子。当你在这的时候，你也可以阅读他们的[C++ Style Guide](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)。

就个人而言，我开始学习 C++ 是通过拿起几本书并编写一些小挑战应用程序。请记住，学习一门像 C++ 这样广泛的语言需要很长时间，比如[10 年](http://norvig.com/21-days.html)。

许多年前，有人告诉我，如果我想成为一名 C++ 开发人员，我绝对应该阅读Scott Meyers 的《*Effective C++ 》。*这应该可以防止您陷入该语言的许多陷阱。如果您发现您需要更简单的东西，请从Kernighan & Ritchie*的 The C Programming Language开始。*要有耐心，祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T17:22:16.357

怎么样：Bjarne Stroustrup 的*[编程：使用 C++ 的原则和实践？](http://www.stroustrup.com/Programming/)*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T13:59:52.703

如果你想浏览一个完整的项目，我会推荐[Ogre3d](http://www.ogre3d.org)。它是一个结构良好的图形引擎，具有良好的文档，源代码本身也很好。

# sql-server - NHibernate 是否支持 MsSql2008？它可以将 SQL XML DataType 转换为 XElement 属性吗？

> ID：848128
> 
> 赞同：1
> 
> 时间：2009-05-11T13:36:57.730
> 
> 标签：sql-server, nhibernate

我找不到答案 - NHibernate 是否支持 MsSql2008？例如 - 它可以将 sql XML 数据类型转换为 .NET XElement 吗？

MsSql配置。仅显示 MsSql2005、MsSql2000 和 MsSql7。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T13:49:00.213

你的第一个问题在这里得到了回答：[SQL 2008 Dialect Support for NHibernate](https://stackoverflow.com/questions/18889/sql-2008-dialect-support-for-nhibernate)

至于 XElement，我不确定，但作为客户 IUserType 实施并不难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:00:20.097

[在 NHibernate 的最新 Alpha 中](http://nhforge.org/blogs/nhibernate/archive/2009/03/11/nhibernate-and-ms-sql-server-2008-date-time-datetime2-and-datetimeoffset.aspx)似乎有一个新的 Sql 2008 方言，但据我所知，这是为了支持 SQL Server 2008 中可用的一些新 Date 类型。据我所知，对 SQL XML 类型的支持仍然是由于 Ben 已经指出的原因，不包括在内。

# jquery - 带有字符串变量的 JQuery 查找

> ID：848129
> 
> 赞同：2
> 
> 时间：2009-05-11T13:38:11.517
> 
> 标签：jquery, traversal

我可以使用字符串变量作为参数使用 $() 查询 DOM 吗？

IE

```
var divContainerID = "divBlock1"; 
$(divContainerID).show(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T13:41:18.560

它应该是：

```
var divContainerID = "divBlock1"; 
$('#'+divContainerID).show(); 
```

if`divContainerID`是元素的实际 id 或

```
var divContainerID = "divBlock1"; 
$('.'+divContainerID).show(); 
```

如果它是一个类（我有点假设它不是，但我想我还是会把它给你）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T13:39:01.093

是的。只要字符串代表一个有效的查询，这应该没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:40:05.490

当然，人，有时这是唯一的方法。但是，正如您所知，您在示例中的查询不是有效查询。大概你正在查询一个类或 id ...

它需要是这样的：

```
var divContainerID = "#divBlock1"; 
$(divContainerID).show(); 
```

或者：

```
var divContainerID = ".divBlock1"; 
$(divContainerID).show(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T13:41:52.973

是的，但请记住字符串需要一个

*   `#`如果是 id，则为前缀

*   `.`如果是 CSS 类，则为前缀

否则，它被假定为一个 HTML 元素

# c# - 如何在 c# 中读取 SNMP MIB 文件？

> ID：848132
> 
> 赞同：5
> 
> 时间：2009-05-11T13:38:39.987
> 
> 标签：c#, .net, snmp

如何使用 c#.net 读取 MIB 文件（.Mib 文件）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T13:43:43.750

您可以编写自己的[ASN.1](http://en.wikipedia.org/wiki/Asn.1)解析器，或使用现成的组件。我使用[NetToolWorks](http://www.nettoolworks.com/)并且对它很满意。

如果您确实想自己动手，这里有一些[示例代码](http://www.codeproject.com/KB/cs/asn1editor.aspx)可以帮助您入门。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-16T04:10:10.233

Based on what you need, you have multiple choices.

ASN.1 parsers can be used to parse details. But if you just need to know the OID for objects, #SNMP Suite already has a basic MIB parser/compiler available via both its library (SharpSnmpLib.Mib namespace) and its GUI tool (MIB Compiler and Browser).

[https://sharpsnmp.com](http://sharpsnmp.com)

As far as I know, Net-SNMP only has a MIB to C tool.

# sql - SQL Server 中的自定义排序

> ID：848140
> 
> 赞同：0
> 
> 时间：2009-05-11T13:40:33.117
> 
> 标签：sql, sql-server, user-defined-functions

我有一个表，其中使用“ORDER”列对结果进行排序，例如：

```
Doc_Id    Doc_Value   Doc_Order
1         aaa         1
12        xxx         5
2         bbb         12
3         ccc         24 
```

我的问题是尽可能高效且可重用地最初设置此订单列。

我最初的想法是设置一个标量函数，当向表中添加新条目时，该函数可以用作默认值：

```
ALTER FUNCTION [dbo].[Documents_Initial_Order] 
( )
RETURNS int
AS
BEGIN

RETURN (SELECT ISNULL(MAX(DOC_ORDER),0) + 1 FROM dbo.Documents) 
```

当用户想要置换 2 个文档时，我可以轻松地切换 2 个命令。

它工作得很好，但我现在有第二张桌子我需要以相同的方式设置，我很确定有更好的方法来做到这一点。任何的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T13:47:37.813

根据您的评论，我认为您有一个非常可行的解决方案。您可以通过将其指定为默认值来使其更加用户友好：

```
alter table documents
  add constraint constraint_name 
  default (dbo.documents_initial_order()) for doc_order 
```

作为替代方案，您可以创建一个更新触发器，在插入后将标识字段复制到 doc_order 字段：

```
create trigger Doc_Trigger
on Documents
for insert
as
update d
set d.doc_order = d.doc_id 
from Documents d
inner join inserted i on i.doc_id = d.doc_id 
```

将 doc_id 定义为标识列的示例：

```
create table Documents (
    doc_id int identity primary key,
    doc_order int,
    doc_value ntext
) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T13:57:50.027

听起来您想要一个标识列，一旦它获得初始值，您就可以覆盖它。一种解决方案是有两列，一次调用“InitialOrder”，这是一个自动增量标识列，然后是第二列称为 doc_order，最初设置为与 InitialOrder 字段相同的值（甚至可能作为如果您以这种方式进行插入，则插入触发器或存储过程），但让用户能够编辑该列。

它确实需要每条记录额外的几个字节，但可以解决您的问题，如果它有任何价值，您将同时获得初始文档顺序和用户重置顺序。

另外，我不确定您的 doc_order 是否需要唯一，但如果不需要，您可以按 doc_order 和 InitialOrder 对返回值进行排序，以确保返回顺序一致。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:49:43.380

如果不需要控制 DOC_ORDER 值可能是什么，请尝试使用标识列。

# c++ - 如何隐藏 DLL 中的导出函数

> ID：848144
> 
> 赞同：1
> 
> 时间：2009-05-11T13:41:42.460
> 
> 标签：c++, visual-studio, winapi, dll

我不希望用户在我的 DLL 中通过 Dependence 查看所有导出函数，有没有办法做到这一点？我用 C++ 和 MS Visual Studio 编译我的 DLL。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-12T19:44:28.817

另一种选择可能是创建一个导出函数，该函数将返回您想要隐藏的函数的地址数组 - 一旦有了这些地址，您就可以直接调用它们

```
static void** Funcs = {&foo, &foo1, &foo2, 0};

__declspec (dllexport) void* GetFuncs (void)
{
   return &Funcs;
} 
```

在您的可执行文件中，您可以执行以下操作

```
void** Funcs = GetFuncs();

(*Funcs[0]) (1, 2, 3); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T14:05:28.060

使用 *.def 文件并使用 NONAME 属性来防止名称被导出：参见[Exporting Functions from a DLL by Ordinal 而不是 Name](http://msdn.microsoft.com/en-us/library/e7tsx612(VS.80).aspx) ...这里有[一个示例](http://code.google.com/p/mozilla-symbian/source/browse/trunk/nsprpub/config/plc4_winscw.def?spec=svn4&r=4)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T14:32:53.090

这真的很尴尬，但如果你不想让其他人看到序数，你可以用 COM 包装你的函数。COM DLL 只公开常见的 COM 函数，因此您的将被隐藏。然后，有一些技术可以在不先注册的情况下使用 DLL，因此在系统中找不到有关您将使用的 COM 类的信息。使用 COM 绝对是一个奇怪的理由，但这个请求也很罕见......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T23:39:43.760

使用 NONAME 的 IMO 对此毫无用处 - 它不会隐藏依赖项。仍然会显示依赖关系（通过使用序数）。您的*基本*用户仍然可以通过 GetProcAddress 访问他们。

我认为您将不得不使用更复杂的方法 - 例如，eran 提出的解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-08-15T21:56:29.280

请不要试图将您的访问隐藏在 COM 对象中，以为它会被隐藏。请参阅这篇文章[Enumerate COM object (IDispatch) methods using ATL?](https://stackoverflow.com/questions/2112302/enumerate-com-object-idispatch-methods-using-atl) 看看有人如何探测 COM DLL 中的函数名。

此外，最好隐藏导出函数的名称。当您的 DLL 通过其他代码模块供您自己使用时，这是可取的，并且它执行的操作只有您希望调用代码才能访问。此类别可能包括算法商业机密。

另一个技巧是导出崩溃或设置内部状态的诱饵函数，以让代码知道它已被破坏。在受损状态下，代码可能会故意生成错误结果或随机崩溃。它还可以将包含窥探者信息的邮件发送回一个帐户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T13:53:56.837

一个非常简单的方法是将它包装在像[UPX](http://upx.sourceforge.net/)这样的包装器中。
您看到的导出内容只是 UPX 用于将文件解压缩到内存中的内容

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T13:55:16.833

不，出口的全部意义在于它们是可见的。

这是简短的答案。长答案涉及 .def 文件。[您可以使用 [定义文件]( http://msdn.microsoft.com/en-us/library/d91k01sh(VS.80).aspx)](http://msdn.microsoft.com/en-us/library/d91k01sh(VS.80).aspx))告诉链接器将 C 函数转换为索引。

# php - 学习php的最佳资源视频

> ID：848146
> 
> 赞同：4
> 
> 时间：2009-05-11T13:41:56.250
> 
> 标签：php, video

我最近在 SO 上找到了这篇文章： [best-resources-to-learn-javascript](https://stackoverflow.com/questions/11246/best-resources-to-learn-javascript)

并且真的从 Douglas Crockford 的视频系列中学到了很多东西。

我对 PHP 并不陌生，但我**想看一个关于 PHP 的类似视频系列（无论是从初学者的角度，还是从更高级的角度）**

*   任何人都可以推荐类似的经过深思熟虑和呈现的关于 PHP 的视频/讲座系列吗？

*   与此相关的是，我也很欣赏介绍 DOM 的非常棒的视频的链接（我确实看过 Crockford 的 DOM 视频，但想看更多）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:50:46.103

视频：
- [KillerPHP](http://killerphp.com/)

网站：
- [W3Schools 教程](http://www.w3schools.com/PHP/DEfaULT.asP)

书籍：
- [PHP 选集第 1 卷](https://rads.stackoverflow.com/amzn/click/com/0957921853)
- [PHP 选集第 2 卷](https://rads.stackoverflow.com/amzn/click/com/0957921845)

论坛
：[-WebDeveloper.com](http://www.webdeveloper.com/forum/forumdisplay.php?f=16)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T13:51:35.483

视频很好，但对于初学者来说，我认为[这本书](http://www.amazon.ca/Wicked-Cool-PHP-Real-World-Difficult/dp/1593271735)是无价的氪石

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-16T00:36:38.440

我认为最好的书之一是::

```
 Wicked Cool PHP 
        by William Steinmetz, Brian Ward 
```

# c# - 如何将 Excel 工作表列名转换为数字？

> ID：848147
> 
> 赞同：17
> 
> 时间：2009-05-11T13:42:04.627
> 
> 标签：c#, excel

我想知道将 excel 工作表列名转换为数字的最佳方法是什么。

我正在使用[Excel Package](http://www.codeplex.com/ExcelPackage/)，这是一个处理 .xlsx 文档的好库。不幸的是，这个库没有包含这个功能。

> OBS：第一列 A 对应于该库中的数字 1。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-11T13:48:00.060

此函数应适用于任意长度的列名。

```
public static int GetColumnNumber(string name)
{
    int number = 0;
    int pow = 1;
    for (int i = name.Length - 1; i >= 0; i--)
    {
        number += (name[i] - 'A' + 1) * pow;
        pow *= 26;
    }

    return number;
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-11T15:06:43.350

几个月前我不得不处理这个问题。逆向 - 列名的列索引 - 也很有趣，如果您尝试使用从零开始的索引来解决它，但没有意识到这会使事情变得复杂，它会变得非常混乱。如果它是一个普通的多元数字系统，它可能会如此简单......

这是我的解决方案的简化版本，作为没有错误处理和所有这些东西的扩展方法。

```
public static Int32 ToOneBasedIndex(this String name)
{
    return name.ToUpper().
       Aggregate(0, (column, letter) => 26 * column + letter - 'A' + 1);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-17T13:19:24.767

我已经使用了一段时间，发现这对于超出 AZ 甚至 AA-ZZ 的列非常有效......它是通过分解字符串中的每个字符并递归调用自身来实现的ASCII 字符的 DEC 值（减去 64），然后将其乘以 26^n。当 n > 4 时，使用 long 返回值来克服潜在的限制。

```
 public long columnNumber(String columnName)
    {
        char[] chars = columnName.ToUpper().ToCharArray();

        return (long)(Math.Pow(26, chars.Count() - 1)) * 
            (System.Convert.ToInt32(chars[0]) - 64) + 
            ((chars.Count() > 2) ? columnNumber(columnName.Substring(1, columnName.Length - 1)) : 
            ((chars.Count() == 2) ? (System.Convert.ToInt32(chars[chars.Count() - 1]) - 64) : 0));
    } 
```

此外，如果您想获得相反的信息（即传入 columnNumber 并获取 columnName，这里有一些代码可以实现此目的。

```
 public String columnName(long columnNumber)
    {
        StringBuilder retVal = new StringBuilder();
        int x = 0;

        for (int n = (int)(Math.Log(25*(columnNumber + 1))/Math.Log(26)) - 1; n >= 0; n--)
        {
            x = (int)((Math.Pow(26,(n + 1)) - 1) / 25 - 1);
            if (columnNumber > x)
                retVal.Append(System.Convert.ToChar((int)(((columnNumber - x - 1) / Math.Pow(26, n)) % 26 + 65)));
        }

        return retVal.ToString();
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-10T13:14:27.157

源代码：

```
namespace XLS
{
/// <summary>
/// Represents a single cell in a excell sheet
/// </summary>
public struct Cell
{
    private long row;
    private long column;
    private string columnAddress;
    private string address;
    private bool dataChange;

    /// <summary>
    /// Initializes a new instance of the XLS.Cell 
    /// class with the specified row and column of excel worksheet
    /// </summary>
    /// <param name="row">The row index of a cell</param>
    /// <param name="column">The column index of a cell</param>
    public Cell(long row, long column)
    {
        this.row = row;
        this.column = column;
        dataChange = true;
        address = string.Empty;
        columnAddress = string.Empty;
    }

    /// <summary>
    /// Initializes a new instance of the XLS.Cell
    /// class with the specified address of excel worksheet
    /// </summary>
    /// <param name="address">The adress of a cell</param>
    public Cell(string address)
    {
        this.address = address;
        dataChange = false;
        row = GetRow(address);
        columnAddress = GetColumnAddress(address);
        column = GetColumn(columnAddress);
    }

    /// <summary>
    /// Gets or sets the row of this XLS.Cell
    /// </summary>
    public long Row
    {
        get { return row <= 0 ? 1 : row; }
        set { row = value; dataChange = true; }
    }

    /// <summary>
    /// Gets or sets the column of this XLS.Cell
    /// </summary>
    public long Column
    {
        get { return column <= 0 ? 1 : column; }
        set { column = value; dataChange = true; }
    }

    /// <summary>
    /// Gets or sets the address of this XLS.Cell
    /// </summary>
    public string Address
    {
        get { return dataChange ? ToAddress() : address; }
        set
        {
            address = value;
            row = GetRow(address);
            column = GetColumn(address);
        }
    }

    /// <summary>
    /// Gets the column address of this XLS.Cell
    /// </summary>
    public string ColumnAddress
    {
        get { return GetColumnAddress(Address); }
        private set { columnAddress = value; }
    }

    #region Private Methods

    private static long GetRow(string address)
    {
        return long.Parse(address.Substring(GetStartIndex(address)));
    }

    private static string GetColumnAddress(string address)
    {
        return address.Substring(0, GetStartIndex(address)).ToUpperInvariant();
    }

    private static long GetColumn(string columnAddress)
    {
        char[] characters = columnAddress.ToCharArray();
        int sum = 0;
        for (int i = 0; i < characters.Length; i++)
        {
            sum *= 26;
            sum += (characters[i] - 'A' + 1);
        }

        return (long)sum;
    }

    private static int GetStartIndex(string address)
    {
        return address.IndexOfAny("123456789".ToCharArray());
    }

    private string ToAddress()
    {
        string indexToString = string.Empty;

        if (Column > 26)
        {
            indexToString = ((char)(65 + (int)((Column - 1) / 26) - 1)).ToString();
        }

        indexToString += (char)(65 + ((Column - 1) % 26));

        dataChange = false;
        return indexToString + Row;
    }

    #endregion
} 
```

}

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-21T18:36:34.060

O24 有一个列号，您需要一个名称：

=左（右（地址（1，O24），LEN（地址（1，O24））-1），查找（“$”，右（（地址（1，O24）），LEN（地址（1，O24） )-1))-1)

O37 有一个列名，你想要一个数字：

=列（间接（O37&1））

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-10T12:44:12.710

```
public static string GetColumnName(int index)
{
    const string letters = "ZABCDEFGHIJKLMNOPQRSTUVWXY";

    int NextPos = (index / 26);
    int LastPos = (index % 26);
    if (LastPos == 0) NextPos--;

    if (index > 26)
        return GetColumnName(NextPos) + letters[LastPos];
    else
        return letters[LastPos] + "";
} 
```

# asp.net - 寻找简单的基于 Web 的表单设计器的示例

> ID：848148
> 
> 赞同：0
> 
> 时间：2009-05-11T13:42:27.437
> 
> 标签：asp.net, javascript, html, ajax, dom

我需要实现一个“简单”的基于 Web 的表单设计器，它允许“简单”用户创建他们自己的基于 Web 的表单。我在富客户端（例如 Outlook 和 Acrobat）中遇到过这些东西，但我的要求要简单得多，而且必须是基于 Web 的。

漂亮的布局、自定义验证、复杂的字段和类型根本不是一个因素。理想情况下，我想找到一个简洁的东西，就像我现在正在输入的这个非常 SO 的问题作曲家，以及将文本输入框或复选框直接拖到文本中的能力。输出可能像这样粗略：

> 你叫什么名字？[Fred Bloggs]
> 你有互联网吗？[X]

我正在使用 asp.net，但后端技术并不重要，因为我担心这都是 javascript！无需考虑旧浏览器。任何示例链接以及对现有开放或商业组件的建议都会有所帮助。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-17T13:28:54.637

试过[Frevvo](http://www.frevvo.com/frevvo/web/static/home)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-05T19:56:36.607

试试[FormThis](http://www.formthis.com)。它允许您免费创建在线 Web 表单。拖放设计器、无限字段、提交/响应、计算、验证等。如果需要，可以输出到 PDF。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:25:44.447

这是一个非常简洁的基于 jquery [Ajax Form Builder](http://www.phpletter.com/Our-Projects/Ajax-Form-Builder-Project/)

# sql-server-2005 - SQL Reporting Services 可以使用 Lotus Notes 作为数据源吗？

> ID：848155
> 
> 赞同：0
> 
> 时间：2009-05-11T13:43:54.687
> 
> 标签：sql-server-2005

我想从已在 Lotus Notes 中创建的项目管理系统创建报告。我之前已经从 SSRS 连接到 ORACLE，我可以连接到 Lotus Notes DB 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T04:54:36.040

是的，使用第三方适配器或驱动程序。

Propoison 有一个连接到 Lotus Notes 和 Domino 环境的适配器（Propoison Report Adapter）。显然，它们[最近被 Quest Software 收购](http://www.quest.com/landing/?ID=1442)，我是通过重定向发现的。你必须打电话给 Quest，看看你现在或未来是否有任何开发选择。

或者，应该可以使用 IBM 的[NotesSQL ODBC 驱动程序](http://www.ibm.com/developerworks/lotus/products/notesdomino/notessql/)连接到 Notes 。

# windows - Win2K3如何变成工作站开发操作系统？

> ID：848158
> 
> 赞同：1
> 
> 时间：2009-05-11T13:44:12.207
> 
> 标签：windows, operating-system

这是一个与编程没有直接关系的问题。

受够了 Microsoft Windows XP Professional 和许多吸引眼球的东西，我想尝试将 Microsoft Windows Server 2003 作为我的开发 PC 上的主要操作系统。（另一个原因是 IIS 的版本比 5.1 更好）。并且知道 Win2K3 最初是作为服务器操作系统设计的，我认为我应该让它更加“工作站友好”。

我的问题是：如何将 Win2K3（最有可能是标准版）转换为工作站操作系统？任何文章或链接都受到高度赞赏。

PS：我的开发PC必须主要运行MS Visual Studio 2008、MS SQL Server 2008、MS Expression Studio 2、不同的Oracle软件（10gR2、ExpressEdition、11g）和其他一些小工具（一个测试框架、一个颠覆工具-TFS、一个web浏览器、bittorrent 客户端等）。正如我之前检查过的，所有这些都与 Win2K3 兼容。

Tnks

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T13:53:15.730

我只将服务器操作系统用作我的工作站，在切换到 Server 2008 之前我有 Server 2003。您可以在此处找到指南[http://www.msfn.org/win2k3/](http://www.msfn.org/win2k3/)。

你不应该遇到任何问题。大多数 windows xp 驱动程序都可以在 server 2003 上运行，但是，有些应用程序不能。尤其是那些在安装前检查操作系统版本的。但是你不应该对 VS2008、Expression 和你发布的任何东西有任何问题。

对我来说，唯一麻烦的是在服务器 2003 上运行 iTunes，它看起来不太好。

如果你喜欢眼睛糖果，你可以通过启动主题服务并更改一些设置来打开它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T13:47:33.680

您不应该在 Server 2003 上运行这些应用程序时遇到任何问题。

上次我个人在工作站上运行 2003 时，唯一真正的大变化是更改了 Internet Explorer 的安全设置。

如果您运行免费的防病毒软件包之一，您可能会发现它们不会安装在服务器操作系统上。

编辑：正如另一位海报所建议的那样，如果它是一个选项，我也会直接进入服务器 2008。Server 2008 作为工作站操作系统运行得非常好，如果您的硬件支持它，虚拟服务器运行得非常好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T13:50:58.353

以下是将 2003 变成工作站的链接：

[http://www.google.com/search?hl=en&q=windows+server+2003+workstation+converter](http://www.google.com/search?hl=en&q=windows+server+2003+workstation+converter)

如果您想将 Windows Server 2008 用作工作站，运行起来比常规的 Vista 安装要好得多（更快）：

[http://www.google.com/search?hl=en&q=windows+server+2008+workstation+converter&aq=1&oq=windows+server+2008+work](http://www.google.com/search?hl=en&q=windows+server+2008+workstation+converter&aq=1&oq=windows+server+2008+work)

或者尝试使用运行良好的 Windows 7 RC1。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T13:49:08.060

您列出的所有软件类型都没有我所知道的任何偏向工作站的依赖项。根据您的硬件和驱动程序，Expression Blend 可能会受到一些影响，因为 WPF 比大多数其他 Windows 窗体开发工具对视觉效果的要求更高。

# perl - 阻止 Oracle 生成 sqlnet.log 文件

> ID：848166
> 
> 赞同：11
> 
> 时间：2009-05-11T13:45:39.347
> 
> 标签：perl, oracle

我在 perl 中使用 DBD::Oracle，每当连接失败时，客户端都会生成一个带有错误详细信息的 sqlnet.log 文件。

问题是，我已经有 perl 捕获的错误，并且在我自己的日志文件中。我真的不需要这些额外的信息。

那么，是否有停止创建 sqlnet.log 的标志或环境？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:11:04.450

正如[Oracle 文档](http://download-uk.oracle.com/docs/cd/B19306_01/network.102/b14212/troublestng.htm#sthref1553)所述：为确保记录所有错误，不能在客户端或名称服务器上禁用日志记录。

您可以按照 DCookie 的建议，使用 /dev/null 作为日志目录。您可以在 Windows 机器上使用 NUL:。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T15:00:31.553

您的客户端是在 Windows 上还是 *nix 上？如果在 *nix 中，您可以在 sqlnet.ora 文件中设置 LOG_DIRECTORY_CLIENT=/dev/null。不确定您是否可以为 Windows 客户端做很多事情。

编辑：在 Windows 中看起来不可能。您可以做的最好的是将上面的 sqlnet.ora 参数设置为固定位置并创建计划任务以根据需要删除文件。

好的，正如 Thomas 指出的那样，Windows 上有一个空设备，使用相同的范例。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T18:41:41.360

从金属链接

> 日志是自动的，没有办法关闭日志，但是由于你在 Unix 服务器上，你可以将日志文件重定向到一个空设备，从而消除了磁盘空间消耗的问题。
> 
> 在 SQLNET.ORA 文件中，将 LOG_DIRECTORY_CLIENT 和 LOG_DIRECTORY_SERVER 设置为空设备。
> 
> 例如：
> 
> ```
> LOG_DIRECTORY_CLIENT = /dev/null
> LOG_FILE_CLIENT = /dev/null 
> ```
> 
> 在 SQLNET.ORA 中完全禁止客户端日志记录。
> 
> 要禁用监听器记录，请在 LISTENER.ORA 文件中设置此参数：
> 
> ```
> logging_listener = off 
> ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-05-22T22:02:26.063

重要提示：不要设置“LOG_FILE_CLIENT=/dev/null”，这将导致 /dev/null 的权限在您每次初​​始化 oracle 库时被重置，并且当您的 umask 是不允许世界可读可写位的东西时，那些得到从 /dev/null 中删除，如果您有权 chmod 该文件：即以 root 身份运行。

并以 root 身份运行可能是微不足道的，比如 php --version 存在 oci php-extension ！

完整的细节在这里： http: [//lists.pld-linux.org/mailman/pipermail/pld-devel-en/2014-May/023931.html](http://lists.pld-linux.org/mailman/pipermail/pld-devel-en/2014-May/023931.html)

您应该在不存在的目录中使用路径：

```
LOG_FILE_CLIENT = /dev/impossible/path 
```

并希望没有人创建目录`/dev/impossible`:)

对于 Windows`NUL`可能很好，因为它不是那里的实际文件......

# css - css样式覆盖顺序？

> ID：848167
> 
> 赞同：6
> 
> 时间：2009-05-11T13:45:41.970
> 
> 标签：css, internet-explorer

好吧，我有 2 个 CSS 包括

```
<link href="Styles/layout.css" rel="stylesheet" type="text/css" />
<link href="Styles/ATJournal.css" rel="stylesheet" type="text/css" /> 
```

布局.css

```
Table.infoBox tr td table tr td
{
    padding: 0px;
    border: 0px;
} 
```

ATJournal.css

```
table.ATJMainTable tr td
{
    border: 1px solid black;
    padding: 3px;
} 
```

然后我们有这张桌子

```
<Table class="infoBox">
    <tr>
        <td>
        <table class="ATJMainTable">
            <tr>
                <td>
                    some text!
                </td>
            </tr>
        </table>
    </tr>
</table> 
```

为什么 layout.css 在这种情况下会覆盖 ATJournal.css？

即使我更改了包含“layout.css”的css的顺序，仍然会覆盖ATJournal.css ....

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T13:58:42.253

选择器更具体。

```
Table.infoBox tr td table tr td 
```

正在为一个表内的 td 单元格设置样式，该表位于一个用信息框分类的表内。

```
table.ATJMainTable tr td 
```

在使用 ATJMainTable 分类的表中设置 td 单元格的样式

您可以使用 !important 来覆盖特异性，或者您可以执行以下操作：

```
table.infoBox tr td table.ATJMainTable tr td 
```

专门覆盖该部分。

或者，您可以减少信息框选择器的具体程度吗？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-11T13:52:10.503

您实际上可以使用`!important`.

```
table.ATJMainTable tr td
{
    border: 1px solid black !important;
    padding: 3px !important;
} 
```

这基本上告诉浏览器，它应该确保这条规则是最重要的规则，并且所有其他规则都应该级联以支持这条规则。

**警告：**你会希望谨慎使用它，因为如果你使用它太多很难追踪它，它会导致问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T13:49:14.147

这是一个更具体的选择器。

见[这里](http://www.w3.org/TR/CSS21/cascade.html#specificity)。

# ms-access - myString = "UPDATE" 产生一个空的 myString

> ID：848168
> 
> 赞同：2
> 
> 时间：2009-05-11T13:45:50.377
> 
> 标签：ms-access, vba

在 MS Access 中，分配字符串文字有时会导致空字符串

以下代码

```
Public Sub test()
    Dim myString As String
    myString = "UPDATE "
    Debug.Print "'" & myString & "'"
End Sub 
```

结果是

```
'' 
```

这把我吓坏了。它只是偶尔发生。其他时候 "UPDATE " 会起作用，但 myString = "tblCategorie" 不会。它必须是那个字符串。如果“更新”失败，那么“更新”仍然可以。

我正在使用 MS Access 2003 11.8204.8221 SP3 有人有同样的问题吗？

（在你说：转储访问之前！我们已经在这样做了，但仍处于过渡阶段。我并不是真的*希望*有人能提出一个体面的答案，但一个人可以希望）

[**更新**]：感谢所有评论！让我说得很清楚

1.  这不是错字。相同的代码有时有效，有时无效。
2.  它是独立运行的，所以它不是全局变量问题。
3.  我已将示例更新为失败/不失败的*确切代码。*这是一个文字副本。我通过将其粘贴到模块中并在直接屏幕中键入“测试”来对其进行测试。
4.  它首先出现在过去半年完美运行的代码中，
5.  确实是字符串赋值失败（我可以通过在赋值语句上放置一个中断来检查）
6.  [我从text exports](https://stackoverflow.com/questions/247292/working-with-multiple-programmers-on-ms-access/249967#249967)生成我的数据库，所以它实际上不是一个损坏问题。（可能是，但它不是我可以通过压缩等来修复的）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:31:25.107

你在使用`On Error Resume Next`ie 是不是静默地失败了？也就是说，我想不出为什么将`String`文字赋值给`String`变量会失败，这就引出了一个问题： mySting 真的键入为`String`吗？

更新：我从您的更新中看到（双关语？）我的猜测是错误的。我根本看不到您的代码如何无法打印除“UPDATE”以外的任何内容。也许您现在应该将此视为放弃动态 SQL 以支持预准备语句的机会，或者，最好是`PROCEDURES`（当然，在 ACE/Jet 的存储过程中仅限于单个 SQL 语句，但至少它们将 SQL 代码保留在正确的位置即分贝）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T13:53:25.183

您发布的代码是失败的代码的副本，还是合理的复制品？我想知道在释义中是否丢失了某些东西，因为我认为您发布的代码没有任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:53:51.873

只是一个盲目的猜测......你确定你正确地输入了第二个“myString”吗？

因为你不知道（例如。

```
Debug.print "'" & mySting & "'" 
```

）访问不会抱怨，但它会创建一个空变量......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:53:52.470

转储访问！:-)

某事是 FUBAR。您是否尝试过对数据库进行压缩和修复？

我会尝试的另一件事是在 VBA 代码上运行一个副本（Debug->Compile Access[X]）。

# c++ - C++/Qt 应用程序的内存使用情况

> ID：848169
> 
> 赞同：2
> 
> 时间：2009-05-11T13:45:52.640
> 
> 标签：c++, memory

我正在使用 OS X 10.5.6。我有一个使用 Qt 制作的带有 GUI 的 C++ 应用程序。当我启动我的应用程序时，它使用 30 MB 内存（由 OS X 活动监视器 RSIZE 报告）。

我使用这个应用程序将文本文件读入内存，解析数据并最终将其可视化。如果我打开（读取到内存、解析、可视化）一个 9 MB 的文本文件，Activity Monitor 报告我的应用程序从最初使用的 30 MB 内存增长到了 103 MB。

现在，如果关闭文件并删除已解析和可视化的数据，则应用程序的大小将保持在 103 MB。这对我来说听起来像是内存泄漏。但是，如果我再次打开文件，将其读入内存、解析并可视化，应用程序将保持在 103 MB。无论我打开文件（或另一个相同大小的文件）多少次，我的应用程序内存使用都或多或少保持不变。这是否意味着它不是内存泄漏？如果是泄漏，则每次打开文件时内存使用量都应该保持增长，不是吗？它增长的唯一时间是如果我打开一个比前一个更大的文件。

这是正常的吗？这个平台或库是否依赖？这是操作系统或库完成的某种缓存吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-03-30T11:03:51.817

这对我来说听起来像是一个内存碎片问题。内存是从 OS 以页的形式获取的。页面通常有几个 kB 大，例如 4 kB。现在，如果您为您的对象分配 100 MB 的 RAM，您的内存分配器（new / malloc）会向操作系统询问许多空闲内存页面并在它们上分配您的对象。当您的应用程序完成计算并删除*一些*（甚至是大部分但不是全部）先前分配的对象时，未删除的对象会保留页面并且不允许将它们返回给操作系统。*只有释放所有*内存时才能返回页面。所以在极端情况下，一个 8B 的对象可以阻止返回一个完整的 4kB 页面。

操作系统通过计算提交给应用程序的页面数来报告内存消耗，而不是通过计算对象在这些页面上占用的空间。因此，如果您的内存是碎片化的，则页面保持提交，并且报告的内存消耗保持不变。

第二次运行时内存消耗不会增加，因为在第二次运行时分配器会重用以前获得的大部分空闲页面。

碎片问题的解决方案通常是预先分配更大的内存块，并使用自定义内存分配器从这个更大的块中分配具有相似生命周期的对象。然后，当你处理完对象后，删除整个块。

另一个解决方案是切换到像 Java 或 .NET 这样的完全垃圾收集环境——它们具有可防止此类问题的压缩垃圾收集器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T15:35:02.897

这似乎比较正常，但所有操作系统都略有不同。

在通常的应用程序生命周期中，应用程序从操作系统请求内存，并获得它管理的大块内存（通过 C/C++ 标准库）。当应用程序获取/释放内存时，这一切都在应用程序内部完成，无需求助于操作系统，直到应用程序没有离开，然后调用操作系统以获取另一个大块。

在应用程序退出之前，内存通常不会返回给操作系统（尽管如果需要，大多数操作系统确实提供了执行此操作的机制，并且一些 C/C++ 标准库将使用此工具）。应用程序不是将内存返回给操作系统，而是使用它所提供的所有内容并进行自己的内存管理。

但请注意：仅仅因为应用程序具有内存并不意味着它当前占用了芯片上的 RAM。偶尔使用或一段时间未使用的内存将临时保存到二级/三级存储中。

活动监视器：对于检查内存使用情况不是一个非常有用的工具，因为您发现它只显示实际分配给应用程序的总数。它不显示有关应用程序如何内部分配此内存的任何信息（其中大部分可以被释放）。检查 XCode 所在的文件夹，有一组广泛的工具可用于检查开发环境提供的应用程序如何工作。

注意：我避免使用页面等术语，因为这些与 C/C++/Objective C 无关，并且都是特定于操作系统/硬件的。

# maven-2 - 坚持使用 maven 的默认项目目录结构有什么好处？

> ID：848177
> 
> 赞同：1
> 
> 时间：2009-05-11T13:46:39.550
> 
> 标签：maven-2, ide, directory-structure, project-structure

简单地说，如果您使用 maven，您应该将 maven 布局视为黄金标准，还是应该转换布局以适合您的工具（WASD、myEclipse、RAD 等）？

意识到 maven 是可配置的并且您可以覆盖 Super POM 中的默认值，我试图确定是否应该更改布局以支持内部的特定工具，或者尝试让这些工具识别 maven 布局。需要考虑的一件事是最终集成持续构建工具，以及不同的 IDE。目前正在使用 MyEclipse，但有消息称他们不会在 6 个月内更新许可证。

我问的关于这类事情的[第一个问题](https://stackoverflow.com/questions/812448/is-developing-maven-war-apps-in-myeclipse-worth-it)有点太具体和片面了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:08:08.337

Maven 遵循“约定优于配置”的原则，这意味着如果您遵循*他们的*约定，那么您不需要重新定义基本信息，例如您的项目结构。

就我而言，我更喜欢有我能写的最短的 pom.xml，我不喜欢定义诸如在哪里可以找到源、资源等信息。

除此之外，为多个项目使用相同的结构是一个明显的好处，特别是如果您有许多应用程序需要管理。如果它遵循一些约定，它还可以帮助新开发人员理解应用程序......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T06:02:00.827

像所有“最佳实践”一样，物有所值。正如您所指出的，IDE 可能具有他们喜欢的特定项目结构 - 因为您的大部分开发实际上是在 IDE 中完成的，这就是开发人员实际思考问题的方式。

如果您围绕标准项目结构标准化您的商店，您始终可以在公司范围的父 POM 文件中定义该通用结构。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-05-11T16:39:23.120

默认项目结构有效，因此不要浪费时间争论和决定不同的项目结构，然后配置 maven 以使用它。

# c# - 为 BackgroundWorker 设计一个接口

> ID：848179
> 
> 赞同：4
> 
> 时间：2009-05-11T13:46:54.120
> 
> 标签：c#, .net, backgroundworker

在我的 Windows 窗体应用程序中，我有一个扩展后台工作程序的类，我们在我的窗体类中将其称为 ExtendedBGW1.cs，我将其声明为成员变量，因此我对整个类具有如下作用域：

```
public partial class Main : Form
{
    ExtendedBGW1 ebgw1;
} 
```

稍后在表单构造函数中我这样做

```
public Main()
{
    InitializeComponent();

    ebgw1 = new ExtendedBGW1();

    InitializeBackgoundWorker();
} 
```

我的 InitializeBackgroundWoker() 方法看起来像这样

```
private void InitializeBackgoundWorker()
{
    ebgw1.DoWork += new DoWorkEventHandler(ebgw1.worker_DoWork);
    ebgw1.RunWorkerCompleted += new RunWorkerCompletedEventHandler(processWorkerCompleted);
    ebgw1.ProgressChanged += new ProgressChangedEventHandler(processProgressChanged);
    ebgw1.WorkerReportsProgress = true;
    ebgw1.WorkerSupportsCancellation = true;
} 
```

现在是我的设计问题。我现在知道我将拥有更多不同的类，比如我的扩展 BackGroundWorker 的扩展 BGW1.cs，所以我想如果我创建一个 IExtenedBackGroundWorker，我可以做这样的事情。

```
public partial class Main : Form
{
    IExtenedBackGroundWorker ebgw1;
} 
```

并且仍然具有 Main 类的适当范围。然后我可以创建以后需要的任何 IExtendedBackGroundWorker 实现。

我可以毫无问题地为方法和属性创建接口，但是当我尝试在接口、基类和主类之间正确连接事件时，我真的遇到了问题。

有没有人有任何想法？

这是我在 Main 中遇到的错误

```
Error   1   Cannot assign to 'DoWork' because it is a 'method group' 
```

这是我在实现界面时遇到的错误

```
Error   5   The event 'System.ComponentModel.BackgroundWorker.DoWork' can only appear on the left hand side of += or -= 
```

这是我的界面现在的样子：

```
interface IExtendedBackGroundWorker 
{
    bool IsBusy { get; }

    bool WorkerReportsProgress { get; set; }

    bool WorkerSupportsCancellation { get; set; }

    List<CompareObject> ObjList { get; set; }

    string FilePath { get; set; }

    void RunWorkerAsync();

    void CancelAsync();

    void DoWork();

    void worker_DoWork(object sender, DoWorkEventArgs e);

    void RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e);

    void ProgressChanged(object sender, ProgressChangedEventArgs e);
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T13:54:13.153

简单，只需 1 - 2 - 3 - 完成

```
public interface IMyWorker
{
    bool WorkerReportsProgress { get; set; }
    bool WorkerSupportsCancellation { get; set; }
    event DoWorkEventHandler DoWork;
    event ProgressChangedEventHandler ProgressChanged;
    event RunWorkerCompletedEventHandler RunWorkerCompleted;
}

public class MyWorker : BackgroundWorker, IMyWorker
{

} 
```

用法：

```
namespace stackOverflow
{
class Program
{
    static void Main(string[] args)
    {
        IMyWorker worker = new MyWorker();
        worker.DoWork += new System.ComponentModel.DoWorkEventHandler(worker_DoWork);
    }

    static void worker_DoWork(object sender, System.ComponentModel.DoWorkEventArgs e)
    {
        throw new NotImplementedException();
    }
  }
} 
```

玩得开心 ：）

# svn - 安装了 Visual SVN 服务器，但我在 SVN Check Out 时收到此消息

> ID：848197
> 
> 赞同：3
> 
> 时间：2009-05-11T13:49:45.393
> 
> 标签：svn, installation, tortoisesvn, visualsvn-server

所以我安装了 VisualSVN 服务器和 TortoiseSVN 客户端。我在 SVN 服务器上创建了一个用户，现在我去了一个新文件夹 c:\src，右键单击并选择“SVN Checkout...”，它总是给我这个消息

```
Checkout from https://bookroom:8443/svn, revision HEAD, Fully recursive, Externals included

Error: OPTIONS of 'https://bookroom:8443/svn': 200 OK (https://bookroom:8443)  

Finished! 
```

bookroom 是我电脑的名字...

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T13:54:47.613

我猜[https://bookroom:8443/svn](https://bookroom:8443/svn)不是有效的 Subversion 存储库。

您应该已经创建了一个或多个位于 /svn 下的存储库，因此您要从中结帐的 url 类似于**[https://bookroom:8443/svn/reponame](https://bookroom:8443/svn/reponame)**

例如，这是我机器上的 VisualSVN 管理器：

![VisualSVN 管理器](https://farm4.static.flickr.com/3362/3522317588_6046d30b51_o.png)

假设我的主要网址是[https://mark:8443/svn](https://mark:8443/svn)。您可以看到我如何拥有一个名为*adhoc*的存储库，因此我将检查 url **[https://mark:8443/svn/adhoc](https://mark:8443/svn/adhoc)**。

# c# - WCF 服务应用程序使用 WebGet 返回 404

> ID：848198
> 
> 赞同：2
> 
> 时间：2009-05-11T13:50:13.520
> 
> 标签：c#, wcf, web-services, http-status-code-404

我只创建了最基本的 WCF 服务应用程序来做一些原型设计，但我无法让 WebGet 实现工作。

这是我的界面：

```
[ServiceContract]
public interface IService
{
    [OperationContract]
    [WebGet(UriTemplate = "/rest/{value}")]
    string Test(string value);
} 
```

这是实现：

```
public string Test(string value)
{
    return string.Format("You entered: {0}", value);
} 
```

但是如果我在浏览器中访问[http://localhost:3305/rest/Hello](http://localhost:3305/rest/Hello)，我会得到 404。我使用的是 VS 2008 网络服务器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:00:56.213

我认为您缺少实际的服务名称。

[http://localhost:3305/yourservicename.svc/rest/Hello](http://localhost:3305/yourservicename.svc/rest/Hello)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-07T08:40:52.220

更新

```
config.SetServiceOperationAccessRule("*", ServiceOperationRights.All);

public static void InitializeService(DataServiceConfiguration config)
    {
        // TODO: set rules to indicate which entity sets and service operations are visible, updatable, etc.
        // Examples:
         config.SetEntitySetAccessRule("*", EntitySetRights.AllRead);
         config.SetServiceOperationAccessRule("*", ServiceOperationRights.All);
        //config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;
    } 
```

# vb.net - .NET 检查是否有另一个应用程序正在运行

> ID：848202
> 
> 赞同：0
> 
> 时间：2009-05-11T13:51:07.403
> 
> 标签：vb.net

我有一个为一系列其他应用程序提供核心服务的应用程序。

当另一个应用程序启动时，我想检查服务应用程序是否正在运行，如果没有关闭。

检查其他应用程序是否存在的最佳方法是什么？我在想我应该在服务应用程序中使用全局互斥锁并检查它在其他应用程序中是否存在。这是正确的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T13:52:23.797

全局互斥方法是一种很好的方法，也是许多应用程序使用的方法。

例如，Windows Media Player 就是这样做的。

相关问题：

[是否使用互斥锁来防止同一程序的多个实例安全运行？](https://stackoverflow.com/questions/646480/is-using-a-mutex-to-prevent-multipule-instances-of-the-same-program-from-running)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T13:53:45.087

```
bool IsApplicationAlreadyRunning()
{
string proc=Process.GetCurrentProcess().ProcessName;
Process[] processes=Process.GetProcessesByName(proc);
if (processes.Length > 1)
return true;
else
return false;
} 
```

来源： http: [//kseesharp.blogspot.com/2008/11/c-check-if-application-is-already.html](http://kseesharp.blogspot.com/2008/11/c-check-if-application-is-already.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:55:19.173

是的 - 请注意您所说的互斥锁。这些有特定的命名准则 -[这有一些细节](http://www.yoda.arachsys.com/csharp/threads/waithandles.shtml)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T17:30:35.173

我想说查看您用于与服务应用程序通信的方法，并查看通信失败行为是什么。如果您在任何时候尝试与服务应用程序通信并失败，由于高度依赖，您似乎想要有失败行为。如果第一次通信失败，好像要退出应用程序；但是您还必须担心如果您的通信在稍后的某个时间失败会发生什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-21T04:57:51.660

尝试以下（VB.NET 示例）：

```
 If PrevInstance() Then
            MsgBox("[MyApplicationName] application is already running.")
            Exit Sub
        End If

Function PrevInstance() As Boolean
    If UBound(Diagnostics.Process.GetProcessesByName(Diagnostics.Process.GetCurrentProcess.ProcessName)) > 0 Then
        'MsgBox("Application is still running", MsgBoxStyle.Information)
        Return True
    Else
        Return False
    End If
End Function 
```

# java - 如何使用纯 Java 验证已签名的 JAR？

> ID：848205
> 
> 赞同：1
> 
> 时间：2009-05-11T13:51:40.863
> 
> 标签：java, jar, certificate, code-signing

我不想使用`jarsigner -verify`. 我的问题没有 JAR util 包吗？我只想用纯 Java 验证 JAR。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-20T09:00:39.570

“jarsigner”只是验证 jar 的 java 程序的一个小包装器。在你的 JDK 中有一个“tools.jar”（通常是“C:\programs\Java\jdk1.6.0_13\lib\tools.jar”或类似的东西）。在这个库中有一个类“JarSigner”，它提供了所需的能力。只需将“tools.jar”放在您的类路径中！

这是一个示例程序来演示该行为

导入 sun.security.tools.JarSigner；

```
public class TestJarSigner {

 public static void main(String[] args) {
  JarSigner signer = new JarSigner();
  signer.run(new String[] { "-verify", "tools.jar" });
 }

} 
```

输出是：

```
jar is unsigned. (signatures missing or not parsable) 
```

如果您需要更深入地了解签名过程，可以使用这些[资源。](http://download.java.net/openjdk/jdk6/)

# ruby - Ruby新手问题：哈希

> ID：848207
> 
> 赞同：3
> 
> 时间：2009-05-11T13:51:45.000
> 
> 标签：ruby

我有以下

```
class test
 hash={}

  def printHash 
      puts hash[1]
      puts hash[2]
      puts hash[3]
    end
end

test.new.printHash 
```

这打印：

```
1 
0 
1 
```

为什么会这样？我如何测试我是否在哈希的那个位置放了一些东西？还是我错过了什么

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T14:05:14.753

你已经偏离了标准，但它似乎正在*做某事*，因为`hash`它是一个[内置函数](http://www.ruby-doc.org/core-1.8.7/classes/Object.html#M000651)，它返回对象的 Fixnum 哈希码。当您在 Fixnum 上使用方括号时，您将获得[特定位的值](http://www.ruby-doc.org/core-1.8.7/classes/Fixnum.html#M000912)。您要做的是创建一个以 sigil 开头的实例变量`@`。此外，您必须在方法中创建实例变量，因此我们将使用在创建类的对象时调用的实例变量`initialize`：

```
class Test
  def initialize
    @hash = {}
  end

  def printHash 
      puts @hash[1]
      puts @hash[2]
      puts @hash[3]
  end
end 
```

现在你会发现这`nil`三个都打印出来了。要测试哈希是否具有特定键的值，您可以使用[`has_key?`](http://www.ruby-doc.org/core-1.8.7/classes/Hash.html#M000194).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:22:02.910

基本上“哈希”超出范围，您在 printHash 函数中引用的是完全不同的对象，通常它是 nil （一个新的未分配对象）但正如 Pesto 指出的“哈希”是一个内置函数 - 有点令人困惑这个解释。

通过在变量前面放置一个“@”符号并在初始化方法中分配它（在“new”之后调用），它可以在对象的整个实例中使用。

# html - 如何在页面加载后跟踪 HTML 页面上的内容更改

> ID：848211
> 
> 赞同：2
> 
> 时间：2009-05-11T13:52:28.943
> 
> 标签：html, ajax

我正在为此绞尽脑汁。

在浏览器中加载 HTML 文档后，我希望能够监控页面，以防页面上的任何内容因任何原因发生更改。

是否有一个 Javascript 函数，我可以使用它来跟踪网页上的“发生了什么变化”。这应该与 HTML 页面上的内容类型无关。

我有两个例子供你思考：

### 例1：

假设在 HTML 文档中有两个选择框 s1 和 s2。s2 中的项目列表取决于 s1 中的选择（页面没有刷新——即 s2 是通过 Ajax 或其他方式加载的）。因此，在 HTML 页面加载后，我需要在填充 s2 时收到通知......

### 例 2：

比如说，在一个 HTML 页面中，有一个链接 Onclicking，它使用一些文本创建了一个轻量的弹出 div。如何捕获此动态弹出窗口的内容？

在所有这些讨论中，我没有考虑任何特定的 HTML 格式……HTML 内容可以是任何东西……我只需要继续跟踪页面加载后是否有任何内容更改……

理想情况下，我需要使用 JavaScript（客户端脚本）来实现这一点。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T20:21:17.860

如果您使用的是 AJAX，您可以设置响应函数来处理自制的“事件监听”系统。因此，在响应完成了它需要做的事情之后，它可以调用任何向它注册的方法，并在必要时传入响应文本。

所以从你上面的例子来看，在Ex1中，当AJAX从S1返回时，它会加载S2，然后调用一个方法说S2已经改变。在 Ex2 中，当新的 AJAX 返回 DIV 的内容时，在将其加载到 DIV 后，它会调用不同的方法（或者可能相同，具体取决于您尝试执行的操作）并提醒它 DIV 有新内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T13:55:22.760

您可以使用 onkeyup 跟踪文本框中的更改。每当有人在给定的文本框中进行更改时，这都会告诉您。

这可能会引发很多事件。但是，使用 onblur 不一定会告诉您文本框的变化，并且 onchange 的浏览器覆盖范围充其量是参差不齐的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T16:08:42.773

您可以将“观察者”脚本设置为计时器，在当前 document.body.innerHTML 上运行 diff 函数并在加载时捕获存储的版本。根据 diff 运行的速度，您可以了解要使用的计时器间隔。

这可能无法捕捉到表单元素的变化，但对于这些变化，更容易遍历页面上每个表单中的所有表单元素。

这是我在 Google 上找到的某人的 diff 函数：http: [//snowtide.com/jsdifflib](http://snowtide.com/jsdifflib)

# java - 在 POI 中复制 Excel 工作表

> ID：848212
> 
> 赞同：23
> 
> 时间：2009-05-11T13:53:08.227
> 
> 标签：java, excel, apache-poi, worksheet

有谁知道使用 POI 将工作表从一个工作簿复制到另一个工作簿的方法？Workbook 类有一个 cloneSheet 方法，但似乎无法将克隆的工作表插入到新工作簿中？

如果没有 API 可以轻松做到这一点，是否有人拥有将所有数据（样式、列宽、数据等）从一张纸复制到另一张纸的代码？

jxls 有复制工作表的方法，但是在工作簿之间复制时它们不起作用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-11-07T12:03:12.523

我已经用 poi 实现了一些功能。请参阅代码供您参考。

```
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;

public class ExcelReadAndWrite {

    public static void main(String[] args) throws IOException {
        ExcelReadAndWrite excel = new ExcelReadAndWrite();
        excel.process("D:/LNN/My Workspace/POI/src/tables.xls");
    }

    public void process(String fileName) throws IOException {
        BufferedInputStream bis = new BufferedInputStream(new FileInputStream(fileName));
        HSSFWorkbook workbook = new HSSFWorkbook(bis);
        HSSFWorkbook myWorkBook = new HSSFWorkbook();
        HSSFSheet sheet = null;
        HSSFRow row = null;
        HSSFCell cell = null;
        HSSFSheet mySheet = null;
        HSSFRow myRow = null;
        HSSFCell myCell = null;
        int sheets = workbook.getNumberOfSheets();
        int fCell = 0;
        int lCell = 0;
        int fRow = 0;
        int lRow = 0;
        for (int iSheet = 0; iSheet < sheets; iSheet++) {
            sheet = workbook.getSheetAt(iSheet);
            if (sheet != null) {
                mySheet = myWorkBook.createSheet(sheet.getSheetName());
                fRow = sheet.getFirstRowNum();
                lRow = sheet.getLastRowNum();
                for (int iRow = fRow; iRow <= lRow; iRow++) {
                    row = sheet.getRow(iRow);
                    myRow = mySheet.createRow(iRow);
                    if (row != null) {
                        fCell = row.getFirstCellNum();
                        lCell = row.getLastCellNum();
                        for (int iCell = fCell; iCell < lCell; iCell++) {
                            cell = row.getCell(iCell);
                            myCell = myRow.createCell(iCell);
                            if (cell != null) {
                                myCell.setCellType(cell.getCellType());
                                switch (cell.getCellType()) {
                                case HSSFCell.CELL_TYPE_BLANK:
                                    myCell.setCellValue("");
                                    break;

                                case HSSFCell.CELL_TYPE_BOOLEAN:
                                    myCell.setCellValue(cell.getBooleanCellValue());
                                    break;

                                case HSSFCell.CELL_TYPE_ERROR:
                                    myCell.setCellErrorValue(cell.getErrorCellValue());
                                    break;

                                case HSSFCell.CELL_TYPE_FORMULA:
                                    myCell.setCellFormula(cell.getCellFormula());
                                    break;

                                case HSSFCell.CELL_TYPE_NUMERIC:
                                    myCell.setCellValue(cell.getNumericCellValue());
                                    break;

                                case HSSFCell.CELL_TYPE_STRING:
                                    myCell.setCellValue(cell.getStringCellValue());
                                    break;
                                default:
                                    myCell.setCellFormula(cell.getCellFormula());
                                }
                            }
                        }
                    }
                }
            }
        }
        bis.close();
        BufferedOutputStream bos = new BufferedOutputStream(
                new FileOutputStream("workbook.xls", true));
        myWorkBook.write(bos);
        bos.close();
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-04T23:39:59.360

我为 NPOI 创建了一个工作项：http://npoi.codeplex.com/WorkItem/View.aspx [?](http://npoi.codeplex.com/WorkItem/View.aspx?WorkItemId=6057) WorkItemId=6057 。

**更新：**工作项在 NPOI 2.0 中实现。[您可以从https://npoi.codeplex.com/releases/view/112932](https://npoi.codeplex.com/releases/view/112932)下载 NPOI 2.0

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-31T15:54:18.567

如果您使用的是 Java POI 库，最好将电子表格加载到内存中，然后创建一个新的并写入您要复制的每条记录……这不是最好的方法，但可以完成复制功能。 ..

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-12-21T04:47:15.547

这是我将工作表从一个工作簿复制到另一个工作簿的实现。这个解决方案对我有用。如果工作表没有表格等，则此代码将起作用。如果工作表包含简单文本（字符串、布尔值、int 等）、公式，则此解决方案将起作用。

```
Workbook oldWB = new XSSFWorkbook(new FileInputStream("C:\\input.xlsx"));
Workbook newWB = new XSSFWorkbook();
CellStyle newStyle = newWB.createCellStyle(); // Need this to copy over styles from old sheet to new sheet. Next step will be processed below
Row row;
Cell cell;
for (int i = 0; i < oldWB.getNumberOfSheets(); i++) {
    XSSFSheet sheetFromOldWB = (XSSFSheet) oldWB.getSheetAt(i);
    XSSFSheet sheetForNewWB = (XSSFSheet) newWB.createSheet(sheetFromOldWB.getSheetName());
    for (int rowIndex = 0; rowIndex < sheetFromOldWB.getPhysicalNumberOfRows(); rowIndex++) {
        row = sheetForNewWB.createRow(rowIndex); //create row in this new sheet
        for (int colIndex = 0; colIndex < sheetFromOldWB.getRow(rowIndex).getPhysicalNumberOfCells(); colIndex++) {
            cell = row.createCell(colIndex); //create cell in this row of this new sheet
            Cell c = sheetFromOldWB.getRow(rowIndex).getCell(colIndex, Row.CREATE_NULL_AS_BLANK ); //get cell from old/original WB's sheet and when cell is null, return it as blank cells. And Blank cell will be returned as Blank cells. That will not change.
                if (c.getCellType() == Cell.CELL_TYPE_BLANK){
                    System.out.println("This is BLANK " +  ((XSSFCell) c).getReference());
                }
                else {  //Below is where all the copying is happening. First It copies the styles of each cell and then it copies the content.              
                CellStyle origStyle = c.getCellStyle();
                newStyle.cloneStyleFrom(origStyle);
                cell.setCellStyle(newStyle);            

                 switch (c.getCellTypeEnum()) {
                    case STRING:                            
                        cell.setCellValue(c.getRichStringCellValue().getString());
                        break;
                    case NUMERIC:
                        if (DateUtil.isCellDateFormatted(cell)) {                             
                            cell.setCellValue(c.getDateCellValue());
                        } else {                              
                            cell.setCellValue(c.getNumericCellValue());
                        }
                        break;
                    case BOOLEAN:

                        cell.setCellValue(c.getBooleanCellValue());
                        break;
                    case FORMULA:

                        cell.setCellValue(c.getCellFormula());
                        break;
                    case BLANK:
                        cell.setCellValue("who");
                        break;
                    default:
                        System.out.println();
                    }
                }
            }
        }

    }
    //Write over to the new file
    FileOutputStream fileOut = new FileOutputStream("C:\\output.xlsx");
    newWB.write(fileOut);
    oldWB.close();
    newWB.close();
    fileOut.close(); 
```

如果您的要求是照原样复制完整的工作表而不留下任何东西，那么在这种情况下，消除过程会比上面的代码效果更好，速度更快，您不必担心丢失公式、图纸、表格、样式、字体等.

```
XSSFWorkbook wb = new XSSFWorkbook("C:\\abc.xlsx");
for (int i = wb.getNumberOfSheets() - 1; i >= 0; i--) {
        if (!wb.getSheetName(i).contentEquals("January")) //This is a place holder. You will insert your logic here to get the sheets that you want.  
            wb.removeSheetAt(i); //Just remove the sheets that don't match your criteria in the if statement above               
}
FileOutputStream out = new FileOutputStream(new File("C:\\xyz.xlsx"));
wb.write(out);
out.close(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-25T16:07:21.767

我花了大约一周的时间来使用 POI（使用 coderanch 上的最新代码）进行此操作 - 请注意代码有缺陷（使用 TreeSet 存在问题，您需要用 HashMap 替换它），但即使在修复之后它在公式上崩溃。

虽然有可能做到这一点，但不得不依赖破解的代码是一个可怕的提议。

根据您的需求/预算，您可能需要考虑硬着头皮购买 aspose - [http://www.aspose.com/doctest/java-components/aspose.cells-for-java/copy-move-worksheets-within -and-between-workbooks.html](http://www.aspose.com/doctest/java-components/aspose.cells-for-java/copy-move-worksheets-within-and-between-workbooks.html)

它成功复制了表格，包括格式、公式和保护规则。我在 130 秒内完成了 300 张。（300 x 90kb 工作簿，编译成一个 15mb 工作簿）。该演示是免费的，它只是在工作簿中添加了一张额外的表格，提醒您购买许可证。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2018-10-16T14:14:11.667

最好的方法是打开文件并加载它。如果您想要源 Excel 文件中的任何特定工作表，则只需删除与预期工作表不匹配的工作表。

尝试这个：

```
 FileInputStream fis=new FileInputStream("D:\\SourceExcel.xls");
     Workbook wb=WorkbookFactory.create(fis);

    for (int i = wb.getNumberOfSheets() - 1; i >= 0; i--) {
            if (!wb.getSheetName(i).contentEquals("SheetNameWhichwantToRetain")) //This is a place holder. You will insert your logic here to get the sheets that you want.  
                wb.removeSheetAt(i); //Just remove the sheets that don't match your criteria in the if statement above               
    }
    FileOutputStream fos = new FileOutputStream(new File("D:\\DestinationFileName.xls"));
    wb.write(fos);
    fos.close();
    System.out.println("file is copied in a new file at destination :"+"D:\\DestinationFileName.xls");
    }
    catch(Exception e){
        e.printStackTrace();
    } 
```

[这应该有助于澄清](https://i.stack.imgur.com/qpwSS.png)

# oracle - 如何使用 VB6 将文件上传到 Oracle BLOB 字段？

> ID：848217
> 
> 赞同：0
> 
> 时间：2009-05-11T13:53:55.260
> 
> 标签：oracle, vb6, blob

我想使用 VB6 从磁盘获取文件并将其上传到 Oracle BLOB 字段中。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T13:54:12.623

**回答我自己的问题，供参考：**

```
Public Function SaveFileAsBlob(fullFileName As String, documentDescription As String) As Boolean

    'Upload a binary file into the database as a BLOB
    'Based on this example: http://www.codeguru.com/forum/printthread.php?t=337027

    Dim rstUpload As ADODB.Recordset
    Dim pkValue AS Long
    On Error GoTo ErrorHandler

    Screen.MousePointer = vbHourglass        

    'Create a new record (but leave document blank- we will update the doc in a moment)
    'the where clause ensures *no* result set; we only want the structure
    strSQL = "SELECT DOC_NUMBER, DOC_DESC, BLOB_FIELD " & _
      " FROM MY_TABLE " & _
      " WHERE PRIMARY_KEY = 0" 
    pkValue = GetNextPKValue

    Set rstUpload = New ADODB.Recordset
    With rstUpload
      .CursorType = adOpenKeyset
      .LockType = adLockOptimistic
      .Open strSQL, myConn
      .AddNew Array("DOC_NUMBER", "DOC_DESC"), _
              Array(pkValue, documentDescription)
      .Close
    End With

    'They may have the document open in an external application.  Create a copy and work with that copy
    Dim tmpFileName As String
    tmpFileName = GetTempPath & ExtractFileName(fullFileName)
    'if the tmp file exists, delete it
    If Len(Dir(tmpFileName)) > 0 Then
      Kill tmpFileName
    End If

    'see this URL for info about this subroutine:
    'http://stackoverflow.com/questions/848087/how-can-i-copy-an-open-file-using-vb6
    CopyFileEvenIfOpen fullFileName, tmpFileName

    'Now that our record is inserted, update it with the file from disk
    Set rstUpload = Nothing
    Set rstUpload = New ADODB.Recordset
    Dim st As ADODB.Stream
    rstUpload.Open "SELECT BLOB_FIELD FROM MY_TABLE WHERE PRIMARY_KEY = " & pkValue
      , myConn, adOpenDynamic, adLockOptimistic
    Set st = New ADODB.Stream
    st.Type = adTypeBinary
    st.Open
    st.LoadFromFile (tmpFileName)
    rstUpload.Fields("BLOB_FIELD").Value = st.Read
    rstUpload.Update

    'Now delete the temp file we created
    Kill (tmpFileName)

    DocAdd = True
ExitPoint:
    On Error Resume Next
    rstUpload.Close
    st.Close
    Set rstUpload = Nothing
    Set st = Nothing
    Screen.MousePointer = vbDefault
    Exit Function
ErrorHandler:
    DocAdd = False
    Screen.MousePointer = vbDefault
    MsgBox "Source: " & Err.Source & vbCrLf & "Number: " & Err.Number & vbCrLf & Err.Description, vbCritical, _
         "DocAdd Error"
    Resume ExitPoint
End Function 
```

# c# - Active Directory 中缺少字段？

> ID：848219
> 
> 赞同：1
> 
> 时间：2009-05-11T13:54:10.733
> 
> 标签：c#, active-directory, ldap, exchange-server

是否有一个字段或无论如何可以在 Active Directory 中重新获取用户的 smtp 服务器？

**Edit1：当然感谢vinny**使用 Exchange ;)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:00:51.300

我认为您正在寻找“homeMTA”属性。它会给你一个像这样的DN：

CN=Microsoft MTA,CN=SERVERNAME,...< *snip* >...,DC=com

编辑：我假设您正在使用 Exchange(?)

# wpf - 使用 NAnt 构建 WPF 应用程序

> ID：848223
> 
> 赞同：0
> 
> 时间：2009-05-11T13:54:30.267
> 
> 标签：wpf, build-automation, nant

`<msbuild>`除了使用NantContrib中的任务之外，是否有某种方法可以使用 NAnt 编译（使用 CSC 任务）WPF 应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T23:03:50.280

如果您在应用程序中不使用任何 XAML，则可以使用 CSC 编译 WPF 应用程序，否则您将需要使用 MSBuild 编译 WPF 应用程序。

使用 NAnt exec 任务可以完成哪些操作。

# jquery - 如何使用 jquery 为特定浏览器调用特定 css

> ID：848227
> 
> 赞同：0
> 
> 时间：2009-05-11T13:55:17.473
> 
> 标签：jquery

如何使用 jquery 为特定浏览器调用特定 css

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:00:48.380

[专门为 jQuery 编写浏览器的文档。](http://docs.jquery.com/Utilities/jQuery.browser)

我不确定您所说的特定 css 是什么意思，但这里有一个获取浏览器然后使用 CSS 选择器显示这些类的示例。

```
if(jQuery.browser.msie) {
  $('.myspecificcssclass').show();
} 
```

一般来说，你不应该这样做，但是......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:02:25.303

这就是你要找的：[CSS Browser detection using jQuery](http://www.tvidesign.co.uk/blog/CSS-Browser-detection-using-jQuery-instead-of-hacks.aspx)

```
<code>
#myInput{background:black;} .browserSafari
#myInput{background:black; position:relative; top:2px;} 
</code>

//example calls specific css for Safari: 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:05:11.683

它不再通过 jQuery 1.3+ 中的浏览器嗅探来完成，而是通过支持它对 W3C 盒模型支持等几件事的支持。

[请参阅 - jQuery.support](http://docs.jquery.com/Utilities/jQuery.support)以进一步阅读 API 中的主题。

# search - 如何在 Lucene.NET 中通过标签查找相关项目

> ID：848229
> 
> 赞同：0
> 
> 时间：2009-05-11T13:55:20.157
> 
> 标签：search, lucene, sitecore

我的索引文档有一个字段，其中包含一组以竖线分隔的 id：

```
a845497737704e8ab439dd410e7f1328|
0a2d7192f75148cca89b6df58fcf2e54|
204fce58c936434598f7bd7eccf11771 
```

*（忽略换行符）*

该字段表示标签列表。该列表可能包含**0**到**n 个**标签 ID。

当我的站点的用户查看特定文档时，我想显示相关文档的列表。此相关文档列表必须由标签确定：

*   只有具有至少一个匹配标签的文档才能出现在“相关文档”列表中。
*   具有最多匹配标签的文档应出现在“相关文档”列表的顶部。

我正在考虑为此使用 WildcardQuery，但不允许以“*”开头的查询。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:01:51.063

当文档被索引时，您的管道分隔的 id 集确实应该被分成单独的字段。这样，您可以简单地查询所需的标签，按相关性降序排序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:07:39.723

您可以在文档中多次使用相同的字段。在这种情况下，您可以通过在 | 上拆分在索引时添加多个“标签”字段。然后，当您搜索时，您只需要在“标签”字段上进行搜索。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T14:57:43.477

将 Lucene 用于此任务的可能用途留出一分钟（我不太熟悉） - 考虑查看 LinkDatabase。

Sitecore 将在幕后跟踪您对项目的所有引用。而且由于您的多个标签确实（我假设）是从某处表示为 Sitecore 项目的标签的元层次结构中选择的 - LinkDatabase 将能够告诉您引用它的所有项目。

在某种伪代码模型中，这将变成

```
对于标签中的每个 ID
  获取所有引用此标签的文档
  对于找到的每个文档
    如果主列表包含文档；增加使用次数
    别的; 将文档添加到主列表
按使用计数降序对主列表进行排序

```

请原谅我没有更精确，但在这个阶段无法模拟一个完整的工作示例。

[您可以在http://larsnielsen.blogspirit.com/tag/XSLT](http://larsnielsen.blogspirit.com/tag/XSLT)找到有关 LinkDatabase 的文章。请注意，如果您使用 TreeListEx 字段标记文档，则在早期版本的 Sitecore 中存在一个已知缺陷。记录在这里： http: [//www.cassidy.dk/blog/sitecore/2008/12/treelistex-not-registering-links-in.html](http://www.cassidy.dk/blog/sitecore/2008/12/treelistex-not-registering-links-in.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T17:08:55.320

在标签字段上尝试此查询。

```
+(tag1 OR tag2 OR ... tagN) 
```

其中 tag1, .. tagN 是文档的标签。

此查询将返回至少有一个标签匹配的文档。评分会自动显示匹配次数最多的文档，因为最终分数是单个分数的总和。

此外，您需要意识到，如果您想查找与 Doc1 的标签类似的文档，您会发现 Doc1 出现在搜索结果的顶部。因此，相应地处理这种情况。

# java - 正则表达式优化 - 在 java 中转义 & 符号

> ID：848231
> 
> 赞同：5
> 
> 时间：2009-05-11T13:55:58.483
> 
> 标签：java, regex, optimization

我需要替换不是 HTML 实体一部分的字符串中的所有 & 。这样字符串“This & entites `&gt;`& `&lt;`”将返回“This `&amp;`entites `&gt; &amp; &lt;`”

我想出了这个正则表达式模式：“ **&[a-zA-Z0-9]{2,7};** ”，效果很好。但是我对正则表达式不是很熟练，当我测试超过 100k 次迭代的速度时，它使用的时间是以前使用的方法的两倍，它没有使用正则表达式。（但也没有 100% 工作）。

测试代码：

```
long time = System.currentTimeMillis();
String reg = "&(?!&#?[a-zA-Z0-9]{2,7};)";
String s="a regex test 1 & 2  1&2 and &_gt; - &_lt;"
for (int i = 0; i < 100000; i++) {test=s.replaceAll(reg, "&amp;");}
System.out.println("Finished in:" + (System.currentTimeMillis() - time) + " milliseconds"); 
```

所以问题是是否有一些明显的方法可以优化这个正则表达式使其更有效？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T14:12:36.657

`s.replaceAll(reg, "&amp;")`每次都在编译正则表达式。编译一次模式将提供一些性能提升（在这种情况下约为 30%）。

```
long time = System.currentTimeMillis();
String reg = "&(?!&#?[a-zA-Z0-9]{2,7};)";
Pattern p = Pattern.compile(reg);
String s="a regex test 1 & 2  1&2 and &_gt; - &_lt;";
for (int i = 0; i < 100000; i++) {
    String test = p.matcher(s).replaceAll("&amp;");
}
System.out.println("Finished in:" + 
             (System.currentTimeMillis() - time) + " milliseconds"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:16:13.000

`&`您必须从前瞻断言中排除。所以试试这个正则表达式：

```
&(?!#?[a-zA-Z0-9]{2,7};) 
```

或者更准确地说：

```
&(?!(?:#(?:[xX][0-9a-fA-F]|[0-9]+)|[a-zA-Z]+);) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:08:25.713

另一种在不使用正则表达式的情况下做到这一点的方法是使用来自[Commons Lang的](http://commons.apache.org/lang/)[StringEscapeUtils](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringEscapeUtils.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:03:00.030

我对 Java 正则表达式类不是很熟悉，但一般来说，您可能想要研究 ; 的零宽度前瞻。在＆符号之后。

[这是一个](http://www.regular-expressions.info/lookaround.html)描述正面和负面前瞻的链接

# java - 制作带有源代码和项目结构的 .jar 文件？

> ID：848245
> 
> 赞同：2
> 
> 时间：2009-05-11T14:01:03.403
> 
> 标签：java, ant, jar

我想知道这是否可以使用`ant`and `java`：

我有一个看起来像这样的 Java 项目：

```
./
  build.xml
  src/
    com/
      example/
        {.java files here} 
  bin/
    com/
      example/
        {compiled .class files here} 
  lib/
    {3rd-party jar files here}
  dist/
    {jar file(s) here} 
```

我知道如何制作一个包含`bin/`目录中内容的 .jar 文件，并使用正确的清单使其运行我的主要 Java 类。

如果可能的话，我想做的是制作一个 .jar 文件：

1.  Java 可以执行（“java -jar myproject.jar”）
2.  其他人可以解压缩以创建项目结构。（包括除“dist/”目录外的所有子目录）

这可能吗？我似乎无法告诉 Java 使用 .jar 文件的 bin/ 子目录作为类路径，我可能以某种方式搞砸了语法。

**编辑：**好的，这听起来像是试图让一个对象服务于两个（太多）目的。我已经放弃了这种方法，而是创建一个标准的 .jar 文件作为可执行文件，以及一个带有源代码的 .zip 文件（build.xml + src 和 lib 目录）。这样就可以轻松下载 2 个文件，超过 1 个文件，但还不错。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:08:13.140

不，`UrlClassLoader`总是尝试在根目录中查找类，并且 jar URL 将始终根据 jar 文件的根目录获取条目。

您*可以*创建一个 jar 文件，其中包含来自根目录的二进制文件，但源文件位于 src 等之下。这不会太糟糕，假设您确实只是拥有`com`唯一的“根”包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:13:01.507

您*可以*将您的项目放在公共 SVN 服务器上，并仅包含有关如何签出源代码的说明——您还将受益于其他人的签入和改进（希望不是故意破坏）。

# .net - 如何在 Excel 宏中使用 JavaScript？

> ID：848246
> 
> 赞同：21
> 
> 时间：2009-05-11T14:01:09.877
> 
> 标签：.net, javascript, excel, vba, j#

Google 在这里托管了一个非常酷的 diff 类：

[http://code.google.com/p/google-diff-match-patch/](http://code.google.com/p/google-diff-match-patch/)

我以前在一些网站上使用过它，但现在我需要*在*Excel 宏中使用它来比较两个单元格之间的文本。

但是，它仅适用于 JavaScript、Python、Java 和 C++，而不适用于 VBA。

我的用户仅限于 Excel 2003，因此纯 .NET 解决方案无法工作。手动将代码转换为 VBA 会花费太多时间，并且会导致升级困难。

我考虑的一个选择是使用 .NET 编译器（JScript.NET 或 J#）编译 JavaScript 或 Java 源代码，使用 Reflector 输出为 VB.NET，最后手动将 VB.NET 代码降级为 VBA，给我一个纯VBA 解决方案。在使用任何 .NET 编译器进行编译时遇到问题后，我放弃了这条路。

假设我可以获得一个有效的 .NET 库，我还可以使用 ExcelDna ( [http://www.codeplex.com/exceldna](http://www.codeplex.com/exceldna) )，这是一个开源 Excel 插件，可以更轻松地集成 .NET 代码。

我的最后一个想法是托管一个 Internet Explorer 对象，将 JavaScript 源发送给它，然后调用它。即使我让这个工作，我的猜测是它会非常缓慢和混乱。

**更新：找到解决方案！**

我使用了下面接受的答案描述的 WSC 方法。我不得不稍微更改 WSC 代码以清理差异并返回与 VBA 兼容的数组数组：

```
function DiffFast(text1, text2)
{
    var d = dmp.diff_main(text1, text2, true);
    dmp.diff_cleanupSemantic(d);
    var dictionary = new ActiveXObject("Scripting.Dictionary"); // VBA-compatible array
    for ( var i = 0; i < d.length; i++ ) {
    dictionary.add(i, JS2VBArray(d[i]));
    }
    return dictionary.Items();
}

function JS2VBArray(objJSArray)
{
    var dictionary = new ActiveXObject("Scripting.Dictionary");
    for (var i = 0; i < objJSArray.length; i++) {
        dictionary.add( i, objJSArray[ i ] );
        }
    return dictionary.Items();
} 
```

我注册了 WSC，它工作得很好。VBA中调用它的代码如下：

```
Public Function GetDiffs(ByVal s1 As String, ByVal s2 As String) As Variant()
    Dim objWMIService As Object
    Dim objDiff As Object
    Set objWMIService = GetObject("winmgmts:")
    Set objDiff = CreateObject("Google.DiffMatchPath.WSC")
    GetDiffs = objDiff.DiffFast(s1, s2)
    Set objDiff = Nothing
    Set objWMIService = Nothing
End Function 
```

（我尝试保留一个全局 objWMIService 和 objDiff，这样我就不必为每个单元创建/销毁它们，但它似乎对性能没有影响。）

然后我写了我的主要宏。它需要三个参数：原始值的范围（一列）、新值的范围以及 diff 应该转储结果的范围。*假设*所有的行数相同，我这里没有进行任何严重的错误检查。

```
Public Sub DiffAndFormat(ByRef OriginalRange As Range, ByRef NewRange As Range, ByRef DeltaRange As Range)
    Dim idiff As Long
    Dim thisDiff() As Variant
    Dim diffop As String
    Dim difftext As String
    difftext = ""
    Dim diffs() As Variant
    Dim OriginalValue As String
    Dim NewValue As String
    Dim DeltaCell As Range
    Dim row As Integer
    Dim CalcMode As Integer 
```

接下来的三行加快了更新速度，而不会在以后破坏用户首选的计算模式：

```
 Application.ScreenUpdating = False
    CalcMode = Application.Calculation
    Application.Calculation = xlCalculationManual
    For row = 1 To OriginalRange.Rows.Count
        difftext = ""
        OriginalValue = OriginalRange.Cells(row, 1).Value
        NewValue = NewRange.Cells(row, 1).Value
        Set DeltaCell = DeltaRange.Cells(row, 1)
        If OriginalValue = "" And NewValue = "" Then 
```

删除以前的差异（如果有）很重要：

```
 Erase diffs 
```

这个测试对我的用户来说是一个可视化的快捷方式，所以当没有任何变化时很清楚：

```
 ElseIf OriginalValue = NewValue Then
            difftext = "No change."
            Erase diffs
        Else 
```

将所有文本组合在一起作为增量单元格值，无论文本是相同的、插入的还是删除的：

```
 diffs = GetDiffs(OriginalValue, NewValue)
            For idiff = 0 To UBound(diffs)
                thisDiff = diffs(idiff)
                difftext = difftext & thisDiff(1)
            Next
        End If 
```

您必须在开始格式化*之前设置值：*

```
 DeltaCell.value2 = difftext
        Call FormatDiff(diffs, DeltaCell)
    Next
    Application.ScreenUpdating = True
    Application.Calculation = CalcMode
End Sub 
```

这是解释差异和格式化增量单元格的代码：

```
Public Sub FormatDiff(ByRef diffs() As Variant, ByVal cell As Range)
    Dim idiff As Long
    Dim thisDiff() As Variant
    Dim diffop As String
    Dim difftext As String
    cell.Font.Strikethrough = False
    cell.Font.ColorIndex = 0
    cell.Font.Bold = False
    If Not diffs Then Exit Sub
    Dim lastlen As Long
    Dim thislen As Long
    lastlen = 1
    For idiff = 0 To UBound(diffs)
        thisDiff = diffs(idiff)
        diffop = thisDiff(0)
        thislen = Len(thisDiff(1))
        Select Case diffop
            Case -1
                cell.Characters(lastlen, thislen).Font.Strikethrough = True
                cell.Characters(lastlen, thislen).Font.ColorIndex = 16 ' Dark Gray http://www.microsoft.com/technet/scriptcenter/resources/officetips/mar05/tips0329.mspx
            Case 1
                cell.Characters(lastlen, thislen).Font.Bold = True
                cell.Characters(lastlen, thislen).Font.ColorIndex = 32 ' Blue
        End Select
        lastlen = lastlen + thislen
    Next
End Sub 
```

有一些优化的机会，但到目前为止它工作得很好。感谢所有帮助过的人！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T20:37:42.403

最简单的方法可能是直接使用 Javascript 将 Javascript 差异逻辑嵌入到 COM 组件中。这可以通过称为“ [Windows 脚本组件](http://msdn.microsoft.com/en-us/library/47004bz8(VS.85).aspx)”的东西来实现。

这是[有关创建 WSC 的教程](http://www.microsoft.com/technet/scriptcenter/resources/scriptshop/default.mspx)。

Windows 脚本组件是在脚本中定义的 COM 组件。组件的接口是通过 COM，这意味着它是 VBA 友好的。该逻辑以任何与 Windows Scripting Hosting 兼容的语言实现，例如 JavaScript 或 VBScript。WSC 在单个 XML 文件中定义，其中嵌入了逻辑、组件类 ID、方法、注册逻辑等。

还有一个[工具可用于帮助创建 WSC](http://www.microsoft.com/downloads/details.aspx?familyid=408024ED-FAAD-4835-8E68-773CCC951A6B&displaylang=en)。基本上它是一个向导类型的东西，它会问你问题并填写 XML 模板。我自己，我刚开始使用示例 .wsc 文件并使用文本编辑器手动编辑它。这是不言自明的。

在脚本中（在 .wsc 文件中）以这种方式定义的 COM 组件可以像任何其他 COM 组件一样从任何可以与 COM 共舞的环境中调用。

**更新**：我花了几分钟时间为 GoogleDiff 制作了 WSC。这里是。

```
<?xml version="1.0"?>

<package>

<component id="Cheeso.Google.DiffMatchPatch">

  <comment>
    COM Wrapper on the Diff/Match/Patch logic published by Google at http://code.google.com/p/google-diff-match-patch/.
  </comment>

<?component error="true" debug="true"?>

<registration
  description="WSC Component for Google Diff/Match/Patch"
  progid="Cheeso.Google.DiffMatchPatch"
  version="1.00"
  classid="{36e400d0-32f7-4778-a521-2a5e1dd7d11c}"
  remotable="False">

  <script language="VBScript">
  <![CDATA[

    strComponent = "Cheeso's COM wrapper for Google Diff/Match/Patch"

    Function Register
      MsgBox strComponent & " - registered."
    End Function

    Function Unregister
      MsgBox strComponent & " - unregistered."
    End Function

  ]]>
  </script>
</registration>

<public>
  <method name="Diff">
    <parameter name="text1"/>
    <parameter name="text2"/>
  </method>
  <method name="DiffFast">
    <parameter name="text1"/>
    <parameter name="text2"/>
  </method>
</public>

<script language="Javascript">
<![CDATA[

    // insert original google diff code here...

// public methods on the component
var dpm = new diff_match_patch();

function Diff(text1, text2)
{
   return dpm.diff_main(text1, text2, false);
}

function DiffFast(text1, text2)
{
   return dpm.diff_main(text1, text2, true);
}

]]>
</script>

</component>

</package> 
```

要使用那个东西，你必须注册它。在资源管理器中，右键单击它，然后选择“注册”。或者，从命令行： regsvr32 file:\c:\scripts\GoogleDiff.wsc

我没有尝试从 VBA 中使用它，但这里有一些使用该组件的 VBScript 代码。

```
Sub TestDiff()
    dim t1 
    t1 = "The quick brown fox jumped over the lazy dog."

    dim t2 
    t2 = "The large fat elephant jumped over the cowering flea."

    WScript.echo("")

    WScript.echo("Instantiating a Diff Component ...")
    dim d
    set d = WScript.CreateObject("Cheeso.Google.DiffMatchPatch")

    WScript.echo("Doing the Diff...")
    x = d.Diff(t1, t2)

    WScript.echo("")
    WScript.echo("Result was of type: " & TypeName(x))
    ' result is all the diffs, joined by commas.  
    ' Each diff is an integer (position), and a string.  These are separated by commas.
    WScript.echo("Result : " & x)

    WScript.echo("Transform result...")
    z= Split(x, ",")
    WScript.echo("")
    redim diffs(ubound(z)/2)
    i = 0
    j = 0
    For Each item in z
      If (j = 0) then
        diffs(i) = item
        j = j+ 1      
      Else 
          diffs(i) = diffs(i) & "," & item
        i = i + 1
        j = 0
      End If
    Next

    WScript.echo("Results:")
    For Each item in diffs
      WScript.echo("  " & item)
    Next

    WScript.echo("Done.")

End Sub 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T14:10:16.443

[Windows 脚本引擎](http://www.microsoft.com/downloads/details.aspx?FamilyID=47809025-d896-482e-a0d6-524e7e844d81&DisplayLang=en#Overview)将允许您运行 JavaScript 库。根据我的经验，它运作良好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T14:08:18.740

我的建议是，无论您做什么，都将其包装在 COM 包装器中。VBA 最好地处理 COM 对象，因此您可以编译为 .NET 组件，然后使用 .NET 的互操作功能公开为 COM 对象。

作为替代方案，您还可以考虑使用 Windows Scripting Host 对象来执行 Javascript 文件并返回结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:10:33.197

这是要考虑的另一种选择，尽管我绝不是说它是最好的选择。

*   确保 Python 版本在 IronPython 中编译。（这里应该没有问题，或者最多只是少量的移植。）
*   使用 C# 创建一个 Excel 插件库并从中引用 IronPython。
*   在 C# Excel 加载项中封装必要的功能。

# plugins - 如何发布具有多个程序集的 Dynamics CRM4 插件？

> ID：848248
> 
> 赞同：3
> 
> 时间：2009-05-11T14:01:21.173
> 
> 标签：plugins, dynamics-crm, dynamics-crm-4

我的插件 DLL 非常简单，但引用了 15 个左右的其他 DLL。我该如何注册？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T14:46:03.773

我知道的方法是：a）将其他程序集放在 GAC 中（我认为这是 SDK 的首选方法）。如果需要在线使用，则必须在每个客户端上安装。b) 使用 ILMerge 将所有程序集合并为一个程序集。您可以将其部署到数据库并让您的离线客户端使用它，而无需单独安装。

# javascript - javascript的效率如何？

> ID：848256
> 
> 赞同：5
> 
> 时间：2009-05-11T14:02:37.240
> 
> 标签：javascript, performance

有时我听到反对在客户端使用 javascript 做事的论点。人们会说“JavaScript 效率低下……或速度慢”之类的话。我想知道是否有事实支持这个结论？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T14:08:40.470

Javascript 性能实际上有两个因素：

1.  你的代码
2.  运行代码的脚本引擎

您的代码是最容易修复的因素。在开发过程中，尽可能优化您的代码。简单的。

第二个并不总是那么容易。我有一些应用程序，其中一个浏览器的性能非常好，而另一个浏览器比泥浆慢。其他人的表现很好。你能做的最好的就是测试，测试，测试，再测试。如果您想要一篇好文章，请查看链接：

[编码恐怖：伟大的浏览器 JavaScript 摊牌](http://www.codinghorror.com/blog/archives/001023.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:04:49.590

这很大程度上取决于浏览器的 javascript 引擎。

总的来说，它是一种脚本语言，因此它的性能不如 C++ 或其他编译语言。但是，它擅长于它的用途，那就是驱动网页。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:11:14.193

如果使用得当，Javascript 很快。否则它的行为很糟糕。例如：无限循环可能会挂起您的浏览器。（但浏览器会询问你是否停止执行）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:11:51.683

选择在客户端和服务器上执行什么任务是一个重要的选择，JavaScript**作为一种语言**的效率并不是唯一需要考虑的因素。

将在客户端上操作的数据必须传输给客户端。如果脚本不需要将所有信息推送到客户端，则页面加载时间会受到影响，并且过滤操作将在链接的效率较低的一端完成（即您将支付网络费用用户获取信息之前的传输时间）。

在客户端上运行的业务规则将暴露给好奇的最终用户。

在客户端上运行的验证业务规则必须在服务器上再次运行，因为您不能信任在您无法控制的环境中运行的代码。

不同的浏览器，甚至在给定浏览器系列中可用的 ECMAScript 实现之间，使这个问题非常主观，并且有很多变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T14:23:43.653

Modern browsers are implementing more and more just-in-time compilation to their interpreters.

My rule of thumb is that if you can't rely on JavaScript being turned on, do as much on the server as you can. If you absolutely know that JavaScript is on, do as much in the client as you can and you'll save on bandwidth and server load.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T14:05:54.143

这得看情况。你拿什么来比较？它在不同的浏览器之间有很大的不同。

根据编写的代码，它的性能可能非常好，也可能相反。

你必须使用 JavaScript 来做某些事情，比如操纵 dom。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T14:06:14.843

我想在大多数情况下，它比回帖要快得多！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T14:06:34.097

我会说这是不正确的答案。您将如何衡量 JavaScript 性能，并将其用于比较。我想只要 JavaScript 是客户端 Web 编程的唯一选择（我不是在谈论 VBScript），你就无法真正说出它的效率。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T14:07:50.160

还取决于您如何编写代码。如果您遵循最佳实践，那很好，如前所述，它比回发更好！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-11T14:08:53.980

你只能在你试图解决的特定问题的背景下真正回答这个问题。发布一个例子，然后我们可以讨论各种技术的优点......

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-11T14:09:32.827

Javascript不是低效的，效率不依赖于语言。口译员可能效率低下。例如，Firefox 解释器在 Linux 的 FF 中运行非常慢，而在 Windows 的 FF 中运行得更好。Chrome 已经实现了一个更快的解释器。有些 Javascript 解释器不会在浏览器中运行，它们通常更快。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-11T14:12:38.653

我猜人们想告诉你的是：在服务器上尽你所能，而不是将所有代码放在客户端。

Javascript 的性能因浏览器而异（或因解释器而异），但 javascript 的用途不应与服务器端语言相同。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-11T14:17:58.907

我是一个“数字人”，所以当有人说“好吧 X 很慢”或“当然，因为 Y 很快”之类的话时，我真的很生气。因此，对于初学者来说，如果要进行任何类型的评估，都需要使用真实数据：

[JavaScript 性能概要](http://ejohn.org/blog/javascript-performance-rundown/)

我也觉得看[Dromaeo](http://dromaeo.com/)的表演有点酷

# ruby-on-rails - 服务器前缀和 rails 路由

> ID：848258
> 
> 赞同：2
> 
> 时间：2009-05-11T14:02:48.720
> 
> 标签：ruby-on-rails, ruby, routing, path, prefix

当我使用路径选项启动服务器时

```
 script/server --path=/myapp 
```

在有路线的同时

```
 map.route 'foo', :controller => 'bar', :action => 'buzz' 
```

然后

```
ActionController::Routing::Routes.recognize_path('/myapp/foo') 
```

引发错误“没有匹配的路由......”

问题：如何让 Rails 内置路由识别路径前缀？非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:38:34.623

尝试放入`config.action_controller.relative_url_root = "/myapp"`environment.rb 并正常启动您的服务器。

然后 Rails 会将 /myapp/ 附加到您的所有路线

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T15:37:31.520

实际上有一个 path_prefix 可用于路由，因此您可以执行以下操作：

```
map.foo, 'foo', :controller => 'bar', :action => 'buzz', :path_prefix => 'myapp' 
```

那应该为您提供 /myapp/foo 的路线

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:21:19.107

非常感谢你的回答！

不幸的是，我不能使用 中的`:path_prefix`选项`map.foo`，因为并非总是如此（最终用户应负责设置或不设置前缀，而不必担心任何路由）。

我指出了以下几点：

```
path = '/myapp/foo'

if relative_url_root = ActionController::Base.relative_url_root
  path.sub!(/\A#{relative_url_root}/i, '')
end

params = ActionController::Routing::Routes.recognize(path)
# => {:controller => 'bar', :action => 'buzz'} 
```

# asp.net - 如何在 VB.Net 或 ASP.Net 中创建 Windows 应用程序

> ID：848264
> 
> 赞同：-1
> 
> 时间：2009-05-11T14:04:18.513
> 
> 标签：asp.net, database, vb.net, sqlclient

从某个数据库表导入数据时，使用哪种方法效率更高：DataAdapter 和 DataSet 还是 DataReader？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:07:09.070

我会选择你最喜欢的那个，一旦你发现使用其中一个的瓶颈就决定优化。如果您只是在计划一个新应用程序，那么让它以 Okay 的性能工作比陷入尝试选择“最佳”方法更有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:18:45.303

Use case is important here. How are you going to use the data once it's marshaled into your application?

If you need only iterate through it, a DataReader has the least memory overhead of your listed technologies.

DataAdapter provides more capabilities in exchange for more memory, and is specificaly going to involve the overhead of DataTable. This is in exchange for a more convenient API.

DataSet is heaviest (before you get to typed datasets, at least), but provides the abilitiy to get in-memory relationships between DataRows.

There is a range of capabilities versus cost in terms of memory and programming efficiency - memory is relatively cheap in many use cases, and programmer time and maintainability of code may be more important in the long run.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:10:45.960

在后台，DataAdapter 使用 DataReader 实际查询数据并填充数据表/数据集。所以一天结束时，使用哪一个并不重要，但我建议使用 DataAdapter，因为它更容易编写代码，并且不易出错。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:17:23.027

数据阅读器将以渐进的方式读取数据，允许您一次处理一行，它快速且重量轻，但主要是向前的。

数据适配器和数据集，实际上使用 DataReader 来获取数据并将结果存储在内存中填充表需要更长的时间，但在此之后访问和更新要快得多，直到您将数据持久化回数据库。

如果速度很重要，请使用数据阅读器，否则使用数据集，因为它更具可读性和可管理性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T15:11:49.723

因为听起来您正在寻找程序效率。我倾向于使用数据读取器作为访问方法的业务对象类。这将使您能够创建可维护的代码并提高速度。

您可以使用迭代 DataReader 的方法创建一个对象，如下例所示。这给了你所有的速度，在我看来它是相当可维护的。这很可能是 DataSet 为您提供的类型，只是没有更多代码行来概括检索数据所需的功能。

像这样的东西：

```
public class Table1
{
    public int Col1 { get; set; }
    public String Col2 { get; set; }

    public List<Table1> GetTable1()
    {
        List<Table1> tableContents = new List<Table1>();
        SqlCommand cmd = new SqlCommand("SELECT * FROM Table1");
        SqlDataReader rdr = cmd.ExecuteReader();
        while (rdr.Read())
        {
            tableContents.Add(new Table1
            {
                Col1 = (int)rdr["Col1"],
                Col2 = (string)rdr["Col2"]
            });
        }

        return tableContents;
    }
} 
```

方法很多，希望对你有帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T14:12:12.103

DataReader 比 DataAdapter 更“有效”，但它有局限性。这可能是最适合您的问题的方法，但如果没有更多细节，很难说。

正如约翰所说，获得可行的解决方案可能是您的首要任务。

# c++ - 将 Qt 与 STL 和 Boost 混合使用 - 是否有任何桥梁可以让它变得简单？

> ID：848269
> 
> 赞同：17
> 
> 时间：2009-05-11T14:05:36.577
> 
> 标签：c++, qt, boost, stl

是否有任何桥梁可以使 Qt 与 STL 和 Boost 的混合尽可能无缝和容易？

这是[Mixing Qt and Boost](https://stackoverflow.com/questions/360160)的后续，没有给出具体的解决方法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-13T08:41:37.970

你需要什么桥梁？

您可以将所有 Qt 容器类与 std 算法一起使用。大多数时候我更喜欢 Qt 容器类，因为我确信它们使用写时复制习语（恒定时间操作）。Qt 的 foreach 函数会创建容器的副本，因此您可以确定它是一个恒定时间操作，这很好。

如果 Qt 信号槽机制变慢，您可以切换到 boost 替代方案。Qt 信号/槽的伟大之处在于两个线程之间的信号/槽连接。

QtConcurrent 与 BOOST.Lambda 配合得很好

* * *

对于“共享”的父子关系，我使用这个辅助函数。

```
template <class Object>
static boost::shared_ptr<Object> makeSharedObject()
{
    using namespace boost;
    using namespace boost::lambda;
    return boost::shared_ptr<Object>( 
        new Object(),
        bind( &Object::deleteLater, _1 ) );
} 
```

* * *

Boost.serialize 不支持 Qt 容器，您必须自己编写序列化函数。我希望在 Qt 流类和 Boost.archive 之间架起一座桥梁。

这是我的 QList 序列化模板，您可以找出其余的...

```
///\file document is based on "boost/serialization/list.hpp"

namespace boost { 
    namespace serialization {

        //---------------------------------------------------------------------------
        /// Saves a QList object to a collection 
        template<class Archive, class U >
        inline void save(Archive &ar, const QList< U > &t, const uint /* file_version */ )
        {
            boost::serialization::stl::save_collection< Archive, QList<U> >(ar, t);
        }

        //---------------------------------------------------------------------------
        /// Loads a QList object from a collection 
        template<class Archive, class U>
        inline void load(Archive &ar, QList<U > &t, const uint /* file_version */ )
        {
                boost::serialization::stl::load_collection< 
                    Archive, 
                    QList<U>, 
                    boost::serialization::stl::archive_input_seq<Archive, QList<U> >,
                    boost::serialization::stl::no_reserve_imp< QList<U> > >(ar, t);
        }

        //---------------------------------------------------------------------------
        /// split non-intrusive serialization function member into separate
        /// non intrusive save/load member functions
        template<class Archive, class U >
        inline void serialize(Archive &ar, QList<U> &t, const uint file_version )
        {
            boost::serialization::split_free( ar, t, file_version);
        }

    } // namespace serialization
} // namespace boost

BOOST_SERIALIZATION_COLLECTION_TRAITS(QList) 
```

* * *

如果您希望 Boost.Bind 将 QPointer 作为普通指针（如 shared_ptr）处理：

```
namespace boost {

    template<typename T> T * get_pointer(QPointer<T> const& qPointer)
    {
        return qPointer;
    }
} 
```

* * *

在需要`QIODevice`a的地方使用`std::stream`

```
namespace boost {
    namespace iostreams {

        class IoDeviceSource 
        {
        public:
            typedef char char_type;
            typedef source_tag category;

            explicit IoDeviceSource(QIODevice& source) 
                : m_source(source) 
            {
            }

            std::streamsize read(char* buffer, std::streamsize n)
            {
                return return m_source.read(buffer, n);
            }   
        private:
            QIODevice& m_source;
        };

        class IoDeviceSink {

        public:
            typedef char char_type;
            typedef sink_tag category;

            explicit IoDeviceSink(QIODevice& sink)
                : m_sink(sink)
            {
            }

            std::streamsize write(const char_type* buffer, std::streamsize n) 
            {
                return m_sink.write(buffer, n);
            }

        private:
            QIODevice &m_sink;
        };

        class IoDeviceDevice {

        public:
            typedef char char_type;
            typedef seekable_device_tag category;

            explicit IoDeviceDevice(QIODevice& device)
                :m_device(device) {
            }

            std::streamsize write(const char_type *buffer, std::streamsize n)
            {
                return m_device.write(buffer, n);
            }

            std::streamsize read(char* buffer, std::streamsize n)
            {
                return m_device.read(buffer, n);
            }

            stream_offset seek(stream_offset off, std::ios_base::seekdir way)
            {
                using namespace std;
                stream_offset next(0);

                if(way==ios_base::beg)
                {
                    next = m_device.pos();
                } 
                else if(way==ios_base::cur)
                {
                    next = m_device.pos() + offset;
                } 
                else if(way==ios_base::end)
                {
                    next = m_device.size() -1 + offset;
                }
                else
                {
                    throw ios_base::failure("bad seek direction");
                }

                if( !m_device.seek(next) )
                {
                    throw ios_base::failure("bad seek offset");
                }
                return m_device.pos();
            }

        private:    
            QIODevice &m_device;
        };
    }
} 
```

**例子**

```
#include <iostream>
#include <QFile>
#include <boost/iostreams/stream.hpp>
#include "iodevicestream.h"

int main(int argc, char *argv[])
{
    namespace io = boost::iostreams;

    QVector<int> data;

    QFile fl("temp.bin");
    fl.open(QIODevice::ReadWrite);
    io::stream<io::IoDeviceDevice> inoutput( fl );  

    std::copy(data.begin(), data.end(), std::ostream_iterator<int>(inoutput, "\n"));
    inoutput.flush();
    inoutput.seekg(0, std::ios_base::beg);
    std::cout << inoutput;
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T14:09:49.423

究竟是什么问题？
如果需要，可以忽略所有 Qt 集合类并使用 STL 等效项。
同样，您可以使用 Boost 的跨平台文件/网络库。

使用 Qt 自己的主要原因可能是 boost 不一定广泛可用，尤其是在移动设备上。对于简单的任务，Boost 的一些库比 Qt 的库更复杂一些。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T18:05:53.043

一般来说，如果你坚持使用 QT Collection 类而不是我们的 STL，那么在使用 QT 时你会做得更好。在 Qt、STL 或 Boost 中，没有任何东西本身会排除在彼此之间使用 then 的可能性。

使用智能指针时必须小心 QT 具有可以处理对象破坏的父/子关系，当对象在 Qt 控制下时释放对象会使您崩溃。

# php - 根据父键选择性地展平 PHP 数组

> ID：848275
> 
> 赞同：0
> 
> 时间：2009-05-11T14:07:11.427
> 
> 标签：php, arrays

我需要在 PHP 中选择性地展平一个数组，但要选择性地进行。如果键与模式匹配，则该键下方的所有子元素都应包含在“平面”输出中。

所以如果我有一个音乐目录：

=> 专辑数组 => 每个专辑都是歌曲名称的数组

然后我可以搜索一个字符串，并得到一个平面数组作为响应。因此，如果我搜索“sun”，那么我会得到所有名称中包含“sun”的艺术家的整个目录，以及专辑名称中包含“sun”的其他艺术家的专辑。

希望这是有道理的。

有人有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T14:09:56.787

您是否有理由不使用数据库来存储听起来像是大量信息的信息？在 SQL 中编写查询以提取您想要的数据是相当简单的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:32:21.547

好的，我假设您的数据如下所示：

```
$data = array(
    "Bill Withers" => array (
        "Lovely Day",
        "Use Me",
        "Ain't No Sunshine"
    ),
    "Fleet Foxes" => array (
        "Sun It Rises",
        "White Winter Hymnal"
    ),
    "Billy Joel" => array (
        "Piano Man"
    )
); 
```

...给定 input `"Bill"`，你想要输出：`["Lovely Day", "Use Me", "Ain't No Sunshine", "Piano Man"]`. 这是您可以做到的一种方法。

```
function getSongs($data, $searchTerm) {
    $output = array();
    foreach ($data as $artist => $songs) {
        if (stripos($artist, $searchTerm) !== false)) {
            $output = array_merge($output, $songs);
        }
    }
    return $output;
} 
```

...我还假设您有充分的理由不为此使用数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:24:46.087

你的意思是这样的吗？

```
$a = array(
    "Sunny" => "Bla-bla1",
    "Sun" => "Bla-bla2",
    "Sunshine" => "Bla-bla3",
);

foreach ($a as $k => $v) 
{
 // check here whenever you want for $k
 // apply something to $v
 if ( ... )
      $b[$i++] = $v;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T15:11:26.010

```
$sample_data = array(  
    'artist_name' => array(  
        'album_name' => array(  
            'song_name',  
            'other_mp3_id_info'  
            )
        )  
    );

function s2($needle,$haystack) {

    $threads = array();
    foreach ($haystack as $artist_name => $albums) {
        if (stripos($artist_name, $needle) !== false)) {
            $threads[] = $haystack[$artist_name];   //Add all artist's albums
        } else {
            foreach ($albums as $album_name => $songs) {
                if (stripos($album_name, $needle) !== false)) {
                    $threads[$artist_name][] = $haystack[$album_name]; //add matching album
                }
            }
        }
    }
    return $threads;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T15:26:25.237

为了建立 NickF 的工作，假设您的数据看起来像他的，我会这样编写函数。

```
function getSongs($data, $searchTerm) {
    foreach ($data as $artist => $songs) {
        if (stripos($artist, $searchTerm) !== false)) {
            $output[$artist] = $songs;
        }
    }
    return $output or null;
} 
```

这个函数的结果，当没有找到匹配项时，显然会返回 null 而不是一个空白数组；当找到多个匹配项时，它们将按其艺术家分组。根据我自己的经验，我发现直接分配 ,`$output[$artist] = $songs`提供比 array_merge 更可预测的结果。（这也保留了艺术家输出该数据。）

就像 NickF 说的那样，我认为您有充分的理由不使用数据库执行此操作？用于此的 SQL 将非常简单，例如，

```
SELECT artist, song FROM songs WHERE artist LIKE '%Bill%' GROUP BY artist; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T15:36:51.117

您可以使用[preg_grep](http://de.php.net/manual/en/function.preg-grep.php)进行搜索，但请务必清理输入：

```
$matchingArtists = preg_grep('/' . preg_quote($searchString) . '/', array_keys($data));
$matchingSongs = array();
foreach ($data as $artist => $songs) {
    $matchingSongs = array_merge($matchingSongs, preg_grep('/' . preg_quote($searchString) . '/', $songs));
} 
```

# sharepoint - 覆盖 SPList.WriteSecurity 行为？

> ID：848277
> 
> 赞同：2
> 
> 时间：2009-05-11T14:07:41.440
> 
> 标签：sharepoint, moss, wss

正如[MSDN](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splist.writesecurity.aspx)所述，WriteSecurity 可能有 3 种状态中的 1 种：

*   1 — 所有用户都可以修改所有项目。
*   2 — 用户只能修改他们创建的项目。
*   4 — 用户不能修改任何列表项。

但是，如果我想要行为*nr。2* plus*用户可以修改分配给他们的项目*吗？好吧，如果我授予用户列表的完全权限（放入所有者组），那么那些可以编辑任何项目（不好）。那么为什么不能通过为 AssignedTo 用户设置项目级别权限“完全控制”来工作（好）？我做到了，但这没有帮助 - 访问被拒绝。

我完全想要问题中所述的功能“[在创建新项目后自动设置列表项权限](https://stackoverflow.com/questions/142756/automatically-set-list-item-permission-after-new-item-is-created/145438#145438)”，引用：

> *   每个用户（主管和团队成员）都可以看到任何任务。
> *   主管可以编辑任何任务
> *   团队成员只能编辑他们自己的任务（分配给他们或由他们创建的任务）

但是尽管答案已被接受，但该解决方案并未为用户提供编辑分配给他们的项目*或*用户创建的项目的方法。

感谢您的帮助，谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-08T19:47:04.900

您唯一的方法是使用基于项目的权限。例如，让工作流或事件处理程序根据您的要求更改每个文件/对象的权限。

您从其他任务中引用的解决方案只是简单的设置`2`，`SPList.WriteSecurity`仍然无法让用户编辑他们**尚未**创建但已分配给的内容 - 在这种情况下，您需要授予这些用户权限，例如通过监听带有事件处理程序 ( `OnItemUpdated`) 的“分配给”字段，并授予相应人员所需的权限。
此外，该解决方案只是为应该始终能够编辑项目（经理）的用户设置更高的权限，这是一个解决方案，但在这种情况下您通常没有所需的粒度。

# sql - SQL 通过经典 ADO - 未定义函数'Round'？

> ID：848288
> 
> 赞同：1
> 
> 时间：2009-05-11T14:09:18.847
> 
> 标签：sql, ado, rounding, mdac

我正在开发一个遗留产品，我有一些 SQL 正在通过 ADO 执行到一个带有与 SQL Server 的链接表的 Access 数据库。当我执行 SQL 时，我收到错误“未定义的函数 'Round”，但**如果我接受查询并直接在 Access 中运行，它工作正常**。我知道一切都是正确的，这是一个特定于机器的问题，因为这是生产代码，它可以在其他机器上运行，并且已经为许多客户成功部署。

我什至不知道从哪里开始说实话。我正在运行正确（最新）版本的 Jet/ADO/MDAC。

任何帮助，将不胜感激。

提前致谢。

**编辑：显然，SQL 包含聚合函数“Round”。我知道 Jet 和 SQL 实现之间的差异。这个问题是由于我机器上的某个组件而不是代码的问题。当通过 MS Access 2007 而不是通过 ADO 完成时，SQL 可以正确执行。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:45:08.307

EDIT2：评论中的正确解决方案：

shahkalpesh：如果它通过 Access 执行良好，则可能是 Access 具有可用的 DLL，它具有 Round 功能。您正在使用什么连接字符串？

Stimul8d：我不确定连接字符串是怎么回事。此代码适用于所有其他机器，无需更改；只是不在我的身上。

Andomar：嗯，这就是你的问题所在，你的机器坏了。您仍然可以安装[vb6 sp6](http://www.microsoft.com/Downloads/details.aspx?familyid=9EF9BF70-DFE1-42A1-A4C8-39718C7E381D&displaylang=en)。

Stimul8d：嗯，SP6 修复了它。干杯 Anndomar，不知道为什么 SP6 修复了它，但它确实修复了！

编辑：根据您的评论，[这个新闻组](http://www.tech-archive.net/Archive/Access/microsoft.public.access.developers.toolkitode/2004-05/0014.html)帖子可能是答案：

> 不幸的是，当您从 Access 外部运行查询时（就像您在 VB 中一样），您与数据库的唯一连接是通过 Jet 引擎，它对大多数 VBA 函数一无所知。除了将数据返回到您的 VB 应用程序并在那里对数据使用函数之外，没有其他办法。

之后发了两篇文章：

> 我解决了这个问题。用 Service Pack 6 更新了我的 VB……它解决了这些问题。

这里的旧答案：

尝试 FLOOR() 而不是 ROUND()。

要将某些内容四舍五入到最接近的整数，您可以：

```
declare @floatmyboat float
set @floatmyboat = 1.51
select floor(@floatmyboat+0.5) 
```

PS也许发布你得到的确切错误。如果它是“圆形函数需要 2 到 3 个参数。”，这意味着 Sql Server 正在 ROUND() 上运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:57:24.600

round() 函数也存在于 SQL Server 中。
唯一的区别是：在 Access 中，精度是一个可选参数，但在 SQL Server 中，您必须指定它。

所以这仅适用于 Access，但不适用于 SQL Server：

```
select round(Column) from Table 
```

这将适用于 Access*和*SQL Server：

```
select round(Column,1) from Table 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T10:33:49.480

> 可能是 Access 有可用的 DLL，它具有 Round 函数

ACE/Jet 将共享表达式服务与 VBA 一起使用。概括地说，ACE/Jet 支持作为表达式的所有 VBA5 函数（与方法不同），其参数和返回值都是标量类型（例如，没有数组，没有对象）。该`Round()`表达式属于此定义，并且确实可用于 ACE/Jet，其语义与其等效的 VBA 函数相同。任何熟悉 ACE/Jet 引擎的人都应该知道，语义可能与 VBA 等效项不同，例如 ACE/Jet ANSI-92 查询模式 SQL

```
SELECT TYPENAME(ROUND(5, 1)) 
```

返回“长”，而 VBA

```
?Typename(Round(5, 1)) 
```

返回“整数”。

换句话说，`Round()`这不会是这里的问题。

# unix - Shell Script — 获取所有修改后的文件

> ID：848293
> 
> 赞同：137
> 
> 时间：2009-05-11T14:10:03.073
> 
> 标签：unix, shell

我宁愿不要在 PHP 中这样做，所以我希望有一个擅长 shell 脚本的人可以提供帮助。

我需要一个以递归方式运行目录并找到最后修改日期大于某个日期的所有文件的脚本。然后，它将 tar 并压缩保存路径信息的文件。

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-05-11T14:28:33.053

很简单：

```
find . -mtime -1 | xargs tar --no-recursion -czf myfile.tgz 
```

where`find . -mtime -1`将选择前一天修改的（递归）当前目录中的所有文件。您可以使用分数，例如：

```
find . -mtime -1.5 | xargs tar --no-recursion -czf myfile.tgz 
```

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2009-05-11T14:17:59.283

如果您有 GNU `find`，那么有大量相关选项。唯一的障碍是它们的接口不那么出色：

*   `-mmin n`（修改时间以分钟为单位）
*   `-mtime n`（修改时间，天）
*   `-newer file`（修改时间比文件的修改时间新）
*   `-daystart`（将开始时间从当前时间调整为一天的开始时间）
*   加上访问时间和“更改”或“创建”时间的替代方案。

困难的部分是确定从某个时间开始的分钟数。

一个值得考虑的选项：用于`touch`创建具有所需修改时间戳的文件；然后使用`find`with `-newer`。

```
touch -t 200901031231.43 /tmp/wotsit
find . -newer /tmp/wotsit -print
rm -f /tmp/wotsit 
```

这会查找比 2009-01-03T12:31:43 更新的文件。显然，在脚本中，`/tmp/wotsit`将是一个带有 PID 或其他值的名称，以使其唯一；并且`trap`即使用户中断，也可以确保将其删除，依此类推。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2014-02-24T00:22:07.747

您可以使用 tar 直接执行此操作，甚至更好：

```
tar -N '2014-02-01 18:00:00' -jcvf archive.tar.bz2 files 
```

这指示 tar 压缩比 2014 年 1 月 1 日 18:00:00 更新的文件。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-05-11T15:21:42.920

这将适用于一些文件。您希望包含“-print0”和“xargs -0”，以防任何路径中有空格。此示例查找过去 7 天内修改的文件。要查找最近 7 天之前修改的内容，请使用“+7”。

```
find . -mtime -7 -print0 | xargs -0 tar -cjf /foo/archive.tar.bz2 
```

正如[本页](http://content.hccfl.edu/pollock/Unix/FindCmd.htm)警告的那样，如果参数很多，xargs 可能会导致多次执行 tar 命令，并且“-c”标志可能会导致问题。在这种情况下，你会想要这个：

```
find . -mtime -7 -print0 | xargs -0 tar -rf /foo/archive.tar 
```

您无法使用 tar 更新压缩的 tar 存档，因此您必须在第二步中对其进行 bzip2 或 gzip 压缩。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-05-11T14:17:09.580

这应该显示过去 7 天内修改的所有文件。

```
find . -type f -mtime -7 -print 
```

通过管道将其导入 tar/zip，你应该会很好。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-01-15T20:04:09.520

我只需执行以下操作即可备份 7 天前的所有新文件

```
tar --newer $(date -d'7 days ago' +"%d-%b") -zcf thisweek.tgz . 
```

请注意，您也可以将“7 天前”替换为任何适合您需要的内容

可 ：`date -d'yesterday' +"%d-%b"`

甚至 ：`date -d'first Sunday last month' +"%d-%b"`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-11T14:18:45.927

在linux下尝试阅读find命令的手册页

```
man find 
```

这样的事情应该

```
 find . -type f -mtime -7 -print -exec cat {} \; | tar cf - | gzip -9 
```

你有它

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-11T14:19:08.610

您可以使用以下命令获取最后一次修改的文件列表，该列表晚于 x 天前：

```
find . -mtime -x 
```

然后，您只需在结果列表中对文件进行 tar 和 zip 压缩，例如：

```
tar czvf mytarfile.tgz `find . -mtime -30` 
```

上个月修改的所有文件。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-07-20T19:42:59.867

此脚本将查找在给定日期前后两分钟修改日期的文件（您可以根据需要更改条件中的值）

```
PATH_SRC="/home/celvas/Documents/Imp_Task/"
PATH_DST="/home/celvas/Downloads/zeeshan/"

cd $PATH_SRC
TODAY=$(date  -d "$(date +%F)" +%s)
TODAY_TIME=$(date -d "$(date +%T)" +%s)

for f in `ls`;
do
#       echo "File -> $f"
        MOD_DATE=$(stat -c %y "$f")
        MOD_DATE=${MOD_DATE% *}
#       echo MOD_DATE: $MOD_DATE
        MOD_DATE1=$(date -d "$MOD_DATE" +%s)
#       echo MOD_DATE: $MOD_DATE

DIFF_IN_DATE=$[ $MOD_DATE1 - $TODAY ]
DIFF_IN_DATE1=$[ $MOD_DATE1 - $TODAY_TIME ]
#echo DIFF: $DIFF_IN_DATE
#echo DIFF1: $DIFF_IN_DATE1
if [[ ($DIFF_IN_DATE -ge -120) && ($DIFF_IN_DATE1 -le 120) && (DIFF_IN_DATE1 -ge -120) ]]
then
echo File lies in Next Hour = $f
echo MOD_DATE: $MOD_DATE

#mv $PATH_SRC/$f  $PATH_DST/$f
fi
done 
```

例如，您希望文件的修改日期仅在给定日期之前，您可以更改`120`为`0`in`$DIFF_IN_DATE`参数丢弃参数的条件`$DIFF_IN_DATE1`。

同样，如果您希望文件在给定日期前后 1 小时具有修改日期，只需替换`120`为`3600`in `if CONDITION`。

# .net - 从多对多查找表中查询对象

> ID：848294
> 
> 赞同：0
> 
> 时间：2009-05-11T14:10:13.730
> 
> 标签：.net, sql, join, subsonic, many-to-many

我有一个`Master1`和`Sub1`另一个调用，其中包含和对象`Master1Sub1_Map`的外键。有多个 ID与 中的单个 ID 相关联。`Master1``Sub1``Sub1``Master1`

如果我想查看`Sub1`分配给特定对象的所有记录，`Master1.ID`我该如何处理 SubSonic 对象？我可以使用 SqlQuery 和`IN`嵌套选择来做到这一点，但是由于映射表使用外键，有没有更好的方法？返回一个 Sub1Collection 会很好。

我在其中看到了一些参考资料，`TableSchema`但我不确定我正在寻找什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:09:24.390

```
Sub1Collection subs = DB.Select().From<Sub1>()  
  .InnerJoin(Master1Sub1_Map)  
  .InnerJoin(Master1)  
  .Where(Master1.Columns.Id).IsEqualTo(1)  
  .ExecuteAsCollection<Sub1Collection>(); 
```

# sql-server - 我在 Microsoft Visio 中有一个数据库图，如何将其导入 Sql Server 2005？

> ID：848296
> 
> 赞同：1
> 
> 时间：2009-05-11T14:10:27.160
> 
> 标签：sql-server, database, sql-server-2005, visio

我在 Microsoft Visio 中做了一个数据库图，但我不知道如何将它导入到 Sql Server 2005？

顺便问一下，您认为可以用来制作数据库图表的最佳工具是哪个，并且允许您将其导入 Sql Server？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:22:14.657

A similar thread is here: [http://www.linkedin.com/answers/technology/software-development/TCH_SFT/291114-19420164?browseCategory=TCH_SFT](http://www.linkedin.com/answers/technology/software-development/TCH_SFT/291114-19420164?browseCategory=TCH_SFT)

Reproduced here:

> > So long as you have the Enterprise Architecture version of Visio, all you have to do is click: Database -> Generate.
> > 
> > From there you can generate the DDL and even create a new database.
> > 
> > Once you have the DDL you will have to use a query window to open the file and then so long as you have access to create a new schema and tables, etc... you can create your new database.

In my openion Microsoft Visio is the best which works with Microsoft SQL Server.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:21:28.510

i'm not 100% sure you can import database diagrams from vision into sql server 2005

sql server 2005 has a neat built-in database diagram tool that actually builds the tables and relationships as you build them in the diagram.

# transactions - 在现有代码中，我发现没有包含在交易中的汇款程序，我应该恐慌吗？

> ID：848306
> 
> 赞同：0
> 
> 时间：2009-05-11T14:12:04.317
> 
> 标签：transactions, currency

在我正在使用的现有代码中，我发现没有包含在交易中的汇款程序是完全不可接受的还是可以的，因为有所有需要的健全性检查，即要转账的金额大于零，以及余额大于或等于零的 ORM 级别验证。

我实际上对此感到如此困惑的原因是因为它来自一个可靠的开发人员，而且它是一段书本上的代码，看到这样的事情而没有看到交易是很奇怪的：

```
self.balance   -= amount
save!

target.balance += amount
target.save! 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:16:27.007

在没有看到任何代码的情况下，我会做出有根据的猜测，即现有代码是不可接受的。*即使进行了健全性检查，如果在“转移”过程中的语句之间*从该帐户提款，您的代码中也会出现竞争条件，这将导致不存在的资金转移。当然，当有很多并发用户时，这种情况发生的概率更大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:15:40.363

[数据库操作](http://en.wikipedia.org/wiki/Transaction_processing)的事务处理方法 - 除其他外 - 两种问题：

1.  它提供了对并发访问的保护
2.  它提供了回滚机制

我看不出任何支票如何取代这两个......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T14:46:12.393

让我向您展示为什么使用一些伪代码这是一件坏事。

两次汇款：

```
#1: How much money does George have? $1500, that is fine.
#1: Send $1000 to Martha.
#1: Take $1000 from George.

#2: How much money does George have? $500, this is not enough.  Give up!
#2: Do not send $1000 to Martha.
#2: Do not take $1000 from George. 
```

真正发生的事情：

```
#1: How much money does George have? $1500, that is fine.
#2: How much money does George have? $1500, that is fine.
#1: Send $1000 to Martha.
#2: Send $1000 to Martha.
#1: Take $1000 from George.
#2: Take $1000 from George. 
```

乔治已经成功转移了他没有的钱！

您的数据库获得的流量越多，这种冲突的可能性就越大。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:19:45.723

当然，您必须尽快修复它。事务是一个逻辑工作单元，可以包括任意数量的文件或数据库操作。只有事务可以确保一切正常或不正常，并让您逃避从不一致的意外状态恢复的日志。

# c++ - 读取和写入缓冲区

> ID：848314
> 
> 赞同：0
> 
> 时间：2009-05-11T14:14:24.890
> 
> 标签：c++, arrays, pointers, memory-management, buffer

我有 2 个类，一个将多个 96 位对象写入缓冲区（一次 32 位 - 3x int32），一个我想从同一个缓冲区读取。

第一个类（Writer）保留和存储内存区域并创建指向第一个 32 位区域的指针。

1.  如何安全地写入缓冲区（暂时忽略缓冲区溢出）...我需要写入 32 位块，那么如何在每次 96 位写入之间更改“写入指针”的位置？我是否做类似的事情：

    ```
    for(int count = 0; count < 100; ++count)  // for 100 96bit objects
    {
        for(int32 i = 0; i < 3; ++i)
        {
            *buffer = *(myInt32 + i);
        }
        // ** how do I move the buffer ptr to the start of the next 96bit memory space? **
    } 
    ```

2.  我保留内存是否安全，写入一些 96 位对象，然后将指向它开头的指针传递给第二个（Reader）类，以确保它们都能够访问相同的对象？（Reader 会一次性读取多个 96 位对象（~10,000），所以我只需要知道读取数据的开始。）

3.  阅读器读取缓冲区后，如何“重置”指针（清空缓冲区）以便再次写入缓冲区？

**缓冲区：** 缓冲区实际上是一个指针，指向由 . 保留的内存区域的开头`posix_memalign`。

```
int32 *tempbufferPtr; 
posix_memalign ((void**)&tempbufferPtr, 8, 10000 ); // space for 10,000 objects 
writePtr = (my96bitObjectclass*)tempbufferPtr; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T14:19:19.997

Just use pointer arithmetic, it will increase by the proper amount (by the size of the pointed-to object).

```
int32 *ptr = ...;

*ptr++ = 1;
*ptr++ = 2;
*ptr++ = 3;

// Here, ptr has been advanced by 3 times 32 bits, and is pointing at the next location. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:24:35.790

只需增加缓冲区指针。这应该有效：

```
for(int count = 0; count < 100; ++count)  // for 100 96bit objects
{
    for(int32 i = 0; i < 3; ++i)
    {
        *buffer++ = *(myInt32 + i);
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:27:52.257

扩展 unwind 的指针思想：

```
typedef struct {
    int a; int b; int c;
} myobj_t;

// allocate some memory
myobj_t *myobj_p, *myobj = malloc( ... );

myobj_p = myobj;  // don't want a memory leak
while ( ... ) {
myobj.a = x;
myobj.b = y;
myobj.c = z;

myobj++;
} 
```

# shell - shell脚本中的行错误

> ID：848321
> 
> 赞同：0
> 
> 时间：2009-05-11T14:16:57.677
> 
> 标签：shell, indentation, heredoc

我在 shell 脚本中有以下代码。这似乎仅在**未**在函数中定义时才有效。有问题的行是包含“<<”的行。错误信息是

> “./run：第 210 行：语法错误：文件意外结束”

如何在函数中正确编写它？

```
init_database()
{
    cd ../cfg
    db.sh << ENDC
    $DB_ADMIN

    0
    y
    n
    ENDC

    check_status

    sqlplus $DB_SCHEMA@$DB_NAME < initial_data.sql

    cd -
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T14:25:16.443

有很多方法可以解决这个问题。

1/取消缩进此处的文档结束标记，例如：

```
cat <<EOF
    hello
    $PWD
EOF 
```

但这会使您的代码看起来很难看。

2/“缩进”此处文档开始标记：

```
cat <<' EOF'
    hello
    $PWD
    EOF 
```

其中第一个 EOF 之前的位与第二个之前的位完全相同（制表符、四个空格、两个制表符等）。这使您可以保持良好的缩进，尽管它不会扩展 here-document 中的变量（`$PWD` 不会更改）。

3/ 允许从输入行的开头和结束标记剥离制表符。

```
cat <<-EOF
    hello
    $PWD
    EOF 
```

但是没有办法让制表符进入行的开头。

4/ 出于您的目的，您还可以使用：

```
(   echo "$DB_ADMIN";
    echo "" ;
    echo "0" ;
    echo "y" ;
    echo "n"
) | db.sh
check_status
sqlplus $DB_SCHEMA@$DB_NAME < initial_data.sql
cd - 
```

我相信 4 号是您的最佳选择。它允许在行和变量扩展中的任何位置很好地排列输入、制表符和空格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:19:48.030

恐怕您的“此处文档”的结尾需要不缩进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:21:04.533

`ENDC`标签必须单独成一行，没有前导/尾随空格。

# .net - Dim X as New Y vs. Dim X as Y = New Y()

> ID：848331
> 
> 赞同：5
> 
> 时间：2009-05-11T14:19:14.070
> 
> 标签：.net, vb.net, syntax

> ### Duplicate
> 
> [Whats the difference between declaring as new and as something new something i](https://stackoverflow.com/questions/321265/whats-the-difference-between-declaring-as-new-and-as-something-new-something-i)

Sad that I don't know this, but can anyone explain the difference between:

```
Dim X as New Y 
```

and

```
Dim X as Y = New Y() 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T14:21:16.360

The first just infers that the type is Y. The second specifies it. This allows you to write things like:

```
Dim X as IList(Of String) = New List(Of String) 
```

That then limits the scope of the choice to use `List(Of String)` - which means that later on you might choose to use a different implementation of `IList(Of String)`, and it'll still compile.

Of course, the shorter version *does* have the benefit of brevity - which can be important if you have very long type names (e.g. using nested generics). It's also required for anonymous types, where you *can't* express the type of X.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T14:26:09.703

Jon Skeet 已经提供了正确的答案，但我想我会添加一些额外的......

尽管这不是您的具体问题，但两者之间存在重要区别

```
Dim X = New Y() 
```

和

```
Dim X As Y = New Y() 
```

这里的差异实际上取决于您使用的 VB.NET 版本。

* * *

**VB.NET 7 和 8**

```
Dim X = New Y() 
```

这定义`X`为`object`( `System.Object`) 类型的变量，然后创建一个类型的对象`Y`并将其分配给`X`。请注意，这*仅*在您已定义时才有效`Option Strict Off`，否则它甚至不会编译。它实际上只是 VB6 和更早时期语法的继承，通常不鼓励使用。

```
Dim X as Y = New Y() 
```

这完全一样，除了`X`现在是强类型的，换句话说，它是类型`Y`而不是`object`（所有类型都继承自它，包括装箱时的值类型）。

**VB.NET 9 及后续版本**

```
Dim X = New Y() 
```

此处的区别（对于较新版本的 VB.NET）是[*类型推断*](http://msdn.microsoft.com/en-us/library/ms364068(v=vs.80).aspx#vb9overview_topic3)在此处生效。因为你没有指定任何类型，但是对于`New Y()`返回 type 实例的编译器来说很明显`Y`，它会自动推断出`X`应该的类型`Y`，这比 object 更具体。类型干扰也适用于更复杂的表达式。

```
Dim X as Y = New Y() 
```

这与 VB.NET 7 和 8 中的解释完全相同。

* * *

总而言之，您可以有效地替换

```
Dim X As New Y() 
```

和

```
Dim X = New Y() 
```

在 VB.NET 9 中，由于类型推断，编译器将对这两行进行完全相同的解释。然而，在早期版本中，第二行将是弱类型（类型`object`），这是不可取的。同样，不是对这个问题的直接回答，但我认为这可能有助于指出。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T14:22:07.480

There is no difference. VB.NET offers:

```
Dim X As New Y 
```

to be syntactically compatible with the old VB6 declaration syntax.

# text - 从 CSV 文件中提取文本

> ID：848334
> 
> 赞同：2
> 
> 时间：2009-05-11T14:19:34.257
> 
> 标签：text, csv

我有一个 CSV 文件，它只有 1 列，但有接近 1500 条记录。

我想从每条记录中提取信息，例如，

“样品电池电压：11.1V，容量：4500mAh”

我想提取 11.1 并放在另一个文件中，即在“电压：”之后，“V”之前。如果记录没有“电压：”，我想在其中有一个空行。

我在Linux环境中，最简单的方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T14:24:22.483

Python

```
import csv
source = open( "myfile.csv", "rb" )
rdr= csv.reader( source )
for row in rdr:
    print "The sample battery has a Voltage: %.1fV, and capacity: %dmAh" % ( float(row[0]), int(row[1]), ) 
```

将帮助您开始从 CSV 文件中提取数据。

* * *

显然（基于评论）该文件看起来像这样。

```
"The sample battery has a Voltage: 11.1V, and capacity: 4500mAh" 
```

这可能是一个 1 列的 CSV。或带有奖金报价的单行。让我们假设它是一个 1 列的 CSV。

```
import csv
import re
v_pat= re.compile(r' (\d+\.\d+)V' )
mah_pat = re.compile(r' (\d+)mAh' )
source = open( "myfile.csv", "rb" )
rdr= csv.reader( source )
for row in rdr:
   v_match= v_pat.search( row[0] )
   mah_match= mah_pat.search( row[0] )
   if v_match and mah_match:
       print v_match.group(1), mah_match.group(1)
   else:
       print # empty line -- not very informative 
```

类似的东西可能是合适的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:35:28.000

我不确定您所说的单列 CSV 文件到底是什么意思；如果它只有一列，它不只是一个文本文件吗？

无论如何，如果每一行都像上面那样，我们有一个像这样的文件：

```
bash-3.2$ 猫示例.txt
样品电池电压：11.1V，容量：4500mAh
样品电池有一些其他信息，但没有 v 条目
样品电池电压：12.1V，容量：4200mAh

```

然后，您可以使用正则表达式轻松去除 11.1 并保留索引，如下所示：

```
bash-3.2$ sed -e 's/.*电压：\([^V]*\)V.*/\1/' -e 's/^The.*//' <example.txt
11.1

12.1

```

如果我误解了不包含电压的线路的格式，可以对其进行调整。请注意，就您的格式而言，我的表达方式非常脆弱，可以改进。另请注意，我没有引用报价，因为您的意图不清楚。以上需要（微不足道）调整以与它们一起使用。

# c# - How to find the next august? C#

> ID：848337
> 
> 赞同：1
> 
> 时间：2009-05-11T14:19:50.090
> 
> 标签：c#, datetime

I have the following problem:

We need to find the next august. I other words if we are 2009-09-01 we need 2010-08-31 if we are 2009-06-21 we need 2009-08-31.

I know I can check if today is smaller than august 31 but I was wondering if there is an other possibility.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-11T14:24:39.987

```
 public static class DateTimeExtensions
    {
        public static DateTime GetNextAugust31(this DateTime date)
        {
            return new DateTime(date.Month <= 8 ? date.Year : date.Year + 1, 8, 31);
        }
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:25:53.853

.Net 2.0

```
 DateTime NextAugust(DateTime inputDate)
    {
        if (inputDate.Month <= 8)
        {
            return new DateTime(inputDate.Year, 8, 31);
        }
        else
        {
            return new DateTime(inputDate.Year+1, 8, 31);
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:30:50.490

```
public static DateTime NextAugust(DateTime input)
{
    switch(input.Month.CompareTo(8))
    {
        case -1:
        case 0: return new DateTime(input.Year, 8, 31);
        case 1:
            return new DateTime(input.Year + 1, 8, 31);
        default:
            throw new ApplicationException("This should never happen");
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:41:31.577

这行得通。一定要添加一些异常处理。例如，如果您为 2 月传入 31，则会引发异常。

```
/// <summary>
        /// Returns a date for the next occurance of a given month
        /// </summary>
        /// <param name="date">The starting date</param>
        /// <param name="month">The month requested. Valid values (1-12)</param>
        /// <param name="day">The day requestd. Valid values (1-31)</param>
        /// <returns>The next occurance of the date.</returns>
        public DateTime GetNextMonthByIndex(DateTime date, int month, int day)
        {
            // we are in the target month and the day is less than the target date
            if (date.Month == month && date.Day <= day)
                return new DateTime(date.Year, month, day);

            //add month to date until we hit our month
            while (true)
            {
                date = date.AddMonths(1);
                if (date.Month == month)
                    return new DateTime(date.Year, month, day);
            }
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            DateTime d = DateTime.Now;            

            //get the next august
            Text = GetNextMonthByIndex(d, 8, 31).ToString();
        } 
```

# javascript - jQuery Filtering

> ID：848338
> 
> 赞同：4
> 
> 时间：2009-05-11T14:20:10.230
> 
> 标签：javascript, jquery, filtering

Is there a way to filter a multi-line select box using jQuery?

I'm a new to jQuery and can't seem to figure out the best way to do this.

For example if I have:

```
<select size="10">
   <option>abc</option>
   <option>acb</option>
   <option>a</option>
   <option>bca</option>
   <option>bac</option>
   <option>cab</option>
   <option>cba</option>
   ...
</select> 
```

I want to filter this list based on a selection drop down with:

```
<select>
   <option value="a">Filter by a</option>
   <option value="b">Filter by b</option>
   <option value="c">Filter by c</option>
</select> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T14:40:55.057

像这样的东西可能会奏效（假设你给你的'Filter by...'选择一个过滤器的id，**然后**过滤/其他选择一个id of **otherOptions**）：

```
$(document).ready(function() {
    $('#filter').change(function() {
        var selectedFilter = $(this).val();
        $('#otherOptions option').show().each(function(i) {
            var $currentOption = $(this);
            if ($currentOption.val().indexOf(selectedFilter) !== 0) {
                $currentOption.hide();
            }
        });
    });
}); 
```

更新：正如@Brian Liang 在评论中指出的那样，您可能在将 <option> 标签设置为**display:none**时遇到问题。因此，以下应该为您提供更好的跨浏览器解决方案：

```
$(document).ready(function() {
    var allOptions = {};

    $('#otherOptions option').each(function(i) {
        var $currentOption = $(this);
        allOptions[$currentOption.val()] = $currentOption.text();
    });

    $('#filter').change(function() {
        // Reset the filtered select before applying the filter again
        setOptions('#otherOptions', allOptions);
        var selectedFilter = $(this).val();
        var filteredOptions = {};

        $('#otherOptions option').each(function(i) {
            var $currentOption = $(this);

            if ($currentOption.val().indexOf(selectedFilter) === 0) {
                filteredOptions[$currentOption.val()] = $currentOption.text();
            }
        });

        setOptions('#otherOptions', filteredOptions);
    });

    function setOptions(selectId, filteredOptions) {
        var $select = $(selectId);
        $select.html('');

        var options = new Array();
        for (var i in filteredOptions) {
            options.push('<option value="');
            options.push(i);
            options.push('">');
            options.push(filteredOptions[i]);
            options.push('</option>');
        }

        $select.html(options.join(''));
    }

}); 
```

# iphone - iphone FMDB can't find table

> ID：848339
> 
> 赞同：0
> 
> 时间：2009-05-11T14:20:14.583
> 
> 标签：iphone, cocoa-touch, sqlite, path, fmdb

```
- init
{
    if(![super init]) return nil;

    //the database is stored in the application bundle.
    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    NSString *documentsDirectory = [paths objectAtIndex:0];

    NSString *path = [documentsDirectory stringByAppendingFormat:@"/base.sqlite"];
    NSLog(@"%@",path);
    db = [FMDatabase databaseWithPath:path];
    [db setLogsErrors:YES];

    if (![db open]) { 
        NSLog(@"Could not open db."); 
        return 0; 
    } else { 
        NSLog(@"DB Open...."); 
    } 

    FMResultSet *rs = [db executeQuery:@"SELECT * FROM settings"]; 

    return self; 
} 
```

that's the code i use for trying to access the data from settings. but this gives an error (and i can assure you that there is a settings table ! )

here is a dump from the terminal

```
BEGIN TRANSACTION;
CREATE TABLE About (id integer PRIMARY KEY AUTOINCREMENT,key varchar UNIQUE,value text);
DELETE FROM sqlite_sequence;
CREATE TABLE settings (version integer,updated timestamp,owner varchar);
INSERT INTO "settings" VALUES(1,'2009-05-11 14:29:07','boulevart');
COMMIT; 
```

and the error:

```
2009-05-11 16:14:19.799 SummerGuide[9892:20b] /Users/andyjacobs/Library/Application Support/iPhone Simulator/User/Applications/762630F5-78CB-41A4-85C2-964316ACFE1D/Documents/base.sqlite
2009-05-11 16:14:19.801 SummerGuide[9892:20b] DB Open....
2009-05-11 16:14:19.804 SummerGuide[9892:20b] DB Error: 1 "no such table: settings"
2009-05-11 16:14:19.804 SummerGuide[9892:20b] DB Query: SELECT * FROM settings 
```

the strange thing is if i change my path to for example /baseeeeee.sqlite (which ain't no file ) it still says "DB Open...."

I just added an existing sqlite file (base.sqlite) to my recourse folder and added the sqlite3 lib to my frameworks.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T15:04:12.870

要在应用程序包中获取文件的路径，请使用以下命令：

```
[[NSBundle mainBundle] pathForResource:@"base" ofType:@"sqlite"]; 
```

要真正打开数据库，您可能必须先将其复制到 Documents 目录，因为尝试修改应用程序包中的文件是个坏消息。

# tsql - DESCENDING/ASCENDING Parameter to a stored procedure

> ID：848340
> 
> 赞同：4
> 
> 时间：2009-05-11T14:20:17.530
> 
> 标签：tsql, stored-procedures

I have the following SP

```
CREATE PROCEDURE GetAllHouses
    set @webRegionID = 2
    set @sortBy = 'case_no'
    set @sortDirection = 'ASC'

    AS
    BEGIN

        Select 
            tbl_houses.*
        from tbl_houses 
        where 
            postal in (select zipcode from crm_zipcodes where web_region_id = @webRegionID)
        ORDER BY 
            CASE UPPER(@sortBy) 
                    when 'CASE_NO' then case_no 
                    when 'AREA' then area 
                    when 'FURNISHED' then furnished 
                    when 'TYPE' then [type] 
                    when 'SQUAREFEETS' then squarefeets 
                    when 'BEDROOMS' then bedrooms 
                    when 'LIVINGROOMS' then livingrooms 
                    when 'BATHROOMS' then bathrooms 
                    when 'LEASE_FROM' then lease_from 
                    when 'RENT' then rent 
                    else case_no 
            END 
    END
    GO 
```

Now everything in that SP works but I want to be able to choose whether I want to sort ASCENDING or DESCENDING. I really can't fint no solution for that using SQL and can't find anything in google.

As you can see I have the parameter sortDirection and I have tried using it in multiple ways but always with errors... Tried Case Statements, IF statements and so on but it is complicated by the fact that I want to insert a keyword.

Help will be very much appriciated, I have tried must of the things that comes into mind but haven't been able to get it right.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T14:27:35.783

您可以使用两个 order by 字段：

```
CASE @sortDir WHEN 'ASC' THEN
    CASE UPPER(@sortBy)
        ...
    END
END ASC,
CASE @sortDir WHEN 'DESC' THEN
    CASE UPPER(@sortBy)
        ...
    END
END DESC 
```

如果没有 WHEN 子句匹配，则 CASE 将评估为 NULL，因此这会导致两个字段之一对于每一行都评估为 NULL（不影响排序顺序），而另一个字段具有适当的方向。

但是，一个缺点是您需要复制 @sortBy CASE 语句。您可以使用带有 sp_executesql 的动态 SQL 并根据参数编写“ASC”或“DESC”文字来实现相同的目的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:29:48.977

该代码将很快变得非常难以管理，因为您需要双重嵌套您的 CASE WHEN ......

在这里考虑使用动态 SQL 可能会更好......

```
DECLARE @sql nvarchar(max)
SET @sql = '
        Select 
                tbl_houses.*
        from tbl_houses 
        where 
                postal in (select zipcode from crm_zipcodes where web_region_id = ' + @webRegionID + ') ORDER BY '

SET @sql = @sql + ' ' + @sortBy + ' ' + @sortDirection

EXEC (@sql) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:30:01.443

您可以使用一些动态 SQL 并使用 EXEC 调用它。如果用户对参数有任何控制权，请注意 SQL 注入。

```
CREATE PROCEDURE GetAllHouses
    set @webRegionID = 2 
    set @sortBy = 'case_no'
    set @sortDirection = 'ASC'
    AS
    BEGIN
    DECLARE @dynamicSQL NVARCHAR(MAX)

    SET @dynamicSQL =
    '
    SELECT
        tbl_houses.*
    FROM
        tbl_houses
    WHERE
        postal
    IN
    (
        SELECT
            zipcode
        FROM
            crm_zipcodes
        WHERE
            web_region_id = ' + CONVERT(nvarchar(10), @webRegionID) + '
    )
    ORDER BY
        ' + @sortBy + ' ' + @sortDirection

    EXEC(@dynamicSQL)

    END
    GO 
```

# linux - IP KVMs / remote access to linux x11 session with no window-manager

> ID：848341
> 
> 赞同：-1
> 
> 时间：2009-05-11T14:20:25.470
> 
> 标签：linux, desktop, ip, kvm

can somebody recommend me good affordable IP KVM? Like Adder. Or some articles evaluating such KVMs?

My project:

Provide remote support to Linux (Fedora) based software that runs on X, but without any window-manager. I know that there is Gnome vino, but it is buggy and it does not meet my needs for other reasons. I would prefer a hardware solution, although I am still willing to look into sw solutions too.

I have a similar project, where I need to support a DOS-based medical device.

In many cases it would be enough for the remote supporter to see the screen, they could guide the on-site person to type/mouse.

TIA, Radim

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T21:30:25.237

我在没有本地鼠标/键盘/显示器的媒体中心上设置了 Xserver，因此我可以远程控制它。

诀窍是使用 X Virtual Framebuffer 和 X11vnc 服务器。

像这样的东西：

```
/usr/bin/xinit /home/dummyuser/.xinitrc -- /usr/bin/Xvfb :20 -screen 0 1200x720x16 +kb -cc 4 -nolisten tcp -deferglyphs

/usr/bin/x11vnc -display :20 
```

并使用**/home/dummyuser/.xinitrc**：

```
cd /home/dummyuser
umask 002
fluxbox & wmpid=$!
# here your startup programs
wait $wmpid 
```

它使用了fluxbox，它是轻量级的窗口管理器。您也可以使用 openbox。如果没有必要，您可以删除窗口管理器。

然后，您可以使用任何 vnc 客户端连接到它，并打开终端、firefox 等。

# bash - Check user input is correct

> ID：848342
> 
> 赞同：9
> 
> 时间：2009-05-11T14:20:31.510
> 
> 标签：bash

I wrote a bash script which takes numbers for calculation via user input. The problem I have is if the user types a letter or a space by mistake, the whole script fails and the user must start again.

There must be an easy way to check the input is numeric only that will ask for the input again if anything else is input accidentally?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-11T14:25:03.950

使用 while 循环

```
number=""
while [[ ! $number =~ ^[0-9]+$ ]]; do
    echo Please enter your age
    read number
done
echo You are $number years old 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T15:08:13.333

为了避免使用繁重的正则表达式引擎，请使用简单的 glob：

```
if [[ ! $input || $input = *[^0-9]* ]]; then
    echo "Error: '$input' is not a number." >&2
fi 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-06-06T15:12:07.780

在数字 _33 或 33___ 前后允许有空格，但不允许 3__3。并且没有字母。0 或

# -- 从用户那里获取输入直到正确

```
 # -- get input until Correct
    unset get_num
    while [[ ! ${get_num} =~ ^[0-9]+$ ]]; do
        echo "Please enter in a number:"
        read get_num
    done
    echo This is a number :  ${get_num} 
```

# -- 获取输入直到正确（在范围内）

```
 # -- get input until Correct (within range)
    unset get_num
    while [[ ! ${get_num} =~ ^[0-9]+$ ]]; do
        echo "Please enter in a number within range of (1-30):"
        read get_num
        ! [[ ${get_num} -ge 1 && ${get_num} -le 30  ]] && unset get_num
    done
    echo This is a number withn a range :  ${get_num} 
```

# -- 获取输入直到正确（在范围内）（完整的正则表达式方式）

“由于正则表达式处理文本而不是数字，因此匹配给定范围内的数字需要格外小心。你不能只写 [0-255] 来匹配 0 到 255 之间的数字。虽然一个有效的正则表达式，它匹配完全不同的东西。[0-255] 是一个包含三个元素的字符类：字符范围 0-2、字符 5 和字符 5（再次）。这个字符类匹配单个数字 0、1、2 或5，就像 [0125]。” ~ [http://www.regular-expressions.info/numericranges.html](http://www.regular-expressions.info/numericranges.html)

```
 # -- get input until Correct (within range) (another way)
    unset get_num
    while [[ ! ${get_num} =~ ^([1-9]|1[0-9]|2[0-9]|30)$ ]]; do
        echo "Please enter in a number within range of (1-30):"
        read get_num
    done
    echo This is a number withn a range :  ${get_num} 
```

# -- 获取输入，并且只检查它（没有 while 循环）

```
 # -- get input, and check it only (no while loop)
    unset get_num
    echo "Please enter in a number:"
    read get_num
    if [[ ! ${get_num} =~ ^[0-9]+$ ]] ;then 
        echo "${get_num} isn't a number" 
    else
        echo "${get_num} is a number"
    fi 
```

# moss - Information Rights Management (IRM) & SharePoint - can the system administrators view the content of a protected file?

> ID：848345
> 
> 赞同：0
> 
> 时间：2009-05-11T14:20:59.447
> 
> 标签：moss, rights-management

We are considering deploying a MOSS site for our HR department but there is some concern over the system administrators being able to access the highly confidential material regarding performance and salaries. It appears that IRM is the silver bullet we are looking for providing the MOSS System Administrators **CAN NOT** open the documents to view the content.

Can anyone confirm that IRM will secure the content from our Sys Admins in our MOSS Site?

Thanks! -Tim

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-14T20:36:27.573

您是否在 www.adeptol.com 上查看过用于 sharepoint 的 Adeptol 权限[管理](http://www.adeptol.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T07:40:30.090

将 IRM 与 SharePoint 结合使用有两种方法：

1.  **SharePoint 集成模式：在此模式下，IRM 会在用户下载**文档时以正确的权限即时应用于文档。在这种情况下，文档不受保护地存储，因此可以直接访问 SQL 数据库的管理员可以查看文档的内容。

2.  “标准”：如果在将文档上传到 SharePoint**之前**对其应用 IRM ，则文档会受到保护（有 2 种保护：SharePoint 权限和 IRM 权限）。因此，在这种情况下，即使是 SQL 管理员也无法提取文档。但是，有一些副作用：例如搜索将无法工作，因为搜索引擎将无法提取文档的内容。

**在您的情况下，您将需要使用第二种解决方案：在将文档上传到 SharePoint 之前对其进行加密。**

# visual-studio - Debugging in visual studio takes 5-15 minutes per page(aspx)

> ID：848355
> 
> 赞同：0
> 
> 时间：2009-05-11T14:22:38.430
> 
> 标签：visual-studio, debugging, performance

I'm running a Pentium 4 2.8 ghz with 1.7g gigs of ram.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:34:47.157

如果您将文件添加到 IIS，则不会花费时间从本地主机运行它，而不是从 VS 调试它

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:52:14.470

您的机器上是否运行了任何防病毒软件？
如果有，请尝试禁用它并再次调试您的网站。

# cocoa - 如何获取 NSView 子类的内部/客户端大小？

> ID：848357
> 
> 赞同：1
> 
> 时间：2009-05-11T14:22:58.943
> 
> 标签：cocoa, macos

我正在为我的 Cocoa 应用程序进行手动布局，有时我需要弄清楚 NSView 子类的内部大小是多少。（例如，我的子视图在 NSBox 内可用的高度是多少？）

原因之一是我使用的是原点位于左上角的坐标系，需要执行坐标变换。

到目前为止，我想不出一种方法来获得这个尺寸，如果有人能给我一个提示，我会很高兴。

我想知道的另一个非常有趣的属性是视图的最小尺寸。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T15:00:17.573

不幸的是，对于所有 NSView 子类，没有标准的方法可以做到这一点。在您的具体示例中，`NSBox`可以按如下方式计算子视图的位置和大小：

```
NSRect availableRect = [someNSBox bounds];
NSSize boxMargins = [someBox contentViewMargins];
availableRect = NSInsetRect(availableRect, boxMargins.width, boxMargins.height); 
```

如果您发现自己经常使用它，您可以`NSBox`按如下方式创建一个类别：

```
// MyNSBoxCategories.h
@interface NSBox (MyCategories)
- (NSRect)contentFrame;
@end 
```

```
// MyNSBoxCategories.m
@implementation NSBox (MyCategories)
- (NSRect)contentFrame
{
    NSRect frameRect = [self bounds];
    NSSize margins = [self contentViewMargins];
    return NSInsetRect(frameRect, margins.width, margins.height);
}
@end 
```

你会像这样使用它：

```
#import "MyNSBoxCategories.h"

//...

NSRect frameRect = [someNSBox contentFrame];
[myContentView setFrame:frameRect];
[someNSBox addSubview:myContentView]; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T15:45:19.590

`-bounds`是您在大多数视图中寻找的那个。然而，NSBox 有点特殊，因为您想查看盒子内容视图的边界，而不是盒子视图本身的边界（盒子视图包括标题、边缘等）。此外，bounds rect 始终是框的实际大小，而 frame rect 可以相对于 bounds 进行修改以对视图的内容应用变换（例如将 200x200 图像压缩为 200x100 帧）。

因此，对于大多数视图，您只需使用`[parentView bounds]`，对于 NSBox，您将使用`[[theBox contentView] bounds]`，您将使用`[[theBox contentView] addSubview: myView]`而不是`[parentView addSubview: myView]`添加您的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:35:03.867

NSView的`bounds`属性返回一个带有原点（通常为 (0,0)）和 NSView 大小的 NSRect。请参阅[此 Apple Developer 文档页面](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/bounds)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:40:05.290

我不确定（我从来不需要深入研究这些东西），但这不是 [NSView bounds] 吗？

[http://www.cocoadev.com/index.pl?DifferenceBetweenFrameAndBounds](http://www.cocoadev.com/index.pl?DifferenceBetweenFrameAndBounds)

# django - actions in django

> ID：848359
> 
> 赞同：0
> 
> 时间：2009-05-11T14:23:30.753
> 
> 标签：django, django-admin

How can i enable or disable actions according to the value of a field.For example In my model I have a status field which can have either of the value 'activate','pending','expired'.I am making a action which set the status equals to 'activate'.Know I want the action to be enable only if status is 'pending'.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:30:12.177

这是**策略**和**状态**设计模式的某种组合。

您将为操作定义方法函数，并且您希望该方法函数对模型实例的状态敏感。

这就是我们所做的。

```
class SpecialProcessing( object ):
    def __init__( self, aModelObject ):
        self.modelObject= aModelObject
    def someMethod( self ):
        pass

class SpecialProcessingActivate( SpecialProcessing ):
    def someMethod( self ):
        # do work if possible or raise exception of not possible

class SpecialProcessingPending( SpecialProcessing ):
    def someMethod( self ):
        # do work if possible or raise exception of not possible

class SpecialProcessingExpired( SpecialProcessing ):
    def someMethod( self ):
        # do work if possible or raise exception of not possible

class MyObject( models.Model ):
    status = models.CharField( max_length = 1 )
    def setState( self ):
        if self.status == "a":
            self.state = SpecialProcessingActivate(self)
        elif self.status == "p":
            self.state = SpecialProcessingPending(self)
        elif self.status == "x":
            self.state = SpecialProcessingExpired(self)
        else:
            raise Exception( "Ouch!" )
    def doSomething( self ):
        self.setState()
        self.state.someMethod() 
```

这样，我们可以自由地添加新的状态（和状态转换规则），而不会过多地干扰模型类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:33:28.753

管理操作方法为您提供查询集。只需为待处理打一个排除或过滤器

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-12T07:44:46.823

我认为使用查询集是个好方法

# c++ - 应用程序无法初始化错误（清单文件问题）

> ID：848360
> 
> 赞同：0
> 
> 时间：2009-05-11T14:23:37.977
> 
> 标签：c++, dll, visual-studio-2005, manifest

我正在尝试在我的项目中使用库（.dll）。一切似乎都设置得很好。这一切都在发布模式下工作。当我对其进行调试时，我在启动时收到这个该死的错误：

ldr: ...应用程序无法初始化错误（或类似的，我翻译了它）

我了解到这与清单文件有关。我在项目设置中摸索了一下，但没有任何效果/我无法理解它。错误仍然存​​在。

有谁知道快速解决这个问题？我不在乎它是否脏。

我想我喜欢 dll-Hell 比 manifest-Hell 更好！！

解决方案：加载了错误版本的 .dll。我不知道他们还躺在系统上。Depedency Walker 是一个很棒的工具，它让我走上了正确的道路。所以我会接受这个答案。

非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:28:19.870

我总是使用[Dependency Walker](http://www.dependencywalker.com/)来调试这类事情。它会告诉您您的 dll 缺少哪些依赖项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T15:02:54.793

您是否尝试在未安装 Visual Studio 的 PC 上运行调试模式可执行文件？如果是这样，您需要将调试 CRT DLL 复制到它上面。见这里： http: [//msdn.microsoft.com/en-us/library/aa985618 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa985618(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:26:24.117

可能与在调试模式下不可用的依赖 DLL 有关（但在发布模式下存在）。确保您需要的调试 DLL 可用（例如在路径中）。

# sharepoint - Workflow initiated by difference in Modified and Current dates - SharePoint

> ID：848363
> 
> 赞同：0
> 
> 时间：2009-05-11T14:24:25.870
> 
> 标签：sharepoint, sharepoint-designer

Good Morning,

I'm using SharePoint Designer 2007 to create a workflow for a MOSS site I have created.

What I'm looking to do is have the workflow send out an email if a document in the library hasn't been modified for the past 30 days (and it's Status field is not set as "Closed"), but I'm stumped as to how I can do this.

Any help would be greatly appreciated! Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:51:31.523

您可以尝试使用“暂停持续时间”操作（在向 SPD 工作流程添加操作时在“核心操作”下）。

*但是*，我从事过具有类似要求的工作，我们认为工作流不是最佳选择。我们有一个控制台应用程序，它计划每天运行并查询列表中的“旧”项目。如果它找到任何旧项目，则它会向用户发送一封电子邮件。

# actionscript-3 - 为什么 ActionScript 没有“泛型”？

> ID：848365
> 
> 赞同：23
> 
> 时间：2009-05-11T14:24:34.807
> 
> 标签：actionscript-3

谁能告诉我为什么 ActionScript 3（一种静态类型语言）没有泛型？是不是工作量太大了？历史的东西？有什么方法可以“伪造”我还没有学会的吗？

*编辑*：非常感谢您的回答！这`Vector`门课基本上是我要找的，其他信息也很有帮助。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-11T15:55:41.943

新的[Vector 类](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/Vector.html)是 Actionscript 3 现在在为 Flash Player 10 编译时支持的一种泛型形式。它们还不支持您自己的泛型类的规范。

我认为 Adob​​e 最终会实现 ES4 标准。如果他们有一个可以更快地将他们推向正确方向的竞争对手，那就太好了。当他们迁移到 CS4 时，我对 AS3 的更新有所期待，但我认为革命性的 Vector 类就足够了。

看起来他们花了很多时间来增强 Flex 和 AIR 的库，所以也许他们稍后会回去改进语言支持，但这可能不是真正的优先事项。请记住，Adobe 是为了钱，而不是为了让语言变得最甜美。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T15:22:08.833

参数类型（“泛型”这个词通常在 ECMAScript 中用于[泛型方法](https://developer.mozilla.org/en/New_in_JavaScript_1.6#Array_and_String_generics)，而不是 Java 中使用的参数类型和运行时多态性的组合）作为 ES4 的一部分被[提出](http://wiki.ecmascript.org/doku.php?id=proposals:type_parameters)，但是 ES4 破裂并且为 ES 提出的大部分类型系统（包括在 ActionScript 中实现的部分）不会进入下一个版本。我不能说 Adob​​e 是否愿意自己走这条路。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T14:53:49.570

我相信这是一个历史事件。 [ActionScript](http://en.wikipedia.org/wiki/ActionScript)基于[ECMAScript](http://en.wikipedia.org/wiki/ECMAScript)（JavaScript 也基于 ECMAScript）。ECMAScript 是一种动态类型语言，这意味着变量没有声明其类型。泛型在静态类型语言中更有用，其中变量的类型是预先声明的。在静态类型语言中，如果没有泛型，您一直都在从根对象（例如 Java 中的 Object）进行强制转换。这在 ECMAScript 中不是问题，因为你可以将任何你想要的东西放入任何数据结构中。

那么为什么 ActionScript 在向 ECMAScript 添加静态类型时没有添加泛型呢？我不能确定这一点，但我认为你的问题的前提有点偏离 - 有通用型容器，例如[Vector](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/Vector.html)。我可能认为他们会保留 ECMAScript 的动态类型容器（对象和数组）以实现向后兼容性，但他们已经在 AS2 和 AS3 之间打破了这一点，所以我不确定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:27:46.267

让我们首先在 actionscript 中获取适当的容器和算法，然后再考虑泛型...

as3 与 javascript 并没有太大区别，顺便说一句，所以你的问题也适用于 JS。

# java - 使用 Java Servlet API 发送 100 Continue

> ID：848378
> 
> 赞同：3
> 
> 时间：2009-05-11T14:26:29.437
> 
> 标签：java, http, servlets, http-status-code-100

是否可以在使用 Java Servlet API (HttpServletResponse) 处理整个请求后发送“100 Continue”HTTP 状态代码，然后再发送一些其他状态代码？

我找不到任何明确的“否”答案，尽管 API 似乎不支持它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:40:12.763

我假设您的意思是“100 继续”。

答案是：不，你不能（至少不是它的预期方式，作为[临时响应](http://greenbytes.de/tech/webdav/rfc2616.html#rfc.section.10.1)）。通常，当请求需要时，servlet 引擎会自动执行此操作。当然，这使得 servlet 不可能*阻止*发送 100 状态——这个问题是 Servlet API 中的一个已知问题，并且以现在的感觉已经众所周知。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-09-15T20:14:18.153

我知道[Jetty 会等到调用 getReader() 或 getInputStream()](http://www.eclipse.org/jetty/documentation/current/jetty-1xx-responses.html)后再发送 100。我认为这是您正在寻找的行为。我不知道Tomcat是做什么的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T20:16:08.407

您的意思是问*如何在收到完整请求之前发送状态代码*，以因缺少标头字段而中断正在进行的请求？似乎这对于标准 servlet 是不可能的。

你用的是什么服务器？

某些服务器的 servlet 扩展可能允许这样做，例如[Tomcat 的 Comet](http://tomcat.apache.org/tomcat-6.0-doc/aio.html) servlet 可能会在标头可用于处理时发送 EventType.BEGIN，这可能允许您中断没有正确身份验证的 PUT。

或者，您的服务器可能有一个插件来拒绝基于标头的请求。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-11T15:30:20.923

你的意思是状态码*100*吗？

[API](http://java.sun.com/products/servlet/2.1/api/javax.servlet.http.HttpServletResponse.html#SC_CONTINUE)确实支持发送 SC_CONTINUE 。

# svn - VisualSVN Server 通常被视为值得信赖的 SVN 服务器吗？

> ID：848380
> 
> 赞同：7
> 
> 时间：2009-05-11T14:27:29.107
> 
> 标签：svn, visualsvn-server

[VisualSVN Server](http://en.wikipedia.org/wiki/VisualSVN_Server)通常被视为值得信赖的 SVN 服务器吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T14:30:37.260

我公司一直在用。据我所知，它只是一个 SVN + Apache 的自定义发行版，并集成到安装程序中，因此它的“可信度”将与 Apache 和 subversion 相同。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-11T15:30:44.387

几周以来，我一直在使用 VisualSVN Server 以及用于 Visual Studio 的 VisualSVN 客户端。它没有任何问题，而且设置起来比从原木上掉下来更容易。管理控制台允许您创建存储库和文件夹，对它们执行简单的操作（删除、导入等）并设置用户权限（Active Directory 集成或 SVN 身份验证）。它只是工作并且做得足够，仅此而已。我认为他们完全正确。

我是一个 Windows Server 人，所以我对使用 Apache 有点怀疑，但它是完全透明的并且集成到 VisualSVN 中，如果他们没有在网站上提到它，我永远不会知道我正在运行 Apache。如果您也想在 Apache 中托管其他东西，那么我想您会想以不同的方式做事，但我想要一个交钥匙解决方案，而 VisualSVN 提供了它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T15:43:24.273

我有一个大问题。

我遇到的问题是，当存储库采用文件系统格式时，存储库以 Windows 换行符（回车 + 换行）而不是 Linux 换行符（换行）保存。

这使我无法将存储库（所有修订都保持不变）从本地网络 Windows 服务器 VisualSVN 托管移植到公共 Linux SVN 托管。由于我所有的代码都在 Windows 代码中，如果我将 Windows 行尾更改为 Linux 行尾，我会弄乱我的所有代码。如果我不转换它们，Linux 中的 SVN 管理工具将无法识别存储库。

所以我可以将代码的导出移到公共存储库中，但是我丢失了所有以前的修订历史，这是一个巨大的不便，但不是一个阻碍。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T14:33:42.683

你能定义可信吗？您的意思是不太可能崩溃或损坏数据，或者您的意思是能够处理大量流量，还是您的意思是不容易被利用或被利用？

SVN + Apache 在这些类别中的每一个都表现良好，但我不知道安装程序的自定义部分有什么。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-11T14:38:04.157

我们已经使用它一段时间了，没有任何问题；除了 GUI 之外，它与所有其他服务器都是相同的 Apache/SVN 基础。很高兴能够使用 MSI 对其进行升级，并且它有一个很好的 Windows GUI 用于处理 AD 集成、证书管理等。它们似乎也能很快地获得更新。唯一的两个负面因素（当然是我上次检查时）是：

1.  除非您想手动设置，否则您只能访问 http/https。
2.  当您决定要使用 https 时，您只使用 https，您似乎无法同时运行 http 和 https。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-06T08:16:50.567

我已经使用它几年了，没有任何问题，它轻巧高效。但是在windows下高度集成（这对我来说根本不是问题）

作为替代方案，Collabnet Subversion Edge 看起来是一款不错的产品，但我没有尝试过。

# c# - 使用 C# 将 PHP 脚本转换为 OpCode 的最简单方法是什么？

> ID：848386
> 
> 赞同：0
> 
> 时间：2009-05-11T14:28:37.747
> 
> 标签：c#, php, bytecode, opcode

使用 C# 将 PHP 脚本（.php）转换为 OpCode/Bytecode（操作码）的最简单方法是什么？如果必须，我可以使用 DLL。

我需要为我正在工作的项目完成此操作，以便更轻松地分析 PHP 代码。

欢迎任何想法或想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:46:19.413

[Phalanger](https://github.com/devsense/phalanger)是您正在寻找的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:39:17.960

我认为您不能进行文字转换，因为它是动态解释的。您基本上必须剖析 PHP 引擎。

每个 PHP 引擎都会有所不同，在另一个使用 Phalanger 的示例中，它只是被转换为 CLR——即：它不再是 PHP，因此您将真正分析 .NET CLR。

# c# - 请求失败，HTTP 状态 401：未授权

> ID：848397
> 
> 赞同：1
> 
> 时间：2009-05-11T14:31:28.990
> 
> 标签：c#

我有以下错误：请求失败，HTTP 状态 401：未经授权。网址：[http://serverName/ReportServer/ReportService2005.asmx](http://serverName/ReportServer/ReportService2005.asmx)

我在一台服务器上有一个 Web 应用程序，并且在其他服务器上有一个报告服务。两台服务器都安装了 Windows 2003。凭据中的用户与我用于安装报告服务的用户相同，并且与使用的 Reportins 服务服务相同。此外，该用户具有 RSS 角色并且是数据库的所有者，并且该用户在应用程序池中。我的代码有问题吗？使用冒充访问报告服务 Web 服务的方法是什么？

```
 {

             ReportingService2005 rs = new ReportingService2005();

            try
            {

                rs.Url = ConfigurationSettings.AppSettings["WSRS"].ToString();
                //rs.Credentials = System.Net.CredentialCache.DefaultCredentials;

                rs.PreAuthenticate = true;

                rs.Credentials = new NetworkCredential(RS.User_Name,RS.Pass_Word,RS.Domain)
                    );

                //string report = "/SampleReports/Employee Sales Summary";
                string desc = "Added by workflow automatically";
                string eventType = "TimedSubscription";
                string scheduleXml = string.Empty;

                /*ExtentionSettings Values*/
                List<ParameterValue> ExtensionSettingsparmList = new List<ParameterValue>();
                foreach (String name in colExtensionSettings.AllKeys)
                {
                    ExtensionSettingsparmList.Add(new ParameterValue() { Name = name, Value = colExtensionSettings[name].ToString() });
                }

                ExtensionSettings extSettings = new ExtensionSettings();
                extSettings.ParameterValues = ExtensionSettingsparmList.ToArray(); // extensionParams;
                extSettings.Extension = "Report Server Email";

                /*Parameters Values*/

                List<ParameterValue> parameterList = new List<ParameterValue>();

                foreach (String name in colParameters.AllKeys)
                {
                    parameterList.Add(new ParameterValue() { Name = name, Value = colParameters[name].ToString() });
                }

                scheduleXml = @"<ScheduleDefinition><StartDateTime>" + DateTime.Now.AddMinutes(1).ToString("s") + "</StartDateTime></ScheduleDefinition>";
                string matchData = scheduleXml;

                return rs.CreateSubscription(report, extSettings, desc, eventType, matchData, parameterList.ToArray());
            } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:43:08.857

这看起来像是 IIS 和 NTLM 身份验证与 AppPool 结合的配置问题。

此知识库文章可能是一个解决方案：

> [当您尝试访问属于 IIS 6.0 应用程序池的网站时，您会收到“HTTP 错误 401.1 - 未经授权：由于凭据无效而拒绝访问”错误消息](http://support.microsoft.com/kb/871179)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:54:00.350

应用程序池需要在有权访问网站的凭据下运行。为确保安全，以您创建的域用户身份运行应用程序池，该用户可以通过适当的安全访问权限访问您的数据库/应用程序。

# sharepoint - 如何为 SharePoint 工作流创建 ASP.NET 关联表单？

> ID：848398
> 
> 赞同：1
> 
> 时间：2009-05-11T14:31:36.697
> 
> 标签：sharepoint, sharepoint-2007

我正在阅读专业的 Microsoft SharePoint 2007 工作流编程。

本书提供了有关 SharePoint 如何工作的一些详细信息，但没有提供创建工作流的过程。

我想知道如何创建 ASP.NET 关联表单（而不是 InfoPath 表单）。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T03:41:51.633

您可能想看看[http://www.codeplex.com/wss3workflow](http://www.codeplex.com/wss3workflow)

该项目提供了一些用于创建关联表单的模板。即使您不继续使用它们，它们也可能会帮助您学习如何创建它们。

# c# - 在 C# 中将 css 类设置为 HtmlInputCheckBox

> ID：848399
> 
> 赞同：4
> 
> 时间：2009-05-11T14:31:45.463
> 
> 标签：c#, asp.net, .net, css, checkbox

我正在 C# 中创建一个 HtmlInputCheckBox 并且我正在尝试为它设置一个 css，但我不能。谁能给我一个示例代码？
例如，下面的一个不起作用。

```
HtmlInputCheckBox FieldCtrl = new HtmlInputCheckBox();
FieldCtrl.ID = "CheckBox1";
FieldCtrl.Style = "CheckBox"; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T14:34:37.440

.Net 并没有直接公开很多普通的 HTML 属性，但是您可以通过 Attributes 集合访问它。

```
FieldCtrl.Attributes["class"] = "MyCssClass"; 
```

# sockets - VMWare/Cygwin/Sockets环境下的Netcat异常

> ID：848400
> 
> 赞同：2
> 
> 时间：2009-05-11T14:31:50.720
> 
> 标签：sockets, cygwin, vmware, netcat

我很高兴在 XP 上托管的 VMWare 机器上运行 Ubuntu Linux。

我的 Linux 应用程序打开了您的基本服务器套接字端口，我将 netcat (nc) 作为客户端连接到该端口，以监听我为“真实”客户端放置在该套接字上的流量。一切都好。

但是，当我在 XP 端打开 Cygwin shell 并从那里运行 nc 时，它似乎无法连接到我的应用程序的服务器套接字。

`nc -l -p 3694`但是，为了验证连接性，如果我在 Linux/VMWare 环境中将nc 作为服务器（DHCP）。

总结一下：

```
Linux App      --  Linux nc  : Works
Linux App      --  Cygwin nc : Does not work
Linux nc (svr) --  Cygwin nc : Works 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-04T21:43:23.913

您是否有可能将访客网络设置为 NAT，因此无法连接到 VM 中监听的东西？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T14:45:05.407

您使用的是哪个[netcat 代码？](http://cygwin.com/ml/cygwin/2002-09/msg00174.html)至少一种变体存在已知问题...

# tfs - TFS：如何在成功构建时自动关闭匹配的工作项？

> ID：848405
> 
> 赞同：1
> 
> 时间：2009-05-11T14:33:06.320
> 
> 标签：tfs, build-automation

我们正在使用持续集成作为构建自动化的一部分。对于每次签入，tfs 构建服务器都会构建项目并在成功时部署到我们的 Web 服务器。

当构建失败时，它会自动创建一个带有构建失败详细信息的新 Bug。

由于 CI 和服务器上的活动，在构建再次开始成功之前，这可能会导致 10 或 20 个失败的工作项。

所以，我有两个选择。我想让构建过程查看是否已经存在构建失败的打开工作项，然后添加详细信息；或者，我希望构建服务器在重新开始工作时自动关闭所有构建失败项目。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:08:04.437

您可以创建一个 MSBuild 任务来执行这些选项中的任何一个。这是我用来帮助您入门的类似代码，但由于我不知道您的工作项或流程的详细信息，您将不得不更改它。

此代码获取与构建关联的所有工作项并更新它们的状态。

如果您选择第一个选项，您只需更改 UpdateWorkItemStatus 方法并更新任何现有的 WI。对于第二种方法，您需要做更多的工作，因为您需要查找先前的构建而不是将其作为输入。

```
using System;
using System.Collections.Generic;
using System.Text;
using Microsoft.Build.Utilities;
using Microsoft.TeamFoundation.Client;
using Microsoft.TeamFoundation.WorkItemTracking.Client;
using Microsoft.Build.Framework;
using Microsoft.TeamFoundation.Build;
using Microsoft.TeamFoundation.Build.Client;

namespace Nowcom.TeamBuild.Tasks
{
    public class UpdateWorkItemState: Task
    {
        private IBuildDetail _Build;

        private void test()
        {
            TeamFoundationServerUrl = "Teamserver";
            BuildUri = "vstfs:///Build/Build/1741";
            Execute();
        }

        public override bool Execute()
        {
            bool result = true;

            try
            {
                TeamFoundationServer tfs = TeamFoundationServerFactory.GetServer(TeamFoundationServerUrl, new UICredentialsProvider());
                tfs.EnsureAuthenticated();

                WorkItemStore store = (WorkItemStore)tfs.GetService(typeof(WorkItemStore));
                IBuildServer buildServer = (IBuildServer)tfs.GetService(typeof(IBuildServer));
                _Build = buildServer.GetAllBuildDetails(new Uri(BuildUri));
                //add build step
                IBuildStep buildStep = InformationNodeConverters.AddBuildStep(_Build, "UpdateWorkItemStatus", "Updating Work Item Status");

                try
                {
                    Log.LogMessageFromText(string.Format("Build Number: {0}", _Build.BuildNumber), MessageImportance.Normal);

                    List<IWorkItemSummary> assocWorkItems = InformationNodeConverters.GetAssociatedWorkItems(_Build);

                        // update work item status 
                        UpdateWorkItemStatus(store, assocWorkItems, "Open", "Resolved");

                    SaveWorkItems(store, assocWorkItems);
                }
                catch (Exception)
                {
                    UpdateBuildStep(buildStep, false);
                    throw;
                }

                UpdateBuildStep(buildStep, result);
             }
            catch (Exception e)
            {
                result = false;

                BuildErrorEventArgs eventArgs;
                eventArgs = new BuildErrorEventArgs("", "", BuildEngine.ProjectFileOfTaskNode, BuildEngine.LineNumberOfTaskNode, BuildEngine.ColumnNumberOfTaskNode, 0, 0, string.Format("UpdateWorkItemState failed: {0}", e.Message), "", "");

                BuildEngine.LogErrorEvent(eventArgs);

                throw;
            }

            return result;
        }

        private static void SaveWorkItems(WorkItemStore store, List<IWorkItemSummary> assocWorkItems)
        {
            foreach (IWorkItemSummary w in assocWorkItems)
            {
                WorkItem wi = store.GetWorkItem(w.WorkItemId);

                if (wi.IsDirty)
                {
                    wi.Save();
                }
            }
        }

        // check in this routine if the workitem is a bug created by your CI process. Check by title or assigned to or description depending on your process.
        private void UpdateWorkItemStatus(WorkItemStore store, List<IWorkItemSummary> assocWorkItems, string oldState, string newState)
        {
            foreach (IWorkItemSummary w in assocWorkItems)
            {
                Log.LogMessageFromText(string.Format("Updating Workitem Id {0}", w.WorkItemId), MessageImportance.Normal);
                WorkItem wi = store.GetWorkItem(w.WorkItemId);
                if (wi.Fields.Contains("Microsoft.VSTS.Build.IntegrationBuild") && wi.State != "Resolved")
                {
                    wi.Fields["Microsoft.VSTS.Build.IntegrationBuild"].Value =_Build.BuildNumber;
                }
                if (wi.State == oldState)
                {
                    wi.State = newState;
                    foreach (Field field in wi.Fields)
                    {
                        if (!field.IsValid)
                        {
                            break;
                        }
                    }
                }

                if (wi.IsDirty)
                {
                    wi.Save();
                }
            }
        }

        private void UpdateBuildStep(IBuildStep step, bool result)
        {
            step.Status = result ? BuildStepStatus.Succeeded : BuildStepStatus.Failed;
            step.FinishTime = DateTime.Now;
            step.Save();
        }

        [Required]
        public string BuildUri { get; set; }

        [Required]
        public string TeamFoundationServerUrl {get; set;}
    }
}

 < UpdateWorkItemState
TeamFoundationServerUrl="$(TeamFoundationServerUrl)"
BuildUri="$(BuildUri)"
ContinueOnError="false"/> 
```

# c# - 从 C# 运行控制台应用程序，但应用程序无法创建文件

> ID：848414
> 
> 赞同：1
> 
> 时间：2009-05-11T14:34:37.907
> 
> 标签：c#, file, console

我有 Windows 窗体应用程序，它运行另一个控制台应用程序，这是代码的一部分

```
prog = new Process();
prog.StartInfo.FileName = exefile; 
```

控制台应用程序应该创建文件，但是当从 C# 运行该应用程序时，当我通过双击运行控制台应用程序时它不会创建任何文件，它工作正常这里是来自“exefile”的代码部分（它在 c++ 上）

```
freopen("file.in","r",stdin);
freopen("file.out","w",stdout);
printf("somedata\n"); 
```

“file.in”肯定存在

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T14:37:21.023

最有可能的是你需要设置工作路径：

```
prog.StartInfo.WorkingDirectory = ... 
```

*即我认为它在当前*的应用程序文件夹中找不到file.in。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:36:58.853

每当您想开始该过程时，您都需要添加此行：

```
prog.Start(); 
```

[这是 MSDN 页面的链接`Process.Start`。](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx) 您可能需要考虑几个重载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:45:10.663

我会建议，

*   处理异常以查看发生了什么问题
*   如前所述，确保调用 start() 方法

这是来自 msdn 的一段代码，您可能需要参考

```
Process myProcess = new Process();

        try
        {
            // Get the path that stores user documents.
            string myDocumentsPath = 
                Environment.GetFolderPath(Environment.SpecialFolder.Personal);

            myProcess.StartInfo.FileName = myDocumentsPath + "\\MyFile.doc"; 
            myProcess.StartInfo.Verb = "Print";
            myProcess.StartInfo.CreateNoWindow = true;
            myProcess.Start();
        }
        catch (Win32Exception e)
        {
            if(e.NativeErrorCode == ERROR_FILE_NOT_FOUND)
            {
                Console.WriteLine(e.Message + ". Check the path.");
            } 

            else if (e.NativeErrorCode == ERROR_ACCESS_DENIED)
            {
                // Note that if your word processor might generate exceptions
                // such as this, which are handled first.
                Console.WriteLine(e.Message + 
                    ". You do not have permission to print this file.");
            }
        } 
```

# c# - LINQ 中的动态 WHERE 子句

> ID：848415
> 
> 赞同：69
> 
> 时间：2009-05-11T14:34:42.963
> 
> 标签：c#, linq, dynamic, where-clause

将动态 WHERE 子句组合到 LINQ 语句的最佳方法是什么？

我在一个表单上有几十个复选框，并将它们作为： Dictionary<string, List<string>> (Dictionary<fieldName,List<values>>) 传递给我的 LINQ 查询。

```
public IOrderedQueryable<ProductDetail> GetProductList(string productGroupName, string productTypeName, Dictionary<string,List<string>> filterDictionary)
{
    var q = from c in db.ProductDetail
            where c.ProductGroupName == productGroupName && c.ProductTypeName == productTypeName
            // insert dynamic filter here
            orderby c.ProductTypeName
            select c;
    return q;
} 
```

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-11T14:39:31.517

[![替代文字](https://i.stack.imgur.com/sgS5X.png)](https://i.stack.imgur.com/sgS5X.png)
[（来源：[scottgu.com](http://www.scottgu.com/blogposts/dynquery/step2.png)）]

你需要这样的东西吗？使用[Linq 动态查询库](http://msdn2.microsoft.com/en-us/vcsharp/bb894665.aspx)（下载包括示例）。

查看[ScottGu 的博客](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)以获取更多示例。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2014-07-30T00:28:33.317

我有类似的场景，我需要根据用户输入添加过滤器并链接 where 子句。

这是示例代码。

```
var votes = db.Votes.Where(r => r.SurveyID == surveyId);
if (fromDate != null)
{
    votes = votes.Where(r => r.VoteDate.Value >= fromDate);
}
if (toDate != null)
{
    votes = votes.Where(r => r.VoteDate.Value <= toDate);
}
votes = votes.Take(LimitRows).OrderByDescending(r => r.VoteDate); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-05-13T01:08:24.593

您还可以使用 LinqKit 中的 PredicateBuilder 使用 Or 或 And 链接多个类型安全的 lambda 表达式。

[http://www.albahari.com/nutshell/predicatebuilder.aspx](http://www.albahari.com/nutshell/predicatebuilder.aspx)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-03-20T09:34:57.050

如果您的列是简单类型（如字符串），则可以采用一种简单的方法

```
public static IEnumerable<MyObject> WhereQuery(IEnumerable<MyObject> source, string columnName, string propertyValue)
{
   return source.Where(m => { return m.GetType().GetProperty(columnName).GetValue(m, null).ToString().StartsWith(propertyValue); });
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2019-02-22T00:15:52.803

使用三元运算符动态决定是否包含条件似乎要简单得多

列出 productList = new List();

```
 productList =
                db.ProductDetail.Where(p => p.ProductDetailID > 0 //Example prop
                && (String.IsNullOrEmpty(iproductGroupName) ? (true):(p.iproductGroupName.Equals(iproductGroupName)) ) //use ternary operator to make the condition dynamic
                && (ID == 0 ? (true) : (p.ID == IDParam))
                ).ToList(); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-02-28T22:51:35.720

我想出了一个即使我也能理解的解决方案……通过使用“包含”方法，您可以链接任意数量的 WHERE。如果 WHERE 是一个空字符串，它将被忽略（或评估为全选）。这是我在 LINQ 中连接 2 个表、应用多个 where 子句并填充要返回到视图的模型类的示例。（这是全选）。

```
public ActionResult Index()
    {
        string AssetGroupCode = "";
        string StatusCode = "";
        string SearchString = "";

        var mdl = from a in _db.Assets
                  join t in _db.Tags on a.ASSETID equals t.ASSETID
                  where a.ASSETGROUPCODE.Contains(AssetGroupCode)
                  && a.STATUSCODE.Contains(StatusCode)
                  && (
                  a.PO.Contains(SearchString)
                  || a.MODEL.Contains(SearchString)
                  || a.USERNAME.Contains(SearchString)
                  || a.LOCATION.Contains(SearchString)
                  || t.TAGNUMBER.Contains(SearchString)
                  || t.SERIALNUMBER.Contains(SearchString)
                  )
                  select new AssetListView
                  {
                      AssetId = a.ASSETID,
                      TagId = t.TAGID,
                      PO = a.PO,
                      Model = a.MODEL,
                      UserName = a.USERNAME,
                      Location = a.LOCATION,
                      Tag = t.TAGNUMBER,
                      SerialNum = t.SERIALNUMBER
                  };

        return View(mdl);
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-21T20:03:57.000

CodePlex 上的这个项目有你想要的。

**System.Linq.Dynamic** - [http://dynamiclinq.codeplex.com/](http://dynamiclinq.codeplex.com/)

> **项目描述**
> 
> 扩展 System.Linq.Dynamic 以支持针对实体框架或支持 IQueryable 的任何提供程序执行在字符串中定义的 Lambda 表达式。

[由于它是您可以在Scott Guthrie 的博客](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)上找到的源代码的扩展，因此您可以执行以下操作：

![在此处输入图像描述](https://i.stack.imgur.com/6pF7s.png)

像这样的事情：

![在此处输入图像描述](https://i.stack.imgur.com/fCbWk.png)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-27T17:52:44.977

您可以使用 Any() 扩展方法。以下似乎对我有用。

```
XStreamingElement root = new XStreamingElement("Results",
                from el in StreamProductItem(file)
                where fieldsToSearch.Any(s => el.Element(s) != null && el.Element(s).Value.Contains(searchTerm))
                select fieldsToReturn.Select(r => (r == "product") ? el : el.Element(r))
            );
            Console.WriteLine(root.ToString()); 
```

其中 'fieldsToSearch' 和 'fieldsToReturn' 都是 List 对象。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-12-17T18:53:57.113

如果有人感兴趣，这是我提出的解决方案。

[https://kellyschronicles.wordpress.com/2017/12/16/dynamic-predicate-for-a-linq-query/](https://kellyschronicles.wordpress.com/2017/12/16/dynamic-predicate-for-a-linq-query/)

首先我们确定我们需要使用的单个元素类型（Of TRow As DataRow），然后确定我们正在使用的“源”并将标识符绑定到该源（（source As TypedTableBase（Of TRow））。然后我们必须指定谓词，或将要传递的 WHERE 子句（谓词 As Func(Of TRow, Boolean)），它将被返回为 true 或 false。然后我们确定我们希望返回的信息如何排序（OrderByField As String）。我们的然后函数将返回一个 EnumerableRowCollection(Of TRow)，这是我们满足谓词条件的数据行的集合(EnumerableRowCollection(Of TRow))。这是一个基本示例。当然，您必须确保您的订单字段不包含nulls，或者已经正确处理了这种情况并确保您的列名（如果您使用的是强类型数据源，请不要介意这一点，它将为您重命名列）是标准的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-03T04:21:13.947

只是为了分享我对这个案例的想法。

解决方案的另一种方法是：

```
 public IOrderedQueryable GetProductList(string productGroupName, string productTypeName, Dictionary> filterDictionary)
{
    return db.ProductDetail
        .where
        (
            p =>
            (
                (String.IsNullOrEmpty(productGroupName) || c.ProductGroupName.Contains(productGroupName))
                && (String.IsNullOrEmpty(productTypeName) || c.ProductTypeName.Contains(productTypeName))
                // Apply similar logic to filterDictionary parameter here !!!
            )
        );  
} 
```

这种方法非常灵活，允许任何参数都可以为空。

# css - CSS溢出不起作用

> ID：848423
> 
> 赞同：0
> 
> 时间：2009-05-11T14:37:06.903
> 
> 标签：css

我有一个带有css设置溢出自动的div，但出现noscrollbar，而一旦我访问了其他页面，它就会出现在页面上。

另外，如果可能的话，我怎样才能删除 div 的溢出样式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T14:40:59.890

溢出自动仅在内容超过元素大小时显示滚动条...

你有一些示例代码吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T14:46:27.557

查看此[参考](http://www.w3schools.com/Css/pr_pos_overflow.asp)以了解溢出属性的概述。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:41:29.033

> 另外，如果可能的话，我怎样才能删除 div 的溢出样式？

默认值是[可见](http://www.w3.org/TR/CSS21/visufx.html#overflow)的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T14:41:54.290

我猜你想要这个？

```
overflow: scroll; 
```

# javascript - 拖动的 div 用目的地改变地方

> ID：848432
> 
> 赞同：1
> 
> 时间：2009-05-11T14:38:30.693
> 
> 标签：javascript, jquery, drag-and-drop, sortables

解释起来可能有点复杂。我有一个包含 9 个 100 x 100 像素的图像的网格（每个数字代表一张图片）：

```
1 2 3
4 5 6
7 8 9 
```

我想要的是用户可以拖放，例如 9 比 1，他们改变这样的地方：

```
9 2 3
4 5 6
7 8 1 
```

来自 jquery UI 的 sortables 将不起作用，因为他们的解决方案是使用浮点数。这会将所有框“推”到右边或左边，例如：

```
9 1 2
3 4 5
6 7 8 
```

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:35:41.710

这同时使用了 Draggable 和 Droppable。Draggable 在放置时恢复到其原始位置。当拖动开始时，Draggable 创建一个函数来指定将项目拖放到的 Droppable 的插入位置。当项目被放下时，drop 函数在它被放置的项目之后插入被拖动的项目，并在被放置的项目上调用 insert 函数以将 Droppable 移动到正确的位置。

```
$(function() {
  $('.item').draggable( {
     containment: 'parent',
     revert: true,
     revertDuration: 0,
     start: function() {
         var that = $(this);
         var previous = that.prev( '.item:last' );
         var next = that.next( '.item:first' );
         that.data( 'insert' , function(elem) {
             if (previous.size() > 0) {
                $(elem).insertAfter(previous);
             }
             else if (next.size() > 0) {
                $(elem).insertBefore(next);
             }
         });
     }
  });
  $('.item').droppable( {
    accept: '.item',
    drop: function(event, ui) {
       var elem = $(this);
       if (elem.siblings('.item').size() > 1) {
           ui.draggable.insertAfter(elem);
           var insert = ui.draggable.data('insert');
           insert(elem);
       }
       else { // case where there are only two elements, swap
           var parent = elem.closest('.container');
           var first = parent.children( '.item:first' );
           var last = parent.children( '.item:last' );
           last.insertBefore( first );
       }
    }
  });
});

<div id="container">
    <span class="item">1</span>
    <span class="item">2</span>
    <span class="item">3</span>
    <span class="item">4</span>
    <span class="item">5</span>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T10:16:43.550

感谢您的快速回复！

您的解决方案看起来不错，但第一个在更改位置 1 和 2 时会引发一些错误。第二个不完全存在。但他们帮助很大！

我尝试编写一些我认为是朝着正确方向迈出的代码。你怎么看？

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
    <title>Drag drop 1</title>
    <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.7.1.custom.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        $(".item").draggable({
            // Elements cannot go outside #container
            containment: 'parent',
            // Make sure the element can only be dropped in a grid
            grid: [150,150],
            start: function(event, ui) {
                // Make sure picture always are on top when dragged (z-index)
                $(this).css({'z-index' : '100'});
                // Show start dragged position
                var Startpos = $(this).position();
                $("div#start").text("START: \nLeft: "+ Startpos.left + "\nTop: " + Startpos.top);
            },
            stop: function(event, ui) {
                // Revert to default layer position when dropped (z-index)
                $(this).css({'z-index' : '10'});
                // Show dropped position
                var Stoppos = $(this).position();
                $("div#stop").text("STOP: \nLeft: "+ Stoppos.left + "\nTop: " + Stoppos.top);
            }
        });
    });
    </script>
    <style>
    #container {
        width:480px;
        border:1px solid #000;
    }
    .item {
        position:relative;
        width:150px;
        height:150px;
        z-index:10;
    }
    </style>
</head>
<body>
    <div id="container">
        <img id="productid_1" src="images/pic1.jpg" class="item" alt="" title="" /><img id="productid_2" src="images/pic2.jpg" class="item" alt="" title="" /><img id="productid_3" src="images/pic3.jpg" class="item" alt="" title="" /><img id="productid_4" src="images/pic4.jpg" class="item" alt="" title="" /><img id="productid_5" src="images/pic5.jpg" class="item" alt="" title="" /><img id="productid_6" src="images/pic6.jpg" class="item" alt="" title="" /><img id="productid_7" src="images/pic7.jpg" class="item" alt="" title="" /><img id="productid_8" src="images/pic8.jpg" class="item" alt="" title="" /><img id="productid_9" src="images/pic9.jpg" class="item" alt="" title="" />
    </div>
    <div style="clear:both;"></div>
    <div id="start">Waiting...</div>
    <div id="stop">Waiting...</div>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T14:58:16.283

看看这个插件：

[http://github.com/brandonaaron/jquery-swap/tree/master](http://github.com/brandonaaron/jquery-swap/tree/master)

# sql-server-2008 - 如何将 Microsoft SQL Server 2008 Report Builder 嵌入到我的表单中？

> ID：848445
> 
> 赞同：5
> 
> 时间：2009-05-11T14:43:04.053
> 
> 标签：sql-server-2008, reportbuilder

我不想从报表管理器中打开报表生成器。我想将报表生成器嵌入到我的表单中。有什么办法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-26T21:56:58.520

这是一个非常古老的话题，但我想发布一个正确的答案，因为它是搜索“报表生成器”时的第一个结果之一。

只需将 WebBrowser 控件添加到您的表单，然后在 Form_Load 上导航到 Reporting Services 服务器的 URL。您将拥有一个简洁的“浏览器”——没有后退按钮、没有停止、没有刷新，但右键单击页面即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T22:14:55.053

我不相信报表生成器使用 SSRS API 以外的任何东西来完成它的工作。您将需要创建自己的报告生成器。一种方法是使用 microsoft 并使用 HTTPAnalyser 或 Fiddler 监视浏览器和服务器之间的流量。然后，您可以从您自己的应用程序中重新创建相同的 Web 服务调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-20T16:46:41.783

我认为不可能这样做，因为 Report Builder 2.0 是一个独立的应用程序

但是，您可以做的是在服务器上创建一个共享数据源，并利用指向应用程序中安装程序的安装文件的链接。然后，用户可以连接到数据源，并根据他们的技能创建自己的报告。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-17T01:49:22.573

您看过 Report Builder 独立安装程序吗？v2.0 刚刚在 4 月份发布，所以你可能没有看到它。你可以在[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=dbddc9b6-6e19-4d4b-9309-13f62901b0d5&displaylang=en)找到它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T20:14:12.630

您可能能够订阅适当的服务并构建一个前端来与该服务对话。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T03:40:11.720

我认为这很容易。
您可以将 Microsoft.ReportViewer 控件从工具箱拖到 Studio 2008 中的 Web 表单中。
然后您可以打开报表生成器来初始化您的报表。
最后，您可以在运行报告时查看和导出该报告。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-20T22:28:56.543

您应该能够在您的应用程序中创建一个超链接以启动单击一次 Report Builder 应用程序。但它不会在您的表单中运行。

有关构建正确 URL 的信息，请参阅[http://technet.microsoft.com/en-us/library/dd795295.aspx](http://technet.microsoft.com/en-us/library/dd795295.aspx)。

保罗

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-20T20:23:53.750

SQL Reporting Services 更像是一个基于服务器的报告解决方案。如果我嵌入到您的表单中，您的意思是您希望最终用户从您的应用程序内部构建报告，我建议您查看第三方工具来执行此操作。我使用 Developer Express 控件，他们为此提供了强大且价格合理的解决方案。产品页面在[这里](http://www.devexpress.com/Products/NET/Reporting/features_enduserdesigner.xml)。

# svn - 颠覆子存储库

> ID：848447
> 
> 赞同：4
> 
> 时间：2009-05-11T14:43:52.477
> 
> 标签：svn

是否有任何稳定的方法可以让 SVN 维护一个 repo 作为另一个的子集。

我可能有以下几点：

1.  phpCodeRepo
2.  pyCodeRepo
3.  内容回购

这样 1 和 2 可以将 repo 3 的一些数据作为其存储库的一个元素。这样更新 3 将导致 1 和 2 中的（可选）版本增加。签出 1 或 2 也将签出正确的版本3。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T14:47:13.203

您可能想使用[钩子来实现](http://svnbook.red-bean.com/en/1.4/svn-book.html#svn.reposadmin.create.hooks)

[此外，您可以在使用externals](http://svnbook.red-bean.com/en/1.4/svn-book.html#svn.advanced.externals)结账时引入其他存储库

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T14:49:44.710

`svn:externals`可能是一个答案。但它仅适用于文件夹级别，因此您可以跨多个存储库共享一个文件夹，但您不能对单个文件执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:46:43.717

这很简单：将 3 个文件夹添加到您的根存储库（phpCodeRepo、pyCodeRepo、contentRepo）。您可能也想研究[branching](http://svnbook.red-bean.com/en/1.1/ch04.html)。

# asp.net-mvc - 使用 jQuery POST 和 ASP.NET MVC 时的控制器参数 NULL

> ID：848463
> 
> 赞同：3
> 
> 时间：2009-05-11T14:46:20.257
> 
> 标签：asp.net-mvc, jquery

我在控制器中处理 jQuery GET 请求没有问题，但是我无法将任何表单数据发送到 POST。客户端片段

```
$.post(url,{name:"John"},function(result){ 
    //process result
}); 
```

结合控制器，

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Save(string name)
{
    return Json("Success!");
} 
```

在操作方法内部检查时，将导致 name 参数的 NULL 值，而我希望将 name 映射到方法参数。在这种情况下，所有其他对象（Request.Form）等似乎都是 NULL。我可以用 a 来做到这一点`$.get`，但我认为我应该用 POST 做任何有副作用的操作。我正在使用 ASP.NET MVC 1.0、jQuery 1.2.6 和 Internet Explorer 7。

谢谢！

**更新**：见下面我的回答和谦虚的道歉

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T16:08:24.967

抱歉，我在页面中有一个 $.ajaxSetup 条目，它将默认 contentType 覆盖为 application/json。

使用默认 contentType 时如下：

```
$.ajax({ url,
         type: "POST",
         contentType: "application/x-www-form-urlencoded",
         success: function(result) { alert(result); },
         data: { name: "John" }
        }); 
```

它之所以有效，是因为 processData 默认为 true，这意味着带有 JSON 对象的数据条目将被解析为字符串（data: "name=John" 也有效）。

很抱歉浪费您的时间 :) 并感谢 Mark 关于传递 JSON 对象的建议，接下来我会这样做，因为它看起来很酷。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T15:27:09.540

我相信您的代码应该可以工作，您的 URL 是否正确并且您的路线设置是否正确？此外，您始终可以启动[Fiddler](http://www.fiddler2.com/fiddler2/)以准确查看您对服务器的请求是什么，以及您是否传递了正确的项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T14:52:56.200

可能是 Save(string name) 方法需要字符串化的 JSON 吗？试试这个：

```
$.post(url,
"{'name':'John'}", function(result){
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T14:52:56.980

它不像制作一个 json 对象并将其扔到一个动作中那么简单。

从[这里](http://blogger.forgottenskies.com/?p=252)开始。人们编写了一些小脚本，这些脚本可以修饰 JSON 对象并准备好执行读取它并将其映射到属性或参数的操作。

# character-encoding - 不显示特殊字符，sifr r436

> ID：848467
> 
> 赞同：0
> 
> 时间：2009-05-11T14:47:36.273
> 
> 标签：character-encoding, sifr

我遵循[了 sIFR wiki 上的解释](http://wiki.novemberborn.net/sifr/How+to+use)，但似乎无法在我的 Flash 电影中显示重音字符。我打开了字符嵌入调色板，将“ÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáââääåæçèéêëìííîïïðñòóôõöøùùúûüýþÿ”粘贴到＆符号后的“包括这些字符”字段中，点击“确定”，然后重新导出.SWF。

这些字符仍然没有在我的 sIFR 文件中呈现——有什么建议吗？我正在运行 r436。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T15:21:59.643

可能是网页/javascript 和 flash 之间的编码没有获取特殊字符 - 您是否调试过您的 javascript 以查看传入的内容？

[编辑] 网页编码设置为什么？[/编辑]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:01:30.047

您是否尝试过检查“基本拉丁语”或“拉丁语 I”框（仅用于完整性检查？）我刚刚查看了我的并使用了“拉丁语 I”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T01:45:52.400

也许您使用的字体不包含这些字符？通常，字体只支持 ascii。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-19T18:11:19.167

正如杰里米所说，我在 sifr 和 charecters 中看到的主要问题是特殊字符不是您使用的字体的一部分。

一种测试方法是使用另一种标准字体（例如 arial）运行您当前的方法，如果它有效，那么它可能取决于您的字体。

它是什么字体？

其次，在 Flash 中制作字体字形时，您必须更改设置以包含任何外来字符，以确保它们在字体 Flash 电影中。大多数非标准字符都会被删除，因为它会减小 swf 字体文件的文件大小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T15:39:02.263

Unicode转义序列？

或者也许检查一个 url 编码图表

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-20T17:40:42.843

当您查看生成的源代码（如下）时，您会看到这些字符是由 javascript 编码的...

```
content=This%2520is%2520an%2520embedding%2520test%253A%253Cbr%253E%25C3%25C4%25C5%25C6%25C7%25C8%25C9%25CA%25CB%25CC%25CD%25CE%25CF 
```

你能在文本字段上打开 HTML 以查看它们是否出现吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-20T19:15:43.370

检查拉丁文有人提到过，拉丁文扩展 A、扩展 B 和 Add'l 呢？Cmd+单击标点符号、基本拉丁语以及所有其他拉丁语选项可能会为您找到丢失的字符。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-20T21:45:52.273

我怀疑它是Flash的问题。如果我转到您的示例页面（[http://unstoppablerobotninja.com/demos/sifr-encode/](http://unstoppablerobotninja.com/demos/sifr-encode/)），右键单击 Flash 电影，然后复制到剪贴板，这是输出：

> 这是一个嵌入测试：
> ÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝÞßàáââãäåæçèéêëìíîïïðñòóôõöøùùúûüýþÿ
> 是否有效？

对我来说，这表明角色在 Flash 电影中的结局很好，但它们没有被渲染。

如果您对其他 Flash 电影使用静态发布，Flash 可以渲染这些字符吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-19T14:08:12.023

尽管该字段设置正确并且需要将特定字符嵌入该字段中，但动态文本字段不呈现特殊字符我也有同样的问题。

我注意到 HTML 源文本被格式化为粗体（即使用**标签）会产生这个问题 - 没有粗体的相同文本会导致正确呈现特殊字符（尽管显然不是粗体:) 我尝试了各种方法，包括使用 unicode 引用和导出字体的粗体变体（Verdana）但没有任何帮助，所以我认为这是一个 Flash 错误。**

 **当然，如果您像我一样需要使用粗体字体，知道这并不能解决问题 - 我仍在寻找解决方案，如果我找到了会回复。

祝你好运 ;）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-08-06T15:36:52.040

解决 Bold 问题很容易。不出现特殊字符完全是另一个问题，也是我们目前遇到的问题。

这是粗体（和斜体）的处理：

如果您在 HTML 中使用粗体或斜体标记，则 Flash 不一定嵌入字体的粗体和斜体版本。您需要做的是创建一些隐藏的动态文本字段，其中嵌入了粗体和斜体版本的字体。这些隐藏的文本字段可以放置在超过时间线末尾的帧中，这样它们就不会在运行时出现。

一个相关的问题是当您单击属性面板中的 B（表示粗体）并将 HTML 文本插入没有 <b> 标记的文本字段时。Flash 会将粗体字体嵌入到 SWF 中，但如果您不在文本中插入 <b> 标记，Flash 将使用非粗体字体呈现它（不会出现，因为它没有嵌入）。

不幸的是，我们遇到了一种情况，即使用一种字体创建了一个动态文本字段，如果我们将其更改为任何其他字体，它就不会呈现。特殊字符（例如 ® 符号）不会呈现，即使它们嵌入在字体中。这适用于 Flash CS3 和 AS2。

# c# - 在 C# 中设置麦克风音量

> ID：848469
> 
> 赞同：4
> 
> 时间：2009-05-11T14:47:50.923
> 
> 标签：c#, audio, microphone

有没有办法在 C# 中设置麦克风音量（通常在控制面板 -> 音频 -> 高级中完成，进入录音，然后拖动滑块）？我只想将其设置为最大值，如果这样更容易的话。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T15:03:33.810

我不认为有一种管理方法可以做到这一点。我会调查winmm dll。 [这是](http://www.pinvoke.net/search.aspx?search=winmm&namespace=winmm)可用方法的链接。

此外，[这里有一个来自 CodeProject 的示例，](http://www.codeproject.com/KB/audio-video/mixerSetControlDetails.aspx?fid=16481&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26&select=959354)说明如何使用它。

# c# - 如何在 switch 语句中添加“或”？

> ID：848472
> 
> 赞同：142
> 
> 时间：2009-05-11T14:49:29.250
> 
> 标签：c#, switch-statement

这就是我想要做的：

```
switch(myvar)
{
    case: 2 or 5:
    ...
    break;

    case: 7 or 12:
    ...
    break;
    ...
} 
```

我尝试使用 "case: 2 || 5" ，但没有成功。

目的是不要为不同的值编写相同的代码。

* * *

## 回答 #1

> 赞同：367
> 
> 时间：2009-05-11T14:51:02.897

通过堆叠每个开关盒，您可以实现 OR 条件。

```
switch(myvar)
{
    case 2:
    case 5:
    ...
    break;

    case 7:
    case 12:
    ...
    break;
    ...
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-05-11T14:51:38.293

您可以通过[堆叠案例标签](http://msdn.microsoft.com/en-us/library/06tc147t(VS.71).aspx)来做到这一点：

```
switch(myvar)
{
    case 2:
    case 5:
    ...
    break;

    case 7: 
    case 12:
    ...
    break;
    ...
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-05-11T14:51:11.993

```
case 2:
case 5:
do something
break; 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-05-11T14:55:23.013

如果您没有另外指定（通过编写break），案例陈述会自动失败。因此你可以写

```
switch(myvar)
{
   case 2:
   case 5:
   {
      //your code
   break;
   } 
```

// ETC... }

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2020-11-11T20:21:25.230

[您可以从 C# 9.0 开始执行此操作](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#pattern-matching-enhancements)：

```
switch(myvar)
{
    case 2 or 5:
        // ...
        break;

    case 7 or 12:
        // ...
        break;
    // ...
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-11T14:59:08.967

[switch 语句](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/switch "switch 语句的文档")的示例表明您不能堆叠非空`case`s，但应该使用`goto`s：

```
// statements_switch.cs
using System;
class SwitchTest 
{
   public static void Main()  
   {
      Console.WriteLine("Coffee sizes: 1=Small 2=Medium 3=Large"); 
      Console.Write("Please enter your selection: "); 
      string s = Console.ReadLine(); 
      int n = int.Parse(s);
      int cost = 0;
      switch(n)       
      {         
         case 1:   
            cost += 25;
            break;                  
         case 2:            
            cost += 25;
            goto case 1;           
         case 3:            
            cost += 50;
            goto case 1;             
         default:            
            Console.WriteLine("Invalid selection. Please select 1, 2, or3.");            
            break;      
       }
       if (cost != 0)
          Console.WriteLine("Please insert {0} cents.", cost);
       Console.WriteLine("Thank you for your business.");
   }
} 
```

# asp.net - ASP.Net OutputCache：缓存的用户控件

> ID：848474
> 
> 赞同：0
> 
> 时间：2009-05-11T14:50:12.603
> 
> 标签：asp.net, outputcache, user-controls

有没有办法获取已缓存的用户控件（用户控件的一个/或实例）列表？Cache 对象的集合似乎不包括 OutputCached 项。谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T17:26:54.620

您可以在 outputcache 周围实现一个包装器，并以编程方式而不是在控件中以声明方式将对象存储在 outputcache 中。通过这种方式，您可以控制缓存项目的完整集合，并在任何给定时间点获取您需要的有关缓存项目的任何详细信息。

[您可以使用此处的文章](http://blogs.technet.com/stefan_gossner/archive/2005/07/11/407522.aspx)以编程方式实现输出缓存

# java - Java 1.6 中的 Java Swing App 中的绘画问题

> ID：848481
> 
> 赞同：5
> 
> 时间：2009-05-11T14:51:21.587
> 
> 标签：java, swing, paint

我正在开发一个 Swing 应用程序（目前在 Java 1.6 update 11 上运行），它有一些间歇性的油漆刷新问题（例如，有工件等）。这只会发生在我们应用程序的某些用户身上，而不会发生在其他用户身上。

在做了一些研究之后，我发现将属性设置`sun.java2d.d3d`为`false`可能会有所帮助，事实上，它对我们的一位用户有所帮助。

现在其他一些用户正在抱怨这个问题，我正在考虑将属性设置`false`为所有用户。

我的基本问题如下：

这究竟是什么原因？是显卡吗？是司机吗？它是来自 Sun 的错误吗？（如http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6635462）这三者的结合？

换句话说，最好简单地关闭这个属性，还是它只影响某些显卡，更新到最新的驱动程序可以修复？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:55:29.293

Java 在 R6 更新 10 中引入了基于 Direct3D 呈现图形的管道。根据[此处](http://java.sun.com/javase/6/webnotes/6u10.html)的发布说明，它仅支持 NVidia 和 ATI 卡，这意味着不使用这些卡的任何人都可能遇到问题。由于这是最近的一项创新，我建议任何使用这些卡的旧驱动程序的人也可能会遇到问题。升级视频驱动程序可能会解决第一种情况，但不会解决最后一种情况。

如果将 sun.java2d.d3d 设置为 false，则可能发生的最坏情况是某些用户无法达到他们理论上可以达到的性能。您必须权衡这是否比您目前看到的问题更可取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T18:52:41.500

是否所有绘画和模型更改操作都在 EDT 上执行（例如更改 TableModel 等）？

# wpf - 在 WPF 中模拟域用户 - UnauthorizedAccess

> ID：848488
> 
> 赞同：2
> 
> 时间：2009-05-11T14:52:18.963
> 
> 标签：wpf, networking, impersonation, unauthorized

我正在尝试在 WPF 应用程序中模拟域用户帐户，以便应用程序可以写入网络上的文件夹。域用户有足够的权限写入此位置。我正在使用在[网上](http://www.codeproject.com/KB/dotnet/UserImpersonationInNET.aspx?display=Print)找到的一些代码来执行模拟。

基本上，它调用返回安全令牌的本机 LogonUser 方法，然后创建一个新的 WindowsIdentity 传递令牌，最后调用 windowsIdentity.Impersonate() 方法。执行上述逻辑时没有异常。

调用 WindowsIdentity.GetCurrent() -> 返回模拟身份。

写入 UNC 路径 -> UnauthorizedAccess 异常。

因此，我在尝试编写文件之前检查了 Thread.CurrentPrincipal 对象，它有一个 GenericPrincipal，而不是具有模拟 WindowsIdentity 的 WindowsPrincipal。

因此，在应用程序启动时，我将 AppDomain.CurrentAppDomain.SetPrincipalPolicy 设置为 PrincipalPolicy.Impersonate。

我重新启动我的应用程序...

在我调用模拟之前，我可以在 Thread.CurrentPrincipal 上看到我自己的凭据，这些凭据是我用来登录我的开发机器并正在执行我的 WPF 程序的。

我再次尝试运行模拟逻辑，再次在 WindowsIdentity.GetCurrent 上看到模拟身份，一切似乎都很好，没有例外

但是，在 Thread.GetCurrentPrincipal 上，我仍然可以看到自己的凭据，如果查看 AuthenticationType 属性，则会出现 UnauthorizedException（仅在调试器中可见，不会在应用程序中抛出！！）。我让代码运行。

同样，UnauthorizedAccess 在尝试将我的文件写入 UNC 位置时。

我尝试的最后一件事是使用 WindowsIdentity.GetCurrent() 创建一个新的 WindowsPrincipal，并在 Thread.Current 上显式设置它，但结果相同。

UnauthorizedAccess 写入 UNC 位置时。

我没有想法:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T07:24:12.503

具有网络共享的机器是否在域中？您是否尝试使用该域帐户访问网络共享？例如使用“运行方式...”。

在 LogonUser 函数中，在登录时尝试使用 LOGON32_LOGON_NETWORK 标志。还要查看是否确实发生了模拟，请尝试从安全策略（[信息链接](http://support.microsoft.com/default.aspx/kb/556015)）中启用对登录/注销事件的审核

# c# - 很有趣，这可能是堆栈溢出问题

> ID：848490
> 
> 赞同：1
> 
> 时间：2009-05-11T14:52:38.993
> 
> 标签：c#, list, big-o, micro-optimization

以下过程（解释如下）适用于非常小的列表，但是当列表包含大量项目（1/2 百万）时，应用程序进入“无响应”状态，大约需要 2.5 分钟才能完成（非常糟糕时间）。我可能会添加应用程序需要处理至少 1 亿个项目的列表（最终）。

这是有问题的过程的代码：

```
 public void removeItems(List<long> L, SortedList<long, List<long>> _subLists)
    {
        foreach (KeyValuePair<long, List<long>> kvp in _subLists)
        {
            foreach (long duplicate in kvp.Value)
            {
                int j = L.IndexOf(duplicate);
                L.RemoveRange(j,(int)kvp.Key); 

            }
        }
    } 
```

L 是一个长值列表。_subLists 是一个排序列表，其中每个值都是来自 L 的值的列表，开始一些差异（不相关）的算术级数系列。与该值关联的键是值包含的系列的长度。

例子：

L = {1,2,3,5,6,7,18,20,21} _subLists = {2,<20>} {3,<1,5>}

该过程只是从 L 中删除算术级数系列。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T14:58:22.820

这个过程在大 O 表示法中的运行时间是 n^2，这是相当慢的，如果其中一个列表有 1 亿个条目，您可以预期运行时间会很慢。这里没有堆栈溢出问题，迭代这么多数据很慢。我真的没有在这里看到一个问题，你想让这个更快吗？如果是这样，嵌套的 for 循环肯定是问题所在。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T15:11:30.347

您的问题是您要从 L 中删除很多项目，这是一项非常昂贵的操作。每次删除项目时，都会复制内存以将已删除项目上方的所有项目向下移动。移除的项目越多，洗牌的项目越多，所需的时间就越长。内存是性能的瓶颈，RAM 的运行速度比 CPU 慢，如果你要分页到磁盘，它真的很慢。

你怎么能改善这一点。

最简单的选择是使用 L 的容器，它在删除项目时具有更好的性能 - 例如 LinkedList。当元素被删除时，LinkedLists 不需要在内存中移动项目，但它们确实需要更多的内存来存储数据（每个值两个指针）。如果这开销太大，那么可能会`LinkedList <List <long>>`改为每个都`List <long>`包含最大数量的值。

或者，更改删除算法，以便遍历列表 L 并创建一个包含 _subLists 中未找到的值的新列表。您可以更改 _subLists 存储数据的方式，以更快地查找范围内的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T15:59:45.853

如果可能的话：

A) 将 L 转换为有序链表。O：n * log（n）

B）将子列表转换为排序列表对，其中第一项是 L 中序列中的 #（在发布的代码片段中重复），第二项是序列的长度。O: n * log (n)

C) 使用子列表在 L 中执行一次遍历，以确定在 L 中的给定位置要删除多少元素。利用两个列表都已排序以在任一列表中不回溯的事实。上

如果可以使用，应该能够从中获得 O: n * log(n) 复杂性。当然，我不是 100% 确定问题的所有细节。例如 - L 可以重复吗？如果是这样，子列表的顺序是否重要？您可能会被迫放弃或修改这种算法，具体取决于这些 ?s 的答案。此外，这显然会使用更多内存。

# python - 在 Blender 脚本中测量路径长度？

> ID：848499
> 
> 赞同：0
> 
> 时间：2009-05-11T14:53:59.040
> 
> 标签：python, blender

在 Blender (v2.48) 中，如何从 Python 脚本中确定路径的长度（以 Blender 为单位）？

该值可从 GUI 获得：选择路径后，“编辑”面板包含一个*PrintLen*按钮。按下按钮时，长度显示在右侧。

如何从 Blender 中运行的 Python 脚本以编程方式获取此值？

注意：我对以帧为单位的*PathLen*值不感兴趣，而不是 Blender 单位。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-04T21:25:10.627

我发现的最好的想法是从路径创建一个网格并对段（边）的长度求和。

```
import Blender

def get_length(path):
    """
    Return the length (in Blender distance units) of the path.
    """
    mesh = Blender.Mesh.New()
    mesh.getFromObject(path)

    return sum(edge.length for edge in mesh.edges) 
```

# telerik - Telerik RadScriptManager - 组合 js 文件时出错

> ID：848503
> 
> 赞同：0
> 
> 时间：2009-05-11T14:55:06.353
> 
> 标签：telerik

我正在尝试使用 Telerik 的脚本管理器组合多个 js 文件引用。这是我在页面加载时的代码：

```
 System.Web.UI.ScriptReference jsFile1 = new System.Web.UI.ScriptReference('/virtual_folder/jsfile1.js');
        System.Web.UI.ScriptReference jsFile2 = new System.Web.UI.ScriptReference('/virtual_folder/jsfile2.js');

        this.Master.ScriptManager.CompositeScript.Scripts.Add(jsFile1);
        this.Master.ScriptManager.CompositeScript.Scripts.Add(jsFile2); 
```

我收到一个错误：

[NullReferenceException：对象引用未设置为对象的实例。] System.Collections.ObjectModel.Collection`1.Add(T item) +18

Telerik.Web.UI.RadScriptManager.Page_PreRenderComplete(Object sender, EventArgs e) +95

System.EventHandler.Invoke（对象发送者，EventArgs e）+0

System.Web.UI.Page.OnPreRenderComplete(EventArgs e) +8695102

System.Web.UI.Page.ProcessRequestMain（布尔 includeStagesBeforeAsyncPoint，布尔 includeStagesAfterAsyncPoint）+1029

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-27T00:37:43.453

我认为脚本组合目前仅适用于嵌入式资源，因此您必须将 js 文件嵌入到 dll 中。

在旁注中，您知道可以使用

```
 this.Master.ScriptManager. 
```

尝试使用

```
 RadScriptManager.GetCurrent(this) 
```

我假设您是从 aspx 页面而不是 ascx 控件调用它，否则您必须使用 this.Page。

# python - Python M2Crypto EC 支持

> ID：848508
> 
> 赞同：2
> 
> 时间：2009-05-11T14:55:46.930
> 
> 标签：python, m2crypto

M2Crypto 为 ECDSA/ECDH 提供 EC 支持。我已经安装了包含对 EC 的支持的 OpenSSL 0.9.8i。但是，当我运行“从 M2Crypto 导入 EC，BIO”时，我收到错误消息说 EC_init() 失败。所以我添加了调试来打印 m2.OPENSSL_VERSION_TEXT 值。它被打印为“OpenSSL 0.9.7 2003 年 2 月 19 日”。此版本的 OpenSSL 不支持 EC。

我试过 "python setup.py build build_ext --openssl="new_path where OpenSSL 0.9.8i is installed"。虽然 M2Crypto 再次构建 "Python setup.py install" ，但我仍然看到它指向 "Old version of OpenSSL" .

任何关于如何成功让 M2Crypto 使用 0.9.8i 的指针都会很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-28T06:33:19.573

由于专利问题，一些 Linux 发行版（例如 Fedora 和 Redhat）禁用了 EC。

如果您自己构建 OpenSSL，除了 --openssl 之外，您可能还需要为 build_ext 指定一些选项：--library-dirs 和 --include-dirs。例如，参见 Chandler 中的 m2crypto [Makefile](http://svn.osafoundation.org/chandler/trunk/external/m2crypto/Makefile)。M2Crypto [FAQ](http://chandlerproject.org/Projects/MeTooCrypto#Code)对此也有答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:03:21.120

如果您将 new_path 添加到 /etc/ld.so.conf 的顶部，那么它可能会查找共享库 libssl.so 和 libcrypto.so 并在 /usr/lib 中找到旧的库，以便首先对其进行搜索。但这可能会破坏其他期待旧 OpenSSL 的 OpenSSL 应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-08-26T19:25:56.780

请在[https://gitlab.com/m2crypto/m2crypto/issues/new](https://gitlab.com/m2crypto/m2crypto/issues/new)和您的操作系统、Python 版本、系统上所有 OpenSSL 库的位置和版本、编译器版本提交问题报告，并附上**完整**的标准输出/stderr`python setup.py clean build install`命令。谢谢你。

# sql - 如何将#Temp 与 sql 表一起加入？

> ID：848509
> 
> 赞同：0
> 
> 时间：2009-05-11T14:55:50.953
> 
> 标签：sql, sql-server, sql-server-2005

我如何使用 scr_SecuristLog Time 加入（或联合）#Temp。请看【时间】栏目

```
 CREATE TABLE #Temp (VisitingCount int, [Time] int )

 DECLARE @DateNow DATETIME,@i int,@Time int
    set @DateNow='00:00'  
    set @i=1;  
    while(@i<48)  
        begin  
set @DateNow = DATEADD(minute, 30, @DateNow)
set @Time = (datepart(hour,@DateNow)*60+datepart(minute,@DateNow))/30 
insert into #Temp(VisitingCount,[Time]) values(0,@Time )
set @i=@i+1
end 
```

* * *

```
 select Count(Page) as VisitingCount,[Time]      
from     
( SELECT Page,Date,[user],      
        (datepart(hour,Date)*60+datepart(minute,Date))/30 as [Time]        
        FROM scr_SecuristLog      
) scr_SecuristLog      
where      
        Date between '2009-05-04' and '2009-05-05'    

group by [Time]  order by [Time]  asc        
return 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T15:07:57.047

编辑：将 GROUP BY 子句添加到内部查询并将表别名添加到 SELECT 语句

以下是您的连接语法可能如下所示：

```
CREATE TABLE #Temp (VisitingCount int, [Time] int )
--
--
-- Insert logic here
--
--
select t.VisitingCount, t.[Time]
from #Temp as t
inner join (
    select count(page) as VisitingCount, (datepart(hour,Date)*60+datepart(minute,Date))/10 as [Time]
    from scr_SecuristLog
    where Date between '2009-05-04' and '2009-05-05'
    group by Date
) as s
    on t.VisitingCount = s.VisitingCount
        and t.Time = s.Time 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T15:16:08.983

由于您使用的是 SQL 2005，因此您可能希望使用公共表表达式而不是临时表：

```
DECLARE
    @date_start DATETIME,
    @date_end DATETIME

SET @date_start = '2009-05-04'
SET @date_end = '2009-05-04'

;WITH Times (start_time, end_time) AS
(
    SELECT
        @date_start AS start_time,
        @date_start AS end_time
    UNION ALL
    SELECT
        DATEADD(mi, 30, start_time) AS start_time,
        DATEADD(mi, 30, end_time) AS end_time
    FROM
        Times
    WHERE
        end_time <= DATEADD(dy, 1, @date_end)
)
SELECT
    start_time,
    end_time,
    COUNT(*)
FROM
    Times T
INNER JOIN dbo.scr_SecuristLog SL ON
    SL.date >= T.start_time AND
    SL.date < T.end_time
GROUP BY
    start_time,
    end_time 
```

# css - 使用 Tapestry jwcid 属性和 @Block 组件进行 CSS 分类？

> ID：848510
> 
> 赞同：1
> 
> 时间：2009-05-11T14:55:51.780
> 
> 标签：css, tapestry

Block 组件如何处理 CSS 类？我有这样的代码：

```
<style type="text/css">
  .nameColumnHeader { width: 30%; }
  .nameColumnValue { width: 30%; vertical-align:top; }
</style>
...
<table>
  <tr>
    <th><span jwcid="nameColumnHeader@Block">...</span></th>
    <th><span jwcid="nameColumnValue@Block">...</span</th>
  </tr>
...
</table> 
```

最终，这似乎奏效了。即使未指定类属性，样式似乎也已应用。

为什么这行得通？指定类属性（在可维护性方面）不是更好的形式吗？然而，在这一点上，这种代码遍布整个应用程序，是否值得“修复”它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-26T21:56:21.173

您可能正在使用 contrib:Table 组件 - 默认情况下，它将类应用于它并生成（或者可能在 中，检查生成的标记）。

这些类的值是从每个列名生成的，因此对于“电话”列，它们应该是：phoneColumnHeader 和 phoneColumnValue... 碰巧你有一个类似命名的 jwcid (nameColumnHeader)，这增加了混乱。

# php - PDF 的无损合并 (PHP)

> ID：848513
> 
> 赞同：1
> 
> 时间：2009-05-11T14:56:39.470
> 
> 标签：php, pdf, merge, imagemagick

目前我正在使用[ImageMagick](http://en.wikipedia.org/wiki/ImageMagick)在我的 Linux 系统上的 PHP 脚本中将多个 PDF 合并为一个。但是，生成的 PDF 质量非常低。我偶然发现了合并后质量更好的[pdftk](http://en.wikipedia.org/wiki/Pdftk)，但如果可能，我需要使用 ImageMagick，因为我需要让脚本在另一台没有 pdftk 的服务器上运行（这会很痛苦它在那里）。

如何使用 ImageMagick 和 PHP 以无损质量合并 PDF？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T22:33:05.773

ImageMagick 无法进行无损 PDF 合并。如果你有一台 Linux 服务器，你可以试试 pdfconcat （无损合并非常快）：

```
$ wget -O pdfconcat http://www.math.bme.hu/~pts/cvsget.cgi/u=bin.i386/p=/M=bin.i386/c=f1/n=/bin.i386/pdfconcat
$ chmod +x pdfconcat
$ ./pdfconcat -o output.pdf input1.pdf input2.pdf input3.pdf 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T11:55:03.370

我的[CAM::PDF Perl 库包含一个名为](http://search.cpan.org/dist/CAM-PDF/)[appendpdf.pl](http://search.cpan.org/perldoc?appendpdf.pl)的灵活命令行工具，它可以将 PDF 的任意页面混合到另一个文档中。

# algorithm - 生成软件堆栈图的算法

> ID：848515
> 
> 赞同：2
> 
> 时间：2009-05-11T14:57:16.550
> 
> 标签：algorithm, diagram

我正在寻找一种算法的想法，该算法生成类似于以下的图表，给定一组非循环依赖项（我正在使用此图像来显示依赖项可能很复杂）

[![替代文字](https://i.stack.imgur.com/x6aSq.gif)](https://i.stack.imgur.com/x6aSq.gif)
[（来源：[interactivetvweb.org](http://www.interactivetvweb.org/images/tutorials/mhp/mhp_software_stack.gif)）]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T15:15:10.450

制作这样的图表并不总是可能的。（非循环）依赖关系：

> A 取决于 X、Y、Z
> 
> B 取决于 X、Y、Z
> 
> C 取决于 X、Y、Z

描述了六个顶点上的完整二部图，它[是非平面的](http://en.wikipedia.org/wiki/Planar_graph)。对于您显示的图表类型，这样做的结果是图表中的至少一个区域必须分成两个单独的部分，和/或至少一个区域不能直接连接到其依赖项。

这个问题可以通过基于图形的可视化（例如[graphvis](http://www.graphviz.org/)）避免，其中边可以相互交叉。

生成您正在寻找的图表的启发式算法的大纲如下：

1.  解析依赖树以计算每个项目的“级别”。在我上面给出的示例中，X、Y 和 Z 将在此图中在级别 1 中分别出现 3 次，作为 A、B 和 C 中的每一个的子级（在级别 0）
2.  以明显的方式绘制树，每个“级别”的项目在同一水平级别，它们的祖先/子项分别位于它们的下方/上方。可以选择在每个级别放置项目的顺序。
3.  根据单个项目在图表上拆分为多个区域的次数，计算图表的好坏程度。如果物品的排序良好，并且代表同一物品的两个或多个区域相互接触，则可以将它们融合在一起。
4.  使用此度量来优化同一级别的项目的排列，使用组合优化算法，例如[Metropolis 算法](http://en.wikipedia.org/wiki/Metropolis_algorithm)。

这不会每次都产生最好的图表（如果这样的概念甚至是明确定义的......）但应该为像你的例子这样的问题做一个合理的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T15:01:02.283

虽然不是一种算法（这是您所要求的），但您可能需要查看 NDepend，它执行类似的分析并生成与您所追求的类似的图表：

[http://ndepend.com/](http://ndepend.com/)

（我与 NDepend 没有任何关系）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-13T07:46:16.023

[STAN4J](http://stan4j.com/)从 java 代码生成这种图表。

# java - Java 发布工程良好实践

> ID：848521
> 
> 赞同：5
> 
> 时间：2009-05-11T14:57:58.920
> 
> 标签：java, open-source

我正在开始一个相当简单的开源 Java 项目。这个过程对我来说是新的，我习惯于为自己编写程序。在 Java 中发布开源项目时需要注意哪些好的做法？

这里有一些我能想到的，你能推荐其他的吗？

*   版本控制存储库（你用什么来解释相关的标签/分支？一个外部 README 文件？）
*   在代码中包含适当[的开源许可证](http://www.opensource.org/licenses/category)
*   包含预打包的可执行 JAR 文件，在文件名中包含版本号
*   某种 README 文件，解释构建/运行软件所需的外部依赖项（对于什么文件名和放置位置是否有通用约定？）
*   项目的网页，在源代码和/或可执行文件中包含指向它的链接，以防有人首先获得源代码或可执行文件（而不是通过相关网页）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:01:12.033

您绝对应该做的一件事（因为它是 Java）是为您的代码生成 Javadocs。这意味着使用 Javadoc 表示法对类和方法进行注释，以便其他人更容易阅读。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T15:07:40.150

你也可以使用[Maven](http://maven.apache.org/)来发布你的代码。有了它，为您的项目创建站点、指定依赖项、优化发布非常容易……例如，Apache 的 Commons 项目使用 Maven。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T20:24:51.740

基本上，您希望您的项目“开箱即用”。当人们为一项任务选择正确的开源项目时，他们会下载一堆声称支持该任务的项目，并使用最好的项目。如果一个项目需要大量工作来设置（例如，从 20 个不同的站点下载 20 个 JAR 依赖项），大多数人只会将其作为最后的手段尝试或忽略它。

**存储库**：您可能会尝试一些更新的存储库引擎，例如[Mercurial](http://www.selenic.com/mercurial/wiki/)或[Git](http://git-scm.com/)。它们简化了开发并简化了分支的合并。但重要的是，*选择一个您的 IDE 原生支持的引擎。*

**依赖关系**：你应该使用*自述*文件来声明依赖关系，但这还不够，要么使用[Maven](http://maven.apache.org/)来管理依赖关系，在这种情况下你只需要包含`pom.xml`文件，或者在你的发行版中包含你依赖的 JAR。在第二种情况下，将依赖项分为`mandatory`、和。可选依赖项的一个示例是 Hibernate 的字节码生成工具。`optional``compiletime``test`

**站点**：Maven 可能会[创建一个](http://maven.apache.org/plugins/maven-site-plugin/)与您的软件的特定版本相关联的站点（尽管从未使用过）。

**文档 - JavaDoc**：记录所有内容，并尝试执行确保高质量 javadocs 的策略：

```
 /**
  * Sets the cost
  * @param decimal cost 
  */
 public void setCost(BigDecimal decimal){ 
```

没用。更好的是：

```
 /**
  * Sets the cost, cost is in currency setted by #setCurrency. 
  * @param decimal cost, precision shoule be at least three places
  */
 public void setCost(BigDecimal decimal){ 
```

**文档**：Javadoc 是不够的。给出一些起点 - 最好有一个教程（我不是指那种有很多 Eclipse 对话框截图的教程；））。示例代码也可以，或者至少写在某个地方——“阅读`EntryPoint`类的 javadoc 是开始使用这个库的好方法”。如果您只有 javadocs，任何正在考虑使用您的库的人都将看到所有类和包的列表，并且不知道从哪里开始。

**错误跟踪软件**：您一次不会记住三个以上的错误（并且会忘记事情） - 它还可以帮助您管理任务和新的想要的功能。您可能想尝试：

*   [FogBugz](http://www.fogcreek.com/FogBUGZ/) - 很好，但要花钱。（最多两名开发人员免费）。
*   [Bugzilla](http://www.bugzilla.org/) - 不错，受欢迎且免费

**项目管理软件**：这将帮助您计算发布日期、开发人员之间的拆分任务等。

*   [dotProject](http://www.dotproject.net/) - 免费且可以。
*   [FogBugz](http://www.fogcreek.com/FogBUGZ/) - 再次工作得很好。

**尝试通过[乔尔测试](http://www.joelonsoftware.com/articles/fog0000000043.html)**

**构建过程**：使构建成为一键式过程。例如，增加版本号、启动 maven 构建、部署站点等的 ant 脚本。值得努力！

**论坛**：一个好主意，将有助于支持。

**Wiki**：在许多（甚至是相当发达的）项目中，这样的 wiki 相当空洞，这很糟糕（因为它让人们认为“如果没有人在这个 wiki 上写，这怎么能成为伟大的软件”）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T15:02:08.150

1.  计划开发某种类型的网站。如果您的代码涉及 Web 软件，那么如果您将其用作网站的一部分，人们真的会惊叹不已。

2.  开发人员喜欢好的文档和大量的示例。我见过有很多强大的代码但 0% 文档的项目很难做到。

3.  拥有一个 wiki 设置来让人们编写想法和食谱是一个明确的优势。（我推荐媒体维基）。

4.  发布想法的论坛，讨论线程，即社区论坛也很好。

5.  设置一个邮件列表并鼓励人们加入。

6.  将真实的更新发布到您的邮件列表、wiki 站点，并作为新闻发布在您的主站点上，以表明您确实在处理事情。鼓励参与。让自己可用。这一切都会产生一种感觉，即您对参与其中很感兴趣，并且您愿意接受他人的意见。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-19T23:39:58.880

我知道已经提到了 Maven，但我认为比使用 Maven 更重要的是将工件发布到 Maven 存储库，以便使用 Maven 的项目可以使用它们。然后，您的项目页面也可以提供指向存储库的直接链接，因此它也可以作为可下载文件的存储空间。

另外：以类似的方式，制作 jars OSGi 捆绑包——这只是意味着添加一些 Manifest 条目，没有什么很复杂的——是另一件好事。

这两者都可以帮助其他人更轻松地将依赖项添加到您的包中（如果适用），并有助于采用。

还有一些需要考虑的事情：

*   合理的版本号方案（用于不兼容更改的主要版本；用于向后兼容添加的次要版本；或类似的东西）
*   保持良好的发行说明
*   使用错误跟踪系统，如果您可以轻松使用（Codehaus、dev.java.net、SourceForce 等都提供此功能）
*   用于文档的简单项目 Wiki
*   讨论邮件列表

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T15:07:37.763

我建议使用 MAVEN 作为管理构建/运行所需的外部依赖项的工具

您也可以使用 Vulcan 或类似工具进行持续集成，因此知道当前版本是否真的有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T15:00:15.577

从签入评论生成变更日志。单独创建一个发布说明，解释您在每个版本中修复/添加的内容。

# .net - 对 SelectList 的字典？

> ID：848525
> 
> 赞同：26
> 
> 时间：2009-05-11T14:59:01.900
> 
> 标签：.net, asp.net-mvc

我有一个 IDictionary，现在我想在选择列表中使用这些值。我该怎么做呢？

谢谢。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-05-11T15:51:22.060

只需设置`"Value"`and和。您可以在视图本身或从您的操作中执行此操作（尚未测试下面的代码）。`"Key"``dataValueField``dataTextField`

```
var targets = new Dictionary<string, string>();
目标.Add("键", "值");

ViewData["MyList"] = new SelectList(targets, "Key", "Value");

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T15:08:18.307

好吧，[`IDictionary`](http://msdn.microsoft.com/en-us/library/system.collections.idictionary(VS.71).aspx)继承自`IEnumerable`所以你应该能够将该字典传递给[`SelectList`](http://msdn.microsoft.com/en-us/library/system.web.mvc.selectlist.selectlist.aspx).

# jquery - JQuery 转义 HTML 以进行预览

> ID：848527
> 
> 赞同：1
> 
> 时间：2009-05-11T14:59:47.357
> 
> 标签：jquery, html, encoding

我只使用有序列表在 JQuery 中制作了一个非常简单的预览窗口。我担心用户会输入 < 或 > 并不小心弄乱页面的代码或执行某种 XSS。如何使用 Javascript 编码特殊字符来处理这种情况？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T15:06:04.427

如果你使用

```
$(yourselector).text("<h1>Your text String</h1>"); 
```

然后 jQuery 将显示包含特殊字符的实际文本。如果你使用

```
$(yourselector).html("<h1>Your text String</h1>"); 
```

那么 HTML 特殊字符将在显示时被解释。

我在这里假设您想要显示用户在列表标签​​之间输入的文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T15:37:41.507

您还可以将元素[.wrap](http://docs.jquery.com/Manipulation/wrap)到[`<pre>`](http://www.w3schools.com/TAGS/tag_pre.asp)标签中。

```
$("#selector").wrap("<pre></pre>"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-28T23:34:23.660

如果要将转义值存储在变量中，而不是将其呈现到页面，您也可以尝试：

```
$('<div></div>').text(str).html() 
```

# java - Saxon 8（Java版）问题

> ID：848535
> 
> 赞同：2
> 
> 时间：2009-05-11T15:01:13.097
> 
> 标签：java, xml, sax, saxon

我现在要指出，我是使用 saxon 的新手，我已经尝试按照包中的文档和示例进行操作，但我只是没有运气解决这个问题。

基本上，我正在尝试使用 saxon v8 在 java 中进行一些 xml 处理。为了让某些东西正常工作，我采用了包中包含的一个示例文件并根据我的需要进行了修改。只要我不使用名称空间，它就可以工作，这是我的问题。如何解决命名空间问题？我真的不在乎使用它，但它存在于我的 xml 中，所以我要么必须使用它，要么忽略它。任何一种解决方案都很好。

无论如何，这是我的入门代码。它什么也不做，只是进行一个 xpath 查询尝试将它用于硬编码的 xml 文档。

```
public static void main(String[] args) {
    String query = args[0];

    File XMLStream=null;
    String xmlFileName="doc.xml";
    OutputStream destStream=System.out;
    XQueryExpression exp=null;
    Configuration C=new Configuration();
    C.setSchemaValidation(false);
    C.setValidation(false);

    StaticQueryContext SQC=new StaticQueryContext(C);
    DynamicQueryContext DQC=new DynamicQueryContext(C);      
    QueryProcessor processor = new QueryProcessor(SQC);
    Properties props=new Properties();
    try{   
        exp=processor.compileQuery(query);
        XMLStream=new File(xmlFileName);
        InputSource XMLSource=new InputSource(XMLStream.toURI().toString());
        SAXSource SAXs=new SAXSource(XMLSource); 
        DocumentInfo DI=SQC.buildDocument(SAXs);
        DQC.setContextNode(DI);

        SequenceIterator iter = exp.iterator(DQC);
        while(true){
            Item i = iter.next();
            if(i != null){
                System.out.println(i.getStringValue());
            }
            else break;
        }
    }
    catch (Exception e){
        System.err.println(e.getMessage());
    }
} 
```

一个示例 XML 文件在这里...

```
<?xml version="1.0"?>
<ns1:animal xmlns:ns1="http://my.catservice.org/">
    <cat>
        <catId>8889</catId>
        <fedStatus>true</fedStatus>
    </cat>
</ns1:animal> 
```

如果我使用包含命名空间的查询运行它，我会收到错误消息。例如： `/ns1:animal/cat/`给出错误：“Prefix ns1 has not been declared”。

如果我从查询中删除 ns1: ，它什么也没给我。如果我修改 xml 以删除“动物”前面的“ns1：”，我可以`/animal/cat/`成功运行查询。

任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T19:05:29.857

错误消息正确指出您的 xpath 表达式未指示名称空间前缀“ns1”的含义（绑定到）。仅仅因为要操作的文档碰巧使用了“ns1”的绑定并不意味着它就是应该使用的：这是因为在 XML 中，重要的是命名空间 URI，而前缀只是对真实事物的方便快捷方式。

那么：你如何定义绑定？有2种通用方式；要么提供可以解析前缀的上下文，要么在 XPath 表达式中嵌入实际的 URI。

关于第一种方法，来自 Saxon 作者的[这封电子邮件](http://markmail.org/message/5jsx6ct54qxjbebm)提到了 JAXP 方法 XPath.setNamespaceContext()，同样，[Jaxen XPath 处理器常见问题解答](http://jaxen.codehaus.org/faq.html)中有一些示例代码可以提供帮助。这不是很方便，因为您必须实现 NamespaceContext，但是一旦您有了实现你会被设置的。

所以符号方法......让我们看看：[Top Ten Tips to Using XPath and XPointer](http://www.xml.com/pub/a/2002/08/14/xpath_tips.html?page=4)展示了这个例子：

匹配使用命名空间声明的元素，例如：

xmlns:book="http://my.example.org/namespaces/book"

您使用 XPath 名称，例如：

{ [http://my.example.org/namespaces/book](http://my.example.org/namespaces/book) } 部分

希望撒克逊人（或贾克森人）能理解这一点。

最后，如果您在使用上述解决方案之一时遇到任何问题，我建议您尽可能升级到 Saxon9。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-23T19:24:37.647

如果您想开箱即用，可以查看[embedding-xquery-in-java](http://rrusin.blogspot.com/2010/01/embedding-xquery-in-java.html)。有一个 github 项目，它使用 Saxon 来评估一些示例 XQuery 表达式。

问候

# batch-file - 如何使用批处理文件将文件复制到目录中的“最新子目录”？

> ID：848536
> 
> 赞同：1
> 
> 时间：2009-05-11T15:01:31.630
> 
> 标签：batch-file, dos

我需要将文件从最近的构建文件夹复制到另一个用于测试的文件夹。我很难获得最新构建文件夹的名称。

我目前的尝试是这样的：

```
@for /D %%i in ('dir e:\builds\projectA\* /O:D') do set target=%%i
echo %target%
xcopy "%target%\*.*" \\devbox\projectA /y /s 
```

我希望目标是新创建的文件夹，然后我可以从中复制文件。但是，当我将目标回显到控制台时，它只会说：

```
/O:D' 
```

有谁知道我怎样才能让它工作（或知道替代方案）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T15:16:41.383

将 /D 替换为 /F 并将 /B 添加到括号中的 dir 命令。

```
@for /F %%i in ('dir e:\builds\projectA\* /O:D /B') do set target=%%i
echo %target%
xcopy "%target%\*.*" \\devbox\projectA /y /s 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T15:15:38.343

```
pushd E:\builds\projectA
for /f "delims=" %%d in ('dir /b /a:d /o:d') do @echo %%d>latest.txt
for /f "delims=" %%l in (latest.txt) do xcopy "%%l\*.*" \\devbox\projectA /y /s
del latest.txt
popd 
```

# python - 使用固定宽度行写入/解析文本文件

> ID：848537
> 
> 赞同：14
> 
> 时间：2009-05-11T15:01:36.947
> 
> 标签：python, parsing, edi

我是 Python 的新手，我正在考虑使用它来编写我们的供应商需要的一些复杂的 EDI 内容。

基本上，他们需要一个 80 个字符的固定宽度文本文件，其中包含带有数据的字段的某些“块”，而其他的则留空。我有文档，所以我知道每个“块”的长度是多少。我得到的响应更容易解析，因为它已经有数据，我可以使用 Python 的“切片”来提取我需要的内容，但我不能分配给切片 - 我已经尝试过了，因为它听起来不错解决方案，它不起作用，因为 Python 字符串是不可变的:)

就像我说的那样，我真的是 Python 的新手，但我对学习它感到很兴奋 :) 我该怎么做呢？理想情况下，我希望能够说范围 10-20 等于“Foo”，并使其成为带有 7 个额外空白字符的字符串“Foo”（假设所述字段的长度为 10）并且具有较大的 80 个字符字段的一部分，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-11T15:32:37.613

您不需要分配给切片，只需使用[`% formatting`](http://docs.python.org/library/stdtypes.html#string-formatting-operations).

具有 3 个数据项的固定格式的示例：

```
>>> fmt="%4s%10s%10s"
>>> fmt % (1,"ONE",2)
'   1       ONE         2'
>>> 
```

同样，数据提供的字段宽度：

```
>>> fmt2 = "%*s%*s%*s"
>>> fmt2 % (4,1, 10,"ONE", 10,2)
'   1       ONE         2'
>>> 
```

分离数据和字段宽度，以及使用`zip()`和`str.join()`技巧：

```
>>> widths=(4,10,10)
>>> items=(1,"ONE",2)
>>> "".join("%*s" % i for i in zip(widths, items))
'   1       ONE         2'
>>> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-11T15:32:45.633

希望我能理解你在寻找什么：通过一个简单的变量方便地识别行的每一部分，但输出它填充到正确的宽度？

下面的片段可能会给你你想要的

```
class FixWidthFieldLine(object):

    fields = (('foo', 10),
              ('bar', 30),
              ('ooga', 30),
              ('booga', 10))

    def __init__(self):
        self.foo = ''
        self.bar = ''
        self.ooga = ''
        self.booga = ''

    def __str__(self):
        return ''.join([getattr(self, field_name).ljust(width) 
                        for field_name, width in self.fields])

f = FixWidthFieldLine()
f.foo = 'hi'
f.bar = 'joe'
f.ooga = 'howya'
f.booga = 'doin?'

print f 
```

这产生：

```
hi        joe                           howya                         doing 
```

它通过存储一个类级变量来工作，`fields`该变量记录每个字段在输出中出现的顺序，以及该字段应该具有的列数。中有相应命名的实例变量，`__init__`最初设置为空字符串。

该`__str__`方法将这些值作为字符串输出。它对类级`fields`属性使用列表推导，按名称查找每个字段的实例值，然后根据列左对齐输出。然后将生成的字段列表通过一个空字符串连接在一起。

请注意，这不会解析输入，尽管您可以轻松地重写构造函数以获取字符串并根据`fields`. 它也不检查长于分配宽度的实例值。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-11T15:37:43.440

您可以使用[justify](http://docs.python.org/library/string.html#string.ljust)函数在给定宽度的字段中左对齐、右对齐和居中字符串。

```
'hi'.ljust(10) -> 'hi        ' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-28T16:47:25.037

我使用了 Jarret Hardie 的示例并稍作修改。这允许选择文本对齐类型（左、右或居中。）

```
class FixedWidthFieldLine(object):
    def __init__(self, fields, justify = 'L'):
        """ Returns line from list containing tuples of field values and lengths. Accepts
            justification parameter.
            FixedWidthFieldLine(fields[, justify])

            fields = [(value, fieldLenght)[, ...]]
        """
        self.fields = fields

        if (justify in ('L','C','R')):
            self.justify = justify
        else:
            self.justify = 'L'

    def __str__(self):
        if(self.justify == 'L'):
            return ''.join([field[0].ljust(field[1]) for field in self.fields])
        elif(self.justify == 'R'):
            return ''.join([field[0].rjust(field[1]) for field in self.fields])
        elif(self.justify == 'C'):
            return ''.join([field[0].center(field[1]) for field in self.fields])

fieldTest = [('Alex', 10),
         ('Programmer', 20),
         ('Salem, OR', 15)]

f = FixedWidthFieldLine(fieldTest)
print f
f = FixedWidthFieldLine(fieldTest,'R')
print f 
```

回报：

```
Alex      Programmer          Salem, OR      
      Alex          Programmer      Salem, OR 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-02-13T21:32:51.780

我知道这个线程很老，但我们使用一个名为[django-copybook](https://github.com/imtapps/django-copybook)的库。它与 django 无关（不再）。我们使用它在固定宽度的 cobol 文件和 python 之间切换。您创建一个类来定义您的固定宽度记录布局，并且可以在键入的 python 对象和固定宽度文件之间轻松移动：

```
USAGE:
class Person(Record):
    first_name = fields.StringField(length=20)
    last_name = fields.StringField(length=30)
    siblings = fields.IntegerField(length=2)
    birth_date = fields.DateField(length=10, format="%Y-%m-%d")

>>> fixedwidth_record = 'Joe                 Smith                         031982-09-11'
>>> person = Person.from_record(fixedwidth_record)
>>> person.first_name
'Joe'
>>> person.last_name
'Smith'
>>> person.siblings
3
>>> person.birth_date
datetime.date(1982, 9, 11) 
```

它还可以处理类似于 Cobol 的 OCCURS 功能的情况，例如特定部分重复 X 次时

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T15:21:24.463

解析您的问题有点困难，但我收集到您正在接收文件或类似文件的对象，读取它，并用一些业务逻辑结果替换一些值。它是否正确？

克服字符串不变性的最简单方法是编写一个新字符串：

```
# Won't work:
test_string[3:6] = "foo"

# Will work:
test_string = test_string[:3] + "foo" + test_string[6:] 
```

话虽如此，听起来对你来说用这个字符串做一些事情很重要，但我不确定那是什么。您是将其写回输出文件，尝试就地编辑文件还是其他？我提出这一点是因为创建新字符串（恰好与旧字符串具有相同的变量名）的行为应该强调在转换后执行显式写入操作的必要性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T15:33:43.680

您可以将字符串转换为列表并进行切片操作。

```
>>> text = list("some text")
>>> text[0:4] = list("fine")
>>> text
['f', 'i', 'n', 'e', ' ', 't', 'e', 'x', 't']
>>> text[0:4] = list("all")
>>> text
['a', 'l', 'l', ' ', 't', 'e', 'x', 't']
>>> import string
>>> string.join(text, "")
'all text' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T15:34:17.563

编写函数来“修改”字符串很容易。

```
def change(string, start, end, what):
    length = end - start
    if len(what)<length: what = what + " "*(length-len(what))
    return string[0:start]+what[0:length]+string[end:] 
```

用法：

```
test_string = 'This is test string'

print test_string[5:7]  
# is
test_string = change(test_string, 5, 7, 'IS')
# This IS test string
test_string = change(test_string, 8, 12, 'X')
# This IS X    string
test_string = change(test_string, 8, 12, 'XXXXXXXXXXXX')
# This IS XXXX string 
```

# java - 有 com.l2fprod.common.propertysheet.PropertySheetPanel 来显示复合类

> ID：848538
> 
> 赞同：9
> 
> 时间：2009-05-11T15:01:56.400
> 
> 标签：java

为了有一个 Netbeans 喜欢的属性检查器窗口，我正在使用以下类来帮助我实现这一点。

com.l2fprod.common.propertysheet.PropertySheetPanel

到目前为止，它适用于具有简单属性的类，如 String、int...

但是，当涉及到具有复合关系的稍微复杂的类时，事情就变得更加复杂了。

例如，我有两只动物（界面）。一个是 Cat（带有名字和年龄的简单类）和 Dog（另一个带有名字和年龄的简单类）。

通过 GUI 窗口显示它们不费吹灰之力。

但是，来上课的时候是复合关系。一个可以包含多个动物的动物园（一个包含动物的数组列表的类），我无法在单个窗口中显示所有动物属性。

以下是截图

[![替代文字](https://i.stack.imgur.com/wMRHQ.png)](https://i.stack.imgur.com/wMRHQ.png)
[（来源：[googlepages.com](http://yancheng.cheok.googlepages.com/object-inspector.png)）]

部分源代码显示在这里

```
 ObjectInspectorJFrame objectInspectorJFrame0 = new ObjectInspectorJFrame(cat);
    objectInspectorJFrame0.setVisible(true);
    objectInspectorJFrame0.setState(java.awt.Frame.NORMAL);

    ObjectInspectorJFrame objectInspectorJFrame1 = new ObjectInspectorJFrame(dog);
    objectInspectorJFrame1.setVisible(true);
    objectInspectorJFrame1.setState(java.awt.Frame.NORMAL);

    // I wish to see all "animals" and their properties in this windows. :(
    // How?
    ObjectInspectorJFrame objectInspectorJFrame2 = new ObjectInspectorJFrame(zoo);
    objectInspectorJFrame2.setVisible(true);
    objectInspectorJFrame2.setState(java.awt.Frame.NORMAL); 
```

完整的源代码可以从这里下载

[http://yancheng.cheok.googlepages.com/sandbox.zip](http://yancheng.cheok.googlepages.com/sandbox.zip)

我希望在“动物园”窗口中，它可以显示所有动物的所有属性。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T16:55:45.183

PropertySheetPanel 仅填充其表以读取给定 Java Bean 的属性。

您需要扩展 PropertySheetPanel 行为并填充给定集合中的属性。迭代您的集合并使用 addProperty(Property) 填充表。

您还可以使用[自省](http://java.sun.com/docs/books/tutorial/javabeans/introspection/index.html)或[beanutils](http://commons.apache.org/beanutils/) lib 来发现集合元素。

编辑：添加示例。

```
package com.stackoverflow.swing.PropertySheetPanel;

import java.util.ArrayList;
import java.util.Collection;

import javax.swing.JFrame;
import javax.swing.SwingUtilities;

import com.l2fprod.common.propertysheet.DefaultProperty;
import com.l2fprod.common.propertysheet.PropertySheetPanel;

/**
 * An example that creates a l2fprod PropertySheetPanel that displays any
 * Collection.
 */
public class CollectionPropertySheet<C> extends PropertySheetPanel {

    // Choose some bean. An animal as example.
    static class Animal {
        private String name;
        private String family;

        public Animal(String name, String family) {
            this.name = name;
            this.family = family;
        }

        @Override public String toString() {
            return name + " " + family;
        }
    }

    /**
     * @param simpleModel The input collection as data model.
     */
    public CollectionPropertySheet(Collection<C> simpleModel) {
        super();
        populateCollectionProperties(simpleModel);
    }

    private void populateCollectionProperties(Collection<C> collection) {
        int index = 0;
        for (C entry : collection) {
            // Define property properties 
            DefaultProperty property = new DefaultProperty();
            property.setDisplayName(entry.getClass().getSimpleName() + "[" + index++ +"]");
            property.setValue(entry.toString());
            // Set any other properties ... 
            // and add.
            addProperty(property);
        }
    }

    // Start me here!
    public static void main(String[] args) {
        // Inside EDT
        SwingUtilities.invokeLater(new Runnable() {
            @Override public void run() {
                JFrame frame = new JFrame("A simple example...");
                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
                frame.add(new CollectionPropertySheet<Animal>(getAnimals()));
                frame.pack();
                frame.setVisible(true);
            }

            private Collection<Animal> getAnimals() {
                Collection<Animal> animals = new ArrayList<Animal>();
                animals.add(new Animal("Lion", "Felidae"));
                animals.add(new Animal("Duck", "Anatidae"));
                animals.add(new Animal("Cat", "Felidae"));
                return animals;
            }
        });
    }

} 
```

# .net-3.5 - 通过 Xml 文件创建动态路由

> ID：848543
> 
> 赞同：0
> 
> 时间：2009-05-11T15:03:22.967
> 
> 标签：.net-3.5, routing

我正在从 XML 文件中加载一组特殊的路由。

出于与我的应用程序先前版本的兼容性原因，必须在我的应用程序中创建这些死记硬背。最初，在 .net 1.1 中编写的第一个版本，我必须创建一些路由来完全支持新 URL 的“旧”URL。该应用程序已使用 .NET 3.5+MVC 完全重写。

我的问题是：某些旧 URL 无法从 XML 文件创建为路由，因为我无法指定“？” 特点。

说明我的问题的一个示例是：“executeSearch.aspx?search=ferrari”必须重定向到“/search/ferrari.htm”。

这些 Rotes 必须从该 XML 文件动态创建。

我的实际代码在 App_Start 中执行，读取 XML 文件并创建指向通用“重定向器”控制器的 rotes，该控制器仅使用 Response.Redirect 到目标 URL，指向 XML 文件。

好的，我的问题：有什么我可以做的，或者有什么方法可以动态地指定路由属性名称吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-26T19:21:31.373

[这几乎是我回答的另一个问题](https://stackoverflow.com/questions/1149750/)的抄本……

改为使用 IIS 重定向路由怎么样？

```
<rule name="Redirect Search" stopProcessing="true">
  <match url="^executeSearch.aspx?search=(.*)$" />
  <action type="Redirect" url="/search/{R:1}.htm" redirectType="Permanent" />
</rule> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-26T19:37:15.523

我刚刚阅读了一篇关于在数据库中存储路由的帖子。它可能会帮助您：

[ASP.NET MVC：在数据库中存储路由](http://www.iansuttle.com/blog/post/ASPNET-MVC-Store-Routes-in-the-Database.aspx)

# version-control - TFS TFS 是否仍需要 .vspcc 文件？

> ID：848547
> 
> 赞同：7
> 
> 时间：2009-05-11T15:04:27.160
> 
> 标签：version-control, tfs

我们正在使用 TFS，并且在切换分支时遇到问题，每次都会引发 TFS 绑定问题。

我们还有

.vspcc 文件 .vsscc 文件

我猜它在哪里存储绑定，有人对如何轻松地在 TFS 中的分支之间切换而没有痛苦有任何建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-27T19:28:08.463

这些文件用于存储从源代码管理中排除的文件 - 是的，它们本身处于源代码管理之下。我以前从来不用担心这些，所以我不认为这就是问题所在。

绑定通常存储在您的实际 proj 和 sln 文件中。

如果您在绑定方面遇到问题，那么您的工作区实际上存在一些问题。在新的本地文件夹中创建一个新的工作区，并从头开始从服务器获取所有内容（即通过 Visual Studio 设置工作区映射，通过源资源管理器打开您的解决方案等。不要在这里使用任何聪明的技巧 - 否则奇怪的事情发生了），或者尝试去文件 - > 源代码管理 - > 更改源代码控制，取消绑定所有项目并重新绑定它们。如果您这样做，VS 将盲目地将绑定信息重新写入您的项目和 sln 文件。

特别要确保您检查的所有服务器路径都可以映射到本地路径。

只需从相应的文件夹/分支打开相应的解决方案文件即可在分支之间进行切换。显然，这给您带来问题是不正常的。

# c# - 跨多个网络的文件的原子修改

> ID：848550
> 
> 赞同：0
> 
> 时间：2009-05-11T15:06:19.090
> 
> 标签：c#, file, atomic

我有一个应用程序正在修改 5 个相同的 xml 文件，每个文件都位于不同的网络共享上。我知道这是不必要的多余，但“必须如此”。

每次运行此应用程序时，都会添加/删除/修改一个元素（不多也不少）。

最初，应用程序打开每个 xml 文件，将元素添加/删除/修改到适当的节点并保存文件，如果不能，则抛出错误（无法访问网络共享，超时等...）

我如何使这个原子？

我最初的假设是：

```
foreach (var path in NetworkPaths)
    if (!File.Exists(path)
        isAtomic = false;

if (isAtomic)
{
    //Do things
} 
```

但我可以看到，仅此而已。有没有其他方法可以做到这一点，或者我可以指出一个方向？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:18:36.777

不幸的是，要真正做到“原子”是不可能的。我最好的建议是为此包装您自己的交易形式，这样您至少可以撤消更改。

我会做一些类似检查每个文件的事情 - 如果一个不存在，抛出。

备份每个文件，保存撤消所需的状态，或者如果它们不是很大，则将副本保存在内存中。做不到就扔。

进行编辑，然后保存文件。如果您在此处遇到故障，请尝试从每个备份中恢复。您需要在此处进行一些错误处理，以便在恢复所有备份之前不要抛出异常。恢复后，抛出异常。

至少通过这种方式，您更有可能不会只对单个文件进行更改。希望，如果您可以修改一个文件，您将能够从备份中恢复它/撤消您的修改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T15:25:59.417

我建议以下解决方案。

*   尝试使用写锁打开所有文件。
    *   如果一个或多个失败，则中止。
    *   修改并刷新所有文件。
        *   如果一个或多个失败，则将已修改的回滚并再次刷新。
*   关闭所有文件。

如果回滚失败......好吧......再试一次，再试一次，再试一次......并在不一致的状态下放弃。

如果您可以控制所有写入此文件的进程，则可以使用锁定文件实现简单的锁定机制。您甚至可以执行预写日志记录并在锁定文件中记录计划的更改。如果您的进程崩溃，下一个尝试修改文件的进程将检测到不完整的操作，并可以在进行一次修改之前继续它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-04T19:10:00.890

我将介绍文件的版本控制。您可以通过将后缀附加到文件名来轻松完成此操作。例如一个计数器变量。读者的过程如下：

*   准备下一个版本的文件
*   将其写入具有不同名称的临时文件。
*   获取最高版本号
*   将此版本加一
*   将临时文件重命名为新文件
*   删除旧文件（您可以保留其中的 2 个）

作为读者你做 - 找到最高版本的文件 - 阅读它

# c++ - 字符串->结构 CMap

> ID：848551
> 
> 赞同：5
> 
> 时间：2009-05-11T15:06:34.083
> 
> 标签：c++, visual-c++, mfc

我的要求是给定一个字符串作为地图的键，我应该能够检索一个结构。

任何人都可以为此发布示例代码吗？

前任：

```
struct
{
int a;
int b;
int c;
}struct_sample; 
```

string1 -> strcut_sample

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T15:13:29.330

```
CMap<CString,LPCTSTR, struct_sample,struct_sample> myMap;

struct_sample aTest;
aTest.a = 1;
aTest.b = 2;
aTest.c = 3;
myMap.SetAt("test",aTest);
...

    struct_sample aLookupTest;
    BOOL bExists = myMap.Lookup("test",aLookupTest); //Retrieves the 
                             //struct_sample corresponding to "test". 
```

来自[MDSN](http://msdn.microsoft.com/en-us/library/zshx6yzt(VS.80).aspx)的示例以获取 CMap 的更多详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T17:12:10.353

如果您愿意坚持MFC，请寻求aJ的答案。

否则，您最好使用标准库地图。一定要检查它的文档——有很多东西要学。我通常使用[http://www.sgi.com/tech/stl/table_of_contents.html](http://www.sgi.com/tech/stl/table_of_contents.html)。

```
#include <map>
#include <string>
#include <utility> // for make_pair

using namespace std;

int main() {
    std::map< string, struct_sample > myMap;
    const struct_sample aTest = { 1,2,3 };
    myMap.insert(make_pair( "test", aTest ) );
    myMap[ "test2" ] = aTest; // does a default construction of the mapped struct, first => little slower than the map::insert

    const map<string, struct_sample >::const_iterator aLookupTest = myMap.find( "test" );
    const bool bExists = aLookupTest != myMap.end();

    aLookupTest->second.a = 10;
    myMap[ "test" ].b = 20;

} 
```

注意：对模板使用 typedef 可能会使代码更具可读性。

# linq-to-sql - 如何使用 LINQ to SQL 在运行时提供表名？

> ID：848553
> 
> 赞同：1
> 
> 时间：2009-05-11T15:07:37.560
> 
> 标签：linq-to-sql, dynamic-linq

我必须使用 LINQ to SQL 以及纯 SQL 经典查询。这个 SQL 查询有我的数据将从中生成的表，但我以前不知道这个表。它将在编译时知道。

那么如何让 LINQ 从我想要查询的表中理解呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T16:12:29.733

很好的讨论：[动态 SQL 表名](http://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/6273d072-f500-4382-afb4-8eafd185794d)

# javascript - 解析 JSON 字符串的问题

> ID：848556
> 
> 赞同：2
> 
> 时间：2009-05-11T15:07:43.847
> 
> 标签：javascript, json

我有这个对象，我将其用作对象列表：

```
var objList = new Object(); 
```

然后使用 JSON 序列化对其进行序列化。如果没有添加对象或所有对象都已从列表中删除，并且空白 objList 被序列化，在 IE 中使用 JSON 解析器解析 objList，它偶尔会无法将 objList 评估为 JavaScript 对象。

这会导致在将对象添加到 objList 时出现 Object 不支持此属性或方法错误：

```
objList['idx']=objData; 
```

有谁知道为什么 IE 偶尔无法将 objList:{} 评估为一个对象并且让其他人遇到这个问题。

objList 为 '{}' 时的实际 JSON 字符串

objList 被初始化：

```
objList = g_objList.parseJSON(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T09:24:19.870

如果 json 字符串是 g_objList='{}'，那么您的序列化程序无法正常工作，我建议您执行类似...

```
objList = objList || {}; 
```

在使用 objList 之前。我猜你得到的是一个 g_objList 对象字符串而不是空的 objlist。评估/加载 json 之后的上述行应该可以解决问题。

本质上，它将 objList 设置为您现有的变量，或者创建一个新的空对象。

# wpf - XAML 样式有哪些级联或多样式功能？

> ID：848563
> 
> 赞同：2
> 
> 时间：2009-05-11T15:09:14.703
> 
> 标签：wpf, xaml, styles

我有一个带有“StackPanel 行”的 DockPanel。

**我需要每个 StackPanel 行都获得相同的样式，但是，第一个 StackPanel 行应该获得一个附加样式。**

在 CSS 中，我会使用 XAML 样式中似乎没有的级联功能来执行此操作。那么是否**可以有多种样式**，如下面的伪代码所示？在 XAML 样式中如何解决这个常见问题？

```
<Window x:Class="TestBinding99382.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:TestBinding99382"
    Title="Window1" Height="300" Width="300">

    <Window.Resources>
        <ObjectDataProvider x:Key="DataSourceCustomer" ObjectType="{x:Type local:Customer}" MethodName="GetCustomer"/>

        <Style x:Key="DataRowStyleFirst" TargetType="StackPanel">
            <Setter Property="Margin" Value="0 20 0 0"/>
        </Style>

        <Style x:Key="DataRowStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="Margin" Value="0 0 0 0"/>
            <Setter Property="DataContext" Value="{StaticResource DataSourceCustomer}"/>
            <Setter Property="DockPanel.Dock" Value="Top"/>
        </Style>

    </Window.Resources>

    <DockPanel>

        <!-- PSEUDO CODE -->
        <StackPanel Style="{StaticResource DataRowStyle,DataRowStyleFirst}">
            <TextBlock Text="First Name:"/>
            <TextBox Text="{Binding Path=FirstName}" Width="200" Margin="3 0 0 0"/>
        </StackPanel>

        <StackPanel Style="{StaticResource DataRowStyle}">
            <TextBlock Text="Last Name:"/>
            <TextBox Text="{Binding Path=LastName}" Width="200" Margin="3 0 0 0"/>
        </StackPanel>

    </DockPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T15:21:05.057

有一个样式[“BasedOn”](http://msdn.microsoft.com/en-us/library/system.windows.style.basedon.aspx)属性，它允许样式值的简单继承。

```
 <Style x:Key="DataRowStyleFirst" TargetType="StackPanel" BasedOn="{StaticResource DataRowStyle}">
        <Setter Property="Margin" Value="0 20 0 0"/>
    </Style>

...

    <StackPanel Style="{StaticResource DataRowStyleFirst}">
        <TextBlock Text="First Name:"/>
        <TextBox Text="{Binding Path=FirstName}" Width="200" Margin="3 0 0 0"/>
    </StackPanel>

    <StackPanel Style="{StaticResource DataRowStyle}">
        <TextBlock Text="Last Name:"/>
        <TextBox Text="{Binding Path=LastName}" Width="200" Margin="3 0 0 0"/>
    </StackPanel> 
```

# .net - 根据字符数自动调整列大小

> ID：848565
> 
> 赞同：0
> 
> 时间：2009-05-11T15:09:31.410
> 
> 标签：.net, vb.net, formatting, reportviewer

我试图找出在 ReportViewer 中以编程方式重新调整表列标题大小的最佳方法。

基本上，我目前的解决方案如下：

```
ColumnWidth = HeaderCaption_CharacterCount * 0.32 
```

其中 0.32 是使用我当前字体大小的典型字符的估计宽度。问题是宽度为较长的字幕留下了很多空白。标题的字符越多，我最终得到的空格就越多。

以这种方式估计的问题是并非所有字符的宽度都相同。一个很好的例子是“I”字符，它比字母表的其余部分占用更少的屏幕宽度。

有人可以提出更好的方法吗？

**编辑** 我找到了一种更好的方法来处理这个问题。有一种方法可以计算文本字符串的宽度（以像素为单位）。

```
Size = TextRenderer.MeasureText([String], [Font]) 
```

我目前正在尝试这个，它看起来很有希望。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-14T13:12:40.867

`Size = TextRenderer.MeasureText([String], [Font])`

函数计算具有指定字体的指定字符串的宽度。

# java - 是否有用于计算穆斯林祈祷时间的 Java 库？

> ID：848567
> 
> 赞同：41
> 
> 时间：2009-05-11T15:10:17.277
> 
> 标签：java, web-services

谁能告诉我在哪里可以找到基于城市计算穆斯林祈祷时间的 Java 库？也许是网络服务？我更喜欢Java库。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T15:19:46.167

[http://www.javafr.com/codes/PRAYER-ALERT-SALA_40601.aspx](http://www.javafr.com/codes/PRAYER-ALERT-SALA_40601.aspx)

你好，这不是图书馆，而是学生项目。但执行得相当好。

或：[http](http://www.directionsmag.com/article.php?article_id=2956) ://www.directionsmag.com/article.php?article_id= 2956 用谷歌地图+当地时间计算祈祷时间的方法（简而言之：检查你在哪里，检查你离麦加有多远，申请正确的公式）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-07-05T13:53:56.240

您可以使用 PrayTimes 库。

[http://praytimes.org/code/](http://praytimes.org/code/)

它最初是用 JavaScript 编写的，但也有其他语言的端口。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T15:17:55.517

我认为[Ubuntu 穆斯林版](http://www.sabily.org/website/)在日历中使用了这种类型的功能，也许你可以在那里搜索

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-10-08T06:07:06.667

Best is [https://github.com/abodehq/Pray-Times](https://github.com/abodehq/Pray-Times) for this question. It includes java, objective C,PHP, C#, javascript, python, c++ code implementation. It supports different methods and calculation is based gps position.Calculation Methods are Ithna Ashari,University of Islamic Sciences, Karachi, Islamic Society of North America (ISNA),Muslim World League (MWL),Umm al-Qura, Makkah,Egyptian General Authority of Survey,Institute of Geophysics, University of Tehran,Custom Setting. Juristic Methods are Shafii, Hanafi. Adjusting Methods for Higher Latitudes. Formats are 24-hour format/12-hour format/12-hour format with no suffix/floating point number.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-03T21:52:21.310

我认为这是[sourceforge.net上 ITL for Java 的输出端口](http://sourceforge.net/projects/jitl/)

# java - 在 Tomcat 集群中，如何在应用程序中共享 bean？

> ID：848568
> 
> 赞同：1
> 
> 时间：2009-05-11T15:10:56.010
> 
> 标签：java, tomcat, javabeans, cluster-computing

这听起来像是一个愚蠢或简单的问题，但我对任何类型的集群几乎没有经验，我只是好奇是否以及如何可能出现某种情况。

假设我已经建立了一个包含 N 个 Tomcat 实例的集群，并且我已经`App1`在所有 N 个实例上部署了我的应用程序。

我需要做些什么才能使应用程序中的某些 bean（不是全部，而是一些）在集群中“共享”？

即，如果我有一个 bean `WebsiteSettings`，我希望有一些查找过程，应用程序可以在其中请求 bean 并获得它的实例，并且对 bean 的属性/值的任何更新也可用于任何其他机器在集群中，即，`WebsiteSettings.getGreeting()`每当更新时，所有 N 台机器上都会返回相同的值。

我是否需要将这些 bean 设置为 MBean，并`App1`通过 JMX 查找它们？Tomcat 的集群支持是否会自动将 MBean 中的更改复制到集群中的所有节点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-25T10:56:30.817

请看一下[Terracotta](http://www.terracotta.org/) - 它允许您将相同的对象（以某种方式）驻留在许多实例上，其中其他节点的所有更新都是在 JVM 级别而不是在您的代码中无缝完成的。

你可能想看看这个以获得更多信息 -[什么是兵马俑](http://www.terracotta.org/web/display/orgsite/What+Is+Terracotta)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:12:08.000

一种选择是使用共享分布式缓存。有几个可用的可以轻松地为您提供此功能。

# browser - 从移动浏览器发送短信

> ID：848575
> 
> 赞同：10
> 
> 时间：2009-05-11T15:12:29.907
> 
> 标签：browser, sms

移动浏览器是否可以使用设备的内置功能发送短信？我的意思是，不使用某些在线 SMS 服务提供商，而是让移动设备发送 SMS（与使用 J2ME 相同）。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T15:43:10.013

那里有很多不同的移动浏览器，所以我怀疑这是标准化的。Safari/iPhone 支持[SMS URIs](http://www.iphonedevsdk.com/forum/iphone-sdk-development/4043-sms-api.html)，这让我觉得这是一种解决问题的明智方法，并且可能比 iPhone 更广泛地支持。

根据我找到的链接（上面）和 Zamel 的评论，我怀疑这会起作用：

```
<a href="sms:+447787000000">SMS</a> 
```

虽然有一个真实的电话号码，并且可能将 + 符号转义为 %2B。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-04T18:26:36.840

某些版本的 Opera Mini 浏览器[提供了一个 JavaScript 界面](http://dev.opera.com/articles/view/opera-mini-web-content-authoring-guidelines/#operamini-sms)，用于编写从用户手机发送的 SMS 消息。

此外，诺基亚的 Symbian 浏览器的某些版本包括具有类似功能[的 JavaScript 界面。](http://www.developer.nokia.com/Resources/Library/Web/web-apps/symbian-web-runtime/symbian-web-runtime-api-reference/platform-services-10-javascript-api-reference/platform-services-10-messaging-api/messaging-api-example.html#toc_messagingsamplejs)

可能还有其他人，但这是迄今为止我找到的仅有的两个文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T15:35:52.100

我认为 GSM 调制解调器能够充当 SMS 网关，但您必须在调制解调器上安装软件才能做到这一点。您也可以将[运营商网关](http://en.wikipedia.org/wiki/SMS_gateways)电子邮件发送至 SMS 作为另一种选择。示例是 AT&T 号码@txt.att.net

这些天出现了一些免费服务，例如您可能还想研究的[ZeepMobile 。](http://zeepmobile.com/)

你到底想完成什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T15:39:17.900

不，因为移动浏览器是专门为呈现标记 (html) 文档而构建的。因此，如果您想通过移动浏览器发送 SMS，它将调用 Web 服务器页面并从服务器而不是移动浏览器发送。

移动操作系统及其应用程序有很多限制。您将看到的最接近的是能够在移动浏览器中超链接电话# 以发送消息，但它将通过他们的 SMS 应用程序而不是浏览器来处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-02T18:24:12.443

这是不可能的 。您可以从浏览器调用设备功能。这就是解决问题的方法。Webkit 让你做到这一点

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-19T22:22:27.400

Android 和黑莓支持“mailto:”和“tel:”。

Android 支持“短信：”（也许还有 iPhone，我没有 :)）
祝你好运，请发布你的结果。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-11T15:43:36.677

这是一件不可能的好事。恕我直言，这将是一个相当大的安全风险。我想垃圾邮件发送者会到处都是。

# java - 为什么 maven-assembly-plugin 多次在我的 zip 中放置相同的依赖项？

> ID：848576
> 
> 赞同：3
> 
> 时间：2009-05-11T15:12:39.783
> 
> 标签：java, maven-2, build, maven-plugin

我整理了一个程序集描述符

```
<assembly>
<id>all</id>
<formats>
    <format>zip</format>
</formats>
<includeBaseDirectory>false</includeBaseDirectory>
<moduleSets>
    <moduleSet>
        <includes>
            <include>org.openscada.atlantis:org.openscada.atlantis.core.common</include>
            <include>org.openscada.atlantis:org.openscada.atlantis.net.base</include>
            <include>org.openscada.atlantis:org.openscada.atlantis.core.net.base</include>
            ... some more ...
            <include>org.openscada.atlantis:org.openscada.atlantis.spring.components</include>
        </includes>
        <binaries>
            <includeDependencies>true</includeDependencies>
            <outputDirectory>bin</outputDirectory>
            <unpack>false</unpack>
            <dependencySets>
                <dependencySet>
                    <outputDirectory>lib</outputDirectory>
                    <useTransitiveFiltering>true</useTransitiveFiltering>
                </dependencySet>
            </dependencySets>
        </binaries>
    </moduleSet>
</moduleSets>
</assembly> 
```

没什么特别的，但现在我的依赖项多次包含在 zip 文件中（完全相同的文件）。为什么会发生这种情况，我该如何防止这种情况发生？（我想也许使用 useTransitiveFiltering 会阻止它，但没有）

为了说明它在 zip 文件中的外观，这里有一个插图：

[截图压缩文件 http://www.openscada.org/AtlantisMavenBuild?action=AttachFile&do=get&target=multiple-deps.png](http://www.openscada.org/AtlantisMavenBuild?action=AttachFile&do=get&target=multiple-deps.png)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T15:23:48.080

这是程序集插件中的一个错误。大约一年前，我也注意到了这一点。最新版的组装插件没有这个问题。我建议将您正在使用的程序集插件的版本更新到 2.2 beta 3。它应该可以解决您的问题。

```
 <plugin>
      <artifactId>maven-assembly-plugin</artifactId>
      <groupId>org.apache.maven.plugins</groupId>
      <version>2.2-beta-3</version>
  </plugin> 
```

# user-interface - 如何在黑莓应用程序文本字段中启用自动大写、标点、文本功能？

> ID：848578
> 
> 赞同：1
> 
> 时间：2009-05-11T15:12:54.167
> 
> 标签：user-interface, blackberry, java-me, field, rim-4.2

我正在使用 RIM JDE 4.2.1

我希望我的文本字段自动大写句子的第一个字母，在末尾添加标点符号，并引用设备上的 AutoText DB。看起来这将/应该是 API 中的字段类型，但要么我错过了它，要么它不存在。

作为参考，API 位于此处： http: [//www.blackberry.com/developers/docs/4.2.1api/index.html](http://www.blackberry.com/developers/docs/4.2.1api/index.html)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T17:07:11.500

```
net.rim.device.api.ui.component.AutoTextEditField 
```

# subsonic - 亚音速：删除前

> ID：848579
> 
> 赞同：1
> 
> 时间：2009-05-11T15:13:07.350
> 
> 标签：subsonic

SubSonic 提供了可覆盖的方法`BeforeUpdate`并`BeforeInsert`用于进行验证。`BeforeDelete`如果这样的事情甚至存在，有没有办法挂钩事件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T15:49:05.917

我不知道任何 BeforeDelete 事件，但您始终可以覆盖 Delete 方法并在那里处理它。只要记住将任何被覆盖的方法放在单独的文件中（SubSonic 类是部分的），约定是将该文件放在“Altered”文件夹中并在那里处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T17:34:41.913

据我记得，对象没有 Delete 方法。您需要通过控制器删除（至少在我的模板中！）。

在我的模板中，我有方法 PreDelete/PostDelete、PreDestroy/PostDestroy。我们可能自己添加了这些。

看看这篇文章的一些示例代码： [http](http://blog.lavablast.com/post/2008/08/SubSonic-v21-Controller-and-Utilities.aspx) ://blog.lavablast.com/post/2008/08/SubSonic-v21-Controller-and-Utilities.aspx （我们的博客上还有关于相同控制器的其他文章- 但它们适用于 v2.0）。

# f# - 如何解决 F# 类型引用错误？

> ID：848585
> 
> 赞同：6
> 
> 时间：2009-05-11T15:14:40.187
> 
> 标签：f#, mutual-recursion

我已经翻阅了我的书，并且在谷歌上搜索，直到我用完搜索词，但我仍然找不到这个问题的示例或答案：

以下代码无法编译，因为在声明 Entity 时尚未声明类型 Effect 和类型 Affect。所以我不明白如何解决这个问题。

在 C++ 中，这个问题是通过在 h 文件中声明原型然后包含 h 文件来解决的。在 C# 中，这从来都不是问题。那么它在 F# 中是如何解决的呢？

```
#light
type Entity = 
    { 
        Name:string; 
        Affects:List<Affect>; //Compile error: The type Affect is not defined
        Effects:List<Effect>; //Compile error: the type Effect is not defined
    }

type Effect = 
    { 
        Name:string; 
        //A function pointer for a method that takes an Entity and returns an Entity
        ApplyEffect:Entity -> Entity;
    }

type Affect = 
    { 
        Name:string; 
        //A List of Effects that are applied by this Affect Object
        EffectList:List<Effect>; 
        //A function pointer to return an Entity modified by the listed Effects
        ApplyAffect:Entity->Entity;
    } 
```

这里的基本目标是实体类型的对象应该能够列出它可以应用于实体类型的对象的影响。实体还可以列出已应用到它的效果。这样，通过将所有效果与原始实体状态折叠起来，就可以找到实体的“当前”状态。

感谢您的时间，

——亚当·伦达

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T15:30:01.657

我相信这是正确的答案：

[http://langexplr.blogspot.com/2008/02/defining-mutually-recursive-classes-in.html](http://langexplr.blogspot.com/2008/02/defining-mutually-recursive-classes-in.html)

所以...

```
type Entity = 
    { 
        Name:string; 
        Affects:List<Affect>; 
        Effects:List<Effect>; 
    }
and Effect = 
    { 
        Name:string; 
        ApplyEffect:Entity -> Entity;
    }
and  Affect = 
    { 
        Name:string; 
        EffectList:List<Effect>; 
        ApplyAffect:Entity->Entity;
    } 
```

# sifr - 使用过滤器时的 sifr 剪辑

> ID：848588
> 
> 赞同：0
> 
> 时间：2009-05-11T15:15:52.803
> 
> 标签：sifr

替换文本的左侧被几个像素裁剪，我无法弄清楚。唯一似乎可以解决问题的方法是将所有内容都设置为 text-align: center，但这显然是非常不切实际的。不确定我做错了什么，因为我找不到任何类似问题的报告。

我正在使用 Glow 和 DropShadow 滤镜，如果其中任何一个独立于另一个使用，问题仍然存在。

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-12T08:41:03.627

您可以使用该`offsetLeft`参数将文本向右移动，并在必要`tuneWidth`时使影片更宽。

`offsetTop`对`tuneHeight`垂直轴做同样的事情，你可以使用负值。

# ruby-on-rails - 如何从 Rails 中访问 Rack 环境？

> ID：848591
> 
> 赞同：35
> 
> 时间：2009-05-11T15:16:20.387
> 
> 标签：ruby-on-rails, ruby, rack, middleware

我有一个看起来像这样的 Rack 应用程序：

```
class Foo
  def initialize(app)
    @app = app
  end
  def call(env)
    env["hello"] = "world"
    @app.call(env)
  end
end 
```

将我的 Rack 应用程序连接到 Rails 后，如何`env["hello"]`从 Rails 中访问？

**更新**：感谢 Gaius 的回答。Rack and Rails 允许您在请求期间或会话期间存储内容：

```
# in middleware
def call(env)
  Rack::Request.new(env)["foo"] = "bar"  # sticks around for one request

  env["rack.session"] ||= {}
  env["rack.session"]["hello"] = "world" # sticks around for duration of session
end

# in Rails
def index
  if params["foo"] == "bar"
    ...
  end
  if session["hello"] == "world"
    ...
  end
end 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-11T21:33:44.840

我很确定您可以使用该`Rack::Request`对象来传递请求范围变量：

```
# middleware:
def call(env)
  request = Rack::Request.new(env) # no matter how many times you do 'new' you always get the same object
  request[:foo] = 'bar'
  @app.call(env)
end

# Controller:
def index
  if params[:foo] == 'bar'
    ...
  end
end 
```

或者，您可以直接获取该“ `env`”对象：

```
# middleware:
def call(env)
  env['foo'] = 'bar'
  @app.call(env)
end

# controller:
def index
  if request.env['foo'] == 'bar'
    ...
  end
end 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2014-05-29T17:34:02.800

**简短回答：**在控制器内部使用`request.env`或。`env`

## 长答案：

根据[Rails 控制器上的 Rails 指南](http://guides.rubyonrails.org/action_controller_overview.html#the-request-object)，ActionController 提供了一种`request`方法，您可以使用该方法来访问有关控制器正在响应的当前 HTTP 请求的信息。

在进一步检查文档后[`ActionController::Base#request`](http://api.rubyonrails.org/classes/ActionController/Base.html#method-i-request)，我们看到它“返回一个代表当前请求的 ActionDispatch::Request 实例”。

如果我们查看 的文档[`ActionDispatch::Request`](http://api.rubyonrails.org/classes/ActionDispatch/Request.html)，我们会看到它继承自[`Rack::Request`](http://rubydoc.info/github/rack/rack/master/frames/Rack/Request). 啊哈！开始了。

现在，如果您不熟悉 文档[`Rack::Request`](http://rubydoc.info/github/rack/rack/master/frames/Rack/Request)，它基本上是 Rack 环境的包装器。因此，在大多数情况下，您应该能够按原样使用它。如果你真的想要原始环境哈希，你可以用[`Rack::Request#env`](http://rubydoc.info/github/rack/rack/master/Rack/Request#env-instance_method). 所以在 Rails 控制器中，这只是`request.env`.

### 深层发掘：

在进一步检查 的实例方法后[`ActionController::Base`](http://api.rubyonrails.org/classes/ActionController/Base.html)，我注意到那里没有太多可看的东西。特别是，我注意到`params`和`session`变量似乎丢失了。所以，我上移了一级到[`ActionController::Metal`](http://api.rubyonrails.org/classes/ActionController/Metal.html)，它[`ActionController::Base`](http://api.rubyonrails.org/classes/ActionController/Base.html)继承自。

在[`ActionController::Metal`](http://api.rubyonrails.org/classes/ActionController/Metal.html)中，我发现了一种方法[`env`](http://api.rubyonrails.org/classes/ActionController/Metal.html#method-i-env)，它没有关于它的作用的文档——但我可以猜到。事实证明我是对的。该变量[被分配给`request.env`](https://github.com/rails/rails/blob/2948668bf1509941d7862362ed9c67b95f6cb155/actionpack/lib/action_controller/metal.rb#L193).

[`ActionController::Metal`](http://api.rubyonrails.org/classes/ActionController/Metal.html)还包含该[`params`](http://api.rubyonrails.org/classes/ActionController/Metal.html#method-i-params)方法，根据[来源](https://github.com/rails/rails/blob/2948668bf1509941d7862362ed9c67b95f6cb155/actionpack/lib/action_controller/metal.rb#L141)，该方法默认设置为[`request.parameters`](http://api.rubyonrails.org/classes/ActionDispatch/Http/Parameters.html#method-i-parameters)。事实证明，`request.parameters`不是 from [`Rack::Request`](http://rubydoc.info/github/rack/rack/master/frames/Rack/Request)，而是[ActionDispatch::Http::Parameters](http://api.rubyonrails.org/classes/ActionDispatch/Http/Parameters.html#method-i-parameters)，它包含在[`ActionDispatch::Request`](http://api.rubyonrails.org/classes/ActionDispatch/Request.html). 该方法与该方法非常相似[`Rack::Request#params`](http://rubydoc.info/github/rack/rack/master/Rack/Request#params-instance_method)，不同之处在于更改它会修改特定于 Rails 的 Rack 环境变量（因此更改将在 的实例中保持不变[`ActionDispatch::Request`](http://api.rubyonrails.org/classes/ActionDispatch/Request.html)）。

但是，我似乎仍然找不到`session`方法。事实证明，它根本不在文档中。在搜索了源代码后[`ActionController::Metal`](http://api.rubyonrails.org/classes/ActionController/Metal.html)，我终于在[这一行](https://github.com/rails/rails/blob/2948668bf1509941d7862362ed9c67b95f6cb155/actionpack/lib/action_controller/metal.rb#L130)找到了它。没错，它只是[request.session](http://rubydoc.info/github/rack/rack/master/Rack/Request#session-instance_method)的一个快捷方式。

### 总结一下：

**在控制器...**

*   使用`request.env`or`env`获取原始环境对象
*   用于`params`从机架输入流中读取机架查询字符串和发布数据。（例如[`Rack::Request#params`](http://rubydoc.info/github/rack/rack/master/Rack/Request#params-instance_method)）
*   用于`session`访问`rack.session`机架环境中的值

**在中间件...**

*   通过环境哈希以通常的方式访问环境的属性
*   `rack.session`通过环境哈希上的属性访问 Rails 会话
*   读取参数[`Rack::Request#params`](http://rubydoc.info/github/rack/rack/master/Rack/Request#params-instance_method)
*   [`Rack::Request#update_param`](http://rubydoc.info/github/rack/rack/master/Rack/Request#update_param-instance_method)通过and更新参数[`Rack::Request#delete_param`](http://rubydoc.info/github/rack/rack/master/Rack/Request#delete_param-instance_method)（如文档中所述[`Rack::Request#params`](http://rubydoc.info/github/rack/rack/master/Rack/Request#params-instance_method)）
*   [`ActionDispatch::Http::Parameters#params`](http://api.rubyonrails.org/classes/ActionDispatch/Http/Parameters.html#method-i-params)使用through以特定于 Rails 的方式更新参数[`ActionDispatch::Request`](http://api.rubyonrails.org/classes/ActionDispatch/Request.html)

# linux - 在内核和用户模式之间切换时的时间戳计数器 (TSC)

> ID：848597
> 
> 赞同：3
> 
> 时间：2009-05-11T15:18:16.700
> 
> 标签：linux, kernel

我想知道当上下文切换发生时，是否有人知道有关 Linux 中时间戳计数器的更多详细信息？到目前为止，我的观点是，TSC 值在每个时钟周期内仅增加 1，无论是在内核模式下还是在用户模式下都是独立的。我现在使用 TSC 测量了一个应用程序的性能，它产生了 5 个 Mio 时钟周期的性能结果。然后，我对调度程序进行了一些更改，这意味着上下文切换需要更长的时间，例如 2 个 Mio 周期而不是 500.000 个周期。有趣的是，当再次测量原始应用程序的性能时，它仍然需要 5 个 Mio 周期......所以我想知道为什么它没有花费更长的时间，因为上下文切换现在需要将近 2 个 Mio 时钟周期？（并且在应用程序执行期间至少出现 3 个上下文）。

时间戳计数器是否在内核模式期间以某种方式停用？还是在比赛切换时保存了 TSC 的内容？谢谢，如果有人能指出我可能是什么问题！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T23:15:09.107

正如你可以在[维基百科上阅读的](http://en.wikipedia.org/wiki/Time_Stamp_Counter)

> 随着多核/超线程 CPU、具有多个 CPU 的系统和“休眠”操作系统的出现，不能依靠 TSC 来提供准确的结果。该问题有两个组成部分：滴答速率以及所有内核（处理器）是否在其计时寄存器中具有相同的值。无法保证单个主板上多个 CPU 的时间戳计数器会同步。在这种情况下，程序员只能通过将代码锁定到单个 CPU 来获得可靠的结果。即使这样，由于操作系统或 BIOS 采取的节能措施，CPU 速度可能会发生变化，或者系统可能会休眠并稍后恢复（重置时间戳计数器）。对时间戳计数器的依赖也降低了可移植性，因为其他处理器可能没有类似的功能。最近的英特尔处理器包括一个恒定速率 TSC（由 Linux 的 /proc/cpuinfo 中的 constant_tsc 标志标识）。使用这些处理器，TSC 以处理器的最大速率读取，而不管 CPU 的实际运行速率如何。虽然这使时间保持更加一致，但它可能会扭曲基准，其中在操作系统将处理器切换到更高速率之前，一定量的启动时间会以较低的时钟速率花费。这会使事情看起来比通常需要更多的处理器周期。在操作系统将处理器切换到更高速率之前，一定量的启动时间会以较低的时钟速率花费。这会使事情看起来比通常需要更多的处理器周期。在操作系统将处理器切换到更高速率之前，一定量的启动时间会以较低的时钟速率花费。这会使事情看起来比通常需要更多的处理器周期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T18:30:41.113

我相信 TSC 实际上是您正在使用的处理器的硬件结构。IE：读取 TSC 实际上使用 RDTSC 处理器操作码。我什至认为操作系统没有办法改变它的值，它只会随着上次电源重置后的每个滴答声而增加。

关于您对调度程序的修改，您是否有可能使用多核处理器，而操作系统不会切换您正在运行的进程？您可以调用`sched_yield()`或`sleep(0)`在您的程序中查看您的调度程序更改是否开始生效。

# language-agnostic - 类似于 Google 代码搜索的源代码索引器和可视化器

> ID：848598
> 
> 赞同：12
> 
> 时间：2009-05-11T15:18:33.033
> 
> 标签：language-agnostic, search, indexer, code-search-engine

我正在寻找一种方法来搜索我们的颠覆存储库或只是打包的源代码。

是否有任何**可下载**的服务器/工具，如[谷歌代码搜索](http://google.com/codesearch)来索引源代码（最好支持 svn 等版本控制系统）并允许我们在其中搜索？

是否有任何工具也可以索引文档？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:23:39.313

[FishEye](http://www.atlassian.com/software/fisheye/)或[OpenGrok](http://opengrok.github.io/OpenGrok/)可能。

有许多工具可以索引文档。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-12T16:55:05.527

我相信谷歌搜索的源代码可以在这里找到。它在 Go [https://code.google.com/p/codesearch/中实现](https://code.google.com/p/codesearch/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-03-11T14:35:38.950

Google 在 GitHub 上提供了他们内部的 Kythe 源代码分析器工具集，请参见[http://www.kythe.io/](http://www.kythe.io/)。

它不仅仅是一个简单的文本级索引器。它的核心是从源代码构建一个 AST 图，并提供对其进行操作和查询的工具。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-21T22:11:27.077

我使用[glimpse](http://webglimpse.net/download.php)进行代码搜索。我使用免费的命令行工具，而不是付费的网络界面。它非常快，并且可以与其他工具结合使用以快速找到您要查找的内容。我发现为代码的不同分支设置多个存储库很容易。此外，我还创建了一些[脚本来帮助查询、格式化和着色](https://www.theeggeadventure.com/wikimedia/index.php/Colorize_Glimpse)结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-22T20:39:13.410

可以在[SD Source Code Search Engine](http://www.semanticdesigns.com/Products/SearchEngine)找到对语言敏感的源代码搜索引擎。它可以同时处理多种语言。可以对特定语言的模式或跨语言的模式执行搜索（例如“查找涉及 TAX 的标识符”）。通过对语言标记敏感，可以减少误报的数量，从而为用户节省时间。它理解 C、C++、C#、COBOL、Java、ECMAScript、Java、XML、Verilog、VHDL 和许多其他语言。[我是公司的负责人]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-06T10:49:14.343

[Hound](https://github.com/etsy/Hound) - 带有 Web UI 的代码搜索工具

# javascript - 用于绘制区域的 Javascript 图形库

> ID：848604
> 
> 赞同：2
> 
> 时间：2009-05-11T15:20:58.303
> 
> 标签：javascript, python, django, graph, screen-scraping

作为一名热心的风帆冲浪者，我对接下来的几周会有多风很感兴趣。为此，我一直在编写一个小应用程序来抓取一个流行的天气网站（仅供个人使用 - 不转发信息或任何东西）并将数据整理成一个图表，以便我可以轻松查看何时值得前往出去。

我有后端工作，但需要一种显示数据的方法。我的刮刀目前给了我两个系列的数据，这些数据告诉我一般风有多强，以及它可能会有多强。接下来我想做的是将这两个数据集显示为图表中的一对线，并​​在它们之间的区域设置阴影。

我正在考虑使用诸如[flot 库之类的](http://code.google.com/p/flot/)东西来显示数据。唯一的问题是我看不到在两条线之间遮蔽区域的方法？

如果有人对如何在 flot 或其他库或图形技术中执行此操作有建议（我的服务器上有 DJango，所以任何 pythonic 或 javascripty 都应该没问题），我很想听听他们的意见。理想情况下，这将是一个避免提供图像的 javascript 解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T15:32:25.587

看看[Google 图表 API 的](http://code.google.com/apis/visualization/documentation/gallery/areachart.html). 他们使这种事情变得非常容易。如果没有一些示例代码，我很难给你一个例子，但谷歌在文档上有一个很好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:19:07.490

你应该看看道场。看起来对你来说很容易做到，只需用与背景相同的填充颜色绘制底线。这应该会给你你想要的效果。

[http://dojocampus.org/explorer/#Dojox_Charting_2D](http://dojocampus.org/explorer/#Dojox_Charting_2D)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:19:15.833

我会使用打开的 flash 图表，您只需使用数据创建一个 JSON，然后您就可以在页面中看到所有华丽的酷炫......

[http://teethgrinder.co.uk/open-flash-chart-2/](http://teethgrinder.co.uk/open-flash-chart-2/)

# c# - FxCop 和 GAC 疯狂

> ID：848617
> 
> 赞同：8
> 
> 时间：2009-05-11T15:22:45.290
> 
> 标签：c#, gac, fxcop

当我尝试分析依赖于模式和实践的项目时使用 FxCop，企业库数据（以及其他）2.0.0.0 - FxCop 抱怨它不能：“找到程序集引用” - 即使正在分析的应用程序 dll 是针对此版本及其在 GAC 中。如果我浏览 GAC 尝试选择相同的程序集（我已检查版本和公钥令牌），FxCop 将不允许我“打开”它。该应用程序成功运行，并且肯定使用了问题 dll。

操作系统：在 Vista 和 Windows XP 上都可以看到。版本：Visual Studio 2005 和 2008。FxCop 1.36 应用程序符合 VS2005 for .NET 2.0。

如果我尝试使用 Reflector 浏览应用程序 dll，我也会遇到同样的问题。

显然，它不认为这是它编译的程序集的同一版本。有谁知道为什么？有什么解决方案的建议吗？我错过了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-12T03:22:51.883

检查[这个](http://social.msdn.microsoft.com/Forums/en-US/vstscode/thread/7cd4e400-933b-499f-b96e-60cd33315d1c)（FxCop）和[这个](http://jayflowers.com/WordPress/?p=136)（反射器）。

* * *

在 FxCop 中，您可以选择**Project - Options... - Spelling & Analysis** - (check) **Search Global Assembly Cache for missing references**

* * *

在Reflector中，可以选择 **View - Options... - Browser -** (check) **Automatically resolve references**

* * *

我觉得默认情况下未启用这些选项有点奇怪。

# c# - 进程可执行文件启动的 .NET 事件

> ID：848618
> 
> 赞同：19
> 
> 时间：2009-05-11T15:23:21.357
> 
> 标签：c#, .net, events, process

有没有办法注册一个特定文件名的可执行文件启动时触发的事件？我知道通过获取进程句柄并注册退出的事件，在进程退出时获取事件很容易。但是，当一个尚未运行的进程启动时，如何在不轮询所有正在运行的进程的情况下通知您？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-13T13:28:34.227

您可以使用以下内容：

```
 private ManagementEventWatcher WatchForProcessStart(string processName)
    {
        string queryString =
            "SELECT TargetInstance" +
            "  FROM __InstanceCreationEvent " +
            "WITHIN  10 " +
            " WHERE TargetInstance ISA 'Win32_Process' " +
            "   AND TargetInstance.Name = '" + processName + "'";

        // The dot in the scope means use the current machine
        string scope = @"\\.\root\CIMV2";

        // Create a watcher and listen for events
        ManagementEventWatcher watcher = new ManagementEventWatcher(scope, queryString);
        watcher.EventArrived += ProcessStarted;
        watcher.Start();
        return watcher;
    }

    private ManagementEventWatcher WatchForProcessEnd(string processName)
    {
        string queryString =
            "SELECT TargetInstance" +
            "  FROM __InstanceDeletionEvent " +
            "WITHIN  10 " +
            " WHERE TargetInstance ISA 'Win32_Process' " +
            "   AND TargetInstance.Name = '" + processName + "'";

        // The dot in the scope means use the current machine
        string scope = @"\\.\root\CIMV2";

        // Create a watcher and listen for events
        ManagementEventWatcher watcher = new ManagementEventWatcher(scope, queryString);
        watcher.EventArrived += ProcessEnded;
        watcher.Start();
        return watcher;
    }

    private void ProcessEnded(object sender, EventArrivedEventArgs e)
    {
        ManagementBaseObject targetInstance = (ManagementBaseObject) e.NewEvent.Properties["TargetInstance"].Value;
        string processName = targetInstance.Properties["Name"].Value.ToString();
        Console.WriteLine(String.Format("{0} process ended", processName));
    }

    private void ProcessStarted(object sender, EventArrivedEventArgs e)
    {
        ManagementBaseObject targetInstance = (ManagementBaseObject)e.NewEvent.Properties["TargetInstance"].Value;
        string processName = targetInstance.Properties["Name"].Value.ToString();
        Console.WriteLine(String.Format("{0} process started", processName));
    } 
```

然后，您将调用 WatchForProcessStart 和/或 WatchForProcessEnd 传入您的进程名称（例如“notepad.exe”）。

ManagementEventWatcher 对象在实现 IDisposable 时从两个 Watch* 方法返回，因此您应该在完成这些对象后调用 Dispose 以防止出现问题。

如果您需要在流程开始后更快地引发事件，您还可以更改查询中的轮询值。为此，将“WITHIN 10”行更改为小于 10。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T12:03:53.423

WMI 可以在创建进程时创建事件。然后，您可以过滤这些事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-06-06T17:26:08.233

这是代码。

请注意，您必须像管理员一样启动 Visual Studio 才能执行此代码。

```
using System;
using System.Management;

namespace AppLaunchDetector
{
    class Program
    {
        static void Main(string[] args)
        {           
            ManagementEventWatcher w = null;
            WqlEventQuery q;
            try
            {
                q = new WqlEventQuery();
                q.EventClassName = "Win32_ProcessStartTrace";
                w = new ManagementEventWatcher(q);
                w.EventArrived += new EventArrivedEventHandler(ProcessStartEventArrived);
                w.Start();
                Console.ReadLine(); // block main thread for test purposes
            }
            catch (Exception ex)
            {

            }
            finally
            {
                w.Stop();
            }
        }

        static void ProcessStartEventArrived(object sender, EventArrivedEventArgs e)
        {
            foreach (PropertyData pd in e.NewEvent.Properties)
            {
                Console.WriteLine("\n============================= =========");
                Console.WriteLine("{0},{1},{2}", pd.Name, pd.Type, pd.Value);
            }
        }
    }
} 
```

# gwt - 每次 GWT 编译时我都会得到新的 javascript，而无需更改 java 源

> ID：848619
> 
> 赞同：3
> 
> 时间：2009-05-11T15:23:26.163
> 
> 标签：gwt

GWT 将 Java 源代码编译为 Javascript，并根据文件内容的哈希值命名文件。每次编译我都会得到一组新文件，因为 javascript 内容正在发生变化，即使我根本不更改源。

OBF 和 PRETTY 输出的文件不同，但如果我将其设置为 DETAILED，则每次编译时它们不再不同。在 PRETTY 中，我可以看到编译之间的所有/大部分差异都在 typeId 的值参数中。例如，调用一个名为 initValues() 的函数，它的 typeId 参数使用不同的值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T00:18:24.493

在 PRETTY 模式下，您看到的区别是 Java 类分配给 TypeId。这就是 GWT 管理运行时类型检查的方式。您会注意到每个脚本底部的表格基本上将每个 typeId 映射到所有兼容的超类。这就是 GWT 仍然可以在 JavaScript 中抛出 ClassCastException 的原因（尽管您应该很少遇到这种情况！）。

在 OBF 模式下，差异是由于分配了缩小的函数名称。

在这两种情况下，都是由于编译器处理代码的顺序。一些内部符号表可能正在使用无序集合存储符号进行处理。这可能有很多原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T23:22:22.120

据我所知，GWT每次编译都会编译一个新版本，这是一个特性；）

不过，您可以使用 ant 来控制它，以便它仅在实际更改时构建应用程序的 GWT 部分：

[http://wiki.shiftyjelly.com/index.php/GWT#Use_The_Power_of_Ant_to_Build_Changes_Only](http://wiki.shiftyjelly.com/index.php/GWT#Use_The_Power_of_Ant_to_Build_Changes_Only)

# c# - 确定远程系统何时重新启动

> ID：848622
> 
> 赞同：2
> 
> 时间：2009-05-11T15:23:50.310
> 
> 标签：c#

我正在编写调用批处理文件的 ac# 程序，该批处理文件将远程系统重新引导到另一个分区。有没有办法知道系统何时完成重新启动？我想知道重启后何时可以访问远程系统。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:29:25.590

我会 ping 它以确定它何时重新上线。.net 中内置了一个[Ping 。](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.ping.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T15:34:05.707

当系统 A 告诉系统 B 重新启动时，也许它可以提供它的 ip 地址（或其他联系信息），然后在系统 B 的启动过程中它可以读取包含联系信息的文件并回调系统 A。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T15:35:37.047

你有几个选择...

您可以尝试连接到另一个系统上的网络服务，即：按照[Jon B 的建议](https://stackoverflow.com/questions/848622/determine-when-a-remote-system-is-rebooted/848648#848648)使用 Ping 。

但是，如果系统在您的控制之下，您还有其他选择。您可以设置计划任务（或安装服务）以在启动时启动，并让其他系统在其在线时通知您。这将防止您需要重复 ping。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T20:11:46.207

我希望我在星期六花了一整天试图弄清楚这一点之前使用过这个网站。谢谢您的帮助！！下面是我最终做的事情。此代码将 ping 计算机并确定它何时重新联机。下一步将是确定我是否可以按照前面的建议打开到远程桌面端口的网络连接。随意对代码发表任何评论。

注意：以下是添加的 using 语句：

使用 System.Net；// 添加使用 System.Net.NetworkInformation;// 添加使用 System.ComponentModel; // 使用 System.Threading 添加；// 添加

```
 static void Main(string[] args)
    {
        string systemName = "172.30.11.148";      // Name of system beign pinged.  System name used instead of ip due to DHCP 

        Ping pingSender = new Ping();                       // Creates new ping object.  
        string data = "datadatadatadatadatadatadatadata";   // buffer of 32 bytes of data to transmit.
        byte[] buffer = Encoding.ASCII.GetBytes(data);      // buffer containing data.

        int pingTimeout = 120;          // Timeout in ms sent into pingSender.
        int maxWaitTimeout = 60;        // Maximum time to wait for system to reboot.
        int counter = 1;                // Used in while statement
        bool connectStatus = false;     // State of system connection.

        Console.WriteLine("Wait for reboot to start before trying to establish connection.");
        //Thread.Sleep(30000);            // Waits 30 seconds at start of reboot to allow network to close.
        Thread.Sleep(1000);

        try
        {
            // Performs a ping on the system.  If the system is available, while loop is exited and program
            // continues.  If the system is not available, program waits approximately 1 second and then
            // pings the system again.
            while (counter < maxWaitTimeout)
            {
                // Pings the system with 32 byts of data and waits for timeout
                Console.WriteLine("Connection attempt #: " + counter + " of " + maxWaitTimeout);
                PingReply reply = pingSender.Send(systemName, pingTimeout, buffer);
                Console.WriteLine("Status of ping to: {0} - {1}", systemName, reply.Status);

                if (reply.Status.ToString() == "Success")
                {
                    connectStatus = true;                     
                    Console.WriteLine("\nRoundTrip time: {0}", reply.RoundtripTime);
                    Console.WriteLine("Time to live: {0}", reply.Options.Ttl);
                    Console.WriteLine("Buffer size: {0}", reply.Buffer.Length);
                    break;
                }

                Thread.Sleep(880);
                counter += 1;                  
            } // end while loop

            if (connectStatus == true)
            {
                Console.WriteLine("\nAble to establish connection to: {0}", systemName);
            }
            else
            {
                Console.WriteLine("\nUnable to establish network connection using ping to: {0}", systemName);
            }
        } // end try

        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine(ex.Message);
        }

        Console.ReadLine();     // Pause console

    } // end main 
```

# c# - cc 模式下的智能电动支架（C#、Java 等）

> ID：848624
> 
> 赞同：2
> 
> 时间：2009-05-11T15:24:19.857
> 
> 标签：c#, java, emacs

在各种 IDE 中，键入开放式大括号会导致出现一对匹配的大括号字符。通常，大括号以某种上下文相关的方式插入。在字符串文字中，大括号之间没有插入换行符。在字符串文字之外，有一个换行符，并且立即缩进。

```
{
    _cursor_
} 
```

当我继续在光标处键入时，所有新代码都会正确缩进。

但是，在 Emacs 中，默认情况下，在我的 cc 模式（csharp-mode、java-mode 等）中，一个开卷曲运行 self-insert-command，它只插入没有缩进的左大括号。紧密卷曲运行 c-electric-brace，它只缩进紧密卷曲，而不是整个范围。结果是，当我在卷曲范围内键入时，缩进都是错误的，我必须在卷曲范围关闭时手动重新缩进。

有没有一种简单的方法可以让 Emacs 表现得像我使用的流行 IDE？我已经写了一些 Emacs Lisp 来做，但它不是很通用，我想知道我是否遗漏了什么。

我知道骨架对插入可能功能。它插入匹配的*任何内容*对：大括号、括号、引号、尖括号、方括号。但是该函数不执行任何上下文相关的缩进，也不给我空白换行符。有没有办法让它缩进或......是否有另一个函数我应该绑定到开放卷曲以获得我想要的东西？

PS：我的 Emacs Lisp 看起来像这样：

```
; The default binding for "open curly" was skeleton-pair-insert-maybe.  It
; inserts a pair of braces and then does not insert a newline, and does not
; indent.  I want the braces to get newlines and appropriate indenting.  I
; think there is a way to get this to happen appropriately just within emacs,
; but I could not figure out how to do it.  So I wrote this alternative.  The
; key thing is to determine if the point is within a string.  In cc-mode, this
; is at least sometimes done by looking at the font face.  Then, if not in a
; literal string, do the appropriate magic.  This seems to work.
(defun cheeso-insert-open-brace ()
  "if point is not within a quoted string literal, insert an open brace, two newlines, and a close brace; indent everything and leave point on the empty line. If point is within a string literal, just insert a pair or braces, and leave point between them."
  (interactive)
  (if
      ; are we inside a string? 
      (c-got-face-at (point) c-literal-faces)
      ; if so, then just insert a pair of braces and put the point between them
      (progn
        (self-insert-command 1)
        (insert "}")
        (backward-char)
        )
    ; not inside a literal string.
    ; therefore, insert paired braces with an intervening newline, and indent everything appropriately.
    (progn
      (self-insert-command 1)
      (c-indent-command)
      (newline)
      (insert "}")
      (c-indent-command)
      (previous-line)
      (newline-and-indent)
      ; point ends up on an empty line, within the braces, properly indented
      )
    )
  ) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T17:36:44.553

我接受了 kastauyra 的回答，但仍然使用我自己的自定义 elisp 来做我想做的事，即根据需要插入一组匹配的大括号。我发布的原始 elisp 代码因几个边缘情况而失败。这是我现在使用的更新的 elisp 代码。

```
(defun cheeso-looking-back-at-regexp (regexp)
  "calls backward-sexp and then checks for the regexp.  Returns t if it is found, else nil"
  (interactive "s")
  (save-excursion
    (backward-sexp)
    (looking-at regexp)
    )
  )

(defun cheeso-looking-back-at-equals-or-array-init ()
  "returns t if an equals or [] is immediate preceding. else nil."
  (interactive)
  (cheeso-looking-back-at-regexp "\\(\\w+\\b *=\\|[[]]+\\)")
)  

(defun cheeso-prior-sexp-same-statement-same-line ()
  "returns t if the prior sexp is on the same line. else nil"
  (interactive)
  (save-excursion
    (let ((curline (line-number-at-pos))
          (curpoint (point))
          (aftline (progn
                      (backward-sexp)
                      (line-number-at-pos))) )
      (= curline aftline)
      )
    )
  )  

(defun cheeso-insert-open-brace ()
    "if point is not within a quoted string literal, insert an open brace, two newlines, and a close brace; indent everything and leave point on the empty line. If point is within a string literal, just insert a pair or braces, and leave point between them."
  (interactive)
  (cond

   ;; are we inside a string literan? 
   ((c-got-face-at (point) c-literal-faces)

    ;; if so, then just insert a pair of braces and put the point between them
    (self-insert-command 1)
    (insert "}")
    (backward-char)
    )

   ;; was the last non-space an equals sign? or square brackets?  Then it's an initializer.
   ((cheeso-looking-back-at-equals-or-array-init)
        (self-insert-command 1)
        ;; all on the same line
        (insert "  };")
        (backward-char 3)
        )

    ;; else, it's a new scope.
    ;; therefore, insert paired braces with an intervening newline, and indent everything appropriately.
    (t
     (if (cheeso-prior-sexp-same-statement-same-line)
      (newline-and-indent))
      (self-insert-command 1)
      (c-indent-line-or-region)
      (end-of-line)
      (newline)
      (insert "}")
      ;;(c-indent-command) ;; not sure of the difference here
      (c-indent-line-or-region)
      (previous-line)
      (end-of-line)
      (newline-and-indent)
      ; point ends up on an empty line, within the braces, properly indented
      )
    )
  ) 
```

在我的 c-mode 钩子函数中，我将开放式卷曲“{”绑定到 cheeso-insert-open-brace，如下所示：

```
 (local-set-key (kbd "{") 'cheeso-insert-open-brace) 
```

结果是，当我有这样的事情时：

```
for(;;) 
```

然后键入一个开放的卷曲，我得到这个：

```
for(;;)
{
   _cursor_
} 
```

如果我有这样的初始化程序：

```
byte[] x = 
```

我输入一个开放的卷曲，我得到了这个：

```
byte[] x = { _cursor_ }; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T06:05:58.047

这个 .emacs 摘录（我一定是前段时间在[EmacsWiki](http://www.emacswiki.org/)上找到的）将满足您的需求：

```
;; Enter indents the new line
(defun my-make-CR-do-indent ()
  (define-key c-mode-base-map "\C-m" 'c-context-line-break))
(add-hook 'c-initialization-hook 'my-make-CR-do-indent) 
```

像这样工作：

```
int main(void)
{
  {
    {
      { 
```

没有地方我不得不按空格或制表符来输入它。

# version-control - Mercurial 钩子没有正确执行

> ID：848627
> 
> 赞同：8
> 
> 时间：2009-05-11T15:25:31.993
> 
> 标签：version-control, mercurial, mercurial-hook

这应该是一件非常简单的事情，但由于某种原因，它不适用于我的 Mercurial 存储库。我想要的只是让远程仓库`hg update`在有人推送时自动运行。所以我在 .hg/hgrc 文件中有这个：

```
[hook]
changegroup = hg update 
```

很简单，对吧？但由于某种原因，这永远不会执行。我还尝试编写一个执行此操作的 shell 脚本。.hg/hgrc 看起来像这样：

```
[hooks]
changegroup = /home/marc/bin/hg-update 
```

hg-update 看起来像这样：

```
#!/bin/sh
hg help >> /home/marc/works.txt;
hg update >> /home/marc/works.txt;
exit 0; 
```

但同样，这不会更新。的内容`hg help`被写入`works.txt`，但没有任何内容被写入`hg update`。我在这里有什么明显的遗漏吗？这已经困扰我好几天了，我似乎无法让它发挥作用。

**更新**

好的，再次使用`-v`从我的工作站推送到远程仓库的命令行上的开关不会打印任何详细消息，即使我`echo`在`.hg/hgrc`. 但是，当我从同一文件系统上的 repo 克隆进行推送时（我通过 SSH 登录），这就是我得到的：

```
bash-3.00$ hg -v push ../test-repo/
推送到 ../test-repo/
寻找变化
找到 1 个变更集
运行钩子 prechangegroup: echo "远程仓库位于 `hg tip -q`"
echo "远程仓库 wdir 位于 `hg parents -q`"
远程仓库位于 821:1f2656753c98
远程仓库 wdir 位于 821:1f2656753c98
添加变更集
添加清单
添加文件更改
添加了 1 个变更集，对 1 个文件进行了 1 次更改
运行钩子更改组：回声“正在更新....`hg update -v`”
echo "远程仓库位于`hg tip -q`"
echo "远程仓库 wdir 位于 `hg parents -q`"
更新....解决清单
获取 license.txt
1 个文件已更新，0 个文件已合并，0 个文件已删除，0 个文件未解决
远程仓库位于 822:389a6c7276c6
远程仓库 wdir 位于 822:389a6c7276c6

```

所以它有效，但只有当我从同一个文件系统推送时。如果我尝试通过网络从另一个工作站推送到 repo，它就不起作用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-02-02T12:37:52.353

好吧，在经历了与 Marc W 前一段时间相同的挫折步骤之后，我终于找到了问题的解决方案，至少在使用 hgwebdir WSGI 脚本完成远程服务时。

我发现当通过 HTTP 或 HTTPS 使用这种远程推送时，Mercurial 只会忽略您写入 .hg/hgrc 文件或存储库的所有内容。**但是，在 hgwebdir 配置**中输入钩子就可以了。

*因此，如果您的hgwebdir.wsgi*脚本中的底线类似于

```
application = hgwebdir('hgweb.config') 
```

[hooks] 配置部分需要进入提到的*hgweb.config*。

一个缺点是这些钩子是针对该配置的 [paths] 部分中列出的**每个存储库执行的。**尽管 HG 提供了另一个支持 WSGI 的函数（hgweb 而不是 hgwebdir）来仅服务于单个存储库，但该函数似乎不支持任何钩子（它也没有任何配置）。然而，这可以通过使用如上所述的 hgwebdir 并让一些 Apache RewriteRule 将所有内容映射到所需的子目录来规避。这个对我有用：

```
RewriteEngine On
RewriteCond %{REQUEST_URI} !^/reponame
RewriteRule ^(.*)$ reponame/$2 [QSA] 
```

通过 HTTP 使用远程挂钩玩得开心：D

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-09-03T10:01:15.647

我自己花了一些时间研究这个。我认为问题的答案在[这里](https://www.mercurial-scm.org/wiki/FAQ#FAQ.2FCommonProblems.Any_way_to_.27hg_push.27_and_have_an_automatic_.27hg_update.27_on_the_remote_server.3F)简明扼要地描述了：

> 输出必须重定向到 stderr（或 /dev/null），因为 stdout 用于数据流。

基本上，您不会重定向到标准错误，因此会污染标准输出。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-17T00:28:05.763

首先，我想更正上面的一些评论。

*   推送文件系统时也会调用挂钩。
*   没有必要将钩子保留在您希望它们操作的 repo 中。您也可以在用户端编写与您的问题相同的钩子。您必须将事件从更改组更改为传出，并且还必须使用 -R 开关指定远程仓库的 URL。然后如果推送用户对远程仓库有足够的权限，钩子就会成功执行。

### .hg/hgrc

```
[hooks]
outgoing = hg update -R $HG_URL 
```

现在解决你的问题......我建议创建 prechangegroup 和 changegroup 挂钩并打印一些调试输出。

### .hg/hgrc

```
[hooks]
prechangegroup = echo "Remote repo is at `hg tip -q`"
                 echo "Remote repo wdir is at `hg parents -q`"
changegroup    = echo "Updating.... `hg update -v`"
                 echo "Remote repo is at `hg tip -q`"
                 echo "Remote repo wdir is at `hg parents -q`" 
```

还可以使用 -v 开关推动，这样您就可以知道哪个钩子正在运行。如果您仍然无法弄清楚，请发布输出。我也许能帮上忙。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-14T23:54:41.353

我的问题是我的 hgwebdir 应用程序以“hg”用户身份运行，但存储库归我所有，因此我必须将这一配置添加到 hgweb.config 以使其运行挂钩：

```
[trusted]
users = me 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-11T20:17:19.317

您需要将它放在**远程**存储库的 hgrc 中。听起来好像它在您的本地仓库中。

编辑：这也取决于你如何推动。有些方法不会调用右侧的钩子。（ssh 会，我认为 HTTP 会，文件系统*不会*）

Edit2：如果您在远程仓库的计算机上“本地”推送会怎样。您可能在网络服务器和 hgrc 文件之间拥有不同的用户/权限。（参见 [server] 和 hgrc 的可信指令。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-19T20:34:11.917

我在通过 http 从 Windows Eclipse 推送时遇到了同样的问题，但是在捕获 stderr 后，我发现 hg.bat 文件需要完整路径。我的钩子部分现在看起来像：

```
[hooks]
incoming = c:\Python27\Scripts\hg.bat update > hg_log.txt 2>>hg_err.txt 
```

希望这对其他人有帮助。史蒂夫

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T15:41:40.140

尝试[打开钩子调试](http://hgbook.red-bean.com/read/handling-repository-events-with-hooks.html#id404628)，看看为什么它没有运行。

可能是权限问题或类似问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-11-08T14:18:27.630

花了一段时间，但我得到了它的工作。

我从

```
[hooks]
tag=set >&2
commit=set >&2 
```

>&2 将其传递给标准错误，以便远程控制台显示它。

当远程时，如果它正在运行，它应该在控制台中输出

```
hg push https://host/hg   -v 
```

不是。

我使用的是 hgweb.cgi，所以我切换到 hgweb.wsgi 没有任何区别。

我发现有些钩子不会在远程调用。

当我把它切换到

```
[hooks]
incoming= set >&2 
```

钩子标签和提交似乎没有被调用，但传入和变更集确实被调用。其他的我还没有确认。

现在我让它工作了，我切换回 hgweb.cgi，一切正常。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-29T21:06:49.473

我找到的原因与重定向`stdout`到`stderr`. 正如您在 wiki 页面中看到的那样，它未在 wiki 的当前版本中指定 [https://www.mercurial-scm.org/wiki/FAQ#FAQ.2FCommonProblems.Any_way_to_.27hg_push.27_and_have_an_automatic_.27hg_update.27_on_the_remote_server.3F](https://www.mercurial-scm.org/wiki/FAQ#FAQ.2FCommonProblems.Any_way_to_.27hg_push.27_and_have_an_automatic_.27hg_update.27_on_the_remote_server.3F)

我发现的问题是**权限**。

在我最初的设置中，我有一个用户，可以说它`hguser`的主页上有一个 repo，还有一个`/etc/init.d/hg.init`要启动的脚本`hg serve`。问题是`hg serve`由 运行的`root`，而 repo 下的大多数文件都与`hguser`（其中一些在某个时候切换到`root`，但它不会介意，因为我会用 更正它们`chown`）

解决方案：

*   `chown -R hguser:hguser /home/hguser/repo`（要更正所有文件，请返回 hguser）
*   发射`su hguser -c "hg serve ..."`（在我的情况下从`/etc/init.d/hg.init`）
*   `changegroup = hg update -C``[hooks]`像`repo/.hg/hgrc`往常一样下

现在它应该可以工作了`push`

PS：在我的情况下，我宁愿更新到特定分支的头部，所以我使用`hg update -C -r staging`, 使登台服务器仅更新到预期分支的头部，即使`tip`是来自另一个分支（`development`例如）

顺便说一句，我的`hg.init`脚本最终是这样的：（注意`su hguser`部分）

```
#!/bin/sh
#
# Startup script for mercurial server.
#
# @see http://jf.blogs.teximus.com/2011/01/running-mercurial-hg-serve-on-linux.html

HG=/usr/bin/hg
CONF=/etc/mercurial/hgweb.config
# Path to PID file of running mercurial process.
PID_FILE=/etc/mercurial/hg.pid

state=$1

case "$state" in
'start')
    echo "Mecurial Server service starting."
    (su hguser -c "${HG} serve -d --webdir-conf ${CONF} -p 8000 --pid-file ${PID_FILE}")
  ;;

'stop')
  if [ -f "${PID_FILE}" ]; then
    PID=`cat "${PID_FILE}"`
    if [ "${PID}" -gt 1 ]; then
      kill -TERM ${PID}
      echo "Stopping the Mercurial service PID=${PID}."
    else
      echo Bad PID for Mercurial -- \"${PID}\"
    fi
  else

    echo No PID file recorded for mercurial
  fi
  ;;

*)
  echo "$0 {start|stop}"
  exit 1
  ;;
esac 
```

PS：归功于[http://jf.blogs.teximus.com/2011/01/running-mercurial-hg-serve-on-linux.html](http://jf.blogs.teximus.com/2011/01/running-mercurial-hg-serve-on-linux.html)

# asp.net - 超时时间没有过去，但仍然超时（见代码）？

> ID：848628
> 
> 赞同：1
> 
> 时间：2009-05-11T15:25:39.887
> 
> 标签：asp.net, sql, timeout

好的，经过大约 3-4 分钟的搅拌后，我不断收到此错误：

```
 Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.

Source Error:

Line 93: 
Line 94:             DataSet getData;
Line 95:             getData = SqlHelper.ExecuteDataset(ConfigurationManager.ConnectionStrings["connstr"].ConnectionString, CommandType.StoredProcedure, "Course_NewReportGet_Get_Sav", objPara);
Line 96: 
Line 97:             foreach (DataRow dr in getData.Tables[0].Rows) 
```

这是代码，我认为我没有正确地做某事，但我将超时设置为 5000 秒，所以它必须是别的东西。您会注意到它完全是过程调用的嵌套循环。我得到每家公司，然后得到分配给每家公司的每门课程，然后对于每门课程，我得到所有用户活动的报告。大约有 250 家公司，每家公司有 2-70 门课程，每家公司每门课程报告有 8 到 1000 名用户……所以我们在这里处理大量数据。对获取报告的最后调用也是一个非常庞大的存储过程......

我正在尝试将数据转换为一种新形式，以便以后使用它更快、更容易，但现在我必须解析我们拥有的内容并以新的方式发布。这一切都在同一个数据库中，但我不确定如何仅在 SQL 中完成这一切。基本上我正在使用我们的报告工具使用的存储过程来获取要发布到新表的数据。但是我需要为每家公司的每门课程运行该程序，然后将每个用户的数据发布在每家公司每门课程的报告中返回的数据......这是巨大的......

```
using System;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;
using Mexico.Data;

public partial class admin_tools_Optimus : System.Web.UI.Page
{
    protected int step = 0;
    protected string[] companies = new string[260];
    protected string[] coursestrings = new string[260];
    protected int total = 0;
    protected int[] totalcourses = new int[260];

    protected void Page_Load(object sender, EventArgs e)
    {

    }

    protected void Proceed(object sender, EventArgs e)
    {
        DataSet getCompanies = SqlHelper.ExecuteDataset(ConfigurationManager.ConnectionStrings["connstr"].ConnectionString, CommandType.StoredProcedure, "Companies_All_Get");

        int counter = 0;

        foreach (DataRow dr in getCompanies.Tables[0].Rows)
        {
            lstData.Items.Add(dr["companyid"].ToString() + ": " + dr["companyname"].ToString());
            companies[counter] = dr["companyid"].ToString();
            counter++;
        }
        lblCurrentData.Text = counter.ToString() + " companies ready, click next to get all company courses.";
        total = counter;

        GetCompanies();
    }

    protected void GetCompanies()
    {
        string[,] courses = new string[260, 200];

        for (int i = 0; i < total-1; i++)
        {
            DataSet getBundles = SqlHelper.ExecuteDataset(ConfigurationManager.ConnectionStrings["connstr"].ConnectionString, CommandType.StoredProcedure, "CompanyCourses_ByCompanyID_Get_Sav", new SqlParameter("@companyid", companies[i]));

            int counter = 0;

            foreach (DataRow dr in getBundles.Tables[0].Rows)
            {
                courses[i, counter] = dr["bundleid"].ToString();
                counter++;
            }

            string allID = "";

            allID += courses[i, 0];

            for (int ii = 0; ii < counter; ii++)
            {
                allID += "," + courses[i, ii];
            }
            Response.Write(allID + " <br/>");
            coursestrings[i] = allID;
            totalcourses[i] = counter;
        }
        GetUsers();
    }

    protected void GetUsers()
    {
        for (int i = 0; i < total - 1; i++)
        {
            SqlParameter[] objPara = new SqlParameter[10];
            objPara[0] = new SqlParameter("@CompanyID", companies[i]);
            objPara[1] = new SqlParameter("@CourseID", coursestrings[i]);
            objPara[2] = new SqlParameter("@DateRangeType", 1);
            //objPara[3] = new SqlParameter("@StartDate", startDate);
            //objPara[4] = new SqlParameter("@EndDate", System.DateTime.Now.ToString("MM/dd/yyyy"));
            objPara[5] = new SqlParameter("@UserName", "");
            objPara[6] = new SqlParameter("@StartIndex", 1);
            objPara[7] = new SqlParameter("@MaximumRows", 100000);

            DataSet getData;
            getData = SqlHelper.ExecuteDataset(ConfigurationManager.ConnectionStrings["connstr"].ConnectionString, CommandType.StoredProcedure, "Course_NewReportGet_Get_Sav", objPara);

            foreach (DataRow dr in getData.Tables[0].Rows)
            {
                Response.Write("user: " + dr["userid"].ToString() + " / course: " + dr["bundleid"].ToString() + " - progress: " + dr["viewed"].ToString() + " - scored: " + dr["scored"].ToString() + "<br/><br/>");
            }
        }
    }
} 
```

页码：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Optimus.aspx.cs" Inherits="admin_tools_Optimus" Debug="true" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Untitled Page</title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:Label ID="lblCurrentData" runat="server" Text="Click next to get all Companies"/><br />
        <asp:Button ID="btnNext" runat="server" Text="Next" OnClick="Proceed" />
        <br/>
        <asp:ListBox ID="lstData" runat="server" height="300" Width="300" />
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T15:32:45.773

从 asp.net 页面与数据库通信时，您必须了解五种不同的超时：

1.  **数据库连接超时**在您的`SQLConnection`对象上设置，可能通过连接字符串。
2.  **数据库命令 timeout**在你的`SQLCommand`对象上设置。
3.  **ASP.Net 脚本超时**设置通过`Server.ScriptTimeout`.
4.  **其他 IIS 超时**由 IIS 强加在您的页面上。请参阅此链接： http: [//msdn.microsoft.com/en-us/library/ms525386.aspx ?ppud=4](http://msdn.microsoft.com/en-us/library/ms525386.aspx?ppud=4)
5.  **Internet 浏览器超时**浏览器/客户端只会等待这么长时间。你无法控制它，所以没有必要担心它，但你仍然应该知道它存在。

确保检查我列出的前 4 个。

通常我也会说 3 分钟以上的时间*来*等待页面加载。您可能有足够的数据来证明查询时间的合理性，但如果是这样的话，对于用户来说，数据太多，无法在一页中进行真正的评估。考虑拆散它。但在这种情况下，听起来您正在构建一个需要不经常运行的“报告”。虽然我仍然质疑此类报告的优点（手动处理的数据太多 - 将其转储到事实表或类似的地方以进行额外的数据挖掘），但我知道企业通常无论如何都需要它们。

此外，查看您的代码，我可以看到您可以在哪里将所有这些都写为一个大查询而不是一堆小查询。这对数据库来说会更有效率，但代价是组装结果的一些额外复杂性，但结果会运行得更快。但是对于不经常运行的东西，当您已经构建了存储过程来执行此操作时，您可能无法证明重新编写东西是合理的。

所以我会在长期运行的页面上给你一个通行证......这次。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T15:32:55.867

当您运行 sql 存储过程时，看起来超时正在发生（您的异常类型为 SqlException）。您需要增加 Sql 存储过程执行的超时时间，但我认为您不能使用 SqlHelper 类来做到这一点。

您需要使用 SqlCommand 类，并在那里设置超时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T17:21:33.350

这是一个非常糟糕的代码重用示例。与其重用使您遍历所需的所有输入变量的存储过程，不如编写一个新的基于集合的过程，该过程根据连接选择信息。它会快得多（当然假设您已经正确索引）。在访问数据库时，如果可以使用基于集合的替代方案，您不希望通过循环或游标执行某些操作。

# database - View 会提高性能吗？

> ID：848629
> 
> 赞同：4
> 
> 时间：2009-05-11T15:25:42.743
> 
> 标签：database, performance

我有六个表将加入许多查询。如果通过加入所有表创建的视图会提高性能？有没有其他方法可以提高性能？我使用 oracle 作为数据库，所有连接的列都被索引。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T15:32:35.040

视图本身不会提高性能。话虽如此，根据您使用的数据库引擎，您可以对视图执行一些操作。

在 SQL Server 中，您可以在视图上放置索引（假设视图符合各种要求）。这可以大大提高性能。

您使用的是什么 DBMS？

**编辑**

在 oracle 中，您可以创建一个物化视图。这是一个可以帮助您入门的链接。我不知道Oracle，所以我真的只能提供链接。

[http://searchoracle.techtarget.com/expert/KnowledgebaseAnswer/0,289625,sid41_gci909605,00.html](http://searchoracle.techtarget.com/expert/KnowledgebaseAnswer/0,289625,sid41_gci909605,00.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T15:34:50.340

加入多个表时，正确的索引是提高性能的关键。

添加视图可能会提高性能，如果它被索引，或者可能会降低性能，如果它不是。很大程度上取决于您的数据库设计和视图所基于的实际查询。视图要做的事情是确保使用的每个人都在查看相同的六张表。这取决于查询（并非所有基于视图的查询实际上可能需要所有六个表）。

我首先要看的是您的外键字段当前是否已编入索引。主键在创建时被赋予一个索引，但外键没有。由于它们在连接中使用，因此应该对它们进行索引以提高性能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T15:36:01.540

应该注意视图是如何工作的：它们在运行时运行视图查询。它们没有预先缓存，因此没有索引，它们本质上是函数调用。

大量使用表和视图上的索引来提高性能。不要枪杀它们，但精心设计的索引可以不分昼夜地影响您的表现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T15:51:58.113

它还取决于数据库。如果 RDMS 不根据您的条件分析基础查询，则它可能根本无法正常执行。

大多数当前的 RDMS 会进行查询重写（我认为 SQL Server 的一些早期版本，如 6 或 7，没有这样做），它会根据您的查询拉开视图，然后根据其优化重写整个事情技巧。

使用视图的各种查询迭代可以缓存它们的计划并以这种方式获得一些性能。

因此，据我了解，至少在理论上（取决于数据库优化器），使用视图与编写整个查询没有什么不同。

# php - DomDocument 未能为 RSS 提要添加“链接”元素

> ID：848635
> 
> 赞同：0
> 
> 时间：2009-05-11T15:26:33.740
> 
> 标签：php, xml, rss, domdocument

我正在尝试使用 DomDocument 在 PHP 中创建一个 RSS 提要，但每次我尝试创建一个像[http://domain.com](http://domain.com)这样的节点时，脚本都会失败

```
$oDomDocument = new DOMDocument( "1.0", "iso-8859-1" );

// Create the root now
$oRootNode = $oDomDocument->createElement( "rss" );
$oRootNode->setAttribute( "version", "2.0" );
$oDomDocument->appendChild( $oRootNode );

// Create the channel node
$oChannelNode = $oDomDocument->createElement( "channel" );
$oRootNode->appendChild( $oChannelNode );

// Add site details
$oChannelNode->appendChild( $oDomDocument->createElement( "title", "Site Title" ) );
$oChannelNode->appendChild( $oDomDocument->createElement( "link", "http://google.com" ) );
$oChannelNode->appendChild( $oDomDocument->createElement( "description", "This is a description" ) );
$oChannelNode->appendChild( $oDomDocument->createElement( "language", "en-us" ) ); 
```

我收到以下错误..

XML 解析错误：标签不匹配。预期的： 。位置：[http://daddydonkey/feed.rss](http://daddydonkey/feed.rss) 第 4 行，第 58 列：这是一个描述 ---------------------------- -----------------------------^

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-30T11:22:49.627

I tried your PHP code and it works.

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-06-06T04:02:57.613

您编写的代码示例运行并生成有效的 XML，而不会出现您提供的错误。也许您的样本在粘贴时被截断了？

# iphone - Objective-C 2.0：class_copyPropertyList()，如何列出类别中的属性

> ID：848636
> 
> 赞同：19
> 
> 时间：2009-05-11T15:26:38.730
> 
> 标签：iphone, objective-c, cocoa

我尝试列出 Objective-C 类的所有属性，如[Objective-C 2.0 运行时编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html)中所述：

```
id LenderClass = objc_getClass("UIView");
unsigned int outCount, i;
objc_property_t *properties = class_copyPropertyList(LenderClass, &outCount);
for (i = 0; i < outCount; i++) {
    objc_property_t property = properties[i];
    fprintf(stdout, "%s %s\n", property_getName(property), property_getAttributes(property));
} 
```

但这仅列出了三个属性：

```
userInteractionEnabled Tc,GisUserInteractionEnabled
layer T@"CALayer",R,&,V_layer
tag Ti,V_tag 
```

查看 UIView.h 的头文件，这些是在类中直接声明的三个属性。其他 UIView 属性是通过类别添加的。

如何获取类的所有属性，包括来自类别的属性？

我用 iPhone 模拟器（iPhone SDK 2.2.1）试过这个，顺便说一句。（如果这很重要）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-11T20:51:13.413

根据我在这里的测试，使用`class_copyPropertyList`. 看起来您在 UIView 上看到的属性仅*被描述*为公共标头中的属性，而不是在构建 UIKit 本身时实际声明为这样。可能他们采用了属性语法来更快地创建公共标头。

作为参考，这是我的测试项目：

```
#import <Foundation/Foundation.h>
#import <objc/runtime.h>

@interface TestClass : NSObject
{
    NSString * str1;
    NSString * str2;
}
@property (nonatomic, copy) NSString * str1;
@end

@interface TestClass (TestCategory)
@property (nonatomic, copy) NSString * str2;
@end

@implementation TestClass
@synthesize str1;
@end

@implementation TestClass (TestCategory)

// have to actually *implement* these functions, can't use @synthesize for category-based properties
- (NSString *) str2
{
    return ( str2 );
}

- (void) setStr2: (NSString *) newStr
{
    [str2 release];
    str2 = [newStr copy];
}

@end

int main (int argc, const char * argv[])
{
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];

    unsigned int outCount, i;
    objc_property_t *properties = class_copyPropertyList([TestClass class], &outCount);
    for (i = 0; i < outCount; i++) {
        objc_property_t property = properties[i];
        fprintf(stdout, "%s %s\n", property_getName(property), property_getAttributes(property));
    }

    [pool drain];
    return 0;
} 
```

这是输出：

```
str2 T@"NSString",C
str1 T@"NSString",C,Vstr1 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-06-27T15:51:36.160

是的，class_copyPropertyList 函数确实返回类别中定义的属性。

这里发生的事情是，它只返回在给定类级别定义的属性 - 所以您只看到 UIView 中定义的三个属性，而没有看到 UIResponder 和 NSObject 祖先中定义的属性（普通或类别）。

以实现全继承上市；您必须通过 Class.superclass 引用循环遍历祖先并聚合来自 class_copyPropertyList 的结果。然后，您将看到，例如，在 UIKits Accessibility 类别中为 NSObject 定义的各种属性。

实际上，我来这里是为了寻找一种从这些结果中*排除*类别中定义的属性的方法！

# c# - 有没有办法使用通用 DbCommand 进行异步更新？

> ID：848637
> 
> 赞同：1
> 
> 时间：2009-05-11T15:26:46.140
> 
> 标签：c#, oracle, ado.net, idbcommand, oraclecommand

当使用通用 DbCommand 执行更新时，如果正在更新的行被锁定，它将无限期挂起。

使用的底层连接是 Devart 的 Oracle 提供者，Devart.Data.Oracle.OracleConnection

设置 DbCommand.CommandTimeOut 完全没有效果，更新永远不会超时。

DbCommand 没有实现 BeginExecuteNonQuery，所以似乎没有办法以异步方式使用 DbConnection/DbCommand。

我可以通过使用 Devart 的 OracleCommand 和 BeginExecuteQuery 来解决这个问题，但确实如此。

有没有办法以通用的方式做到这一点？

oracle 特定逻辑的简化代码：

```
public bool TestAsyncUpdateRowOracle(string key, OracleConnection con, string sql)
{
    const int timoutIterations=10;
    bool updateOk=false;
    OracleCommand cmd = new OracleCommand(sql, con);
    cmd.Parameters.Add(Util.CreateParameter(dbSrcFactory, DbType.String, 16, "key"));
    cmd.CommandType = CommandType.Text;
    cmd.Parameters[0].Value = key.ToString();

    IAsyncResult result = cmd.BeginExecuteNonQuery();
    int asyncCount = 0;
    while (!result.IsCompleted)
    {
        asyncCount++;
        if (asyncCount > timeoutIterations)
        {
            break;
        }
        System.Threading.Thread.Sleep(10);
    }

    if (result.IsCompleted)
    {
        int rowsAffected = cmd.EndExecuteNonQuery(result);
        Console.WriteLine("Done. Rows affected: " + rowsAffected.ToString());
    }
    else
    {
        try
        {
            cmd.Cancel();
            Console.WriteLine("Update timed out, row is locked");

        }
        catch (Exception e)
        {
            Console.WriteLine(e.ToString());
            Console.WriteLine("Unable to cancel update");
        }
    }
    cmd.Dispose();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-15T23:08:22.663

遗憾的是，不，ADO.NET 中没有具有异步操作的接口或基类（例如 BeginExecuteNonQuery / EndExecuteNonQuery）。它们只出现在极少数的 ADO.NET 提供程序实现中。（SqlClient，Devart Oracle）。

也就是说，如果在设置 CommandTimeOut 时它没有超时，我认为这是提供程序中的一个错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:58:00.513

您可以使用 NOWAIT 选项发出 LOCK TABLE 吗？如果锁定失败，这将立即将控制权返回给您并显示错误。例如：

```
LOCK TABLE employees
   IN EXCLUSIVE MODE 
   NOWAIT; 
```

有几种方法可以锁定表。[这](http://download-east.oracle.com/docs/cd/B13789_01/appdev.101/b10795/adfns_sq.htm#1024837)是开发人员关于锁定的指南部分。[这](http://download.oracle.com/docs/cd/B14117_01/server.101/b10759/statements_9015.htm#sthref6976)是 LOCK TABLE 命令的 SQL 参考页面。

另一种选择是使用 SELECT .. FOR UPDATE NOWAIT 语句来锁定您将要更新的行。除了更新语句之外，这两个选项都需要向 Oracle 发出其他命令。

# linq - 使用 LINQ 左连接

> ID：848640
> 
> 赞同：8
> 
> 时间：2009-05-11T15:27:19.823
> 
> 标签：linq, lambda, left-join

有人可以给我一个如何使用 LINQ/lambda 表达式执行左连接操作的例子吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:36:16.563

MSDN 上的[LINQ to SQL 示例页面](http://msdn.microsoft.com/en-us/vbasic/bb737929.aspx#grpjoinleftout)提供了如何完成此操作的示例。LINQ to Objects 的代码应该几乎相同。

这里的关键是调用`DefaultIfEmpty`.

```
Dim q = From e In db.Employees _
        Group Join o In db.Orders On e Equals o.Employee Into ords = Group _
        From o In ords.DefaultIfEmpty _
        Select New With {e.FirstName, e.LastName, .Order = o} 
```

如果您需要帮助将其转换为 C#，请询问。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T15:37:25.577

这是LINQ[中的左连接示例。](http://geekswithblogs.net/AzamSharp/archive/2008/04/07/121103.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-28T18:33:25.547

例如：

```
IQueryable<aspnet_UsersInRole> q = db.aspnet_Roles
                    .Select(p => p.aspnet_UsersInRoles
                        .SingleOrDefault(x => x.UserId == iduser)); 
```

将为您提供来自 asp.net 成员资格的角色列表，其中包含与指定用户不匹配的空值（iduser 键）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-18T03:43:44.780

我发现我喜欢的方式是`OuterCollection.SelectMany()`与`InnerCollection.DefaultIfEmpty()`. 您可以使用“C# 语句”模式在[LINQPad](http://www.linqpad.net/)中运行以下命令。

```
var teams = new[] 
    { 
        new { Id = 1, Name = "Tigers" }, 
        new { Id = 2, Name = "Sharks" }, 
        new { Id = 3, Name = "Rangers" },
    };

var players = new[] 
    { 
        new { Name = "Abe", TeamId = 2}, 
        new { Name = "Beth", TeamId = 4}, 
        new { Name = "Chaz", TeamId = 1}, 
        new { Name = "Dee", TeamId = 2}, 
    };

// SelectMany generally aggregates a collection based upon a selector: from the outer item to
//  a collection of the inner item.  Adding .DefaultIfEmpty ensures that every outer item
//  will map to something, even null.  This circumstance makes the query a left outer join.
// Here we use a form of SelectMany with a second selector parameter that performs an
//  an additional transformation from the (outer,inner) pair to an arbitrary value (an
//  an anonymous type in this case.)
var teamAndPlayer = teams.SelectMany(
    team => 
        players
        .Where(player => player.TeamId == team.Id)
        .DefaultIfEmpty(),
    (team, player) => new 
        { 
             Team = team.Name, 
             Player = player != null ? player.Name : null 
        });

teamAndPlayer.Dump();

// teamAndPlayer is:
//     { 
//         {"Tigers", "Chaz"},
//         {"Sharks", "Abe"},
//         {"Sharks", "Dee"},
//         {"Rangers", null}
//     } 
```

在对此进行试验时，我发现有时您可以`player`在匿名类型的实例化中省略 null 检查。我认为在数据库上使用 LINQ-to-SQL 时就是这种情况（而不是这里的这些数组，我认为这使它成为 LINQ-to-objects 或其他东西。）我认为省略 null 检查在 LINQ 中有效-to-SQL 因为查询被翻译成 SQL `LEFT OUTER JOIN`，它直接跳到将 null 与外部项目连接起来。（请注意，匿名对象的属性的值必须可以为空；因此，如果您想安全地包含一个`int`，例如，您需要类似：`new { TeamId = (int?)player.TeamId }`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-20T21:24:29.967

好吧，我试图重现著名的左连接，其中 b 键为空，我得到的结果是这个扩展方法（有一点想象力，你可以修改它来做一个左连接）：

```
 public static class extends
{
    public static IEnumerable<T> LefJoinBNull<T, TKey>(this IEnumerable<T> source, IEnumerable<T> Target, Func<T, TKey> key)
    {
        if (source == null)
            throw new ArgumentException("source is null");

        return from s in source
               join j in Target on key.Invoke(s) equals key.Invoke(j) into gg
               from i in gg.DefaultIfEmpty()
               where i == null
               select s;
    }
} 
```

# objective-c - Objective-C 中是否存在强类型集合？

> ID：848641
> 
> 赞同：143
> 
> 时间：2009-05-11T15:27:22.350
> 
> 标签：objective-c, generics, data-structures, collections, strong-typing

我是 Mac/iPhone 编程和 Objective-C 的新手。在 C# 和 Java 中，我们有“泛型”，即其成员只能是声明类型的集合类。例如，在 C#

`Dictionary<int, MyCustomObject>`

只能包含整数键和 MyCustomObject 类型的值。Objective-C 中是否存在类似的机制？

* * *

## 回答 #1

> 赞同：214
> 
> 时间：2015-06-08T21:58:40.290

在 Xcode 7 中，Apple 向 Objective-C 引入了“轻量级泛型”。在 Objective-C 中，如果类型不匹配，它们将生成编译器警告。

```
NSArray<NSString*>* arr = @[@"str"];

NSString* string = [arr objectAtIndex:0];
NSNumber* number = [arr objectAtIndex:0]; // Warning: Incompatible pointer types initializing 'NSNumber *' with an expression of type 'NSString *' 
```

而在 Swift 代码中，它们会产生编译器错误：

```
var str: String = arr[0]
var num: Int = arr[0] //Error 'String' is not convertible to 'Int' 
```

轻量级泛型旨在与 NSArray、NSDictionary 和 NSSet 一起使用，但您也可以将它们添加到您自己的类中：

```
@interface GenericsTest<__covariant T> : NSObject

-(void)genericMethod:(T)object;

@end

@implementation GenericsTest

-(void)genericMethod:(id)object {}

@end 
```

Objective-C 的行为会像以前一样，带有编译器警告。

```
GenericsTest<NSString*>* test = [GenericsTest new];

[test genericMethod:@"string"];
[test genericMethod:@1]; // Warning: Incompatible pointer types sending 'NSNumber *' to parameter of type 'NSString *' 
```

但 Swift 会完全忽略通用信息。（在 Swift 3+ 中不再适用。）

```
var test = GenericsTest<String>() //Error: Cannot specialize non-generic type 'GenericsTest' 
```

> 除了这些 Foundation 集合类之外，Swift 忽略了 Objective-C 轻量级泛型。任何其他使用轻量级泛型的类型都被导入到 Swift 中，就好像它们没有参数化一样。

[与 Objective-C API 交互](https://developer.apple.com/library/prerelease/ios/documentation/Swift/Conceptual/BuildingCocoaApps/InteractingWithObjective-CAPIs.html#//apple_ref/doc/uid/TP40014216-CH4-ID173)

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2009-05-11T15:32:20.437

> 这个答案已经过时，但仍然具有历史价值。从 Xcode 7 开始，Connor 在 15 年 6 月 8 日的回答更加准确。

* * *

不，Objective-C 中没有泛型，除非您想在自己的自定义集合类中使用 C++ 模板（我强烈反对）。

Objective-C 具有动态类型作为特性，这意味着运行时不关心对象的类型，因为所有对象都可以接收消息。当您将对象添加到内置集合时，它们只是被视为 type `id`。但别担心，像往常一样向那些对象发送消息；它会正常工作*（当然，除非集合中的一个或多个对象不响应您发送的消息）*。

Java 和 C# 等语言需要泛型，因为它们是强大的静态类型语言。与 Objective-C 的动态类型功能完全不同。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-11-19T23:31:45.363

不，但是为了更清楚，你可以用你想要存储的对象的类型来评论它，当你现在需要在 Java 1.4 中编写一些东西时，我已经看到过几次这样做了）例如：

```
NSMutableArray* /*<TypeA>*/ arrayName = .... 
```

或者

```
NSDictionary* /*<TypeA, TypeB>*/ dictionaryName = ... 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-06-09T16:30:22.020

[这是在 Xcode 7 中发布的](https://developer.apple.com/library/prerelease/ios/documentation/DeveloperTools/Conceptual/WhatsNewXcode/Articles/xcode_7_0.html)（终于！）

请注意，在 Objective C 代码中，它只是一个编译时检查；仅将错误的类型放入集合或分配给类型化的属性不会出现运行时错误。

宣布：

```
@interface FooClass <T> : NSObject
@property (nonatomic) T prop;
@end 
```

采用：

```
FooClass<NSString *> *foo = [[FooClass alloc] init];
NSArray<FooClass<NSString *> *> *fooAry = [NSArray array]; 
```

小心那些`*`s。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-11T15:29:42.923

Objective-C 中没有泛型。

[从文档](http://developer.apple.com/documentation/Cocoa/Conceptual/Collections/Articles/Arrays.html)

> 数组是对象的有序集合。Cocoa 提供了几个数组类，NSArray、NSMutableArray（NSArray 的子类）和 NSPointerArray。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-06-08T22:13:25.020

Apple 在 XCode 7 中为 ObjC 添加了泛型：

```
@property NSArray<NSDate *>* dates;
- (NSArray<NSDate *> *)datesBeforeDate:(NSDate *)date;
- (void)addDatesParsedFromTimestamps:(NSArray<NSString *> *)timestamps; 
```

见这里： [https ://developer.apple.com/library/prerelease/mac/documentation/Swift/Conceptual/BuildingCocoaApps/WorkingWithCocoaDataTypes.html#//apple_ref/doc/uid/TP40014216-CH6-ID61](https://developer.apple.com/library/prerelease/mac/documentation/Swift/Conceptual/BuildingCocoaApps/WorkingWithCocoaDataTypes.html#//apple_ref/doc/uid/TP40014216-CH6-ID61)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-03-14T19:25:11.960

通用 NSArrays 可以通过子类化来实现`NSArray`，并用更严格的方法重新定义所有提供的方法。例如，

```
- (id)objectAtIndex:(NSUInteger)index 
```

将不得不重新定义

```
@interface NSStringArray : NSArray 
```

作为

```
- (NSString *)objectAtIndex:(NSUInteger)index 
```

一个 NSArray 只包含 NSStrings。

创建的子类可以用作替代品，并带来许多有用的功能：编译器警告、属性访问、更好的代码创建和 Xcode 中的补全。所有这些都是编译时的特性，不需要重新定义实际的实现——NSArray 的方法仍然可以使用。

可以将其自动化并将其归结为仅两个语句，这使其接近支持泛型的语言。我使用[WMGenericCollection](https://github.com/w-m/WMGenericCollection)创建了一个自动化，其中模板作为 C 预处理器宏提供。

导入包含宏的头文件后，您可以创建一个带有两条语句的通用 NSArray：一条用于接口，一条用于实现。您只需提供要存储的数据类型和子类的名称。WMGenericCollection 为`NSArray`、`NSDictionary`和`NSSet`以及它们的可变对应物提供了这样的模板。

一个例子：`List<int>`可以通过一个名为 的自定义类来实现`NumberArray`，它是使用以下语句创建的：

```
WMGENERICARRAY_INTERFACE(NSNumber *, // type of the value class
                         // generated class names
                         NumberArray, MutableNumberArray) 
```

创建`NumberArray`后，您可以在项目中的任何地方使用它。它缺少 的语法`<int>`，但您可以选择自己的命名方案将它们标记为类作为模板。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-08-01T16:47:21.633

看一眼：

[https://github.com/tomersh/Objective-C-Generics](https://github.com/tomersh/Objective-C-Generics)

通过重新利用协议检查机制，它似乎是一种穷人的泛型。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-06-09T14:54:23.333

现在梦想成真了——从今天开始，Objective-C 中就有泛型（感谢 WWDC）。这不是玩笑——在Swift的[官方页面上：](https://developer.apple.com/swift/)

> 新的语法功能让您可以编写更具表现力的代码，同时提高整个语言的一致性。SDK 采用了新的 Objective-C 特性，例如泛型和可空性注释，以使 Swift 代码更加干净和安全。这里只是 Swift 2.0 增强功能的一个示例。

和证明这一点的图像：![Objective-C 泛型](https://i.stack.imgur.com/UkE24.png)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-06-16T12:07:32.920

只想跳到这里。我[在这里](http://drekka.ghost.io/objective-c-generics/)写了一篇关于泛型的博客文章。

我想贡献的是**泛型可以添加到任何类**中，而不仅仅是 Apple 指示的集合类。

我已经成功地将它们添加到各种类中，因为它们的工作方式与 Apple 的集合完全相同。IE。编译时检查、代码完成、启用强制类型转换等。

享受。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2012-09-28T18:31:34.807

Apple 和 GNUStep 框架提供的 Collections 类是半通用的，因为它们假定给定对象，有些是可排序的，有些是响应某些消息的。对于浮点数、整数等原语，所有的 C 数组结构都是完整的并且可以使用，并且有特殊的包装器对象供它们在通用集合类中使用（例如 NSNumber）。此外，可以对 Collection 类进行子类化（或通过类别进行专门修改）以接受任何类型的对象，但您必须自己编写所有类型处理代码。消息可以发送到任何对象，但如果它不适合该对象，则应返回 null，或者应将消息转发到适当的对象。真正的类型错误应该在编译时被捕获，而不是在运行时。在运行时，它们应该被处理或忽略。最后，Objc 提供运行时反射工具来处理棘手的情况和消息响应、特定类型和服务，可以在对象被发送消息或放入不适当的集合之前对其进行检查。请注意，不同的库和框架采用不同的约定来确定其对象在发送没有代码响应的消息时的行为方式，因此 RTFM。除了玩具程序和调试版本之外，大多数程序不应该崩溃，除非它们真的搞砸了并试图将坏数据写入内存或磁盘，执行非法操作（例如除以零，但你也可以抓住它），或者访问禁止使用系统资源。Objective-C 的活力和运行时间允许事情优雅地失败，应该内置到你的代码中。（提示）如果您在函数的通用性方面遇到问题，尝试一些特异性。用特定类型重写函数并让运行时选择（这就是它们被称为选择器的原因！）在运行时适当的成员函数。

```
Example:
    -(id) sort (id) obj;  // too generic. catches all.
     // better
    -(id) sort: (EasilySortableCollection*) esc;
    -(id) sort: (HardToSortCollection*) hsc; 
    ...
    [Sorter  sort: MyEasyColl];
    [Sorter  sort: MyHardColl]; 
```

# php - 有人可以查看这段简短的代码吗？

> ID：848643
> 
> 赞同：-2
> 
> 时间：2009-05-11T15:27:49.463
> 
> 标签：php, mysql

应该发生的是，将一行插入到表中，然后通过比较该特定条目的名称和姓氏来选择该行的 id。

然后将返回的 id 插入到另一个表中：

```
$result = false;

$result = mysql_query("INSERT INTO `reunie` (`naam`, `van`,`nooiensvan`, `selfoon`, `email`, `bywoon`, `metgesel_naam`, `spesifieke_onderwysers`, `spesifieke_musiek`, `bydrae`, `voorstelle`) VALUES ('$naam','$van','$nooiensvan','$selfoon','$email','$bywoon','$metgesel','$spesifiekeOnderwysers','$musiek','$bydrae','$voorstelle')") or die(mysql_error());

// sleep in order for query to finish
while ($result === false) {
   sleep(1);
}

$result = mysql_query("SELECT `id` FROM `reunie` WHERE `naam` = '$naam' AND `van` = '$van' ORDER BY `id` DESC LIMIT 1") or die(mysql_error()); 
```

// 编辑

谢谢大家的重要评论。谢谢你教我几个重要的点。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T15:37:36.030

尝试：

```
$name = mysql_real_escape_string($name);
$van = mysql_real_escape_string($van);
$nooiensvan = mysql_real_escape_string($nooiensvan);
$selfoon = mysql_real_escape_string($selfoon);
$email = mysql_real_escape_string($email);
$bywoon = mysql_real_escape_string($bywoon);
$metgesel = mysql_real_escape_string($metgesel);
$spesifiekeOnderwysers = mysql_real_escape_string($spesifiekeOnderwysers);
$musiek = mysql_real_escape_string($musiek);
$bydrae = mysql_real_escape_string($bydrae);
$voorstelle = mysql_real_escape_string($voorstelle);
$query = <<<END
INSERT INTO reunie
(naam, van, nooiensvan, selfoon, email, bywoon, metgesel_naam,
spesifieke_onderwysers, spesifieke_musiek, bydrae, voorstelle)
VALUES
('$naam','$van','$nooiensvan','$selfoon','$email','$bywoon','$metgesel',
'$spesifiekeOnderwysers','$musiek','$bydrae','$voorstelle')
END;
$result = mysql_query($query) or die(mysql_error() . ' - ' . $query);
$id = mysql_insert_id(); 
```

是的，所有这些 mysql_real_escape_string() 都**非常重要**。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T15:36:54.313

您应该使用[`mysql_insert_id`](http://us.php.net/manual/en/function.mysql-insert-id.php)而不是选择来获取 ID。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T15:37:05.173

你不是想在这里重新发明轮子吗？

为什么不使用

```
$result = mysql_query( "INSERT ... " );
$new_id = mysql_insert_id(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:02:43.260

```
// sleep in order for query to finish

while ($result === false) {
   sleep(1);
} 
```

我喜欢如果 $result 真的是假的，脚本就会停止

# java - 用 Java 发送电子邮件？

> ID：848645
> 
> 赞同：4
> 
> 时间：2009-05-11T15:28:20.773
> 
> 标签：java, email

谁能推荐一个用Java发送电子邮件的库？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T15:34:59.700

尝试[共享邮件](http://commons.apache.org/email/)。它建立在[Java Mail API](http://java.sun.com/products/javamail/)之上，但使用起来更加简单。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T15:35:26.050

您可能还想查看[Apache Commons 电子邮件库](http://commons.apache.org/email/)。它功能强大且易于使用。

您可以按照以下方式做一些事情：

```
import org.apache.commons.mail.SimpleEmail;
...
String[] recipients = {"a@foo.com", "b@foo.com"};

SimpleEmail email = new SimpleEmail();
email.setHostName("mail.myserver.com");

for (int i = 0; i < recipients.length; i++)
{
    email.addTo(recipients[i]);
}

email.setFrom("me@apache.org", "Me");
email.setSubject("Test message");
email.setMsg("This is a simple test of commons-email");
email.send(); 
```

示例代码取自 Commons Email 示例页面，经过修改以显示添加多个收件人。希望有帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-11T15:34:26.860

Spring 也有一个邮件包装层：

[http://static.springframework.org/spring/docs/2.5.6/reference/mail.html](http://static.springframework.org/spring/docs/2.5.6/reference/mail.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-05T06:50:03.580

[我认为使用 JavaMail API 更好，您可以从以下教程Fundamentals of the JavaMail API](http://java.sun.com/developer/onlineTraining/JavaMail/contents.html)中获得一些基本知识

# c# - Emacs typeover 骨架对插入可能

> ID：848647
> 
> 赞同：7
> 
> 时间：2009-05-11T15:29:19.333
> 
> 标签：c#, java, emacs

在 Eclipse 中，编辑 Java 代码，如果我键入一个 open-paren，我会得到一对 parens。如果我然后“输入”第二个括号，它不会插入额外的括号。我如何在emacs中获得它？

Eclipse 编辑器足够聪明，可以知道，当我键入右括号时，我刚刚完成了我开始的工作。光标前进超过右括号。如果我然后输入一个分号，同样的事情：它只是覆盖了分号，我没有得到其中两个。

在 emacs、java-mode 或 csharp-mode 中，如果我将 open-paren 绑定到 skeleton-pair-insert-maybe，我会得到一个 open-close paren 对，这很好。但是，如果我“输入”关闭括号，我会得到两个关闭括号。

有没有办法教emacs不要在紧接在前面的skeleton-pair-insert-maybe之后插入close paren？如果这是可能的，那么一些类似的智能如何避免分号加倍呢？

我问的是parens，但这同样适用于双引号、花括号、方括号等。任何用骨架对插入可能插入的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T17:48:38.407

[这篇文章](http://cmarcelo.wordpress.com/2008/04/26/a-little-emacs-experiment/)展示了如何做你想做的事。作为奖励，它还显示了如何设置它，以便如果您在开始字符后立即退格，它也会删除光标后的结束字符。

更新：

自从我发布了这个答案后，我发现[Autopair](http://code.google.com/p/autopair/)对于这个用例来说是一个非常完美的系统。我一直在使用它并且很喜欢它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T15:54:27.430

为了总结我所做的，我查看了这篇文章，并从中得到了我想要的。我最终得到的更简单，因为我没有他的额外要求。

我使用了这两个新定义：

```
(defvar cheeso-skeleton-pair-alist
  '((?\) . ?\()
    (?\] . ?\[)
    (?" . ?")))

(defun cheeso-skeleton-pair-end (arg)
  "Skip the char if it is an ending, otherwise insert it."
  (interactive "*p")
  (let ((char last-command-char))
    (if (and (assq char cheeso-skeleton-pair-alist)
             (eq char (following-char)))
        (forward-char)
      (self-insert-command (prefix-numeric-value arg))))) 
```

然后在我的 java-mode-hook 中，我以这种方式绑定了近括号和闭括号：

```
(local-set-key (kbd ")") 'cheeso-skeleton-pair-end)
(local-set-key (kbd "]") 'cheeso-skeleton-pair-end) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:14:02.880

我使用 paredit-mode，它可以做到这一点以及更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T17:48:41.387

[ParEdit](http://www.emacswiki.org/emacs/ParEdit)听起来像是可以处理您需要的括号部分，但需要注意的是它是为 Common Lisp 和 Scheme 设计的。[Steve Yegge 提到了用于 emacs Java 开发的 JDEE](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fsteve.yegge.googlepages.com%2Fmy-dot-emacs-file&ei=CGIISquGHZTAM5Hd6aID&usg=AFQjCNEP7WazHypzy4GtNKEijGulheVprA)，但我不能从个人经验中说明这一点，而且我找不到任何关于结构化编辑的文档。

# sharepoint - ONET.xml 中的“ONET”代表什么？

> ID：848653
> 
> 赞同：2
> 
> 时间：2009-05-11T15:30:40.580
> 
> 标签：sharepoint

在 SharePoint 中，创建自定义网站定义时通常需要一个名为 ONET.xml 的文件。出于好奇，有人知道 ONET 代表什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T15:40:09.193

它代表办公网。

[根据此博客条目。](http://greggalipeau.wordpress.com/category/sharepoint/wspbuilder/)

> 附带说明：我听说 Onet 代表 Office Net。

# delphi - Delphi QuantumGrid GetSelectedRowIndex 排序后

> ID：848655
> 
> 赞同：1
> 
> 时间：2009-05-11T15:31:04.463
> 
> 标签：delphi, devexpress

我有 D2006，我在一个项目中使用 DevExpress QuantumGrid 6。我在未绑定模式下使用它。我有几行，当用户选择一行并单击一个按钮时，我需要触发一个动作。当网格未按用户排序时，这可以正常工作。我使用此代码来了解用户选择的行：

```
index := cxMainTable.DataController.GetSelectedRowIndex(0);
cxMainTable.DataController.Values[index, 0]; 
```

但是，当用户通过单击列标题对网格进行排序时，返回的索引正好适合当前显示的顺序，但第二行返回的值是您在网格未排序时所期望的值。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:09:27.303

您必须区分[记录和行](http://www.devexpress.com/Support/Center/p/Q33881.aspx)。

也许`TableView.DataController.FocusedRecordIndex`是你想要的？

# sql-server-2005 - SQL Server 2005 Report Builder 如何动态更改数据源？

> ID：848656
> 
> 赞同：4
> 
> 时间：2009-05-11T15:31:11.313
> 
> 标签：sql-server-2005, reporting-services, reportbuilder

我们需要能够动态更改报表生成器中构建/管理的报表的数据源。基本上它的数据库结构相同，但每个客户端都有自己的数据库，因此根据 ClientID 的参数，它需要动态转到相应的数据库。

有人对此有什么好的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T15:46:55.670

您可以创建一个存储过程，根据传递的参数动态地从不同的数据库中提取数据，而不是动态地更改数据源（我什至不确定这是否可能）。

```
CREATE PROCEDURE ProcedureName 
    -- Add the parameters for the stored procedure here
    @clientName nvarchar(100)
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    SET NOCOUNT ON;

    -- Insert statements for procedure here

declare @sql nvarchar(max)

set @sql='select * from ' + @clientName + '.dbo.Products'

exec(@sql)

END
GO 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:27:09.863

这类似于将报表模型部署到服务器的问题。您可以通过采用如下所述的架构来完成（我认为）您需要的东西。

*   在报告服务器上为每个客户端创建一个文件夹，. 适当设置权限，以便客户端无法运行彼此的报告。在此文件夹下放置一个名为“数据源”或类似名称的文件夹，并将所有报告的数据源放在此文件夹中。这意味着任何以编程方式重新连接数据源的工具都知道数据源相对于报表的确切位置。请注意，数据源还应具有特定的、可预测的名称。

*   编写一个小的 .net 应用程序来部署报表、数据源和报表模型。这比听起来容易，因为 SSRS 导出了一个相当简单的 Web 服务来执行此操作。

*   IronPython 是一个很好的方法来试验这个 Web 服务并弄清楚如何驱动它。为此，您需要使用 WSDL 包装器生成器 (WSDL.EXE IIRC) 并制作一些 C# 存根。编译存根并将库注册到 IronPython。然后使用交互式 shell 来试验 Web 服务 API。如果您有这种倾向，请用 C# 重写。

*   还有一个与 SSRS 捆绑在一起的工具，称为 rs.exe，它获取一个 VB.net 文件，对其进行顶部和尾部并编译结果，以便您可以使用 VB.net 编写与报表服务器一起使用的脚本。

此 .net 应用程序将部署报告并连接数据源。对其进行设置，使其可以部署在任何给定文件夹下。当您设置客户时，请在您创建他们的文件夹时设置的“数据源”文件夹下设置他们的数据源。您可以以编程方式部署报告文件，并通过几行代码将其连接到数据源。在客户端文件夹下部署报告。

通过命令行下的服务器名称和目录进行参数化，应用程序可以部署报告并将其数据源连接到“数据源”文件夹下的数据源。报告中对数据源的引用可以具有相对路径，因此报告可以很高兴地不知道它们在层次结构中的位置。

将其包装在批处理文件中或使用其他方式自动部署整套报告。作为奖励，这使得部署到测试环境变得容易。对于额外的奖励积分，您可以扩展应用程序，以便它可以遍历客户根目录下的任意目录并下载它在那里找到的报告。

部署报表模型是相似的，但有一个额外的变化。报表模型的属性之一是依赖于它的报表列表。您将需要捕获此列表（同样，这很容易以编程方式完成）并将报表重新连接到数据源（报表模型***是***这些报表的数据源）。

这允许您部署（或克隆，如果您已实现下载功能）任何报告套件，并以编程方式将它们部署到服务器上特定于客户端的目录。它还为您提供了一个简单的安全模型，因为您可以通过客户端的根目录保护对报告的访问。

# wpf - 如何让 WPF DataBinding-to-an-object 工作

> ID：848662
> 
> 赞同：2
> 
> 时间：2009-05-11T15:32:40.220
> 
> 标签：wpf, xaml, data-binding

在以下示例中，我通过 ObjectDataProvider 将 XAML 绑定到静态对象。当用户更改信息时，我希望它自动反映在 XAML 中。

我不明白的是：

*   我如何使对象永久化？我必须创建一个单身人士吗？在点击事件中，如何访问“正在编辑的对象”
*   最终，我当然希望从读取 XML 文件或 Web 服务的模型中检索数据，当然我希望**我的 ViewModel 每隔一秒左右检查一次我的模型，以查看数据是否已更改并将其反映在 XAML 上**.

我如何从这里到达那里：

**XAML：**

```
<Window x:Class="TestBinding99382.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:TestBinding99382"
    Title="Window1" Height="300" Width="300">

    <Window.Resources>
        <ObjectDataProvider 
             x:Key="DataSourceCustomer" 
             ObjectType="{x:Type local:Customer}" MethodName="GetCustomer"/>

        <Style x:Key="DataRowStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
            <Setter Property="Margin" Value="0 10 0 0"/>
            <Setter Property="DataContext" 
                    Value="{StaticResource DataSourceCustomer}"/>
            <Setter Property="DockPanel.Dock" Value="Top"/>
        </Style>
    </Window.Resources>

    <DockPanel>
        <StackPanel DockPanel.Dock="Top" 
                    DataContext="{StaticResource DataSourceCustomer}" 
                    Orientation="Horizontal">
            <TextBlock Text="{Binding Path=FirstName}"/>
            <TextBlock Text=" "/>
            <TextBlock Text="{Binding Path=LastName}"/>
            <TextBlock Text=" ("/>
            <TextBlock Text="{Binding Path=FullName}" FontWeight="Bold"/>
            <TextBlock Text=")"/>
        </StackPanel>

        <StackPanel Style="{StaticResource DataRowStyle}">
            <TextBlock Text="First Name:"/>
            <TextBox Text="{Binding Path=FirstName}" 
                      Width="200" Margin="3 0 0 0"/>
        </StackPanel>

        <StackPanel Style="{StaticResource DataRowStyle}">
            <TextBlock Text="Last Name:"/>
            <TextBox Text="{Binding Path=LastName}" 
                     Width="200" Margin="3 0 0 0"/>
        </StackPanel>

        <StackPanel Style="{StaticResource DataRowStyle}">
            <Button Content="Save Changes" Click="Button_Click"/>
        </StackPanel>

    </DockPanel>
</Window> 
```

**代码背后：**

```
using System.Windows;
using System.ComponentModel;
using System;

namespace TestBinding99382
{
    public partial class Window1 : Window
    {
        private Customer _customer;

        public Window1()
        {
            InitializeComponent();
        }

        private void Button_Click(object sender, RoutedEventArgs e)
        {
            //I want to edit the _customer object here
            //and have it my changes automatically reflect in my XAML
            //via the INotifyPropertyChanged inheritance.
        }
    }

    public class Customer : INotifyPropertyChanged
    {
        private string _firstName;
        private string _lastName;

        public string FirstName
        {
            get
            {
                return _firstName;
            }

            set
            {
                _firstName = value;
                this.RaisePropertyChanged("FirstName");
                this.RaisePropertyChanged("FullName");
            }
        }

        public string LastName
        {
            get
            {
                return _lastName;
            }

            set
            {
                _lastName = value;
                this.RaisePropertyChanged("LastName");
                this.RaisePropertyChanged("FullName");
            }

        }

        public string FullName
        {
            get
            {
                return String.Format("{0} {1}", _firstName, _lastName);
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;
        private void RaisePropertyChanged(string property)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(property));
            }
        }

        public static Customer GetCustomer()
        {
            return new Customer { FirstName = "Jim", LastName = "Smith" };
        }

    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T18:39:31.740

> 在点击事件中，如何访问“正在编辑的对象”

您可以使用 FindResource 方法访问后面代码中的资源，见下文。

```
private void Button_Click(object sender, RoutedEventArgs e)
{
    ObjectDataProvider objectDataProvider 
        = FindResource("DataSourceCustomer") as ObjectDataProvider;
    _customer = objectDataProvider.Data as Customer;
} 
```

对于您的其他问题：

什么是永续？如果这是您的问题，您不必在 WPF 中创建单例数据绑定。

> 最终，我当然希望从读取 XML 文件或 Web 服务的模型中检索数据，当然我希望我的 ViewModel 每隔一秒左右检查一次我的模型，以查看数据是否已更改并将其反映在 XAML 上.

WPF 数据绑定将自动更新您使用 INotifyPropertyChanged 对象的视图。除非出于性能原因，您只想每秒更新一次视图，否则只需坚持正常的数据绑定即可。

# attributes - AllowMultiple 不适用于属性属性？

> ID：848669
> 
> 赞同：11
> 
> 时间：2009-05-11T15:33:47.033
> 
> 标签：attributes, custom-attributes

我想收集放置在属性上的所有自定义属性。有多个相同类型的 Attributes 分配给了 Property，但是在收集它们时，生成的集合只包含特定类型的第一个 Attribute：

属性类

```
[AttributeUsage(System.AttributeTargets.Property,
               AllowMultiple = true)]

public class ConditionAttribute : Attribute{...} 
```

用法：

```
[ConditionAttribute("Test1")]
[ConditionAttribute("Test2")]
[ConditionAttribute("Test3")]
public Color BackColor{get; set;} 
```

现在，当遍历对象“值”的所有道具时，其类包含道具“BackColor”：

```
foreach (PropertyDescriptor property in TypeDescriptor.GetProperties(value))
{
  foreach (Attribute attribute in property.Attributes)
  {   ... }
   ....
} 
```

集合**属性。属性**仅包含一个“ConditionAttribute”类型的属性：具有“Test1”的属性。其他的被忽略；-(

那么 AllowMultiple 不适用于 Property Attributes 吗？

提前致谢

亨里克

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-09-02T03:11:39.167

根据[MSDN 上的一篇文章](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/e6bb4146-eb1a-4c1b-a5b1-f3528d8a7864)，这是设计为 PropertyDescriptor 类的一部分。

但是，您实际上可以通过在自定义属性中覆盖 TypeId 来解决问题（感谢[Mindscape](http://www.mindscape.co.nz/forums/Thread.aspx?ThreadID=2323)的 Ivan 指出这一点）：

```
public override object TypeId
{
  get
  {
    return this;
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T15:37:32.113

是的，它确实有效。不知道为什么它不能通过 PropertyDescriptors 工作。

你总是可以这样做：`Attribute.GetCustomAttributes(methodInfo, typeof(ConditionAttribute))`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-01-24T11:23:00.650

另一种调整方法，

[ConditionAttribute("Test1,Test2,Test3")] public Color BackColor{get; 放;}

在您的验证代码中，

Dim lstProperties() As String = _ChkColors.Split(",") For each strProp as string in lstPropertyes '你的验证'返回 Next

# delphi - Delphi 组件未绘制

> ID：848674
> 
> 赞同：1
> 
> 时间：2009-05-11T15:34:41.650
> 
> 标签：delphi, panel, custom-component, tpanel

我有组件（TPanel 的后代），我在其中实现了 Transparency 和 BrushStyle（使用 TImage）属性。

当我在表单上有一个这种类型的组件时，一切都好。当我在表单上添加更多这种类型的组件时，只会绘制第一个可见组件。当表单被移动并且第一个组件位于其他窗口或桌面外部时，下一个组件被绘制。

```
unit TransparentPanel;

interface
uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  ExtCtrls, stdctrls;

type
  TTransparentPanel = class(TPanel)
  private
    FTransparent: Boolean;
    FBrushStyle: TBrushStyle;
    FImage: TImage;

    procedure SetTransparent(const Value: Boolean);
    procedure SetBrushStyle(const Value: TBrushStyle);
  protected
    procedure CreateParams(var Params: TCreateParams); override;
    procedure Paint; override;
  public
    constructor Create(AOwner: TComponent); override;
    destructor Destroy; override;
  published
    property Transparent: Boolean read FTransparent write SetTransparent default
      True;
    property BrushStyle: TBrushStyle read FBrushStyle write SetBrushStyle default
      bsBDiagonal;
  end;

procedure Register;

implementation

procedure Register;
begin
  RegisterComponents('TransparentPanel', [TTransparentPanel]);
end;

constructor TTransparentPanel.Create(AOwner: TComponent);
begin
  inherited Create(AOwner);

  FTransparent := True;
  FBrushStyle := bsBDiagonal;

  FImage := TImage.Create(Self);
  FImage.Align := alClient;
  FImage.Parent := Self;
  FImage.Transparent := FTransparent;
end;

procedure TTransparentPanel.CreateParams(var Params: TCreateParams);
begin
  inherited CreateParams(Params);
  if ((not (csDesigning in ComponentState)) and FTransparent) then
    Params.ExStyle := Params.ExStyle or WS_EX_TRANSPARENT;
end;

destructor TTransparentPanel.Destroy;
begin
  if Assigned(FImage) then
    FreeAndNil(FImage);

  inherited Destroy;
end;

procedure TTransparentPanel.Paint;
var
  XBitMap,
    BitmapBrush: TBitmap;
  XOldDC: HDC;
  XRect: TRect;
  ParentCanvas: TCanvas;
begin
  {This panel will be transparent only in Run Time}
  if (csDesigning in ComponentState) or (not FTransparent) or (FBrushStyle in [bsClear, bsSolid]) then
    inherited Paint
  else
  begin
    XRect := ClientRect;
    XOldDC := Canvas.Handle;
    XBitMap := TBitmap.Create;
    BitmapBrush := TBitmap.Create;
    try
      XBitMap.Height := Height;
      XBitMap.Width := Width;
      Canvas.Handle := XBitMap.Canvas.Handle;
      inherited Paint;
      RedrawWindow(Parent.Handle, @XRect, 0,
        RDW_ERASE or RDW_INVALIDATE or
        RDW_NOCHILDREN or RDW_UPDATENOW);

      BitmapBrush.Width := FImage.Width;
      BitmapBrush.Height := FImage.Height;

      BitmapBrush.Canvas.Brush.Color := clBlack;
      BitmapBrush.Canvas.Brush.Style := FBrushStyle;
      SetBkColor(BitmapBrush.Canvas.Handle, clWhite);
      BitmapBrush.Canvas.FillRect(BitmapBrush.Canvas.ClipRect);

      FImage.Canvas.Draw(0, 0, BitmapBrush);
    finally
      Canvas.Handle := XOldDC;
      Canvas.BrushCopy(XRect, XBitMap, XRect, Color);
      XBitMap.Free;
      BitmapBrush.Free;
    end;
  end;
end;

procedure TTransparentPanel.SetBrushStyle(const Value: TBrushStyle);
begin
  if (FBrushStyle <> Value) then
  begin
    FBrushStyle := Value;
    Invalidate;
  end
end;

procedure TTransparentPanel.SetTransparent(const Value: Boolean);
begin
  if (FTransparent <> Value) then
  begin
    FTransparent := Value;
    FImage.Transparent := Value;
    Invalidate;
  end;
end;

end. 
```

怎么了？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T18:06:11.607

好的，一些提示：

*   只绘制了一个组件，因为在绘制过程中控件的客户区再次失效，因此您创建了无限的*WM_PAINT*消息流，而第二个组件永远不会被绘制。正如你所描述的，直到第一个变得不可见。您可以从 CPU 负载中看到这一点，表单上的一个组件使用我系统上一个内核的 100%（Delphi 2007，在运行时创建的组件）。

*   您应该尝试删除您绘制的位图，并改用 DoubleBuffered 属性。

*   FImage 实际用于什么？

*   如果根据透明属性的值修改创建参数，则需要在属性更改时重新创建窗口句柄。

*   也许您可以完全摆脱该组件，而改用 TPaintBox ？只要您不自己绘制背景，它就是透明的。但是我无法从您的代码中看出您真正想要实现的目标，所以很难说。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T18:08:20.603

我认为你想要一个可以包含其他控件的控件——就像`TPanel`可以做的那样——以及一个可以显示它下面的窗口内容的控件——就像在设置它的属性`TImage`时可以做的那样。`Transparent`您似乎误以为如果将一个控件放在另一个控件之上，您将获得两者的结合行为。*这*就是问题所在。

你应该做的第一件事是摆脱`TImage`控制。这只会让事情变得比他们需要的更复杂。当需要在面板上绘制画笔图案时，直接在面板上绘制即​​可。

接下来，实现`ws_ex_Transparent`窗口样式控制是否先绘制窗口的*兄弟姐妹*。这并没有说明窗口的*父级是否被重新绘制。*如果您的面板的父级`ws_ClipChildren`设置了样式，那么它不会在您的面板应该在的位置下方绘制自己。如果面板控件的父级设置了样式集，它看起来会对您有所帮助`ws_ex_Composited`，但作为组件编写者，您无法控制控件的父级。

`TImage`能够显示为透明，因为它不是窗口控件。它没有窗口句柄，因此有关绘画和剪辑的操作系统规则不适用于它。从 Windows 的角度来看，`TImage`根本不存在。我们在 Delphi 世界中所认为的`TImage`绘画本身实际上是父窗口，它遵循一个单独的子程序来绘制父窗口的某个区域。正因为如此，`TImage`绘画代码不能简单地在父区域的某些区域上绘画。

如果我这样做，我会问自己带有画笔图案的控件是否真的需要成为容器控件。我可以改用一个普通`TImage`的画笔重复画笔图案吗？其他控件仍然可以在其之上，但它们不会被视为模式控件的子控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T10:04:37.620

如果您希望面板是透明的，您需要做的就是覆盖 Paint 并且什么都不做（例如，或者绘制透明图像），并且还要捕获 WM_ERASEBKGND 消息并且在这里什么也不做。这样可以确保面板根本不会自行涂漆。

还要确保从 ControlStyle 中排除 csOpaque 标志，以便父级知道它应该在面板下方绘制自己。

顺便说一句，您在 Paint 中拥有的东西绝对是可怕的（我的意思是 RedrawWindow 的东西）。摆脱它。WS_EX_TRANSPARENT 仅适用于顶层窗口，不适用于控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T10:57:43.067

尝试查看[Graphics32 库](http://www.graphics32.org/wiki/)：它非常擅长绘制东西，并且与位图和透明度配合得*很好*

# java - 客户端中的 @EJB 注释

> ID：848675
> 
> 赞同：11
> 
> 时间：2009-05-11T15:34:42.977
> 
> 标签：java, netbeans, jakarta-ee, ejb

使用 NetBeans，我在包含 的类中执行以下操作`main()`，并且它可以工作：

```
import javax.ejb.EJB;

public class Master {
    @EJB
    TestBeanARemote x;

    public static void main(String[] args) {
        Master m = new Master();
        m.doStuff();
    }
//doStuff includes x, but it works, so who cares.
... 
```

但是，如果我在一个被调用的类中这样做，它就会失败。似乎被调用的类要求我避免使用注释，而是使用整个`InitialContext()`设置。

```
String testRun(String arg) {
   InitialContext ic;
    try {
        ic = new InitialContext();
        x = (TestBeanARemote) ic.lookup("com.bnncpa.testing.TestBeanARemote");
        return x.testRun(arg);

    } 
```

完整的失败副本如下：

```
package enterpriseapplication1;
public class Main {

    private Secondary x = new Secondary();

    public static void main(String[] args) {
        Main m = new Main();
        m.doStuff();
    }

    public void doStuff() {
        System.out.println(x.testRun("bar"));
    }

}

package enterpriseapplication1;
import org.mine.testing.TestBeanARemote;
import javax.ejb.EJB;

public class Secondary {
   @EJB
   static private TestBeanARemote x;

   String testRun(String arg) {
       return x.testRun(arg);
   }
} 
```

是否有特定原因`@EJB`可能无法在包的所有类中工作？我希望能够简单地标记`@EJB`我使用的任何地方。

有没有更好的方法来解决这个我完全错过的问题？

* * *

编辑：为了解决使用 appclient 的问题，这是我的堆栈跟踪：

```
May 11, 2009 4:24:46 PM com.sun.enterprise.appclient.MainWithModuleSupport <init>
WARNING: ACC003: Application threw an exception.
java.lang.NullPointerException
    at enterpriseapplication1.Secondary.testRun(Secondary.java:20)
    at enterpriseapplication1.Main.doStuff(Main.java:27)
    at enterpriseapplication1.Main.main(Main.java:23)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at com.sun.enterprise.util.Utility.invokeApplicationMain(Utility.java:266)
    at com.sun.enterprise.appclient.MainWithModuleSupport.<init>(MainWithModuleSupport.java:449)
    at com.sun.enterprise.appclient.MainWithModuleSupport.<init>(MainWithModuleSupport.java:259)
    at com.sun.enterprise.appclient.Main.main(Main.java:200)
Exception in thread "main" java.lang.RuntimeException: java.lang.reflect.InvocationTargetException
    at com.sun.enterprise.appclient.MainWithModuleSupport.<init>(MainWithModuleSupport.java:461)
    at com.sun.enterprise.appclient.MainWithModuleSupport.<init>(MainWithModuleSupport.java:259)
    at com.sun.enterprise.appclient.Main.main(Main.java:200)
Caused by: java.lang.reflect.InvocationTargetException
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at com.sun.enterprise.util.Utility.invokeApplicationMain(Utility.java:266)
    at com.sun.enterprise.appclient.MainWithModuleSupport.<init>(MainWithModuleSupport.java:449)
    ... 2 more
Caused by: java.lang.NullPointerException
    at enterpriseapplication1.Secondary.testRun(Secondary.java:20)
    at enterpriseapplication1.Main.doStuff(Main.java:27)
    at enterpriseapplication1.Main.main(Main.java:23)
    ... 8 more
Java Result: 1 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T20:43:33.707

问题是@EJB 只会被注入到“托管”类中。

在 Java EE 中，托管类非常少。值得注意的是应用程序客户端（在这种情况下是您的“主要”）、EJB（无状态和有状态 EJB、消息 Bean 等）和 Servlet。

其他任何东西（即泛型类、JPA 实体等）都不会注入资源，您需要依靠查找机制来访问您的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-12T15:11:01.250

Glassfish 支持通过所谓的“应用程序客户端容器”在未在任何 Java EE 容器（您的小型应用程序、Swing 客户端等）中运行的客户端应用程序中注入 EJB。

作为记录，如果我没记错的话，我们不得不使用类似的东西

```
x = (TestBeanARemote) PortableRemoteObject.narrow(ic.lookup("com.bnncpa.testing.TestBeanARemote"), TestBeanARemote.class) 
```

它在 Weblogic 10 的 <=EJB 2.1 中使用，尽管它支持并且我们使用 EJB 3 (JavaEE 5)。它认为这是由 Weblogic 支持 EJB3 的方式引起的，即在以前的版本中生成必要的 EJB 2.1 样式接口。不知道他们是否已经修复它。

# c# - 读取二进制文件并使用 Response.BinaryWrite()

> ID：848679
> 
> 赞同：25
> 
> 时间：2009-05-11T15:35:11.290
> 
> 标签：c#, asp.net

我有一个应用程序需要从文件系统中读取 PDF 文件，然后将其写出给用户。PDF 为 183KB，看起来运行良好。当我使用底部的代码时，浏览器会收到一个 224KB 的文件，并且我从 Acrobat Reader 收到一条消息，说该文件已损坏且无法修复。

这是我的代码（我也尝试过使用 File.ReadAllBytes()，但我得到了同样的结果）：

```
using (FileStream fs = File.OpenRead(path))
{
    int length = (int)fs.Length;
    byte[] buffer;

    using (BinaryReader br = new BinaryReader(fs))
    {
        buffer = br.ReadBytes(length);
    }

    Response.Clear();
    Response.Buffer = true;
    Response.AddHeader("content-disposition", String.Format("attachment;filename={0}", Path.GetFileName(path)));
    Response.ContentType = "application/" + Path.GetExtension(path).Substring(1);
    Response.BinaryWrite(buffer);
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-11T15:48:52.593

尝试添加

响应。结束（）；

在调用 Response.BinaryWrite() 之后。

您可能会在 Response.BinaryWrite 之后无意中将其他内容发回，这可能会使浏览器感到困惑。Response.End 将确保浏览器只获取您真正想要的内容。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-11T15:55:52.553

```
 Response.BinaryWrite(bytes);
        Response.Flush();
        Response.Close();
        Response.End(); 
```

这对我们有用。我们从 SQL Reporting Services 创建 PDF。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-11T15:53:05.317

我们已经成功地使用了它。WriteFile 为您下载并在最后一个 Flush / End 将其全部发送到客户端。

```
 //Use these headers to display a saves as / download
            //Response.ContentType = "application/octet-stream";
            //Response.AddHeader("Content-Disposition", String.Format("attachment; filename={0}.pdf", Path.GetFileName(Path)));

            Response.ContentType = "application/pdf";
            Response.AddHeader("Content-Disposition", String.Format("inline; filename={0}.pdf", Path.GetFileName(Path)));

            Response.WriteFile(path);
            Response.Flush();
            Response.End(); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-11T16:58:40.750

由于您直接从文件系统发送文件而没有中间处理，为什么不使用[`Response.TransmitFile`](http://msdn.microsoft.com/en-us/library/12s31dhy.aspx)呢？

```
Response.Clear();
Response.ContentType = "application/pdf";
Response.AddHeader("Content-Disposition",
    "attachment; filename=\"" + Path.GetFileName(path) + "\"");
Response.TransmitFile(path);
Response.End(); 
```

（我怀疑您的问题是由缺少引起的[`Response.End`](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.end.aspx)，这意味着您正在发送附加到 PDF 数据的其余页面内容。）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-06-17T07:44:12.747

仅供将来参考，如本博文所述：http: [//blogs.msdn.com/b/aspnetue/archive/2010/05/25/response-end-response-close-and-how-customer-feedback-帮助我们改进-msdn-documentation.aspx](http://blogs.msdn.com/b/aspnetue/archive/2010/05/25/response-end-response-close-and-how-customer-feedback-helps-us-improve-msdn-documentation.aspx)

不建议调用或-**而是**使用.`Response.Close()``Response.End()``CompleteRequest()`

您的代码看起来有点像这样：

```
 byte[] bytes = {};

    bytes = GetBytesFromDB();  // I use a similar way to get pdf data from my DB

    Response.Clear();
    Response.ClearHeaders();
    Response.Buffer = true;
    Response.Cache.SetCacheability(HttpCacheability.NoCache);
    Response.ContentType = "application/pdf";
    Response.AppendHeader("Content-Disposition", "attachment; filename=" + anhangTitel);
    Response.AppendHeader("Content-Length", bytes.Length.ToString());
    this.Context.ApplicationInstance.CompleteRequest(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-14T16:03:21.543

请在使用 Response.TransmitFile 之前阅读此内容：http: [//improve.dk/blog/2008/03/29/response-transmitfile-close-will-kill-your-application](http://improve.dk/blog/2008/03/29/response-transmitfile-close-will-kill-your-application)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T15:43:05.817

也许您缺少 Response.close 来关闭 de Binary Stream

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-12-15T19:22:18.720

在我的 MVC 应用程序中，我为所有响应启用了 gzip 压缩。如果您正在从带有 gzip 响应的 ajax 调用中读取此二进制写入，那么您将获得 gzip 后的字节数组，而不是您需要使用的原始字节数组。

```
//c# controller is compressing the result after the response.binarywrite

[compress]
public ActionResult Print(int id)       
{
... 
var byteArray=someService.BuildPdf(id);
return  return this.PDF(byteArray, "test.pdf");
}

//where PDF is a custom actionresult that eventually does this:
 public class PDFResult : ActionResult
{
...
    public override void ExecuteResult(ControllerContext context)
    {
        //Set the HTTP header to excel for download
        HttpContext.Current.Response.Clear();
        //HttpContext.Current.Response.ContentType = "application/vnd.ms-excel";
        HttpContext.Current.Response.ContentType = "application/pdf";
        HttpContext.Current.Response.AddHeader("content-disposition", string.Concat("attachment; filename=", fileName));
        HttpContext.Current.Response.AddHeader("Content-Length", pdfBytes.Length.ToString());
        //Write the pdf file as a byte array to the page
        HttpContext.Current.Response.BinaryWrite(byteArray);
        HttpContext.Current.Response.End();
    }
}

//javascript

function pdf(mySearchObject) {
    return $http({
    method: 'Post',
    url: '/api/print/',
    data: mySearchObject,
    responseType: 'arraybuffer',
    headers: {
    'Accept': 'application/pdf',
    }
    }).then(function (response) {

var type = response.headers('Content-Type');
//if response.data is gzipped, this blob will be incorrect.  you have to uncompress it first.
var blob = new Blob([response.data], { type: type });
var fileName = response.headers('content-disposition').split('=').pop();

if (window.navigator.msSaveOrOpenBlob) { // for IE and Edge
    window.navigator.msSaveBlob(blob, fileName);
} else {

    var anchor = angular.element('<a/>');
    anchor.css({ display: 'none' }); // Make sure it's not visible
    angular.element(document.body).append(anchor); // Attach to document

    anchor.attr({
    href: URL.createObjectURL(blob),
    target: '_blank',
    download: fileName
    })[0].click();

    anchor.remove();
}
}); 
```

}

" var blob = new Blob([response.data], { type: type }); " 如果您在 javascript 中将该字节数组转换为文件，这将为您提供您试图打开的无效/损坏文件不要先解压缩它。

要解决此问题，您可以选择阻止对该二进制数据进行 gzip 压缩，以便您可以正确地将其转换为您正在下载的文件，或者您必须在将其转换为文件之前在您的 javascript 代码中解压缩该 gzip 数据。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T15:46:47.887

除了 Igor 的 Response.Close()，我还要添加一个 Response.Flush()。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-10-28T01:50:40.627

我还发现有必要添加以下内容：

```
Response.Encoding = Encoding.Default 
```

如果我没有包括这个，我的 JPEG 文件已经损坏并且字节大小增加了一倍。

但仅当处理程序从 ASPX 页面返回时。它似乎从 ASHX 运行，这不是必需的。

# wpf - 需要在动态构建的 WPF DataGrid 中格式化日期

> ID：848702
> 
> 赞同：31
> 
> 时间：2009-05-11T15:38:50.600
> 
> 标签：wpf, datetime, datagrid, format

我们在运行时将未知结果集绑定到 WPF DataGrid。我们的一些列将包含 DateTime 值，我们需要正确格式化这些日期时间字段。在不知道设计时哪些列将成为 DateTime 字段的情况下，我们如何能够在运行时格式化这些列？

我们使用 DataTable 的 DefaultView 绑定到 WPF DataGrid。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-08-21T21:04:31.917

通过以下方式格式化绑定`StringFormat`：

```
<DataGridTextColumn Header="Fecha Entrada" 
                    Width="110"  
                    Binding="{Binding EnterDate, StringFormat={}\{0:dd/MM/yyyy hh:mm\}}"
                    IsReadOnly="True" /> 
```

我认为这比在代码后面写代码要好

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-11T20:51:32.693

我想出了如何在代码中做到这一点......希望有一种方法可以在 XAML 中模仿这一点。（如果您找到有效的 XAML 示例，请发布。）

要在代码中完成此操作，请为 Grid 的 AutoGeneratingColumn 事件添加一个事件处理程序，例如：

```
private void ResultsDataGrid_AutoGeneratingColumn(object sender, DataGridAutoGeneratingColumnEventArgs e)
{
    if (e.PropertyType == typeof(DateTime))
    {
        DataGridTextColumn dataGridTextColumn = e.Column as DataGridTextColumn;
        if (dataGridTextColumn != null)
        {
            dataGridTextColumn.Binding.StringFormat = "{0:d}";
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-12-03T08:21:32.670

嘿，您可以在 WPF 表单的构造函数中将语言环境文化信息设置为

this.Language = XmlLanguage.GetLanguage(CultureInfo.CurrentCulture.IetfLanguageTag);

**或者**您可以在窗口标题标记中包含 xml 标记**xml:lang="en-GB"**

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-09-01T08:14:20.173

```
<DataGridTextColumn Header="Last update"
    Width="110"
    IsReadOnly="True"
    Binding="{Binding Path=Contact.TimeUpdate, StringFormat={}\{0:dd/MM/yyyy hh:mm\}, Mode=OneWay}" /> 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-11T16:59:57.283

我将使用 DataType 为 Date 或 DateTime 的 DataTemplate （取决于它将通过的方式）。在绑定中使用 StringFormat 将 TextBlock 放置在 DataTemplate 中。

像这样的东西应该可以工作（未经测试）

```
<DataTemplate DataType="{x:Type DateTime}">
    <TextBlock Text="{Binding StringFormat={0:d}}"  />
</DataTemplate> 
```

或者，如果您希望它仅在网格中应用

```
<wpfToolkit:DataGrid>
    <wpfToolkit:DataGrid.Resources>
        <DataTemplate DataType="{x:Type DateTime}">
            <TextBlock Text="{Binding StringFormat={0:d}}"  />
        </DataTemplate>
    </wpfToolkit:DataGrid.Resources>
    ...
</wpfToolkit:DataGrid> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-09T20:32:25.550

**dataGridTextColumn.Binding.StringFormat = "{0:dd/MM/yyyy}";**

工作得很漂亮

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-02-26T22:23:45.123

我这样跑。它的工作完成了。

```
<TextBlock  Text="{Binding Date_start,  StringFormat=\{0:dd-MM-yyyy\}, Mode=OneWay}" /> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-02T12:59:48.137

FarrEver，5 月 11 日的答案很好，但对我来说它不起作用。我仍然得到美国的 mm/dd/yyy 而不是我的德国 dd/mm/yyyy。所以我建议找到计算机的区域设置并在StringFormat中使用

```
 Private Sub DGrid_AutoGeneratingColumn(ByVal sender As System.Object, ByVal e As Microsoft.Windows.Controls.DataGridAutoGeneratingColumnEventArgs)
    If e.PropertyType Is GetType(DateTime) Then
        Dim dataGridTextColumn As DataGridTextColumn = TryCast(e.Column, DataGridTextColumn)
        If dataGridTextColumn IsNot Nothing Then
            Dim ShortDatePattern As String = System.Globalization.DateTimeFormatInfo.CurrentInfo.ShortDatePattern
            dataGridTextColumn.Binding.StringFormat = "{0:" + ShortDatePattern + "}" '"{0:dd/MM/yyyy}"
        End If
    End If
End Sub 
```

另见：[我的博客](http://alexontech.wordpress.com/2009/06/25/show-custom-date-format-in-auto-generated-datagrid-column/)

# ruby - 如果文件夹中包含 Unicode 字符，Ruby 可以获取文件名吗？

> ID：848703
> 
> 赞同：0
> 
> 时间：2009-05-11T15:38:54.280
> 
> 标签：ruby, file, unicode, scripting, windows-vista

我正在 Windows Vista 上编写一个脚本，将文件夹中的文件移动到另一个硬盘驱动器，但发现 Ruby 1.8.6 或 1.9 都会返回其中包含 Unicode 字符的文件名，替换为“??????”

例如，返回文件名“Chart for ?????????.doc”，文件根本无法移动......

我用了

```
filename.each_byte {|x| p x} 
```

确保它在内部真的是“？” 字符串中的字符，而不仅仅是打印出来的时候。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:08:15.873

Ruby 支持 utf8，但不支持多字节。您必须使用第三个库作为[http://ruby-unicode.rubyforge.org/doc/](http://ruby-unicode.rubyforge.org/doc/)

# c - 为什么 2[myArray] 是有效的 C 语法？

> ID：848705
> 
> 赞同：5
> 
> 时间：2009-05-11T15:40:08.570
> 
> 标签：c, arrays, syntax, pointers

## 复制

> [在 C 数组中，为什么这是真的？a[5] == 5[a]](https://stackoverflow.com/questions/381542/in-c-arrays-why-is-this-true-a5-5a)

* * *

给定一个数组

```
 myArray[5] = { 0, 1, 2, 3, 4 }; 
```

一个元素可以被访问为

```
 2[myArray] 
```

为什么？当我看到这个表达式时，我想象 C 试图访问指针“2”并且未能添加“myArray”指针增量以取消引用该地址。我错过了什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-11T15:41:28.927

在 C 中，a[b] 等价于 *(a + b)。当然，+ 运算符是可交换的，所以 a[b] 与 b[a] 相同 与 *(b + a) 相同 与 *(a + b) 相同。

# c# - C# Server.URLEncode 的 JavaScript 等价物是什么？

> ID：848715
> 
> 赞同：11
> 
> 时间：2009-05-11T15:43:34.147
> 
> 标签：c#, .net, asp.net, javascript, http

C# Server.URLEncode 的 JavaScript 等价物是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-11T15:44:36.953

```
encodeURI() 
```

[http://xkr.us/articles/javascript/encode-compare/#ref-js-msdn](http://xkr.us/articles/javascript/encode-compare/#ref-js-msdn)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-25T18:02:41.770

不，`encodeURIComponent()`确切地说。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-02-17T12:19:12.820

xkr.us 上有一篇精彩的文章[比较了 javascript 的各种转义函数](http://xkr.us/articles/javascript/encode-compare/)。请阅读它以了解详细信息，但这里有一个简短的总结：

*   `escape()`— 不要使用：不理解非 ASCII 字符，并且不转义一些重要的 URI 字符，例如`+`.
*   `encodeURI()`— 对整个 URI 进行编码：因此，它离开`?`且未`&`编码。
*   `encodeURIComponent()`— 在查询字符串中编码一个组件（这通常是您想要的，并且看起来等同于[`Server.URLEncode`](https://msdn.microsoft.com/en-us/library/ms525738(v=vs.90).aspx)）。

# c - 在 Linux 上的 C 中处理超过 1024 个文件描述符

> ID：848717
> 
> 赞同：8
> 
> 时间：2009-05-11T15:43:40.700
> 
> 标签：c, linux, multithreading, networking

我正在使用 epoll（边缘触发）和线程在线程网络服务器上工作，并且我正在使用 httperf 对我的服务器进行基准测试。

到目前为止，它的性能非常好，或者几乎完全符合发送请求的速度。直到 1024 障碍，一切都减慢到大约 30 个请求/秒。

在 Ubuntu 9.04 64 位上运行。

我已经尝试过：

*   成功增加文件描述符的 ulimit 数量。它只是没有提高超过 1024 个并发连接的性能。

    > andri@filefridge:~/Dropbox/School/Group 452/代码/服务器$ ulimit -n
    > 20000

我很确定这种减速正在操作系统中发生，因为它发生在事件发送到 epoll 之前（是的，我还增加了 epoll 中的限制）。

我需要对我的程序可以处理多少并发连接进行基准测试，直到它开始变慢（没有操作系统干扰）。

**如何让我的程序运行超过 1024 个文件描述符？**

这个限制可能是有原因的，但出于基准测试的目的，我需要它消失。

## 更新

感谢您的所有回答，但我想我已经找到了罪魁祸首。在我的程序中重新定义 __FD_SETSIZE 之后，一切都开始变得更快。当然 ulimit 也需要提高，但没有 __FD_SETSIZE 我的程序永远不会利用它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-12T11:34:52.547

感谢您的所有回答，但我想我已经找到了罪魁祸首。在我的程序中重新定义 __FD_SETSIZE 之后，一切都开始变得更快。当然 ulimit 也需要提高，但没有 __FD_SETSIZE 我的程序永远不会利用它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T16:11:43.120

请参阅[C10K 问题](http://www.kegel.com/c10k.html)页面。它包含关于如何实现“10000 个同时连接”目标的深入讨论，同时保持高性能并管理为每个客户端提供服务。

它还包含有关如何在一次处理大量连接时提高内核性能的信息。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2011-07-06T10:15:16.017

只是不要。

是的，我的意思是。

如果您需要增加文件描述符，那么您的代码中有一个隐藏的错误。追捕它而不是治疗它的症状。完成后请记住关闭文件描述符。

# php - IIS7 请求跟踪日志上的 URL_CHANGED 事件是什么？

> ID：848722
> 
> 赞同：2
> 
> 时间：2009-05-11T15:44:33.240
> 
> 标签：php, iis, rewrite, trace, logging

我刚刚为一个站点启用了[失败的请求跟踪](http://learn.iis.net/page.aspx/467/using-failed-request-tracing-to-trace-rewrite-rules/)，我得到一个 URL_CHANGED 事件作为日志中的第三项。

```
1\. GENERAL_REQUEST_START SiteId="1", AppPoolId="DefaultAppPool", ConnId="1610613013", RawConnId="0", RequestURL="http://example.com:80/test/wp-admin/", RequestVerb="GET" 15:35:54.176 
2\. GENERAL_SET_REQUEST_HEADER HeaderName="AspFilterSessionId", HeaderValue="", Replace="true" 15:35:54.192 
3\. URL_CHANGED OldUrl="/test/wp-admin/", NewUrl="/index.php/test/wp-admin/" 15:35:54.192 
```

有人能告诉我**URL_CHANGED**事件来自哪里以及如何防止它吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T16:23:14.207

我想说这可能是 stackoverflow 姊妹网站[serverfault.com的问题](http://WWW.serverfault.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-16T15:25:30.870

这件事昨天发生在我身上。最后，当我为 IIS 中的所有区域启用失败请求跟踪日志时，我可以看到它实际上在 ISAPI 过滤器中被更改。

# android - 如何在 Android 中以编程方式从设备读取 SMS 消息？

> ID：848728
> 
> 赞同：282
> 
> 时间：2009-05-11T15:45:28.747
> 
> 标签：android, sms, inbox

我想从设备中检索 SMS 消息并显示它们？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2012-02-29T06:27:44.390

使用内容解析器（**“content://sms/inbox”**）来阅读收件箱中的短信。

```
// public static final String INBOX = "content://sms/inbox";
// public static final String SENT = "content://sms/sent";
// public static final String DRAFT = "content://sms/draft";
Cursor cursor = getContentResolver().query(Uri.parse("content://sms/inbox"), null, null, null, null);

if (cursor.moveToFirst()) { // must check the result to prevent exception
    do {
       String msgData = "";
       for(int idx=0;idx<cursor.getColumnCount();idx++)
       {
           msgData += " " + cursor.getColumnName(idx) + ":" + cursor.getString(idx);
       }
       // use msgData
    } while (cursor.moveToNext());
} else {
   // empty box, no SMS
} 
```

请添加**READ_SMS**权限。

我希望它有帮助:)

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2012-12-15T20:03:45.493

```
if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
        final String myPackageName = getPackageName();
        if (!Telephony.Sms.getDefaultSmsPackage(this).equals(myPackageName)) {

            Intent intent = new Intent(Telephony.Sms.Intents.ACTION_CHANGE_DEFAULT);
            intent.putExtra(Telephony.Sms.Intents.EXTRA_PACKAGE_NAME, myPackageName);
            startActivityForResult(intent, 1);
        }else {
            List<Sms> lst = getAllSms();
        }
    }else {
        List<Sms> lst = getAllSms();
    } 
```

将应用设置为默认短信应用

```
 @Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
if (requestCode == 1) {
    if (resultCode == RESULT_OK) {

        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
            final String myPackageName = getPackageName();
            if (Telephony.Sms.getDefaultSmsPackage(mActivity).equals(myPackageName)) {

                List<Sms> lst = getAllSms();
            }
        }
    }
}
} 
```

获取短信功能

```
public List<Sms> getAllSms() {
    List<Sms> lstSms = new ArrayList<Sms>();
    Sms objSms = new Sms();
    Uri message = Uri.parse("content://sms/");
    ContentResolver cr = mActivity.getContentResolver();

    Cursor c = cr.query(message, null, null, null, null);
    mActivity.startManagingCursor(c);
    int totalSMS = c.getCount();

    if (c.moveToFirst()) {
        for (int i = 0; i < totalSMS; i++) {

            objSms = new Sms();
            objSms.setId(c.getString(c.getColumnIndexOrThrow("_id")));
            objSms.setAddress(c.getString(c
                    .getColumnIndexOrThrow("address")));
            objSms.setMsg(c.getString(c.getColumnIndexOrThrow("body")));
            objSms.setReadState(c.getString(c.getColumnIndex("read")));
            objSms.setTime(c.getString(c.getColumnIndexOrThrow("date")));
            if (c.getString(c.getColumnIndexOrThrow("type")).contains("1")) {
                objSms.setFolderName("inbox");
            } else {
                objSms.setFolderName("sent");
            }

            lstSms.add(objSms);
            c.moveToNext();
        }
    }
    // else {
    // throw new RuntimeException("You have no SMS");
    // }
    c.close();

    return lstSms;
} 
```

短信类如下：

```
public class Sms{
private String _id;
private String _address;
private String _msg;
private String _readState; //"0" for have not read sms and "1" for have read sms
private String _time;
private String _folderName;

public String getId(){
return _id;
}
public String getAddress(){
return _address;
}
public String getMsg(){
return _msg;
}
public String getReadState(){
return _readState;
}
public String getTime(){
return _time;
}
public String getFolderName(){
return _folderName;
}

public void setId(String id){
_id = id;
}
public void setAddress(String address){
_address = address;
}
public void setMsg(String msg){
_msg = msg;
}
public void setReadState(String readState){
_readState = readState;
}
public void setTime(String time){
_time = time;
}
public void setFolderName(String folderName){
_folderName = folderName;
}

} 
```

不要忘记在您的 AndroidManifest.xml 中定义权限

```
<uses-permission android:name="android.permission.READ_SMS" /> 
```

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2009-05-12T08:03:35.153

这是一个微不足道的过程。您可以在源代码[SMSPopup中看到一个很好的示例](https://github.com/everythingandroid/android-smspopup)

检查以下方法：

```
SmsMmsMessage getSmsDetails(Context context, long ignoreThreadId, boolean unreadOnly)
long findMessageId(Context context, long threadId, long _timestamp, int messageType
void setMessageRead(Context context, long messageId, int messageType)
void deleteMessage(Context context, long messageId, long threadId, int messageType) 
```

这是阅读的方法：

```
SmsMmsMessage getSmsDetails(Context context,
                            long ignoreThreadId, boolean unreadOnly)
{
   String SMS_READ_COLUMN = "read";
   String WHERE_CONDITION = unreadOnly ? SMS_READ_COLUMN + " = 0" : null;
   String SORT_ORDER = "date DESC";
   int count = 0;
   // Log.v(WHERE_CONDITION);
   if (ignoreThreadId > 0) {
      // Log.v("Ignoring sms threadId = " + ignoreThreadId);
      WHERE_CONDITION += " AND thread_id != " + ignoreThreadId;
   }
   Cursor cursor = context.getContentResolver().query(
                      SMS_INBOX_CONTENT_URI,
                      new String[] { "_id", "thread_id", "address", "person", "date", "body" },
                      WHERE_CONDITION,
                      null,
                      SORT_ORDER);
   if (cursor != null) {
      try {
         count = cursor.getCount();
         if (count > 0) {
            cursor.moveToFirst();
            // String[] columns = cursor.getColumnNames();
            // for (int i=0; i<columns.length; i++) {
            // Log.v("columns " + i + ": " + columns[i] + ": " + cursor.getString(i));
            // }                                         
            long messageId = cursor.getLong(0);
            long threadId = cursor.getLong(1);
            String address = cursor.getString(2);
            long contactId = cursor.getLong(3);
            String contactId_string = String.valueOf(contactId);
            long timestamp = cursor.getLong(4);

            String body = cursor.getString(5);                             
            if (!unreadOnly) {
                count = 0;
            }

            SmsMmsMessage smsMessage = new SmsMmsMessage(context, address,
                          contactId_string, body, timestamp,
                          threadId, count, messageId, SmsMmsMessage.MESSAGE_TYPE_SMS);
            return smsMessage;
         }
      } finally {
         cursor.close();
      }
   }               
   return null;
} 
```

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2017-01-04T12:08:13.113

从 API 19 开始，您可以使用 Telephony Class；由于硬核值不会在每个设备中检索消息，因为内容提供者 Uri 从设备和制造商中更改。

```
public void getAllSms(Context context) {

    ContentResolver cr = context.getContentResolver();
    Cursor c = cr.query(Telephony.Sms.CONTENT_URI, null, null, null, null);
    int totalSMS = 0;
    if (c != null) {
        totalSMS = c.getCount();
        if (c.moveToFirst()) {
            for (int j = 0; j < totalSMS; j++) {
                String smsDate = c.getString(c.getColumnIndexOrThrow(Telephony.Sms.DATE));
                String number = c.getString(c.getColumnIndexOrThrow(Telephony.Sms.ADDRESS));
                String body = c.getString(c.getColumnIndexOrThrow(Telephony.Sms.BODY));
                Date dateFormat= new Date(Long.valueOf(smsDate));
                String type;
                switch (Integer.parseInt(c.getString(c.getColumnIndexOrThrow(Telephony.Sms.TYPE)))) {
                    case Telephony.Sms.MESSAGE_TYPE_INBOX:
                        type = "inbox";
                        break;
                    case Telephony.Sms.MESSAGE_TYPE_SENT:
                        type = "sent";
                        break;
                    case Telephony.Sms.MESSAGE_TYPE_OUTBOX:
                        type = "outbox";
                        break;
                    default:
                        break;
                }

                c.moveToNext();
            }
        }

        c.close();

    } else {
        Toast.makeText(this, "No message to show!", Toast.LENGTH_SHORT).show();
    }
} 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2015-08-22T06:53:51.383

这篇文章有点老了，但这是另一个`SMS`在 Android 中获取与内容提供者相关的数据的简单解决方案：

使用这个库：[https ://github.com/EverythingMe/easy-content-providers](https://github.com/EverythingMe/easy-content-providers)

*   全部获取`SMS`：

    ```
    TelephonyProvider telephonyProvider = new TelephonyProvider(context);
    List<Sms> smses = telephonyProvider.getSms(Filter.ALL).getList(); 
    ```

    每条**短信**都有所有字段，因此您可以获得所需的任何信息：
    *地址、正文、接收日期、类型（收件箱、已发送、草稿、..）、线程 ID、...*

*   全部凝胶`MMS`：

    ```
    List<Mms> mmses = telephonyProvider.getMms(Filter.ALL).getList(); 
    ```

*   全部凝胶`Thread`：

    ```
    List<Thread> threads = telephonyProvider.getThreads().getList(); 
    ```

*   全部凝胶`Conversation`：

    ```
    List<Conversation> conversations = telephonyProvider.getConversations().getList(); 
    ```

它与`List`or一起使用，`Cursor`并且有一个示例应用程序可以查看它的外观和工作方式。

事实上，它支持所有 Android 内容提供者，例如：*联系人、通话记录、日历……* 包含所有选项的完整文档：[https ://github.com/EverythingMe/easy-content-providers/wiki/Android-提供者](https://github.com/EverythingMe/easy-content-providers/wiki/Android-providers)

希望它也有帮助:)

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2018-03-06T17:45:30.297

已经有多个答案可用，但我认为所有答案都缺少这个问题的重要部分。在从内部数据库或其表中读取数据之前，我们必须了解数据是如何存储在其中的，然后才能找到上述问题的解决方案：

**如何在 Android 中以编程方式从设备读取 SMS 消息？**

在 android SMS 表中看起来像这样

[![在此处输入图像描述](https://i.stack.imgur.com/VdX2H.png)](https://i.stack.imgur.com/VdX2H.png)

现在您可以从数据库中选择您想要的任何内容。在我们的例子中，我们只需要

> 身份证、地址和正文

在阅读短信的情况下：

**1.请求权限**

```
int REQUEST_PHONE_CALL = 1;

   if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.READ_SMS) != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.READ_SMS}, REQUEST_PHONE_CALL);
        } 
```

或者

```
 <uses-permission android:name="android.permission.READ_SMS" /> 
```

**2.现在你的代码是这样的**

```
// Create Inbox box URI
Uri inboxURI = Uri.parse("content://sms/inbox");

// List required columns
String[] reqCols = new String[]{"_id", "address", "body"};

// Get Content Resolver object, which will deal with Content Provider
ContentResolver cr = getContentResolver();

// Fetch Inbox SMS Message from Built-in Content Provider
Cursor c = cr.query(inboxURI, reqCols, null, null, null);

// Attached Cursor with adapter and display in listview
adapter = new SimpleCursorAdapter(this, R.layout.a1_row, c,
        new String[]{"body", "address"}, new int[]{
        R.id.A1_txt_Msg, R.id.A1_txt_Number});
lst.setAdapter(adapter); 
```

我希望这会有所帮助。谢谢。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2016-10-06T04:20:08.603

**第 1 步：**首先我们必须在清单文件中添加权限，例如

```
<uses-permission android:name="android.permission.RECEIVE_SMS" android:protectionLevel="signature" />
<uses-permission android:name="android.permission.READ_SMS" /> 
```

**步骤2：**然后添加服务短信接收器类用于接收短信

```
<receiver android:name="com.aquadeals.seller.services.SmsReceiver">
    <intent-filter>
        <action android:name="android.provider.Telephony.SMS_RECEIVED"/>
    </intent-filter>
</receiver> 
```

**第三步：**添加运行时权限

```
private boolean checkAndRequestPermissions()
{
    int sms = ContextCompat.checkSelfPermission(this, Manifest.permission.READ_SMS);

    if (sms != PackageManager.PERMISSION_GRANTED)
    {
        ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.READ_SMS}, REQUEST_ID_MULTIPLE_PERMISSIONS);
        return false;
    }
    return true;
} 
```

**第 4 步：**在您的应用程序中添加这些类并测试 **接口类**

```
public interface SmsListener {
   public void messageReceived(String messageText);
} 
```

**短信接收器.java**

```
public class SmsReceiver extends BroadcastReceiver {
    private static SmsListener mListener;
    public Pattern p = Pattern.compile("(|^)\\d{6}");
    @Override
    public void onReceive(Context context, Intent intent) {
        Bundle data  = intent.getExtras();
        Object[] pdus = (Object[]) data.get("pdus");
        for(int i=0;i<pdus.length;i++)
        {
            SmsMessage smsMessage = SmsMessage.createFromPdu((byte[]) pdus[i]);
            String sender = smsMessage.getDisplayOriginatingAddress();
            String phoneNumber = smsMessage.getDisplayOriginatingAddress();
            String senderNum = phoneNumber ;
            String messageBody = smsMessage.getMessageBody();
            try{
                if(messageBody!=null){
                    Matcher m = p.matcher(messageBody);
                    if(m.find()) {
                        mListener.messageReceived(m.group(0));
                    }
                }
            }
            catch(Exception e){}
        }
    }
    public static void bindListener(SmsListener listener) {
        mListener = listener; 
    }
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-08-07T04:37:57.470

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2019-01-26T17:04:57.307

**最简单的功能**

为了阅读短信，我编写了一个返回 Conversation 对象的函数：

```
class Conversation(val number: String, val message: List<Message>)
class Message(val number: String, val body: String, val date: Date)

fun getSmsConversation(context: Context, number: String? = null, completion: (conversations: List<Conversation>?) -> Unit) {
        val cursor = context.contentResolver.query(Telephony.Sms.CONTENT_URI, null, null, null, null)

        val numbers = ArrayList<String>()
        val messages = ArrayList<Message>()
        var results = ArrayList<Conversation>()

        while (cursor != null && cursor.moveToNext()) {
            val smsDate = cursor.getString(cursor.getColumnIndexOrThrow(Telephony.Sms.DATE))
            val number = cursor.getString(cursor.getColumnIndexOrThrow(Telephony.Sms.ADDRESS))
            val body = cursor.getString(cursor.getColumnIndexOrThrow(Telephony.Sms.BODY))

            numbers.add(number)
            messages.add(Message(number, body, Date(smsDate.toLong())))
        }

        cursor?.close()

        numbers.forEach { number ->
            if (results.find { it.number == number } == null) {
                val msg = messages.filter { it.number == number }
                results.add(Conversation(number = number, message = msg))
            }
        }

        if (number != null) {
            results = results.filter { it.number == number } as ArrayList<Conversation>
        }

        completion(results)
    } 
```

使用：

```
getSmsConversation(this){ conversations ->
    conversations.forEach { conversation ->
        println("Number: ${conversation.number}")
        println("Message One: ${conversation.message[0].body}")
        println("Message Two: ${conversation.message[1].body}")
    }
} 
```

或仅获取特定号码的对话：

```
getSmsConversation(this, "+33666494128"){ conversations ->
    conversations.forEach { conversation ->
        println("Number: ${conversation.number}")
        println("Message One: ${conversation.message[0].body}")
        println("Message Two: ${conversation.message[1].body}")
    }
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-01-07T15:45:12.057

阅读短信的 Kotlin 代码：

1-将此权限添加到 AndroidManifest.xml ：

```
 <uses-permission android:name="android.permission.RECEIVE_SMS"/> 
```

2-创建一个广播接收器类：

```
package utils.broadcastreceivers

import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.telephony.SmsMessage
import android.util.Log

class MySMSBroadCastReceiver : BroadcastReceiver() {
override fun onReceive(context: Context?, intent: Intent?) {
    var body = ""
    val bundle = intent?.extras
    val pdusArr = bundle!!.get("pdus") as Array<Any>
    var messages: Array<SmsMessage?>  = arrayOfNulls(pdusArr.size)

 // if SMSis Long and contain more than 1 Message we'll read all of them
    for (i in pdusArr.indices) {
        messages[i] = SmsMessage.createFromPdu(pdusArr[i] as ByteArray)
    }
      var MobileNumber: String? = messages[0]?.originatingAddress
       Log.i(TAG, "MobileNumber =$MobileNumber")         
       val bodyText = StringBuilder()
        for (i in messages.indices) {
            bodyText.append(messages[i]?.messageBody)
        }
        body = bodyText.toString()
        if (body.isNotEmpty()){
       // Do something, save SMS in DB or variable , static object or .... 
                       Log.i("Inside Receiver :" , "body =$body")
        }
    }
 } 
```

3-如果是 Android 6 及更高版本，则获取 SMS 权限：

```
 if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && 
    ActivityCompat.checkSelfPermission(context!!,
            Manifest.permission.RECEIVE_SMS
        ) != PackageManager.PERMISSION_GRANTED
    ) { // Needs permission

            requestPermissions(arrayOf(Manifest.permission.RECEIVE_SMS),
            PERMISSIONS_REQUEST_READ_SMS
        )

    } else { // Permission has already been granted

    } 
```

4-将此请求代码添加到活动或片段：

```
 companion object {
    const val PERMISSIONS_REQUEST_READ_SMS = 100
   } 
```

5-覆盖检查权限请求结果乐趣：

```
 override fun onRequestPermissionsResult(
    requestCode: Int, permissions: Array<out String>,
    grantResults: IntArray
) {
    when (requestCode) {

        PERMISSIONS_REQUEST_READ_SMS -> {
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                Log.i("BroadCastReceiver", "PERMISSIONS_REQUEST_READ_SMS Granted")
            } else {
                //  toast("Permission must be granted  ")
            }
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-09-28T02:54:02.013

```
String WHERE_CONDITION = unreadOnly ? SMS_READ_COLUMN + " = 0" : null; 
```

更改为：

```
String WHERE_CONDITION = unreadOnly ? SMS_READ_COLUMN + " = 0 " : SMS_READ_COLUMN + " = 1 "; 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2021-03-31T02:56:48.983

Hier 是一个很棒的视频教程！！！！效果很好！！！

它是来自带有数字的 Google 表格列表和 Android 应用程序的组合。（对于没有编码人员也很容易遵循教程！！！

按照教程的链接：

[https://www.youtube.com/watch?v=PReU4ITp37I&list=PLuB9drjjGa0QvFzWq_bwO8bOTRaWpdP_d&index=2](https://www.youtube.com/watch?v=PReU4ITp37I&list=PLuB9drjjGa0QvFzWq_bwO8bOTRaWpdP_d&index=2)

以下是 Google App 脚本的代码：

```
const SHEET_URL = "https://docs.google.com/spreadsheets/d/16_fp7lQsnaMLaDYMVsE5YxsohQBANllEVcZeMP5ZpiU/edit#gid=0";
const SHEET_NAME = "SMS";

const doGet = () => {
  const sheet = SpreadsheetApp.openByUrl(SHEET_URL).getSheetByName(SHEET_NAME);
  const [header, ...data] = sheet.getDataRange().getDisplayValues();

  const PHONE = header.indexOf("Phone");
  const TEXT = header.indexOf("Text");
  const STATUS = header.indexOf("Status");

  const output = [];

 data.forEach((row, index) => {
  if (row[STATUS] === "") {
    output.push([index+1, row[PHONE], row[TEXT]]);
  }
});

const json = JSON.stringify(output);

return ContentService.createTextOutput(json).setMimeType(ContentService.MimeType.TEXT);
}

const doPost = (e) => {
  const sheet = SpreadsheetApp.openByUrl(SHEET_URL).getSheetByName(SHEET_NAME);
  const [header] = sheet.getRange("A1:1").getValues();
  const STATUS = header.indexOf("Status");
  var rowId = Number(e.parameter.row);
  sheet.getRange(rowId + 1, STATUS +1).setValue("SMS Sent");
  return ContentService.createTextOutput("").setMimeType(ContentService.MimeType.TEXT);
} 
```

然后你只需要关注视频的第二部分，他在 MIT App Inventer 中构建 Android APP。我做了一个截图来看看这个项目

[![在此处输入图像描述](https://i.stack.imgur.com/JyHie.png)](https://i.stack.imgur.com/JyHie.png)

# c# - 使用外部文件或资源？

> ID：848729
> 
> 赞同：4
> 
> 时间：2009-05-11T15:46:20.273
> 
> 标签：c#, .net, resources, embedded-resource

我正在编写一个使用长“硬编码”字符串的 C# 应用程序。

出于可维护性的原因，我决定将此字符串放在外部文本文件中并加载它。这是一个好主意吗？在这种情况下，额外的 I/O 似乎并不大。

我意识到我还可以选择将此文件嵌入为 .resx 资源。这是一个更好的主意吗？该文件永远不需要本地化。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-11T15:54:25.253

如果您打算允许用户/管理员更改字符串，我同意其他答案，我建议将其放入设置中。

如果您不希望它在部署后可编辑并且只能由您和您的开发人员修改，那么我会将其放入嵌入式资源中（注意，这与 .resx 文件不同）。你会在运行时像这样阅读它：

```
Assembly assembly = Assembly.GetExecutingAssembly();
Stream stream = assembly.GetManifestResourceStream(“MyAssemblyNamespace.MyTextFile.txt”);
StreamReader reader = new StreamReader(stream);
string theText = streamReader.ReadToEnd(); 
```

**更新：**这是易于维护的解决方案。.txt 文件将只是 Visual Studio 中解决方案资源管理器中的另一个文件，您可以像编辑任何其他文件一样对其进行编辑，像任何其他文件一样将其置于源代码控制之下，等等。通过更改 Build 将其变成嵌入式资源在属性窗口中对“嵌入式资源”进行操作。

最终结果是您的文件被嵌入到您的 DLL 中，因此您只有 1 个 DLL 可以分发，而不是一个 DLL 和一个必须一起移动的文件文件夹。

**更新 2：**关于“生产调试”，这是一个非常静态的解决方案，因此您将无法在运行时更改文本文件的内容，因为该文件在编译时被烘焙到 DLL 中。为了读取文件的内容，您可以使用[反射器](http://www.red-gate.com/products/reflector/)等工具来查看 DLL 的嵌入式资源。您还可以编写一个简单的命令行工具，将所有嵌入的 .txt 文件从 DLL 转储到单独的文件中供您查看。

对于内存使用，没有比“我只在需要时才将它从文件加载到内存中”更有效的解决方案。当您的 DLL 针对您的特定情况加载到内存中时，您必须确定改进的可维护性和部署是否值得花费一点额外内存。也就是说，您还没有说这些文件有多大。如果它们真的很大（兆字节+），我可能*不会*使用这个解决方案，并且会在硬盘驱动器上使用松散的文件。如果它们通常很小（数百千字节），我不会担心额外的内存，除非您处于 RAM 非常紧张的某种嵌入式设备情况。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T15:50:12.890

为什么不在您的 web/app.config 文件中将其设置为 appSetting？

```
<appSettings>
   <add key="MyLongString" value="This is a really long string value that I don't want hardcoded" />
</appSettings> 
```

然后，在代码中：

```
using System.Configuration;    //To ease your typing pains

var myReallyLongString = ConfigurationManager.AppSettings["MyLongString"]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T15:48:53.733

我建议使用应用程序设置。

您可以按照此 MSDN 链接[如何使用应用程序和用户设置](http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T15:49:39.787

我会把它放在一个[应用程序配置文件](http://msdn.microsoft.com/en-us/library/ms229689(vs.71).aspx)中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T15:49:41.300

更好的方法是将设置文件添加到您的项目中。然后，您可以通过 Visual Studio 轻松添加配置设置。请参阅[此链接](http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx)。

然后，您可以使用以下命令访问您的字符串：

```
Settings.Default.MyString; 
```

此外，设置是强类型的，因此您在检索它们时不需要进行任何转换。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T19:04:11.293

为了更直接地回答您的问题，“最佳实践”是在您的应用程序中为任何可本地化（即使您不打算对其进行本地化）字符串使用资源文件。这允许您在编译时访问字符串，并防止它被外部化为单独的文件以与您的应用程序一起部署。

我建议使用这种方法；设置是相似的，但除非你存储在那里的内容实际上代表了一个设置，否则不应使用它。常量是另一种选择，但在长字符串的情况下，我会远离它们，只是为了可维护性。

# java - HTML/JSP 疑问，在网页上打印日期

> ID：848731
> 
> 赞同：0
> 
> 时间：2009-05-11T15:46:46.233
> 
> 标签：java, html, datetime, jsp

我制作了一个在网页上显示日期的功能，并将其上传到某个服务器上......

但是当我更改系统的日期时，我注意到日期取决于客户端计算机..

是否无法从实际时间服务器获取日期并将该代码嵌入到我的程序中..

希望我能够解释我的疑问..请用小的示例代码给出一些解决方案..这会很有帮助..

非常感谢..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T16:16:01.177

如果你是用 javascript 编写的，那么……它总是在客户端执行。如果您通过 javascript 计算日期，则为时已晚，该代码已消失。

为了解决这个问题，你必须让你的js函数通过参数接收数据，并且数据应该在服务器端计算。

你可以做类似的事情。

```
<%@ page import ="java.util.Date" %><%--Imports date --%>
<% Date date = new Date();
   String strdate = date.toString();//could be formatted using SimpleDateFormat.
%>

  <!--must be inside a form -->  
  <input type="text" value="javascript:showDate('<%=strdate%>');"/>

  <!--must be inside a table-->
  <td>javascript:showDate(<%=strdate%>);</td> 
```

或者更优雅地，在您的 java 类中获取服务器日期，并将其写入请求：

```
//formattedDate is defined above, in the format you like the most. Could be a 
//java.util.date or a String
request.setDate("date",formattedDate); 
```

然后，在您的 jsp 中，使用例如 JSTL

```
<c:out value="${formattedDate}"/> 
```

或者，

```
<% //this java code is run on the server side.
    String strdate = (String)request.getAttribute("date"); 
 %>
<%=strdate%><!-- prints strdate to jsp. Could put it in a table, form, etc --> 
```

***编辑***：针对您的评论，您应该：

```
<%--Imports java packages --%>
<%@ page import ="java.util.Date" %>
<%@ page import ="java.text.SimpleDateFormat"%>

<%-- Java code --%>
<% Date date = new Date();
   Calendar calendar = Calendar.getInstance(TIME_ZONE).setTime(date);
   SimpleDateFormat sdf = new SimpleDateFormat("MM/dd/yy");
   String strdate = sdf.format(calendar.getTime());
%>

<html>
 <body>
 <!-- Does not need to use javascript. All work is done on the server side.-->
 <table>
   <tr>
     <td><%=strdate%></td>
   </tr>
 </table>
 </body>
</html> 
```

我不知道你的时区是什么，但我相信你知道。Calendar.getInstance() 将 TimeZone 的实例作为参数。应该这样做

看一看：

[http://java.sun.com/javase/6/docs/api/java/util/TimeZone.html](http://java.sun.com/javase/6/docs/api/java/util/TimeZone.html)

[http://java.sun.com/javase/6/docs/api/java/util/Calendar.html](http://java.sun.com/javase/6/docs/api/java/util/Calendar.html)

[关于 JSP 的有趣链接](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:13:17.157

使用来自服务器的日期初始化函数

`var d = new Date(<%= new SimpleDateFormat("yyyy, M-1, dd").format(new Date()) %>);`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T15:54:47.420

您编写了一个 javascript 函数，该函数显然取决于客户端中设置的日期

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:09:29.393

根据您的服务器端语言，只需使用它的 date() 函数，该函数根据服务器时钟给出当前日期/时间。接下来，格式化该信息并将其作为设定值发送给客户端。

例如，在 php 中：

```
echo date(); 
```

# java - 在 JBoss 配置中加密敏感信息

> ID：848734
> 
> 赞同：11
> 
> 时间：2009-05-11T15:46:59.883
> 
> 标签：java, spring, tomcat, jakarta-ee, jboss

JBoss 中的标准数据源配置要求数据库用户的用户名和密码在 xxx-ds.xml 文件中。如果我将我的数据源定义为 c3p0 mbean，我会遇到同样的问题。

有没有标准的方法来加密用户和密码？保存密钥的好地方是什么？

这当然也与 tomcat 相关——context.xml 文件、spring 配置文件等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T15:54:53.990

有一个 wiki 文档：[http](http://www.jboss.org/community/docs/DOC-9703) ://www.jboss.org/community/docs/DOC-9703描述了这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-20T08:43:16.080

对于 spring 部分，您可以使用自己的 spring 的 PropertyPlaceholderConfigurer 扩展，并覆盖 String convertPropertyValue(String originalValue)。正如该方法的 javadoc 中提到的那样（实际上在超类 PropertyResourceConfigurer 中）：

> 将给定的属性值从属性源转换为应应用的值。
> 
> 默认实现只返回原始值。可以在子类中被覆盖，例如检测加密值并相应地解密它们。

这意味着您可以在 spring xml 文件中使用 ${encoded.value} 配置您的数据源，并在将解码后的值注入数据源之前解码该值。

# sql-server - 加载数据后制作主键和标识列

> ID：848738
> 
> 赞同：1
> 
> 时间：2009-05-11T15:48:13.220
> 
> 标签：sql-server, tsql, primary-key, identity

我有一个快速的问题要问你 SQL 大师。我有没有主键列的现有表，并且未设置身份。现在我试图通过将现有整数列作为主键并为该列添加标识值来修改这些表。我的问题是在进行这些更改之前，我是否应该先将表中的所有记录复制到临时表中。如果我运行 T-SQL commnad 来创建主键并在这些表上添加标识列，我是否会丢失所有以前的记录。我应该采取哪些方法，例如

1）创建临时表以复制要修改的表中的所有记录 2）将所有记录加载到临时表中 3）对表架构进行更改 4）最后将临时表中的记录加载到原始表中。

或者

有更好的方法吗？我真的很感谢你的帮助

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T15:55:29.683

工具>选项>设计器>表和数据库设计器

取消选中“防止保存需要重新创建表的更改”

[编辑]我已经用填充的表尝试过这个并且我没有丢失数据，但我对此知之甚少。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:13:43.207

希望表中没有太多记录。如果您使用 Management Studio 将现有字段更改为身份，会发生什么情况，它会创建另一个带有身份字段集的表。它打开标识插入并插入原始表中的记录，然后关闭标识插入。然后它删除旧表并重命名它刚刚创建的表。如果您有很多记录，这可能是一个相当漫长的过程。如果是这样，我会编写脚本，然后在下班时间运行的作业中执行此操作，因为在您执行此操作时表将完全锁定。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T15:55:07.187

只需在管理工作室中进行所有更改，将生成的脚本复制/粘贴到文件中。此时不要保存更改。根据需要查看并编辑该脚本，它可能几乎完全按照您的想法执行（它将删除原始表并将临时表重命名为原始名称），但也处理所有约束和 FK。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T15:52:40.590

如果您现有的整数列是唯一且合适的，则将其转换为 PK 应该没有问题。

另一种选择，如果您不想使用现有列，您可以向主表添加一个新的 PK 列，填充它并为其播种，然后运行更新语句以使用新的 PK 更新所有其他表。

不管你怎么做，一定要先做好备份！！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T15:55:49.650

完成数据复制后，您始终可以添加 IDENTITY 列。然后，您还可以将 IDENTITY 种子重置为最大整数 + 1。这应该可以解决您的问题。

DBCC CHECKIDENT ('MyTable', RESEED, n)

其中 n 是您希望身份开始的数字。

# .net - Crystal Report 无法在 Windows 2003 操作系统上加载

> ID：848750
> 
> 赞同：0
> 
> 时间：2009-05-11T15:51:03.293
> 
> 标签：.net, crystal-reports

Crystal Report 10 无法在 Windows 2003 操作系统上加载。我们正在使用带有 C#.net 的 .net 3.5 进行开发。

它在包含类似配置但没有 McAFEE 防病毒软件的开发盒上正常工作。

任何指针将不胜感激。

错误信息：

```
[COMException (0x800002ad): Error in File UNKNOWN.RPT:
The request could not be submitted for background processing.]
   CrystalDecisions.ReportAppServer.ClientDoc.ReportClientDocumentClass
                            .Open(Object& DocumentPath, Int32 Options) +0
   CrystalDecisions.ReportAppServer.ReportClientDocumentWrapper
                              .Open(Object& DocumentPath, Int32 Options) +95
   CrystalDecisions.ReportAppServer.ReportClientDocumentWrapper
                                       .EnsureDocumentIsOpened() +271 
```

错误：`http://xxx/Reports/AgencyDetailReport.aspx`。错误信息：`Load report failed`。

```
TARGETSITE: Void EnsureDocumentIsOpened() STACKTRACE: at 
   CrystalDecisions.ReportAppServer.ReportClientDocumentWrapper
   .EnsureDocumentIsOpened() at CrystalDecisions.CrystalReports.Engine.
      ReportDocument.Load(String filename, OpenReportMethod openMethod,
Int16 parentJob) at CrystalDecisions.CrystalReports.Engine.ReportDocument.
    Load(String filename) at Reports_AgencyDetailReport
          .CreateCrystalReportDocument(ReportObject rptObj) in
     c:\xxx\testapplication\Reports\AgencyDetailReport.aspx.cs:line 122
     at Reports_AgencyDetailReport.Button1_Click(Object sender, EventArgs e) 
      in c:\xxx\testapplication\Reports\AgencyDetailReport.aspx.cs:line 99 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T08:54:32.123

这是一个许可问题。我设置了“网络服务”用户对我的“C：”驱动器的权限，该驱动器具有应用程序以及所需的软件。

授予权限后，水晶报表开始显示。

感谢您的回复。特别是@Arvo

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:27:58.287

查看堆栈跟踪，似乎无法在指定路径上找到文件，或者对文件（或目录）的访问可能是一个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-17T09:54:25.990

为 64 位应用程序的 VS 2010 运行时安装 CR 然后，创建一个具有池管理员权限的新集成池。

# c# - WebBrowser 事件属性？

> ID：848757
> 
> 赞同：1
> 
> 时间：2009-05-11T15:52:48.877
> 
> 标签：c#, events, webbrowser-control

我能否确定某个功能是否已分配给某个事件？

例如（带有网络浏览器控制的标准 winforms 应用程序）

```
namespace Crawler {
    public partial class Form1 : Form {

        WebCrawler.manager m;

        public Form1() {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e) {
            system.windows.forms.webbrowser wb = new system.windows.forms.webbrowser();
            wb.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(foo);

            //[... Some other code ...]

            /* [Begin Example] */

            if (wb.DocumentCompleted.Contains(foo){

                // Behave Normally

            }else {

                // Do Something Else...

            }
        }
    }
} 
```

而且，如果我可以做我上面描述的事情，那该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T15:55:06.827

你可以打电话[`Deletegate.GetInvocationList`](http://msdn.microsoft.com/en-us/library/system.delegate.getinvocationlist.aspx)。

这是一个例子：

```
using System;
using System.Linq;

class Program
{
    static event Action foo;

    static void bar() { }

    static void Main()
    {
        foo += bar;

        bool contains = foo
            .GetInvocationList()
            .Cast<Action>()
            .Contains(bar);
    }   
} 
```

# regex - 使用 MATLAB 正则表达式将重叠模式与捕获匹配

> ID：848759
> 
> 赞同：3
> 
> 时间：2009-05-11T15:53:54.943
> 
> 标签：regex, matlab

我正在尝试解析如下所示的日志文件：

```
%%%% 09-May-2009 04:10:29
% Starting foo
this is stuff
to ignore
%%%% 09-May-2009 04:10:50
% Starting bar
more stuff
to ignore
%%%% 09-May-2009 04:11:29
... 
```

这段摘录包含我想提取的两个时间段，从第一个分隔符到第二个，从第二个到第三个。我想使用正则表达式来提取每个间隔的开始和停止时间。这主要有效：

```
p = '%{4} (?<start>.*?)\n% Starting (?<name>.*?)\n.*?%{4} (?<stop>.*?)\n';
times = regexp(c,p,'names'); 
```

返回：

```
times = 

1x16 struct array with fields:
    start
    name
    stop 
```

问题是这只捕获每隔一个周期，因为第二个分隔符作为第一个匹配的一部分被消耗。

在其他语言中，您可以使用环视运算符（lookahead、lookbehind）来解决此问题。[正则表达式](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/f0-42649.html)的文档解释了这些在 MATLAB 中是如何工作的，但我无法在捕获匹配项的同时让这些工作。也就是说，我不仅需要能够匹配每个分隔符，还需要提取匹配的一部分（时间戳）。

这可能吗？

PS我意识到我可以通过编写一个简单的状态机或通过匹配分隔符和后处理来解决这个问题，如果没有办法让它工作的话。

**更新：**感谢大家的解决方法。我从开发人员那里得知，目前无法使用 MATLAB 中的正则表达式引擎来执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:00:53.527

MATLAB 似乎无法在不将字符从字符串中删除的情况下将它们捕获为标记（或者，我应该说，*我*无法使用 MATLAB [REGEXP](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/regexpi.html)这样做）。但是，通过注意到一个文本块的停止时间等于下一个文本块的开始时间，我能够使用 REGEXP 仅捕获开始时间和名称，然后进行一些简单的处理以从开始时间。我使用了以下示例文本：

```
c =

%%%% 09-May-2009 04:10:29
% Starting foo
this is stuff
to ignore
%%%% 09-May-2009 04:10:50
% Starting bar
more stuff
to ignore
%%%% 09-May-2009 04:11:29
some more junk 
```

...并应用以下表达式：

```
p = '%{4} (?<start>[^\n]*)\n% Starting (?<name>[^\n]*)[^%]*|%{4} (?<start>[^\n]*).*'; 
```

然后可以使用以下代码完成处理：

```
names = regexp(c,p,'names');
[names.stop] = deal(names(2:end).start,[]);
names = names(1:end-1); 
```

...这为我们提供了上述示例文本的这些结果：

```
>> names(1)

ans = 

    start: '09-May-2009 04:10:29'
     name: 'foo'
     stop: '09-May-2009 04:10:50'

>> names(2)

ans = 

    start: '09-May-2009 04:10:50'
     name: 'bar'
     stop: '09-May-2009 04:11:29' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T21:23:52.117

如果您正在进行大量解析和此类工作，您可以考虑[在 Matlab 中使用 Perl](http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/ref/perl.html)。它使您可以访问强大的 Perl 正则表达式引擎，还可能使许多其他问题更容易解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:33:45.003

您所要做的就是在与第二个时间戳匹配的正则表达式部分周围进行前瞻：

```
'%{4} (?<start>.*?)\n% Starting (?<name>.*?)\n.*?(?=%{4} (?<stop>.*?)\n)' 
```

编辑：这里没有命名组：

```
'%{4} (.*?)\n% Starting (.*?)\n.*?(?=%{4} (.*?)\n)' 
```

# memory-management - Cheat O'Matic 是如何工作的？

> ID：848772
> 
> 赞同：11
> 
> 时间：2009-05-11T15:55:48.870
> 
> 标签：memory-management

[这个程序](http://www.freewarereview.info/2007-01/cheat-o-matic_-_manipulate_almost_any_computer_video_game_with_memory_scanning_.html)如何访问其他进程的内存？它如何写入另一个进程的地址空间？不应该是段错误还是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-11T16:00:24.073

具有系统特权级别的程序能够将物理地址映射到它自己的虚拟地址。

Cheat O'Matic（和[poke](http://softwaregadgets.gridspace.net/archives/2006/05/entry_102.html)）将它试图扫描的任何程序的物理地址映射到它自己的虚拟空间中。

完成此操作后，它会扫描所有字节以查找您输入的目标值。它通过要求用户将地址更改为已知值来隔离正确的内存地址，并且基本上在新旧内存之间进行差异以找到更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T16:15:32.630

一种方法是将 DLL（Google 表示“Dll 注入”）注入到您想要监视的地址进程中：该 DLL 然后位于进程内部并且可以使用进程的内存进行操作。spy 进程可以使用进程间通信方法（管道、套接字、任何东西）与它注入到另一个进程中的 DLL 进行通信。

注入 DLL 需要管理员权限（例如，在系统注册表中设置相关条目）。

# php - 使用 PHP 的 SoapClient 将 UTF-16 字符发送到 WCF 服务

> ID：848776
> 
> 赞同：2
> 
> 时间：2009-05-11T15:56:16.810
> 
> 标签：php, soap, utf-8, utf-16

我的 PHP 应用程序正在接受用户输入并将其发送到 WCF Web 服务。有时我的用户从 Word 复制和粘贴，然后将 UTF-16 字符放入他们的消息中，例如“En Dash”\u2013

发生这种情况时，我收到以下错误。

> PHP 致命错误：SOAP-ERROR: Encoding: string '\xe2...' is not a valid utf-8 string in *** on line 31

我尝试将 SoapClient 构造函数的编码选项设置为“UTF-16”。我的请求似乎有效，但我注意到 xml 标头上的编码仍设置为 UTF-8。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T15:51:15.640

WCF 仅适用于 UTF-8，word 默认适用于 UTF-16，这解释了为什么它看起来像 UTF8

尝试使用 mbstring 来纠正问题

# sharepoint - 在哪里可以找到进行 Sharepoint 开发的教程或网络广播？

> ID：848778
> 
> 赞同：2
> 
> 时间：2009-05-11T15:57:31.660
> 
> 标签：sharepoint

在哪里可以找到进行 Sharepoint 开发的教程或网络广播？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:30:10.200

我会看看[www.dotnetrocks.com](http://www.dotnetrocks.com)和[www.dnrtv.com](http://www.dnrtv.com)

具体来说 ：-

*   [Ted Pattison 向我们展示 Sharepoint](http://www.dotnetrocks.com/default.aspx?showNum=189)
*   [Sahil Malik 谈 Sharepoint 2007 第 1 部分](http://www.dnrtv.com/default.aspx?showNum=43)
*   [Sahil Malik 谈 Sharepoint 2007 第 2 部分](http://www.dnrtv.com/default.aspx?showNum=48)
*   [Sahil Malik 谈 Sharepoint 2007 第 3 部分](http://www.dnrtv.com/default.aspx?showNum=55)
*   [Sahil Malik 谈 Sharepoint 2007 第 4 部分](http://www.dnrtv.com/default.aspx?showNum=62)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:00:41.513

非常适合初学者：-

[http://www.microsoft.com/click/SharePointDeveloper/](http://www.microsoft.com/click/SharePointDeveloper/)

这里也有很多很酷的东西：-

[http://www.sharepointdevwiki.com/display/public/Welcome](http://www.sharepointdevwiki.com/display/public/Welcome)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:00:45.773

这是关于sharepoint的[免费教程。](http://www.fpweb.net/sharepoint-hosting/free-sharepoint-tutorials.asp)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:08:49.817

[Robert Shelton](http://www.sheltonblog.com/archive/2007/11/04/series-of-sharepoint-workflow-how-to-videos.aspx)在他的博客上有一系列关于工作流开发的优秀视频，以及可[下载的 .pdf 教程](http://rshelton.com/archive/2007/10/05/sharepoint-document-workflow-with-visual-studio-workshop-documents-download.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T17:43:56.557

Robert Bogue 和 Andrew Connell为 Microsoft制作了一个非常好的[网络广播系列，这对我来说无疑是一本很好的入门书。](http://blogs.msdn.com/emre/archive/2008/05/24/sharepoint-development-webcast-for-net-developers.aspx)

如果您喜欢播客，我可以推荐[SharePoint 播客节目](http://www.sharepointpodshow.com/)，它将让您随时了解 SharePoint 的所有信息 :-)

如果您像我一样是真正的 TDD 信徒，那么[Andrew Woodward](http://www.21apps.com/sharepoint/tdd-at-spbpc-slidedeck/)就是您要去的地方。

# c# - log4net 何时登录？

> ID：848782
> 
> 赞同：3
> 
> 时间：2009-05-11T15:59:57.820
> 
> 标签：c#, reflection, logging, log4net

是否有人对何时记录有任何好的信息，我正在考虑在输入每个 c# 方法时记录一个 INFO 类型并在退出时记录另一个信息..

这被认为是好还是坏？我会看到性能下降吗？

如果我在输入方法时确实记录了 INFO，则想法是记录方法名称以及所有变量和值

知道如何在不输入方法的每个值和名称的情况下自动完成此操作，我想我可以使用反射，但也许我会在这里看到速度变慢？

如果反射会减慢速度，也许我可以在程序失败时使用“REFLECTION”位，因此我可以编写堆栈跟踪、所有变量和值。

对此的任何想法或例子都非常感谢

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T16:06:57.137

您可以将 AOP（面向方面​​的编程）日志记录风格用于方法级别的日志记录。

有一个很好的框架叫做[Log4PostSharp](http://code.google.com/p/postsharp-user-plugins/wiki/Log4PostSharp)。这是 PostSharp 的一个插件，它写入 Log4Net

它基本上归结为使用如下属性装饰您的方法：

```
[Log(LogLevel.Info, "Doing something")]
public void CountCharacters() {
   // do your logic here
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T17:51:05.390

我会为此使用更低的级别 - TRACE（如果它在 log4net 中可用）。DEBUG 适合记录某些特定场合，而 TRACE 更适合用于转储方法调用、参数和类似的东西。绝对不是 INFO，它更适合记录更高级别的功能性内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:01:56.007

我会使用 DEBUG 而不是 INFO，并为您想要登录生产的内容保留 INFO。但这只是我的偏好。

性能会受到影响。必须写入日志文件，任何 I/O 都是性能问题。

我个人将反射用于类似的事情，但这同样会对性能产生影响。您可能希望使用反射方法来实现这一切，该方法获取堆栈中的前一项并从中进行描述。然后你可以从任何地方调用它。

完成后，您可以运行分析器并优化真正导致性能问题的地方。

这是我为 PropertyChanged 的​​东西做的事情。（记住性能命中）

```
 public string Name
    {
        get { return _Name ?? string.Empty; }
        set
        {
            _Name = value;
            NotifyPropertyChange(MethodBase.GetCurrentMethod());
        }
    }

    private void NotifyPropertyChange(MemberInfo info)
    {
        NotifyPropertyChange(info.Name.Replace("set_", string.Empty));
    }

    private void NotifyPropertyChange(string property)
    {
        if (PropertyChanged != null)
            PropertyChanged(this, new PropertyChangedEventArgs(property));
    } 
```

# iphone - 如何确保仅从我的代码访问我的 Web 服务？

> ID：848788
> 
> 赞同：9
> 
> 时间：2009-05-11T16:01:43.043
> 
> 标签：iphone, security, http, https

我正在为我的 iPhone 应用程序编写一个非常简单的 Web 服务。假设这是一个 http 页面，它在[http://mysite/getRand](http://mysite/getRand)返回一个随机数。如何确保此页面只能从我的 iPhone 应用程序访问，而不能从其他客户端访问？我想过做一些简单的密码机制，但可以通过捕获我的应用程序发送的内容来轻松嗅探。

这样做的原因是通过只允许合法请求来降低我的服务器的负载。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-11T16:09:11.330

你真的不能这样做。您的应用程序可以被反汇编，并且二进制文件中的任何秘密都可以在恶意应用程序中复制。

您应该注意的另一种攻击是人们将主机文件设置到他们控制的位置，然后安装允许他们为该域提供签名的根证书。您的应用程序将使用该秘密发布帖子，并且他们只能读出该秘密。他们可以通过这种方式从二进制文件中任何复杂的加密系统中提取密码。

该线程中的大多数想法都容易受到这种攻击。

也就是说，有人足够关心您的应用程序的反汇编的可能性可能相当小。

我只是保持简单。拥有一个硬编码到您的应用程序中的密码。为了防止有人只查看资源并尝试每个字符串，请将其设为两个字符串的 XOR 或特定固定字符串的 AES 解密结果。

显然，您应该通过 SSL 发出请求，否则攻击者只能嗅探流量。

是的，一个坚定的攻击者会绕过该方案，但就像任何 DRM 方案一样，情况总是如此。诀窍是付出太多努力才值得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T18:46:28.547

为了跟进 Simon 的想法，您可以很容易地在您的应用程序中拥有一个密钥字符串，然后发送设备 ID，然后将 DeviceID XOR'ed（或其他一些用于字符串加密的简单算法）与您的密钥字符串一起发送。

由于您知道要使用的键值，因此您可以轻松地在服务器端“解密”此字符串并验证值是否匹配。

这样，每个用户设备的密码都是不同的，并且“密钥”字符串永远不会通过伟大的未清洗互联网的线路发送。:-)

是的，这绝不是不可能弄清楚的，但就像其他人所说的那样，这个想法并不是让它变得不可能。这个想法是让它比它的价值更麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T03:29:45.227

这是一个想法 - 将设备 ID 与来自您的应用程序的请求一起发送。

监控使用的设备 ID - 如果您在附近或同时看到来自不同 IP 的大量请求，则该设备可能被用作发送给您的请求中的固定键 - 阻止它。

对于那些实际从其他应用程序（不是您的应用程序）发送真实设备 ID 的应用程序，您可以监控使用趋势以查看调用是否与您的应用程序的执行模式相匹配 - 就像在某些初始化调用之前设备正在使用一个调用一样通常期望，等等 - 也阻止这些。

基本上，通过能够围绕使用模式改变规则，您可以通过确保它不是像某些随机使用密钥那样的固定目标来更好地适应尝试使用您的服务的人。

您可能还想使用简单的使用密钥以及第一道防线，然后再使用流量分析方法。此外，您寻找的自定义 http 标头值是另一种简单的方法来绊倒一个天真的攻击者。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:39:02.233

我假设您不想使用 SSL？如果你这样做了，那么你可以打开 HTTPS 会话，然后在请求中传递一些密钥。

如果您不想要 SSL，您的选择是有限的：为了拥有伪安全性，我建议使用身份验证和授权方法，并建议使用第三种方法来减少总体流量：

身份验证：客户端应用程序中的生成器，通过与密钥文件组合来创建密钥。可以经常更新密钥文件以提高安全性：假设您每周更新一次密钥文件。回顾一下：生成器将应用程序机密与应用程序外密钥文件相结合，生成用于身份验证的传输的第三个密钥。然后服务器将能够进行身份验证。

授权：当然，您还想锁定恶意应用程序。这里最好有网站的授权机制。除非客户端登录，否则不要替换密钥文件。跟踪用户的密钥文件。等等

减少流量：如果您收到大量流量，或者如果您怀疑有人试图对您的服务器进行 DOS 操作，您还可以让服务器和客户端同步以在程序生成的 URL 上同步请求/响应，该 URL 可能经常更改。如果有人只是向您发出大量请求，那么打开/关闭如此多的 HTTPS 会话是很浪费的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T16:10:36.630

我也会使用带有客户端密钥的 https 协议。您可以为每个人使用一个客户端密钥，或者您甚至可以为每个客户端生成不同的密钥并在您的服务器上“注册”它们。

我想这对于小型项目来说是很多工作，但如果您需要身份验证，这听起来是合适的做法。

您应该检查手机所有者是否不容易看到密钥。请记住，无论如何，有人可以破解它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T03:04:41.663

正如一些答案所说，对其他所有人关闭您的 Web 服务将是一个主要的麻烦。您能希望的最好结果是让黑客更容易使用其他网络服务，而不是使用您的网络服务......

另一个建议是从服务器和客户端上的[随机种子](http://en.wikipedia.org/wiki/Random_seed)生成随机数。服务器需要跟踪所有客户端在随机数序列中的位置，并将该数字与客户端发送的数字相匹配。

客户端还必须注册才能获得对服务器的访问权限。这也将用作身份验证机制。

所以：

```
//Client code:
$sequence = file_get_contents('sequence.txt');
$seed = file_get_contents('seed.txt');
$sequence++;

//Generate the $sequence-th random number
srand($seed);
for ($i = 0; $i <= $sequence; $i++) {
    $num = rand();
}
//custom fetch function
get_info($main_url . '?num=' . $num . '&id' = $my_id); 
```

这将生成与此类似的请求：

`http://webservice.com/get_info.php?num=3489347&id=3`

```
//Server Code: (I'm used to PHP)

//Get the ID and the random number
$id = (int)$_REQUEST['id'];
$rand = (int)$_REQUEST['num'];
$stmt = $db->prepare('SELECT `sequence`, `seed` FROM `client_list` WHERE `id` = :id');
if ($stmt->execute(array(':id' => $id)) {
    list($sequence, $seed) = $stmt->fetch(PDO::FETCH_ASSOC);
}
$sequence++;

//Generate the $sequence-th random number
srand($seed);
for ($i = 0; $i <= $sequence; $i++) {
    $num = rand();
}
if ($num == $rand) {
    //Allow Access
} else {
    //Deny Access
} 
```

通过为每个客户端使用不同的种子，您可以确保黑客无法通过跟踪以前使用的数字来*预测*随机数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T16:05:13.333

我不确定您使用的是哪种网络技术，但如果您使用的是 Ruby on Rails，它会在其所有控制器中使用秘密身份验证令牌来确保恶意代码不会访问破坏性方法（通过 PUSH、POST 或删除）。您需要将该身份验证令牌发送到您的请求正文中的服务器以允许它执行。那应该可以实现我认为您正在寻找的东西。

如果您不使用 Ruby on Rails，那么这种代码身份验证方法可能是一种在您使用的任何技术中研究和实现自己的好方法。

查看[Rails 安全指南](http://guides.rubyonrails.org/security.html)，特别是第 3.1 节（CSRF 对策）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-11T16:05:35.483

你可以做一些事情，比如从 iPhone 加密当前时间和 IP 地址，然后在服务器上解密。缺点是你需要 iPhone 应用程序知道“秘密”密钥，这样只有它才能生成有效的访问令牌......一旦密钥在野外，它被黑客入侵只是时间问题，如果你应用程序真的值得努力。

您可以使用应用程序的一些随机部分来加密响应，该部分旨在使用它，在响应的未加密位中指定二进制文件的位置。然后至少只有有权访问您的二进制文件的客户端才能解密它......但同样，这几乎不是 100% 安全的。

最终，您需要问自己，您想为保护服务付出多少努力，以及您认为黑客会为滥用服务付出多少努力。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T16:06:13.377

我不是 Cocoa Touch 开发人员，但我认为基于 SSL 的 HTTP 身份验证很容易实现，并且可能正是您正在寻找的。

您需要做的就是在服务器端设置 HTTP 身份验证（您没有提到您在服务器端使用的是什么）并在您的网络服务器上创建一个自签名 SSL 证书。完毕。:)

告诉我们有关您的设置的更多信息，我们将能够为您提供进一步的帮助。

# javascript - 区域感知 JavaScript 验证

> ID：848790
> 
> 赞同：2
> 
> 时间：2009-05-11T16:02:14.350
> 
> 标签：javascript, locale, currency

您能否建议一种使用 Javascript 在客户端验证货币价值的区域感知方式？

需要考虑的明显问题：美国和英国的 1,234.56 与欧洲大部分地区的 1.234,56 相同

斯里兰卡

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T19:40:03.683

这是一个免费 javascript 库的链接，可以帮助您：[Dojo Currency Formatter ，在](http://api.dojotoolkit.org/jsdoc/HEAD/dojo.currency.format)[ASP.NET Ajax](http://msdn.microsoft.com/en-gb/library/bb310813.aspx)中也有类似的功能。

# java - 使用 Apache Commons 电子邮件库在 Java 中发送电子邮件

> ID：848794
> 
> 赞同：12
> 
> 时间：2009-05-11T16:02:57.673
> 
> 标签：java, email, smtp, gmail, apache-commons-email

我正在使用 Apache Commons 电子邮件库发送电子邮件，但我无法通过 GMail SMTP 服务器发送它们。
任何人都可以提供与 GMail SMTP 服务器和其他服务器一起使用的示例代码吗？

我正在使用以下不起作用的代码：

```
String[] recipients = {"receiver@gmail.com"};

SimpleEmail email = new SimpleEmail();
email.setHostName("smtp.gmail.com");
email.setAuthentication("sender@gmail.com", "mypasswd");
email.setDebug(true);
email.setSmtpPort(465);

for (int i = 0; i < recipients.length; i++)
{
    email.addTo(recipients[i]);
}

email.setFrom("sender@gmail.com", "Me");
email.setSubject("Test message");
email.setMsg("This is a simple test of commons-email");
email.send(); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T16:07:06.667

向 GMail SMTP 服务器发送电子邮件需要身份验证和 SSL。用户名和密码非常简单。确保您设置了以下属性以启用身份验证和 SSL，并且它应该可以工作。

```
mail.smtp.auth=true
mail.smtp.starttls.enable=true 
```

在示例代码中添加以下内容以启用 TLS。

对于 API-Versions < 1.3 使用：
`email.setTSL(true);`
对于 >= 1.3 版本不推荐使用该方法，而您应该使用：`email.setStartTLSEnabled(true);`

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-10-10T12:03:09.410

请在下面找到有效的代码。显然，您必须将 apache jar 添加到项目的构建路径中。

```
public static void sendSimpleMail() throws Exception {
    Email email = new SimpleEmail();
    email.setSmtpPort(587);
    email.setAuthenticator(new DefaultAuthenticator("your gmail username",
            "your gmail password"));
    email.setDebug(false);
    email.setHostName("smtp.gmail.com");
    email.setFrom("me@gmail.com");
    email.setSubject("Hi");
    email.setMsg("This is a test mail ... :-)");
    email.addTo("you@gmail.com");
    email.setTLS(true);
    email.send();
    System.out.println("Mail sent!");
} 
```

问候，塞尔吉乌

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-22T15:17:51.843

使用 commons.email 对我有用。

```
HtmlEmail email = new HtmlEmail();
email.setHostName("smtp.gmail.com");
email.setSmtpPort(465);
email.setSSL(true); 
```

# cocoa - 如何将普通控件放入 NSView？

> ID：848796
> 
> 赞同：1
> 
> 时间：2009-05-11T16:03:31.463
> 
> 标签：cocoa, webkit, nsview, screensaver

我实际上想要做的是将 WebKitView 放入 ScreenSaver（继承 NSView）中。我对 MacOS X 和 Cocoa 完全陌生（但我非常熟悉 Objective-C 并使用了 GNUStep 的某些部分）。我需要一些布局吗？我想在整个 NSView 中只显示一个控件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T16:45:07.887

在您的方法中，[以通常的方式](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/initWithFrame:)[`initWithFrame:isPreview:`](http://developer.apple.com/documentation/UserExperience/Reference/ScreenSaver/Classes/ScreenSaverView_Class/Reference/Reference.html#//apple_ref/occ/instm/ScreenSaverView/initWithFrame:isPreview:)创建一个 WebView ，然后向自己发送一条消息，传递 Web 视图：`addSubview:`

```
webView = [[WebView alloc] initWithFrame:frame];
[self addSubview:webView]; 
```

如果您想知道应该将哪个矩形作为 WebView 的框架传递，请阅读[View Programming Guide](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaViewsGuide/)。另外，不要忘记释放`webView`in `dealloc`（或 autorelease it in `initWithFrame:isPreview:`）。

获得 Web 视图后，您需要将页面加载到其中。设置适当长的动画间隔（至少几秒钟），并在以下位置加载页面`animateOneFrame`：

```
- (void) animateOneFrame {
    [[webView mainFrame] loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"http://google.com/"]]];
} 
```

您可能还想处理`WebViewProgressFinishedNotification`，并推迟重新加载 Web 视图，直到发生这种情况（以补偿缓慢或浸泡的连接）。您将使用实例变量来执行此操作，该变量在您的通知处理程序方法`YES`中都设置为`initWithFrame:isPreview:`，并测试并设置为`NO`in `animateOneFrame`：

```
- (void) animateOneFrame {
    if (hasFinished) {
        [[webView mainFrame] loadRequest:[NSURLRequest requestWithURL:[NSURL URLWithString:@"http://google.com/"]]];
        hasFinished = NO;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:08:50.753

```
[aScreenSaverView addSubview:aWebKitView]; 
```

但是，当您可以让 UIWebView 自己占据全屏时，为什么还要将 UIWebView 添加到屏幕保护程序视图中呢？在不需要的地方引入视图层次结构并不是一个好主意，因为它增加了显示界面所需的处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-09T05:54:30.283

您也可以通过调用来不必担心动画间隔

```
[self stopAnimation]; 
```

在你的`animateOneFrame`方法结束时。

# jquery - 使用 JQuery 的黄色淡入淡出效果

> ID：848797
> 
> 赞同：103
> 
> 时间：2009-05-11T16:03:37.673
> 
> 标签：jquery

我想实现类似于[37Signals 的 Yellow Fade 效果的东西。](http://www.37signals.com/svn/archives/000558.php)

我正在使用 Jquery 1.3.2

编码

```
(function($) {
   $.fn.yellowFade = function() {
    return (this.css({backgroundColor: "#ffffcc"}).animate(
            {
                backgroundColor: "#ffffff"
            }, 1500));
   }
 })(jQuery); 
```

下一个调用显示黄色淡化带有*框*id 的 DOM 元素。

```
$("#box").yellowFade(); 
```

但它只会让它变黄。15000 毫秒后没有白色背景。

知道为什么它不起作用吗？

**解决方案**

您可以使用：

```
$("#box").effect("highlight", {}, 1500); 
```

但您需要包括：

[effects.core.js](http://dev.jquery.com/view/tags/ui/latest/ui/effects.core.js)
[effects.highlight.js](http://dev.jquery.com/view/tags/ui/latest/ui/effects.highlight.js)

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-05-11T16:07:32.643

这个函数是 jQuery [effects.core.js](http://view.jquery.com/tags/ui/latest/ui/effects.core.js)的一部分：

```
$("#box").effect("highlight", {}, 1500); 
```

正如 Steerpike 在评论中指出的那样，需要包含[effects.core.js](http://dev.jquery.com/view/tags/ui/latest/ui/effects.core.js "effects.core.js")和[effects.highlight.js才能使用它。](http://dev.jquery.com/view/tags/ui/latest/ui/effects.highlight.js "效果.highlight.js")

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2012-10-28T05:47:29.283

我喜欢 Sterling Nichols 的回答，因为它很轻量并且不需要插件。但是，我发现它不适用于浮动元素（例如，当元素为“float:right”时）。因此，无论元素在页面上的位置如何，我都重新编写了代码以正确显示突出显示：

```
jQuery.fn.highlight = function () {
    $(this).each(function () {
        var el = $(this);
        $("<div/>")
        .width(el.outerWidth())
        .height(el.outerHeight())
        .css({
            "position": "absolute",
            "left": el.offset().left,
            "top": el.offset().top,
            "background-color": "#ffff99",
            "opacity": ".7",
            "z-index": "9999999"
        }).appendTo('body').fadeOut(1000).queue(function () { $(this).remove(); });
    });
} 
```

**可选：**
如果您还想匹配元素的边框半径，请使用以下代码：

```
jQuery.fn.highlight = function () {
    $(this).each(function () {
        var el = $(this);
        $("<div/>")
        .width(el.outerWidth())
        .height(el.outerHeight())
        .css({
            "position": "absolute",
            "left": el.offset().left,
            "top": el.offset().top,
            "background-color": "#ffff99",
            "opacity": ".7",
            "z-index": "9999999",
            "border-top-left-radius": parseInt(el.css("borderTopLeftRadius"), 10),
            "border-top-right-radius": parseInt(el.css("borderTopRightRadius"), 10),
            "border-bottom-left-radius": parseInt(el.css("borderBottomLeftRadius"), 10),
            "border-bottom-right-radius": parseInt(el.css("borderBottomRightRadius"), 10)
        }).appendTo('body').fadeOut(1000).queue(function () { $(this).remove(); });
    });
} 
```

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2012-07-21T04:05:22.383

jQuery 效果库为您的应用程序增加了相当多的不必要的开销。你可以只用 jQuery 完成同样的事情。 [http://jsfiddle.net/x2jrU/92/](http://jsfiddle.net/x2jrU/92/)

```
jQuery.fn.highlight = function() {
   $(this).each(function() {
        var el = $(this);
        el.before("<div/>")
        el.prev()
            .width(el.width())
            .height(el.height())
            .css({
                "position": "absolute",
                "background-color": "#ffff99",
                "opacity": ".9"   
            })
            .fadeOut(500);
    });
}

$("#target").highlight(); 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-02-03T10:30:07.833

如下定义您的 CSS：

```
@-webkit-keyframes yellowfade {
    from { background: yellow; }
    to { background: transparent; }
}

@-moz-keyframes yellowfade {
    from { background: yellow; }
    to { background: transparent; }
}

.yft {
    -webkit-animation: yellowfade 1.5s;
       -moz-animation: yellowfade 1.5s;
            animation: yellowfade 1.5s;
} 
```

只需将类添加`yft`到任何项目`$('.some-item').addClass('yft')`

演示：http: [//jsfiddle.net/Q8KVC/528/](http://jsfiddle.net/Q8KVC/528/)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-11T16:08:29.707

```
(function($) {
  $.fn.yellowFade = function() {
    this.animate( { backgroundColor: "#ffffcc" }, 1 ).animate( { backgroundColor: "#ffffff" }, 1500 );
  }
})(jQuery); 
```

应该做的伎俩。将其设置为黄色，然后将其淡化为白色

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-05-11T16:48:01.093

我刚刚在我正在从事的项目中解决了与此类似的问题。默认情况下，animate 函数不能为颜色设置动画。尝试包括[jQuery Color Animations](https://github.com/jquery/jquery-color)。

这里的所有答案都使用这个插件，但没有人提到它。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-10T11:50:21.697

实际上，我有一个只需要 jQuery 1.3x 且没有附加插件的解决方案。

首先，将以下函数添加到您的脚本中

```
function easeInOut(minValue,maxValue,totalSteps,actualStep,powr) {
    var delta = maxValue - minValue;
    var stepp = minValue+(Math.pow(((1 / totalSteps)*actualStep),powr)*delta);
    return Math.ceil(stepp)
}

function doBGFade(elem,startRGB,endRGB,finalColor,steps,intervals,powr) {
    if (elem.bgFadeInt) window.clearInterval(elem.bgFadeInt);
    var actStep = 0;
    elem.bgFadeInt = window.setInterval(
        function() {
            elem.css("backgroundColor", "rgb("+
                easeInOut(startRGB[0],endRGB[0],steps,actStep,powr)+","+
                easeInOut(startRGB[1],endRGB[1],steps,actStep,powr)+","+
                easeInOut(startRGB[2],endRGB[2],steps,actStep,powr)+")"
            );
            actStep++;
            if (actStep > steps) {
            elem.css("backgroundColor", finalColor);
            window.clearInterval(elem.bgFadeInt);
            }
        }
        ,intervals)
} 
```

接下来，使用以下方法调用该函数：

```
doBGFade( $(selector),[245,255,159],[255,255,255],'transparent',75,20,4 ); 
```

我会让你猜参数，它们很容易解释。老实说这个脚本不是我写的，我把它放在一个页面上，然后改变它，让它与最新的 jQuery 一起工作。

注意：在 firefox 3 和 ie 6 上测试过（是的，它也适用于那个旧东西）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-11T16:27:00.537

```
function YellowFade(selector){
   $(selector)
      .css('opacity', 0)
      .animate({ backgroundColor: 'Yellow', opacity: 1.0 }, 1000)
      .animate({ backgroundColor: '#ffffff', opacity: 0.0}, 350, function() {
             this.style.removeAttribute('filter');
              });
} 
```

该行`this.style.removeAttribute('filter')`用于 IE 中的抗锯齿错误。

现在，从任何地方调用 YellowFade，并传递您的选择器

```
YellowFade('#myDivId'); 
```

**信用**：Phil Haack 有一个演示，展示了如何做到这一点。他正在做一个关于 JQuery 和 ASPNet MVC 的演示。

[看看这个视频](http://www.aspnetpodcast.com/VideoFiles/ASPNETPodcast20080727-MVCWithPhilHaack.wmv)

**更新**：你看视频了吗？忘了提这需要[JQuery.Color 插件](http://plugins.jquery.com/files/jquery.color.js.txt)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-11T20:07:00.457

我讨厌添加 23kb 只是为了添加 effects.core.js 和 effects.highlight.js 所以我写了以下内容。它通过使用fadeIn（它是jQuery本身的一部分）来模拟行为来“闪烁”元素：

```
$.fn.faderEffect = function(options){
    options = jQuery.extend({
        count: 3, // how many times to fadein
        speed: 500, // spped of fadein
        callback: false // call when done
    }, options);

    return this.each(function(){

        // if we're done, do the callback
        if (0 == options.count) 
        {
            if ( $.isFunction(options.callback) ) options.callback.call(this);
            return;
        }

        // hide so we can fade in
        if ( $(this).is(':visible') ) $(this).hide();

        // fade in, and call again
        $(this).fadeIn(options.speed, function(){
            options.count = options.count - 1; // countdown
            $(this).faderEffect(options); 
        });
    });
} 
```

然后用 $('.item').faderEffect(); 调用它

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-10-29T12:47:37.100

这是我解决问题的方法。它工作得很好。它通过了 jslint 错误验证，并且在 IE8 和 IE9 中也能正常工作。当然，您可以对其进行调整以接受颜色代码和回调：

```
jQuery.fn.highlight = function(level) {

  highlightIn = function(options){

    var el = options.el;
    var visible = options.visible !== undefined ? options.visible : true;

    setTimeout(function(){
      if (visible) {
        el.css('background-color', 'rgba('+[255, 64, 64]+','+options.iteration/10+')');
        if (options.iteration/10 < 1) {
          options.iteration += 2;
          highlightIn(options);
        }
      } else {
        el.css('background-color', 'rgba('+[255, 64, 64]+','+options.iteration/10+')');
        if (options.iteration/10 > 0) {
          options.iteration -= 2;
          highlightIn(options);
        } else {
          el.css('background-color', '#fff');
        }
      }
    }, 50);
  };

  highlightOut = function(options) {
    options.visible = false;
    highlightIn(options);
  };

  level = typeof level !== 'undefined' ? level : 'warning';
  highlightIn({'iteration': 1, 'el': $(this), 'color': level});
  highlightOut({'iteration': 10, 'el': $(this), 'color': level});
}; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-02-17T17:27:15.227

这是一个非 jQuery 选项，可用于颜色渐变效果。在数组“colors”中，添加从初始颜色到最后一种颜色所需的过渡颜色。您可以根据需要添加任意数量的颜色。

```
 <html lang="en">
   <head>
   <script type="text/javascript">
  //###Face Effect for a text box#######

var targetColor;
var interval1;
var interval2;
var i=0;
var colors = ["#FFFF00","#FFFF33","#FFFF66","#FFFF99","#FFFFCC","#FFFFFF"];

function changeColor(){
    if (i<colors.length){
        document.getElementById("p1").style.backgroundColor=colors[i];
        i++;
    } 
    else{
        window.clearInterval(interval1);
        i=0;
    }
}
addEventListener("load",function(){
    document.getElementById("p1").addEventListener("click",function(e){
        interval1=setInterval("changeColor()",80);              

    })
});
</script>

</head>

<body>
<p id="p1">Click this text box to see the fade effect</p>

<footer>
 <p>By Jefrey Bulla</p>
</footer>
</div>
</body>
</html> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-09-03T03:48:18.100

我只是用...

```
<style>
tr.highlight {
background: #fffec6;
}
</style>

<script>
//on page load, add class
$(window).load(function() {
$("tr.table-item-id").addClass("highlight", 1200);
}); 

//fade out class
setTimeout(function(){
$("tr.table-item-id").removeClass("highlight", 1200);   
}, 5200);

</script> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-08-25T03:00:48.200

**您只需要 HTML 即可。无需 CSS 或 JS！**

假设您在某个页面上有一个文本，您希望**在访问**该页面时暂时“突出显示”给用户。

并让该页面上要突出显示的内容为h2标签和ap标签内容如下图：

```
 <h2>Carbon Steel for Blacksmithing</h2>

<p>The vast majority of blacksmithing uses low and medium carbon steels. High carbon steel, sometimes called “carbon tool steel,” is very hard, and difficult to bend or weld; it gets very brittle once it’s been heat-treated.</p>
<p>You can buy steel, or you can find and recycle. I prefer the later.</p> 
```

下面给出：一个链接，实际上将突出显示上面显示的内容。每当用户单击此链接时......他们会被重定向到页面到内容所在的同一位置，并且文本也会突出显示！

```
https://stackoverflow.com/questions/848797/yellow-fade-effect-with-jquery/63571443#:~:text=Carbon%20Steel%20for%20Blacksmithing,you%20can%20find%20and%20recycle. 
```

> **举一个活生生的例子：**按照上面给出的链接查看我在链接中提到的内容的突出显示效果。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-06-19T18:19:36.217

如果您想尝试另一种不依赖于 jQuery UI .effect 的黄色渐变技术，您可以在内容后面放置一个黄色（或其他颜色）div 并使用 jQuery .fadeOut()。

[http://jsfiddle.net/yFJzn/2/](http://jsfiddle.net/yFJzn/2/)

```
<div class="yft">
    <div class="content">This is some content</div>
    <div class="yft_fade">&nbsp;</div>
</div>

<style>
  .yft_fade {
      background-color:yellow;
      display:none;
  }
  .content {
      position:absolute;
      top:0px;
  }
</style>

<script>
  $(document).ready(function() {
      $(".yft").click(function() {
          $(this).find(".yft_fade").show().fadeOut();
      });
  });​
</script> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-11-06T14:09:37.287

“黄色淡出”的简单/原始脚本，**除了 jquery 本身没有插件**。只需在计时器中使用 rgb(255,255,highlightcolor) 设置背景：

```
<script>

    $(document).ready(function () {
        yellowFadeout();
    });

    function yellowFadeout() {
        if (typeof (yellowFadeout.timer) == "undefined")
            yellowFadeout.timer = setInterval(yellowFadeout, 50);
        if (typeof (yellowFadeout.highlightColor) == "undefined")
            yellowFadeout.highlightColor = 0;
        $(".highlight").css('background', 'rgb(255,255,' + yellowFadeout.highlightColor + ')');
        yellowFadeout.highlightColor += 10;
        if (yellowFadeout.highlightColor >= 255) {
            $(".highlight").css('background','');
            clearInterval(yellowFadeout.timer);
        }
    }
</script> 
```

# svn - 带有 Apache 的 SVN 服务器可以让我在任何地方访问我的文件！Firefox 似乎并非如此

> ID：848798
> 
> 赞同：0
> 
> 时间：2009-05-11T16:03:43.913
> 
> 标签：svn, firefox, visualsvn

我刚刚安装了 Visual SVN Server，我发现我可以使用普通浏览器（如 IE 或 Chrome）访问我的文件。

我什至可以通过这种方式将一个 mp3 文件从我家流式传输到我的工作......或者如果我将端口转发到 Visual SVN 服务器，则可以访问家里的任何文件......

虽然我注意到 IE 8 将为当前 URL 显示红色背景...所以链接不容易阅读...而且 Firefox 也只是拒绝打开页面，报告证书是自签名的...任何一个知道要让Firefox 3 能够打开吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T16:09:12.017

当您看到显示“安全连接失败”的屏幕时，请按照下列步骤操作：

1.  应该有一个链接说“或者你可以添加一个例外......”。单击该链接。
2.  然后单击“添加例外...”按钮
3.  单击“获取证书”按钮
4.  确保选中“永久存储此异常”复选框
5.  单击“确认安全例外”按钮。

在这一点上，您应该被提示输入您的凭据，并且一切都应该正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:12:56.410

在谈论证书的页面底部，应该有一个链接显示“添加例外”。按照该链接，单击“获取/查看证书”（抱歉，凭记忆），然后单击“添加例外”。

本质上，它只是在抱怨 SSL 证书的来源。您也可以通过在 IE8 中添加证书来摆脱红色背景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:51:03.117

如果您对存储库使用 Windows 身份验证，则必须使用 https 而不是 http 来使用 svn 客户端访问那些。出于安全原因，neon（Subversion 客户端使用的默认 DAV 库）对非加密连接禁用了 SSPI（Windows 身份验证）。

# c# - 从 .NET 中的域对象创建数据库架构

> ID：848799
> 
> 赞同：2
> 
> 时间：2009-05-11T16:04:12.773
> 
> 标签：c#, .net, orm

在 EJB 3.0 中，您可以编写域对象，然后将它们转换为实体（添加 @Entity 属性等），并且底层 JPA 机制（比如说 Hibernate）可以自动生成数据库模式。更好的是，当您在 Java 代码中更新域模型时，它还会更新 db。

我正在.NET 平台上寻找等效的功能。ADO.NET Entity Framework 可以吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-26T07:08:23.400

DataObjects.Net 还根据域模型自动生成和升级数据库模式。但最有趣的是如果模型和数据库模式发生变化，如何升级存储的数据。**是否可以在实体级别执行此操作，而不是使用低级 SQL？**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T22:09:05.250

Mindscape LightSpeed 支持这一点 - 模型优先或数据库优先开发的完整模式往返。它是一个商业产品，但有一个用于小型数据库的免费版本。

如前所述，Entity Framework 将在其下一个版本中添加其中一些功能，但这需要一段时间。

[具有模型优先支持的 LightSpeed 设计器的详细信息](http://www.mindscape.co.nz/products/lightspeed/features/designer.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-12T07:39:24.257

[Active Record](http://www.castleproject.org/activerecord/index.html)是前进的方向！你用属性标记你的对象，然后你可以从那里生成数据库模式或数据库本身。还有一个名为[Active Writer](http://altinoren.com/activewriter/)的工具，它允许您绘制模型并为您编写具有正确属性的代码。

它本质上是 NHibernate 的包装器，但是当您在对象上而不是在 XML 文档中进行映射时，它使事情变得更容易一些。

我们已经在几个项目中使用了它，并发现它是实现复杂系统的一种快速方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T17:37:33.650

是的 - 将来 :-) 当前的实体框架不支持“域优先”方法 - 但下一个版本 (EF v4) 将支持。这将随 .NET 4.0 / Visual Studio 2010 一起提供 - 但不要问我，什么时候！我不知道（微软也不知道）。

马克

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-12T07:26:27.867

[NHibernate](https://www.hibernate.org/343.html)是 Hibernate 的一个 .NET 端口，我认为它包括为您的实体生成数据库模式的工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:18:02.017

今天有第三方框架在 .NET 中执行此操作。

# php - Zend Route Regex 正斜杠的反向问题

> ID：848801
> 
> 赞同：0
> 
> 时间：2009-05-11T16:04:33.957
> 
> 标签：php, regex, zend-framework, routes, reverse

我对正则表达式路由有反向问题，我的配置文件如下：

```
routes.route1.type = "Zend_Controller_Router_Route_Regex"
routes.route1.route = "([^\,]+)([^p]*)(?:\,page_[0-9]+)?\.html"
routes.route1.defaults.controller = "index"
routes.route1.defaults.action = "find"
routes.route1.map.1 = "url_path"
routes.route1.map.2 = "url"
routes.route1.map.3 = "options"
routes.route1.map.4 = "page"
routes.route1.reverse = "%s%s,page_%d.html" 
```

网址将是[http://www.site.com/cat1/cat2/cat3/cat4/cat5/title-id1_id2,page_1.html](http://www.site.com/cat1/cat2/cat3/cat4/cat5/title-id1_id2,page_1.html) 类别数量未指定 当前正则表达式工作正常，一次获取所有类别，但反向格式将所有正斜杠转换为 html 格式：%2F 有人知道我如何保留正斜杠吗？我需要反向进行分页，所有的 html 实体看起来都很丑陋。

谢谢 ：）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T20:54:12.487

如果您使用 URL 帮助程序，请将第四个参数设置为 false 以禁用编码（默认情况下启用）。所以像：

```
<?=$this->url(array(
   'url_path' => 'whatever',
   'url' => 'something'
   'options' => 'foo',
   'page' => 'bar'
), 'route1', false, false)?> 
```

# c# - 对象搜索器方法应该在父对象中，还是与被搜索的对象相同？

> ID：848802
> 
> 赞同：0
> 
> 时间：2009-05-11T16:04:45.033
> 
> 标签：c#, oop, coupling

哪个构成更好的面向对象设计？

```
Class User { 
   id {get;set} 
}
Class Office { 
   id {get;set}  
   List<User> Managers(){  }//search for users, return list of them
} 
```

或者这个

```
Class User { 
   id {get;set} 
   List<User> Managers(){ }//search for users, return list of them 
}
Class Office { 
   id {get;set}  
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T16:09:46.493

第一个解决方案更好，因为`User`不/不应该知道如何`Office`工作以及如何获取经理列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T16:11:03.527

```
User john;
List<User> managers = fred.Managers(); //get managers of this user

Office london;
List<User> managers = london.Managers(); //get managers of this office 
```

除非它是一个静态方法，否则让它成为你有一个实例的类的方法：让 getUsers 成为 User 类的非静态方法没有意义，因为那样你就需要一个用户实例来调用 getUsers方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T16:11:31.123

与其他答案类似，我更喜欢第一个解决方案。毕竟，一个用户与正在搜索的集合有什么关系？客户首先如何获得要搜索的用户？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:08:45.433

我个人喜欢第一个。用户是一个实体而不是一个集合。办公室是包含经理的办公室。

我可能还会创建一个 UserList 类。

```
public class UserList : List<User>
{}

class User 
{ 
  public int id {get; set;} 
  public bool IsManager { get; set;}
}

class Office {
    private UserList _users;
    UserList Managers
    {
        get { return (UserList) _users.FindAll(x => x.IsManager);}
    }
} 
```

# jquery - Django、jQuery、XMLHttpResponse 错误

> ID：848804
> 
> 赞同：0
> 
> 时间：2009-05-11T16:04:58.870
> 
> 标签：jquery, django, xmlhttprequest

我正在尝试使用 Django 学习一些基本的 ajax。我的简单项目是一个应用程序，它从数据库中的可用奖品中随机选择一个`Prize`，减少其数量，然后返回`prize.name`页面。

我正在使用 jQuery 的 $.ajax 方法来解决这个问题。唯一正在运行的是`error`我的 $.ajax 调用中定义的函数，但错误消息只显示“错误”。我是 ajax 新手，所以我可能忽略了一些明显的东西。以下是相关代码：

## 模型

```
class Prize(models.Model):
    name = models.CharField(max_length=50)
    quantity = models.IntegerField(default=0)

    def __unicode__(self):
        return self.name 
```

## URLConf

```
urlpatterns = patterns('',
    (r'^get_prize/$', 'app.views.get_prize' ),
) 
```

## 看法

```
def get_prize(request):
    prizes = Prize.objects.filter(quantity__gt=0)
    to_return = {}

    if prizes:
            rand = random.randrange(len(prizes))
        prize = prizes[rand]
        prize.quantity -= 1
        prize.save()

        to_return['prize'] = prize.name
        data = simplejson.dumps(to_return)

        return HttpResponse(data, mimetype='application/json')

    else:
        to_return['msg'] = "That's all the prizes.  No more."
        data = simplejson.dumps(to_return)

        return HttpResponse(data, mimetype='application/json') 
```

## 模板

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>User's Conference Prize Randomizer</title>
<link rel="stylesheet" type="text/css" href="/static-media/style.css" />
<script type="text/javascript" src="/static-media/jquery-1.2.6.min.js"></script>

<script type="text/javascript">
    var get_prize = function() {
        var args = { 
            type: "GET",
            url: "get_prize",
            dataType: "json",
            success: done,
            error: function(response,error_string,e){
                alert( "Error: " + response.responseText + " " + error_string ); 
                for (i in e){
                    alert(i);
                }
            }
        };

        $.ajax(args);
    };

    var done = function(response) {
        if(response)    {
            alert(response);
        }

        else {
            alert("Something boo-booed");
        }
    };

    $(document).ready(function() {
       $("#start").click(get_prize);
     });
</script>

</head >

<body>
        <p><a href="" id='start'>Get Prize</a>, this link isn't working how I'd like.</p>

</body> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T20:57:04.510

这与您的问题并不完全相关，但如果您尝试从数据库中获取随机对象，您可以这样做：

```
prize = Prize.objects.filter(quantity__gt=0).order_by('?')[:1]
if prize:
    prize = prize[0]

# Using a slice prevents an exception if the query returns an empty queryset.
# If you're not a fan of LBYL, you could wrap the query in a try...except block instead:

try:
    prize = Prize.objects.filter(quantity__gt=0).order_by('?')[0]
except IndexError:
    # No more prizes pal...done, fini. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:05:29.510

好伤心。我刚刚遗漏了`return false`进行 ajax 调用的函数。一路走好n00b。:0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:33:17.843

这不是您问题的直接答案，但是您看过 jQuery taconite 插件吗？它使大多数 AJAXy 的事情变得微不足道。更多关于[malup 的铁燧石页面](http://malsup.com/jquery/taconite/)。当您使用它时，请查看他的[其他出色插件](http://malsup.com/jquery/)。

# web-services - 我应该通过 HTTP 对我的 RPC 调用进行 RESTify 吗？

> ID：848806
> 
> 赞同：11
> 
> 时间：2009-05-11T16:05:09.743
> 
> 标签：web-services, rest, httpwebrequest, rpc

我们有 RPC 的 HTTP Web 服务。它们返回表示检索或创建的对象的 XML。我想知道“恢复”服务的优势（如果有的话）。

*   发布[http://www.example.com/createDoodad](http://www.example.com/createDoodad)
*   获取[http://www.example.com/getDoodad?id=13](http://www.example.com/getDoodad?id=13)
*   获取[http://www.example.com/getWidget?id1=11&id2=45](http://www.example.com/getWidget?id1=11&id2=45)
*   发布[http://www.example.com/createWidget](http://www.example.com/createWidget)
*   发布[http://www.example.com/createSprocked](http://www.example.com/createSprocked)

我看到的一件事是我们不需要每个资源的表示，我们也不需要支持所有资源上的所有操作（GET、PUT、POST、DELETE）。基本上我的问题是这个。

说服我应该使用 RESTful 服务而不是 RPC over HTTP，那些 RESTful 服务应该是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-11T16:23:11.820

一方面，它与语义有关，URI 是一个统一**资源**指示符。HTTP 提供了 GET、POST、PUT 和 DELETE 资源的方法。HTTP 标头指定我想要接收或发送信息的格式。这一切都可以通过 HTTP 协议轻松获得。

因此，您可以重用用于 HTML 输出的相同 URL，以使用 HTTP 的方式获取 XML、JSON。

[XML-RPC](http://en.wikipedia.org/wiki/XML-RPC)和[SOAP](http://en.wikipedia.org/wiki/SOAP)基于调用由 XSD 或 WSDL 文件描述的方法，而 REST 基于获取/修改资源。差异是微妙但明显的。URL 仅描述资源，而不是像 SOAP 和 XML-RPC 那样经常描述的操作。

REST 的好处是，您可以利用 HTTP 动词来修改资源，就像可以命名为 create/new/add 等的方法调用一样。有意义的 HTTP 状态代码而不是不同类型的错误响应，并且能够指定不同的错误响应以标准方式对同一资源进行格式化。

您也不必接受 RESTful 资源上的所有动词，例如，如果您想要一个只读资源，只需`Method Not Allowed`在任何不是 GET 的动词上返回 405 状态代码。

您是否应该重做对 REST 的 RPC 调用？不，我不这么认为。好处不超过开发时间。设置新的 Web 服务时应该学习 REST 吗？是的，我个人确实这么认为，使用 REST 资源会感觉更自然，并且可以更快地增长。

**编辑**

我觉得 REST 胜过 XML-RPC/SOAP 的原因是，在开发网站时，您已经将所有必要的数据汇总到 HTML 中，您还为 POST 主体编写了验证代码。为什么仅仅因为传输标记发生变化就应该更改为不同的协议？

这样，当您设计一个新网站（与语言无关）时，如果您真的将 URI 视为资源，那么您基本上将 URI 用作方法调用，并在方法调用前加上 HTTP 动词。

也就是说，带有 HTTP 标头的 /products/12 上的 GET`Accept: application/json;`基本上（想象的）转换为`getProducts(12,MimeType.Json)`.

这种“方法”必须做几件事

1.  检查我们是否支持 JSON 作为 MIME 类型。（验证请求）
2.  验证请求数据
3.  汇总产品 12 的数据。
4.  格式化为 JSON 并返回。

如果由于某种原因在接下来的 4 年内[YAML](http://www.yaml.org/)将成为下一个大热潮，并且您的一位消费者希望以这种方式与您交谈，那么这种 MIME 类型比使用常规 Web 服务更容易插入。

现在产品 12 是您很可能还希望接受 HTML MIME 类型以显示所述产品的资源，但是对于像`/product/12/reviews/14/`您不需要 HTML 对应物的 URI，您只希望您的消费者能够发布到该 URL 到更新（PUT）/删除（DELETE）他们自己的评论。

将 URI 严格地视为资源，而不仅仅是网页的位置，而这些资源又与服务器端对方法调用的 HTTP 请求相结合，导致 URL 干净（SEO 友好）和（更重要的是？）易于发展。

我敢肯定，任何语言的框架都会自动为您将 URI 映射到方法调用。我不能推荐一个，因为我通常会推出自己的。

ASP.NET MVC 也按照相同的原理工作，但在我看来，它不会产生 RESTful URI。默认情况下，ASP.NET MVC 将动词作为 URI 的一部分，并指出，请注意，ASP.NET MVC 绝不会强迫您这样做（或其他任何事情）。

如果你至少要选择一个框架，他们应该：

1.  将 URI 绑定到服务器上的方法
2.  支持 Object 转 JSON/XML 等序列化。如果你必须自己写这个是很痛苦的，尽管依赖于语言，并不是太难。
3.  公开某种类型安全的请求助手来帮助您确定请求的内容，而无需手动解析 HTTP 标头。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T19:53:42.367

尝试从 URL 中取出动词：

*   发布[http://www.example.com/Doodad](http://www.example.com/Doodad)
*   获取[http://www.example.com/Doodad/13](http://www.example.com/Doodad/13)
*   获取[http://www.example.com/Widget/11/45](http://www.example.com/Widget/11/45)
*   发布[http://www.example.com/Widget](http://www.example.com/Widget)
*   发布[http://www.example.com/Sprocked](http://www.example.com/Sprocked)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-20T22:10:08.610

查询字符串不应用于以分层、非查询方式访问资源。缓存时通常会忽略查询字符串，这是危险且缓慢的。

# g++ - 与 g++ 3.4.4 和 g++ 3.4.5 的链接错误

> ID：848809
> 
> 赞同：0
> 
> 时间：2009-05-11T16:05:36.217
> 
> 标签：g++, linker

使用：windows xp、g++ 3.4.4 和 cygwin 和 g++ 3.4.5 和 mingw。

我正在用 cppunit 编译一个简单的单元测试类。

当我使用 g++ 3.4.5 链接时，会出现很多链接错误。当我与 g++ 3.4.4 链接时，我没有收到任何错误，并且 exe 链接正常并运行。

我似乎无法追查错误，所以有什么想法吗？

谢谢。

编辑：链接错误：未引用的函数错误。喜欢：

```
 SimpleTest.cpp:(.text+0x313): undefined reference to `CppUnit::Message::Message(std::string const&, std::string const&)' 
```

编辑： cmd 行：

```
g++ -I g:\projects\thirdparty\cppunit-1.12.1\include -L g:\projects\thirdparty\cppunit-1.12.1\lib -l cppunitd -o main.exe main.cpp SimpleTest.cpp 
```

更新：Visual Studio 中的相同代码：没有错误，单元测试按预期运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T17:20:06.720

随着 g++ 的成熟，我在 4.2.3 上，它的类型检查变得更加迂腐，并且更好。我想说的信息很少，您可能应该仔细查看对这些方法的调用。我怀疑类型不太正确。3.4.4 没有捕捉到它，3.4.5 捕捉到了。....JW

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T20:17:10.723

您或许可以尝试的一件事是在 Linux 上使用 g++ 3.4.5 和/或 3.4.4 进行编译。如果结果相同，那么它显然是 gcc 的一个属性。否则，这听起来更像是一个 mingw 问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T06:32:17.957

您的问题可能是不正确的链接行。链接行上的源/目标文件和库的顺序[很重要](http://webpages.charter.net/ppluzhnikov/linker.html)。正确的链接行：

```
g++ -I g:\projects\thirdparty\cppunit-1.12.1\include \
    -L g:\projects\thirdparty\cppunit-1.12.1\lib \
    -o main.exe main.cpp SimpleTest.cpp -lcppunitd 
```

# c++ - 使用 Autoconf 处理弃用的包含

> ID：848815
> 
> 赞同：1
> 
> 时间：2009-05-11T16:07:13.923
> 
> 标签：c++, hashmap, autoconf, deprecated, unordered-map

我一直`ext::hash_map`在 C++ 项目中使用，并注意到在 g++ 4.3 中它已被弃用，取而代之的是`unordered_map`. 我需要保持与不可用的旧系统的兼容性`unordered_map`。我突然想到，这正是我已经在使用的 autoconf 可以处理的事情。但是，我未能成功找到有关这样做的文档。

我想我需要执行以下操作：
- 将`ext::hash_map`我的代码中的所有实例替换为 - 将我的代码中的所有`MY_HASH_MAP`
实例替换为 - 在 configure.ac 中使用和的某种组合包含一行`ext/hash_map``MY_HASH_INCLUDE`
`AC_CHECK_HEADERS``AC_DEFINE`

我无法准确地找出正确的 autoconf 魔法来完成这项工作，并且想知道它是否是最好的解决方案。当然，这是许多其他人会处理的事情，并且可能有一些我无法找到的标准解决方案？

所以，三个相关的问题：
- 有没有我应该使用的标准方法来处理这个问题？
- 我如何在 autoconf 中做到这一点？
- 我是否应该只使用 -Wno-deprecated 并假设 C++ 标准在我有生之年不会更新？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T23:34:04.723

您可以使用`AC_CHECK_HEADERS([my_header_file])`来查看存在哪些文件 - 然后创建一个新文件`class MyApp::hash_map`，具体取决于使用定义的方式相应地包装功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T17:04:37.433

我会考虑保留代码原样并关闭“已弃用”警告，特别是如果您必须支持只有 ext::hash_map 可用的旧系统。

IIRC ext::hash_map 无论如何都不是标准的一部分，因此可能造成的主要危害是（最终）G++ 维护者将取消对它的支持。但是，如果您重新调整代码以同时包含 hash_map 和 tr1 unordered_map，您会突然将这段特定代码的测试工作加倍。除非有特定原因可能需要您重复努力，否则将其保存为更有价值的事情。

# tomcat - Tomcat 中的 LDAP 错误 - 需要 TLS 机密性

> ID：848821
> 
> 赞同：0
> 
> 时间：2009-05-11T16:08:26.433
> 
> 标签：tomcat, ldap, ssl

我正在尝试在 Tomcat 中配置一个领域以访问具有 TLS 安全性的 LDAP 服务器。我的基本 Realm 配置如下所示：

```
    <领域类名称="org.apache.catalina.realm.JNDIRealm"
        调试="99"
        connectionURL="ldap://localhost:389/"
        userPattern="uid={0},ou=People,dc=nsdl,dc=org" />

```

我收到这样的错误：

```
严重：Catalina.start：
LifecycleException：打开目录服务器连接异常：  
    javax.naming.AuthenticationNotSupportedException：[LDAP：错误代码 13 - 需要 TLS 机密性]
    在 org.apache.catalina.realm.JNDIRealm.start(JNDIRealm.java:1697)
    在 org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1006)
    在 org.apache.catalina.core.StandardHost.start(StandardHost.java:736)
    在 org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014)
    在 org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
    在 org.apache.catalina.core.StandardService.start(StandardService.java:448)
    在 org.apache.catalina.core.StandardServer.start(StandardServer.java:700)
    在 org.apache.catalina.startup.Catalina.start(Catalina.java:552)
    在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    在 sun.reflect.NativeMethodAccessorImpl.invoke（未知来源）
    在 sun.reflect.DelegatingMethodAccessorImpl.invoke（未知来源）
    在 java.lang.reflect.Method.invoke（未知来源）
    在 org.apache.catalina.startup.Bootstrap.start（Bootstrap.java:295）
    在 org.apache.catalina.startup.Bootstrap.main（Bootstrap.java:433）

```

我尝试了多种修复方法，但没有更改问题或错误消息。这包括：

*   将 connectionURL 中的协议更改为“ldaps”
*   将 connectionURL 中的端口更改为 636
*   将协议 =“TLS”添加到他的领域
*   将 Realm 声明从 conf/server.xml（在主机或引擎下）移动到 webapp 中的 META-INF/context.xml
*   将 ldap.jar 添加到 server/lib
*   从 Tomcat 5.5 更改为 Tomcat 6.0

这些中的每一个都会产生相同的错误消息（尽管堆栈跟踪在某些配置中是不同的）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T19:03:57.330

答案实际上与此处发布的问题无关。问题与如何指定领域有关。

领域是在位于 webapp 内 META-INF/context.xml 的文件中包含的 Context 元素中指定的

我没有意识到的是

*   Tomcat 将此文件复制到 conf/Catalina/localhost/{webapp}.xml，
*   如果将较新版本的 WAR 文件提供给 Tomcat，它不会将 {webapp}.xml 替换为较新版本

所以每次都出现相同的错误消息的原因是因为我最初的 Realm 副本很糟糕，并且我尝试的修复没有被考虑。

事实上，如上所示，Realm 规范是正确的。一旦我清除了顽固的文件，它就可以正常工作。

# c# - 关于修改此自定义迭代器的问题

> ID：848823
> 
> 赞同：0
> 
> 时间：2009-05-11T16:08:35.963
> 
> 标签：c#

我有以下代码，它基于自定义算法迭代列表：

```
 public static IEnumerable<TItem>
MakeCustomIterator<TCollection, TCursor, TItem>(
this TCollection collection, // Extension method of the collection used (eg List<T>)
TCursor cursor, // An array of ints which holds our progress
Func<TCollection, TCursor, TItem> getCurrent,
Func<TCursor, bool> isFinished,
Func<TCursor, TCursor> advanceCursor)
        {
            while (!isFinished(cursor)) // While we haven't reached the end of the iteration......
            {
                yield return getCurrent(collection, cursor);
                cursor = advanceCursor(cursor);

            }

        }

     var matrix = new List<List<double>> {
     new List<double> { 1.0, 1.1, 1.2 },
      new List<double> { 2.0, 2.1, 2.2 },
      new List<double> { 3.0, 3.1, 3.2 }
      };

     var iter = matrix.MakeCustomIterator(
     new int[] { 0, 0 },
     (coll, cur) => coll[cur[0]][cur[1]],
     (cur) => cur[0] > 2 || cur[1] > 2,
     (cur) => new int[] { cur[0] + 1,
       cur[1] + 1 });

            foreach (var item in iter)
            {

            } 
```

当我使用此代码时，它将获得 1.0，然后是 2.1（在对角线下方，在下一个列表中）。是否可以在第一个链接中从 1.0 转到 1.1？或者可以从 1.0 垂直下降到 2.0？

注意：此代码片段来自 Accelerated C# 2008。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:14:34.270

您只需要改变“推进”的含义（可能连同“完成”的含义）。例如，要“向下”，您可以使用：

```
var iter = matrix.MakeCustomIterator(
     new int[] { 0, 0 },
     (coll, cur) => coll[cur[0]][cur[1]],
     (cur) => cur[0] > 2 || cur[1] > 2,
     // Increase the row, but stay on the same column
     (cur) => new int[] { cur[0] + 1, cur[1] }); 
```

去“一起”：

```
var iter = matrix.MakeCustomIterator(
     new int[] { 0, 0 },
     (coll, cur) => coll[cur[0]][cur[1]],
     (cur) => cur[0] > 2 || cur[1] > 2,
     // Stay on the same row, but increase the column
     (cur) => new int[] { cur[0], cur[1] + 1 }); 
```

“沿着然后向下”会比较棘手，但可行：

```
var iter = matrix.MakeCustomIterator(
     new int[] { 0, 0 },
     (coll, cur) => coll[cur[0]][cur[1]],
     (cur) => cur[0] > 2,
     // Stay on the same row if we can, otherwise move to next row
     (cur) => cur[1] == 2 ? new int[] { cur[0] + 1, 0 }
                          : new int[] { cur[0], cur[1] + 1}); 
```

# struts2 - 如何修复重定向 OGNL 错误，无法设置参数？

> ID：848828
> 
> 赞同：3
> 
> 时间：2009-05-11T16:08:52.407
> 
> 标签：struts2, ognl

我不确定这是我还是错误。

我收到以下错误

```
11:52:01,623 ERROR ObjectFactory:27 - Unable to set parameter [dest] in result of type [org.apache.struts2.dispatcher.ServletRedirectResult]
Caught OgnlException while setting property 'dest' on type 'org.apache.struts2.dispatcher.ServletRedirectResult'. - Class: ognl.ObjectPropertyAccessor
File: ObjectPropertyAccessor.java
Method: setProperty
Line: 132 - ognl/ObjectPropertyAccessor.java:132:-1
        at com.opensymphony.xwork2.ognl.OgnlUtil.internalSetProperty(OgnlUtil.java:392) 
```

而且我的配置非常小

```
<package name="esupport" namespace="/esupport" extends="struts-default">
        <action name="old-esupport" class="com.my.MyRedirectAction">
            <result type="redirect">
            <param name="location">http://some.server.com/init.asp</param>
            <param name="dest">${dest}</param>
            </result>
        </action>
    </package> 
```

我的班级有一对 get/set 方法。就是这样。没有什么花哨

我在论坛里找到了[这个帖子。](http://markmail.org/message/qij4ys4xfzklo7u3#query:Caught%20OgnlException%20while%20setting%20property%20on%20type%20%27org.apache.struts2.dispatcher.ServletRedirectResult%27+page:1+mid:c3vpmj7x3ydyzbx2+state:results)但这并不能解决我的问题

我在用

Struts 2.1.16 Spring 2 Spring Security + CAS

（有趣的行为是它在错误后将我发送到 CAS 服务器，但我想它会在重定向问题得到修复后得到纠正）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T15:26:42.263

这似乎是 Struts2 的一个错误。他们建议...通过以下方式隐藏错误：

```
<category name="com.opensymphony.xwork2.ObjectFactory">
   <priority value="fatal"/>
</category> 
```

来自....[关于重定向的疑难解答指南部分](http://cwiki.apache.org/S2WIKI/troubleshooting-guide-migrating-from-struts-20x-to-21x.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-11-11T13:31:27.283

在 WAS 7 服务器中部署应用程序后，我遇到了这个问题。这是一个现有的应用程序，没有代码更改。

在服务器启动日志中发现以下异常

```
Failed to write out object: ext___405722372
com.ibm.wkplc.extensionregistry.util.XmlUtilException: Unable to write to the given file 
```

刚刚清除了服务器缓存并重新启动它，问题就解决了。

# jquery - 设置一个上下文，这样就不会使用 jQuery 选择 body 的直接子代

> ID：848829
> 
> 赞同：0
> 
> 时间：2009-05-11T16:08:58.817
> 
> 标签：jquery, css-selectors

我有以下 HTML 代码：

```
<html>
  <head>
  </head>
  <body>
      <div id="never-selected">
      </div>
  </body>
</html> 
```

使用 JQuery 1.3.2，我想围绕 $() 创建包装器，允许您选择具有任何组合的任何元素，但 div #never-selected 或其内容除外。

我正在尝试这样做：

```
_context = false;    
getContext = function() {
    if (_context === false) {
        _gui_dom = jQuery("fuzzy magic selector");
     }
    return _gui_dom;
};

// return a jQuery object filtered to aim the content of the tartiflet GUI only
select = function(selector) {
  return jQuery(selector, getContext());  
}; 
```

但我找不到合适的公式来投射“模糊魔法选择器”;-)

我最好的镜头是`jQuery("head *, body *:not(#never-selected, #never-selected *)")`，但缺点是你不能选择头部或身体，这很烦人。使用 html * 不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T16:26:19.943

我不确定我是否理解问题，但尝试在结果集上使用[.not()](http://docs.jquery.com/Traversing/not#expr)

```
select = function(selector){return $(selector).not('#never-selected, #never-selected *')}; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T19:25:14.770

你可以编写你自己的自定义选择器来解析你想要的东西，使用任意数量的 jQuery 来抓取这些元素。有时他们默认提供的选择器并不能做所有事情。

我无法想到如何实现您的要求，但您可以执行以下操作：

```
jQuery.extend(jQuery.expr[':'],{
    everything_but: function(el,sel) {
        var everything = jQuery(el).clone();
        everything.find(sel).remove();
        return everything;
    }
}); 
```

我绝对不能说我的实现会起作用，但它可能会让您了解如何实现自己的选择器来实现您想要的。

它可以像往常一样使用。像这样的东西：

```
var select = $('*:everything_but(#never-selected)') 
```

无论如何，编写自己的选择器似乎是您尝试对脚本执行的操作。祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T19:59:06.867

也许会创建一个调用 jQuery() 并使用它传递的参数然后自动 .filter() 的函数，它可能会起作用吗？

```
function select() {
  var jquery = jQuery.apply(args);
  return jquery.filter(":not(#never-selected, #never-selected *");
} 
```

不确定这是否有效 - 它是在空中编码的。

# php - “网站名称”的 PHP 正则表达式

> ID：848837
> 
> 赞同：1
> 
> 时间：2009-05-11T16:10:23.387
> 
> 标签：php, regex, dns

> ### 重复：[URL 的 PHP 验证/正则表达式](https://stackoverflow.com/questions/206059/php-validation-regex-for-url)

我的目标是为网站名称创建一个 PHP 正则表达式。正则表达式用于潜在客户收集表单，应接受某人可能输入的任何合法类型的网站名称语法。经过详尽的搜索，我很惊讶我在那里找不到。

这是我正在寻找的正则表达式匹配：

*   somewebsite.com
*   [http://somewebsite.com](http://somewebsite.com)
*   [http://www.somewebsite.com](http://www.somewebsite.com)

并且，它还应该匹配：

*   以上任何一个带有反斜杠的结尾，例如：somewebsite.com/
*   子域

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-11T16:13:03.397

不需要正则表达式。

```
$subject = 'example.com';
$part = (stripos($subject, 'http://') === FALSE)  ? 'http://' : '' ;
var_dump(filter_var($part.$subject, FILTER_VALIDATE_URL)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-13T15:19:02.627

我决定在这里对答案进行基准测试，以证明正则表达式不是此类简单任务的答案。Andy Leekman 的代码比其他答案快 30% 到 60%。他确实有一个错误，但我用一行代码修复了它。你可以在下面查看我的结果。

这是运行测试的代码。

[http://pastie.org/476900](http://pastie.org/476900)

[替代文字 http://img254.imageshack.us/img254/7821/capturevzh.png](http://img254.imageshack.us/img254/7821/capturevzh.png)

**PS**如果其他人使用正则表达式来验证 URL，我可能会发疯；）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T18:21:11.847

您可能需要对其进行调整：

```
<?php

$pattern = '/^(([\w]+:)?\/\/)?(([\d\w]|%[a-fA-f\d]{2,2})+(:([\d\w]|%[a-fA-f\d]{2,2})+)?@)?([\d\w][-\d\w]{0,253}[\d\w]\.)+[\w]{2,4}(:[\d]+)?(\/([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&amp;?([-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)?$/';

$url1  = "http://www.somewebsite.com";
$url2  = "https://www.somewebsite.com";
$url3  = "https://somewebsite.com";
$url4  = "www.somewebsite.com";
$url5  = "somewebsite.com";

function valURL($pattern, $url) {

        $return = false;

        if(preg_match($pattern, $url)) {
                $return = true;
        }

        if($return == true) {
                echo "Match URL: <font color='green'>" . $url . "</font><br /><br />";
        } else {
                echo "Try Again: <font color='red'>URL: " . $url . "</font><br /><br />";
        }
}

valURL($pattern, $url1);
valURL($pattern, $url2);
valURL($pattern, $url3);
valURL($pattern, $url4);
valURL($pattern, $url5);

?> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-11T16:14:15.893

```
/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\\.)+((a[cdefgilmnoqrstuwxz]|aero|arpa)|(b[abdefghijmnorstvwyz]|biz)|(c[acdfghiklmnorsuvxyz]|cat|com|coop)|d[ejkmoz]|(e[ceghrstu]|edu)|f[ijkmor]|(g[abdefghilmnpqrstuwy]|gov)|h[kmnrtu]|(i[delmnoqrst]|info|int)|(j[emop]|jobs)|k[eghimnprwyz]|l[abcikrstuvy]|(m[acdghklmnopqrstuvwxyz]|mil|mobi|museum)|(n[acefgilopruz]|name|net)|(om|org)|(p[aefghklmnrstwy]|pro)|qa|r[eouw]|s[abcdeghijklmnortvyz]|(t[cdfghjklmnoprtvwz]|travel)|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw])$/i 
```

[http://www.shauninman.com/archive/2006/05/08/validating_domain_names](http://www.shauninman.com/archive/2006/05/08/validating_domain_names)

由谷歌提供。虽然它非常复杂，所以其他人可能有一个更简单的。

编辑：首先尝试安迪的答案。如果你能找到一个正则表达式的替代品，9/10 的替代品会好得多。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-11T16:16:02.987

```
^(https?://)?(([0-9a-z_!'().&=$%-]: )?[0-9a-z_!'().&=$%-]@)?(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!'()-]\.)([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!*'().;?:@&=$,%#-])/?)$ 
```

# css - Cols, colgroups 和 css ":hover" 伪类

> ID：848840
> 
> 赞同：37
> 
> 时间：2009-05-11T16:11:03.760
> 
> 标签：css, xhtml, html-table, col

我正在尝试创建一个表格来显示个人的 BMI。

作为其中的一部分，我希望 on `:hover`,`<tr>` **和** `<col>`(or `<colgroup>`) 也被突出显示，以使交叉点更加明显。

由于该表将同时具有公制和英制测量值，因此 :hover 不必在单元格处停止（从任何方向），事实上，如果它从一个轴延伸到另一个轴，将是一个奖励。我也在使用 XHTML 1.1 Strict doctype，如果这有什么不同？

所以......一个例子（真正的桌子......更大），但这应该是有代表性的：

```
<script>

tr:hover {background-color: #ffa; }

colgroup:hover,
col:hover {background-color: #ffa; }

</script> 
```

...

```
<table>
    <col class="weight"></col><colgroup span="3"><col class="bmi"></col></colgroup>

    <tr>
        <th></th>
        <th>50kg</th>
        <th>55kg</th>
        <th>60kg</th>
    </tr>

    <tr>
        <td>160cm</td>
        <td>20</td>
        <td>21</td>
        <td>23</td>
    </tr>

    <tr>
        <td>165cm</td>
        <td>18</td>
        <td>20</td>
        <td>22</td>
    </tr>

    <tr>
        <td>170cm</td>
        <td>17</td>
        <td>19</td>
        <td>21</td>
    </tr>

</table> 
```

我在问不可能吗，我需要去 JQuery-wards 吗？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2012-06-24T08:16:51.717

这是一个不使用 JavaScript 的纯 CSS 方法。

我使用`::before`和`::after`伪元素来突出显示行和列。如果您需要处理点击事件，请`z-index`在 s 下方突出显示。允许他们离开的范围。上隐藏高光溢出。`<td>``position: absolute``<td>``overflow: hidden``<table>`

这不是必需的，但是当您在标题中时，我也让它只选择行或列。`.row`和`.col`类负责这一点。如果您希望简化，可以删除它们。

这适用于所有现代浏览器（并且在旧浏览器上无所作为而优雅地降级）。

演示：http: [//jsfiddle.net/ThinkingStiff/rUhCa/](http://jsfiddle.net/ThinkingStiff/rUhCa/)

输出：

![具有突出显示的行和列的 HTML 表格](https://i.stack.imgur.com/TbZP2.png)

CSS：

```
table {
    border-spacing: 0;
    border-collapse: collapse;
    overflow: hidden;
    z-index: 1;
}

td, th, .row, .col {
    cursor: pointer;
    padding: 10px;
    position: relative;
}

td:hover::before,
.row:hover::before { 
    background-color: #ffa;
    content: '\00a0';  
    height: 100%;
    left: -5000px;
    position: absolute;  
    top: 0;
    width: 10000px;   
    z-index: -1;        
}

td:hover::after,
.col:hover::after { 
    background-color: #ffa;
    content: '\00a0';  
    height: 10000px;    
    left: 0;
    position: absolute;  
    top: -5000px;
    width: 100%;
    z-index: -1;        
} 
```

HTML：

```
<table>
    <tr>
        <th></th>
        <th class="col">50kg</th>
        <th class="col">55kg</th>
        <th class="col">60kg</th>
        <th class="col">65kg</th>
        <th class="col">70kg</th>
    </tr>
    <tr>
        <th class="row">160cm</th>
        <td>20</td><td>21</td><td>23</td><td>25</td><td>27</td>
    </tr>
    <tr>
        <th class="row">165cm</th>
        <td>18</td><td>20</td><td>22</td><td>24</td><td>26</td>
    </tr>
    <tr>
        <th class="row">170cm</th>
        <td>17</td><td>19</td><td>21</td><td>23</td><td>25</td>
    </tr>
    <tr>
        <th class="row">175cm</th>
        <td>16</td><td>18</td><td>20</td><td>22</td><td>24</td>
    </tr>
</table> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-11T16:24:22.740

我在这里遇到了一个非常不错的 jQuery 插件[，](http://p.sohei.org/stuff/jquery/tablehover/demo/demo.html)它通过大量示例在这类事情上做得非常好。我会优先使用它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T16:19:11.220

无论如何，IE 不支持AFAIK CSS 悬停在`TR`'s 上，所以它的 TR 部分充其量只能在 Firefox 中工作。

甚至从未见过`:hover`关于 col/colgroup 的作品，所以不确定这是否可能......

认为您可能会被 Javascript 实现所困。

[这里](http://centricle.com/lab/dom/col/)有一个示例 在 Firefox 中有效（行和列），但在 IE 中又被破坏了……列不起作用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-10-16T03:06:14.320

我从[css-tricks.com 遇到](http://css-tricks.com/row-and-column-highlighting/)了这种巧妙的做法

//HTML

```
<table>
    <colgroup></colgroup>
    <colgroup></colgroup>
    <colgroup></colgroup>
    <colgroup></colgroup>
    <colgroup></colgroup>
    <thead>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
</table> 
```

//Js

```
$(function(){
    $("table").delegate('td','mouseover mouseleave', function(e) {
        if (e.type == 'mouseover') {
          $(this).parent().addClass("hover");
          $("colgroup").eq($(this).index()).addClass("hover");
        }
        else {
          $(this).parent().removeClass("hover");
          $("colgroup").eq($(this).index()).removeClass("hover");
        }
    });
}) 
```

[在这里查看小提琴](http://jsfiddle.net/Egli/dsujqo69/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-07T21:45:25.920

现场回答（[https://jsfiddle.net/craig1123/d7105gLf/](https://jsfiddle.net/craig1123/d7105gLf/)）

已经有 CSS 和 JQuery 的答案；但是，我写了一个简单的纯 javascript 答案。

我首先找到所有的`col`和`td`标签，通过do获得每个单元格的列索引`element.cellIndex`，然后添加一个背景为on的CSS类，然后将其`mouseenter`删除`mouseleave`。

HTML

```
<table id='table'>
  <col />
  <col />
  <col />
  <col />
  <thead>
    <tr>
      <th>Name</th>
      <th>Age</th>
      <th>Birthdate</th>
      <th>Preferred Hat Style</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Abraham Lincoln</td>
      <td>204</td>
      <td>February 12</td>
      <td>Stovepipe</td>
    </tr>
    <tr>
      <td>Winston Churchill</td>
      <td>139</td>
      <td>November 30</td>
      <td>Homburg</td>
    </tr>
    <tr>
      <td>Rob Glazebrook</td>
      <td>32</td>
      <td>August 6</td>
      <td>Flat Cap</td>
    </tr>
  </tbody>
</table> 
```

CSS

```
body {
  font: 16px/1.5 Helvetica, Arial, sans-serif;
}

table {
  width: 80%;
  margin: 20px auto;
  border-collapse: collapse;
}
table th {
  text-align: left;
}
table tr, table col {
  transition: all .3s;
}
table tbody tr:hover {
  background-color: rgba(0, 140, 203, 0.2);
}
table col.hover {
  background-color: rgba(0, 140, 203, 0.2);
}
tr, col {
  transition: all .3s;
}
tbody tr:hover {
  background-color: rgba(0,140,203,.2);
}
col.hover {
  background-color: rgba(0,140,203,.2);
} 
```

JS

```
const col = table.getElementsByTagName('col');
const td = document.getElementsByTagName('td');

const columnEnter = (i) => col[i].classList.add('hover');
const columnLeave = (i) => col[i].classList.remove('hover');

for (const cell of td) {
    const index = cell.cellIndex;
    cell.addEventListener('mouseenter', columnEnter.bind(this, index));
    cell.addEventListener('mouseleave', columnLeave.bind(this, index));
} 
```

[这是一个小提琴](https://jsfiddle.net/craig1123/d7105gLf/)

# c# - C# XSLT 转换添加和到输出

> ID：848841
> 
> 赞同：21
> 
> 时间：2009-05-11T16:11:27.893
> 
> 标签：c#, xslt, whitespace

我有一个 XSLT 转换问题：

```
style="width:{Data/PercentSpaceUsed}%;" 
```

Data/PercentSpaceUsed 的值为整数 3。

它输出：

```
style="width:&#xD;&#xA;     3&#xD;&#xA; %;" 
```

而不是我所期望的：

```
style="width:3%;" 
```

这是进行转换的代码：`xslt_xslt`是转换 xml，`sw.ToString()`包含我没想到的`&#xD;`和。`&#xA;`

```
var xslTransObj = new XslCompiledTransform();
var reader = new XmlTextReader(new StringReader(xslt_xslt));
xslTransObj.Load(reader);
var sw = new StringWriter();
var writer = new XmlTextWriter(sw);
xslTransObj.Transform(new XmlTextReader(new StringReader(xslt_data)), writer);

ResultLiteral.Text = sw.ToString(); 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-11T16:16:39.053

它们是 XML 或 XSLT 中的`&#xD;&#xA;`回车和换行。确保xml就像

```
<Value>3</Value> 
```

而不是

```
<Value>
    3
</Value> 
```

我相信有一种方法可以阻止在您的转换中使用空格，尽管我不知道它是否在我的脑海中。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-11T19:19:16.853

您正在从源文档中获取空格。利用

```
style="width:{normalize-space(Data/PercentSpaceUsed)}%;" 
```

去除空格。在您的情况下，另一个选择是使用

```
style="width:{number(Data/PercentSpaceUsed)}%;" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-10T19:44:29.750

尝试

```
 XmlWriterSettings settings = new XmlWriterSettings();
settings.OmitXmlDeclaration = true;
settings.Indent = true;
settings.IndentChars = "\t";
settings.NewLineHandling = NewLineHandling.None;
XmlWriter writer = XmlWriter.Create(xmlpath, settings); 
```

用于在属性值的输出上保留输入空格。

*注意：使用上述设置，制表符用于缩进*

# asp.net-mvc - “注入”Request.Url.Hosts - ASP.net MVC

> ID：848846
> 
> 赞同：4
> 
> 时间：2009-05-11T16:12:31.090
> 
> 标签：asp.net-mvc

在我的 ASP.net MVC 应用程序中，我需要获取应用程序的主机，因为我必须区分多个域/实例。

考虑到良好的设计和可测试性，我不想这样：

```
public ViewResult Show(int id)
{
   string host = Request.Url.Host;
   ....
} 
```

是否有可能通过构造函数“注入”它。

这个问题最干净的解决方案是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T22:41:30.783

您还可以为控制器使用一些构造函数，如下所示：

```
public MyController() : this(DefaultHostGetter) { }
public MyController(Func<string> hostGetter)
{
    this.hostGetter = hostGetter;
}

private string DefaultHostGetter() { return this.Request.Url.Host; } 
```

视图动作将是：

```
public ViewResult Show(int id)
{
   string host = this.hostGetter();
   ....
} 
```

然后，您可以通过提供不同的主机吸气剂（模拟）来测试您的控制器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:06:33.060

在这种情况下，也许您不需要“注入”。我认为为了获得良好的可测试性，最干净的解决方案将是模拟您的请求。示例（使用[Moq](http://code.google.com/p/moq/)库）：

```
var request = new Mock<HttpRequestBase>();
request.SetupGet(x => x.Url).Returns(new Uri("http://localhost/any"));

var context = new Mock<HttpContextBase>();
context.SetupGet(x => x.Request).Returns(request.Object);

var controller = new YourController();
controller.ControllerContext = new ControllerContext(context.Object, new RouteData(), controller); 
```

# collections - ASP FileSystemObject 集合不能被索引访问

> ID：848851
> 
> 赞同：3
> 
> 时间：2009-05-11T16:13:47.000
> 
> 标签：collections, asp-classic, filesystemobject

**我要疯了吗？**我找不到使用 FileSystemObject（经典 ASP）获取文件夹中第一个文件的方法。对于大多数集合，您会认为索引 0 或 1 可能有效，但 IIS 会显示“无效的过程调用或参数”。

最后两行都不起作用：

```
Set oFileScripting = CreateObject("Scripting.FileSystemObject")
Set oFolder = oFileScripting.GetFolder(sFolder)
Set oFiles = oFolder.Files
If oFiles.Count = 0 Then Response.Write "no files"
Response.Write oFiles(0).Name
Response.Write oFiles.Item(1).Name 
```

我是不是超级愚蠢，还是没有办法使用索引来访问这个特定的集合？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T16:33:01.350

文件集合不是数组，也不包含随机访问功能。如果您绝对需要此功能，最接近模仿的方法是遍历文件夹并创建一个包含找到的文件名称的新数组，使用这个新数组作为随机访问源，并从数组值。

```
ReDim FileArray(oFiles.Count)

i = 0
For Each oFile In oFiles
   FileArray(i) = oFile.Name
   i = i + 1
Next

Set oFile = oFileScripting.GetFile(sFolder + "\" + FileArray(0)) 
```

如果可以避免的话，我当然不会推荐这个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:54:02.130

不，但您可以枚举它们并自己跟踪索引：

```
Set oFileScripting = CreateObject("Scripting.FileSystemObject")
Set oFolder = oFileScripting.GetFolder(sFolder)
Set oFiles = oFolder.Files
If oFiles.Count = 0 Then Response.Write "no files"

i = 0
For Each oFile In oFiles
   Response.Write i & " = " & oFile.Name
   i = i + 1
Next 
```

# powershell - 在 PowerShell 中使用 -notlike 过滤掉多个字符串

> ID：848859
> 
> 赞同：34
> 
> 时间：2009-05-11T16:16:00.290
> 
> 标签：powershell

我正在尝试读取事件日志以对除两个用户之外的所有用户进行安全审核，但是否可以与操作员一起执行此`-notlike`操作？

是这样的：

```
Get-EventLog -LogName Security | where {$_.UserName -notlike @("*user1","*user2")} 
```

我让它为单个用户工作，例如：

```
Get-EventLog -LogName Security | where {$_.UserName -notlike "*user1"} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-05-11T17:30:06.907

V2 至少包含`-username`接受 string[] 的参数，并且支持 globbing。

V1 你想像这样扩展你的测试：

```
Get-EventLog Security | ?{$_.UserName -notlike "user1" -and $_.UserName -notlike "*user2"} 
```

或者您可以在内联数组上使用“-notcontains”，但这只有在您可以对用户名进行精确匹配时才有效。

`... | ?{@("user1","user2") -notcontains $_.username}`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-12T01:18:08.093

我认为彼得的想法是正确的。我会为此使用正则表达式和 -notmatch 运算符。

```
Get-EventLog Security | ?{$_.Username -notmatch '^user1$|^.*user$'} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-12T20:01:25.140

为了支持“匹配任何...”场景，我创建了一个非常容易阅读的函数。我的版本有更多内容，因为它是一个 PowerShell 2.0 cmdlet，但我在下面粘贴的版本应该在 1.0 中工作并且没有多余的装饰。

你这样称呼它：

```
Get-Process | Where-Match Company -Like '*VMWare*','*Microsoft*'
Get-Process | Where-Match Company -Regex '^Microsoft.*'

filter Where-Match($Selector,[String[]]$Like,[String[]]$Regex) {

    if ($Selector -is [String]) { $Value = $_.$Selector }
    elseif ($Selector -is [ScriptBlock]) { $Value = &$Selector }
    else { throw 'Selector must be a ScriptBlock or property name' }

    if ($Like.Length) {
        foreach ($Pattern in $Like) {
            if ($Value -like $Pattern) { return $_ }
        }
    }

    if ($Regex.Length) {
        foreach ($Pattern in $Regex) {
            if ($Value -match $Pattern) { return $_ }
        }
    }

}

filter Where-NotMatch($Selector,[String[]]$Like,[String[]]$Regex) {

    if ($Selector -is [String]) { $Value = $_.$Selector }
    elseif ($Selector -is [ScriptBlock]) { $Value = &$Selector }
    else { throw 'Selector must be a ScriptBlock or property name' }

    if ($Like.Length) {
        foreach ($Pattern in $Like) {
            if ($Value -like $Pattern) { return }
        }
    }

    if ($Regex.Length) {
        foreach ($Pattern in $Regex) {
            if ($Value -match $Pattern) { return }
        }
    }

    return $_

} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-11-15T10:10:22.120

不要使用 -notLike，-notMatch 与正则表达式一起工作：

```
Get-MailBoxPermission -id newsletter | ? {$_.User -NotMatch "NT-AUTORIT.*|.*-Admins|.*Administrators|.*Manage.*"} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-12-13T14:10:14.183

我为多个搜索找到的最简单方法是将它们全部通过管道传输（可能更重的 CPU 使用），但对于您的示例用户：

```
Get-EventLog -LogName Security | where {$_.UserName -notlike "*user1"} |  where {$_.UserName -notlike "*user2"} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-12-10T23:05:19.380

场景：列出所有以 XX1 开头的计算机，但不列出第 4 个字符为 L 或 P 的名称

```
Get-ADComputer -Filter {(name -like "XX1*")} | Select Name | Where {($_.name -notlike "XX1L*" -and $_.name -notlike "XX1P*")} 
```

您还可以通过将上述脚本括在括号中并添加 .count 方法来计算它们，如下所示：

```
(Get-ADComputer -Filter {(name -like "XX1*")} | Select Name | Where {($_.name -notlike "XX1L*" -and $_.name -notlike "XX1P*")}).count 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T19:53:54.927

```
$listOfUsernames = @("user1", "user2", "etc", "and so on")
Get-EventLog -LogName Security | 
    where { $_.Username -notmatch (
        '(' + [string]::Join(')|(', $listOfUsernames) + ')') } 
```

我承认这有点疯狂，它无法转义用户名（在不太可能的情况下，用户名使用正则表达式转义字符，如 '\' 或 '(' ），但它有效。

正如上面提到的“slipsec”，如果可能，请使用 -notcontains。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-01-06T22:18:41.647

使用选择字符串：

```
Get-EventLog Security | where {$_.UserName | select-string -notmatch user1,user2} 
```

# javascript - JavaScript 另存为当前日期

> ID：848864
> 
> 赞同：0
> 
> 时间：2009-05-11T16:17:05.577
> 
> 标签：javascript, pdf, adobe

我有一个名为 Timesheet Paperless.pdf 的时间表表格，我将此表格发送给一名员工并告诉他们在表格中填写他们的姓名和员工编号。然后我要求他们转到 File>Save As 并将表单命名为 INTIALS_TS.pdf 。我现在想在表单中有一个按钮，该按钮将在 My Documents/Work Files/Time Sheets/ 下打开文件名为 INITIALS_TS CurrentDate.pdf 的另存为对话框。因此，每个新的支付期他们都会单击表单上的保存按钮，将文件保存在时间表文件夹下，其中包含他们的姓名首字母和按下按钮的当前日期。如何在 JavaScript 中做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T16:44:28.977

抱歉，JavaScript 无法做到这一点。

想到的最接近的解决方案是打开一个指向服务器端脚本的链接，该脚本输出 PDF 以及内容处置标题。

```
Content-Disposition: attachment; filename=INITALS_TS.pdf 
```

# c# - 在 Winforms 中绘制一个闪烁的插入符号

> ID：848868
> 
> 赞同：1
> 
> 时间：2009-05-11T16:18:41.283
> 
> 标签：c#, winforms, drawing, custom-controls, caret

我正在开发一个自定义控件，它最类似于文本区域。我正在绘制文本，它可以正常工作，并接受也可以工作的输入。但是我（用户）在我输入时猜测插入符号在哪里，因为我正在手动完成所有操作。如何绘制闪烁的插入符号以显示我当前正在输入的位置？有没有标准的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:24:15.440

我认为，令人讨厌的是，没有用于 Carets 的托管 API。因此，您必须对插入符号的 Win32 函数进行 PInvoke，或者自己实现该功能（即绘制和隐藏闪烁的插入符号，当且仅当您的控件具有输入焦点时）。

例如，请参阅[WinForms TextBox 的自定义插入符号](https://stackoverflow.com/questions/609927/custom-caret-for-winforms-textbox)。

# c# - 如何从字符串中设置整数十六进制文字，

> ID：848869
> 
> 赞同：2
> 
> 时间：2009-05-11T16:18:56.663
> 
> 标签：c#, .net, xml, hex

我试图从 xml 设置文件加载十六进制文字，我可以很好地解析 xml 并从文件中获取所需的字符串，

但我似乎无法让它设置一个 int 变量值：/

代码：

```
 int PlayerBaseAddress = System.Convert.ToInt32(ConfigLoader.GetSetting("PlayerBaseAddress"));
    // Input string was not in a correct format.

    public static string GetSetting(string Val)
    {
       // This loads from the xml file, Pretend its hardcoded to return a string of 0x17EAAF00
    }

    int PlayerBaseAddress = 0x17EAAF00; // This works. 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T16:22:19.543

您必须将字符串的基数提供给重载的方法[`Convert.ToInt32(String value, Int32 fromBase)`](http://msdn.microsoft.com/en-us/library/1k20k614.aspx)。

```
Int32 value = Convert.ToInt32(hexString, 16); 
```

# sql - 从 SQL Server 表中选择 n 个随机行

> ID：848872
> 
> 赞同：345
> 
> 时间：2009-05-11T16:19:11.890
> 
> 标签：sql, sql-server, random

我有一个包含大约 50,000 行的 SQL Server 表。我想随机选择大约 5,000 行。我想到了一种复杂的方法，创建一个带有“随机数”列的临时表，将我的表复制到其中，循环遍历临时表并使用 更新每一行`RAND()`，然后从该表中选择随机数列 < 0.1。我正在寻找一种更简单的方法来做到这一点，如果可能的话，在一个语句中。

[本文](http://www.sql-server-helper.com/tips/generate-random-numbers.aspx)建议使用该`NEWID()`功能。这看起来很有希望，但我看不出我如何能够可靠地选择一定百分比的行。

以前有人这样做过吗？有任何想法吗？

* * *

## 回答 #1

> 赞同：436
> 
> 时间：2009-05-11T16:26:29.507

```
select top 10 percent * from [yourtable] order by newid() 
```

回应有关大表的“纯垃圾”评论：您可以这样做以提高性能。

```
select  * from [yourtable] where [yourPk] in 
(select top 10 percent [yourPk] from [yourtable] order by newid()) 
```

这样做的成本将是值的键扫描加上连接成本，这在具有小百分比选择的大表上应该是合理的。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-05-11T20:15:58.757

根据您的需要，`TABLESAMPLE`将为您带来几乎一样随机和更好的性能。这在 MS SQL Server 2005 及更高版本上可用。

`TABLESAMPLE`将从随机页面而不是随机行返回数据，因此 deos 甚至不会检索它不会返回的数据。

在我测试的一张非常大的桌子上

```
select top 1 percent * from [tablename] order by newid() 
```

花了20多分钟。

```
select * from [tablename] tablesample(1 percent) 
```

花了2分钟。

在较小的样本上性能也会有所提高，`TABLESAMPLE`而在`newid()`.

请记住，这不像该`newid()`方法那样随机，但会给您一个不错的采样。

请参阅[MSDN 页面](http://msdn.microsoft.com/en-us/library/ms189108.aspx)。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-05-28T18:15:18.360

newid()/order by 会起作用，但对于大型结果集来说会非常昂贵，因为它必须为每一行生成一个 id，然后对它们进行排序。

TABLESAMPLE() 从性能的角度来看是好的，但你会得到结块的结果（将返回页面上的所有行）。

为了获得更好的真实随机样本，最好的方法是随机过滤掉行。我在 SQL Server 联机丛书文章*[使用 TABLESAMPLE 限制结果](http://msdn.microsoft.com/en-us/library/ms189108.aspx)*集中找到了以下代码示例：

> 如果您真的想要单个行的随机样本，请修改您的查询以随机过滤掉行，而不是使用 TABLESAMPLE。例如，以下查询使用 NEWID 函数返回 Sales.SalesOrderDetail 表中大约百分之一的行：
> 
> ```
> SELECT * FROM Sales.SalesOrderDetail
> WHERE 0.01 >= CAST(CHECKSUM(NEWID(),SalesOrderID) & 0x7fffffff AS float)
>               / CAST (0x7fffffff AS int) 
> ```
> 
> SalesOrderID 列包含在 CHECKSUM 表达式中，以便 NEWID() 每行计算一次，以实现逐行抽样。表达式 CAST(CHECKSUM(NEWID(), SalesOrderID) & 0x7fffffff AS float / CAST (0x7fffffff AS int) 计算为 0 到 1 之间的随机浮点值。

当针对具有 1,000,000 行的表运行时，这是我的结果：

```
SET STATISTICS TIME ON
SET STATISTICS IO ON

/* newid()
   rows returned: 10000
   logical reads: 3359
   CPU time: 3312 ms
   elapsed time = 3359 ms
*/
SELECT TOP 1 PERCENT Number
FROM Numbers
ORDER BY newid()

/* TABLESAMPLE
   rows returned: 9269 (varies)
   logical reads: 32
   CPU time: 0 ms
   elapsed time: 5 ms
*/
SELECT Number
FROM Numbers
TABLESAMPLE (1 PERCENT)

/* Filter
   rows returned: 9994 (varies)
   logical reads: 3359
   CPU time: 641 ms
   elapsed time: 627 ms
*/    
SELECT Number
FROM Numbers
WHERE 0.01 >= CAST(CHECKSUM(NEWID(), Number) & 0x7fffffff AS float) 
              / CAST (0x7fffffff AS int)

SET STATISTICS IO OFF
SET STATISTICS TIME OFF 
```

如果您可以摆脱使用 TABLESAMPLE，它将为您提供最佳性能。否则使用 newid()/filter 方法。如果结果集很大，ne​​wid()/order by 应该是最后的手段。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2012-09-05T22:23:02.397

[从 MSDN 上的大表中随机选择行](http://msdn.microsoft.com/en-us/library/cc441928.aspx)有一个简单、清晰的解决方案，可以解决大规模的性能问题。

```
 SELECT * FROM Table1
  WHERE (ABS(CAST(
  (BINARY_CHECKSUM(*) *
  RAND()) as int)) % 100) < 10 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-10-15T21:51:56.817

此链接对具有 1、7 和 1300 万行的表的 Orderby(NEWID()) 和其他方法进行了有趣的比较。

通常，当在讨论组中询问有关如何选择随机行的问题时，会提出 NEWID 查询；它很简单，非常适合小桌子。

```
SELECT TOP 10 PERCENT *
  FROM Table1
  ORDER BY NEWID() 
```

但是，当您将 NEWID 查询用于大型表时，它有一个很大的缺点。ORDER BY 子句使表中的所有行都复制到 tempdb 数据库中，并在其中进行排序。这会导致两个问题：

1.  排序操作通常具有与之相关的高成本。排序可以使用大量的磁盘 I/O，并且可以运行很长时间。
2.  在最坏的情况下，tempdb 可能会耗尽空间。在最好的情况下，tempdb 会占用大量磁盘空间，如果没有手动收缩命令，这些空间永远不会被回收。

您需要的是一种随机选择行的方法，该方法不会使用 tempdb，并且不会随着表变大而变慢。这是一个关于如何做到这一点的新想法：

```
SELECT * FROM Table1
  WHERE (ABS(CAST(
  (BINARY_CHECKSUM(*) *
  RAND()) as int)) % 100) < 10 
```

这个查询背后的基本思想是，我们要为表中的每一行生成一个 0 到 99 之间的随机数，然后选择所有那些随机数小于指定百分比值的行。在本例中，我们希望随机选择大约 10% 的行；因此，我们选择随机数小于 10 的所有行。

[请阅读MSDN](https://msdn.microsoft.com/en-us/library/cc441928.aspx)中的完整文章。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-05-11T16:31:11.013

只需按随机数对表进行排序，并使用 . 获取前 5,000 行`TOP`。

```
SELECT TOP 5000 * FROM [Table] ORDER BY newid(); 
```

**更新**

刚试了一下，一个`newid()`电话就足够了——不需要所有的演员和所有的数学。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2012-09-26T17:23:46.627

如果您（与 OP 不同）需要特定数量的记录（这使得 CHECKSUM 方法变得困难）并且希望获得比 TABLESAMPLE 本身提供的更随机的样本，并且还想要比 CHECKSUM 更快的速度，您可以通过合并TABLESAMPLE 和 NEWID() 方法，如下所示：

```
DECLARE @sampleCount int = 50
SET STATISTICS TIME ON

SELECT TOP (@sampleCount) * 
FROM [yourtable] TABLESAMPLE(10 PERCENT)
ORDER BY NEWID()

SET STATISTICS TIME OFF 
```

就我而言，这是随机性（我知道这不是真的）和速度之间最直接的折衷。根据需要改变 TABLESAMPLE 百分比（或行） - 百分比越高，样本越随机，但预计速度会线性下降。（注意 TABLESAMPLE 不接受变量）

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-10-16T17:03:52.950

这是初始种子想法和校验和的组合，在我看来，它可以在没有 NEWID() 成本的情况下给出适当的随机结果：

```
SELECT TOP [number] 
FROM table_name
ORDER BY RAND(CHECKSUM(*) * RAND()) 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-11T16:30:59.577

在 MySQL 中，您可以这样做：

```
SELECT `PRIMARY_KEY`, rand() FROM table ORDER BY rand() LIMIT 5000; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-07-29T17:45:15.073

还没有完全看到答案中的这种变化。在给定初始种子的情况下，我需要一个额外的约束来每次选择相同的行集。

对于 MS SQL：

最小示例：

```
select top 10 percent *
from table_name
order by rand(checksum(*)) 
```

标准化执行时间：1.00

NewId() 示例：

```
select top 10 percent *
from table_name
order by newid() 
```

标准化执行时间：1.02

`NewId()`比 慢得多`rand(checksum(*))`，因此您可能不想将它用于大型记录集。

用初始种子选择：

```
declare @seed int
set @seed = Year(getdate()) * month(getdate()) /* any other initial seed here */

select top 10 percent *
from table_name
order by rand(checksum(*) % @seed) /* any other math function here */ 
```

如果您需要在给定种子的情况下选择相同的集合，这似乎可行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-09-27T07:59:48.683

尝试这个：

```
SELECT TOP 10 Field1, ..., FieldN
FROM Table1
ORDER BY NEWID() 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-02-12T21:20:48.550

这是*一种更新和改进的抽样形式*。它基于使用`CHECKSUM`/`BINARY_CHECKSUM`和模数的其他一些答案的相同概念。

使用与此类似的实现的原因，而不是其他答案：

*   **它*在庞大的数据集上相对较快，***并且**可以有效地用于/与派生查询一起使用**。*无需使用 tempdb*即可在几秒钟内对数百万个预先过滤的行进行采样，如果与查询的其余部分保持一致，则开销通常很小。
*   ***不受数据运行`CHECKSUM(*)`/`BINARY_CHECKSUM(*)`问题的影响。*使用该`CHECKSUM(*)`方法时，可以“块”而不是“随机”选择行！这是因为*CHECKSUM 更喜欢速度而不是分布*。**
*   **产生*稳定/可重复*的行选择**，并且可以简单地更改以在后续查询执行中生成不同的行。使用 的方法`NEWID()`，例如`CHECKSUM(NEWID()) % 100`，永远不会是稳定的/可重复的。
*   **允许*提高样本精度***并减少引入的统计误差。采样精度也可以调整。`CHECKSUM`只返回一个`int`值。
*   **不使用`ORDER BY NEWID()`，因为*排序可能成为*大型输入集的重要瓶颈。**避免排序还*可以减少内存和 tempdb 的使用*。
*   不使用`TABLESAMPLE`，因此与`WHERE`预过滤器一起使用。

缺点/限制：

*   执行时间稍慢并使用`CHECKSUM(*)`. 如下所示，使用哈希字节每百万行增加大约 3/4 秒的开销。这是我的数据，在我的数据库实例上：YMMV。*如果使用来自 HASHBYTES**的结果“分布良好”值的持久计算列，则可以消除此开销。`bigint`*
*   与 basic 不同`SELECT TOP n .. ORDER BY NEWID()`，这*不能保证*返回“正好 N”行。相反，它返回一个*百分比*行行，其中这样的值是预先确定的。对于非常小的样本量，这可能会导致选择 0 行。该限制与这些`CHECKSUM(*)`方法共享。

这是要点：

```
-- Allow a sampling precision [0, 100.0000].
declare @sample_percent decimal(7, 4) = 12.3456

select
    t.*
from t
where 1=1
    and t.Name = 'Mr. No Questionable Checksum Usages'
    and ( -- sample
        @sample_percent = 100
        or abs(
            -- Choose appropriate identity column(s) for hashbytes input.
            -- For demonstration it is assumed to be a UNIQUEIDENTIFIER rowguid column.
            convert(bigint, hashbytes('SHA1', convert(varbinary(32), t.rowguid)))
        ) % (1000 * 100) < (1000 * @sample_percent)
    ) 
```

笔记：

*   虽然 SHA1 自 SQL Server 2016 以来在技术上已被弃用，但它既足以完成任务，又比 MD5 或 SHA2_256 略快。根据需要使用不同的散列函数。如果该表已经包含一个散列列（具有良好的分布），那么它也可能被使用。
*   的转换`bigint`很关键，因为它允许 2^63 位的“随机空间”应用模运算符；这远远超过 CHECKSUM 结果的 2^31 范围。这减少了极限处的模数误差，特别是随着精度的提高。
*   只要适当地乘以模操作数和采样百分比，就可以改变采样精度。在这种情况下，即`1000 *`考虑 . 中允许的 4 位精度`@sample_percent`。
*   可以将`bigint`值乘以`RAND()`每次运行返回不同的行样本。这有效地改变了固定哈希值的排列。
*   如果`@sample_percent`为 100，则查询计划器可以完全消除较慢的计算代码。记住“参数嗅探”规则。这允许将代码留在查询中，而不管是否启用采样。

* * *

计算`@sample_percent`，具有下限/上限，并`TOP`在查询中添加“提示”，这在派生表上下文中使用样本时*可能*很有用。

```
-- Approximate max-sample and min-sample ranges.
-- The minimum sample percent should be non-zero within the precision.
declare @max_sample_size int = 3333333
declare @min_sample_percent decimal(7,4) = 0.3333
declare @sample_percent decimal(7,4) -- [0, 100.0000]
declare @sample_size int

-- Get initial count for determining sample percentages.
-- Remember to match the filter conditions with the usage site!
declare @rows int
select @rows = count(1)
    from t
    where 1=1
        and t.Name = 'Mr. No Questionable Checksum Usages'

-- Calculate sample percent and back-calculate actual sample size.
if @rows <= @max_sample_size begin
    set @sample_percent = 100
end else begin
    set @sample_percent = convert(float, 100) * @max_sample_size / @rows
    if @sample_percent < @min_sample_percent
        set @sample_percent = @min_sample_percent
end
set @sample_size = ceiling(@rows * @sample_percent / 100)

select *
from ..
join (
    -- Not a precise value: if limiting exactly at, can introduce more bias.
    -- Using 'option optimize for' avoids this while requiring dynamic SQL.
    select top (@sample_size + convert(int, @sample_percent + 5))
    from t
    where 1=1
        and t.Name = 'Mr. No Questionable Checksum Usages'
        and ( -- sample
            @sample_percent = 100
            or abs(
                convert(bigint, hashbytes('SHA1', convert(varbinary(32), t.rowguid)))
            ) % (1000 * 100) < (1000 * @sample_percent)
        )
) sampled
on .. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-05-07T22:17:37.387

看来 newid() 不能在 where 子句中使用，所以这个解决方案需要一个内部查询：

```
SELECT *
FROM (
    SELECT *, ABS(CHECKSUM(NEWID())) AS Rnd
    FROM MyTable
) vw
WHERE Rnd % 100 < 10        --10% 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-09-04T10:29:50.343

```
select  * from table
where id in (
    select id from table
order by random()
limit ((select count(*) from table)*55/100))

// to select 55 percent of rows randomly 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-10T12:40:18.260

我在子查询中使用它，它在子查询中返回了相同的行

```
 SELECT  ID ,
            ( SELECT TOP 1
                        ImageURL
              FROM      SubTable 
              ORDER BY  NEWID()
            ) AS ImageURL,
            GETUTCDATE() ,
            1
    FROM    Mytable 
```

然后我解决了在 where 中包含父表变量

```
SELECT  ID ,
            ( SELECT TOP 1
                        ImageURL
              FROM      SubTable 
              Where Mytable.ID>0
              ORDER BY  NEWID()
            ) AS ImageURL,
            GETUTCDATE() ,
            1
    FROM    Mytable 
```

注意 where 条件

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-13T23:12:24.997

如果你知道你有大约 N 行并且你想要大约 K 个随机行，你只需要以 K/N 的机会拉出任何给定的行。使用 RAND() 函数可以在 0 和 1 之间进行公平分配，您可以在 PROB = K/N 的情况下执行以下操作。对我来说工作得很快。

`SELECT * FROM some_table WHERE RAND() < PROB`

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-06-13T06:05:42.790

未指定使用的服务器端处理语言（例如 PHP、.net 等），但如果是 PHP，请获取所需的数字（或所有记录），而不是在查询中随机化，而是使用 PHP 的 shuffle 函数。我不知道 .net 是否具有等效功能，但如果有，那么如果您使用的是 .net，则使用该功能

ORDER BY RAND() 可能会产生相当大的性能损失，具体取决于涉及的记录数。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2010-12-10T12:20:17.320

这对我有用：

```
SELECT * FROM table_name
ORDER BY RANDOM()
LIMIT [number] 
```

# emacs - 如何将 META 重新映射到 ALT？

> ID：848878
> 
> 赞同：12
> 
> 时间：2009-05-11T16:20:25.430
> 
> 标签：emacs, ubuntu

我在 Ubuntu 中使用 emacs。如何将 META 重新映射到 ALT 键？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-13T16:58:42.617

如果您在 gnome-terminal 中运行 emacs，则 gnome-terminal 可能会捕获您的 alt 键以打开 gui 菜单（文件、编辑...）。您可以通过选择 Edit >> Keyboard Shortcuts ... 并取消选中“Enable menu access keys ...”来更改此行为。

在我的系统 Ubuntu 9.04 上，这让 alt 作为 emacs 的元数据。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-11T16:31:01.607

[通常默认`Meta`映射到`Alt`键。](http://www.gnu.org/software/emacs/emacs-faq.html#No-Meta-key)

当您键入 时，Emacs 窗口底部的[回声区域](http://www.cs.cmu.edu/cgi-bin/info2www?(emacs)Echo%20Area)会显示什么`Alt+X`？如果你看到`M-x`then`Alt`是作为`Meta`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-11T17:28:02.603

回到过去，META 键似乎很难映射到 ALT。那时我不得不使用[xmodmap](http://www.manpagez.com/man/1/xmodmap/)，这些都是我必须放入我的 .xmodmap 文件的东西。以下的一些变化总是有效的（它取决于系统）。我的 .xinitrc 文件会`xmodmap`读入该文件。

```
!! Note the `!` are comment characters.

!! suggested to make Emacs work under VNC
keysym Alt_L = Meta_L
keysym Alt_R = Meta_R

!! xmodmap -e 'keysym Alt_L = Meta_L' -e 'keysym Alt_R = Meta_R'
!!
!! some environments still can't handle alt key properly
!! add this:
!!
clear Mod1
add Mod1 = Meta_L Meta_R

!! or
!! xmodmap -e "clear Mod1" -e "add Mod1 = Meta_L Meta_R" 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T16:32:28.217

使用[xkeycaps](http://www.jwz.org/xkeycaps/)查看您的键盘映射并交换 META 和 ALT 修饰符，或者只是交换整个键。因为 GNOME 对哪些键具有 META 和 ALT 修饰符有一些假设，所以完全交换键可能会让您的生活更轻松。

xkeycaps 应该以 ubuntu 包的形式提供。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-01-10T07:55:11.793

如果使用 Mac，打开终端然后导航到`Terminal > Preferences`. 在配置文件选项卡下，选中 上的复选框`Use Option as Meta Key`。看截图

![用户选项作为元键](https://i.stack.imgur.com/kcCRw.png)

这应该够了吧。

# text-editor - 为什么 VIM 为每个 X 创建一个 X~ 文件？

> ID：848881
> 
> 赞同：2
> 
> 时间：2009-05-11T16:20:48.563
> 
> 标签：text-editor, vim

X~ 文件的用途是什么？如果没有必要，有没有办法阻止 Vim 创建一个？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-11T16:21:46.020

这是一个备份文件，其中包含该文件的先前版本的副本。

您可以通过在 .vimrc 文件末尾添加一行来更改此行为：

```
set nobackup 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T16:22:43.727

它是一个备份文件，每次您在修改内容时保存它都会创建一个。有一个选项可以关闭它。

[从 vim 常见问题中看到这里](http://vimdoc.sf.net/cgi-bin/vimfaq2html3.pl#7.1)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-11T16:26:07.557

我个人所做的是创建一个`$HOME/.vim/backupfiles`包含所有备份文件的文件夹，而不是将它们分散在各处。

我的`.vimrc`包含以下内容：

```
set backupdir=~/.vim/backupfiles,~/tmp,. 
```

这样，您就可以保护备份文件，但避免文件夹中乱扔`*~`文件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-11T16:22:52.010

使用关闭它

```
:se nobackup 
```

您还可以使用以下命令告诉它将备份文件放在不同的位置：

```
:se directory=c:\temp 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-11T16:23:06.237

Vim 正在自动创建备份文件。要关闭它，您必须将以下行添加到您的 .vimrc 配置文件中：

> 设置无备份

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-11T16:23:06.237

它们是备份文件。也许`:set nowritebackup`会关闭此功能。

# c# - 如何从 WCF 调用返回响应，然后做更多工作？

> ID：848886
> 
> 赞同：0
> 
> 时间：2009-05-11T16:22:01.167
> 
> 标签：c#, .net, wcf, multithreading

我有一个返回消息的同步 Web 服务调用。我需要快速返回一条消息，基本上说已收到订单。然后我需要花几分钟处理订单，但不能长时间阻止服务调用。那么我怎样才能从 Web 服务返回，然后做更多的事情呢？我猜我需要在返回之前分叉一些其他线程或其他东西，但我不确定最好的方法。

```
string ProcessOrder(Order order)
{
  if(order.IsValid)
  {
      return "Great!";
      //Then I need to process the order
  }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T16:28:07.977

您可以打开一个新线程并让它做您需要的事情，而您的主线程返回很好。

```
string ProcessOrder(Order order)
{
  if(order.IsValid)
  {
            //Starts a new thread
            ThreadPool.QueueUserWorkItem(th =>
                {
                    //Process Order here

                });

      return "Great!";
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T16:30:49.703

你可以在一个单独的线程中开始你的大量工作

```
public string ProcessOrder(Order order)
{
   if(order.IsValid)
   {
        System.Threading.ParameterizedThreadStart pts = new System.Threading.ParameterizedThreadStart(DoHardWork);

        System.Threading.Thread t = new System.Threading.Thread(pts);
        t.Start(order);

        return "Great!!!";
   }
}

public void DoHardWork(object order)
{
//Stuff Goes Here
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T17:32:41.317

您还可以考虑在方法调用后利用 PIAB（策略注入应用程序块）来完成工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:39:26.960

你正在做的工作“重要”吗？我想是的。您可以使用线程，但如果机器重新启动或 asp.net 工作进程回收，您的工作可能会中断，您必须接受。即使您已经告诉客户您已接受，这也可能导致工作无法完成。这可能取决于您的用例。

我会考虑将您从同步服务请求中收到的工作项放入持久队列中。一种简单的方法是使用事务性 MSMQ 队列。您的同步服务将工作请求放入队列中，并且您有一些工作线程将工作请求从队列中拉出。将您的队列读取和工作包装在事务中，并且在工作完成之前不要提交事务。如果您的机器或进程在请求中间关闭，它将在下次启动时自动重新启动。

# asp.net - .net cookie，我必须发送到浏览器吗？

> ID：848897
> 
> 赞同：1
> 
> 时间：2009-05-11T16:23:36.517
> 
> 标签：asp.net, cookies

创建或修改 httpcookie 后，是否必须将其添加到 response.cookies 集合中？（如果是，仅当它是一个新的 cookie 或者即使我正在修改一个）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T16:38:58.037

如果它是新的，则需要将其添加到要存储的 Response.Cookies 集合中，但您可以像访问数组一样访问该集合。

```
Response.Cookies["foo"] = myCookie; 
```

这将为您处理添加。仅供参考，如果尚未创建 cookie，则该值将返回 null。

但是，如果您像这样引用集合，cookie 将被更新：

```
HttpCookie myCookie = Response.Cookies["foo"]; 
```

对 myCookie 的任何修改都将对集合中的 cookie 进行，因为在 C# 中，当您将变量分配给现有的类对象时，该对象通过引用处理并被修改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:44:19.353

如果您不将 cookie 添加到 Response.Cookies 集合中，它将永远不会发送到浏览器。但是，一旦您将 cookie 添加到集合中，您可以随意修改它，您设置的最后一个值就是将发送到浏览器的值。您添加到集合中的是对您的 HttpCookie 对象的引用，并且 cookie 直到请求生命周期结束时才会发送到浏览器。

# unit-testing - 单元测试程序（相对于函数）

> ID：848901
> 
> 赞同：2
> 
> 时间：2009-05-11T16:25:47.650
> 
> 标签：unit-testing

我是单元测试的新手，想知道你将如何对一个过程进行单元测试（在这种情况下，一个过程是一个“做某事”而不是“返回某事”的函数。

我知道测试返回答案的函数的一般想法是

```
assert(yourfunction(sample, inputs) == expected_answer); 
```

但我想知道如果某些东西不返回或仅返回状态码，这将如何工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T16:29:35.010

你需要能够测试它的作用。例如，您的程序是否向集合中添加了某些内容？设置属性？创建文件？

不管是什么，想必这种变化是可见*的*。你只需要弄清楚如何检查这种效果。当然，有时说起来容易做起来难，这就是为什么函数式方法在合适的时候更容易测试的原因:) 特别是修改外部资源（文件系统、数据库等）的效果和*依赖*于外部资源的效果（同上）比仅以相当“本地”方式改变事物的那些更难测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:39:43.883

在某些情况下，过程所做的是调用其他依赖项的方法。在这种情况下，如果您使用依赖注入方法，则可以传入这些依赖项的模拟，并使用断言或期望来确保使用正确的参数对依赖项调用正确的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:40:08.690

对于过程，“做某事”通常涉及 API 调用或其他对象操作。

例如，一个过程可以将一行写入文件。它使用文件 I/O API 调用（或文件 IO 对象）来“写入一行”。

您要做的是创建“模拟”对象来代替文件。Mock 对象具有足够的功能来收集测试结果并使它们对断言可见。不要覆盖你的模拟对象，这是一个浪费时间的老鼠洞。

在 Python 中，我们做这样的事情。

```
class MockFile( object ):
    def __init__( self, aFileName, aMode ):
        self.name= aFileName
        self.mode= aMode
        self.buffer= None
    def write( self, aRow ):
        self.buffer= str(aRow) 
```

现在我们可以将这个模拟文件提供给我们的程序，而不是一个真实的文件。Ans 我们可以对发生的事情做出断言。

```
class TestSomeProcedure( unittest.TestCase ):
    def testWrite( self ):
        mockFile= MockFile( "name", "w" )
        theProcedureImTesting( args, args, args, mockFile )
        self.assertEquals( "The Row It Was Supposed to Write\n", mockFile.buffer ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:40:30.153

有很多不同的情况：

情况1：

```
 public class A
    {
      public void Foo()
      {
        Init();
      }

      protected virtual void Init()
      {
        Do something;
      }
    }

    [TestFixture]
    public class ATests
    {
      [Test]

      public void Foo_test()
      {
         A aStub = new A_Stub();
         aStub.Foo();
         Assert.IsTrue(aStub.wasInit);
      }

       public class A_Stub : A
       {
          public bool wasInit;

          protected override void Init()
          {
            wasInit = true;
          }
       }
  } 
```

情况 2：当您的方法依赖于另一个对象而不是执行属于同一类的成员时。在这种情况下，我建议使用 Mock 框架。我个人使用 Rhino.Mocks。您可以点击此链接查看[Rhino.Mocks 示例](http://ayende.com/Wiki/Rhino+Mocks+3.5.ashx)。

# asp.net - 在 asp.net mvc 中是否可以制作通用控制器？

> ID：848904
> 
> 赞同：27
> 
> 时间：2009-05-11T16:26:01.113
> 
> 标签：asp.net, asp.net-mvc, generics, controller

我正在尝试创建一个通用控制器，即：

```
public class MyController<T> : Controller where T : SomeType
{ ... } 
```

但是，当我尝试使用它时，我到处都遇到这个错误......

控制器名称必须以“Controller”结尾

所以，我的问题是，是否可以在 asp.net mvc 中制作通用控制器？

谢谢！

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-11T17:10:29.107

如果我正确理解您，您正在尝试做的是通过 T 类型的通用控制器路由给定模型的所有请求。

您希望 T 根据请求的型号而有所不同。

你想`/Product/Index`触发`MyController<Product>.Index()`

这可以通过编写自己`IControllerFactory`的方法并实现如下`CreateController`方法来完成：

```
public IController CreateController(RequestContext requestContext, string controllerName)
{
    Type controllerType = Type.GetType("MyController")
                              .MakeGenericType(Type.GetType(controllerName));
    return Activator.CreateInstance(controllerType) as IController;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-11T16:40:56.970

是的，你可以，这很好，我自己也用过很多次。

您需要确保的是，当您从 MyController 继承时，您仍然以控制器结束类型名称：

```
public class FooController :  MyController<Foo>
{ 
 ...
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-22T06:49:07.487

这是实际包含正确答案的[asp.net mvc 通用控制器](https://stackoverflow.com/questions/3413626/asp-net-mvc-generic-controller)的副本。杰夫弗里茨的回答绝对不正确。创建您自己的 IControllerFactory 不会超过 ExpressionHelper.GetRouteValuesFromExpression 的限制，这会产生您看到的错误。每当您调用 RedirectToAction、BuildUrlFromExpression、ActionLink、RenderAction、BeginForm 以及任何调用这些方法的任何方法时，实现您自己的 IControllerFactory 仍然会给您留下错误。

令我感兴趣的是，Microsoft 的“约定限制”已经由在 ExpressionHelper.GetRouteValuesFromExpression 方法中的类型上放置的约束“where TController : Controller”强制执行。没有泛型将永远满足约定验证：

```
string controllerName = typeof(TController).Name;
if (!controllerName.EndsWith("Controller", StringComparison.OrdinalIgnoreCase)) {
    throw new ArgumentException(MvcResources.ExpressionHelper_TargetMustEndInController, "action");
} 
```

除非它被以“Controller”结尾的类继承，因为 typeof(AnyGeneric).Name 永远不会以“Controller”结尾。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:32:35.613

默认控制器工厂在尝试查找将请求分派到的控制器时使用控制器名称周围的“约定”。如果需要，您可以覆盖此查找功能，然后可以允许您的通用控制器工作。

这篇 MSDN 文章...

[http://msdn.microsoft.com/en-us/magazine/dd695917.aspx](http://msdn.microsoft.com/en-us/magazine/dd695917.aspx)

...对正在发生的事情有很好的记录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T16:37:51.687

如果我是你，我会获取[MVC 源](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471)并使用源代码创建一个测试 MVC 项目，这样你就可以检查异常是在哪里生成的，看看你可以对你的通用想法和强制执行的“*控制器”命名约定做些什么.

# php - 遍历数据库并在表中显示

> ID：848905
> 
> 赞同：2
> 
> 时间：2009-05-11T16:26:01.160
> 
> 标签：php, mysql

我正在尝试遍历我的用户数据库以在自己的行中显示表中的每个用户名。我只能让它显示一个用户，但会循环显示其中的行数。代码如下

```
<?php
require_once ('../login/connection.php');
include ('functions.php');

$query = "SELECT * FROM users";
$results=mysql_query($query);
$row_count=mysql_num_rows($results);
$row_users = mysql_fetch_array($results);

echo "<table>";
    for ($i=0; $i<$row_count; $i++)
    {
    echo "<table><tr><td>".($row_users['email'])."</td></tr>";
    }
    echo "</table>";
?> 
```

谢谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-11T16:31:09.437

[mysql_fetch_array](http://php.net/mysql_fetch_array)获取单行 - 您通常在 while 循环中使用它来吃掉结果集中的所有行，例如

```
echo "<table>";

while ($row_users = mysql_fetch_array($results)) {
    //output a row here
    echo "<tr><td>".($row_users['email'])."</td></tr>";
}

echo "</table>"; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T16:31:26.270

你只取一行：

```
$row_users = mysql_fetch_array($results); 
```

你再也不会调用 fetch 了，所以你并没有真正循环任何东西。

我建议将您的循环更改为以下内容：

```
echo "<table>";
while ($row = mysql_fetch_array($results)) {
    echo "<tr><td>".($row['email'])."</td></tr>";
}
echo "</table>"; 
```

while 循环将遍历结果并将一行分配给 $row，直到您用完行。另外，此时无需处理获取结果的计数。这是在 php.ini 中循环遍历数据库结果的“通常”方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-06-22T13:14:44.307

在新的MYSQLI中，我使用这个编码

```
$query = "SELECT * FROM users";
$results=mysqli_query($con,$query);
$row_count=mysqli_num_rows($results);

echo "<table>";
while ($row = mysqli_fetch_array($results)) {
echo "<tr><td>".($row['id'])."</td></tr>";
}
echo "</table>";

mysqli_query($con,$query); 
mysqli_close($con); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:30:17.630

您的问题出在这一行：

```
echo "<table><tr><td>".($row_users['email'])."</td></tr>"; 
```

你`<table>`又回显了一个标签。删除它，使您的代码如下所示：

```
echo "<table>";
    for ($i=0; $i<$row_count; $i++)
    {
    echo "<tr><td>".($row_users['email'])."</td></tr>";
    }
echo "</table>"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T16:31:49.653

您不需要按照您的方式在表格中输出表格。

```
$result = mysql_query("SELECT `email` FROM `users`");
$num_emails = mysql_num_rows($result);

echo "<table><caption>There are/is $num_emails email(s)</caption>";
while ($row = mysql_fetch_assoc($result)) {
    echo "<tr><td>{$row['email']}</td></tr>";
}
echo '</table>'; 
```

像这样的东西应该工作。

# windows - 如何将一个用 Delphi 编写的基于 Windows 的应用程序移植到不同的平台，如 Mac、iPhone 和基于 Web 的应用程序？

> ID：848909
> 
> 赞同：1
> 
> 时间：2009-05-11T16:26:48.570
> 
> 标签：windows, port, multiplatform

目前，它只是一个用 Delphi 编写的基于 Windows 的应用程序（减速吉他软件）。但是，我确实有计划将它们移植到以下平台：

1.  苹果电脑
2.  苹果手机
3.  基于网络

我该怎么做？bes编程语言是什么？我需要寻找什么样的开发人员？这些项目将持续多久？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-05T11:49:21.543

如果您想保留 Delphi 代码，请查看[Lazarus/FreePascal](http://www.lazarus.freepascal.org/)。不得不说，我还没有用过Hello World，所以你必须评估自己是否可以帮助你，但它是免费的，它支持Windows/Mac/Linux。还支持 Windows Mobile。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:42:51.650

对于 1 和 2，您将使用 Cocoa，对于 3，您可以选择 Flash/Java Applet/Silverlight，具体取决于软件的复杂程度。显然，Flash 不是用于大型项目的最佳选择。但 Silverlight 和 Java Applet 是能够满足任何需求的强大平台。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:44:51.957

恐怕您不能简单地将 Delphi 代码“移植”到所有这些环境中。好的，通过 Delphi.NET 将 Delphi 逻辑移动到基于 Web 的过程可能很简单，但是使用 Mac 或 iPhone 的 delphi 代码......更难。可能您将不得不从头开始重写它，最有可能是在 Java 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-12T02:54:13.850

感谢那。我已经按照这些思路进行了思考。是的，我正在考虑放弃基于 Web 的 Delphi，而从头开始使用基于 Web 的，因为我听说过 Java 的强大功能。尽管我唯一的限制是整个 Delphi (windows) 应用程序将被浪费，尤其是现在它在某些功能上得到了增强。Delphi中没有一些代码可以为Java抢救吗？

# algorithm - sed优化（基于较小数据集的大文件修改）

> ID：848914
> 
> 赞同：8
> 
> 时间：2009-05-11T16:27:29.647
> 
> 标签：algorithm, perl, awk, sed, large-files

我确实必须处理非常大的纯文本文件（超过 10 GB，是的，我知道这取决于我们应该称之为大的），而且行很长。

我最近的任务涉及基于另一个文件中的数据进行一些行编辑。

数据文件（应该修改）包含 1500000 行，每行例如 800 个字符长。每一行都是唯一的，并且只包含一个身份号码，每个身份号码都是唯一的）

修改文件是例如1800 行长，包含一个身份号码，以及一个应该在数据文件中修改的数量和日期。

我刚刚将修饰符文件（使用 Vim 正则表达式）转换为 sed，但效率非常低。

假设我在数据文件中有这样一行：

```
(some 500 character)id_number(some 300 character) 
```

我需要修改 300 字符部分中的数据。

基于修饰符文件，我想出了这样的 sed 行：

```
/id_number/ s/^\(.\{650\}\).\{20\}/\1CHANGED_AMOUNT_AND_DATA/ 
```

所以我有1800行这样的。

但我知道，即使在非常快的服务器上，如果我执行

```
sed -i.bak -f modifier.sed data.file 
```

它非常慢，因为它必须读取每个模式 x 每一行。

没有更好的方法吗？

**注意：**我不是程序员，从未（在学校）学习过算法。我可以在服务器上使用 awk、sed、perl 的过时版本。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T17:17:41.390

我建议的方法（按理想的顺序）是将这些数据处理为：

1.  一个数据库（即使是一个简单的基于 SQLite 的带有索引的数据库在 10GB 文件上的性能也比 sed/awk 好得多）
2.  包含固定记录长度的平面文件
3.  包含可变记录长度的平面文件

使用数据库可以处理所有减慢文本文件处理速度的小细节（查找您关心的记录、修改数据、将其存储回数据库）。看看 Perl 的 DBD::SQLite。

如果您想坚持使用平面文件，您需要在大文件旁边手动维护一个索引，以便您可以更轻松地查找需要操作的记录编号。或者，更好的是，也许您的 ID 号*就是*您的记录号？

如果您有可变记录长度，我建议转换为固定记录长度（因为它似乎只有您的 ID 是可变长度）。如果你不能这样做，也许任何现有数据都不会在文件中移动？然后您可以维护前面提到的索引并根据需要添加新条目，不同之处在于您现在指向文件中的绝对位置，而不是指向记录号的索引。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T17:05:08.680

我建议您使用 Perl 编写的程序（因为我不是 sed/awk 专家，而且我不知道他们完全有能力）。

您的“算法”很简单：首先，您需要构建一个哈希图，它可以为您提供新的数据字符串以应用于每个 ID。这当然是通过读取修改文件来实现的。

填充此 hasmap 后，您可以浏览数据文件的每一行，读取行中间的 ID，然后生成新行，如上所述。

我也不是 Perl 大师，但我认为程序很简单。如果您需要帮助来编写它，请请求它:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T17:18:58.547

对于 perl，您应该使用 substr 来获取 id_number，尤其是在 id_number 具有恒定宽度的情况下。

```
my $id_number=substr($str, 500, id_number_length); 
```

之后，如果 $id_number 在范围内，则应使用 substr 替换剩余文本。

```
substr($str, -300,300, $new_text); 
```

Perl 的正则表达式非常快，但在这种情况下不是。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-16T22:29:35.067

我的建议是，不要使用数据库。在此类任务中，编写良好的 perl 脚本将在数量级上胜过数据库。相信我，我有很多实践经验。当 perl 完成时，您不会将数据导入数据库。

当你用 800 个字符写 1500000 行时，对我来说似乎是 1.2GB。如果您的磁盘速度非常慢（30MB/s），您将在 40 秒内读取它。更好的 50 -> 24s，100 -> 12s 等等。但是 2GHz CPU 上的 perl 哈希查找（如 db join）速度高于 5Mlookups/s。这意味着您的 CPU 绑定工作将在几秒钟内完成，而您的 IO 绑定工作将在几十秒内完成。如果真的是 10GB，数字会改变，但比例是一样的。

您尚未指定数据修改是否更改大小（如果可以就地进行修改），因此我们不会假设它并将用作过滤器。您尚未指定“修改文件”的格式和修改类型。假设它由选项卡分隔，例如：

```
<id><tab><position_after_id><tab><amount><tab><data> 
```

我们将从标准输入读取数据并写入标准输出，脚本可以是这样的：

```
my $modifier_filename = 'modifier_file.txt';

open my $mf, '<', $modifier_filename or die "Can't open '$modifier_filename': $!";
my %modifications;
while (<$mf>) {
   chomp;
   my ($id, $position, $amount, $data) = split /\t/;
   $modifications{$id} = [$position, $amount, $data];
}
close $mf;

# make matching regexp (use quotemeta to prevent regexp meaningful characters)
my $id_regexp = join '|', map quotemeta, keys %modifications;
$id_regexp = qr/($id_regexp)/;     # compile regexp

while (<>) {
  next unless m/$id_regexp/;
  next unless $modifications{$1};
  my ($position, $amount, $data) = @{$modifications{$1}};
  substr $_, $+[1] + $position, $amount, $data;
}
continue { print } 
```

在我的笔记本电脑上，150 万行、1800 个查找 ID、1.2GB 数据大约需要半分钟。对于 10GB，它不应超过 5 分钟。它对你来说合理吗？

如果您开始认为您不受 IO 限制（例如，如果使用一些 NAS）但受 CPU 限制，您可以牺牲一些可读性并将其更改为：

```
my $mod;
while (<>) {
  next unless m/$id_regexp/;
  $mod = $modifications{$1};
  next unless $mod;
  substr $_, $+[1] + $mod->[0], $mod->[1], $mod->[2];
}
continue { print } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T12:52:41.860

[正如MikeyB 建议](https://stackoverflow.com/questions/848914/sed-optimization-question-large-file-modification-based-on-smaller-dataset/849094#849094)的那样，您几乎肯定应该使用数据库。

如果您出于某种原因不想使用数据库，那么如果修改列表适合内存（因为它目前将在 1800 行），最有效的方法是填充[yves Baumes](https://stackoverflow.com/users/83331/yves-baumes)建议的修改的哈希表.

如果你到了连修改列表都变得很大的地步，你需要按它们的 ID 对两个文件进行排序，然后执行**列表合并**——基本上：

1.  将输入文件“顶部”的 ID 与修改文件“顶部”的 ID 进行比较
2.  如果匹配，相应地调整记录
3.  把它写出来
4.  丢弃具有（按字母顺序或数字顺序）最低 ID 的文件中的“顶部”行，并从该文件中读取另一行
5.  转到 1。

在幕后，如果您使用单个 SQL`UPDATE`命令执行此更改，数据库几乎肯定会使用列表合并。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T19:04:46.027

对 sqlloader 或 datadump 的决定很好。这就是要走的路。

# javascript - JavaScript 到 Flash 和返回？

> ID：848919
> 
> 赞同：0
> 
> 时间：2009-05-11T16:28:44.013
> 
> 标签：javascript, flash

我对闪光灯完全陌生。我们需要从用户系统加载一个二进制文件（必须在 Flash 9 中工作）并在 Flash 中进行一些处理并将其保存回文件系统。我认为这必须通过在 JavaScript 中获取文件然后对其进行编码将其发送到 Flash 来完成。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T16:36:51.767

本地文件系统访问在具有[文件参考](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/FileReference.html)增强功能的[Flash 10中。](http://www.adobe.com/products/flashplayer/features/)如果以 Flash 9 为目标，那你就不走运了。

Javascript 也无法访问本地文件系统。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T16:33:45.050

[http://weblogs.macromedia.com/flashjavascript/](http://weblogs.macromedia.com/flashjavascript/)
[http://kb2.adobe.com/cps/156/tn_15683.html](http://kb2.adobe.com/cps/156/tn_15683.html)

这是两个很好的链接，可以保护 javascript 通信

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T01:18:24.800

或者，您可以制作一个 JavaScript Flash 文件并制作一个具有完整文件访问权限的窗口 SWF。但是，这永远不能在网络上使用

# c# - 如何触发已经运行的基于 .net 的 Windows 应用程序？

> ID：848923
> 
> 赞同：4
> 
> 时间：2009-05-11T16:30:22.933
> 
> 标签：c#, .net, windows, winforms

我有一个在内存中运行的基于 .net 的 Windows 应用程序。我想从不基于 .net 的外部应用程序触发应用程序中的一项功能。我怎样才能做到这一点？触发应该是实时的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T16:39:33.137

让第一个应用程序侦听 TCP 端口。使第二个应用程序连接到 TCP 端口并发送“WAKE UP LAZY PROGRAM”。通过做某事让第一个应用程序对此做出响应。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T16:37:17.197

使用套接字将起作用。命名管道也可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T16:45:12.067

如果程序不是 .net，我建议发送或设置窗口消息：请参阅`PostMessage`和.net `RegisterWindowMessage`。要在 .net 程序中接收这样的消息，我认为您可能需要 PInvoke`RegisterWndowMessage`并覆盖您的`WndProc`.

另一个很好的可能性是共享一个命名的互斥锁。

您应该定义“实时”的含义：一方面，在 Windows 上没有什么是实时的，另一方面，当您开始退缩并说“几乎实时”或“软实时”时时间”然后许多解决方案成为可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:43:57.527

您不能将 XML 消息字符串发送到正在从非 .net 应用程序侦听特定端口的 .net 应用程序。通过分析此 XML 消息，您可以调用 .net 应用程序中的特定函数。

一个疯狂的猜测。

感谢 123 开发者

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T16:57:37.693

**消息传递**可能是要走的路。使用套接字也可以，但是

a) 可能会造成安全漏洞，并且

b) 可能是某些机器上的防火墙软件的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T16:57:39.707

CodeProject 有一个使用 .NET Remoting / IPC 的示例：

> [**单实例应用程序，传递命令行参数**](http://www.codeproject.com/KB/threads/SingletonApp.aspx)

# active-directory - Active Directory 中用户的 LastLogonTimeStamp 值不正确

> ID：848935
> 
> 赞同：3
> 
> 时间：2009-05-11T16:32:59.013
> 
> 标签：active-directory

我在 Active Directory 中使用用户的 LastLogonTimeStamp 属性来获取上次登录日期时间，值不一致，

还有其他人面临同样的问题吗？

我们可以信任 LastLogonTimeStamp 吗？

更新：它只是一个域控制器

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T16:28:11.640

[http://www.microsoft.com/technet/scriptcenter/topics/win2003/lastlogon.mspx](http://www.microsoft.com/technet/scriptcenter/topics/win2003/lastlogon.mspx)

如果您有很多域控制器并且不需要最准确的结果，您只会使用 lastLogonTimeStamp。对于单个域控制器，请使用 lastLogon 属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-14T20:03:16.350

设计的 LastLogonTimeStamp 仅在用户登录并且当前值介于 9 到 14 天之间时才会更新。他们这样做是为了减少 AD 中的复制流量。

这篇[博文](http://blogs.technet.com/b/askds/archive/2009/04/15/the-lastlogontimestamp-attribute-what-it-was-designed-for-and-how-it-works.aspx)说得很好：

> 请务必注意，lastLogontimeStamp 属性的预期用途是帮助识别非活动计算机和用户帐户。lastLogon 属性并非旨在提供实时登录信息。使用默认设置，lastLogontimeStamp 将比当前日期晚 9-14 天。

如果您想要用户真正的上次登录信息，您必须从域中的每个域控制器中提取 lastLogon 属性并使用最新的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T18:14:43.340

您的网络是否包含多个 DC（域控制器）？它们可能不同步，因为 LastLogonTimeStamp 将在用户实际登录的 DC 上更新，并且同步可能需要一些时间。

马克

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-12T12:30:18.147

如果您计划拥有多个 DC，那么 LastLogonTimeStamp 可能不是一种可靠的方法来确定帐户是否已经“过时”，因为在许多（大多数？）场景中，该属性不会复制到其他 DC，取决于您的域功能级别。

确定这一点的更好方法是查看“密码年龄”（通过 PasswordLastChanged 属性）。例如，如果有人在密码过期后一两周（或其他时间跨度，具体取决于您的特定环境）没有重置密码，那么您很有可能在那里有一个孤立的帐户。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-26T07:06:30.657

您无法通过 lastlogon 或 lastlogontimestamp 直接获得用户的**True LastLogon时间。您需要做一些自定义工作才能获得最新的登录时间。**

通过**最后登录**

您需要从所有域控制器查询 lastlogon 值并比较所有值，然后将最高登录时间作为 True Last Logon

通过**LastLogonTimeStamp**

由于它是您只能从一个 DC 查询的可复制属性，但它不会给出准确的结果，因此它的精度约为 14 天，具体取决于属性**msDS-LogonTimeSyncInterval**。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-05T14:45:21.933

> 如果您想要用户真正的上次登录信息，您必须从域中的每个域控制器中提取 lastLogon 属性并使用最新的值。

不幸的是，这并不完全准确。我使用了 lastlogon 属性，虽然它对于我测试过的大多数用户帐户来说都相当接近，但我遇到了许多返回 1600 年的日期，而那些接近的显示有时我肯定知道指定的用户甚至无法登录，例如当我知道我在上午 8:15 登录时，我自己的 LastLogon 在上午 7:50 显示。

许多管理员有时似乎希望使用此信息来验证是否符合公司政策。不幸的是，微软似乎在设计上出于系统功能目的而忽视了这种意图。

# emacs - 如何在 Windows 上的 Emacs 中保留剪贴板内容？

> ID：848936
> 
> 赞同：16
> 
> 时间：2009-05-11T16:33:02.867
> 
> 标签：emacs, elisp

这是我遇到过几次的场景：

我从其他程序中复制了一些文本。转到 Emacs 并在我粘贴/拉入文本之前进行了一些编辑。Cy 拉出并瞧……不是我打算粘贴的文本。然后我意识到，当我四处移动时，我使用了诸如 kill- 之类的命令line 和 back-kill-word，那些被杀死的行和单词现在占据了 kill-ring。但是输入 My 并没有带回原来复制的文本，所以我需要回到我原来的程序再次复制文本。更糟糕的是，如果原始程序被关闭，那么我完全丢失了复制的文本。

杀戮线等是这样的基本命令（几乎就像按下删除键），虽然我不介意使用这些命令使杀戮环有点混乱，但我希望我的原始文本留在某处kill-ring 以便我最终可以通过键入 My 几次来找到它。在覆盖剪贴板内容之前，如何使 Emacs 自动将当前剪贴板内容保存到 kill-ring 中？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-11T20:32:05.893

每当您在 Emacs 中执行 kill 操作时，此代码应自动将选择（从 Emacs 外部）放到 kill-ring 上。它已经在 Linux 上进行了测试，但不应仅限于 Linux。

```
(defadvice kill-new (before kill-new-push-xselection-on-kill-ring activate)
  "Before putting new kill onto the kill-ring, add the clipboard/external selection to the kill ring"
  (let ((have-paste (and interprogram-paste-function
                         (funcall interprogram-paste-function))))
    (when have-paste (push have-paste kill-ring)))) 
```

[如果您发现自己经常这样做，查看包browse-kill-ring](http://www.emacswiki.org/emacs/BrowseKillRing)可能会很有用，它可以让您很好地了解 kill ring（而不是重复键入`M-y`）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-10T07:48:17.757

请注意，最新的 Emacs CVS 版本具有变量 save-interprogram-paste-before-kill ，这正是来自[etc/NEWS](http://git.savannah.gnu.org/cgit/emacs.git/tree/etc/NEWS)文件的 cf:

> ** 当`save-interprogram-paste-before-kill' is non-nil, emacs will not clobber the the interprogram paste when something is killed in it by saving the former in the`kill-ring' 在后者之前。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T16:40:34.040

我认为问题在于，当您从 emacs 外部的剪贴板中拉出时，您并没有保存到 kill ring 中。

您需要的是使用函数剪贴板-yank 插入区域，然后以某种方式选择它并将其保存到终止环，就像函数 kill-ring-save 一样。

或者甚至更好地编写一个函数clipboard-save-to-kill-ring-and-yank，它将剪贴板保存到kill ring，然后猛拉它。

编辑：稍微跟踪一下代码，这就是你想要的；你可以把它挂在钥匙上。它将windows剪贴板内容保存到kill ring。

```
(defun clipboard-to-kill-ring()
  "save the external clipboard contents to the kill ring"
  (interactive)
    (let ((clip (funcall interprogram-paste-function)))
      (when clip
        (kill-new clip)))

(defadvice yank (before maybe-copy-windows-clipboard (arg))
    (clipboard-to-kill-ring))

(ad-activate 'yank) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:42:11.837

我猜您可以破解各种 kill 命令以不将文本放入剪贴板，然后将剪贴板拉动绑定到不同的键，不知道这是否可行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T18:11:30.130

当我在完成复制或剪切另一个 Windows 应用程序后弹出到 emacs 时，我只是通过猛拉文本然后重新杀死它来解决这个问题。

更好的方法是破解 emacs，这样当你杀死某些东西时，它会将现有剪贴板与 kill ring 中的最顶部条目进行比较，如果不同，它将剪贴板内容推送到 kill ring，然后再执行你明确请求的 kill .

# c# - 如何将索引像素格式图像转换为 32 位图像？

> ID：848943
> 
> 赞同：2
> 
> 时间：2009-05-11T16:34:10.650
> 
> 标签：c#, .net, image, indexed-image

我有一个图像，我得到并尝试使用 Graphics.FromImage(image) 加载到图形对象中，但是如果图像具有索引像素格式，则会引发异常。

有没有办法安全地转换索引图像？

**更新：**感谢乔的提示，只是将旧图像绘制在新图像上，而不是我试图转换它。这很有意义。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T16:38:37.070

一种简单的方法是创建一个相同大小的新图像（采用 32 位像素格式）。*然后为该*图像创建一个图形对象并在其上绘制原件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-23T16:11:12.747

您可以做的是基于您可以计算 3 通道颜色空间中的欧几里得距离的索引。然后找到最接近的颜色并将这些值用于新图像。

# wpf - 是否可以将 WPF Combobox.SelectedValue 绑定到多个 ObjectDataProviders？

> ID：848946
> 
> 赞同：2
> 
> 时间：2009-05-11T16:35:17.713
> 
> 标签：wpf, wcf, data-binding, objectdataprovider

尝试确定是否可以使用 XAMAL 绑定将 ComboBox 的 SelectedValue 绑定到多个 ObjectDataProviders 的输入。

我查看了 MultiBinding ，但这似乎是将多个控件组合在一起，而不是我今天所期待的。

我希望能够让 ComboBox（位置）更改它所做的 TextBlock（偏差）并调用 ObjectDataProvider（CommentProvider）来更新 TextBox（locationComments）。

这在代码隐藏中相当简单，但不希望将这条路线作为学习经验。

XAMAL 代码

```
<Window.Resources>
    <ObjectDataProvider x:Key="LocationProvider"
        ObjectType="{x:Type srv:ServiceClient}"
        IsAsynchronous="True"MethodName="GetAssignedLocations" />
    <ObjectDataProvider
        x:Key="DevianceProvider"
        ObjectType="{x:Type srv:ServiceClient}"
        IsAsynchronous="True" MethodName="GetPercentChange">
        <ObjectDataProvider.MethodParameters>
            <system:String>Location1</system:String>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
    <ObjectDataProvider
        x:Key="CommentProvider"
        ObjectType="{x:Type srv:ServiceClient}"
        IsAsynchronous="True"
        MethodName="GetCommentByBusinessUnit">
        <ObjectDataProvider.MethodParameters>
            <system:String>Location1</system:String>
        </ObjectDataProvider.MethodParameters>
    </ObjectDataProvider>
</Window.Resources>

<ComboBox Height="23" HorizontalAlignment="Left" Margin="12,12,0,0" Name="locations"  VerticalAlignment="Top" ItemsSource="{Binding Source={StaticResource LocationProvider}}"
              DisplayMemberPath="BuName" SelectedValuePath="BuKey"
              SelectionChanged="locations_SelectionChanged">
        <ComboBox.SelectedValue>
            <Binding Source="{StaticResource DevianceProvider}"
             Path="MethodParameters[0]"   
                 BindsDirectlyToSource="True" 
                 Mode="OneWayToSource" />
        </ComboBox.SelectedValue>
<TextBlock Name="deviance" Height="23" Margin="0,0,645,17" Width="40" Text="{Binding Source={StaticResource DevianceProvider}}" IsEnabled="False" />

<TextBox Height="23" Margin="0,0,181,17" Name="locationComments" Width="350" /> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T21:55:29.703

您在 MultiBinding 的正确轨道上。关键是将 MultiValueCoverter 与 MultiBinding 结合使用。

```
<MultiBinding Converter="{StaticResource Coverter_LocationMultiConverter}"
              Mode="OneWayToSource">
                <Binding Source="{StaticResource DevianceProvider}"
                         Path="MethodParameters[0]"
                         BindsDirectlyToSource="True"
                         Mode="OneWayToSource" />
                <Binding Source="{StaticResource CommentProvider}"
                         Path="MethodParameters[0]"
                         BindsDirectlyToSource="True"
                         Mode="OneWayToSource" />
            </MultiBinding> 
```

之前我们只绑定一个东西，现在我们将它绑定到两个 ObjectDataProviders。让我们这样做的关键因素是转换器：

```
public class LocationMultiCoverter : IMultiValueConverter
{
    #region IMultiValueConverter Members

    public object Convert(object[] values, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    public object[] ConvertBack(object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
    {
        return new object[] { value, value };
    }

    #endregion
} 
```

因为我们只需要在两个地方使用相同的值，所以 CovertBack 方法非常简单，但是我相信您可以看到它可以用来解析一些复杂的东西并将不同的组件传递回 UI 中的不同位置。

使用这个转换器，我们还可以尝试一个小示例，使用两个文本框来代替：

```
<Window x:Class="Sample.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:Sample"
    Title="Window1"
    Height="300"
    Width="300">
<Window.Resources>
    <local:LocationMultiCoverter x:Key="Coverter_LocationMultiConverter" />
</Window.Resources>
<Grid>
    <StackPanel>
        <TextBlock x:Name="uiDeviance" />
        <TextBlock x:Name="uiComment" />
        <ComboBox x:Name="uiLocations"
                  Height="23"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Top"
                  SelectedValuePath="Content">
            <ComboBoxItem>1</ComboBoxItem>
            <ComboBoxItem>2</ComboBoxItem>
            <ComboBoxItem>3</ComboBoxItem>
            <ComboBoxItem>4</ComboBoxItem>
            <ComboBoxItem>5</ComboBoxItem>
            <ComboBox.SelectedValue>
                <MultiBinding Converter="{StaticResource Coverter_LocationMultiConverter}"
                              Mode="OneWayToSource">
                    <Binding ElementName="uiDeviance"
                             Path="Text"
                             BindsDirectlyToSource="True" />
                    <Binding ElementName="uiComment"
                             Path="Text"
                             BindsDirectlyToSource="True" />
                </MultiBinding>
            </ComboBox.SelectedValue>
        </ComboBox>
    </StackPanel>
</Grid> 
```

（我的示例中的转换器作为一个单独的类存在于 Window 的代码后面）并且正如您所看到的测试它会在 SelectedValue 更改时更新两个 TextBox。

# maven-2 - 如何让 Maven 将战争常见的所有罐子放在同一个 EAR 到 EAR 根目录中？

> ID：848947
> 
> 赞同：24
> 
> 时间：2009-05-11T16:35:30.163
> 
> 标签：maven-2, dependencies, package, war, ear

我们有无数次战争的解决方案。战争在它们都使用hibernate和spring的意义上是相似的。这意味着我们在每场战争中都有许多相同的罐子。这正在成为一个问题，因为耳朵的大小开始变得不成比例。

我想使用 Maven 来计算依赖关系，并将多个战争共有的所有 jar 放到 EAR 的根目录中。

我尝试使用 j2ee 原型（maven-archetype-j2ee-simple）组织我的项目，但所有战争仍然与 WEB-INF/lib 中的依赖项打包在一起。有没有办法让 Maven 计算公共依赖关系并将它们放置到 EAR 中，就像他在构建战争或 jar 时能够计算所有过渡依赖关系一样？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2013-03-05T17:14:30.750

正如您在评论中提到的，计算每个依赖项是 Maven 的任务。当您创建具有每个常见依赖项的工件时，您还必须猜测哪些依赖项属于那里。

也有可能，你必须部署一场战争，它依赖于另一台没有耳朵的机器，当你将每个战争依赖项设置为提供时，你又被卡住了。

获得瘦身战争的唯一正确方法是来自示例： [http ://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html](http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html)

但是，现在有趣的部分来了，有一个大的！快捷方式（完全消除了上述痛苦），告诉 maven，您的 WAR 具有哪些依赖项。

进入您的 EAR 模块，为每个 WAR 依赖项声明一个对 WAR 类型为 pom 的第二个依赖项。

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
<modelVersion>4.0.0</modelVersion>
<parent>
    <groupId>com.foo</groupId>
    <artifactId>skinny</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</parent>
<artifactId>ear</artifactId>
<packaging>ear</packaging>
<dependencies>
    <dependency>
        <groupId>com.foo</groupId>
        <artifactId>war</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <type>war</type>
    </dependency>
    <dependency>
        <groupId>com.foo</groupId>
        <artifactId>war</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <type>pom</type>
    </dependency>
</dependencies>
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-ear-plugin</artifactId>
            <version>2.8</version>
            <configuration>
                <skinnyWars>true</skinnyWars>
                <defaultLibBundleDir>lib</defaultLibBundleDir>
                <modules>
                    <webModule>
                        <groupId>com.foo</groupId>
                        <artifactId>war</artifactId>
                    </webModule>
                </modules>
            </configuration>
        </plugin>
    </plugins>
</build> 
```

现在，每个 WAR 都将使用它自己的依赖项独立打包，EAR 将与瘦 WAR 和 lib 文件夹中的每个依赖项一起打包

**更新：**

请记住，ear/lib 文件夹不能用于像 JBoss EAP 6 这样的严格容器中的每个依赖 jar。像 tomahawk、primefaces 等 JSF 组件库必须驻留在 WEB-INF/lib 文件夹中。

使用上述解决方案实现此目的的一种便捷方法是在 EARs pom.xml 中排除组件库，如下所示：

```
...
<dependencies>
    <dependency>
        <groupId>com.foo</groupId>
        <artifactId>war</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <type>war</type>
    </dependency>
    <dependency>
        <groupId>com.foo</groupId>
        <artifactId>war</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <type>pom</type>
        <exclusions>
            <exclusion>
                <groupId>org.primefaces</groupId>
                <artifactId>primefaces</artifactId>
            <exclusion>
        </exclusions>
    </dependency>
</dependencies>
... 
```

现在 WAR 的所有依赖项都将放在 ear/lib 中，除了将放在 WAR 内的 WEB-INF/lib 中的组件库

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-18T13:54:26.723

创建一个名为 commons-jars 的新工件并将其打包为 pom。它应该取决于您使用的所有常见 jar - Spring、Hibernate、Log4j 等。

然后，在你的每场战争中，将其添加为具有“已提供”范围的依赖项（并且不要忘记将类型设置为 pom）。您将能够在您的类路径中看到它，但它们不会被打包到战争中。通过这种方式，您还可以将特定于战争的依赖项打包到其中，而[Skinny Wars](http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html)的解决方案不提供这些依赖项。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T18:56:11.853

您可以将[依赖项范围](http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html)设置为“提供”。这意味着它们将由其他模块提供，不会包含在最终的 jar 或 war 中。

在打包最终的 EAR 并将常用的 jar 放在那里时，也许[组装插件可以帮助您。](http://maven.apache.org/plugins/maven-assembly-plugin/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-05T21:48:57.257

[http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html](http://maven.apache.org/plugins/maven-war-plugin/examples/skinny-wars.html)

# mocking - 模拟框架模拟各种物理设备的相关性和好处

> ID：848949
> 
> 赞同：1
> 
> 时间：2009-05-11T16:36:21.690
> 
> 标签：mocking, testing

模拟框架对于使用多个物理设备并模拟它们是一个好主意吗？

我公司的主要目标是将我们的软件与多个品牌的影院投影仪（巴可、索尼……）、声音处理器、IO 控制器（barionet、wago）连接起来。

有时供应商会提供用于通信的 API，有时它是通过套接字完成的，有时它确实是“特定于供应商的”

到目前为止，这是我们的方法：

*   - 如果这很容易：写一个虚拟的“devicexxxMock”类，听命令，每个问题都回答“是”*   - 使用空灵或大力神*   - 如果真的需要：编写模拟器（与第一种方法相同，但回答是或否，取决于我们要测试的内容）

我们正在寻找一种一致的方法来测试我们的代码，而不需要真实的设备。并且不会浪费时间编写模拟器。

编辑：我们与 4 种类型的设备交谈：

*   我们必须与之交谈的大多数设备都以套接字中的字节数组形式回答。*   一些使用[SNMP](http://en.wikipedia.org/wiki/Simple_Network_Management_Protocol)*   有些启用了 HTTP ( [http://ip/commandToExecute](http://ip/commandToExecute) )*   有些有Java API

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T17:13:40.850

哎呀。我认为这是一个模拟框架的完美场所。只需创建一个接口层，将硬件（或硬件 api）与控制它的代码分开...... IProjector、ISoundProcessor 等。

一旦您将硬件与软件分离并且您不直接依赖于硬件，您就可以使用模拟框架编写模拟或存根，假装 IProjector 是真正的硬件。如果您知道 HardwareX 使用特定值响应某个方法，请捕获它并使用您的模拟框架返回它。

请注意，mock 框架本身并不是必需的。你总是可以像你建议的那样创建一个假货，但有时这个假货变得太复杂了，因为它们被太多的测试使用了，而且你的假货会出现错误。在这种情况下，模拟框架就会出现，您可以只定义您在特定测试中需要的行为......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T20:26:52.140

As Brian Genisio suggests this sounds like a perfect candidate for mocks, and his arguments for mocks versus fakes are very compelling. I haven't used mocks to test interactions with hardware but I have used them to test interfacing with 3rd party native APIs provided by vendors, which is a very similar use case. The general pattern is: - have an interface which vends out an object representing the input produced by the native API (or hardware device in your case) - mock it to produce the input you require for your test case - assert that your code handles this input in the right way

That way you can test your functionality without having to use the actual hardware (or vendor api, or other code, etc. etc.). Mock objects aren't just applicable to testing interactions with hardware or 3rd party apis - they can be used for all sorts of testing. Once you start using mocks, you'll wonder how you wrote code without using them.

I code in Java, using JUnit for my testing framework and have used EasyMock ([http://easymock.org](http://easymock.org)) and JMock ([http://www.jmock.org](http://www.jmock.org)). I prefer (and currently use) JMock, but it's worth trying both as their philosophies are rather different. I've also heard that Mockito ([http://mockito.org](http://mockito.org)) is very good, but haven't really used it in anger.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T16:46:41.877

将“是”替换为`self.Responder.Next()`。将一个类实例（取决于您的语言）`Responder`传递给您的嘲笑者的构造函数。`Next`is的简单实现，`return "yes";`但您也可以让它返回其他内容，具体取决于它的构造方式。这种技术的实际细节将根据 mocker 所用的语言而有所不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:56:08.583

不要模拟设备。我曾经嘲笑过我的烤面包机，它试图让我的房子着火。不值得冒险，伙计。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T12:56:33.240

A company called Atomic Object has some nice reports about their using Mock Objects in C when working with embedded devices. See the papers at [http://www.atomicobject.com/pages/Papers](http://www.atomicobject.com/pages/Papers)

# java - 一般回报

> ID：848953
> 
> 赞同：1
> 
> 时间：2009-05-11T16:37:49.893
> 
> 标签：java, generics, polymorphism, return

有一个**不可变**的类：

```
Scope<Cmp extends Comparable<Cmp>>
public Scope<Cmp> crop(Scope<Cmp> scope) {
    ...
    return new Scope<Cmp>(starts, ends);
} 
```

它有**许多**类似的方法被扩展：

```
Timerange extends Scope<Date> 
```

和**许多**其他人（也是不可变的）。

我希望他们返回其类型的对象。例如：

```
timerange.crop(scope) 
```

应该返回 Timerange 对象，而不是 Scope。

我是否必须覆盖每种方法（或使用反射）？还有另一种方法吗？

在此先感谢，埃塔姆。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T16:47:52.593

你需要某种工厂。在这种情况下，工厂方法可以正常工作。

```
public abstract class Scope<E extends Comparable<E>> {
    abstract Scope<E> create(E start, E end);

    public Scope<E> crop(Scope<E> scope) {
        ...
        return create(starts, ends);
    }
}
public TimeRange extends Scope<Date> {
    Scope<Date> create(Date start, Date end) {
        return new TimeRange (...);
    }
} 
```

您可能希望向基类添加一个通用的“this”参数：

```
public abstract class Scope<THIS extends Scope<THIS, E>, E extend Comparable<E>> {
    abstract THIS create(E start, E end);

    public THIS crop(Scope<E> scope) {
        ...
        return create(starts, ends);
    }
}
public TimeRange extends Scope<TimeRange,Date> {
    TimeRange create(Date start, Date end) {
        return new TimeRange (...);
    }
} 
```

这确实为客户端代码增加了额外的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T16:42:32.757

Java 没有自类型返回，因此您通常需要手动覆盖每个方法。请参阅[我关于“自我类型”](http://blog.joda.org/2007/08/java-7-self-types_1953.html)的博客，以讨论一些可能的替代方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-11T16:47:07.960

您可以尝试以下方法：

```
class Scope<Cpm extends Comparable<Cpm>, Derived extends Scope<Cpm, Derived>> {
  public Derived crop(Scope<Cmp, Derived> scope)
} 
```

TimeRange 将被定义为

```
class TimeRange extends Scope<Date, Timerange> 
```

所以`crop`会返回一个 TimeRange 对象。当派生类未定义时，可以使用通用通配符 ( `Scope<Date, ?>`)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T16:59:05.287

你真的需要`Timerange`吗？它提供的不仅仅是`Scope<Date>`什么吗？如果没有，那么只需使用`Scope<Date>`.

另一个建议是，您可以克隆对象，然后为新对象适当地修改字段，而不是使用构造函数来实例化它。原因是克隆的对象与原始对象的类型相同。

```
Scope<Cmp extends Comparable<Cmp>> implements Cloneable
public Scope<Cmp> crop(Scope<Cmp> scope) {
    ...
    Scope<Cmp> result = (Scope<Cmp>)super.clone();
    result.init(starts, ends); // sets the fields for a cloned object
                               // init() could be private
    return result;
} 
```

# sql-server - 创建 SQL Server 2008 附加组件：当前等效于 sqlwb.exe

> ID：848956
> 
> 赞同：0
> 
> 时间：2009-05-11T16:38:15.370
> 
> 标签：sql-server, sql-server-2008, add-in, add-on

我正在尝试为 SQL Server 2008 创建一个简单的附加组件；它只是将参数从 SQL 2008 传递到控制台应用程序。

尽管没有特别支持附加组件，但根据这些文章（[1](http://sqlblogcasts.com/blogs/jonsayce/archive/2008/01/15/building-a-sql-server-management-studio-addin.aspx)、[2](http://jcooney.net/archive/2007/11/26/55358.aspx)），2005 年是可能的，我假设也是 2008 年。但是，我几乎在第一个障碍中落下；我似乎无法在预期的位置找到 SQLWB.EXE (SQL WorkBench)。我假设该文件已在 2008 年被替换，但我似乎无法确定等效版本。

有没有人开发 2008 附加组件的一般经验？有什么好的资源吗？

谁能指出 2008 年 SQLWB.EXE 的替代品？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-11T16:47:40.813

Sql Server Management Studio：C:\Program Files\Microsoft SQL Server\100\Tools\Binn\VSShell\Common7\IDE\Ssms.exe

# php - 将 TIBCO 通用接口与 PHP 一起使用，这可行吗？

> ID：848964
> 
> 赞同：0
> 
> 时间：2009-05-11T16:39:58.487
> 
> 标签：php, cakephp, tibco-gi

我可以将 TIBCO 通用接口与 PHP 一起使用吗？或者更好，使用 CakePHP？如果可能，我该怎么做？也许网络上有一些文档？（我搜索但我没有找到任何东西）。谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-18T01:46:33.457

是的，PHP 应用程序可以生成 GI 使用的所有数据格式，例如原始 XML、JSON 或 SOAP。

看看这里：[http](http://uk.php.net/soap) ://uk.php.net/soap开始编写基于 PHP 的 Web 服务

# groovy - groovy 静态类

> ID：848971
> 
> 赞同：4
> 
> 时间：2009-05-11T16:42:07.907
> 
> 标签：groovy

这个文件sample.groovy中的“静态”有什么作用？

```
static class froob {
} 
```

groovy 代码无论是否使用“静态”都可以很好地编译。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T00:36:37.303

绝对没有区别。这种情况下的静态被忽略。

为了进行测试，我创建了一个 groovy 类并将“javap -verbose StaticTest”的输出通过管道传输到一个文件中。然后将“静态”放在类 def 之前并将其通过管道传输到第二个文件。然后我区分了这两个文件。唯一的区别是那些与为每个类生成新的长类 ID 相关联的唯一 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T16:55:12.253

您是指静态类还是静态类中的静态方法“main”？

关键字“静态”表示分配在程序开始时开始，在程序结束时结束。换句话说，没有办法以编程方式创建类“froob”的实例，而是在程序存在时自动创建一个实例，并将一直存在到程序结束。

在您的小示例程序的上下文中，它实际上是没有意义的。只有“主”类需要是静态的，因为它需要在程序中的任何代码执行之前“存在”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-11T18:37:23.830

在 Java 中，只有内部类可以是静态的。在 Groovy 1.7 之前，内部类是被禁止的，声明一个顶级类 static 没有效果。

在 Groovy 1.7+ 中，我希望静态内部类具有与 Java 中相同的语义。声明顶级类可能没有效果（或被编译器禁止）。

# svn - CollabNet SVN 服务器和 VisualSVN 服务器一样好吗？

> ID：848976
> 
> 赞同：5
> 
> 时间：2009-05-11T16:43:29.260
> 
> 标签：svn, visualsvn, visualsvn-server, collabnet

底格里斯河网站

[http://subversion.tigris.org/getting.html#windows](http://subversion.tigris.org/getting.html#windows)

有一个链接到另一个 svn 服务器，称为 CollabNet SVN 服务器。是否有人使用它并知道它比 VisualSVN 服务器更好或一样好？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-11T16:55:15.513

实际上，CollabNet 有 subversion 的原始源代码。从[Wikipedia](http://en.wikipedia.org/wiki/CollabNet)中查看：

> 2000 年，CollabNet 启动了开源项目 Subversion，这是一个拥有超过 500 万用户的版本控制系统。

VisualSVN 所做的是将其与一个小型 HTTP 服务器打包并添加一堆 UI 以使非高级用户更容易（他们做得很好）。在[更改日志](http://www.visualsvn.com/server/changes/)中记录了他们如何合并 -original- SVN 版本，目前为 1.6.1

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T16:48:55.913

我想说最大的区别是您必须手动配置 CollabNet 的服务器包，而 VisualSVN 带有一个不错的 UI，您可以在其中进行配置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:47:52.717

我们在我工作的地方使用 CollabNet 的服务器包（我在工作的地方引入了版本控制，到目前为止只有我的项目使用版本控制）。

基本上，它们是一样的。VisualSVN 带有一个自动插入到 windows 网络进行身份验证的模块。CollabNet 的 svn 服务器必须配置为通过 windows 进行身份验证。

由于我还没有完成配置步骤，我们通过 .htaccess 文件和 apache 的身份验证模块进行身份验证。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T16:48:38.627

CollabNet 运行良好，但它没有 VisualSVN 中包含的用于管理的可视化界面。

如果它们对您不重要，并且您习惯使用标准 SVN 命令行命令，那么 CollabNet 是一个不错的选择。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-26T17:08:48.210

CollabNet 发布了一个新的颠覆服务器软件：

[http://www.open.collab.net/go/csvne2_r2a/](http://www.open.collab.net/go/csvne2_r2a/)

我还没有尝试过，但我看起来这会轻松击败 VisualSVN 服务器......

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-09T14:20:12.407

另外，VisualSVN 不支持 svn:// 协议，我听说比 http/https:// 更快。如果我错了希望有人纠正我

# c# - 将调试器附加到 IIS 实例

> ID：848987
> 
> 赞同：90
> 
> 时间：2009-05-11T16:46:33.670
> 
> 标签：c#, asp.net, visual-studio-2005, debugging

我在 XP 机器上安装了 IIS 5.1 和 Visual Studio 2005。我该如何将调试器附加到 IIS 实例。

顺便说一句：我没有在正在运行的进程中看到 IIS 进程，或者我可能不知道要查找什么。

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2009-05-11T16:50:39.140

在 Visual Studio 中：

1.  单击菜单栏中的“调试”
2.  点击“附加到进程”
3.  选中左下角的“**显示所有用户的进程”复选框**
4.  从进程列表中选择**aspnet_wp.exe**、**w3p.exe**或**w3wp.exe**
5.  点击“附加”

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-04-16T09:04:37.827

只是为了澄清 Jimmie R. Houts 的回答……</p>

如果要调试 Web 应用程序 VS 和 IIS，可以执行以下操作：

1.  在 IIS 中托管站点（虚拟目录等）。
2.  然后在VS2005中这样做：

    *   右键单击 Web 项目 → 属性 → 开始选项 → 使用自定义服务器 → 基本 URL → 输入在 IIS 中托管的站点地址。
    *   点击`F5`，您将能够调试您的代码

同样适用于 VS 2008。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-10-17T20:45:05.993

我正在运行带有 IIS 7.5 版的 Windows 7，我还需要勾选“显示所有用户的进程”和“显示所有会话中的进程”框 - 在“附加到进程”对话框的底部。

我还把我的应用程序放在了一个特定的应用程序池中，这意味着你可以看到它被标记为 w3wp.exe。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-11T16:49:13.370

IIS 进程是 aspnet_wp.exe。

事实上，附加到 aspnet_wp.exe 进程是 VS 在您将项目设置为使用 IIS 进行调试时所做的事情。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-09-02T02:20:19.303

ASP.NET 进程的可能名称：

*   w3wp.exe 是 IIS 6.0 及更高版本。
*   aspnet_wp.exe 是早期版本的 IIS。
*   iisexpress.exe 是 IISExpress。
*   dotnet.exe 是 ASP.NET 核心。
*   inetinfo.exe 是在进程中运行的较旧的 ASP 应用程序。

From[查找 ASP.NET 进程的名称](https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-find-the-name-of-the-aspnet-process?view=vs-2019)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T18:45:36.270

您还需要从“控制面板”>“管理工具”打开 Internet 信息服务。右键单击有问题的网站，单击主目录选项卡，然后选择配置按钮。这将打开一个带有三个选项卡的新表单 - 单击调试选项卡并选择调试标志部分中的两个选项。这也是调试所必需的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-20T22:43:28.003

使用 Attach to IIS 插件（[VS2015](https://marketplace.visualstudio.com/items?itemName=kibria-bd.AttachtoIIS)、[VS2017](https://marketplace.visualstudio.com/items?itemName=smoksnes.MoksnesAttachToIIS)）插件可以节省一些点击次数 - 特别是在处理 IIS 托管站点的生态系统时（例如，一个前端具有多个后端服务）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-03-15T12:51:51.357

如果您看到正在运行的进程 [例如 IIS 工作进程 (w3wp.exe)] 是任务管理器，但不在 中的进程列表中`debug > attach to process`，您可能需要以管理员身份运行 Visual Studio。

# java - 获取客户订单：设置 getAllOrders() 与 Set 获取所有订单（）

> ID：848989
> 
> 赞同：3
> 
> 时间：2009-05-11T16:46:59.303
> 
> 标签：java, orm, dns

我没有做过太多的 Java 编程，因此很多未解决的 ORM 问题在我的脑海中盘旋，这对于更有经验的人来说似乎相当简单。

假设我们有两个类：Customer 和 Order。客户类实现了一个名为 listAllOrders 的方法，该方法的签名应该是什么？

1.  `Set<Order> getAllOrders();` // OOP 方式

2.  `Set<Integer> getAllOrders();` // 对 db 友好的方式，基于为每个订单分配一个唯一的 int id 的假设

3.  `int[] getAllOrders();` // db 友好的方式，优化

4.  `Set<OrderID> getAllOrders();` // OOP方式，优化

5.  其他？通过方法重载将上述组合？

我的想法是立即取消第三个选项，因为优化还为时过早，没有必要，而且可能会带来更多的麻烦而不是好处。

在第一个和第二个选项之间进行选择，主要论点似乎是在许多场景中返回一个订单集合而不是 id 将是一个矫枉过正。

第一个选项总是需要将订单预加载到内存中，尽管可以通过延迟加载来处理一些订单属性，但与一组裸 ID 相比，订单对象本身仍需要分配更多的内存。另一个原因似乎是延迟加载不会给我使用`final`修饰符来强制 Order 字段的不变性的优势。

但是，选项 2 并没有真正封装订单编号，即如果决定开始使用 String UUID 或 long 作为订单标识符而不是整数，则需要进行认真的重写。显然，这可以通过引入一个名为 OrderId 的新轻量级对象（第 4 种方法）来缓解。

好吧，在这一点上，我真的很感谢 ORM 和 Java 大师的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T16:52:47.187

知道来电者想要什么总是有帮助的。如果每次调用者都必须查找每个订单，则返回订单 ID 不是优化。另一方面，如果大多数时候他们不需要所有这些信息，那么就没有任何回报了。

大多数时候我会选择选项1。但如果它是像智能手机这样的内存受限的东西，我想我会选择惰性扩展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T19:03:29.610

对于刚接触 ORM 工具的人来说，最困难的事情之一是他们尝试应用他们对数据库的了解以及在该上下文中使用的优化（存储 ID 等）。我建议您使用对象，并在它们出现时解决性能问题。

大多数 ORM 都会为您处理此类问题；例如，休眠默认情况下会延迟加载集合（或您的情况下的订单）。在内部，它将为您存储 ID 值的集合，但这实际上不是您关心的问题，因为您只会与对象和关联对象的集合进行交互。如果您专注于您的领域对象并认为“OO”，那么您的 ORM 工具应该支持您并允许您在以后有必要时进一步优化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:54:42.597

我建议使用选项一，因为**您正在处理业务对象而不是弄乱数字**。如果您需要 id，您仍然可以从订单中获取它。而且，如果您使用智能 OR 映射器，在您访问一些真实数据之前，只会加载订单的主键 - 因此无需担心数据库或内存性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T17:02:26.860

选项 #2 与选项 #3 一样，是过早的优化。您的客户想知道订单是什么；它可能甚至不关心订单的 ID 是什么。在某些情况下，客户可能需要这些 ID，但如果您看到这种情况，您可能应该问为什么？并找到一种直接对订单本身进行操作的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T17:40:04.440

我会回应 Paul Tomblin 的说法，即问题不是“最好的做法是什么？” 但是“实现这一目标的最佳方式是什么？” 在您说出函数的返回值应该是什么之前，您必须决定调用者将如何处理这些信息。如果调用者想要做的是，比如说，为用户显示一个订单 ID 列表，然后返回订单 ID。如果调用者想要显示订单日期、总成本和发货状态的列表，那么我将返回一组包含该数据的对象。等等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T16:55:11.333

我必须同意 Paul Tomblin 的观点，如果调用该函数，`getAllOrders()`我希望它返回一个订单对象（假设存在这样的类）。`getAllOrderIds()`如果要返回更具体的内容，则应调用该函数。**